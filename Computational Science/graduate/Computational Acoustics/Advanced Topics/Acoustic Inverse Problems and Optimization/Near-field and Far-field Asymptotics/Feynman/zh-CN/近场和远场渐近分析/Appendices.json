{
    "hands_on_practices": [
        {
            "introduction": "在分析声场的远场特性之前，理解其在声源附近的表现是至关重要的第一步。本练习旨在深入探讨二维线源的近场特征，该模型与细长结构相关。通过从第一性原理出发，推导汉克尔函数的小宗量行为，您将揭示二维声压场独特的对数奇异性，这与三维情况下常见的$\\frac{1}{r}$衰减形式形成鲜明对比。",
            "id": "4131163",
            "problem": "考虑一个二维、无粘性、可压缩的均匀介质，其声速为 $c$，质量密度为 $\\rho$。该介质中传播着角频率为 $\\omega$ 的小振幅时谐声波。令 $p(\\mathbf{x},t)$ 表示声压脉动。从线性化声学方程出发，并假设时谐依赖关系为 $p(\\mathbf{x},t) = \\Re\\{\\hat{p}(\\mathbf{x}) \\exp(-\\mathrm{i}\\omega t)\\}$，空间压力振幅 $\\hat{p}(\\mathbf{x})$ 满足位于原点的点源的二维亥姆霍兹方程，\n$$\n\\nabla^{2} \\hat{p}(\\mathbf{x}) + k^{2} \\hat{p}(\\mathbf{x}) = -\\delta(\\mathbf{x}),\n$$\n其中 $k = \\omega/c$ 是声波数，$\\delta(\\mathbf{x})$ 是狄拉克δ分布。在无穷远处施加 Sommerfeld 辐射条件，以选择具有物理意义的出射解。在柱坐标系中，$r = |\\mathbf{x}|$，此问题的出射格林函数可以用第一类零阶汉克尔函数 $H_{0}^{(1)}$ 来表示，并且源点附近的物理压力场表现出特征性的对数奇异性。\n\n通过系统地推导第一类贝塞尔函数 $J_{0}(z)$ 和第二类贝塞尔函数 $Y_{0}(z)$ 相应的小宗量级数，然后将它们组合成 $H_{0}^{(1)}(z) = J_{0}(z) + \\mathrm{i} Y_{0}(z)$，从第一性原理出发，推导当 $r \\to 0^{+}$ 时第一类零阶汉克尔函数 $H_{0}^{(1)}(kr)$ 的小宗量行为。仅使用由这些特殊函数的定义方程导出的、经过充分验证的恒等式和级数展开。解释二维压力场在源点附近的对数奇异性是如何从你推导的小宗量行为中产生的。\n\n你的最终交付成果是当 $r \\to 0^{+}$ 时 $H_{0}^{(1)}(kr)$ 的主阶渐近表达式，以 $k$、$r$ 和欧拉-马歇罗尼常数 $\\gamma$ 的闭合形式表示。无需进行数值计算。提供一个单一的闭合形式解析表达式。不包括单位。",
            "solution": "所述问题在科学上是合理的、适定的、客观的，并包含了进行严谨推导所需的所有必要信息。它代表了数学物理和声学中的一个标准问题。因此，该问题是有效的，下面提供了完整的解答。\n\n目标是推导第一类零阶汉克尔函数 $H_{0}^{(1)}(kr)$ 在小宗量情况下的主阶渐近行为，即当径向坐标 $r \\to 0^{+}$ 时。该任务通过推导贝塞尔函数 $J_{0}(z)$ 和 $Y_{0}(z)$ 的小宗量级数，并使用定义 $H_{0}^{(1)}(z) = J_{0}(z) + \\mathrm{i} Y_{0}(z)$ 将它们组合来完成。令宗量表示为 $z = kr$。当 $r \\to 0^{+}$ 时，我们有 $z \\to 0^{+}$。\n\n首先，我们考虑零阶第一类贝塞尔函数 $J_{0}(z)$。此函数是零阶贝塞尔微分方程的一个解：\n$$\nz^{2} \\frac{d^{2}y}{dz^{2}} + z \\frac{dy}{dz} + z^{2} y = 0\n$$\n$J_{0}(z)$ 是在 $z=0$ 处解析的解。其级数展开式是一个公认的结果，可以使用 Frobenius 方法推导：\n$$\nJ_{0}(z) = \\sum_{m=0}^{\\infty} \\frac{(-1)^{m}}{(m!)^{2}} \\left(\\frac{z}{2}\\right)^{2m} = 1 - \\frac{z^{2}}{4} + \\frac{z^{4}}{64} - \\dots\n$$\n对于小宗量，$z \\to 0$，我们可以用其主阶项来近似 $J_{0}(z)$，这对应于级数中 $m=0$ 的项：\n$$\nJ_{0}(z) \\approx 1 \\quad \\text{当 } z \\to 0\n$$\n\n接下来，我们考虑零阶第二类贝塞尔函数 $Y_{0}(z)$，也称为韦伯函数或诺伊曼函数。它是零阶贝塞尔方程的第二个线性无关解。由于此情况的指标方程有重根（$s=0$），第二个解必须包含对数项。对于小 $z$，$Y_{0}(z)$ 的标准级数展开式由下式给出：\n$$\nY_{0}(z) = \\frac{2}{\\pi} \\left[ \\left( \\ln\\left(\\frac{z}{2}\\right) + \\gamma \\right) J_{0}(z) - \\sum_{m=1}^{\\infty} \\frac{(-1)^{m}}{(m!)^{2}} \\left( \\sum_{k=1}^{m} \\frac{1}{k} \\right) \\left(\\frac{z}{2}\\right)^{2m} \\right]\n$$\n此处，$\\gamma \\approx 0.5772...$ 是欧拉-马歇罗尼常数，内层求和 $\\sum_{k=1}^{m} \\frac{1}{k}$ 是第 $m$ 个调和数，记作 $H_m$。\n\n为求出 $Y_{0}(z)$ 当 $z \\to 0$ 时的主阶行为，我们检查其展开式中的各项。求和项从 $m=1$ 开始，因此 $z$ 的最低次幂是 $z^{2}$。因此，整个求和项以 $O(z^{2})$ 的速度趋于零。包含 $J_{0}(z)$ 的项成为主导项。如前所示，当 $z \\to 0$ 时，$J_{0}(z) \\to 1$。因此，$Y_{0}(z)$ 的小宗量渐近表达式为：\n$$\nY_{0}(z) \\approx \\frac{2}{\\pi} \\left( \\ln\\left(\\frac{z}{2}\\right) + \\gamma \\right) \\cdot (1) = \\frac{2}{\\pi} \\left( \\ln\\left(\\frac{z}{2}\\right) + \\gamma \\right) \\quad \\text{当 } z \\to 0\n$$\n此表达式清楚地显示了 $Y_{0}(z)$ 在原点的特征对数奇异性。\n\n现在，我们结合这些结果来求汉克尔函数 $H_{0}^{(1)}(z)$ 的小宗量行为。根据定义：\n$$\nH_{0}^{(1)}(z) = J_{0}(z) + \\mathrm{i} Y_{0}(z)\n$$\n代入 $J_{0}(z)$ 和 $Y_{0}(z)$ 的主阶渐近形式：\n$$\nH_{0}^{(1)}(z) \\approx 1 + \\mathrm{i} \\frac{2}{\\pi} \\left( \\ln\\left(\\frac{z}{2}\\right) + \\gamma \\right) \\quad \\text{当 } z \\to 0\n$$\n最后，我们代回 $z = kr$ 以获得在近场中（$r \\to 0^{+}$）$H_{0}^{(1)}(kr)$ 的所需表达式：\n$$\nH_{0}^{(1)}(kr) \\approx 1 + \\mathrm{i} \\frac{2}{\\pi} \\left( \\ln\\left(\\frac{kr}{2}\\right) + \\gamma \\right)\n$$\n这就是第一类零阶汉克尔函数在小宗量情况下的主阶渐近表达式。\n\n问题还要求解释二维压力场中的对数奇异性是如何从这种行为中产生的。满足 Sommerfeld 辐射条件的给定亥姆霍兹方程的解 $\\hat{p}(\\mathbf{x})$，即出射格林函数为 $\\hat{p}(\\mathbf{x}) = \\frac{\\mathrm{i}}{4} H_{0}^{(1)}(kr)$。\n\n在源点附近，当 $r \\to 0^{+}$ 时，空间压力振幅 $\\hat{p}(\\mathbf{x})$ 可以使用推导出的表达式来近似：\n$$\n\\hat{p}(\\mathbf{x}) \\approx \\frac{\\mathrm{i}}{4} \\left[ 1 + \\mathrm{i} \\frac{2}{\\pi} \\left( \\ln\\left(\\frac{kr}{2}\\right) + \\gamma \\right) \\right]\n$$\n分配因子 $\\frac{\\mathrm{i}}{4}$：\n$$\n\\hat{p}(\\mathbf{x}) \\approx \\frac{\\mathrm{i}}{4} + \\frac{\\mathrm{i}^{2}}{4} \\frac{2}{\\pi} \\left( \\ln\\left(\\frac{kr}{2}\\right) + \\gamma \\right) = -\\frac{1}{2\\pi} \\left( \\ln\\left(\\frac{kr}{2}\\right) + \\gamma \\right) + \\frac{\\mathrm{i}}{4}\n$$\n空间压力振幅是一个复数量。其实部和虚部分别为：\n$$\n\\Re\\{\\hat{p}(\\mathbf{x})\\} \\approx -\\frac{1}{2\\pi} \\left( \\ln(r) + \\ln\\left(\\frac{k}{2}\\right) + \\gamma \\right)\n$$\n$$\n\\Im\\{\\hat{p}(\\mathbf{x})\\} \\approx \\frac{1}{4}\n$$\n空间压力振幅的实部包含一项 $-\\frac{1}{2\\pi}\\ln(r)$。当 $r \\to 0^{+}$ 时，$\\ln(r) \\to -\\infty$，因此 $\\Re\\{\\hat{p}(\\mathbf{x})\\}$ 发散到 $+\\infty$。这种对数发散就是源点附近压力场的奇异性。它具体源于第二类贝塞尔函数 $Y_{0}$ 级数展开中的对数项，而 $Y_{0}$ 是模拟二维出射波所需的汉克尔函数 $H_{0}^{(1)}$ 的组成部分。这与三维情况形成对比，在三维情况下，格林函数具有 $\\frac{1}{r}$ 奇异性。",
            "answer": "$$\n\\boxed{1 + \\mathrm{i} \\frac{2}{\\pi} \\left( \\ln\\left(\\frac{kr}{2}\\right) + \\gamma \\right)}\n$$"
        },
        {
            "introduction": "对于扩展声源，近场和远场之间的过渡是渐进的。本练习将以振动活塞为例，探索其菲涅尔衍射区，这是超声换能器的常用模型。您将对声学相位进行系统性展开，以区分平面波、二次（菲涅尔）和高阶项的贡献，并利用此分析推导出一个实用准则，用以界定远场区的起始位置。",
            "id": "4131115",
            "problem": "一个轴对称单色声源被建模为一个半径为 $a$ 的均匀振动的圆形活塞，该活塞安装在无限大的刚性障板上，向声速为 $c$ 的均匀、无粘性流体中辐射声波。设声压场是时谐的，角频率为 $\\omega$，波数为 $k = \\omega / c$，并考虑距离活塞平面为 $z$ 的轴上场。使用亥姆霍兹方程的基本出射自由空间格林函数，辐射场可以表示为在活塞表面上的面积分，其被积函数包含因子 $\\exp(i k r)/r$，其中 $r$ 是从活塞上一点到观察点的距离。\n\n从此表达式出发，并假设在旁轴区，即活塞表面上的横向径向坐标 $\\rho$ 与 $z$ 相比很小（也就是说，$\\rho/z$ 是一个小参量），对 $r$ 按 $\\rho/z$ 的幂次进行系统展开，其精度应足以识别出平面波项之外的首个非平凡相位修正项。然后：\n\n- 找出导致二次相位（表征菲涅耳传播）的项，并简要解释其在近场衍射积分中的作用。\n- 通过要求二次项之后的下一个非零相位修正项在整个活塞表面上的最大幅值以一个给定的相位容差 $\\phi_{\\mathrm{tol}}$ 为界，来推导一个充分的远场条件。\n\n最后，对于一个半径 $a = 2.0 \\times 10^{-2}$ m 的活塞，以频率 $f = 2.0 \\times 10^{5}$ Hz 辐射到水中（$c = 1.5 \\times 10^{3}$ m/s），并使用相位容差 $\\phi_{\\mathrm{tol}} = 1.0 \\times 10^{-1}$ 弧度，根据你推导的判据，计算可以忽略二次相位之后的高阶相位项的最小轴上距离 $z_{\\min}$。以米为单位表示最终答案，并将结果四舍五入到三位有效数字。",
            "solution": "首先根据科学合理性、适定性和客观性标准对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n- 声源：轴对称、单色、均匀振动的圆形活塞，半径为 $a$。\n- 障板：无限大刚性。\n- 介质：均匀、无粘性的流体，声速为 $c$。\n- 场特性：时谐，角频率为 $\\omega$，波数为 $k = \\omega / c$。\n- 观测几何：距离活塞平面为 $z$ 的轴上场。\n- 积分核：辐射场的被积函数包含因子 $\\exp(ik r)/r$，其中 $r$ 是从活塞上的源点到观察点的距离。\n- 旁轴区：活塞上的横向径向坐标 $\\rho$ 与 $z$ 相比很小（$\\rho/z \\ll 1$）。\n- 任务：\n  1. 将 $r$ 按 $\\rho/z$ 的幂次展开。\n  2. 识别二次相位项（菲涅耳项）并解释其作用。\n  3. 通过以容差 $\\phi_{\\mathrm{tol}}$ 界定下一个非零相位修正项，推导一个忽略高阶项的条件。\n- 数值：\n  - 活塞半径, $a = 2.0 \\times 10^{-2}$ m。\n  - 频率, $f = 2.0 \\times 10^{5}$ Hz。\n  - 水中声速, $c = 1.5 \\times 10^{3}$ m/s。\n  - 相位容差, $\\phi_{\\mathrm{tol}} = 1.0 \\times 10^{-1}$ 弧度。\n- 最终目标：根据推导的判据计算最小轴上距离 $z_{\\min}$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有坚实的科学基础，描述了物理声学中的一个典型问题——带障板活塞的辐射，使用亥姆霍兹方程和自由空间格林函数的概念进行分析。所要求的方法，即相位的旁轴展开以及随后对菲涅耳项和高阶项的分析，是波理论和衍射中的标准技术。该问题是适定的，为得到唯一解提供了所有必要信息。语言客观、精确。对于水下声学或医学超声等应用，这些数值是物理上现实的。该问题未违反任何指定的无效标准。\n\n### 步骤3：结论与行动\n问题被判定为有效。将提供完整解答。\n\n### 解答推导\n\n活塞轴上距离为 $z$ 的一个观察点坐标为 $(0, 0, z)$。活塞表面上的一个源点在柱坐标系中由其径向位置 $\\rho$ 和方位角描述，坐标为 $(\\rho \\cos\\theta, \\rho \\sin\\theta, 0)$，其中 $0 \\le \\rho \\le a$。源点与观察点之间的距离 $r$ 由欧几里得距离公式给出：\n$$r = \\sqrt{(\\rho \\cos\\theta - 0)^{2} + (\\rho \\sin\\theta - 0)^{2} + (0 - z)^{2}} = \\sqrt{\\rho^2 + z^2}$$\n为了在旁轴区（$\\rho/z \\ll 1$）分析相位项 $\\exp(ikr)$，我们将 $r$ 按 $\\rho/z$ 的幂次展开。我们提出因子 $z$：\n$$r = z \\sqrt{1 + \\left(\\frac{\\rho}{z}\\right)^2}$$\n使用二项式级数展开 $(1+x)^{\\alpha} \\approx 1 + \\alpha x + \\frac{\\alpha(\\alpha-1)}{2!}x^2 + \\dots$，其中 $x = (\\rho/z)^2$ 且 $\\alpha = 1/2$，我们得到：\n$$r = z \\left[ 1 + \\frac{1}{2}\\left(\\frac{\\rho}{z}\\right)^2 + \\frac{(\\frac{1}{2})(-\\frac{1}{2})}{2}\\left(\\frac{\\rho}{z}\\right)^4 + O\\left(\\left(\\frac{\\rho}{z}\\right)^6\\right) \\right]$$\n$$r \\approx z \\left[ 1 + \\frac{\\rho^2}{2z^2} - \\frac{\\rho^4}{8z^4} \\right]$$\n将前导因子 $z$ 分配进去，我们得到 $r$ 的展开式：\n$$r \\approx z + \\frac{\\rho^2}{2z} - \\frac{\\rho^4}{8z^3}$$\n来自源点 $\\rho$ 的元波的相位是 $\\phi(\\rho) = kr$。使用 $r$ 的展开式，相位变为：\n$$\\phi(\\rho) = kr \\approx kz + \\frac{k\\rho^2}{2z} - \\frac{k\\rho^4}{8z^3}$$\n\n第一个任务完成。第二个任务是确定二次相位项及其作用。\n- 项 $kz$ 代表了平面波传播距离 $z$ 所对应的恒定相位延迟。\n- 项 $\\frac{k\\rho^2}{2z}$ 是二次相位修正项。该项是衍射积分的菲涅耳近似的来源。它解释了波前与平面波前的一阶偏差，将来自活塞的波前建模为具有球面曲率。包含此项对于精确描述近场（或菲涅耳区）中的声场至关重要，在该区域，来自活塞表面不同部分的波之间的显著干涉导致了轴上声强的特征性振荡。\n\n第三个任务是推导一个充分的远场条件。问题通过要求二次项之后的下一个非零相位修正项可忽略来定义此条件。根据我们的展开式，下一项是四次相位修正项：\n$$\\Delta\\phi_{\\text{quartic}}(\\rho) = - \\frac{k\\rho^4}{8z^3}$$\n该项可忽略的条件是，其在整个活塞表面上的最大幅值（发生在边缘 $\\rho = a$ 处）受给定相位容差 $\\phi_{\\mathrm{tol}}$ 的限制。\n$$|\\Delta\\phi_{\\text{quartic}}(a)| \\le \\phi_{\\mathrm{tol}}$$\n$$\\left| - \\frac{ka^4}{8z^3} \\right| \\le \\phi_{\\mathrm{tol}}$$\n$$\\frac{ka^4}{8z^3} \\le \\phi_{\\mathrm{tol}}$$\n我们被要求找出满足此条件的最小距离 $z_{\\min}$。这意味着要找到 $z$ 的下界：\n$$z^3 \\ge \\frac{ka^4}{8\\phi_{\\mathrm{tol}}}$$\n$$z \\ge \\left( \\frac{ka^4}{8\\phi_{\\mathrm{tol}}} \\right)^{1/3}$$\n因此，最小轴上距离为：\n$$z_{\\min} = \\left( \\frac{ka^4}{8\\phi_{\\mathrm{tol}}} \\right)^{1/3}$$\n这个条件定义了从甚近场（其中四次及可能更高阶的相位项是显著的）到菲涅耳区（其中二次相位项足以描述衍射效应）的过渡。\n\n最后，我们使用所提供的数据计算 $z_{\\min}$ 的数值。\n- 半径, $a = 2.0 \\times 10^{-2}$ m。\n- 频率, $f = 2.0 \\times 10^{5}$ Hz。\n- 声速, $c = 1.5 \\times 10^{3}$ m/s。\n- 相位容差, $\\phi_{\\mathrm{tol}} = 1.0 \\times 10^{-1}$ rad。\n\n首先，我们计算波数 $k$：\n$$k = \\frac{\\omega}{c} = \\frac{2\\pi f}{c} = \\frac{2\\pi (2.0 \\times 10^{5})}{1.5 \\times 10^{3}} = \\frac{4.0\\pi \\times 10^5}{1.5 \\times 10^3} = \\frac{8\\pi}{3} \\times 10^2 \\text{ m}^{-1}$$\n现在，我们将这些值代入 $z_{\\min}$ 的表达式中：\n$$z_{\\min} = \\left( \\frac{(\\frac{8\\pi}{3} \\times 10^2) (2.0 \\times 10^{-2})^4}{8(1.0 \\times 10^{-1})} \\right)^{1/3}$$\n$$z_{\\min} = \\left( \\frac{(\\frac{8\\pi}{3} \\times 10^2) (16.0 \\times 10^{-8})}{0.8} \\right)^{1/3}$$\n$$z_{\\min} = \\left( \\frac{\\frac{128\\pi}{3} \\times 10^{-6}}{0.8} \\right)^{1/3} = \\left( \\frac{128\\pi}{3 \\times 0.8} \\times 10^{-6} \\right)^{1/3}$$\n$$z_{\\min} = \\left( \\frac{128\\pi}{2.4} \\times 10^{-6} \\right)^{1/3} = \\left( \\frac{160\\pi}{3} \\times 10^{-6} \\right)^{1/3}$$\n现在，我们计算数值：\n$$\\frac{160\\pi}{3} \\approx \\frac{160 \\times 3.14159265}{3} \\approx 167.5516$$\n所以，\n$$z_{\\min} \\approx \\left( 167.5516 \\times 10^{-6} \\right)^{1/3} \\text{ m}$$\n$$z_{\\min} \\approx (167.5516)^{1/3} \\times (10^{-6})^{1/3} \\text{ m} \\approx 5.513 \\times 10^{-2} \\text{ m}$$\n将结果四舍五入到三位有效数字，我们得到：\n$$z_{\\min} \\approx 5.51 \\times 10^{-2} \\text{ m}$$",
            "answer": "$$\\boxed{5.51 \\times 10^{-2}}$$"
        },
        {
            "introduction": "在许多计算场景中，我们通常只知道声源附近某一表面上的声学数据，而挑战在于如何预测其在远处的辐射方向图。本练习将通过一个积分关系，将表面数据与远场方向图联系起来，从而直接解决这一被称为“近场-远场变换”的问题。通过数值计算一个方形孔径的远场方向图，并与解析解进行验证，您将掌握边界元法及其他计算工具中使用的这一基本技术。",
            "id": "4131235",
            "problem": "给定一个时谐声场，它在三维 (3D) 空间中由亥姆霍兹方程所描述，其角频率为 $\\omega$，声速为 $c$，波数为 $k = \\omega/c$。考虑一个紧致的平面方孔 $\\mathcal{S} \\subset \\mathbb{R}^3$，位于平面 $z = 0$ 上，以原点为中心，边长为 $a > 0$。该孔径上支撑着一个单层源密度 $q(\\mathbf{y})$，其中 $\\mathbf{y} = (x,y,0) \\in \\mathcal{S}$，并采用时间约定 $\\mathrm{e}^{- \\mathrm{i} \\omega t}$。设观测方向为 $\\hat{\\mathbf{x}} = (\\sin \\theta \\cos \\phi, \\sin \\theta \\sin \\phi, \\cos \\theta)$，其中 $\\theta$ 是极角，$\\phi$ 是方位角，两者均以弧度表示。\n\n从亥姆霍兹方程和时谐声学的基本解表示出发，使用远场渐近方法来证明，在方向 $\\hat{\\mathbf{x}}$ 上的归一化远场方向图可以通过对表面数据进行后处理得到，其形式为一个振荡积分：\n$$\nF(\\hat{\\mathbf{x}}) = \\int_{\\mathcal{S}} q(\\mathbf{y}) \\,\\mathrm{e}^{- \\mathrm{i} k \\,\\hat{\\mathbf{x}} \\cdot \\mathbf{y}} \\,\\mathrm{d}S(\\mathbf{y}),\n$$\n该结果与一个和方向无关的乘法常数相差一个因子。对于在方孔 $\\mathcal{S} = \\{(x,y,0) : x \\in [-a/2,a/2], y \\in [-a/2,a/2]\\}$ 上 $q(\\mathbf{y}) = 1$ 的特定情况，解析地计算 $F(\\hat{\\mathbf{x}})$，用 $k$、$a$、$\\theta$ 和 $\\phi$ 表示。\n\n然后，设计一个数值积分方法，通过使用 $N \\times N$ 均匀中点法则对 $\\mathcal{S}$ 进行离散化来近似 $F(\\hat{\\mathbf{x}})$，其中 $N$ 是一个正整数。数值近似必须计算为\n$$\nF_N(\\hat{\\mathbf{x}}) = \\sum_{j=1}^{N} \\sum_{m=1}^{N} q(\\mathbf{y}_{j,m}) \\,\\mathrm{e}^{- \\mathrm{i} k \\,\\hat{\\mathbf{x}} \\cdot \\mathbf{y}_{j,m}} \\,\\Delta S,\n$$\n其中 $\\mathbf{y}_{j,m}$ 是方形网格上的单元中心点，$\\Delta S$ 是每个网格单元的面积。你的程序必须计算 $F_N(\\hat{\\mathbf{x}})$ 并将其与你推导出的精确解析解 $F(\\hat{\\mathbf{x}})$ 进行比较。报告绝对相对误差\n$$\nE = \\frac{|F_N(\\hat{\\mathbf{x}}) - F(\\hat{\\mathbf{x}})|}{|F(\\hat{\\mathbf{x}})|},\n$$\n并且，为避免除以零，如果对于一个很小的容差 $\\varepsilon$ 有 $|F(\\hat{\\mathbf{x}})|  \\varepsilon$，则报告 $E = |F_N(\\hat{\\mathbf{x}}) - F(\\hat{\\mathbf{x}})|$。\n\n所有物理量必须使用以下单位：$k$ 的单位为 $\\mathrm{rad/m}$，$a$ 的单位为 $\\mathrm{m}$，角度 $\\theta$ 和 $\\phi$ 的单位为弧度。报告的误差 $E$ 是无量纲的。对于数值积分，请在每个单元上使用均匀方形网格和中点法则。远场核为 $\\mathrm{e}^{- \\mathrm{i} k \\,\\hat{\\mathbf{x}} \\cdot \\mathbf{y}}$。\n\n实现一个完整的程序，该程序：\n- 计算 $q(\\mathbf{y}) = 1$ 的方孔的解析解 $F(\\hat{\\mathbf{x}})$。\n- 使用 $N \\times N$ 中点法则计算数值解 $F_N(\\hat{\\mathbf{x}})$。\n- 为每个指定的测试用例计算误差 $E$。\n\n测试套件（每个元组为 $(k, a, \\theta, \\phi, N)$）：\n- 用例 1：$(20.0, 0.2, 0.6, 0.0, 101)$。\n- 用例 2：$(40.0, 0.3, 1.0, \\pi/2, 121)$。\n- 用例 3：$(10.0, 0.5, 10^{-6}, 0.7, 51)$。\n- 用例 4：$(500.0, 0.2, 0.7, 1.1, 101)$。\n- 用例 5：$(100.0, 0.2, 0.4, 2.2, 11)$。\n\n你的程序应该生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如 $[r_1,r_2,r_3,r_4,r_5]$，其中每个 $r_i$ 是相应测试用例的误差 $E$。角度必须以弧度解释。容差 $\\varepsilon$ 必须设置为 $\\varepsilon = 10^{-12}$。不允许外部输入；所有常量必须在程序中定义。输出必须是无量纲的浮点数。",
            "solution": "我们从声压场 $p(\\mathbf{x})$ 的亥姆霍兹方程开始，其角频率为 $\\omega$，声速为 $c$，\n$\\Delta p(\\mathbf{x}) + k^2 p(\\mathbf{x}) = 0, \\quad k = \\frac{\\omega}{c}$，\n时间依赖关系为 $\\mathrm{e}^{- \\mathrm{i} \\omega t}$。解的标准表示可通过边界或表面源公式获得。对于支撑在光滑、紧致表面 $\\mathcal{S}$ 上的单层分布，在 $\\mathbf{x}$ 处的辐射场为\n$$\np(\\mathbf{x}) = \\int_{\\mathcal{S}} q(\\mathbf{y}) \\, G_k(\\mathbf{x},\\mathbf{y}) \\,\\mathrm{d}S(\\mathbf{y}),\n$$\n其中 $q(\\mathbf{y})$ 是源密度，$G_k(\\mathbf{x},\\mathbf{y})$ 是自由空间格林函数，\n$$\nG_k(\\mathbf{x},\\mathbf{y}) = \\frac{\\mathrm{e}^{\\mathrm{i} k |\\mathbf{x}-\\mathbf{y}|}}{4\\pi |\\mathbf{x}-\\mathbf{y}|}.\n$$\n对于远场渐近，设 $r = |\\mathbf{x}|$ 且 $\\hat{\\mathbf{x}} = \\mathbf{x}/r$。使用展开式\n$$\n|\\mathbf{x} - \\mathbf{y}| = r \\left( 1 - \\frac{\\hat{\\mathbf{x}} \\cdot \\mathbf{y}}{r} + \\mathcal{O}\\!\\left(\\frac{1}{r^2}\\right) \\right),\n$$\n我们得到\n$$\n\\frac{\\mathrm{e}^{\\mathrm{i} k |\\mathbf{x}-\\mathbf{y}|}}{|\\mathbf{x}-\\mathbf{y}|} = \\frac{\\mathrm{e}^{\\mathrm{i} k r}}{r} \\,\\mathrm{e}^{-\\mathrm{i} k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}} \\left( 1 + \\mathcal{O}\\!\\left(\\frac{1}{r}\\right) \\right).\n$$\n因此，当 $r \\to \\infty$ 时，\n$$\np(\\mathbf{x}) = \\frac{\\mathrm{e}^{\\mathrm{i} k r}}{4\\pi r} \\int_{\\mathcal{S}} q(\\mathbf{y}) \\,\\mathrm{e}^{-\\mathrm{i} k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}} \\,\\mathrm{d}S(\\mathbf{y}) + \\mathcal{O}\\!\\left(\\frac{1}{r^2}\\right).\n$$\n这将远场振幅 $f(\\hat{\\mathbf{x}})$（相差一个因子 $1/(4\\pi)$）确定为振荡表面积分\n$$\nf(\\hat{\\mathbf{x}}) = \\int_{\\mathcal{S}} q(\\mathbf{y}) \\,\\mathrm{e}^{-\\mathrm{i} k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}} \\,\\mathrm{d}S(\\mathbf{y}).\n$$\n我们采用归一化远场方向图\n$$\nF(\\hat{\\mathbf{x}}) = \\int_{\\mathcal{S}} q(\\mathbf{y}) \\,\\mathrm{e}^{-\\mathrm{i} k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}} \\,\\mathrm{d}S(\\mathbf{y}),\n$$\n它省略了常数前置因子。\n\n现在，我们专门研究方孔 $\\mathcal{S} = \\{(x,y,0): x \\in [-a/2,a/2], y \\in [-a/2,a/2]\\}$，其密度为常数 $q(\\mathbf{y}) = 1$。设 $\\hat{\\mathbf{x}} = (\\sin \\theta \\cos \\phi, \\sin \\theta \\sin \\phi, \\cos \\theta)$。由于 $\\mathbf{y} = (x,y,0)$，我们有\n$$\n\\hat{\\mathbf{x}} \\cdot \\mathbf{y} = (\\sin \\theta \\cos \\phi) \\, x + (\\sin \\theta \\sin \\phi) \\, y.\n$$\n定义方向余弦\n$$\n\\alpha = \\sin \\theta \\cos \\phi, \\qquad \\beta = \\sin \\theta \\sin \\phi.\n$$\n那么\n$$\nF(\\hat{\\mathbf{x}}) = \\int_{-a/2}^{a/2} \\int_{-a/2}^{a/2} \\mathrm{e}^{-\\mathrm{i} k (\\alpha x + \\beta y)} \\,\\mathrm{d}x \\,\\mathrm{d}y.\n$$\n该积分可分离为两个一维积分的乘积：\n$$\nI_x = \\int_{-a/2}^{a/2} \\mathrm{e}^{-\\mathrm{i} k \\alpha x} \\,\\mathrm{d}x, \\qquad I_y = \\int_{-a/2}^{a/2} \\mathrm{e}^{-\\mathrm{i} k \\beta y} \\,\\mathrm{d}y,\n$$\n因此 $F(\\hat{\\mathbf{x}}) = I_x I_y$。每个积分都可以精确计算：\n$$\nI_x = \\frac{2 \\sin\\!\\left(\\tfrac{k \\alpha a}{2}\\right)}{k \\alpha}, \\qquad I_y = \\frac{2 \\sin\\!\\left(\\tfrac{k \\beta a}{2}\\right)}{k \\beta}.\n$$\n引入未归一化的 sinc 函数 $\\operatorname{sinc}(z) = \\frac{\\sin z}{z}$，并约定 $\\operatorname{sinc}(0) = 1$。使用 $c_x = \\tfrac{k \\alpha a}{2}$ 和 $c_y = \\tfrac{k \\beta a}{2}$，我们可以重写\n$$\nI_x = a \\,\\operatorname{sinc}(c_x), \\qquad I_y = a \\,\\operatorname{sinc}(c_y).\n$$\n因此，具有均匀密度的方孔的精确归一化远场方向图是\n$$\nF(\\hat{\\mathbf{x}}) = a^2 \\,\\operatorname{sinc}\\!\\left(\\tfrac{k a}{2} \\sin \\theta \\cos \\phi \\right) \\,\\operatorname{sinc}\\!\\left(\\tfrac{k a}{2} \\sin \\theta \\sin \\phi \\right).\n$$\n根据极限 $\\operatorname{sinc}(0) = 1$，该公式在 $\\alpha = 0$ 或 $\\beta = 0$ 时仍然是良定义的，这与 L'Hôpital 法则一致。\n\n接下来，我们设计一个基于在方孔 $\\mathcal{S}$ 上使用 $N \\times N$ 均匀中点法则的数值积分方法。将长度为 $a$ 的每条边划分为 $N$ 个宽度为 $\\Delta = a/N$ 的相等子区间。网格单元中心为\n$$\nx_j = -\\frac{a}{2} + \\left(j - \\tfrac{1}{2}\\right) \\Delta, \\quad y_m = -\\frac{a}{2} + \\left(m - \\tfrac{1}{2}\\right) \\Delta, \\quad j,m = 1,\\dots,N,\n$$\n每个单元的面积为 $\\Delta S = \\Delta^2$。中点法则近似通过在中心点计算被积函数并求和得到：\n$$\nF_N(\\hat{\\mathbf{x}}) = \\sum_{j=1}^{N} \\sum_{m=1}^{N} \\mathrm{e}^{-\\mathrm{i} k (\\alpha x_j + \\beta y_m)} \\,\\Delta^2.\n$$\n由于被积函数可以分解为 $\\mathrm{e}^{-\\mathrm{i} k \\alpha x} \\mathrm{e}^{-\\mathrm{i} k \\beta y}$，双重求和可以计算为两个一维求和的乘积以提高计算效率：\n$$\nS_x = \\sum_{j=1}^{N} \\mathrm{e}^{-\\mathrm{i} k \\alpha x_j}, \\qquad S_y = \\sum_{m=1}^{N} \\mathrm{e}^{-\\mathrm{i} k \\beta y_m}, \\qquad F_N(\\hat{\\mathbf{x}}) = \\Delta^2 \\, S_x \\, S_y.\n$$\n对于光滑的被积函数，中点法则在 $\\Delta$ 上达到二阶精度，即对于固定频率，误差的行为类似于 $\\mathcal{O}(\\Delta^2)$。然而，对于高度振荡的被积函数（大的 $k$ 或大的 $|\\alpha|$、$|\\beta|$），解析振荡需要足够大的 $N$；否则，混叠会引起更大的误差。\n\n对于每个指定的测试用例 $(k, a, \\theta, \\phi, N)$，我们计算：\n- 使用公式 $F(\\hat{\\mathbf{x}}) = a^2 \\,\\operatorname{sinc}(c_x) \\,\\operatorname{sinc}(c_y)$，其中 $c_x = \\tfrac{k a}{2} \\sin \\theta \\cos \\phi$，$c_y = \\tfrac{k a}{2} \\sin \\theta \\sin \\phi$，计算精确的解析解 $F(\\hat{\\mathbf{x}})$。\n- 使用上述中点法则计算数值解 $F_N(\\hat{\\mathbf{x}})$。\n- 绝对相对误差\n$$\nE = \\begin{cases}\n\\dfrac{|F_N(\\hat{\\mathbf{x}}) - F(\\hat{\\mathbf{x}})|}{|F(\\hat{\\mathbf{x}})|},  \\text{若 } |F(\\hat{\\mathbf{x}})| \\ge \\varepsilon, \\\\\n|F_N(\\hat{\\mathbf{x}}) - F(\\hat{\\mathbf{x}})|,  \\text{若 } |F(\\hat{\\mathbf{x}})|  \\varepsilon,\n\\end{cases}\n$$\n其中 $\\varepsilon = 10^{-12}$。\n\n每个用例的算法步骤：\n1. 计算 $\\alpha = \\sin \\theta \\cos \\phi$，$\\beta = \\sin \\theta \\sin \\phi$。\n2. 通过基于 sinc 的公式计算精确振幅；当 $|c_x|$ 或 $|c_y|$ 小于阈值（例如 $10^{-12}$）时，通过设置 $\\operatorname{sinc}(0) = 1$ 来确保数值稳定性。\n3. 构建一维中点节点 $x_j$ 和 $y_m$，并计算 $S_x$ 和 $S_y$。\n4. 计算 $F_N(\\hat{\\mathbf{x}}) = \\Delta^2 S_x S_y$。\n5. 使用上述规则计算误差 $E$。\n6. 将所有用例的 $E$ 值列表报告为单行的、用方括号括起来的、逗号分隔的行。\n\n该过程通过应用远场核 $\\mathrm{e}^{-\\mathrm{i} k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}}$，为数值离散化的边界积分实现了近场到远场的后处理，并针对一个典范方孔的可解析推导的远场方向图验证了计算结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef safe_sinc(z, tol=1e-12):\n    \"\"\"\n    Unnormalized sinc function: sin(z)/z with limit 1 at z=0.\n    \"\"\"\n    if np.abs(z)  tol:\n        return 1.0\n    return np.sin(z) / z\n\ndef exact_far_field(k, a, theta, phi):\n    \"\"\"\n    Exact normalized far-field pattern for a square aperture with q(y)=1:\n    F(hat{x}) = a^2 * sinc(c_x) * sinc(c_y),\n    where c_x = (k a / 2) * sin(theta) * cos(phi),\n          c_y = (k a / 2) * sin(theta) * sin(phi).\n    \"\"\"\n    alpha = np.sin(theta) * np.cos(phi)\n    beta = np.sin(theta) * np.sin(phi)\n    cx = 0.5 * k * a * alpha\n    cy = 0.5 * k * a * beta\n    return (a**2) * safe_sinc(cx) * safe_sinc(cy)\n\ndef numerical_far_field(k, a, theta, phi, N):\n    \"\"\"\n    Midpoint rule approximation of the far-field integral over the square:\n    F_N(hat{x}) = sum_{j=1}^N sum_{m=1}^N e^{-i k (alpha x_j + beta y_m)} * Delta^2,\n    with x_j, y_m being midpoints and Delta = a / N.\n    Uses separability to compute as (Delta^2) * (sum_x) * (sum_y).\n    \"\"\"\n    alpha = np.sin(theta) * np.cos(phi)\n    beta = np.sin(theta) * np.sin(phi)\n    Delta = a / N\n    # Midpoint nodes along one dimension\n    x = np.linspace(-a/2.0, a/2.0 - Delta, N) + 0.5 * Delta\n    y = x  # Same distribution for y since square and uniform grid\n    # Compute 1D sums\n    sum_x = np.sum(np.exp(-1j * k * alpha * x))\n    sum_y = np.sum(np.exp(-1j * k * beta * y))\n    return (Delta**2) * sum_x * sum_y\n\ndef compute_error(num_val, exact_val, eps=1e-12):\n    \"\"\"\n    Absolute relative error unless exact_val is near zero, in which case\n    return absolute error.\n    \"\"\"\n    exact_abs = np.abs(exact_val)\n    num_abs = np.abs(num_val)\n    if exact_abs >= eps:\n        return float(np.abs(num_val - exact_val) / exact_abs)\n    else:\n        return float(np.abs(num_val - exact_val))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple: (k [rad/m], a [m], theta [rad], phi [rad], N [integer])\n    test_cases = [\n        (20.0, 0.2, 0.6, 0.0, 101),              # Case 1\n        (40.0, 0.3, 1.0, np.pi/2.0, 121),        # Case 2 (alpha = 0 boundary case)\n        (10.0, 0.5, 1e-6, 0.7, 51),              # Case 3 (near axis: alpha ~ beta ~ 0)\n        (500.0, 0.2, 0.7, 1.1, 101),             # Case 4 (high frequency, modest N)\n        (100.0, 0.2, 0.4, 2.2, 11),              # Case 5 (coarse grid, moderate frequency)\n    ]\n\n    results = []\n    for k, a, theta, phi, N in test_cases:\n        exact = exact_far_field(k, a, theta, phi)\n        numeric = numerical_far_field(k, a, theta, phi, N)\n        err = compute_error(numeric, exact, eps=1e-12)\n        results.append(err)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}