{
    "hands_on_practices": [
        {
            "introduction": "任何基于计算的拓扑优化的基石都是对底层物理场进行精确的数值模拟。然而，将亥姆霍兹方程等波动方程离散化会不可避免地引入误差，其中“数值色散”是一个关键问题，它会导致数值波速与物理波速偏离。本实践将指导您通过分析一个一维波动问题，亲手推导并量化这种“污染效应”，从而深刻理解在声学模拟中网格尺寸、频率和精度之间的基本权衡。",
            "id": "4148050",
            "problem": "在角频率为 $\\omega$ 的声学消声器的基于密度的拓扑优化中，均匀、无损耗的一维波导中的压力场 $p(x)$ 由时谐线性声学亥姆霍兹方程建模。对于恒定的质量密度 $\\rho$ 和体积模量 $K$，该方程简化为 $\\frac{\\mathrm{d}^{2}p}{\\mathrm{d}x^{2}} + k^{2} p = 0$，其中 $k = \\omega / c$ 且 $c = \\sqrt{K/\\rho}$。为了量化在拓扑优化中可能污染目标和灵敏度评估的数值色散效应，考虑一个单元尺寸为 $h$ 的均匀网格，并采用标准的伽辽金有限元法（FEM），该方法在无限周期网格上使用线性形函数和一致质量矩阵。\n\n从弱形式出发，并使用上述离散化选择：\n- 推导内部节点处的组装离散方程，用节点值 $p_{i-1}$、$p_{i}$ 和 $p_{i+1}$ 表示。\n- 应用 Bloch 波拟设 $p_{j} = \\exp(\\mathrm{i} j \\theta)$（其中 $\\theta = k_{h} h$），以获得连续波数 $k$ 和离散波数 $k_{h}$ 之间的离散色散关系。\n- 从该关系中，推导当 $k h \\to 0$ 时，相对相位误差 $\\varepsilon(k h) = \\frac{k_{h} - k}{k}$ 的领阶渐近展开。\n\n请提供 $\\varepsilon(k h)$ 的领阶项的单个闭式解析表达式，用 $k$ 和 $h$ 表示。最终表达式中不要包含任何等号。无需进行数值四舍五入。最终表达式是无量纲的，因此不应报告任何单位。",
            "solution": "用户希望找到一维亥姆霍兹方程有限元离散化中相对相位误差的领阶项。\n\n验证步骤如下：\n\n### 步骤 1：提取已知条件\n- **控制方程**：$\\frac{\\mathrm{d}^{2}p}{\\mathrm{d}x^{2}} + k^{2} p = 0$，用于描述压力场 $p(x)$。\n- **常数**：质量密度 $\\rho$，体积模量 $K$。两者均为常数。\n- **波的性质**：角频率 $\\omega$，波数 $k = \\omega / c$，声速 $c = \\sqrt{K/\\rho}$。\n- **数值方案**：标准伽辽金有限元法 (FEM)。\n- **离散化细节**：单元尺寸为 $h$ 的均匀网格，线性形函数，一致质量矩阵。\n- **域**：无限周期网格。\n- **节点变量**：三个连续节点处的压力值 $p_{i-1}$、$p_{i}$、$p_{i+1}$。\n- **分析工具**：Bloch 波拟设 $p_{j} = \\exp(\\mathrm{i} j \\theta)$，其中 $\\theta = k_{h} h$，而 $k_h$ 是离散波数。\n- **目标**：推导当 $k h \\to 0$ 时，相对相位误差 $\\varepsilon(k h) = \\frac{k_{h} - k}{k}$ 的领阶渐近展开。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学基础**：该问题是波动传播数值分析中的一个标准练习，特别是针对有限元法的网格色散分析。亥姆霍兹方程、伽辽金法、线性单元、一致质量矩阵和 Bloch 波分析都是计算力学和声学中基本且成熟的概念。问题的前提是合理的。\n- **适定性**：问题陈述清晰，并提供了逐步遵循的程序。它要求一个具体、可推导的量（相位误差的领阶项）。问题设置是自洽的，足以推导出唯一答案。\n- **客观性**：语言精确且数学化。没有主观或模糊的术语。\n\n### 步骤 3：结论与行动\n该问题有科学依据、适定、客观且完整，是有效的。我将继续进行求解。\n\n求解过程遵循问题陈述中概述的步骤。\n\n首先，我们建立亥姆霍兹方程的弱形式。我们将控制方程乘以一个合适的测试函数 $v(x)$，并在域上积分。对于内部节点 $i$ 处的方程，在相应基函数 $N_i(x)$ 的支集 $[x_{i-1}, x_{i+1}]$ 上积分即可。\n$$ \\int_{x_{i-1}}^{x_{i+1}} v \\left( \\frac{\\mathrm{d}^{2}p}{\\mathrm{d}x^{2}} + k^{2}p \\right) \\mathrm{d}x = 0 $$\n对二阶导数项应用分部积分：\n$$ \\left[ v \\frac{\\mathrm{d}p}{\\mathrm{d}x} \\right]_{x_{i-1}}^{x_{i+1}} - \\int_{x_{i-1}}^{x_{i+1}} \\frac{\\mathrm{d}v}{\\mathrm{d}x} \\frac{\\mathrm{d}p}{\\mathrm{d}x} \\mathrm{d}x + k^{2} \\int_{x_{i-1}}^{x_{i+1}} v p \\, \\mathrm{d}x = 0 $$\n在伽辽金法中，测试函数 $v(x)$ 从与试探函数相同的空间中选择。我们选择 $v(x) = N_i(x)$，即以节点 $i$ 为中心的线性“帽”函数，它在 $x_{i-1}$ 和 $x_{i+1}$ 处为零。因此，边界项消失。节点 $i$ 的弱形式为：\n$$ - \\int_{x_{i-1}}^{x_{i+1}} \\frac{\\mathrm{d}N_i}{\\mathrm{d}x} \\frac{\\mathrm{d}p}{\\mathrm{d}x} \\mathrm{d}x + k^{2} \\int_{x_{i-1}}^{x_{i+1}} N_i p \\, \\mathrm{d}x = 0 $$\n接下来，我们使用线性形函数对压力场 $p(x)$ 进行离散化：$p(x) \\approx p_h(x) = \\sum_{j} p_j N_j(x)$，其中 $p_j$ 是节点压力值。将其代入弱形式，得到节点 $i$ 的离散方程：\n$$ \\sum_{j} p_j \\left( - \\int \\frac{\\mathrm{d}N_i}{\\mathrm{d}x} \\frac{\\mathrm{d}N_j}{\\mathrm{d}x} \\mathrm{d}x + k^2 \\int N_i N_j \\mathrm{d}x \\right) = 0 $$\n这可以写成矩阵形式 $(K - k^2 M)\\mathbf{p} = \\mathbf{0}$，其中 $K$ 是刚度矩阵，$M$ 是一致质量矩阵。为了找到节点 $i$ 的具体方程，我们需要长度为 $h$ 的一维线性单元的单元刚度矩阵 $K^e$ 和质量矩阵 $M^e$。它们由下式给出：\n$$ K^e = \\frac{1}{h}\\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}, \\quad M^e = \\frac{h}{6}\\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix} $$\n组装与节点 $i$ 相邻的两个单元（即 $[x_{i-1}, x_i]$ 和 $[x_i, x_{i+1}]$）的贡献，得到全局系统第 $i$ 行的计算模板：\n刚度部分：$\\frac{1}{h}(-p_{i-1} + 2p_i - p_{i+1})$\n质量部分：$\\frac{h}{6}(p_{i-1} + 4p_i + p_{i+1})$\n内部节点 $i$ 处的组装离散方程为：\n$$ \\frac{1}{h}(-p_{i-1} + 2p_i - p_{i+1}) - k^2 \\frac{h}{6}(p_{i-1} + 4p_i + p_{i+1}) = 0 $$\n现在，我们进行 Bloch 波分析，将拟设 $p_j = \\exp(\\mathrm{i} j \\theta)$（其中 $\\theta = k_h h$）代入此方程。这里，$k_h$ 是数值波数。\n$$ \\frac{1}{h}(-\\exp(\\mathrm{i}(i-1)\\theta) + 2\\exp(\\mathrm{i}i\\theta) - \\exp(\\mathrm{i}(i+1)\\theta)) - k^2 \\frac{h}{6}(\\exp(\\mathrm{i}(i-1)\\theta) + 4\\exp(\\mathrm{i}i\\theta) + \\exp(\\mathrm{i}(i+1)\\theta)) = 0 $$\n除以公因子 $\\exp(\\mathrm{i}i\\theta)$：\n$$ \\frac{1}{h}(-\\exp(-\\mathrm{i}\\theta) + 2 - \\exp(\\mathrm{i}\\theta)) - k^2 \\frac{h}{6}(\\exp(-\\mathrm{i}\\theta) + 4 + \\exp(\\mathrm{i}\\theta)) = 0 $$\n使用欧拉公式 $\\exp(\\mathrm{i}\\theta) + \\exp(-\\mathrm{i}\\theta) = 2\\cos(\\theta)$，我们简化方程：\n$$ \\frac{1}{h}(2 - 2\\cos(\\theta)) - k^2 \\frac{h}{6}(4 + 2\\cos(\\theta)) = 0 $$\n这是离散色散关系。我们求解 $k^2$ 以将其与数值参数联系起来：\n$$ k^2 = \\frac{\\frac{2}{h}(1-\\cos(\\theta))}{\\frac{h}{3}(2+\\cos(\\theta))} = \\frac{6(1-\\cos(\\theta))}{h^2(2+\\cos(\\theta))} $$\n代入 $\\theta = k_h h$ 并使用半角恒等式 $1-\\cos(x) = 2\\sin^2(x/2)$：\n$$ (kh)^2 = \\frac{6(1-\\cos(k_h h))}{2+\\cos(k_h h)} = \\frac{12\\sin^2(k_h h / 2)}{2+\\cos(k_h h)} $$\n为了找到当 $kh \\to 0$ 时 $\\varepsilon(kh) = \\frac{k_h-k}{k}$ 的领阶渐近展开，我们对此关系进行小参数的泰勒级数展开。设 $\\phi = k_h h$。当 $kh \\to 0$ 时，我们也有 $\\phi \\to 0$。正弦和余弦的泰勒展开式为：\n$$ \\sin(x) = x - \\frac{x^3}{6} + O(x^5), \\quad \\cos(x) = 1 - \\frac{x^2}{2} + \\frac{x^4}{24} + O(x^6) $$\n展开色散关系的分子和分母：\n$$ 12\\sin^2(\\phi/2) = 12 \\left( \\frac{\\phi}{2} - \\frac{1}{6}\\left(\\frac{\\phi}{2}\\right)^3 + \\dots \\right)^2 = 12 \\left( \\frac{\\phi^2}{4} - \\frac{\\phi^4}{48} + \\dots \\right) = 3\\phi^2 - \\frac{\\phi^4}{4} + O(\\phi^6) $$\n$$ 2+\\cos(\\phi) = 2 + \\left( 1 - \\frac{\\phi^2}{2} + \\frac{\\phi^4}{24} + \\dots \\right) = 3 - \\frac{\\phi^2}{2} + \\frac{\\phi^4}{24} + \\dots $$\n将这些代回 $(kh)^2$ 的关系式中：\n$$ (kh)^2 = \\frac{3\\phi^2 - \\frac{\\phi^4}{4} + O(\\phi^6)}{3 - \\frac{\\phi^2}{2} + O(\\phi^4)} = \\frac{\\phi^2(1 - \\frac{\\phi^2}{12} + \\dots)}{1 - \\frac{\\phi^2}{6} + \\dots} $$\n对于小 $x$ 使用几何级数近似 $(1-x)^{-1} \\approx 1+x$：\n$$ (kh)^2 \\approx \\phi^2 \\left(1 - \\frac{\\phi^2}{12}\\right) \\left(1 + \\frac{\\phi^2}{6}\\right) \\approx \\phi^2 \\left(1 + \\frac{\\phi^2}{6} - \\frac{\\phi^2}{12}\\right) = \\phi^2 \\left(1 + \\frac{\\phi^2}{12}\\right) = \\phi^2 + \\frac{\\phi^4}{12} $$\n所以我们有 $(kh)^2 = (k_h h)^2 + \\frac{(k_h h)^4}{12} + O((k_h h)^6)$。我们需要反转这个关系来用 $k$ 表示 $k_h$。\n$$ (k_h h)^2 = (kh)^2 - \\frac{(k_h h)^4}{12} + \\dots $$\n在修正项中，我们可以做领阶近似 $(k_h h)^4 \\approx (kh)^4$。\n$$ (k_h h)^2 \\approx (kh)^2 - \\frac{(kh)^4}{12} $$\n取平方根并使用二项式近似 $\\sqrt{1-x} \\approx 1-x/2$：\n$$ k_h h \\approx \\sqrt{(kh)^2 \\left(1 - \\frac{(kh)^2}{12}\\right)} = (kh) \\sqrt{1 - \\frac{(kh)^2}{12}} \\approx (kh)\\left(1 - \\frac{(kh)^2}{24}\\right) $$\n$$ k_h h \\approx kh - \\frac{(kh)^3}{24} $$\n两边除以 $h$：\n$$ k_h \\approx k - \\frac{k^3 h^2}{24} $$\n相对相位误差为 $\\varepsilon(kh) = (k_h - k)/k$。\n$$ \\varepsilon(kh) \\approx \\frac{(k - \\frac{k^3 h^2}{24}) - k}{k} = \\frac{-\\frac{k^3 h^2}{24}}{k} = -\\frac{k^2 h^2}{24} $$\n因此，相对相位误差的领阶项是 $-\\frac{k^2 h^2}{24}$。",
            "answer": "$$\\boxed{-\\frac{k^2 h^2}{24}}$$"
        },
        {
            "introduction": "声学拓扑优化的一个核心应用是设计具有特定波操控能力的功能结构，例如声子晶体和超材料。这些材料的独特性质源于其周期性重复的微结构单元。本实践将引导您应用Bloch-Floquet理论来分析这样一个周期单元，并将其转化为一个广义特征值问题，这是计算能带结构、设计声学带隙和负折射率等特性的关键步骤。",
            "id": "4148066",
            "problem": "考虑一个用于声学器件拓扑优化的二维声子晶体。周期性晶胞是方形区域 $\\Omega = [0,a] \\times [0,a]$，晶格常数为 $a0$。设计由一个空间变化的标量场 $\\chi(\\mathbf{x}) \\in [0,1]$ 表示，该场在两个方向上均以 $a$ 为周期，并通过关系式 $\\rho(\\mathbf{x}) = \\rho_{s} \\chi(\\mathbf{x}) + \\rho_{f} (1 - \\chi(\\mathbf{x}))$ 和 $K(\\mathbf{x}) = K_{s} \\chi(\\mathbf{x}) + K_{f} (1 - \\chi(\\mathbf{x}))$ 在固相（密度为 $\\rho_{s}$，体模量为 $K_{s}$）和流体相（密度为 $\\rho_{f}$，体模量为 $K_{f}$）之间进行材料属性插值。假设为时谐声学，角频率为 $\\omega$，粘度可忽略不计，并采用线性化运动学。令 $p(\\mathbf{x})$ 表示复声压场。在频域中，非均匀可压缩介质的控制方程是标量亥姆霍兹型方程\n$$\n\\nabla \\cdot \\left( \\frac{1}{\\rho(\\mathbf{x})} \\nabla p(\\mathbf{x}) \\right) + \\omega^{2} \\frac{1}{K(\\mathbf{x})} p(\\mathbf{x}) = 0 \\quad \\text{in } \\Omega,\n$$\n其中材料系数 $\\rho(\\mathbf{x})$ 和 $K(\\mathbf{x})$ 是以 $a$ 为周期的。对晶体在第一布里渊区内给定波矢 $\\mathbf{k} = (k_{x}, k_{y})$ 的情况下，应用 Bloch-Floquet 条件进行分析。\n\n任务：\n- 从材料系数的周期性和上述线性声学控制方程出发，利用布洛赫定理推导声压 $p(\\mathbf{x})$ 在 $\\Omega$ 相对面上必须满足的 Bloch-Floquet 边界条件，并用与波矢 $\\mathbf{k}$ 和晶格平移相关的相因子明确表示。\n- 使用布洛赫拟设 $p(\\mathbf{x}) = u(\\mathbf{x}) \\exp(i \\mathbf{k} \\cdot \\mathbf{x})$（其中 $u(\\mathbf{x})$ 是以 $a$ 为周期的），推导晶胞 $\\Omega$ 上的弱形式，并证明当使用有限元方法（FEM）进行离散化时，色散分析可简化为 $\\mathbf{K}(\\mathbf{k}) \\mathbf{u} = \\omega^{2} \\mathbf{M} \\mathbf{u}$ 形式的广义厄米特征问题。清晰地指出定义 $\\mathbf{K}(\\mathbf{k})$ 和 $\\mathbf{M}$ 的双线性形式。\n- 对于晶胞为均匀介质的特殊基准情况，即材料属性为常数 $\\rho(\\mathbf{x}) \\equiv \\rho_{0}$ 和 $K(\\mathbf{x}) \\equiv K_{0}$，考虑截断至单个基频布洛赫谐波的平面波展开。推导第一布里渊区内最低支色散关系 $\\omega(\\mathbf{k})$ 的闭式解析表达式。\n\n回答格式：\n- 仅提供最低支色散关系 $\\omega(k_{x}, k_{y})$ 的闭式表达式。无需进行数值计算。最终答案框中不要包含单位。",
            "solution": "问题陈述具有科学依据、内容完整且提法恰当。它提出了计算声学和声子晶体理论领域中的一个标准问题。所有提供的信息都是一致的，并且足以进行所要求的推导。因此，该问题是有效的，下面给出了完整的解答。\n\n该问题涉及分析声波在二维周期性介质（声子晶体）中的传播。分析基于 Bloch-Floquet 定理，这是描述具有周期性系数的偏微分方程系统的基本结果。\n\n首先，我们推导声压场 $p(\\mathbf{x})$ 的 Bloch-Floquet 边界条件。材料属性 $\\rho(\\mathbf{x})$ 和 $K(\\mathbf{x})$ 相对于晶格平移是周期性的。晶胞是边长为 $a$ 的正方形，因此晶格矢量由基矢 $\\mathbf{a}_1 = (a, 0)$ 和 $\\mathbf{a}_2 = (0, a)$ 生成。任意晶格平移矢量可以写成 $\\mathbf{R} = n_1 \\mathbf{a}_1 + n_2 \\mathbf{a}_2$，其中 $n_1, n_2$ 为整数。布洛赫定理指出，对于给定的波矢 $\\mathbf{k}$，波动控制方程的解 $p(\\mathbf{x})$ 必须满足以下条件：\n$$\np(\\mathbf{x} + \\mathbf{R}) = p(\\mathbf{x}) \\exp(i \\mathbf{k} \\cdot \\mathbf{R})\n$$\n我们将此定理应用于晶胞 $\\Omega = [0,a] \\times [0,a]$ 的边界。\n对于位于 $x=0$ 和 $x=a$ 的垂直边界，相关的平移矢量是 $\\mathbf{R} = \\mathbf{a}_1 = (a, 0)$。对于左边界上的任意点 $(0, y)$，其在右边界上周期性对应的点是 $(a, y) = (0, y) + (a, 0)$。应用布洛赫定理可得：\n$$\np(a, y) = p(0, y) \\exp(i \\mathbf{k} \\cdot (a, 0)) = p(0, y) \\exp(i k_x a)\n$$\n同样，对于位于 $y=0$ 和 $y=a$ 的水平边界，平移矢量是 $\\mathbf{R} = \\mathbf{a}_2 = (0, a)$。对于下边界上的任意点 $(x, 0)$，其在上边界上对应的点是 $(x, a) = (x, 0) + (0, a)$。这得到：\n$$\np(x, a) = p(x, 0) \\exp(i \\mathbf{k} \\cdot (0, a)) = p(x, 0) \\exp(i k_y a)\n$$\n这些就是晶胞 $\\Omega$ 上压力场 $p(\\mathbf{x})$ 的 Bloch-Floquet 边界条件。它们是准周期性边界条件，其周期性受到由波矢 $\\mathbf{k}$ 决定的相因子的调制。\n\n第二，我们推导弱形式，并证明它会导致一个广义厄米特征问题。布洛赫拟设将压力场 $p(\\mathbf{x})$ 分解为一个周期部分 $u(\\mathbf{x})$ 和一个平面波相因子：\n$$\np(\\mathbf{x}) = u(\\mathbf{x}) \\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\n其中 $u(\\mathbf{x})$ 是以 $a$ 为周期的，即 $u(\\mathbf{x}+\\mathbf{R}) = u(\\mathbf{x})$。为了找到 $u(\\mathbf{x})$ 的控制方程，我们将此拟设代入原始的偏微分方程。$p$ 的梯度是：\n$$\n\\nabla p = \\nabla(u \\exp(i \\mathbf{k} \\cdot \\mathbf{x})) = (\\nabla u) \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) + u (i\\mathbf{k}) \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) = (\\nabla u + i\\mathbf{k}u) \\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\n我们定义算子 $\\nabla_{\\mathbf{k}} \\equiv \\nabla + i\\mathbf{k}$。那么 $\\nabla p = (\\nabla_{\\mathbf{k}} u) \\exp(i \\mathbf{k} \\cdot \\mathbf{x})$。应用散度算子：\n$$\n\\nabla \\cdot \\left( \\frac{1}{\\rho} \\nabla p \\right) = \\nabla \\cdot \\left( \\frac{1}{\\rho} (\\nabla_{\\mathbf{k}} u) \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) \\right) = (\\nabla_{\\mathbf{k}} \\cdot (\\frac{1}{\\rho} \\nabla_{\\mathbf{k}} u)) \\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\n将此代入控制方程并消去非零因子 $\\exp(i \\mathbf{k} \\cdot \\mathbf{x})$，得到 $u(\\mathbf{x})$ 的偏微分方程：\n$$\n\\nabla_{\\mathbf{k}} \\cdot \\left( \\frac{1}{\\rho} \\nabla_{\\mathbf{k}} u \\right) + \\frac{\\omega^2}{K} u = 0\n$$\n为了获得弱形式，我们乘以一个周期性测试函数 $\\bar{v}(\\mathbf{x})$（其中 $v(\\mathbf{x})$ 与 $u(\\mathbf{x})$ 属于相同的函数空间），并在晶胞 $\\Omega$ 上积分：\n$$\n\\int_{\\Omega} \\bar{v} \\left( \\nabla_{\\mathbf{k}} \\cdot \\left( \\frac{1}{\\rho} \\nabla_{\\mathbf{k}} u \\right) \\right) d\\mathbf{x} + \\omega^2 \\int_{\\Omega} \\frac{1}{K} \\bar{v} u \\, d\\mathbf{x} = 0\n$$\n我们对第一项应用分部积分（格林第一恒等式）。令 $\\mathbf{F} = \\frac{1}{\\rho} \\nabla_{\\mathbf{k}} u$。那么 $\\int_{\\Omega} \\bar{v} (\\nabla_{\\mathbf{k}} \\cdot \\mathbf{F}) d\\mathbf{x} = \\int_{\\Omega} \\bar{v} (\\nabla \\cdot \\mathbf{F} + i\\mathbf{k} \\cdot \\mathbf{F}) d\\mathbf{x}$。\n$$\n\\int_{\\Omega} \\bar{v} (\\nabla \\cdot \\mathbf{F}) d\\mathbf{x} = -\\int_{\\Omega} (\\nabla \\bar{v}) \\cdot \\mathbf{F} \\, d\\mathbf{x} + \\oint_{\\partial \\Omega} \\bar{v} (\\mathbf{F} \\cdot \\mathbf{n}) \\, dS\n$$\n边界积分 $\\oint_{\\partial \\Omega}$ 为零。这是因为被积函数 $\\bar{v} \\frac{1}{\\rho} (\\nabla_{\\mathbf{k}} u) \\cdot \\mathbf{n}$ 在相对面上是周期性的（因为 $v$, $\\rho$, 和 $u$ 都是周期性的），而外法向矢量 $\\mathbf{n}$ 的方向相反（例如，$\\mathbf{n}|_{x=a} = -\\mathbf{n}|_{x=0}$）。\n因此，弱形式变为：\n$$\n-\\int_{\\Omega} (\\nabla \\bar{v}) \\cdot (\\frac{1}{\\rho} \\nabla_{\\mathbf{k}} u) d\\mathbf{x} + \\int_{\\Omega} \\bar{v} (i\\mathbf{k}) \\cdot (\\frac{1}{\\rho} \\nabla_{\\mathbf{k}} u) d\\mathbf{x} + \\omega^2 \\int_{\\Omega} \\frac{1}{K} \\bar{v} u \\, d\\mathbf{x} = 0\n$$\n合并前两项：\n$$\n-\\int_{\\Omega} (\\nabla \\bar{v} - i\\mathbf{k} \\bar{v}) \\cdot (\\frac{1}{\\rho} (\\nabla u + i\\mathbf{k} u)) d\\mathbf{x} + \\omega^2 \\int_{\\Omega} \\frac{1}{K} \\bar{v} u \\, d\\mathbf{x} = 0\n$$\n使用性质 $\\nabla \\bar{v} - i\\mathbf{k} \\bar{v} = \\overline{\\nabla v + i\\mathbf{k} v} = \\overline{\\nabla_{\\mathbf{k}} v}$，我们将方程重排为标准形式 $a(u,v) = \\lambda b(u,v)$:\n$$\n\\int_{\\Omega} \\frac{1}{\\rho(\\mathbf{x})} \\overline{(\\nabla_{\\mathbf{k}} v)} \\cdot (\\nabla_{\\mathbf{k}} u) \\, d\\mathbf{x} = \\omega^2 \\int_{\\Omega} \\frac{1}{K(\\mathbf{x})} \\bar{v} u \\, d\\mathbf{x}\n$$\n这是一个关于特征对 $(\\omega^2, u)$ 的变分问题。在使用有限元方法进行离散化时，将 $u$ 和 $v$ 在一组形函数 $\\{N_j(\\mathbf{x})\\}$ 基上展开，该方程将产生一个广义矩阵特征问题 $\\mathbf{K}(\\mathbf{k}) \\mathbf{u} = \\omega^2 \\mathbf{M} \\mathbf{u}$。这些矩阵由半双线性形式定义：\n刚度矩阵 $\\mathbf{K}(\\mathbf{k})$ 从以下形式导出：\n$$\na(u,v) = \\int_{\\Omega} \\frac{1}{\\rho(\\mathbf{x})} \\overline{(\\nabla v + i\\mathbf{k} v)} \\cdot (\\nabla u + i\\mathbf{k} u) \\, d\\mathbf{x}\n$$\n质量矩阵 $\\mathbf{M}$ 从以下形式导出：\n$$\nb(u,v) = \\int_{\\Omega} \\frac{1}{K(\\mathbf{x})} \\bar{v} u \\, d\\mathbf{x}\n$$\n$a(u,v)$ 和 $b(u,v)$ 两种形式都是厄米共轭的（即 $a(u,v) = \\overline{a(v,u)}$），因此得到的矩阵 $\\mathbf{K}(\\mathbf{k})$ 和 $\\mathbf{M}$ 也是厄米矩阵。这保证了特征值 $\\omega^2$ 是实数。\n\n第三，我们推导均匀基准情况下的色散关系，其中 $\\rho(\\mathbf{x}) \\equiv \\rho_0$ 且 $K(\\mathbf{x}) \\equiv K_0$。控制方程简化为标准亥姆霍兹方程：\n$$\n\\nabla \\cdot \\left( \\frac{1}{\\rho_0} \\nabla p \\right) + \\omega^{2} \\frac{1}{K_0} p = 0 \\quad \\implies \\quad \\nabla^2 p + \\frac{\\omega^2 \\rho_0}{K_0} p = 0\n$$\n我们定义均匀介质中的声速为 $c_0 = \\sqrt{K_0 / \\rho_0}$。方程变为：\n$$\n\\nabla^2 p + \\frac{\\omega^2}{c_0^2} p = 0\n$$\n问题要求考虑截断至“单个基频布洛赫谐波”的展开。在均匀介质中，一个精确解是单个平面波。这对应于布洛赫拟设 $p(\\mathbf{x}) = u(\\mathbf{x})\\exp(i\\mathbf{k}\\cdot\\mathbf{x})$，其中周期部分 $u(\\mathbf{x})$ 是一个常数，即 $u(\\mathbf{x})=u_0$。因此，我们寻求以下形式的解：\n$$\np(\\mathbf{x}) = u_0 \\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\n其中 $\\mathbf{k} = (k_x, k_y)$ 是波矢。我们将此拟设代入均匀亥姆霍兹方程：\n$$\n\\nabla^2 (u_0 \\exp(i \\mathbf{k} \\cdot \\mathbf{x})) + \\frac{\\omega^2}{c_0^2} (u_0 \\exp(i \\mathbf{k} \\cdot \\mathbf{x})) = 0\n$$\n计算拉普拉斯算子：\n$$\n\\nabla (u_0 \\exp(i \\mathbf{k} \\cdot \\mathbf{x})) = u_0 (i \\mathbf{k}) \\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\n$$\n\\nabla^2 (u_0 \\exp(i \\mathbf{k} \\cdot \\mathbf{x})) = \\nabla \\cdot (u_0 (i \\mathbf{k}) \\exp(i \\mathbf{k} \\cdot \\mathbf{x})) = u_0 (i \\mathbf{k}) \\cdot (i \\mathbf{k}) \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) = - |\\mathbf{k}|^2 u_0 \\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\n将此代回，我们得到：\n$$\n- |\\mathbf{k}|^2 u_0 \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) + \\frac{\\omega^2}{c_0^2} u_0 \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) = 0\n$$\n对于非平凡解（$u_0 \\neq 0$），我们可以消去公因子以获得色散关系：\n$$\n- |\\mathbf{k}|^2 + \\frac{\\omega^2}{c_0^2} = 0\n$$\n求解角频率 $\\omega$（并取有物理意义的正根）：\n$$\n\\omega^2 = c_0^2 |\\mathbf{k}|^2 \\implies \\omega(\\mathbf{k}) = c_0 |\\mathbf{k}|\n$$\n代入 $c_0 = \\sqrt{K_0 / \\rho_0}$ 和 $|\\mathbf{k}| = \\sqrt{k_x^2 + k_y^2}$，我们获得最低支色散关系的闭式表达式：\n$$\n\\omega(k_x, k_y) = \\sqrt{\\frac{K_0}{\\rho_0}} \\sqrt{k_x^2 + k_y^2}\n$$",
            "answer": "$$\\boxed{\\sqrt{\\frac{K_{0}}{\\rho_{0}}(k_{x}^{2} + k_{y}^{2})}}$$"
        },
        {
            "introduction": "许多声学器件，如声学透镜、消声器或隐身斗篷，都工作在开放的无界环境中。为了在有限的计算域内准确模拟这些问题，必须使用有效的无反射边界条件，而完美匹配层（PML）是当前最先进的技术。本实践提供了一个完整的计算任务：您将实现一个带有PML的有限差分求解器，并设计一套度量标准来量化其性能，这是一项为声学散射设备的拓扑优化建立可靠仿真环境所必需的工程技能。",
            "id": "4148056",
            "problem": "要求您为一个二维频域声散射问题构建一个定量测试，用于检测由完美匹配层（PML）引起的伪反射，并将这些反射与一个和拓扑优化相关的性能目标的大小联系起来。其物理和数学背景如下。从线性声学的控制关系出发：可压缩流体的质量和动量守恒导出了关于声压场 $p(\\mathbf{x},t)$ 的声波方程。在使用 $e^{-i \\omega t}$ 约定的情况下，对于角频率为 $\\omega$ 的时谐激励，压力场满足形式为 $\\nabla^{2} p + k^{2} p = s$ 的非齐次亥姆霍兹方程，其中 $k=\\omega/c$ 是波数，$c$ 是声速。对于密度 $\\rho$ 和体积模量 $K$ 恒定的均匀介质，我们有 $c=\\sqrt{K/\\rho}$。对于没有体声源的均匀区域，$s=0$；而在存在PML的情况下，算子变为复坐标伸展形式。在一个具有单轴复坐标伸展的计算域中，定义 $s_{x}(\\mathbf{x}) = 1 + i \\sigma_{x}(\\mathbf{x})/\\omega$ 和 $s_{y}(\\mathbf{x}) = 1 + i \\sigma_{y}(\\mathbf{x})/\\omega$，其中 $\\sigma_{x}$ 和 $\\sigma_{y}$ 是非负阻尼剖面，它们在物理区域内为零，在PML区域内以多项式形式增长。变换后的标量亥姆霍兹算子由 $\\nabla \\cdot \\left( \\mathbf{A} \\nabla p \\right) + k^{2} b p = 0$ 给出，其中 $\\mathbf{A}=\\mathrm{diag}(a_{x},a_{y})$，$a_{x}=1/s_{x}$，$a_{y}=1/s_{y}$，并且 $b = s_{x} s_{y}$。考虑一个尺寸为 $L_{x} \\times L_{y}$ 的矩形计算域，该区域在结构化网格上通过有限差分（FD）格式进行离散化，所有侧面均设有PML层。计算域的最外层边界设置为齐次狄利克雷条件，即 $p=0$。一个单位振幅的平面波 $p_{\\mathrm{inc}}(x,y)=e^{i k x}$ 通过与左侧PML内边界重合的内部狄利克雷线注入，使得域的剩余内部成为发生散射的“物理区域”。一个压力释放障碍物（软散射体）通过物理区域内的一个矩形子区域进行建模，在该区域强制施加 $p=0$。流体参数为 $\\rho=1.225$ kg/m$^{3}$ 和 $c=343$ m/s。使用 $f=3000$ Hz，因此 $\\omega=2\\pi f$ rad/s 且 $k=\\omega/c$ m$^{-1}$。该平面波在 $y$ 方向上是均匀的。\n\n您的任务是实现 $\\nabla \\cdot \\left( \\mathbf{A} \\nabla p \\right) + k^{2} b p = 0$ 在整个域上的FD离散化，包括由PML伸展定义所产生的空间变化的 $a_{x}$、$a_{y}$ 和 $b$。使用具有可变系数的二阶相容离散散度，即对 $\\partial/\\partial x \\left( a_{x} \\partial p/\\partial x \\right)$ 和 $\\partial/\\partial y \\left( a_{y} \\partial p/\\partial y \\right)$ 使用有限差分，并在界面处使用半网格点上平均的 $a$ 值。在左侧PML的内边界处，对入射场 $p_{\\mathrm{inc}}$ 施加内部狄利克雷线条件；在外边界处施加 $p=0$；在障碍物区域施加 $p=0$。求解复压力场 $p(x,y)$。\n\n使用时谐场的线性化动量关系定义时均声强矢量 $\\mathbf{J}$，其中质点速度为 $ \\mathbf{v} = \\nabla p/(i \\omega \\rho)$。时均声强为 $\\mathbf{J} = \\frac{1}{2} \\mathrm{Re}\\left( p \\mathbf{v}^{*} \\right)$。证明这可以得到 $\\mathbf{J} = \\frac{1}{2 \\omega \\rho} \\mathrm{Im}\\left( p^{*} \\nabla p \\right)$。为了量化物理区域和右侧PML之间右侧界面上的伪PML反射，测量在右侧PML内边界处穿过一条垂直线的声强法向分量 $J_{n}$（法线指向PML内部，即沿 $+\\hat{x}$ 方向）。使用跨越界面的前向差分计算 $\\partial p/\\partial x$，计算 $J_{n}(y)=\\frac{1}{2 \\omega \\rho} \\mathrm{Im}\\left( p^{*}(x_{0},y) \\, \\partial p/\\partial x \\right)$，其中 $x_{0}$ 是界面位置。将目标大小 $O$ 定义为通过该界面流入右侧PML的向外功率，$O=\\int \\max(J_{n}(y),0) \\, dy$。将伪反射大小 $R$ 定义为通过同一界面从PML返回到物理区域的向内功率，$R=\\int \\max(-J_{n}(y),0) \\, dy$。反射-目标比为 $r=R/\\max(O,\\varepsilon)$，其中 $\\varepsilon$ 是一个小的正数，仅用于防止除以零，并应选择得使其不影响 $O$ 非零的情况。\n\n您必须为三种PML配置实现此求解器和度量标准。计算域尺寸为 $L_{x}=0.6$ m 和 $L_{y}=0.4$ m，由 $x$ 方向的 $n_{x}=80$ 个点和 $y$ 方向的 $n_{y}=60$ 个点进行离散化。障碍物是一个以 $(x_{0},y_{0})=(0.35,0.20)$ m 为中心的压力释放矩形，宽度为 $0.10$ m，高度为 $0.08$ m。左、右、上、下PML的厚度（以网格单元计）均相同，其阻尼剖面 $\\sigma_{x}$、$\\sigma_{y}$ 遵循一个 $m$ 阶多项式，并缩放到最大值 $\\sigma_{\\max}$。设三组测试参数集为：\n- 测试1：PML厚度 $12$ 个单元，$\\sigma_{\\max}=80000$ s$^{-1}$，多项式阶数 $3$。\n- 测试2：PML厚度 $8$ 个单元，$\\sigma_{\\max}=30000$ s$^{-1}$，多项式阶数 $2$。\n- 测试3：PML厚度 $4$ 个单元，$\\sigma_{\\max}=10000$ s$^{-1}$，多项式阶数 $1$。\n对于每个测试，计算所定义的比率 $r$。在声学设备的拓扑优化背景下，可接受的反射-目标比取决于设计阶段和灵敏度；作为“严格”、“中等”和“宽松”接受标准的指导，分别使用 $10^{-3}$、$10^{-2}$ 和 $5\\times 10^{-2}$ 的阈值。您无需输出通过/失败的布尔值；您必须输出计算出的比率。\n\n所有量均采用国际单位制（SI）：长度单位为m，频率单位为Hz，角频率单位为rad/s，密度单位为kg/m$^{3}$，压力单位为Pa。最终输出为无量纲比率。您的程序必须生成单行输出，其中包含三个测试的比率，形式为逗号分隔的列表并用方括号括起，例如 $[r_{1},r_{2},r_{3}]$，其中每个 $r_{i}$ 是一个浮点数。答案应是具有此确切格式的单行。没有用户输入。您的实现必须是自包含且可复现的。\n\n测试套件和答案规范：\n- 程序应运行上述指定的三个测试，并将其 $r$ 值作为浮点数返回。最终输出必须是格式为 $[r_{1},r_{2},r_{3}]$ 的单行。\n- 这些测试共同考察了：具有厚且强PML的“理想情况”（测试1），一个中间情况（测试2），以及具有薄且弱PML的边缘情况（测试3）。\n- 输出是三个浮点数 $r_{1}$、$r_{2}$ 和 $r_{3}$，对应于每个测试的反射-目标比。",
            "solution": "用户提供的问题被评估为有效。这是一个在计算声学领域有科学依据、适定且客观的问题。它提供了一套完整且一致的给定条件，包括控制方程、物理常数、域几何形状、离散化参数、边界条件以及性能指标的定义。任务是实现一个数值求解器并为一组测试用例计算特定的定量结果，这是科学计算中的一个标准流程。该问题可以使用已有的数值方法直接解决。\n\n解决方案的开发遵循问题陈述中概述的步骤。问题的核心是在一个包含散射障碍物的二维域中，求解经完美匹配层（PML）修正的时谐声波方程。\n\n控制方程是针对复压力场 $p(\\mathbf{x})$ 的修正亥姆霍兹方程：\n$$ \\nabla \\cdot \\left( \\mathbf{A}(\\mathbf{x}) \\nabla p(\\mathbf{x}) \\right) + k^{2} b(\\mathbf{x}) p(\\mathbf{x}) = 0 $$\n其中 $k = \\omega/c$ 是波数，$\\omega = 2\\pi f$。空间变化的系数 $\\mathbf{A}(\\mathbf{x})$ 和 $b(\\mathbf{x})$ 用于实现PML。它们通过复伸展因子 $s_{x}(\\mathbf{x}) = 1 + i \\sigma_{x}(\\mathbf{x})/\\omega$ 和 $s_{y}(\\mathbf{x}) = 1 + i \\sigma_{y}(\\mathbf{x})/\\omega$ 来定义。阻尼剖面 $\\sigma_{x}$ 和 $\\sigma_{y}$ 仅在PML区域内非零。系数矩阵为 $\\mathbf{A}=\\mathrm{diag}(a_{x},a_{y})$，其中 $a_{x}=1/s_{x}$ 和 $a_{y}=1/s_{y}$，标量系数为 $b = s_x s_y$。问题陈述中的公式是一种有效的复坐标伸展形式，实现将严格遵循所提供的定义。\n\n尺寸为 $L_x \\times L_y$ 的计算域被离散化为一个 $n_x \\times n_y$ 点的均匀网格，网格间距为 $\\Delta x = L_x / (n_x - 1)$ 和 $\\Delta y = L_y / (n_y - 1)$。在每个网格点 $(i,j)$ 处，压力表示为 $p_{i,j}$。控制偏微分方程使用二阶有限差分格式进行近似。散度项 $\\nabla \\cdot (\\mathbf{A} \\nabla p)$ 被离散化为：\n$$ \\frac{1}{\\Delta x^2} \\left[ a_{x,i+1/2,j}(p_{i+1,j} - p_{i,j}) - a_{x,i-1/2,j}(p_{i,j} - p_{i-1,j}) \\right] + \\\\ \\frac{1}{\\Delta y^2} \\left[ a_{y,i,j+1/2}(p_{i,j+1} - p_{i,j}) - a_{y,i,j-1/2}(p_{i,j} - p_{i,j-1}) \\right] $$\n其中半网格点上的系数被平均，例如，$a_{x,i+1/2,j} = (a_{x,i+1,j} + a_{x,i,j})/2$。\n将此离散化应用于每个不受狄利克雷边界条件约束的网格点，会得到一个线性方程组。该系统可以写成矩阵形式 $\\mathbf{M}\\mathbf{p} = \\mathbf{s}$，其中 $\\mathbf{p}$ 是未知复压力值 $p_{i,j}$ 的一维向量，$\\mathbf{M}$ 是一个大型、稀疏、复数值的系数矩阵，$\\mathbf{s}$ 是由边界条件决定的源向量。\n\n边界条件的强制施加方式如下：\n1.  齐次狄利克雷条件（$p=0$）：对于计算域外边界和软散射体内部的网格点，矩阵 $\\mathbf{M}$ 中对应的行设置为主对角线上为1、其余为0的单位行，源向量 $\\mathbf{s}$ 中对应的元素设置为0。\n2.  内部源线：一个平面波 $p_{\\mathrm{inc}}(x,y)=e^{i k x}$ 沿着左侧PML内表面的垂直线注入。对于该线上的网格点，施加狄利克雷条件：$p = e^{i k x_{src}}$。这通过类似的方式实现，即在 $\\mathbf{M}$ 中设置单位行，并在 $\\mathbf{s}$ 中设置来自 $p_{\\mathrm{inc}}$ 的相应值。\n\nPML阻尼剖面 $\\sigma_x$ 和 $\\sigma_y$ 基于指定的厚度 $N_{pml}$（以单元格计）、最大阻尼 $\\sigma_{\\max}$ 和多项式阶数 $m$ 来构建。对于PML内部相对距离为 $\\eta \\in [0, 1]$ 的点（其中 $\\eta=0$ 在物理区域-PML界面处，$\\eta=1$ 在外边界处），阻尼为 $\\sigma = \\sigma_{\\max} \\eta^m$。\n\n在构建矩阵 $\\mathbf{M}$ 和向量 $\\mathbf{s}$ 之后，求解该线性系统以获得复压力场 $\\mathbf{p}$，然后将其重塑为二维数组。\n\n为了量化PML性能，计算时均声强 $\\mathbf{J} = \\frac{1}{2 \\omega \\rho} \\mathrm{Im}\\left( p^{*} \\nabla p \\right)$。具体来说，沿物理域和右侧PML之间的界面评估其法向分量 $J_n$。梯度 $\\partial p/\\partial x$ 使用前向有限差分进行近似。\n目标功率 $O$ 和伪反射功率 $R$ 定义为跨此界面的积分：\n$$ O=\\int \\max(J_{n}(y),0) \\, dy \\quad \\text{和} \\quad R=\\int \\max(-J_{n}(y),0) \\, dy $$\n这些积分通过对界面上每个网格点的贡献求和进行数值近似，并按网格间距 $\\Delta y$ 加权。最终的度量标准是反射-目标比 $r = R / \\max(O, \\varepsilon)$，其中 $\\varepsilon$ 是一个小数以防止除以零。对三个指定的测试用例重复此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csc_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef run_simulation(Npml, sigma_max, m_order):\n    \"\"\"\n    Solves the 2D Helmholtz equation with PMLs and computes the reflection ratio.\n    \"\"\"\n    # 1. Physical and numerical parameters\n    rho = 1.225  # kg/m^3\n    c = 343.0  # m/s\n    f = 3000.0  # Hz\n    omega = 2 * np.pi * f  # rad/s\n    k_wavenum = omega / c  # 1/m\n\n    Lx, Ly = 0.6, 0.4  # m\n    nx, ny = 80, 60\n    dx = Lx / (nx - 1)\n    dy = Ly / (ny - 1)\n\n    x = np.linspace(0, Lx, nx)\n    y = np.linspace(0, Ly, ny)\n    X, Y = np.meshgrid(x, y, indexing='ij')\n\n    # 2. PML setup\n    sigma_x = np.zeros((nx, ny), dtype=float)\n    sigma_y = np.zeros((nx, ny), dtype=float)\n    \n    # Left PML\n    if Npml > 0:\n        rel_dist_x_left = np.arange(Npml - 1, -1, -1) / (Npml - 1) if Npml > 1 else np.array([1.0])\n        sigma_profile_x = sigma_max * (rel_dist_x_left ** m_order)\n        sigma_x[:Npml, :] = sigma_profile_x[:, np.newaxis]\n    # Right PML\n    if Npml > 0:\n        rel_dist_x_right = np.arange(0, Npml) / (Npml - 1) if Npml > 1 else np.array([1.0])\n        sigma_profile_x = sigma_max * (rel_dist_x_right ** m_order)\n        sigma_x[nx - Npml:, :] = sigma_profile_x[:, np.newaxis]\n\n    # Bottom PML\n    if Npml > 0:\n        rel_dist_y_bottom = np.arange(Npml - 1, -1, -1) / (Npml - 1) if Npml > 1 else np.array([1.0])\n        sigma_profile_y = sigma_max * (rel_dist_y_bottom ** m_order)\n        sigma_y[:, :Npml] = sigma_profile_y[np.newaxis, :]\n    # Top PML\n    if Npml > 0:\n        rel_dist_y_top = np.arange(0, Npml) / (Npml - 1) if Npml > 1 else np.array([1.0])\n        sigma_profile_y = sigma_max * (rel_dist_y_top ** m_order)\n        sigma_y[:, ny - Npml:] = sigma_profile_y[np.newaxis, :]\n        \n    s_x = 1 + 1j * sigma_x / omega\n    s_y = 1 + 1j * sigma_y / omega\n\n    a_x = 1 / s_x\n    a_y = 1 / s_y\n    b = s_x * s_y\n\n    # 3. System matrix and source vector assembly\n    N_total = nx * ny\n    M = lil_matrix((N_total, N_total), dtype=complex)\n    S = np.zeros(N_total, dtype=complex)\n\n    # Obstacle mask\n    obs_x_min, obs_x_max = 0.3, 0.4\n    obs_y_min, obs_y_max = 0.16, 0.24\n    obstacle_mask = (X >= obs_x_min)  (X = obs_x_max)  \\\n                    (Y >= obs_y_min)  (Y = obs_y_max)\n\n    for i in range(nx):\n        for j in range(ny):\n            k = i + j * nx\n\n            # Boundary conditions\n            is_outer_boundary = (i == 0) or (i == nx - 1) or (j == 0) or (j == ny - 1)\n            is_obstacle = obstacle_mask[i, j]\n            is_source_line = (i == Npml) and not (is_outer_boundary or is_obstacle)\n\n            if is_outer_boundary or is_obstacle:\n                M[k, k] = 1.0\n                S[k] = 0.0\n            elif is_source_line:\n                M[k, k] = 1.0\n                S[k] = np.exp(1j * k_wavenum * x[i])\n            else:  # Interior points\n                # x-derivatives\n                ax_iph = 0.5 * (a_x[i + 1, j] + a_x[i, j])\n                ax_imh = 0.5 * (a_x[i, j] + a_x[i - 1, j])\n                \n                # y-derivatives\n                ay_jph = 0.5 * (a_y[i, j + 1] + a_y[i, j])\n                ay_jmh = 0.5 * (a_y[i, j] + a_y[i, j - 1])\n\n                # Stencil coefficients\n                C_im1_j = ax_imh / dx**2\n                C_ip1_j = ax_iph / dx**2\n                C_i_jm1 = ay_jmh / dy**2\n                C_i_jp1 = ay_jph / dy**2\n                C_i_j = -(C_im1_j + C_ip1_j + C_i_jm1 + C_i_jp1) + k_wavenum**2 * b[i, j]\n\n                M[k, k - nx] = C_i_jm1 # Corrected index\n                M[k, k + nx] = C_i_jp1 # Corrected index\n                M[k, k - 1] = C_im1_j\n                M[k, k + 1] = C_ip1_j\n                M[k, k] = C_i_j\n    \n    # 4. Solve the linear system\n    M_csc = csc_matrix(M)\n    p_flat = spsolve(M_csc, S)\n    p = p_flat.reshape((ny, nx)).T # Reshape to (nx, ny)\n\n    # 5. Post-processing: Calculate reflection-to-objective ratio\n    interface_idx = nx - 1 - Npml\n    \n    # physical y-range (excluding top/bottom PMLs)\n    y_start_idx = Npml\n    y_end_idx = ny - Npml\n\n    # Normal component of intensity J_n = J_x\n    # Use forward difference for grad_p\n    grad_p_x = (p[interface_idx + 1, y_start_idx:y_end_idx] - p[interface_idx, y_start_idx:y_end_idx]) / dx\n    p_interface = p[interface_idx, y_start_idx:y_end_idx]\n    \n    Jn = (1 / (2 * omega * rho)) * np.imag(np.conj(p_interface) * grad_p_x)\n\n    # Integrate to get power O (outward) and R (reflected)\n    O = np.sum(np.maximum(Jn, 0)) * dy\n    R = np.sum(np.maximum(-Jn, 0)) * dy\n\n    # Epsilon to prevent division by zero\n    epsilon = 1e-18\n    r = R / max(O, epsilon)\n\n    return r\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (PML thickness cells, sigma_max, polynomial order)\n        (12, 80000, 3),\n        (8, 30000, 2),\n        (4, 10000, 1),\n    ]\n\n    results = []\n    for case in test_cases:\n        Npml, sigma_max, m_order = case\n        result = run_simulation(Npml, sigma_max, m_order)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}