{
    "hands_on_practices": [
        {
            "introduction": "This exercise introduces a fundamental concept in shape optimization: balancing a performance objective with a geometric regularizer. You will derive the shape derivative for a perimeter penalty term, which reveals the important role of boundary curvature in the evolution equation. This practice  is crucial for understanding how to formulate well-posed optimization problems that avoid overly complex or oscillatory shapes.",
            "id": "4136382",
            "problem": "Consider a two-dimensional bounded domain $\\Omega \\subset \\mathbb{R}^{2}$ with smooth boundary $\\partial \\Omega$, representing an acoustically soft inclusion in a homogeneous host medium in a time-harmonic setting. The acoustic pressure field $p$ satisfies a well-posed forward Helmholtz boundary value problem in $\\Omega$, with physically reasonable boundary conditions on $\\partial \\Omega$ and a given time-harmonic source, so that standard shape-differential tools apply. Let the design objective be the sum of a boundary data misfit and a perimeter (boundary length) regularization,\n$$\nJ(\\Omega) \\;=\\; \\frac{1}{2}\\int_{\\Gamma_{o}} |p - p_{d}|^{2}\\, ds \\;+\\; \\lambda\\, R(\\Omega),\n$$\nwhere $\\Gamma_{o} \\subset \\partial \\Omega$ is a fixed observation arc, $p_{d}$ is a prescribed target field on $\\Gamma_{o}$, $\\lambda > 0$ is a fixed regularization weight, and\n$$\nR(\\Omega) \\;=\\; \\int_{\\partial \\Omega} 1 \\, ds\n$$\nis the perimeter penalty.\n\nYou are told that the first-order shape derivative of the misfit term admits a Hadamard boundary representation with a scalar density $g:\\partial \\Omega \\to \\mathbb{R}$ obtained from the state and the adjoint fields through the standard adjoint method in computational acoustics, namely\n$$\n\\delta \\left(\\frac{1}{2}\\int_{\\Gamma_{o}} |p - p_{d}|^{2}\\, ds\\right)[V] \\;=\\; \\int_{\\partial \\Omega} g \\, (V \\cdot n) \\, ds,\n$$\nfor any sufficiently smooth deformation velocity field $V:\\mathbb{R}^{2} \\to \\mathbb{R}^{2}$, where $n$ is the outward unit normal on $\\partial \\Omega$. Assume throughout that all fields are smooth enough so that the classical shape calculus identities hold, and that the signed scalar curvature $\\kappa$ of $\\partial \\Omega$ is defined with respect to the outward normal $n$.\n\nTasks:\n- Starting from fundamental transport identities for surface measures and the first variation of arclength for smooth moving curves, compute the first-order shape derivative $\\delta R(\\Omega)[V]$ in terms of the normal velocity $V \\cdot n$ and the boundary curvature $\\kappa$.\n- Then combine this with the Hadamard form of the acoustic misfit derivative to obtain the full first-order shape derivative of $J(\\Omega)$.\n- Finally, consider a steepest-descent update in a boundary $L^{2}$-metric preconditioned by a positive constant $\\eta0$, namely one that selects the normal boundary velocity $V \\cdot n$ to be the negative Riesz representer of the shape gradient in the inner product $\\langle \\phi, \\psi \\rangle = \\int_{\\partial \\Omega} \\eta \\, \\phi \\, \\psi \\, ds$. Derive the resulting expression for $V \\cdot n$ on $\\partial \\Omega$ in terms of $g$, $\\lambda$, and $\\kappa$.\n\nProvide the final expression for $V \\cdot n(x)$ on $\\partial \\Omega$ as your answer. No numerical evaluation is required. The answer must be a single closed-form analytic expression with no units.",
            "solution": "The problem asks for the derivation of the steepest-descent update for the normal boundary velocity, denoted $v_n(x) = V(x) \\cdot n(x)$ for $x \\in \\partial \\Omega$, for a shape optimization problem in computational acoustics. The update is defined with respect to a specific preconditioned inner product on the boundary.\n\nThe objective functional to be minimized is given by\n$$\nJ(\\Omega) \\;=\\; \\frac{1}{2}\\int_{\\Gamma_{o}} |p - p_{d}|^{2}\\, ds \\;+\\; \\lambda\\, R(\\Omega)\n$$\nwhere $R(\\Omega) = \\int_{\\partial \\Omega} 1 \\, ds$ is the perimeter of the domain $\\Omega$. The constant $\\lambda  0$ is a regularization parameter.\n\nThe first-order shape derivative of $J(\\Omega)$ with respect to a velocity field $V$ is obtained through the sum of the derivatives of its two constituent terms, due to the linearity of the differentiation operator $\\delta$:\n$$\n\\delta J(\\Omega)[V] = \\delta \\left(\\frac{1}{2}\\int_{\\Gamma_{o}} |p - p_{d}|^{2}\\, ds\\right)[V] + \\lambda \\, \\delta R(\\Omega)[V]\n$$\n\nThe problem statement provides the shape derivative of the first term, the data misfit, in its Hadamard boundary representation:\n$$\n\\delta \\left(\\frac{1}{2}\\int_{\\Gamma_{o}} |p - p_{d}|^{2}\\, ds\\right)[V] = \\int_{\\partial \\Omega} g \\, (V \\cdot n) \\, ds\n$$\nwhere $g$ is a scalar function on the boundary $\\partial \\Omega$ derived from the state and adjoint solutions, and $V \\cdot n$ is the normal component of the velocity field $V$.\n\nThe next step is to compute the shape derivative of the second term, the perimeter regularization $R(\\Omega)$. The perimeter is defined as $R(\\Omega) = \\int_{\\partial \\Omega} 1 \\, ds$. Its first variation, or shape derivative, is a standard result in differential geometry. The variation of the infinitesimal arclength element $ds$ under the flow of a velocity field $V$ is given by the transport identity $\\frac{d}{dt}(ds_t)|_{t=0} = (\\nabla_{\\partial \\Omega} \\cdot V) ds$, where $\\nabla_{\\partial \\Omega} \\cdot V$ is the tangential divergence of $V$ on the boundary $\\partial \\Omega$. For a curve in $\\mathbb{R}^2$, this divergence is related to the signed curvature $\\kappa$ and the normal velocity $V \\cdot n$ by the identity $\\nabla_{\\partial \\Omega} \\cdot V = \\kappa (V \\cdot n)$.\n\nUsing this identity, the shape derivative of the perimeter is:\n$$\n\\delta R(\\Omega)[V] = \\delta \\left(\\int_{\\partial \\Omega} 1 \\, ds\\right)[V] = \\int_{\\partial \\Omega} 1 \\cdot \\delta(ds)[V] = \\int_{\\partial \\Omega} \\kappa (V \\cdot n) \\, ds\n$$\n\nNow, we can combine the derivatives of both terms to obtain the total shape derivative of $J(\\Omega)$:\n$$\n\\delta J(\\Omega)[V] = \\int_{\\partial \\Omega} g \\, (V \\cdot n) \\, ds + \\lambda \\int_{\\partial \\Omega} \\kappa (V \\cdot n) \\, ds\n$$\nBy linearity of the integral, this simplifies to:\n$$\n\\delta J(\\Omega)[V] = \\int_{\\partial \\Omega} (g + \\lambda \\kappa) (V \\cdot n) \\, ds\n$$\nThis expression is the Hadamard form of the shape derivative for the total functional $J(\\Omega)$. The function $G_S = g + \\lambda \\kappa$ can be interpreted as the shape gradient with respect to the standard $L^2$ inner product on the boundary.\n\nThe problem, however, specifies a steepest-descent update based on a different metric. The normal velocity $V \\cdot n$ is to be chosen as the negative Riesz representer of the shape gradient in the Hilbert space of functions on $\\partial \\Omega$ equipped with the inner product:\n$$\n\\langle \\phi, \\psi \\rangle = \\int_{\\partial \\Omega} \\eta \\, \\phi \\, \\psi \\, ds\n$$\nwhere $\\eta  0$ is a given constant preconditioner.\n\nLet the normal velocity be denoted by $v_n = V \\cdot n$. The shape derivative is a linear functional of $v_n$, $L(v_n) = \\delta J(\\Omega)[V] = \\int_{\\partial \\Omega} (g + \\lambda \\kappa) v_n \\, ds$. According to the Riesz representation theorem, for this functional $L$, there exists a unique element in the Hilbert space, which we will call the gradient $\\mathcal{G}$, such that $L(v_n) = \\langle \\mathcal{G}, v_n \\rangle$ for all $v_n$ in the space.\n\nWe find $\\mathcal{G}$ by equating the two forms of the functional:\n$$\n\\int_{\\partial \\Omega} (g + \\lambda \\kappa) v_n \\, ds = \\langle \\mathcal{G}, v_n \\rangle = \\int_{\\partial \\Omega} \\eta \\, \\mathcal{G} \\, v_n \\, ds\n$$\nThis identity must hold for any choice of admissible normal velocity field $v_n$. By the fundamental lemma of calculus of variations, the integrands must be equal (almost everywhere) on $\\partial \\Omega$:\n$$\ng + \\lambda \\kappa = \\eta \\, \\mathcal{G}\n$$\nSolving for the gradient $\\mathcal{G}$ yields:\n$$\n\\mathcal{G} = \\frac{1}{\\eta}(g + \\lambda \\kappa)\n$$\nThis function $\\mathcal{G}$ is the Riesz representer of the shape derivative functional in the specified inner product, i.e., it is the shape gradient in the given metric.\n\nThe problem states that the steepest-descent update for the normal velocity $V \\cdot n$ is given by the negative of this Riesz representer. Therefore, we set $V \\cdot n = -\\mathcal{G}$.\nSubstituting the expression for $\\mathcal{G}$, we obtain the final expression for the normal velocity update:\n$$\nV \\cdot n = -\\frac{1}{\\eta}(g + \\lambda \\kappa)\n$$\nThis is the desired expression for the normal velocity field on the boundary $\\partial \\Omega$ as a function of the adjoint-based density $g$, the regularization weight $\\lambda$, the boundary curvature $\\kappa$, and the preconditioning constant $\\eta$.",
            "answer": "$$\n\\boxed{-\\frac{1}{\\eta}(g + \\lambda \\kappa)}\n$$"
        },
        {
            "introduction": "Moving from continuous theory to discrete implementation requires careful handling of algebraic structures, especially in complex-valued problems. This exercise  challenges you to identify the correct form of the discrete adjoint operator with respect to the $L^2$ inner product, which is represented by a mass matrix. Mastering this distinction is essential for writing correct and efficient finite element or boundary element code for adjoint-based optimization.",
            "id": "4136364",
            "problem": "Consider the time-harmonic acoustic pressure governed by the Helmholtz equation on a bounded Lipschitz domain $\\Omega \\subset \\mathbb{R}^d$ with outward unit normal $\\mathbf{n}$ and an impedance (Robin) boundary on $\\Gamma \\subset \\partial \\Omega$:\n$$\n-\\nabla \\cdot (\\nabla p) - k^2 p = f \\quad \\text{in } \\Omega, \\qquad\n\\frac{\\partial p}{\\partial \\mathbf{n}} + i k \\zeta\\, p = g \\quad \\text{on } \\Gamma,\n$$\nwhere $k  0$ is the wavenumber, $\\zeta  0$ is a real impedance parameter, $f$ and $g$ are complex-valued source terms, and $i$ denotes the imaginary unit. Let $V$ be a conforming finite-dimensional subspace of the complex-valued Sobolev space $H^1(\\Omega)$ with nodal basis $\\{\\varphi_j\\}_{j=1}^N$, and define the standard sesquilinear weak form $a(u,v)$ and right-hand side $\\ell(v)$ by\n$$\na(u,v) = \\int_{\\Omega} \\nabla u \\cdot \\overline{\\nabla v}\\, \\mathrm{d}\\Omega - \\int_{\\Omega} k^2 u\\, \\overline{v}\\, \\mathrm{d}\\Omega + \\int_{\\Gamma} i k \\zeta\\, u\\, \\overline{v}\\, \\mathrm{d}\\Gamma,\n$$\n$$\n\\ell(v) = \\int_{\\Omega} f\\, \\overline{v}\\, \\mathrm{d}\\Omega + \\int_{\\Gamma} g\\, \\overline{v}\\, \\mathrm{d}\\Gamma,\n$$\nwhere the overline denotes complex conjugation and the inner product on $L^2(\\Omega)$ is $(u,v)_{L^2(\\Omega)} = \\int_{\\Omega} u\\, \\overline{v}\\, \\mathrm{d}\\Omega$. The Galerkin discretization leads to the linear system $A x = b$ with entries $A_{ij} = a(\\varphi_j, \\varphi_i)$ and $b_i = \\ell(\\varphi_i)$. Let the discrete $L^2(\\Omega)$ inner product be represented by the symmetric positive-definite mass matrix $M$ with entries $M_{ij} = \\int_{\\Omega} \\varphi_j\\, \\overline{\\varphi_i}\\, \\mathrm{d}\\Omega$ (assembled using the same quadrature rules employed for $A$ where appropriate).\n\nYou are tasked with implementing the action of a discrete adjoint operator on a vector $y \\in \\mathbb{C}^N$ so that, for all $u,v \\in \\mathbb{C}^N$ representing coefficient vectors in the basis $\\{\\varphi_j\\}$, the adjoint consistency relation\n$$\n(Au, v)_M = (u, A^\\dagger v)_M\n$$\nholds, where $(u,v)_M = u^H M v$ and $^H$ denotes the Hermitian transpose. In addition, you must correctly handle complex arithmetic and conjugation originating from the boundary term $i k \\zeta\\, u\\, \\overline{v}$ and ensure that the discrete adjoint matches the continuous adjoint operator under appropriate quadrature.\n\nWhich option correctly describes how to compute $A^\\dagger y$ in code and how to handle complex coefficients and conjugation so that the discrete adjoint matches the continuous adjoint under the $L^2(\\Omega)$ inner product represented by $M$?\n\nA. Compute $A^H y$ directly using the conjugate transpose of $A$ with no additional weighting, and leave the impedance boundary coefficient $i k \\zeta$ unchanged because $k$ and $\\zeta$ are real; standard element-wise conjugation of basis functions is unnecessary.\n\nB. Compute $M^{-1} A^H M\\, y$ so that $(Au, v)_M = (u, M^{-1} A^H M v)_M$ holds. In assembling and interpreting $A^H$, apply complex conjugation consistently to all coefficients in the second argument of the sesquilinear form; in particular, the impedance term $i k \\zeta$ changes sign under adjoint due to the conjugation in the $L^2(\\Omega)$ inner product. Use the same quadrature rules for $A$ and $M$ to retain adjoint consistency.\n\nC. Compute $A^T y$ using the plain transpose because the wavenumber $k$ and impedance $\\zeta$ are real, and change the sign of the boundary term only if $\\zeta  0$; the mass matrix $M$ is not needed for the adjoint since the basis is orthogonal with respect to standard Euclidean inner product.\n\nD. Reassemble an adjoint matrix by swapping trial and test functions in each element integral without applying complex conjugation to coefficients or basis functions, then compute that matrix times $y$; quadrature choice does not affect adjoint consistency provided the primal matrix is assembled exactly.\n\nE. Compute $A^H y$ and post-multiply by the diagonal of $M$ (nodal lumped masses) to approximately account for the inner product, which is sufficient for matching the continuous adjoint of the Helmholtz operator under standard quadrature in practice.\n\nSelect the single best answer.",
            "solution": "The user requires a critical validation of the problem statement, followed by a detailed derivation of the solution and an evaluation of the provided options.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\nThe problem statement provides the following information:\n- **Governing Equation**: Time-harmonic acoustic pressure $p$ is governed by the Helmholtz equation in a bounded Lipschitz domain $\\Omega \\subset \\mathbb{R}^d$:\n$$-\\nabla \\cdot (\\nabla p) - k^2 p = f \\quad \\text{in } \\Omega$$\n- **Boundary Condition**: An impedance (Robin) boundary condition is specified on a part of the boundary $\\Gamma \\subset \\partial \\Omega$:\n$$\\frac{\\partial p}{\\partial \\mathbf{n}} + i k \\zeta\\, p = g \\quad \\text{on } \\Gamma$$\n- **Parameters and Functions**:\n    - $k  0$: Wavenumber (real).\n    - $\\zeta  0$: Impedance parameter (real).\n    - $f, g$: Complex-valued source terms.\n    - $i$: Imaginary unit, $i^2 = -1$.\n    - $\\mathbf{n}$: Outward unit normal vector to the boundary.\n- **Function Space**: The solution $p$ is sought in the complex-valued Sobolev space $H^1(\\Omega)$.\n- **Weak Formulation**:\n    - The sesquilinear form is defined as:\n    $$a(u,v) = \\int_{\\Omega} \\nabla u \\cdot \\overline{\\nabla v}\\, \\mathrm{d}\\Omega - \\int_{\\Omega} k^2 u\\, \\overline{v}\\, \\mathrm{d}\\Omega + \\int_{\\Gamma} i k \\zeta\\, u\\, \\overline{v}\\, \\mathrm{d}\\Gamma$$\n    - The linear form (right-hand side) is:\n    $$\\ell(v) = \\int_{\\Omega} f\\, \\overline{v}\\, \\mathrm{d}\\Omega + \\int_{\\Gamma} g\\, \\overline{v}\\, \\mathrm{d}\\Gamma$$\n    - The weak problem is to find $u \\in V$ such that $a(u,v) = \\ell(v)$ for all $v \\in V$, where $V \\subset H^1(\\Omega)$ is a finite-dimensional subspace.\n- **Discretization**:\n    - Nodal basis for $V$: $\\{\\varphi_j\\}_{j=1}^N$.\n    - The Galerkin discretization leads to the linear system $A x = b$.\n    - Matrix entries: $A_{ij} = a(\\varphi_j, \\varphi_i)$. Note the indices: $j$ for the trial function, $i$ for the test function.\n    - Right-hand side vector entries: $b_i = \\ell(\\varphi_i)$.\n- **Inner Products**:\n    - The continuous $L^2(\\Omega)$ inner product is $(u,v)_{L^2(\\Omega)} = \\int_{\\Omega} u\\, \\overline{v}\\, \\mathrm{d}\\Omega$.\n    - The mass matrix is defined by $M_{ij} = \\int_{\\Omega} \\varphi_j\\, \\overline{\\varphi_i}\\, \\mathrm{d}\\Omega$. It is stated to be symmetric positive-definite.\n    - The discrete inner product on the coefficient space $\\mathbb{C}^N$ is defined as $(u,v)_M = u^H M v$, where $^H$ denotes the Hermitian transpose (conjugate transpose).\n- **Task**:\n    - Find the correct procedure to compute the action of the discrete adjoint operator $A^\\dagger$ on a vector $y \\in \\mathbb{C}^N$.\n    - The discrete adjoint $A^\\dagger$ must satisfy the adjoint consistency relation:\n    $$(Au, v)_M = (u, A^\\dagger v)_M \\quad \\text{for all } u, v \\in \\mathbb{C}^N$$\n    - The implementation must correctly handle complex arithmetic and match the continuous adjoint operator.\n\n**Step 2: Validate Using Extracted Givens**\n\n- **Scientifically Grounded**: The problem is well-grounded in the theory of finite element methods (FEM) for solving partial differential equations, specifically the Helmholtz equation in computational acoustics. The weak formulation, Galerkin discretization, and the concept of a discrete adjoint operator are standard and fundamental in this field.\n- **Well-Posed**: The question is to find an expression for the operator $A^\\dagger$ defined by the algebraic relation $(Au, v)_M = (u, A^\\dagger v)_M$. This is a well-posed mathematical question with a unique answer.\n- **Objective**: The problem is stated using precise mathematical language and definitions, free of any subjectivity.\n- **Flaw Checklist**:\n    1.  **Scientific/Factual Unsoundness**: None. The mathematical and physical setup is standard. The definition of the mass matrix $M_{ij} = \\int_{\\Omega} \\varphi_j \\overline{\\varphi_i} \\mathrm{d}\\Omega$ implies that $M$ is a Hermitian matrix ($M_{ji} = \\int \\varphi_i \\overline{\\varphi_j} \\mathrm{d}\\Omega = \\overline{M_{ij}}$, so $M^H = M$). The problem states $M$ is symmetric positive-definite. For real-valued basis functions, Hermitian and symmetric are equivalent. Let's assume the problem's use of \"symmetric\" means Hermitian in this complex context, which is common.\n    2.  **Non-Formalizable/Irrelevant**: The problem is formal and directly relevant to the topic of adjoint methods in computational science.\n    3.  **Incomplete/Contradictory Setup**: The setup is complete and self-consistent. All terms are defined.\n    4.  **Unrealistic/Infeasible**: The setup represents a standard, realistic computational problem.\n    5.  **Ill-Posed/Poorly Structured**: The question is clearly structured and leads to a unique derivation.\n    6.  **Pseudo-Profound/Trivial**: The problem is not trivial. It tests the crucial distinction between the Hermitian transpose $A^H$ (the adjoint with respect to the Euclidean inner product) and the adjoint $A^\\dagger$ with respect to a weighted inner product defined by the mass matrix $M$. This is a common source of error in practical implementations.\n    7.  **Outside Scientific Verifiability**: The question is fully verifiable through mathematical derivation.\n\n**Step 3: Verdict and Action**\n\nThe problem statement is **valid**. The solution process will now proceed.\n\n### Derivation of the Discrete Adjoint Operator\n\nThe core task is to find the operator $A^\\dagger$ that satisfies the relation $(Au, v)_M = (u, A^\\dagger v)_M$ for all coefficient vectors $u, v \\in \\mathbb{C}^N$. The inner product is defined as $(x, y)_M = x^H M y$.\n\nLet's expand both sides of the adjoint consistency relation:\n1.  **Left-Hand Side (LHS)**:\n    $$(Au, v)_M = (Au)^H M v$$\n    Using the property of the Hermitian transpose $(AB)^H = B^H A^H$, we get:\n    $$(Au)^H M v = u^H A^H M v$$\n\n2.  **Right-Hand Side (RHS)**:\n    $$(u, A^\\dagger v)_M = u^H M (A^\\dagger v)$$\n\n3.  **Equating LHS and RHS**:\n    For the adjoint relation to hold for all vectors $u \\in \\mathbb{C}^N$, the expressions multiplying $u^H$ on the left must be equal:\n    $$u^H (A^H M v) = u^H (M A^\\dagger v)$$\n    This implies:\n    $$A^H M v = M (A^\\dagger v)$$\n\n4.  **Solving for $A^\\dagger v$**:\n    The problem states that the mass matrix $M$ is symmetric positive-definite. A positive-definite matrix is invertible. Therefore, we can pre-multiply by the inverse of $M$, denoted $M^{-1}$:\n    $$M^{-1} (A^H M v) = M^{-1} (M A^\\dagger v)$$\n    $$M^{-1} A^H M v = (M^{-1} M) A^\\dagger v$$\n    $$M^{-1} A^H M v = I A^\\dagger v$$\n    $$M^{-1} A^H M v = A^\\dagger v$$\n    Thus, the action of the discrete adjoint operator $A^\\dagger$ on an arbitrary vector $y \\in \\mathbb{C}^N$ is given by the expression:\n    $$A^\\dagger y = M^{-1} A^H M y$$\n\n### Analysis of the Continuous Adjoint Problem\n\nThe problem also requires that the discrete adjoint matches the continuous adjoint. Let's find the continuous adjoint operator corresponding to the sesquilinear form $a(u,v)$. The adjoint sesquilinear form, denoted $a^*(v,u)$, is defined by the relation $(Au, v)_{L^2} = (u, A^*v)_{L^2}$, which at the weak level corresponds to $a^*(v,u) = \\overline{a(u,v)}$.\n\nLet's compute $\\overline{a(u,v)}$:\n$$ \\overline{a(u,v)} = \\overline{\\int_{\\Omega} \\nabla u \\cdot \\overline{\\nabla v}\\, \\mathrm{d}\\Omega - \\int_{\\Omega} k^2 u\\, \\overline{v}\\, \\mathrm{d}\\Omega + \\int_{\\Gamma} i k \\zeta\\, u\\, \\overline{v}\\, \\mathrm{d}\\Gamma} $$\nUsing properties of complex conjugation ($\\overline{z_1 \\pm z_2} = \\overline{z_1} \\pm \\overline{z_2}$, $\\overline{z_1 z_2} = \\overline{z_1} \\overline{z_2}$, $\\overline{\\overline{z}} = z$, and $\\overline{\\int h} = \\int \\overline{h}$):\n$$ \\overline{a(u,v)} = \\int_{\\Omega} \\overline{\\nabla u \\cdot \\overline{\\nabla v}}\\, \\mathrm{d}\\Omega - \\int_{\\Omega} \\overline{k^2 u \\overline{v}}\\, \\mathrm{d}\\Omega + \\int_{\\Gamma} \\overline{i k \\zeta u \\overline{v}}\\, \\mathrm{d}\\Gamma $$\nSince $k$ and $\\zeta$ are real, $\\overline{k^2} = k^2$ and $\\overline{k\\zeta} = k\\zeta$. The imaginary unit conjugates as $\\overline{i} = -i$:\n$$ \\overline{a(u,v)} = \\int_{\\Omega} \\overline{\\nabla u} \\cdot \\nabla v\\, \\mathrm{d}\\Omega - \\int_{\\Omega} k^2 \\overline{u}\\, v\\, \\mathrm{d}\\Omega + \\int_{\\Gamma} (-i) k \\zeta\\, \\overline{u}\\, v\\, \\mathrm{d}\\Gamma $$\nBy swapping the dummy variables $u$ and $v$ and their corresponding integration variables, this form is equivalent to:\n$$ a^*(u,v) = \\int_{\\Omega} \\nabla u \\cdot \\overline{\\nabla v}\\, \\mathrm{d}\\Omega - \\int_{\\Omega} k^2 u\\, \\overline{v}\\, \\mathrm{d}\\Omega + \\int_{\\Gamma} (-i) k \\zeta\\, u\\, \\overline{v}\\, \\mathrm{d}\\Gamma $$\nComparing $a(u,v)$ and $a^*(u,v)$, we see that the coefficient of the boundary impedance term, $ik\\zeta$, has become $-ik\\zeta$. This means the adjoint PDE has the boundary condition $\\frac{\\partial p^*}{\\partial \\mathbf{n}} - i k \\zeta\\, p^* = g^*$.\n\nThe matrix $A$ has entries $A_{ij} = a(\\varphi_j, \\varphi_i)$. The Hermitian transpose $A^H$ has entries $(A^H)_{ij} = \\overline{A_{ji}} = \\overline{a(\\varphi_i, \\varphi_j)}$. Based on our derivation, $\\overline{a(\\varphi_i, \\varphi_j)} = a^*(\\varphi_j, \\varphi_i)$. Thus, the matrix $A^H$ is precisely the Galerkin matrix for the adjoint sesquilinear form $a^*$. This confirms that forming $A^H$ correctly accounts for the sign change in the impedance term.\n\nFinally, for the discrete adjoint $A^\\dagger$ to be a consistent approximation of the continuous adjoint operator $A^*$, the same numerical quadrature rules must be used to assemble the matrices $A$ and $M$. Any discrepancy breaks the discrete consistency and leads to errors, for instance, in a gradient-based optimization loop.\n\n### Option-by-Option Analysis\n\n**A. Compute $A^H y$ directly using the conjugate transpose of $A$ with no additional weighting, and leave the impedance boundary coefficient $i k \\zeta$ unchanged because $k$ and $\\zeta$ are real; standard element-wise conjugation of basis functions is unnecessary.**\nThis is incorrect. It computes the adjoint with respect to the Euclidean inner product, not the $L^2$ inner product represented by $(u,v)_M$. The formula is missing the $M^{-1}$ and $M$ factors. Furthermore, it incorrectly claims that the coefficient $ik\\zeta$ is unchanged; the definition of an adjoint on a complex space requires conjugation, which changes $i$ to $-i$.\n**Verdict: Incorrect.**\n\n**B. Compute $M^{-1} A^H M\\, y$ so that $(Au, v)_M = (u, M^{-1} A^H M v)_M$ holds. In assembling and interpreting $A^H$, apply complex conjugation consistently to all coefficients in the second argument of the sesquilinear form; in particular, the impedance term $i k \\zeta$ changes sign under adjoint due to the conjugation in the $L^2(\\Omega)$ inner product. Use the same quadrature rules for $A$ and $M$ to retain adjoint consistency.**\nThis option presents the correct formula $A^\\dagger y = M^{-1} A^H M y$ derived from first principles. It correctly identifies that computing $A^H$ corresponds to discretizing the adjoint problem, which involves conjugating the complex coefficients in the sesquilinear form, leading to the sign change of the impedance term. It also correctly highlights the important practical requirement of using consistent quadrature rules to maintain adjoint consistency.\n**Verdict: Correct.**\n\n**C. Compute $A^T y$ using the plain transpose because the wavenumber $k$ and impedance $\\zeta$ are real, and change the sign of the boundary term only if $\\zeta  0$; the mass matrix $M$ is not needed for the adjoint since the basis is orthogonal with respect to standard Euclidean inner product.**\nThis is incorrect on multiple grounds. First, for complex matrices, the adjoint is related to the Hermitian transpose ($A^H$), not the plain transpose ($A^T$). Second, the condition for the sign change is arbitrary and wrong; the sign change comes from conjugating $i$. Third, the claim that the basis is orthogonal is false; standard finite element basis functions are not orthogonal, which is precisely why the mass matrix $M$ is not the identity matrix.\n**Verdict: Incorrect.**\n\n**D. Reassemble an adjoint matrix by swapping trial and test functions in each element integral without applying complex conjugation to coefficients or basis functions, then compute that matrix times $y$; quadrature choice does not affect adjoint consistency provided the primal matrix is assembled exactly.**\nThis describes computing $A^T y$, which is incorrect as explained for option C. It fails to apply the necessary complex conjugation. The claim that quadrature choice does not affect adjoint consistency is also false; it is a critical consideration in practice.\n**Verdict: Incorrect.**\n\n**E. Compute $A^H y$ and post-multiply by the diagonal of $M$ (nodal lumped masses) to approximately account for the inner product, which is sufficient for matching the continuous adjoint of the Helmholtz operator under standard quadrature in practice.**\nThis suggests an incorrect formula, $A^H M_L y$ (where $M_L$ is the lumped mass matrix), which is not an approximation of the correct similarity transform $M^{-1} A^H M y$. While mass lumping can be used to approximate $M^{-1}$, the proposed formula is structurally wrong and does not represent a valid approximation of the adjoint operator.\n**Verdict: Incorrect.**",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "The raw shape gradient obtained from the adjoint method is often not suitable for direct use in shape updates, as it can lead to instabilities. This hands-on coding problem  guides you through the practical workflow of regularizing the gradient using a smoothing PDE and extending it off the boundary to create a velocity field for a level-set evolution. This practice bridges the gap between calculating a gradient and actually performing a design update.",
            "id": "4136349",
            "problem": "Consider a two-dimensional sound-hard inclusion with boundary shape parameterized by the unit circle, modeled within the framework of computational acoustics. The acoustic objective is differentiable with respect to the boundary shape, and its adjoint-based shape gradient yields a scalar boundary density $\\mathcal{G}(\\theta)$ defined on the boundary $\\partial\\Omega$, where $\\Omega\\subset\\mathbb{R}^2$ is the unit disk and $\\partial\\Omega$ is the unit circle parameterized by the angle $\\theta\\in[0,2\\pi)$. In order to obtain a descent direction that is suitable for level-set evolution, it is common to regularize the shape gradient on the boundary by solving a smoothing partial differential equation (PDE) and then extend the resulting normal velocity off the boundary into the interior of $\\Omega$.\n\nStarting from first principles, adopt the following model and computational steps:\n\n1. The acoustic state is governed by the Helmholtz equation inside $\\Omega$, and adjoint methods yield the boundary shape gradient density $\\mathcal{G}(\\theta)$ on $\\partial\\Omega$. We assume $\\mathcal{G}(\\theta)$ is known and square-integrable. To obtain a smooth normal velocity $V_n(\\theta)$ on $\\partial\\Omega$ (for shape update), pose the $H^1(\\partial\\Omega)$-regularized variational problem whose Eulerâ€“Lagrange equation is the surface Helmholtz-type smoothing PDE:\n$$\nV_n(\\theta) - \\alpha\\,\\partial_{ss}V_n(\\theta) = \\mathcal{G}(\\theta),\n$$\nwhere $s$ denotes arc length on $\\partial\\Omega$ and $\\alpha>0$ is the regularization parameter. On the unit circle, $s=\\theta$, so $\\partial_{ss}=\\partial_{\\theta\\theta}$ with periodic boundary conditions.\n\n2. To use $V_n$ in level-set advection, extend $V_n(\\theta)$ harmonically into the interior of the unit disk by solving the Laplace equation:\n$$\n\\Delta u(r,\\theta) = 0 \\quad \\text{for } 0\\le r1,\\;\\theta\\in[0,2\\pi), \\quad \\text{with} \\quad u(1,\\theta) = V_n(\\theta).\n$$\nFor a unit disk, the harmonic extension admits a Fourier representation. If\n$$\nV_n(\\theta) = \\sum_{k\\in\\mathbb{Z}} \\widehat{V}_k\\,e^{\\mathrm{i}k\\theta},\n$$\nthen\n$$\nu(r,\\theta) = \\sum_{k\\in\\mathbb{Z}} \\widehat{V}_k\\,r^{|k|}\\,e^{\\mathrm{i}k\\theta}, \\quad 0\\le r1.\n$$\nThis $u(r,\\theta)$ serves as the off-boundary extension of the normal velocity, suitable for level-set advection of a signed-distance level-set function $\\phi(x)$ via $\\partial_t\\phi + u\\Vert\\nabla\\phi\\rVert = 0$.\n\nImplement a computational method that:\n- Discretizes $\\theta$ uniformly on $[0,2\\pi)$ with $N$ points (use $N=1024$).\n- Computes the discrete Fourier transform of $\\mathcal{G}$ to obtain coefficients $\\widehat{\\mathcal{G}}_k$.\n- Solves the smoothing PDE in the Fourier domain, using the fact that on the unit circle $\\partial_{\\theta\\theta}e^{\\mathrm{i}k\\theta}=-k^2 e^{\\mathrm{i}k\\theta}$, so each mode satisfies\n$$\n(1+\\alpha k^2)\\,\\widehat{V}_k = \\widehat{\\mathcal{G}}_k.\n$$\n- Computes the harmonic extension by evaluating\n$$\nu(r,\\theta) = \\sum_{k} \\left(\\frac{\\widehat{V}_k}{N}\\right) r^{|k|} e^{\\mathrm{i}k\\theta},\n$$\nwhere $N$ is the number of angular samples, consistent with the discrete inverse Fourier transform normalization.\n\nAngles must be treated in radians throughout. All quantities are dimensionless. The program must evaluate the extended field $u(r,\\theta)$ at specified points for several test cases and return the numerical values.\n\nTest Suite:\n- Test Case 1 (happy path with moderate smoothing): $\\alpha=0.05$ and $\\mathcal{G}(\\theta)=\\cos(\\theta)+0.25\\sin(3\\theta)+0.1\\cos(10\\theta)$. Evaluate $u(r,\\theta)$ at points\n    - $r=0.0, \\theta=1.2$,\n    - $r=0.5, \\theta=\\pi/2$,\n    - $r=0.9, \\theta=\\pi$.\n- Test Case 2 (boundary condition with no smoothing): $\\alpha=0.0$ and $\\mathcal{G}(\\theta)=\\sin(2\\theta)+0.3\\sin(8\\theta)$. Evaluate $u(r,\\theta)$ at points\n    - $r=0.0, \\theta=0.0$,\n    - $r=0.75, \\theta=\\pi/4$,\n    - $r=0.99, \\theta=3.0$.\n- Test Case 3 (edge case with non-smooth density and stronger smoothing): $\\alpha=0.2$ and $\\mathcal{G}(\\theta)=\\operatorname{sign}(\\sin\\theta)$, where $\\operatorname{sign}(x)=1$ if $x>0$, $\\operatorname{sign}(x)=-1$ if $x0$, and $\\operatorname{sign}(0)=0$. Evaluate $u(r,\\theta)$ at points\n    - $r=0.4, \\theta=0.7$,\n    - $r=0.8, \\theta=2.3$,\n    - $r=0.95, \\theta=5.5$.\n\nRequired final output format:\nYour program should produce a single line of output containing the results for all test cases concatenated in order, with each test case contributing its three evaluation values, formatted as a comma-separated list enclosed in square brackets. For example, the output must have the form\n$$\n[\\,\\text{tc1\\_val1},\\text{tc1\\_val2},\\text{tc1\\_val3},\\text{tc2\\_val1},\\text{tc2\\_val2},\\text{tc2\\_val3},\\text{tc3\\_val1},\\text{tc3\\_val2},\\text{tc3\\_val3}\\,].\n$$\nEach entry must be a floating-point number.",
            "solution": "The problem is valid. It is scientifically grounded in the principles of computational acoustics and shape optimization, specifically using adjoint methods. The formulation involves standard, well-posed mathematical problems: a Helmholtz-type smoothing equation on a periodic domain and a harmonic extension problem (Laplace's equation) in a disk. The problem statement is self-contained, providing all necessary data, parameters, and equations for a unique solution. The language is objective and unambiguous. We may therefore proceed with the solution.\n\nThe core task is to compute a regularized and harmonically extended velocity field, denoted by $u(r,\\theta)$, which serves as a descent direction in a level-set-based shape optimization algorithm. The process begins with a raw shape gradient density, $\\mathcal{G}(\\theta)$, defined on the boundary $\\partial\\Omega$ of a unit disk. This process involves two main steps: regularization on the boundary and extension into the interior. We will implement a numerical solution based on the Discrete Fourier Transform (DFT).\n\nThe computational procedure is as follows:\n\n1.  **Discretization and Fourier Analysis of the Gradient Density $\\mathcal{G}(\\theta)$**\n    The boundary $\\partial\\Omega$ is the unit circle, parameterized by the angle $\\theta \\in [0, 2\\pi)$. We discretize this domain using $N$ equally spaced points, $\\theta_j = \\frac{2\\pi j}{N}$ for $j = 0, 1, \\dots, N-1$. The problem specifies $N=1024$. The given gradient density function $\\mathcal{G}(\\theta)$ is sampled at these points to produce a discrete sequence $\\mathcal{G}_j = \\mathcal{G}(\\theta_j)$.\n    We then compute the Discrete Fourier Transform (DFT) of this sequence to obtain its spectral coefficients, $\\widehat{\\mathcal{G}}_k$:\n    $$\n    \\widehat{\\mathcal{G}}_k = \\sum_{j=0}^{N-1} \\mathcal{G}_j e^{-i 2\\pi j k / N}\n    $$\n    These coefficients represent the amplitude and phase of the constituent sinusoids corresponding to integer wavenumbers $k$. The wavenumbers $k$ range from $0$ up to $N-1$ and are typically rearranged to represent both positive and negative frequencies, for example from $-N/2+1$ to $N/2$. In a numerical implementation, this is handled by functions like `numpy.fft.fftfreq`.\n\n2.  **Regularization in the Fourier Domain**\n    The raw gradient $\\mathcal{G}(\\theta)$ is regularized to obtain a smoother normal velocity field $V_n(\\theta)$ on the boundary. This is achieved by solving the surface Helmholtz-type equation:\n    $$\n    V_n(\\theta) - \\alpha \\partial_{\\theta\\theta} V_n(\\theta) = \\mathcal{G}(\\theta)\n    $$\n    where $\\alpha  0$ is a regularization parameter. This equation is exceptionally well-suited for a Fourier-based solution. Applying the continuous Fourier transform, which maps a function $f(\\theta)$ to its coefficients $\\widehat{f}_k$, and using the property that the transform of a derivative is $\\mathcal{F}(\\partial_{\\theta\\theta}f)_k = -k^2 \\widehat{f}_k$, the PDE transforms into an algebraic equation for each mode $k$:\n    $$\n    \\widehat{V}_k - \\alpha(-k^2 \\widehat{V}_k) = \\widehat{\\mathcal{G}}_k\n    $$\n    Here, $\\widehat{V}_k$ and $\\widehat{\\mathcal{G}}_k$ are the Fourier coefficients of $V_n(\\theta)$ and $\\mathcal{G}(\\theta)$, respectively. Solving for $\\widehat{V}_k$ gives:\n    $$\n    (1 + \\alpha k^2) \\widehat{V}_k = \\widehat{\\mathcal{G}}_k \\implies \\widehat{V}_k = \\frac{\\widehat{\\mathcal{G}}_k}{1 + \\alpha k^2}\n    $$\n    This operation acts as a low-pass filter: for small wavenumbers $k$, $\\widehat{V}_k \\approx \\widehat{\\mathcal{G}}_k$, while for large $k$ (high frequencies), the denominator $1 + \\alpha k^2$ becomes large, significantly damping the coefficient. This results in a smoother function $V_n(\\theta)$ as high-frequency oscillations are suppressed. We apply this formula to the discrete coefficients $\\widehat{\\mathcal{G}}_k$ obtained from the DFT, using the corresponding discrete integer wavenumbers. In the special case where $\\alpha=0$, there is no regularization, and we simply have $\\widehat{V}_k = \\widehat{\\mathcal{G}}_k$.\n\n3.  **Harmonic Extension into the Disk Interior**\n    The final step is to extend the smoothed normal velocity $V_n(\\theta)$ from the boundary into the interior of the unit disk. This is done by solving the Laplace equation $\\Delta u(r, \\theta) = 0$ with the Dirichlet boundary condition $u(1, \\theta) = V_n(\\theta)$. The solution to this problem in polar coordinates can be represented by a Fourier series. If the continuous Fourier series for $V_n(\\theta)$ is $V_n(\\theta) = \\sum_{k \\in \\mathbb{Z}} c_k e^{ik\\theta}$, the corresponding harmonic extension is:\n    $$\n    u(r, \\theta) = \\sum_{k \\in \\mathbb{Z}} c_k r^{|k|} e^{ik\\theta}\n    $$\n    The term $r^{|k|}$ ensures that the solution is well-behaved as $r \\to 0$ and satisfies the boundary condition at $r=1$. Numerically, we approximate the continuous Fourier coefficients $c_k$ using the DFT coefficients $\\widehat{V}_k$ via the relation $c_k \\approx \\widehat{V}_k/N$. The problem provides the explicit formula for implementation:\n    $$\n    u(r, \\theta) = \\sum_{k} \\left(\\frac{\\widehat{V}_k}{N}\\right) r^{|k|} e^{i k \\theta}\n    $$\n    where the sum is over all discrete wavenumbers $k$ from the DFT. For any given evaluation point $(r, \\theta)$, we compute this sum using the previously calculated coefficients $\\widehat{V}_k$. Since the input function $\\mathcal{G}(\\theta)$ is real-valued, the resulting field $u(r,\\theta)$ must also be real-valued. Any small imaginary part in the numerical result is due to floating-point precision errors and should be discarded.\n\nThis three-step procedure will be implemented for each test case provided.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the regularized and harmonically extended shape gradient velocity field.\n    \"\"\"\n    N = 1024  # Number of discretization points on the circle\n    \n    # Define the test cases as specified in the problem statement.\n    test_cases = [\n        {\n            \"alpha\": 0.05,\n            \"G_func\": lambda theta: np.cos(theta) + 0.25 * np.sin(3 * theta) + 0.1 * np.cos(10 * theta),\n            \"points\": [(0.0, 1.2), (0.5, np.pi/2), (0.9, np.pi)]\n        },\n        {\n            \"alpha\": 0.0,\n            \"G_func\": lambda theta: np.sin(2 * theta) + 0.3 * np.sin(8 * theta),\n            \"points\": [(0.0, 0.0), (0.75, np.pi/4), (0.99, 3.0)]\n        },\n        {\n            \"alpha\": 0.2,\n            \"G_func\": lambda theta: np.sign(np.sin(theta)),\n            \"points\": [(0.4, 0.7), (0.8, 2.3), (0.95, 5.5)]\n        }\n    ]\n\n    all_results = []\n\n    # Angular grid for discretization\n    thetas_grid = np.linspace(0, 2 * np.pi, N, endpoint=False)\n    \n    # Discrete integer wavenumbers corresponding to the FFT frequencies\n    # np.fft.fftfreq(N) gives frequencies in cycles/sample, multiply by N to get integer k\n    k_vals = np.fft.fftfreq(N) * N\n\n    for case in test_cases:\n        alpha = case[\"alpha\"]\n        G_func = case[\"G_func\"]\n        eval_points = case[\"points\"]\n\n        # Step 1: Sample G(theta) on the grid and compute its DFT\n        G_vals = G_func(thetas_grid)\n        G_hat = np.fft.fft(G_vals)\n\n        # Step 2: Solve the smoothing PDE in the Fourier domain\n        # V_hat_k = G_hat_k / (1 + alpha * k^2)\n        V_hat = G_hat / (1 + alpha * k_vals**2)\n\n        # Step 3: Compute the harmonic extension at specified points\n        for r, theta_eval in eval_points:\n            # Formula: u(r, theta) = sum_k (V_hat_k / N) * r^|k| * exp(i*k*theta)\n            # This is a vectorized calculation of all terms in the sum.\n            terms = (V_hat / N) * (r**np.abs(k_vals)) * np.exp(1j * k_vals * theta_eval)\n            u_val = np.sum(terms)\n            \n            # The result should be real since G(theta) is real. Take the real part.\n            all_results.append(np.real(u_val))\n\n    # Format the final output as a comma-separated list in brackets.\n    output_str = f\"[{','.join(f'{res:.12f}' for res in all_results)}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}