{
    "hands_on_practices": [
        {
            "introduction": "在处理奇异积分之前，我们必须首先理解其“奇异性”的强度，因为这直接决定了所需的正则化技术。本练习将引导你通过局部几何分析，考察亥姆霍兹方程基本解在一个光滑边界附近的积分行为，从而判断其奇异性的类型。掌握这种 foundational 的分析技能，是为边界元法中遇到的不同奇异积分选择恰当计算策略的关键第一步 。",
            "id": "4137037",
            "problem": "考虑由 Helmholtz 方程 $\\Delta p + k^{2} p = 0$ 控制的三维空间中的时谐声学问题，其中 $\\omega$ 是角频率， $k = \\omega/c$ 是声波数，$c$ 是声速。设 $\\Gamma \\subset \\mathbb{R}^{3}$ 是一个光滑边界，$\\mathbf{x} \\in \\Gamma$ 是此边界上的一个点。Helmholtz 算子的自由空间格林函数为\n$$\nG(\\mathbf{x},\\mathbf{y}) = \\frac{\\exp\\!\\big(i k |\\mathbf{x}-\\mathbf{y}|\\big)}{4\\pi\\,|\\mathbf{x}-\\mathbf{y}|} \\, ,\n$$\n该函数用于计算声学中的边界积分公式。定义局部片积分\n$$\nI(\\epsilon) = \\int_{\\Gamma \\cap B_{\\epsilon}(\\mathbf{x})} G(\\mathbf{x},\\mathbf{y}) \\, d\\Gamma_{\\mathbf{y}} \\, ,\n$$\n其中 $B_{\\epsilon}(\\mathbf{x})$ 是以 $\\mathbf{x}$ 为中心、半径为 $\\epsilon$ 的开球，$d\\Gamma_{\\mathbf{y}}$ 表示 $\\Gamma$ 上的曲面测度。从上述 Helmholtz 方程和基本解出发，仅使用 $\\Gamma$ 在 $\\mathbf{x}$ 附近的局部微分几何信息（切平面和光滑性），推导当 $\\epsilon \\to 0$ 时 $I(\\epsilon)$ 的领阶渐近行为，并判断在 $\\Gamma$ 上进行曲面积分的意义下，$G(\\mathbf{x},\\mathbf{y})$ 在 $\\mathbf{y}=\\mathbf{x}$ 处的奇点是弱奇异、强奇异还是超奇异。将极限值 $\\lim_{\\epsilon\\to 0} I(\\epsilon)$ 作为最终答案。答案无需四舍五入，也无需报告单位。",
            "solution": "题干陈述经过严格验证，无任何瑕疵。它具有科学依据，是适定的、客观的，并包含进行严格求解所需的所有必要信息。因此，我们可以继续。\n\n该问题要求当积分域收缩到奇点时，计算一个包含亥姆霍兹方程自由空间格林函数的曲面积分的极限。给定积分为\n$$\nI(\\epsilon) = \\int_{\\Gamma \\cap B_{\\epsilon}(\\mathbf{x})} G(\\mathbf{x},\\mathbf{y}) \\, d\\Gamma_{\\mathbf{y}}\n$$\n其中 $G(\\mathbf{x},\\mathbf{y}) = \\frac{\\exp(i k |\\mathbf{x}-\\mathbf{y}|)}{4\\pi |\\mathbf{x}-\\mathbf{y}|}$，$\\Gamma$ 是 $\\mathbb{R}^3$ 中的一个光滑曲面，$\\mathbf{x} \\in \\Gamma$，$B_{\\epsilon}(\\mathbf{x})$ 是以 $\\mathbf{x}$ 为中心、半径为 $\\epsilon$ 的球。我们旨在求出 $\\lim_{\\epsilon \\to 0} I(\\epsilon)$。\n\n对该积分的分析最好在以点 $\\mathbf{x}$ 为中心的局部坐标系中进行。设我们坐标系的原点位于 $\\mathbf{x}$。我们将 $\\xi_1$ 轴和 $\\xi_2$ 轴与切平面 $T_{\\mathbf{x}}\\Gamma$ 的一个标准正交基对齐，并将 $\\xi_3$ 轴与该点的法向量 $\\mathbf{n}(\\mathbf{x})$ 对齐。\n\n在 $\\mathbf{x}$ 的邻域内，曲面 $\\Gamma$ 上的点 $\\mathbf{y}$ 可以由切平面中的坐标 $(\\xi_1, \\xi_2)$ 参数化。$\\mathbf{y}$ 相对于 $\\mathbf{x}$ 的位置向量由 $(\\xi_1, \\xi_2, h(\\xi_1, \\xi_2))$ 给出，其中 $\\xi_3 = h(\\xi_1, \\xi_2)$ 描述了曲面从切平面的抬高。由于 $\\Gamma$ 是光滑的，且平面 $\\xi_3=0$ 在原点处与其相切，函数 $h$ 必须满足 $h(0,0)=0$ 和 $\\frac{\\partial h}{\\partial \\xi_1}(0,0) = \\frac{\\partial h}{\\partial \\xi_2}(0,0) = 0$。$h$ 在 $(0,0)$ 附近的泰勒展开给出 $h(\\xi_1, \\xi_2) = O(\\rho^2)$，其中 $\\rho = \\sqrt{\\xi_1^2 + \\xi_2^2}$ 是切平面中的径向距离。\n\n接下来，我们在该局部坐标系中，针对较小的 $\\rho$ 分析被积函数和积分测度的分量。\n\n1.  **距离 $|\\mathbf{x}-\\mathbf{y}|$**：令 $r = |\\mathbf{x}-\\mathbf{y}|$。在我们的局部坐标系中，这是从原点到点 $(\\xi_1, \\xi_2, h(\\xi_1, \\xi_2))$ 的距离。\n    $$\n    r = \\sqrt{\\xi_1^2 + \\xi_2^2 + h(\\xi_1, \\xi_2)^2} = \\sqrt{\\rho^2 + O(\\rho^4)} = \\rho \\sqrt{1 + O(\\rho^2)} = \\rho \\left(1 + O(\\rho^2)\\right)\n    $$\n    对于小的 $\\rho$，领阶项就是 $r \\approx \\rho$。\n\n2.  **曲面元 $d\\Gamma_{\\mathbf{y}}$**：曲面微元由下式给出\n    $$\n    d\\Gamma_{\\mathbf{y}} = \\sqrt{1 + \\left(\\frac{\\partial h}{\\partial \\xi_1}\\right)^2 + \\left(\\frac{\\partial h}{\\partial \\xi_2}\\right)^2} \\, d\\xi_1 d\\xi_2\n    $$\n    由于 $\\nabla h = O(\\rho)$，我们有 $(\\nabla h)^2 = O(\\rho^2)$。因此，\n    $$\n    d\\Gamma_{\\mathbf{y}} = \\sqrt{1 + O(\\rho^2)} \\, d\\xi_1 d\\xi_2 = (1+O(\\rho^2)) \\, d\\xi_1 d\\xi_2\n    $$\n    领阶近似为 $d\\Gamma_{\\mathbf{y}} \\approx d\\xi_1 d\\xi_2$。\n\n3.  **积分域 $\\Gamma \\cap B_{\\epsilon}(\\mathbf{x})$**：这是满足 $|\\mathbf{x}-\\mathbf{y}|  \\epsilon$ 的点集 $\\mathbf{y} \\in \\Gamma$。在局部坐标中，此条件为 $r  \\epsilon$，即 $\\rho(1+O(\\rho^2))  \\epsilon$。当 $\\epsilon \\to 0$ 时，曲面上的这个域渐近等价于切平面中的开圆盘 $D_{\\epsilon} = \\{(\\xi_1, \\xi_2) \\in \\mathbb{R}^2 \\mid \\rho  \\epsilon\\}$。\n\n将这些领阶近似代入积分 $I(\\epsilon)$，我们得到：\n$$\nI(\\epsilon) \\approx \\int_{D_{\\epsilon}} \\frac{\\exp(i k \\rho)}{4\\pi \\rho} \\, d\\xi_1 d\\xi_2\n$$\n为了计算在圆盘 $D_{\\epsilon}$ 上的这个积分，我们转换到 $(\\xi_1, \\xi_2)$ 平面中的极坐标 $(\\rho, \\theta)$。这里，$\\xi_1 = \\rho \\cos\\theta$，$\\xi_2 = \\rho \\sin\\theta$，面积元为 $d\\xi_1 d\\xi_2 = \\rho \\, d\\rho \\, d\\theta$。积分限为 $0 \\le \\rho  \\epsilon$ 和 $0 \\le \\theta  2\\pi$。\n$$\nI(\\epsilon) \\approx \\int_0^{2\\pi} \\int_0^\\epsilon \\frac{\\exp(i k \\rho)}{4\\pi \\rho} \\rho \\, d\\rho \\, d\\theta\n$$\n来自极坐标雅可比行列式的因子 $\\rho$ 与格林函数分母中的 $\\rho$ 相抵消。这种抵消是奇点为弱奇异的关键原因。\n$$\nI(\\epsilon) \\approx \\frac{1}{4\\pi} \\int_0^{2\\pi} d\\theta \\int_0^\\epsilon \\exp(i k \\rho) \\, d\\rho\n$$\n关于 $\\theta$ 的积分为 $\\int_0^{2\\pi} d\\theta = 2\\pi$。\n$$\nI(\\epsilon) \\approx \\frac{2\\pi}{4\\pi} \\int_0^\\epsilon \\exp(i k \\rho) \\, d\\rho = \\frac{1}{2} \\int_0^\\epsilon \\exp(i k \\rho) \\, d\\rho\n$$\n剩下的关于 $\\rho$ 的积分是初等的：\n$$\n\\int_0^\\epsilon \\exp(i k \\rho) \\, d\\rho = \\left[ \\frac{\\exp(i k \\rho)}{ik} \\right]_0^\\epsilon = \\frac{\\exp(i k \\epsilon) - \\exp(0)}{ik} = \\frac{\\exp(i k \\epsilon) - 1}{ik}\n$$\n因此，$I(\\epsilon)$ 的领阶渐近表达式为：\n$$\nI(\\epsilon) \\approx \\frac{\\exp(i k \\epsilon) - 1}{2ik}\n$$\n为了求得所需极限，我们令此表达式中的 $\\epsilon \\to 0$。由于指数函数是连续的，$\\lim_{\\epsilon \\to 0} \\exp(i k \\epsilon) = \\exp(0) = 1$。\n$$\n\\lim_{\\epsilon \\to 0} I(\\epsilon) = \\lim_{\\epsilon \\to 0} \\frac{\\exp(i k \\epsilon) - 1}{2ik} = \\frac{1 - 1}{2ik} = 0\n$$\n$I(\\epsilon)$ 的领阶行为可以通过对指数项进行针对小 $\\epsilon$ 的泰勒展开来找到：\n$$\n\\exp(i k \\epsilon) = 1 + i k \\epsilon + O((k\\epsilon)^2)\n$$\n将此代入我们关于 $I(\\epsilon)$ 的表达式中：\n$$\nI(\\epsilon) \\approx \\frac{(1 + i k \\epsilon + O(\\epsilon^2)) - 1}{2ik} = \\frac{i k \\epsilon + O(\\epsilon^2)}{2ik} = \\frac{\\epsilon}{2} + O(\\epsilon^2)\n$$\n这证实了当 $\\epsilon \\to 0$ 时，$I(\\epsilon) \\to 0$。\n\n核函数 $G(\\mathbf{x}, \\mathbf{y})$ 的奇点阶数为 $|\\mathbf{x}-\\mathbf{y}|^{-1}$。在 $\\mathbb{R}^3$ 的曲面积分设定中，曲面测度 $d\\Gamma_{\\mathbf{y}}$ 局部表现为 $\\rho \\, d\\rho \\, d\\theta$。因此被积函数的行为类似于 $\\rho^{-1} \\cdot \\rho$，是正则的。由于在包含奇点的任何任意小邻域上的积分都存在且有限，该奇点被归类为**弱奇异**。\n\n最终答案是该极限的值。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "当求值点非常靠近积分单元但又不在其上时，便会产生“近奇异”问题，此时被积函数虽为有限值但数值巨大，导致标准求积方法失效。本练习展示了一种强大而实用的“奇异性减去与加回”技巧，通过将复杂几何近似为等面积的圆盘，并解析地对奇异核的主部进行积分，从而构建一个精确的修正项 。这种方法是提高边界元法在处理薄体结构或近场计算时精度和稳定性的核心技术之一。",
            "id": "4137057",
            "problem": "在计算声学中，用于频域亥姆霍兹方程的边界元法（BEM）使用自由空间格林函数 $G_{k}(\\mathbf{r},\\mathbf{r}')=\\exp(\\mathrm{i}k|\\mathbf{r}-\\mathbf{r}'|)/(4\\pi|\\mathbf{r}-\\mathbf{r}'|)$ 来表示单层势。对于评估点 $\\mathbf{r}=(0,0,\\delta)$（其中 $\\delta>0$）和一个位于平面 $z=0$ 上、形心在原点、面积为 $A$ 的平面三角形单元 $\\mathcal{T}$，单层积分核的近奇异行为由其领头奇异项 $G_{\\mathrm{sing}}(\\mathbf{r},\\mathbf{r}')=1/(4\\pi|\\mathbf{r}-\\mathbf{r}'|)$ 决定。一种标准的基于形心的求积方法将奇异贡献近似为 $A/(4\\pi\\delta)$，当 $\\delta$ 相对于单元尺寸很小时，这会产生较大误差。\n\n定义近奇异校正 $C_{\\mathrm{sing}}(A,\\delta)$ 为奇异部分在单元上的解析积分减去其基于形心的近似值，即：\n$$\nC_{\\mathrm{sing}}(A,\\delta)\\equiv \\int_{\\mathcal{T}} \\frac{1}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}\\,\\mathrm{d}S' \\;-\\; \\frac{A}{4\\pi\\delta}.\n$$\n仅使用形心附近的领头阶奇异结构，并假设该单元可局部近似为位于平面 $z=0$ 上、以原点为中心且面积相等的圆盘 $\\mathcal{D}$（其半径 $R_{e}$ 的选择满足 $\\pi R_{e}^{2}=A$），通过在 $\\mathcal{D}$ 上精确积分奇异核 $1/(4\\pi|\\mathbf{r}-\\mathbf{r}'|)$ 并减去形心项 $A/(4\\pi\\delta)$，推导 $C_{\\mathrm{sing}}(A,\\delta)$ 的一个闭式解析表达式。\n\n以 $A$ 和 $\\delta$ 的单个闭式表达式给出最终答案。不要进行任何数值舍入。最终表达式中无需报告物理单位。",
            "solution": "用户要求对一个计算声学问题提供严谨的解法，并要求严格遵守科学和格式标准。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n\n-   **背景**：用于频域亥姆霍兹方程的边界元法 (BEM)。\n-   **自由空间格林函数**：$G_{k}(\\mathbf{r},\\mathbf{r}')=\\exp(\\mathrm{i}k|\\mathbf{r}-\\mathbf{r}'|)/(4\\pi|\\mathbf{r}-\\mathbf{r}'|)$。\n-   **评估点**：$\\mathbf{r}=(0,0,\\delta)$，其中 $\\delta>0$。\n-   **单元**：一个位于平面 $z=0$ 上、形心在原点、面积为 $A$ 的平面三角形单元 $\\mathcal{T}$。\n-   **领头奇异项**：$G_{\\mathrm{sing}}(\\mathbf{r},\\mathbf{r}')=1/(4\\pi|\\mathbf{r}-\\mathbf{r}'|)$。\n-   **基于形心的求积近似**：$A/(4\\pi\\delta)$。\n-   **近奇异校正的定义**：$C_{\\mathrm{sing}}(A,\\delta)\\equiv \\int_{\\mathcal{T}} \\frac{1}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}\\,\\mathrm{d}S' \\;-\\; \\frac{A}{4\\pi\\delta}$。\n-   **核心任务**：用一个位于 $z=0$ 平面、以原点为中心、半径 $R_{e}$ 满足 $\\pi R_{e}^{2}=A$ 的圆盘 $\\mathcal{D}$ 来近似单元 $\\mathcal{T}$。\n-   **目标**：在此圆盘近似下，推导 $C_{\\mathrm{sing}}(A,\\delta)$ 的闭式解析表达式，用 $A$ 和 $\\delta$ 表示。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n-   **科学依据（关键）**：该问题牢固植根于计算声学和数值分析这一成熟领域，特别是边界元法。格林函数、奇异积分以及近奇异点校正方案等概念都是标准且有效的。用一个简单的几何体（圆盘）来近似一个复杂的几何体（三角形）以推导解析校正项，是该领域中一种常用且合理的技术。\n-   **适定性**：该问题是适定的。它为待计算量 $C_{\\mathrm{sing}}(A,\\delta)$ 提供了明确的定义，并明确指示使用一种特定的、数学上易于处理的近似（面积等效的圆盘）。输入（$A$, $\\delta$）和期望的输出形式都是明确的。存在唯一的数学解。\n-   **客观性（关键）**：问题陈述由精确的技术语言构成，没有主观性、模糊性或个人观点。\n\n**步骤 3：结论与行动**\n\n该问题具有科学合理性、适定性、客观性和完整性。因此，它被判定为**有效**。我们可以着手求解。\n\n### 解法推导\n\n目标是通过用一个面积同为 $A$ 的圆盘 $\\mathcal{D}$ 来近似三角形单元 $\\mathcal{T}$，从而计算近奇异校正项 $C_{\\mathrm{sing}}(A,\\delta)$。需要计算的公式是：\n$$\nC_{\\mathrm{sing}}(A,\\delta) = \\left( \\int_{\\mathcal{D}} \\frac{1}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}\\,\\mathrm{d}S' \\right) - \\frac{A}{4\\pi\\delta}\n$$\n圆盘 $\\mathcal{D}$ 位于 $z=0$ 平面，以原点为中心，面积为 $A$。因此，其半径 $R_e$ 由关系式 $\\pi R_{e}^{2}=A$ 给出，这意味着 $R_{e}^{2} = A/\\pi$。\n\n首先，我们计算积分项。评估点为 $\\mathbf{r} = (0,0,\\delta)$。圆盘 $\\mathcal{D}$ 上的源点 $\\mathbf{r}'$ 可以用柱坐标参数化为 $(x', y', z') = (\\rho'\\cos\\phi', \\rho'\\sin\\phi', 0)$，其中 $\\rho'$ 是离原点的径向距离，$\\phi'$ 是方位角。距离 $|\\mathbf{r}-\\mathbf{r}'|$ 为：\n$$\n|\\mathbf{r}-\\mathbf{r}'| = \\sqrt{(0-\\rho'\\cos\\phi')^{2} + (0-\\rho'\\sin\\phi')^{2} + (\\delta-0)^{2}} = \\sqrt{(\\rho')^{2}(\\cos^{2}\\phi' + \\sin^{2}\\phi')} + \\delta^{2}} = \\sqrt{(\\rho')^{2}+\\delta^{2}}\n$$\n在这些坐标系下，微分面积元为 $\\mathrm{d}S' = \\rho'\\,\\mathrm{d}\\rho'\\,\\mathrm{d}\\phi'$。对圆盘积分的积分限为 $0 \\leq \\rho' \\leq R_e$ 和 $0 \\leq \\phi' \\leq 2\\pi$。\n\n积分可以写成如下形式：\n$$\n\\int_{\\mathcal{D}} \\frac{1}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}\\,\\mathrm{d}S' = \\int_{0}^{2\\pi} \\int_{0}^{R_e} \\frac{1}{4\\pi\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\rho'\\,\\mathrm{d}\\rho'\\,\\mathrm{d}\\phi'\n$$\n我们可以提出常数 $1/(4\\pi)$，并注意到被积函数与 $\\phi'$ 无关，因此可以先对 $\\phi'$ 进行积分：\n$$\n\\frac{1}{4\\pi} \\left( \\int_{0}^{2\\pi} \\mathrm{d}\\phi' \\right) \\left( \\int_{0}^{R_e} \\frac{\\rho'}{\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\mathrm{d}\\rho' \\right) = \\frac{2\\pi}{4\\pi} \\int_{0}^{R_e} \\frac{\\rho'}{\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\mathrm{d}\\rho' = \\frac{1}{2} \\int_{0}^{R_e} \\frac{\\rho'}{\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\mathrm{d}\\rho'\n$$\n为了求解剩下关于 $\\rho'$ 的积分，我们使用换元法，令 $u = (\\rho')^{2} + \\delta^{2}$。这得到 $\\mathrm{d}u = 2\\rho'\\,\\mathrm{d}\\rho'$，或 $\\rho'\\,\\mathrm{d}\\rho' = \\frac{1}{2}\\mathrm{d}u$。积分变换为：\n$$\n\\int \\frac{\\rho'}{\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\mathrm{d}\\rho' = \\int \\frac{\\frac{1}{2}\\mathrm{d}u}{\\sqrt{u}} = \\frac{1}{2} \\int u^{-1/2} \\mathrm{d}u = \\frac{1}{2} \\frac{u^{1/2}}{1/2} = \\sqrt{u} = \\sqrt{(\\rho')^{2}+\\delta^{2}}\n$$\n计算该定积分：\n$$\n\\int_{0}^{R_e} \\frac{\\rho'}{\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\mathrm{d}\\rho' = \\left[ \\sqrt{(\\rho')^{2}+\\delta^{2}} \\right]_{0}^{R_e} = \\sqrt{R_{e}^{2}+\\delta^{2}} - \\sqrt{0^{2}+\\delta^{2}} = \\sqrt{R_{e}^{2}+\\delta^{2}} - \\delta\n$$\n将此结果代回，积分项的值为：\n$$\n\\int_{\\mathcal{D}} \\frac{1}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}\\,\\mathrm{d}S' = \\frac{1}{2} \\left( \\sqrt{R_{e}^{2}+\\delta^{2}} - \\delta \\right)\n$$\n现在，我们可以写出 $C_{\\mathrm{sing}}(A,\\delta)$ 的完整表达式：\n$$\nC_{\\mathrm{sing}}(A,\\delta) = \\frac{1}{2} \\left( \\sqrt{R_{e}^{2}+\\delta^{2}} - \\delta \\right) - \\frac{A}{4\\pi\\delta}\n$$\n最后，我们代入 $R_{e}^{2} = A/\\pi$，将结果完全用给定的参数 $A$ 和 $\\delta$ 表示。\n$$\nC_{\\mathrm{sing}}(A,\\delta) = \\frac{1}{2} \\left( \\sqrt{\\frac{A}{\\pi}+\\delta^{2}} - \\delta \\right) - \\frac{A}{4\\pi\\delta}\n$$\n这就是在指定的圆盘近似下，近奇异校正的最终闭式解析表达式。",
            "answer": "$$\\boxed{\\frac{1}{2}\\left(\\sqrt{\\frac{A}{\\pi} + \\delta^{2}} - \\delta\\right) - \\frac{A}{4\\pi\\delta}}$$"
        },
        {
            "introduction": "理论理解的最终目的是编写出能够解决实际问题的稳健代码。这个动手编程练习将指导你实现一种基于“单位分解”思想的奇异性提取算法，这在专业的BEM软件中非常普遍 。你将学习如何将积分区域分解为奇异的“局部”和非奇异的“全局”两部分，并分别采用解析积分和标准高斯求积进行处理，从而精确高效地计算包含对数奇异性的边界积分。",
            "id": "4137082",
            "problem": "考虑静态（零频率）极限下的二维声学势，其自由空间格林函数由 $G(\\mathbf{x},\\mathbf{y}) = -\\dfrac{1}{2\\pi} \\ln \\|\\mathbf{x} - \\mathbf{y}\\|$ 给出。在计算声学的边界积分公式中，我们经常需要计算形如下式的积分\n$$\nI(\\xi,d) = \\int_{-1}^{1} K(s;\\xi,d)\\,\\phi(s)\\,\\mathrm{d}s,\n$$\n其中 $s \\in [-1,1]$ 参数化了沿 $x$ 轴的一个平直边界段，场点为 $\\mathbf{x}_0 = (\\xi,d)$，其中 $\\xi \\in \\mathbb{R}$ 且 $d \\ge 0$，核函数为\n$$\nK(s;\\xi,d) = -\\frac{1}{2\\pi} \\ln\\left(\\sqrt{(s-\\xi)^2 + d^2}\\right),\n$$\n且边界源密度 $\\phi(s)$ 是一个给定的光滑函数。当 $d = 0$ 且 $\\xi \\in [-1,1]$ 时，该积分为对数奇异；当 $d$ 很小但为正时，该积分为近奇异。\n\n您的任务是实现一个单位分解，将积分分割为局部和全局片，对局部片应用奇异性提取，并对全局片使用标准求积法：\n\n1. 选择一个局部片半宽参数 $\\varepsilon > 0$，并定义局部片为 $[s_{\\mathrm{lo}}, s_{\\mathrm{hi}}] = [\\max(-1,\\xi-\\varepsilon), \\min(1,\\xi+\\varepsilon)]$。通过在 $[s_{\\mathrm{lo}}, s_{\\mathrm{hi}}]$ 上等于 $1$ 且在其他地方等于 $0$ 的局部权重 $w_{\\mathrm{loc}}(s)$，以及全局权重 $w_{\\mathrm{glob}}(s) = 1 - w_{\\mathrm{loc}}(s)$ 来定义单位分解。\n2. 在局部片上，通过减去并加回项 $\\phi(\\xi)\\,K(s;\\xi,d)$ 来执行奇异性提取。更准确地说，写作\n$$\nI(\\xi,d) = \\underbrace{\\int_{s_{\\mathrm{lo}}}^{s_{\\mathrm{hi}}} \\left[ K(s;\\xi,d)\\,\\big(\\phi(s)-\\phi(\\xi)\\big) \\right]\\,\\mathrm{d}s}_{\\text{局部余项}} \\;+\\; \\underbrace{\\phi(\\xi) \\int_{s_{\\mathrm{lo}}}^{s_{\\mathrm{hi}}} K(s;\\xi,d)\\,\\mathrm{d}s}_{\\text{局部奇异部分（解析）}} \\;+\\; \\underbrace{\\int_{-1}^{s_{\\mathrm{lo}}} K(s;\\xi,d)\\,\\phi(s)\\,\\mathrm{d}s + \\int_{s_{\\mathrm{hi}}}^{1} K(s;\\xi,d)\\,\\phi(s)\\,\\mathrm{d}s}_{\\text{全局部分}}。\n$$\n3. 解析地计算局部奇异部分。使用具有足够多节点数的标准高斯-勒让德求积法计算局部余项和全局部分，以确保数值稳定性和准确性。\n\n为特定的选择 $\\phi(s) = 1 + \\beta s$（其中 $\\beta$ 是一个实数参数）实现上述算法。使用以下探测各种情况的参数集 $(\\xi, d, \\varepsilon, \\beta)$ 测试套件：\n\n- 测试 1（一般近奇异，内部点）：$(\\xi, d, \\varepsilon, \\beta) = (0.0, 0.1, 0.2, 0.5)$。\n- 测试 2（强近奇异，内部点）：$(\\xi, d, \\varepsilon, \\beta) = (0.0, 10^{-6}, 0.1, 1.0)$。\n- 测试 3（面上奇异，内部点）：$(\\xi, d, \\varepsilon, \\beta) = (0.5, 0.0, 0.15, -0.3)$。\n- 测试 4（面上奇异，近边界截断点）：$(\\xi, d, \\varepsilon, \\beta) = (0.95, 0.0, 0.2, 0.7)$。\n- 测试 5（远场，常数密度）：$(\\xi, d, \\varepsilon, \\beta) = (-0.3, 1.0, 0.25, 0.0)$。\n\n您的程序应生成单行输出，其中包含五个测试的 $I(\\xi,d)$ 数值，按顺序排列，形式为方括号内以逗号分隔的列表（例如，“[result1,result2,result3,result4,result5]”）。结果必须是无量纲单位的实数（浮点数）。",
            "solution": "问题陈述经过严格验证，被认为是有效的。它在科学上基于势场理论，特别是将边界积分法应用于控制静态声学的二维拉普拉斯方程。该问题是适定的，描述了一种用于计算奇异和近奇异积分的标准数值技术（奇异性提取）。所有术语、函数和参数的定义都清晰且一致。所提供的测试用例在物理上是合理的，用于测试所提出算法的鲁棒性。\n\n核心任务是对于给定的线性源密度 $\\phi(s)=1+\\beta s$ 和对数核函数 $K(s;\\xi,d) = -\\frac{1}{4\\pi} \\ln\\left((s-\\xi)^2 + d^2\\right)$，计算积分 $I(\\xi,d) = \\int_{-1}^{1} K(s;\\xi,d)\\,\\phi(s)\\,\\mathrm{d}s$。场点是 $\\mathbf{x}_0 = (\\xi,d)$，源位于 x 轴上的线段 $[-1,1]$ 上，由 $s$ 参数化。当场点 $\\mathbf{x}_0$ 接近或位于源线段上时，即当 $d$ 很小或为零时，该积分会带来数值计算上的挑战。\n\n问题指定了一种基于单位分解的奇异性提取算法。该积分被分为三个部分：一个可以解析处理的局部奇异部分，一个数值上良性的局部余项，以及一个同样非奇异的全局部分。\n\n1.  **积分的分解**：积分域 $[-1,1]$ 被划分。在投影点 $\\xi$ 周围定义一个局部片 $[s_{\\mathrm{lo}}, s_{\\mathrm{hi}}] = [\\max(-1,\\xi-\\varepsilon), \\min(1,\\xi+\\varepsilon)]$。然后积分 $I(\\xi,d)$ 被分解为：\n    $$\n    I(\\xi,d) = \\underbrace{\\phi(\\xi) \\int_{s_{\\mathrm{lo}}}^{s_{\\mathrm{hi}}} K(s;\\xi,d)\\,\\mathrm{d}s}_{\\text{局部奇异部分}} \\;+\\; \\underbrace{\\int_{s_{\\mathrm{lo}}}^{s_{\\mathrm{hi}}} \\big(\\phi(s)-\\phi(\\xi)\\big) K(s;\\xi,d)\\,\\mathrm{d}s}_{\\text{局部余项部分}} \\;+\\; \\underbrace{\\left(\\int_{-1}^{s_{\\mathrm{lo}}} + \\int_{s_{\\mathrm{hi}}}^{1}\\right) \\phi(s) K(s;\\xi,d)\\,\\mathrm{d}s}_{\\text{全局部分}}\n    $$\n\n2.  **各部分的计算**：\n\n    *   **局部奇异部分**：此积分进行解析计算。设 $J(a,b,\\xi,d) = \\int_{a}^{b} K(s;\\xi,d)\\,\\mathrm{d}s$。\n        核函数为 $K(s;\\xi,d) = -\\frac{1}{4\\pi} \\ln\\left((s-\\xi)^2 + d^2\\right)$。\n        对于 $d > 0$ 的情况，我们找到 $\\ln(u^2+d^2)$ 的反导数，其中 $u = s-\\xi$。反导数是 $F(u,d) = u \\ln(u^2+d^2) - 2u + 2d \\arctan(u/d)$。在 $[s_{\\mathrm{lo}}, s_{\\mathrm{hi}}]$ 上的积分通过微积分基本定理计算：$J(s_{\\mathrm{lo}},s_{\\mathrm{hi}},\\xi,d) = -\\frac{1}{4\\pi} [F(s_{\\mathrm{hi}}-\\xi, d) - F(s_{\\mathrm{lo}}-\\xi, d)]$。\n        对于奇异情况 $d = 0$，核函数简化为 $K(s;\\xi,0) = -\\frac{1}{2\\pi} \\ln|s-\\xi|$。$\\ln|u|$ 的反导数是 $H(u) = u \\ln|u| - u$。积分为 $J(s_{\\mathrm{lo}},s_{\\mathrm{hi}},\\xi,0) = -\\frac{1}{2\\pi} [H(s_{\\mathrm{hi}}-\\xi) - H(s_{\\mathrm{lo}}-\\xi)]$。一个关键细节是 $\\lim_{u\\to 0} u\\ln|u|=0$，当积分区间包含 $\\xi$ 时必须正确处理此情况。\n        局部奇异部分即为 $\\phi(\\xi) \\cdot J(s_{\\mathrm{lo}},s_{\\mathrm{hi}},\\xi,d)$。\n\n    *   **局部余项部分**：此积分为 $\\int_{s_{\\mathrm{lo}}}^{s_{\\mathrm{hi}}} \\big(\\phi(s)-\\phi(\\xi)\\big) K(s;\\xi,d)\\,\\mathrm{d}s$。对于给定的线性密度 $\\phi(s) = 1+\\beta s$，差值为 $\\phi(s)-\\phi(\\xi) = (1+\\beta s) - (1+\\beta\\xi) = \\beta(s-\\xi)$。被积函数变为 $\\beta(s-\\xi) K(s;\\xi,d)$。项 $(s-\\xi)$ 正则化了核函数的对数奇异性，因为 $\\lim_{s\\to\\xi} (s-\\xi)\\ln|s-\\xi| = 0$。得到的被积函数是光滑且有界的，使其适合使用标准数值求积法。我们采用高斯-勒让德求积法以获得高精度。\n\n    *   **全局部分**：这部分由两个积分组成，分别在 $[-1, s_{\\mathrm{lo}}]$ 和 $[s_{\\mathrm{hi}}, 1]$ 上。在这些区间上，距离 $|s-\\xi|$ 始终大于或等于局部片半宽 $\\varepsilon$（除非该片被单元边界截断，此时 $|s-\\xi|$ 仍与 $0$ 保持一定距离）。因此，被积函数 $\\phi(s)K(s;\\xi,d)$ 是光滑的，这些积分也使用高斯-勒让德求积法进行计算。\n\n3.  **数值实现**：该算法在一个 Python 函数中实现。使用 `numpy.polynomial.legendre.leggauss` 来获取节点和权重，以实现标准高斯-勒让德求积。该逻辑正确处理了 $d=0$ 的特殊情况以及局部片被截断（当 $\\xi$ 接近 $\\pm 1$ 时）的情况。每个测试用例的最终结果是计算出的三个部分之和。",
            "answer": "```python\nimport numpy as np\n\ndef gauss_quadrature(f, a, b, n=100):\n    \"\"\"\n    Evaluates the integral of f from a to b using n-point Gauss-Legendre quadrature.\n    \"\"\"\n    if a == b:\n        return 0.0\n    nodes, weights = np.polynomial.legendre.leggauss(n)\n    \n    # Map nodes from [-1, 1] to [a, b]\n    mapped_nodes = 0.5 * (b - a) * nodes + 0.5 * (a + b)\n    \n    # Evaluate the function at the mapped nodes\n    try:\n        f_vals = f(mapped_nodes)\n    except TypeError: # If f is not vectorized\n        f_vals = np.array([f(node) for node in mapped_nodes])\n\n    # The integral is the sum of weighted function values, scaled by the interval length factor\n    integral = 0.5 * (b - a) * np.sum(weights * f_vals)\n    \n    return integral\n\n\ndef evaluate_integral(xi, d, epsilon, beta, n_quad_nodes=100):\n    \"\"\"\n    Computes the integral I(xi, d) using the singularity extraction method.\n    \"\"\"\n    # 1. Define functions and parameters\n    phi = lambda s: 1 + beta * s\n    phi_xi = phi(xi)\n    \n    # 2. Define integration domains\n    s_lo = max(-1.0, xi - epsilon)\n    s_hi = min(1.0, xi + epsilon)\n    \n    # 3. Calculate the three parts of the integral\n    \n    # === Part A: Local singular part (analytic) ===\n    if d > 0:\n        # Antiderivative of ln(u^2 + d^2) is u*ln(u^2+d^2) - 2u + 2d*arctan(u/d)\n        def F_antideriv(u):\n            return u * np.log(u**2 + d**2) - 2*u + 2*d * np.arctan2(u, d)\n        \n        integral_log_term = F_antideriv(s_hi - xi) - F_antideriv(s_lo - xi)\n        # Kernel K = -1/(4*pi) * ln((s-xi)^2 + d^2)\n        analytic_local_integral_K = -0.25 / np.pi * integral_log_term\n    else:  # d == 0\n        # Antiderivative of ln|u| is u*ln|u| - u\n        def H_antideriv(u):\n            if u == 0.0:\n                return 0.0\n            return u * np.log(np.abs(u)) - u\n            \n        integral_log_term = H_antideriv(s_hi - xi) - H_antideriv(s_lo - xi)\n        # Kernel K = -1/(2*pi) * ln|s-xi|\n        analytic_local_integral_K = -0.5 / np.pi * integral_log_term\n    \n    local_singular_part = phi_xi * analytic_local_integral_K\n\n    # === Part B: Local remainder (numerical) ===\n    # Integrand is (phi(s) - phi_xi) * K(s; xi, d) = beta*(s-xi)*K(s)\n    def local_remainder_integrand(s):\n        s_minus_xi = s - xi\n        \n        if d > 0:\n            log_term = np.log(s_minus_xi**2 + d**2)\n            val = beta * s_minus_xi * (-0.25 / np.pi) * log_term\n        else:  # d == 0\n            # product is (s-xi)*ln|s-xi|, which -> 0 as s->xi\n            #\n            # Suppress RuntimeWarning for log(0)\n            with np.errstate(divide='ignore'):\n                 log_term = np.log(np.abs(s_minus_xi))\n            \n            product = s_minus_xi * log_term\n            # correct 0 * (-inf) = nan to 0.0\n            product = np.nan_to_num(product, nan=0.0) \n            val = beta * (-0.5 / np.pi) * product\n        return val\n\n    if beta == 0.0:\n        local_remainder_part = 0.0\n    else:\n        local_remainder_part = gauss_quadrature(local_remainder_integrand, s_lo, s_hi, n=n_quad_nodes)\n    \n    # === Part C: Global part (numerical) ===\n    # Integrand is phi(s) * K(s; xi, d)\n    def global_integrand(s):\n        term_for_log = (s - xi)**2 + d**2\n        kernel_val = -0.25 / np.pi * np.log(term_for_log)\n        return phi(s) * kernel_val\n    \n    global_part1 = gauss_quadrature(global_integrand, -1.0, s_lo, n=n_quad_nodes)\n    global_part2 = gauss_quadrature(global_integrand, s_hi, 1.0, n=n_quad_nodes)\n    global_part = global_part1 + global_part2\n    \n    # 4. Total integral\n    total_integral = local_singular_part + local_remainder_part + global_part\n    return total_integral\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        (0.0, 0.1, 0.2, 0.5),    # Test 1\n        (0.0, 1e-6, 0.1, 1.0),   # Test 2\n        (0.5, 0.0, 0.15, -0.3),  # Test 3\n        (0.95, 0.0, 0.2, 0.7),   # Test 4\n        (-0.3, 1.0, 0.25, 0.0),  # Test 5\n    ]\n    \n    results = []\n    for case in test_cases:\n        xi, d, epsilon, beta = case\n        result = evaluate_integral(xi, d, epsilon, beta)\n        results.append(result)\n        \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}