{
    "hands_on_practices": [
        {
            "introduction": "在处理奇异积分时，一个至关重要的第一步是理解其局部行为。本练习  提供了一种直接的方法，通过分析亥姆霍兹格林函数在一个奇点周围收缩邻域上的积分，来确定其主要渐近行为。这使我们能够将奇点精确地分类为弱奇异、强奇异或超奇异，这是发展任何有效数值处理方法的理论基础。",
            "id": "4137037",
            "problem": "考虑由亥姆霍兹方程$\\Delta p + k^2 p = 0$控制的三维空间中的时谐声学问题，其中$\\omega$是角频率，$k = \\omega/c$是声波数，$c$是声速。设$\\Gamma \\subset \\mathbb{R}^{3}$为一个光滑边界，$\\mathbf{x} \\in \\Gamma$为此边界上的一个点。亥姆霍兹算子的自由空间格林函数为\n$$\nG(\\mathbf{x},\\mathbf{y}) = \\frac{\\exp\\!\\big(i k |\\mathbf{x}-\\mathbf{y}|\\big)}{4\\pi\\,|\\mathbf{x}-\\mathbf{y}|} \\, ,\n$$\n该函数用于计算声学中的边界积分公式。定义局部片积分为\n$$\nI(\\epsilon) = \\int_{\\Gamma \\cap B_{\\epsilon}(\\mathbf{x})} G(\\mathbf{x},\\mathbf{y}) \\, d\\Gamma_{\\mathbf{y}} \\, ,\n$$\n其中$B_{\\epsilon}(\\mathbf{x})$是以$\\mathbf{x}$为中心、半径为$\\epsilon$的开球，$d\\Gamma_{\\mathbf{y}}$表示$\\Gamma$上的曲面测度。从亥姆霍兹方程和上述基本解出发，仅使用$\\Gamma$在$\\mathbf{x}$附近的局部微分几何信息（切平面和光滑性），推导当$\\epsilon \\to 0$时$I(\\epsilon)$的领阶渐近行为，并确定在$\\Gamma$上进行曲面积分的意义下，$G(\\mathbf{x},\\mathbf{y})$在$\\mathbf{y}=\\mathbf{x}$处的奇点是弱奇异、强奇异还是超奇异。将极限值$\\lim_{\\epsilon\\to 0} I(\\epsilon)$作为最终答案报告。最终答案无需四舍五入，也无需报告单位。",
            "solution": "该问题要求当积分域收缩到奇点时，计算一个包含亥姆霍兹方程自由空间格林函数的曲面积分的极限。我们已知积分\n$$\nI(\\epsilon) = \\int_{\\Gamma \\cap B_{\\epsilon}(\\mathbf{x})} G(\\mathbf{x},\\mathbf{y}) \\, d\\Gamma_{\\mathbf{y}}\n$$\n其中$G(\\mathbf{x},\\mathbf{y}) = \\frac{\\exp(i k |\\mathbf{x}-\\mathbf{y}|)}{4\\pi |\\mathbf{x}-\\mathbf{y}|}$，$\\Gamma$是$\\mathbb{R}^3$中的一个光滑曲面，$\\mathbf{x} \\in \\Gamma$，$B_{\\epsilon}(\\mathbf{x})$是以$\\mathbf{x}$为中心、半径为$\\epsilon$的球。我们要求解$\\lim_{\\epsilon \\to 0} I(\\epsilon)$。\n\n分析此积分最好在以点$\\mathbf{x}$为中心的局部坐标系中进行。我们将坐标系的原点设在$\\mathbf{x}$。我们将$\\xi_1$轴和$\\xi_2$轴与切平面$T_{\\mathbf{x}}\\Gamma$的一个标准正交基对齐，并将$\\xi_3$轴与该点的法向量$\\mathbf{n}(\\mathbf{x})$对齐。\n\n在$\\mathbf{x}$邻域内，曲面$\\Gamma$上的点$\\mathbf{y}$可以由切平面中的坐标$(\\xi_1, \\xi_2)$参数化。$\\mathbf{y}$相对于$\\mathbf{x}$的位置向量由$(\\xi_1, \\xi_2, h(\\xi_1, \\xi_2))$给出，其中$\\xi_3 = h(\\xi_1, \\xi_2)$描述了曲面相对于切平面的抬升高度。由于$\\Gamma$是光滑的，且平面$\\xi_3=0$在原点处与曲面相切，函数$h$必须满足$h(0,0)=0$和$\\frac{\\partial h}{\\partial \\xi_1}(0,0) = \\frac{\\partial h}{\\partial \\xi_2}(0,0) = 0$。$h$在$(0,0)$附近的泰勒展开为$h(\\xi_1, \\xi_2) = \\mathcal{O}(\\rho^2)$，其中$\\rho = \\sqrt{\\xi_1^2 + \\xi_2^2}$是切平面中的径向距离。\n\n接下来，我们在这个局部坐标系中，对小的$\\rho$分析被积函数和积分测度的分量。\n\n1.  **距离$|\\mathbf{x}-\\mathbf{y}|$**：令$r = |\\mathbf{x}-\\mathbf{y}|$。在我们的局部坐标系中，这是从原点到点$(\\xi_1, \\xi_2, h(\\xi_1, \\xi_2))$的距离。\n    $$\n    r = \\sqrt{\\xi_1^2 + \\xi_2^2 + h(\\xi_1, \\xi_2)^2} = \\sqrt{\\rho^2 + \\mathcal{O}(\\rho^4)} = \\rho \\sqrt{1 + \\mathcal{O}(\\rho^2)} = \\rho \\left(1 + \\mathcal{O}(\\rho^2)\\right)\n    $$\n    对于小的$\\rho$，领阶项就是$r \\approx \\rho$。\n\n2.  **曲面元$d\\Gamma_{\\mathbf{y}}$**：曲面微元由下式给出\n    $$\n    d\\Gamma_{\\mathbf{y}} = \\sqrt{1 + \\left(\\frac{\\partial h}{\\partial \\xi_1}\\right)^2 + \\left(\\frac{\\partial h}{\\partial \\xi_2}\\right)^2} \\, d\\xi_1 d\\xi_2\n    $$\n    由于$\\nabla h = \\mathcal{O}(\\rho)$，我们有$(\\nabla h)^2 = \\mathcal{O}(\\rho^2)$。因此，\n    $$\n    d\\Gamma_{\\mathbf{y}} = \\sqrt{1 + \\mathcal{O}(\\rho^2)} \\, d\\xi_1 d\\xi_2 = (1+\\mathcal{O}(\\rho^2)) \\, d\\xi_1 d\\xi_2\n    $$\n    领阶近似为$d\\Gamma_{\\mathbf{y}} \\approx d\\xi_1 d\\xi_2$。\n\n3.  **积分域$\\Gamma \\cap B_{\\epsilon}(\\mathbf{x})$**：这是$\\mathbf{y} \\in \\Gamma$且满足$|\\mathbf{x}-\\mathbf{y}|  \\epsilon$的点的集合。在局部坐标系中，这个条件是$r  \\epsilon$，即$\\rho(1+\\mathcal{O}(\\rho^2))  \\epsilon$。当$\\epsilon \\to 0$时，曲面上的这个域渐近等价于切平面中的开圆盘$D_{\\epsilon} = \\{(\\xi_1, \\xi_2) \\in \\mathbb{R}^2 \\mid \\rho  \\epsilon\\}$。\n\n将这些领阶近似代入积分$I(\\epsilon)$，我们得到：\n$$\nI(\\epsilon) \\approx \\int_{D_{\\epsilon}} \\frac{\\exp(i k \\rho)}{4\\pi \\rho} \\, d\\xi_1 d\\xi_2\n$$\n为了计算在圆盘$D_{\\epsilon}$上的这个积分，我们在$(\\xi_1, \\xi_2)$平面中转换到极坐标$(\\rho, \\theta)$。这里，$\\xi_1 = \\rho \\cos\\theta$，$\\xi_2 = \\rho \\sin\\theta$，面积元为$d\\xi_1 d\\xi_2 = \\rho \\, d\\rho \\, d\\theta$。积分限为$0 \\le \\rho  \\epsilon$和$0 \\le \\theta  2\\pi$。\n$$\nI(\\epsilon) \\approx \\int_0^{2\\pi} \\int_0^\\epsilon \\frac{\\exp(i k \\rho)}{4\\pi \\rho} \\rho \\, d\\rho \\, d\\theta\n$$\n来自极坐标雅可比行列式的因子$\\rho$与格林函数分母中的$\\rho$相消。这种相消是该奇点为弱奇点的关键原因。\n$$\nI(\\epsilon) \\approx \\frac{1}{4\\pi} \\int_0^{2\\pi} d\\theta \\int_0^\\epsilon \\exp(i k \\rho) \\, d\\rho\n$$\n关于$\\theta$的积分是$\\int_0^{2\\pi} d\\theta = 2\\pi$。\n$$\nI(\\epsilon) \\approx \\frac{2\\pi}{4\\pi} \\int_0^\\epsilon \\exp(i k \\rho) \\, d\\rho = \\frac{1}{2} \\int_0^\\epsilon \\exp(i k \\rho) \\, d\\rho\n$$\n剩下的关于$\\rho$的积分是初等的：\n$$\n\\int_0^\\epsilon \\exp(i k \\rho) \\, d\\rho = \\left[ \\frac{\\exp(i k \\rho)}{ik} \\right]_0^\\epsilon = \\frac{\\exp(i k \\epsilon) - \\exp(0)}{ik} = \\frac{\\exp(i k \\epsilon) - 1}{ik}\n$$\n因此，$I(\\epsilon)$的领阶渐近表达式为：\n$$\nI(\\epsilon) \\approx \\frac{\\exp(i k \\epsilon) - 1}{2ik}\n$$\n为求得所需极限，我们在此表达式中令$\\epsilon \\to 0$。由于指数函数是连续的，$\\lim_{\\epsilon \\to 0} \\exp(i k \\epsilon) = \\exp(0) = 1$。\n$$\n\\lim_{\\epsilon \\to 0} I(\\epsilon) = \\lim_{\\epsilon \\to 0} \\frac{\\exp(i k \\epsilon) - 1}{2ik} = \\frac{1 - 1}{2ik} = 0\n$$\n$I(\\epsilon)$的领阶行为可以通过对指数项在小的$\\epsilon$处进行泰勒展开得到：\n$$\n\\exp(i k \\epsilon) = 1 + i k \\epsilon + \\mathcal{O}((k\\epsilon)^2)\n$$\n将此代入我们关于$I(\\epsilon)$的表达式：\n$$\nI(\\epsilon) \\approx \\frac{(1 + i k \\epsilon + \\mathcal{O}(\\epsilon^2)) - 1}{2ik} = \\frac{i k \\epsilon + \\mathcal{O}(\\epsilon^2)}{2ik} = \\frac{\\epsilon}{2} + \\mathcal{O}(\\epsilon^2)\n$$\n这证实了当$\\epsilon \\to 0$时，$I(\\epsilon) \\to 0$。\n\n核函数$G(\\mathbf{x}, \\mathbf{y})$的奇点阶数为$|\\mathbf{x}-\\mathbf{y}|^{-1}$。在$\\mathbb{R}^3$的曲面积分情形下，曲面测度$d\\Gamma_{\\mathbf{y}}$的局部行为像$\\rho \\, d\\rho \\, d\\theta$。因此被积函数的行为像$\\rho^{-1} \\cdot \\rho$，是正则的。由于在任何包含该奇点的任意小邻域上的积分都存在且有限，该奇点被归类为**弱**奇异。\n\n最终答案是该极限的值。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "理解了表面上的奇点后，一个相关且常见的挑战是“近奇异”情况，即评估点非常靠近积分表面。标准的数值求积方法在这种情况下会产生巨大误差。本练习  演示了一种强大的技术：通过用等面积的圆盘近似单元几何形状，并对核的奇异部分进行精确解析积分，从而推导出解析的近奇异校正项。",
            "id": "4137057",
            "problem": "在计算声学中，用于频域 Helmholtz 方程的边界元法 (BEM) 使用自由空间格林函数$G_{k}(\\mathbf{r},\\mathbf{r}')=\\frac{\\exp(\\mathrm{i}k|\\mathbf{r}-\\mathbf{r}'|)}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}$来表示单层势。对于一个评估点$\\mathbf{r}=(0,0,\\delta)$（其中$\\delta>0$）和一个位于$z=0$平面内、形心在原点、面积为$A$的平坦三角形单元$\\mathcal{T}$，单层被积函数的近奇异行为由主奇异项$G_{\\mathrm{sing}}(\\mathbf{r},\\mathbf{r}')=\\frac{1}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}$所主导。一个标准的基于形心的求积方法将奇异贡献近似为$A/(4\\pi\\delta)$，当$\\delta$相对于单元尺寸较小时，这会产生很大的误差。\n\n将近奇异修正$C_{\\mathrm{sing}}(A,\\delta)$定义为奇异部分在单元上的解析积分减去其基于形心的近似值，即：\n$$\nC_{\\mathrm{sing}}(A,\\delta)\\equiv \\int_{\\mathcal{T}} \\frac{1}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}\\,\\mathrm{d}S' \\;-\\; \\frac{A}{4\\pi\\delta}.\n$$\n仅使用形心附近的领头阶奇异结构，并假设该单元可以局部地由一个位于$z=0$平面内、以原点为中心、面积相等的圆盘$\\mathcal{D}$来近似，其中半径$R_{e}$的选择满足$\\pi R_{e}^{2}=A$，通过在$\\mathcal{D}$上精确积分奇异核函数$1/(4\\pi|\\mathbf{r}-\\mathbf{r}'|)$，并减去形心项$A/(4\\pi\\delta)$，来推导$C_{\\mathrm{sing}}(A,\\delta)$的闭式解析表达式。\n\n以$A$和$\\delta$的单个闭式表达式的形式给出最终答案。不要进行任何数值舍入。最终表达式中无需报告物理单位。",
            "solution": "目标是通过用一个面积为$A$的圆盘$\\mathcal{D}$近似三角形单元$\\mathcal{T}$，来计算近奇异修正项$C_{\\mathrm{sing}}(A,\\delta)$。待计算的公式为：\n$$\nC_{\\mathrm{sing}}(A,\\delta) = \\left( \\int_{\\mathcal{D}} \\frac{1}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}\\,\\mathrm{d}S' \\right) - \\frac{A}{4\\pi\\delta}\n$$\n圆盘$\\mathcal{D}$位于$z=0$平面内，以原点为中心，面积为$A$。因此，其半径$R_e$由关系$\\pi R_{e}^{2}=A$给出，这意味着$R_{e}^{2} = A/\\pi$。\n\n首先，我们计算积分项。评估点为$\\mathbf{r} = (0,0,\\delta)$。圆盘$\\mathcal{D}$上的源点$\\mathbf{r}'$可以用柱坐标参数化为$(x', y', z') = (\\rho'\\cos\\phi', \\rho'\\sin\\phi', 0)$，其中$\\rho'$是离原点的径向距离，$\\phi'$是方位角。距离$|\\mathbf{r}-\\mathbf{r}'|$为：\n$$\n|\\mathbf{r}-\\mathbf{r}'| = \\sqrt{(0-\\rho'\\cos\\phi')^{2} + (0-\\rho'\\sin\\phi')^{2} + (\\delta-0)^{2}} = \\sqrt{(\\rho')^{2}(\\cos^{2}\\phi' + \\sin^{2}\\phi')} + \\delta^{2}} = \\sqrt{(\\rho')^{2}+\\delta^{2}}\n$$\n在这些坐标系中，微分面元为$\\mathrm{d}S' = \\rho'\\,\\mathrm{d}\\rho'\\,\\mathrm{d}\\phi'$。圆盘的积分限为$0 \\leq \\rho' \\leq R_e$和$0 \\leq \\phi' \\leq 2\\pi$。\n\n积分设置如下：\n$$\n\\int_{\\mathcal{D}} \\frac{1}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}\\,\\mathrm{d}S' = \\int_{0}^{2\\pi} \\int_{0}^{R_e} \\frac{1}{4\\pi\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\rho'\\,\\mathrm{d}\\rho'\\,\\mathrm{d}\\phi'\n$$\n我们可以提出常数$1/(4\\pi)$，并注意到被积函数与$\\phi'$无关，因此可以先对$\\phi'$进行积分：\n$$\n\\frac{1}{4\\pi} \\left( \\int_{0}^{2\\pi} \\mathrm{d}\\phi' \\right) \\left( \\int_{0}^{R_e} \\frac{\\rho'}{\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\mathrm{d}\\rho' \\right) = \\frac{2\\pi}{4\\pi} \\int_{0}^{R_e} \\frac{\\rho'}{\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\mathrm{d}\\rho' = \\frac{1}{2} \\int_{0}^{R_e} \\frac{\\rho'}{\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\mathrm{d}\\rho'\n$$\n为求解剩下关于$\\rho'$的积分，我们使用换元法$u = (\\rho')^{2} + \\delta^{2}$。这得到$\\mathrm{d}u = 2\\rho'\\,\\mathrm{d}\\rho'$，即$\\rho'\\,\\mathrm{d}\\rho' = \\frac{1}{2}\\mathrm{d}u$。积分变换为：\n$$\n\\int \\frac{\\rho'}{\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\mathrm{d}\\rho' = \\int \\frac{\\frac{1}{2}\\mathrm{d}u}{\\sqrt{u}} = \\frac{1}{2} \\int u^{-1/2} \\mathrm{d}u = \\frac{1}{2} \\frac{u^{1/2}}{1/2} = \\sqrt{u} = \\sqrt{(\\rho')^{2}+\\delta^{2}}\n$$\n计算定积分：\n$$\n\\int_{0}^{R_e} \\frac{\\rho'}{\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\mathrm{d}\\rho' = \\left[ \\sqrt{(\\rho')^{2}+\\delta^{2}} \\right]_{0}^{R_e} = \\sqrt{R_{e}^{2}+\\delta^{2}} - \\sqrt{0^{2}+\\delta^{2}} = \\sqrt{R_{e}^{2}+\\delta^{2}} - \\delta\n$$\n将其代回，积分项的值为：\n$$\n\\int_{\\mathcal{D}} \\frac{1}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}\\,\\mathrm{d}S' = \\frac{1}{2} \\left( \\sqrt{R_{e}^{2}+\\delta^{2}} - \\delta \\right)\n$$\n现在，我们可以写出$C_{\\mathrm{sing}}(A,\\delta)$的完整表达式：\n$$\nC_{\\mathrm{sing}}(A,\\delta) = \\frac{1}{2} \\left( \\sqrt{R_{e}^{2}+\\delta^{2}} - \\delta \\right) - \\frac{A}{4\\pi\\delta}\n$$\n最后，我们代入$R_{e}^{2} = A/\\pi$，将结果完全用给定的参数$A$和$\\delta$表示。\n$$\nC_{\\mathrm{sing}}(A,\\delta) = \\frac{1}{2} \\left( \\sqrt{\\frac{A}{\\pi}+\\delta^{2}} - \\delta \\right) - \\frac{A}{4\\pi\\delta}\n$$\n这就是在指定的圆盘近似下，近奇异修正的最终闭式解析表达式。",
            "answer": "$$\\boxed{\\frac{1}{2}\\left(\\sqrt{\\frac{A}{\\pi} + \\delta^{2}} - \\delta\\right) - \\frac{A}{4\\pi\\delta}}$$"
        },
        {
            "introduction": "理论最终必须转化为稳健的计算机代码。本练习  将指导您实现一个完整而实用的数值策略——使用单位分解的“奇性减除法”。该方法优雅地将奇异/近奇异部分与积分的常规部分分离开来，并对前者进行解析处理，这是构建可靠边界元方法软件的基石。",
            "id": "4137082",
            "problem": "考虑静态（零频率）极限下的二维声学势，其自由空间格林函数由$G(\\mathbf{x},\\mathbf{y}) = -\\dfrac{1}{2\\pi} \\ln \\|\\mathbf{x} - \\mathbf{y}\\|$给出。在计算声学的边界积分公式中，我们经常需要计算如下形式的积分：\n$$\nI(\\xi,d) = \\int_{-1}^{1} K(s;\\xi,d)\\,\\phi(s)\\,\\mathrm{d}s,\n$$\n其中$s \\in [-1,1]$是沿$x$轴的平直边界段的参数化，场点为$\\mathbf{x}_0 = (\\xi,d)$（其中$\\xi \\in \\mathbb{R}$且$d \\ge 0$），核函数为\n$$\nK(s;\\xi,d) = -\\frac{1}{2\\pi} \\ln\\left(\\sqrt{(s-\\xi)^2 + d^2}\\right),\n$$\n边界源密度是一个给定的光滑函数$\\phi(s)$。当$d = 0$且$\\xi \\in [-1,1]$时，该积分为对数奇异；当$d$很小但为正时，该积分为近奇异。\n\n您的任务是实现单位分解，将积分分割为局部和全局分片，对局部分片应用奇异性提取，并对全局分片使用标准求积法：\n\n1. 选择一个局部分片半宽参数$\\varepsilon > 0$并定义局部分片$[s_{\\mathrm{lo}}, s_{\\mathrm{hi}}] = [\\max(-1,\\xi-\\varepsilon), \\min(1,\\xi+\\varepsilon)]$。通过在$[s_{\\mathrm{lo}}, s_{\\mathrm{hi}}]$上等于$1$、在其他地方等于$0$的局部权重$w_{\\mathrm{loc}}(s)$，以及全局权重$w_{\\mathrm{glob}}(s) = 1 - w_{\\mathrm{loc}}(s)$来定义单位分解。\n2. 在局部分片上，通过减去并加回项$\\phi(\\xi)\\,K(s;\\xi,d)$来执行奇异性提取。更精确地，写作：\n$$\nI(\\xi,d) = \\underbrace{\\int_{s_{\\mathrm{lo}}}^{s_{\\mathrm{hi}}} \\left[ K(s;\\xi,d)\\,\\big(\\phi(s)-\\phi(\\xi)\\big) \\right]\\,\\mathrm{d}s}_{\\text{局部余项}} \\;+\\; \\underbrace{\\phi(\\xi) \\int_{s_{\\mathrm{lo}}}^{s_{\\mathrm{hi}}} K(s;\\xi,d)\\,\\mathrm{d}s}_{\\text{局部奇异部分（解析）}} \\;+\\; \\underbrace{\\int_{-1}^{s_{\\mathrm{lo}}} K(s;\\xi,d)\\,\\phi(s)\\,\\mathrm{d}s + \\int_{s_{\\mathrm{hi}}}^{1} K(s;\\xi,d)\\,\\phi(s)\\,\\mathrm{d}s}_{\\text{全局部分}}。\n$$\n3. 解析地计算局部奇异部分。使用具有足够多节点数的标准高斯-勒让德求积法计算局部余项和全局部分，以确保数值稳定性和准确性。\n\n对特定的选择$\\phi(s) = 1 + \\beta s$实现上述算法，其中$\\beta$是一个实数参数。使用以下参数集测试套件$(\\xi, d, \\varepsilon, \\beta)$，它探究了多种情况：\n\n- 测试 1 (一般近奇异，内部): $(\\xi, d, \\varepsilon, \\beta) = (0.0, 0.1, 0.2, 0.5)$。\n- 测试 2 (强近奇异，内部): $(\\xi, d, \\varepsilon, \\beta) = (0.0, 10^{-6}, 0.1, 1.0)$。\n- 测试 3 (面上奇异，内部): $(\\xi, d, \\varepsilon, \\beta) = (0.5, 0.0, 0.15, -0.3)$。\n- 测试 4 (面上奇异，靠近边界截断): $(\\xi, d, \\varepsilon, \\beta) = (0.95, 0.0, 0.2, 0.7)$。\n- 测试 5 (远场，恒定密度): $(\\xi, d, \\varepsilon, \\beta) = (-0.3, 1.0, 0.25, 0.0)$。\n\n您的程序应生成单行输出，其中包含五个测试的$I(\\xi,d)$的数值，按顺序排列，以逗号分隔并用方括号括起来（例如，\"[result1,result2,result3,result4,result5]\"）。结果必须是无量纲单位的实数（浮点数）。",
            "solution": "核心任务是对于给定的线性源密度$\\phi(s)=1+\\beta s$和对数核函数$K(s;\\xi,d) = -\\frac{1}{4\\pi} \\ln\\left((s-\\xi)^2 + d^2\\right)$，计算积分\n$$\nI(\\xi,d) = \\int_{-1}^{1} K(s;\\xi,d)\\,\\phi(s)\\,\\mathrm{d}s\n$$\n场点为$\\mathbf{x}_0 = (\\xi,d)$，源位于 x 轴上的线段$[-1,1]$上，由$s$参数化。当场点$\\mathbf{x}_0$靠近或位于源段上时，即当$d$很小或为零时，该积分带来了数值计算上的挑战。\n\n问题指定了一种基于单位分解的奇异性提取算法。积分被分成三个部分：可以解析处理的局部奇异部分，数值上良性的局部余项，以及同样非奇异的全局部分。\n\n1.  **积分分解**：积分域$[-1,1]$被划分。在投影点$\\xi$周围定义一个局部分片$[s_{\\mathrm{lo}}, s_{\\mathrm{hi}}] = [\\max(-1,\\xi-\\varepsilon), \\min(1,\\xi+\\varepsilon)]$。然后积分$I(\\xi,d)$被分解为：\n    $$\n    I(\\xi,d) = \\underbrace{\\phi(\\xi) \\int_{s_{\\mathrm{lo}}}^{s_{\\mathrm{hi}}} K(s;\\xi,d)\\,\\mathrm{d}s}_{\\text{局部奇异部分}} \\;+\\; \\underbrace{\\int_{s_{\\mathrm{lo}}}^{s_{\\mathrm{hi}}} \\big(\\phi(s)-\\phi(\\xi)\\big) K(s;\\xi,d)\\,\\mathrm{d}s}_{\\text{局部余项部分}} \\;+\\; \\underbrace{\\left(\\int_{-1}^{s_{\\mathrm{lo}}} + \\int_{s_{\\mathrm{hi}}}^{1}\\right) \\phi(s) K(s;\\xi,d)\\,\\mathrm{d}s}_{\\text{全局部分}}\n    $$\n\n2.  **各部分的计算**：\n\n    *   **局部奇异部分**：此积分可解析计算。令$J(a,b,\\xi,d) = \\int_{a}^{b} K(s;\\xi,d)\\,\\mathrm{d}s$。\n        核函数为$K(s;\\xi,d) = -\\frac{1}{4\\pi} \\ln\\left((s-\\xi)^2 + d^2\\right)$。\n        对于$d > 0$的情况，我们求$\\ln(u^2+d^2)$的不定积分，其中$u = s-\\xi$。不定积分为$F(u,d) = u \\ln(u^2+d^2) - 2u + 2d \\arctan(u/d)$。在$[s_{\\mathrm{lo}}, s_{\\mathrm{hi}}]$上的积分使用微积分基本定理计算：$J(s_{\\mathrm{lo}},s_{\\mathrm{hi}},\\xi,d) = -\\frac{1}{4\\pi} [F(s_{\\mathrm{hi}}-\\xi, d) - F(s_{\\mathrm{lo}}-\\xi, d)]$。\n        对于奇异情况$d = 0$，核函数简化为$K(s;\\xi,0) = -\\frac{1}{2\\pi} \\ln|s-\\xi|$。$\\ln|u|$的不定积分为$H(u) = u \\ln|u| - u$。积分为$J(s_{\\mathrm{lo}},s_{\\mathrm{hi}},\\xi,0) = -\\frac{1}{2\\pi} [H(s_{\\mathrm{hi}}-\\xi) - H(s_{\\mathrm{lo}}-\\xi)]$。一个关键细节是$\\lim_{u\\to 0} u\\ln|u|=0$，当积分区间包含$\\xi$时必须正确处理此问题。\n        局部奇异部分即为$\\phi(\\xi) \\cdot J(s_{\\mathrm{lo}},s_{\\mathrm{hi}}, \\xi, d)$。\n\n    *   **局部余项部分**：此积分为$\\int_{s_{\\mathrm{lo}}}^{s_{\\mathrm{hi}}} \\big(\\phi(s)-\\phi(\\xi)\\big) K(s;\\xi,d)\\,\\mathrm{d}s$。对于给定的线性密度$\\phi(s) = 1+\\beta s$，差值为$\\phi(s)-\\phi(\\xi) = (1+\\beta s) - (1+\\beta\\xi) = \\beta(s-\\xi)$。被积函数变为$\\beta(s-\\xi) K(s;\\xi,d)$。项$(s-\\xi)$对核函数的对数奇异性进行了正则化，因为$\\lim_{s\\to\\xi} (s-\\xi)\\ln|s-\\xi| = 0$。得到的被积函数是光滑且有界的，使其适合于标准数值求积。我们采用高斯-勒让德求积法以获得高精度。\n\n    *   **全局部分**：这部分由两个积分组成，分别在$[-1, s_{\\mathrm{lo}}]$和$[s_{\\mathrm{hi}}, 1]$上。在这些区间上，距离$|s-\\xi|$总是大于或等于局部分片半宽$\\varepsilon$（除非分片被单元边界截断，在这种情况下$|s-\\xi|$仍然有界且不为零）。因此，被积函数$\\phi(s)K(s;\\xi,d)$是光滑的，这些积分也使用高斯-勒让德求积法计算。\n\n3.  **数值实现**：该算法在一个 Python 函数中实现。标准高斯-勒让德求积法通过使用`numpy.polynomial.legendre.leggauss`来获取节点和权重实现。该逻辑正确处理了$d=0$的特殊情况以及局部分片被截断（当$\\xi$接近$\\pm 1$时）的情况。每个测试用例的最终结果是计算出的三个部分的总和。",
            "answer": "```python\nimport numpy as np\n\ndef gauss_quadrature(f, a, b, n=100):\n    \"\"\"\n    Evaluates the integral of f from a to b using n-point Gauss-Legendre quadrature.\n    \"\"\"\n    if a == b:\n        return 0.0\n    nodes, weights = np.polynomial.legendre.leggauss(n)\n    \n    # Map nodes from [-1, 1] to [a, b]\n    mapped_nodes = 0.5 * (b - a) * nodes + 0.5 * (a + b)\n    \n    # Evaluate the function at the mapped nodes\n    try:\n        f_vals = f(mapped_nodes)\n    except TypeError: # If f is not vectorized\n        f_vals = np.array([f(node) for node in mapped_nodes])\n\n    # The integral is the sum of weighted function values, scaled by the interval length factor\n    integral = 0.5 * (b - a) * np.sum(weights * f_vals)\n    \n    return integral\n\n\ndef evaluate_integral(xi, d, epsilon, beta, n_quad_nodes=100):\n    \"\"\"\n    Computes the integral I(xi, d) using the singularity extraction method.\n    \"\"\"\n    # 1. Define functions and parameters\n    phi = lambda s: 1 + beta * s\n    phi_xi = phi(xi)\n    \n    # 2. Define integration domains\n    s_lo = max(-1.0, xi - epsilon)\n    s_hi = min(1.0, xi + epsilon)\n    \n    # 3. Calculate the three parts of the integral\n    \n    # === Part A: Local singular part (analytic) ===\n    if d > 0:\n        # Antiderivative of ln(u^2 + d^2) is u*ln(u^2+d^2) - 2u + 2d*arctan(u/d)\n        def F_antideriv(u):\n            return u * np.log(u**2 + d**2) - 2*u + 2*d * np.arctan2(u, d)\n        \n        integral_log_term = F_antideriv(s_hi - xi) - F_antideriv(s_lo - xi)\n        # Kernel K = -1/(4*pi) * ln((s-xi)^2 + d^2)\n        analytic_local_integral_K = -0.25 / np.pi * integral_log_term\n    else:  # d == 0\n        # Antiderivative of ln|u| is u*ln|u| - u\n        def H_antideriv(u):\n            if u == 0.0:\n                return 0.0\n            return u * np.log(np.abs(u)) - u\n            \n        integral_log_term = H_antideriv(s_hi - xi) - H_antideriv(s_lo - xi)\n        # Kernel K = -1/(2*pi) * ln|s-xi|\n        analytic_local_integral_K = -0.5 / np.pi * integral_log_term\n    \n    local_singular_part = phi_xi * analytic_local_integral_K\n\n    # === Part B: Local remainder (numerical) ===\n    # Integrand is (phi(s) - phi_xi) * K(s; xi, d) = beta*(s-xi)*K(s)\n    def local_remainder_integrand(s):\n        s_minus_xi = s - xi\n        \n        if d > 0:\n            log_term = np.log(s_minus_xi**2 + d**2)\n            val = beta * s_minus_xi * (-0.25 / np.pi) * log_term\n        else:  # d == 0\n            # product is (s-xi)*ln|s-xi|, which -> 0 as s->xi\n            #\n            # Suppress RuntimeWarning for log(0)\n            with np.errstate(divide='ignore'):\n                 log_term = np.log(np.abs(s_minus_xi))\n            \n            product = s_minus_xi * log_term\n            # correct 0 * (-inf) = nan to 0.0\n            product = np.nan_to_num(product, nan=0.0) \n            val = beta * (-0.5 / np.pi) * product\n        return val\n\n    if beta == 0.0:\n        local_remainder_part = 0.0\n    else:\n        local_remainder_part = gauss_quadrature(local_remainder_integrand, s_lo, s_hi, n=n_quad_nodes)\n    \n    # === Part C: Global part (numerical) ===\n    # Integrand is phi(s) * K(s; xi, d)\n    def global_integrand(s):\n        term_for_log = (s - xi)**2 + d**2\n        kernel_val = -0.25 / np.pi * np.log(term_for_log)\n        return phi(s) * kernel_val\n    \n    global_part1 = gauss_quadrature(global_integrand, -1.0, s_lo, n=n_quad_nodes)\n    global_part2 = gauss_quadrature(global_integrand, s_hi, 1.0, n=n_quad_nodes)\n    global_part = global_part1 + global_part2\n    \n    # 4. Total integral\n    total_integral = local_singular_part + local_remainder_part + global_part\n    return total_integral\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        (0.0, 0.1, 0.2, 0.5),    # Test 1\n        (0.0, 1e-6, 0.1, 1.0),   # Test 2\n        (0.5, 0.0, 0.15, -0.3),  # Test 3\n        (0.95, 0.0, 0.2, 0.7),   # Test 4\n        (-0.3, 1.0, 0.25, 0.0),  # Test 5\n    ]\n    \n    results = []\n    for case in test_cases:\n        xi, d, epsilon, beta = case\n        result = evaluate_integral(xi, d, epsilon, beta)\n        results.append(result)\n        \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}