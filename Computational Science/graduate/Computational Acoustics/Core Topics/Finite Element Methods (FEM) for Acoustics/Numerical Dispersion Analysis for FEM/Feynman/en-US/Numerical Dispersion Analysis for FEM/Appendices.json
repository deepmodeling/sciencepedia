{
    "hands_on_practices": [
        {
            "introduction": "Understanding numerical dispersion begins with the simplest case: a one-dimensional wave. This foundational practice walks you through the essential process of deriving the dispersion relation for the Finite Element Method from first principles. By performing a small-wavenumber expansion, you will quantify the leading-order phase error, a key metric for evaluating the accuracy of any numerical wave propagation scheme.",
            "id": "4132541",
            "problem": "Consider one-dimensional acoustic wave propagation in a homogeneous medium with sound speed $c$, modeled by the partial differential equation $\\partial^{2} p / \\partial t^{2} = c^{2} \\, \\partial^{2} p / \\partial x^{2}$ for the acoustic pressure $p(x,t)$. Discretize the spatial domain with a uniform mesh of size $h$ using the standard linear Lagrange basis functions in the Finite Element Method (FEM) and use the consistent mass matrix. Assume a spatially periodic setting and analyze the semi-discrete system (continuous in time, discrete in space) under a Bloch-wave ansatz $p_{j}(t) = \\hat{p} \\exp(i (j \\varphi - \\omega t))$, where $j \\in \\mathbb{Z}$ indexes the mesh nodes, $\\omega$ is the angular frequency, and $\\varphi$ is the Bloch phase per element measured in radians.\n\nStarting from the weak form and the element matrices, derive the semi-discrete dispersion relation linking the continuous wavenumber $k = \\omega / c$ and the Bloch phase $\\varphi$, and use it to obtain the small-$kh$ expansion of the discrete phase velocity ratio $c_{p}/c$, where $c_{p} = \\omega / \\kappa$ and $\\kappa = \\varphi / h$. Show that\n$$\n\\frac{c_{p}}{c} = 1 - \\alpha (k h)^{2} + \\mathcal{O}\\!\\left((k h)^{4}\\right),\n$$\nfor sufficiently small $k h$, and determine the constant $\\alpha$ for linear elements with the consistent mass matrix. Express your final value of $\\alpha$ as a reduced rational number with no units. Angles (the Bloch phase $\\varphi$) must be treated in radians.",
            "solution": "The user wants to solve a problem regarding the numerical dispersion of the Finite Element Method (FEM) for the 1D wave equation.\n\n### Step 1: Extract Givens\n-   **Governing Equation**: The one-dimensional acoustic wave equation is $\\frac{\\partial^{2} p}{\\partial t^{2}} = c^{2} \\frac{\\partial^{2} p}{\\partial x^{2}}$.\n-   **Physical Parameters**: The medium is homogeneous with a constant sound speed $c$.\n-   **Discretization Method**: A uniform mesh with element size $h$ is used. The spatial approximation employs standard linear Lagrange basis functions within the FEM framework. The consistent mass matrix is to be used.\n-   **Boundary Conditions**: The setting is spatially periodic.\n-   **Analysis Ansatz**: A semi-discrete Bloch-wave solution is assumed, $p_{j}(t) = \\hat{p} \\exp(i (j \\varphi - \\omega t))$, where $p_j(t)$ is the pressure at node $j$, $\\omega$ is the angular frequency, and $\\varphi$ is the Bloch phase per element in radians.\n-   **Definitions**:\n    -   Continuous wavenumber: $k = \\omega / c$.\n    -   Numerical wavenumber: $\\kappa = \\varphi / h$.\n    -   Numerical phase velocity: $c_{p} = \\omega / \\kappa$.\n-   **Objective**:\n    1.  Derive the semi-discrete dispersion relation.\n    2.  Find the small-$kh$ expansion for the phase velocity ratio $c_{p}/c$.\n    3.  Show that the expansion has the form $\\frac{c_{p}}{c} = 1 - \\alpha (k h)^{2} + \\mathcal{O}\\!\\left((k h)^{4}\\right)$.\n    4.  Determine the constant $\\alpha$.\n    5.  Express $\\alpha$ as a reduced rational number.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, being a standard topic in the numerical analysis of partial differential equations, specifically computational acoustics. It is well-posed, with all necessary information provided (PDE, discretization method, basis functions, mass matrix type, and analysis ansatz) to uniquely determine the requested constant $\\alpha$. The terminology is precise and objective. There are no contradictions, missing data, or scientifically unsound premises. The problem is a non-trivial exercise in deriving and analyzing the properties of a numerical scheme.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Solution Derivation\n\nThe solution process begins with the weak formulation of the governing PDE, proceeds to the FEM discretization to find the element matrices, assembles the system equation, applies the Bloch-wave ansatz to derive the dispersion relation, and finally performs a Taylor series expansion to find the requested constant $\\alpha$.\n\n**1. Weak Formulation**\nThe wave equation is $p_{tt} - c^2 p_{xx} = 0$. We multiply by a test function $v(x)$ and integrate over the domain $\\Omega$.\n$$ \\int_{\\Omega} v \\frac{\\partial^{2} p}{\\partial t^{2}} \\, dx - c^2 \\int_{\\Omega} v \\frac{\\partial^{2} p}{\\partial x^{2}} \\, dx = 0 $$\nIntegrating the second term by parts yields:\n$$ \\int_{\\Omega} v \\frac{\\partial^2 p}{\\partial t^2} \\, dx + c^2 \\int_{\\Omega} \\frac{\\partial v}{\\partial x} \\frac{\\partial p}{\\partial x} \\, dx - c^2 \\left[v \\frac{\\partial p}{\\partial x}\\right]_{\\partial\\Omega} = 0 $$\nFor a periodic domain, the boundary terms cancel upon assembly of the global system. The weak form to be discretized is:\n$$ \\int_{\\Omega} v \\frac{\\partial^2 p}{\\partial t^2} \\, dx + c^2 \\int_{\\Omega} \\frac{\\partial v}{\\partial x} \\frac{\\partial p}{\\partial x} \\, dx = 0 $$\n\n**2. FEM Discretization and Element Matrices**\nWe use linear Lagrange basis functions on a generic element $e = [x_j, x_{j+1}]$ of length $h$. In local coordinates $\\xi = (x - x_j)/h \\in [0, 1]$, the basis functions are $N_1(\\xi) = 1-\\xi$ and $N_2(\\xi) = \\xi$. Their derivatives with respect to $x$ are $\\frac{dN_1}{dx} = -\\frac{1}{h}$ and $\\frac{dN_2}{dx} = \\frac{1}{h}$. The pressure field is approximated as $p^h(x,t) = \\sum_{j} p_j(t) N_j(x)$.\n\nThe semi-discrete system takes the form $M \\ddot{\\mathbf{p}} + K \\mathbf{p} = \\mathbf{0}$. The element matrices for an element of length $h$ are:\n\n-   **Consistent Element Mass Matrix ($M^e$)**:\n    $M^e_{ik} = \\int_{e} N_i N_k \\, dx = h \\int_0^1 N_i(\\xi) N_k(\\xi) \\, d\\xi$.\n    $$ M^e = h \\begin{pmatrix} \\int_0^1 (1-\\xi)^2 d\\xi & \\int_0^1 (1-\\xi)\\xi d\\xi \\\\ \\int_0^1 \\xi(1-\\xi) d\\xi & \\int_0^1 \\xi^2 d\\xi \\end{pmatrix} = h \\begin{pmatrix} 1/3 & 1/6 \\\\ 1/6 & 1/3 \\end{pmatrix} = \\frac{h}{6} \\begin{pmatrix} 2 & 1 \\\\ 1 & 2 \\end{pmatrix} $$\n-   **Element Stiffness Matrix ($K^e$)**:\n    $K^e_{ik} = c^2 \\int_e \\frac{dN_i}{dx}\\frac{dN_k}{dx} \\, dx$.\n    $$ K^e = c^2 \\int_0^h \\begin{pmatrix} (-1/h)^2 & (-1/h)(1/h) \\\\ (1/h)(-1/h) & (1/h)^2 \\end{pmatrix} dx = \\frac{c^2}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} $$\n\n**3. Assembly and Equation for Node $j$**\nThe equation for a generic node $j$ is obtained by summing contributions from element $j-1$ (connecting nodes $j-1, j$) and element $j$ (connecting nodes $j, j+1$).\n-   Mass term: $\\frac{h}{6}(\\ddot{p}_{j-1} + 2\\ddot{p}_j) + \\frac{h}{6}(2\\ddot{p}_j + \\ddot{p}_{j+1}) = \\frac{h}{6}(\\ddot{p}_{j-1} + 4\\ddot{p}_j + \\ddot{p}_{j+1})$.\n-   Stiffness term: $\\frac{c^2}{h}(-p_{j-1} + p_j) + \\frac{c^2}{h}(p_j - p_{j+1}) = \\frac{c^2}{h}(-p_{j-1} + 2p_j - p_{j+1})$.\n\nThe assembled semi-discrete equation for node $j$ is:\n$$ \\frac{h}{6}(\\ddot{p}_{j-1} + 4\\ddot{p}_j + \\ddot{p}_{j+1}) + \\frac{c^2}{h}(-p_{j-1} + 2p_j - p_{j+1}) = 0 $$\n\n**4. Dispersion Analysis**\nWe substitute the Bloch-wave ansatz $p_j(t) = \\hat{p} \\exp(i (j \\varphi - \\omega t))$. This implies $\\ddot{p}_j = -\\omega^2 p_j$, $p_{j-1} = p_j e^{-i\\varphi}$, and $p_{j+1} = p_j e^{i\\varphi}$. Substituting and dividing by $p_j$:\n$$ -\\omega^2 \\frac{h}{6}(e^{-i\\varphi} + 4 + e^{i\\varphi}) + \\frac{c^2}{h}(-e^{-i\\varphi} + 2 - e^{i\\varphi}) = 0 $$\nUsing Euler's identity $e^{i\\varphi} + e^{-i\\varphi} = 2\\cos\\varphi$:\n$$ -\\omega^2 \\frac{h}{6}(2\\cos\\varphi + 4) + \\frac{c^2}{h}(2 - 2\\cos\\varphi) = 0 $$\n$$ -\\omega^2 \\frac{h}{3}(2 + \\cos\\varphi) + \\frac{2c^2}{h}(1 - \\cos\\varphi) = 0 $$\nSolving for $\\omega^2$ gives the dispersion relation:\n$$ \\omega^2 = \\frac{6c^2}{h^2} \\frac{1 - \\cos\\varphi}{2 + \\cos\\varphi} $$\n\n**5. Phase Velocity Expansion**\nThe numerical phase velocity is $c_p = \\omega/\\kappa = \\omega h / \\varphi$. The ratio to the exact speed is $c_p/c = \\omega h/(c\\varphi)$. Squaring this ratio and substituting the dispersion relation yields:\n$$ \\left(\\frac{c_p}{c}\\right)^2 = \\frac{\\omega^2 h^2}{c^2 \\varphi^2} = \\frac{h^2}{c^2 \\varphi^2} \\left( \\frac{6c^2}{h^2} \\frac{1 - \\cos\\varphi}{2 + \\cos\\varphi} \\right) = \\frac{6}{\\varphi^2} \\frac{1 - \\cos\\varphi}{2 + \\cos\\varphi} $$\nWe expand this expression for small $\\varphi$. The relevant Taylor series are:\n$\\cos\\varphi = 1 - \\frac{\\varphi^2}{2!} + \\frac{\\varphi^4}{4!} - \\mathcal{O}(\\varphi^6)$.\n$$ 1 - \\cos\\varphi = \\frac{\\varphi^2}{2} - \\frac{\\varphi^4}{24} + \\mathcal{O}(\\varphi^6) $$\n$$ 2 + \\cos\\varphi = 3 - \\frac{\\varphi^2}{2} + \\mathcal{O}(\\varphi^4) $$\nThe ratio becomes:\n$$ \\frac{1 - \\cos\\varphi}{2 + \\cos\\varphi} = \\frac{\\frac{\\varphi^2}{2} (1 - \\frac{\\varphi^2}{12} + \\ldots)}{3 (1 - \\frac{\\varphi^2}{6} + \\ldots)} = \\frac{\\varphi^2}{6} \\left(1 - \\frac{\\varphi^2}{12}\\right) \\left(1 + \\frac{\\varphi^2}{6}\\right) + \\mathcal{O}(\\varphi^6) = \\frac{\\varphi^2}{6} \\left(1 + \\frac{\\varphi^2}{12}\\right) + \\mathcal{O}(\\varphi^6) = \\frac{\\varphi^2}{6} + \\frac{\\varphi^4}{72} + \\mathcal{O}(\\varphi^6) $$\nSubstitute this back into the expression for $(c_p/c)^2$:\n$$ \\left(\\frac{c_p}{c}\\right)^2 = \\frac{6}{\\varphi^2} \\left( \\frac{\\varphi^2}{6} + \\frac{\\varphi^4}{72} + \\mathcal{O}(\\varphi^6) \\right) = 1 + \\frac{\\varphi^2}{12} + \\mathcal{O}(\\varphi^4) $$\nTaking the square root (using $\\sqrt{1+x} \\approx 1 + x/2$ for small $x$):\n$$ \\frac{c_p}{c} = \\sqrt{1 + \\frac{\\varphi^2}{12} + \\mathcal{O}(\\varphi^4)} = 1 + \\frac{1}{2} \\left( \\frac{\\varphi^2}{12} \\right) + \\mathcal{O}(\\varphi^4) = 1 + \\frac{\\varphi^2}{24} + \\mathcal{O}(\\varphi^4) $$\nTo express this in terms of $kh$, we relate $\\varphi$ and $kh$. From the dispersion relation, $(kh)^2 = (\\omega h/c)^2 = 6 \\frac{1-\\cos\\varphi}{2+\\cos\\varphi}$.\n$$(kh)^2 = 6 \\left(\\frac{\\varphi^2}{6} + \\frac{\\varphi^4}{72} + \\mathcal{O}(\\varphi^6)\\right) = \\varphi^2 + \\frac{\\varphi^4}{12} + \\mathcal{O}(\\varphi^6)$$\nFor small values, $\\varphi^2 = (kh)^2 + \\mathcal{O}((kh)^4)$. Substituting this into the expansion for $c_p/c$:\n$$ \\frac{c_p}{c} = 1 + \\frac{(kh)^2 + \\mathcal{O}((kh)^4)}{24} + \\mathcal{O}((kh)^4) = 1 + \\frac{1}{24} (kh)^2 + \\mathcal{O}((kh)^4) $$\nThis expression represents a phase lead phenomenon ($c_p > c$).\n\n**6. Determination of $\\alpha$**\nWe must match our derived expansion to the form given in the problem statement:\n$$ \\frac{c_p}{c} = 1 - \\alpha (k h)^{2} + \\mathcal{O}\\!\\left((k h)^{4}\\right) $$\nBy comparing the coefficients of the $(kh)^2$ term, we have:\n$$ 1 + \\frac{1}{24}(kh)^2 = 1 - \\alpha(kh)^2 $$\n$$ \\frac{1}{24} = -\\alpha $$\nTherefore, the constant $\\alpha$ is:\n$$ \\alpha = -\\frac{1}{24} $$\nThis value is a reduced rational number, as requested.",
            "answer": "$$\\boxed{-\\frac{1}{24}}$$"
        },
        {
            "introduction": "When moving from one to multiple dimensions, a new challenge emerges: numerical anisotropy, where the wave speed error depends on the direction of propagation. This exercise extends the analysis to a two-dimensional grid, focusing on the propagation direction that often exhibits maximum error. By comparing the Finite Element Method to a standard Finite Difference scheme, you will gain insight into the relative performance and anisotropic behavior of these two cornerstone methods in computational science.",
            "id": "4132483",
            "problem": "Consider time-harmonic acoustics in a homogeneous, lossless two-dimensional medium, where the complex pressure field $p$ satisfies the Helmholtz equation $-\\nabla^{2} p - k^{2} p = 0$ with real wavenumber $k > 0$. A plane wave propagates at an angle of $45^\\circ$ relative to the Cartesian grid axes.\n\nTwo standard spatial discretizations on the same uniform square mesh of spacing $h$ are considered:\n- the second-order five-point Finite Difference (FD) scheme for the Laplacian, and\n- the bilinear Continuous Galerkin Finite Element Method (FEM) with the consistent mass matrix.\n\nFor each discretization, define the numerical wavenumber magnitude $\\xi$ as the modulus of the discrete phase vector that satisfies the corresponding discrete dispersion relation for a plane wave oriented at $45^\\circ$, i.e., with equal Cartesian components. Define the phase error as the magnitude of the relative wavenumber error $E = |\\xi - k|/k$.\n\nAssume equal Degrees of Freedom (DOFs) per wavelength between FD and FEM, quantified by the Points Per Wavelength (PPW) $Q = 2 \\pi / (k h)$. Work in the high-resolution regime where $Q$ is large (equivalently, $k h$ is small), and derive, from first principles starting at the Helmholtz equation and the respective discrete operators, the leading-order asymptotic expressions of $E$ for waves propagating at $45^\\circ$ for both FD and FEM, expressed purely in terms of $Q$ and $\\pi$. The final answer must be a single row vector containing, in order, the FD and FEM phase error magnitudes. The answer is dimensionless and no rounding is required.",
            "solution": "We begin from the Helmholtz equation $-\\nabla^{2} p - k^{2} p = 0$ for a homogeneous medium. For a plane wave $p(\\boldsymbol{x}) = \\exp(\\mathrm{i} \\boldsymbol{k} \\cdot \\boldsymbol{x})$ with $|\\boldsymbol{k}| = k$ propagating at $45^\\circ$, the continuous wavenumber components satisfy $k_{x} = k/\\sqrt{2}$ and $k_{y} = k/\\sqrt{2}$.\n\nWe analyze, for each scheme, the discrete dispersion relation satisfied by a discrete plane wave $u_{m,n} = \\exp\\left( \\mathrm{i} (m \\theta_{x} + n \\theta_{y}) \\right)$, where $\\theta_{x} = \\xi_{x} h$ and $\\theta_{y} = \\xi_{y} h$ are the discrete phase angles associated with grid spacing $h$, and $\\boldsymbol{\\xi}$ is the numerical wavenumber vector. For $45^\\circ$ propagation, we impose $\\xi_{x} = \\xi/\\sqrt{2}$ and $\\xi_{y} = \\xi/\\sqrt{2}$, hence $\\theta_{x} = \\theta_{y} = \\theta := \\xi h / \\sqrt{2}$. We will compute $\\xi$ as a function of $k$ and $h$ and then form the phase error $E = |\\xi - k| / k$.\n\nWe define the Points Per Wavelength (PPW) $Q = 2 \\pi / (k h)$, so that the dimensionless small parameter is $s := k h = 2 \\pi / Q$. Our goal is the leading-order asymptotic behavior of $E$ for large $Q$ (small $s$).\n\nFinite Difference (FD) five-point Laplacian:\nFor the second-order FD Laplacian on a square grid,\n$$\n-\\Delta_{h} u \\ \\widehat{}\\ (\\theta_{x}, \\theta_{y})\n\\;=\\; \\frac{2}{h^{2}} \\left( 2 - \\cos(\\theta_{x}) - \\cos(\\theta_{y}) \\right).\n$$\nThe discrete Helmholtz operator is $-\\Delta_{h} - k^{2}$, so the FD dispersion relation for a discrete plane wave is\n$$\n\\frac{2}{h^{2}} \\left( 2 - \\cos(\\theta_{x}) - \\cos(\\theta_{y}) \\right) \\;=\\; k^{2}.\n$$\nFor $45^\\circ$ propagation, $\\theta_{x} = \\theta_{y} = \\theta$, hence\n$$\n\\frac{2}{h^{2}} \\left( 2 - 2 \\cos(\\theta) \\right) \\;=\\; k^{2},\n\\quad\\text{or}\\quad\n\\frac{4}{h^{2}} \\left( 1 - \\cos(\\theta) \\right) \\;=\\; k^{2}.\n$$\nUsing $1 - \\cos(\\theta) = 2 \\sin^{2}(\\theta/2)$, we obtain\n$$\n\\frac{8}{h^{2}} \\sin^{2}\\!\\left( \\frac{\\theta}{2} \\right) \\;=\\; k^{2}.\n$$\nRecall $\\theta = \\xi h / \\sqrt{2}$, so\n$$\n\\frac{8}{h^{2}} \\sin^{2}\\!\\left( \\frac{\\xi h}{2 \\sqrt{2}} \\right) \\;=\\; k^{2},\n\\quad\\Rightarrow\\quad\n\\sin^{2}\\!\\left( \\frac{\\xi h}{2 \\sqrt{2}} \\right) \\;=\\; \\frac{k^{2} h^{2}}{8} \\;=\\; \\frac{s^{2}}{8}.\n$$\nWe solve this asymptotically for $\\xi$ when $s$ is small. Let $\\alpha := \\frac{\\xi h}{\\sqrt{2}}$, so the relation is\n$$\n\\sin^{2}\\!\\left( \\frac{\\alpha}{2} \\right) \\;=\\; \\frac{s^{2}}{8}.\n$$\nWe expand $\\sin^{2}(\\alpha/2)$ for small $\\alpha$:\n$$\n\\sin^{2}\\!\\left( \\frac{\\alpha}{2} \\right)\n\\;=\\; \\frac{\\alpha^{2}}{4} - \\frac{\\alpha^{4}}{48} + \\mathcal{O}(\\alpha^{6}).\n$$\nThis yields\n$$\n\\frac{\\alpha^{2}}{4} - \\frac{\\alpha^{4}}{48} \\;=\\; \\frac{s^{2}}{8} + \\mathcal{O}(s^{6}).\n$$\nWith $\\alpha = \\frac{\\xi h}{\\sqrt{2}} = \\frac{s}{\\sqrt{2}} \\zeta$ where $\\zeta := \\xi/k$, we find\n$$\n\\frac{s^{2} \\zeta^{2}}{8} - \\frac{s^{4} \\zeta^{4}}{192} \\;=\\; \\frac{s^{2}}{8} + \\mathcal{O}(s^{6}).\n$$\nDivide by $s^{2}$ and retain terms up to $\\mathcal{O}(s^{2})$:\n$$\n\\frac{\\zeta^{2}}{8} - \\frac{s^{2} \\zeta^{4}}{192} \\;=\\; \\frac{1}{8}.\n$$\nRearrange to\n$$\n\\zeta^{2} - \\frac{s^{2}}{24} \\zeta^{4} \\;=\\; 1.\n$$\nSeek $\\zeta = 1 + a s^{2} + \\mathcal{O}(s^{4})$. Substituting and keeping $\\mathcal{O}(s^{2})$ terms:\n$$\n(1 + 2 a s^{2}) - \\frac{s^{2}}{24} (1) \\;=\\; 1 + \\mathcal{O}(s^{4}),\n$$\nwhich gives $2 a - \\frac{1}{24} = 0$, hence $a = \\frac{1}{48}$. Therefore\n$$\n\\frac{\\xi - k}{k} \\;=\\; \\zeta - 1 \\;=\\; \\frac{s^{2}}{48} + \\mathcal{O}(s^{4}).\n$$\nThe phase error magnitude is thus\n$$\nE_{\\mathrm{FD}} \\;=\\; \\left| \\frac{\\xi - k}{k} \\right| \\;=\\; \\frac{s^{2}}{48} + \\mathcal{O}(s^{4}).\n$$\nIn terms of $Q$, since $s = 2 \\pi / Q$, we obtain\n$$\nE_{\\mathrm{FD}} \\;=\\; \\frac{(2 \\pi)^{2}}{48\\, Q^{2}} + \\mathcal{O}(Q^{-4}) \\;=\\; \\frac{\\pi^{2}}{12\\, Q^{2}} + \\mathcal{O}(Q^{-4}).\n$$\n\nFinite Element Method (FEM) bilinear Continuous Galerkin with consistent mass:\nStart from the weak form: find $u$ such that\n$$\n\\int_{\\Omega} \\nabla u \\cdot \\nabla v \\,\\mathrm{d}\\boldsymbol{x} - k^{2} \\int_{\\Omega} u v \\,\\mathrm{d}\\boldsymbol{x} = 0\n$$\nfor all test functions $v$. On a uniform square mesh of spacing $h$, using bilinear ($Q1$) shape functions and the consistent mass matrix, the assembled global operators can be expressed via one-dimensional tensor products. Denote the one-dimensional stiffness and mass symbols for a uniform $Q1$ mesh by\n$$\nK_{1\\mathrm{D}}(\\theta) \\;=\\; \\frac{4}{h} \\sin^{2}\\!\\left( \\frac{\\theta}{2} \\right),\n\\qquad\nM_{1\\mathrm{D}}(\\theta) \\;=\\; \\frac{2 h}{3} + \\frac{h}{3} \\cos(\\theta).\n$$\nFor the two-dimensional bilinear case, the stiffness and mass symbols are\n$$\nK(\\theta_{x}, \\theta_{y}) \\;=\\; K_{1\\mathrm{D}}(\\theta_{x}) M_{1\\mathrm{D}}(\\theta_{y}) + M_{1\\mathrm{D}}(\\theta_{x}) K_{1\\mathrm{D}}(\\theta_{y}),\n\\qquad\nM(\\theta_{x}, \\theta_{y}) \\;=\\; M_{1\\mathrm{D}}(\\theta_{x}) M_{1\\mathrm{D}}(\\theta_{y}).\n$$\nThe discrete Helmholtz symbol is $A(\\theta_{x}, \\theta_{y}) = K(\\theta_{x}, \\theta_{y}) - k^{2} M(\\theta_{x}, \\theta_{y})$. For $45^\\circ$ propagation ($\\theta_{x} = \\theta_{y} = \\theta$),\n$$\nK(\\theta, \\theta) \\;=\\; 2 K_{1\\mathrm{D}}(\\theta) M_{1\\mathrm{D}}(\\theta),\n\\qquad\nM(\\theta, \\theta) \\;=\\; M_{1\\mathrm{D}}(\\theta)^{2}.\n$$\nThus the dispersion relation $A(\\theta, \\theta) = 0$ reduces to\n$$\n2 K_{1\\mathrm{D}}(\\theta) - k^{2} M_{1\\mathrm{D}}(\\theta) \\;=\\; 0,\n$$\nor explicitly\n$$\n\\frac{8}{h} \\sin^{2}\\!\\left( \\frac{\\theta}{2} \\right) \\;=\\; k^{2} \\left( \\frac{2 h}{3} + \\frac{h}{3} \\cos(\\theta) \\right).\n$$\nDivide both sides by $h$ and write $s = k h$:\n$$\n\\sin^{2}\\!\\left( \\frac{\\theta}{2} \\right) \\;=\\; \\frac{s^{2}}{24} \\left( 2 + \\cos(\\theta) \\right).\n$$\nRecall $\\theta = \\xi h / \\sqrt{2} = \\alpha$ as before, with $\\alpha = \\frac{s}{\\sqrt{2}} \\zeta$. We substitute the small-$\\alpha$ expansions\n$$\n\\sin^{2}\\!\\left( \\frac{\\alpha}{2} \\right)\n\\;=\\; \\frac{\\alpha^{2}}{4} - \\frac{\\alpha^{4}}{48} + \\mathcal{O}(\\alpha^{6}),\n\\qquad\n\\cos(\\alpha)\n\\;=\\; 1 - \\frac{\\alpha^{2}}{2} + \\frac{\\alpha^{4}}{24} + \\mathcal{O}(\\alpha^{6}),\n$$\nto obtain\n$$\n\\frac{s^{2} \\zeta^{2}}{8} - \\frac{s^{4} \\zeta^{4}}{192}\n\\;=\\; \\frac{s^{2}}{24} \\left( 2 + 1 - \\frac{\\alpha^{2}}{2} + \\frac{\\alpha^{4}}{24} \\right)\n\\;=\\; \\frac{s^{2}}{24} \\left( 3 - \\frac{s^{2} \\zeta^{2}}{4} + \\frac{s^{4} \\zeta^{4}}{96} \\right) + \\mathcal{O}(s^{6}).\n$$\nDropping $\\mathcal{O}(s^{4})$ terms on the right-hand side and retaining $\\mathcal{O}(s^{2})$ corrections on the left-hand side, we have\n$$\n\\frac{\\zeta^{2}}{8} - \\frac{s^{2} \\zeta^{4}}{192} \\;=\\; \\frac{1}{8} - \\frac{s^{2} \\zeta^{2}}{96}.\n$$\nMultiply by $192$:\n$$\n24 \\zeta^{2} - s^{2} \\zeta^{4} \\;=\\; 24 - 2 s^{2} \\zeta^{2}.\n$$\nRearrange:\n$$\n24 (\\zeta^{2} - 1) + s^{2} \\left( - \\zeta^{4} + 2 \\zeta^{2} \\right) \\;=\\; 0.\n$$\nSeeking $\\zeta = 1 + a s^{2} + \\mathcal{O}(s^{4})$, we compute $\\zeta^{2} \\approx 1 + 2 a s^{2}$ and $\\zeta^{4} \\approx 1 + 4 a s^{2}$, and substitute:\n$$\n24 (2 a s^{2}) + s^{2} \\left( -1 - 4 a s^{2} + 2 + 4 a s^{2} \\right) \\;=\\; 0\n\\;\\Rightarrow\\;\n48 a s^{2} + s^{2} (1) \\;=\\; 0.\n$$\nHence $48 a + 1 = 0$, so $a = -\\frac{1}{48}$. Therefore\n$$\n\\frac{\\xi - k}{k} \\;=\\; \\zeta - 1 \\;=\\; - \\frac{s^{2}}{48} + \\mathcal{O}(s^{4}).\n$$\nThe phase error magnitude is\n$$\nE_{\\mathrm{FEM}} \\;=\\; \\left| \\frac{\\xi - k}{k} \\right| \\;=\\; \\frac{s^{2}}{48} + \\mathcal{O}(s^{4})\n\\;=\\; \\frac{(2 \\pi)^{2}}{48\\, Q^{2}} + \\mathcal{O}(Q^{-4})\n\\;=\\; \\frac{\\pi^{2}}{12\\, Q^{2}} + \\mathcal{O}(Q^{-4}).\n$$\n\nComparison at equal DOFs per wavelength:\nWith $Q = 2 \\pi / (k h)$ common to both methods, the leading-order phase error magnitudes for waves propagating at $45^\\circ$ are identical:\n$$\nE_{\\mathrm{FD}} \\;=\\; E_{\\mathrm{FEM}} \\;=\\; \\frac{\\pi^{2}}{12\\, Q^{2}} + \\mathcal{O}(Q^{-4}).\n$$\nTherefore, to leading order in $Q^{-2}$, both the FD five-point scheme and the bilinear FEM with consistent mass incur the same maximum phase error magnitude at $45^\\circ$, equal to $\\pi^{2} / (12\\, Q^{2})$.",
            "answer": "$$\\boxed{\\begin{pmatrix}\\dfrac{\\pi^{2}}{12\\,Q^{2}} & \\dfrac{\\pi^{2}}{12\\,Q^{2}}\\end{pmatrix}}$$"
        },
        {
            "introduction": "While analytical derivations provide crucial insights for specific directions , a complete picture of anisotropy requires a computational approach. This practice challenges you to bridge theory and application by implementing a program to numerically solve the full 2D dispersion relation for bilinear elements. By mapping the phase velocity error across all propagation angles, you will directly measure and visualize the mesh-induced anisotropy, a critical skill for any practitioner of computational wave modeling.",
            "id": "4132495",
            "problem": "Consider the monochromatic acoustic pressure field governed by the scalar Helmholtz equation, derived from the acoustic wave equation by seeking time-harmonic solutions. Let the acoustic wave equation be given by $ \\frac{1}{c^2} \\frac{\\partial^2 p}{\\partial t^2} - \\Delta p = 0 $, where $ p(\\mathbf{x},t) $ is the acoustic pressure, $ c $ is the sound speed, and $ \\Delta $ is the Laplacian operator. For a time-harmonic field $ p(\\mathbf{x},t) = \\Re\\{ u(\\mathbf{x}) e^{-i \\omega t} \\} $ with angular frequency $ \\omega $, the spatial amplitude $ u(\\mathbf{x}) $ satisfies the Helmholtz equation $ -\\Delta u - k^2 u = 0 $, where $ k = \\omega / c $ is the continuous wavenumber. On an infinite, uniformly structured square mesh with spacing $ h $, consider the Finite Element Method (FEM) using bilinear quadrilateral elements ($ Q_1 $). Assume periodicity so that assembly yields translation-invariant discrete operators.\n\nStarting from the weak form, the assembled global system for the interior nodes can be expressed in terms of a stiffness operator $ \\mathbf{K} $ and a mass operator $ \\mathbf{M} $ as $ \\mathbf{K} u - k^2 \\mathbf{M} u = 0 $. For this problem, the stiffness operator $\\mathbf{K}$ is taken to be the standard five-point finite-difference Laplacian, and the consistent mass operator $\\mathbf{M}$ for $Q_1$ elements is used, which results in a nine-point stencil. Consider a plane-wave ansatz $u_{i,j} = e^{i (i \\zeta_x + j \\zeta_y)}$ with $\\zeta_x = \\zeta \\cos \\theta$, $\\zeta_y = \\zeta \\sin \\theta$, and $\\zeta = \\kappa h$ the dimensionless discrete wavenumber magnitude. The symbol of the stiffness operator for the five-point stencil is $S(\\zeta_x,\\zeta_y) = 4 - 2 (\\cos \\zeta_x + \\cos \\zeta_y)$. For the consistent $ Q_1 $ mass matrix, using the reference element shape functions $N_1 = (1-x)(1-y)$, $N_2 = x(1-y)$, $N_3 = xy$, $N_4 = (1-x)y$ on the unit square, one obtains the element-level integrals $\\int N_1^2 \\, dx \\, dy = \\frac{1}{9}$, $\\int N_1 N_2 \\, dx \\, dy = \\frac{1}{18}$, $\\int N_1 N_3 \\, dx \\, dy = \\frac{1}{36}$, $\\int N_1 N_4 \\, dx \\, dy = \\frac{1}{18}$, and by symmetry the full consistent mass stencil at an interior node has weights $w_0 = \\frac{4 h^2}{9}$ at the center, $w_1 = \\frac{h^2}{9}$ at axis-adjacent neighbors, and $w_2 = \\frac{h^2}{36}$ at diagonal neighbors. The symbol of the mass operator is therefore $M(\\zeta_x,\\zeta_y) = \\frac{4}{9} + \\frac{2}{9}(\\cos \\zeta_x + \\cos \\zeta_y) + \\frac{1}{9} \\cos \\zeta_x \\cos \\zeta_y$.\n\nImposing $ \\mathbf{K} u - k^2 \\mathbf{M} u = 0 $ for the plane wave yields the discrete dispersion relation\n$$\nS(\\zeta_x,\\zeta_y) - (k h)^2 M(\\zeta_x,\\zeta_y) = 0,\n$$\nwith $ S(\\zeta_x,\\zeta_y) = 4 - 2 (\\cos \\zeta_x + \\cos \\zeta_y) $ and $ M(\\zeta_x,\\zeta_y) = \\frac{4}{9} + \\frac{2}{9}(\\cos \\zeta_x + \\cos \\zeta_y) + \\frac{1}{9} \\cos \\zeta_x \\cos \\zeta_y $, where $ \\zeta_x = \\zeta \\cos \\theta $ and $ \\zeta_y = \\zeta \\sin \\theta $. The numerical phase velocity $ c_{\\mathrm{num}}(\\theta) $ is defined by $ \\omega = c_{\\mathrm{num}}(\\theta) \\kappa(\\theta) $, while the continuous phase velocity is $ c_{\\mathrm{cont}} = \\omega / k $. For a given direction $ \\theta $, the ratio of numerical to continuous phase velocity is\n$$\n\\frac{c_{\\mathrm{num}}(\\theta)}{c_{\\mathrm{cont}}} = \\frac{k}{\\kappa(\\theta)} = \\frac{k h}{\\zeta(\\theta)}.\n$$\nDefine the angular phase velocity relative error as\n$$\nE(\\theta) = \\left| \\frac{k h}{\\zeta(\\theta)} - 1 \\right|,\n$$\nand the worst-case angular error over directions as\n$$\nE_{\\mathrm{worst}}(k h) = \\max_{\\theta \\in [0,\\pi/2]} E(\\theta),\n$$\nwhere $ \\theta $ is measured in radians. To quantify mesh-induced anisotropy, define the anisotropy coefficient as\n$$\nA(k h) = \\max_{\\theta \\in [0,\\pi/2]} \\frac{k h}{\\zeta(\\theta)} - \\min_{\\theta \\in [0,\\pi/2]} \\frac{k h}{\\zeta(\\theta)}.\n$$\n\nYour task is to implement a program that, for specified values of the nondimensional wavenumber $ k h $, computes $ \\zeta(\\theta) $ by numerically solving the dispersion relation for each $ \\theta \\in [0,\\pi/2] $ using a robust root-finding method on the interval $ \\zeta \\in (0,\\pi] $, evaluates $ E_{\\mathrm{worst}}(k h) $, and evaluates $ A(k h) $. Use angular samples uniformly spaced on $ [0,\\pi/2] $ with $ N_\\theta = 721 $ points, including endpoints, and treat $ \\theta $ in radians. The solution must be dimensionless, and the final numerical outputs must be floats rounded to eight decimal places.\n\nTest Suite:\n- Case $ 1 $: $ k h = \\pi/60 $.\n- Case $ 2 $: $ k h = \\pi/12 $.\n- Case $ 3 $: $ k h = \\pi/6 $.\n\nFor each case, produce a two-element list containing $ [ E_{\\mathrm{worst}}(k h), A(k h) ] $ as decimals (no percentage sign). Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one case and is itself a two-element list. For example, the output format should be like $ [ [x_1,y_1],[x_2,y_2],[x_3,y_3] ] $, but with actual numeric values and no spaces between elements. Angles must be treated in radians throughout.",
            "solution": "The problem is first assessed for validity.\n\n### Step 1: Extract Givens\n- **Governing Equation**: Acoustic wave equation $ \\frac{1}{c^2} \\frac{\\partial^2 p}{\\partial t^2} - \\Delta p = 0 $, leading to the Helmholtz equation $ -\\Delta u - k^2 u = 0 $ for time-harmonic solutions, where $ k = \\omega/c $.\n- **Discretization Method**: Finite Element Method (FEM) on a uniform square mesh with spacing $ h $, using bilinear quadrilateral ($ Q_1 $) elements.\n- **Discrete System**: $ \\mathbf{K} u - k^2 \\mathbf{M} u = 0 $, where $ \\mathbf{K} $ is the stiffness operator and $ \\mathbf{M} $ is the mass operator.\n- **Plane-Wave Ansatz**: $ u_{i,j} = e^{i (i \\zeta_x + j \\zeta_y)} $ with dimensionless wavenumbers $ \\zeta_x = \\zeta \\cos \\theta $ and $ \\zeta_y = \\zeta \\sin \\theta $, where $ \\zeta = \\kappa h $.\n- **Operator Symbols**:\n  - Stiffness symbol: $ S(\\zeta_x,\\zeta_y) = 4 - 2 (\\cos \\zeta_x + \\cos \\zeta_y) $.\n  - Mass symbol: $ M(\\zeta_x,\\zeta_y) = \\frac{4}{9} + \\frac{2}{9}(\\cos \\zeta_x + \\cos \\zeta_y) + \\frac{1}{9} \\cos \\zeta_x \\cos \\zeta_y $.\n- **Discrete Dispersion Relation**: $ S(\\zeta_x,\\zeta_y) - (k h)^2 M(\\zeta_x,\\zeta_y) = 0 $.\n- **Quantities to Compute**:\n  - Phase velocity ratio: $ \\frac{c_{\\mathrm{num}}(\\theta)}{c_{\\mathrm{cont}}} = \\frac{k h}{\\zeta(\\theta)} $.\n  - Worst-case angular phase velocity relative error: $ E_{\\mathrm{worst}}(k h) = \\max_{\\theta \\in [0,\\pi/2]} \\left| \\frac{k h}{\\zeta(\\theta)} - 1 \\right| $.\n  - Anisotropy coefficient: $ A(k h) = \\max_{\\theta \\in [0,\\pi/2]} \\frac{k h}{\\zeta(\\theta)} - \\min_{\\theta \\in [0,\\pi/2]} \\frac{k h}{\\zeta(\\theta)} $.\n- **Numerical Parameters**:\n  - Angular domain: $ \\theta \\in [0,\\pi/2] $ (radians).\n  - Angular sampling: $ N_\\theta = 721 $ uniformly spaced points.\n  - Root-finding domain for $ \\zeta $: $ \\zeta \\in (0,\\pi] $.\n  - Output format: Floating-point numbers rounded to eight decimal places.\n- **Test Suite**:\n  - Case $ 1 $: $ k h = \\pi/60 $.\n  - Case $ 2 $: $ k h = \\pi/12 $.\n  - Case $ 3 $: $ k h = \\pi/6 $.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement describes a standard numerical dispersion analysis for a finite element scheme, a common procedure in computational acoustics and wave propagation.\n- **Scientific Grounding**: The derivation from the wave equation to the Helmholtz equation, the formulation of a FEM system, and the use of a plane-wave ansatz (a form of von Neumann analysis) are all standard and scientifically sound principles. The provided stencils and corresponding symbols for the stiffness and mass operators for $ Q_1 $ elements on a uniform square grid are correct.\n- **Well-Posed**: For any given valid inputs $ k h \\in \\mathbb{R}^+ $ and $ \\theta \\in [0, \\pi/2] $, the dispersion relation is a single transcendental equation for a single unknown, $ \\zeta $. Analysis shows that for small $ k h $, a unique solution $ \\zeta \\approx k h $ exists. The function $ F(\\zeta) = S - (kh)^2 M $ is continuous and well-behaved on the specified search interval $ (0, \\pi] $. It can be shown that $ F(\\zeta) $ changes sign over this interval, ensuring a root exists by the Intermediate Value Theorem. A robust numerical root-finder can thus be reliably used.\n- **Objective and Complete**: The problem is stated using precise mathematical language. All necessary equations, definitions, constants, and numerical parameters required for a solution are provided. The problem is self-contained and objective.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, well-posed, and complete. It is deemed **valid**.\n\n### Solution Derivation\n\nThe core of the problem is to analyze the numerical dispersion properties of a $Q_1$ FEM scheme for the Helmholtz equation. This requires solving the discrete dispersion relation for the dimensionless discrete wavenumber, $ \\zeta $, as a function of the propagation angle, $ \\theta $, for a fixed continuous wavenumber, $ k $.\n\nFor a given dimensionless continuous wavenumber $ k h $ and a propagation angle $ \\theta $, we must find the root $ \\zeta $ of the following transcendental equation:\n$$\nf(\\zeta; k h, \\theta) = S(\\zeta \\cos \\theta, \\zeta \\sin \\theta) - (k h)^2 M(\\zeta \\cos \\theta, \\zeta \\sin \\theta) = 0\n$$\nThis equation cannot be solved for $ \\zeta $ analytically in general. Therefore, a numerical approach is necessary. We will discretize the angular domain $ \\theta \\in [0, \\pi/2] $ into $ N_\\theta = 721 $ uniformly spaced points. For each sample angle $ \\theta_i $, we will solve the equation $ f(\\zeta; k h, \\theta_i) = 0 $ for $ \\zeta_i = \\zeta(\\theta_i) $ using a numerical root-finding algorithm.\n\nThe problem specifies searching for $ \\zeta $ in the interval $ (0, \\pi] $. A suitable and robust algorithm for this task is the Brent-Dekker method (`brentq` in SciPy's optimization library), which guarantees convergence provided it is given a bracketing interval $ [a, b] $ where $ f(a) $ and $ f(b) $ have opposite signs.\nLet's analyze the function $ f(\\zeta) $ at the boundaries of the search domain:\n1.  As $ \\zeta \\to 0^+ $, we can use Taylor series expansions: $ \\cos(x) \\approx 1 - x^2/2 $.\n    - $ S(\\zeta_x, \\zeta_y) = 4 - 2(\\cos(\\zeta_x) + \\cos(\\zeta_y)) \\approx \\zeta_x^2 + \\zeta_y^2 = \\zeta^2 $.\n    - $ M(\\zeta_x, \\zeta_y) \\approx 1 $.\n    - Thus, $ f(\\zeta) \\approx \\zeta^2 - (k h)^2 $. For $ \\zeta \\to 0^+ $ (specifically, with $ \\zeta \\ll k h $), $ f(\\zeta) $ is negative. So we can choose our lower bracket $ a $ to be a small positive number, e.g., $ 10^{-9} $.\n2.  At $ \\zeta = \\pi $, the trigonometric functions are evaluated. For any $ \\theta \\in [0, \\pi/2] $ and the small values of $ k h $ in the test suite, $ S $ is a positive number and $ M $ is also positive. The term $ (kh)^2 M $ will be much smaller than $ S $, rendering $ f(\\pi) $ positive. For example, at $ \\theta=0 $, $ S(\\pi, 0) = 4 $ and $ M(\\pi, 0) = 1/3 $, so $ f(\\pi) = 4 - (kh)^2/3 > 0 $ for the given $kh$ values.\nTherefore, the interval $ [\\epsilon, \\pi] $ (with a small $ \\epsilon > 0 $) is a valid bracketing interval for the root-finder.\n\nOnce the set of discrete wavenumbers $ \\{ \\zeta(\\theta_i) \\} $ has been computed for all angles $ \\theta_i $, we calculate the numerical-to-continuous phase velocity ratios:\n$$\nR_i = \\frac{k h}{\\zeta(\\theta_i)}\n$$\nWith the array of ratios $ \\{R_i\\} $, we can compute the final metrics:\n1.  **Worst-case angular error**: This is the maximum deviation of the ratio from the ideal value of $ 1 $.\n    $$\n    E_{\\mathrm{worst}}(k h) = \\max_{i} |R_i - 1|\n    $$\n2.  **Anisotropy coefficient**: This measures the directional dependency of the phase velocity, quantified as the total spread of the ratio over all angles.\n    $$\n    A(k h) = \\max_i(R_i) - \\min_i(R_i)\n    $$\n\nThe overall algorithm is as follows:\n1.  Initialize a list to store the final results for each test case.\n2.  For each given value of $ k h $:\n    a. Create an array of $ N_\\theta=721 $ angles $ \\theta_i $ from $ 0 $ to $ \\pi/2 $.\n    b. For each angle $ \\theta_i $:\n        i. Define the function $ f(\\zeta) = f(\\zeta; k h, \\theta_i) $.\n        ii. Use a numerical root-finder (e.g., `scipy.optimize.brentq`) on the interval $ [\\epsilon, \\pi] $ to find the root $ \\zeta_i $.\n    c. After collecting all $ \\zeta_i $, compute the array of ratios $ R_i = k h / \\zeta_i $.\n    d. Calculate $ E_{\\mathrm{worst}} = \\max(|R_i - 1|) $ and $ A = \\max(R_i) - \\min(R_i) $.\n    e. Round the results to $ 8 $ decimal places and store them.\n3.  Format the collected results into the specified string format.\nThis procedure is implemented in the provided Python code.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves the numerical dispersion analysis problem for the given test cases.\n    \"\"\"\n\n    def dispersion_function(zeta: float, kh: float, theta: float) -> float:\n        \"\"\"\n        The discrete dispersion relation f(zeta) = 0 for given kh and theta.\n\n        Args:\n            zeta (float): The dimensionless discrete wavenumber magnitude (variable).\n            kh (float): The dimensionless continuous wavenumber.\n            theta (float): The propagation angle in radians.\n\n        Returns:\n            float: The value of the dispersion function.\n        \"\"\"\n        zeta_x = zeta * np.cos(theta)\n        zeta_y = zeta * np.sin(theta)\n\n        cos_zx = np.cos(zeta_x)\n        cos_zy = np.cos(zeta_y)\n\n        # Stiffness matrix symbol\n        S = 4.0 - 2.0 * (cos_zx + cos_zy)\n        \n        # Consistent mass matrix symbol\n        M = (4.0/9.0) + (2.0/9.0) * (cos_zx + cos_zy) + (1.0/9.0) * cos_zx * cos_zy\n\n        return S - (kh**2) * M\n\n    def calculate_metrics(kh: float) -> list[float]:\n        \"\"\"\n        Calculates E_worst and A for a given dimensionless wavenumber kh.\n\n        Args:\n            kh (float): The dimensionless continuous wavenumber.\n\n        Returns:\n            list[float]: A list containing [E_worst, A] rounded to 8 decimal places.\n        \"\"\"\n        num_angles = 721\n        thetas = np.linspace(0.0, np.pi / 2.0, num_angles)\n        \n        zetas = np.zeros_like(thetas)\n\n        for i, theta in enumerate(thetas):\n            # Define a lambda to be passed to the root-finder, with only zeta as a variable.\n            func_to_solve = lambda z: dispersion_function(z, kh, theta)\n            \n            # The search interval for zeta is (0, pi].\n            # We use a small positive lower bound for the bracketing interval.\n            # a=1e-9 and b=pi forms a valid bracket for brentq.\n            try:\n                zetas[i] = brentq(func_to_solve, 1e-9, np.pi)\n            except ValueError:\n                # This case should not be reached for this well-behaved problem.\n                # It's included as a safety measure.\n                zetas[i] = np.nan\n\n        # Calculate the ratio of numerical to continuous phase velocity\n        # Filter out potential NaNs if brentq failed, although not expected here\n        valid_zetas = zetas[~np.isnan(zetas)]\n        if len(valid_zetas) == 0:\n            return [float('nan'), float('nan')]\n\n        ratios = kh / valid_zetas\n\n        # Worst-case angular error\n        e_worst = np.max(np.abs(ratios - 1.0))\n        \n        # Anisotropy coefficient\n        anisotropy = np.max(ratios) - np.min(ratios)\n\n        return [round(e_worst, 8), round(anisotropy, 8)]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        np.pi/60,\n        np.pi/12,\n        np.pi/6,\n    ]\n\n    all_results = []\n    for kh_val in test_cases:\n        result_pair = calculate_metrics(kh_val)\n        all_results.append(result_pair)\n\n    # Format the final output string exactly as required, with no spaces\n    # between elements, to produce output like [[x1,y1],[x2,y2],...].\n    result_strings = [f\"[{res[0]},{res[1]}]\" for res in all_results]\n    final_output = f\"[{','.join(result_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}