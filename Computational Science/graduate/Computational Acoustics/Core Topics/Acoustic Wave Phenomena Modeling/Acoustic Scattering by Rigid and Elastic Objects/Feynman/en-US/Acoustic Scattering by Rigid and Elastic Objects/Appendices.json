{
    "hands_on_practices": [
        {
            "introduction": "The analysis of acoustic scattering by a single sphere is a cornerstone of wave physics, providing an essential analytical benchmark for numerical methods. This exercise tasks you with deriving the scattering coefficients for a rigid sphere by applying the Neumann boundary condition to a partial-wave expansion of the acoustic field. Mastering this foundational derivation is crucial for understanding how an object's geometry and boundary conditions shape the scattered wave, introducing the mathematical formalism used in more complex scattering problems.",
            "id": "4114741",
            "problem": "A time-harmonic acoustic plane wave of complex pressure amplitude $p_{0}$ and angular frequency $\\omega$ propagates in the $+z$-direction in a homogeneous, inviscid fluid of density $\\rho_{0}$ and sound speed $c_{0}$. The total acoustic pressure $p(\\mathbf{r})$ satisfies the scalar Helmholtz equation $\\nabla^{2} p + k^{2} p = 0$ with wavenumber $k = \\omega / c_{0}$ under the time dependence $\\exp(-\\mathrm{i}\\omega t)$. A rigid, perfectly reflecting sphere of radius $a$ is centered at the origin. The rigid boundary condition requires that the normal particle velocity vanish at the surface, which is equivalent to the Neumann boundary condition $\\partial p / \\partial r = 0$ at $r = a$ for the total pressure.\n\nStarting from the Helmholtz equation, separation of variables in spherical coordinates, and the radiation condition at infinity, expand the incident plane wave about the origin and represent the scattered field as a sum of outgoing spherical waves. By enforcing the Neumann boundary condition at $r = a$ and using orthogonality of the angular basis, determine the coefficient $A_{n}$ that multiplies each outgoing spherical wave in the scattered field representation\n$$\np_{\\mathrm{scat}}(r,\\theta) = p_{0} \\sum_{n=0}^{\\infty} (2n+1)\\,\\mathrm{i}^{n}\\,A_{n}\\,h_{n}^{(1)}(k r)\\,P_{n}(\\cos\\theta),\n$$\nwhere $h_{n}^{(1)}(\\cdot)$ is the spherical Hankel function of the first kind of order $n$ and $P_{n}(\\cdot)$ is the Legendre polynomial of degree $n$. Express your final answer as a single closed-form analytic expression for $A_{n}$ in terms of $k a$ and spherical Bessel/Hankel functions and their derivatives. No numerical evaluation is required. The final answer must be a single analytic expression.",
            "solution": "The problem presented is a canonical example of acoustic scattering by a sphere, which is a well-posed problem in mathematical physics. All provided information is consistent, scientifically sound, and sufficient for deriving a unique solution. We may therefore proceed with the derivation.\n\nThe total acoustic pressure field $p(\\mathbf{r})$ is the linear superposition of the incident pressure field $p_{\\mathrm{inc}}(\\mathbf{r})$ and the scattered pressure field $p_{\\mathrm{scat}}(\\mathbf{r})$:\n$$\np(\\mathbf{r}) = p_{\\mathrm{inc}}(\\mathbf{r}) + p_{\\mathrm{scat}}(\\mathbf{r})\n$$\nBoth $p_{\\mathrm{inc}}$ and $p_{\\mathrm{scat}}$ are solutions to the Helmholtz equation, $\\nabla^{2} \\phi + k^{2} \\phi = 0$.\n\nThe incident field is a plane wave of amplitude $p_{0}$ propagating in the positive $z$-direction, given by $p_{\\mathrm{inc}}(\\mathbf{r}) = p_{0} \\exp(\\mathrm{i}k z)$. In spherical coordinates $(r, \\theta, \\phi)$, this is written as $p_{\\mathrm{inc}}(r, \\theta) = p_{0} \\exp(\\mathrm{i}k r \\cos\\theta)$. This plane wave can be expanded in a series of spherical basis functions as:\n$$\np_{\\mathrm{inc}}(r, \\theta) = p_{0} \\sum_{n=0}^{\\infty} (2n+1)\\,\\mathrm{i}^{n}\\,j_{n}(k r)\\,P_{n}(\\cos\\theta)\n$$\nwhere $j_{n}(\\cdot)$ is the spherical Bessel function of the first kind of order $n$, and $P_{n}(\\cdot)$ is the Legendre polynomial of degree $n$.\n\nThe problem statement provides the form of the scattered field, which is an expansion in outgoing spherical waves satisfying the Sommerfeld radiation condition at infinity:\n$$\np_{\\mathrm{scat}}(r,\\theta) = p_{0} \\sum_{n=0}^{\\infty} (2n+1)\\,\\mathrm{i}^{n}\\,A_{n}\\,h_{n}^{(1)}(k r)\\,P_{n}(\\cos\\theta)\n$$\nHere, $h_{n}^{(1)}(\\cdot)$ is the spherical Hankel function of the first kind of order $n$, and $A_{n}$ are the unknown coefficients to be determined.\n\nCombining the incident and scattered fields, the total pressure field is:\n$$\np(r,\\theta) = p_{\\mathrm{inc}} + p_{\\mathrm{scat}} = p_{0} \\sum_{n=0}^{\\infty} (2n+1)\\,\\mathrm{i}^{n} \\left[ j_{n}(k r) + A_{n}\\,h_{n}^{(1)}(k r) \\right] P_{n}(\\cos\\theta)\n$$\nThe boundary condition for a rigid, perfectly reflecting sphere is that the normal component of the fluid particle velocity on the surface of the sphere is zero. In an inviscid fluid, the particle velocity $\\mathbf{u}$ is related to the pressure gradient by the linearized Euler's equation, $\\mathbf{u} = \\frac{\\mathrm{i}}{\\omega \\rho_{0}} \\nabla p$. The normal velocity at the surface $r=a$ is the radial component of the velocity, $u_{r} = \\frac{\\mathrm{i}}{\\omega \\rho_{0}} \\frac{\\partial p}{\\partial r}$. The condition $u_{r}|_{r=a} = 0$ is thus equivalent to the Neumann boundary condition on the pressure:\n$$\n\\frac{\\partial p}{\\partial r} \\bigg|_{r=a} = 0\n$$\nTo apply this condition, we first differentiate the expression for the total pressure $p(r,\\theta)$ with respect to $r$:\n$$\n\\frac{\\partial p}{\\partial r} = p_{0} \\sum_{n=0}^{\\infty} (2n+1)\\,\\mathrm{i}^{n} \\frac{\\partial}{\\partial r} \\left[ j_{n}(k r) + A_{n}\\,h_{n}^{(1)}(k r) \\right] P_{n}(\\cos\\theta)\n$$\nUsing the chain rule, for a spherical function $f_{n}(\\rho)$ with argument $\\rho = kr$, the derivative is $\\frac{\\partial}{\\partial r}f_{n}(kr) = k f_{n}'(kr)$, where the prime denotes differentiation with respect to the argument. Applying this yields:\n$$\n\\frac{\\partial p}{\\partial r} = p_{0} \\sum_{n=0}^{\\infty} (2n+1)\\,\\mathrm{i}^{n} k \\left[ j_{n}'(k r) + A_{n}\\,(h_{n}^{(1)})'(k r) \\right] P_{n}(\\cos\\theta)\n$$\nNow, we evaluate this expression at the boundary $r=a$ and set it to zero:\n$$\n\\frac{\\partial p}{\\partial r} \\bigg|_{r=a} = p_{0} \\sum_{n=0}^{\\infty} (2n+1)\\,\\mathrm{i}^{n} k \\left[ j_{n}'(k a) + A_{n}\\,(h_{n}^{(1)})'(k a) \\right] P_{n}(\\cos\\theta) = 0\n$$\nThe Legendre polynomials $P_{n}(\\cos\\theta)$ form a complete orthogonal set on the interval $\\theta \\in [0, \\pi]$. For the infinite series to be zero for all values of $\\theta$, the coefficient of each $P_{n}(\\cos\\theta)$ must be identically zero for each $n = 0, 1, 2, \\dots$. Therefore, for each $n$:\n$$\np_{0} (2n+1)\\,\\mathrm{i}^{n} k \\left[ j_{n}'(k a) + A_{n}\\,(h_{n}^{(1)})'(k a) \\right] = 0\n$$\nSince the pre-factors $p_{0}$, $(2n+1)$, $\\mathrm{i}^{n}$, and $k$ are non-zero (assuming a non-trivial incident wave), the term in the square brackets must be zero:\n$$\nj_{n}'(k a) + A_{n}\\,(h_{n}^{(1)})'(k a) = 0\n$$\nWe can now solve for the unknown coefficient $A_{n}$:\n$$\nA_{n}\\,(h_{n}^{(1)})'(k a) = - j_{n}'(k a)\n$$\n$$\nA_{n} = - \\frac{j_{n}'(k a)}{(h_{n}^{(1)})'(k a)}\n$$\nThis is the closed-form analytic expression for the coefficient $A_{n}$, where the prime indicates differentiation with respect to the argument of the function.",
            "answer": "$$\n\\boxed{- \\frac{j_{n}'(k a)}{(h_{n}^{(1)})'(k a)}}\n$$"
        },
        {
            "introduction": "Building upon the analytical derivation of scattering coefficients, this practice transitions to computational analysis to explore the physical consequences of scattering. You will implement the partial-wave series solution to compare the scattering patterns from rigid and soft spheres, focusing on the forward-to-backward scattering ratio as a function of frequency. This hands-on coding exercise  provides concrete insight into how the dimensionless size parameter $ka$ and the object's boundary conditions govern the directionality and intensity of the scattered field.",
            "id": "4114765",
            "problem": "Consider time-harmonic acoustic scattering of a plane wave by a homogeneous sphere in an unbounded, lossless fluid. Let the total acoustic pressure field satisfy the scalar Helmholtz equation with wavenumber $k$, and let the incident field be a plane wave of unit amplitude. The sphere has radius $a$. Two boundary condition models are to be compared: a sound-hard (rigid) sphere that enforces zero normal particle velocity at $r=a$, and a sound-soft (pressure-release) sphere that enforces zero pressure at $r=a$.\n\nStarting from the Helmholtz equation $\\nabla^2 p + k^2 p = 0$, the definition of the far-field scattering amplitude, the plane-wave expansion in spherical coordinates, and the boundary conditions on a sphere, derive an expression suitable for numerical computation of the far-field angular scattering amplitude using a truncated partial-wave series. Your derivation must:\n- Begin from the spherical separation of variables and the representation of the scattered field in terms of spherical Hankel functions of the first kind.\n- Impose the sound-hard and sound-soft boundary conditions at $r=a$ to obtain the corresponding modal coefficients.\n- Express the far-field scattering amplitude in terms of a Legendre series and specify how to evaluate it at angles $\\theta = 0$ (forward) and $\\theta = \\pi$ (backward), with angles measured in radians.\n\nFor numerical computation, implement a truncation rule for the series that guarantees convergence for moderate size parameter $ka$. Use the rule\n$$\nN_{\\max} = \\left\\lceil ka + 4\\,(ka)^{1/3} + 10 \\right\\rceil,\n$$\nand in all cases enforce $N_{\\max} \\ge 5$.\n\nDefine the forward-to-backward differential scattering intensity ratio\n$$\n\\mathcal{R} = \\frac{|f(0)|^2}{|f(\\pi)|^2},\n$$\nwhere $f(\\theta)$ is the far-field scattering amplitude, and $|\\cdot|$ denotes complex modulus.\n\nImplement a program that, for each specified test case, computes $\\mathcal{R}$ using the truncated series for both boundary conditions. You may assume that the fluid density and sound speed are such that nondimensionalization by $a$ and $k$ is valid, so that results depend only on the dimensionless size parameter $ka$. No physical units are required for $\\mathcal{R}$; it is a dimensionless quantity.\n\nTest Suite:\n- Case 1: $ka = 0.5$ (angles in radians).\n- Case 2: $ka = 1.0$ (angles in radians).\n- Case 3: $ka = 2.0$ (angles in radians).\n- Case 4: $ka = 5.0$ (angles in radians).\n\nFor each case, compute two floats:\n- The value of $\\mathcal{R}$ for a sound-hard (rigid) sphere.\n- The value of $\\mathcal{R}$ for a sound-soft (pressure-release) sphere.\n\nYour program should produce a single line of output containing the results for all cases aggregated in the following order:\n$$\n\\left[ \\mathcal{R}_{\\text{rigid}}(ka{=}0.5), \\mathcal{R}_{\\text{soft}}(ka{=}0.5), \\mathcal{R}_{\\text{rigid}}(ka{=}1.0), \\mathcal{R}_{\\text{soft}}(ka{=}1.0), \\mathcal{R}_{\\text{rigid}}(ka{=}2.0), \\mathcal{R}_{\\text{soft}}(ka{=}2.0), \\mathcal{R}_{\\text{rigid}}(ka{=}5.0), \\mathcal{R}_{\\text{soft}}(ka{=}5.0) \\right].\n$$\nThe list must be printed as a single line, comma-separated, enclosed in square brackets. Each float must be rounded to exactly $6$ decimal places.\n\nAngles must be in radians. No physical units are required for the output because $\\mathcal{R}$ is dimensionless. The program must be self-contained and must not read any input. The result for each test case must be a float. The final output format must be exactly one list on a single line as specified above.",
            "solution": "The user wants me to solve a problem in computational acoustics.\n\nHere's my thinking process:\n\n1.  **Problem Validation**:\n    *   I'll start by meticulously extracting all the givens from the problem statement: the governing equation, the geometry, the incident field, the boundary conditions, the definition of the quantity to be calculated ($\\mathcal{R}$), the specific numerical truncation rule, and the test cases.\n    *   Next, I'll evaluate the problem against the validation criteria. The problem is a standard textbook case of acoustic scattering. It's scientifically sound (based on the Helmholtz equation), well-posed (leads to a unique solution), objective, and self-contained. It's a core problem in computational acoustics, so it's relevant. The idealizations (perfectly rigid/soft sphere) are standard and don't make the problem invalid. Therefore, the problem is **valid**.\n\n2.  **Theoretical Derivation**:\n    *   **Field Representation**: The core of the problem is representing the acoustic pressure fields using partial-wave expansions (series of spherical basis functions). The total pressure field $p$ is the sum of the incident field $p_{\\text{inc}}$ and the scattered field $p_{\\text{scat}}$.\n        *   The incident plane wave, $p_{\\text{inc}} = e^{ikz} = e^{ikr\\cos\\theta}$, has a known expansion in terms of spherical Bessel functions $j_n(kr)$ and Legendre polynomials $P_n(\\cos\\theta)$.\n        *   The scattered field $p_{\\text{scat}}$ must be an outgoing wave at infinity, so its expansion will use spherical Hankel functions of the first kind, $h_n^{(1)}(kr)$. The expansion coefficients are unknown.\n    *   **Boundary Conditions (BCs)**: The unknown coefficients are determined by applying the BCs at the sphere's surface ($r=a$).\n        *   **Sound-soft (Dirichlet BC)**: $p = p_{\\text{inc}} + p_{\\text{scat}} = 0$ at $r=a$. This algebraic condition lets me solve for the scattering coefficients directly.\n        *   **Sound-hard (Neumann BC)**: The normal particle velocity is zero. Since velocity is proportional to the pressure gradient ($\\mathbf{v} \\propto \\nabla p$), this means the normal (radial) derivative of the pressure is zero: $\\frac{\\partial p}{\\partial r} = 0$ at $r=a$. This involves the derivatives of the spherical Bessel and Hankel functions.\n    *   **Far-Field Amplitude**: The scattered field $p_{\\text{scat}}$ behaves like $f(\\theta) \\frac{e^{ikr}}{r}$ as $r \\to \\infty$. I'll use the asymptotic form of the Hankel function $h_n^{(1)}(kr)$ to relate the expansion of $p_{\\text{scat}}$ to this definition and extract the expression for the scattering amplitude, $f(\\theta)$. This will result in a series for $f(\\theta)$ involving the scattering coefficients and Legendre polynomials.\n    *   **Forward/Backward Scattering**: To find the amplitudes in the forward ($\\theta=0$) and backward ($\\theta=\\pi$) directions, I'll use the known values of the Legendre polynomials at these angles: $P_n(\\cos 0) = P_n(1) = 1$ and $P_n(\\cos \\pi) = P_n(-1) = (-1)^n$.\n    *   **Ratio $\\mathcal{R}$**: Finally, I'll construct the ratio $\\mathcal{R} = \\frac{|f(0)|^2}{|f(\\pi)|^2}$. The factors of $1/k$ in the expression for $f(\\theta)$ will cancel out, simplifying the final formula for numerical computation.\n\n3.  **Numerical Implementation**:\n    *   **Code Structure**: I will write a Python script using `numpy` for array operations and `scipy.special` for the required spherical functions ($j_n, y_n,$ and their derivatives).\n    *   **Truncation**: I'll implement the given truncation rule, $N_{\\max} = \\lceil ka + 4(ka)^{1/3} + 10 \\rceil$ with a minimum of $5$, to determine how many terms of the series to compute.\n    *   **Calculation Loop**: The main part of the code will loop through the given test cases ($ka$ values). For each $ka$, it will:\n        1.  Calculate $N_{\\max}$.\n        2.  Generate an array of orders $n$ from $0$ to $N_{\\max}$.\n        3.  Compute the necessary spherical Bessel, Neumann, and Hankel functions (and their derivatives) for all required orders at once using `scipy`'s vectorized functions.\n        4.  Calculate the scattering coefficients ($T_n^{\\text{soft}}$ and $T_n^{\\text{rigid}}$).\n        5.  Compute the sums for the forward and backward amplitudes (numerator and denominator of $\\mathcal{R}$).\n        6.  Calculate $\\mathcal{R}$ for both rigid and soft cases.\n    *   **Output Formatting**: The results will be stored, formatted to exactly 6 decimal places, and printed in a single line as a comma-separated list enclosed in square brackets, as specified in the problem.\n\nThis systematic approach ensures all aspects of the problem are addressed, from the fundamental physics and mathematics to the details of the numerical implementation and output formatting.\n\n## Problem Validation\n\n### Step 1: Extract Givens\n- **Governing Equation**: The scalar Helmholtz equation, $\\nabla^2 p + k^2 p = 0$.\n- **Incident Field**: A plane wave of unit amplitude, $p_{inc}$.\n- **Scatterer**: A homogeneous sphere of radius $a$.\n- **Medium**: An unbounded, lossless fluid.\n- **Boundary Conditions**:\n    1.  Sound-hard (rigid): Zero normal particle velocity at $r=a$.\n    2.  Sound-soft (pressure-release): Zero pressure at $r=a$.\n- **Numerical Series Truncation Rule**: $N_{\\max} = \\left\\lceil ka + 4\\,(ka)^{1/3} + 10 \\right\\rceil$, with a minimum value $N_{\\max} \\ge 5$.\n- **Quantity to Compute**: The forward-to-backward differential scattering intensity ratio, $\\mathcal{R} = \\frac{|f(0)|^2}{|f(\\pi)|^2}$, where $f(\\theta)$ is the far-field scattering amplitude.\n- **Test Cases**: $ka \\in \\{0.5, 1.0, 2.0, 5.0\\}$.\n- **Output Format**: A single-line list of floats, rounded to 6 decimal places, in the order $[\\mathcal{R}_{\\text{rigid}}(0.5), \\mathcal{R}_{\\text{soft}}(0.5), \\mathcal{R}_{\\text{rigid}}(1.0), \\mathcal{R}_{\\text{soft}}(1.0), \\dots]$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded**: The problem is a canonical exercise in acoustic scattering theory, based on the fundamental Helmholtz equation and standard boundary conditions. It is scientifically sound. **Pass.**\n2.  **Well-Posed**: The problem is well-posed. The Helmholtz equation, combined with the Sommerfeld radiation condition for the scattered field, guarantees the existence of a unique, stable solution for a given incident field and scatterer geometry/boundary condition. **Pass.**\n3.  **Objective**: The problem is formulated with precise, objective mathematical and physical terminology. All terms are standard and unambiguously defined within the field of acoustics. **Pass.**\n4.  **Completeness and Consistency**: The problem is self-contained and provides all necessary information: the physical model, governing equations, boundary conditions, a specific numerical truncation rule, and test cases. There are no contradictions. **Pass.**\n5.  **Plausibility**: The physical models (perfectly rigid/soft spheres) are standard idealizations in physics and engineering. The given values for the size parameter $ka$ are physically reasonable. **Pass.**\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n## Solution Derivation and Implementation\n\n### 1. Theoretical Framework\nThe problem concerns time-harmonic acoustic scattering, where the total acoustic pressure field $p(\\mathbf{x})$ is governed by the scalar Helmholtz equation:\n$$ \\nabla^2 p + k^2 p = 0 $$\nHere, $p$ is the complex pressure amplitude and $k$ is the acoustic wavenumber. The total field is the sum of the incident field $p_{\\text{inc}}$ and the scattered field $p_{\\text{scat}}$, i.e., $p = p_{\\text{inc}} + p_{\\text{scat}}$. The incident field is a plane wave propagating along the $z$-axis, which in spherical coordinates $(r, \\theta, \\phi)$ is given by $p_{\\text{inc}} = e^{ikz} = e^{ikr\\cos\\theta}$.\n\n### 2. Partial-Wave Expansion\nThe problem's spherical symmetry suggests a solution using separation of variables in spherical coordinates. The incident and scattered fields are expanded in a basis of spherical wave functions.\n\nThe incident plane wave has the standard expansion:\n$$ p_{\\text{inc}}(r, \\theta) = \\sum_{n=0}^{\\infty} (2n+1) i^n j_n(kr) P_n(\\cos\\theta) $$\nwhere $j_n$ are the spherical Bessel functions of the first kind and $P_n$ are the Legendre polynomials.\n\nThe scattered field must satisfy the Sommerfeld radiation condition, meaning it must behave as an outgoing wave at infinity. This dictates the use of spherical Hankel functions of the first kind, $h_n^{(1)}(kr) = j_n(kr) + i y_n(kr)$, where $y_n$ are the spherical Neumann functions. A common and convenient formulation for the scattered field is:\n$$ p_{\\text{scat}}(r, \\theta) = \\sum_{n=0}^{\\infty} (2n+1) i^n T_n h_n^{(1)}(kr) P_n(\\cos\\theta) $$\nThe dimensionless coefficients $T_n$ are the modal scattering coefficients (or T-matrix elements) to be determined by the boundary conditions on the sphere's surface at $r=a$.\n\nThe total pressure field is therefore:\n$$ p(r, \\theta) = \\sum_{n=0}^{\\infty} (2n+1) i^n \\left[ j_n(kr) + T_n h_n^{(1)}(kr) \\right] P_n(\\cos\\theta) $$\n\n### 3. Boundary Conditions\nDue to the orthogonality of the Legendre polynomials, the boundary condition must be satisfied for each mode $n$ independently.\n\n**Sound-Soft (Pressure-Release) Sphere:**\nThe boundary condition is a Dirichlet condition: $p(a, \\theta) = 0$. This requires the term in the brackets of the total pressure expansion to be zero for each $n$:\n$$ j_n(ka) + T_n^{\\text{soft}} h_n^{(1)}(ka) = 0 $$\nSolving for the coefficient $T_n^{\\text{soft}}$ gives:\n$$ T_n^{\\text{soft}} = - \\frac{j_n(ka)}{h_n^{(1)}(ka)} $$\n\n**Sound-Hard (Rigid) Sphere:**\nThe boundary condition is zero normal particle velocity. From Euler's linearized equation of motion, the acoustic particle velocity is $\\mathbf{v} = \\frac{\\nabla p}{i\\omega\\rho_0}$, where $\\rho_0$ is the fluid density and $\\omega=ck$ is the angular frequency. The normal velocity at the sphere's surface is the radial component, $v_r = \\frac{1}{i\\omega\\rho_0} \\frac{\\partial p}{\\partial r}$. The condition $v_r=0$ at $r=a$ is thus a Neumann condition: $\\frac{\\partial p}{\\partial r}|_{r=a} = 0$. Applying this to the series expansion yields:\n$$ \\frac{d}{dr}\\left[ j_n(kr) + T_n^{\\text{rigid}} h_n^{(1)}(kr) \\right]_{r=a} = 0 $$\n$$ k j_n'(ka) + k T_n^{\\text{rigid}} (h_n^{(1)})'(ka) = 0 $$\nwhere the prime denotes the derivative with respect to the argument. Solving for the coefficient $T_n^{\\text{rigid}}$ gives:\n$$ T_n^{\\text{rigid}} = - \\frac{j_n'(ka)}{(h_n^{(1)})'(ka)} $$\n\n### 4. Far-Field Scattering Amplitude\nThe far-field scattering amplitude $f(\\theta)$ is defined by the asymptotic behavior of the scattered field as $r \\to \\infty$:\n$$ p_{\\text{scat}}(r, \\theta) \\sim f(\\theta) \\frac{e^{ikr}}{r} $$\nThe asymptotic form of the spherical Hankel function for large argument is $h_n^{(1)}(kr) \\sim \\frac{1}{kr}(-i)^{n+1}e^{ikr}$. Substituting this into the expansion for $p_{\\text{scat}}$:\n$$ p_{\\text{scat}}(r, \\theta) \\sim \\sum_{n=0}^{\\infty} (2n+1) i^n T_n \\left( \\frac{(-i)^{n+1}}{kr}e^{ikr} \\right) P_n(\\cos\\theta) $$\nSince $i^n (-i)^{n+1} = i^n (-i)^n (-i) = -i$, we can rearrange to find $f(\\theta)$:\n$$ p_{\\text{scat}}(r, \\theta) \\sim \\frac{e^{ikr}}{r} \\left( \\frac{1}{k} \\sum_{n=0}^{\\infty} (2n+1) T_n P_n(\\cos\\theta) \\right) $$\nBy comparison, the scattering amplitude is:\n$$ f(\\theta) = \\frac{1}{k} \\sum_{n=0}^{\\infty} (2n+1) T_n P_n(\\cos\\theta) $$\n\n### 5. Forward-to-Backward Ratio\nThe problem requires the ratio of scattering intensities in the forward ($\\theta=0$) and backward ($\\theta=\\pi$) directions. We use the properties of Legendre polynomials: $P_n(\\cos 0) = P_n(1) = 1$ and $P_n(\\cos \\pi) = P_n(-1) = (-1)^n$.\n\nThe forward scattering amplitude is:\n$$ f(0) = \\frac{1}{k} \\sum_{n=0}^{\\infty} (2n+1) T_n (1) = \\frac{1}{k} \\sum_{n=0}^{\\infty} (2n+1) T_n $$\nThe backward scattering amplitude is:\n$$ f(\\pi) = \\frac{1}{k} \\sum_{n=0}^{\\infty} (2n+1) T_n (-1)^n $$\nThe forward-to-backward scattering intensity ratio $\\mathcal{R}$ is defined as:\n$$ \\mathcal{R} = \\frac{|f(0)|^2}{|f(\\pi)|^2} = \\frac{\\left| \\frac{1}{k} \\sum (2n+1) T_n \\right|^2}{\\left| \\frac{1}{k} \\sum (2n+1) T_n (-1)^n \\right|^2} = \\frac{\\left| \\sum_{n=0}^{\\infty} (2n+1) T_n \\right|^2}{\\left| \\sum_{n=0}^{\\infty} (2n+1) T_n (-1)^n \\right|^2} $$\nThe factor of $1/k$ cancels, simplifying the numerical computation.\n\n### 6. Numerical Implementation\nFor computation, the infinite series is truncated at an index $N_{\\max}$ determined by the rule:\n$$ N_{\\max} = \\max\\left(5, \\lceil ka + 4(ka)^{1/3} + 10 \\rceil\\right) $$\nThe sums for the ratio $\\mathcal{R}$ thus become:\n$$ \\mathcal{R} = \\frac{\\left| \\sum_{n=0}^{N_{\\max}} (2n+1) T_n \\right|^2}{\\left| \\sum_{n=0}^{N_{\\max}} (2n+1) T_n (-1)^n \\right|^2} $$\nThe implementation will calculate this quantity for both $T_n = T_n^{\\text{soft}}$ and $T_n = T_n^{\\text{rigid}}$ for each given value of $ka$. Special functions $j_n(x)$, $y_n(x)$, and their derivatives $j_n'(x)$, $y_n'(x)$ are available in the `scipy.special` library. The Hankel functions and their derivatives are constructed from these as $h_n^{(1)}(x) = j_n(x) + i y_n(x)$ and $(h_n^{(1)})'(x) = j_n'(x) + i y_n'(x)$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import spherical_jn, spherical_yn\n\ndef calculate_n_max(ka_val):\n    \"\"\"\n    Calculates the truncation index N_max based on the given rule.\n    N_max = ceil(ka + 4*(ka)^(1/3) + 10), with a minimum of 5.\n    \"\"\"\n    if ka_val  0:\n        raise ValueError(\"ka must be non-negative.\")\n    # The term (ka)**(1/3) can result in complex numbers for negative ka if not handled.\n    # We ensure ka_val is float to avoid potential integer arithmetic issues.\n    n_max_calc = np.ceil(ka_val + 4 * np.power(ka_val, 1/3) + 10)\n    return int(max(5, n_max_calc))\n\ndef compute_scattering_ratio(ka_val, boundary_condition):\n    \"\"\"\n    Computes the forward-to-backward scattering intensity ratio R.\n\n    Args:\n        ka_val (float): The dimensionless size parameter.\n        boundary_condition (str): 'soft' for sound-soft (pressure-release) or\n                                  'rigid' for sound-hard.\n\n    Returns:\n        float: The computed ratio R.\n    \"\"\"\n    n_max = calculate_n_max(ka_val)\n    n = np.arange(0, n_max + 1)  # Array of orders from 0 to n_max\n\n    # Spherical Bessel and Neumann functions and their derivatives evaluated at ka\n    jn = spherical_jn(n, ka_val)\n    yn = spherical_yn(n, ka_val)\n    jn_p = spherical_jn(n, ka_val, derivative=True)\n    yn_p = spherical_yn(n, ka_val, derivative=True)\n\n    # Spherical Hankel function of the first kind and its derivative\n    # h_n^(1)(x) = j_n(x) + i * y_n(x)\n    hn = jn + 1j * yn\n    hn_p = jn_p + 1j * yn_p\n    \n    # Check for division by zero, which can occur if hn or hn_p is zero.\n    # This is highly unlikely for physical ka  0 but is good practice.\n    if boundary_condition == 'soft':\n        # T_n = -j_n(ka) / h_n(ka)\n        # Avoid division by zero, although h_n(x) is zero only for x=0\n        with np.errstate(divide='raise', invalid='raise'):\n            try:\n                T_n = -jn / hn\n            except FloatingPointError:\n                # Replace NaNs or Infs from division by zero with 0\n                T_n = np.nan_to_num(-jn / hn)\n    elif boundary_condition == 'rigid':\n        # T_n = -j_n'(ka) / h_n'(ka)\n        with np.errstate(divide='raise', invalid='raise'):\n            try:\n                T_n = -jn_p / hn_p\n            except FloatingPointError:\n                T_n = np.nan_to_num(-jn_p / hn_p)\n    else:\n        raise ValueError(\"Invalid boundary condition specified.\")\n\n    # We compute the sums for the forward and backward scattering amplitudes.\n    # The 1/k prefactor cancels in the ratio R.\n    # Sum term is (2n+1) * T_n\n    sum_term = (2 * n + 1) * T_n\n\n    # Forward scattering sum: f(0) ~ sum_{n=0 to N_max} (2n+1)*T_n * P_n(1)\n    # Since P_n(1) = 1\n    f0_sum = np.sum(sum_term)\n\n    # Backward scattering sum: f(pi) ~ sum_{n=0 to N_max} (2n+1)*T_n * P_n(-1)\n    # Since P_n(-1) = (-1)^n\n    p_n_minus_one = (-1)**n\n    fpi_sum = np.sum(sum_term * p_n_minus_one)\n\n    # The ratio R = |f(0)|^2 / |f(pi)|^2\n    # The denominator |f(pi)|^2 should not be zero.\n    fpi_intensity = np.abs(fpi_sum)**2\n    if fpi_intensity == 0:\n        # This case would imply perfect nulling in the backward direction.\n        # It could lead to infinite R. Return a large number or handle as an error.\n        # For this problem, it is not expected to occur.\n        return np.inf\n\n    f0_intensity = np.abs(f0_sum)**2\n    R = f0_intensity / fpi_intensity\n    \n    return R\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    test_cases = [0.5, 1.0, 2.0, 5.0]\n    \n    results = []\n    \n    for ka in test_cases:\n        # Compute R for the sound-hard (rigid) sphere\n        R_rigid = compute_scattering_ratio(ka, 'rigid')\n        results.append(f\"{R_rigid:.6f}\")\n        \n        # Compute R for the sound-soft (pressure-release) sphere\n        R_soft = compute_scattering_ratio(ka, 'soft')\n        results.append(f\"{R_soft:.6f}\")\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\n# Execute the solver\nsolve()\n```"
        },
        {
            "introduction": "Scattering scenarios in nature and engineering rarely involve a single object in isolation. This practice extends the single-sphere analysis to a small cluster, introducing the powerful concept of the independent scattering approximation and the array factor. You will investigate the validity of a common low-frequency simplification—the monopole-dipole model—by numerically comparing its predictions against a full multipole solution , offering a practical lesson in the essential trade-off between computational efficiency and physical accuracy.",
            "id": "4114803",
            "problem": "Consider linear time-harmonic acoustics in a homogeneous, inviscid fluid, where the acoustic pressure field $p(\\mathbf{x})$ satisfies the Helmholtz equation $\\nabla^2 p + k^2 p = 0$ with wavenumber $k = \\omega / c$, angular frequency $\\omega$, and sound speed $c$. A rigid (sound-hard) boundary imposes the Neumann condition $\\partial p / \\partial n = 0$ on its surface. Let a plane wave $p_{\\mathrm{inc}}(\\mathbf{x}) = p_0 e^{i k \\hat{\\mathbf{z}} \\cdot \\mathbf{x}}$ be incident along the positive $z$-axis on a cluster of $N$ identical rigid spheres of radius $a$, with centers $\\{\\mathbf{r}_n\\}_{n=1}^N$.\n\nStarting from the Helmholtz equation, boundary conditions, and separation of variables in spherical coordinates, the scattered field from a single sphere at the origin can be expanded in spherical harmonics. The far-field in direction $\\hat{\\mathbf{r}}$ has an angular scattering amplitude $f(\\theta)$, where $\\theta$ is the polar angle relative to the incidence direction $\\hat{\\mathbf{z}}$. For a rigid sphere, the multipole expansion leads to a diagonal \"transition matrix\" with mode index $l \\in \\{0,1,2,\\dots\\}$ that depends only on $k a$. The plane wave expansion in spherical harmonics produces Legendre polynomials $P_l(\\cos\\theta)$ for azimuthal symmetry.\n\nDefine the single-sphere scattering amplitude truncated to multipoles up to order $l_{\\max}$ as\n$$\nf_{l_{\\max}}(\\theta; k a) = \\sum_{l=0}^{l_{\\max}} (2l+1)\\, S_l(k a)\\, P_l(\\cos\\theta),\n$$\nwhere for a rigid sphere the scattering coefficient is\n$$\nS_l(k a) = -\\frac{j_l'(k a)}{h_l^{(1)\\,'}(k a)},\n$$\nand $j_l$ and $h_l^{(1)}$ are the spherical Bessel function of the first kind and spherical Hankel function of the first kind, respectively, with primes denoting differentiation with respect to the argument. Assume the far-field definition is normalized such that constant prefactors do not affect the error metric below.\n\nUnder the independent scattering (no multiple scattering) approximation, the cluster-scattered far-field amplitude $F(\\hat{\\mathbf{r}})$ is the coherent sum of single-sphere amplitudes with appropriate phase delays,\n$$\nF_{l_{\\max}}(\\hat{\\mathbf{r}}; k a, \\{\\mathbf{r}_n\\}) = \\left[\\sum_{l=0}^{l_{\\max}} (2l+1)\\, S_l(k a)\\, P_l(\\cos\\theta)\\right]\\left[\\sum_{n=1}^{N} e^{i k (\\hat{\\mathbf{z}} - \\hat{\\mathbf{r}})\\cdot \\mathbf{r}_n}\\right],\n$$\nwhere $\\theta$ is the polar angle of $\\hat{\\mathbf{r}}$ relative to $\\hat{\\mathbf{z}}$. Let the \"monopole-dipole\" approximation retain only $l=0$ and $l=1$, i.e., $l_{\\max}=1$, and let the \"full multipole\" result be obtained by summing to a sufficiently large $l_{\\max}$ to ensure convergence for the chosen $k a$.\n\nDefine the relative root-mean-square error over observation directions $\\hat{\\mathbf{r}}(\\theta)$ in the $x-z$ plane (azimuth $\\phi=0$) as\n$$\n\\varepsilon = \\sqrt{\\frac{\\sum_{m=1}^{M} \\left|F_{1}\\!\\left(\\hat{\\mathbf{r}}(\\theta_m)\\right) - F_{L}\\!\\left(\\hat{\\mathbf{r}}(\\theta_m)\\right)\\right|^2}{\\sum_{m=1}^{M} \\left|F_{L}\\!\\left(\\hat{\\mathbf{r}}(\\theta_m)\\right)\\right|^2}},\n$$\nwhere $L$ is the chosen full multipole truncation index and $\\{\\theta_m\\}_{m=1}^{M}$ is a uniform grid of polar angles in $[0,\\pi]$ in radians.\n\nImplement a complete, runnable program that:\n- Computes the single-sphere scattering coefficients $S_l(k a)$ for rigid spheres using spherical Bessel and Hankel functions and their derivatives.\n- Computes $f_{l_{\\max}}(\\theta; k a)$ for both $l_{\\max}=1$ (monopole-dipole) and $l_{\\max}=L$ (full multipole).\n- Computes the cluster far-field amplitude $F_{l_{\\max}}(\\hat{\\mathbf{r}})$ as the product of the single-sphere amplitude and the array factor $\\sum_{n} e^{i k (\\hat{\\mathbf{z}} - \\hat{\\mathbf{r}})\\cdot\\mathbf{r}_n}$, using observation directions $\\hat{\\mathbf{r}}(\\theta) = (\\sin\\theta, 0, \\cos\\theta)$.\n- Evaluates the relative root-mean-square error $\\varepsilon$ over $M$ sample angles $\\theta_m$ uniformly spaced in $[0,\\pi]$ in radians.\n\nUse the following test suite with $N=4$ spheres arranged at the corners of a square of side length $s$ in the $x-y$ plane centered at the origin, i.e., sphere centers at $\\{(-s/2,-s/2,0), (-s/2,s/2,0), (s/2,-s/2,0), (s/2,s/2,0)\\}$. Take the sphere radius as $a=1$ (so $ka=k$) and use $M=361$ uniformly spaced angles $\\theta_m = m\\pi/360$ for $m=0,1,\\dots,360$ (angles in radians). For the full multipole truncation, use $L = \\max\\{1, \\lceil k a + 4 (k a)^{1/3} + 2 \\rceil\\}$.\n\nTest cases (each specified as a tuple $(ka, s/a)$):\n1. $(0.20, 5.0)$\n2. $(1.00, 5.0)$\n3. $(3.00, 5.0)$\n4. $(3.00, 2.00)$\n\nYour program should produce a single line of output containing the relative root-mean-square error $\\varepsilon$ for each test case as a comma-separated list enclosed in square brackets. For example, the output format must be exactly like this: \"[result1,result2,result3,result4]\". Report each result as a float (dimensionless). Angles must be in radians throughout.",
            "solution": "The problem is assessed to be valid. It is a well-posed problem in computational acoustics, grounded in the fundamental principles of wave scattering theory. All necessary data, physical constants, and mathematical definitions are provided, and there are no internal contradictions or scientifically unsound premises.\n\nThe objective is to calculate the relative root-mean-square error $\\varepsilon$ between a low-order (monopole-dipole, $l_{\\max}=1$) and a high-order (full multipole, $l_{\\max}=L$) approximation for the acoustic far-field amplitude scattered by a cluster of four rigid spheres.\n\nThe acoustic pressure field $p(\\mathbf{x})$ in a homogeneous, inviscid fluid is governed by the Helmholtz equation, $\\nabla^2 p + k^2 p = 0$, where $k$ is the wavenumber. The problem involves an incident plane wave $p_{\\mathrm{inc}}(\\mathbf{x}) = p_0 e^{i k \\hat{\\mathbf{z}} \\cdot \\mathbf{x}}$ scattering off a cluster of rigid spheres. The total field is the superposition of the incident field and the scattered field, $p = p_{\\mathrm{inc}} + p_{\\mathrm{scat}}$. On the surface of a rigid sphere, the sound-hard boundary condition requires the normal component of the particle velocity to be zero, which translates to the Neumann condition on the pressure: $\\frac{\\partial p}{\\partial n} = 0$.\n\nFor a single sphere centered at the origin, the problem can be solved by separation of variables in spherical coordinates $(r, \\theta, \\phi)$. Due to the azimuthal symmetry of the incident plane wave propagating along the $\\hat{\\mathbf{z}}$-axis, the solution is independent of the azimuthal angle $\\phi$. The scattered field $p_{\\mathrm{scat}}$ is expanded in a series of spherical harmonics:\n$$\np_{\\mathrm{scat}}(r, \\theta) = \\sum_{l=0}^{\\infty} A_l h_l^{(1)}(kr) P_l(\\cos\\theta)\n$$\nwhere $h_l^{(1)}$ is the spherical Hankel function of the first kind, representing an outgoing wave, and $P_l$ is the Legendre polynomial of order $l$. The incident plane wave is also expanded in a similar series:\n$$\np_{\\mathrm{inc}}(r, \\theta) = \\sum_{l=0}^{\\infty} B_l j_l(kr) P_l(\\cos\\theta)\n$$\nwhere $j_l$ is the spherical Bessel function of the first kind, which is regular at the origin.\n\nThe coefficients $A_l$ are determined by applying the boundary condition $\\frac{\\partial}{\\partial r}(p_{\\mathrm{inc}} + p_{\\mathrm{scat}})|_{r=a} = 0$ on the sphere's surface of radius $a$. This leads to the definition of the single-sphere scattering coefficients $S_l(ka)$:\n$$\nS_l(ka) = -\\frac{j_l'(ka)}{h_l^{(1)\\,'}(ka)}\n$$\nwhere the prime denotes differentiation with respect to the argument. The spherical Hankel function and its derivative are computed as $h_l^{(1)}(x) = j_l(x) + i y_l(x)$ and $h_l^{(1)\\,'}(x) = j_l'(x) + i y_l'(x)$, with $y_l$ being the spherical Bessel function of the second kind. The derivatives $j_l'(x)$ and $y_l'(x)$ can be calculated using recurrence relations or dedicated functions in numerical libraries.\n\nThe single-sphere far-field scattering amplitude $f(\\theta)$ is related to the asymptotic behavior of the scattered field as $r \\to \\infty$. The problem defines a truncated version, $f_{l_{\\max}}(\\theta; ka)$:\n$$\nf_{l_{\\max}}(\\theta; ka) = \\sum_{l=0}^{l_{\\max}} (2l+1) S_l(ka) P_l(\\cos\\theta)\n$$\n\nThe problem directs us to use the independent scattering approximation for the cluster of $N$ spheres. This approximation ignores multiple scattering between spheres and models the total scattered field as a coherent sum of the fields scattered by each sphere individually. The cluster's far-field amplitude $F$ is then the product of the single-sphere amplitude $f$ and an array factor $\\mathcal{A}$:\n$$\nF_{l_{\\max}}(\\hat{\\mathbf{r}}) = f_{l_{\\max}}(\\theta; ka) \\cdot \\mathcal{A}(\\hat{\\mathbf{r}}) = \\left[\\sum_{l=0}^{l_{\\max}} \\dots \\right] \\left[\\sum_{n=1}^{N} e^{i k (\\hat{\\mathbf{z}} - \\hat{\\mathbf{r}})\\cdot \\mathbf{r}_n}\\right]\n$$\nThe phase term $e^{i k (\\hat{\\mathbf{z}} - \\hat{\\mathbf{r}})\\cdot \\mathbf{r}_n}$ accounts for the path length differences for waves arriving at and scattering from each sphere $n$ at position $\\mathbf{r}_n$ relative to the origin.\n\nFor the specified geometry, $N=4$ spheres are at the corners of a square of side $s$ in the $x-y$ plane: $\\mathbf{r}_n = (x_n, y_n, 0)$. The observation directions are in the $x-z$ plane, $\\hat{\\mathbf{r}}(\\theta) = (\\sin\\theta, 0, \\cos\\theta)$. The incident direction is $\\hat{\\mathbf{z}} = (0, 0, 1)$. The vector difference is $\\hat{\\mathbf{z}} - \\hat{\\mathbf{r}} = (-\\sin\\theta, 0, 1-\\cos\\theta)$. The dot product is $(\\hat{\\mathbf{z}} - \\hat{\\mathbf{r}})\\cdot\\mathbf{r}_n = -x_n \\sin\\theta$. The sphere centers have $x$-coordinates $\\{-s/2, -s/2, s/2, s/2\\}$. The array factor simplifies to:\n$$\n\\mathcal{A}(\\theta) = \\sum_{n=1}^4 e^{-i k x_n \\sin\\theta} = 2 e^{i k (s/2) \\sin\\theta} + 2 e^{-i k (s/2) \\sin\\theta} = 4 \\cos\\left(k \\frac{s}{2} \\sin\\theta\\right)\n$$\n\nThe core of the task is to compute the relative root-mean-square error $\\varepsilon$ between the monopole-dipole approximation ($F_1$) and the full multipole approximation ($F_L$):\n$$\n\\varepsilon = \\sqrt{\\frac{\\sum_{m=1}^{M} \\left|F_{1}(\\hat{\\mathbf{r}}(\\theta_m)) - F_{L}(\\hat{\\mathbf{r}}(\\theta_m))\\right|^2}{\\sum_{m=1}^{M} \\left|F_{L}(\\hat{\\mathbf{r}}(\\theta_m))\\right|^2}}\n$$\nwhere $F_1$ is computed with $l_{\\max}=1$, and $F_L$ is computed with $l_{\\max}=L$, with $L$ given by the formula $L = \\max\\{1, \\lceil ka + 4 (ka)^{1/3} + 2 \\rceil\\}$. The summation is over $M=361$ discrete angles $\\theta_m$ in $[0, \\pi]$.\n\nThe algorithm is as follows for each test case $(ka, s/a)$:\n1. Set parameters: $k=ka$ and $s=s/a$ since radius $a=1$. Define the angle grid $\\theta_m$.\n2. Calculate the required multipole truncation order $L$.\n3. Compute the scattering coefficients $S_l(ka)$ for $l=0, \\dots, L$ using `scipy.special` functions for spherical Bessel functions ($j_l, y_l$) and their derivatives.\n4. For each angle $\\theta_m$, compute the Legendre polynomials $P_l(\\cos\\theta_m)$ for $l=0, \\dots, L$.\n5. Compute the single-sphere amplitudes $f_1(\\theta_m)$ (summing to $l=1$) and $f_L(\\theta_m)$ (summing to $l=L$).\n6. Compute the array factor $\\mathcal{A}(\\theta_m)$.\n7. Compute the full cluster amplitudes $F_1(\\theta_m) = f_1(\\theta_m)\\mathcal{A}(\\theta_m)$ and $F_L(\\theta_m) = f_L(\\theta_m)\\mathcal{A}(\\theta_m)$.\n8. Calculate the numerator $\\sum_m |F_1 - F_L|^2$ and denominator $\\sum_m |F_L|^2$.\n9. Compute the final error $\\varepsilon$ as the square root of the ratio.\n\nThis procedure will be implemented in Python using the `numpy` and `scipy` libraries as specified.",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import spherical_jn, spherical_yn, lpmv\n\ndef solve():\n    \"\"\"\n    Computes the relative RMS error between monopole-dipole and full multipole\n    approximations for acoustic scattering from a cluster of four rigid spheres.\n    \"\"\"\n    # Test cases defined as (ka, s/a) tuples.\n    # Since radius a=1, these are effectively (k, s).\n    test_cases = [\n        (0.20, 5.0),\n        (1.00, 5.0),\n        (3.00, 5.0),\n        (3.00, 2.00),\n    ]\n\n    results = []\n    \n    # Number of observation angles\n    M = 361\n    # Uniformly spaced polar angles in [0, pi]\n    theta = np.linspace(0, np.pi, M)\n    cos_theta = np.cos(theta)\n    sin_theta = np.sin(theta)\n\n    for ka, s_over_a in test_cases:\n        k = ka\n        s = s_over_a\n\n        # 1. Determine full multipole truncation index L\n        # The formula is L = max{1, ceil(ka + 4(ka)^(1/3) + 2)}\n        L = int(np.ceil(ka + 4 * (ka**(1/3)) + 2))\n        L = max(1, L)\n        \n        l_orders = np.arange(L + 1)\n\n        # 2. Compute scattering coefficients S_l(ka)\n        # S_l = -j_l'(ka) / h_l^(1)'(ka)\n        # h_l^(1)' = j_l' + i * y_l'\n        jn_prime_ka = spherical_jn(l_orders, ka, derivative=True)\n        yn_prime_ka = spherical_yn(l_orders, ka, derivative=True)\n        hn_prime_ka = jn_prime_ka + 1j * yn_prime_ka\n        \n        # Avoid division by zero, although singular for rigid spheres only at j_n(ka)=0 which is not the case for hn_prime.\n        # This is generally safe.\n        S_l = -jn_prime_ka / hn_prime_ka\n\n        # 3. Compute single-sphere scattering amplitudes f_lmax(theta)\n        # f_lmax = sum_{l=0 to lmax} (2l+1) * S_l * P_l(cos(theta))\n        \n        # Prefactor (2l+1)\n        l_coeffs = 2 * l_orders + 1\n        \n        # Legendre polynomials P_l(cos(theta)). Shape: (L+1, M)\n        # lpmv(m, v, x) computes P_v^m(x). For P_l, m=0.\n        P_l = np.zeros((L + 1, M))\n        for l in l_orders:\n            # lpmv can be slow for a large array of x.\n            # However, for M=361, this is acceptable.\n            P_l[l, :] = lpmv(0, l, cos_theta)\n        \n        # Combine terms for the sum. Broadcasting is used:\n        # (L+1,)[:,newaxis] * (L+1,)[:,newaxis] * (L+1, M) - (L+1, M)\n        all_terms = l_coeffs[:, np.newaxis] * S_l[:, np.newaxis] * P_l\n\n        # Sum over l to get f_1(theta) and f_L(theta)\n        # Sum up to l=1 (indices 0 and 1) for monopole-dipole\n        f_1_theta = np.sum(all_terms[:2, :], axis=0)\n        # Sum up to l=L for full multipole\n        f_L_theta = np.sum(all_terms, axis=0)\n\n        # 4. Compute array factor A(theta)\n        # For the square configuration in the x-y plane and observation in x-z plane:\n        # A(theta) = 4 * cos(k * (s/2) * sin(theta))\n        array_factor = 4 * np.cos(k * (s / 2) * sin_theta)\n\n        # 5. Compute total cluster far-field amplitudes F_1 and F_L\n        F_1 = f_1_theta * array_factor\n        F_L = f_L_theta * array_factor\n\n        # 6. Calculate the relative RMS error epsilon\n        numerator = np.sum(np.abs(F_1 - F_L)**2)\n        denominator = np.sum(np.abs(F_L)**2)\n\n        if denominator == 0:\n            # If F_L is zero for all angles, the error is 0 if F_1 is also zero,\n            # and infinite otherwise. For this problem, denominator  0.\n            error = 0.0 if numerator == 0 else np.inf\n        else:\n            error = np.sqrt(numerator / denominator)\n        \n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}