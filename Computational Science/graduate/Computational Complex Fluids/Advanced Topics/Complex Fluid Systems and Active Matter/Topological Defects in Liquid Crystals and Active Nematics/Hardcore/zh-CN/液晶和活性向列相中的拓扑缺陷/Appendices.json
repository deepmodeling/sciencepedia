{
    "hands_on_practices": [
        {
            "introduction": "要描述液晶中的有序状态，我们使用一个称为$Q$张量的数学对象。虽然简单的单轴形式是理解向列相的一个良好起点，但要深入描述像缺陷核心那样的复杂状态，关键在于理解张量的完整结构，特别是其特征值。这项练习将带领你从基础出发，通过张量代数分析单轴性和双轴性的数学本质，这对于理解缺陷核心内有序参数为何会“熔化”至关重要。",
            "id": "4110677",
            "problem": "考虑一个三维向列相液晶，其由二阶取向张量（也称为 Landau–de Gennes 序参量张量）$\\mathbf{Q}$ 描述，该张量是对称且无迹的。对于单轴向列相，其典范表示为 $\\mathbf{Q}=S\\left(\\mathbf{n}\\mathbf{n}-\\mathbf{I}/3\\right)$，其中 $S \\ge 0$ 是标量序参量，$\\mathbf{n}$ 是一个单位指向矢，$\\mathbf{I}$ 是单位张量。在无源或有源向列相的缺陷核心附近，由于强梯度或活动性引起的畸变，可能会出现双轴性。一个保持无迹性且与对称性一致的最小微扰是\n$$\n\\mathbf{Q}(S,\\Delta)=S\\left(\\mathbf{n}\\mathbf{n}-\\frac{\\mathbf{I}}{3}\\right)+\\Delta\\left(\\mathbf{m}\\mathbf{m}-\\mathbf{l}\\mathbf{l}\\right),\n$$\n其中 $\\{\\mathbf{n},\\mathbf{m},\\mathbf{l}\\}$ 是一个局部右手正交标架，满足 $\\mathbf{m}\\perp \\mathbf{n}$ 和 $\\mathbf{l}\\perp \\mathbf{n}$，并且 $\\Delta\\in\\mathbb{R}$ 表征了双轴畸变的强度。\n\n从基本的对称性和张量性质出发，按以下步骤进行：\n\n1. 仅使用 $\\mathbf{Q}$ 的对称性、无迹性以及 $\\{\\mathbf{n},\\mathbf{m},\\mathbf{l}\\}$ 的正交归一性，推导在单轴情况 $\\Delta=0$ 下 $\\mathbf{Q}$ 的本征值，并确定其简并结构。\n\n2. 对于 $\\Delta\\neq 0$ 的情况，在标架 $\\{\\mathbf{n},\\mathbf{m},\\mathbf{l}\\}$ 下对角化 $\\mathbf{Q}(S,\\Delta)$，并用 $S$ 和 $\\Delta$ 表示其三个本征值。解释当 $\\Delta\\neq 0$ 时简并是如何被解除的。\n\n3. 通过 $\\mathbf{Q}$ 的主不变量定义旋转不变量双轴性标量 $\\beta^{2}$，即\n$$\n\\beta^{2}=1-\\frac{6\\left(\\operatorname{tr}\\mathbf{Q}^{3}\\right)^{2}}{\\left(\\operatorname{tr}\\mathbf{Q}^{2}\\right)^{3}},\n$$\n其满足 $0\\le \\beta^{2}\\le 1$，其中 $\\beta^{2}=0$ 对应单轴态，$\\beta^{2}=1$ 对应最大双轴态。显式计算 $\\mathbf{Q}(S,\\Delta)$ 的 $\\beta^{2}$，并将结果简化为仅依赖于 $S$ 和 $\\Delta$ 的单个闭式表达式。\n\n最终答案需提供 $\\beta^{2}(S,\\Delta)$ 的闭式表达式。无需进行数值计算或四舍五入，也不涉及单位。你的最终答案必须是单个解析表达式。",
            "solution": "问题陈述具有科学依据、内容自洽且提法恰当。所提供的向列相序参量张量 $\\mathbf{Q}$、其单轴和双轴形式以及双轴性标量 $\\beta^2$ 的定义在液晶物理领域是标准的。该问题是张量代数和张量不变量理论中的一个有效练习。因此，我们可以着手求解。\n\n按照问题陈述的要求，分析分为三个部分进行。\n\n1. 单轴张量（$\\Delta=0$）的本征值\n\n在单轴情况下，向列相序参量张量由 $\\mathbf{Q}=S\\left(\\mathbf{n}\\mathbf{n}-\\frac{\\mathbf{I}}{3}\\right)$ 给出，其中 $\\mathbf{n}$ 是单位指向矢， $S$ 是标量序参量，$\\mathbf{I}$ 是单位张量。为求 $\\mathbf{Q}$ 的本征值，我们求解特征方程 $\\mathbf{Q}\\mathbf{v} = \\lambda\\mathbf{v}$，以得到本征向量 $\\mathbf{v}$ 及其对应的本征值 $\\lambda$。\n\n我们考虑本征向量 $\\mathbf{v}$ 相对于指向矢 $\\mathbf{n}$ 的两种不同取向情况。\n\n情况1：$\\mathbf{v}$ 平行于 $\\mathbf{n}$。\n在这种情况下，我们可以写出 $\\mathbf{v} = c\\mathbf{n}$，其中 $c$ 为某个非零标量。将 $\\mathbf{Q}$ 作用于 $\\mathbf{v}$：\n$$\n\\mathbf{Q}\\mathbf{v} = S\\left(\\mathbf{n}\\mathbf{n}-\\frac{\\mathbf{I}}{3}\\right)(c\\mathbf{n}) = cS\\left( (\\mathbf{n}\\mathbf{n})\\mathbf{n} - \\frac{1}{3}\\mathbf{I}\\mathbf{n} \\right)\n$$\n由于 $\\mathbf{n}$ 是单位向量，$\\mathbf{n}\\cdot\\mathbf{n}=1$。运算 $(\\mathbf{n}\\mathbf{n})\\mathbf{n}$ 等价于 $\\mathbf{n}(\\mathbf{n}\\cdot\\mathbf{n}) = \\mathbf{n}(1) = \\mathbf{n}$。同时，$\\mathbf{I}\\mathbf{n}=\\mathbf{n}$。将这些代回可得：\n$$\n\\mathbf{Q}\\mathbf{v} = cS\\left( \\mathbf{n} - \\frac{1}{3}\\mathbf{n} \\right) = cS\\left(\\frac{2}{3}\\mathbf{n}\\right) = \\frac{2S}{3}(c\\mathbf{n}) = \\frac{2S}{3}\\mathbf{v}\n$$\n因此，一个本征值为 $\\lambda_1 = \\frac{2S}{3}$。对应的本征空间由指向矢 $\\mathbf{n}$ 张成。\n\n情况2：$\\mathbf{v}$ 垂直于 $\\mathbf{n}$。\n在这种情况下，$\\mathbf{n}\\cdot\\mathbf{v}=0$。将 $\\mathbf{Q}$ 作用于 $\\mathbf{v}$：\n$$\n\\mathbf{Q}\\mathbf{v} = S\\left(\\mathbf{n}\\mathbf{n}-\\frac{\\mathbf{I}}{3}\\right)\\mathbf{v} = S\\left( (\\mathbf{n}\\mathbf{n})\\mathbf{v} - \\frac{1}{3}\\mathbf{I}\\mathbf{v} \\right)\n$$\n运算 $(\\mathbf{n}\\mathbf{n})\\mathbf{v}$ 等价于 $\\mathbf{n}(\\mathbf{n}\\cdot\\mathbf{v}) = \\mathbf{n}(0) = \\mathbf{0}$。同时，$\\mathbf{I}\\mathbf{v}=\\mathbf{v}$。代入这些可得：\n$$\n\\mathbf{Q}\\mathbf{v} = S\\left( \\mathbf{0} - \\frac{1}{3}\\mathbf{v} \\right) = -\\frac{S}{3}\\mathbf{v}\n$$\n因此，我们得到第二个本征值 $\\lambda_2 = -\\frac{S}{3}$。垂直于 $\\mathbf{n}$ 的向量空间是一个二维平面。此平面中的任何向量都是具有该本征值的本征向量。因此，该本征值是二重简并的。\n\n总而言之，单轴情况（$\\Delta=0$）的本征值为：\n- $\\lambda_n = \\frac{2S}{3}$ （非简并，本征向量沿 $\\mathbf{n}$ 方向）\n- $\\lambda_{\\perp} = -\\frac{S}{3}$ （二重简并，本征空间是垂直于 $\\mathbf{n}$ 的平面）\n本征值集合为 $\\{\\frac{2S}{3}, -\\frac{S}{3}, -\\frac{S}{3}\\}$。本征值之和为 $\\frac{2S}{3} - \\frac{S}{3} - \\frac{S}{3} = 0$，这与 $\\mathbf{Q}$ 是无迹的性质相符。\n\n2. 双轴张量（$\\Delta\\neq0$）的本征值\n\n双轴张量由 $\\mathbf{Q}(S,\\Delta)=S\\left(\\mathbf{n}\\mathbf{n}-\\frac{\\mathbf{I}}{3}\\right)+\\Delta\\left(\\mathbf{m}\\mathbf{m}-\\mathbf{l}\\mathbf{l}\\right)$ 给出。集合 $\\{\\mathbf{n},\\mathbf{m},\\mathbf{l}\\}$ 构成一个右手正交归一基。这个基是对角化 $\\mathbf{Q}$ 的自然选择，因为向量 $\\mathbf{n}$、$\\mathbf{m}$ 和 $\\mathbf{l}$ 是 $\\mathbf{Q}$ 的本征向量。让我们通过将 $\\mathbf{Q}$ 作用于每个基向量来验证这一点。\n\n本征向量 $\\mathbf{n}$：\n使用正交归一条件 $\\mathbf{n}\\cdot\\mathbf{m}=0$ 和 $\\mathbf{n}\\cdot\\mathbf{l}=0$：\n$$\n\\mathbf{Q}\\mathbf{n} = S\\left(\\mathbf{n}(\\mathbf{n}\\cdot\\mathbf{n}) - \\frac{1}{3}\\mathbf{n}\\right) + \\Delta\\left(\\mathbf{m}(\\mathbf{m}\\cdot\\mathbf{n}) - \\mathbf{l}(\\mathbf{l}\\cdot\\mathbf{n})\\right) = S\\left(\\mathbf{n} - \\frac{1}{3}\\mathbf{n}\\right) + \\Delta(\\mathbf{0}-\\mathbf{0}) = \\frac{2S}{3}\\mathbf{n}\n$$\n所以，对应于本征向量 $\\mathbf{n}$ 的本征值是 $\\lambda_n = \\frac{2S}{3}$。\n\n本征向量 $\\mathbf{m}$：\n使用正交归一条件 $\\mathbf{m}\\cdot\\mathbf{n}=0$、$\\mathbf{m}\\cdot\\mathbf{m}=1$ 和 $\\mathbf{m}\\cdot\\mathbf{l}=0$：\n$$\n\\mathbf{Q}\\mathbf{m} = S\\left(\\mathbf{n}(\\mathbf{n}\\cdot\\mathbf{m}) - \\frac{1}{3}\\mathbf{m}\\right) + \\Delta\\left(\\mathbf{m}(\\mathbf{m}\\cdot\\mathbf{m}) - \\mathbf{l}(\\mathbf{l}\\cdot\\mathbf{m})\\right) = S\\left(\\mathbf{0} - \\frac{1}{3}\\mathbf{m}\\right) + \\Delta(\\mathbf{m}-\\mathbf{0}) = \\left(-\\frac{S}{3}+\\Delta\\right)\\mathbf{m}\n$$\n所以，对应于本征向量 $\\mathbf{m}$ 的本征值是 $\\lambda_m = -\\frac{S}{3}+\\Delta$。\n\n本征向量 $\\mathbf{l}$：\n使用正交归一条件 $\\mathbf{l}\\cdot\\mathbf{n}=0$、$\\mathbf{l}\\cdot\\mathbf{m}=0$ 和 $\\mathbf{l}\\cdot\\mathbf{l}=1$：\n$$\n\\mathbf{Q}\\mathbf{l} = S\\left(\\mathbf{n}(\\mathbf{n}\\cdot\\mathbf{l}) - \\frac{1}{3}\\mathbf{l}\\right) + \\Delta\\left(\\mathbf{m}(\\mathbf{m}\\cdot\\mathbf{l}) - \\mathbf{l}(\\mathbf{l}\\cdot\\mathbf{l})\\right) = S\\left(\\mathbf{0} - \\frac{1}{3}\\mathbf{l}\\right) + \\Delta(\\mathbf{0}-\\mathbf{l}) = \\left(-\\frac{S}{3}-\\Delta\\right)\\mathbf{l}\n$$\n所以，对应于本征向量 $\\mathbf{l}$ 的本征值是 $\\lambda_l = -\\frac{S}{3}-\\Delta$。\n\n$\\mathbf{Q}(S,\\Delta)$ 的三个本征值是：\n$$\n\\lambda_n = \\frac{2S}{3}, \\quad \\lambda_m = -\\frac{S}{3}+\\Delta, \\quad \\lambda_l = -\\frac{S}{3}-\\Delta\n$$\n当 $\\Delta=0$ 时，我们恢复为单轴本征值 $\\lambda_m = \\lambda_l = -S/3$。对于 $\\Delta \\neq 0$，本征值 $\\lambda_m$ 和 $\\lambda_l$ 变得不同。双轴微扰破坏了围绕指向矢 $\\mathbf{n}$ 的旋转对称性，从而解除了垂直于 $\\mathbf{n}$ 的平面内本征值的简并。\n\n3. 双轴性标量 $\\beta^2$ 的计算\n\n双轴性标量定义为 $\\beta^{2}=1-\\frac{6\\left(\\operatorname{tr}\\mathbf{Q}^{3}\\right)^{2}}{\\left(\\operatorname{tr}\\mathbf{Q}^{2}\\right)^{3}}$。我们使用已求出的本征值来计算不变量 $\\operatorname{tr}(\\mathbf{Q}^2)$ 和 $\\operatorname{tr}(\\mathbf{Q}^3)$。矩阵任意次幂的迹等于其本征值该次幂的和。\n\n首先，我们计算 $\\operatorname{tr}(\\mathbf{Q}^2) = \\lambda_n^2 + \\lambda_m^2 + \\lambda_l^2$：\n$$\n\\operatorname{tr}(\\mathbf{Q}^2) = \\left(\\frac{2S}{3}\\right)^2 + \\left(-\\frac{S}{3}+\\Delta\\right)^2 + \\left(-\\frac{S}{3}-\\Delta\\right)^2\n$$\n$$\n\\operatorname{tr}(\\mathbf{Q}^2) = \\frac{4S^2}{9} + \\left(\\frac{S^2}{9} - \\frac{2S\\Delta}{3} + \\Delta^2\\right) + \\left(\\frac{S^2}{9} + \\frac{2S\\Delta}{3} + \\Delta^2\\right)\n$$\n$$\n\\operatorname{tr}(\\mathbf{Q}^2) = \\frac{4S^2+S^2+S^2}{9} + 2\\Delta^2 = \\frac{6S^2}{9} + 2\\Delta^2 = \\frac{2S^2}{3} + 2\\Delta^2 = 2\\left(\\frac{S^2}{3}+\\Delta^2\\right)\n$$\n\n接着，我们计算 $\\operatorname{tr}(\\mathbf{Q}^3) = \\lambda_n^3 + \\lambda_m^3 + \\lambda_l^3$：\n$$\n\\operatorname{tr}(\\mathbf{Q}^3) = \\left(\\frac{2S}{3}\\right)^3 + \\left(-\\frac{S}{3}+\\Delta\\right)^3 + \\left(-\\frac{S}{3}-\\Delta\\right)^3\n$$\n使用恒等式 $(a+b)^3+(a-b)^3 = 2a^3+6ab^2$，并令 $a=-S/3$ 和 $b=\\Delta$：\n$$\n\\left(-\\frac{S}{3}+\\Delta\\right)^3 + \\left(-\\frac{S}{3}-\\Delta\\right)^3 = 2\\left(-\\frac{S}{3}\\right)^3 + 6\\left(-\\frac{S}{3}\\right)\\Delta^2 = -\\frac{2S^3}{27} - 2S\\Delta^2\n$$\n$$\n\\operatorname{tr}(\\mathbf{Q}^3) = \\frac{8S^3}{27} - \\frac{2S^3}{27} - 2S\\Delta^2 = \\frac{6S^3}{27} - 2S\\Delta^2 = \\frac{2S^3}{9} - 2S\\Delta^2 = 2S\\left(\\frac{S^2}{9}-\\Delta^2\\right)\n$$\n\n现在我们将这些不变量代入 $\\beta^2$ 的表达式中：\n$$\n\\beta^2 = 1 - \\frac{6 \\left[2S\\left(\\frac{S^2}{9}-\\Delta^2\\right)\\right]^2}{\\left[2\\left(\\frac{S^2}{3}+\\Delta^2\\right)\\right]^3} = 1 - \\frac{6 \\cdot 4S^2\\left(\\frac{S^2-9\\Delta^2}{9}\\right)^2}{8\\left(\\frac{S^2+3\\Delta^2}{3}\\right)^3}\n$$\n$$\n\\beta^2 = 1 - \\frac{24 S^2\\frac{(S^2-9\\Delta^2)^2}{81}}{8\\frac{(S^2+3\\Delta^2)^3}{27}} = 1 - \\left(\\frac{24}{8}\\frac{27}{81}\\right)\\frac{S^2(S^2-9\\Delta^2)^2}{(S^2+3\\Delta^2)^3}\n$$\n由于 $\\frac{24}{8}\\frac{27}{81} = 3 \\cdot \\frac{1}{3} = 1$，前置因子为1。\n$$\n\\beta^2 = 1 - \\frac{S^2(S^2-9\\Delta^2)^2}{(S^2+3\\Delta^2)^3}\n$$\n为了得到更紧凑的形式，我们通分合并各项：\n$$\n\\beta^2 = \\frac{(S^2+3\\Delta^2)^3 - S^2(S^2-9\\Delta^2)^2}{(S^2+3\\Delta^2)^3}\n$$\n我们展开分子。令 $x=S^2$ 和 $y=\\Delta^2$。\n分子 = $(x+3y)^3 - x(x-9y)^2$\n$= (x^3 + 9x^2y + 27xy^2 + 27y^3) - x(x^2 - 18xy + 81y^2)$\n$= (x^3 + 9x^2y + 27xy^2 + 27y^3) - (x^3 - 18x^2y + 81xy^2)$\n$= (9+18)x^2y + (27-81)xy^2 + 27y^3$\n$= 27x^2y - 54xy^2 + 27y^3$\n$= 27y (x^2 - 2xy + y^2)$\n$= 27y (x-y)^2$\n将 $x=S^2$ 和 $y=\\Delta^2$ 代回，分子为 $27\\Delta^2(S^2-\\Delta^2)^2$。\n因此，$\\beta^2$ 的最终简化表达式为：\n$$\n\\beta^2 = \\frac{27\\Delta^2(S^2-\\Delta^2)^2}{(S^2+3\\Delta^2)^3}\n$$",
            "answer": "$$\n\\boxed{\\frac{27\\Delta^{2}(S^{2}-\\Delta^{2})^{2}}{(S^{2}+3\\Delta^{2})^{3}}}\n$$"
        },
        {
            "introduction": "在理解了$Q$张量的基本数学描述后，下一个关键步骤是量化缺陷的拓扑性质。拓扑荷是缺陷最重要的特征之一，但从离散的指向矢场中计算它会遇到一个独特的挑战，即向列相指向矢的“无头”对称性（$ \\mathbf{n} $和$ -\\mathbf{n} $等价）。这项实践将指导你开发一个稳健的计算方法，该方法能够克服这种模糊性，从而准确地测量拓扑荷，这是分析模拟或实验数据时一项至关重要的技能。",
            "id": "4110590",
            "problem": "给定一个沿二维 (2D) 空间中有序闭合轮廓采样的单位指向矢序列 $\\{\\mathbf{n}_i\\}_{i=0}^{N-1}$。向列相液晶中的指向矢场是“无头”的，这意味着 $\\mathbf{n}$ 和 $-\\mathbf{n}$ 表示相同的物理状态。向错荷是指向矢取向围绕轮廓的绕数，定义为沿回路的指向矢角度净变化量除以 $\\pi$。您的任务是设计并实现一个鲁棒的算法，从离散化的指向矢场中计算向錯荷，该算法在由指向矢无头性产生的等同关系 $\\theta \\to \\theta + \\pi$ 下保持不变。\n\n使用的基本原理：\n- 指向矢场由单位向量 $\\mathbf{n}_i = (\\cos\\theta_i, \\sin\\theta_i)$ 表示，其中 $\\theta_i$ 是指向矢的代表角，定义为模 $\\pi$。\n- 拓扑荷是指向矢角度沿轮廓的绕数，根据离散的角度增量计算得出，并且必须在等价关系 $\\theta \\sim \\theta + \\pi$ 下保持不变。\n\n约束和要求：\n- 您的算法必须以在变换 $\\theta \\to \\theta + \\pi$（对应于翻转 $\\mathbf{n}_i \\to -\\mathbf{n}_i$）下保持不变的方式计算绕数。\n- 您的算法必须对小的角度噪声和指向矢符号的随机翻转具有鲁棒性。\n- 角度必须以弧度为单位处理。\n- 轮廓是闭合的，且索引顺序 $\\{0,1,\\dots,N-1\\}$ 与弧长增加方向一致；您必须包含从最后一个样本回到第一个样本的增量以闭合回路。\n- 对于每个测试用例，您必须使用所述的基本原理，生成一个实数形式的最终向错荷。\n\n测试套件：\n对于每个测试用例，按如下方式构建指向矢样本。设 $\\alpha_i$ 为沿回路的极角参数，对于 $i = 0,1,\\dots,N-1$，$\\alpha_i$ 在 $[0,2\\pi)$ 内均匀分布。定义一个底层指向矢角度模型\n$$\n\\theta_i^{\\star} = \\theta_0 + \\frac{s^\\star}{2}\\,\\alpha_i + \\eta_i,\n$$\n其中 $s^\\star$ 是目标向错荷，$\\theta_0$ 是一个恒定偏移量，$\\eta_i$ 是独立的、零均值、标准差为 $\\sigma$ 的高斯噪声样本。然后，指向矢样本为\n$$\n\\mathbf{n}_i = \\sigma_i\\big(\\cos\\theta_i^{\\star}, \\sin\\theta_i^{\\star}\\big),\n$$\n其中 $\\sigma_i \\in \\{+1,-1\\}$ 表示独立的随机翻转，$\\mathbb{P}(\\sigma_i=-1)=p_{\\mathrm{flip}}$，用以模拟指向矢的无头性。使用此构造，实现您的算法来计算每个测试用例的向错荷。\n\n使用以下参数集作为测试套件：\n- 情况 1: $N=128$, $s^\\star=0.5$, $\\theta_0=0.1$, $\\sigma=0.02$, $p_{\\mathrm{flip}}=0.3$。\n- 情况 2: $N=64$, $s^\\star=1.0$, $\\theta_0=-0.5$, $\\sigma=0.0$, $p_{\\mathrm{flip}}=0.0$。\n- 情况 3: $N=96$, $s^\\star=-0.5$, $\\theta_0=0.0$, $\\sigma=0.01$, $p_{\\mathrm{flip}}=0.5$。\n- 情况 4: $N=200$, $s^\\star=0.0$, $\\theta_0=1.2$, $\\sigma=0.05$, $p_{\\mathrm{flip}}=0.7$。\n- 情况 5: $N=3$, $s^\\star=-1.0$, $\\theta_0=0.0$, $\\sigma=0.0$, $p_{\\mathrm{flip}}=0.0$。\n\n角度单位必须是弧度。对于每种情况，计算并返回四舍五入到六位小数的浮点数形式的向错荷。\n\n最终输出格式：\n您的程序应产生单行输出，其中包含所有测试用例的结果，形式为方括号括起来的逗号分隔列表，例如，“[result1,result2,result3,result4,result5]”。每个结果必须是四舍五入到六位小数的浮点数，且不应打印额外的文本或行。",
            "solution": "该问题要求从二维向列相系统中沿闭合回路的一组离散指向矢计算向错荷，这是一种拓扑不变量。向列相指向矢场 $\\mathbf{n}$ 的决定性特征是其无头性，即由 $\\mathbf{n}$ 和 $-\\mathbf{n}$ 表示的状态在物理上是不可区分的。这对应于角度等价性 $\\theta \\sim \\theta + \\pi$，其中 $\\theta$ 是指向矢的取向角。向错荷 $s$ 定义为指向矢角度围绕轮廓的总绕转，并用 $\\pi$ 进行归一化：\n$$\ns = \\frac{1}{\\pi} \\oint d\\theta\n$$\n一个朴素的方法，即从每个向量 $\\mathbf{n}_i$ 计算角度 $\\theta_i$ 并对差值 $\\Delta\\theta_i = \\theta_{i+1} - \\theta_i$ 求和，将会失败。这是由于两个模糊性。首先，标准反正切函数 $\\operatorname{atan2}$ 产生的角度在 $(-\\pi, \\pi]$ 区间内，这会导致虚假的 $2\\pi$ 跳变。其次，每个指向矢 $\\mathbf{n}_i$ 的随机且未知的符号可能会在角度序列中引入人为的 $\\pi$ 跳变。一个鲁棒的算法必须对这些因素保持不变。\n\n确保在变换 $\\mathbf{n} \\to -\\mathbf{n}$ 下不变的原则性方法是处理一个在指向矢分量上是二次方的量。向列相序参数，或称 $Q$ 张量，提供了这样一种表示。在二维中，这可以简化为一个复数 $q$，其分量由指向矢 $\\mathbf{n}_i = (n_{ix}, n_{iy})$ 构建：\n$$\nq_i = (n_{ix}^2 - n_{iy}^2) + i (2n_{ix}n_{iy})\n$$\n如果指向矢由单位向量 $\\mathbf{n}_i = (\\cos\\theta_i, \\sin\\theta_i)$ 表示，其中 $\\theta_i$ 是向量在平面中的角度，则复数 $q_i$ 变为：\n$$\nq_i = (\\cos^2\\theta_i - \\sin^2\\theta_i) + i(2\\cos\\theta_i\\sin\\theta_i) = \\cos(2\\theta_i) + i\\sin(2\\theta_i) = e^{i2\\theta_i}\n$$\n这个复数的辐角是 $2\\theta_i$。至关重要的是，这种表示在指向矢翻转 $\\mathbf{n}_i \\to -\\mathbf{n}_i$ 下是不变的。一次翻转对应于角度的改变 $\\theta_i \\to \\theta_i + \\pi$。新的复数 $q'_i$ 将是：\n$$\nq'_i = e^{i2(\\theta_i + \\pi)} = e^{i2\\theta_i}e^{i2\\pi} = e^{i2\\theta_i} = q_i\n$$\n因此，通过将指向矢序列 $\\{\\mathbf{n}_i\\}$ 转换为复数序列 $\\{q_i\\}$，我们消除了由指向矢无头性引起的模糊性。随机符号翻转和噪声的影响被隐式地处理了。\n\n计算向错荷 $s$ 的问题现在转化为寻找倍角 $2\\theta$ 的总绕数。$2\\theta$ 沿回路的总变化量是 $\\Delta\\Phi_{\\text{total}} = \\oint d(2\\theta)$。荷 $s$ 与这个总变化量之间的关系是：\n$$\ns = \\frac{1}{\\pi} \\oint d\\theta = \\frac{1}{2\\pi} \\oint d(2\\theta) = \\frac{\\Delta\\Phi_{\\text{total}}}{2\\pi}\n$$\n对于闭合轮廓上的离散样本集 $\\{q_i\\}_{i=0}^{N-1}$，该积分可以通过有限增量的和来近似：\n$$\n\\Delta\\Phi_{\\text{total}} \\approx \\sum_{i=0}^{N-1} \\Delta\\Phi_i\n$$\n其中 $\\Delta\\Phi_i$ 是 $q_i$ 与下一个样本 $q_{i+1}$ 之间的角度变化（通过取 $q_N=q_0$ 来闭合回路）。为了避免相位缠绕问题，这个增量通过计算复数比值的辐角来鲁棒地确定：\n$$\n\\Delta\\Phi_i = \\arg\\left(\\frac{q_{i+1}}{q_i}\\right) = \\arg(q_{i+1}\\bar{q}_i)\n$$\n其中 $\\bar{q}_i$ 是 $q_i$ 的复共轭。由于对所有 $i$ 都有 $|q_i|=1$，这简化了除法。辐角通常通过 $\\operatorname{atan2}(\\text{Im}(z), \\text{Re}(z))$ 计算，自然地产生一个在 $(-\\pi, \\pi]$ 范围内的值。这个过程正确地测量了连续 $q$ 向量之间的最短角，并且只要样本之间 $2\\theta$ 的真实变化量在幅度上不超过 $\\pi$（这个条件对所有测试用例中提供的采样密度都成立），该方法就是鲁棒的。\n\n最终的算法如下：\n1.  对于每个测试用例，根据指定的模型生成指向矢序列 $\\{\\mathbf{n}_i\\}_{i=0}^{N-1}$，包括噪声和随机符号翻转。\n2.  对于每个向量 $\\mathbf{n}_i = (n_{ix}, n_{iy})$，计算相应的复数表示 $q_i = (n_{ix}^2 - n_{iy}^2) + i(2n_{ix}n_{iy})$。\n3.  计算倍角的增量变化 $\\Delta\\Phi_i = \\arg(q_{i+1}\\bar{q}_i)$，对于 $i=0, \\dots, N-1$，其中 $q_N=q_0$。\n4.  将这些增量相加以找到总变化量：$\\Delta\\Phi_{\\text{total}} = \\sum_{i=0}^{N-1} \\Delta\\Phi_i$。\n5.  使用公式 $s = \\frac{\\Delta\\Phi_{\\text{total}}}{2\\pi}$ 计算向错荷。\n6.  按要求将最终值四舍五入到六位小数。\n使用单个随机数生成器种子以确保测试数据的随机生成是可复现的。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_charge_for_case(N, s_star, theta_0, sigma, p_flip, rng):\n    \"\"\"\n    Generates director field data for a test case and computes the disclination charge.\n\n    Args:\n        N (int): Number of samples on the contour.\n        s_star (float): The target disclination charge.\n        theta_0 (float): A constant angle offset.\n        sigma (float): Standard deviation of Gaussian noise on the angle.\n        p_flip (float): Probability of a director sign flip.\n        rng (numpy.random.Generator): Random number generator instance.\n\n    Returns:\n        float: The computed disclination charge.\n    \"\"\"\n    # 1. Generate director field data\n    # Generate polar angles uniformly spaced around a circle.\n    alpha = np.linspace(0, 2 * np.pi, N, endpoint=False)\n    \n    # Generate Gaussian noise for the director angle.\n    eta = rng.normal(loc=0.0, scale=sigma, size=N)\n    \n    # Create the underlying smooth director angle field.\n    theta_star = theta_0 + (s_star / 2.0) * alpha + eta\n    \n    # Introduce random sign flips to simulate the headless director nature.\n    flips = rng.choice([-1, 1], size=N, p=[p_flip, 1 - p_flip])\n    \n    # Construct the director vectors.\n    nx = flips * np.cos(theta_star)\n    ny = flips * np.sin(theta_star)\n    \n    # 2. Compute the complex tensor order parameter q = exp(i*2*theta)\n    # This representation is invariant under n -> -n.\n    # Re(q) = nx^2 - ny^2 = cos(2*theta)\n    # Im(q) = 2*nx*ny   = sin(2*theta)\n    q = (nx**2 - ny**2) + 1j * (2 * nx * ny)\n\n    # 3. Calculate phase differences between adjacent q-vectors\n    # Use np.roll to get the next element in the sequence, closing the loop.\n    q_next = np.roll(q, -1)\n    \n    # The ratio q_next/q gives the rotation. Since |q|=1, this is q_next * conj(q).\n    delta_q = q_next * np.conj(q)\n    \n    # np.angle() computes the argument, which is the change in the doubled angle (2*theta),\n    # correctly wrapped to the interval (-pi, pi].\n    delta_phi = np.angle(delta_q)\n    \n    # 4. Sum the phase differences and calculate the charge\n    # The total phase change of 2*theta is the sum of increments.\n    total_delta_phi = np.sum(delta_phi)\n    \n    # The disclination charge s = (total change in theta) / pi\n    # which is equivalent to (total change in 2*theta) / (2*pi).\n    charge = total_delta_phi / (2.0 * np.pi)\n    \n    return charge\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    # A fixed seed ensures that the noise and flips are the same for each run,\n    # leading to a reproducible result. The problem does not specify a seed,\n    # so a standard value of 0 is chosen.\n    rng = np.random.default_rng(0) \n\n    test_cases = [\n        # (N, s_star, theta_0, sigma, p_flip)\n        (128, 0.5, 0.1, 0.02, 0.3),\n        (64, 1.0, -0.5, 0.0, 0.0),\n        (96, -0.5, 0.0, 0.01, 0.5),\n        (200, 0.0, 1.2, 0.05, 0.7),\n        (3, -1.0, 0.0, 0.0, 0.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, s_star, theta_0, sigma, p_flip = case\n        charge = compute_charge_for_case(N, s_star, theta_0, sigma, p_flip, rng)\n        # Round the final result to six decimal places as required.\n        results.append(round(charge, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "现在，让我们从被动液晶转向活性向列相。在活性物质中，拓扑缺陷不再是静态结构，而是可以自驱动并产生复杂的流场。这些流场由“活性应力”驱动，其强度由活性参数$ \\zeta $决定。这最后一个练习将理论与（模拟的）实验联系起来，要求你分析一个给定的速度场数据，以估算这个关键的物理参数，从而展示如何利用理论模型对数据进行定量分析。",
            "id": "4110674",
            "problem": "考虑一个嵌入在不可压缩粘性流体中的二维活性向列相，其中含有一个孤立运动的 $+1/2$ 缺陷。其远场流体动力学由包含活性应力的稳态 Stokes 方程控制，即 $ \\eta \\nabla^2 \\mathbf{v} - \\nabla p + \\nabla \\cdot \\boldsymbol{\\sigma}^{\\mathrm{a}} = \\mathbf{0} $，以及不可压缩条件 $ \\nabla \\cdot \\mathbf{v} = 0 $，其中 $ \\eta $ 是动力粘度，$ p $ 是压力，活性应力由 $ \\boldsymbol{\\sigma}^{\\mathrm{a}} = -\\zeta \\mathbf{Q} $ 给出。张量 $ \\mathbf{Q} $ 是二维向列相序张量 $ \\mathbf{Q} = S(\\mathbf{n}\\mathbf{n} - \\mathbf{I}/2) $，其中 $ S $ 是标量序参数，$ \\mathbf{n} $ 是指向矢。粒子图像测速技术 (PIV) 提供了平面上位置 $ \\mathbf{x}_k $ 处速度场 $ \\mathbf{v}(\\mathbf{x}_k) $ 的离散采样。\n\n在 $+1/2$ 缺陷的远场中，$ \\mathbf{n} $ 的对称性意味着存在一个极性方向 $ \\hat{\\mathbf{p}} $ (单位矢量) 及其正交方向 $ \\hat{\\mathbf{p}}_{\\perp} $，并且活性驱动力 $ \\nabla \\cdot \\boldsymbol{\\sigma}^{\\mathrm{a}} $ 可以被粗粒化为一个与 $ \\hat{\\mathbf{p}} $ 对齐的有效应力偶。使用二维稳态 Stokes 流的格林函数表示，所得到的速度场与活性参数 $ \\zeta $ 成线性关系。在一个科学上一致且计算上易于处理的近似中，该远场速度可以建模为\n$$\n\\mathbf{v}_{\\mathrm{model}}(\\mathbf{x}) \\equiv \\frac{C S \\zeta}{\\eta r}\\left[\\cos(\\theta - \\theta_p)\\,\\hat{\\mathbf{p}} + \\beta \\sin(\\theta - \\theta_p)\\,\\hat{\\mathbf{p}}_{\\perp}\\right],\n$$\n其中 $ C $ 是一个已知的无量纲预因子，$ \\beta $ 是一个已知的无量纲涡旋系数，用于捕捉次主导的各向异性贡献，$ r = \\|\\mathbf{x}\\| $ 是到缺陷核心的径向距离，$ \\theta $ 是 $ \\mathbf{x} $ 的极角，$ \\theta_p $ 是缺陷极性 $ \\hat{\\mathbf{p}} = (\\cos\\theta_p, \\sin\\theta_p) $ 的取向角，其正交方向为 $ \\hat{\\mathbf{p}}_{\\perp} = (-\\sin\\theta_p, \\cos\\theta_p) $。本问题中的所有物理量均已无量纲化：长度通过一个特征缺陷核心长度 $ L $ 进行缩放，速度通过一个特征尺度进行缩放，因此预因子 $ C $ 可以不失一般性地取为 $ C = 1/(4\\pi) $。角度必须以弧度为单位。\n\n假设一次 PIV 测量提供了 $ N $ 个采样位置 $ \\{\\mathbf{x}_k\\}_{k=1}^N $ 和对应的测量速度 $ \\{\\mathbf{v}^{\\mathrm{meas}}_k\\}_{k=1}^N $。假设 PIV 测量噪声是一个加在真实信号上的微小、确定性扰动 $ \\boldsymbol{\\varepsilon}(\\mathbf{x}) $，因此\n$$\n\\mathbf{v}^{\\mathrm{meas}}_k = \\zeta_{\\mathrm{true}}\\mathbf{B}(\\mathbf{x}_k) + \\boldsymbol{\\varepsilon}(\\mathbf{x}_k),\n$$\n其中基底场 $ \\mathbf{B}(\\mathbf{x}) $ 定义为\n$$\n\\mathbf{B}(\\mathbf{x}) \\equiv \\frac{C S}{\\eta r}\\left[\\cos(\\theta - \\theta_p)\\,\\hat{\\mathbf{p}} + \\beta \\sin(\\theta - \\theta_p)\\,\\hat{\\mathbf{p}}_{\\perp}\\right].\n$$\n你的任务是通过对所有样本求解线性模型 $ \\mathbf{v}^{\\mathrm{meas}}_k \\approx \\zeta\\,\\mathbf{B}(\\mathbf{x}_k) $ 的最小二乘拟合，从 PIV 数据中估计活性参数 $ \\zeta $。在给定模型下，最佳线性无偏估计通过最小化 $ \\sum_{k=1}^N \\|\\mathbf{v}^{\\mathrm{meas}}_k - \\zeta\\,\\mathbf{B}(\\mathbf{x}_k)\\|^2 $ 得到。请证明该估计量可以写成关于 $ \\mathbf{B}(\\mathbf{x}_k) $ 的点积和范数的闭式解，并实现它。\n\n为确保可复现性，测量噪声必须是确定性场\n$$\n\\boldsymbol{\\varepsilon}(\\mathbf{x}) = \\epsilon \\begin{bmatrix} \\sin(x)\\cos(y) \\\\ \\cos(x)\\sin(y) \\end{bmatrix},\n$$\n其中 $ \\epsilon $ 是给定的振幅，$ x $ 和 $ y $ 是 $ \\mathbf{x} $ 的笛卡尔分量。\n\n将采样位置构建为以缺陷核心为中心的一组同心圆环。假设有 $ n_r $ 个圆环，其半径为 $ r_i = r_{\\min} + i\\,(r_{\\max} - r_{\\min})/(n_r - 1) $（$ i = 0, 1, \\dots, n_r-1 $），每个圆环上有 $ n_\\theta $ 个点，其极角为 $ \\theta_j = 2\\pi j/n_\\theta $（$ j = 0, 1, \\dots, n_\\theta-1 $）。采样位置为 $ \\mathbf{x}_{i,j} = (r_i\\cos\\theta_j, r_i\\sin\\theta_j) $。\n\n实现一个程序，该程序能够：\n- 对于每个测试用例，使用上述模型以及已知的 $ \\zeta_{\\mathrm{true}} $ 和 $ \\boldsymbol{\\varepsilon}(\\mathbf{x}) $ 生成合成的无量纲 PIV 数据 $ \\{\\mathbf{x}_k, \\mathbf{v}^{\\mathrm{meas}}_k\\} $。\n- 使用从第一性原理推导出的线性估计量计算最小二乘估计 $ \\hat{\\zeta} $。\n- 将所有测试用例的 $ \\hat{\\zeta} $ 列表输出到单行，格式为用方括号括起来的逗号分隔列表。\n\n所有角度均使用弧度。由于问题已完全无量纲化，因此不出现物理单位。\n\n测试套件：\n- 情况 $ A $ (正常路径): $ \\zeta_{\\mathrm{true}} = 1.25 $, $ \\eta = 1.0 $, $ S = 0.6 $, $ \\theta_p = 0.0 $, $ r_{\\min} = 0.5 $, $ r_{\\max} = 3.0 $, $ n_r = 3 $, $ n_\\theta = 16 $, $ \\beta = 0.5 $, $ C = 1/(4\\pi) $, $ \\epsilon = 0.02 $。\n- 情况 $ B $ (近零活性边界): $ \\zeta_{\\mathrm{true}} = 0.0 $, $ \\eta = 1.0 $, $ S = 0.8 $, $ \\theta_p = \\pi/3 $, $ r_{\\min} = 0.6 $, $ r_{\\max} = 2.5 $, $ n_r = 4 $, $ n_\\theta = 12 $, $ \\beta = 0.5 $, $ C = 1/(4\\pi) $, $ \\epsilon = 0.03 $。\n- 情况 $ C $ (各向异性和粘度变化): $ \\zeta_{\\mathrm{true}} = 2.0 $, $ \\eta = 0.7 $, $ S = 0.5 $, $ \\theta_p = \\pi/4 $, $ r_{\\min} = 0.3 $, $ r_{\\max} = 1.5 $, $ n_r = 5 $, $ n_\\theta = 10 $, $ \\beta = 0.5 $, $ C = 1/(4\\pi) $, $ \\epsilon = 0.05 $。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果 (例如，$ [\\text{result}_A,\\text{result}_B,\\text{result}_C] $)。每个结果必须是一个实数 (浮点数)。角度必须以弧度处理，基底场 $ \\mathbf{B}(\\mathbf{x}) $ 必须使用上述的精确定义。程序必须是自包含的，并且不得读取外部输入或文件。",
            "solution": "用户请求解决一个计算物理学问题，具体涉及活性向列相领域。该任务涉及从合成的粒子图像测速 (PIV) 数据中推导并实现活性参数 $\\zeta$ 的最小二乘估计量。\n\n### 第1步：提取已知条件\n\n问题提供了以下信息：\n- **控制方程 (远场)**: 稳态 Stokes 方程，包含活性应力，$ \\eta \\nabla^2 \\mathbf{v} - \\nabla p + \\nabla \\cdot \\boldsymbol{\\sigma}^{\\mathrm{a}} = \\mathbf{0} $，以及不可压缩条件，$ \\nabla \\cdot \\mathbf{v} = 0 $。\n- **活性应力**: $ \\boldsymbol{\\sigma}^{\\mathrm{a}} = -\\zeta \\mathbf{Q} $。\n- **向列相序张量**: $ \\mathbf{Q} = S(\\mathbf{n}\\mathbf{n} - \\mathbf{I}/2) $。\n- **远场速度模型**:\n$$\n\\mathbf{v}_{\\mathrm{model}}(\\mathbf{x}) \\equiv \\frac{C S \\zeta}{\\eta r}\\left[\\cos(\\theta - \\theta_p)\\,\\hat{\\mathbf{p}} + \\beta \\sin(\\theta - \\theta_p)\\,\\hat{\\mathbf{p}}_{\\perp}\\right]\n$$\n- **定义**:\n  - $\\mathbf{x}$: 位置矢量，径向距离为 $ r = \\|\\mathbf{x}\\| $，极角为 $ \\theta $。\n  - $ \\hat{\\mathbf{p}} = (\\cos\\theta_p, \\sin\\theta_p) $: 缺陷极性方向单位矢量。\n  - $ \\hat{\\mathbf{p}}_{\\perp} = (-\\sin\\theta_p, \\cos\\theta_p) $: 正交单位矢量。\n  - $ \\theta_p $: 缺陷极性的取向角。\n  - $ \\eta $: 动力粘度。\n  - $ S $: 标量序参数。\n  - $ \\beta $: 无量纲涡旋系数。\n  - $ C $: 无量纲预因子，给定为 $ C = 1/(4\\pi) $。\n- **PIV 数据的线性模型**: $ \\mathbf{v}^{\\mathrm{meas}}_k = \\zeta_{\\mathrm{true}}\\mathbf{B}(\\mathbf{x}_k) + \\boldsymbol{\\varepsilon}(\\mathbf{x}_k) $。\n- **基底场**:\n$$\n\\mathbf{B}(\\mathbf{x}) \\equiv \\frac{C S}{\\eta r}\\left[\\cos(\\theta - \\theta_p)\\,\\hat{\\mathbf{p}} + \\beta \\sin(\\theta - \\theta_p)\\,\\hat{\\mathbf{p}}_{\\perp}\\right]\n$$\n- **目标**: 最小化成本函数 $ L(\\zeta) = \\sum_{k=1}^N \\|\\mathbf{v}^{\\mathrm{meas}}_k - \\zeta\\,\\mathbf{B}(\\mathbf{x}_k)\\|^2 $ 以求得估计量 $ \\hat{\\zeta} $。\n- **确定性噪声场**:\n$$\n\\boldsymbol{\\varepsilon}(\\mathbf{x}) = \\epsilon \\begin{bmatrix} \\sin(x)\\cos(y) \\\\ \\cos(x)\\sin(y) \\end{bmatrix}\n$$\n- **采样网格**: 同心圆环，有 $ n_r $ 个半径 $ r_i = r_{\\min} + i\\,(r_{\\max} - r_{\\min})/(n_r - 1) $（$ i = 0, \\dots, n_r-1 $），每个圆环上有 $ n_\\theta $ 个点，角度为 $ \\theta_j = 2\\pi j/n_\\theta $（$ j = 0, \\dots, n_\\theta-1 $）。\n- **测试用例**:\n  - 情况 A: $ \\zeta_{\\mathrm{true}} = 1.25 $, $ \\eta = 1.0 $, $ S = 0.6 $, $ \\theta_p = 0.0 $, $ r_{\\min} = 0.5 $, $ r_{\\max} = 3.0 $, $ n_r = 3 $, $ n_\\theta = 16 $, $ \\beta = 0.5 $, $ C = 1/(4\\pi) $, $ \\epsilon = 0.02 $。\n  - 情况 B: $ \\zeta_{\\mathrm{true}} = 0.0 $, $ \\eta = 1.0 $, $ S = 0.8 $, $ \\theta_p = \\pi/3 $, $ r_{\\min} = 0.6 $, $ r_{\\max} = 2.5 $, $ n_r = 4 $, $ n_\\theta = 12 $, $ \\beta = 0.5 $, $ C = 1/(4\\pi) $, $ \\epsilon = 0.03 $。\n  - 情况 C: $ \\zeta_{\\mathrm{true}} = 2.0 $, $ \\eta = 0.7 $, $ S = 0.5 $, $ \\theta_p = \\pi/4 $, $ r_{\\min} = 0.3 $, $ r_{\\max} = 1.5 $, $ n_r = 5 $, $ n_\\theta = 10 $, $ \\beta = 0.5 $, $ C = 1/(4\\pi) $, $ \\epsilon = 0.05 $。\n\n### 第2步：使用提取的已知条件进行验证\n\n根据验证标准对问题进行评估。\n- **科学基础**：该问题设置在活性向列相的背景下，这是软凝聚态物理学中一个成熟的子领域。使用 Stokes 流处理低雷诺数流体动力学、通过向列相张量 $ \\mathbf{Q} $ 定义活性应力，以及 $+1/2$ 缺陷的远场速度分布，都是文献中的标准概念。该问题是物理系统的一个简化但科学上一致的表示。\n- **适定性**：核心任务是为线性模型 $ \\mathbf{v} = \\zeta \\mathbf{B} $ 找到最佳拟合的标量参数 $ \\zeta $。这是一个经典的线性最小二乘问题。给定基底场 $ \\mathbf{B}(\\mathbf{x}) $ 和测量数据 $ \\mathbf{v}^{\\mathrm{meas}}_k $ 的定义，只要基底场不恒等于零，估计量 $ \\hat{\\zeta} $ 的唯一解就存在且可以推导。给定的参数确保 $ \\mathbf{B}(\\mathbf{x}) $ 在采样域上是良定义且非零的。\n- **客观性**：问题使用了精确的数学和物理术语进行陈述。所有参数、模型和程序都得到了明确定义。没有主观或基于观点的陈述。\n- **完整性**：生成合成数据（$ \\zeta_{\\mathrm{true}} $, $ \\eta $, $ S $, $ \\theta_p $, $ \\beta $, $ C $, $ \\epsilon $, 网格参数）和执行估计所需的所有必要参数和函数形式都已提供。问题是自包含的。\n- **一致性**：所提供的数据或模型定义中没有内部矛盾。\n- **可行性**：在无量纲化框架内，参数是物理上合理的。指定的计算是标准的数值运算。\n\n### 第3步：结论与行动\n\n该问题被认为是**有效的**。这是一个定义明确、有科学依据的练习，旨在使用从物理原理推导出的线性模型进行参数估计。可以继续进行求解过程。\n\n### 求解\n\n目标是找到 $ \\zeta $ 的值，记为 $ \\hat{\\zeta} $，它能够最小化所有 $ N $ 个数据点上测量速度数据 $ \\mathbf{v}^{\\mathrm{meas}}_k $ 与模型预测 $ \\zeta\\,\\mathbf{B}(\\mathbf{x}_k) $ 之间的误差平方和。需要最小化的成本函数是：\n$$\nL(\\zeta) = \\sum_{k=1}^{N} \\left\\| \\mathbf{v}^{\\mathrm{meas}}_k - \\zeta\\,\\mathbf{B}(\\mathbf{x}_k) \\right\\|^2\n$$\n向量 $ \\mathbf{u} $ 的欧几里得范数的平方由其与自身的点积给出，即 $ \\|\\mathbf{u}\\|^2 = \\mathbf{u} \\cdot \\mathbf{u} $。应用此性质，我们可以展开成本函数：\n$$\nL(\\zeta) = \\sum_{k=1}^{N} \\left( \\mathbf{v}^{\\mathrm{meas}}_k - \\zeta\\,\\mathbf{B}(\\mathbf{x}_k) \\right) \\cdot \\left( \\mathbf{v}^{\\mathrm{meas}}_k - \\zeta\\,\\mathbf{B}(\\mathbf{x}_k) \\right)\n$$\n使用点积的分配律，求和中的每一项变为：\n$$\n\\left( \\mathbf{v}^{\\mathrm{meas}}_k \\cdot \\mathbf{v}^{\\mathrm{meas}}_k \\right) - 2\\zeta \\left( \\mathbf{v}^{\\mathrm{meas}}_k \\cdot \\mathbf{B}(\\mathbf{x}_k) \\right) + \\zeta^2 \\left( \\mathbf{B}(\\mathbf{x}_k) \\cdot \\mathbf{B}(\\mathbf{x}_k) \\right)\n$$\n用范数重写此式可得：\n$$\nL(\\zeta) = \\sum_{k=1}^{N} \\left( \\|\\mathbf{v}^{\\mathrm{meas}}_k\\|^2 - 2\\zeta (\\mathbf{v}^{\\mathrm{meas}}_k \\cdot \\mathbf{B}(\\mathbf{x}_k)) + \\zeta^2 \\|\\mathbf{B}(\\mathbf{x}_k)\\|^2 \\right)\n$$\n这个表达式是关于 $ \\zeta $ 的一个形如 $ A\\zeta^2 + B\\zeta + C $ 的二次函数，描述了一个开口向上的抛物线。其最小值可以通过对 $ \\zeta $ 求导并令其为零来找到。\n$$\n\\frac{d L}{d \\zeta} = \\frac{d}{d \\zeta} \\sum_{k=1}^{N} \\left( \\|\\mathbf{v}^{\\mathrm{meas}}_k\\|^2 - 2\\zeta (\\mathbf{v}^{\\mathrm{meas}}_k \\cdot \\mathbf{B}(\\mathbf{x}_k)) + \\zeta^2 \\|\\mathbf{B}(\\mathbf{x}_k)\\|^2 \\right)\n$$\n和的导数等于导数的和。项 $ \\|\\mathbf{v}^{\\mathrm{meas}}_k\\|^2 $ 相对于 $ \\zeta $ 是常数。\n$$\n\\frac{d L}{d \\zeta} = \\sum_{k=1}^{N} \\left( -2 (\\mathbf{v}^{\\mathrm{meas}}_k \\cdot \\mathbf{B}(\\mathbf{x}_k)) + 2\\zeta \\|\\mathbf{B}(\\mathbf{x}_k)\\|^2 \\right)\n$$\n将导数设为零以求得最优值 $ \\hat{\\zeta} $：\n$$\n0 = \\sum_{k=1}^{N} \\left( -2 (\\mathbf{v}^{\\mathrm{meas}}_k \\cdot \\mathbf{B}(\\mathbf{x}_k)) + 2\\hat{\\zeta} \\|\\mathbf{B}(\\mathbf{x}_k)\\|^2 \\right)\n$$\n我们可以重排此方程以解出 $ \\hat{\\zeta} $：\n$$\n2\\hat{\\zeta} \\sum_{k=1}^{N} \\|\\mathbf{B}(\\mathbf{x}_k)\\|^2 = 2 \\sum_{k=1}^{N} (\\mathbf{v}^{\\mathrm{meas}}_k \\cdot \\mathbf{B}(\\mathbf{x}_k))\n$$\n最后，除以 $ \\hat{\\zeta} $ 的系数，得到最小二乘估计量的闭式表达式：\n$$\n\\hat{\\zeta} = \\frac{\\sum_{k=1}^{N} \\mathbf{v}^{\\mathrm{meas}}_k \\cdot \\mathbf{B}(\\mathbf{x}_k)}{\\sum_{k=1}^{N} \\|\\mathbf{B}(\\mathbf{x}_k)\\|^2}\n$$\n这个公式提供了算法的核心。\n\n算法流程如下：\n1. 对于给定的测试用例参数集，生成 $ N = n_r \\times n_\\theta $ 个采样点的网格 $ \\{\\mathbf{x}_k\\} $。笛卡尔坐标 $ (x_k, y_k) $ 从极坐标 $ (r_i, \\theta_j) $ 通过 $ x_k = r_i \\cos(\\theta_j) $ 和 $ y_k = r_i \\sin(\\theta_j) $ 获得。\n2. 对于每个点 $ \\mathbf{x}_k $，我们计算基底向量 $ \\mathbf{B}(\\mathbf{x}_k) $ 和测量速度向量 $ \\mathbf{v}^{\\mathrm{meas}}_k $。\n    - 极性向量为 $ \\hat{\\mathbf{p}} = (\\cos\\theta_p, \\sin\\theta_p) $ 和 $ \\hat{\\mathbf{p}}_{\\perp} = (-\\sin\\theta_p, \\cos\\theta_p) $。\n    - 基底向量 $ \\mathbf{B}(\\mathbf{x}_k) $ 直接根据其定义计算，使用该点的极坐标 $ r_k $ 和 $ \\theta_k $。\n    - 确定性噪声向量为 $ \\boldsymbol{\\varepsilon}(\\mathbf{x}_k) = \\epsilon (\\sin(x_k)\\cos(y_k), \\cos(x_k)\\sin(y_k)) $。\n    - 合成的测量速度则为 $ \\mathbf{v}^{\\mathrm{meas}}_k = \\zeta_{\\mathrm{true}}\\mathbf{B}(\\mathbf{x}_k) + \\boldsymbol{\\varepsilon}(\\mathbf{x}_k) $。\n3. 然后，我们计算估计量 $ \\hat{\\zeta} $ 所需的两个和。\n    - 分子项是点积的和：$ \\sum_{k=1}^{N} \\mathbf{v}^{\\mathrm{meas}}_k \\cdot \\mathbf{B}(\\mathbf{x}_k) $。\n    - 分母项是范数平方的和：$ \\sum_{k=1}^{N} \\|\\mathbf{B}(\\mathbf{x}_k)\\|^2 = \\sum_{k=1}^{N} \\mathbf{B}(\\mathbf{x}_k) \\cdot \\mathbf{B}(\\mathbf{x}_k) $。\n4. 估计值 $ \\hat{\\zeta} $ 计算为这两个和的比率。\n对问题陈述中提供的每个测试用例重复此过程。实现将利用 `numpy` 对点和向量的数组进行高效的向量化计算。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of estimating the activity parameter zeta from synthetic PIV data\n    for a set of test cases defined in the problem statement.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: happy path\n        dict(\n            zeta_true=1.25, eta=1.0, S=0.6, theta_p=0.0,\n            r_min=0.5, r_max=3.0, n_r=3, n_theta=16,\n            beta=0.5, C=1/(4*np.pi), epsilon=0.02\n        ),\n        # Case B: near-zero activity boundary\n        dict(\n            zeta_true=0.0, eta=1.0, S=0.8, theta_p=np.pi/3,\n            r_min=0.6, r_max=2.5, n_r=4, n_theta=12,\n            beta=0.5, C=1/(4*np.pi), epsilon=0.03\n        ),\n        # Case C: anisotropy and viscosity variation\n        dict(\n            zeta_true=2.0, eta=0.7, S=0.5, theta_p=np.pi/4,\n            r_min=0.3, r_max=1.5, n_r=5, n_theta=10,\n            beta=0.5, C=1/(4*np.pi), epsilon=0.05\n        )\n    ]\n\n    results = []\n    for params in test_cases:\n        # Extract parameters for the current case\n        zeta_true = params['zeta_true']\n        eta = params['eta']\n        S = params['S']\n        theta_p = params['theta_p']\n        r_min = params['r_min']\n        r_max = params['r_max']\n        n_r = params['n_r']\n        n_theta = params['n_theta']\n        beta = params['beta']\n        C = params['C']\n        epsilon = params['epsilon']\n\n        # Step 1: Generate sampling positions\n        # Create n_r radii for the concentric rings\n        if n_r > 1:\n            radii = np.linspace(r_min, r_max, n_r)\n        else:\n            radii = np.array([r_min])\n        \n        # Create n_theta angles for points on each ring\n        angles = np.linspace(0, 2 * np.pi, n_theta, endpoint=False)\n\n        # Create a mesh grid of polar coordinates and flatten them\n        r_grid, theta_grid = np.meshgrid(radii, angles)\n        r_k = r_grid.flatten()\n        theta_k = theta_grid.flatten()\n\n        # Convert polar coordinates to Cartesian coordinates (x, y)\n        x_k = r_k * np.cos(theta_k)\n        y_k = r_k * np.sin(theta_k)\n\n        # Step 2: Calculate basis field B(x_k) and measured velocity v_meas_k\n        \n        # Define polarity vectors\n        p_hat = np.array([np.cos(theta_p), np.sin(theta_p)])\n        p_hat_perp = np.array([-np.sin(theta_p), np.cos(theta_p)])\n\n        # Calculate the basis field B(x_k) for all points\n        # The structure is (N_points, 2) for the vector field\n        cos_term = np.cos(theta_k - theta_p)[:, np.newaxis]\n        sin_term = np.sin(theta_k - theta_p)[:, np.newaxis]\n        prefactor = (C * S) / (eta * r_k[:, np.newaxis])\n        \n        B_k = prefactor * (cos_term * p_hat + beta * sin_term * p_hat_perp)\n\n        # Calculate the deterministic noise field epsilon(x_k)\n        eps_x = epsilon * np.sin(x_k) * np.cos(y_k)\n        eps_y = epsilon * np.cos(x_k) * np.sin(y_k)\n        # Reshape to (N_points, 2)\n        eps_k = np.vstack((eps_x, eps_y)).T\n\n        # Generate synthetic PIV data (measured velocity)\n        v_meas_k = zeta_true * B_k + eps_k\n\n        # Step 3  4: Compute the least-squares estimate hat_zeta\n        \n        # Numerator: sum(v_meas_k . B_k)\n        # np.sum(v_meas_k * B_k) performs element-wise multiplication and sum,\n        # which is equivalent to sum of dot products for (N, 2) arrays.\n        numerator = np.sum(v_meas_k * B_k)\n        \n        # Denominator: sum(||B_k||^2) = sum(B_k . B_k)\n        denominator = np.sum(B_k * B_k)\n\n        # If the basis field is zero everywhere (e.g., S=0), denominator is zero.\n        # Handle this to avoid division by zero.\n        if denominator == 0:\n            hat_zeta = 0.0\n        else:\n            hat_zeta = numerator / denominator\n        \n        results.append(hat_zeta)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}