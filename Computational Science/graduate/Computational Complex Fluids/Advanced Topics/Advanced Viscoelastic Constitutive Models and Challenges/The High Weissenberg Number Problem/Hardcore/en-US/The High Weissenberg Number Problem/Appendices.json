{
    "hands_on_practices": [
        {
            "introduction": "Before tackling the numerical aspects of the High Weissenberg Number Problem, it is essential to understand its origin within the constitutive model itself. This foundational exercise guides you through an analytical derivation for the Oldroyd-B model in a simple shear flow . By solving for the steady-state stress components, you will discover how the model predicts an unbounded growth of elastic stresses with the Weissenberg number, providing a clear theoretical explanation for why these models are inherently challenging to solve numerically at high elasticity.",
            "id": "4107507",
            "problem": "A dilute polymer solution is modeled by the Oldroyd-B constitutive equation in its kinetic-theory form. The polymeric extra-stress tensor is related to the conformation tensor by $\\boldsymbol{\\tau}_{p} = G \\left( \\boldsymbol{A} - \\boldsymbol{I} \\right)$, where $G$ is the polymer elastic modulus and $\\boldsymbol{I}$ is the identity tensor. The conformation tensor $\\boldsymbol{A}$ obeys the upper-convected evolution equation $\\overset{\\triangledown}{\\boldsymbol{A}} = - \\frac{1}{\\lambda} \\left( \\boldsymbol{A} - \\boldsymbol{I} \\right)$, where $\\lambda$ is the polymer relaxation time and $\\overset{\\triangledown}{(\\cdot)}$ denotes the upper-convected derivative. Consider a homogeneous, steady simple shear flow with velocity field $\\boldsymbol{v} = \\left( \\dot{\\gamma} y, 0, 0 \\right)$, where $\\dot{\\gamma}$ is the constant shear rate. Using only these base definitions and fundamental tensor calculus, derive the analytic expression for the steady-state polymer shear stress component $\\tau_{p,12}$ and, in terms of the Weissenberg number $\\mathrm{Wi} = \\lambda \\dot{\\gamma}$, argue how $\\tau_{p,12}$ scales with $\\mathrm{Wi}$ in this flow. Provide your final result as a closed-form analytic expression for $\\tau_{p,12}$ in terms of $G$ and $\\mathrm{Wi}$. No numerical evaluation is required. State your answer as an expression without units.",
            "solution": "The user wants me to solve the following problem:\nA dilute polymer solution is modeled by the Oldroyd-B constitutive equation in its kinetic-theory form. The polymeric extra-stress tensor is related to the conformation tensor by $\\boldsymbol{\\tau}_{p} = G \\left( \\boldsymbol{A} - \\boldsymbol{I} \\right)$, where $G$ is the polymer elastic modulus and $\\boldsymbol{I}$ is the identity tensor. The conformation tensor $\\boldsymbol{A}$ obeys the upper-convected evolution equation $\\overset{\\triangledown}{\\boldsymbol{A}} = - \\frac{1}{\\lambda} \\left( \\boldsymbol{A} - \\boldsymbol{I} \\right)$, where $\\lambda$ is the polymer relaxation time and $\\overset{\\triangledown}{(\\cdot)}$ denotes the upper-convected derivative. Consider a homogeneous, steady simple shear flow with velocity field $\\boldsymbol{v} = \\left( \\dot{\\gamma} y, 0, 0 \\right)$, where $\\dot{\\gamma}$ is the constant shear rate. Using only these base definitions and fundamental tensor calculus, derive the analytic expression for the steady-state polymer shear stress component $\\tau_{p,12}$ and, in terms of the Weissenberg number $\\mathrm{Wi} = \\lambda \\dot{\\gamma}$, argue how $\\tau_{p,12}$ scales with $\\mathrm{Wi}$ in this flow. Provide your final result as a closed-form analytic expression for $\\tau_{p,12}$ in terms of $G$ and $\\mathrm{Wi}$. No numerical evaluation is required. State your answer as an expression without units.\n\n### Step 1: Extract Givens\n- Polymeric extra-stress tensor: $\\boldsymbol{\\tau}_{p} = G \\left( \\boldsymbol{A} - \\boldsymbol{I} \\right)$\n- $G$: polymer elastic modulus\n- $\\boldsymbol{A}$: conformation tensor\n- $\\boldsymbol{I}$: identity tensor\n- Conformation tensor evolution equation: $\\overset{\\triangledown}{\\boldsymbol{A}} = - \\frac{1}{\\lambda} \\left( \\boldsymbol{A} - \\boldsymbol{I} \\right)$\n- $\\lambda$: polymer relaxation time\n- $\\overset{\\triangledown}{(\\cdot)}$: upper-convected derivative\n- Velocity field for homogeneous, steady simple shear flow: $\\boldsymbol{v} = \\left( \\dot{\\gamma} y, 0, 0 \\right)$\n- $\\dot{\\gamma}$: constant shear rate\n- Weissenberg number: $\\mathrm{Wi} = \\lambda \\dot{\\gamma}$\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem describes the Oldroyd-B model, a fundamental and widely used constitutive model in rheology for describing viscoelastic fluids (specifically, dilute polymer solutions represented as Hookean dumbbells). The equations for stress and the evolution of the conformation tensor are standard. The simple shear flow is a canonical flow for material characterization. The Weissenberg number is correctly defined. All premises are based on established principles of continuum mechanics and polymer kinetic theory.\n- **Well-Posed**: The problem provides all necessary equations, definitions, and conditions (steady, homogeneous flow) to determine a unique solution for the stress tensor components. The task is specific and answerable.\n- **Objective**: The problem is stated in precise, mathematical language, free of subjective or ambiguous terminology.\n- **Completeness and Consistency**: The provided information is self-contained and consistent. No essential data is missing.\n- **Relation to Topic**: The problem is a core exercise in the study of viscoelastic constitutive models and directly addresses the behavior of stress as a function of the Weissenberg number, which is central to understanding the high Weissenberg number problem (HWNP) in computational fluid dynamics.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, well-posed, objective, and complete. It is a valid problem in the field of non-Newtonian fluid mechanics. I will proceed with the solution.\n\nThe problem requires the derivation of the steady-state polymer shear stress $\\tau_{p,12}$. This begins with solving the evolution equation for the conformation tensor $\\boldsymbol{A}$ under the specified flow conditions.\n\nThe upper-convected derivative of a contravariant second-rank tensor like the conformation tensor $\\boldsymbol{A}$ is defined as:\n$$\n\\overset{\\triangledown}{\\boldsymbol{A}} = \\frac{D\\boldsymbol{A}}{Dt} - \\boldsymbol{L}\\boldsymbol{A} - \\boldsymbol{A}\\boldsymbol{L}^{T}\n$$\nwhere $\\frac{D\\boldsymbol{A}}{Dt} = \\frac{\\partial \\boldsymbol{A}}{\\partial t} + \\boldsymbol{v} \\cdot \\nabla \\boldsymbol{A}$ is the material derivative, and $\\boldsymbol{L} = \\nabla \\boldsymbol{v}$ is the velocity gradient tensor.\n\nThe problem specifies a steady and homogeneous flow. For a steady flow, the partial time derivative is zero: $\\frac{\\partial \\boldsymbol{A}}{\\partial t} = \\boldsymbol{0}$. For a homogeneous flow, all fields are spatially uniform, which implies that the conformation tensor $\\boldsymbol{A}$ is not a function of position. Therefore, the convective part of the material derivative is also zero: $\\boldsymbol{v} \\cdot \\nabla \\boldsymbol{A} = \\boldsymbol{0}$.\nThis simplifies the upper-convected derivative to:\n$$\n\\overset{\\triangledown}{\\boldsymbol{A}} = - \\boldsymbol{L}\\boldsymbol{A} - \\boldsymbol{A}\\boldsymbol{L}^{T}\n$$\nSubstituting this into the given evolution equation, $\\overset{\\triangledown}{\\boldsymbol{A}} = - \\frac{1}{\\lambda} \\left( \\boldsymbol{A} - \\boldsymbol{I} \\right)$, we get:\n$$\n- \\boldsymbol{L}\\boldsymbol{A} - \\boldsymbol{A}\\boldsymbol{L}^{T} = - \\frac{1}{\\lambda} \\left( \\boldsymbol{A} - \\boldsymbol{I} \\right)\n$$\nMultiplying by $-\\lambda$ yields:\n$$\n\\lambda \\left( \\boldsymbol{L}\\boldsymbol{A} + \\boldsymbol{A}\\boldsymbol{L}^{T} \\right) = \\boldsymbol{A} - \\boldsymbol{I}\n$$\nThis is an algebraic equation for the tensor $\\boldsymbol{A}$.\n\nNext, we determine the velocity gradient tensor $\\boldsymbol{L}$ for the given velocity field $\\boldsymbol{v} = (v_1, v_2, v_3) = (\\dot{\\gamma} y, 0, 0)$. The components of $\\boldsymbol{L}$ are $L_{ij} = \\frac{\\partial v_i}{\\partial x_j}$, where $(x_1, x_2, x_3) = (x, y, z)$.\n$$\n\\boldsymbol{L} = \\nabla \\boldsymbol{v} = \\begin{pmatrix}\n\\frac{\\partial v_1}{\\partial x}  \\frac{\\partial v_1}{\\partial y}  \\frac{\\partial v_1}{\\partial z} \\\\\n\\frac{\\partial v_2}{\\partial x}  \\frac{\\partial v_2}{\\partial y}  \\frac{\\partial v_2}{\\partial z} \\\\\n\\frac{\\partial v_3}{\\partial x}  \\frac{\\partial v_3}{\\partial y}  \\frac{\\partial v_3}{\\partial z}\n\\end{pmatrix} = \\begin{pmatrix}\n0  \\dot{\\gamma}  0 \\\\\n0  0  0 \\\\\n0  0  0\n\\end{pmatrix}\n$$\nThe transpose of $\\boldsymbol{L}$ is:\n$$\n\\boldsymbol{L}^{T} = \\begin{pmatrix}\n0  0  0 \\\\\n\\dot{\\gamma}  0  0 \\\\\n0  0  0\n\\end{pmatrix}\n$$\nWe now compute the terms $\\boldsymbol{L}\\boldsymbol{A}$ and $\\boldsymbol{A}\\boldsymbol{L}^{T}$. The conformation tensor $\\boldsymbol{A}$ is symmetric, so $A_{ij} = A_{ji}$.\n$$\n\\boldsymbol{L}\\boldsymbol{A} = \\begin{pmatrix}\n0  \\dot{\\gamma}  0 \\\\\n0  0  0 \\\\\n0  0  0\n\\end{pmatrix} \\begin{pmatrix}\nA_{11}  A_{12}  A_{13} \\\\\nA_{12}  A_{22}  A_{23} \\\\\nA_{13}  A_{23}  A_{33}\n\\end{pmatrix} = \\begin{pmatrix}\nA_{12}\\dot{\\gamma}  A_{22}\\dot{\\gamma}  A_{23}\\dot{\\gamma} \\\\\n0  0  0 \\\\\n0  0  0\n\\end{pmatrix}\n$$\n$$\n\\boldsymbol{A}\\boldsymbol{L}^{T} = \\begin{pmatrix}\nA_{11}  A_{12}  A_{13} \\\\\nA_{12}  A_{22}  A_{23} \\\\\nA_{13}  A_{23}  A_{33}\n\\end{pmatrix} \\begin{pmatrix}\n0  0  0 \\\\\n\\dot{\\gamma}  0  0 \\\\\n0  0  0\n\\end{pmatrix} = \\begin{pmatrix}\nA_{12}\\dot{\\gamma}  0  0 \\\\\nA_{22}\\dot{\\gamma}  0  0 \\\\\nA_{23}\\dot{\\gamma}  0  0\n\\end{pmatrix}\n$$\nThe sum is:\n$$\n\\boldsymbol{L}\\boldsymbol{A} + \\boldsymbol{A}\\boldsymbol{L}^{T} = \\begin{pmatrix}\n2A_{12}\\dot{\\gamma}  A_{22}\\dot{\\gamma}  A_{23}\\dot{\\gamma} \\\\\nA_{22}\\dot{\\gamma}  0  0 \\\\\nA_{23}\\dot{\\gamma}  0  0\n\\end{pmatrix}\n$$\nNow, substitute this into the rearranged evolution equation, $\\boldsymbol{A} - \\boldsymbol{I} = \\lambda \\left( \\boldsymbol{L}\\boldsymbol{A} + \\boldsymbol{A}\\boldsymbol{L}^{T} \\right)$, and introduce the Weissenberg number $\\mathrm{Wi} = \\lambda \\dot{\\gamma}$:\n$$\n\\begin{pmatrix}\nA_{11}-1  A_{12}  A_{13} \\\\\nA_{12}  A_{22}-1  A_{23} \\\\\nA_{13}  A_{23}  A_{33}-1\n\\end{pmatrix} = \\mathrm{Wi} \\begin{pmatrix}\n2A_{12}  A_{22}  A_{23} \\\\\nA_{22}  0  0 \\\\\nA_{23}  0  0\n\\end{pmatrix}\n$$\nThis matrix equation yields a system of linear algebraic equations for the components of $\\boldsymbol{A}$:\n\\begin{itemize}\n    \\item $(3,3)$: $A_{33}-1 = \\mathrm{Wi}(0) \\implies A_{33} = 1$\n    \\item $(2,3)$: $A_{23} = \\mathrm{Wi}(0) \\implies A_{23} = 0$\n    \\item $(1,3)$: $A_{13} = \\mathrm{Wi}(A_{23}) = \\mathrm{Wi}(0) \\implies A_{13} = 0$\n    \\item $(2,2)$: $A_{22}-1 = \\mathrm{Wi}(0) \\implies A_{22} = 1$\n    \\item $(1,2)$: $A_{12} = \\mathrm{Wi}(A_{22}) = \\mathrm{Wi}(1) \\implies A_{12} = \\mathrm{Wi}$\n    \\item $(1,1)$: $A_{11}-1 = \\mathrm{Wi}(2A_{12}) = \\mathrm{Wi}(2\\mathrm{Wi}) \\implies A_{11} = 1 + 2\\mathrm{Wi}^2$\n\\end{itemize}\nThus, the steady-state conformation tensor is:\n$$\n\\boldsymbol{A} = \\begin{pmatrix}\n1 + 2\\mathrm{Wi}^2  \\mathrm{Wi}  0 \\\\\n\\mathrm{Wi}  1  0 \\\\\n0  0  1\n\\end{pmatrix}\n$$\nThe problem asks for the polymer extra-stress tensor component $\\tau_{p,12}$. We use the given relation $\\boldsymbol{\\tau}_{p} = G \\left( \\boldsymbol{A} - \\boldsymbol{I} \\right)$:\n$$\n\\boldsymbol{\\tau}_{p} = G \\left( \\begin{pmatrix}\n1 + 2\\mathrm{Wi}^2  \\mathrm{Wi}  0 \\\\\n\\mathrm{Wi}  1  0 \\\\\n0  0  1\n\\end{pmatrix} - \\begin{pmatrix}\n1  0  0 \\\\\n0  1  0 \\\\\n0  0  1\n\\end{pmatrix} \\right) = G \\begin{pmatrix}\n2\\mathrm{Wi}^2  \\mathrm{Wi}  0 \\\\\n\\mathrm{Wi}  0  0 \\\\\n0  0  0\n\\end{pmatrix}\n$$\nFrom this resulting stress tensor, we can directly identify the shear stress component $\\tau_{p,12}$ as the $(1,2)$ element:\n$$\n\\tau_{p,12} = G \\, \\mathrm{Wi}\n$$\nThis is the closed-form analytic expression for the polymer shear stress.\n\nThe problem also asks to argue how $\\tau_{p,12}$ scales with $\\mathrm{Wi}$. The derived expression $\\tau_{p,12} = G \\, \\mathrm{Wi}$ shows that the polymer shear stress is directly and linearly proportional to the Weissenberg number. As $\\mathrm{Wi}$ increases, $\\tau_{p,12}$ increases without bound. This linear scaling contrasts with the first normal stress difference, $N_1 = \\tau_{p,11} - \\tau_{p,22} = G(2\\mathrm{Wi}^2) - G(0) = 2G\\mathrm{Wi}^2$, which scales quadratically with $\\mathrm{Wi}$. The unbounded growth of the stress tensor components at high $\\mathrm{Wi}$ is a characteristic feature of the Oldroyd-B model and is a primary reason for the numerical instabilities known as the High Weissenberg Number Problem (HWNP) in simulations of viscoelastic flows. For the shear stress specifically, the scaling is linear.",
            "answer": "$$\n\\boxed{G \\, \\mathrm{Wi}}\n$$"
        },
        {
            "introduction": "In complex flows, the High Weissenberg Number Problem can manifest through various competing physical mechanisms. This diagnostic challenge presents a realistic (though hypothetical) scenario from a benchmark contraction flow simulation, requiring you to act as a computational scientist . By analyzing numerical residuals and local flow scales, you will learn to distinguish between different failure modes, such as advection-dominance versus deformation-dominance, a critical skill for debugging and improving advanced viscoelastic flow simulations.",
            "id": "4107391",
            "problem": "Consider steady, incompressible flow of an Oldroyd–B fluid through a planar 4:1 contraction. The upstream channel height is $H$, the throat height is $H/4$, and the characteristic velocity is the mean velocity in the throat $U$. The density is $\\rho$, the total viscosity is $\\eta=\\eta_s+\\eta_p$, and the viscosity ratio is $\\beta=\\eta_s/\\eta$ with $\\beta=0.5$. The Reynolds number is $Re=\\rho U H/\\eta=0.01$, and the Weissenberg number is $Wi=\\lambda U/H$, where $\\lambda$ is the relaxation time. The governing equations are the steady Stokes momentum balance with polymeric extra stress and the Oldroyd–B constitutive equation\n$$\n-\\nabla p + \\eta_s \\nabla^2 \\mathbf{u} + \\nabla\\cdot \\boldsymbol{\\tau} = \\mathbf{0}, \\quad \\nabla\\cdot \\mathbf{u} = 0,\n$$\n$$\n\\lambda \\left( \\mathbf{u}\\cdot\\nabla \\boldsymbol{\\tau} - (\\nabla \\mathbf{u}) \\boldsymbol{\\tau} - \\boldsymbol{\\tau} (\\nabla \\mathbf{u})^\\top \\right) + \\boldsymbol{\\tau} = 2 \\eta_p \\mathbf{D},\n$$\nwhere $\\mathbf{u}$ is the velocity, $p$ is the pressure, $\\boldsymbol{\\tau}$ is the polymeric extra stress, and $\\mathbf{D}=\\tfrac{1}{2}(\\nabla \\mathbf{u} + (\\nabla \\mathbf{u})^\\top)$ is the rate-of-deformation tensor.\n\nA high-resolution finite element computation is performed at $Wi=8$ and $Re=0.01$. Diagnostics are collected to compare velocity and stress error distributions and infer the mechanism triggering the High Weissenberg Number Problem (HWNP). Let $\\|R_{\\text{mom}}\\|_{L^2(\\Omega)}$ denote the $L^2$-norm of the discrete momentum residual and $\\|R_{\\tau}\\|_{L^2(\\Omega)}$ the $L^2$-norm of the discrete constitutive residual. The following observations are made:\n\n1. The residual norms satisfy $\\|R_{\\text{mom}}\\|_{L^2(\\Omega)} = 2\\times 10^{-3}$ and $\\|R_{\\tau}\\|_{L^2(\\Omega)} = 1.1\\times 10^{-1}$ (both nondimensionalized by the appropriate scales), with the spatial distribution of velocity error smooth and small compared to that of stress.\n\n2. The largest values of $|R_{\\tau}|$ occur in thin layers along streamlines that emanate from the re-entrant corners at the contraction plane and persist far downstream into the throat. In contrast, the upstream centerline extensional region shows moderate $|R_{\\tau}|$ without long downstream streaks.\n\n3. In a representative hotspot along such a shear layer near the re-entrant corner, local measurements give $|\\mathbf{u}| \\approx 0.9 U$, a stress gradient length scale $\\ell_{\\tau}$ (defined from the local exponential fit of $|\\nabla \\boldsymbol{\\tau}|$) with $\\ell_{\\tau}/H \\approx 0.02$, and a kinematic length scale for velocity gradients $\\ell_u$ (defined from $|\\nabla \\mathbf{u}| \\sim U/\\ell_u$) with $\\ell_u/H \\approx 0.1$.\n\n4. In the upstream centerline extensional region, local measurements give $|\\mathbf{u}| \\approx 0.05 U$, $\\ell_{\\tau}/H \\approx 0.3$, and $\\ell_u/H \\approx 0.05$.\n\n5. Adding a standard streamline-upwind Petrov–Galerkin (SUPG) stabilization targeted at the constitutive equation reduces $\\|R_{\\tau}\\|_{L^2(\\Omega)}$ by approximately $80\\%$ while leaving $\\|R_{\\text{mom}}\\|_{L^2(\\Omega)}$ essentially unchanged.\n\nUsing only first principles and the definitions implicit in the Oldroyd–B model, assess whether the observed HWNP in this computation is primarily triggered by advection dominance in the constitutive transport or by local imbalance between elastic deformation and relaxation. In your reasoning you may introduce local, dimensionless ratios that compare the magnitude of the advective and deformation terms to the relaxation term in the constitutive equation, using the given local scales.\n\nWhich option is most consistent with the observations?\n\nA. The diagnostics indicate advection-dominated transport of stress is the primary trigger of the HWNP, i.e., insufficient control of the $\\mathbf{u}\\cdot\\nabla \\boldsymbol{\\tau}$ term along streamlines causes large residuals and downstream streaks.\n\nB. The diagnostics indicate insufficient stress relaxation relative to local elastic deformation is the primary trigger, i.e., a large ratio of $\\|\\nabla \\mathbf{u}\\|$ to $1/\\lambda$ in low-speed regions causes large residuals that are localized near stagnation points without downstream streaks.\n\nC. The diagnostics indicate the momentum equation is the primary source of error, i.e., the HWNP here is driven by under-resolution of the velocity field rather than constitutive imbalance.\n\nD. The diagnostics are inconclusive; no inference can be made because the observed residual patterns and stabilization response do not discriminate between advection and relaxation mechanisms.",
            "solution": "The user wants me to act as a meticulous STEM professor and solve a fluid dynamics problem.\n\n**Step 1: Validation of the Problem Statement**\n\nThe first step is a critical validation of the problem statement to ensure its scientific and logical integrity.\n\n**Givens Extracted from the Problem Statement:**\n\n*   **Flow Configuration**: Steady, incompressible flow of an Oldroyd–B fluid through a planar 4:1 contraction.\n*   **Geometric and Kinematic Scales**: Upstream channel height is $H$, throat height is $H/4$. The characteristic velocity is the mean velocity in the throat, $U$.\n*   **Fluid Properties**: Density $\\rho$, total viscosity $\\eta=\\eta_s+\\eta_p$, viscosity ratio $\\beta=\\eta_s/\\eta=0.5$. The polymeric viscosity is therefore $\\eta_p = (1-\\beta)\\eta = 0.5\\eta$. The solvent viscosity is $\\eta_s = \\beta \\eta = 0.5\\eta$.\n*   **Governing Equations**:\n    *   Momentum and Continuity: $-\\nabla p + \\eta_s \\nabla^2 \\mathbf{u} + \\nabla\\cdot \\boldsymbol{\\tau} = \\mathbf{0}$, $\\nabla\\cdot \\mathbf{u} = 0$.\n    *   Oldroyd–B Constitutive Equation: $\\lambda \\left( \\mathbf{u}\\cdot\\nabla \\boldsymbol{\\tau} - (\\nabla \\mathbf{u}) \\boldsymbol{\\tau} - \\boldsymbol{\\tau} (\\nabla \\mathbf{u})^\\top \\right) + \\boldsymbol{\\tau} = 2 \\eta_p \\mathbf{D}$, where $\\mathbf{D}=\\tfrac{1}{2}(\\nabla \\mathbf{u} + (\\nabla \\mathbf{u})^\\top)$ is the rate-of-deformation tensor.\n*   **Dimensionless Parameters**: Reynolds number $Re=\\rho U H/\\eta=0.01$. Weissenberg number $Wi=\\lambda U/H=8$.\n*   **Numerical Computation Diagnostics**:\n    1.  Residual Norms: The nondimensionalized $L^2$-norm of the discrete momentum residual is $\\|R_{\\text{mom}}\\|_{L^2(\\Omega)} = 2\\times 10^{-3}$. The nondimensionalized $L^2$-norm of the discrete constitutive residual is $\\|R_{\\tau}\\|_{L^2(\\Omega)} = 1.1\\times 10^{-1}$. Velocity error is noted to be smaller and smoother than stress error.\n    2.  Spatial Distribution of $|R_{\\tau}|$: Largest values are found in thin layers along streamlines originating from re-entrant corners, persisting far downstream. The upstream centerline extensional region shows moderate $|R_{\\tau}|$ and no downstream streaks.\n    3.  Local Measurements (Re-entrant Corner Shear Layer): $|\\mathbf{u}| \\approx 0.9 U$. Stress gradient length scale $\\ell_{\\tau}/H \\approx 0.02$. Velocity gradient length scale $\\ell_u/H \\approx 0.1$.\n    4.  Local Measurements (Upstream Centerline Extensional Region): $|\\mathbf{u}| \\approx 0.05 U$. Stress gradient length scale $\\ell_{\\tau}/H \\approx 0.3$. Velocity gradient length scale $\\ell_u/H \\approx 0.05$.\n    5.  Stabilization Effect: Streamline-upwind Petrov–Galerkin (SUPG) stabilization on the constitutive equation reduces $\\|R_{\\tau}\\|_{L^2(\\Omega)}$ by approximately $80\\%$, while $\\|R_{\\text{mom}}\\|_{L^2(\\Omega)}$ is unaffected.\n\n**Validation Verdict and Action:**\n\nThe problem statement is **valid**.\n1.  **Scientifically Grounded**: The problem is set within the established framework of computational rheology. The geometry (planar contraction), fluid model (Oldroyd-B), governing equations, and dimensionless numbers ($Re$, $Wi$) are standard in the field. The High Weissenberg Number Problem (HWNP) is a well-documented computational challenge. The presented diagnostics are physically and numerically plausible.\n2.  **Well-Posed**: The problem is well-posed as a question of interpretation. It provides a complete set of fictional, yet realistic, numerical data and asks for a reasoned conclusion based on physical principles embedded in the model.\n3.  **Objective**: The problem is stated in precise, quantitative terms, free from subjective language.\n4.  **No Flaws**: The problem does not violate any of the invalidity criteria. It is internally consistent, scientifically sound, and provides sufficient information to address the question posed.\n\nThe problem is valid. I will now proceed to the solution.\n\n**Step 2: Derivation of the Solution**\n\nThe task is to determine whether the observed numerical difficulties (HWNP) are primarily caused by advection-dominance or by an imbalance between elastic deformation and relaxation. We must use the provided data and first principles from the Oldroyd-B constitutive equation.\n\nThe Oldroyd-B equation can be written as:\n$$ \\boldsymbol{\\tau} + \\lambda \\stackrel{\\nabla}{\\boldsymbol{\\tau}} = 2\\eta_p \\mathbf{D} $$\nwhere $\\stackrel{\\nabla}{\\boldsymbol{\\tau}} = \\mathbf{u}\\cdot\\nabla \\boldsymbol{\\tau} - (\\nabla \\mathbf{u}) \\boldsymbol{\\tau} - \\boldsymbol{\\tau} (\\nabla \\mathbf{u})^\\top$ is the upper-convected time derivative. This equation describes the transport and evolution of the polymeric stress tensor $\\boldsymbol{\\tau}$. The terms can be interpreted as:\n*   $\\boldsymbol{\\tau}$: The stress relaxation term, which drives the stress back towards zero with a characteristic time $\\lambda$.\n*   $\\lambda \\mathbf{u}\\cdot\\nabla \\boldsymbol{\\tau}$: The advective transport of stress along streamlines.\n*   $-\\lambda ((\\nabla \\mathbf{u}) \\boldsymbol{\\tau} + \\boldsymbol{\\tau} (\\nabla \\mathbf{u})^\\top)$: Deformation-induced stress generation.\n*   $2\\eta_p \\mathbf{D}$: A viscous-like source term for stress based on the local rate of deformation. Both this term and the deformation-induced term contribute to stress generation.\n\nThe HWNP arises when the constitutive equation becomes numerically unstable. This typically happens when certain terms dominate the relaxation term, $\\boldsymbol{\\tau}$. We can define local dimensionless numbers to compare the magnitudes of the advection and deformation terms to the relaxation term.\n\nLet's estimate the magnitudes of the terms using the provided local length scales.\nMagnitude of advection: $|\\lambda \\mathbf{u}\\cdot\\nabla \\boldsymbol{\\tau}| \\sim \\lambda |\\mathbf{u}| \\frac{|\\boldsymbol{\\tau}|}{\\ell_{\\tau}}$\nMagnitude of deformation: $|\\lambda ((\\nabla \\mathbf{u}) \\boldsymbol{\\tau} + \\dots)| \\sim \\lambda |\\nabla \\mathbf{u}| |\\boldsymbol{\\tau}| \\sim \\lambda \\frac{U}{\\ell_u} |\\boldsymbol{\\tau}|$\nMagnitude of relaxation: $|\\boldsymbol{\\tau}|$\n\nWe can define two local Weissenberg numbers to quantify the two hypothesized mechanisms:\n\n1.  **Local Advective Weissenberg Number ($Wi_{\\text{adv,local}}$)**: This ratio quantifies advection dominance. It is analogous to a Peclet number for stress transport.\n    $$ Wi_{\\text{adv,local}} = \\frac{|\\text{Advection Term}|}{|\\text{Relaxation Term}|} \\sim \\frac{\\lambda |\\mathbf{u}| |\\boldsymbol{\\tau}| / \\ell_{\\tau}}{|\\boldsymbol{\\tau}|} = \\lambda \\frac{|\\mathbf{u}|}{\\ell_{\\tau}} $$\n    A large $Wi_{\\text{adv,local}}$ signifies that stresses are advected downstream much faster than they can relax, making the equation strongly hyperbolic and difficult to solve with standard numerical methods.\n\n2.  **Local Deformation Weissenberg Number ($Wi_{\\text{def,local}}$)**: This ratio quantifies the dominance of deformation over relaxation.\n    $$ Wi_{\\text{def,local}} = \\frac{|\\text{Deformation Term}|}{|\\text{Relaxation Term}|} \\sim \\frac{\\lambda (U/\\ell_u) |\\boldsymbol{\\tau}|}{|\\boldsymbol{\\tau}|} = \\lambda \\frac{U}{\\ell_u} $$\n    A large $Wi_{\\textdef,local}}$ signifies that stresses are generated by the flow kinematics much faster than they can relax, which can lead to exponential stress growth and numerical breakdown.\n\nWe are given the global Weissenberg number $Wi = \\lambda U / H = 8$, which implies $\\lambda = 8H/U$. We can now calculate the local numbers for the two regions identified in the problem.\n\n**Region 1: Re-entrant Corner Shear Layer**\nHere, we have $|\\mathbf{u}| \\approx 0.9 U$, $\\ell_{\\tau}/H = 0.02$ (or $H/\\ell_{\\tau} = 50$), and $\\ell_u/H = 0.1$ (or $H/\\ell_u = 10$).\n*   **Advective Number**:\n    $$ Wi_{\\text{adv,local}} = \\lambda \\frac{|\\mathbf{u}|}{\\ell_{\\tau}} = \\left(\\frac{8H}{U}\\right) \\frac{0.9U}{0.02H} = 8 \\times \\frac{0.9}{0.02} = 8 \\times 45 = 360 $$\n*   **Deformation Number**:\n    $$ Wi_{\\text{def,local}} = \\lambda \\frac{U}{\\ell_u} = \\left(\\frac{8H}{U}\\right) \\frac{U}{0.1H} = \\frac{8}{0.1} = 80 $$\nIn this region, both numbers are large, but $Wi_{\\text{adv,local}}$ is significantly larger than $Wi_{\\text{def,local}}$ ($360$ vs $80$). This indicates that advective transport is the dominant physical mechanism.\n\n**Region 2: Upstream Centerline Extensional Region**\nHere, we have $|\\mathbf{u}| \\approx 0.05 U$, $\\ell_{\\tau}/H = 0.3$ (or $H/\\ell_{\\tau} \\approx 3.33$), and $\\ell_u/H = 0.05$ (or $H/\\ell_u = 20$).\n*   **Advective Number**:\n    $$ Wi_{\\text{adv,local}} = \\lambda \\frac{|\\mathbf{u}|}{\\ell_{\\tau}} = \\left(\\frac{8H}{U}\\right) \\frac{0.05U}{0.3H} = 8 \\times \\frac{0.05}{0.3} \\approx 8 \\times 0.167 \\approx 1.33 $$\n*   **Deformation Number**:\n    $$ Wi_{\\text{def,local}} = \\lambda \\frac{U}{\\ell_u} = \\left(\\frac{8H}{U}\\right) \\frac{U}{0.05H} = \\frac{8}{0.05} = 160 $$\nIn this region, the situation is reversed. $Wi_{\\text{def,local}}$ is very large ($160$), while $Wi_{\\text{adv,local}}$ is of order unity. This region is dominated by deformation kinematics.\n\n**Synthesizing All Diagnostic Information:**\n1.  **Residual Magnitudes**: $\\|R_{\\tau}\\|_{L^2(\\Omega)} = 0.11$ is much larger than $\\|R_{\\text{mom}}\\|_{L^2(\\Omega)} = 0.002$. This confirms the HWNP is a failure to solve the constitutive equation, not the momentum equation.\n2.  **Residual Location**: The largest residuals, $|R_{\\tau}|$, are in the re-entrant corner region and form downstream streaks. This region is where we calculated $Wi_{\\text{adv,local}}$ to be extremely high. The upstream centerline region, where we found deformation to be dominant, has only \"moderate\" residuals and, critically, no streaks. This strongly implies the primary trigger for the catastrophic error growth is in the advection-dominated region. The downstream streaks are a classic signature of unresolved hyperbolic transport.\n3.  **Stabilization**: The success of SUPG stabilization, which specifically targets advection-dominated transport by adding numerical diffusion along streamlines, provides definitive evidence. Its ability to reduce $\\|R_{\\tau}\\|_{L^2(\\Omega)}$ by $80\\%$ confirms that the dominant numerical error is caused by the advective term $\\mathbf{u}\\cdot\\nabla \\boldsymbol{\\tau}$.\n\n**Step 3: Option-by-Option Analysis**\n\n*   **A. The diagnostics indicate advection-dominated transport of stress is the primary trigger of the HWNP, i.e., insufficient control of the $\\mathbf{u}\\cdot\\nabla \\boldsymbol{\\tau}$ term along streamlines causes large residuals and downstream streaks.**\n    This conclusion is fully supported by our analysis. The local Weissenberg number calculation showed extreme advection dominance ($Wi_{\\text{adv,local}} = 360$) in the region of highest error. The description of \"downstream streaks\" is a hallmark of hyperbolic transport problems. The dramatic success of SUPG stabilization, a method for advection-dominated problems, is the final piece of corroborating evidence. This option is consistent with all provided information.\n    **Verdict: Correct.**\n\n*   **B. The diagnostics indicate insufficient stress relaxation relative to local elastic deformation is the primary trigger, i.e., a large ratio of $\\|\\nabla \\mathbf{u}\\|$ to $1/\\lambda$ in low-speed regions causes large residuals that are localized near stagnation points without downstream streaks.**\n    This mechanism, characterized by a large $Wi_{\\text{def,local}}$, is indeed active in the upstream centerline region ($Wi_{\\text{def,local}} = 160$). However, Observation 2 explicitly states that this region has only \"moderate\" residuals and \"without long downstream streaks.\" The largest errors, which define the computational breakdown, occur elsewhere. Therefore, this mechanism is not the *primary trigger* of the observed failure.\n    **Verdict: Incorrect.**\n\n*   **C. The diagnostics indicate the momentum equation is the primary source of error, i.e., the HWNP here is driven by under-resolution of the velocity field rather than constitutive imbalance.**\n    This is directly contradicted by Observation 1, which states that the constitutive residual norm is over $50$ times larger than the momentum residual norm ($\\|R_{\\tau}\\|_{L^2(\\Omega)} / \\|R_{\\text{mom}}\\|_{L^2(\\Omega)} = 0.11 / 0.002 = 55$). The problem lies squarely with the constitutive equation.\n    **Verdict: Incorrect.**\n\n*   **D. The diagnostics are inconclusive; no inference can be made because the observed residual patterns and stabilization response do not discriminate between advection and relaxation mechanisms.**\n    This is false. The diagnostics are highly conclusive. The combination of quantitative local analysis, the spatial signature of the error (downstream streaks), and the response to a targeted stabilization method (SUPG) provides a clear and consistent picture pointing to advection dominance as the primary cause of the numerical failure.\n    **Verdict: Incorrect.**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "A key physical feature of high-$Wi$ flows is the formation of extremely thin stress boundary layers, which demand immense resolution from a numerical grid. This hands-on coding exercise introduces a powerful computational solution: adaptive mesh refinement (AMR) . You will implement an algorithm that uses an a posteriori error estimator, based on stress gradients, to dynamically refine the mesh only where needed, demonstrating an efficient and elegant strategy for accurately capturing the sharp features that characterize the HWNP.",
            "id": "4107522",
            "problem": "Consider a nondimensional planar channel with wall-normal coordinate $y \\in [0,1]$. Let the flow be governed by a viscoelastic constitutive law consistent with the Oldroyd-B model, where the polymer extra-stress tensor $\\boldsymbol{\\tau}$ satisfies, in dimensional form, the relation $\\boldsymbol{\\tau} + \\lambda \\stackrel{\\triangledown}{\\boldsymbol{\\tau}} = 2 \\eta_p \\mathbf{D}$, with $\\lambda$ the polymer relaxation time, $\\eta_p$ the polymer viscosity, $\\stackrel{\\triangledown}{\\boldsymbol{\\tau}}$ the upper-convected derivative of $\\boldsymbol{\\tau}$, and $\\mathbf{D}$ the rate-of-deformation tensor. Upon nondimensionalization with a characteristic velocity $U$ and length $L$, the Weissenberg number (Wi) is defined as $\\mathrm{Wi} = \\lambda U / L$. At high $\\mathrm{Wi}$, the convective transport of stress dominates relaxation near solid boundaries, leading to thin boundary layers for stress. A simplified, physically consistent surrogate for the wall-normal variation of the dominant shear stress component $ \\tau(y; \\mathrm{Wi}) $ in a symmetric channel is specified as\n$$\n\\tau(y; \\mathrm{Wi}) = 1 - \\tfrac{1}{2}\\left( e^{-y/\\delta(\\mathrm{Wi})} + e^{-(1-y)/\\delta(\\mathrm{Wi})} \\right),\n$$\nwhere the boundary-layer thickness scales as\n$$\n\\delta(\\mathrm{Wi}) = \\frac{1}{1+\\mathrm{Wi}}.\n$$\nThis surrogate captures the amplification of stress gradients near $y=0$ and $y=1$ as $\\mathrm{Wi}$ increases.\n\nYou must construct an a posteriori error estimator based solely on the magnitude of the stress gradient in a piecewise-linear approximation and use it to drive adaptive mesh refinement in one dimension. Let a current mesh be defined by nodes $\\{y_0, y_1, \\dots, y_N\\}$ with $y_0=0$, $y_N=1$, and element sizes $h_i = y_{i+1}-y_i$ for $i=0,\\dots,N-1$. Define the piecewise-linear approximation $\\tau_h$ by sampling $\\tau$ at the nodes and linearly interpolating on each element. The elemental slope is\n$$\ns_i = \\frac{\\tau(y_{i+1}; \\mathrm{Wi}) - \\tau(y_i; \\mathrm{Wi})}{h_i}, \\quad i=0,\\dots,N-1.\n$$\nDefine node-based gradient jumps as\n$$\nJ_0 = s_0, \\quad J_j = s_j - s_{j-1} \\ \\text{for}\\ j=1,\\dots,N-1, \\quad J_N = s_{N-1}.\n$$\nDefine effective local sizes at nodes as\n$$\nh^{\\mathrm{eff}}_0 = h_0, \\quad h^{\\mathrm{eff}}_j = \\tfrac{1}{2}(h_{j-1}+h_j) \\ \\text{for}\\ j=1,\\dots,N-1, \\quad h^{\\mathrm{eff}}_N = h_{N-1}.\n$$\nThe node indicator is\n$$\n\\eta^{\\mathrm{node}}_j = \\sqrt{h^{\\mathrm{eff}}_j}\\, |J_j|, \\quad j=0,\\dots,N.\n$$\nAssociate to each element $i$ an elemental indicator\n$$\n\\eta_i = \\tfrac{1}{2}\\left(\\eta^{\\mathrm{node}}_i + \\eta^{\\mathrm{node}}_{i+1}\\right), \\quad i=0,\\dots,N-1,\n$$\nand define the global estimator\n$$\nE = \\sum_{i=0}^{N-1} \\eta_i.\n$$\nUse the following adaptive refinement strategy:\n- Start from a uniform mesh with $N_0$ elements.\n- On each iteration, compute $\\eta_i$, find $\\eta_{\\max} = \\max_i \\eta_i$, and mark all elements with $\\eta_i \\ge \\theta \\, \\eta_{\\max}$, where $\\theta \\in (0,1]$ is a user parameter.\n- Refine marked elements by bisection (insert the midpoint), leaving others unchanged.\n- Stop when $E \\le \\text{tol}$ or when a prescribed maximum number of iterations is reached.\n\nYour program must implement this adaptive loop for the test suite below and, for each test case, return the tuple $[N, E, h_{\\min}, R]$ where $N$ is the final number of elements, $E$ is the final global estimator, $h_{\\min}$ is the smallest element size, and $R = \\delta(\\mathrm{Wi})/h_{\\min}$ is the resolution ratio quantifying how well the boundary layer thickness is resolved. All quantities are dimensionless; therefore, express all outputs as dimensionless numbers. Angles are not involved. No percentages are required.\n\nTest suite:\n- Case $1$: $\\mathrm{Wi} = 10$, $\\text{tol} = 0.01$, $\\theta = 0.5$, $N_0 = 8$, $\\text{max\\_iter} = 12$.\n- Case $2$: $\\mathrm{Wi} = 0.1$, $\\text{tol} = 0.0001$, $\\theta = 0.5$, $N_0 = 8$, $\\text{max\\_iter} = 12$.\n- Case $3$: $\\mathrm{Wi} = 50$, $\\text{tol} = 0.02$, $\\theta = 0.6$, $N_0 = 8$, $\\text{max\\_iter} = 12$.\n- Case $4$: $\\mathrm{Wi} = 200$, $\\text{tol} = 0.03$, $\\theta = 0.7$, $N_0 = 8$, $\\text{max\\_iter} = 14$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is a sub-list in the order $[N,E,h_{\\min},R]$. For example, an output with two cases would look like $[[N_1,E_1,h_{\\min,1},R_1],[N_2,E_2,h_{\\min,2},R_2]]$.",
            "solution": "The problem statement has been critically examined and is determined to be valid. It is scientifically grounded in the fields of computational fluid dynamics and numerical analysis, algorithmically well-posed, and expressed with objective, unambiguous language. All necessary data and definitions for a unique, verifiable solution are provided.\n\nThe problem requires the implementation of an a posteriori error-driven adaptive mesh refinement (AMR) algorithm for a one-dimensional surrogate problem. This surrogate, defined by the function $\\tau(y; \\mathrm{Wi})$, models the shear stress profile in a viscoelastic channel flow at a given Weissenberg number $\\mathrm{Wi}$. The physics of such flows at high $\\mathrm{Wi}$ is characterized by the formation of very thin stress boundary layers near solid walls. The surrogate model captures this phenomenon through the boundary-layer thickness $\\delta(\\mathrm{Wi}) = (1+\\mathrm{Wi})^{-1}$, which decreases as $\\mathrm{Wi}$ increases. Efficiently resolving these thin layers without over-refining the entire domain is a canonical challenge in computational complex fluids, making AMR an indispensable tool.\n\nThe prescribed AMR algorithm is based on a residual-type a posteriori error estimator. The core idea is to estimate the error in a piecewise-linear approximation $\\tau_h$ of the true solution $\\tau$ and use this estimate to guide mesh refinement. The error is localized by computing indicators for each element, and elements with the largest indicators are refined.\n\nThe algorithm proceeds as follows:\n\n1.  **Solution Approximation and Error Indication**: On a given mesh $\\{y_0, y_1, \\dots, y_N\\}$, the function $\\tau(y; \\mathrm{Wi})$ is approximated by a continuous, piecewise-linear function $\\tau_h$. The quality of this approximation is assessed locally. The elemental slope $s_i = (\\tau(y_{i+1}) - \\tau(y_i))/h_i$ represents the constant gradient of $\\tau_h$ on element $i$. The jump in this gradient at an interior node $y_j$, $J_j = s_j - s_{j-1}$, approximates the second derivative $\\tau''(y_j)$ scaled by a local mesh size. For a smooth function, the local interpolation error is proportional to the second derivative and the square of the element size. The defined node indicator $\\eta^{\\mathrm{node}}_j = \\sqrt{h^{\\mathrm{eff}}_j}\\, |J_j|$ is a standard construction in finite element analysis that provides a computable estimate of the local error. At the boundaries ($j=0$ and $j=N$), the jumps are defined as $J_0 = s_0$ and $J_N = s_{N-1}$, which is a common way to handle boundary terms in such estimators.\n\n2.  **Elemental and Global Estimators**: The node-based indicators are averaged to produce an indicator $\\eta_i = \\tfrac{1}{2}(\\eta^{\\mathrm{node}}_i + \\eta^{\\mathrm{node}}_{i+1})$ for each element $i$. This associates a local error measure to each mesh element. The sum of these elemental indicators, $E = \\sum_{i=0}^{N-1} \\eta_i$, serves as a global error estimator.\n\n3.  **Adaptive Refinement Strategy**: The refinement follows a standard loop (often termed `SOLVE - ESTIMATE - MARK - REFINE`):\n    *   An initial uniform mesh with $N_0$ elements is generated.\n    *   In each iteration, the elemental indicators $\\eta_i$ are computed for the current mesh.\n    *   A Dörfler marking strategy is employed: all elements $i$ for which the indicator $\\eta_i$ is a significant fraction of the maximum indicator, i.e., $\\eta_i \\ge \\theta \\, \\eta_{\\max}$, are marked for refinement. The parameter $\\theta \\in (0,1]$ controls how aggressively the algorithm refines.\n    *   Marked elements are bisected by inserting a new node at their midpoint. This generates a new, locally finer mesh.\n    *   The loop terminates when the global error estimator $E$ falls below a specified tolerance `tol`, or a maximum number of iterations `max_iter` is reached.\n\n4.  **Implementation and Output**: The procedure is implemented for each test case. Starting with the initial mesh, the adaptive loop is executed until a termination condition is met. Upon termination, the final state of the mesh and the simulation is reported. This includes the final number of elements $N$, the final global error estimate $E$, the minimum element size $h_{\\min}$, and the resolution ratio $R = \\delta(\\mathrm{Wi})/h_{\\min}$. The ratio $R$ is a crucial metric, as it quantifies how many elements are placed across the characteristic thickness of the boundary layer, indicating the quality of its resolution. For $R \\gg 1$, the boundary layer is well-resolved.\n\nThe implementation will consist of a main function that iterates through the provided test suite. For each case, an adaptive loop will be executed, which involves defining the mesh, calculating the series of indicators ($\\tau_j, s_i, J_j, \\eta^{\\mathrm{node}}_j, \\eta_i, E$), marking elements based on the $\\theta$ criterion, and refining the mesh by bisection. The process is repeated until the stopping criteria are met, at which point the final metrics are computed and stored.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the adaptive mesh refinement problem.\n    \"\"\"\n\n    test_cases = [\n        {'Wi': 10.0, 'tol': 0.01, 'theta': 0.5, 'N0': 8, 'max_iter': 12},\n        {'Wi': 0.1, 'tol': 0.0001, 'theta': 0.5, 'N0': 8, 'max_iter': 12},\n        {'Wi': 50.0, 'tol': 0.02, 'theta': 0.6, 'N0': 8, 'max_iter': 12},\n        {'Wi': 200.0, 'tol': 0.03, 'theta': 0.7, 'N0': 8, 'max_iter': 14},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_adaptive_loop(**case)\n        results.append(result)\n\n    # Format the results into the required string list-of-lists format\n    formatted_results = [f\"[{res[0]},{res[1]},{res[2]},{res[3]}]\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef tau(y, Wi):\n    \"\"\"\n    Calculates the surrogate stress profile tau(y; Wi).\n    \"\"\"\n    delta = 1.0 / (1.0 + Wi)\n    # To prevent overflow with large -y/delta, esp. y=1 near delta=0\n    # exp(-(1-y)/delta) is safe since y is in [0,1].\n    # exp(-y/delta) might be very small, but shouldn't overflow.\n    return 1.0 - 0.5 * (np.exp(-y / delta) + np.exp(-(1.0 - y) / delta))\n\ndef run_adaptive_loop(Wi, tol, theta, N0, max_iter):\n    \"\"\"\n    Executes the adaptive mesh refinement loop for a single test case.\n    \"\"\"\n    # Initial uniform mesh\n    nodes = np.linspace(0.0, 1.0, N0 + 1)\n    delta = 1.0 / (1.0 + Wi)\n\n    final_N = 0\n    final_E = 0.0\n\n    for _ in range(max_iter):\n        # --- ESTIMATE ---\n        N = len(nodes) - 1\n        h = np.diff(nodes)\n        \n        tau_at_nodes = tau(nodes, Wi)\n        s = np.diff(tau_at_nodes) / h\n\n        J = np.zeros(N + 1)\n        J[0] = s[0]\n        if N > 1:\n            J[1:N] = s[1:] - s[:-1]\n        J[N] = s[-1]\n\n        h_eff = np.zeros(N + 1)\n        h_eff[0] = h[0]\n        if N > 1:\n            h_eff[1:N] = 0.5 * (h[:-1] + h[1:])\n        h_eff[N] = h[-1]\n\n        eta_node = np.sqrt(h_eff) * np.abs(J)\n        eta_element = 0.5 * (eta_node[:-1] + eta_node[1:])\n        E = np.sum(eta_element)\n\n        final_N = N\n        final_E = E\n\n        # --- Check stopping condition ---\n        if E = tol:\n            break\n            \n        # --- MARK ---\n        eta_max = np.max(eta_element)\n        if eta_max == 0: # If error is identically zero, stop.\n            break\n\n        # A small tolerance is used in comparison to avoid floating point artifacts.\n        marked_indices = np.where(eta_element >= theta * eta_max - 1e-15)[0]\n\n        if len(marked_indices) == 0:\n            # This can happen if, e.g., theta is slightly > 1 due to fp error. Stop.\n            break\n\n        # --- REFINE ---\n        midpoints_to_add = (nodes[marked_indices] + nodes[marked_indices + 1]) / 2.0\n        nodes = np.unique(np.concatenate([nodes, midpoints_to_add]))\n    else:\n        # This block executes if the loop completes (max_iter reached).\n        # We must recalculate metrics for the final mesh.\n        N = len(nodes) - 1\n        h = np.diff(nodes)\n        tau_at_nodes = tau(nodes, Wi)\n        s = np.diff(tau_at_nodes) / h\n        J = np.zeros(N + 1)\n        J[0] = s[0]\n        if N > 1: J[1:N] = s[1:] - s[:-1]\n        J[N] = s[-1]\n        h_eff = np.zeros(N + 1)\n        h_eff[0] = h[0]\n        if N > 1: h_eff[1:N] = 0.5 * (h[:-1] + h[1:])\n        h_eff[N] = h[-1]\n        eta_node = np.sqrt(h_eff) * np.abs(J)\n        eta_element = 0.5 * (eta_node[:-1] + eta_node[1:])\n        E = np.sum(eta_element)\n        final_N = N\n        final_E = E\n        \n    # After loop termination, calculate final output quantities\n    h_final = np.diff(nodes)\n    h_min = np.min(h_final) if len(h_final) > 0 else 1.0\n    R = delta / h_min\n    \n    return [final_N, final_E, h_min, R]\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}