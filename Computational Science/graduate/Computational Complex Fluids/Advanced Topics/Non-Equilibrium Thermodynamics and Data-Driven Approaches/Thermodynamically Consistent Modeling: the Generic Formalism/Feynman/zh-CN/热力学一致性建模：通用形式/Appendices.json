{
    "hands_on_practices": [
        {
            "introduction": "任何一个有效的非平衡理论，其关键的考验在于它能否准确地描述和再现热力学平衡态。本练习旨在通过一个具体的例子来巩固您对这一基本原则的理解。您将首先运用变分法，通过最小化系统的亥姆霍兹自由能 $F = E - TS$ 来确定一个标量场序参量的平衡构型 。随后，您需要证明这个通过热力学原理得到的平衡态，在GENERIC动力学演化方程下确实是一个定常解，即其时间导数为零。这个练习将帮助您深刻理解平衡态统计力学与GENERIC非平衡动力学框架之间的内在一致性。",
            "id": "4109694",
            "problem": "考虑一个标量序参量场 $\\psi(\\mathbf{x})$，它代表了在周期性域 $\\Omega \\subset \\mathbb{R}^{d}$ 上具有足够光滑场的二元复杂流体的粗粒化组分涨落。在恒定绝对温度 $T>0$ 下进行研究。设能量泛函 $E[\\psi]$ 和熵泛函 $S[\\psi]$ 由下式给出\n$$\nE[\\psi] \\equiv \\int_{\\Omega} \\left( \\frac{a}{2}\\,\\psi^{2} + \\frac{\\kappa}{2}\\,|\\nabla \\psi|^{2} \\right)\\, \\mathrm{d}\\mathbf{x}, \\qquad\nS[\\psi] \\equiv \\int_{\\Omega} \\left( s_{0} - \\frac{b}{2}\\,\\psi^{2} - \\frac{c}{4}\\,\\psi^{4} \\right)\\, \\mathrm{d}\\mathbf{x},\n$$\n其中 $a>0$, $\\kappa>0$, $b>0$, $c>0$，且 $s_{0}$ 是一个常数（不影响最小化过程）。亥姆霍兹自由能泛函为 $F[\\psi] \\equiv E[\\psi] - T\\,S[\\psi]$。\n\n从变分法的第一性原理（在 $\\Omega$ 上采用周期性边界条件）以及非平衡可逆-不可逆耦合普适方程（GENERIC）的热力学结构出发。在 GENERIC 框架中，粗粒化状态变量 $\\psi$ 的演化形式为\n$$\n\\dot{\\psi} = L(\\psi)\\,\\frac{\\delta E}{\\delta \\psi} + M(\\psi)\\,\\frac{\\delta S}{\\delta \\psi},\n$$\n其中 $L(\\psi)$ 是一个反对称算子（产生可逆动力学），$M(\\psi)$ 是一个对称半正定算子（产生耗散动力学），并满足简并条件 $L(\\psi)\\,\\frac{\\delta S}{\\delta \\psi} = 0$ 和 $M(\\psi)\\,\\frac{\\delta E}{\\delta \\psi} = 0$。\n\n任务：\n- 推导与在周期性 $\\psi$ 上最小化 $F[\\psi]$ 相关联的欧拉-拉格朗日方程，并利用该方程以及给定的 $a, \\kappa, b, c$ 的符号条件，确定使 $F[\\psi]$ 最小化的平衡场 $\\psi_{\\mathrm{eq}}(\\mathbf{x})$。\n- 仅使用上述 GENERIC 结构和简并条件，验证您找到的 $\\psi_{\\mathrm{eq}}(\\mathbf{x})$ 是在恒定温度 $T$ 下 GENERIC 演化方程的稳态解。\n\n将平衡场 $\\psi_{\\mathrm{eq}}(\\mathbf{x})$ 的最终答案表示为关于参数 $a, b, c, \\kappa, T$ 的单个闭式解析表达式。无需进行数值计算或四舍五入。最终答案必须是单个解析表达式。",
            "solution": "根据题目要求，分析包括两个部分。首先，我们通过最小化亥姆霍兹自由能泛函 $F[\\psi]$ 来确定平衡场 $\\psi_{\\mathrm{eq}}(\\mathbf{x})$。其次，我们验证该平衡场是给定的 GENERIC 演化方程的一个稳态解。\n\n**第1部分：亥姆霍兹自由能的最小化**\n\n亥姆霍兹自由能泛函 $F[\\psi]$ 定义为 $F[\\psi] \\equiv E[\\psi] - T\\,S[\\psi]$。代入给定的能量 $E[\\psi]$ 和熵 $S[\\psi]$ 的表达式：\n$$\nF[\\psi] = \\int_{\\Omega} \\left( \\frac{a}{2}\\,\\psi^{2} + \\frac{\\kappa}{2}\\,|\\nabla \\psi|^{2} \\right)\\, \\mathrm{d}\\mathbf{x} - T \\int_{\\Omega} \\left( s_{0} - \\frac{b}{2}\\,\\psi^{2} - \\frac{c}{4}\\,\\psi^{4} \\right)\\, \\mathrm{d}\\mathbf{x}\n$$\n合并积分项，我们得到：\n$$\nF[\\psi] = \\int_{\\Omega} \\left( \\left(\\frac{a + Tb}{2}\\right)\\psi^{2} + \\frac{Tc}{4}\\,\\psi^{4} + \\frac{\\kappa}{2}\\,|\\nabla \\psi|^{2} - T s_{0} \\right) \\mathrm{d}\\mathbf{x}\n$$\n为了最小化 $F[\\psi]$，我们考察被积函数（自由能密度）。它由三部分组成：\n1.  与 $\\psi$ 相关的势能项：$\\left(\\frac{a + Tb}{2}\\right)\\psi^{2} + \\frac{Tc}{4}\\,\\psi^{4}$。\n2.  与梯度相关的项：$\\frac{\\kappa}{2}\\,|\\nabla \\psi|^{2}$。\n3.  一个常数项 $-T s_{0}$。\n\n根据题目给出的条件，$a>0, b>0, c>0, \\kappa>0$ 且 $T>0$。\n- 对于梯度项，由于 $\\kappa>0$ 且 $|\\nabla \\psi|^2 \\ge 0$，该项始终为非负。当 $\\psi$ 是一个空间均匀场（即 $\\nabla \\psi = 0$）时，该项达到其最小值0。\n- 对于势能项，系数 $\\frac{a+Tb}{2}$ 和 $\\frac{Tc}{4}$ 均为正。因此，该势能是一个以 $\\psi=0$ 为唯一最小值的凸函数。\n\n由于梯度项和势能项都是在 $\\psi(\\mathbf{x}) = 0$ 时同时达到其全局最小值0，所以整个自由能泛函 $F[\\psi]$ 的全局最小值在空间均匀场 $\\psi_{\\mathrm{eq}}(\\mathbf{x}) = 0$ 处取得。\n\n**第2部分：验证其作为 GENERIC 的稳态解**\n\n我们需要验证 $\\psi_{\\mathrm{eq}}(\\mathbf{x}) = 0$ 是 GENERIC 演化方程的一个稳态解，即当 $\\psi=\\psi_{\\mathrm{eq}}$ 时 $\\dot{\\psi}=0$。\n热力学平衡态 $\\psi_{\\mathrm{eq}}$ 的定义是使亥姆霍兹自由能 $F[\\psi]$ 最小化的状态。从变分法可知，这等价于 $F$ 的泛函导数在平衡态处为零：\n$$\n\\frac{\\delta F}{\\delta \\psi}\\bigg|_{\\psi=\\psi_{\\mathrm{eq}}} = 0\n$$\n利用 $F = E - TS$，我们得到：\n$$\n\\frac{\\delta E}{\\delta \\psi}\\bigg|_{\\psi=\\psi_{\\mathrm{eq}}} - T \\frac{\\delta S}{\\delta \\psi}\\bigg|_{\\psi=\\psi_{\\mathrm{eq}}} = 0\n$$\n这给出了平衡时的基本关系：\n$$\n\\frac{\\delta E}{\\delta \\psi}\\bigg|_{\\psi=\\psi_{\\mathrm{eq}}} = T \\frac{\\delta S}{\\delta \\psi}\\bigg|_{\\psi=\\psi_{\\mathrm{eq}}}\n$$\n现在，我们将此关系代入 GENERIC 方程并在 $\\psi=\\psi_{\\mathrm{eq}}$ 处求值：\n$$\n\\dot{\\psi}|_{\\psi=\\psi_{\\mathrm{eq}}} = L(\\psi_{\\mathrm{eq}})\\,\\frac{\\delta E}{\\delta \\psi}\\bigg|_{\\psi_{\\mathrm{eq}}} + M(\\psi_{\\mathrm{eq}})\\,\\frac{\\delta S}{\\delta \\psi}\\bigg|_{\\psi_{\\mathrm{eq}}}\n$$\n我们分别考察右侧的两项：\n- **可逆项**：使用平衡关系，我们有 $L(\\psi_{\\mathrm{eq}})\\,\\frac{\\delta E}{\\delta \\psi}|_{\\psi_{\\mathrm{eq}}} = L(\\psi_{\\mathrm{eq}})\\,\\left(T \\frac{\\delta S}{\\delta \\psi}|_{\\psi_{\\mathrm{eq}}}\\right) = T \\left(L(\\psi_{\\mathrm{eq}})\\,\\frac{\\delta S}{\\delta \\psi}|_{\\psi_{\\mathrm{eq}}}\\right)$。根据第一个简并条件 $L(\\psi)\\,\\frac{\\delta S}{\\delta \\psi} = 0$，这一项等于零。\n- **不可逆项**：我们有 $M(\\psi_{\\mathrm{eq}})\\,\\frac{\\delta S}{\\delta \\psi}|_{\\psi_{\\mathrm{eq}}}$。使用第二个简并条件 $M(\\psi)\\,\\frac{\\delta E}{\\delta \\psi} = 0$，并在平衡时利用平衡关系，我们得到 $M(\\psi_{\\mathrm{eq}})\\,\\frac{\\delta E}{\\delta \\psi}|_{\\psi_{\\mathrm{eq}}} = M(\\psi_{\\mathrm{eq}})\\,\\left(T \\frac{\\delta S}{\\delta \\psi}|_{\\psi_{\\mathrm{eq}}}\\right) = 0$。由于 $T>0$，这必然意味着 $M(\\psi_{\\mathrm{eq}})\\,\\frac{\\delta S}{\\delta \\psi}|_{\\psi_{\\mathrm{eq}}} = 0$。\n\n由于可逆和不可逆两部分在平衡态 $\\psi_{\\mathrm{eq}}$ 处都为零，它们的和也为零：\n$$\n\\dot{\\psi}|_{\\psi=\\psi_{\\mathrm{eq}}} = 0 + 0 = 0\n$$\n这证实了由自由能最小化所确定的平衡态确实是 GENERIC 演化方程的一个稳态解。我们找到的唯一全局最小化子是 $\\psi_{\\mathrm{eq}}(\\mathbf{x}) = 0$。",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "将连续的场论模型转化为可在计算机上求解的离散形式，是计算复杂流体领域的基石。然而，对于GENERIC系统而言，简单的数值近似是远远不够的；离散化方案必须保持其内在的几何结构。本练习将指导您如何为一个一维周期性复杂流体模型构建结构保持的空间离散算子 。您需要设计的离散算子 $\\mathbf{L}_h$ 必须是反对称的，以反映可逆动力学的守恒特性，而离散算子 $\\mathbf{M}_h$ 则必须是对称且半正定的，以保证不可逆过程的耗散特性和熵增原理。掌握这种结构保持的离散化方法，是进行任何热力学一致性模拟的前提和核心技能。",
            "id": "4109668",
            "problem": "您的任务是在非平衡可逆-不可逆耦合通用方程（GENERIC）形式体系内，为一维周期性复杂流体模型设计并实现一种空间离散化方法。GENERIC 结构通过以下方程演化状态向量 $\\mathbf{z}$：\n$$\n\\dot{\\mathbf{z}} \\;=\\; \\mathbf{L}(\\mathbf{z}) \\,\\nabla_{\\mathbf{z}} E(\\mathbf{z}) \\;+\\; \\mathbf{M}(\\mathbf{z}) \\,\\nabla_{\\mathbf{z}} S(\\mathbf{z}),\n$$\n其中 $\\mathbf{L}$ 是反对称的，$\\mathbf{M}$ 是对称半正定的，并且满足简并条件 $\\mathbf{L}\\,\\nabla_{\\mathbf{z}} S \\,=\\, \\mathbf{0}$ 和 $\\mathbf{M}\\,\\nabla_{\\mathbf{z}} E \\,=\\, \\mathbf{0}$。在此任务中，考虑一个定义在长度为 $L_{\\text{dom}}$ 的周期性域上的单标量场 $\\phi(x,t)$，其输运参数为常数：平流速度 $u$ 和迁移率 $\\kappa \\ge 0$。您的目标是在一个包含 $N$ 个点的均匀网格上构造离散算子 $\\mathbf{L}_h$ 和 $\\mathbf{M}_h$，这些算子需体现与 GENERIC 一致的可逆和不可逆耦合，具体通过强制执行以下属性实现：\n\n- 反对称性：$\\mathbf{L}_h^\\top \\,=\\, -\\,\\mathbf{L}_h$。\n- 对称性与半正定性：$\\mathbf{M}_h^\\top \\,=\\, \\mathbf{M}_h$ 且对于所有向量 $\\mathbf{v}$，$\\mathbf{v}^\\top \\mathbf{M}_h \\mathbf{v} \\,\\ge\\, 0$。\n\n从以下基本依据和约束条件出发：\n- 在一个间距为 $h \\,=\\, L_{\\text{dom}}/N$ 的均匀网格上，使用周期性分部积分恒等式的离散模拟（离散分部求和），来指导相容的一阶和二阶导数算子的构建。\n- 可逆（类哈密顿）的平流部分必须由一个离散一阶导数算子表示，该算子在标准欧几里得内积下是斜伴随的，从而使得其关联矩阵是反对称的。\n- 不可逆（耗散）的扩散部分必须由一个离散二阶导数算子表示，该算子是自伴且负半定的；将其乘以一个非负的迁移率会得到一个对称半正定的度量算子。\n\n在纯数学层面上设计离散化方法：\n- 选择一个具有 $N$ 个点和间距 $h$ 的周期性均匀网格，并构造：\n  - 一个矩阵 $\\mathbf{D}_1$，用于近似空间一阶导数，并满足 $\\mathbf{D}_1^\\top \\,=\\, -\\,\\mathbf{D}_1$。\n  - 一个矩阵 $\\mathbf{D}_2$，用于近似空间二阶导数，并满足 $\\mathbf{D}_2^\\top \\,=\\, \\mathbf{D}_2$ 且具有非正特征值。\n- 通过将一阶导数算子乘以平流速度 $u$ 来定义 $\\mathbf{L}_h$，并通过将二阶导数算子的负值乘以迁移率 $\\kappa$ 来定义 $\\mathbf{M}_h$：\n  $$\n  \\mathbf{L}_h \\,=\\, u\\,\\mathbf{D}_1,\\qquad \\mathbf{M}_h \\,=\\, \\kappa\\,\\left(-\\mathbf{D}_2\\right).\n  $$\n- 对于每个测试用例，数值验证：\n  $$\n  \\|\\mathbf{L}_h + \\mathbf{L}_h^\\top\\|_F \\,\\le\\, \\varepsilon \\,\\max\\{1,\\|\\mathbf{L}_h\\|_F\\},\\qquad\n  \\|\\mathbf{M}_h - \\mathbf{M}_h^\\top\\|_F \\,\\le\\, \\varepsilon \\,\\max\\{1,\\|\\mathbf{M}_h\\|_F\\},\n  $$\n  并且对于一个容差 $\\varepsilon$，对称化度量 $\\tfrac{1}{2}(\\mathbf{M}_h+\\mathbf{M}_h^\\top)$ 的最小特征值大于或等于 $-\\,\\varepsilon$。\n\n实现要求：\n- 在长度为 $L_{\\text{dom}} \\,=\\, 1$ 的域上使用一个包含 $N$ 个点的 一维周期性网格，间距为 $h \\,=\\, 1/N$。\n- 构造 $\\mathbf{D}_1$ 和 $\\mathbf{D}_2$，使它们对于任何 $N \\ge 3$ 都满足上述结构属性。构造必须与周期性网格上的离散分部求和相一致。\n- 根据给定的 $u$ 和 $\\kappa$ 设置反对称的 GENERIC 算子 $\\mathbf{L}_h$ 和对称半正定的 GENERIC 算子 $\\mathbf{M}_h$。\n- 对于每个测试用例，返回一个布尔值，指示所有三个检查是否通过：$\\mathbf{L}_h$ 的反对称性、$\\mathbf{M}_h$ 的对称性以及 $\\mathbf{M}_h$ 的半正定性。\n\n测试套件：\n- 使用容差 $\\varepsilon \\,=\\, 10^{-12}$。\n- 域长度 $L_{\\text{dom}} \\,=\\, 1$。\n- 测试用例是元组 $(N, u, \\kappa)$：\n  - 案例 A：$(N, u, \\kappa) \\,=\\, (\\,3,\\, 1.7,\\, 0.0\\,)$。\n  - 案例 B：$(N, u, \\kappa) \\,=\\, (\\,4,\\, 0.0,\\, 1.0\\,)$。\n  - 案例 C：$(N, u, \\kappa) \\,=\\, (\\,7,\\, -2.0,\\, 0.5\\,)$。\n  - 案例 D：$(N, u, \\kappa) \\,=\\, (\\,16,\\, 3.3,\\, 10^{-3}\\,)$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按测试套件案例 A、B、C、D 的顺序列出结果。每个条目必须是一个布尔值，指示该案例是否满足三个所需属性，例如：\"[True,False,True,True]\"。",
            "solution": "问题陈述是有效的。它提出了一个在复杂流体计算热力学领域内定义明确且具有科学依据的任务。其目标是为一个由非平衡可逆-不可逆耦合通用方程（GENERIC）描述的一维系统设计并实现一种保结构空间离散化。这需要构造离散算子，以保持连续模型的基本几何性质——即可逆算子 $\\mathbf{L}_h$ 的反对称性和不可逆算子 $\\mathbf{M}_h$ 的对称半正定性。\n\n这些表示为 $\\mathbf{L}_h$ 和 $\\mathbf{M}_h$ 的离散算子的设计，是基于周期性均匀网格上的离散分部求和原理。该原理作为分部积分的离散模拟，确保了最终的数值格式能遵守连续理论底层的守恒律和耗散律。我们考虑一个标量场 $\\phi(x,t)$，它在一个具有 $N$ 个点 $\\{x_i = i h\\}_{i=0}^{N-1}$ 和均匀间距 $h = L_{\\text{dom}}/N$ 的网格上被离散化。该场由一个向量 $\\boldsymbol{\\phi} \\in \\mathbb{R}^N$ 表示，其中 $(\\boldsymbol{\\phi})_i = \\phi(x_i)$。\n\n首先，我们构造离散一阶导数算子 $\\mathbf{D}_1$，它构成了可逆部分的基础。连续的一阶导数算子 $\\partial_x$ 在周期性域上关于 $L^2$ 内积是斜伴随的。因此，其离散对应物 $\\mathbf{D}_1$ 必须是一个反对称矩阵，即 $\\mathbf{D}_1^\\top = -\\mathbf{D}_1$。标准的二阶中心差分格式在周期性边界条件下满足此要求。该算子作用于离散场 $\\boldsymbol{\\phi}$ 在网格点 $i$ 上的形式为：\n$$\n(\\mathbf{D}_1 \\boldsymbol{\\phi})_i = \\frac{\\phi_{i+1 \\pmod N} - \\phi_{i-1 \\pmod N}}{2h}\n$$\n由此产生的 $N \\times N$ 矩阵 $\\mathbf{D}_1$ 是一个循环矩阵，其主对角线为零，非对角线元素值为 $1/(2h)$ 和 $-1/(2h)$，正确地编码了周期性连接。其反对称性从其结构中显而易见。可逆 GENERIC 算子 $\\mathbf{L}_h$ 随后定义为：\n$$\n\\mathbf{L}_h = u\\,\\mathbf{D}_1\n$$\n由于 $u$ 是一个标量，$\\mathbf{D}_1$ 的反对称性直接被 $\\mathbf{L}_h$ 继承：\n$$\n\\mathbf{L}_h^\\top = (u\\,\\mathbf{D}_1)^\\top = u\\,\\mathbf{D}_1^\\top = u(-\\mathbf{D}_1) = -\\mathbf{L}_h\n$$\n\n接下来，我们构造离散二阶导数算子 $\\mathbf{D}_2$，它构成了不可逆部分的基础。连续的负拉普拉斯算子 $-\\partial_x^2$ 在周期性域上是一个对称、半正定算子，这是耗散算子所要求的属性。因此，我们寻求一个对称且负半定的离散算子 $\\mathbf{D}_2$。二阶导数的标准二阶中心差分近似为：\n$$\n(\\mathbf{D}_2 \\boldsymbol{\\phi})_i = \\frac{\\phi_{i+1 \\pmod N} - 2\\phi_i + \\phi_{i-1 \\pmod N}}{h^2}\n$$\n这定义了矩阵 $\\mathbf{D}_2$ 为周期性离散拉普拉斯算子，它是一个对称、循环的托普利茨矩阵。为验证其谱性质，我们可以解析地确定其特征值。这个特定循环矩阵的特征值是已知的：\n$$\n\\lambda_j(\\mathbf{D}_2) = \\frac{1}{h^2} \\left( e^{i 2\\pi j/N} - 2 + e^{-i 2\\pi j/N} \\right) = \\frac{2}{h^2} \\left( \\cos\\left(\\frac{2\\pi j}{N}\\right) - 1 \\right) = -\\frac{4}{h^2} \\sin^2\\left(\\frac{\\pi j}{N}\\right)\n$$\n对于 $j = 0, 1, \\dots, N-1$。由于 $\\sin^2(\\cdot) \\ge 0$，很明显所有特征值 $\\lambda_j(\\mathbf{D}_2)$ 都是非正的，这证实了 $\\mathbf{D}_2$ 是一个负半定矩阵。\n\n不可逆 GENERIC 算子 $\\mathbf{M}_h$ 是通过将 $\\mathbf{D}_2$ 的负值乘以非负迁移率 $\\kappa \\ge 0$ 来定义的：\n$$\n\\mathbf{M}_h = \\kappa(-\\mathbf{D}_2)\n$$\n$\\mathbf{D}_2$ 的对称性确保了 $\\mathbf{M}_h$ 也是对称的：$\\mathbf{M}_h^\\top = \\kappa(-\\mathbf{D}_2)^\\top = \\kappa(-\\mathbf{D}_2) = \\mathbf{M}_h$。$\\mathbf{M}_h$ 的特征值为 $\\lambda_j(\\mathbf{M}_h) = -\\kappa \\lambda_j(\\mathbf{D}_2) = \\frac{4\\kappa}{h^2} \\sin^2\\left(\\frac{\\pi j}{N}\\right)$。由于 $\\kappa \\ge 0$ 且 $h^2 > 0$，$\\mathbf{M}_h$ 的所有特征值都是非负的。这证实了 $\\mathbf{M}_h$ 是对称且半正定的。\n\n这种构造通过其解析设计保证了最终得到的离散算子 $\\mathbf{L}_h$ 和 $\\mathbf{M}_h$ 满足 GENERIC 形式体系的结构要求。所提供的实现会数值地构造这些矩阵，并验证这些属性在指定的浮点容差 $\\varepsilon = 10^{-12}$ 内成立。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef construct_and_verify(N, u, kappa, L_dom, eps):\n    \"\"\"\n    Constructs and verifies the GENERIC operators for a 1D periodic system.\n\n    Args:\n        N (int): Number of grid points.\n        u (float): Advection speed.\n        kappa (float): Mobility.\n        L_dom (float): Length of the periodic domain.\n        eps (float): Tolerance for numerical verification.\n\n    Returns:\n        bool: True if all properties are satisfied, False otherwise.\n    \"\"\"\n    if N  3:\n        # The central difference stencils require at least 3 points.\n        return False\n        \n    # 1. Construct discrete operators D1 and D2\n    h = L_dom / N\n    \n    # Use np.roll for an elegant construction on a periodic grid.\n    # E is the forward shift operator: (E @ f)_i = f_{i+1}\n    E = np.roll(np.identity(N), -1, axis=1)\n    # E_inv is the backward shift operator: (E_inv @ f)_i = f_{i-1}\n    E_inv = np.roll(np.identity(N), 1, axis=1)\n    \n    # Second-order central difference for the first derivative\n    # D1 ~ (f(x+h) - f(x-h)) / 2h\n    D1 = (E - E_inv) / (2.0 * h)\n    \n    # Second-order central difference for the second derivative\n    # D2 ~ (f(x+h) - 2f(x) + f(x-h)) / h^2\n    D2 = (E - 2.0 * np.identity(N) + E_inv) / (h**2)\n    \n    # 2. Define GENERIC operators L_h and M_h\n    L_h = u * D1\n    M_h = kappa * (-D2)\n    \n    # 3. Verify the required properties\n    \n    # Check 1: Antisymmetry of L_h\n    # ||L_h + L_h^T||_F = eps * max(1, ||L_h||_F)\n    norm_L = np.linalg.norm(L_h, 'fro')\n    err_L = np.linalg.norm(L_h + L_h.T, 'fro')\n    check_L = err_L = eps * max(1.0, norm_L)\n    \n    # Check 2: Symmetry of M_h\n    # ||M_h - M_h^T||_F = eps * max(1, ||M_h||_F)\n    norm_M = np.linalg.norm(M_h, 'fro')\n    err_M = np.linalg.norm(M_h - M_h.T, 'fro')\n    check_M_sym = err_M = eps * max(1.0, norm_M)\n    \n    # Check 3: Positive Semidefiniteness of M_h\n    # min_eigenvalue(0.5*(M_h + M_h^T)) >= -eps\n    # The symmetrization step ensures the matrix is Hermitian for the eigenvalue solver,\n    # robustly handling any minor floating-point asymmetries.\n    M_h_symmetrized = 0.5 * (M_h + M_h.T)\n    \n    # Handle the trivial case of a zero matrix separately for robustness.\n    if np.allclose(M_h_symmetrized, 0, atol=eps):\n        min_eig = 0.0\n    else:\n        # Use np.linalg.eigvalsh for real symmetric (Hermitian) matrices.\n        # It is faster and more numerically stable than np.linalg.eigvals.\n        eigenvalues = np.linalg.eigvalsh(M_h_symmetrized)\n        min_eig = np.min(eigenvalues)\n        \n    check_M_psd = min_eig >= -eps\n    \n    return check_L and check_M_sym and check_M_psd\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, u, kappa)\n        (3, 1.7, 0.0),    # Case A\n        (4, 0.0, 1.0),    # Case B\n        (7, -2.0, 0.5),   # Case C\n        (16, 3.3, 1e-3),  # Case D (10^{-3} = 0.001)\n    ]\n    \n    # Parameters defined in the problem\n    L_dom = 1.0\n    eps = 1e-12\n    \n    results = []\n    for case in test_cases:\n        N, u, kappa = case\n        is_valid = construct_and_verify(N, u, kappa, L_dom, eps)\n        results.append(is_valid)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\n# Execute the solution\nsolve()\n```"
        },
        {
            "introduction": "在完成空间离散化之后，我们得到一个常微分方程(ODE)组，下一步便是对其进行时间积分。本练习将向您介绍一种在求解GENERIC系统时极为常用且功能强大的方法——分裂步长积分法 。通过在一个时间步内分别求解由算子 $L$ 控制的可逆（能量守恒）动力学和由算子 $M$ 控制的不可逆（熵产生）动力学，该方法可以在算法层面自然地满足热力学第一和第二定律。这个练习不仅是一个编程任务，更重要的是，它揭示了如何构建在离散层面依然能严格遵守物理定律的数值积分器，从而保证模拟结果的热力学一致性。",
            "id": "4109658",
            "problem": "你的任务是为一个有限维模型实现一个分裂步长积分器，该模型受到计算复杂流体领域中非平衡可逆-不可逆耦合通用方程 (GENERIC) 形式主义的启发。在 GENERIC 框架中，状态变量为 $z \\in \\mathbb{R}^n$，其演化由以下方程给出\n$$\n\\frac{dz}{dt} = L(z) \\nabla E(z) + M(z) \\nabla S(z),\n$$\n其中 $E(z)$ 是能量，$S(z)$ 是熵，$L(z)$ 是反对称的泊松算子（可逆的，哈密顿流），而 $M(z)$ 是对称半正定的耗散算子（不可逆的，梯度流）。简并条件为\n$$\nL(z) \\nabla S(z) = 0, \\quad M(z) \\nabla E(z) = 0,\n$$\n这意味着可逆部分保持熵守恒，而不可逆部分保持能量守恒。\n\n考虑三维状态 $z = (q,p,s)$，其中 $q$ 和 $p$ 是正则变量，而 $s$ 是一个表示与熵相关的变量的严格正标量。所有量均为无量纲量。能量和熵定义如下\n$$\nE(q,p,s) = \\frac{p^2}{2 m} + \\frac{k}{2} q^2, \\quad S(q,p,s) = c \\ln(s),\n$$\n其中参数 $m0$，$k0$，$c0$。定义泊松算子\n$$\nL = \\begin{pmatrix} 0  1  0 \\\\ -1  0  0 \\\\ 0  0  0 \\end{pmatrix},\n$$\n以及耗散算子\n$$\nM(z) = \\operatorname{diag}(0, 0, \\alpha s),\n$$\n其中 $\\alpha \\ge 0$。这些选择满足 GENERIC 的结构特性，包括 $L$ 的反对称性，$M$ 的对称性和半正定性，以及简并条件 $L \\nabla S = 0$ 和 $M \\nabla E = 0$。\n\n你的任务是构建一个分裂步长积分器，该积分器在总时间 $T$ 内使用固定的时间步长 $\\Delta t$，交替执行由 $L \\nabla E$ 生成的精确哈密顿子流和由 $M \\nabla S$ 生成的精确梯度子流。角度必须以弧度处理。哈密顿子流应使用二次哈密顿量 $E(q,p)$ 的精确流来演化 $(q,p)$，并保持 $s$ 不变。梯度子流应使用由 $M \\nabla S$ 导出的精确流来演化 $s$，并保持 $(q,p)$ 不变。从初始条件 $(q_0,p_0,s_0)$（其中 $s_00$）开始，执行 $N = T/\\Delta t$ 个连续的分裂步，假设 $T$ 是 $\\Delta t$ 的整数倍。\n\n积分后，计算能量的变化\n$$\n\\Delta E = E(q(T),p(T),s(T)) - E(q_0,p_0,s_0),\n$$\n和熵的变化\n$$\n\\Delta S = S(q(T),p(T),s(T)) - S(q_0,p_0,s_0).\n$$\n对于每个测试用例，程序应返回这两个量。\n\n测试套件：\n- 案例1（一般情况）：$m=1$, $k=1$, $c=2$, $\\alpha=0.5$, $q_0=0.3$, $p_0=0.7$, $s_0=1.0$, $\\Delta t=0.05$, $T=1.0$。\n- 案例2（边界情况：初始 $s_0$ 非常小）：$m=2$, $k=0.5$, $c=1.0$, $\\alpha=0.1$, $q_0=1.2$, $p_0=-0.4$, $s_0=10^{-8}$, $\\Delta t=0.02$, $T=0.5$。\n- 案例3（边界情况：无耗散）：$m=1$, $k=3$, $c=1.0$, $\\alpha=0.0$, $q_0=-0.1$, $p_0=0.2$, $s_0=10.0$, $\\Delta t=0.1$, $T=1.0$。\n- 案例4（大时间步长，长时演化）：$m=1$, $k=4$, $c=1.5$, $\\alpha=2.0$, $q_0=2.0$, $p_0=0.0$, $s_0=0.5$, $\\Delta t=0.5$, $T=5.0$。\n\n覆盖设计：\n- 案例1测试在非零耗散和一般初始条件下的典型行为。\n- 案例2测试当熵变量从非常接近零的正值开始时的鲁棒性。\n- 案例3测试不可逆效应消失的极限情况。\n- 案例4测试在大时间步长和长积分时间下的行为。\n\n答案规格：\n- 对于每个案例，以浮点数形式输出数对 $[\\Delta E, \\Delta S]$。\n- 你的程序应生成单行输出，其中包含所有测试用例的结果，形式为由方括号括起来的、以逗号分隔的数对列表，例如，\"[[dE1,dS1],[dE2,dS2],[dE3,dS3],[dE4,dS4]]\"。",
            "solution": "问题陈述经评估有效。它在科学上基于既有的非平衡热力学 GENERIC 形式主义，问题提法完善，提供了所有必要信息，并使用精确的数学语言进行客观陈述。该模型是一个标准的、尽管简化的表示，用于描述一个与类热变量耦合的力学系统，并且指定的算子和演化方程与该框架的原理一致。因此，我们可以着手求解。\n\n目标是为给定的 GENERIC 系统实现一个分裂步长时间积分器。状态向量 $z = (q, p, s)$ 的演化由以下方程控制：\n$$\n\\frac{dz}{dt} = L(z) \\nabla E(z) + M(z) \\nabla S(z)\n$$\n问题指定了一个分裂方案，其中在一个时间步长 $\\Delta t$ 内的完整演化，通过复合动力学的两个组成部分——即可逆（哈密顿）部分和不可逆（耗散）部分——的精确流来近似。\n\n首先，我们定义能量 $E(q,p,s) = \\frac{p^2}{2 m} + \\frac{k}{2} q^2$ 和熵 $S(q,p,s) = c \\ln(s)$ 的梯度：\n$$\n\\nabla E(z) = \\begin{pmatrix} \\partial E / \\partial q \\\\ \\partial E / \\partial p \\\\ \\partial E / \\partial s \\end{pmatrix} = \\begin{pmatrix} k q \\\\ p/m \\\\ 0 \\end{pmatrix}\n$$\n$$\n\\nabla S(z) = \\begin{pmatrix} \\partial S / \\partial q \\\\ \\partial S / \\partial p \\\\ \\partial S / \\partial s \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ c/s \\end{pmatrix}\n$$\n\n分裂步长法涉及求解两个时间长度为 $\\Delta t$ 的子问题。\n\n**1. 可逆（哈密顿）子问题**\n\n第一个子问题对应于由泊松算子 $L$ 控制的可逆动力学：\n$$\n\\frac{dz}{dt} = L(z) \\nabla E(z)\n$$\n代入 $L$ 和 $\\nabla E(z)$ 的给定形式：\n$$\n\\begin{pmatrix} \\dot{q} \\\\ \\dot{p} \\\\ \\dot{s} \\end{pmatrix} = \\begin{pmatrix} 0  1  0 \\\\ -1  0  0 \\\\ 0  0  0 \\end{pmatrix} \\begin{pmatrix} k q \\\\ p/m \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} p/m \\\\ -kq \\\\ 0 \\end{pmatrix}\n$$\n该方程组描述了正则变量 $(q,p)$ 的一个简谐振子和一个静态的熵变量 $s$：\n$$\n\\dot{q} = \\frac{p}{m}, \\quad \\dot{p} = -kq, \\quad \\dot{s} = 0\n$$\n角频率为 $\\omega = \\sqrt{k/m}$。从 $(q_n, p_n)$ 开始，在时间间隔 $\\Delta t$ 内 $(q,p)$ 的精确解是相空间中的一个旋转：\n$$\nq_{n+1} = q_n \\cos(\\omega \\Delta t) + \\frac{p_n}{m \\omega} \\sin(\\omega \\Delta t)\n$$\n$$\np_{n+1} = -m \\omega q_n \\sin(\\omega \\Delta t) + p_n \\cos(\\omega \\Delta t)\n$$\n熵变量保持不变：$s_{n+1} = s_n$。这个流精确地保持能量 $E$ 和熵 $S$ 守恒。\n\n**2. 不可逆（耗散）子问题**\n\n第二个子问题对应于由耗散算子 $M(z)$ 控制的不可逆动力学：\n$$\n\\frac{dz}{dt} = M(z) \\nabla S(z)\n$$\n代入 $M(z)$ 和 $\\nabla S(z)$ 的给定形式：\n$$\n\\begin{pmatrix} \\dot{q} \\\\ \\dot{p} \\\\ \\dot{s} \\end{pmatrix} = \\begin{pmatrix} 0  0  0 \\\\ 0  0  0 \\\\ 0  0  \\alpha s \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ c/s \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ \\alpha c \\end{pmatrix}\n$$\n这产生了一个平凡的方程组：\n$$\n\\dot{q} = 0, \\quad \\dot{p} = 0, \\quad \\dot{s} = \\alpha c\n$$\n从 $(q_n, p_n, s_n)$ 开始，在时间间隔 $\\Delta t$ 内的精确解是：\n$$\nq_{n+1} = q_n\n$$\n$$\np_{n+1} = p_n\n$$\n$$\ns_{n+1} = s_n + \\alpha c \\Delta t\n$$\n这个流精确地保持能量 $E$ 守恒（因为它不依赖于 $s$），但对于 $\\alpha  0$，它会增加熵 $S$。由于 $s_0  0$，$c  0$，$\\alpha \\ge 0$ 且 $\\Delta t  0$，所以 $s$ 的值是非递减的，并将始终保持为正。\n\n**分裂步长积分器算法**\n\n该积分器将执行 $N = T/\\Delta t$ 步。在每一步中，我们首先应用可逆更新，然后应用不可逆更新。设 $z_n=(q_n, p_n, s_n)$ 为时间 $t_n$ 时的状态。\n\n1.  初始化状态 $z(0) = (q_0, p_0, s_0)$。\n2.  计算步数 $N = T/\\Delta t$。\n3.  对于从 $0$ 到 $N-1$ 的 $n$：\n    a.  首先，根据在 $\\Delta t$ 上的可逆流更新 $(q,p)$，保持 $s$ 不变。\n    b.  其次，根据在 $\\Delta t$ 上的不可逆流更新 $s$，保持新计算的 $(q,p)$ 不变。\n4.  经过 $N$ 步后，我们得到最终状态 $z(T) = (q(T), p(T), s(T))$。\n5.  计算总能量变化 $\\Delta E = E(z(T)) - E(z(0))$ 和总熵变化 $\\Delta S = S(z(T)) - S(z(0))$。\n\n这个特定问题的一个关键特征是变量的完全解耦。能量 $E$ 仅依赖于 $(q,p)$，而熵 $S$ 仅依赖于 $s$。可逆算子 $L$ 仅作用于 $(q,p)$，而不可逆算子 $M$ 仅作用于 $s$。此外，$s$ 的不可逆演化与状态 $(q,p,s)$ 无关，而 $(q,p)$ 的可逆演化与 $s$ 无关。因此，分裂方案不是一种近似，而是给出了完整常微分方程组 (ODEs) 的精确解。结果是，能量 $E$ 必须被算法精确守恒，这意味着 $\\Delta E$ 应为零，仅受浮点精度限制。经过 $N$ 步后的总熵变可以计算为 $s(T) = s_0 + N(\\alpha c \\Delta t) = s_0 + \\alpha c T$，这导致 $\\Delta S = c \\ln(s(T)) - c \\ln(s_0) = c \\ln\\left(\\frac{s_0 + \\alpha c T}{s_0}\\right)$。这些解析结果可作为对数值实现的可靠验证。\n\n该实现将循环执行指定的步骤并计算最终的状态变化。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a split-step integrator for a GENERIC-inspired model and\n    calculates the change in energy and entropy for several test cases.\n    \"\"\"\n    # Test cases from the problem description.\n    # Format: (m, k, c, alpha, q0, p0, s0, dt, T)\n    test_cases = [\n        # Case 1 (general case)\n        (1.0, 1.0, 2.0, 0.5, 0.3, 0.7, 1.0, 0.05, 1.0),\n        # Case 2 (edge case: very small initial s0)\n        (2.0, 0.5, 1.0, 0.1, 1.2, -0.4, 1e-8, 0.02, 0.5),\n        # Case 3 (boundary case: no dissipation)\n        (1.0, 3.0, 1.0, 0.0, -0.1, 0.2, 10.0, 0.1, 1.0),\n        # Case 4 (large time step, long evolution)\n        (1.0, 4.0, 1.5, 2.0, 2.0, 0.0, 0.5, 0.5, 5.0),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        m, k, c, alpha, q0, p0, s0, dt, T = case\n\n        # Initialize state variables\n        q, p, s = q0, p0, s0\n\n        # Calculate constants for the simulation\n        omega = np.sqrt(k / m)\n        # Use round to ensure integer number of steps, as guaranteed by the problem\n        num_steps = int(round(T / dt))\n\n        # Define energy and entropy functions\n        def energy(qt, pt):\n            return pt**2 / (2 * m) + k / 2 * qt**2\n\n        def entropy(st):\n            # s is guaranteed to be positive throughout the simulation\n            return c * np.log(st)\n\n        # Store initial energy and entropy\n        E_initial = energy(q0, p0)\n        S_initial = entropy(s0)\n\n        # Main integration loop\n        for _ in range(num_steps):\n            # --- Hamiltonian (reversible) step for (q, p) ---\n            q_current, p_current = q, p\n            \n            cos_wdt = np.cos(omega * dt)\n            sin_wdt = np.sin(omega * dt)\n            \n            # The case omega=0 is ruled out by k>0, m>0.\n            q = q_current * cos_wdt + (p_current / (m * omega)) * sin_wdt\n            p = -m * omega * q_current * sin_wdt + p_current * cos_wdt\n            \n            # --- Dissipative (irreversible) step for s ---\n            s = s + alpha * c * dt\n\n        # Calculate final energy and entropy\n        E_final = energy(q, p)\n        S_final = entropy(s)\n\n        # Calculate changes\n        delta_E = E_final - E_initial\n        delta_S = S_final - S_initial\n\n        results.append([delta_E, delta_S])\n\n    # Final print statement in the exact required format.\n    # The str() of a list automatically includes the brackets, e.g., '[1.0, 2.0]'.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}