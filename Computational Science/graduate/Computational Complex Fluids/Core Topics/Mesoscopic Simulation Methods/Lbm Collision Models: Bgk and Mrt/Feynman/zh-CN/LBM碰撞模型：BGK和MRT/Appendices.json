{
    "hands_on_practices": [
        {
            "introduction": "LBM 算法由两个主要步骤组成：迁移和碰撞。为了真正理解碰撞算子的作用，首先分析一个缺少碰撞的假设情景是很有启发性的。这个思想实验  隔离了迁移步骤，使我们能够探究其基本性质，并确定在周期性网格上仅通过粒子平流运动能够守恒的物理量。",
            "id": "4092461",
            "problem": "考虑在大小为 $N_x \\times N_y$ 的二维周期性网格上，使用格子玻尔兹曼方法 (LBM) 处理具有离散速度 $\\{\\mathbf{c}_i\\}_{i=0}^{Q-1}$ 和分布函数 $f_i(\\mathbf{x},t)$ 的系统。宏观密度和动量分别定义为 $\\rho(\\mathbf{x},t) = \\sum_{i=0}^{Q-1} f_i(\\mathbf{x},t)$ 和 $\\rho\\mathbf{u}(\\mathbf{x},t) = \\sum_{i=0}^{Q-1} \\mathbf{c}_i f_i(\\mathbf{x},t)$。在 Bhatnagar-Gross-Krook (BGK) 和多弛豫时间 (MRT) 碰撞模型中，碰撞算子都通过弛豫过程局部地作用于 $f_i(\\mathbf{x},t)$。在这个思想实验中，碰撞被禁用，因此碰撞算子恒等于零，即 $\\Omega_i(\\mathbf{x},t) = 0$，演化过程简化为自由迁移\n$$\nf_i(\\mathbf{x} + \\mathbf{c}_i \\Delta t,\\, t + \\Delta t) = f_i(\\mathbf{x},t),\n$$\n在两个方向上都具有严格的周期性边界条件。从一个任意的、非均匀的初始条件 $f_i(\\mathbf{x},0)$ 出发，分析在迁移作用下 $\\rho(\\mathbf{x},t)$ 和 $\\mathbf{u}(\\mathbf{x},t)$ 的演化过程，并确定在周期性网格上哪些宏观量随时间保持守恒。\n\n在上述条件下，以下哪些陈述是正确的？\n\nA. 总质量 $\\sum_{\\mathbf{x}} \\rho(\\mathbf{x},t)$ 对所有 $t$ 严格保持不变。\n\nB. 总动量 $\\sum_{\\mathbf{x}} \\rho(\\mathbf{x},t)\\,\\mathbf{u}(\\mathbf{x},t)$ 对所有 $t$ 严格保持不变。\n\nC. 逐点密度 $\\rho(\\mathbf{x},t)$ 在每个位置 $\\mathbf{x}$ 上随时间保持不变。\n\nD. 全局二阶矩 $\\sum_{\\mathbf{x}}\\sum_{i=0}^{Q-1} \\|\\mathbf{c}_i\\|^2\\, f_i(\\mathbf{x},t)$ 对所有 $t$ 严格保持不变。\n\nE. 宏观动能 $\\sum_{\\mathbf{x}} \\tfrac{1}{2}\\,\\rho(\\mathbf{x},t)\\,\\|\\mathbf{u}(\\mathbf{x},t)\\|^2$ 对所有 $t$ 严格保持不变。\n\nF. 对于每个离散速度指标 $i$，值的多重集 $\\{ f_i(\\mathbf{x},t) : \\mathbf{x} \\text{ in the grid}\\}$ 不随时间改变（即，迁移过程只是对网格上 $\\mathbf{x}$ 的值进行置换，但其值的集合不变）。",
            "solution": "用户要求对问题陈述进行严格验证，然后完整推导解决方案并评估所有选项。\n\n### 问题验证\n\n**第一步：提取已知条件**\n-   系统：格子玻尔兹曼方法 (LBM)。\n-   区域：一个大小为 $N_x \\times N_y$ 的二维周期性网格。\n-   变量：与一组分布函数 $f_i(\\mathbf{x},t)$ 对应的离散速度 $\\{\\mathbf{c}_i\\}_{i=0}^{Q-1}$。\n-   宏观定义：\n    -   密度: $\\rho(\\mathbf{x},t) = \\sum_{i=0}^{Q-1} f_i(\\mathbf{x},t)$。\n    -   动量: $\\rho\\mathbf{u}(\\mathbf{x},t) = \\sum_{i=0}^{Q-1} \\mathbf{c}_i f_i(\\mathbf{x},t)$。\n-   动力学：碰撞算子恒等于零，$\\Omega_i(\\mathbf{x},t) = 0$。系统动力学仅由迁移方程决定：\n    $$f_i(\\mathbf{x} + \\mathbf{c}_i \\Delta t,\\, t + \\Delta t) = f_i(\\mathbf{x},t)$$\n-   边界条件：在两个空间方向上均严格周期。\n-   初始条件：分布函数 $f_i(\\mathbf{x},0)$ 的一个任意的、非均匀的初始条件。\n-   目标：确定所列出的宏观量中哪些随时间守恒。\n\n**第二步：使用提取的已知条件进行验证**\n-   **科学依据：** 该问题描述了格子玻尔兹曼方法既定框架内的一个有效思想实验。迁移步骤是 LBM 算法的基本组成部分，单独分析其性质是一种标准的教学和理论练习。宏观密度和动量的定义是标准的。该问题没有任何科学不准确或伪科学之处。\n-   **适定性：** 该问题是适定的。演化方程是确定性的，区域已指定（周期性网格），初始条件的性质也已定义。问题要求确定守恒量，这对于给定的动力系统是一个明确定义的数学问题。\n-   **客观性：** 语言正式、精确、客观，使用了计算物理学的标准术语。没有主观或模糊的陈述。\n\n**第三步：结论与行动**\n问题陈述是**有效的**。它在科学上是合理的、适定的和客观的。我将继续进行解答。\n\n### 解题推导\n\n系统的动力学完全由周期性网格上的自由迁移步骤决定。演化方程为：\n$$f_i(\\mathbf{x} + \\mathbf{c}_i \\Delta t,\\, t + \\Delta t) = f_i(\\mathbf{x},t)$$\n这意味着在 $t$ 时刻位于 $\\mathbf{x}$ 处的分布函数 $f_i$ 的值，在下一个时间步 $t + \\Delta t$ 被输运到位置 $\\mathbf{x} + \\mathbf{c}_i \\Delta t$。等价地，在 $t+\\Delta t$ 时刻位于 $\\mathbf{x}$ 处的值，源于 $t$ 时刻的位置 $\\mathbf{x} - \\mathbf{c}_i \\Delta t$：\n$$f_i(\\mathbf{x}, t + \\Delta t) = f_i(\\mathbf{x} - \\mathbf{c}_i \\Delta t, t)$$\n在周期性网格上，这个过程的一个关键特性是，对于任何函数 $g(\\mathbf{x})$，其在所有网格点上的总和对于其自变量的常数平移是不变的：$\\sum_{\\mathbf{x}} g(\\mathbf{x}) = \\sum_{\\mathbf{x}} g(\\mathbf{x} - \\mathbf{a})$，其中求和遍历所有网格节点 $\\mathbf{x}$，$\\mathbf{a}$ 是一个常数向量位移。这是因为映射 $\\mathbf{x} \\mapsto \\mathbf{x} - \\mathbf{a}$ 是对网格点的一种置换。\n\n我们现在将评估每个陈述。\n\n**A. 总质量 $\\sum_{\\mathbf{x}} \\rho(\\mathbf{x},t)$ 对所有 $t$ 严格保持不变。**\n\n在 $t$ 时刻的总质量是 $M(t) = \\sum_{\\mathbf{x}} \\rho(\\mathbf{x},t) = \\sum_{\\mathbf{x}} \\sum_{i=0}^{Q-1} f_i(\\mathbf{x},t)$。\n我们计算在 $t + \\Delta t$ 时刻的总质量：\n$$M(t+\\Delta t) = \\sum_{\\mathbf{x}} \\rho(\\mathbf{x}, t+\\Delta t) = \\sum_{\\mathbf{x}} \\sum_{i=0}^{Q-1} f_i(\\mathbf{x}, t+\\Delta t)$$\n使用迁移规则：\n$$M(t+\\Delta t) = \\sum_{\\mathbf{x}} \\sum_{i=0}^{Q-1} f_i(\\mathbf{x} - \\mathbf{c}_i \\Delta t, t)$$\n我们可以交换求和顺序：\n$$M(t+\\Delta t) = \\sum_{i=0}^{Q-1} \\left( \\sum_{\\mathbf{x}} f_i(\\mathbf{x} - \\mathbf{c}_i \\Delta t, t) \\right)$$\n由于网格的周期性，对平移后坐标 $\\mathbf{x} - \\mathbf{c}_i \\Delta t$ 的求和等于对原始坐标的求和。令 $\\mathbf{y} = \\mathbf{x} - \\mathbf{c}_i \\Delta t$。当 $\\mathbf{x}$ 遍历所有网格点时，$\\mathbf{y}$ 也同样如此。\n$$\\sum_{\\mathbf{x}} f_i(\\mathbf{x} - \\mathbf{c}_i \\Delta t, t) = \\sum_{\\mathbf{y}} f_i(\\mathbf{y}, t)$$\n将其代回，我们得到：\n$$M(t+\\Delta t) = \\sum_{i=0}^{Q-1} \\sum_{\\mathbf{y}} f_i(\\mathbf{y}, t) = \\sum_{\\mathbf{y}} \\sum_{i=0}^{Q-1} f_i(\\mathbf{y}, t) = \\sum_{\\mathbf{y}} \\rho(\\mathbf{y}, t) = M(t)$$\n总质量是守恒的。\n**结论：正确。**\n\n**B. 总动量 $\\sum_{\\mathbf{x}} \\rho(\\mathbf{x},t)\\,\\mathbf{u}(\\mathbf{x},t)$ 对所有 $t$ 严格保持不变。**\n\n在 $t$ 时刻的总动量是 $\\mathbf{P}(t) = \\sum_{\\mathbf{x}} \\rho(\\mathbf{x},t)\\mathbf{u}(\\mathbf{x},t) = \\sum_{\\mathbf{x}} \\sum_{i=0}^{Q-1} \\mathbf{c}_i f_i(\\mathbf{x},t)$。\n在 $t+\\Delta t$ 时刻：\n$$\\mathbf{P}(t+\\Delta t) = \\sum_{\\mathbf{x}} \\sum_{i=0}^{Q-1} \\mathbf{c}_i f_i(\\mathbf{x}, t+\\Delta t) = \\sum_{\\mathbf{x}} \\sum_{i=0}^{Q-1} \\mathbf{c}_i f_i(\\mathbf{x} - \\mathbf{c}_i \\Delta t, t)$$\n交换求和顺序：\n$$\\mathbf{P}(t+\\Delta t) = \\sum_{i=0}^{Q-1} \\mathbf{c}_i \\left( \\sum_{\\mathbf{x}} f_i(\\mathbf{x} - \\mathbf{c}_i \\Delta t, t) \\right)$$\n使用与总质量相同的周期性论证：\n$$\\mathbf{P}(t+\\Delta t) = \\sum_{i=0}^{Q-1} \\mathbf{c}_i \\left( \\sum_{\\mathbf{y}} f_i(\\mathbf{y}, t) \\right) = \\sum_{\\mathbf{y}} \\sum_{i=0}^{Q-1} \\mathbf{c}_i f_i(\\mathbf{y}, t) = \\mathbf{P}(t)$$\n总动量是守恒的。\n**结论：正确。**\n\n**C. 逐点密度 $\\rho(\\mathbf{x},t)$ 在每个位置 $\\mathbf{x}$ 上随时间保持不变。**\n\n在 $t+\\Delta t$ 时刻的逐点密度是：\n$$\\rho(\\mathbf{x}, t+\\Delta t) = \\sum_{i=0}^{Q-1} f_i(\\mathbf{x}, t+\\Delta t) = \\sum_{i=0}^{Q-1} f_i(\\mathbf{x} - \\mathbf{c}_i \\Delta t, t)$$\n要使其保持不变，我们需要对所有的 $\\mathbf{x}$ 和 $t$ 都有 $\\sum_{i=0}^{Q-1} f_i(\\mathbf{x} - \\mathbf{c}_i \\Delta t, t) = \\sum_{i=0}^{Q-1} f_i(\\mathbf{x}, t)$。\n问题陈述指出初始条件 $f_i(\\mathbf{x},0)$ 是任意且非均匀的。对于这样的一般状态，在不同位置 $\\mathbf{x}$ 和 $\\mathbf{x} - \\mathbf{c}_i \\Delta t$ 处的 $f_i$ 值将会不同。迁移过程正是导致密度和速度发生局部变化，从而引发流体动力学的机制。因此，逐点密度不守恒。\n**结论：不正确。**\n\n**D. 全局二阶矩 $\\sum_{\\mathbf{x}}\\sum_{i=0}^{Q-1} \\|\\mathbf{c}_i\\|^2\\, f_i(\\mathbf{x},t)$ 对所有 $t$ 严格保持不变。**\n\n令 $S_2(t) = \\sum_{\\mathbf{x}}\\sum_{i=0}^{Q-1} \\|\\mathbf{c}_i\\|^2\\, f_i(\\mathbf{x},t)$。这是一个全局量，是分布函数 $f_i$ 的一个线性泛函。用于选项 A 和 B 的逻辑可直接应用。\n$$S_2(t+\\Delta t) = \\sum_{\\mathbf{x}}\\sum_{i=0}^{Q-1} \\|\\mathbf{c}_i\\|^2\\, f_i(\\mathbf{x}, t+\\Delta t) = \\sum_{i=0}^{Q-1} \\|\\mathbf{c}_i\\|^2 \\left( \\sum_{\\mathbf{x}} f_i(\\mathbf{x} - \\mathbf{c}_i \\Delta t, t) \\right)$$\n再次使用周期性：\n$$S_2(t+\\Delta t) = \\sum_{i=0}^{Q-1} \\|\\mathbf{c}_i\\|^2 \\left( \\sum_{\\mathbf{y}} f_i(\\mathbf{y}, t) \\right) = \\sum_{\\mathbf{y}} \\sum_{i=0}^{Q-1} \\|\\mathbf{c}_i\\|^2 f_i(\\mathbf{y}, t) = S_2(t)$$\n这个全局二阶矩是守恒的。\n**结论：正确。**\n\n**E. 宏观动能 $\\sum_{\\mathbf{x}} \\tfrac{1}{2}\\,\\rho(\\mathbf{x},t)\\,\\|\\mathbf{u}(\\mathbf{x},t)\\|^2$ 对所有 $t$ 严格保持不变。**\n\n宏观动能是 $K(t) = \\sum_{\\mathbf{x}} \\frac{1}{2} \\rho(\\mathbf{x},t) \\|\\mathbf{u}(\\mathbf{x},t)\\|^2$。\n我们可以用分布函数来表示它：\n$$K(t) = \\sum_{\\mathbf{x}} \\frac{1}{2} \\rho(\\mathbf{x},t) \\left\\| \\frac{\\rho(\\mathbf{x},t)\\mathbf{u}(\\mathbf{x},t)}{\\rho(\\mathbf{x},t)} \\right\\|^2 = \\sum_{\\mathbf{x}} \\frac{\\|\\sum_{i=0}^{Q-1} \\mathbf{c}_i f_i(\\mathbf{x},t)\\|^2}{2 \\sum_{j=0}^{Q-1} f_j(\\mathbf{x},t)}$$\n被加数是局部分布函数 $f_i(\\mathbf{x},t)$ 的一个非线性函数。在下一个时间步，新的局部分布是 $f_i(\\mathbf{x}, t+\\Delta t) = f_i(\\mathbf{x}-\\mathbf{c}_i\\Delta t, t)$。新的动能是：\n$$K(t+\\Delta t) = \\sum_{\\mathbf{x}} \\frac{\\|\\sum_{i=0}^{Q-1} \\mathbf{c}_i f_i(\\mathbf{x}-\\mathbf{c}_i\\Delta t,t)\\|^2}{2 \\sum_{j=0}^{Q-1} f_j(\\mathbf{x}-\\mathbf{c}_j\\Delta t,t)}$$\n该表达式涉及对网格的求和，其被加项是一个非线性函数，其自变量是前一时间步从不同位置提取的 $f_i$ 值。对于任意初始状态，没有普适原理能保证这个总和等于 $K(t)$。迁移过程重新排列了网格上的 $f_i$ 值，这改变了 $\\rho$ 和 $\\mathbf{u}$ 的局部值，从而也改变了局部动能 $\\frac{1}{2}\\rho\\|\\mathbf{u}\\|^2$。这些变化的局部值的总和通常是不守恒的。\n**结论：不正确。**\n\n**F. 对于每个离散速度指标 $i$，值的多重集 $\\{ f_i(\\mathbf{x},t) : \\mathbf{x} \\text{ in the grid}\\}$ 不随时间改变（即，迁移过程只是对网格上 $\\mathbf{x}$ 的值进行置换，但其值的集合不变）。**\n\n令 $\\mathcal{M}_i(t)$ 为在时刻 $t$ 第 $i$ 个分布函数在所有网格点 $\\mathbf{x}$ 上的值的多重集。\n$$\\mathcal{M}_i(t) = \\{ f_i(\\mathbf{x},t) \\mid \\mathbf{x} \\text{ 是一个网格点} \\}$$\n在时刻 $t+\\Delta t$，多重集为 $\\mathcal{M}_i(t+\\Delta t) = \\{ f_i(\\mathbf{y},t+\\Delta t) \\mid \\mathbf{y} \\text{ 是一个网格点} \\}$。\n使用迁移规则 $f_i(\\mathbf{y},t+\\Delta t) = f_i(\\mathbf{y} - \\mathbf{c}_i \\Delta t, t)$：\n$$\\mathcal{M}_i(t+\\Delta t) = \\{ f_i(\\mathbf{y} - \\mathbf{c}_i \\Delta t, t) \\mid \\mathbf{y} \\text{ 是一个网格点} \\}$$\n令 $\\mathbf{x} = \\mathbf{y} - \\mathbf{c}_i \\Delta t$。因为网格是周期性的，映射 $\\mathbf{y} \\mapsto \\mathbf{x}$ 是对网格点的一种置换。因此，所有点 $\\{\\mathbf{x}\\}$ 的集合与所有点 $\\{\\mathbf{y}\\}$ 的集合是相同的。\n$$\\mathcal{M}_i(t+\\Delta t) = \\{ f_i(\\mathbf{x}, t) \\mid \\mathbf{x} \\text{ 是一个网格点} \\} = \\mathcal{M}_i(t)$$\n这表明对于每个速度指标 $i$，整个网格上所有 $f_i$ 值的集合在迁移过程中保持不变；这些值仅仅是在网格站点之间进行了置换。\n**结论：正确。**",
            "answer": "$$\\boxed{ABDF}$$"
        },
        {
            "introduction": "在理解了迁移步骤之后，我们转向碰撞算子，它模拟流体相互作用并驱动系统趋向局部平衡。BGK 模型提供了最简单的方法，使用单一的弛豫时间 $\\tau$。本练习  将引导您完成关键的 Chapman-Enskog 分析，以形式化地推导出微观参数 $\\tau$ 与宏观运动粘度 $\\nu$ 之间的关系，揭示 LBM 如何恢复纳维-斯托克斯方程。",
            "id": "4092460",
            "problem": "考虑使用格子玻尔兹曼方法 (Lattice Boltzmann Method, LBM) 在二维九速 (D2Q9) 格子上模拟的等温、弱可压牛顿流体。碰撞算子为具有单弛豫时间的 Bhatnagar–Gross–Krook (BGK) 类型。设其离散演化方程为\n$$\nf_{\\alpha}(\\mathbf{x}+\\mathbf{e}_{\\alpha}\\,\\Delta t,t+\\Delta t)=f_{\\alpha}(\\mathbf{x},t)-\\frac{\\Delta t}{\\tau}\\left[f_{\\alpha}(\\mathbf{x},t)-f_{\\alpha}^{\\mathrm{eq}}(\\mathbf{x},t)\\right],\n$$\n其中，$f_{\\alpha}$ 是与离散速度 $\\mathbf{e}_{\\alpha}$ 相关联的布居函数，$f_{\\alpha}^{\\mathrm{eq}}$ 是二阶等温平衡态分布函数，$\\Delta t$ 是时间步长，$\\tau$ 是弛豫时间。流体动力学场由 $ \\rho=\\sum_{\\alpha} f_{\\alpha}$ 和 $ \\rho \\,\\mathbf{u}=\\sum_{\\alpha}\\mathbf{e}_{\\alpha} f_{\\alpha}$ 定义。D2Q9 求积满足以下标准各向同性恒等式\n$$\n\\sum_{\\alpha} w_{\\alpha}\\, e_{\\alpha i} e_{\\alpha j}=c_{s}^{2}\\,\\delta_{ij},\\qquad\n\\sum_{\\alpha} w_{\\alpha}\\, e_{\\alpha i} e_{\\alpha j} e_{\\alpha k} e_{\\alpha l}=c_{s}^{4}\\left(\\delta_{ij}\\delta_{kl}+\\delta_{ik}\\delta_{jl}+\\delta_{il}\\delta_{jk}\\right),\n$$\n其中 $w_{\\alpha}$ 是格子权重，$c_{s}^{2}$ 是格子声速的平方。\n\n从这些定义和离散时间演化方程出发，结合对 $\\Delta t$ 的二阶泰勒展开和 Chapman–Enskog 多尺度分析，在流体动力学尺度上推导出纳维-斯托克斯方程。基于此推导，求出 BGK 模型的运动粘度 $ \\nu $，表示为 $ c_{s}^{2} $、$ \\tau $ 和 $ \\Delta t $ 的函数。然后，在格子单位下（即 $ \\Delta t=1 $ 和 $ c_{s}^{2}=1/3 $），计算所得表达式，将 $ \\nu $ 表示为仅含 $ \\tau $ 的闭式函数。请清楚地说明推导过程中所需的任何假设。你的最终答案必须是单一的解析表达式。无需四舍五入。请用格子单位表示你的答案。",
            "solution": "本题要求推导采用 Bhatnagar–Gross–Krook (BGK) 碰撞算子的格子玻尔兹曼方法 (LBM) 的运动粘度 $\\nu$。推导过程将使用 Chapman–Enskog 多尺度分析。\n\n离散格子玻尔兹曼方程 (LBE) 如下所示：\n$$\nf_{\\alpha}(\\mathbf{x}+\\mathbf{e}_{\\alpha}\\,\\Delta t,t+\\Delta t) - f_{\\alpha}(\\mathbf{x},t) = -\\frac{\\Delta t}{\\tau}\\left[f_{\\alpha}(\\mathbf{x},t)-f_{\\alpha}^{\\mathrm{eq}}(\\mathbf{x},t)\\right]\n$$\n其中 $f_{\\alpha}$ 是粒子分布函数，$\\mathbf{e}_{\\alpha}$ 是离散速度，$\\Delta t$ 是时间步长，$\\tau$ 是弛豫时间，$f_{\\alpha}^{\\mathrm{eq}}$ 是平衡分布函数。\n\n**步骤 1：泰勒展开**\n我们首先对 LBE 的左侧进行关于 $\\Delta t$ 的二阶泰勒展开：\n$$\nf_{\\alpha}(\\mathbf{x}+\\mathbf{e}_{\\alpha}\\,\\Delta t,t+\\Delta t) = f_{\\alpha}(\\mathbf{x},t) + \\Delta t \\left(\\partial_t + \\mathbf{e}_{\\alpha} \\cdot \\nabla \\right) f_{\\alpha} + \\frac{(\\Delta t)^2}{2} \\left(\\partial_t + \\mathbf{e}_{\\alpha} \\cdot \\nabla \\right)^2 f_{\\alpha} + \\mathcal{O}((\\Delta t)^3)\n$$\n将此展开式代入 LBE 并除以 $\\Delta t$，我们得到包含离散化效应的连续玻尔兹曼方程：\n$$\n\\left(\\partial_t + e_{\\alpha i} \\partial_i \\right) f_{\\alpha} + \\frac{\\Delta t}{2} \\left(\\partial_t + e_{\\alpha i} \\partial_i \\right)^2 f_{\\alpha} = -\\frac{1}{\\tau} (f_{\\alpha} - f_{\\alpha}^{\\mathrm{eq}})\n$$\n这里，对空间索引 $i$ 使用了爱因斯坦求和约定。\n\n**步骤 2：Chapman–Enskog 多尺度展开**\n根据 Chapman–Enskog 方法，我们引入一个形式小参数 $\\epsilon$（与克努森数成正比），以分离快速的微观尺度和慢速的宏观尺度。\n将分布函数以及时间和空间导数展开如下：\n$$\nf_{\\alpha} = f_{\\alpha}^{(0)} + \\epsilon f_{\\alpha}^{(1)} + \\epsilon^2 f_{\\alpha}^{(2)} + \\dots\n$$\n$$\n\\partial_t = \\epsilon \\partial_{t_1} + \\epsilon^2 \\partial_{t_2}\n$$\n$$\n\\partial_i = \\epsilon \\partial_{1i}\n$$\n一个关键假设是分布函数 $f_\\alpha$ 仅通过宏观变量密度 $\\rho$ 和速度 $\\mathbf{u}$ 依赖于时间。平衡分布函数 $f_\\alpha^{\\mathrm{eq}}$ 是这些局部宏观变量的函数。我们假设零阶分布是平衡分布，即 $f_{\\alpha}^{(0)} = f_{\\alpha}^{\\mathrm{eq}}$。非平衡部分 $f_{\\alpha}^{(k)}$ ($k \\geq 1$) 的定义使其对守恒量（质量和动量）没有贡献：\n$$\n\\sum_{\\alpha} f_{\\alpha}^{(k)} = 0 \\quad \\text{and} \\quad \\sum_{\\alpha} e_{\\alpha i} f_{\\alpha}^{(k)} = 0 \\quad \\text{for } k \\geq 1\n$$\n这确保了 $\\rho = \\sum_{\\alpha} f_{\\alpha}^{(0)}$ 和 $\\rho u_i = \\sum_{\\alpha} e_{\\alpha i} f_{\\alpha}^{(0)}$。\n\n将这些展开式代入经过泰勒展开的 LBE，并收集 $\\epsilon$ 的同阶项：\n\n**$\\epsilon^1$ 阶：**\n$$\n(\\partial_{t_1} + e_{\\alpha i} \\partial_{1i}) f_{\\alpha}^{(0)} = -\\frac{1}{\\tau} f_{\\alpha}^{(1)}\n$$\n这个方程给出了一阶非平衡分布：\n$$\nf_{\\alpha}^{(1)} = -\\tau (\\partial_{t_1} + e_{\\alpha i} \\partial_{1i}) f_{\\alpha}^{(0)}\n$$\n\n**$\\epsilon^2$ 阶：**\n$$\n\\partial_{t_2} f_{\\alpha}^{(0)} + (\\partial_{t_1} + e_{\\alpha i} \\partial_{1i}) f_{\\alpha}^{(1)} + \\frac{\\Delta t}{2} (\\partial_{t_1} + e_{\\alpha i} \\partial_{1i})^2 f_{\\alpha}^{(0)} = -\\frac{1}{\\tau} f_{\\alpha}^{(2)}\n$$\n我们可以将 $f_{\\alpha}^{(1)}$ 的表达式代入第二项：\n$$\n\\partial_{t_2} f_{\\alpha}^{(0)} - \\tau (\\partial_{t_1} + e_{\\alpha i} \\partial_{1i})^2 f_{\\alpha}^{(0)} + \\frac{\\Delta t}{2} (\\partial_{t_1} + e_{\\alpha i} \\partial_{1i})^2 f_{\\alpha}^{(0)} = -\\frac{1}{\\tau} f_{\\alpha}^{(2)}\n$$\n化简后得到：\n$$\n\\partial_{t_2} f_{\\alpha}^{(0)} - \\left(\\tau - \\frac{\\Delta t}{2}\\right) (\\partial_{t_1} + e_{\\alpha i} \\partial_{1i})^2 f_{\\alpha}^{(0)} = -\\frac{1}{\\tau} f_{\\alpha}^{(2)}\n$$\n\n**步骤 3：宏观方程的推导**\n我们对尺度分离后的方程取矩。\n对 $\\epsilon^1$ 阶方程关于 $\\alpha$ 求和：\n$$\n\\sum_{\\alpha} (\\partial_{t_1} + e_{\\alpha i} \\partial_{1i}) f_{\\alpha}^{(0)} = 0 \\implies \\partial_{t_1} \\rho + \\partial_{1i} (\\rho u_i) = 0\n$$\n这是欧拉尺度下的连续性方程。乘以 $e_{\\alpha j}$ 并求和：\n$$\n\\sum_{\\alpha} e_{\\alpha j} (\\partial_{t_1} + e_{\\alpha i} \\partial_{1i}) f_{\\alpha}^{(0)} = 0 \\implies \\partial_{t_1} (\\rho u_j) + \\partial_{1i} \\Pi_{ij}^{(0)} = 0\n$$\n其中 $\\Pi_{ij}^{(0)} = \\sum_{\\alpha} e_{\\alpha i} e_{\\alpha j} f_{\\alpha}^{(0)}$ 是平衡分布的二阶矩。对于给定的二阶等温平衡态，该矩为 $\\Pi_{ij}^{(0)} = \\rho u_i u_j + p \\delta_{ij}$，其中压力 $p = \\rho c_s^2$。这给出了欧拉动量方程：$\\partial_{t_1}(\\rho u_j) + \\partial_{1i}(\\rho u_i u_j) = -\\partial_{1j} p$。\n\n现在，我们组合不同尺度上的宏观方程。完整的动量方程通过对 $\\epsilon^1$ 和 $\\epsilon^2$ 阶的贡献求和得到：\n$$\n\\epsilon_1: \\quad \\partial_{t_1}(\\rho u_j) + \\partial_{1i}\\Pi_{ij}^{(0)} = 0\n$$\n$$\n\\epsilon_2: \\quad \\partial_{t_2}(\\rho u_j) + \\partial_{1i}\\left( \\left(1 - \\frac{\\Delta t}{2\\tau}\\right)\\Pi_{ij}^{(1)} \\right) = 0\n$$\n$\\epsilon^2$ 阶动量方程是通过将 $\\epsilon^2$ 阶方程乘以 $e_{\\alpha j}$，对 $\\alpha$ 求和，并利用 $f_{\\alpha}^{(k)}$ 的性质推导出来的。组合这两个方程，并重新构成完整的导数 $\\partial_t = \\epsilon\\partial_{t_1} + \\epsilon^2\\partial_{t_2}$ 和 $\\partial_i = \\epsilon\\partial_{1i}$：\n$$\n\\partial_t(\\rho u_j) + \\partial_i \\left( \\Pi_{ij}^{(0)} + \\left(1-\\frac{\\Delta t}{2\\tau}\\right) \\Pi_{ij}^{(1)} \\right) = \\mathcal{O}(\\epsilon^3)\n$$\n代入 $\\Pi_{ij}^{(0)} = \\rho u_i u_j + p \\delta_{ij}$：\n$$\n\\partial_t(\\rho u_j) + \\partial_i(\\rho u_i u_j) = -\\partial_j p - \\partial_i \\left( \\left(1-\\frac{\\Delta t}{2\\tau}\\right) \\Pi_{ij}^{(1)} \\right)\n$$\n该方程具有纳维-斯托克斯动量方程的形式 $\\partial_t(\\rho u_j) + \\partial_i(\\rho u_i u_j) = -\\partial_j p + \\partial_i \\sigma'_{ij}$，其中 $\\sigma'_{ij}$ 是粘性应力张量。通过比较，我们确定：\n$$\n\\sigma'_{ij} = - \\left(1 - \\frac{\\Delta t}{2\\tau}\\right) \\Pi_{ij}^{(1)}\n$$\n\n**步骤 4：粘度推导**\n为了求得粘度，我们需要计算 $\\Pi_{ij}^{(1)} = \\sum_{\\alpha} e_{\\alpha i} e_{\\alpha j} f_{\\alpha}^{(1)}$。\n$$\n\\Pi_{ij}^{(1)} = \\sum_{\\alpha} e_{\\alpha i} e_{\\alpha j} \\left( -\\tau (\\partial_{t_1} + e_{\\alpha k} \\partial_{1k}) f_{\\alpha}^{(0)} \\right) = -\\tau \\left( \\partial_{t_1} \\Pi_{ij}^{(0)} + \\partial_{1k} Q_{ijk}^{(0)} \\right)\n$$\n其中 $Q_{ijk}^{(0)} = \\sum_{\\alpha} e_{\\alpha i} e_{\\alpha j} e_{\\alpha k} f_{\\alpha}^{(0)}$。\n为了推导应力张量的粘性部分（它与速度梯度呈线性关系），我们做出低马赫数流的关键假设。在此极限下，我们可以忽略时间导数项 $\\partial_{t_1} \\Pi_{ij}^{(0)}$ 和 $Q_{ijk}^{(0)}$ 中的高阶速度项。我们近似 $f_{\\alpha}^{(0)} \\approx w_{\\alpha} \\rho \\left(1 + \\frac{e_{\\alpha k} u_k}{c_s^2}\\right)$。\n三阶矩变为：\n$$\nQ_{ijk}^{(0)} \\approx \\sum_{\\alpha} e_{\\alpha i} e_{\\alpha j} e_{\\alpha k} \\left( w_{\\alpha} \\rho \\frac{e_{\\alpha l} u_l}{c_s^2} \\right) = \\frac{\\rho u_l}{c_s^2} \\sum_{\\alpha} w_{\\alpha} e_{\\alpha i} e_{\\alpha j} e_{\\alpha k} e_{\\alpha l}\n$$\n使用题目给出的四阶张量的各向同性恒等式：\n$$\nQ_{ijk}^{(0)} \\approx \\frac{\\rho u_l}{c_s^2} c_s^4 (\\delta_{ij}\\delta_{kl} + \\delta_{ik}\\delta_{jl} + \\delta_{il}\\delta_{jk}) = \\rho c_s^2 (u_k \\delta_{ij} + u_j \\delta_{ik} + u_i \\delta_{jk})\n$$\n取其散度 $\\partial_{1k} Q_{ijk}^{(0)}$，我们得到（假设近不可压，$\\partial_l u_l \\approx 0$）：\n$$\n\\partial_{1k} Q_{ijk}^{(0)} \\approx \\rho c_s^2 (\\partial_{1i} u_j + \\partial_{1j} u_i)\n$$\n因此，非平衡动量通量张量为：\n$$\n\\Pi_{ij}^{(1)} \\approx -\\tau \\rho c_s^2 (\\partial_{1i} u_j + \\partial_{1j} u_i)\n$$\n将此代入粘性应力张量的表达式：\n$$\n\\sigma'_{ij} \\approx - \\left(1 - \\frac{\\Delta t}{2\\tau}\\right) \\left[ -\\tau \\rho c_s^2 (\\partial_i u_j + \\partial_j u_i) \\right]\n$$\n$$\n\\sigma'_{ij} \\approx \\rho c_s^2 \\left(\\tau - \\frac{\\Delta t}{2}\\right) (\\partial_i u_j + \\partial_j u_i)\n$$\n牛顿流体的应力张量为 $\\sigma'_{ij} = \\rho \\nu (\\partial_i u_j + \\partial_j u_i) + \\text{体积项}$。比较偏（剪切）部分，我们确定运动粘度 $\\nu$ 为：\n$$\n\\nu = c_s^2 \\left(\\tau - \\frac{\\Delta t}{2}\\right)\n$$\n\n**步骤 5：在格子单位下求值**\n题目要求在格子单位下计算此表达式，其中 $\\Delta t=1$ 且 $c_s^2=1/3$。\n代入这些值：\n$$\n\\nu = \\frac{1}{3} \\left(\\tau - \\frac{1}{2}\\right)\n$$\n这就是 LBM-BGK 模型在格子单位下，运动粘度作为弛豫时间 $\\tau$ 的函数的最终表达式。为了数值稳定性，粘度必须为正，即 $\\nu > 0$，这导致条件 $\\tau > 1/2$。",
            "answer": "$$\n\\boxed{\\frac{1}{3}\\left(\\tau - \\frac{1}{2}\\right)}\n$$"
        },
        {
            "introduction": "虽然理论上很优雅，但碰撞模型的数值实现面临着如有限精度算术等实际挑战。本练习  深入探讨一个关键的实现细节：舍入误差的累积及其对质量和动量守恒的影响。通过比较速度空间中的 BGK 模型和矩空间中的 MRT 模型，您将量化这种数值漂移并测试一种常见的缓解策略，从而深入了解不同碰撞方案之间的权衡。",
            "id": "4092445",
            "problem": "考虑用于复杂流体的格子玻尔兹曼方法 (LBM)，该方法建立在二维九速 ($D2Q9$) 格子上。目标是通过计算密度 $\\,\\rho\\,$ 和速度 $\\,\\mathbf{u}\\,$ 在多个时间步长内的漂移，来量化矩空间碰撞中有限精度舍入误差对质量和动量守恒的影响，并评估一种缓解策略。在格子单位下进行计算（所有量均为无量纲）。\n\n使用以下基础框架：\n- 仅含碰撞更新（无迁移）的离散玻尔兹曼方程，用于描述均匀态。其中，粒子分布函数 $\\,f_i\\,$ 在单弛豫时间 Bhatnagar–Gross–Krook (BGK) 碰撞或多弛豫时间 (MRT) 碰撞下演化。对于 BGK，碰撞直接作用于速度空间。对于 MRT，矩 $\\,\\mathbf{m} = \\mathbf{M}\\mathbf{f}\\,$ 向平衡矩 $\\,\\mathbf{m}^{\\mathrm{eq}}\\,$ 弛豫，弛豫过程由对角弛豫矩阵 $\\,\\mathbf{S}\\,$ 控制，然后通过 $\\,\\mathbf{f} = \\mathbf{M}^{-1}\\mathbf{m}\\,$ 逆变换回速度空间。\n- 使用标准的 $D2Q9$ 速度 $\\,\\mathbf{c}_i\\,$ 和权重 $\\,w_i\\,$：\n  - 速度 $\\,\\mathbf{c}_0=(0,0)$, $\\,\\mathbf{c}_1=(1,0)$, $\\,\\mathbf{c}_2=(0,1)$, $\\,\\mathbf{c}_3=(-1,0)$, $\\,\\mathbf{c}_4=(0,-1)$, $\\,\\mathbf{c}_5=(1,1)$, $\\,\\mathbf{c}_6=(-1,1)$, $\\,\\mathbf{c}_7=(-1,-1)$, $\\,\\mathbf{c}_8=(1,-1)$。\n  - 权重 $\\,w_0=\\frac{4}{9}$, $\\,w_{1,2,3,4}=\\frac{1}{9}$, $\\,w_{5,6,7,8}=\\frac{1}{36}$。\n- 标准的速度空间平衡态 $\\,f_i^{\\mathrm{eq}} = w_i \\rho \\left[1 + 3(\\mathbf{c}_i\\cdot\\mathbf{u}) + \\frac{9}{2}(\\mathbf{c}_i\\cdot\\mathbf{u})^2 - \\frac{3}{2}\\mathbf{u}^2\\right]$。\n- 标准的 $D2Q9$ 矩变换 $\\,\\mathbf{M}\\,$ (d’Humières/Lallemand–Luo 基)，其行向量为：\n  - $[1,1,1,1,1,1,1,1,1]$,\n  - $[-4,-1,-1,-1,-1,2,2,2,2]$,\n  - $[4,-2,-2,-2,-2,1,1,1,1]$,\n  - $[0,1,0,-1,0,1,-1,-1,1]$,\n  - $[0,-2,0,2,0,1,-1,-1,1]$,\n  - $[0,0,1,0,-1,1,1,-1,-1]$,\n  - $[0,0,-2,0,2,1,1,-1,-1]$,\n  - $[0,1,-1,1,-1,0,0,0,0]$,\n  - $[0,0,0,0,0,1,-1,1,-1]$。\n- 与上述变换一致的相应平衡矩 $\\,\\mathbf{m}^{\\mathrm{eq}}\\,$：\n  - $\\,m_0^{\\mathrm{eq}} = \\rho$,\n  - $\\,m_1^{\\mathrm{eq}} = -2\\rho + 3\\rho(u_x^2 + u_y^2)$,\n  - $\\,m_2^{\\mathrm{eq}} = \\rho - 3\\rho(u_x^2 + u_y^2)$,\n  - $\\,m_3^{\\mathrm{eq}} = \\rho u_x$,\n  - $\\,m_4^{\\mathrm{eq}} = -\\rho u_x$,\n  - $\\,m_5^{\\mathrm{eq}} = \\rho u_y$,\n  - $\\,m_6^{\\mathrm{eq}} = -\\rho u_y$,\n  - $\\,m_7^{\\mathrm{eq}} = \\rho(u_x^2 - u_y^2)$,\n  - $\\,m_8^{\\mathrm{eq}} = \\rho u_x u_y$。\n\n实施一个单点实验（无空间变化，无迁移）以分离碰撞和舍入效应。在 $\\,\\rho_0 = 1\\,$ 和 $\\,\\mathbf{u}_0 = (10^{-3}, -2\\times 10^{-3})\\,$ 处初始化，粒子分布函数为 $\\,\\mathbf{f} = \\mathbf{f}^{\\mathrm{eq}}(\\rho_0,\\mathbf{u}_0)\\,$。在 $\\,\\mathbf{f}\\,$ 上叠加一个振幅为 $\\,\\epsilon\\,$ 的小非平衡扰动 $\\,\\boldsymbol{\\delta}\\,$，使得 $\\,\\sum_i \\delta_i = 0\\,$ 和 $\\,\\sum_i \\delta_i \\mathbf{c}_i = \\mathbf{0}\\,$，即该扰动在初始化时精确地保持质量和动量。\n\n在每种指定的模型和精度下，将 $\\,\\mathbf{f}\\,$ 演化 $\\,N\\,$ 个碰撞步。在每一步，计算 $\\,\\rho = \\sum_i f_i\\,$ 和 $\\,\\mathbf{u} = \\frac{1}{\\rho}\\sum_i f_i \\mathbf{c}_i\\,$。对于 BGK，使用弛豫率 $\\,\\omega = 1/\\tau\\,$。对于 MRT，使用 $\\,\\mathbf{S}=\\mathrm{diag}(s_0,\\dots,s_8)\\,$，其中守恒矩的弛豫率 $\\,s_{0}=s_{3}=s_{5}=0\\,$，所有其他 $\\,s_j = \\omega\\,$。在缓解方案中，通过在弛豫和逆变换回速度空间之前，立即用其精确值 $\\,\\rho, \\rho u_x, \\rho u_y\\,$ 覆盖守恒矩 $\\,m_0, m_3, m_5\\,$，来强制实现矩空间中的守恒。\n\n测试套件：\n- 情况 $\\,1\\,$：MRT，$\\,\\tau=0.8\\,$，$\\,\\omega=1/\\tau\\,$，$\\,N=100000\\,$，$\\,\\epsilon=10^{-7}\\,$，单精度 ($\\,\\text{float32}\\,$)。\n- 情况 $\\,2\\,$：MRT，$\\,\\tau=0.8\\,$，$\\,\\omega=1/\\tau\\,$，$\\,N=100000\\,$，$\\,\\epsilon=10^{-7}\\,$，双精度 ($\\,\\text{float64}\\,$)。\n- 情况 $\\,3\\,$：带矩空间守恒强制的 MRT (缓解)，$\\,\\tau=0.8\\,$，$\\,\\omega=1/\\tau\\,$，$\\,N=100000\\,$，$\\,\\epsilon=10^{-7}\\,$，单精度 ($\\,\\text{float32}\\,$)。\n- 情况 $\\,4\\,$：BGK，$\\,\\tau=0.8\\,$，$\\,\\omega=1/\\tau\\,$，$\\,N=100000\\,$，$\\,\\epsilon=10^{-7}\\,$，单精度 ($\\,\\text{float32}\\,$)。\n- 情况 $\\,5\\,$：MRT，$\\,\\tau=0.6\\,$ (更接近稳定性边界)，$\\,\\omega=1/\\tau\\,$，$\\,N=200000\\,$，$\\,\\epsilon=10^{-7}\\,$，单精度 ($\\,\\text{float32}\\,$)。\n\n对于每种情况，返回 $\\,N\\,$ 步后的漂移度量：\n- $\\,\\Delta \\rho = \\rho_N - \\rho_0\\,$，\n- $\\,\\Delta u_x = u_{x,N} - u_{x,0}\\,$，\n- $\\,\\Delta u_y = u_{y,N} - u_{y,0}\\,$。\n\n所有输出必须是无量纲浮点数。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果顺序为\n$[\\Delta \\rho_1, \\Delta u_{x,1}, \\Delta u_{y,1}, \\Delta \\rho_2, \\Delta u_{x,2}, \\Delta u_{y,2}, \\dots, \\Delta \\rho_5, \\Delta u_{x,5}, \\Delta u_{y,5}]$。",
            "solution": "该问题被评估为有效。它在科学上基于成熟的格子玻尔兹曼方法 (LBM) 理论，问题陈述清晰，提供了所有必要的参数和初始条件，并且表述客观。任务是执行一个数值实验，以量化不同 LBM 碰撞模型中浮点舍入误差的累积情况，并测试一种缓解策略。这是计算流体动力学领域中一项标准且有意义的研究。\n\n我们将提供一个完整的解决方案。问题的核心是在单个空间点（一个均匀系统）上模拟粒子分布函数 $\\,f_i(\\mathbf{x}, t)\\,$ 的演化，从而将碰撞步与迁移步分离开来。演化过程由格子玻尔兹曼方程控制，对于仅碰撞过程，该方程简化为：\n$$\nf_i(t+1) = f_i(t) + \\Omega_i(\\mathbf{f})\n$$\n其中 $\\,\\Omega_i\\,$ 是第 $\\,i\\,$ 个速度方向的碰撞算子。模拟将执行大量的步数 $\\,N\\,$，以观察舍入误差的累积效应。\n\n模拟将基于二维九速 ($\\,D2Q9\\,$) 模型。离散速度 $\\,\\mathbf{c}_i\\,$ 和相应的权重 $\\,w_i\\,$ 如下：\n- $\\,\\mathbf{c}_0=(0,0)\\,$, $\\,\\mathbf{c}_{1,2,3,4}=(\\pm 1, 0), (0, \\pm 1)\\,$, $\\,\\mathbf{c}_{5,6,7,8}=(\\pm 1, \\pm 1)\\,$\n- $\\,w_0=4/9\\,$, $\\,w_{1,2,3,4}=1/9\\,$, $\\,w_{5,6,7,8}=1/36\\,$\n\n宏观流体密度 $\\,\\rho\\,$ 和速度 $\\,\\mathbf{u}\\,$ 定义为分布函数的矩：\n$$\n\\rho = \\sum_{i=0}^{8} f_i \\quad \\quad \\mathbf{j} = \\rho\\mathbf{u} = \\sum_{i=0}^{8} f_i \\mathbf{c}_i\n$$\n\n系统在 $\\,\\rho_0 = 1\\,$ 和 $\\,\\mathbf{u}_0 = (10^{-3}, -2\\times 10^{-3})\\,$ 处初始化。初始分布函数 $\\,\\mathbf{f}\\,$ 被设置为平衡态 $\\,\\mathbf{f}^{\\mathrm{eq}}(\\rho_0, \\mathbf{u}_0)\\,$ 加上一个量级为 $\\,\\epsilon = 10^{-7}\\,$ 的小非平衡扰动 $\\,\\boldsymbol{\\delta}\\,$。平衡分布是标准的二阶展开：\n$$\nf_i^{\\mathrm{eq}} = w_i \\rho \\left[1 + \\frac{\\mathbf{c}_i\\cdot\\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i\\cdot\\mathbf{u})^2}{2c_s^4} - \\frac{\\mathbf{u}\\cdot\\mathbf{u}}{2c_s^2}\\right]\n$$\n使用标准格子声速 $\\,c_s^2 = 1/3\\,$，上式变为：\n$$\nf_i^{\\mathrm{eq}} = w_i \\rho \\left[1 + 3(\\mathbf{c}_i\\cdot\\mathbf{u}) + \\frac{9}{2}(\\mathbf{c}_i\\cdot\\mathbf{u})^2 - \\frac{3}{2}u^2\\right]\n$$\n扰动 $\\,\\boldsymbol{\\delta}\\,$ 必须保持质量和动量，即 $\\,\\sum_i \\delta_i = 0\\,$ 和 $\\,\\sum_i \\delta_i \\mathbf{c}_i = \\mathbf{0}\\,$。一个有效的扰动可以通过设置 $\\,\\delta_1 = \\epsilon\\,$, $\\,\\delta_3 = \\epsilon\\,$ 和 $\\,\\delta_0 = -2\\epsilon\\,$，而所有其他 $\\,\\delta_i=0\\,$ 来构造。这种扰动激发了一个非平衡模式，而不会立即改变守恒的流体动力学变量。因此，初始粒子分布函数为 $\\,f_i(t=0) = f_i^{\\mathrm{eq}}(\\rho_0, \\mathbf{u}_0) + \\delta_i\\,$。\n\n我们将实现并比较三种不同的碰撞格式。\n\n1.  **Bhatnagar–Gross–Krook (BGK) 模型**：\n    该模型使用单个弛豫时间 $\\,\\tau\\,$ 使所有模式向平衡态弛豫。碰撞算子是线性的：\n    $$\n    \\Omega_i^{\\mathrm{BGK}} = -\\frac{1}{\\tau} (f_i - f_i^{\\mathrm{eq}}) = -\\omega (f_i - f_i^{\\mathrm{eq}})\n    $$\n    其中 $\\,\\omega = 1/\\tau\\,$ 是弛豫频率。碰撞后的状态为 $\\,f_i(t+1) = f_i(t) - \\omega (f_i(t) - f_i^{\\mathrm{eq}}(t))\\,$. 尽管简单，但该模型耦合了所有的弛豫过程，并且已知其在处理复杂流动时，与 MRT 相比稳定性和准确性较差。从 $\\,\\mathbf{f}\\,$ 计算 $\\,\\rho\\,$ 和 $\\,\\mathbf{u}\\,$ 时的舍入误差可能导致这些名义上的守恒量在多个步骤后发生漂移。\n\n2.  **多弛豫时间 (MRT) 模型**：\n    该模型在矩空间中操作，允许对不同的矩使用不同的弛豫率。过程如下：\n    a.  使用线性变换矩阵 $\\,\\mathbf{M}\\,$ 将粒子分布函数 $\\,\\mathbf{f}\\,$ 转换为矩向量 $\\,\\mathbf{m}\\,$：$\\,\\mathbf{m} = \\mathbf{M}\\mathbf{f}\\,$。\n    b.  使矩向其平衡值 $\\,\\mathbf{m}^{\\mathrm{eq}}\\,$ 弛豫：\n    $$\n    \\mathbf{m}^* = \\mathbf{m} - \\mathbf{S} (\\mathbf{m} - \\mathbf{m}^{\\mathrm{eq}})\n    $$\n    其中 $\\,\\mathbf{S} = \\mathrm{diag}(s_0, s_1, \\ldots, s_8)\\,$ 是一个由弛豫率构成的对角矩阵。\n    c.  将碰撞后的矩 $\\,\\mathbf{m}^*\\,$ 逆变换回粒子分布函数空间：$\\,\\mathbf{f}(t+1) = \\mathbf{M}^{-1}\\mathbf{m}^*\\,$.\n\n    问题描述中提供的特定 $\\,D2Q9\\,$ 矩基 (d'Humières/Lallemand-Luo) 将矩分为守恒量（密度、动量）和非守恒的动理学模式。守恒矩为 $\\,m_0=\\rho\\,$, $\\,m_3=\\rho u_x\\,$ 和 $\\,m_5=\\rho u_y\\,$。对于这些矩，弛豫率设置为零 ($\\,s_0=s_3=s_5=0\\,$)，这在理论上保证了质量和动量的精确守恒。所有其他非守恒矩都以速率 $\\,s_j = \\omega\\,$ 进行弛豫。尽管有此理论保证，矩阵乘法（$\\,\\mathbf{M}\\mathbf{f}\\,$ 和 $\\,\\mathbf{M}^{-1}\\mathbf{m}^*\\,$）过程中引入的舍入误差仍可能导致守恒量发生漂移。平衡矩 $\\,\\mathbf{m}^{\\mathrm{eq}}\\,$ 是直接根据 $\\,\\rho\\,$ 和 $\\,\\mathbf{u}\\,$ 计算的。\n\n3.  **带守恒强制的 MRT (缓解) 模型**：\n    这是 MRT 模型的一个变体，旨在主动对抗舍入误差的累积。过程修改如下：\n    a.  从当前的粒子分布函数 $\\,\\mathbf{f}(t)\\,$ 出发，以尽可能高的精度计算宏观量：$\\,\\rho_{\\mathrm{exact}} = \\sum_i f_i(t)\\,$ 和 $\\,(\\rho u_x)_{\\mathrm{exact}} = \\sum_i f_i(t) c_{ix}\\,$, $\\,(\\rho u_y)_{\\mathrm{exact}} = \\sum_i f_i(t) c_{iy}\\,$。\n    b.  变换到矩空间：$\\,\\mathbf{m} = \\mathbf{M}\\mathbf{f}(t)\\,$。\n    c.  **强制守恒**：用步骤 (a) 中计算的精确值覆盖与守恒量对应的计算矩：\n    $$\n    m_0 \\leftarrow \\rho_{\\mathrm{exact}} \\quad \\quad m_3 \\leftarrow (\\rho u_x)_{\\mathrm{exact}} \\quad \\quad m_5 \\leftarrow (\\rho u_y)_{\\mathrm{exact}}\n    $$\n    此步骤明确消除了 $\\,\\mathbf{M}\\mathbf{f}\\,$ 变换中对这些特定矩产生的任何舍入误差。\n    d.  使用修正后的矩向量 $\\,\\mathbf{m}\\,$ 继续进行弛豫步骤，并逆变换回粒子分布函数空间。\n\n对于每个测试用例，我们将初始化系统，使用指定的浮点精度（$\\,\\text{float32}\\,$ 或 $\\,\\text{float64}\\,$）对指定的碰撞模型进行 $\\,N\\,$ 步迭代，并计算密度的最终漂移（$\\,\\Delta \\rho = \\rho_N - \\rho_0\\,$）和速度分量的最终漂移（$\\,\\Delta u_x = u_{x,N} - u_{x,0}\\,$，$\\,\\Delta u_y = u_{y,N} - u_{y,0}\\,$）。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the LBM round-off error problem by simulating collision steps\n    for different models and precisions.\n    \"\"\"\n    # Test cases as specified in the problem statement.\n    test_cases = [\n        {'model': 'mrt', 'tau': 0.8, 'N': 100000, 'epsilon': 1e-7, 'precision': np.float32, 'mitigation': False},\n        {'model': 'mrt', 'tau': 0.8, 'N': 100000, 'epsilon': 1e-7, 'precision': np.float64, 'mitigation': False},\n        {'model': 'mrt', 'tau': 0.8, 'N': 100000, 'epsilon': 1e-7, 'precision': np.float32, 'mitigation': True},\n        {'model': 'bgk', 'tau': 0.8, 'N': 100000, 'epsilon': 1e-7, 'precision': np.float32, 'mitigation': False},\n        {'model': 'mrt', 'tau': 0.6, 'N': 200000, 'epsilon': 1e-7, 'precision': np.float32, 'mitigation': False},\n    ]\n\n    # D2Q9 lattice constants (defined with high precision first)\n    C_base = np.array([[0, 0], [1, 0], [0, 1], [-1, 0], [0, -1], [1, 1], [-1, 1], [-1, -1], [1, -1]], dtype=np.float64)\n    W_base = np.array([4/9, 1/9, 1/9, 1/9, 1/9, 1/36, 1/36, 1/36, 1/36], dtype=np.float64)\n\n    # D2Q9 MRT transformation matrix (d'Humières/Lallemand-Luo basis)\n    M_base = np.array([\n        [ 1,  1,  1,  1,  1,  1,  1,  1,  1],\n        [-4, -1, -1, -1, -1,  2,  2,  2,  2],\n        [ 4, -2, -2, -2, -2,  1,  1,  1,  1],\n        [ 0,  1,  0, -1,  0,  1, -1, -1,  1],\n        [ 0, -2,  0,  2,  0,  1, -1, -1,  1],\n        [ 0,  0,  1,  0, -1,  1,  1, -1, -1],\n        [ 0,  0, -2,  0,  2,  1,  1, -1, -1],\n        [ 0,  1, -1,  1, -1,  0,  0,  0,  0],\n        [ 0,  0,  0,  0,  0,  1, -1,  1, -1]\n    ], dtype=np.float64)\n    M_inv_base = np.linalg.inv(M_base)\n\n    def calculate_feq(rho, u, C, W):\n        \"\"\"Calculates the equilibrium distribution functions f_eq.\"\"\"\n        cu = C @ u\n        u_sq = u @ u\n        feq = W * rho * (1 + 3 * cu + 4.5 * cu**2 - 1.5 * u_sq)\n        return feq\n\n    def calculate_meq(rho, u, DTYPE):\n        \"\"\"Calculates the equilibrium moments m_eq.\"\"\"\n        ux, uy = u\n        ux2, uy2 = ux**2, uy**2\n        u2 = ux2 + uy2\n        \n        meq = np.zeros(9, dtype=DTYPE)\n        meq[0] = rho\n        meq[1] = -2*rho + 3*rho*u2\n        meq[2] = rho - 3*rho*u2\n        meq[3] = rho*ux\n        meq[4] = -rho*ux\n        meq[5] = rho*uy\n        meq[6] = -rho*uy\n        meq[7] = rho*(ux2 - uy2)\n        meq[8] = rho*ux*uy\n        return meq\n\n    results = []\n    \n    for case in test_cases:\n        model = case['model']\n        tau = case['tau']\n        N = case['N']\n        epsilon = case['epsilon']\n        DTYPE = case['precision']\n        mitigation = case['mitigation']\n        \n        omega = 1.0 / tau\n\n        # Cast constants to the specified precision for the current case\n        C = C_base.astype(DTYPE)\n        W = W_base.astype(DTYPE)\n        M = M_base.astype(DTYPE)\n        M_inv = M_inv_base.astype(DTYPE)\n        \n        # Initial conditions\n        rho0 = DTYPE(1.0)\n        u0 = np.array([1e-3, -2e-3], dtype=DTYPE)\n        \n        # Initial populations at equilibrium + perturbation\n        f = calculate_feq(rho0, u0, C, W)\n        perturbation = np.zeros(9, dtype=DTYPE)\n        perturbation[0] = DTYPE(-2.0 * epsilon)\n        perturbation[1] = DTYPE(epsilon)\n        perturbation[3] = DTYPE(epsilon)\n        f += perturbation\n\n        # MRT relaxation matrix S (as a vector for element-wise multiplication)\n        S = np.full(9, omega, dtype=DTYPE)\n        S[0] = S[3] = S[5] = 0.0 # Conserved moments\n\n        # Main simulation loop\n        for _ in range(N):\n            if model == 'bgk':\n                rho = np.sum(f)\n                u = (f @ C) / rho\n                feq = calculate_feq(rho, u, C, W)\n                f = f - DTYPE(omega) * (f - feq)\n            \n            elif model == 'mrt':\n                if mitigation:\n                    # Enforce conservation before relaxation\n                    rho_exact = np.sum(f)\n                    j_exact = f @ C\n                    \n                    m = M @ f\n                    m[0] = rho_exact\n                    m[3] = j_exact[0]\n                    m[5] = j_exact[1]\n                else:\n                    m = M @ f\n\n                # Use macroscopic variables from moment space for consistency\n                rho_m = m[0]\n                # Avoid division by zero, although not expected here\n                if np.abs(rho_m)  DTYPE(1e-30): rho_m = DTYPE(1.0)\n                u_m = np.array([m[3], m[5]], dtype=DTYPE) / rho_m\n                \n                meq = calculate_meq(rho_m, u_m, DTYPE)\n                m_post = m - S * (m - meq)\n                f = M_inv @ m_post\n\n        # Final macroscopic properties\n        rho_N = np.sum(f)\n        u_N = (f @ C) / rho_N\n\n        # Calculate and store drifts\n        delta_rho = rho_N - rho0\n        delta_u = u_N - u0\n        \n        results.extend([delta_rho, delta_u[0], delta_u[1]])\n\n    # Print results in the required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}