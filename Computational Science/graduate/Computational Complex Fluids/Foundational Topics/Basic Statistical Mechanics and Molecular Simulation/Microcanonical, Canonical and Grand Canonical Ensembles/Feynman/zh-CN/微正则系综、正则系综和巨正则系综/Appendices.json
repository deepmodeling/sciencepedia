{
    "hands_on_practices": [
        {
            "introduction": "该实践是经典统计力学的基石之一。通过在微正则系综中从第一性原理推导萨克-特特若德方程（Sackur-Tetrode equation），您将直接把相空间体积这一微观概念与理想气体的宏观熵联系起来，并在此过程中论证用于处理不可分辨粒子的关键吉布斯修正因子的合理性。",
            "id": "2650653",
            "problem": "考虑一个经典的、非相对论性的、单原子理想气体，由 $N$ 个质量为 $m$ 的相同粒子组成，被限制在体积为 $V$ 的容器中，总能量固定为 $E$，且无外场。完全在微正则系综的框架内进行分析。从经典哈密顿力学的第一性原理和微正则熵的定义出发。将相空间视为 $6N$ 维，坐标为 $(\\mathbf{q},\\mathbf{p})$，并使用刘维尔测度。使用普朗克常数 $h$ 进行标准粗粒化，以使微观状态数无量纲化。\n\n(a) 请仔细论证在经典微观状态计数中出现不可区分性因子 $1/N!$ 的原因，理由是粒子置换导致的重复计数。你的论证应基于相空间的结构和在置换群下的对称性，并且应通过解释为什么移除两个处于相同内涵变量的相同气体子系统之间的隔板不会产生熵增来解决吉布斯佯谬。\n\n(b) 使用微正则熵的定义 $S = k_{\\mathrm{B}} \\ln \\Omega$，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数，$\\Omega$ 是在固定能量 $E$ 下可及微观状态的适当计数，推导该系统熵 $S(E,V,N)$ 的显式闭合表达式。你必须：\n- 从经典哈密顿量 $H = \\sum_{i=1}^{N} \\mathbf{p}_{i}^{2}/(2m)$ 出发。\n- 进行完整的相空间积分，以获得用 $E$, $V$, $N$, $m$ 和 $h$ 表示的能量壳层测度。\n- 根据 (a) 部分的论证，使用因子 $1/N!$ 来处理不可区分性。\n- 对于 $N \\gg 1$ 的情况，一致地使用斯特林型渐近展开，并仅忽略阶数小于 $N$ 的次广延性修正项（例如，像 $\\ln N$ 这样的项）。明确说明在何处舍弃了这些项。\n\n将你的最终答案以一个仅包含 $E$, $V$, $N$, $m$, $h$ 和 $k_{\\mathrm{B}}$ 的单一闭合表达式形式给出。最终的方框答案中不要包含任何中间表达式或方程。不需要进行数值计算或四舍五入。",
            "solution": "所述问题在科学上是合理的、提法恰当且客观的。它展示了经典统计力学中一个标准的、基础的推导。所有必要的物理参数和数学约束都已提供。因此，该问题是有效的，将提供解答。\n\n(a) 不可区分性因子的论证与吉布斯佯谬的解决\n\n系统的微观状态由 $6N$ 维相空间中的一个点 $(\\mathbf{q}, \\mathbf{p}) = (\\mathbf{q}_1, \\ldots, \\mathbf{q}_N, \\mathbf{p}_1, \\ldots, \\mathbf{p}_N)$ 定义。系统的哈密顿量 $H = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_{i}^{2}}{2m}$ 对于粒子指标的置换是对称的。这意味着如果我们交换粒子 $i$ 和粒子 $j$ 的坐标和动量，系统的能量保持不变。\n\n如果这 $N$ 个粒子是可区分的，那么由相空间点 $(\\ldots, \\mathbf{q}_i, \\mathbf{p}_i, \\ldots, \\mathbf{q}_j, \\mathbf{p}_j, \\ldots)$ 描述的状态将与状态 $(\\ldots, \\mathbf{q}_j, \\mathbf{p}_j, \\ldots, \\mathbf{q}_i, \\mathbf{p}_i, \\ldots)$ 在物理上是不同的。对于给定的一组 $N$ 个位置和动量矢量，有 $N!$ 种方式将这些矢量分配给 $N$ 个可区分的粒子。对于可区分粒子，经典的相空间体积计算将这 $N!$ 个置换计为不同的微观状态。\n\n然而，量子力学的基本原理规定，全同粒子是真正不可区分的。一个物理状态完全由被占据的单粒子态的集合来规定，而不是由哪个粒子占据哪个态来规定。交换两个全同粒子不会产生新的物理状态。经典框架必须进行修正以与这一事实保持一致，因为经典统计力学应作为量子统计力学的极限而出现。这个修正，被称为吉布斯修正，是将经典计数的总状态数除以 $N!$，该因子代表了 $N$ 个全同粒子之间的置换数。这个除法纠正了对物理上相同的状态的重复计数。\n\n这个修正对于解决吉布斯佯谬至关重要。考虑一个体积为 $2V$ 的容器被一个隔板分成两个相等的部分，每部分体积为 $V$。每一半都包含有 $N$ 个粒子和能量为 $E$ 的相同理想气体，这意味着它们处于相同的温度和压强。移除隔板前系统的总熵为 $S_{initial} = S(E,V,N) + S(E,V,N) = 2S(E,V,N)$。\n\n如果我们忽略 $1/N!$ 因子，熵就不具有广延性。例如，它将包含一个与 $N k_{\\mathrm{B}} \\ln V$ 成正比的项。初始熵将为 $S_{initial} \\propto 2(N k_{\\mathrm{B}} \\ln V)$。移除隔板后，我们得到一个包含 $2N$ 个粒子、体积为 $2V$ 的单一系统。最终熵将为 $S_{final} \\propto (2N) k_{\\mathrm{B}} \\ln(2V)$。熵变，即混合熵，将是 $\\Delta S = S_{final} - S_{initial} \\propto (2N)k_{\\mathrm{B}}\\ln(2V) - 2Nk_{\\mathrm{B}}\\ln(V) = 2Nk_{\\mathrm{B}}\\ln(2) > 0$。这意味着对于一个宏观上可逆且没有净变化发生的过程，熵会自发增加。这就是佯谬所在。\n\n当正确地包含 $1/N!$ 因子时，熵成为一个广延量。如下文将推导的，熵具有形式 $S(E,V,N) = N k_{\\mathrm{B}} f(E/N, V/N)$，其中函数 $f$ 的自变量仅包含内涵变量。具体来说，它包含一个项 $N k_{\\mathrm{B}} \\ln(V/N)$。\n初始熵为 $S_{initial} = 2 S(E,V,N)$。\n最终状态有 $2N$ 个粒子，体积为 $2V$，能量为 $2E$。其熵为 $S_{final} = S(2E, 2V, 2N)$。\n因为现在熵是广延的，所以 $S(\\lambda E, \\lambda V, \\lambda N) = \\lambda S(E, V, N)$。令 $\\lambda=2$，我们发现 $S_{final} = 2S(E,V,N)$。\n熵变为 $\\Delta S = S_{final} - S_{initial} = 2S(E,V,N) - 2S(E,V,N) = 0$。这个正确的结果 $\\Delta S=0$ 解决了吉布斯佯谬，证实了在相同内涵状态下混合全同气体是一个熵不变的可逆过程。\n\n(b) 熵表达式的推导\n\n我们从微正则熵的定义 $S = k_{\\mathrm{B}} \\ln \\Omega$ 开始，其中 $\\Omega$ 是可及微观状态的数量。对于一个经典系统，这与可及相空间的体积有关。哈密顿量为 $H = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_{i}^{2}}{2m}$。\n状态数是通过在与总能量 $E$ 一致的相空间区域上积分来计算的，并使用普朗克常数 $h$ 使结果无量纲化。我们用 $1/N!$ 因子来考虑不可区分性。我们首先计算能量小于或等于 $E$ 的状态的相空间体积 $\\Phi(E)$：\n$$ \\Phi(E) = \\frac{1}{N! h^{3N}} \\int_{H \\leq E} d^{3N}q \\, d^{3N}p $$\n由于哈密顿量不依赖于位置坐标 $\\mathbf{q}_i$，对空间坐标的积分就是容器体积的 $N$ 次方：\n$$ \\int d^{3N}q = \\left( \\int_V d^3q \\right)^N = V^N $$\n动量积分的区域是 $\\sum_{i=1}^{N} \\mathbf{p}_{i}^{2} \\leq 2mE$。这对应于动量空间中半径为 $R_p = \\sqrt{2mE}$ 的一个 $3N$ 维超球体的体积。一个半径为 $R$ 的 $d$ 维超球体的体积由 $V_d(R) = \\frac{\\pi^{d/2}}{\\Gamma(d/2 + 1)} R^d$ 给出。\n在我们的情况下，维度是 $d = 3N$。可及动量空间的体积为：\n$$ \\int_{\\sum \\mathbf{p}_i^2 \\le 2mE} d^{3N}p = \\frac{\\pi^{3N/2}}{\\Gamma(\\frac{3N}{2} + 1)} (2mE)^{3N/2} $$\n结合这些结果，累积相空间体积为：\n$$ \\Phi(E) = \\frac{V^N}{N! h^{3N}} \\frac{\\pi^{3N/2}}{\\Gamma(\\frac{3N}{2} + 1)} (2mE)^{3N/2} = \\frac{V^N}{N! h^{3N}} \\frac{(2\\pi mE)^{3N/2}}{\\Gamma(\\frac{3N}{2} + 1)} $$\n微观状态数 $\\Omega(E)$ 严格来说是一个薄能量壳层的体积，$\\Omega(E) = (\\frac{\\partial \\Phi}{\\partial E})\\delta E$。然而，对于 $N \\gg 1$，函数 $\\Phi(E) \\propto E^{3N/2}$ 增长得非常快，所以绝大多数状态都位于能量 $E$ 的表面附近。使用 $S = k_{\\mathrm{B}} \\ln(\\Phi(E))$ 计算的熵与使用 $S = k_{\\mathrm{B}} \\ln(\\Omega(E))$ 计算的熵相差 $k_{\\mathrm{B}} \\ln N$ 数量级的项。问题陈述允许忽略此类次广延性修正。因此我们继续使用 $S \\approx k_{\\mathrm{B}} \\ln(\\Phi(E))$ 进行计算。\n$$ \\frac{S}{k_{\\mathrm{B}}} = \\ln\\left[ \\frac{V^N (2\\pi mE)^{3N/2}}{N! h^{3N} \\Gamma(\\frac{3N}{2} + 1)} \\right] $$\n$$ \\frac{S}{k_{\\mathrm{B}}} = N \\ln V + \\frac{3N}{2}\\ln(2\\pi mE) - \\ln(N!) - 3N \\ln h - \\ln\\Gamma\\left(\\frac{3N}{2} + 1\\right) $$\n对于大的 $N$，我们使用斯特林近似 $\\ln(x!) \\approx x \\ln x - x$。这也适用于伽马函数，因为 $\\ln\\Gamma(x+1) = \\ln(x!)$。\n$$ \\ln(N!) \\approx N \\ln N - N $$\n$$ \\ln\\Gamma\\left(\\frac{3N}{2} + 1\\right) \\approx \\frac{3N}{2} \\ln\\left(\\frac{3N}{2}\\right) - \\frac{3N}{2} $$\n将这些近似代入熵的表达式中：\n$$ \\frac{S}{k_{\\mathrm{B}}} \\approx N \\ln V + \\frac{3N}{2}\\ln(2\\pi mE) - (N \\ln N - N) - 3N \\ln h - \\left(\\frac{3N}{2} \\ln\\left(\\frac{3N}{2}\\right) - \\frac{3N}{2}\\right) $$\n我们现在对各项进行分组：\n$$ \\frac{S}{k_{\\mathrm{B}}} \\approx N \\ln V - N \\ln N + \\frac{3N}{2} \\ln E - \\frac{3N}{2} \\ln N + N + \\frac{3N}{2} + \\frac{3N}{2} \\ln(2\\pi m) - 3N \\ln h - \\frac{3N}{2} \\ln\\left(\\frac{3}{2}\\right) $$\n$$ \\frac{S}{k_{\\mathrm{B}}} \\approx N \\ln\\left(\\frac{V}{N}\\right) + \\frac{3N}{2}\\ln\\left(\\frac{E}{N}\\right) + \\frac{5N}{2} + \\frac{3N}{2} \\left[ \\ln(2\\pi m) - 2 \\ln h - \\ln\\left(\\frac{3}{2}\\right) \\right] $$\n$$ \\frac{S}{k_{\\mathrm{B}}} \\approx N \\left[ \\ln\\left(\\frac{V}{N}\\right) + \\frac{3}{2}\\ln\\left(\\frac{E}{N}\\right) + \\frac{3}{2} \\ln\\left(\\frac{2\\pi m \\cdot 2}{3 h^2}\\right) + \\frac{5}{2} \\right] $$\n$$ \\frac{S}{k_{\\mathrm{B}}} \\approx N \\left[ \\ln\\left(\\frac{V}{N}\\right) + \\frac{3}{2}\\ln\\left(\\frac{E}{N}\\right) + \\frac{3}{2} \\ln\\left(\\frac{4\\pi m}{3h^2}\\right) + \\frac{5}{2} \\right] $$\n最后，我们将对数项合并到一个参数中，以获得闭合形式的表达式，即萨克-特特若德方程：\n$$ S = N k_{\\mathrm{B}} \\left[ \\ln\\left(\\frac{V}{N}\\right) + \\ln\\left(\\left(\\frac{E}{N}\\right)^{3/2}\\right) + \\ln\\left(\\left(\\frac{4\\pi m}{3h^2}\\right)^{3/2}\\right) + \\frac{5}{2} \\right] $$\n$$ S = N k_{\\mathrm{B}} \\left[ \\ln\\left( \\frac{V}{N} \\left(\\frac{4\\pi m E}{3N h^2}\\right)^{3/2} \\right) + \\frac{5}{2} \\right] $$\n如 (a) 部分所示，这个熵的表达式是严格广延的。所有 $\\ln N$ 阶及更低的次广延性项都已通过使用斯特林近似被系统地舍弃，符合题目要求。",
            "answer": "$$ \\boxed{ N k_{\\mathrm{B}} \\left[ \\ln\\left( \\frac{V}{N} \\left( \\frac{4\\pi m E}{3N h^2} \\right)^{3/2} \\right) + \\frac{5}{2} \\right] } $$"
        },
        {
            "introduction": "有限系统中的相变展现出与热力学极限下的急剧相变不同的迷人行为。本计算练习旨在探索一级相变的微正则系综特征——即热容曲线的“回弯”现象（back-bending）——及其与正则系综中双峰能量分布的直接对应关系，从而让您亲手体验不同系综间的等价性。",
            "id": "4093860",
            "problem": "考虑一个有限的复杂流体系统，其能量网格 $E \\in [E_{\\min},E_{\\max}]$ 是离散的，并且其微正则态密度 $\\Omega(E)$ 有一个指定的模型。在约化单位下，定义微正则熵为 $S(E) = k_{\\mathrm{B}} \\ln \\Omega(E)$，其中玻尔兹曼常数 $k_{\\mathrm{B}} = 1$。微正则温度 $T(E)$ 由基本微正则关系 $1/T(E) = \\partial S(E)/\\partial E$ 定义，其中粒子数和体积固定。在正则系综 (CE) 中，逆温为 $\\beta$ 时的能量分布为 $P_{\\beta}(E) \\propto \\Omega(E) \\exp(-\\beta E)$，正则配分函数为 $Z(\\beta) = \\int \\Omega(E) \\exp(-\\beta E)\\,dE$，您应通过离散能量网格上的黎曼和来近似此积分。在有限系统中，微正则热容曲线 $T(E)$ 中出现的回弯现象表明存在一级相变。您的任务是，完全基于上述基本定义，不引入任何简化公式，通过数学推导和计算验证来检测回弯的诊断方法。所有量都将以约化单位计算和报告（即，能量和温度是无量纲的，且 $k_{\\mathrm{B}}=1$），此处不涉及任何角度度量。\n\n您将实现一个程序，对于每个给定的 $\\Omega(E)$ 测试用例，该程序将构建 $S(E)$，计算 $T(E)$ 及其能量导数，并提出和评估指示有限系统中一级相变的诊断方法。您必须：\n- 从 $S(E)$、$T(E)$ 和 $P_{\\beta}(E)$ 的定义出发，推导一个诊断标准，该标准能从 $T(E)$ 的形状中标记出回弯现象，并用 $S(E)$ 的导数表示。\n- 根据您的推导，确定一个用于判断负微正则热容的严格诊断方法，并在其有定义且指示回弯的能量网格上，计算其最负值。以约化单位（能量/温度）的浮点数形式报告此最负值。\n- 基于微正则系综和正则系综通过勒让德变换的等价性，定义一个基于 $P_{\\beta}(E)$ 多峰性的正则诊断方法。在逆温 $\\beta$ 下构建正则 $P_{\\beta}(E)$，该逆温 $\\beta$ 由 $S(E)$ 空间中回弯区间端点之间的斜率确定，并以布尔值的形式报告 $P_{\\beta}(E)$ 是否为双峰（两个不同的局域极大值）。\n\n在数值上，使用能量网格 $E$ 上的中心有限差分来近似 $\\partial S/\\partial E$ 和 $\\partial^2 S/\\partial E^2$。将注意力限制在 $T(E)$ 为正的能量上，并仔细处理分母为零的情况以避免数值不稳定。对于正则多峰性，通过比较网格上的相邻值来搜索离散 $P_{\\beta}(E)$ 的局域极大值。如果未找到回弯区间，则将正则多峰性诊断设置为 false，并将报告的负微正则热容最负值设置为 $0$。\n\n测试套件：使用一个在 $[0,400]$ 上有 $N=401$ 个点的能量网格 $E$。通过其熵定义以下三个测试态密度作为 $E$ 的函数，然后相应地计算 $\\Omega(E)$（约化单位，其中 $k_{\\mathrm{B}} = 1$）：\n1. 混合情况（预期出现回弯）：$S(E) = \\ln\\!\\big(\\exp(S_1(E)) + \\exp(S_2(E))\\big)$，其中\n   $S_1(E) = a_1 E - \\dfrac{(E-\\mu_1)^2}{2\\sigma_1^2} + c_1$ 和 $S_2(E) = a_2 E - \\dfrac{(E-\\mu_2)^2}{2\\sigma_2^2} + c_2$，\n   参数为 $a_1 = 0.020$，$\\mu_1 = 110$，$\\sigma_1 = 60$，$c_1 = 0.0$，以及 $a_2 = 0.012$，$\\mu_2 = 290$，$\\sigma_2 = 80$，$c_2 = 1.0$。\n2. 单相情况（预期无回弯）：$S(E) = S_1(E)$，参数为 $a = 0.018$，$\\mu = 200$，$\\sigma = 90$，$c = 0.0$。\n3. 弱混合情况（临界状态，可能无回弯）：$S(E) = \\ln\\!\\big(\\exp(S_1(E)) + \\exp(S_2(E))\\big)$，其中\n   $S_1(E)$ 的参数为 $a_1 = 0.018$，$\\mu_1 = 200$，$\\sigma_1 = 70$，$c_1 = 0.0$，$S_2(E)$ 的参数为 $a_2 = 0.0175$，$\\mu_2 = 240$，$\\sigma_2 = 70$，$c_2 = -2.0$。\n\n对于每个测试用例，按以下顺序计算并返回一个包含三个结果的三元组：\n- 一个布尔值，指示是否存在回弯（如果存在一个 $E$ 的区间，在该区间内 $T(E)$ 为正且随 $E$ 减小，则为 true）。\n- 一个浮点数，等于在 $T(E)$ 为正且诊断方法有定义的能量网格上，微正则热容的最负值（如果没有找到负值，则使用 $0$）。\n- 一个布尔值，指示在由检测到的回弯区间端点之间的斜率设定的逆温下，正则能量分布 $P_{\\beta}(E)$ 是否为双峰；如果未找到回弯区间，则报告 false。\n\n您的程序应生成一行输出，其中包含三个测试用例的结果，格式为逗号分隔的三个三元组列表，并用方括号括起来，例如“[[b1,f1,b2],[b3,f3,b4],[b5,f5,b6]]”，其中每个 $b_i$ 是一个布尔值，每个 $f_i$ 是一个浮点数。所有能量和温度都使用约化单位，任何浮点数都应以标准十进制形式打印，不带任何单位符号。不应打印其他任何文本。",
            "solution": "该问题要求我们推导并计算验证用于判断有限系统中一级相变的诊断方法，其标志为微正则热容曲线 $T(E)$ 中出现的回弯现象。我们已知微正则熵 $S(E)$、温度 $T(E)$ 和正则概率分布 $P_{\\beta}(E)$ 的基本定义。所有计算都将在玻尔兹曼常数 $k_{\\mathrm{B}}=1$ 的约化单位下进行。\n\n对于每个测试用例，我们的方法包括三个主要步骤：\n1.  基于微正则熵 $S(E)$ 的导数，推导一个用于判断回弯的诊断方法。\n2.  从此推导出微正则热容 $C_V(E)$ 的表达式，并将其最负值作为相变的定量度量。\n3.  通过在与回弯区域相关的特定逆温 $\\beta_{\\text{trans}}$ 下检查能量分布 $P_{\\beta}(E)$ 的峰态，建立一个正则系综的诊断方法。\n\n**1. 微正则诊断：回弯与负热容**\n\n微正则温度 $T(E)$ 由基本关系定义：\n$$\n\\frac{1}{T(E)} = \\frac{\\partial S(E)}{\\partial E}\n$$\n假设系统具有物理意义上的正温度，$T(E) > 0$，则必须有 $\\frac{\\partial S(E)}{\\partial E} > 0$。我们可以将温度表示为 $T(E) = \\left(\\frac{\\partial S}{\\partial E}\\right)^{-1}$。\n\n热容曲线中的回弯指的是温度随能量增加而减小的区域，即 $\\frac{dT(E)}{dE}  0$。为了找到这个条件，我们使用链式法则对 $T(E)$ 求关于 $E$ 的导数：\n$$\n\\frac{dT}{dE} = \\frac{d}{dE} \\left( \\left( \\frac{\\partial S}{\\partial E} \\right)^{-1} \\right) = -1 \\left( \\frac{\\partial S}{\\partial E} \\right)^{-2} \\left( \\frac{\\partial^2 S}{\\partial E^2} \\right)\n$$\n由于我们处于 $T(E) > 0$ 的区域，因此 $\\frac{\\partial S}{\\partial E} > 0$。所以，项 $-\\left(\\frac{\\partial S}{\\partial E}\\right)^{-2}$ 必然为负。因此，$\\frac{dT}{dE}$ 的符号与熵的二阶导数 $\\frac{\\partial^2 S}{\\partial E^2}$ 的符号相反。\n$$\n\\frac{dT}{dE}  0 \\quad \\iff \\quad \\frac{\\partial^2 S}{\\partial E^2} > 0\n$$\n物理上，典型宏观系统的熵是能量的凹函数（$\\frac{\\partial^2 S}{\\partial E^2}  0$）。条件 $\\frac{\\partial^2 S}{\\partial E^2} > 0$ 表明熵函数存在一个局域凸性区域，通常称为“凸性闯入”（convex intruder）。这种局域凸性是有限系统中类一级相变的微正则特征。因此，我们用于判断回弯的第一个诊断方法是，存在一个能量区间，在此区间内 $\\frac{\\partial S}{\\partial E} > 0$ 且 $\\frac{\\partial^2 S}{\\partial E^2} > 0$。\n\n接下来，我们考虑微正则热容，其定义为 $C_V(E) = \\frac{dE}{dT} = \\left(\\frac{dT}{dE}\\right)^{-1}$。代入我们关于 $\\frac{dT}{dE}$ 的表达式：\n$$\nC_V(E) = \\frac{1}{-\\left(\\frac{\\partial S}{\\partial E}\\right)^{-2} \\left(\\frac{\\partial^2 S}{\\partial E^2}\\right)} = - \\frac{\\left(\\frac{\\partial S}{\\partial E}\\right)^2}{\\frac{\\partial^2 S}{\\partial E^2}}\n$$\n从这个表达式可以明显看出，当且仅当 $\\frac{\\partial^2 S}{\\partial E^2} > 0$ 时，$C_V(E)$ 为负（因为分子 $\\left(\\frac{\\partial S}{\\partial E}\\right)^2$ 是正的）。因此，回弯区域恰好是微正则热容为负的区域。我们的第二个诊断方法是计算该区域内 $C_V(E)$ 的最负值。如果不存在这样的区域，则该值取为 $0$。\n\n**2. 正则诊断：双峰能量分布**\n\n在正则系综中，一级相变的特征是在相变温度 $T_{\\text{trans}} = 1/\\beta_{\\text{trans}}$ 下发生相共存。这表现为双峰能量概率分布 $P_{\\beta_{\\text{trans}}}(E)$，其两个峰对应于共存的两个相（例如，液相和气相）。在逆温为 $\\beta$ 时，观察到系统能量为 $E$ 的概率由下式给出：\n$$\nP_{\\beta}(E) \\propto \\Omega(E) e^{-\\beta E}\n$$\n使用熵的定义 $S(E) = \\ln \\Omega(E)$（其中 $k_{\\mathrm{B}}=1$），我们可以将其写为：\n$$\nP_{\\beta}(E) \\propto e^{S(E) - \\beta E}\n$$\n在微正则系综中导致回弯的 $S(E)$ 中的凸性闯入，对应于正则系综中的相共存区域。问题指定，相关的逆温 $\\beta_{\\text{trans}}$ 应由连接 $S(E)$ 曲线上回弯区间端点的弦的斜率来确定。设回弯区域从能量 $E_a$ 延伸至 $E_b$。那么，$\\beta_{\\text{trans}}$ 由一个类麦克斯韦构造给出：\n$$\n\\beta_{\\text{trans}} = \\frac{S(E_b) - S(E_a)}{E_b - E_a}\n$$\n我们的第三个诊断方法是构建分布 $P_{\\beta_{\\text{trans}}}(E)$ 并确定它是否是双峰的，即是否恰好有两个不同的局域极大值。如果不存在回弯区间，则此诊断报告为 false。\n\n**3. 计算策略**\n\n对于每个给定的熵函数 $S(E)$：\n1.  在指定的网格 $E \\in [0, 400]$ 上用 $N=401$ 个点将能量离散化。\n2.  计算网格点上的熵值数组 $S$。对于混合情况，使用数值稳定的 log-sum-exp 公式，即 $\\ln(e^x + e^y) = \\max(x, y) + \\ln(1 + e^{-|x-y|})$，以防止溢出。\n3.  使用离散网格上的中心有限差分，数值计算一阶和二阶导数 $\\frac{\\partial S}{\\partial E}$ 和 $\\frac{\\partial^2 S}{\\partial E^2}$。\n4.  通过找到所有满足 $\\frac{\\partial S}{\\partial E} > 0$ 和 $\\frac{\\partial^2 S}{\\partial E^2} > 0$ 的网格点来识别回弯区域。\n5.  如果该区域非空，则检测到回弯。然后计算该区域内 $C_V(E)$ 的最负值。确定端点 $(E_a, S(E_a))$ 和 $(E_b, S(E_b))$ 以计算 $\\beta_{\\text{trans}}$。构建正则分布 $P_{\\beta_{\\text{trans}}}(E)$，并通过比较相邻值来计算其局域极大值的数量。如果数量为二，则分布是双峰的。\n6.  如果回弯区域为空，我们报告没有回弯，热容为 $0$，并且没有双峰性。\n\n这个直接基于统计力学基本原理的程序，能够对相变诊断方法进行稳健的验证。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function that orchestrates the analysis for all test cases.\n    \"\"\"\n\n    def S_model(E, a, mu, sigma, c):\n        \"\"\"Standard model for the entropy of a single phase.\"\"\"\n        return a * E - np.power(E - mu, 2) / (2 * sigma**2) + c\n\n    def solve_case(S_func, E_grid):\n        \"\"\"\n        Analyzes a single case defined by an entropy function and an energy grid.\n        Derives and computes diagnostics for a first-order phase transition.\n        \"\"\"\n        E = E_grid\n        S = S_func(E)\n        h = E[1] - E[0]\n\n        # Use np.gradient for robust numerical differentiation (central differences)\n        dS_dE = np.gradient(S, h)\n        d2S_dE2 = np.gradient(dS_dE, h)\n\n        # Diagnostic 1: Back-bending presence.\n        # dT/dE  0 is equivalent to d2S/dE2 > 0 for T > 0 (i.e., dS/dE > 0).\n        # Use a small tolerance to avoid floating point issues near zero.\n        positive_dS_dE_mask = dS_dE > 1e-12\n        back_bending_mask = (d2S_dE2 > 1e-12)  positive_dS_dE_mask\n        back_bending_present = np.any(back_bending_mask)\n\n        # Initialize results to default values for the no-transition case.\n        most_negative_cv = 0.0\n        is_bimodal = False\n\n        if not back_bending_present:\n            return [False, 0.0, False]\n\n        # If back-bending is present, calculate the diagnostics.\n        \n        # Diagnostic 2: Most negative microcanonical heat capacity.\n        # C_V = - (dS/dE)^2 / (d2S/dE2).\n        # This is only computed in the back-bending region where the denominator is positive.\n        cv_in_region = -np.power(dS_dE[back_bending_mask], 2) / d2S_dE2[back_bending_mask]\n        most_negative_cv = np.min(cv_in_region)\n\n        # Diagnostic 3: Canonical bimodality.\n        # Find endpoints of the back-bending interval.\n        back_bending_indices = np.where(back_bending_mask)[0]\n        idx_a = back_bending_indices[0]\n        idx_b = back_bending_indices[-1]\n\n        # Ensure we have a valid interval to define the slope for beta.\n        if idx_a = idx_b:\n            return [back_bending_present, most_negative_cv, False]\n\n        E_a, S_a = E[idx_a], S[idx_a]\n        E_b, S_b = E[idx_b], S[idx_b]\n\n        # Calculate inverse temperature beta_trans from the chord slope.\n        beta_trans = (S_b - S_a) / (E_b - E_a)\n\n        # Construct the unnormalized canonical probability distribution.\n        # P(E) propto exp(S(E) - beta*E).  Working with the log is more stable.\n        log_P = S - beta_trans * E\n\n        # Find the number of local maxima by comparing with neighbors.\n        num_maxima = 0\n        for i in range(1, len(log_P) - 1):\n            if log_P[i]  log_P[i-1] and log_P[i]  log_P[i+1]:\n                num_maxima += 1\n        \n        is_bimodal = (num_maxima == 2)\n        \n        return [back_bending_present, float(most_negative_cv), is_bimodal]\n\n    # Define energy grid and test cases.\n    E_grid = np.linspace(0, 400, 401)\n    \n    # Numerically stable log-sum-exp: log(exp(x) + exp(y))\n    def log_sum_exp(x, y):\n        maximum = np.maximum(x, y)\n        return maximum + np.log(1 + np.exp(-np.abs(x - y)))\n\n    # Test Case 1: Mixture case (expected back-bending)\n    params1 = {'a': 0.020, 'mu': 110, 'sigma': 60, 'c': 0.0}\n    params2 = {'a': 0.012, 'mu': 290, 'sigma': 80, 'c': 1.0}\n    s1 = S_model(E_grid, **params1)\n    s2 = S_model(E_grid, **params2)\n    S_func1 = lambda E: log_sum_exp(S_model(E, **params1), S_model(E, **params2))\n    \n    # Test Case 2: Single-phase case (no back-bending expected)\n    params3 = {'a': 0.018, 'mu': 200, 'sigma': 90, 'c': 0.0}\n    S_func2 = lambda E: S_model(E, **params3)\n\n    # Test Case 3: Weak-mixture case (borderline)\n    params4 = {'a': 0.018, 'mu': 200, 'sigma': 70, 'c': 0.0}\n    params5 = {'a': 0.0175, 'mu': 240, 'sigma': 70, 'c': -2.0}\n    S_func3 = lambda E: log_sum_exp(S_model(E, **params4), S_model(E, **params5))\n\n    test_cases = [S_func1, S_func2, S_func3]\n    \n    results = []\n    for s_func in test_cases:\n        # We need to pass the array, not the lambda, to solve_case\n        # because the lambda needs the grid which is defined locally.\n        # It's better to pass the lambda and the grid.\n        result = solve_case(s_func, E_grid)\n        results.append(result)\n\n    # Format the final output string as specified.\n    # The default str() for a list includes spaces, which is fine.\n    # The default str() for a bool is capitalized (True/False), which should also be fine.\n    # The problem skeleton's formatter is `','.join(map(str, results))`.\n    formatted_results = []\n    for r in results:\n        # Manual formatting to match the example style: lowercase bool, no spaces.\n        b1_str = str(r[0]).lower()\n        f1_str = f\"{r[1]:.7f}\"  # A reasonable precision for floats\n        b2_str = str(r[2]).lower()\n        formatted_results.append(f\"[{b1_str},{f1_str},{b2_str}]\")\n\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "巨正则系综在模拟开放系统和提取热力学性质方面极为强大。本实践将演示如何利用涨落-耗散定理，通过分析巨正则系综模拟中的粒子数涨落来计算等温压缩系数（isothermal compressibility）和偏摩尔体积（partial molar volume）等关键响应函数，从而搭建起从微观涨落到宏观材料性质的桥梁。",
            "id": "4093890",
            "problem": "考虑一个由溶剂组分 $s$ 和聚合物组分 $p$ 组成的二元聚合物溶液。您在巨正则系综 (GCE) 中进行模拟，其中温度 $T$、体积 $V$ 以及化学势 $\\mu_s$ 和 $\\mu_p$ 是固定的，而粒子数 $N_s$ 和 $N_p$ 会发生涨落。巨正则配分函数 $\\Xi(T,V,\\mu_s,\\mu_p)$ 产生粒子数涨落，压强满足 $pV = k_B T \\ln \\Xi$。在 GCE 中，平均粒子数满足 $\\langle N_i \\rangle = \\frac{1}{\\beta} \\frac{\\partial \\ln \\Xi}{\\partial \\mu_i}$，其协方差满足 $\\langle \\Delta N_i \\Delta N_j \\rangle = \\frac{\\partial \\langle N_i \\rangle}{\\partial (\\beta \\mu_j)}$，其中 $\\beta = 1/(k_B T)$，$k_B$ 是玻尔兹曼常数。\n\n计算复杂流体领域的一个核心目标是直接从粒子数涨落数据中提取宏观热力学响应性质，例如等温压缩率 $\\kappa_T$ 和偏摩尔性质（如偏摩尔体积 $\\bar{v}_i$）。等温压缩率定义为 $\\kappa_T = -\\frac{1}{V} \\left( \\frac{\\partial V}{\\partial p} \\right)_{T,\\{N_i\\}}$，它是一个与系综无关的状态函数。在 GCE 中，$\\kappa_T$ 可与粒子数涨落相关联。对于混合物，设 $N_{\\mathrm{tot}} = N_s + N_p$，$\\boldsymbol{\\rho} = \\langle \\mathbf{N} \\rangle / V$（其中 $\\mathbf{N} = (N_s, N_p)^\\top$），并设 $C$ 为协方差矩阵 $C_{ij} = \\langle \\Delta N_i \\Delta N_j \\rangle$。等温压缩率可以表示为\n$$\n\\kappa_T = \\frac{\\mathrm{Var}(N_{\\mathrm{tot}})}{k_B T \\, V \\, \\rho_{\\mathrm{tot}}^2}\n$$\n其中 $\\mathrm{Var}(N_{\\mathrm{tot}}) = \\mathbf{1}^\\top C \\mathbf{1}$ 且 $\\rho_{\\mathrm{tot}} = \\rho_s + \\rho_p$。偏摩尔体积定义为 $\\bar{v}_i = \\left( \\frac{\\partial V}{\\partial N_i} \\right)_{T,p,N_{j\\neq i}}$。在恒温下，使用线性响应和吉布斯-杜亥姆关系，可将 GCE 粒子数涨落映射到偏摩尔体积，其计算方案如下：\n$$\nB = \\frac{C}{k_B T}, \\quad \\bar{\\mathbf{v}} = \\frac{B^{+} \\langle \\mathbf{N} \\rangle}{\\boldsymbol{\\rho}^\\top B^{+} \\langle \\mathbf{N} \\rangle}\n$$\n其中 $B^{+}$ 表示 摩尔-彭若斯伪逆，$\\bar{\\mathbf{v}} = (\\bar{v}_s, \\bar{v}_p)^\\top$。此公式返回的 $\\bar{v}_i$ 单位为 $\\mathrm{m}^3$/分子。\n\n您需要实现一个完整的、可运行的程序。该程序根据 GCE 模拟中 $(N_s,N_p)$ 的离散粒子数涨落直方图，计算 $\\kappa_T$ 以及偏摩尔体积 $\\bar{v}_s$ 和 $\\bar{v}_p$。使用在 $(N_s,N_p)$ 整数网格上求值的二元正态权重构建离散直方图，然后将其归一化为概率质量函数。请使用以下物理上合理的测试套件，其中每个案例提供以 $\\mathrm{K}$ 为单位的温度 $T$，以 $\\mathrm{m}^3$ 为单位的体积 $V$，均值向量 $m = (\\langle N_s \\rangle, \\langle N_p \\rangle)$，以及协方差矩阵\n$$\n\\Sigma = \\begin{pmatrix}\n\\sigma_s^2  \\sigma_{sp} \\\\\n\\sigma_{sp}  \\sigma_p^2\n\\end{pmatrix},\n$$\n以及 $N_s$ 和 $N_p$ 的网格范围：\n\n- 案例 1 (稀聚合物溶液):\n  - $T = 300$, $V = 1 \\times 10^{-21}$\n  - $m = (100, 1)$\n  - $\\sigma_s^2 = 50$, $\\sigma_p^2 = 0.8$, $\\sigma_{sp} = -0.5$\n  - $N_s \\in \\{90,91,\\dots,110\\}$, $N_p \\in \\{0,1,2,3,4,5\\}$\n\n- 案例 2 (半稀聚合物溶液):\n  - $T = 300$, $V = 2 \\times 10^{-21}$\n  - $m = (80, 20)$\n  - $\\sigma_s^2 = 60$, $\\sigma_p^2 = 15$, $\\sigma_{sp} = -8$\n  - $N_s \\in \\{60,61,\\dots,100\\}$, $N_p \\in \\{10,11,\\dots,30\\}$\n\n- 案例 3 (近理想混合物):\n  - $T = 300$, $V = 1 \\times 10^{-21}$\n  - $m = (50, 5)$\n  - $\\sigma_s^2 = 45$, $\\sigma_p^2 = 5$, $\\sigma_{sp} = 0$\n  - $N_s \\in \\{35,36,\\dots,65\\}$, $N_p \\in \\{0,1,\\dots,12\\}$\n\n- 案例 4 (极稀聚合物溶液，近奇异协方差):\n  - $T = 300$, $V = 5 \\times 10^{-22}$\n  - $m = (120, 0.2)$\n  - $\\sigma_s^2 = 70$, $\\sigma_p^2 = 0.2$, $\\sigma_{sp} = -0.1$\n  - $N_s \\in \\{100,101,\\dots,140\\}$, $N_p \\in \\{0,1,2\\}$\n\n对于每个案例：\n- 在指定的整数网格上构建离散直方图 $P(N_s,N_p) \\propto \\exp\\left(-\\frac{1}{2} (\\mathbf{N}-m)^\\top \\Sigma^{-1} (\\mathbf{N}-m)\\right)$，并将其归一化，使得 $\\sum_{N_s,N_p} P(N_s,N_p) = 1$。\n- 根据 $P(N_s,N_p)$ 计算样本均值向量 $\\langle \\mathbf{N} \\rangle$ 和协方差矩阵 $C$。\n- 计算密度向量 $\\boldsymbol{\\rho} = \\langle \\mathbf{N} \\rangle / V$ 和总密度 $\\rho_{\\mathrm{tot}} = \\rho_s + \\rho_p$。\n- 使用公式 $\\kappa_T = \\frac{\\mathbf{1}^\\top C \\mathbf{1}}{k_B T \\, V \\, \\rho_{\\mathrm{tot}}^2}$ 计算等温压缩率，并以 $\\mathrm{Pa}^{-1}$ 为单位，作为浮点数报告结果。\n- 使用公式 $\\bar{\\mathbf{v}} = \\frac{B^{+} \\langle \\mathbf{N} \\rangle}{\\boldsymbol{\\rho}^\\top B^{+} \\langle \\mathbf{N} \\rangle}$（其中 $B = C/(k_B T)$）计算偏摩尔体积向量，并以 $\\mathrm{nm}^3$/分子 为单位报告 $\\bar{v}_s$ 和 $\\bar{v}_p$，其中 $1\\,\\mathrm{nm}^3 = 10^{-27}\\,\\mathrm{m}^3$。\n\n物理单位要求：\n- 以 $\\mathrm{Pa}^{-1}$ 为单位报告 $\\kappa_T$。\n- 以 $\\mathrm{nm}^3$/分子 为单位报告 $\\bar{v}_s$ 和 $\\bar{v}_p$。\n\n您的程序必须生成单行输出，其中包含所有案例的结果，聚合为一个由方括号括起来的逗号分隔列表。对于每个案例，返回一个包含三个浮点数的列表，顺序为 $[\\kappa_T,\\bar{v}_s,\\bar{v}_p]$。因此，最终输出是一个包含四个此类列表的列表，例如 $[[x_1,y_1,z_1],[x_2,y_2,z_2],[x_3,y_3,z_3],[x_4,y_4,z_4]]$，其中每个 $x_i$、$y_i$ 和 $z_i$ 是案例 $i$ 对应的计算出的浮点数。",
            "solution": "问题已经过分析并被认为是有效的。其科学基础是开放系统的统计力学原理，特别是巨正则系综 (GCE)。所提供的将粒子数涨落与等温压缩率和偏摩尔体积等热力学响应函数联系起来的公式，是线性响应理论应用于流体混合物的标准结果。该问题设定良好，提供了所有必要的数据和清晰的、计算上可行的步骤。测试案例中给出的参数对于二元溶液的模拟是物理上合理的。\n\n目标是基于 GCE 模拟的粒子数涨落模型，计算二元混合物的等温压缩率 $\\kappa_T$ 和偏摩尔体积 $\\bar{v}_s$ 和 $\\bar{v}_p$。涨落数据由一个离散的概率质量函数 (PMF) 表示，该函数是根据指定粒子数 $(N_s, N_p)$ 整数网格上的二元正态分布构建的。\n\n计算需要用到玻尔兹曼常数 $k_B$，其取值为 $k_B = 1.380649 \\times 10^{-23} \\, \\mathrm{J} \\cdot \\mathrm{K}^{-1}$。\n\n每个测试案例的计算步骤如下：\n\n**1. 构建离散概率质量函数 (PMF)**\n对于每个案例，我们都给出了一个连续二元正态分布的参数：均值向量 $m = (\\langle N_s \\rangle_{in}, \\langle N_p \\rangle_{in})^\\top$ 和协方差矩阵 $\\Sigma$。我们还得到了粒子数 $N_s$ 和 $N_p$ 的整数网格范围。设粒子数向量为 $\\mathbf{N} = (N_s, N_p)^\\top$。\n\n首先，我们在指定范围内生成所有整数对 $(N_s, N_p)$ 的二维网格。对于此网格上的每个点 $\\mathbf{N}$，我们使用多元正态概率密度函数的形式计算一个未归一化的概率权重 $W(\\mathbf{N})$：\n$$\nW(\\mathbf{N}) = \\exp\\left(-\\frac{1}{2} (\\mathbf{N}-m)^\\top \\Sigma^{-1} (\\mathbf{N}-m)\\right)\n$$\n其中 $\\Sigma^{-1}$ 是给定协方差矩阵的逆矩阵。\n\n通过对这些权重进行归一化，使其在整个网格上的总和等于 $1$，即可获得离散 PMF $P(\\mathbf{N})$：\n$$\nP(\\mathbf{N}) = \\frac{W(\\mathbf{N})}{\\sum_{\\mathbf{N}' \\in \\text{grid}} W(\\mathbf{N}')}\n$$\n\n**2. 从 PMF 计算样本矩**\n使用计算出的 PMF，我们计算样本均值向量 $\\langle \\mathbf{N} \\rangle$ 和样本协方差矩阵 $C$。这些是离散分布的矩，由于有限网格对分布的离散化和截断，它们会与输入参数 $m$ 和 $\\Sigma$ 略有不同。\n\n均值向量的分量是作为每个粒子数的期望值计算的：\n$$\n\\langle N_i \\rangle = \\sum_{\\mathbf{N} \\in \\text{grid}} N_i P(\\mathbf{N})\n$$\n其中 $i \\in \\{s, p\\}$。\n\n协方差矩阵 $C$ 的元素由 $C_{ij} = \\langle (N_i - \\langle N_i \\rangle)(N_j - \\langle N_j \\rangle) \\rangle$ 给出，可计算为：\n$$\nC_{ij} = \\left( \\sum_{\\mathbf{N} \\in \\text{grid}} N_i N_j P(\\mathbf{N}) \\right) - \\langle N_i \\rangle \\langle N_j \\rangle\n$$\n对于 $i, j \\in \\{s, p\\}$。\n\n**3. 计算热力学性质 a. 等温压缩率 $\\kappa_T$**\n等温压缩率使用与总粒子数涨落相关的公式进行计算：\n$$\n\\kappa_T = \\frac{\\mathrm{Var}(N_{\\mathrm{tot}})}{k_B T V \\rho_{\\mathrm{tot}}^2}\n$$\n这里，$T$ 和 $V$ 是该案例给定的温度和体积。总数密度为 $\\rho_{\\mathrm{tot}} = (\\langle N_s \\rangle + \\langle N_p \\rangle) / V$。总粒子数的方差 $\\mathrm{Var}(N_{\\mathrm{tot}})$ 是协方差矩阵 $C$ 所有元素的总和：\n$$\n\\mathrm{Var}(N_{\\mathrm{tot}}) = \\mathrm{Var}(N_s+N_p) = C_{ss} + C_{pp} + 2C_{sp} = \\mathbf{1}^\\top C \\mathbf{1}\n$$\n其中 $\\mathbf{1} = (1, 1)^\\top$。将所有量以国际单位制（$k_B$ 单位为 $\\mathrm{J/K}$，$T$ 单位为 $\\mathrm{K}$，$V$ 单位为 $\\mathrm{m}^3$，$\\rho_{\\mathrm{tot}}$ 单位为 $\\mathrm{m}^{-3}$，且 $C$ 无量纲）代入，可得出单位为 $\\mathrm{Pa}^{-1}$ 的 $\\kappa_T$。\n\n**b. 偏摩尔体积 $\\bar{\\mathbf{v}}$**\n偏摩尔体积向量 $\\bar{\\mathbf{v}} = (\\bar{v}_s, \\bar{v}_p)^\\top$ 使用提供的矩阵公式计算。\n首先，我们定义矩阵 $B$：\n$$\nB = \\frac{C}{k_B T}\n$$\n接下来，我们计算 $B$ 的 摩尔-彭若斯伪逆，记为 $B^{+}$。这是一种鲁棒的方法，可以处理 $B$（以及 $C$）可能奇异或病态的情况，这在采样有限或存在强相关性时可能发生。\n\n然后，偏摩尔体积向量由以下公式给出：\n$$\n\\bar{\\mathbf{v}} = \\frac{B^{+} \\langle \\mathbf{N} \\rangle}{\\boldsymbol{\\rho}^\\top B^{+} \\langle \\mathbf{N} \\rangle}\n$$\n其中 $\\boldsymbol{\\rho} = \\langle \\mathbf{N} \\rangle / V$ 是密度向量。得到的向量 $\\bar{\\mathbf{v}}$ 的单位是每个粒子的体积，如果所有输入都采用国际单位制，则单位为 $\\mathrm{m}^3$。最终结果必须通过乘以 $10^{27}$ 转换为 $\\mathrm{nm}^3$/分子，因为 $1 \\, \\mathrm{m}^3 = 10^{27} \\, \\mathrm{nm}^3$。\n\n将为问题陈述中提供的所有四个测试案例实施这一完整过程。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Computes isothermal compressibility and partial molar volumes from\n    GCE number fluctuation data for a binary polymer solution.\n    \"\"\"\n    k_B = 1.380649e-23\n    M3_TO_NM3 = 1e27\n\n    test_cases = [\n        {\"T\": 300, \"V\": 1e-21, \"m\": np.array([100, 1]), \"Sigma\": np.array([[50, -0.5], [-0.5, 0.8]]), \"Ns_range\": (90, 110), \"Np_range\": (0, 5)},\n        {\"T\": 300, \"V\": 2e-21, \"m\": np.array([80, 20]), \"Sigma\": np.array([[60, -8], [-8, 15]]), \"Ns_range\": (60, 100), \"Np_range\": (10, 30)},\n        {\"T\": 300, \"V\": 1e-21, \"m\": np.array([50, 5]), \"Sigma\": np.array([[45, 0], [0, 5]]), \"Ns_range\": (35, 65), \"Np_range\": (0, 12)},\n        {\"T\": 300, \"V\": 5e-22, \"m\": np.array([120, 0.2]), \"Sigma\": np.array([[70, -0.1], [-0.1, 0.2]]), \"Ns_range\": (100, 140), \"Np_range\": (0, 2)}\n    ]\n\n    all_results = []\n    for case in test_cases:\n        T, V, m, Sigma, Ns_range, Np_range = case.values()\n        \n        Ns_vals = np.arange(Ns_range[0], Ns_range[1] + 1)\n        Np_vals = np.arange(Np_range[0], Np_range[1] + 1)\n        Ns_grid, Np_grid = np.meshgrid(Ns_vals, Np_vals)\n        N_grid = np.stack([Ns_grid.ravel(), Np_grid.ravel()], axis=1)\n\n        Sigma_inv = np.linalg.inv(Sigma)\n        diff = N_grid - m\n        exponent = -0.5 * np.sum((diff @ Sigma_inv) * diff, axis=1)\n        weights = np.exp(exponent)\n        P = weights / np.sum(weights)\n\n        mean_N = np.sum(N_grid * P[:, np.newaxis], axis=0)\n\n        outer_prod = N_grid[:, :, np.newaxis] * N_grid[:, np.newaxis, :]\n        mean_outer_prod = np.sum(outer_prod * P[:, np.newaxis, np.newaxis], axis=0)\n        cov_C = mean_outer_prod - np.outer(mean_N, mean_N)\n\n        rho_vec = mean_N / V\n        rho_tot = np.sum(rho_vec)\n        \n        var_N_tot = np.sum(cov_C)\n        kappa_T = var_N_tot / (k_B * T * V * rho_tot**2)\n\n        B = cov_C / (k_B * T)\n        B_plus = np.linalg.pinv(B)\n        \n        numerator_v = B_plus @ mean_N\n        denominator_v = rho_vec.T @ numerator_v\n        \n        v_bar_m3 = np.zeros(2)\n        if abs(denominator_v) > 1e-30:\n            v_bar_m3 = numerator_v / denominator_v\n        \n        v_bar_nm3 = v_bar_m3 * M3_TO_NM3\n\n        all_results.append([float(kappa_T), v_bar_nm3[0], v_bar_nm3[1]])\n\n    print(f\"{all_results}\")\n\nsolve()\n```"
        }
    ]
}