{
    "hands_on_practices": [
        {
            "introduction": "Before building complex simulations, we must master the fundamentals. This first practice guides you through the complete workflow for developing a numerical method for the classic 1D Poisson equation, a cornerstone of computational science. By deriving the ubiquitous three-point stencil from Taylor series and performing a convergence study, you will build a foundational understanding of how to connect theory, implementation, and verification .",
            "id": "4087184",
            "problem": "Consider the boundary value problem for a scalar field in one spatial dimension that commonly appears in computational complex fluids when modeling pressure corrections: solve the second-order ordinary differential equation $-u_{xx}=f$ on the interval $[0,1]$ subject to homogeneous Dirichlet boundary conditions $u(0)=0$ and $u(1)=0$. Starting from the Taylor expansion of a sufficiently smooth function and the definition of the derivative from calculus, derive a uniform-grid finite difference method (FDM) that uses the three-point Laplacian stencil to approximate $-u_{xx}$ at interior grid points. Demonstrate that the truncation error of this spatial discretization is second order in the grid spacing. Then implement a numerical solver that constructs and solves the resulting linear system on a uniform mesh, and verify empirically that the method exhibits second-order convergence for the forcing $f(x)=\\sin(\\pi x)$, where trigonometric arguments are interpreted in radians.\n\nTasks to complete:\n- Using Taylor expansions about an interior point $x_i$ with uniform grid spacing $h>0$, derive the three-point discrete approximation for $u_{xx}(x_i)$ and deduce the leading-order truncation error term. Conclude the order of accuracy for the discrete approximation to $-u_{xx}$.\n- Formulate the linear system obtained by applying this discrete approximation at all interior grid points for the interval $[0,1]$ with $N$ uniform subintervals, where $h=1/N$ and the interior indices are $i=1,2,\\dots,N-1$. Impose the boundary conditions $u(0)=0$ and $u(1)=0$ precisely.\n- For the manufactured forcing $f(x)=\\sin(\\pi x)$, compute the exact solution $u(x)$ using fundamental integration of ordinary differential equations, and use it to evaluate numerical errors.\n\nNumerical experiment specification:\n- Define the discrete error at interior points as the difference between the numerical solution and the exact solution. Compute the discrete $L^2$-norm error as $\\left(\\,h\\sum_{i=1}^{N-1} e_i^2\\,\\right)^{1/2}$ and the discrete $L^\\infty$-norm error as $\\max_{1\\le i\\le N-1} |e_i|$.\n- For a sequence of uniform meshes with $N\\in\\{2,4,8,16,32,64\\}$, compute the errors in both norms. Estimate the observed convergence rate between successive meshes with grid spacings $h_1$ and $h_2$ by $p=\\dfrac{\\log(e(h_1)/e(h_2))}{\\log(h_1/h_2)}$, where $e(h)$ denotes the error on mesh size $h$.\n- Determine two boolean indicators defined as follows: $converges\\_L2$ is true if each of the observed rates for pairs $(N,N')\\in\\{(8,16),(16,32),(32,64)\\}$ in the $L^2$-norm lies within the interval $[1.9,2.1]$, and $converges\\_\\infty$ is true if the same holds for the $L^\\infty$-norm.\n\nAngle unit requirement:\n- All trigonometric evaluations must use radians.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, consisting of the sequence of observed rates in the $L^2$-norm for the mesh pairs $(2,4)$, $(4,8)$, $(8,16)$, $(16,32)$, $(32,64)$, followed by the observed rates in the $L^\\infty$-norm for the same mesh pairs, and finally the two booleans $converges\\_L2$ and $converges\\_\\infty$ in that order. For example, the output should have the structure $[p_{L^2}(2\\to 4),p_{L^2}(4\\to 8),p_{L^2}(8\\to 16),p_{L^2}(16\\to 32),p_{L^2}(32\\to 64),p_{\\infty}(2\\to 4),p_{\\infty}(4\\to 8),p_{\\infty}(8\\to 16),p_{\\infty}(16\\to 32),p_{\\infty}(32\\to 64),converges\\_L2,converges\\_\\infty]$.",
            "solution": "The problem is valid as it is scientifically grounded in the theory of differential equations and numerical analysis, well-posed with a unique solution, and objectively stated with clear, formalizable requirements. It presents a standard exercise in deriving, implementing, and verifying a finite difference method for the one-dimensional Poisson equation.\n\nThe solution is developed in three parts as requested: derivation of the numerical scheme and its truncation error, formulation of the resulting linear system, and determination of the exact solution for the given forcing term. This is followed by a description of the numerical implementation.\n\n**Part 1: Derivation of the Three-Point Stencil and Truncation Error**\n\nWe seek to approximate the second derivative, $u_{xx}$, at an interior grid point $x_i$ on a uniform grid with spacing $h > 0$. The grid points are defined as $x_j = j h$ for integer $j$. We use Taylor's theorem to expand the function $u(x)$ around $x_i$. For a sufficiently smooth function $u$, the expansions for $u(x_i+h)$ and $u(x_i-h)$ are:\n$$ u(x_i+h) = u(x_{i+1}) = u(x_i) + h u'(x_i) + \\frac{h^2}{2!} u''(x_i) + \\frac{h^3}{3!} u'''(x_i) + \\frac{h^4}{4!} u^{(4)}(x_i) + O(h^5) $$\n$$ u(x_i-h) = u(x_{i-1}) = u(x_i) - h u'(x_i) + \\frac{h^2}{2!} u''(x_i) - \\frac{h^3}{3!} u'''(x_i) + \\frac{h^4}{4!} u^{(4)}(x_i) + O(h^5) $$\nAdding these two equations eliminates the odd-derivative terms:\n$$ u(x_{i-1}) + u(x_{i+1}) = 2u(x_i) + h^2 u''(x_i) + \\frac{2h^4}{24} u^{(4)}(x_i) + O(h^6) $$\nRearranging to solve for $u''(x_i)$, we get:\n$$ u''(x_i) = \\frac{u(x_{i-1}) - 2u(x_i) + u(x_{i+1})}{h^2} - \\frac{h^2}{12} u^{(4)}(x_i) + O(h^4) $$\nThe central finite difference approximation for the second derivative, denoted by $\\delta_x^2 u(x_i)$, is the leading term in this expression:\n$$ \\delta_x^2 u(x_i) = \\frac{u(x_{i-1}) - 2u(x_i) + u(x_{i+1})}{h^2} $$\nThe truncation error, $\\tau_i$, is the difference between the exact derivative and its finite difference approximation:\n$$ \\tau_i = u''(x_i) - \\delta_x^2 u(x_i) = -\\frac{h^2}{12} u^{(4)}(x_i) + O(h^4) $$\nThe leading-order term of the truncation error is proportional to $h^2$. Therefore, this approximation is second-order accurate. The differential equation is $-u_{xx} = f$. We approximate $-u_{xx}$ using the negative of the derived stencil:\n$$ -u_{xx}(x_i) \\approx \\frac{-u(x_{i-1}) + 2u(x_i) - u(x_{i+1})}{h^2} $$\nThis three-point stencil approximation for $-u_{xx}$ is also second-order accurate, with a leading-order truncation error of $\\frac{h^2}{12} u^{(4)}(x_i)$.\n\n**Part 2: Formulation of the Linear System**\n\nWe discretize the domain $[0,1]$ using $N$ subintervals, such that the grid spacing is $h=1/N$. The grid points are $x_i = i h$ for $i=0, 1, \\dots, N$. The solution is sought at the interior points $x_i$ for $i=1, 2, \\dots, N-1$. Let $u_i$ be the numerical approximation of $u(x_i)$, and let $f_i = f(x_i)$.\n\nApplying the finite difference approximation at each interior grid point $x_i$:\n$$ \\frac{-u_{i-1} + 2u_i - u_{i+1}}{h^2} = f_i, \\quad \\text{for } i=1, 2, \\dots, N-1 $$\nThe homogeneous Dirichlet boundary conditions are $u(0)=0$ and $u(1)=0$, which implies $u_0=0$ and $u_N=0$. We incorporate these into the equations for $i=1$ and $i=N-1$:\nFor $i=1$:\n$$ \\frac{-u_0 + 2u_1 - u_2}{h^2} = f_1 \\implies \\frac{2u_1 - u_2}{h^2} = f_1 $$\nFor $i=N-1$:\n$$ \\frac{-u_{N-2} + 2u_{N-1} - u_N}{h^2} = f_{N-1} \\implies \\frac{-u_{N-2} + 2u_{N-1}}{h^2} = f_{N-1} $$\nThis set of $N-1$ linear equations can be written in matrix form $A\\mathbf{u} = \\mathbf{b}$, where $\\mathbf{u} = [u_1, u_2, \\dots, u_{N-1}]^T$ is the vector of unknown solution values, $\\mathbf{b} = [f_1, f_2, \\dots, f_{N-1}]^T$ is the vector of forcing term values, and $A$ is the $(N-1) \\times (N-1)$ coefficient matrix.\n$$ A = \\frac{1}{h^2} \\begin{pmatrix}\n2 & -1 & 0 & \\cdots & 0 & 0 \\\\\n-1 & 2 & -1 & \\cdots & 0 & 0 \\\\\n0 & -1 & 2 & \\ddots & \\vdots & \\vdots \\\\\n\\vdots & \\vdots & \\ddots & \\ddots & -1 & 0 \\\\\n0 & 0 & \\cdots & -1 & 2 & -1 \\\\\n0 & 0 & \\cdots & 0 & -1 & 2\n\\end{pmatrix} $$\nThis matrix is symmetric, positive-definite, and tridiagonal. The linear system has a unique solution which can be found numerically.\n\n**Part 3: Exact Solution**\n\nGiven the forcing term $f(x) = \\sin(\\pi x)$, the differential equation is $-u_{xx} = \\sin(\\pi x)$. We solve this by integrating twice with respect to $x$.\nFirst integration:\n$$ -u_x = \\int \\sin(\\pi x) \\,dx = -\\frac{1}{\\pi}\\cos(\\pi x) + C_1 $$\n$$ u_x = \\frac{1}{\\pi}\\cos(\\pi x) - C_1 $$\nSecond integration:\n$$ u(x) = \\int \\left(\\frac{1}{\\pi}\\cos(\\pi x) - C_1\\right) dx = \\frac{1}{\\pi^2}\\sin(\\pi x) - C_1 x + C_2 $$\nNow we apply the boundary conditions to find the constants of integration $C_1$ and $C_2$.\nAt $x=0$, $u(0)=0$:\n$$ u(0) = \\frac{1}{\\pi^2}\\sin(0) - C_1(0) + C_2 = 0 \\implies C_2=0 $$\nAt $x=1$, $u(1)=0$:\n$$ u(1) = \\frac{1}{\\pi^2}\\sin(\\pi) - C_1(1) + 0 = 0 \\implies 0 - C_1 = 0 \\implies C_1=0 $$\nThus, the exact solution to the boundary value problem is:\n$$ u(x) = \\frac{1}{\\pi^2}\\sin(\\pi x) $$\n\n**Numerical Experiment**\n\nTo verify the second-order convergence of the method, we perform a numerical experiment. For a sequence of meshes with $N \\in \\{2, 4, 8, 16, 32, 64\\}$, we solve the linear system $A\\mathbf{u}=\\mathbf{b}$ to find the numerical solution $\\mathbf{u}$. We then compute the exact solution at the interior grid points and calculate the error vector $\\mathbf{e} = \\mathbf{u} - \\mathbf{u}_{\\text{exact}}$. The discrete $L^2$ and $L^\\infty$ error norms are computed. The rate of convergence $p$ between two successive meshes with grid spacings $h_1$ and $h_2$ (where $h_1=2h_2$) is estimated by $p = \\log_2(e(h_1)/e(h_2))$. As the method is second-order accurate, we expect $p$ to approach $2$ as $h \\to 0$. The boolean indicators $converges\\_L2$ and $converges\\_\\infty$ are evaluated based on whether the observed rates for the finest three mesh refinements fall within the interval $[1.9, 2.1]$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives, implements, and verifies a second-order finite difference method\n    for the 1D Poisson equation -u_xx = f on [0,1] with u(0)=u(1)=0.\n    \"\"\"\n    \n    N_values = [2, 4, 8, 16, 32, 64]\n    l2_errors = {}\n    linf_errors = {}\n\n    for N in N_values:\n        # 1. Setup grid and parameters\n        h = 1.0 / N\n        # Interior grid points from x_1 to x_{N-1}\n        x_interior = np.linspace(h, 1.0 - h, N - 1)\n\n        # 2. Construct the linear system A*u = f\n        # Construct the (N-1)x(N-1) matrix A for -d^2/dx^2\n        # A = (1/h^2) * Tridiag(-1, 2, -1)\n        A = (2.0 * np.eye(N - 1) - np.eye(N - 1, k=1) - np.eye(N - 1, k=-1)) / h**2\n\n        # Construct the right-hand side vector f\n        f = np.sin(np.pi * x_interior)\n\n        # 3. Solve the linear system for the numerical solution\n        u_numerical = np.linalg.solve(A, f)\n\n        # 4. Compute the exact solution\n        u_exact = (1.0 / np.pi**2) * np.sin(np.pi * x_interior)\n\n        # 5. Compute errors\n        errors = u_numerical - u_exact\n        \n        # Discrete L2-norm: (h * sum(e_i^2))^(1/2)\n        l2_err = np.sqrt(h * np.sum(errors**2))\n        \n        # Discrete L-infinity norm: max|e_i|\n        linf_err = np.max(np.abs(errors))\n        \n        l2_errors[N] = l2_err\n        linf_errors[N] = linf_err\n\n    # 6. Calculate convergence rates\n    l2_rates = []\n    linf_rates = []\n    for i in range(len(N_values) - 1):\n        N1 = N_values[i]\n        N2 = N_values[i+1]\n        \n        h1 = 1.0 / N1\n        h2 = 1.0 / N2\n\n        # Rate formula: p = log(error(h1)/error(h2)) / log(h1/h2)\n        # Since h1/h2 is always 2, this simplifies to log2(error_ratio).\n        rate_l2 = np.log2(l2_errors[N1] / l2_errors[N2])\n        l2_rates.append(rate_l2)\n        \n        rate_linf = np.log2(linf_errors[N1] / linf_errors[N2])\n        linf_rates.append(rate_linf)\n\n    # 7. Check convergence criteria for the last three refinements\n    # These correspond to pairs (8,16), (16,32), (32,64)\n    # The rates list has indices 0, 1, 2, 3, 4 for pairs (2,4), (4,8), (8,16), (16,32), (32,64)\n    # So we check rates at indices 2, 3, 4.\n    relevant_l2_rates = l2_rates[2:]\n    relevant_linf_rates = linf_rates[2:]\n    \n    converges_L2 = all(1.9 <= r <= 2.1 for r in relevant_l2_rates)\n    converges_infty = all(1.9 <= r <= 2.1 for r in relevant_linf_rates)\n\n    # 8. Format and print the final output\n    # The order is: 5 L2 rates, 5 L-inf rates, 2 booleans\n    results = l2_rates + linf_rates + [converges_L2, converges_infty]\n    \n    # Map all items to string for printing\n    # Booleans will be converted to 'True' or 'False'\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Real-world systems, especially complex fluids, are rarely uniform. This exercise tackles the crucial challenge of modeling diffusion across a material interface where properties change abruptly. You will derive and compare a naive, non-conservative discretization with a physically robust, conservative finite volume method, revealing why enforcing flux conservation is paramount for obtaining physically meaningful results in heterogeneous media .",
            "id": "4087183",
            "problem": "Consider a one-dimensional steady diffusion of a scalar field $\\phi(x)$ governed by the conservation law\n$$\\frac{d}{dx}\\left(\\mu(x)\\,\\frac{d\\phi}{dx}\\right)=q(x),$$\nwhere $\\mu(x)>0$ is the diffusion coefficient and $q(x)$ is a prescribed volumetric source. In complex fluids, $\\mu(x)$ may exhibit discontinuities across material interfaces due to changes in microstructure. Assume a uniform computational mesh with $N$ nodes over a domain of length $L$, with spacing $\\Delta x = L/(N-1)$. Let the diffusion coefficient be piecewise constant,\n$$\n\\mu(x)=\\begin{cases}\n\\mu_L,& x\\le x_\\mathrm{int},\\\\\n\\mu_R,& x>x_\\mathrm{int},\n\\end{cases}\n$$\nwith the material interface aligned to a single internal face between nodes $i=j_\\mathrm{int}$ and $i=j_\\mathrm{int}+1$ so that $x_\\mathrm{int}=\\frac{1}{2}(x_{j_\\mathrm{int}}+x_{j_\\mathrm{int}+1})$. Impose Dirichlet boundary conditions $\\phi(0)=\\phi_L$ and $\\phi(L)=\\phi_R$, and take a constant source $q(x)\\equiv q$.\n\nStarting from the integral form of the conservation law on each control volume $[x_{i-1/2},x_{i+1/2}]$ and the definition of diffusive flux $F=-\\mu\\,\\frac{d\\phi}{dx}$, derive two spatial discretizations:\n\n- A conservative flux formulation that represents the interface flux on each face and enforces a unique value of the flux crossing a shared face. Use a consistent face interpolation for $\\mu$ that depends only on $\\mu_L$ and $\\mu_R$ and respects monotonicity for discontinuous coefficients.\n\n- A nonconservative pointwise-coefficient formulation that multiplies the second-derivative approximation by the nodal value of $\\mu$.\n\nSolve the resulting linear systems for $\\phi$ using both discretizations on the same mesh and parameter set, and then compute a flux-jump metric at the single material interface. Define the interface using the index $j_\\mathrm{int}$ so that the discontinuity lies between nodes $j_\\mathrm{int}$ and $j_\\mathrm{int}+1$. For the conservative discretization, compute the outward flux from the left cell across the interface face and the outward flux from the right cell across the same face using the unique face flux; verify flux continuity by reporting the magnitude of the sum of these two outward fluxes. For the nonconservative discretization, compute two distinct constitutive face fluxes at the interface by multiplying the same discrete gradient across the interface by $\\mu_L$ and by $\\mu_R$, and report the magnitude of their difference.\n\nYour program must implement both discretizations, solve the linear systems, and produce the requested flux-jump metrics for the following test suite of parameter sets $\\{L, N, \\mu_L, \\mu_R, j_\\mathrm{int}, \\phi_L, \\phi_R, q\\}$:\n\n- Test case 1 (general discontinuity, no source): $\\{L=1.0, N=33, \\mu_L=1.0, \\mu_R=10.0, j_\\mathrm{int}=16, \\phi_L=0.0, \\phi_R=1.0, q=0.0\\}$.\n- Test case 2 (high contrast, reversed boundary values, no source): $\\{L=1.0, N=65, \\mu_L=0.1, \\mu_R=100.0, j_\\mathrm{int}=32, \\phi_L=1.0, \\phi_R=0.0, q=0.0\\}$.\n- Test case 3 (no discontinuity, no source): $\\{L=1.0, N=41, \\mu_L=2.0, \\mu_R=2.0, j_\\mathrm{int}=20, \\phi_L=0.0, \\phi_R=1.0, q=0.0\\}$.\n- Test case 4 (general discontinuity, nonzero source): $\\{L=2.0, N=81, \\mu_L=1.0, \\mu_R=10.0, j_\\mathrm{int}=40, \\phi_L=0.0, \\phi_R=0.0, q=5.0\\}$.\n\nFor each test case, output a pair $[J_\\mathrm{cons}, J_\\mathrm{noncons}]$ where $J_\\mathrm{cons}$ is the absolute magnitude of the sum of outward fluxes from the two cells adjacent to the interface face computed using the conservative discretization, and $J_\\mathrm{noncons}$ is the absolute magnitude of the difference between the two constitutive face fluxes computed using $\\mu_L$ and $\\mu_R$ with the nonconservative discretization. Your program should produce a single line of output containing the results as a comma-separated list of these pairs enclosed in square brackets (for example, $[[J_{1,\\mathrm{cons}}, J_{1,\\mathrm{noncons}}], [J_{2,\\mathrm{cons}}, J_{2,\\mathrm{noncons}}], \\dots]$). No physical units are required; angles are not used; do not express any quantity using a percentage sign.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, and objective. It presents a standard exercise in computational transport phenomena, contrasting conservative and non-conservative numerical schemes for a diffusion equation with discontinuous coefficients. All parameters and conditions are clearly defined.\n\nThe analysis begins by establishing a cell-centered finite volume framework. The one-dimensional domain of length $L$ is discretized into $N$ nodes located at $x_i = i\\,\\Delta x$ for $i=0, 1, \\dots, N-1$, where $\\Delta x = L/(N-1)$. For each internal node $i$, we define a control volume $V_i = [x_{i-1/2}, x_{i+1/2}]$, where the faces are located at the midpoints between nodes, $x_{i \\pm 1/2} = x_i \\pm \\Delta x/2$.\n\nThe governing equation is the steady-state conservation law for a scalar field $\\phi(x)$:\n$$ \\frac{d}{dx}\\left(\\mu(x)\\,\\frac{d\\phi}{dx}\\right) = q(x) $$\nThe diffusive flux is defined as $F(x) = -\\mu(x)\\,\\frac{d\\phi}{dx}$. The governing equation can be rewritten in terms of the flux as $-\\frac{dF}{dx} = q(x)$.\n\n### Conservative Finite Volume Discretization\n\nThis formulation is derived from the integral form of the conservation law over an arbitrary control volume $V_i$:\n$$ \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{d}{dx}\\left(\\mu(x)\\,\\frac{d\\phi}{dx}\\right) dx = \\int_{x_{i-1/2}}^{x_{i+1/2}} q(x) dx $$\nApplying the fundamental theorem of calculus to the left-hand side yields:\n$$ \\left[\\mu(x)\\,\\frac{d\\phi}{dx}\\right]_{x_{i-1/2}}^{x_{i+1/2}} = q \\cdot \\Delta x $$\nwhere we have assumed $q(x)$ is a constant $q$. This expresses the balance of fluxes across the control volume faces:\n$$ \\left(\\mu\\frac{d\\phi}{dx}\\right)_{i+1/2} - \\left(\\mu\\frac{d\\phi}{dx}\\right)_{i-1/2} = q \\Delta x $$\nIn terms of the flux $F$, this is $F_{i-1/2} - F_{i+1/2} = q \\Delta x$.\n\nThe flux at each face is approximated using a centered difference of the nodal values of $\\phi$:\n$$ F_{i+1/2} = -\\left(\\mu\\frac{d\\phi}{dx}\\right)_{i+1/2} \\approx -\\mu_{i+1/2} \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x} $$\nHere, $\\mu_{i+1/2}$ is the diffusion coefficient at the face between nodes $i$ and $i+1$. Substituting this approximation into the flux balance equation for an internal node $i \\in \\{1, \\dots, N-2\\}$ gives:\n$$ -\\mu_{i+1/2} \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x} - \\left(-\\mu_{i-1/2} \\frac{\\phi_i - \\phi_{i-1}}{\\Delta x}\\right) = q \\Delta x $$\nRearranging this leads to a linear equation for $\\phi_i$:\n$$ \\mu_{i-1/2} \\phi_{i-1} - (\\mu_{i-1/2} + \\mu_{i+1/2}) \\phi_i + \\mu_{i+1/2} \\phi_{i+1} = q (\\Delta x)^2 $$\nThe key to this method's conservativity lies in the definition of the face diffusivity $\\mu_{i+1/2}$. The problem states that the material interface is at $x_\\mathrm{int} = x_{j_\\mathrm{int}+1/2}$, separating regions with coefficients $\\mu_L$ and $\\mu_R$.\n- If a face at $x_{i+1/2}$ is not the material interface, the coefficient is constant across it: $\\mu_{i+1/2} = \\mu_L$ if $i < j_\\mathrm{int}$, and $\\mu_{i+1/2} = \\mu_R$ if $i > j_\\mathrm{int}$.\n- At the interface face $x_{j_\\mathrm{int}+1/2}$, a consistent interpolation that ensures flux continuity and monotonicity for discontinuous coefficients is the harmonic mean:\n$$ \\mu_{j_\\mathrm{int}+1/2} = \\left(\\frac{1-f}{\\mu_L} + \\frac{f}{\\mu_R}\\right)^{-1} $$\nSince the interface is at the midpoint between nodes ($f=1/2$), this simplifies to:\n$$ \\mu_{j_\\mathrm{int}+1/2} = \\frac{2\\mu_L\\mu_R}{\\mu_L+\\mu_R} $$\nThis choice ensures that the numerical flux $F_{j_\\mathrm{int}+1/2}$ has a single, unique value, enforcing physical conservation.\n\nThe set of linear equations for the internal nodes $\\phi_1, \\dots, \\phi_{N-2}$ forms a tridiagonal system $A\\boldsymbol{\\phi} = \\mathbf{b}$. The Dirichlet boundary conditions $\\phi_0 = \\phi_L$ and $\\phi_{N-1} = \\phi_R$ are incorporated by moving the corresponding terms to the right-hand side vector $\\mathbf{b}$.\n\n### Non-Conservative Pointwise-Coefficient Discretization\n\nThis approach starts from the expanded form of the governing equation: $\\mu\\,\\frac{d^2\\phi}{dx^2} + \\frac{d\\mu}{dx}\\frac{d\\phi}{dx} = q$. The non-conservative scheme discretizes the equation at each node $i$ by approximating the term $\\mu(x_i) \\frac{d^2\\phi}{dx^2}$ and neglecting the term involving $\\frac{d\\mu}{dx}$. This is formally incorrect where $\\mu$ is not constant.\nUsing a standard central difference for the second derivative, the discrete equation becomes:\n$$ \\mu_i \\frac{\\phi_{i-1} - 2\\phi_i + \\phi_{i+1}}{(\\Delta x)^2} = q $$\nwhere $\\mu_i = \\mu(x_i)$ is the nodal value of the diffusion coefficient. Given the definition of $\\mu(x)$, we have:\n$$ \\mu_i = \\begin{cases} \\mu_L, & i \\le j_\\mathrm{int} \\\\ \\mu_R, & i > j_\\mathrm{int} \\end{cases} $$\nRearranging for an internal node $i \\in \\{1, \\dots, N-2\\}$ yields:\n$$ \\mu_i \\phi_{i-1} - 2\\mu_i \\phi_i + \\mu_i \\phi_{i+1} = q (\\Delta x)^2 $$\nThis also forms a tridiagonal system $A'\\boldsymbol{\\phi}' = \\mathbf{b}'$ for the unknowns $\\phi'_1, \\dots, \\phi'_{N-2}$, with boundary conditions handled similarly.\n\n### Flux-Jump Metrics\n\nWe analyze the flux continuity at the interface face $x_{j_\\mathrm{int}+1/2}$.\n\nFor the **conservative scheme**, the flux at the interface face is uniquely defined as:\n$$ F_\\mathrm{cons} = -\\mu_{j_\\mathrm{int}+1/2} \\frac{\\phi_{j_\\mathrm{int}+1} - \\phi_{j_\\mathrm{int}}}{\\Delta x} $$\nwhere $\\mu_{j_\\mathrm{int}+1/2}$ is the harmonic mean. The outward flux from the left cell ($V_{j_\\mathrm{int}}$) at this face is $+F_\\mathrm{cons}$. The outward flux from the right cell ($V_{j_\\mathrm{int}+1}$) at this same face is $-F_\\mathrm{cons}$. The sum of these outward fluxes is, by construction, zero. The metric $J_\\mathrm{cons}$ is the magnitude of this sum:\n$$ J_\\mathrm{cons} = |(+F_\\mathrm{cons}) + (-F_\\mathrm{cons})| = 0 $$\nThis reflects the scheme's property of local conservation.\n\nFor the **non-conservative scheme**, there is no unique definition of flux at the interface. One can define two different constitutive fluxes based on which side of the interface is considered. Using the same gradient approximation but different local coefficients:\n- Flux from the perspective of the left material: $F_L = -\\mu_L \\frac{\\phi'_{j_\\mathrm{int}+1} - \\phi'_{j_\\mathrm{int}}}{\\Delta x}$\n- Flux from the perspective of the right material: $F_R = -\\mu_R \\frac{\\phi'_{j_\\mathrm{int}+1} - \\phi'_{j_\\mathrm{int}}}{\\Delta x}$\nThe non-conservative scheme produces a jump in the computed flux, and the metric $J_\\mathrm{noncons}$ is the magnitude of this physically incorrect jump:\n$$ J_\\mathrm{noncons} = |F_L - F_R| = |\\mu_R - \\mu_L| \\left|\\frac{\\phi'_{j_\\mathrm{int}+1} - \\phi'_{j_\\mathrm{int}}}{\\Delta x}\\right| $$\nThis value is generally non-zero when $\\mu_L \\ne \\mu_R$, indicating a violation of the conservation principle.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares conservative and non-conservative finite difference\n    schemes for a 1D steady diffusion problem with a discontinuous coefficient.\n    \"\"\"\n    test_cases = [\n        # (L, N, mu_L, mu_R, j_int, phi_L, phi_R, q)\n        (1.0, 33, 1.0, 10.0, 16, 0.0, 1.0, 0.0),\n        (1.0, 65, 0.1, 100.0, 32, 1.0, 0.0, 0.0),\n        (1.0, 41, 2.0, 2.0, 20, 0.0, 1.0, 0.0),\n        (2.0, 81, 1.0, 10.0, 40, 0.0, 0.0, 5.0),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        L, N, mu_L, mu_R, j_int, phi_L, phi_R, q = case\n        \n        dx = L / (N - 1)\n        num_unknowns = N - 2\n\n        # --- CONSERVATIVE SCHEME ---\n        \n        # 1. Setup face diffusivities\n        mu_face = np.zeros(N - 1)\n        # Faces in the left material region\n        if j_int > 0:\n            mu_face[0:j_int] = mu_L\n        # Interface face (harmonic mean)\n        if mu_L + mu_R > 0:\n            mu_face[j_int] = (2 * mu_L * mu_R) / (mu_L + mu_R)\n        else: # Handle case of both mu are zero\n            mu_face[j_int] = 0.0\n        # Faces in the right material region\n        if j_int < N - 2:\n            mu_face[j_int + 1:] = mu_R\n\n        # 2. Assemble the linear system A*phi = b\n        A_cons = np.zeros((num_unknowns, num_unknowns))\n        b_cons = np.full(num_unknowns, q * dx**2)\n\n        # Main diagonal\n        diag_main = -(mu_face[0:num_unknowns] + mu_face[1:num_unknowns+1])\n        # Lower diagonal\n        diag_lower = mu_face[0:num_unknowns-1]\n        # Upper diagonal\n        diag_upper = mu_face[1:num_unknowns]\n\n        np.fill_diagonal(A_cons, diag_main)\n        np.fill_diagonal(A_cons[1:], diag_lower)\n        np.fill_diagonal(A_cons[:,1:], diag_upper)\n\n        # Apply boundary conditions\n        b_cons[0] -= mu_face[0] * phi_L\n        b_cons[-1] -= mu_face[-1] * phi_R\n\n        # 3. Solve for interior phi values and construct full solution vector\n        phi_internal_cons = np.linalg.solve(A_cons, b_cons)\n        phi_cons = np.concatenate(([phi_L], phi_internal_cons, [phi_R]))\n\n        # 4. Calculate flux-jump metric\n        flux_grad_cons = (phi_cons[j_int + 1] - phi_cons[j_int]) / dx\n        flux_cons = -mu_face[j_int] * flux_grad_cons\n        # Sum of outward fluxes from cell j_int and cell j_int+1 at the interface\n        J_cons = abs(flux_cons + (-flux_cons))\n\n\n        # --- NON-CONSERVATIVE SCHEME ---\n\n        # 1. Setup nodal diffusivities\n        mu_node = np.zeros(N)\n        mu_node[:j_int + 1] = mu_L\n        mu_node[j_int + 1:] = mu_R\n\n        # 2. Assemble the linear system A'*phi' = b'\n        A_noncons = np.zeros((num_unknowns, num_unknowns))\n        b_noncons = np.full(num_unknowns, q * dx**2)\n        \n        # Coefficients depend on mu_i for the equation at node i\n        mu_internal = mu_node[1:-1]\n        \n        # Main diagonal\n        diag_main_nc = -2.0 * mu_internal\n        # Lower diagonal\n        diag_lower_nc = mu_internal[1:]\n        # Upper diagonal\n        diag_upper_nc = mu_internal[:-1]\n\n        # Populate matrix A'\n        A_noncons = (np.diag(diag_main_nc) + \n                     np.diag(diag_upper_nc, k=1) + \n                     np.diag(diag_lower_nc, k=-1))\n\n        # Apply boundary conditions\n        b_noncons[0] -= mu_node[1] * phi_L\n        b_noncons[-1] -= mu_node[-2] * phi_R\n\n        # 3. Solve for interior phi' values and construct full solution vector\n        phi_internal_noncons = np.linalg.solve(A_noncons, b_noncons)\n        phi_noncons = np.concatenate(([phi_L], phi_internal_noncons, [phi_R]))\n\n        # 4. Calculate flux-jump metric\n        flux_grad_noncons = (phi_noncons[j_int + 1] - phi_noncons[j_int]) / dx\n        flux_L = -mu_L * flux_grad_noncons\n        flux_R = -mu_R * flux_grad_noncons\n        J_noncons = abs(flux_L - flux_R)\n\n        results.append([J_cons, J_noncons])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "For high-fidelity simulations of transport and wave phenomena, achieving high-order accuracy with a minimal computational footprint is key. This practice introduces advanced compact finite difference schemes, which provide superior accuracy by creating an implicit relationship between derivatives at neighboring points. You will not only derive a famous fourth-order compact scheme but also analyze its performance using modified wavenumber analysis, a powerful tool for understanding a scheme's spectral properties .",
            "id": "4087187",
            "problem": "Consider a smooth scalar field $u(x)$ representing, for example, a passive scalar concentration in a complex fluid under advection and diffusion in Computational Fluid Dynamics (CFD). Let the field be sampled on a uniform grid $x_i = i h$ with grid spacing $h$. We seek a compact, tridiagonal, fourth-order accurate spatial discretization for the first derivative $u_x$ at the grid point $x_i$. Assume the discrete derivative $(u_x)_i$ is approximated by $u'_i$ and consider the following general tridiagonal compact relation:\n$$\n\\alpha\\,u'_{i-1} + u'_i + \\alpha\\,u'_{i+1}\n= \\frac{c_1}{h}\\left(u_{i+1} - u_{i-1}\\right)\n+ \\frac{c_2}{h}\\left(u_{i+2} - u_{i-2}\\right),\n$$\nwhere $\\alpha$, $c_1$, and $c_2$ are constant coefficients independent of $i$.\n\nStarting from Taylor series expansions about $x_i$ and enforcing fourth-order consistency for smooth $u(x)$ (so that the truncation error is $\\mathcal{O}(h^4)$), derive the system of algebraic conditions that the coefficients $\\alpha$, $c_1$, and $c_2$ must satisfy. Then, impose the design constraint that the explicit right-hand side involves only nearest-neighbor function values to minimize stencil width in complex-fluid solvers, which means setting $c_2 = 0$. Solve for the resulting coefficients $\\alpha$ and $c_1$.\n\nNext, analyze the spectral (Fourier) response of the obtained scheme. For a Fourier mode $u_j = \\exp\\!\\left(\\mathrm{i}\\,\\kappa\\,j\\,h\\right)$ with physical wavenumber $\\kappa$, define the dimensionless phase $\\theta = \\kappa h$ (in radians) and the modified wavenumber $k^{\\ast}(\\theta)$ by the relation $u'_j \\approx \\mathrm{i}\\,k^{\\ast}(\\theta)\\,u_j$. Using linear constant-coefficient analysis, compute $k^{\\ast}(\\theta)$ for the derived scheme as a closed-form analytic expression.\n\nExpress your final answer as a row matrix containing the coefficients $\\alpha$, $c_1$, $c_2$, and the modified wavenumber $k^{\\ast}(\\theta)$ in terms of $h$ and $\\theta$. No numerical rounding is required. The angle $\\theta$ must be treated in radians.",
            "solution": "We start from a uniform grid $x_i = i h$, with a compact tridiagonal discretization of $u_x$ given by\n$$\n\\alpha\\,u'_{i-1} + u'_i + \\alpha\\,u'_{i+1}\n= \\frac{c_1}{h}\\left(u_{i+1} - u_{i-1}\\right)\n+ \\frac{c_2}{h}\\left(u_{i+2} - u_{i-2}\\right),\n$$\nwhere $u'_i$ approximates $(u_x)_i$. Our objective is to determine $\\alpha$, $c_1$, and $c_2$ such that the scheme is fourth-order accurate, and then compute its modified wavenumber.\n\nThe fundamental base is Taylorâ€™s theorem for smooth functions. Expand $u$ and its derivatives about $x_i$:\n$$\nu_{i\\pm 1} = u_i \\pm h u'_i + \\frac{h^2}{2}u''_i \\pm \\frac{h^3}{6}u'''_i + \\frac{h^4}{24}u''''_i \\pm \\frac{h^5}{120}u^{(5)}_i + \\mathcal{O}(h^6),\n$$\n$$\nu_{i\\pm 2} = u_i \\pm 2h u'_i + \\frac{(2h)^2}{2}u''_i \\pm \\frac{(2h)^3}{6}u'''_i + \\frac{(2h)^4}{24}u''''_i \\pm \\frac{(2h)^5}{120}u^{(5)}_i + \\mathcal{O}(h^6),\n$$\nand similarly\n$$\nu'_{i\\pm 1} = u'_i \\pm h u''_i + \\frac{h^2}{2}u'''_i \\pm \\frac{h^3}{6}u''''_i + \\frac{h^4}{24}u^{(5)}_i + \\mathcal{O}(h^5).\n$$\n\nCompute the combinations appearing in the stencil:\n- The left-hand side (LHS) sums neighboring derivatives symmetrically:\n$$\nu'_{i-1} + u'_{i+1} = 2 u'_i + h^2 u'''_i + \\frac{h^4}{12}u^{(5)}_i + \\mathcal{O}(h^6).\n$$\nThus\n$$\n\\text{LHS} = \\alpha\\left(u'_{i-1} + u'_{i+1}\\right) + u'_i\n= (1 + 2\\alpha)u'_i + \\alpha h^2 u'''_i + \\frac{\\alpha h^4}{12}u^{(5)}_i + \\mathcal{O}(h^6).\n$$\n\n- The right-hand side (RHS) differences are\n$$\nu_{i+1} - u_{i-1} = 2 h u'_i + \\frac{h^3}{3}u'''_i + \\frac{h^5}{60}u^{(5)}_i + \\mathcal{O}(h^7),\n$$\n$$\nu_{i+2} - u_{i-2} = 4 h u'_i + \\frac{8 h^3}{3}u'''_i + \\frac{8 h^5}{15}u^{(5)}_i + \\mathcal{O}(h^7).\n$$\nTherefore\n$$\n\\text{RHS}\n= \\frac{c_1}{h}\\left(2 h u'_i + \\frac{h^3}{3}u'''_i + \\frac{h^5}{60}u^{(5)}_i\\right)\n+ \\frac{c_2}{h}\\left(4 h u'_i + \\frac{8 h^3}{3}u'''_i + \\frac{8 h^5}{15}u^{(5)}_i\\right)\n+ \\mathcal{O}(h^6),\n$$\nwhich simplifies to\n$$\n\\text{RHS}\n= (2 c_1 + 4 c_2)u'_i\n+ \\left(\\frac{c_1}{3} + \\frac{8 c_2}{3}\\right) h^2 u'''_i\n+ \\left(\\frac{c_1}{60} + \\frac{8 c_2}{15}\\right) h^4 u^{(5)}_i\n+ \\mathcal{O}(h^6).\n$$\n\nFor the scheme to be fourth-order accurate, the coefficients of $u'_i$ and $u'''_i$ must match between LHS and RHS. This enforces the conditions\n$$\n1 + 2\\alpha = 2 c_1 + 4 c_2,\n\\qquad\n\\alpha = \\frac{c_1}{3} + \\frac{8 c_2}{3}.\n$$\nThe $h^4 u^{(5)}_i$ term need not match for fourth-order accuracy; its mismatch determines the fourth-order truncation constant.\n\nTo select a unique set of coefficients consistent with minimal explicit stencil width in complex-fluid solvers (to reduce memory traffic and limit coupling range in, for example, viscoelastic stress-transport equations), impose the design constraint $c_2 = 0$. Substituting $c_2=0$ yields\n$$\n1 + 2\\alpha = 2 c_1,\n\\qquad\n\\alpha = \\frac{c_1}{3}.\n$$\nSolving,\n$$\nc_1 = \\frac{1 + 2\\alpha}{2}, \\quad \\alpha = \\frac{c_1}{3}\n\\;\\Rightarrow\\; 3\\alpha = \\frac{1 + 2\\alpha}{2}\n\\;\\Rightarrow\\; 6\\alpha = 1 + 2\\alpha\n\\;\\Rightarrow\\; 4\\alpha = 1\n\\;\\Rightarrow\\; \\alpha = \\frac{1}{4},\n$$\nand hence\n$$\nc_1 = \\frac{3}{4}, \\qquad c_2 = 0.\n$$\nThe resulting compact scheme is\n$$\n\\frac{1}{4}\\,u'_{i-1} + u'_i + \\frac{1}{4}\\,u'_{i+1}\n= \\frac{3}{4h}\\left(u_{i+1} - u_{i-1}\\right),\n$$\nwhich is formally fourth-order accurate.\n\nNext, compute the modified wavenumber. Consider a monochromatic Fourier mode\n$$\nu_j = \\exp\\!\\left(\\mathrm{i}\\,\\kappa\\,j\\,h\\right), \\qquad \\theta = \\kappa h,\n$$\nand suppose the discrete derivative produced by the scheme is $u'_j = \\mathrm{i}\\,k^{\\ast}(\\theta)\\,u_j$. Substitute into the tridiagonal relation:\n$$\n\\alpha\\,(\\mathrm{i}k^{\\ast}u_{j-1}) + (\\mathrm{i}k^{\\ast}u_j) + \\alpha\\,(\\mathrm{i}k^{\\ast}u_{j+1})\n= \\frac{c_1}{h}\\left(u_{j+1} - u_{j-1}\\right) + \\frac{c_2}{h}\\left(u_{j+2} - u_{j-2}\\right).\n$$\nDivide both sides by $u_j$ and use $u_{j\\pm m}/u_j = \\exp(\\pm \\mathrm{i} m \\theta)$:\n$$\n\\mathrm{i}k^{\\ast}\\left[\\alpha \\exp(-\\mathrm{i}\\theta) + 1 + \\alpha \\exp(\\mathrm{i}\\theta)\\right]\n= \\frac{c_1}{h}\\left[\\exp(\\mathrm{i}\\theta) - \\exp(-\\mathrm{i}\\theta)\\right]\n+ \\frac{c_2}{h}\\left[\\exp(2\\mathrm{i}\\theta) - \\exp(-2\\mathrm{i}\\theta)\\right].\n$$\nUse the identities $\\exp(\\mathrm{i}\\theta) - \\exp(-\\mathrm{i}\\theta) = 2\\mathrm{i}\\sin\\theta$, $\\exp(2\\mathrm{i}\\theta) - \\exp(-2\\mathrm{i}\\theta) = 2\\mathrm{i}\\sin(2\\theta)$, and $\\alpha \\exp(-\\mathrm{i}\\theta) + 1 + \\alpha \\exp(\\mathrm{i}\\theta) = 1 + 2\\alpha \\cos\\theta$. Then\n$$\n\\mathrm{i}k^{\\ast}\\left(1 + 2\\alpha \\cos\\theta\\right)\n= \\frac{2\\mathrm{i}}{h}\\left(c_1 \\sin\\theta + c_2 \\sin(2\\theta)\\right),\n$$\nwhich yields the modified wavenumber\n$$\nk^{\\ast}(\\theta) = \\frac{2}{h}\\,\\frac{c_1 \\sin\\theta + c_2 \\sin(2\\theta)}{1 + 2\\alpha \\cos\\theta}.\n$$\nFor the derived coefficients $\\alpha = 1/4$, $c_1 = 3/4$, $c_2 = 0$, we obtain\n$$\nk^{\\ast}(\\theta) = \\frac{2}{h}\\,\\frac{\\frac{3}{4}\\sin\\theta}{1 + \\frac{1}{2}\\cos\\theta}\n= \\frac{3}{2h}\\,\\frac{\\sin\\theta}{1 + \\frac{1}{2}\\cos\\theta}.\n$$\n\nThis $k^{\\ast}(\\theta)$ is the spectral response of the compact scheme; its small-$\\theta$ expansion agrees with the exact wavenumber $\\kappa = \\theta/h$ through fourth order, confirming the formal accuracy.\n\nThe requested final result is the tuple of coefficients and the modified wavenumber function:\n$\\alpha = 1/4$, $c_1 = 3/4$, $c_2 = 0$, and $k^{\\ast}(\\theta) = \\frac{3}{2h}\\,\\frac{\\sin\\theta}{1 + \\frac{1}{2}\\cos\\theta}$.",
            "answer": "$$\\boxed{\\begin{pmatrix}\\frac{1}{4} & \\frac{3}{4} & 0 & \\frac{3}{2h}\\,\\frac{\\sin\\theta}{1 + \\frac{1}{2}\\cos\\theta}\\end{pmatrix}}$$"
        }
    ]
}