{
    "hands_on_practices": [
        {
            "introduction": "本节的第一个练习是计算科学的基石。它将指导你推导、实现并验证经典的二阶导数三点中心差分格式，用以求解一个简单但基础的边值问题()。掌握这一实践，你将为更复杂的模拟打下坚实的基础。",
            "id": "4087184",
            "problem": "考虑一个在计算复杂流体中建模压力修正时常见的一维空间标量场边值问题：求解在区间 $[0,1]$ 上的二阶常微分方程 $-u_{xx}=f$，其满足齐次狄利克雷边界条件 $u(0)=0$ 和 $u(1)=0$。从一个足够光滑函数的泰勒展开和微积分中导数的定义出发，推导一种均匀网格有限差分法（FDM），该方法使用三点拉普拉斯模板来近似内部网格点上的 $-u_{xx}$。证明该空间离散化的截断误差是关于网格间距的二阶精度。然后，实现一个数值求解器，在均匀网格上构造并求解所得到的线性系统，并通过经验验证该方法对于强迫项 $f(x)=\\sin(\\pi x)$ 表现出二阶收敛性，其中三角函数参数以弧度为单位。\n\n需要完成的任务：\n- 使用关于内部点 $x_i$ 的泰勒展开，在均匀网格间距 $h>0$ 的情况下，推导 $u_{xx}(x_i)$ 的三点离散近似，并推导出截断误差的主阶项。确定对 $-u_{xx}$ 的离散近似的精度阶数。\n- 对于具有 $N$ 个均匀子区间的区间 $[0,1]$，在所有内部网格点上应用此离散近似，建立所得的线性系统，其中 $h=1/N$，内部索引为 $i=1,2,\\dots,N-1$。精确地施加边界条件 $u(0)=0$ 和 $u(1)=0$。\n- 对于构造的强迫项 $f(x)=\\sin(\\pi x)$，使用常微分方程的基本积分法计算精确解 $u(x)$，并用它来评估数值误差。\n\n数值实验规范：\n- 将内部点的离散误差定义为数值解与精确解之差。计算离散 $L^2$ 范数误差为 $\\left(\\,h\\sum_{i=1}^{N-1} e_i^2\\,\\right)^{1/2}$，离散 $L^\\infty$ 范数误差为 $\\max_{1\\le i\\le N-1} |e_i|$。\n- 对于一系列具有 $N\\in\\{2,4,8,16,32,64\\}$ 的均匀网格，计算两种范数下的误差。通过 $p=\\dfrac{\\log(e(h_1)/e(h_2))}{\\log(h_1/h_2)}$ 估算网格间距为 $h_1$ 和 $h_2$ 的相继网格之间的观察收敛率，其中 $e(h)$ 表示网格尺寸为 $h$ 时的误差。\n- 确定两个布尔指标，定义如下：如果在 $L^2$ 范数下，对于配对 $(N,N')\\in\\{(8,16),(16,32),(32,64)\\}$ 的每个观察率都位于区间 $[1.9,2.1]$ 内，则 $converges\\_L2$ 为真；如果在 $L^\\infty$ 范数下同样成立，则 $converges\\_\\infty$ 为真。\n\n角度单位要求：\n- 所有三角函数求值必须使用弧度。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表由网格对 $(2,4)$、$(4,8)$、$(8,16)$、$(16,32)$、$(32,64)$ 在 $L^2$ 范数下的观察率序列，随后是相同网格对在 $L^\\infty$ 范数下的观察率序列，最后是两个布尔值 $converges\\_L2$ 和 $converges\\_\\infty$（按此顺序）组成。例如，输出应具有以下结构：$[p_{L^2}(2\\to 4),p_{L^2}(4\\to 8),p_{L^2}(8\\to 16),p_{L^2}(16\\to 32),p_{L^2}(32\\to 64),p_{\\infty}(2\\to 4),p_{\\infty}(4\\to 8),p_{\\infty}(8\\to 16),p_{\\infty}(16\\to 32),p_{\\infty}(32\\to 64),converges\\_L2,converges\\_\\infty]$。",
            "solution": "该问题是有效的，因为它在科学上基于微分方程和数值分析理论，是适定的并具有唯一解，且其陈述客观，要求清晰、可形式化。它提出了一个推导、实现和验证一维泊松方程有限差分法的标准练习。\n\n解答按要求分三部分展开：数值格式及其截断误差的推导，所得线性系统的建立，以及给定强迫项的精确解的确定。随后是对数值实现的描述。\n\n**第一部分：三点模板和截断误差的推导**\n\n我们寻求在间距为 $h > 0$ 的均匀网格上近似内部网格点 $x_i$ 处的二阶导数 $u_{xx}$。网格点定义为 $x_j = j h$，其中 $j$ 为整数。我们使用泰勒定理在 $x_i$ 周围展开函数 $u(x)$。对于一个足够光滑的函数 $u$，$u(x_i+h)$ 和 $u(x_i-h)$ 的展开式为：\n$$ u(x_i+h) = u(x_{i+1}) = u(x_i) + h u'(x_i) + \\frac{h^2}{2!} u''(x_i) + \\frac{h^3}{3!} u'''(x_i) + \\frac{h^4}{4!} u^{(4)}(x_i) + O(h^5) $$\n$$ u(x_i-h) = u(x_{i-1}) = u(x_i) - h u'(x_i) + \\frac{h^2}{2!} u''(x_i) - \\frac{h^3}{3!} u'''(x_i) + \\frac{h^4}{4!} u^{(4)}(x_i) + O(h^5) $$\n将这两个方程相加可以消去奇数阶导数项：\n$$ u(x_{i-1}) + u(x_{i+1}) = 2u(x_i) + h^2 u''(x_i) + \\frac{2h^4}{24} u^{(4)}(x_i) + O(h^6) $$\n重新整理以求解 $u''(x_i)$，我们得到：\n$$ u''(x_i) = \\frac{u(x_{i-1}) - 2u(x_i) + u(x_{i+1})}{h^2} - \\frac{h^2}{12} u^{(4)}(x_i) + O(h^4) $$\n二阶导数的中心有限差分近似，记为 $\\delta_x^2 u(x_i)$，是此表达式中的主项：\n$$ \\delta_x^2 u(x_i) = \\frac{u(x_{i-1}) - 2u(x_i) + u(x_{i+1})}{h^2} $$\n截断误差 $\\tau_i$ 是精确导数与其有限差分近似之间的差：\n$$ \\tau_i = u''(x_i) - \\delta_x^2 u(x_i) = -\\frac{h^2}{12} u^{(4)}(x_i) + O(h^4) $$\n截断误差的主阶项与 $h^2$ 成正比。因此，该近似是二阶精度的。微分方程为 $-u_{xx} = f$。我们使用推导出的模板的负值来近似 $-u_{xx}$：\n$$ -u_{xx}(x_i) \\approx \\frac{-u(x_{i-1}) + 2u(x_i) - u(x_{i+1})}{h^2} $$\n这个对 $-u_{xx}$ 的三点模板近似也是二阶精度的，其主阶截断误差为 $\\frac{h^2}{12} u^{(4)}(x_i)$。\n\n**第二部分：线性系统的建立**\n\n我们使用 $N$ 个子区间来离散化定义域 $[0,1]$，使得网格间距为 $h=1/N$。网格点为 $x_i = i h$，其中 $i=0, 1, \\dots, N$。解是在内部点 $x_i$（$i=1, 2, \\dots, N-1$）处求解的。设 $u_i$ 是 $u(x_i)$ 的数值近似，并设 $f_i = f(x_i)$。\n\n在每个内部网格点 $x_i$ 应用有限差分近似：\n$$ \\frac{-u_{i-1} + 2u_i - u_{i+1}}{h^2} = f_i, \\quad \\text{for } i=1, 2, \\dots, N-1 $$\n齐次狄利克雷边界条件是 $u(0)=0$ 和 $u(1)=0$，这意味着 $u_0=0$ 和 $u_N=0$。我们将这些条件代入 $i=1$ 和 $i=N-1$ 的方程中：\n对于 $i=1$:\n$$ \\frac{-u_0 + 2u_1 - u_2}{h^2} = f_1 \\implies \\frac{2u_1 - u_2}{h^2} = f_1 $$\n对于 $i=N-1$:\n$$ \\frac{-u_{N-2} + 2u_{N-1} - u_N}{h^2} = f_{N-1} \\implies \\frac{-u_{N-2} + 2u_{N-1}}{h^2} = f_{N-1} $$\n这个包含 $N-1$ 个线性方程的方程组可以写成矩阵形式 $A\\mathbf{u} = \\mathbf{b}$，其中 $\\mathbf{u} = [u_1, u_2, \\dots, u_{N-1}]^T$ 是未知解值的向量，$\\mathbf{b} = [f_1, f_2, \\dots, f_{N-1}]^T$ 是强迫项值的向量，而 $A$ 是一个 $(N-1) \\times (N-1)$ 的系数矩阵。\n$$ A = \\frac{1}{h^2} \\begin{pmatrix}\n2  -1  0  \\cdots  0  0 \\\\\n-1  2  -1  \\cdots  0  0 \\\\\n0  -1  2  \\ddots  \\vdots  \\vdots \\\\\n\\vdots  \\vdots  \\ddots  \\ddots  -1  0 \\\\\n0  0  \\cdots  -1  2  -1 \\\\\n0  0  \\cdots  0  -1  2\n\\end{pmatrix} $$\n该矩阵是对称、正定且三对角的。该线性系统有唯一解，可以通过数值方法求得。\n\n**第三部分：精确解**\n\n给定强迫项 $f(x) = \\sin(\\pi x)$，微分方程为 $-u_{xx} = \\sin(\\pi x)$。我们通过对 $x$ 积分两次来求解。\n第一次积分：\n$$ -u_x = \\int \\sin(\\pi x) \\,dx = -\\frac{1}{\\pi}\\cos(\\pi x) + C_1 $$\n$$ u_x = \\frac{1}{\\pi}\\cos(\\pi x) - C_1 $$\n第二次积分：\n$$ u(x) = \\int \\left(\\frac{1}{\\pi}\\cos(\\pi x) - C_1\\right) dx = \\frac{1}{\\pi^2}\\sin(\\pi x) - C_1 x + C_2 $$\n现在我们应用边界条件来求解积分常数 $C_1$ 和 $C_2$。\n在 $x=0$ 处，$u(0)=0$：\n$$ u(0) = \\frac{1}{\\pi^2}\\sin(0) - C_1(0) + C_2 = 0 \\implies C_2=0 $$\n在 $x=1$ 处，$u(1)=0$：\n$$ u(1) = \\frac{1}{\\pi^2}\\sin(\\pi) - C_1(1) + 0 = 0 \\implies 0 - C_1 = 0 \\implies C_1=0 $$\n因此，该边值问题的精确解为：\n$$ u(x) = \\frac{1}{\\pi^2}\\sin(\\pi x) $$\n\n**数值实验**\n\n为了验证该方法的二阶收敛性，我们进行一个数值实验。对于一系列网格，其中 $N \\in \\{2, 4, 8, 16, 32, 64\\}$，我们求解线性系统 $A\\mathbf{u}=\\mathbf{b}$ 以找到数值解 $\\mathbf{u}$。然后，我们计算内部网格点上的精确解，并计算误差向量 $\\mathbf{e} = \\mathbf{u} - \\mathbf{u}_{\\text{exact}}$。计算离散 $L^2$ 和 $L^\\infty$ 误差范数。两个网格间距分别为 $h_1$ 和 $h_2$（其中 $h_1=2h_2$）的相继网格之间的收敛率 $p$ 通过 $p = \\log_2(e(h_1)/e(h_2))$ 来估算。由于该方法是二阶精度的，我们期望当 $h \\to 0$ 时 $p$ 趋近于 $2$。布尔指标 $converges\\_L2$ 和 $converges\\_\\infty$ 的评估基于最精细的三次网格加密的观察率是否落在区间 $[1.9, 2.1]$ 内。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives, implements, and verifies a second-order finite difference method\n    for the 1D Poisson equation -u_xx = f on [0,1] with u(0)=u(1)=0.\n    \"\"\"\n    \n    N_values = [2, 4, 8, 16, 32, 64]\n    l2_errors = {}\n    linf_errors = {}\n\n    for N in N_values:\n        # 1. Setup grid and parameters\n        h = 1.0 / N\n        # Interior grid points from x_1 to x_{N-1}\n        x_interior = np.linspace(h, 1.0 - h, N - 1)\n\n        # 2. Construct the linear system A*u = f\n        # Construct the (N-1)x(N-1) matrix A for -d^2/dx^2\n        # A = (1/h^2) * Tridiag(-1, 2, -1)\n        A = (2.0 * np.eye(N - 1) - np.eye(N - 1, k=1) - np.eye(N - 1, k=-1)) / h**2\n\n        # Construct the right-hand side vector f\n        f = np.sin(np.pi * x_interior)\n\n        # 3. Solve the linear system for the numerical solution\n        u_numerical = np.linalg.solve(A, f)\n\n        # 4. Compute the exact solution\n        u_exact = (1.0 / np.pi**2) * np.sin(np.pi * x_interior)\n\n        # 5. Compute errors\n        errors = u_numerical - u_exact\n        \n        # Discrete L2-norm: (h * sum(e_i^2))^(1/2)\n        l2_err = np.sqrt(h * np.sum(errors**2))\n        \n        # Discrete L-infinity norm: max|e_i|\n        linf_err = np.max(np.abs(errors))\n        \n        l2_errors[N] = l2_err\n        linf_errors[N] = linf_err\n\n    # 6. Calculate convergence rates\n    l2_rates = []\n    linf_rates = []\n    for i in range(len(N_values) - 1):\n        N1 = N_values[i]\n        N2 = N_values[i+1]\n        \n        h1 = 1.0 / N1\n        h2 = 1.0 / N2\n\n        # Rate formula: p = log(error(h1)/error(h2)) / log(h1/h2)\n        # Since h1/h2 is always 2, this simplifies to log2(error_ratio).\n        rate_l2 = np.log2(l2_errors[N1] / l2_errors[N2])\n        l2_rates.append(rate_l2)\n        \n        rate_linf = np.log2(linf_errors[N1] / linf_errors[N2])\n        linf_rates.append(rate_linf)\n\n    # 7. Check convergence criteria for the last three refinements\n    # These correspond to pairs (8,16), (16,32), (32,64)\n    # The rates list has indices 0, 1, 2, 3, 4 for pairs (2,4), (4,8), (8,16), (16,32), (32,64)\n    # So we check rates at indices 2, 3, 4.\n    relevant_l2_rates = l2_rates[2:]\n    relevant_linf_rates = linf_rates[2:]\n    \n    converges_L2 = all(1.9 = r = 2.1 for r in relevant_l2_rates)\n    converges_infty = all(1.9 = r = 2.1 for r in relevant_linf_rates)\n\n    # 8. Format and print the final output\n    # The order is: 5 L2 rates, 5 L-inf rates, 2 booleans\n    results = l2_rates + linf_rates + [converges_L2, converges_infty]\n    \n    # Map all items to string for printing\n    # Booleans will be converted to 'True' or 'False'\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "真实的复杂流体通常涉及不同材料间的界面，导致物理性质的间断。本练习旨在应对这一挑战，通过求解一个带有间断系数的扩散问题，对比了物理上精确的守恒格式与一个简化的非守恒格式()。这一实践突显了守恒律在数值方法中的至关重要性。",
            "id": "4087183",
            "problem": "考虑一个由守恒定律控制的标量场 $\\,\\phi(x)\\,$ 的一维稳态扩散\n$$\\frac{d}{dx}\\left(\\mu(x)\\,\\frac{d\\phi}{dx}\\right)=q(x),$$\n其中 $\\,\\mu(x)0\\,$ 是扩散系数，$\\,q(x)\\,$ 是给定的体积源。在复杂流体中，由于微观结构的变化，$\\,\\mu(x)\\,$ 可能会在材料界面上表现出不连续性。假设在一个长度为 $\\,L\\,$ 的域上有一个包含 $\\,N\\,$ 个节点的均匀计算网格，节点间距为 $\\,\\Delta x = L/(N-1)\\,$。设扩散系数为分段常数，\n$$\n\\mu(x)=\\begin{cases}\n\\mu_L, x\\le x_\\mathrm{int},\\\\\n\\mu_R, xx_\\mathrm{int},\n\\end{cases}\n$$\n材料界面与节点 $\\,i=j_\\mathrm{int}\\,$ 和 $\\,i=j_\\mathrm{int}+1\\,$ 之间的单个内表面对齐，因此 $\\,x_\\mathrm{int}=\\tfrac{1}{2}(x_{j_\\mathrm{int}}+x_{j_\\mathrm{int}+1})\\,$。施加狄利克雷(Dirichlet)边界条件 $\\,\\phi(0)=\\phi_L\\,$ 和 $\\,\\phi(L)=\\phi_R\\,$，并取常数源 $\\,q(x)\\equiv q\\,$。\n\n从每个控制体积 $[x_{i-1/2}, x_{i+1/2}]$ 上的守恒定律积分形式和扩散通量 $\\,F=-\\mu\\,\\frac{d\\phi}{dx}\\,$ 的定义出发，推导两种空间离散化方法：\n\n- 一种守恒通量格式，它表示每个面上的界面通量，并强制通过共享面的通量具有唯一值。对 $\\,\\mu\\,$ 使用一种一致的面插值方法，该方法仅依赖于 $\\,\\mu_L\\,$ 和 $\\,\\mu_R\\,$，并且对于不连续系数尊重单调性。\n\n- 一种非守恒的逐点系数格式，它将二阶导数近似值乘以 $\\,\\mu\\,$ 的节点值。\n\n使用两种离散化方法在相同的网格和参数集上求解得到的 $\\,\\phi\\,$ 线性系统，然后计算单个材料界面处的通量跳跃度量。使用索引 $\\,j_\\mathrm{int}\\,$ 定义界面，使得不连续性位于节点 $\\,j_\\mathrm{int}\\,$ 和 $\\,j_\\mathrm{int}+1\\,$ 之间。对于守恒离散化，使用唯一的面通量计算左侧单元穿过界面面的向外通量和右侧单元穿过同一面的向外通量；通过报告这两个向外通量之和的绝对值来验证通量连续性。对于非守恒离散化，通过将界面上的相同离散梯度分别乘以 $\\,\\mu_L\\,$ 和 $\\,\\mu_R\\,$，计算界面处的两个不同本构面通量，并报告它们差值的绝对值。\n\n您的程序必须实现这两种离散化方法，求解线性系统，并为以下参数集测试套件 $\\,\\{L,N,\\mu_L,\\mu_R,j_\\mathrm{int},\\phi_L,\\phi_R,q\\}\\,$ 生成所要求的通量跳跃度量：\n\n- 测试用例 $\\,1\\,$ (一般不连续性，无源)：$\\,\\{L=1.0, N=33, \\mu_L=1.0, \\mu_R=10.0, j_\\mathrm{int}=16, \\phi_L=0.0, \\phi_R=1.0, q=0.0\\}\\,$。\n- 测试用例 $\\,2\\,$ (高对比度，反向边界值，无源)：$\\,\\{L=1.0, N=65, \\mu_L=0.1, \\mu_R=100.0, j_\\mathrm{int}=32, \\phi_L=1.0, \\phi_R=0.0, q=0.0\\}\\,$。\n- 测试用例 $\\,3\\,$ (无不连续性，无源)：$\\,\\{L=1.0, N=41, \\mu_L=2.0, \\mu_R=2.0, j_\\mathrm{int}=20, \\phi_L=0.0, \\phi_R=1.0, q=0.0\\}\\,$。\n- 测试用例 $\\,4\\,$ (一般不连续性，非零源)：$\\,\\{L=2.0, N=81, \\mu_L=1.0, \\mu_R=10.0, j_\\mathrm{int}=40, \\phi_L=0.0, \\phi_R=0.0, q=5.0\\}\\,$。\n\n对于每个测试用例，输出一个数对 $[\\mathrm{J}_\\mathrm{cons},\\mathrm{J}_\\mathrm{noncons}]$，其中 $\\,\\mathrm{J}_\\mathrm{cons}\\,$ 是使用守恒离散化计算的、与界面面相邻的两个单元的向外通量之和的绝对值，而 $\\,\\mathrm{J}_\\mathrm{noncons}\\,$ 是使用非守恒离散化、通过 $\\,\\mu_L\\,$ 和 $\\,\\mu_R\\,$ 计算的两个本构面通量之差的绝对值。您的程序应生成单行输出，其中包含结果，格式为方括号括起来的、以逗号分隔的数对列表（例如，$\\,[[\\mathrm{J}_{1,\\mathrm{cons}},\\mathrm{J}_{1,\\mathrm{noncons}}],[\\mathrm{J}_{2,\\mathrm{cons}},\\mathrm{J}_{2,\\mathrm{noncons}}],\\dots]\\,$）。不需要物理单位；不使用角度；不要使用百分号表示任何量。",
            "solution": "该问题是有效的，因为它具有科学依据、提法明确且客观。它是一个计算输运现象中的标准练习，对比了用于具有不连续系数的扩散方程的守恒和非守恒数值格式。所有参数和条件都已明确定义。\n\n分析首先建立一个以单元为中心的有限体积框架。长度为 $\\,L\\,$ 的一维域被离散为 $\\,N\\,$ 个节点，节点位置为 $\\,x_i = i\\,\\Delta x\\,$，其中 $\\,i=0, 1, \\dots, N-1\\,$，$\\,\\Delta x = L/(N-1)\\,$。对于每个内部节点 $\\,i\\,$，我们定义一个控制体积 $\\,V_i = [x_{i-1/2}, x_{i+1/2}]\\,$，其中控制体的面位于节点之间的中点，即 $\\,x_{i \\pm 1/2} = x_i \\pm \\Delta x/2\\,$。\n\n控制方程是标量场 $\\,\\phi(x)\\,$ 的稳态守恒定律：\n$$ \\frac{d}{dx}\\left(\\mu(x)\\,\\frac{d\\phi}{dx}\\right) = q(x) $$\n扩散通量定义为 $\\,F(x) = -\\mu(x)\\,\\frac{d\\phi}{dx}\\,$。控制方程可以用通量重写为 $\\,-\\frac{dF}{dx} = q(x)\\,$。\n\n### 守恒有限体积离散化\n\n该格式源自守恒定律在任意控制体积 $\\,V_i\\,$ 上的积分形式：\n$$ \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{d}{dx}\\left(\\mu(x)\\,\\frac{d\\phi}{dx}\\right) dx = \\int_{x_{i-1/2}}^{x_{i+1/2}} q(x) dx $$\n对左侧应用微积分基本定理可得：\n$$ \\left[\\mu(x)\\,\\frac{d\\phi}{dx}\\right]_{x_{i-1/2}}^{x_{i+1/2}} = q \\cdot \\Delta x $$\n这里我们假设 $\\,q(x)\\,$ 是一个常数 $\\,q\\,$。这表示了穿过控制体面的通量平衡：\n$$ \\left(\\mu\\frac{d\\phi}{dx}\\right)_{i+1/2} - \\left(\\mu\\frac{d\\phi}{dx}\\right)_{i-1/2} = q \\Delta x $$\n用通量 $\\,F\\,$ 表示，即为 $\\,F_{i-1/2} - F_{i+1/2} = q \\Delta x\\,$。\n\n每个面上的通量使用 $\\,\\phi\\,$ 节点值的中心差分来近似：\n$$ F_{i+1/2} = -\\left(\\mu\\frac{d\\phi}{dx}\\right)_{i+1/2} \\approx -\\mu_{i+1/2} \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x} $$\n此处，$\\,\\mu_{i+1/2}\\,$ 是节点 $\\,i\\,$ 和 $\\,i+1\\,$ 之间面上的扩散系数。将此近似代入内部节点 $\\,i \\in \\{1, \\dots, N-2\\}\\,$ 的通量平衡方程，可得：\n$$ -\\mu_{i+1/2} \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x} - \\left(-\\mu_{i-1/2} \\frac{\\phi_i - \\phi_{i-1}}{\\Delta x}\\right) = q \\Delta x $$\n整理后可得到关于 $\\,\\phi_i\\,$ 的线性方程：\n$$ \\mu_{i-1/2} \\phi_{i-1} - (\\mu_{i-1/2} + \\mu_{i+1/2}) \\phi_i + \\mu_{i+1/2} \\phi_{i+1} = q (\\Delta x)^2 $$\n该方法守恒性的关键在于面扩散率 $\\,\\mu_{i+1/2}\\,$ 的定义。问题陈述，材料界面位于 $\\,x_\\mathrm{int} = x_{j_\\mathrm{int}+1/2}\\,$，分隔了系数分别为 $\\,\\mu_L\\,$ 和 $\\,\\mu_R\\,$ 的区域。\n- 如果位于 $\\,x_{i+1/2}\\,$ 的面不是材料界面，则其上的系数是恒定的：若 $\\,i  j_\\mathrm{int}\\,$，则 $\\,\\mu_{i+1/2} = \\mu_L\\,$；若 $\\,i  j_\\mathrm{int}\\,$，则 $\\,\\mu_{i+1/2} = \\mu_R\\,$。\n- 在界面面 $\\,x_{j_\\mathrm{int}+1/2}\\,$ 处，一个能保证通量连续性且对不连续系数满足单调性的一致插值是调和平均值：\n$$ \\mu_{j_\\mathrm{int}+1/2} = \\left(\\frac{1-f}{\\mu_L} + \\frac{f}{\\mu_R}\\right)^{-1} $$\n由于界面位于节点之间的中点（$\\,f=1/2\\,$），这可以简化为：\n$$ \\mu_{j_\\mathrm{int}+1/2} = \\frac{2\\mu_L\\mu_R}{\\mu_L+\\mu_R} $$\n这一选择确保了数值通量 $\\,F_{j_\\mathrm{int}+1/2}\\,$ 具有单一的、唯一的值，从而强制实现了物理守恒。\n\n内部节点 $\\,\\phi_1, \\dots, \\phi_{N-2}\\,$ 的线性方程组构成一个三对角系统 $\\,A\\boldsymbol{\\phi} = \\mathbf{b}\\,$。通过将相应项移到右侧向量 $\\,\\mathbf{b}\\,$ 中，来引入狄利克雷(Dirichlet)边界条件 $\\,\\phi_0 = \\phi_L\\,$ 和 $\\,\\phi_{N-1} = \\phi_R\\,$。\n\n### 非守恒逐点系数离散化\n\n该方法从控制方程的展开形式出发：$\\,\\mu\\,\\frac{d^2\\phi}{dx^2} + \\frac{d\\mu}{dx}\\frac{d\\phi}{dx} = q\\,$。非守恒格式通过近似项 $\\,\\mu(x_i) \\frac{d^2\\phi}{dx^2}\\,$ 并忽略涉及 $\\,\\frac{d\\mu}{dx}\\,$ 的项，在每个节点 $\\,i\\,$ 上对该方程进行离散化。在 $\\,\\mu\\,$ 不是常数的地方，这种做法在形式上是不正确的。\n对二阶导数使用标准的中心差分，离散方程变为：\n$$ \\mu_i \\frac{\\phi_{i-1} - 2\\phi_i + \\phi_{i+1}}{(\\Delta x)^2} = q $$\n其中 $\\,\\mu_i = \\mu(x_i)\\,$ 是扩散系数的节点值。根据 $\\,\\mu(x)\\,$ 的定义，我们有：\n$$ \\mu_i = \\begin{cases} \\mu_L,  i \\le j_\\mathrm{int} \\\\ \\mu_R,  i  j_\\mathrm{int} \\end{cases} $$\n对内部节点 $\\,i \\in \\{1, \\dots, N-2\\}\\,$ 进行整理，可得：\n$$ \\mu_i \\phi_{i-1} - 2\\mu_i \\phi_i + \\mu_i \\phi_{i+1} = q (\\Delta x)^2 $$\n这也为未知数 $\\,\\phi'_1, \\dots, \\phi'_{N-2}\\,$ 构成一个三对角系统 $\\,A'\\boldsymbol{\\phi}' = \\mathbf{b}'\\,$，边界条件的处理方式类似。\n\n### 通量跳跃度量\n\n我们分析界面面 $\\,x_{j_\\mathrm{int}+1/2}\\,$ 处的通量连续性。\n\n对于**守恒格式**，界面面上的通量唯一定义为：\n$$ F_\\mathrm{cons} = -\\mu_{j_\\mathrm{int}+1/2} \\frac{\\phi_{j_\\mathrm{int}+1} - \\phi_{j_\\mathrm{int}}}{\\Delta x} $$\n其中 $\\,\\mu_{j_\\mathrm{int}+1/2}\\,$ 是调和平均值。左侧单元（$\\,V_{j_\\mathrm{int}}\\,$）在该面上的向外通量为 $\\,+F_\\mathrm{cons}\\,$。右侧单元（$\\,V_{j_\\mathrm{int}+1}\\,$）在同个面上的向外通量为 $\\,-F_\\mathrm{cons}\\,$。根据构造，这两个向外通量之和为零。度量 $\\,J_\\mathrm{cons}\\,$ 是该和的绝对值：\n$$ J_\\mathrm{cons} = |(+F_\\mathrm{cons}) + (-F_\\mathrm{cons})| = 0 $$\n这反映了该格式的局部守恒性质。\n\n对于**非守恒格式**，界面处没有唯一的通量定义。可以根据考虑的是界面的哪一侧来定义两种不同的本构通量。使用相同的梯度近似，但使用不同的局部系数：\n- 从左侧材料的角度看通量：$\\,F_L = -\\mu_L \\frac{\\phi'_{j_\\mathrm{int}+1} - \\phi'_{j_\\mathrm{int}}}{\\Delta x}\\,$\n- 从右侧材料的角度看通量：$\\,F_R = -\\mu_R \\frac{\\phi'_{j_\\mathrm{int}+1} - \\phi'_{j_\\mathrm{int}}}{\\Delta x}\\,$\n非守恒格式在计算出的通量中产生一个跳跃，度量 $\\,J_\\mathrm{noncons}\\,$ 是这个物理上不正确的跳跃的绝对值：\n$$ J_\\mathrm{noncons} = |F_L - F_R| = |\\mu_R - \\mu_L| \\left|\\frac{\\phi'_{j_\\mathrm{int}+1} - \\phi'_{j_\\mathrm{int}}}{\\Delta x}\\right| $$\n当 $\\,\\mu_L \\ne \\mu_R\\,$ 时，该值通常不为零，表明违反了守恒原理。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares conservative and non-conservative finite difference\n    schemes for a 1D steady diffusion problem with a discontinuous coefficient.\n    \"\"\"\n    test_cases = [\n        # (L, N, mu_L, mu_R, j_int, phi_L, phi_R, q)\n        (1.0, 33, 1.0, 10.0, 16, 0.0, 1.0, 0.0),\n        (1.0, 65, 0.1, 100.0, 32, 1.0, 0.0, 0.0),\n        (1.0, 41, 2.0, 2.0, 20, 0.0, 1.0, 0.0),\n        (2.0, 81, 1.0, 10.0, 40, 0.0, 0.0, 5.0),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        L, N, mu_L, mu_R, j_int, phi_L, phi_R, q = case\n        \n        dx = L / (N - 1)\n        num_unknowns = N - 2\n\n        # --- CONSERVATIVE SCHEME ---\n        \n        # 1. Setup face diffusivities\n        mu_face = np.zeros(N - 1)\n        # Faces in the left material region\n        if j_int  0:\n            mu_face[0:j_int] = mu_L\n        # Interface face (harmonic mean)\n        if mu_L + mu_R  0:\n            mu_face[j_int] = (2 * mu_L * mu_R) / (mu_L + mu_R)\n        else: # Handle case of both mu are zero\n            mu_face[j_int] = 0.0\n        # Faces in the right material region\n        if j_int  N - 2:\n            mu_face[j_int + 1:] = mu_R\n\n        # 2. Assemble the linear system A*phi = b\n        A_cons = np.zeros((num_unknowns, num_unknowns))\n        b_cons = np.full(num_unknowns, q * dx**2)\n\n        # Main diagonal\n        diag_main = -(mu_face[0:num_unknowns] + mu_face[1:num_unknowns+1])\n        # Lower diagonal\n        diag_lower = mu_face[0:num_unknowns-1]\n        # Upper diagonal\n        diag_upper = mu_face[1:num_unknowns]\n\n        np.fill_diagonal(A_cons, diag_main)\n        np.fill_diagonal(A_cons[1:], diag_lower)\n        np.fill_diagonal(A_cons[:,1:], diag_upper)\n\n        # Apply boundary conditions\n        b_cons[0] -= mu_face[0] * phi_L\n        b_cons[-1] -= mu_face[-1] * phi_R\n\n        # 3. Solve for interior phi values and construct full solution vector\n        phi_internal_cons = np.linalg.solve(A_cons, b_cons)\n        phi_cons = np.concatenate(([phi_L], phi_internal_cons, [phi_R]))\n\n        # 4. Calculate flux-jump metric\n        flux_grad_cons = (phi_cons[j_int + 1] - phi_cons[j_int]) / dx\n        flux_cons = -mu_face[j_int] * flux_grad_cons\n        # Sum of outward fluxes from cell j_int and cell j_int+1 at the interface\n        J_cons = abs(flux_cons + (-flux_cons))\n\n\n        # --- NON-CONSERVATIVE SCHEME ---\n\n        # 1. Setup nodal diffusivities\n        mu_node = np.zeros(N)\n        mu_node[:j_int + 1] = mu_L\n        mu_node[j_int + 1:] = mu_R\n\n        # 2. Assemble the linear system A'*phi' = b'\n        A_noncons = np.zeros((num_unknowns, num_unknowns))\n        b_noncons = np.full(num_unknowns, q * dx**2)\n        \n        # Coefficients depend on mu_i for the equation at node i\n        mu_internal = mu_node[1:-1]\n        \n        # Main diagonal\n        diag_main_nc = -2.0 * mu_internal\n        # Lower diagonal\n        diag_lower_nc = mu_internal[1:]\n        # Upper diagonal\n        diag_upper_nc = mu_internal[:-1]\n\n        # Populate matrix A'\n        A_noncons = (np.diag(diag_main_nc) + \n                     np.diag(diag_upper_nc, k=1) + \n                     np.diag(diag_lower_nc, k=-1))\n\n        # Apply boundary conditions\n        b_noncons[0] -= mu_node[1] * phi_L\n        b_noncons[-1] -= mu_node[-2] * phi_R\n\n        # 3. Solve for interior phi' values and construct full solution vector\n        phi_internal_noncons = np.linalg.solve(A_noncons, b_noncons)\n        phi_noncons = np.concatenate(([phi_L], phi_internal_noncons, [phi_R]))\n\n        # 4. Calculate flux-jump metric\n        flux_grad_noncons = (phi_noncons[j_int + 1] - phi_noncons[j_int]) / dx\n        flux_L = -mu_L * flux_grad_noncons\n        flux_R = -mu_R * flux_grad_noncons\n        J_noncons = abs(flux_L - flux_R)\n\n        results.append([J_cons, J_noncons])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "虽然二阶精度通常已足够，但某些问题为了精确捕捉复杂现象，需要更高的计算精度。这个解析练习将展示如何利用泰勒级数展开，系统性地构建高阶有限差分格式()。这项技能对于开发针对特定科学挑战的高级数值方法至关重要。",
            "id": "4087170",
            "problem": "在计算复杂流体中，本构模型和相场公式中出现的类扩散项需要精确的空间离散化，以便在没有过多数值耗散的情况下解析陡峭的梯度。考虑一个光滑标量场 $u(x)$，它代表（例如）复杂流体模型一维切片中的相场分量或应力势。在一个节点为 $x_i = x_0 + i h$、网格间距为 $h  0$ 的均匀网格上，假设在有限差分法 (FDM) 的直线法离散化中，需要高精度地计算二阶导数 $u_{xx}(x_i)$。\n\n通过构建节点值 $u_{i-2}, u_{i-1}, u_i, u_{i+1}, u_{i+2}$ 的线性组合再除以 $h^2$ 的形式，构造一个四阶精度的中心五点格式来近似 $u_{xx}(x_i)$，其中 $u_j = u(x_j)$。通过确保与微分算子的一致性，并通过适当消除低阶项以达到 $\\mathcal{O}(h^4)$ 阶的截断误差，来确定作为有理常数的显式系数。将最终答案表示为关于 $u_{i-2}, u_{i-1}, u_i, u_{i+1}, u_{i+2}$ 和 $h$ 的近似值 $\\widehat{u_{xx}}(x_i)$ 的单个闭式解析表达式。不需要四舍五入。",
            "solution": "该问题要求为二阶导数 $u_{xx}(x_i)$ 构建一个四阶精度的中心五点有限差分格式。在间距为 $h$ 的均匀网格上，使用节点值 $u_j = u(x_j)$，该格式的一般形式由下式给出：\n$$ \\widehat{u_{xx}}(x_i) = \\frac{1}{h^2} \\left( c_{-2} u_{i-2} + c_{-1} u_{i-1} + c_0 u_i + c_1 u_{i+1} + c_2 u_{i+2} \\right) $$\n对于中心格式，对称性要求系数关于中心点 $i$ 对称。因此，我们必须有 $c_{-1} = c_1$ 和 $c_{-2} = c_2$。这可将表达式简化为：\n$$ \\widehat{u_{xx}}(x_i) = \\frac{1}{h^2} \\left[ c_0 u_i + c_1 (u_{i-1} + u_{i+1}) + c_2 (u_{i-2} + u_{i+2}) \\right] $$\n为了确定未知系数 $c_0$、$c_1$ 和 $c_2$，我们对每个 $u_{i+j}$ 项在点 $x_i$ 附近进行泰勒级数展开。我们将 $u^{(n)}(x_i)$ 记为 $u_i^{(n)}$。展开式如下：\n$$ u_{i+j} = u(x_i + jh) = u_i + (jh) u_i^{(1)} + \\frac{(jh)^2}{2!} u_i^{(2)} + \\frac{(jh)^3}{3!} u_i^{(3)} + \\frac{(jh)^4}{4!} u_i^{(4)} + \\frac{(jh)^5}{5!} u_i^{(5)} + \\frac{(jh)^6}{6!} u_i^{(6)} + \\mathcal{O}(h^7) $$\n由于格式的对称性，当我们将 $u_{i-j}$ 和 $u_{i+j}$ 对相加时，奇数阶导数项会相互抵消。让我们来计算这些和：\n对于 $j=1$：\n$$ u_{i-1} + u_{i+1} = \\left( u_i - h u_i^{(1)} + \\frac{h^2}{2} u_i^{(2)} - \\frac{h^3}{6} u_i^{(3)} + \\frac{h^4}{24} u_i^{(4)} - \\frac{h^5}{120} u_i^{(5)} + \\frac{h^6}{720} u_i^{(6)} \\right) + \\left( u_i + h u_i^{(1)} + \\frac{h^2}{2} u_i^{(2)} + \\frac{h^3}{6} u_i^{(3)} + \\frac{h^4}{24} u_i^{(4)} + \\frac{h^5}{120} u_i^{(5)} + \\frac{h^6}{720} u_i^{(6)} \\right) + \\mathcal{O}(h^8) $$\n$$ u_{i-1} + u_{i+1} = 2u_i + h^2 u_i^{(2)} + \\frac{h^4}{12} u_i^{(4)} + \\frac{h^6}{360} u_i^{(6)} + \\mathcal{O}(h^8) $$\n对于 $j=2$：\n$$ u_{i-2} + u_{i+2} = 2u_i + (2h)^2 u_i^{(2)} + \\frac{(2h)^4}{12} u_i^{(4)} + \\frac{(2h)^6}{360} u_i^{(6)} + \\mathcal{O}(h^8) $$\n$$ u_{i-2} + u_{i+2} = 2u_i + 4h^2 u_i^{(2)} + \\frac{16h^4}{12} u_i^{(4)} + \\frac{64h^6}{360} u_i^{(6)} + \\mathcal{O}(h^8) = 2u_i + 4h^2 u_i^{(2)} + \\frac{4h^4}{3} u_i^{(4)} + \\frac{8h^6}{45} u_i^{(6)} + \\mathcal{O}(h^8) $$\n现在，我们将这些求和后的展开式代回格式公式中：\n$$ h^2 \\widehat{u_{xx}}(x_i) = c_0 u_i + c_1 \\left( 2u_i + h^2 u_i^{(2)} + \\frac{h^4}{12} u_i^{(4)} + \\frac{h^6}{360} u_i^{(6)} \\right) + c_2 \\left( 2u_i + 4h^2 u_i^{(2)} + \\frac{4h^4}{3} u_i^{(4)} + \\frac{8h^6}{45} u_i^{(6)} \\right) + \\dots $$\n我们收集与 $u$ 在 $x_i$ 处的各阶导数相对应的项：\n$$ h^2 \\widehat{u_{xx}}(x_i) = (c_0 + 2c_1 + 2c_2) u_i + (c_1 h^2 + 4c_2 h^2) u_i^{(2)} + \\left( \\frac{c_1 h^4}{12} + \\frac{4c_2 h^4}{3} \\right) u_i^{(4)} + \\left( \\frac{c_1 h^6}{360} + \\frac{8c_2 h^6}{45} \\right) u_i^{(6)} + \\dots $$\n为了使近似值与二阶导数 $u_i^{(2)}$ 一致，并且截断误差为 $\\mathcal{O}(h^4)$ 阶，我们必须对导数的系数强制执行以下条件：\n1.  $u_i$ 的系数：和必须为 $0$。\n    $$ c_0 + 2c_1 + 2c_2 = 0 $$\n2.  $u_i^{(2)}$ 的系数：和必须为 $h^2$，这样当除以 $h^2$ 时，$u_i^{(2)}$ 的系数变为 $1$。\n    $$ c_1 h^2 + 4c_2 h^2 = h^2 \\implies c_1 + 4c_2 = 1 $$\n3.  $u_i^{(4)}$ 的系数：必须消除此项以达到高于 $\\mathcal{O}(h^2)$ 的精度。对于四阶精度，此项必须为 $0$。\n    $$ \\frac{c_1 h^4}{12} + \\frac{4c_2 h^4}{3} = 0 \\implies \\frac{c_1}{12} + \\frac{4c_2}{3} = 0 $$\n将第三个方程乘以 $12$，可简化为 $c_1 + 16c_2 = 0$。\n\n现在我们得到了关于三个未知系数 $c_0, c_1, c_2$ 的一个三元线性方程组：\n(I) $c_0 + 2c_1 + 2c_2 = 0$\n(II) $c_1 + 4c_2 = 1$\n(III) $c_1 + 16c_2 = 0$\n\n由方程 (III)，我们将 $c_1$ 表示为 $c_2$ 的函数：\n$c_1 = -16c_2$。\n将此代入方程 (II)：\n$(-16c_2) + 4c_2 = 1 \\implies -12c_2 = 1 \\implies c_2 = -\\frac{1}{12}$。\n现在我们可以求出 $c_1$：\n$c_1 = -16 \\left( -\\frac{1}{12} \\right) = \\frac{16}{12} = \\frac{4}{3}$。\n最后，我们使用方程 (I) 来求出 $c_0$：\n$c_0 = -2c_1 - 2c_2 = -2 \\left( \\frac{4}{3} \\right) - 2 \\left( -\\frac{1}{12} \\right) = -\\frac{8}{3} + \\frac{2}{12} = -\\frac{8}{3} + \\frac{1}{6} = -\\frac{16}{6} + \\frac{1}{6} = -\\frac{15}{6} = -\\frac{5}{2}$。\n\n系数为：\n$c_0 = -\\frac{5}{2}$，$c_1 = c_{-1} = \\frac{4}{3}$，以及 $c_2 = c_{-2} = -\\frac{1}{12}$。\n将这些系数代入格式公式中：\n$$ \\widehat{u_{xx}}(x_i) = \\frac{1}{h^2} \\left( -\\frac{1}{12} u_{i-2} + \\frac{4}{3} u_{i-1} - \\frac{5}{2} u_i + \\frac{4}{3} u_{i+1} - \\frac{1}{12} u_{i+2} \\right) $$\n为了得到括号内系数为整数的更常规形式，我们可以找到一个公分母，即 $12$。\n$$ \\widehat{u_{xx}}(x_i) = \\frac{1}{12h^2} \\left( -1 \\cdot u_{i-2} + 16 \\cdot u_{i-1} - 30 \\cdot u_i + 16 \\cdot u_{i+1} - 1 \\cdot u_{i+2} \\right) $$\n此表达式代表了所求的用于二阶导数的四阶精度中心五点格式。截断误差由泰勒展开中的第一个非零项（即 $u_i^{(6)}$ 项）决定。其系数为：\n$$ \\frac{1}{h^2} \\left( \\frac{c_1 h^6}{360} + \\frac{8c_2 h^6}{45} \\right) = \\frac{h^4}{360} c_1 + \\frac{8h^4}{45} c_2 = h^4 \\left( \\frac{1}{360} \\cdot \\frac{4}{3} + \\frac{8}{45} \\left( -\\frac{1}{12} \\right) \\right) = h^4 \\left( \\frac{1}{270} - \\frac{2}{135} \\right) = h^4 \\left( \\frac{1-4}{270} \\right) = -\\frac{3h^4}{270} = -\\frac{h^4}{90} $$\n截断误差为 $T.E. = -\\frac{h^4}{90} u^{(6)}(\\xi)$，其中某个 $\\xi \\in (x_{i-2}, x_{i+2})$，这证实了其精度为 $\\mathcal{O}(h^4)$。",
            "answer": "$$ \\boxed{ \\frac{-u_{i-2} + 16 u_{i-1} - 30 u_i + 16 u_{i+1} - u_{i+2}}{12h^2} } $$"
        }
    ]
}