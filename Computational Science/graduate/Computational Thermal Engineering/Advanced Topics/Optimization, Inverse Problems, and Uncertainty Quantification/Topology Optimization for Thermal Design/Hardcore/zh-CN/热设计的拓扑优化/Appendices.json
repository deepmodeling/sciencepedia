{
    "hands_on_practices": [
        {
            "introduction": "在构建复杂计算模型之前，深入理解其背后的物理原理至关重要。量纲一化是一种强大的分析工具，它通过缩放变量来简化物理问题，从而揭示出主导系统行为的无量纲参数（如毕渥数 $Bi$）。本练习将指导您完成对一个包含传导、对流和辐射的典型热学问题的量纲一化过程 ()，该实践旨在培养您识别和比较不同传热模式相对重要性的能力，这对于后续解释拓扑优化结果和制定有效的设计策略至关重要。",
            "id": "3998286",
            "problem": "考虑一个散热设计域 $\\Omega \\subset \\mathbb{R}^{d}$，其内为一固体，具有空间变化的导热系数 $k(\\mathbf{x})$。在拓扑优化设定中，材料分布由一个设计场 $\\rho(\\mathbf{x}) \\in [0,1]$ 参数化，导热系数遵循固体各向同性材料惩罚 (SIMP) 插值法 $k(\\mathbf{x}) = k_{0}\\,\\kappa(\\rho(\\mathbf{x}))$，其中 $k_{0}$ 是一个正的参考导热系数，$\\kappa(\\rho)$ 是一个无量纲函数，其值界于两个代表极限有效导热系数的正常量之间。没有体积生热的稳态热传导由局部能量守恒和傅里叶定律控制，得出偏微分方程 $\\nabla \\cdot \\left(k(\\mathbf{x})\\,\\nabla T(\\mathbf{x})\\right) = 0$ 在 $\\Omega$ 内成立。边界 $\\partial \\Omega$ 被划分为不相交的子集 $\\Gamma_{h}$ 和 $\\Gamma_{r}$，分别与绝对温度为 $T_{\\infty}$ 的周围环境发生对流和辐射交换。在 $\\Gamma_{h}$ 上，边界热通量满足牛顿冷却定律 $-\\mathbf{n} \\cdot \\left(k(\\mathbf{x})\\,\\nabla T(\\mathbf{x})\\right) = h\\left(T(\\mathbf{x}) - T_{\\infty}\\right)$，其中 $h  0$ 是一个空间均匀的对流换热系数。在 $\\Gamma_{r}$ 上，边界热通量满足斯特藩-玻尔兹曼辐射定律 $-\\mathbf{n} \\cdot \\left(k(\\mathbf{x})\\,\\nabla T(\\mathbf{x})\\right) = \\varepsilon\\,\\sigma\\left(T(\\mathbf{x})^{4} - T_{\\infty}^{4}\\right)$，其中 $\\varepsilon \\in (0,1]$ 是发射率，$\\sigma$ 是斯特藩-玻尔兹曼常数。设 $L  0$ 为 $\\Omega$ 的特征长度，$\\Delta T  0$ 为相对于 $T_{\\infty}$ 的特征温差。使用 $L$、$\\Delta T$ 和 $k_{0}$ 作为特征尺度，引入无量纲变量 $\\mathbf{x}^{*} = \\mathbf{x}/L$、$T(\\mathbf{x}) = T_{\\infty} + \\Delta T\\,\\theta(\\mathbf{x}^{*})$ 和 $k(\\rho(\\mathbf{x})) = k(\\mathbf{x})/k_{0}$。仅从所述的控制原理出发，推导 $\\Omega$ 中稳态传导方程的无量纲形式以及在 $\\Gamma_{h}$ 和 $\\Gamma_{r}$ 上的无量纲边界条件。识别并定义用于参数化对流和辐射相对于传导强度的无量纲数群。将您的最终答案表示为单个解析表达式，列出无量纲控制方程和已识别的无量纲数群。不需要进行数值评估，最终表达式必须是无量纲的。如果您选择围绕 $T_{\\infty}$ 对辐射进行线性化，请说明您引入的额外小参数；否则请保留精确的非线性形式。您的最终答案必须以单个复合表达式的形式呈现。",
            "solution": "该问题要求推导在域 $\\Omega$ 中，受对流和辐射边界条件约束的稳态热传导控制方程的无量纲形式。此过程涉及为位置、温度和导热系数引入无量纲变量，并用这些新变量重新表述控制偏微分方程(PDE)和边界条件。这个过程将揭示控制系统行为的基本无量纲参数。\n\n给定的有量纲变量是位置 $\\mathbf{x}$、温度 $T(\\mathbf{x})$ 和导热系数 $k(\\mathbf{x})$。特征尺度是长度 $L$、温差 $\\Delta T$ 和参考导热系数 $k_0$。无量纲变量定义如下：\n- 无量纲位置：$\\mathbf{x}^{*} = \\frac{\\mathbf{x}}{L}$\n- 无量纲温度：$\\theta(\\mathbf{x}^{*}) = \\frac{T(\\mathbf{x}) - T_{\\infty}}{\\Delta T}$\n- 无量纲导热系数：$\\kappa(\\rho(\\mathbf{x})) = \\frac{k(\\mathbf{x})}{k_0}$\n\n根据这些定义，我们可以用无量纲变量表示有量纲变量：\n- $\\mathbf{x} = L\\mathbf{x}^{*}$\n- $T(\\mathbf{x}) = T_{\\infty} + \\Delta T\\,\\theta(\\mathbf{x}^{*})$\n- $k(\\mathbf{x}) = k_0\\,\\kappa(\\rho(\\mathbf{x}))$\n\n接下来，我们必须变换空间导数。关于有量纲坐标 $\\mathbf{x}$ 的梯度算子 $\\nabla$ 与关于无量纲坐标 $\\mathbf{x}^{*}$ 的梯度算子 $\\nabla^*$ 通过链式法则相关联。对于梯度的第 $i$ 个分量：\n$$ \\frac{\\partial}{\\partial x_i} = \\sum_{j=1}^{d} \\frac{\\partial x_j^*}{\\partial x_i} \\frac{\\partial}{\\partial x_j^*} $$\n由于 $x_j^* = x_j/L$，我们有 $\\frac{\\partial x_j^*}{\\partial x_i} = \\frac{1}{L}\\delta_{ij}$，其中 $\\delta_{ij}$ 是克罗内克δ。这可以简化为：\n$$ \\frac{\\partial}{\\partial x_i} = \\frac{1}{L} \\frac{\\partial}{\\partial x_i^*} $$\n因此，梯度算子变换为：\n$$ \\nabla = \\frac{1}{L}\\nabla^* $$\n温度场的梯度则为：\n$$ \\nabla T(\\mathbf{x}) = \\nabla \\left(T_{\\infty} + \\Delta T\\,\\theta(\\mathbf{x}^{*})\\right) = \\Delta T\\,\\nabla\\theta(\\mathbf{x}^{*}) = \\Delta T \\left(\\frac{1}{L}\\nabla^*\\theta(\\mathbf{x}^{*})\\right) = \\frac{\\Delta T}{L}\\nabla^*\\theta(\\mathbf{x}^{*}) $$\n\n现在，我们可以对控制方程和边界条件进行无量纲化。\n\n**1. 控制方程的无量纲化**\n稳态热传导方程为：\n$$ \\nabla \\cdot \\left(k(\\mathbf{x})\\,\\nabla T(\\mathbf{x})\\right) = 0 $$\n代入算子和变量的表达式：\n$$ \\left(\\frac{1}{L}\\nabla^*\\right) \\cdot \\left( \\left(k_0\\,\\kappa(\\rho(\\mathbf{x}^*))\\right) \\left(\\frac{\\Delta T}{L}\\nabla^*\\theta(\\mathbf{x}^{*})\\right) \\right) = 0 $$\n常数可以从散度算子中提出：\n$$ \\frac{k_0\\,\\Delta T}{L^2} \\nabla^* \\cdot \\left( \\kappa(\\rho(\\mathbf{x}^*))\\,\\nabla^*\\theta(\\mathbf{x}^{*}) \\right) = 0 $$\n由于 $k_0 > 0$，$\\Delta T > 0$，且 $L > 0$，常系数 $\\frac{k_0\\,\\Delta T}{L^2}$ 非零，可以被除掉。这样就得到了无量纲控制方程。按照惯例，去掉无量纲变量的星号，我们有：\n$$ \\nabla \\cdot \\left( \\kappa(\\rho(\\mathbf{x}))\\,\\nabla\\theta(\\mathbf{x}) \\right) = 0 \\quad \\text{in } \\Omega $$\n\n**2. 对流边界条件的无量纲化**\n在 $\\Gamma_h$ 上的对流边界条件由牛顿冷却定律给出：\n$$ -\\mathbf{n} \\cdot \\left(k(\\mathbf{x})\\,\\nabla T(\\mathbf{x})\\right) = h\\left(T(\\mathbf{x}) - T_{\\infty}\\right) $$\n外法线向量 $\\mathbf{n}$ 是一个几何属性，在有量纲和无量纲域中是相同的。将无量纲量代入左手边 (LHS)：\n$$ \\text{LHS} = -\\mathbf{n} \\cdot \\left( \\left(k_0\\,\\kappa\\right) \\left(\\frac{\\Delta T}{L}\\nabla^*\\theta\\right) \\right) = -\\frac{k_0\\,\\Delta T}{L} \\mathbf{n} \\cdot (\\kappa\\,\\nabla^*\\theta) $$\n代入右手边 (RHS)：\n$$ \\text{RHS} = h\\left( (T_{\\infty} + \\Delta T\\,\\theta) - T_{\\infty} \\right) = h\\,\\Delta T\\,\\theta $$\n令两边相等：\n$$ -\\frac{k_0\\,\\Delta T}{L} \\mathbf{n} \\cdot (\\kappa\\,\\nabla^*\\theta) = h\\,\\Delta T\\,\\theta $$\n两边除以 $\\Delta T$ (因为 $\\Delta T > 0$) 并重新整理得到：\n$$ -\\mathbf{n} \\cdot (\\kappa\\,\\nabla^*\\theta) = \\frac{hL}{k_0} \\theta $$\n这个方程揭示了第一个无量纲数群，即 Biot 数 $Bi$，它代表外部对流换热与内部传导换热的比值。\n$$ Bi = \\frac{hL}{k_0} $$\n在 $\\Gamma_h$ 上的无量纲边界条件为 (去掉星号)：\n$$ -\\mathbf{n} \\cdot (\\kappa\\,\\nabla\\theta) = Bi\\,\\theta $$\n\n**3. 辐射边界条件的无量纲化**\n在 $\\Gamma_r$ 上的辐射边界条件由斯特藩-玻尔兹曼定律给出：\n$$ -\\mathbf{n} \\cdot \\left(k(\\mathbf{x})\\,\\nabla T(\\mathbf{x})\\right) = \\varepsilon\\,\\sigma\\left(T(\\mathbf{x})^{4} - T_{\\infty}^{4}\\right) $$\nLHS 与对流情况相同：$-\\frac{k_0\\,\\Delta T}{L} \\mathbf{n} \\cdot (\\kappa\\,\\nabla^*\\theta)$。\n对于 RHS，我们代入 $T(\\mathbf{x}) = T_{\\infty} + \\Delta T\\,\\theta$:\n$$ \\text{RHS} = \\varepsilon\\,\\sigma\\left( (T_{\\infty} + \\Delta T\\,\\theta)^4 - T_{\\infty}^4 \\right) = \\varepsilon\\,\\sigma\\,T_{\\infty}^4 \\left( \\left(1 + \\frac{\\Delta T}{T_{\\infty}}\\theta\\right)^4 - 1 \\right) $$\n令 LHS 和 RHS 相等：\n$$ -\\frac{k_0\\,\\Delta T}{L} \\mathbf{n} \\cdot (\\kappa\\,\\nabla^*\\theta) = \\varepsilon\\,\\sigma\\,T_{\\infty}^4 \\left( \\left(1 + \\frac{\\Delta T}{T_{\\infty}}\\theta\\right)^4 - 1 \\right) $$\n为使方程无量纲化，我们两边除以 LHS 的系数 $\\frac{k_0\\,\\Delta T}{L}$：\n$$ -\\mathbf{n} \\cdot (\\kappa\\,\\nabla^*\\theta) = \\frac{\\varepsilon\\,\\sigma\\,T_{\\infty}^4 L}{k_0\\,\\Delta T} \\left( \\left(1 + \\frac{\\Delta T}{T_{\\infty}}\\theta\\right)^4 - 1 \\right) $$\n此表达式揭示了两个表征辐射的重要无量纲数群。我们可以将它们定义为：\n1. 一个辐射-传导数 $N_{rad}$，它比较了在环境温度下辐射与传导的强度：\n$$ N_{rad} = \\frac{\\varepsilon\\,\\sigma\\,T_{\\infty}^3 L}{k_0} $$\n2. 一个无量纲温度比 $\\Theta$，它表示相对于绝对环境温度的温度变化幅度，并控制边界条件的非线性：\n$$ \\Theta = \\frac{\\Delta T}{T_{\\infty}} $$\n使用这些定义，RHS 上的系数变为 $\\frac{N_{rad}}{\\Theta}$。在 $\\Gamma_r$ 上的无量纲边界条件为 (去掉星号)：\n$$ -\\mathbf{n} \\cdot (\\kappa\\,\\nabla\\theta) = \\frac{N_{rad}}{\\Theta} \\left( (1 + \\Theta\\theta)^4 - 1 \\right) $$\n该问题完全由无量纲场 $\\kappa(\\mathbf{x})$ 和三个无量纲数 $Bi$、$N_{rad}$ 和 $\\Theta$ 参数化。\n所要求的复合表达式将列出无量纲控制方程以及这三个无量纲数群的定义。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\nabla \\cdot (\\kappa \\nabla \\theta) = 0 \\\\ Bi = \\frac{hL}{k_0} \\\\ N_{rad} = \\frac{\\varepsilon \\sigma T_{\\infty}^3 L}{k_0} \\\\ \\Theta = \\frac{\\Delta T}{T_{\\infty}} \\end{pmatrix} } $$"
        },
        {
            "introduction": "在掌握了物理原理之后，计算科学的下一步是确保我们开发的数值工具的正确性，这需要严谨的验证和确认。然而，并非所有问题都适合作为验证基准。一个好的基准问题应当具备已知的解析解或参考解，并且能够对代码的核心功能进行非平凡的测试。本练习旨在培养您在为数值代码选择合适基准案例时的批判性思维能力 ()，通过分析几种不同的物理场景，您将学会如何甄别出那些能够为伴随灵敏度分析提供可靠验证的问题，这是开发可信赖优化工具的一项关键技能。",
            "id": "3998345",
            "problem": "一个基于密度的稳态热传导拓扑优化公式旨在选择一个空间分布的设计变量场 $\\rho(x)$，以在热方程的约束下优化一个热学目标。设计变量 $\\rho(x)$ 通过固体各向同性材料惩罚 (SIMP) 方案映射到热导率 $k(\\rho)$，即 $k(\\rho) = k_{\\min} + \\rho^p \\left( k_{\\max} - k_{\\min} \\right)$，其中 $p  0$，$k_{\\min}  0$ 且 $k_{\\max}  k_{\\min}$。为了验证伴随法和材料插值的实现，理想的做法是使用一些基准问题，这些问题的状态解和伴随解允许有闭式表达式，并且目标函数对 $\\rho$ 的灵敏度具有非平凡的解析参考。请考虑以下候选问题，每个问题都由其控制方程、边界条件和一个目标泛函 $J(T,\\rho)$ 定义。\n\nA. 具有均匀体积生热的一维 ($1$-D) 平板。物理域为 $x \\in [0,L]$。稳态热传导方程和边界条件为\n$$\n- \\frac{d}{dx} \\left( k(\\rho) \\frac{d T}{dx} \\right) = q, \\quad T(0) = T_0, \\quad - k(\\rho) \\left. \\frac{dT}{dx} \\right|_{x=L} = h \\left( T(L) - T_\\infty \\right),\n$$\n其中 $q  0$ 是均匀的，$h  0$ 是对流系数，$T_0$ 和 $T_\\infty$ 是给定的温度。为了进行插值和伴随灵敏度的基准测试，限制 $\\rho$ 在空间上是均匀的，因此 $k(\\rho)$ 是一个常数。设目标为域平均温度，\n$$\nJ(T,\\rho) = \\frac{1}{L} \\int_0^L T(x) \\, dx.\n$$\n\nB. 具有非均匀热源和混合边界条件的二维 ($2$-D) 矩形板。域为 $\\Omega = (0,L_x) \\times (0,L_y)$。稳态热传导方程为\n$$\n- \\nabla \\cdot \\left( k(\\rho) \\nabla T \\right) = q(x,y),\n$$\n其中 $q(x,y) = q_0 \\left( 1 + \\sin\\left( \\frac{\\pi x}{L_x} \\right) \\sin\\left( \\frac{\\pi y}{L_y} \\right) \\right)$，$T= T_0$ 在 $x=0$ 和 $y=0$ 上，以及 $- k(\\rho) \\frac{\\partial T}{\\partial n} = h \\left( T - T_\\infty \\right)$ 在 $x=L_x$ 和 $y=L_y$ 上。设目标为热柔度，\n$$\nJ(T,\\rho) = \\int_{\\Omega} q(x,y) \\, T(x,y) \\, d\\Omega.\n$$\n限制 $\\rho$ 在空间上是均匀的。\n\nC. 均匀横截面的直翅片，其表面通过对流进行热交换，具有给定的根部温度和绝热的尖端。翅片长度为 $L$，横截面积为 $A$，周长为 $P$。令 $\\theta(x) = T(x) - T_\\infty$。沿翅片的能量平衡给出一维翅片方程\n$$\n- \\frac{d}{dx} \\left( k(\\rho) A \\frac{d \\theta}{dx} \\right) + h P \\, \\theta = 0, \\quad \\theta(0) = \\theta_b, \\quad \\left. \\frac{d \\theta}{dx} \\right|_{x=L} = 0,\n$$\n其中 $\\theta_b = T_b - T_\\infty$。为了进行基准测试，限制 $\\rho$ 在空间上是均匀的，因此 $k(\\rho)$ 是常数。设目标为平均超温，\n$$\nJ(T,\\rho) = \\frac{1}{L} \\int_0^L \\theta(x) \\, dx.\n$$\n\nD. 具有与温度相关的热导率的立方体中的三维 ($3$-D) 瞬态热传导。域为 $(0,L)^3$。控制方程为\n$$\n\\rho_m c_p \\frac{\\partial T}{\\partial t} - \\nabla \\cdot \\left( k(T,\\rho) \\nabla T \\right) = 0,\n$$\n其中 $k(T,\\rho) = k_0 \\left( 1 + \\alpha T \\right) \\left( k_{\\min} + \\rho^p \\left( k_{\\max} - k_{\\min} \\right) \\right)$，给定 $T(\\mathbf{x},0) = T_{\\text{init}}$，在一个面上有 $T = T_0$，在对面有 $- k \\frac{\\partial T}{\\partial n} = h \\left( T - T_\\infty \\right)$。设目标为时间间隔 $[0,t_f]$ 上的时间平均热柔度，\n$$\nJ(T,\\rho) = \\frac{1}{t_f} \\int_0^{t_f} \\int_{\\Omega} q_0 \\, T(\\mathbf{x},t) \\, d\\Omega \\, dt,\n$$\n其中 $q_0  0$ 是均匀的。限制 $\\rho$ 在空间上是均匀的。\n\nE. 两端具有给定温度且无内部生热的一维 ($1$-D) 平板。域为 $x \\in [0,L]$。控制方程和边界条件为\n$$\n- \\frac{d}{dx} \\left( k(\\rho) \\frac{d T}{dx} \\right) = 0, \\quad T(0) = T_0, \\quad T(L) = T_L,\n$$\n其中 $T_0 \\neq T_L$。设目标为域平均温度，\n$$\nJ(T,\\rho) = \\frac{1}{L} \\int_0^L T(x) \\, dx.\n$$\n\n在上述候选问题中，哪些在所述限制下将提供闭式的状态解和伴随解，以及一个非平凡的解析灵敏度 $dJ/d\\rho$，从而可以作为可靠的基准来验证稳态热拓扑优化中的伴随灵敏度和 SIMP 插值？选择所有适用的选项。选项：A, B, C, D, E。",
            "solution": "用户要求在稳态热拓扑优化的背景下，对五个候选基准问题进行评估，以验证伴随灵敏度分析。一个合适的基准问题必须满足以下标准：\n1.  为状态变量（温度）提供一个闭式解。\n2.  为相应的伴随变量提供一个闭式解。\n3.  对于均匀设计变量 $\\rho$，目标泛函关于它的灵敏度 $dJ/d\\rho$ 有一个非平凡（即非零）的解析表达式。\n\n空间均匀的设计变量 $\\rho$ 通过 SIMP 关系控制热导率 $k$：$k(\\rho) = k_{\\min} + \\rho^p ( k_{\\max} - k_{\\min} )$。因为 $p  0$ 且 $k_{\\max}  k_{\\min}$，所以对于 $\\rho  0$，导数 $\\frac{dk}{d\\rho} = p \\rho^{p-1} (k_{\\max} - k_{\\min})$ 是非零的。\n\n让我们根据这些标准逐一分析每个候选问题。对于形式为 $\\mathcal{L}(T, k(\\rho)) = 0$ 的稳态问题，泛函 $J$ 对 $\\rho$ 的灵敏度通过伴随法给出的表达式涉及状态解 $T$、伴随解 $\\lambda$ 以及算子对设计参数的导数。对于算子 $-\\nabla \\cdot (k \\nabla T)$，该灵敏度通常具有形式 $\\frac{dJ}{d\\rho} = \\int_{\\Omega} \\nabla\\lambda \\cdot \\nabla T \\frac{dk}{d\\rho} d\\Omega$。\n\n**A. 具有均匀体积生热的一维 ($1$-D) 平板。**\n由于 $\\rho$ 均匀， $k(\\rho)$ 是常数，因此控制方程是一个常系数二阶常微分方程 (ODE)：\n$$\n- k \\frac{d^2 T}{dx^2} = q, \\quad T(0) = T_0, \\quad - k \\left. \\frac{dT}{dx} \\right|_{x=L} = h \\left( T(L) - T_\\infty \\right)\n$$\n1.  **状态解 $T(x)$**：对 ODE 积分两次得到 $T(x) = -\\frac{q}{2k}x^2 + C_1 x + C_2$。常数 $C_1$ 和 $C_2$ 由两个边界条件唯一确定。$T(0) = T_0$ 给出 $C_2 = T_0$。$x=L$ 处的罗宾条件给出了一个依赖于 $k$ 的关于 $C_1$ 的线性方程。由于存在 $C_1$ 的唯一解，因此 $T(x)$ 存在一个依赖于 $k$ 的闭式解析解。**此标准满足。**\n\n2.  **伴随解 $\\lambda(x)$**：目标是 $J = \\frac{1}{L} \\int_0^L T(x) dx$。伴随方程是 $-\\frac{d}{dx}(k\\frac{d\\lambda}{dx}) = \\frac{\\partial J}{\\partial T_{body}} = \\frac{1}{L}$。状态边界条件（$x=0$ 处为狄利克雷条件，$x=L$ 处为罗宾条件）导致齐次伴随边界条件：$\\lambda(0)=0$ 和 $-k\\lambda'(L) = h\\lambda(L)$。这是另一个常系数二阶 ODE，$-k \\frac{d^2\\lambda}{dx^2} = \\frac{1}{L}$，它对 $\\lambda(x)$ 有一个唯一的、依赖于 $k$ 的闭式解。**此标准满足。**\n\n3.  **非平凡的灵敏度 $dJ/d\\rho$**：灵敏度为 $\\frac{dJ}{d\\rho} = - \\int_0^L \\frac{dk}{d\\rho} \\frac{dT}{dx} \\frac{d\\lambda}{dx} dx$。$\\frac{dT}{dx}$ 和 $\\frac{d\\lambda}{dx}$ 都是 $x$ 的非零、非常数函数（具体来说是 $x$ 的线性函数）。它们的乘积是 $x$ 的二次函数，其在 $[0, L]$ 上的积分通常不为零。由于 $\\frac{dk}{d\\rho} \\neq 0$，灵敏度 $dJ/d\\rho$ 是非平凡的。**此标准满足。**\n\n对 A 的结论：**正确**。此问题可作为一个可靠的基准。\n\n**B. 具有非均匀热源和混合边界条件的二维 ($2$-D) 矩形板。**\n控制方程是矩形上的泊松方程，$-k \\nabla^2 T = q(x,y)$。\n1.  **状态解 $T(x,y)$**：虽然矩形上的泊松方程是标准的，但边界条件的组合（两个相邻边为狄利克雷条件，另外两个为罗宾条件）使得找到一个简单的闭式解异常困难。标准方法如分离变量法或特征函数展开法不容易应用于这种混合类型的边界条件。解通常表示为一个无穷级数，其系数难以解析确定。它不具备作为一个简单基准所需的“闭式”解。**此标准不满足。**\n\n2.  **伴随解 $\\lambda(x,y)$**：目标是热柔度，$J = \\int_\\Omega qT d\\Omega$。对于这个目标，伴随方程是 $-k \\nabla^2 \\lambda = q$，这与状态方程相同。伴随边界条件是状态边界条件的齐次版本。这意味着伴随问题与状态问题有同样的困难，无法得到闭式解。**此标准不满足。**\n\n3.  **非平凡的灵敏度 $dJ/d\\rho$**：由于无法获得闭式解，因此无法推导出解析的灵敏度表达式。\n\n对 B 的结论：**不正确**。此问题过于复杂，无法得到所需的闭式解。\n\n**C. 均匀横截面的直翅片。**\n控制 ODE 是一个齐次二阶常系数方程：\n$$\n\\frac{d^2 \\theta}{dx^2} - m^2 \\theta = 0, \\quad \\text{其中 } m = \\sqrt{\\frac{hP}{kA(\\rho)}}\n$$\n边界条件是 $\\theta(0) = \\theta_b$ 和 $\\frac{d\\theta}{dx}(L) = 0$。\n1.  **状态解 $\\theta(x)$**：翅片方程的标准解用双曲函数表示。对于给定的边界条件（给定的根部温度和绝热的尖端），解是 $\\theta(x) = \\theta_b \\frac{\\cosh(m(L-x))}{\\cosh(mL)}$。这是一个著名的闭式解，它通过参数 $m$ 依赖于 $k$（并因此依赖于 $\\rho$）。**此标准满足。**\n\n2.  **伴随解 $\\lambda(x)$**：目标是 $J = \\frac{1}{L} \\int_0^L \\theta(x) dx$。对于自伴随的翅片算子，伴随方程是 $-\\frac{d}{dx}(kA\\frac{d\\lambda}{dx}) + hP\\lambda = \\frac{1}{L}$。状态边界条件（$x=0$ 处为狄利克雷条件，$x=L$ 处为诺伊曼条件）导致齐次伴随边界条件：$\\lambda(0)=0$ 和 $\\frac{d\\lambda}{dx}(L)=0$。伴随方程是状态方程的非齐次形式，其解由一个特解（一个常数）和一个齐次解（双曲函数）组成。存在一个唯一的、闭式的 $\\lambda(x)$ 解。**此标准满足。**\n\n3.  **非平凡的灵敏度 $dJ/d\\rho$**：灵敏度由 $\\frac{dJ}{d\\rho} = - \\int_0^L A \\frac{dk}{d\\rho} \\frac{d\\theta}{dx} \\frac{d\\lambda}{dx} dx$ 给出。$\\frac{d\\theta}{dx}$ 和 $\\frac{d\\lambda}{dx}$ 都是非零的解析函数（具体来说，涉及 $\\sinh(m(L-x))$）。它们的乘积是一个非零函数，其在 $[0, L]$ 上的积分是非零的。由于 $\\frac{dk}{d\\rho} \\neq 0$，灵敏度是非平凡的。**此标准满足。**\n\n对 C 的结论：**正确**。这是一个符合所有基准标准的经典问题。\n\n**D. 具有与温度相关的热导率的立方体中的三维 ($3$-D) 瞬态热传导。**\n控制方程是一个 $3$-D 的非线性瞬态偏微分方程：$\\rho_m c_p \\frac{\\partial T}{\\partial t} - \\nabla \\cdot ( k(T,\\rho) \\nabla T ) = 0$。\n1.  **状态解 $T(\\mathbf{x}, t)$**：对于具有混合边界条件的 $3$-D、瞬态、非线性偏微分方程，通常不可能获得闭式解析解。该问题的复杂性远超解析可处理的范围。此外，该问题是瞬态的，而所述背景是验证*稳态*热优化。**此标准不满足。**\n\n对 D 的结论：**不正确**。此问题在解析上难以处理，不适合作为简单的基准。\n\n**E. 两端具有给定温度的一维 ($1$-D) 平板。**\n控制方程是 $- \\frac{d}{dx} (k \\frac{dT}{dx}) = 0$，边界条件为 $T(0)=T_0$ 和 $T(L)=T_L$。\n1.  **状态解 $T(x)$**：积分两次并应用边界条件，得到线性温度分布：$T(x) = (T_L - T_0)\\frac{x}{L} + T_0$。这是一个闭式解。然而，一个关键的观察是，这个解**与热导率 $k$ 无关**。**此标准满足。**\n\n2.  **伴随解 $\\lambda(x)$**：目标是 $J = \\frac{1}{L} \\int_0^L T(x) dx$。伴随方程是 $-k\\frac{d^2\\lambda}{dx^2} = \\frac{1}{L}$。状态边界条件在两端都是狄利克雷条件，因此伴随边界条件是齐次狄利克雷条件：$\\lambda(0)=0$ 和 $\\lambda(L)=0$。解是抛物线分布 $\\lambda(x) = \\frac{x(L-x)}{2kL}$，这是一个有效的闭式解。**此标准满足。**\n\n3.  **非平凡的灵敏度 $dJ/d\\rho$**：由于状态解 $T(x)$ 与 $k$ 无关，目标泛函 $J = \\frac{1}{L} \\int_0^L T(x) dx = \\frac{T_0+T_L}{2}$ 也与 $k$ 无关，因此与 $\\rho$ 无关。因此，灵敏度必须恒等于零：$\\frac{dJ}{d\\rho} = 0$。使用形式化表达式，$\\frac{dJ}{d\\rho} = - \\int_0^L \\frac{dk}{d\\rho} \\frac{dT}{dx} \\frac{d\\lambda}{dx} dx$。这里，$\\frac{dT}{dx}$ 是一个常数，而 $\\frac{d\\lambda}{dx}$ 是 $x$ 的线性函数。积分 $\\int_0^L \\frac{dT}{dx} \\frac{d\\lambda}{dx} dx = \\int_0^L (\\frac{T_L-T_0}{L})(\\frac{L-2x}{2kL}) dx = 0$。灵敏度是平凡的（零）。用于验证灵敏度实现的基准问题应具有已知的非零结果，以确保计算出的灵敏度的大小和符号都是正确的。**此标准不满足。**\n\n对 E 的结论：**不正确**。此问题产生平凡（零）灵敏度，使其不适合用于可靠的验证。\n\n**结论**\n只有候选问题 A 和 C 满足作为一个可靠基准问题的所有三个要求：它们的状态和伴随问题都拥有闭式解，并且它们产生一个非平凡的解析灵敏度。",
            "answer": "$$\\boxed{AC}$$"
        },
        {
            "introduction": "在对物理原理和验证策略有了扎实的理解之后，您现在可以着手实现基于梯度的拓扑优化中的一个核心部分：伴随灵敏度分析。伴随方法是一种高效的算法，用于计算目标函数相对于大量设计变量的梯度，其计算的准确性对于优化算法能否正确收敛至关重要。这个综合性练习 () 将引导您完成为一个非线性热学问题实现并验证伴随灵敏度求解器的完整流程。您不仅需要推导和编写伴随方程的代码，还将使用高精度的复步法来验证您的实现，从而通过实践真正掌握这一关键的计算技术。",
            "id": "3998277",
            "problem": "考虑定义域 $[0,L]$ 上的一个一维稳态热传导问题，其两端温度为给定值。状态变量 $T(x)$ 满足能量平衡定律和傅里叶热传导定律，由此得到以下非线性边值问题：\n$$\n\\frac{d}{dx}\\left(k(T,\\theta)\\frac{dT}{dx}\\right) + q(x) = 0,\\quad x\\in(0,L),\n$$\n服从狄利克雷边界条件\n$$\nT(0)=T_{\\mathrm{left}},\\quad T(L)=T_{\\mathrm{right}}.\n$$\n热导率依赖于温度和参数，\n$$\nk(T,\\theta) = k_0 + \\theta\\,\\exp\\left(\\beta\\,T\\right),\n$$\n其中 $k_00$ 是基准热导率，$\\beta0$ 是温度敏感性系数，$\\theta$ 是影响热导率的设计参数。目标泛函，在拓扑优化中称为热柔度，其表达式为\n$$\nJ(T) = \\int_0^L q(x)\\,T(x)\\,dx,\n$$\n其中 $q(x)$ 是给定的体热源分布。\n\n您的任务是：\n1. 从能量平衡和傅里叶定律出发，使用二阶中心差分推导在包含 $N$ 个区间的均匀网格（网格间距 $h=L/N$）上的离散残差，其中界面热导率通过算术平均值计算。对于内部节点 $i=1,\\dots,N-1$，定义用于强制执行离散化能量平衡的离散残差 $F_i(T,\\theta)$。\n2. 通过对残差关于内部节点温度进行微分，推导内部节点的离散雅可比矩阵 $\\partial F/\\partial T$，并完全考虑 $k$ 对 $T$ 的依赖性。同时，通过对残差关于 $\\theta$ 进行微分，推导内部节点的向量 $\\partial F/\\partial\\theta$。\n3. 使用离散梯形法则定义离散目标 $J_h(T)$，并通过伴随方法推导离散灵敏度 $\\frac{dJ_h}{d\\theta}$。引入求解线性系统\n$$\n\\left(\\frac{\\partial F}{\\partial T}\\right)^{\\!\\top} \\lambda = \\frac{\\partial J_h}{\\partial T},\n$$\n的伴随向量 $\\lambda$，并证明\n$$\n\\frac{dJ_h}{d\\theta} = -\\,\\lambda^{\\top}\\,\\frac{\\partial F}{\\partial \\theta}.\n$$\n解释与固定温度边界一致的伴随问题的边界条件。\n4. 实现一个牛顿法来求解网格上的非线性正问题 $T(x)$。使用推导出的离散残差和雅可比矩阵。然后实现伴随灵敏度计算。\n5. 使用复步微分估计来验证伴随灵敏度。具体来说，使用复数算术计算在 $\\theta + \\mathrm{i}\\,\\varepsilon$（其中 $\\varepsilon$ 是一个小的正实数）处的 $J_h$，并报告估计值\n$$\n\\left.\\frac{dJ_h}{d\\theta}\\right|_{\\mathrm{csd}} \\approx \\frac{\\operatorname{Im}\\,J_h\\!\\left(T(\\theta+\\mathrm{i}\\,\\varepsilon)\\right)}{\\varepsilon}.\n$$\n\n使用以下科学上一致且自洽的参数集作为测试套件。对于每个测试用例，您必须：\n- 求解正问题以获得 $T(x)$。\n- 计算伴随灵敏度 $\\frac{dJ_h}{d\\theta}$。\n- 使用 $\\varepsilon=10^{-30}$ 计算复步灵敏度估计。\n- 以浮点数形式输出伴随灵敏度与复步灵敏度估计之间的绝对差。\n\n所有物理量均采用国际单位制。程序的最终输出应为无量纲的绝对差。热源定义为\n$$\nq(x) = q_0\\left(1 + \\sin\\left(\\pi x/L\\right)\\right),\n$$\n其中 $q_0\\ge 0$。\n\n测试套件参数集：\n- 案例A（一般非线性传导）：$L=0.1\\,\\mathrm{m}$，$N=200$，$k_0=10\\,\\mathrm{W}/(\\mathrm{m}\\cdot\\mathrm{K})$，$\\beta=10^{-2}\\,\\mathrm{K}^{-1}$，$\\theta=5\\,\\mathrm{W}/(\\mathrm{m}\\cdot\\mathrm{K})$，$q_0=10^6\\,\\mathrm{W}/\\mathrm{m}^3$，$T_{\\mathrm{left}}=300\\,\\mathrm{K}$，$T_{\\mathrm{right}}=310\\,\\mathrm{K}$。\n- 案例B（零源边际情况）：$L=0.1\\,\\mathrm{m}$，$N=200$，$k_0=10\\,\\mathrm{W}/(\\mathrm{m}\\cdot\\mathrm{K})$，$\\beta=10^{-2}\\,\\mathrm{K}^{-1}$，$\\theta=3\\,\\mathrm{W}/(\\mathrm{m}\\cdot\\mathrm{K})$，$q_0=0\\,\\mathrm{W}/\\mathrm{m}^3$，$T_{\\mathrm{left}}=300\\,\\mathrm{K}$，$T_{\\mathrm{right}}=300\\,\\mathrm{K}$。\n- 案例C（更强非线性）：$L=0.1\\,\\mathrm{m}$，$N=200$，$k_0=10\\,\\mathrm{W}/(\\mathrm{m}\\cdot\\mathrm{K})$，$\\beta=5\\times10^{-2}\\,\\mathrm{K}^{-1}$，$\\theta=8\\,\\mathrm{W}/(\\mathrm{m}\\cdot\\mathrm{K})$，$q_0=5\\times10^5\\,\\mathrm{W}/\\mathrm{m}^3$，$T_{\\mathrm{left}}=280\\,\\mathrm{K}$，$T_{\\mathrm{right}}=320\\,\\mathrm{K}$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[resultA,resultB,resultC]”），其中每个结果是相应测试用例的伴随灵敏度与复步灵敏度之间的绝对差，表示为浮点数。",
            "solution": "该问题已经过验证，被认为是科学上可靠、适定且自洽的。因此，我们可以着手提供完整的解决方案。\n\n解决方案分为五个部分：\n1.  使用有限差分法推导控制非线性边值问题的离散残差。\n2.  推导牛顿-拉夫逊求解方法所需的雅可比矩阵和参数导数向量。\n3.  推导热柔度目标泛函的伴随灵敏度公式。\n4.  描述使用牛顿法求解正问题和使用伴随法计算灵敏度的数值实现。\n5.  解释用于验证伴随灵敏度结果的复步法。\n\n### 1. 离散化与离散残差\n\n将一维域 $[0, L]$ 离散化为一个包含 $N$ 个区间的均匀网格，从而得到 $N+1$ 个网格点 $x_i = i \\cdot h$（$i=0, 1, \\dots, N$），其中 $h=L/N$ 是网格间距。内部节点处的温度 $T_1, \\dots, T_{N-1}$ 是未知数，而边界温度 $T_0 = T_{\\mathrm{left}}$ 和 $T_N = T_{\\mathrm{right}}$ 是给定的。\n\n控制方程为：\n$$\n\\frac{d}{dx}\\left(k(T,\\theta)\\frac{dT}{dx}\\right) + q(x) = 0\n$$\n我们采用有限体积/有限差分法，将此方程在围绕每个内部节点 $x_i$ 的控制体 $[x_{i-1/2}, x_{i+1/2}]$ 上积分：\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\left(\\frac{d}{dx}\\left(k\\frac{dT}{dx}\\right) + q(x)\\right) dx = 0\n$$\n可得：\n$$\n\\left. \\left(k\\frac{dT}{dx}\\right) \\right|_{x_{i+1/2}} - \\left. \\left(k\\frac{dT}{dx}\\right) \\right|_{x_{i-1/2}} + \\int_{x_{i-1/2}}^{x_{i+1/2}} q(x) dx \\approx 0\n$$\n对导数使用二阶中心差分，对积分使用中点法则，我们得到节点 $i$ 处的离散方程：\n$$\nk_{i+1/2} \\frac{T_{i+1} - T_i}{h} - k_{i-1/2} \\frac{T_i - T_{i-1}}{h} + q_i h = 0\n$$\n其中 $T_i = T(x_i)$，$q_i = q(x_i)$，$k_{i\\pm1/2}$ 是控制体界面上的热导率。根据题目要求，界面热导率通过相邻节点热导率的算术平均值计算：\n$$\nk_{i+1/2} = \\frac{k(T_i, \\theta) + k(T_{i+1}, \\theta)}{2} \\equiv \\frac{k_i + k_{i+1}}{2}\n$$\n將此代入平衡方程並除以 $h$ 可得：\n$$\n\\frac{1}{2h^2} \\left[ (k_i + k_{i+1}) (T_{i+1} - T_i) - (k_{i-1} + k_i) (T_i - T_{i-1}) \\right] + q_i = 0\n$$\n每个内部节点 $i \\in \\{1, \\dots, N-1\\}$ 的离散残差定义为该方程的左侧。设 $\\mathbf{T}$ 为内部温度向量 $[T_1, \\dots, T_{N-1}]^T$。节点 $i$ 的残差 $F_i(\\mathbf{T}, \\theta)$ 为：\n$$\nF_i(\\mathbf{T}, \\theta) = \\frac{1}{2h^2} \\left[ (k_i + k_{i+1}) (T_{i+1} - T_i) - (k_{i-1} + k_i) (T_i - T_{i-1}) \\right] + q_i\n$$\n当 $i=1$ 时，$T_{i-1}$ 是固定的边界值 $T_0 = T_{\\mathrm{left}}$。当 $i=N-1$ 时，$T_{i+1}$ 是固定的边界值 $T_N = T_{\\mathrm{right}}$。\n\n### 2. 雅可比矩阵和参数导数\n\n为了使用牛顿法求解非线性系统 $\\mathbf{F}(\\mathbf{T}, \\theta) = \\mathbf{0}$，我们需要雅可比矩阵 $\\mathcal{J} = \\frac{\\partial \\mathbf{F}}{\\partial \\mathbf{T}}$ 和参数导数向量 $\\frac{\\partial \\mathbf{F}}{\\partial \\theta}$。\n\n热导率函数为 $k(T, \\theta) = k_0 + \\theta \\exp(\\beta T)$。其偏导数为：\n$$\n\\frac{\\partial k}{\\partial T}(T, \\theta) = \\theta \\beta \\exp(\\beta T) \\equiv k'(T)\n$$\n$$\n\\frac{\\partial k}{\\partial \\theta}(T, \\theta) = \\exp(\\beta T)\n$$\n雅可比矩阵 $\\mathcal{J}$ 是一个 $(N-1) \\times (N-1)$ 的矩阵，其元素为 $\\mathcal{J}_{ij} = \\frac{\\partial F_i}{\\partial T_j}$。由于 $F_i$ 仅依赖于 $T_{i-1}, T_i, T_{i+1}$，雅可比矩阵是三对角的。对应于 $F_i$ 的第 $i$ 行的非零元素为：\n\n- **对角项 ($j=i$):**\n$$\n\\frac{\\partial F_i}{\\partial T_i} = \\frac{1}{2h^2} \\frac{\\partial}{\\partial T_i} \\left[ (k_i + k_{i+1}) (T_{i+1} - T_i) - (k_{i-1} + k_i) (T_i - T_{i-1}) \\right]\n$$\n$$\n\\frac{\\partial F_i}{\\partial T_i} = \\frac{1}{2h^2} \\left[ k'_i (T_{i+1} - T_i) - (k_i + k_{i+1}) - k'_i (T_i - T_{i-1}) - (k_{i-1} + k_i) \\right]\n$$\n\n- **上对角项 ($j=i+1$):** (对于 $i  N-1$)\n$$\n\\frac{\\partial F_i}{\\partial T_{i+1}} = \\frac{1}{2h^2} \\frac{\\partial}{\\partial T_{i+1}} \\left[ (k_i + k_{i+1}) (T_{i+1} - T_i) \\right] = \\frac{1}{2h^2} \\left[ k'_{i+1} (T_{i+1} - T_i) + (k_i + k_{i+1}) \\right]\n$$\n\n- **下对角项 ($j=i-1$):** (对于 $i > 1$)\n$$\n\\frac{\\partial F_i}{\\partial T_{i-1}} = \\frac{1}{2h^2} \\frac{\\partial}{\\partial T_{i-1}} \\left[ -(k_{i-1} + k_i) (T_i - T_{i-1}) \\right] = \\frac{1}{2h^2} \\left[ -k'_{i-1} (T_i - T_{i-1}) + (k_{i-1} + k_i) \\right]\n$$\n\n残差向量关于设计参数 $\\theta$ 的导数是一个向量，其分量为：\n$$\n\\frac{\\partial F_i}{\\partial \\theta} = \\frac{1}{2h^2} \\left[ \\left(\\frac{\\partial k_i}{\\partial \\theta} + \\frac{\\partial k_{i+1}}{\\partial \\theta}\\right) (T_{i+1} - T_i) - \\left(\\frac{\\partial k_{i-1}}{\\partial \\theta} + \\frac{\\partial k_i}{\\partial \\theta}\\right) (T_i - T_{i-1}) \\right]\n$$\n$$\n\\frac{\\partial F_i}{\\partial \\theta} = \\frac{1}{2h^2} \\left[ (\\exp(\\beta T_i) + \\exp(\\beta T_{i+1})) (T_{i+1} - T_i) - (\\exp(\\beta T_{i-1}) + \\exp(\\beta T_i)) (T_i - T_{i-1}) \\right]\n$$\n\n### 3. 伴随灵敏度分析\n\n目标泛函 $J(T) = \\int_0^L q(x) T(x) dx$ 使用梯形法则在网格 $x_0, \\dots, x_N$ 上进行离散化：\n$$\nJ_h(\\mathbf{T}) = h \\left( \\frac{q_0 T_0 + q_N T_N}{2} + \\sum_{i=1}^{N-1} q_i T_i \\right)\n$$\n状态方程规定了 $\\mathbf{T}$ 是 $\\theta$ 的一个隐函数，即 $\\mathbf{T} = \\mathbf{T}(\\theta)$，满足 $\\mathbf{F}(\\mathbf{T}(\\theta), \\theta) = \\mathbf{0}$。我们求解全导数 $\\frac{dJ_h}{d\\theta}$。应用链式法则：\n$$\n\\frac{dJ_h}{d\\theta} = \\frac{\\partial J_h}{\\partial \\theta} + \\frac{\\partial J_h}{\\partial \\mathbf{T}} \\frac{d\\mathbf{T}}{d\\theta}\n$$\n由于 $J_h$ 对 $\\theta$ 没有显式依赖关系，$\\frac{\\partial J_h}{\\partial \\theta}=0$。状态方程对 $\\theta$ 求导可得：\n$$\n\\frac{d\\mathbf{F}}{d\\theta} = \\frac{\\partial \\mathbf{F}}{\\partial \\theta} + \\frac{\\partial \\mathbf{F}}{\\partial \\mathbf{T}} \\frac{d\\mathbf{T}}{d\\theta} = \\mathbf{0} \\implies \\frac{d\\mathbf{T}}{d\\theta} = - \\left( \\frac{\\partial \\mathbf{F}}{\\partial \\mathbf{T}} \\right)^{-1} \\frac{\\partial \\mathbf{F}}{\\partial \\theta}\n$$\n將此代入灵敏度表达式，得到直接法：\n$$\n\\frac{dJ_h}{d\\theta} = - \\frac{\\partial J_h}{\\partial \\mathbf{T}} \\left( \\frac{\\partial \\mathbf{F}}{\\partial \\mathbf{T}} \\right)^{-1} \\frac{\\partial \\mathbf{F}}{\\partial \\theta}\n$$\n伴随方法通过定义一个伴随向量 $\\boldsymbol{\\lambda}$ 作为以下线性系统的解来避免显式的矩阵求逆：\n$$\n\\left( \\frac{\\partial \\mathbf{F}}{\\partial \\mathbf{T}} \\right)^\\top \\boldsymbol{\\lambda} = \\left( \\frac{\\partial J_h}{\\partial \\mathbf{T}} \\right)^\\top\n$$\n等式右侧是目标梯度的转置，其分量为 $\\frac{\\partial J_h}{\\partial T_j} = h q_j$（$j=1, \\dots, N-1$）。\n如此定义 $\\boldsymbol{\\lambda}$ 后，我们可以写作 $\\boldsymbol{\\lambda}^\\top = \\frac{\\partial J_h}{\\partial \\mathbf{T}} \\left( \\frac{\\partial \\mathbf{F}}{\\partial \\mathbf{T}} \\right)^{-1}$。将其代入直接灵敏度公式，得到伴随灵敏度表达式：\n$$\n\\frac{dJ_h}{d\\theta} = - \\boldsymbol{\\lambda}^\\top \\frac{\\partial \\mathbf{F}}{\\partial \\theta}\n$$\n这种方法计算效率高，无论设计参数有多少个，都只需要求解一个线性系统（即伴随方程）。\n\n伴随问题的边界条件已在该公式中隐式处理。原问题变量是 $N-1$ 个内部温度，因此雅可比矩阵 $\\frac{\\partial \\mathbf{F}}{\\partial \\mathbf{T}}$ 是一个 $(N-1) \\times (N-1)$ 的矩阵。伴随向量 $\\boldsymbol{\\lambda}$ 也因此有 $N-1$ 个分量，对应于内部节点。这是在连续伴随问题上施加齐次狄利克雷边界条件（即 $\\lambda(0)=0, \\lambda(L)=0$）的离散模拟，当原问题具有固定（狄利克雷）边界条件时，这是正确的条件。\n\n### 4. 数值实现\n非线性正问题 $\\mathbf{F}(\\mathbf{T}, \\theta) = \\mathbf{0}$ 使用牛顿法求解。从一个初始猜测 $\\mathbf{T}^{(0)}$（例如，线性温度分布）开始，我们通过求解线性系统：\n$$\n\\mathcal{J}(\\mathbf{T}^{(k)}) \\Delta \\mathbf{T}^{(k)} = - \\mathbf{F}(\\mathbf{T}^{(k)})\n$$\n来迭代计算更新量 $\\Delta \\mathbf{T}^{(k)}$，并更新解 $\\mathbf{T}^{(k+1)} = \\mathbf{T}^{(k)} + \\Delta \\mathbf{T}^{(k)}$，直到残差 $\\mathbf{F}$ 的范数低于指定的容差。由于雅可比矩阵 $\\mathcal{J}$ 是三对角的，每次迭代中的线性系统都可以使用带状矩阵求解器高效求解。\n\n一旦正问题收敛到解 $\\mathbf{T}$，就通过以下步骤计算伴随灵敏度：\n1.  在收敛温度 $\\mathbf{T}$ 处组装雅可比矩阵 $\\mathcal{J}$。\n2.  组装目标梯度向量 $\\left( \\frac{\\partial J_h}{\\partial \\mathbf{T}} \\right)^\\top$。\n3.  求解线性伴随系统 $\\mathcal{J}^\\top \\boldsymbol{\\lambda} = \\left( \\frac{\\partial J_h}{\\partial \\mathbf{T}} \\right)^\\top$ 以得到伴随向量 $\\boldsymbol{\\lambda}$。三对角矩阵的转置仍然是三对角的，因此该系统也可以高效求解。\n4.  组装参数导数向量 $\\frac{\\partial \\mathbf{F}}{\\partial \\theta}$。\n5.  通过点积 $\\frac{dJ_h}{d\\theta} = - \\boldsymbol{\\lambda} \\cdot \\frac{\\partial \\mathbf{F}}{\\partial \\theta}$ 计算最终灵敏度。\n\n### 5. 复步验证\n伴随灵敏度通过复步微分（CSD）方法进行验证，该方法能提供高度精确的数值导数估计，且没有有限差分法中的相消误差。其步骤如下：\n1.  对设计参数 $\\theta$施加一个小的虚数步长扰动：$\\theta_c = \\theta + i \\varepsilon$，其中 $\\varepsilon$ 是一个非常小的实数（例如 $10^{-30}$）。\n2.  求解正问题 $\\mathbf{F}(\\mathbf{T}_c, \\theta_c) = \\mathbf{0}$ 以获得复值温度场 $\\mathbf{T}_c$。这使用相同的牛顿求解器完成，但所有变量和运算都在复数域上定义。实值边界条件被视为虚部为零的复数。\n3.  计算复值目标函数 $J_h(\\mathbf{T}_c)$。\n4.  灵敏度通过结果的虚部进行估计：\n$$\n\\left.\\frac{dJ_h}{d\\theta}\\right|_{\\mathrm{csd}} = \\frac{\\operatorname{Im}[J_h(\\mathbf{T}(\\theta + i\\varepsilon))]}{\\varepsilon}\n$$\n该结果基于复解析函数的泰勒级数展开，其精度可达机器精度。伴随方法和CSD方法结果之间的绝对差，可作为对所推导和实现的伴随灵敏度表达式正确性的有力验证。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\n# Use complex numbers for CSD validation\nnp.complex = np.complex128 if hasattr(np, 'complex') else complex\n\ndef get_k(T, theta, beta, k0):\n    \"\"\"Computes thermal conductivity k(T, theta).\"\"\"\n    return k0 + theta * np.exp(beta * T)\n\ndef get_k_prime_T(T, theta, beta):\n    \"\"\"Computes derivative of k w.r.t. T.\"\"\"\n    return theta * beta * np.exp(beta * T)\n\ndef get_dk_dtheta(T, beta):\n    \"\"\"Computes derivative of k w.r.t. theta.\"\"\"\n    return np.exp(beta * T)\n\ndef assemble_system(T_full, params, dtype=np.float64):\n    \"\"\"\n    Assembles the residual F and the Jacobian J for the interior nodes.\n    T_full is the temperature vector of size N+1 including boundaries.\n    \"\"\"\n    N, h, k0, beta, theta, q_vec = params['N'], params['h'], params['k0'], params['beta'], params['theta'], params['q_vec']\n    \n    num_unknowns = N - 1\n    F = np.zeros(num_unknowns, dtype=dtype)\n    # Banded Jacobian: J_banded[0,:]=upper, J_banded[1,:]=main, J_banded[2,:]=lower\n    J_banded = np.zeros((3, num_unknowns), dtype=dtype)\n    \n    # Pre-compute k and its derivatives for all nodes\n    k = get_k(T_full, theta, beta, k0)\n    k_prime_T = get_k_prime_T(T_full, theta, beta)\n    \n    c = 1.0 / (2.0 * h**2)\n\n    for i in range(1, N): # Loop over interior nodes\n        idx = i - 1 # 0-based index for F and J\n        \n        # Temperatures\n        T_im1, T_i, T_ip1 = T_full[i-1], T_full[i], T_full[i+1]\n        \n        # Conductivities\n        k_im1, k_i, k_ip1 = k[i-1], k[i], k[i+1]\n        \n        # Residual F_i\n        term1 = (k_i + k_ip1) * (T_ip1 - T_i)\n        term2 = (k_im1 + k_i) * (T_i - T_im1)\n        F[idx] = c * (term1 - term2) + q_vec[i]\n        \n        # Jacobian entries for F_i\n        \n        # Main diagonal: dF_i/dT_i\n        dkp_dT_i = k_prime_T[i]\n        J_banded[1, idx] = c * (dkp_dT_i * (T_ip1 - T_i) - (k_i + k_ip1) - dkp_dT_i * (T_i - T_im1) - (k_im1 + k_i))\n\n        # Upper diagonal: dF_i/dT_{i+1}\n        if i  N - 1:\n            dkp_dT_ip1 = k_prime_T[i+1]\n            J_banded[0, idx + 1] = c * (dkp_dT_ip1 * (T_ip1 - T_i) + (k_i + k_ip1))\n\n        # Lower diagonal: dF_i/dT_{i-1}\n        if i > 1:\n            dkp_dT_im1 = k_prime_T[i-1]\n            J_banded[2, idx - 1] = c * (-dkp_dT_im1 * (T_i - T_im1) + (k_im1 + k_i))\n\n    return F, J_banded\n\ndef solve_forward(params, dtype=np.float64):\n    \"\"\"\n    Solves the nonlinear forward problem T(x) using Newton's method.\n    \"\"\"\n    N, L, T_left, T_right = params['N'], params['L'], params['T_left'], params['T_right']\n    \n    # Initial guess: linear temperature profile\n    T_full = np.linspace(T_left, T_right, N + 1, dtype=dtype)\n    \n    # Newton's method\n    max_iter = 50\n    tol = 1e-10\n    for it in range(max_iter):\n        T_interior = T_full[1:-1]\n        F, J_banded = assemble_system(T_full, params, dtype)\n        \n        res_norm = np.linalg.norm(F)\n        if res_norm  tol:\n            break\n        \n        # Solve J * delta_T = -F\n        delta_T = solve_banded((1, 1), J_banded, -F)\n        T_interior += delta_T\n        T_full[1:-1] = T_interior\n    \n    return T_full\n\ndef compute_adjoint_sensitivity(T_full, params):\n    \"\"\"\n    Computes dJ/dtheta using the adjoint method.\n    \"\"\"\n    N, h, k0, beta, theta, q_vec = params['N'], params['h'], params['k0'], params['beta'], params['theta'], params['q_vec']\n    num_unknowns = N - 1\n    \n    # 1. Get Jacobian at converged T\n    _, J_banded = assemble_system(T_full, params, dtype=np.float64)\n    \n    # 2. Compute dJ/dT (RHS of adjoint equation)\n    dJ_dT = h * q_vec[1:-1]\n    \n    # 3. Solve adjoint system J^T * lambda = dJ/dT\n    # For J^T, the upper and lower diagonals are swapped.\n    J_T_banded = np.zeros_like(J_banded)\n    J_T_banded[1, :] = J_banded[1, :]\n    J_T_banded[0, 1:] = J_banded[2, :-1]\n    J_T_banded[2, :-1] = J_banded[0, 1:]\n    \n    adjoint_lambda = solve_banded((1, 1), J_T_banded, dJ_dT)\n    \n    # 4. Compute dF/dtheta\n    dF_dtheta = np.zeros(num_unknowns, dtype=np.float64)\n    exp_beta_T = get_dk_dtheta(T_full, beta)\n    \n    c = 1.0 / (2.0 * h**2)\n    for i in range(1, N):\n        idx = i - 1\n        T_im1, T_i, T_ip1 = T_full[i-1], T_full[i], T_full[i+1]\n        exp_im1, exp_i, exp_ip1 = exp_beta_T[i-1], exp_beta_T[i], exp_beta_T[i+1]\n        \n        term1 = (exp_i + exp_ip1) * (T_ip1 - T_i)\n        term2 = (exp_im1 + exp_i) * (T_i - T_im1)\n        dF_dtheta[idx] = c * (term1 - term2)\n        \n    # 5. Compute sensitivity\n    sensitivity = -np.dot(adjoint_lambda, dF_dtheta)\n    \n    return sensitivity\n\ndef compute_cs_sensitivity(params, epsilon=1e-30):\n    \"\"\"\n    Computes dJ/dtheta using the complex-step method.\n    \"\"\"\n    # Create a complex copy of params\n    params_cs = params.copy()\n    params_cs['theta'] = params['theta'] + 1j * epsilon\n    params_cs['T_left'] = complex(params['T_left'])\n    params_cs['T_right'] = complex(params['T_right'])\n\n    # Solve forward problem with complex arithmetic\n    T_full_cs = solve_forward(params_cs, dtype=np.complex128)\n    \n    # Compute complex objective function J_h\n    h, N, q_vec = params_cs['h'], params_cs['N'], params_cs['q_vec']\n    J_h_cs = h * ( (q_vec[0] * T_full_cs[0] + q_vec[N] * T_full_cs[N]) / 2.0 + np.sum(q_vec[1:-1] * T_full_cs[1:-1]) )\n\n    # Estimate derivative\n    sensitivity = np.imag(J_h_cs) / epsilon\n    \n    return sensitivity\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case A\n        {'L': 0.1, 'N': 200, 'k0': 10.0, 'beta': 1e-2, 'theta': 5.0, 'q0': 1e6, 'T_left': 300.0, 'T_right': 310.0},\n        # Case B\n        {'L': 0.1, 'N': 200, 'k0': 10.0, 'beta': 1e-2, 'theta': 3.0, 'q0': 0.0, 'T_left': 300.0, 'T_right': 300.0},\n        # Case C\n        {'L': 0.1, 'N': 200, 'k0': 10.0, 'beta': 5e-2, 'theta': 8.0, 'q0': 5e5, 'T_left': 280.0, 'T_right': 320.0},\n    ]\n\n    results = []\n    \n    for case_params in test_cases:\n        N = case_params['N']\n        L = case_params['L']\n        q0 = case_params['q0']\n        h = L / N\n        case_params['h'] = h\n        \n        x_vec = np.linspace(0, L, N + 1)\n        q_vec = q0 * (1 + np.sin(np.pi * x_vec / L))\n        case_params['q_vec'] = q_vec\n        \n        # 1. Solve real forward problem\n        T_real = solve_forward(case_params, dtype=np.float64)\n        \n        # 2. Compute adjoint sensitivity\n        adj_sens = compute_adjoint_sensitivity(T_real, case_params)\n        \n        # 3. Compute complex-step sensitivity for validation\n        cs_sens = compute_cs_sensitivity(case_params)\n        \n        # 4. Calculate absolute difference and store\n        abs_diff = np.abs(adj_sens - cs_sens)\n        results.append(abs_diff)\n        \n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}