{
    "hands_on_practices": [
        {
            "introduction": "拉普拉斯近似是一种强大的工具，它利用后验分布的众数（即最大后验概率估计，MAP）和该点上的曲率（由海森矩阵的逆矩阵给出），以高斯分布快速逼近真实的后验分布。这种方法在计算上十分高效，为优化方法和完全贝叶斯分析之间架起了一座桥梁。这个练习  将指导你如何为一个非线性热学模型推导此近似，并评估其准确性，为计算密集的采样方法提供了一个快速的替代方案。",
            "id": "3938004",
            "problem": "我们考虑一个稳态对流传热中的校准问题。一个表面温度恒定的等温平板，其经历的对流热通量模型为 $q = h(\\theta)\\,\\Delta T$，其中 $\\Delta T$ 是已知的温差，$h(\\theta)$ 是一个由单个标量参数 $\\theta$ 参数化的对流传热系数。受某些对流关系式对类指数参数的近指数级敏感性的启发，我们假设 $h(\\theta) = h_{\\mathrm{ref}} \\exp(\\theta)$，其中 $h_{\\mathrm{ref}}$ 已知。在已知温差 $\\{\\Delta T_i\\}_{i=1}^N$ 条件下，对热通量的含噪测量值 $\\{y_i\\}_{i=1}^N$ 满足\n$$\ny_i = h(\\theta)\\,\\Delta T_i + \\varepsilon_i,\\quad \\varepsilon_i \\sim \\mathcal{N}(0,\\sigma^2),\\quad i=1,\\dots,N,\n$$\n其中 $\\sigma^2$ 已知，且 $\\varepsilon_i$ 在统计上是独立的。为 $\\theta$ 设置一个高斯先验：$\\theta \\sim \\mathcal{N}(\\mu_0,\\sigma_0^2)$，其中 $\\mu_0$ 和 $\\sigma_0^2$ 已知。\n\n给定 $N=3$ 次实验，其中 $h_{\\mathrm{ref}}=100\\,\\mathrm{W\\,m^{-2}\\,K^{-1}}$，$\\mu_0=0$，$\\sigma_0=0.5$，$\\sigma=100\\,\\mathrm{W\\,m^{-2}}$，且\n$$\n\\Delta T_1=10\\,\\mathrm{K},\\quad \\Delta T_2=20\\,\\mathrm{K},\\quad \\Delta T_3=30\\,\\mathrm{K},\n$$\n测得的通量为\n$$\ny_1=1000\\,\\mathrm{W\\,m^{-2}},\\quad y_2=2000\\,\\mathrm{W\\,m^{-2}},\\quad y_3=3000\\,\\mathrm{W\\,m^{-2}}.\n$$\n\n使用贝叶斯定理以及高斯噪声和先验模型：\n\n1) 推导负对数后验 $U(\\theta)$（忽略一个加性常数），用 $\\{y_i\\}$、$\\{\\Delta T_i\\}$、$h_{\\mathrm{ref}}$、$\\sigma^2$、$\\mu_0$ 和 $\\sigma_0^2$ 表示。\n\n2) 通过求解平稳性条件 $U'(\\hat{\\theta})=0$ 来确定最大后验估计 $\\hat{\\theta}$。\n\n3) 推导负对数后验的海森矩阵 $U''(\\theta)$ 以及在 $\\hat{\\theta}$ 附近的后验分布的拉普拉斯（二阶）高斯近似，即均值为 $\\hat{\\theta}$、方差为 $[U''(\\hat{\\theta})]^{-1}$ 的高斯分布。\n\n4) 为评估一个轻度非线性模型的准确性，计算标准化的非高斯性指标\n$$\n\\eta = \\frac{|U^{(3)}(\\hat{\\theta})|}{\\big(U''(\\hat{\\theta})\\big)^{3/2}},\n$$\n其中 $U^{(3)}(\\theta)$ 是 $U(\\theta)$ 的三阶导数。根据给定数据，数值计算 $\\eta$。\n\n将 $\\eta$ 的最终结果表示为一个实数，四舍五入到四位有效数字。$\\eta$ 是无量纲的，不需要单位。",
            "solution": "该问题需要一个分四部分的解答，涉及推导后验分布、找到最大后验 (MAP) 估计、描述后验的二阶高斯近似以及计算非高斯性指标。\n\n热通量的物理模型是 $q_i = h(\\theta) \\Delta T_i$，参数化形式为 $h(\\theta) = h_{\\mathrm{ref}} \\exp(\\theta)$。测量模型是 $y_i = h(\\theta) \\Delta T_i + \\varepsilon_i$，其中噪声项 $\\varepsilon_i$ 是独立同分布 (i.i.d.) 的，服从 $\\varepsilon_i \\sim \\mathcal{N}(0, \\sigma^2)$。为参数 $\\theta$ 指定了一个高斯先验，$\\theta \\sim \\mathcal{N}(\\mu_0, \\sigma_0^2)$。\n\n**第1部分：负对数后验 $U(\\theta)$ 的推导**\n\n根据贝叶斯定理，后验概率密度函数 (PDF) $p(\\theta|\\{y_i\\}_{i=1}^N)$ 与似然函数 $p(\\{y_i\\}_{i=1}^N|\\theta)$ 和先验概率密度函数 $p(\\theta)$ 的乘积成正比。\n$$\np(\\theta|\\{y_i\\}) \\propto p(\\{y_i\\}|\\theta) p(\\theta)\n$$\n单个测量值 $y_i$ 的似然由高斯噪声模型给出：\n$$\np(y_i|\\theta) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(y_i - h(\\theta)\\Delta T_i)^2}{2\\sigma^2}\\right)\n$$\n由于测量值在统计上是独立的，联合似然是各个似然的乘积：\n$$\np(\\{y_i\\}|\\theta) = \\prod_{i=1}^{N} p(y_i|\\theta) = \\left(2\\pi\\sigma^2\\right)^{-N/2} \\exp\\left(-\\frac{1}{2\\sigma^2} \\sum_{i=1}^{N} (y_i - h(\\theta)\\Delta T_i)^2\\right)\n$$\n$\\theta$ 的先验概率密度函数 (PDF) 如下：\n$$\np(\\theta) = \\frac{1}{\\sqrt{2\\pi\\sigma_0^2}} \\exp\\left(-\\frac{(\\theta - \\mu_0)^2}{2\\sigma_0^2}\\right)\n$$\n因此，后验概率密度函数 (PDF) 正比于：\n$$\np(\\theta|\\{y_i\\}) \\propto \\exp\\left(-\\frac{1}{2\\sigma^2} \\sum_{i=1}^{N} (y_i - h_{\\mathrm{ref}}\\exp(\\theta)\\Delta T_i)^2 - \\frac{(\\theta - \\mu_0)^2}{2\\sigma_0^2}\\right)\n$$\n负对数后验 $U(\\theta) = -\\ln(p(\\theta|\\{y_i\\}))$（忽略一个加性常数）为：\n$$\nU(\\theta) = \\frac{1}{2\\sigma^2} \\sum_{i=1}^{N} (y_i - h_{\\mathrm{ref}}\\exp(\\theta)\\Delta T_i)^2 + \\frac{(\\theta - \\mu_0)^2}{2\\sigma_0^2}\n$$\n\n**第2部分：最大后验 (MAP) 估计 $\\hat{\\theta}$**\n\nMAP 估计 $\\hat{\\theta}$ 是使 $U(\\theta)$ 最小化的 $\\theta$ 值。我们通过求解平稳性条件 $U'(\\hat{\\theta}) = \\frac{dU}{d\\theta}\\big|_{\\theta=\\hat{\\theta}} = 0$ 来找到它。\n$U(\\theta)$ 的一阶导数是：\n$$\nU'(\\theta) = \\frac{d}{d\\theta} \\left[ \\frac{1}{2\\sigma^2} \\sum_{i=1}^{N} (y_i - h_{\\mathrm{ref}}\\exp(\\theta)\\Delta T_i)^2 + \\frac{(\\theta - \\mu_0)^2}{2\\sigma_0^2} \\right]\n$$\n$$\nU'(\\theta) = \\frac{1}{2\\sigma^2} \\sum_{i=1}^{N} 2(y_i - h_{\\mathrm{ref}}\\exp(\\theta)\\Delta T_i)(-h_{\\mathrm{ref}}\\exp(\\theta)\\Delta T_i) + \\frac{2(\\theta - \\mu_0)}{2\\sigma_0^2}\n$$\n$$\nU'(\\theta) = -\\frac{h_{\\mathrm{ref}}\\exp(\\theta)}{\\sigma^2} \\sum_{i=1}^{N} (y_i - h_{\\mathrm{ref}}\\exp(\\theta)\\Delta T_i)\\Delta T_i + \\frac{\\theta - \\mu_0}{\\sigma_0^2}\n$$\n提供的数据是 $h_{\\mathrm{ref}}=100\\,\\mathrm{W\\,m^{-2}\\,K^{-1}}$，$\\Delta T_1=10\\,\\mathrm{K}$，$\\Delta T_2=20\\,\\mathrm{K}$，$\\Delta T_3=30\\,\\mathrm{K}$，以及 $y_1=1000\\,\\mathrm{W\\,m^{-2}}$，$y_2=2000\\,\\mathrm{W\\,m^{-2}}$，$y_3=3000\\,\\mathrm{W\\,m^{-2}}$。我们观察到，对于所有的 $i$，$y_i = 100 \\Delta T_i = h_{\\mathrm{ref}} \\Delta T_i$。\n将 $y_i = h_{\\mathrm{ref}} \\Delta T_i$ 代入 $U'(\\theta)$ 的表达式中：\n$$\nU'(\\theta) = -\\frac{h_{\\mathrm{ref}}\\exp(\\theta)}{\\sigma^2} \\sum_{i=1}^{N} (h_{\\mathrm{ref}}\\Delta T_i - h_{\\mathrm{ref}}\\exp(\\theta)\\Delta T_i)\\Delta T_i + \\frac{\\theta - \\mu_0}{\\sigma_0^2}\n$$\n$$\nU'(\\theta) = -\\frac{h_{\\mathrm{ref}}^2\\exp(\\theta)(1 - \\exp(\\theta))}{\\sigma^2} \\sum_{i=1}^{N} (\\Delta T_i)^2 + \\frac{\\theta - \\mu_0}{\\sigma_0^2}\n$$\n我们需要求解 $U'(\\hat{\\theta})=0$。先验参数为 $\\mu_0=0$ 和 $\\sigma_0=0.5$。让我们测试解 $\\hat{\\theta}=0$。当 $\\theta=0$ 时，$\\exp(\\theta)=1$，这使得 $(1 - \\exp(\\theta))$ 项等于 $0$。$U'(\\theta)$ 的第一项消失。第二项变为 $(\\hat{\\theta} - \\mu_0)/\\sigma_0^2 = (0 - 0)/\\sigma_0^2 = 0$。因此，$U'(0) = 0$。\nMAP 估计为 $\\hat{\\theta} = 0$。这个结果的出现是因为数据在先验分布的峰值处与模型预测完全匹配。\n\n**第3部分：海森矩阵 $U''(\\theta)$ 和拉普拉斯近似**\n\n我们通过对 $U'(\\theta)$ 求导来计算 $U(\\theta)$ 的二阶导数，即海森矩阵 $U''(\\theta)$：\n$$\nU'(\\theta) = -\\frac{h_{\\mathrm{ref}}^2}{\\sigma^2}(\\exp(\\theta) - \\exp(2\\theta)) \\sum_{i=1}^{N} (\\Delta T_i)^2 + \\frac{\\theta - \\mu_0}{\\sigma_0^2}\n$$\n对 $\\theta$ 求导：\n$$\nU''(\\theta) = -\\frac{h_{\\mathrm{ref}}^2}{\\sigma^2}(\\exp(\\theta) - 2\\exp(2\\theta)) \\sum_{i=1}^{N} (\\Delta T_i)^2 + \\frac{1}{\\sigma_0^2}\n$$\n拉普拉斯近似是一个以 $\\hat{\\theta}$ 为中心、方差为 $[U''(\\hat{\\theta})]^{-1}$ 的高斯分布。我们在 $\\hat{\\theta}=0$ 处计算 $U''(\\theta)$ 的值：\n$$\nU''(\\hat{\\theta}) = U''(0) = -\\frac{h_{\\mathrm{ref}}^2}{\\sigma^2}(\\exp(0) - 2\\exp(0)) \\sum_{i=1}^{N} (\\Delta T_i)^2 + \\frac{1}{\\sigma_0^2}\n$$\n$$\nU''(\\hat{\\theta}) = -\\frac{h_{\\mathrm{ref}}^2}{\\sigma^2}(1 - 2) \\sum_{i=1}^{N} (\\Delta T_i)^2 + \\frac{1}{\\sigma_0^2}\n$$\n$$\nU''(\\hat{\\theta}) = \\frac{h_{\\mathrm{ref}}^2}{\\sigma^2} \\sum_{i=1}^{N} (\\Delta T_i)^2 + \\frac{1}{\\sigma_0^2}\n$$\n拉普拉斯近似是高斯概率密度函数 $p_{L}(\\theta) = \\mathcal{N}(\\hat{\\theta}, [U''(\\hat{\\theta})]^{-1})$，其中 $\\hat{\\theta}=0$，方差由上述表达式的倒数给出。\n\n**第4部分：非高斯性指标 $\\eta$**\n\n非高斯性指标定义为 $\\eta = |U^{(3)}(\\hat{\\theta})| / (U''(\\hat{\\theta}))^{3/2}$。我们首先通过对 $U''(\\theta)$ 求导来计算三阶导数 $U^{(3)}(\\theta)$：\n$$\nU''(\\theta) = -\\frac{h_{\\mathrm{ref}}^2}{\\sigma^2}(\\exp(\\theta) - 2\\exp(2\\theta)) \\sum_{i=1}^{N} (\\Delta T_i)^2 + \\frac{1}{\\sigma_0^2}\n$$\n$$\nU^{(3)}(\\theta) = -\\frac{h_{\\mathrm{ref}}^2}{\\sigma^2}(\\exp(\\theta) - 4\\exp(2\\theta)) \\sum_{i=1}^{N} (\\Delta T_i)^2\n$$\n在 $\\hat{\\theta}=0$ 处求值：\n$$\nU^{(3)}(\\hat{\\theta}) = U^{(3)}(0) = -\\frac{h_{\\mathrm{ref}}^2}{\\sigma^2}(\\exp(0) - 4\\exp(0)) \\sum_{i=1}^{N} (\\Delta T_i)^2\n$$\n$$\nU^{(3)}(\\hat{\\theta}) = -\\frac{h_{\\mathrm{ref}}^2}{\\sigma^2}(1 - 4) \\sum_{i=1}^{N} (\\Delta T_i)^2\n$$\n$$\nU^{(3)}(\\hat{\\theta}) = \\frac{3h_{\\mathrm{ref}}^2}{\\sigma^2} \\sum_{i=1}^{N} (\\Delta T_i)^2\n$$\n现在我们计算数值。\n温差的平方和为：\n$$\n\\sum_{i=1}^{3} (\\Delta T_i)^2 = (10\\,\\mathrm{K})^2 + (20\\,\\mathrm{K})^2 + (30\\,\\mathrm{K})^2 = 100 + 400 + 900 = 1400\\,\\mathrm{K}^2\n$$\n给定的参数是 $h_{\\mathrm{ref}}=100\\,\\mathrm{W\\,m^{-2}\\,K^{-1}}$，$\\sigma=100\\,\\mathrm{W\\,m^{-2}}$，以及 $\\sigma_0=0.5$。\n所以，$\\frac{h_{\\mathrm{ref}}^2}{\\sigma^2} = \\frac{100^2}{100^2} = 1\\,\\mathrm{K}^{-2}$ 且 $\\sigma_0^2 = 0.5^2 = 0.25$。\n\n让我们数值计算 $U''(\\hat{\\theta})$ 和 $U^{(3)}(\\hat{\\theta})$：\n$$\nU''(\\hat{\\theta}) = \\frac{h_{\\mathrm{ref}}^2}{\\sigma^2} \\sum_{i=1}^{N} (\\Delta T_i)^2 + \\frac{1}{\\sigma_0^2} = (1) \\cdot (1400) + \\frac{1}{0.25} = 1400 + 4 = 1404\n$$\n$$\nU^{(3)}(\\hat{\\theta}) = \\frac{3h_{\\mathrm{ref}}^2}{\\sigma^2} \\sum_{i=1}^{N} (\\Delta T_i)^2 = 3 \\cdot (1) \\cdot (1400) = 4200\n$$\n非高斯性指标 $\\eta$ 为：\n$$\n\\eta = \\frac{|U^{(3)}(\\hat{\\theta})|}{(U''(\\hat{\\theta}))^{3/2}} = \\frac{|4200|}{(1404)^{3/2}} = \\frac{4200}{1404\\sqrt{1404}}\n$$\n计算数值：\n$$\n\\eta \\approx \\frac{4200}{52607.889} \\approx 0.0798364...\n$$\n四舍五入到四位有效数字，我们得到 $\\eta \\approx 0.07984$。",
            "answer": "$$\\boxed{0.07984}$$"
        },
        {
            "introduction": "当后验分布形状复杂，解析近似不再适用时，我们需要依赖如马尔可夫链蒙特卡罗（MCMC）这样强大的数值方法。本练习  深入探讨了应用广泛的Metropolis-Hastings算法的核心，要求你为一个热学参数估计问题正确地构建其接受概率。掌握这一关键步骤对于实现自定义的MCMC采样器和理解其工作机制至关重要。",
            "id": "3938038",
            "problem": "考虑一个一维稳态热传导问题，研究对象是一个厚度为 $L$、热导率为 $k$ 的平板。其在 $x=L$ 处有一个对流边界，传热系数为 $h$，环境温度为 $T_{\\infty}$。$x=0$ 处的左边界保持在已知温度 $T_{L}$。在傅里叶热传导定律和稳态假设下，控制方程为 $-\\frac{d}{dx}\\left(k\\,\\frac{dT}{dx}\\right)=0$，对流边界条件为 $-k\\,\\frac{dT}{dx}(L)=h\\left(T(L)-T_{\\infty}\\right)$。该问题的解是关于 $x$ 的线性函数，$T(x)=T_{L}+a\\,x$，其斜率由边界条件确定。\n\n假设我们在平板内的 $\\{x_{i}\\}_{i=1}^{M}$ 位置收集了 $M$ 个温度测量值 $\\{y_{i}\\}_{i=1}^{M}$。测量模型假设为独立高斯分布，方差已知为 $\\sigma^{2}$，\n$$\ny_{i} = T(x_{i};k,h) + \\varepsilon_{i},\\quad \\varepsilon_{i}\\stackrel{\\text{i.i.d.}}{\\sim}\\mathcal{N}(0,\\sigma^{2}),\\quad i=1,\\dots,M.\n$$\n为确保 $k$ 和 $h$ 的物理正定性，我们引入无约束的参数向量 $\\theta=\\begin{bmatrix}\\theta_{1}\\\\ \\theta_{2}\\end{bmatrix}$，并令 $k=\\exp(\\theta_{1})$ 和 $h=\\exp(\\theta_{2})$。定义正向映射 $g(\\theta)$，其第 $i$ 个分量是由上述物理原理计算得出的 $T(x_{i};\\exp(\\theta_{1}),\\exp(\\theta_{2}))$。假设 $\\theta$ 服从高斯先验分布，\n$$\np(\\theta)=\\mathcal{N}(\\theta;\\mu,\\Lambda)=\\frac{1}{(2\\pi)^{d/2}\\sqrt{\\det\\Lambda}}\\,\\exp\\left(-\\tfrac{1}{2}(\\theta-\\mu)^{\\top}\\Lambda^{-1}(\\theta-\\mu)\\right),\n$$\n其中 $d=2$，均值向量为 $\\mu\\in\\mathbb{R}^{2}$，协方差矩阵为正定矩阵 $\\Lambda\\in\\mathbb{R}^{2\\times 2}$。似然函数由高斯误差模型导出，\n$$\np(y\\mid \\theta)=\\prod_{i=1}^{M}\\frac{1}{\\sqrt{2\\pi\\sigma^{2}}}\\,\\exp\\left(-\\frac{(y_{i}-g_{i}(\\theta))^{2}}{2\\sigma^{2}}\\right)=\\frac{1}{(2\\pi\\sigma^{2})^{M/2}}\\,\\exp\\left(-\\frac{\\|y-g(\\theta)\\|_{2}^{2}}{2\\sigma^{2}}\\right),\n$$\n其中 $y=\\begin{bmatrix}y_{1}  \\dots  y_{M}\\end{bmatrix}^{\\top}$ 且 $g(\\theta)=\\begin{bmatrix}g_{1}(\\theta)  \\dots  g_{M}(\\theta)\\end{bmatrix}^{\\top}$。\n\n我们的目标是从后验分布 $p(\\theta\\mid y)\\propto p(y\\mid \\theta)\\,p(\\theta)$ 中采样，以校准模型并量化不确定性。考虑使用带有高斯随机游走提议的 Metropolis–Hastings 算法\n$$\nq(\\theta'\\mid \\theta)=\\mathcal{N}(\\theta';\\theta,\\Sigma),\n$$\n其中 $\\Sigma$ 是一个对称正定的提议协方差矩阵。从初始状态 $\\theta^{(0)}$ 开始，单次 Metropolis–Hastings 迭代会从 $q(\\theta'\\mid \\theta)$ 中提议一个新的状态 $\\theta'$，计算接受概率 $\\alpha(\\theta,\\theta')$，并以概率 $\\alpha$ 接受该提议，否则保留当前状态。\n\n就上述定义的正向映射 $g(\\theta)$、先验 $p(\\theta)=\\mathcal{N}(\\theta;\\mu,\\Lambda)$ 和似然 $p(y\\mid \\theta)$ 而言，下列哪个表达式以数值稳定的对数形式及其等价的指数形式，正确地指定了这种对称高斯随机游走的接受概率？\n\nA. \n$$\n\\log r(\\theta,\\theta')=-\\frac{\\|y-g(\\theta')\\|_{2}^{2}-\\|y-g(\\theta)\\|_{2}^{2}}{2\\sigma^{2}}-\\frac{1}{2}\\left[(\\theta'-\\mu)^{\\top}\\Lambda^{-1}(\\theta'-\\mu)-(\\theta-\\mu)^{\\top}\\Lambda^{-1}(\\theta-\\mu)\\right],\n$$\n$$\n\\alpha(\\theta,\\theta')=\\min\\left\\{1,\\exp\\left(\\log r(\\theta,\\theta')\\right)\\right\\}.\n$$\n\nB.\n$$\n\\log r(\\theta,\\theta')=-\\frac{\\|y-g(\\theta')\\|_{2}^{2}-\\|y-g(\\theta)\\|_{2}^{2}}{2\\sigma^{2}}+\\left(\\theta'_{1}+\\theta'_{2}-\\theta_{1}-\\theta_{2}\\right)-\\frac{1}{2}\\left[(\\theta'-\\mu)^{\\top}\\Lambda^{-1}(\\theta'-\\mu)-(\\theta-\\mu)^{\\top}\\Lambda^{-1}(\\theta-\\mu)\\right],\n$$\n$$\n\\alpha(\\theta,\\theta')=\\min\\left\\{1,\\exp\\left(\\log r(\\theta,\\theta')\\right)\\right\\}.\n$$\n\nC.\n$$\n\\alpha(\\theta,\\theta')=\\min\\left\\{1,\\frac{p(y\\mid \\theta')\\,p(\\theta')\\,q(\\theta\\mid \\theta')}{p(y\\mid \\theta)\\,p(\\theta)\\,q(\\theta'\\mid \\theta)}\\right\\},\n$$\n其中明确保留了 $q(\\theta'\\mid \\theta)=\\mathcal{N}(\\theta';\\theta,\\Sigma)$。\n\nD.\n$$\n\\log r(\\theta,\\theta')=+\\frac{\\|y-g(\\theta')\\|_{2}^{2}-\\|y-g(\\theta)\\|_{2}^{2}}{2\\sigma^{2}}-\\frac{1}{2}\\left[(\\theta'-\\mu)^{\\top}\\Lambda^{-1}(\\theta'-\\mu)-(\\theta-\\mu)^{\\top}\\Lambda^{-1}(\\theta-\\mu)\\right],\n$$\n$$\n\\alpha(\\theta,\\theta')=\\min\\left\\{1,\\exp\\left(\\log r(\\theta,\\theta')\\right)\\right\\}.\n$$\n\n选择唯一正确的选项。",
            "solution": "Metropolis-Hastings 算法用于从目标概率分布 $\\pi(\\theta)$ 中生成一系列样本 $\\{\\theta^{(t)}\\}$。在本例中，目标分布是在给定测量值 $y$ 的条件下参数 $\\theta$ 的后验分布。根据贝叶斯定理，后验分布与似然和先验的乘积成正比：\n$$\n\\pi(\\theta) = p(\\theta \\mid y) \\propto p(y \\mid \\theta) \\, p(\\theta)\n$$\n从当前状态 $\\theta$ 转移到提议状态 $\\theta'$ 的一般接受概率 $\\alpha(\\theta, \\theta')$ 由下式给出：\n$$\n\\alpha(\\theta, \\theta') = \\min\\left(1, \\frac{\\pi(\\theta') q(\\theta \\mid \\theta')}{\\pi(\\theta) q(\\theta' \\mid \\theta)}\\right)\n$$\n其中 $q(\\theta' \\mid \\theta)$ 是提议分布。\n\n将目标分布 $\\pi(\\theta)$ 的表达式代入，我们得到：\n$$\n\\alpha(\\theta, \\theta') = \\min\\left(1, \\frac{p(y \\mid \\theta')p(\\theta') q(\\theta \\mid \\theta')}{p(y \\mid \\theta)p(\\theta) q(\\theta' \\mid \\theta)}\\right)\n$$\n问题指定了一个对称高斯随机游走提议：\n$$\nq(\\theta' \\mid \\theta) = \\mathcal{N}(\\theta'; \\theta, \\Sigma) = \\frac{1}{\\sqrt{(2\\pi)^d \\det(\\Sigma)}} \\exp\\left(-\\frac{1}{2} (\\theta' - \\theta)^{\\top} \\Sigma^{-1} (\\theta' - \\theta)\\right)\n$$\n其中 $d=2$。反向提议 $q(\\theta \\mid \\theta')$ 的密度为：\n$$\nq(\\theta \\mid \\theta') = \\mathcal{N}(\\theta; \\theta', \\Sigma) = \\frac{1}{\\sqrt{(2\\pi)^d \\det(\\Sigma)}} \\exp\\left(-\\frac{1}{2} (\\theta - \\theta')^{\\top} \\Sigma^{-1} (\\theta - \\theta')\\right)\n$$\n由于 $\\Sigma$ 是对称的，其逆矩阵 $\\Sigma^{-1}$ 也是对称的。我们可以写出 $(\\theta - \\theta') = -(\\theta' - \\theta)$，所以 $(\\theta - \\theta')^{\\top} = -(\\theta' - \\theta)^{\\top}$。$q(\\theta \\mid \\theta')$ 指数中的二次型为：\n$$\n(\\theta - \\theta')^{\\top} \\Sigma^{-1} (\\theta - \\theta') = \\left(-(\\theta' - \\theta)\\right)^{\\top} \\Sigma^{-1} \\left(-(\\theta' - \\theta)\\right) = (\\theta' - \\theta)^{\\top} \\Sigma^{-1} (\\theta' - \\theta)\n$$\n因此，指数是相同的，并且由于归一化常数也相同，我们有 $q(\\theta \\mid \\theta') = q(\\theta' \\mid \\theta)$。该提议分布是对称的。\n\n因此，提议密度的比率 $\\frac{q(\\theta \\mid \\theta')}{q(\\theta' \\mid \\theta)}$ 等于 $1$。接受概率简化为 Metropolis 准则：\n$$\n\\alpha(\\theta, \\theta') = \\min\\left(1, \\frac{p(y \\mid \\theta') p(\\theta')}{p(y \\mid \\theta) p(\\theta)}\\right)\n$$\n我们定义比率 $r(\\theta, \\theta') = \\frac{p(y \\mid \\theta') p(\\theta')}{p(y \\mid \\theta) p(\\theta)}$。为了数值稳定性，标准做法是计算该比率的对数：\n$$\n\\log r(\\theta, \\theta') = \\log\\left(\\frac{p(y \\mid \\theta') p(\\theta')}{p(y \\mid \\theta) p(\\theta)}\\right) = \\left[\\log p(y \\mid \\theta') - \\log p(y \\mid \\theta)\\right] + \\left[\\log p(\\theta') - \\log p(\\theta)\\right]\n$$\n我们现在分别计算每一项。\n\n1.  **对数似然差**：似然由下式给出\n    $$\n    p(y\\mid \\theta)=\\frac{1}{(2\\pi\\sigma^{2})^{M/2}}\\,\\exp\\left(-\\frac{\\|y-g(\\theta)\\|_{2}^{2}}{2\\sigma^{2}}\\right)\n    $$\n    其对数为：\n    $$\n    \\log p(y \\mid \\theta) = -\\frac{M}{2}\\log(2\\pi\\sigma^2) - \\frac{1}{2\\sigma^2}\\|y-g(\\theta)\\|_2^2\n    $$\n    差值为：\n    $$\n    \\log p(y \\mid \\theta') - \\log p(y \\mid \\theta) = \\left(-\\frac{M}{2}\\log(2\\pi\\sigma^2) - \\frac{\\|y-g(\\theta')\\|_2^2}{2\\sigma^2}\\right) - \\left(-\\frac{M}{2}\\log(2\\pi\\sigma^2) - \\frac{\\|y-g(\\theta)\\|_2^2}{2\\sigma^2}\\right) = -\\frac{\\|y-g(\\theta')\\|_2^2 - \\|y-g(\\theta)\\|_2^2}{2\\sigma^2}\n    $$\n\n2.  **对数先验差**：先验由下式给出\n    $$\n    p(\\theta)=\\frac{1}{(2\\pi)^{d/2}\\sqrt{\\det\\Lambda}}\\,\\exp\\left(-\\tfrac{1}{2}(\\theta-\\mu)^{\\top}\\Lambda^{-1}(\\theta-\\mu)\\right)\n    $$\n    其对数为：\n    $$\n    \\log p(\\theta) = C_{\\text{prior}} - \\frac{1}{2}(\\theta-\\mu)^{\\top}\\Lambda^{-1}(\\theta-\\mu)\n    $$\n    其中 $C_{\\text{prior}} = -\\frac{d}{2}\\log(2\\pi) - \\frac{1}{2}\\log(\\det\\Lambda)$ 是一个常数。差值为：\n    $$\n    \\log p(\\theta') - \\log p(\\theta) = \\left(C_{\\text{prior}} - \\frac{1}{2}(\\theta'-\\mu)^{\\top}\\Lambda^{-1}(\\theta'-\\mu)\\right) - \\left(C_{\\text{prior}} - \\frac{1}{2}(\\theta-\\mu)^{\\top}\\Lambda^{-1}(\\theta-\\mu)\\right) = -\\frac{1}{2}\\left( (\\theta'-\\mu)^{\\top}\\Lambda^{-1}(\\theta'-\\mu) - (\\theta-\\mu)^{\\top}\\Lambda^{-1}(\\theta-\\mu) \\right)\n    $$\n\n将两部分结合起来，我们得到 $\\log r(\\theta, \\theta')$ 的表达式：\n$$\n\\log r(\\theta,\\theta')=-\\frac{\\|y-g(\\theta')\\|_{2}^{2}-\\|y-g(\\theta)\\|_{2}^{2}}{2\\sigma^{2}}-\\frac{1}{2}\\left[(\\theta'-\\mu)^{\\top}\\Lambda^{-1}(\\theta'-\\mu)-(\\theta-\\mu)^{\\top}\\Lambda^{-1}(\\theta-\\mu)\\right]\n$$\n接受概率则为 $\\alpha(\\theta, \\theta') = \\min\\{1, \\exp(\\log r(\\theta, \\theta'))\\}$。\n\n现在我们评估给出的选项。\n\n**选项 A：**\n$$\n\\log r(\\theta,\\theta')=-\\frac{\\|y-g(\\theta')\\|_{2}^{2}-\\|y-g(\\theta)\\|_{2}^{2}}{2\\sigma^{2}}-\\frac{1}{2}\\left[(\\theta'-\\mu)^{\\top}\\Lambda^{-1}(\\theta'-\\mu)-(\\theta-\\mu)^{\\top}\\Lambda^{-1}(\\theta-\\mu)\\right],\n$$\n$$\n\\alpha(\\theta,\\theta')=\\min\\left\\{1,\\exp\\left(\\log r(\\theta,\\theta')\\right)\\right\\}.\n$$\n该表达式与我们的推导完全匹配。它正确地结合了 Metropolis 更新步骤（对称提议）的对数似然差和对数先验差。\n\n**选项 B：**\n该表达式引入了一个额外的项 $\\left(\\theta'_{1}+\\theta'_{2}-\\theta_{1}-\\theta_{2}\\right)$。该项对应于从 $(k, h)$ 到 $\\theta$ 变换的雅可比行列式比率的对数。如果先验是定义在物理参数 $(k, h)$ 上，然后转换为关于 $\\theta$ 的先验，则会产生这样的项。然而，问题明确指出，先验是直接定义在无约束参数 $\\theta$ 上的高斯分布。因此，这个雅可比项是不需要的，包含它是错误的。\n\n**选项 C：**\n这是 Metropolis-Hastings 接受概率的通用公式。然而，问题指定了对称提议分布，对于该分布有 $q(\\theta \\mid \\theta')=q(\\theta' \\mid \\theta)$，所以提议密度项会相互抵消。对于这个具体问题，一个正确且完整的答案必须反映出这种简化。此外，问题要求表达式以“数值稳定的对数形式及其等价的指数形式”写出。此选项既未提供简化形式也未提供对数形式，使其成为一个不完整且不如要求具体的答案。\n\n**选项 D：**\n该表达式中似然项的符号是错误的。似然与 $\\exp(-\\|y-g(\\theta)\\|_2^2 / (2\\sigma^2))$ 成正比。一个能更好地拟合数据的提议状态 $\\theta'$ 将具有更小的残差范数，即 $\\|y-g(\\theta')\\|_2^2  \\|y-g(\\theta)\\|_2^2$。这应该导致更高的接受概率。在选项 A 的表达式中，这会使似然项为正，从而增加了比率。在此选项中，项 $\\|y-g(\\theta')\\|_2^2 - \\|y-g(\\theta)\\|_2^2$ 将为负，使得整个第一项为负。这将错误地惩罚那些提供了更好数据拟合的提议。\n\n根据分析，只有选项 A 正确地表示了指定的 Metropolis-Hastings 算法的接受概率。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "成功运行MCMC采样器并生成样本只是第一步，确保这些样本的质量才是最终目的。本练习  提出了一个真实的MCMC采样性能不佳的场景，要求你运用标准的收敛性和混合诊断指标来探查其根本原因。你将学会如何识别诸如参数高度相关等常见问题，并选择有效的改进策略，这是任何严肃的贝叶斯计算实践者都必须掌握的关键技能。",
            "id": "3938052",
            "problem": "一个一维稳态热传导问题被用于校准一块厚度为 $L$ 的均匀平板的热导率 $k$（单位 $\\mathrm{W\\,m^{-1}\\,K^{-1}}$）和对流换热系数 $h$（单位 $\\mathrm{W\\,m^{-2}\\,K^{-1}}$）。该平板在 $x=0$ 处受到已知的、均匀施加的热通量 $q_{\\mathrm{in}}$，并在 $x=L$ 处通过对流冷却至环境温度 $T_{\\infty}$。在位置 $\\{x_i\\}_{i=1}^{m}$ 处采集了温度场 $T(x)$ 的测量值，这些测量值带有独立的、未知方差但受工程规格限制的高斯传感器噪声（假设该方差已知且等于一个常数，记为 $\\sigma^2$）。使用三个长度相等的独立马尔可夫链蒙特卡洛（MCMC）链来探索 $(k,h)$ 的后验分布，在预烧期后，对平稳段的合并诊断结果如下：\n\n- 共有 $3$ 条链，每条链在预烧期后的长度为 $n=3000$。合并估计的一阶自相关系数为 $\\rho_1(k)=0.95$ 和 $\\rho_1(h)=0.93$。估计的积分自相关时间为 $\\hat{\\tau}_{\\mathrm{int}}(k)=120$ 和 $\\hat{\\tau}_{\\mathrm{int}}(h)=90$。\n- 在对数参数化下的估计相关性为 $\\operatorname{corr}(\\log k,\\log h)=-0.98$。\n- 参数 $k$ 的链均值分别为 $(170,200,185)$，相应的链内样本方差为 $(1200,1500,1100)$；参数 $h$ 的链均值分别为 $(70,85,75)$，相应的链内样本方差为 $(400,500,350)$。\n- 估计的 Gelman–Rubin 潜在尺度缩减因子 $\\hat{R}$（以经典的未分割形式计算）报告为 $\\hat{R}(k)\\approx 1.11$ 和 $\\hat{R}(h)\\approx 1.09$。\n\n假设确定性正向模型遵循具有恒定属性和稳态条件的热传导和对流物理定律，并且在给定 $(k,h)$ 条件下，数据的似然函数是高斯分布，其均值为每个 $x_i$ 处的模型预测值，方差为 $\\sigma^2$。根据热传导和对流的基本物理关系，以及有效样本量、自相关和 $\\hat{R}$ 的核心定义，以下哪个选项最恰当地诊断了链的混合和收敛行为，并提出了一种针对根本原因的有效补救措施？\n\nA. 后验分布在 $(k,h)$ 空间中呈现出由附加热阻 $L/k$ 和 $1/h$ 引起的狭窄且强相关的脊状结构，这与 $\\operatorname{corr}(\\log k,\\log h)=-0.98$、较小的有效样本量以及 $\\hat{R}>1.05$ 的结果一致。补救措施：使用与后验协方差对齐的、经过协方差自适应的分块提议来联合采样 $(k,h)$，或者重新参数化为 $(r_{\\mathrm{tot}},\\mathrm{Bi})$，其中 $r_{\\mathrm{tot}}=L/k+1/h$ 且 $\\mathrm{Bi}=hL/k$，并使用对数变换来强制正性；或者，使用几何感知 MCMC，例如带有质量矩阵自适应的哈密顿蒙特卡洛。这些措施应能增加有效样本量，并将 $\\hat{R}$ 降低至接近 $1$。\n\nB. 高自相关性的最佳解决方法是对每条链进行因子为 $10$ 的稀疏化处理，这将使有效样本量增加大约 $10$ 倍，并将 $\\hat{R}$ 降至 $1.05$ 以下，而无需任何重新参数化或分块处理。\n\nC. 在保持相同的采样器和每条链长度不变的情况下，将链的数量从 $3$ 增加到 $10$，即使自相关和参数相关性仍然很高，也能将 $\\hat{R}$ 降低至接近 $1$ 并解决混合病态问题。\n\nD. 减小随机游走提议的步长将降低自相关并增加有效样本量；保持对 $k$ 和 $h$ 的单参数更新是足够的，因此不需要分块或重新参数化。\n\n选择唯一最佳选项。",
            "solution": "问题的核心在于解释 MCMC 诊断指标，以理解采样器的性能及其根本原因。\n\n1.  **MCMC 性能诊断：**\n    *   **收敛性：** Gelman-Rubin 诊断指标 $\\hat{R}(k)\\approx 1.11$ 和 $\\hat{R}(h)\\approx 1.09$ 显著大于 $1$。通常，该值应接近 $1.0$（例如，低于 $1.05$）才能宣布收敛。这表明多个链未能成功探索同一个分布；链间方差与链内方差相比很大。\n    *   **混合性与效率：** 一阶自相关系数 $\\rho_1(k)=0.95$ 和 $\\rho_1(h)=0.93$ 极高。这意味着连续的样本几乎相同，链在参数空间中的探索非常缓慢（混合性差）。这由积分自相关时间（IAT）$\\hat{\\tau}_{\\mathrm{int}}$ 来量化。理想的采样器应有 $\\tau_{\\mathrm{int}} \\approx 1$。这里，$\\hat{\\tau}_{\\mathrm{int}}(k)=120$ 和 $\\hat{\\tau}_{\\mathrm{int}}(h)=90$ 的值非常高。\n    *   **有效样本量 (ESS)：** ESS 是指与自相关样本携带相同信息量的独立样本数量。其计算公式为 $ESS = N_{total} / \\hat{\\tau}_{\\mathrm{int}}$。总样本数为 $N_{total} = 3 \\times 3000 = 9000$，我们得到 $ESS(k) = 9000/120 = 75$ 和 $ESS(h) = 9000/90 = 100$。这些值极低，不足以进行可靠的后验推断。\n\n2.  **根本原因分析：**\n    极高的负相关性 $\\operatorname{corr}(\\log k,\\log h)=-0.98$ 是解释上述所有病态的关键变量。这种相关性不是数值伪影，而是由正向模型的物理特性引起的。对于所描述的物理系统，温度分布的解将取决于总热阻，该热阻大致与传导热阻 $L/k$ 和对流热阻 $1/h$ 之和成比例。因此，任何能使 $L/k+1/h$ 保持近似恒定的 $(k,h)$ 组合都会产生相似的模型预测，导致后验分布中出现一个狭窄的、强相关的“脊”。一个标准的 MCMC 算法，如果沿坐标轴进行提议（例如，固定 $h$ 更新 $k$，然后反之），效率将极低。任何沿一个轴的合理大小的步长都可能将提议状态移动到远离高概率脊的位置，导致高拒绝率，并迫使采样器采取微小的步骤，因此产生高自相关。\n\n3.  **评估提议的补救措施：**\n    一个有效的补救措施必须直接解决强参数相关性问题。\n\n**A. 后验分布在 $(k,h)$ 空间中呈现出由附加热阻 $L/k$ 和 $1/h$ 引起的狭窄且强相关的脊状结构，这与 $\\operatorname{corr}(\\log k,\\log h)=-0.98$、较小的有效样本量以及 $\\hat{R}1.05$ 的结果一致。补救措施：使用与后验协方差对齐的、经过协方差自适应的分块提议来联合采样 $(k,h)$，或者重新参数化为 $(r_{\\mathrm{tot}},\\mathrm{Bi})$，其中 $r_{\\mathrm{tot}}=L/k+1/h$ 且 $\\mathrm{Bi}=hL/k$，并使用对数变换来强制正性；或者，使用几何感知 MCMC，例如带有质量矩阵自适应的哈密顿蒙特卡洛。这些措施应能增加有效样本量，并将 $\\hat{R}$ 降低至接近 $1$。**\n\n-   **分析：** 此选项提供了完美的诊断，将物理模型（$L/k$ 和 $1/h$）与统计问题（相关脊）联系起来，并正确地将其与所有观察到的诊断值联系起来。然后，它提出了三种强大、先进的补救措施，这些措施直接针对相关的根本原因：\n    1.  **协方差自适应分块：** 使用一个形状类似后验分布（即沿脊状结构伸长）的提议分布来联合更新 $(k,h)$，允许在高概率区域内进行大步移动，从而极大地改善混合性。\n    2.  **重新参数化：** 将变量更改为一组相关性较低的变量，例如基于总热阻（$r_{\\mathrm{tot}}$）和毕渥数（$\\mathrm{Bi}$）的变量，可以将困难的后验几何形状转换为一个更容易被标准采样器探索的简单得多的几何形状。\n    3.  **几何感知 MCMC (HMC)：** 这些方法使用梯度信息来智能地导航复杂的后验几何形状，对于高度相关的参数尤其有效。\n-   **结论：** 这个选项在科学上和统计上都是无懈可击的。它正确地诊断了问题，并提出了最恰当和有效的解决方案。\n\n**B. 高自相关性的最佳解决方法是对每条链进行因子为 $10$ 的稀疏化处理，这将使有效样本量增加大约 $10$ 倍，并将 $\\hat{R}$ 降至 $1.05$ 以下，而无需任何重新参数化或分块处理。**\n\n-   **分析：** 这个选项提出了一个根本上错误的论断。稀疏化是丢弃样本以减少存储链中的自相关并节省内存的过程。它**不会**产生新信息或提高底层采样器的效率。有效样本量（$ESS$）是衡量*稀疏化前*整个链信息含量的指标。$ESS$ 不会因为稀疏化而增加。稀疏化不能解决混合性差或缺乏收敛性的问题，因此它也无法解决高 $\\hat{R}$ 值的问题。\n\n**C. 在保持相同的采样器和每条链长度不变的情况下，将链的数量从 $3$ 增加到 $10$，即使自相关和参数相关性仍然很高，也能将 $\\hat{R}$ 降低至接近 $1$ 并解决混合病态问题。**\n\n-   **分析：** 运行更多的并行链对于更稳健地诊断不收敛是有用的，但它并不能修复不收敛。如果采样器效率低下，那么这 $10$ 条链中的每一条都会像原来的 $3$ 条链一样卡住且混合缓慢。$\\hat{R}$ 是链间方差与链内方差的比率；如果链仍然卡在不同的位置，这个比率将保持较大。增加更多的链并不会“解决混合病态问题”。\n\n**D. 减小随机游走提议的步长将降低自相关并增加有效样本量；保持对 $k$ 和 $h$ 的单参数更新是足够的，因此不需要分块或重新参数化。**\n\n-   **分析：** 这个选项显示了对采样器调优和核心问题的误解。首先，对于随机游走采样器，减小提议步长通常会*增加*接受率，但也会*增加*自相关，因为链采取微小的步骤，探索空间更慢。其次，更重要的是，它断言单参数更新是足够的。这恰恰与事实相反。采样器的失败是由于强相关性使得单参数（分量式）更新无效，无论步长如何调整。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}