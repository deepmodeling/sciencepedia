{
    "hands_on_practices": [
        {
            "introduction": "在构建复杂的计算流体动力学 (CFD) 仿真之前，通过简化模型来掌握主导物理机制至关重要。本练习将引导您使用强大的缩放分析技术，推导强制对流中的热边界层厚度 $\\delta_{T}(x)$，并构建局部热通量的工程模型。通过这种方式，您将锻炼自己的物理直觉，并掌握从基本原理出发建立富有洞察力的近似模型的能力。",
            "id": "3943427",
            "problem": "一个用于电子模块的印刷电路板被建模为一个厚度为 $t$、热导率为 $k_{s}$ 的均匀固态平板。其位于 $y=-t$ 的背面通过一个高导热率的散热器维持在均匀的基底温度 $T_{b}$。位于 $y=0$ 的正面暴露于一种冷却剂的稳态、二维、层流、不可压缩的外部流动中，该冷却剂的自由流温度为 $T_{\\infty}$，自由流速度为 $U$，热导率为 $k_{f}$，密度为 $\\rho$，定压比热为 $c_{p}$，热扩散率为 $\\alpha = k_{f}/(\\rho c_{p})$。流动与 $x$ 轴对齐，$x$ 轴测量从板前缘开始的距离，$y$ 轴垂直于板。流体中的粘性耗散和轴向热传导可忽略不计。与板长相比，热边界层很薄，并且热普朗特数 (thermal Prandtl number) 为 $\\mathcal{O}(1)$ 或更大，因此边界层描述是适用的。\n\n从邻近板的流体中的能量守恒出发，并运用适当的层流边界层标度分析，执行以下操作：\n\n1. 通过平衡稳态对流-扩散方程中的主导项，获得特征热边界层厚度 $\\delta_{T}(x)$ 关于 $x$ 和局部佩克莱数 (Péclet number, $\\mathrm{Pe}_{x}$，在此问题中定义为 $\\mathrm{Pe}_{x} = U x / \\alpha$) 的标度表达式。\n\n2. 使用您得到的 $\\delta_{T}(x)$ 的结果，构建局部对流传热系数 $h_{x}(x)$ 的标度，并通过将壁面处的共轭传热建模为两个串联的热阻（穿过固体厚度 $t$ 的法向热传导和穿过流体热边界层的法向对流），推导出局部壁面热通量 $q''_{w}(x)$ 关于 $x$、$U$、$\\alpha$、$k_{f}$、$k_{s}$、$t$、$T_{b}$ 和 $T_{\\infty}$ 的闭式解析表达式。\n\n清楚地说明您推导过程中使用的所有假设。以国际单位制 (SI) 单位 $\\mathrm{W\\,m^{-2}}$ 表示最终的 $q''_{w}(x)$。不需要进行数值计算，也不需要四舍五入。您的最终答案必须是单个解析表达式。",
            "solution": "在进行求解之前，对问题陈述进行了严格验证。\n\n### 步骤 1：提取已知条件\n-   **固态平板 (PCB)：** 厚度 $t$，热导率 $k_{s}$。\n-   **背面边界条件：** 在 $y=-t$ 处，温度均匀为 $T_{b}$。\n-   **正面边界条件：** 在 $y=0$ 处，平板暴露于外部冷却剂流中。\n-   **冷却剂属性：** 自由流温度 $T_{\\infty}$，自由流速度 $U$，热导率 $k_{f}$，密度 $\\rho$，定压比热 $c_{p}$。\n-   **流体热扩散率：** 定义为 $\\alpha = k_{f}/(\\rho c_{p})$。\n-   **流动特性：** 稳态、二维、层流、不可压缩。流动沿 $x$ 轴，从 $x=0$ 处的前缘开始。$y$ 轴垂直于板。\n-   **假设和约束：** 粘性耗散可忽略。流体中的轴向热传导可忽略。热边界层很薄。热普朗特数 (thermal Prandtl number) 为一阶或更大 ($\\mathcal{O}(1)$)。\n-   **佩克莱数 (Péclet number) 定义：** $\\mathrm{Pe}_{x} = U x / \\alpha$。\n-   **任务 1：** 获得热边界层厚度 $\\delta_{T}(x)$ 关于 $x$ 和 $\\mathrm{Pe}_{x}$ 的标度表达式。\n-   **任务 2：** 构建局部对流传热系数 $h_{x}(x)$ 的标度，并使用串联热阻模型推导局部壁面热通量 $q''_{w}(x)$ 的闭式表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n-   **科学依据：** 该问题基于流体动力学和传热学的基本原理，特别是能量守恒、边界层理论和热阻概念。这些是热工学中标准且成熟的概念。所描述的场景是一个经典的共轭传热问题。\n-   **适定性：** 该问题以符号形式提供了所有必要的物理参数和边界条件。各项假设（层流、可忽略的粘性耗散和轴向热传导）适当地简化了控制方程，使得问题可以通过所要求的标度分析来求解。任务定义明确，并在指定模型的框架内导向一个唯一的解析表达式。\n-   **客观性：** 问题以精确、技术性的语言陈述，没有任何主观性或模糊性。\n-   **完整性和一致性：** 问题是自洽的。所有变量都已定义，没有内部矛盾。例如，所述的薄热边界层假设与边界层方程的使用是一致的。\n-   **现实性和可行性：** 冷却印刷电路板的物理设置是一个常见且现实的工程应用。参数是符号化的，避免了任何物理上不一致的数值问题。\n-   **结构和复杂性：** 问题结构良好，从边界层的标度分析逐步构建到一个更复杂的共轭传热模型。它并非微不足道，因为它需要应用和综合几个核心概念。\n\n### 步骤 3：结论与行动\n该问题被判定为**有效**，因为其科学上合理、适定且内部一致。将推导完整解。\n\n### 求解推导\n\n按照问题陈述的要求，求解过程分为两部分。\n\n**第 1 部分：热边界层厚度 $\\delta_{T}(x)$ 的标度分析**\n\n我们从具有恒定属性的不可压缩流体的稳态二维能量方程开始，忽略粘性耗散：\n$$u \\frac{\\partial T}{\\partial x} + v \\frac{\\partial T}{\\partial y} = \\alpha \\left( \\frac{\\partial^2 T}{\\partial x^2} + \\frac{\\partial^2 T}{\\partial y^2} \\right)$$\n其中 $u$ 和 $v$ 分别是 $x$ 和 $y$ 方向的速度分量，$T$ 是流体温度，$\\alpha$ 是热扩散率。\n\n问题陈述指出，边界层描述是适用的。这意味着垂直于壁面的梯度远大于平行于壁面的梯度。因此，与法向热传导 $\\alpha \\frac{\\partial^2 T}{\\partial y^2}$ 相比，轴向热传导 $\\alpha \\frac{\\partial^2 T}{\\partial x^2}$ 可以忽略不计。能量方程简化为热边界层方程：\n$$u \\frac{\\partial T}{\\partial x} + v \\frac{\\partial T}{\\partial y} = \\alpha \\frac{\\partial^2 T}{\\partial y^2}$$\n我们对该方程进行标度分析。设 $x$ 是流动方向上的特征长度尺度。$x$ 方向的特征速度是自由流速度 $U$。热边界层的特征厚度是 $\\delta_{T}(x)$。穿过边界层的特征温差是 $\\Delta T = T_{w}(x) - T_{\\infty}$，其中 $T_{w}(x)$ 是 $y=0$ 处的局部壁面温度。\n\n方程中的各项按如下方式进行标度：\n-   偏导数：$\\frac{\\partial}{\\partial x} \\sim \\frac{1}{x}$，$\\frac{\\partial}{\\partial y} \\sim \\frac{1}{\\delta_{T}}$。\n-   速度：$u \\sim U$。根据连续性方程 $\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} = 0$，我们将 $v$ 标度为 $\\frac{U}{x} \\sim \\frac{v}{\\delta_{T}}$，得到 $v \\sim U \\frac{\\delta_{T}}{x}$。\n\n现在我们对热边界层方程中的各项进行标度：\n-   对流项（左侧）：两个对流项具有相同的数量级。例如，$u \\frac{\\partial T}{\\partial x} \\sim U \\frac{\\Delta T}{x}$。\n-   扩散项（右侧）：$\\alpha \\frac{\\partial^2 T}{\\partial y^2} \\sim \\alpha \\frac{\\Delta T}{\\delta_{T}^2}$。\n\n在边界层中，流动方向的对流与垂直于壁面的扩散相平衡。令这些主导项的标度相等：\n$$U \\frac{\\Delta T}{x} \\sim \\alpha \\frac{\\Delta T}{\\delta_{T}^2}$$\n求解热边界层厚度 $\\delta_{T}$：\n$$\\delta_{T}^2 \\sim \\frac{\\alpha x}{U}$$\n$$\\delta_{T}(x) \\sim \\sqrt{\\frac{\\alpha x}{U}}$$\n为了用局部佩克莱数 $\\mathrm{Pe}_{x} = Ux/\\alpha$ 来表示，我们对表达式进行变换：\n$$\\delta_{T}(x) \\sim \\sqrt{\\frac{\\alpha x^2}{Ux}} = x \\sqrt{\\frac{\\alpha}{Ux}} = x \\left(\\frac{Ux}{\\alpha}\\right)^{-1/2}$$\n这给出了所需的标度关系：\n$$\\delta_{T}(x) \\sim x \\, \\mathrm{Pe}_{x}^{-1/2}$$\n\n**第 2 部分：$h_{x}(x)$ 的标度分析和 $q''_{w}(x)$ 的推导**\n\n首先，我们构建局部对流传热系数 $h_{x}(x)$ 的标度。根据定义，从壁面进入流体的热通量由流固界面（$y=0$）处的傅里叶热传导定律 (Fourier's law) 和牛顿冷却定律 (Newton's law of cooling) 给出：\n$$q''_{w}(x) = -k_{f} \\left. \\frac{\\partial T}{\\partial y} \\right|_{y=0} = h_{x}(x) (T_{w}(x) - T_{\\infty})$$\n由此，我们可以定义 $h_x(x)$。使用我们的标度论证，梯度 $\\left. \\frac{\\partial T}{\\partial y} \\right|_{y=0}$ 的标度为 $\\frac{\\Delta T}{\\delta_{T}} = \\frac{T_{w}(x) - T_{\\infty}}{\\delta_{T}(x)}$。将此代入定义中，得到 $h_x(x)$ 的标度：\n$$h_{x}(x) \\sim \\frac{k_{f} \\frac{T_{w}(x) - T_{\\infty}}{\\delta_{T}(x)}}{T_{w}(x) - T_{\\infty}} = \\frac{k_{f}}{\\delta_{T}(x)}$$\n这就是构建的 $h_x(x)$ 的标度。为了继续，我们将此标度作为近似等式，这在此类建模练习中是常见的做法。代入我们得到的 $\\delta_{T}(x)$ 的结果：\n$$h_{x}(x) = \\frac{k_{f}}{\\sqrt{\\frac{\\alpha x}{U}}} = k_{f} \\sqrt{\\frac{U}{\\alpha x}}$$\n接下来，我们使用热阻网络对共轭传热过程进行建模。在任意给定位置 $x$，总热通量 $q''_{w}(x)$ 从温度为 $T_{b}$ 的基底流出，通过固态平板进行热传导，然后对流到温度为 $T_{\\infty}$ 的流体中。这可以建模为两个串联的单位面积热阻：\n\n1.  **固态平板的导热热阻：** $R''_{cond} = \\frac{\\text{厚度}}{\\text{热导率}} = \\frac{t}{k_{s}}$。\n2.  **流体边界层的对流热阻：** $R''_{conv}(x) = \\frac{1}{h_{x}(x)}$。\n\n单位面积总热阻是串联热阻之和：\n$$R''_{tot}(x) = R''_{cond} + R''_{conv}(x) = \\frac{t}{k_{s}} + \\frac{1}{h_{x}(x)}$$\n局部壁面热通量 $q''_{w}(x)$ 由跨越该总热阻的总体温差 $T_{b} - T_{\\infty}$ 驱动：\n$$q''_{w}(x) = \\frac{T_{b} - T_{\\infty}}{R''_{tot}(x)} = \\frac{T_{b} - T_{\\infty}}{\\frac{t}{k_{s}} + \\frac{1}{h_{x}(x)}}$$\n最后，我们将 $h_{x}(x)$ 的表达式代入此方程，得到 $q''_{w}(x)$ 的闭式表达式：\n$$q''_{w}(x) = \\frac{T_{b} - T_{\\infty}}{\\frac{t}{k_{s}} + \\frac{1}{k_{f}\\sqrt{\\frac{U}{\\alpha x}}}}$$\n简化分母得到最终结果：\n$$q''_{w}(x) = \\frac{T_{b} - T_{\\infty}}{\\frac{t}{k_{s}} + \\frac{1}{k_{f}}\\sqrt{\\frac{\\alpha x}{U}}}$$\n该表达式给出了局部壁面热通量作为所有指定参数（$x$、$U$、$\\alpha$、$k_{f}$、$k_{s}$、$t$、$T_{b}$ 和 $T_{\\infty}$）的函数。单位为 $(K) / (m^2 \\cdot K / W) = W/m^2$，这对于热通量是正确的。",
            "answer": "$$\\boxed{\\frac{T_{b} - T_{\\infty}}{\\frac{t}{k_{s}} + \\frac{1}{k_{f}} \\sqrt{\\frac{\\alpha x}{U}}}}$$"
        },
        {
            "introduction": "真实的共轭传热问题通常是高度非线性且紧密耦合的，需要强大的数值求解器。本练习将带您深入共轭传热求解器的核心，要求您为一个具有温变物性的系统实现牛顿-拉夫逊 (Newton-Raphson) 方法。掌握此练习的关键在于构建雅可比矩阵，这是高效求解复杂耦合系统的基础。",
            "id": "3943440",
            "problem": "考虑一个用于电子冷却组件的一维稳态共轭传热模型，其中厚度为 $L_s$ 的固体壁将热量从具有已知基底温度 $T_{\\mathrm{chip}}$ 的芯片传导至直径为 $D$、长度为 $L$ 的单个圆形冷却通道中。固体被建模为面积为 $A_s$、热导率 $k_s(T)$ 随温度变化的平板，通道中的流体使用具有随温度变化物性的活塞流能量平衡进行建模。流体以温度 $T_{\\mathrm{in}}$ 和质量流量 $\\dot{m}$ 进入。设通道沿 $x$ 方向均匀离散为 $N$ 个大小为 $\\Delta x = L/N$ 的控制体，在 $x_i = i \\Delta x$ 处有流体主流温度 $T_{f,i}$（$i=1,\\dots,N$），并且在入口处已知 $T_{f,0} = T_{\\mathrm{in}}$。\n\n基本原理：\n- 从固体的稳态能量守恒出发：通过固体的传导热率等于沿湿润面积向流体的对流热率。\n- 从每个流向控制体中流体的稳态能量守恒出发：跨控制体的流体焓增等于在界面处从固体传递的对流热量。\n- 使用经过充分验证的用于湍流的 Dittus-Boelter 关联式和用于层流的经典恒定壁温努塞尔数来计算传热系数，其中流体物性随温度变化。\n\n假设与定义：\n- 固体热导率为 $k_s(T) = k_{s0} + a_s \\left( T - T_0 \\right)$，其中 $k_{s0}$、$a_s$ 和 $T_0$ 是常数。\n- 流体密度 $\\rho$ 为常数，流体定压比热 $c_p$ 为常数，流体动力粘度为 $\\mu(T) = \\mu_0 \\exp\\!\\left( - b_\\mu \\left( T - T_0 \\right) \\right)$，流体热导率为 $k_f(T) = k_{f0} + a_k \\left( T - T_0 \\right)$。\n- 在每个轴向位置 $x_i$ 处的对流传热系数为 $h_i = h\\!\\left( T_{f,i} \\right)$，计算如下。设 $\\mathrm{Re}(T) = \\dfrac{\\rho u D}{\\mu(T)}$，其中 $u = \\dfrac{\\dot{m}}{\\rho A}$，$A = \\dfrac{\\pi D^2}{4}$ 是通道横截面积。设 $\\mathrm{Pr}(T) = \\dfrac{\\mu(T) c_p}{k_f(T)}$。设湿润周长为 $P = \\pi D$。则\n$$\n\\mathrm{Nu}(T) = \n\\begin{cases}\n3.66,  \\mathrm{Re}(T)  2300 \\\\\n0.023 \\, \\mathrm{Re}(T)^{0.8} \\, \\mathrm{Pr}(T)^{0.4},  \\mathrm{Re}(T) \\ge 2300\n\\end{cases}\n,\\quad h(T) = \\dfrac{\\mathrm{Nu}(T) \\, k_f(T)}{D}.\n$$\n- 固液界面温度沿 $x$ 方向均匀，记为 $T_s$。\n- 通过固体的传导热率为 $Q_{\\mathrm{cond}} = \\dfrac{k_s(T_{\\mathrm{mid}}) \\, A_s}{L_s} \\left( T_{\\mathrm{chip}} - T_s \\right)$，其中 $T_{\\mathrm{mid}} = \\dfrac{T_{\\mathrm{chip}} + T_s}{2}$。\n- 向流体的总对流热率近似为 $Q_{\\mathrm{conv}} = \\sum_{i=1}^{N} h\\!\\left( T_{f,i} \\right) P \\Delta x \\left( T_s - T_{f,i} \\right)$。\n\n离散非线性系统：\n- 固体能量平衡残差：\n$$\nR_0(T_s, \\{T_{f,i}\\}) = \\dfrac{k_s(T_{\\mathrm{mid}}) \\, A_s}{L_s} \\left( T_{\\mathrm{chip}} - T_s \\right) - \\sum_{i=1}^N h\\!\\left( T_{f,i} \\right) P \\Delta x \\left( T_s - T_{f,i} \\right) = 0.\n$$\n- 流体能量平衡残差，对于 $i=1,\\dots,N$：\n$$\nR_i(T_s, T_{f,i}, T_{f,i-1}) = \\dot{m} \\, c_p \\left( T_{f,i} - T_{f,i-1} \\right) - h\\!\\left( T_{f,i} \\right) P \\Delta x \\left( T_s - T_{f,i} \\right) = 0,\n$$\n其中已知 $T_{f,0} = T_{\\mathrm{in}}$。\n\n牛顿迭代的雅可比矩阵构建：\n- 设未知量向量为 $\\mathbf{U} = \\left[ T_s, T_{f,1}, \\dots, T_{f,N} \\right]^T$。\n- 定义 $h(T)$ 关于温度 $T$ 的导数，记为 $h'(T)$，如下所示。对于层流区 ($\\mathrm{Re}(T)  2300$)，\n$$\nh'(T) = \\dfrac{\\mathrm{Nu}}{D} k_f'(T), \\quad k_f'(T) = a_k\n$$\n其中 $\\mathrm{Nu} = 3.66$ 为常数。对于湍流区 ($\\mathrm{Re}(T) \\ge 2300$)，使用 Dittus-Boelter 关联式，并应用乘法法则和对数求导，\n$$\n\\frac{h'(T)}{h(T)} = -0.4 \\frac{\\mu'(T)}{\\mu(T)} + 0.6 \\frac{k_f'(T)}{k_f(T)}, \\quad \\mu'(T) = -b_\\mu \\mu(T), \\quad k_f'(T) = a_k\n$$\n因此 $h'(T) = h(T) \\left( -0.4 \\dfrac{\\mu'(T)}{\\mu(T)} + 0.6 \\dfrac{k_f'(T)}{k_f(T)} \\right)$。\n- 在给定迭代步，雅可比矩阵元素中的偏导数由以下公式给出\n$$\n\\frac{\\partial R_0}{\\partial T_s} = \\frac{A_s}{L_s} \\left( \\frac{1}{2} k_s'(T_{\\mathrm{mid}}) \\left( T_{\\mathrm{chip}} - T_s \\right) - k_s(T_{\\mathrm{mid}}) \\right) - \\sum_{i=1}^N h\\!\\left( T_{f,i} \\right) P \\Delta x\n$$,\n$$\n\\frac{\\partial R_0}{\\partial T_{f,i}} = P \\Delta x \\left( h\\!\\left( T_{f,i} \\right) - h'\\!\\left( T_{f,i} \\right) \\left( T_s - T_{f,i} \\right) \\right)\n$$,\n$$\n\\frac{\\partial R_i}{\\partial T_s} = - h\\!\\left( T_{f,i} \\right) P \\Delta x\n$$,\n$$\n\\frac{\\partial R_i}{\\partial T_{f,i}} = \\dot{m} \\, c_p + h\\!\\left( T_{f,i} \\right) P \\Delta x - h'\\!\\left( T_{f,i} \\right) P \\Delta x \\left( T_s - T_{f,i} \\right)\n$$,\n$$\n\\frac{\\partial R_i}{\\partial T_{f,i-1}} = - \\dot{m} \\, c_p\n$$,\n雅可比矩阵中所有其他偏导数均为零。\n\n你的任务：\n- 实现一个牛顿迭代，该迭代使用上述解析导数构建完整的雅可比矩阵 $\\mathbf{J}(\\mathbf{U})$，并在每次迭代中求解更新方向，以使残差向量 $\\mathbf{R}(\\mathbf{U})$ 趋于零。如有必要，使用简单的回溯线搜索以确保残差范数的单调递减。从初始猜测值 $T_s^{(0)} = T_{\\mathrm{chip}}$ 和 $T_{f,i}^{(0)} = T_{\\mathrm{in}}$（对所有 $i$）开始。使用 $10^{-8}$ 的绝对残差范数停止准则和最大 $50$ 次迭代。\n- 对于每个测试用例，报告界面温度 $T_s$ 和出口流体温度 $T_{f,N}$。\n\n物理和数值单位：\n- 所有温度以开尔文（$\\mathrm{K}$）表示，几何长度以米（$\\mathrm{m}$）表示。动力粘度单位为帕斯卡秒（$\\mathrm{Pa\\,s}$），热导率单位为瓦特每米开尔文（$\\mathrm{W\\,m^{-1}\\,K^{-1}}$），密度单位为千克每立方米（$\\mathrm{kg\\,m^{-3}}$），比热单位为焦耳每千克开尔文（$\\mathrm{J\\,kg^{-1}\\,K^{-1}}$），质量流量单位为千克每秒（$\\mathrm{kg\\,s^{-1}}$）。最终报告的温度必须四舍五入到三位小数并以开尔文表示。\n\n测试套件：\n在所有案例中使用以下共享的几何和物性参数：\n- $D = 4 \\times 10^{-3}$, $L = 0.1$, $N = 10$, $P = \\pi D$, $A = \\dfrac{\\pi D^2}{4}$。\n- $A_s = 4.0 \\times 10^{-4}$, $L_s = 2.0 \\times 10^{-3}$。\n- $T_{\\mathrm{chip}} = 350$, $T_{\\mathrm{in}} = 300$, $T_0 = 300$。\n- $k_{s0} = 150$, $a_s = 0.1$。\n- $\\rho = 997$, $c_p = 4181$。\n- $k_{f0} = 0.6$, $a_k = 0.001$。\n- $\\mu_0 = 1.0 \\times 10^{-3}$, $b_\\mu = 0.03$。\n\n提供三个质量流量的测试用例：\n1. 正常湍流情况：$\\dot{m} = 0.0125$。\n2. 强湍流情况：$\\dot{m} = 0.0300$。\n3. 层流情况：$\\dot{m} = 0.0020$。\n\n答案规格和最终输出格式：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的列表。每个测试用例的结果必须是一个包含两个元素的列表 $[T_s, T_{f,N}]$，两个值均以开尔文为单位并四舍五入到三位小数。例如，输出应如下所示 $[[T_{s,1}, T_{f,N,1}],[T_{s,2}, T_{f,N,2}],[T_{s,3}, T_{f,N,3}]]$，其中下标表示案例索引。",
            "solution": "用户提供了一个在计算热工学领域中明确定义的问题，特别关注电子冷却中的共轭传热问题。任务是求解一个代表固体域和流体域稳态热能平衡的耦合非线性代数方程组。\n\n### 步骤 1：问题验证\n\n**1.1. 提取已知条件**\n\n- **几何**：固体厚度 $L_s$，固体面积 $A_s$，通道直径 $D$，通道长度 $L$，控制体数量 $N$。\n- **派生几何参数**：控制体大小 $\\Delta x = L/N$，湿润周长 $P = \\pi D$，通道横截面积 $A = \\pi D^2/4$。\n- **边界条件**：固定的芯片基底温度 $T_{\\mathrm{chip}}$，流体入口温度 $T_{\\mathrm{in}}$。\n- **未知量**：均匀的固液界面温度 $T_s$，以及离散的流体主流温度 $T_{f,i}$（$i=1, \\dots, N$）。未知量向量为 $\\mathbf{U} = [T_s, T_{f,1}, \\dots, T_{f,N}]^T$。\n- **材料物性（固体）**：随温度变化的热导率 $k_s(T) = k_{s0} + a_s(T - T_0)$。\n- **材料物性（流体）**：恒定密度 $\\rho$，恒定比热 $c_p$，随温度变化的动力粘度 $\\mu(T) = \\mu_0 \\exp(-b_\\mu(T - T_0))$，以及随温度变化的热导率 $k_f(T) = k_{f0} + a_k(T - T_0)$。\n- **流动**：质量流量 $\\dot{m}$。\n- **传热模型**：\n    - 传导：$Q_{\\mathrm{cond}} = \\frac{k_s(T_{\\mathrm{mid}}) A_s}{L_s}(T_{\\mathrm{chip}} - T_s)$，其中 $T_{\\mathrm{mid}} = \\frac{T_{\\mathrm{chip}} + T_s}{2}$。\n    - 对流：对流传热系数 $h(T)$ 基于努塞尔数 $\\mathrm{Nu}(T)$，$\\mathrm{Nu}(T)$ 是雷诺数 $\\mathrm{Re}(T)$ 的分段函数。\n        - $\\mathrm{Re}(T) = \\frac{\\rho u D}{\\mu(T)}$，其中 $u = \\frac{\\dot{m}}{\\rho A}$。\n        - $\\mathrm{Pr}(T) = \\frac{\\mu(T) c_p}{k_f(T)}$。\n        - 对于层流（$\\mathrm{Re}  2300$），$\\mathrm{Nu}(T)$ 为 $3.66$；对于湍流（$\\mathrm{Re} \\ge 2300$），$\\mathrm{Nu}(T)$ 来自 Dittus-Boelter 关联式，$0.023 \\, \\mathrm{Re}^{0.8} \\, \\mathrm{Pr}^{0.4}$。\n        - $h(T) = \\frac{\\mathrm{Nu}(T) k_f(T)}{D}$。\n- **离散方程（残差）**：\n    - 固体：$R_0 = Q_{\\mathrm{cond}} - \\sum_{i=1}^N h(T_{f,i}) P \\Delta x(T_s - T_{f,i}) = 0$。\n    - 流体：$R_i = \\dot{m} c_p(T_{f,i} - T_{f,i-1}) - h(T_{f,i}) P \\Delta x(T_s - T_{f,i}) = 0$，对于 $i=1, \\dots, N$，其中 $T_{f,0} = T_{\\mathrm{in}}$。\n- **数值方法**：牛顿-拉夫逊法，使用初始猜测值（$T_s^{(0)} = T_{\\mathrm{chip}}$，$T_{f,i}^{(0)} = T_{\\mathrm{in}}$）、$10^{-8}$ 的绝对残差范数停止准则、最多 50 次迭代，以及可选的回溯线搜索。\n- **雅可比矩阵项**：明确提供了所有偏导数 $\\frac{\\partial R_j}{\\partial U_k}$。\n- **常数和测试用例**：提供了所有常数的数值以及 $\\dot{m}$ 的三个测试用例。\n\n**1.2. 使用提取的已知条件进行验证**\n\n- **科学依据充分**：该问题牢固地植根于传热学（传导、对流）和流体动力学的基本原理。固体和流体控制体的能量守恒方程是标准的。对湍流使用 Dittus-Boelter 关联式和对层流管流使用恒定努塞尔数是经典的、成熟的工程实践。材料物性的温度依赖性是常见的线性或指数模型。该问题在科学上是合理的。\n- **适定的**：该问题为 $N+1$ 个未知量定义了一个包含 $N+1$ 个非线性代数方程的系统。提供解析的雅可比矩阵项证实了该系统是可微的，并且适合使用牛顿-拉夫逊法求解。边界条件已指定，对于给定的物理设置，预期有唯一解。该问题是适定的。\n- **客观的**：问题使用精确、正式且无偏见的科学语言陈述。没有主观因素。\n- **完整性和一致性**：提供了所有必要的参数、方程、边界条件、初始猜测值和数值求解参数。没有缺失数据或矛盾。单位已指定且一致。\n- **可行性**：物理参数和操作条件对于电子冷却应用（例如水冷）是现实的。所提议的数值方法是解决此类问题的标准方法。\n- **结构**：问题结构逻辑清晰，从物理原理开始，定义数学模型，最后指定数值任务。\n\n**1.3. 结论与行动**\n\n该问题是有效的，因为它科学依据充分、适定、客观、完整、一致且可行。我将按要求着手制定和实施解决方案。\n\n### 步骤 2：解决方案实施\n\n将使用牛顿-拉夫逊法来求解这个包含 $N+1$ 个非线性方程的系统。未知量是固液界面温度 $T_s$ 和 $N$ 个流体控制体温度 $T_{f,i}$。设未知量向量为 $\\mathbf{U} = [T_s, T_{f,1}, \\dots, T_{f,N}]^T$。\n\n牛顿-拉夫逊法通过求解线性系统 $\\mathbf{J}(\\mathbf{U}^{(k)}) \\delta \\mathbf{U} = -\\mathbf{R}(\\mathbf{U}^{(k)})$ 来迭代求解更新量 $\\delta \\mathbf{U}$，其中 $\\mathbf{R}$ 是残差向量，$\\mathbf{J}$ 是雅可比矩阵。然后，新的估计值为 $\\mathbf{U}^{(k+1)} = \\mathbf{U}^{(k)} + \\alpha \\delta \\mathbf{U}$，其中 $\\alpha$ 是由回溯线搜索确定的阻尼因子，以确保收敛。\n\n**算法步骤：**\n\n1.  **初始化**：\n    - 设置迭代计数器 $k = 0$。\n    - 定义所有物理常数、几何参数和计算设置（$N$、容差、最大迭代次数）。\n    - 构建初始猜测向量 $\\mathbf{U}^{(0)}$：$U_0 = T_{\\mathrm{chip}}$ 且对于 $i=1, \\dots, N$，$U_i = T_{\\mathrm{in}}$。\n\n2.  **迭代循环**：对于 $k = 0, 1, 2, \\dots$ 直到最大迭代次数：\n    a.  **计算残差和雅可比矩阵**：\n        - 在当前状态 $\\mathbf{U}^{(k)}$下，为每个流体节点 $i=1, \\dots, N$ 评估所有随温度变化的物性（$k_s, k_f, \\mu$）以及对流传热系数 $h(T_{f,i})$ 及其导数 $h'(T_{f,i})$。\n        - 使用为 $R_0, \\dots, R_N$ 提供的方程组装大小为 $N+1$ 的残差向量 $\\mathbf{R}(\\mathbf{U}^{(k)})$。\n        - 使用提供的解析偏导数组装大小为 $(N+1) \\times (N+1)$ 的雅可比矩阵 $\\mathbf{J}(\\mathbf{U}^{(k)})$。\n\n    b.  **检查收敛性**：\n        - 计算残差向量的 L2 范数 $||\\mathbf{R}(\\mathbf{U}^{(k)})||_2$。\n        - 如果范数小于指定的容差（$10^{-8}$），则解已收敛。退出循环。\n\n    c.  **求解更新量**：\n        - 求解线性系统 $\\mathbf{J} \\delta \\mathbf{U} = -\\mathbf{R}$ 以获得更新向量 $\\delta \\mathbf{U}$。这将使用 `numpy.linalg.solve` 完成。\n\n    d.  **使用线搜索更新解**：\n        - 从阻尼因子 $\\alpha = 1.0$ 开始。\n        - 当新试验状态下的残差范数 $||\\mathbf{R}(\\mathbf{U}^{(k)} + \\alpha \\delta \\mathbf{U})||_2$ 不小于当前残差范数 $||\\mathbf{R}(\\mathbf{U}^{(k)})||_2$ 时，将 $\\alpha$ 减半。对非物理（例如，负绝对）温度的检查也是谨慎的。\n        - 更新解向量：$\\mathbf{U}^{(k+1)} = \\mathbf{U}^{(k)} + \\alpha \\delta \\mathbf{U}$。\n\n3.  **最终处理**：\n    - 一旦循环终止（因收敛或达到最大迭代次数），最终向量 $\\mathbf{U}$ 包含了解。\n    - 提取界面温度 $T_s = U_0$ 和出口流体温度 $T_{f,N} = U_N$。\n    - 按要求将结果四舍五入到三位小数。\n\n对于给定的三个质量流量中的每一个，重复此迭代过程，并收集结果用于最终输出。Python 实现将封装此逻辑，并使用辅助函数来处理物性及其导数，以确保代码的清晰度和正确性。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the solution for the given test cases.\n    It sets up the problem parameters, iterates through the test cases,\n    calls the solver, and formats the final output string.\n    \"\"\"\n    # Shared geometry and property parameters\n    D = 4.0e-3\n    L = 0.1\n    N = 10\n    As = 4.0e-4\n    Ls = 2.0e-3\n    T_chip = 350.0\n    T_in = 300.0\n    T0 = 300.0\n    k_s0 = 150.0\n    a_s = 0.1\n    rho = 997.0\n    c_p = 4181.0\n    k_f0 = 0.6\n    a_k = 0.001\n    mu_0 = 1.0e-3\n    b_mu = 0.03\n\n    # Test cases for mass flow rate\n    test_cases_mdot = [0.0125, 0.0300, 0.0020]\n\n    results = []\n    for mdot in test_cases_mdot:\n        Ts, TfN = solve_newton_system(\n            mdot, D, L, N, As, Ls, T_chip, T_in, T0,\n            k_s0, a_s, rho, c_p, k_f0, a_k, mu_0, b_mu\n        )\n        results.append([round(Ts, 3), round(TfN, 3)])\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef solve_newton_system(\n    mdot, D, L, N, As, Ls, T_chip, T_in, T0,\n    k_s0, a_s, rho, c_p, k_f0, a_k, mu_0, b_mu\n):\n    \"\"\"\n    Solves the nonlinear system of equations representing the conjugate heat\n    transfer problem using Newton's method with a backtracking line search.\n    \"\"\"\n    # Derived geometric and flow parameters\n    dx = L / N\n    P = np.pi * D\n    A_flow = np.pi * D**2 / 4\n    u = mdot / (rho * A_flow)\n\n    # --- Property functions and their derivatives ---\n    def k_s(T): return k_s0 + a_s * (T - T0)\n    def k_s_prime(T): return a_s\n    def k_f(T): return k_f0 + a_k * (T - T0)\n    def k_f_prime(T): return a_k\n    def mu(T): return mu_0 * np.exp(-b_mu * (T - T0))\n\n    def get_h_and_hprime(T):\n        mu_T = mu(T)\n        k_f_T = k_f(T)\n        Re = rho * u * D / mu_T\n        \n        if Re  2300:  # Laminar\n            Nu = 3.66\n            h_val = Nu * k_f_T / D\n            h_prime_val = Nu * k_f_prime(T) / D\n        else:  # Turbulent\n            Pr = mu_T * c_p / k_f_T\n            Nu = 0.023 * Re**0.8 * Pr**0.4\n            h_val = Nu * k_f_T / D\n            # Simplified derivative: h'(T) = h(T) * (0.4 * b_mu + 0.6 * a_k / k_f(T))\n            h_prime_val = h_val * (0.4 * b_mu + 0.6 * k_f_prime(T) / k_f_T)\n        return h_val, h_prime_val\n\n    # --- Residual Calculation Function (used for line search) ---\n    def calculate_residuals(U_vec):\n        Ts = U_vec[0]\n        Tf = U_vec[1:]\n        R = np.zeros(N + 1)\n        \n        T_mid = (T_chip + Ts) / 2.0\n        Q_cond = (k_s(T_mid) * As / Ls) * (T_chip - Ts)\n        \n        sum_Q_conv_i = 0.0\n        for i in range(1, N + 1):\n            Tfi = Tf[i-1]\n            Tf_prev = T_in if i == 1 else Tf[i-2]\n            hi, _ = get_h_and_hprime(Tfi)\n            Q_conv_i = hi * P * dx * (Ts - Tfi)\n            R[i] = mdot * c_p * (Tfi - Tf_prev) - Q_conv_i\n            sum_Q_conv_i += Q_conv_i\n            \n        R[0] = Q_cond - sum_Q_conv_i\n        return R\n\n    # --- Newton's Method Iteration ---\n    U = np.full(N + 1, T_in, dtype=float)\n    U[0] = T_chip\n\n    max_iter = 50\n    tol = 1e-8\n\n    for _ in range(max_iter):\n        Ts = U[0]\n        Tf = U[1:]\n        \n        R = np.zeros(N + 1)\n        J = np.zeros((N + 1, N + 1))\n        \n        # Build Residual Vector R and Jacobian Matrix J\n        T_mid = (T_chip + Ts) / 2.0\n        ks_T_mid = k_s(T_mid)\n        Q_cond = (ks_T_mid * As / Ls) * (T_chip - Ts)\n        \n        sum_h_term_R0 = 0.0\n        sum_h_term_J00 = 0.0\n        \n        for i in range(1, N + 1):\n            Tfi = Tf[i-1]\n            Tf_prev = T_in if i == 1 else Tf[i-2]\n            hi, h_prime_i = get_h_and_hprime(Tfi)\n            \n            conv_from_wall = hi * P * dx * (Ts - Tfi)\n            R[i] = mdot * c_p * (Tfi - Tf_prev) - conv_from_wall\n            \n            sum_h_term_R0 += conv_from_wall\n            sum_h_term_J00 += hi * P * dx\n            \n            # Jacobian entries for row i\n            J[i, 0] = -hi * P * dx  # dR_i/dTs\n            if i  1:\n                J[i, i - 1] = -mdot * c_p  # dR_i/dTf_{i-1}\n            J[i, i] = mdot * c_p + hi * P * dx - h_prime_i * P * dx * (Ts - Tfi)  # dR_i/dTf_i\n            J[0, i] = P * dx * (hi - h_prime_i * (Ts - Tfi)) # dR_0/dTf_i\n            \n        R[0] = Q_cond - sum_h_term_R0\n        J[0, 0] = (As / Ls) * (0.5 * k_s_prime(T_mid) * (T_chip - Ts) - ks_T_mid) - sum_h_term_J00\n\n        res_norm = np.linalg.norm(R)\n        if res_norm  tol:\n            break\n            \n        delta_U = np.linalg.solve(J, -R)\n        \n        # Backtracking line search\n        alpha = 1.0\n        current_res_norm_sq = res_norm**2\n        for _ in range(10):\n            U_new = U + alpha * delta_U\n            if np.any(U_new = 0):\n                alpha /= 2.0\n                continue\n            \n            new_res_norm_sq = np.linalg.norm(calculate_residuals(U_new))**2\n            if new_res_norm_sq  current_res_norm_sq:\n                U = U_new\n                break\n            alpha /= 2.0\n        else: # If backtracking fails, accept the last (smallest) step\n            U = U_new if 'U_new' in locals() else U\n\n    return U[0], U[N]\n\nsolve()\n```"
        },
        {
            "introduction": "没有经过验证的数值解是不可信的。本练习将向您展示最基本的验证技术之一：检查全局能量平衡。您将首先从第一性原理出发，推导共轭域的积分能量守恒定律，然后将其实现为一个量化诊断工具 $\\mathcal{R}$，用以评估数值仿真的准确性和一致性。",
            "id": "3943444",
            "problem": "一个共轭传热问题包含一个固体区域和一个流体区域，它们通过内界面交换热量，同时流体也可能通过质量的流入和流出与外部交换能量。从连续介质的能量守恒定律出发，并将雷诺输运定理应用于固液组合域的总内能，推导出整个共轭域上的积分能量平衡方程。推导必须从第一性原理开始：能量守恒和散度定理，并且必须明确论证在全局平衡中内部固-液界面项消失的原因。请提供稳态和瞬态形式，并明确定义所有边界交换的符号约定。\n\n然后，将推导出的积分能量平衡实现为一种定量诊断工具，以评估离散化和耦合误差。该诊断工具定义为一个全局残差，它比较总内能的时间变化率与通过外部边界和体积源的净能量交换。您的程序必须为下面列出的每个测试用例计算无量纲归一化残差\n$$\n\\mathcal{R} = \\frac{\\left| R \\right|}{\\left| \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} \\rho c_p T \\, \\mathrm{d}\\Omega \\right| + \\sum \\left| \\text{each individual external contribution on the right-hand side} \\right|},\n$$\n其中 $R$ 是由下式给出的带符号残差\n$$\nR = \\left( \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} \\rho c_p T \\, \\mathrm{d}\\Omega \\right) - \\left( \\text{net energy into the domain from boundaries and sources} \\right).\n$$\n对于体积为 $V_i$、密度为 $\\rho_i$、比热容为 $c_{p,i}$、前一时刻温度为 $T_i^{n}$、当前时刻温度为 $T_i^{n+1}$、时间步长为 $\\Delta t$ 的控制体积 $i$，其离散形式的左侧项为\n$$\n\\frac{1}{\\Delta t} \\sum_i \\rho_i c_{p,i} V_i \\left( T_i^{n+1} - T_i^{n} \\right).\n$$\n右侧项的贡献必须包括：\n- 指定热通量边界：对所有面片求和 $q_n A$，其中 $q_n$ 定义为流入域内为正。\n- 对流边界：对所有面片求和 $h A \\left( T_{\\infty} - T_{\\text{surf}} \\right)$，其中 $h$ 是传热系数，$T_{\\infty}$ 是环境温度，$T_{\\text{surf}}$ 是表面温度。\n- 体积源：对所有体积求和 $\\dot{q}_i V_i$。\n- 流体中质量流边界处的平流能量：对所有入口和出口求和 $- \\dot{m} c_{p,f} T_{\\text{bulk}}$，其中 $\\dot{m}$ 定义为相对于计算域指向外部时为正，$c_{p,f}$ 是流体比热容。\n\n程序必须为每个测试用例计算 $\\mathcal{R}$，并将结果输出为四舍五入到六位小数的十进制浮点数。最终输出中不需要物理单位，因为该诊断值是无量纲的。如果归一化分母计算结果为零，则使用备用值 $10^{-12}$ 以避免除以零。\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果（例如，$[\\mathcal{R}_1,\\mathcal{R}_2,\\mathcal{R}_3]$）。请实现以下测试套件，它涵盖了稳态和瞬态行为、平流主导的交换以及退化情况：\n\n- 测试用例 1（稳态平流共轭散热，具有微小不匹配的理想路径）：\n  - 时间步长 $\\Delta t = 1.0$。\n  - 固体控制体积：三个单元，其 $(\\rho, c_p, V, T^{n}, T^{n+1}, \\dot{q})$ 分别等于 $(2700.0, 900.0, 1.0\\times10^{-5}, 320.0, 320.0, 2.0\\times10^{6})$、$(2700.0, 900.0, 1.0\\times10^{-5}, 320.0, 320.0, 2.0\\times10^{6})$ 和 $(2700.0, 900.0, 1.0\\times10^{-5}, 320.0, 320.0, 0.0)$。\n  - 流体控制体积：三个单元，其 $(\\rho, c_p, V, T^{n}, T^{n+1}, \\dot{q})$ 在所有三个单元中均等于 $(1000.0, 4180.0, 5.0\\times10^{-6}, 300.0, 300.0, 0.0)$。\n  - 指定热通量边界：无。\n  - 对流边界：无。\n  - 质量流边界：一个入口，$\\dot{m} = -0.02$，$c_{p,f} = 4180.0$，$T_{\\text{bulk}} = 300.0$；一个出口，$\\dot{m} = +0.02$，$c_{p,f} = 4180.0$，$T_{\\text{bulk}} = 300.5$。\n\n- 测试用例 2（具有已知源和微小边界通量的固体中的瞬态升温，内部一致性检查）：\n  - 时间步长 $\\Delta t = 1.0$。\n  - 固体控制体积：两个单元，其 $(\\rho, c_p, V, T^{n}, T^{n+1}, \\dot{q})$ 分别等于 $(8900.0, 385.0, 2.0\\times10^{-5}, 300.0, 300.1, 6.5\\times10^{4})$ 和 $(8900.0, 385.0, 2.0\\times10^{-5}, 300.0, 300.1, 0.0)$。\n  - 流体控制体积：无。\n  - 指定热通量边界：一个面片，其 $q_n A = 0.05$。\n  - 对流边界：无。\n  - 质量流边界：无。\n\n- 测试用例 3（能量输入/输出平衡的纯流体稳态情况，边界条件一致性，抵消临界情况）：\n  - 时间步长 $\\Delta t = 1.0$。\n  - 固体控制体积：无。\n  - 流体控制体积：一个单元，其 $(\\rho, c_p, V, T^{n}, T^{n+1}, \\dot{q}) = (1000.0, 4180.0, 1.0\\times10^{-5}, 300.0, 300.0, 0.0)$。\n  - 指定热通量边界：无。\n  - 对流边界：无。\n  - 质量流边界：一个入口，$\\dot{m} = -0.1$，$c_{p,f} = 4180.0$，$T_{\\text{bulk}} = 300.0$；一个出口，$\\dot{m} = +0.1$，$c_{p,f} = 4180.0$，$T_{\\text{bulk}} = 300.0$。\n\n- 测试用例 4（无交换的退化稳态情况，检查分母备用值）：\n  - 时间步长 $\\Delta t = 1.0$。\n  - 固体控制体积：一个单元，其 $(\\rho, c_p, V, T^{n}, T^{n+1}, \\dot{q}) = (2000.0, 800.0, 1.0\\times10^{-6}, 300.0, 300.0, 0.0)$。\n  - 流体控制体积：无。\n  - 指定热通量边界：无。\n  - 对流边界：无。\n  - 质量流边界：无。\n\n您的程序必须使用推导出的积分平衡来实现残差，并输出一个列表 $[\\mathcal{R}_1,\\mathcal{R}_2,\\mathcal{R}_3,\\mathcal{R}_4]$，其中 $\\mathcal{R}_i$ 是测试用例 $i$ 的归一化残差，四舍五入到六位小数。",
            "solution": "该问题要求推导共轭传热域的积分能量平衡方程，并随后将其实现为一个数值诊断工具。对问题陈述的验证确认了其科学上是合理的、适定的，并包含了所有必要的信息。因此，我们可以着手解决。\n\n解决方案分为两部分：首先是积分能量平衡的理论推导，其次是基于此平衡的诊断残差的数值实现。\n\n### 第1部分：积分能量平衡的推导\n\n推导从连续介质的能量守恒原理开始，应用于整个共轭域 $\\Omega$，该域由一个固体区域 $\\Omega_s$ 和一个流体区域 $\\Omega_f$ 组成，因此 $\\Omega = \\Omega_s \\cup \\Omega_f$。\n\n**1. 能量守恒的微分形式**\n\n连续介质热力学第一定律的局部微分形式可以用比内能 $e$ 表示：\n$$\n\\frac{\\partial (\\rho e)}{\\partial t} + \\nabla \\cdot (\\rho e \\mathbf{v}) = -\\nabla \\cdot \\mathbf{q} + \\dot{q}_{vol} + \\Phi_{diss}\n$$\n其中 $\\rho$ 是密度，$\\mathbf{v}$ 是速度矢量，$\\mathbf{q}$ 是热通量矢量（例如，根据傅里叶定律，$\\mathbf{q} = -k \\nabla T$），$\\dot{q}_{vol}$ 是单位体积的体积热源，$\\Phi_{diss}$ 代表粘性耗散项，即由粘性应力所做的不可逆功的速率。问题陈述中对能量平衡的表述侧重于传热机制，隐含地忽略了粘性耗散，因此我们设 $\\Phi_{diss} = 0$。\n\n问题使用了基于温度 $T$ 和定压比热容 $c_p$ 的表述。对于固体和液体（不可压缩物质），定容比热容和定压比热容几乎相同，$c_v \\approx c_p = c$，内能的变化可以很好地近似为 $de \\approx c dT$。问题定义中的项 $\\rho c_p T$ 代表储存的热能密度。因此，我们将 $e$ 替换为 $c_p T$。\n\n能量方程变为：\n$$\n\\frac{\\partial (\\rho c_p T)}{\\partial t} + \\nabla \\cdot (\\rho c_p T \\mathbf{v}) = -\\nabla \\cdot \\mathbf{q} + \\dot{q}_{vol}\n$$\n这个方程在固体或流体区域内的任何一点都有效。在固体区域 $\\Omega_s$ 中，速度 $\\mathbf{v}$ 为零，因此平流项 $\\nabla \\cdot (\\rho c_p T \\mathbf{v})$ 消失。\n\n**2. 共轭域上的积分形式**\n\n为了获得全局能量平衡，我们在整个域 $\\Omega = \\Omega_s \\cup \\Omega_f$ 上对微分方程进行积分。\n$$\n\\int_{\\Omega} \\frac{\\partial (\\rho c_p T)}{\\partial t} dV + \\int_{\\Omega} \\nabla \\cdot (\\rho c_p T \\mathbf{v}) dV = -\\int_{\\Omega} \\nabla \\cdot \\mathbf{q} dV + \\int_{\\Omega} \\dot{q}_{vol} dV\n$$\n对于一个固定的（欧拉）控制体，第一项的积分和时间微分的顺序可以交换。然后，我们对散度项应用高斯散度定理，该定理指出 $\\int_V \\nabla \\cdot \\mathbf{F} dV = \\oint_{\\partial V} \\mathbf{F} \\cdot \\hat{n} dA$。这将散度的体积分转换为域边界 $\\partial\\Omega$ 上通量的面积分。\n$$\n\\frac{d}{dt} \\int_{\\Omega} \\rho c_p T dV + \\oint_{\\partial \\Omega} (\\rho c_p T \\mathbf{v}) \\cdot \\hat{n} dA = -\\oint_{\\partial \\Omega} \\mathbf{q} \\cdot \\hat{n} dA + \\int_{\\Omega} \\dot{q}_{vol} dV\n$$\n这个方程是任意控制体的积分能量平衡。\n\n**3. 内部界面项抵消的理由**\n\n现在我们通过分别考虑固体域和流体域然后将结果相加来应用此平衡。固体域的边界 $\\partial\\Omega_s$ 由其外部边界 $\\partial\\Omega_{s,ext}$ 和内部固-液界面 $\\Gamma_{sf}$ 组成。类似地，$\\partial\\Omega_f = \\partial\\Omega_{f,ext} \\cup \\Gamma_{sf}$。\n\n对于固体域 $\\Omega_s$（其中 $\\mathbf{v}=0$）：\n$$\n\\frac{d}{dt} \\int_{\\Omega_s} \\rho_s c_{p,s} T_s dV = -\\int_{\\partial\\Omega_{s,ext}} \\mathbf{q}_s \\cdot \\hat{n}_s dA - \\int_{\\Gamma_{sf}} \\mathbf{q}_s \\cdot \\hat{n}_s dA + \\int_{\\Omega_s} \\dot{q}_{vol,s} dV\n$$\n对于流体域 $\\Omega_f$：\n$$\n\\frac{d}{dt} \\int_{\\Omega_f} \\rho_f c_{p,f} T_f dV = -\\int_{\\partial\\Omega_{f,ext}} (\\rho_f c_{p,f} T_f \\mathbf{v}_f) \\cdot \\hat{n}_f dA - \\int_{\\Gamma_{sf}} (\\rho_f c_{p,f} T_f \\mathbf{v}_f) \\cdot \\hat{n}_f dA - \\int_{\\partial\\Omega_{f,ext}} \\mathbf{q}_f \\cdot \\hat{n}_f dA - \\int_{\\Gamma_{sf}} \\mathbf{q}_f \\cdot \\hat{n}_f dA + \\int_{\\Omega_f} \\dot{q}_{vol,f} dV\n$$\n将这两个方程相加，得到整个域 $\\Omega$ 的平衡方程。体积分直接合并。关键是分析内部界面 $\\Gamma_{sf}$ 上面积分的和。法向量定义为从各自的域向外指出，因此在界面上的任意一点，$\\hat{n}_s = -\\hat{n}_f$。\n\n界面项的和为：\n$$\nI_{\\Gamma_{sf}} = - \\int_{\\Gamma_{sf}} \\left[ \\mathbf{q}_s \\cdot \\hat{n}_s + \\mathbf{q}_f \\cdot \\hat{n}_f + (\\rho_f c_{p,f} T_f \\mathbf{v}_f) \\cdot \\hat{n}_f \\right] dA\n$$\n由于以下物理原因，这些项会抵消：\n-   **平流通量：** 在固-液界面上，粘性流体的无滑移条件要求流体速度 $\\mathbf{v}_f$ 为零。因此，界面处的平流能量通量项为零：$(\\rho_f c_{p,f} T_f \\mathbf{v}_f) \\cdot \\hat{n}_f = 0$。\n-   **传导通量：** 界面 $\\Gamma_{sf}$ 被假定为零厚度，因此没有储存或产生能量的能力。能量守恒要求离开固体表面的热通量必须等于进入流体表面的热通量。这表示为热通量矢量法向分量在界面上的连续性。用相对于域法线的通量表示：$(\\mathbf{q}_s \\cdot \\hat{n}_s) + (\\mathbf{q}_f \\cdot \\hat{n}_f) = 0$。这是因为在界面处离开固体的通量与进入流体的通量完全相同。\n\n因此，$I_{\\Gamma_{sf}}$ 的被积函数中的所有项均为零，内部界面上的积分消失，即 $I_{\\Gamma_{sf}}=0$。这明确地证明了内部界面项在全局平衡中的消失。\n\n**4. 最终的积分能量平衡**\n\n在将固体和流体方程相加并消除界面项之后，共轭域 $\\Omega$ 的全局积分能量平衡方程为：\n$$\n\\frac{d}{dt} \\int_{\\Omega} \\rho c_p T dV = -\\oint_{\\partial\\Omega_{ext}} \\mathbf{q} \\cdot \\hat{n} dA - \\oint_{\\partial\\Omega_{f,ext}} (\\rho c_p T \\mathbf{v}) \\cdot \\hat{n} dA + \\int_{\\Omega} \\dot{q}_{vol} dV\n$$\n其中 $\\partial\\Omega_{ext} = \\partial\\Omega_{s,ext} \\cup \\partial\\Omega_{f,ext}$ 是共轭域的总外部边界，平流项仅在该边界的流体部分 $\\partial\\Omega_{f,ext}$ 上非零。\n\n这个方程可以表示为：\n(储存能量的变化率) = (通过传导/对流的净热流入) + (通过平流的净能量流入) + (总体积热生成)\n\n-   **瞬态和稳态形式：** 上述方程是**瞬态形式**。**稳态形式**是通过将时间导数项设为零得到的，这意味着从所有源和边界进入域的净能量总和必须为零：\n$$\n0 = -\\oint_{\\partial\\Omega_{ext}} \\mathbf{q} \\cdot \\hat{n} dA - \\oint_{\\partial\\Omega_{f,ext}} (\\rho c_p T \\mathbf{v}) \\cdot \\hat{n} dA + \\int_{\\Omega} \\dot{q}_{vol} dV\n$$\n\n**5. 符号约定和边界项定义**\n\n右侧的各项代表流入域内的净能量。符号约定如下：\n-   **体积源 ($\\sum \\dot{q}_i V_i$)：** $\\dot{q}_i$ 对于热量生成为正，对能量平衡有正贡献。\n-   **指定热通量 ($\\sum q_n A$)：** 项 $-\\mathbf{q} \\cdot \\hat{n}$ 是流入域的热通量。问题将 $q_n$ 定义为流入域内为正的通量，因此 $q_n = -\\mathbf{q} \\cdot \\hat{n}$。总能量输入为 $\\int q_n dA$，近似为 $\\sum q_n A$。\n-   **对流边界 ($\\sum h A (T_\\infty - T_{\\text{surf}})$)：** 流入域的通量由牛顿冷却定律给出，$h(T_\\infty - T_{\\text{surf}})$。当环境温度 $T_\\infty$ 大于表面温度 $T_{\\text{surf}}$ 时，此项为正，与能量进入域内一致。\n-   **平流能量 ($\\sum - \\dot{m} c_{p,f} T_{\\text{bulk}}$)：** 流入域的净平流功率为 $-\\oint (\\rho c_p T \\mathbf{v}) \\cdot \\hat{n} dA$。质量流率 $\\dot{m}$ 定义为流出时为正，$\\dot{m} = \\int \\rho (\\mathbf{v} \\cdot \\hat{n}) dA$。假设在入口/出口面片上性质均匀，平流能量输运为 $\\dot{m} c_p T_{bulk}$。与该积分对应的项是 $-\\sum \\dot{m} c_{p,f} T_{\\text{bulk}}$。对于入口，$\\dot{m}  0$，因此该项为正（能量进入）。对于出口，$\\dot{m} > 0$，该项为负（能量离开）。这是自洽的。\n\n### 第2部分：数值实现\n\n推导出的积分平衡构成了诊断残差 $R$ 的基础。该残差检查数值计算的储存能量变化是否与计算的与周围环境的净能量交换相平衡。\n$$\nR = \\left( \\frac{d}{dt} \\int_{\\Omega} \\rho c_p T dV \\right) - \\left( \\text{Net Energy Inflow} \\right)\n$$\n使用提供的离散形式：\n-   左侧项 (LHS)：$E_{stored\\_rate} = \\frac{1}{\\Delta t} \\sum_i \\rho_i c_{p,i} V_i (T_i^{n+1} - T_i^n)$\n-   右侧项 (RHS)：$E_{inflow} = \\sum (\\dot{q}_i V_i) + \\sum (q_n A) + \\sum (h A (T_\\infty-T_{surf})) + \\sum (-\\dot{m} c_p T_{bulk})$\n\n带符号残差为 $R = E_{stored\\_rate} - E_{inflow}$。归一化残差 $\\mathcal{R}$ 按规定计算，使用所有独立贡献项的绝对值之和作为归一化分母，以确保对项抵消的鲁棒性。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_residual(case):\n    \"\"\"\n    Calculates the normalized energy residual for a given test case.\n    \n    The residual R is defined as:\n    R = (rate of change of stored energy) - (net energy rate into the domain)\n    \n    The normalized residual is |R| / Denominator, where the denominator is the\n    sum of absolute values of all individual energy rate terms.\n    \"\"\"\n    \n    # Unpack case data\n    delta_t = case['delta_t']\n    solid_vols = case.get('solid_vols', [])\n    fluid_vols = case.get('fluid_vols', [])\n    flux_boundaries = case.get('flux_boundaries', [])\n    conv_boundaries = case.get('conv_boundaries', [])\n    mass_flow_boundaries = case.get('mass_flow_boundaries', [])\n\n    all_vols = solid_vols + fluid_vols\n    \n    # 1. Calculate the rate of change of stored energy (LHS)\n    transient_terms = []\n    for vol in all_vols:\n        rho, cp, V, T_n, T_np1, _ = vol\n        term = rho * cp * V * (T_np1 - T_n)\n        transient_terms.append(term)\n    \n    lhs = sum(transient_terms) / delta_t\n\n    # 2. Calculate the net energy rate into the domain (RHS)\n    # and collect absolute values of individual terms for normalization.\n    \n    denominator_terms = [abs(lhs)]\n    \n    # Volumetric sources\n    source_terms = []\n    for vol in all_vols:\n        _, _, V, _, _, q_dot = vol\n        term = q_dot * V\n        source_terms.append(term)\n        denominator_terms.append(abs(term))\n    q_sources_total = sum(source_terms)\n\n    # Prescribed heat flux boundaries\n    flux_terms = []\n    for patch in flux_boundaries:\n        term = patch['qn_A']\n        flux_terms.append(term)\n        denominator_terms.append(abs(term))\n    q_flux_total = sum(flux_terms)\n    \n    # Convective boundaries\n    conv_terms = []\n    for patch in conv_boundaries:\n        term = patch['h'] * patch['A'] * (patch['T_inf'] - patch['T_surf'])\n        conv_terms.append(term)\n        denominator_terms.append(abs(term))\n    q_conv_total = sum(conv_terms)\n\n    # Advective energy at mass-flow boundaries\n    adv_terms = []\n    for patch in mass_flow_boundaries:\n        term = -1.0 * patch['m_dot'] * patch['cp_f'] * patch['T_bulk']\n        adv_terms.append(term)\n        denominator_terms.append(abs(term))\n    q_adv_total = sum(adv_terms)\n    \n    rhs = q_sources_total + q_flux_total + q_conv_total + q_adv_total\n    \n    # 3. Calculate the signed residual\n    residual = lhs - rhs\n    \n    # 4. Calculate normalization denominator\n    denominator = sum(denominator_terms)\n    \n    if np.isclose(denominator, 0.0):\n        denominator = 1.0e-12\n\n    # 5. Calculate the dimensionless normalized residual\n    norm_residual = abs(residual) / denominator\n    \n    return norm_residual\n\ndef solve():\n    \"\"\"\n    Defines test cases, computes the normalized residual for each,\n    and prints the results in the required format.\n    \"\"\"\n    \n    # Format for cell data: (rho, cp, V, T_n, T_np1, q_dot)\n    \n    test_cases = [\n        # Test Case 1: steady conjugate removal by advection\n        {\n            \"delta_t\": 1.0,\n            \"solid_vols\": [\n                (2700.0, 900.0, 1.0e-5, 320.0, 320.0, 2.0e6),\n                (2700.0, 900.0, 1.0e-5, 320.0, 320.0, 2.0e6),\n                (2700.0, 900.0, 1.0e-5, 320.0, 320.0, 0.0),\n            ],\n            \"fluid_vols\": [\n                (1000.0, 4180.0, 5.0e-6, 300.0, 300.0, 0.0),\n                (1000.0, 4180.0, 5.0e-6, 300.0, 300.0, 0.0),\n                (1000.0, 4180.0, 5.0e-6, 300.0, 300.0, 0.0),\n            ],\n            \"mass_flow_boundaries\": [\n                {'m_dot': -0.02, 'cp_f': 4180.0, 'T_bulk': 300.0},\n                {'m_dot': +0.02, 'cp_f': 4180.0, 'T_bulk': 300.5},\n            ]\n        },\n        # Test Case 2: transient heat-up in a solid\n        {\n            \"delta_t\": 1.0,\n            \"solid_vols\": [\n                (8900.0, 385.0, 2.0e-5, 300.0, 300.1, 6.5e4),\n                (8900.0, 385.0, 2.0e-5, 300.0, 300.1, 0.0),\n            ],\n            \"flux_boundaries\": [\n                {'qn_A': 0.05}\n            ]\n        },\n        # Test Case 3: steady fluid-only with balanced in/out energy\n        {\n            \"delta_t\": 1.0,\n            \"fluid_vols\": [\n                (1000.0, 4180.0, 1.0e-5, 300.0, 300.0, 0.0)\n            ],\n            \"mass_flow_boundaries\": [\n                {'m_dot': -0.1, 'cp_f': 4180.0, 'T_bulk': 300.0},\n                {'m_dot': +0.1, 'cp_f': 4180.0, 'T_bulk': 300.0},\n            ]\n        },\n        # Test Case 4: degenerate steady case with no exchanges\n        {\n            \"delta_t\": 1.0,\n            \"solid_vols\": [\n                (2000.0, 800.0, 1.0e-6, 300.0, 300.0, 0.0)\n            ]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        r = calculate_residual(case)\n        results.append(f\"{r:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}