{
    "hands_on_practices": [
        {
            "introduction": "在计算航空声学（CAA）中，我们使用离散的数值格式来近似连续的波动方程。这个过程会引入误差，影响声波在计算域中的传播。本练习将通过傅里叶分析，引导您推导一个标准有限差分格式的修正波数，这是量化数值色散（即不同频率的波以不同速度传播）的关键步骤。理解并能够执行这种分析，是评估和设计高保真度数值方法的基石 。",
            "id": "3940989",
            "problem": "在计算航空声学（CAA）中，声波的精确传播是通过声学比拟（如 Lighthill 比拟）预测湍流产生的声响的基础。考虑均匀、静止介质中的一维小振幅声学，其中声压扰动 $p'(x,t)$ 满足线性波方程。该方程是在等熵假设下从线性化的可压缩欧拉方程推导出来的，\n$$\n\\frac{\\partial^{2} p'}{\\partial t^{2}} = c^{2} \\frac{\\partial^{2} p'}{\\partial x^{2}},\n$$\n其中 $c$ 为声速。在间距为 $\\Delta x$ 的均匀网格上，令空间二阶导数由标准的三点二阶中心差分格式来近似，\n$$\n\\left.\\frac{\\partial^{2} p'}{\\partial x^{2}}\\right|_{x_i} \\approx \\frac{p'(x_{i+1},t) - 2\\,p'(x_{i},t) + p'(x_{i-1},t)}{\\Delta x^{2}},\n$$\n并采用时间上保持连续的半离散格式。对于一个平面声波\n$$\np'(x,t) = \\cos(k x - \\omega t),\n$$\n其中波数 $k$ 和角频率 $\\omega$ 均为实数，假设离散傅里叶模式为 $p'_i(t) = \\Re\\{\\hat{p}\\,\\exp(i(i\\,\\theta - \\omega t))\\}$，其中 $x_i = i\\,\\Delta x$，$\\theta = k\\,\\Delta x$，$\\hat{p}$ 是一个复振幅。从上述控制方程和差分格式出发，使用傅里叶分析，推导由半离散色散关系 $\\omega^{2} = c^{2} \\left(k^{*}\\right)^{2}$ 定义的修正波数 $k^{*}$，并量化该平面波的数值相速度误差和振幅（耗散）误差。明确地用 $k$ 和 $\\Delta x$ 表示相速度误差，并确定该半离散格式是否引入任何振幅误差。\n\n请以 $k$ 和 $\\Delta x$ 表示的 $k^{*}$ 的封闭形式解析表达式作为最终结果。不需要进行数值计算，也不需要四舍五入。最终表达式中不要包含单位。",
            "solution": "该问题已经过验证，并被认为是有效的，因为它具有科学依据，问题设定良好且客观。它提出了一个波传播数值方法分析中的标准问题，这是计算航空声学的核心课题。所有必要信息均已提供，问题没有矛盾或含糊之处。\n\n我们从一维线性波方程的半离散近似开始。控制偏微分方程为\n$$\n\\frac{\\partial^{2} p'}{\\partial t^{2}} = c^{2} \\frac{\\partial^{2} p'}{\\partial x^{2}}\n$$\n其中 $p'(x,t)$ 是声压扰动，$c$ 是恒定的声速。\n空间域在均匀网格上离散化，网格点为 $x_i = i\\,\\Delta x$，其中 $i$ 是整数索引，$\\Delta x$ 是网格间距。在网格点 $x_i$ 处的空间二阶导数由二阶三点中心差分格式近似：\n$$\n\\left.\\frac{\\partial^{2} p'}{\\partial x^{2}}\\right|_{x_i} \\approx \\frac{p'(x_{i+1},t) - 2\\,p'(x_{i},t) + p'(x_{i-1},t)}{\\Delta x^{2}}\n$$\n将此近似代入波动方程，得到每个网格点上压力扰动 $p'_i(t) \\equiv p'(x_i, t)$ 的半离散常微分方程：\n$$\n\\frac{d^{2} p'_i}{d t^{2}} = \\frac{c^{2}}{\\Delta x^{2}} \\left( p'_{i+1} - 2\\,p'_i + p'_{i-1} \\right)\n$$\n为了分析此数值格式的性质，我们通过代入单个傅里叶模式解来进行傅里葉分析。问题中给出的离散傅里叶模式形式为 $p'_i(t) = \\Re\\{\\hat{p}\\,\\exp(i(i\\,\\theta - \\omega t))\\}$，其中 $\\theta = k\\,\\Delta x$。对于线性方程，我们可以使用复数形式进行处理，最后取实部。设试探解为：\n$$\np'_j(t) = \\hat{p} \\exp\\left(i(j k \\Delta x - \\omega t)\\right)\n$$\n对于任意网格点索引 $j$。这里，$k$ 是波数，$\\omega$ 是角频率。\n则相邻点的值为：\n$$\np'_{i+1}(t) = \\hat{p} \\exp\\left(i((i+1)k \\Delta x - \\omega t)\\right) = p'_i(t) \\exp(i k \\Delta x)\n$$\n$$\np'_{i-1}(t) = \\hat{p} \\exp\\left(i((i-1)k \\Delta x - \\omega t)\\right) = p'_i(t) \\exp(-i k \\Delta x)\n$$\n左侧（LHS）的时间导数为：\n$$\n\\frac{d^{2} p'_i}{d t^{2}} = \\frac{d^{2}}{d t^{2}} \\left[ \\hat{p} \\exp\\left(i(i k \\Delta x - \\omega t)\\right) \\right] = (-i\\omega)^{2} p'_i(t) = -\\omega^{2} p'_i(t)\n$$\n右侧（RHS）变为：\n$$\n\\text{RHS} = \\frac{c^{2}}{\\Delta x^{2}} \\left( p'_i(t)\\exp(i k \\Delta x) - 2\\,p'_i(t) + p'_i(t)\\exp(-i k \\Delta x) \\right)\n$$\n$$\n\\text{RHS} = \\frac{c^{2} p'_i(t)}{\\Delta x^{2}} \\left( \\exp(i k \\Delta x) + \\exp(-i k \\Delta x) - 2 \\right)\n$$\n使用欧拉公式 $\\exp(iz) + \\exp(-iz) = 2\\cos(z)$，表达式简化为：\n$$\n\\text{RHS} = \\frac{c^{2} p'_i(t)}{\\Delta x^{2}} \\left( 2\\cos(k \\Delta x) - 2 \\right) = \\frac{2c^{2} p'_i(t)}{\\Delta x^{2}} \\left( \\cos(k \\Delta x) - 1 \\right)\n$$\n利用三角半角恒等式 $1 - \\cos(z) = 2\\sin^{2}(z/2)$，我们得到：\n$$\n\\text{RHS} = \\frac{2c^{2} p'_i(t)}{\\Delta x^{2}} \\left( -2\\sin^{2}\\left(\\frac{k \\Delta x}{2}\\right) \\right) = -\\frac{4c^{2} p'_i(t)}{\\Delta x^{2}} \\sin^{2}\\left(\\frac{k \\Delta x}{2}\\right)\n$$\n令LHS和RHS相等，并除以 $p'_i(t)$（非零），我们得到该半离散格式的数值色散关系：\n$$\n-\\omega^{2} = -\\frac{4c^{2}}{\\Delta x^{2}} \\sin^{2}\\left(\\frac{k \\Delta x}{2}\\right)\n$$\n$$\n\\omega^{2} = \\frac{4c^{2}}{\\Delta x^{2}} \\sin^{2}\\left(\\frac{k \\Delta x}{2}\\right)\n$$\n问题定义了修正波数 $k^{*}$，使得数值色散关系模仿精确色散关系 $\\omega^{2} = c^{2} k^{2}$ 的形式，但用 $k^{*}$ 替换 $k$：\n$$\n\\omega^{2} = c^{2} (k^{*})^{2}\n$$\n通过将此定义与我们推导出的数值色散关系进行比较，我们可以确定 $(k^{*})^{2}$：\n$$\nc^{2} (k^{*})^{2} = \\frac{4c^{2}}{\\Delta x^{2}} \\sin^{2}\\left(\\frac{k \\Delta x}{2}\\right) \\implies (k^{*})^{2} = \\frac{4}{\\Delta x^{2}} \\sin^{2}\\left(\\frac{k \\Delta x}{2}\\right)\n$$\n取主平方根（假设 $\\Delta x > 0$ 且波在空间上是可分辨的，即 $0 \\le k \\Delta x \\le \\pi$，这确保了 $\\sin(k\\Delta x/2) \\ge 0$），我们得到修正波数 $k^{*}$ 的表达式：\n$$\nk^{*} = \\frac{2}{\\Delta x} \\sin\\left(\\frac{k \\Delta x}{2}\\right)\n$$\n\n现在我们量化数值误差。\n振幅（耗散）误差：如果修正波数 $k^{*}$ 具有非零虚部，波分量的振幅会发生变化。在我们的情况中，对于任意实波数 $k$ 和实数网格间距 $\\Delta x$，正弦函数产生一个实数值。因此，$k^{*}$ 是纯实数。这意味着修正波数的虚部为零，$\\Im(k^{*}) = 0$。因此，波的振幅没有被人为放大或衰减。使用中心差分格式的半离散格式是纯色散的，不引入振幅（耗散）误差。\n\n相速度误差：精确的物理系统是非色散的，对于所有波数，相速度为 $c_{ph,exact} = \\omega/k = c$。数值相速度 $c_{ph,num}$ 由 $c_{ph,num} = \\omega/k$ 给出。使用数值色散关系 $\\omega = c k^{*}$，我们有：\n$$\nc_{ph,num} = \\frac{\\omega}{k} = \\frac{c k^{*}}{k} = \\frac{c}{k} \\left( \\frac{2}{\\Delta x} \\sin\\left(\\frac{k \\Delta x}{2}\\right) \\right)\n$$\n重新整理此表达式，得到以 $k$ 和 $\\Delta x$ 表示的相速度误差，通常表示为与精确声速 $c$ 的比值：\n$$\n\\frac{c_{ph,num}}{c} = \\frac{2}{k \\Delta x} \\sin\\left(\\frac{k \\Delta x}{2}\\right) = \\frac{\\sin\\left(\\frac{k \\Delta x}{2}\\right)}{\\frac{k \\Delta x}{2}}\n$$\n这个比率是 sinc 函数，$\\text{sinc}(k\\Delta x/2)$。由于对于任何参数 $z > 0$，$\\text{sinc}(z)  1$，所以数值相速度总是小于精确声速 $c$（除了在 $k\\Delta x \\to 0$ 的极限情况下）。这是一种滞后相误差。该误差取决于无量纲群 $k\\Delta x$，这表明该格式是色散的：不同波数的波以不同速度传播，导致波包在传播过程中发生畸变。\n\n问题要求以 $k^{*}$ 的封闭形式解析表达式作为最终结果。",
            "answer": "$$\n\\boxed{\\frac{2}{\\Delta x} \\sin\\left(\\frac{k \\Delta x}{2}\\right)}\n$$"
        },
        {
            "introduction": "除了空间离散引入的色散误差，时间积分方案同样会带来误差，特别是可能导致波幅衰减的数值耗散。在长距离声传播预测中，这种累积的耗散误差会严重影响结果的准确性。本练习将数值误差分析与实际工程需求相结合，要求您确定一个特定的高阶时间积分方案（四阶龙格－库塔法）为满足给定的声压级（SPL）误差限值，所需的最小波长内点数（PPW） 。这项实践有助于您将抽象的误差理论转化为具体的计算网格设计准则。",
            "id": "3940980",
            "problem": "考虑窄带平面声波在由线性化欧拉方程描述的均匀、无粘、等熵介质中的一维传播。设波的角频率为 $\\omega$，波数为 $k$，声速为 $c$，因此 $\\omega = c k$。假设使用傅里叶伪谱空间离散化（因此对于可分辨的波数，空间微分是精确的）和经典的四阶龙格-库塔 (RK4) 时间积分进行数值模拟，并采用固定的 Courant–Friedrichs–Lewy (CFL) 数 $\\lambda = c \\Delta t / \\Delta x = 0.5$。定义每波长点数 (PPW) 为 $N_{\\lambda} = \\lambda_{w}/\\Delta x$，其中 $\\lambda_{w} = 2\\pi/k$ 是物理波长。\n\n假设唯一的幅度误差来源是时间积分，并且声压级 (SPL) 误差仅由数值传播波与精确平面波在传播 50 个波长距离后的幅度比来量化。要求 SPL 误差的量值小于 1 分贝，即传播后的幅度比 $A$ 满足 $20 \\log_{10}(A)$ 的绝对值小于 1 分贝。\n\n在这些假设下，确定为确保在 50 个波长的距离上满足 SPL 误差准则所需的最小 PPW 值 $N_{\\lambda,\\min}$。请将您的最终答案表示为单个实数。将您的答案四舍五入到三位有效数字。",
            "solution": "该问题要求确定一维声波数值模拟所需的最小每波长点数 ($N_{\\lambda}$)，以使声压级 (SPL) 误差低于某一阈值。该模拟使用傅里叶伪谱法进行空间离散化，并使用经典的四阶龙格-库塔 (RK4) 方案进行时间积分。\n\n在线性化、无粘、等熵介质中，单个平面波分量的传播由平流方程控制：\n$$\n\\frac{\\partial u}{\\partial t} + c \\frac{\\partial u}{\\partial x} = 0\n$$\n其中 $u$ 是一个扰动量（如压力或速度），$c$ 是声速。平面波解的形式为 $u(x,t) = \\hat{u} \\exp(i(kx - \\omega t))$，其中 $\\omega=ck$。\n\n问题陈述，空间离散化采用傅里叶伪谱法，对于可分辨的波数，该方法被认为是精确的。这意味着对于单个傅里叶模式 $\\exp(ikx)$，空间导数算子被精确表示。傅里叶系数 $\\hat{u}(t)$ 的时间演化的半离散化方程为：\n$$\n\\frac{d\\hat{u}}{dt} = -ick\\hat{u} = -i\\omega\\hat{u}\n$$\n这是一个形式为 $\\frac{dy}{dt} = \\Lambda y$ 的常微分方程，其中 $y(t) = \\hat{u}(t)$ 且 $\\Lambda = -i\\omega$。\n\n该常微分方程使用 RK4 方法进行数值求解。一个时间步长 $\\Delta t$ 后的数值解通过一个放大因子 $G$ 与前一步的解相关联：\n$$\n\\hat{u}^{n+1} = G(\\Lambda \\Delta t) \\hat{u}^n\n$$\nRK4 方案的放大因子由指数函数的泰勒级数的前五项给出：\n$$\nG(z) = 1 + z + \\frac{z^2}{2!} + \\frac{z^3}{3!} + \\frac{z^4}{4!}\n$$\n在我们的例子中，参数 $z$ 是 $z = \\Lambda \\Delta t = -i\\omega \\Delta t$。我们定义 $\\alpha = \\omega \\Delta t$，所以 $z = -i\\alpha$。\n\n数值波的幅度在每个时间步长乘以放大因子的模 $|G(-i\\alpha)|$。我们需要用指定的参数来表示 $\\alpha$：CFL 数 $\\lambda = c \\Delta t / \\Delta x$ 和每波长点数 $N_{\\lambda} = \\lambda_w / \\Delta x$，其中 $\\lambda_w = 2\\pi/k$ 是波长。\n\n根据定义，我们可以写出：\n$\\omega = ck = c \\frac{2\\pi}{\\lambda_w}$\n$\\Delta t = \\frac{\\lambda \\Delta x}{c} = \\frac{\\lambda}{c} \\frac{\\lambda_w}{N_\\lambda}$\n\n因此，无量纲频率 $\\alpha$ 是：\n$$\n\\alpha = \\omega \\Delta t = \\left(c \\frac{2\\pi}{\\lambda_w}\\right) \\left(\\frac{\\lambda}{c} \\frac{\\lambda_w}{N_\\lambda}\\right) = \\frac{2\\pi\\lambda}{N_\\lambda}\n$$\n问题指定 $\\lambda = 0.5$，所以 $\\alpha = \\pi/N_\\lambda$。\n\n幅度误差完全由时间积分引起，因此我们分析 $G(-i\\alpha)$ 的模。\n$$\nG(-i\\alpha) = 1 - i\\alpha - \\frac{\\alpha^2}{2} + i\\frac{\\alpha^3}{6} + \\frac{\\alpha^4}{24} = \\left(1 - \\frac{\\alpha^2}{2} + \\frac{\\alpha^4}{24}\\right) - i\\left(\\alpha - \\frac{\\alpha^3}{6}\\right)\n$$\n模的平方是：\n$$\n|G(-i\\alpha)|^2 = \\left(1 - \\frac{\\alpha^2}{2} + \\frac{\\alpha^4}{24}\\right)^2 + \\left(\\alpha - \\frac{\\alpha^3}{6}\\right)^2\n$$\n展开并合并到 $O(\\alpha^8)$ 的项：\n$$\n|G(-i\\alpha)|^2 = \\left(1 - \\alpha^2 + \\frac{\\alpha^4}{3} - \\frac{\\alpha^6}{24} + \\dots\\right) + \\left(\\alpha^2 - \\frac{\\alpha^4}{3} + \\frac{\\alpha^6}{36}\\right)\n= 1 - \\left(\\frac{1}{24} - \\frac{1}{36}\\right)\\alpha^6 + O(\\alpha^8) = 1 - \\frac{\\alpha^6}{72} + O(\\alpha^8)\n$$\nRK4 方案是耗散的，因为对于 $\\alpha \\neq 0$，有 $|G(-i\\alpha)|  1$。对于小的 $\\alpha$，模近似为：\n$$\n|G(-i\\alpha)| \\approx \\sqrt{1 - \\frac{\\alpha^6}{72}} \\approx 1 - \\frac{\\alpha^6}{144}\n$$\n波传播的距离为 $L = 50 \\lambda_w$。总传播时间为 $T_{prop} = L/c = 50\\lambda_w/c$。时间步数 $N_{steps}$ 为：\n$$\nN_{steps} = \\frac{T_{prop}}{\\Delta t} = \\frac{50\\lambda_w/c}{\\lambda \\Delta x / c} = \\frac{50\\lambda_w}{\\lambda (\\lambda_w / N_\\lambda)} = \\frac{50 N_\\lambda}{\\lambda}\n$$\n由于 $\\lambda = 0.5$，我们有 $N_{steps} = 100 N_\\lambda$。\n\n经过 $N_{steps}$ 步后的总幅度比 $A$ 是每步的放大因子乘以步数的幂：\n$$\nA = |G(-i\\alpha)|^{N_{steps}}\n$$\nSPL 误差要求为 $|20 \\log_{10}(A)|  1$。由于该方案是耗散的，$A  1$ 且 $\\log_{10}(A)  0$。约束简化为：\n$$\n-1  20 \\log_{10}(A) \\implies -\\frac{1}{20}  \\log_{10}(A) \\implies A > 10^{-1/20}\n$$\n现在我们可以建立不等式来找到最小的 $N_\\lambda$：\n$$\n|G(-i\\alpha)|^{N_{steps}} > 10^{-1/20}\n$$\n两边取自然对数：\n$$\nN_{steps} \\ln(|G(-i\\alpha)|) > -\\frac{1}{20}\\ln(10)\n$$\n对于小的 $\\alpha$，使用近似 $\\ln(|G|) \\approx \\ln(1 - \\frac{\\alpha^6}{144}) \\approx -\\frac{\\alpha^6}{144}$：\n$$\n(100 N_\\lambda) \\left(-\\frac{\\alpha^6}{144}\\right) > -\\frac{\\ln(10)}{20}\n$$\n乘以 -1 会反转不等号：\n$$\n\\frac{100 N_\\lambda \\alpha^6}{144}  \\frac{\\ln(10)}{20}\n$$\n代入 $\\alpha = \\pi/N_\\lambda$：\n$$\n\\frac{100 N_\\lambda}{144} \\left(\\frac{\\pi}{N_\\lambda}\\right)^6  \\frac{\\ln(10)}{20} \\implies \\frac{100 \\pi^6}{144 N_\\lambda^5}  \\frac{\\ln(10)}{20}\n$$\n现在，我们求解 $N_\\lambda$：\n$$\nN_\\lambda^5 > \\frac{100 \\pi^6}{144} \\cdot \\frac{20}{\\ln(10)} = \\frac{2000 \\pi^6}{144 \\ln(10)} = \\frac{125 \\pi^6}{9 \\ln(10)}\n$$\n$$\nN_{\\lambda} > \\left(\\frac{125 \\pi^6}{9 \\ln(10)}\\right)^{1/5}\n$$\n我们计算数值：\n$$\n\\pi \\approx 3.14159, \\quad \\ln(10) \\approx 2.30259\n$$\n$$\n\\pi^6 \\approx 961.389\n$$\n$$\nN_{\\lambda} > \\left(\\frac{125 \\times 961.389}{9 \\times 2.30259}\\right)^{1/5} \\approx \\left(\\frac{120173.6}{20.7233}\\right)^{1/5} \\approx (5799.3)^{1/5}\n$$\n$$\nN_{\\lambda} > 5.65839...\n$$\n所需的最小每波长点数必须大于此值。四舍五入到三位有效数字，我们得到 $N_{\\lambda, \\min} = 5.66$。",
            "answer": "$$\\boxed{5.66}$$"
        },
        {
            "introduction": "Ffowcs Williams-Hawkings (FW-H) 声学比拟是预测复杂流动噪声的强大工具，它允许我们从流场数据中提取远场声学信息。然而，成功应用FW-H方法需要一个精密的后处理流程，特别是要从原始数据中滤除不产生声辐射的流体动力学伪噪声，并精确计算信号传播到观察者所需的延迟时间（即推迟时间）。本练习模拟了一个完整的后处理流程，指导您设计并实现一个管道，用于处理合成的大涡模拟（LES）数据，从而计算远场声谱 。这项实践对于任何希望将声学比拟应用于实际CFD模拟的研究人员来说，都是一次宝贵的综合训练。",
            "id": "3940991",
            "problem": "需要设计一个福克斯·威廉姆斯–霍金斯 (Ffowcs Williams–Hawkings, FW-H) 声学比拟后处理流程，用于从包含声学和流体动力学贡献的合成大涡模拟 (Large Eddy Simulation, LES) 表面数据中计算远场单边功率谱密度。该流程必须包含使用对流对齐的流体动力学压力显式滤波，并与 FW-H 面积分固有的延迟时间求值进行同步。计算任务是为每个指定的测试案例，以纯数学术语的形式，实现以下物理上一致的步骤：\n\n1. 定义一个位于 $x$-$y$ 平面、以原点为中心、半径为 $a$ 的圆形可渗透 FW-H 控制面。将该表面离散化为按角度均匀分布的 $N_s$ 个点，其位置为 $\\mathbf{y}_i = \\left(a \\cos \\theta_i, a \\sin \\theta_i, 0\\right)$，外法线为 $\\mathbf{n}_i = \\left(\\cos \\theta_i, \\sin \\theta_i, 0\\right)$，其中 $\\theta_i = 2\\pi i/N_s$，对于 $i = 0,1,\\ldots,N_s-1$。\n\n2. 为每个表面点生成合成的 LES 表面压力信号 $p_s(\\mathbf{y}_i,t)$。令声学平面波部分以声速 $c_0$ 沿 $+x$ 方向传播，流体动力学对流部分以对流速度 $U$（通常 $U \\ll c_0$）沿 $+x$ 方向传播。定义投影坐标 $s(\\mathbf{y}_i) = \\hat{\\mathbf{e}}_x \\cdot \\mathbf{y}_i = a \\cos \\theta_i$。每个点的信号为\n$$\np_s(\\mathbf{y}_i,t) = A_a \\cos\\left(2\\pi f_a \\left(t - \\frac{s(\\mathbf{y}_i)}{c_0}\\right)\\right) + A_h \\cos\\left(2\\pi f_h \\left(t - \\frac{s(\\mathbf{y}_i)}{U}\\right)\\right) + \\eta_i(t),\n$$\n其中 $A_a$ 是声学振幅（单位：帕斯卡），$f_a$ 是声学频率（单位：赫兹），$A_h$ 是流体动力学振幅（单位：帕斯卡），$f_h$ 是流体动力学频率（单位：赫兹），$\\eta_i(t)$ 是零均值加性随机噪声，其振幅以帕斯卡为单位指定。采样率为 $f_s$（单位：赫兹），持续时间为 $T$（单位：秒）。声速为 $c_0$（单位：米/秒）。\n\n3. 通过表面上的对流对齐构建流体动力学压力估计，并将其减去以滤除流体动力学内容。定义对流对齐信号\n$$\nq_i(t) = p_s(\\mathbf{y}_i,\\, t + s(\\mathbf{y}_i)/U),\n$$\n和表面平均对齐信号\n$$\n\\overline{q}(t) = \\frac{1}{N_s} \\sum_{i=0}^{N_s-1} q_i(t).\n$$\n然后通过解除对齐来定义每个点的流体动力学估计\n$$\n\\widehat{p}_h(\\mathbf{y}_i,t) = \\overline{q}\\left(t - \\frac{s(\\mathbf{y}_i)}{U}\\right),\n$$\n并构建滤波后的压力\n$$\np_f(\\mathbf{y}_i,t) = p_s(\\mathbf{y}_i,t) - \\widehat{p}_h(\\mathbf{y}_i,t).\n$$\n所有时间平移都通过时间上的线性插值进行计算。该过程旨在移除以接近速度 $U$ 对流的分量，同时保留以接近 $c_0$ 传播的分量。\n\n4. 通过延迟时间同步，计算固定观察者位置 $\\mathbf{x}_o$ 处的 FW-H 远场代理压力。对于每个表面点 $\\mathbf{y}_i$，计算声学延迟时间\n$$\nt_r^{(i)}(t) = t - \\frac{R_i}{c_0}, \\quad R_i = \\|\\mathbf{x}_o - \\mathbf{y}_i\\|.\n$$\n使用一个离散化的、保持压力单位的无量纲加权和来近似仅考虑载荷的多孔 FW-H 贡献，使用\n$$\np'(\\mathbf{x}_o,t) \\approx \\sum_{i=0}^{N_s-1} w_i \\, p_f\\left(\\mathbf{y}_i,\\, t_r^{(i)}(t)\\right),\n$$\n其中\n$$\nw_i = \\frac{R_{\\mathrm{ref}}}{4\\pi R_i N_s},\n$$\n$R_{\\mathrm{ref}}$ 是一个固定参考长度，设为 $1\\,\\mathrm{m}$ 以保持求和项无量纲。延迟时间同步是通过在 $t_r^{(i)}(t)$ 处对 $p_f(\\mathbf{y}_i,t)$ 进行线性插值实现的。\n\n5. 使用汉宁窗 $w(t)$ 和快速傅里叶变换 (FFT) 计算 $p'(\\mathbf{x}_o,t)$ 的单边功率谱密度 (PSD) $S_{p'p'}(f)$。如果 $x[n]$ 是采样信号，$w[n]$ 是窗函数，$X[k]$ 是 $w[n] x[n]$ 的离散傅里叶变换，$f_s$ 是采样频率，$N$ 是样本数，且 $U_w = \\frac{1}{N}\\sum_{n=0}^{N-1} w[n]^2$ 是窗函数功率，则单边 PSD 定义为频率 $f_k = k f_s/N$ 的函数：\n$$\nS_{p'p'}(f_k) = \\begin{cases}\n\\frac{1}{f_s N U_w} |X[0]|^2,  k = 0 \\\\[6pt]\n\\frac{2}{f_s N U_w} |X[k]|^2,  1 \\le k \\le \\frac{N}{2}-1 \\\\[6pt]\n\\frac{1}{f_s N U_w} |X[N/2]|^2,  k = \\frac{N}{2} \\text{ 当 } N \\text{ 为偶数时}\n\\end{cases}\n$$\n通过取最接近每个目标的 FFT 频点，报告在声学频率 $f_a$ 和流体动力学频率 $f_h$ 处的 $S_{p'p'}(f)$。\n\n所有物理答案必须以帕斯卡平方每赫兹 ($\\mathrm{Pa}^2/\\mathrm{Hz}$) 表示。角度单位为弧度。报告数值时，请将每个值四舍五入到六位小数。\n\n测试套件：\n- 案例 1（通用情况）：\n  - $N_s = 64$，$a = 0.5\\,\\mathrm{m}$，$\\mathbf{x}_o = (10.0,0.0,0.0)\\,\\mathrm{m}$，\n  - $f_a = 800\\,\\mathrm{Hz}$，$A_a = 1.0\\,\\mathrm{Pa}$，\n  - $f_h = 200\\,\\mathrm{Hz}$，$A_h = 2.0\\,\\mathrm{Pa}$，\n  - $U = 100.0\\,\\mathrm{m/s}$，$c_0 = 340.0\\,\\mathrm{m/s}$，\n  - 噪声振幅 $A_n = 0.05\\,\\mathrm{Pa}$，\n  - $f_s = 20000\\,\\mathrm{Hz}$，$T = 0.5\\,\\mathrm{s}$。\n\n- 案例 2（无流体动力学内容）：\n  - $N_s = 64$，$a = 0.5\\,\\mathrm{m}$，$\\mathbf{x}_o = (10.0,0.0,0.0)\\,\\mathrm{m}$，\n  - $f_a = 800\\,\\mathrm{Hz}$，$A_a = 1.0\\,\\mathrm{Pa}$，\n  - $f_h = 200\\,\\mathrm{Hz}$，$A_h = 0.0\\,\\mathrm{Pa}$，\n  - $U = 100.0\\,\\mathrm{m/s}$，$c_0 = 340.0\\,\\mathrm{m/s}$，\n  - 噪声振幅 $A_n = 0.05\\,\\mathrm{Pa}$，\n  - $f_s = 20000\\,\\mathrm{Hz}$，$T = 0.5\\,\\mathrm{s}$。\n\n- 案例 3（近声速对流）：\n  - $N_s = 64$，$a = 0.5\\,\\mathrm{m}$，$\\mathbf{x}_o = (10.0,0.0,0.0)\\,\\mathrm{m}$，\n  - $f_a = 800\\,\\mathrm{Hz}$，$A_a = 1.0\\,\\mathrm{Pa}$，\n  - $f_h = 200\\,\\mathrm{Hz}$，$A_h = 2.0\\,\\mathrm{Pa}$，\n  - $U = 320.0\\,\\mathrm{m/s}$，$c_0 = 340.0\\,\\mathrm{m/s}$，\n  - 噪声振幅 $A_n = 0.05\\,\\mathrm{Pa}$，\n  - $f_s = 20000\\,\\mathrm{Hz}$，$T = 0.5\\,\\mathrm{s}$。\n\n- 案例 4（稀疏表面采样和较小孔径）：\n  - $N_s = 8$，$a = 0.1\\,\\mathrm{m}$，$\\mathbf{x}_o = (5.0,0.0,0.0)\\,\\mathrm{m}$，\n  - $f_a = 1200\\,\\mathrm{Hz}$，$A_a = 1.0\\,\\mathrm{Pa}$，\n  - $f_h = 300\\,\\mathrm{Hz}$，$A_h = 2.0\\,\\mathrm{Pa}$，\n  - $U = 150.0\\,\\mathrm{m/s}$，$c_0 = 340.0\\,\\mathrm{m/s}$，\n  - 噪声振幅 $A_n = 0.05\\,\\mathrm{Pa}$，\n  - $f_s = 20000\\,\\mathrm{Hz}$，$T = 0.5\\,\\mathrm{s}$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔结果列表。对于每个测试案例，报告两个以 $\\mathrm{Pa}^2/\\mathrm{Hz}$ 为单位并四舍五入到六位小数的值：首先是 $S_{p'p'}(f_a)$，然后是 $S_{p'p'}(f_h)$。因此，总输出应包含八个数字，按案例 1 到 4 的顺序排列，总格式为\n$$\n[\\;S_{p'p'}(f_a)_{\\text{案例 1}},\\,S_{p'p'}(f_h)_{\\text{案例 1}},\\,S_{p'p'}(f_a)_{\\text{案例 2}},\\,S_{p'p'}(f_h)_{\\text{案例 2}},\\,S_{p'p'}(f_a)_{\\text{案例 3}},\\,S_{p'p'}(f_h)_{\\text{案例 3}},\\,S_{p'p'}(f_a)_{\\text{案例 4}},\\,S_{p'p'}(f_h)_{\\text{案例 4}}\\;].\n$$",
            "solution": "该问题要求实现一个用于后处理合成气动声学数据的计算流程。该流程模拟了福克斯·威廉姆斯–霍金斯 (Ffowcs Williams–Hawkings, FW-H) 方法，包括一个关键的预处理步骤，用于从源数据中滤除非传播的流体动力学压力脉动。解决方案通过严格遵循规定的数学和算法步骤来构建。\n\n首先，我们建立计算域并生成源信号。在 $x$-$y$ 平面中定义一个以原点为中心、半径为 $a$ 的圆形可渗透控制面。该表面被离散化为 $N_s$ 个点，其位置由 $\\mathbf{y}_i = (a \\cos\\theta_i, a \\sin\\theta_i, 0)$ 给出，其中 $i = 0, 1, \\ldots, N_s-1$，$\\theta_i = 2\\pi i/N_s$。每个点的外法向矢量为 $\\mathbf{n}_i = (\\cos\\theta_i, \\sin\\theta_i, 0)$。\n\n对于每个点 $\\mathbf{y}_i$，在持续时间 $T$ 内以采样率 $f_s$ 生成一个合成压力信号 $p_s(\\mathbf{y}_i,t)$。时间样本数为 $N = \\lfloor T f_s \\rfloor$。该信号由一个声学平面波、一个流体动力学对流扰动以及加性随机噪声组成。声学波以声速 $c_0$ 传播，而流体动力学分量以不同的速度 $U$ 对流。两者都定义为沿 $+x$ 方向传播。每个表面点 $\\mathbf{y}_i$ 处的信号由以下公式给出：\n$$\np_s(\\mathbf{y}_i,t) = A_a \\cos\\left(2\\pi f_a \\left(t - \\frac{s(\\mathbf{y}_i)}{c_0}\\right)\\right) + A_h \\cos\\left(2\\pi f_h \\left(t - \\frac{s(\\mathbf{y}_i)}{U}\\right)\\right) + \\eta_i(t)\n$$\n在这里，$s(\\mathbf{y}_i) = \\hat{\\mathbf{e}}_x \\cdot \\mathbf{y}_i = a \\cos\\theta_i$ 是该点位置在传播方向上的投影。$A_a$ 和 $f_a$ 是声学振幅和频率，$A_h$ 和 $f_h$ 是流体动力学振幅和频率，$\\eta_i(t)$ 是具有指定振幅 $A_n$ 的零均值随机噪声。为保证计算的可复现性，噪声使用固定的随机种子从 $[-A_n, A_n]$ 上的均匀分布生成。\n\n第二个主要步骤是滤除流体动力学压力分量。这通过一种对流对齐和相减的技术来实现。对于每个表面点 $\\mathbf{y}_i$，对信号 $p_s$ 进行时间平移，以对齐以速度 $U$ 对流的事件：\n$$\nq_i(t) = p_s\\left(\\mathbf{y}_i, t + \\frac{s(\\mathbf{y}_i)}{U}\\right)\n$$\n代入 $p_s$ 的表达式，$q_i(t)$ 的流体动力学部分变为 $A_h \\cos(2\\pi f_h t)$，现在它在所有表面点上都是同步的，与其位置 $s(\\mathbf{y}_i)$ 无关。然而，声学部分仍然依赖于 $s(\\mathbf{y}_i)$，因为其相位与 $c_0$ 相关。通过在整个表面上对这些对齐的信号进行平均，空间上非相干的声学和噪声分量被衰减，而相干的流体动力学分量被保留下来：\n$$\n\\overline{q}(t) = \\frac{1}{N_s} \\sum_{i=0}^{N_s-1} q_i(t) \\approx A_h \\cos(2\\pi f_h t)\n$$\n这个表面平均信号 $\\overline{q}(t)$ 可作为参考位置（$s=0$）处孤立的流体动力学脉动的估计。然后将此估计值时间平移回每个点的原始坐标系，以构建流体动力学压力场估计：\n$$\n\\widehat{p}_h(\\mathbf{y}_i,t) = \\overline{q}\\left(t - \\frac{s(\\mathbf{y}_i)}{U}\\right)\n$$\n最后，从原始信号中减去这个估计，得到滤波后的压力，理想情况下它只包含声学信号和残余噪声：\n$$\np_f(\\mathbf{y}_i,t) = p_s(\\mathbf{y}_i,t) - \\widehat{p}_h(\\mathbf{y}_i,t)\n$$\n所有需要的时间平移都通过对离散时间序列数据进行线性插值来数值化地执行。\n\n第三步是使用简化的多孔 FW-H 积分公式计算远场观察者压力 $p'(\\mathbf{x}_o,t)$。这涉及对所有表面点的贡献求和，每个贡献都在其特定的延迟时间进行求值。信号从点 $\\mathbf{y}_i$ 在时间 $t$ 到达观察者位置 $\\mathbf{x}_o$ 的延迟时间 $t_r^{(i)}$ 为：\n$$\nt_r^{(i)}(t) = t - \\frac{R_i}{c_0}, \\quad \\text{其中} \\quad R_i = \\|\\mathbf{x}_o - \\mathbf{y}_i\\|\n$$\n远场代理压力是滤波后压力在其各自延迟时间求值的加权和：\n$$\np'(\\mathbf{x}_o,t) \\approx \\sum_{i=0}^{N_s-1} w_i \\, p_f\\left(\\mathbf{y}_i,\\, t_r^{(i)}(t)\\right)\n$$\n权重 $w_i$ 由 $w_i = \\frac{R_{\\mathrm{ref}}}{4\\pi R_i N_s}$ 给出，其中 $R_{\\mathrm{ref}}=1\\,\\mathrm{m}$ 是一个参考长度。该求和通过在所需的延迟时间样本 $t_r^{(i)}(t)$ 处对每个滤波信号 $p_f(\\mathbf{y}_i, t)$ 进行插值来执行。\n\n最后一步是通过计算其单边功率谱密度 (PSD) $S_{p'p'}(f)$ 来分析最终得到的观察者压力信号 $p'(\\mathbf{x}_o,t)$ 的频率内容。首先将长度为 $N$ 的信号乘以一个汉宁窗 $w[n]$ 以减少频谱泄漏。计算加窗信号的离散傅里叶变换 (DFT) $X[k]$。然后根据以下公式计算单边 PSD：\n$$\nS_{p'p'}(f_k) = \\begin{cases}\n\\frac{1}{f_s N U_w} |X[0]|^2,  k = 0 \\\\\n\\frac{2}{f_s N U_w} |X[k]|^2,  1 \\le k \\le N/2 - 1 \\\\\n\\frac{1}{f_s N U_w} |X[N/2]|^2,  k = N/2 \\text{ (当 } N \\text{ 为偶数时)}\n\\end{cases}\n$$\n其中 $f_k = k f_s/N$ 是离散频率，$U_w = \\frac{1}{N}\\sum_{n=0}^{N-1} w[n]^2$ 是窗函数功率校正因子。PSD 值在最接近指定的声学频率 $f_a$ 和流体动力学频率 $f_h$ 的频点处报告。\n\n整个过程被封装在一个 Python 脚本中。为了提高效率，使用了向量化的 `numpy` 操作，而对于涉及跨表面点的非均匀时间平移的步骤（滤波和延迟时间求值），则使用了循环。所有插值都由 `numpy.interp` 处理。该脚本遍历所提供的测试案例，为每个案例计算两个要求的 PSD 值，并将输出格式化为单个四舍五入的小数列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef process_case(Ns, a, xo, fa, Aa, fh, Ah, U, c0, An, fs, T):\n    \"\"\"\n    Implements the full aeroacoustic post-processing pipeline for a single test case.\n    \"\"\"\n    # Set seed for reproducibility of noise. Using a combination of inputs to\n    # ensure noise is different per case but reproducible for the same case.\n    # A simple seed like 0 is sufficient, but this is more robust if case parameters were permuted.\n    seed_val = Ns + int(a*10) + int(xo[0]) + int(fa) + int(fh)\n    np.random.seed(seed_val)\n\n    # Step 1: Define a circular, permeable FW-H control surface and time array\n    N = int(T * fs)\n    t = np.linspace(0, T, N, endpoint=False)\n    dt = T / N\n\n    theta_i = 2 * np.pi * np.arange(Ns) / Ns\n    y_i = np.zeros((Ns, 3))\n    y_i[:, 0] = a * np.cos(theta_i)\n    y_i[:, 1] = a * np.sin(theta_i)\n    \n    # Step 2: Generate synthetic LES surface pressure signals\n    s_i = y_i[:, 0]  # Projection coordinate s(y_i) = x-component\n    \n    # Use broadcasting for efficient signal generation\n    t_grid = t[np.newaxis, :]\n    s_grid = s_i[:, np.newaxis]\n\n    acoustic_part = Aa * np.cos(2 * np.pi * fa * (t_grid - s_grid / c0))\n    hydro_part = Ah * np.cos(2 * np.pi * fh * (t_grid - s_grid / U))\n    noise_part = np.random.uniform(-An, An, size=(Ns, N))\n    \n    p_s = acoustic_part + hydro_part + noise_part\n    \n    # Step 3: Construct a hydrodynamic pressure estimate and filter\n    q = np.zeros_like(p_s)\n    for i in range(Ns):\n        t_aligned = t + s_i[i] / U\n        # Interpolate p_s at aligned times. Extrapolate with 0.\n        q[i, :] = np.interp(t_aligned, t, p_s[i, :], left=0.0, right=0.0)\n        \n    q_bar = np.mean(q, axis=0)\n    \n    p_h_hat = np.zeros_like(p_s)\n    for i in range(Ns):\n        t_dealigned = t - s_i[i] / U\n        # Interpolate q_bar at de-aligned times. Extrapolate with 0.\n        p_h_hat[i, :] = np.interp(t_dealigned, t, q_bar, left=0.0, right=0.0)\n        \n    p_f = p_s - p_h_hat\n    \n    # Step 4: Compute the FW-H far-field proxy pressure\n    xo_vec = np.array(xo)\n    R_i = np.linalg.norm(xo_vec - y_i, axis=1)\n    \n    R_ref = 1.0\n    w_i = R_ref / (4 * np.pi * R_i * Ns)\n    \n    p_prime = np.zeros(N)\n    for i in range(Ns):\n        t_r = t - R_i[i] / c0\n        p_f_retarded = np.interp(t_r, t, p_f[i, :], left=0.0, right=0.0)\n        p_prime += w_i[i] * p_f_retarded\n        \n    # Step 5: Compute the one-sided power spectral density (PSD)\n    x = p_prime\n    win = np.hanning(N)\n    # Window power correction factor\n    Uw = np.mean(win**2)\n    \n    x_w = x * win\n    X = np.fft.fft(x_w)\n    \n    freqs = np.fft.fftfreq(N, d=dt)\n    \n    psd = np.abs(X)**2 / (fs * N * Uw)\n    \n    # Correct for one-sided PSD, handling N even or odd\n    psd_one_sided = psd[:N//2 + 1]\n    freqs_one_sided = freqs[:N//2 + 1]\n    \n    # Double the power for non-DC and non-Nyquist frequencies\n    if N % 2 == 0:\n        psd_one_sided[1:-1] *= 2\n    else: # N is odd\n        psd_one_sided[1:] *= 2\n\n    # Find PSD values at frequencies closest to fa and fh\n    idx_fa = np.argmin(np.abs(freqs_one_sided - fa))\n    S_fa = psd_one_sided[idx_fa]\n    \n    idx_fh = np.argmin(np.abs(freqs_one_sided - fh))\n    S_fh = psd_one_sided[idx_fh]\n    \n    return S_fa, S_fh\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (general case)\n        {'Ns': 64, 'a': 0.5, 'xo': (10.0, 0.0, 0.0), 'fa': 800, 'Aa': 1.0, \n         'fh': 200, 'Ah': 2.0, 'U': 100.0, 'c0': 340.0, 'An': 0.05, \n         'fs': 20000, 'T': 0.5},\n        # Case 2 (no hydrodynamic content)\n        {'Ns': 64, 'a': 0.5, 'xo': (10.0, 0.0, 0.0), 'fa': 800, 'Aa': 1.0, \n         'fh': 200, 'Ah': 0.0, 'U': 100.0, 'c0': 340.0, 'An': 0.05, \n         'fs': 20000, 'T': 0.5},\n        # Case 3 (near-sonic convection)\n        {'Ns': 64, 'a': 0.5, 'xo': (10.0, 0.0, 0.0), 'fa': 800, 'Aa': 1.0, \n         'fh': 200, 'Ah': 2.0, 'U': 320.0, 'c0': 340.0, 'An': 0.05, \n         'fs': 20000, 'T': 0.5},\n        # Case 4 (sparse surface sampling and smaller aperture)\n        {'Ns': 8, 'a': 0.1, 'xo': (5.0, 0.0, 0.0), 'fa': 1200, 'Aa': 1.0, \n         'fh': 300, 'Ah': 2.0, 'U': 150.0, 'c0': 340.0, 'An': 0.05, \n         'fs': 20000, 'T': 0.5},\n    ]\n\n    results = []\n    for case in test_cases:\n        S_fa, S_fh = process_case(**case)\n        results.append(round(S_fa, 6))\n        results.append(round(S_fh, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}