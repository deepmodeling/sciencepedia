{
    "hands_on_practices": [
        {
            "introduction": "第一个练习聚焦于许多亚格子尺度模型的基石：Smagorinsky模型。我们将进行一次“先验”测试，这是一种关键的验证技术，它将模型的预测与高保真度的直接数值模拟（DNS）数据进行直接比较。通过这个练习，你将巩固对涡粘性概念的理解，并学会如何使用标准误差度量来定量评估模型的性能。",
            "id": "3988250",
            "problem": "您的任务是评估一种在大涡模拟 (LES) 中广泛使用的子网格尺度闭合模型——Smagorinsky 模型——对稳态剪切流的预测能力。重点关注非对角子网格尺度 (SGS) 剪切应力分量$\\tau_{12}$及其对应变率张量模量$|\\tilde{S}|$的依赖关系。您必须基于基本的滤波方程和闭合假设来推导$\\tau_{12}$，在一个程序中实现所得到的预测模型，并与先验的直接数值模拟 (DNS) 数据进行比较，计算定量的误差指标。\n\n从滤波后的不可压缩 Navier–Stokes 方程、子网格尺度应力张量$\\tau_{ij}$的定义以及已解尺度应变率张量$\\tilde{S}_{ij}$的定义出发。使用基于物理上合理假设的统计闭合框架，获得一个用滤波宽度$\\Delta$、无量纲系数$C_s$、模量$|\\tilde{S}|$和剪切分量$\\tilde{S}_{12}$表示的$\\tau_{12}$模型表达式。假设 SGS 应力是经密度归一化的（运动学的），因此$\\tau_{ij}$的单位是$\\mathrm{m}^2/\\mathrm{s}^2$。请解释对于不可压缩剪切流，导出$\\tau_{12}$模型所依据的物理假设和数学步骤。\n\n然后，在代码中实现您推导出的预测模型，并将其与提供的来自直接数值模拟 (DNS) 的先验数据进行比较。对于每个测试用例，计算模型预测值与 DNS 数据之间的以下误差指标：\n- 平均绝对误差 (MAE)，单位为$\\mathrm{m}^2/\\mathrm{s}^2$。\n- 均方根误差 (RMSE)，单位为$\\mathrm{m}^2/\\mathrm{s}^2$。\n- 决定系数$R^2$，定义为预测值数组与 DNS 数组之间的 Pearson 相关系数的平方（无量纲）。当两个数组的方差均为零且完全相等时，定义$R^2 = 1.0$。如果两者方差均为零但不相等，则定义$R^2 = 0.0$。\n\n您的程序必须评估以下测试套件。每个测试用例提供以米为单位的滤波宽度$\\Delta$、无量纲系数$C_s$、以$\\mathrm{s}^{-1}$为单位的$|\\tilde{S}|$和$\\tilde{S}_{12}$数组，以及以$\\mathrm{m}^2/\\mathrm{s}^2$为单位的DNS $\\tau_{12}$。所有量均采用国际单位制 (SI)。\n\n测试用例 1 (中等剪切，典型参数)：\n- $\\Delta = 2.0 \\times 10^{-3} \\, \\mathrm{m}$, $C_s = 0.16$,\n- $|\\tilde{S}| = [20, 40, 60, 80, 100] \\, \\mathrm{s}^{-1}$,\n- $\\tilde{S}_{12} = [10, 20, 30, 40, 50] \\, \\mathrm{s}^{-1}$,\n- DNS $\\tau_{12} = [-3.896\\times10^{-5}, -1.7384\\times10^{-4}, -3.6064\\times10^{-4}, -6.7036\\times10^{-4}, -1.014\\times10^{-3}] \\, \\mathrm{m}^2/\\mathrm{s}^2$。\n\n测试用例 2 (应变为零的边界情况)：\n- $\\Delta = 2.0 \\times 10^{-3} \\, \\mathrm{m}$, $C_s = 0.16$,\n- $|\\tilde{S}| = [0, 0, 0, 0] \\, \\mathrm{s}^{-1}$,\n- $\\tilde{S}_{12} = [0, 0, 0, 0] \\, \\mathrm{s}^{-1}$,\n- DNS $\\tau_{12} = [0, 0, 0, 0] \\, \\mathrm{m}^2/\\mathrm{s}^2$。\n\n测试用例 3 (高剪切伴随符号变化)：\n- $\\Delta = 3.0 \\times 10^{-3} \\, \\mathrm{m}$, $C_s = 0.18$,\n- $|\\tilde{S}| = [50, 100, 150, 200, 250] \\, \\mathrm{s}^{-1}$,\n- $\\tilde{S}_{12} = [-25, -50, 75, -100, 125] \\, \\mathrm{s}^{-1}$,\n- DNS $\\tau_{12} = [1.229\\times10^{-3}, 2.516\\times10^{-3}, -5.961\\times10^{-3}, 1.0964\\times10^{-2}, -1.7225\\times10^{-2}] \\, \\mathrm{m}^2/\\mathrm{s}^2$。\n\n测试用例 4 (小滤波宽度和较低系数)：\n- $\\Delta = 1.0 \\times 10^{-3} \\, \\mathrm{m}$, $C_s = 0.10$,\n- $|\\tilde{S}| = [10, 20, 30, 40, 50] \\, \\mathrm{s}^{-1}$,\n- $\\tilde{S}_{12} = [5, 10, 15, 20, 25] \\, \\mathrm{s}^{-1}$,\n- DNS $\\tau_{12} = [0.0, -4.5\\times10^{-6}, -7.0\\times10^{-6}, -1.7\\times10^{-5}, -2.5\\times10^{-5}] \\, \\mathrm{m}^2/\\mathrm{s}^2$。\n\n您的程序应为四个测试用例中的每一个计算三个误差指标。最终输出必须是单行，其中包含一个由方括号括起来的、包含$12$个浮点数（四个测试用例乘以三个指标）的逗号分隔列表，顺序如下：\n$[\\mathrm{MAE}_1,\\mathrm{RMSE}_1,R^2_1,\\mathrm{MAE}_2,\\mathrm{RMSE}_2,R^2_2,\\mathrm{MAE}_3,\\mathrm{RMSE}_3,R^2_3,\\mathrm{MAE}_4,\\mathrm{RMSE}_4,R^2_4]$。\n所有的 MAE 和 RMSE 值的单位必须是$\\mathrm{m}^2/\\mathrm{s}^2$，所有的$R^2$值必须是无量纲的。",
            "solution": "所述问题在科学上是合理的、自洽的且适定的。它为大涡模拟 (LES) 中湍流的一个基础子网格尺度 (SGS) 模型提供了一个标准的先验验证练习。所有必需的物理参数、数据和误差指标的定义都已明确给出，没有歧义或矛盾。因此，我们可以着手进行推导和求解。\n\n**1. Smagorinsky 模型中$\\tau_{12}$的理论推导**\n\n目标是为不可压缩流推导子网格尺度 (SGS) 剪切应力分量$\\tau_{12}$的模型。\n\n**1.1. 滤波与子网格尺度应力张量**\n\n在 LES 中，速度场$u_i$被分解为一个已解（滤波后）分量$\\tilde{u}_i$和一个未解（子网格）分量$u'_i$。滤波操作由波浪线表示。滤波后的不可压缩 Navier-Stokes 方程包含一个表示未解尺度对已解尺度影响的项。该项是 SGS 应力张量$\\tau_{ij}$的散度，其定义为：\n$$ \\tau_{ij} = \\widetilde{u_i u_j} - \\tilde{u}_i \\tilde{u}_j $$\n此处，$\\tau_{ij}$是一个运动应力（单位为$\\mathrm{m}^2/\\mathrm{s}^2$），因为密度被假定为常数并被并入压力项中。该张量是对称的（$\\tau_{ij} = \\tau_{ji}$），但其值未知，必须用已解尺度量来建模。\n\n**1.2. Boussinesq 假设与涡粘性**\n\nSmagorinsky 模型与许多其他 SGS 模型一样，基于 Boussinesq 假设或“涡粘性”假设。该假设假定 SGS 应力张量的各向异性部分与已解尺度应变率张量之间存在线性关系，这类似于牛顿流体中粘性应力与应变率之间的关系。\n\nSGS 应力张量可分解为其各向同性部分和其偏（各向异性）部分$\\tau_{ij}^d$：\n$$ \\tau_{ij} = \\tau_{ij}^d + \\frac{1}{3}\\tau_{kk}\\delta_{ij} $$\n其中$\\tau_{kk}$是张量的迹（两倍的 SGS 湍动能），$\\delta_{ij}$是克罗内克 δ。各向同性部分通常被并入动量方程中一个修正的压力项，并且不直接贡献于动量输运。\n\nBoussinesq 假设将偏应力部分建模为：\n$$ \\tau_{ij}^d = -2\\nu_{SGS} \\tilde{S}_{ij} $$\n其中$\\nu_{SGS}$是 SGS 涡粘性，$\\tilde{S}_{ij}$是已解尺度应变率张量，定义为：\n$$ \\tilde{S}_{ij} = \\frac{1}{2} \\left( \\frac{\\partial \\tilde{u}_i}{\\partial x_j} + \\frac{\\partial \\tilde{u}_j}{\\partial x_i} \\right) $$\n对于非对角剪切应力分量$\\tau_{12}$，其中$i=1, j=2$ ($i \\neq j$)，由于$\\delta_{12} = 0$，各向同性部分为零。因此，$\\tau_{12}$的模型由偏应力部分直接给出：\n$$ \\tau_{12} = -2\\nu_{SGS} \\tilde{S}_{12} $$\n\n**1.3. 涡粘性$\\nu_{SGS}$的建模**\n\nSmagorinsky 模型的核心贡献是$\\nu_{SGS}$的表达式。该表达式通过量纲分析推导得出，其假设是 SGS 能量的产生与其耗散处于局部平衡状态。涡粘性的单位必须是$\\mathrm{m}^2/\\mathrm{s}$。它由未解涡的特征长度尺度和特征速度尺度构成。\n-   特征长度尺度取为滤波宽度$\\Delta$。\n-   特征速度尺度从已解场中导出。已解尺度应变率张量的模量$|\\tilde{S}| = \\sqrt{2 \\tilde{S}_{ij} \\tilde{S}_{ij}}$的单位是$\\mathrm{s}^{-1}$。将其乘以长度尺度$\\Delta$即可得到一个速度尺度：$v' \\sim \\Delta |\\tilde{S}|$。\n\n结合这些尺度，涡粘性可建模为：\n$$ \\nu_{SGS} \\sim (\\text{长度尺度}) \\times (\\text{速度尺度}) \\sim \\Delta \\times (\\Delta |\\tilde{S}|) = \\Delta^2 |\\tilde{S}| $$\n引入一个无量纲模型系数，即 Smagorinsky 常数$C_s$，得到涡粘性的最终形式：\n$$ \\nu_{SGS} = (C_s \\Delta)^2 |\\tilde{S}| = C_s^2 \\Delta^2 |\\tilde{S}| $$\n\n**1.4. $\\tau_{12}$的最终模型方程**\n\n将$\\nu_{SGS}$的表达式代入$\\tau_{12}$的 Boussinesq 关系式，得到 SGS 剪切应力的完整 Smagorinsky 模型：\n$$ \\tau_{12}^{\\text{model}} = -2 \\nu_{SGS} \\tilde{S}_{12} = -2 \\left( C_s^2 \\Delta^2 |\\tilde{S}| \\right) \\tilde{S}_{12} $$\n这就是需要实现的方程。它仅使用已解场量（$|\\tilde{S}|$、$\\tilde{S}_{12}$）和模型参数（$C_s$、$\\Delta$）来预测 SGS 剪切应力。负号表示该模型是纯耗散的；对于正的$\\tilde{S}_{12}$和$|\\tilde{S}|$，它会产生一个负的$\\tau_{12}$，这对应于一个抵抗平均剪切的应力。\n\n**2. 误差指标**\n\n将计算以下误差指标，以比较模型预测值$y_{\\text{pred}} = \\tau_{12}^{\\text{model}}$与 DNS 数据$y_{\\text{true}} = \\tau_{12}^{\\text{DNS}}$。对于一组$N$个数据点：\n-   **平均绝对误差 (MAE):**\n    $$ \\mathrm{MAE} = \\frac{1}{N} \\sum_{i=1}^{N} | y_{\\text{pred},i} - y_{\\text{true},i} | $$\n-   **均方根误差 (RMSE):**\n    $$ \\mathrm{RMSE} = \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} ( y_{\\text{pred},i} - y_{\\text{true},i} )^2} $$\n-   **决定系数 ($R^2$):** 定义为 Pearson 相关系数$r$的平方。\n    $$ r = \\frac{\\sum_{i=1}^{N} (y_{\\text{pred},i} - \\bar{y}_{\\text{pred}})(y_{\\text{true},i} - \\bar{y}_{\\text{true}})}{\\sqrt{\\sum_{i=1}^{N} (y_{\\text{pred},i} - \\bar{y}_{\\text{pred}})^2 \\sum_{i=1}^{N} (y_{\\text{true},i} - \\bar{y}_{\\text{true}})^2}} \\quad \\implies \\quad R^2 = r^2 $$\n    对于零方差的特殊情况，按问题陈述中的规定处理。具体而言，如果预测数组和真实数组的方差均为零，若它们完全相同，则$R^2 = 1.0$，否则$R^2 = 0.0$。\n\n现在将基于这些推导出的公式和定义的指标进行实现。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_error_metrics(y_pred, y_true):\n    \"\"\"\n    Computes MAE, RMSE, and R^2 between predicted and true values.\n    \n    Args:\n        y_pred (np.ndarray): Array of predicted values.\n        y_true (np.ndarray): Array of true values.\n\n    Returns:\n        tuple: A tuple containing (mae, rmse, r_squared).\n    \"\"\"\n    # Mean Absolute Error (MAE)\n    mae = np.mean(np.abs(y_pred - y_true))\n\n    # Root Mean Square Error (RMSE)\n    rmse = np.sqrt(np.mean((y_pred - y_true)**2))\n\n    # Coefficient of Determination (R^2)\n    var_pred = np.var(y_pred)\n    var_true = np.var(y_true)\n\n    if var_pred == 0 and var_true == 0:\n        if np.all(y_pred == y_true):\n            r_squared = 1.0\n        else:\n            r_squared = 0.0\n    else:\n        # np.corrcoef returns a 2x2 matrix, the value at [0, 1] is the coefficient r.\n        # It can return nan if one of the inputs has zero variance. A simple check\n        # is sufficient since the case where both have zero variance is handled above.\n        if var_pred == 0 or var_true == 0:\n             # Correlation is typically undefined if one variable is constant.\n             # This can lead to a divide-by-zero warning in np.corrcoef.\n             # Given the problem context, if one has variance and the other doesn't,\n             # they are not well correlated. We can assign 0.\n             r_squared = 0.0\n        else:\n            r_matrix = np.corrcoef(y_pred, y_true)\n            r = r_matrix[0, 1]\n            r_squared = r**2\n\n    return mae, rmse, r_squared\n\ndef smagorinsky_model_tau12(Cs, Delta, S_mag, S_12):\n    \"\"\"\n    Calculates the SGS shear stress tau_12 using the Smagorinsky model.\n    \n    Args:\n        Cs (float): Smagorinsky constant.\n        Delta (float): Filter width.\n        S_mag (np.ndarray): Magnitude of the resolved rate-of-strain tensor.\n        S_12 (np.ndarray): Shear component of the resolved rate-of-strain tensor.\n\n    Returns:\n        np.ndarray: The modeled SGS shear stress tau_12.\n    \"\"\"\n    return -2.0 * (Cs * Delta)**2 * S_mag * S_12\n\ndef solve():\n    \"\"\"\n    Main function to process test cases and compute error metrics.\n    \"\"\"\n    test_cases = [\n        {\n            \"Delta\": 2.0e-3, \"Cs\": 0.16,\n            \"S_mag\": np.array([20, 40, 60, 80, 100]),\n            \"S_12\": np.array([10, 20, 30, 40, 50]),\n            \"dns_tau_12\": np.array([-3.896e-5, -1.7384e-4, -3.6064e-4, -6.7036e-4, -1.014e-3])\n        },\n        {\n            \"Delta\": 2.0e-3, \"Cs\": 0.16,\n            \"S_mag\": np.array([0, 0, 0, 0]),\n            \"S_12\": np.array([0, 0, 0, 0]),\n            \"dns_tau_12\": np.array([0, 0, 0, 0])\n        },\n        {\n            \"Delta\": 3.0e-3, \"Cs\": 0.18,\n            \"S_mag\": np.array([50, 100, 150, 200, 250]),\n            \"S_12\": np.array([-25, -50, 75, -100, 125]),\n            \"dns_tau_12\": np.array([1.229e-3, 2.516e-3, -5.961e-3, 1.0964e-2, -1.7225e-2])\n        },\n        {\n            \"Delta\": 1.0e-3, \"Cs\": 0.10,\n            \"S_mag\": np.array([10, 20, 30, 40, 50]),\n            \"S_12\": np.array([5, 10, 15, 20, 25]),\n            \"dns_tau_12\": np.array([0.0, -4.5e-6, -7.0e-6, -1.7e-5, -2.5e-5])\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        # Calculate the model prediction for tau_12\n        model_tau_12 = smagorinsky_model_tau12(\n            case[\"Cs\"],\n            case[\"Delta\"],\n            case[\"S_mag\"],\n            case[\"S_12\"]\n        )\n\n        # Compute the error metrics against the DNS data\n        mae, rmse, r_squared = calculate_error_metrics(model_tau_12, case[\"dns_tau_12\"])\n\n        # Append metrics to the results list\n        all_results.extend([mae, rmse, r_squared])\n\n    # Format the final output string\n    print(f\"[{','.join(f'{r:.7g}' for r in all_results)}]\")\n\n# Execute the solver\nsolve()\n```"
        },
        {
            "introduction": "虽然基本的Smagorinsky模型在湍流核心区域表现强大，但它在靠近固体边界时会失效，这一点广为人知。本练习将通过引入近壁阻尼函数来解决这一关键问题，这些函数可以修正模型在粘性子层中的行为。通过分析一个简化的槽道流，你将探索不同的阻尼公式如何影响壁面剪切应力的预测，而壁面剪切应力在热工学中是一个具有巨大实际重要性的物理量。",
            "id": "3988249",
            "problem": "考虑在摩擦雷诺数$Re_\\tau \\approx 180$的条件下，大涡模拟 (LES) 范式下一个充分发展的湍流槽道流的一维表示。设槽道半高为$h$，运动粘度为$\\nu$，摩擦速度为$u_\\tau = \\sqrt{\\tau_w/\\rho}$，密度为$\\rho$。在此类流动中，平均流向动量方程简化为沿槽道高度的线性总剪应力分布，可写为$\\tau_\\text{tot}(y) = \\rho u_\\tau^2 \\left(1 - \\frac{y}{h}\\right)$，其中总应力是粘性应力与模拟的湍流（亚格子尺度）应力之和，即$\\tau_\\text{tot}(y) = \\rho \\nu \\frac{dU}{dy} + \\rho \\nu_t \\frac{dU}{dy}$。假设对亚格子尺度应力采用 Smagorinsky 类型的空间滤波涡粘性封闭，即$\\nu_t = f_w(y^+) \\left(C_s \\Delta\\right)^2 \\left|\\frac{dU}{dy}\\right|$，其中$C_s$是 Smagorinsky 常数，$\\Delta$是等同于网格间距的滤波宽度，$f_w(y^+)$是用壁面单位$y^+ = \\frac{y u_\\tau}{\\nu}$表示的近壁阻尼函数。将比较两种不同的阻尼公式：\n- van Driest 阻尼函数$f_\\text{vd}(y^+) = \\left(1 - \\exp\\left(-\\frac{y^+}{A^+}\\right)\\right)^2$，参数为$A^+$。\n- 代数阻尼函数$f_\\text{alg}(y^+) = \\frac{y^+}{y^+ + B^+}$，参数为$B^+$。\n\n利用平均动量平衡、涡粘性封闭以及壁面处的无滑移边界条件，在给定的壁面法向位置$y$处，推导平均剪切$G(y) = \\frac{dU}{dy}$关于$\\nu$、$\\nu_t(G,y)$和总应力分布的局部代数关系。然后，对于间距为$\\Delta y = \\frac{h}{N}$的均匀网格，且第一个离壁单元中心位于$y_1 = \\frac{\\Delta y}{2}$，将预测的粘性壁面剪应力定义为在$y_1$处使用局部平均剪切评估的近壁粘性贡献，即$\\tau_w^\\text{pred} = \\rho \\nu G(y_1)$。此代理量化了近壁梯度法从第一个离壁位置的解析速度所能推断出的值。\n\n假设$h = 1$并通过设置$\\rho = 1$、$u_\\tau = 1$进行无量纲化，因此$\\nu = \\frac{1}{Re_\\tau}$，且在这些单位中，真实壁面剪应力为$\\tau_w = \\rho u_\\tau^2 = 1$。采用$\\Delta = \\Delta y$和$C_s = 0.17$。对于每种阻尼公式$f_w(y^+)$和每种网格分辨率$N$，通过求解由总应力和涡粘性模型耦合所蕴含的关于$G(y_1)$的代数关系来计算$y_1$处的$G(y_1)$，然后计算$\\tau_w^\\text{pred} = \\nu G(y_1)$。\n\n您的程序必须为以下测试套件实现此过程：\n- 用例 1 (粗网格): $Re_\\tau = 180$，$N = 8$，$A^+ = 26$，$B^+ = 50$。\n- 用例 2 (中等网格): $Re_\\tau = 180$，$N = 32$，$A^+ = 26$，$B^+ = 50$。\n- 用例 3 (细网格): $Re_\\tau = 180$，$N = 128$，$A^+ = 26$，$B^+ = 50$。\n\n对于每个用例，计算两个浮点数：使用 van Driest 阻尼和使用代数阻尼的归一化预测粘性壁面剪应力。所有剪应力均以$\\rho u_\\tau^2$为单位表示（即无量纲），并且输出中不包含任何单位符号。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为$[\\tau_{w,\\text{vd}}^\\text{pred}(\\text{用例 1}), \\tau_{w,\\text{alg}}^\\text{pred}(\\text{用例 1}), \\tau_{w,\\text{vd}}^\\text{pred}(\\text{用例 2}), \\tau_{w,\\text{alg}}^\\text{pred}(\\text{用例 2}), \\tau_{w,\\text{vd}}^\\text{pred}(\\text{用例 3}), \\tau_{w,\\text{alg}}^\\text{pred}(\\text{用例 3})]$。\n\n通过遵守所述的建模假设来确保科学真实性，并设计您的算法来解决平均剪切和涡粘性之间的局部代数耦合，而不引入超出指定定义的任何特设捷径。每个测试用例的最终输出必须是浮点数。本问题不涉及角度。",
            "solution": "该问题被评估为有效，它在科学上基于大涡模拟 (LES) 的湍流模拟原理，是适定且客观的。所提供的数据和参数对于湍流槽道流的研究来说是一致且标准的。\n\n主要目标是使用 Smagorinsky 型亚格子尺度 (SGS) 模型的两种不同近壁阻尼函数，在三种不同网格分辨率下，计算预测的粘性壁面剪应力$\\tau_w^\\text{pred}$。这涉及求解一个关于平均速度梯度的局部代数方程。\n\n首先，我们建立将平均剪应力与平均速度梯度$G(y) = \\frac{dU}{dy}$相关联的控制方程。在充分发展的湍流槽道流中，总剪应力$\\tau_\\text{tot}(y)$是粘性应力$\\tau_\\nu = \\rho \\nu G(y)$和模拟的 SGS 应力$\\tau_t = \\rho \\nu_t G(y)$之和，其中$\\nu_t$是涡粘度。\n$$\n\\tau_\\text{tot}(y) = \\rho \\nu \\frac{dU}{dy} + \\rho \\nu_t \\frac{dU}{dy} = \\rho (\\nu + \\nu_t) G(y)\n$$\n问题给出了线性的总应力分布和涡粘度的 Smagorinsky 模型：\n$$\n\\tau_\\text{tot}(y) = \\rho u_\\tau^2 \\left(1 - \\frac{y}{h}\\right)\n$$\n$$\n\\nu_t = f_w(y^+) (C_s \\Delta)^2 \\left|\\frac{dU}{dy}\\right| = f_w(y^+) (C_s \\Delta)^2 |G(y)|\n$$\n此处，$f_w(y^+)$是一个阻尼函数，取决于以壁面单位表示的壁面法向距离$y^+ = \\frac{y u_\\tau}{\\nu}$。在近壁区域 ($y>0$)，平均速度梯度$G(y)$是正的，因此我们可以设$|G(y)| = G(y)$。将$\\nu_t$的表达式代入总应力方程得到：\n$$\n\\tau_\\text{tot}(y) = \\rho \\left( \\nu + f_w(y^+) (C_s \\Delta)^2 G(y) \\right) G(y)\n$$\n这个方程可以重排为关于$G(y)$的标准二次型$a G(y)^2 + b G(y) + c = 0$：\n$$\n\\left( \\rho f_w(y^+) (C_s \\Delta)^2 \\right) G(y)^2 + (\\rho \\nu) G(y) - \\tau_\\text{tot}(y) = 0\n$$\n系数为：\n$a = \\rho f_w(y^+) (C_s \\Delta)^2$\n$b = \\rho \\nu$\n$c = -\\tau_\\text{tot}(y)$\n\n对于正的剪切梯度$G(y)$，其物理上有意义的解可以通过选择二次公式的正根来获得：\n$$\nG(y) = \\frac{-b + \\sqrt{b^2 - 4ac}}{2a}\n$$\n问题指定使用无量纲单位，其中$h=1$，$\\rho=1$，和$u_\\tau=1$。这简化了参数：\n- 运动粘度: $\\nu = \\frac{h u_\\tau}{Re_\\tau} = \\frac{1}{Re_\\tau}$\n- 总应力: $\\tau_\\text{tot}(y) = 1 \\cdot 1^2 \\left(1 - \\frac{y}{1}\\right) = 1 - y$\n- 网格间距 (滤波宽度): $\\Delta = \\Delta y = \\frac{h}{N} = \\frac{1}{N}$\n\n我们的任务是评估第一个离壁网格单元中心$y_1 = \\frac{\\Delta y}{2} = \\frac{1}{2N}$处的剪切。在此位置：\n- 壁面坐标为$y_1^+ = \\frac{y_1 u_\\tau}{\\nu} = \\frac{1/(2N)}{1/Re_\\tau} = \\frac{Re_\\tau}{2N}$。\n- 总应力为$\\tau_\\text{tot}(y_1) = 1 - y_1 = 1 - \\frac{1}{2N}$。\n\n当$\\rho=1$时，二次方程的系数变为：\n- $a = f_w(y_1^+) (C_s/N)^2$\n- $b = 1/Re_\\tau$\n- $c = -(1 - 1/(2N))$\n\n我们使用这些系数求解$G(y_1)$，其中阻尼函数$f_w(y_1^+)$是以下两种形式之一：\n1.  van Driest 阻尼: $f_\\text{vd}(y_1^+) = \\left(1 - \\exp\\left(-\\frac{y_1^+}{A^+}\\right)\\right)^2$\n2.  代数阻尼: $f_\\text{alg}(y_1^+) = \\frac{y_1^+}{y_1^+ + B^+}$\n\n最后，预测的粘性壁面剪应力$\\tau_w^\\text{pred}$被定义为近壁粘性贡献，$\\tau_w^\\text{pred} = \\rho \\nu G(y_1)$。在我们的无量纲单位中，这等于$\\tau_w^\\text{pred} = \\nu G(y_1) = \\frac{G(y_1)}{Re_\\tau}$。问题要求此值由$\\rho u_\\tau^2 = 1$进行归一化，所以最终的量就是$\\frac{G(y_1)}{Re_\\tau}$。\n\n每个测试用例的算法如下：\n1.  设置用例参数: $Re_\\tau$, $N$, $A^+$, $B^+$。\n2.  设置常数: $C_s = 0.17$。\n3.  计算特定位置的参数: $\\nu = 1/Re_\\tau$, $y_1 = 1/(2N)$, $y_1^+ = Re_\\tau/(2N)$。\n4.  对于两种阻尼函数$f_\\text{vd}$和$f_\\text{alg}$：\n    a. 计算阻尼函数$f_w(y_1^+)$的值。\n    b. 定义二次方程系数$a = f_w(y_1^+) (C_s/N)^2$, $b = \\nu$, 和$c = -(1-y_1)$。\n    c. 使用二次公式求解剪切率$G(y_1)$: $G(y_1) = \\frac{-b + \\sqrt{b^2 - 4ac}}{2a}$。\n    d. 计算预测的壁面剪应力: $\\tau_w^\\text{pred} = \\nu G(y_1)$。\n5.  收集该用例计算出的两个$\\tau_w^\\text{pred}$值。\n6.  对所有测试用例重复此过程，并将结果格式化为单个列表。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the predicted viscous wall shear stress in a turbulent channel flow\n    using two different LES damping models for a range of grid resolutions.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Re_tau, N, A_plus, B_plus)\n        (180, 8, 26, 50),\n        (180, 32, 26, 50),\n        (180, 128, 26, 50)\n    ]\n\n    # Universal constants from the problem.\n    # h = 1, rho = 1, u_tau = 1.\n    Cs = 0.17  # Smagorinsky constant\n\n    results = []\n\n    def calculate_predicted_shear(Re_tau, N, A_plus, B_plus):\n        \"\"\"\n        Calculates predicted wall shear for a single case with both damping models.\n        \"\"\"\n        # Derived parameters in non-dimensional units\n        nu = 1.0 / Re_tau\n        y1 = 1.0 / (2.0 * N)\n        y1_plus = Re_tau / (2.0 * N)\n        \n        # Total stress at y1\n        tau_tot_y1 = 1.0 - y1\n\n        # Common quadratic coefficient 'b'. Note rho=1.\n        b = nu\n        # Common quadratic coefficient 'c'\n        c = -tau_tot_y1\n\n        # --- van Driest Damping ---\n        f_vd = (1.0 - np.exp(-y1_plus / A_plus))**2\n        \n        # Quadratic coefficient 'a' for van Driest\n        a_vd = f_vd * (Cs / N)**2\n        \n        # Solve quadratic equation for G = dU/dy\n        # a*G^2 + b*G + c = 0\n        discriminant_vd = b**2 - 4 * a_vd * c\n        # The physically meaningful root is the positive one for G.\n        G_vd = (-b + np.sqrt(discriminant_vd)) / (2.0 * a_vd)\n        \n        # Predicted viscous wall shear stress (normalized by rho*u_tau^2 = 1)\n        tau_w_pred_vd = nu * G_vd\n\n        # --- Algebraic Damping ---\n        f_alg = y1_plus / (y1_plus + B_plus)\n        \n        # Quadratic coefficient 'a' for algebraic damping\n        a_alg = f_alg * (Cs / N)**2\n        \n        # Solve quadratic equation for G = dU/dy\n        discriminant_alg = b**2 - 4 * a_alg * c\n        G_alg = (-b + np.sqrt(discriminant_alg)) / (2.0 * a_alg)\n\n        # Predicted viscous wall shear stress\n        tau_w_pred_alg = nu * G_alg\n        \n        return tau_w_pred_vd, tau_w_pred_alg\n\n    for case in test_cases:\n        Re_tau, N, A_plus, B_plus = case\n        tau_vd, tau_alg = calculate_predicted_shear(Re_tau, N, A_plus, B_plus)\n        results.append(tau_vd)\n        results.append(tau_alg)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "真实的模拟计算通常使用各向异性网格，其中单元尺寸在不同方向上差异显著。最后一个练习将探讨一个微妙但至关重要的实现细节：滤波宽度$\\Delta$的定义。你将比较不同的定义方式如何影响几种模型的涡粘性和热通量预测，从而揭示它们各自的敏感性，并为复杂几何形状下的模拟提供最佳实践指导。请注意，此练习采用了一些假设性场景，例如动态程序的简化形式，旨在分离并阐明滤波宽度定义的具体影响。",
            "id": "3988263",
            "problem": "考虑计算热工学中各向异性网格上带传热的不可压流的大涡模拟（LES）。滤波后的动量和能量方程引入了针对未解析的应力和标量通量的亚网格尺度（SGS）封闭模型。令滤波后的速度梯度张量为$g_{ij} = \\partial \\tilde{u}_i / \\partial x_j$，解析的应变率张量为$\\tilde{S}_{ij} = \\tfrac{1}{2}(g_{ij} + g_{ji})$。解析的温度梯度向量为$\\nabla \\tilde{T}$，其分量为$G_j = \\partial \\tilde{T} / \\partial x_j$。SGS涡黏性用$\\nu_t$表示，SGS热扩散率用$\\alpha_t$表示，其中$\\alpha_t = \\nu_t / \\mathrm{Pr}_t$，$\\mathrm{Pr}_t$是湍流普朗特数。建模的SGS标量热通量向量为$q_j = -\\alpha_t G_j$。\n\n您将评估不同滤波宽度$\\Delta$定义对四种封闭模型预测的SGS热通量大小的影响：Smagorinsky模型、Dynamic Smagorinsky模型、Wall-Adapting Local Eddy-viscosity (WALE)模型和标量通量的Scale-Similarity模型。对于各向异性单元，必须比较两种基于网格的滤波宽度$\\Delta$定义：\n- 基于体积：$\\Delta_V = (\\Delta x \\, \\Delta y \\, \\Delta z)^{1/3}$。\n- 基于最大间距：$\\Delta_M = \\max(\\Delta x, \\Delta y, \\Delta z)$。\n\n对于每个模型，计算SGS涡黏性$\\nu_t(\\Delta)$和由此产生的SGS热通量大小$|q(\\Delta)| = \\alpha_t(\\Delta)\\, \\|\\nabla \\tilde{T}\\|_2$，其中$\\|\\cdot\\|_2$表示欧几里得范数。使用$|q(\\Delta_M)|$作为参考，将使用基于体积的$\\Delta_V$引入的相对误差定义为\n$$\nE = \\frac{\\big|\\,|q(\\Delta_V)| - |q(\\Delta_M)|\\,\\big|}{|q(\\Delta_M)|},\n$$\n该误差是无量纲的，必须以小数形式报告。如果$|q(\\Delta_M)| = 0$，则定义$E = 0$。\n\n要使用的模型封闭：\n- Smagorinsky 模型：$\\nu_t = (C_s \\Delta)^2 \\, |\\tilde{S}|$，其中$|\\tilde{S}| = \\sqrt{2 \\tilde{S}_{ij} \\tilde{S}_{ij}}$，$C_s$是一个常数。\n- Dynamic Smagorinsky 模型，使用 Germano 恒等式（偏离部分）：定义 Leonard 应力$L_{ij}$和测试滤波比$\\alpha > 1$。使用模型张量\n$$\nM_{ij} = \\widehat{-2 \\Delta^2 |\\tilde{S}| \\tilde{S}_{ij}} + 2 \\alpha^2 \\Delta^2 |\\widehat{\\tilde{S}}| \\, \\widehat{\\tilde{S}}_{ij},\n$$\n其中帽子符号表示测试滤波。通过最小化 Germano 恒等式中的误差来计算$C_s^2$，\n$$\nC_s^2 = \\max\\!\\left(0, \\frac{L_{ij} M_{ij}}{2 M_{ij} M_{ij}}\\right),\n$$\n然后$\\nu_t = (C_s \\Delta)^2 |\\tilde{S}|$。假设所提供的$L_{ij}$和$\\widehat{\\tilde{S}}_{ij}$与解析场一致。\n- Wall-Adapting Local Eddy-viscosity (WALE) 模型：定义$G_{ij} = g_{ik} g_{kj}$和无迹对称部分$S^{d}_{ij} = \\tfrac{1}{2}(G_{ij} + G_{ji}) - \\tfrac{1}{3}\\delta_{ij} G_{kk}$。令$S^2 = \\tilde{S}_{ij} \\tilde{S}_{ij}$和$(S^{d})^2 = S^{d}_{ij} S^{d}_{ij}$。使用\n$$\n\\nu_t = (C_w \\Delta)^2 \\, \\frac{\\left((S^{d})^2\\right)^{3/2}}{\\left(S^2\\right)^{5/2} + \\left((S^{d})^2\\right)^{5/4}},\n$$\n其中$C_w$是一个常数。如有必要，对分母使用一个小的正则化项以避免除以零。\n- Scale-Similarity 标量通量模型：通过 Leonard 标量通量向量$L^{\\theta}_j = \\widetilde{\\theta u_j} - \\tilde{\\theta}\\,\\tilde{u}_j$对 SGS 标量通量进行建模，并取$|q| = \\|L^{\\theta}\\|_2$。这与$\\Delta$无关，因此使用$\\Delta_V$或$\\Delta_M$都会得到相同的$|q|$，从而$E = 0$。\n\n在所有测试用例中使用的常数：\n- Smagorinsky 常数$C_s = 0.17$。\n- WALE 常数$C_w = 0.50$。\n- 湍流普朗特数$\\mathrm{Pr}_t = 0.70$。\n- 测试滤波比$\\alpha = 2$。\n\n实现一个程序，对于每个测试用例，使用上述公式计算每个模型的相对误差$E$。您的程序必须将所有测试用例的最终结果以指定格式的单行形式输出。所有输出均为无量纲小数。\n\n测试套件输入：\n- 每个测试用例提供$(\\Delta x, \\Delta y, \\Delta z)$（单位为$\\mathrm{m}$）、一个$3\\times 3$张量$g_{ij}$（单位为$\\mathrm{s}^{-1}$）、一个温度梯度向量$\\nabla \\tilde{T}$（单位为$\\mathrm{K/m}$）、一个定义$\\widehat{\\tilde{S}}_{ij} = \\beta \\tilde{S}_{ij}$的标量$\\beta$、一个定义$L_{ij} = \\zeta \\,\\widehat{\\tilde{S}}_{ij}$的标量$\\zeta$，以及一个 Leonard 标量通量向量$L^{\\theta}$（单位为$\\mathrm{K\\,m/s}$）。\n- 测试用例：\n    1. 各向同性中等剪切：\n        - $(\\Delta x, \\Delta y, \\Delta z) = (0.01, 0.01, 0.01)$ $\\mathrm{m}$。\n        - $g_{ij}$：$g_{12} = 100$ $\\mathrm{s}^{-1}$，其他为 $0$。\n        - $\\nabla \\tilde{T} = (1000, 0, 0)$ $\\mathrm{K/m}$。\n        - $\\beta = 0.80$，$\\zeta = 0.010$。\n        - $L^{\\theta} = (0.010, 0.000, 0.000)$ $\\mathrm{K\\,m/s}$。\n    2. 高度各向异性，粗糙方向与温度梯度对齐：\n        - $(\\Delta x, \\Delta y, \\Delta z) = (0.002, 0.020, 0.050)$ $\\mathrm{m}$。\n        - $g_{ij}$：$g_{12} = 80$，$g_{23} = 40$ $\\mathrm{s}^{-1}$，其他为 $0$。\n        - $\\nabla \\tilde{T} = (0, 0, 200)$ $\\mathrm{K/m}$。\n        - $\\beta = 0.60$，$\\zeta = 0.020$。\n        - $L^{\\theta} = (0.000, 0.000, 0.020)$ $\\mathrm{K\\,m/s}$。\n    3. 旋转主导，应变较小：\n        - $(\\Delta x, \\Delta y, \\Delta z) = (0.010, 0.050, 0.050)$ $\\mathrm{m}$。\n        - $g_{ij}$：$g_{12} = 300$，$g_{21} = -300$，$g_{11} = 5$，$g_{22} = -5$ $\\mathrm{s}^{-1}$，其他为 $0$。\n        - $\\nabla \\tilde{T} = (100, 100, 0)$ $\\mathrm{K/m}$。\n        - $\\beta = 0.90$，$\\zeta = 0.005$。\n        - $L^{\\theta} = (0.005, 0.005, 0.000)$ $\\mathrm{K\\,m/s}$。\n    4. 接近零应变，强各向异性：\n        - $(\\Delta x, \\Delta y, \\Delta z) = (0.005, 0.005, 0.100)$ $\\mathrm{m}$。\n        - $g_{ij}$：$g_{11} = 1$，$g_{22} = 1$，$g_{33} = 1$ $\\mathrm{s}^{-1}$，其他为 $0$。\n        - $\\nabla \\tilde{T} = (10, 10, 10)$ $\\mathrm{K/m}$。\n        - $\\beta = 0.50$，$\\zeta = 0.001$。\n        - $L^{\\theta} = (0.0001, 0.0001, 0.0001)$ $\\mathrm{K\\,m/s}$。\n\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例映射到一个四元素列表$[E_{\\mathrm{Smag}}, E_{\\mathrm{Dyn}}, E_{\\mathrm{WALE}}, E_{\\mathrm{SS}}]$，顺序如此。例如，最终的程序输出应类似于\n$[\\,[e_{11},e_{12},e_{13},e_{14}],[e_{21},e_{22},e_{23},e_{24}],[e_{31},e_{32},e_{33},e_{34}],[e_{41},e_{42},e_{43},e_{44}]]$\n其中包含小数值。",
            "solution": "该问题要求分析几种亚网格尺度（SGS）模型对各向异性计算网格上滤波宽度$\\Delta$定义的敏感性。需要计算当使用基于体积的滤波宽度$\\Delta_V$与基于最大间距的滤波宽度$\\Delta_M$时，SGS 热通量大小$|q|$的相对误差$E$。\n\n该问题在科学上是适定的，指定的模型——Smagorinsky、Dynamic Smagorinsky、WALE 和 Scale-Similarity——都是大涡模拟（LES）中的标准封闭模型。问题提供了进行完整分析所需的所有数据和常数。动态模型公式中的一个模糊之处可以通过采用一个标准的简化来解决，我将在相应部分详细说明。因此，该问题被认为是有效的。\n\nSGS 热通量向量建模为$q_j = -\\alpha_t G_j$，其中$\\alpha_t = \\nu_t / \\mathrm{Pr}_t$是 SGS 热扩散率，$\\nu_t$是 SGS 涡黏性，$\\mathrm{Pr}_t$是湍流普朗特数，$G_j = \\partial \\tilde{T} / \\partial x_j$是解析温度梯度$\\nabla \\tilde{T}$的分量。\n\nSGS 热通量的大小为$|q(\\Delta)| = \\alpha_t(\\Delta) \\|\\nabla \\tilde{T}\\|_2$，其中$\\|\\nabla \\tilde{T}\\|_2 = \\sqrt{G_j G_j}$是温度梯度的欧几里得范数。滤波宽度$\\Delta$是模型相关的，可以是$\\Delta_V = (\\Delta x \\Delta y \\Delta z)^{1/3}$或$\\Delta_M = \\max(\\Delta x, \\Delta y, \\Delta z)$。\n\n相对误差$E$定义为：\n$$\nE = \\frac{\\big|\\,|q(\\Delta_V)| - |q(\\Delta_M)|\\,\\big|}{|q(\\Delta_M)|}\n$$\n如果$|q(\\Delta_M)| = 0$，$E$定义为$0$。假设$|q(\\Delta_M)| \\neq 0$，我们可以代入$|q(\\Delta)|$的表达式：\n$$\nE = \\frac{\\left| \\frac{\\nu_t(\\Delta_V)}{\\mathrm{Pr}_t} \\|\\nabla \\tilde{T}\\|_2 - \\frac{\\nu_t(\\Delta_M)}{\\mathrm{Pr}_t} \\|\\nabla \\tilde{T}\\|_2 \\right|}{\\frac{\\nu_t(\\Delta_M)}{\\mathrm{Pr}_t} \\|\\nabla \\tilde{T}\\|_2}\n$$\n对于给定的测试用例，$\\mathrm{Pr}_t$和$\\|\\nabla \\tilde{T}\\|_2$是常数，只要$\\|\\nabla \\tilde{T}\\|_2 \\neq 0$且$\\nu_t(\\Delta_M) \\neq 0$，它们就可以消掉。这使得误差表达式简化为仅依赖于涡黏性：\n$$\nE = \\left| \\frac{\\nu_t(\\Delta_V)}{\\nu_t(\\Delta_M)} - 1 \\right|\n$$\n我们将分析每个模型中$\\nu_t$随$\\Delta$的标度关系。\n\n**1. Smagorinsky 模型**\n涡黏性为$\\nu_t = (C_s \\Delta)^2 |\\tilde{S}|$，其中$|\\tilde{S}| = \\sqrt{2 \\tilde{S}_{ij} \\tilde{S}_{ij}}$，$\\tilde{S}_{ij} = \\frac{1}{2}(g_{ij} + g_{ji})$。\n此处，$\\nu_t$与$\\Delta^2$成正比：$\\nu_t(\\Delta) \\propto \\Delta^2$。\n因此，如果$|\\tilde{S}| \\neq 0$：\n$$\nE_{\\mathrm{Smag}} = \\left| \\frac{(C_s \\Delta_V)^2 |\\tilde{S}|}{(C_s \\Delta_M)^2 |\\tilde{S}|} - 1 \\right| = \\left| \\frac{\\Delta_V^2}{\\Delta_M^2} - 1 \\right|\n$$\n如果$|\\tilde{S}| = 0$，则对所有$\\Delta$都有$\\nu_t = 0$，使得$|q|=0$，因此$E_{\\mathrm{Smag}}=0$。对于各向同性网格，$\\Delta_V = \\Delta_M$，所以$E_{\\mathrm{Smag}}=0$。\n\n**2. Dynamic Smagorinsky 模型**\n涡黏性为$\\nu_t = (C_s \\Delta)^2 |\\tilde{S}|$，但$C_s$现在是动态计算的。根据问题陈述，动态系数为：\n$$\nC_s^2(\\Delta) = \\max\\!\\left(0, \\frac{L_{ij} M_{ij}(\\Delta)}{2 M_{kl}(\\Delta) M_{kl}(\\Delta)}\\right)\n$$\n其中模型张量$M_{ij}(\\Delta) = \\widehat{-2 \\Delta^2 |\\tilde{S}| \\tilde{S}_{ij}} + 2 \\alpha^2 \\Delta^2 |\\widehat{\\tilde{S}}| \\, \\widehat{\\tilde{S}}_{ij}$。\n问题提供了简化：$\\widehat{\\tilde{S}}_{ij} = \\beta \\tilde{S}_{ij}$和$L_{ij} = \\zeta \\widehat{\\tilde{S}}_{ij} = \\zeta \\beta \\tilde{S}_{ij}$。\n为了继续进行，需要对项$\\widehat{|\\tilde{S}| \\tilde{S}_{ij}}$做一个假设。在此类分析中，标准的做法是假设滤波操作大致上对乘积满足分配律，即$\\widehat{|\\tilde{S}| \\tilde{S}_{ij}} \\approx |\\widehat{\\tilde{S}}| \\widehat{\\tilde{S}}_{ij}$。\n基于此，并注意到$|\\widehat{\\tilde{S}}| = \\sqrt{2 \\widehat{\\tilde{S}}_{pq}\\widehat{\\tilde{S}}_{pq}} = \\sqrt{2 \\beta^2 \\tilde{S}_{pq}\\tilde{S}_{pq}} = \\beta|\\tilde{S}|$，我们有$\\widehat{|\\tilde{S}| \\tilde{S}_{ij}} \\approx (\\beta|\\tilde{S}|)(\\beta \\tilde{S}_{ij}) = \\beta^2|\\tilde{S}|\\tilde{S}_{ij}$。\n将此代入$M_{ij}(\\Delta)$的表达式中：\n$$\nM_{ij}(\\Delta) \\approx -2 \\Delta^2 (\\beta^2 |\\tilde{S}| \\tilde{S}_{ij}) + 2 \\alpha^2 \\Delta^2 (\\beta|\\tilde{S}|) (\\beta \\tilde{S}_{ij}) = 2 \\Delta^2 \\beta^2 |\\tilde{S}| (\\alpha^2 - 1) \\tilde{S}_{ij}\n$$\n现在我们计算$C_s^2(\\Delta)$的分数部分：\n$L_{ij} M_{ij}(\\Delta) = \\sum_{i,j} (\\zeta \\beta \\tilde{S}_{ij}) (2 \\Delta^2 \\beta^2 |\\tilde{S}| (\\alpha^2 - 1) \\tilde{S}_{ij}) = 2 \\zeta \\beta^3 |\\tilde{S}| (\\alpha^2 - 1) \\Delta^2 (\\tilde{S}_{kl}\\tilde{S}_{kl})$。\n$2 M_{kl}(\\Delta) M_{kl}(\\Delta) = 2 \\sum_{k,l} (2 \\Delta^2 \\beta^2 |\\tilde{S}| (\\alpha^2 - 1) \\tilde{S}_{kl})^2 = 8 \\Delta^4 \\beta^4 |\\tilde{S}|^2 (\\alpha^2-1)^2 (\\tilde{S}_{mn}\\tilde{S}_{mn})$。\n$$\n\\frac{L_{ij} M_{ij}}{2 M_{kl} M_{kl}} = \\frac{2 \\zeta \\beta^3 |\\tilde{S}| (\\alpha^2-1) \\Delta^2}{8 \\Delta^4 \\beta^4 |\\tilde{S}|^2 (\\alpha^2-1)^2} = \\frac{\\zeta}{4 \\beta |\\tilde{S}| (\\alpha^2-1) \\Delta^2}\n$$\n假设此项为正，则$C_s^2(\\Delta) = \\frac{\\zeta}{4 \\beta |\\tilde{S}| (\\alpha^2-1) \\Delta^2}$。\n涡黏性则为：\n$$\n\\nu_t(\\Delta) = C_s^2(\\Delta) \\Delta^2 |\\tilde{S}| = \\left(\\frac{\\zeta}{4 \\beta |\\tilde{S}| (\\alpha^2-1) \\Delta^2}\\right) \\Delta^2 |\\tilde{S}| = \\frac{\\zeta}{4 \\beta (\\alpha^2-1)}\n$$\n值得注意的是，在这些简化假设下，$\\nu_t$与$\\Delta$无关。因此，$\\nu_t(\\Delta_V) = \\nu_t(\\Delta_M)$，这意味着$|q(\\Delta_V)| = |q(\\Delta_M)|$。误差表达式的分子为零。因此，对于所有测试用例，$E_{\\mathrm{Dyn}}=0$。\n\n**3. Wall-Adapting Local Eddy-viscosity (WALE) 模型**\n涡黏性为：\n$$\n\\nu_t = (C_w \\Delta)^2 \\, \\frac{\\left((S^{d})^2\\right)^{3/2}}{\\left(S^2\\right)^{5/2} + \\left((S^{d})^2\\right)^{5/4}}\n$$\n其中$S^2=\\tilde{S}_{ij}\\tilde{S}_{ij}$和$(S^d)^2=S^d_{ij}S^d_{ij}$，且$S^{d}_{ij} = \\tfrac{1}{2}(G_{ij} + G_{ji}) - \\tfrac{1}{3}\\delta_{ij} G_{kk}$和$G_{ij} = g_{ik}g_{kj}$。\n分数部分与$\\Delta$无关。令其为$\\mathcal{W}$。则$\\nu_t = (C_w \\Delta)^2 \\mathcal{W}$。\n与 Smagorinsky 模型类似，$\\nu_t \\propto \\Delta^2$。\n$$\nE_{\\mathrm{WALE}} = \\left| \\frac{\\Delta_V^2}{\\Delta_M^2} - 1 \\right|\n$$\n只要 WALE 应变项$\\mathcal{W}$非零，该结论就成立。如果$\\mathcal{W}=0$（当$S^d_{ij}$为零张量时发生），那么$\\nu_t=0$，$|q|=0$，且$E_{\\mathrm{WALE}}=0$。对于各向同性网格，$\\Delta_V = \\Delta_M$，所以$E_{\\mathrm{WALE}}=0$。\n\n**4. Scale-Similarity 模型**\nSGS 热通量大小$|q|$被直接建模为$\\|L^{\\theta}\\|_2$，其中$L^{\\theta}$是 Leonard 标量通量向量。该模型不依赖于$\\Delta$。\n因此，$|q(\\Delta_V)| = |q(\\Delta_M)| = \\|L^{\\theta}\\|_2$，误差恒为零：$E_{\\mathrm{SS}}=0$。\n\n**测试用例分析**\n\n**测试用例 1: 各向同性中等剪切**\n- 网格: $(\\Delta x, \\Delta y, \\Delta z) = (0.01, 0.01, 0.01)\\,\\mathrm{m}$。这是一个各向同性网格。\n- $\\Delta_M = 0.01\\,\\mathrm{m}$。\n- $\\Delta_V = (0.01^3)^{1/3} = 0.01\\,\\mathrm{m}$。\n由于$\\Delta_V = \\Delta_M$，比值$\\Delta_V^2/\\Delta_M^2 = 1$。对于所有模型，误差$E$均为$0$。\n- $E_{\\mathrm{Smag}} = 0$，$E_{\\mathrm{Dyn}} = 0$，$E_{\\mathrm{WALE}} = 0$，$E_{\\mathrm{SS}} = 0$。\n- 结果: $[0.0, 0.0, 0.0, 0.0]$。\n\n**测试用例 2: 高度各向异性，粗糙方向与T梯度对齐**\n- 网格: $(\\Delta x, \\Delta y, \\Delta z) = (0.002, 0.020, 0.050)\\,\\mathrm{m}$。\n- $\\Delta_M = 0.05\\,\\mathrm{m}$。\n- $\\Delta_V = (0.002 \\cdot 0.02 \\cdot 0.05)^{1/3} = (2 \\times 10^{-9})^{1/3} \\approx 0.0012599\\,\\mathrm{m}$。\n- 误差因子: $|\\frac{\\Delta_V^2}{\\Delta_M^2} - 1| = |(\\frac{0.0012599}{0.05})^2 - 1| \\approx |0.000635 - 1| \\approx 0.999365$。\n- Smagorinsky: $g_{ij}$中有$g_{12}=80, g_{23}=40$。$\\tilde{S}_{12}=40, \\tilde{S}_{21}=40, \\tilde{S}_{23}=20, \\tilde{S}_{32}=20$。$|\\tilde{S}|=\\sqrt{2(2\\cdot40^2 + 2\\cdot20^2)} = \\sqrt{8000} \\neq 0$。所以$E_{\\mathrm{Smag}} \\approx 0.999365$。\n- WALE: $g = \\begin{pmatrix} 0  80  0 \\\\ 0  0  40 \\\\ 0  0  0 \\end{pmatrix}$, $G=gg=\\begin{pmatrix} 0  0  3200 \\\\ 0  0  0 \\\\ 0  0  0 \\end{pmatrix}$。$G_{kk}=0$。$S^d = \\frac{1}{2}(G+G^T) = \\begin{pmatrix} 0  0  1600 \\\\ 0  0  0 \\\\ 1600  0  0 \\end{pmatrix}$。由于$S^d \\neq 0$，WALE 项非零。$E_{\\mathrm{WALE}} \\approx 0.999365$。\n- 结果: $[0.9993650401363183, 0.0, 0.9993650401363183, 0.0]$。\n\n**测试用例 3: 旋转主导，应变较小**\n- 网格: $(\\Delta x, \\Delta y, \\Delta z) = (0.010, 0.050, 0.050)\\,\\mathrm{m}$。\n- $\\Delta_M = 0.05\\,\\mathrm{m}$。\n- $\\Delta_V = (0.01 \\cdot 0.05 \\cdot 0.05)^{1/3} = (2.5 \\times 10^{-5})^{1/3} \\approx 0.029240\\,\\mathrm{m}$。\n- 误差因子: $|\\frac{\\Delta_V^2}{\\Delta_M^2} - 1| = |(\\frac{0.029240}{0.05})^2 - 1| \\approx |0.341995 - 1| \\approx 0.658005$。\n- Smagorinsky: $g_{11}=5, g_{22}=-5, g_{12}=300, g_{21}=-300$。$\\tilde{S}_{11}=5, \\tilde{S}_{22}=-5$，其他$\\tilde{S}_{ij}=0$。$|\\tilde{S}|=\\sqrt{2(5^2 + (-5)^2)} = 10 \\neq 0$。所以$E_{\\mathrm{Smag}} \\approx 0.658005$。\n- WALE: $g = \\begin{pmatrix} 5  300  0 \\\\ -300  -5  0 \\\\ 0  0  0 \\end{pmatrix}$, $G = gg = \\begin{pmatrix} -89975  0  0 \\\\ 0  -89975  0 \\\\ 0  0  0 \\end{pmatrix}$。$G_{kk} = -179950$。$S^d = G - \\frac{1}{3}I G_{kk} \\neq 0$。因此，WALE 项非零。$E_{\\mathrm{WALE}} \\approx 0.658005$。\n- 结果: $[0.6580049887114946, 0.0, 0.6580049887114946, 0.0]$。\n\n**测试用例 4: 接近零应变，强各向异性**\n- 网格: $(\\Delta x, \\Delta y, \\Delta z) = (0.005, 0.005, 0.100)\\,\\mathrm{m}$。\n- $\\Delta_M = 0.1\\,\\mathrm{m}$。\n- $\\Delta_V = (0.005 \\cdot 0.005 \\cdot 0.1)^{1/3} = (2.5 \\times 10^{-6})^{1/3} \\approx 0.013572\\,\\mathrm{m}$。\n- 误差因子: $|\\frac{\\Delta_V^2}{\\Delta_M^2} - 1| = |(\\frac{0.013572}{0.1})^2 - 1| \\approx |0.01842 - 1| \\approx 0.9815799$。\n- Smagorinsky: $g_{11}=1, g_{22}=1, g_{33}=1$。$\\tilde{S}=I$（单位矩阵）。$|\\tilde{S}| = \\sqrt{2(1^2+1^2+1^2)} = \\sqrt{6} \\neq 0$。所以$E_{\\mathrm{Smag}} \\approx 0.9815799$。\n- WALE: $g=I$, 所以$G = gg = I$。$G_{kk} = \\mathrm{tr}(I)=3$。$S^d = G - \\frac{1}{3}I G_{kk} = I - \\frac{1}{3}I(3) = I-I=0$。WALE 应变项为零。因此$\\nu_t=0$且$E_{\\mathrm{WALE}}=0$。这个案例突显了 Smagorinsky 和 WALE 模型之间的一个关键区别。\n- 结果: $[0.9815799184534942, 0.0, 0.0, 0.0]$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the relative error E for four SGS models based on different\n    filter width definitions for several test cases in LES.\n    \"\"\"\n\n    # Define constants from the problem statement.\n    # These are not used in the final simplified error calculation,\n    # but are included for completeness.\n    # C_s = 0.17\n    # C_w = 0.50\n    # Pr_t = 0.70\n    # alpha = 2.0\n\n    test_cases = [\n        {\n            \"name\": \"Isotropic moderate shear\",\n            \"deltas\": np.array([0.01, 0.01, 0.01]),\n            \"g\": np.array([[0., 100., 0.], [0., 0., 0.], [0., 0., 0.]]),\n            \"grad_T\": np.array([1000., 0., 0.])\n        },\n        {\n            \"name\": \"Highly anisotropic, coarse dir aligned with T-grad\",\n            \"deltas\": np.array([0.002, 0.020, 0.050]),\n            \"g\": np.array([[0., 80., 0.], [0., 0., 40.], [0., 0., 0.]]),\n            \"grad_T\": np.array([0., 0., 200.])\n        },\n        {\n            \"name\": \"Rotation-dominated with small strain\",\n            \"deltas\": np.array([0.010, 0.050, 0.050]),\n            \"g\": np.array([[5., 300., 0.], [-300., -5., 0.], [0., 0., 0.]]),\n            \"grad_T\": np.array([100., 100., 0.])\n        },\n        {\n            \"name\": \"Near-zero strain, strong anisotropy\",\n            \"deltas\": np.array([0.005, 0.005, 0.100]),\n            \"g\": np.array([[1., 0., 0.], [0., 1., 0.], [0., 0., 1.]]),\n            \"grad_T\": np.array([10., 10., 10.])\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        deltas = case[\"deltas\"]\n        g = case[\"g\"]\n\n        # Calculate filter widths\n        delta_V = np.prod(deltas)**(1/3)\n        delta_M = np.max(deltas)\n\n        # The error E for models with nu_t proportional to Delta^2 simplifies to\n        # |(delta_V/delta_M)^2 - 1|.\n        # This is zero if the grid is isotropic (delta_V == delta_M).\n        if delta_M == 0:\n            error_factor = 0.0\n        else:\n            error_factor = abs((delta_V/delta_M)**2 - 1)\n\n        # ---------- Model Calculations ----------\n\n        # 1. Smagorinsky Model\n        # E_smag depends on whether the strain rate magnitude |S| is zero.\n        S = 0.5 * (g + g.T)\n        S_sq_sum = np.sum(S**2) # S_ij * S_ij\n        S_mag_sq = 2 * S_sq_sum\n        \n        # If |S| = 0, nu_t = 0, so |q| = 0 and E is defined as 0.\n        E_smag = error_factor if S_mag_sq > 1e-20 else 0.0\n        \n        # 2. Dynamic Smagorinsky Model\n        # As derived in the solution, under the problem's simplifications,\n        # nu_t is independent of Delta. Thus, E_dyn is always 0.\n        E_dyn = 0.0\n\n        # 3. WALE Model\n        # E_wale depends on whether the WALE strain term is zero.\n        # This term is zero if S^d_ij is zero.\n        G = np.matmul(g, g)\n        G_kk = np.trace(G)\n        # We need the symmetric part of G for S^d\n        G_sym = 0.5 * (G + G.T)\n        S_d = G_sym - (1/3) * G_kk * np.identity(3)\n        S_d_sq_sum = np.sum(S_d**2)\n        \n        # Denominator of the WALE strain term\n        # A small epsilon is added for regularization, though S_mag_sq check is primary\n        wale_denom = S_sq_sum**(5/2) + S_d_sq_sum**(5/4) + 1e-20\n        wale_strain_term_numerator = S_d_sq_sum**(3/2)\n\n        # If the numerator is zero, nu_t = 0, so |q| = 0 and E is defined as 0.\n        E_wale = error_factor if wale_strain_term_numerator > 1e-20 else 0.0\n\n        # 4. Scale-Similarity Model\n        # |q| is independent of Delta, so E_ss is always 0.\n        E_ss = 0.0\n\n        errors = [E_smag, E_dyn, E_wale, E_ss]\n        all_results.append(errors)\n\n    # Format the results into the spec's required output string.\n    # Example: \"[[e11,e12,e13,e14],[e21,e22,e23,e24],...]\"\n    # The skeleton print statement implies no spaces, so I will build it manually.\n    results_as_str_lists = []\n    for res_list in all_results:\n        # Format each list of floats into a string like \"[f1,f2,f3,f4]\"\n        # Using map(str,...) to get default float representation.\n        str_list = f\"[{','.join(map(str, res_list))}]\"\n        results_as_str_lists.append(str_list)\n\n    final_output_str = f\"[{','.join(results_as_str_lists)}]\"\n\n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}