{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of many subgrid-scale (SGS) models is the eddy-viscosity hypothesis, which provides a direct link between the unresolved stresses and the resolved strain-rate field. This first practice provides a fundamental exercise in model validation: implementing the classic Smagorinsky model and performing an *a priori* test by comparing its predictions against high-fidelity Direct Numerical Simulation (DNS) data. By calculating key error metrics, you will gain hands-on experience in quantifying model performance and appreciating the foundational assumptions of SGS modeling .",
            "id": "3988250",
            "problem": "You are given the task of assessing the predictive capability of a widely used subgrid-scale closure in Large-Eddy Simulation (LES), the Smagorinsky model, for a steady shear flow. The focus is on the off-diagonal subgrid-scale (SGS) shear stress component $ \\tau_{12} $ and its dependence on the rate-of-strain magnitude $ \\lvert S \\rvert $. You must derive $ \\tau_{12} $ based on fundamental filtered equations and closure assumptions, implement the resulting prediction in a program, and compute quantitative error metrics against a priori Direct Numerical Simulation (DNS) data.\n\nStart from the filtered incompressible Navier–Stokes equations and the definition of the subgrid-scale stress tensor $ \\tau_{ij} $ and the resolved rate-of-strain tensor $ S_{ij} $. Use the statistical closure framework grounded in a physically justifiable hypothesis to obtain a model expression for $ \\tau_{12} $ in terms of the filter width $ \\Delta $, a dimensionless coefficient $ C_s $, the magnitude $ \\lvert S \\rvert $, and the shear component $ S_{12} $. Assume density-normalized (kinematic) SGS stress so that $ \\tau_{ij} $ is expressed in $ \\mathrm{m}^2/\\mathrm{s}^2 $. Explain the physical assumptions and the mathematical steps leading to the modeled $ \\tau_{12} $ for an incompressible shear flow.\n\nThen, implement your derived prediction in code and compare it against the provided a priori data from a Direct Numerical Simulation (DNS). For each test case, compute the following error metrics between the model prediction and the DNS data:\n- Mean absolute error (MAE), in $ \\mathrm{m}^2/\\mathrm{s}^2 $.\n- Root mean square error (RMSE), in $ \\mathrm{m}^2/\\mathrm{s}^2 $.\n- Coefficient of determination $ R^2 $ defined as the square of the Pearson correlation coefficient between the predicted and DNS arrays (dimensionless). In cases where both arrays have zero variance and are exactly equal, define $ R^2 = 1.0 $. If both have zero variance but are not equal, define $ R^2 = 0.0 $.\n\nYour program must evaluate the following test suite. Each test case supplies the filter width $ \\Delta $ in meters, the dimensionless coefficient $ C_s $, arrays of $ \\lvert S \\rvert $ and $ S_{12} $ in $ \\mathrm{s}^{-1} $, and the DNS $ \\tau_{12} $ in $ \\mathrm{m}^2/\\mathrm{s}^2 $. All quantities are given in International System of Units (SI).\n\nTest Case 1 (moderate shear, typical parameters):\n- $ \\Delta = 2.0 \\times 10^{-3} \\, \\mathrm{m} $, $ C_s = 0.16 $,\n- $ \\lvert S \\rvert = [20, 40, 60, 80, 100] \\, \\mathrm{s}^{-1} $,\n- $ S_{12} = [10, 20, 30, 40, 50] \\, \\mathrm{s}^{-1} $,\n- DNS $ \\tau_{12} = [-3.896\\times10^{-5}, -1.7384\\times10^{-4}, -3.6064\\times10^{-4}, -6.7036\\times10^{-4}, -1.014\\times10^{-3}] \\, \\mathrm{m}^2/\\mathrm{s}^2 $.\n\nTest Case 2 (boundary case with vanishing strain):\n- $ \\Delta = 2.0 \\times 10^{-3} \\, \\mathrm{m} $, $ C_s = 0.16 $,\n- $ \\lvert S \\rvert = [0, 0, 0, 0] \\, \\mathrm{s}^{-1} $,\n- $ S_{12} = [0, 0, 0, 0] \\, \\mathrm{s}^{-1} $,\n- DNS $ \\tau_{12} = [0, 0, 0, 0] \\, \\mathrm{m}^2/\\mathrm{s}^2 $.\n\nTest Case 3 (high shear with sign changes):\n- $ \\Delta = 3.0 \\times 10^{-3} \\, \\mathrm{m} $, $ C_s = 0.18 $,\n- $ \\lvert S \\rvert = [50, 100, 150, 200, 250] \\, \\mathrm{s}^{-1} $,\n- $ S_{12} = [-25, -50, 75, -100, 125] \\, \\mathrm{s}^{-1} $,\n- DNS $ \\tau_{12} = [1.229\\times10^{-3}, 2.516\\times10^{-3}, -5.961\\times10^{-3}, 1.0964\\times10^{-2}, -1.7225\\times10^{-2}] \\, \\mathrm{m}^2/\\mathrm{s}^2 $.\n\nTest Case 4 (small filter width and lower coefficient):\n- $ \\Delta = 1.0 \\times 10^{-3} \\, \\mathrm{m} $, $ C_s = 0.10 $,\n- $ \\lvert S \\rvert = [10, 20, 30, 40, 50] \\, \\mathrm{s}^{-1} $,\n- $ S_{12} = [5, 10, 15, 20, 25] \\, \\mathrm{s}^{-1} $,\n- DNS $ \\tau_{12} = [0.0, -4.5\\times10^{-6}, -7.0\\times10^{-6}, -1.7\\times10^{-5}, -2.5\\times10^{-5}] \\, \\mathrm{m}^2/\\mathrm{s}^2 $.\n\nYour program should compute the three error metrics for each of the four test cases. The final output must be a single line containing a comma-separated list of $ 12 $ floating-point numbers (four test cases times three metrics) enclosed in square brackets, ordered as:\n$ [\\mathrm{MAE}_1,\\mathrm{RMSE}_1,R^2_1,\\mathrm{MAE}_2,\\mathrm{RMSE}_2,R^2_2,\\mathrm{MAE}_3,\\mathrm{RMSE}_3,R^2_3,\\mathrm{MAE}_4,\\mathrm{RMSE}_4,R^2_4] $.\nAll MAE and RMSE values must be in $ \\mathrm{m}^2/\\mathrm{s}^2 $ and all $ R^2 $ values must be dimensionless.",
            "solution": "The problem as stated is scientifically sound, self-contained, and well-posed. It presents a standard a priori validation exercise for a foundational subgrid-scale (SGS) model in Large-Eddy Simulation (LES) of turbulent flows. All necessary physical parameters, data, and definitions for error metrics are provided without ambiguity or contradiction. Therefore, we may proceed with the derivation and solution.\n\n**1. Theoretical Derivation of the Smagorinsky Model for $ \\tau_{12} $**\n\nThe objective is to derive a model for the subgrid-scale (SGS) shear stress component $ \\tau_{12} $ for an incompressible flow.\n\n**1.1. Filtering and the Subgrid-Scale Stress Tensor**\n\nIn LES, the velocity field $ u_i $ is decomposed into a resolved (filtered) component, $ \\overline{u}_i $, and an unresolved (subgrid) component, $ u'_i $. The filtering operation is denoted by an overbar. The filtered incompressible Navier-Stokes equations contain a term that represents the effect of the unresolved scales on the resolved scales. This term is the divergence of the SGS stress tensor, $ \\tau_{ij} $, defined as:\n$$ \\tau_{ij} = \\overline{u_i u_j} - \\overline{u}_i \\overline{u}_j $$\nHere, $ \\tau_{ij} $ is a kinematic stress (units $ \\mathrm{m}^2/\\mathrm{s}^2 $) as density is assumed to be constant and absorbed into the pressure term. This tensor is symmetric ($ \\tau_{ij} = \\tau_{ji} $) but unknown, and must be modeled in terms of the resolved quantities.\n\n**1.2. The Boussinesq Hypothesis and Eddy Viscosity**\n\nThe Smagorinsky model, like many other SGS models, is based on the Boussinesq or \"eddy viscosity\" hypothesis. This hypothesis posits a linear relationship between the anisotropic part of the SGS stress tensor and the resolved rate-of-strain tensor, analogous to the relationship between viscous stress and strain rate in a Newtonian fluid.\n\nThe SGS stress tensor is decomposed into its isotropic part and its deviatoric (anisotropic) part, $ \\tau_{ij}^d $:\n$$ \\tau_{ij} = \\tau_{ij}^d + \\frac{1}{3}\\tau_{kk}\\delta_{ij} $$\nwhere $ \\tau_{kk} $ is the trace of the tensor (twice the SGS turbulent kinetic energy) and $ \\delta_{ij} $ is the Kronecker delta. The isotropic part is often absorbed into a modified pressure term in the momentum equation and does not directly contribute to momentum transport.\n\nThe Boussinesq hypothesis models the deviatoric part as:\n$$ \\tau_{ij}^d = -2\\nu_{SGS} \\overline{S}_{ij} $$\nwhere $ \\nu_{SGS} $ is the SGS eddy viscosity and $ \\overline{S}_{ij} $ is the resolved rate-of-strain tensor, defined as:\n$$ \\overline{S}_{ij} = \\frac{1}{2} \\left( \\frac{\\partial \\overline{u}_i}{\\partial x_j} + \\frac{\\partial \\overline{u}_j}{\\partial x_i} \\right) $$\nFor the off-diagonal shear stress component $ \\tau_{12} $, where $ i=1, j=2 $ ($ i \\neq j $), the isotropic part vanishes because $ \\delta_{12} = 0 $. Therefore, the model for $ \\tau_{12} $ is given directly by the deviatoric part:\n$$ \\tau_{12} = -2\\nu_{SGS} \\overline{S}_{12} $$\nThe problem statement uses the notation $ S_{ij} $ for the resolved rate-of-strain tensor, so we will adopt this notation, yielding $ \\tau_{12} = -2\\nu_{SGS} S_{12} $.\n\n**1.3. Modeling the Eddy Viscosity $ \\nu_{SGS} $**\n\nThe central contribution of Smagorinsky's model is the expression for $ \\nu_{SGS} $. It is derived from dimensional analysis, assuming that the SGS energy production is in local equilibrium with its dissipation. The eddy viscosity must have units of $ \\mathrm{m}^2/\\mathrm{s} $. It is constructed from a characteristic length scale and a characteristic velocity scale of the unresolved eddies.\n-   The characteristic length scale is taken to be the filter width, $ \\Delta $.\n-   The characteristic velocity scale is derived from the resolved field. The magnitude of the resolved rate-of-strain tensor, $ \\lvert S \\rvert = \\sqrt{2 S_{ij} S_{ij}} $, has units of $ \\mathrm{s}^{-1} $. Multiplying this by the length scale $ \\Delta $ gives a velocity scale: $ v' \\sim \\Delta \\lvert S \\rvert $.\n\nCombining these scales, the eddy viscosity is modeled as:\n$$ \\nu_{SGS} \\sim (\\text{length scale}) \\times (\\text{velocity scale}) \\sim \\Delta \\times (\\Delta \\lvert S \\rvert) = \\Delta^2 \\lvert S \\rvert $$\nIntroducing a dimensionless model coefficient, the Smagorinsky constant $ C_s $, gives the final form for the eddy viscosity:\n$$ \\nu_{SGS} = (C_s \\Delta)^2 \\lvert S \\rvert = C_s^2 \\Delta^2 \\lvert S \\rvert $$\n\n**1.4. Final Model Equation for $ \\tau_{12} $**\n\nSubstituting the expression for $ \\nu_{SGS} $ into the Boussinesq relation for $ \\tau_{12} $ gives the complete Smagorinsky model for the SGS shear stress:\n$$ \\tau_{12}^{\\text{model}} = -2 \\nu_{SGS} S_{12} = -2 \\left( C_s^2 \\Delta^2 \\lvert S \\rvert \\right) S_{12} $$\nThis is the equation to be implemented. It predicts the SGS shear stress using only resolved field quantities ($ \\lvert S \\rvert $, $ S_{12} $) and model parameters ($ C_s $, $ \\Delta $). The negative sign indicates that the model is purely dissipative; for a positive $ S_{12} $ and $ \\lvert S \\rvert $, it produces a negative $ \\tau_{12} $, corresponding to a stress that opposes the mean shear.\n\n**2. Error Metrics**\n\nThe following error metrics will be computed to compare the model prediction, $ y_{\\text{pred}} = \\tau_{12}^{\\text{model}} $, against the DNS data, $ y_{\\text{true}} = \\tau_{12}^{\\text{DNS}} $. For a set of $ N $ data points:\n-   **Mean Absolute Error (MAE):**\n    $$ \\mathrm{MAE} = \\frac{1}{N} \\sum_{i=1}^{N} | y_{\\text{pred},i} - y_{\\text{true},i} | $$\n-   **Root Mean Square Error (RMSE):**\n    $$ \\mathrm{RMSE} = \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} ( y_{\\text{pred},i} - y_{\\text{true},i} )^2} $$\n-   **Coefficient of Determination ($ R^2 $):** Defined as the square of the Pearson correlation coefficient, $ r $.\n    $$ r = \\frac{\\sum_{i=1}^{N} (y_{\\text{pred},i} - \\bar{y}_{\\text{pred}})(y_{\\text{true},i} - \\bar{y}_{\\text{true}})}{\\sqrt{\\sum_{i=1}^{N} (y_{\\text{pred},i} - \\bar{y}_{\\text{pred}})^2 \\sum_{i=1}^{N} (y_{\\text{true},i} - \\bar{y}_{\\text{true}})^2}} \\quad \\implies \\quad R^2 = r^2 $$\n    Special cases for zero variance are handled as specified in the problem statement. Specifically, if both predicted and true arrays have zero variance, $ R^2 = 1.0 $ if they are identical and $ R^2 = 0.0 $ otherwise.\n\nThe implementation will now proceed based on these derived formulae and defined metrics.",
            "answer": "```python\nimport numpy as np\n\ndef calculate_error_metrics(y_pred, y_true):\n    \"\"\"\n    Computes MAE, RMSE, and R^2 between predicted and true values.\n    \n    Args:\n        y_pred (np.ndarray): Array of predicted values.\n        y_true (np.ndarray): Array of true values.\n\n    Returns:\n        tuple: A tuple containing (mae, rmse, r_squared).\n    \"\"\"\n    # Mean Absolute Error (MAE)\n    mae = np.mean(np.abs(y_pred - y_true))\n\n    # Root Mean Square Error (RMSE)\n    rmse = np.sqrt(np.mean((y_pred - y_true)**2))\n\n    # Coefficient of Determination (R^2)\n    var_pred = np.var(y_pred)\n    var_true = np.var(y_true)\n\n    if var_pred == 0 and var_true == 0:\n        if np.all(y_pred == y_true):\n            r_squared = 1.0\n        else:\n            r_squared = 0.0\n    else:\n        # np.corrcoef returns a 2x2 matrix, the value at [0, 1] is the coefficient r.\n        # It can return nan if one of the inputs has zero variance. A simple check\n        # is sufficient since the case where both have zero variance is handled above.\n        if var_pred == 0 or var_true == 0:\n             # Correlation is typically undefined if one variable is constant.\n             # This can lead to a divide-by-zero warning in np.corrcoef.\n             # Given the problem context, if one has variance and the other doesn't,\n             # they are not well correlated. We can assign 0.\n             r_squared = 0.0\n        else:\n            r_matrix = np.corrcoef(y_pred, y_true)\n            r = r_matrix[0, 1]\n            r_squared = r**2\n\n    return mae, rmse, r_squared\n\ndef smagorinsky_model_tau12(Cs, Delta, S_mag, S_12):\n    \"\"\"\n    Calculates the SGS shear stress tau_12 using the Smagorinsky model.\n    \n    Args:\n        Cs (float): Smagorinsky constant.\n        Delta (float): Filter width.\n        S_mag (np.ndarray): Magnitude of the resolved rate-of-strain tensor.\n        S_12 (np.ndarray): Shear component of the resolved rate-of-strain tensor.\n\n    Returns:\n        np.ndarray: The modeled SGS shear stress tau_12.\n    \"\"\"\n    return -2.0 * (Cs * Delta)**2 * S_mag * S_12\n\ndef solve():\n    \"\"\"\n    Main function to process test cases and compute error metrics.\n    \"\"\"\n    test_cases = [\n        {\n            \"Delta\": 2.0e-3, \"Cs\": 0.16,\n            \"S_mag\": np.array([20, 40, 60, 80, 100]),\n            \"S_12\": np.array([10, 20, 30, 40, 50]),\n            \"dns_tau_12\": np.array([-3.896e-5, -1.7384e-4, -3.6064e-4, -6.7036e-4, -1.014e-3])\n        },\n        {\n            \"Delta\": 2.0e-3, \"Cs\": 0.16,\n            \"S_mag\": np.array([0, 0, 0, 0]),\n            \"S_12\": np.array([0, 0, 0, 0]),\n            \"dns_tau_12\": np.array([0, 0, 0, 0])\n        },\n        {\n            \"Delta\": 3.0e-3, \"Cs\": 0.18,\n            \"S_mag\": np.array([50, 100, 150, 200, 250]),\n            \"S_12\": np.array([-25, -50, 75, -100, 125]),\n            \"dns_tau_12\": np.array([1.229e-3, 2.516e-3, -5.961e-3, 1.0964e-2, -1.7225e-2])\n        },\n        {\n            \"Delta\": 1.0e-3, \"Cs\": 0.10,\n            \"S_mag\": np.array([10, 20, 30, 40, 50]),\n            \"S_12\": np.array([5, 10, 15, 20, 25]),\n            \"dns_tau_12\": np.array([0.0, -4.5e-6, -7.0e-6, -1.7e-5, -2.5e-5])\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        # Calculate the model prediction for tau_12\n        model_tau_12 = smagorinsky_model_tau12(\n            case[\"Cs\"],\n            case[\"Delta\"],\n            case[\"S_mag\"],\n            case[\"S_12\"]\n        )\n\n        # Compute the error metrics against the DNS data\n        mae, rmse, r_squared = calculate_error_metrics(model_tau_12, case[\"dns_tau_12\"])\n\n        # Append metrics to the results list\n        all_results.extend([mae, rmse, r_squared])\n\n    # Format the final output string\n    print(f\"[{','.join(f'{r:.7g}' for r in all_results)}]\")\n\n# Execute the solver\nsolve()\n```"
        },
        {
            "introduction": "While the standard Smagorinsky model provides a robust closure in the core of a turbulent flow, it famously fails near solid boundaries where viscous effects dominate and turbulent structures are damped. This practice delves into this critical issue by exploring the role of near-wall damping functions, which are essential for correcting model behavior in the viscous sublayer. By implementing and comparing the classic van Driest damping function with an algebraic alternative, you will directly assess how different modeling strategies impact the prediction of wall shear stress, a quantity of paramount importance in many engineering applications .",
            "id": "3988249",
            "problem": "Consider a one-dimensional representation of fully developed turbulent channel flow under the Large-Eddy Simulation (LES) paradigm at friction Reynolds number $Re_\\tau \\approx 180$. Let the channel half-height be $h$, the kinematic viscosity be $\\nu$, the friction velocity be $u_\\tau = \\sqrt{\\tau_w/\\rho}$, and the density be $\\rho$. In such a flow, the mean streamwise momentum equation simplifies to a linear total shear stress distribution across the channel height, which can be written as $ \\tau_\\text{tot}(y) = \\rho u_\\tau^2 \\left(1 - \\frac{y}{h}\\right) $, where the total stress is the sum of the viscous stress and the modeled turbulent (subgrid-scale) stress, i.e., $ \\tau_\\text{tot}(y) = \\rho \\nu \\frac{dU}{dy} + \\rho \\nu_t \\frac{dU}{dy}$. Assume a spatially filtered, eddy-viscosity closure for the subgrid-scale stress of the Smagorinsky type, $ \\nu_t = f_w(y^+) \\left(C_s \\Delta\\right)^2 \\left|\\frac{dU}{dy}\\right| $, where $C_s$ is the Smagorinsky constant, $\\Delta$ is the filter width identified with the grid spacing, and $f_w(y^+)$ is a near-wall damping function expressed in terms of the wall units $y^+ = \\frac{y u_\\tau}{\\nu}$. Two distinct damping formulations are to be compared:\n- The van Driest damping function $ f_\\text{vd}(y^+) = \\left(1 - \\exp\\left(-\\frac{y^+}{A^+}\\right)\\right)^2 $, with parameter $A^+$.\n- An algebraic damping function $ f_\\text{alg}(y^+) = \\frac{y^+}{y^+ + B^+} $, with parameter $B^+$.\n\nUsing the mean momentum balance, the eddy-viscosity closure, and the no-slip boundary condition at the wall, derive the local algebraic relationship at a given wall-normal location $y$ for the mean shear $ G(y) = \\frac{dU}{dy} $ in terms of $ \\nu $, $ \\nu_t(G,y) $, and the total stress distribution. Then, for a uniform grid with spacing $ \\Delta y = \\frac{h}{N} $ and the first off-wall cell-center located at $ y_1 = \\frac{\\Delta y}{2} $, define the predicted viscous wall shear stress as the near-wall viscous contribution evaluated at $ y_1 $ using the local mean shear, namely $ \\tau_w^\\text{pred} = \\rho \\nu G(y_1) $. This proxy quantifies what a near-wall gradient method would infer from the resolved velocity at the first off-wall location.\n\nAssume $ h = 1 $ and nondimensionalize by setting $ \\rho = 1 $, $ u_\\tau = 1 $, so that $ \\nu = \\frac{1}{Re_\\tau} $ and the true wall shear stress is $ \\tau_w = \\rho u_\\tau^2 = 1 $ in these units. Adopt $ \\Delta = \\Delta y $ and $ C_s = 0.17 $. For each damping formulation $ f_w(y^+) $ and for each grid resolution $N$, compute $ \\tau_w^\\text{pred} $ at $ y_1 $ by solving the algebraic relation for $ G(y_1) $ implied by the coupling of the total stress and the eddy-viscosity model, and then forming $ \\tau_w^\\text{pred} = \\nu G(y_1) $.\n\nYour program must implement this procedure for the following test suite:\n- Case 1 (coarse grid): $ Re_\\tau = 180 $, $ N = 8 $, $ A^+ = 26 $, $ B^+ = 50 $.\n- Case 2 (moderate grid): $ Re_\\tau = 180 $, $ N = 32 $, $ A^+ = 26 $, $ B^+ = 50 $.\n- Case 3 (fine grid): $ Re_\\tau = 180 $, $ N = 128 $, $ A^+ = 26 $, $ B^+ = 50 $.\n\nFor each case, compute two floats: the normalized predicted viscous wall shear stress using van Driest damping, and using algebraic damping. Express all shear stresses in units of $ \\rho u_\\tau^2 $ (i.e., dimensionless), and do not include any unit symbols in the output. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as $ [\\tau_{w,\\text{vd}}^\\text{pred}(\\text{Case 1}), \\tau_{w,\\text{alg}}^\\text{pred}(\\text{Case 1}), \\tau_{w,\\text{vd}}^\\text{pred}(\\text{Case 2}), \\tau_{w,\\text{alg}}^\\text{pred}(\\text{Case 2}), \\tau_{w,\\text{vd}}^\\text{pred}(\\text{Case 3}), \\tau_{w,\\text{alg}}^\\text{pred}(\\text{Case 3})] $.\n\nEnsure scientific realism by adhering to the stated modeling assumptions, and design your algorithm to solve the local algebraic coupling between the mean shear and the eddy viscosity without introducing any ad hoc shortcuts beyond the specified definitions. The final outputs for each test case must be floats. Angles are not involved in this problem.",
            "solution": "The problem is assessed as valid, being scientifically grounded in the principles of turbulence modeling for Large-Eddy Simulation (LES), well-posed, and objective. The provided data and parameters are consistent and standard for the study of turbulent channel flow.\n\nThe primary objective is to compute the predicted viscous wall shear stress, $\\tau_w^\\text{pred}$, at three different grid resolutions using two different near-wall damping functions for a Smagorinsky-type subgrid-scale (SGS) model. This involves solving a local algebraic equation for the mean velocity gradient.\n\nFirst, we establish the governing equation relating the mean shear stress to the mean velocity gradient, $G(y) = \\frac{dU}{dy}$. The total shear stress, $\\tau_\\text{tot}(y)$, in a fully developed turbulent channel flow is the sum of the viscous stress, $\\tau_\\nu = \\rho \\nu G(y)$, and the modeled SGS stress, $\\tau_t = \\rho \\nu_t G(y)$, where $\\nu_t$ is the eddy viscosity.\n$$\n\\tau_\\text{tot}(y) = \\rho (\\nu + \\nu_t) G(y)\n$$\nThe problem provides the linear total stress distribution and the Smagorinsky model for the eddy viscosity:\n$$\n\\tau_\\text{tot}(y) = \\rho u_\\tau^2 \\left(1 - \\frac{y}{h}\\right)\n$$\n$$\n\\nu_t = f_w(y^+) (C_s \\Delta)^2 \\left|\\frac{dU}{dy}\\right| = f_w(y^+) (C_s \\Delta)^2 |G(y)|\n$$\nHere, $f_w(y^+)$ is a damping function dependent on the wall-normal distance in wall units, $y^+ = \\frac{y u_\\tau}{\\nu}$. In the near-wall region ($y0$), the mean velocity gradient $G(y)$ is positive, so we can set $|G(y)| = G(y)$. Substituting the expression for $\\nu_t$ into the total stress equation yields:\n$$\n\\tau_\\text{tot}(y) = \\rho \\left( \\nu + f_w(y^+) (C_s \\Delta)^2 G(y) \\right) G(y)\n$$\nThis equation can be rearranged into a standard quadratic form for $G(y)$, $a G(y)^2 + b G(y) + c = 0$:\n$$\n\\left( \\rho f_w(y^+) (C_s \\Delta)^2 \\right) G(y)^2 + (\\rho \\nu) G(y) - \\tau_\\text{tot}(y) = 0\n$$\nThe coefficients are:\n$a = \\rho f_w(y^+) (C_s \\Delta)^2$\n$b = \\rho \\nu$\n$c = -\\tau_\\text{tot}(y)$\n\nThe physically meaningful solution for the positive shear gradient $G(y)$ is obtained from the quadratic formula by choosing the positive root:\n$$\nG(y) = \\frac{-b + \\sqrt{b^2 - 4ac}}{2a}\n$$\nThe problem specifies the use of non-dimensional units where $h=1$, $\\rho=1$, and $u_\\tau=1$. This simplifies the parameters:\n- Kinematic viscosity: $\\nu = \\frac{h u_\\tau}{Re_\\tau} = \\frac{1}{Re_\\tau}$\n- Total stress: $\\tau_\\text{tot}(y) = 1 \\cdot 1^2 \\left(1 - \\frac{y}{1}\\right) = 1 - y$\n- Grid spacing (filter width): $\\Delta = \\Delta y = \\frac{h}{N} = \\frac{1}{N}$\n\nWe are tasked to evaluate the shear at the first off-wall grid cell-center, $y_1 = \\frac{\\Delta y}{2} = \\frac{1}{2N}$. At this location:\n- The wall coordinate is $y_1^+ = \\frac{y_1 u_\\tau}{\\nu} = \\frac{1/(2N)}{1/Re_\\tau} = \\frac{Re_\\tau}{2N}$.\n- The total stress is $\\tau_\\text{tot}(y_1) = 1 - y_1 = 1 - \\frac{1}{2N}$.\n\nThe coefficients of the quadratic equation, with $\\rho=1$, become:\n- $a = f_w(y_1^+) (C_s/N)^2$\n- $b = 1/Re_\\tau$\n- $c = -(1 - 1/(2N))$\n\nWe solve for $G(y_1)$ using these coefficients, where the damping function $f_w(y_1^+)$ is one of two forms:\n1.  van Driest damping: $f_\\text{vd}(y_1^+) = \\left(1 - \\exp\\left(-\\frac{y_1^+}{A^+}\\right)\\right)^2$\n2.  Algebraic damping: $f_\\text{alg}(y_1^+) = \\frac{y_1^+}{y_1^+ + B^+}$\n\nFinally, the predicted viscous wall shear stress, $\\tau_w^\\text{pred}$, is defined as the near-wall viscous contribution, $\\tau_w^\\text{pred} = \\rho \\nu G(y_1)$. In our non-dimensional units, this is $\\tau_w^\\text{pred} = \\nu G(y_1) = \\frac{G(y_1)}{Re_\\tau}$. The problem asks for this value normalized by $\\rho u_\\tau^2 = 1$, so the final quantity is simply $\\frac{G(y_1)}{Re_\\tau}$.\n\nThe algorithm for each test case is as follows:\n1.  Set the case parameters: $Re_\\tau$, $N$, $A^+$, $B^+$.\n2.  Set constants: $C_s = 0.17$.\n3.  Calculate the location-specific parameters: $\\nu = 1/Re_\\tau$, $y_1 = 1/(2N)$, $y_1^+ = Re_\\tau/(2N)$.\n4.  For both damping functions, $f_\\text{vd}$ and $f_\\text{alg}$:\n    a. Calculate the value of the damping function $f_w(y_1^+)$.\n    b. Define the quadratic coefficients $a = f_w(y_1^+) (C_s/N)^2$, $b = \\nu$, and $c = -(1-y_1)$.\n    c. Solve for the shear rate $G(y_1)$ using the quadratic formula: $G(y_1) = \\frac{-b + \\sqrt{b^2 - 4ac}}{2a}$.\n    d. Compute the predicted wall shear stress: $\\tau_w^\\text{pred} = \\nu G(y_1)$.\n5.  Collect the two computed values of $\\tau_w^\\text{pred}$ for the case.\n6.  Repeat for all test cases and format the results as a single list.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the predicted viscous wall shear stress in a turbulent channel flow\n    using two different LES damping models for a range of grid resolutions.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Re_tau, N, A_plus, B_plus)\n        (180, 8, 26, 50),\n        (180, 32, 26, 50),\n        (180, 128, 26, 50)\n    ]\n\n    # Universal constants from the problem.\n    # h = 1, rho = 1, u_tau = 1.\n    Cs = 0.17  # Smagorinsky constant\n\n    results = []\n\n    def calculate_predicted_shear(Re_tau, N, A_plus, B_plus):\n        \"\"\"\n        Calculates predicted wall shear for a single case with both damping models.\n        \"\"\"\n        # Derived parameters in non-dimensional units\n        nu = 1.0 / Re_tau\n        y1 = 1.0 / (2.0 * N)\n        y1_plus = Re_tau / (2.0 * N)\n        \n        # Total stress at y1\n        tau_tot_y1 = 1.0 - y1\n\n        # Common quadratic coefficient 'b'. Note rho=1.\n        b = nu\n        # Common quadratic coefficient 'c'\n        c = -tau_tot_y1\n\n        # --- van Driest Damping ---\n        f_vd = (1.0 - np.exp(-y1_plus / A_plus))**2\n        \n        # Quadratic coefficient 'a' for van Driest\n        a_vd = f_vd * (Cs / N)**2\n        \n        # Solve quadratic equation for G = dU/dy\n        # a*G^2 + b*G + c = 0\n        discriminant_vd = b**2 - 4 * a_vd * c\n        # The physically meaningful root is the positive one for G.\n        G_vd = (-b + np.sqrt(discriminant_vd)) / (2.0 * a_vd)\n        \n        # Predicted viscous wall shear stress (normalized by rho*u_tau^2 = 1)\n        tau_w_pred_vd = nu * G_vd\n\n        # --- Algebraic Damping ---\n        f_alg = y1_plus / (y1_plus + B_plus)\n        \n        # Quadratic coefficient 'a' for algebraic damping\n        a_alg = f_alg * (Cs / N)**2\n        \n        # Solve quadratic equation for G = dU/dy\n        discriminant_alg = b**2 - 4 * a_alg * c\n        G_alg = (-b + np.sqrt(discriminant_alg)) / (2.0 * a_alg)\n\n        # Predicted viscous wall shear stress\n        tau_w_pred_alg = nu * G_alg\n        \n        return tau_w_pred_vd, tau_w_pred_alg\n\n    for case in test_cases:\n        Re_tau, N, A_plus, B_plus = case\n        tau_vd, tau_alg = calculate_predicted_shear(Re_tau, N, A_plus, B_plus)\n        results.append(tau_vd)\n        results.append(tau_alg)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Bridging the gap between theory and real-world application requires addressing the practicalities of implementation within a computational fluid dynamics framework. A crucial and often overlooked detail is the definition of the filter width, $\\Delta$, especially on the anisotropic meshes commonly used to resolve boundary layers in complex geometries. This final practice explores how the choice between a volume-based and a maximum-spacing-based filter width affects the SGS heat flux predictions of several key models, including the Smagorinsky, WALE, and dynamic models. This exercise underscores the critical interplay between the numerical grid and the physical model, developing your intuition for robust LES implementation .",
            "id": "3988263",
            "problem": "Consider Large-Eddy Simulation (LES) of incompressible flow with heat transfer on anisotropic meshes in computational thermal engineering. The filtered momentum and energy equations introduce subgrid-scale (SGS) closures for unresolved stresses and scalar fluxes. Let the filtered velocity gradient tensor be $g_{ij} = \\partial \\tilde{u}_i / \\partial x_j$ and the resolved strain-rate tensor be $S_{ij} = \\tfrac{1}{2}(g_{ij} + g_{ji})$. The resolved temperature gradient vector is $\\nabla \\tilde{T}$ with components $G_j = \\partial \\tilde{T} / \\partial x_j$. The SGS eddy viscosity is denoted by $\\nu_t$ and the SGS thermal diffusivity by $\\alpha_t$, with $\\alpha_t = \\nu_t / \\mathrm{Pr}_t$ where $\\mathrm{Pr}_t$ is the turbulent Prandtl number. The modeled SGS scalar heat flux vector is $q_j = -\\alpha_t G_j$.\n\nYou will evaluate the impact of different filter width definitions $\\Delta$ on the predicted SGS heat flux magnitude for four closure models: Smagorinsky, Dynamic Smagorinsky, Wall-Adapting Local Eddy-viscosity (WALE), and Scale-Similarity for scalar flux. Two mesh-based definitions of the filter width $\\Delta$ must be compared for anisotropic cells:\n- Volume-based: $\\Delta_V = (\\Delta x \\, \\Delta y \\, \\Delta z)^{1/3}$.\n- Maximum-spacing-based: $\\Delta_M = \\max(\\Delta x, \\Delta y, \\Delta z)$.\n\nFor each model, compute the SGS eddy viscosity $\\nu_t(\\Delta)$ and the resulting SGS heat flux magnitude $|q(\\Delta)| = \\alpha_t(\\Delta)\\, \\|\\nabla \\tilde{T}\\|_2$, where $\\|\\cdot\\|_2$ denotes the Euclidean norm. Using $|q(\\Delta_M)|$ as the reference, define the relative error introduced by using the volume-based $\\Delta_V$ as\n$$\nE = \\frac{\\big|\\,|q(\\Delta_V)| - |q(\\Delta_M)|\\,\\big|}{|q(\\Delta_M)|},\n$$\nwhich is dimensionless and must be reported as a decimal number. If $|q(\\Delta_M)| = 0$, define $E = 0$.\n\nModel closures to use:\n- Smagorinsky model: $\\nu_t = (C_s \\Delta)^2 \\, |S|$, with $|S| = \\sqrt{2 S_{ij} S_{ij}}$ and $C_s$ a constant.\n- Dynamic Smagorinsky model using the Germano identity (deviatoric parts): define the Leonard stress $L_{ij}$ and the test-filter ratio $\\alpha > 1$. Use the model tensor\n$$\nM_{ij} = \\widehat{-2 \\Delta^2 |S| S_{ij}} + 2 \\alpha^2 \\Delta^2 |\\widehat{S}| \\, \\widehat{S}_{ij},\n$$\nwhere the hat denotes test filtering. Compute $C_s^2$ by minimizing the error in the Germano identity,\n$$\nC_s^2 = \\max\\!\\left(0, \\frac{L_{ij} M_{ij}}{2 M_{ij} M_{ij}}\\right),\n$$\nthen $\\nu_t = (C_s \\Delta)^2 |S|$. Assume the provided $L_{ij}$ and $\\widehat{S}_{ij}$ are consistent with the resolved field.\n- Wall-Adapting Local Eddy-viscosity (WALE) model: define $G_{ij} = g_{ik} g_{kj}$ and the traceless symmetric part $S^{d}_{ij} = \\tfrac{1}{2}(G_{ij} + G_{ji}) - \\tfrac{1}{3}\\delta_{ij} G_{kk}$. Let $S^2 = S_{ij} S_{ij}$ and $(S^{d})^2 = S^{d}_{ij} S^{d}_{ij}$. Use\n$$\n\\nu_t = (C_w \\Delta)^2 \\, \\frac{\\left((S^{d})^2\\right)^{3/2}}{\\left(S^2\\right)^{5/2} + \\left((S^{d})^2\\right)^{5/4}},\n$$\nwith $C_w$ a constant. Use a small positive regularization for the denominator if necessary to avoid division by zero.\n- Scale-Similarity scalar flux: model the SGS scalar flux via the Leonard scalar flux vector $L^{\\theta}_j = \\widetilde{\\theta u_j} - \\tilde{\\theta}\\,\\tilde{u}_j$, and take $|q| = \\|L^{\\theta}\\|_2$. This is independent of $\\Delta$, so using either $\\Delta_V$ or $\\Delta_M$ yields the same $|q|$ and thus $E = 0$.\n\nConstants to use in all test cases:\n- Smagorinsky constant $C_s = 0.17$.\n- WALE constant $C_w = 0.50$.\n- Turbulent Prandtl number $\\mathrm{Pr}_t = 0.70$.\n- Test-filter ratio $\\alpha = 2$.\n\nImplement a program that, for each test case, computes the relative error $E$ for each model using the formulas above. Your program must produce the final results for all test cases as a single line in the specified format. All outputs are dimensionless decimals.\n\nTest suite inputs:\n- Each test case provides $(\\Delta x, \\Delta y, \\Delta z)$ in $\\mathrm{m}$, a $3\\times 3$ tensor $g_{ij}$ in $\\mathrm{s}^{-1}$, a temperature gradient vector $\\nabla \\tilde{T}$ in $\\mathrm{K/m}$, a scalar $\\beta$ defining $\\widehat{S}_{ij} = \\beta S_{ij}$, a scalar $\\zeta$ defining $L_{ij} = \\zeta \\,\\widehat{S}_{ij}$, and a Leonard scalar flux vector $L^{\\theta}$ in $\\mathrm{K\\,m/s}$.\n- Test cases:\n    1. Isotropic moderate shear:\n        - $(\\Delta x, \\Delta y, \\Delta z) = (0.01, 0.01, 0.01)$ $\\mathrm{m}$.\n        - $g_{ij}$: $g_{12} = 100$ $\\mathrm{s}^{-1}$, others $0$.\n        - $\\nabla \\tilde{T} = (1000, 0, 0)$ $\\mathrm{K/m}$.\n        - $\\beta = 0.80$, $\\zeta = 0.010$.\n        - $L^{\\theta} = (0.010, 0.000, 0.000)$ $\\mathrm{K\\,m/s}$.\n    2. Highly anisotropic, coarse direction aligned with temperature gradient:\n        - $(\\Delta x, \\Delta y, \\Delta z) = (0.002, 0.020, 0.050)$ $\\mathrm{m}$.\n        - $g_{ij}$: $g_{12} = 80$, $g_{23} = 40$ $\\mathrm{s}^{-1}$, others $0$.\n        - $\\nabla \\tilde{T} = (0, 0, 200)$ $\\mathrm{K/m}$.\n        - $\\beta = 0.60$, $\\zeta = 0.020$.\n        - $L^{\\theta} = (0.000, 0.000, 0.020)$ $\\mathrm{K\\,m/s}$.\n    3. Rotation-dominated with small strain:\n        - $(\\Delta x, \\Delta y, \\Delta z) = (0.010, 0.050, 0.050)$ $\\mathrm{m}$.\n        - $g_{ij}$: $g_{12} = 300$, $g_{21} = -300$, $g_{11} = 5$, $g_{22} = -5$ $\\mathrm{s}^{-1}$, others $0$.\n        - $\\nabla \\tilde{T} = (100, 100, 0)$ $\\mathrm{K/m}$.\n        - $\\beta = 0.90$, $\\zeta = 0.005$.\n        - $L^{\\theta} = (0.005, 0.005, 0.000)$ $\\mathrm{K\\,m/s}$.\n    4. Near-zero strain, strong anisotropy:\n        - $(\\Delta x, \\Delta y, \\Delta z) = (0.005, 0.005, 0.100)$ $\\mathrm{m}$.\n        - $g_{ij}$: $g_{11} = 1$, $g_{22} = 1$, $g_{33} = 1$ $\\mathrm{s}^{-1}$, others $0$.\n        - $\\nabla \\tilde{T} = (10, 10, 10)$ $\\mathrm{K/m}$.\n        - $\\beta = 0.50$, $\\zeta = 0.001$.\n        - $L^{\\theta} = (0.0001, 0.0001, 0.0001)$ $\\mathrm{K\\,m/s}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case maps to one four-element list of the errors $[E_{\\mathrm{Smag}}, E_{\\mathrm{Dyn}}, E_{\\mathrm{WALE}}, E_{\\mathrm{SS}}]$ in that order. For example, the final program output should look like\n$[\\,[e_{11},e_{12},e_{13},e_{14}],\\,[e_{21},e_{22},e_{23},e_{24}],\\,[e_{31},e_{32},e_{33},e_{34}],\\,[e_{41},e_{42},e_{43},e_{44}]\\,]$\nwith decimal values.",
            "solution": "The problem requires an analysis of the sensitivity of several subgrid-scale (SGS) models to the definition of the filter width, $\\Delta$, on anisotropic computational meshes. The relative error, $E$, is to be computed for the magnitude of the SGS heat flux, $|q|$, when using a volume-based filter width, $\\Delta_V$, versus a maximum-spacing-based filter width, $\\Delta_M$.\n\nThe problem is scientifically well-posed and the specified models—Smagorinsky, Dynamic Smagorinsky, WALE, and Scale-Similarity—are standard closures in Large-Eddy Simulation (LES). All necessary data and constants for a complete analysis are provided. A single ambiguity in the formulation of the dynamic model can be resolved by employing a standard simplification, which I will detail in the corresponding section. Therefore, the problem is deemed valid.\n\nThe SGS heat flux vector is modeled as $q_j = -\\alpha_t G_j$, where $\\alpha_t = \\nu_t / \\mathrm{Pr}_t$ is the SGS thermal diffusivity, $\\nu_t$ is the SGS eddy viscosity, $\\mathrm{Pr}_t$ is the turbulent Prandtl number, and $G_j = \\partial \\tilde{T} / \\partial x_j$ are the components of the resolved temperature gradient, $\\nabla \\tilde{T}$.\n\nThe magnitude of the SGS heat flux is $|q(\\Delta)| = \\alpha_t(\\Delta) \\|\\nabla \\tilde{T}\\|_2$, where $\\|\\nabla \\tilde{T}\\|_2 = \\sqrt{G_j G_j}$ is the Euclidean norm of the temperature gradient. The filter width $\\Delta$ is model-dependent and can be either $\\Delta_V = (\\Delta x \\Delta y \\Delta z)^{1/3}$ or $\\Delta_M = \\max(\\Delta x, \\Delta y, \\Delta z)$.\n\nThe relative error $E$ is defined as:\n$$\nE = \\frac{\\big|\\,|q(\\Delta_V)| - |q(\\Delta_M)|\\,\\big|}{|q(\\Delta_M)|}\n$$\nIf $|q(\\Delta_M)| = 0$, $E$ is defined to be $0$. Assuming $|q(\\Delta_M)| \\neq 0$, we can substitute the expression for $|q(\\Delta)|$:\n$$\nE = \\frac{\\left| \\frac{\\nu_t(\\Delta_V)}{\\mathrm{Pr}_t} \\|\\nabla \\tilde{T}\\|_2 - \\frac{\\nu_t(\\Delta_M)}{\\mathrm{Pr}_t} \\|\\nabla \\tilde{T}\\|_2 \\right|}{\\frac{\\nu_t(\\Delta_M)}{\\mathrm{Pr}_t} \\|\\nabla \\tilde{T}\\|_2}\n$$\nThe terms $\\mathrm{Pr}_t$ and $\\|\\nabla \\tilde{T}\\|_2$ are constant for a given test case and cancel out, provided $\\|\\nabla \\tilde{T}\\|_2 \\neq 0$ and $\\nu_t(\\Delta_M) \\neq 0$. This simplifies the error expression to be dependent only on the eddy viscosity:\n$$\nE = \\left| \\frac{\\nu_t(\\Delta_V)}{\\nu_t(\\Delta_M)} - 1 \\right|\n$$\nWe will analyze the scaling of $\\nu_t$ with $\\Delta$ for each model.\n\n**1. Smagorinsky Model**\nThe eddy viscosity is $\\nu_t = (C_s \\Delta)^2 |S|$, where $|S| = \\sqrt{2 S_{ij} S_{ij}}$ and $S_{ij} = \\frac{1}{2}(\\partial_j \\tilde{u}_i + \\partial_i \\tilde{u}_j)$.\nHere, $\\nu_t$ is directly proportional to $\\Delta^2$: $\\nu_t(\\Delta) \\propto \\Delta^2$.\nThus, if $|S| \\neq 0$:\n$$\nE_{\\mathrm{Smag}} = \\left| \\frac{(C_s \\Delta_V)^2 |S|}{(C_s \\Delta_M)^2 |S|} - 1 \\right| = \\left| \\frac{\\Delta_V^2}{\\Delta_M^2} - 1 \\right|\n$$\nIf $|S| = 0$, then $\\nu_t = 0$ for all $\\Delta$, making $|q|=0$ and thus $E_{\\mathrm{Smag}}=0$. For an isotropic grid, $\\Delta_V = \\Delta_M$, so $E_{\\mathrm{Smag}}=0$.\n\n**2. Dynamic Smagorinsky Model**\nThe eddy viscosity is $\\nu_t = (C_s \\Delta)^2 |S|$, but $C_s$ is now computed dynamically. Based on the problem statement, the dynamic coefficient is:\n$$\nC_s^2(\\Delta) = \\max\\!\\left(0, \\frac{L_{ij} M_{ij}(\\Delta)}{2 M_{kl}(\\Delta) M_{kl}(\\Delta)}\\right)\n$$\nwith model tensor $M_{ij}(\\Delta) = \\widehat{-2 \\Delta^2 |S| S_{ij}} + 2 \\alpha^2 \\Delta^2 |\\widehat{S}| \\, \\widehat{S}_{ij}$.\nThe problem provides simplifications: $\\widehat{S}_{ij} = \\beta S_{ij}$ and $L_{ij} = \\zeta \\widehat{S}_{ij} = \\zeta \\beta S_{ij}$.\nTo proceed, an assumption is required for the term $\\widehat{|S| S_{ij}}$. It is standard practice in such analyses to assume the filter operation approximately distributes over the product, i.e., $\\widehat{|S| S_{ij}} \\approx |\\widehat{S}| \\widehat{S}_{ij}$.\nWith this, and noting $|\\widehat{S}| = \\sqrt{2 \\widehat{S}_{pq}\\widehat{S}_{pq}} = \\sqrt{2 \\beta^2 S_{pq}S_{pq}} = \\beta|S|$, we have $\\widehat{|S| S_{ij}} \\approx (\\beta|S|)(\\beta S_{ij}) = \\beta^2|S|S_{ij}$.\nSubstituting this into the expression for $M_{ij}(\\Delta)$:\n$$\nM_{ij}(\\Delta) \\approx -2 \\Delta^2 (\\beta^2 |S| S_{ij}) + 2 \\alpha^2 \\Delta^2 (\\beta|S|) (\\beta S_{ij}) = 2 \\Delta^2 \\beta^2 |S| (\\alpha^2 - 1) S_{ij}\n$$\nNow we evaluate the fraction for $C_s^2(\\Delta)$:\n$L_{ij} M_{ij}(\\Delta) = \\sum_{i,j} (\\zeta \\beta S_{ij}) (2 \\Delta^2 \\beta^2 |S| (\\alpha^2 - 1) S_{ij}) = 2 \\zeta \\beta^3 |S| (\\alpha^2 - 1) \\Delta^2 (S_{kl}S_{kl})$.\n$2 M_{kl}(\\Delta) M_{kl}(\\Delta) = 2 \\sum_{k,l} (2 \\Delta^2 \\beta^2 |S| (\\alpha^2 - 1) S_{kl})^2 = 8 \\Delta^4 \\beta^4 |S|^2 (\\alpha^2-1)^2 (S_{mn}S_{mn})$.\n$$\n\\frac{L_{ij} M_{ij}}{2 M_{kl} M_{kl}} = \\frac{2 \\zeta \\beta^3 |S| (\\alpha^2-1) \\Delta^2}{8 \\Delta^4 \\beta^4 |S|^2 (\\alpha^2-1)^2} = \\frac{\\zeta}{4 \\beta |S| (\\alpha^2-1) \\Delta^2}\n$$\nAssuming this term is positive, $C_s^2(\\Delta) = \\frac{\\zeta}{4 \\beta |S| (\\alpha^2-1) \\Delta^2}$.\nThe eddy viscosity is then:\n$$\n\\nu_t(\\Delta) = C_s^2(\\Delta) \\Delta^2 |S| = \\left(\\frac{\\zeta}{4 \\beta |S| (\\alpha^2-1) \\Delta^2}\\right) \\Delta^2 |S| = \\frac{\\zeta}{4 \\beta (\\alpha^2-1)}\n$$\nRemarkably, under these simplifying assumptions, $\\nu_t$ is independent of $\\Delta$. Consequently, $\\nu_t(\\Delta_V) = \\nu_t(\\Delta_M)$, which implies $|q(\\Delta_V)| = |q(\\Delta_M)|$. The numerator of the error expression is zero. Thus, $E_{\\mathrm{Dyn}}=0$ for all test cases.\n\n**3. Wall-Adapting Local Eddy-viscosity (WALE) Model**\nThe eddy viscosity is:\n$$\n\\nu_t = (C_w \\Delta)^2 \\, \\frac{\\left((S^{d})^2\\right)^{3/2}}{\\left(S^2\\right)^{5/2} + \\left((S^{d})^2\\right)^{5/4}}\n$$\nwhere $S^2=S_{ij}S_{ij}$ and $(S^d)^2=S^d_{ij}S^d_{ij}$, with $S^{d}_{ij} = \\tfrac{1}{2}(G_{ij} + G_{ji}) - \\tfrac{1}{3}\\delta_{ij} G_{kk}$ and $G_{ij} = g_{ik}g_{kj}$.\nThe fraction component is independent of $\\Delta$. Let this be $\\mathcal{W}$. Then $\\nu_t = (C_w \\Delta)^2 \\mathcal{W}$.\nSimilar to the Smagorinsky model, $\\nu_t \\propto \\Delta^2$.\n$$\nE_{\\mathrm{WALE}} = \\left| \\frac{\\Delta_V^2}{\\Delta_M^2} - 1 \\right|\n$$\nThis holds provided the WALE strain term $\\mathcal{W}$ is non-zero. If $\\mathcal{W}=0$ (which occurs if $S^d_{ij}$ is the zero tensor), then $\\nu_t=0$, $|q|=0$, and $E_{\\mathrm{WALE}}=0$. For an isotropic grid, $\\Delta_V = \\Delta_M$, so $E_{\\mathrm{WALE}}=0$.\n\n**4. Scale-Similarity Model**\nThe SGS heat flux magnitude $|q|$ is directly modeled as $\\|L^{\\theta}\\|_2$, where $L^{\\theta}$ is the Leonard scalar flux vector. This model does not depend on $\\Delta$.\nTherefore, $|q(\\Delta_V)| = |q(\\Delta_M)| = \\|L^{\\theta}\\|_2$, and the error is identically zero: $E_{\\mathrm{SS}}=0$.\n\n**Analysis of Test Cases**\n\n**Test Case 1: Isotropic moderate shear**\n- Grid: $(\\Delta x, \\Delta y, \\Delta z) = (0.01, 0.01, 0.01)\\,\\mathrm{m}$. This is an isotropic grid.\n- $\\Delta_M = 0.01\\,\\mathrm{m}$.\n- $\\Delta_V = (0.01^3)^{1/3} = 0.01\\,\\mathrm{m}$.\nSince $\\Delta_V = \\Delta_M$, the ratio $\\Delta_V^2/\\Delta_M^2 = 1$. The error $E$ is $0$ for all models.\n- $E_{\\mathrm{Smag}} = 0$, $E_{\\mathrm{Dyn}} = 0$, $E_{\\mathrm{WALE}} = 0$, $E_{\\mathrm{SS}} = 0$.\n- Result: $[0.0, 0.0, 0.0, 0.0]$.\n\n**Test Case 2: Highly anisotropic, coarse direction aligned with T-gradient**\n- Grid: $(\\Delta x, \\Delta y, \\Delta z) = (0.002, 0.020, 0.050)\\,\\mathrm{m}$.\n- $\\Delta_M = 0.05\\,\\mathrm{m}$.\n- $\\Delta_V = (0.002 \\cdot 0.02 \\cdot 0.05)^{1/3} = (2 \\times 10^{-9})^{1/3} \\approx 0.0012599\\,\\mathrm{m}$.\n- Error Factor: $|\\frac{\\Delta_V^2}{\\Delta_M^2} - 1| = |(\\frac{0.0012599}{0.05})^2 - 1| \\approx |0.000635 - 1| \\approx 0.999365$.\n- Dynamics: $g_{ij}$ has $g_{12}=80, g_{23}=40$. $S_{12}=40, S_{21}=40, S_{23}=20, S_{32}=20$. $|S|=\\sqrt{2(2\\cdot40^2 + 2\\cdot20^2)} = \\sqrt{8000} \\neq 0$. So $E_{\\mathrm{Smag}} \\approx 0.999365$.\n- For WALE, $g = \\tiny\\begin{pmatrix} 0  80  0 \\\\ 0  0  40 \\\\ 0  0  0 \\end{pmatrix}$, $G=gg=\\tiny\\begin{pmatrix} 0  0  3200 \\\\ 0  0  0 \\\\ 0  0  0 \\end{pmatrix}$. $G_{kk}=0$. $S^d = \\frac{1}{2}(G+G^T) = \\tiny\\begin{pmatrix} 0  0  1600 \\\\ 0  0  0 \\\\ 1600  0  0 \\end{pmatrix}$. Since $S^d \\neq 0$, the WALE term is non-zero. $E_{\\mathrm{WALE}} \\approx 0.999365$.\n- Result: $[0.9993650401363183, 0.0, 0.9993650401363183, 0.0]$.\n\n**Test Case 3: Rotation-dominated with small strain**\n- Grid: $(\\Delta x, \\Delta y, \\Delta z) = (0.010, 0.050, 0.050)\\,\\mathrm{m}$.\n- $\\Delta_M = 0.05\\,\\mathrm{m}$.\n- $\\Delta_V = (0.01 \\cdot 0.05 \\cdot 0.05)^{1/3} = (2.5 \\times 10^{-5})^{1/3} \\approx 0.029240\\,\\mathrm{m}$.\n- Error Factor: $|\\frac{\\Delta_V^2}{\\Delta_M^2} - 1| = |(\\frac{0.029240}{0.05})^2 - 1| \\approx |0.341995 - 1| \\approx 0.658005$.\n- Dynamics: $g_{11}=5, g_{22}=-5, g_{12}=300, g_{21}=-300$. $S_{11}=5, S_{22}=-5$, other $S_{ij}=0$. $|S|=\\sqrt{2(5^2 + (-5)^2)} = 10 \\neq 0$. So $E_{\\mathrm{Smag}} \\approx 0.658005$.\n- For WALE, $g = \\tiny\\begin{pmatrix} 5  300  0 \\\\ -300  -5  0 \\\\ 0  0  0 \\end{pmatrix}$, $G = gg = \\tiny\\begin{pmatrix} -89975  0  0 \\\\ 0  -89975  0 \\\\ 0  0  0 \\end{pmatrix}$. $G_{kk} = -179950$. $S^d = G - \\frac{1}{3}I G_{kk} \\neq 0$. Thus, the WALE term is non-zero. $E_{\\mathrm{WALE}} \\approx 0.658005$.\n- Result: $[0.6580049887114946, 0.0, 0.6580049887114946, 0.0]$.\n\n**Test Case 4: Near-zero strain, strong anisotropy**\n- Grid: $(\\Delta x, \\Delta y, \\Delta z) = (0.005, 0.005, 0.100)\\,\\mathrm{m}$.\n- $\\Delta_M = 0.1\\,\\mathrm{m}$.\n- $\\Delta_V = (0.005 \\cdot 0.005 \\cdot 0.1)^{1/3} = (2.5 \\times 10^{-6})^{1/3} \\approx 0.013572\\,\\mathrm{m}$.\n- Error Factor: $|\\frac{\\Delta_V^2}{\\Delta_M^2} - 1| = |(\\frac{0.013572}{0.1})^2 - 1| \\approx |0.01842 - 1| \\approx 0.9815799$.\n- Dynamics: $g_{11}=1, g_{22}=1, g_{33}=1$. $S=I$ (identity matrix). $|S| = \\sqrt{2(1^2+1^2+1^2)} = \\sqrt{6} \\neq 0$. So $E_{\\mathrm{Smag}} \\approx 0.9815799$.\n- For WALE, $g=I$, so $G = gg = I$. $G_{kk} = \\mathrm{tr}(I)=3$. $S^d = G - \\frac{1}{3}I G_{kk} = I - \\frac{1}{3}I(3) = I-I=0$. The WALE strain term is zero. Thus, $\\nu_t=0$ and $E_{\\mathrm{WALE}}=0$. This case highlights a key difference between Smagorinsky and WALE models.\n- Result: $[0.9815799184534942, 0.0, 0.0, 0.0]$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the relative error E for four SGS models based on different\n    filter width definitions for several test cases in LES.\n    \"\"\"\n\n    # Define constants from the problem statement.\n    # These are not used in the final simplified error calculation,\n    # but are included for completeness.\n    # C_s = 0.17\n    # C_w = 0.50\n    # Pr_t = 0.70\n    # alpha = 2.0\n\n    test_cases = [\n        {\n            \"name\": \"Isotropic moderate shear\",\n            \"deltas\": np.array([0.01, 0.01, 0.01]),\n            \"g\": np.array([[0., 100., 0.], [0., 0., 0.], [0., 0., 0.]]),\n            \"grad_T\": np.array([1000., 0., 0.])\n        },\n        {\n            \"name\": \"Highly anisotropic, coarse dir aligned with T-grad\",\n            \"deltas\": np.array([0.002, 0.020, 0.050]),\n            \"g\": np.array([[0., 80., 0.], [0., 0., 40.], [0., 0., 0.]]),\n            \"grad_T\": np.array([0., 0., 200.])\n        },\n        {\n            \"name\": \"Rotation-dominated with small strain\",\n            \"deltas\": np.array([0.010, 0.050, 0.050]),\n            \"g\": np.array([[5., 300., 0.], [-300., -5., 0.], [0., 0., 0.]]),\n            \"grad_T\": np.array([100., 100., 0.])\n        },\n        {\n            \"name\": \"Near-zero strain, strong anisotropy\",\n            \"deltas\": np.array([0.005, 0.005, 0.100]),\n            \"g\": np.array([[1., 0., 0.], [0., 1., 0.], [0., 0., 1.]]),\n            \"grad_T\": np.array([10., 10., 10.])\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        deltas = case[\"deltas\"]\n        g = case[\"g\"]\n\n        # Calculate filter widths\n        delta_V = np.prod(deltas)**(1/3)\n        delta_M = np.max(deltas)\n\n        # The error E for models with nu_t proportional to Delta^2 simplifies to\n        # |(delta_V/delta_M)^2 - 1|.\n        # This is zero if the grid is isotropic (delta_V == delta_M).\n        if delta_M == 0:\n            error_factor = 0.0\n        else:\n            error_factor = abs((delta_V/delta_M)**2 - 1)\n\n        # ---------- Model Calculations ----------\n\n        # 1. Smagorinsky Model\n        # E_smag depends on whether the strain rate magnitude |S| is zero.\n        S = 0.5 * (g + g.T)\n        S_sq_sum = np.sum(S**2) # S_ij * S_ij\n        S_mag_sq = 2 * S_sq_sum\n        \n        # If |S| = 0, nu_t = 0, so |q| = 0 and E is defined as 0.\n        E_smag = error_factor if S_mag_sq > 1e-20 else 0.0\n        \n        # 2. Dynamic Smagorinsky Model\n        # As derived in the solution, under the problem's simplifications,\n        # nu_t is independent of Delta. Thus, E_dyn is always 0.\n        E_dyn = 0.0\n\n        # 3. WALE Model\n        # E_wale depends on whether the WALE strain term is zero.\n        # This term is zero if S^d_ij is zero.\n        G = np.matmul(g, g)\n        G_kk = np.trace(G)\n        # We need the symmetric part of G for S^d\n        G_sym = 0.5 * (G + G.T)\n        S_d = G_sym - (1/3) * G_kk * np.identity(3)\n        S_d_sq_sum = np.sum(S_d**2)\n        \n        # Denominator of the WALE strain term\n        # A small epsilon is added for regularization, though S_mag_sq check is primary\n        wale_denom = S_sq_sum**(5/2) + S_d_sq_sum**(5/4) + 1e-20\n        wale_strain_term_numerator = S_d_sq_sum**(3/2)\n\n        # If the numerator is zero, nu_t = 0, so |q| = 0 and E is defined as 0.\n        E_wale = error_factor if wale_strain_term_numerator > 1e-20 else 0.0\n\n        # 4. Scale-Similarity Model\n        # |q| is independent of Delta, so E_ss is always 0.\n        E_ss = 0.0\n\n        errors = [E_smag, E_dyn, E_wale, E_ss]\n        all_results.append(errors)\n\n    # Format the results into the spec's required output string.\n    # Example: \"[[e11,e12,e13,e14],[e21,e22,e23,e24],...]\"\n    # The skeleton print statement implies no spaces, so I will build it manually.\n    results_as_str_lists = []\n    for res_list in all_results:\n        # Format each list of floats into a string like \"[f1,f2,f3,f4]\"\n        # Using map(str,...) to get default float representation.\n        str_list = f\"[{','.join(map(str, res_list))}]\"\n        results_as_str_lists.append(str_list)\n\n    final_output_str = f\"[{','.join(results_as_str_lists)}]\"\n\n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}