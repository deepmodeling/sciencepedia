{
    "hands_on_practices": [
        {
            "introduction": "The foundation of many interface capturing methods, such as the Volume of Fluid (VOF) method, is the numerical solution of an advection equation for a phase indicator function. This first exercise provides a concrete, hands-on calculation to solidify the mechanics of a fundamental finite volume update scheme. By manually advancing a simple square wave, you will gain a tangible understanding of how an interface moves across a discrete grid and the direct impact of the Courant–Friedrichs–Lewy (CFL) number on the solution .",
            "id": "3964146",
            "problem": "A one-dimensional Volume of Fluid (VOF) indicator function $F(x,t)$, representing the liquid volume fraction and bounded in $[0,1]$, satisfies the conservation law for passive advection by a constant velocity field $u$: $\\partial F / \\partial t + \\partial (u F) / \\partial x = 0$. Consider a uniform finite volume mesh with $N=12$ cells, periodic boundary conditions, and cell-averaged values $F_{i}^{n}$ at time level $t^{n}$ for integer indices $i \\in \\{1,2,\\dots,12\\}$. The mesh spacing is $\\Delta x = 1.0 \\times 10^{-3}\\ \\mathrm{m}$, the velocity is $u = 2.0\\ \\mathrm{m/s}$, and the time step is $\\Delta t = 3.0 \\times 10^{-4}\\ \\mathrm{s}$. The Courant–Friedrichs–Lewy (CFL) number is defined as $\\alpha = u \\Delta t / \\Delta x$. The initial data is a square wave,\n- $F_{i}^{0} = 1$ for $i \\in \\{4,5,6,7\\}$,\n- $F_{i}^{0} = 0$ for all other $i$,\nwith periodic indexing (e.g., $F_{0}^{0} \\equiv F_{12}^{0}$, $F_{13}^{0} \\equiv F_{1}^{0}$).\n\nUsing an explicit conservative finite volume update with the first-order upwind (donor-cell) numerical flux, which is a bounded upwind scheme, advance the solution by one time step and compute the updated volume fraction in cell $i=8$, namely $F_{8}^{1}$, as a pure number. Express your final answer as an exact numerical value without units and without rounding.",
            "solution": "The problem requires the calculation of an updated cell-averaged value of a Volume of Fluid (VOF) indicator function, $F(x,t)$, governed by a one-dimensional linear advection equation. The problem is discretized using a conservative finite volume method.\n\nThe governing partial differential equation for the advection of the passive scalar $F$ with a constant velocity $u$ is given as:\n$$\n\\frac{\\partial F}{\\partial t} + \\frac{\\partial (u F)}{\\partial x} = 0\n$$\nSince $u$ is constant, this simplifies to $\\frac{\\partial F}{\\partial t} + u \\frac{\\partial F}{\\partial x} = 0$.\nThe finite volume method begins with the integral form of the conservation law over a control volume (cell) $i$, which spans from the interface $x_{i-1/2}$ to $x_{i+1/2}$, with a width of $\\Delta x = x_{i+1/2} - x_{i-1/2}$. Integrating the equation over cell $i$ gives:\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial F}{\\partial t} \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial (uF)}{\\partial x} \\,dx = 0\n$$\nDefining the cell-averaged value $F_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} F(x,t) \\,dx$ and applying the fundamental theorem of calculus to the spatial derivative term, we get:\n$$\n\\frac{d(F_i \\Delta x)}{dt} + (uF)_{i+1/2} - (uF)_{i-1/2} = 0\n$$\nSince $\\Delta x$ is constant, this becomes:\n$$\n\\frac{dF_i}{dt} + \\frac{1}{\\Delta x} \\left( (uF)_{i+1/2} - (uF)_{i-1/2} \\right) = 0\n$$\nHere, $(uF)_{i \\pm 1/2}$ represents the flux of $F$ at the cell interfaces. We discretize this equation in time using an explicit forward Euler scheme:\n$$\n\\frac{F_i^{n+1} - F_i^n}{\\Delta t} + \\frac{1}{\\Delta x} \\left( \\mathcal{F}_{i+1/2} - \\mathcal{F}_{i-1/2} \\right) = 0\n$$\nwhere $F_i^n$ is the cell-averaged value at time $t^n$, and $\\mathcal{F}_{i \\pm 1/2}$ are the numerical fluxes at the cell faces, evaluated at time $t^n$. Rearranging for $F_i^{n+1}$ yields the conservative update formula:\n$$\nF_i^{n+1} = F_i^n - \\frac{\\Delta t}{\\Delta x} \\left( \\mathcal{F}_{i+1/2} - \\mathcal{F}_{i-1/2} \\right)\n$$\nThe problem specifies a first-order upwind (donor-cell) scheme for the numerical flux. The velocity is given as $u = 2.0\\ \\mathrm{m/s}$, which is positive. For $u > 0$, the flow is from left to right, so the value of $F$ at an interface is taken from the cell to the left (the \"upwind\" or \"donor\" cell).\nThus, the numerical fluxes at the right and left faces of cell $i$ are:\n$$\n\\mathcal{F}_{i+1/2} = u F_i^n\n$$\n$$\n\\mathcal{F}_{i-1/2} = u F_{i-1}^n\n$$\nSubstituting these expressions into the update formula:\n$$\nF_i^{n+1} = F_i^n - \\frac{\\Delta t}{\\Delta x} \\left( u F_i^n - u F_{i-1}^n \\right)\n$$\nWe define the Courant–Friedrichs–Lewy (CFL) number as $\\alpha = \\frac{u \\Delta t}{\\Delta x}$. The update equation becomes:\n$$\nF_i^{n+1} = F_i^n - \\alpha \\left( F_i^n - F_{i-1}^n \\right) = (1 - \\alpha)F_i^n + \\alpha F_{i-1}^n\n$$\nThis is the explicit update equation for the first-order upwind scheme with positive velocity.\n\nNow, we must compute the value of $\\alpha$ from the given data:\n- Velocity: $u = 2.0\\ \\mathrm{m/s}$\n- Time step: $\\Delta t = 3.0 \\times 10^{-4}\\ \\mathrm{s}$\n- Mesh spacing: $\\Delta x = 1.0 \\times 10^{-3}\\ \\mathrm{m}$\n\n$$\n\\alpha = \\frac{(2.0) \\times (3.0 \\times 10^{-4})}{1.0 \\times 10^{-3}} = \\frac{6.0 \\times 10^{-4}}{1.0 \\times 10^{-3}} = 6.0 \\times 10^{-1} = 0.6\n$$\nThe problem asks for $F_8^1$, which is the volume fraction in cell $i=8$ after one time step, starting from $n=0$. Using the update formula with $i=8$ and $n=0$:\n$$\nF_8^1 = (1 - \\alpha)F_8^0 + \\alpha F_7^0\n$$\nWe need the initial values $F_8^0$ and $F_7^0$. The problem states the initial condition as a square wave:\n- $F_i^0 = 1$ for $i \\in \\{4, 5, 6, 7\\}$\n- $F_i^0 = 0$ for all other $i$\n\nFrom this definition:\n- For cell $i=8$, since $8 \\notin \\{4, 5, 6, 7\\}$, the initial value is $F_8^0 = 0$.\n- For cell $i=7$, since $7 \\in \\{4, 5, 6, 7\\}$, the initial value is $F_7^0 = 1$.\n\nSubstituting these values, along with $\\alpha = 0.6$, into the update equation for $F_8^1$:\n$$\nF_8^1 = (1 - 0.6) \\times F_8^0 + 0.6 \\times F_7^0\n$$\n$$\nF_8^1 = (0.4) \\times (0) + 0.6 \\times (1)\n$$\n$$\nF_8^1 = 0 + 0.6\n$$\n$$\nF_8^1 = 0.6\n$$\nThe updated volume fraction in cell $i=8$ after one time step is $0.6$. The periodic boundary conditions are not required for this specific calculation, as the stencils for cell $8$ (i.e., cells $7$ and $8$) do not cross the domain boundaries.",
            "answer": "$$\\boxed{0.6}$$"
        },
        {
            "introduction": "Beyond simply advecting the interface, a robust multiphase solver must accurately model the physical properties within cells that contain a mixture of fluids. This analytical practice delves into this crucial modeling aspect by examining how to define an effective viscosity in a mixed cell. By deriving the error associated with common arithmetic and harmonic averaging schemes for a classic Couette flow problem, you will discover the profound impact that the choice of interpolation has on the physical accuracy of the simulation, particularly the calculation of shear stress at the interface .",
            "id": "3964117",
            "problem": "Consider two immiscible, incompressible, Newtonian fluids undergoing steady planar Couette flow between two infinite parallel plates separated by a distance $H$. The lower plate at $y=0$ is stationary and the upper plate at $y=H$ translates in the $x$-direction with speed $U$. The interface between the fluids is planar and located at $y=fH$, with $0  f  1$. The lower fluid (phase $1$) occupies $0 \\le y \\le fH$ and has dynamic viscosity $\\mu_{1}$; the upper fluid (phase $2$) occupies $fH \\le y \\le H$ and has dynamic viscosity $\\mu_{2}$. Define the viscosity ratio $m = \\mu_{2}/\\mu_{1} > 0$.\n\nYou are modeling this configuration with an interface capturing method, such as the Volume of Fluid (VOF) method, in which one computational cell of thickness $H$ is “mixed” across the interface and is assigned a single effective viscosity $\\mu_{\\text{avg}}$ computed from the phase fraction $f$. Two common interpolation choices for $\\mu_{\\text{avg}}$ are:\n- Arithmetic averaging: $\\mu_{A} = f\\,\\mu_{1} + (1-f)\\,\\mu_{2}$.\n- Harmonic averaging: $\\mu_{H} = \\left(f/\\mu_{1} + (1-f)/\\mu_{2}\\right)^{-1}$.\n\nAssume negligible inertia and no pressure gradient, and take the constitutive law for Newtonian fluids in planar shear to be $\\tau_{xy}=\\mu\\,\\frac{du}{dy}$, where $u(y)$ is the streamwise velocity and $\\tau_{xy}$ is the shear stress. Starting from conservation of linear momentum and the no-slip boundary conditions, derive the exact shear stress $\\tau_{\\text{true}}$ transmitted through the layers. Then, under the single-cell mixed-property model that treats the cell as a uniform medium of viscosity $\\mu_{\\text{avg}}$, the solver computes a uniform shear rate consistent with the plate kinematics and predicts $\\tau_{\\text{num}}=\\mu_{\\text{avg}}\\,\\frac{U}{H}$. Using this modeling assumption, derive the dimensionless relative error in shear stress\n$$\nE = \\frac{\\tau_{\\text{num}} - \\tau_{\\text{true}}}{\\tau_{\\text{true}}},\n$$\nfor each interpolation choice $\\mu_{\\text{avg}}=\\mu_{A}$ and $\\mu_{\\text{avg}}=\\mu_{H}$.\n\nExpress your final answers as closed-form analytic expressions in terms of $f$ and $m$. Because the requested quantities are dimensionless, report them without units. Present the two results, $(E_{A},E_{H})$, as a single row matrix. No numerical evaluation is required.",
            "solution": "The problem is first validated against the specified criteria.\n\n### Step 1: Extract Givens\n- **System**: Two immiscible, incompressible, Newtonian fluids in steady planar Couette flow.\n- **Geometry**: Two infinite parallel plates separated by a distance $H$. Lower plate at $y=0$, upper plate at $y=H$.\n- **Kinematics**: Lower plate is stationary, $u(0)=0$. Upper plate moves at speed $U$, $u(H)=U$.\n- **Fluid 1 (Lower)**: Occupies $0 \\leq y \\leq fH$, has dynamic viscosity $\\mu_{1}$.\n- **Fluid 2 (Upper)**: Occupies $fH \\leq y \\leq H$, has dynamic viscosity $\\mu_{2}$.\n- **Interface**: Planar, located at $y=fH$, where $0  f  1$.\n- **Viscosity Ratio**: $m = \\mu_{2}/\\mu_{1}  0$.\n- **Flow Conditions**: Negligible inertia (creeping flow) and no pressure gradient.\n- **Constitutive Law**: Shear stress $\\tau_{xy}=\\mu\\,\\frac{du}{dy}$.\n- **Numerical Model**: Single-cell, mixed-property model with effective viscosity $\\mu_{\\text{avg}}$.\n- **Averaging Methods**:\n  - Arithmetic: $\\mu_{A} = f\\,\\mu_{1} + (1-f)\\,\\mu_{2}$.\n  - Harmonic: $\\mu_{H} = \\left(f/\\mu_{1} + (1-f)/\\mu_{2}\\right)^{-1}$.\n- **Numerical Stress**: The solver computes $\\tau_{\\text{num}}=\\mu_{\\text{avg}}\\,\\frac{U}{H}$.\n- **Required Output**: The dimensionless relative error $E = \\frac{\\tau_{\\text{num}} - \\tau_{\\text{true}}}{\\tau_{\\text{true}}}$ for each averaging choice, expressed in terms of $f$ and $m$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem describes a classical case of laminar fluid dynamics (stratified Couette flow), which is firmly based on the Navier-Stokes equations under well-defined simplifying assumptions (steady, incompressible, no inertia, no pressure gradient). The concepts of arithmetic and harmonic averaging for effective properties are standard in the field of computational multiphase flow and homogenization theory. The problem is scientifically sound.\n- **Well-Posed**: The problem provides all necessary boundary conditions ($u(0)=0$, $u(H)=U$) and interface conditions (continuity of velocity and stress) to solve for the velocity profile and shear stress. The setup is complete and consistent, ensuring a unique and meaningful solution exists.\n- **Objective**: The problem is stated using precise, unambiguous mathematical and physical terminology. There are no subjective or opinion-based elements.\n\n### Step 3: Verdict and Action\nThe problem is deemed valid as it is scientifically grounded, well-posed, and objective. A solution will be derived.\n\n### Derivation of the Exact Shear Stress $\\tau_{\\text{true}}$\nFor steady, fully developed, planar flow with only $x$-direction velocity $u(y)$ and no pressure gradient, the conservation of linear momentum equation simplifies to:\n$$\n\\frac{d}{dy}\\left(\\mu \\frac{du}{dy}\\right) = 0\n$$\nThis equation implies that the shear stress, $\\tau_{xy} = \\mu \\frac{du}{dy}$, must be constant throughout the entire domain $0 \\leq y \\leq H$. We denote this constant, exact shear stress as $\\tau_{\\text{true}}$.\n\nIn each fluid layer, the velocity gradient is constant:\n- For fluid $1$ ($0 \\leq y \\leq fH$): $\\frac{du_1}{dy} = \\frac{\\tau_{\\text{true}}}{\\mu_1}$.\n- For fluid $2$ ($fH \\leq y \\leq H$): $\\frac{du_2}{dy} = \\frac{\\tau_{\\text{true}}}{\\mu_2}$.\n\nIntegrating these equations with respect to $y$ gives the velocity profiles:\n- $u_1(y) = \\frac{\\tau_{\\text{true}}}{\\mu_1}y + C_1$\n- $u_2(y) = \\frac{\\tau_{\\text{true}}}{\\mu_2}y + C_2$\n\nWe apply the boundary and interface conditions to determine the constants $C_1$, $C_2$, and $\\tau_{\\text{true}}$.\n$1$. No-slip at the lower plate: $u_1(0) = 0$.\n$$\n\\frac{\\tau_{\\text{true}}}{\\mu_1}(0) + C_1 = 0 \\implies C_1 = 0\n$$\nSo, $u_1(y) = \\frac{\\tau_{\\text{true}}}{\\mu_1}y$.\n\n$2$. Continuity of velocity at the interface $y=fH$: $u_1(fH) = u_2(fH)$.\n$$\n\\frac{\\tau_{\\text{true}}}{\\mu_1}(fH) = \\frac{\\tau_{\\text{true}}}{\\mu_2}(fH) + C_2 \\implies C_2 = \\tau_{\\text{true}}fH\\left(\\frac{1}{\\mu_1} - \\frac{1}{\\mu_2}\\right)\n$$\n\n$3$. No-slip at the upper plate: $u_2(H) = U$.\n$$\nU = u_2(H) = \\frac{\\tau_{\\text{true}}}{\\mu_2}H + C_2\n$$\nSubstituting the expression for $C_2$:\n$$\nU = \\frac{\\tau_{\\text{true}}}{\\mu_2}H + \\tau_{\\text{true}}fH\\left(\\frac{1}{\\mu_1} - \\frac{1}{\\mu_2}\\right)\n$$\n$$\nU = \\tau_{\\text{true}}H \\left[ \\frac{1}{\\mu_2} + \\frac{f}{\\mu_1} - \\frac{f}{\\mu_2} \\right] = \\tau_{\\text{true}}H \\left[ \\frac{f}{\\mu_1} + \\frac{1-f}{\\mu_2} \\right]\n$$\nSolving for the exact shear stress $\\tau_{\\text{true}}$:\n$$\n\\tau_{\\text{true}} = \\frac{U}{H \\left( \\frac{f}{\\mu_1} + \\frac{1-f}{\\mu_2} \\right)}\n$$\nUsing the viscosity ratio $m = \\mu_2/\\mu_1$, we can write $\\mu_2 = m\\mu_1$.\n$$\n\\tau_{\\text{true}} = \\frac{U}{H \\left( \\frac{f}{\\mu_1} + \\frac{1-f}{m\\mu_1} \\right)} = \\frac{U\\mu_1}{H \\left( f + \\frac{1-f}{m} \\right)} = \\frac{U\\mu_1 m}{H (mf + 1 - f)} = \\frac{U\\mu_1 m}{H(1 + f(m-1))}\n$$\n\n### Derivation of the Relative Error $E$\nThe numerical model assumes a single fluid with viscosity $\\mu_{\\text{avg}}$ and predicts a uniform shear rate $\\frac{U}{H}$. The numerically computed shear stress is given as:\n$$\n\\tau_{\\text{num}} = \\mu_{\\text{avg}} \\frac{U}{H}\n$$\nThe relative error $E$ is defined as:\n$$\nE = \\frac{\\tau_{\\text{num}} - \\tau_{\\text{true}}}{\\tau_{\\text{true}}} = \\frac{\\tau_{\\text{num}}}{\\tau_{\\text{true}}} - 1\n$$\nSubstituting the expressions for $\\tau_{\\text{num}}$ and $\\tau_{\\text{true}}$:\n$$\n\\frac{\\tau_{\\text{num}}}{\\tau_{\\text{true}}} = \\frac{\\mu_{\\text{avg}} \\frac{U}{H}}{\\frac{U\\mu_1 m}{H(1 + f(m-1))}} = \\frac{\\mu_{\\text{avg}}}{\\mu_1} \\frac{1 + f(m-1)}{m}\n$$\nSo, the general expression for the error is:\n$$\nE = \\left(\\frac{\\mu_{\\text{avg}}}{\\mu_1}\\right) \\frac{1 + f(m-1)}{m} - 1\n$$\n\n### Case 1: Arithmetic Averaging ($E_A$)\nFor arithmetic averaging, $\\mu_{\\text{avg}} = \\mu_A = f\\mu_1 + (1-f)\\mu_2$.\nThe ratio $\\mu_A/\\mu_1$ is:\n$$\n\\frac{\\mu_A}{\\mu_1} = \\frac{f\\mu_1 + (1-f)\\mu_2}{\\mu_1} = f + (1-f)\\frac{\\mu_2}{\\mu_1} = f + (1-f)m\n$$\nSubstituting this into the error expression:\n$$\nE_A = (f + (1-f)m) \\frac{1 + f(m-1)}{m} - 1\n$$\n$$\nE_A = \\frac{(f(1-m)+m)(1+f(m-1))}{m} - 1\n$$\nLet's expand the numerator and subtract $m$:\n$$\n\\text{Numerator} - m = [f(1-m)+m] [1+f(m-1)] - m\n$$\n$$\n= f(1-m) + f^2(1-m)(m-1) + m + mf(m-1) - m\n$$\n$$\n= -f(m-1) - f^2(m-1)^2 + mf(m-1)\n$$\n$$\n= f(m-1)[-1 - f(m-1) + m] = f(m-1)[m-1 - f(m-1)]\n$$\n$$\n= f(m-1)(m-1)(1-f) = f(1-f)(m-1)^2\n$$\nTherefore, the error is:\n$$\nE_A = \\frac{f(1-f)(m-1)^2}{m}\n$$\n\n### Case 2: Harmonic Averaging ($E_H$)\nFor harmonic averaging, $\\mu_{\\text{avg}} = \\mu_H = \\left(\\frac{f}{\\mu_1} + \\frac{1-f}{\\mu_2}\\right)^{-1}$.\nThe ratio $\\mu_H/\\mu_1$ is:\n$$\n\\frac{\\mu_H}{\\mu_1} = \\frac{1}{\\mu_1}\\left(\\frac{f}{\\mu_1} + \\frac{1-f}{\\mu_2}\\right)^{-1} = \\left(\\mu_1\\left(\\frac{f}{\\mu_1} + \\frac{1-f}{m\\mu_1}\\right)\\right)^{-1}\n$$\n$$\n\\frac{\\mu_H}{\\mu_1} = \\left(f + \\frac{1-f}{m}\\right)^{-1} = \\left(\\frac{mf + 1-f}{m}\\right)^{-1} = \\frac{m}{1 + f(m-1)}\n$$\nSubstituting this into the general error expression:\n$$\nE_H = \\left(\\frac{m}{1 + f(m-1)}\\right) \\frac{1 + f(m-1)}{m} - 1\n$$\n$$\nE_H = 1 - 1 = 0\n$$\nThe harmonic average exactly reproduces the true shear stress for this problem, resulting in zero error. This is because the fluid layers are arranged in series with respect to momentum transport, and the harmonic mean correctly calculates the effective property for a series configuration.\n\nThe final result is the pair $(E_A, E_H)$.\n$E_A = \\frac{f(1-f)(m-1)^2}{m}$\n$E_H = 0$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{f(1-f)(m-1)^{2}}{m}  0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "One of the most significant challenges in implementing surface tension with interface capturing methods is the generation of non-physical velocities, known as \"spurious currents,\" even at an otherwise static interface. This advanced computational practice addresses this issue head-on by guiding you through the design of a \"balanced-force\" discretization. You will implement and compare a balanced and an unbalanced scheme to demonstrate how a consistent discretization of the pressure gradient and surface tension forces can algebraically eliminate the source of these numerical artifacts, a critical technique for achieving accurate and stable multiphase simulations .",
            "id": "3964091",
            "problem": "Consider a two-dimensional, immiscible, incompressible, isothermal, static configuration of two phases separated by a circular interface in a periodic square domain. The goal is to design and verify, on a collocated grid, a balanced discretization of the pressure gradient and the surface tension force that minimizes spurious currents in the absence of motion. The derivation and implementation should start from first principles and widely accepted facts, without invoking any target formulas as givens.\n\nThe physical and numerical setup is as follows.\n\n- Domain: a square of side length $L$, with periodic boundary conditions in both directions. Use $L = 1$ in dimensionless units.\n- Interface: a circle of radius $R$ centered at $(x_c, y_c) = (0.5, 0.5)$, with $R = 0.25$.\n- Surface tension coefficient: $\\sigma = 1$ (dimensionless).\n- Density and viscosity: take a uniform density $\\rho = 1$ (dimensionless) and ignore viscosity because the velocity is static and the viscous term vanishes.\n- Grid: a uniform collocated grid with $N \\times N$ control volumes, cell-centered unknowns, and cell size $\\Delta x = \\Delta y = L / N$. Coordinates of a cell center are $(x_i, y_j) = \\big((i+0.5)\\Delta x, (j+0.5)\\Delta y\\big)$ for integers $i,j$ in $[0, N-1]$. Periodicity should be enforced when computing discrete derivatives.\n\nStart from the fundamental balance of linear momentum for incompressible flow augmented by surface tension via the Continuum Surface Force (CSF) approach in the static case:\n$$\n\\mathbf{0} = -\\nabla p + \\mathbf{f}_\\sigma,\n$$\nwhere $\\mathbf{f}_\\sigma$ is the surface tension force density. For the sharp-interface continuous model, a constant mean curvature $ \\kappa $ for a circle is $ \\kappa = 1/R $. At equilibrium, a sufficient condition for continuous cancellation is to represent the capillary contribution as a pressure jump encoded via a smoothed Heaviside function $H_\\varepsilon(\\phi)$ based on a signed distance $\\phi$ to the interface:\n$$\np(\\mathbf{x}) = p_0 + \\sigma \\kappa \\, H_\\varepsilon(\\phi(\\mathbf{x})), \\quad \\mathbf{f}_\\sigma(\\mathbf{x}) = \\sigma \\kappa \\, \\nabla H_\\varepsilon(\\phi(\\mathbf{x})),\n$$\nso that $-\\nabla p + \\mathbf{f}_\\sigma = \\mathbf{0}$ in the continuous setting. Here $H_\\varepsilon$ is the regularized Heaviside function with smoothing half-thickness $\\varepsilon$, and $\\phi(\\mathbf{x})$ is defined as the signed distance to the interface (negative inside the circle, positive outside).\n\nYour task is to construct a collocated finite-volume/finite-difference discretization that achieves the same cancellation to machine precision in the discrete setting. Specifically:\n\n1. Define the signed distance field $\\phi(x,y) = \\sqrt{(x-x_c)^2+(y-y_c)^2} - R$ on cell centers.\n2. Define the regularized Heaviside function $H_\\varepsilon(\\phi)$ with a smoothing half-thickness $\\varepsilon$ as\n   $$\n   H_\\varepsilon(\\phi) =\n   \\begin{cases}\n   0,  \\phi \\le -\\varepsilon, \\\\\n   \\frac{1}{2}\\left[1 + \\frac{\\phi}{\\varepsilon} + \\frac{1}{\\pi}\\sin\\left(\\pi \\frac{\\phi}{\\varepsilon}\\right)\\right],  |\\phi|  \\varepsilon, \\\\\n   1,  \\phi \\ge \\varepsilon.\n   \\end{cases}\n   $$\n3. Use the analytic curvature $\\kappa = 1/R$ (constant).\n4. Define the discrete pressure field as $p = \\sigma \\kappa H_\\varepsilon(\\phi)$ at cell centers.\n5. Define a discrete gradient operator on the collocated grid using second-order central differences with periodic wrap:\n   $$\n   \\left[\\nabla_h q\\right]_x(i,j) = \\frac{q(i+1,j)-q(i-1,j)}{2\\Delta x}, \\quad\n   \\left[\\nabla_h q\\right]_y(i,j) = \\frac{q(i,j+1)-q(i,j-1)}{2\\Delta y}.\n   $$\n   Use this same operator for both the pressure gradient and the gradient of the Heaviside field in the balanced discretization.\n6. Construct two discrete force residuals $\\mathbf{r}(i,j)$ defined as the mismatch in the static momentum balance per unit density:\n   - Balanced scheme: \n     $$\n     \\mathbf{r}_\\text{bal}(i,j) = -\\nabla_h p(i,j) + \\sigma \\kappa \\, \\nabla_h H_\\varepsilon(\\phi)(i,j).\n     $$\n   - Unbalanced scheme (for comparison): use the same $\\nabla_h$ for $-\\nabla_h p$ but approximate $\\nabla H_\\varepsilon$ with first-order forward differences with periodic wrap,\n     $$\n     \\left[\\nabla^{+} q\\right]_x(i,j) = \\frac{q(i+1,j)-q(i,j)}{\\Delta x}, \\quad\n     \\left[\\nabla^{+} q\\right]_y(i,j) = \\frac{q(i,j+1)-q(i,j)}{\\Delta y},\n     $$\n     and define\n     $$\n     \\mathbf{r}_\\text{unbal}(i,j) = -\\nabla_h p(i,j) + \\sigma \\kappa \\, \\nabla^{+} H_\\varepsilon(\\phi)(i,j).\n     $$\n7. For each residual field, compute the maximum Euclidean norm over all cells,\n   $$\n   \\|\\mathbf{r}\\|_{\\infty,2} = \\max_{i,j} \\sqrt{r_x(i,j)^2 + r_y(i,j)^2}.\n   $$\n\nAll quantities are nondimensional; no physical units are used in the output.\n\nTest suite and required output:\n\n- Use the domain and parameters above with the following three test cases. For each case, define the smoothing as $\\varepsilon = \\alpha \\Delta x$, where $\\alpha$ is a dimensionless factor.\n  - Case A (happy path): $N = 64$, $\\alpha = 1.5$.\n  - Case B (coarse grid boundary case): $N = 16$, $\\alpha = 1.5$.\n  - Case C (under-resolved interface edge case): $N = 32$, $\\alpha = 0.5$.\n- For each case, compute three floats: the balanced residual norm $\\|\\mathbf{r}_\\text{bal}\\|_{\\infty,2}$, the unbalanced residual norm $\\|\\mathbf{r}_\\text{unbal}\\|_{\\infty,2}$, and their ratio $\\|\\mathbf{r}_\\text{bal}\\|_{\\infty,2} / \\|\\mathbf{r}_\\text{unbal}\\|_{\\infty,2}$.\n\nFinal output format specification:\n\n- Your program should produce a single line of output containing a list of nine floats in the order\n  $$\n  \\big[\\|\\mathbf{r}_\\text{bal}\\|_{\\infty,2}^{(A)}, \\|\\mathbf{r}_\\text{unbal}\\|_{\\infty,2}^{(A)}, ρ^{(A)}, \\|\\mathbfr_\\text{bal}\\|_{\\infty,2}^{(B)}, \\|\\mathbf{r}_\\text{unbal}\\|_{\\infty,2}^{(B)}, ρ^{(B)}, \\|\\mathbfr_\\text{bal}\\|_{\\infty,2}^{(C)}, \\|\\mathbf{r}_\\text{unbal}\\|_{\\infty,2}^{(C)}, ρ^{(C)}\\big],\n  $$\n  where $ρ^{(\\cdot)}$ denotes the ratio for the corresponding case. The list must be printed as a comma-separated list enclosed in square brackets, with no extra text, for example: \"[1.0,2.0,0.5, ...]\".",
            "solution": "The problem statement is evaluated to be valid. It is scientifically grounded in the principles of computational fluid dynamics for multiphase flows, specifically concerning the numerical treatment of surface tension. The problem is well-posed, objective, self-contained, and presents a non-trivial challenge in verifying the properties of a balanced-force discretization scheme.\n\nThe primary objective is to demonstrate the importance of a consistent, or 'balanced', discretization of the pressure gradient and surface tension force to eliminate spurious currents at a static interface. We begin from the static, incompressible momentum equation, which represents a balance between the pressure gradient force and the surface tension force density, $\\mathbf{f}_\\sigma$:\n$$\n\\mathbf{0} = -\\nabla p + \\mathbf{f}_\\sigma\n$$\nIn the Continuum Surface Force (CSF) model, the surface tension force, which acts only at the interface, is represented as a volumetric force density acting in a thin region around the interface. This is achieved using a regularized Dirac delta function, which can be expressed as the gradient of a regularized Heaviside function, $H_\\varepsilon(\\phi)$, where $\\phi$ is a signed distance function to the interface. The force density is given by $\\mathbf{f}_\\sigma = \\sigma \\kappa \\mathbf{n} \\delta_\\varepsilon(\\phi) = \\sigma \\kappa \\nabla H_\\varepsilon(\\phi)$, where $\\sigma$ is the surface tension coefficient and $\\kappa$ is the interface mean curvature.\n\nFor a static circular interface, the curvature $\\kappa$ is constant and equal to $1/R$. The Young-Laplace equation dictates that there is a pressure jump across the interface equal to $\\sigma \\kappa$. This can be continuously represented by defining the pressure field as $p(\\mathbf{x}) = p_0 + \\sigma \\kappa H_\\varepsilon(\\phi(\\mathbf{x}))$, where $p_0$ is a reference pressure. Dropping the constant $p_0$ as its gradient is zero, the momentum balance becomes:\n$$\n\\mathbf{0} = -\\nabla (\\sigma \\kappa H_\\varepsilon(\\phi)) + \\sigma \\kappa \\nabla H_\\varepsilon(\\phi)\n$$\nSince $\\sigma$ and $\\kappa$ are constants, the gradient operator distributes over the product, yielding $-\\sigma \\kappa \\nabla H_\\varepsilon(\\phi) + \\sigma \\kappa \\nabla H_\\varepsilon(\\phi) = \\mathbf{0}$. This demonstrates perfect balance in the continuous setting. Our goal is to preserve this balance in the discrete setting.\n\nThe numerical implementation proceeds as follows:\n\n1.  **Grid and Field Generation**: We define a uniform collocated grid of size $N \\times N$ over the domain $[0, L] \\times [0, L]$, where $L=1$. The cell centers are located at $(x_i, y_j) = ((i+0.5)\\Delta x, (j+0.5)\\Delta y)$ for $i,j \\in [0, N-1]$, with $\\Delta x = \\Delta y = L/N$. At each cell center, we compute the signed distance function $\\phi_{i,j}$ to the circle of radius $R=0.25$ centered at $(x_c, y_c) = (0.5, 0.5)$:\n    $$\n    \\phi_{i,j} = \\sqrt{(x_i - x_c)^2 + (y_j - y_c)^2} - R\n    $$\n    Using $\\phi_{i,j}$, we compute the discrete regularized Heaviside field $H_{\\varepsilon}(\\phi_{i,j})$ according to the provided piecewise formula, with the smoothing width $\\varepsilon = \\alpha \\Delta x$.\n\n2.  **Discrete Pressure and Operators**: The discrete pressure field is defined at cell centers as $p_{i,j} = \\sigma \\kappa H_{\\varepsilon}(\\phi_{i,j})$, with $\\sigma=1$ and $\\kappa = 1/R = 4$. We use two types of discrete gradient operators. The second-order central difference operator, $\\nabla_h$, is defined as:\n    $$\n    \\left[\\nabla_h q\\right]_x(i,j) = \\frac{q_{i+1,j}-q_{i-1,j}}{2\\Delta x}, \\quad\n    \\left[\\nabla_h q\\right]_y(i,j) = \\frac{q_{i,j+1}-q_{i,j-1}}{2\\Delta y}\n    $$\n    The first-order forward difference operator, $\\nabla^{+}$, is defined as:\n    $$\n    \\left[\\nabla^{+} q\\right]_x(i,j) = \\frac{q_{i+1,j}-q_{i,j}}{\\Delta x}, \\quad\n    \\left[\\nabla^{+} q\\right]_y(i,j) = \\frac{q_{i,j+1}-q_{i,j}}{\\Delta y}\n    $$\n    Periodicity is enforced by using modular arithmetic on the indices (e.g., $q_{N,j} = q_{0,j}$).\n\n3.  **Residual Calculation**: We compute the residuals for the balanced and unbalanced schemes.\n    -   **Balanced Scheme**: Both the pressure gradient and the surface tension force are discretized using the same operator, $\\nabla_h$:\n        $$\n        \\mathbf{r}_\\text{bal}(i,j) = -\\nabla_h p_{i,j} + \\sigma \\kappa \\, \\nabla_h H_\\varepsilon(\\phi_{i,j})\n        $$\n        Substituting $p_{i,j} = \\sigma \\kappa H_{\\varepsilon}(\\phi_{i,j})$ and exploiting the linearity of the discrete operator $\\nabla_h$:\n        $$\n        \\mathbf{r}_\\text{bal}(i,j) = -\\nabla_h (\\sigma \\kappa H_{\\varepsilon}(\\phi_{i,j})) + \\sigma \\kappa \\, \\nabla_h H_\\varepsilon(\\phi_{i,j}) = -\\sigma \\kappa \\nabla_h H_{\\varepsilon}(\\phi_{i,j}) + \\sigma \\kappa \\, \\nabla_h H_\\varepsilon(\\phi_{i,j}) = \\mathbf{0}\n        $$\n        This discrete cancellation is exact algebraically. Any non-zero result is solely due to finite-precision floating-point arithmetic and should be on the order of machine epsilon.\n\n    -   **Unbalanced Scheme**: The pressure gradient is discretized with $\\nabla_h$ while the surface tension term is approximated with $\\nabla^{+}$:\n        $$\n        \\mathbf{r}_\\text{unbal}(i,j) = -\\nabla_h p_{i,j} + \\sigma \\kappa \\, \\nabla^{+} H_\\varepsilon(\\phi_{i,j})\n        $$\n        Substituting for $p_{i,j}$:\n        $$\n        \\mathbf{r}_\\text{unbal}(i,j) = -\\sigma \\kappa \\nabla_h H_{\\varepsilon}(\\phi_{i,j}) + \\sigma \\kappa \\, \\nabla^{+} H_\\varepsilon(\\phi_{i,j}) = \\sigma \\kappa \\left( \\nabla^{+} H_\\varepsilon(\\phi_{i,j}) - \\nabla_h H_\\varepsilon(\\phi_{i,j}) \\right)\n        $$\n        Since $\\nabla_h$ and $\\nabla^{+}$ are different discrete operators with different truncation errors, their difference is non-zero. The truncation error of $\\nabla^{+}$ is $O(\\Delta x)$ while for $\\nabla_h$ it is $O(\\Delta x^2)$. Their difference is therefore $O(\\Delta x)$, leading to a significant residual that does not vanish as the grid is refined, causing spurious currents in a time-dependent simulation.\n\n4.  **Norm Computation**: For each residual field $\\mathbf{r}(i,j) = (r_x(i,j), r_y(i,j))$, we calculate the maximum discrete L2-norm over the grid:\n    $$\n    \\|\\mathbf{r}\\|_{\\infty,2} = \\max_{i,j} \\sqrt{r_x(i,j)^2 + r_y(i,j)^2}\n    $$\n    This metric quantifies the magnitude of the largest local force imbalance. The results computed for each test case will quantitatively validate the superiority of the balanced-force approach. For all cases, $\\|\\mathbf{r}_\\text{bal}\\|_{\\infty,2}$ is expected to be close to machine precision, while $\\|\\mathbf{r}_\\text{unbal}\\|_{\\infty,2}$ will be several orders of magnitude larger. The ratio $\\|\\mathbf{r}_\\text{bal}\\|_{\\infty,2} / \\|\\mathbf{r}_\\text{unbal}\\|_{\\infty,2}$ will therefore be very small.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the balanced-force discretization problem for three test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (64, 1.5),  # Case A\n        (16, 1.5),  # Case B\n        (32, 0.5),  # Case C\n    ]\n\n    results = []\n    \n    # Common parameters\n    L = 1.0\n    R = 0.25\n    xc, yc = 0.5, 0.5\n    sigma = 1.0\n    kappa = 1.0 / R\n\n    for N, alpha in test_cases:\n        # 1. Grid and Field Generation\n        dx = L / N\n        \n        # Create cell-centered grid coordinates\n        grid_1d = (np.arange(N) + 0.5) * dx\n        x, y = np.meshgrid(grid_1d, grid_1d)\n\n        # Calculate signed distance field\n        phi = np.sqrt((x - xc)**2 + (y - yc)**2) - R\n        \n        # Calculate regularized Heaviside function H_eps\n        eps = alpha * dx\n        H = np.zeros_like(phi)\n        \n        # Region phi = eps\n        H[phi = eps] = 1.0\n        \n        # Region |phi|  eps\n        mask = np.abs(phi)  eps\n        phi_masked = phi[mask]\n        H[mask] = 0.5 * (1.0 + phi_masked / eps + (1.0 / np.pi) * np.sin(np.pi * phi_masked / eps))\n\n        # 2. Discrete Pressure\n        p = sigma * kappa * H\n\n        # 3. Discrete Gradient Operators (with periodic boundaries)\n        def grad_central(q, delta):\n            gx = (np.roll(q, -1, axis=1) - np.roll(q, 1, axis=1)) / (2.0 * delta)\n            gy = (np.roll(q, -1, axis=0) - np.roll(q, 1, axis=0)) / (2.0 * delta)\n            return gx, gy\n\n        def grad_forward(q, delta):\n            gx = (np.roll(q, -1, axis=1) - q) / delta\n            gy = (np.roll(q, -1, axis=0) - q) / delta\n            return gx, gy\n\n        # 4. Residual Calculation\n        # Pressure gradient using central differences for both schemes\n        grad_p_x, grad_p_y = grad_central(p, dx)\n\n        # Balanced scheme\n        grad_H_bal_x, grad_H_bal_y = grad_central(H, dx)\n        res_bal_x = -grad_p_x + sigma * kappa * grad_H_bal_x\n        res_bal_y = -grad_p_y + sigma * kappa * grad_H_bal_y\n\n        # Unbalanced scheme\n        grad_H_unbal_x, grad_H_unbal_y = grad_forward(H, dx)\n        res_unbal_x = -grad_p_x + sigma * kappa * grad_H_unbal_x\n        res_unbal_y = -grad_p_y + sigma * kappa * grad_H_unbal_y\n\n        # 5. Norm Computation\n        norm_bal = np.max(np.sqrt(res_bal_x**2 + res_bal_y**2))\n        norm_unbal = np.max(np.sqrt(res_unbal_x**2 + res_unbal_y**2))\n        \n        # Handle potential division by zero if norm_unbal is zero\n        # (unlikely, but good practice)\n        ratio = norm_bal / norm_unbal if norm_unbal != 0 else 0.0\n\n        results.extend([norm_bal, norm_unbal, ratio])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}