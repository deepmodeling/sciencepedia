{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of any interface capturing method, such as the Volume of Fluid (VOF) method, is the accurate numerical solution of the advection equation. This first exercise provides foundational practice by having you apply a basic conservative finite volume scheme to a simple one-dimensional problem. By calculating the evolution of a hypothetical sharp interface (a square wave), you will gain direct experience with the mechanics of a numerical flux scheme and witness its effects, such as the numerical diffusion inherent in the first-order upwind method .",
            "id": "3964146",
            "problem": "A one-dimensional Volume of Fluid (VOF) indicator function $F(x,t)$, representing the liquid volume fraction and bounded in $[0,1]$, satisfies the conservation law for passive advection by a constant velocity field $u$: $\\frac{\\partial F}{\\partial t} + \\frac{\\partial (u F)}{\\partial x} = 0$. Consider a uniform finite volume mesh with $N=12$ cells, periodic boundary conditions, and cell-averaged values $F_{i}^{n}$ at time level $t^{n}$ for integer indices $i \\in \\{1,2,\\dots,12\\}$. The mesh spacing is $\\Delta x = 1.0 \\times 10^{-3}\\ \\mathrm{m}$, the velocity is $u = 2.0\\ \\mathrm{m/s}$, and the time step is $\\Delta t = 3.0 \\times 10^{-4}\\ \\mathrm{s}$. The Courant–Friedrichs–Lewy (CFL) number is defined as $\\alpha = u \\Delta t / \\Delta x$. The initial data is a square wave,\n- $F_{i}^{0} = 1$ for $i \\in \\{4,5,6,7\\}$,\n- $F_{i}^{0} = 0$ for all other $i$,\nwith periodic indexing (e.g., $F_{0}^{0} \\equiv F_{12}^{0}$, $F_{13}^{0} \\equiv F_{1}^{0}$).\n\nUsing an explicit conservative finite volume update with the first-order upwind (donor-cell) numerical flux, which is a bounded upwind scheme, advance the solution by one time step and compute the updated volume fraction in cell $i=8$, namely $F_{8}^{1}$, as a pure number. Express your final answer as an exact numerical value without units and without rounding.",
            "solution": "The problem requires the calculation of an updated cell-averaged value of a Volume of Fluid (VOF) indicator function, $F(x,t)$, governed by a one-dimensional linear advection equation. The problem is discretized using a conservative finite volume method.\n\nThe governing partial differential equation for the advection of the passive scalar $F$ with a constant velocity $u$ is given as:\n$$\n\\frac{\\partial F}{\\partial t} + \\frac{\\partial (u F)}{\\partial x} = 0\n$$\nSince $u$ is constant, this simplifies to $\\frac{\\partial F}{\\partial t} + u \\frac{\\partial F}{\\partial x} = 0$.\nThe finite volume method begins with the integral form of the conservation law over a control volume (cell) $i$, which spans from the interface $x_{i-1/2}$ to $x_{i+1/2}$, with a width of $\\Delta x = x_{i+1/2} - x_{i-1/2}$. Integrating the equation over cell $i$ gives:\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial F}{\\partial t} \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial (uF)}{\\partial x} \\,dx = 0\n$$\nDefining the cell-averaged value $F_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} F(x,t) \\,dx$ and applying the fundamental theorem of calculus to the spatial derivative term, we get:\n$$\n\\frac{d(F_i \\Delta x)}{dt} + (uF)_{i+1/2} - (uF)_{i-1/2} = 0\n$$\nSince $\\Delta x$ is constant, this becomes:\n$$\n\\frac{dF_i}{dt} + \\frac{1}{\\Delta x} \\left( (uF)_{i+1/2} - (uF)_{i-1/2} \\right) = 0\n$$\nHere, $(uF)_{i \\pm 1/2}$ represents the flux of $F$ at the cell interfaces. We discretize this equation in time using an explicit forward Euler scheme:\n$$\n\\frac{F_i^{n+1} - F_i^n}{\\Delta t} + \\frac{1}{\\Delta x} \\left( \\mathcal{F}_{i+1/2} - \\mathcal{F}_{i-1/2} \\right) = 0\n$$\nwhere $F_i^n$ is the cell-averaged value at time $t^n$, and $\\mathcal{F}_{i \\pm 1/2}$ are the numerical fluxes at the cell faces, evaluated at time $t^n$. Rearranging for $F_i^{n+1}$ yields the conservative update formula:\n$$\nF_i^{n+1} = F_i^n - \\frac{\\Delta t}{\\Delta x} \\left( \\mathcal{F}_{i+1/2} - \\mathcal{F}_{i-1/2} \\right)\n$$\nThe problem specifies a first-order upwind (donor-cell) scheme for the numerical flux. The velocity is given as $u = 2.0\\ \\mathrm{m/s}$, which is positive. For $u > 0$, the flow is from left to right, so the value of $F$ at an interface is taken from the cell to the left (the \"upwind\" or \"donor\" cell).\nThus, the numerical fluxes at the right and left faces of cell $i$ are:\n$$\n\\mathcal{F}_{i+1/2} = u F_i^n\n$$\n$$\n\\mathcal{F}_{i-1/2} = u F_{i-1}^n\n$$\nSubstituting these expressions into the update formula:\n$$\nF_i^{n+1} = F_i^n - \\frac{\\Delta t}{\\Delta x} \\left( u F_i^n - u F_{i-1}^n \\right)\n$$\nWe define the Courant–Friedrichs–Lewy (CFL) number as $\\alpha = \\frac{u \\Delta t}{\\Delta x}$. The update equation becomes:\n$$\nF_i^{n+1} = F_i^n - \\alpha \\left( F_i^n - F_{i-1}^n \\right) = (1 - \\alpha)F_i^n + \\alpha F_{i-1}^n\n$$\nThis is the explicit update equation for the first-order upwind scheme with positive velocity.\n\nNow, we must compute the value of $\\alpha$ from the given data:\n- Velocity: $u = 2.0\\ \\mathrm{m/s}$\n- Time step: $\\Delta t = 3.0 \\times 10^{-4}\\ \\mathrm{s}$\n- Mesh spacing: $\\Delta x = 1.0 \\times 10^{-3}\\ \\mathrm{m}$\n\n$$\n\\alpha = \\frac{(2.0) \\times (3.0 \\times 10^{-4})}{1.0 \\times 10^{-3}} = \\frac{6.0 \\times 10^{-4}}{1.0 \\times 10^{-3}} = 6.0 \\times 10^{-1} = 0.6\n$$\nThe problem asks for $F_8^1$, which is the volume fraction in cell $i=8$ after one time step, starting from $n=0$. Using the update formula with $i=8$ and $n=0$:\n$$\nF_8^1 = (1 - \\alpha)F_8^0 + \\alpha F_7^0\n$$\nWe need the initial values $F_8^0$ and $F_7^0$. The problem states the initial condition as a square wave:\n- $F_i^0 = 1$ for $i \\in \\{4, 5, 6, 7\\}$\n- $F_i^0 = 0$ for all other $i$\n\nFrom this definition:\n- For cell $i=8$, since $8 \\notin \\{4, 5, 6, 7\\}$, the initial value is $F_8^0 = 0$.\n- For cell $i=7$, since $7 \\in \\{4, 5, 6, 7\\}$, the initial value is $F_7^0 = 1$.\n\nSubstituting these values, along with $\\alpha = 0.6$, into the update equation for $F_8^1$:\n$$\nF_8^1 = (1 - 0.6) \\times F_8^0 + 0.6 \\times F_7^0\n$$\n$$\nF_8^1 = (0.4) \\times (0) + 0.6 \\times (1)\n$$\n$$\nF_8^1 = 0 + 0.6\n$$\n$$\nF_8^1 = 0.6\n$$\nThe updated volume fraction in cell $i=8$ after one time step is $0.6$. The periodic boundary conditions are not required for this specific calculation, as the stencils for cell $8$ (i.e., cells $7$ and $8$) do not cross the domain boundaries.",
            "answer": "$$\\boxed{0.6}$$"
        },
        {
            "introduction": "Beyond simply tracking the interface, a robust multiphase solver must accurately model the physical properties within computational cells that contain a mixture of fluids. This practice shifts our focus from the kinematics of advection to the physics of the mixture itself. Through an analytical derivation for a classic stratified Couette flow scenario, you will investigate how different interpolation strategies—specifically arithmetic versus harmonic averaging of viscosity—impact the accuracy of the computed shear stress, providing a crucial insight into why the choice of a numerical closure model must be guided by the underlying physics of the transport process .",
            "id": "3964117",
            "problem": "Consider two immiscible, incompressible, Newtonian fluids undergoing steady planar Couette flow between two infinite parallel plates separated by a distance $H$. The lower plate at $y=0$ is stationary and the upper plate at $y=H$ translates in the $x$-direction with speed $U$. The interface between the fluids is planar and located at $y=fH$, with $0<f<1$. The lower fluid (phase $1$) occupies $0\\leq y \\leq fH$ and has dynamic viscosity $\\mu_{1}$; the upper fluid (phase $2$) occupies $fH \\leq y \\leq H$ and has dynamic viscosity $\\mu_{2}$. Define the viscosity ratio $m=\\mu_{2}/\\mu_{1}>0$.\n\nYou are modeling this configuration with an interface capturing method, such as the Volume of Fluid (VOF) method, in which one computational cell of thickness $H$ is “mixed” across the interface and is assigned a single effective viscosity $\\mu_{\\text{avg}}$ computed from the phase fraction $f$. Two common interpolation choices for $\\mu_{\\text{avg}}$ are:\n- Arithmetic averaging: $\\mu_{A} = f\\,\\mu_{1} + (1-f)\\,\\mu_{2}$.\n- Harmonic averaging: $\\mu_{H} = \\left(f/\\mu_{1} + (1-f)/\\mu_{2}\\right)^{-1}$.\n\nAssume negligible inertia and no pressure gradient, and take the constitutive law for Newtonian fluids in planar shear to be $\\tau_{xy}=\\mu\\,\\frac{du}{dy}$, where $u(y)$ is the streamwise velocity and $\\tau_{xy}$ is the shear stress. Starting from conservation of linear momentum and the no-slip boundary conditions, derive the exact shear stress $\\tau_{\\text{true}}$ transmitted through the layers. Then, under the single-cell mixed-property model that treats the cell as a uniform medium of viscosity $\\mu_{\\text{avg}}$, the solver computes a uniform shear rate consistent with the plate kinematics and predicts $\\tau_{\\text{num}}=\\mu_{\\text{avg}}\\,\\frac{U}{H}$. Using this modeling assumption, derive the dimensionless relative error in shear stress\n$$\nE = \\frac{\\tau_{\\text{num}} - \\tau_{\\text{true}}}{\\tau_{\\text{true}}},\n$$\nfor each interpolation choice $\\mu_{\\text{avg}}=\\mu_{A}$ and $\\mu_{\\text{avg}}=\\mu_{H}$.\n\nExpress your final answers as closed-form analytic expressions in terms of $f$ and $m$. Because the requested quantities are dimensionless, report them without units. Present the two results, $(E_{A},E_{H})$, as a single row matrix. No numerical evaluation is required.",
            "solution": "### Derivation of the Exact Shear Stress $\\tau_{\\text{true}}$\nFor steady, fully developed, planar flow with only $x$-direction velocity $u(y)$ and no pressure gradient, the conservation of linear momentum equation simplifies to:\n$$\n\\frac{d}{dy}\\left(\\mu \\frac{du}{dy}\\right) = 0\n$$\nThis equation implies that the shear stress, $\\tau_{xy} = \\mu \\frac{du}{dy}$, must be constant throughout the entire domain $0 \\leq y \\leq H$. We denote this constant, exact shear stress as $\\tau_{\\text{true}}$.\n\nIn each fluid layer, the velocity gradient is constant:\n- For fluid $1$ ($0 \\leq y \\leq fH$): $\\frac{du_1}{dy} = \\frac{\\tau_{\\text{true}}}{\\mu_1}$.\n- For fluid $2$ ($fH \\leq y \\leq H$): $\\frac{du_2}{dy} = \\frac{\\tau_{\\text{true}}}{\\mu_2}$.\n\nIntegrating these equations with respect to $y$ gives the velocity profiles:\n- $u_1(y) = \\frac{\\tau_{\\text{true}}}{\\mu_1}y + C_1$\n- $u_2(y) = \\frac{\\tau_{\\text{true}}}{\\mu_2}y + C_2$\n\nWe apply the boundary and interface conditions to determine the constants $C_1$, $C_2$, and $\\tau_{\\text{true}}$.\n1.  No-slip at the lower plate: $u_1(0) = 0$.\n    $$\n    \\frac{\\tau_{\\text{true}}}{\\mu_1}(0) + C_1 = 0 \\implies C_1 = 0\n    $$\n    So, $u_1(y) = \\frac{\\tau_{\\text{true}}}{\\mu_1}y$.\n\n2.  Continuity of velocity at the interface $y=fH$: $u_1(fH) = u_2(fH)$.\n    $$\n    \\frac{\\tau_{\\text{true}}}{\\mu_1}(fH) = \\frac{\\tau_{\\text{true}}}{\\mu_2}(fH) + C_2 \\implies C_2 = \\tau_{\\text{true}}fH\\left(\\frac{1}{\\mu_1} - \\frac{1}{\\mu_2}\\right)\n    $$\n\n3.  No-slip at the upper plate: $u_2(H) = U$.\n    $$\n    U = u_2(H) = \\frac{\\tau_{\\text{true}}}{\\mu_2}H + C_2\n    $$\n    Substituting the expression for $C_2$:\n    $$\n    U = \\frac{\\tau_{\\text{true}}}{\\mu_2}H + \\tau_{\\text{true}}fH\\left(\\frac{1}{\\mu_1} - \\frac{1}{\\mu_2}\\right)\n    $$\n    $$\n    U = \\tau_{\\text{true}}H \\left[ \\frac{1}{\\mu_2} + \\frac{f}{\\mu_1} - \\frac{f}{\\mu_2} \\right] = \\tau_{\\text{true}}H \\left[ \\frac{f}{\\mu_1} + \\frac{1-f}{\\mu_2} \\right]\n    $$\n    Solving for the exact shear stress $\\tau_{\\text{true}}$:\n    $$\n    \\tau_{\\text{true}} = \\frac{U}{H \\left( \\frac{f}{\\mu_1} + \\frac{1-f}{\\mu_2} \\right)}\n    $$\n    Using the viscosity ratio $m = \\mu_2/\\mu_1$, we can write $\\mu_2 = m\\mu_1$.\n    $$\n    \\tau_{\\text{true}} = \\frac{U}{H \\left( \\frac{f}{\\mu_1} + \\frac{1-f}{m\\mu_1} \\right)} = \\frac{U\\mu_1}{H \\left( f + \\frac{1-f}{m} \\right)} = \\frac{U\\mu_1 m}{H (mf + 1 - f)} = \\frac{U\\mu_1 m}{H(1 + f(m-1))}\n    $$\n\n### Derivation of the Relative Error $E$\nThe numerical model assumes a single fluid with viscosity $\\mu_{\\text{avg}}$ and predicts a uniform shear rate $\\frac{U}{H}$. The numerically computed shear stress is given as:\n$$\n\\tau_{\\text{num}} = \\mu_{\\text{avg}} \\frac{U}{H}\n$$\nThe relative error $E$ is defined as:\n$$\nE = \\frac{\\tau_{\\text{num}} - \\tau_{\\text{true}}}{\\tau_{\\text{true}}} = \\frac{\\tau_{\\text{num}}}{\\tau_{\\text{true}}} - 1\n$$\nSubstituting the expressions for $\\tau_{\\text{num}}$ and $\\tau_{\\text{true}}$:\n$$\n\\frac{\\tau_{\\text{num}}}{\\tau_{\\text{true}}} = \\frac{\\mu_{\\text{avg}} \\frac{U}{H}}{\\frac{U\\mu_1 m}{H(1 + f(m-1))}} = \\frac{\\mu_{\\text{avg}}}{\\mu_1} \\frac{1 + f(m-1)}{m}\n$$\nSo, the general expression for the error is:\n$$\nE = \\left(\\frac{\\mu_{\\text{avg}}}{\\mu_1}\\right) \\frac{1 + f(m-1)}{m} - 1\n$$\n\n### Case 1: Arithmetic Averaging ($E_A$)\nFor arithmetic averaging, $\\mu_{\\text{avg}} = \\mu_A = f\\mu_1 + (1-f)\\mu_2$.\nThe ratio $\\mu_A/\\mu_1$ is:\n$$\n\\frac{\\mu_A}{\\mu_1} = \\frac{f\\mu_1 + (1-f)\\mu_2}{\\mu_1} = f + (1-f)\\frac{\\mu_2}{\\mu_1} = f + (1-f)m\n$$\nSubstituting this into the error expression:\n$$\nE_A = (f + (1-f)m) \\frac{1 + f(m-1)}{m} - 1\n$$\n$$\nE_A = \\frac{(f(1-m)+m)(1+f(m-1))}{m} - 1\n$$\nLet's expand the numerator and subtract $m$:\n$$\n\\text{Numerator} - m = [f(1-m)+m] [1+f(m-1)] - m\n$$\n$$\n= f(1-m) + f^2(1-m)(m-1) + m + mf(m-1) - m\n$$\n$$\n= -f(m-1) - f^2(m-1)^2 + mf(m-1)\n$$\n$$\n= f(m-1)[-1 - f(m-1) + m] = f(m-1)[m-1 - f(m-1)]\n$$\n$$\n= f(m-1)(m-1)(1-f) = f(1-f)(m-1)^2\n$$\nTherefore, the error is:\n$$\nE_A = \\frac{f(1-f)(m-1)^2}{m}\n$$\n\n### Case 2: Harmonic Averaging ($E_H$)\nFor harmonic averaging, $\\mu_{\\text{avg}} = \\mu_H = \\left(\\frac{f}{\\mu_1} + \\frac{1-f}{\\mu_2}\\right)^{-1}$.\nThe ratio $\\mu_H/\\mu_1$ is:\n$$\n\\frac{\\mu_H}{\\mu_1} = \\frac{1}{\\mu_1}\\left(\\frac{f}{\\mu_1} + \\frac{1-f}{\\mu_2}\\right)^{-1} = \\left(\\mu_1\\left(\\frac{f}{\\mu_1} + \\frac{1-f}{m\\mu_1}\\right)\\right)^{-1}\n$$\n$$\n\\frac{\\mu_H}{\\mu_1} = \\left(f + \\frac{1-f}{m}\\right)^{-1} = \\left(\\frac{mf + 1-f}{m}\\right)^{-1} = \\frac{m}{1 + f(m-1)}\n$$\nSubstituting this into the general error expression:\n$$\nE_H = \\left(\\frac{m}{1 + f(m-1)}\\right) \\frac{1 + f(m-1)}{m} - 1\n$$\n$$\nE_H = 1 - 1 = 0\n$$\nThe harmonic average exactly reproduces the true shear stress for this problem, resulting in zero error. This is because the fluid layers are arranged in series with respect to momentum transport, and the harmonic mean correctly calculates the effective property for a series configuration.\n\nThe final result is the pair $(E_A, E_H)$.\n$E_A = \\frac{f(1-f)(m-1)^2}{m}$\n$E_H = 0$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{f(1-f)(m-1)^{2}}{m} & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Surface tension is a dominant force in many multiphase systems, but its representation as a singular force on an interface poses a significant challenge for numerical methods that use a fixed grid. This advanced hands-on practice addresses the critical issue of \"spurious currents\"—non-physical velocities arising from a discrete imbalance between the pressure gradient and the surface tension force. By implementing the Continuum Surface Force (CSF) model for a canonical static droplet test case, you will computationally quantify this numerical artifact, gaining essential experience in verifying multiphase solvers and understanding the necessity of developing balanced-force discretization schemes for accurate simulations .",
            "id": "3964150",
            "problem": "You are tasked with quantifying the discrete imbalance between the Continuum Surface Force (CSF) and the pressure gradient in a static droplet test on a collocated grid. The test emulates a canonical verification for interface capturing methods in multiphase flow within computational thermal engineering, where a color function indicates the phase, and the CSF body force is used to model surface tension. The objective is to compute, for specified test cases, the residual imbalance arising from discrete approximations on cell centers and to report dimensionless error metrics.\n\nStarting point and physical basis must be the following well-established fundamentals:\n- The static, isothermal, incompressible momentum balance without gravity is\n$$\\mathbf{0} = -\\nabla p + \\mathbf{f}_\\sigma,$$\nwhere $p$ is pressure and $\\mathbf{f}_\\sigma$ is the surface tension force per unit volume.\n- The Laplace pressure jump for a circular interface of radius $R$ is\n$$\\Delta p = \\frac{\\sigma}{R},$$\nwhere $\\sigma$ is the surface tension coefficient in $\\mathrm{N}/\\mathrm{m}$ and $R$ is in $\\mathrm{m}$.\n- In the Continuum Surface Force (CSF) formulation, with a color function $C(\\mathbf{x})$ that transitions smoothly between phases, the unit normal $\\mathbf{n}$ is defined by\n$$\\mathbf{n} = \\frac{\\nabla C}{\\lVert \\nabla C \\rVert},$$\nthe curvature is\n$$\\kappa = -\\nabla \\cdot \\mathbf{n},$$\nand the CSF force per unit volume is\n$$\\mathbf{f}_\\sigma = \\sigma \\kappa \\nabla C.$$\n\nImplement the following discrete procedure on a two-dimensional, periodic, uniform, collocated grid of $N_x \\times N_y$ cell centers spanning a rectangular domain of sizes $L_x$ by $L_y$ in $\\mathrm{m}$:\n1. Construct the color function $C(\\mathbf{x})$ representing a single, centered circular droplet of radius $R$ by a smooth indicator using a hyperbolic tangent transition of thickness $\\epsilon$ in $\\mathrm{m}$. Specifically, set at cell centers\n$$C(r) = \\frac{1}{2}\\left(1 - \\tanh\\left(\\frac{r - R}{\\epsilon}\\right)\\right),$$\nwhere $r$ is the radial distance from the droplet center.\n2. Approximate all spatial derivatives on cell centers with second-order central differences and periodic boundary conditions. This includes $\\nabla C$, $\\mathbf{n}$, $\\kappa$, and $\\nabla p$.\n3. Compute the CSF force $\\mathbf{f}_\\sigma$ on cell centers using the definitions above. To avoid division by zero, regularize the unit normal by adding a small positive constant $\\delta$ only inside the norm in the denominator, i.e.,\n$$\\mathbf{n} \\approx \\frac{\\nabla C}{\\lVert \\nabla C \\rVert + \\delta},$$\nwhere $\\delta$ is a small, dimensionless number chosen to be negligible compared to $\\lVert \\nabla C \\rVert$ in the interface region.\n4. Define a piecewise-constant pressure field that is $p_\\text{out}$ outside the droplet and $p_\\text{in} = p_\\text{out} + \\sigma/R$ inside the droplet, consistent with the Laplace jump. Use the simple criterion $C \\geq 1/2$ to mark the inside. Let $p_\\text{out} = 0$ in $\\mathrm{Pa}$.\n5. Compute the discrete pressure gradient $\\nabla p$ on cell centers.\n6. Form the residual imbalance vector field on cell centers\n$$\\mathbf{r} = \\nabla p - \\mathbf{f}_\\sigma.$$\n7. Compute two dimensionless error metrics:\n   - The $L_2$-relative imbalance\n   $$E_2 = \\frac{\\left(\\sum_{i,j} \\lVert \\mathbf{r}_{i,j} \\rVert^2 \\Delta x \\Delta y\\right)^{1/2}}{\\left(\\sum_{i,j} \\lVert \\mathbf{f}_{\\sigma,i,j} \\rVert^2 \\Delta x \\Delta y\\right)^{1/2}},$$\n   - The $L_\\infty$-relative imbalance\n   $$E_\\infty = \\frac{\\max_{i,j} \\lVert \\mathbf{r}_{i,j} \\rVert}{\\max_{i,j} \\lVert \\mathbf{f}_{\\sigma,i,j} \\rVert},$$\n   where $\\Delta x = L_x/N_x$ and $\\Delta y = L_y/N_y$.\n\nAll quantities and parameters with physical dimensions must be handled in International System of Units (SI): lengths in $\\mathrm{m}$, surface tension in $\\mathrm{N}/\\mathrm{m}$, and pressure in $\\mathrm{Pa}$. The final outputs $E_2$ and $E_\\infty$ are dimensionless and must be reported as floating-point numbers.\n\nTest suite. Your program must evaluate the following three cases:\n- Case A (general case): $L_x = 10^{-3}\\,\\mathrm{m}$, $L_y = 10^{-3}\\,\\mathrm{m}$, $N_x = 128$, $N_y = 128$, droplet center at $(L_x/2,L_y/2)$, $R = 2.5\\times 10^{-4}\\,\\mathrm{m}$, $\\epsilon = 2\\Delta x$, $\\sigma = 7.2\\times 10^{-2}\\,\\mathrm{N}/\\mathrm{m}$, $p_\\text{out} = 0\\,\\mathrm{Pa}$, $\\delta = 10^{-12}$.\n- Case B (coarser grid boundary): $L_x = 10^{-3}\\,\\mathrm{m}$, $L_y = 10^{-3}\\,\\mathrm{m}$, $N_x = 32$, $N_y = 32$, droplet center at $(L_x/2,L_y/2)$, $R = 2.5\\times 10^{-4}\\,\\mathrm{m}$, $\\epsilon = \\Delta x$, $\\sigma = 7.2\\times 10^{-2}\\,\\mathrm{N}/\\mathrm{m}$, $p_\\text{out} = 0\\,\\mathrm{Pa}$, $\\delta = 10^{-12}$.\n- Case C (near-grid-scale edge): $L_x = 10^{-3}\\,\\mathrm{m}$, $L_y = 10^{-3}\\,\\mathrm{m}$, $N_x = 128$, $N_y = 128$, droplet center at $(L_x/2,L_y/2)$, $R = 6\\Delta x$, $\\epsilon = \\Delta x$, $\\sigma = 7.2\\times 10^{-2}\\,\\mathrm{N}/\\mathrm{m}$, $p_\\text{out} = 0\\,\\mathrm{Pa}$, $\\delta = 10^{-12}$.\n\nFinal output format. Your program should produce a single line of output containing the six results as a comma-separated list enclosed in square brackets in the following order:\n$$[E_2^\\text{A}, E_\\infty^\\text{A}, E_2^\\text{B}, E_\\infty^\\text{B}, E_2^\\text{C}, E_\\infty^\\text{C}].$$",
            "solution": "The solution follows the computational procedure detailed in the problem statement. The core of the problem lies in the discrepancy between two different discrete representations of the same physical effect. On one hand, the pressure gradient term, $\\nabla p$, is derived from a sharp, discontinuous pressure field. On the other hand, the surface tension force, $\\mathbf{f}_\\sigma$, is derived from a smooth, continuous color field $C$. The incompatibility of these discrete representations on a collocated grid gives rise to a non-zero residual $\\mathbf{r}$, which is precisely what this problem asks to quantify.\n\nThe implementation proceeds as follows:\n\n1.  **Grid and Coordinate Setup:** For each test case, a uniform 2D grid of size $N_x \\times N_y$ is established over the domain $[0, L_x] \\times [0, L_y]$. The cell dimensions $\\Delta x$ and $\\Delta y$ are calculated. A mesh of cell-center coordinates $(x_i, y_j)$ is generated.\n\n2.  **Field Construction:**\n    *   **Color Function ($C$):** At each cell center, the radial distance $r$ from the droplet center is computed. This is used to define the smooth color function $C(r) = \\frac{1}{2}\\left(1 - \\tanh\\left(\\frac{r - R}{\\epsilon}\\right)\\right)$.\n    *   **Pressure Field ($p$):** A discontinuous pressure field is created. Cells are marked as \"inside\" the droplet if $C \\ge 0.5$. The pressure in these cells is set to the Laplace pressure $p_\\text{in} = p_\\text{out} + \\sigma/R$, while all other cells have pressure $p_\\text{out}$.\n\n3.  **Discrete Operator Application:**\n    *   All spatial derivatives (gradient and divergence) are approximated using second-order central difference schemes, respecting the specified periodic boundary conditions.\n    *   **Pressure Gradient ($\\nabla p$):** The discrete gradient operator is applied to the sharp pressure field $p$.\n    *   **CSF Force ($\\mathbf{f}_\\sigma$):** This is a multi-step calculation:\n        a. The gradient of the color function, $\\nabla C$, is computed.\n        b. The unit normal vector $\\mathbf{n}$ is found by normalizing $\\nabla C$, using the regularization constant $\\delta$ to prevent division by zero: $\\mathbf{n} \\approx \\frac{\\nabla C}{\\lVert \\nabla C \\rVert + \\delta}$.\n        c. The curvature $\\kappa$ is computed as the negative divergence of the normal field: $\\kappa = -\\nabla \\cdot \\mathbf{n}$.\n        d. The final CSF force field is assembled as $\\mathbf{f}_\\sigma = \\sigma \\kappa \\nabla C$.\n\n4.  **Residual and Error Calculation:**\n    *   The residual vector field is computed at each cell center as the difference: $\\mathbf{r} = \\nabla p - \\mathbf{f}_\\sigma$.\n    *   The norms of the residual field ($\\mathbf{r}$) and the CSF force field ($\\mathbf{f}_\\sigma$) are calculated.\n    *   Finally, the $L_2$-relative and $L_\\infty$-relative imbalance metrics, $E_2$ and $E_\\infty$, are computed as the ratios of these norms, as defined in the problem statement.\n\nThis procedure is executed for each of the three test cases to obtain the six required output values.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the discrete imbalance between CSF and pressure gradient for a static droplet.\n    \"\"\"\n\n    def gradient(field, dx, dy):\n        \"\"\"Computes the gradient of a 2D scalar field using 2nd-order central differences with periodic BCs.\"\"\"\n        grad_x = (np.roll(field, -1, axis=1) - np.roll(field, 1, axis=1)) / (2 * dx)\n        grad_y = (np.roll(field, -1, axis=0) - np.roll(field, 1, axis=0)) / (2 * dy)\n        return grad_x, grad_y\n\n    def divergence(field_x, field_y, dx, dy):\n        \"\"\"Computes the divergence of a 2D vector field using 2nd-order central differences with periodic BCs.\"\"\"\n        dfx_dx = (np.roll(field_x, -1, axis=1) - np.roll(field_x, 1, axis=1)) / (2 * dx)\n        dfy_dy = (np.roll(field_y, -1, axis=0) - np.roll(field_y, 1, axis=0)) / (2 * dy)\n        return dfx_dx + dfy_dy\n\n    def calculate_imbalance(Lx, Ly, Nx, Ny, R_val, epsilon_factor, sigma, p_out, delta):\n        \"\"\"\n        Performs the full calculation for a single test case.\n        \"\"\"\n        # 1. Grid setup\n        dx = Lx / Nx\n        dy = Ly / Ny\n        \n        # In Case C, R is defined relative to dx\n        if R_val < 0:\n            R = abs(R_val) * dx\n        else:\n            R = R_val\n\n        # Epsilon is defined relative to dx\n        epsilon = epsilon_factor * dx\n\n        x = (np.arange(Nx) + 0.5) * dx\n        y = (np.arange(Ny) + 0.5) * dy\n        xx, yy = np.meshgrid(x, y)\n\n        xc, yc = Lx / 2.0, Ly / 2.0\n\n        # 2. Construct color function\n        r = np.sqrt((xx - xc)**2 + (yy - yc)**2)\n        C = 0.5 * (1.0 - np.tanh((r - R) / epsilon))\n\n        # 3. Compute CSF force\n        grad_C_x, grad_C_y = gradient(C, dx, dy)\n        \n        grad_C_norm = np.sqrt(grad_C_x**2 + grad_C_y**2)\n        \n        # Regularized normal vector\n        nx = grad_C_x / (grad_C_norm + delta)\n        ny = grad_C_y / (grad_C_norm + delta)\n\n        # Curvature\n        kappa = -divergence(nx, ny, dx, dy)\n\n        # CSF force\n        f_sigma_x = sigma * kappa * grad_C_x\n        f_sigma_y = sigma * kappa * grad_C_y\n\n        # 4. Construct pressure field\n        p_in = p_out + sigma / R\n        p = np.where(C >= 0.5, p_in, p_out)\n\n        # 5. Compute pressure gradient\n        grad_p_x, grad_p_y = gradient(p, dx, dy)\n\n        # 6. Form the residual imbalance\n        res_x = grad_p_x - f_sigma_x\n        res_y = grad_p_y - f_sigma_y\n\n        # 7. Compute error metrics\n        res_norm_sq = res_x**2 + res_y**2\n        f_sigma_norm_sq = f_sigma_x**2 + f_sigma_y**2\n\n        # L2-relative imbalance\n        # The dx*dy terms in the integral cancel out\n        E2_num = np.sqrt(np.sum(res_norm_sq))\n        E2_den = np.sqrt(np.sum(f_sigma_norm_sq))\n        E2 = E2_num / E2_den if E2_den > 0 else 0.0\n\n        # L-infinity-relative imbalance\n        E_inf_num = np.sqrt(np.max(res_norm_sq))\n        E_inf_den = np.sqrt(np.max(f_sigma_norm_sq))\n        E_inf = E_inf_num / E_inf_den if E_inf_den > 0 else 0.0\n        \n        return E2, E_inf\n\n    # Test suite from the problem statement\n    # R_val is negative for cases where R is defined relative to dx\n    test_cases = [\n        # Case A\n        {'Lx': 1e-3, 'Ly': 1e-3, 'Nx': 128, 'Ny': 128, 'R_val': 2.5e-4, 'epsilon_factor': 2.0, 'sigma': 7.2e-2, 'p_out': 0.0, 'delta': 1e-12},\n        # Case B\n        {'Lx': 1e-3, 'Ly': 1e-3, 'Nx': 32, 'Ny': 32, 'R_val': 2.5e-4, 'epsilon_factor': 1.0, 'sigma': 7.2e-2, 'p_out': 0.0, 'delta': 1e-12},\n        # Case C\n        {'Lx': 1e-3, 'Ly': 1e-3, 'Nx': 128, 'Ny': 128, 'R_val': -6.0, 'epsilon_factor': 1.0, 'sigma': 7.2e-2, 'p_out': 0.0, 'delta': 1e-12},\n    ]\n\n    results = []\n    for case in test_cases:\n        E2, E_inf = calculate_imbalance(**case)\n        results.append(E2)\n        results.append(E_inf)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}