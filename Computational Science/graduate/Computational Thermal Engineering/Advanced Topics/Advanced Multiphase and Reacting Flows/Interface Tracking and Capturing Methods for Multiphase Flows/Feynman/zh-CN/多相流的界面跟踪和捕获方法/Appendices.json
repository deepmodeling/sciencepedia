{
    "hands_on_practices": [
        {
            "introduction": "界面捕捉方法的核心在于精确地平流输运代表相界面的示踪函数。本练习将通过一个基础的一维问题，让您亲手实践有限体积法中保守离散格式的核心机制。通过对一个初始为方波的体积分数（Volume of Fluid, VOF）场应用一阶迎风（供体单元）格式进行单时间步的推进，您将深入理解数值通量的计算以及它如何导致界面随时间的演化，这是掌握更复杂计算流体力学（CFD）模拟的基石。",
            "id": "3964146",
            "problem": "一维流体体积 (VOF) 指示函数 $F(x,t)$，表示液体体积分数，其值界于 $[0,1]$ 内，满足在恒定速度场 $u$ 下的被动平流守恒定律：$\\partial F / \\partial t + \\partial (u F) / \\partial x = 0$。考虑一个具有 $N=12$ 个单元的均匀有限体积网格，采用周期性边界条件，在时间层 $t^{n}$ 上的单元平均值为 $F_{i}^{n}$，其中整数索引 $i \\in \\{1,2,\\dots,12\\}$。网格间距为 $\\Delta x = 1.0 \\times 10^{-3}\\ \\mathrm{m}$，速度为 $u = 2.0\\ \\mathrm{m/s}$，时间步长为 $\\Delta t = 3.0 \\times 10^{-4}\\ \\mathrm{s}$。Courant–Friedrichs–Lewy (CFL) 数定义为 $\\alpha = u \\Delta t / \\Delta x$。初始数据为一个方波，\n- 当 $i \\in \\{4,5,6,7\\}$ 时，$F_{i}^{0} = 1$，\n- 对于所有其他 $i$，$F_{i}^{0} = 0$，\n索引具有周期性（例如，$F_{0}^{0} \\equiv F_{12}^{0}$，$F_{13}^{0} \\equiv F_{1}^{0}$）。\n\n使用显式守恒有限体积更新方法，配合一阶迎风（供体单元）数值通量（这是一种有界迎风格式），将解推进一个时间步长，并计算单元 $i=8$ 中更新后的体积分数，即 $F_{8}^{1}$，其结果应为一个纯数。请用一个精确的数值表示最终答案，不带单位，也无需四舍五入。",
            "solution": "该问题要求计算一个由一维线性平流方程控制的流体体积 (VOF) 指示函数 $F(x,t)$ 的更新后的单元平均值。该问题使用守恒有限体积法进行离散化。\n\n被动标量 $F$ 在恒定速度 $u$ 下平流的控制偏微分方程如下：\n$$\n\\frac{\\partial F}{\\partial t} + \\frac{\\partial (u F)}{\\partial x} = 0\n$$\n由于 $u$ 是常数，该方程可简化为 $\\frac{\\partial F}{\\partial t} + u \\frac{\\partial F}{\\partial x} = 0$。\n有限体积法从守恒定律在一个控制体积（单元）$i$ 上的积分形式开始，该单元的范围从界面 $x_{i-1/2}$ 到 $x_{i+1/2}$，宽度为 $\\Delta x = x_{i+1/2} - x_{i-1/2}$。将方程在单元 $i$ 上积分得到：\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial F}{\\partial t} \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial (uF)}{\\partial x} \\,dx = 0\n$$\n定义单元平均值 $F_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} F(x,t) \\,dx$，并对空间导数项应用微积分基本定理，我们得到：\n$$\n\\frac{d(F_i \\Delta x)}{dt} + (uF)_{i+1/2} - (uF)_{i-1/2} = 0\n$$\n由于 $\\Delta x$ 是常数，这变为：\n$$\n\\frac{dF_i}{dt} + \\frac{1}{\\Delta x} \\left( (uF)_{i+1/2} - (uF)_{i-1/2} \\right) = 0\n$$\n这里，$(uF)_{i \\pm 1/2}$ 表示在单元界面处 $F$ 的通量。我们使用显式前向欧拉格式对该方程进行时间离散化：\n$$\n\\frac{F_i^{n+1} - F_i^n}{\\Delta t} + \\frac{1}{\\Delta x} \\left( \\mathcal{F}_{i+1/2} - \\mathcal{F}_{i-1/2} \\right) = 0\n$$\n其中 $F_i^n$ 是在时间 $t^n$ 的单元平均值，$\\mathcal{F}_{i \\pm 1/2}$ 是在时间 $t^n$ 计算的单元面上的数值通量。对 $F_i^{n+1}$ 进行整理，得到守恒更新公式：\n$$\nF_i^{n+1} = F_i^n - \\frac{\\Delta t}{\\Delta x} \\left( \\mathcal{F}_{i+1/2} - \\mathcal{F}_{i-1/2} \\right)\n$$\n问题指定了数值通量采用一阶迎风（供体单元）格式。给定速度 $u = 2.0\\ \\mathrm{m/s}$，为正值。对于 $u > 0$，流动方向是从左到右，因此界面处的 $F$ 值取自左侧的单元（“迎风”或“供体”单元）。\n因此，单元 $i$ 的右侧和左侧界面上的数值通量分别为：\n$$\n\\mathcal{F}_{i+1/2} = u F_i^n\n$$\n$$\n\\mathcal{F}_{i-1/2} = u F_{i-1}^n\n$$\n将这些表达式代入更新公式中：\n$$\nF_i^{n+1} = F_i^n - \\frac{\\Delta t}{\\Delta x} \\left( u F_i^n - u F_{i-1}^n \\right)\n$$\n我们定义 Courant–Friedrichs–Lewy (CFL) 数为 $\\alpha = \\frac{u \\Delta t}{\\Delta x}$。更新方程变为：\n$$\nF_i^{n+1} = F_i^n - \\alpha \\left( F_i^n - F_{i-1}^n \\right) = (1 - \\alpha)F_i^n + \\alpha F_{i-1}^n\n$$\n这就是正速度下一阶迎风格式的显式更新方程。\n\n现在，我们必须根据给定的数据计算 $\\alpha$ 的值：\n- 速度：$u = 2.0\\ \\mathrm{m/s}$\n- 时间步长：$\\Delta t = 3.0 \\times 10^{-4}\\ \\mathrm{s}$\n- 网格间距：$\\Delta x = 1.0 \\times 10^{-3}\\ \\mathrm{m}$\n\n$$\n\\alpha = \\frac{(2.0) \\times (3.0 \\times 10^{-4})}{1.0 \\times 10^{-3}} = \\frac{6.0 \\times 10^{-4}}{1.0 \\times 10^{-3}} = 6.0 \\times 10^{-1} = 0.6\n$$\n问题要求计算 $F_8^1$，即从 $n=0$ 开始，经过一个时间步长后单元 $i=8$ 中的体积分数。使用 $i=8$ 和 $n=0$ 的更新公式：\n$$\nF_8^1 = (1 - \\alpha)F_8^0 + \\alpha F_7^0\n$$\n我们需要初始值 $F_8^0$ 和 $F_7^0$。问题陈述了初始条件为一个方波：\n- 当 $i \\in \\{4, 5, 6, 7\\}$ 时，$F_i^0 = 1$\n- 对于所有其他 $i$，$F_i^0 = 0$\n\n根据这个定义：\n- 对于单元 $i=8$，由于 $8 \\notin \\{4, 5, 6, 7\\}$，初始值为 $F_8^0 = 0$。\n- 对于单元 $i=7$，由于 $7 \\in \\{4, 5, 6, 7\\}$，初始值为 $F_7^0 = 1$。\n\n将这些值以及 $\\alpha = 0.6$ 代入 $F_8^1$ 的更新方程中：\n$$\nF_8^1 = (1 - 0.6) \\times F_8^0 + 0.6 \\times F_7^0\n$$\n$$\nF_8^1 = (0.4) \\times (0) + 0.6 \\times (1)\n$$\n$$\nF_8^1 = 0 + 0.6\n$$\n$$\nF_8^1 = 0.6\n$$\n经过一个时间步长后，单元 $i=8$ 中更新后的体积分数为 $0.6$。本次特定计算不需要周期性边界条件，因为单元 $8$ 的模板（即单元 $7$ 和 $8$）不跨越区域边界。",
            "answer": "$$\\boxed{0.6}$$"
        },
        {
            "introduction": "当界面穿过计算网格时，会产生包含多种流体的“混合单元”，为这些单元分配合理的有效物理性质是界面捕捉方法中的一个关键挑战。本练习通过一个经典的层流库埃特流（Couette flow）案例，要求您解析地推导不同粘度平均方法（算术平均与调和平均）所导致的剪切应力计算误差。这个实践的独特价值在于，它揭示了数值插值格式选择背后的物理原理，并阐明了为何调和平均对于串联排列的物理过程（如本例中的动量输运）是更优越的选择。",
            "id": "3964117",
            "problem": "考虑两种不互溶、不可压缩的牛顿流体，在相距为 $H$ 的两块无限大平行板之间进行稳态平面 Couette 流。位于 $y=0$ 的下平板是静止的，而位于 $y=H$ 的上平板以速度 $U$ 沿 $x$ 方向平移。流体之间的界面是平面的，位于 $y=fH$，其中 $0  f  1$。下层流体（$0 \\leq y \\leq fH$）的动力粘度为 $\\mu_1$，上层流体（$fH \\leq y \\leq H$）的动力粘度为 $\\mu_2$。我们定义粘度比为 $m = \\mu_2 / \\mu_1$。假设惯性可忽略不计且压力梯度为零。由于剪切应力 $\\tau_{xy}=\\mu\\,\\frac{du}{dy}$ 在整个域内是恒定的，即为精确解 $\\tau_{\\text{true}}$。\n数值求解器使用一个包含混合属性的单网格，它将两种流体视为一个有效粘度为 $\\mu_{\\text{avg}}$ 的单一流体。求解器计算的剪切应力为 $\\tau_{\\text{num}}=\\mu_{\\text{avg}}\\,(U/H)$。考虑两种不同的平均方法：\n\n1.  **算术平均**：$\\mu_A = f\\,\\mu_1 + (1-f)\\,\\mu_2$\n2.  **调和平均**：$\\mu_H = \\left(f/\\mu_1 + (1-f)/\\mu_2\\right)^{-1}$\n\n对于每种平均方法，推导无量纲相对误差 $E = (\\tau_{\\text{num}} - \\tau_{\\text{true}}) / \\tau_{\\text{true}}$，并用无量纲参数 $f$ 和 $m$ 表示。您的答案应为一个 2x1 矩阵，其中包含算术平均的误差 $E_A$ 和调和平均的误差 $E_H$。",
            "solution": "首先根据指定标准对问题进行验证。\n\n### 步骤 1：提取已知条件\n- **系统**：两种不互溶、不可压缩的牛顿流体进行稳态平面 Couette 流。\n- **几何**：两块无限大平行板，间距为 $H$。下平板位于 $y=0$，上平板位于 $y=H$。\n- **运动学**：下平板静止，$u(0)=0$。上平板以速度 $U$ 移动，$u(H)=U$。\n- **流体 1 (下层)**：占据 $0 \\leq y \\leq fH$，动力粘度为 $\\mu_{1}$。\n- **流体 2 (上层)**：占据 $fH \\leq y \\leq H$，动力粘度为 $\\mu_{2}$。\n- **界面**：平面，位于 $y=fH$，其中 $0  f  1$。\n- **粘度比**：$m = \\mu_{2}/\\mu_{1} > 0$。\n- **流动条件**：惯性可忽略（蠕流）且无压力梯度。\n- **本构关系**：剪切应力 $\\tau_{xy}=\\mu\\,\\frac{du}{dy}$。\n- **数值模型**：具有有效粘度 $\\mu_{\\text{avg}}$ 的单网格混合属性模型。\n- **平均方法**：\n  - 算术平均：$\\mu_{A} = f\\,\\mu_{1} + (1-f)\\,\\mu_{2}$。\n  - 调和平均：$\\mu_{H} = \\left(f/\\mu_{1} + (1-f)/\\mu_{2}\\right)^{-1}$。\n- **数值应力**：求解器计算 $\\tau_{\\text{num}}=\\mu_{\\text{avg}}\\,\\frac{U}{H}$。\n- **要求输出**：对于每种平均选择，以 $f$ 和 $m$ 表示的无量纲相对误差 $E = \\frac{\\tau_{\\text{num}} - \\tau_{\\text{true}}}{\\tau_{\\text{true}}}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题描述了层流流体动力学的一个经典案例（分层 Couette 流），该案例牢固地基于在明确定义的简化假设（稳态、不可压缩、无惯性、无压力梯度）下的 Navier-Stokes 方程。用于有效属性的算术和调和平均概念是计算多相流和均匀化理论领域的标准。该问题在科学上是合理的。\n- **适定性**：该问题提供了求解速度剖面和剪切应力所需的所有必要边界条件（$u(0)=0$, $u(H)=U$）和界面条件（速度和应力连续）。设置是完整且一致的，确保存在唯一且有意义的解。\n- **客观性**：该问题使用精确、无歧义的数学和物理术语进行陈述。没有主观或基于观点的内容。\n\n### 步骤 3：结论与行动\n该问题被认为是有效的，因为它具有科学依据、适定且客观。将进行求解推导。\n\n### 精确剪切应力 $\\tau_{\\text{true}}$ 的推导\n对于只有 $x$ 方向速度 $u(y)$ 且无压力梯度的稳态、充分发展的平面流，线性动量守恒方程简化为：\n$$\n\\frac{d}{dy}\\left(\\mu \\frac{du}{dy}\\right) = 0\n$$\n该方程意味着剪切应力 $\\tau_{xy} = \\mu \\frac{du}{dy}$ 在整个域 $0 \\leq y \\leq H$ 内必须是常数。我们将这个常数，即精确剪切应力，记为 $\\tau_{\\text{true}}$。\n\n在每个流体层中，速度梯度是常数：\n- 对于流体 1（$0 \\leq y \\leq fH$）：$\\frac{du_1}{dy} = \\frac{\\tau_{\\text{true}}}{\\mu_1}$。\n- 对于流体 2（$fH \\leq y \\leq H$）：$\\frac{du_2}{dy} = \\frac{\\tau_{\\text{true}}}{\\mu_2}$。\n\n对这些方程关于 $y$ 进行积分，得到速度剖面：\n- $u_1(y) = \\frac{\\tau_{\\text{true}}}{\\mu_1}y + C_1$\n- $u_2(y) = \\frac{\\tau_{\\text{true}}}{\\mu_2}y + C_2$\n\n我们应用边界和界面条件来确定常数 $C_1$、$C_2$ 和 $\\tau_{\\text{true}}$。\n$1$。下平板无滑移：$u_1(0) = 0$。\n$$\n\\frac{\\tau_{\\text{true}}}{\\mu_1}(0) + C_1 = 0 \\implies C_1 = 0\n$$\n所以，$u_1(y) = \\frac{\\tau_{\\text{true}}}{\\mu_1}y$。\n\n$2$。界面 $y=fH$ 处速度连续：$u_1(fH) = u_2(fH)$。\n$$\n\\frac{\\tau_{\\text{true}}}{\\mu_1}(fH) = \\frac{\\tau_{\\text{true}}}{\\mu_2}(fH) + C_2 \\implies C_2 = \\tau_{\\text{true}}fH\\left(\\frac{1}{\\mu_1} - \\frac{1}{\\mu_2}\\right)\n$$\n\n$3$。上平板无滑移：$u_2(H) = U$。\n$$\nU = u_2(H) = \\frac{\\tau_{\\text{true}}}{\\mu_2}H + C_2\n$$\n代入 $C_2$ 的表达式：\n$$\nU = \\frac{\\tau_{\\text{true}}}{\\mu_2}H + \\tau_{\\text{true}}fH\\left(\\frac{1}{\\mu_1} - \\frac{1}{\\mu_2}\\right)\n$$\n$$\nU = \\tau_{\\text{true}}H \\left[ \\frac{1}{\\mu_2} + \\frac{f}{\\mu_1} - \\frac{f}{\\mu_2} \\right] = \\tau_{\\text{true}}H \\left[ \\frac{f}{\\mu_1} + \\frac{1-f}{\\mu_2} \\right]\n$$\n求解精确剪切应力 $\\tau_{\\text{true}}$：\n$$\n\\tau_{\\text{true}} = \\frac{U}{H \\left( \\frac{f}{\\mu_1} + \\frac{1-f}{\\mu_2} \\right)}\n$$\n使用粘度比 $m = \\mu_2/\\mu_1$，我们可以写作 $\\mu_2 = m\\mu_1$。\n$$\n\\tau_{\\text{true}} = \\frac{U}{H \\left( \\frac{f}{\\mu_1} + \\frac{1-f}{m\\mu_1} \\right)} = \\frac{U\\mu_1}{H \\left( f + \\frac{1-f}{m} \\right)} = \\frac{U\\mu_1 m}{H (mf + 1 - f)} = \\frac{U\\mu_1 m}{H(1 + f(m-1))}\n$$\n\n### 相对误差 $E$ 的推导\n数值模型假设流体为粘度为 $\\mu_{\\text{avg}}$ 的单一流体，并预测出一个均匀的剪切率 $\\frac{U}{H}$。数值计算的剪切应力由下式给出：\n$$\n\\tau_{\\text{num}} = \\mu_{\\text{avg}} \\frac{U}{H}\n$$\n相对误差 $E$ 定义为：\n$$\nE = \\frac{\\tau_{\\text{num}} - \\tau_{\\text{true}}}{\\tau_{\\text{true}}} = \\frac{\\tau_{\\text{num}}}{\\tau_{\\text{true}}} - 1\n$$\n代入 $\\tau_{\\text{num}}$ 和 $\\tau_{\\text{true}}$ 的表达式：\n$$\n\\frac{\\tau_{\\text{num}}}{\\tau_{\\text{true}}} = \\frac{\\mu_{\\text{avg}} \\frac{U}{H}}{\\frac{U\\mu_1 m}{H(1 + f(m-1))}} = \\frac{\\mu_{\\text{avg}}}{\\mu_1} \\frac{1 + f(m-1)}{m}\n$$\n因此，误差的通用表达式为：\n$$\nE = \\left(\\frac{\\mu_{\\text{avg}}}{\\mu_1}\\right) \\frac{1 + f(m-1)}{m} - 1\n$$\n\n### 情况 1：算术平均 ($E_A$)\n对于算术平均，$\\mu_{\\text{avg}} = \\mu_A = f\\mu_1 + (1-f)\\mu_2$。\n比值 $\\mu_A/\\mu_1$ 为：\n$$\n\\frac{\\mu_A}{\\mu_1} = \\frac{f\\mu_1 + (1-f)\\mu_2}{\\mu_1} = f + (1-f)\\frac{\\mu_2}{\\mu_1} = f + (1-f)m\n$$\n将此代入误差表达式：\n$$\nE_A = (f + (1-f)m) \\frac{1 + f(m-1)}{m} - 1\n$$\n$$\nE_A = \\frac{(f(1-m)+m)(1+f(m-1))}{m} - 1\n$$\n我们展开分子并减去 $m$：\n$$\n\\text{Numerator} - m = [f(1-m)+m] [1+f(m-1)] - m\n$$\n$$\n= f(1-m) + f^2(1-m)(m-1) + m + mf(m-1) - m\n$$\n$$\n= -f(m-1) - f^2(m-1)^2 + mf(m-1)\n$$\n$$\n= f(m-1)[-1 - f(m-1) + m] = f(m-1)[m-1 - f(m-1)]\n$$\n$$\n= f(m-1)(m-1)(1-f) = f(1-f)(m-1)^2\n$$\n因此，误差为：\n$$\nE_A = \\frac{f(1-f)(m-1)^2}{m}\n$$\n\n### 情况 2：调和平均 ($E_H$)\n对于调和平均，$\\mu_{\\text{avg}} = \\mu_H = \\left(\\frac{f}{\\mu_1} + \\frac{1-f}{\\mu_2}\\right)^{-1}$。\n比值 $\\mu_H/\\mu_1$ 为：\n$$\n\\frac{\\mu_H}{\\mu_1} = \\frac{1}{\\mu_1}\\left(\\frac{f}{\\mu_1} + \\frac{1-f}{\\mu_2}\\right)^{-1} = \\left(\\mu_1\\left(\\frac{f}{\\mu_1} + \\frac{1-f}{m\\mu_1}\\right)\\right)^{-1}\n$$\n$$\n\\frac{\\mu_H}{\\mu_1} = \\left(f + \\frac{1-f}{m}\\right)^{-1} = \\left(\\frac{mf + 1-f}{m}\\right)^{-1} = \\frac{m}{1 + f(m-1)}\n$$\n将此代入通用误差表达式：\n$$\nE_H = \\left(\\frac{m}{1 + f(m-1)}\\right) \\frac{1 + f(m-1)}{m} - 1\n$$\n$$\nE_H = 1 - 1 = 0\n$$\n调和平均精确地再现了该问题的真实剪切应力，因此误差为零。这是因为就动量输运而言，流体层是串联排列的，而调和平均值能正确计算串联构型的有效属性。\n\n最终结果是数对 $(E_A, E_H)$。\n$E_A = \\frac{f(1-f)(m-1)^2}{m}$\n$E_H = 0$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{f(1-f)(m-1)^{2}}{m} \\\\ 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在多相流模拟中，使用连续表面力（Continuum Surface Force, CSF）模型在同位网格（collocated grid）上处理表面张力时，即使在静态情况下也常常会产生被称为“伪电流”的非物理数值噪声。本实践旨在解决这一核心难题，指导您设计并验证一种“力平衡”离散格式，即在离散层面保证压力梯度和表面张力项能够精确抵消。通过亲手编写代码并对比平衡与非平衡格式的残差，您将深刻体会到一致的、精心设计的离散化方案对于消除数值伪影、实现高保真度模拟的决定性作用。",
            "id": "3964091",
            "problem": "考虑一个二维、不可混溶、不可压缩、等温的静态构型，其中两相在一个周期性方形域中由一个圆形界面分隔。目标是在同位网格上设计并验证一种压力梯度和表面张力的平衡离散格式，该格式能在无运动情况下最小化伪电流。推导和实现应从第一性原理和公认事实出发，不应将任何目标公式作为已知条件来调用。\n\n物理和数值设置如下。\n\n- 域：边长为 $L$ 的正方形，在两个方向上均采用周期性边界条件。在无量纲单位下，使用 $L = 1$。\n- 界面：一个半径为 $R = 0.25$、圆心位于 $(x_c, y_c) = (0.5, 0.5)$ 的圆。\n- 表面张力系数：$\\sigma = 1$（无量纲）。\n- 密度和粘度：取均匀密度 $\\rho = 1$（无量纲），并忽略粘度，因为速度是静态的，粘性项为零。\n- 网格：一个包含 $N \\times N$ 个控制体的均匀同位网格，未知量位于单元中心，单元尺寸为 $\\Delta x = \\Delta y = L / N$。单元中心的坐标为 $(x_i, y_j) = \\big((i+0.5)\\Delta x, (j+0.5)\\Delta y\\big)$，其中整数 $i,j$ 在 $[0, N-1]$ 范围内。计算离散导数时应强制执行周期性。\n\n从静态情况下不可压缩流的线性动量基本平衡方程出发，该方程通过连续表面力（CSF）方法（Continuum Surface Force (CSF)）引入了表面张力：\n$$\n\\mathbf{0} = -\\nabla p + \\mathbf{f}_\\sigma,\n$$\n其中 $\\mathbf{f}_\\sigma$ 是表面张力密度。对于尖锐界面连续模型，圆的平均曲率 $ \\kappa $ 是一个常数，为 $ \\kappa = 1/R $。在平衡状态下，要实现连续抵消，一个充分条件是将毛细管贡献表示为一个压力跳跃，该跳跃通过基于到界面的有符号距离 $\\phi$ 的平滑亥维赛函数 $H_\\varepsilon(\\phi)$ 来编码：\n$$\np(\\mathbf{x}) = p_0 + \\sigma \\kappa \\, H_\\varepsilon(\\phi(\\mathbf{x})), \\quad \\mathbf{f}_\\sigma(\\mathbf{x}) = \\sigma \\kappa \\, \\nabla H_\\varepsilon(\\phi(\\mathbf{x})),\n$$\n这样在连续设定下，$-\\nabla p + \\mathbf{f}_\\sigma = \\mathbf{0}$。这里 $H_\\varepsilon$ 是平滑半厚度为 $\\varepsilon$ 的正则化亥维赛函数，而 $\\phi(\\mathbf{x})$ 定义为到界面的有符号距离（圆内为负，圆外为正）。\n\n您的任务是构建一种同位有限体积/有限差分离散格式，在离散设定下能达到机器精度的相同抵消效果。具体而言：\n\n1. 在单元中心上定义有符号距离场 $\\phi(x,y) = \\sqrt{(x-x_c)^2+(y-y_c)^2} - R$。\n2. 将平滑半厚度为 $\\varepsilon$ 的正则化亥维赛函数 $H_\\varepsilon(\\phi)$ 定义为\n   $$\n   H_\\varepsilon(\\phi) =\n   \\begin{cases}\n   0,  \\phi \\le -\\varepsilon, \\\\\n   \\frac{1}{2}\\left[1 + \\frac{\\phi}{\\varepsilon} + \\frac{1}{\\pi}\\sin\\left(\\pi \\frac{\\phi}{\\varepsilon}\\right)\\right],  |\\phi|  \\varepsilon, \\\\\n   1,  \\phi \\ge \\varepsilon.\n   \\end{cases}\n   $$\n3. 使用解析曲率 $\\kappa = 1/R$（常数）。\n4. 在单元中心将离散压力场定义为 $p = \\sigma \\kappa H_\\varepsilon(\\phi)$。\n5. 在同位网格上使用带周期性环绕的二阶中心差分定义一个离散梯度算子：\n   $$\n   \\left[\\nabla_h q\\right]_x(i,j) = \\frac{q(i+1,j)-q(i-1,j)}{2\\Delta x}, \\quad\n   \\left[\\nabla_h q\\right]_y(i,j) = \\frac{q(i,j+1)-q(i,j-1)}{2\\Delta y}.\n   $$\n   在平衡离散格式中，对压力梯度和亥维赛场的梯度都使用这同一个算子。\n6. 构建两个离散力残差 $\\mathbf{r}(i,j)$，定义为每单位密度的静态动量平衡中的不匹配量：\n   - 平衡格式： \n     $$\n     \\mathbf{r}_\\text{bal}(i,j) = -\\nabla_h p(i,j) + \\sigma \\kappa \\, \\nabla_h H_\\varepsilon(\\phi)(i,j).\n     $$\n   - 非平衡格式（用于比较）：对 $-\\nabla_h p$ 使用相同的 $\\nabla_h$，但用带周期性环绕的一阶向前差分来近似 $\\nabla H_\\varepsilon$，\n     $$\n     \\left[\\nabla^{+} q\\right]_x(i,j) = \\frac{q(i+1,j)-q(i,j)}{\\Delta x}, \\quad\n     \\left[\\nabla^{+} q\\right]_y(i,j) = \\frac{q(i,j+1)-q(i,j)}{\\Delta y},\n     $$\n     并定义\n     $$\n     \\mathbf{r}_\\text{unbal}(i,j) = -\\nabla_h p(i,j) + \\sigma \\kappa \\, \\nabla^{+} H_\\varepsilon(\\phi)(i,j).\n     $$\n7. 对每个残差场，计算所有单元上的最大欧几里得范数，\n   $$\n   \\|\\mathbf{r}\\|_{\\infty,2} = \\max_{i,j} \\sqrt{r_x(i,j)^2 + r_y(i,j)^2}.\n   $$\n\n所有量均为无量纲；输出中不使用物理单位。\n\n测试套件和要求输出：\n\n- 使用上述域和参数以及以下三个测试案例。对每个案例，将平滑定义为 $\\varepsilon = \\alpha \\Delta x$，其中 $\\alpha$ 是一个无量纲因子。\n  - 案例 A（理想路径）：$N = 64$，$\\alpha = 1.5$。\n  - 案例 B（粗网格边界情况）：$N = 16$，$\\alpha = 1.5$。\n  - 案例 C（欠解析界面边缘情况）：$N = 32$，$\\alpha = 0.5$。\n- 对每个案例，计算三个浮点数：平衡残差范数 $\\|\\mathbf{r}_\\text{bal}\\|_{\\infty,2}$，非平衡残差范数 $\\|\\mathbf{r}_\\text{unbal}\\|_{\\infty,2}$，以及它们的比率 $\\|\\mathbf{r}_\\text{bal}\\|_{\\infty,2} / \\|\\mathbf{r}_\\text{unbal}\\|_{\\infty,2}$。\n\n最终输出格式规范：\n\n- 您的程序应生成单行输出，其中包含一个按以下顺序排列的九个浮点数的列表\n  $$\n  \\big[\\|\\mathbf{r}_\\text{bal}\\|_{\\infty,2}^{(A)}, \\|\\mathbf{r}_\\text{unbal}\\|_{\\infty,2}^{(A)}, \\rho^{(A)}, \\|\\mathbf{r}_\\text{bal}\\|_{\\infty,2}^{(B)}, \\|\\mathbf{r}_\\text{unbal}\\|_{\\infty,2}^{(B)}, \\rho^{(B)}, \\|\\mathbf{r}_\\text{bal}\\|_{\\infty,2}^{(C)}, \\|\\mathbf{r}_\\text{unbal}\\|_{\\infty,2}^{(C)}, \\rho^{(C)}\\big],\n  $$\n  其中 $\\rho^{(\\cdot)}$ 表示相应案例的比率。该列表必须以逗号分隔，并用方括号括起来打印，不含额外文本，例如：“[1.0,2.0,0.5, ...]”。",
            "solution": "问题陈述经评估有效。其科学基础在于多相流的计算流体动力学原理，特别是关于表面张力的数值处理。该问题是适定的、客观的、自洽的，并在验证平衡力离散格式的属性方面提出了一个不小的挑战。\n\n主要目标是证明对压力梯度和表面张力进行一致（或“平衡”）离散化的重要性，以消除静态界面上的伪电流。我们从静态、不可压缩动量方程出发，该方程表示压力梯度力和表面张力密度 $\\mathbf{f}_\\sigma$ 之间的平衡：\n$$\n\\mathbf{0} = -\\nabla p + \\mathbf{f}_\\sigma\n$$\n在连续表面力（CSF）模型中，仅在界面上起作用的表面张力被表示为作用在界面周围薄区域内的体积力密度。这是通过使用正则化的狄拉克δ函数来实现的，该函数可以表示为正则化亥维赛函数 $H_\\varepsilon(\\phi)$ 的梯度，其中 $\\phi$ 是到界面的有符号距离函数。力密度由 $\\mathbf{f}_\\sigma = \\sigma \\kappa \\mathbf{n} \\delta_\\varepsilon(\\phi) = \\sigma \\kappa \\nabla H_\\varepsilon(\\phi)$ 给出，其中 $\\sigma$ 是表面张力系数，$\\kappa$ 是界面平均曲率。\n\n对于静态圆形界面，曲率 $\\kappa$ 是恒定的，等于 $1/R$。杨-拉普拉斯方程规定，界面上存在一个等于 $\\sigma \\kappa$ 的压力跳跃。这可以通过将压力场定义为 $p(\\mathbf{x}) = p_0 + \\sigma \\kappa H_\\varepsilon(\\phi(\\mathbf{x}))$ 来连续地表示，其中 $p_0$ 是一个参考压力。由于常数 $p_0$ 的梯度为零，可以将其省略，动量平衡变为：\n$$\n\\mathbf{0} = -\\nabla (\\sigma \\kappa H_\\varepsilon(\\phi)) + \\sigma \\kappa \\nabla H_\\varepsilon(\\phi)\n$$\n由于 $\\sigma$ 和 $\\kappa$ 是常数，梯度算子对乘积满足分配律，得到 $-\\sigma \\kappa \\nabla H_\\varepsilon(\\phi) + \\sigma \\kappa \\nabla H_\\varepsilon(\\phi) = \\mathbf{0}$。这证明了在连续设定下的完美平衡。我们的目标是在离散设定下保持这种平衡。\n\n数值实现过程如下：\n\n1.  **网格和场生成**：我们在域 $[0, L] \\times [0, L]$（其中 $L=1$）上定义一个大小为 $N \\times N$ 的均匀同位网格。单元中心位于 $(x_i, y_j) = ((i+0.5)\\Delta x, (j+0.5)\\Delta y)$，其中 $i,j \\in [0, N-1]$，且 $\\Delta x = \\Delta y = L/N$。在每个单元中心，我们计算到以 $(x_c, y_c) = (0.5, 0.5)$ 为中心、半径为 $R=0.25$ 的圆的有符号距离函数 $\\phi_{i,j}$：\n    $$\n    \\phi_{i,j} = \\sqrt{(x_i - x_c)^2 + (y_j - y_c)^2} - R\n    $$\n    使用 $\\phi_{i,j}$，我们根据提供的分段公式计算离散的正则化亥维赛场 $H_{\\varepsilon}(\\phi_{i,j})$，其中平滑宽度为 $\\varepsilon = \\alpha \\Delta x$。\n\n2.  **离散压力和算子**：离散压力场在单元中心定义为 $p_{i,j} = \\sigma \\kappa H_{\\varepsilon}(\\phi_{i,j})$，其中 $\\sigma=1$ 且 $\\kappa = 1/R = 4$。我们使用两种类型的离散梯度算子。二阶中心差分算子 $\\nabla_h$ 定义为：\n    $$\n    \\left[\\nabla_h q\\right]_x(i,j) = \\frac{q_{i+1,j}-q_{i-1,j}}{2\\Delta x}, \\quad\n    \\left[\\nabla_h q\\right]_y(i,j) = \\frac{q_{i,j+1}-q_{i,j-1}}{2\\Delta y}\n    $$\n    一阶向前差分算子 $\\nabla^{+}$ 定义为：\n    $$\n    \\left[\\nabla^{+} q\\right]_x(i,j) = \\frac{q_{i+1,j}-q_{i,j}}{\\Delta x}, \\quad\n    \\left[\\nabla^{+} q\\right]_y(i,j) = \\frac{q_{i,j+1}-q_{i,j}}{\\Delta y}\n    $$\n    通过对索引使用模运算（例如，$q_{N,j} = q_{0,j}$）来强制执行周期性。\n\n3.  **残差计算**：我们计算平衡和非平衡格式的残差。\n    -   **平衡格式**：压力梯度和表面张力都使用相同的算子 $\\nabla_h$ 进行离散化：\n        $$\n        \\mathbf{r}_\\text{bal}(i,j) = -\\nabla_h p_{i,j} + \\sigma \\kappa \\, \\nabla_h H_\\varepsilon(\\phi_{i,j})\n        $$\n        代入 $p_{i,j} = \\sigma \\kappa H_{\\varepsilon}(\\phi_{i,j})$ 并利用离散算子 $\\nabla_h$ 的线性性质：\n        $$\n        \\mathbf{r}_\\text{bal}(i,j) = -\\nabla_h (\\sigma \\kappa H_{\\varepsilon}(\\phi_{i,j})) + \\sigma \\kappa \\, \\nabla_h H_\\varepsilon(\\phi_{i,j}) = -\\sigma \\kappa \\nabla_h H_{\\varepsilon}(\\phi_{i,j}) + \\sigma \\kappa \\, \\nabla_h H_\\varepsilon(\\phi_{i,j}) = \\mathbf{0}\n        $$\n        这种离散抵消在代数上是精确的。任何非零结果都完全是由于有限精度浮点运算造成的，其量级应与机器精度相当。\n\n    -   **非平衡格式**：压力梯度用 $\\nabla_h$ 离散，而表面张力项用 $\\nabla^{+}$ 近似：\n        $$\n        \\mathbf{r}_\\text{unbal}(i,j) = -\\nabla_h p_{i,j} + \\sigma \\kappa \\, \\nabla^{+} H_\\varepsilon(\\phi_{i,j})\n        $$\n        代入 $p_{i,j}$：\n        $$\n        \\mathbf{r}_\\text{unbal}(i,j) = -\\sigma \\kappa \\nabla_h H_{\\varepsilon}(\\phi_{i,j}) + \\sigma \\kappa \\, \\nabla^{+} H_\\varepsilon(\\phi_{i,j}) = \\sigma \\kappa \\left( \\nabla^{+} H_\\varepsilon(\\phi_{i,j}) - \\nabla_h H_\\varepsilon(\\phi_{i,j}) \\right)\n        $$\n        由于 $\\nabla_h$ 和 $\\nabla^{+}$ 是具有不同截断误差的不同离散算子，它们的差不为零。$\\nabla^{+}$ 的截断误差为 $O(\\Delta x)$，而 $\\nabla_h$ 的截断误差为 $O(\\Delta x^2)$。因此，它们的差为 $O(\\Delta x)$，这会导致一个显著的残差，该残差在网格加密时不会消失，从而在瞬态模拟中引起伪电流。\n\n4.  **范数计算**：对于每个残差场 $\\mathbf{r}(i,j) = (r_x(i,j), r_y(i,j))$，我们计算网格上的最大离散L2范数：\n    $$\n    \\|\\mathbf{r}\\|_{\\infty,2} = \\max_{i,j} \\sqrt{r_x(i,j)^2 + r_y(i,j)^2}\n    $$\n    该度量标准量化了最大局部力不平衡的量级。为每个测试案例计算的结果将定量地验证平衡力方法的优越性。对于所有情况，$\\|\\mathbf{r}_\\text{bal}\\|_{\\infty,2}$ 预计将接近机器精度，而 $\\|\\mathbfr}_\\text{unbal}\\|_{\\infty,2}$ 将大几个数量级。因此，比率 $\\|\\mathbf{r}_\\text{bal}\\|_{\\infty,2} / \\|\\mathbf{r}_\\text{unbal}\\|_{\\infty,2}$ 将会非常小。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the balanced-force discretization problem for three test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (64, 1.5),  # Case A\n        (16, 1.5),  # Case B\n        (32, 0.5),  # Case C\n    ]\n\n    results = []\n    \n    # Common parameters\n    L = 1.0\n    R = 0.25\n    xc, yc = 0.5, 0.5\n    sigma = 1.0\n    kappa = 1.0 / R\n\n    for N, alpha in test_cases:\n        # 1. Grid and Field Generation\n        dx = L / N\n        \n        # Create cell-centered grid coordinates\n        grid_1d = (np.arange(N) + 0.5) * dx\n        x, y = np.meshgrid(grid_1d, grid_1d)\n\n        # Calculate signed distance field\n        phi = np.sqrt((x - xc)**2 + (y - yc)**2) - R\n        \n        # Calculate regularized Heaviside function H_eps\n        eps = alpha * dx\n        H = np.zeros_like(phi)\n        \n        # Region phi >= eps\n        H[phi >= eps] = 1.0\n        \n        # Region |phi|  eps\n        mask = np.abs(phi)  eps\n        phi_masked = phi[mask]\n        H[mask] = 0.5 * (1.0 + phi_masked / eps + (1.0 / np.pi) * np.sin(np.pi * phi_masked / eps))\n\n        # 2. Discrete Pressure\n        p = sigma * kappa * H\n\n        # 3. Discrete Gradient Operators (with periodic boundaries)\n        def grad_central(q, delta):\n            gx = (np.roll(q, -1, axis=1) - np.roll(q, 1, axis=1)) / (2.0 * delta)\n            gy = (np.roll(q, -1, axis=0) - np.roll(q, 1, axis=0)) / (2.0 * delta)\n            return gx, gy\n\n        def grad_forward(q, delta):\n            gx = (np.roll(q, -1, axis=1) - q) / delta\n            gy = (np.roll(q, -1, axis=0) - q) / delta\n            return gx, gy\n\n        # 4. Residual Calculation\n        # Pressure gradient using central differences for both schemes\n        grad_p_x, grad_p_y = grad_central(p, dx)\n\n        # Balanced scheme\n        grad_H_bal_x, grad_H_bal_y = grad_central(H, dx)\n        res_bal_x = -grad_p_x + sigma * kappa * grad_H_bal_x\n        res_bal_y = -grad_p_y + sigma * kappa * grad_H_bal_y\n\n        # Unbalanced scheme\n        grad_H_unbal_x, grad_H_unbal_y = grad_forward(H, dx)\n        res_unbal_x = -grad_p_x + sigma * kappa * grad_H_unbal_x\n        res_unbal_y = -grad_p_y + sigma * kappa * grad_H_unbal_y\n\n        # 5. Norm Computation\n        norm_bal = np.max(np.sqrt(res_bal_x**2 + res_bal_y**2))\n        norm_unbal = np.max(np.sqrt(res_unbal_x**2 + res_unbal_y**2))\n        \n        # Handle potential division by zero if norm_unbal is zero\n        # (unlikely, but good practice)\n        ratio = norm_bal / norm_unbal if norm_unbal != 0 else 0.0\n\n        results.extend([norm_bal, norm_unbal, ratio])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}