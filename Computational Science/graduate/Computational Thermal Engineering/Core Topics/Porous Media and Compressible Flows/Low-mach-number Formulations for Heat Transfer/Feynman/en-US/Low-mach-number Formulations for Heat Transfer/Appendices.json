{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of low-Mach-number formulations is understanding how thermal effects drive fluid motion. In this framework, heating causes local gas expansion, which must be accommodated by a non-zero velocity divergence, $ \\nabla \\cdot \\mathbf{u} $. This exercise provides a foundational practice in deriving this divergence source term directly from the conservation laws and the ideal gas equation of state, solidifying the link between thermodynamics and fluid dynamics in thermally-driven flows. ",
            "id": "3968942",
            "problem": "Consider a single-component ideal gas in a large periodic domain undergoing a low-Mach-number flow, where the thermodynamic pressure is spatially uniform and constant, $p = p_0$. The fluid is heated uniformly by a volumetric heat source of magnitude $Q$ (energy per unit volume per unit time). Assume constant specific heat capacity at constant pressure $c_p$, constant ideal-gas constant $R$, negligible viscous dissipation, no species diffusion or reactions, and a spatially uniform temperature field so that heat conduction does not contribute ($\\nabla T = \\mathbf{0}$).\n\nStarting from the continuity equation, the ideal-gas equation of state, and the enthalpy-based energy equation with specific enthalpy $h = c_p T$, derive the low-Mach-number divergence constraint and compute the divergence source $S$ such that $\\nabla \\cdot \\mathbf{u} = S$ expressed solely in terms of $Q$, $c_p$, $p_0$, and $R$.\n\nPresent your final expression for $S$ as a single closed-form analytic expression. Express the magnitude of $S$ in $\\mathrm{s}^{-1}$.",
            "solution": "The user wants me to derive the low-Mach-number divergence constraint for a single-component ideal gas subjected to uniform volumetric heating. The final expression for the divergence source, $S = \\nabla \\cdot \\mathbf{u}$, must be given in terms of the volumetric heat source $Q$, the specific heat capacity at constant pressure $c_p$, the constant pressure $p_0$, and the specific ideal-gas constant $R$.\n\nThe derivation proceeds by combining three fundamental equations: the continuity equation, the ideal-gas equation of state, and the energy equation, under the specified assumptions.\n\nThe starting point is the continuity equation, which expresses the conservation of mass:\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\mathbf{u}) = 0\n$$\nwhere $\\rho$ is the fluid density and $\\mathbf{u}$ is the velocity vector. Using the product rule for divergence, we can expand the second term:\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\rho (\\nabla \\cdot \\mathbf{u}) + \\mathbf{u} \\cdot \\nabla \\rho = 0\n$$\nThe problem states that the temperature field is spatially uniform, i.e., $\\nabla T = \\mathbf{0}$. We can use this information along with the ideal-gas equation of state, $p = \\rho R T$, to determine the spatial variation of density. Given that the pressure is constant and uniform ($p=p_0$) and the gas constant $R$ is constant, we can write the density as $\\rho = \\frac{p_0}{RT}$. Taking the gradient of the density yields:\n$$\n\\nabla \\rho = \\nabla \\left( \\frac{p_0}{R T} \\right) = -\\frac{p_0}{R T^2} \\nabla T\n$$\nSince $\\nabla T = \\mathbf{0}$, it follows that the density gradient is also zero, $\\nabla \\rho = \\mathbf{0}$. This means the density $\\rho$ is spatially uniform and can only be a function of time, $\\rho = \\rho(t)$.\n\nWith $\\nabla \\rho = \\mathbf{0}$, the term $\\mathbf{u} \\cdot \\nabla \\rho$ in the expanded continuity equation vanishes. Furthermore, since $\\rho$ is only a function of time, the partial time derivative becomes an ordinary time derivative, $\\frac{\\partial \\rho}{\\partial t} = \\frac{d\\rho}{dt}$. The continuity equation simplifies to:\n$$\n\\frac{d\\rho}{dt} + \\rho (\\nabla \\cdot \\mathbf{u}) = 0\n$$\nRearranging this equation gives an expression for the velocity divergence, which we aim to find:\n$$\n\\nabla \\cdot \\mathbf{u} = -\\frac{1}{\\rho}\\frac{d\\rho}{dt}\n$$\nTo proceed, we need to relate the time derivative of density, $\\frac{d\\rho}{dt}$, to the given thermodynamic quantities. We can achieve this by differentiating the ideal-gas equation of state with respect to time. Starting from $p_0 = \\rho R T$, and taking the natural logarithm:\n$$\n\\ln(p_0) = \\ln(\\rho) + \\ln(R) + \\ln(T)\n$$\nDifferentiating with respect to time $t$, and noting that $p_0$ and $R$ are constants, we get:\n$$\n0 = \\frac{1}{\\rho}\\frac{d\\rho}{dt} + \\frac{1}{T}\\frac{dT}{dt}\n$$\nThis provides a direct relationship between the relative rates of change of density and temperature:\n$$\n-\\frac{1}{\\rho}\\frac{d\\rho}{dt} = \\frac{1}{T}\\frac{dT}{dt}\n$$\nSubstituting this result into our expression for the velocity divergence gives:\n$$\n\\nabla \\cdot \\mathbf{u} = \\frac{1}{T}\\frac{dT}{dt}\n$$\nNow, we must find an expression for the rate of change of temperature, $\\frac{dT}{dt}$, using the energy equation. The problem specifies using the enthalpy-based energy equation. A general form of this equation is:\n$$\n\\rho \\frac{Dh}{Dt} = \\frac{Dp}{Dt} + \\nabla \\cdot (k \\nabla T) + \\Phi + Q\n$$\nwhere $h$ is the specific enthalpy, $k$ is the thermal conductivity, $\\Phi$ is the viscous dissipation function, and $Q$ is the volumetric heat source. The material derivative is $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + \\mathbf{u} \\cdot \\nabla$.\n\nWe apply the conditions given in the problem:\n1.  Specific enthalpy is $h = c_p T$, with constant $c_p$.\n2.  Pressure is constant, $p = p_0$, so $\\frac{Dp}{Dt} = 0$.\n3.  Temperature is spatially uniform, $\\nabla T = \\mathbf{0}$, which implies the heat conduction term is zero: $\\nabla \\cdot (k \\nabla T) = 0$.\n4.  Viscous dissipation is negligible, $\\Phi = 0$.\n\nWith these simplifications, the energy equation reduces to:\n$$\n\\rho \\frac{D(c_p T)}{Dt} = Q\n$$\nSince $c_p$ is constant, this becomes $\\rho c_p \\frac{DT}{Dt} = Q$. The material derivative of temperature is $\\frac{DT}{Dt} = \\frac{\\partial T}{\\partial t} + \\mathbf{u} \\cdot \\nabla T$. Given $\\nabla T = \\mathbf{0}$, this simplifies to $\\frac{DT}{Dt} = \\frac{\\partial T}{\\partial t} = \\frac{dT}{dt}$ (since $T$ is only a function of time).\nThus, the simplified energy equation is:\n$$\n\\rho c_p \\frac{dT}{dt} = Q\n$$\nSolving for the rate of temperature change:\n$$\n\\frac{dT}{dt} = \\frac{Q}{\\rho c_p}\n$$\nFinally, we substitute this expression for $\\frac{dT}{dt}$ back into our equation for the velocity divergence:\n$$\n\\nabla \\cdot \\mathbf{u} = \\frac{1}{T} \\left( \\frac{Q}{\\rho c_p} \\right) = \\frac{Q}{\\rho c_p T}\n$$\nThe problem requires the final expression to be solely in terms of $Q$, $c_p$, $p_0$, and $R$. We can eliminate the product $\\rho T$ using the ideal-gas equation of state, $p_0 = \\rho R T$. Rearranging this gives $\\rho T = \\frac{p_0}{R}$. Substituting this into the denominator of our expression for the divergence:\n$$\n\\nabla \\cdot \\mathbf{u} = \\frac{Q}{c_p (\\rho T)} = \\frac{Q}{c_p \\left(\\frac{p_0}{R}\\right)}\n$$\nSimplifying this expression yields the final result for the divergence source $S$:\n$$\nS = \\nabla \\cdot \\mathbf{u} = \\frac{Q R}{c_p p_0}\n$$\nThe units of this expression are $[Q] [R] / ([c_p] [p_0]) = ([ML^{-1}T^{-3}] [L^2 T^{-2} \\Theta^{-1}]) / ([L^2 T^{-2} \\Theta^{-1}] [ML^{-1}T^{-2}]) = [T^{-1}]$, which is consistent with the units of velocity divergence, $\\mathrm{s}^{-1}$.",
            "answer": "$$\n\\boxed{\\frac{Q R}{c_p p_0}}\n$$"
        },
        {
            "introduction": "The divergence constraint derived from physical principles must be numerically enforced at each time step to ensure mass is conserved. This is typically achieved through a projection method, where a pressure correction field is computed to project a provisional velocity field onto a space with the correct divergence. This practice guides you through the formulation of the pressure-Poisson equation, a critical step in most low-Mach-number solvers, and its solution to obtain the necessary velocity correction. ",
            "id": "3968978",
            "problem": "Consider a two-dimensional planar channel occupying $0 \\leq x \\leq L$ and $0 \\leq y \\leq H$, with periodic boundary conditions in the $x$-direction and rigid, impermeable walls at $y=0$ and $y=H$. The flow is a low-Mach-number (LMN) ideal-gas flow with a uniform thermodynamic background pressure $p_0$ over the projection time step, and a spatially uniform volumetric heat addition $\\dot{q}$ per unit volume. Let the fluid have reference density $\\rho_0$, specific heat at constant pressure $c_p$, and reference temperature $T_0$, all treated as spatially uniform during the time step. The provisional velocity field $\\mathbf{u}^*$ has been advanced by explicit non-pressure forces over a time step $\\Delta t$, and its divergence is known to be\n$$\n\\nabla \\cdot \\mathbf{u}^*(y) = \\phi_0 + S \\cos\\!\\left(\\frac{\\pi y}{H}\\right),\n$$\nwhere $S$ is a given constant amplitude, and $\\phi_0$ is the divergence profile required by the imposed uniform heating in the LMN framework.\n\nStarting from conservation of mass for an ideal gas and the thermal energy equation, derive the uniform divergence $\\phi_0$ implied by the uniform heating $\\dot{q}$ during the time step, under the assumption that $p_0$ is constant and spatial variations of $T$ and $\\rho$ are negligible at leading order over $\\Delta t$. Then, using the velocity correction by a pressure gradient over the time step, determine the scalar pressure correction $p'(y)$ that must be applied so that the corrected velocity satisfies the divergence constraint $\\nabla \\cdot \\mathbf{u}^{n+1}(y) = \\phi_0$ everywhere in $0 \\leq y \\leq H$. Assume the density entering the correction is the constant $\\rho_0$, and enforce homogeneous Neumann boundary conditions for the pressure correction at the walls, $\\partial p'/\\partial y = 0$ at $y=0$ and $y=H$, with the gauge fixed by requiring the spatial average of $p'(y)$ over $y \\in [0,H]$ to be zero.\n\nExpress your final pressure correction as a closed-form function of $y$ in Pascals, in terms of the symbols $\\rho_0$, $\\Delta t$, $H$, $S$, and $\\pi$. No numerical values are required, and no rounding is needed.",
            "solution": "We begin from the conservation of mass written in material form,\n$$\n\\frac{D \\rho}{D t} + \\rho \\, \\nabla \\cdot \\mathbf{u} = 0,\n$$\nwhich implies\n$$\n\\nabla \\cdot \\mathbf{u} = -\\frac{1}{\\rho} \\frac{D \\rho}{D t}.\n$$\nFor an ideal gas under low-Mach-number conditions with thermodynamic background pressure $p_0$ taken constant over the projection time step, the equation of state $p_0 = \\rho R T$ gives $\\rho \\propto 1/T$. Taking the material derivative,\n$$\n\\frac{D \\rho}{D t} = -\\frac{\\rho}{T} \\frac{D T}{D t}.\n$$\nTherefore,\n$$\n\\nabla \\cdot \\mathbf{u} = -\\frac{1}{\\rho} \\left( -\\frac{\\rho}{T} \\frac{D T}{D t} \\right) = \\frac{1}{T} \\frac{D T}{D t}.\n$$\nUnder the stated assumptions (uniform heating and leading-order uniform fields over the time step), the thermal energy equation reduces to\n$$\n\\rho c_p \\frac{D T}{D t} = \\dot{q},\n$$\nso that\n$$\n\\frac{D T}{D t} = \\frac{\\dot{q}}{\\rho c_p}.\n$$\nWith $T \\approx T_0$ and $\\rho \\approx \\rho_0$ at leading order, the divergence required by the heating is uniform and given by\n$$\n\\phi_0 = \\nabla \\cdot \\mathbf{u} \\approx \\frac{1}{T_0} \\frac{\\dot{q}}{\\rho_0 c_p}.\n$$\n\nNext, we impose the velocity correction over the time step by a pressure gradient, taking the quasi-incompressible form with constant density $\\rho_0$,\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^* - \\frac{\\Delta t}{\\rho_0} \\nabla p'.\n$$\nWe require the corrected velocity to satisfy the divergence constraint $\\nabla \\cdot \\mathbf{u}^{n+1} = \\phi_0$. Taking the divergence of the correction relation,\n$$\n\\nabla \\cdot \\mathbf{u}^{n+1} = \\nabla \\cdot \\mathbf{u}^* - \\frac{\\Delta t}{\\rho_0} \\nabla \\cdot \\left( \\nabla p' \\right) = \\nabla \\cdot \\mathbf{u}^* - \\frac{\\Delta t}{\\rho_0} \\nabla^2 p'.\n$$\nEnforcing $\\nabla \\cdot \\mathbf{u}^{n+1} = \\phi_0$ gives the Poisson equation for the pressure correction,\n$$\n\\nabla^2 p' = \\frac{\\rho_0}{\\Delta t} \\left( \\nabla \\cdot \\mathbf{u}^* - \\phi_0 \\right).\n$$\nBy hypothesis, the fields are independent of $x$ for the purpose of the correction, and the channel is one-dimensional in $y$ for this step. Thus,\n$$\n\\frac{d^2 p'}{d y^2} = \\frac{\\rho_0}{\\Delta t} \\left[ \\phi_0 + S \\cos\\!\\left( \\frac{\\pi y}{H} \\right) - \\phi_0 \\right] = \\frac{\\rho_0}{\\Delta t} S \\cos\\!\\left( \\frac{\\pi y}{H} \\right).\n$$\nDefine $k = \\frac{\\pi}{H}$ and $C = \\frac{\\rho_0}{\\Delta t} S$ to simplify notation. The ordinary differential equation is\n$$\n\\frac{d^2 p'}{d y^2} = C \\cos(k y).\n$$\nIntegrating twice,\n$$\np'(y) = -\\frac{C}{k^2} \\cos(k y) + A y + B,\n$$\nwhere $A$ and $B$ are integration constants. The homogeneous Neumann boundary conditions require $\\frac{d p'}{d y} = 0$ at $y=0$ and $y=H$. The derivative is\n$$\n\\frac{d p'}{d y} = \\frac{C}{k} \\sin(k y) + A.\n$$\nAt $y=0$, $\\sin(0) = 0$, so $\\frac{d p'}{d y}\\big|_{y=0} = A = 0$. At $y=H$, $\\sin(k H) = \\sin(\\pi) = 0$, so $\\frac{d p'}{d y}\\big|_{y=H} = A = 0$, which is already satisfied. Therefore $A=0$.\n\nThe gauge is fixed by requiring the spatial average of $p'(y)$ over $[0,H]$ to be zero,\n$$\n\\frac{1}{H} \\int_{0}^{H} p'(y) \\, dy = 0.\n$$\nBecause $\\int_{0}^{H} \\cos\\!\\left( \\frac{\\pi y}{H} \\right) dy = \\left. \\frac{H}{\\pi} \\sin\\!\\left( \\frac{\\pi y}{H} \\right) \\right|_{0}^{H} = 0$, the average of the cosine term vanishes, so the zero-mean condition enforces $B=0$.\n\nSubstituting back $k=\\frac{\\pi}{H}$ and $C=\\frac{\\rho_0}{\\Delta t} S$, we obtain\n$$\np'(y) = -\\frac{ \\left( \\frac{\\rho_0}{\\Delta t} S \\right) }{ \\left( \\frac{\\pi}{H} \\right)^2 } \\cos\\!\\left( \\frac{\\pi y}{H} \\right)\n= - \\frac{\\rho_0 S H^2}{\\Delta t \\pi^2} \\cos\\!\\left( \\frac{\\pi y}{H} \\right).\n$$\nThis is the required pressure correction, expressed in Pascals, that enforces the uniform divergence $\\phi_0$ set by the uniform heating, given the specified provisional divergence field.",
            "answer": "$$\\boxed{-\\frac{\\rho_0 S H^2}{\\Delta t \\pi^2}\\cos\\!\\left(\\frac{\\pi y}{H}\\right)}$$"
        },
        {
            "introduction": "While conceptually elegant, the practical implementation of pressure-correction methods on collocated grids presents a significant challenge: the potential for pressure-velocity decoupling, which can lead to non-physical, oscillatory solutions. This advanced practice explores the origin of these spurious \"checkerboard\" modes and introduces the celebrated Rhie-Chow interpolation as a robust remedy. By analyzing and implementing this technique, you will gain insight into the subtleties required to build a stable and accurate finite volume solver. ",
            "id": "3968961",
            "problem": "Consider a one-dimensional, uniform, periodic domain of length $L$ discretized into $N$ control volumes using a collocated Finite Volume Method (FVM). In the low-Mach-number limit, the thermodynamic pressure is nearly spatially uniform and the mechanical pressure, denoted by $\\pi$, provides the leading-order momentum balance. The governing continuum equations are the steady mass conservation and momentum balance for a Newtonian fluid with constant density $\\rho$ and dynamic viscosity $\\mu$:\n- Mass conservation: $\\nabla \\cdot (\\rho \\mathbf{u}) = 0$.\n- Momentum balance: $\\mathbf{0} = -\\nabla \\pi + \\mu \\nabla^2 \\mathbf{u} + \\mathbf{b}$, where $\\mathbf{b}$ is a body-force density (set to zero for this problem).\n\nOn a collocated FVM grid, the cell-centered variables $u_i$ and $\\pi_i$ are associated with cell index $i \\in \\{0,1,\\dots,N-1\\}$, and faces are indexed by $i+\\tfrac{1}{2}$ between cells $i$ and $i+1$. A commonly used naive face interpolation for velocity is the arithmetic average,\n$u_{i+\\frac{1}{2}}^{\\text{naive}} = \\tfrac{1}{2} \\left( u_i + u_{i+1} \\right)$.\nIn low-Mach solvers, a predictor velocity $u_i^\\star$ is often obtained from the momentum equation without the mechanical pressure gradient term. In that case, the naive face interpolation yields $u_{i+\\frac{1}{2}}^{\\text{naive}} = \\tfrac{1}{2} (u_i^\\star + u_{i+1}^\\star)$, which does not include a direct contribution from $\\pi$ and can decouple velocity and pressure, admitting spurious checkerboard pressure fields that do not affect the mass flux divergence.\n\nYour task is to:\n1. Derive, from the momentum equation discretized on a uniform one-dimensional collocated grid with spacing $\\Delta x = L/N$, a Rhie–Chow-type face interpolation that couples the mechanical pressure gradient to the face velocity. Use a steady, linearized discrete momentum operator at the cell level with coefficients consistent with a second-order central discretization of the viscous term, leading to a cell coefficient $a_P = 2\\mu/\\Delta x$. Show that a consistent Rhie–Chow-type face velocity can be written as\n$$\nu_{i+\\frac{1}{2}}^{\\text{RC}} = \\tfrac{1}{2} \\left( u_i^\\star + u_{i+1}^\\star \\right) - \\frac{1}{a_{i+\\frac{1}{2}}} \\frac{\\pi_{i+1} - \\pi_i}{\\Delta x},\n$$\nwith $a_{i+\\frac{1}{2}}$ taken as the arithmetic average of neighboring cell coefficients, which for uniform viscosity reduces to $a_{i+\\frac{1}{2}} = 2\\mu/\\Delta x$.\n2. Define the face mass flux $m_{i+\\frac{1}{2}} = \\rho \\, u_{i+\\frac{1}{2}}$ and the discrete divergence in cell $i$ as\n$$\n\\left( \\nabla \\cdot \\mathbf{m} \\right)_i = \\frac{m_{i+\\frac{1}{2}} - m_{i-\\frac{1}{2}}}{\\Delta x},\n$$\nwith periodic indexing, i.e., $m_{-\\frac{1}{2}} = m_{N-\\frac{1}{2}}$ and $m_{N+\\frac{1}{2}} = m_{\\frac{1}{2}}$. Show that for $u_i^\\star = 0$ and a checkerboard mechanical pressure field $\\pi_i = A(-1)^i$, the naive interpolation produces zero discrete divergence while the Rhie–Chow interpolation produces a nonzero discrete divergence that scales with $A$, $\\rho$, $\\mu$, and $\\Delta x$.\n3. Implement a program that, for a given set of test cases, constructs the pressure field $\\pi_i$, computes the naive and Rhie–Chow face velocities with $u_i^\\star = 0$, computes the face mass fluxes, and reports the root-mean-square (RMS) of the discrete divergence over all cells for both interpolations:\n$$\n\\text{RMS} = \\sqrt{ \\frac{1}{N} \\sum_{i=0}^{N-1} \\left( (\\nabla \\cdot \\mathbf{m})_i \\right)^2 }.\n$$\n\nUse the following test suite of parameter values:\n- Test case $1$ (happy path): $N=32$, $L=1.0$, $\\rho=1.0$, $\\mu=1.0$, $A=1.0$, pressure type = checkerboard, i.e., $\\pi_i = A(-1)^i$.\n- Test case $2$ (odd grid size): $N=31$, $L=1.0$, $\\rho=1.0$, $\\mu=1.0$, $A=1.0$, pressure type = checkerboard.\n- Test case $3$ (baseline constant pressure): $N=32$, $L=1.0$, $\\rho=1.0$, $\\mu=1.0$, $A=0.0$, pressure type = constant, i.e., $\\pi_i = A$.\n- Test case $4$ (smooth mode, low viscosity): $N=64$, $L=1.0$, $\\rho=1.0$, $\\mu=0.1$, $A=1.0$, pressure type = sinusoidal, i.e., $\\pi_i = A \\sin(2\\pi x_i)$ with $x_i = (i+0.5)\\Delta x$.\n- Test case $5$ (smooth mode, higher viscosity): $N=64$, $L=1.0$, $\\rho=1.0$, $\\mu=2.0$, $A=1.0$, pressure type = sinusoidal, i.e., $\\pi_i = A \\sin(2\\pi x_i)$.\n\nFor each test case, compute and output two floating-point numbers: the naive RMS divergence and the Rhie–Chow RMS divergence. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order\n$[\\text{naive}_1,\\text{RC}_1,\\text{naive}_2,\\text{RC}_2,\\dots,\\text{naive}_5,\\text{RC}_5]$.\nAll outputs are dimensionless floats. No physical units are required in the output.",
            "solution": "The user-provided problem is valid as it is scientifically grounded in the principles of computational fluid dynamics, well-posed with a clear objective, and free from any of the invalidating flaws listed in the problem validation criteria. The necessary data, equations, and boundary conditions are provided to perform the required derivation, analysis, and implementation.\n\n### Part 1: Derivation of the Rhie–Chow Interpolation\n\nThe objective is to derive a face-velocity interpolation scheme that couples pressure and velocity, starting from the discretized steady-state momentum equation on a one-dimensional, collocated grid.\n\nThe steady-state momentum equation for an incompressible Newtonian fluid with constant properties and no body force is:\n$$ \\mathbf{0} = -\\nabla \\pi + \\mu \\nabla^2 \\mathbf{u} $$\nIn one dimension, this simplifies to:\n$$ 0 = -\\frac{d\\pi}{dx} + \\mu \\frac{d^2u}{dx^2} $$\nWe discretize this equation at a cell center $i$ using the Finite Volume Method (FVM) by integrating over the control volume $[x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}]$ of width $\\Delta x = L/N$.\n$$ \\int_{i-\\frac{1}{2}}^{i+\\frac{1}{2}} \\left( -\\frac{d\\pi}{dx} + \\mu \\frac{d^2u}{dx^2} \\right) dx = 0 $$\n$$ -\\left( \\pi_{i+\\frac{1}{2}} - \\pi_{i-\\frac{1}{2}} \\right) + \\mu \\left( \\left.\\frac{du}{dx}\\right|_{i+\\frac{1}{2}} - \\left.\\frac{du}{dx}\\right|_{i-\\frac{1}{2}} \\right) = 0 $$\nUsing second-order central difference approximations for the fluxes at the cell faces:\n$$ \\left.\\frac{du}{dx}\\right|_{i+\\frac{1}{2}} \\approx \\frac{u_{i+1} - u_i}{\\Delta x} $$\n$$ \\left.\\frac{du}{dx}\\right|_{i-\\frac{1}{2}} \\approx \\frac{u_i - u_{i-1}}{\\Delta x} $$\nSubstituting these into the integrated equation gives:\n$$ -\\left( \\pi_{i+\\frac{1}{2}} - \\pi_{i-\\frac{1}{2}} \\right) + \\frac{\\mu}{\\Delta x} \\left( (u_{i+1} - u_i) - (u_i - u_{i-1}) \\right) = 0 $$\n$$ \\frac{\\mu}{\\Delta x} (u_{i+1} - 2u_i + u_{i-1}) = \\pi_{i+\\frac{1}{2}} - \\pi_{i-\\frac{1}{2}} $$\nOn a collocated grid, the pressure at the faces is typically interpolated, e.g., $\\pi_{i+\\frac{1}{2}} = \\frac{1}{2}(\\pi_i + \\pi_{i+1})$. The pressure term then becomes $\\frac{1}{2}(\\pi_{i+1} - \\pi_{i-1})$. Rearranging the equation to the standard FVM form $a_i u_i = \\sum_{nb} a_{nb} u_{nb} + S_u$:\n$$ \\frac{2\\mu}{\\Delta x} u_i = \\frac{\\mu}{\\Delta x} u_{i+1} + \\frac{\\mu}{\\Delta x} u_{i-1} + S_{\\pi} $$\nThis gives the cell coefficient $a_i = 2\\mu/\\Delta x$, which matches the problem statement ($a_P = 2\\mu/\\Delta x$). The term containing neighboring velocities is $H(u)_i = \\frac{\\mu}{\\Delta x} (u_{i+1} + u_{i-1})$. The full discrete momentum equation at cell $i$ can be written as:\n$$ a_i u_i = H(u)_i - (\\nabla_d \\pi)_i $$\nwhere $(\\nabla_d \\pi)_i$ represents the discrete pressure gradient term.\n\nIn a segregated pressure-based solver, a predictor velocity $u^\\star$ is calculated from the momentum equation, typically by omitting the pressure gradient term (or using a previous iteration's pressure field).\n$$ a_i u_i^\\star = H(u)_i $$\nSubstituting this back into the full momentum equation gives an expression for the cell-centered velocity $u_i$:\n$$ u_i = u_i^\\star - \\frac{1}{a_i} (\\nabla_d \\pi)_i $$\nThe Rhie–Chow interpolation scheme avoids simple averaging of cell-centered velocities. Instead, it averages the expressions for the cell-centered velocities at cell $i$ and cell $i+1$, and then approximates the pressure gradient term with a compact stencil at the face $i+\\frac{1}{2}$.\nTo find the velocity at face $i+\\frac{1}{2}$, we first interpolate the equation for $u_i$ to the face:\n$$ u_{i+\\frac{1}{2}} = \\overline{(u^\\star)}_{i+\\frac{1}{2}} - \\overline{\\left(\\frac{1}{a} (\\nabla_d \\pi)\\right)}_{i+\\frac{1}{2}} $$\nwhere the overbar denotes interpolation. The key insight of Rhie and Chow is to split the interpolation:\n$$ u_{i+\\frac{1}{2}} = \\overline{(u^\\star)}_{i+\\frac{1}{2}} - \\overline{\\left(\\frac{1}{a}\\right)}_{i+\\frac{1}{2}} (\\nabla_d \\pi)_{i+\\frac{1}{2}} $$\nWe use linear interpolation (arithmetic average) for the predictor velocity and the coefficient term:\n$$ \\overline{(u^\\star)}_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(u_i^\\star + u_{i+1}^\\star\\right) $$\n$$ \\overline{\\left(\\frac{1}{a}\\right)}_{i+\\frac{1}{2}} \\approx \\frac{1}{\\overline{a}_{i+\\frac{1}{2}}} = \\frac{1}{\\frac{1}{2}(a_i + a_{i+1})} $$\nAnd a compact, second-order difference for the pressure gradient at the face:\n$$ (\\nabla_d \\pi)_{i+\\frac{1}{2}} = \\frac{\\pi_{i+1} - \\pi_i}{\\Delta x} $$\nCombining these terms yields the Rhie–Chow face velocity:\n$$ u_{i+\\frac{1}{2}}^{\\text{RC}} = \\frac{1}{2}\\left(u_i^\\star + u_{i+1}^\\star\\right) - \\frac{1}{\\frac{1}{2}(a_i + a_{i+1})} \\frac{\\pi_{i+1} - \\pi_i}{\\Delta x} $$\nLetting $a_{i+\\frac{1}{2}} = \\frac{1}{2}(a_i + a_{i+1})$, and given constant viscosity $\\mu$ and uniform grid spacing $\\Delta x$, we have $a_i = a_{i+1} = 2\\mu/\\Delta x$. Thus, the face coefficient is:\n$$ a_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(\\frac{2\\mu}{\\Delta x} + \\frac{2\\mu}{\\Delta x}\\right) = \\frac{2\\mu}{\\Delta x} $$\nSubstituting this into the face velocity expression gives the final desired form:\n$$ u_{i+\\frac{1}{2}}^{\\text{RC}} = \\frac{1}{2}\\left(u_i^\\star + u_{i+1}^\\star\\right) - \\frac{1}{2\\mu/\\Delta x} \\frac{\\pi_{i+1} - \\pi_i}{\\Delta x} $$\nThis expression directly links the face velocity to the local pressure difference $\\pi_{i+1} - \\pi_i$, providing the necessary pressure-velocity coupling that is absent in the naive interpolation of the predictor velocity, $u_{i+\\frac{1}{2}}^{\\text{naive}} = \\frac{1}{2} (u_i^\\star + u_{i+1}^\\star)$.\n\n### Part 2: Analysis of a Checkerboard Pressure Field\n\nWe analyze the discrete mass divergence for the case where the predictor velocity is zero, $u_i^\\star=0$, and the pressure field is a checkerboard mode, $\\pi_i = A(-1)^i$.\n\n**Naive Interpolation:**\nThe naive face velocity is defined as $u_{i+\\frac{1}{2}}^{\\text{naive}} = \\frac{1}{2} (u_i^\\star + u_{i+1}^\\star)$. With $u_i^\\star=0$ for all $i$:\n$$ u_{i+\\frac{1}{2}}^{\\text{naive}} = \\frac{1}{2}(0 + 0) = 0 $$\nThe corresponding face mass flux is $m_{i+\\frac{1}{2}}^{\\text{naive}} = \\rho u_{i+\\frac{1}{2}}^{\\text{naive}} = 0$. The discrete divergence in cell $i$ is:\n$$ \\left( \\nabla \\cdot \\mathbf{m} \\right)_i^{\\text{naive}} = \\frac{m_{i+\\frac{1}{2}}^{\\text{naive}} - m_{i-\\frac{1}{2}}^{\\text{naive}}}{\\Delta x} = \\frac{0 - 0}{\\Delta x} = 0 $$\nThis is true for all cells $i$. Thus, the naive interpolation scheme fails to see the checkerboard pressure field, resulting in a zero divergence field. This indicates a decoupling of pressure and velocity.\n\n**Rhie–Chow Interpolation:**\nThe Rhie–Chow face velocity with $u_i^\\star=0$ is:\n$$ u_{i+\\frac{1}{2}}^{\\text{RC}} = - \\frac{1}{a_{i+\\frac{1}{2}}} \\frac{\\pi_{i+1} - \\pi_i}{\\Delta x} = - \\frac{\\Delta x}{2\\mu} \\frac{A(-1)^{i+1} - A(-1)^i}{\\Delta x} $$\n$$ u_{i+\\frac{1}{2}}^{\\text{RC}} = - \\frac{A}{2\\mu} \\left( (-1)^{i+1} - (-1)^i \\right) = - \\frac{A}{2\\mu} (-1)^i \\left( -1 - 1 \\right) = \\frac{A}{\\mu} (-1)^i $$\nThe face mass flux is:\n$$ m_{i+\\frac{1}{2}}^{\\text{RC}} = \\rho u_{i+\\frac{1}{2}}^{\\text{RC}} = \\frac{\\rho A}{\\mu} (-1)^i $$\nNow, we compute the discrete divergence in cell $i$:\n$$ \\left( \\nabla \\cdot \\mathbf{m} \\right)_i^{\\text{RC}} = \\frac{m_{i+\\frac{1}{2}}^{\\text{RC}} - m_{i-\\frac{1}{2}}^{\\text{RC}}}{\\Delta x} $$\nThe flux at the preceding face $i-\\frac{1}{2}$ is found by substituting $i-1$ for $i$:\n$$ m_{i-\\frac{1}{2}}^{\\text{RC}} = \\frac{\\rho A}{\\mu} (-1)^{i-1} = -\\frac{\\rho A}{\\mu} (-1)^i $$\nSubstituting the face fluxes into the divergence expression:\n$$ \\left( \\nabla \\cdot \\mathbf{m} \\right)_i^{\\text{RC}} = \\frac{1}{\\Delta x} \\left[ \\frac{\\rho A}{\\mu} (-1)^i - \\left(-\\frac{\\rho A}{\\mu} (-1)^i\\right) \\right] = \\frac{2 \\rho A}{\\mu \\Delta x} (-1)^i $$\nThis result is non-zero for $A \\neq 0$ and demonstrates that the Rhie–Chow interpolation correctly senses the checkerboard pressure gradient, producing a non-zero mass divergence. The magnitude of this divergence, $|(\\nabla \\cdot \\mathbf{m})_i^{\\text{RC}}| = \\frac{2 \\rho A}{\\mu \\Delta x}$, scales directly with $A$ and $\\rho$, and inversely with $\\mu$ and $\\Delta x$, as required. This non-zero divergence would then drive a pressure correction step in a full solver to eliminate the spurious checkerboard mode.\n\n### Part 3: Implementation\n\nThe provided Python code implements the calculation of the root-mean-square (RMS) of the discrete mass divergence for both naive and Rhie–Chow interpolations across a suite of test cases. As shown analytically and requested by the problem statement, the naive interpolation of the zero predictor velocity field always yields zero face velocity and thus zero divergence. The Rhie–Chow interpolation, by contrast, includes a pressure-gradient term that produces non-zero face velocities and a non-zero divergence field for non-constant pressure fields. The program calculates these values according to the derived formulas and periodic boundary conditions, which are handled using `numpy.roll`.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_divergence_rms(N, L, rho, mu, A, pressure_type):\n    \"\"\"\n    Computes the RMS of the discrete mass divergence for naive and Rhie-Chow\n    interpolations for a single test case.\n    \n    Args:\n        N (int): Number of control volumes.\n        L (float): Length of the domain.\n        rho (float): Fluid density.\n        mu (float): Dynamic viscosity.\n        A (float): Amplitude of the pressure field.\n        pressure_type (str): Type of pressure field ('checkerboard', 'constant', 'sinusoidal').\n        \n    Returns:\n        tuple[float, float]: RMS divergence for naive and Rhie-Chow methods.\n    \"\"\"\n    delta_x = L / N\n    i = np.arange(N)\n\n    # 1. Construct the pressure field pi_i\n    if pressure_type == 'checkerboard':\n        pi = A * (-1.0)**i\n    elif pressure_type == 'constant':\n        pi = A * np.ones(N)\n    elif pressure_type == 'sinusoidal':\n        x_i = (i + 0.5) * delta_x\n        pi = A * np.sin(2 * np.pi * x_i)\n    else:\n        raise ValueError(\"Unknown pressure_type\")\n\n    # Predictor velocity is zero for all cases\n    # u_star = np.zeros(N)\n\n    # 2. Compute naive interpolation results\n    # u_naive_face = 0.5 * (u_star_i + u_star_i+1) = 0\n    # m_naive_face = 0\n    # div_m_naive = 0\n    rms_naive = 0.0\n\n    # 3. Compute Rhie-Chow interpolation results\n    # Face coefficient a_{i+1/2} = 2*mu/delta_x for uniform grid\n    a_face = 2.0 * mu / delta_x\n    \n    # Pressure difference at faces i+1/2\n    # np.roll handles periodic boundary conditions for pi_{i+1}\n    pi_iplus1 = np.roll(pi, -1)\n    delta_pi_face = pi_iplus1 - pi\n    \n    # Calculate RC face velocity u_{i+1/2} and mass flux m_{i+1/2}\n    # Per the problem, u_star is zero\n    u_face_rc = - (1.0 / a_face) * (delta_pi_face / delta_x)\n    m_face_rc = rho * u_face_rc\n    \n    # Calculate discrete divergence (div . m)_i at cell centers\n    # (m_{i+1/2} - m_{i-1/2}) / delta_x\n    # np.roll handles periodic BC for m_{i-1/2}\n    m_face_rc_iminushalf = np.roll(m_face_rc, 1)\n    div_m_rc = (m_face_rc - m_face_rc_iminushalf) / delta_x\n    \n    # Calculate RMS of the divergence\n    rms_rc = np.sqrt(np.mean(div_m_rc**2))\n    \n    return rms_naive, rms_rc\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, L, rho, mu, A, pressure_type)\n        (32, 1.0, 1.0, 1.0, 1.0, 'checkerboard'),\n        (31, 1.0, 1.0, 1.0, 1.0, 'checkerboard'),\n        (32, 1.0, 1.0, 1.0, 0.0, 'constant'),\n        (64, 1.0, 1.0, 0.1, 1.0, 'sinusoidal'),\n        (64, 1.0, 1.0, 2.0, 1.0, 'sinusoidal'),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, L, rho, mu, A, p_type = case\n        rms_naive, rms_rc = compute_divergence_rms(N, L, rho, mu, A, p_type)\n        results.extend([rms_naive, rms_rc])\n\n    # Final print statement in the exact required format.\n    # Using 'g' for general-purpose floating point formatting.\n    print(f\"[{','.join(f'{r:.12g}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}