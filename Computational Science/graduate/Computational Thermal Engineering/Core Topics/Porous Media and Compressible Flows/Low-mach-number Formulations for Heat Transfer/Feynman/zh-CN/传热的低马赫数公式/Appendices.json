{
    "hands_on_practices": [
        {
            "introduction": "在伴有传热的低马赫数流动中，流体因受热而膨胀，导致密度变化，进而使速度场不再是无散的 ($\\nabla \\cdot \\mathbf{u} \\neq 0$)。本练习将引导你从基本的热力学和流体方程出发，推导出体积热源与速度散度之间的精确数学关系，这是构建变密度低马赫数求解器的基石。",
            "id": "3968942",
            "problem": "考虑一个大的周期性区域中的单组分理想气体，它正在经历低马赫数流动，其中热力学压力在空间上是均匀且恒定的，$p = p_0$。该流体被一个大小为 $Q$（单位体积单位时间的能量）的体积热源均匀加热。假设定压比热容 $c_p$ 和理想气体常数 $R$ 为常数，粘性耗散可忽略不计，无物质扩散或化学反应，且温度场在空间上均匀，因此热传导不起作用（$\\nabla T = \\mathbf{0}$）。\n\n从连续性方程、理想气体状态方程和基于焓（比焓 $h = c_p T$）的能量方程出发，推导低马赫数散度约束，并计算散度源 $S$，使得 $\\nabla \\cdot \\mathbf{u} = S$ 仅用 $Q$、$c_p$、$p_0$ 和 $R$ 表示。\n\n请将 $S$ 的最终表达式以单一闭式解析表达式的形式给出。以 $\\mathrm{s}^{-1}$ 为单位表示 $S$ 的大小。",
            "solution": "用户要求我为受到均匀体积加热的单组分理想气体推导低马赫数散度约束。散度源 $S = \\nabla \\cdot \\mathbf{u}$ 的最终表达式必须用体积热源 $Q$、定压比热容 $c_p$、恒定压力 $p_0$ 和特定气体常数 $R$ 来表示。\n\n推导过程是在指定的假设下，通过结合三个基本方程来进行的：连续性方程、理想气体状态方程和能量方程。\n\n起点是表达质量守恒的连续性方程：\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\mathbf{u}) = 0\n$$\n其中 $\\rho$ 是流体密度，$\\mathbf{u}$ 是速度矢量。使用散度的乘积法则，我们可以展开第二项：\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\rho (\\nabla \\cdot \\mathbf{u}) + \\mathbf{u} \\cdot \\nabla \\rho = 0\n$$\n问题陈述中指出，温度场在空间上是均匀的，即 $\\nabla T = \\mathbf{0}$。我们可以利用这个信息以及理想气体状态方程 $p = \\rho R T$ 来确定密度的空间变化。鉴于压力是恒定且均匀的（$p=p_0$），气体常数 $R$ 也是恒定的，我们可以将密度写为 $\\rho = \\frac{p_0}{RT}$。对密度求梯度可得：\n$$\n\\nabla \\rho = \\nabla \\left( \\frac{p_0}{R T} \\right) = -\\frac{p_0}{R T^2} \\nabla T\n$$\n由于 $\\nabla T = \\mathbf{0}$，因此密度梯度也为零，$\\nabla \\rho = \\mathbf{0}$。这意味着密度 $\\rho$ 在空间上是均匀的，只能是时间的函数，即 $\\rho = \\rho(t)$。\n\n当 $\\nabla \\rho = \\mathbf{0}$ 时，展开的连续性方程中的项 $\\mathbf{u} \\cdot \\nabla \\rho$ 为零。此外，由于 $\\rho$ 仅是时间的函数，时间偏导数变为全导数，$\\frac{\\partial \\rho}{\\partial t} = \\frac{d\\rho}{dt}$。连续性方程简化为：\n$$\n\\frac{d\\rho}{dt} + \\rho (\\nabla \\cdot \\mathbf{u}) = 0\n$$\n重新整理该方程，得到我们想要寻找的速度散度的表达式：\n$$\n\\nabla \\cdot \\mathbf{u} = -\\frac{1}{\\rho}\\frac{d\\rho}{dt}\n$$\n为了继续推导，我们需要将密度的时间导数 $\\frac{d\\rho}{dt}$ 与给定的热力学量联系起来。我们可以通过对理想气体状态方程关于时间求导来实现。从 $p_0 = \\rho R T$ 开始，并取自然对数：\n$$\n\\ln(p_0) = \\ln(\\rho) + \\ln(R) + \\ln(T)\n$$\n对时间 $t$ 求导，并注意到 $p_0$ 和 $R$ 是常数，我们得到：\n$$\n0 = \\frac{1}{\\rho}\\frac{d\\rho}{dt} + \\frac{1}{T}\\frac{dT}{dt}\n$$\n这提供了密度和温度相对变化率之间的直接关系：\n$$\n-\\frac{1}{\\rho}\\frac{d\\rho}{dt} = \\frac{1}{T}\\frac{dT}{dt}\n$$\n将此结果代入我们的速度散度表达式中，得到：\n$$\n\\nabla \\cdot \\mathbf{u} = \\frac{1}{T}\\frac{dT}{dt}\n$$\n现在，我们必须使用能量方程来找到温度变化率 $\\frac{dT}{dt}$ 的表达式。问题指定使用基于焓的能量方程。该方程的一般形式是：\n$$\n\\rho \\frac{Dh}{Dt} = \\frac{Dp}{Dt} + \\nabla \\cdot (k \\nabla T) + \\Phi + Q\n$$\n其中 $h$ 是比焓，$k$ 是热导率，$\\Phi$ 是粘性耗散函数，$Q$ 是体积热源。物质导数为 $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + \\mathbf{u} \\cdot \\nabla$。\n\n我们应用问题中给出的条件：\n1.  比焓为 $h = c_p T$，其中 $c_p$ 为常数。\n2.  压力是恒定的，$p = p_0$，所以 $\\frac{Dp}{Dt} = 0$。\n3.  温度在空间上是均匀的，$\\nabla T = \\mathbf{0}$，这意味着热传导项为零：$\\nabla \\cdot (k \\nabla T) = 0$。\n4.  粘性耗散可忽略不计，$\\Phi = 0$。\n\n通过这些简化，能量方程简化为：\n$$\n\\rho \\frac{D(c_p T)}{Dt} = Q\n$$\n由于 $c_p$ 是常数，这变为 $\\rho c_p \\frac{DT}{Dt} = Q$。温度的物质导数是 $\\frac{DT}{Dt} = \\frac{\\partial T}{\\partial t} + \\mathbf{u} \\cdot \\nabla T$。鉴于 $\\nabla T = \\mathbf{0}$，这简化为 $\\frac{DT}{Dt} = \\frac{\\partial T}{\\partial t} = \\frac{dT}{dt}$（因为 $T$ 仅是时间的函数）。\n因此，简化的能量方程是：\n$$\n\\rho c_p \\frac{dT}{dt} = Q\n$$\n解出温度变化率：\n$$\n\\frac{dT}{dt} = \\frac{Q}{\\rho c_p}\n$$\n最后，我们将 $\\frac{dT}{dt}$ 的这个表达式代回我们的速度散度方程中：\n$$\n\\nabla \\cdot \\mathbf{u} = \\frac{1}{T} \\left( \\frac{Q}{\\rho c_p} \\right) = \\frac{Q}{\\rho c_p T}\n$$\n问题要求最终表达式仅用 $Q$、$c_p$、$p_0$ 和 $R$ 表示。我们可以使用理想气体状态方程 $p_0 = \\rho R T$ 来消去乘积项 $\\rho T$。重新整理可得 $\\rho T = \\frac{p_0}{R}$。将此代入我们散度表达式的分母中：\n$$\n\\nabla \\cdot \\mathbf{u} = \\frac{Q}{c_p (\\rho T)} = \\frac{Q}{c_p \\left(\\frac{p_0}{R}\\right)}\n$$\n简化此表达式可得到散度源 $S$ 的最终结果：\n$$\nS = \\nabla \\cdot \\mathbf{u} = \\frac{Q R}{c_p p_0}\n$$\n该表达式的单位是 $[Q] [R] / ([c_p] [p_0]) = ([\\text{ML}^{-1}\\text{T}^{-3}] [\\text{L}^2 \\text{T}^{-2} \\Theta^{-1}]) / ([\\text{L}^2 \\text{T}^{-2} \\Theta^{-1}] [\\text{ML}^{-1}\\text{T}^{-2}]) = [\\text{T}^{-1}]$，这与速度散度的单位 $\\mathrm{s}^{-1}$ 一致。",
            "answer": "$$\n\\boxed{\\frac{Q R}{c_p p_0}}\n$$"
        },
        {
            "introduction": "在理解了热膨胀如何产生速度散度之后，下一步是在数值模拟中精确地施加这一约束。本练习模拟了计算流体力学中投影法求解器的一个关键步骤：计算所需的压力修正场，用以调整一个临时的、“预测”出的速度场，使其严格满足由热膨胀引起的目标散度。这个练习清晰地揭示了压力泊松方程在低马赫数算法中扮演的核心角色。",
            "id": "3968978",
            "problem": "考虑一个占据 $0 \\leq x \\leq L$ 和 $0 \\leq y \\leq H$ 的二维平面通道，其在 $x$ 方向具有周期性边界条件，在 $y=0$ 和 $y=H$ 处为刚性、不可渗透的壁面。流体为低马赫数（LMN）理想气体流，在投影时间步内具有均匀的热力学背景压力 $p_0$，以及单位体积内空间均匀的热量增加 $\\dot{q}$。设流体的参考密度为 $\\rho_0$，定压比热为 $c_p$，参考温度为 $T_0$，在时间步内均视为空间均匀。临时速度场 $\\boldsymbol{u}^*$ 已通过显式非压力项在一个时间步 $\\Delta t$ 内推进，其散度已知为\n$$\n\\nabla \\cdot \\boldsymbol{u}^*(y) = \\phi_0 + S \\cos\\!\\left(\\frac{\\pi y}{H}\\right),\n$$\n其中 $S$ 是给定的恒定振幅，$\\phi_0$ 是在 LMN 框架中由施加的均匀加热所要求的散度分布。\n\n从理想气体的质量守恒和热能方程出发，推导在时间步内由均匀加热 $\\dot{q}$ 所隐含的均匀散度 $\\phi_0$。假设 $p_0$ 为常数，并且在 $\\Delta t$ 内，$T$ 和 $\\rho$ 的空间变化在主导阶上可忽略不计。然后，利用时间步内压力梯度的速度修正，确定必须应用的标量压力修正 $p'(y)$，以使修正后的速度在 $0 \\leq y \\leq H$ 的所有位置都满足散度约束 $\\nabla \\cdot \\boldsymbol{u}^{n+1}(y) = \\phi_0$。假设进入修正的密度为常数 $\\rho_0$，并在壁面处对压力修正施加齐次诺伊曼边界条件，即在 $y=0$ 和 $y=H$ 处 $\\partial p'/\\partial y = 0$，同时通过要求 $p'(y)$ 在 $y \\in [0,H]$ 上的空间平均值为零来固定规范。\n\n请用符号 $\\rho_0$、$\\Delta t$、$H$、$S$ 和 $\\pi$ 将最终的压力修正表示为关于 $y$ 的闭式函数，单位为帕斯卡。不需要数值，也无需四舍五入。",
            "solution": "我们从物质形式的质量守恒方程开始，\n$$\n\\frac{D \\rho}{D t} + \\rho \\, \\nabla \\cdot \\boldsymbol{u} = 0,\n$$\n这意味着\n$$\n\\nabla \\cdot \\boldsymbol{u} = -\\frac{1}{\\rho} \\frac{D \\rho}{D t}.\n$$\n对于在投影时间步内热力学背景压力 $p_0$ 恒定的低马赫数条件下的理想气体，状态方程 $p_0 = \\rho R T$ 给出 $\\rho \\propto 1/T$。取物质导数，\n$$\n\\frac{D \\rho}{D t} = -\\frac{\\rho}{T} \\frac{D T}{D t}.\n$$\n因此，\n$$\n\\nabla \\cdot \\boldsymbol{u} = -\\frac{1}{\\rho} \\left( -\\frac{\\rho}{T} \\frac{D T}{D t} \\right) = \\frac{1}{T} \\frac{D T}{D t}.\n$$\n在所述假设（均匀加热和时间步内主导阶均匀场）下，热能方程简化为\n$$\n\\rho c_p \\frac{D T}{D t} = \\dot{q},\n$$\n因此\n$$\n\\frac{D T}{D t} = \\frac{\\dot{q}}{\\rho c_p}.\n$$\n在主导阶上，$T \\approx T_0$ 且 $\\rho \\approx \\rho_0$，由加热所要求的散度是均匀的，并由下式给出\n$$\n\\phi_0 = \\nabla \\cdot \\boldsymbol{u} \\approx \\frac{1}{T_0} \\frac{\\dot{q}}{\\rho_0 c_p}.\n$$\n\n接下来，我们通过压力梯度施加时间步内的速度修正，采用密度为常数 $\\rho_0$ 的准不可压缩形式，\n$$\n\\boldsymbol{u}^{n+1} = \\boldsymbol{u}^* - \\frac{\\Delta t}{\\rho_0} \\nabla p'.\n$$\n我们要求修正后的速度满足散度约束 $\\nabla \\cdot \\boldsymbol{u}^{n+1} = \\phi_0$。对修正关系式取散度，\n$$\n\\nabla \\cdot \\boldsymbol{u}^{n+1} = \\nabla \\cdot \\boldsymbol{u}^* - \\frac{\\Delta t}{\\rho_0} \\nabla \\cdot \\left( \\nabla p' \\right) = \\nabla \\cdot \\boldsymbol{u}^* - \\frac{\\Delta t}{\\rho_0} \\nabla^2 p'.\n$$\n施加 $\\nabla \\cdot \\boldsymbol{u}^{n+1} = \\phi_0$ 得到压力修正的泊松方程，\n$$\n\\nabla^2 p' = \\frac{\\rho_0}{\\Delta t} \\left( \\nabla \\cdot \\boldsymbol{u}^* - \\phi_0 \\right).\n$$\n根据假设，为了进行修正，场与 $x$ 无关，并且在此步骤中通道在 $y$ 方向上是一维的。因此，\n$$\n\\frac{d^2 p'}{d y^2} = \\frac{\\rho_0}{\\Delta t} \\left[ \\phi_0 + S \\cos\\!\\left( \\frac{\\pi y}{H} \\right) - \\phi_0 \\right] = \\frac{\\rho_0}{\\Delta t} S \\cos\\!\\left( \\frac{\\pi y}{H} \\right).\n$$\n定义 $k = \\frac{\\pi}{H}$ 和 $C = \\frac{\\rho_0}{\\Delta t} S$ 以简化符号。常微分方程为\n$$\n\\frac{d^2 p'}{d y^2} = C \\cos(k y).\n$$\n积分两次，\n$$\np'(y) = -\\frac{C}{k^2} \\cos(k y) + A y + B,\n$$\n其中 $A$ 和 $B$ 是积分常数。齐次诺伊曼边界条件要求在 $y=0$ 和 $y=H$ 处 $\\frac{d p'}{d y} = 0$。其导数为\n$$\n\\frac{d p'}{d y} = \\frac{C}{k} \\sin(k y) + A.\n$$\n在 $y=0$ 处，$\\sin(0) = 0$，所以 $\\frac{d p'}{d y}\\big|_{y=0} = A = 0$。在 $y=H$ 处，$\\sin(k H) = \\sin(\\pi) = 0$，所以 $\\frac{d p'}{d y}\\big|_{y=H} = A = 0$，这个条件已经满足。因此 $A=0$。\n\n规范通过要求 $p'(y)$ 在 $[0,H]$ 上的空间平均值为零来固定，\n$$\n\\frac{1}{H} \\int_{0}^{H} p'(y) \\, dy = 0.\n$$\n因为 $\\int_{0}^{H} \\cos\\!\\left( \\frac{\\pi y}{H} \\right) dy = \\left. \\frac{H}{\\pi} \\sin\\!\\left( \\frac{\\pi y}{H} \\right) \\right|_{0}^{H} = 0$，余弦项的平均值为零，所以零均值条件强制 $B=0$。\n\n将 $k=\\frac{\\pi}{H}$ 和 $C=\\frac{\\rho_0}{\\Delta t} S$ 代回，我们得到\n$$\np'(y) = -\\frac{ \\left( \\frac{\\rho_0}{\\Delta t} S \\right) }{ \\left( \\frac{\\pi}{H} \\right)^2 } \\cos\\!\\left( \\frac{\\pi y}{H} \\right)\n= - \\frac{\\rho_0 S H^2}{\\Delta t \\pi^2} \\cos\\!\\left( \\frac{\\pi y}{H} \\right).\n$$\n这就是所要求的压力修正，单位为帕斯卡，它在给定临时散度场的情况下，强制实现了由均匀加热设定的均匀散度 $\\phi_0$。",
            "answer": "$$\\boxed{-\\frac{\\rho_0 S H^2}{\\Delta t \\pi^2}\\cos\\!\\left(\\frac{\\pi y}{H}\\right)}$$"
        },
        {
            "introduction": "一个稳健的数值实现需要精巧地处理压力与速度之间的耦合，尤其是在同位网格（collocated grid）上，非物理的棋盘状压力伪振荡是一种常见的数值顽疾。这项高级练习将深入剖析Rhie-Chow插值法，这是一种为抑制此类数值不稳定性而设计的经典技术。通过理论分析和一个简短的编程任务，你将理解为何强耦合机制至关重要，以及它如何确保求解器获得物理上真实的解。",
            "id": "3968961",
            "problem": "考虑一个长度为 $L$ 的一维均匀周期性域，使用同位网格有限体积法 (FVM) 将其离散为 $N$ 个控制体。在低马赫数极限下，热力学压力在空间上几乎是均匀的，而机械压力（记为 $\\pi$）提供了主导阶的动量平衡。对于密度 $\\rho$ 和动力粘度 $\\mu$ 恒定的牛顿流体，其控制连续介质方程为稳态质量守恒和动量平衡：\n- 质量守恒：$\\nabla \\cdot (\\rho \\mathbf{u}) = 0$。\n- 动量平衡：$\\mathbf{0} = -\\nabla \\pi + \\mu \\nabla^2 \\mathbf{u} + \\mathbf{b}$，其中 $\\mathbf{b}$ 是体积力密度（在本问题中设为零）。\n\n在同位 FVM 网格上，网格中心变量 $u_i$ 和 $\\pi_i$ 与网格索引 $i \\in \\{0,1,\\dots,N-1\\}$ 相关联，而单元 $i$ 和 $i+1$ 之间的面由 $i+\\tfrac{1}{2}$ 索引。一种常用的简单速度面插值方法是算术平均，\n$u_{i+\\frac{1}{2}}^{\\text{naive}} = \\tfrac{1}{2} \\left( u_i + u_{i+1} \\right)$。\n在低马赫求解器中，通常通过省略机械压力梯度项，从动量方程中获得预测速度 $u_i^\\star$。在这种情况下，简单的面插值会得到 $u_{i+\\frac{1}{2}}^{\\text{naive}} = \\tfrac{1}{2} (u_i^\\star + u_{i+1}^\\star)$，该式不包含来自 $\\pi$ 的直接贡献，可能导致速度和压力解耦，从而容许不影响质量通量散度的虚假棋盘格压力场。\n\n你的任务是：\n1. 从在间距为 $\\Delta x = L/N$ 的均匀一维同位网格上离散化的动量方程出发，推导一种将机械压力梯度与面速度耦合的 Rhie–Chow 型面插值。在单元层面使用稳态、线性的离散动量算子，其系数与粘性项的二阶中心离散格式一致，从而得到单元系数 $a_P = 2\\mu/\\Delta x$。证明一个一致的 Rhie–Chow 型面速度可以写成\n$$\nu_{i+\\frac{1}{2}}^{\\text{RC}} = \\tfrac{1}{2} \\left( u_i^\\star + u_{i+1}^\\star \\right) - \\frac{1}{a_{i+\\frac{1}{2}}} \\frac{\\pi_{i+1} - \\pi_i}{\\Delta x},\n$$\n其中 $a_{i+\\frac{1}{2}}$ 取为相邻单元系数的算术平均值，对于均匀粘度，该值简化为 $a_{i+\\frac{1}{2}} = 2\\mu/\\Delta x$。\n2. 定义面质量通量 $m_{i+\\frac{1}{2}} = \\rho \\, u_{i+\\frac{1}{2}}$ 和单元 $i$ 中的离散散度\n$$\n\\left( \\nabla \\cdot \\mathbf{m} \\right)_i = \\frac{m_{i+\\frac{1}{2}} - m_{i-\\frac{1}{2}}}{\\Delta x},\n$$\n采用周期性索引，即 $m_{-\\frac{1}{2}} = m_{N-\\frac{1}{2}}$ 和 $m_{N+\\frac{1}{2}} = m_{\\frac{1}{2}}$。证明当 $u_i^\\star = 0$ 且存在棋盘格机械压力场 $\\pi_i = A(-1)^i$ 时，简单插值产生零离散散度，而 Rhie–Chow 插值产生一个与 $A$、$\\rho$、$\\mu$ 和 $\\Delta x$ 成比例的非零离散散度。\n3. 实现一个程序，对于一组给定的测试用例，构建压力场 $\\pi_i$，在 $u_i^\\star = 0$ 的条件下计算简单插值和 Rhie–Chow 插值的面速度，计算面质量通量，并报告两种插值方法在所有单元上的离散散度的均方根 (RMS)：\n$$\n\\text{RMS} = \\sqrt{ \\frac{1}{N} \\sum_{i=0}^{N-1} \\left( (\\nabla \\cdot \\mathbf{m})_i \\right)^2 }.\n$$\n\n使用以下参数值的测试套件：\n- 测试用例 1 (理想路径)：$N=32$, $L=1.0$, $\\rho=1.0$, $\\mu=1.0$, $A=1.0$，压力类型 = 棋盘格，即 $\\pi_i = A(-1)^i$。\n- 测试用例 2 (奇数网格尺寸)：$N=31$, $L=1.0$, $\\rho=1.0$, $\\mu=1.0$, $A=1.0$，压力类型 = 棋盘格。\n- 测试用例 3 (基线恒定压力)：$N=32$, $L=1.0$, $\\rho=1.0$, $\\mu=1.0$, $A=0.0$，压力类型 = 恒定，即 $\\pi_i = A$。\n- 测试用例 4 (平滑模式，低粘度)：$N=64$, $L=1.0$, $\\rho=1.0$, $\\mu=0.1$, $A=1.0$，压力类型 = 正弦，即 $\\pi_i = A \\sin(2\\pi x_i)$，其中 $x_i = (i+0.5)\\Delta x$。\n- 测试用例 5 (平滑模式，高粘度)：$N=64$, $L=1.0$, $\\rho=1.0$, $\\mu=2.0$, $A=1.0$，压力类型 = 正弦，即 $\\pi_i = A \\sin(2\\pi x_i)$。\n\n对于每个测试用例，计算并输出两个浮点数：简单插值的 RMS 散度和 Rhie–Chow 插值的 RMS 散度。你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表，顺序为 $[\\text{naive}_1,\\text{RC}_1,\\text{naive}_2,\\text{RC}_2,\\dots,\\text{naive}_5,\\text{RC}_5]$。\n所有输出均为无量纲浮点数。输出中不需要物理单位。",
            "solution": "用户提供的问题是有效的，因为它基于计算流体动力学的原理，具有科学依据，提法得当，目标明确，并且没有任何在问题验证标准中列出的无效缺陷。执行所需的推导、分析和实现所必需的数据、方程和边界条件均已提供。\n\n### 第 1 部分：Rhie–Chow 插值的推导\n\n目标是从一维同位网格上的离散化稳态动量方程出发，推导出一个耦合压力和速度的面速度插值格式。\n\n对于物性恒定且无体积力的不可压缩牛顿流体，其稳态动量方程为：\n$$ \\mathbf{0} = -\\nabla \\pi + \\mu \\nabla^2 \\mathbf{u} $$\n在一维情况下，这简化为：\n$$ 0 = -\\frac{d\\pi}{dx} + \\mu \\frac{d^2u}{dx^2} $$\n我们使用有限体积法 (FVM)，通过在宽度为 $\\Delta x = L/N$ 的控制体 $[x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}]$ 上进行积分，在网格中心 $i$ 处对此方程进行离散化。\n$$ \\int_{i-\\frac{1}{2}}^{i+\\frac{1}{2}} \\left( -\\frac{d\\pi}{dx} + \\mu \\frac{d^2u}{dx^2} \\right) dx = 0 $$\n$$ -\\left( \\pi_{i+\\frac{1}{2}} - \\pi_{i-\\frac{1}{2}} \\right) + \\mu \\left( \\left.\\frac{du}{dx}\\right|_{i+\\frac{1}{2}} - \\left.\\frac{du}{dx}\\right|_{i-\\frac{1}{2}} \\right) = 0 $$\n对网格面上的通量使用二阶中心差分近似：\n$$ \\left.\\frac{du}{dx}\\right|_{i+\\frac{1}{2}} \\approx \\frac{u_{i+1} - u_i}{\\Delta x} $$\n$$ \\left.\\frac{du}{dx}\\right|_{i-\\frac{1}{2}} \\approx \\frac{u_i - u_{i-1}}{\\Delta x} $$\n将这些代入积分后的方程，得到：\n$$ -\\left( \\pi_{i+\\frac{1}{2}} - \\pi_{i-\\frac{1}{2}} \\right) + \\frac{\\mu}{\\Delta x} \\left( (u_{i+1} - u_i) - (u_i - u_{i-1}) \\right) = 0 $$\n$$ \\frac{\\mu}{\\Delta x} (u_{i+1} - 2u_i + u_{i-1}) = \\pi_{i+\\frac{1}{2}} - \\pi_{i-\\frac{1}{2}} $$\n在同位网格上，面上的压力通常通过插值得到，例如 $\\pi_{i+\\frac{1}{2}} = \\frac{1}{2}(\\pi_i + \\pi_{i+1})$。压力项则变为 $\\frac{1}{2}(\\pi_{i+1} - \\pi_{i-1})$。将方程重排为标准 FVM 形式 $a_i u_i = \\sum_{nb} a_{nb} u_{nb} + S_u$：\n$$ \\frac{2\\mu}{\\Delta x} u_i = \\frac{\\mu}{\\Delta x} u_{i+1} + \\frac{\\mu}{\\Delta x} u_{i-1} + S_{\\pi} $$\n这给出了单元系数 $a_i = 2\\mu/\\Delta x$，与问题陈述 ($a_P = 2\\mu/\\Delta x$) 相符。包含相邻速度的项是 $H(u)_i = \\frac{\\mu}{\\Delta x} (u_{i+1} + u_{i-1})$。在单元 $i$ 处的完整离散动量方程可以写成：\n$$ a_i u_i = H(u)_i - (\\nabla_d \\pi)_i $$\n其中 $(\\nabla_d \\pi)_i$ 表示离散压力梯度项。\n\n在分离式压力基求解器中，通常通过省略压力梯度项（或使用上一次迭代的压力场），从动量方程计算出预测速度 $u^\\star$。\n$$ a_i u_i^\\star = H(u)_i $$\n将此代回完整的动量方程，得到网格中心速度 $u_i$ 的表达式：\n$$ u_i = u_i^\\star - \\frac{1}{a_i} (\\nabla_d \\pi)_i $$\nRhie–Chow 插值格式避免了对网格中心速度的简单平均。取而代之的是，它对单元 $i$ 和单元 $i+1$ 处的网格中心速度表达式进行平均，然后用面 $i+\\frac{1}{2}$ 处的紧凑模板来近似压力梯度项。\n为了求得面 $i+\\frac{1}{2}$ 处的速度，我们首先将 $u_i$ 的方程插值到该面上：\n$$ u_{i+\\frac{1}{2}} = \\overline{(u^\\star)}_{i+\\frac{1}{2}} - \\overline{\\left(\\frac{1}{a} (\\nabla_d \\pi)\\right)}_{i+\\frac{1}{2}} $$\n其中上划线表示插值。Rhie 和 Chow 的关键思想是分开进行插值：\n$$ u_{i+\\frac{1}{2}} = \\overline{(u^\\star)}_{i+\\frac{1}{2}} - \\overline{\\left(\\frac{1}{a}\\right)}_{i+\\frac{1}{2}} (\\nabla_d \\pi)_{i+\\frac{1}{2}} $$\n我们对预测速度和系数项使用线性插值（算术平均）：\n$$ \\overline{(u^\\star)}_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(u_i^\\star + u_{i+1}^\\star\\right) $$\n$$ \\overline{\\left(\\frac{1}{a}\\right)}_{i+\\frac{1}{2}} \\approx \\frac{1}{\\overline{a}_{i+\\frac{1}{2}}} = \\frac{1}{\\frac{1}{2}(a_i + a_{i+1})} $$\n并对面上的压力梯度使用紧凑的二阶差分：\n$$ (\\nabla_d \\pi)_{i+\\frac{1}{2}} = \\frac{\\pi_{i+1} - \\pi_i}{\\Delta x} $$\n结合这些项得到 Rhie–Chow 面速度：\n$$ u_{i+\\frac{1}{2}}^{\\text{RC}} = \\frac{1}{2}\\left(u_i^\\star + u_{i+1}^\\star\\right) - \\frac{1}{\\frac{1}{2}(a_i + a_{i+1})} \\frac{\\pi_{i+1} - \\pi_i}{\\Delta x} $$\n令 $a_{i+\\frac{1}{2}} = \\frac{1}{2}(a_i + a_{i+1})$，并且在给定粘度 $\\mu$ 恒定和网格间距 $\\Delta x$ 均匀的情况下，我们有 $a_i = a_{i+1} = 2\\mu/\\Delta x$。因此，面系数为：\n$$ a_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(\\frac{2\\mu}{\\Delta x} + \\frac{2\\mu}{\\Delta x}\\right) = \\frac{2\\mu}{\\Delta x} $$\n将此代入面速度表达式，得到最终所需的形式：\n$$ u_{i+\\frac{1}{2}}^{\\text{RC}} = \\frac{1}{2}\\left(u_i^\\star + u_{i+1}^\\star\\right) - \\frac{1}{2\\mu/\\Delta x} \\frac{\\pi_{i+1} - \\pi_i}{\\Delta x} $$\n该表达式将面速度与局部压力差 $\\pi_{i+1} - \\pi_i$ 直接联系起来，提供了预测速度的简单插值 $u_{i+\\frac{1}{2}}^{\\text{naive}} = \\frac{1}{2} (u_i^\\star + u_{i+1}^\\star)$ 中所缺乏的必要的压力-速度耦合。\n\n### 第 2 部分：棋盘格压力场分析\n\n我们分析当预测速度为零（$u_i^\\star=0$）且压力场为棋盘格模式（$\\pi_i = A(-1)^i$）时的离散质量散度。\n\n**简单插值：**\n简单面速度定义为 $u_{i+\\frac{1}{2}}^{\\text{naive}} = \\frac{1}{2} (u_i^\\star + u_{i+1}^\\star)$。当对所有 $i$ 都有 $u_i^\\star=0$ 时：\n$$ u_{i+\\frac{1}{2}}^{\\text{naive}} = \\frac{1}{2}(0 + 0) = 0 $$\n相应的面质量通量为 $m_{i+\\frac{1}{2}}^{\\text{naive}} = \\rho u_{i+\\frac{1}{2}}^{\\text{naive}} = 0$。单元 $i$ 中的离散散度为：\n$$ \\left( \\nabla \\cdot \\mathbf{m} \\right)_i^{\\text{naive}} = \\frac{m_{i+\\frac{1}{2}}^{\\text{naive}} - m_{i-\\frac{1}{2}}^{\\text{naive}}}{\\Delta x} = \\frac{0 - 0}{\\Delta x} = 0 $$\n这对所有单元 $i$ 都成立。因此，简单插值格式未能察觉棋盘格压力场，导致散度场为零。这表明压力和速度发生了解耦。\n\n**Rhie–Chow 插值：**\n当 $u_i^\\star=0$ 时的 Rhie–Chow 面速度为：\n$$ u_{i+\\frac{1}{2}}^{\\text{RC}} = - \\frac{1}{a_{i+\\frac{1}{2}}} \\frac{\\pi_{i+1} - \\pi_i}{\\Delta x} = - \\frac{\\Delta x}{2\\mu} \\frac{A(-1)^{i+1} - A(-1)^i}{\\Delta x} $$\n$$ u_{i+\\frac{1}{2}}^{\\text{RC}} = - \\frac{A}{2\\mu} \\left( (-1)^{i+1} - (-1)^i \\right) = - \\frac{A}{2\\mu} (-1)^i \\left( -1 - 1 \\right) = \\frac{A}{\\mu} (-1)^i $$\n面质量通量为：\n$$ m_{i+\\frac{1}{2}}^{\\text{RC}} = \\rho u_{i+\\frac{1}{2}}^{\\text{RC}} = \\frac{\\rho A}{\\mu} (-1)^i $$\n现在，我们计算单元 $i$ 中的离散散度：\n$$ \\left( \\nabla \\cdot \\mathbf{m} \\right)_i^{\\text{RC}} = \\frac{m_{i+\\frac{1}{2}}^{\\text{RC}} - m_{i-\\frac{1}{2}}^{\\text{RC}}}{\\Delta x} $$\n前一个面 $i-\\frac{1}{2}$ 的通量可以通过将 $i$ 替换为 $i-1$ 找到：\n$$ m_{i-\\frac{1}{2}}^{\\text{RC}} = \\frac{\\rho A}{\\mu} (-1)^{i-1} = -\\frac{\\rho A}{\\mu} (-1)^i $$\n将面通量代入散度表达式：\n$$ \\left( \\nabla \\cdot \\mathbf{m} \\right)_i^{\\text{RC}} = \\frac{1}{\\Delta x} \\left[ \\frac{\\rho A}{\\mu} (-1)^i - \\left(-\\frac{\\rho A}{\\mu} (-1)^i\\right) \\right] = \\frac{2 \\rho A}{\\mu \\Delta x} (-1)^i $$\n对于 $A \\neq 0$，此结果非零，表明 Rhie–Chow 插值能正确感知棋盘格压力梯度，从而产生非零的质量散度。该散度的大小 $|(\\nabla \\cdot \\mathbf{m})_i^{\\text{RC}}| = \\frac{2 \\rho A}{\\mu \\Delta x}$，与 $A$ 和 $\\rho$ 成正比，与 $\\mu$ 和 $\\Delta x$ 成反比，正如所要求的那样。在完整的求解器中，这个非零散度将驱动一个压力修正步骤，以消除虚假的棋盘格模式。\n\n### 第 3 部分：实现\n\n提供的 Python 代码实现了一系列测试用例中，针对简单插值和 Rhie–Chow 插值的离散质量散度均方根 (RMS) 的计算。如解析分析所示及问题陈述所要求，对零预测速度场的简单插值总是产生零面速度，因此散度为零。相比之下，Rhie–Chow 插值包含一个压力梯度项，对于非恒定压力场会产生非零的面速度和非零的散度场。程序根据推导出的公式和周期性边界条件计算这些值，周期性边界条件通过 `numpy.roll` 处理。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_divergence_rms(N, L, rho, mu, A, pressure_type):\n    \"\"\"\n    Computes the RMS of the discrete mass divergence for naive and Rhie-Chow\n    interpolations for a single test case.\n    \n    Args:\n        N (int): Number of control volumes.\n        L (float): Length of the domain.\n        rho (float): Fluid density.\n        mu (float): Dynamic viscosity.\n        A (float): Amplitude of the pressure field.\n        pressure_type (str): Type of pressure field ('checkerboard', 'constant', 'sinusoidal').\n        \n    Returns:\n        tuple[float, float]: RMS divergence for naive and Rhie-Chow methods.\n    \"\"\"\n    delta_x = L / N\n    i = np.arange(N)\n\n    # 1. Construct the pressure field pi_i\n    if pressure_type == 'checkerboard':\n        pi = A * (-1.0)**i\n    elif pressure_type == 'constant':\n        pi = A * np.ones(N)\n    elif pressure_type == 'sinusoidal':\n        x_i = (i + 0.5) * delta_x\n        pi = A * np.sin(2 * np.pi * x_i)\n    else:\n        raise ValueError(\"Unknown pressure_type\")\n\n    # Predictor velocity is zero for all cases\n    # u_star = np.zeros(N)\n\n    # 2. Compute naive interpolation results\n    # u_naive_face = 0.5 * (u_star_i + u_star_i+1) = 0\n    # m_naive_face = 0\n    # div_m_naive = 0\n    rms_naive = 0.0\n\n    # 3. Compute Rhie-Chow interpolation results\n    # Face coefficient a_{i+1/2} = 2*mu/delta_x for uniform grid\n    a_face = 2.0 * mu / delta_x\n    \n    # Pressure difference at faces i+1/2\n    # np.roll handles periodic boundary conditions for pi_{i+1}\n    pi_iplus1 = np.roll(pi, -1)\n    delta_pi_face = pi_iplus1 - pi\n    \n    # Calculate RC face velocity u_{i+1/2} and mass flux m_{i+1/2}\n    # Per the problem, u_star is zero\n    u_face_rc = - (1.0 / a_face) * (delta_pi_face / delta_x)\n    m_face_rc = rho * u_face_rc\n    \n    # Calculate discrete divergence (div . m)_i at cell centers\n    # (m_{i+1/2} - m_{i-1/2}) / delta_x\n    # np.roll handles periodic BC for m_{i-1/2}\n    m_face_rc_iminushalf = np.roll(m_face_rc, 1)\n    div_m_rc = (m_face_rc - m_face_rc_iminushalf) / delta_x\n    \n    # Calculate RMS of the divergence\n    rms_rc = np.sqrt(np.mean(div_m_rc**2))\n    \n    return rms_naive, rms_rc\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, L, rho, mu, A, pressure_type)\n        (32, 1.0, 1.0, 1.0, 1.0, 'checkerboard'),\n        (31, 1.0, 1.0, 1.0, 1.0, 'checkerboard'),\n        (32, 1.0, 1.0, 1.0, 0.0, 'constant'),\n        (64, 1.0, 1.0, 0.1, 1.0, 'sinusoidal'),\n        (64, 1.0, 1.0, 2.0, 1.0, 'sinusoidal'),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, L, rho, mu, A, p_type = case\n        rms_naive, rms_rc = compute_divergence_rms(N, L, rho, mu, A, p_type)\n        results.extend([rms_naive, rms_rc])\n\n    # Final print statement in the exact required format.\n    # Using 'g' for general-purpose floating point formatting.\n    print(f\"[{','.join(f'{r:.12g}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}