{
    "hands_on_practices": [
        {
            "introduction": "掌握任何一种新的计算工具，第一步都是理解其数学根源。本练习将交叉线法的应用建立在基础的三维几何学之上，要求你为一种常见且重要的构型——两个平行的、有偏移的矩形——推导出关键的代数表达式 ()。通过展示该方法是毕达哥拉斯定理的直接应用，这个练习将帮助你建立信心，并为更复杂的应用打下坚实的基础。",
            "id": "4003293",
            "problem": "考虑三维欧几里得空间中的两个轴对齐的矩形。矩形 $\\mathcal{R}_{1}$ 位于平面 $z=0$ 上，其中心在原点，沿 $x$ 方向的边长为 $a$，沿 $y$ 方向的边长为 $b$，因此其角点坐标为 $(\\pm a/2,\\pm b/2,0)$。矩形 $\\mathcal{R}_{2}$ 位于平面 $z=h>0$ 上，其中心在 $(x_{0},y_{0},h)$，沿 $x$ 方向的边长为 $c$，沿 $y$ 方向的边长为 $d$，因此其角点坐标为 $(x_{0}\\pm c/2,y_{0}\\pm d/2,h)$。在辐射角系数代数和Hottel交叉线法的背景下，我们在选定的角点对之间构造四条“弦”（即直线段）：两条指定为“交叉”弦，两条指定为“非交叉”弦。将连接两个矩形对角的弦视为“交叉”弦，将连接对应角点的弦视为“非交叉”弦。\n\n从基本几何原理（三维欧几里得距离和二维平面投影）出发，推导连接 $(-a/2,-b/2,0)$ 与 $(x_{0}+c/2,y_{0}+d/2,h)$、$( a/2, b/2,0)$ 与 $(x_{0}-c/2,y_{0}-d/2,h)$、$(-a/2,-b/2,0)$ 与 $(x_{0}-c/2,y_{0}-d/2,h)$ 以及 $( a/2, b/2,0)$ 与 $(x_{0}+c/2,y_{0}+d/2,h)$ 的四条弦的角点间距离的显式闭式表达式。通过检查相应弦在$xy$平面上的投影是否相交，来区分哪两条是交叉弦，哪两条是非交叉弦。最后，构造交叉弦泛函，其定义为交叉弦距离之和减去非交叉弦距离之和，并用 $a$, $b$, $c$, $d$, $x_{0}$, $y_{0}$ 和 $h$ 将其表示为单个闭式解析表达式。最终答案必须是单个闭式表达式。不要进行近似或四舍五入。",
            "solution": "我们首先精确地定义几何形状。矩形 $\\mathcal{R}_{1}$ 的角点为\n$$\nA_{1}=(-a/2,-b/2,0),\\quad B_{1}=(a/2,-b/2,0),\\quad C_{1}=(a/2,b/2,0),\\quad D_{1}=(-a/2,b/2,0).\n$$\n矩形 $\\mathcal{R}_{2}$ 的角点为\n$$\nA_{2}=(x_{0}-c/2,y_{0}-d/2,h),\\quad B_{2}=(x_{0}+c/2,y_{0}-d/2,h),\\quad C_{2}=(x_{0}+c/2,y_{0}+d/2,h),\\quad D_{2}=(x_{0}-c/2,y_{0}+d/2,h).\n$$\n\n对于平行的、轴对齐的矩形，Hottel交叉线法中的构造使用了四条连接角点对的弦。一个能产生两条“交叉”弦和两条“非交叉”弦的常规且对称的选择是：\n- 交叉弦: $A_{1}\\rightarrow C_{2}$ 和 $C_{1}\\rightarrow A_{2}$，\n- 非交叉弦: $A_{1}\\rightarrow A_{2}$ 和 $C_{1}\\rightarrow C_{2}$。\n\n“交叉”与“非交叉”的分类可以通过检查这些线段在$xy$平面上的投影来证实。$A_{1}\\rightarrow C_{2}$ 和 $C_{1}\\rightarrow A_{2}$ 在$xy$平面上的投影分别连接了偏移矩形的西南角到东北角以及东北角到西南角。在$xy$平面上，对于轴对齐的配置，这两条投影线段通常会相交，因为它们连接了两个矩形的对角，从而在四个投影点的凸包内形成了经典的对角线交叉。相比之下，$A_{1}\\rightarrow A_{2}$ 和 $C_{1}\\rightarrow C_{2}$ 的投影连接了对应的角点（西南到西南，东北到东北），它们彼此不相交；因此被指定为“非交叉”弦。\n\n现在我们使用三维距离公式计算这四条指定弦的欧几里得距离。对于任意两点 $(x_{1},y_{1},z_{1})$ 和 $(x_{2},y_{2},z_{2})$，其欧几里得距离为\n$$\nr=\\sqrt{(x_{2}-x_{1})^{2}+(y_{2}-y_{1})^{2}+(z_{2}-z_{1})^{2}}.\n$$\n\n计算各段距离：\n\n1. $A_{1}\\rightarrow C_{2}$ 的距离：\n$$\nr_{A_{1}C_{2}}=\\sqrt{\\bigl(x_{0}+c/2-(-a/2)\\bigr)^{2}+\\bigl(y_{0}+d/2-(-b/2)\\bigr)^{2}+\\bigl(h-0\\bigr)^{2}}=\\sqrt{\\bigl(x_{0}+(a+c)/2\\bigr)^{2}+\\bigl(y_{0}+(b+d)/2\\bigr)^{2}+h^{2}}.\n$$\n\n2. $C_{1}\\rightarrow A_{2}$ 的距离：\n$$\nr_{C_{1}A_{2}}=\\sqrt{\\bigl(x_{0}-c/2-(a/2)\\bigr)^{2}+\\bigl(y_{0}-d/2-(b/2)\\bigr)^{2}+h^{2}}=\\sqrt{\\bigl(x_{0}-(a+c)/2\\bigr)^{2}+\\bigl(y_{0}-(b+d)/2\\bigr)^{2}+h^{2}}.\n$$\n\n3. $A_{1}\\rightarrow A_{2}$ 的距离：\n$$\nr_{A_{1}A_{2}}=\\sqrt{\\bigl(x_{0}-c/2-(-a/2)\\bigr)^{2}+\\bigl(y_{0}-d/2-(-b/2)\\bigr)^{2}+h^{2}}=\\sqrt{\\bigl(x_{0}+(a-c)/2\\bigr)^{2}+\\bigl(y_{0}+(b-d)/2\\bigr)^{2}+h^{2}}.\n$$\n\n4. $C_{1}\\rightarrow C_{2}$ 的距离：\n$$\nr_{C_{1}C_{2}}=\\sqrt{\\bigl(x_{0}+c/2-(a/2)\\bigr)^{2}+\\bigl(y_{0}+d/2-(b/2)\\bigr)^{2}+h^{2}}=\\sqrt{\\bigl(x_{0}+(c-a)/2\\bigr)^{2}+\\bigl(y_{0}+(d-b)/2\\bigr)^{2}+h^{2}}.\n$$\n\n我们已经证明了分类的合理性：\n- 交叉弦: $r_{A_{1}C_{2}}$ 和 $r_{C_{1}A_{2}}$，\n- 非交叉弦: $r_{A_{1}A_{2}}$ 和 $r_{C_{1}C_{2}}$。\n\n最后，我们将交叉弦泛函 $S$ 定义为交叉弦距离之和减去非交叉弦距离之和：\n$$\nS \\equiv r_{A_{1}C_{2}}+r_{C_{1}A_{2}}-r_{A_{1}A_{2}}-r_{C_{1}C_{2}}.\n$$\n代入上面得到的表达式，可得出闭式解析表达式\n$$\nS=\\sqrt{\\bigl(x_{0}+(a+c)/2\\bigr)^{2}+\\bigl(y_{0}+(b+d)/2\\bigr)^{2}+h^{2}}+\\sqrt{\\bigl(x_{0}-(a+c)/2\\bigr)^{2}+\\bigl(y_{0}-(b+d)/2\\bigr)^{2}+h^{2}}-\\sqrt{\\bigl(x_{0}+(a-c)/2\\bigr)^{2}+\\bigl(y_{0}+(b-d)/2\\bigr)^{2}+h^{2}}-\\sqrt{\\bigl(x_{0}+(c-a)/2\\bigr)^{2}+\\bigl(y_{0}+(d-b)/2\\bigr)^{2}+h^{2}}.\n$$\n\n这个 $S$ 概括了给定轴对齐矩形的交叉弦构造，并且是用 $a$, $b$, $c$, $d$, $x_{0}$, $y_{0}$ 和 $h$ 表示的所要求的单个闭式解析表达式。",
            "answer": "$$\\boxed{\\sqrt{\\bigl(x_{0}+\\tfrac{a+c}{2}\\bigr)^{2}+\\bigl(y_{0}+\\tfrac{b+d}{2}\\bigr)^{2}+h^{2}}+\\sqrt{\\bigl(x_{0}-\\tfrac{a+c}{2}\\bigr)^{2}+\\bigl(y_{0}-\\tfrac{b+d}{2}\\bigr)^{2}+h^{2}}-\\sqrt{\\bigl(x_{0}+\\tfrac{a-c}{2}\\bigr)^{2}+\\bigl(y_{0}+\\tfrac{b-d}{2}\\bigr)^{2}+h^{2}}-\\sqrt{\\bigl(x_{0}+\\tfrac{c-a}{2}\\bigr)^{2}+\\bigl(y_{0}+\\tfrac{d-b}{2}\\bigr)^{2}+h^{2}}}$$"
        },
        {
            "introduction": "真实世界的计算充满了挑战，理想的几何公式在面对“退化”情况（例如点共线或重合）时可能会失效，而这些情况在数值模型中很常见。本练习 () 将挑战你像一名软件开发者一样思考，选择一个能够处理这些边缘情况的规则，同时又能保持连续性和互易性这些基本物理属性。这是编写可靠、稳健代码的关键一步。",
            "id": "4003313",
            "problem": "考虑嵌入在一个平面内的两个漫射、灰体、等温、完全吸收的线段 $\\overline{A_1A_2}$ 和 $\\overline{B_1B_2}$，它们代表了垂直于该平面的无限长表面的二维横截面。需要使用交叉线构造法计算从 $\\overline{A_1A_2}$ 到 $\\overline{B_1B_2}$ 的角系数 $F_{12}$。该方法将 $\\overline{A_1A_2}$ 的每个端点与 $\\overline{B_1B_2}$ 的每个端点连接起来，然后将得到的四条弦划分为两个不相交的类别，其划分依据是同一类别中的两条弦是否在其内部交叉。在严格非退化的构型中，这种构造会产生唯一的划分和一个相应的长度代数组合，已知该组合关于端点是连续的，并且满足互易关系 $L_1 F_{12} = L_2 F_{21}$，其中 $L_1 = \\lVert A_2 - A_1 \\rVert_2$ 且 $L_2 = \\lVert B_2 - B_1 \\rVert_2$。\n\n然而，在计算实践中，构型可能因两种方式之一而退化：(i) 端点重合，即对于某些 $i,j \\in \\{1,2\\}$ 有 $A_i = B_j$，这会产生长度为零的弦；以及 (ii) 共线性，即 $\\{A_1,A_2,B_1,B_2\\}$ 中的三个或四个点共线，这可能导致两条弦在一个端点处接触或位于同一条直线上，从而使得交叉/非交叉的二元分类变得模糊不清。此类退化情况在连续几何中测度为零，但由于网格划分和浮点舍入而频繁发生。\n\n从以下基本事实出发：(a) 角系数由一个平滑核函数在两个线段上的二重积分定义，因此只要线段保持不相交，角系数就连续地依赖于线段端点；(b) 对于任何容许的构型，互易关系要求 $L_1 F_{12} = L_2 F_{21}$。请选择一个选项，该选项规定一个数值稳健、标签对称的规则来处理重合或共线的顶点，无任意偏差地解决分类问题，并保证连续性（作为非退化扰动的极限）和互易性。\n\n哪个选项是正确的？\n\nA. 将任何相交的弦对（包括在端点处接触）分类为“交叉”，并从所有求和中丢弃任何零长度的弦；如果分类中仍存在平局，则通过选择索引标签最小的弦对作为“非交叉”来打破平局。这强制执行了严格的几何相交规则，并避免了数值奇异性。\n\nB. 对 $\\overline{B_1B_2}$ 沿一个为整个计算选择一次的、固定的、任意的单位方向 $\\hat{\\mathbf{n}}$ 进行无穷小平移 $\\varepsilon \\,\\hat{\\mathbf{n}}$（其中 $\\varepsilon \\to 0^+$）；平移后使用严格不等式对交叉情况进行分类，并将结果映射回原始构型。将零长度的弦视为不存在。这模拟了一般位置构型，同时保持了算法的简单性。\n\nC. 使用有向线段相交谓词和以下对称的平局打破规则：当且仅当每条弦都与另一条弦的内部真正相交（严格相反的符号方向）时，才声明两条弦为“交叉”；并将任何端点接触或共线情况（相对于任一线段为零方向）声明为“非交叉”。如果对于任何 $i,j$ 有 $A_i = B_j$，则将该零长度弦包含一次，并将其置于“非交叉”类别中。如果四个点共线，将两条弦都分类为“非交叉”。使用精确或自适应精度的稳健谓词实现方向测试；当重合端点需要去重时，使用端点坐标的字典序来选择唯一的代表，以使分类与标签无关。该规则独立于标签顺序，并与非退化扰动的极限相匹配。\n\nD. 通过添加 $\\delta \\, \\xi$ 来独立地抖动所有坐标，其中 $\\xi$ 从 $[-1,1]$ 中均匀采样，$\\delta > 0$ 是一个固定的小值；重新计算分类，并对 $N$ 次独立抖动的结果取平均值（取较大的 $N$）。将任何零长度的弦视为不存在。根据大数定律，这会产生一个稳定的估计，并避免了处理退化逻辑。\n\n请给出您的选择，并基于积分定义的基本连续性和互易关系 $L_1 F_{12} = L_2 F_{21}$ 来证明其合理性，不要借助任何未经证实的交叉线法捷径公式。您的证明应阐明为什么不正确的选项在至少一种现实的构型中无法满足连续性或互易性。假设线段保持不相交（有正的间距），因此角系数是有限且良定义的。",
            "solution": "问题要求为使用交叉线法计算两个线段 $\\overline{A_1A_2}$ 和 $\\overline{B_1B_2}$ 之间的二维角系数 $F_{12}$ 时，选择一个弦分类规则。该规则必须对退化的几何构型（端点重合或共线）具有鲁棒性，并且必须保证角系数的两个基本性质：关于端点坐标的连续性，以及满足互易关系 $L_1 F_{12} = L_2 F_{21}$（其中 $L_1$ 和 $L_2$ 是线段的长度）。它还必须是一个“标签对称”的规则，意味着它应该对端点的重新标记（例如，交换 $A_1$ 和 $A_2$）是不变的。\n\n首先，我们建立理论基础。交叉线法提供了一个交换因子 $E_{12} = L_1 F_{12}$ 的表达式。该方法涉及连接两个线段端点的四条弦：$\\overline{A_1B_1}$、$\\overline{A_1B_2}$、$\\overline{A_2B_1}$ 和 $\\overline{A_2B_2}$。这四条弦可以被划分为两个不共享任何端点的弦对：$P_a = \\{\\overline{A_1B_1}, \\overline{A_2B_2}\\}$ 和 $P_b = \\{\\overline{A_1B_2}, \\overline{A_2B_1}\\}$。在非退化构型中，其中一对（“交叉”弦）的弦将在其内部相交，而另一对（“非交叉”弦）的弦则不会。交换因子由以下代数组合给出：\n$$E_{12} = L_1 F_{12} = \\frac{1}{2} \\left[ \\sum L_{\\text{crossed}} - \\sum L_{\\text{uncrossed}} \\right]$$\n其中 $\\sum L$ 是相应类别中弦的长度之和。为使角系数 $F_{12}$ 为非负值，交叉弦的长度之和必须大于或等于非交叉弦的长度之和。\n\n我们必须根据主要要求来评估每个选项：\n\n1.  **连续性**：如问题所述，由基本二重积分定义的角系数是端点坐标的连续函数（只要线段不相交）。任何用于代数交叉线法的规则都必须再现这种连续性。如果在退化构型处，弦到“交叉”和“非交叉”的分类发生突变，计算出的 $F_{12}$ 中就会出现不连续性。分类的切换会导致项 $\\left[ \\sum L_{\\text{crossed}} - \\sum L_{\\text{uncrossed}} \\right]$ 改变其符号。为了保持连续性，该项在过渡点必须为零。\n\n2.  **互易性**：规则必须确保 $L_1 F_{12} = L_2 F_{21}$。这意味着 $E_{12} = E_{21}$。$E_{21}$ 的计算涉及相同的四条弦和相同的几何形状。当且仅当将弦分为“交叉”和“非交叉”的分类对于交换线段1和线段2的角色是对称的时，互易性才得到满足。这要求规则基于四个端点的内蕴几何，而与哪个线段是源无关。\n\n3.  **标签对称性**：计算出的 $F_{12}$ 值不得依赖于线段端点的任意标记（例如，交换 $A_1$ 和 $A_2$）。这也要求分类规则基于内蕴几何性质，而不是索引标签。\n\n现在，我们来评估给出的选项。\n\n**选项A分析**\n该选项提议将任何相交的弦（包括仅在端点处接触）分类为“交叉”。我们考虑一种构型，其中对角线（例如 $\\overline{A_1B_2}$ 和 $\\overline{A_2B_1}$）在一个端点处接触。根据此规则，它们是“交叉的”。一个无穷小的扰动可以使它们完全不相交。在这种受扰动的状态下，它们将被分类为“非交叉”，而另一对则被分类为“交叉”。这导致 $E_{12}$ 的表达式改变符号，在 $F_{12}$ 中引入了不连续性，这违反了连续性原则。此外，使用“最小的索引标签”来打破平局的规则明确地依赖于点的任意标记，这违反了标签对称性的要求。丢弃零长度的弦也可能导致不连续性，因为一个平滑趋近于零的弦长度会突然从公式中被移除。\n**结论：不正确。**\n\n**选项B分析**\n该选项建议通过对其中一个线段施加无穷小平移 $\\varepsilon \\hat{\\mathbf{n}}$ 来解决退化问题。这是一种常见的扰动技术。然而，方向 $\\hat{\\mathbf{n}}$ 的选择是“固定的”但“任意的”。考虑一个四点构型，其中一个顶点与由四个端点形成的四边形的一条边共线。在一个方向上的扰动可能导致一个凸四边形（对角线交叉），而在另一个方向上的扰动可能导致一个非凸四边形（对角线不交叉）。最终的分类——以及 $F_{12}$ 的值——将取决于对 $\\hat{\\mathbf n}$ 的任意选择。这将违反客观、无偏规则的要求，并且不能保证对于给定的退化几何形状有唯一的结果。\n**结论：不正确。**\n\n**选项C分析**\n该选项提供了一个详细的、多部分的规则，其基础是稳健计算几何的原则。\n1.  **相交测试**：它使用一个严格的内部相交谓词来定义“交叉”。这基于方向测试（例如，使用三角形的有符号面积或叉积），这是标准的稳健方法。一对线段 $\\overline{PQ}$ 和 $\\overline{RS}$ 真正相交当且仅当每条线段的端点位于由另一条线段定义的直线的两侧。这个测试纯粹是几何的，因此关于交换线段是对称的（确保互易性），并且对端点重新标记是不变的（确保标签对称性）。\n2.  **退化处理（共线性/接触）**：方向测试产生零的情况（共线性或端点接触）被明确分类为“非交叉”。让我们为了连续性来分析这一点。从“交叉”到“非交叉”的过渡发生在四个相关端点变得共线时。在这种构型中（例如，$A_1, A_2, B_1, B_2$ 都在一条直线上，且线段是分开的），无论如何分类，弦的长度都使得 $(\\sum L_{\\text{crossed}}) - (\\sum L_{\\text{uncrossed}}) = 0$。例如，对于直线上 $x_1<x_2<x_3<x_4$ 的点，有 $L_{A_1B_2}+L_{A_2B_1} = (x_4-x_1)+(x_3-x_2)$ 和 $L_{A_1B_1}+L_{A_2B_2} = (x_3-x_1)+(x_4-x_2)$。这两个和是相等的。因此，在过渡的瞬间，$E_{12}=0$。通过将退化情况定义为非交叉，公式保持连续。这个规则正确地处理了过渡。\n3.  **退化处理（端点重合）**：如果 $A_i=B_j$，就会出现一个零长度的弦。规则规定将此弦放入“非交叉”类别。这意味着包含零长度弦的弦对被分类为“非交叉”对。这个规则是连续的，因为如果我们对重合的端点进行无穷小扰动，得到的构型确实会使得包含那条现在非常短的弦的弦对成为非交叉对，而另一对则相交。这个规则也是对称和标签不变的。\n4.  **实现细节**：提及“精确或自适应精度的稳健谓词”和用于去重的“字典序”是专业设计的、能够正确处理浮点问题并确保真正标签不变性的稳健计算几何算法的标志。\n\n该选项系统地处理了所有类型的退化，其规则与连续性和互易性的基本要求一致。\n**结论：正确。**\n\n**选项D分析**\n该选项提出了一种随机“抖动”方法。虽然对许多随机扰动进行平均，当扰动大小 $\\delta \\to 0$ 时可以收敛到正确的值，但这对于单次计算来说不是一个确定性的规则。它用统计估计取代了算法挑战，这在计算上是昂贵的，并且不符合在确定性算法意义上对“规则”的要求。此外，“将任何零长度的弦视为不存在”的指令定义不清且有问题。零长度弦的长度为0，应在求和中使用；完全移除该弦会改变其余三条弦的配对结构，从而破坏该方法。\n**结论：不正确。**",
            "answer": "$$\\boxed{C}$$"
        },
        {
            "introduction": "一个强大的计算方法必须与它所应用的领域的基本定律相符。本练习 () 旨在将交叉线法这一具体技巧与角系数代数的普适法则联系起来，特别是可加性原理。这个综合性的练习要求你首先从解析上证明交叉线公式满足可加性，然后通过编写程序进行数值验证。这不仅证实了该方法的有效性，也提供了一个展示解析证明与计算验证相辅相成的绝佳范例。",
            "id": "4003225",
            "problem": "考虑两个平行的、漫射的、灰体的、等温的表面，它们在二维空间中被建模为具有有限宽度的无限长条带。设表面 $S_1$ 位于 $y = 0$ 处，沿 $x$ 轴介于 $x = x_A$ 和 $x = x_B$ 之间；设表面 $S_2$ 与其平行，位于 $y = H$ 处，介于 $x = x_C$ 和 $x = x_D$ 之间，其中 $H > 0$。在漫射发射和无遮挡视线的假设下，角系数 $F_{12}$ 定义为离开表面 $S_1$ 的辐射能中直接投射到表面 $S_2$ 上的部分所占的比例。\n\n使用的基本原理：\n- 漫射表面的微分角系数定义：对于表面 $S_1$ 上的微元面积 $dA_1$ 和表面 $S_2$ 上的微元面积 $dA_2$，对角系数的贡献正比于 $\\dfrac{\\cos \\theta_1 \\cos \\theta_2}{\\pi r^2}$，其中 $\\theta_1$ 和 $\\theta_2$ 是连接两个微元中心的直线与其各自表面法线之间的夹角，$r$ 是两点之间的距离。\n- 角系数对分区的叠加性：如果表面 $S_1$ 被划分为 $N$ 个不重叠的子表面 $\\{S_{1k}\\}$，使得 $\\bigcup_k S_{1k} = S_1$，那么 $F_{12} = \\sum_{k=1}^N \\dfrac{A_{1k}}{A_1} F_{(1k)2}$，其中 $A_{1k}$ 是 $S_{1k}$ 的面积，$A_1$ 是 $S_1$ 的面积。\n- 交叉线法所依据的互易关系和几何不变性（此处问题陈述中不提供快捷公式）：角系数可以通过使用条带端点之间的角对角欧几里得距离进行等效计算来表示。\n\n任务：\n1. 从微分定义和几何关系出发，推导两个无限长平行条带之间的角系数 $F_{12}$ 的显式表达式，该表达式用点 $(x_A, 0)$、$(x_B, 0)$、$(x_C, H)$ 和 $(x_D, H)$ 之间的角对角欧几里得距离表示，且不直接引用任何快捷公式。该推导应能证明为何这些距离的某个线性组合能够得出单位平面外方向长度上条带的角系数。\n2. 使用角系数的叠加性，证明将表面 $S_1$ 沿 $x$ 方向划分为连续的子条带，并对每个子条带应用推导出的交叉线法计算，然后构建面积加权和 $\\sum_k \\dfrac{A_{1k}}{A_1} F_{(1k)2}$，其结果与完整条带 $S_1$ 的原始 $F_{12}$ 保持一致。\n3. 实现一个程序，该程序：\n   - 对给定的几何结构 $(x_A, x_B, x_C, x_D, H)$，使用推导出的交叉线法表达式计算 $F_{12}$。\n   - 将 $S_1$ 划分为指定的子条带，其端点为 $\\{x_{p,0} = x_A, x_{p,1}, \\ldots, x_{p,n} = x_B\\}$，为每个子条带 $[x_{p,k-1}, x_{p,k}]$ 计算 $F_{(1k)2}$，并构建面积加权和 $\\sum_k \\dfrac{x_{p,k} - x_{p,k-1}}{x_B - x_A} F_{(1k)2}$。\n   - 针对每个测试用例，报告完整条带的 $F_{12}$ 与分区加权和之间的绝对差，结果为浮点数。\n\n单位：\n- 所有长度单位均为米。角系数是无量纲的。由于几何形状已完全指定，因此无需指定角度。\n\n测试套件：\n提供以下五个案例的结果。在每个案例中，您的程序必须计算并输出完整条带 $F_{12}$ 与子条带角系数面积加权和之间的绝对差，结果为浮点数。\n\n- 案例1（正常路径，部分重叠，中等间距）：\n  - 几何参数：$x_A = -0.40$, $x_B = 1.10$, $x_C = -0.20$, $x_D = 0.70$, $H = 0.65$。\n  - $S_1$ 的分区点：$[-0.40, -0.10, 0.30, 0.50, 0.80, 1.10]$。\n\n- 案例2（无水平重叠，中等间距）：\n  - 几何参数：$x_A = -1.20$, $x_B = -0.20$, $x_C = 0.30$, $x_D = 1.00$, $H = 0.90$。\n  - $S_1$ 的分区点：$[-1.20, -1.05, -0.80, -0.60, -0.35, -0.20]$。\n\n- 案例3（小间距下显著偏移）：\n  - 几何参数：$x_A = 0.00$, $x_B = 0.70$, $x_C = -0.60$, $x_D = 0.10$, $H = 0.20$。\n  - $S_1$ 的分区点：$[0.00, 0.10, 0.20, 0.30, 0.40, 0.50, 0.60, 0.70]$。\n\n- 案例4（$S_1$ 非常窄，中等间距）：\n  - 几何参数：$x_A = -0.05$, $x_B = 0.05$, $x_C = -0.30$, $x_D = 0.60$, $H = 0.50$。\n  - $S_1$ 的分区点：$[-0.05, -0.01, 0.02, 0.05]$。\n\n- 案例5（宽条带，大间距）：\n  - 几何参数：$x_A = -0.30$, $x_B = 0.90$, $x_C = -0.80$, $x_D = 1.20$, $H = 5.00$。\n  - $S_1$ 的分区点：$[-0.30, 0.00, 0.30, 0.60, 0.90]$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，并严格按照上述案例的顺序排列（例如，$[d_1,d_2,d_3,d_4,d_5]$），其中每个 $d_i$ 是计算出的绝对差（一个浮点数）。不应打印任何其他文本。",
            "solution": "该问题被评估为有效，因为它科学地基于辐射传热原理，问题定义清晰完整、阐述良好，且表述客观。任务要求从第一性原理进行推导、进行形式化证明以及数值实现，所有这些都是计算科学与工程中的标准且可验证的程序。\n\n### 第1部分：角系数表达式的推导 ###\n\n问题要求从基本的微分定义出发，推导两个无限长平行条带 $S_1$ 和 $S_2$ 之间的角系数 $F_{12}$。\n设 $S_1$ 是 $xy$ 平面（$z=0$ 时）上的一个条带，定义为 $x \\in [x_A, x_B]$ 且 $y=0$。\n设 $S_2$ 是与 $S_1$ 平行的条带，定义为 $x \\in [x_C, x_D]$ 且 $y=H$，其中 $H > 0$。两个条带在 $z$ 方向上都是无限长的。\n\n从表面 $S_1$ 上的微元面积 $dA_1$ 到表面 $S_2$ 上的微元面积 $dA_2$ 的角系数由下式给出：\n$$ dF_{dA_1 \\to dA_2} = \\frac{\\cos\\theta_1 \\cos\\theta_2}{\\pi r^2} dA_2 $$\n设 $dA_1$ 位于 $(x_1, 0, z_1)$，$dA_2$ 位于 $(x_2, H, z_2)$。面积分别为 $dA_1 = dx_1 dz_1$ 和 $dA_2 = dx_2 dz_2$。\n从 $dA_1$ 到 $dA_2$ 的向量为 $\\vec{r} = (x_2 - x_1)\\hat{i} + H\\hat{j} + (z_2 - z_1)\\hat{k}$。\n距离的平方为 $r^2 = (x_2 - x_1)^2 + H^2 + (z_2 - z_1)^2$。\n$S_1$ 的单位法向量为 $\\vec{n}_1 = \\hat{j}$。$S_2$ 的单位法向量为 $\\vec{n}_2 = -\\hat{j}$。\n角度 $\\theta_1$ 和 $\\theta_2$ 由下式给出：\n$$ \\cos\\theta_1 = \\frac{\\vec{r} \\cdot \\vec{n}_1}{|\\vec{r}||\\vec{n}_1|} = \\frac{H}{r} $$\n$$ \\cos\\theta_2 = \\frac{\\vec{r} \\cdot (-\\vec{n}_2)}{|\\vec{r}||\\vec{n}_2|} = \\frac{H}{r} $$\n注意，$\\theta_2$ 是 $\\vec{r}$ 与 $S_2$ 法线 $\\vec{n}_2$ 之间的夹角。但公式使用的是连接微元的直线与各自表面法线之间的夹角。因此，该公式形式是正确的。\n从微元面积 $dA_1$ 到整个表面 $S_2$ 的角系数通过对 $S_2$ 积分得到：\n$$ F_{dA_1 \\to S_2} = \\int_{S_2} \\frac{\\cos\\theta_1 \\cos\\theta_2}{\\pi r^2} dA_2 = \\int_{z_2=-\\infty}^{\\infty} \\int_{x_2=x_C}^{x_D} \\frac{H^2}{\\pi r^4} dx_2 dz_2 $$\n对于一个二维问题（无限长条带），更方便的做法是处理两个宽度分别为 $dx_1$ 和 $dx_2$ 且在 $z$ 方向无限延伸的微分条带之间的角系数。设其为 $dF_{dL_1 \\to dL_2}$。从位于 $x_1$ 的无限长微分条带 $dL_1$ 到有限宽度条带 $S_2$ 的角系数 $F_{dL_1 \\to S_2}$ 通过对 $S_2$ 的宽度和无限长度 $z_2$ 积分得到。\n$$ F_{dL_1 \\to S_2} = \\int_{x_C}^{x_D} \\left( \\int_{-\\infty}^{\\infty} \\frac{H^2}{\\pi [ (x_2-x_1)^2 + H^2 + (z_2-z_1)^2 ]^2} dz_2 \\right) dx_2 $$\n令 $s = z_2 - z_1$ 且 $R^2 = (x_2 - x_1)^2 + H^2$。内部积分变为：\n$$ \\int_{-\\infty}^{\\infty} \\frac{H^2}{\\pi (R^2 + s^2)^2} ds = \\frac{H^2}{\\pi} \\left[ \\frac{s}{2R^2(R^2+s^2)} + \\frac{1}{2R^3}\\arctan\\left(\\frac{s}{R}\\right) \\right]_{-\\infty}^{\\infty} = \\frac{H^2}{\\pi} \\frac{\\pi}{2R^3} = \\frac{H^2}{2R^3} $$\n将其代回，我们得到：\n$$ F_{dL_1 \\to S_2} = \\int_{x_C}^{x_D} \\frac{H^2}{2((x_2-x_1)^2 + H^2)^{3/2}} dx_2 $$\n$\\frac{c^2}{(u^2+c^2)^{3/2}}$ 对 $u$ 的积分是 $\\frac{u}{\\sqrt{u^2+c^2}}$。这里，$u = x_2 - x_1$ 且 $c=H$。所以 $du = dx_2$。\n$$ F_{dL_1 \\to S_2} = \\frac{1}{2} \\left[ \\frac{x_2 - x_1}{\\sqrt{(x_2-x_1)^2 + H^2}} \\right]_{x_2=x_C}^{x_D} $$\n$$ F_{dL_1 \\to S_2} = \\frac{1}{2} \\left( \\frac{x_D-x_1}{\\sqrt{(x_D-x_1)^2 + H^2}} - \\frac{x_C-x_1}{\\sqrt{(x_C-x_1)^2 + H^2}} \\right) $$\n为了求得总角系数 $F_{12}$，我们必须将 $F_{dL_1 \\to S_2}$ 在表面 $S_1$ 的宽度上取平均值：\n$$ F_{12} = \\frac{1}{A_1} \\int_{A_1} F_{dL_1 \\to S_2} dA_1 = \\frac{1}{x_B - x_A} \\int_{x_A}^{x_B} F_{dL_1 \\to S_2} dx_1 $$\n该积分为：\n$$ \\int_{x_A}^{x_B} \\frac{1}{2} \\left( \\frac{x_D-x_1}{\\sqrt{(x_D-x_1)^2 + H^2}} - \\frac{x_C-x_1}{\\sqrt{(x_C-x_1)^2 + H^2}} \\right) dx_1 $$\n我们分别计算这两项。对于第一项，令 $u = x_D-x_1$，则 $du = -dx_1$。\n$$ \\int_{x_D-x_A}^{x_D-x_B} \\frac{u}{\\sqrt{u^2+H^2}}(-du) = \\left[ \\sqrt{u^2+H^2} \\right]_{x_D-x_B}^{x_D-x_A} = \\sqrt{(x_D-x_A)^2+H^2} - \\sqrt{(x_D-x_B)^2+H^2} $$\n设端点为 $A=(x_A,0)$, $B=(x_B,0)$, $C=(x_C,H)$, 和 $D=(x_D,H)$。这些项是欧几里得距离：$L_{AD} = \\sqrt{(x_D-x_A)^2+H^2}$ 和 $L_{BD} = \\sqrt{(x_D-x_B)^2+H^2}$。第一项的积分是 $L_{AD} - L_{BD}$。\n类似地，第二项的积分得到 $L_{AC} - L_{BC}$。\n总积分为 $(L_{AD} - L_{BD}) - (L_{AC} - L_{BC}) = (L_{AD} + L_{BC}) - (L_{AC} + L_{BD})$。\n将其代回 $F_{12}$ 的表达式：\n$$ F_{12} = \\frac{(L_{AD} + L_{BC}) - (L_{AC} + L_{BD})}{2(x_B - x_A)} $$\n这就是交叉线法公式。分子表示连接条带端点的交叉弦长度之和减去非交叉弦长度之和。分母是发射表面 $S_1$ 宽度的两倍。\n\n### 第2部分：叠加性的证明 ###\n\n问题要求证明，将 $S_1$ 分区并将各子条带的面积加权角系数求和，其结果与总角系数保持不变。\n设 $S_1$ 被划分为 $N$ 个连续的子条带 $\\{S_{1k}\\}_{k=1}^N$。第 $k$ 个子条带 $S_{1k}$ 从 $x=x_{p,k-1}$ 延伸到 $x=x_{p,k}$，其中分区点为 $\\{x_{p,0}, x_{p,1}, \\ldots, x_{p,N}\\}$，且 $x_{p,0} = x_A$，$x_{p,N} = x_B$。\n子条带 $S_{1k}$ 的宽度（单位长度的面积）为 $W_{1k} = x_{p,k} - x_{p,k-1}$。\n$S_1$ 的总宽度为 $W_1 = x_B - x_A = \\sum_{k=1}^N W_{1k}$。\n叠加性法则指出：\n$$ F_{12} = \\sum_{k=1}^N \\frac{W_{1k}}{W_1} F_{(1k)2} $$\n我们必须使用推导出的角系数公式来证明这个恒等式。设 $S_{1k}$ 的端点为 $P_{k-1}=(x_{p,k-1}, 0)$ 和 $P_k=(x_{p,k}, 0)$。$S_2$ 的端点保持为 $C=(x_C, H)$ 和 $D=(x_D, H)$。\n从 $S_{1k}$ 到 $S_2$ 的角系数为：\n$$ F_{(1k)2} = \\frac{(L_{P_{k-1}D} + L_{P_kC}) - (L_{P_{k-1}C} + L_{P_kD})}{2 W_{1k}} $$\n现在，我们构建面积加权和：\n$$ \\sum_{k=1}^N \\frac{W_{1k}}{W_1} F_{(1k)2} = \\sum_{k=1}^N \\frac{W_{1k}}{W_1} \\left[ \\frac{(L_{P_{k-1}D} + L_{P_kC}) - (L_{P_{k-1}C} + L_{P_kD})}{2 W_{1k}} \\right] $$\n宽度项 $W_{1k}$ 消去：\n$$ = \\frac{1}{2W_1} \\sum_{k=1}^N \\left[ (L_{P_{k-1}D} + L_{P_kC}) - (L_{P_{k-1}C} + L_{P_kD}) \\right] $$\n这是一个伸缩求和。让我们展开并重组求和中的各项：\n$$ \\sum_{k=1}^N (\\dots) = \\sum_{k=1}^N (L_{P_{k-1}D} - L_{P_kD}) + \\sum_{k=1}^N (L_{P_kC} - L_{P_{k-1}C}) $$\n第一个求和是伸缩的：\n$$ \\sum_{k=1}^N (L_{P_{k-1}D} - L_{P_kD}) = (L_{P_0D} - L_{P_1D}) + (L_{P_1D} - L_{P_2D}) + \\dots + (L_{P_{N-1}D} - L_{P_ND}) = L_{P_0D} - L_{P_ND} $$\n第二个求和也是伸缩的：\n$$ \\sum_{k=1}^N (L_{P_kC} - L_{P_{k-1}C}) = (L_{P_1C} - L_{P_0C}) + (L_{P_2C} - L_{P_1C}) + \\dots + (L_{P_NC} - L_{P_{N-1}C}) = L_{P_NC} - L_{P_0C} $$\n合并这些结果，总和为 $(L_{P_0D} - L_{P_ND}) + (L_{P_NC} - L_{P_0C})$。\n根据分区的定义，$P_0 = A = (x_A, 0)$ 且 $P_N = B = (x_B, 0)$。\n所以，总和变为 $(L_{AD} - L_{BD}) + (L_{BC} - L_{AC})$。\n重新整理各项，得到 $(L_{AD} + L_{BC}) - (L_{AC} + L_{BD})$。\n将此结果代回加权和的表达式中：\n$$ \\sum_{k=1}^N \\frac{W_{1k}}{W_1} F_{(1k)2} = \\frac{(L_{AD} + L_{BC}) - (L_{AC} + L_{BD})}{2W_1} = \\frac{(L_{AD} + L_{BC}) - (L_{AC} + L_{BD})}{2(x_B - x_A)} $$\n这正是整个条带 $S_1$ 的角系数 $F_{12}$ 的表达式。因此，对于交叉线法公式，叠加性在解析上成立。数值实现应得到零的差异，或者由于浮点运算而产生一个机器精度量级的值。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_view_factor(x1_start: float, x1_end: float, x2_start: float, x2_end: float, h: float) -> float:\n    \"\"\"\n    Computes the view factor F_12 between two infinitely long parallel strips.\n\n    Args:\n        x1_start: Starting x-coordinate of strip 1.\n        x1_end: Ending x-coordinate of strip 1.\n        x2_start: Starting x-coordinate of strip 2.\n        x2_end: Ending x-coordinate of strip 2.\n        h: Perpendicular distance between the strips.\n\n    Returns:\n        The view factor F_12.\n    \"\"\"\n    w1 = x1_end - x1_start\n    if abs(w1) < 1e-12:\n        return 0.0\n\n    # Endpoints of the strips: A, B for strip 1; C, D for strip 2.\n    # A = (x1_start, 0), B = (x1_end, 0)\n    # C = (x2_start, h),  D = (x2_end, h)\n\n    # Uncrossed strings\n    l_ac = np.sqrt((x2_start - x1_start)**2 + h**2)\n    l_bd = np.sqrt((x2_end - x1_end)**2 + h**2)\n\n    # Crossed strings\n    l_ad = np.sqrt((x2_end - x1_start)**2 + h**2)\n    l_bc = np.sqrt((x2_start - x1_end)**2 + h**2)\n\n    f12 = (l_ad + l_bc - l_ac - l_bd) / (2 * w1)\n    \n    return f12\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test cases, computes the absolute difference between\n    the full-strip view factor and the area-weighted sum of sub-strip view factors,\n    and prints the results.\n    \"\"\"\n    test_cases = [\n        {\n            \"geometry\": {\"xA\": -0.40, \"xB\": 1.10, \"xC\": -0.20, \"xD\": 0.70, \"H\": 0.65},\n            \"partitions\": [-0.40, -0.10, 0.30, 0.50, 0.80, 1.10],\n        },\n        {\n            \"geometry\": {\"xA\": -1.20, \"xB\": -0.20, \"xC\": 0.30, \"xD\": 1.00, \"H\": 0.90},\n            \"partitions\": [-1.20, -1.05, -0.80, -0.60, -0.35, -0.20],\n        },\n        {\n            \"geometry\": {\"xA\": 0.00, \"xB\": 0.70, \"xC\": -0.60, \"xD\": 0.10, \"H\": 0.20},\n            \"partitions\": [0.00, 0.10, 0.20, 0.30, 0.40, 0.50, 0.60, 0.70],\n        },\n        {\n            \"geometry\": {\"xA\": -0.05, \"xB\": 0.05, \"xC\": -0.30, \"xD\": 0.60, \"H\": 0.50},\n            \"partitions\": [-0.05, -0.01, 0.02, 0.05],\n        },\n        {\n            \"geometry\": {\"xA\": -0.30, \"xB\": 0.90, \"xC\": -0.80, \"xD\": 1.20, \"H\": 5.00},\n            \"partitions\": [-0.30, 0.00, 0.30, 0.60, 0.90],\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        geom = case[\"geometry\"]\n        partitions = case[\"partitions\"]\n        \n        xA, xB, xC, xD, H = geom[\"xA\"], geom[\"xB\"], geom[\"xC\"], geom[\"xD\"], geom[\"H\"]\n        \n        # 1. Compute F_12 for the full strip\n        f12_full = calculate_view_factor(xA, xB, xC, xD, H)\n        \n        # 2. Compute the area-weighted sum of sub-strip view factors\n        partitioned_sum = 0.0\n        total_width = xB - xA\n        \n        for k in range(1, len(partitions)):\n            x_start_k = partitions[k-1]\n            x_end_k = partitions[k]\n            \n            # Compute view factor for the sub-strip\n            f_k2 = calculate_view_factor(x_start_k, x_end_k, xC, xD, H)\n            \n            # Calculate area weight and add to sum\n            sub_strip_width = x_end_k - x_start_k\n            weight = sub_strip_width / total_width\n            partitioned_sum += weight * f_k2\n            \n        # 3. Report the absolute difference\n        abs_diff = abs(f12_full - partitioned_sum)\n        results.append(abs_diff)\n        \n    # Format the final output string as [d1,d2,d3,d4,d5]\n    # The analytical proof shows the difference is 0. Numerical error will be very small.\n    # The formatting to a high precision float is to show the scale of this error.\n    # For a visually cleaner but less precise representation, one could use e.g. '{:e}'.\n    # To strictly match float, we will use the default string representation of floats.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}