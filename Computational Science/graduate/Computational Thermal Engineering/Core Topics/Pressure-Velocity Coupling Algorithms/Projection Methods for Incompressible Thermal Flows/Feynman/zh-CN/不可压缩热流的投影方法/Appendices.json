{
    "hands_on_practices": [
        {
            "introduction": "将不可压缩热流动的控制方程从连续形式转化为可计算的离散形式，是计算流体动力学中的关键一步。本练习将指导您使用有限体积法，为投影法中的核心部分——压力泊松方程——构建离散线性系统。通过推导压力方程的系数，您将深入理解求解器如何从局部质量守恒（即无散场约束）中建立起全局的压力场。",
            "id": "3980165",
            "problem": "考虑一个二维不可压缩的热驱动流，该流动处于 Boussinesq 近似下，其中由温度引起的密度变化很小，并且仅在动量方程中影响浮力项。该流动使用有限体积法 (FVM) 在均匀、正交的笛卡尔网格上进行离散，其中压力位于单元中心，速度位于单元面中心。设一个通用的内部控制体积由单元 $P$ 表示，其体积为 $V_{P}$，东、西面的面积为 $S_{e} = \\Delta y$ 和 $S_{w} = \\Delta y$，北、南面的面积为 $S_{n} = \\Delta x$ 和 $S_{s} = \\Delta x$，中心间距为 $d_{pe} = \\Delta x$，$d_{pw} = \\Delta x$，$d_{pn} = \\Delta y$ 和 $d_{ps} = \\Delta y$。假设密度 $\\rho$ 为常数，时间步长为 $\\Delta t$。\n\n从计算流体动力学 (CFD) 中的不可压缩连续性方程和投影法框架出发，构建控制体积的基于通量的离散散度算子，其形式为通过各表面法向质量通量的净和除以体积；并构建基于通量的离散梯度算子，其形式为压力的两点面法向差分除以中心间距。利用这些算子，推导用于压力增量的全离散压力系统，该系统强制每个单元在新时间步的各表面上净质量通量为零。假设中间速度场 $\\boldsymbol{u}^{\\ast}$ 已通过不含压力梯度的动量和能量更新步骤得到。\n\n对于上述均匀网格，确定内部单元 $P$ 处压力所形成的线性系统的对角系数 $A_{P}$。该线性系统以标准的类扩散模板形式书写，其中对角线系数为正，最近邻的非对角线系数为负。以 $\\Delta x$ 和 $\\Delta y$ 的闭合形式表达式报告无量纲量 $A_{P}/\\Delta t$。不要代入任何数值。将最终答案表示为单个解析表达式。",
            "solution": "用户要求推导由不可压缩流的投影法产生的离散压力方程的对角系数。该问题定义明确，科学上合理，并包含了在二维均匀笛卡尔网格上对内部控制体积进行分析所需的所有信息。\n\n求解过程始于投影法的核心原理。该方法通过首先计算一个不满足不可压缩约束的中间速度场 $\\boldsymbol{u}^{\\ast}$，然后将其投影到一个无散空间上，以求得新时间步的速度场 $\\boldsymbol{u}^{n+1}$，从而将速度场和压力场解耦。\n\n投影法中的速度更新步骤通过一个类压力变量的梯度，将最终速度 $\\boldsymbol{u}^{n+1}$ 与中间速度 $\\boldsymbol{u}^{\\ast}$ 联系起来。根据问题中提到的“压力增量”，我们将此变量表示为 $P'$。更新方程为：\n$$\n\\boldsymbol{u}^{n+1} = \\boldsymbol{u}^{\\ast} - \\frac{\\Delta t}{\\rho} \\nabla P'\n$$\n这里，$\\Delta t$ 是时间步长，$\\rho$ 是恒定密度。中间速度 $\\boldsymbol{u}^{\\ast}$ 假定已通过求解不含压力梯度项的动量方程得到。\n\n不可压缩流的基本约束是速度场必须始终无散。对于新的时间步，这表示为：\n$$\n\\nabla \\cdot \\boldsymbol{u}^{n+1} = 0\n$$\n将速度更新方程代入不可压缩约束，得到连续的压力修正方程：\n$$\n\\nabla \\cdot \\left(\\boldsymbol{u}^{\\ast} - \\frac{\\Delta t}{\\rho} \\nabla P'\\right) = 0\n$$\n假设 $\\rho$ 和 $\\Delta t$ 为常数，并重新整理各项，我们得到关于压力修正 $P'$ 的泊松方程：\n$$\n\\nabla^2 P' = \\frac{\\rho}{\\Delta t} \\nabla \\cdot \\boldsymbol{u}^{\\ast}\n$$\n\n现在，我们使用有限体积法 (FVM) 在指定的控制体积 $P$ 上离散化此关系。在控制体积 $V_P$ 上，不可压缩约束 $\\nabla \\cdot \\boldsymbol{u}^{n+1} = 0$ 的积分形式为：\n$$\n\\int_{V_P} \\nabla \\cdot \\boldsymbol{u}^{n+1} \\, dV = 0\n$$\n应用散度定理，这变成一个关于穿过控制体积表面的净质量通量为零的陈述：\n$$\n\\sum_{f} (\\rho \\boldsymbol{u}^{n+1} \\cdot \\boldsymbol{n} S)_f = 0\n$$\n其中，求和遍历控制体积的各个面（东 $e$、西 $w$、北 $n$、南 $s$），$\\boldsymbol{n}$ 是指向面外的单位法向量，$S_f$ 是面的面积。对于二维笛卡尔网格，这展开为：\n$$\n(\\rho u S)_e - (\\rho u S)_w + (\\rho v S)_n - (\\rho v S)_s = 0\n$$\n速度 $u$ 和 $v$ 是在面中心计算的垂直于面的分量。在时间步 $n+1$ 时，每个面上的速度是通过离散化速度更新方程得到的。问题为离散梯度算子指定了“两点面法向差分”。将其应用于面中心速度，可得：\n$$\nu_e^{n+1} = u_e^{\\ast} - \\frac{\\Delta t}{\\rho} \\frac{P'_E - P'_P}{d_{pe}}\n$$\n$$\nu_w^{n+1} = u_w^{\\ast} - \\frac{\\Delta t}{\\rho} \\frac{P'_P - P'_W}{d_{pw}}\n$$\n$$\nv_n^{n+1} = v_n^{\\ast} - \\frac{\\Delta t}{\\rho} \\frac{P'_N - P'_P}{d_{pn}}\n$$\n$$\nv_s^{n+1} = v_s^{\\ast} - \\frac{\\Delta t}{\\rho} \\frac{P'_P - P'_S}{d_{ps}}\n$$\n这里，$P'_P, P'_E, P'_W, P'_N, P'_S$ 分别是单元 $P$ 及其东、西、北、南相邻单元中心的压力修正值。$d_{pe}$ 等项是单元中心之间的距离。\n\n我们将这些离散的速度表达式代入离散化的连续性方程。我们来分析每个面的质量通量项：\n通过东面的质量流率为 $\\dot{m}_e^{n+1} = (\\rho u S)_e^{n+1}$：\n$$\n\\dot{m}_e^{n+1} = \\rho S_e \\left(u_e^{\\ast} - \\frac{\\Delta t}{\\rho} \\frac{P'_E - P'_P}{d_{pe}}\\right) = (\\rho u^{\\ast} S)_e - \\frac{S_e \\Delta t}{d_{pe}}(P'_E - P'_P)\n$$\n类似地，对于其他面：\n$$\n\\dot{m}_w^{n+1} = \\rho S_w \\left(u_w^{\\ast} - \\frac{\\Delta t}{\\rho} \\frac{P'_P - P'_W}{d_{pw}}\\right) = (\\rho u^{\\ast} S)_w - \\frac{S_w \\Delta t}{d_{pw}}(P'_P - P'_W)\n$$\n$$\n\\dot{m}_n^{n+1} = \\rho S_n \\left(v_n^{\\ast} - \\frac{\\Delta t}{\\rho} \\frac{P'_N - P'_P}{d_{pn}}\\right) = (\\rho v^{\\ast} S)_n - \\frac{S_n \\Delta t}{d_{pn}}(P'_N - P'_P)\n$$\n$$\n\\dot{m}_s^{n+1} = \\rho S_s \\left(v_s^{\\ast} - \\frac{\\Delta t}{\\rho} \\frac{P'_P - P'_S}{d_{ps}}\\right) = (\\rho v^{\\ast} S)_s - \\frac{S_s \\Delta t}{d_{ps}}(P'_P - P'_S)\n$$\n离散连续性方程为 $\\dot{m}_e^{n+1} - \\dot{m}_w^{n+1} + \\dot{m}_n^{n+1} - \\dot{m}_s^{n+1} = 0$。代入质量流率的表达式，并将与压力修正 $P'$ 相关的项组合到一边，我们得到：\n$$\n\\frac{S_e \\Delta t}{d_{pe}}(P'_P - P'_E) + \\frac{S_w \\Delta t}{d_{pw}}(P'_P - P'_W) + \\frac{S_n \\Delta t}{d_{pn}}(P'_P - P'_N) + \\frac{S_s \\Delta t}{d_{ps}}(P'_P - P'_S) = (\\dot{m}^{\\ast}_e - \\dot{m}^{\\ast}_w + \\dot{m}^{\\ast}_n - \\dot{m}^{\\ast}_s)\n$$\n右边是源项，表示由中间速度场产生的净质量不平衡。我们重新整理左边，以分离出包含 $P'_P$ 的项：\n$$\n\\left( \\frac{S_e \\Delta t}{d_{pe}} + \\frac{S_w \\Delta t}{d_{pw}} + \\frac{S_n \\Delta t}{d_{pn}} + \\frac{S_s \\Delta t}{d_{ps}} \\right) P'_P - \\frac{S_e \\Delta t}{d_{pe}} P'_E - \\frac{S_w \\Delta t}{d_{pw}} P'_W - \\frac{S_n \\Delta t}{d_{pn}} P'_N - \\frac{S_s \\Delta t}{d_{ps}} P'_S = \\text{源项}\n$$\n该方程是标准的线性系统形式 $A_P P'_P = \\sum_{nb} A_{nb} P'_{nb} + b$，可以写成 $A_P P'_P - \\sum_{nb \\in \\{E,W,N,S\\}} A_{nb} P'_{nb} = b$。对角系数 $A_P$ 是 $P'_P$ 的系数。通过观察，我们确定它为：\n$$\nA_P = \\frac{S_e \\Delta t}{d_{pe}} + \\frac{S_w \\Delta t}{d_{pw}} + \\frac{S_n \\Delta t}{d_{pn}} + \\frac{S_s \\Delta t}{d_{ps}}\n$$\n注意，在此公式中，$A_{nb}$ (例如，$A_E = \\frac{S_e \\Delta t}{d_{pe}}$) 是相邻节点的系数，而对角系数是这些相邻系数之和：$A_P = A_E + A_W + A_N + A_S$。\n\n现在，我们代入问题陈述中给出的均匀笛卡尔网格的几何参数：\n- 表面积：$S_e = S_w = \\Delta y$ 和 $S_n = S_s = \\Delta x$。\n- 中心间距：$d_{pe} = d_{pw} = \\Delta x$ 和 $d_{pn} = d_{ps} = \\Delta y$。\n\n将这些参数代入 $A_P$ 的表达式中：\n$$\nA_P = \\frac{\\Delta y \\cdot \\Delta t}{\\Delta x} + \\frac{\\Delta y \\cdot \\Delta t}{\\Delta x} + \\frac{\\Delta x \\cdot \\Delta t}{\\Delta y} + \\frac{\\Delta x \\cdot \\Delta t}{\\Delta y}\n$$\n$$\nA_P = 2 \\frac{\\Delta y \\Delta t}{\\Delta x} + 2 \\frac{\\Delta x \\Delta t}{\\Delta y}\n$$\n这可以因式分解为：\n$$\nA_P = 2 \\Delta t \\left( \\frac{\\Delta y}{\\Delta x} + \\frac{\\Delta x}{\\Delta y} \\right)\n$$\n问题要求的是无量纲量 $A_P / \\Delta t$。将我们得到的 $A_P$ 表达式除以 $\\Delta t$：\n$$\n\\frac{A_P}{\\Delta t} = \\frac{2 \\Delta t}{\\Delta t} \\left( \\frac{\\Delta y}{\\Delta x} + \\frac{\\Delta x}{\\Delta y} \\right)\n$$\n$$\n\\frac{A_P}{\\Delta t} = 2 \\left( \\frac{\\Delta y}{\\Delta x} + \\frac{\\Delta x}{\\Delta y} \\right)\n$$\n这就是所求无量纲量的最终解析表达式。",
            "answer": "$$\n\\boxed{2 \\left( \\frac{\\Delta y}{\\Delta x} + \\frac{\\Delta x}{\\Delta y} \\right)}\n$$"
        },
        {
            "introduction": "构建了压力系统之后，一个自然的问题是：投影法在离散层面上究竟是如何实现其目标的？本练习通过一个具体的数值案例，清晰地展示了投影步骤的核心作用。您将计算一个给定的、含有微小散度的中间速度场，并通过量化指标来验证投影操作如何精确地消除这个离散散度，从而将速度场校正为满足不可压缩性约束的无散场。",
            "id": "3980214",
            "problem": "考虑一个二维不可压缩、密度恒定的流动，其热浮力由Boussinesq近似建模。该流动通过一种显式方法进行时间推进，该方法由于时间积分会产生一个带有微小散度残差的中间速度场。使用投影步来强制施加不可压缩性。计算域为 $\\Omega = [0,1]\\times[0,1]$，带有不可渗透的壁面，并使用均匀的标记网格（MAC）进行离散化（标记网格（MAC）将速度分量置于单元面，压力置于单元中心），其中包含 $N_{x}=2$ 和 $N_{y}=2$ 个内部单元，因此 $\\Delta x = \\Delta y = 0.5$。时间步长为 $\\Delta t = 0.1$。\n\n面心的中间速度分量 $\\mathbf{u}^{*} = (u^{*}, v^{*})$ 在MAC网格位置上的值如下：\n- 垂直面（对于 $u^{*}_{i+1/2,j}$）：$u^{*}_{1/2,1} = 0$, $u^{*}_{1/2,2} = 0$, $u^{*}_{3/2,1} = 0.06$, $u^{*}_{3/2,2} = -0.02$, $u^{*}_{5/2,1} = 0$, $u^{*}_{5/2,2} = 0$。\n- 水平面（对于 $v^{*}_{i,j+1/2}$）：$v^{*}_{1,1/2} = 0$, $v^{*}_{2,1/2} = 0$, $v^{*}_{1,3/2} = -0.04$, $v^{*}_{2,3/2} = 0.05$, $v^{*}_{1,5/2} = 0$, $v^{*}_{2,5/2} = 0$。\n\n不可渗透壁面意味着在所有区域边界上 $u^{*}\\cdot \\mathbf{n} = 0$，这与给定的边界表面值是一致的。\n\n从不可压缩性约束和投影方法出发，您必须：\n1. 使用与MAC网格和无穿透边界一致的散度有限体积形式，计算四个单元中每一个的 $\\mathbf{u}^{*}$ 的离散单元中心散度。\n2. 在投影前，使用此均匀网格上的中点法则计算 $\\Omega$ 上的散度的 $L^{2}$ 范数，即通过 $\\left(\\sum_{i=1}^{2}\\sum_{j=1}^{2} (\\nabla \\cdot \\mathbf{u}^{*})_{i,j}^{2}\\, \\Delta x \\Delta y\\right)^{1/2}$ 来近似 $\\|\\nabla \\cdot \\mathbf{u}^{*}\\|_{L^{2}(\\Omega)}$。\n3. 使用精确的投影步，通过求解带有与不可渗透壁面一致的边界条件的压力泊松方程来强制施加离散不可压缩性，从而确定投影后散度的 $L^{2}$ 范数。\n4. 通过定义为 $E = 1 - \\|\\nabla \\cdot \\mathbf{u}^{n+1}\\|_{L^{2}(\\Omega)} / \\|\\nabla \\cdot \\mathbf{u}^{*}\\|_{L^{2}(\\Omega)}$ 的标量度量 $E$ 来量化不可压缩性的强制程度，其中 $\\mathbf{u}^{n+1}$ 是投影后的速度。\n\n仅报告 $E$ 的最终值作为您的答案。如果在您的工作中需要任何数值近似，请保持所有中间量为精确值，并在您的推导中明确说明任何舍入要求。最终度量 $E$ 是无量纲的；不要在您的最终答案框中包含任何单位。如果 $E$ 是一个精确值，则无需对其进行舍入。",
            "solution": "控制不可压缩流的连续性方程为 $\\nabla \\cdot \\mathbf{u} = 0$。在投影方法中，我们首先从动量方程（其中可能包含Boussinesq近似下的热浮力）计算出一个中间速度 $\\mathbf{u}^{*}$，而不强制施加不可压缩性，然后将 $\\mathbf{u}^{*}$ 投影到一个无散子空间上。投影步使用离散形式的Helmholtz分解：我们寻求一个标量势 $\\phi$，使得\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{*} - \\Delta t \\nabla \\phi,\n$$\n且满足 $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$。对其求散度可得\n$$\n\\nabla \\cdot \\mathbf{u}^{n+1} = \\nabla \\cdot \\mathbf{u}^{*} - \\Delta t \\nabla^{2} \\phi = 0 \\quad \\Rightarrow \\quad \\nabla^{2}\\phi = \\frac{1}{\\Delta t}\\,\\nabla \\cdot \\mathbf{u}^{*}.\n$$\n对于不可渗透壁面（$\\mathbf{u}\\cdot \\mathbf{n} = 0$），$\\phi$ 的边界条件是齐次Neumann条件，这与强制施加 $\\mathbf{u}^{n+1}$ 的壁面法向分量相一致。\n\n我们现在在一个标记网格（MAC）上计算单元中心的离散散度。对于一个单元 $(i,j)$，其有限体积离散散度为\n$$\n(\\nabla \\cdot \\mathbf{u}^{*})_{i,j} = \\frac{u^{*}_{i+1/2,j} - u^{*}_{i-1/2,j}}{\\Delta x} + \\frac{v^{*}_{i,j+1/2} - v^{*}_{i,j-1/2}}{\\Delta y}.\n$$\n给定 $\\Delta x = \\Delta y = 0.5$，我们计算每个单元：\n\n- 单元 $(1,1)$:\n$$\n\\frac{u^{*}_{3/2,1} - u^{*}_{1/2,1}}{\\Delta x} = \\frac{0.06 - 0}{0.5} = 0.12, \\quad \\frac{v^{*}_{1,3/2} - v^{*}_{1,1/2}}{\\Delta y} = \\frac{-0.04 - 0}{0.5} = -0.08,\n$$\n所以\n$$\n(\\nabla \\cdot \\mathbf{u}^{*})_{1,1} = 0.12 - 0.08 = 0.04.\n$$\n\n- 单元 $(2,1)$:\n$$\n\\frac{u^{*}_{5/2,1} - u^{*}_{3/2,1}}{\\Delta x} = \\frac{0 - 0.06}{0.5} = -0.12, \\quad \\frac{v^{*}_{2,3/2} - v^{*}_{2,1/2}}{\\Delta y} = \\frac{0.05 - 0}{0.5} = 0.10,\n$$\n所以\n$$\n(\\nabla \\cdot \\mathbf{u}^{*})_{2,1} = -0.12 + 0.10 = -0.02.\n$$\n\n- 单元 $(1,2)$:\n$$\n\\frac{u^{*}_{3/2,2} - u^{*}_{1/2,2}}{\\Delta x} = \\frac{-0.02 - 0}{0.5} = -0.04, \\quad \\frac{v^{*}_{1,5/2} - v^{*}_{1,3/2}}{\\Delta y} = \\frac{0 - (-0.04)}{0.5} = 0.08,\n$$\n所以\n$$\n(\\nabla \\cdot \\mathbf{u}^{*})_{1,2} = -0.04 + 0.08 = 0.04.\n$$\n\n- 单元 $(2,2)$:\n$$\n\\frac{u^{*}_{5/2,2} - u^{*}_{3/2,2}}{\\Delta x} = \\frac{0 - (-0.02)}{0.5} = 0.04, \\quad \\frac{v^{*}_{2,5/2} - v^{*}_{2,3/2}}{\\Delta y} = \\frac{0 - 0.05}{0.5} = -0.10,\n$$\n所以\n$$\n(\\nabla \\cdot \\mathbf{u}^{*})_{2,2} = 0.04 - 0.10 = -0.06.\n$$\n\n因此，四个单元中心的散度值分别为 $0.04$、$-0.02$、$0.04$ 和 $-0.06$。\n\n我们使用中点法则来近似 $\\Omega$ 上的 $L^{2}$ 范数：\n$$\n\\|\\nabla \\cdot \\mathbf{u}^{*}\\|_{L^{2}(\\Omega)} \\approx \\left(\\sum_{i=1}^{2}\\sum_{j=1}^{2} \\left[(\\nabla \\cdot \\mathbf{u}^{*})_{i,j}\\right]^{2} \\,\\Delta x \\Delta y\\right)^{1/2}.\n$$\n计算平方和：\n$$\n0.04^{2} + (-0.02)^{2} + 0.04^{2} + (-0.06)^{2} = 0.0016 + 0.0004 + 0.0016 + 0.0036 = 0.0072.\n$$\n乘以单元面积 $\\Delta x \\Delta y = 0.25$：\n$$\n0.0072 \\times 0.25 = 0.0018.\n$$\n因此，\n$$\n\\|\\nabla \\cdot \\mathbf{u}^{*}\\|_{L^{2}(\\Omega)} \\approx \\sqrt{0.0018} = 10^{-2}\\sqrt{18}.\n$$\n\n接下来，考虑精确的投影步。求解\n$$\n\\nabla^{2} \\phi = \\frac{1}{\\Delta t}\\,\\nabla \\cdot \\mathbf{u}^{*}\n$$\n并使用与不可渗透壁面一致的边界条件，以及设置\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{*} - \\Delta t \\nabla \\phi,\n$$\n通过构造可以确保，\n$$\n\\nabla \\cdot \\mathbf{u}^{n+1} = \\nabla \\cdot \\mathbf{u}^{*} - \\Delta t \\nabla^{2} \\phi = \\nabla \\cdot \\mathbf{u}^{*} - \\Delta t \\left(\\frac{1}{\\Delta t}\\,\\nabla \\cdot \\mathbf{u}^{*}\\right) = 0\n$$\n在离散的单元中心处成立。因此，\n$$\n\\|\\nabla \\cdot \\mathbf{u}^{n+1}\\|_{L^{2}(\\Omega)} = 0.\n$$\n\n定义强制度量\n$$\nE = 1 - \\frac{\\|\\nabla \\cdot \\mathbf{u}^{n+1}\\|_{L^{2}(\\Omega)}}{\\|\\nabla \\cdot \\mathbf{u}^{*}\\|_{L^{2}(\\Omega)}} = 1 - \\frac{0}{10^{-2}\\sqrt{18}} = 1.\n$$\n这个 $E$ 是无量纲的，并且由于它是精确值，因此不需要舍入。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "在理解了投影法的核心机制后，我们便可以将所有部件组装起来，形成一个完整的时间推进算法。本练习将引导您为复杂的浮力驱动热流问题设计算子分裂方案，并探讨不同处理方式（如显式与隐式扩散）对算法稳定性的影响。通过分析和计算最大允许时间步长，您将把算法的理论结构与仿真实践中的关键约束——数值稳定性——紧密联系起来。",
            "id": "3980208",
            "problem": "考虑一个在均匀周期性域上，由二维 Boussinesq 近似控制的不可压缩浮力驱动热流。基本控制方程为不可压缩 Navier–Stokes 动量方程、连续性方程和温度平流-扩散方程。具体而言，对于恒定的参考密度 $ \\rho_0 $、运动粘度 $ \\nu $、热扩散率 $ \\alpha $、作用于 $y$ 轴负方向的重力加速度 $ g $ 和热膨胀系数 $ \\beta $，方程组如下：\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} + (\\mathbf{u} \\cdot \\nabla)\\mathbf{u} = -\\frac{1}{\\rho_0} \\nabla p + \\nu \\nabla^2 \\mathbf{u} + g \\beta \\bigl(T - T_{\\mathrm{ref}}\\bigr)\\,\\mathbf{e}_y + \\mathbf{f},\n$$\n$$\n\\nabla \\cdot \\mathbf{u} = 0,\n$$\n$$\n\\frac{\\partial T}{\\partial t} + (\\mathbf{u} \\cdot \\nabla) T = \\alpha \\nabla^2 T + q,\n$$\n其中 $ \\mathbf{u} = (u,v) $ 是速度场，$ p $ 是压力，$ T $ 是温度，$ T_{\\mathrm{ref}} $ 是参考温度，$ \\mathbf{e}_y $ 是 $y$ 方向的单位向量，$ \\mathbf{f} $ 是给定的单位质量体力，$ q $ 是给定的体积加热率。不可压缩性约束 $ \\nabla \\cdot \\mathbf{u} = 0 $ 必须始终成立。\n\n从时间层 $ n $ 的 $ \\mathbf{u}^n $、$ T^n $ 和已知的 $ \\mathbf{f}^n $ 出发，使用压力投影法，构建将解推进到时间层 $ n+1 $ 的完整算子分裂步骤。需要考虑两种算子顺序：\n\n- 格式 $ \\mathsf{S}_{\\mathrm{EX}} $：动量和温度方程中的扩散项均为全显式。\n- 格式 $ \\mathsf{S}_{\\mathrm{SI}} $：动量和温度方程中的扩散项均为半隐式（扩散项隐式处理，平流项和源项显式处理）。\n\n您必须明确说明子步骤（对流、扩散、体力添加、压力投影、温度更新）的顺序，并解释顺序和隐式性如何影响线性稳定性。对于速度更新，浮力项 $ g \\beta \\bigl(T - T_{\\mathrm{ref}}\\bigr)\\,\\mathbf{e}_y $ 进行显式处理。对于温度更新，平流项使用基于已知速度 $ \\mathbf{u}^n $ 的有界估计来确定稳定性约束。\n\n使用以下基本依据来推导您的算法和稳定性条件：\n- 质量守恒 $ \\nabla \\cdot \\mathbf{u} = 0 $。\n- 如上所述的动量和能量守恒。\n- 在均匀网格上，平流项采用一阶迎风格式，扩散项采用二阶中心差分格式的相容半离散有限体积或有限差分离散。\n- 源于投影法的压力泊松方程 (PPE)：$ \\nabla^2 \\phi = \\frac{\\rho_0}{\\Delta t}\\nabla \\cdot \\mathbf{u}^\\star $，其中 $ \\mathbf{u}^\\star $ 是中间速度，$ \\phi $ 是压力增量势。\n- 二维网格上显式迎风平流的 Courant–Friedrichs–Lewy (CFL) 约束：一个充分界为 $ \\Delta t \\le \\mathcal{C}\\left(\\frac{|u|}{\\Delta x} + \\frac{|v|}{\\Delta y}\\right)^{-1} $，其中 Courant 数 $ \\mathcal{C} $ 满足 $ 0   \\mathcal{C} \\le 1 $。\n- 显式扩散的前向欧拉稳定性，其中离散拉普拉斯算子的谱半径为 $ \\lambda_{\\max} $：对于动量扩散，$ \\Delta t \\le \\frac{2}{\\nu \\lambda_{\\max}} $；对于热扩散，$ \\Delta t \\le \\frac{2}{\\alpha \\lambda_{\\max}} $。\n\n假设一个大小为 $ L_x \\times L_y $ 的矩形周期性域，用 $ N_x \\times N_y $ 个均匀单元进行离散化，网格间距为 $ \\Delta x = \\frac{L_x}{N_x} $ 和 $ \\Delta y = \\frac{L_y}{N_y} $。对于此网格上的二阶中心差分拉普拉斯算子，使用以下界：\n$$\n\\lambda_{\\max} = \\frac{4}{\\Delta x^2} + \\frac{4}{\\Delta y^2}.\n$$\n\n您的任务是实现一个程序，对于所提供测试套件中的每个测试用例，根据推导出的线性稳定性约束，计算格式 $ \\mathsf{S}_{\\mathrm{EX}} $ 和 $ \\mathsf{S}_{\\mathrm{SI}} $ 的最大允许时间步长 $ \\Delta t_{\\max} $（以秒为单位）：\n- 对于 $ \\mathsf{S}_{\\mathrm{EX}} $，$ \\Delta t_{\\max} $ 是速度和温度的平流约束以及动量和温度中的显式扩散约束的最小值。\n- 对于 $ \\mathsf{S}_{\\mathrm{SI}} $，$ \\Delta t_{\\max} $ 仅为平流约束的最小值，因为扩散项是隐式处理的，不施加前向欧拉时间步长限制；压力投影步骤也不施加时间步长限制。\n\n使用基于 $ \\mathbf{u}^n $ 的最大速度估计 $ (|u|_{\\max}, |v|_{\\max}) $ 和 CFL 数 $ \\mathcal{C} = 0.5 $ 的平流约束界。如果 $ |u|_{\\max} = 0 $ 且 $ |v|_{\\max} = 0 $，则平流约束是无界的，在计算最小值时应视为 $ +\\infty $。\n\n物理单位：将计算出的 $ \\Delta t_{\\max} $ 以秒为单位，作为浮点数报告。\n\n测试套件：\n- 案例 1（理想情况）：$ L_x = 0.1 $ m, $ L_y = 0.1 $ m, $ N_x = 64 $, $ N_y = 64 $, $ |u|_{\\max} = 0.02 $ m/s, $ |v|_{\\max} = 0.01 $ m/s, $ \\nu = 1.0 \\times 10^{-6} $ m$^2$/s, $ \\alpha = 1.4 \\times 10^{-7} $ m$^2$/s。\n- 案例 2（扩散主导边缘情况）：$ L_x = 0.1 $ m, $ L_y = 0.1 $ m, $ N_x = 64 $, $ N_y = 64 $, $ |u|_{\\max} = 0.01 $ m/s, $ |v|_{\\max} = 0.01 $ m/s, $ \\nu = 1.0 \\times 10^{-3} $ m$^2$/s, $ \\alpha = 1.0 \\times 10^{-3} $ m$^2$/s。\n- 案例 3（零平流边界情况）：$ L_x = 0.2 $ m, $ L_y = 0.2 $ m, $ N_x = 32 $, $ N_y = 32 $, $ |u|_{\\max} = 0.0 $ m/s, $ |v|_{\\max} = 0.0 $ m/s, $ \\nu = 1.0 \\times 10^{-5} $ m$^2$/s, $ \\alpha = 1.0 \\times 10^{-5} $ m$^2$/s。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表的列表，每个内部列表包含相应测试用例的两个浮点数结果（以秒为单位）$ [\\Delta t_{\\max}^{\\mathsf{S}_{\\mathrm{EX}}}, \\Delta t_{\\max}^{\\mathsf{S}_{\\mathrm{SI}}}] $。例如，$ [[a_1,b_1],[a_2,b_2],[a_3,b_3]] $，其中每个 $ a_i $ 和 $ b_i $ 都以秒为单位报告。不应打印任何额外文本。",
            "solution": "该问题是有效的，因为它基于计算流体动力学的科学原理，是适定、客观和自洽的。所述的控制方程和数值方法是模拟不可压缩热流的标准方法。该任务是著名的算子分裂格式的线性稳定性分析的直接应用。\n\n该问题要求为 Boussinesq 方程构建两种算子分裂格式，并随后基于线性稳定性理论计算每种格式的最大稳定时间步长 $\\Delta t_{\\max}$。控制方程是不可压缩 Navier-Stokes 动量方程、连续性方程和温度平流-扩散方程：\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} + (\\mathbf{u} \\cdot \\nabla)\\mathbf{u} = -\\frac{1}{\\rho_0} \\nabla p + \\nu \\nabla^2 \\mathbf{u} + g \\beta \\bigl(T - T_{\\mathrm{ref}}\\bigr)\\,\\mathbf{e}_y + \\mathbf{f} \\quad (\\text{动量})\n$$\n$$\n\\nabla \\cdot \\mathbf{u} = 0 \\quad (\\text{连续性})\n$$\n$$\n\\frac{\\partial T}{\\partial t} + (\\mathbf{u} \\cdot \\nabla) T = \\alpha \\nabla^2 T + q \\quad (\\text{温度})\n$$\n压力投影法通过首先计算一个不满足不可压缩约束的临时速度场 $\\mathbf{u}^\\star$，然后将其投影到无散度场空间，从而将解从时间 $t^n$ 推进到 $t^{n+1} = t^n + \\Delta t$。这涉及到为类压力势 $\\phi$ 求解一个泊松方程。两种格式 $\\mathsf{S}_{\\mathrm{EX}}$ 和 $\\mathsf{S}_{\\mathrm{SI}}$ 在扩散项的处理上有所不同。\n\n格式 $\\mathsf{S}_{\\mathrm{EX}}$：全显式扩散\n\n在此格式中，除压力梯度外的所有项都使用时间层 $n$ 的值进行显式处理。算子分裂序列如下：\n\n1.  **温度更新**：在一个单独的显式步骤中，将温度场从 $T^n$ 推进到 $T^{n+1}$。使用前向欧拉格式的时间离散方程为：\n    $$\n    \\frac{T^{n+1} - T^n}{\\Delta t} = -(\\mathbf{u}^n \\cdot \\nabla) T^n + \\alpha \\nabla^2 T^n + q^n\n    $$\n\n2.  **速度预测**：通过对不含压力梯度项的动量方程进行时间步进，计算出中间速度场 $\\mathbf{u}^\\star$。所有右端项，包括平流、扩散和浮力，都在时间层 $n$ 上进行显式计算：\n    $$\n    \\frac{\\mathbf{u}^\\star - \\mathbf{u}^n}{\\Delta t} = -(\\mathbf{u}^n \\cdot \\nabla)\\mathbf{u}^n + \\nu \\nabla^2 \\mathbf{u}^n + g \\beta \\bigl(T^n - T_{\\mathrm{ref}}\\bigr)\\,\\mathbf{e}_y + \\mathbf{f}^n\n    $$\n\n3.  **压力投影**：中间速度 $\\mathbf{u}^\\star$ 不保证是无散度的。通过施加一个修正来获得无散速度 $\\mathbf{u}^{n+1}$。最终速度和中间速度之间的关系是 $\\mathbf{u}^{n+1} = \\mathbf{u}^\\star - \\frac{\\Delta t}{\\rho_0} \\nabla \\phi$。应用散度算子并强制 $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$，得到关于势 $\\phi$ 的压力泊松方程 (PPE)：\n    $$\n    \\nabla^2 \\phi = \\frac{\\rho_0}{\\Delta t}\\nabla \\cdot \\mathbf{u}^\\star\n    $$\n    此椭圆方程求解后得到 $\\phi$。\n\n4.  **速度修正**：通过用势 $\\phi$ 的梯度修正 $\\mathbf{u}^\\star$，计算出时间 $n+1$ 的最终速度：\n    $$\n    \\mathbf{u}^{n+1} = \\mathbf{u}^\\star - \\frac{\\Delta t}{\\rho_0} \\nabla \\phi\n    $$\n\n$\\mathsf{S}_{\\mathrm{EX}}$ 的稳定性约束：\n对流和扩散的显式处理对时间步长 $\\Delta t$ 施加了严格的稳定性约束。\n-   **平流 (CFL) 约束**：对于一阶迎风离散，必须满足 Courant-Friedrichs-Lewy (CFL) 条件。一个充分条件是：\n    $$\n    \\Delta t_{\\mathrm{CFL}} \\le \\mathcal{C} \\left( \\frac{|u|_{\\max}}{\\Delta x} + \\frac{|v|_{\\max}}{\\Delta y} \\right)^{-1}\n    $$\n-   **动量扩散约束**：对粘性项 $\\nu \\nabla^2 \\mathbf{u}$ 的显式（前向欧拉）处理在以下条件下是稳定的：\n    $$\n    \\Delta t_{\\mathrm{diff,u}} \\le \\frac{2}{\\nu \\lambda_{\\max}}\n    $$\n-   **热扩散约束**：类似地，对热扩散项 $\\alpha \\nabla^2 T$ 的显式处理在以下条件下是稳定的：\n    $$\n    \\Delta t_{\\mathrm{diff,T}} \\le \\frac{2}{\\alpha \\lambda_{\\max}}\n    $$\n全显式格式的最大允许时间步长是这三个约束中的最小值：$\\Delta t_{\\max}^{\\mathsf{S}_{\\mathrm{EX}}} = \\min(\\Delta t_{\\mathrm{CFL}}, \\Delta t_{\\mathrm{diff,u}}, \\Delta t_{\\mathrm{diff,T}})$。\n\n格式 $\\mathsf{S}_{\\mathrm{SI}}$：半隐式扩散\n\n在此格式中，扩散项被隐式处理（例如，使用后向欧拉方法），而平流和源项保持显式。这种方法增强了稳定性。\n\n1.  **中间显式更新**：首先，通过仅应用时间层 $n$ 的显式平流项和源项来计算中间状态。\n    -   对于温度：$T^\\circ = T^n + \\Delta t \\left[ -(\\mathbf{u}^n \\cdot \\nabla) T^n + q^n \\right]$\n    -   对于速度：$\\mathbf{u}^\\circ = \\mathbf{u}^n + \\Delta t \\left[ -(\\mathbf{u}^n \\cdot \\nabla)\\mathbf{u}^n + g \\beta \\bigl(T^n - T_{\\mathrm{ref}}\\bigr)\\,\\mathbf{e}_y + \\mathbf{f}^n \\right]$\n\n2.  **隐式扩散步骤**：现在隐式地应用扩散项以产生预测场。这需要为每个场求解一个 Helmholtz 型方程。\n    -   对于温度：$\\frac{T^{n+1} - T^\\circ}{\\Delta t} = \\alpha \\nabla^2 T^{n+1} \\implies (I - \\Delta t \\alpha \\nabla^2) T^{n+1} = T^\\circ$\n    -   对于速度：$\\frac{\\mathbf{u}^\\star - \\mathbf{u}^\\circ}{\\Delta t} = \\nu \\nabla^2 \\mathbf{u}^\\star \\implies (I - \\Delta t \\nu \\nabla^2) \\mathbf{u}^\\star = \\mathbf{u}^\\circ$\n    对 $T$ 的此更新得到最终温度 $T^{n+1}$。对 $\\mathbf{u}$ 的更新得到预测速度 $\\mathbf{u}^\\star$。\n\n3.  **压力投影和速度修正**：这些步骤与 $\\mathsf{S}_{\\mathrm{EX}}$ 格式中的步骤相同，使用的是从隐式扩散步骤中获得的预测速度 $\\mathbf{u}^\\star$。\n    -   求解 PPE：$\\nabla^2 \\phi = \\frac{\\rho_0}{\\Delta t}\\nabla \\cdot \\mathbf{u}^\\star$\n    -   修正速度：$\\mathbf{u}^{n+1} = \\mathbf{u}^\\star - \\frac{\\Delta t}{\\rho_0} \\nabla \\phi$\n\n$\\mathsf{S}_{\\mathrm{SI}}$ 的稳定性约束：\n扩散项的隐式处理是无条件稳定的。因此，与扩散相关的限制性稳定性约束被移除。唯一剩下的约束来自平流项的显式处理。\n-   **平流 (CFL) 约束**：\n    $$\n    \\Delta t_{\\mathrm{CFL}} \\le \\mathcal{C} \\left( \\frac{|u|_{\\max}}{\\Delta x} + \\frac{|v|_{\\max}}{\\Delta y} \\right)^{-1}\n    $$\n半隐式格式的最大允许时间步长仅由 CFL 条件决定：$\\Delta t_{\\max}^{\\mathsf{S}_{\\mathrm{SI}}} = \\Delta t_{\\mathrm{CFL}}$。\n\n$\\Delta t_{\\max}$ 的计算：\n对于一个大小为 $L_x \\times L_y$ 的域上的 $N_x \\times N_y$ 单元的均匀网格，网格间距为 $\\Delta x = L_x / N_x$ 和 $\\Delta y = L_y / N_y$。离散拉普拉斯算子最大特征值的界由下式给出：\n$$\n\\lambda_{\\max} = \\frac{4}{\\Delta x^2} + \\frac{4}{\\Delta y^2}\n$$\n计算使用 Courant 数 $\\mathcal{C} = 0.5$。如果 $|u|_{\\max} = 0$ 且 $|v|_{\\max} = 0$，则平流约束是无界的 $(+\\infty)$。\n\n每个测试用例所需的计算如下：\n1.  计算 $\\Delta x$、$\\Delta y$ 和 $\\lambda_{\\max}$。\n2.  计算 $\\Delta t_{\\mathrm{CFL}}$，处理零速度情况。\n3.  计算 $\\Delta t_{\\mathrm{diff,u}}$ 和 $\\Delta t_{\\mathrm{diff,T}}$。\n4.  对于格式 $\\mathsf{S}_{\\mathrm{EX}}$，求 $\\Delta t_{\\max}^{\\mathsf{S}_{\\mathrm{EX}}} = \\min(\\Delta t_{\\mathrm{CFL}}, \\Delta t_{\\mathrm{diff,u}}, \\Delta t_{\\mathrm{diff,T}})$。\n5.  对于格式 $\\mathsf{S}_{\\mathrm{SI}}$，设 $\\Delta t_{\\max}^{\\mathsf{S}_{\\mathrm{SI}}} = \\Delta t_{\\mathrm{CFL}}$。",
            "answer": "```\n[[2.6041666666666666e-05,2.6041666666666666e-05],[7.8125e-07,5.208333333333333e-05],[0.0032,inf]]\n```"
        }
    ]
}