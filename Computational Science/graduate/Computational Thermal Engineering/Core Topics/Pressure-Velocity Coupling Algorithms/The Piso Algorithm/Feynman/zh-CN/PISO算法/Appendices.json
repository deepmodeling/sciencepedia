{
    "hands_on_practices": [
        {
            "introduction": "在同位网格上，速度和压力的耦合是一个核心挑战，简单的插值方法可能导致非物理性的压力振荡或“棋盘”现象。本练习旨在通过一个经典的数值实验，具体展示朴素线性插值如何在这种情况下失效，并揭示Rhie–Chow插值法如何通过将面速度与压力梯度直接关联来恢复必要的耦合，从而确保PISO算法的稳定性和准确性。",
            "id": "3993353",
            "problem": "考虑一个一维、周期性、均匀的同位（collocated）有限体积网格，该网格有 $N$ 个单元，单元宽度为 $\\Delta x = 1/N$，无量纲密度 $\\rho = 1$，以及一个对角动量系数 $a_u > 0$。该系数代表了在算子分裂压力隐式（PISO）算法中对动量方程的局部隐式处理。目标是构建一个数值算例，以揭示当在同位网格上通过对单元中心速度进行朴素线性插值来形成面速度时，面质量通量中出现的奇偶解耦伪影；并展示 Rhie–Chow 面插值通过将面质量通量与面上的压力梯度直接关联，从而恢复了耦合。所有物理量均为无量纲。\n\n从与 PISO 预测-校正框架一致的、由压力引起的单元中心速度的离散不可压缩动量修正出发：\n$$\nu_i = -\\frac{1}{a_u}\\left.\\frac{\\partial p}{\\partial x}\\right|_{x_i} \\approx -\\frac{1}{a_u}\\frac{p_{i+1}-p_{i-1}}{2\\Delta x},\n$$\n其中 $u_i$ 和 $p_i$ 分别是单元索引为 $i$ 处的单元中心速度和压力，索引采用周期性处理。在同位网格上，离散的面质量通量需要通过离散散度算子进入 PISO 算法中的连续性方程：\n$$\n\\left(\\nabla \\cdot \\mathbf{u}\\right)_i \\approx \\frac{u_{i+1/2} - u_{i-1/2}}{\\Delta x},\n$$\n其中 $u_{i+1/2}$ 是在单元 $i$ 和 $i+1$ 之间的面上插值的速度。\n\n定义以下两种面插值策略：\n- 单元中心速度的朴素线性插值：\n$$\nu_{i+1/2}^{\\text{naive}} = \\frac{1}{2}\\left(u_i + u_{i+1}\\right).\n$$\n- 直接根据面压力梯度和动量系数计算的 Rhie–Chow 插值：\n$$\nu_{i+1/2}^{\\text{RC}} = -\\frac{1}{a_u}\\frac{p_{i+1}-p_i}{\\Delta x}.\n$$\n\n任务：\n1. 对于给定的 $N$ 和 $\\Delta x = 1/N$，使用周期性索引，构建一个振幅为 $A > 0$ 的棋盘状压力场 $p_i = A(-1)^i$。\n2. 使用上述离散近似，根据单元中心压力梯度计算单元中心压力修正速度 $u_i$。\n3. 分别使用朴素面插值 $u_{i+1/2}^{\\text{naive}}$ 和 Rhie–Chow 面插值 $u_{i+1/2}^{\\text{RC}}$ 计算离散散度 $\\left(\\nabla \\cdot \\mathbf{u}\\right)_i$，并报告每种方法的散度的均方根（RMS）：\n$$\n\\| \\nabla \\cdot \\mathbf{u} \\|_{\\text{RMS}} = \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1}\\left(\\left(\\nabla \\cdot \\mathbf{u}\\right)_i\\right)^2}.\n$$\n4. 使用容差 $T_{\\text{small}} = 10^{-12}$ 和 $T_{\\text{large}} = 10^{-6}$，为每个测试用例生成一个布尔结果。该结果为真的条件是当且仅当朴素插值产生的 $\\| \\nabla \\cdot \\mathbf{u} \\|_{\\text{RMS}} \\le T_{\\text{small}}$ 且 Rhie–Chow 插值产生的 $\\| \\nabla \\cdot \\mathbf{u} \\|_{\\text{RMS}} \\ge T_{\\text{large}}$。这量化了朴素插值的解耦伪影和 Rhie–Chow 的修正耦合作用。\n\n推导和算法设计的基本依据：\n- 不可压缩流的质量守恒要求 $\\nabla \\cdot \\mathbf{u} = 0$。\n- PISO 中的离散动量修正通过 $u = u^* - \\frac{1}{a_u}\\nabla p$ 将速度与压力梯度联系起来，其中 $u^*$ 是预测速度。在本测试中，我们通过设置 $u^* = 0$ 来分离出压力修正的贡献。\n- 同位网格的面质量通量必须与单元压力耦合以防止奇偶解耦；Rhie–Chow 通过面上的隐式压力梯度实现了这一点。\n\n测试套件和参数：\n- 用例 1：$N = 8$, $a_u = 1.0$, $A = 1.0$。\n- 用例 2：$N = 9$, $a_u = 0.5$, $A = 1.0$。\n- 用例 3：$N = 2$, $a_u = 1.0$, $A = 0.3$。\n\n你的程序必须：\n- 为每个测试用例实现上述计算。\n- 生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如 $\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3\\right]$，其中每个 $\\text{result}_k$ 是第 $k$ 个用例的布尔值，如第 4 项所述。\n- 所有结果均为无量纲；不需要物理单位。\n\n此问题旨在可用任何现代编程语言解决，并侧重于基于不可压缩流控制方程和 PISO 压力-速度耦合的算法推理。除了所述的离散关系和定义外，不允许使用任何捷径；所有符号、变量和数字都必须严格按照规定处理。",
            "solution": "问题陈述经过解析和验证，在科学上是合理的、适定的和完整的。它提出了一个计算流体动力学中定义明确的数值实验，旨在演示同位网格上的压力-速度解耦现象以及使用 Rhie–Chow 插值对其的修正方法。\n\n核心任务是分析两种不同的面速度插值方案在承受棋盘状压力场时的行为，已知这种压力场会激发非物理振荡，而朴素方案无法检测到这些振荡。分析将通过推导每种方案的离散散度，然后评估给定测试用例的结果来进行。\n\n**1. 从棋盘状压力场计算单元中心速度 ($u_i$)**\n\n分析始于具有 $N$ 个单元的周期性域上指定的棋盘状压力场：\n$$\np_i = A(-1)^i\n$$\n其中 $i \\in \\{0, 1, \\dots, N-1\\}$。单元中心速度 $u_i$ 由离散动量修正公式给出，该公式近似了单元中心 $x_i$ 处的压力梯度：\n$$\nu_i = -\\frac{1}{a_u}\\frac{p_{i+1}-p_{i-1}}{2\\Delta x}\n$$\n由于域的周期性，索引按模 $N$ 处理。相邻单元 $i+1$ 和 $i-1$ 处的压力为：\n$$\np_{i+1} = A(-1)^{i+1} = -A(-1)^i = -p_i\n$$\n$$\np_{i-1} = A(-1)^{i-1} = A(-1)^{i+1} = -A(-1)^i = -p_i\n$$\n由此可见 $p_{i+1} = p_{i-1}$。将此代入 $u_i$ 的方程中：\n$$\nu_i = -\\frac{1}{a_u}\\frac{p_{i-1}-p_{i-1}}{2\\Delta x} = -\\frac{1}{a_u}\\frac{0}{2\\Delta x} = 0\n$$\n因此，对于棋盘状压力场，所有单元的离散单元中心速度都恒等于零，$u_i = 0$ 对所有 $i$ 成立。此结果与 $N$、$A$ 和 $a_u$ 无关。\n\n**2. 使用朴素线性插值计算散度**\n\n将速度插值到单元面 $i+1/2$ 的第一种方法是朴素线性插值：\n$$\nu_{i+1/2}^{\\text{naive}} = \\frac{1}{2}\\left(u_i + u_{i+1}\\right)\n$$\n由于我们发现对所有 $i$ 都有 $u_i = 0$，因此面速度也恒等于零：\n$$\nu_{i+1/2}^{\\text{naive}} = \\frac{1}{2}\\left(0 + 0\\right) = 0\n$$\n单元 $i$ 处的离散散度定义为：\n$$\n\\left(\\nabla \\cdot \\mathbf{u}\\right)_i = \\frac{u_{i+1/2} - u_{i-1/2}}{\\Delta x}\n$$\n使用朴素面速度，我们得到：\n$$\n\\left(\\nabla \\cdot \\mathbf{u}\\right)_i^{\\text{naive}} = \\frac{0 - 0}{\\Delta x} = 0\n$$\n所有单元的散度均为零。因此，其均方根（RMS）范数也为零：\n$$\n\\| \\nabla \\cdot \\mathbf{u} \\|_{\\text{RMS, naive}} = \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1}(0)^2} = 0\n$$\n这个结果揭示了同位网格上朴素插值的关键缺陷：它对棋盘状压力模式“视而不见”。以这种方式离散化的连续性方程无法检测到非零的压力振荡，这种效应被称为奇偶解耦。\n\n**3. 使用 Rhie–Chow 插值计算散度**\n\nRhie–Chow 插值不是根据单元中心速度构建面速度，而是直接根据面上的压力梯度构建：\n$$\nu_{i+1/2}^{\\text{RC}} = -\\frac{1}{a_u}\\frac{p_{i+1}-p_i}{\\Delta x}\n$$\n代入棋盘状压力场 $p_i = A(-1)^i$ 和 $p_{i+1} = -p_i = -A(-1)^i$：\n$$\np_{i+1}-p_i = -A(-1)^i - A(-1)^i = -2A(-1)^i\n$$\n因此，Rhie-Chow 面速度为：\n$$\nu_{i+1/2}^{\\text{RC}} = -\\frac{1}{a_u \\Delta x} \\left(-2A(-1)^i\\right) = \\frac{2A}{a_u \\Delta x}(-1)^i\n$$\n该速度非零且呈振荡性，正确地反映了潜在的压力振荡。现在，我们计算单元 $i$ 处的散度：\n$$\n\\left(\\nabla \\cdot \\mathbf{u}\\right)_i^{\\text{RC}} = \\frac{u_{i+1/2}^{\\text{RC}} - u_{i-1/2}^{\\text{RC}}}{\\Delta x}\n$$\n前一个面 $u_{i-1/2}^{\\text{RC}}$ 上的速度，可以通过在面速度公式中将 $i$ 替换为 $i-1$ 来得到：\n$$\nu_{i-1/2}^{\\text{RC}} = \\frac{2A}{a_u \\Delta x}(-1)^{i-1} = -\\frac{2A}{a_u \\Delta x}(-1)^i\n$$\n面速度的差值为：\n$$\nu_{i+1/2}^{\\text{RC}} - u_{i-1/2}^{\\text{RC}} = \\frac{2A}{a_u \\Delta x}(-1)^i - \\left(-\\frac{2A}{a_u \\Delta x}(-1)^i\\right) = \\frac{4A}{a_u \\Delta x}(-1)^i\n$$\n将此代入散度公式中得到：\n$$\n\\left(\\nabla \\cdot \\mathbf{u}\\right)_i^{\\text{RC}} = \\frac{1}{\\Delta x} \\left( \\frac{4A}{a_u \\Delta x}(-1)^i \\right) = \\frac{4A}{a_u (\\Delta x)^2}(-1)^i\n$$\n使用 $\\Delta x = 1/N$，散度变为：\n$$\n\\left(\\nabla \\cdot \\mathbf{u}\\right)_i^{\\text{RC}} = \\frac{4AN^2}{a_u}(-1)^i\n$$\n离散散度非零，表明 Rhie-Chow 方案成功地耦合了压力场和速度场。为量化这一点，我们计算其 RMS 范数：\n$$\n\\| \\nabla \\cdot \\mathbf{u} \\|_{\\text{RMS, RC}}^2 = \\frac{1}{N}\\sum_{i=0}^{N-1}\\left(\\left(\\nabla \\cdot \\mathbf{u}\\right)_i^{\\text{RC}}\\right)^2 = \\frac{1}{N}\\sum_{i=0}^{N-1}\\left(\\frac{4AN^2}{a_u}(-1)^i\\right)^2\n$$\n由于 $((-1)^i)^2 = 1$，求和项中的每一项都是常数。\n$$\n\\| \\nabla \\cdot \\mathbf{u} \\|_{\\text{RMS, RC}}^2 = \\frac{1}{N} \\cdot N \\cdot \\left(\\frac{4AN^2}{a_u}\\right)^2 = \\left(\\frac{4AN^2}{a_u}\\right)^2\n$$\n取平方根，并注意到 $A, N, a_u$ 均为正数，我们得到：\n$$\n\\| \\nabla \\cdot \\mathbf{u} \\|_{\\text{RMS, RC}} = \\frac{4AN^2}{a_u}\n$$\n\n**4. 测试用例评估**\n\n需要检查的布尔条件是 $\\| \\nabla \\cdot \\mathbf{u} \\|_{\\text{RMS, naive}} \\le T_{\\text{small}}$ 并且 $\\| \\nabla \\cdot \\mathbf{u} \\|_{\\text{RMS, RC}} \\ge T_{\\text{large}}$，其中 $T_{\\text{small}} = 10^{-12}$，$T_{\\text{large}} = 10^{-6}$。\n\n- 对于朴素方法，我们得到 $\\| \\nabla \\cdot \\mathbf{u} \\|_{\\text{RMS, naive}} = 0$。条件 $0 \\le 10^{-12}$ 总是成立。\n- 对于 Rhie-Chow 方法，我们必须检查是否 $\\frac{4AN^2}{a_u} \\ge 10^{-6}$。\n\n**用例 1**：$N = 8$，$a_u = 1.0$，$A = 1.0$\n$\\| \\nabla \\cdot \\mathbf{u} \\|_{\\text{RMS, RC}} = \\frac{4(1.0)(8^2)}{1.0} = 4 \\times 64 = 256$。\n由于 $256 \\ge 10^{-6}$，该条件为真。\n\n**用例 2**：$N = 9$，$a_u = 0.5$，$A = 1.0$\n$\\| \\nabla \\cdot \\mathbf{u} \\|_{\\text{RMS, RC}} = \\frac{4(1.0)(9^2)}{0.5} = 8 \\times 81 = 648$。\n由于 $648 \\ge 10^{-6}$，该条件为真。\n\n**用例 3**：$N = 2$，$a_u = 1.0$，$A = 0.3$\n$\\| \\nabla \\cdot \\mathbf{u} \\|_{\\text{RMS, RC}} = \\frac{4(0.3)(2^2)}{1.0} = 4 \\times 0.3 \\times 4 = 4.8$。\n由于 $4.8 \\ge 10^{-6}$，该条件为真。\n\n在所有三种情况下，该数值实验都预期会展示出朴素插值的解耦伪影和 Rhie-Chow 方案提供的修正耦合作用。因此，所有测试用例都将满足布尔条件。最终结果是一个包含三个 true 值的列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of demonstrating odd-even decoupling on a collocated\n    grid and its correction by Rhie-Chow interpolation.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, a_u, A)\n        (8, 1.0, 1.0),\n        (9, 0.5, 1.0),\n        (2, 1.0, 0.3),\n    ]\n\n    T_small = 1e-12\n    T_large = 1e-6\n    \n    results = []\n    for N, a_u, A in test_cases:\n        # 1. Define grid parameters and the checkerboard pressure field p_i.\n        dx = 1.0 / N\n        indices = np.arange(N)\n        p = A * (-1)**indices\n\n        # 2. Compute the cell-centered velocity u_i from the pressure gradient.\n        # u_i = -1/a_u * (p_{i+1} - p_{i-1}) / (2*dx)\n        # np.roll provides periodic boundary handling.\n        p_plus1 = np.roll(p, -1)\n        p_minus1 = np.roll(p, 1)\n        u = (-1.0 / a_u) * (p_plus1 - p_minus1) / (2.0 * dx)\n\n        # 3. Compute divergence using Naive Linear Interpolation.\n        # Face velocity: u_{i+1/2}^naive = 0.5 * (u_i + u_{i+1})\n        u_plus1 = np.roll(u, -1)\n        u_face_naive = 0.5 * (u + u_plus1)\n\n        # Divergence: (div u)_i = (u_{i+1/2} - u_{i-1/2}) / dx\n        u_face_naive_minus1 = np.roll(u_face_naive, 1)\n        div_u_naive = (u_face_naive - u_face_naive_minus1) / dx\n\n        # RMS of the naive divergence.\n        rms_naive = np.sqrt(np.mean(div_u_naive**2))\n\n        # 4. Compute divergence using Rhie-Chow Interpolation.\n        # Face velocity: u_{i+1/2}^RC = -1/a_u * (p_{i+1} - p_i) / dx\n        # p_plus1 is already available from the cell-centered velocity calculation.\n        u_face_rc = (-1.0 / a_u) * (p_plus1 - p) / dx\n        \n        # Divergence: (div u)_i = (u_{i+1/2} - u_{i-1/2}) / dx\n        u_face_rc_minus1 = np.roll(u_face_rc, 1)\n        div_u_rc = (u_face_rc - u_face_rc_minus1) / dx\n        \n        # RMS of the Rhie-Chow divergence.\n        rms_rc = np.sqrt(np.mean(div_u_rc**2))\n        \n        # 5. Evaluate the boolean condition as specified in the problem statement.\n        # The condition is true if naive interpolation shows decoupling (RMS is small)\n        # AND Rhie-Chow interpolation shows coupling (RMS is large).\n        condition_met = (rms_naive = T_small) and (rms_rc >= T_large)\n        results.append(condition_met)\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "PISO算法中的“S”代表算子分裂(Splitting of Operators)，这是一种强大但近似的技术，用以解耦动量和连续性方程。本练习利用傅里叶分析来揭示这种近似的直接后果：即使用近似算子逆（如对角逆）进行压力泊松方程的构建，会导致在校正步骤后仍存在残余散度。通过精确量化这个残余散度，本练习能加深对PISO算法为何常需要多次校正循环的理解。",
            "id": "3993373",
            "problem": "考虑一个长度为 $L$ 的一维周期性均匀网格，其上有 $N$ 个控制体，网格间距为 $h=L/N$，用于离散不可压缩、常物性动量方程，其中质量项和粘性项均采用全隐式格式。设 $\\rho$ 表示常数密度，$\\mu$ 表示动力粘度。记 $A$ 为离散动量方程中与隐式质量-粘性块相关的线性算子，$G$ 为离散梯度算子，$D$ 为离散散度算子，所有算子均采用二阶中心差分构建。在算子分裂压力隐式（PISO）算法中，首先使用已知压力从动量方程获得一个预测速度 $\\boldsymbol{u}^{\\ast}$，然后通过一个使用 $A$ 的近似逆（记为 $\\tilde{A}^{-1}$）组装的压力方程来确定压力修正量 $\\phi$，以强制满足不可压缩性条件。随后，通过线性求解 $A\\boldsymbol{w}=G\\phi$ 并更新 $\\boldsymbol{u}^{n+1}=\\boldsymbol{u}^{\\ast}-\\boldsymbol{w}$，利用 $A$ 的精确逆作用来修正速度。假设如下：\n- 区域是一维周期的，且 $L=1$。\n- 控制体数量为 $N=64$，因此 $h=1/64$。\n- 密度为 $\\rho=1$，动力粘度为 $\\mu=10^{-3}$。\n- 时间步长为 $\\Delta t=10^{-3}$。\n- 用于组装压力方程的近似逆是 $A$ 在物理空间中的雅可比（对角）逆，因此 $\\tilde{A}^{-1}=\\alpha I$，其中 $\\alpha=\\left(\\frac{\\rho}{\\Delta t}+\\frac{2\\mu}{h^{2}}\\right)^{-1}$。\n- 使用标准的二阶中心差分，因此对于波数为 $k=\\frac{2\\pi n}{L}$ 的傅里叶模态，离散梯度和散度算子的符号为 $i\\tilde{k}$，其中 $\\tilde{k}=\\frac{2}{h}\\sin\\left(\\frac{k h}{2}\\right)$，$A$ 的傅里叶符号为 $a(k)=\\frac{\\rho}{\\Delta t}+\\mu \\tilde{k}^{2}$。\n\n假设预测速度 $\\boldsymbol{u}^{\\ast}$ 具有一个非零的散度分量，该分量由索引为 $n=32$ 的单个傅里叶模态构成，即 $D\\boldsymbol{u}^{\\ast}$ 的傅里叶幅值 $\\hat{b}\\neq 0$ 仅在 $k=\\frac{2\\pi n}{L}$ 处存在。经过一次PISO修正步后（其中压力方程用 $\\tilde{A}^{-1}$ 组装，但速度修正用 $A$ 的精确逆作用施加），量化该模态的残余散度幅值与初始散度幅值之比，即计算\n$$\nR=\\frac{|\\widehat{D\\boldsymbol{u}^{\\,n+1}}|}{|\\widehat{D\\boldsymbol{u}^{\\ast}}|},\n$$\n其中，帽子符号表示在波数 $k=\\frac{2\\pi n}{L}$ 处的傅里叶幅值。\n\n将最终答案表示为一个无量纲数，并四舍五入到四位有效数字。",
            "solution": "题目要求计算在一次算子分裂压力隐式（PISO）算法的修正步之后，残余散度幅值与初始散度幅值之比，$R = \\frac{|\\widehat{D\\boldsymbol{u}^{\\,n+1}}|}{|\\widehat{D\\boldsymbol{u}^{\\ast}}|}$。由于给定的算子和初始条件非常适合傅里叶分析，我们将在傅里叶空间中进行分析。\n\n令 $\\mathcal{F}(\\cdot)$ 表示傅里叶变换，$\\hat{f}(k) = \\mathcal{F}(f(x))$ 为函数 $f(x)$ 在波数 $k$ 处的傅里叶幅值。线性微分或伪微分算子在物理空间中的作用，对应于在傅里叶空间中乘以其傅里叶符号。\n\nPISO修正步的步骤，如问题所述，如下：\n1.  已知一个预测速度场 $\\boldsymbol{u}^{\\ast}$。其散度 $D\\boldsymbol{u}^{\\ast}$ 不为零。给定条件是 $D\\boldsymbol{u}^{\\ast}$ 由索引为 $n=32$ 的单个傅里叶模态构成。令其在对应波数 $k = \\frac{2\\pi n}{L}$ 处的傅里叶幅值为 $\\widehat{D\\boldsymbol{u}^{\\ast}} = \\hat{b}$。\n\n2.  通过求解一个压力方程来计算压力修正量 $\\phi$。该方程是使用隐式质量-粘性算子 $A$ 的近似逆（记为 $\\tilde{A}^{-1}$）构建的。$\\phi$ 的控制方程为：\n    $$\n    (D \\tilde{A}^{-1} G) \\phi = D\\boldsymbol{u}^{\\ast}\n    $$\n    我们将此方程转换到傅里叶空间。离散梯度算子 $G$ 和离散散度算子 $D$ 的傅里叶符号均被给定为 $i\\tilde{k}$，其中 $\\tilde{k} = \\frac{2}{h}\\sin\\left(\\frac{k h}{2}\\right)$。近似逆算子 $\\tilde{A}^{-1}$ 被给定为 $\\alpha I$，其中 $I$ 是单位算子，$\\alpha$ 是一个标量常数。$\\alpha I$ 的傅里叶符号就是 $\\alpha$。因此，经过傅里叶变换的压力方程为：\n    $$\n    (i\\tilde{k}) (\\alpha) (i\\tilde{k}) \\hat{\\phi} = \\widehat{D\\boldsymbol{u}^{\\ast}}\n    $$\n    $$\n    -\\alpha \\tilde{k}^2 \\hat{\\phi} = \\hat{b}\n    $$\n    求解压力修正量的傅里叶幅值，我们得到：\n    $$\n    \\hat{\\phi} = -\\frac{\\hat{b}}{\\alpha \\tilde{k}^2}\n    $$\n\n3.  修正速度场以获得新的速度 $\\boldsymbol{u}^{n+1}$。修正是使用 $A$ 的精确逆作用进行的。更新规则是 $\\boldsymbol{u}^{n+1} = \\boldsymbol{u}^{\\ast} - \\boldsymbol{w}$，其中 $\\boldsymbol{w}$ 是 $A\\boldsymbol{w} = G\\phi$ 的解。\n\n4.  我们需要找到修正后速度的散度 $D\\boldsymbol{u}^{n+1}$。对更新规则应用散度算子：\n    $$\n    D\\boldsymbol{u}^{n+1} = D\\boldsymbol{u}^{\\ast} - D\\boldsymbol{w}\n    $$\n    从 $A\\boldsymbol{w} = G\\phi$，我们有 $\\boldsymbol{w} = A^{-1}G\\phi$。将此代入散度的表达式中得到：\n    $$\n    D\\boldsymbol{u}^{n+1} = D\\boldsymbol{u}^{\\ast} - D(A^{-1}G\\phi)\n    $$\n    将此方程转换到傅里叶空间，我们使用 $D$、$G$ 和 $A$ 的符号。$A$ 的符号给定为 $a(k) = \\frac{\\rho}{\\Delta t} + \\mu \\tilde{k}^2$，因此其逆 $A^{-1}$ 的符号是 $1/a(k)$。\n    $$\n    \\widehat{D\\boldsymbol{u}^{n+1}} = \\widehat{D\\boldsymbol{u}^{\\ast}} - \\mathcal{F}(D A^{-1} G \\phi) = \\hat{b} - (i\\tilde{k}) \\left(\\frac{1}{a(k)}\\right) (i\\tilde{k}) \\hat{\\phi}\n    $$\n    $$\n    \\widehat{D\\boldsymbol{u}^{n+1}} = \\hat{b} + \\frac{\\tilde{k}^2}{a(k)} \\hat{\\phi}\n    $$\n    现在，我们代入步骤2中得到的 $\\hat{\\phi}$ 的表达式：\n    $$\n    \\widehat{D\\boldsymbol{u}^{n+1}} = \\hat{b} + \\frac{\\tilde{k}^2}{a(k)} \\left( -\\frac{\\hat{b}}{\\alpha \\tilde{k}^2} \\right) = \\hat{b} - \\frac{\\hat{b}}{\\alpha a(k)} = \\hat{b} \\left( 1 - \\frac{1}{\\alpha a(k)} \\right)\n    $$\n\n5.  所求比率 $R$ 是傅里叶幅值之比的模：\n    $$\n    R = \\frac{|\\widehat{D\\boldsymbol{u}^{n+1}}|}{|\\widehat{D\\boldsymbol{u}^{\\ast}}|} = \\frac{|\\hat{b} \\left( 1 - \\frac{1}{\\alpha a(k)} \\right)|}{|\\hat{b}|} = \\left| 1 - \\frac{1}{\\alpha a(k)} \\right| = \\left| 1 - \\frac{\\alpha^{-1}}{a(k)} \\right|\n    $$\n    现在我们必须使用所提供的数据计算所涉及各项的数值：\n    -   $L=1$，$N=64$，所以 $h=L/N = 1/64$。\n    -   $\\rho=1$，$\\mu=10^{-3}$，$\\Delta t=10^{-3}$。\n    -   傅里叶模态索引 $n=32$。\n\n    波数 $k$ 是：\n    $$\n    k = \\frac{2\\pi n}{L} = \\frac{2\\pi (32)}{1} = 64\\pi\n    $$\n    有效波数 $\\tilde{k}$ 是：\n    $$\n    \\tilde{k} = \\frac{2}{h} \\sin\\left(\\frac{k h}{2}\\right) = \\frac{2}{1/64} \\sin\\left(\\frac{(64\\pi)(1/64)}{2}\\right) = 128 \\sin\\left(\\frac{\\pi}{2}\\right) = 128\n    $$\n    精确算子 $A$ 的符号是：\n    $$\n    a(k) = \\frac{\\rho}{\\Delta t} + \\mu \\tilde{k}^2 = \\frac{1}{10^{-3}} + 10^{-3} \\cdot (128)^2 = 1000 + 10^{-3} \\cdot 16384 = 1000 + 16.384 = 1016.384\n    $$\n    项 $\\alpha^{-1}$ 是物理空间中算子 $A$ 的对角线元素，用于构建近似逆 $\\tilde{A}^{-1}$：\n    $$\n    \\alpha^{-1} = \\frac{\\rho}{\\Delta t} + \\frac{2\\mu}{h^2} = \\frac{1}{10^{-3}} + \\frac{2 \\cdot 10^{-3}}{(1/64)^2} = 1000 + 2 \\cdot 10^{-3} \\cdot 4096 = 1000 + 8.192 = 1008.192\n    $$\n    最后，我们计算比率 $R$：\n    $$\n    R = \\left| 1 - \\frac{1008.192}{1016.384} \\right| = \\left| \\frac{1016.384 - 1008.192}{1016.384} \\right| = \\frac{8.192}{1016.384}\n    $$\n    $$\n    R \\approx 0.0080601509...\n    $$\n    将结果四舍五入到四位有效数字，得到 $0.008060$。",
            "answer": "$$\n\\boxed{0.008060}\n$$"
        },
        {
            "introduction": "PISO算法的性能与动量预测步骤中所选的时间积分方案密切相关。本练习将引导你定量比较两种经典的格式：后向欧拉（Backward Euler）格式和Crank-Nicolson格式。通过推导和计算它们各自的时间精度和对压力方程刚度的影响，你将深入理解在算法设计中如何权衡这些关键性能指标。",
            "id": "3993384",
            "problem": "考虑在长度为 $L$、横截面积均匀为 $A$ 的直通道中的不可压缩流动。该通道通过一维均匀有限体积网格进行离散化，该网格包含 $N$ 个大小为 $h = L/N$ 的控制体积。流体密度为 $\\rho$，运动粘度为 $\\nu$，主流速度为 $U$，方向为 $x$ 轴正方向。雷诺数 (Reynolds number (Re)) 定义为 $Re = \\rho U L / \\mu$，其中 $\\mu = \\rho \\nu$ 为动力粘度。选择的时间步长 $\\Delta t$ 使得库朗数（定义为 $Co = U \\Delta t / h$）等于 $Co = 0.5$。对流项采用一阶迎风格式离散，扩散项采用二阶中心差分格式离散。采用算子分裂压力隐式 (Pressure Implicit with Splitting of Operators, PISO) 算法，在动量预测步之后，通过压力修正方程来强制满足连续性方程。\n\n对于动量预测器，考虑一个从动量方程的积分形式和对流与扩散的线性化通量得到的单元集中线性模型，在预测步中忽略压力梯度。这将为每个控制体积中的预测速度 $u(t)$ 产生一个形如 $\\rho h \\, \\frac{d u}{d t} = \\mathcal{R}(u)$ 的线性常微分方程 (ODE)，其中 $\\mathcal{R}(u)$ 表示线性化的对流和扩散出流。通过从第一性原理推导常数 $\\lambda$（用 $\\rho$、$U$、$\\mu$ 和 $h$ 表示），将此 ODE 表示为 $\\frac{d u}{d t} = \\lambda u$ 的形式。\n\n现在，比较预测器的两种时间积分格式：\n- 后向欧拉（完全隐式）。\n- 克兰克-尼科尔森（梯形法则）。\n\n从应用于线性 ODE $\\frac{d u}{d t} = \\lambda u$ 的每种时间积分格式的基本定义出发，推导每种格式的单步数值放大因子和精确的单步放大因子。将给定 $\\Delta t$ 的时间精度度量 $E$ 定义为数值单步放大因子与精确单步放大因子之间的绝对差。计算两种格式的 $E$。\n\n在 PISO 算法中，压力修正方程是椭圆形的，其标量系数来自能量预测器左侧对角项 $a_p$；在标准算子分裂下，此标量乘以压力拉普拉斯算子，形式为 $\\alpha = \\Delta t / a_p$。根据预测器中使用的相同通量线性化和隐式处理方法，推导每种时间积分格式的 $a_p$，然后得到每种格式的 $\\alpha$。将压力方程刚度度量 $S$ 定义为 $S = 1/\\alpha$（更大的 $S$ 对应于在较小椭圆算子缩放意义上更刚性的压力方程）。计算比率 $S_{\\mathrm{BE}} / S_{\\mathrm{CN}}$。\n\n使用以下数值参数以获得具体值：\n- $L = 1 \\,\\mathrm{m}$, $A = 1 \\,\\mathrm{m}^2$, $N = 10$。\n- $\\rho = 1 \\,\\mathrm{kg/m^3}$, $U = 1 \\,\\mathrm{m/s}$, $Re = 100$ (因此 $\\mu = \\rho U L / Re$)。\n- $Co = 0.5$ (所以 $\\Delta t = Co \\, h / U$)。\n\n将您的最终答案以行矩阵的形式报告，其中依次包含：\n- 时间精度度量之比 $R_E = E_{\\mathrm{BE}} / E_{\\mathrm{CN}}$，\n- 刚度度量之比 $R_S = S_{\\mathrm{BE}} / S_{\\mathrm{CN}}$。\n\n将报告的每个值四舍五入到四位有效数字。将最终答案表示为无量纲数。",
            "solution": "### 模型ODE的推导\n我们首先对控制体积 $P$ 及其相邻单元 $W$（西）和 $E$（东）的一维对流扩散方程进行空间离散化。忽略压力项的控制方程为：\n$$ \\rho \\frac{\\partial u}{\\partial t} + \\rho U \\frac{\\partial u}{\\partial x} = \\mu \\frac{\\partial^2 u}{\\partial x^2} $$\n在长度为 $h$、面积为 $A$ 的控制体积上积分（对于一维问题，$A$ 会被约掉），我们得到：\n$$ \\rho h \\frac{d u_P}{d t} = \\left[ -\\rho U u + \\mu \\frac{d u}{d x} \\right]_{w}^{e} $$\n这里，$u_P$ 是控制体积 $P$ 中的速度，$e$ 和 $w$ 表示控制体积的东、西界面。应用指定的离散格式：\n- 对流（一阶迎风，$U0$）：$e$ 界面的通量基于 $u_P$，$w$ 界面的通量基于 $u_W$。净对流出流为 $\\rho U u_e - \\rho U u_w = \\rho U (u_P - u_W)$。\n- 扩散（二阶中心）：$e$ 界面的扩散通量为 $\\mu \\frac{u_E - u_P}{h}$，$w$ 界面的扩散通量为 $\\mu \\frac{u_P - u_W}{h}$。净扩散入流为 $\\mu \\frac{u_E - u_P}{h} - \\mu \\frac{u_P - u_W}{h} = \\frac{\\mu}{h}(u_E - 2u_P + u_W)$。\n\n单元 $P$ 的半离散方程是动量变化率等于净通量之和：\n$$ \\rho h \\frac{d u_P}{d t} = -\\rho U(u_P - u_W) + \\frac{\\mu}{h}(u_E - 2u_P + u_W) $$\n$$ \\rho h \\frac{d u_P}{d t} = - \\left( \\rho U + \\frac{2\\mu}{h} \\right) u_P + \\left( \\rho U + \\frac{\\mu}{h} \\right) u_W + \\left( \\frac{\\mu}{h} \\right) u_E $$\n问题要求一个形式为 $\\frac{du}{dt} = \\lambda u$ 的“单元集中线性模型”。这意味着将依赖于相邻单元的右侧项近似为一个与单元自身速度 $u_P$ 成正比的项。这通过仅考虑空间算子矩阵的对角部分来实现。\n$$ \\rho h \\frac{du}{dt} \\approx - \\left( \\rho U + \\frac{2\\mu}{h} \\right) u $$\n求解 $\\frac{du}{dt}$，我们找到常数 $\\lambda$：\n$$ \\frac{du}{dt} = \\left[ -\\frac{1}{\\rho h} \\left( \\rho U + \\frac{2\\mu}{h} \\right) \\right] u = \\left( -\\frac{U}{h} - \\frac{2\\mu}{\\rho h^2} \\right) u $$\n因此，$\\lambda = -\\frac{U}{h} - \\frac{2\\mu}{\\rho h^2}$。\n\n### 时间精度度量\nODE 为 $\\frac{du}{dt} = \\lambda u$。在一个时间步长 $\\Delta t$ 内的精确解为 $u(t+\\Delta t) = u(t) \\exp(\\lambda \\Delta t)$。精确的单步放大因子为 $G_{exact} = \\exp(\\lambda \\Delta t)$。\n\n**后向欧拉 (BE)：** 格式为 $\\frac{u^{n+1} - u^n}{\\Delta t} = \\lambda u^{n+1}$。\n$$ u^{n+1}(1 - \\lambda \\Delta t) = u^n \\implies G_{BE} = \\frac{u^{n+1}}{u^n} = \\frac{1}{1 - \\lambda \\Delta t} $$\nBE 的时间精度度量为：\n$$ E_{BE} = |G_{BE} - G_{exact}| = \\left| \\frac{1}{1 - \\lambda \\Delta t} - \\exp(\\lambda \\Delta t) \\right| $$\n\n**克兰克-尼科尔森 (CN)：** 格式为 $\\frac{u^{n+1} - u^n}{\\Delta t} = \\lambda \\frac{u^{n+1} + u^n}{2}$。\n$$ u^{n+1}\\left(1 - \\frac{\\lambda \\Delta t}{2}\\right) = u^n\\left(1 + \\frac{\\lambda \\Delta t}{2}\\right) \\implies G_{CN} = \\frac{u^{n+1}}{u^n} = \\frac{1 + \\lambda \\Delta t/2}{1 - \\lambda \\Delta t/2} $$\nCN 的时间精度度量为：\n$$ E_{CN} = |G_{CN} - G_{exact}| = \\left| \\frac{1 + \\lambda \\Delta t/2}{1 - \\lambda \\Delta t/2} - \\exp(\\lambda \\Delta t) \\right| $$\n\n### 压力方程刚度度量\n刚度度量为 $S = 1/\\alpha = a_p / \\Delta t$，其中 $a_p$ 是动量预测步中矩阵的对角系数。预测速度 $u^*$ 的全离散方程写作 $a_p u_P^* = \\sum a_{nb} u_{nb}^* + \\text{源项}$。我们从半离散方程的时间离散化中推导 $a_p$。\n单元 $P$ 的空间算子项可以写作 $a_P^{\\text{space}} u_P - a_W^{\\text{space}} u_W - a_E^{\\text{space}} u_E$，其中 $a_P^{\\text{space}} = \\rho U + \\frac{2\\mu}{h}$。\n\n**后向欧拉：** 时间导数和空间项在未来时间层上进行隐式求值。\n$$ \\rho h \\frac{u_P^* - u_P^n}{\\Delta t} = -\\left( a_P^{\\text{space}} u_P^* - \\dots \\right) $$\n整理以分离含 $u_P^*$ 的项：\n$$ \\left( \\frac{\\rho h}{\\Delta t} + a_P^{\\text{space}} \\right) u_P^* = \\dots $$\n因此，对角系数为 $a_{p, \\text{BE}} = \\frac{\\rho h}{\\Delta t} + a_P^{\\text{space}} = \\frac{\\rho h}{\\Delta t} + \\rho U + \\frac{2\\mu}{h}$。\nBE 的刚度度量为：\n$$ S_{BE} = \\frac{a_{p, \\text{BE}}}{\\Delta t} = \\frac{\\rho h}{(\\Delta t)^2} + \\frac{\\rho U}{\\Delta t} + \\frac{2\\mu}{h \\Delta t} $$\n\n**克兰克-尼科尔森：** 空间项是其在时间层 $n$ 和 $*$ 处值的平均。\n$$ \\rho h \\frac{u_P^* - u_P^n}{\\Delta t} = -\\frac{1}{2}\\left( a_P^{\\text{space}} u_P^* - \\dots \\right) - \\frac{1}{2}\\left( a_P^{\\text{space}} u_P^n - \\dots \\right) $$\n整理以分离含 $u_P^*$ 的项：\n$$ \\left( \\frac{\\rho h}{\\Delta t} + \\frac{1}{2}a_P^{\\text{space}} \\right) u_P^* = \\dots $$\n因此，对角系数为 $a_{p, \\text{CN}} = \\frac{\\rho h}{\\Delta t} + \\frac{1}{2}a_P^{\\text{space}} = \\frac{\\rho h}{\\Delta t} + \\frac{1}{2}\\left(\\rho U + \\frac{2\\mu}{h}\\right)$。\nCN 的刚度度量为：\n$$ S_{CN} = \\frac{a_{p, \\text{CN}}}{\\Delta t} = \\frac{\\rho h}{(\\Delta t)^2} + \\frac{\\rho U}{2\\Delta t} + \\frac{\\mu}{h \\Delta t} $$\n\n### 数值计算\n首先，我们计算物理和数值参数：\n- 单元尺寸：$h = L/N = 1/10 = 0.1 \\, \\mathrm{m}$。\n- 动力粘度：$\\mu = \\rho U L / Re = (1 \\cdot 1 \\cdot 1) / 100 = 0.01 \\, \\mathrm{kg/(m \\cdot s)}$。\n- 时间步长：$\\Delta t = Co \\cdot h / U = 0.5 \\cdot 0.1 / 1 = 0.05 \\, \\mathrm{s}$。\n\n现在，我们计算 $\\lambda$：\n$$ \\lambda = -\\frac{U}{h} - \\frac{2\\mu}{\\rho h^2} = -\\frac{1}{0.1} - \\frac{2(0.01)}{1 \\cdot (0.1)^2} = -10 - \\frac{0.02}{0.01} = -10 - 2 = -12 \\, \\mathrm{s^{-1}} $$\n关键的无量纲参数是 $x = \\lambda \\Delta t$：\n$$ x = -12 \\cdot 0.05 = -0.6 $$\n\n**时间精度比：**\n- 精确放大因子：$G_{exact} = \\exp(x) = \\exp(-0.6) \\approx 0.548812$。\n- BE 放大因子：$G_{BE} = \\frac{1}{1 - x} = \\frac{1}{1 - (-0.6)} = \\frac{1}{1.6} = 0.625$。\n- CN 放大因子：$G_{CN} = \\frac{1 + x/2}{1 - x/2} = \\frac{1 - 0.3}{1 + 0.3} = \\frac{0.7}{1.3} \\approx 0.538462$。\n\n- 精度度量：\n  - $E_{BE} = |0.625 - 0.548812| = 0.076188$。\n  - $E_{CN} = |0.538462 - 0.548812| = |-0.010350| = 0.010350$。\n- 比率 $R_E$：\n  $$ R_E = \\frac{E_{BE}}{E_{CN}} = \\frac{0.076188}{0.010350} \\approx 7.36116 $$\n  四舍五入到四位有效数字，$R_E = 7.361$。\n\n**刚度度量比：**\n我们计算 $S_{BE}$ 和 $S_{CN}$ 的各项：\n- 第1项：$\\frac{\\rho h}{(\\Delta t)^2} = \\frac{1 \\cdot 0.1}{(0.05)^2} = \\frac{0.1}{0.0025} = 40$。\n- 第2项：$\\frac{\\rho U}{\\Delta t} = \\frac{1 \\cdot 1}{0.05} = 20$。\n- 第3项：$\\frac{2\\mu}{h \\Delta t} = \\frac{2 \\cdot 0.01}{0.1 \\cdot 0.05} = \\frac{0.02}{0.005} = 4$。\n\n- 刚度度量：\n  - $S_{BE} = 40 + 20 + 4 = 64$。\n  - $S_{CN} = 40 + \\frac{20}{2} + \\frac{4}{2} = 40 + 10 + 2 = 52$。\n- 比率 $R_S$：\n  $$ R_S = \\frac{S_{BE}}{S_{CN}} = \\frac{64}{52} = \\frac{16}{13} \\approx 1.230769 $$\n  四舍五入到四位有效数字，$R_S = 1.231$。\n\n最终结果是比率 $R_E$ 和 $R_S$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 7.361  1.231 \\end{pmatrix}}$$"
        }
    ]
}