{
    "hands_on_practices": [
        {
            "introduction": "对流-扩散方程是描述流体中热量或物质输运的基本工具。本练习将引导你通过一个经典的解析方法——在移动坐标系下进行相似性分析——来求解一个理想化的对流-扩散问题。通过推导高斯脉冲的行进和展宽过程，你将直观地理解对流引起的整体平移与扩散导致的形态弥散这两个核心物理效应，并为评估更复杂的数值解法提供一个精确的基准。",
            "id": "3959784",
            "problem": "在无穷直线 $x \\in (-\\infty,\\infty)$ 上，一个一维温度场 $T(x,t)$ 在速度为常数 $u$、热扩散系数为常数 $\\alpha$ 的均匀流中演化。从热能守恒和 Fourier 热传导定律出发，温度的控制偏微分方程 (PDE) 为\n$$\n\\frac{\\partial T}{\\partial t} + u \\frac{\\partial T}{\\partial x} = \\alpha \\frac{\\partial^{2} T}{\\partial x^{2}},\n$$\n对于所有 $t>0$，远场条件为当 $|x| \\to \\infty$ 时，$T(x,t) \\to 0$。初始温度分布是一个空间积分（质量）有限的高斯分布，\n$$\nT(x,0) = \\frac{M}{\\sqrt{2\\pi}\\,\\sigma_{0}} \\exp\\!\\left(-\\frac{(x - x_{c})^{2}}{2\\,\\sigma_{0}^{2}}\\right),\n$$\n其中 $M>0$ 是 $T$ 在 $t=0$ 时的空间积分，$x_{c}\\in\\mathbb{R}$ 是初始质心，$\\sigma_{0}>0$ 是初始标准差。使用移动坐标系中的相似性分析，推导出行进高斯解的结构，并确定其统计平均值和方差如何随时间演化。将最终答案以单行矩阵的形式给出，其中包含 $T(x,t)$ 的平均值 $\\mu(t)$ 和方差 $\\sigma^{2}(t)$，并表示为 $t$、$u$、$\\alpha$、$x_{c}$ 和 $\\sigma_{0}$ 的显式函数。平均值以米为单位，方差以平方米为单位。无需四舍五入；请提供封闭形式的表达式。",
            "solution": "用户要求我求解温度分布的平均值和方差随时间的演化。\n\n### 步骤 1：提取已知条件\n- **控制 PDE**：$\\frac{\\partial T}{\\partial t} + u \\frac{\\partial T}{\\partial x} = \\alpha \\frac{\\partial^{2} T}{\\partial x^{2}}$，对于 $x \\in (-\\infty,\\infty)$ 和 $t>0$。\n- **参数**：恒定速度 $u$，恒定热扩散系数 $\\alpha$。\n- **远场条件**：对于所有 $t>0$，当 $|x| \\to \\infty$ 时，$T(x,t) \\to 0$。\n- **初始条件**：$T(x,0) = \\frac{M}{\\sqrt{2\\pi}\\,\\sigma_{0}} \\exp\\!\\left(-\\frac{(x - x_{c})^{2}}{2\\,\\sigma_{0}^{2}}\\right)$，其中 $M>0$ 是初始总热含量（与质量成正比），$x_{c}$ 是初始质心，$\\sigma_{0}>0$ 是初始标准差。\n- **任务**：使用移动坐标系中的相似性分析，求出温度分布 $T(x,t)$ 的平均值 $\\mu(t)$ 和方差 $\\sigma^{2}(t)$。\n\n### 步骤 2：使用提取的已知条件进行验证\n1.  **科学依据**：控制方程是一维平流-扩散方程，这是物理学和工程学中用于描述流体中标量（如热量、质量或动量）输运的一个基本且广泛使用的模型。初始条件是高斯函数，这是一个物理上现实且数学上性质良好的分布。该问题牢固地植根于输运现象的原理。\n2.  **良定的**：该问题是无穷域上一个线性抛物型偏微分方程的良定初值问题。给定光滑且快速衰减的初始数据（高斯函数），保证在所有时间 $t>0$ 都存在唯一且稳定的解。远场边界条件适用于无穷域。\n3.  **客观性**：该问题使用精确、无歧义的数学语言陈述。没有主观或基于观点的元素。\n4.  **完整性和一致性**：提供了所有必要的组成部分：PDE、初始条件、边界条件以及所有参数的定义。信息是自洽的，没有矛盾。\n5.  **现实性和可行性**：物理场景——均匀流中热脉冲的扩散和平流——是热工学中的一个标准且现实的问题。参数是常数，这是对许多物理系统常用且有效的简化。\n6.  **其他缺陷**：该问题是数学物理中的一个标准练习题，既不琐碎，也非同义反复或伪深刻。它需要特定的解析技术来解决。\n\n### 步骤 3：结论和行动\n问题是有效的。这是一个科学上合理、良定且自洽的输运现象领域的问题。我将继续进行完整解答。\n\n控制方程是平流-扩散方程：\n$$\n\\frac{\\partial T}{\\partial t} + u \\frac{\\partial T}{\\partial x} = \\alpha \\frac{\\partial^{2} T}{\\partial x^{2}}\n$$\n这个方程描述了两个物理过程：由项 $u \\frac{\\partial T}{\\partial x}$ 表示的平流（随平均流动的输运），以及由项 $\\alpha \\frac{\\partial^{2} T}{\\partial x^{2}}$ 表示的扩散（由随机分子运动引起的扩展）。题目建议使用移动坐标系。这是简化平流项的自然选择。\n\n让我们定义一个新的空间坐标 $\\xi$，它以速度 $u$ 随流体移动：\n$$\n\\xi = x - ut\n$$\n时间坐标 $t$ 保持不变。我们定义一个新函数 $\\tilde{T}(\\xi, t) = T(x, t)$。为了变换这个偏微分方程，我们必须使用链式法则将关于 $(x, t)$ 的偏导数用关于 $(\\xi, t)$ 的偏导数来表示。\n\n关于 $x$ 的导数变为：\n$$\n\\frac{\\partial T}{\\partial x} = \\frac{\\partial \\tilde{T}}{\\partial \\xi} \\frac{\\partial \\xi}{\\partial x} + \\frac{\\partial \\tilde{T}}{\\partial t} \\frac{\\partial t}{\\partial x} = \\frac{\\partial \\tilde{T}}{\\partial \\xi} (1) + \\frac{\\partial \\tilde{T}}{\\partial t} (0) = \\frac{\\partial \\tilde{T}}{\\partial \\xi}\n$$\n关于 $x$ 的二阶导数是：\n$$\n\\frac{\\partial^{2} T}{\\partial x^{2}} = \\frac{\\partial}{\\partial x} \\left(\\frac{\\partial \\tilde{T}}{\\partial \\xi}\\right) = \\frac{\\partial}{\\partial \\xi} \\left(\\frac{\\partial \\tilde{T}}{\\partial \\xi}\\right) \\frac{\\partial \\xi}{\\partial x} = \\frac{\\partial^{2} \\tilde{T}}{\\partial \\xi^{2}}\n$$\n关于 $t$ 的导数是：\n$$\n\\frac{\\partial T}{\\partial t} = \\frac{\\partial \\tilde{T}}{\\partial t} \\frac{\\partial t}{\\partial t} + \\frac{\\partial \\tilde{T}}{\\partial \\xi} \\frac{\\partial \\xi}{\\partial t} = \\frac{\\partial \\tilde{T}}{\\partial t} (1) + \\frac{\\partial \\tilde{T}}{\\partial \\xi} (-u) = \\frac{\\partial \\tilde{T}}{\\partial t} - u \\frac{\\partial \\tilde{T}}{\\partial \\xi}\n$$\n现在，将这些变换后的导数代回原始的 PDE：\n$$\n\\left(\\frac{\\partial \\tilde{T}}{\\partial t} - u \\frac{\\partial \\tilde{T}}{\\partial \\xi}\\right) + u \\left(\\frac{\\partial \\tilde{T}}{\\partial \\xi}\\right) = \\alpha \\left(\\frac{\\partial^{2} \\tilde{T}}{\\partial \\xi^{2}}\\right)\n$$\n平流项相互抵消，从而在移动坐标系 $(\\xi, t)$ 中得到经典的一维热（或扩散）方程：\n$$\n\\frac{\\partial \\tilde{T}}{\\partial t} = \\alpha \\frac{\\partial^{2} \\tilde{T}}{\\partial \\xi^{2}}\n$$\n接下来，我们变换初始条件。在 $t=0$ 时，移动坐标 $\\xi$ 与固定坐标 $x$ 相同，即 $\\xi = x - u(0) = x$。新坐标系中的初始条件是：\n$$\n\\tilde{T}(\\xi, 0) = T(x,0) = \\frac{M}{\\sqrt{2\\pi}\\,\\sigma_{0}} \\exp\\left(-\\frac{(\\xi - x_{c})^{2}}{2\\,\\sigma_{0}^{2}}\\right)\n$$\n问题现在简化为求解具有高斯初始条件的标准扩散方程。众所周知，扩散方程的解是初始条件与基本解（或热核）$K(\\xi, t) = \\frac{1}{\\sqrt{4\\pi\\alpha t}} \\exp\\left(-\\frac{\\xi^2}{4\\alpha t}\\right)$ 的卷积。\n\n高斯分布的一个关键性质是两个高斯函数的卷积仍然是高斯函数。初始条件是平均值为 $x_c$、方差为 $\\sigma_0^2$ 的高斯分布。热核是平均值为 $0$、方差为 $2\\alpha t$ 的高斯分布。卷积性质意味着所得的分布将是一个高斯分布，其平均值是初始平均值之和，其方差是初始方差之和。\n\n因此，对于所有 $t > 0$，解 $\\tilde{T}(\\xi, t)$ 是一个关于 $\\xi$ 的高斯分布。其平均值为 $x_c + 0 = x_c$，方差为 $\\sigma_0^2 + 2\\alpha t$。总积分值 $M$ 是守恒的。因此，移动坐标系中的解为：\n$$\n\\tilde{T}(\\xi, t) = \\frac{M}{\\sqrt{2\\pi(\\sigma_{0}^{2} + 2\\alpha t)}} \\exp\\left(-\\frac{(\\xi - x_{c})^{2}}{2(\\sigma_{0}^{2} + 2\\alpha t)}\\right)\n$$\n这种解在保持其函数形式（高斯函数）的同时，其参数（宽度）随时间演化的结构，是相似解的特征。\n\n为了在原始实验室坐标系 $(x, t)$ 中找到解，我们将 $\\xi = x - ut$ 代回到 $\\tilde{T}$ 的表达式中：\n$$\nT(x,t) = \\frac{M}{\\sqrt{2\\pi(\\sigma_{0}^{2} + 2\\alpha t)}} \\exp\\left(-\\frac{((x - ut) - x_{c})^{2}}{2(\\sigma_{0}^{2} + 2\\alpha t)}\\right)\n$$\n重新整理指数中的项，得到温度分布的最终形式：\n$$\nT(x,t) = \\frac{M}{\\sqrt{2\\pi(\\sigma_{0}^{2} + 2\\alpha t)}} \\exp\\left(-\\frac{(x - (x_{c} + ut))^{2}}{2(\\sigma_{0}^{2} + 2\\alpha t)}\\right)\n$$\n这是一个标准的高斯概率密度函数（按 $M$ 缩放），其形式为 $f(x) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(x - \\mu)^2}{2\\sigma^2}\\right)$，其中 $\\mu$ 是平均值，$\\sigma^2$ 是方差。通过将我们的解 $T(x,t)$ 与这种通用形式进行比较，我们可以直接确定温度分布随时间变化的平均值 $\\mu(t)$ 和方差 $\\sigma^2(t)$。\n\n分布的平均值是高斯函数的中心：\n$$\n\\mu(t) = x_{c} + ut\n$$\n分布的方差是指数中二次项分母中的项：\n$$\n\\sigma^{2}(t) = \\sigma_{0}^{2} + 2\\alpha t\n$$\n温度分布的平均位置以恒定的平流速度 $u$ 移动，从初始质心 $x_c$ 开始。方差从其初始值 $\\sigma_0^2$ 开始随时间线性增长，增长率为 $2\\alpha$，这是扩散过程的典型特征。\n\n最终答案要求提供一个包含平均值 $\\mu(t)$ 和方差 $\\sigma^2(t)$ 的行矩阵。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} x_{c} + ut  \\sigma_{0}^{2} + 2 \\alpha t \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在解决了理想情况下的对流-扩散问题后，我们转向更具普遍性的数值方法。纯对流项的离散化是计算流体动力学中的一个经典挑战，简单的中心差分格式往往会引入非物理的振荡。本练习  将指导你从基本守恒定律出发，推导一阶迎风格式，并通过修正方程分析揭示其内在的“数值扩散”效应。理解这一概念对于正确评估和控制数值模拟中的耗散与色散误差至关重要。",
            "id": "3959810",
            "problem": "一个输运标量的一维常系数线性平流由守恒律控制，该守恒律指出，控制体中标量密度的变化仅由跨越其边界的净通量引起。从这个守恒声明以及通量定义为速度与标量密度之积出发，使用时间显式方法和单调、方向合适的数值通量，为均匀网格上的网格单元平均标量推导一个相容的离散更新方程。此构造必须得到一个在一阶方法，该方法在适当的 Courant–Friedrichs–Lewy (CFL) 条件下保持稳定。请写出正、负平流速度下的更新方程，然后对全离散方法进行修正方程分析，以量化作为等效扩散项的主阶截断效应。\n\n您必须从第一性原理出发，不使用任何预先推导的平流-扩散结果，完成以下任务：\n- 推导由常速度 $a$ 驱动的一维线性平流问题的一阶迎风格式，该问题定义在空间步长为 $\\Delta x$、时间步长为 $\\Delta t$ 的均匀网格上。\n- 使用泰勒展开得到全离散方法的修正方程，并识别起到扩散作用的主阶偶数空间导数的系数。将此系数定义为数值扩散 $D_{\\text{num}}$，单位为 $\\mathrm{m}^2/\\mathrm{s}$，并表示为 $a$、$\\Delta x$ 和 $\\Delta t$ 的函数。您必须正确地包含对 $a$ 符号的依赖关系，并用 Courant–Friedrichs–Lewy (CFL) 数表示任何稳定性约束。\n- 通过考虑傅里叶模态的衰减或增长，将 $D_{\\text{num}}$ 的符号和大小与振荡的稳定以及尖锐梯度的抹平联系起来。\n\n然后，实现一个程序，使用您推导的表达式，为每个测试用例计算：\n1. 数值扩散 $D_{\\text{num}}$，单位为 $\\mathrm{m}^2/\\mathrm{s}$。\n2. 在您推导的全离散一阶迎风方法下，波数为 $k$（单位为 $\\mathrm{rad}/\\mathrm{m}$）的傅里叶模态的单步放大率 $\\lvert G \\rvert$。\n3. 由使用 $D_{\\text{num}}$ 的等效平流-扩散模型预测的单步振幅，即 $\\exp\\!\\big(-D_{\\text{num}}\\,k^2\\,\\Delta t\\big)$，该值为无量纲。\n\n物理单位和角度/单位约定：\n- $a$ 以 $\\mathrm{m}/\\mathrm{s}$ 表示，$\\Delta x$ 以 $\\mathrm{m}$ 表示，$\\Delta t$ 以 $\\mathrm{s}$ 表示，$k$ 以 $\\mathrm{rad}/\\mathrm{m}$ 表示，而 $D_{\\text{num}}$ 以 $\\mathrm{m}^2/\\mathrm{s}$ 表示。\n- 傅里叶模态波数 $k$ 是一个角空间频率；角度以 $k\\,\\Delta x$ 的形式出现，单位为弧度。\n\n测试套件包含四组参数集 $(a,\\Delta x,\\Delta t,k)$：\n- 情况 A（一般稳定情况）：$a=1$，$\\Delta x=1.0\\times 10^{-2}$，$\\Delta t=6.0\\times 10^{-3}$，$k=50$。\n- 情况 B（CFL 边界）：$a=1$，$\\Delta x=1.0\\times 10^{-2}$，$\\Delta t=1.0\\times 10^{-2}$，$k=40$。\n- 情况 C（CFL 违例，反扩散）：$a=1$，$\\Delta x=1.0\\times 10^{-2}$，$\\Delta t=1.2\\times 10^{-2}$，$k=\\pi/\\Delta x$。\n- 情况 D（负速度）：$a=-2$，$\\Delta x=2.0\\times 10^{-2}$，$\\Delta t=5.0\\times 10^{-3}$，$k=10$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，包含四个情况的 $12$ 个结果，顺序为 $[D_{\\text{num}}^{(A)},\\lvert G\\rvert^{(A)},\\exp(-D_{\\text{num}}^{(A)}k^2\\Delta t),D_{\\text{num}}^{(B)},\\lvert G\\rvert^{(B)},\\exp(-D_{\\text{num}}^{(B)}k^2\\Delta t),D_{\\text{num}}^{(C)},\\lvert G\\rvert^{(C)},\\exp(-D_{\\text{num}}^{(C)}k^2\\Delta t),D_{\\text{num}}^{(D)},\\lvert G\\rvert^{(D)},\\exp(-D_{\\text{num}}^{(D)}k^2\\Delta t)]$。\n- 每个数字必须以十进制浮点数形式打印，并四舍五入到小数点后六位。",
            "solution": "所提出的问题是有效的，因为它科学地基于计算流体动力学的原理，问题设定良好，有明确的目标和充足的数据，并且没有任何事实或逻辑上的矛盾。一阶迎风格式的推导与分析，包括其修正方程和稳定性特性，是偏微分方程数值分析中的一个基本练习。\n\n推导和分析按以下步骤进行。\n\n**1. 一阶迎风格式的推导**\n\n对于一个标量 $u(x, t)$ 和一个常速度 $a$，其一维线性平流方程由偏微分方程 (PDE) $\\frac{\\partial u}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0$ 给出，其中通量为 $F(u) = a u$。\n\n我们从这个守恒律的积分形式开始，将其应用于一个宽度为 $\\Delta x = x_{j+1/2} - x_{j-1/2}$ 的控制体（或网格单元）$C_j = [x_{j-1/2}, x_{j+1/2}]$，时间间隔为 $[t^n, t^{n+1}]$，时长为 $\\Delta t = t^{n+1} - t^n$。\n$$\n\\int_{x_{j-1/2}}^{x_{j+1/2}} u(x, t^{n+1}) dx - \\int_{x_{j-1/2}}^{x_{j+1/2}} u(x, t^{n}) dx = - \\int_{t^n}^{t^{n+1}} \\left[ F(u(x_{j+1/2}, t)) - F(u(x_{j-1/2}, t)) \\right] dt\n$$\n令 $u_j^n$ 为时刻 $t^n$ 时网格单元 $C_j$ 中标量的单元平均值：\n$$\nu_j^n = \\frac{1}{\\Delta x} \\int_{x_{j-1/2}}^{x_{j+1/2}} u(x, t^{n}) dx\n$$\n积分形式可以重写为单元平均值的形式：\n$$\nu_j^{n+1} \\Delta x - u_j^n \\Delta x = - \\int_{t^n}^{t^{n+1}} \\left[ F_{j+1/2}(t) - F_{j-1/2}(t) \\right] dt\n$$\n其中 $F_{j \\pm 1/2}(t)$ 表示单元界面上的通量。使用一阶显式欧拉时间积分，我们近似时间积分：\n$$\nu_j^{n+1} \\Delta x - u_j^n \\Delta x \\approx -\\Delta t \\left[ F_{j+1/2}^n - F_{j-1/2}^n \\right]\n$$\n这就得到了半离散有限体积更新公式：\n$$\nu_j^{n+1} = u_j^n - \\frac{\\Delta t}{\\Delta x} \\left[ F_{j+1/2}^n - F_{j-1/2}^n \\right]\n$$\n数值通量 $F_{j+1/2}^n$ 必须被恰当地选择。迎风原则规定，界面上的通量应由“迎风”方向的状态决定，即信息流动的来源方向。\n- 如果 $a  0$，流动方向从左到右。界面 $x_{j+1/2}$ 处的通量由单元 $j$ 的状态决定。因此，$F_{j+1/2} = a u_j$。\n- 如果 $a  0$，流动方向从右到左。界面 $x_{j+1/2}$ 处的通量由单元 $j+1$ 的状态决定。因此，$F_{j+1/2} = a u_{j+1}$。\n\n将这些通量代入更新公式：\n- 对于 $a  0$：\n$$\nu_j^{n+1} = u_j^n - \\frac{\\Delta t}{\\Delta x} \\left( a u_j^n - a u_{j-1}^n \\right) = u_j^n - \\frac{a \\Delta t}{\\Delta x} \\left( u_j^n - u_{j-1}^n \\right)\n$$\n- 对于 $a  0$：\n$$\nu_j^{n+1} = u_j^n - \\frac{\\Delta t}{\\Delta x} \\left( a u_{j+1}^n - a u_j^n \\right) = u_j^n - \\frac{a \\Delta t}{\\Delta x} \\left( u_{j+1}^n - u_j^n \\right)\n$$\n这些就是一阶迎风方法的离散更新方程。\n\n**2. 修正方程和数值扩散**\n\n为了量化主阶截断误差，我们通过将离散方程中每一项在点 $(x_j, t^n)$ 附近的泰勒级数展开代入，来进行修正方程分析。我们分析 $a  0$ 的情况。该格式为 $u_j^{n+1} = u_j^n - \\sigma(u_j^n - u_{j-1}^n)$，其中 $\\sigma = \\frac{a\\Delta t}{\\Delta x}$ 是 Courant 数。\n$$\nu(x_j, t^n+\\Delta t) = u_j^n - \\sigma \\left( u_j^n - u(x_j-\\Delta x, t^n) \\right)\n$$\n展开式为：\n$u(x_j, t^n+\\Delta t) = u + \\Delta t u_t + \\frac{\\Delta t^2}{2} u_{tt} + O(\\Delta t^3)$\n$u(x_j-\\Delta x, t^n) = u - \\Delta x u_x + \\frac{\\Delta x^2}{2} u_{xx} - \\frac{\\Delta x^3}{6} u_{xxx} + O(\\Delta x^4)$\n其中所有偏导数均在 $(x_j, t^n)$ 点求值。\n将这些展开式代入格式中：\n$$\nu + \\Delta t u_t + \\frac{\\Delta t^2}{2} u_{tt} + \\dots = u - \\frac{a \\Delta t}{\\Delta x} \\left( u - \\left( u - \\Delta x u_x + \\frac{\\Delta x^2}{2} u_{xx} + \\dots \\right) \\right)\n$$\n$$\n\\Delta t u_t + \\frac{\\Delta t^2}{2} u_{tt} + \\dots = - \\frac{a \\Delta t}{\\Delta x} \\left( \\Delta x u_x - \\frac{\\Delta x^2}{2} u_{xx} + \\dots \\right)\n$$\n两边除以 $\\Delta t$ 并化简：\n$$\nu_t + \\frac{\\Delta t}{2} u_{tt} + \\dots = -a u_x + \\frac{a \\Delta x}{2} u_{xx} + \\dots\n$$\n为了构建修正方程，我们必须用空间导数来表示时间导数。从主阶项可知，$u_t \\approx -a u_x$。求导可得 $u_{tt} \\approx -a u_{xt} = -a (u_t)_x \\approx -a (-a u_x)_x = a^2 u_{xx}$。将其代回：\n$$\nu_t + \\frac{\\Delta t}{2} (a^2 u_{xx}) = -a u_x + \\frac{a \\Delta x}{2} u_{xx} + \\dots\n$$\n重新整理得到修正后的偏微分方程：\n$$\nu_t + a u_x = \\left( \\frac{a \\Delta x}{2} - \\frac{a^2 \\Delta t}{2} \\right) u_{xx} + O(\\Delta x^2, \\Delta t^2)\n$$\n二阶空间导数 $u_{xx}$ 的系数即为数值扩散 $D_{\\text{num}}$：\n$$\nD_{\\text{num}} = \\frac{a \\Delta x}{2} \\left(1 - \\frac{a \\Delta t}{\\Delta x}\\right) \\quad (\\text{对于 } a  0)\n$$\n对 $a  0$ 进行类似分析可得：\n$$\nD_{\\text{num}} = -\\frac{a \\Delta x}{2} \\left(1 + \\frac{a \\Delta t}{\\Delta x}\\right) \\quad (\\text{对于 } a  0)\n$$\n我们可以使用 $a$ 的绝对值和 CFL 数 $\\nu = \\frac{|a| \\Delta t}{\\Delta x}$ 将它们合并为一个表达式。对于 $a  0$，$\\nu = \\frac{a \\Delta t}{\\Delta x}$ 且 $D_{\\text{num}} = \\frac{a \\Delta x}{2} (1 - \\nu) = \\frac{|a| \\Delta x}{2} (1 - \\nu)$。对于 $a  0$，$\\nu = \\frac{-a \\Delta t}{\\Delta x}$，因此 $\\frac{a \\Delta t}{\\Delta x} = -\\nu$，且 $D_{\\text{num}} = -\\frac{a \\Delta x}{2} (1 - \\nu) = \\frac{|a| \\Delta x}{2} (1 - \\nu)$。因此，通用表达式为：\n$$\nD_{\\text{num}} = \\frac{|a| \\Delta x}{2} \\left(1 - \\frac{|a| \\Delta t}{\\Delta x}\\right)\n$$\n\n**3. 傅里叶分析与稳定性**\n\n我们通过将单个傅里叶模态 $u_j^n = G^n \\hat{u}^0 e^{i k x_j}$ 代入离散格式来进行 von Neumann 稳定性分析，其中 $G$ 是放大因子，$k$ 是波数。\n对于 $a  0$，格式为 $u_j^{n+1} = u_j^n - \\sigma(u_j^n - u_{j-1}^n)$，其中 $\\sigma  0$。\n$$\nG e^{i k j \\Delta x} = e^{i k j \\Delta x} - \\sigma(e^{i k j \\Delta x} - e^{i k (j-1) \\Delta x})\n$$\n$$\nG = 1 - \\sigma(1 - e^{-i k \\Delta x})\n$$\n稳定性条件是对所有 $k$ 都有 $|G| \\le 1$。其模的平方为 $|G|^2 = 1 - 2\\sigma(1-\\sigma)(1-\\cos(k\\Delta x))$。要使其小于等于 $1$，我们需要 $2\\sigma(1-\\sigma)(1-\\cos(k\\Delta x)) \\ge 0$。由于 $1-\\cos(k\\Delta x) \\ge 0$，这要求 $\\sigma(1-\\sigma) \\ge 0$，对于 $\\sigma  0$ 这意味着 $0 \\le \\sigma \\le 1$。\n\n对于 $a  0$，格式为 $u_j^{n+1} = u_j^n - \\sigma(u_{j+1}^n - u_j^n)$，其中 $\\sigma  0$。\n$$\nG e^{i k j \\Delta x} = e^{i k j \\Delta x} - \\sigma(e^{i k (j+1) \\Delta x} - e^{i k j \\Delta x})\n$$\n$$\nG = 1 - \\sigma(e^{i k \\Delta x} - 1)\n$$\n其模的平方为 $|G|^2 = 1 + 2\\sigma(1+\\sigma)(1-\\cos(k\\Delta x))$。为了稳定性，我们需要 $\\sigma(1+\\sigma) \\le 0$。由于 $\\sigma  0$，这要求 $1+\\sigma \\ge 0$，即 $-1 \\le \\sigma \\le 0$。\n\n综合两种情况，一阶迎风方法的 Courant–Friedrichs–Lewy (CFL) 稳定性条件是 $|\\sigma| = \\frac{|a| \\Delta t}{\\Delta x} \\le 1$。\n\n当且仅当 CFL 条件满足时，数值扩散 $D_{\\text{num}} = \\frac{|a| \\Delta x}{2}(1 - \\frac{|a| \\Delta t}{\\Delta x})$ 是非负的 ($D_{\\text{num}} \\ge 0$)。一个正的数值扩散项 $D_{\\text{num}} u_{xx}$ 会耗散或衰减傅里叶模态。在修正方程中，波数为 $k$ 的模态的衰减率由因子 $e^{-D_{\\text{num}}k^2 t}$ 控制。这种衰减通过防止由离散误差引起的高频振荡的增长来稳定数值格式。如果违反 CFL 条件，$D_{\\text{num}}$ 会变为负值，导致“反扩散”，它会放大模态并引起指数级不稳定性。尖锐梯度的抹平是这种数值扩散的直接后果，因为尖锐特征由高波数模态组成，而这些模态被最强烈地衰减。\n\n由等效平流-扩散模型预测的单步振幅是 $\\exp(-D_{\\text{num}} k^2 \\Delta t)$。\n\n现在为给定的测试用例计算所要求的量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes numerical diffusion, amplification factor, and predicted damping\n    for the first-order upwind scheme for several test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Format: (a, delta_x, delta_t, k)\n    test_cases = [\n        # Case A: General stable case\n        (1.0, 1.0e-2, 6.0e-3, 50.0),\n        # Case B: CFL boundary\n        (1.0, 1.0e-2, 1.0e-2, 40.0),\n        # Case C: CFL violation, antidiffusion\n        (1.0, 1.0e-2, 1.2e-2, np.pi / 1.0e-2),\n        # Case D: Negative velocity\n        (-2.0, 2.0e-2, 5.0e-3, 10.0),\n    ]\n\n    results_flat = []\n    \n    for case in test_cases:\n        a, dx, dt, k = case\n        \n        # Calculate the CFL number (always non-negative)\n        cfl_number = np.abs(a) * dt / dx\n        \n        # 1. Calculate numerical diffusion D_num\n        # D_num = (|a|*dx/2) * (1 - |a|*dt/dx)\n        D_num = (np.abs(a) * dx / 2.0) * (1.0 - cfl_number)\n        \n        # 2. Calculate one-step amplification magnitude |G|\n        sigma = a * dt / dx  # Courant number (can be negative)\n        theta = k * dx       # Dimensionless wavenumber\n        \n        if a >= 0:\n            # G = 1 - sigma * (1 - exp(-i*theta)) for a >= 0\n            G = 1.0 - sigma * (1.0 - np.exp(-1j * theta))\n        else: # a  0\n            # G = 1 - sigma * (exp(i*theta) - 1) for a  0\n            G = 1.0 - sigma * (np.exp(1j * theta) - 1.0)\n            \n        G_magnitude = np.abs(G)\n        \n        # 3. Calculate predicted amplitude from the equivalent advection-diffusion model\n        # Amplitude = exp(-D_num * k^2 * dt)\n        predicted_amplitude = np.exp(-D_num * k**2 * dt)\n        \n        # Append the three results for the current case\n        results_flat.extend([D_num, G_magnitude, predicted_amplitude])\n\n    # Format the results for printing\n    # Each number must be a decimal float rounded to six places after the decimal point.\n    formatted_results = [f\"{val:.6f}\" for val in results_flat]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "最后，我们聚焦于扩散项的精确数值处理，特别是在材料属性（如热导率）随空间变化的实际工程场景中。本练习  将引导你构建一个二维稳态热传导问题的有限体积法(FVM)求解器。你将学习如何通过谐和平均处理变导热系数以保证通量的连续性和二阶精度，并运用“人造解方法”(Method of Manufactured Solutions)来系统地验证你的代码。这是一个将理论知识转化为可靠计算工具的综合性实践。",
            "id": "3959812",
            "problem": "考虑在二维空间中由传导热通量的散度定义的稳态热传导算子，即 $\\nabla \\cdot (k \\nabla T)$，其中 $T$ 是温度，$k$ 是热导率。从局部能量守恒定律和傅里叶热传导定律出发，为单位正方形域 $[0,1]\\times[0,1]$ 上的结构化笛卡尔网格推导一个二阶精度的有限体积法 (FVM) 离散格式，该格式具有单元中心的未知量和面法向通量。推导必须从控制体积上的积分守恒形式开始，并使用物理上一致的面通量定义。明确展示如何通过在内部面使用调和平均来处理 $k$ 的空间可变性，并解释如何处理狄利克雷边界条件以保持二阶空间精度。假设 $k$ 是一个关于位置的足够光滑的函数，并且除非另有说明，仅依赖于 $x$ 坐标。\n\n您的程序必须实现所推导的离散化方法，以求解偏微分方程\n$$\n\\nabla \\cdot \\left(k(x)\\nabla T(x,y)\\right) = f(x,y)\n$$\n在定义域 $x\\in[0,1]$, $y\\in[0,1]$上，且在所有边界上均服从狄利克雷边界条件 $T(x,y) = T_{\\text{exact}}(x,y)$。使用人造解法，其中\n$$\nT_{\\text{exact}}(x,y) = \\sin(\\pi x)\\sin(\\pi y),\n$$\n并选择 $k(x) = k_0 + \\alpha x$，其中常数 $k_0 \\ge 0$ 和 $\\alpha \\ge 0$。根据精确解 $T_{\\text{exact}}(x,y)$ 和选定的 $k(x)$ 推导出相应的源项 $f(x,y)$，并使用中点法则来近似每个控制体积 $\\Omega_P$ 上的积分 $\\int_{\\Omega_P} f \\, dV$。网格应为均匀网格，在 $x$ 方向有 $N_x$ 个单元，在 $y$ 方向有 $N_y$ 个单元，单元宽度分别为 $\\Delta x = 1/N_x$ 和 $\\Delta y = 1/N_y$。在内部面实现 $k$ 的调和平均以计算通量的面电导率，并通过消除虚拟单元值来处理狄利克雷边界，以获得二阶一致的面系数和源项。组装得到的稀疏线性系统并求解单元中心温度。\n\n计算误差，即数值解 $T_h$ 和精确解 $T_{\\text{exact}}$ 之差的离散 $\\ell^2$ 范数，\n$$\n\\|e\\|_2 = \\left(\\sum_{P} (T_h(P) - T_{\\text{exact}}(P))^2 \\, \\Delta x \\, \\Delta y \\right)^{1/2},\n$$\n并以开尔文为单位报告。同时，对于一对网格 $(N_x,N_y)$ 和 $(2N_x,2N_y)$，使用以下公式计算观测到的精度阶 $p$：\n$$\np = \\frac{\\ln\\left(\\|e\\|_2^{\\text{coarse}}/\\|e\\|_2^{\\text{fine}}\\right)}{\\ln(2)},\n$$\n该值为无量纲，且必须以小数形式报告。\n\n测试套件和要求输出：\n实现并运行以下四个测试用例：\n- 用例 1（恒定电导率，一般精度）：$k_0 = 2$，$\\alpha = 0$，$N_x = 40$，$N_y = 40$。输出离散 $\\ell^2$ 误差（单位：开尔文）。\n- 用例 2（线性变化电导率，一般精度）：$k_0 = 1$，$\\alpha = 1$，$N_x = 40$，$N_y = 40$。输出离散 $\\ell^2$ 误差（单位：开尔文）。\n- 用例 3（线性变化电导率，粗网格边缘情况）：$k_0 = 1$，$\\alpha = 1$，$N_x = 8$，$N_y = 8$。输出离散 $\\ell^2$ 误差（单位：开尔文）。\n- 用例 4（线性变化电导率，细化时的观测阶）：$k_0 = 1$，$\\alpha = 1$，粗网格 $N_x = 20$，$N_y = 20$，细网格 $N_x = 40$，$N_y = 40$。以小数形式输出观测阶 $p$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按上述用例顺序排列，例如 $[e_1,e_2,e_3,p_4]$，其中 $e_i$ 是以开尔文为单位的误差，$p_4$ 是无量纲的。不应打印任何单位；将 $e_i$ 解释为开尔文，$p_4$ 解释为小数。角度（如有）必须以弧度为单位。百分比（如有）必须表示为小数。\n\n科学和算法要求：\n- 从能量守恒和傅里叶定律开始推导，而不是从已有的离散公式开始。\n- 在均匀笛卡尔网格上通过中心差分实现二阶空间精度。\n- 在内部面使用 $k$ 的调和平均。\n- 使用半单元距离的一致性狄利克雷边界处理方法以保持二阶精度。\n- 组装并求解得到的稀疏线性系统。\n- 确保情景在科学上是合理且自洽的。\n\n最终程序必须是完整且可运行的，使用指定的执行环境，不需要外部输入，并产生确切要求的单行输出格式。",
            "solution": "该问题要求针对具有空间可变热导率 $k(x)$ 的稳态热传导方程，在二维笛卡尔网格上推导并实现一个二阶精度的有限体积法 (FVM)。推导必须源于能量守恒和傅里叶热传导定律的基本原理。\n\n带有源项 $f$ 的稳态热传导的控制偏微分方程 (PDE) 为：\n$$ \\nabla \\cdot \\left(k \\nabla T\\right) = f $$\n其中 $T$ 是温度，$k$ 是热导率，$f$ 是体积热源密度。\n\nFVM 从守恒定律的积分形式开始。将 PDE 在任意控制体积 (CV) $\\Omega_P$ 上积分，得到：\n$$ \\int_{\\Omega_P} \\nabla \\cdot \\left(k \\nabla T\\right) \\, dV = \\int_{\\Omega_P} f \\, dV $$\n对左侧应用散度定理，将散度的体积积分转换成通量在控制体积边界 $\\partial \\Omega_P$ 上的面积分：\n$$ \\oint_{\\partial \\Omega_P} (k \\nabla T) \\cdot \\mathbf{n} \\, dS = \\int_{\\Omega_P} f \\, dV $$\n此处，$\\mathbf{n}$ 是指向外部的单位法向量，作用于面积元 $dS$。项 $-(k \\nabla T)$ 是傅里叶定律定义的热通量矢量 $\\mathbf{q}$。因此，该方程表示跨越控制体积边界的热通量与内部产生的热量之间的平衡。\n\n现在，我们在由矩形单元组成的结构化笛卡尔网格上对此积分方程进行离散化。考虑一个通用单元或控制体积 $\\Omega_P$，其中心位于点 $P(x_P, y_P)$，尺寸为 $\\Delta x \\times \\Delta y$，体积为 $V_P = \\Delta x \\Delta y$（假设单位深度）。边界 $\\partial \\Omega_P$ 由四个面组成：东 ($e$)、西 ($w$)、北 ($n$) 和南 ($s$)。积分平衡方程变为这四个面上的通量之和：\n$$ F_e - F_w + F_n - F_s = \\bar{f}_P V_P $$\n其中 $F_f$ 表示穿过面 $f$ 的总热率，$\\bar{f}_P$ 是控制体积上的平均源项。总热率是面法向通量密度 $q_f$ 与面面积 $A_f$ 的乘积。对于我们的二维网格，面积为 $A_e = A_w = \\Delta y$ 和 $A_n = A_s = \\Delta x$。平衡方程为：\n$$ (q_e A_e - q_w A_w) + (q_n A_n - q_s A_s) = (q_e - q_w)\\Delta y + (q_n - q_s)\\Delta x = \\bar{f}_P \\Delta x \\Delta y $$\n问题指定使用中点法则来近似源项积分，因此 $\\bar{f}_P \\approx f(x_P, y_P)$。通量 $q_f$ 是在面中心处计算的热通量矢量垂直于面的分量。使用傅里叶定律，我们近似这些通量。例如，在东面：\n$$ q_e = (-k\\nabla T)_e \\cdot \\mathbf{i} \\approx -k_e \\left(\\frac{\\partial T}{\\partial x}\\right)_e $$\n其中 $k_e$ 是东面的热导率。为保持二阶精度，面上的梯度使用相邻单元中心之间的中心差分来近似。令 $P$ 表示当前单元的中心，$E, W, N, S$ 分别表示其东、西、北、南邻居的中心。梯度为：\n$$ \\left(\\frac{\\partial T}{\\partial x}\\right)_e \\approx \\frac{T_E - T_P}{\\Delta x}, \\quad \\left(\\frac{\\partial T}{\\partial y}\\right)_n \\approx \\frac{T_N - T_P}{\\Delta y} $$\n因此，穿过单元 $P$ 四个面的通量近似为：\n$$ q_e \\approx -k_e \\frac{T_E - T_P}{\\Delta x}, \\quad q_w \\approx -k_w \\frac{T_P - T_W}{\\Delta x} $$\n$$ q_n \\approx -k_n \\frac{T_N - T_P}{\\Delta y}, \\quad q_s \\approx -k_s \\frac{T_P - T_S}{\\Delta y} $$\n\n对于空间可变的热导率 $k(x)$，必须适当地评估面电导率 $k_f$。对于垂直于变化方向的面（东面和西面），使用单元中心电导率的简单算术平均将导致一阶精度。为确保二阶精度和物理一致性（通量和温度的连续性），使用调和平均。这等效于将跨面的传热建模为与面相邻的两个半单元对应的一系列热阻。\n对于单元 $P$ 和 $E$ 之间的内部东面：\n$$ k_e = \\frac{2 k(x_P) k(x_E)}{k(x_P) + k(x_E)} $$\n类似地，对于单元 $W$ 和 $P$ 之间的西面：\n$$ k_w = \\frac{2 k(x_W) k(x_P)}{k(x_W) + k(x_P)} $$\n对于北面和南面，它们与恒定的 $x$ 坐标对齐，热导率 $k(x)$ 沿每个面是恒定的。因此，不需要平均：\n$$ k_n = k_s = k(x_P) $$\n将这些通量近似值代入平衡方程，得到内部单元 $P$ 的离散方程：\n$$ -k_e \\frac{T_E - T_P}{\\Delta x} \\Delta y - \\left(-k_w \\frac{T_P - T_W}{\\Delta x}\\right) \\Delta y - k_n \\frac{T_N - T_P}{\\Delta y} \\Delta x - \\left(-k_s \\frac{T_P - T_S}{\\Delta y}\\right) \\Delta x = f(x_P, y_P) \\Delta x \\Delta y $$\n整理成标准的线性代数形式 $a_P T_P = a_E T_E + a_W T_W + a_N T_N + a_S T_S + b_P$：\n$$ \\left( k_e \\frac{\\Delta y}{\\Delta x} + k_w \\frac{\\Delta y}{\\Delta x} + k_n \\frac{\\Delta x}{\\Delta y} + k_s \\frac{\\Delta x}{\\Delta y} \\right) T_P = \\left( k_e \\frac{\\Delta y}{\\Delta x} \\right) T_E + \\left( k_w \\frac{\\Delta y}{\\Delta x} \\right) T_W + \\left( k_n \\frac{\\Delta x}{\\Delta y} \\right) T_N + \\left( k_s \\frac{\\Delta x}{\\Delta y} \\right) T_S + f_P \\Delta x \\Delta y $$\n这里，我们定义系数：$a_E = k_e \\frac{\\Delta y}{\\Delta x}$，$a_W = k_w \\frac{\\Delta y}{\\Delta x}$，$a_N = k_n \\frac{\\Delta x}{\\Delta y}$，$a_S = k_s \\frac{\\Delta x}{\\Delta y}$，以及中心系数 $a_P = a_E + a_W + a_N + a_S$。源项贡献为 $b_P = f(x_P, y_P) \\Delta x \\Delta y$。\n\n对于邻近狄利克雷边界的单元，必须修改处理方式以保持二阶精度。考虑一个位于西边界（$x=0$）的单元 $P$。该单元的西面位于边界上，那里的温度 $T_b$ 是已知的。从单元中心 $P$ 到此边界的距离是 $\\Delta x/2$。西面的梯度使用单元中心值和边界值来近似：\n$$ \\left(\\frac{\\partial T}{\\partial x}\\right)_w \\approx \\frac{T_P - T_{b,w}}{\\Delta x / 2} $$\n其中 $T_{b,w} = T_{\\text{exact}}(0, y_P)$。通过西面的通量为 $q_w = -k_w (\\frac{T_P - T_{b,w}}{\\Delta x/2})$，其中 $k_w = k(0)$ 是边界处的热导率。平衡方程中的项是 $-q_w \\Delta y$。西面的系数变为 $a_W = k(0) \\frac{\\Delta y}{\\Delta x/2} = 2k(0)\\frac{\\Delta y}{\\Delta x}$。这修改了边界单元的线性方程：项 $a_W T_W$ 被一个加到源项上的已知值所取代。西边界上单元 $P$ 的最终方程为：\n$$ (a_E + a_W + a_N + a_S) T_P - a_E T_E - a_N T_N - a_S T_S = b_P + a_W T_{b,w} $$\n此过程类似地应用于所有其他边界（东、北、南），调整相应边界面的系数和源项。这种使用半单元距离的“虚拟单元”消除法确保了边界处的梯度近似是二阶的，从而保持了格式的整体精度。\n\n最后，我们使用人造解法来定义源项 $f(x,y)$。给定 $T_{\\text{exact}}(x,y) = \\sin(\\pi x)\\sin(\\pi y)$ 和 $k(x) = k_0 + \\alpha x$，我们计算 $f(x,y) = \\nabla \\cdot (k \\nabla T_{\\text{exact}})$。\n由于 $\\nabla T_{\\text{exact}} = \\langle \\pi\\cos(\\pi x)\\sin(\\pi y), \\pi\\sin(\\pi x)\\cos(\\pi y) \\rangle$，我们有：\n$$ f(x,y) = \\frac{\\partial}{\\partial x}\\left((k_0+\\alpha x)\\pi\\cos(\\pi x)\\sin(\\pi y)\\right) + \\frac{\\partial}{\\partial y}\\left((k_0+\\alpha x)\\pi\\sin(\\pi x)\\cos(\\pi y)\\right) $$\n$$ f(x,y) = \\pi\\sin(\\pi y)\\left[\\alpha\\cos(\\pi x) - (k_0+\\alpha x)\\pi\\sin(\\pi x)\\right] + (k_0+\\alpha x)\\pi\\sin(\\pi x)\\left[-\\pi\\sin(\\pi y)\\right] $$\n$$ f(x,y) = \\pi \\alpha \\cos(\\pi x)\\sin(\\pi y) - 2\\pi^2 (k_0 + \\alpha x) \\sin(\\pi x)\\sin(\\pi y) $$\n此函数用于计算每个单元的源项 $b_P$。为所有 $N_x \\times N_y$ 个单元组装方程，会得到一个稀疏线性系统 $A\\mathbf{T} = \\mathbf{b}$，可以求解得到单元中心温度矢量 $\\mathbf{T}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve_pde(Nx, Ny, k0, alpha):\n    \"\"\"\n    Solves the 2D steady heat conduction equation using a cell-centered FVM.\n\n    Args:\n        Nx (int): Number of cells in the x-direction.\n        Ny (int): Number of cells in the y-direction.\n        k0 (float): Constant term in thermal conductivity k(x).\n        alpha (float): Linear coefficient in thermal conductivity k(x).\n\n    Returns:\n        float: The discrete l2-norm of the error.\n    \"\"\"\n    dx = 1.0 / Nx\n    dy = 1.0 / Ny\n    x_centers = (np.arange(Nx) + 0.5) * dx\n    y_centers = (np.arange(Ny) + 0.5) * dy\n    xx, yy = np.meshgrid(x_centers, y_centers, indexing='xy')\n\n    # Define analytical functions based on the method of manufactured solutions\n    k_func = lambda x: k0 + alpha * x\n    T_exact_func = lambda x, y: np.sin(np.pi * x) * np.sin(np.pi * y)\n    \n    def f_func(x, y):\n        pi = np.pi\n        term1 = pi * alpha * np.cos(pi * x) * np.sin(pi * y)\n        term2 = -2 * pi**2 * (k0 + alpha * x) * np.sin(pi * x) * np.sin(pi * y)\n        return term1 + term2\n\n    N_total = Nx * Ny\n    A = lil_matrix((N_total, N_total))\n    b = np.zeros(N_total)\n\n    # Assemble the sparse matrix A and the source vector b\n    for j in range(Ny):  # y-index\n        for i in range(Nx):  # x-index\n            p = i + j * Nx  # 1D index, mapping (i,j) -> p\n            \n            x_p, y_p = x_centers[i], y_centers[j]\n            \n            # Integrated source term (midpoint rule)\n            b[p] = f_func(x_p, y_p) * dx * dy\n            \n            a_P = 0.0  # Diagonal coefficient\n            \n            # West face\n            if i > 0:  # Interior face\n                x_w_center = x_centers[i-1]\n                k_p = k_func(x_p)\n                k_w_cell = k_func(x_w_center)\n                k_w_face = 2.0 * k_p * k_w_cell / (k_p + k_w_cell) # Harmonic mean\n                a_W = k_w_face * dy / dx\n                A[p, p - 1] = -a_W\n                a_P += a_W\n            else:  # Boundary face (x=0)\n                k_w_face = k_func(0.0)\n                a_W = k_w_face * dy / (dx / 2.0)\n                a_P += a_W\n                T_b = T_exact_func(0.0, y_p)\n                b[p] += a_W * T_b\n                \n            # East face\n            if i  Nx - 1:  # Interior face\n                x_e_center = x_centers[i+1]\n                k_p = k_func(x_p)\n                k_e_cell = k_func(x_e_center)\n                k_e_face = 2.0 * k_p * k_e_cell / (k_p + k_e_cell) # Harmonic mean\n                a_E = k_e_face * dy / dx\n                A[p, p + 1] = -a_E\n                a_P += a_E\n            else:  # Boundary face (x=1)\n                k_e_face = k_func(1.0)\n                a_E = k_e_face * dy / (dx / 2.0)\n                a_P += a_E\n                T_b = T_exact_func(1.0, y_p)\n                b[p] += a_E * T_b\n                \n            # South face\n            if j > 0:  # Interior face\n                k_s_face = k_func(x_p) # k is constant along y-normal face\n                a_S = k_s_face * dx / dy\n                A[p, p - Nx] = -a_S\n                a_P += a_S\n            else:  # Boundary face (y=0)\n                k_s_face = k_func(x_p)\n                a_S = k_s_face * dx / (dy / 2.0)\n                a_P += a_S\n                T_b = T_exact_func(x_p, 0.0)\n                b[p] += a_S * T_b\n\n            # North face\n            if j  Ny - 1:  # Interior face\n                k_n_face = k_func(x_p)\n                a_N = k_n_face * dx / dy\n                A[p, p + Nx] = -a_N\n                a_P += a_N\n            else:  # Boundary face (y=1)\n                k_n_face = k_func(x_p)\n                a_N = k_n_face * dx / (dy / 2.0)\n                a_P += a_N\n                T_b = T_exact_func(x_p, 1.0)\n                b[p] += a_N * T_b\n                \n            A[p, p] = a_P\n\n    # Solve the linear system\n    A_csr = A.tocsr()\n    T_numerical_flat = spsolve(A_csr, b)\n    T_numerical = T_numerical_flat.reshape((Ny, Nx))\n    \n    # Calculate discrete l2-norm of the error\n    T_exact_grid = T_exact_func(xx, yy)\n    error = np.sqrt(np.sum((T_numerical - T_exact_grid)**2 * dx * dy))\n    \n    return error\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    test_cases = [\n        {'id': 1, 'k0': 2.0, 'alpha': 0.0, 'Nx': 40, 'Ny': 40, 'type': 'error'},\n        {'id': 2, 'k0': 1.0, 'alpha': 1.0, 'Nx': 40, 'Ny': 40, 'type': 'error'},\n        {'id': 3, 'k0': 1.0, 'alpha': 1.0, 'Nx': 8, 'Ny': 8, 'type': 'error'},\n        {'id': 4, 'k0': 1.0, 'alpha': 1.0, 'Nx_coarse': 20, 'Ny_coarse': 20, 'type': 'order'}\n    ]\n\n    results = []\n    \n    # Case 1\n    case1 = test_cases[0]\n    e1 = solve_pde(case1['Nx'], case1['Ny'], case1['k0'], case1['alpha'])\n    results.append(e1)\n    \n    # Case 2\n    case2 = test_cases[1]\n    e2 = solve_pde(case2['Nx'], case2['Ny'], case2['k0'], case2['alpha'])\n    results.append(e2)\n\n    # Case 3\n    case3 = test_cases[2]\n    e3 = solve_pde(case3['Nx'], case3['Ny'], case3['k0'], case3['alpha'])\n    results.append(e3)\n\n    # Case 4\n    case4 = test_cases[3]\n    e_coarse = solve_pde(case4['Nx_coarse'], case4['Ny_coarse'], case4['k0'], case4['alpha'])\n    e_fine = solve_pde(case4['Nx_coarse'] * 2, case4['Ny_coarse'] * 2, case4['k0'], case4['alpha'])\n    p4 = np.log(e_coarse / e_fine) / np.log(2.0)\n    results.append(p4)\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}