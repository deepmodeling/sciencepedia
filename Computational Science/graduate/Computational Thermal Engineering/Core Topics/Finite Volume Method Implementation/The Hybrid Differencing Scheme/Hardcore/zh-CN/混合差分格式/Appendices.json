{
    "hands_on_practices": [
        {
            "introduction": "混合格式的核心思想是在对流和扩散之间取得平衡。本练习将通过一个经典的一维对流-扩散问题，揭示中心差分格式（CDS）在对流占主导（即高佩克莱数 $Pe$）时可能产生的非物理振荡。通过计算 ，您将亲手验证中心差分如何违反有界性原则，并理解混合格式为何以及如何通过切换到迎风格式来修正这一根本问题，从而确保解的物理真实性。",
            "id": "3991588",
            "problem": "考虑一个横截面积为 $\\,A=1\\,$、网格宽度为 $\\,\\Delta x = 1\\,$ 的均匀管道中，无量纲温度场 $\\,\\phi(x)\\,$ 的一维稳态对流扩散问题。其中热扩散系数 $\\,\\Gamma = 1\\,$ 为常数，密度 $\\,\\rho\\,$ 为常数，轴向速度 $\\,u>0\\,$ 为均匀速度。边界值设定为西边界处 $\\,\\phi(0)=0\\,$，东边界处 $\\,\\phi(\\Delta x)=1\\,$。无体积源项。定义质量通量 $\\,F \\equiv \\rho u A\\,$ 和扩散传导系数 $\\,D \\equiv \\Gamma A/\\Delta x\\,$，因此网格贝克莱数（Peclet number）为 $\\mathrm{Pe} \\equiv F/D$。在此设置下，取 $\\,D=1\\,$ 和 $\\,F=3\\,$，因此 $\\,\\mathrm{Pe}=3$。\n\n使用有限体积法 (FVM)，对单个内部控制体积分稳态守恒定律 $\\,\\frac{d}{dx}\\!\\left(\\rho u \\phi - \\Gamma \\frac{d\\phi}{dx}\\right)=0\\,$，并将离散平衡方程写成规范形式 $\\,a_P \\phi_P = a_W \\phi_W + a_E \\phi_E\\,$。其中 $\\,\\phi_W=0\\,$ 和 $\\,\\phi_E=1\\,$ 分别是控制体西侧和东侧相邻的、邻近边界的节点值，而 $\\,\\phi_P\\,$ 是待求的内部节点值。\n\n(a) 通过推导中心差分格式 (CDS) 下的系数 $\\,a_W\\,$, $\\,a_E\\,$ 和 $\\,a_P\\,$ 并计算 $\\,\\phi_P\\,$，为 $\\,\\mathrm{Pe}=3\\,$ 时中心差分格式 (CDS) 不满足有界性构造一个反例。\n\n(b) 展示混合差分格式如何在 $\\,\\mathrm{Pe}=3\\,$ 时恢复有界性。将对流面值设为迎风格式（即，对于正速度 $\\,u\\,$，取 $\\,\\phi_e=\\phi_P\\,$ 和 $\\,\\phi_w=\\phi_W\\,$），推导相应的系数，并计算混合格式下的 $\\,\\phi_P\\,$。\n\n将最终的数对 $\\,\\left(\\phi_P^{\\mathrm{CDS}},\\,\\phi_P^{\\mathrm{hybrid}}\\right)\\,$ 以行矩阵的精确形式表示。无需四舍五入。答案是无量纲的。",
            "solution": "该问题要求使用有限体积法 (FVM) 求解一维稳态对流扩散问题中的一个内部节点值 $\\phi_P$，首先使用中心差分格式 (CDS)，然后使用混合差分格式。\n\n控制守恒定律为：\n$$\n\\frac{d}{dx}\\!\\left(\\rho u \\phi - \\Gamma \\frac{d\\phi}{dx}\\right) = 0\n$$\n其中 $\\rho$ 是密度， $u$ 是速度， $\\phi$ 是无量纲温度， $\\Gamma$ 是热扩散系数。所有这些都是常数，且速度 $u$ 为正。\n\n我们应用有限体积法 (FVM)，将此方程在一个以内部节点 P 为中心的单一控制体 (CV) 上积分。该控制体从西侧面 'w' 延伸到东侧面 'e'。控制体的宽度为 $\\Delta x$。\n$$\n\\int_{w}^{e} \\frac{d}{dx}\\!\\left(\\rho u \\phi - \\Gamma \\frac{d\\phi}{dx}\\right) A \\, dx = 0\n$$\n其中 $A$ 是恒定的横截面积。积分结果为：\n$$\n\\left[ \\left(\\rho u \\phi - \\Gamma \\frac{d\\phi}{dx}\\right)A \\right]_{w}^{e} = 0\n$$\n这可以写成在各个面上的总通量平衡：\n$$\n\\left( (\\rho u A) \\phi_e - \\left(\\Gamma A \\frac{d\\phi}{dx}\\right)_e \\right) - \\left( (\\rho u A) \\phi_w - \\left(\\Gamma A \\frac{d\\phi}{dx}\\right)_w \\right) = 0\n$$\n使用已定义的质量通量 $F \\equiv \\rho u A$ 和扩散传导系数 $D \\equiv \\Gamma A/\\Delta x$，方程变为：\n$$\n\\left( F \\phi_e - D \\Delta x \\left(\\frac{d\\phi}{dx}\\right)_e \\right) - \\left( F \\phi_w - D \\Delta x \\left(\\frac{d\\phi}{dx}\\right)_w \\right) = 0\n$$\n扩散项使用相邻节点 W 和 E 的节点值进行近似。节点之间的距离是均匀的，等于控制体宽度 $\\Delta x$。\n在东侧面 'e'（P 和 E 的中点）的梯度近似为：\n$$\n\\left(\\frac{d\\phi}{dx}\\right)_e \\approx \\frac{\\phi_E - \\phi_P}{\\Delta x}\n$$\n在西侧面 'w'（W 和 P 的中点）的梯度近似为：\n$$\n\\left(\\frac{d\\phi}{dx}\\right)_w \\approx \\frac{\\phi_P - \\phi_W}{\\Delta x}\n$$\n将这些近似值代入通量平衡方程，得到：\n$$\n\\left( F \\phi_e - D (\\phi_E - \\phi_P) \\right) - \\left( F \\phi_w - D (\\phi_P - \\phi_W) \\right) = 0\n$$\n该方程可以重排，以组合对流项和扩散项：\n$$\nF(\\phi_e - \\phi_w) + D(\\phi_P - \\phi_W) - D(\\phi_E - \\phi_P) = 0\n$$\n这是通用的离散方程。其具体形式取决于面值 $\\phi_e$ 和 $\\phi_w$ 的近似方式。问题设置为 $A=1$，$\\Delta x=1$，$\\Gamma=1$，这得出 $D = \\frac{\\Gamma A}{\\Delta x} = \\frac{1 \\cdot 1}{1} = 1$。给定的质量通量为 $F=3$。网格贝克莱数为 $\\mathrm{Pe} \\equiv F/D = 3/1 = 3$。节点边界值为 $\\phi_W=0$ 和 $\\phi_E=1$。\n\n(a) 中心差分格式 (CDS)\n\n对于 CDS，控制体面上的 $\\phi$ 值取其两侧节点的线性插值：\n$$\n\\phi_e = \\frac{\\phi_P + \\phi_E}{2} \\quad \\text{and} \\quad \\phi_w = \\frac{\\phi_W + \\phi_P}{2}\n$$\n将这些代入通用离散方程：\n$$\nF\\left(\\frac{\\phi_P + \\phi_E}{2} - \\frac{\\phi_W + \\phi_P}{2}\\right) + D(\\phi_P - \\phi_W) - D(\\phi_E - \\phi_P) = 0\n$$\n$$\nF\\left(\\frac{\\phi_E - \\phi_W}{2}\\right) + 2D\\phi_P - D\\phi_W - D\\phi_E = 0\n$$\n为了将其写成规范形式 $a_P \\phi_P = a_W \\phi_W + a_E \\phi_E$，我们重排这些项：\n$$\n(2D)\\phi_P = \\left(D + \\frac{F}{2}\\right)\\phi_W + \\left(D - \\frac{F}{2}\\right)\\phi_E\n$$\n与 $a_P \\phi_P = a_W \\phi_W + a_E \\phi_E$ 比较，系数为：\n$$\na_W = D + \\frac{F}{2}\n$$\n$$\na_E = D - \\frac{F}{2}\n$$\n$$\na_P = 2D\n$$\n使用给定值 $D=1$ 和 $F=3$：\n$$\na_W = 1 + \\frac{3}{2} = 2.5\n$$\n$$\na_E = 1 - \\frac{3}{2} = -0.5\n$$\n$$\na_P = 2(1) = 2\n$$\n离散方程为 $2\\phi_P = 2.5\\phi_W - 0.5\\phi_E$。\n代入边界值 $\\phi_W=0$ 和 $\\phi_E=1$：\n$$\n2\\phi_P = 2.5(0) - 0.5(1) = -0.5\n$$\n$$\n\\phi_P^{\\mathrm{CDS}} = -\\frac{0.5}{2} = -0.25\n$$\n边界值在 $[0, 1]$ 范围内，但计算出的内部值 $\\phi_P^{\\mathrm{CDS}} = -0.25$ 超出了这个范围。这个不符合物理规律的结果是有界性原则的一个反例。其原因是系数 $a_E = -0.5$ 为负值，这种情况发生在贝克莱数 $\\mathrm{Pe} = 3$ 大于 2 时。\n\n(b) 混合差分格式\n\n混合格式在 $|\\mathrm{Pe}| \\le 2$ 时使用中心差分格式，在 $|\\mathrm{Pe}| > 2$ 时使用一阶迎风格式。由于 $\\mathrm{Pe}=3$，因此使用迎风格式。对于正速度 ($u>0$)，流动方向是从左到右（从 W 到 E）。迎风格式在单元面上的对流值取自上游节点：\n$$\n\\phi_e = \\phi_P \\quad \\text{and} \\quad \\phi_w = \\phi_W\n$$\n将这些代入通用离散方程：\n$$\nF(\\phi_P - \\phi_W) + D(\\phi_P - \\phi_W) - D(\\phi_E - \\phi_P) = 0\n$$\n重排为规范形式 $a_P \\phi_P = a_W \\phi_W + a_E \\phi_E$：\n$$\n(F+D+D)\\phi_P = (F+D)\\phi_W + D\\phi_E\n$$\n系数为：\n$$\na_W = F+D\n$$\n$$\na_E = D\n$$\n$$\na_P = F+2D\n$$\n使用给定值 $D=1$ 和 $F=3$：\n$$\na_W = 3 + 1 = 4\n$$\n$$\na_E = 1\n$$\n$$\na_P = 3 + 2(1) = 5\n$$\n注意，所有系数均为正，这是保证有界性的一个充分条件。离散方程为 $5\\phi_P = 4\\phi_W + 1\\phi_E$。\n代入边界值 $\\phi_W=0$ 和 $\\phi_E=1$：\n$$\n5\\phi_P = 4(0) + 1(1) = 1\n$$\n$$\n\\phi_P^{\\mathrm{hybrid}} = \\frac{1}{5} = 0.2\n$$\n该值位于边界条件 $[0, 1]$ 的范围内，表明混合（迎风）格式对于这种高贝克莱数流动恢复了有界性。\n\n最终的数对是 $(\\phi_P^{\\mathrm{CDS}}, \\phi_P^{\\mathrm{hybrid}}) = (-0.25, 0.2)$，其精确分数形式为 $(-\\frac{1}{4}, \\frac{1}{5})$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{1}{4}  \\frac{1}{5} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在理解了混合格式的必要性之后，下一个关键问题是评估其精度。理想的离散格式应该能精确地再现物理过程，而对于一维稳态对流-扩散问题，我们恰好可以推导出其解析解。这个练习  将引导您从控制方程出发，推导“指数格式”——一种基于解析解的精确离散方法，并将其与混合格式进行对比。通过这个过程，您将清晰地看到混合格式是如何作为指数格式的一种分段线性近似，从而深刻理解其在引入数值扩散以换取稳定性方面的本质。",
            "id": "3991591",
            "problem": "一维稳态被动标量 $\\,\\phi(x)\\,$ 的对流-扩散发生在长度为 $\\,L\\,$ 的通道中，其中密度 $\\,\\rho>0\\,$、速度 $\\,u>0\\,$ 和扩散系数 $\\,\\Gamma>0\\,$ 均为常数。边界条件为狄利克雷 (Dirichlet) 条件：$\\,\\phi(0)=\\phi_{L}\\,$ 和 $\\,\\phi(L)=\\phi_{R}\\,$。控制方程由 $\\,\\phi\\,$ 的稳态守恒和菲克扩散 (Fickian diffusion) 得出：\n$$\n\\frac{d}{dx}\\left(-\\Gamma\\,\\frac{d\\phi}{dx}+\\rho\\,u\\,\\phi\\right)=0,\n$$\n该方程可简化为一个常系数常微分方程。\n\n第1部分：从上述守恒声明和菲克定律 (Fick’s law) 出发，推导在 $\\,x\\in[0,L]\\,$ 区间内关于边界值 $\\,\\phi_{L}\\,$ 和 $\\,\\phi_{R}\\,$、$\\rho$、$u$、$\\Gamma$ 和 $L$ 的闭式精确解 $\\,\\phi(x)\\,$。指出在解中自然出现的域佩克莱数 (domain Péclet number) $\\,\\mathrm{Pe}:=\\rho\\,u\\,L/\\Gamma\\,$。\n\n第2部分：考虑一个均匀有限体积法 (FVM) 离散化，其中节点 $\\,P\\,$ 和 $\\,E\\,$ 分别位于 $\\,x_{P}\\,$ 和 $\\,x_{E}=x_{P}+\\Delta x\\,$，东侧面位于 $\\,x_{f}=x_{P}+\\Delta x/2\\,$。将第1部分的精确解限制在子区间 $[x_{P},x_{E}]$ 内，局部边界数据为 $\\,\\phi(x_{P})=\\phi_{P}\\,$ 和 $\\,\\phi(x_{E})=\\phi_{E}\\,$。使用此受限的精确解，推导东侧界面上指数格式的界面插值，其线性混合形式为\n$$\n\\phi_{f}^{\\mathrm{exp}} \\;=\\; \\phi_{P} \\;+\\; w_{\\mathrm{exp}}(\\mathrm{Pe}_{\\Delta})\\,\\bigl(\\phi_{E}-\\phi_{P}\\bigr),\n$$\n并获得关于网格佩克莱数 (cell Péclet number) $\\,\\mathrm{Pe}_{\\Delta}:=\\rho\\,u\\,\\Delta x/\\Gamma\\,$ 的闭式权重 $\\,w_{\\mathrm{exp}}(\\mathrm{Pe}_{\\Delta})\\,$。\n\n第3部分：在混合差分格式 (HDS) 中，为了保持有界性，界面值 $\\,\\phi_{f}^{\\mathrm{HDS}}\\,$ 对扩散主导的网格选择中心差分，对对流主导的网格选择迎风差分。对于 $\\,u>0\\,$，根据 $\\,\\mathrm{Pe}_{\\Delta}\\,$ 绝对值的标准 HDS 切换准则，用 $\\,\\phi_{P}\\,$ 和 $\\,\\phi_{E}\\,$ 将 $\\,\\phi_{f}^{\\mathrm{HDS}}\\,$ 表示为 $\\,\\mathrm{Pe}_{\\Delta}\\,$ 的函数。\n\n第4部分：使用您在第2部分和第3部分得到的结果，推导东侧界面上差值的单一闭式解析表达式\n$$\n\\Delta(\\mathrm{Pe}_{\\Delta}) \\;:=\\; \\phi_{f}^{\\mathrm{exp}} \\;-\\; \\phi_{f}^{\\mathrm{HDS}}\n$$\n该表达式仅用 $\\,\\phi_{P}\\,$、$\\,\\phi_{E}\\,$ 和 $\\,\\mathrm{Pe}_{\\Delta}\\,$ 表示。您的最终答案必须是一个单一的闭式解析表达式。无需进行数值计算，最终答案中不包含任何单位。",
            "solution": "### 第1部分：精确解的推导\n\n一维稳态对流-扩散的控制方程如下：\n$$\n\\frac{d}{dx}\\left(-\\Gamma\\,\\frac{d\\phi}{dx}+\\rho\\,u\\,\\phi\\right)=0\n$$\n由于 $\\rho$、$u$ 和 $\\Gamma$ 是常数，我们可以将方程对 $x$ 积分一次，得到：\n$$\n-\\Gamma\\,\\frac{d\\phi}{dx}+\\rho\\,u\\,\\phi = C_1\n$$\n其中 $C_1$ 是一个积分常数。这是一个一阶线性常微分方程 (ODE)，可以重写为：\n$$\n\\frac{d\\phi}{dx} - \\frac{\\rho u}{\\Gamma}\\phi = -\\frac{C_1}{\\Gamma}\n$$\n这个常微分方程的通解是齐次解 ($\\phi_h$) 和特解 ($\\phi_p$) 的和。齐次方程是 $\\frac{d\\phi_h}{dx} - \\frac{\\rho u}{\\Gamma}\\phi_h = 0$，其解为 $\\phi_h(x) = A \\exp\\left(\\frac{\\rho u}{\\Gamma}x\\right)$。对于特解，我们可以假设一个常数 $\\phi_p(x)=B$，代入后得到 $B=\\frac{C_1}{\\rho u}$。\n因此，通解为：\n$$\n\\phi(x) = A \\exp\\left(\\frac{\\rho u}{\\Gamma}x\\right) + B'\n$$\n其中 $A$ 和 $B'$ 是新的常数。我们现在应用边界条件 $\\phi(0)=\\phi_L$ 和 $\\phi(L)=\\phi_R$ 来确定 $A$ 和 $B'$。\n\n在 $x=0$ 处：\n$$\n\\phi(0) = \\phi_L = A + B'\n$$\n在 $x=L$ 处：\n$$\n\\phi(L) = \\phi_R = A \\exp\\left(\\frac{\\rho u L}{\\Gamma}\\right) + B'\n$$\n指数中的项是域佩克莱数，$\\mathrm{Pe} = \\frac{\\rho u L}{\\Gamma}$。第二个方程变为 $\\phi_R = A \\exp(\\mathrm{Pe}) + B'$。\n\n我们求解关于 $A$ 和 $B'$ 的线性方程组：\n从第一个方程， $B' = \\phi_L - A$。代入第二个方程：\n$$\n\\phi_R = A \\exp(\\mathrm{Pe}) + (\\phi_L - A) = A(\\exp(\\mathrm{Pe})-1) + \\phi_L\n$$\n解出 $A$：\n$$\nA = \\frac{\\phi_R - \\phi_L}{\\exp(\\mathrm{Pe})-1}\n$$\n解出 $B'$：\n$$\nB' = \\phi_L - A = \\phi_L - \\frac{\\phi_R - \\phi_L}{\\exp(\\mathrm{Pe})-1} = \\frac{\\phi_L\\exp(\\mathrm{Pe}) - \\phi_L - \\phi_R + \\phi_L}{\\exp(\\mathrm{Pe})-1} = \\frac{\\phi_L\\exp(\\mathrm{Pe}) - \\phi_R}{\\exp(\\mathrm{Pe})-1}\n$$\n将 $A$ 和 $B'$ 代回通解，得到：\n$$\n\\phi(x) = \\frac{\\phi_R - \\phi_L}{\\exp(\\mathrm{Pe})-1}\\exp\\left(\\frac{\\rho u}{\\Gamma}x\\right) + \\frac{\\phi_L\\exp(\\mathrm{Pe}) - \\phi_R}{\\exp(\\mathrm{Pe})-1}\n$$\n通过将 $\\phi(x)$ 与边界值关联，可以得到一个更方便的形式：\n$$\n\\phi(x) - \\phi_L = A\\exp\\left(\\frac{\\rho u}{\\Gamma}x\\right) + B' - (A+B') = A\\left(\\exp\\left(\\frac{\\rho u}{\\Gamma}x\\right) - 1\\right)\n$$\n代入 $A$ 的表达式，并注意到 $\\frac{\\rho u x}{\\Gamma} = \\frac{\\rho u L}{\\Gamma} \\frac{x}{L} = \\mathrm{Pe}\\frac{x}{L}$：\n$$\n\\phi(x) = \\phi_L + (\\phi_R - \\phi_L)\\frac{\\exp\\left(\\mathrm{Pe}\\frac{x}{L}\\right) - 1}{\\exp(\\mathrm{Pe}) - 1}\n$$\n域佩克莱数 $\\mathrm{Pe}=\\rho\\,u\\,L/\\Gamma$ 自然地出现在这个精确解中，它表征了在域长度 $L$ 上对流输运与扩散输运的比率。\n\n### 第2部分：指数格式界面值的推导\n\n我们将第1部分推导出的精确解应用于长度为 $\\Delta x = x_E - x_P$ 的子区间 $[x_P, x_E]$。局部边界条件是 $\\phi(x_P)=\\phi_P$ 和 $\\phi(x_E)=\\phi_E$。\n我们可以使用一个局部坐标系 $x' = x - x_P$，其中 $x' \\in [0, \\Delta x]$。该问题等价于第1部分中的问题，只需将 $L \\rightarrow \\Delta x$，$x \\rightarrow x'$，$\\phi_L \\rightarrow \\phi_P$，以及 $\\phi_R \\rightarrow \\phi_E$。相关的佩克莱数现在是网格佩克莱数，$\\mathrm{Pe}_{\\Delta} = \\frac{\\rho u \\Delta x}{\\Gamma}$。\n\n在该子区间上的精确解是：\n$$\n\\phi(x') = \\phi_P + (\\phi_E - \\phi_P)\\frac{\\exp\\left(\\mathrm{Pe}_{\\Delta}\\frac{x'}{\\Delta x}\\right) - 1}{\\exp(\\mathrm{Pe}_{\\Delta}) - 1}\n$$\n我们需要计算该解在位于 $x_f = x_P + \\Delta x/2$ 的网格界面 $f$ 处的值。在局部坐标中，这对应于 $x' = \\Delta x/2$。\n$$\n\\phi_f^{\\mathrm{exp}} = \\phi(\\Delta x/2) = \\phi_P + (\\phi_E - \\phi_P)\\frac{\\exp\\left(\\mathrm{Pe}_{\\Delta}\\frac{\\Delta x/2}{\\Delta x}\\right) - 1}{\\exp(\\mathrm{Pe}_{\\Delta}) - 1}\n$$\n$$\n\\phi_f^{\\mathrm{exp}} = \\phi_P + (\\phi_E - \\phi_P)\\frac{\\exp(\\mathrm{Pe}_{\\Delta}/2) - 1}{\\exp(\\mathrm{Pe}_{\\Delta}) - 1}\n$$\n该表达式符合所要求的线性混合形式 $\\phi_f^{\\mathrm{exp}} = \\phi_P + w_{\\mathrm{exp}}(\\mathrm{Pe}_{\\Delta})(\\phi_E - \\phi_P)$。通过比较，权重 $w_{\\mathrm{exp}}(\\mathrm{Pe}_{\\Delta})$ 是：\n$$\nw_{\\mathrm{exp}}(\\mathrm{Pe}_{\\Delta}) = \\frac{\\exp(\\mathrm{Pe}_{\\Delta}/2) - 1}{\\exp(\\mathrm{Pe}_{\\Delta}) - 1}\n$$\n\n### 第3部分：混合差分格式 (HDS) 界面值\n\n混合差分格式 (HDS) 根据网格佩克莱数 $|\\mathrm{Pe}_{\\Delta}|$ 的绝对值，在中心差分格式 (CDS) 和迎风差分格式 (UDS) 之间自适应地选择。标准的切换准则是：\n- 如果 $|\\mathrm{Pe}_{\\Delta}| \\le 2$，使用 CDS。\n- 如果 $|\\mathrm{Pe}_{\\Delta}| > 2$，使用 UDS。\n\n对于 CDS，界面值是相邻节点值的线性插值：\n$$\n\\phi_f^{\\mathrm{CDS}} = \\frac{\\phi_P + \\phi_E}{2}\n$$\n对于 UDS，界面值取自上游（迎风）节点。由于问题指定 $u > 0$，流动方向是从左到右（从 P 到 E），因此东侧界面 $f$ 的迎风节点是 $P$：\n$$\n\\phi_f^{\\mathrm{UDS}} = \\phi_P\n$$\n由于 $u>0$ 且其他参数为正，$\\mathrm{Pe}_{\\Delta} = \\frac{\\rho u \\Delta x}{\\Gamma} > 0$。因此，$|\\mathrm{Pe}_{\\Delta}| = \\mathrm{Pe}_{\\Delta}$。此情况下的 HDS 公式为：\n$$\n\\phi_f^{\\mathrm{HDS}} = \\begin{cases} \\phi_f^{\\mathrm{CDS}} = \\frac{\\phi_P + \\phi_E}{2} & \\text{如果 } 0 \\le \\mathrm{Pe}_{\\Delta} \\le 2 \\\\ \\phi_f^{\\mathrm{UDS}} = \\phi_P & \\text{如果 } \\mathrm{Pe}_{\\Delta} > 2 \\end{cases}\n$$\n\n### 第4部分：差值 $\\Delta(\\mathrm{Pe}_{\\Delta})$ 的推导\n\n我们现在推导差值 $\\Delta(\\mathrm{Pe}_{\\Delta}) = \\phi_f^{\\mathrm{exp}} - \\phi_f^{\\mathrm{HDS}}$。由于 HDS 的定义，该差值将是一个分段函数。\n\n**情况1：$0 \\le \\mathrm{Pe}_{\\Delta} \\le 2$**\n在此范围内，HDS 使用中心差分。\n$$\n\\Delta(\\mathrm{Pe}_{\\Delta}) = \\phi_f^{\\mathrm{exp}} - \\phi_f^{\\mathrm{CDS}}\n$$\n$$\n\\Delta(\\mathrm{Pe}_{\\Delta}) = \\left(\\phi_P + (\\phi_E - \\phi_P)\\frac{\\exp(\\mathrm{Pe}_{\\Delta}/2) - 1}{\\exp(\\mathrm{Pe}_{\\Delta}) - 1}\\right) - \\left(\\frac{\\phi_P + \\phi_E}{2}\\right)\n$$\n为了简化，我们把 $\\frac{\\phi_P + \\phi_E}{2}$ 写成 $\\phi_P + \\frac{1}{2}(\\phi_E - \\phi_P)$。\n$$\n\\Delta(\\mathrm{Pe}_{\\Delta}) = (\\phi_E - \\phi_P) \\left( \\frac{\\exp(\\mathrm{Pe}_{\\Delta}/2) - 1}{\\exp(\\mathrm{Pe}_{\\Delta}) - 1} - \\frac{1}{2} \\right)\n$$\n\n**情况2：$\\mathrm{Pe}_{\\Delta} > 2$**\n在此范围内，HDS 使用迎风差分。\n$$\n\\Delta(\\mathrm{Pe}_{\\Delta}) = \\phi_f^{\\mathrm{exp}} - \\phi_f^{\\mathrm{UDS}}\n$$\n$$\n\\Delta(\\mathrm{Pe}_{\\Delta}) = \\left(\\phi_P + (\\phi_E - \\phi_P)\\frac{\\exp(\\mathrm{Pe}_{\\Delta}/2) - 1}{\\exp(\\mathrm{Pe}_{\\Delta}) - 1}\\right) - \\phi_P\n$$\n$$\n\\Delta(\\mathrm{Pe}_{\\Delta}) = (\\phi_E - \\phi_P) \\left( \\frac{\\exp(\\mathrm{Pe}_{\\Delta}/2) - 1}{\\exp(\\mathrm{Pe}_{\\Delta}) - 1} \\right)\n$$\n\n结合这两种情况，我们得到了差值的单一闭式解析表达式，写成分段形式：\n$$\n\\Delta(\\mathrm{Pe}_{\\Delta}) = (\\phi_E - \\phi_P) \\begin{cases} \\left( \\frac{\\exp(\\mathrm{Pe}_{\\Delta}/2) - 1}{\\exp(\\mathrm{Pe}_{\\Delta}) - 1} - \\frac{1}{2} \\right) & \\text{如果 } 0 \\le \\mathrm{Pe}_{\\Delta} \\le 2 \\\\ \\left( \\frac{\\exp(\\mathrm{Pe}_{\\Delta}/2) - 1}{\\exp(\\mathrm{Pe}_{\\Delta}) - 1} \\right) & \\text{如果 } \\mathrm{Pe}_{\\Delta} > 2 \\end{cases}\n$$\n该表达式量化了混合差分格式相对于局部精确的指数格式所引入的误差，或称数值扩散。",
            "answer": "$$\n\\boxed{\n\\Delta(\\mathrm{Pe}_{\\Delta}) = (\\phi_E - \\phi_P) \\begin{cases} \\frac{\\exp(\\mathrm{Pe}_{\\Delta}/2) - 1}{\\exp(\\mathrm{Pe}_{\\Delta}) - 1} - \\frac{1}{2} & \\text{如果 } 0 \\le \\mathrm{Pe}_{\\Delta} \\le 2 \\\\ \\frac{\\exp(\\mathrm{Pe}_{\\Delta}/2) - 1}{\\exp(\\mathrm{Pe}_{\\Delta}) - 1} & \\text{如果 } \\mathrm{Pe}_{\\Delta} > 2 \\end{cases}\n}\n$$"
        },
        {
            "introduction": "理论的最终检验在于实践。本练习旨在将前面学到的概念——包括局部佩克莱数（$Pe_f$）的计算、混合格式的选择逻辑以及守恒通量累加——转化为一个可执行的二维有限体积算法。您将通过编写代码 ，设计一个面循环来计算跨网格面的能量通量，并确保其在单元间的传递是完全守恒的。这项实践不仅能巩固您对混合格式工作机理的理解，更是将抽象的数学公式转化为具体计算步骤的关键训练，是开发和分析计算流体动力学求解器的核心技能。",
            "id": "3991653",
            "problem": "您需要为一个二维直角有限体积网格实现一个保守的面循环，该循环使用混合差分格式计算跨面的能量通量。该算法必须根据投影到面法线上的局部平流速度的符号来确定每个面的上游单元，并且必须根据局部佩克莱数对每个面应用混合选择。您的实现必须从基本的守恒定律和本构关系出发，并推导出所有必要的量。物理模型是物性恒定的流体中，温度通过平流和扩散进行的稳态输运。所有能量通量必须在单元级别进行保守累加，对于内部面，将负向通量加到主单元，正向通量加到相邻单元，确保所有单元的总和等于净边界流入量。\n\n使用的模型和定义：\n- 在由 $\\partial \\Omega$ 界定的控制体 $\\Omega$ 中，温度 $T$ 的稳态热能守恒（无源项）：$$\\int_{\\partial \\Omega} \\rho c_p (\\mathbf{u}\\cdot\\mathbf{n}) T \\, \\mathrm{d}A - \\int_{\\partial \\Omega} k \\, \\nabla T \\cdot \\mathbf{n} \\, \\mathrm{d}A = 0,$$ 其中 $\\rho$ 是密度， $c_p$ 是定压比热，$\\mathbf{u}$ 是速度，$\\mathbf{n}$ 是面的外向单位法线， $k$ 是热导率， $A$ 是面面积。\n- 跨一个面积为 $A_f$、法线为 $\\mathbf{n}_f$ 的面的对流能量通量：$$q_c = \\rho c_p (\\mathbf{u}\\cdot\\mathbf{n}_f) A_f \\, T_f,$$ 其中 $T_f$ 是在该面上使用的温度。\n- 跨同一面的传导能量通量（有限体积形式的傅里叶定律）：$$q_d = -k \\, A_f \\, \\frac{T_N - T_P}{d_f},$$ 其中 $T_P$ 是主单元温度， $T_N$ 是相邻单元或边界温度， $d_f$ 是中心之间的距离（对于内部面等于中心间距，对于边界面等于单元宽度的一半）。\n- 混合差分选择使用面佩克莱数 $$\\mathrm{Pe}_f = \\frac{\\rho c_p \\, |\\mathbf{u}\\cdot\\mathbf{n}_f| \\, d_f}{k}.$$ 对于每个面，如果 $|\\mathrm{Pe}_f| \\le 2$，则使用中心差分， $T_f$ 等于相邻温度的算术平均值；否则使用迎风差分， $T_f$ 等于由 $\\mathbf{u}\\cdot\\mathbf{n}_f$ 的符号确定的上游侧的温度。\n\n几何与离散化：\n- 使用均匀间隔的笛卡尔网格，在长度为 $L_x$ 的 $x$ 方向上有 $N_x$ 个单元，在长度为 $L_y$ 的 $y$ 方向上有 $N_y$ 个单元。单元中心位于 $(x_i, y_j)$，其中 $x_i = (i + 0.5)\\Delta x$, $y_j = (j + 0.5)\\Delta y$，$\\Delta x = L_x/N_x$，$\\Delta y = L_y/N_y$，并且 $i \\in \\{0,\\dots,N_x-1\\}$，$j \\in \\{0,\\dots,N_y-1\\}$。\n- 内部垂直面的外向法线为 $\\mathbf{n}_f = (1,0)$（从左侧单元指向右侧单元），面积为 $A_f = \\Delta y$，距离为 $d_f = \\Delta x$。内部水平面的外向法线为 $\\mathbf{n}_f = (0,1)$（从底部单元指向顶部单元），面积为 $A_f = \\Delta x$，距离为 $d_f = \\Delta y$。\n- 边界面的法线使用从内部单元指向外部的方向：左边界 $\\mathbf{n}_f = (-1,0)$，右边界 $\\mathbf{n}_f = (1,0)$，下边界 $\\mathbf{n}_f = (0,-1)$，上边界 $\\mathbf{n}_f = (0,1)$。边界面的面积如上所述，对于左右边界 $d_f = \\Delta x/2$，对于上下边界 $d_f = \\Delta y/2$。\n\n温度场和边界条件：\n- 任意点 $(x,y)$ 处的温度场为 $$T(x,y) = T_0 + a_x \\frac{x}{L_x} + a_y \\frac{y}{L_y},$$ 其中 $T_0 = 300$ K, $a_x = 20$ K, $a_y = 10$ K。使用此 $T(x,y)$ 计算单元中心的 $T_P$ 和边界平面上相应 $(x,y)$ 位置（例如，对于垂直边界为 $x=0$ 或 $x=L_x$，对于水平边界为 $y=0$ 或 $y=L_y$）的边界温度 $T_b$。\n- 对于边界对流能量通量，根据 $\\mathbf{u}\\cdot\\mathbf{n}_f$ 的符号确定上游温度：如果流体离开域（$\\mathbf{u}\\cdot\\mathbf{n}_f > 0$），则上游温度为 $T_P$；如果流体进入域（$\\mathbf{u}\\cdot\\mathbf{n}_f < 0$），则上游温度为 $T_b$。\n\n保守累加：\n- 对于每个内部面，计算沿 $\\mathbf{n}_f$ 方向（从主单元到相邻单元）的 $q_f = q_c + q_d$。将 $-q_f$ 加到主单元的净流入量，将 $+q_f$ 加到相邻单元的净流入量。对于每个边界面，将 $-q_f$ 加到主单元的净流入量（没有相邻单元）。这确保了保守累加，其中内部成对的贡献在全局范围内相互抵消，总和等于净边界流入量。\n\n单位：\n- 所有能量通量以瓦特（W）为单位报告。将每个通量值四舍五入到六位小数。\n\n您的任务：\n- 为以下测试套件实现上述面循环和保守累加。对于每个测试用例，按行主序（从 $i=0$ 到 $i=N_x-1$，对于 $j=0$ 到 $j=N_y-1$）计算并返回每个单元的净流入能量通量列表。\n- 测试套件：\n  - 案例 $1$ （中心差分区域）：$N_x=2$, $N_y=2$, $L_x=2.0$ m, $L_y=2.0$ m, $\\rho=1.0$ kg/m$^3$, $c_p=1000.0$ J/(kg·K), $k=10.0$ W/(m·K), $\\mathbf{u}=(0.01, 0.00)$ m/s。\n  - 案例 $2$ （迎风主导区域）：$N_x=2$, $N_y=2$, $L_x=2.0$ m, $L_y=2.0$ m, $\\rho=1.0$ kg/m$^3$, $c_p=1000.0$ J/(kg·K), $k=10.0$ W/(m·K), $\\mathbf{u}=(0.50, -0.20)$ m/s。\n  - 案例 $3$ （纯扩散）：$N_x=2$, $N_y=2$, $L_x=1.0$ m, $L_y=1.0$ m, $\\rho=1.0$ kg/m$^3$, $c_p=1000.0$ J/(kg·K), $k=5.0$ W/(m·K), $\\mathbf{u}=(0.00, 0.00)$ m/s。\n  - 案例 $4$ （混合流入/流出，垂直方向法向速度为零）：$N_x=3$, $N_y=2$, $L_x=3.0$ m, $L_y=2.0$ m, $\\rho=1.0$ kg/m$^3$, $c_p=1000.0$ J/(kg·K), $k=6.0$ W/(m·K), $\\mathbf{u}=(0.00, 0.30)$ m/s。\n- 最终输出格式：您的程序应生成单行输出，其中包含一个由方括号括起来的、以逗号分隔的列表的列表形式的结果（例如，\"[[case1_cell1_flux,...],[case2_cell1_flux,...],...]\"）。每个通量值必须四舍五入到六位小数并以瓦特（W）表示。\n\n不允许用户输入。所有常量和参数均已在上面提供，程序必须确定性地生成输出。",
            "solution": "该解法实现了一个基于面的循环，用于计算二维直角网格中每个单元的净能量流入。物理模型是热能的稳态平流-扩散过程。\n\n基本原理是任意控制体 $\\Omega$ 的热能守恒，在没有内部热源且处于稳态时，表示为：\n$$\n\\oint_{\\partial \\Omega} \\mathbf{F} \\cdot \\mathbf{n} \\, \\mathrm{d}A = 0\n$$\n其中 $\\mathbf{F}$ 是总能量通量矢量，由平流通量和基于傅里叶定律的传导通量之和给出：\n$$\n\\mathbf{F} = \\rho c_p \\mathbf{u} T - k \\nabla T\n$$\n这里，$\\rho$ 是流体密度，$c_p$ 是比热容，$\\mathbf{u}$ 是速度矢量，$T$ 是温度，$k$ 是热导率，$\\mathbf{n}$ 是指向边界表面 $\\partial \\Omega$ 外部的单位法向矢量，$A$ 是表面积。\n\n在有限体积法中，计算域被离散为一组不重叠的控制体，或称为单元。对于单个单元 $\\Omega_P$，积分守恒定律通过对其所有面上的通量求和来近似：\n$$\n\\sum_{f \\in \\text{faces}(P)} \\int_{A_f} \\mathbf{F} \\cdot \\mathbf{n}_f \\, \\mathrm{d}A_f \\approx \\sum_{f \\in \\text{faces}(P)} (\\mathbf{F}_f \\cdot \\mathbf{n}_f) A_f = \\sum_{f \\in \\text{faces}(P)} q_f = 0\n$$\n其中 $q_f$ 是通过面 $f$ 离开单元 $P$ 的总能量通量，使用在面中心评估的属性计算。进入单元 $P$ 的净能量流入是净流出的负值，即 $-\\sum_f q_f$。我们的目标是为每个单元计算这个值。\n\n通过一个面 $f$ 的总通量 $q_f$ 是对流分量 $q_c$ 和传导（扩散）分量 $q_d$ 的和：\n$$\nq_f = q_c + q_d\n$$\n\n传导通量 $q_d$ 基于傅里叶定律，离散为与面相邻的节点（单元中心）之间的中心差分：\n$$\nq_d = - \\left(k \\nabla T \\cdot \\mathbf{n}_f \\right)_f A_f \\approx -k A_f \\frac{T_N - T_P}{d_f}\n$$\n其中 $T_P$ 是“主”单元的温度，$T_N$ 是“相邻”单元（或边界）的温度，$A_f$ 是面面积，$d_f$ 是单元中心 $P$ 和相邻节点 $N$ 之间的距离。面法线 $\\mathbf{n}_f$ 定义为从 $P$ 指向 $N$。\n\n对流通量 $q_c$ 由下式给出：\n$$\nq_c = \\left( \\rho c_p \\mathbf{u} \\cdot \\mathbf{n}_f T \\right)_f A_f = (\\rho c_p (\\mathbf{u} \\cdot \\mathbf{n}_f) A_f) T_f\n$$\n其中 $T_f$ 是面上的温度。$T_f$ 的值由一个平流格式确定。问题指定了混合差分格式，该格式根据面佩克莱数 $\\mathrm{Pe}_f$ 的大小在中心差分（CD）和迎风差分（UDS）之间进行选择。佩克莱数代表跨面平流与扩散强度的比率：\n$$\n\\mathrm{Pe}_f = \\frac{\\rho c_p |\\mathbf{u} \\cdot \\mathbf{n}_f| d_f}{k}\n$$\n混合格式定义如下：\n1.  如果 $|\\mathrm{Pe}_f| \\le 2$：使用中心差分（CD）。面温度是相邻节点温度的算术平均值。这在扩散作用显著时是合适的。\n    $$T_f = \\frac{T_P + T_N}{2}$$\n2.  如果 $|\\mathrm{Pe}_f| > 2$：使用一阶迎风差分（UDS）。面温度取自上游节点，上游节点由流过面的方向（$\\mathbf{u} \\cdot \\mathbf{n}_f$ 的符号）确定。这确保了在对流主导的流动中的稳定性。\n    $$\n    T_f =\n    \\begin{cases}\n      T_P & \\text{if } \\mathbf{u} \\cdot \\mathbf{n}_f > 0 \\text{ (flow from P to N)} \\\\\n      T_N & \\text{if } \\mathbf{u} \\cdot \\mathbf{n}_f < 0 \\text{ (flow from N to P)}\n    \\end{cases}\n    $$\n\n算法通过遍历网格中的所有面来执行，为每个面计算通量 $q_f$，并将其累加到共享该面的两个单元中。为确保全局守恒并避免重复计算，我们为内部垂直面、内部水平面和边界面实现单独的循环。\n\n对于主单元P和相邻单元N之间的一个内部面，通量 $q_f$ 是沿着从P指向N的法线方向计算的。该通量代表P的流出量和N的流入量。单元P的净流入量通过减去 $q_f$ 来更新，而单元N的净流入量通过加上 $q_f$ 来更新。\n\n对于单元P的一个边界面，通量 $q_f$ 是沿着向外的法线方向计算的。这是从单元P流向域外部的流出量。单元P的净流入量通过减去 $q_f$ 来更新。没有相邻单元。对于边界面，相邻温度 $T_N$ 是给定的边界温度 $T_b$，距离 $d_f$ 是单元中心到边界面之间的距离。\n\n任何所需位置（单元中心、边界面）的温度都使用给定的解析场来评估：$T(x,y) = T_0 + a_x \\frac{x}{L_x} + a_y \\frac{y}{L_y}$。\n\n一个二维数组 `net_inflows`，其维度为网格大小（$N_y \\times N_x$），被初始化为零。流程如下：\n1.  预先计算并存储每个单元 $(i,j)$ 中心的温度。\n2.  遍历内部垂直面：对于单元 $(j,i)$ 和 $(j,i+1)$ 之间的每个面，计算 $q_f$ 并更新 `net_inflows[j,i]` 和 `net_inflows[j,i+1]`。\n3.  遍历内部水平面：对于单元 $(j,i)$ 和 $(j+1,i)$ 之间的每个面，计算 $q_f$ 并更新 `net_inflows[j,i]` 和 `net_inflows[j+1,i]`。\n4.  遍历四个边界（左、右、下、上）：对于单元 $(j,i)$ 的每个边界面，计算边界通量 $q_f$ 并更新 `net_inflows[j,i]`。\n\n最后，$N_y \\times N_x$ 的 `net_inflows` 数组按行主序展开成一个一维列表，以生成所需的输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    \n    test_cases = [\n        # Case 1 (central-differencing regime)\n        {'Nx': 2, 'Ny': 2, 'Lx': 2.0, 'Ly': 2.0, 'rho': 1.0, 'cp': 1000.0, 'k': 10.0, 'u': (0.01, 0.00)},\n        # Case 2 (upwind-dominated regime)\n        {'Nx': 2, 'Ny': 2, 'Lx': 2.0, 'Ly': 2.0, 'rho': 1.0, 'cp': 1000.0, 'k': 10.0, 'u': (0.50, -0.20)},\n        # Case 3 (pure diffusion)\n        {'Nx': 2, 'Ny': 2, 'Lx': 1.0, 'Ly': 1.0, 'rho': 1.0, 'cp': 1000.0, 'k': 5.0, 'u': (0.00, 0.00)},\n        # Case 4 (mixed inflow/outflow)\n        {'Nx': 3, 'Ny': 2, 'Lx': 3.0, 'Ly': 2.0, 'rho': 1.0, 'cp': 1000.0, 'k': 6.0, 'u': (0.00, 0.30)},\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = compute_fluxes_for_case(case)\n        all_results.append(result)\n\n    # Format the final output string as per problem specification.\n    string_results = []\n    for res_list in all_results:\n        # Each flux value must be rounded to six decimal places.\n        formatted_list = [f\"{val:.6f}\" for val in res_list]\n        string_results.append(f\"[{','.join(formatted_list)}]\")\n    \n    final_output = f\"[{','.join(string_results)}]\"\n    print(final_output)\n\ndef compute_fluxes_for_case(case_params):\n    \"\"\"\n    Computes net inflow energy fluxes for a single test case.\n    \"\"\"\n    Nx, Ny = case_params['Nx'], case_params['Ny']\n    Lx, Ly = case_params['Lx'], case_params['Ly']\n    rho, cp, k = case_params['rho'], case_params['cp'], case_params['k']\n    ux, uy = case_params['u']\n\n    T0, ax, ay = 300.0, 20.0, 10.0\n\n    dx = Lx / Nx\n    dy = Ly / Ny\n\n    # Define the analytical temperature field\n    def temp_field(x, y):\n        return T0 + ax * (x / Lx) + ay * (y / Ly)\n\n    # Calculate and store cell-center temperatures\n    # Indexing is [row, column] -> [j, i]\n    cell_temps = np.zeros((Ny, Nx))\n    cell_centers_x = (np.arange(Nx) + 0.5) * dx\n    cell_centers_y = (np.arange(Ny) + 0.5) * dy\n    for j in range(Ny):\n        for i in range(Nx):\n            cell_temps[j, i] = temp_field(cell_centers_x[i], cell_centers_y[j])\n\n    # Initialize net inflow for each cell to zero\n    net_inflows = np.zeros((Ny, Nx))\n\n    # --- Internal Vertical Faces ---\n    # Loop over faces between column i and i+1\n    for j in range(Ny):\n        for i in range(Nx - 1):\n            P_idx, N_idx = (j, i), (j, i + 1)\n            TP, TN = cell_temps[P_idx], cell_temps[N_idx]\n\n            # Face properties\n            # Normal n_f points from P to N\n            u_dot_n = ux\n            A_f = dy\n            d_f = dx\n\n            # Péclet number\n            Pe = (rho * cp * abs(u_dot_n) * d_f) / k if k != 0 else float('inf')\n\n            # Hybrid scheme for face temperature T_f\n            if Pe = 2:  # Central Differencing\n                T_f = (TP + TN) / 2.0\n            else:  # Upwind Differencing\n                T_f = TP if u_dot_n = 0 else TN\n\n            q_c = rho * cp * u_dot_n * A_f * T_f\n            q_d = -k * A_f * (TN - TP) / d_f\n            q_f = q_c + q_d\n\n            net_inflows[P_idx] -= q_f\n            net_inflows[N_idx] += q_f\n\n    # --- Internal Horizontal Faces ---\n    # Loop over faces between row j and j+1\n    for i in range(Nx):\n        for j in range(Ny - 1):\n            P_idx, N_idx = (j, i), (j + 1, i)\n            TP, TN = cell_temps[P_idx], cell_temps[N_idx]\n\n            # Face properties\n            u_dot_n = uy\n            A_f = dx\n            d_f = dy\n\n            Pe = (rho * cp * abs(u_dot_n) * d_f) / k if k != 0 else float('inf')\n\n            if Pe = 2:  # CD\n                T_f = (TP + TN) / 2.0\n            else:  # UDS\n                T_f = TP if u_dot_n = 0 else TN\n            \n            q_c = rho * cp * u_dot_n * A_f * T_f\n            q_d = -k * A_f * (TN - TP) / d_f\n            q_f = q_c + q_d\n\n            net_inflows[P_idx] -= q_f\n            net_inflows[N_idx] += q_f\n\n    # --- Boundary Faces ---\n    # Left Boundary (i=0)\n    for j in range(Ny):\n        P_idx = (j, 0)\n        TP = cell_temps[P_idx]\n        Tb = temp_field(0.0, cell_centers_y[j])\n        \n        u_dot_n = -ux # Outward normal is (-1,0)\n        A_f = dy\n        d_f = dx / 2.0\n\n        Pe = (rho * cp * abs(u_dot_n) * d_f) / k if k != 0 else float('inf')\n\n        if Pe = 2: # CD\n            T_f = (TP + Tb) / 2.0\n        else: # UDS (flow leaves if u_dot_n > 0, enters if u_dot_n  0)\n            T_f = TP if u_dot_n = 0 else Tb\n\n        q_c = rho * cp * u_dot_n * A_f * T_f\n        q_d = -k * A_f * (Tb - TP) / d_f if d_f  0 else 0.0\n        q_f = q_c + q_d\n        \n        net_inflows[P_idx] -= q_f\n\n    # Right Boundary (i=Nx-1)\n    for j in range(Ny):\n        P_idx = (j, Nx - 1)\n        TP = cell_temps[P_idx]\n        Tb = temp_field(Lx, cell_centers_y[j])\n\n        u_dot_n = ux # Outward normal is (1,0)\n        A_f = dy\n        d_f = dx / 2.0\n\n        Pe = (rho * cp * abs(u_dot_n) * d_f) / k if k != 0 else float('inf')\n\n        if Pe = 2: # CD\n            T_f = (TP + Tb) / 2.0\n        else: # UDS\n            T_f = TP if u_dot_n = 0 else Tb\n\n        q_c = rho * cp * u_dot_n * A_f * T_f\n        q_d = -k * A_f * (Tb - TP) / d_f if d_f  0 else 0.0\n        q_f = q_c + q_d\n\n        net_inflows[P_idx] -= q_f\n\n    # Bottom Boundary (j=0)\n    for i in range(Nx):\n        P_idx = (0, i)\n        TP = cell_temps[P_idx]\n        Tb = temp_field(cell_centers_x[i], 0.0)\n\n        u_dot_n = -uy # Outward normal is (0,-1)\n        A_f = dx\n        d_f = dy / 2.0\n\n        Pe = (rho * cp * abs(u_dot_n) * d_f) / k if k != 0 else float('inf')\n\n        if Pe = 2: # CD\n            T_f = (TP + Tb) / 2.0\n        else: # UDS\n            T_f = TP if u_dot_n = 0 else Tb\n\n        q_c = rho * cp * u_dot_n * A_f * T_f\n        q_d = -k * A_f * (Tb - TP) / d_f if d_f  0 else 0.0\n        q_f = q_c + q_d\n\n        net_inflows[P_idx] -= q_f\n\n    # Top Boundary (j=Ny-1)\n    for i in range(Nx):\n        P_idx = (Ny - 1, i)\n        TP = cell_temps[P_idx]\n        Tb = temp_field(cell_centers_x[i], Ly)\n\n        u_dot_n = uy # Outward normal is (0,1)\n        A_f = dx\n        d_f = dy / 2.0\n\n        Pe = (rho * cp * abs(u_dot_n) * d_f) / k if k != 0 else float('inf')\n\n        if Pe = 2: # CD\n            T_f = (TP + Tb) / 2.0\n        else: # UDS\n            T_f = TP if u_dot_n = 0 else Tb\n\n        q_c = rho * cp * u_dot_n * A_f * T_f\n        q_d = -k * A_f * (Tb - TP) / d_f if d_f  0 else 0.0\n        q_f = q_c + q_d\n\n        net_inflows[P_idx] -= q_f\n        \n    # Flatten array in row-major order (j first, then i)\n    return net_inflows.flatten().tolist()\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}