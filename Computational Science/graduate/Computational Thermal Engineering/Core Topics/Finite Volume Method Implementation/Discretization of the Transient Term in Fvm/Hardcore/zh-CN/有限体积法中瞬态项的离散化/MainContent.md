## 引言
在[计算热工学](@entry_id:1122812)和流[体力](@entry_id:174230)学的广阔领域中，对瞬态现象的精确模拟是理解和预测系统动态行为的关键。从涡轮叶片的启动[热冲击](@entry_id:158329)到电池的充放电过程，物理量随时间的变化主导着整个系统的演化。在基于[有限体积法](@entry_id:141374)（FVM）的[数值模拟](@entry_id:146043)中，对控制方程中描述这种时间变化率的“瞬态项”进行离散化，是连接连续物理定律与离散[代数方程](@entry_id:272665)的核心环节。然而，选择何种离散格式并非易事，不同的选择会在计算精度、稳定性与效率之间带来截然不同的权衡，这构成了计算科学家和工程师必须解决的关键问题。

本文旨在系统性地剖析FVM中[瞬态项离散化](@entry_id:1133329)的理论与实践。通过以下三个章节的逐步深入，读者将构建一个全面而坚实的知识体系：
- **原理与机制**：我们将从瞬态项的物理本质出发，详细推导后向欧拉、Crank-Nicolson等关键[时间积分格式](@entry_id:165373)。通过冯·诺伊曼稳定性分析，揭示[数值耗散](@entry_id:168584)与色散的内在机制，并探讨处理[非线性](@entry_id:637147)物性与[质量矩阵](@entry_id:177093)等高级主题。
- **应用与跨学科联系**：本章将理论知识置于广阔的应用背景中，展示瞬态离散化如何在处理相变刚性问题、可压缩流、移动边界（ALE）以及岩土固结和[电池建模](@entry_id:1122188)等交叉学科挑战中发挥关键作用。
- **动手实践**：通过一系列精心设计的编程练习，您将有机会亲手实现并验证[时间积分格式](@entry_id:165373)的精度，深化对理论知识的理解，掌握从理论到代码验证的核心技能。

通过本文的学习，您将不仅理解“如何”离散瞬态项，更将深刻领会“为何”以及“何时”选择特定的数值策略，从而在面对复杂的瞬态仿真任务时做出明智而高效的决策。

## 原理与机制

在[瞬态传热](@entry_id:148369)和流体流动问题中，[守恒方程](@entry_id:1122898)中的一个关键项描述了系统内物理量随时间的变化率。本章将深入探讨在[有限体积法 (FVM)](@entry_id:749403) 框架下对该瞬态项进行离散化的基本原理和核心机制。我们将从瞬态项的物理和数学基础出发，系统地介绍各种[时间积分格式](@entry_id:165373)，分析它们的精度和稳定性，并讨论在处理[非线性](@entry_id:637147)和复杂物理问题时出现的实际考虑因素。

### 瞬态项的物理与数学本质

在推导任何数值格式之前，我们必须首先理解瞬态项在控制方程中的物理意义。考虑一个固定的控制体积 $V_P$，其内部的能量守恒可以表述为：控制体积内储存能量的变化率等于进出边界的[净热通量](@entry_id:155652)与体积内热源生成之和。瞬态项正是描述这种“储存能量的变化率”。

在基于温度 $T$ 的能量守恒方程中，该项通常写作 $\rho c_p \frac{\partial T}{\partial t}$，其中 $\rho$ 是密度，$c_p$ 是定压比热容。这一项的物理量纲可以通过量纲分析来揭示。在[国际单位制](@entry_id:172547) (SI) 中，各物理量的单位为：
- 密度 $\rho$: $\text{kg} \cdot \text{m}^{-3}$
- 比热容 $c_p$: $\text{J} \cdot \text{kg}^{-1} \cdot \text{K}^{-1}$
- 温度对时间的[偏导数](@entry_id:146280) $\frac{\partial T}{\partial t}$: $\text{K} \cdot \text{s}^{-1}$

将它们相乘，我们得到瞬态项的单位：
$$
(\text{kg} \cdot \text{m}^{-3}) \times (\text{J} \cdot \text{kg}^{-1} \cdot \text{K}^{-1}) \times (\text{K} \cdot \text{s}^{-1}) = \text{J} \cdot \text{m}^{-3} \cdot \text{s}^{-1}
$$
由于[焦耳](@entry_id:147687)每秒 ($\text{J} \cdot \text{s}^{-1}$) 定义为瓦特 ($\text{W}$)，即功率的单位，因此该项的单位是 $\text{W} \cdot \text{m}^{-3}$。这明确地表明，$\rho c_p \frac{\partial T}{\partial t}$ 代表了单位体积内[热能储存](@entry_id:1132994)的**功率密度** 。

在[有限体积法](@entry_id:141374)中，这种体[积性质](@entry_id:151217)至关重要。当我们将守恒方程在控制体积 $V_P$ 上积分时，瞬态项是一个体积积分，代表整个控制体积内的总能量积累率。与此相对，对流项（如 $\nabla \cdot (\rho c_p \mathbf{u} T)$）和扩散项（如 $\nabla \cdot (k \nabla T)$）描述的是通过控制体积**表面**的输运。根据[高斯散度定理](@entry_id:188065)，这些包含[散度算子](@entry_id:265975)的项可以转化为面积分，即通量。因此，FVM 的基本思想是平衡一个**体积**内的积累率和穿过其**表面**的净通量。将瞬态项错误地理解为一种表面通量，是对能量[守恒原理](@entry_id:1122907)的根本性误解 。

### 从连续到离散：[时间积分格式](@entry_id:165373)

在空间上对守恒方程进行 FVM 离散后，我们得到一个关于每个控制体积中心温度 $T_P$ 的[常微分方程](@entry_id:147024) (ODE) 系统，这被称为半离散形式：
$$
(\rho c_p V_P) \frac{d T_P}{dt} = R_P(T, \mathbf{x}, t)
$$
其中，$R_P$ 代表了进出控制体积 $P$ 的所有空间通量（扩散、对流）和源项的总和。下一步是在时间维度上对这个 ODE 系统进行离散，从而得到全离散的代数方程。

一个统一的框架是**广义 $\theta$ 格式**。我们将上述半离散方程在一个时间步 $\Delta t = t^{n+1} - t^n$ 内进行积分：
$$
\int_{t^n}^{t^{n+1}} (\rho c_p V_P) \frac{d T_P}{dt} dt = \int_{t^n}^{t^{n+1}} R_P(t) dt
$$
左侧的积分可以精确求解，得到 $(\rho c_p V_P) (T_P^{n+1} - T_P^n)$（假设 $\rho c_p$ 在时间步内为常数）。右侧对时间变化的通量项 $R_P(t)$ 的积分需要进行近似。$\theta$ 格式采用加权平均的方式来近似这个积分：
$$
\int_{t^n}^{t^{n+1}} R_P(t) dt \approx \Delta t \left[ \theta R_P^{n+1} + (1-\theta) R_P^n \right]
$$
其中，$\theta \in [0, 1]$ 是一个加权因子，它的取值定义了不同的[时间积分格式](@entry_id:165373) 。

#### 后向欧拉（全隐式）格式 ($\theta = 1$)

当 $\theta=1$ 时，所有右端项都在新的时间层 $t^{n+1}$ 上取值。全离散方程为：
$$
\frac{(\rho c_p V_P) (T_P^{n+1} - T_P^n)}{\Delta t} = R_P(T^{n+1})
$$
这是一个关于未知量 $T^{n+1}$ 的[隐式方程](@entry_id:177636)。整理后，它形成一个线性[代数方程](@entry_id:272665)组。对于扩散问题，该方程组可以写为矩阵形式 ：
$$
\left(\frac{\mathbf{M}}{\Delta t} + \mathbf{A}\right)\mathbf{T}^{n+1} = \mathbf{b}
$$
这里，$\mathbf{T}^{n+1}$ 是所有控制体积中心温度在 $t^{n+1}$ 时刻的向量。
- $\mathbf{M}$ 是**容量矩阵**。在标准的 FVM 中，采用**集总质量** (lumped mass) 近似，$\mathbf{M}$ 是一个[对角矩阵](@entry_id:637782)，其对角元为 $M_{PP} = (\rho c_p)_P V_P$。
- $\mathbf{A}$ 是由扩散项和源项的线性化部分构成的空间算子矩阵。
- $\mathbf{b}$ 是右端向量，包含了来自前一时间步的信息（如 $\frac{\mathbf{M}}{\Delta t}\mathbf{T}^n$）和边界条件。

瞬态项的一个关键作用是改善代数系统的数学性质。瞬态贡献项 $\frac{(\rho c_p)_P V_P}{\Delta t}$ 是一个正值，它被加到系数矩阵 $(\frac{\mathbf{M}}{\Delta t} + \mathbf{A})$ 的主对角线上，而不会改变非对角元。这**增强了矩阵的[对角占优](@entry_id:748380)性**，使得线性方程组更易于使用[迭代法](@entry_id:194857)求解，特别是在 $\Delta t$ 较小时，这种增强效果尤为显著  。

后向欧拉格式是**一阶时间精度** ($p=1$) 和**[无条件稳定](@entry_id:146281)**的。它的鲁棒性使其在工程计算中得到广泛应用，尤其是当人们更关心稳态解或对瞬态过程的时间精度要求不高时。

#### Crank-Nicolson 格式 ($\theta = 1/2$)

当 $\theta=1/2$ 时，空间算子在 $t^n$ 和 $t^{n+1}$ 两个时间层上取平均值：
$$
\frac{(\rho c_p V_P) (T_P^{n+1} - T_P^n)}{\Delta t} = \frac{1}{2} \left[ R_P(T^n) + R_P(T^{n+1}) \right]
$$
这种时间[中心差分格式](@entry_id:1122205)具有**二阶时间精度** ($p=2$) 。为了理解其二阶精度的来源，我们必须澄清一个常见的误区。Crank-Nicolson 格式的求解变量仍然是存储在整数时间层 $t^n$ 和 $t^{n+1}$ 上的温度值。**半时间层 $t^{n+1/2}$** 只是一个概念上的点，格式通过在 $t^n$ 和 $t^{n+1}$ 处对通量求平均，实现了对 $t^{n+1/2}$ 处通量的二阶精确近似，而**无需在该半时间层上存储任何变量**。如果通量项[非线性](@entry_id:637147)，则需要在每个时间步内进行迭代求解以保持其[二阶精度](@entry_id:137876) 。

对于线性问题，Crank-Nicolson 格式是**无条件稳定**的。然而，它的一个主要缺点是可能在计算中引入非物理的振荡，我们将在下一节中详细讨论。

#### 前向欧拉（全显式）格式 ($\theta = 0$)

当 $\theta=0$ 时，所有右端项都在已知的旧时间层 $t^n$ 上取值：
$$
\frac{(\rho c_p V_P) (T_P^{n+1} - T_P^n)}{\Delta t} = R_P(T^n)
$$
这种格式的优点是计算简单，因为 $T_P^{n+1}$ 可以直接由 $t^n$ 时刻的已知量计算出来，无需[解线性方程组](@entry_id:136676)。然而，它的致命弱点是**有条件稳定**。对于扩散问题，时间步长 $\Delta t$ 必须满足一个严格的限制（通常与 $(\Delta x)^2$ 成正比），这使得它在求解精细网格上的慢速瞬态问题时效率极低。

### 数值精度分析：耗散与色散

选择不同的时间格式不仅仅是[精度阶数](@entry_id:145189)的不同，它们对解的质量有着更深远的影响。通过 **冯·诺伊曼稳定性分析** (或[傅里叶分析](@entry_id:137640))，我们可以量化这些影响。考虑一个一维[热传导](@entry_id:143509)问题，并假设解可以表示为一系[列空间](@entry_id:156444)傅里叶模的叠加，例如 $T_j(t) = \Re\{\hat{T}(t)\,\exp(i j \theta)\}$，其中 $j$ 是网格点索引，$\theta$ 是无量纲波数。

代入半离散方程后，我们可以得到每个模的振幅 $\hat{T}(t)$ 所遵循的[常微分方程](@entry_id:147024) $\frac{d\hat{T}}{dt} = -\lambda \hat{T}$，其中 $\lambda$ 是一个依赖于波数 $\theta$ 和空间离散的有效特征值。数值格式的作用是在一个时间步内将振幅从 $\hat{T}^n$ 更新到 $\hat{T}^{n+1}$。这个过程可以用**[放大因子](@entry_id:144315)** $G$ 来描述：$\hat{T}^{n+1} = G \hat{T}^n$。

[放大因子](@entry_id:144315) $G$ 是一个复数，它包含了关于格式性能的两个关键信息 ：
1.  **[数值耗散](@entry_id:168584) (Numerical Dissipation)**：由 $|G|$ 描述。它表示数值格式对一个模的振幅的衰减效应。物理上，[热传导](@entry_id:143509)是一个纯耗散过程，所有模态的振幅都应随时间衰减。一个理想的格式应该具有与物理衰减 $\exp(-\lambda \Delta t)$ 相匹配的 $|G|$。
2.  **[数值色散](@entry_id:145368) (Numerical Dispersion)**：由 $\arg(G)$ 描述。它表示数值格式引入的**相位误差**。对于纯扩散问题，物理上不存在相位传播，因此理想的格式应该有 $\arg(G) = 0$。非零的[相位误差](@entry_id:162993)会导致非物理的波状行为或振荡。

让我们以一个具体的例子来比较后向欧拉和 Crank-Nicolson 格式 。对于一个给定的高频模态和较大的时间步（例如，$\lambda \Delta t = 3.0$），我们发现：
- **后向欧拉格式** 的[放大因子](@entry_id:144315) $G_{BE} = \frac{1}{1 + \lambda \Delta t}$。在此例中，$G_{BE}=0.25$。这是一个正实数，所以**没有相位误差** ($\arg(G_{BE}) = 0$)。然而，其振幅 $|G_{BE}|=0.25$ 远小于精确的物理衰减 $\exp(-3.0) \approx 0.05$。这意味着后向欧拉格式具有**过度的[数值耗散](@entry_id:168584)**，它会过分地抹平解中的高频分量。
- **Crank-Nicolson 格式** 的放大因子 $G_{CN} = \frac{1 - \lambda \Delta t/2}{1 + \lambda \Delta t/2}$。在此例中，$G_{CN}=-0.2$。它的振幅 $|G_{CN}|=0.2$ 比后向欧拉更接近物理衰减，表现出较小的[数值耗散](@entry_id:168584)。但其显著的问题是，它的相位 $\arg(G_{CN}) = \pi$。这意味着该模态的振幅在每个时间步后都会反号，从而在解中产生**非物理的数值振荡**。这种振荡是 Crank-Nicolson 格式在处理具有高频分量或大时间步问题时的主要缺陷。

### 瞬态离散化的高级主题

#### 处理随温度变化的物性

在许多实际问题中，材料的密度 $\rho$ 和比热容 $c_p$ 会随温度 $T$ 变化。这给瞬态项的离散化带来了新的挑战。

从物理守恒的角度出发，我们应该追踪的是焓密度 $\rho h$ 的变化，其中 $h(T) = \int_{T_{\text{ref}}}^T c_p(\vartheta) d\vartheta$。因此，最严格的瞬态项形式是 $\frac{\partial (\rho h)}{\partial t}$。只有当密度 $\rho$ 为常数时，这才能简化为 $\rho c_p \frac{\partial T}{\partial t}$  。在 FVM 中，对时间积分后，这对应于控制体积内储存能量的精确变化：$V_P [(\rho h)_P^{n+1} - (\rho h)_P^{n}]$。

然而，在许多代码中，仍然使用 $\rho c_p \frac{\partial T}{\partial t}$ 作为出发点，这就需要决定如何在时间步内评估 $(\rho c_p)_\star$ 这一系数。有几种常见策略 ：
1.  **在 $t^n$ 时刻评估（系数滞后）**：使用 $(\rho c_p)^n$。这使得瞬态项对于 $T^{n+1}$ 是线性的，简化了代数求解。但这种方法引入了 $O(\Delta t)$ 的误差，并且当 $\rho c_p$ 随温度变化剧烈时，可能导致每个时间步内的[能量不守恒](@entry_id:276143)。
2.  **在 $t^{n+1}$ 时刻评估（全隐式）**：使用 $(\rho c_p)^{n+1}$。这与[全隐式格式](@entry_id:1125373)的精神一致，在新的时间层上满足[离散守恒](@entry_id:1123819)律。但它使得瞬态项本身也成为[非线性](@entry_id:637147)的，增加了代数方程求解的难度。
3.  **使用平均值**：例如，使用 $\frac{1}{2}((\rho c_p)^n + (\rho c_p)^{n+1})$。这相当于对焓增量积分使用了[梯形法则](@entry_id:145375)，局部精度更高。然而，整个格式的全局时间精度仍然受限于其他项（如扩散项）所使用的最低阶格式（例如后向欧拉的一阶）。

最可靠和最能保证能量守恒的方法是直接使用**焓方法**，即直接离散 $V_P [(\rho h)_P^{n+1} - (\rho h)_P^{n}]$。这避免了对 $\int \rho c_p dT$ 积分的近似，尤其在相变等 $c_p$ 剧烈变化的情况下，能显著提高计算的鲁棒性和准确性 。

#### 时间精度的验证与[非线性](@entry_id:637147)效应

为了严格验证代码实现的时间精度，**制造解方法 (Method of Manufactured Solutions, MMS)** 是一种强有力的工具。通过构造一个已知的解析解，并将其代入控制方程以生成相应的源项，我们可以用这个源项来驱动[数值模拟](@entry_id:146043)，并将计算结果与已知的制造解进行比较。通过系统地减小时间步长 $\Delta t$，我们可以测量误差的[收敛阶](@entry_id:146394)数 $p$。

对于线性问题，如果空间误差足够小，MMS 验证通常能得到理论上的[收敛阶](@entry_id:146394)：后向欧拉为 $p=1$，Crank-Nicolson 为 $p=2$。然而，在[非线性](@entry_id:637147)问题中，一个常见的现象是 Crank-Nicolson 格式的**精度退化**：观测到的[收敛阶](@entry_id:146394)数会从理论上的 $p=2$ 降至 $p \approx 1$。

这种精度退化的根源在于[非线性](@entry_id:637147)[代数方程](@entry_id:272665)组的求解方式。为了保持 Crank-Nicolson 的[二阶精度](@entry_id:137876)，在 $t^{n+1}$ 时刻的[非线性方程](@entry_id:145852)必须被精确求解。但在实践中，为了简化计算，可能会采用一些近似处理，例如：
- **系数滞后**：将[非线性系数](@entry_id:1122598)（如 $k(T^{n+1})$）用上一时间步的值 $k(T^n)$ 代替。
- **[非线性](@entry_id:637147)迭代不充分**：使用[牛顿法](@entry_id:140116)等迭代求解器时，如果[收敛判据](@entry_id:158093)设置得过于宽松，代数误差会残留下来。

这两种近似都可能在格式中引入一个与 $\Delta t$ 成正比的 $O(\Delta t)$ 的误差。这个误差会“污染”并主导 Crank-Nicolson 格式自身 $O(\Delta t^2)$ 的[截断误差](@entry_id:140949)，从而导致[全局误差](@entry_id:147874)表现为一阶收敛。只有当非线性系统在每个时间步内都得到与格式的[截断误差](@entry_id:140949)相匹配的足够精确的求解时，才能在 MMS 测试中恢复其理论上的[二阶收敛](@entry_id:174649)率 。

#### [集总质量矩阵](@entry_id:173011)与[一致质量矩阵](@entry_id:174630)

在标准的[有限体积法](@entry_id:141374)中，我们通常假设控制体积内的物理量（如温度）是分片常数，等于其中心值。在这种情况下，控制体积 $P$ 的瞬态项 $\frac{d T_P}{dt}$ 只出现在为该控制体积建立的方程中。这导致容量矩阵 $\mathbf{M}$ 是一个对角矩阵，称为**[集总质量矩阵](@entry_id:173011) (lumped mass matrix)**。其对角元为 $M_{PP} = (\rho c_p)_P V_P$。这种形式计算简单，并且保证了瞬态项[对角占优](@entry_id:748380)性的贡献。

然而，在某些有限元方法 (FEM) 或高阶 FVM 的变体中，可能会假设温度场在单元内部是连续变化的（例如，[线性插值](@entry_id:137092)）。考虑一个由[三角形单元](@entry_id:167871)构成的二维网格，温度在每个单元内由其顶点值的线性插值给出。在这种情况下，对瞬态项进行伽辽金 (Galerkin) 法处理，即用形函数作为权函数进行积分，会得到一个**[一致质量矩阵](@entry_id:174630) (consistent mass matrix)**。

对于一个线性[三角形单元](@entry_id:167871)，其单元级的[一致质量矩阵](@entry_id:174630)具有如下形式 ：
$$
\mathbf{M}_e = \frac{\rho c_p A_e}{12}
\begin{pmatrix}
2  & 1 & 1 \\
1 & 2 & 1 \\
1 & 1 & 2
\end{pmatrix}
$$
其中 $A_e$ 是单元面积。可以看到，该矩阵是非对角阵。这意味着一个顶点的温度时间变化率 $\frac{dT_i}{dt}$ 会影响到其相邻顶点的方程。将所有单元矩阵组装起来，得到的全局[一致质量矩阵](@entry_id:174630)也是非对角的（但仍是稀疏和对称的）。

这两种方法各有优劣：
- **集总质量**：计算上更高效，得到的代数系统更易求解（更强的[对角占优](@entry_id:748380)性），并且与 FVM 的分片常数物理图像天然吻合。
- **一致质量**：对于瞬态项的[空间表示](@entry_id:1132051)具有更高的精度，但计算成本更高，且可能削弱系统的[对角占优](@entry_id:748380)性。

选择哪种方法取决于对[计算效率](@entry_id:270255)和特定问题精度要求的权衡。对于大多数工程 FVM 应用，[集总质量矩阵](@entry_id:173011)因其简单性和鲁棒性而成为标准选择。