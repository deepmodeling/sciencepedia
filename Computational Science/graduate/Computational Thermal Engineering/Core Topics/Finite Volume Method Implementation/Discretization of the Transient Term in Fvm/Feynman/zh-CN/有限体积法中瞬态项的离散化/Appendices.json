{
    "hands_on_practices": [
        {
            "introduction": "在实际工程问题中，材料属性（如密度和比热容）往往在空间上并非均匀分布。本练习将引导您从最基本的能量守恒积分形式出发，推导当控制体积内的热容 $\\rho c_p$ 存在空间变化时瞬态项的离散格式。通过该练习，您将掌握如何通过体积平均来严谨地处理非均匀介质，从而深化对有限体积法物理本质的理解 ()。",
            "id": "3948677",
            "problem": "考虑一个无宏观运动的非均匀固体中的非稳态热传导，其在局部层面受热能平衡控制。设 $P$ 是一个用于单元中心有限体积法 (FVM) 的控制体。需要离散化的瞬态项是局部热量储存率的时空积分。假设体积热容 $\\rho c_p$ 在 $P$ 内部可以随空间变化，但在单个时间步长 $[t^n, t^{n+1}]$ 内不随时间变化，并且单元中心的温度场在 $t^n$ 和 $t^{n+1}$ 时刻在 $P$ 内部被近似为空间均匀的（即，对于所有 $\\boldsymbol{x} \\in V_P$，有 $T(\\boldsymbol{x}, t^n) \\approx T_P^n$ 和 $T(\\boldsymbol{x}, t^{n+1}) \\approx T_P^{n+1}$）。\n\n1) 从控制体 $P$ 的能量守恒出发，对瞬态储存项进行时空积分，推导出一个形式为 $C_P \\left(T_P^{n+1} - T_P^n\\right)$ 的离散瞬态贡献项，并找出 $C_P$ 的显式表达式，该表达式应使用 $\\rho c_p$ 在 $V_P$ 上的空间积分和时间步长 $\\Delta t = t^{n+1}-t^n$ 来表示。您的推导必须从瞬态储存的积分表达式开始，并通过与上述假设一致且数学上合理的近似来推进。\n\n2) 现在，特化到一个中心位于 $(x_c,y_c,z_c)$、边长为 $\\Delta x$, $\\Delta y$, $\\Delta z$ 的矩形控制体，因此 $V_P = \\Delta x\\,\\Delta y\\,\\Delta z$ 并且局部坐标 $(\\xi,\\eta,\\zeta) \\equiv (x-x_c, y-y_c, z-z_c)$ 各自在对称区间 $\\xi \\in [-\\Delta x/2, \\Delta x/2]$, $\\eta \\in [-\\Delta y/2, \\Delta y/2]$, $\\zeta \\in [-\\Delta z/2, \\Delta z/2]$ 内变化。假设 $P$ 内部体积热容的空间变化由以下多项式给出：\n$$\n\\rho c_p(x,y,z) \\;=\\; A_0 \\;+\\; A_1\\,\\xi \\;+\\; A_2\\,\\eta \\;+\\; A_3\\,\\zeta \\;+\\; A_4\\,\\xi^2 \\;+\\; A_5\\,\\eta^2 \\;+\\; A_6\\,\\zeta^2 \\;+\\; A_7\\,\\xi\\eta \\;+\\; A_8\\,\\eta\\zeta \\;+\\; A_9\\,\\zeta\\xi,\n$$\n其系数和尺寸为\n$$\nA_0 = 2.20\\times 10^6\\ \\text{J m}^{-3}\\text{K}^{-1},\\quad A_1 = 1.50\\times 10^5\\ \\text{J m}^{-4}\\text{K}^{-1},\\quad A_2 = -8.00\\times 10^4\\ \\text{J m}^{-4}\\text{K}^{-1},\n$$\n$$\nA_3 = 3.00\\times 10^4\\ \\text{J m}^{-4}\\text{K}^{-1},\\quad A_4 = 8.00\\times 10^8\\ \\text{J m}^{-5}\\text{K}^{-1},\\quad A_5 = -3.00\\times 10^8\\ \\text{J m}^{-5}\\text{K}^{-1},\n$$\n$$\nA_6 = 5.00\\times 10^8\\ \\text{J m}^{-5}\\text{K}^{-1},\\quad A_7 = 2.00\\times 10^8\\ \\text{J m}^{-5}\\text{K}^{-1},\\quad A_8 = -1.00\\times 10^8\\ \\text{J m}^{-5}\\text{K}^{-1},\\quad A_9 = 0.50\\times 10^8\\ \\text{J m}^{-5}\\text{K}^{-1},\n$$\n以及\n$$\n\\Delta x = 0.020\\ \\text{m},\\quad \\Delta y = 0.010\\ \\text{m},\\quad \\Delta z = 0.015\\ \\text{m},\\quad \\Delta t = 0.50\\ \\text{s}.\n$$\n使用您在第 1 部分中得到的结果，为此多项式场评估您的推导所隐含的空间平均值，并计算相应的离散瞬态系数 $C_P$。将您最终的 $C_P$ 数值结果四舍五入到六位有效数字。以 $\\text{W K}^{-1}$ 为单位表示您的最终答案。",
            "solution": "该问题被验证为具有科学依据、适定且客观。它基于能量守恒的基本原理以及计算传热学中有限体积法（FVM）的标准实践。所提供的数据是完整的、量纲一致的且物理上合理的。\n\n### 第 1 部分：离散瞬态项的推导\n\n在无内部热源的固体中，非稳态热传导的局部能量守恒方程为：\n$$\n\\frac{\\partial}{\\partial t}(\\rho c_p T) = \\nabla \\cdot (k \\nabla T)\n$$\n其中 $\\rho c_p$ 是体积热容，$T$ 是温度，$k$ 是导热系数。在有限体积法中，该方程在一个控制体 $V_P$ 和一个时间区间 $\\Delta t = t^{n+1} - t^n$ 上进行积分。我们关注瞬态（储存）项，首先将局部储存率 $\\rho c_p \\frac{\\partial T}{\\partial t}$ 在控制体 $V_P$ 和时间区间 $[t^n, t^{n+1}]$ 上积分。这给出了在一个时间步长内控制体中储存能量的总变化量 $\\Delta E_P$。\n$$\n\\Delta E_P = \\int_{t^n}^{t^{n+1}} \\left( \\int_{V_P} \\rho c_p(\\boldsymbol{x}) \\frac{\\partial T(\\boldsymbol{x}, t)}{\\partial t} dV \\right) dt\n$$\n问题陈述 $\\rho c_p$ 在该时间区间内不随时间变化，因此它只依赖于空间坐标 $\\boldsymbol{x}$。我们可以交换积分顺序（根据 Fubini 定理）并将 $\\rho c_p(\\boldsymbol{x})$ 移到时间积分之外：\n$$\n\\Delta E_P = \\int_{V_P} \\rho c_p(\\boldsymbol{x}) \\left( \\int_{t^n}^{t^{n+1}} \\frac{\\partial T(\\boldsymbol{x}, t)}{\\partial t} dt \\right) dV\n$$\n内部关于时间的积分计算结果为每个点 $\\boldsymbol{x}$ 的温度变化：\n$$\n\\int_{t^n}^{t^{n+1}} \\frac{\\partial T(\\boldsymbol{x}, t)}{\\partial t} dt = T(\\boldsymbol{x}, t^{n+1}) - T(\\boldsymbol{x}, t^n)\n$$\n将此代回 $\\Delta E_P$ 的表达式中：\n$$\n\\Delta E_P = \\int_{V_P} \\rho c_p(\\boldsymbol{x}) \\left[ T(\\boldsymbol{x}, t^{n+1}) - T(\\boldsymbol{x}, t^n) \\right] dV\n$$\n现在，我们应用 FVM 近似，即温度场在时间步长的开始和结束时在控制体 $V_P$ 内是空间均匀的：\n$$\nT(\\boldsymbol{x}, t^n) \\approx T_P^n \\quad \\text{和} \\quad T(\\boldsymbol{x}, t^{n+1}) \\approx T_P^{n+1} \\quad \\text{对于所有 } \\boldsymbol{x} \\in V_P\n$$\n在此近似下，温差 $(T_P^{n+1} - T_P^n)$ 相对于空间积分是一个常数，可以从积分中提取出来：\n$$\n\\Delta E_P \\approx \\int_{V_P} \\rho c_p(\\boldsymbol{x}) \\left( T_P^{n+1} - T_P^n \\right) dV = \\left( T_P^{n+1} - T_P^n \\right) \\int_{V_P} \\rho c_p(\\boldsymbol{x}) dV\n$$\n出现在能量平衡方程中的离散化瞬态项是储存能量变化的时间平均率，近似为 $\\frac{\\Delta E_P}{\\Delta t}$。因此，离散瞬态贡献项为：\n$$\n\\text{瞬态项} = \\frac{\\Delta E_P}{\\Delta t} = \\frac{1}{\\Delta t} \\left( \\int_{V_P} \\rho c_p(\\boldsymbol{x}) dV \\right) \\left( T_P^{n+1} - T_P^n \\right)\n$$\n通过将此表达式与所需形式 $C_P \\left(T_P^{n+1} - T_P^n\\right)$ 进行比较，我们可以确定系数 $C_P$ 为：\n$$\nC_P = \\frac{1}{\\Delta t} \\int_{V_P} \\rho c_p(\\boldsymbol{x}) dV\n$$\n\n### 第 2 部分：系数 $C_P$ 的评估\n\n为了评估 $C_P$，我们必须首先计算随空间变化的体积热容 $\\rho c_p$ 在指定的矩形控制体 $V_P$ 上的积分。控制体由 $\\xi \\in [-\\frac{\\Delta x}{2}, \\frac{\\Delta x}{2}]$, $\\eta \\in [-\\frac{\\Delta y}{2}, \\frac{\\Delta y}{2}]$ 和 $\\zeta \\in [-\\frac{\\Delta z}{2}, \\frac{\\Delta z}{2}]$ 定义。积分为：\n$$\n\\int_{V_P} \\rho c_p(\\boldsymbol{x}) dV = \\int_{-\\Delta z/2}^{\\Delta z/2} \\int_{-\\Delta y/2}^{\\Delta y/2} \\int_{-\\Delta x/2}^{\\Delta x/2} \\rho c_p(\\xi, \\eta, \\zeta) \\, d\\xi \\, d\\eta \\, d\\zeta\n$$\n$\\rho c_p$ 的多项式为：\n$$\n\\rho c_p = A_0 + A_1\\xi + A_2\\eta + A_3\\zeta + A_4\\xi^2 + A_5\\eta^2 + A_6\\zeta^2 + A_7\\xi\\eta + A_8\\eta\\zeta + A_9\\zeta\\xi\n$$\n我们逐项对该多项式进行积分。由于积分域关于 $\\xi=0$, $\\eta=0$ 和 $\\zeta=0$ 对称，任何包含 $\\xi$, $\\eta$ 或 $\\zeta$ 奇次幂的项积分结果都为零。这包括系数为 $A_1$, $A_2$, $A_3$, $A_7$, $A_8$ 和 $A_9$ 的项。唯一产生非零结果的项是常数项和纯二次项：\n$$\n\\int_{V_P} \\rho c_p dV = \\int_{V_P} (A_0 + A_4\\xi^2 + A_5\\eta^2 + A_6\\zeta^2) dV\n$$\n让我们对这些项中的每一项计算积分：\n$$\n\\int_{V_P} A_0 \\, dV = A_0 \\int_{-\\Delta z/2}^{\\Delta z/2} \\int_{-\\Delta y/2}^{\\Delta y/2} \\int_{-\\Delta x/2}^{\\Delta x/2} d\\xi d\\eta d\\zeta = A_0 \\Delta x \\Delta y \\Delta z = A_0 V_P\n$$\n$$\n\\int_{V_P} A_4\\xi^2 \\, dV = A_4 \\left(\\int_{-\\Delta x/2}^{\\Delta x/2} \\xi^2 d\\xi\\right) \\left(\\int_{-\\Delta y/2}^{\\Delta y/2} d\\eta\\right) \\left(\\int_{-\\Delta z/2}^{\\Delta z/2} d\\zeta\\right) = A_4 \\left[\\frac{\\xi^3}{3}\\right]_{-\\Delta x/2}^{\\Delta x/2} \\Delta y \\Delta z = A_4 \\frac{(\\Delta x)^3}{12} \\Delta y \\Delta z = A_4 \\frac{(\\Delta x)^2}{12} V_P\n$$\n对于 $\\eta^2$ 和 $\\zeta^2$ 项，通过类似的逻辑可得：\n$$\n\\int_{V_P} A_5\\eta^2 \\, dV = A_5 \\frac{(\\Delta y)^2}{12} V_P \\quad \\text{和} \\quad \\int_{V_P} A_6\\zeta^2 \\, dV = A_6 \\frac{(\\Delta z)^2}{12} V_P\n$$\n将这些贡献相加，我们得到总积分：\n$$\n\\int_{V_P} \\rho c_p dV = \\left( A_0 + A_4 \\frac{(\\Delta x)^2}{12} + A_5 \\frac{(\\Delta y)^2}{12} + A_6 \\frac{(\\Delta z)^2}{12} \\right) V_P\n$$\n括号中的表达式对应于体积平均的体积热容 $\\overline{(\\rho c_p)}_{V_P}$：\n$$\n\\overline{(\\rho c_p)}_{V_P} = \\frac{1}{V_P}\\int_{V_P} \\rho c_p dV = A_0 + \\frac{A_4(\\Delta x)^2}{12} + \\frac{A_5(\\Delta y)^2}{12} + \\frac{A_6(\\Delta z)^2}{12}\n$$\n现在，我们代入给定的数值：\n$\\Delta x = 0.020\\ \\text{m}$, $\\Delta y = 0.010\\ \\text{m}$, $\\Delta z = 0.015\\ \\text{m}$.\n$A_0 = 2.20 \\times 10^6\\ \\text{J m}^{-3}\\text{K}^{-1}$\n$A_4 = 8.00 \\times 10^8\\ \\text{J m}^{-5}\\text{K}^{-1}$\n$A_5 = -3.00 \\times 10^8\\ \\text{J m}^{-5}\\text{K}^{-1}$\n$A_6 = 5.00 \\times 10^8\\ \\text{J m}^{-5}\\text{K}^{-1}$\n\n让我们计算平均值的每一项：\n$$\n\\frac{A_4(\\Delta x)^2}{12} = \\frac{(8.00 \\times 10^8)(0.020)^2}{12} = \\frac{(8.00 \\times 10^8)(4 \\times 10^{-4})}{12} = \\frac{3.2 \\times 10^5}{12} \\approx 26666.67\\ \\text{J m}^{-3}\\text{K}^{-1}\n$$\n$$\n\\frac{A_5(\\Delta y)^2}{12} = \\frac{(-3.00 \\times 10^8)(0.010)^2}{12} = \\frac{(-3.00 \\times 10^8)(1 \\times 10^{-4})}{12} = \\frac{-3.0 \\times 10^4}{12} = -2500\\ \\text{J m}^{-3}\\text{K}^{-1}\n$$\n$$\n\\frac{A_6(\\Delta z)^2}{12} = \\frac{(5.00 \\times 10^8)(0.015)^2}{12} = \\frac{(5.00 \\times 10^8)(2.25 \\times 10^{-4})}{12} = \\frac{1.125 \\times 10^5}{12} = 9375\\ \\text{J m}^{-3}\\text{K}^{-1}\n$$\n体积平均热容为：\n$$\n\\overline{(\\rho c_p)}_{V_P} = (2.20 \\times 10^6) + 26666.66... - 2500 + 9375 = 2233541.66...\\ \\text{J m}^{-3}\\text{K}^{-1}\n$$\n接下来，我们使用控制体体积 $V_P = \\Delta x \\Delta y \\Delta z = (0.020)(0.010)(0.015) = 3.0 \\times 10^{-6}\\ \\text{m}^3$ 来计算积分。\n$$\n\\int_{V_P} \\rho c_p dV = \\overline{(\\rho c_p)}_{V_P} \\times V_P = (2233541.66...) \\times (3.0 \\times 10^{-6}) = 6.700625\\ \\text{J K}^{-1}\n$$\n最后，我们使用 $\\Delta t = 0.50\\ \\text{s}$ 计算 $C_P$：\n$$\nC_P = \\frac{1}{\\Delta t} \\int_{V_P} \\rho c_p dV = \\frac{6.700625\\ \\text{J K}^{-1}}{0.50\\ \\text{s}} = 13.40125\\ \\text{W K}^{-1}\n$$\n按要求将结果四舍五入到六位有效数字：\n$$\nC_P \\approx 13.4013\\ \\text{W K}^{-1}\n$$",
            "answer": "$$\n\\boxed{13.4013}\n$$"
        },
        {
            "introduction": "理论分析为我们提供了关于误差行为的预期，但我们如何验证一个实际的计算程序是否符合这些预期呢？本练习将指导您运用“制造解法”（Method of Manufactured Solutions, MMS），这是一个在代码验证中极为重要的标准技术。您将通过编写程序，用经验数据来测量不同时间积分格式（如后向欧拉法和Crank-Nicolson法）的实际收敛阶数，从而将理论知识与编程实践紧密结合起来 ()。",
            "id": "3948678",
            "problem": "考虑一维瞬态热传导问题，其在一根均匀杆中由能量守恒定律支配，该杆具有恒定的密度 $\\rho$、比热 $c_p$ 和热导率 $k$。在长度为 $L$ 的周期性域上，温度场 $T(x,t)$ 的控制偏微分方程 (PDE) 为\n$$\n\\rho c_p \\,\\frac{\\partial T}{\\partial t} \\;=\\; k\\,\\frac{\\partial^{2} T}{\\partial x^{2}}.\n$$\n设初始温度为单个空间傅里叶模式 $T(x,0) = \\theta_0 \\sin\\!\\left(\\frac{2\\pi m}{L} x\\right)$，其中 $m \\ge 1$ 为整数，振幅为 $\\theta_0$。用均匀网格离散空间域，并应用有限体积法 (FVM)，对扩散项使用二阶中心差分，从而使得半离散系统（每个控制体积一个常微分方程）在傅里叶基下是线性的、自治的且可对角化的。对于此单一激励模式，半离散演化简化为一个标量振幅方程\n$$\n\\frac{d \\theta}{d t} \\;=\\; -\\,\\lambda\\,\\theta,\n$$\n其中 $\\lambda>0$ 是与所选空间模式和网格相关的正常数半离散扩散率，且 $\\theta(0)=\\theta_0$。\n\n从精确的初始条件开始，通过在大小为 $\\Delta t>0$ 的均匀时间步长上使用向后欧拉法离散瞬态项，来对半离散系统进行时间推进。将第 $n$ 步的局部截断误差定义为将精确解代入离散更新方程所得到的单步残差，并将最终时间 $t=T$ 时的全局时间离散误差定义为 $E(T)=\\theta^{\\Delta t}(T) - \\theta(T)$，其中 $\\theta^{\\Delta t}$ 是由向后欧拉法产生的数值解，$\\theta$ 是精确的半离散解。\n\n从守恒定律和有限体积法半离散化这些第一性原理出发，推导在此线性设定下，通过在 $[0,T]$ 上累积局部截断误差而得到的全局时间离散误差的积分（或求和）表示。然后，利用精确解的结构和正则性，提取当 $\\Delta t \\to 0$ 时 $E(T)$ 关于 $\\Delta t$、$T$、$\\lambda$ 和 $\\theta_0$ 的主阶渐近表达式，仅保留第一个非零项。\n\n将您的最终答案表示为 $E(T)$ 主阶项的单一闭式解析表达式，单位为开尔文。未提供数值；您必须以符号形式给出表达式。最终答案不允许是不等式或方程。无需四舍五入；不要进行超出 $\\Delta t$ 主阶截断的近似。",
            "solution": "该问题要求推导由一维瞬态热方程的有限体积法 (FVM) 半离散化产生的模型常微分方程 (ODE) 的主阶全局时间离散误差。推导过程必须首先通过累积局部截断误差来找到全局误差的积分或求和表示，然后在此表示的小时间步长渐近极限下进行求值。\n\n起点是给定的单个傅里叶模式的半离散标量振幅方程：\n$$\n\\frac{d \\theta}{d t} = -\\lambda \\theta(t)\n$$\n初始条件为 $\\theta(0) = \\theta_0$。这里，$\\theta(t)$ 表示在时间 $t$ 的空间模式振幅，$\\lambda > 0$ 是来自空间离散化的有效扩散率。这是一个线性的、一阶的、常系数的常微分方程。其精确解析解为：\n$$\n\\theta(t) = \\theta_0 \\exp(-\\lambda t)\n$$\n\n时间离散化是使用向后欧拉法，采用均匀时间步长 $\\Delta t > 0$ 进行的。令 $\\theta^n$ 表示在时间 $t_n = n \\Delta t$ 时 $\\theta(t_n)$ 的数值近似。应用于该常微分方程的向后欧拉格式为：\n$$\n\\frac{\\theta^{n+1} - \\theta^n}{\\Delta t} = -\\lambda \\theta^{n+1}\n$$\n\n局部截断误差 (LTE)，记为 $\\tau_{n+1}$，定义为将精确解 $\\theta(t)$ 代入有限差分方程时产生的残差。\n$$\n\\frac{\\theta(t_{n+1}) - \\theta(t_n)}{\\Delta t} = -\\lambda \\theta(t_{n+1}) + \\tau_{n+1}\n$$\n重新整理以求解 LTE，得到：\n$$\n\\tau_{n+1} = \\frac{\\theta(t_{n+1}) - \\theta(t_n)}{\\Delta t} + \\lambda \\theta(t_{n+1})\n$$\n为求出当 $\\Delta t \\to 0$ 时 $\\tau_{n+1}$ 的主阶行为，我们对 $\\theta(t_n)$ 在点 $t_{n+1}$ 附近进行泰勒级数展开：\n$$\n\\theta(t_n) = \\theta(t_{n+1} - \\Delta t) = \\theta(t_{n+1}) - \\Delta t \\frac{d\\theta}{dt}\\bigg|_{t_{n+1}} + \\frac{(\\Delta t)^2}{2} \\frac{d^2\\theta}{dt^2}\\bigg|_{t_{n+1}} - O((\\Delta t)^3)\n$$\n将此展开式代入 $\\tau_{n+1}$ 的表达式中：\n$$\n\\tau_{n+1} = \\frac{1}{\\Delta t} \\left[ \\theta(t_{n+1}) - \\left( \\theta(t_{n+1}) - \\Delta t \\theta'(t_{n+1}) + \\frac{(\\Delta t)^2}{2} \\theta''(t_{n+1}) - \\dots \\right) \\right] + \\lambda \\theta(t_{n+1})\n$$\n$$\n\\tau_{n+1} = \\left( \\theta'(t_{n+1}) + \\lambda \\theta(t_{n+1}) \\right) - \\frac{\\Delta t}{2} \\theta''(t_{n+1}) + O((\\Delta t)^2)\n$$\n由于 $\\theta(t)$ 是该常微分方程的精确解，括号中的项为零：对于所有 $t$，$\\theta'(t) + \\lambda \\theta(t) = 0$。因此，局部截断误差的主阶项为：\n$$\n\\tau_{n+1} = -\\frac{\\Delta t}{2} \\theta''(t_{n+1}) + O((\\Delta t)^2)\n$$\n\n接下来，我们推导全局误差的演化方程，其定义为 $e^n = \\theta^n - \\theta(t_n)$。我们有数值格式和包含 LTE 的精确解方程：\n1. 数值格式： $\\theta^{n+1} - \\theta^n = -\\lambda \\Delta t \\theta^{n+1} \\implies \\theta^{n+1}(1 + \\lambda \\Delta t) = \\theta^n$\n2. 精确解： $\\theta(t_{n+1}) - \\theta(t_n) = -\\lambda \\Delta t \\theta(t_{n+1}) + \\Delta t \\tau_{n+1} \\implies \\theta(t_{n+1})(1 + \\lambda \\Delta t) = \\theta(t_n) + \\Delta t \\tau_{n+1}$\n用第一个方程减去第二个方程，得到全局误差的递推关系：\n$$\n(\\theta^{n+1} - \\theta(t_{n+1}))(1 + \\lambda \\Delta t) = (\\theta^n - \\theta(t_n)) - \\Delta t \\tau_{n+1}\n$$\n$$\ne^{n+1}(1 + \\lambda \\Delta t) = e^n - \\Delta t \\tau_{n+1} \\implies e^{n+1} = \\frac{1}{1 + \\lambda \\Delta t} e^n - \\frac{\\Delta t}{1 + \\lambda \\Delta t} \\tau_{n+1}\n$$\n初始条件是精确的，所以 $e^0 = \\theta^0 - \\theta(0) = \\theta_0 - \\theta_0 = 0$。我们可以展开这个递推关系，以求出在最终时间 $T = N \\Delta t$ 时的全局误差 $E(T) = e^N$：\n$e^1 = - \\frac{\\Delta t}{1 + \\lambda \\Delta t} \\tau_1$\n$e^2 = \\frac{1}{1 + \\lambda \\Delta t} e^1 - \\frac{\\Delta t}{1 + \\lambda \\Delta t} \\tau_2 = - \\frac{\\Delta t}{(1 + \\lambda \\Delta t)^2} \\tau_1 - \\frac{\\Delta t}{1 + \\lambda \\Delta t} \\tau_2$\n通过归纳法，第 $N$ 步的全局误差是在先前步骤中产生的所有经过缩放的局部截断误差之和：\n$$\nE(T) = e^N = - \\Delta t \\sum_{j=1}^{N} \\frac{\\tau_j}{(1 + \\lambda \\Delta t)^{N-j+1}}\n$$\n这就是所要求的全局误差的求和表示。\n\n为了找到主阶渐近表达式，我们将 $\\tau_j \\approx -\\frac{\\Delta t}{2} \\theta''(t_j)$ 的主阶项代入此和式：\n$$\nE(T) \\approx - \\Delta t \\sum_{j=1}^{N} \\frac{-\\frac{\\Delta t}{2} \\theta''(t_j)}{(1 + \\lambda \\Delta t)^{N-j+1}} = \\frac{(\\Delta t)^2}{2} \\sum_{j=1}^{N} \\frac{\\theta''(t_j)}{(1 + \\lambda \\Delta t)^{N-j+1}}\n$$\n现在我们在保持 $T = N \\Delta t$ 恒定的情况下，在 $\\Delta t \\to 0$ 的极限下分析此和式。令 $t_j = j \\Delta t$。分母可以近似为：\n$$\n(1 + \\lambda \\Delta t)^{-(N-j+1)} \\approx (1 + \\lambda \\Delta t)^{-(N-j)} = (1 + \\lambda \\Delta t)^{-(T-t_j)/\\Delta t}\n$$\n使用指数函数的极限定义 $\\lim_{x\\to 0} (1+ax)^{b/x} = \\exp(ab)$，我们有：\n$$\n\\lim_{\\Delta t \\to 0} (1 + \\lambda \\Delta t)^{-(T-t_j)/\\Delta t} = \\exp(-\\lambda(T-t_j))\n$$\n因此，该和式可以由一个黎曼积分来近似。稍微重新整理表达式：\n$$\nE(T) \\approx \\frac{\\Delta t}{2} \\sum_{j=1}^{N} \\frac{\\theta''(t_j)}{(1 + \\lambda \\Delta t)^{N-j+1}} \\Delta t\n$$\n在 $\\Delta t \\to 0$ 的极限下，这变为：\n$$\nE(T) \\approx \\frac{\\Delta t}{2} \\int_0^T \\exp(-\\lambda(T-t)) \\theta''(t) dt\n$$\n为计算该积分，我们需要精确解 $\\theta(t) = \\theta_0 \\exp(-\\lambda t)$ 的二阶导数：\n$$\n\\theta'(t) = -\\lambda \\theta_0 \\exp(-\\lambda t)\n$$\n$$\n\\theta''(t) = (-\\lambda)^2 \\theta_0 \\exp(-\\lambda t) = \\lambda^2 \\theta_0 \\exp(-\\lambda t)\n$$\n将此代入积分中：\n$$\nE(T) \\approx \\frac{\\Delta t}{2} \\int_0^T \\exp(-\\lambda(T-t)) \\left( \\lambda^2 \\theta_0 \\exp(-\\lambda t) \\right) dt\n$$\n$$\nE(T) \\approx \\frac{\\Delta t \\lambda^2 \\theta_0}{2} \\int_0^T \\exp(-\\lambda T + \\lambda t - \\lambda t) dt = \\frac{\\Delta t \\lambda^2 \\theta_0}{2} \\int_0^T \\exp(-\\lambda T) dt\n$$\n项 $\\exp(-\\lambda T)$ 相对于积分变量 $t$ 是一个常数：\n$$\nE(T) \\approx \\frac{\\Delta t \\lambda^2 \\theta_0 \\exp(-\\lambda T)}{2} \\int_0^T dt = \\frac{\\Delta t \\lambda^2 \\theta_0 \\exp(-\\lambda T)}{2} [t]_0^T\n$$\n$$\nE(T) \\approx \\frac{\\Delta t \\lambda^2 \\theta_0 T \\exp(-\\lambda T)}{2}\n$$\n这就是在最终时间 $T$ 的全局时间离散误差的主阶渐近表达式。它在 $\\Delta t$ 上是一阶的，这是向后欧拉法已知的精度阶数。\n\n$E(T)$ 的主阶项的最终表达式为：\n$$\nE(T) \\approx \\frac{1}{2} \\lambda^2 T \\theta_0 \\exp(-\\lambda T) \\Delta t\n$$",
            "answer": "$$\n\\boxed{\\frac{1}{2} \\lambda^{2} T \\theta_{0} \\exp(-\\lambda T) \\Delta t}\n$$"
        },
        {
            "introduction": "理论分析为我们提供了关于误差行为的预期，但我们如何验证一个实际的计算程序是否符合这些预期呢？本练习将指导您运用“制造解法”（Method of Manufactured Solutions, MMS），这是一个在代码验证中极为重要的标准技术。您将通过编写程序，用经验数据来测量不同时间积分格式（如后向欧拉法和Crank-Nicolson法）的实际收敛阶数，从而将理论知识与编程实践紧密结合起来 ()。",
            "id": "3948713",
            "problem": "要求你编写一个完整的程序，使用制造解方法（Method of Manufactured Solutions, MMS）计算一维热传导的有限体积法（Finite Volume Method, FVM）中瞬态项时间离散的观测到的时间收敛阶。其目的在于，通过在固定的空间网格上加密时间步长 $\\Delta t$ 并拟合误差范数，从而根据经验估算数值误差与时间步长大小关系中的指数。本问题中的所有量均为无量纲和无单位的。\n\n此任务的基本依据是热能守恒和经典热传导模型。考虑一个一维空间域 $x \\in [0,1]$，其上有一个均匀的单元中心网格和狄利克雷边界条件。设 $u(x,t)$ 是满足无量纲热方程的温度场\n$$\nu_t = \\alpha\\,u_{xx} + s(x,t),\n$$\n其中 $u_t$ 是时间导数，$u_{xx}$ 是空间二阶导数，$\\alpha$ 是一个常数扩散系数，$s(x,t)$ 是一个源项，其构造方式使得所选的制造解 $u(x,t)$ 是该连续方程的精确解。在一个包含 $N_x$ 个控制体积、单元中心为 $x_i$、间距为 $\\Delta x$ 的均匀网格上，扩散项使用二阶中心有限体积格式进行近似，并通过将 $x=0$ 和 $x=1$ 处的边界值作为已知贡献项注入离散算子来强制施加狄利克雷边界值。时间推进必须使用应用于半离散 FVM 常微分方程的单参数 $\\theta$ 方法，其中 $\\theta \\in [0,1]$ 定义了该方法族（例如，$\\theta=1$ 为后向欧拉法，$\\theta=1/2$ 为 Crank-Nicolson 方法）。你必须确定离散系统并加以实现，不得使用问题文本中给出的捷径公式。\n\n你的程序必须实现以下步骤：\n- 固定一个具有 $N_x$ 个控制体积和 $\\Delta x = 1/N_x$ 的均匀空间网格，并施加等于边界上制造解值的狄利克雷边界条件。\n- 对于每个测试用例，选择 $\\alpha$、$\\theta$、一个制造解 $u(x,t)$ 及其源项 $s(x,t)$，该源项的推导需使 $u(x,t)$ 精确求解连续方程。\n- 从制造解初始化 $u(x,0)$。\n- 在保持空间网格固定的情况下，使用所选的 $\\theta$ 方法对半离散 FVM 系统进行时间推进，从 $t=0$ 到最终时间 $T$，并采用几个加密的时间步长 $\\Delta t$。\n- 在 $t=T$ 时，计算每个单元中心的离散误差 $e_i = u_i^{\\text{num}}(T) - u(x_i,T)$，然后计算：\n  - 离散 $L_2$ 范数，\n    $$\n    \\|e\\|_{2,\\Delta x} = \\left( \\sum_{i=1}^{N_x} e_i^2 \\,\\Delta x \\right)^{1/2},\n    $$\n  - 离散 $L_\\infty$ 范数，\n    $$\n    \\|e\\|_{\\infty} = \\max_{1\\le i \\le N_x} |e_i|.\n    $$\n- 对于每种范数，对加密集上的 $\\log(\\|e\\|)$ 与 $\\log(\\Delta t)$ 进行最小二乘线性拟合，以估计由 $\\|e\\| \\propto (\\Delta t)^p$ 定义的观测到的时间阶 $p$。报告拟合得到的斜率 $p$。\n\n使用以下参数值测试套件，该套件旨在探究瞬态离散化的不同方面和边界情况：\n- 测试用例 1（基准一阶隐式）：\n  - $\\theta = 1$,\n  - $\\alpha = 1$,\n  - 制造解 $u(x,t) = \\exp(-t)\\,\\sin(\\pi x)$，源项 $s(x,t)$ 的选择使得此 $u$ 精确求解连续方程，\n  - 狄利克雷边界条件 $u(0,t)$ 和 $u(1,t)$ 等于制造解的值，\n  - $N_x = 200$,\n  - 最终时间 $T = 0.4$,\n  - 时间步长加密 $\\Delta t \\in \\{0.05,\\;0.025,\\;0.0125,\\;0.00625\\}$。\n- 测试用例 2（二阶隐式梯形）：\n  - $\\theta = 1/2$,\n  - $\\alpha = 1$,\n  - 制造解 $u(x,t) = \\exp(-t)\\,\\sin(\\pi x)$，源项 $s(x,t)$ 的选择使得此 $u$ 精确求解连续方程，\n  - 狄利克雷边界条件等于制造解的值，\n  - $N_x = 200$,\n  - 最终时间 $T = 0.4$,\n  - 时间步长加密与测试用例 1 相同。\n- 测试用例 3（纯瞬态，无扩散）：\n  - $\\theta = 1$,\n  - $\\alpha = 0$,\n  - 制造解 $u(x,t) = \\cos(2t)\\,\\sin(\\pi x)$，源项 $s(x,t)$ 的选择使得此 $u$ 精确求解连续方程，\n  - 狄利克雷边界条件等于制造解的值，\n  - $N_x = 200$,\n  - 最终时间 $T = 0.4$,\n  - 时间步长加密与测试用例 1 相同。\n\n你的程序必须为每个测试用例计算两个浮点数：\n- 从离散 $L_2$ 范数拟合得到的观测时间阶 $p_{2}$，\n- 从离散 $L_\\infty$ 范数拟合得到的观测时间阶 $p_{\\infty}$。\n\n最终输出格式：\n- 你的程序应生成单行输出，包含六个结果，形式为逗号分隔的列表，并用方括号括起来，顺序为\n  $[p_{2}^{(1)}, p_{2}^{(2)}, p_{2}^{(3)}, p_{\\infty}^{(1)}, p_{\\infty}^{(2)}, p_{\\infty}^{(3)}]$,\n  其中上标表示测试用例编号。\n- 每个浮点数必须四舍五入到三位小数。\n- 例如，输出行可能看起来像 `[0.998,1.985,1.000,0.999,1.987,1.000]`。\n\n所有量均为无量纲；不需要物理单位。三角函数中的角度（如果存在）以弧度为单位。程序必须是自包含的，无需输入，并且仅使用指定的库。",
            "solution": "经评估，用户提供的问题是**有效**的。这是一个来自计算科学与工程领域的适定、有科学依据且客观的任务。该问题要求使用经验方法确定应用于一维热方程的 $\\theta$ 方法的时间收敛阶，这是数值分析中的一个标准练习。制造解方法是一种严格的验证技术。所有参数和步骤都已明确指定。因此，我们可以着手提供完整的解答。\n\n问题的核心是在域 $x \\in [0, 1]$ 和 $t \\ge 0$ 上求解无量纲热方程：\n$$\n\\frac{\\partial u}{\\partial t} = \\alpha \\frac{\\partial^2 u}{\\partial x^2} + s(x,t)\n$$\n其中 $u(x,t)$ 是温度，$\\alpha$ 是热扩散系数，$s(x,t)$ 是一个源项。该源项经过特殊构造，使得一个选定的“制造”解是这个连续偏微分方程（PDE）的精确解。\n\n### 1. 制造解与源项推导\n\n制造解方法（MMS）要求我们通过将制造解 $u(x,t)$ 代入控制方程来推导源项 $s(x,t)$：\n$$\ns(x,t) = \\frac{\\partial u}{\\partial t} - \\alpha \\frac{\\partial^2 u}{\\partial x^2}\n$$\n\n**对于测试用例 1 和 2：**\n制造解为 $u(x,t) = \\exp(-t)\\sin(\\pi x)$，扩散系数为 $\\alpha=1$。\n偏导数如下：\n$$\n\\frac{\\partial u}{\\partial t} = -\\exp(-t)\\sin(\\pi x)\n$$\n$$\n\\frac{\\partial u}{\\partial x} = \\pi\\exp(-t)\\cos(\\pi x) \\quad \\implies \\quad \\frac{\\partial^2 u}{\\partial x^2} = -\\pi^2\\exp(-t)\\sin(\\pi x)\n$$\n将这些代入 $s(x,t)$ 的表达式中：\n$$\ns(x,t) = \\left(-\\exp(-t)\\sin(\\pi x)\\right) - (1)\\left(-\\pi^2\\exp(-t)\\sin(\\pi x)\\right) = (\\pi^2 - 1)\\exp(-t)\\sin(\\pi x)\n$$\n狄利克雷边界条件为 $u(0,t) = \\exp(-t)\\sin(0) = 0$ 和 $u(1,t) = \\exp(-t)\\sin(\\pi) = 0$。\n\n**对于测试用例 3：**\n制造解为 $u(x,t) = \\cos(2t)\\sin(\\pi x)$，扩散系数为 $\\alpha=0$。\n时间导数为：\n$$\n\\frac{\\partial u}{\\partial t} = -2\\sin(2t)\\sin(\\pi x)\n$$\n由于 $\\alpha=0$，扩散项消失。源项即为：\n$$\ns(x,t) = \\frac{\\partial u}{\\partial t} = -2\\sin(2t)\\sin(\\pi x)\n$$\n狄利克雷边界条件为 $u(0,t) = \\cos(2t)\\sin(0) = 0$ 和 $u(1,t) = \\cos(2t)\\sin(\\pi) = 0$。\n\n### 2. 有限体积法（FVM）离散化\n\n我们将域 $x \\in [0,1]$ 离散为 $N_x$ 个宽度为 $\\Delta x = 1/N_x$ 的均匀控制体积（CV）。第 $i$ 个控制体积的中心位于 $x_i = (i - 1/2)\\Delta x$，其中 $i=1, \\dots, N_x$。我们在第 $i$ 个控制体积上（从面 $x_{i-1/2}$ 到 $x_{i+1/2}$）对控制方程进行积分：\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial u}{\\partial t} \\,dx = \\int_{x_{i-1/2}}^{x_{i+1/2}} \\alpha \\frac{\\partial^2 u}{\\partial x^2} \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} s(x,t) \\,dx\n$$\n近似这些积分，其中 $u_i(t) \\approx u(x_i, t)$ 是单元平均温度：\n$$\n\\frac{d u_i}{d t} \\Delta x = \\alpha \\left[ \\left(\\frac{\\partial u}{\\partial x}\\right)_{i+1/2} - \\left(\\frac{\\partial u}{\\partial x}\\right)_{i-1/2} \\right] + s(x_i, t) \\Delta x\n$$\n使用二阶中心差分来计算单元面上的梯度：\n$$\n\\left(\\frac{\\partial u}{\\partial x}\\right)_{i+1/2} \\approx \\frac{u_{i+1} - u_i}{\\Delta x}, \\quad \\left(\\frac{\\partial u}{\\partial x}\\right)_{i-1/2} \\approx \\frac{u_i - u_{i-1}}{\\Delta x}\n$$\n将这些代入并除以 $\\Delta x$，我们得到内部单元 $i$ 的半离散方程：\n$$\n\\frac{d u_i}{d t} = \\frac{\\alpha}{(\\Delta x)^2} (u_{i+1} - 2u_i + u_{i-1}) + s(x_i, t)\n$$\n这个常微分方程组（ODEs）可以写成矩阵形式：\n$$\n\\frac{d\\mathbf{u}}{dt} = \\mathbf{A}_{int}\\mathbf{u} + \\mathbf{b}(t) + \\mathbf{s}(t)\n$$\n其中 $\\mathbf{u} = [u_1, u_2, \\dots, u_{N_x}]^T$ 是单元中心温度的向量。矩阵 $\\mathbf{A}_{int}$ 表示内部扩散耦合，它是一个三对角矩阵，次对角线和超对角线上为 $\\frac{\\alpha}{(\\Delta x)^2}$，主对角线上为 $-2\\frac{\\alpha}{(\\Delta x)^2}$。向量 $\\mathbf{s}(t)$ 包含源项 $s(x_i, t)$。向量 $\\mathbf{b}(t)$ 包含了狄利克雷边界条件。对于单元 $i=1$，$u_0$ 被左边界值 $u_L(t)$ 替代；对于单元 $i=N_x$，$u_{N_x+1}$ 被右边界值 $u_R(t)$ 替代。这些边界项被移到右侧，构成了向量 $\\mathbf{b}(t)$。\n具体来说，$b_1(t) = \\frac{\\alpha}{(\\Delta x)^2} u_L(t)$，$b_{N_x}(t) = \\frac{\\alpha}{(\\Delta x)^2} u_R(t)$，且对于 $1  i  N_x$，$b_i(t)=0$。\n对于本问题中的所有测试用例，边界条件都是齐次的，$u_L(t) = u_R(t) = 0$，这意味着边界向量 $\\mathbf{b}(t)$ 恒为零。\n\n### 3. 时间离散化：$\\theta$ 方法\n\n我们对半离散系统 $\\frac{d\\mathbf{u}}{dt} = \\mathbf{F}(\\mathbf{u}, t)$ 应用 $\\theta$ 方法，其中 $\\mathbf{F}(\\mathbf{u}, t) = \\mathbf{A}_{int}\\mathbf{u} + \\mathbf{s}(t)$。设 $t^n = n\\Delta t$。时间推进格式为：\n$$\n\\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^n}{\\Delta t} = (1-\\theta)\\mathbf{F}(\\mathbf{u}^n, t^n) + \\theta\\mathbf{F}(\\mathbf{u}^{n+1}, t^{n+1})\n$$\n代入 $\\mathbf{F}$ 并整理以求解未知量 $\\mathbf{u}^{n+1}$：\n$$\n\\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^n}{\\Delta t} = (1-\\theta)(\\mathbf{A}_{int}\\mathbf{u}^n + \\mathbf{s}^n) + \\theta(\\mathbf{A}_{int}\\mathbf{u}^{n+1} + \\mathbf{s}^{n+1})\n$$\n$$\n\\mathbf{u}^{n+1} - \\theta \\Delta t \\mathbf{A}_{int}\\mathbf{u}^{n+1} = \\mathbf{u}^n + (1-\\theta) \\Delta t \\mathbf{A}_{int}\\mathbf{u}^n + \\Delta t((1-\\theta)\\mathbf{s}^n + \\theta\\mathbf{s}^{n+1})\n$$\n$$\n(\\mathbf{I} - \\theta \\Delta t \\mathbf{A}_{int}) \\mathbf{u}^{n+1} = (\\mathbf{I} + (1-\\theta) \\Delta t \\mathbf{A}_{int}) \\mathbf{u}^n + \\Delta t((1-\\theta)\\mathbf{s}^n + \\theta\\mathbf{s}^{n+1})\n$$\n其中 $\\mathbf{I}$ 是单位矩阵，$\\mathbf{s}^n = \\mathbf{s}(t^n)$。在每个时间步，我们必须求解这个线性系统以得到 $\\mathbf{u}^{n+1}$。左侧的矩阵 $(\\mathbf{I} - \\theta \\Delta t \\mathbf{A}_{int})$ 是一个三对角矩阵，并且对于固定的 $\\Delta t$ 是常数，这使得求解过程非常高效。\n\n### 4. 误差分析与收敛阶\n\n将解从 $t=0$ 推进到最终时间 $T$ 后，我们得到数值解向量 $\\mathbf{u}^{\\text{num}}(T)$。我们将其与精确解向量 $\\mathbf{u}^{\\text{exact}}(T)$ 进行比较，后者的每个分量由 $u(x_i, T)$ 给出。误差向量为 $\\mathbf{e} = \\mathbf{u}^{\\text{num}}(T) - \\mathbf{u}^{\\text{exact}}(T)$。\n\n我们计算此误差的离散 $L_2$ 和 $L_\\infty$ 范数：\n$$\n\\|e\\|_{2,\\Delta x} = \\left( \\sum_{i=1}^{N_x} e_i^2 \\Delta x \\right)^{1/2}, \\quad \\|e\\|_{\\infty} = \\max_{1\\le i \\le N_x} |e_i|\n$$\n对一系列加密的时间步长 $\\Delta t_j$ 重复此过程。误差与时间步长之间的理论关系为 $\\|e\\| \\approx C (\\Delta t)^p$，其中 $p$ 是收敛阶。对两边取对数，得到一个线性关系：\n$$\n\\log(\\|e\\|) \\approx \\log(C) + p \\log(\\Delta t)\n$$\n我们对每个范数的数据点 $(\\log(\\Delta t_j), \\log(\\|e\\|_j))$ 进行线性最小二乘拟合。所得直线的斜率即为经验性观测到的收敛阶 $p$。\n\n**预期的理论阶数：**\n- **测试用例 1** ($\\theta=1$，后向欧拉法)：时间上一阶精度。预期 $p \\approx 1$。\n- **测试用例 2** ($\\theta=1/2$，Crank-Nicolson 方法)：时间上二阶精度。预期 $p \\approx 2$。\n- **测试用例 3** ($\\theta=1$，$\\alpha=0$)：问题简化为一组独立的常微分方程，用后向欧拉法积分，这是一个一阶格式。预期 $p \\approx 1$。\n\n实现将精确遵循这些步骤来计算每个测试用例的观测阶数 $p_2$ 和 $p_\\infty$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Computes the observed temporal order of accuracy for the FVM time discretization\n    of the 1D heat equation using the Method of Manufactured Solutions.\n    \"\"\"\n\n    def run_convergence_study(alpha, theta, u_manufactured, s_source, Nx, T_final, dt_refinements):\n        \"\"\"\n        Performs a time-step refinement study for a single test case.\n\n        Args:\n            alpha (float): Thermal diffusivity.\n            theta (float): Parameter for the theta-method.\n            u_manufactured (callable): Manufactured solution u(x, t).\n            s_source (callable): Source term s(x, t).\n            Nx (int): Number of control volumes.\n            T_final (float): Final simulation time.\n            dt_refinements (list): List of time step sizes to test.\n\n        Returns:\n            tuple: A tuple containing the observed order for L2 norm (p2)\n                   and L-infinity norm (p_inf).\n        \"\"\"\n        dx = 1.0 / Nx\n        x_centers = np.linspace(dx / 2.0, 1.0 - dx / 2.0, Nx)\n\n        errors_l2 = []\n        errors_linf = []\n\n        # Construct the constant interior part of the spatial operator matrix A_int\n        c = alpha / (dx * dx)\n        A_int_main_diag = -2.0 * c * np.ones(Nx)\n        A_int_off_diag = c * np.ones(Nx - 1)\n\n        for dt in dt_refinements:\n            # --- Temporal advancing loop ---\n            time = 0.0\n            num_steps = int(round(T_final / dt))\n            # Adjust dt to hit T_final exactly\n            dt_actual = T_final / num_steps\n            \n            # Initial condition from manufactured solution\n            u_num = u_manufactured(x_centers, 0.0)\n\n            # --- Set up linear system for theta-method ---\n            # System: M_L @ u_n+1 = M_R @ u_n + source_terms\n            # Left-hand side matrix M_L = I - theta * dt * A_int\n            ml_main = 1.0 - theta * dt_actual * A_int_main_diag\n            ml_off = -theta * dt_actual * A_int_off_diag\n            \n            # Create banded matrix for scipy solver\n            # (1, 1) means 1 sub-diagonal and 1 super-diagonal\n            M_L_banded = np.zeros((3, Nx))\n            M_L_banded[0, 1:] = ml_off\n            M_L_banded[1, :] = ml_main\n            M_L_banded[2, :-1] = ml_off\n\n            # Right-hand side matrix M_R = I + (1 - theta) * dt * A_int\n            mr_main = 1.0 + (1.0 - theta) * dt_actual * A_int_main_diag\n            mr_off = (1.0 - theta) * dt_actual * A_int_off_diag\n\n            for n in range(num_steps):\n                t_n = time\n                t_np1 = time + dt_actual\n\n                # Form the right-hand side vector\n                # RHS = M_R @ u_n\n                rhs = mr_main * u_num\n                rhs[1:] += mr_off * u_num[:-1]\n                rhs[:-1] += mr_off * u_num[1:]\n\n                # Add source terms: dt * ((1-theta)*s_n + theta*s_np1)\n                # Note: Boundary contribution vector b(t) is zero for all cases\n                s_n = s_source(x_centers, t_n)\n                s_np1 = s_source(x_centers, t_np1)\n                source_contribution = dt_actual * ((1.0 - theta) * s_n + theta * s_np1)\n                rhs += source_contribution\n                \n                # Solve the tridiagonal system for u_n+1\n                u_num = solve_banded((1, 1), M_L_banded, rhs)\n                \n                time = t_np1\n\n            # --- Error computation ---\n            u_exact = u_manufactured(x_centers, T_final)\n            error = u_num - u_exact\n\n            # L2 norm\n            error_l2 = np.sqrt(np.sum(error**2 * dx))\n            errors_l2.append(error_l2)\n            \n            # L-infinity norm\n            error_linf = np.max(np.abs(error))\n            errors_linf.append(error_linf)\n\n        # --- Linear fit to find order of accuracy p ---\n        log_dt = np.log(dt_refinements)\n        \n        # L2 order\n        log_err_l2 = np.log(errors_l2)\n        p2 = np.polyfit(log_dt, log_err_l2, 1)[0]\n        \n        # L-infinity order\n        log_err_linf = np.log(errors_linf)\n        p_inf = np.polyfit(log_dt, log_err_linf, 1)[0]\n\n        return p2, p_inf\n\n    # --- Test Case Definitions ---\n    # Common parameters\n    Nx_common = 200\n    T_final_common = 0.4\n    dt_refinements_common = [0.05, 0.025, 0.0125, 0.00625]\n\n    # Test Case 1: Backward Euler, alpha=1\n    u1 = lambda x, t: np.exp(-t) * np.sin(np.pi * x)\n    s1 = lambda x, t: (np.pi**2 - 1) * np.exp(-t) * np.sin(np.pi * x)\n    p2_1, pinf_1 = run_convergence_study(1.0, 1.0, u1, s1, Nx_common, T_final_common, dt_refinements_common)\n\n    # Test Case 2: Crank-Nicolson, alpha=1\n    u2 = u1\n    s2 = s1\n    p2_2, pinf_2 = run_convergence_study(1.0, 0.5, u2, s2, Nx_common, T_final_common, dt_refinements_common)\n\n    # Test Case 3: Backward Euler, alpha=0 (pure transient)\n    u3 = lambda x, t: np.cos(2 * t) * np.sin(np.pi * x)\n    s3 = lambda x, t: -2 * np.sin(2 * t) * np.sin(np.pi * x)\n    p2_3, pinf_3 = run_convergence_study(0.0, 1.0, u3, s3, Nx_common, T_final_common, dt_refinements_common)\n    \n    # --- Format and Print Final Output ---\n    results = [\n        round(p2_1, 3), round(p2_2, 3), round(p2_3, 3),\n        round(pinf_1, 3), round(pinf_2, 3), round(pinf_3, 3)\n    ]\n    \n    # Format to avoid \".0\" for integer-like floats, e.g., 1.000 - \"1.0\"\n    # This also handles scientific notation by default if numbers are very small/large.\n    results_str = [f\"{r:.3f}\" for r in results]\n\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        }
    ]
}