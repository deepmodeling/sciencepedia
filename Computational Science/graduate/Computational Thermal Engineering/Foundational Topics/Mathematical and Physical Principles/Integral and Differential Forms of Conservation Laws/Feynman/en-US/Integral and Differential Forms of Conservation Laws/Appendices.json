{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of conservation laws is the direct relationship between the differential form, which applies at a point, and the integral form, which applies to a volume. This equivalence is mathematically established by the Divergence Theorem. This first exercise  provides a crucial conceptual check by asking you to verify this principle for a manufactured advection-diffusion problem, demonstrating that the integral balance is inherently satisfied when the source term is defined as the divergence of the flux.",
            "id": "3963352",
            "problem": "Consider the steady scalar advection–diffusion equation with a source term in two-dimensional Cartesian coordinates, posed for a smooth scalar field $\\phi(x,y)$ on a rectangular domain $\\Omega \\subset \\mathbb{R}^{2}$:\n$$\n\\nabla \\cdot \\left( \\boldsymbol{u}\\,\\phi - \\Gamma \\nabla \\phi \\right) = s(x,y),\n$$\nwhere $\\boldsymbol{u}$ is the velocity field, $\\Gamma$ is the constant diffusivity, and $s(x,y)$ is a volumetric source term. This equation represents the integral and differential forms of a conservation law for a transported quantity in computational thermal engineering. You are tasked with constructing a manufactured solution and computing exact integral balances to validate a Finite Volume Method (FVM).\n\nLet the velocity be constant $\\boldsymbol{u} = (u_{x}, u_{y}) = (2, -1)$, the diffusivity be constant $\\Gamma = \\frac{1}{2}$, and define the manufactured solution\n$$\n\\phi(x,y) = x^{3} y + 2 x y^{3}.\n$$\nDefine the source field $s(x,y)$ by requiring $\\phi(x,y)$ to satisfy the governing equation in differential form, that is,\n$$\ns(x,y) = \\nabla \\cdot \\left( \\boldsymbol{u}\\,\\phi - \\Gamma \\nabla \\phi \\right).\n$$\n\nNow consider an arbitrary rectangular control volume $V = [x_{a}, x_{b}] \\times [y_{a}, y_{b}]$ strictly inside $\\Omega$, with $0 < x_{a} < x_{b} < 1$ and $0 < y_{a} < y_{b} < 1$. Let the exact advective–diffusive flux be\n$$\n\\boldsymbol{J}(x,y) = \\boldsymbol{u}\\,\\phi(x,y) - \\Gamma \\nabla \\phi(x,y).\n$$\nCompute the exact global integral residual over $V$,\n$$\nR = \\oint_{\\partial V} \\boldsymbol{J} \\cdot \\boldsymbol{n} \\, dS \\;-\\; \\int_{V} s(x,y) \\, dV,\n$$\nwhere $\\boldsymbol{n}$ is the outward unit normal on $\\partial V$. Express the final residual as a pure number (unitless). No rounding is required.",
            "solution": "The problem asks for the computation of the exact global integral residual, $R$, for a steady scalar advection–diffusion problem over an arbitrary rectangular control volume $V$.\n\nFirst, we establish the definitions provided in the problem statement.\nThe scalar advection–diffusion equation in differential form is given by:\n$$\n\\nabla \\cdot \\left( \\boldsymbol{u}\\,\\phi - \\Gamma \\nabla \\phi \\right) = s(x,y)\n$$\nThe problem defines the advective–diffusive flux vector, $\\boldsymbol{J}(x,y)$, as:\n$$\n\\boldsymbol{J}(x,y) = \\boldsymbol{u}\\,\\phi(x,y) - \\Gamma \\nabla \\phi(x,y)\n$$\nBy substituting the definition of $\\boldsymbol{J}$ into the governing equation, we obtain the relationship between the flux vector $\\boldsymbol{J}$ and the source term $s(x,y)$:\n$$\n\\nabla \\cdot \\boldsymbol{J}(x,y) = s(x,y)\n$$\nThis equation is the differential form of the conservation law. It states that the divergence of the flux at a point is equal to the source strength at that point.\n\nThe problem requires the calculation of the global integral residual, $R$, over a rectangular control volume $V = [x_{a}, x_{b}] \\times [y_{a}, y_{b}]$. The residual is defined as:\n$$\nR = \\oint_{\\partial V} \\boldsymbol{J} \\cdot \\boldsymbol{n} \\, dS \\;-\\; \\int_{V} s(x,y) \\, dV\n$$\nwhere $\\partial V$ is the boundary of the control volume $V$, $\\boldsymbol{n}$ is the outward unit normal vector on the boundary, $dS$ is the differential element of surface (arc length in 2D), and $dV$ is the differential element of volume (area in 2D, i.e., $dV = dx\\,dy$).\n\nThe first term, $\\oint_{\\partial V} \\boldsymbol{J} \\cdot \\boldsymbol{n} \\, dS$, represents the net rate of transport of the quantity $\\phi$ out of the control volume $V$ across its boundary $\\partial V$. The second term, $\\int_{V} s(x,y) \\, dV$, represents the total rate of generation of the quantity $\\phi$ inside the control volume $V$. The expression for $R$ thus represents the imbalance between the net outflow and the internal generation, which is the definition of a residual for a conservation law.\n\nWe can now substitute the relationship $s(x,y) = \\nabla \\cdot \\boldsymbol{J}(x,y)$ into the expression for $R$:\n$$\nR = \\oint_{\\partial V} \\boldsymbol{J} \\cdot \\boldsymbol{n} \\, dS \\;-\\; \\int_{V} (\\nabla \\cdot \\boldsymbol{J}) \\, dV\n$$\nThe core of this problem lies in recognizing the connection between the surface integral and the volume integral. This connection is established by the Divergence Theorem (also known as Gauss's Theorem). For a continuously differentiable vector field $\\boldsymbol{J}$ defined on a region $V$ with a piecewise smooth boundary $\\partial V$, the theorem states:\n$$\n\\oint_{\\partial V} \\boldsymbol{J} \\cdot \\boldsymbol{n} \\, dS = \\int_{V} (\\nabla \\cdot \\boldsymbol{J}) \\, dV\n$$\nIn the context of this problem, the manufactured solution $\\phi(x,y) = x^3 y + 2xy^3$ is a polynomial and thus infinitely differentiable. The velocity $\\boldsymbol{u}$ and diffusivity $\\Gamma$ are constants. Therefore, the flux vector $\\boldsymbol{J}$ is also continuously differentiable, and the Divergence Theorem is applicable.\n\nApplying the Divergence Theorem, we can replace the surface integral in the expression for $R$ with the equivalent volume integral:\n$$\n\\oint_{\\partial V} \\boldsymbol{J} \\cdot \\boldsymbol{n} \\, dS = \\int_{V} (\\nabla \\cdot \\boldsymbol{J}) \\, dV\n$$\nSubstituting this result back into the expression for the residual $R$:\n$$\nR = \\left( \\int_{V} (\\nabla \\cdot \\boldsymbol{J}) \\, dV \\right) - \\int_{V} (\\nabla \\cdot \\boldsymbol{J}) \\, dV\n$$\nThe two terms are identical and thus cancel each other out.\n$$\nR = 0\n$$\nThis result is fundamental. The problem is constructed such that the source term $s(x,y)$ is precisely defined to make the manufactured solution $\\phi(x,y)$ an exact solution to the differential equation $\\nabla \\cdot \\boldsymbol{J} = s$. The integral form of this same conservation law, obtained via the Divergence Theorem, must therefore be identically satisfied. The residual $R$ is a measure of how well the integral conservation law is satisfied. Since we are using the exact analytical functions, the conservation law is satisfied perfectly, and the analytical residual must be exactly zero.\n\nThe specific expressions for $\\phi(x,y)$, $\\boldsymbol{u}$, and $\\Gamma$, as well as the specific bounds of the control volume $V$, are provided to create a concrete problem context. However, the final result $R=0$ is a direct consequence of the mathematical structure of the problem—namely, the definition of the source term and the validity of the Divergence Theorem—and is independent of these specific values. Any brute-force calculation of the integrals would be exceedingly tedious but would ultimately yield the same result. The elegant solution relies solely on the application of the fundamental theorem.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "Moving from continuous theory to discrete computation, the integral conservation law finds its direct expression in the Finite Volume Method (FVM). In an ideal FVM simulation, the numerical fluxes are conservative, meaning the flux leaving one cell is identical to the flux entering its neighbor, ensuring global conservation. This practice  tasks you with implementing a verification case to measure the global energy balance, revealing how a small, localized numerical error can disrupt this perfect cancellation and manifest as a non-zero global residual—a key diagnostic in practical simulations.",
            "id": "3963348",
            "problem": "Consider a two-dimensional rectangular domain with dimensions $L_x$ in the $x$-direction and $L_y$ in the $y$-direction, and a uniform out-of-plane thickness $b$. Let the physical properties be constant: mass density $\\rho$ (in $\\mathrm{kg/m^3}$), specific heat at constant pressure $c_p$ (in $\\mathrm{J/(kg\\cdot K)}$), and thermal conductivity $k$ (in $\\mathrm{W/(m\\cdot K)}$). Define the thermal energy flux vector as the sum of the conductive flux and the advective enthalpy flux, namely the vector field $\\mathbf{F} = -k \\nabla T + \\rho c_p T \\mathbf{v}$, where $T(x,y)$ is temperature and $\\mathbf{v}(x,y)$ is the velocity field. The integral form of the steady thermal energy conservation law for any fixed control volume $V$ with boundary $\\partial V$ is that the net outward flux of $\\mathbf{F}$ across $\\partial V$ balances sources and sinks; in the absence of internal generation and work transfer, the net outward flux is zero. The corresponding differential form states that the divergence of $\\mathbf{F}$ is zero.\n\nYou are tasked with designing and verifying a manufactured steady solution that yields zero divergence of the total energy flux, and with implementing a finite-volume measurement of the residual global imbalance that would arise in a numerical simulation. Use the following exact fields:\n\n1. A constant temperature field $T(x,y) = T_0$ with $T_0$ in $\\mathrm{K}$.\n2. An incompressible ($\\nabla\\cdot \\mathbf{v} = 0$) velocity field defined via a scalar streamfunction $\\psi(x,y)$ with units of $\\mathrm{m^2/s}$ as $\\mathbf{v} = \\left(\\frac{\\partial \\psi}{\\partial y}, -\\frac{\\partial \\psi}{\\partial x}\\right)$, and take\n   $$\\psi(x,y) = \\psi_0 \\sin\\left(\\frac{2\\pi x}{L_x}\\right) \\sin\\left(\\frac{2\\pi y}{L_y}\\right),$$\n   where $\\psi_0$ is a given amplitude in $\\mathrm{m^2/s}$.\n\nStarting exclusively from the integral form of steady thermal energy conservation and the definition of the flux components, derive the differential statement that the divergence of $\\mathbf{F}$ is zero for the above fields, and explain why this steady solution is exact. Then, design a finite-volume procedure on a uniform Cartesian mesh of $N_x \\times N_y$ rectangular cells that computes the discrete global residual imbalance $R_g$ (in $\\mathrm{W}$) by summing the outward energy flux across all cell faces using the exact fields. Treat the domain as periodically continued for purposes of evaluating the exact fields at face centers, and assume unit thickness $b$ unless otherwise specified.\n\nYour program must implement the following measurement:\n\n- For each cell with center $(x_i,y_j)$ and sizes $\\Delta x = L_x/N_x$, $\\Delta y = L_y/N_y$, evaluate the advective enthalpy flux density $\\rho c_p T_0 \\mathbf{v}$ at the centers of its four faces. Compute the outward flux through each face as flux density projected on the face normal multiplied by the face area ($b\\,\\Delta y$ for vertical faces and $b\\,\\Delta x$ for horizontal faces). Sum the outward fluxes of all faces of all cells. The conductive contribution is identically zero because $T$ is constant. This sum defines $R_g$ in $\\mathrm{W}$. In exact arithmetic and perfectly consistent face-sharing, $R_g$ should be zero. However, residual imbalance can be introduced by a slight inconsistency in a single face flux.\n\nTo demonstrate measurement and interpretation of residual global imbalance, include a perturbation parameter $\\epsilon$ applied only to the outward east-face flux of the single cell at indices $(i_0,j_0)$ with $i_0 = \\lfloor N_x/2 \\rfloor$ and $j_0 = \\lfloor N_y/2 \\rfloor$. Specifically, multiply that one east-face flux by $(1+\\epsilon)$ while leaving all other faces unchanged. This models a small numerical inconsistency on a single internal face. When $\\epsilon = 0$, this measurement reduces to the ideal exact case.\n\nPhysical units requirement: Express each $R_g$ in watts ($\\mathrm{W}$), printed as floating-point numbers.\n\nAngle unit requirement: All trigonometric evaluations use radians.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,...]\"). Each result corresponds to one test case and must be printed in scientific notation.\n\nTest suite: Implement the program to compute $R_g$ for the following four parameter sets:\n\n- Case $1$ (happy path, square domain): $N_x = 32$, $N_y = 32$, $L_x = 1.0\\,\\mathrm{m}$, $L_y = 1.0\\,\\mathrm{m}$, $b = 1.0\\,\\mathrm{m}$, $\\rho = 1.200\\,\\mathrm{kg/m^3}$, $c_p = 1007.0\\,\\mathrm{J/(kg\\cdot K)}$, $k = 0.026\\,\\mathrm{W/(m\\cdot K)}$, $T_0 = 300.0\\,\\mathrm{K}$, $\\psi_0 = 0.10\\,\\mathrm{m^2/s}$, $\\epsilon = 0.0$.\n\n- Case $2$ (rectangular domain, different scales): $N_x = 17$, $N_y = 31$, $L_x = 2.0\\,\\mathrm{m}$, $L_y = 0.5\\,\\mathrm{m}$, $b = 0.75\\,\\mathrm{m}$, $\\rho = 1.000\\,\\mathrm{kg/m^3}$, $c_p = 1000.0\\,\\mathrm{J/(kg\\cdot K)}$, $k = 0.600\\,\\mathrm{W/(m\\cdot K)}$, $T_0 = 350.0\\,\\mathrm{K}$, $\\psi_0 = 0.05\\,\\mathrm{m^2/s}$, $\\epsilon = 0.0$.\n\n- Case $3$ (fine grid, tiny inconsistency): $N_x = 64$, $N_y = 64$, $L_x = 1.0\\,\\mathrm{m}$, $L_y = 1.0\\,\\mathrm{m}$, $b = 1.0\\,\\mathrm{m}$, $\\rho = 1.200\\,\\mathrm{kg/m^3}$, $c_p = 1007.0\\,\\mathrm{J/(kg\\cdot K)}$, $k = 0.026\\,\\mathrm{W/(m\\cdot K)}$, $T_0 = 300.0\\,\\mathrm{K}$, $\\psi_0 = 0.10\\,\\mathrm{m^2/s}$, $\\epsilon = 10^{-12}$.\n\n- Case $4$ (fine grid, larger inconsistency): $N_x = 64$, $N_y = 64$, $L_x = 1.0\\,\\mathrm{m}$, $L_y = 1.0\\,\\mathrm{m}$, $b = 1.0\\,\\mathrm{m}$, $\\rho = 1.200\\,\\mathrm{kg/m^3}$, $c_p = 1007.0\\,\\mathrm{J/(kg\\cdot K)}$, $k = 0.026\\,\\mathrm{W/(m\\cdot K)}$, $T_0 = 300.0\\,\\mathrm{K}$, $\\psi_0 = 0.10\\,\\mathrm{m^2/s}$, $\\epsilon = 10^{-6}$.\n\nAnswer specification: For each case, the single numerical answer is the global residual imbalance $R_g$ in $\\mathrm{W}$, printed in scientific notation. The final output must be a single bracketed list of these four floats.",
            "solution": "The problem is subjected to validation before proceeding to a solution.\n\n### Step 1: Extract Givens\n- **Domain:** Two-dimensional rectangular, dimensions $L_x \\times L_y$, uniform thickness $b$.\n- **Physical Properties:** Constant mass density $\\rho$, specific heat at constant pressure $c_p$, thermal conductivity $k$.\n- **Thermal Energy Flux Vector:** $\\mathbf{F} = -k \\nabla T + \\rho c_p T \\mathbf{v}$.\n- **Conservation Law (Integral Form):** For any fixed control volume $V$ with boundary $\\partial V$ and no internal sources/work, the net outward flux is zero: $\\oint_{\\partial V} \\mathbf{F} \\cdot d\\mathbf{A} = 0$.\n- **Conservation Law (Differential Form):** The divergence of $\\mathbf{F}$ is zero: $\\nabla \\cdot \\mathbf{F} = 0$.\n- **Manufactured Exact Fields:**\n    1.  Temperature: $T(x,y) = T_0$ (constant).\n    2.  Velocity: Incompressible field $\\mathbf{v}$ ($\\nabla\\cdot \\mathbf{v} = 0$) from a streamfunction $\\psi(x,y)$.\n        - $\\mathbf{v} = \\left(\\frac{\\partial \\psi}{\\partial y}, -\\frac{\\partial \\psi}{\\partial x}\\right)$.\n        - $\\psi(x,y) = \\psi_0 \\sin\\left(\\frac{2\\pi x}{L_x}\\right) \\sin\\left(\\frac{2\\pi y}{L_y}\\right)$.\n- **Finite-Volume Procedure:**\n    - Uniform Cartesian mesh of $N_x \\times N_y$ cells.\n    - Cell dimensions: $\\Delta x = L_x/N_x$, $\\Delta y = L_y/N_y$.\n    - Task: Compute global residual imbalance $R_g$ by summing the outward energy flux across all faces of all cells.\n    - Flux evaluation: Advective flux $\\rho c_p T_0 \\mathbf{v}$ evaluated at face centers. Conductive flux is zero.\n    - Global residual: $R_g = \\sum_{\\text{all cells}} \\left( \\sum_{\\text{faces of cell}} (\\text{outward flux}) \\right)$. Units: watts ($\\mathrm{W}$).\n- **Perturbation:**\n    - For a single cell at indices $(i_0, j_0)$ where $i_0 = \\lfloor N_x/2 \\rfloor$ and $j_0 = \\lfloor N_y/2 \\rfloor$.\n    - The outward east-face flux of this cell is multiplied by a factor $(1+\\epsilon)$.\n- **Parameter Sets:** Four test cases are provided with specific values for all parameters.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientific or Factual Unsoundness:** The problem is grounded in the fundamental principles of continuum mechanics, specifically the conservation of energy for a fluid. The definitions for conductive and advective heat flux, the integral and differential forms of the conservation law, and the use of a streamfunction for an incompressible flow are all standard and correct. The concept of a manufactured solution is a well-established technique for verification in computational physics.\n2.  **Non-Formalizable or Irrelevant:** The problem is a formal and quantitative task within the specified field of computational thermal engineering.\n3.  **Incomplete or Contradictory Setup:** The problem statement provides all necessary parameters and definitions for the derivation and subsequent computation. Let us verify the consistency of the provided fields with the conservation law.\n    The total flux is $\\mathbf{F} = -k \\nabla T + \\rho c_p T \\mathbf{v}$. Its divergence is $\\nabla \\cdot \\mathbf{F} = \\nabla \\cdot (-k \\nabla T) + \\nabla \\cdot (\\rho c_p T \\mathbf{v})$.\n    With constant properties $k$, $\\rho$, $c_p$:\n    $\\nabla \\cdot \\mathbf{F} = -k \\nabla^2 T + \\rho c_p \\nabla \\cdot (T \\mathbf{v})$.\n    Using the vector identity for the divergence of a scalar-vector product, $\\nabla \\cdot (T \\mathbf{v}) = T (\\nabla \\cdot \\mathbf{v}) + (\\nabla T) \\cdot \\mathbf{v}$.\n    Thus, $\\nabla \\cdot \\mathbf{F} = -k \\nabla^2 T + \\rho c_p [T (\\nabla \\cdot \\mathbf{v}) + (\\nabla T) \\cdot \\mathbf{v}]$.\n    For the given fields:\n    - $T(x,y) = T_0$ is constant, so its gradient $\\nabla T$ and Laplacian $\\nabla^2 T$ are both zero.\n    - The velocity field is specified as incompressible, $\\nabla \\cdot \\mathbf{v} = 0$. This is guaranteed by its definition from a streamfunction: $\\nabla \\cdot \\mathbf{v} = \\frac{\\partial}{\\partial x}(\\frac{\\partial \\psi}{\\partial y}) + \\frac{\\partial}{\\partial y}(-\\frac{\\partial \\psi}{\\partial x}) = \\frac{\\partial^2 \\psi}{\\partial x \\partial y} - \\frac{\\partial^2 \\psi}{\\partial y \\partial x} = 0$, by the equality of mixed partials (Clairaut's theorem).\n    Substituting these into the divergence equation gives $\\nabla \\cdot \\mathbf{F} = -k(0) + \\rho c_p [T_0 (0) + (\\mathbf{0}) \\cdot \\mathbf{v}] = 0$.\n    The provided fields constitute an exact analytical solution to the steady energy equation, confirming the internal consistency of the problem.\n4.  **Unrealistic or Infeasible:** The parameters are physically plausible for typical fluids (e.g., air). The task is a numerical computation, which is feasible.\n5.  **Ill-Posed or Poorly Structured:** The problem is a direct calculation, not an inverse problem. The solution is uniquely determined by the parameters. The instructions are specific and unambiguous.\n6.  **Pseudo-Profound, Trivial, or Tautological:** The problem requires a solid understanding of conservation laws, vector calculus, and finite-volume concepts. The simplification that arises is a consequence of these principles, not a contrived setup.\n7.  **Outside Scientific Verifiability:** The results are mathematically derivable and computationally verifiable.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n---\n\n### Part 1: Derivation and Verification\n\nThe integral form of the steady thermal energy conservation law, for an arbitrary control volume $V$ with boundary surface $\\partial V$ and in the absence of internal sources, is stated as:\n$$\n\\oint_{\\partial V} \\mathbf{F} \\cdot d\\mathbf{A} = 0\n$$\nwhere $\\mathbf{F}$ is the total energy flux vector and $d\\mathbf{A}$ is the outward-pointing differential area vector on the boundary.\n\nBy the Divergence Theorem (also known as Gauss's theorem), the surface integral of a vector field over a closed surface is equal to the volume integral of the divergence of that field over the volume enclosed by the surface:\n$$\n\\oint_{\\partial V} \\mathbf{F} \\cdot d\\mathbf{A} = \\int_V (\\nabla \\cdot \\mathbf{F}) \\, dV\n$$\nCombining these two equations yields:\n$$\n\\int_V (\\nabla \\cdot \\mathbf{F}) \\, dV = 0\n$$\nThis relationship must hold for *any* arbitrary control volume $V$ within the domain. The only way for the integral of a continuous function to be zero over any arbitrary volume is if the integrand itself is identically zero at every point. Therefore, we arrive at the differential form of the conservation law:\n$$\n\\nabla \\cdot \\mathbf{F} = 0\n$$\nNow, we verify that the provided manufactured solution satisfies this differential equation. The total energy flux is $\\mathbf{F} = -k \\nabla T + \\rho c_p T \\mathbf{v}$. Its divergence, assuming constant properties, is:\n$$\n\\nabla \\cdot \\mathbf{F} = -k \\nabla^2 T + \\rho c_p (T (\\nabla \\cdot \\mathbf{v}) + \\mathbf{v} \\cdot \\nabla T)\n$$\nThe given temperature field is $T(x,y) = T_0$, a constant. This directly implies that the temperature gradient $\\nabla T = \\mathbf{0}$ and the temperature Laplacian $\\nabla^2 T = 0$.\nThe velocity field $\\mathbf{v}$ is derived from a streamfunction $\\psi(x,y)$, which ensures it is incompressible, i.e., $\\nabla \\cdot \\mathbf{v} = 0$.\nSubstituting these facts into the divergence equation:\n$$\n\\nabla \\cdot \\mathbf{F} = -k(0) + \\rho c_p (T_0 (0) + \\mathbf{v} \\cdot \\mathbf{0}) = 0\n$$\nThis confirms that the given fields constitute an exact solution to the steady, source-free energy conservation equation.\n\n### Part 2: Finite-Volume Procedure and Residual Calculation\n\nWe consider a uniform Cartesian grid of $N_x \\times N_y$ cells. A cell is indexed by $(i,j)$ for $i \\in \\{0, \\dots, N_x-1\\}$ and $j \\in \\{0, \\dots, N_y-1\\}$. The cell dimensions are $\\Delta x = L_x/N_x$ and $\\Delta y = L_y/N_y$. The center of cell $(i,j)$ is $(x_i, y_j) = ((i+0.5)\\Delta x, (j+0.5)\\Delta y)$.\n\nThe global residual imbalance, $R_g$, is the sum of net outward fluxes over all cells. For a single cell, the net flux is the sum of fluxes through its four faces (east, west, north, south). Since $T=T_0$ is constant, the conductive flux $-k\\nabla T$ is zero. The flux is purely advective: $\\mathbf{F} = \\rho c_p T_0 \\mathbf{v}$. The flux through a face is the dot product of the flux vector at the face center with the face's normal vector, multiplied by the face area.\n\nFor an internal face $f$ shared between two adjacent cells, say cell $A$ and cell $B$, it is evaluated twice in the global sum. Let $\\Phi_{A \\to B}$ be the flux from $A$ to $B$ across face $f$. The outward flux from cell $A$ is $\\Phi_{A \\to B}$, and the outward flux from cell $B$ is $\\Phi_{B \\to A}$. By definition, $\\Phi_{B \\to A} = -\\Phi_{A \\to B}$. Therefore, in the global sum, their contribution is $\\Phi_{A \\to B} + \\Phi_{B \\to A} = 0$. In exact arithmetic, all internal face contributions cancel. Due to the specified periodic velocity field, boundary face fluxes also cancel, leading to $R_g=0$.\n\nThe problem introduces a perturbation. For the specific cell $(i_0, j_0)$, the outward flux through its east face, let's call it $f^*$, is multiplied by $(1+\\epsilon)$. The east face of cell $(i_0, j_0)$ is the west face of cell $(i_0+1, j_0)$. Let the unperturbed, canonical outward flux through this face (in the positive x-direction) be $\\Phi_{f^*}$.\n- The outward flux from cell $(i_0, j_0)$ through face $f^*$ is $(1+\\epsilon)\\Phi_{f^*}$.\n- The outward flux from cell $(i_0+1, j_0)$ through face $f^*$ (which points in the negative x-direction) is $-\\Phi_{f^*}$.\nThe sum of contributions from this specific face to the global residual $R_g$ is:\n$$\n(1+\\epsilon)\\Phi_{f^*} + (-\\Phi_{f^*}) = \\epsilon \\Phi_{f^*}\n$$\nSince all other face contributions cancel out, the total global residual is simply this value.\n$$\nR_g = \\epsilon \\Phi_{f^*}\n$$\nWe now need to calculate $\\Phi_{f^*}$. This is the unperturbed outward flux through the east face of cell $(i_0,j_0)$.\n- Face location: The center of the east face of cell $(i_0,j_0)$ is at $(x_{i_0+1/2}, y_{j_0})$.\n    - $i_0 = \\lfloor N_x/2 \\rfloor$, $j_0 = \\lfloor N_y/2 \\rfloor$\n    - $x_{i_0+1/2} = (i_0+1)\\Delta x = (\\lfloor N_x/2 \\rfloor + 1) L_x/N_x$\n    - $y_{j_0} = (j_0+0.5)\\Delta y = (\\lfloor N_y/2 \\rfloor + 0.5) L_y/N_y$\n- Face normal vector (outward): $\\mathbf{n} = (1, 0)$.\n- Flux vector at face center: $\\mathbf{F}(x_{i_0+1/2}, y_{j_0}) = \\rho c_p T_0 \\mathbf{v}(x_{i_0+1/2}, y_{j_0})$.\n- Velocity component normal to the face: $v_x(x_{i_0+1/2}, y_{j_0})$.\n- Face area: $A_f = b \\Delta y$.\n\nThe flux is $\\Phi_{f^*} = (\\mathbf{F} \\cdot \\mathbf{n}) A_f = (\\rho c_p T_0 v_x) (b \\Delta y)$. The velocity component $v_x$ is derived from the streamfunction $\\psi(x,y) = \\psi_0 \\sin\\left(\\frac{2\\pi x}{L_x}\\right) \\sin\\left(\\frac{2\\pi y}{L_y}\\right)$:\n$$\nv_x(x,y) = \\frac{\\partial \\psi}{\\partial y} = \\psi_0 \\sin\\left(\\frac{2\\pi x}{L_x}\\right) \\cos\\left(\\frac{2\\pi y}{L_y}\\right) \\left(\\frac{2\\pi}{L_y}\\right)\n$$\nSubstituting all parts, the final expression for the global residual is:\n$$\nR_g = \\epsilon \\cdot \\left[ \\rho c_p T_0 \\left( \\psi_0 \\frac{2\\pi}{L_y} \\sin\\left(\\frac{2\\pi x_{i_0+1/2}}{L_x}\\right) \\cos\\left(\\frac{2\\pi y_{j_0}}{L_y}\\right) \\right) b \\frac{L_y}{N_y} \\right]\n$$\nSimplifying the terms involving $L_y$:\n$$\nR_g = \\epsilon \\cdot \\rho c_p T_0 \\psi_0 b \\frac{2\\pi}{N_y} \\sin\\left(\\frac{2\\pi x_{i_0+1/2}}{L_x}\\right) \\cos\\left(\\frac{2\\pi y_{j_0}}{L_y}\\right)\n$$\nThis formula is implemented for each test case. For cases where $\\epsilon=0$, $R_g$ is identically zero.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test cases.\n    It calculates the global residual imbalance Rg for a 2D thermal-fluid problem\n    with a manufactured solution and a single perturbed face flux.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (happy path, square domain)\n        {'Nx': 32, 'Ny': 32, 'Lx': 1.0, 'Ly': 1.0, 'b': 1.0, 'rho': 1.200, \n         'cp': 1007.0, 'k': 0.026, 'T0': 300.0, 'psi0': 0.10, 'epsilon': 0.0},\n        \n        # Case 2 (rectangular domain, different scales)\n        {'Nx': 17, 'Ny': 31, 'Lx': 2.0, 'Ly': 0.5, 'b': 0.75, 'rho': 1.000, \n         'cp': 1000.0, 'k': 0.600, 'T0': 350.0, 'psi0': 0.05, 'epsilon': 0.0},\n        \n        # Case 3 (fine grid, tiny inconsistency)\n        {'Nx': 64, 'Ny': 64, 'Lx': 1.0, 'Ly': 1.0, 'b': 1.0, 'rho': 1.200, \n         'cp': 1007.0, 'k': 0.026, 'T0': 300.0, 'psi0': 0.10, 'epsilon': 1e-12},\n        \n        # Case 4 (fine grid, larger inconsistency)\n        {'Nx': 64, 'Ny': 64, 'Lx': 1.0, 'Ly': 1.0, 'b': 1.0, 'rho': 1.200, \n         'cp': 1007.0, 'k': 0.026, 'T0': 300.0, 'psi0': 0.10, 'epsilon': 1e-6},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        Nx, Ny = case['Nx'], case['Ny']\n        Lx, Ly = case['Lx'], case['Ly']\n        b = case['b']\n        rho = case['rho']\n        cp = case['cp']\n        T0 = case['T0']\n        psi0 = case['psi0']\n        epsilon = case['epsilon']\n\n        # If epsilon is zero, the residual imbalance is exactly zero.\n        if epsilon == 0.0:\n            results.append(0.0)\n            continue\n\n        # Cell dimensions\n        dx = Lx / Nx\n        dy = Ly / Ny\n\n        # Indices of the perturbed cell\n        i0 = int(np.floor(Nx / 2))\n        j0 = int(np.floor(Ny / 2))\n\n        # Coordinates of the center of the perturbed east face\n        x_face = (i0 + 1.0) * dx\n        y_face = (j0 + 0.5) * dy\n\n        # Calculate the x-component of the velocity at the face center\n        # v_x(x,y) = d(psi)/dy = psi0 * sin(2*pi*x/Lx) * cos(2*pi*y/Ly) * (2*pi/Ly)\n        arg_x = 2.0 * np.pi * x_face / Lx\n        arg_y = 2.0 * np.pi * y_face / Ly\n        \n        vx_face = psi0 * (2.0 * np.pi / Ly) * np.sin(arg_x) * np.cos(arg_y)\n        \n        # Calculate the unperturbed outward flux through the east face\n        # Flux = (rho * cp * T0 * vx) * Area, where Area = b * dy\n        flux_east_unperturbed = rho * cp * T0 * vx_face * b * dy\n        \n        # The global residual imbalance Rg is the sum of imbalances at all faces.\n        # All internal faces cancel in pairs, and boundary fluxes cancel due to periodicity.\n        # The only non-canceling term is from the single perturbed face.\n        # Its contribution is (1+epsilon)*Flux - Flux = epsilon*Flux.\n        Rg = epsilon * flux_east_unperturbed\n        \n        results.append(Rg)\n\n    # Format results in scientific notation for the final output.\n    formatted_results = [f\"{res:.6e}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A powerful technique for verifying the correctness of a numerical solver is the Method of Manufactured Solutions (MMS), which turns the problem on its head. Instead of solving for a complex unknown field, we prescribe a simple, known analytical solution and calculate the source term required to make it an exact solution to the discrete governing equations. This practice  guides you through this process, challenging you to derive the precise source term for a given manufactured temperature field, thereby creating a perfect benchmark to validate the implementation of your FVM code.",
            "id": "3963358",
            "problem": "Consider the two-dimensional transient energy conservation for an incompressible flow with constant properties over a rectangular control volume in a uniform Cartesian mesh. The conservative integral form of energy for a fixed control volume of area $\\Delta x\\,\\Delta y$ and unit thickness in the out-of-plane direction is\n$$\n\\frac{d}{dt}\\int_{\\mathcal{V}} \\rho c_p T\\, dV + \\oint_{\\partial \\mathcal{V}} \\left(\\rho c_p T\\, \\mathbf{u} - k \\nabla T\\right)\\cdot \\mathbf{n}\\, dA = \\int_{\\mathcal{V}} S(\\mathbf{x},t)\\, dV,\n$$\nwhere $\\rho$ is the density, $c_p$ is the specific heat at constant pressure, $k$ is the thermal conductivity, $T(\\mathbf{x},t)$ is the temperature, $\\mathbf{u}$ is the velocity vector, $\\mathbf{n}$ is the outward unit normal on the control volume boundary, and $S(\\mathbf{x},t)$ is a volumetric source term. Assume constant $\\rho$, $c_p$, $k$, and a spatially uniform, divergence-free velocity field $\\mathbf{u} = (U,V)$.\n\nA Finite Volume Method (FVM) discretization is constructed as follows:\n- The accumulation term is approximated over a time step $\\Delta t$ using the forward Euler difference at the cell center: $\\rho c_p \\Delta x \\Delta y \\left[T^{n+1}_P - T^{n}_P\\right]/\\Delta t$.\n- The convective flux is evaluated on each face using a centered value of $T$ at the face midpoint with $\\left(\\rho c_p T\\, \\mathbf{u}\\right)\\cdot \\mathbf{n}$ multiplied by the face area.\n- The diffusive flux is evaluated on each face using a centered normal gradient obtained from adjacent cell-center values with $-k \\nabla T \\cdot \\mathbf{n}$ multiplied by the face area.\n\nUsing the Method of Manufactured Solutions (MMS), prescribe the analytical temperature field\n$$\nT_m(x,y,t) = a\\, x + b\\, y + c + d\\, t,\n$$\nwith constants $a$, $b$, $c$, $d$ and constant properties $\\rho$, $c_p$, $k$, and constant velocity components $U$, $V$. Design a source term $S(\\mathbf{x},t)$ so that, when $T(\\mathbf{x},t) = T_m(x,y,t)$ is sampled at cell centers and face midpoints, the discrete integral balance above is satisfied exactly in every control volume for any uniform $\\Delta x$, $\\Delta y$, and $\\Delta t$.\n\nProvide the final source term as a single, simplified closed-form analytical expression in the International System of Units (SI) of watts per cubic meter. No numerical values are to be substituted for the symbols. Do not report intermediate steps in the final answer. The final answer must be a single expression only.",
            "solution": "The objective is to find a source term $S(\\mathbf{x}, t)$ such that the given discrete form of the energy conservation equation is satisfied exactly when the temperature field is prescribed as the manufactured solution $T_m(x,y,t) = a\\, x + b\\, y + c + d\\, t$.\n\nThe integral form of the energy conservation equation for a fixed control volume $\\mathcal{V}$ is:\n$$\n\\frac{d}{dt}\\int_{\\mathcal{V}} \\rho c_p T\\, dV + \\oint_{\\partial \\mathcal{V}} \\left(\\rho c_p T\\, \\mathbf{u} - k \\nabla T\\right)\\cdot \\mathbf{n}\\, dA = \\int_{\\mathcal{V}} S(\\mathbf{x},t)\\, dV\n$$\nWe consider a two-dimensional rectangular control volume centered at point $P(x_P, y_P)$ with dimensions $\\Delta x \\times \\Delta y$ and unit thickness. The volume is $V = \\Delta x \\Delta y$. The Finite Volume Method (FVM) discretization of this equation is applied term by term.\n\nThe FVM equation can be written as:\n$$\n(\\text{Accumulation Term}) + (\\text{Net Flux Term}) = (\\text{Source Term})\n$$\n\nLet's evaluate each term using the given discretization rules and the manufactured temperature field $T_m(x,y,t)$.\n\n1.  **Accumulation Term**:\n    The accumulation term over a time step $\\Delta t$ is approximated using the forward Euler difference at the cell center $P$:\n    $$\n    \\frac{d}{dt}\\int_{\\mathcal{V}} \\rho c_p T\\, dV \\approx \\rho c_p (\\Delta x \\Delta y) \\frac{T^{n+1}_P - T^{n}_P}{\\Delta t}\n    $$\n    Here, $T_P^n$ is the temperature at the cell center $(x_P, y_P)$ at time $t^n$.\n    Using the manufactured solution, $T_m(x,y,t)$:\n    $$\n    T_P^n = T_m(x_P, y_P, t^n) = a\\, x_P + b\\, y_P + c + d\\, t^n\n    $$\n    $$\n    T_P^{n+1} = T_m(x_P, y_P, t^{n+1}) = a\\, x_P + b\\, y_P + c + d\\, (t^n + \\Delta t)\n    $$\n    The change in temperature is:\n    $$\n    T_P^{n+1} - T_P^n = (a\\, x_P + b\\, y_P + c + d\\,t^n + d\\,\\Delta t) - (a\\, x_P + b\\, y_P + c + d\\,t^n) = d\\,\\Delta t\n    $$\n    Substituting this into the discrete accumulation term expression:\n    $$\n    \\rho c_p \\Delta x \\Delta y \\frac{d\\,\\Delta t}{\\Delta t} = \\rho c_p d \\Delta x \\Delta y\n    $$\n\n2.  **Net Flux Term**:\n    The net flux term is the integral of the flux vector $\\mathbf{F} = \\rho c_p T\\, \\mathbf{u} - k \\nabla T$ over the boundary of the control volume, $\\partial\\mathcal{V}$. This boundary consists of four faces: east ($e$), west ($w$), north ($n$), and south ($s$).\n    $$\n    \\oint_{\\partial \\mathcal{V}} \\mathbf{F} \\cdot \\mathbf{n}\\, dA = \\sum_{f \\in \\{e,w,n,s\\}} (\\mathbf{F} \\cdot \\mathbf{n} A)_f\n    $$\n    We analyze the convective and diffusive parts of the flux separately.\n\n    **a) Net Convective Flux**: $\\oint_{\\partial \\mathcal{V}} (\\rho c_p T\\, \\mathbf{u})\\cdot \\mathbf{n}\\, dA$\n    The velocity is constant, $\\mathbf{u} = (U,V)$. The temperature $T$ is evaluated at the face centers. The face normals are $\\mathbf{n}_e = (1,0)$, $\\mathbf{n}_w = (-1,0)$, $\\mathbf{n}_n = (0,1)$, and $\\mathbf{n}_s = (0,-1)$. The face areas are $A_e=A_w=\\Delta y$ and $A_n=A_s=\\Delta x$.\n    The temperatures at face centers at time $t^n$ are:\n    -   $T_e = T_m(x_P + \\frac{\\Delta x}{2}, y_P, t^n) = T_P^n + a\\frac{\\Delta x}{2}$\n    -   $T_w = T_m(x_P - \\frac{\\Delta x}{2}, y_P, t^n) = T_P^n - a\\frac{\\Delta x}{2}$\n    -   $T_n = T_m(x_P, y_P + \\frac{\\Delta y}{2}, t^n) = T_P^n + b\\frac{\\Delta y}{2}$\n    -   $T_s = T_m(x_P, y_P - \\frac{\\Delta y}{2}, t^n) = T_P^n - b\\frac{\\Delta y}{2}$\n\n    The sum of convective fluxes is:\n    $$\n    (\\rho c_p T_e U)A_e + (\\rho c_p T_w (-U))A_w + (\\rho c_p T_n V)A_n + (\\rho c_p T_s (-V))A_s\n    $$\n    Substituting values:\n    $$\n    \\rho c_p U \\Delta y (T_P^n + a\\frac{\\Delta x}{2}) - \\rho c_p U \\Delta y (T_P^n - a\\frac{\\Delta x}{2}) + \\rho c_p V \\Delta x (T_P^n + b\\frac{\\Delta y}{2}) - \\rho c_p V \\Delta x (T_P^n - b\\frac{\\Delta y}{2})\n    $$\n    Simplifying:\n    $$\n    \\rho c_p U \\Delta y \\left( a\\Delta x \\right) + \\rho c_p V \\Delta x \\left( b \\Delta y \\right) = \\rho c_p (aU + bV) \\Delta x \\Delta y\n    $$\n\n    **b) Net Diffusive Flux**: $\\oint_{\\partial \\mathcal{V}} (-k \\nabla T)\\cdot \\mathbf{n}\\, dA$\n    The diffusive flux is evaluated using a centered normal gradient from adjacent cell-center values.\n    Let $E$, $W$, $N$, $S$ be the centers of the cells adjacent to cell $P$.\n    -   East face ($e$): The flux is $(-k\\nabla T \\cdot \\mathbf{n})_e A_e = -k \\frac{\\partial T}{\\partial x}|_e \\Delta y$. The gradient is approximated as $\\frac{\\partial T}{\\partial x}|_e \\approx \\frac{T_E - T_P}{\\Delta x}$.\n        $T_E = T_m(x_P+\\Delta x, y_P, t^n) = T_P^n + a\\Delta x$. So, $\\frac{T_E - T_P}{\\Delta x} = a$.\n        The flux is $-k a \\Delta y$.\n    -   West face ($w$): The flux is $(-k\\nabla T \\cdot \\mathbf{n})_w A_w = k \\frac{\\partial T}{\\partial x}|_w \\Delta y$. The gradient is $\\frac{\\partial T}{\\partial x}|_w \\approx \\frac{T_P - T_W}{\\Delta x}$.\n        $T_W = T_m(x_P-\\Delta x, y_P, t^n) = T_P^n - a\\Delta x$. So, $\\frac{T_P - T_W}{\\Delta x} = a$.\n        The flux is $k a \\Delta y$.\n    -   North face ($n$): The flux is $(-k\\nabla T \\cdot \\mathbf{n})_n A_n = -k \\frac{\\partial T}{\\partial y}|_n \\Delta x$. The gradient is $\\frac{\\partial T}{\\partial y}|_n \\approx \\frac{T_N - T_P}{\\Delta y}$.\n        $T_N = T_m(x_P, y_P+\\Delta y, t^n) = T_P^n + b\\Delta y$. So, $\\frac{T_N - T_P}{\\Delta y} = b$.\n        The flux is $-k b \\Delta x$.\n    -   South face ($s$): The flux is $(-k\\nabla T \\cdot \\mathbf{n})_s A_s = k \\frac{\\partial T}{\\partial y}|_s \\Delta x$. The gradient is $\\frac{\\partial T}{\\partial y}|_s \\approx \\frac{T_P - T_S}{\\Delta y}$.\n        $T_S = T_m(x_P, y_P-\\Delta y, t^n) = T_P^n - b\\Delta y$. So, $\\frac{T_P - T_S}{\\Delta y} = b$.\n        The flux is $k b \\Delta x$.\n\n    The sum of diffusive fluxes is:\n    $$\n    (-k a \\Delta y) + (k a \\Delta y) + (-k b \\Delta x) + (k b \\Delta x) = 0\n    $$\n    This result is expected, as the FVM discretization of the divergence of a constant vector field (here, $-k\\nabla T_m = -k(a,b)$) on a uniform Cartesian grid is exact and yields zero.\n\n3.  **Source Term**:\n    The integrated source term is approximated as:\n    $$\n    \\int_{\\mathcal{V}} S(\\mathbf{x}, t) dV \\approx S(x_P, y_P, t^n) \\Delta x \\Delta y = S_P \\Delta x \\Delta y\n    $$\n\n4.  **Assemble the Equation and Solve for $S_P$**:\n    We equate the sum of the accumulation and net flux terms to the source term:\n    $$\n    \\rho c_p d \\Delta x \\Delta y + \\rho c_p (aU + bV) \\Delta x \\Delta y + 0 = S_P \\Delta x \\Delta y\n    $$\n    Dividing by the control volume $\\Delta x \\Delta y$:\n    $$\n    \\rho c_p d + \\rho c_p (aU + bV) = S_P\n    $$\n    $$\n    S_P = \\rho c_p (aU + bV + d)\n    $$\n    Since this expression for $S_P$ is independent of the cell location $(x_P, y_P)$, time $t^n$, and the mesh spacings $\\Delta x$ and $\\Delta y$, the required source term $S(\\mathbf{x},t)$ must be a constant function equal to this value for the discrete balance to be satisfied exactly in every control volume.\n\nThe final source term is $S(\\mathbf{x}, t) = \\rho c_p (aU + bV + d)$. Its units are watts per cubic meter (W/m$^3$), as required.",
            "answer": "$$\\boxed{\\rho c_{p} (aU + bV + d)}$$"
        }
    ]
}