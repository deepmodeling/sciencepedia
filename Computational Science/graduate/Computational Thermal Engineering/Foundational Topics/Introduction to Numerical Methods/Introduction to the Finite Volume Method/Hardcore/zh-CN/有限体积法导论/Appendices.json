{
    "hands_on_practices": [
        {
            "introduction": "本练习旨在巩固有限体积法的几何基础。通过在一个四面体控制体上显式计算一个恒定矢量场的离散散度，您将验证其结果精确为零。这项实践将让您通过计算面矢量和通量，亲身体会几何封闭性（即 $\\sum_{f} \\mathbf{S}_f = \\mathbf{0}$）以及它如何确保离散守恒，从而对FVM公式建立直观的理解。",
            "id": "3964724",
            "problem": "三维空间中的一个四面体控制体积，其顶点位置为 $\\mathbf{P}_0=\\left(0,0,0\\right)\\,\\mathrm{m}$、$\\mathbf{P}_1=\\left(2,1,0\\right)\\,\\mathrm{m}$、$\\mathbf{P}_2=\\left(-1,2,3\\right)\\,\\mathrm{m}$ 和 $\\mathbf{P}_3=\\left(0,-2,1\\right)\\,\\mathrm{m}$。考虑一个均匀速度场 $\\mathbf{v}\\left(\\mathbf{x}\\right)=\\mathbf{a}$，其中常数向量 $\\mathbf{a}=\\left(7,-4,1\\right)\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$ 在空间中为常数。从散度定理和有限体积法（FVM, Finite Volume Method）中离散散度作为控制体积平均散度的定义出发，推导一个对于常数 $\\mathbf{v}$ 精确的面通量表示法，并对此四面体单元进行计算。在计算中，仅使用顶点坐标和矢量微积分恒等式构造指向外部的面面积矢量，并使用控制体积的大小进行归一化。\n\n以 $\\mathrm{s}^{-1}$ 为单位，将离散散度报告为单个实数。答案以 $\\mathrm{s}^{-1}$ 为单位表示，并为精确值；无需四舍五入。",
            "solution": "用户要求我解决一个问题。\n\n**问题验证**\n\n第一步是验证问题陈述。\n\n**步骤1：提取已知条件**\n\n*   **几何**：一个由四个顶点定义的四面体控制体积：\n    *   $\\mathbf{P}_0=\\left(0,0,0\\right)\\,\\mathrm{m}$\n    *   $\\mathbf{P}_1=\\left(2,1,0\\right)\\,\\mathrm{m}$\n    *   $\\mathbf{P}_2=\\left(-1,2,3\\right)\\,\\mathrm{m}$\n    *   $\\mathbf{P}_3=\\left(0,-2,1\\right)\\,\\mathrm{m}$\n*   **矢量场**：一个均匀速度场 $\\mathbf{v}\\left(\\mathbf{x}\\right)=\\mathbf{a}$，其中常数向量为 $\\mathbf{a}=\\left(7,-4,1\\right)\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n*   **任务**：\n    1.  从散度定理和有限体积法（FVM）离散散度的定义出发。\n    2.  推导一个对于恒定速度场精确的面通量表示法。\n    3.  通过显式构造指向外部的面面积矢量并使用控制体积的大小进行归一化，对此四面体单元计算该表示法。\n    4.  以 $\\mathrm{s}^{-1}$ 为单位，将离散散度报告为单个实数。\n\n**步骤2：使用提取的已知条件进行验证**\n\n*   **科学依据**：该问题基于矢量微积分（散度定理）和计算流体动力学（有限体积法）的基本原理。这些概念在工程和应用数学中是标准的。该问题是离散化守恒定律的经典练习。\n*   **适定性**：该问题是适定的。给出了顶点坐标和恒定速度矢量，这些信息足以计算四面体的体积、其各个面的面积矢量以及矢量场通过每个面的通量。预期会得到一个唯一的离散散度数值答案。\n*   **客观性**：该问题以精确的数学术语陈述，使用了客观数据和既定定义。没有歧义或主观语言。\n*   **附加检查**：该问题是自洽的，提供的数据在量纲上是一致的（位置单位为 $\\mathrm{m}$，速度单位为 $\\mathrm{m}\\,\\mathrm{s}^{-1}$）。没有矛盾之处。\n\n**步骤3：结论与行动**\n\n该问题被判定为**有效**。这是一个计算热工学中的标准、适定问题，旨在检验对有限体积法的基本理解。我将继续进行求解。\n\n**解**\n\n有限体积法处理守恒定律的基础是控制方程在控制体积 $V$ 上的积分形式。对于矢量场 $\\mathbf{v}$，散度定理指出，该场在体积 $V$ 上的散度积分等于该场通过包围该体积的封闭曲面 $S$ 的净通量：\n$$\n\\int_V (\\nabla \\cdot \\mathbf{v}) \\, dV = \\oint_S \\mathbf{v} \\cdot d\\mathbf{S}\n$$\n在此表达式中，$d\\mathbf{S} = \\mathbf{n} \\, dS$，其中 $\\mathbf{n}$ 是指向外部的单位法向量，作用于面元 $dS$。\n\n对于控制体积 $V$，FVM 中离散散度（或单元平均散度）的定义由下式给出：\n$$\n(\\nabla \\cdot \\mathbf{v})_{\\text{discrete}} = \\frac{1}{V} \\int_V (\\nabla \\cdot \\mathbf{v}) \\, dV\n$$\n结合这两个方程，我们得到 FVM 公式的核心：体积平均散度由净表面通量计算得出。\n$$\n(\\nabla \\cdot \\mathbf{v})_{\\text{discrete}} = \\frac{1}{V} \\oint_S \\mathbf{v} \\cdot d\\mathbf{S}\n$$\n通过对多面体控制体积的每个平面 $f$ 的贡献求和，将面积分进行离散化：\n$$\n\\oint_S \\mathbf{v} \\cdot d\\mathbf{S} = \\sum_f \\int_{S_f} \\mathbf{v} \\cdot d\\mathbf{S}_f\n$$\n对于给定问题，速度场是一个常数矢量，$\\mathbf{v}(\\mathbf{x}) = \\mathbf{a}$。由于 $\\mathbf{a}$ 是常数，可以将其从每个面的积分中提出：\n$$\n\\int_{S_f} \\mathbf{a} \\cdot d\\mathbf{S}_f = \\mathbf{a} \\cdot \\int_{S_f} d\\mathbf{S}_f = \\mathbf{a} \\cdot \\mathbf{S}_f\n$$\n其中 $\\mathbf{S}_f = \\int_{S_f} d\\mathbf{S}_f$ 是面 $f$ 的指向外部的面面积矢量。\n\n因此，离散散度变为：\n$$\n(\\nabla \\cdot \\mathbf{v})_{\\text{discrete}} = \\frac{1}{V} \\sum_f (\\mathbf{a} \\cdot \\mathbf{S}_f)\n$$\n利用点积的分配律，可以写成：\n$$\n(\\nabla \\cdot \\mathbf{v})_{\\text{discrete}} = \\frac{1}{V} \\left( \\mathbf{a} \\cdot \\sum_f \\mathbf{S}_f \\right)\n$$\n任何封闭多面体的一个基本几何特性是其所有指向外部的面面积矢量之和为零矢量：$\\sum_f \\mathbf{S}_f = \\mathbf{0}$。因此，对于任何常数矢量场 $\\mathbf{a}$，净通量为零：\n$$\n\\sum_f (\\mathbf{a} \\cdot \\mathbf{S}_f) = \\mathbf{a} \\cdot \\left( \\sum_f \\mathbf{S}_f \\right) = \\mathbf{a} \\cdot \\mathbf{0} = 0\n$$\n这证明了离散散度精确为零。这与解析散度 $\\nabla \\cdot \\mathbf{a} = \\frac{\\partial a_x}{\\partial x} + \\frac{\\partial a_y}{\\partial y} + \\frac{\\partial a_z}{\\partial z} = 0+0+0 = 0$ 相符。因此，对于任何常数矢量场，该面通量表示法是精确的。\n\n问题要求对给定的四面体进行显式计算。这涉及到计算体积 $V$ 和每个面面积矢量 $\\mathbf{S}_f$。\n\n顶点为 $\\mathbf{P}_0=(0,0,0)$、$\\mathbf{P}_1=(2,1,0)$、$\\mathbf{P}_2=(-1,2,3)$ 和 $\\mathbf{P}_3=(0,-2,1)$。我们定义相对于原点顶点 $\\mathbf{P}_0$ 的位置矢量：\n$\\mathbf{r}_1 = \\mathbf{P}_1 - \\mathbf{P}_0 = (2,1,0)$\n$\\mathbf{r}_2 = \\mathbf{P}_2 - \\mathbf{P}_0 = (-1,2,3)$\n$\\mathbf{r}_3 = \\mathbf{P}_3 - \\mathbf{P}_0 = (0,-2,1)$\n\n四面体的体积 $V$ 由棱向量的标量三重积绝对值的六分之一给出：\n$$\nV = \\frac{1}{6} | \\mathbf{r}_1 \\cdot (\\mathbf{r}_2 \\times \\mathbf{r}_3) |\n$$\n首先，我们计算叉积：\n$$\n\\mathbf{r}_2 \\times \\mathbf{r}_3 = \\begin{vmatrix} \\mathbf{i} & \\mathbf{j} & \\mathbf{k} \\\\ -1 & 2 & 3 \\\\ 0 & -2 & 1 \\end{vmatrix} = \\mathbf{i}(2 - (-6)) - \\mathbf{j}(-1 - 0) + \\mathbf{k}(2 - 0) = (8, 1, 2)\n$$\n然后，计算标量三重积：\n$$\n\\mathbf{r}_1 \\cdot (\\mathbf{r}_2 \\times \\mathbf{r}_3) = (2,1,0) \\cdot (8,1,2) = 2(8) + 1(1) + 0(2) = 16 + 1 + 0 = 17\n$$\n体积为 $V = \\frac{1}{6} |17| = \\frac{17}{6} \\, \\mathrm{m}^3$。\n\n接下来，我们构造四个指向外部的面面积矢量。由顶点 $A$、$B$、$C$ 定义的三角形面的面积矢量为 $\\frac{1}{2}(\\vec{AB} \\times \\vec{AC})$。必须选择叉积的顺序以确保矢量指向四面体外部。\n\n1.  **面 $f_1$ （顶点 $\\mathbf{P}_1, \\mathbf{P}_2, \\mathbf{P}_3$，与 $\\mathbf{P}_0$ 相对）：**\n    $\\vec{\\mathbf{P}_1\\mathbf{P}_2} = \\mathbf{P}_2-\\mathbf{P}_1 = (-3, 1, 3)$\n    $\\vec{\\mathbf{P}_1\\mathbf{P}_3} = \\mathbf{P}_3-\\mathbf{P}_1 = (-2, -3, 1)$\n    $$\n    \\mathbf{S}_1 = \\frac{1}{2}(\\vec{\\mathbf{P}_1\\mathbf{P}_2} \\times \\vec{\\mathbf{P}_1\\mathbf{P}_3}) = \\frac{1}{2}\\begin{vmatrix} \\mathbf{i} & \\mathbf{j} & \\mathbf{k} \\\\ -3 & 1 & 3 \\\\ -2 & -3 & 1 \\end{vmatrix} = \\frac{1}{2}(1 - (-9), -(-3 - (-6)), 9 - (-2)) = \\frac{1}{2}(10, -3, 11)\n    $$\n2.  **面 $f_2$ （顶点 $\\mathbf{P}_0, \\mathbf{P}_1, \\mathbf{P}_2$，与 $\\mathbf{P}_3$ 相对）：**\n    我们使用矢量 $\\mathbf{r}_1$ 和 $\\mathbf{r}_2$。外法线指向远离 $\\mathbf{P}_3$ 的方向。正确的叉积是 $\\frac{1}{2}(\\mathbf{r}_2 \\times \\mathbf{r}_1)$。\n    $$\n    \\mathbf{S}_2 = \\frac{1}{2}(\\mathbf{r}_2 \\times \\mathbf{r}_1) = \\frac{1}{2}\\begin{vmatrix} \\mathbf{i} & \\mathbf{j} & \\mathbf{k} \\\\ -1 & 2 & 3 \\\\ 2 & 1 & 0 \\end{vmatrix} = \\frac{1}{2}(0 - 3, 6 - 0, -1 - 4) = \\frac{1}{2}(-3, 6, -5)\n    $$\n3.  **面 $f_3$ （顶点 $\\mathbf{P}_0, \\mathbf{P}_2, \\mathbf{P}_3$，与 $\\mathbf{P}_1$ 相对）：**\n    我们使用矢量 $\\mathbf{r}_2$ 和 $\\mathbf{r}_3$。外法线指向远离 $\\mathbf{P}_1$ 的方向。叉积为 $\\frac{1}{2}(\\mathbf{r}_3 \\times \\mathbf{r}_2)$。注意 $\\mathbf{r}_3 \\times \\mathbf{r}_2 = -(\\mathbf{r}_2 \\times \\mathbf{r}_3)$。\n    $$\n    \\mathbf{S}_3 = \\frac{1}{2}(\\mathbf{r}_3 \\times \\mathbf{r}_2) = -\\frac{1}{2}(\\mathbf{r}_2 \\times \\mathbf{r}_3) = -\\frac{1}{2}(8, 1, 2) = \\frac{1}{2}(-8, -1, -2)\n    $$\n4.  **面 $f_4$ （顶点 $\\mathbf{P}_0, \\mathbf{P}_3, \\mathbf{P}_1$，与 $\\mathbf{P}_2$ 相对）：**\n    我们使用矢量 $\\mathbf{r}_3$ 和 $\\mathbf{r}_1$。外法线指向远离 $\\mathbf{P}_2$ 的方向。叉积为 $\\frac{1}{2}(\\mathbf{r}_1 \\times \\mathbf{r}_3)$。\n    $$\n    \\mathbf{S}_4 = \\frac{1}{2}(\\mathbf{r}_1 \\times \\mathbf{r}_3) = \\frac{1}{2}\\begin{vmatrix} \\mathbf{i} & \\mathbf{j} & \\mathbf{k} \\\\ 2 & 1 & 0 \\\\ 0 & -2 & 1 \\end{vmatrix} = \\frac{1}{2}(1 - 0, 0 - 2, -4 - 0) = \\frac{1}{2}(1, -2, -4)\n    $$\n为了验证，我们对面面积矢量求和：\n$$\n\\sum_f \\mathbf{S}_f = \\mathbf{S}_1 + \\mathbf{S}_2 + \\mathbf{S}_3 + \\mathbf{S}_4 = \\frac{1}{2} \\left[ (10,-3,11) + (-3,6,-5) + (-8,-1,-2) + (1,-2,-4) \\right]\n$$\n$$\n\\sum_f \\mathbf{S}_f = \\frac{1}{2} (10-3-8+1, -3+6-1-2, 11-5-2-4) = \\frac{1}{2}(0,0,0) = \\mathbf{0}\n$$\n几何封闭条件得到满足。\n\n现在我们用 $\\mathbf{a} = (7, -4, 1)$ 计算每个面的通量 $\\Phi_f = \\mathbf{a} \\cdot \\mathbf{S}_f$：\n$\\Phi_1 = (7,-4,1) \\cdot \\frac{1}{2}(10,-3,11) = \\frac{1}{2}(70+12+11) = \\frac{93}{2}$\n$\\Phi_2 = (7,-4,1) \\cdot \\frac{1}{2}(-3,6,-5) = \\frac{1}{2}(-21-24-5) = \\frac{-50}{2} = -25$\n$\\Phi_3 = (7,-4,1) \\cdot \\frac{1}{2}(-8,-1,-2) = \\frac{1}{2}(-56+4-2) = \\frac{-54}{2} = -27$\n$\\Phi_4 = (7,-4,1) \\cdot \\frac{1}{2}(1,-2,-4) = \\frac{1}{2}(7+8-4) = \\frac{11}{2}$\n\n总通量是各个面通量之和：\n$$\n\\sum_f \\Phi_f = \\frac{93}{2} - 25 - 27 + \\frac{11}{2} = \\frac{104}{2} - 52 = 52 - 52 = 0 \\, \\mathrm{m}^3\\,\\mathrm{s}^{-1}\n$$\n正如理论推导所示，总通量为零。\n\n最后，离散散度是总通量除以控制体积的大小：\n$$\n(\\nabla \\cdot \\mathbf{v})_{\\text{discrete}} = \\frac{\\sum_f \\Phi_f}{V} = \\frac{0}{\\frac{17}{6}} = 0 \\, \\mathrm{s}^{-1}\n$$",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "除了计算通量，许多高阶的有限体积格式还需要在每个控制体内精确地重构解的梯度。本练习将引导您在一个倾斜的四边形网格上，比较两种主流的梯度计算方法：格林-高斯法和最小二乘法。通过这项实践，您可以深入了解在非理想网格上保证计算精度的挑战与细节，这对于实现二阶精度的FVM求解器至关重要。",
            "id": "3964691",
            "problem": "一个平面上的单个斜四边形控制体由其按逆时针顺序列出的顶点定义：$\\left(0,0\\right)$、$\\left(1.8,0.2\\right)$、$\\left(2.0,1.3\\right)$ 和 $\\left(0.2,1.1\\right)$。考虑标量温度场 $T(x,y)=x^{2}+y$。使用适用于有限体积法 (FVM) 的原理，执行以下步骤以比较两种梯度重构策略，并量化它们对线性重构误差的影响：\n\n- 使用简单多边形的标准几何公式计算多边形面积 $A$ 和形心 $\\boldsymbol{x}_{P}=\\left(x_{P},y_{P}\\right)$。\n\n- 使用格林-高斯 (GG) 梯度，通过在控制体边界上离散化的散度定理获得，将单元中心梯度 $\\nabla T\\big|_{P}$ 近似为\n$$\n\\nabla T\\big|_{P}\\approx \\frac{1}{A}\\sum_{f=1}^{4}T\\big(\\boldsymbol{m}_{f}\\big)\\,\\boldsymbol{s}_{f},\n$$\n其中 $\\boldsymbol{m}_{f}$ 是面 $f$ 的中点，$\\boldsymbol{s}_{f}$ 是面 $f$ 的外法向边向量，其大小等于边长（通过将边向量 $\\Delta \\boldsymbol{x}_{f}$ 旋转 $+90^{\\circ}$ 构造，因此对于逆时针排序的多边形，$\\boldsymbol{s}_{f}=\\big(\\Delta y_{f},-\\Delta x_{f}\\big)$）。\n\n- 使用均匀加权最小二乘 (LS) 梯度，通过最小化由四个顶点样本构建的残差平方和来近似单元中心梯度 $\\nabla T\\big|_{P}$。对于均匀权重，这会导出正规方程\n$$\n\\left(\\sum_{i=1}^{4}\\boldsymbol{d}_{i}\\boldsymbol{d}_{i}^{\\mathsf{T}}\\right)\\boldsymbol{g}=\\sum_{i=1}^{4}\\boldsymbol{d}_{i}\\left[T\\left(\\boldsymbol{x}_{i}\\right)-T\\left(\\boldsymbol{x}_{P}\\right)\\right],\n$$\n其中 $\\boldsymbol{d}_{i}=\\boldsymbol{x}_{i}-\\boldsymbol{x}_{P}$ 是从形心到顶点 $i$ 的向量，$\\boldsymbol{g}$ 是 $\\nabla T\\big|_{P}$ 的最小二乘估计。\n\n- 对于每种方法（GG 和 LS），使用以下公式在四个面中点处形成一阶线性重构\n$$\nT_{\\text{rec}}^{(\\cdot)}\\big(\\boldsymbol{m}_{f}\\big)=T\\left(\\boldsymbol{x}_{P}\\right)+\\left[\\nabla T\\big|_{P}\\right]^{(\\cdot)}\\cdot\\left(\\boldsymbol{m}_{f}-\\boldsymbol{x}_{P}\\right),\n$$\n并计算四个面上的均方根 (RMS) 重构误差，\n$$\nE^{(\\cdot)}=\\sqrt{\\frac{1}{4}\\sum_{f=1}^{4}\\left[T_{\\text{rec}}^{(\\cdot)}\\big(\\boldsymbol{m}_{f}\\big)-T\\big(\\boldsymbol{m}_{f}\\big)\\right]^{2}}。\n$$\n\n以纯数（无量纲）形式报告均方根误差之比 $E^{(\\mathrm{GG})}/E^{(\\mathrm{LS})}$。将您的最终答案四舍五入到四位有效数字。",
            "solution": "该问题要求在指定的四边形控制体上，对给定的标量场比较两种梯度重构方案：格林-高斯 (GG) 和最小二乘 (LS)。最终目标是计算面中点处均方根 (RMS) 重构误差之比。\n\n按逆时针顺序列出的四边形顶点为：\n$\\boldsymbol{x}_{1} = (0,0)$\n$\\boldsymbol{x}_{2} = (1.8,0.2)$\n$\\boldsymbol{x}_{3} = (2.0,1.3)$\n$\\boldsymbol{x}_{4} = (0.2,1.1)$\n\n标量温度场由 $T(x,y) = x^2 + y$ 给出。\n\n首先，我们计算控制体的面积 $A$ 和形心 $\\boldsymbol{x}_{P} = (x_P, y_P)$。\n使用鞋带公式计算简单多边形的面积：\n$$A = \\frac{1}{2} \\left| \\sum_{i=1}^{4} (x_i y_{i+1} - x_{i+1} y_i) \\right|$$\n其中 $\\boldsymbol{x}_{5} = \\boldsymbol{x}_{1}$。\n$A = \\frac{1}{2} |(x_1 y_2 - x_2 y_1) + (x_2 y_3 - x_3 y_2) + (x_3 y_4 - x_4 y_3) + (x_4 y_1 - x_1 y_4)|$\n$A = \\frac{1}{2} |(0 \\cdot 0.2 - 1.8 \\cdot 0) + (1.8 \\cdot 1.3 - 2.0 \\cdot 0.2) + (2.0 \\cdot 1.1 - 0.2 \\cdot 1.3) + (0.2 \\cdot 0 - 0 \\cdot 1.1)|$\n$A = \\frac{1}{2} |0 + (2.34 - 0.4) + (2.2 - 0.26) + 0| = \\frac{1}{2} |1.94 + 1.94| = \\frac{1}{2}(3.88) = 1.94$\n\n该控制体是一个平行四边形，这可以通过检查对边的向量来确认：\n$\\boldsymbol{x}_{2}-\\boldsymbol{x}_{1} = (1.8-0, 0.2-0) = (1.8, 0.2)$\n$\\boldsymbol{x}_{3}-\\boldsymbol{x}_{4} = (2.0-0.2, 1.3-1.1) = (1.8, 0.2)$\n对于平行四边形，形心是顶点坐标的平均值：\n$x_P = \\frac{1}{4}(x_1+x_2+x_3+x_4) = \\frac{1}{4}(0+1.8+2.0+0.2) = \\frac{4.0}{4} = 1.0$\n$y_P = \\frac{1}{4}(y_1+y_2+y_3+y_4) = \\frac{1}{4}(0+0.2+1.3+1.1) = \\frac{2.6}{4} = 0.65$\n因此，形心为 $\\boldsymbol{x}_{P} = (1.0, 0.65)$。\n\n接下来，我们计算格林-高斯 (GG) 梯度，$\\nabla T\\big|_{P}^{(\\mathrm{GG})} = \\frac{1}{A} \\sum_{f=1}^{4} T(\\boldsymbol{m}_{f}) \\boldsymbol{s}_{f}$。\n我们需要面中点 $\\boldsymbol{m}_f$ 和外法向向量 $\\boldsymbol{s}_f$。\n\n面 1 (v1 到 v2):\n$\\Delta \\boldsymbol{x}_1 = \\boldsymbol{x}_2 - \\boldsymbol{x}_1 = (1.8, 0.2)$。\n$\\boldsymbol{s}_1 = (\\Delta y_1, -\\Delta x_1) = (0.2, -1.8)$。\n$\\boldsymbol{m}_1 = \\frac{\\boldsymbol{x}_1+\\boldsymbol{x}_2}{2} = (0.9, 0.1)$。\n$T(\\boldsymbol{m}_1) = (0.9)^2 + 0.1 = 0.81 + 0.1 = 0.91$。\n$T(\\boldsymbol{m}_1)\\boldsymbol{s}_1 = 0.91(0.2, -1.8) = (0.182, -1.638)$。\n\n面 2 (v2 到 v3):\n$\\Delta \\boldsymbol{x}_2 = \\boldsymbol{x}_3 - \\boldsymbol{x}_2 = (0.2, 1.1)$。\n$\\boldsymbol{s}_2 = (1.1, -0.2)$。\n$\\boldsymbol{m}_2 = \\frac{\\boldsymbol{x}_2+\\boldsymbol{x}_3}{2} = (1.9, 0.75)$。\n$T(\\boldsymbol{m}_2) = (1.9)^2 + 0.75 = 3.61 + 0.75 = 4.36$。\n$T(\\boldsymbol{m}_2)\\boldsymbol{s}_2 = 4.36(1.1, -0.2) = (4.796, -0.872)$。\n\n面 3 (v3 到 v4):\n$\\Delta \\boldsymbol{x}_3 = \\boldsymbol{x}_4 - \\boldsymbol{x}_3 = (-1.8, -0.2)$。\n$\\boldsymbol{s}_3 = (-0.2, 1.8)$。\n$\\boldsymbol{m}_3 = \\frac{\\boldsymbol{x}_3+\\boldsymbol{x}_4}{2} = (1.1, 1.2)$。\n$T(\\boldsymbol{m}_3) = (1.1)^2 + 1.2 = 1.21 + 1.2 = 2.41$。\n$T(\\boldsymbol{m}_3)\\boldsymbol{s}_3 = 2.41(-0.2, 1.8) = (-0.482, 4.338)$。\n\n面 4 (v4 到 v1):\n$\\Delta \\boldsymbol{x}_4 = \\boldsymbol{x}_1 - \\boldsymbol{x}_4 = (-0.2, -1.1)$。\n$\\boldsymbol{s}_4 = (-1.1, 0.2)$。\n$\\boldsymbol{m}_4 = \\frac{\\boldsymbol{x}_4+\\boldsymbol{x}_1}{2} = (0.1, 0.55)$。\n$T(\\boldsymbol{m}_4) = (0.1)^2 + 0.55 = 0.01 + 0.55 = 0.56$。\n$T(\\boldsymbol{m}_4)\\boldsymbol{s}_4 = 0.56(-1.1, 0.2) = (-0.616, 0.112)$。\n\n总和为：\n$\\sum_{f=1}^{4} T(\\boldsymbol{m}_{f})\\boldsymbol{s}_{f} = (0.182+4.796-0.482-0.616, -1.638-0.872+4.338+0.112)$\n$\\sum_{f=1}^{4} T(\\boldsymbol{m}_{f})\\boldsymbol{s}_{f} = (3.88, 1.94)$。\n\nGG 梯度为：\n$\\nabla T\\big|_{P}^{(\\mathrm{GG})} = \\frac{1}{1.94} (3.88, 1.94) = (2.0, 1.0)$。\n\n接下来，我们通过求解正规方程 $\\left(\\sum_{i=1}^{4}\\boldsymbol{d}_{i}\\boldsymbol{d}_{i}^{\\mathsf{T}}\\right)\\boldsymbol{g}=\\sum_{i=1}^{4}\\boldsymbol{d}_{i}\\left[T\\left(\\boldsymbol{x}_{i}\\right)-T\\left(\\boldsymbol{x}_{P}\\right)\\right]$ 来计算最小二乘 (LS) 梯度 $\\boldsymbol{g}=[\\nabla T\\big|_{P}]^{(\\mathrm{LS)}}$。\n$T(\\boldsymbol{x}_P) = (1.0)^2 + 0.65 = 1.65$。\n位移向量 $\\boldsymbol{d}_i = \\boldsymbol{x}_i - \\boldsymbol{x}_P$ 和顶点温度 $T(\\boldsymbol{x}_i)$ 为：\n$\\boldsymbol{d}_1 = (0,0) - (1.0, 0.65) = (-1.0, -0.65)$; $T(\\boldsymbol{x}_1) = 0$。\n$\\boldsymbol{d}_2 = (1.8,0.2) - (1.0, 0.65) = (0.8, -0.45)$; $T(\\boldsymbol{x}_2) = 1.8^2+0.2 = 3.44$。\n$\\boldsymbol{d}_3 = (2.0,1.3) - (1.0, 0.65) = (1.0, 0.65)$; $T(\\boldsymbol{x}_3) = 2.0^2+1.3 = 5.3$。\n$\\boldsymbol{d}_4 = (0.2,1.1) - (1.0, 0.65) = (-0.8, 0.45)$; $T(\\boldsymbol{x}_4) = 0.2^2+1.1 = 1.14$。\n\n左侧矩阵 $M = \\sum \\boldsymbol{d}_i\\boldsymbol{d}_i^{\\mathsf{T}}$：\n$M_{11} = (-1.0)^2 + (0.8)^2 + (1.0)^2 + (-0.8)^2 = 1.0 + 0.64 + 1.0 + 0.64 = 3.28$。\n$M_{12} = M_{21} = (-1.0)(-0.65) + (0.8)(-0.45) + (1.0)(0.65) + (-0.8)(0.45) = 0.65 - 0.36 + 0.65 - 0.36 = 0.58$。\n$M_{22} = (-0.65)^2 + (-0.45)^2 + (0.65)^2 + (0.45)^2 = 0.4225 + 0.2025 + 0.4225 + 0.2025 = 1.25$。\n$M = \\begin{pmatrix} 3.28 & 0.58 \\\\ 0.58 & 1.25 \\end{pmatrix}$。\n\n右侧向量 $\\boldsymbol{b} = \\sum \\boldsymbol{d}_i(T_i - T_P)$：\n第 1 项: $(-1.0, -0.65)(0 - 1.65) = (1.65, 1.0725)$。\n第 2 项: $(0.8, -0.45)(3.44 - 1.65) = (0.8, -0.45)(1.79) = (1.432, -0.8055)$。\n第 3 项: $(1.0, 0.65)(5.3 - 1.65) = (1.0, 0.65)(3.65) = (3.65, 2.3725)$。\n第 4 项: $(-0.8, 0.45)(1.14 - 1.65) = (-0.8, 0.45)(-0.51) = (0.408, -0.2295)$。\n$\\boldsymbol{b} = (1.65+1.432+3.65+0.408, 1.0725-0.8055+2.3725-0.2295)^{\\mathsf{T}} = (7.14, 2.41)^{\\mathsf{T}}$。\n\n求解 $M\\boldsymbol{g}=\\boldsymbol{b}$：\n$\\det(M) = (3.28)(1.25)-(0.58)^2 = 4.1 - 0.3364 = 3.7636$。\n$\\boldsymbol{g} = M^{-1}\\boldsymbol{b} = \\frac{1}{3.7636}\\begin{pmatrix} 1.25 & -0.58 \\\\ -0.58 & 3.28 \\end{pmatrix} \\begin{pmatrix} 7.14 \\\\ 2.41 \\end{pmatrix}$。\n$g_x = \\frac{1}{3.7636}(1.25 \\cdot 7.14 - 0.58 \\cdot 2.41) = \\frac{8.925 - 1.3978}{3.7636} = \\frac{7.5272}{3.7636} = 2.0$。\n$g_y = \\frac{1}{3.7636}(-0.58 \\cdot 7.14 + 3.28 \\cdot 2.41) = \\frac{-4.1412 + 7.9048}{3.7636} = \\frac{3.7636}{3.7636} = 1.0$。\nLS 梯度为 $\\nabla T\\big|_{P}^{(\\mathrm{LS})} = (2.0, 1.0)$。\n\n$T(x,y)=x^2+y$ 的精确梯度是 $\\nabla T = (2x, 1)$。在形心 $\\boldsymbol{x}_P=(1.0, 0.65)$ 处，精确梯度为 $\\nabla T(\\boldsymbol{x}_P) = (2(1.0), 1) = (2.0, 1.0)$。\n对于这个问题，GG 和 LS 方法在形心处都得到了精确的梯度。这是因为几何形状是平行四边形且场是二次的。\n\n由于两种方法产生相同的梯度向量，$\\nabla T\\big|_{P}^{(\\mathrm{GG})} = \\nabla T\\big|_{P}^{(\\mathrm{LS})}$，因此两种方法在面中点处的线性重构将是相同的：\n$T_{\\text{rec}}^{(\\mathrm{GG})}\\big(\\boldsymbol{m}_{f}\\big) = T(\\boldsymbol{x}_{P})+\\nabla T\\big|_{P}^{(\\mathrm{GG})}\\cdot(\\boldsymbol{m}_{f}-\\boldsymbol{x}_{P})$\n$T_{\\text{rec}}^{(\\mathrm{LS})}\\big(\\boldsymbol{m}_{f}\\big) = T(\\boldsymbol{x}_{P})+\\nabla T\\big|_{P}^{(\\mathrm{LS})}\\cdot(\\boldsymbol{m}_{f}-\\boldsymbol{x}_{P})$\n鉴于梯度相同，对于所有 $f=1,..,4$，有 $T_{\\text{rec}}^{(\\mathrm{GG})}\\big(\\boldsymbol{m}_{f}\\big) = T_{\\text{rec}}^{(\\mathrm{LS})}\\big(\\boldsymbol{m}_{f}\\big)$。\n\n因此，两种方法在每个面上的重构误差将是相同的。均方根误差定义为：\n$E^{(\\mathrm{GG})}=\\sqrt{\\frac{1}{4}\\sum_{f=1}^{4}\\left[T_{\\text{rec}}^{(\\mathrm{GG})}\\big(\\boldsymbol{m}_{f}\\big)-T\\big(\\boldsymbol{m}_{f}\\big)\\right]^{2}}$\n$E^{(\\mathrm{LS})}=\\sqrt{\\frac{1}{4}\\sum_{f=1}^{4}\\left[T_{\\text{rec}}^{(\\mathrm{LS})}\\big(\\boldsymbol{m}_{f}\\big)-T\\big(\\boldsymbol{m}_{f}\\big)\\right]^{2}}$\n由于求和中的各项都相同，因此必然有 $E^{(\\mathrm{GG})} = E^{(\\mathrm{LS})}$。\n重构误差不为零，因为二次函数的线性重构并非完美。例如，对于面 1：\n$\\boldsymbol{r}_1 = \\boldsymbol{m}_1 - \\boldsymbol{x}_P = (0.9, 0.1) - (1.0, 0.65) = (-0.1, -0.55)$。\n$T_{\\text{rec}}(\\boldsymbol{m}_1) = T(\\boldsymbol{x}_P) + \\nabla T\\big|_{P} \\cdot \\boldsymbol{r}_1 = 1.65 + (2.0, 1.0)\\cdot(-0.1, -0.55) = 1.65 - 0.2 - 0.55 = 0.90$。\n精确温度为 $T(\\boldsymbol{m}_1) = 0.91$。\n面 1 的误差平方为 $(0.90 - 0.91)^2 = (-0.01)^2 = 0.0001$。由于此误差不为零，因此 $E^{(\\mathrm{GG})}$ 和 $E^{(\\mathrm{LS})}$ 均不为零且相等。\n\n因此，均方根误差之比为：\n$\\frac{E^{(\\mathrm{GG})}}{E^{(\\mathrm{LS})}} = 1$。\n\n按要求四舍五入到四位有效数字，结果为 $1.000$。",
            "answer": "$$\n\\boxed{1.000}\n$$"
        },
        {
            "introduction": "编写求解器只是工作的一半，验证其正确性同样至关重要。本练习将指导您应用“制造解方法”（Method of Manufactured Solutions, MMS），这是一种强大的代码验证技术。您将为一个预设的精确解推导相应的源项，实现一个二维有限体积求解器，并执行网格加密研究，以验证您的代码是否达到了预期的理论收敛精度。",
            "id": "3964725",
            "problem": "考虑一个方形域中的稳态二维热扩散方程，该方程由包含体积源项的能量守恒定律控制。在域内，控制方程为 $-\\nabla \\cdot (k \\nabla T) = q$，并在所有边界上施加狄利克雷（Dirichlet）边界条件。假设热导率 $k$ 为常数且各向同性，方形域为 $\\Omega = [0,1] \\times [0,1]$，单位为米。在正方形的所有四条边上，边界温度给定为 $T=0$。使用人工解法（Method of Manufactured Solutions, MMS），选择精确解为 $T(x,y) = \\sin(\\pi x)\\sin(\\pi y)$，并推导源项 $q(x,y)$，使得所选的 $T(x,y)$ 在 $k$ 为常数的情况下精确满足控制方程。将 $k$ 视为一个已知的正常数，单位为瓦特每米开尔文 (W/(m·K))。\n\n您的任务是为上述问题实现一个均匀笛卡尔、单元中心的有限体积法 (Finite Volume Method, FVM) 离散化。离散化必须从每个控制体上的守恒积分形式开始，应用散度定理，并对内部区域使用恒定的 $k$ 和相邻单元中心之间的二阶中心差分来近似面上的扩散通量。对于邻近边界的控制体，使用面上的已知边界温度，通过边界面通量以弱形式施加狄利克雷边界条件。将体积源处理为在单元中心评估的 $q(x,y)$ 值乘以控制体面积。求解得到的线性系统以获得单元中心温度场，并根据人工精确解计算单元中心的误差。\n\n在一个网格上定义控制体，该网格在 $x$ 方向有 $N_x$ 个单元，在 $y$ 方向有 $N_y$ 个单元，均匀间距为 $\\Delta x = 1/N_x$ 和 $\\Delta y = 1/N_y$。单元中心位于 $x_i = (i+1/2)\\Delta x$（其中 $i=0,1,\\dots,N_x-1$）和 $y_j = (j+1/2)\\Delta y$（其中 $j=0,1,\\dots,N_y-1$）。面面积为 $S_e=S_w=\\Delta y$ 和 $S_n=S_s=\\Delta x$，相邻单元中心之间的距离为 $d_e=d_w=\\Delta x$ 和 $d_n=d_s=\\Delta y$。对于边界面，使用到边界面的一半距离 $d=\\Delta x/2$ 或 $d=\\Delta y/2$，并使用面上的精确边界温度值 $T_b=0$ 来计算边界通量。体积源项通过将局部源 $q(x_i,y_j)$ 乘以控制体面积 $\\Delta x \\Delta y$ 来计入。\n\n单位：所有温度误差以开尔文 (K) 表示。热导率 $k$ 的单位应为瓦特每米开尔文 (W/(m·K))，源项 $q$ 的单位应为瓦特每立方米 (W/m$^3$)。三角函数中涉及的角度，均以弧度为单位。\n\n测试套件：\n- 案例 A (正常路径): $N_x=N_y=10$, $k=1$ W/(m·K)。\n- 案例 B (加密): $N_x=N_y=20$, $k=1$ W/(m·K)。\n- 案例 C (加密): $N_x=N_y=40$, $k=1$ W/(m·K)。\n- 案例 D (加密，接近渐近): $N_x=N_y=80$, $k=1$ W/(m·K)。\n\n对每个案例，计算：\n- 由 $\\|e\\|_{L^2} = \\left( \\sum_{i,j} \\left( T_{ij}^{\\text{num}} - T(x_i,y_j) \\right)^2 \\Delta x \\Delta y \\right)^{1/2}$ 定义的离散 $L^2$ 误差范数，单位为开尔文 (K)。\n在计算出误差 $(E_{10},E_{20},E_{40},E_{80})$ 后，使用 $r_{m \\to n} = \\dfrac{\\ln(E_m/E_n)}{\\ln(h_m/h_n)}$（其中 $h = \\max(\\Delta x,\\Delta y)$）计算连续加密之间的观测精度阶，特别是 $r_{10 \\to 20}$、$r_{20 \\to 40}$ 和 $r_{40 \\to 80}$。最后，包含一个布尔标志，如果所有三个观测到的精度阶都大于或等于 $1.8$，则该标志为真。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序如下：$[E_{10},E_{20},E_{40},E_{80},r_{10 \\to 20},r_{20 \\to 40},r_{40 \\to 80},\\text{passed}]$。每个误差和阶数必须是浮点数，最后的标志必须是布尔字面量。所有温度误差必须以开尔文 (K) 报告。",
            "solution": "该问题是有效的，因为它基于传热学原理，在数学上是适定的，并为使用有限体积法 (FVM) 进行数值求解和通过人工解法 (MMS) 进行验证提供了完整而明确的说明。\n\n求解过程包括三个主要阶段：\n1.  使用人工解推导源项 $q(x,y)$。\n2.  使用单元中心的有限体积法对控制偏微分方程 (PDE) 进行离散化，以获得一个线性代数方程组。\n3.  实现一个数值求解器，为指定的测试案例求解该线性系统，并随后计算误差范数和收敛阶。\n\n**1. 源项的推导**\n\n控制方程是带有源项 $q$ 的稳态热扩散方程：\n$$ -\\nabla \\cdot (k \\nabla T) = q $$\n鉴于热导率 $k$ 是一个常数标量，这可以简化为泊松方程：\n$$ -k \\nabla^2 T = q $$\n其中 $\\nabla^2$ 是拉普拉斯算子，$\\nabla^2 T = \\frac{\\partial^2 T}{\\partial x^2} + \\frac{\\partial^2 T}{\\partial y^2}$。\n\n问题指定了一个人工解 $T(x,y) = \\sin(\\pi x)\\sin(\\pi y)$。我们必须推导源项 $q(x,y)$，使得这个 $T(x,y)$ 成为偏微分方程的精确解。首先，我们计算 $T(x,y)$ 的二阶偏导数：\n$$ \\frac{\\partial T}{\\partial x} = \\pi \\cos(\\pi x)\\sin(\\pi y) \\implies \\frac{\\partial^2 T}{\\partial x^2} = -\\pi^2 \\sin(\\pi x)\\sin(\\pi y) $$\n$$ \\frac{\\partial T}{\\partial y} = \\pi \\sin(\\pi x)\\cos(\\pi y) \\implies \\frac{\\partial^2 T}{\\partial y^2} = -\\pi^2 \\sin(\\pi x)\\sin(\\pi y) $$\n$T$ 的拉普拉斯算子是这些导数之和：\n$$ \\nabla^2 T = \\frac{\\partial^2 T}{\\partial x^2} + \\frac{\\partial^2 T}{\\partial y^2} = -2\\pi^2 \\sin(\\pi x)\\sin(\\pi y) $$\n将此代入控制方程 $q = -k \\nabla^2 T$，我们得到源项：\n$$ q(x,y) = -k (-2\\pi^2 \\sin(\\pi x)\\sin(\\pi y)) = 2k\\pi^2 \\sin(\\pi x)\\sin(\\pi y) $$\n在模拟中使用此源项时，函数 $T(x,y) = \\sin(\\pi x)\\sin(\\pi y)$ 将是其精确解。所选的 $T(x,y)$ 也满足在域 $\\Omega = [0,1] \\times [0,1]$ 边界上的狄利克雷边界条件 $T=0$。\n\n**2. 有限体积离散化**\n\n我们使用单元中心的有限体积法对控制偏微分方程进行离散化。我们首先在以 $(x_i, y_j)$ 为中心、面积为 $\\Delta V = \\Delta x \\Delta y$ 的通用控制体 (CV) $V_{ij}$ 上对偏微分方程进行积分：\n$$ - \\int_{V_{ij}} \\nabla \\cdot (k \\nabla T) \\, dV = \\int_{V_{ij}} q \\, dV $$\n对左侧应用散度定理，将体积分转换为沿控制体边界 $\\partial V_{ij}$ 的面积分：\n$$ - \\oint_{\\partial V_{ij}} (k \\nabla T) \\cdot \\mathbf{n} \\, dS = \\int_{V_{ij}} q \\, dV $$\n其中 $\\mathbf{n}$ 是控制体边界上的外向法向量。面积分表示流出控制体的净热通量。我们可以将其表示为矩形单元四个面（东、西、南、北，用下标 $e, w, n, s$ 表示）上的通量之和：\n$$ - \\left[ J_e + J_w + J_n + J_s \\right] = Q_{ij} $$\n其中 $J_f = \\int_f (k \\nabla T) \\cdot \\mathbf{n} \\, dS$ 是通过面 $f$ 的积分热通量，而 $Q_{ij} = \\int_{V_{ij}} q \\, dV$ 是在控制体内产生的总热量。\n\n让我们使用物理释义：对于稳态，进入控制体的热量速率必须与热量生成速率相平衡。从邻近单元流入该单元的净热流由下式给出：\n$$ (J_w^{\\text{in}} - J_e^{\\text{out}}) + (J_s^{\\text{in}} - J_n^{\\text{out}}) + Q_{ij} = 0 $$\n近似通量和源项：\n- **源项**：积分源项通过单元中心的值乘以单元体积来近似：$Q_{ij} \\approx q(x_i, y_j) \\Delta x \\Delta y$。\n- **通量**：热通量矢量为 $\\mathbf{j} = -k \\nabla T$。通过一个面的热流是该通量的法向分量在该面面积上的积分。对于东面，其法向量为 $\\mathbf{n}_e = (1,0)$，面积为 $S_e = \\Delta y$：\n$$ J_e^{\\text{out}} \\approx \\left( -k \\frac{\\partial T}{\\partial x} \\right)_e \\Delta y $$\n面上的梯度由相邻单元中心 $P(i,j)$ 和 $E(i+1,j)$ 之间的二阶中心差分近似。中心之间的距离是 $d_e = \\Delta x$。\n$$ \\left( \\frac{\\partial T}{\\partial x} \\right)_e \\approx \\frac{T_{i+1,j} - T_{ij}}{\\Delta x} \\implies J_e^{\\text{out}} \\approx -k \\frac{T_{i+1,j} - T_{ij}}{\\Delta x} \\Delta y $$\n对于内部单元的其他面，类似地：\n$$ J_w^{\\text{in}} \\approx -k \\frac{T_{ij} - T_{i-1,j}}{\\Delta x} \\Delta y $$\n$$ J_n^{\\text{out}} \\approx -k \\frac{T_{i,j+1} - T_{ij}}{\\Delta y} \\Delta x $$\n$$ J_s^{\\text{in}} \\approx -k \\frac{T_{ij} - T_{i,j-1}}{\\Delta y} \\Delta x $$\n将这些近似值代入平衡方程：\n$$ -k \\frac{T_{ij} - T_{i-1,j}}{\\Delta x} \\Delta y - \\left(-k \\frac{T_{i+1,j} - T_{ij}}{\\Delta x} \\Delta y\\right) -k \\frac{T_{ij} - T_{i,j-1}}{\\Delta y} \\Delta x - \\left(-k \\frac{T_{i,j+1} - T_{ij}}{\\Delta y} \\Delta x\\right) + q_{ij} \\Delta x \\Delta y = 0 $$\n重新整理并合并关于 $T_{ij}$ 的项：\n$$ k\\frac{\\Delta y}{\\Delta x}(T_{i-1,j} - T_{ij}) + k\\frac{\\Delta y}{\\Delta x}(T_{i+1,j} - T_{ij}) + k\\frac{\\Delta x}{\\Delta y}(T_{i,j-1} - T_{ij}) + k\\frac{\\Delta x}{\\Delta y}(T_{i,j+1} - T_{ij}) + q_{ij}\\Delta x \\Delta y = 0 $$\n我们定义系数 $a_W = a_E = k\\frac{\\Delta y}{\\Delta x}$ 和 $a_S = a_N = k\\frac{\\Delta x}{\\Delta y}$。方程变为：\n$$ (a_W+a_E+a_S+a_N)T_{ij} - a_W T_{i-1,j} - a_E T_{i+1,j} - a_S T_{i,j-1} - a_N T_{i,j+1} = q_{ij} \\Delta x \\Delta y $$\n令 $a_P = a_W+a_E+a_S+a_N$，我们得到内部单元的标准五点格式：\n$$ a_P T_{ij} - a_W T_{i-1,j} - a_E T_{i+1,j} - a_S T_{i,j-1} - a_N T_{i,j+1} = q_{ij} \\Delta x \\Delta y $$\n\n**边界条件：**\n对于邻近边界的单元，必须使用给定的边界温度 $T_b=0$ 来计算通量。考虑一个位于西边界 ($i=0$) 的单元。其中心到边界的距离是 $d_w = \\Delta x/2$。从边界流入该单元的热流为：\n$$ J_w^{\\text{in}} \\approx -k \\frac{T_{0j} - T_b}{\\Delta x/2} \\Delta y = -2k \\frac{\\Delta y}{\\Delta x}(T_{0j} - T_b) $$\n单元 $(0,j)$（非角点）的平衡方程包含此边界通量项。项 $a_W(T_{i-1,j} - T_{ij})$ 被这个新表达式所取代。\n邻近边界单元的离散方程通过将所有已知的边界温度项移到右侧（源项），并调整中心系数 $a_P$ 来进行修正。\n令 $a_{W,b} = 2k \\frac{\\Delta y}{\\Delta x}$。来自西面的贡献是 $a_{W,b}(T_b - T_{0j})$。项 $-a_{W,b}T_{0j}$ 修正了对角系数 $a_P$，而 $a_{W,b}T_b$ 则被加到源向量中。\n-   **西边界 ($i=0$)**：$a_P$ 增加 $a_{W,b} = 2k\\frac{\\Delta y}{\\Delta x}$，源项增加 $a_{W,b} T_b$。由于 $T_b=0$，源项不变。\n-   **东边界 ($i=N_x-1$)**：$a_P$ 增加 $a_{E,b} = 2k\\frac{\\Delta y}{\\Delta x}$。\n-   **南边界 ($j=0$)**：$a_P$ 增加 $a_{S,b} = 2k\\frac{\\Delta x}{\\Delta y}$。\n-   **北边界 ($j=N_y-1$)**：$a_P$ 增加 $a_{N,b} = 2k\\frac{\\Delta x}{\\Delta y}$。\n一个角点单元，例如 $(0,0)$，会从两个边界（西边界和南边界）获得修正。\n\n**3. 线性系统与求解**\n\n所有 $N_x \\times N_y$ 个单元的这些离散方程构成一个大型、稀疏、对角占优的线性方程组 $A\\mathbf{T} = \\mathbf{b}$，其中 $\\mathbf{T}$ 是未知单元中心温度的向量，$A$ 是系数矩阵，$\\mathbf{b}$ 是源向量。该系统通过数值方法求解。\n\n最终步骤如下：\n1.  对于给定的网格 $(N_x, N_y)$ 和热导率 $k$，构建矩阵 $A$ 和向量 $\\mathbf{b}$。\n2.  求解 $A\\mathbf{T} = \\mathbf{b}$ 以找到数值解 $T_{ij}^{\\text{num}}$。\n3.  在所有单元中心计算精确解 $T(x_i, y_j)$。\n4.  计算离散 $L^2$ 误差范数：$\\|e\\|_{L^2} = \\left( \\sum_{i,j} \\left( T_{ij}^{\\text{num}} - T(x_i,y_j) \\right)^2 \\Delta x \\Delta y \\right)^{1/2}$。\n5.  对于特征单元尺寸为 $h_m$ 和 $h_n$ 的网格，其误差为 $E_m$ 和 $E_n$，计算观测到的精度阶：$r_{m \\to n} = \\frac{\\ln(E_m/E_n)}{\\ln(h_m/h_n)}$。对于 $h_n = h_m/2$ 的连续网格加密，该式简化为 $r = \\frac{\\ln(E_m/E_n)}{\\ln(2)}$。对于此二阶格式，期望的精度阶为 $r \\approx 2$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\nimport math\n\n# --- DO NOT MODIFY THE CODE BELOW ---\n\ndef run_fvm_solver(Nx, Ny, k):\n    \"\"\"\n    Solves the 2D steady heat diffusion problem using a cell-centered FVM.\n\n    Args:\n        Nx (int): Number of cells in the x-direction.\n        Ny (int): Number of cells in the y-direction.\n        k (float): Thermal conductivity.\n\n    Returns:\n        float: The discrete L2 error norm of the solution.\n    \"\"\"\n    dx = 1.0 / Nx\n    dy = 1.0 / Ny\n    total_cells = Nx * Ny\n    \n    # Cell center coordinates\n    x_centers = (np.arange(Nx) + 0.5) * dx\n    y_centers = (np.arange(Ny) + 0.5) * dy\n    \n    A = lil_matrix((total_cells, total_cells))\n    b = np.zeros(total_cells)\n\n    def q_func(x, y, k_val):\n        return 2 * k_val * math.pi**2 * np.sin(math.pi * x) * np.sin(math.pi * y)\n    \n    T_b = 0.0\n\n    for j in range(Ny):\n        for i in range(Nx):\n            p = i + j * Nx\n            \n            # Source term contribution\n            b[p] = q_func(x_centers[i], y_centers[j], k) * dx * dy\n            \n            a_P = 0.0\n\n            # West face contribution\n            if i > 0:\n                a_W = k * dy / dx\n                A[p, p - 1] = -a_W\n                a_P += a_W\n            else: # West boundary\n                a_W_b = 2.0 * k * dy / dx\n                a_P += a_W_b\n                b[p] += a_W_b * T_b\n\n            # East face contribution\n            if i  Nx - 1:\n                a_E = k * dy / dx\n                A[p, p + 1] = -a_E\n                a_P += a_E\n            else: # East boundary\n                a_E_b = 2.0 * k * dy / dx\n                a_P += a_E_b\n                b[p] += a_E_b * T_b\n\n            # South face contribution\n            if j > 0:\n                a_S = k * dx / dy\n                A[p, p - Nx] = -a_S\n                a_P += a_S\n            else: # South boundary\n                a_S_b = 2.0 * k * dx / dy\n                a_P += a_S_b\n                b[p] += a_S_b * T_b\n            \n            # North face contribution\n            if j  Ny - 1:\n                a_N = k * dx / dy\n                A[p, p + Nx] = -a_N\n                a_P += a_N\n            else: # North boundary\n                a_N_b = 2.0 * k * dx / dy\n                a_P += a_N_b\n                b[p] += a_N_b * T_b\n\n            A[p, p] = a_P\n\n    A_csr = A.tocsr()\n    \n    T_vec = spsolve(A_csr, b)\n    T_num = T_vec.reshape((Ny, Nx))\n    \n    X, Y = np.meshgrid(x_centers, y_centers)\n    T_exact = np.sin(np.pi * X) * np.sin(np.pi * Y)\n    \n    error_sq_sum = np.sum((T_num - T_exact)**2)\n    l2_error = np.sqrt(error_sq_sum * dx * dy)\n    \n    return l2_error\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and compute results.\n    \"\"\"\n    test_cases = [\n        (10, 10, 1.0),\n        (20, 20, 1.0),\n        (40, 40, 1.0),\n        (80, 80, 1.0),\n    ]\n\n    errors = []\n    h_values = []\n    for Nx, Ny, k in test_cases:\n        error = run_fvm_solver(Nx, Ny, k)\n        errors.append(error)\n        h_values.append(max(1.0/Nx, 1.0/Ny))\n\n    E10, E20, E40, E80 = errors\n\n    if E20 == 0 or E40 == 0 or E80 == 0:\n        # Avoid division by zero if error is unexpectedly zero\n        r10_20, r20_40, r40_80 = (0.0, 0.0, 0.0)\n    else:\n        r10_20 = np.log(E10 / E20) / np.log(h_values[0] / h_values[1])\n        r20_40 = np.log(E20 / E40) / np.log(h_values[1] / h_values[2])\n        r40_80 = np.log(E40 / E80) / np.log(h_values[2] / h_values[3])\n\n    rates = [r10_20, r20_40, r40_80]\n    passed = all(rate >= 1.8 for rate in rates)\n\n    results = [E10, E20, E40, E80, r10_20, r20_40, r40_80, passed]\n    \n    # Format the output string correctly\n    result_str_parts = []\n    for item in results[:-1]:\n        result_str_parts.append(f\"{item}\")\n    result_str_parts.append(str(results[-1]).lower()) # for boolean 'true'/'false'\n\n    print(f\"[{','.join(result_str_parts)}]\")\n\nsolve()\n```"
        }
    ]
}