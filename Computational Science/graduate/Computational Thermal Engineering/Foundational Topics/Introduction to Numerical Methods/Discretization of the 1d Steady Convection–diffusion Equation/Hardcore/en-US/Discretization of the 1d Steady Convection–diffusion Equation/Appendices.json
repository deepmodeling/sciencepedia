{
    "hands_on_practices": [
        {
            "introduction": "A numerical scheme is an approximation, but what equation does it *actually* solve? Modified equation analysis is a powerful technique that answers this question by revealing the underlying differential equation, including leading-order error terms, that a discrete scheme represents. In this exercise, you will perform a modified equation analysis on the widely used first-order upwind scheme to uncover the source of its inherent inaccuracy—a phenomenon known as artificial diffusion . By quantifying this numerical error, you will see how it directly impacts the prediction of physical features like boundary layer thickness, providing crucial insight into the limitations of simple discretization methods.",
            "id": "3947949",
            "problem": "Consider the one-dimensional steady transport of a passive scalar $\\,\\phi(x)\\,$ in a uniform flow of speed $\\,u>0\\,$ with constant molecular diffusivity $\\,\\alpha\\,$, governed by the conservation law\n$$u\\,\\frac{d\\phi}{dx} \\;=\\; \\alpha\\,\\frac{d^{2}\\phi}{dx^{2}},$$\non a uniform grid with spacing $\\,\\Delta x\\,$. At an interior node indexed by $\\,i\\,$ (located at $\\,x_i\\,$), construct a finite-volume balance that uses first-order upwind for the convective flux and second-order central differencing for the diffusive flux. Starting from this discrete balance, perform a modified equation analysis by Taylor expanding $\\,\\phi_{i\\pm 1}\\,$ about $\\,x_i\\,$ to sufficient order and determine the continuous differential equation that the scheme solves to leading order in $\\,\\Delta x\\,$. Identify the leading-order augmentation to the coefficient multiplying $\\frac{d^2\\phi}{dx^2}$ in closed form, and interpret this augmentation as an artificial diffusion coefficient $\\,\\alpha_{\\mathrm{num}}\\,$ introduced by the upwind discretization.\n\nUsing a scale analysis of the modified equation, infer the effective boundary layer thickness $\\,\\delta_{\\mathrm{eff}}\\,$ adjacent to an inflow boundary by balancing convection against effective diffusion, where the effective diffusion is the sum of the molecular diffusion and the artificial diffusion. Then, for the numerical parameters $\\,u = 2.0\\,\\mathrm{m/s}\\,$, $\\,\\alpha = 1.5\\times 10^{-5}\\,\\mathrm{m^{2}/s}\\,$, and $\\,\\Delta x = 1.0\\times 10^{-2}\\,\\mathrm{m}\\,$, compute $\\,\\delta_{\\mathrm{eff}}\\,$. Express the final boundary layer thickness in meters, and round your answer to four significant figures.\n\nFor context, you may define the Péclet number (Pe) as $\\,\\mathrm{Pe} = \\dfrac{u\\,L}{\\alpha}\\,$ for a characteristic length $\\,L\\,$, but you should not assume a specific $\\,L\\,$ in your derivation of $\\,\\delta_{\\mathrm{eff}}\\,$.",
            "solution": "The user has provided a valid problem statement. The problem is scientifically grounded in computational fluid dynamics, well-posed, and objective. It contains all necessary information to proceed with a unique solution.\n\nThe first step is to derive the discrete form of the governing equation using a finite-volume method on a uniform grid with spacing $\\Delta x$. The one-dimensional steady convection-diffusion equation is:\n$$u\\,\\frac{d\\phi}{dx} \\;=\\; \\alpha\\,\\frac{d^{2}\\phi}{dx^{2}}$$\nAssuming $u$ and $\\alpha$ are constants, we can write this in conservation-law form, $\\frac{dF}{dx} = 0$, where the total flux $F$ is composed of a convective part, $F_c = u\\phi$, and a diffusive part, $F_d = -\\alpha\\frac{d\\phi}{dx}$.\n$$F(x) = u\\phi(x) - \\alpha\\frac{d\\phi}{dx}$$\nWe integrate the conservation law over a control volume (CV) centered at node $i$, extending from the face at $x_{i-1/2}$ to the face at $x_{i+1/2}$. The width of this CV is $\\Delta x$.\n$$\\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{dF}{dx} \\,dx = 0 \\implies F(x_{i+1/2}) - F(x_{i-1/2}) = 0$$\nLet $F_{i+1/2}$ and $F_{i-1/2}$ denote the fluxes at the control volume faces. The discrete balance is $F_{i+1/2} - F_{i-1/2} = 0$.\n\nWe now need to approximate the fluxes at the faces using the nodal values $\\phi_i$.\nThe convective flux, $F_c = u\\phi$, is discretized using a first-order upwind scheme. Since the flow speed $u$ is given as positive ($u>0$), the flow is from left to right. Therefore, the value of $\\phi$ at a face is taken from the upwind (left) node.\n$$ (F_c)_{i-1/2} = u\\phi_{i-1} $$\n$$ (F_c)_{i+1/2} = u\\phi_i $$\nThe diffusive flux, $F_d = -\\alpha\\frac{d\\phi}{dx}$, is discretized using a second-order central difference scheme for the gradient at the face.\n$$ (F_d)_{i-1/2} = -\\alpha \\left(\\frac{d\\phi}{dx}\\right)_{i-1/2} \\approx -\\alpha \\frac{\\phi_i - \\phi_{i-1}}{\\Delta x} $$\n$$ (F_d)_{i+1/2} = -\\alpha \\left(\\frac{d\\phi}{dx}\\right)_{i+1/2} \\approx -\\alpha \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x} $$\nThe total flux at each face is the sum of the convective and diffusive parts.\n$$ F_{i-1/2} = (F_c)_{i-1/2} + (F_d)_{i-1/2} = u\\phi_{i-1} - \\alpha \\frac{\\phi_i - \\phi_{i-1}}{\\Delta x} $$\n$$ F_{i+1/2} = (F_c)_{i+1/2} + (F_d)_{i+1/2} = u\\phi_i - \\alpha \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x} $$\nSubstituting these into the balance equation $F_{i+1/2} - F_{i-1/2} = 0$:\n$$ \\left( u\\phi_i - \\alpha \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x} \\right) - \\left( u\\phi_{i-1} - \\alpha \\frac{\\phi_i - \\phi_{i-1}}{\\Delta x} \\right) = 0 $$\nRearranging the terms, we get:\n$$ u(\\phi_i - \\phi_{i-1}) - \\frac{\\alpha}{\\Delta x} ((\\phi_{i+1} - \\phi_i) - (\\phi_i - \\phi_{i-1})) = 0 $$\n$$ u(\\phi_i - \\phi_{i-1}) = \\frac{\\alpha}{\\Delta x} (\\phi_{i+1} - 2\\phi_i + \\phi_{i-1}) $$\nDividing by $\\Delta x$ yields the standard finite-difference formulation:\n$$ u\\frac{\\phi_i - \\phi_{i-1}}{\\Delta x} = \\alpha\\frac{\\phi_{i+1} - 2\\phi_i + \\phi_{i-1}}{(\\Delta x)^2} $$\nThe left side is a first-order backward difference approximation for $u\\frac{d\\phi}{dx}$, and the right side is a second-order central difference approximation for $\\alpha\\frac{d^2\\phi}{dx^2}$.\n\nNext, we perform a modified equation analysis by replacing the discrete terms with their Taylor series expansions around the point $x_i$. Let $\\phi_i = \\phi(x_i)$, $\\phi' = \\frac{d\\phi}{dx}$, $\\phi'' = \\frac{d^2\\phi}{dx^2}$, etc., with all derivatives evaluated at $x_i$.\n$$ \\phi_{i-1} = \\phi(x_i - \\Delta x) = \\phi_i - \\Delta x\\,\\phi' + \\frac{(\\Delta x)^2}{2}\\phi'' - \\frac{(\\Delta x)^3}{6}\\phi''' + O((\\Delta x)^4) $$\n$$ \\phi_{i+1} = \\phi(x_i + \\Delta x) = \\phi_i + \\Delta x\\,\\phi' + \\frac{(\\Delta x)^2}{2}\\phi'' + \\frac{(\\Delta x)^3}{6}\\phi''' + O((\\Delta x)^4) $$\nWe substitute these expansions into the discrete equation.\nFor the convective term (left-hand side):\n$$ u\\frac{\\phi_i - \\phi_{i-1}}{\\Delta x} = u \\frac{1}{\\Delta x} \\left( \\phi_i - \\left[ \\phi_i - \\Delta x\\,\\phi' + \\frac{(\\Delta x)^2}{2}\\phi'' - \\dots \\right] \\right) = u \\left( \\phi' - \\frac{\\Delta x}{2}\\phi'' + O((\\Delta x)^2) \\right) $$\nFor the diffusive term (right-hand side):\n$$ \\phi_{i+1} - 2\\phi_i + \\phi_{i-1} = (\\phi_i + \\Delta x \\phi' + \\frac{(\\Delta x)^2}{2}\\phi'' + \\dots) - 2\\phi_i + (\\phi_i - \\Delta x \\phi' + \\frac{(\\Delta x)^2}{2}\\phi'' - \\dots) = (\\Delta x)^2\\phi'' + O((\\Delta x)^4) $$\n$$ \\alpha\\frac{\\phi_{i+1} - 2\\phi_i + \\phi_{i-1}}{(\\Delta x)^2} = \\alpha \\frac{(\\Delta x)^2\\phi'' + O((\\Delta x)^4)}{(\\Delta x)^2} = \\alpha\\phi'' + O((\\Delta x)^2) $$\nEquating the expanded terms:\n$$ u\\phi' - u\\frac{\\Delta x}{2}\\phi'' + O((\\Delta x)^2) = \\alpha\\phi'' + O((\\Delta x)^2) $$\nRearranging to isolate the original equation terms:\n$$ u\\frac{d\\phi}{dx} = \\alpha\\frac{d^2\\phi}{dx^2} + u\\frac{\\Delta x}{2}\\frac{d^2\\phi}{dx^2} + O((\\Delta x)^2) $$\nThe modified equation, which is the differential equation solved by the numerical scheme to leading order, is:\n$$ u\\frac{d\\phi}{dx} = \\left(\\alpha + \\frac{u\\Delta x}{2}\\right) \\frac{d^2\\phi}{dx^2} $$\nComparing this to the original equation, we identify the term added to the molecular diffusivity $\\alpha$ as the artificial or numerical diffusion coefficient, $\\alpha_{\\mathrm{num}}$.\n$$ \\alpha_{\\mathrm{num}} = \\frac{u\\Delta x}{2} $$\nThe effective diffusion coefficient is $\\alpha_{\\mathrm{eff}} = \\alpha + \\alpha_{\\mathrm{num}} = \\alpha + \\frac{u\\Delta x}{2}$.\n\nThe thickness of a boundary layer is determined by a scale analysis that balances the convective and diffusive transport terms. For the modified equation, this balance is between convection and effective diffusion. Let $\\delta_{\\mathrm{eff}}$ be the effective boundary layer thickness.\nThe scaling of the terms is:\n$$ \\text{Convection: } u\\frac{d\\phi}{dx} \\sim u\\frac{\\Delta\\phi}{\\delta_{\\mathrm{eff}}} $$\n$$ \\text{Effective Diffusion: } \\alpha_{\\mathrm{eff}}\\frac{d^2\\phi}{dx^2} \\sim \\alpha_{\\mathrm{eff}}\\frac{\\Delta\\phi}{\\delta_{\\mathrm{eff}}^2} $$\nEquating the scales:\n$$ u\\frac{\\Delta\\phi}{\\delta_{\\mathrm{eff}}} \\sim \\alpha_{\\mathrm{eff}}\\frac{\\Delta\\phi}{\\delta_{\\mathrm{eff}}^2} \\implies \\delta_{\\mathrm{eff}} \\sim \\frac{\\alpha_{\\mathrm{eff}}}{u} $$\nSubstituting the expression for $\\alpha_{\\mathrm{eff}}$:\n$$ \\delta_{\\mathrm{eff}} = \\frac{\\alpha + \\alpha_{\\mathrm{num}}}{u} = \\frac{\\alpha + \\frac{u\\Delta x}{2}}{u} = \\frac{\\alpha}{u} + \\frac{\\Delta x}{2} $$\nNow, we compute the numerical value of $\\delta_{\\mathrm{eff}}$ using the given parameters: $u = 2.0\\,\\mathrm{m/s}$, $\\alpha = 1.5\\times 10^{-5}\\,\\mathrm{m^{2}/s}$, and $\\Delta x = 1.0\\times 10^{-2}\\,\\mathrm{m}$.\n$$ \\delta_{\\mathrm{eff}} = \\frac{1.5\\times 10^{-5}\\,\\mathrm{m^2/s}}{2.0\\,\\mathrm{m/s}} + \\frac{1.0\\times 10^{-2}\\,\\mathrm{m}}{2} $$\n$$ \\delta_{\\mathrm{eff}} = (7.5 \\times 10^{-6})\\,\\mathrm{m} + (0.5 \\times 10^{-2})\\,\\mathrm{m} $$\n$$ \\delta_{\\mathrm{eff}} = 0.0000075\\,\\mathrm{m} + 0.005\\,\\mathrm{m} = 0.0050075\\,\\mathrm{m} $$\nThe problem requires the answer to be rounded to four significant figures. The first four significant figures are $5$, $0$, $0$, $7$. The fifth is $5$, so we round up the fourth digit.\n$$ \\delta_{\\mathrm{eff}} \\approx 0.005008\\,\\mathrm{m} $$",
            "answer": "$$\\boxed{0.005008}$$"
        },
        {
            "introduction": "Understanding the limitations of basic schemes, such as the numerical diffusion inherent in the upwind method, naturally leads to the development of more sophisticated alternatives. The exponential scheme is a classic example of a physically-based discretization that uses the exact analytical solution of the local 1D convection-diffusion equation to inform the stencil weights. This hands-on practice guides you through the derivation and implementation of this highly accurate method, including the critical task of ensuring its numerical stability across a wide range of Péclet numbers . This exercise demonstrates how to build schemes that are not just mathematically consistent, but also physically faithful.",
            "id": "3948014",
            "problem": "Consider the one-dimensional steady convection–diffusion of a scalar field $\\,\\phi(x)\\,$ on a uniform grid along the spatial coordinate $\\,x\\,$ with constant properties. The governing balance for a conserved scalar in steady state, neglecting volumetric sources, is the differential equation\n$$\n\\frac{d}{dx}\\left(\\Gamma\\,\\frac{d\\phi}{dx}\\right) - \\rho\\,u\\,\\frac{d\\phi}{dx} = 0,\n$$\nwhere $\\,\\Gamma\\,$ is the diffusion coefficient, $\\,\\rho\\,$ is the density, and $\\,u\\,$ is the constant velocity. Assume a unit cross-sectional area. Using a control-volume finite volume method with a uniform grid spacing $\\,\\Delta x\\,$ and interior node $\\,P\\,$ with neighbors $\\,W\\,$ and $\\,E\\,$, define the mass flux magnitude $\\,F = \\rho\\,u\\,$ and the diffusive conductance $\\,D = \\Gamma/\\Delta x\\,$. The face Peclet number, which is uniform for this setup, is \n$$\nP = \\frac{F}{D} = \\frac{\\rho\\,u\\,\\Delta x}{\\Gamma}.\n$$\nYour task is to derive the discrete equation at a representative interior node $\\,P\\,$ based on exact integration of the local one-dimensional steady convection–diffusion equation within each control volume and face interpolation that is consistent with this exact local solution (this approach is commonly referred to as the exponential scheme). From first principles, start from the governing balance and show how the convective and diffusive fluxes at the faces combine to yield a linear discrete equation of the form\n$$\na_W\\,\\phi_W + a_E\\,\\phi_E - a_P\\,\\phi_P = 0,\n$$\nwith coefficients $\\,a_W\\,$, $\\,a_E\\,$, and $\\,a_P\\,$ expressed solely in terms of $\\,F\\,$, $\\,D\\,$, and $\\,P\\,$ for a uniform grid and constant properties, assuming zero volumetric source.\n\nAfter your derivation, implement a program that computes the discrete coefficients $\\,a_W\\,$, $\\,a_E\\,$, and $\\,a_P\\,$ for a representative interior node using the exponential scheme for the following test suite. For numerical robustness of your implementation, if $\\,|P|\\,$ is very small, you must use a series expansion consistent with the exact local solution to evaluate the required face weighting function to avoid catastrophic cancellation.\n\nThe test suite parameter sets are given by ordered pairs $\\,(\\text{Pe}, D)\\,$, where $\\,\\text{Pe}=P\\,$ is the Peclet number and $\\,D\\,$ is the diffusive conductance:\n- General convection-diffusion (happy path): $\\,(\\text{Pe}=10,\\;D=2.0)\\,$.\n- Pure diffusion limit: $\\,(\\text{Pe}=0,\\;D=2.0)\\,$.\n- Convection to the left (negative flow): $\\,(\\text{Pe}=-10,\\;D=2.0)\\,$.\n- Near-zero Peclet number (numerical stability check): $\\,(\\text{Pe}=10^{-6},\\;D=2.0)\\,$.\n- Strong convection limit: $\\,(\\text{Pe}=100,\\;D=2.0)\\,$.\n\nFor each test case, compute and report the triplet $\\,\\big[a_W,\\;a_E,\\;a_P\\big]\\,$. Your program should produce a single line of output containing the results as a comma-separated list of the five triplets, enclosed in square brackets, with each coefficient rounded to six decimal places. For example, the output format must be\n$$\n\\texttt{[[aW1,aE1,aP1],[aW2,aE2,aP2],[aW3,aE3,aP3],[aW4,aE4,aP4],[aW5,aE5,aP5]]}\n$$\nAll outputs are pure numbers with no units.",
            "solution": "The problem statement is scientifically grounded, well-posed, objective, and self-contained. It describes a standard problem in computational transport phenomena: the derivation and application of the exponential discretization scheme for the one-dimensional steady convection-diffusion equation. The provided governing equation, definitions, and boundary conditions are consistent and standard in the field. Therefore, the problem is valid, and a solution will be furnished.\n\nThe derivation proceeds from the fundamental principles of the finite volume method, leveraging the exact analytical solution of the local governing equation.\n\nThe one-dimensional steady-state convection-diffusion equation for a scalar property $\\phi(x)$ with constant properties ($\\rho$, $u$, $\\Gamma$) and no source term is given as:\n$$\n\\frac{d}{dx}\\left(\\Gamma\\,\\frac{d\\phi}{dx}\\right) - \\rho\\,u\\,\\frac{d\\phi}{dx} = 0\n$$\nFor constant $\\rho$ and $u$, the convective term can be written in divergence form, $\\rho u \\frac{d\\phi}{dx} = \\frac{d}{dx}(\\rho u \\phi)$. The equation can thus be expressed in a conservative form representing the balance of the total flux, $J(x) = \\rho u \\phi - \\Gamma \\frac{d\\phi}{dx}$:\n$$\n-\\frac{d J(x)}{dx} = 0 \\quad \\text{or} \\quad \\frac{d}{dx}\\left( \\Gamma \\frac{d\\phi}{dx} - \\rho u \\phi\\right) = 0\n$$\nWe apply the finite volume method by integrating this equation over a control volume (CV) surrounding a generic interior node $P$. The CV extends from a west face $w$, located halfway between nodes $W$ and $P$, to an east face $e$, located halfway between nodes $P$ and $E$. The grid spacing is uniform, $\\Delta x$.\n$$\n\\int_{w}^{e} \\frac{d}{dx}\\left( \\Gamma \\frac{d\\phi}{dx} - \\rho u \\phi\\right) dx = 0\n$$\nApplying the fundamental theorem of calculus yields the flux balance for the CV:\n$$\n\\left( \\Gamma \\frac{d\\phi}{dx} - \\rho u \\phi\\right)\\bigg|_e - \\left( \\Gamma \\frac{d\\phi}{dx} - \\rho u \\phi\\right)\\bigg|_w = 0\n$$\nThis states that the net flux out of the CV is zero in the steady state. Let's denote the total flux as $J_{total} = \\rho u \\phi - \\Gamma \\frac{d\\phi}{dx}$. The balance is simply $J_{total, e} - J_{total, w} = 0$.\n\nThe core of the exponential scheme is to use the exact local solution of the governing ODE to evaluate the fluxes $J_{total, e}$ and $J_{total, w}$. Let's solve the ODE $\\Gamma\\phi'' - \\rho u \\phi' = 0$. The general solution is of the form:\n$$\n\\phi(x) = C_1 e^{(\\rho u / \\Gamma)x} + C_2\n$$\nConsider the segment between any two nodes, say node $A$ at $x=0$ and node $B$ at $x=\\Delta x$. The boundary conditions are $\\phi(0) = \\phi_A$ and $\\phi(\\Delta x) = \\phi_B$. Applying these conditions allows us to solve for the constants $C_1$ and $C_2$. The resulting solution for $\\phi(x)$ in the interval $[0, \\Delta x]$ is:\n$$\n\\frac{\\phi(x) - \\phi_A}{\\phi_B - \\phi_A} = \\frac{e^{P \\cdot (x/\\Delta x)} - 1}{e^P - 1}\n$$\nwhere $P = \\frac{\\rho u \\Delta x}{\\Gamma}$ is the grid Peclet number.\n\nA key insight is that for this source-free 1D problem, the total flux $J_{total}(x)$ is constant between any two nodes. We can find this constant flux by evaluating $J_{total}(x) = \\rho u \\phi(x) - \\Gamma \\frac{d\\phi}{dx}$ at any point $x \\in [0, \\Delta x]$ using the exact solution. This calculation yields a remarkably simple expression for the flux in terms of the nodal values $\\phi_A$ and $\\phi_B$:\n$$\nJ_{total} = \\rho u \\frac{\\phi_A e^P - \\phi_B}{e^P - 1}\n$$\nUsing the definitions $F = \\rho u$ (mass flux) and $D = \\Gamma / \\Delta x$ (diffusive conductance), and the relation $P = F/D$, this can be written as:\n$$\nJ_{total} = F \\frac{\\phi_A e^P - \\phi_B}{e^P - 1}\n$$\nWe now apply this result to our CV balance, $J_{total, e} - J_{total, w} = 0$.\nThe flux at face $e$ is determined by the nodes bracketing it, $P$ and $E$. In this context, $A=P$ and $B=E$.\n$$\nJ_{total, e} = F \\frac{\\phi_P e^P - \\phi_E}{e^P - 1}\n$$\nThe flux at face $w$ is determined by nodes $W$ and $P$. Here, $A=W$ and $B=P$.\n$$\nJ_{total, w} = F \\frac{\\phi_W e^P - \\phi_P}{e^P - 1}\n$$\nSubstituting these into the flux balance gives:\n$$\nF \\frac{\\phi_P e^P - \\phi_E}{e^P - 1} - F \\frac{\\phi_W e^P - \\phi_P}{e^P - 1} = 0\n$$\nSince $F$ is a common factor (and we assume $F \\neq 0$ for a moment), we can simplify:\n$$\n(\\phi_P e^P - \\phi_E) - (\\phi_W e^P - \\phi_P) = 0\n$$\nRearranging and grouping terms by nodal values $\\phi_W$, $\\phi_P$, and $\\phi_E$:\n$$\n(-\\phi_W e^P) + (-\\phi_E) + \\phi_P(e^P + 1) = 0\n$$\nTo match the desired form $a_W \\phi_W + a_E \\phi_E - a_P \\phi_P = 0$, we can express the equation as:\n$$\n\\left(\\frac{F e^P}{e^P-1}\\right) \\phi_W + \\left(\\frac{F}{e^P-1}\\right) \\phi_E - \\left(\\frac{F(e^P+1)}{e^P-1}\\right) \\phi_P = 0\n$$\nThis leads to the identification of the coefficients:\n$$\na_W = F \\frac{e^P}{e^P-1}\n$$\n$$\na_E = \\frac{F}{e^P-1}\n$$\n$$\na_P = F \\frac{e^P+1}{e^P-1}\n$$\nIt can be readily verified that $a_P = a_W + a_E$, which is a required property for a conservative scheme with no source terms. These expressions are valid for both positive and negative $P$.\n\nFor numerical implementation, it is advantageous to express these coefficients in terms of $D$ and a function of $P$ to handle the case $P \\to 0$ robustly. Using $F=P \\cdot D$:\n$$\na_E = (P \\cdot D) \\frac{1}{e^P-1} = D \\left(\\frac{P}{e^P-1}\\right)\n$$\n$$\na_W = (P \\cdot D) \\frac{e^P}{e^P-1} = D \\left(\\frac{P e^P}{e^P-1}\\right) = D \\left(\\frac{-P}{e^{-P}-1}\\right)\n$$\nLet us define the function $B(z) = \\frac{z}{e^z-1}$. The coefficients become:\n$$\na_E = D \\cdot B(P)\n$$\n$$\na_W = D \\cdot B(-P)\n$$\n$$\na_P = a_W + a_E = D \\cdot (B(P) + B(-P))\n$$\nThis formulation is numerically robust. As $P \\to 0$, the expression $e^P-1$ suffers from catastrophic cancellation. However, the limit of $B(P)$ as $P \\to 0$ is well-defined: $\\lim_{P\\to 0} B(P) = 1$. This can be shown using L'Hôpital's rule or by Taylor expansion: $e^P \\approx 1+P$, so $B(P) \\approx P/((1+P)-1)=1$.\nFor the limit $P=0$ (pure diffusion), we get:\n$a_E = D \\cdot B(0) = D \\cdot 1 = D$.\n$a_W = D \\cdot B(0) = D \\cdot 1 = D$.\n$a_P = D+D = 2D$.\nThis correctly recovers the standard central-difference scheme for pure diffusion.\n\nFor computation, when $|P|$ is very small but non-zero, using the `numpy.expm1(P)` function, which computes $e^P-1$ accurately, avoids numerical instability. For $P=0$, the limit value of $1$ must be used for $B(0)$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the discrete coefficients for the 1D steady convection-diffusion equation\n    using the exponential scheme for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement as (Pe, D) pairs.\n    # Pe is the Peclet number (P), and D is the diffusive conductance.\n    test_cases = [\n        (10.0, 2.0),      # General convection-diffusion\n        (0.0, 2.0),       # Pure diffusion limit\n        (-10.0, 2.0),     # Convection to the left (negative flow)\n        (1e-6, 2.0),      # Near-zero Peclet number (numerical stability check)\n        (100.0, 2.0),     # Strong convection limit\n    ]\n\n    results_formatted = []\n    \n    # Helper function B(z) = z / (exp(z) - 1)\n    # This function is central to the exponential scheme coefficients.\n    def B(z):\n        \"\"\"\n        Computes z / (exp(z) - 1) robustly.\n        For z -> 0, the limit is 1.\n        For small non-zero z, np.expm1(z) provides an accurate computation\n        of exp(z) - 1, avoiding catastrophic cancellation.\n        \"\"\"\n        if z == 0.0:\n            return 1.0\n        else:\n            return z / np.expm1(z)\n\n    for case in test_cases:\n        P, D = case\n        \n        # The mass flux F is related to P and D by F = P * D.\n        # The coefficients are expressed in terms of D and the function B(P).\n        # This formulation is robust for all values of P, including P -> 0.\n        \n        # Coefficient for the east node (E)\n        # a_E = D * (P / (exp(P) - 1)) = D * B(P)\n        a_E = D * B(P)\n        \n        # Coefficient for the west node (W)\n        # a_W = D * (P * exp(P) / (exp(P) - 1)) = D * B(-P)\n        a_W = D * B(-P)\n        \n        # Coefficient for the center node (P)\n        # For a source-free problem, a_P = a_W + a_E\n        a_P = a_W + a_E\n        \n        # Append the formatted triplet to the results list\n        results_formatted.append(f\"[{a_W:.6f},{a_E:.6f},{a_P:.6f}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_formatted)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Theoretical analysis tells us a scheme should be 'first-order' or 'second-order' accurate, but how can we verify this in a real computer program? The Method of Manufactured Solutions (MMS) provides a rigorous framework for just this purpose. In this capstone exercise, you will conduct a formal convergence study to compare the performance of the first-order upwind scheme against the higher-order QUICK scheme . By implementing these methods and measuring their error on a problem with a known exact solution, you will gain practical experience in quantifying the order of accuracy, a fundamental skill in computational code verification and validation.",
            "id": "3947959",
            "problem": "Consider the one-dimensional, steady convection–diffusion equation on a periodic domain, posed in conservation form, for a smooth scalar field $\\,\\phi(x)\\,$,\n$$\n\\frac{d}{dx}\\Big(\\Gamma \\,\\frac{d\\phi}{dx}\\Big)\\;-\\;\\frac{d}{dx}\\big(\\rho u\\,\\phi\\big)\\;=\\;s(x),\\quad x\\in[0,1],\n$$\nwith periodic boundary conditions on $[0,1]$. Here $\\,\\Gamma>0\\,$ is the diffusion coefficient, $\\,\\rho u>0\\,$ is the constant mass flux (density times velocity), and $\\,s(x)\\,$ is a prescribed source. Use a manufactured smooth solution $\\,\\phi_{\\text{exact}}(x)=\\sin(2\\pi x)\\,$ to define a consistent source via the differential equation. Derivatives of $\\,\\phi_{\\text{exact}}\\,$ are $\\,\\phi_{\\text{exact}}'(x)=2\\pi\\cos(2\\pi x)\\,$ and $\\,\\phi_{\\text{exact}}''(x)=-(2\\pi)^2\\sin(2\\pi x)\\,$. Therefore set\n$$\ns(x)\\;=\\;\\Gamma\\,\\phi_{\\text{exact}}''(x)\\;-\\;\\rho u\\,\\phi_{\\text{exact}}'(x)\\;=\\;-\\Gamma\\,(2\\pi)^2\\,\\sin(2\\pi x)\\;-\\;\\rho u\\,(2\\pi)\\,\\cos(2\\pi x).\n$$\n\nDiscretize the equation using a finite volume method on a uniform mesh with $\\,N\\,$ cell centers $\\,x_i=(i+\\tfrac{1}{2})\\Delta x\\,$ for $\\,i=0,1,\\dots,N-1\\,$ and $\\,\\Delta x=1/N\\,$. Approximate the diffusive flux at a face by a central difference of neighboring cell-center values. Approximate the convective flux at a face by either:\n\n- Upwind for positive velocity: face values equal to the upwind cell-center value.\n- Quadratic Upstream Interpolation for Convective Kinematics (QUICK) for positive velocity: face values equal to a quadratic upstream-biased interpolation of three neighboring cell-center values. Specifically, on a uniform grid, for the east face between cells $\\,i\\,$ and $\\,i+1\\,$,\n$$\n\\phi_e=\\frac{3}{8}\\,\\phi_{i+1}+\\frac{6}{8}\\,\\phi_{i}-\\frac{1}{8}\\,\\phi_{i-1},\n$$\nand for the west face between cells $\\,i-1\\,$ and $\\,i\\,$,\n$$\n\\phi_w=\\frac{3}{8}\\,\\phi_{i}+\\frac{6}{8}\\,\\phi_{i-1}-\\frac{1}{8}\\,\\phi_{i-2},\n$$\nwith periodic wrapping of indices.\n\nForm the discrete balance over each control volume using face fluxes, and approximate the source integral by the midpoint rule $\\,s(x_i)\\Delta x\\,$. Because the periodic operator admits a constant null space, impose a single anchoring constraint to select the physically relevant solution by setting the value in one selected cell to the exact manufactured solution at that cell.\n\nDefine the global error $\\ell_2$ norm as\n$$\n\\|e\\|_2=\\Big(\\sum_{i=0}^{N-1}\\big(\\phi_i-\\phi_{\\text{exact}}(x_i)\\big)^2\\,\\Delta x\\Big)^{1/2}.\n$$\nFor a sequence of refinements $\\,N\\in\\{20,40,80,160\\}\\,$, compute the errors for both schemes (upwind and QUICK), then estimate the observed convergence rates $\\,p\\,$ by a least-squares fit of $\\log\\|e\\|_2$ versus $\\log \\Delta x$, so that $\\log\\|e\\|_2 \\approx \\log C + p \\log \\Delta x$.\n\nFrom truncation error analysis, the expected observed orders on smooth solutions for the combined convection–diffusion operator with central diffusion discretization and positive velocity are:\n- Upwind convection: first order, $p \\approx 1$.\n- QUICK convection: second order, $p \\approx 2$ (limited by the second-order diffusive discretization).\n\nYour task is to implement this discretization and quantification and to compare the measured rates against these expectations for the following test suite with constant coefficients:\n- Case $\\,1\\,$: $\\,\\Gamma=0.1\\,$, $\\,\\rho u=1.0\\,$.\n- Case $\\,2\\,$: $\\,\\Gamma=1.0\\,$, $\\,\\rho u=1.0\\,$.\n- Case $\\,3\\,$: $\\,\\Gamma=0.01\\,$, $\\,\\rho u=1.0\\,$.\n\nFor each case, compute the measured orders $\\,p_{\\text{upwind}}\\,$ and $\\,p_{\\text{QUICK}}\\,$ and also produce boolean indicators comparing them to the expected values using a tolerance of $\\,0.25\\,$; i.e., report $|\\,p_{\\text{upwind}}-1\\,| \\le 0.25$ and $|\\,p_{\\text{QUICK}}-2\\,| \\le 0.25$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain, in order for cases $\\,1\\,$, $\\,2\\,$, and $\\,3\\,$: $[p_{\\text{upwind}},p_{\\text{QUICK}},\\text{match}_{\\text{upwind}},\\text{match}_{\\text{QUICK}},\\dots]$, where the dots indicate repetition of this four-item pattern for the subsequent cases. All numerical answers must be reported as dimensionless floats, and all boolean answers as either $\\,\\text{True}\\,$ or $\\,\\text{False}\\,$.",
            "solution": "The problem is deemed valid as it is scientifically grounded, well-posed, objective, and internally consistent. It presents a standard verification exercise for numerical methods applied to the convection-diffusion equation. We proceed with the solution.\n\nThe one-dimensional, steady-state convection–diffusion equation in conservative form is given by\n$$\n\\frac{d}{dx}\\Big(\\Gamma \\,\\frac{d\\phi}{dx}\\Big)\\;-\\;\\frac{d}{dx}\\big(\\rho u\\,\\phi\\big)\\;=\\;s(x), \\quad x \\in [0,1]\n$$\nwith periodic boundary conditions. The parameters $\\Gamma > 0$ and $\\rho u > 0$ are the constant diffusion coefficient and mass flux, respectively.\n\nWe employ a finite volume method on a uniform grid of $N$ cells. The $i$-th cell, for $i \\in \\{0, 1, \\dots, N-1\\}$, is the interval $[x_i - \\Delta x/2, x_i + \\Delta x/2]$, where the cell center is $x_i = (i + 1/2)\\Delta x$ and the cell width is $\\Delta x = 1/N$. Integrating the governing equation over the $i$-th control volume gives:\n$$\n\\int_{x_i - \\Delta x/2}^{x_i + \\Delta x/2} \\frac{d}{dx}\\Big(\\Gamma \\,\\frac{d\\phi}{dx}\\Big) dx - \\int_{x_i - \\Delta x/2}^{x_i + \\Delta x/2} \\frac{d}{dx}(\\rho u \\phi) dx = \\int_{x_i - \\Delta x/2}^{x_i + \\Delta x/2} s(x) dx\n$$\nApplying the fundamental theorem of calculus to the flux terms yields a balance equation for cell $i$:\n$$\n\\left(\\Gamma \\frac{d\\phi}{dx}\\right)_e - \\left(\\Gamma \\frac{d\\phi}{dx}\\right)_w - (\\rho u \\phi)_e + (\\rho u \\phi)_w = \\bar{s}_i \\Delta x\n$$\nHere, the subscripts $e$ and $w$ denote the east face ($x_i + \\Delta x/2$) and west face ($x_i - \\Delta x/2$) of the cell, respectively. The source term integral is approximated using the midpoint rule, $\\bar{s}_i \\Delta x \\approx s(x_i) \\Delta x$.\n\nThe face fluxes are discretized as follows. Let $\\phi_i$ be the numerical approximation of $\\phi(x_i)$.\nThe diffusive fluxes are approximated using a second-order central difference scheme:\n$$\n\\left(\\Gamma \\frac{d\\phi}{dx}\\right)_e \\approx \\Gamma \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x}\n$$\n$$\n\\left(\\Gamma \\frac{d\\phi}{dx}\\right)_w \\approx \\Gamma \\frac{\\phi_i - \\phi_{i-1}}{\\Delta x}\n$$\nThe convective fluxes $(\\rho u \\phi)_f$ depend on the chosen scheme for the face value $\\phi_f$.\n\nFor the first-order upwind scheme (since $\\rho u > 0$, flow is from west to east):\n$$\n(\\rho u \\phi)_e = \\rho u \\phi_i\n$$\n$$\n(\\rho u \\phi)_w = \\rho u \\phi_{i-1}\n$$\nSubstituting these into the balance equation and dividing by $\\Delta x$ yields the discrete equation for cell $i$:\n$$\n\\frac{\\Gamma}{\\Delta x^2} (\\phi_{i+1} - 2\\phi_i + \\phi_{i-1}) - \\frac{\\rho u}{\\Delta x}(\\phi_i - \\phi_{i-1}) = s(x_i)\n$$\nThis can be written as a linear system $A\\Phi = b$, where $\\Phi = [\\phi_0, \\dots, \\phi_{N-1}]^T$ and $b_i = s(x_i)$. The non-zero coefficients for row $i$ of matrix $A$ are:\n$$\nA_{i,i-1} = \\frac{\\Gamma}{\\Delta x^2} + \\frac{\\rho u}{\\Delta x}, \\quad A_{i,i} = -\\frac{2\\Gamma}{\\Delta x^2} - \\frac{\\rho u}{\\Delta x}, \\quad A_{i,i+1} = \\frac{\\Gamma}{\\Delta x^2}\n$$\n\nFor the Quadratic Upstream Interpolation for Convective Kinematics (QUICK) scheme, the face values are given by a quadratic interpolation. For the east face:\n$$\n\\phi_e = \\frac{3}{8}\\phi_{i+1} + \\frac{6}{8}\\phi_i - \\frac{1}{8}\\phi_{i-1}\n$$\nAnd for the west face:\n$$\n\\phi_w = \\frac{3}{8}\\phi_{i} + \\frac{6}{8}\\phi_{i-1} - \\frac{1}{8}\\phi_{i-2}\n$$\nThe net convective flux out of cell $i$ is $\\rho u (\\phi_e - \\phi_w)$. Substituting and simplifying gives:\n$$\n\\rho u (\\phi_e - \\phi_w) = \\rho u \\left( \\frac{3}{8}\\phi_{i+1} + \\frac{3}{8}\\phi_i - \\frac{7}{8}\\phi_{i-1} + \\frac{1}{8}\\phi_{i-2} \\right)\n$$\nThe complete discrete equation for the QUICK scheme is:\n$$\n\\frac{\\Gamma}{\\Delta x^2}(\\phi_{i+1} - 2\\phi_i + \\phi_{i-1}) - \\frac{\\rho u}{\\Delta x}\\left(\\frac{1}{8}\\phi_{i-2} - \\frac{7}{8}\\phi_{i-1} + \\frac{3}{8}\\phi_i + \\frac{3}{8}\\phi_{i+1}\\right) = s(x_i)\n$$\nThe non-zero coefficients for row $i$ of matrix $A$ are:\n$$\nA_{i,i-2} = -\\frac{\\rho u}{8\\Delta x}, \\quad A_{i,i-1} = \\frac{\\Gamma}{\\Delta x^2} + \\frac{7\\rho u}{8\\Delta x}, \\quad A_{i,i} = -\\frac{2\\Gamma}{\\Delta x^2} - \\frac{3\\rho u}{8\\Delta x}, \\quad A_{i,i+1} = \\frac{\\Gamma}{\\Delta x^2} - \\frac{3\\rho u}{8\\Delta x}\n$$\nIn all expressions, indices are taken modulo $N$ to enforce periodicity. The resulting matrices are circulant.\n\nThe discrete operator is conservative, meaning the sum of coefficients in each row is zero. This results in a singular matrix $A$, reflecting the fact that the continuous problem on a periodic domain has a non-trivial null space (constant functions). To obtain a unique solution, we impose an anchoring constraint. We select one cell, say $j=0$, and enforce $\\phi_0 = \\phi_{\\text{exact}}(x_0)$. This is implemented by replacing the first row of the linear system with the equation $1 \\cdot \\phi_0 = \\phi_{\\text{exact}}(x_0)$, which makes the system non-singular and solvable.\n\nFor each scheme and test case, we solve the system for $N \\in \\{20, 40, 80, 160\\}$. We then compute the $\\ell_2$ error norm:\n$$\n\\|e\\|_{2}=\\Big(\\sum_{i=0}^{N-1}\\big(\\phi_i-\\phi_{\\text{exact}}(x_i)\\big)^2\\,\\Delta x\\Big)^{1/2}\n$$\nThe order of convergence, $p$, is estimated by a linear least-squares fit to the model $\\log\\|e\\|_2 = \\log C + p \\log \\Delta x$, where $p$ is the slope. The computed rates $p_{\\text{upwind}}$ and $p_{\\text{QUICK}}$ are compared to their theoretical values of $1$ and $2$, respectively, using a tolerance of $0.25$.\nThe manufactured solution $\\phi_{\\text{exact}}(x) = \\sin(2\\pi x)$ is used to define the source term:\n$$\ns(x) = -\\Gamma (2\\pi)^2 \\sin(2\\pi x) - \\rho u (2\\pi) \\cos(2\\pi x)\n$$\nThis ensures that the exact solution to the differential equation is known, allowing for precise error quantification.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D steady convection-diffusion equation using the finite volume\n    method with upwind and QUICK schemes, and computes the convergence rates.\n    \"\"\"\n    \n    # Define problem parameters\n    N_values = [20, 40, 80, 160]\n    test_cases = [\n        (0.1, 1.0),  # Case 1\n        (1.0, 1.0),  # Case 2\n        (0.01, 1.0) # Case 3\n    ]\n    anchor_idx = 0\n    \n    results = []\n\n    def get_convergence_rate(delta_x_vals, errors):\n        \"\"\"\n        Computes the convergence rate p from log(error) vs log(delta_x)\n        using a linear least-squares fit.\n        \"\"\"\n        log_delta_x = np.log(delta_x_vals)\n        log_errors = np.log(errors)\n        \n        # Perform linear regression for: log_errors = p * log_delta_x + c\n        n = len(log_delta_x)\n        sum_x = np.sum(log_delta_x)\n        sum_y = np.sum(log_errors)\n        sum_xy = np.sum(log_delta_x * log_errors)\n        sum_x2 = np.sum(log_delta_x**2)\n        \n        # Slope p of the regression line\n        p = (n * sum_xy - sum_x * sum_y) / (n * sum_x2 - sum_x**2)\n        return p\n\n    for gamma, rho_u in test_cases:\n        rates = {}\n        for scheme in ['upwind', 'quick']:\n            errors = []\n            delta_x_vals = []\n            \n            for N in N_values:\n                delta_x = 1.0 / N\n                delta_x_vals.append(delta_x)\n                x = (np.arange(N) + 0.5) * delta_x\n                \n                # Manufactured solution and corresponding source term\n                phi_exact = np.sin(2.0 * np.pi * x)\n                s = -gamma * (2.0 * np.pi)**2 * np.sin(2.0 * np.pi * x) - \\\n                     rho_u * (2.0 * np.pi) * np.cos(2.0 * np.pi * x)\n                \n                # Assemble the linear system A*phi = b\n                A = np.zeros((N, N))\n                b = s\n                \n                if scheme == 'upwind':\n                    # A_i,i-1*phi_i-1 + A_i,i*phi_i + A_i,i+1*phi_i+1 = s_i\n                    c_im1 = gamma / delta_x**2 + rho_u / delta_x\n                    c_i   = -2.0 * gamma / delta_x**2 - rho_u / delta_x\n                    c_ip1 = gamma / delta_x**2\n                    for i in range(N):\n                        A[i, (i - 1 + N) % N] = c_im1\n                        A[i, i]              = c_i\n                        A[i, (i + 1) % N]    = c_ip1\n                \n                elif scheme == 'quick':\n                    c_im2 = -rho_u / (8.0 * delta_x)\n                    c_im1 = gamma / delta_x**2 + 7.0 * rho_u / (8.0 * delta_x)\n                    c_i   = -2.0 * gamma / delta_x**2 - 3.0 * rho_u / (8.0 * delta_x)\n                    c_ip1 = gamma / delta_x**2 - 3.0 * rho_u / (8.0 * delta_x)\n                    for i in range(N):\n                        A[i, (i - 2 + N) % N] = c_im2\n                        A[i, (i - 1 + N) % N] = c_im1\n                        A[i, i]              = c_i\n                        A[i, (i + 1) % N]    = c_ip1\n\n                # Apply anchoring constraint to fix the null space\n                A[anchor_idx, :] = 0.0\n                A[anchor_idx, anchor_idx] = 1.0\n                b[anchor_idx] = phi_exact[anchor_idx]\n\n                # Solve the linear system\n                phi_numerical = np.linalg.solve(A, b)\n                \n                # Calculate the l2 error norm\n                l2_error = np.sqrt(np.sum((phi_numerical - phi_exact)**2) * delta_x)\n                errors.append(l2_error)\n            \n            # Estimate convergence rate\n            rate = get_convergence_rate(np.array(delta_x_vals), np.array(errors))\n            rates[scheme] = rate\n\n        p_upwind = rates['upwind']\n        p_quick = rates['quick']\n        \n        # Compare measured rates to expected values\n        match_upwind = abs(p_upwind - 1.0) = 0.25\n        match_quick = abs(p_quick - 2.0) = 0.25\n        \n        results.extend([p_upwind, p_quick, match_upwind, match_quick])\n\n    # Format final output as a comma-separated list in a single line\n    output_str = ','.join(map(str, results))\n    print(f\"[{output_str}]\")\n\nsolve()\n```"
        }
    ]
}