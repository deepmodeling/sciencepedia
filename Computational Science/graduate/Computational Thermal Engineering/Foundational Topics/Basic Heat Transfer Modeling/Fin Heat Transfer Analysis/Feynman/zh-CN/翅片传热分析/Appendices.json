{
    "hands_on_practices": [
        {
            "introduction": "我们从基础开始。本练习旨在通过从第一性原理出发，为经典的绝热尖端翅片推导其效率表达式，从而巩固您对一维翅片方程的理解。掌握这种解析推导能力是评估更复杂情景和验证数值模型的基础。",
            "id": "3953420",
            "problem": "一根均匀矩形截面的直长肋片，其厚度为$t$，宽度为$w$，由热导率为$k$的固体制成，固定在$x=0$处的壁面上，并延伸至$x=L$处的流体中。肋基所在的壁面维持均匀温度$T_{b}$，环境流体的均匀温度为$T_{\\infty}$；假设$T_{b} > T_{\\infty}$。从肋片侧表面到流体的传热方式为对流，其传热系数$h$为均匀值。忽略辐射。位于$x=L$处的肋端是完全绝热的。假设肋片处于稳态、一维轴向导热，且材料属性均匀。设肋片截面的周长为$P$，截面积为$A_{c}$，并定义过余温度$\\theta(x) = T(x) - T_{\\infty}$。\n\n仅从傅里叶导热定律和牛顿冷却定律出发，并使用绝热肋端边界条件$\\left.\\frac{d\\theta}{dx}\\right|_{x=L} = 0$以及肋基条件$\\theta(0) = \\theta_{b} = T_{b} - T_{\\infty}$，推导肋片效率$\\eta_{f}$的解析表达式。肋片效率定义为肋片的实际传热量与假设整个肋片侧表面都维持在肋基过余温度$\\theta_{b}$时的理想传热量之比。将最终答案表示为仅包含无量纲参数$mL$的函数，其中$m$是由$h$、$P$、$k$和$A_{c}$构成的肋片参数。\n\n最终答案必须是关于$mL$的单个闭式解析表达式。不需要进行数值计算，也无需四舍五入。由于效率是无量纲的，最终表达式中不应包含任何单位。",
            "solution": "该问题被认为是有效的，因为它科学地基于传热原理，具有明确的微分方程和边界条件，问题适定，且陈述客观，没有歧义。我们可以开始推导。\n\n分析始于对距离肋基$x$处长度为$dx$的肋片微元应用能量守恒原理。在稳态下，在$x$位置传入微元的导热速率必须等于在$x+dx$位置传出微元的导热速率与从微元表面对流散热的速率之和。\n$$ q_x = q_{x+dx} + dq_{\\text{conv}} $$\n此处，$q_x$是位置$x$处的导热速率，$q_{x+dx}$是$x+dx$处的导热速率。$dq_{\\text{conv}}$项是从微元表面积$dA_s = P dx$对流散热的速率，其中$P$是肋片截面的周长。\n\n根据傅里叶导热定律，热流率由下式给出：\n$$ q_x = -kA_c \\frac{dT}{dx} $$\n其中$k$是热导率，$A_c$是截面积。由于过余温度定义为$\\theta(x) = T(x) - T_{\\infty}$，且$T_{\\infty}$是常数，我们有$\\frac{d\\theta}{dx} = \\frac{dT}{dx}$。因此，傅里叶定律可以写成关于$\\theta(x)$的形式：\n$$ q_x = -kA_c \\frac{d\\theta}{dx} $$\n在$x+dx$处传出的热量可以用$q_x$的一阶泰勒级数展开式表示：\n$$ q_{x+dx} = q_x + \\frac{dq_x}{dx}dx $$\n根据牛顿冷却定律，从微元表面对流散失的热量为：\n$$ dq_{\\text{conv}} = h(P dx)(T(x) - T_{\\infty}) = hP\\theta(x)dx $$\n其中$h$是对流传热系数。\n\n将这些表达式代入能量平衡方程，得到：\n$$ q_x = \\left(q_x + \\frac{dq_x}{dx}dx\\right) + hP\\theta(x)dx $$\n这可以简化为：\n$$ -\\frac{dq_x}{dx} - hP\\theta(x) = 0 $$\n现在，我们代入傅里叶定律中$q_x$的表达式：\n$$ -\\frac{d}{dx}\\left(-kA_c \\frac{d\\theta}{dx}\\right) - hP\\theta(x) = 0 $$\n由于$k$和$A_c$是均匀的，它们可以从导数中提出，从而得到肋片中一维传热的控制常微分方程(ODE)：\n$$ kA_c \\frac{d^2\\theta}{dx^2} - hP\\theta(x) = 0 $$\n该方程通常写为：\n$$ \\frac{d^2\\theta}{dx^2} - m^2\\theta = 0 $$\n其中$m$是肋片参数，定义为$m^2 = \\frac{hP}{kA_c}$，所以$m = \\sqrt{\\frac{hP}{kA_c}}$。\n\n这是一个二阶线性齐次常微分方程。其通解可以用双曲函数表示，这对于给定的边界条件很方便：\n$$ \\theta(x) = C_1 \\cosh(mx) + C_2 \\sinh(mx) $$\n积分常数$C_1$和$C_2$通过应用边界条件来确定。\n\n第一个边界条件(BC1)位于肋端$x=L$处，该处是完全绝热的。这意味着没有热流，因此温度梯度为零：\n$$ \\left.\\frac{d\\theta}{dx}\\right|_{x=L} = 0 $$\n首先，我们求通解的导数：\n$$ \\frac{d\\theta}{dx} = mC_1 \\sinh(mx) + mC_2 \\cosh(mx) $$\n在$x=L$处应用BC1：\n$$ mC_1 \\sinh(mL) + mC_2 \\cosh(mL) = 0 $$\n$$ C_2 = -C_1 \\frac{\\sinh(mL)}{\\cosh(mL)} = -C_1 \\tanh(mL) $$\n\n第二个边界条件(BC2)位于肋基$x=0$处，该处的温度被指定为$T_b$。用过余温度表示为：\n$$ \\theta(0) = T_b - T_{\\infty} = \\theta_b $$\n将BC2应用于通解：\n$$ \\theta(0) = C_1 \\cosh(0) + C_2 \\sinh(0) = C_1(1) + C_2(0) = C_1 $$\n因此，$C_1 = \\theta_b$。\n\n将$C_1 = \\theta_b$代入$C_2$的表达式，得到$C_2 = -\\theta_b \\tanh(mL)$。温度分布的特解为：\n$$ \\theta(x) = \\theta_b \\cosh(mx) - \\theta_b \\tanh(mL) \\sinh(mx) $$\n$$ \\theta(x) = \\theta_b \\left( \\cosh(mx) - \\frac{\\sinh(mL)}{\\cosh(mL)}\\sinh(mx) \\right) = \\frac{\\theta_b}{\\cosh(mL)} \\left( \\cosh(mL)\\cosh(mx) - \\sinh(mL)\\sinh(mx) \\right) $$\n使用双曲恒等式$\\cosh(A-B) = \\cosh(A)\\cosh(B) - \\sinh(A)\\sinh(B)$，温度分布简化为：\n$$ \\theta(x) = \\frac{\\theta_b \\cosh(m(L-x))}{\\cosh(mL)} $$\n\n接下来，我们计算肋片的实际传热量$q_f$。这是在肋基$x=0$处导入肋片的热量：\n$$ q_f = q_{x=0} = -kA_c \\left.\\frac{d\\theta}{dx}\\right|_{x=0} $$\n温度分布的导数为：\n$$ \\frac{d\\theta}{dx} = \\frac{d}{dx}\\left( \\frac{\\theta_b \\cosh(m(L-x))}{\\cosh(mL)} \\right) = \\frac{\\theta_b}{\\cosh(mL)} [ \\sinh(m(L-x)) \\cdot (-m) ] = -\\frac{m\\theta_b \\sinh(m(L-x))}{\\cosh(mL)} $$\n在$x=0$处计算该导数：\n$$ \\left.\\frac{d\\theta}{dx}\\right|_{x=0} = -\\frac{m\\theta_b \\sinh(mL)}{\\cosh(mL)} = -m\\theta_b \\tanh(mL) $$\n将此结果代回$q_f$的表达式：\n$$ q_f = -kA_c(-m\\theta_b \\tanh(mL)) = kA_c m \\theta_b \\tanh(mL) $$\n\n肋片效率$\\eta_f$定义为实际传热量$q_f$与最大可能传热量$q_{\\text{max}}$之比。如果整个肋片表面都维持在肋基温度$T_b$，则会发生最大传热。在这种理想情况下，热量将通过对流从肋片的总侧表面积$A_s = PL$传出，其均匀温差为$\\theta_b$：\n$$ q_{\\text{max}} = h A_s \\theta_b = h(PL)\\theta_b $$\n\n现在，我们可以计算效率：\n$$ \\eta_f = \\frac{q_f}{q_{\\text{max}}} = \\frac{kA_c m \\theta_b \\tanh(mL)}{hPL\\theta_b} $$\n$\\theta_b$项相互抵消。我们得到：\n$$ \\eta_f = \\frac{kA_c m \\tanh(mL)}{hPL} $$\n为了将其完全表示为$mL$的函数，我们使用$m^2 = \\frac{hP}{kA_c}$的定义，可以重新排列为$hP = kA_c m^2$。将此式代入分母中的$hP$：\n$$ \\eta_f = \\frac{kA_c m \\tanh(mL)}{(kA_c m^2)L} $$\n消去公因项$kA_c$和因子$m$中的一个：\n$$ \\eta_f = \\frac{\\tanh(mL)}{mL} $$\n此表达式给出了具有绝热肋端的均匀截面直肋片的效率，它是无量纲参数$mL$的函数，符合要求。",
            "answer": "$$ \\boxed{\\frac{\\tanh(mL)}{mL}} $$"
        },
        {
            "introduction": "从解析解过渡到计算方法。本练习要求您开发一个有限差分程序，用以求解具有更贴近实际的对流尖端的稳态翅片方程。通过将数值结果与精确的解析解进行对比，您将执行一次网格收敛性研究以量化数值格式的精度，这是计算工程中的一项关键技能。",
            "id": "3953483",
            "problem": "考虑一个直的、细长的、一维的翅片，其横截面积 $A$ 和周长 $P$ 均匀，由导热系数为 $k$ 的固体材料制成，从温度为 $T_b$ 的基座延伸长度 $L$ 进入环境温度为 $T_\\infty$ 的流体中。翅片的侧面暴露在流体中，具有均匀的对流换热系数 $h$。翅片在 $x=L$ 处的尖端在尖端面积 $A_t$ 上进行对流换热，系数为 $h_t$。定义过余温度为 $\\theta(x) = T(x) - T_\\infty$ 和基座过余温度为 $\\theta_b = T_b - T_\\infty$。在稳态条件下，轴向产热可忽略不计且物性恒定，该翅片由一个线性的二阶常微分方程控制，并在尖端处具有对流（Robin）边界条件。翅片效率 $\\eta_f$ 定义为翅片的总传热速率与假设整个翅片都处于基座过余温度时的假想传热速率之比，即 $\\eta_f = q_f/\\left(h P L \\theta_b\\right)$，其中 $q_f$ 是在基座处传导的实际传热速率。\n\n您的任务是实现一个有限差分格式，该格式：\n- 在间距为 $\\Delta x$ 的均匀网格上离散化控制常微分方程，内部使用二阶中心差分近似，并在 $x=L$ 处的对流尖端边界条件使用一阶单边差分。\n- 在基座 $x=0$ 处强制施加狄利克雷（Dirichlet）边界条件，$\\theta(0)=\\theta_b$。\n- 计算离散温度场，然后使用在 $x=0$ 处的导数的二阶单边有限差分近似计算基座热流率 $q_f$。\n- 根据离散解计算翅片效率 $\\eta_f$。\n\n为了量化精度，您还必须根据具有相同边界条件的控制线性常微分方程的精确闭式解计算 $\\eta_f$ 的参考值，然后评估 $\\eta_f$ 中作为网格间距 $\\Delta x$ 函数的绝对相对误差。\n\n使用以下常数和单位：\n- 导热系数 $k$ 单位为 $\\mathrm{W/(m\\cdot K)}$。\n- 对流换热系数 $h$ 和 $h_t$ 单位为 $\\mathrm{W/(m^2\\cdot K)}$。\n- 几何量 $L$ 单位为 $\\mathrm{m}$，$A$ 和 $A_t$ 单位为 $\\mathrm{m^2}$，$P$ 单位为 $\\mathrm{m}$。\n- 温度单位为 $\\mathrm{K}$；使用基座过余温度 $\\theta_b = 1$ 以使翅片效率保持无量纲。以无量纲十进制数报告误差。\n\n对于所有测试案例，使用具有 $N$ 个控制体的均匀网格，使得 $\\Delta x = L/N$。对于每个案例，在对应于 $N \\in \\{5, 10, 20, 40, 80\\}$ 的网格间距集合 $\\left\\{\\Delta x_k\\right\\}$ 上评估误差，即 $\\Delta x_k = L/5$, $\\Delta x_k = L/10$, $\\Delta x_k = L/20$, $\\Delta x_k = L/40$, $\\Delta x_k = L/80$。\n\n实现您的程序，为每个测试案例计算在指定的 $\\Delta x_k$ 下的绝对相对误差列表 $e_k = \\left|\\eta_f^{\\mathrm{FD}}(\\Delta x_k) - \\eta_f^{\\mathrm{exact}}\\right|/\\left|\\eta_f^{\\mathrm{exact}}\\right|$，其中 $\\eta_f^{\\mathrm{FD}}$ 是有限差分估计值，而 $\\eta_f^{\\mathrm{exact}}$ 是从精确连续解获得的值。\n\n使用以下四个科学上合理且自洽的测试案例：\n\n- 案例 1（中等对流，类铝导热系数）：$L = 0.05\\,\\mathrm{m}$, $k = 205\\,\\mathrm{W/(m\\cdot K)}$, $h = 25\\,\\mathrm{W/(m^2\\cdot K)}$, $A = 1.0\\times 10^{-4}\\,\\mathrm{m^2}$, $P = 0.04\\,\\mathrm{m}$, $h_t = 25\\,\\mathrm{W/(m^2\\cdot K)}$, $A_t = A$。\n- 案例 2（绝热尖端理想化）：$L = 0.05\\,\\mathrm{m}$, $k = 205\\,\\mathrm{W/(m\\cdot K)}$, $h = 25\\,\\mathrm{W/(m^2\\cdot K)}$, $A = 1.0\\times 10^{-4}\\,\\mathrm{m^2}$, $P = 0.04\\,\\mathrm{m}$, $h_t = 0\\,\\mathrm{W/(m^2\\cdot K)}$, $A_t = A$。\n- 案例 3（强对流，低导热系数）：$L = 0.10\\,\\mathrm{m}$, $k = 15\\,\\mathrm{W/(m\\cdot K)}$, $h = 200\\,\\mathrm{W/(m^2\\cdot K)}$, $A = 2.0\\times 10^{-4}\\,\\mathrm{m^2}$, $P = 0.06\\,\\mathrm{m}$, $h_t = 200\\,\\mathrm{W/(m^2\\cdot K)}$, $A_t = A$。\n- 案例 4（短的、高导热性翅片）：$L = 0.01\\,\\mathrm{m}$, $k = 400\\,\\mathrm{W/(m\\cdot K)}$, $h = 10\\,\\mathrm{W/(m^2\\cdot K)}$, $A = 5.0\\times 10^{-5}\\,\\mathrm{m^2}$, $P = 0.03\\,\\mathrm{m}$, $h_t = 10\\,\\mathrm{W/(m^2\\cdot K)}$, $A_t = A$。\n\n您的程序应生成单行输出，其中包含一个类似 Python 的浮点数列表的列表形式的结果，没有其他文本，例如：“[[e_{1,1},e_{1,2},e_{1,3},e_{1,4},e_{1,5}],[e_{2,1},...,e_{2,5}],...]”，其中每个 $e_{i,j}$ 是一个十进制数。",
            "solution": "### 问题验证\n\n**步骤 1：提取已知条件**\n\n- **控制物理**：在横截面积 $A$ 和周长 $P$ 均匀的直翅片中的稳态一维传热。\n- **材料属性**：导热系数 $k$。\n- **对流**：侧表面上均匀的对流换热系数 $h$，以及尖端面积 $A_t$ 上的系数 $h_t$。\n- **温度**：基座温度 $T_b$，环境流体温度 $T_\\infty$。\n- **定义**：\n    - 过余温度：$\\theta(x) = T(x) - T_\\infty$。\n    - 基座过余温度：$\\theta_b = T_b - T_\\infty$。对于所有计算，$\\theta_b = 1$。\n    - 翅片效率：$\\eta_f = q_f/\\left(h P L \\theta_b\\right)$，其中 $q_f$ 是在基座（$x=0$）处传导的传热速率。\n- **控制方程**：问题暗示了标准翅片方程：$k A \\frac{d^2T}{dx^2} - h P (T-T_\\infty) = 0$。\n- **边界条件（BCs）**：\n    - 基座（$x=0$）：狄利克雷（Dirichlet）边界条件，$\\theta(0) = \\theta_b$。\n    - 尖端（$x=L$）：对流（Robin）边界条件，$-k A \\frac{dT}{dx}|_{x=L} = h_t A_t (T(L) - T_\\infty)$。\n- **有限差分法（FDM）规范**：\n    - 网格：具有 $N$ 个控制体的均匀网格，间距 $\\Delta x = L/N$。\n    - 内部节点：常微分方程使用二阶中心差分。\n    - 尖端边界条件（$x=L$）：一阶单边差分。\n    - 基座热流率（$q_f$）：在 $x=0$ 处的导数使用二阶单边有限差分。\n- **误差分析**：\n    - 计算绝对相对误差 $e_k = \\left|\\eta_f^{\\mathrm{FD}}(\\Delta x_k) - \\eta_f^{\\mathrm{exact}}\\right|/\\left|\\eta_f^{\\mathrm{exact}}\\right|$。\n    - 评估点：$N \\in \\{5, 10, 20, 40, 80\\}$。\n- **测试案例**：\n    - 案例 1：$L = 0.05\\,\\mathrm{m}$, $k = 205\\,\\mathrm{W/(m\\cdot K)}$, $h = 25\\,\\mathrm{W/(m^2\\cdot K)}$, $A = 1.0\\times 10^{-4}\\,\\mathrm{m^2}$, $P = 0.04\\,\\mathrm{m}$, $h_t = 25\\,\\mathrm{W/(m^2\\cdot K)}$, $A_t = A$。\n    - 案例 2：$L = 0.05\\,\\mathrm{m}$, $k = 205\\,\\mathrm{W/(m\\cdot K)}$, $h = 25\\,\\mathrm{W/(m^2\\cdot K)}$, $A = 1.0\\times 10^{-4}\\,\\mathrm{m^2}$, $P = 0.04\\,\\mathrm{m}$, $h_t = 0\\,\\mathrm{W/(m^2\\cdot K)}$, $A_t = A$。\n    - 案例 3：$L = 0.10\\,\\mathrm{m}$, $k = 15\\,\\mathrm{W/(m\\cdot K)}$, $h = 200\\,\\mathrm{W/(m^2\\cdot K)}$, $A = 2.0\\times 10^{-4}\\,\\mathrm{m^2}$, $P = 0.06\\,\\mathrm{m}$, $h_t = 200\\,\\mathrm{W/(m^2\\cdot K)}$, $A_t = A$。\n    - 案例 4：$L = 0.01\\,\\mathrm{m}$, $k = 400\\,\\mathrm{W/(m\\cdot K)}$, $h = 10\\,\\mathrm{W/(m^2\\cdot K)}$, $A = 5.0\\times 10^{-5}\\,\\mathrm{m^2}$, $P = 0.03\\,\\mathrm{m}$, $h_t = 10\\,\\mathrm{W/(m^2\\cdot K)}$, $A_t = A$。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n该问题是计算传热学中的一个标准练习，特别是翅片问题的数值解和分析。\n- **科学基础**：该问题基于稳态热传导和对流的基本原理，由一个成熟的二阶常微分方程（翅片方程）描述。为测试案例提供的物理参数对于常见的工程材料（如铝、铜）和对流情景是现实的。这些定义是传热领域的标准。\n- **适定性**：该问题描述了一个带有两个边界条件（一个在基座的狄利克雷条件，一个在尖端的 Robin 条件）的线性二阶常微分方程。这构成了一个适定的边值问题，存在唯一、稳定且有意义的解析解。数值任务也是适定的；指定的有限差分格式会产生一个非奇异且可解的线性方程组。\n- **客观性**：该问题以精确、客观和定量的术语陈述。所有参数、方法和评估标准都已明确定义，没有主观解释的余地。\n- **完整性和一致性**：为解析解和数值实现提供了所有必要的数据。单位是一致的。数值格式的结构已完全指定。问题是自洽的，没有矛盾。观察到翅片效率 $\\eta_f$ 可能超过 1 是所提供定义 $\\eta_f = q_f/\\left(h P L \\theta_b\\right)$ 的一个有效结果，该定义仅基于翅片侧面积定义理想传热，而实际传热 $q_f$ 包括来自侧面积和尖端面积的贡献。\n\n**步骤 3：结论和行动**\n\n该问题是**有效的**。它在科学上是合理的、适定的、完整的和客观的。这项任务是计算热工学中一个严谨和标准的验证和确认练习。我们继续进行求解。\n\n### 基于原理的解决方案设计\n\n该解决方案按规定既包括用于参考值的解析推导，也包括基于有限差分法的数值实现。\n\n**1. 解析解**\n\n在均匀物性的翅片中，过余温度 $\\theta(x) = T(x) - T_\\infty$ 的控制方程为：\n$$ \\frac{d^2\\theta}{dx^2} - m^2 \\theta = 0 $$\n其中翅片参数 $m$ 定义为 $m = \\sqrt{\\frac{hP}{kA}}$。用 $\\theta$ 表示的边界条件是：\n1. 基座（$x=0$）：$\\theta(0) = \\theta_b$\n2. 尖端（$x=L$）：传导到尖端的热量等于从尖端对流出去的热量。当 $A_t=A$ 时，即为 $-k A \\frac{d\\theta}{dx}|_{L} = h_t A \\theta(L)$，简化为 $\\frac{d\\theta}{dx}|_{L} + \\frac{h_t}{k} \\theta(L) = 0$。\n\n该常微分方程的通解为 $\\theta(x) = C_1 \\cosh(m(L-x)) + C_2 \\sinh(m(L-x))$。应用边界条件可以解出常数，从而得到温度分布的标准解。\n\n基座处的传热速率由傅里叶定律给出：$q_f = -kA \\frac{d\\theta}{dx}|_{x=0}$。对通解求导并应用边界条件，可得到带有对流尖端的翅片热流率的著名表达式：\n$$ q_f = \\sqrt{hPkA} \\theta_b \\frac{\\sinh(mL) + (h_t/mk) \\cosh(mL)}{\\cosh(mL) + (h_t/mk) \\sinh(mL)} $$\n翅片效率 $\\eta_f$ 定义为该实际传热速率与如果整个侧表面都处于基座温度时的理想速率 $q_{ideal} = hPL\\theta_b$ 之比。\n$$ \\eta_f^{\\mathrm{exact}} = \\frac{q_f}{hPL\\theta_b} = \\frac{\\sqrt{hPkA}}{hPL} \\frac{\\sinh(mL) + (h_t/mk) \\cosh(mL)}{\\cosh(mL) + (h_t/mk) \\sinh(mL)} $$\n由于 $m = \\sqrt{hP/kA}$，前置因子简化为：$\\frac{\\sqrt{hPkA}}{hPL} = \\frac{m k A}{hPL} = \\frac{m k A}{(m^2 k A) L} = \\frac{1}{mL}$。因此，精确效率为：\n$$ \\eta_f^{\\mathrm{exact}} = \\frac{1}{mL} \\frac{\\sinh(mL) + (h_t/mk) \\cosh(mL)}{\\cosh(mL) + (h_t/mk) \\sinh(mL)} $$\n对于绝热尖端（$h_t=0$）的特殊情况，这简化为经典结果 $\\eta_f^{\\mathrm{exact}} = \\frac{\\tanh(mL)}{mL}$。\n\n**2. 有限差分公式**\n\n长度为 $L$ 的翅片域被离散为 $N$ 个长度为 $\\Delta x = L/N$ 的均匀段，创建 $N+1$ 个索引为 $i = 0, 1, \\dots, N$ 的节点。设 $\\theta_i$ 是 $\\theta(x_i)$ 的数值近似。\n\n- **内部节点（$i=1, \\dots, N-1$）**：常微分方程 $\\frac{d^2\\theta}{dx^2} - m^2 \\theta = 0$ 使用二阶中心差分对二阶导数进行离散化：\n$$ \\frac{\\theta_{i-1} - 2\\theta_i + \\theta_{i+1}}{(\\Delta x)^2} - m^2 \\theta_i = 0 $$\n整理后得到每个内部节点的线性代数方程：\n$$ \\theta_{i-1} - (2 + m^2(\\Delta x)^2) \\theta_i + \\theta_{i+1} = 0 $$\n\n- **边界节点**：\n    - **基座（$i=0$）**：直接应用狄利克雷条件：$\\theta_0 = \\theta_b$。由于指定 $\\theta_b=1$，所以 $\\theta_0=1$。该值被代入节点 $i=1$ 的方程中。\n    - **尖端（$i=N$）**：Robin 边界条件 $\\frac{d\\theta}{dx}|_{L} + \\frac{h_t}{k} \\theta(L) = 0$ 按照规定使用一阶向后差分对导数进行离散化：\n    $$ \\frac{\\theta_N - \\theta_{N-1}}{\\Delta x} + \\frac{h_t}{k} \\theta_N = 0 $$\n    整理后得到方程组的最后一个方程：\n    $$ -\\theta_{N-1} + \\left(1 + \\frac{h_t \\Delta x}{k}\\right) \\theta_N = 0 $$\n\n该公式产生了一个关于 $N$ 个未知温度 $\\theta_1, \\dots, \\theta_N$ 的 $N$ 个线性方程组。以矩阵形式表示，$\\mathbf{M}\\vec{\\theta} = \\vec{b}$，其中 $\\vec{\\theta} = [\\theta_1, \\dots, \\theta_N]^T$，$\\mathbf{M}$ 是一个 $N \\times N$ 的三对角矩阵，而 $\\vec{b}$ 是一个表示边界条件贡献的向量。具体来说：\n$$\n\\mathbf{M} = \n\\begin{pmatrix}\n-(2+c)  1  0  \\cdots  0 \\\\\n1  -(2+c)  1  \\cdots  0 \\\\\n\\vdots  \\ddots  \\ddots  \\ddots  \\vdots \\\\\n0  \\cdots  1  -(2+c)  1 \\\\\n0  \\cdots  0  -1  1+d\n\\end{pmatrix}, \\quad\n\\vec{b} = \n\\begin{pmatrix}\n-\\theta_b \\\\ 0 \\\\ \\vdots \\\\ 0 \\\\ 0\n\\end{pmatrix}\n$$\n其中 $c = m^2(\\Delta x)^2$ 且 $d = \\frac{h_t \\Delta x}{k}$。这个系统可以被高效求解，以找到离散温度场 $\\theta_i$。\n\n**3. 数值翅片效率和误差计算**\n\n基座热流率 $q_f$ 是使用指定的二阶向前差分公式计算 $x=0$ 处的导数：\n$$ \\left.\\frac{d\\theta}{dx}\\right|_{x=0} \\approx \\frac{-3\\theta_0 + 4\\theta_1 - \\theta_2}{2\\Delta x} $$\n那么数值热流率为：\n$$ q_f^{\\mathrm{FD}} = -kA \\left( \\frac{-3\\theta_0 + 4\\theta_1 - \\theta_2}{2\\Delta x} \\right) $$\n数值翅片效率使用给定定义计算：\n$$ \\eta_f^{\\mathrm{FD}} = \\frac{q_f^{\\mathrm{FD}}}{hPL\\theta_b} $$\n当 $\\theta_0=\\theta_b=1$ 时，这变为：\n$$ \\eta_f^{\\mathrm{FD}} = \\frac{-kA(-3 + 4\\theta_1 - \\theta_2)}{2hPL\\Delta x} $$\n\n最后，对于每个网格分辨率 $N$，通过将数值结果与精确解进行比较来计算绝对相对误差 $e$：\n$$ e = \\frac{\\left|\\eta_f^{\\mathrm{FD}} - \\eta_f^{\\mathrm{exact}}\\right|}{\\left|\\eta_f^{\\mathrm{exact}}\\right|} $$\n\n总体算法包括遍历每组物理参数（测试案例），并对每个案例遍历指定的网格分辨率 $N$，在每一步计算并存储误差 $e$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the fin heat transfer problem for four test cases, calculating the\n    absolute relative error in fin efficiency for a series of grid refinements.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (moderate convection, aluminum-like conductivity)\n        # L, k, h, A, P, h_t, A_t\n        (0.05, 205.0, 25.0, 1.0e-4, 0.04, 25.0, 1.0e-4),\n        # Case 2 (adiabatic tip idealization)\n        (0.05, 205.0, 25.0, 1.0e-4, 0.04, 0.0, 1.0e-4),\n        # Case 3 (strong convection, low conductivity)\n        (0.10, 15.0, 200.0, 2.0e-4, 0.06, 200.0, 2.0e-4),\n        # Case 4 (short, highly conductive fin)\n        (0.01, 400.0, 10.0, 5.0e-5, 0.03, 10.0, 5.0e-5),\n    ]\n\n    N_values = [5, 10, 20, 40, 80]\n    all_results = []\n\n    for case_params in test_cases:\n        L, k, h, A, P, h_t, A_t = case_params\n        case_errors = calculate_errors_for_case(L, k, h, A, P, h_t, A_t, N_values)\n        all_results.append(case_errors)\n\n    # Format the output as a string representing a list of lists.\n    list_of_strings = []\n    for inner_list in all_results:\n        inner_list_str = [f\"{num:.10e}\" for num in inner_list]\n        list_of_strings.append(f\"[{','.join(inner_list_str)}]\")\n    final_output = f\"[{','.join(list_of_strings)}]\"\n    print(final_output)\n\n\ndef calculate_errors_for_case(L, k, h, A, P, h_t, A_t, N_values):\n    \"\"\"\n    For a single test case, computes the fin efficiency error for each grid size.\n    \"\"\"\n    theta_b = 1.0\n    errors = []\n\n    # 1. Calculate the exact fin efficiency for the given parameters.\n    # This value is constant for the case.\n    if k * A == 0:\n        return [np.nan] * len(N_values)\n    m = np.sqrt((h * P) / (k * A))\n    mL = m * L\n\n    if mL == 0:\n        eta_f_exact = 1.0\n    else:\n        if h_t == 0: # Adiabatic tip special case\n            eta_f_exact = np.tanh(mL) / mL\n        else: # General convective tip case (A_t = A is assumed)\n            term = h_t / (m * k)\n            numerator = np.sinh(mL) + term * np.cosh(mL)\n            denominator = np.cosh(mL) + term * np.sinh(mL)\n            eta_f_exact = (1.0 / mL) * (numerator / denominator)\n\n    for N in N_values:\n        delta_x = L / N\n\n        # 2. Set up and solve the finite difference linear system M*theta = b\n        M = np.zeros((N, N))\n        b = np.zeros(N)\n\n        # Tridiagonal matrix coefficients for interior nodes\n        m_sq_dx_sq = m**2 * delta_x**2\n        diag_val = -(2.0 + m_sq_dx_sq)\n        \n        for i in range(N - 1):\n            if i > 0:\n                M[i, i - 1] = 1.0  # Lower diagonal\n            M[i, i] = diag_val       # Main diagonal\n            M[i, i + 1] = 1.0  # Upper diagonal\n        \n        # First equation's RHS is modified by the base BC\n        b[0] = -theta_b\n        \n        # Last row of the matrix from the tip BC\n        # -theta_{N-1} + (1 + h_t*delta_x/k) * theta_N = 0\n        M[N - 1, N - 2] = -1.0\n        M[N - 1, N - 1] = 1.0 + (h_t * delta_x / k)\n        \n        theta_vec = np.linalg.solve(M, b)\n        \n        # 3. Calculate numerical fin efficiency from the discrete solution\n        theta_0 = theta_b\n        theta_1 = theta_vec[0]\n        theta_2 = theta_vec[1]\n        \n        # Base heat flux using 2nd-order forward difference for derivative\n        dtheta_dx_0 = (-3.0 * theta_0 + 4.0 * theta_1 - theta_2) / (2.0 * delta_x)\n        q_f_fd = -k * A * dtheta_dx_0\n        \n        # Ideal heat rate for the lateral surface\n        q_ideal = h * P * L * theta_b\n        \n        eta_f_fd = q_f_fd / q_ideal\n        \n        # 4. Compute and store the absolute relative error\n        if eta_f_exact == 0:\n            rel_error = np.abs(eta_f_fd)\n        else:\n            rel_error = np.abs(eta_f_fd - eta_f_exact) / np.abs(eta_f_exact)\n        \n        errors.append(rel_error)\n        \n    return errors\n\nif __name__ == '__main__':\n    solve()\n\n```"
        },
        {
            "introduction": "现在我们转向更高级的时间相关问题。本练习要求您为瞬态翅片方程构建并实现无条件稳定的Crank-Nicolson格式。掌握这种隐式方法对于精确模拟翅片温度分布如何随时间演化至关重要，这是在尚未达到稳态的真实工程应用中常见的情景。",
            "id": "3953813",
            "problem": "考虑一根长度为 $L$ 的细长一维直翅片，其横截面积 $A$ 和周长 $P$ 恒定，由均质材料制成，其热导率为 $k$，质量密度为 $\\rho$，比热容为 $c$。翅片的侧表面暴露在温度为 $T_{\\infty}$ 的均匀环境中，对流系数为 $h$。令 $\\theta(x,t) = T(x,t) - T_{\\infty}$ 表示过余温度。假设物性在空间上均匀，且忽略轴向辐射。单位长度上的能量守恒结合傅里叶定律，可得出瞬态翅片方程\n$$\n\\rho c A \\frac{\\partial \\theta}{\\partial t} = k A \\frac{\\partial^2 \\theta}{\\partial x^2} - h P \\theta,\n$$\n对于 $x \\in (0,L)$ 和 $t > 0$。定义热扩散率 $\\alpha = \\frac{k}{\\rho c}$ 和侧面对流汇系数 $s = \\frac{h P}{\\rho c A}$，可写为\n$$\n\\frac{\\partial \\theta}{\\partial t} = \\alpha \\frac{\\partial^2 \\theta}{\\partial x^2} - s \\theta.\n$$\n位于 $x=0$ 的翅片基部在所有 $t \\ge 0$ 时均保持已知的过余温度 $\\theta(0,t) = \\theta_b$。位于 $x=L$ 的翅片尖端通过其端部面积 $A_e$ 与温度为 $T_{\\infty}$ 的环境进行对流换热，对流系数为 $h_e$。由此产生的过余温度的罗宾边界条件 (Robin boundary condition (RBC)) 为\n$$\n-k A \\frac{\\partial \\theta}{\\partial x}(L,t) = h_e A_e \\theta(L,t),\n$$\n可以写成\n$$\n-\\frac{\\partial \\theta}{\\partial x}(L,t) = \\beta \\theta(L,t), \\quad \\text{其中} \\quad \\beta = \\frac{h_e A_e}{k A}.\n$$\n您的任务是为一个均匀网格上该瞬态翅片方程的一个时间步长，构建一个 Crank-Nicolson (CN) 有限差分格式，并推导出包括罗宾尖端边界在内的相关线性代数系统。从基本原理出发，通过在均匀网格 $x_i = i \\Delta x$（其中 $i = 0,1,\\dots,N$ 且 $\\Delta x = \\frac{L}{N}$）上使用中心差分来离散空间二阶导数，并使用时间步长为 $\\Delta t$ 的 CN 方法来离散时间。将 $x_0 = 0$ 处的基部边界视为狄利克雷条件，其值为已知的 $\\theta_b$，并通过与导数边界条件一致的单侧二阶精确消除虚拟节点的方法来施加 $x_N = L$ 处的罗宾边界。\n\n任务：\n- 从应用于 $\\frac{\\partial \\theta}{\\partial t} = \\alpha \\frac{\\partial^2 \\theta}{\\partial x^2} - s \\theta$ 的有限差分近似和 CN 时间离散化出发，推导出新时间层 $t^{n+1} = t^n + \\Delta t$ 处未知向量 $\\boldsymbol{\\theta}^{n+1} = [\\theta_1^{n+1}, \\theta_2^{n+1}, \\dots, \\theta_{N}^{n+1}]^{\\top}$ 的三对角矩阵系统，其中基部节点 $\\theta_0$ 为已知，不包含在未知向量中。明确说明内部节点 $i=1,\\dots,N-1$ 的矩阵行系数，因狄利克雷边界对第一个内部节点 $i=1$ 的修正，以及因参数为 $\\beta$ 的罗宾边界对尖端节点 $i=N$ 的修正。\n- 根据已知的先前状态 $\\boldsymbol{\\theta}^{n} = [\\theta_1^{n}, \\theta_2^{n}, \\dots, \\theta_{N}^{n}]^{\\top}$、狄利克雷边界值 $\\theta_b$ 以及参数 $\\alpha$、$s$、$\\beta$、$\\Delta x$ 和 $\\Delta t$ 提供最终的右端向量。\n\n您的程序必须实现所推导的 CN 格式，来为以下每个测试用例执行从 $\\boldsymbol{\\theta}^{n}$ 到 $\\boldsymbol{\\theta}^{n+1}$ 的单个时间步。在所有情况下，假设初始过余温度在空间上是均匀的，为下面给出的 $\\theta(x,0) = \\theta_{\\text{init}}$，并使用一个包含 $N+1$ 个点和 $N$ 个内部区间的均匀空间网格。报告包括基部在内的所有网格点 $x_i$ 处的过余温度（单位：开尔文），即为每个用例输出列表 $[\\theta_0^{n+1}, \\theta_1^{n+1}, \\dots, \\theta_N^{n+1}]$。所有温度以 $\\mathrm{K}$ 表示，时间以 $\\mathrm{s}$ 表示，长度以 $\\mathrm{m}$ 表示。此问题不涉及角度。\n\n使用以下参数值测试套件：\n- 用例 1（一般情况，中等侧面对流，中等尖端对流）：\n  - $L = 0.05\\,\\mathrm{m}$，$N = 10$，$\\Delta t = 0.2\\,\\mathrm{s}$，\n  - $k = 205\\,\\mathrm{W/(m\\,K)}$，$\\rho = 2700\\,\\mathrm{kg/m^3}$，$c = 900\\,\\mathrm{J/(kg\\,K)}$，$A = 1.0\\times 10^{-4}\\,\\mathrm{m^2}$，$P = 0.02\\,\\mathrm{m}$，\n  - $h = 55\\,\\mathrm{W/(m^2\\,K)}$，$h_e = 55\\,\\mathrm{W/(m^2\\,K)}$，$A_e = A$，\n  - $\\theta_b = 50\\,\\mathrm{K}$，$\\theta_{\\text{init}} = 0\\,\\mathrm{K}$。\n- 用例 2（绝热尖端，即零尖端对流）：\n  - $L = 0.05\\,\\mathrm{m}$，$N = 10$，$\\Delta t = 0.2\\,\\mathrm{s}$，\n  - $k = 205\\,\\mathrm{W/(m\\,K)}$，$\\rho = 2700\\,\\mathrm{kg/m^3}$，$c = 900\\,\\mathrm{J/(kg\\,K)}$，$A = 1.0\\times 10^{-4}\\,\\mathrm{m^2}$，$P = 0.02\\,\\mathrm{m}$，\n  - $h = 55\\,\\mathrm{W/(m^2\\,K)}$，$h_e = 0\\,\\mathrm{W/(m^2\\,K)}$，$A_e = A$，\n  - $\\theta_b = 50\\,\\mathrm{K}$，$\\theta_{\\text{init}} = 0\\,\\mathrm{K}$。\n- 用例 3（较短的翅片，强侧面和尖端对流，不同材料）：\n  - $L = 0.03\\,\\mathrm{m}$，$N = 6$，$\\Delta t = 0.01\\,\\mathrm{s}$，\n  - $k = 150\\,\\mathrm{W/(m\\,K)}$，$\\rho = 8000\\,\\mathrm{kg/m^3}$，$c = 500\\,\\mathrm{J/(kg\\,K)}$，$A = 2.0\\times 10^{-4}\\,\\mathrm{m^2}$，$P = 0.03\\,\\mathrm{m}$，\n  - $h = 250\\,\\mathrm{W/(m^2\\,K)}$，$h_e = 4000\\,\\mathrm{W/(m^2\\,K)}$，$A_e = A$，\n  - $\\theta_b = 20\\,\\mathrm{K}$，$\\theta_{\\text{init}} = 0\\,\\mathrm{K}$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，其中每个列表条目对应一个用例，其本身是时间 $t^{n+1}$ 时网格点温度的逗号分隔列表。例如，输出格式必须为\n$$\n[\\,[\\theta_0^{n+1},\\theta_1^{n+1},\\dots,\\theta_N^{n+1}],\\,[\\theta_0^{n+1},\\theta_1^{n+1},\\dots,\\theta_N^{n+1}],\\,[\\theta_0^{n+1},\\theta_1^{n+1},\\dots,\\theta_N^{n+1}]\\,].\n$$",
            "solution": "用户希望使用 Crank-Nicolson 有限差分法求解一维翅片的瞬态热传导问题。\n\n### 1. 问题验证\n\n**步骤 1：提取已知条件**\n\n- **控制方程：** $\\frac{\\partial \\theta}{\\partial t} = \\alpha \\frac{\\partial^2 \\theta}{\\partial x^2} - s \\theta$，对于 $x \\in (0,L)$，$t > 0$。\n- **定义：**\n    - 过余温度：$\\theta(x,t) = T(x,t) - T_{\\infty}$。\n    - 热扩散率：$\\alpha = \\frac{k}{\\rho c}$。\n    - 侧面对流汇系数：$s = \\frac{h P}{\\rho c A}$。\n- **边界条件：**\n    - 基部（$x=0$ 处的狄利克雷条件）：$\\theta(0,t) = \\theta_b$，对于 $t \\ge 0$。\n    - 尖端（$x=L$ 处的罗宾条件）：$-\\frac{\\partial \\theta}{\\partial x}(L,t) = \\beta \\theta(L,t)$，其中 $\\beta = \\frac{h_e A_e}{k A}$。\n- **初始条件：** 空间均匀的过余温度 $\\theta(x,0) = \\theta_{\\text{init}}$。\n- **数值格式：**\n    - Crank-Nicolson (CN) 方法进行时间离散化。\n    - 均匀空间网格：$x_i = i \\Delta x$，对于 $i = 0, 1, \\dots, N$，其中 $\\Delta x = L/N$。\n    - 空间二阶导数的中心差分。\n    - 尖端罗宾边界条件的二阶精确单侧消除法。\n- **任务：**\n    1.  推导出未知向量 $\\boldsymbol{\\theta}^{n+1} = [\\theta_1^{n+1}, \\theta_2^{n+1}, \\dots, \\theta_{N}^{n+1}]^{\\top}$ 的三对角矩阵系统。\n    2.  提供矩阵系数和右端向量的表达式。\n    3.  实现该格式以进行单个时间步计算，并报告三个特定测试用例的温度分布 $[\\theta_0^{n+1}, \\theta_1^{n+1}, \\dots, \\theta_N^{n+1}]$。\n- **测试用例：**\n    - **用例 1：** $L = 0.05$, $N = 10$, $\\Delta t = 0.2$, $k = 205$, $\\rho = 2700$, $c = 900$, $A = 10^{-4}$, $P = 0.02$, $h = 55$, $h_e = 55$, $A_e = A$, $\\theta_b = 50$, $\\theta_{\\text{init}} = 0$。\n    - **用例 2：** 与用例 1 相同，但 $h_e = 0$。\n    - **用例 3：** $L = 0.03$, $N = 6$, $\\Delta t = 0.01$, $k = 150$, $\\rho = 8000$, $c = 500$, $A = 2 \\times 10^{-4}$, $P = 0.03$, $h = 250$, $h_e = 4000$, $A_e = A$, $\\theta_b = 20$, $\\theta_{\\text{init}} = 0$。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n- **科学依据：** 该问题基于公认的一维瞬态翅片方程，这是传热分析中的标准模型，源于能量守恒原理和傅里叶传导定律。边界条件（狄利克雷和罗宾）是常见热力学条件的物理现实表示。所有参数均为标准物理属性。该问题不含伪科学，事实可靠。\n- **良态性：** 该问题是一个具有明确初始和边界条件的线性抛物型偏微分方程。这构成了一个良态的初边值问题。为其求解推导和实现一种标准数值方法（Crank-Nicolson）的任务也是良态的。\n- **客观性：** 该问题使用精确的数学和物理术语陈述。任务是具体和定量的。没有主观或基于意见的元素。\n- **完整性和一致性：** 为每个测试用例提供了所有必需的物理参数、几何尺寸、初始/边界条件和数值参数。数据是自洽的，足以构建和解决问题。\n- **现实性和可行性：** 热物性和尺寸的数值对应于现实的工程材料（例如，用例 1 中的铝合金，用例 3 中的钢/铜合金）和翅片几何形状。指定的数值方法是标准的，并且在计算上是可行的。\n\n**步骤 3：结论与行动**\n\n该问题是有效的。它是一个在计算传热学领域中科学合理、良态且完整的问题。我将继续进行推导和求解。\n\n### 2. Crank-Nicolson 格式的推导\n\n瞬态翅片控制方程为：\n$$\n\\frac{\\partial \\theta}{\\partial t} = \\alpha \\frac{\\partial^2 \\theta}{\\partial x^2} - s \\theta\n$$\n令 $\\theta_i^n \\approx \\theta(x_i, t^n)$ 为在空间网格点 $x_i = i\\Delta x$ 和时间层 $t^n = n\\Delta t$ 上过余温度的数值近似。\n\nCrank-Nicolson 方法使用以 $t^{n+1/2}$ 为中心的向前差分来近似时间导数，并在时间层 $n$ 和 $n+1$ 上对空间项进行平均：\n$$\n\\frac{\\theta_i^{n+1} - \\theta_i^n}{\\Delta t} = \\frac{1}{2} \\left[ \\left(\\alpha \\frac{\\partial^2 \\theta}{\\partial x^2} - s \\theta\\right)\\right]_i^{n+1} + \\frac{1}{2} \\left[ \\left(\\alpha \\frac{\\partial^2 \\theta}{\\partial x^2} - s \\theta\\right)\\right]_i^{n}\n$$\n我们对空间二阶导数使用二阶中心差分近似：\n$$\n\\frac{\\partial^2 \\theta}{\\partial x^2}\\bigg|_i \\approx \\frac{\\theta_{i-1} - 2\\theta_i + \\theta_{i+1}}{(\\Delta x)^2}\n$$\n将此代入 Crank-Nicolson 公式可得：\n$$\n\\frac{\\theta_i^{n+1} - \\theta_i^n}{\\Delta t} = \\frac{\\alpha}{2} \\left( \\frac{\\theta_{i-1}^{n+1} - 2\\theta_i^{n+1} + \\theta_{i+1}^{n+1}}{(\\Delta x)^2} + \\frac{\\theta_{i-1}^{n} - 2\\theta_i^{n} + \\theta_{i+1}^{n}}{(\\Delta x)^2} \\right) - \\frac{s}{2}(\\theta_i^{n+1} + \\theta_i^n)\n$$\n我们定义扩散数 $r = \\frac{\\alpha \\Delta t}{(\\Delta x)^2}$。乘以 $\\Delta t$ 并重新排列各项，将未知数（在时间层 $n+1$）组合在左侧 (LHS)，将已知数（在时间层 $n$）组合在右侧 (RHS)，我们得到：\n$$\n-\\frac{r}{2}\\theta_{i-1}^{n+1} + \\left(1 + r + \\frac{s \\Delta t}{2}\\right)\\theta_i^{n+1} - \\frac{r}{2}\\theta_{i+1}^{n+1} = \\frac{r}{2}\\theta_{i-1}^{n} + \\left(1 - r - \\frac{s \\Delta t}{2}\\right)\\theta_i^{n} + \\frac{r}{2}\\theta_{i+1}^{n}\n$$\n此方程对内部节点 $i = 1, 2, \\dots, N-1$ 有效。现在我们必须引入边界条件来修改节点 $i=1$ 和 $i=N$ 的方程。未知向量为 $\\boldsymbol{\\theta}^{n+1} = [\\theta_1^{n+1}, \\theta_2^{n+1}, \\dots, \\theta_N^{n+1}]^{\\top}$。\n\n**基部边界条件（在 $i=0$ 处的狄利克雷条件）：**\n基部温度是固定的：$\\theta(0, t) = \\theta_b$。在我们的离散网格中，这意味着对于所有 $n \\ge 0$，$\\theta_0^n = \\theta_b$。\n对于第一个内部节点 $i=1$，通用方程为：\n$$\n-\\frac{r}{2}\\theta_{0}^{n+1} + \\left(1 + r + \\frac{s \\Delta t}{2}\\right)\\theta_1^{n+1} - \\frac{r}{2}\\theta_2^{n+1} = \\frac{r}{2}\\theta_{0}^{n} + \\left(1 - r - \\frac{s \\Delta t}{2}\\right)\\theta_1^{n} + \\frac{r}{2}\\theta_2^{n}\n$$\n由于 $\\theta_0^{n+1} = \\theta_0^n = \\theta_b$，我们将包含 $\\theta_0$ 的已知项移到右侧：\n$$\n\\left(1 + r + \\frac{s \\Delta t}{2}\\right)\\theta_1^{n+1} - \\frac{r}{2}\\theta_2^{n+1} = \\frac{r}{2}\\theta_b + \\frac{r}{2}\\theta_b + \\left(1 - r - \\frac{s \\Delta t}{2}\\right)\\theta_1^{n} + \\frac{r}{2}\\theta_2^{n}\n$$\n第一个未知数 $\\theta_1^{n+1}$ 的方程为：\n$$\n\\left(1 + r + \\frac{s \\Delta t}{2}\\right)\\theta_1^{n+1} - \\frac{r}{2}\\theta_2^{n+1} = r\\theta_b + \\left(1 - r - \\frac{s \\Delta t}{2}\\right)\\theta_1^{n} + \\frac{r}{2}\\theta_2^{n}.\n$$\n\n**尖端边界条件（在 $i=N$ 处的罗宾条件）：**\n条件为 $-\\frac{\\partial \\theta}{\\partial x}(L,t) = \\beta \\theta(L,t)$。我们通过在 $x_{N+1} = x_N + \\Delta x$ 处引入一个“虚拟”节点，对 $x_N=L$ 处的导数使用二阶精确的中心差分。\n$$\n\\frac{\\partial \\theta}{\\partial x}\\bigg|_N \\approx \\frac{\\theta_{N+1} - \\theta_{N-1}}{2\\Delta x}\n$$\n将其代入罗宾边界条件可得：\n$$\n-\\left(\\frac{\\theta_{N+1} - \\theta_{N-1}}{2\\Delta x}\\right) = \\beta \\theta_N \\quad \\implies \\quad \\theta_{N+1} = \\theta_{N-1} - 2\\beta\\Delta x \\theta_N\n$$\n这个关系用于从 $i=N$ 处的通用差分方程中消除虚拟节点 $\\theta_{N+1}$。我们在时间层 $n$ 和 $n+1$ 上都应用这个关系。\n$i=N$ 节点的方程为：\n$$\n-\\frac{r}{2}\\theta_{N-1}^{n+1} + \\left(1 + r + \\frac{s \\Delta t}{2}\\right)\\theta_N^{n+1} - \\frac{r}{2}\\theta_{N+1}^{n+1} = \\frac{r}{2}\\theta_{N-1}^{n} + \\left(1 - r - \\frac{s \\Delta t}{2}\\right)\\theta_N^{n} + \\frac{r}{2}\\theta_{N+1}^{n}\n$$\n在左侧代入 $\\theta_{N+1}^{n+1} = \\theta_{N-1}^{n+1} - 2\\beta\\Delta x \\theta_N^{n+1}$，在右侧代入 $\\theta_{N+1}^{n} = \\theta_{N-1}^{n} - 2\\beta\\Delta x \\theta_N^{n}$：\nLHS: $-\\frac{r}{2}\\theta_{N-1}^{n+1} + \\left(1 + r + \\frac{s \\Delta t}{2}\\right)\\theta_N^{n+1} - \\frac{r}{2}\\left(\\theta_{N-1}^{n+1} - 2\\beta\\Delta x \\theta_N^{n+1}\\right) = -r \\theta_{N-1}^{n+1} + \\left(1 + r + \\frac{s \\Delta t}{2} + r\\beta\\Delta x\\right)\\theta_N^{n+1}$\n\nRHS: $\\frac{r}{2}\\theta_{N-1}^{n} + \\left(1 - r - \\frac{s \\Delta t}{2}\\right)\\theta_N^{n} + \\frac{r}{2}\\left(\\theta_{N-1}^{n} - 2\\beta\\Delta x \\theta_N^{n}\\right) = r \\theta_{N-1}^{n} + \\left(1 - r - \\frac{s \\Delta t}{2} - r\\beta\\Delta x\\right)\\theta_N^{n}$\n\n### 3. 三对角系统总结\n\n我们得到了一个关于 $N$ 个未知数 $\\boldsymbol{\\theta}^{n+1} = [\\theta_1^{n+1}, \\dots, \\theta_N^{n+1}]^{\\top}$ 的 $N$ 个方程的线性系统，形式为 $\\mathbf{M} \\boldsymbol{\\theta}^{n+1} = \\mathbf{d}$。\n\n**矩阵 $\\mathbf{M}$ ($N \\times N$)：**\n这是一个具有以下系数的三对角矩阵。令行索引为 $j \\in \\{1,\\dots,N\\}$。\n- **次对角线 ($a_j$)：**\n  - 对于 $j = 2, \\dots, N-1$：$a_j = -\\frac{r}{2}$\n  - 对于 $j = N$：$a_N = -r$\n- **主对角线 ($b_j$)：**\n  - 对于 $j = 1, \\dots, N-1$：$b_j = 1 + r + \\frac{s \\Delta t}{2}$\n  - 对于 $j = N$：$b_N = 1 + r + \\frac{s \\Delta t}{2} + r\\beta\\Delta x$\n- **超对角线 ($c_j$)：**\n  - 对于 $j = 1, \\dots, N-1$：$c_j = -\\frac{r}{2}$\n\n**右端向量 $\\mathbf{d}$ (大小为 $N$)：**\n令分量索引为 $j \\in \\{1,\\dots,N\\}$。\n- **第一个分量 ($d_1$)：**\n  - $d_1 = r\\theta_b + \\left(1 - r - \\frac{s \\Delta t}{2}\\right)\\theta_1^n + \\frac{r}{2}\\theta_2^n$\n- **内部份量 ($d_j$ 对于 $j=2, \\dots, N-1$)：**\n  - $d_j = \\frac{r}{2}\\theta_{j-1}^n + \\left(1 - r - \\frac{s \\Delta t}{2}\\right)\\theta_j^n + \\frac{r}{2}\\theta_{j+1}^n$\n- **最后一个分量 ($d_N$)：**\n  - $d_N = r\\theta_{N-1}^n + \\left(1 - r - \\frac{s \\Delta t}{2} - r\\beta\\Delta x\\right)\\theta_N^n$\n\n新时间步 $t^{n+1}$ 的温度解是通过使用时间 $t^n$ 的已知值建立该系统并求解 $\\boldsymbol{\\theta}^{n+1}$ 来找到的。然后通过将已知的基部温度 $\\theta_b$ 前置到解向量中来构建最终的温度向量：$[\\theta_b, \\theta_1^{n+1}, \\dots, \\theta_N^{n+1}]$。",
            "answer": "```python\nimport numpy as np\n\ndef setup_and_solve_cn_step(params):\n    \"\"\"\n    Sets up and solves the Crank-Nicolson system for one time step.\n\n    Args:\n        params (dict): A dictionary containing all problem parameters.\n\n    Returns:\n        np.array: The temperature vector at the new time step, including the base.\n    \"\"\"\n    # Unpack parameters\n    L = params['L']\n    N = params['N']\n    dt = params['dt']\n    k = params['k']\n    rho = params['rho']\n    c = params['c']\n    A = params['A']\n    P = params['P']\n    h = params['h']\n    h_e = params['h_e']\n    A_e = params['A_e']\n    theta_b = params['theta_b']\n    theta_init = params['theta_init']\n    \n    # Calculate derived parameters\n    dx = L / N\n    alpha = k / (rho * c)\n    s = (h * P) / (rho * c * A)\n    beta = (h_e * A_e) / (k * A)\n    r = alpha * dt / (dx**2)\n\n    # Initial temperature vector theta^n for the single step calculation\n    # theta_n[0] is at x=0, theta_n[N] is at x=L\n    theta_n = np.full(N + 1, theta_init)\n    theta_n[0] = theta_b\n\n    # The vector of unknowns contains N elements: theta_{1} to theta_{N}\n    # We will construct an N x N matrix M and an N-element RHS vector d.\n    M = np.zeros((N, N))\n    d = np.zeros(N)\n\n    # --- Fill Matrix M (LHS coefficients) ---\n\n    # Main diagonal\n    diag_val = 1 + r + (s * dt / 2)\n    np.fill_diagonal(M, diag_val)\n    \n    # Sub-diagonal and Super-diagonal for interior nodes\n    sub_sup_val = -r / 2\n    if N > 1:\n        np.fill_diagonal(M[1:], sub_sup_val)  # Sub-diagonal\n        np.fill_diagonal(M[:, 1:], sub_sup_val) # Super-diagonal\n\n    # Modify last row for Robin BC at i=N\n    if N > 1:\n        M[N-1, N-2] = -r\n    M[N-1, N-1] = diag_val + r * beta * dx\n\n    # --- Fill RHS vector d ---\n\n    # First interior node (i=1)\n    # d[0] corresponds to the equation for theta_1\n    d[0] = r * theta_b + (1 - r - s * dt / 2) * theta_n[1]\n    if N > 1:\n        d[0] += (r / 2) * theta_n[2]\n\n    # Interior nodes (i=2 to N-1)\n    # d[j] corresponds to equation for theta_{j+1}\n    for j in range(1, N - 1):\n        d[j] = (r / 2) * theta_n[j] + \\\n               (1 - r - s * dt / 2) * theta_n[j+1] + \\\n               (r / 2) * theta_n[j+2]\n\n    # Last node (i=N)\n    # d[N-1] corresponds to equation for theta_N\n    if N > 1:\n        d[N-1] = r * theta_n[N-1] + \\\n                 (1 - r - s * dt / 2 - r * beta * dx) * theta_n[N]\n    else: # Case N=1\n        d[0] += (r * theta_n[0] + (1 - r - s * dt/2 - r*beta*dx) * theta_n[1]) - (1-r-s*dt/2)*theta_n[1] # A bit convoluted but works\n\n    # Solve the linear system M * theta_unknown_np1 = d\n    theta_unknown_np1 = np.linalg.solve(M, d)\n    \n    # Construct the full solution vector for t^{n+1}\n    theta_np1 = np.concatenate(([theta_b], theta_unknown_np1))\n\n    return theta_np1\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1\n        {\n            'L': 0.05, 'N': 10, 'dt': 0.2,\n            'k': 205.0, 'rho': 2700.0, 'c': 900.0,\n            'A': 1.0e-4, 'P': 0.02, 'h': 55.0,\n            'h_e': 55.0, 'A_e': 1.0e-4,\n            'theta_b': 50.0, 'theta_init': 0.0\n        },\n        # Case 2\n        {\n            'L': 0.05, 'N': 10, 'dt': 0.2,\n            'k': 205.0, 'rho': 2700.0, 'c': 900.0,\n            'A': 1.0e-4, 'P': 0.02, 'h': 55.0,\n            'h_e': 0.0, 'A_e': 1.0e-4,\n            'theta_b': 50.0, 'theta_init': 0.0\n        },\n        # Case 3\n        {\n            'L': 0.03, 'N': 6, 'dt': 0.01,\n            'k': 150.0, 'rho': 8000.0, 'c': 500.0,\n            'A': 2.0e-4, 'P': 0.03, 'h': 250.0,\n            'h_e': 4000.0, 'A_e': 2.0e-4,\n            'theta_b': 20.0, 'theta_init': 0.0\n        }\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result_vector = setup_and_solve_cn_step(case_params)\n        # Format the result vector as a list of strings\n        result_str_list = [f\"{x:.10f}\" for x in result_vector]\n        results.append(f\"[{','.join(result_str_list)}]\")\n\n    # Print the final output in the required format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}