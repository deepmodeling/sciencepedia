{
    "hands_on_practices": [
        {
            "introduction": "To build a solid understanding of potential vorticity (PV) conservation, we begin with the simplest case. This exercise strips away the complexity of planetary rotation to focus on the core mechanical principle: the relationship between a fluid column's height and its spin. By analyzing a hypothetical vortex on a non-rotating planet, you will directly apply the conservation of shallow-water potential vorticity, $q = \\zeta/H$, to see how vertical squashing or stretching dictates the fluid's relative vorticity .",
            "id": "1780085",
            "problem": "A simplified model for an atmospheric vortex is a vertical column of fluid. Consider such a column on a hypothetical, non-rotating planet. The column is composed of an ideal, incompressible fluid. Initially, the column has a height of $H_0 = 12.0$ km. It is rotating as a solid body about its vertical axis, with an initial period of rotation $T_0 = 24.0$ hours. This rotation imparts a uniform relative vorticity to the fluid.\n\nThe fluid column then moves over a large mountain range, which forces it to be vertically compressed. At its point of maximum compression, the column's height is reduced to $H_f = 9.00$ km. Assume that throughout this process, the column maintains its solid-body rotation profile, although its period of rotation may change.\n\nCalculate the new period of rotation, $T_f$, of the fluid column at its maximum compression. Express your answer in hours, rounded to three significant figures.",
            "solution": "For a solid-body rotation with angular velocity $\\Omega$, the tangential velocity is $v_{\\theta}(r) = \\Omega r$ and the vertical (relative) vorticity is uniform, given by\n$$\n\\zeta = \\frac{1}{r}\\frac{\\partial}{\\partial r}\\left(r v_{\\theta}\\right) = \\frac{1}{r}\\frac{\\partial}{\\partial r}\\left(\\Omega r^{2}\\right) = 2\\Omega.\n$$\nThe rotation period is related to $\\Omega$ by\n$$\n\\Omega = \\frac{2\\pi}{T} \\quad \\Rightarrow \\quad \\zeta = \\frac{4\\pi}{T}.\n$$\nFor an ideal, homogeneous (incompressible) shallow-water column on a non-rotating planet, the shallow-water potential vorticity is materially conserved:\n$$\nq = \\frac{f + \\zeta}{H} = \\text{constant}.\n$$\nWith $f=0$ here, this reduces to\n$$\n\\frac{\\zeta}{H} = \\text{constant}.\n$$\nBetween the initial and final states,\n$$\n\\frac{\\zeta_{f}}{H_{f}} = \\frac{\\zeta_{0}}{H_{0}}.\n$$\nUsing $\\zeta = 4\\pi/T$ for each state,\n$$\n\\frac{\\frac{4\\pi}{T_{f}}}{H_{f}} = \\frac{\\frac{4\\pi}{T_{0}}}{H_{0}} \\;\\;\\Rightarrow\\;\\; \\frac{1}{T_{f}} = \\frac{H_{f}}{H_{0}} \\frac{1}{T_{0}} \\;\\;\\Rightarrow\\;\\; T_{f} = T_{0}\\frac{H_{0}}{H_{f}}.\n$$\nSubstituting $T_{0} = 24.0$ hours, $H_{0} = 12.0$ km, and $H_{f} = 9.00$ km,\n$$\nT_{f} = 24.0 \\times \\frac{12.0}{9.00} = 32.0 \\text{ hours},\n$$\nwhich, to three significant figures, is $32.0$ hours.",
            "answer": "$$\\boxed{32.0}$$"
        },
        {
            "introduction": "Having established the basic link between height and vorticity, we now introduce background rotation, a key ingredient in geophysical fluid dynamics. This problem models a classic laboratory experiment on a turntable, which serves as a perfect analogue for the Earth's Coriolis effect on an $f$-plane. You will use the conservation of potential vorticity in its more general shallow-water form, $q = (\\zeta + f)/H$, to explore how compressing a fluid column that is initially at rest in a rotating frame generates relative vorticity . This is a fundamental mechanism for creating currents and eddies in the ocean and atmosphere.",
            "id": "1780123",
            "problem": "A large cylindrical tank is filled to a uniform depth $H_0$ with a homogeneous, incompressible, and inviscid fluid. The entire system is placed on a turntable and spun up to a constant angular velocity $\\Omega_0$ about its central vertical axis. After a sufficient amount of time, the fluid attains a state of solid-body rotation, moving with the tank as a rigid body.\n\nSubsequently, a flat, circular lid is slowly and coaxially lowered into the tank, compressing the column of fluid directly beneath it. The process is gentle enough that the fluid can be considered to remain in a balanced state. The final, uniform depth of the compressed fluid column is $H_f = \\alpha H_0$, where $\\alpha$ is a dimensionless constant such that $0 < \\alpha < 1$. The fluid outside the compressed region is free to move and adjust its height.\n\nAssuming the dynamics are governed by the shallow water equations on an f-plane, determine the final relative vorticity, $\\zeta_f$, of the fluid in the compressed region beneath the lid. The relative vorticity is defined as the vertical component of the curl of the fluid's velocity field as measured in the rotating frame of reference.\n\nExpress your answer in terms of $\\Omega_0$ and $\\alpha$.",
            "solution": "We use the shallow water potential vorticity conservation for a homogeneous, inviscid fluid on an f-plane. The materially conserved potential vorticity for each column is\n$$\nq \\equiv \\frac{\\zeta + f}{h}, \\quad \\frac{Dq}{Dt} = 0,\n$$\nwhere $\\zeta$ is the relative vorticity in the rotating frame, $f$ is the constant Coriolis parameter, and $h$ is the local fluid column depth.\n\nInitial state: after spin-up to solid-body rotation with the tank, in the rotating frame the fluid is at rest, so the horizontal velocity is zero and hence the initial relative vorticity is\n$$\n\\zeta_{0} = 0.\n$$\nThe initial depth under the lid region is $H_{0}$, so the initial potential vorticity is\n$$\nq_{0} = \\frac{\\zeta_{0} + f}{H_{0}} = \\frac{f}{H_{0}}.\n$$\n\nFinal state beneath the lid: the depth is uniformly compressed to\n$$\nH_{f} = \\alpha H_{0}, \\quad 0 < \\alpha < 1,\n$$\nand the final relative vorticity is $\\zeta_{f}$. By potential vorticity conservation for the same fluid columns,\n$$\n\\frac{\\zeta_{f} + f}{H_{f}} = \\frac{\\zeta_{0} + f}{H_{0}}.\n$$\nSubstituting $\\zeta_{0} = 0$ and $H_{f} = \\alpha H_{0}$ gives\n$$\n\\frac{\\zeta_{f} + f}{\\alpha H_{0}} = \\frac{f}{H_{0}} \\quad \\Longrightarrow \\quad \\zeta_{f} + f = \\alpha f \\quad \\Longrightarrow \\quad \\zeta_{f} = (\\alpha - 1) f.\n$$\n\nFor a frame rotating with angular velocity $\\Omega_{0}$ about the vertical axis, the f-plane Coriolis parameter is\n$$\nf = 2 \\Omega_{0}.\n$$\nTherefore,\n$$\n\\zeta_{f} = (\\alpha - 1)\\, 2 \\Omega_{0} = -2 \\Omega_{0} (1 - \\alpha).\n$$\nThis is negative (anticyclonic relative to the rotating frame) for $0 < \\alpha < 1$, as required by potential vorticity conservation under column compression in shallow water.",
            "answer": "$$\\boxed{-2\\,\\Omega_{0}\\,(1-\\alpha)}$$"
        },
        {
            "introduction": "The final practice transitions from analytical theory to the practical world of computational oceanography. In modern research, potential vorticity is not just a theoretical concept but a powerful diagnostic tool applied to the output of complex numerical models. This exercise challenges you to write a program that computes the terms of the PV conservation equation from gridded, time-dependent data, a task central to analyzing model simulations . By implementing finite-difference schemes and verifying the conservation law numerically, you will gain hands-on experience with the essential skills required to diagnose fluid dynamics in a computational setting.",
            "id": "3808642",
            "problem": "You are given a two-dimensional periodic square domain and time-dependent fields that represent model outputs. The task is to diagnose the potential vorticity budget in flux form by computing the storage, advection, and source terms from the fields, and then validate conservation numerically on a set of test cases. Begin from a fundamental base appropriate to rotating, stratified flows: the definition of Ertel potential vorticity and its conservation law under adiabatic and inviscid conditions, and construct the diagnostic budget that can be evaluated from gridded fields. Do not assume any shortcut formulas beyond these bases.\n\nThe domain is periodic in both directions, with lengths $L_x$ and $L_y$. The fields are sampled on a uniform grid with $N_x$ points in the $x$-direction and $N_y$ points in the $y$-direction, so the grid spacings are $d_x = L_x/N_x$ and $d_y = L_y/N_y$. Space derivatives must be approximated using second-order centered finite differences under periodic boundary conditions, and the time derivative must be approximated using a forward difference over a single time step $d_t$. The advection term must be computed in flux form as the divergence of the flux of the scalar field with the velocity field.\n\nFor each test case, you must:\n- Construct the scalar field $q(x,y,t)$ at times $t_0$ and $t_1 = t_0 + d_t$ according to the case definition.\n- Construct the velocity field $\\boldsymbol{u}(x,y,t)$ as specified.\n- Compute the storage term $T = \\partial q/\\partial t$ using the forward difference $(q(t_1) - q(t_0))/d_t$.\n- Compute the advection term $A = \\nabla \\cdot (\\boldsymbol{u} q)$ at time $t_0$ using centered differences and periodic boundary conditions.\n- Compute the source term $S$ as given for the case.\n- Form the residual $R = T + A - S$ at time $t_0$ and report its domain-mean absolute magnitude.\n\nAll computations must be carried out in units consistent with the fields, and the final diagnostic residual must be reported in units of $s^{-1}$. Angles inside trigonometric functions must be treated as dimensionless arguments of the functions, which are compatible with radians by construction.\n\nUse the following test suite to ensure coverage of different scenarios. In all cases, use $N_x = 256$, $N_y = 256$, $L_x = 10^6$ meters, $L_y = 10^6$ meters, and $t_0 = 0$ seconds.\n\n- Test Case $1$ (happy path, pure advection of a wave pattern with zero source):\n  - Parameters: $U = 0.2$ meters per second, $V = 0$ meters per second, $d_t = 600$ seconds.\n  - Define wave numbers $k_x = 2\\pi/L_x$, $k_y = 2\\pi/L_y$.\n  - Define $q(x,y,t) = \\cos(k_x x - k_x U t)\\,\\cos(k_y y)$.\n  - Define $\\boldsymbol{u}(x,y,t) = (U, 0)$.\n  - Define $S(x,y,t) = 0$.\n  - This case is constructed so that the flux-form budget $T + A - S$ should be numerically small.\n\n- Test Case $2$ (boundary condition check, stationary field with no motion and zero source):\n  - Parameters: $U = 0$ meters per second, $V = 0$ meters per second, $d_t = 600$ seconds.\n  - Define $k_x = 2\\pi/L_x$, $k_y = 2\\pi/L_y$.\n  - Define $q(x,y,t) = \\cos(k_x x)\\,\\cos(k_y y)$.\n  - Define $\\boldsymbol{u}(x,y,t) = (0, 0)$.\n  - Define $S(x,y,t) = 0$.\n  - This case tests that all terms vanish to numerical precision.\n\n- Test Case $3$ (nonconservative source, exponential decay with zero advection):\n  - Parameters: $U = 0$ meters per second, $V = 0$ meters per second, $d_t = 600$ seconds, $\\lambda = 10^{-6}$ per second.\n  - Define $k_x = 2\\pi/L_x$, $k_y = 2\\pi/L_y$.\n  - Define $q(x,y,t) = e^{-\\lambda t}\\,\\cos(k_x x)\\,\\cos(k_y y)$.\n  - Define $\\boldsymbol{u}(x,y,t) = (0, 0)$.\n  - Define $S(x,y,t) = -\\lambda q(x,y,t)$.\n  - This case is constructed so that the source term balances the storage term, making the residual small.\n\nYour program must compute the domain-mean absolute magnitude of the residual $R$ in units of $s^{-1}$ for each test case, and produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example $[r_1,r_2,r_3]$, where $r_1$, $r_2$, and $r_3$ are decimal numbers representing the domain-mean absolute residuals for Test Cases $1$, $2$, and $3$, respectively.",
            "solution": "The problem requires the numerical validation of a scalar conservation law in flux form, which is a fundamental diagnostic task in computational fluid dynamics, particularly in oceanography for budgets like potential vorticity. The governing equation is given by:\n$$\n\\frac{\\partial q}{\\partial t} + \\nabla \\cdot (\\boldsymbol{u} q) = S\n$$\nwhere $q$ is a scalar field, $\\boldsymbol{u} = (u, v)$ is the velocity field, and $S$ is a source/sink term. The problem asks us to compute the residual of this equation, $R = \\frac{\\partial q}{\\partial t} + \\nabla \\cdot (\\boldsymbol{u} q) - S$, using specified numerical approximations for given analytical fields on a two-dimensional periodic domain.\n\nThe domain is a square of side lengths $L_x$ and $L_y$, discretized by a uniform grid of $N_x \\times N_y$ points. The grid spacings are $d_x = L_x / N_x$ and $d_y = L_y / N_y$. We define the grid coordinates as $(x_i, y_j)$ where $x_i = i \\cdot d_x$ for $i \\in \\{0, 1, \\dots, N_x-1\\}$ and $y_j = j \\cdot d_y$ for $j \\in \\{0, 1, \\dots, N_y-1\\}$.\n\nLet's detail the numerical approximation of each term in the budget residual, $R = T + A - S$.\n\n1.  **Storage Term ($T$)**: The time-rate-of-change term, $T = \\partial q / \\partial t$, is approximated using a first-order forward difference in time. The computation is performed at time $t_0$, using field data from times $t_0$ and $t_1 = t_0 + d_t$. At each grid point $(i,j)$, the storage term is:\n    $$\n    T_{i,j} = \\frac{q(x_i, y_j, t_1) - q(x_i, y_j, t_0)}{d_t}\n    $$\n\n2.  **Advection Term ($A$)**: The advection term, $A = \\nabla \\cdot (\\boldsymbol{u} q)$, is evaluated at time $t_0$. In two dimensions, this expands to:\n    $$\n    A = \\frac{\\partial (u q)}{\\partial x} + \\frac{\\partial (v q)}{\\partial y}\n    $$\n    The spatial derivatives are approximated using second-order centered finite differences. For a generic field $F(x,y)$ evaluated on the grid as $F_{i,j}$, the partial derivatives at point $(i,j)$ are:\n    $$\n    \\left. \\frac{\\partial F}{\\partial x} \\right|_{i,j} \\approx \\frac{F_{i+1, j} - F_{i-1, j}}{2 d_x}\n    $$\n    $$\n    \\left. \\frac{\\partial F}{\\partial y} \\right|_{i,j} \\approx \\frac{F_{i, j+1} - F_{i, j-1}}{2 d_y}\n    $$\n    The domain's periodicity mandates that indices are handled modulo the grid dimensions. For example, $F_{N_x, j} = F_{0, j}$ and $F_{-1, j} = F_{N_x-1, j}$.\n    Letting $F_x = u q$ and $F_y = v q$ be the flux components evaluated at time $t_0$, the advection term at grid point $(i,j)$ is:\n    $$\n    A_{i,j} = \\frac{(uq)_{i+1, j} - (uq)_{i-1, j}}{2 d_x} + \\frac{(vq)_{i, j+1} - (vq)_{i, j-1}}{2 d_y}\n    $$\n    All fields on the right-hand side ($u, v, q$) are evaluated at $t=t_0$.\n\n3.  **Source Term ($S$)**: The source term, $S$, is given by an analytical expression for each test case. It is evaluated at each grid point $(i,j)$ at time $t_0$.\n    $$\n    S_{i,j} = S(x_i, y_j, t_0)\n    $$\n\n4.  **Residual ($R$) and Final Metric**: The residual field $R$ is calculated by combining the discretized terms at each grid point $(i,j)$:\n    $$\n    R_{i,j} = T_{i,j} + A_{i,j} - S_{i,j}\n    $$\n    The final required output is the domain-mean absolute magnitude of this residual, which is a single scalar value representing the average numerical imbalance of the conservation law over the entire grid.\n    $$\n    \\langle |R| \\rangle = \\frac{1}{N_x N_y} \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} |R_{i,j}|\n    $$\n    This metric provides a robust measure of how well the numerical scheme conserves the quantity $q$ for the given analytical solution. A small value indicates that the numerical implementation is consistent with the continuous equation it aims to solve, with the non-zero value arising from the truncation errors of the finite difference schemes.\n\nThe implementation will proceed by first defining the grid and case parameters. For each test case, the fields $q$, $u$, and $v$ are constructed at the required time points on the grid. The numerical derivative operators for periodic domains are implemented, and then applied to compute the fields $T$, $A$, and $S$. Finally, the residual field $R$ is computed, and its domain-mean absolute value is calculated and stored. The process is repeated for all three test cases.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the domain-mean absolute residual of a scalar conservation law\n    for a suite of test cases in computational oceanography.\n    \"\"\"\n\n    # Global parameters for all test cases\n    Nx = 256\n    Ny = 256\n    Lx = 1.0e6  # meters\n    Ly = 1.0e6  # meters\n    t0 = 0.0    # seconds\n\n    dx = Lx / Nx\n    dy = Ly / Ny\n\n    # Create grid coordinates\n    x_1d = np.arange(Nx) * dx\n    y_1d = np.arange(Ny) * dy\n    x, y = np.meshgrid(x_1d, y_1d, indexing='xy')\n\n    # Define wavenumbers\n    kx = 2.0 * np.pi / Lx\n    ky = 2.0 * np.pi / Ly\n\n    test_cases = [\n        {\n            # Case 1: Pure advection of a wave pattern\n            \"U\": 0.2, \"V\": 0.0, \"dt\": 600.0,\n            \"q_func\": lambda t, U: np.cos(kx * x - kx * U * t) * np.cos(ky * y),\n            \"S_func\": lambda q: 0.0,\n        },\n        {\n            # Case 2: Stationary field, zero velocity\n            \"U\": 0.0, \"V\": 0.0, \"dt\": 600.0,\n            \"q_func\": lambda t, U: np.cos(kx * x) * np.cos(ky * y),\n            \"S_func\": lambda q: 0.0,\n        },\n        {\n            # Case 3: Exponential decay, zero velocity\n            \"U\": 0.0, \"V\": 0.0, \"dt\": 600.0, \"lambda\": 1.0e-6,\n            \"q_func\": lambda t, U, lam: np.exp(-lam * t) * np.cos(kx * x) * np.cos(ky * y),\n            \"S_func\": lambda q, lam: -lam * q,\n        },\n    ]\n\n    results = []\n\n    # Second-order centered difference for x-derivative with periodic BC\n    def d_dx(field, dx_val):\n        return (np.roll(field, -1, axis=1) - np.roll(field, 1, axis=1)) / (2.0 * dx_val)\n\n    # Second-order centered difference for y-derivative with periodic BC\n    def d_dy(field, dy_val):\n        return (np.roll(field, -1, axis=0) - np.roll(field, 1, axis=0)) / (2.0 * dy_val)\n\n    # Process Test Case 1\n    case1 = test_cases[0]\n    dt1 = case1[\"dt\"]\n    U1, V1 = case1[\"U\"], case1[\"V\"]\n    t1 = t0 + dt1\n    \n    q0_c1 = case1[\"q_func\"](t0, U1)\n    q1_c1 = case1[\"q_func\"](t1, U1)\n    u0_c1 = np.full_like(x, U1)\n    v0_c1 = np.full_like(y, V1)\n\n    # Storage term T\n    T_c1 = (q1_c1 - q0_c1) / dt1\n\n    # Advection term A in flux form: A = d(uq)/dx + d(vq)/dy\n    flux_x_c1 = u0_c1 * q0_c1\n    flux_y_c1 = v0_c1 * q0_c1\n    A_c1 = d_dx(flux_x_c1, dx) + d_dy(flux_y_c1, dy)\n    \n    # Source term S\n    S_c1 = case1[\"S_func\"](q0_c1)\n\n    # Residual R\n    R_c1 = T_c1 + A_c1 - S_c1\n    results.append(np.mean(np.abs(R_c1)))\n\n    # Process Test Case 2\n    case2 = test_cases[1]\n    dt2 = case2[\"dt\"]\n    U2, V2 = case2[\"U\"], case2[\"V\"]\n    t2 = t0 + dt2\n    \n    q0_c2 = case2[\"q_func\"](t0, U2)\n    q1_c2 = case2[\"q_func\"](t2, U2)\n    u0_c2 = np.full_like(x, U2)\n    v0_c2 = np.full_like(y, V2)\n\n    T_c2 = (q1_c2 - q0_c2) / dt2\n    \n    flux_x_c2 = u0_c2 * q0_c2\n    flux_y_c2 = v0_c2 * q0_c2\n    A_c2 = d_dx(flux_x_c2, dx) + d_dy(flux_y_c2, dy)\n    \n    S_c2 = case2[\"S_func\"](q0_c2)\n    \n    R_c2 = T_c2 + A_c2 - S_c2\n    results.append(np.mean(np.abs(R_c2)))\n\n    # Process Test Case 3\n    case3 = test_cases[2]\n    dt3 = case3[\"dt\"]\n    U3, V3 = case3[\"U\"], case3[\"V\"]\n    lam3 = case3[\"lambda\"]\n    t3 = t0 + dt3\n    \n    q0_c3 = case3[\"q_func\"](t0, U3, lam3)\n    q1_c3 = case3[\"q_func\"](t3, U3, lam3)\n    u0_c3 = np.full_like(x, U3)\n    v0_c3 = np.full_like(y, V3)\n\n    T_c3 = (q1_c3 - q0_c3) / dt3\n    \n    flux_x_c3 = u0_c3 * q0_c3\n    flux_y_c3 = v0_c3 * q0_c3\n    A_c3 = d_dx(flux_x_c3, dx) + d_dy(flux_y_c3, dy)\n\n    S_c3 = case3[\"S_func\"](q0_c3, lam3)\n\n    R_c3 = T_c3 + A_c3 - S_c3\n    results.append(np.mean(np.abs(R_c3)))\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}