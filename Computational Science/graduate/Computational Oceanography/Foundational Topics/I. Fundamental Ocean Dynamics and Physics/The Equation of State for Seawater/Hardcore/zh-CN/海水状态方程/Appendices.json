{
    "hands_on_practices": [
        {
            "introduction": "海洋学家通常通过测量电导率来获得实用盐度（$S_P$），这是一个无量纲的量。然而，精确的热力学和动力学计算需要使用绝对盐度（$S_A$），即溶解物质在海水中的真实质量分数。本练习将指导您完成这一基础但至关重要的转换，通过引入绝对盐度异常（$\\delta S_A$）的概念，来考虑全球不同海域海水成分的微小差异。通过这项实践，您将巩固对TEOS-10核心变量之间关系的理解，并掌握在实际计算中应用这些概念的技能。",
            "id": "3814871",
            "problem": "给定您在多个海洋位置（由地理经度和纬度，单位为度，指定）观测到的实用盐度 ($S_P$)。实用盐度是一个无量纲的量，由电导率比标准定义。您还有一个已知的绝对盐度异常 ($\\delta S_A$) 空间场，表示为经度和纬度的函数，它捕捉了海水成分与全球标准参考混合物之间的微小偏差。目标是计算每个观测点的绝对盐度 ($S_A$)，单位为克/千克 ($\\mathrm{g/kg}$)。\n\n从与《2010年海水热力学方程》（TEOS-10）一致的定义出发，参考盐度的构建方式是，当实用盐度值为标准值 $S_P = 35$ 时，参考盐度 ($S_R$) 与标准海水中溶解物质的质量分数相匹配。这通过一个常数因子确定了 $S_P$ 与参考质量分数之间的比例关系。绝对盐度异常 $\\delta S_A$ 代表了由于成分空间变化而导致的与该参考质量分数的偏差，在此作为经度和纬度的已知函数提供。您的任务是根据这些原理，推导出一个从 $S_P$到 $S_A$ 的转换，该转换能正确地包含参考比例和异常值，并对其进行数值实现。\n\n使用以下科学上合理且自洽的规范：\n- 角度必须以度为单位处理。在计算任何三角函数之前，经度必须使用模运算卷绕到区间 $[0^\\circ, 360^\\circ)$ 内，纬度必须被限制在区间 $[-90^\\circ, 90^\\circ]$ 内。\n- 参考盐度常数由TEOS-10固定，使得当 $S_P = 35$ 时，质量分数为 $35.16504\\,\\mathrm{g/kg}$。这确定了 $S_P$ 与参考质量分数之间的比例关系。\n- 绝对盐度异常场由连续函数给出\n$$\n\\delta S_A(\\lambda,\\phi) = A \\,\\sin\\!\\left(\\frac{\\pi\\,\\phi}{180}\\right)\\,\\cos\\!\\left(\\frac{\\pi\\,\\lambda}{180}\\right),\n$$\n其中 $\\lambda$ 是以度为单位的经度，$\\phi$ 是以度为单位的纬度，$A = 0.02\\,\\mathrm{g/kg}$ 是异常的振幅。\n- 通过将计算出的负值设置为$0$来强制执行物理约束 $S_A \\ge 0$。\n\n推导该转换，并实现一个数值算法，对于每个观测点，根据给定的 $S_P$ 和 $\\delta S_A(\\lambda,\\phi)$ 计算出以 $\\mathrm{g/kg}$ 为单位的 $S_A$，并注意指定的角度处理和物理约束。\n\n测试套件：\n为以下五个案例提供输出，每个案例都是一个三元组 $(S_P,\\lambda,\\phi)$：\n- 案例 $1$：$(35.0, 180.0, 0.0)$\n- 案例 $2$：$(34.8, 0.0, 30.0)$\n- 案例 $3$：$(0.0, -10.0, -45.0)$\n- 案例 $4$：$(40.0, 370.0, 80.0)$\n- 案例 $5$：$(33.0, 250.0, -80.0)$\n\n答案规范：\n- 将每个得到的 $S_A$（单位为 $\\mathrm{g/kg}$）表示为一个四舍五入到$6$位小数的浮点数。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$[result_1,result_2,\\dots]$）。",
            "solution": "问题陈述已经过评估并被认为是有效的。它科学地基于海水TEOS-10标准的原理，问题提出得当，信息充分且一致，并以客观、正式的语言表述。唯一且可验证的解决方案所需的所有组成部分都已提供。\n\n主要目标是根据给定的实用盐度 ($S_P$，无量纲) 和由经度 ($\\lambda$) 与纬度 ($\\phi$)（单位为度）指定的地理位置，计算绝对盐度 ($S_A$)，单位为 $\\mathrm{g/kg}$。该解决方案需要根据问题陈述中阐明的第一性原理来推导转换公式。\n\nTEOS-10框架的基础是绝对盐度 ($S_A$)，即溶解固体的真实质量分数，可以表示为参考盐度 ($S_R$) 和绝对盐度异常 ($\\delta S_A$) 的总和。\n$$\nS_A = S_R + \\delta S_A\n$$\n参考盐度 $S_R$ 是指与样品具有相同实用盐度 $S_P$ 的标准参考成分海水的质量分数。它被定义为与实用盐度成正比。我们可以用一个比例常数 $u_{PS}$ 来表示这种关系：\n$$\nS_R = u_{PS} \\, S_P\n$$\n问题提供了确定该常数的必要信息。它指出，对于标准海水，实用盐度 $S_P = 35$ 对应于质量分数 $35.16504\\,\\mathrm{g/kg}$。对于这种参考海水，根据定义，异常值 $\\delta S_A$ 为零，因此其绝对盐度等于其参考盐度。这给了我们以下方程：\n$$\n35.16504\\,\\mathrm{g/kg} = u_{PS} \\cdot 35\n$$\n求解 $u_{PS}$ 得出转换因子：\n$$\nu_{PS} = \\frac{35.16504}{35}\\,\\mathrm{g/kg} \\approx 1.00471542857\\,\\mathrm{g/kg}\n$$\n将 $S_R$ 的表达式代入 $S_A$ 的主方程，我们得到从 $S_P$ 到 $S_A$ 的完整转换公式：\n$$\nS_A(S_P, \\lambda, \\phi) = \\left(\\frac{35.16504}{35}\\right) S_P + \\delta S_A(\\lambda, \\phi)\n$$\n绝对盐度异常 $\\delta S_A$ 作为经度 $\\lambda$ 和纬度 $\\phi$ 的已知函数提供：\n$$\n\\delta S_A(\\lambda,\\phi) = A \\,\\sin\\!\\left(\\frac{\\pi\\,\\phi}{180}\\right)\\,\\cos\\!\\left(\\frac{\\pi\\,\\lambda}{180}\\right)\n$$\n其中振幅给定为 $A = 0.02\\,\\mathrm{g/kg}$。因子 $\\frac{\\pi}{180}$ 用于将输入中提供的角度从度转换为弧度，以便用于三角函数。\n\n对于每个测试用例 $(S_P, \\lambda, \\phi)$，计算算法按以下步骤进行：\n$1$。角度预处理：必须正确处理地理坐标。\n    - 经度 $\\lambda$ 使用模运算卷绕到区间 $[0^\\circ, 360^\\circ)$。对于输入 $\\lambda$，归一化的经度为 $\\lambda' = \\lambda \\pmod{360}$。\n    - 纬度 $\\phi$ 被限制在物理上有意义的范围 $[-90^\\circ, 90^\\circ]$ 内。对于输入 $\\phi$，被限制的纬度为 $\\phi' = \\max(-90, \\min(90, \\phi))$。\n\n$2$。计算绝对盐度异常 ($\\delta S_A$)：将处理后的角度代入给定函数：\n    $$\n    \\delta S_A = (0.02\\,\\mathrm{g/kg}) \\cdot \\sin\\!\\left(\\frac{\\pi\\,\\phi'}{180}\\right)\\,\\cos\\!\\left(\\frac{\\pi\\,\\lambda'}{180}\\right)\n    $$\n\n$3$。计算参考盐度 ($S_R$)：使用推导出的关系和输入的 $S_P$：\n    $$\n    S_R = \\left(\\frac{35.16504}{35}\\right) S_P\n    $$\n\n$4$。计算绝对盐度 ($S_A$)：将两个分量相加：\n    $$\n    S_{A, \\text{raw}} = S_R + \\delta S_A\n    $$\n\n$5$。应用物理约束：绝对盐度作为质量分数，不能为负。因此，任何计算出的负值都是不符合物理规律的，必须设置为零。\n    $$\n    S_A = \\max(0, S_{A, \\text{raw}})\n    $$\n\n$6$。最终格式化：根据要求，将得到的 $S_A$ 值四舍五入到6位小数。\n\n这个分步过程确保了问题陈述中的所有条件都得到满足，从而产生科学上和数值上都正确的结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes Absolute Salinity (SA) from Practical Salinity (SP) and location\n    based on TEOS-10 principles.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (SP, longitude, latitude)\n        (35.0, 180.0, 0.0),\n        (34.8, 0.0, 30.0),\n        (0.0, -10.0, -45.0),\n        (40.0, 370.0, 80.0),\n        (33.0, 250.0, -80.0),\n    ]\n\n    # Define constants based on the problem statement\n    # The TEOS-10 conversion factor for Reference Salinity from Practical Salinity.\n    UPS = 35.16504 / 35.0\n    # The amplitude of the Absolute Salinity Anomaly field.\n    A = 0.02  # in g/kg\n\n    results = []\n    for sp, lon, lat in test_cases:\n        # Step 1: Angle Pre-processing\n        # Wrap longitude to the interval [0, 360) degrees.\n        lon_norm = lon % 360.0\n        # Clamp latitude to the interval [-90, 90] degrees.\n        lat_clamped = np.clip(lat, -90.0, 90.0)\n\n        # Step 2: Calculation of Absolute Salinity Anomaly (delta_Sa)\n        # Convert degrees to radians for trigonometric functions.\n        lon_rad = np.deg2rad(lon_norm)\n        lat_rad = np.deg2rad(lat_clamped)\n        \n        delta_sa = A * np.sin(lat_rad) * np.cos(lon_rad)\n\n        # Step 3: Calculation of Reference Salinity (Sr)\n        sr = UPS * sp\n\n        # Step 4: Calculation of Absolute Salinity (Sa)\n        sa_raw = sr + delta_sa\n\n        # Step 5: Application of Physical Constraint (SA >= 0)\n        sa = max(0.0, sa_raw)\n\n        # Step 6: Final Formatting\n        # Round the result to 6 decimal places and format as a string.\n        results.append(f\"{sa:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "TEOS-10的强大之处在于其基于吉布斯函数（$g$）建立的热力学一致性框架。本练习将带您深入其理论核心，不再仅仅是使用现成的公式，而是从第一性原理出发，推导一个关键的海洋学参数。您将通过对吉布斯函数的偏导数进行运算，来推导绝热下沉率（$\\Gamma$），它描述了水团在绝热垂直运动中温度随压力的变化率。这项练习将加深您对热力学状态方程与具体物理量之间联系的理解。",
            "id": "3814828",
            "problem": "你的任务是推导并实现海水的绝热垂直递减率，其形式应适用于在 2010 年海水热力学方程 (TEOS-10) 框架内进行计算评估。设单位质量的比吉布斯自由能为 $g(S_A, T, p)$，其中 $S_A$ 是绝对盐度，$T$ 是现场温度，$p$ 是压力。仅使用以下基本依据：\n- 源自吉布斯函数的热力学定义：在固定的 $S_A$ 和 $p$ 条件下，比熵 $\\eta = -\\partial g / \\partial T$；在固定的 $S_A$ 和 $T$ 条件下，比容 $v = \\partial g / \\partial p$。\n- 吉布斯函数混合偏导数相等所蕴含的麦克斯韦关系式。\n- 在比熵和绝对盐度恒定条件下的绝热垂直递减率的定义。\n\n任务：\n1. 从上述定义出发，并且不假设任何关于绝热垂直递减率的快捷恒等式，推导绝热垂直递减率 $\\Gamma = \\left( \\partial T / \\partial p \\right)_{ \\eta, S_A }$ 关于比吉布斯自由能 $g(S_A, T, p)$ 二阶导数的表达式。在微分过程中将 $S_A$ 视为常数。\n2. 为进行数值评估，采用以下在典型海洋条件下热力学一致的比吉布斯自由能局部替代模型：\n   $$g(S_A, T, p) = - c_p(S_A)\\, T \\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right) + \\left[v_{00} + v_T \\left(T - T_{\\mathrm{ref}}\\right) + v_S S_A\\right] p - \\frac{1}{2} \\left[\\kappa_0 + \\kappa_T \\left(T - T_{\\mathrm{ref}}\\right) + \\kappa_S S_A\\right] p^2,$$\n   其中 $T_{\\mathrm{ref}} = 273.15\\,\\mathrm{K}$，系数如下：\n   - $c_p(S_A) = c_{p0} + c_{pS} S_A$，其中 $c_{p0} = 3985\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$ 且 $c_{pS} = 0.10\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}\\,(g\\,kg^{-1})^{-1}}$，\n   - $v_{00} = 9.72\\times 10^{-4}\\,\\mathrm{m^3\\,kg^{-1}}$,\n   - $v_T = 2.50\\times 10^{-7}\\,\\mathrm{m^3\\,kg^{-1}\\,K^{-1}}$,\n   - $v_S = -8.00\\times 10^{-7}\\,\\mathrm{m^3\\,kg^{-1}\\,(g\\,kg^{-1})^{-1}}$,\n   - $\\kappa_0 = 4.50\\times 10^{-13}\\,\\mathrm{m^3\\,kg^{-1}\\,Pa^{-1}}$,\n   - $\\kappa_T = 5.00\\times 10^{-16}\\,\\mathrm{m^3\\,kg^{-1}\\,Pa^{-1}\\,K^{-1}}$,\n   - $\\kappa_S = -2.00\\times 10^{-15}\\,\\mathrm{m^3\\,kg^{-1}\\,Pa^{-1}\\,(g\\,kg^{-1})^{-1}}$。\n   该替代模型通过在典型海水比容范围内产生 $v = g_p$、一个正的等压热容 $c_p = - T\\, g_{TT}$ 以及一个小的正压缩性来确保物理上的合理性。\n3. 使用你推导出的以 $g$ 的导数表示的 $\\Gamma$ 表达式，为下面每个指定的测试用例计算 $\\Gamma$。请严格按照指定单位进行计算：\n   - 绝对盐度 $S_A$，单位为 $\\mathrm{g\\,kg^{-1}}$。\n   - 现场温度 $T$，单位为摄氏度 (ITS-90)，在使用于 $g(S_A, T_K, p)$ 之前必须转换为开尔文 $T_K = T~(\\mathrm{^\\circ C}) + 273.15$。\n   - 压力 $p$，单位为帕斯卡 ($\\mathrm{Pa}$)。\n   - 绝热垂直递减率 $\\Gamma$ 以 $\\mathrm{K\\,Pa^{-1}}$ 为单位表示。\n4. 测试套件：\n   - 案例1 (正常路径): $(S_A, T, p) = (35.0, 15.0, 1.0\\times 10^{6})$，\n   - 案例2 (表面边界): $(S_A, T, p) = (35.0, 10.0, 0.0)$，\n   - 案例3 (冷水、中层深度): $(S_A, T, p) = (34.5, 0.0, 5.0\\times 10^{6})$，\n   - 案例4 (暖水、深层): $(S_A, T, p) = (37.0, 25.0, 4.0\\times 10^{7})$，\n   - 案例5 (高盐度、深海): $(S_A, T, p) = (40.0, 2.0, 6.0\\times 10^{7})$。\n5. 最终输出格式：\n   你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。每个值必须是科学记数法表示的浮点数，小数点后有十位数字（例如，$[1.2345678900\\mathrm{e}{-08},\\dots]$），并以 $\\mathrm{K\\,Pa^{-1}}$ 为单位表示。\n\n你的程序必须是自包含的，并且不得要求用户输入。它必须使用上述替代函数 $g(S_A, T, p)$ 实现所推导的 $\\Gamma$ 表达式，并以指定的格式和单位返回测试套件的绝热垂直递减率值。",
            "solution": "该问题被评估为有效。它在科学上基于经典热力学，定义和数据完整，问题阐述明确，表述客观。任务是基于给定的吉布斯函数推导和计算海水的绝热垂直递减率，这是物理海洋学中的一个标准程序。\n\n### 第1部分：绝热垂直递减率 $\\Gamma$ 的推导\n\n绝热垂直递减率 $\\Gamma$ 定义为与周围环境不发生热交换的流体微团的温度随压力变化的速率。这对应于一个在恒定比熵 $\\eta$ 和恒定绝对盐度 $S_A$ 下发生的过程。其数学定义为：\n$$ \\Gamma = \\left( \\frac{\\partial T}{\\partial p} \\right)_{\\eta, S_A} $$\n在整个推导过程中，$S_A$ 保持恒定，为简洁起见，将从下标中省略。\n\n我们首先将比熵 $\\eta$ 视为现场温度 $T$ 和压力 $p$ 的函数，即 $\\eta = \\eta(T, p)$。其全微分由下式给出：\n$$ d\\eta = \\left( \\frac{\\partial \\eta}{\\partial T} \\right)_p dT + \\left( \\frac{\\partial \\eta}{\\partial p} \\right)_T dp $$\n对于一个等熵（绝热且可逆）过程，$d\\eta = 0$。因此：\n$$ 0 = \\left( \\frac{\\partial \\eta}{\\partial T} \\right)_p dT + \\left( \\frac{\\partial \\eta}{\\partial p} \\right)_T dp $$\n在 $\\eta$ 恒定的条件下，重排此方程求解比率 $dT/dp$ 可得：\n$$ \\Gamma = \\left( \\frac{\\partial T}{\\partial p} \\right)_{\\eta} = - \\frac{\\left( \\frac{\\partial \\eta}{\\partial p} \\right)_T}{\\left( \\frac{\\partial \\eta}{\\partial T} \\right)_p} $$\n此表达式将绝热垂直递减率与比熵的偏导数联系起来。下一步是用比吉布斯自由能 $g(T, p)$ 来表示这些导数。\n\n根据所提供的基本热力学定义：\n- 比熵：$\\eta = -\\left( \\frac{\\partial g}{\\partial T} \\right)_p \\equiv -g_T$\n- 比容：$v = \\left( \\frac{\\partial g}{\\partial p} \\right)_T \\equiv g_p$\n\n让我们计算 $\\Gamma$ 表达式的分母：\n$$ \\left( \\frac{\\partial \\eta}{\\partial T} \\right)_p = \\frac{\\partial}{\\partial T} \\left( -g_T \\right)_p = - \\frac{\\partial^2 g}{\\partial T^2} \\equiv -g_{TT} $$\n该项与等压比热容 $c_p = T \\left( \\frac{\\partial \\eta}{\\partial T} \\right)_p = -T g_{TT}$ 相关。由于为保证物理稳定性，$T > 0$ 且 $c_p > 0$，因此可推断 $g_{TT} < 0$。\n\n接下来，我们计算分子：\n$$ \\left( \\frac{\\partial \\eta}{\\partial p} \\right)_T = \\frac{\\partial}{\\partial p} \\left( -g_T \\right)_T = - \\frac{\\partial^2 g}{\\partial p \\partial T} \\equiv -g_{Tp} $$\n由于比吉布斯函数 $g$ 是一个状态函数，其混合偏导数相等（根据 Schwarz 定理）。这构成了一个麦克斯韦关系式：\n$$ \\frac{\\partial^2 g}{\\partial p \\partial T} = \\frac{\\partial^2 g}{\\partial T \\partial p} \\implies g_{Tp} = g_{pT} $$\n我们可以将 $g_{pT}$ 与比容的热膨胀联系起来：\n$$ g_{pT} = \\frac{\\partial}{\\partial T} \\left( \\frac{\\partial g}{\\partial p} \\right)_T = \\left( \\frac{\\partial v}{\\partial T} \\right)_p $$\n\n将这些结果代回 $\\Gamma$ 的表达式中：\n$$ \\Gamma = - \\frac{-g_{Tp}}{-g_{TT}} = - \\frac{g_{Tp}}{g_{TT}} $$\n使用麦克斯韦关系式 $g_{Tp} = g_{pT}$：\n$$ \\Gamma = - \\frac{g_{pT}}{g_{TT}} = - \\frac{\\frac{\\partial^2 g}{\\partial T \\partial p}}{\\frac{\\partial^2 g}{\\partial T^2}} $$\n这就是所要求的以比吉布斯自由能的二阶导数表示的绝热垂直递减率的表达式。\n\n### 第2部分：应用于替代吉布斯函数\n\n我们得到以下比吉布斯自由能的替代模型，其中 $T$ 是以开尔文为单位的温度：\n$$ g(S_A, T, p) = - c_p(S_A)\\, T \\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right) + \\left[v_{00} + v_T \\left(T - T_{\\mathrm{ref}}\\right) + v_S S_A\\right] p - \\frac{1}{2} \\left[\\kappa_0 + \\kappa_T \\left(T - T_{\\mathrm{ref}}\\right) + \\kappa_S S_A\\right] p^2, $$\n其中 $c_p(S_A) = c_{p0} + c_{pS} S_A$。\n\n我们必须计算二阶偏导数 $g_{TT}$ 和 $g_{pT}$。\n\n首先，是关于温度的偏导数 $g_T$：\n$$ g_T = \\frac{\\partial g}{\\partial T} = \\frac{\\partial}{\\partial T}\\left[-c_p(S_A) T \\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right)\\right] + \\frac{\\partial}{\\partial T}\\left[ \\dots \\right]p - \\frac{\\partial}{\\partial T}\\left[ \\dots \\right]p^2 $$\n$$ g_T = -c_p(S_A) \\left[ \\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right) + T \\cdot \\frac{1}{T} \\right] + v_T p - \\frac{1}{2} \\kappa_T p^2 $$\n$$ g_T = -c_p(S_A) \\left[ \\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right) + 1 \\right] + v_T p - \\frac{1}{2} \\kappa_T p^2 $$\n现在，是关于温度的二阶偏导数 $g_{TT}$：\n$$ g_{TT} = \\frac{\\partial g_T}{\\partial T} = -c_p(S_A) \\left[ \\frac{1}{T} \\right] = -\\frac{c_p(S_A)}{T} $$\n这个结果与热力学定义 $c_p = -T g_{TT}$ 一致。\n\n接下来，我们计算关于压力的偏导数 $g_p$：\n$$ g_p = \\frac{\\partial g}{\\partial p} = \\left[v_{00} + v_T \\left(T - T_{\\mathrm{ref}}\\right) + v_S S_A\\right] - \\left[\\kappa_0 + \\kappa_T \\left(T - T_{\\mathrm{ref}}\\right) + \\kappa_S S_A\\right] p $$\n现在，是混合偏导数 $g_{pT}$：\n$$ g_{pT} = \\frac{\\partial g_p}{\\partial T} = v_T - \\kappa_T p $$\n\n最后，我们将 $g_{TT}$ 和 $g_{pT}$ 的表达式代入 $\\Gamma$ 的公式中：\n$$ \\Gamma = - \\frac{g_{pT}}{g_{TT}} = - \\frac{v_T - \\kappa_T p}{-\\frac{c_p(S_A)}{T}} $$\n$$ \\Gamma = \\frac{T \\left( v_T - \\kappa_T p \\right)}{c_p(S_A)} $$\n代入 $c_p(S_A) = c_{p0} + c_{pS} S_A$，我们得到用于数值计算的最终表达式：\n$$ \\Gamma(S_A, T, p) = \\frac{T \\left( v_T - \\kappa_T p \\right)}{c_{p0} + c_{pS} S_A} $$\n此处，$T$ 的单位必须是开尔文。此公式将被用于求解给定测试用例的问题。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes the adiabatic lapse rate of seawater using a \n    surrogate Gibbs function within the TEOS-10 framework.\n    \"\"\"\n    \n    # Define the coefficients from the problem statement.\n    # The units are SI (J, kg, K, Pa, m).\n    \n    # Specific heat capacity coefficients for cp(SA) = c_p0 + c_pS * SA\n    # c_p0 in J kg^-1 K^-1\n    C_P0 = 3985.0\n    # c_pS in J kg^-1 K^-1 (g kg^-1)^-1\n    C_PS = 0.10\n    \n    # Coefficient for the temperature-dependent part of specific volume\n    # v_T in m^3 kg^-1 K^-1\n    V_T = 2.50e-7\n    \n    # Coefficient for the temperature-dependent part of compressibility\n    # kappa_T in m^3 kg^-1 Pa^-1 K^-1\n    KAPPA_T = 5.00e-16\n    \n    # Temperature conversion offset from ITS-90 (°C) to Kelvin (K)\n    T_OFFSET_KELVIN = 273.15\n    \n    # Define the test cases from the problem statement.\n    # Each tuple is (Absolute Salinity SA [g/kg], Temperature T [°C], Pressure p [Pa])\n    test_cases = [\n        (35.0, 15.0, 1.0e6),\n        (35.0, 10.0, 0.0),\n        (34.5, 0.0, 5.0e6),\n        (37.0, 25.0, 4.0e7),\n        (40.0, 2.0, 6.0e7),\n    ]\n\n    results = []\n    \n    # The derived formula for the adiabatic lapse rate is:\n    # Gamma = T_kelvin * (v_T - kappa_T * p) / (c_p0 + c_pS * SA)\n    \n    for sa, t_celsius, p in test_cases:\n        # Convert in-situ temperature from Celsius to Kelvin for use in the formula\n        t_kelvin = t_celsius + T_OFFSET_KELVIN\n        \n        # Calculate the specific heat capacity at constant pressure, c_p(SA)\n        cp_sa = C_P0 + C_PS * sa\n        \n        # Calculate the numerator of the Gamma expression\n        numerator = t_kelvin * (V_T - KAPPA_T * p)\n        \n        # Calculate the adiabatic lapse rate, Gamma\n        gamma = numerator / cp_sa\n        \n        results.append(gamma)\n\n    # Format the results into a string as specified: a comma-separated list\n    # in square brackets, with each number in scientific notation with 10 decimal places.\n    formatted_results = [f\"{res:.10e}\" for res in results]\n    \n    # The final print statement must produce only the single-line specified format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在海洋中，水团倾向于沿着密度恒定的表面运动，这些表面被称为“中性面”。然而，在实际分析中，我们常常使用计算更简便的位密（potential density）面（如 $\\sigma_2$）来近似。本练习将引导您探究这种近似在深海条件下可能引入的误差。您将通过计算位密面与真实中性面法向量之间的几何偏离角，来量化这种差异，从而深刻理解为何在研究深海环流和混合时，需要更精确的密度坐标，以及中性面概念的重要性。",
            "id": "3814838",
            "problem": "您需要设计并实现一个程序，用于量化深海条件下，恒定原位密度表面与参考于$2000$分巴的恒定位密度（通常表示为 $\\sigma_2$）表面之间的几何未对准程度。该分析必须基于与2010年海水热力学方程（TEOS-10）一致的第一性原理推导，并使用围绕深海参考状态的物理上合理的线性化方法。\n\n首先从原位密度 $\\rho$ 是绝对盐度（$\\mathrm{SA}$）、保守温度（$\\mathrm{CT}$）和压力 $p$ 的函数这一定义开始：$\\rho = \\rho(\\mathrm{SA}, \\mathrm{CT}, p)$。在TEOS-10中，精确的状态方程很复杂；然而，对于围绕深海参考状态的小异常，一阶线性化被广泛接受为一种有效的近似：\n$$\n\\Delta \\rho \\approx \\left(\\frac{\\partial \\rho}{\\partial \\mathrm{SA}}\\right) \\Delta \\mathrm{SA} + \\left(\\frac{\\partial \\rho}{\\partial \\mathrm{CT}}\\right) \\Delta \\mathrm{CT} + \\left(\\frac{\\partial \\rho}{\\partial p}\\right) \\Delta p.\n$$\n定义以下恒定的、代表深海的系数（在所有测试用例中保持不变）：\n- 盐缩项 $b$，使得 $\\left(\\frac{\\partial \\rho}{\\partial \\mathrm{SA}}\\right) \\approx b$，其中 $b = 0.78$ $\\mathrm{kg}\\ \\mathrm{m}^{-3}\\ (\\mathrm{g}\\ \\mathrm{kg}^{-1})^{-1}$。\n- 热膨胀项 $a_T$，使得 $\\left(\\frac{\\partial \\rho}{\\partial \\mathrm{CT}}\\right) \\approx -a_T$，其中 $a_T = 0.20$ $\\mathrm{kg}\\ \\mathrm{m}^{-3}\\ \\mathrm{K}^{-1}$。\n- 压缩项 $\\kappa_p$，使得 $\\left(\\frac{\\partial \\rho}{\\partial p}\\right) \\approx \\kappa_p$，其中 $\\kappa_p = 0.0025$ $\\mathrm{kg}\\ \\mathrm{m}^{-3}\\ \\mathrm{dbar}^{-1}$。\n\n设空间梯度表示为 $\\nabla \\mathrm{SA}$、$\\nabla \\mathrm{CT}$ 和 $\\nabla p$。在海洋的静水平衡下，垂直压力梯度为\n$$\n\\frac{\\partial p}{\\partial z} \\approx -\\frac{\\rho_{\\mathrm{ref}} g}{10^4},\n$$\n其中 $z$ 是以米为单位的垂直坐标且向上为正，$p$ 的单位是分巴，$g$ 是重力加速度，$\\rho_{\\mathrm{ref}}$ 是一个恒定的参考密度。使用 $g = 9.81$ $\\mathrm{m}\\ \\mathrm{s}^{-2}$ 和 $\\rho_{\\mathrm{ref}} = 1030$ $\\mathrm{kg}\\ \\mathrm{m}^{-3}$，因此 $\\nabla p = [0, 0, \\partial p/\\partial z]$，其中 $\\partial p/\\partial z$ 的单位是 $\\mathrm{dbar}\\ \\mathrm{m}^{-1}$。\n\n定义原位密度的梯度为\n$$\n\\nabla \\rho = b\\, \\nabla \\mathrm{SA} - a_T\\, \\nabla \\mathrm{CT} + \\kappa_p\\, \\nabla p,\n$$\n以及参考于$2000$ $\\mathrm{dbar}$的位密度（即 $\\sigma_2$）的梯度为\n$$\n\\nabla \\sigma_2 = b\\, \\nabla \\mathrm{SA} - a_T\\, \\nabla \\mathrm{CT},\n$$\n因为参考压力在空间上是恒定的，因此没有梯度贡献。相应等值面的单位法向量是归一化向量 $\\hat{\\mathbf{n}}_{\\rho} = \\nabla \\rho / \\|\\nabla \\rho\\|$ 和 $\\hat{\\mathbf{n}}_{\\sigma_2} = \\nabla \\sigma_2 / \\|\\nabla \\sigma_2\\|$。\n\n两个表面法向量之间的未对准角 $\\theta$ 定义为\n$$\n\\theta = \\arccos\\left( \\frac{\\hat{\\mathbf{n}}_{\\rho} \\cdot \\hat{\\mathbf{n}}_{\\sigma_2}}{1} \\right) = \\arccos\\left( \\frac{\\nabla \\rho \\cdot \\nabla \\sigma_2}{\\|\\nabla \\rho\\|\\,\\|\\nabla \\sigma_2\\|} \\right),\n$$\n以弧度表示。这个角度量化了使用 $\\sigma_2$ 表面代替中性（原位密度）表面时引入的几何误差。对于限制在中性面上的单位速度流，垂直于 $\\sigma_2$ 面的伪分量大小为 $\\sin(\\theta)$，我们将其定义为伪法向速度分数 $f$。\n\n您的任务是实现一个程序，该程序：\n- 使用上述线性化和常数。\n- 使用给定的 $g$ 和 $\\rho_{\\mathrm{ref}}$ 根据静水平衡计算 $\\nabla p$，确保单位一致性（$\\mathrm{dbar}\\ \\mathrm{m}^{-1}$）。\n- 对于每个测试用例，计算 $\\nabla \\rho$、$\\nabla \\sigma_2$、未对准角 $\\theta$（以弧度为单位）和伪法向速度分数 $f = \\sin(\\theta)$。\n- 输出一行，其中包含每个测试用例的一对 $[\\theta, f]$ 列表，每对值四舍五入到$6$位小数。\n\n所有量必须用以下单位表示：\n- $\\nabla \\mathrm{SA}$ 的单位为 $(\\mathrm{g}\\ \\mathrm{kg}^{-1})\\ \\mathrm{m}^{-1}$，\n- $\\nabla \\mathrm{CT}$ 的单位为 $\\mathrm{K}\\ \\mathrm{m}^{-1}$，\n- $\\nabla p$ 的单位为 $\\mathrm{dbar}\\ \\mathrm{m}^{-1}$，\n- $\\theta$ 的单位为弧度，\n- $f$ 为无单位的小数。\n\n测试套件：\n提供以下三个测试用例，每个测试用例以三维向量 $[x, y, z]$ 的形式给出 $\\nabla \\mathrm{SA}$ 和 $\\nabla \\mathrm{CT}$，单位如上指定：\n\n$1.$ 理想路径下的深海结构：\n- $\\nabla \\mathrm{SA} = [1.2\\times 10^{-6}, -4.0\\times 10^{-7}, 5.0\\times 10^{-5}]$,\n- $\\nabla \\mathrm{CT} = [-2.0\\times 10^{-6}, 9.0\\times 10^{-7}, -1.0\\times 10^{-4}]$.\n\n$2.$ 近乎补偿的垂直结构（$\\nabla \\sigma_2$ 垂直分量小）：\n- $\\nabla \\mathrm{SA} = [3.0\\times 10^{-7}, -2.0\\times 10^{-7}, -2.0\\times 10^{-5}]$,\n- $\\nabla \\mathrm{CT} = [1.0\\times 10^{-6}, -6.0\\times 10^{-7}, -7.8\\times 10^{-5}]$.\n\n$3.$ 弱水平梯度与中等垂直梯度：\n- $\\nabla \\mathrm{SA} = [4.0\\times 10^{-7}, 4.0\\times 10^{-7}, 1.0\\times 10^{-5}]$,\n- $\\nabla \\mathrm{CT} = [-5.0\\times 10^{-7}, 3.0\\times 10^{-7}, -2.5\\times 10^{-5}]$.\n\n最终输出格式：\n您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表。每个元素对应一个测试用例，并且本身必须是一个双元素列表 $[\\theta, f]$，其值四舍五入到$6$位小数。例如：\n$[\\,[0.123456,0.122345],[0.234567,0.232345],[0.345678,0.338765]\\,]$.",
            "solution": "该问题要求在2010年海水热力学方程（TEOS-10）的框架内，量化原位密度$\\rho$和参考于$2000\\,\\mathrm{dbar}$的位密度$\\sigma_2$的等值面之间的几何未对准程度。此分析使用一种对围绕代表性深海状态的小异常有效的线性化近似方法。\n\n问题的核心在于对这两个密度度量的梯度进行矢量分析。标量场的梯度是一个矢量，指向标量增加速率最大的方向，其大小即为该增加速率。垂直于恒定标量值表面（等值面）的向量由该标量场的梯度给出。两个此类法向量之间的夹角可量化相应等值面之间的未对准程度。\n\n首先，我们根据所提供的线性近似建立梯度的数学表达式。原位密度$\\rho$是绝对盐度（$\\mathrm{SA}$）、保守温度（$\\mathrm{CT}$）和压力$p$的函数。其梯度由链式法则给出：\n$$\n\\nabla \\rho = \\frac{\\partial \\rho}{\\partial \\mathrm{SA}} \\nabla \\mathrm{SA} + \\frac{\\partial \\rho}{\\partial \\mathrm{CT}} \\nabla \\mathrm{CT} + \\frac{\\partial \\rho}{\\partial p} \\nabla p\n$$\n使用所提供的常数系数 $b = \\left(\\frac{\\partial \\rho}{\\partial \\mathrm{SA}}\\right)$、$-a_T = \\left(\\frac{\\partial \\rho}{\\partial \\mathrm{CT}}\\right)$ 和 $\\kappa_p = \\left(\\frac{\\partial \\rho}{\\partial p}\\right)$，这可以简化为：\n$$\n\\nabla \\rho = b\\, \\nabla \\mathrm{SA} - a_T\\, \\nabla \\mathrm{CT} + \\kappa_p\\, \\nabla p\n$$\n参考于压力$p_r$（这里$p_r = 2000\\,\\mathrm{dbar}$）的位密度，是指一个海水包裹被绝热地移动到该参考压力时所具有的密度。根据定义，其对压力的函数依赖性被移除。因此，其梯度仅依赖于$\\mathrm{SA}$和$\\mathrm{CT}$的梯度：\n$$\n\\nabla \\sigma_2 = b\\, \\nabla \\mathrm{SA} - a_T\\, \\nabla \\mathrm{CT}\n$$\n压力梯度$\\nabla p$被假定为纯粹是垂直的，并由静水平衡$\\frac{\\mathrm{d}p}{\\mathrm{d}z} \\approx -\\rho g$确定。问题指定了压力（单位为分巴，$p$）和深度（单位为米，$z$，向上为正）的公式：\n$$\n\\frac{\\partial p}{\\partial z} \\approx -\\frac{\\rho_{\\mathrm{ref}} g}{10^4}\n$$\n$10^4$的系数将压力单位从帕斯卡（$\\mathrm{N}\\,\\mathrm{m}^{-2}$）转换为分巴。使用给定的常数$g = 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$和$\\rho_{\\mathrm{ref}} = 1030\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$，我们计算垂直压力梯度：\n$$\n\\frac{\\partial p}{\\partial z} = -\\frac{(1030\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}) \\times (9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2})}{10^4} = -\\frac{10104.3}{10^4} = -1.01043\\,\\mathrm{dbar}\\,\\mathrm{m}^{-1}\n$$\n由于水平壓力梯度假定为零，压力梯度矢量为：\n$$\n\\nabla p = [0, 0, -1.01043]\\,\\mathrm{dbar}\\,\\mathrm{m}^{-1}\n$$\n两个等值面之间的未对准角$\\theta$是它們的法向量$\\nabla \\rho$和$\\nabla \\sigma_2$之間的夾角。它使用点积的定义来计算：\n$$\n\\mathbf{A} \\cdot \\mathbf{B} = \\|\\mathbf{A}\\| \\|\\mathbf{B}\\| \\cos(\\theta)\n$$\n整理得到$\\theta$：\n$$\n\\theta = \\arccos\\left( \\frac{\\nabla \\rho \\cdot \\nabla \\sigma_2}{\\|\\nabla \\rho\\|\\,\\|\\nabla \\sigma_2\\|} \\right)\n$$\n项$\\|\\mathbf{V}\\|$表示向量$\\mathbf{V}$的欧几里得范数。角度$\\theta$将以弧度为单位，范围在$[0, \\pi]$之間。\n\n需要计算的最后一个量是伪法向速度分数$f$，定义为$f = \\sin(\\theta)$。对于与真实中性（原位密度）面完美对齐的单位速度流，该值表示垂直于$\\sigma_2$面的速度分量的大小。\n\n每个测试用例的算法如下：\n1.  接收输入向量$\\nabla \\mathrm{SA}$和$\\nabla \\mathrm{CT}$。\n2.  定义常数系数：$b = 0.78$，$a_T = 0.20$和$\\kappa_p = 0.0025$。\n3.  定义恒定压力梯度向量：$\\nabla p = [0, 0, -1.01043]$。\n4.  使用矢量算术计算位密度梯度$\\nabla \\sigma_2 = b\\, \\nabla \\mathrm{SA} - a_T\\, \\nabla \\mathrm{CT}$。\n5.  计算原位密度梯度$\\nabla \\rho = \\nabla \\sigma_2 + \\kappa_p\\, \\nabla p$。\n6.  计算点积$D = \\nabla \\rho \\cdot \\nabla \\sigma_2$。\n7.  计算向量范数$N_\\rho = \\|\\nabla \\rho\\|$和$N_{\\sigma_2} = \\|\\nabla \\sigma_2\\|$。\n8.  如果任一范数为零，则角度未定义。然而，对于给定的测试用例，范数将为非零。\n9.  计算角度$\\theta = \\arccos\\left(D / (N_\\rho N_{\\sigma_2})\\right)$。\n10. 计算分数$f = \\sin(\\theta)$。\n11. 存储对$[\\theta, f]$，四舍五入到$6$位小数。\n\n实现此过程后，即可得出所提供测试用例的解。请注意，来自压力梯度项并加到$\\nabla\\rho$上的大的恒定垂直分量，确保了$\\|\\nabla\\rho\\|$始终非零，并通常使$\\nabla\\rho$几乎垂直向下（负$z$方向）指向，而$\\nabla\\sigma_2$的方向则变化多端。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the misalignment angle (theta) and spurious normal-speed fraction (f)\n    between in-situ density and potential density isosurfaces for given\n    oceanographic conditions.\n    \"\"\"\n    \n    # Define constant, deep-ocean representative coefficients and physical constants.\n    b = 0.78       # Haline contraction term, kg m^-3 (g/kg)^-1\n    a_T = 0.20     # Thermal expansion term, kg m^-3 K^-1\n    kappa_p = 0.0025  # Compressibility term, kg m^-3 dbar^-1\n    g = 9.81         # Gravitational acceleration, m s^-2\n    rho_ref = 1030   # Reference density, kg m^-3\n\n    # Define the test cases from the problem statement.\n    # Each case provides nabla_SA and nabla_CT as 3D vectors.\n    test_cases = [\n        # 1. Happy-path deep-ocean structure\n        {\n            \"nabla_SA\": [1.2e-6, -4.0e-7, 5.0e-5],\n            \"nabla_CT\": [-2.0e-6, 9.0e-7, -1.0e-4]\n        },\n        # 2. Nearly compensated vertical structure\n        {\n            \"nabla_SA\": [3.0e-7, -2.0e-7, -2.0e-5],\n            \"nabla_CT\": [1.0e-6, -6.0e-7, -7.8e-5]\n        },\n        # 3. Weak horizontal gradients with moderate vertical gradients\n        {\n            \"nabla_SA\": [4.0e-7, 4.0e-7, 1.0e-5],\n            \"nabla_CT\": [-5.0e-7, 3.0e-7, -2.5e-5]\n        }\n    ]\n\n    # Calculate the vertical pressure gradient from hydrostatic balance.\n    # The result is in dbar/m.\n    dp_dz = -(rho_ref * g) / 10**4\n    nabla_p = np.array([0.0, 0.0, dp_dz])\n\n    results = []\n    for case in test_cases:\n        nabla_SA = np.array(case[\"nabla_SA\"])\n        nabla_CT = np.array(case[\"nabla_CT\"])\n\n        # Compute the gradient of potential density referenced to 2000 dbar (sigma_2).\n        nabla_sigma2 = b * nabla_SA - a_T * nabla_CT\n        \n        # Compute the gradient of in-situ density (rho).\n        nabla_rho = nabla_sigma2 + kappa_p * nabla_p\n\n        # Calculate the norms of the gradient vectors.\n        norm_rho = np.linalg.norm(nabla_rho)\n        norm_sigma2 = np.linalg.norm(nabla_sigma2)\n\n        # Handle the theoretical case of a zero-gradient to avoid division by zero.\n        if norm_rho == 0.0 or norm_sigma2 == 0.0:\n            theta = 0.0\n            f = 0.0\n        else:\n            # Calculate the dot product.\n            dot_product = np.dot(nabla_rho, nabla_sigma2)\n            \n            # Compute the cosine of the angle. Clip to handle potential floating-point\n            # inaccuracies leading to values slightly outside the [-1, 1] range.\n            cos_theta = np.clip(dot_product / (norm_rho * norm_sigma2), -1.0, 1.0)\n            \n            # Compute the misalignment angle theta in radians.\n            theta = np.arccos(cos_theta)\n            \n            # Compute the spurious normal-speed fraction f.\n            f = np.sin(theta)\n        \n        results.append([theta, f])\n\n    # Format the results into the required string format.\n    # Each sub-list [theta, f] has its values rounded to 6 decimal places.\n    formatted_results = [f\"[{t:.6f},{f:.6f}]\" for t, f in results]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}