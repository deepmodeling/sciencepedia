{
    "hands_on_practices": [
        {
            "introduction": "This first practice grounds our understanding by applying the fundamental hydrostatic balance to a non-uniform ocean. By integrating the governing equation through a realistically stratified water column, you will derive the pressure field. This exercise moves beyond the simplistic constant-density assumption and provides a direct, hands-on calculation of how pressure accumulates with depth in the real ocean.",
            "id": "3815116",
            "problem": "Consider a stably stratified ocean column described in a right-handed Cartesian coordinate with vertical coordinate $z$ pointing upward, with $z=0$ at the mean sea level. The free surface is located at $z=\\eta$, where $\\eta$ may be nonzero, and the atmospheric (or prescribed) pressure at the free surface is $p(\\eta)=p_{s}$. Gravity has constant magnitude $g$ and acts in the negative $z$-direction. Assume the fluid density depends only on depth and is given by the linear profile $\\rho(z)=\\rho_{0}\\left(1-\\alpha z\\right)$, where $\\rho_{0}>0$ and $\\alpha$ is a constant with dimensions of inverse length such that $\\rho(z)>0$ for all depths considered. Under the hydrostatic approximation appropriate for large-scale oceanic motions, the vertical momentum balance reduces to a balance between the vertical pressure gradient and gravity.\n\nStarting only from conservation of momentum and the hydrostatic approximation, derive and compute the explicit expression for the hydrostatic pressure $p(z)$ within the ocean ($z\\le \\eta$), enforcing the boundary condition $p(\\eta)=p_{s}$. Your final result must be a single closed-form analytic expression in terms of $z$, $\\eta$, $p_{s}$, $g$, $\\rho_{0}$, and $\\alpha$. Express the final pressure in Pascals (International System of Units).",
            "solution": "The appropriate fundamental base is the vertical component of the momentum equation for a Newtonian fluid under gravity. In the $z$-direction, with $z$ positive upward and gravity of magnitude $g$ acting downward, the exact vertical momentum equation is\n$$\n\\rho\\left(\\frac{\\partial w}{\\partial t}+u\\frac{\\partial w}{\\partial x}+v\\frac{\\partial w}{\\partial y}+w\\frac{\\partial w}{\\partial z}\\right)=-\\frac{\\partial p}{\\partial z}-\\rho g+\\text{viscous terms},\n$$\nwhere $u$, $v$, and $w$ are the velocity components. Under the hydrostatic approximation, valid for large horizontal scales and small vertical aspect ratios typical of the ocean interior, the vertical acceleration terms and vertical viscous terms are negligible compared to the pressure gradient and the weight of the fluid. The balance reduces to\n$$\n\\frac{\\partial p}{\\partial z}=-\\rho g.\n$$\nThis ordinary differential equation relates the vertical gradient of pressure to the local density. We are given a static, depth-dependent density profile\n$$\n\\rho(z)=\\rho_{0}\\left(1-\\alpha z\\right),\n$$\nwith constants $\\rho_{0}>0$ and $\\alpha$ (units of inverse length), and the surface boundary condition\n$$\np(\\eta)=p_{s}.\n$$\n\nTo compute $p(z)$ for $z\\le \\eta$, integrate the hydrostatic balance vertically from $z$ up to the free surface at $\\eta$:\n$$\n\\int_{z}^{\\eta}\\frac{\\partial p}{\\partial \\zeta}\\,\\mathrm{d}\\zeta=\\int_{z}^{\\eta}-\\rho(\\zeta) g\\,\\mathrm{d}\\zeta.\n$$\nThe left-hand side yields $p(\\eta)-p(z)$, so\n$$\np(\\eta)-p(z)=-g\\int_{z}^{\\eta}\\rho(\\zeta)\\,\\mathrm{d}\\zeta.\n$$\nUsing the boundary condition $p(\\eta)=p_{s}$, we rearrange to obtain\n$$\np(z)=p_{s}+g\\int_{z}^{\\eta}\\rho(\\zeta)\\,\\mathrm{d}\\zeta.\n$$\nSubstitute the given density profile:\n$$\np(z)=p_{s}+g\\int_{z}^{\\eta}\\rho_{0}\\left(1-\\alpha \\zeta\\right)\\,\\mathrm{d}\\zeta.\n$$\nEvaluate the integral explicitly:\n$$\n\\int_{z}^{\\eta}\\left(1-\\alpha \\zeta\\right)\\,\\mathrm{d}\\zeta=\\left[\\zeta-\\frac{\\alpha}{2}\\zeta^{2}\\right]_{z}^{\\eta}=\\left(\\eta-\\frac{\\alpha}{2}\\eta^{2}\\right)-\\left(z-\\frac{\\alpha}{2}z^{2}\\right)=(\\eta-z)-\\frac{\\alpha}{2}\\left(\\eta^{2}-z^{2}\\right).\n$$\nTherefore,\n$$\np(z)=p_{s}+\\rho_{0}g\\left[(\\eta-z)-\\frac{\\alpha}{2}\\left(\\eta^{2}-z^{2}\\right)\\right],\\quad z\\le \\eta.\n$$\n\nThis expression satisfies the hydrostatic balance and the surface boundary condition by construction. A dimensional check confirms consistency: the bracket has dimension of length, $\\rho_{0}g$ has dimension of pressure per unit length, and thus the product is a pressure. The domain of validity requires $\\rho(z)=\\rho_{0}\\left(1-\\alpha z\\right)>0$ across the water column considered. In the special case $\\alpha=0$ (uniform density), the expression reduces to the familiar linear hydrostatic pressure $p(z)=p_{s}+\\rho_{0}g(\\eta-z)$.\n\nThus, the explicit hydrostatic pressure profile in Pascals is\n$$\np(z)=p_{s}+\\rho_{0}g\\left[(\\eta-z)-\\frac{\\alpha}{2}\\left(\\eta^{2}-z^{2}\\right)\\right].\n$$",
            "answer": "$$\\boxed{p_{s}+\\rho_{0}g\\left[(\\eta-z)-\\frac{\\alpha}{2}\\left(\\eta^{2}-z^{2}\\right)\\right]}$$"
        },
        {
            "introduction": "The hydrostatic approximation is a powerful simplification, but it is crucial to know its limits. This exercise provides a rigorous method to quantify its validity by comparing the dispersion relations of internal gravity waves calculated with and without the approximation . By deriving the key parameter that governs its accuracy—the aspect ratio of the motion—you will develop a critical tool for assessing when more complex nonhydrostatic models are required.",
            "id": "3815078",
            "problem": "Consider a stably stratified, inviscid, rotating ocean modeled by the Boussinesq approximation with constant background density $\\rho_0$, constant buoyancy frequency $N$, and constant Coriolis parameter $f$. Let $\\boldsymbol{u} = (u,v,w)$ denote the velocity field, $p$ the pressure perturbation, and $b$ the buoyancy perturbation. Starting from the linearized rotating Boussinesq equations,\n$$\n\\frac{\\partial u}{\\partial t} - f v = -\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial x}, \\quad\n\\frac{\\partial v}{\\partial t} + f u = -\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial y}, \\quad\n\\frac{\\partial w}{\\partial t} = -\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial z} + b,\n$$\n$$\n\\frac{\\partial b}{\\partial t} + N^2 w = 0, \\quad\n\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} + \\frac{\\partial w}{\\partial z} = 0,\n$$\nuse a plane-wave ansatz with horizontal wavenumber magnitude $k_h = \\sqrt{k_x^2 + k_y^2}$, vertical wavenumber $m$, and frequency $\\omega$ to derive the dispersion relation for Internal Gravity Waves (IGWs) without invoking the hydrostatic approximation. Then, obtain the corresponding hydrostatic-limit dispersion relation by neglecting vertical acceleration in the vertical momentum equation.\n\nDefine the hydrostatic relative frequency error as\n$$\n\\delta \\equiv \\frac{\\omega_h - \\omega}{\\omega},\n$$\nwhere $\\omega$ is the nonhydrostatic IGW frequency and $\\omega_h$ is the hydrostatic-limit IGW frequency for the same $(k_h,m,N,f)$.\n\n1. For the specified parameters $k_h = 3.0 \\times 10^{-3}\\ \\text{m}^{-1}$, $m = 1.0 \\times 10^{-2}\\ \\text{m}^{-1}$, $N = 1.0 \\times 10^{-2}\\ \\text{s}^{-1}$, and $f = 1.0 \\times 10^{-4}\\ \\text{s}^{-1}$, compute the value of $\\delta$. Round your answer to four significant figures and express it as a dimensionless decimal (no units).\n\n2. Determine the parameter range where the hydrostatic approximation yields a relative error less than $0.05$ by finding the exact closed-form analytical expression for the upper bound on the non-dimensional ratio $k_h/m$. Express this bound as a symbolic expression in terms of the number $0.05$ without numerical approximation. Your final answer must include both the computed $\\delta$ from part 1 and the exact symbolic bound from part 2, presented as dimensionless quantities (no units).",
            "solution": "The problem requires the derivation of the dispersion relations for non-hydrostatic and hydrostatic internal gravity waves (IGWs), and then using these to compute a relative frequency error and determine a validity range for the hydrostatic approximation.\n\nThe starting point is the set of linearized, rotating Boussinesq equations in a fluid with constant background density $\\rho_0$, buoyancy frequency $N$, and Coriolis parameter $f$:\n$$ \\frac{\\partial u}{\\partial t} - f v = -\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial x} \\quad (1) $$\n$$ \\frac{\\partial v}{\\partial t} + f u = -\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial y} \\quad (2) $$\n$$ \\frac{\\partial w}{\\partial t} = -\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial z} + b \\quad (3) $$\n$$ \\frac{\\partial b}{\\partial t} + N^2 w = 0 \\quad (4) $$\n$$ \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} + \\frac{\\partial w}{\\partial z} = 0 \\quad (5) $$\nWe assume plane-wave solutions of the form $A = \\hat{A} \\exp[i(k_x x + k_y y + m z - \\omega t)]$, where $\\hat{A}$ is the complex amplitude. This transforms the partial derivatives as follows: $\\frac{\\partial}{\\partial t} \\to -i\\omega$, $\\frac{\\partial}{\\partial x} \\to ik_x$, $\\frac{\\partial}{\\partial y} \\to ik_y$, and $\\frac{\\partial}{\\partial z} \\to im$.\n\nSubstituting this ansatz into the governing equations yields a system of algebraic equations for the amplitudes (denoted by hats):\n$$ -i\\omega \\hat{u} - f \\hat{v} = -\\frac{ik_x}{\\rho_0} \\hat{p} \\quad (1') $$\n$$ -i\\omega \\hat{v} + f \\hat{u} = -\\frac{ik_y}{\\rho_0} \\hat{p} \\quad (2') $$\n$$ -i\\omega \\hat{w} = -\\frac{im}{\\rho_0} \\hat{p} + \\hat{b} \\quad (3') $$\n$$ -i\\omega \\hat{b} + N^2 \\hat{w} = 0 \\quad (4') $$\n$$ ik_x \\hat{u} + ik_y \\hat{v} + im \\hat{w} = 0 \\quad (5') $$\n\n**1. Derivation of the Non-Hydrostatic Dispersion Relation ($\\omega$)**\n\nFirst, we solve for the amplitudes $\\hat{u}$, $\\hat{v}$, and $\\hat{w}$ in terms of $\\hat{p}$.\nFrom the horizontal momentum equations $(1')$ and $(2')$, we can solve for $\\hat{u}$ and $\\hat{v}$:\n$$ \\begin{pmatrix} -i\\omega & -f \\\\ f & -i\\omega \\end{pmatrix} \\begin{pmatrix} \\hat{u} \\\\ \\hat{v} \\end{pmatrix} = -\\frac{i}{\\rho_0} \\hat{p} \\begin{pmatrix} k_x \\\\ k_y \\end{pmatrix} $$\nInverting the matrix gives:\n$$ \\begin{pmatrix} \\hat{u} \\\\ \\hat{v} \\end{pmatrix} = \\frac{1}{f^2 - \\omega^2} \\begin{pmatrix} -i\\omega & f \\\\ -f & -i\\omega \\end{pmatrix} \\left(-\\frac{i}{\\rho_0} \\hat{p} \\begin{pmatrix} k_x \\\\ k_y \\end{pmatrix} \\right) = \\frac{\\hat{p}}{\\rho_0(\\omega^2 - f^2)} \\begin{pmatrix} \\omega k_x + i f k_y \\\\ \\omega k_y - i f k_x \\end{pmatrix} $$\nThe horizontal velocity divergence term in $(5')$ is $ik_x \\hat{u} + ik_y \\hat{v}$:\n$$ ik_x \\hat{u} + ik_y \\hat{v} = \\frac{i\\hat{p}}{\\rho_0(\\omega^2-f^2)} \\left[ k_x(\\omega k_x + ifk_y) + k_y(\\omega k_y - ifk_x) \\right] = \\frac{i\\hat{p}}{\\rho_0(\\omega^2-f^2)} \\left[ \\omega(k_x^2+k_y^2) \\right] = \\frac{i\\omega k_h^2 \\hat{p}}{\\rho_0(\\omega^2-f^2)} $$\nwhere $k_h^2 = k_x^2 + k_y^2$.\n\nFrom the buoyancy equation $(4')$, we express $\\hat{b}$ in terms of $\\hat{w}$:\n$$ \\hat{b} = \\frac{N^2}{i\\omega}\\hat{w} $$\nSubstitute this into the vertical momentum equation $(3')$:\n$$ -i\\omega \\hat{w} = -\\frac{im}{\\rho_0} \\hat{p} + \\frac{N^2}{i\\omega}\\hat{w} $$\nRearranging to solve for $\\hat{w}$:\n$$ \\hat{w} \\left(-i\\omega - \\frac{N^2}{i\\omega}\\right) = -\\frac{im}{\\rho_0}\\hat{p} \\implies \\hat{w} \\left(\\frac{\\omega^2 - N^2}{-i\\omega}\\right) = -\\frac{im}{\\rho_0}\\hat{p} \\implies \\hat{w} = \\frac{m\\omega \\hat{p}}{\\rho_0(N^2 - \\omega^2)} $$\nA careful check of signs:\n$\\frac{N^2}{i\\omega}\\hat{w} + i\\omega\\hat{w} = \\frac{im}{\\rho_0}\\hat{p} \\implies \\hat{w}(\\frac{N^2-\\omega^2}{i\\omega}) = \\frac{im}{\\rho_0}\\hat{p} \\implies \\hat{w} = -\\frac{m\\omega\\hat{p}}{\\rho_0(N^2-\\omega^2)}$. This seems correct.\n\nNow, substitute the expressions for the velocity components into the continuity equation $(5')$:\n$$ \\frac{i\\omega k_h^2 \\hat{p}}{\\rho_0(\\omega^2-f^2)} + im \\left( -\\frac{m\\omega \\hat{p}}{\\rho_0(N^2 - \\omega^2)} \\right) = 0 $$\nFor a non-trivial solution $(\\hat{p} \\neq 0)$, and for waves $(\\omega \\neq 0)$, we can divide by $\\frac{i\\omega\\hat{p}}{\\rho_0}$:\n$$ \\frac{k_h^2}{\\omega^2-f^2} - \\frac{m^2}{N^2 - \\omega^2} = 0 $$\nRearranging gives the non-hydrostatic dispersion relation:\n$$ k_h^2(N^2 - \\omega^2) = m^2(\\omega^2 - f^2) \\implies k_h^2 N^2 - k_h^2 \\omega^2 = m^2 \\omega^2 - m^2 f^2 $$\n$$ \\omega^2(k_h^2 + m^2) = k_h^2 N^2 + m^2 f^2 $$\n$$ \\omega^2 = \\frac{k_h^2 N^2 + m^2 f^2}{k_h^2 + m^2} $$\n\n**2. Derivation of the Hydrostatic Dispersion Relation ($\\omega_h$)**\n\nThe hydrostatic approximation neglects vertical acceleration, so $\\frac{\\partial w}{\\partial t}=0$. Equation $(3)$ becomes a balance between the vertical pressure gradient and buoyancy:\n$$ 0 = -\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial z} + b \\implies 0 = -\\frac{im}{\\rho_0}\\hat{p} + \\hat{b} \\implies \\hat{b} = \\frac{im}{\\rho_0}\\hat{p} $$\nThe buoyancy equation $(4')$ is unchanged: $-i\\omega_h \\hat{b} + N^2 \\hat{w} = 0$. Substituting the hydrostatic expression for $\\hat{b}$:\n$$ -i\\omega_h \\left(\\frac{im}{\\rho_0}\\hat{p}\\right) + N^2\\hat{w} = 0 \\implies \\frac{\\omega_h m}{\\rho_0}\\hat{p} + N^2\\hat{w} = 0 \\implies \\hat{w} = -\\frac{m\\omega_h}{N^2\\rho_0}\\hat{p} $$\nThe continuity equation becomes:\n$$ \\frac{i\\omega_h k_h^2 \\hat{p}}{\\rho_0(\\omega_h^2 - f^2)} + im\\left(-\\frac{m\\omega_h}{N^2\\rho_0}\\hat{p}\\right) = 0 $$\nDividing by $\\frac{i\\omega_h\\hat{p}}{\\rho_0}$ (for $\\omega_h \\neq 0, \\hat{p} \\neq 0$):\n$$ \\frac{k_h^2}{\\omega_h^2 - f^2} - \\frac{m^2}{N^2} = 0 \\implies \\omega_h^2 - f^2 = \\frac{k_h^2 N^2}{m^2} $$\nThis gives the hydrostatic dispersion relation:\n$$ \\omega_h^2 = f^2 + \\frac{k_h^2 N^2}{m^2} $$\n\n**3. Part 1: Calculation of the Relative Error $\\delta$**\n\nWe can find a direct relationship between $\\omega^2$ and $\\omega_h^2$:\n$$ \\omega^2 = \\frac{k_h^2 N^2 + m^2 f^2}{k_h^2 + m^2} = \\frac{m^2\\left(\\frac{k_h^2 N^2}{m^2} + f^2\\right)}{m^2\\left(\\frac{k_h^2}{m^2} + 1\\right)} = \\frac{\\omega_h^2}{1 + (k_h/m)^2} $$\nThus, $\\omega_h^2 = \\omega^2 \\left(1 + (k_h/m)^2\\right)$, which implies $\\omega_h = \\omega \\sqrt{1 + (k_h/m)^2}$, since frequencies are positive.\nThe relative frequency error $\\delta$ is defined as $\\delta = \\frac{\\omega_h - \\omega}{\\omega}$.\n$$ \\delta = \\frac{\\omega \\sqrt{1 + (k_h/m)^2} - \\omega}{\\omega} = \\sqrt{1 + (k_h/m)^2} - 1 $$\nThis expression for $\\delta$ notably depends only on the aspect ratio of the wavenumbers, $k_h/m$.\nGiven the parameters:\n$k_h = 3.0 \\times 10^{-3}\\ \\text{m}^{-1}$\n$m = 1.0 \\times 10^{-2}\\ \\text{m}^{-1}$\nThe ratio is:\n$$ \\frac{k_h}{m} = \\frac{3.0 \\times 10^{-3}}{1.0 \\times 10^{-2}} = 0.3 $$\nSubstituting this into the expression for $\\delta$:\n$$ \\delta = \\sqrt{1 + (0.3)^2} - 1 = \\sqrt{1 + 0.09} - 1 = \\sqrt{1.09} - 1 $$\n$$ \\delta \\approx 1.04403065... - 1 = 0.04403065... $$\nRounding to four significant figures, we get $\\delta \\approx 0.04403$.\n\n**4. Part 2: Condition for Hydrostatic Approximation Validity**\n\nWe need to find the upper bound on the ratio $k_h/m$ for which the relative error is less than $0.05$. So, we must solve the inequality $|\\delta| < 0.05$. Since $\\omega_h \\ge \\omega$, we have $\\delta \\ge 0$, so the condition is simply $\\delta < 0.05$.\n$$ \\sqrt{1 + (k_h/m)^2} - 1 < 0.05 $$\n$$ \\sqrt{1 + (k_h/m)^2} < 1.05 $$\nSince both sides are positive, we can square them without changing the inequality's direction:\n$$ 1 + (k_h/m)^2 < (1.05)^2 $$\n$$ (k_h/m)^2 < (1.05)^2 - 1 $$\n$$ (k_h/m)^2 < (1 + 0.05)^2 - 1 = (1 + 2(0.05) + (0.05)^2) - 1 = 2(0.05) + (0.05)^2 $$\nSince $k_h/m$ is a ratio of magnitudes and thus non-negative, we can take the square root:\n$$ \\frac{k_h}{m} < \\sqrt{2(0.05) + (0.05)^2} $$\nThe exact closed-form analytical expression for the upper bound on $k_h/m$ is therefore $\\sqrt{2(0.05) + (0.05)^2}$.\n\nThe problem requires a final answer containing both the numerical value for $\\delta$ and the symbolic bound.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.04403 & \\sqrt{2(0.05) + (0.05)^2} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Even where the hydrostatic assumption is physically appropriate, its implementation in numerical models can introduce significant artifacts, especially over sloping bathymetry. This final practice challenges you to design a numerical experiment to diagnose a classic problem in terrain-following coordinate models: the hydrostatic pressure gradient error . This computational exercise provides direct insight into a critical challenge faced by ocean modelers and highlights how discretization choices can impact simulation accuracy.",
            "id": "3815103",
            "problem": "You are asked to design and implement a numerical experiment that isolates discretization-induced hydrostatic pressure gradient errors in a one-dimensional resting ocean with stable vertical stratification and sloping bathymetry, using terrain-following layers. The experiment must be built from first principles and must produce quantifiable diagnostics.\n\nStart from the vertical momentum equation under the hydrostatic approximation: for pressure $p(z)$ and density $\\rho(z)$ in a resting ocean under gravitational acceleration $g$, the vertical balance is given by $ \\frac{\\partial p}{\\partial z} = - \\rho g $. In a physically consistent resting state where density depends only on vertical position $z$, the horizontal pressure gradient at any fixed physical depth $z$ must be identically zero: $ \\frac{\\partial p}{\\partial x} \\big|_{z} = 0 $. Terrain-following (sigma) coordinates $s \\in [-1,0]$ transform the vertical coordinate according to $ s = z/H(x) $ where $H(x)$ is the local bottom depth, here taken as a straight line $ H(x) = H_0 + \\alpha x $ with slope $ \\alpha = dH/dx $ and $x \\in [0,L_x] $. In discrete numerical implementations that compute pressure by vertically integrating the hydrostatic balance along terrain-following layers and then form horizontal differences at constant $s$, the cancellation needed for $ \\frac{\\partial p}{\\partial x}\\big|_{z} = 0 $ is broken, producing a non-zero apparent horizontal pressure gradient. This apparent gradient is the hydrostatic pressure gradient error that you must quantify.\n\nYour program should:\n- Construct a one-dimensional domain with $N_x$ uniformly spaced grid points covering $x \\in [0,L_x]$ and compute the bathymetry $H(x) = H_0 + \\alpha x$.\n- Define $N_s$ terrain-following layers using midpoints $ s_k = -\\frac{k-0.5}{N_s} $ for $k = 1,\\dots,N_s$, so that the physical depth at layer $k$ in column $i$ is $ z_{i,k} = s_k H(x_i) $ and the layer thickness in column $i$ is $ \\Delta z_i = H(x_i)/N_s $ (constant within that column).\n- Specify a stable depth-dependent density profile that produces realistic ocean stratification. Use the polynomial form $ \\rho(z) = \\rho_0 + a_1 (-z) + a_2 (-z)^2 $ with $z \\le 0$, where $ \\rho_0 $ is a constant reference density, $ a_1 $ controls the linear stratification strength, and $ a_2 $ sets the curvature with depth. This form ensures stable stratification (i.e., density increases with depth, or $\\frac{\\partial \\rho}{\\partial z} \\le 0$) for physically plausible choices of $a_1, a_2 > 0$ and $z \\le 0$.\n- Compute the discrete hydrostatic pressure $p_{i,k}$ at each column $i$ and terrain-following layer $k$ by vertically integrating downward from the surface using the discrete hydrostatic balance. Approximate the integral by a layerwise sum $ p_{i,k} = g \\sum_{m=1}^{k} \\rho\\!\\left(z_{i,m}\\right) \\Delta z_i $, which is consistent with the hydrostatic approximation and typical layerwise discretizations.\n- Form the apparent discrete horizontal pressure gradient at constant $s$ by finite differences between adjacent columns at the same layer index: $ \\left.\\frac{\\partial p}{\\partial x}\\right|_{s_k}(x_{i+\\frac{1}{2}}) \\approx \\frac{p_{i+1,k} - p_{i,k}}{\\Delta x} $. Convert this to the apparent horizontal acceleration $ a_{i+\\frac{1}{2},k} = - \\frac{1}{\\rho_0} \\left.\\frac{\\partial p}{\\partial x}\\right|_{s_k} $, which should vanish identically in the continuous, physically consistent hydrostatic state but will not do so under this discrete terrain-following procedure.\n- Quantify the error using diagnostics over all interior horizontal points and all terrain-following layers:\n    - Root Mean Square (RMS) acceleration $ a_{\\mathrm{RMS}} = \\sqrt{ \\frac{1}{M} \\sum_{i,k} a_{i+\\frac{1}{2},k}^2 } $ where $M$ is the total number of evaluated points.\n    - Maximum absolute acceleration $ a_{\\mathrm{max}} = \\max_{i,k} \\left| a_{i+\\frac{1}{2},k} \\right| $.\nBoth diagnostics must be expressed in meters per second squared ($\\mathrm{m}/\\mathrm{s}^2$). No other units are permitted in the final outputs.\n\nImplement the above and evaluate the following test suite to ensure coverage:\n- Case A (general, moderate slope and stratification curvature): $ H_0 = 4000\\,\\mathrm{m} $, $ L_x = 100{,}000\\,\\mathrm{m} $, $ \\alpha = 1\\times 10^{-3}\\,\\mathrm{m}/\\mathrm{m} $, $ N_s = 40 $, $ \\rho_0 = 1027\\,\\mathrm{kg}/\\mathrm{m}^3 $, $ a_1 = 5\\times 10^{-4}\\,\\mathrm{kg}/\\mathrm{m}^4 $, $ a_2 = 1\\times 10^{-7}\\,\\mathrm{kg}/\\mathrm{m}^5 $, $ N_x = 101 $.\n- Case B (boundary condition: zero slope): same as Case A but $ \\alpha = 0 $.\n- Case C (edge case: steep slope): same as Case A but $ \\alpha = 5\\times 10^{-3}\\,\\mathrm{m}/\\mathrm{m} $.\n- Case D (edge case: coarse vertical resolution and stronger curvature): same as Case A but $ N_s = 10 $, $ a_2 = 2\\times 10^{-7}\\,\\mathrm{kg}/\\mathrm{m}^5 $.\n- Case E (diagnostic: no stratification, constant density): same as Case A but $ a_1 = 0 $ and $ a_2 = 0 $.\n\nYour program must produce a single line of output containing the diagnostics for all test cases as a comma-separated list of floats enclosed in square brackets, ordered as $[a_{\\mathrm{RMS}}^{(A)}, a_{\\mathrm{max}}^{(A)}, a_{\\mathrm{RMS}}^{(B)}, a_{\\mathrm{max}}^{(B)}, \\dots]$. Each float represents an acceleration in $\\mathrm{m}/\\mathrm{s}^2$. No additional text may be printed.",
            "solution": "The objective of this problem is to design and implement a numerical experiment to quantify the hydrostatic pressure gradient error, a known artifact in computational ocean models that use terrain-following coordinates. We will develop a one-dimensional model of a resting, stratified ocean over a sloping bottom and compute the spurious horizontal accelerations that arise from the numerical discretization.\n\nThe fundamental principle being investigated is the misrepresentation of the horizontal pressure gradient in a transformed coordinate system. In a physically resting ocean ($u=v=w=0$), the horizontal forces must be perfectly balanced. The dominant horizontal force is the pressure gradient. In a Cartesian coordinate system with the vertical axis $z$ pointing upwards, the pressure $p$ in a stratified fluid at rest is a function of depth only, $p=p(z)$. Consequently, the true horizontal pressure gradient on any level surface (constant $z$) is identically zero: $\\frac{\\partial p}{\\partial x} \\big|_{z} = 0$.\n\nNumerical ocean models often use a terrain-following coordinate, such as the sigma-coordinate $s = z/H(x)$, where $H(x)$ is the local ocean depth. This transforms the irregular physical domain into a rectangular computational domain, simplifying grid generation and boundary condition application. However, taking derivatives in this transformed system can introduce errors. Specifically, the discrete horizontal pressure gradient is computed between adjacent grid cells at the same sigma-level $s_k$. This approximates $\\frac{\\partial p}{\\partial x} \\big|_{s}$, not $\\frac{\\partial p}{\\partial x} \\big|_{z}$.\n\nThe relationship between these two gradients is given by the chain rule:\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = \\left.\\frac{\\partial p}{\\partial x}\\right|_{s} - \\left.\\frac{\\partial p}{\\partial z}\\right|_{x} \\left.\\frac{\\partial z}{\\partial x}\\right|_{s}\n$$\nSince the true gradient $\\frac{\\partial p}{\\partial x} \\big|_{z}$ is zero in a resting ocean, the numerically computed gradient is entirely an error term:\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{s} = \\left.\\frac{\\partial p}{\\partial z}\\right|_{x} \\left.\\frac{\\partial z}{\\partial x}\\right|_{s}\n$$\nUsing the hydrostatic balance, $\\frac{\\partial p}{\\partial z} = -\\rho(z)g$, and the coordinate definition, $\\frac{\\partial z}{\\partial x}|_{s} = s \\frac{dH}{dx} = s\\alpha$, the spurious pressure gradient is:\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{s} = -\\rho(z) g s \\alpha\n$$\nThis non-zero gradient induces a spurious horizontal acceleration $a = -\\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial x}|_{s}$, which can generate artificial currents and degrade the simulation's accuracy. This problem asks us to quantify this error through direct numerical simulation.\n\nThe gravitational acceleration $g$ is not specified, so we will use the standard value $g = 9.81 \\, \\mathrm{m}/\\mathrm{s}^2$.\n\nThe numerical experiment is constructed as follows:\n\n1.  **Domain and Grid Discretization**: A one-dimensional horizontal domain $x \\in [0, L_x]$ is discretized into $N_x$ uniformly spaced points $x_i = i \\cdot \\Delta x$ for $i=0, \\dots, N_x-1$, where the grid spacing is $\\Delta x = L_x / (N_x - 1)$. At each point $x_i$, the ocean depth is given by the linear bathymetry function $H(x_i) = H_0 + \\alpha x_i$.\n\n2.  **Vertical Coordinate System**: The vertical domain at each horizontal position $x_i$ is discretized into $N_s$ terrain-following layers. The layers are defined by their midpoints in sigma-space, $s_k = -\\frac{k-0.5}{N_s}$ for $k = 1, \\dots, N_s$. The physical depth $z$ corresponding to a given layer $k$ and column $i$ is $z_{i,k} = s_k H(x_i)$. The thickness of each layer within a column $i$ is uniform, given by $\\Delta z_i = H(x_i) / N_s$.\n\n3.  **Density Field Calculation**: The density $\\rho(z)$ is defined by the polynomial $\\rho(z) = \\rho_0 + a_1(-z) + a_2(-z)^2$. We compute the density at the midpoint of each layer in each column, $\\rho_{i,k} = \\rho(z_{i,k})$, creating a two-dimensional array of density values.\n\n4.  **Discrete Hydrostatic Pressure Integration**: The pressure $p_{i,k}$ at each layer $k$ in column $i$ is calculated by integrating the hydrostatic equation from the surface ($z=0$, where $p=0$) downward. The problem specifies a discrete summation that approximates this integral, representing the pressure at the bottom interface of layer $k$:\n    $$\n    p_{i,k} = g \\sum_{m=1}^{k} \\rho_{i,m} \\Delta z_i\n    $$\n    This calculation is performed for all layers $k$ in every column $i$. This is efficiently implemented using a cumulative sum over the vertical (layer) axis.\n\n5.  **Spurious Acceleration Calculation**: The core of the experiment is to compute the spurious horizontal pressure gradient along constant sigma-surfaces. Using a centered finite difference, the gradient between columns $i$ and $i+1$ at layer $k$ is:\n    $$\n    \\left.\\frac{\\partial p}{\\partial x}\\right|_{s_k}(x_{i+\\frac{1}{2}}) \\approx \\frac{p_{i+1,k} - p_{i,k}}{\\Delta x}\n    $$\n    This gradient is then converted into a spurious acceleration using the reference density $\\rho_0$:\n    $$\n    a_{i+\\frac{1}{2},k} = - \\frac{1}{\\rho_0} \\frac{p_{i+1,k} - p_{i,k}}{\\Delta x}\n    $$\n    This is computed for all interior horizontal grid cell interfaces ($i=0, \\dots, N_x-2$) and all vertical layers ($k=1, \\dots, N_s$).\n\n6.  **Error Diagnostics**: To quantify the magnitude of the error, two metrics are calculated over the entire field of spurious accelerations:\n    -   The Root Mean Square (RMS) acceleration: $a_{\\mathrm{RMS}} = \\sqrt{ \\frac{1}{(N_x-1)N_s} \\sum_{i=0}^{N_x-2} \\sum_{k=1}^{N_s} a_{i+\\frac{1}{2},k}^2 }$.\n    -   The maximum absolute acceleration: $a_{\\mathrm{max}} = \\max_{i,k} \\left| a_{i+\\frac{1}{2},k} \\right|$.\n\nThese diagnostics provide a concise summary of the discretization error for each specified test case, allowing for systematic analysis of how factors like bathymetric slope, vertical resolution, and stratification strength influence the error's magnitude.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_hpe(params):\n    \"\"\"\n    Calculates the hydrostatic pressure gradient error diagnostics for a given set of parameters.\n\n    Args:\n        params (dict): A dictionary containing the model parameters for a single test case.\n\n    Returns:\n        tuple[float, float]: A tuple containing the RMS acceleration and max absolute acceleration.\n    \"\"\"\n    H0 = params['H0']\n    Lx = params['Lx']\n    alpha = params['alpha']\n    Ns = params['Ns']\n    rho0 = params['rho0']\n    a1 = params['a1']\n    a2 = params['a2']\n    Nx = params['Nx']\n    \n    g = 9.81  # Standard gravitational acceleration in m/s^2\n\n    # 1. Domain and Grid Discretization\n    x = np.linspace(0, Lx, Nx)\n    delta_x = Lx / (Nx - 1)\n    H = H0 + alpha * x\n\n    # 2. Vertical Coordinate System\n    # s_k are the sigma-coordinates of the layer midpoints\n    k = np.arange(1, Ns + 1)\n    s_k = -(k - 0.5) / Ns\n    \n    # Create 2D arrays for vectorized calculations using broadcasting.\n    # Shapes: H_2d -> (Nx, 1), s_k_2d -> (1, Ns)\n    H_2d = H[:, np.newaxis]\n    s_k_2d = s_k[np.newaxis, :]\n    \n    # Physical depth z at each grid point (i, k)\n    # Shape: (Nx, Ns)\n    z_ik = H_2d * s_k_2d\n    \n    # Layer thickness for each column i\n    # Shape: (Nx, 1)\n    delta_z_i = H_2d / Ns\n    \n    # 3. Density Field Calculation\n    # Density at each grid point (i, k)\n    # Shape: (Nx, Ns)\n    rho_ik = rho0 + a1 * (-z_ik) + a2 * (-z_ik)**2\n    \n    # 4. Discrete Hydrostatic Pressure Integration\n    # The term to be summed for pressure calculation\n    pressure_integrand = g * rho_ik * delta_z_i\n    \n    # Vertically integrate using cumulative sum along the k-axis (axis=1)\n    # p_ik is the pressure at the bottom interface of layer k in column i\n    # Shape: (Nx, Ns)\n    p_ik = np.cumsum(pressure_integrand, axis=1)\n\n    # 5. Spurious Acceleration Calculation\n    # Compute horizontal pressure difference along constant s-surfaces\n    # np.diff operates along axis=0 (the x-dimension)\n    # Shape: (Nx-1, Ns)\n    dp = np.diff(p_ik, axis=0)\n    \n    # The spurious acceleration field\n    accel = - (1 / rho0) * (dp / delta_x)\n\n    # 6. Error Diagnostics\n    # Special case: if there's no error, avoid numpy warnings with empty arrays\n    if accel.size == 0:\n        return 0.0, 0.0\n\n    a_rms = np.sqrt(np.mean(accel**2))\n    a_max = np.max(np.abs(accel))\n\n    return a_rms, a_max\n\ndef solve():\n    \"\"\"\n    Defines, runs, and formats the output for all test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: general, moderate slope and stratification curvature\n        {'H0': 4000.0, 'Lx': 100000.0, 'alpha': 1e-3, 'Ns': 40, 'rho0': 1027.0, 'a1': 5e-4, 'a2': 1e-7, 'Nx': 101},\n        # Case B: boundary condition: zero slope\n        {'H0': 4000.0, 'Lx': 100000.0, 'alpha': 0.0, 'Ns': 40, 'rho0': 1027.0, 'a1': 5e-4, 'a2': 1e-7, 'Nx': 101},\n        # Case C: edge case: steep slope\n        {'H0': 4000.0, 'Lx': 100000.0, 'alpha': 5e-3, 'Ns': 40, 'rho0': 1027.0, 'a1': 5e-4, 'a2': 1e-7, 'Nx': 101},\n        # Case D: edge case: coarse vertical resolution and stronger curvature\n        {'H0': 4000.0, 'Lx': 100000.0, 'alpha': 1e-3, 'Ns': 10, 'rho0': 1027.0, 'a1': 5e-4, 'a2': 2e-7, 'Nx': 101},\n        # Case E: diagnostic: no stratification, constant density\n        {'H0': 4000.0, 'Lx': 100000.0, 'alpha': 1e-3, 'Ns': 40, 'rho0': 1027.0, 'a1': 0.0, 'a2': 0.0, 'Nx': 101},\n    ]\n\n    results = []\n    for params in test_cases:\n        a_rms, a_max = calculate_hpe(params)\n        results.extend([a_rms, a_max])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}