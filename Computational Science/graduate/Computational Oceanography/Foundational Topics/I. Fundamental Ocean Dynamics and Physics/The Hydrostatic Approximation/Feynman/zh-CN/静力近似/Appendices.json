{
    "hands_on_practices": [
        {
            "introduction": "静力平衡近似将垂直动量平衡简化为压力梯度与流体重量之间的直接关系。这个基础练习让您能够通过积分静力平衡方程$\\frac{\\partial p}{\\partial z} = -\\rho g$来应用这一原理，从而确定一个层结海洋中的压力剖面。这项实践对于理解大尺度海洋系统中压力的结构至关重要。",
            "id": "3815116",
            "problem": "考虑一个稳定分层的海水柱，在右手笛卡尔坐标系中进行描述，其中垂直坐标$z$指向上方，$z=0$处为平均海平面。自由表面位于 $z=\\eta$ 处，其中 $\\eta$ 可以不为零，自由表面的大气压（或指定压力）为 $p(\\eta)=p_{s}$。重力大小恒定为 $g$，作用于负$z$方向。假设流体密度仅取决于深度，并由线性剖面 $\\rho(z)=\\rho_{0}\\left(1-\\alpha z\\right)$ 给出，其中 $\\rho_{0}>0$，$\\alpha$ 是一个量纲为长度倒数的常数，且对于所考虑的所有深度，$\\rho(z)>0$ 均成立。在适用于大尺度海洋运动的静水压近似下，垂直动量平衡简化为垂直压力梯度与重力之间的平衡。\n\n仅从动量守恒和静水压近似出发，推导并计算海洋内部（$z\\le \\eta$）的静水压 $p(z)$ 的显式表达式，并施加边界条件 $p(\\eta)=p_{s}$。您的最终结果必须是单个用 $z$、$\\eta$、$p_{s}$、$g$、$\\rho_{0}$ 和 $\\alpha$ 表示的闭式解析表达式。最终压力以帕斯卡（国际单位制）表示。",
            "solution": "合适的理论基础是重力作用下牛顿流体动量方程的垂直分量。在$z$方向上，$z$正方向朝上，大小为$g$的重力作用向下，精确的垂直动量方程为\n$$\n\\rho\\left(\\frac{\\partial w}{\\partial t}+u\\frac{\\partial w}{\\partial x}+v\\frac{\\partial w}{\\partial y}+w\\frac{\\partial w}{\\partial z}\\right)=-\\frac{\\partial p}{\\partial z}-\\rho g+\\text{viscous terms},\n$$\n其中 $u$、$v$ 和 $w$ 是速度分量。在静水压近似下，该近似对海洋内部典型的大水平尺度和小垂直高宽比有效，垂直加速度项和垂直粘性项与压力梯度及流体重量相比可以忽略不计。平衡关系简化为\n$$\n\\frac{\\partial p}{\\partial z}=-\\rho g.\n$$\n这个常微分方程将压力的垂直梯度与局部密度联系起来。给定一个静态的、依赖于深度的密度剖面\n$$\n\\rho(z)=\\rho_{0}\\left(1-\\alpha z\\right),\n$$\n其中 $\\rho_{0}>0$ 和 $\\alpha$（单位为长度的倒数）为常数，以及表面边界条件\n$$\np(\\eta)=p_{s}.\n$$\n\n为计算 $z\\le \\eta$ 时的 $p(z)$，我们将静水压平衡方程从 $z$ 处沿垂直方向积分到自由表面 $\\eta$ 处：\n$$\n\\int_{z}^{\\eta}\\frac{\\partial p}{\\partial \\zeta}\\,\\mathrm{d}\\zeta=\\int_{z}^{\\eta}-\\rho(\\zeta) g\\,\\mathrm{d}\\zeta.\n$$\n左侧积分为 $p(\\eta)-p(z)$，因此\n$$\np(\\eta)-p(z)=-g\\int_{z}^{\\eta}\\rho(\\zeta)\\,\\mathrm{d}\\zeta.\n$$\n使用边界条件 $p(\\eta)=p_{s}$，我们重新整理可得\n$$\np(z)=p_{s}+g\\int_{z}^{\\eta}\\rho(\\zeta)\\,\\mathrm{d}\\zeta.\n$$\n代入给定的密度剖面：\n$$\np(z)=p_{s}+g\\int_{z}^{\\eta}\\rho_{0}\\left(1-\\alpha \\zeta\\right)\\,\\mathrm{d}\\zeta.\n$$\n显式地计算该积分：\n$$\n\\int_{z}^{\\eta}\\left(1-\\alpha \\zeta\\right)\\,\\mathrm{d}\\zeta=\\left[\\zeta-\\frac{\\alpha}{2}\\zeta^{2}\\right]_{z}^{\\eta}=\\left(\\eta-\\frac{\\alpha}{2}\\eta^{2}\\right)-\\left(z-\\frac{\\alpha}{2}z^{2}\\right)=(\\eta-z)-\\frac{\\alpha}{2}\\left(\\eta^{2}-z^{2}\\right).\n$$\n因此，\n$$\np(z)=p_{s}+\\rho_{0}g\\left[(\\eta-z)-\\frac{\\alpha}{2}\\left(\\eta^{2}-z^{2}\\right)\\right],\\quad z\\le \\eta.\n$$\n\n根据其构造过程，该表达式满足静水压平衡和表面边界条件。量纲检查证实了其一致性：方括号内的量纲为长度，$\\rho_{0}g$ 的量纲为单位长度上的压力，因此两者的乘积是压力。其有效范围要求在所考虑的整个水柱中 $\\rho(z)=\\rho_{0}\\left(1-\\alpha z\\right)>0$。在 $\\alpha=0$（均匀密度）的特殊情况下，该表达式简化为我们熟悉的线性静水压 $p(z)=p_{s}+\\rho_{0}g(\\eta-z)$。\n\n因此，以帕斯卡为单位的显式静水压剖面为\n$$\np(z)=p_{s}+\\rho_{0}g\\left[(\\eta-z)-\\frac{\\alpha}{2}\\left(\\eta^{2}-z^{2}\\right)\\right].\n$$",
            "answer": "$$\\boxed{p_{s}+\\rho_{0}g\\left[(\\eta-z)-\\frac{\\alpha}{2}\\left(\\eta^{2}-z^{2}\\right)\\right]}$$"
        },
        {
            "introduction": "静力平衡近似虽然功能强大，但也有其局限性，尤其是在垂直加速度变得不可忽略时。本练习通过比较静力与非静力模型中内重力波的行为，深入探讨了这些局限性。通过推导和比较它们的频散关系，您将定量地确定该近似在何种条件下会失效，这对于为特定的科学问题选择正确的模型是一项关键技能 。",
            "id": "3815078",
            "problem": "考虑一个稳定分层、无粘、旋转的海洋，采用Boussinesq近似进行建模，其背景密度$\\rho_0$、浮力频率$N$和科里奥利参数$f$均为常数。设$\\boldsymbol{u} = (u,v,w)$表示速度场，$p$为压力扰动，$b$为浮力扰动。从线性化的旋转Boussinesq方程组出发：\n$$\n\\frac{\\partial u}{\\partial t} - f v = -\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial x}, \\quad\n\\frac{\\partial v}{\\partial t} + f u = -\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial y}, \\quad\n\\frac{\\partial w}{\\partial t} = -\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial z} + b,\n$$\n$$\n\\frac{\\partial b}{\\partial t} + N^2 w = 0, \\quad\n\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} + \\frac{\\partial w}{\\partial z} = 0,\n$$\n使用一个平面波拟设，其水平波数大小为$k_h = \\sqrt{k_x^2 + k_y^2}$，垂直波数为$m$，频率为$\\omega$，推导内重力波（IGWs）的色散关系，推导过程不使用静水平衡近似。然后，通过在垂直动量方程中忽略垂直加速度，得到相应的静水平衡极限下的色散关系。\n\n定义静水平衡相对频率误差为\n$$\n\\delta \\equiv \\frac{\\omega_h - \\omega}{\\omega},\n$$\n其中$\\omega$是非静水平衡IGW频率，$\\omega_h$是对于相同$(k_h,m,N,f)$的静水平衡极限IGW频率。\n\n1. 对于给定参数$k_h = 3.0 \\times 10^{-3}\\ \\text{m}^{-1}$，$m = 1.0 \\times 10^{-2}\\ \\text{m}^{-1}$，$N = 1.0 \\times 10^{-2}\\ \\text{s}^{-1}$，以及$f = 1.0 \\times 10^{-4}\\ \\text{s}^{-1}$，计算$\\delta$的值。将您的答案四舍五入到四位有效数字，并以无量纲小数形式表示（无单位）。\n\n2. 通过找到无量纲比值$k_h/m$上界的精确闭式解析表达式，确定静水平衡近似产生小于$0.05$的相对误差的参数范围。将此上界表示为包含数字$0.05$的符号表达式，无需数值近似。您的最终答案必须同时包含第1部分计算出的$\\delta$和第2部分得到的精确符号上界，并以无量纲量形式呈现（无单位）。",
            "solution": "该问题要求推导非静水平衡和静水平衡内重力波（IGWs）的色散关系，然后利用这些关系计算相对频率误差，并确定静水平衡近似的有效范围。\n\n出发点是线性化的旋转Boussinesq方程组，该流体具有恒定的背景密度$\\rho_0$、浮力频率$N$和科里奥利参数$f$：\n$$ \\frac{\\partial u}{\\partial t} - f v = -\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial x} \\quad (1) $$\n$$ \\frac{\\partial v}{\\partial t} + f u = -\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial y} \\quad (2) $$\n$$ \\frac{\\partial w}{\\partial t} = -\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial z} + b \\quad (3) $$\n$$ \\frac{\\partial b}{\\partial t} + N^2 w = 0 \\quad (4) $$\n$$ \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} + \\frac{\\partial w}{\\partial z} = 0 \\quad (5) $$\n我们假设平面波解的形式为$A = \\hat{A} \\exp[i(k_x x + k_y y + m z - \\omega t)]$，其中$\\hat{A}$是复振幅。这将偏导数变换如下：$\\frac{\\partial}{\\partial t} \\to -i\\omega$，$\\frac{\\partial}{\\partial x} \\to ik_x$，$\\frac{\\partial}{\\partial y} \\to ik_y$，以及$\\frac{\\partial}{\\partial z} \\to im$。\n\n将此拟设代入控制方程，得到一个关于振幅（用帽子符号表示）的代数方程组：\n$$ -i\\omega \\hat{u} - f \\hat{v} = -\\frac{ik_x}{\\rho_0} \\hat{p} \\quad (1') $$\n$$ -i\\omega \\hat{v} + f \\hat{u} = -\\frac{ik_y}{\\rho_0} \\hat{p} \\quad (2') $$\n$$ -i\\omega \\hat{w} = -\\frac{im}{\\rho_0} \\hat{p} + \\hat{b} \\quad (3') $$\n$$ -i\\omega \\hat{b} + N^2 \\hat{w} = 0 \\quad (4') $$\n$$ ik_x \\hat{u} + ik_y \\hat{v} + im \\hat{w} = 0 \\quad (5') $$\n\n**1. 非静水平衡色散关系（$\\omega$）的推导**\n\n首先，我们用$\\hat{p}$表示振幅$\\hat{u}$、$\\hat{v}$和$\\hat{w}$。\n从水平动量方程$(1')$和$(2')$，我们可以解出$\\hat{u}$和$\\hat{v}$：\n$$ \\begin{pmatrix} -i\\omega  -f \\\\ f  -i\\omega \\end{pmatrix} \\begin{pmatrix} \\hat{u} \\\\ \\hat{v} \\end{pmatrix} = -\\frac{i}{\\rho_0} \\hat{p} \\begin{pmatrix} k_x \\\\ k_y \\end{pmatrix} $$\n对矩阵求逆可得：\n$$ \\begin{pmatrix} \\hat{u} \\\\ \\hat{v} \\end{pmatrix} = \\frac{1}{f^2 - \\omega^2} \\begin{pmatrix} -i\\omega  f \\\\ -f  -i\\omega \\end{pmatrix} \\left(-\\frac{i}{\\rho_0} \\hat{p} \\begin{pmatrix} k_x \\\\ k_y \\end{pmatrix} \\right) = \\frac{\\hat{p}}{\\rho_0(\\omega^2 - f^2)} \\begin{pmatrix} \\omega k_x + i f k_y \\\\ \\omega k_y - i f k_x \\end{pmatrix} $$\n$(5')$中的水平速度散度项为$ik_x \\hat{u} + ik_y \\hat{v}$：\n$$ ik_x \\hat{u} + ik_y \\hat{v} = \\frac{i\\hat{p}}{\\rho_0(\\omega^2-f^2)} \\left[ k_x(\\omega k_x + ifk_y) + k_y(\\omega k_y - ifk_x) \\right] = \\frac{i\\hat{p}}{\\rho_0(\\omega^2-f^2)} \\left[ \\omega(k_x^2+k_y^2) \\right] = \\frac{i\\omega k_h^2 \\hat{p}}{\\rho_0(\\omega^2-f^2)} $$\n其中$k_h^2 = k_x^2 + k_y^2$。\n\n从浮力方程$(4')$，我们用$\\hat{w}$表示$\\hat{b}$：\n$$ \\hat{b} = \\frac{N^2}{i\\omega}\\hat{w} $$\n将此代入垂直动量方程$(3')$：\n$$ -i\\omega \\hat{w} = -\\frac{im}{\\rho_0} \\hat{p} + \\frac{N^2}{i\\omega}\\hat{w} $$\n重新整理以求解$\\hat{w}$：\n$$ \\hat{w} \\left(-i\\omega - \\frac{N^2}{i\\omega}\\right) = -\\frac{im}{\\rho_0}\\hat{p} \\implies \\hat{w} \\left(\\frac{\\omega^2 - N^2}{-i\\omega}\\right) = -\\frac{im}{\\rho_0}\\hat{p} \\implies \\hat{w} = \\frac{m\\omega \\hat{p}}{\\rho_0(N^2 - \\omega^2)} $$\n仔细检查符号：\n$\\frac{N^2}{i\\omega}\\hat{w} + i\\omega\\hat{w} = \\frac{im}{\\rho_0}\\hat{p} \\implies \\hat{w}(\\frac{N^2-\\omega^2}{i\\omega}) = \\frac{im}{\\rho_0}\\hat{p} \\implies \\hat{w} = -\\frac{m\\omega\\hat{p}}{\\rho_0(N^2-\\omega^2)}$。这似乎是正确的。\n\n现在，将速度分量的表达式代入连续性方程$(5')$：\n$$ \\frac{i\\omega k_h^2 \\hat{p}}{\\rho_0(\\omega^2-f^2)} + im \\left( -\\frac{m\\omega \\hat{p}}{\\rho_0(N^2 - \\omega^2)} \\right) = 0 $$\n对于非平凡解$(\\hat{p} \\neq 0)$，并且对于波$(\\omega \\neq 0)$，我们可以除以$\\frac{i\\omega\\hat{p}}{\\rho_0}$：\n$$ \\frac{k_h^2}{\\omega^2-f^2} - \\frac{m^2}{N^2 - \\omega^2} = 0 $$\n重新整理得到非静水平衡色散关系：\n$$ k_h^2(N^2 - \\omega^2) = m^2(\\omega^2 - f^2) \\implies k_h^2 N^2 - k_h^2 \\omega^2 = m^2 \\omega^2 - m^2 f^2 $$\n$$ \\omega^2(k_h^2 + m^2) = k_h^2 N^2 + m^2 f^2 $$\n$$ \\omega^2 = \\frac{k_h^2 N^2 + m^2 f^2}{k_h^2 + m^2} $$\n\n**2. 静水平衡色散关系（$\\omega_h$）的推导**\n\n静水平衡近似忽略了垂直加速度，因此$\\frac{\\partial w}{\\partial t}=0$。方程$(3)$变为垂直压力梯度和浮力之间的平衡：\n$$ 0 = -\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial z} + b \\implies 0 = -\\frac{im}{\\rho_0}\\hat{p} + \\hat{b} \\implies \\hat{b} = \\frac{im}{\\rho_0}\\hat{p} $$\n浮力方程$(4')$保持不变：$-i\\omega_h \\hat{b} + N^2 \\hat{w} = 0$。代入$\\hat{b}$的静水平衡表达式：\n$$ -i\\omega_h \\left(\\frac{im}{\\rho_0}\\hat{p}\\right) + N^2\\hat{w} = 0 \\implies \\frac{\\omega_h m}{\\rho_0}\\hat{p} + N^2\\hat{w} = 0 \\implies \\hat{w} = -\\frac{m\\omega_h}{N^2\\rho_0}\\hat{p} $$\n连续性方程变为：\n$$ \\frac{i\\omega_h k_h^2 \\hat{p}}{\\rho_0(\\omega_h^2 - f^2)} + im\\left(-\\frac{m\\omega_h}{N^2\\rho_0}\\hat{p}\\right) = 0 $$\n除以$\\frac{i\\omega_h\\hat{p}}{\\rho_0}$（对于$\\omega_h \\neq 0, \\hat{p} \\neq 0$）：\n$$ \\frac{k_h^2}{\\omega_h^2 - f^2} - \\frac{m^2}{N^2} = 0 \\implies \\omega_h^2 - f^2 = \\frac{k_h^2 N^2}{m^2} $$\n这就得到了静水平衡色散关系：\n$$ \\omega_h^2 = f^2 + \\frac{k_h^2 N^2}{m^2} $$\n\n**3. 第1部分：相对误差$\\delta$的计算**\n\n我们可以找到$\\omega^2$和$\\omega_h^2$之间的直接关系：\n$$ \\omega^2 = \\frac{k_h^2 N^2 + m^2 f^2}{k_h^2 + m^2} = \\frac{m^2\\left(\\frac{k_h^2 N^2}{m^2} + f^2\\right)}{m^2\\left(\\frac{k_h^2}{m^2} + 1\\right)} = \\frac{\\omega_h^2}{1 + (k_h/m)^2} $$\n因此，$\\omega_h^2 = \\omega^2 \\left(1 + (k_h/m)^2\\right)$，这意味着$\\omega_h = \\omega \\sqrt{1 + (k_h/m)^2}$，因为频率是正的。\n相对频率误差$\\delta$定义为$\\delta = \\frac{\\omega_h - \\omega}{\\omega}$。\n$$ \\delta = \\frac{\\omega \\sqrt{1 + (k_h/m)^2} - \\omega}{\\omega} = \\sqrt{1 + (k_h/m)^2} - 1 $$\n值得注意的是，$\\delta$的这个表达式仅取决于波数的纵横比$k_h/m$。\n给定参数：\n$k_h = 3.0 \\times 10^{-3}\\ \\text{m}^{-1}$\n$m = 1.0 \\times 10^{-2}\\ \\text{m}^{-1}$\n该比值为：\n$$ \\frac{k_h}{m} = \\frac{3.0 \\times 10^{-3}}{1.0 \\times 10^{-2}} = 0.3 $$\n将此代入$\\delta$的表达式：\n$$ \\delta = \\sqrt{1 + (0.3)^2} - 1 = \\sqrt{1 + 0.09} - 1 = \\sqrt{1.09} - 1 $$\n$$ \\delta \\approx 1.04403065... - 1 = 0.04403065... $$\n四舍五入到四位有效数字，我们得到$\\delta \\approx 0.04403$。\n\n**4. 第2部分：静水平衡近似有效性的条件**\n\n我们需要找到比值$k_h/m$的上界，使得相对误差小于$0.05$。因此，我们必须解不等式$|\\delta|  0.05$。由于$\\omega_h \\ge \\omega$，我们有$\\delta \\ge 0$，因此条件简化为$\\delta  0.05$。\n$$ \\sqrt{1 + (k_h/m)^2} - 1  0.05 $$\n$$ \\sqrt{1 + (k_h/m)^2}  1.05 $$\n由于两边都是正数，我们可以对它们进行平方而不改变不等式的方向：\n$$ 1 + (k_h/m)^2  (1.05)^2 $$\n$$ (k_h/m)^2  (1.05)^2 - 1 $$\n$$ (k_h/m)^2  (1 + 0.05)^2 - 1 = (1 + 2(0.05) + (0.05)^2) - 1 = 2(0.05) + (0.05)^2 $$\n由于$k_h/m$是大小的比值，因此是非负的，我们可以取平方根：\n$$ \\frac{k_h}{m}  \\sqrt{2(0.05) + (0.05)^2} $$\n因此，$k_h/m$上界的精确闭式解析表达式为$\\sqrt{2(0.05) + (0.05)^2}$。\n\n题目要求最终答案同时包含$\\delta$的数值和符号上界。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.04403,  \\sqrt{2(0.05) + (0.05)^2} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "本练习将理论与计算实践相结合，旨在解决海洋模型中的一个著名挑战：坐标变换引入的数值误差。您将设计一个数值实验，以分离并量化在地形追随坐标系中，当静力平衡在倾斜地形上被离散化时产生的“压力梯度误差”。这项实践为了解在数值代码中实现物理定律的实际困难提供了宝贵的洞察 。",
            "id": "3815103",
            "problem": "要求您设计并实现一个数值实验，该实验使用地形跟随层，在一个具有稳定垂直层结和倾斜海底地形的一维静止海洋中，分离出由离散化引起的静压梯度误差。该实验必须从第一性原理出发构建，并能产生可量化的诊断指标。\n\n从静力平衡近似下的垂直动量方程出发：对于静止海洋中受重力加速度$g$作用的压力$p(z)$和密度$\\rho(z)$，其垂直方向的平衡由$\\frac{\\partial p}{\\partial z} = -\\rho g$给出。在一个物理上一致的静止状态下，密度仅依赖于垂直位置$z$，因此在任何固定的物理深度$z$处，水平压力梯度必须恒等于零：$\\frac{\\partial p}{\\partial x} \\big|_{z} = 0$。地形跟随（sigma）坐标$s \\in [-1,0]$根据$s = z/H(x)$对垂直坐标进行变换，其中$H(x)$是局部海底深度，这里取为一条直线$H(x) = H_0 + \\alpha x$，其斜率为$\\alpha = dH/dx$，且$x \\in [0,L_x]$。在离散数值实现中，通过沿地形跟随层对静力平衡进行垂直积分来计算压力，然后在常数$s$层上计算水平差分，这破坏了使$\\frac{\\partial p}{\\partial x}\\big|_{z} = 0$成立所需的抵消，从而产生一个非零的表观水平压力梯度。这个表观梯度就是您必须量化的静压梯度误差。\n\n您的程序应：\n- 构建一个一维域，其中包含$N_x$个均匀分布的网格点，覆盖范围为$x \\in [0,L_x]$，并计算海底地形$H(x) = H_0 + \\alpha x$。\n- 使用中点$s_k = -\\frac{k-0.5}{N_s}$（其中$k = 1,\\dots,N_s$）定义$N_s$个地形跟随层，使得第$i$列第$k$层的物理深度为$z_{i,k} = s_k H(x_i)$，且第$i$列的层厚度为$\\Delta z_i = H(x_i)/N_s$（在该列内为常数）。\n- 指定一个稳定的、依赖于深度的密度剖面，以产生真实的海洋层结。使用多项式形式$\\rho(z) = \\rho_0 + a_1 (-z) + a_2 (-z)^2$（其中$z \\le 0$），$\\rho_0$是一个常数参考密度，$a_1$控制线性层结强度，$a_2$设置随深度的曲率。对于物理上合理的正系数$a_1$和$a_2$，此形式可确保稳定的层结（$\\frac{\\partial \\rho}{\\partial z} \\le 0$），因为在海面以下$-z \\ge 0$。\n- 通过使用离散静力平衡从海面向下进行垂直积分，计算每列$i$和每个地形跟随层$k$处的离散静压$p_{i,k}$。通过逐层求和$p_{i,k} = g \\sum_{m=1}^{k} \\rho(z_{i,m}) \\Delta z_i$来近似该积分，这与静力平衡近似和典型的逐层离散化方法一致。\n- 通过在相同层指数上对相邻列使用有限差分，形成常数$s$上的表观离散水平压力梯度：$\\left.\\frac{\\partial p}{\\partial x}\\right|_{s_k}(x_{i+\\frac{1}{2}}) \\approx \\frac{p_{i+1,k} - p_{i,k}}{\\Delta x}$。将其转换为表观水平加速度$a_{i+\\frac{1}{2},k} = - \\frac{1}{\\rho_0} \\left.\\frac{\\partial p}{\\partial x}\\right|_{s_k}$，在连续的、物理上一致的静力平衡状态下，该加速度应恒等于零，但在此离散地形跟随过程中则不然。\n- 在所有内部水平点和所有地形跟随层上使用诊断指标来量化误差：\n    - 均方根（RMS）加速度$a_{\\mathrm{RMS}} = \\sqrt{ \\frac{1}{M} \\sum_{i,k} a_{i+\\frac{1}{2},k}^2 }$，其中$M$是评估点的总数。\n    - 最大绝对加速度$a_{\\mathrm{max}} = \\max_{i,k} \\left| a_{i+\\frac{1}{2},k} \\right|$。\n两个诊断指标都必须以米每平方秒（$\\mathrm{m}/\\mathrm{s}^2$）表示。最终输出中不允许使用其他单位。\n\n实现以上步骤，并评估以下测试套件以确保覆盖率：\n- 案例A（一般情况，中等坡度和层结曲率）：$H_0 = 4000\\,\\mathrm{m}$, $L_x = 100{,}000\\,\\mathrm{m}$, $\\alpha = 1\\times 10^{-3}\\,\\mathrm{m}/\\mathrm{m}$, $N_s = 40$, $\\rho_0 = 1027\\,\\mathrm{kg}/\\mathrm{m}^3$, $a_1 = 5\\times 10^{-4}\\,\\mathrm{kg}/\\mathrm{m}^4$, $a_2 = 1\\times 10^{-7}\\,\\mathrm{kg}/\\mathrm{m}^5$, $N_x = 101$。\n- 案例B（边界条件：零坡度）：与案例A相同，但$\\alpha = 0$。\n- 案例C（边缘情况：陡坡）：与案例A相同，但$\\alpha = 5\\times 10^{-3}\\,\\mathrm{m}/\\mathrm{m}$。\n- 案例D（边缘情况：粗垂直分辨率和更强曲率）：与案例A相同，但$N_s = 10$，$a_2 = 2\\times 10^{-7}\\,\\mathrm{kg}/\\mathrm{m}^5$。\n- 案例E（诊断性：无层结，密度恒定）：与案例A相同，但$a_1 = 0$ and $a_2 = 0$。\n\n您的程序必须生成单行输出，其中包含所有测试案例的诊断结果，格式为一个用方括号括起来的逗号分隔浮点数列表，顺序为$[a_{\\mathrm{RMS}}^{(A)}, a_{\\mathrm{max}}^{(A)}, a_{\\mathrm{RMS}}^{(B)}, a_{\\mathrm{max}}^{(B)}, \\dots]$。每个浮点数代表一个以$\\mathrm{m}/\\mathrm{s}^2$为单位的加速度。不得打印任何额外文本。",
            "solution": "本问题的目标是设计并实现一个数值实验，用以量化静压梯度误差。这在使用地形跟随坐标的计算海洋模型中是一种已知的人为误差。我们将建立一个位于倾斜海底之上的静止、层结海洋的一维模型，并计算由数值离散化引起的伪水平加速度。\n\n所研究的基本原理是在变换坐标系中对水平压力梯度的错误表示。在一个物理上静止的海洋中（$u=v=w=0$），水平方向的力必须完全平衡。主要的水平力是压力梯度。在一个垂直轴 $z$ 指向上的笛卡尔坐标系中，静止层结流体中的压力 $p$ 仅是深度的函数，即 $p=p(z)$。因此，在任何水平面上（常数 $z$），真实的水平压力梯度恒等于零：$\\frac{\\partial p}{\\partial x} \\big|_{z} = 0$。\n\n数值海洋模型通常使用地形跟随坐标，例如 sigma 坐标 $s = z/H(x)$，其中 $H(x)$ 是局部海洋深度。这将不规则的物理域转换为矩形的计算域，从而简化了网格生成和边界条件的应用。然而，在这个变换后的系统中求导会引入误差。具体来说，离散的水平压力梯度是在相同 sigma 层面 $s_k$ 的相邻网格单元之间计算的。这近似的是 $\\frac{\\partial p}{\\partial x} \\big|_{s}$，而不是 $\\frac{\\partial p}{\\partial x} \\big|_{z}$。\n\n这两种梯度之间的关系由链式法则给出：\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = \\left.\\frac{\\partial p}{\\partial x}\\right|_{s} - \\left.\\frac{\\partial p}{\\partial z}\\right|_{x} \\left.\\frac{\\partial z}{\\partial x}\\right|_{s}\n$$\n由于在静止海洋中真实的梯度 $\\frac{\\partial p}{\\partial x} \\big|_{z}$ 为零，因此数值计算出的梯度完全是一个误差项：\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{s} = \\left.\\frac{\\partial p}{\\partial z}\\right|_{x} \\left.\\frac{\\partial z}{\\partial x}\\right|_{s}\n$$\n使用静力平衡方程 $\\frac{\\partial p}{\\partial z} = -\\rho(z)g$ 和坐标定义 $\\frac{\\partial z}{\\partial x}|_{s} = s \\frac{dH}{dx} = s\\alpha$，伪压力梯度为：\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{s} = -\\rho(z) g s \\alpha\n$$\n这个非零梯度会引起一个伪水平加速度 $a = -\\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial x}|_{s}$，它可能产生人为流并降低模拟的准确性。此问题要求我们通过直接数值模拟来量化此误差。\n\n需要对问题陈述做一个小的修正。对于一个从海面指向上方的 z 轴（$z \\le 0$），稳定层结要求密度随深度增加而增加，这意味着密度必须随 $z$ 的增加而减小。因此，稳定条件是 $\\frac{\\partial \\rho}{\\partial z} \\le 0$。问题文本错误地将其陈述为 $\\frac{\\partial \\rho}{\\partial z} \\ge 0$。然而，所提供的密度函数 $\\rho(z) = \\rho_0 + a_1(-z) + a_2(-z)^2$，在测试案例中系数 $a_1$ 和 $a_2$ 为正，正确地产生了稳定的层结，因为其导数为 $\\frac{\\partial \\rho}{\\partial z} = -a_1 + 2a_2 z$，对于所有 $z  0$ 都是负值（因为 $a_1 > 0$ 和 $a_2 > 0$）。因此，尽管存在文本错误，实现仍然是物理上合理的。重力加速度 $g$ 未指定，因此我们将使用标准值 $g = 9.81 \\, \\mathrm{m}/\\mathrm{s}^2$。\n\n数值实验的构建如下：\n\n1.  **域和网格离散化**：将一维水平域 $x \\in [0, L_x]$ 离散为 $N_x$ 个均匀间隔的点 $x_i = i \\cdot \\Delta x$（$i=0, \\dots, N_x-1$），其中网格间距为 $\\Delta x = L_x / (N_x - 1)$。在每个点 $x_i$ 处，海洋深度由线性海底地形函数 $H(x_i) = H_0 + \\alpha x_i$ 给出。\n\n2.  **垂直坐标系**：在每个水平位置 $x_i$ 处的垂直域被离散为 $N_s$ 个地形跟随层。这些层由它们在 sigma 空间中的中点定义，$s_k = -\\frac{k-0.5}{N_s}$（$k = 1, \\dots, N_s$）。给定层 $k$ 和列 $i$ 对应的物理深度 $z$ 为 $z_{i,k} = s_k H(x_i)$。列 $i$ 内每一层的厚度是均匀的，由 $\\Delta z_i = H(x_i) / N_s$ 给出。\n\n3.  **密度场计算**：密度 $\\rho(z)$ 由多项式 $\\rho(z) = \\rho_0 + a_1(-z) + a_2(-z)^2$ 定义。我们计算每一列中每一层中点的密度，$\\rho_{i,k} = \\rho(z_{i,k})$，从而创建一个二维的密度值数组。\n\n4.  **离散静压积分**：第 $i$ 列第 $k$ 层的压力 $p_{i,k}$ 是通过从海面（$z=0$，$p=0$）向下积分静力平衡方程来计算的。问题指定了一个离散求和来近似这个积分，表示第 $k$ 层底部界面的压力：\n    $$\n    p_{i,k} = g \\sum_{m=1}^{k} \\rho_{i,m} \\Delta z_i\n    $$\n    该计算对每一列 $i$ 中的所有层 $k$ 执行。通过对垂直（层）轴使用累积求和可以高效地实现这一点。\n\n5.  **伪加速度计算**：实验的核心是计算沿常数 sigma 面上的伪水平压力梯度。使用中心有限差分，列 $i$ 和 $i+1$ 之间在层 $k$ 上的梯度为：\n    $$\n    \\left.\\frac{\\partial p}{\\partial x}\\right|_{s_k}(x_{i+\\frac{1}{2}}) \\approx \\frac{p_{i+1,k} - p_{i,k}}{\\Delta x}\n    $$\n    然后使用参考密度 $\\rho_0$ 将该梯度转换为伪加速度：\n    $$\n    a_{i+\\frac{1}{2},k} = - \\frac{1}{\\rho_0} \\frac{p_{i+1,k} - p_{i,k}}{\\Delta x}\n    $$\n    此计算针对所有内部水平网格单元界面（$i=0, \\dots, N_x-2$）和所有垂直层（$k=1, \\dots, N_s$）进行。\n\n6.  **误差诊断**：为了量化误差的大小，在整个伪加速度场上计算两个度量：\n    -   均方根（RMS）加速度：$a_{\\mathrm{RMS}} = \\sqrt{ \\frac{1}{(N_x-1)N_s} \\sum_{i=0}^{N_x-2} \\sum_{k=1}^{N_s} a_{i+\\frac{1}{2},k}^2 }$。\n    -   最大绝对加速度：$a_{\\mathrm{max}} = \\max_{i,k} \\left| a_{i+\\frac{1}{2},k} \\right|$。\n\n这些诊断指标为每个指定的测试案例提供了离散化误差的简洁摘要，从而可以系统地分析海底坡度、垂直分辨率和层结强度等因素如何影响误差的大小。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_hpe(params):\n    \"\"\"\n    Calculates the hydrostatic pressure gradient error diagnostics for a given set of parameters.\n\n    Args:\n        params (dict): A dictionary containing the model parameters for a single test case.\n\n    Returns:\n        tuple[float, float]: A tuple containing the RMS acceleration and max absolute acceleration.\n    \"\"\"\n    H0 = params['H0']\n    Lx = params['Lx']\n    alpha = params['alpha']\n    Ns = params['Ns']\n    rho0 = params['rho0']\n    a1 = params['a1']\n    a2 = params['a2']\n    Nx = params['Nx']\n    \n    g = 9.81  # Standard gravitational acceleration in m/s^2\n\n    # 1. Domain and Grid Discretization\n    x = np.linspace(0, Lx, Nx)\n    delta_x = Lx / (Nx - 1)\n    H = H0 + alpha * x\n\n    # 2. Vertical Coordinate System\n    # s_k are the sigma-coordinates of the layer midpoints\n    k = np.arange(1, Ns + 1)\n    s_k = -(k - 0.5) / Ns\n    \n    # Create 2D arrays for vectorized calculations using broadcasting.\n    # Shapes: H_2d - (Nx, 1), s_k_2d - (1, Ns)\n    H_2d = H[:, np.newaxis]\n    s_k_2d = s_k[np.newaxis, :]\n    \n    # Physical depth z at each grid point (i, k)\n    # Shape: (Nx, Ns)\n    z_ik = H_2d * s_k_2d\n    \n    # Layer thickness for each column i\n    # Shape: (Nx, 1)\n    delta_z_i = H_2d / Ns\n    \n    # 3. Density Field Calculation\n    # Density at each grid point (i, k)\n    # Shape: (Nx, Ns)\n    rho_ik = rho0 + a1 * (-z_ik) + a2 * (-z_ik)**2\n    \n    # 4. Discrete Hydrostatic Pressure Integration\n    # The term to be summed for pressure calculation\n    pressure_integrand = g * rho_ik * delta_z_i\n    \n    # Vertically integrate using cumulative sum along the k-axis (axis=1)\n    # p_ik is the pressure at the bottom interface of layer k in column i\n    # Shape: (Nx, Ns)\n    p_ik = np.cumsum(pressure_integrand, axis=1)\n\n    # 5. Spurious Acceleration Calculation\n    # Compute horizontal pressure difference along constant s-surfaces\n    # np.diff operates along axis=0 (the x-dimension)\n    # Shape: (Nx-1, Ns)\n    dp = np.diff(p_ik, axis=0)\n    \n    # The spurious acceleration field\n    accel = - (1 / rho0) * (dp / delta_x)\n\n    # 6. Error Diagnostics\n    # Special case: if there's no error, avoid numpy warnings with empty arrays\n    if accel.size == 0:\n        return 0.0, 0.0\n\n    a_rms = np.sqrt(np.mean(accel**2))\n    a_max = np.max(np.abs(accel))\n\n    return a_rms, a_max\n\ndef solve():\n    \"\"\"\n    Defines, runs, and formats the output for all test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: general, moderate slope and stratification curvature\n        {'H0': 4000.0, 'Lx': 100000.0, 'alpha': 1e-3, 'Ns': 40, 'rho0': 1027.0, 'a1': 5e-4, 'a2': 1e-7, 'Nx': 101},\n        # Case B: boundary condition: zero slope\n        {'H0': 4000.0, 'Lx': 100000.0, 'alpha': 0.0, 'Ns': 40, 'rho0': 1027.0, 'a1': 5e-4, 'a2': 1e-7, 'Nx': 101},\n        # Case C: edge case: steep slope\n        {'H0': 4000.0, 'Lx': 100000.0, 'alpha': 5e-3, 'Ns': 40, 'rho0': 1027.0, 'a1': 5e-4, 'a2': 1e-7, 'Nx': 101},\n        # Case D: edge case: coarse vertical resolution and stronger curvature\n        {'H0': 4000.0, 'Lx': 100000.0, 'alpha': 1e-3, 'Ns': 10, 'rho0': 1027.0, 'a1': 5e-4, 'a2': 2e-7, 'Nx': 101},\n        # Case E: diagnostic: no stratification, constant density\n        {'H0': 4000.0, 'Lx': 100000.0, 'alpha': 1e-3, 'Ns': 40, 'rho0': 1027.0, 'a1': 0.0, 'a2': 0.0, 'Nx': 101},\n    ]\n\n    results = []\n    for params in test_cases:\n        a_rms, a_max = calculate_hpe(params)\n        results.extend([a_rms, a_max])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}