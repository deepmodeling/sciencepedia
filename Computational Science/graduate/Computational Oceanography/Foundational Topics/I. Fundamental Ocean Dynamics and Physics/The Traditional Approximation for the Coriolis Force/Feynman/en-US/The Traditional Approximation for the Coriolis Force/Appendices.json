{
    "hands_on_practices": [
        {
            "introduction": "Understanding any approximation begins with a firm grasp of the full picture. This first exercise grounds our study by returning to first principles. You will derive the components of the Coriolis force directly from the geometry of a rotating sphere, distinguishing between the vertical ($f$) and horizontal ($f_h$) parts of the planetary rotation vector. This practice is crucial for building physical intuition about why the traditional approximation is plausible for large-scale flows and for identifying the terms that are neglected.",
            "id": "3816574",
            "problem": "Consider a local east–north–up Cartesian frame $\\left(\\hat{\\boldsymbol{e}}_{x},\\hat{\\boldsymbol{e}}_{y},\\hat{\\boldsymbol{e}}_{z}\\right)$ attached to a point at latitude $\\phi$ on a uniformly rotating Earth. In a rotating reference frame, the apparent Coriolis acceleration is $-2\\,\\boldsymbol{\\Omega}\\times\\boldsymbol{u}$, where $\\boldsymbol{\\Omega}$ is the planetary rotation vector of magnitude $\\Omega$ and $\\boldsymbol{u}$ is the fluid velocity. The traditional approximation used in large-scale ocean dynamics retains only the projection of $\\boldsymbol{\\Omega}$ onto $\\hat{\\boldsymbol{e}}_{z}$ in the horizontal momentum equations. Define the vertical Coriolis parameter $f$ and the horizontal Coriolis magnitude $f_{h}$ by\n$$\nf \\equiv 2\\,\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{e}}_{z},\\qquad\nf_{h} \\equiv 2\\,\\left|\\boldsymbol{\\Omega}-\\left(\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{e}}_{z}\\right)\\hat{\\boldsymbol{e}}_{z}\\right|.\n$$\nStarting from these definitions and the geometry of the local tangent plane on a sphere, derive $f$ and $f_{h}$ as functions of $\\Omega$ and $\\phi$ without invoking any pre-memorized geophysical formulas. Then evaluate both at latitude $\\phi=45^\\circ$ for an Earth rotation rate $\\Omega=7.2921\\times 10^{-5}\\ \\mathrm{s}^{-1}$. Angles must be used in radians in any trigonometric evaluation; convert $\\phi=45^\\circ$ to $\\phi=\\pi/4$.\n\nFinally, form the dimensionless ratio $r \\equiv f_{h}/f$ and provide it as your final answer. Round $r$ to four significant figures. In your working, also report the numerical values of $f$ and $f_{h}$ in $\\mathrm{s}^{-1}$ and comment briefly on their relative magnitudes in the context of the traditional approximation. Express the final answer $r$ as a pure number with no units.",
            "solution": "The problem is well-posed and scientifically grounded in the principles of geophysical fluid dynamics. We begin by deriving the requested parameters from first principles.\n\nThe planetary rotation vector $\\boldsymbol{\\Omega}$ points along the Earth's axis of rotation from the center towards the North Pole and has a magnitude of $\\Omega$. We need to express this vector in the local Cartesian frame $\\left(\\hat{\\boldsymbol{e}}_{x},\\hat{\\boldsymbol{e}}_{y},\\hat{\\boldsymbol{e}}_{z}\\right)$ at a latitude $\\phi$, where $\\hat{\\boldsymbol{e}}_{x}$, $\\hat{\\boldsymbol{e}}_{y}$, and $\\hat{\\boldsymbol{e}}_{z}$ represent the east, north, and local vertical (upward) directions, respectively.\n\nBy the geometry of a sphere, the vector $\\boldsymbol{\\Omega}$ lies in the plane defined by the local north direction $\\hat{\\boldsymbol{e}}_{y}$ and the local vertical direction $\\hat{\\boldsymbol{e}}_{z}$. This is the local meridional plane. Consequently, $\\boldsymbol{\\Omega}$ has no component in the east direction, so its dot product with $\\hat{\\boldsymbol{e}}_{x}$ is zero:\n$$\n\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{e}}_{x} = 0\n$$\nThe latitude $\\phi$ is the angle between the equatorial plane and the local vertical vector $\\hat{\\boldsymbol{e}}_{z}$. The rotation vector $\\boldsymbol{\\Omega}$ is, by definition, perpendicular to the equatorial plane. Therefore, the angle between $\\boldsymbol{\\Omega}$ and $\\hat{\\boldsymbol{e}}_{z}$ is the co-latitude, $\\frac{\\pi}{2} - \\phi$. The projection of $\\boldsymbol{\\Omega}$ onto the local vertical is:\n$$\n\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{e}}_{z} = |\\boldsymbol{\\Omega}| \\cos\\left(\\frac{\\pi}{2} - \\phi\\right) = \\Omega \\sin(\\phi)\n$$\nThe local north vector $\\hat{\\boldsymbol{e}}_{y}$ is perpendicular to $\\hat{\\boldsymbol{e}}_{z}$ and lies in the same meridional plane as $\\boldsymbol{\\Omega}$. Since the angle between $\\boldsymbol{\\Omega}$ and $\\hat{\\boldsymbol{e}}_{z}$ is $\\frac{\\pi}{2} - \\phi$, the angle between $\\boldsymbol{\\Omega}$ and $\\hat{\\boldsymbol{e}}_{y}$ must be $\\phi$. The projection of $\\boldsymbol{\\Omega}$ onto the local north direction is:\n$$\n\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{e}}_{y} = |\\boldsymbol{\\Omega}| \\cos(\\phi) = \\Omega \\cos(\\phi)\n$$\nCombining these components, the rotation vector $\\boldsymbol{\\Omega}$ in the local frame is:\n$$\n\\boldsymbol{\\Omega} = (\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{e}}_{x})\\hat{\\boldsymbol{e}}_{x} + (\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{e}}_{y})\\hat{\\boldsymbol{e}}_{y} + (\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{e}}_{z})\\hat{\\boldsymbol{e}}_{z} = 0\\,\\hat{\\boldsymbol{e}}_{x} + \\Omega \\cos(\\phi) \\hat{\\boldsymbol{e}}_{y} + \\Omega \\sin(\\phi) \\hat{\\boldsymbol{e}}_{z}\n$$\n\nNow we derive the expressions for $f$ and $f_{h}$ using their provided definitions.\nThe vertical Coriolis parameter $f$ is defined as $f \\equiv 2\\,\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{e}}_{z}$. Using our expression for $\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{e}}_{z}$:\n$$\nf = 2 \\Omega \\sin(\\phi)\n$$\nThe horizontal Coriolis magnitude $f_{h}$ is defined as $f_{h} \\equiv 2\\,\\left|\\boldsymbol{\\Omega}-\\left(\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{e}}_{z}\\right)\\hat{\\boldsymbol{e}}_{z}\\right|$. The vector term $\\boldsymbol{\\Omega}-\\left(\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{e}}_{z}\\right)\\hat{\\boldsymbol{e}}_{z}$ is the component of $\\boldsymbol{\\Omega}$ perpendicular to $\\hat{\\boldsymbol{e}}_{z}$, which is the projection of $\\boldsymbol{\\Omega}$ onto the local horizontal plane spanned by $\\left(\\hat{\\boldsymbol{e}}_{x},\\hat{\\boldsymbol{e}}_{y}\\right)$. Let's compute this vector:\n$$\n\\boldsymbol{\\Omega}-(\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{e}}_{z})\\hat{\\boldsymbol{e}}_{z} = \\left(\\Omega \\cos(\\phi) \\hat{\\boldsymbol{e}}_{y} + \\Omega \\sin(\\phi) \\hat{\\boldsymbol{e}}_{z}\\right) - \\left(\\Omega \\sin(\\phi)\\right)\\hat{\\boldsymbol{e}}_{z} = \\Omega \\cos(\\phi) \\hat{\\boldsymbol{e}}_{y}\n$$\nThe magnitude of this vector is $|\\Omega \\cos(\\phi) \\hat{\\boldsymbol{e}}_{y}| = \\Omega |\\cos(\\phi)|$. Since latitude $\\phi$ is typically defined in the range $[-\\pi/2, \\pi/2]$, $\\cos(\\phi) \\ge 0$, so we can remove the absolute value.\nTherefore, $f_{h}$ is:\n$$\nf_{h} = 2 \\Omega \\cos(\\phi)\n$$\nNext, we evaluate $f$ and $f_{h}$ at the specified latitude $\\phi=45^\\circ$, which is $\\phi=\\pi/4$ radians. We are given the Earth's rotation rate $\\Omega=7.2921\\times 10^{-5}\\ \\mathrm{s}^{-1}$.\n$$\n\\sin(\\pi/4) = \\frac{\\sqrt{2}}{2}, \\qquad \\cos(\\pi/4) = \\frac{\\sqrt{2}}{2}\n$$\nThe numerical values are:\n$$\nf = 2 (7.2921\\times 10^{-5}\\ \\mathrm{s}^{-1}) \\sin(\\pi/4) = \\sqrt{2} (7.2921\\times 10^{-5}\\ \\mathrm{s}^{-1}) \\approx 1.0313 \\times 10^{-4}\\ \\mathrm{s}^{-1}\n$$\n$$\nf_{h} = 2 (7.2921\\times 10^{-5}\\ \\mathrm{s}^{-1}) \\cos(\\pi/4) = \\sqrt{2} (7.2921\\times 10^{-5}\\ \\mathrm{s}^{-1}) \\approx 1.0313 \\times 10^{-4}\\ \\mathrm{s}^{-1}\n$$\nAt a latitude of $45^\\circ$, the vertical and horizontal Coriolis parameters have the same magnitude.\n\nThe traditional approximation in the horizontal momentum equations neglects terms involving the horizontal component of the Earth's rotation. Specifically, the full Coriolis acceleration term is $-2\\boldsymbol{\\Omega}\\times\\boldsymbol{u} = (fv - f_h w)\\hat{\\boldsymbol{e}}_x - fu\\hat{\\boldsymbol{e}}_y + f_h u\\hat{\\boldsymbol{e}}_z$, where $\\boldsymbol{u}=u\\hat{\\boldsymbol{e}}_x+v\\hat{\\boldsymbol{e}}_y+w\\hat{\\boldsymbol{e}}_z$. The traditional approximation neglects the term $f_h w$ in the zonal (east-west) momentum equation. The validity of this approximation thus depends on the condition $|f_h w| \\ll |fv|$. At $\\phi=45^\\circ$, we have $f_h=f$, so the condition simplifies to $|w| \\ll |v|$. For large-scale geophysical flows, the vertical velocity scale is indeed much smaller than the horizontal velocity scale (i.e., the aspect ratio of motions is small), which justifies the approximation at mid-latitudes. However, the ratio $f_h/f = \\cot(\\phi)$ becomes very large near the equator, making the approximation progressively worse at low latitudes.\n\nFinally, we compute the dimensionless ratio $r$:\n$$\nr \\equiv \\frac{f_h}{f} = \\frac{2\\Omega\\cos(\\phi)}{2\\Omega\\sin(\\phi)} = \\cot(\\phi)\n$$\nAt $\\phi = \\pi/4$:\n$$\nr = \\cot(\\pi/4) = 1\n$$\nThe problem requires this value to be rounded to four significant figures. This gives $r = 1.000$.",
            "answer": "$$\n\\boxed{1.000}\n$$"
        },
        {
            "introduction": "With the simplified equations of motion in hand, we can now explore their dynamical consequences. This exercise examines one of the most fundamental phenomena in a rotating fluid: inertial oscillations. By solving the momentum equations under the traditional approximation in the absence of other forces, you will see how a simple impulse evolves into a circular motion at the inertial frequency. This problem illustrates the primary dynamical effect captured by the traditional approximation and serves as a building block for understanding more complex geophysical flows.",
            "id": "3816634",
            "problem": "Consider a horizontally homogeneous, incompressible ocean of constant density on an $f$-plane at latitude $\\phi$, where the Coriolis parameter is $f = 2 \\Omega \\sin \\phi$ and $\\Omega$ is Earth's rotation rate. Under the Traditional Approximation (which retains only the vertical component of Earth's rotation and neglects the horizontal components in the Coriolis acceleration), focus on the horizontal momentum of a fluid parcel in the absence of pressure gradients, vertical motion, and friction. Starting from Newton's second law in a rotating frame and the stated approximations, derive the linear governing equations for the horizontal velocities $u(t)$ (eastward) and $v(t)$ (northward).\n\nAt time $t = 0$, a point impulse of horizontal momentum per unit mass is applied that instantaneously sets the velocity to $u(0^{+}) = U_{0}$ and $v(0^{+}) = 0$, with $u(0^{-}) = 0$ and $v(0^{-}) = 0$, where $U_{0}$ is a given constant amplitude. For $t > 0$, compute the impulse response and obtain the time evolution of $u(t)$ and $v(t)$ as closed-form analytic expressions.\n\nExpress your final $u(t)$ and $v(t)$ in meters per second, and write all trigonometric function arguments in radians. Provide the final answer as a single row matrix containing $u(t)$ and $v(t)$ in terms of $U_{0}$, $f$, and $t$ only, without any additional commentary.",
            "solution": "The problem will first be validated to ensure it is scientifically sound, self-contained, and well-posed before a solution is attempted.\n\n### Step 1: Extract Givens\n- **System**: A horizontally homogeneous, incompressible ocean of constant density.\n- **Frame**: An $f$-plane at latitude $\\phi$.\n- **Coriolis Parameter**: $f = 2 \\Omega \\sin \\phi$, where $\\Omega$ is Earth's rotation rate.\n- **Approximation**: The Traditional Approximation is used (only the vertical component of Earth's rotation is considered for the Coriolis acceleration).\n- **Neglected Terms**: Pressure gradients, vertical motion ($w=0$), and friction are absent.\n- **Variables**: Horizontal velocities are $u(t)$ (eastward) and $v(t)$ (northward).\n- **Initial Conditions**: A point impulse of horizontal momentum per unit mass at $t=0$ results in the following conditions:\n  - $u(0^{-}) = 0$ and $v(0^{-}) = 0$.\n  - $u(0^{+}) = U_{0}$ and $v(0^{+}) = 0$, where $U_{0}$ is a given constant amplitude.\n- **Objective**: For $t > 0$, derive the linear governing equations for $u(t)$ and $v(t)$ and find their closed-form analytic expressions.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Grounding**: The problem describes inertial oscillations, a fundamental concept in geophysical fluid dynamics. The setup, including the $f$-plane approximation and the Traditional Approximation, is a standard and valid simplification used to isolate these dynamics. All principles are rooted in classical mechanics and fluid dynamics. The problem is scientifically grounded.\n- **Well-Posedness**: The task is to solve a system of linear first-order ordinary differential equations with specified initial conditions. Such a system has a unique and stable solution. The problem is well-posed.\n- **Objectivity**: The problem is stated using precise, formal language and quantitative conditions. There are no subjective or ambiguous terms. The problem is objective.\n- **Completeness and Consistency**: All necessary information (governing approximations, initial conditions, neglected forces) is provided. There are no contradictions in the setup.\n- **Feasibility**: The conditions (e.g., no friction, no pressure gradients) are idealizations, but they are standard for textbook problems designed to illustrate a specific physical principle. They do not represent a physical impossibility that would invalidate the problem.\n\n### Step 3: Verdict and Action\nThe problem is valid as it is scientifically sound, well-posed, objective, and self-contained. A full solution will be derived.\n\n### Solution Derivation\n\nThe motion of a fluid parcel in a rotating reference frame is described by Newton's second law, which includes the Coriolis acceleration. In a local coordinate system with $x$ pointing east, $y$ pointing north, and $z$ pointing vertically upward, the velocity vector is $\\vec{v} = (u, v, w)$ and the Earth's rotation vector is $\\vec{\\Omega} = (0, \\Omega \\cos\\phi, \\Omega \\sin\\phi)$.\n\nThe Coriolis acceleration term is given by $-2\\vec{\\Omega} \\times \\vec{v}$. Let's compute the cross product:\n$$\n-2\\vec{\\Omega} \\times \\vec{v} = -2\\begin{vmatrix} \\hat{i} & \\hat{j} & \\hat{k} \\\\ 0 & \\Omega \\cos \\phi & \\Omega \\sin \\phi \\\\ u & v & w \\end{vmatrix} = -2 \\left( w\\Omega\\cos\\phi - v\\Omega\\sin\\phi \\right) \\hat{i} -2 \\left( -u\\Omega\\sin\\phi \\right) \\hat{j} -2 \\left( -u\\Omega\\cos\\phi \\right) \\hat{k}\n$$\nThe components of the Coriolis acceleration are:\n- $x$-component: $2v\\Omega\\sin\\phi - 2w\\Omega\\cos\\phi$\n- $y$-component: $-2u\\Omega\\sin\\phi$\n- $z$-component: $2u\\Omega\\cos\\phi$\n\nThe Traditional Approximation neglects the terms containing the horizontal component of the Earth's rotation, $\\Omega\\cos\\phi$. This is physically justified because in large-scale ocean dynamics, the horizontal velocities ($u,v$) are much larger than the vertical velocity ($w$), and the vertical acceleration is typically dominated by the balance between the pressure gradient and gravity (hydrostatic balance). Under this approximation, the horizontal components of the Coriolis acceleration simplify significantly.\n\nLet $f = 2\\Omega\\sin\\phi$. The horizontal components of the Coriolis acceleration become:\n- $x$-component: $fv$\n- $y$-component: $-fu$\n\nThe horizontal momentum equations are:\n$$\n\\frac{Du}{Dt} = fv - \\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} + F_{x}\n$$\n$$\n\\frac{Dv}{Dt} = -fu - \\frac{1}{\\rho}\\frac{\\partial p}{\\partial y} + F_{y}\n$$\nwhere $\\frac{D}{Dt}$ is the material derivative, $\\rho$ is density, $p$ is pressure, and $F$ represents frictional forces.\n\nThe problem states that there are no pressure gradients ($\\nabla p = 0$) and no friction ($\\vec{F} = 0$). The material derivative is $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + u\\frac{\\partial}{\\partial x} + v\\frac{\\partial}{\\partial y} + w\\frac{\\partial}{\\partial z}$. The problem specifies \"horizontally homogeneous\", which implies $\\frac{\\partial}{\\partial x}=0$ and $\\frac{\\partial}{\\partial y}=0$. It also specifies \"no vertical motion\", so $w=0$. Therefore, the advective part of the material derivative, $(u\\frac{\\partial}{\\partial x} + v\\frac{\\partial}{\\partial y} + w\\frac{\\partial}{\\partial z})\\vec{v}$, is zero. The material derivative simplifies to the local time derivative, $\\frac{d}{dt}$, since the velocities are functions of time only.\n\nThe governing equations for the horizontal velocities $u(t)$ and $v(t)$ thus reduce to the following linear system:\n$$\n\\frac{du}{dt} = fv \\quad (1)\n$$\n$$\n\\frac{dv}{dt} = -fu \\quad (2)\n$$\n\nTo solve this system, we can decouple the equations. Differentiate equation (1) with respect to time $t$:\n$$\n\\frac{d^2u}{dt^2} = f \\frac{dv}{dt}\n$$\nSubstitute equation (2) into this expression:\n$$\n\\frac{d^2u}{dt^2} = f(-fu) = -f^2 u\n$$\nThis gives a second-order linear homogeneous ordinary differential equation for $u(t)$:\n$$\n\\frac{d^2u}{dt^2} + f^2 u = 0\n$$\nThis is the equation for a simple harmonic oscillator. The general solution for $u(t)$ is:\n$$\nu(t) = A \\cos(ft) + B \\sin(ft)\n$$\nwhere $A$ and $B$ are constants of integration.\n\nTo find $v(t)$, we use equation (1): $v = \\frac{1}{f} \\frac{du}{dt}$.\nFirst, we find $\\frac{du}{dt}$:\n$$\n\\frac{du}{dt} = -Af \\sin(ft) + Bf \\cos(ft)\n$$\nThen, we find $v(t)$:\n$$\nv(t) = \\frac{1}{f} \\left( -Af \\sin(ft) + Bf \\cos(ft) \\right) = -A \\sin(ft) + B \\cos(ft)\n$$\n\nNow, we apply the initial conditions at $t=0^{+}$ (which we denote as $t=0$ for the solution valid for $t>0$): $u(0) = U_{0}$ and $v(0) = 0$.\nFor $u(t)$:\n$$\nu(0) = A \\cos(0) + B \\sin(0) = A \\cdot 1 + B \\cdot 0 = A\n$$\nThus, $A = U_{0}$.\n\nFor $v(t)$:\n$$\nv(0) = -A \\sin(0) + B \\cos(0) = -A \\cdot 0 + B \\cdot 1 = B\n$$\nThus, $B = 0$.\n\nSubstituting the values of the constants $A=U_{0}$ and $B=0$ back into the general solutions, we obtain the specific solutions for $u(t)$ and $v(t)$:\n$$\nu(t) = U_{0} \\cos(ft)\n$$\n$$\nv(t) = -U_{0} \\sin(ft)\n$$\nThese equations describe the time evolution of the velocity components for $t>0$. This motion is known as an inertial oscillation, where the velocity vector rotates clockwise (for $f>0$ in the Northern Hemisphere) with a constant magnitude $|U_{0}|$ and an angular frequency $f$. The period of this oscillation is the inertial period, $T = \\frac{2\\pi}{|f|}$.\nThe velocities $u(t)$ and $v(t)$ have the units of $U_{0}$, which is a velocity (meters per second). The argument of the trigonometric functions, $ft$, is dimensionless (radians), as required.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} U_{0}\\cos(ft) & -U_{0}\\sin(ft) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "The ultimate test of an approximation lies in a quantitative comparison against the full dynamics, a task central to computational science. This advanced practice guides you through designing a numerical experiment to precisely measure the differences between the traditional approximation and the full Coriolis force in the context of internal gravity waves. By working in spectral space and analyzing the wave dispersion relation, you will quantify how the approximation alters wave frequency and group velocity, revealing the conditions under which 'nontraditional' effects become significant.",
            "id": "3816621",
            "problem": "You are tasked with designing and executing a reproducible numerical experiment that compares dynamics under the traditional approximation for the Coriolis force and the full Coriolis force for a three-dimensional internal gravity wave packet in a uniformly stratified Boussinesq fluid, within a local Cartesian frame appropriate to computational oceanography. Your program must implement a linear, inviscid, incompressible model evolved in spectral (Fourier) space and produce clear diagnostics quantifying differences between the two dynamical treatments.\n\nStart from the following fundamental base:\n- The linearized Boussinesq equations for a rotating, stably stratified fluid in a local Cartesian frame $(x,y,z)$, with velocity $\\mathbf{u}=(u,v,w)$, pressure $p$, and buoyancy $b$, are given by\n$$\\frac{\\partial \\mathbf{u}}{\\partial t} + 2\\boldsymbol{\\Omega}\\times \\mathbf{u} = -\\nabla p + b\\,\\hat{\\mathbf{z}},$$\n$$\\frac{\\partial b}{\\partial t} + N^2 w = 0,$$\n$$\\nabla\\cdot \\mathbf{u} = 0,$$\nwhere $N$ is the Brunt–Väisälä frequency, $\\boldsymbol{\\Omega}$ is the Earth’s angular velocity vector, and $\\hat{\\mathbf{z}}$ is the unit vector in the vertical.\n- The traditional approximation (TA) retains only the local vertical component of rotation $2\\Omega\\sin\\phi$ in the Coriolis term, where $\\Omega$ is the Earth’s rotation rate and $\\phi$ is latitude (angle in degrees; your program must convert to radians internally). The full Coriolis force retains both the vertical component $2\\Omega\\sin\\phi$ and the horizontal component $2\\Omega\\cos\\phi$.\n- Work in spectral space for a single Fourier mode with wavenumber vector $\\mathbf{k}=(k_x,k_y,m)$ and use the incompressible projection that eliminates pressure by projecting the right-hand side onto the divergence-free subspace.\n\nDerive the spectral evolution operator for the state vector $(u,v,w,b)$, and implement it numerically as follows:\n- Define the $3\\times 3$ projection matrix\n$$\\mathbf{P} = \\mathbf{I} - \\hat{\\mathbf{k}}\\,\\hat{\\mathbf{k}}^{\\mathsf{T}},\\quad \\hat{\\mathbf{k}}=\\frac{\\mathbf{k}}{\\lVert \\mathbf{k}\\rVert},$$\nand the linear Coriolis cross-product operator $\\mathbf{B}$ such that $2\\boldsymbol{\\Omega}\\times \\mathbf{u}=\\mathbf{B}\\,\\mathbf{u}$ in the local frame $(x,y,z)$ with $2\\boldsymbol{\\Omega}=(0,2\\Omega\\cos\\phi,2\\Omega\\sin\\phi)$. Explicitly, use\n$$\\mathbf{B}=\\begin{pmatrix}\n0 & -f_v & f_h \\\\\nf_v & 0 & 0 \\\\\n-f_h & 0 & 0\n\\end{pmatrix},\\quad f_v=2\\Omega\\sin\\phi,\\quad f_h=2\\Omega\\cos\\phi,$$\nand for the traditional approximation set $f_h=0$ while retaining $f_v$.\n- The $3\\times 3$ velocity operator is $\\mathbf{M}=-\\mathbf{P}\\mathbf{B}$, and the buoyancy forcing enters the velocity equation through $\\mathbf{F}_b=\\mathbf{P}\\,\\hat{\\mathbf{z}}$. The coupled $4\\times 4$ linear operator for $(u,v,w,b)$ is\n$$\\mathbf{L}=\\begin{pmatrix}\n\\mathbf{M} & \\mathbf{F}_b \\\\\n\\mathbf{0}_{1\\times 3} & 0\n\\end{pmatrix}\n+\\begin{pmatrix}\n\\mathbf{0}_{3\\times 3} & \\mathbf{0}_{3\\times 1} \\\\\n\\begin{matrix} 0 & 0 & -N^2 \\end{matrix} & 0\n\\end{pmatrix},$$\nwhich implies\n$$\\frac{d}{dt}\\begin{pmatrix} u \\\\ v \\\\ w \\\\ b \\end{pmatrix} = \\mathbf{L}\\begin{pmatrix} u \\\\ v \\\\ w \\\\ b \\end{pmatrix}.$$\n\nDesign a wave packet characterized by a central wavenumber $\\mathbf{k}_0=(k_{0x},k_{0y},m_0)$ and quantify the following diagnostics by analyzing the internal gravity wave eigenfrequency and its gradient with respect to wavenumber:\n- Extract the positive internal gravity wave eigenfrequency $\\omega(\\mathbf{k}_0)$ from the spectrum of $\\mathbf{L}$ for both the traditional approximation and the full Coriolis operator. Compute the frequency difference\n$$\\Delta\\omega = \\left\\lvert\\omega_{\\mathrm{full}}(\\mathbf{k}_0)-\\omega_{\\mathrm{TA}}(\\mathbf{k}_0)\\right\\rvert\\quad\\text{in}\\ \\mathrm{s^{-1}}.$$\n- Estimate the group velocity $\\mathbf{c}_g(\\mathbf{k}_0)=\\nabla_{\\mathbf{k}}\\omega(\\mathbf{k}_0)$ for both models using centered finite differences with wavenumber increments equal to the fundamental spectral spacings $\\delta k_x=2\\pi/L_x$, $\\delta k_y=2\\pi/L_y$, and $\\delta m=2\\pi/L_z$ determined by the domain sizes. Compute the magnitude of the group velocity difference\n$$\\Delta c_g = \\left\\lVert \\mathbf{c}_{g,\\mathrm{full}}(\\mathbf{k}_0) - \\mathbf{c}_{g,\\mathrm{TA}}(\\mathbf{k}_0)\\right\\rVert\\quad\\text{in}\\ \\mathrm{m/s}.$$\n- Compute the horizontal-to-vertical anisotropy ratio for the group velocity\n$$R=\\frac{\\sqrt{c_{g,x}^2+c_{g,y}^2}}{\\lvert c_{g,z}\\rvert},$$\nfor both models and report the dimensionless ratio $R_{\\mathrm{full}}/R_{\\mathrm{TA}}$.\n\nYour numerical experiment must be fully specified by the following domain and resolution, along with central wavenumber and stratification, for each test case. Angles are provided in degrees and must be internally converted to radians. Use the Earth’s rotation rate $\\Omega=7.2921159\\times 10^{-5}\\ \\mathrm{s^{-1}}$. The final outputs for each test case must be three floating-point numbers: $\\Delta\\omega$ in $\\mathrm{s^{-1}}$, $\\Delta c_g$ in $\\mathrm{m/s}$, and $R_{\\mathrm{full}}/R_{\\mathrm{TA}}$ (dimensionless). Print each value rounded to $6$ decimal places.\n\nTest suite:\n- Case $1$ (near-equatorial, nontraditional effects strongest):\n  - Latitude $\\phi=0^\\circ$,\n  - Stratification $N=1.0\\times 10^{-3}\\ \\mathrm{s^{-1}}$,\n  - Domain sizes $L_x=160{,}000\\ \\mathrm{m}$, $L_y=160{,}000\\ \\mathrm{m}$, $L_z=4{,}000\\ \\mathrm{m}$,\n  - Resolutions $N_x=64$, $N_y=64$, $N_z=64$,\n  - Central wavenumber components $k_{0x}=2\\pi/(20{,}000\\ \\mathrm{m})$, $k_{0y}=2\\pi/(40{,}000\\ \\mathrm{m})$, $m_0=2\\pi/(500\\ \\mathrm{m})$.\n- Case $2$ (mid-latitude):\n  - Latitude $\\phi=45^\\circ$,\n  - Stratification $N=1.2\\times 10^{-3}\\ \\mathrm{s^{-1}}$,\n  - Domain sizes $L_x=200{,}000\\ \\mathrm{m}$, $L_y=200{,}000\\ \\mathrm{m}$, $L_z=5{,}000\\ \\mathrm{m}$,\n  - Resolutions $N_x=64$, $N_y=64$, $N_z=64$,\n  - Central wavenumber components $k_{0x}=2\\pi/(30{,}000\\ \\mathrm{m})$, $k_{0y}=2\\pi/(30{,}000\\ \\mathrm{m})$, $m_0=2\\pi/(1{,}000\\ \\mathrm{m})$.\n- Case $3$ (high latitude):\n  - Latitude $\\phi=80^\\circ$,\n  - Stratification $N=8.0\\times 10^{-4}\\ \\mathrm{s^{-1}}$,\n  - Domain sizes $L_x=150{,}000\\ \\mathrm{m}$, $L_y=150{,}000\\ \\mathrm{m}$, $L_z=3{,}000\\ \\mathrm{m}$,\n  - Resolutions $N_x=48$, $N_y=48$, $N_z=48$,\n  - Central wavenumber components $k_{0x}=2\\pi/(50{,}000\\ \\mathrm{m})$, $k_{0y}=2\\pi/(25{,}000\\ \\mathrm{m})$, $m_0=2\\pi/(300\\ \\mathrm{m})$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for the three cases as a comma-separated list of lists, each inner list holding the three diagnostics in the order $[\\Delta\\omega,\\Delta c_g,R_{\\mathrm{full}}/R_{\\mathrm{TA}}]$, with each number rounded to $6$ decimal places, enclosed in square brackets. For example, the printed line should look like\n$$[[0.000123,0.012345,1.234567],[\\ldots],[\\ldots]].$$",
            "solution": "The user-provided problem is valid. It is scientifically grounded in the principles of geophysical fluid dynamics, specifically the study of internal gravity waves under the influence of the Coriolis force. The problem is well-posed, providing a complete mathematical framework and all necessary parameters to compute a unique, verifiable solution. The tasks are objective and the methodology, based on spectral analysis and numerical differentiation, is standard in computational physics.\n\nThe solution proceeds as follows: First, we construct the linear evolution operator $\\mathbf{L}$ for a single Fourier mode of the linearized, inviscid, incompressible Boussinesq equations. This operator's form depends on whether the full Coriolis force or the traditional approximation is used. Second, we find the eigenfrequency $\\omega$ of the internal gravity wave mode by computing the eigenvalues of $\\mathbf{L}$. Third, we numerically estimate the group velocity $\\mathbf{c}_g = \\nabla_{\\mathbf{k}}\\omega$ using a centered finite-difference scheme. Finally, we compute the specified diagnostic quantities—the frequency difference $\\Delta\\omega$, the group velocity difference magnitude $\\Delta c_g$, and the group velocity anisotropy ratio $R_{\\mathrm{full}}/R_{\\mathrm{TA}}$—for three distinct test cases representing equatorial, mid-latitude, and high-latitude oceanic conditions.\n\nThe state of the fluid for a single Fourier mode with wavenumber vector $\\mathbf{k}=(k_x, k_y, m)$ is described by the complex amplitudes of velocity and buoyancy, forming a state vector $\\hat{\\boldsymbol{\\psi}} = (\\hat{u}, \\hat{v}, \\hat{w}, \\hat{b})^{\\mathsf{T}}$. Its time evolution is governed by a system of linear ordinary differential equations:\n$$ \\frac{d}{dt}\\hat{\\boldsymbol{\\psi}} = \\mathbf{L} \\hat{\\boldsymbol{\\psi}} $$\nThe $4 \\times 4$ matrix operator $\\mathbf{L}$ encapsulates the dynamics. We construct it following the problem's specifications. The Coriolis force appears in the momentum equations as the term $2\\boldsymbol{\\Omega}\\times \\mathbf{u}$. In our local Cartesian frame, the Earth's rotation vector is $2\\boldsymbol{\\Omega} = (0, f_h, f_v)$, where $f_v = 2\\Omega\\sin\\phi$ is the vertical component (the planetary vorticity) and $f_h = 2\\Omega\\cos\\phi$ is the horizontal component. Here, $\\Omega$ is the Earth's rotation rate and $\\phi$ is the latitude. The cross product is represented by the matrix $\\mathbf{B}$:\n$$ 2\\boldsymbol{\\Omega}\\times \\mathbf{u} = \\begin{pmatrix} 0 & -f_v & f_h \\\\ f_v & 0 & 0 \\\\ -f_h & 0 & 0 \\end{pmatrix} \\begin{pmatrix} u \\\\ v \\\\ w \\end{pmatrix} = \\mathbf{B}\\mathbf{u} $$\nThe traditional approximation (TA) consists of neglecting the horizontal component of rotation, which is equivalent to setting $f_h=0$. This approximation is valid for motions with large aspect ratios (horizontal scales much larger than vertical scales) but breaks down for submesoscale phenomena or near the equator.\n\nThe incompressibility constraint, $\\nabla \\cdot \\mathbf{u} = 0$, becomes $i\\mathbf{k} \\cdot \\hat{\\mathbf{u}} = 0$ in Fourier space. This is enforced by projecting the momentum equation's right-hand side onto the divergence-free subspace, which is the plane perpendicular to the wavenumber vector $\\mathbf{k}$. The projection operator is $\\mathbf{P} = \\mathbf{I} - \\hat{\\mathbf{k}}\\hat{\\mathbf{k}}^{\\mathsf{T}}$, where $\\mathbf{I}$ is the $3 \\times 3$ identity matrix and $\\hat{\\mathbf{k}} = \\mathbf{k}/\\lVert\\mathbf{k}\\rVert$ is the unit wavenumber vector.\n\nThe projected momentum equation becomes:\n$$ \\frac{\\partial \\hat{\\mathbf{u}}}{\\partial t} = -\\mathbf{P}(\\mathbf{B}\\hat{\\mathbf{u}}) + \\mathbf{P}(b\\,\\hat{\\mathbf{z}}) = \\mathbf{M}\\hat{\\mathbf{u}} + \\mathbf{F}_b \\hat{b} $$\nwhere $\\mathbf{M} = -\\mathbf{P}\\mathbf{B}$ is the $3 \\times 3$ velocity operator and $\\mathbf{F}_b = \\mathbf{P}\\hat{\\mathbf{z}}$ is the buoyancy forcing vector in the velocity subspace. The buoyancy equation is $\\partial \\hat{b}/\\partial t = -N^2 \\hat{w}$. Combining these, we assemble the complete $4 \\times 4$ operator $\\mathbf{L}$:\n$$ \\mathbf{L} = \\begin{pmatrix} M_{11} & M_{12} & M_{13} & F_{b,1} \\\\ M_{21} & M_{22} & M_{23} & F_{b,2} \\\\ M_{31} & M_{32} & M_{33} & F_{b,3} \\\\ 0 & 0 & -N^2 & 0 \\end{pmatrix} $$\nWave-like solutions of the form $\\hat{\\boldsymbol{\\psi}}(t) = \\hat{\\boldsymbol{\\psi}}_0 e^{\\lambda t}$ exist if $\\lambda$ is an eigenvalue of $\\mathbf{L}$. For a non-dissipative system, these eigenvalues are purely imaginary, $\\lambda = \\pm i\\omega$, where $\\omega$ is the wave frequency. The internal gravity wave frequency $\\omega(\\mathbf{k})$ is found by numerically computing the eigenvalues of $\\mathbf{L}$ for a given $\\mathbf{k}$ and identifying the unique positive frequency among the imaginary parts of the eigenvalues.\n\nThe group velocity, $\\mathbf{c}_g = \\nabla_{\\mathbf{k}}\\omega$, describes the propagation velocity of a wave packet's energy. We estimate its components using a second-order centered finite-difference formula, as specified:\n$$ c_{g,x}(\\mathbf{k}_0) = \\frac{\\partial\\omega}{\\partial k_x}\\bigg|_{\\mathbf{k}_0} \\approx \\frac{\\omega(k_{0x}+\\delta k_x, k_{0y}, m_0) - \\omega(k_{0x}-\\delta k_x, k_{0y}, m_0)}{2\\delta k_x} $$\nAnalogous expressions are used for $c_{g,y}$ and $c_{g,z}$. The wavenumber increments $\\delta k_x$, $\\delta k_y$, and $\\delta m$ are determined by the fundamental modes of the specified domain sizes, $L_x$, $L_y$, and $L_z$, respectively (e.g., $\\delta k_x = 2\\pi/L_x$).\n\nThe numerical implementation consists of a primary function that, for each test case, calculates the Coriolis parameters ($f_v, f_h$) and wavenumber increments. It then calls a core routine twice: once for the full Coriolis model ($f_h \\neq 0$) and once for the traditional approximation ($f_h=0$). This core routine constructs the operator $\\mathbf{L}$ for the central wavenumber $\\mathbf{k}_0$ and for the neighboring wavenumbers required by the finite-difference scheme. It computes the corresponding frequencies by eigenvalue decomposition and then assembles the group velocity vector $\\mathbf{c}_g(\\mathbf{k}_0)$. Finally, the main function computes the differences $\\Delta\\omega$ and $\\Delta c_g$, and the anisotropy ratio $R_{\\mathrm{full}}/R_{\\mathrm{TA}}$ before returning the three required diagnostics. This procedure is repeated for all provided test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the numerical experiment for all test cases and print the results.\n    \"\"\"\n    OMEGA = 7.2921159e-5  # Earth's rotation rate in rad/s\n\n    test_cases = [\n        {\n            \"phi_deg\": 0, \"N\": 1.0e-3,\n            \"Lx\": 160000, \"Ly\": 160000, \"Lz\": 4000,\n            \"k0x\": 2 * np.pi / 20000, \"k0y\": 2 * np.pi / 40000, \"m0\": 2 * np.pi / 500\n        },\n        {\n            \"phi_deg\": 45, \"N\": 1.2e-3,\n            \"Lx\": 200000, \"Ly\": 200000, \"Lz\": 5000,\n            \"k0x\": 2 * np.pi / 30000, \"k0y\": 2 * np.pi / 30000, \"m0\": 2 * np.pi / 1000\n        },\n        {\n            \"phi_deg\": 80, \"N\": 8.0e-4,\n            \"Lx\": 150000, \"Ly\": 150000, \"Lz\": 3000,\n            \"k0x\": 2 * np.pi / 50000, \"k0y\": 2 * np.pi / 25000, \"m0\": 2 * np.pi / 300\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        results = compute_diagnostics(case, OMEGA)\n        all_results.append([f\"{val:.6f}\" for val in results])\n\n    # Format the final output as a string representing a list of lists.\n    output_str = \"[\" + ','.join([f\"[{','.join(res)}]\" for res in all_results]) + \"]\"\n    print(output_str)\n\ndef compute_diagnostics(params, OMEGA):\n    \"\"\"\n    Computes the diagnostics for a single test case.\n    \"\"\"\n    phi_rad = np.deg2rad(params[\"phi_deg\"])\n    N = params[\"N\"]\n    k0 = np.array([params[\"k0x\"], params[\"k0y\"], params[\"m0\"]])\n    \n    # Fundamental wavenumber spacings for finite differences\n    dk_vec = np.array([\n        2 * np.pi / params[\"Lx\"],\n        2 * np.pi / params[\"Ly\"],\n        2 * np.pi / params[\"Lz\"]\n    ])\n    \n    fv = 2 * OMEGA * np.sin(phi_rad)\n    fh = 2 * OMEGA * np.cos(phi_rad)\n\n    # Calculate diagnostics for the full model\n    omega_full, cg_full, R_full = calculate_wave_properties(k0, dk_vec, N, fv, fh)\n    \n    # Calculate diagnostics for the Traditional Approximation (TA) model\n    omega_TA, cg_TA, R_TA = calculate_wave_properties(k0, dk_vec, N, fv, 0.0)\n    \n    # Compute the final comparative diagnostics\n    delta_omega = np.abs(omega_full - omega_TA)\n    \n    delta_cg_vec = cg_full - cg_TA\n    delta_cg_mag = np.linalg.norm(delta_cg_vec)\n    \n    # Handle potential division by zero if R_TA is zero\n    ratio_R = R_full / R_TA if R_TA != 0 else np.inf\n\n    return delta_omega, delta_cg_mag, ratio_R\n\ndef get_igw_frequency(k, N, fv, fh):\n    \"\"\"\n    Constructs the linear operator L and finds the internal gravity wave frequency.\n    \"\"\"\n    kx, ky, m = k\n    k_norm = np.linalg.norm(k)\n    \n    if k_norm == 0:\n        return 0.0\n    \n    k_hat = k / k_norm\n    \n    # Projection matrix P = I - k_hat . k_hat^T\n    P = np.identity(3) - np.outer(k_hat, k_hat)\n    \n    # Coriolis matrix B\n    B = np.array([\n        [0, -fv, fh],\n        [fv, 0, 0],\n        [-fh, 0, 0]\n    ])\n    \n    # Velocity operator M = -P * B\n    M = -P @ B\n    \n    # Buoyancy forcing vector Fb = P * z_hat\n    z_hat = np.array([0, 0, 1.0])\n    Fb = P @ z_hat\n    \n    # Assemble the 4x4 linear operator L\n    L = np.zeros((4, 4))\n    L[:3, :3] = M\n    L[:3, 3] = Fb\n    L[3, 2] = -N**2\n    \n    # Eigenvalues of L are lambda = +/- i*omega\n    # Frequencies are |imag(eigenvalues)|\n    eigenvalues = np.linalg.eigvals(L)\n    frequencies = np.abs(np.imag(eigenvalues))\n    \n    # The IGW frequency is the largest non-zero frequency\n    return np.max(frequencies)\n\ndef calculate_wave_properties(k0, dk_vec, N, fv, fh):\n    \"\"\"\n    Calculates omega(k0), cg(k0), and the anisotropy ratio R for a given model.\n    \"\"\"\n    \n    # Central frequency\n    omega0 = get_igw_frequency(k0, N, fv, fh)\n    \n    # Group velocity via centered finite differences\n    cg = np.zeros(3)\n    \n    # x-component\n    kx_plus = k0 + np.array([dk_vec[0], 0, 0])\n    kx_minus = k0 - np.array([dk_vec[0], 0, 0])\n    omega_x_plus = get_igw_frequency(kx_plus, N, fv, fh)\n    omega_x_minus = get_igw_frequency(kx_minus, N, fv, fh)\n    cg[0] = (omega_x_plus - omega_x_minus) / (2 * dk_vec[0])\n    \n    # y-component\n    ky_plus = k0 + np.array([0, dk_vec[1], 0])\n    ky_minus = k0 - np.array([0, dk_vec[1], 0])\n    omega_y_plus = get_igw_frequency(ky_plus, N, fv, fh)\n    omega_y_minus = get_igw_frequency(ky_minus, N, fv, fh)\n    cg[1] = (omega_y_plus - omega_y_minus) / (2 * dk_vec[1])\n    \n    # z-component\n    km_plus = k0 + np.array([0, 0, dk_vec[2]])\n    km_minus = k0 - np.array([0, 0, dk_vec[2]])\n    omega_m_plus = get_igw_frequency(km_plus, N, fv, fh)\n    omega_m_minus = get_igw_frequency(km_minus, N, fv, fh)\n    cg[2] = (omega_m_plus - omega_m_minus) / (2 * dk_vec[2])\n    \n    # Anisotropy ratio R\n    cg_horiz_mag = np.sqrt(cg[0]**2 + cg[1]**2)\n    cg_vert_mag = np.abs(cg[2])\n    \n    R = cg_horiz_mag / cg_vert_mag if cg_vert_mag != 0 else np.inf\n    \n    return omega0, cg, R\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}