{
    "hands_on_practices": [
        {
            "introduction": "To model large-scale ocean dynamics, we must first express the effect of Earth's rotation in a local tangent-plane coordinate system. This foundational exercise guides you through the derivation of the Coriolis parameter, $f$, from the fundamental vector expression for the Coriolis acceleration. By completing this practice , you will solidify your understanding of how the vertical component of planetary rotation governs horizontal motion and how its magnitude varies with latitude.",
            "id": "3788719",
            "problem": "Consider a local Cartesian frame aligned with the tangent plane to the Earth at latitude $\\phi$, with unit vectors $\\hat{\\boldsymbol{i}}$ (east), $\\hat{\\boldsymbol{j}}$ (north), and $\\hat{\\boldsymbol{k}}$ (up). A fluid parcel moving with horizontal velocity $\\boldsymbol{u} = u\\,\\hat{\\boldsymbol{i}} + v\\,\\hat{\\boldsymbol{j}}$ is described in the rotating Earth frame by Newton’s second law augmented with apparent accelerations. The Coriolis acceleration is given by the fundamental rotating-frame expression $\\boldsymbol{a}_{\\mathrm{cor}} = -2\\,\\boldsymbol{\\Omega} \\times \\boldsymbol{u}$, where $\\boldsymbol{\\Omega}$ is Earth’s rotation vector. Using the geometric relationship between $\\boldsymbol{\\Omega}$ and the local vertical $\\hat{\\boldsymbol{k}}$ at latitude $\\phi$, derive from first principles a scalar quantity $f$ (the Coriolis parameter) that multiplies the horizontal vector $\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u}$ in the horizontal momentum equations. Then, for an Earth with constant rotation rate $\\Omega = 7.2921 \\times 10^{-5}\\ \\mathrm{s^{-1}}$, evaluate the derived $f$ at latitudes $\\phi = 30^\\circ$ and $\\phi = 60^\\circ$. State the sign of $f$ at these latitudes and compare their magnitudes based on your derivation. Express each computed value of $f$ in $\\mathrm{s^{-1}}$, rounded to four significant figures. Angles are given in degrees.",
            "solution": "The problem statement is scientifically grounded, well-posed, objective, and internally consistent. It presents a standard derivation in geophysical fluid dynamics. We shall therefore proceed with the solution.\n\nThe Coriolis acceleration, $\\boldsymbol{a}_{\\mathrm{cor}}$, experienced by a fluid parcel with velocity $\\boldsymbol{u}$ in a frame rotating with angular velocity $\\boldsymbol{\\Omega}$ is given by:\n$$\n\\boldsymbol{a}_{\\mathrm{cor}} = -2\\,\\boldsymbol{\\Omega} \\times \\boldsymbol{u}\n$$\n\nThe problem defines a local Cartesian coordinate system on the surface of the Earth at a latitude $\\phi$. The unit vectors are $\\hat{\\boldsymbol{i}}$ pointing east, $\\hat{\\boldsymbol{j}}$ pointing north, and $\\hat{\\boldsymbol{k}}$ pointing vertically upwards. The fluid parcel's velocity is restricted to the horizontal plane, so $\\boldsymbol{u} = u\\,\\hat{\\boldsymbol{i}} + v\\,\\hat{\\boldsymbol{j}}$.\n\nOur first step is to express the Earth's rotation vector, $\\boldsymbol{\\Omega}$, in this local coordinate system. The vector $\\boldsymbol{\\Omega}$ points along the Earth's axis of rotation, from south to north. Its magnitude is $\\Omega$. At a latitude $\\phi$ in the Northern Hemisphere, the rotation axis makes an angle $\\phi$ with the local horizontal plane. The projection of $\\boldsymbol{\\Omega}$ onto the local meridian plane (the $\\hat{\\boldsymbol{j}}$-$\\hat{\\boldsymbol{k}}$ plane) can be resolved into its components.\nThe component along the local north direction, $\\hat{\\boldsymbol{j}}$, is $\\Omega \\cos(\\phi)$.\nThe component along the local vertical direction, $\\hat{\\boldsymbol{k}}$, is $\\Omega \\sin(\\phi)$.\nThere is no component in the east-west direction, so the $\\hat{\\boldsymbol{i}}$ component is zero. Thus, the rotation vector is:\n$$\n\\boldsymbol{\\Omega} = (\\Omega \\cos(\\phi))\\,\\hat{\\boldsymbol{j}} + (\\Omega \\sin(\\phi))\\,\\hat{\\boldsymbol{k}}\n$$\n\nNext, we compute the cross product $\\boldsymbol{\\Omega} \\times \\boldsymbol{u}$:\n$$\n\\boldsymbol{\\Omega} \\times \\boldsymbol{u} = \\begin{vmatrix}\n\\hat{\\boldsymbol{i}} & \\hat{\\boldsymbol{j}} & \\hat{\\boldsymbol{k}} \\\\\n0 & \\Omega \\cos(\\phi) & \\Omega \\sin(\\phi) \\\\\nu & v & 0\n\\end{vmatrix}\n$$\nEvaluating the determinant gives:\n$$\n\\boldsymbol{\\Omega} \\times \\boldsymbol{u} = \\hat{\\boldsymbol{i}}((\\Omega \\cos(\\phi))(0) - v(\\Omega \\sin(\\phi))) - \\hat{\\boldsymbol{j}}((0)(0) - u(\\Omega \\sin(\\phi))) + \\hat{\\boldsymbol{k}}((0)(v) - u(\\Omega \\cos(\\phi)))\n$$\n$$\n\\boldsymbol{\\Omega} \\times \\boldsymbol{u} = -v\\,\\Omega \\sin(\\phi)\\,\\hat{\\boldsymbol{i}} + u\\,\\Omega \\sin(\\phi)\\,\\hat{\\boldsymbol{j}} - u\\,\\Omega \\cos(\\phi)\\,\\hat{\\boldsymbol{k}}\n$$\n\nNow, we substitute this back into the expression for the Coriolis acceleration:\n$$\n\\boldsymbol{a}_{\\mathrm{cor}} = -2(-v\\,\\Omega \\sin(\\phi)\\,\\hat{\\boldsymbol{i}} + u\\,\\Omega \\sin(\\phi)\\,\\hat{\\boldsymbol{j}} - u\\,\\Omega \\cos(\\phi)\\,\\hat{\\boldsymbol{k}})\n$$\n$$\n\\boldsymbol{a}_{\\mathrm{cor}} = (2v\\,\\Omega \\sin(\\phi))\\,\\hat{\\boldsymbol{i}} - (2u\\,\\Omega \\sin(\\phi))\\,\\hat{\\boldsymbol{j}} + (2u\\,\\Omega \\cos(\\phi))\\,\\hat{\\boldsymbol{k}}\n$$\n\nThe horizontal momentum equations only concern the horizontal components of acceleration, which are the $\\hat{\\boldsymbol{i}}$ and $\\hat{\\boldsymbol{j}}$ components. The horizontal Coriolis acceleration, $\\boldsymbol{a}_{\\mathrm{cor,h}}$, is therefore:\n$$\n\\boldsymbol{a}_{\\mathrm{cor,h}} = (2v\\,\\Omega \\sin(\\phi))\\,\\hat{\\boldsymbol{i}} - (2u\\,\\Omega \\sin(\\phi))\\,\\hat{\\boldsymbol{j}}\n$$\n\nThe problem asks to relate this to a term containing the vector $\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u}$. We compute this vector:\n$$\n\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u} = \\hat{\\boldsymbol{k}} \\times (u\\,\\hat{\\boldsymbol{i}} + v\\,\\hat{\\boldsymbol{j}}) = u(\\hat{\\boldsymbol{k}} \\times \\hat{\\boldsymbol{i}}) + v(\\hat{\\boldsymbol{k}} \\times \\hat{\\boldsymbol{j}})\n$$\nUsing the cyclic relations for a right-handed coordinate system ($\\hat{\\boldsymbol{k}} \\times \\hat{\\boldsymbol{i}} = \\hat{\\boldsymbol{j}}$ and $\\hat{\\boldsymbol{k}} \\times \\hat{\\boldsymbol{j}} = -\\hat{\\boldsymbol{i}}$):\n$$\n\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u} = u\\,\\hat{\\boldsymbol{j}} - v\\,\\hat{\\boldsymbol{i}}\n$$\n\nNow we can compare $\\boldsymbol{a}_{\\mathrm{cor,h}}$ with $\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u}$. We can factor out the scalar term from our expression for $\\boldsymbol{a}_{\\mathrm{cor,h}}$:\n$$\n\\boldsymbol{a}_{\\mathrm{cor,h}} = (2\\,\\Omega \\sin(\\phi))(v\\,\\hat{\\boldsymbol{i}} - u\\,\\hat{\\boldsymbol{j}})\n$$\nNotice that $(v\\,\\hat{\\boldsymbol{i}} - u\\,\\hat{\\boldsymbol{j}}) = -(u\\,\\hat{\\boldsymbol{j}} - v\\,\\hat{\\boldsymbol{i}}) = -(\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u})$.\nTherefore, we can write the horizontal Coriolis acceleration as:\n$$\n\\boldsymbol{a}_{\\mathrm{cor,h}} = -(2\\,\\Omega \\sin(\\phi))(\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u})\n$$\nThe quantity $2\\,\\Omega \\sin(\\phi)$ is defined as the Coriolis parameter, conventionally denoted by $f$.\n$$\nf \\equiv 2\\,\\Omega \\sin(\\phi)\n$$\nThus, the term appearing in the horizontal momentum equations is $-f(\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u})$. The problem asks to derive the scalar quantity $f$ that \"multiplies\" $\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u}$. Based on the standard definition, which is implied by the problem statement's use of \"$f$ (the Coriolis parameter)\", we identify $f$ as the positive quantity $2\\,\\Omega \\sin(\\phi)$. The full multiplicative factor on $\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u}$ is $-f$.\n\nWe are now tasked with evaluating $f$ for the given parameters.\nThe Earth's rotation rate is $\\Omega = 7.2921 \\times 10^{-5}\\ \\mathrm{s^{-1}}$.\n\nCase 1: Latitude $\\phi = 30^\\circ$.\nThe Coriolis parameter $f$ at this latitude is:\n$$\nf_{30} = 2\\,\\Omega \\sin(30^\\circ) = 2(7.2921 \\times 10^{-5}\\ \\mathrm{s^{-1}})(0.5)\n$$\n$$\nf_{30} = 7.2921 \\times 10^{-5}\\ \\mathrm{s^{-1}}\n$$\nRounding to four significant figures, we get $7.292 \\times 10^{-5}\\ \\mathrm{s^{-1}}$.\n\nCase 2: Latitude $\\phi = 60^\\circ$.\nThe Coriolis parameter $f$ at this latitude is:\n$$\nf_{60} = 2\\,\\Omega \\sin(60^\\circ) = 2(7.2921 \\times 10^{-5}\\ \\mathrm{s^{-1}})\\left(\\frac{\\sqrt{3}}{2}\\right)\n$$\n$$\nf_{60} = (7.2921 \\times 10^{-5})(\\sqrt{3})\\ \\mathrm{s^{-1}} \\approx 12.6305 \\times 10^{-5}\\ \\mathrm{s^{-1}} = 1.26305 \\times 10^{-4}\\ \\mathrm{s^{-1}}\n$$\nRounding to four significant figures, we get $1.263 \\times 10^{-4}\\ \\mathrm{s^{-1}}$.\n\nFinally, we analyze the sign and magnitude.\nThe formula for the Coriolis parameter is $f = 2\\,\\Omega \\sin(\\phi)$.\nThe Earth's rotation rate $\\Omega = |\\boldsymbol{\\Omega}|$ is a positive constant. For the given latitudes $\\phi = 30^\\circ$ and $\\phi = 60^\\circ$, both are in the Northern Hemisphere, so $0 < \\phi \\le 90^\\circ$. In this range, $\\sin(\\phi)$ is positive. Therefore, the sign of $f$ is positive at both latitudes.\nRegarding the magnitudes, the sine function is monotonically increasing on the interval $[0^\\circ, 90^\\circ]$. Since $60^\\circ > 30^\\circ$, we have $\\sin(60^\\circ) > \\sin(30^\\circ)$. Consequently, the magnitude of the Coriolis parameter at $\\phi=60^\\circ$ is greater than its magnitude at $\\phi=30^\\circ$, which is confirmed by our numerical evaluation ($1.263 \\times 10^{-4} > 7.292 \\times 10^{-5}$). This demonstrates that the effect of the Coriolis force on horizontal motion increases with latitude, reaching a maximum at the poles ($\\phi=90^\\circ$) and vanishing at the equator ($\\phi=0^\\circ$).\n\nThe computed values for $f$ at $\\phi=30^\\circ$ and $\\phi=60^\\circ$ are $7.292 \\times 10^{-5}\\ \\mathrm{s^{-1}}$ and $1.263 \\times 10^{-4}\\ \\mathrm{s^{-1}}$, respectively.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 7.292 \\times 10^{-5} & 1.263 \\times 10^{-4} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "The Sverdrup balance is a cornerstone of physical oceanography, providing the primary explanation for the large-scale, wind-driven gyres. This practice  challenges you to apply the $\\beta$-plane approximation to derive the relationship between wind stress curl and the meridional transport in the ocean interior. By solving for the transport streamfunction analytically, you will gain insight into how the variation of the Coriolis parameter with latitude shapes global ocean circulation.",
            "id": "3788695",
            "problem": "Consider a steady, large-scale ocean circulation on a rotating Earth approximated by a $\\beta$-plane with Coriolis parameter $f = f_0 + \\beta y$, where $\\beta$ is constant and $f_0$ is a constant reference value. Assume a hydrostatic, Boussinesq fluid with constant reference density $\\rho_0$ in a closed rectangular basin occupying $0 \\le x \\le L_x$ and $0 \\le y \\le L_y$. Let the wind stress field be\n$$\n\\tau_x(x,y) = \\tau_0 \\cos\\!\\left(\\frac{\\pi y}{L_y}\\right) \\exp\\!\\left(-\\frac{x}{L_x}\\right), \n\\quad\n\\tau_y(x,y) = \\frac{\\tau_0}{2} \\sin\\!\\left(\\frac{2\\pi x}{L_x}\\right) \\sin\\!\\left(\\frac{\\pi y}{L_y}\\right),\n$$\nwith $\\tau_0$ a constant amplitude. Define the vertically integrated transport streamfunction $\\psi(x,y)$ by $U = -\\partial \\psi/\\partial y$ and $V = \\partial \\psi/\\partial x$, where $U$ and $V$ are the zonal and meridional depth-integrated transports, respectively.\n\nStarting from the rotating primitive momentum equations and continuity, and using hydrostatic balance, geostrophic leading-order momentum balance, and vertical integration consistent with large-scale interior dynamics, derive the interior vorticity balance appropriate for the Sverdrup interior. Use this balance, together with the given wind stress field, to obtain an explicit closed-form expression for the interior $\\psi(x,y)$ everywhere in the basin. Impose impermeable solid boundaries on all four sides and adopt an interior boundary condition consistent with a western boundary layer closing the circulation in a closed basin. Clearly state the boundary conditions you use.\n\nExpress your final answer as a single analytic expression for $\\psi(x,y)$ in terms of the parameters $\\tau_0$, $\\beta$, $\\rho_0$, $L_x$, $L_y$, and the coordinates $x$ and $y$. Do not substitute numerical values. No rounding is required. The final answer must be the expression for $\\psi(x,y)$ and must not include units in the final expression.",
            "solution": "The problem requires the derivation of the vertically integrated transport streamfunction, $\\psi(x,y)$, for the interior of a wind-driven ocean basin. The solution proceeds in three main stages: first, the derivation of the Sverdrup relation from the primitive equations; second, the calculation of the wind stress curl; and third, the integration of the Sverdrup relation subject to the appropriate boundary conditions for an interior flow.\n\n**1. Derivation of the Sverdrup Relation**\n\nWe begin with the steady-state, horizontal momentum equations for a Boussinesq fluid on a rotating Earth, neglecting non-linear advection and horizontal friction, which are small for large-scale interior flows.\n$$\n-f v = -\\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial x} + \\frac{1}{\\rho_0} \\frac{\\partial \\tau_{xz}}{\\partial z}\n$$\n$$\nf u = -\\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial y} + \\frac{1}{\\rho_0} \\frac{\\partial \\tau_{yz}}{\\partial z}\n$$\nHere, $u$ and $v$ are the zonal ($x$) and meridional ($y$) velocity components, respectively. $p$ is the pressure, $\\rho_0$ is the constant reference density, and $f = f_0 + \\beta y$ is the Coriolis parameter under the $\\beta$-plane approximation. $\\tau_{xz}$ and $\\tau_{yz}$ are the vertical shear stresses.\n\nWe vertically integrate these equations from the ocean bottom at $z=-H$ to the surface at $z=0$ (approximating the sea surface height $\\eta \\ll H$). Let $U = \\int_{-H}^{0} u \\,dz$ and $V = \\int_{-H}^{0} v \\,dz$ be the zonal and meridional volume transports per unit length. Integrating the equations gives:\n$$\n-f V = -\\frac{1}{\\rho_0} \\int_{-H}^{0} \\frac{\\partial p}{\\partial x} dz + \\frac{1}{\\rho_0} \\left[ \\tau_{xz} \\right]_{-H}^{0}\n$$\n$$\nf U = -\\frac{1}{\\rho_0} \\int_{-H}^{0} \\frac{\\partial p}{\\partial y} dz + \\frac{1}{\\rho_0} \\left[ \\tau_{yz} \\right]_{-H}^{0}\n$$\nThe stress at the surface ($z=0$) is the wind stress, $(\\tau_x, \\tau_y)$. The stress at the bottom ($z=-H$) is the bottom friction, which is neglected for the inviscid interior Sverdrup flow. Thus, $[\\tau_{xz}]_{-H}^{0} = \\tau_x$ and $[\\tau_{yz}]_{-H}^{0} = \\tau_y$. The integrated equations become:\n$$\n-f V = -\\frac{1}{\\rho_0} \\frac{\\partial P}{\\partial x} + \\frac{\\tau_x}{\\rho_0}\n$$\n$$\nf U = -\\frac{1}{\\rho_0} \\frac{\\partial P}{\\partial y} + \\frac{\\tau_y}{\\rho_0}\n$$\nwhere $P = \\int_{-H}^{0} p \\,dz$ is the vertically integrated pressure.\n\nTo eliminate the pressure term $P$, we form the vorticity equation by taking $\\frac{\\partial}{\\partial x}$ of the second equation and subtracting $\\frac{\\partial}{\\partial y}$ of the first equation:\n$$\n\\frac{\\partial}{\\partial x}(fU) - \\frac{\\partial}{\\partial y}(-fV) = -\\frac{1}{\\rho_0} \\left( \\frac{\\partial^2 P}{\\partial x \\partial y} - \\frac{\\partial^2 P}{\\partial y \\partial x} \\right) + \\frac{1}{\\rho_0} \\left( \\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y} \\right)\n$$\nThe pressure term vanishes because of the equality of mixed partials. The left side can be expanded as:\n$$\nf\\left(\\frac{\\partial U}{\\partial x} + \\frac{\\partial V}{\\partial y}\\right) + U\\frac{\\partial f}{\\partial x} + V\\frac{\\partial f}{\\partial y} = \\frac{1}{\\rho_0} \\text{curl}_z(\\vec{\\tau})\n$$\nThe vertically integrated continuity equation for an incompressible fluid is $\\frac{\\partial U}{\\partial x} + \\frac{\\partial V}{\\partial y} = 0$. Using this, the first term on the left side is zero. For the β-plane, $f = f_0 + \\beta y$, so $\\frac{\\partial f}{\\partial x} = 0$ and $\\frac{\\partial f}{\\partial y} = \\beta$. The equation simplifies to:\n$$\n\\beta V = \\frac{1}{\\rho_0} \\text{curl}_z(\\vec{\\tau})\n$$\nThis is the Sverdrup relation, which states that the meridional transport in the ocean interior is determined by the local curl of the wind stress.\n\n**2. Calculation of the Wind Stress Curl**\n\nThe wind stress vector is given by $\\vec{\\tau} = (\\tau_x, \\tau_y)$, with components:\n$$\n\\tau_x(x,y) = \\tau_0 \\cos\\left(\\frac{\\pi y}{L_y}\\right) \\exp\\left(-\\frac{x}{L_x}\\right)\n$$\n$$\n\\tau_y(x,y) = \\frac{\\tau_0}{2} \\sin\\left(\\frac{2\\pi x}{L_x}\\right) \\sin\\left(\\frac{\\pi y}{L_y}\\right)\n$$\nThe vertical component of the curl of the wind stress is $\\text{curl}_z(\\vec{\\tau}) = \\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y}$. We calculate the partial derivatives:\n$$\n\\frac{\\partial \\tau_y}{\\partial x} = \\frac{\\partial}{\\partial x} \\left[ \\frac{\\tau_0}{2} \\sin\\left(\\frac{2\\pi x}{L_x}\\right) \\sin\\left(\\frac{\\pi y}{L_y}\\right) \\right] = \\frac{\\tau_0}{2} \\sin\\left(\\frac{\\pi y}{L_y}\\right) \\left[ \\frac{2\\pi}{L_x} \\cos\\left(\\frac{2\\pi x}{L_x}\\right) \\right] = \\frac{\\pi \\tau_0}{L_x} \\cos\\left(\\frac{2\\pi x}{L_x}\\right) \\sin\\left(\\frac{\\pi y}{L_y}\\right)\n$$\n$$\n\\frac{\\partial \\tau_x}{\\partial y} = \\frac{\\partial}{\\partial y} \\left[ \\tau_0 \\cos\\left(\\frac{\\pi y}{L_y}\\right) \\exp\\left(-\\frac{x}{L_x}\\right) \\right] = \\tau_0 \\exp\\left(-\\frac{x}{L_x}\\right) \\left[ -\\frac{\\pi}{L_y} \\sin\\left(\\frac{\\pi y}{L_y}\\right) \\right] = -\\frac{\\pi \\tau_0}{L_y} \\exp\\left(-\\frac{x}{L_x}\\right) \\sin\\left(\\frac{\\pi y}{L_y}\\right)\n$$\nCombining these, the wind stress curl is:\n$$\n\\text{curl}_z(\\vec{\\tau}) = \\frac{\\pi \\tau_0}{L_x} \\cos\\left(\\frac{2\\pi x}{L_x}\\right) \\sin\\left(\\frac{\\pi y}{L_y}\\right) - \\left( -\\frac{\\pi \\tau_0}{L_y} \\exp\\left(-\\frac{x}{L_x}\\right) \\sin\\left(\\frac{\\pi y}{L_y}\\right) \\right)\n$$\n$$\n\\text{curl}_z(\\vec{\\tau}) = \\pi \\tau_0 \\sin\\left(\\frac{\\pi y}{L_y}\\right) \\left[ \\frac{1}{L_x} \\cos\\left(\\frac{2\\pi x}{L_x}\\right) + \\frac{1}{L_y} \\exp\\left(-\\frac{x}{L_x}\\right) \\right]\n$$\n\n**3. Integration for the Streamfunction $\\psi(x,y)$**\n\nThe transport streamfunction $\\psi(x,y)$ is defined by $U = -\\frac{\\partial \\psi}{\\partial y}$ and $V = \\frac{\\partial \\psi}{\\partial x}$. Substituting the latter into the Sverdrup relation gives a first-order partial differential equation for $\\psi$:\n$$\n\\beta \\frac{\\partial \\psi}{\\partial x} = \\frac{1}{\\rho_0} \\text{curl}_z(\\vec{\\tau})\n$$\n$$\n\\frac{\\partial \\psi}{\\partial x} = \\frac{\\pi \\tau_0}{\\beta \\rho_0} \\sin\\left(\\frac{\\pi y}{L_y}\\right) \\left[ \\frac{1}{L_x} \\cos\\left(\\frac{2\\pi x}{L_x}\\right) + \\frac{1}{L_y} \\exp\\left(-\\frac{x}{L_x}\\right) \\right]\n$$\nWe integrate this equation with respect to $x$:\n$$\n\\psi(x,y) = \\int \\frac{\\partial \\psi}{\\partial x} dx = \\frac{\\pi \\tau_0}{\\beta \\rho_0} \\sin\\left(\\frac{\\pi y}{L_y}\\right) \\int \\left[ \\frac{1}{L_x} \\cos\\left(\\frac{2\\pi x}{L_x}\\right) + \\frac{1}{L_y} \\exp\\left(-\\frac{x}{L_x}\\right) \\right] dx\n$$\nPerforming the integration:\n$$\n\\int \\frac{1}{L_x} \\cos\\left(\\frac{2\\pi x}{L_x}\\right) dx = \\frac{1}{L_x} \\frac{L_x}{2\\pi} \\sin\\left(\\frac{2\\pi x}{L_x}\\right) = \\frac{1}{2\\pi} \\sin\\left(\\frac{2\\pi x}{L_x}\\right)\n$$\n$$\n\\int \\frac{1}{L_y} \\exp\\left(-\\frac{x}{L_x}\\right) dx = \\frac{1}{L_y} (-L_x) \\exp\\left(-\\frac{x}{L_x}\\right) = -\\frac{L_x}{L_y} \\exp\\left(-\\frac{x}{L_x}\\right)\n$$\nSo, the general solution for the streamfunction is:\n$$\n\\psi(x,y) = \\frac{\\pi \\tau_0}{\\beta \\rho_0} \\sin\\left(\\frac{\\pi y}{L_y}\\right) \\left[ \\frac{1}{2\\pi} \\sin\\left(\\frac{2\\pi x}{L_x}\\right) - \\frac{L_x}{L_y} \\exp\\left(-\\frac{x}{L_x}\\right) \\right] + C(y)\n$$\nwhere $C(y)$ is an integration constant that can depend on $y$.\n\nTo determine $C(y)$, we must apply a boundary condition. For a closed basin, the circulation is closed by a strong, narrow western boundary current where the Sverdrup balance does not hold. The Sverdrup balance is thus valid throughout the interior, including the eastern boundary at $x=L_x$. For a closed basin, streamfunction $\\psi$ must be constant along the boundary. We can set this constant to zero. Specifically, for the interior solution, we impose the condition that there is no flow into the eastern boundary, which means the streamfunction must be constant there. We set $\\psi(L_x,y) = 0$.\n$$\n\\psi(L_x,y) = \\frac{\\pi \\tau_0}{\\beta \\rho_0} \\sin\\left(\\frac{\\pi y}{L_y}\\right) \\left[ \\frac{1}{2\\pi} \\sin\\left(\\frac{2\\pi L_x}{L_x}\\right) - \\frac{L_x}{L_y} \\exp\\left(-\\frac{L_x}{L_x}\\right) \\right] + C(y) = 0\n$$\nSince $\\sin(2\\pi)=0$, this simplifies to:\n$$\n\\frac{\\pi \\tau_0}{\\beta \\rho_0} \\sin\\left(\\frac{\\pi y}{L_y}\\right) \\left[ - \\frac{L_x}{L_y} \\exp(-1) \\right] + C(y) = 0\n$$\nSolving for $C(y)$:\n$$\nC(y) = \\frac{\\pi \\tau_0 L_x}{\\beta \\rho_0 L_y} \\exp(-1) \\sin\\left(\\frac{\\pi y}{L_y}\\right)\n$$\nSubstituting this expression for $C(y)$ back into the general solution for $\\psi(x,y)$:\n$$\n\\psi(x,y) = \\frac{\\pi \\tau_0}{\\beta \\rho_0} \\sin\\left(\\frac{\\pi y}{L_y}\\right) \\left[ \\frac{1}{2\\pi} \\sin\\left(\\frac{2\\pi x}{L_x}\\right) - \\frac{L_x}{L_y} \\exp\\left(-\\frac{x}{L_x}\\right) \\right] + \\frac{\\pi \\tau_0 L_x}{\\beta \\rho_0 L_y} \\exp(-1) \\sin\\left(\\frac{\\pi y}{L_y}\\right)\n$$\nWe can factor out common terms to obtain the final expression:\n$$\n\\psi(x,y) = \\frac{\\pi \\tau_0}{\\beta \\rho_0} \\sin\\left(\\frac{\\pi y}{L_y}\\right) \\left[ \\frac{1}{2\\pi} \\sin\\left(\\frac{2\\pi x}{L_x}\\right) - \\frac{L_x}{L_y} \\exp\\left(-\\frac{x}{L_x}\\right) + \\frac{L_x}{L_y} \\exp(-1) \\right]\n$$\n$$\n\\psi(x,y) = \\frac{\\tau_0}{\\beta \\rho_0} \\sin\\left(\\frac{\\pi y}{L_y}\\right) \\left[ \\frac{1}{2} \\sin\\left(\\frac{2\\pi x}{L_x}\\right) + \\frac{\\pi L_x}{L_y} \\left( \\exp(-1) - \\exp\\left(-\\frac{x}{L_x}\\right) \\right) \\right]\n$$\nThis is the explicit closed-form expression for the interior transport streamfunction $\\psi(x,y)$.",
            "answer": "$$\\boxed{\\frac{\\tau_0}{\\beta \\rho_0} \\sin\\left(\\frac{\\pi y}{L_y}\\right) \\left[ \\frac{1}{2} \\sin\\left(\\frac{2\\pi x}{L_x}\\right) + \\frac{\\pi L_x}{L_y} \\left( \\exp(-1) - \\exp\\left(-\\frac{x}{L_x}\\right) \\right) \\right]}$$"
        },
        {
            "introduction": "While Sverdrup theory explains the ocean interior, it cannot describe the closed circulation of a basin, which requires boundary currents where friction is important. This computational practice  synthesizes the concepts of planetary vorticity and friction by guiding you through the implementation of a numerical solver for the classic Stommel model. This exercise bridges the gap from analytical theory to computational modeling, allowing you to simulate and verify a complete gyre circulation, including the intense western boundary current.",
            "id": "3788715",
            "problem": "Consider a rectangular, homogeneous ocean basin of constant depth on a traditional beta-plane where the Coriolis parameter is approximated as $f(y) = f_0 + \\beta y$, with $\\beta$ constant. Assume a steady, depth-integrated barotropic circulation forced by a specified wind stress field at the surface, with linear bottom drag. The governing balance for the vertically integrated vorticity is the classical Stommel model given by the linear elliptic partial differential equation for the transport streamfunction $\\Psi(x,y)$:\n$$\n\\beta \\frac{\\partial \\Psi}{\\partial x} + r \\nabla^2 \\Psi = \\frac{1}{\\rho_0}\\left(\\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y}\\right),\n$$\nwhere $\\rho_0$ is the reference seawater density, $r$ is the linear bottom drag coefficient, and $\\tau_x(x,y)$, $\\tau_y(x,y)$ are the components of the wind stress vector. The transport velocities per unit width are defined by $U(x,y) = -\\frac{\\partial \\Psi}{\\partial y}$ and $V(x,y) = \\frac{\\partial \\Psi}{\\partial x}$. Impose a no-normal-flow boundary condition on all basin boundaries, which for a simply connected domain with a transport streamfunction is implemented as $\\Psi = 0$ on the entire boundary.\n\nStarting from the depth-integrated momentum equations on an $f$-plane and introducing the beta-plane approximation $f(y) = f_0 + \\beta y$, derive the Stommel equation above by taking the vertical component of the curl, invoking the geostrophic relationship for the leading-order interior flow, and including linear bottom drag. Then, implement a numerical solver for the Stommel equation on a uniform Cartesian grid using second-order central finite differences for spatial derivatives and a sparse linear system solve for the interior grid points with Dirichlet boundary conditions.\n\nAfter computing $\\Psi(x,y)$, evaluate the following verification metrics to assess physical consistency:\n- The discrete divergence of transport $D(x,y) = \\frac{\\partial U}{\\partial x} + \\frac{\\partial V}{\\partial y}$, which should be identically zero for any differentiable streamfunction and thus serves as a numerical mass conservation check. Report the maximum absolute value $\\max|D|$ across the interior grid points, expressed in $\\mathrm{m/s}$.\n- The interior Sverdrup residual $R_S(x,y) = \\beta \\frac{\\partial \\Psi}{\\partial x} - \\frac{1}{\\rho_0}\\left(\\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y}\\right)$, which should be small away from boundaries when linear drag effects are weak. Report the interior mean absolute value $\\langle |R_S| \\rangle$ computed over the subset of grid points that exclude a buffer strip of width $0.1L_x$ adjacent to the western and eastern boundaries and $0.1L_y$ adjacent to the southern and northern boundaries. Express this mean residual in $\\mathrm{m/s^2}$.\n\nNumerically solve and report these metrics for the following test suite of cases; in all cases, use $\\rho_0 = 1025\\,\\mathrm{kg/m^3}$ and adopt the following wind stress patterns:\n- Pattern A: $\\tau_x(x,y) = \\tau_0 \\cos\\left(\\pi y / L_y\\right)$ and $\\tau_y(x,y) = 0$, giving a meridionally varying zonal wind.\n- Pattern B: $\\tau_x(x,y) = \\tau_0 \\sin\\left(2\\pi x / L_x\\right)\\cos\\left(\\pi y / L_y\\right)$ and $\\tau_y(x,y) = 0$, coupling zonal and meridional variability.\n\nTest cases:\n1. Basin dimensions $L_x = 3.0\\times 10^6\\,\\mathrm{m}$ and $L_y = 2.0\\times 10^6\\,\\mathrm{m}$, grid resolution $N_x = 128$, $N_y = 96$, $\\beta = 2.0\\times 10^{-11}\\,\\mathrm{m^{-1}\\,s^{-1}}$, $r = 1.0\\times 10^{-6}\\,\\mathrm{s^{-1}}$, wind stress amplitude $\\tau_0 = 0.20\\,\\mathrm{N/m^2}$, Pattern A.\n2. Same basin and grid as case 1, but $r = 5.0\\times 10^{-8}\\,\\mathrm{s^{-1}}$ (weaker drag), Pattern A.\n3. Basin dimensions $L_x = 1.0\\times 10^6\\,\\mathrm{m}$ and $L_y = 1.0\\times 10^6\\,\\mathrm{m}$, grid resolution $N_x = 64$, $N_y = 64$, $\\beta = 2.0\\times 10^{-11}\\,\\mathrm{m^{-1}\\,s^{-1}}$, $r = 5.0\\times 10^{-6}\\,\\mathrm{s^{-1}}$ (stronger drag), wind stress amplitude $\\tau_0 = 0.15\\,\\mathrm{N/m^2}$, Pattern B.\n\nFor each test case, compute:\n- Metric 1: $\\max|D|$ over all interior points, in $\\mathrm{m/s}$.\n- Metric 2: Interior mean absolute $\\langle |R_S| \\rangle$ over the buffered interior subset, in $\\mathrm{m/s^2}$.\n\nYour program should produce a single line of output containing the six results in the order of the test cases, each test case contributing its two metrics, as a comma-separated list enclosed in square brackets (e.g., \"[m1_case1,m2_case1,m1_case2,m2_case2,m1_case3,m2_case3]\"). The values must be floats representing the quantities in the specified units.",
            "solution": "The problem requires the derivation of the Stommel model for wind-driven ocean circulation and the implementation of a numerical solver to compute the transport streamfunction $\\Psi$ and associated physical metrics for several test cases.\n\n### Theoretical Derivation of the Stommel Equation\n\nWe begin with the steady-state, linear, vertically integrated momentum equations for a barotropic fluid of constant depth $H$ and constant reference density $\\rho_0$. The transport vector per unit width is $\\mathbf{U} = (U, V)$. The governing equations, including the Coriolis force, pressure gradient force, surface wind stress $\\boldsymbol{\\tau} = (\\tau_x, \\tau_y)$, and linear bottom drag, are:\n$$\n-fV = -\\frac{1}{\\rho_0} \\frac{\\partial P}{\\partial x} + \\frac{\\tau_x}{\\rho_0 H} - \\frac{r'}{H} U\n$$\n$$\nfU = -\\frac{1}{\\rho_0} \\frac{\\partial P}{\\partial y} + \\frac{\\tau_y}{\\rho_0 H} - \\frac{r'}{H} V\n$$\nHere, $f$ is the Coriolis parameter, $P$ is the vertically integrated pressure, and $r'$ is a dimensionless drag coefficient. The problem statement provides a simplified form where the friction and wind stress terms are represented without explicit dependence on $H$. Let's adopt the convention where $U$ and $V$ are transports per unit width (units of $\\mathrm{m^2/s}$) and the equation is written directly for these transports, with a drag coefficient $r$ (units of $\\mathrm{s^{-1}}$) and wind stress $\\boldsymbol{\\tau}$ (units of $\\mathrm{N/m^2} = \\mathrm{Pa}$). The pressure term corresponds to the gradient of sea surface height $\\eta$. The momentum balance becomes:\n$$\n-fV = -gH \\frac{\\partial \\eta}{\\partial x} + \\frac{\\tau_x}{\\rho_0} - rU \\quad (1)\n$$\n$$\nfU = -gH \\frac{\\partial \\eta}{\\partial y} + \\frac{\\tau_y}{\\rho_0} - rV \\quad (2)\n$$\nTo obtain the vorticity balance, we take the vertical component of the curl of the momentum equations. This is achieved by differentiating equation $(2)$ with respect to $x$ and subtracting the derivative of equation $(1)$ with respect to $y$:\n$$\n\\frac{\\partial}{\\partial x}(fU + rV) - \\frac{\\partial}{\\partial y}(-fV + rU) = \\frac{\\partial}{\\partial x}\\left(\\frac{\\tau_y}{\\rho_0}\\right) - \\frac{\\partial}{\\partial y}\\left(\\frac{\\tau_x}{\\rho_0}\\right)\n$$\nThe pressure gradient (sea surface height) terms are eliminated, as $\\frac{\\partial^2 (-gH\\eta)}{\\partial x \\partial y} - \\frac{\\partial^2 (-gH\\eta)}{\\partial y \\partial x} = 0$ for a sufficiently smooth function $\\eta$.\n\nExpanding the left-hand side yields:\n$$\nf\\left(\\frac{\\partial U}{\\partial x} + \\frac{\\partial V}{\\partial y}\\right) + U\\frac{\\partial f}{\\partial x} + V\\frac{\\partial f}{\\partial y} + r\\left(\\frac{\\partial V}{\\partial x} - \\frac{\\partial U}{\\partial y}\\right) = \\frac{1}{\\rho_0}\\left(\\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y}\\right)\n$$\nWe now introduce two fundamental approximations:\n1.  **Mass Conservation**: For a constant depth ocean, the vertically integrated continuity equation is $\\frac{\\partial U}{\\partial x} + \\frac{\\partial V}{\\partial y} = 0$. This implies the existence of a transport streamfunction $\\Psi(x,y)$ such that:\n    $$\n    U = -\\frac{\\partial \\Psi}{\\partial y}, \\quad V = \\frac{\\partial \\Psi}{\\partial x}\n    $$\n    The term $f(\\frac{\\partial U}{\\partial x} + \\frac{\\partial V}{\\partial y})$ in the vorticity equation is therefore zero.\n2.  **Beta-Plane Approximation**: The Coriolis parameter $f$ is assumed to vary linearly with the meridional coordinate $y$ and is constant with respect to the zonal coordinate $x$. Centered at a reference latitude $\\phi_0$, we have $f(y) = f_0 + \\beta y$, where $f_0 = 2\\Omega\\sin\\phi_0$ and $\\beta = \\frac{df}{dy}|_{\\phi_0} = \\frac{2\\Omega\\cos\\phi_0}{R}$ is constant ($R$ is Earth's radius, $\\Omega$ is its rotation rate). Consequently, $\\frac{\\partial f}{\\partial x} = 0$ and $\\frac{\\partial f}{\\partial y} = \\beta$.\n\nSubstituting these approximations and the streamfunction definition into the vorticity equation:\n-   The advection of planetary vorticity term becomes $V\\frac{\\partial f}{\\partial y} = \\beta V = \\beta \\frac{\\partial \\Psi}{\\partial x}$.\n-   The bottom friction term becomes the curl of the drag force, which is proportional to the relative vorticity of the transport: $r(\\frac{\\partial V}{\\partial x} - \\frac{\\partial U}{\\partial y}) = r\\left(\\frac{\\partial}{\\partial x}\\left(\\frac{\\partial \\Psi}{\\partial x}\\right) - \\frac{\\partial}{\\partial y}\\left(-\\frac{\\partial \\Psi}{\\partial y}\\right)\\right) = r\\left(\\frac{\\partial^2 \\Psi}{\\partial x^2} + \\frac{\\partial^2 \\Psi}{\\partial y^2}\\right) = r \\nabla^2 \\Psi$.\n\nAssembling all terms yields the Stommel equation, a linear elliptic partial differential equation for the transport streamfunction $\\Psi$:\n$$\n\\beta \\frac{\\partial \\Psi}{\\partial x} + r \\nabla^2 \\Psi = \\frac{1}{\\rho_0}\\left(\\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y}\\right)\n$$\nThis derivation is sound and establishes the governing equation posed in the problem.\n\n### Numerical Method\n\nThe Stommel equation is solved numerically on a uniform Cartesian grid covering the rectangular domain $[0, L_x] \\times [0, L_y]$. The grid has $N_x+1$ points in the $x$-direction and $N_y+1$ points in the $y$-direction, with spacings $\\Delta x = L_x/N_x$ and $\\Delta y = L_y/N_y$. The value of the streamfunction at a grid point $(x_i, y_j) = (i\\Delta x, j\\Delta y)$ is denoted by $\\Psi_{i,j}$.\n\nThe spatial derivatives are approximated using second-order central finite differences:\n$$\n\\frac{\\partial \\Psi}{\\partial x}\\bigg|_{i,j} \\approx \\frac{\\Psi_{i+1,j} - \\Psi_{i-1,j}}{2\\Delta x}\n$$\n$$\n\\nabla^2 \\Psi\\bigg|_{i,j} \\approx \\frac{\\Psi_{i+1,j} - 2\\Psi_{i,j} + \\Psi_{i-1,j}}{\\Delta x^2} + \\frac{\\Psi_{i,j+1} - 2\\Psi_{i,j} + \\Psi_{i,j-1}}{\\Delta y^2}\n$$\nSubstituting these into the Stommel equation for each interior grid point ($i=1, \\dots, N_x-1$, $j=1, \\dots, N_y-1$) gives a system of linear algebraic equations:\n$$\n\\beta \\left(\\frac{\\Psi_{i+1,j} - \\Psi_{i-1,j}}{2\\Delta x}\\right) + r \\left(\\frac{\\Psi_{i+1,j} - 2\\Psi_{i,j} + \\Psi_{i-1,j}}{\\Delta x^2} + \\frac{\\Psi_{i,j+1} - 2\\Psi_{i,j} + \\Psi_{i,j-1}}{\\Delta y^2}\\right) = F_{i,j}\n$$\nwhere $F_{i,j}$ is the wind stress curl evaluated at $(x_i, y_j)$.\n\nThis equation can be rearranged into a five-point stencil form:\n$$\nC_W \\Psi_{i-1,j} + C_E \\Psi_{i+1,j} + C_S \\Psi_{i,j-1} + C_N \\Psi_{i,j+1} + C_C \\Psi_{i,j} = F_{i,j}\n$$\nwith coefficients:\n$$\nC_W = \\frac{r}{\\Delta x^2} - \\frac{\\beta}{2\\Delta x}, \\quad C_E = \\frac{r}{\\Delta x^2} + \\frac{\\beta}{2\\Delta x}\n$$\n$$\nC_S = \\frac{r}{\\Delta y^2}, \\quad C_N = \\frac{r}{\\Delta y^2}\n$$\n$$\nC_C = -2r\\left(\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2}\\right)\n$$\nThe problem specifies Dirichlet boundary conditions $\\Psi=0$ on all boundaries. This simplifies the system, as any term $\\Psi_{i,j}$ where $i$ or $j$ falls on a boundary is known to be zero. The $(N_x-1) \\times (N_y-1)$ unknown interior values of $\\Psi$ are organized into a single solution vector $\\boldsymbol{\\psi}$. This results in a large, sparse linear system of the form $A\\boldsymbol{\\psi} = \\mathbf{b}$, where $A$ is the matrix of coefficients, and $\\mathbf{b}$ is the vector of the wind stress curl values $F_{i,j}$. This system is solved efficiently using a sparse linear algebra solver.\n\n### Verification Metrics\n\nAfter obtaining the solution for $\\Psi$, two metrics are computed.\n\n1.  **Maximum Absolute Discrete Divergence ($\\max|D|$):**\n    The divergence of the transport field is $D = \\frac{\\partial U}{\\partial x} + \\frac{\\partial V}{\\partial y}$. Substituting the streamfunction definitions $U = -\\partial\\Psi/\\partial y$ and $V = \\partial\\Psi/\\partial x$, we get $D = -\\frac{\\partial^2\\Psi}{\\partial x \\partial y} + \\frac{\\partial^2\\Psi}{\\partial y \\partial x}$. For any twice-continuously differentiable function $\\Psi$, this is identically zero by Clairaut's theorem on the equality of mixed partials.\n    Numerically, if we consistently use second-order central differences for all derivatives, the discrete divergence is also identically zero due to cancellation of terms.\n    $$\n    U_{i,j} = -\\frac{\\Psi_{i,j+1} - \\Psi_{i,j-1}}{2\\Delta y}, \\quad V_{i,j} = \\frac{\\Psi_{i+1,j} - \\Psi_{i-1,j}}{2\\Delta x}\n    $$\n    $$\n    D_{i,j} = \\frac{U_{i+1,j} - U_{i-1,j}}{2\\Delta x} + \\frac{V_{i,j+1} - V_{i,j-1}}{2\\Delta y} = 0\n    $$\n    The computation of this metric serves as a verification of the algebraic self-consistency of the chosen finite difference scheme. Any non-zero result will be on the order of machine floating-point precision error. The value is reported in $\\mathrm{m/s}$.\n\n2.  **Interior Mean Absolute Sverdrup Residual ($\\langle |R_S| \\rangle$):**\n    The Sverdrup balance, $\\beta V = \\text{curl}_z(\\boldsymbol{\\tau})/\\rho_0$, is the dominant balance in the ocean interior away from boundaries where friction is negligible. The Sverdrup residual $R_S$ quantifies the deviation from this balance. It is defined as:\n    $$\n    R_S = \\beta \\frac{\\partial \\Psi}{\\partial x} - \\frac{1}{\\rho_0}\\left(\\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y}\\right)\n    $$\n    From the full Stommel equation, we see that $R_S = -r\\nabla^2\\Psi$. This residual is expected to be small in the ocean interior and large in boundary layers where the frictional term $r\\nabla^2\\Psi$ is significant. We compute its average absolute value over an interior region, excluding buffer zones of width $0.1 L_x$ from the zonal boundaries and $0.1 L_y$ from the meridional boundaries. This provides a measure of the extent to which the interior flow is governed by Sverdrup dynamics. The value is reported in $\\mathrm{m/s^2}$.\n\nThe following Python code implements this numerical procedure to solve for the three specified test cases and report the required metrics.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csc_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main function to run the Stommel model for all specified test cases\n    and print the formatted results.\n    \"\"\"\n    rho0 = 1025.0  # kg/m^3\n\n    # (Lx, Ly, Nx, Ny, beta, r, tau0, pattern)\n    test_cases = [\n        (3.0e6, 2.0e6, 128, 96, 2.0e-11, 1.0e-6, 0.20, 'A'),\n        (3.0e6, 2.0e6, 128, 96, 2.0e-11, 5.0e-8, 0.20, 'A'),\n        (1.0e6, 1.0e6, 64, 64, 2.0e-11, 5.0e-6, 0.15, 'B'),\n    ]\n\n    results = []\n    for Lx, Ly, Nx, Ny, beta, r, tau0, pattern in test_cases:\n        m1, m2 = solve_stommel_case(Lx, Ly, Nx, Ny, beta, r, tau0, rho0, pattern)\n        results.extend([m1, m2])\n\n    print(f\"[{','.join(f'{val:.6e}' for val in results)}]\")\n\ndef solve_stommel_case(Lx, Ly, Nx, Ny, beta, r, tau0, rho0, pattern):\n    \"\"\"\n    Solves the Stommel equation for a single test case and computes metrics.\n    \n    Returns:\n        tuple: (max_abs_divergence, mean_abs_sverdrup_residual)\n    \"\"\"\n    dx = Lx / Nx\n    dy = Ly / Ny\n\n    # Grid for interior points (1..Nx-1, 1..Ny-1)\n    x_int = np.linspace(dx, Lx - dx, Nx - 1)\n    y_int = np.linspace(dy, Ly - dy, Ny - 1)\n    X_int, Y_int = np.meshgrid(x_int, y_int)\n\n    # Calculate wind stress curl (forcing term F)\n    if pattern == 'A':\n        F = (tau0 * np.pi / (rho0 * Ly)) * np.sin(np.pi * Y_int / Ly)\n    elif pattern == 'B':\n        F = (tau0 * np.pi / (rho0 * Ly)) * np.sin(2 * np.pi * X_int / Lx) * np.sin(np.pi * Y_int / Ly)\n    else:\n        raise ValueError(\"Unknown wind stress pattern\")\n\n    # Assemble the sparse matrix A for the linear system A*psi = b\n    num_unknowns = (Nx - 1) * (Ny - 1)\n    A = lil_matrix((num_unknowns, num_unknowns))\n    b = F.flatten()\n\n    c_w = r / dx**2 - beta / (2 * dx)\n    c_e = r / dx**2 + beta / (2 * dx)\n    c_s = r / dy**2\n    c_n = r / dy**2\n    c_c = -2 * r * (1 / dx**2 + 1 / dy**2)\n\n    for j in range(Ny - 1):      # Corresponds to y-indices 1..Ny-1\n        for i in range(Nx - 1):  # Corresponds to x-indices 1..Nx-1\n            k = j * (Nx - 1) + i  # Flattened index\n            \n            A[k, k] = c_c\n            \n            if i > 0:\n                A[k, k - 1] = c_w # West\n            if i  Nx - 2:\n                A[k, k + 1] = c_e # East\n            if j > 0:\n                A[k, k - (Nx - 1)] = c_s # South\n            if j  Ny - 2:\n                A[k, k + (Nx - 1)] = c_n # North\n\n    # Solve the system\n    A_csc = csc_matrix(A)\n    psi_flat = spsolve(A_csc, b)\n    psi_int = psi_flat.reshape((Ny - 1, Nx - 1))\n\n    # Embed solution in a full grid with zero boundaries\n    Psi = np.zeros((Ny + 1, Nx + 1))\n    Psi[1:Ny, 1:Nx] = psi_int\n\n    # --- Metric 1: Max absolute discrete divergence ---\n    # Centered-difference divergence is algebraically zero.\n    # U = -dPsi/dy, V = dPsi/dx\n    # D = dU/dx + dV/dy\n    # We calculate it to verify it's close to machine epsilon.\n    U = np.zeros_like(psi_int)\n    V = np.zeros_like(psi_int)\n    \n    # Calculate U and V on interior points\n    U = -(Psi[2:Ny+1, 1:Nx] - Psi[0:Ny-1, 1:Nx]) / (2 * dy)\n    V = (Psi[1:Ny, 2:Nx+1] - Psi[1:Ny, 0:Nx-1]) / (2 * dx)\n\n    # Calculate divergence D\n    # We need a smaller grid for D as its stencil accesses neighbors of U and V.\n    D = np.zeros((Ny - 3, Nx - 3))\n    # U is (Ny-1, Nx-1), V is (Ny-1, Nx-1)\n    # D is defined on grid points (i, j) where i=[2..Nx-2], j=[2..Ny-2]\n    dUdx = (U[1:-1, 2:] - U[1:-1, :-2]) / (2 * dx)\n    dVdy = (V[2:, 1:-1] - V[:-2, 1:-1]) / (2 * dy)\n    D = dUdx + dVdy\n    max_abs_D = np.max(np.abs(D)) if D.size > 0 else 0.0\n\n    # --- Metric 2: Interior mean absolute Sverdrup residual ---\n    # Rs = beta * dPsi/dx - F\n    dPsidx_int = (Psi[1:Ny, 2:Nx+1] - Psi[1:Ny, 0:Nx-1]) / (2 * dx)\n    Rs = beta * dPsidx_int - F\n\n    # Define the averaging region (excluding 0.1 buffers)\n    i_min = int(np.ceil(0.1 * Nx))\n    i_max = int(np.floor(0.9 * Nx))\n    j_min = int(np.ceil(0.1 * Ny))\n    j_max = int(np.floor(0.9 * Ny))\n\n    # Slice the Rs array. Note that Rs is on interior grid (indices 1..Nx-1, 1..Ny-1)\n    # The Rs array is indexed 0..Nx-2 and 0..Ny-2.\n    # Full grid index i maps to Rs index i-1.\n    Rs_subset = Rs[j_min-1:j_max, i_min-1:i_max]\n    \n    mean_abs_Rs = np.mean(np.abs(Rs_subset)) if Rs_subset.size > 0 else 0.0\n\n    return max_abs_D, mean_abs_Rs\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}