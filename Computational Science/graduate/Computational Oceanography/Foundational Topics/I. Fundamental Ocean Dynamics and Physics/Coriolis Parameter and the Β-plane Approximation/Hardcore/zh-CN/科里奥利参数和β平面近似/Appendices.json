{
    "hands_on_practices": [
        {
            "introduction": "我们首先从最基本的定义出发。在地球旋转参考系中，科里奥利加速度是一个三维矢量，但在大规模海洋学中，我们主要关心其在水平方向上的分量。这项练习将引导你从第一性原理出发，推导出在本地切平面坐标系中描述水平运动的科里奥利参数 $f$，从而将复杂的矢量运算简化为一个随纬度变化的标量。这个推导是理解和应用科里奥利效应的关键第一步。",
            "id": "3788719",
            "problem": "考虑一个与地球在纬度 $\\phi$ 处的切平面平行的局部笛卡尔坐标系，其单位向量为 $\\hat{\\boldsymbol{i}}$ (东)、$\\hat{\\boldsymbol{j}}$ (北) 和 $\\hat{\\boldsymbol{k}}$ (上)。一个以水平速度 $\\boldsymbol{u} = u\\,\\hat{\\boldsymbol{i}} + v\\,\\hat{\\boldsymbol{j}}$ 运动的流体质点，在地球旋转参考系中由补充了视在加速度的牛顿第二定律描述。科里奥利加速度由旋转参考系的基本表达式 $\\boldsymbol{a}_{\\mathrm{cor}} = -2\\,\\boldsymbol{\\Omega} \\times \\boldsymbol{u}$ 给出，其中 $\\boldsymbol{\\Omega}$ 是地球的旋转矢量。利用在纬度 $\\phi$ 处 $\\boldsymbol{\\Omega}$ 与局部垂直方向 $\\hat{\\boldsymbol{k}}$ 之间的几何关系，从基本原理推导出一个标量 $f$（科里奥利参数），该标量在水平动量方程中乘以水平向量 $\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u}$。然后，对于一个具有恒定转速 $\\Omega = 7.2921 \\times 10^{-5}\\ \\mathrm{s^{-1}}$ 的地球，计算在纬度 $\\phi = 30^\\circ$ 和 $\\phi = 60^\\circ$ 处推导出的 $f$ 值。说明在这些纬度上 $f$ 的符号，并根据你的推导比较它们的大小。将计算出的每个 $f$ 值以 $\\mathrm{s^{-1}}$ 为单位表示，并四舍五入到四位有效数字。角度以度为单位给出。",
            "solution": "问题陈述具有科学依据、问题明确、客观且内部一致。它展示了地球物理流体动力学中的一个标准推导。因此，我们将着手解答。\n\n一个速度为 $\\boldsymbol{u}$ 的流体质点，在以角速度 $\\boldsymbol{\\Omega}$ 旋转的参考系中所受到的科里奥利加速度 $\\boldsymbol{a}_{\\mathrm{cor}}$ 由以下公式给出：\n$$\n\\boldsymbol{a}_{\\mathrm{cor}} = -2\\,\\boldsymbol{\\Omega} \\times \\boldsymbol{u}\n$$\n\n问题在地球表面纬度为 $\\phi$ 的位置定义了一个局部笛卡尔坐标系。其单位向量为 $\\hat{\\boldsymbol{i}}$ 指向东，$\\hat{\\boldsymbol{j}}$ 指向北，以及 $\\hat{\\boldsymbol{k}}$ 指向垂直向上。流体质点的速度被限制在水平面内，因此 $\\boldsymbol{u} = u\\,\\hat{\\boldsymbol{i}} + v\\,\\hat{\\boldsymbol{j}}$。\n\n我们的第一步是在这个局部坐标系中表示地球的旋转矢量 $\\boldsymbol{\\Omega}$。矢量 $\\boldsymbol{\\Omega}$ 沿着地球的自转轴，从南指向北。其大小为 $\\Omega$。在北半球纬度为 $\\phi$ 的地方，旋转轴与当地水平面成 $\\phi$ 角。$\\boldsymbol{\\Omega}$ 在当地子午面（$\\hat{\\boldsymbol{j}}$-$\\hat{\\boldsymbol{k}}$ 平面）上的投影可以分解为其分量。\n沿当地北方向 $\\hat{\\boldsymbol{j}}$ 的分量是 $\\Omega \\cos(\\phi)$。\n沿当地垂直方向 $\\hat{\\boldsymbol{k}}$ 的分量是 $\\Omega \\sin(\\phi)$。\n在东西方向上没有分量，因此 $\\hat{\\boldsymbol{i}}$ 分量为零。因此，旋转矢量为：\n$$\n\\boldsymbol{\\Omega} = (\\Omega \\cos(\\phi))\\,\\hat{\\boldsymbol{j}} + (\\Omega \\sin(\\phi))\\,\\hat{\\boldsymbol{k}}\n$$\n\n接下来，我们计算叉积 $\\boldsymbol{\\Omega} \\times \\boldsymbol{u}$：\n$$\n\\boldsymbol{\\Omega} \\times \\boldsymbol{u} = \\begin{vmatrix}\n\\hat{\\boldsymbol{i}}  \\hat{\\boldsymbol{j}}  \\hat{\\boldsymbol{k}} \\\\\n0  \\Omega \\cos(\\phi)  \\Omega \\sin(\\phi) \\\\\nu  v  0\n\\end{vmatrix}\n$$\n计算行列式得到：\n$$\n\\boldsymbol{\\Omega} \\times \\boldsymbol{u} = \\hat{\\boldsymbol{i}}((\\Omega \\cos(\\phi))(0) - v(\\Omega \\sin(\\phi))) - \\hat{\\boldsymbol{j}}((0)(0) - u(\\Omega \\sin(\\phi))) + \\hat{\\boldsymbol{k}}((0)(v) - u(\\Omega \\cos(\\phi)))\n$$\n$$\n\\boldsymbol{\\Omega} \\times \\boldsymbol{u} = -v\\,\\Omega \\sin(\\phi)\\,\\hat{\\boldsymbol{i}} + u\\,\\Omega \\sin(\\phi)\\,\\hat{\\boldsymbol{j}} - u\\,\\Omega \\cos(\\phi)\\,\\hat{\\boldsymbol{k}}\n$$\n\n现在，我们将其代入科里奥利加速度的表达式中：\n$$\n\\boldsymbol{a}_{\\mathrm{cor}} = -2(-v\\,\\Omega \\sin(\\phi)\\,\\hat{\\boldsymbol{i}} + u\\,\\Omega \\sin(\\phi)\\,\\hat{\\boldsymbol{j}} - u\\,\\Omega \\cos(\\phi)\\,\\hat{\\boldsymbol{k}})\n$$\n$$\n\\boldsymbol{a}_{\\mathrm{cor}} = (2v\\,\\Omega \\sin(\\phi))\\,\\hat{\\boldsymbol{i}} - (2u\\,\\Omega \\sin(\\phi))\\,\\hat{\\boldsymbol{j}} + (2u\\,\\Omega \\cos(\\phi))\\,\\hat{\\boldsymbol{k}}\n$$\n\n水平动量方程只涉及加速度的水平分量，即 $\\hat{\\boldsymbol{i}}$ 和 $\\hat{\\boldsymbol{j}}$ 分量。因此，水平科里奥利加速度 $\\boldsymbol{a}_{\\mathrm{cor,h}}$ 为：\n$$\n\\boldsymbol{a}_{\\mathrm{cor,h}} = (2v\\,\\Omega \\sin(\\phi))\\,\\hat{\\boldsymbol{i}} - (2u\\,\\Omega \\sin(\\phi))\\,\\hat{\\boldsymbol{j}}\n$$\n\n问题要求将其与包含向量 $\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u}$ 的项关联起来。我们计算这个向量：\n$$\n\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u} = \\hat{\\boldsymbol{k}} \\times (u\\,\\hat{\\boldsymbol{i}} + v\\,\\hat{\\boldsymbol{j}}) = u(\\hat{\\boldsymbol{k}} \\times \\hat{\\boldsymbol{i}}) + v(\\hat{\\boldsymbol{k}} \\times \\hat{\\boldsymbol{j}})\n$$\n使用右手坐标系的循环关系（$\\hat{\\boldsymbol{k}} \\times \\hat{\\boldsymbol{i}} = \\hat{\\boldsymbol{j}}$ 和 $\\hat{\\boldsymbol{k}} \\times \\hat{\\boldsymbol{j}} = -\\hat{\\boldsymbol{i}}$）：\n$$\n\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u} = u\\,\\hat{\\boldsymbol{j}} - v\\,\\hat{\\boldsymbol{i}}\n$$\n\n现在我们可以比较 $\\boldsymbol{a}_{\\mathrm{cor,h}}$ 和 $\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u}$。我们可以从 $\\boldsymbol{a}_{\\mathrm{cor,h}}$ 的表达式中提出标量项：\n$$\n\\boldsymbol{a}_{\\mathrm{cor,h}} = (2\\,\\Omega \\sin(\\phi))(v\\,\\hat{\\boldsymbol{i}} - u\\,\\hat{\\boldsymbol{j}})\n$$\n注意到 $(v\\,\\hat{\\boldsymbol{i}} - u\\,\\hat{\\boldsymbol{j}}) = -(u\\,\\hat{\\boldsymbol{j}} - v\\,\\hat{\\boldsymbol{i}}) = -(\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u})$。\n因此，我们可以将水平科里奥利加速度写为：\n$$\n\\boldsymbol{a}_{\\mathrm{cor,h}} = -(2\\,\\Omega \\sin(\\phi))(\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u})\n$$\n量 $2\\,\\Omega \\sin(\\phi)$ 被定义为科里奥利参数，通常用 $f$ 表示。\n$$\nf \\equiv 2\\,\\Omega \\sin(\\phi)\n$$\n因此，出现在水平动量方程中的项是 $-f(\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u})$。问题要求推导“乘以”$\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u}$ 的标量 $f$。根据问题陈述中使用的“$f$（科里奥利参数）”所暗示的标准定义，我们将 $f$ 确定为正量 $2\\,\\Omega \\sin(\\phi)$。$\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u}$ 上的完整乘法因子是 $-f$。\n\n我们现在需要根据给定的参数计算 $f$ 的值。\n地球的转速是 $\\Omega = 7.2921 \\times 10^{-5}\\ \\mathrm{s^{-1}}$。\n\n情况 1：纬度 $\\phi = 30^\\circ$。\n该纬度的科里奥利参数 $f$ 是：\n$$\nf_{30} = 2\\,\\Omega \\sin(30^\\circ) = 2(7.2921 \\times 10^{-5}\\ \\mathrm{s^{-1}})(0.5)\n$$\n$$\nf_{30} = 7.2921 \\times 10^{-5}\\ \\mathrm{s^{-1}}\n$$\n四舍五入到四位有效数字，我们得到 $7.292 \\times 10^{-5}\\ \\mathrm{s^{-1}}$。\n\n情况 2：纬度 $\\phi = 60^\\circ$。\n该纬度的科里奥利参数 $f$ 是：\n$$\nf_{60} = 2\\,\\Omega \\sin(60^\\circ) = 2(7.2921 \\times 10^{-5}\\ \\mathrm{s^{-1}})\\left(\\frac{\\sqrt{3}}{2}\\right)\n$$\n$$\nf_{60} = (7.2921 \\times 10^{-5})(\\sqrt{3})\\ \\mathrm{s^{-1}} \\approx 12.6305 \\times 10^{-5}\\ \\mathrm{s^{-1}} = 1.26305 \\times 10^{-4}\\ \\mathrm{s^{-1}}\n$$\n四舍五入到四位有效数字，我们得到 $1.263 \\times 10^{-4}\\ \\mathrm{s^{-1}}$。\n\n最后，我们分析符号和大小。\n科里奥利参数的公式是 $f = 2\\,\\Omega \\sin(\\phi)$。\n地球的转速 $\\Omega = |\\boldsymbol{\\Omega}|$ 是一个正常数。对于给定的纬度 $\\phi = 30^\\circ$ 和 $\\phi = 60^\\circ$，两者都在北半球，所以 $0  \\phi \\le 90^\\circ$。在此范围内，$\\sin(\\phi)$ 为正。因此，在这两个纬度上 $f$ 的符号都是正的。\n关于大小，正弦函数在区间 $[0^\\circ, 90^\\circ]$ 上是单调递增的。因为 $60^\\circ  30^\\circ$，所以我们有 $\\sin(60^\\circ)  \\sin(30^\\circ)$。因此，$\\phi=60^\\circ$ 处的科里奥利参数的大小大于 $\\phi=30^\\circ$ 处的大小，这与我们的数值计算结果相符（$1.263 \\times 10^{-4}  7.292 \\times 10^{-5}$）。这表明科里奥利力对水平运动的影响随纬度的增加而增加，在极点（$\\phi=90^\\circ$）达到最大值，在赤道（$\\phi=0^\\circ$）处消失。\n\n在 $\\phi=30^\\circ$ 和 $\\phi=60^\\circ$ 处计算出的 $f$ 值分别为 $7.292 \\times 10^{-5}\\ \\mathrm{s^{-1}}$ 和 $1.263 \\times 10^{-4}\\ \\mathrm{s^{-1}}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 7.292 \\times 10^{-5}  1.263 \\times 10^{-4} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "当流体运动跨越相当大的纬度范围时，将科里奥利参数 $f$ 视为常数就不再适用。为了在数学上处理这种变化，同时保持模型的可解性，地球物理流体动力学引入了一个强大的工具——β平面近似。这项练习的核心任务是围绕一个参考纬度对 $f$ 进行线性化，并推导出关键参数 $\\beta$。理解 $\\beta$ 的物理意义及其量级，对于模拟罗斯贝波和风生环流等大规模现象至关重要。",
            "id": "3926055",
            "problem": "考虑一个中纬度的大气或海洋局部笛卡尔坐标系区域，该区域以球形地球（半径 $a=6.371\\times 10^{6}\\,\\mathrm{m}$，恒定自转速率 $\\Omega=7.2921\\times 10^{-5}\\,\\mathrm{s}^{-1}$）上的参考纬度 $\\phi_{0}=45^{\\circ}$ 为中心。局部经向坐标 $y$ 是从参考纬度沿大圆测量的物理距离。纬度 $\\phi$ 处的科里奥利参数 $f$ 定义为 $f=2\\Omega\\sin\\phi$。在 $\\beta$ 平面近似中，$f$ 的纬度变化在 $\\phi_{0}$ 附近线性化为 $f(y)\\approx f_{0}+\\beta\\,y$，其中 $f_{0}$ 是在 $\\phi_{0}$ 处的值，$\\beta$ 是在 $\\phi_{0}$ 处计算的行星涡度的经向梯度。\n\n仅从 $f$ 的定义以及球体上经向弧长与纬度之间的几何关系出发，推导在 $\\phi_{0}=45^{\\circ}$ 处 $\\beta$ 的解析表达式，然后计算其数值。将 $\\beta$ 以 $\\mathrm{s}^{-1}\\,\\mathrm{m}^{-1}$ 为单位表示，并将最终数值结果四舍五入到四位有效数字。通过量化在 $\\phi_{0}$ 处单位经向距离上 $f$ 的分数变化，简要解释 $\\beta$ 相对于 $f_{0}$ 的大小；在你的计算过程中用文字提供这种解释，但仅提交 $\\beta$ 的数值作为最终答案。",
            "solution": "题目要求推导贝塔参数 $\\beta$ 的解析表达式，并在参考纬度 $\\phi_{0}=45^{\\circ}$ 处进行数值计算。$\\beta$ 平面近似将科里奥利参数 $f$ 相对于经向距离 $y$ 线性化为 $f(y) \\approx f_{0} + \\beta y$。系数 $\\beta$ 是 $f$ 在参考纬度（即 $y=0$ 处）的经向梯度。\n\n根据定义，$\\beta$ 由下式给出：\n$$ \\beta = \\left. \\frac{df}{dy} \\right|_{y=0} $$\n科里奥利参数 $f$ 是纬度 $\\phi$ 的函数，由 $f(\\phi) = 2\\Omega\\sin\\phi$ 给出，其中 $\\Omega$ 是地球的角自转速率。经向坐标 $y$ 是在半径为 $a$ 的球体上，从参考纬度 $\\phi_{0}$ 向北的弧长距离。经向距离 $dy$ 与纬度微分变化 $d\\phi$（以弧度为单位）之间的微分关系是：\n$$ dy = a \\, d\\phi $$\n这意味着 $\\frac{d\\phi}{dy} = \\frac{1}{a}$。\n\n为了计算 $\\frac{df}{dy}$，我们使用链式法则，因为 $f$ 是 $\\phi$ 的函数，而 $\\phi$ 又是 $y$ 的函数：\n$$ \\frac{df}{dy} = \\frac{df}{d\\phi} \\frac{d\\phi}{dy} $$\n首先，我们求 $f$ 对 $\\phi$ 的导数：\n$$ \\frac{df}{d\\phi} = \\frac{d}{d\\phi} (2\\Omega\\sin\\phi) = 2\\Omega\\cos\\phi $$\n将此式和 $\\frac{d\\phi}{dy} = \\frac{1}{a}$ 代入链式法则表达式，得到：\n$$ \\frac{df}{dy} = (2\\Omega\\cos\\phi) \\left(\\frac{1}{a}\\right) = \\frac{2\\Omega\\cos\\phi}{a} $$\n参数 $\\beta$ 就是在参考纬度 $\\phi_{0}$ 处计算的这个梯度：\n$$ \\beta = \\left. \\frac{df}{dy} \\right|_{\\phi = \\phi_{0}} = \\frac{2\\Omega\\cos\\phi_{0}}{a} $$\n这就是所要求的 $\\beta$ 的解析表达式。\n\n现在，我们使用给定的常数计算 $\\beta$ 的数值：\n参考纬度 $\\phi_{0} = 45^{\\circ}$。\n地球自转速率 $\\Omega = 7.2921 \\times 10^{-5}\\,\\mathrm{s}^{-1}$。\n地球半径 $a = 6.371 \\times 10^{6}\\,\\mathrm{m}$。\n\n参考纬度的余弦是 $\\cos(45^{\\circ}) = \\frac{\\sqrt{2}}{2}$。\n将这些值代入 $\\beta$ 的表达式中：\n$$ \\beta = \\frac{2 \\times (7.2921 \\times 10^{-5}\\,\\mathrm{s}^{-1}) \\times \\cos(45^{\\circ})}{6.371 \\times 10^{6}\\,\\mathrm{m}} $$\n$$ \\beta = \\frac{2 \\times (7.2921 \\times 10^{-5}) \\times \\frac{\\sqrt{2}}{2}}{6.371 \\times 10^{6}}\\,\\mathrm{s}^{-1}\\,\\mathrm{m}^{-1} $$\n$$ \\beta = \\frac{7.2921 \\times \\sqrt{2} \\times 10^{-5}}{6.371 \\times 10^{6}}\\,\\mathrm{s}^{-1}\\,\\mathrm{m}^{-1} $$\n$$ \\beta \\approx \\frac{7.2921 \\times 1.41421356}{6.371} \\times 10^{-11}\\,\\mathrm{s}^{-1}\\,\\mathrm{m}^{-1} $$\n$$ \\beta \\approx \\frac{10.31263}{6.371} \\times 10^{-11}\\,\\mathrm{s}^{-1}\\,\\mathrm{m}^{-1} $$\n$$ \\beta \\approx 1.618683 \\times 10^{-11}\\,\\mathrm{s}^{-1}\\,\\mathrm{m}^{-1} $$\n将结果四舍五入到四位有效数字，我们得到：\n$$ \\beta \\approx 1.619 \\times 10^{-11}\\,\\mathrm{s}^{-1}\\,\\mathrm{m}^{-1} $$\n\n至于解释，我们评估单位经向距离上 $f$ 的分数变化，即比率 $\\frac{\\beta}{f_{0}}$。\n参考纬度处的科里奥利参数是 $f_{0} = 2\\Omega\\sin\\phi_{0}$。\n该比率是：\n$$ \\frac{\\beta}{f_{0}} = \\frac{2\\Omega\\cos\\phi_{0} / a}{2\\Omega\\sin\\phi_{0}} = \\frac{\\cot\\phi_{0}}{a} $$\n在 $\\phi_{0} = 45^{\\circ}$ 处，$\\cot(45^{\\circ}) = 1$。因此，该比率简化为：\n$$ \\frac{\\beta}{f_{0}} = \\frac{1}{a} = \\frac{1}{6.371 \\times 10^{6}\\,\\mathrm{m}} \\approx 1.57 \\times 10^{-7}\\,\\mathrm{m}^{-1} $$\n这个值表示，在此纬度，每向北移动一米，科里奥利参数大约变化 $1.57 \\times 10^{-5}\\,\\%$。一个更直观的解释是考虑一个更大的天气尺度距离，例如 $1000\\,\\mathrm{km}$ ($10^6\\,\\mathrm{m}$)。在这个距离上，$f$ 的分数变化是 $(\\frac{\\beta}{f_0}) \\times (10^6\\,\\mathrm{m}) = \\frac{1}{a} \\times (10^6\\,\\mathrm{m}) \\approx 0.157$。这意味着从 $\\phi_{0}=45^{\\circ}$ 向北每移动 $1000\\,\\mathrm{km}$，科里奥利参数大约增加其局部值 $f_0$ 的 $15.7\\%$。这表明，对于大尺度的大气和海洋运动，行星涡度的经向变化是一个显著效应。",
            "answer": "$$\\boxed{1.619 \\times 10^{-11}}$$"
        },
        {
            "introduction": "现在，我们将前面学到的概念（尤其是β效应）与外部强迫（风应力）和耗散（底部摩擦）结合起来，构建一个完整的海洋盆地环流模型。这项实践要求你通过数值方法求解经典的斯托梅尔（Stommel）模型方程，这是一个解释了海洋环流西向强化和环流圈形成的基本模型。通过编写代码、求解偏微分方程并验证结果，你将获得一次真实、完整的计算海洋学建模体验。",
            "id": "3788715",
            "problem": "考虑一个深度恒定的矩形均匀海洋盆地，该盆地位于传统的beta平面上，其中科里奥利参数近似为 $f(y) = f_0 + \\beta y$，且 $\\beta$ 为常数。假设存在一个稳定的、深度积分的正压环流，该环流由表面给定的风应力场驱动，并带有线性底拖曳。垂直积分涡度的控制平衡是经典的Stommel模型，由输运流函数 $\\Psi(x,y)$ 的线性椭圆偏微分方程给出：\n$$\n\\beta \\frac{\\partial \\Psi}{\\partial x} + r \\nabla^2 \\Psi = \\frac{1}{\\rho_0}\\left(\\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y}\\right),\n$$\n其中 $\\rho_0$ 是参考海水密度，$r$ 是线性底拖曳系数，$\\tau_x(x,y)$ 和 $\\tau_y(x,y)$ 是风应力矢量的分量。单位宽度的输运速度定义为 $U(x,y) = -\\frac{\\partial \\Psi}{\\partial y}$ 和 $V(x,y) = \\frac{\\partial \\Psi}{\\partial x}$。在所有盆地边界上施加无垂向流边界条件，对于一个单连通域和输运流函数，这实现为在整个边界上 $\\Psi = 0$。\n\n从f平面上的深度积分动量方程出发，引入beta平面近似 $f(y) = f_0 + \\beta y$，通过取旋度的垂直分量，调用主阶内部流的地转关系，并包含线性底拖曳，来推导上述Stommel方程。然后，在一个均匀的笛卡尔网格上实现一个Stommel方程的数值求解器，使用二阶中心有限差分计算空间导数，并对具有狄利克雷边界条件的内部网格点求解一个稀疏线性系统。\n\n计算出 $\\Psi(x,y)$ 后，评估以下验证指标以评估其物理一致性：\n- 输运的离散散度 $D(x,y) = \\frac{\\partial U}{\\partial x} + \\frac{\\partial V}{\\partial y}$，对于任何可微流函数，它应恒等于零，因此可作为数值质量守恒的检验。报告所有内部网格点上的最大绝对值 $\\max|D|$，单位为 $\\mathrm{m/s}$。\n- 内部Sverdrup残差 $R_S(x,y) = \\beta \\frac{\\partial \\Psi}{\\partial x} - \\frac{1}{\\rho_0}\\left(\\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y}\\right)$，当线性拖曳效应较弱时，在远离边界的区域该值应较小。报告内部平均绝对值 $\\langle |R_S| \\rangle$，该值计算于一个网格点子集上，该子集排除了邻近西部和东部边界的宽度为 $0.1L_x$ 以及邻近南部和北部边界的宽度为 $0.1L_y$ 的缓冲带。以 $\\mathrm{m/s^2}$ 为单位表示此平均残差。\n\n对以下测试案例进行数值求解并报告这些指标；在所有情况下，使用 $\\rho_0 = 1025\\,\\mathrm{kg/m^3}$ 并采用以下风应力模式：\n- 模式A：$\\tau_x(x,y) = \\tau_0 \\cos\\left(\\pi y / L_y\\right)$ 和 $\\tau_y(x,y) = 0$，产生一个经向变化的纬向风。\n- 模式B：$\\tau_x(x,y) = \\tau_0 \\sin\\left(2\\pi x / L_x\\right)\\cos\\left(\\pi y / L_y\\right)$ 和 $\\tau_y(x,y) = 0$，耦合了纬向和经向的变化。\n\n测试案例：\n1. 盆地尺寸 $L_x = 3.0\\times 10^6\\,\\mathrm{m}$ 和 $L_y = 2.0\\times 10^6\\,\\mathrm{m}$，网格分辨率 $N_x = 128$，$N_y = 96$，$\\beta = 2.0\\times 10^{-11}\\,\\mathrm{m^{-1}\\,s^{-1}}$，$r = 1.0\\times 10^{-6}\\,\\mathrm{s^{-1}}$，风应力振幅 $\\tau_0 = 0.20\\,\\mathrm{N/m^2}$，模式A。\n2. 与案例1相同的盆地和网格，但 $r = 5.0\\times 10^{-8}\\,\\mathrm{s^{-1}}$（较弱的拖曳），模式A。\n3. 盆地尺寸 $L_x = 1.0\\times 10^6\\,\\mathrm{m}$ 和 $L_y = 1.0\\times 10^6\\,\\mathrm{m}$，网格分辨率 $N_x = 64$，$N_y = 64$，$\\beta = 2.0\\times 10^{-11}\\,\\mathrm{m^{-1}\\,s^{-1}}$，$r = 5.0\\times 10^{-6}\\,\\mathrm{s^{-1}}$（较强的拖曳），风应力振幅 $\\tau_0 = 0.15\\,\\mathrm{N/m^2}$，模式B。\n\n对每个测试案例，计算：\n- 指标1：所有内部点上的 $\\max|D|$，单位为 $\\mathrm{m/s}$。\n- 指标2：缓冲的内部子集上的内部平均绝对值 $\\langle |R_S| \\rangle$，单位为 $\\mathrm{m/s^2}$。\n\n你的程序应产生单行输出，其中包含按测试案例顺序排列的六个结果，每个测试案例贡献其两个指标，形式为方括号内用逗号分隔的列表（例如，\"[m1_case1,m2_case1,m1_case2,m2_case2,m1_case3,m2_case3]\"）。这些值必须是浮点数，表示指定单位的量。",
            "solution": "该问题要求推导用于风驱动海洋环流的Stommel模型，并实现一个数值求解器来计算输运流函数 $\\Psi$ 以及几个测试案例的相关物理指标。\n\n### Stommel方程的理论推导\n\n我们从针对深度为 $H$、参考密度为 $\\rho_0$ 的正压流体的稳态、线性、垂直积分的动量方程开始。单位宽度的输运矢量为 $\\mathbf{U} = (U, V)$。控制方程，包括科里奥利力、压力梯度力、表面风应力 $\\boldsymbol{\\tau} = (\\tau_x, \\tau_y)$ 以及线性底拖曳，如下所示：\n$$\n-fV = -\\frac{1}{\\rho_0} \\frac{\\partial P}{\\partial x} + \\frac{\\tau_x}{\\rho_0 H} - \\frac{r'}{H} U\n$$\n$$\nfU = -\\frac{1}{\\rho_0} \\frac{\\partial P}{\\partial y} + \\frac{\\tau_y}{\\rho_0 H} - \\frac{r'}{H} V\n$$\n这里，$f$ 是科里奥利参数，$P$ 是垂直积分的压力，$r'$ 是一个无量纲拖曳系数。问题陈述提供了一种简化形式，其中摩擦项和风应力项的表示不显式依赖于 $H$。我们采用这样的约定：$U$ 和 $V$ 是单位宽度的输运量（单位为 $\\mathrm{m^2/s}$），方程直接针对这些输运量编写，拖曳系数为 $r$（单位为 $\\mathrm{s^{-1}}$），风应力为 $\\boldsymbol{\\tau}$（单位为 $\\mathrm{N/m^2} = \\mathrm{Pa}$）。压力项对应于海面高度 $\\eta$ 的梯度。动量平衡变为：\n$$\n-fV = -gH \\frac{\\partial \\eta}{\\partial x} + \\frac{\\tau_x}{\\rho_0} - rU \\quad (1)\n$$\n$$\nfU = -gH \\frac{\\partial \\eta}{\\partial y} + \\frac{\\tau_y}{\\rho_0} - rV \\quad (2)\n$$\n为了获得涡度平衡，我们取动量方程旋度的垂直分量。这可以通过将方程 $(2)$ 对 $x$ 求导并减去方程 $(1)$ 对 $y$ 的导数来实现：\n$$\n\\frac{\\partial}{\\partial x}(fU + rV) - \\frac{\\partial}{\\partial y}(-fV + rU) = \\frac{\\partial}{\\partial x}\\left(\\frac{\\tau_y}{\\rho_0}\\right) - \\frac{\\partial}{\\partial y}\\left(\\frac{\\tau_x}{\\rho_0}\\right)\n$$\n压力梯度（海面高度）项被消去，因为对于足够光滑的函数 $\\eta$，有 $\\frac{\\partial^2 (-gH\\eta)}{\\partial x \\partial y} - \\frac{\\partial^2 (-gH\\eta)}{\\partial y \\partial x} = 0$。\n\n展开左侧得到：\n$$\nf\\left(\\frac{\\partial U}{\\partial x} + \\frac{\\partial V}{\\partial y}\\right) + U\\frac{\\partial f}{\\partial x} + V\\frac{\\partial f}{\\partial y} + r\\left(\\frac{\\partial V}{\\partial x} - \\frac{\\partial U}{\\partial y}\\right) = \\frac{1}{\\rho_0}\\left(\\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y}\\right)\n$$\n我们现在引入两个基本近似：\n1.  **质量守恒**：对于深度恒定的海洋，垂直积分的连续性方程是 $\\frac{\\partial U}{\\partial x} + \\frac{\\partial V}{\\partial y} = 0$。这意味着存在一个输运流函数 $\\Psi(x,y)$ 使得：\n    $$\n    U = -\\frac{\\partial \\Psi}{\\partial y}, \\quad V = \\frac{\\partial \\Psi}{\\partial x}\n    $$\n    因此涡度方程中的 $f(\\frac{\\partial U}{\\partial x} + \\frac{\\partial V}{\\partial y})$ 项为零。\n2.  **beta平面近似**：假设科里奥利参数 $f$ 随经向坐标 $y$ 线性变化，而不随纬向坐标 $x$ 变化。以参考纬度 $\\phi_0$ 为中心，我们有 $f(y) = f_0 + \\beta y$，其中 $f_0 = 2\\Omega\\sin\\phi_0$ 且 $\\beta = \\frac{df}{dy}|_{\\phi_0} = \\frac{2\\Omega\\cos\\phi_0}{R}$ 是常数（$R$ 是地球半径，$\\Omega$ 是其自转角速度）。因此，$\\frac{\\partial f}{\\partial x} = 0$ 且 $\\frac{\\partial f}{\\partial y} = \\beta$。\n\n将这些近似和流函数的定义代入涡度方程：\n-   行星涡度平流项变为 $V\\frac{\\partial f}{\\partial y} = \\beta V = \\beta \\frac{\\partial \\Psi}{\\partial x}$。\n-   底部摩擦项变为拖曳力的旋度，它与输运的相对涡度成正比：$r(\\frac{\\partial V}{\\partial x} - \\frac{\\partial U}{\\partial y}) = r\\left(\\frac{\\partial}{\\partial x}\\left(\\frac{\\partial \\Psi}{\\partial x}\\right) - \\frac{\\partial}{\\partial y}\\left(-\\frac{\\partial \\Psi}{\\partial y}\\right)\\right) = r\\left(\\frac{\\partial^2 \\Psi}{\\partial x^2} + \\frac{\\partial^2 \\Psi}{\\partial y^2}\\right) = r \\nabla^2 \\Psi$。\n\n综合所有项得到Stommel方程，一个关于输运流函数 $\\Psi$ 的线性椭圆偏微分方程：\n$$\n\\beta \\frac{\\partial \\Psi}{\\partial x} + r \\nabla^2 \\Psi = \\frac{1}{\\rho_0}\\left(\\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y}\\right)\n$$\n这个推导是合理的，并确立了问题中提出的控制方程。\n\n### 数值方法\n\nStommel方程在一个覆盖矩形域 $[0, L_x] \\times [0, L_y]$ 的均匀笛卡尔网格上进行数值求解。网格在x方向上有 $N_x+1$ 个点，在y方向上有 $N_y+1$ 个点，间距分别为 $\\Delta x = L_x/N_x$ 和 $\\Delta y = L_y/N_y$。在网格点 $(x_i, y_j) = (i\\Delta x, j\\Delta y)$ 处的流函数值记为 $\\Psi_{i,j}$。\n\n空间导数使用二阶中心有限差分近似：\n$$\n\\frac{\\partial \\Psi}{\\partial x}\\bigg|_{i,j} \\approx \\frac{\\Psi_{i+1,j} - \\Psi_{i-1,j}}{2\\Delta x}\n$$\n$$\n\\nabla^2 \\Psi\\bigg|_{i,j} \\approx \\frac{\\Psi_{i+1,j} - 2\\Psi_{i,j} + \\Psi_{i-1,j}}{\\Delta x^2} + \\frac{\\Psi_{i,j+1} - 2\\Psi_{i,j} + \\Psi_{i,j-1}}{\\Delta y^2}\n$$\n将这些代入每个内部网格点（$i=1, \\dots, N_x-1$，$j=1, \\dots, N_y-1$）的Stommel方程，得到一个线性代数方程组：\n$$\n\\beta \\left(\\frac{\\Psi_{i+1,j} - \\Psi_{i-1,j}}{2\\Delta x}\\right) + r \\left(\\frac{\\Psi_{i+1,j} - 2\\Psi_{i,j} + \\Psi_{i-1,j}}{\\Delta x^2} + \\frac{\\Psi_{i,j+1} - 2\\Psi_{i,j} + \\Psi_{i,j-1}}{\\Delta y^2}\\right) = F_{i,j}\n$$\n其中 $F_{i,j}$ 是在 $(x_i, y_j)$ 处计算的风应力旋度。\n\n该方程可以重新排列成五点模板形式：\n$$\nC_W \\Psi_{i-1,j} + C_E \\Psi_{i+1,j} + C_S \\Psi_{i,j-1} + C_N \\Psi_{i,j+1} + C_C \\Psi_{i,j} = F_{i,j}\n$$\n系数如下：\n$$\nC_W = \\frac{r}{\\Delta x^2} - \\frac{\\beta}{2\\Delta x}, \\quad C_E = \\frac{r}{\\Delta x^2} + \\frac{\\beta}{2\\Delta x}\n$$\n$$\nC_S = \\frac{r}{\\Delta y^2}, \\quad C_N = \\frac{r}{\\Delta y^2}\n$$\n$$\nC_C = -2r\\left(\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2}\\right)\n$$\n问题指定了在所有边界上 $\\Psi=0$ 的狄利克雷边界条件。这简化了系统，因为任何 $i$ 或 $j$ 落在边界上的项 $\\Psi_{i,j}$ 已知为零。$(N_x-1) \\times (N_y-1)$ 个未知的内部 $\\Psi$ 值被组织成一个单独的解向量 $\\boldsymbol{\\psi}$。这产生了一个 $A\\boldsymbol{\\psi} = \\mathbf{b}$ 形式的大型稀疏线性系统，其中 $A$ 是系数矩阵，$\\mathbf{b}$ 是风应力旋度值 $F_{i,j}$ 的向量。该系统使用稀疏线性代数求解器进行高效求解。\n\n### 验证指标\n\n在获得 $\\Psi$ 的解之后，计算两个指标。\n\n1.  **最大绝对离散散度 ($\\max|D|$):**\n    输运场的散度为 $D = \\frac{\\partial U}{\\partial x} + \\frac{\\partial V}{\\partial y}$。代入流函数的定义 $U = -\\partial\\Psi/\\partial y$ 和 $V = \\partial\\Psi/\\partial x$，我们得到 $D = -\\frac{\\partial^2\\Psi}{\\partial x \\partial y} + \\frac{\\partial^2\\Psi}{\\partial y \\partial x}$。对于任何二阶连续可微函数 $\\Psi$，根据Clairaut关于混合偏导数相等的定理，它恒等于零。\n    在数值上，如果我们对所有导数都一致地使用二阶中心差分，离散散度也因项的抵消而恒等于零。\n    $$\n    U_{i,j} = -\\frac{\\Psi_{i,j+1} - \\Psi_{i,j-1}}{2\\Delta y}, \\quad V_{i,j} = \\frac{\\Psi_{i+1,j} - \\Psi_{i-1,j}}{2\\Delta x}\n    $$\n    $$\n    D_{i,j} = \\frac{U_{i+1,j} - U_{i-1,j}}{2\\Delta x} + \\frac{V_{i,j+1} - V_{i,j-1}}{2\\Delta y} = 0\n    $$\n    这个指标的计算可以验证所选有限差分格式的代数自洽性。任何非零结果都将在机器浮点精度误差的量级上。该值以 $\\mathrm{m/s}$ 为单位报告。\n\n2.  **内部平均绝对Sverdrup残差 ($\\langle |R_S| \\rangle$):**\n    Sverdrup平衡 $\\beta V = \\text{curl}_z(\\boldsymbol{\\tau})/\\rho_0$，是在摩擦可忽略的远离边界的海洋内部的主导平衡。Sverdrup残差 $R_S$ 量化了与此平衡的偏差。其定义为：\n    $$\n    R_S = \\beta \\frac{\\partial \\Psi}{\\partial x} - \\frac{1}{\\rho_0}\\left(\\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y}\\right)\n    $$\n    从完整的Stommel方程中，我们可以看到 $R_S = -r\\nabla^2\\Psi$。在海洋内部，这个残差预计很小，而在摩擦项 $r\\nabla^2\\Psi$ 显著的边界层中则很大。我们在一个内部区域上计算其平均绝对值，该区域排除了距纬向边界宽度为 $0.1 L_x$ 和距经向边界宽度为 $0.1 L_y$ 的缓冲带。这提供了一个衡量内部流动在多大程度上受Sverdrup动力学支配的度量。该值以 $\\mathrm{m/s^2}$ 为单位报告。\n\n以下Python代码实现了这个数值过程，以求解三个指定的测试案例并报告所需的指标。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csc_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main function to run the Stommel model for all specified test cases\n    and print the formatted results.\n    \"\"\"\n    rho0 = 1025.0  # kg/m^3\n\n    # (Lx, Ly, Nx, Ny, beta, r, tau0, pattern)\n    test_cases = [\n        (3.0e6, 2.0e6, 128, 96, 2.0e-11, 1.0e-6, 0.20, 'A'),\n        (3.0e6, 2.0e6, 128, 96, 2.0e-11, 5.0e-8, 0.20, 'A'),\n        (1.0e6, 1.0e6, 64, 64, 2.0e-11, 5.0e-6, 0.15, 'B'),\n    ]\n\n    results = []\n    for Lx, Ly, Nx, Ny, beta, r, tau0, pattern in test_cases:\n        m1, m2 = solve_stommel_case(Lx, Ly, Nx, Ny, beta, r, tau0, rho0, pattern)\n        results.extend([m1, m2])\n\n    print(f\"[{','.join(f'{val:.6e}' for val in results)}]\")\n\ndef solve_stommel_case(Lx, Ly, Nx, Ny, beta, r, tau0, rho0, pattern):\n    \"\"\"\n    Solves the Stommel equation for a single test case and computes metrics.\n    \n    Returns:\n        tuple: (max_abs_divergence, mean_abs_sverdrup_residual)\n    \"\"\"\n    dx = Lx / Nx\n    dy = Ly / Ny\n\n    # Grid for interior points (1..Nx-1, 1..Ny-1)\n    x_int = np.linspace(dx, Lx - dx, Nx - 1)\n    y_int = np.linspace(dy, Ly - dy, Ny - 1)\n    X_int, Y_int = np.meshgrid(x_int, y_int)\n\n    # Calculate wind stress curl (forcing term F)\n    if pattern == 'A':\n        F = (tau0 * np.pi / (rho0 * Ly)) * np.sin(np.pi * Y_int / Ly)\n    elif pattern == 'B':\n        F = (tau0 * np.pi / (rho0 * Ly)) * np.sin(2 * np.pi * X_int / Lx) * np.sin(np.pi * Y_int / Ly)\n    else:\n        raise ValueError(\"Unknown wind stress pattern\")\n\n    # Assemble the sparse matrix A for the linear system A*psi = b\n    num_unknowns = (Nx - 1) * (Ny - 1)\n    A = lil_matrix((num_unknowns, num_unknowns))\n    b = F.flatten()\n\n    c_w = r / dx**2 - beta / (2 * dx)\n    c_e = r / dx**2 + beta / (2 * dx)\n    c_s = r / dy**2\n    c_n = r / dy**2\n    c_c = -2 * r * (1 / dx**2 + 1 / dy**2)\n\n    for j in range(Ny - 1):      # Corresponds to y-indices 1..Ny-1\n        for i in range(Nx - 1):  # Corresponds to x-indices 1..Nx-1\n            k = j * (Nx - 1) + i  # Flattened index\n            \n            A[k, k] = c_c\n            \n            if i > 0:\n                A[k, k - 1] = c_w # West\n            if i  Nx - 2:\n                A[k, k + 1] = c_e # East\n            if j > 0:\n                A[k, k - (Nx - 1)] = c_s # South\n            if j  Ny - 2:\n                A[k, k + (Nx - 1)] = c_n # North\n\n    # Solve the system\n    A_csc = csc_matrix(A)\n    psi_flat = spsolve(A_csc, b)\n    psi_int = psi_flat.reshape((Ny - 1, Nx - 1))\n\n    # Embed solution in a full grid with zero boundaries\n    Psi = np.zeros((Ny + 1, Nx + 1))\n    Psi[1:Ny, 1:Nx] = psi_int\n\n    # --- Metric 1: Max absolute discrete divergence ---\n    # Centered-difference divergence is algebraically zero.\n    # U = -dPsi/dy, V = dPsi/dx\n    # D = dU/dx + dV/dy\n    # We calculate it to verify it's close to machine epsilon.\n    U = np.zeros_like(psi_int)\n    V = np.zeros_like(psi_int)\n    \n    # Calculate U and V on interior points\n    U = -(Psi[2:Ny+1, 1:Nx] - Psi[0:Ny-1, 1:Nx]) / (2 * dy)\n    V = (Psi[1:Ny, 2:Nx+1] - Psi[1:Ny, 0:Nx-1]) / (2 * dx)\n\n    # Calculate divergence D\n    # We need a smaller grid for D as its stencil accesses neighbors of U and V.\n    D = np.zeros((Ny - 3, Nx - 3))\n    # U is (Ny-1, Nx-1), V is (Ny-1, Nx-1)\n    # D is defined on grid points (i, j) where i=[2..Nx-2], j=[2..Ny-2]\n    dUdx = (U[1:-1, 2:] - U[1:-1, :-2]) / (2 * dx)\n    dVdy = (V[2:, 1:-1] - V[:-2, 1:-1]) / (2 * dy)\n    D = dUdx + dVdy\n    max_abs_D = np.max(np.abs(D)) if D.size > 0 else 0.0\n\n    # --- Metric 2: Interior mean absolute Sverdrup residual ---\n    # Rs = beta * dPsi/dx - F\n    dPsidx_int = (Psi[1:Ny, 2:Nx+1] - Psi[1:Ny, 0:Nx-1]) / (2 * dx)\n    Rs = beta * dPsidx_int - F\n\n    # Define the averaging region (excluding 0.1 buffers)\n    i_min = int(np.ceil(0.1 * Nx))\n    i_max = int(np.floor(0.9 * Nx))\n    j_min = int(np.ceil(0.1 * Ny))\n    j_max = int(np.floor(0.9 * Ny))\n\n    # Slice the Rs array. Note that Rs is on interior grid (indices 1..Nx-1, 1..Ny-1)\n    # The Rs array is indexed 0..Nx-2 and 0..Ny-2.\n    # Full grid index i maps to Rs index i-1.\n    Rs_subset = Rs[j_min-1:j_max, i_min-1:i_max]\n    \n    mean_abs_Rs = np.mean(np.abs(Rs_subset)) if Rs_subset.size > 0 else 0.0\n\n    return max_abs_D, mean_abs_Rs\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}