{
    "hands_on_practices": [
        {
            "introduction": "在地球物理流体动力学中，一项基本技能是判断特定尺度下流动的主导力平衡。通过对动量方程进行无量纲化，我们可以揭示控制动力学状态的关键参数。本练习将指导您完成这一过程，推导出罗斯比数 $Ro$，并利用它来评估地转平衡在典型中尺度海洋流中的适用性 。",
            "id": "3794155",
            "problem": "一个中纬度的海洋中尺度流可以被建模为 $f$-平面上的水平均匀、不可压缩、Boussinesq、静力流。考虑在随地球旋转的坐标系中的水平动量方程，忽略除科里奥利力和气压梯度力之外的显式摩擦力和体积力。从应用于流体微团的牛顿第二定律出发，写出无粘性水平动量方程，并使用特征水平速度尺度 $U$、水平长度尺度 $L$ 和时间尺度 $L/U$ 对其进行无量纲化。选择气压尺度，使得在无量纲方程中，科里奥利项和气压梯度项的量级相同。\n\n- 确定水平动量方程中乘以局地加速度与平流加速度之和的无量纲参数。\n- 使用参数值 $U=0.5\\,\\mathrm{m\\,s^{-1}}$，$L=50\\,\\mathrm{km}$ 和 $f=10^{-4}\\,\\mathrm{s^{-1}}$，计算该参数的数值。根据其量级，简要评估对于此流动，地转平衡还是旋地转平衡在主导阶上更为合适。\n\n最终答案仅报告所确定的无量纲参数的数值，不带单位。将答案四舍五入至三位有效数字。",
            "solution": "该问题要求推导海洋流动的水平动量方程并进行无量纲化，以确定一个关键的动力学参数，并评估主导的力平衡。\n\n首先，对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n- 流动模型：$f$-平面上的水平均匀、不可压缩、Boussinesq、静力流。\n- 流动类型：中纬度的海洋中尺度流。\n- 动力学：无粘性水平动量方程。考虑的力是科里奥利力和气压梯度力。\n- 任务：从牛顿第二定律出发，写出水平动量方程，并进行无量纲化。\n- 特征尺度：\n    - 水平速度：$U$\n    - 水平长度：$L$\n    - 时间：$L/U$\n- 气压尺度条件：选择气压尺度，使得在无量纲方程中，科里奥利项和气压梯度项的量级相同。\n- 识别任务：确定乘以加速度项的无量纲参数。\n- 计算任务：给定以下数值计算该参数：\n    - $U = 0.5\\,\\mathrm{m\\,s^{-1}}$\n    - $L = 50\\,\\mathrm{km}$\n    - $f = 10^{-4}\\,\\mathrm{s^{-1}}$\n- 评估任务：根据该参数的量级，评估地转平衡或旋地转平衡哪个在主导阶上更合适。\n- 报告要求：仅报告该参数的数值，四舍五入至三位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，基于地球物理流体动力学的基本原理，特别是从旋转坐标系中的Navier-Stokes方程推导简化动量平衡。这些假设（静力、Boussinesq、$f$-平面）对于模拟中尺度海洋现象是标准且合适的。该问题是适定的，提供了清晰的指令序列和足够的数据（$U$, $L$, $f$）以得到唯一的数值答案。语言客观、精确。所提供的数值对于中纬度海洋涡旋是物理上现实的。该问题没有违反任何无效性标准。\n\n### 步骤3：结论与行动\n该问题是**有效的**。将提供完整解答。\n\n### 解答推导\n\n旋转行星上无粘性流体的水平动量方程（$f$-平面近似）由牛顿第二定律推导而来。该定律指出，流体微团的质量乘以其加速度等于作用在其上的所有力的总和。在随地球旋转的坐标系中，这表示为：\n$$ \\frac{D\\mathbf{u}}{Dt} + 2\\boldsymbol{\\Omega} \\times \\mathbf{u} = -\\frac{1}{\\rho}\\nabla p + \\mathbf{g} $$\n这里，$\\mathbf{u}$ 是旋转坐标系中的速度矢量，$\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + \\mathbf{u} \\cdot \\nabla$ 是物质导数，$\\boldsymbol{\\Omega}$ 是地球的角速度矢量，$\\rho$ 是流体密度，$p$ 是压强，$\\mathbf{g}$ 是重力加速度。\n\n对于速度为 $\\mathbf{u}_h = u\\mathbf{i} + v\\mathbf{j}$ 的水平流动，忽略摩擦力的动量方程的水平分量为：\n$$ \\frac{Du}{Dt} = fv - \\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} $$\n$$ \\frac{Dv}{Dt} = -fu - \\frac{1}{\\rho}\\frac{\\partial p}{\\partial y} $$\n其中 $f$ 是科里奥利参数，水平运动的物质导数为 $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + u\\frac{\\partial}{\\partial x} + v\\frac{\\partial}{\\partial y}$。我们假设流体为Boussinesq流体，因此在动量方程中密度 $\\rho$被视为一个恒定的参考密度 $\\rho_0$。完整的方程是：\n$$ \\frac{\\partial u}{\\partial t} + u\\frac{\\partial u}{\\partial x} + v\\frac{\\partial u}{\\partial y} = fv - \\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial x} $$\n$$ \\frac{\\partial v}{\\partial t} + u\\frac{\\partial v}{\\partial x} + v\\frac{\\partial v}{\\partial y} = -fu - \\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial y} $$\n\n接下来，我们使用给定的特征尺度对这些方程进行无量纲化。让带撇的变量表示无量纲量：\n$u = Uu'$, $v = Uv'$, $x = Lx'$, $y = Ly'$, $t = (L/U)t'$.\n我们还引入一个动压变化的特征尺度 $P_0$，使得 $p = P_0 p'$。\n\n导数变换如下：\n$\\frac{\\partial}{\\partial t} = \\frac{U}{L}\\frac{\\partial}{\\partial t'}$，$\\frac{\\partial}{\\partial x} = \\frac{1}{L}\\frac{\\partial}{\\partial x'}$，以及 $\\frac{\\partial}{\\partial y} = \\frac{1}{L}\\frac{\\partial}{\\partial y'}$。\n\n将这些代入 $x$-动量方程：\n$$ \\frac{U}{L}\\frac{\\partial (Uu')}{\\partial t'} + (Uu')\\frac{1}{L}\\frac{\\partial (Uu')}{\\partial x'} + (Uv')\\frac{1}{L}\\frac{\\partial (Uu')}{\\partial y'} = f(Uv') - \\frac{1}{\\rho_0 L}\\frac{\\partial (P_0 p')}{\\partial x'} $$\n从每一项中提出特征尺度：\n$$ \\left(\\frac{U^2}{L}\\right)\\left(\\frac{\\partial u'}{\\partial t'} + u'\\frac{\\partial u'}{\\partial x'} + v'\\frac{\\partial u'}{\\partial y'}\\right) = (fU)v' - \\left(\\frac{P_0}{\\rho_0 L}\\right)\\frac{\\partial p'}{\\partial x'} $$\n问题指定，应选择气压尺度 $P_0$ 以使科里奥利项和气压梯度项具有相同的量级。科里奥利项的特征量级是 $fU$，气压梯度项的特征量级是 $P_0/(\\rho_0 L)$。令它们相等，可得：\n$$ fU = \\frac{P_0}{\\rho_0 L} \\implies P_0 = \\rho_0 f L U $$\n这个选择定义了压强的地转尺度。\n\n为了得到最终的无量纲方程，我们除以单位质量的科里奥利力的特征量级，即 $fU$：\n$$ \\frac{U^2/L}{fU}\\left(\\frac{\\partial u'}{\\partial t'} + u'\\frac{\\partial u'}{\\partial x'} + v'\\frac{\\partial u'}{\\partial y'}\\right) = \\frac{fU}{fU}v' - \\frac{P_0/(\\rho_0 L)}{fU}\\frac{\\partial p'}{\\partial x'} $$\n简化系数：\n$$ \\left(\\frac{U}{fL}\\right)\\left(\\frac{D u'}{D t'}\\right) = v' - \\frac{\\rho_0 f L U / (\\rho_0 L)}{fU}\\frac{\\partial p'}{\\partial x'} $$\n$$ \\left(\\frac{U}{fL}\\right)\\frac{D u'}{D t'} = v' - \\frac{\\partial p'}{\\partial x'} $$\n类似地，$y$-动量方程变为：\n$$ \\left(\\frac{U}{fL}\\right)\\frac{D v'}{D t'} = -u' - \\frac{\\partial p'}{\\partial y'} $$\n\n乘以加速度项 $\\frac{D\\mathbf{u}'_h}{Dt'}$ 的无量纲参数被确定为 $\\frac{U}{fL}$。该参数被称为Rossby数，用 $Ro$ 表示。\n$$ Ro = \\frac{U}{fL} $$\nRossby数代表惯性力（加速度）与科里奥利力之比。\n\n我们现在使用所提供的数据计算Rossby数的数值：\n$U = 0.5\\,\\mathrm{m\\,s^{-1}}$\n$L = 50\\,\\mathrm{km} = 50 \\times 10^3\\,\\mathrm{m} = 5 \\times 10^4\\,\\mathrm{m}$\n$f = 10^{-4}\\,\\mathrm{s^{-1}}$\n\n$$ Ro = \\frac{0.5\\,\\mathrm{m\\,s^{-1}}}{(10^{-4}\\,\\mathrm{s^{-1}}) \\times (5 \\times 10^4\\,\\mathrm{m})} = \\frac{0.5}{10^{-4} \\times 5 \\times 10^4} = \\frac{0.5}{5} = 0.1 $$\n四舍五入到三位有效数字，值为 $0.100$。\n\n最后，我们评估适当的力平衡。无量纲动量方程为：\n$$ Ro\\frac{D u'}{D t'} = v' - \\frac{\\partial p'}{\\partial x'} $$\n$$ Ro\\frac{D v'}{D t'} = -u' - \\frac{\\partial p'}{\\partial y'} $$\n我们计算出的Rossby数是 $Ro = 0.1$。由于 $Ro \\ll 1$，量级为 $Ro$ 的加速度项比量级为 $1$ 的科里奥利项和气压梯度项小一个数量级。在主导阶上，我们可以忽略乘以 $Ro$ 的项。这得到了地转平衡：\n$$ 0 \\approx v' - \\frac{\\partial p'}{\\partial x'} $$\n$$ 0 \\approx -u' - \\frac{\\partial p'}{\\partial y'} $$\n旋地转平衡包括加速度项的平流部分，这在具有强曲率的流动（例如涡旋）中物理上很重要。这种平衡是 $Ro(u'\\frac{\\partial u'}{\\partial x'} + v'\\frac{\\partial u'}{\\partial y'}) = v' - \\frac{\\partial p'}{\\partial x'}$（对于圆形流动，在径向方向上）。由于平流加速度是 $\\mathcal{O}(Ro)$ 项的一部分，旋地转平衡代表了对地转平衡的一阶修正。因此，对于 $Ro=0.1$，*在主导阶上*最合适的平衡是地转平衡。\n\n要求的最终答案是所确定的无量纲参数的数值。",
            "answer": "$$\\boxed{0.100}$$"
        },
        {
            "introduction": "地转平衡为我们提供了一个强大的工具，能够通过可观测的海面高度（SSH）梯度来推断洋流。然而，这种平衡的有效性并非处处相同。本练习通过一个思想实验，探讨了在维持恒定SSH梯度的情况下，地转流速如何随纬度变化，从而揭示了地转近似在低纬度地区的局限性 。",
            "id": "3794164",
            "problem": "考虑在旋转地球上的一个大尺度、稳定、无粘的海洋表层流，该流动在Boussinesq近似和静力近似下建模，并具有恒定的参考密度$\\rho_{0}$。设海面高度（SSH）场$\\eta(x,y)$具有一个大小为$|\\nabla \\eta|$的恒定水平梯度，该梯度与纬度$\\phi$无关。一个控制体沿经向从纬度$\\phi_{1}=45^{\\circ}$移动到纬度$\\phi_{2}=10^{\\circ}$。从旋转动量方程和静力平衡出发，推导表层地转流速大小$|\\mathbf{u}_{g}|$与SSH梯度$|\\nabla \\eta|$及科里奥利参数之间的关系。然后，假设两处均为纯地转平衡，计算在给定纬度下的无量纲比值\n$$\nR \\equiv \\frac{|\\mathbf{u}_{g}(\\phi_{2})|}{|\\mathbf{u}_{g}(\\phi_{1})|}\n$$\n使用科里奥利参数关于纬度和地球自转速率符号$\\Omega$的标准表达式，但不要代入$\\Omega$或$g$的任何数值；仅计算指定角度的三角函数值。将$R$的最终数值表示为四舍五入到$4$位有效数字。纬度角使用度数。最后，解释计算出的$|\\mathbf{u}_{g}|$变化对低纬度地区地转平衡与旋衡地转平衡相对重要性的物理影响。",
            "solution": "该问题要求分三部分作答：第一，推导表层地转流速的关系；第二，计算两个不同纬度下地转流速的比值；第三，解释这一变化的物理后果。\n\n**第一部分：地转流速关系的推导**\n\n出发点是在Boussinesq近似下，旋转坐标系中稳定、无粘流体的水平动量方程。该方程为：\n$$\n(\\mathbf{u}_h \\cdot \\nabla_h) \\mathbf{u}_h + f \\mathbf{\\hat{k}} \\times \\mathbf{u}_h = -\\frac{1}{\\rho_0} \\nabla_h p\n$$\n其中$\\mathbf{u}_h$是水平速度矢量，$\\nabla_h$是水平梯度算子，$f = 2\\Omega\\sin\\phi$是科里奥利参数（$\\Omega$是地球自转速率，$\\phi$是纬度），$\\mathbf{\\hat{k}}$是局地垂直单位矢量，$\\rho_0$是恒定的参考密度，$p$是压强。项$(\\mathbf{u}_h \\cdot \\nabla_h) \\mathbf{u}_h$代表平流加速度。\n\n当地转平衡实现时，平流加速度与科里奥利力和气压梯度力相比可以忽略不计。这是大尺度、慢速流动的特征，其Rossby数很小。问题陈述假设纯地转平衡，因此我们忽略平流项$(\\mathbf{u}_h \\cdot \\nabla_h) \\mathbf{u}_h$。因此，地转流速（记为$\\mathbf{u}_g$）满足：\n$$\nf \\mathbf{\\hat{k}} \\times \\mathbf{u}_g = -\\frac{1}{\\rho_0} \\nabla_h p\n$$\n接下来，我们将水平气压梯度$\\nabla_h p$与海面高度（SSH）$\\eta(x,y)$联系起来。我们使用静力平衡近似：\n$$\n\\frac{\\partial p}{\\partial z} = -\\rho g\n$$\n其中$g$是重力加速度，$\\rho$是流体密度。在Boussinesq近似下对于表层流，我们认为密度是恒定的参考密度，即$\\rho = \\rho_0$。将静力方程从任意深度$z$向上积分到海面$z=\\eta(x,y)$，得到：\n$$\n\\int_z^{\\eta} \\frac{\\partial p}{\\partial z'} dz' = \\int_z^{\\eta} -\\rho_0 g \\, dz'\n$$\n$$\np(z=\\eta) - p(z) = -\\rho_0 g (\\eta-z)\n$$\n海面处的压强是大气压，$p(z=\\eta) = p_{atm}$。假设$p_{atm}$在空间上是均匀的，我们可以将任意深度$z$处的压强写为：\n$$\np(x,y,z) = p_{atm} + \\rho_0 g (\\eta(x,y) - z)\n$$\n水平气压梯度$\\nabla_h p$通过对该表达式求水平梯度得到：\n$$\n\\nabla_h p = \\nabla_h (p_{atm} + \\rho_0 g \\eta - \\rho_0 g z)\n$$\n由于$p_{atm}$、$\\rho_0$和$g$是常数，且$z$是一个独立坐标，这简化为：\n$$\n\\nabla_h p = \\rho_0 g \\nabla_h \\eta\n$$\n这表明水平气压梯度与海面坡度成正比，并且不随深度变化。\n\n将此$\\nabla_h p$的结果代入地转平衡方程：\n$$\nf \\mathbf{\\hat{k}} \\times \\mathbf{u}_g = -\\frac{1}{\\rho_0} (\\rho_0 g \\nabla_h \\eta) = -g \\nabla_h \\eta\n$$\n为求解$\\mathbf{u}_g$，我们用$\\mathbf{\\hat{k}}$与该方程做叉积：\n$$\n\\mathbf{\\hat{k}} \\times (f \\mathbf{\\hat{k}} \\times \\mathbf{u}_g) = \\mathbf{\\hat{k}} \\times (-g \\nabla_h \\eta)\n$$\n使用矢量三重积恒等式$\\mathbf{A} \\times (\\mathbf{B} \\times \\mathbf{C}) = (\\mathbf{A} \\cdot \\mathbf{C})\\mathbf{B} - (\\mathbf{A} \\cdot \\mathbf{B})\\mathbf{C}$，我们得到：\n$$\nf [(\\mathbf{\\hat{k}} \\cdot \\mathbf{u}_g)\\mathbf{\\hat{k}} - (\\mathbf{\\hat{k}} \\cdot \\mathbf{\\hat{k}})\\mathbf{u}_g] = -g (\\mathbf{\\hat{k}} \\times \\nabla_h \\eta)\n$$\n由于$\\mathbf{u}_g$是水平速度，它与垂直矢量$\\mathbf{\\hat{k}}$垂直，所以$\\mathbf{\\hat{k}} \\cdot \\mathbf{u}_g = 0$。并且，$\\mathbf{\\hat{k}} \\cdot \\mathbf{\\hat{k}} = 1$。方程变为：\n$$\n-f \\mathbf{u}_g = -g (\\mathbf{\\hat{k}} \\times \\nabla_h \\eta)\n$$\n$$\n\\mathbf{u}_g = \\frac{g}{f} (\\mathbf{\\hat{k}} \\times \\nabla_h \\eta)\n$$\n这是地转流速的矢量表达式。为求其大小$|\\mathbf{u}_g|$，我们有：\n$$\n|\\mathbf{u}_g| = \\left| \\frac{g}{f} \\right| |\\mathbf{\\hat{k}} \\times \\nabla_h \\eta|\n$$\n由于$\\mathbf{\\hat{k}}$与水平矢量$\\nabla_h \\eta$垂直，它们叉积的大小为$|\\mathbf{\\hat{k}} \\times \\nabla_h \\eta| = |\\mathbf{\\hat{k}}| |\\nabla_h \\eta| \\sin(90^{\\circ}) = |\\nabla_h \\eta|$。假设流动发生在北半球，其中$\\phi  0$，科里奥利参数$f = 2\\Omega\\sin\\phi$为正，所以$|f|=f$。因此，地转流速大小的关系为：\n$$\n|\\mathbf{u}_g| = \\frac{g}{f} |\\nabla \\eta|\n$$\n为清晰起见，这里我们用$\\nabla\\eta$表示水平梯度$\\nabla_h\\eta$。\n\n**第二部分：比值的计算**\n\n我们需要计算纬度$\\phi_{1}=45^{\\circ}$和$\\phi_{2}=10^{\\circ}$下的比值$R \\equiv \\frac{|\\mathbf{u}_{g}(\\phi_{2})|}{|\\mathbf{u}_{g}(\\phi_{1})|}$。问题陈述SSH梯度大小$|\\nabla \\eta|$是恒定的。参数$g$和$\\Omega$也是恒定的。\n使用推导出的关系和科里奥利参数表达式$f=2\\Omega\\sin\\phi$：\n$$\n|\\mathbf{u}_g(\\phi_1)| = \\frac{g}{2\\Omega\\sin\\phi_1} |\\nabla \\eta|\n$$\n$$\n|\\mathbf{u}_g(\\phi_2)| = \\frac{g}{2\\Omega\\sin\\phi_2} |\\nabla \\eta|\n$$\n因此，比值$R$是：\n$$\nR = \\frac{\\frac{g}{2\\Omega\\sin\\phi_2} |\\nabla \\eta|}{\\frac{g}{2\\Omega\\sin\\phi_1} |\\nabla \\eta|} = \\frac{\\sin\\phi_1}{\\sin\\phi_2}\n$$\n代入给定值$\\phi_1 = 45^{\\circ}$和$\\phi_2 = 10^{\\circ}$：\n$$\nR = \\frac{\\sin(45^{\\circ})}{\\sin(10^{\\circ})}\n$$\n我们计算三角函数的值：$\\sin(45^{\\circ}) = \\frac{\\sqrt{2}}{2} \\approx 0.707107$ 以及 $\\sin(10^{\\circ}) \\approx 0.173648$。\n$$\nR \\approx \\frac{0.707107}{0.173648} \\approx 4.07207\n$$\n按要求四舍五入到4位有效数字，我们得到$R = 4.072$。\n\n**第三部分：物理诠释**\n\n比值$R \\approx 4.072$表明，对于一个恒定的海面坡度$|\\nabla \\eta|$，纬度$10^{\\circ}$处的地转流速必须是纬度$45^{\\circ}$处的四倍以上。这对地转平衡本身的有效性具有深远的影响。\n\n地转近似在Rossby数$Ro = \\frac{U}{fL}$（其中$U$是特征速度，$L$是特征长度尺度）远小于1时是有效的。Rossby数量化了平流加速度项$|(\\mathbf{u}_h \\cdot \\nabla_h) \\mathbf{u}_h| \\sim U^2/L$与科里奥利项$|f \\mathbf{\\hat{k}} \\times \\mathbf{u}_h| \\sim fU$大小的比值。\n\n在我们的例子中，特征速度$U$是地转流速$|\\mathbf{u}_g|$。我们发现$|\\mathbf{u}_g| \\propto 1/f$。因此，Rossby数的尺度关系为：\n$$\nRo \\propto \\frac{|\\mathbf{u}_g|}{f} \\propto \\frac{1/f}{f} = \\frac{1}{f^2}\n$$\n当一个流体质块从$\\phi_1 = 45^{\\circ}$移动到$\\phi_2 = 10^{\\circ}$时，科里奥利参数$f=2\\Omega\\sin\\phi$减小。因此，Rossby数将增大。两个纬度处Rossby数的比值为：\n$$\n\\frac{Ro(\\phi_2)}{Ro(\\phi_1)} \\propto \\frac{f(\\phi_1)^2}{f(\\phi_2)^2} = \\left(\\frac{2\\Omega\\sin\\phi_1}{2\\Omega\\sin\\phi_2}\\right)^2 = \\left(\\frac{\\sin\\phi_1}{\\sin\\phi_2}\\right)^2 = R^2\n$$\n由于$R \\approx 4.072$，我们发现$R^2 \\approx 16.58$。这意味着Rossby数增加了超过16倍。\n\nRossby数的这种急剧增加意味着，在$45^{\\circ}$时可以忽略的平流加速度项（假设$Ro \\ll 1$），在$10^{\\circ}$时与科里奥利力相比可能不再是小量。包含平流加速度的完整动量平衡被称为旋衡地转平衡：\n$$\nf \\mathbf{\\hat{k}} \\times \\mathbf{u}_{cg} + (\\mathbf{u}_{cg} \\cdot \\nabla_h) \\mathbf{u}_{cg} = -g \\nabla \\eta\n$$\n项$(\\mathbf{u}_{cg} \\cdot \\nabla_h)\\mathbf{u}_{cg}$代表了弯曲流动路径的离心力。随着流速在低纬度地区增加，这个离心力项变得越来越重要。因此，虽然地转平衡在像$45^{\\circ}$这样的中纬度地区可能是一个极好的近似，但越靠近赤道，其近似效果就越差。在$10^{\\circ}$处，流动更适合用旋衡地转平衡来描述，其中气压梯度力由科里奥利力和离心力共同平衡。计算出的$|\\mathbf{u}_g|$的巨大变化标志着主导动力学从简单的地转状态向更复杂的非线性平衡状态的根本性转变。在赤道附近，当$f \\to 0$时，地转平衡未定义，非线性动力学占主导地位。",
            "answer": "$$\n\\boxed{4.072}\n$$"
        },
        {
            "introduction": "本章的最终练习将理论知识转化为计算实践，这是一项现代计算海洋学中的核心任务。您将构建一个数值反演程序，利用地转关系作为物理约束，从给定的速度场数据中估算压力场。这项技术是海洋状态估计和数据同化领域的基础，它展示了如何将动力学平衡应用于从不完整观测中重建完整海洋状态的实际问题中 。",
            "id": "3794121",
            "problem": "您的任务是使用Python编程语言构建一个完整的、可运行的程序，该程序执行Tikhonov正则化最小二乘反演，通过强制执行地转平衡 $f\\hat{k}\\times\\mathbf{u}\\approx-(1/\\rho_{0})\\nabla p$ 来估计二维海洋网格上的压力场 $p$。推导必须从旋转坐标系下的动量方程开始，\n$\\rho_{0}\\frac{D\\mathbf{u}}{Dt}+2\\rho_{0}\\boldsymbol{\\Omega}\\times\\mathbf{u}=-\\nabla p+\\text{friction}+\\text{other forces}$,\n并考虑准稳态、水平无辐散、静力平衡的状态，其中平流加速度和摩擦在主导阶上被忽略，简化为地转平衡\n$f\\hat{k}\\times\\mathbf{u}\\approx-\\frac{1}{\\rho_{0}}\\nabla p$,\n其中 $f$ 是科里奥利参数，$\\hat{k}$ 是垂直单位向量，$\\mathbf{u}=(u_{x},u_{y})$ 是水平速度，$\\rho_{0}$ 是参考密度，$p$ 是动力学压力。在强曲率流中，梯度风校正会引入一个离心项 $(\\mathbf{u}\\cdot\\nabla)\\mathbf{u}$，但在本任务中，您将仅在反演中强制执行地转关系，并检验对惩罚权重的敏感性。\n\n在一个均匀的二维方形网格上定义未知压力场 $p$，该网格有 $N_{x}\\times N_{y}$ 个节点，覆盖一个边长为 $L$ 米的区域。设 $(x,y)$ 为以区域中心为原点的笛卡尔坐标。观测到的速度场是一个合成的轴对称涡旋，在极坐标中由方位角速度指定\n$u_{\\theta}(r)=V_{0}\\exp\\left[-\\left(\\frac{r}{R}\\right)^{2}\\right]$,\n其中 $r=\\sqrt{x^{2}+y^{2}}$，$V_{0}$ 是峰值速度（单位：米/秒），$R$ 是涡旋尺度（单位：米）。通过以下方式转换为笛卡尔分量\n$u_{x}(x,y)=-u_{\\theta}(r)\\frac{y}{r},\\quad u_{y}(x,y)=u_{\\theta}(r)\\frac{x}{r}$,\n并约定在 $r=0$ 处 $u_{x}=u_{y}=0$。\n\n令 $D$ 表示离散梯度算子，它将网格节点上的 $p$ 值映射到节点上的叠加场 $(\\partial p/\\partial x,\\partial p/\\partial y)$。在内部使用二阶中心差分，在边界上使用一致的单边差分。定义地转关系所隐含的目标梯度场，\n$\\mathbf{g}(x,y)=\\nabla p_{\\text{geo}}(x,y)=-\\rho_{0}f\\,\\hat{k}\\times\\mathbf{u}(x,y)$,\n因此 $g_{x}(x,y)=\\rho_{0}f\\,u_{y}(x,y)$ 且 $g_{y}(x,y)=-\\rho_{0}f\\,u_{x}(x,y)$。\n\n通过最小化以下函数来构建 $p$ 的Tikhonov正则化最小二乘问题\n$J(p)=\\left\\|Dp-\\mathbf{g}\\right\\|_{2}^{2}+\\alpha\\left\\|p\\right\\|_{2}^{2}$,\n其中 $\\alpha$ 是惩罚权重，单位为米$^{-2}$ ($\\text{m}^{-2}$)，确保两项之间的量纲一致性。推导并实现相应的正规方程，注意对于 $\\alpha0$，该系统是对称正定的。\n\n数值规格：\n- 使用 $N_{x}=N_{y}=41$，$L=160{,}000$ 米，以及均匀网格间距 $d_{x}=d_{y}=L/(N_{x}-1)$。\n- 使用 $R=40{,}000$ 米，$f=10^{-4}$ 每秒，以及 $\\rho_{0}=1025$ 千克每立方米。\n- 构建 $D$ 作用于以节点为中心的 $p$，使用上述有限差分方案生成以节点为中心的离散梯度。\n- 使用适合对称正定矩阵的数值稳定方法求解 $p$ 的线性系统。\n\n评估指标：\n- 计算地转残差场\n$\\mathbf{r}(x,y)=f\\hat{k}\\times\\mathbf{u}(x,y)+\\frac{1}{\\rho_{0}}\\nabla p(x,y)$,\n并报告其在所有网格节点上的大小的均方根(RMS)，单位为米每平方秒，四舍五入到六位小数。\n- 计算反演出的压力梯度 $\\nabla p$ 在所有网格节点上的大小的均方根(RMS)，单位为帕斯卡每米，四舍五入到六位小数。\n\n测试套件：\n对以下六组参数对 $(V_{0},\\alpha)$ 进行反演评估：\n1. $V_{0}=0.1$ 米/秒, $\\alpha=10^{-8}$ 每平方米。\n2. $V_{0}=0.1$ 米/秒, $\\alpha=10^{-7}$ 每平方米。\n3. $V_{0}=0.1$ 米/秒, $\\alpha=10^{-6}$ 每平方米。\n4. $V_{0}=1.0$ 米/秒, $\\alpha=10^{-8}$ 每平方米。\n5. $V_{0}=1.0$ 米/秒, $\\alpha=10^{-7}$ 每平方米。\n6. $V_{0}=1.0$ 米/秒, $\\alpha=10^{-6}$ 每平方米。\n\n最终输出格式：\n您的程序应生成一行输出，按以下顺序包含十二个结果：对于每个测试用例，附加地转残差RMS（单位：米每平方秒），然后是压力梯度RMS（单位：帕斯卡每米）。最终输出必须是一个用方括号括起来的逗号分隔列表，例如，“[rms1,grad1,rms2,grad2,...]”。所有值必须按照指定单位四舍五入到六位小数。",
            "solution": "该问题要求从给定的速度场 $\\mathbf{u}$ 通过反演地转平衡关系来估计二维压力场 $p$。这是地球物理流体动力学中的一个经典反演问题。解将使用Tikhonov正则化最小二乘法来构建，以确保问题是适定的并控制解的敏感性。\n\n出发点是地转平衡方程，它是旋转坐标系中动量方程对大尺度、慢速流动的主导阶近似：\n$$\nf\\hat{k}\\times\\mathbf{u} = -\\frac{1}{\\rho_{0}}\\nabla p\n$$\n这里，$f$ 是科里奥利参数，$\\hat{k}$ 是向上的垂直单位向量，$\\mathbf{u}=(u_x, u_y)$ 是水平速度向量，$\\rho_{0}$ 是一个恒定的参考密度，$\\nabla p$ 是水平压力梯度。\n\n这个方程可以重新排列，以定义一个可以直接从观测速度场计算的目标压力梯度 $\\mathbf{g}$：\n$$\n\\mathbf{g} \\equiv \\nabla p_{\\text{geo}} = -\\rho_{0}f\\hat{k}\\times\\mathbf{u}\n$$\n在分量形式中，由于 $\\hat{k}\\times\\mathbf{u} = (0,0,1)\\times(u_x, u_y, 0) = (-u_y, u_x, 0)$，目标梯度的分量是：\n$$\ng_x = \\rho_{0} f u_y \\quad \\text{和} \\quad g_y = -\\rho_{0} f u_x\n$$\n现在的问题是找到一个标量压力场 $p(x,y)$，使其梯度 $\\nabla p$ 尽可能接近目标梯度 $\\mathbf{g}(x,y)$。这是一个反演问题，因为我们是从其导数（$\\nabla p$）确定一个场（$p$）。这类问题通常是不适定的；在这种情况下，压力 $p$ 仅能确定到一个任意常数，因为常数的梯度为零。\n\n为了将其形式化为一个可解的数值问题，我们首先对区域进行离散化。压力 $p$ 由其在均匀 $N_x \\times N_y$ 网格节点上的值表示。这 $N_p = N_x N_y$ 个值被展平成一个大小为 $N_p$ 的单列向量 $\\mathbf{p}$。\n\n连续梯度算子 $\\nabla$ 被一个离散有限差分算子所替代，该算子由矩阵 $D$ 表示。这个矩阵将压力向量 $\\mathbf{p}$ 映射到一个其离散梯度的向量。该梯度向量有 $2N_p$ 个分量，由 $\\partial p/\\partial x$ 的 $N_p$ 个值和 $\\partial p/\\partial y$ 的 $N_p$ 个值串联而成。因此，$D$ 是一个 $2N_p \\times N_p$ 的矩阵。我们将 $D$ 构建为两个矩阵 $D_x$ 和 $D_y$ 的堆叠，它们分别计算 $x$ 和 $y$ 方向的偏导数：\n$$\nD = \\begin{pmatrix} D_x \\\\ D_y \\end{pmatrix}\n$$\n根据问题说明，我们对内部网格点使用二阶中心差分，在边界上使用一阶单边（向前/向后）差分。对于网格间距 $d_x$， $x$-导数计算如下：\n$$ \\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} \\approx \\begin{cases} (p_{1,j} - p_{0,j}) / d_x  \\text{若 } i=0 \\\\ (p_{i+1,j} - p_{i-1,j}) / (2d_x)  \\text{若 } 0  i  N_x-1 \\\\ (p_{N_x-1,j} - p_{N_x-2,j}) / d_x  \\text{若 } i=N_x-1 \\end{cases} $$\n对于 $y$-导数，使用类似的方案，间距为 $d_y$。\n\n目标梯度场 $\\mathbf{g}$ 也在每个 $N_p$ 网格点上进行评估，并展平成一个长度为 $2N_p$ 的向量，以与离散算子 $D$ 的输出兼容。\n\n反演旨在寻找一个压力向量 $\\mathbf{p}$，使得计算出的梯度 $D\\mathbf{p}$ 与目标梯度 $\\mathbf{g}$ 之差的欧几里得范数平方最小。为了解决不适定性问题并对解进行正则化，我们添加了一个惩罚项，该项惩罚大幅值的压力解。这导致了Tikhonov正则化最小二乘代价函数 $J(\\mathbf{p})$：\n$$\nJ(\\mathbf{p}) = \\| D\\mathbf{p} - \\mathbf{g} \\|_{2}^{2} + \\alpha \\| \\mathbf{p} \\|_{2}^{2}\n$$\n这里，$\\alpha  0$ 是正则化参数或惩罚权重。$\\| \\mathbf{p} \\|_{2}^{2}$ 项是压力向量的 $L_2$ 范数平方，其包含确保了问题有唯一、稳定的解。$\\alpha$ 的单位必须是长度的平方的倒数，例如 $\\text{m}^{-2}$，以确保代价函数两项之间的量纲一致性，因为 $D\\mathbf{p}$ 和 $\\mathbf{g}$ 的单位都是压力每长度（$\\text{Pa/m}$）。\n\n为了找到最小化 $J(\\mathbf{p})$ 的向量 $\\mathbf{p}$，我们计算 $J$ 相对于 $\\mathbf{p}$ 的梯度并将其设为零。\n$$\nJ(\\mathbf{p}) = (\\mathbf{p}^T D^T - \\mathbf{g}^T)(D\\mathbf{p} - \\mathbf{g}) + \\alpha \\mathbf{p}^T \\mathbf{p} = \\mathbf{p}^T D^T D \\mathbf{p} - 2\\mathbf{g}^T D \\mathbf{p} + \\mathbf{g}^T\\mathbf{g} + \\alpha \\mathbf{p}^T I \\mathbf{p}\n$$\n对 $\\mathbf{p}$ 求导得到：\n$$\n\\frac{\\partial J}{\\partial \\mathbf{p}} = 2(D^T D)\\mathbf{p} - 2 D^T \\mathbf{g} + 2\\alpha I \\mathbf{p}\n$$\n令 $\\partial J / \\partial \\mathbf{p} = 0$ 得到正规方程：\n$$\n(D^T D + \\alpha I) \\mathbf{p} = D^T \\mathbf{g}\n$$\n这是一个 $A\\mathbf{x} = \\mathbf{b}$ 形式的线性系统，其中 $A = D^T D + \\alpha I$ 是一个 $N_p \\times N_p$ 矩阵，未知向量是 $\\mathbf{x} = \\mathbf{p}$，右侧是向量 $\\mathbf{b} = D^T \\mathbf{g}$。对于 $\\alpha  0$，矩阵 $A$ 是对称正定的，这保证了唯一解，并允许使用高效稳定的数值求解器，如Cholesky分解。\n\n一旦系统求解出 $\\mathbf{p}$，就可以计算评估指标。\n反演压力梯度大小的均方根(RMS)计算如下：\n$$\n\\text{RMS}(\\|\\nabla p\\|) = \\sqrt{\\frac{1}{N_p} \\sum_{k=1}^{N_p} \\left( \\left(\\frac{\\partial p}{\\partial x}\\right)_k^2 + \\left(\\frac{\\partial p}{\\partial y}\\right)_k^2 \\right)} = \\sqrt{\\frac{1}{N_p} \\|D\\mathbf{p}\\|_2^2}\n$$\n地转残差场定义为 $\\mathbf{r} = f\\hat{k}\\times\\mathbf{u} + \\frac{1}{\\rho_0}\\nabla p$。利用 $\\mathbf{g}$ 的定义，我们可以写出 $\\mathbf{r} = -\\frac{1}{\\rho_0}\\mathbf{g} + \\frac{1}{\\rho_0}D\\mathbf{p} = \\frac{1}{\\rho_0}(D\\mathbf{p}-\\mathbf{g})$。其大小的RMS是：\n$$\n\\text{RMS}(\\|\\mathbf{r}\\|) = \\sqrt{\\frac{1}{N_p} \\sum_{k=1}^{N_p} \\left( r_{x,k}^2 + r_{y,k}^2 \\right)} = \\frac{1}{\\rho_0} \\sqrt{\\frac{1}{N_p} \\|D\\mathbf{p}-\\mathbf{g}\\|_2^2}\n$$\n程序将对测试套件中提供的每一对 $(V_0, \\alpha)$ 执行这整个过程，并报告两个指定的RMS指标。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Main function to run the Tikhonov-regularized inversion for all test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (V0 [m/s], alpha [m^-2])\n        (0.1, 1e-8),\n        (0.1, 1e-7),\n        (0.1, 1e-6),\n        (1.0, 1e-8),\n        (1.0, 1e-7),\n        (1.0, 1e-6),\n    ]\n\n    # Physical and grid constants\n    NX = 41\n    NY = 41\n    L = 160000.0  # meters\n    R = 40000.0   # meters\n    F = 1e-4      # s^-1\n    RHO0 = 1025.0 # kg/m^3\n\n    results = []\n    for v0, alpha in test_cases:\n        rms_res, rms_grad = compute_inversion(v0, alpha, NX, NY, L, R, F, RHO0)\n        results.append(f\"{rms_res:.6f}\")\n        results.append(f\"{rms_grad:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef compute_inversion(v0, alpha, nx, ny, L, R, f, rho0):\n    \"\"\"\n    Performs the inversion for a single set of parameters.\n\n    Args:\n        v0 (float): Peak vortex speed [m/s].\n        alpha (float): Tikhonov regularization parameter [m^-2].\n        nx (int): Number of grid points in x.\n        ny (int): Number of grid points in y.\n        L (float): Domain side length [m].\n        R (float): Vortex scale radius [m].\n        f (float): Coriolis parameter [s^-1].\n        rho0 (float): Reference density [kg/m^3].\n\n    Returns:\n        tuple[float, float]: A tuple containing:\n            - rms_residual (float): RMS of geostrophic residual [m/s^2].\n            - rms_grad_p (float): RMS of pressure gradient magnitude [Pa/m].\n    \"\"\"\n    \n    # 1. Grid setup\n    np_total = nx * ny\n    dx = L / (nx - 1)\n    dy = L / (ny - 1)\n    x_coords = np.linspace(-L / 2.0, L / 2.0, nx)\n    y_coords = np.linspace(-L / 2.0, L / 2.0, ny)\n    xx, yy = np.meshgrid(x_coords, y_coords, indexing='ij')\n\n    # 2. Construct velocity field and target gradient vector 'g'\n    r = np.sqrt(xx**2 + yy**2)\n    u_theta = v0 * np.exp(-(r/R)**2)\n    \n    ux = np.zeros_like(r)\n    uy = np.zeros_like(r)\n    \n    # Avoid division by zero at the center r=0\n    mask = r  0\n    ux[mask] = -u_theta[mask] * yy[mask] / r[mask]\n    uy[mask] = u_theta[mask] * xx[mask] / r[mask]\n    \n    gx = rho0 * f * uy\n    gy = -rho0 * f * ux\n    \n    g_vec = np.concatenate([gx.ravel(), gy.ravel()])\n\n    # 3. Construct discrete gradient operator 'D'\n    Dx = np.zeros((np_total, np_total))\n    Dy = np.zeros((np_total, np_total))\n\n    for i in range(nx):\n        for j in range(ny):\n            k = i * ny + j # Flattened index, row-major style ('C') is default for ravel. Our i,j corresponds to this.\n            \n            # X-derivative\n            if i == 0:  # Forward difference on left boundary\n                k_fwd = (i + 1) * ny + j\n                Dx[k, k] = -1.0 / dx\n                Dx[k, k_fwd] = 1.0 / dx\n            elif i == nx - 1:  # Backward difference on right boundary\n                k_bwd = (i - 1) * ny + j\n                Dx[k, k] = 1.0 / dx\n                Dx[k, k_bwd] = -1.0 / dx\n            else:  # Centered difference in interior\n                k_fwd = (i + 1) * ny + j\n                k_bwd = (i - 1) * ny + j\n                Dx[k, k_fwd] = 1.0 / (2.0 * dx)\n                Dx[k, k_bwd] = -1.0 / (2.0 * dx)\n\n            # Y-derivative\n            if j == 0:  # Forward difference on bottom boundary\n                k_fwd = i * ny + (j + 1)\n                Dy[k, k] = -1.0 / dy\n                Dy[k, k_fwd] = 1.0 / dy\n            elif j == ny - 1:  # Backward difference on top boundary\n                k_bwd = i * ny + (j - 1)\n                Dy[k, k] = 1.0 / dy\n                Dy[k, k_bwd] = -1.0 / dy\n            else:  # Centered difference in interior\n                k_fwd = i * ny + (j + 1)\n                k_bwd = i * ny + (j - 1)\n                Dy[k, k_fwd] = 1.0 / (2.0 * dy)\n                Dy[k, k_bwd] = -1.0 / (2.0 * dy)\n    \n    D = np.vstack([Dx, Dy])\n\n    # 4. Solve the normal equations\n    A = D.T @ D + alpha * np.identity(np_total)\n    b = D.T @ g_vec\n    \n    # Use a solver optimized for symmetric positive-definite matrices\n    p_vec = linalg.solve(A, b, assume_a='pos')\n\n    # 5. Calculate evaluation metrics\n    grad_p_vec = D @ p_vec\n    \n    # RMS of |grad(p)|\n    grad_p_x_flat = grad_p_vec[:np_total]\n    grad_p_y_flat = grad_p_vec[np_total:]\n    grad_p_mag_sq = grad_p_x_flat**2 + grad_p_y_flat**2\n    rms_grad_p = np.sqrt(np.mean(grad_p_mag_sq))\n\n    # RMS of geostrophic residual\n    # residual r = (1/rho0) * (Dp - g)\n    residual_vec = grad_p_vec - g_vec\n    r_vec = (1.0 / rho0) * residual_vec\n    r_x_flat = r_vec[:np_total]\n    r_y_flat = r_vec[np_total:]\n    r_mag_sq = r_x_flat**2 + r_y_flat**2\n    rms_residual = np.sqrt(np.mean(r_mag_sq))\n    \n    return rms_residual, rms_grad_p\n\nsolve()\n```"
        }
    ]
}