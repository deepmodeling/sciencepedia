{
    "hands_on_practices": [
        {
            "introduction": "在构建数值模型时，我们常需要在计算域的边界（例如海岸线）附近近似导数，此时对称的中心差分格式不再适用。本练习将引导你运用泰勒级数和待定系数法，系统地推导出一个高阶单边差分格式的系数 ()。掌握此方法是设计满足特定精度要求的定制化差分格式的基础，对于精确处理物理边界条件至关重要。",
            "id": "3792784",
            "problem": "一个海洋模型在毗邻一条位于位置 $x_{0}$ 的平直海岸线的均匀一维横断面上解析沿陆架动量。该模型的网格间距为 $\\,\\Delta x\\,>0$，且仅在 $x \\geq x_{0}$ 范围内存在海洋点。设 $f(x)$ 是一个足够光滑的标量场，表示限于海洋点上的沿陆架速度分量。为计算海岸线处的空间梯度，该模型使用一个单侧有限差分近似来逼近 $x_{0}$ 处的一阶导数，该近似由五个海洋网格点 $x_{0}+m\\,\\Delta x$（其中 $m \\in \\{0,1,2,3,4\\}$）构建：\n$$\nf'(x_{0}) \\approx \\frac{1}{\\Delta x}\\sum_{m=0}^{4} c_{m}\\,f\\!\\left(x_{0}+m\\,\\Delta x\\right),\n$$\n其中系数 $c_{m}$ 待确定。\n\n从 $f(x)$ 在 $x_{0}$ 点的泰勒级数展开和截断误差阶的定义出发，确定系数 $c_{0},c_{1},c_{2},c_{3},c_{4}$，使其在给定的模板宽度约束下，代数精度阶达到最大。然后，报告得到的整数阶 $p$，使得截断误差为 $\\,\\mathcal{O}(\\Delta x^{p})\\,.$\n\n以精确有理数形式表示这些系数和阶数。将你的最终答案以单个行矩阵的形式给出，按顺序包含 $c_{0},c_{1},c_{2},c_{3},c_{4}$ 和 $p$。无需四舍五入，最终答案中不应包含任何物理单位。",
            "solution": "问题要求确定五个系数 $c_{0}, c_{1}, c_{2}, c_{3}, c_{4}$，用于一阶导数 $f'(x_{0})$ 的单侧有限差分近似，并使精度阶最大化。给定的近似公式为：\n$$\nf'(x_{0}) \\approx \\frac{1}{\\Delta x}\\sum_{m=0}^{4} c_{m}\\,f(x_{0}+m\\,\\Delta x)\n$$\n基于泰勒级数展开的待定系数法是完成此项任务的标准程序。我们将每个函数值 $f(x_{0}+m\\,\\Delta x)$ 在点 $x_{0}$ 周围展开为泰勒级数。由于假设 $f(x)$ 足够光滑，这些展开是有效的。每一项的展开式为：\n$$\nf(x_{0}+m\\,\\Delta x) = f(x_{0}) + (m\\,\\Delta x)f'(x_{0}) + \\frac{(m\\,\\Delta x)^{2}}{2!}f''(x_{0}) + \\frac{(m\\,\\Delta x)^{3}}{3!}f'''(x_{0}) + \\dots = \\sum_{k=0}^{\\infty} \\frac{(m\\,\\Delta x)^{k}}{k!} f^{(k)}(x_{0})\n$$\n其中 $f^{(k)}(x_{0})$ 表示 $f$ 在 $x_{0}$ 处求得的 k 阶导数。\n\n将这些展开式代入有限差分公式，我们得到：\n$$\n\\frac{1}{\\Delta x}\\sum_{m=0}^{4} c_{m} \\left( \\sum_{k=0}^{\\infty} \\frac{(m\\,\\Delta x)^{k}}{k!} f^{(k)}(x_{0}) \\right)\n$$\n我们可以交换求和顺序，并通过将具有相同 $f$ 导数的项分组来重排表达式：\n$$\n\\sum_{k=0}^{\\infty} \\frac{(\\Delta x)^{k-1}}{k!} f^{(k)}(x_{0}) \\left( \\sum_{m=0}^{4} c_{m}m^{k} \\right)\n$$\n让我们写出此展开式的前几项：\n$$\n\\frac{1}{\\Delta x} f(x_{0}) \\left( \\sum_{m=0}^{4} c_{m}m^{0} \\right) + f'(x_{0}) \\left( \\sum_{m=0}^{4} c_{m}m^{1} \\right) + \\frac{\\Delta x}{2} f''(x_{0}) \\left( \\sum_{m=0}^{4} c_{m}m^{2} \\right) + \\frac{(\\Delta x)^{2}}{6} f'''(x_{0}) \\left( \\sum_{m=0}^{4} c_{m}m^{3} \\right) + \\dots\n$$\n为使该表达式成为 $f'(x_{0})$ 的近似，$f'(x_{0})$ 的系数必须为 $1$，而其他项的系数应为零，直到尽可能高的阶数。有五个未知系数（$c_{0}$ 到 $c_{4}$），我们可以满足五个线性约束。为了最大化精度阶，我们将误差中最低阶项的系数设为零。\n这导出了以下线性方程组：\n\\begin{enumerate}\n    \\item $f(x_{0})$ 的系数必须为零： $\\frac{1}{\\Delta x} \\left(\\sum_{m=0}^{4} c_{m}m^{0}\\right) = 0 \\implies \\sum_{m=0}^{4} c_{m} = 0$。\n    \\item $f'(x_{0})$ 的系数必须为一： $\\sum_{m=0}^{4} c_{m}m^{1} = 1$。\n    \\item $f''(x_{0})$ 的系数必须为零： $\\frac{\\Delta x}{2} \\left(\\sum_{m=0}^{4} c_{m}m^{2}\\right) = 0 \\implies \\sum_{m=0}^{4} c_{m}m^{2} = 0$。\n    \\item $f'''(x_{0})$ 的系数必须为零： $\\frac{(\\Delta x)^{2}}{6} \\left(\\sum_{m=0}^{4} c_{m}m^{3}\\right) = 0 \\implies \\sum_{m=0}^{4} c_{m}m^{3} = 0$。\n    \\item $f^{(4)}(x_{0})$ 的系数必须为零： $\\frac{(\\Delta x)^{3}}{24} \\left(\\sum_{m=0}^{4} c_{m}m^{4}\\right) = 0 \\implies \\sum_{m=0}^{4} c_{m}m^{4} = 0$。\n\\end{enumerate}\n针对 $m \\in \\{0, 1, 2, 3, 4\\}$ 明确写出这些方程：\n$$\n\\begin{array}{rcrcrcrcrcr}\nc_{0} + c_{1} + c_{2} + c_{3} + c_{4} = 0 \\\\\n0 c_{0} + 1 c_{1} + 2 c_{2} + 3 c_{3} + 4 c_{4} = 1 \\\\\n0 c_{0} + 1 c_{1} + 4 c_{2} + 9 c_{3} + 16 c_{4} = 0 \\\\\n0 c_{0} + 1 c_{1} + 8 c_{2} + 27 c_{3} + 64 c_{4} = 0 \\\\\n0 c_{0} + 1 c_{1} + 16 c_{2} + 81 c_{3} + 256 c_{4} = 0 \\\\\n\\end{array}\n$$\n这是一个关于五个未知系数的五元线性方程组。在后四个方程中，涉及 $c_{0}$ 的项均为零。由第一个方程，我们有 $c_{0} = -(c_{1} + c_{2} + c_{3} + c_{4})$。剩下的四个方程构成了关于 $c_{1}, c_{2}, c_{3}, c_{4}$ 的 $4 \\times 4$ 方程组。解此方程组可得：\n$$\nc_{1} = 4\n$$\n$$\nc_{2} = -3\n$$\n$$\nc_{3} = \\frac{4}{3}\n$$\n$$\nc_{4} = -\\frac{1}{4}\n$$\n现在我们求 $c_{0}$：\n$$\nc_{0} = -\\left(4 - 3 + \\frac{4}{3} - \\frac{1}{4}\\right) = -\\left(1 + \\frac{16-3}{12}\\right) = -\\left(1 + \\frac{13}{12}\\right) = -\\frac{25}{12}\n$$\n所以这些系数是：\n$c_{0} = -\\frac{25}{12}$，$c_{1} = 4$，$c_{2} = -3$，$c_{3} = \\frac{4}{3}$，$c_{4} = -\\frac{1}{4}$。\n\n下一步是确定代数精度阶 $p$。截断误差由泰勒级数展开中的第一个非零项给出。这对应于 $k=5$ 的项：\n$$\n\\text{截断误差} = \\frac{(\\Delta x)^{5-1}}{5!} f^{(5)}(x_{0}) \\left( \\sum_{m=0}^{4} c_{m}m^{5} \\right) + \\mathcal{O}((\\Delta x)^5)\n$$\n$$\n\\text{截断误差} = \\frac{(\\Delta x)^{4}}{120} f^{(5)}(x_{0}) \\left( 0^{5}c_{0} + 1^{5}c_{1} + 2^{5}c_{2} + 3^{5}c_{3} + 4^{5}c_{4} \\right) + \\mathcal{O}((\\Delta x)^5)\n$$\n我们必须计算这个和以确保它不为零：\n$$\n\\sum_{m=0}^{4} c_{m}m^{5} = c_{1} + 32c_{2} + 243c_{3} + 1024c_{4} = 4 + 32(-3) + 243\\left(\\frac{4}{3}\\right) + 1024\\left(-\\frac{1}{4}\\right)\n$$\n$$\n= 4 - 96 + 81 \\times 4 - 256 = 4 - 96 + 324 - 256 = 328 - 352 = -24\n$$\n由于这个和不为零，截断误差的首项为：\n$$\n\\text{截断误差} = \\frac{(\\Delta x)^{4}}{120} (-24) f^{(5)}(x_{0}) + \\mathcal{O}((\\Delta x)^5) = -\\frac{1}{5}(\\Delta x)^{4} f^{(5)}(x_{0}) + \\mathcal{O}((\\Delta x)^5)\n$$\n误差与 $(\\Delta x)^{4}$ 成正比。因此，精度阶为 $p=4$。\n\n最终结果是系数 $c_{0}, c_{1}, c_{2}, c_{3}, c_{4}$ 和阶数 $p$，全部以精确有理数形式表示。\n$c_{0} = -\\frac{25}{12}$，$c_{1} = 4$，$c_{2} = -3$，$c_{3} = \\frac{4}{3}$，$c_{4} = -\\frac{1}{4}$，$p=4$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-\\frac{25}{12}  4  -3  \\frac{4}{3}  -\\frac{1}{4}  4\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "数值格式的收敛性不仅取决于其截断误差（一致性），还取决于其稳定性。Lax等价定理指出，对于线性问题，一致性和稳定性是保证收敛的充要条件。本练习将通过一个经典的计算实验 ()，让你亲手验证一个虽然一致但无条件不稳定的格式（用于平流方程的前向时间中心空间格式）是如何在计算中产生灾难性增长的，从而深刻理解稳定性在数值模拟中的核心地位。",
            "id": "3792747",
            "problem": "考虑一维线性平流偏微分方程 (PDE) $u_t + c\\,u_x = 0$，其定义在周期性域 $x \\in [0,L]$ 上，其中 $c$ 是一个恒定的平流速度。我们将要检验的数值方法是应用于此 PDE 的前向时间中心空间 (FTCS) 有限差分格式。目标是构建一个数值算例，以证明一个相容但不稳定的格式在空间网格加密时可能无法收敛到 PDE 的精确解，并使用误差范数来量化当 $\\Delta x \\to 0$ 时的发散情况。所有变量都是无量纲的，因此不需要物理单位。\n\n您必须实现具有周期性边界条件的 FTCS 格式，使用空间步长 $\\Delta x = L/N$、时间步长 $\\Delta t = \\lambda\\,\\Delta x/c$ 和 Courant–Friedrichs–Lewy (CFL) 数 $\\lambda = c\\,\\Delta t/\\Delta x$。使用 $L=1$、$c=1$ 和最终时间 $T=1$。FTCS 更新是为网格点 $x_j = j\\,\\Delta x$（其中 $j=0,\\dots,N-1$）和时间层 $t^n = n\\,\\Delta t$（其中 $n=0,\\dots,N_t$）计算的，其中 $N_t = T/\\Delta t$ 的选择应使 $N_t$ 为整数。\n\n构建一个依赖于网格的初始条件，该条件会激发一个相对于网格的高频傅里叶模式：对于测试套件中的每个 $N$，设置 $m = N/4$ 并定义离散初始条件 $u_j^0 = \\sin\\!\\big(2\\pi\\, m\\, x_j / L\\big)$。这一选择意味着波长为 $4\\,\\Delta x$，它在不同细化程度的网格上都是奈奎斯特极限的固定分数，并且是专门为激发 FTCS 格式的不稳定性而设计的。在时间 $T$ 时，具有周期性边界条件的 PDE 精确解为 $u_{\\text{exact}}(x_j,T) = \\sin\\!\\left(2\\pi\\, m\\, (x_j - c\\,T)/L\\right)$。当 $L=1$、$c=1$ 和 $T=1$ 时，此解简化为 $u_{\\text{exact}}(x_j,T) = \\sin\\!\\left(2\\pi\\, m\\, x_j/L\\right)$，因为移动一个域长度会使波在周期性区间上返回其原始相位。\n\n计算在时间 $T$ 时的数值 FTCS 解 $u_j^{N_t}$，并使用以下范数量化其与精确解之间的误差：\n- 离散 $L^2$ 误差范数，定义为 $\\|e\\|_2 = \\sqrt{\\Delta x \\sum_{j=0}^{N-1} \\left(u_j^{N_t} - u_{\\text{exact}}(x_j,T)\\right)^2}$。\n- 离散 $L^\\infty$ 误差范数，定义为 $\\|e\\|_\\infty = \\max_{0 \\le j \\le N-1} \\left|u_j^{N_t} - u_{\\text{exact}}(x_j,T)\\right|$。\n\n使用固定的 Courant–Friedrichs–Lewy (CFL) 数 $\\lambda = 0.01$。时间步长为 $\\Delta t = \\lambda\\,\\Delta x/c$，且 $N_t = T/\\Delta t$ 必须是一个确切的整数，以确保达到最终时间。\n\n测试套件：\n- 情况 1：$N=64$， $m=N/4=16$。\n- 情况 2：$N=128$， $m=N/4=32$。\n- 情况 3：$N=256$， $m=N/4=64$。\n- 情况 4：$N=400$， $m=N/4=100$。\n\n您的程序必须为每个测试用例计算在时间 $T$ 时的 $L^2$ 和 $L^\\infty$ 误差范数。为了量化当 $\\Delta x \\to 0$ 时的发散情况，还需计算两个布尔值，分别指示 $L^2$ 误差序列在有序的测试用例中是否非递减，以及 $L^\\infty$ 误差序列在有序的测试用例中是否非递减。非递减意味着从粗网格到细网格时，每个误差小于或等于下一个误差。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。格式为 $[E_2,E_\\infty, B]$，其中 $E_2$ 是测试套件的 $L^2$ 误差列表，$E_\\infty$ 是测试套件的 $L^\\infty$ 误差列表，$B$ 是包含上述两个布尔值的列表。输出中的所有浮点数必须四舍五入到六位小数。例如，输出应类似于 $[[e_{2,1},e_{2,2},e_{2,3},e_{2,4}],[e_{\\infty,1},e_{\\infty,2},e_{\\infty,3},e_{\\infty,4}],[b_1,b_2]]$。",
            "solution": "该问题要求通过一个数值算例来证明一个相容但不稳定的有限差分格式在网格加密时，其数值解会无法收敛到偏微分方程 (PDE) 的真实解。具体来说，我们将分析应用于一维线性平流方程的前向时间中心空间 (FTCS) 格式。\n\n控制偏微分方程是线性平流方程：\n$$\n\\frac{\\partial u}{\\partial t} + c \\frac{\\partial u}{\\partial x} = 0\n$$\n其中 $u(x,t)$ 是被输运的量，$c$ 是恒定的平流速度，$t$ 是时间，$x$ 是空间坐标。域 $x \\in [0, L]$ 是周期性的。\n\nFTCS 格式在具有空间步长 $\\Delta x = L/N$ 和时间步长 $\\Delta t$ 的网格上离散化此 PDE。网格点为 $x_j = j\\,\\Delta x$，时间层为 $t^n = n\\,\\Delta t$。偏导数通过有限差分来近似：\n- 时间上的前向差分（在 $x_j, t^n$ 处）：$u_t \\approx \\frac{u_j^{n+1} - u_j^n}{\\Delta t}$\n- 空间上的中心差分（在 $x_j, t^n$ 处）：$u_x \\approx \\frac{u_{j+1}^n - u_{j-1}^n}{2\\Delta x}$\n\n将这些近似代入 PDE 中得到：\n$$\n\\frac{u_j^{n+1} - u_j^n}{\\Delta t} + c \\left( \\frac{u_{j+1}^n - u_{j-1}^n}{2\\Delta x} \\right) = 0\n$$\n整理以求解下一个时间步的解 $u_j^{n+1}$，得到 FTCS 更新规则：\n$$\nu_j^{n+1} = u_j^n - \\frac{c \\Delta t}{2 \\Delta x} \\left( u_{j+1}^n - u_{j-1}^n \\right)\n$$\n引入 Courant–Friedrichs–Lewy (CFL) 数 $\\lambda = c\\,\\Delta t / \\Delta x$，该格式可写为：\n$$\nu_j^{n+1} = u_j^n - \\frac{\\lambda}{2} \\left( u_{j+1}^n - u_{j-1}^n \\right)\n$$\nFTCS 格式与 PDE 是相容的，其截断误差为 $O(\\Delta t, (\\Delta x)^2)$ 阶。然而，仅有相容性不足以保证收敛。Lax 等价定理指出，对于一个相容的线性格式，稳定性是其收敛的充分必要条件。\n\n为了评估 FTCS 格式的稳定性，我们进行 von Neumann 稳定性分析。我们考虑解的单个傅里叶模式的演化，$u_j^n = G(k)^n e^{i k x_j}$，其中 $k$ 是波数，$G(k)$ 是每时间步的放大因子。将此代入 FTCS 更新规则：\n$$\nG(k)^{n+1} e^{i k x_j} = G(k)^n e^{i k x_j} - \\frac{\\lambda}{2} \\left( G(k)^n e^{i k x_{j+1}} - G(k)^n e^{i k x_{j-1}} \\right)\n$$\n两边同除以 $G(k)^n e^{i k x_j}$：\n$$\nG(k) = 1 - \\frac{\\lambda}{2} \\left( e^{i k \\Delta x} - e^{-i k \\Delta x} \\right)\n$$\n使用欧拉公式 $e^{i\\theta} - e^{-i\\theta} = 2i\\sin(\\theta)$，我们得到：\n$$\nG(k) = 1 - i \\lambda \\sin(k \\Delta x)\n$$\n为使格式稳定，放大因子的模必须对所有波数 $k$ 满足 $|G(k)| \\le 1$。$G(k)$ 的模为：\n$$\n|G(k)| = \\sqrt{1^2 + (-\\lambda \\sin(k \\Delta x))^2} = \\sqrt{1 + \\lambda^2 \\sin^2(k \\Delta x)}\n$$\n对于任何非零的 $\\lambda$ 和任何使得 $\\sin(k \\Delta x) \\neq 0$ 的 $k$，项 $\\lambda^2 \\sin^2(k \\Delta x)$ 都是正的。因此， $|G(k)| > 1$。这意味着数值解的傅里叶模式将在每个时间步被放大，导致指数级增长和无条件不稳定，无论 $\\lambda$ 的值如何。\n\n这个问题旨在演示这种不稳定性。初始条件被选为相对于网格的高频模式：$u_j^0 = \\sin(2\\pi m x_j/L)$，其中 $m = N/4$。该模式的无量纲波数为 $k \\Delta x = (2\\pi m/L) \\Delta x = (2\\pi (N/4)/L)(L/N) = \\pi/2$。对于这个在每次网格加密时都重新引入的特定模式，其放大因子是恒定的：\n$$\n|G| = \\sqrt{1 + \\lambda^2 \\sin^2(\\pi/2)} = \\sqrt{1 + \\lambda^2}\n$$\n给定 $\\lambda=0.01$，则 $|G| = \\sqrt{1.0001} \\approx 1.00005$。虽然单个时间步的放大很小，但它会在 $N_t$ 步中累积。时间步数是 $N_t = T/\\Delta t = T / (\\lambda \\Delta x / c) = (cT)/(\\lambda L) \\cdot N$。由于 $c=1$，$T=1$，$L=1$，且 $\\lambda=0.01$，我们有 $N_t = 100N$。随着 $N$ 增加（即 $\\Delta x \\to 0$），$N_t$ 也随之增加。在整个模拟时间 $T$ 内，初始模式振幅的总放大为 $|G|^{N_t} = (\\sqrt{1+\\lambda^2})^{100N}$。这个量随 $N$ 指数增长。因此，数值解与精确解之间的误差预计会增长，从而证明了发散。\n\n对于初始条件 $u(x,0) = \\sin(2\\pi m x/L)$，其精确解为 $u(x,t) = \\sin(2\\pi m (x-ct)/L)$。在最终时间 $T=1$，且 $c=1$、$L=1$ 时，解为 $u(x_j,1) = \\sin(2\\pi m(x_j-1))$。相移为 $2\\pi m = 2\\pi(N/4) = N\\pi/2$。由于在所有测试用例中 $N$ 都是 4 的倍数，$N/2$ 是一个偶数，因此相移是 $2\\pi$ 的整数倍。于是，$\\sin(2\\pi m(x_j-1)) = \\sin(2\\pi m x_j - N\\pi/2) = \\sin(2\\pi m x_j)$。在时间 $T$ 时的精确解与初始条件相同。\n\n计算流程如下：\n1. 遍历测试套件中指定的每个 $N$ 值。\n2. 对每个 $N$，设置网格 $x_j$，计算 $\\Delta x, \\Delta t, N_t$，并定义初始条件数组 $u^0$ 和精确解数组 $u_{\\text{exact}}$。\n3. 使用初始条件 $u^0$ 初始化数值解数组 $u$。\n4. 循环 $N_t$ 个时间步，在每一步中使用向量化的 FTCS 规则更新 $u$：$u_{\\text{new}} = u_{\\text{old}} - (\\lambda/2) (\\text{roll}(u_{\\text{old}},-1) - \\text{roll}(u_{\\text{old}},1))$，其中 $\\text{roll}$ 实现周期性边界条件。\n5. 时间步进循环结束后，计算误差向量 $e_j = u_j^{N_t} - u_{\\text{exact}}(x_j, T)$。\n6. 计算离散 $L^2$ 误差范数 $\\|e\\|_2 = \\sqrt{\\Delta x \\sum e_j^2}$ 和 $L^\\infty$ 误差范数 $\\|e\\|_\\infty = \\max_j |e_j|$。\n7. 在计算完所有 $N$ 的误差后，检查 $L^2$ 误差序列和 $L^\\infty$ 误差序列是否非递减。\n8. 将收集到的误差范数和布尔标志格式化为指定的输出字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the numerical solution of the 1D linear advection equation\n    using the unstable FTCS scheme to demonstrate divergence.\n    \"\"\"\n    \n    # Problem constants\n    L = 1.0\n    c = 1.0\n    T = 1.0\n    lam = 0.01  # CFL number lambda\n\n    # Test suite\n    test_cases = [64, 128, 256, 400]\n\n    l2_errors = []\n    linf_errors = []\n\n    for N in test_cases:\n        # Discretization parameters\n        m = N // 4\n        dx = L / N\n        # dt must be calculated to ensure Nt is an integer\n        # Nt = T / dt => dt = T / Nt\n        # We also need dt = lam * dx / c\n        # So Nt = T / (lam * dx / c) = (T * c) / (lam * L / N) = (T*c*N)/(lam*L)\n        Nt = int((T * c * N) / (lam * L))\n        # Ensure Nt is exactly integer, which it is for these parameters\n        # Nt = (1*1*N)/(0.01*1) = 100*N\n        \n        # Spatial grid (periodic, so endpoint is not included)\n        x = np.linspace(0, L, N, endpoint=False)\n\n        # Initial condition\n        u_initial = np.sin(2 * np.pi * m * x / L)\n        \n        # The exact solution at time T=1.\n        # For the given parameters, u_exact(x, T) is the same as u_initial(x).\n        # u_exact(x,T) = sin(2*pi*m*(x-c*T)/L)\n        # Phase shift: 2*pi*m*c*T/L = 2*pi*(N/4)*1*1/1 = N*pi/2\n        # Since N is a multiple of 4, N/2 is an even integer.\n        # N*pi/2 is an integer multiple of 2*pi.\n        # So sin(A - N*pi/2) = sin(A).\n        u_exact_T = u_initial.copy()\n\n        # Initialize numerical solution\n        u = u_initial.copy()\n        \n        # Time-stepping loop\n        for n in range(Nt):\n            # Apply the FTCS update rule with periodic boundary conditions\n            # u_j^{n+1} = u_j^n - (lambda/2) * (u_{j+1}^n - u_{j-1}^n)\n            # np.roll(u, -1) gives u_{j+1} and np.roll(u, 1) gives u_{j-1}\n            u = u - 0.5 * lam * (np.roll(u, -1) - np.roll(u, 1))\n\n        # Compute error vector at final time T\n        error_vec = u - u_exact_T\n\n        # Compute L2 error norm\n        l2_error = np.sqrt(dx * np.sum(error_vec**2))\n        l2_errors.append(l2_error)\n\n        # Compute L-infinity error norm\n        linf_error = np.max(np.abs(error_vec))\n        linf_errors.append(linf_error)\n\n    # Check for nondecreasing error sequences\n    is_nondecreasing_l2 = all(l2_errors[i] = l2_errors[i+1] for i in range(len(l2_errors) - 1))\n    is_nondecreasing_linf = all(linf_errors[i] = linf_errors[i+1] for i in range(len(linf_errors) - 1))\n    \n    bool_checks = [is_nondecreasing_l2, is_nondecreasing_linf]\n\n    # Format the output as specified\n    l2_errors_str = f\"[{','.join(f'{e:.6f}' for e in l2_errors)}]\"\n    linf_errors_str = f\"[{','.join(f'{e:.6f}' for e in linf_errors)}]\"\n    bool_checks_str = f\"[{','.join(str(b).lower() for b in bool_checks)}]\"\n    \n    # Final print statement in the exact required format\n    print(f\"[{l2_errors_str},{linf_errors_str},{bool_checks_str}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在进行如海洋环流这样的长期流体动力学模拟时，数值格式能否保持物理系统的基本守恒定律（如能量守恒）至关重要。对于非线性平流项 $u u_x$，一个朴素的离散化方法可能在离散层面引入虚假的能量增长或耗散，导致模拟结果失真。本练习旨在揭示这一问题，并引导你通过构造一个代数上满足能量守恒的“斜对称”格式 ()，掌握设计稳健的非线性格式的关键技巧。",
            "id": "3792775",
            "problem": "考虑一个标量速度场 $u(x,t)$ 沿着长度为 $L$ 的理想化周期性海洋通道的一维无粘性平流，其由连续方程 $u_t + u\\,u_x = 0$ 描述。设一个具有 $N$ 个点且间距为 $h = L/N$ 的均匀网格来近似该通道，其周期性索引为 $j \\in \\{0,1,\\dots,N-1\\}$，且在 $x_j = j h$ 处有 $u_j(t) \\approx u(x_j,t)$。定义中心有限差分算子 $D_0$ 为 $D_0 u_j = \\frac{u_{j+1} - u_{j-1}}{2 h}$，离散能量为\n$$\nE(t) = \\frac{h}{2} \\sum_{j=0}^{N-1} u_j(t)^2.\n$$\n假设为周期性边界条件，因此索引运算以 $N$ 为模。考虑半离散常微分方程 $u_t + \\mathcal{N}(u) = 0$，其中 $\\mathcal{N}(u)$ 是对 $u\\,u_x$ 的空间有限差分近似。\n\n从第一性原理出发，包括中心差分算子的性质和离散内积，完成以下任务：\n\n1. 使用朴素乘积形式的离散化 $\\mathcal{N}_{\\text{naive}}(u)_j = u_j \\, D_0 u_j$，推导离散能量趋势 $\\frac{\\mathrm{d}E}{\\mathrm{d}t}$ 的解析表达式（以离散和的形式），并明确论证在周期性边界条件下，为何对于任意 $u_j$，该表达式通常不为零。\n\n2. 提出一种形式为\n$$\n\\mathcal{N}_{\\text{skew}}(u)_j = \\alpha\\, u_j\\, D_0 u_j + \\beta\\, D_0\\!\\big(u_j^2\\big)\n$$\n的反对称分裂形式的 $\\mathcal{N}(u)$ 离散化，其中常数 $\\alpha$ 和 $\\beta$ 的选择要使近似与 $u\\,u_x$ 相容，并且在周期性边界条件下离散能量趋势为零。从第一性原理推导 $\\alpha$ 和 $\\beta$ 所需满足的条件，并构造出 $\\alpha$ 和 $\\beta$ 的具体值。\n\n3. 使用你所选择的反对称形式的 $\\alpha$ 和 $\\beta$，计算在周期性边界条件下离散能量趋势 $\\frac{\\mathrm{d}E}{\\mathrmd t}$ 的精确闭式值。\n\n你的最终答案必须是代表该反对称离散化下 $\\frac{\\mathrm{d}E}{\\mathrm{d}t}$ 值的单个实数。无需四舍五入，也无需物理单位。",
            "solution": "该问题要求分析两种有限差分格式对于一维无粘性平流方程 $u_t + u u_x = 0$ 的离散能量守恒性质。我们将从第一性原理出发，依次解决问题的三个部分。\n\n离散能量定义为\n$$\nE(t) = \\frac{h}{2} \\sum_{j=0}^{N-1} u_j(t)^2.\n$$\n其时间变化率，即能量趋势，可以通过对时间 $t$ 求导得到。应用链式法则，我们有\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}t} = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\left( \\frac{h}{2} \\sum_{j=0}^{N-1} u_j^2 \\right) = \\frac{h}{2} \\sum_{j=0}^{N-1} 2 u_j \\frac{\\mathrm{d}u_j}{\\mathrm{d}t} = h \\sum_{j=0}^{N-1} u_j \\frac{\\mathrm{d}u_j}{\\mathrm{d}t}.\n$$\n给定的半离散常微分方程为 $\\frac{\\mathrm{d}u_j}{\\mathrm{d}t} = - \\mathcal{N}(u)_j$。将此代入能量趋势的表达式，得到\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}t} = -h \\sum_{j=0}^{N-1} u_j \\mathcal{N}(u)_j.\n$$\n此表达式构成了我们分析的基础。\n\n第1部分：对朴素离散化 $\\mathcal{N}_{\\text{naive}}(u)_j = u_j D_0 u_j$ 的分析。\n\n对于此格式，能量趋势为\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}t} = -h \\sum_{j=0}^{N-1} u_j (u_j D_0 u_j) = -h \\sum_{j=0}^{N-1} u_j^2 D_0 u_j.\n$$\n代入中心差分算子的定义 $D_0 u_j = \\frac{u_{j+1} - u_{j-1}}{2h}$，我们得到\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}t} = -h \\sum_{j=0}^{N-1} u_j^2 \\left( \\frac{u_{j+1} - u_{j-1}}{2h} \\right) = -\\frac{1}{2} \\sum_{j=0}^{N-1} u_j^2 (u_{j+1} - u_{j-1}).\n$$\n这就是离散能量趋势的解析表达式。为了证明它在一般情况下不为零，我们可以对求和进行变换。我们将求和分成两部分：\n$$\n\\sum_{j=0}^{N-1} u_j^2 (u_{j+1} - u_{j-1}) = \\sum_{j=0}^{N-1} u_j^2 u_{j+1} - \\sum_{j=0}^{N-1} u_j^2 u_{j-1}.\n$$\n我们对第二个求和进行指标变换。令 $k = j-1$，则 $j = k+1$。由于指标以 $N$ 为模是周期性的，对 $j \\in \\{0, \\dots, N-1\\}$ 的求和等价于对 $k \\in \\{0, \\dots, N-1\\}$ 的求和。将哑指标 $k$ 替换为 $j$，第二个和变为 $\\sum_{j=0}^{N-1} u_{j+1}^2 u_j$。\n因此，总和为\n$$\n\\sum_{j=0}^{N-1} u_j^2 u_{j+1} - \\sum_{j=0}^{N-1} u_{j+1}^2 u_j = \\sum_{j=0}^{N-1} (u_j^2 u_{j+1} - u_j u_{j+1}^2) = \\sum_{j=0}^{N-1} u_j u_{j+1} (u_j - u_{j+1}).\n$$\n所以能量趋势为\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}t} = -\\frac{1}{2} \\sum_{j=0}^{N-1} u_j u_{j+1} (u_j - u_{j+1}).\n$$\n对于任意场 $u_j$，这个和不恒为零。例如，考虑一个简单情况，$N=3$ 且 $u = (u_0, u_1, u_2) = (1, 2, 3)$。求和变为\n$u_0 u_1 (u_0 - u_1) + u_1 u_2 (u_1 - u_2) + u_2 u_0 (u_2 - u_0) = (1)(2)(1-2) + (2)(3)(2-3) + (3)(1)(3-1) = -2 - 6 + 6 = -2$。\n在这种情况下，$\\frac{\\mathrm{d}E}{\\mathrm{d}t} = -\\frac{1}{2}(-2) = 1 \\neq 0$。因此，朴素离散化在一般情况下不守恒离散能量。\n\n第2部分：反对称离散化的推导。\n\n给定形式为 $\\mathcal{N}_{\\text{skew}}(u)_j = \\alpha\\, u_j\\, D_0 u_j + \\beta\\, D_0\\!\\big(u_j^2\\big)$。我们必须找到常数 $\\alpha$ 和 $\\beta$ 以满足两个条件：相容性和能量守恒。\n\n条件1：相容性。离散算子必须是连续项 $u u_x$ 的一个相容近似。我们使用围绕 $x_j$ 的泰勒展开来分析 $\\mathcal{N}_{\\text{skew}}$ 中的每一项。\n第一项给出：$u_j D_0 u_j = u(x_j) \\frac{u(x_j+h)-u(x_j-h)}{2h} = u(x_j) [u_x(x_j) + O(h^2)] = u u_x + O(h^2)$。\n第二项给出：$D_0(u_j^2) = \\frac{u(x_j+h)^2 - u(x_j-h)^2}{2h}$。这是函数 $f(u) = u^2$ 的中心差分，它近似于 $\\frac{d}{dx}(u^2)$。因此，$D_0(u_j^2) = \\frac{d}{dx}(u^2) + O(h^2) = 2 u u_x + O(h^2)$。\n综合这些，该离散化近似为：\n$$\n\\mathcal{N}_{\\text{skew}}(u)_j \\approx \\alpha (u u_x) + \\beta (2 u u_x) = (\\alpha + 2\\beta) u u_x.\n$$\n为与 $u u_x$ 相容，我们必须有 $\\alpha + 2\\beta = 1$。\n\n条件2：能量守恒。该格式必须守恒离散能量，即 $\\frac{\\mathrm{d}E}{\\mathrm{d}t} = 0$。这要求和 $\\sum_{j=0}^{N-1} u_j \\mathcal{N}_{\\text{skew}}(u)_j$ 为零。\n$$\n\\sum_{j=0}^{N-1} u_j \\mathcal{N}_{\\text{skew}}(u)_j = \\sum_{j=0}^{N-1} u_j \\left[ \\alpha u_j D_0 u_j + \\beta D_0(u_j^2) \\right] = \\alpha \\sum_{j=0}^{N-1} u_j^2 D_0 u_j + \\beta \\sum_{j=0}^{N-1} u_j D_0(u_j^2).\n$$\n为了计算这个式子，我们使用周期性边界条件下中心差分算子的分部求和性质。对于任意两个周期网格函数 $f_j$ 和 $g_j$，我们有：\n$$\n\\sum_{j=0}^{N-1} f_j D_0 g_j = \\sum_{j=0}^{N-1} f_j \\left( \\frac{g_{j+1} - g_{j-1}}{2h} \\right) = \\frac{1}{2h} \\left( \\sum_{j=0}^{N-1} f_j g_{j+1} - \\sum_{j=0}^{N-1} f_j g_{j-1} \\right).\n$$\n对求和重新索引（例如，在第一个和中使用 $k=j+1$，在第二个和中使用 $k=j-1$，并利用周期性）得到：\n$$\n\\frac{1}{2h} \\left( \\sum_{k=0}^{N-1} f_{k-1} g_k - \\sum_{k=0}^{N-1} f_{k+1} g_k \\right) = \\sum_{k=0}^{N-1} g_k \\left( \\frac{f_{k-1} - f_{k+1}}{2h} \\right) = -\\sum_{k=0}^{N-1} g_k D_0 f_k.\n$$\n这表明对于标准离散内积，$D_0$ 是反自伴的。\n将此性质应用于我们求和的第二项，其中 $f_j = u_j$ 和 $g_j = u_j^2$：\n$$\n\\sum_{j=0}^{N-1} u_j D_0(u_j^2) = - \\sum_{j=0}^{N-1} u_j^2 D_0 u_j.\n$$\n将此代回求和的表达式中：\n$$\n\\alpha \\sum_{j=0}^{N-1} u_j^2 D_0 u_j - \\beta \\sum_{j=0}^{N-1} u_j^2 D_0 u_j = (\\alpha - \\beta) \\sum_{j=0}^{N-1} u_j^2 D_0 u_j.\n$$\n如第1部分所示，对于任意 $u_j$，和 $\\sum_j u_j^2 D_0 u_j$ 不恒为零。因此，要使整个表达式对于任何 $u_j$ 都为零，其系数必须为零。这给出了我们的第二个条件：$\\alpha - \\beta = 0$，即 $\\alpha = \\beta$。\n\n求解 $\\alpha$ 和 $\\beta$：我们有一个二元线性方程组：\n1) $\\alpha + 2\\beta = 1$\n2) $\\alpha = \\beta$\n将 (2) 代入 (1) 得到 $\\beta + 2\\beta = 1$，即 $3\\beta = 1$，所以 $\\beta = \\frac{1}{3}$。由 (2) 可得 $\\alpha = \\frac{1}{3}$。\n具体值为 $\\alpha = 1/3$ 和 $\\beta = 1/3$。\n\n第3部分：反对称格式的能量趋势计算。\n\n使用推导出的值 $\\alpha = 1/3$ 和 $\\beta = 1/3$，能量趋势由下式给出：\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}t} = -h \\sum_{j=0}^{N-1} u_j \\mathcal{N}_{\\text{skew}}(u)_j = -h \\sum_{j=0}^{N-1} u_j \\left[ \\frac{1}{3} u_j D_0 u_j + \\frac{1}{3} D_0(u_j^2) \\right].\n$$\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}t} = -\\frac{h}{3} \\left[ \\sum_{j=0}^{N-1} u_j^2 D_0 u_j + \\sum_{j=0}^{N-1} u_j D_0(u_j^2) \\right].\n$$\n如第2部分从 $D_0$ 的反自伴性质所证，我们有 $\\sum_{j} u_j D_0(u_j^2) = - \\sum_{j} u_j^2 D_0(u_j)$。将此代入能量趋势的表达式：\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}t} = -\\frac{h}{3} \\left[ \\sum_{j=0}^{N-1} u_j^2 D_0 u_j - \\sum_{j=0}^{N-1} u_j^2 D_0 u_j \\right].\n$$\n方括号内的两个和完全相互抵消：\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}t} = -\\frac{h}{3} \\left[ 0 \\right] = 0.\n$$\n根据构造，反对称离散化的离散能量趋势的精确闭式值恰好为零。这表明该格式守恒离散能量 $E(t)$。",
            "answer": "$$\n\\boxed{0}\n$$"
        }
    ]
}