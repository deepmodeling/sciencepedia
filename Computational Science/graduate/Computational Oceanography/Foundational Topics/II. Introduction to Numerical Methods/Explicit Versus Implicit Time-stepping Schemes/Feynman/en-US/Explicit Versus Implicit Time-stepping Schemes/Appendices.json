{
    "hands_on_practices": [
        {
            "introduction": "The Courant-Friedrichs-Lewy (CFL) condition is a fundamental principle governing the stability of explicit time-stepping schemes. This exercise  demonstrates how to apply this principle in a realistic scenario where multiple physical processes, advection and gravity waves, coexist. By calculating the maximum allowable time step for each process, you will develop the critical skill of identifying the \"binding constraint\"—the fastest process that ultimately limits the model's overall explicit time step.",
            "id": "3792437",
            "problem": "Consider a one-dimensional barotropic coastal channel model used in computational oceanography with uniform grid spacing $\\Delta x$ along the $x$-direction. Two hyperbolic processes govern the fastest signal propagation that must be resolved by an explicit time-stepping scheme: (i) advection of a passive scalar by a uniform mean flow of speed $u$, and (ii) propagation of linearized barotropic gravity waves with phase speed $c$ associated with the shallow-water momentum–continuity coupling. Assume the advection of a passive scalar satisfies the conservation law $\\partial q/\\partial t + u\\,\\partial q/\\partial x = 0$, and the barotropic gravity waves arise from the linear shallow-water system, $\\partial u/\\partial t = -g\\,\\partial \\eta/\\partial x$ and $\\partial \\eta/\\partial t = -H\\,\\partial u/\\partial x$, yielding a characteristic wave speed $c = \\sqrt{gH}$. The model employs an explicit first-order upwind spatial discretization for advection combined with a single-step explicit time update, and an explicit forward–backward coupling for the linearized shallow-water momentum–continuity system. \n\nUsing first principles about the domain of dependence for hyperbolic partial differential equations and stability of explicit schemes, derive the respective stability requirements that constrain the time step $\\Delta t$ from advection and from gravity waves. Then, using the given parameters $u = 1\\,\\mathrm{m/s}$, $c = 50\\,\\mathrm{m/s}$, and $\\Delta x = 10\\,\\mathrm{km}$, compute the numerical values of the maximum allowable explicit time step from each constraint and determine the single maximum explicit time step that satisfies both constraints. Identify which physical process is the binding constraint. Express your final answer in seconds, and round your final result to four significant figures.",
            "solution": "The model dynamics are governed by two hyperbolic processes with distinct characteristic speeds and numerical stability constraints when advanced explicitly in time. For explicit schemes, stability is governed by the Courant–Friedrichs–Lewy (CFL) condition, which states that the numerical domain of dependence must contain the physical domain of dependence. For a one-dimensional uniform grid with spacing $\\Delta x$ and explicit time step $\\Delta t$, this requires that the fastest signals traveling at speed $v$ do not traverse more than one grid interval within one time step, leading to a constraint of the form $v\\,\\Delta t \\leq \\Delta x$ for each characteristic speed $v$ relevant to the discretized system.\n\nAdvection constraint. Consider the linear advection equation $\\partial q/\\partial t + u\\,\\partial q/\\partial x = 0$ with a constant velocity $u$. Using a first-order upwind spatial discretization with a single-step explicit time update, the amplification factor obtained by Von Neumann (normal-mode) stability analysis is\n$$\nG(k) \\;=\\; 1 \\;-\\; \\lambda\\left(1 - \\exp(-\\mathrm{i}k\\,\\Delta x)\\right),\n$$\nwhere $k$ is the wavenumber and $\\lambda = \\dfrac{u\\,\\Delta t}{\\Delta x}$ is the Courant number. Stability requires $|G(k)| \\leq 1$ for all $k$, which for the upwind scheme reduces to\n$$\n0 \\;\\leq\\; \\lambda \\;\\leq\\; 1.\n$$\nThus the advection constraint is\n$$\n\\Delta t \\;\\leq\\; \\frac{\\Delta x}{|u|}.\n$$\n\nGravity-wave constraint. The linearized shallow-water equations\n$$\n\\frac{\\partial u}{\\partial t} \\;=\\; -\\,g\\,\\frac{\\partial \\eta}{\\partial x}, \n\\qquad\n\\frac{\\partial \\eta}{\\partial t} \\;=\\; -\\,H\\,\\frac{\\partial u}{\\partial x},\n$$\nsupport barotropic gravity waves with phase speed $c = \\sqrt{gH}$ and characteristics $x \\pm c\\,t = \\text{constant}$. For an explicit forward–backward coupling of momentum and continuity, Von Neumann stability analysis yields a CFL condition requiring that the wave must not travel more than one grid cell per time step, namely\n$$\n\\Delta t \\;\\leq\\; \\frac{\\Delta x}{c}.\n$$\nThis is consistent with the domain-of-dependence argument for hyperbolic waves.\n\nCombined constraint. The explicit time step must satisfy both limits simultaneously:\n$$\n\\Delta t_{\\max} \\;=\\; \\min\\!\\left(\\frac{\\Delta x}{|u|},\\,\\frac{\\Delta x}{c}\\right).\n$$\n\nNumerical evaluation. The given parameters are $u = 1\\,\\mathrm{m/s}$, $c = 50\\,\\mathrm{m/s}$, and $\\Delta x = 10\\,\\mathrm{km} = 1.0 \\times 10^{4}\\,\\mathrm{m}$. Compute each constraint:\n- Advection limit:\n$$\n\\Delta t_{\\text{adv}} \\;=\\; \\frac{\\Delta x}{|u|} \\;=\\; \\frac{1.0 \\times 10^{4}\\,\\mathrm{m}}{1\\,\\mathrm{m/s}} \\;=\\; 1.0 \\times 10^{4}\\,\\mathrm{s}.\n$$\n- Gravity-wave limit:\n$$\n\\Delta t_{\\text{gw}} \\;=\\; \\frac{\\Delta x}{c} \\;=\\; \\frac{1.0 \\times 10^{4}\\,\\mathrm{m}}{50\\,\\mathrm{m/s}} \\;=\\; 2.0 \\times 10^{2}\\,\\mathrm{s}.\n$$\n\nTaking the minimum,\n$$\n\\Delta t_{\\max} \\;=\\; \\min\\!\\left(1.0 \\times 10^{4},\\,2.0 \\times 10^{2}\\right)\\,\\mathrm{s} \\;=\\; 2.0 \\times 10^{2}\\,\\mathrm{s}.\n$$\nRounded to four significant figures and expressed in seconds, the maximum explicit time step is $2.000 \\times 10^{2}\\,\\mathrm{s}$. The binding constraint is set by the barotropic gravity waves, since $c \\gg |u|$ makes $\\Delta x/c$ the smaller of the two limits.",
            "answer": "$$\\boxed{2.000 \\times 10^{2}}$$"
        },
        {
            "introduction": "While explicit methods are limited by wave propagation speeds, they face an even more severe restriction when modeling diffusive processes, where the time step often scales with the square of the grid spacing, $\\Delta t \\propto \\Delta z^2$. This hands-on problem  explores this \"stiffness\" by contrasting the stability of an explicit scheme against an unconditionally stable implicit scheme for vertical diffusion. This exercise moves beyond mere stability to the more nuanced concept of accuracy, challenging you to determine a practical implicit time step that resolves the physical process without introducing excessive numerical error.",
            "id": "3792451",
            "problem": "Consider the one-dimensional vertical diffusion of a passive tracer in the ocean governed by the partial differential equation $\\frac{\\partial C}{\\partial t}=\\frac{\\partial}{\\partial z}\\left(\\nu_{z}\\frac{\\partial C}{\\partial z}\\right)$, where $C(z,t)$ is the tracer concentration, $z$ is the vertical coordinate, $t$ is time, and $\\nu_{z}$ is the constant vertical diffusion coefficient. A uniform vertical grid with spacing $\\Delta z$ is used. Two time-stepping schemes are considered on this grid: (i) an explicit forward-in-time, centered-in-space scheme and (ii) an implicit backward-in-time, centered-in-space scheme.\n\nStarting from the given governing equation and using a Fourier-mode stability analysis, derive the stability constraint on the explicit scheme in terms of the nondimensional diffusive Courant–Friedrichs–Lewy (CFL) number $r=\\nu_{z}\\Delta t/\\Delta z^{2}$ and identify the largest stable explicit time step $\\Delta t_{\\mathrm{exp}}$ on this grid. Then, derive the amplification factor of the implicit scheme and show that it is unconditionally stable. To compare a practical implicit time-step choice against the explicit stability limit on a scientifically meaningful basis, impose an accuracy requirement for the implicit scheme: choose the largest implicit time step $\\Delta t_{\\mathrm{imp}}$ such that, for the grid-scale Fourier mode with wavenumber $k=\\pi/\\Delta z$, the one-step relative error between the implicit scheme’s amplification factor and the exact diffusive decay factor is no greater than $0.1$.\n\nCompute both $\\Delta t_{\\mathrm{exp}}$ and $\\Delta t_{\\mathrm{imp}}$ for $\\nu_{z}=10^{-2}\\,\\mathrm{m^{2}/s}$ and $\\Delta z=1\\,\\mathrm{m}$. Express both final answers in seconds. Round the implicit time step to four significant figures. The explicit time step does not require rounding.",
            "solution": "The problem requires analyzing the stability of explicit and implicit schemes for the 1D diffusion equation, and then determining a practical time step for the implicit scheme based on an accuracy criterion. The governing equation is $\\frac{\\partial C}{\\partial t} = \\nu_{z} \\frac{\\partial^2 C}{\\partial z^2}$.\n\n**Explicit Scheme: Forward-in-Time, Centered-in-Space (FTCS)**\n\nThe FTCS discretization of the diffusion equation is:\n$$\n\\frac{C_j^{n+1} - C_j^n}{\\Delta t} = \\nu_{z} \\frac{C_{j+1}^n - 2C_j^n + C_{j-1}^n}{\\Delta z^2}\n$$\nwhere $C_j^n$ is the concentration at grid point $j$ and time level $n$. Let $r = \\frac{\\nu_{z}\\Delta t}{\\Delta z^{2}}$ be the diffusive Courant number. A von Neumann stability analysis, which examines the amplification of a single Fourier mode $C_j^n = A^n e^{ikj\\Delta z}$, yields the amplification factor $A$:\n$$\nA = 1 - 4r \\sin^2\\left(\\frac{k\\Delta z}{2}\\right)\n$$\nFor the scheme to be stable, we must have $|A| \\le 1$ for all wavenumbers $k$. The most restrictive case occurs for the shortest resolvable wavelength on the grid ($k\\Delta z = \\pi$), where $\\sin^2(\\pi/2)=1$. The stability condition becomes $|1 - 4r| \\le 1$, which simplifies to $-1 \\le 1 - 4r$. This requires $4r \\le 2$, or:\n$$\nr \\le \\frac{1}{2}\n$$\nThe largest stable explicit time step $\\Delta t_{\\mathrm{exp}}$ is thus:\n$$\n\\Delta t_{\\mathrm{exp}} = \\frac{\\Delta z^{2}}{2\\nu_{z}}\n$$\n\n**Implicit Scheme: Backward-in-Time, Centered-in-Space (BTCS)**\n\nThe BTCS discretization evaluates the spatial derivative at the future time level $n+1$:\n$$\n\\frac{C_j^{n+1} - C_j^n}{\\Delta t} = \\nu_{z} \\frac{C_{j+1}^{n+1} - 2C_j^{n+1} + C_{j-1}^{n+1}}{\\Delta z^2}\n$$\nA similar stability analysis gives the amplification factor for the implicit scheme:\n$$\nA_{\\mathrm{imp}} = \\frac{1}{1 + 4r \\sin^2\\left(\\frac{k\\Delta z}{2}\\right)}\n$$\nSince $r > 0$, the denominator is always greater than or equal to 1. Therefore, $0  A_{\\mathrm{imp}} \\le 1$ for any time step $\\Delta t$. The scheme is unconditionally stable.\n\n**Accuracy-Limited Implicit Time Step**\n\nThe exact solution for a single Fourier mode decays with an amplification factor $A_{\\mathrm{exact}} = \\exp(-\\nu_z k^2 \\Delta t)$, which for the grid-scale mode $k=\\pi/\\Delta z$ is $A_{\\mathrm{exact}} = \\exp(-\\pi^2 r)$. For this same mode, the implicit scheme's amplification factor is $A_{\\mathrm{imp}} = \\frac{1}{1+4r}$. The accuracy requirement is that the relative error is no more than $0.1$:\n$$ \\left| \\frac{A_{\\mathrm{imp}} - A_{\\mathrm{exact}}}{A_{\\mathrm{exact}}} \\right| \\le 0.1 \\implies 0.9 \\le \\frac{A_{\\mathrm{imp}}}{A_{\\mathrm{exact}}} \\le 1.1 $$\nWe are interested in the largest time step (largest $r$), so we solve for the boundary of this constraint. The ratio is $\\frac{A_{\\mathrm{imp}}}{A_{\\mathrm{exact}}} = \\frac{\\exp(\\pi^2 r)}{1+4r}$. For $r>0$, this ratio is greater than 1, meaning the BTCS scheme is less dissipative than the true solution for this mode. We thus solve for the upper bound:\n$$ \\frac{\\exp(\\pi^2 r)}{1+4r} = 1.1 $$\nThis transcendental equation can be solved numerically, yielding $r_{\\mathrm{imp}} \\approx 0.015913$.\n\n**Numerical Calculation**\n\nGiven $\\nu_{z}=10^{-2}\\,\\mathrm{m^{2}/s}$ and $\\Delta z=1\\,\\mathrm{m}$:\n1.  **Maximum Explicit Time Step**:\n    $$\n    \\Delta t_{\\mathrm{exp}} = \\frac{(1\\,\\mathrm{m})^{2}}{2(10^{-2}\\,\\mathrm{m^{2}/s})} = \\frac{1}{0.02}\\,\\mathrm{s} = 50\\,\\mathrm{s}\n    $$\n2.  **Accuracy-Limited Implicit Time Step**:\n    $$\n    \\Delta t_{\\mathrm{imp}} = \\frac{r_{\\mathrm{imp}} \\Delta z^2}{\\nu_z} = \\frac{0.015913 \\times (1\\,\\mathrm{m})^2}{10^{-2}\\,\\mathrm{m^2/s}} \\approx 1.5913\\,\\mathrm{s}\n    $$\nRounding to four significant figures gives $\\Delta t_{\\mathrm{imp}} = 1.591\\,\\mathrm{s}$. This demonstrates that while the implicit scheme is unconditionally stable, achieving good accuracy for short-wavelength features may require a time step that is much smaller than what stability alone would permit.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 50  1.591 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Real-world ocean models must contend with nonlinear processes, which add a layer of complexity to implicit time-stepping. This practice  tackles this challenge head-on by implementing an implicit scheme for nonlinear quadratic bottom friction, a critical source of dissipation in shallow-water models. You will derive the resulting nonlinear scalar equation and implement the powerful Newton-Raphson method to solve it, gaining practical experience in the iterative techniques required to handle nonlinearity within a stable numerical framework.",
            "id": "3792416",
            "problem": "You are to implement an implicit time-stepping update for the velocity in a vertically averaged, depth-integrated ocean momentum model with nonlinear quadratic bottom friction. Start from the one-dimensional, depth-averaged momentum balance for horizontal velocity $u(t)$,\n$$\n\\frac{du}{dt} = F(t) - \\frac{\\tau(u)}{\\rho h},\n$$\nwhere $h$ is the constant water depth, $\\rho$ is the water density, and $F(t)$ is a known external acceleration per unit mass (e.g., due to pressure gradient or wind stress divided by density and depth). The bottom stress is given by the nonlinear friction law\n$$\n\\tau(u) = \\rho C_d \\lvert u \\rvert u,\n$$\nwhere $C_d$ is a known, constant drag coefficient. Thus the governing equation reduces to\n$$\n\\frac{du}{dt} = F(t) - \\frac{C_d}{h} \\lvert u \\rvert u.\n$$\nConsider a single time step from $t^n$ to $t^{n+1}=t^n+\\Delta t$ in which the friction term is treated implicitly and the external acceleration is treated explicitly at time $t^n$. Using a one-step method consistent with first-order accuracy in time, derive the scalar nonlinear equation that determines $u^{n+1}$ in terms of $u^n$, $\\Delta t$, $C_d$, $h$, and $F^n \\equiv F(t^n)$. Analyze the structure of this scalar equation to justify the existence and uniqueness of the solution for $u^{n+1}$.\n\nDesign a robust Newton iteration to solve for $u^{n+1}$ that:\n- Starts from the initial guess $u^{(0)} = u^n$.\n- Uses the exact derivative of the scalar residual with respect to $u$ wherever it exists and a mathematically consistent value at $u=0$.\n- Terminates when the absolute value of the residual is less than a prescribed tolerance or when the successive iterates differ by less than a prescribed tolerance.\n- Uses a maximum iteration cap to ensure termination in all cases. If a full Newton step does not reduce the absolute residual, apply a backtracking strategy by halving the step length until a decrease is achieved or the step becomes sufficiently small.\n\nImplement a program that computes $u^{n+1}$ for each of the test cases below. All physical quantities must be handled in the International System of Units (SI): velocity in meters per second ($\\mathrm{m/s}$), time in seconds ($\\mathrm{s}$), and depth in meters ($\\mathrm{m}$). The drag coefficient $C_d$ is dimensionless, and the external acceleration $F^n$ is in meters per second squared ($\\mathrm{m/s^2}$). Your program must output the list of resulting velocities $u^{n+1}$ for the test suite as a single line, formatted as a comma-separated list enclosed in square brackets with no spaces, with each number rounded to eight decimal places, and the implied unit of each entry is $\\mathrm{m/s}$.\n\nTest suite (each tuple is $(u^n,\\Delta t,C_d,h,F^n)$ in $(\\mathrm{m/s},\\mathrm{s},-,\\mathrm{m},\\mathrm{m/s^2})$):\n- Case A (general): $(0.5, 600.0, 2.5\\times 10^{-3}, 50.0, 1.0\\times 10^{-4})$\n- Case B (boundary, zero state): $(0.0, 600.0, 3.0\\times 10^{-3}, 20.0, 0.0)$\n- Case C (sign change tendency): $(-0.2, 3600.0, 3.0\\times 10^{-3}, 10.0, 5.0\\times 10^{-4})$\n- Case D (stiff friction, large time step): $(2.0, 21600.0, 3.0\\times 10^{-3}, 5.0, 0.0)$\n- Case E (deep water, weak friction): $(-1.5, 900.0, 1.0\\times 10^{-3}, 500.0, -2.0\\times 10^{-4})$\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets with no spaces, with each entry rounded to eight decimal places, for example: \"[0.12345678,-0.87654321,0.00000000]\".",
            "solution": "The problem requires the derivation and implementation of a first-order, semi-implicit time-stepping scheme for the one-dimensional, depth-averaged momentum equation with nonlinear quadratic bottom friction. The solution for the velocity at the new time step, $u^{n+1}$, involves solving a scalar nonlinear equation using a robust Newton-Raphson method.\n\n### Derivation of the Semi-Implicit Scheme\n\nThe governing ordinary differential equation for the horizontal velocity $u(t)$ is given as:\n$$\n\\frac{du}{dt} = F(t) - \\frac{C_d}{h} \\lvert u \\rvert u\n$$\nwhere $u$ is the velocity, $t$ is time, $F(t)$ is an external acceleration, $C_d$ is the dimensionless drag coefficient, and $h$ is the constant water depth.\n\nTo derive a numerical scheme that is first-order accurate in time, we discretize the time derivative using a forward difference over a time step $\\Delta t = t^{n+1} - t^n$:\n$$\n\\frac{du}{dt} \\approx \\frac{u^{n+1} - u^n}{\\Delta t}\n$$\nThe problem specifies a semi-implicit scheme where the external acceleration $F(t)$ is treated explicitly (evaluated at time $t^n$) and the nonlinear friction term is treated implicitly (evaluated at time $t^{n+1}$). This approach, often called IMEX (Implicit-Explicit), is standard for improving stability by treating stiff terms like friction implicitly.\n\nSetting the discretized time derivative equal to the discretized right-hand side yields:\n$$\n\\frac{u^{n+1} - u^n}{\\Delta t} = F^n - \\frac{C_d}{h} \\lvert u^{n+1} \\rvert u^{n+1}\n$$\nwhere $u^n = u(t^n)$, $u^{n+1} = u(t^{n+1})$, and $F^n = F(t^n)$.\n\nTo solve for the unknown $u^{n+1}$, we rearrange this equation into a standard root-finding form, $R(x)=0$, where $x = u^{n+1}$.\nMultiplying by $\\Delta t$ and rearranging terms, we get:\n$$\nu^{n+1} - u^n = \\Delta t F^n - \\frac{\\Delta t C_d}{h} \\lvert u^{n+1} \\rvert u^{n+1}\n$$\n$$\nu^{n+1} + \\frac{\\Delta t C_d}{h} \\lvert u^{n+1} \\rvert u^{n+1} - u^n - \\Delta t F^n = 0\n$$\nThis is the scalar nonlinear equation for $u^{n+1}$. For convenience, let us define two constants for a given time step: the non-dimensional friction parameter $\\alpha = \\frac{\\Delta t C_d}{h}$ and the explicit predictor term $\\beta = u^n + \\Delta t F^n$. The equation for $x = u^{n+1}$ simplifies to:\n$$\nx + \\alpha \\lvert x \\rvert x - \\beta = 0\n$$\nThe residual function to be solved by the Newton iteration is therefore:\n$$\nR(x) = x + \\alpha \\lvert x \\rvert x - \\beta\n$$\n\n### Existence and Uniqueness of the Solution\n\nTo justify the existence and uniqueness of the solution for $u^{n+1}$, we analyze the properties of the function $g(x) = x + \\alpha \\lvert x \\rvert x$. The equation to solve is $g(x) = \\beta$.\n\nThe physical parameters $\\Delta t$, $C_d$, and $h$ are all strictly positive, so the coefficient $\\alpha = \\frac{\\Delta t C_d}{h}$ is also strictly positive.\n\nWe examine the derivative of $g(x)$ with respect to $x$. The term $\\lvert x \\rvert x$ can be written as $x^2$ for $x \\geq 0$ and $-x^2$ for $x  0$. Its derivative with respect to $x$ is $2x$ for $x0$ and $-2x$ for $x0$. At $x=0$, the function $\\lvert x \\rvert x$ is differentiable and its derivative is $0$. Thus, the derivative of $\\lvert x \\rvert x$ is $2\\lvert x \\rvert$ for all $x \\in \\mathbb{R}$.\n\nThe derivative of $g(x)$ is then:\n$$\ng'(x) = \\frac{d}{dx} (x + \\alpha \\lvert x \\rvert x) = 1 + \\alpha \\frac{d}{dx}(\\lvert x \\rvert x) = 1 + 2\\alpha \\lvert x \\rvert\n$$\nSince $\\alpha  0$ and $\\lvert x \\rvert \\geq 0$, the derivative $g'(x)$ is always greater than or equal to $1$:\n$$\ng'(x) = 1 + 2\\alpha \\lvert x \\rvert \\ge 1 \\quad \\forall x \\in \\mathbb{R}\n$$\nA function with a strictly positive derivative is strictly monotonically increasing. A strictly monotonic function is injective (one-to-one).\n\nFurthermore, we examine the limits of $g(x)$:\n- As $x \\to \\infty$, $g(x) = x(1 + \\alpha x) \\to \\infty$.\n- As $x \\to -\\infty$, $g(x) = x(1 - \\alpha x) \\to -\\infty$.\n\nSince $g(x)$ is continuous and its range is $(-\\infty, \\infty)$, the Intermediate Value Theorem guarantees that for any real number $\\beta$, there exists at least one $x$ such that $g(x) = \\beta$. Combined with the strict monotonicity (which implies injectivity), we conclude that for any given $\\beta$, there exists a unique real solution $x = u^{n+1}$. This ensures the problem is well-posed.\n\n### Newton Iteration Scheme\n\nWe solve the nonlinear equation $R(x) = 0$ using the Newton-Raphson method. The iterative update formula is:\n$$\nx^{(k+1)} = x^{(k)} - \\frac{R(x^{(k)})}{R'(x^{(k)})}\n$$\nwhere $x^{(k)}$ is the estimate of the root at iteration $k$.\n\n- **Residual and its Derivative**:\n  The residual is $R(x) = x + \\alpha \\lvert x \\rvert x - \\beta$.\n  Its derivative, as derived for $g'(x)$, is $R'(x) = 1 + 2\\alpha \\lvert x \\rvert$. This derivative is continuous and well-defined for all $x$, including $x=0$, where $R'(0) = 1$. The problem's requirement for a \"mathematically consistent value at $u=0$\" is naturally satisfied.\n\n- **Initial Guess**: As specified, the iteration starts with the velocity from the previous time step: $x^{(0)} = u^n$.\n\n- **Iteration Update**: The Newton step $\\Delta x^{(k)}$ is computed as:\n  $$\n  \\Delta x^{(k)} = - \\frac{R(x^{(k)})}{R'(x^{(k)})} = - \\frac{x^{(k)} + \\alpha \\lvert x^{(k)} \\rvert x^{(k)} - \\beta}{1 + 2\\alpha \\lvert x^{(k)} \\rvert}\n  $$\n  The next iterate is $x^{(k+1)} = x^{(k)} + \\Delta x^{(k)}$.\n\n- **Backtracking Line Search**: To enhance robustness, especially for poor initial guesses, a backtracking strategy is employed. If a full Newton step (step length $\\lambda=1$) does not decrease the absolute value of the residual (i.e., $|R(x^{(k+1)})| \\ge |R(x^{(k)})|$), the step length $\\lambda$ is successively halved ($\\lambda \\to \\lambda/2$). The update becomes $x^{(k+1)} = x^{(k)} + \\lambda \\Delta x^{(k)}$. This process is repeated until a smaller residual is achieved or $\\lambda$ falls below a minimum threshold.\n\n- **Termination Criteria**: The iteration terminates when any of the following conditions are met:\n  1. The absolute value of the residual is below a specified tolerance $\\epsilon_{res}$: $|R(x^{(k+1)})|  \\epsilon_{res}$.\n  2. The absolute difference between successive iterates is below a tolerance $\\epsilon_{step}$: $|x^{(k+1)} - x^{(k)}|  \\epsilon_{step}$.\n  3. A maximum number of iterations, $k_{max}$, is reached. This is a safeguard against non-convergence.\n\nThis combination of a robust Newton solver with a backtracking line search provides an efficient and reliable method for finding the unique solution $u^{n+1}$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the updated velocity u^{n+1} using a semi-implicit scheme\n    for a 1D ocean momentum model with quadratic bottom friction.\n    The resulting nonlinear scalar equation is solved with a robust Newton's method.\n    \"\"\"\n\n    test_cases = [\n        # Case A (general): (u^n, Δt, C_d, h, F^n)\n        (0.5, 600.0, 2.5e-3, 50.0, 1.0e-4),\n        # Case B (boundary, zero state):\n        (0.0, 600.0, 3.0e-3, 20.0, 0.0),\n        # Case C (sign change tendency):\n        (-0.2, 3600.0, 3.0e-3, 10.0, 5.0e-4),\n        # Case D (stiff friction, large time step):\n        (2.0, 21600.0, 3.0e-3, 5.0, 0.0),\n        # Case E (deep water, weak friction):\n        (-1.5, 900.0, 1.0e-3, 500.0, -2.0e-4),\n    ]\n\n    def solve_newton_step(un, dt, Cd, h, Fn):\n        \"\"\"\n        Computes u^{n+1} by solving the nonlinear equation using Newton's method.\n        The equation is R(x) = x + alpha*|x|*x - beta = 0, where x = u^{n+1}.\n        \"\"\"\n        alpha = dt * Cd / h\n        beta = un + dt * Fn\n\n        def R(x):\n            return x + alpha * np.abs(x) * x - beta\n\n        def R_prime(x):\n            return 1.0 + 2.0 * alpha * np.abs(x)\n\n        # Newton iteration parameters\n        max_iter = 100\n        tol_res = 1e-12   # Tolerance for the absolute residual\n        tol_step = 1e-12  # Tolerance for the absolute step size\n        min_lambda = 1e-5 # Minimum backtracking step factor\n\n        x_k = un  # Initial guess x^(0) = u^n\n\n        for _ in range(max_iter):\n            res_k = R(x_k)\n            \n            # Check for convergence on residual before taking the step\n            if np.abs(res_k)  tol_res:\n                return x_k\n\n            res_prime_k = R_prime(x_k)\n            # R_prime is always = 1 for alpha  0, so no division by zero\n\n            delta_x = -res_k / res_prime_k\n\n            # Backtracking line search\n            lam = 1.0\n            abs_res_k = np.abs(res_k)\n            \n            # Loop to find a step that reduces the residual\n            while True:\n                x_kp1 = x_k + lam * delta_x\n                res_kp1 = R(x_kp1)\n                \n                if np.abs(res_kp1)  abs_res_k:\n                    # Step accepted, break backtracking loop\n                    break\n                \n                lam /= 2.0\n                \n                # If step becomes too small, backtracking fails\n                if lam  min_lambda:\n                    # Unable to find a better point. Terminate iteration and return current best.\n                    return x_k\n            \n            # Check for convergence after finding a valid step\n            # 1. On residual at the new point\n            if np.abs(res_kp1)  tol_res:\n                return x_kp1\n            # 2. On step size\n            if np.abs(x_kp1 - x_k)  tol_step:\n                return x_kp1\n            \n            # Update for next iteration\n            x_k = x_kp1\n\n        # Return the last computed value if max_iter is reached\n        return x_k\n\n    results = []\n    for case in test_cases:\n        un, dt, Cd, h, Fn = case\n        result = solve_newton_step(un, dt, Cd, h, Fn)\n        results.append(result)\n\n    # Format the final output string as specified in the problem\n    results_str = [f\"{r:.8f}\" for r in results]\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        }
    ]
}