{
    "hands_on_practices": [
        {
            "introduction": "理论知识必须通过实践来巩固。让我们从一个基本但至关重要的练习开始。一维波动方程是描述从声波到电磁脉冲等多种物理现象的基础模型。在使用显式有限差分格式对其进行数值求解时，首要任务就是确定一个能保证数值解稳定的时间步长。这个练习  旨在训练你识别模型中的物理波速，并应用 Courant-Friedrichs-Lewy (CFL) 条件来计算最大允许时间步长 $\\Delta t$ 的核心技能。这是在运行任何复杂数值模拟前都必须执行的基础性检查。",
            "id": "2139541",
            "problem": "一位工程师正在为一种特殊同轴电缆上的电压脉冲传播开发数值模拟。在一个简化的一维模型中，位置 $x$ 和时间 $t$ 处的电压 $u(x, t)$ 由波动方程决定：\n$$ \\frac{\\partial^2 u}{\\partial t^2} = 16 \\frac{\\partial^2 u}{\\partial x^2} $$\n其中 $x$ 的单位是米，$t$ 的单位是秒。\n\n该工程师决定使用标准的显式有限差分格式来数值求解这个方程。模拟的空间网格设置为均匀间距 $\\Delta x = 0.05$ 米。为确保数值解的稳定性，必须仔细选择时间步长 $\\Delta t$。\n\n在满足该格式的Courant-Friedrichs-Lewy (CFL) 稳定性条件的情况下，可以使用的最大时间步长 $\\Delta t$ 是多少？请用秒作答，并四舍五入到三位有效数字。",
            "solution": "我们从标准形式的一维波动方程开始\n$$\n\\frac{\\partial^{2} u}{\\partial t^{2}}=c^{2}\\frac{\\partial^{2} u}{\\partial x^{2}},\n$$\n通过与给定方程 $\\frac{\\partial^{2} u}{\\partial t^{2}}=16\\,\\frac{\\partial^{2} u}{\\partial x^{2}}$ 比较，可知波速为 $c=4$。\n\n在间距为 $\\Delta x$ 和时间步长为 $\\Delta t$ 的均匀网格上，一个标准的显式二阶有限差分离散化（时间和空间中心差分）是\n$$\n\\frac{u_{j}^{n+1}-2u_{j}^{n}+u_{j}^{n-1}}{(\\Delta t)^{2}}=c^{2}\\frac{u_{j+1}^{n}-2u_{j}^{n}+u_{j-1}^{n}}{(\\Delta x)^{2}}.\n$$\n重新整理得到更新公式\n$$\nu_{j}^{n+1}=2u_{j}^{n}-u_{j}^{n-1}+r^{2}\\left(u_{j+1}^{n}-2u_{j}^{n}+u_{j-1}^{n}\\right),\n$$\n其中 Courant 数定义为\n$$\nr=\\frac{c\\,\\Delta t}{\\Delta x}.\n$$\n\n为了确定稳定性约束，我们进行 von Neumann 分析，寻找形式为 $u_{j}^{n}=G^{n}\\exp(\\mathrm{i}\\kappa j\\Delta x)$ 的傅里叶模解，其中 $G$ 是放大因子，$\\kappa$ 是波数。代入更新公式得到\n$$\nG-2+G^{-1}=r^{2}\\left(e^{\\mathrm{i}\\kappa\\Delta x}-2+e^{-\\mathrm{i}\\kappa\\Delta x}\\right)=-4r^{2}\\sin^{2}\\left(\\frac{\\kappa\\Delta x}{2}\\right).\n$$\n等价地，\n$$\nG+G^{-1}=2\\left[1-2r^{2}\\sin^{2}\\left(\\frac{\\kappa\\Delta x}{2}\\right)\\right].\n$$\n这导出了色散关系\n$$\n\\cos(\\omega\\Delta t)=1-2r^{2}\\sin^{2}\\left(\\frac{\\kappa\\Delta x}{2}\\right),\n$$\n因此，为了保证稳定性（要求对所有模式 $|G|=1$），只要对于所有的 $\\kappa$，右侧的值都位于区间 $[-1,1]$ 内即可。由于 $\\sin^{2}(\\cdot)\\in[0,1]$，右侧对于所有 $\\kappa$ 的最小值是 $1-2r^{2}$。要求 $1-2r^{2}\\geq -1$ 可得\n$$\nr^{2}\\leq 1 \\quad\\Longleftrightarrow\\quad r\\leq 1.\n$$\n因此，该显式格式的 Courant-Friedrichs-Lewy 稳定性条件是\n$$\n\\frac{c\\,\\Delta t}{\\Delta x}\\leq 1 \\quad\\Longrightarrow\\quad \\Delta t\\leq \\frac{\\Delta x}{c}.\n$$\n\n对于给定的数据，$\\Delta x=0.05$ 和 $c=4$，因此最大稳定时间步长是\n$$\n\\Delta t_{\\max}=\\frac{0.05}{4}=0.0125.\n$$\n四舍五入到三位有效数字，该值为 $0.0125$ 秒。",
            "answer": "$$\\boxed{0.0125}$$"
        },
        {
            "introduction": "在计算科学的真实世界中，理论知识的价值体现在其解决实际问题的能力上，例如调试一个崩溃的程序。一个常见的失败模式是数值解中出现“非数值”（`NaN`）错误，这往往是数值不稳定的明确信号。本练习  将你置于一个更实际的情境中：诊断一个因违反CFL条件而失败的一维平流求解器。通过这个练习，你将亲手将冯·诺依曼稳定性分析的抽象理论与程序崩溃的具象后果联系起来，学会如何从理论出发，解释为何解会指数增长并导致浮点数溢出，并最终计算出一个带有安全系数的、稳健的时间步长。",
            "id": "3220109",
            "problem": "一位开发者报告称，用于求解线性平流方程的一维显式有限差分求解器产生了“非数值”(Not a Number)结果，并怀疑是时间步长选择不当所致。你必须诊断其稳定性错误，并使用 Courant-Friedrichs-Lewy (CFL) 条件计算修正后的时间步长。请完全使用数学术语，并始终使用带量纲的物理单位。\n\n考虑线性平流方程\n$$\nu_t + a\\,u_x = 0,\n$$\n其中 $u(x,t)$ 是一个标量场，$a$ 是一个恒定的平流速度，$x$ 是位置，$t$ 是时间。该求解器在长度为 $L$ 的周期性域上使用一个包含 $n_x$ 个点的均匀网格，网格间距为 $\\Delta x = L / n_x$。该求解器采用带有时间向前差分的显式一阶迎风格式。对于 $a  0$ 的情况，空间离散化采用时间向前空间向后 (FTBS) 格式，\n$$\nu_j^{n+1} = u_j^n - C\\left(u_j^n - u_{j-1}^n\\right),\n$$\n对于 $a  0$ 的情况，则切换到时间向前空间向前 (FTFS) 格式，\n$$\nu_j^{n+1} = u_j^n - C\\left(u_{j+1}^n - u_j^n\\right),\n$$\n其中 $C$ 是 Courant 数\n$$\nC = \\frac{a\\,\\Delta t}{\\Delta x},\n$$\n$\\Delta t$ 是时间步长，$j$ 是网格点的索引，$n$ 是时间步的索引。代码将 $u(x,0)$ 初始化为一个光滑的周期场，并使用周期性边界条件进行演化。\n\n从线性常系数差分方程的解可以通过离散傅里叶模式进行分析这一基本原理出发，并考虑到显式平流格式要求波信息传播不超过数值模板的范围，推导对 $C$ 的稳定性约束，以确保放大因子的模不超过1。然后，利用此约束解释为何计算不当的时间步长可能导致解的增长过快，以至于浮点溢出，并在后续的算术运算中产生“非数值”(Not a Number)结果。最后，计算一个修正后的、受 CFL 条件限制的时间步长 $\\Delta t$，并附加一个严格的安全因子，以避免达到临界等式条件。\n\n你的任务是编写一个程序，对每个给定的测试用例执行以下操作：\n- 计算 $\\Delta x = L/n_x$。\n- 使用给定的（可能不正确的）时间步长 $\\Delta t_{\\mathrm{buggy}}$，计算 Courant 数 $C = a\\,\\Delta t_{\\mathrm{buggy}}/\\Delta x$。\n- 确定一个布尔标志：如果违反了 CFL 稳定性判据（因此预计代码会因不稳定而产生“非数值”结果），则该标志为真，否则为假。请使用你逻辑推导出的判据，不要对偏微分方程进行模拟。\n- 按如下公式计算以秒为单位的修正后时间步长\n$$\n\\Delta t_{\\mathrm{correct}} = s \\frac{\\Delta x}{|a|},\n$$\n其中 $s$ 是一个严格安全因子 $s = 0.9$。\n\n所有时间步长均以秒为单位表示。若有角度，必须使用弧度，但此处不涉及角度的输入或输出。最终输出应按顺序汇总每个测试用例的结果，即不稳定性布尔值紧随其后的是浮点数形式的修正后时间步长。你的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，例如\n$$\n[\\text{true},0.0045,\\text{false},0.006]\n$$\n使用小写字面量 \"true\" 或 \"false\" 或其编程语言等效项。\n\n使用以下测试套件，它涵盖了一般情况、边界情况、负速度情况以及几个额外的边缘情况：\n1. $a = 2.0\\,\\text{m/s}$，$L = 1.0\\,\\text{m}$，$n_x = 100$，$\\Delta t_{\\mathrm{buggy}} = 0.006\\,\\text{s}$。\n2. $a = 1.5\\,\\text{m/s}$，$L = 2.0\\,\\text{m}$，$n_x = 200$，$\\Delta t_{\\mathrm{buggy}} = L/(n_x a)\\,\\text{s}$ (即 $\\Delta t_{\\mathrm{buggy}} = \\Delta x/a$) 恰好在稳定性边界上。\n3. $a = -3.0\\,\\text{m/s}$，$L = 1.0\\,\\text{m}$，$n_x = 100$，$\\Delta t_{\\mathrm{buggy}} = 0.8\\,L/|a|\\,\\text{s}$ (一个因使用域长度而非网格间距导致的错误)。\n4. $a = 0.5\\,\\text{m/s}$，$L = 1.0\\,\\text{m}$，$n_x = 400$，$\\Delta t_{\\mathrm{buggy}} = 0.004\\,\\text{s}$。\n5. $a = 2.0\\,\\text{m/s}$，$L = 1.0\\,\\text{m}$，$n_x = 50$，$\\Delta t_{\\mathrm{buggy}} = 0.012\\,\\text{s}$。\n\n你的程序必须仅使用每个用例提供的参数，执行所述计算，并按指定格式输出一个包含不稳定性布尔值和以秒为单位的修正后时间步长的组合列表。",
            "solution": "此问题要求分析用于线性平流方程 $u_t + a\\,u_x = 0$ 的一阶迎风格式的数值稳定性。该分析将用于诊断所报告的浮点错误，并计算一个修正后的稳定时间步长 $\\Delta t$。分析的核心是使用 Von Neumann 稳定性分析方法推导给定格式的 Courant-Friedrichs-Lewy (CFL) 条件。\n\n如果误差（如舍入误差）在模拟过程中不会无限增长，则数值格式是稳定的。对于周期性域上的线性常系数偏微分方程，Von Neumann 分析法检验解的单个傅里叶模式的放大情况。我们将数值解在时间层 $n$ 和空间位置 $j$ 的一个分量表示为单个傅里叶模式：\n$$\nu_j^n = \\hat{u}^n(k) e^{i k x_j}\n$$\n其中 $k$ 是波数，$x_j = j\\Delta x$ 是网格点位置，$i = \\sqrt{-1}$，$\\hat{u}^n(k)$ 是该模式在时间步 $n$ 的振幅。格式的稳定性取决于放大因子 $G(k)$，其定义关系为 $\\hat{u}^{n+1}(k) = G(k) \\hat{u}^n(k)$。为保证稳定性，对于所有可能的波数，放大因子的模都必须不超过1，即 $|G(k)| \\leq 1$。\n\n问题根据平流速度 $a$ 的符号指定了两种格式。我们分别分析每种情况。\n\n**情况 1：$a > 0$，时间向前空间向后 (FTBS) 格式**\n\nFTBS 格式由下式给出：\n$$\nu_j^{n+1} = u_j^n - C(u_j^n - u_{j-1}^n)\n$$\n其中 $C = a\\,\\Delta t/\\Delta x$ 是 Courant 数。由于 $a > 0$、$\\Delta t > 0$ 且 $\\Delta x > 0$，我们有 $C > 0$。将傅里叶模式代入差分方程，得到：\n$$\n\\hat{u}^{n+1}(k) e^{i k j \\Delta x} = \\hat{u}^n(k) e^{i k j \\Delta x} - C \\left( \\hat{u}^n(k) e^{i k j \\Delta x} - \\hat{u}^n(k) e^{i k (j-1) \\Delta x} \\right)\n$$\n两边同除以 $\\hat{u}^n(k) e^{i k j \\Delta x}$，得到放大因子 $G(k)$：\n$$\nG(k) = \\frac{\\hat{u}^{n+1}(k)}{\\hat{u}^n(k)} = 1 - C(1 - e^{-i k \\Delta x})\n$$\n为了找到稳定性约束，我们计算 $G(k)$ 的模的平方：\n$$\n|G(k)|^2 = |1 - C(1 - \\cos(k \\Delta x) - i \\sin(k \\Delta x))|^2\n$$\n$$\n|G(k)|^2 = |(1 - C + C\\cos(k \\Delta x)) + i C\\sin(k \\Delta x)|^2\n$$\n$$\n|G(k)|^2 = (1 - C + C\\cos(k \\Delta x))^2 + (C\\sin(k \\Delta x))^2\n$$\n$$\n|G(k)|^2 = (1 - C)^2 + 2C(1-C)\\cos(k \\Delta x) + C^2\\cos^2(k \\Delta x) + C^2\\sin^2(k \\Delta x)\n$$\n$$\n|G(k)|^2 = 1 - 2C(1-C) - 2C(1-C)(-\\cos(k \\Delta x)) = 1 - 2C(1-C)(1 - \\cos(k \\Delta x))\n$$\n使用恒等式 $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$，我们得到：\n$$\n|G(k)|^2 = 1 - 4C(1-C)\\sin^2(k \\Delta x/2)\n$$\n为保证稳定性，我们需要 $|G(k)|^2 \\leq 1$。这意味着 $1 - 4C(1-C)\\sin^2(k \\Delta x/2) \\leq 1$，可简化为 $-4C(1-C)\\sin^2(k \\Delta x/2) \\leq 0$。由于 $\\sin^2(k \\Delta x/2) \\geq 0$，这要求 $C(1-C) \\geq 0$。因为 $C > 0$，该条件变为 $1-C \\geq 0$，即 $C \\leq 1$。因此，对于 $a0$，稳定性条件是 $0 \\leq C \\leq 1$。\n\n**情况 2：$a  0$，时间向前空间向前 (FTFS) 格式**\n\nFTFS 格式由下式给出：\n$$\nu_j^{n+1} = u_j^n - C(u_{j+1}^n - u_j^n)\n$$\n此处，$C = a\\,\\Delta t/\\Delta x$ 为负数。代入傅里叶模式：\n$$\n\\hat{u}^{n+1}(k) e^{i k j \\Delta x} = \\hat{u}^n(k) e^{i k j \\Delta x} - C \\left( \\hat{u}^n(k) e^{i k (j+1) \\Delta x} - \\hat{u}^n(k) e^{i k j \\Delta x} \\right)\n$$\n放大因子为：\n$$\nG(k) = 1 - C(e^{i k \\Delta x} - 1)\n$$\n对其模的平方采用类似的过程：\n$$\n|G(k)|^2 = |1 - C(\\cos(k \\Delta x) - 1) - i C \\sin(k \\Delta x)|^2\n$$\n$$\n|G(k)|^2 = (1 - C(\\cos(k \\Delta x) - 1))^2 + (-C \\sin(k \\Delta x))^2\n$$\n$$\n|G(k)|^2 = 1 + 2C(1 - \\cos(k \\Delta x)) + C^2(1 - \\cos(k \\Delta x))^2 + C^2 \\sin^2(k \\Delta x)\n$$\n$$\n|G(k)|^2 = 1 + (2C + 2C^2)(1 - \\cos(k \\Delta x)) = 1 + 2C(1+C)(1 - \\cos(k \\Delta x))\n$$\n稳定性条件 $|G(k)|^2 \\leq 1$ 要求 $2C(1+C)(1 - \\cos(k \\Delta x)) \\leq 0$。由于 $1 - \\cos(k \\Delta x) \\geq 0$，这意味着 $C(1+C) \\leq 0$。因为 $C  0$，该条件变为 $1+C \\geq 0$，即 $C \\geq -1$。因此，对于 $a0$，稳定性条件是 $-1 \\leq C \\leq 0$。\n\n**组合稳定性条件 (CFL 条件)**\n\n结合两种情况，一阶迎风格式是稳定的当且仅当：\n- 对于 $a  0$，$0 \\leq C \\leq 1$\n- 对于 $a  0$，$-1 \\leq C \\leq 0$\n\n这可以使用 Courant 数的绝对值紧凑地表示为：\n$$\n|C| = \\left|\\frac{a \\Delta t}{\\Delta x}\\right| = \\frac{|a| \\Delta t}{\\Delta x} \\leq 1\n$$\n这就是该格式的 CFL 条件。它有一个清晰的物理解释：数值依赖域（对于 FTBS 是 $[x_{j-1}, x_j]$，对于 FTFS 是 $[x_j, x_{j+1}]$）必须包含点 $(x_j, t^{n+1})$ 的物理依赖域。在一个时间步长 $\\Delta t$ 内，特征波传播的距离为 $a \\Delta t$。条件 $|a \\Delta t| \\leq \\Delta x$ 确保了此信息传播的距离不超过一个网格单元，从而保持在数值模板内部。\n\n**“非数值”(NaN) 错误的原因**\n\n当稳定性条件被违反时，即 $|C|  1$，对于某些波数，放大因子 $|G(k)|$ 将大于1。这些傅里叶模式的振幅将随每个时间步呈指数级增长。例如，对于 $C  1$ 的 FTBS 格式，增长最快的模式其 $|G| = 2C-1  1$。经过 $N$ 步后，其振幅将被乘以 $(2C-1)^N$。这种极快的增长会迅速超过标准浮点数据类型所能表示的最大值（例如，双精度浮点数约为 $1.8 \\times 10^{308}$），从而产生 `inf`（无穷大）的值。随后的算术运算，如 `inf - inf`，是未定义的，会产生 `NaN`（非数值），进而污染整个解数组。\n\n**计算任务**\n\n程序将实现推导出的条件。对于每个测试用例，它将：\n1.  计算网格间距 $\\Delta x = L/n_x$。\n2.  使用给定的可能不正确的时间步长 $\\Delta t_{\\mathrm{buggy}}$ 计算有效 Courant 数：$C'_{\\mathrm{buggy}} = |a|\\Delta t_{\\mathrm{buggy}}/\\Delta x$。\n3.  判断格式是否不稳定。当 $C'_{\\mathrm{buggy}}  1$ 时，格式不稳定。$C'_{\\mathrm{buggy}} = 1$ 的情况是一个边缘情况，但被认为是稳定的。\n4.  计算一个修正后的安全时间步长 $\\Delta t_{\\mathrm{correct}}$。我们强制使用 $s = 0.9$ 的 Courant 数作为安全因子：\n    $$\n    s = \\frac{|a| \\Delta t_{\\mathrm{correct}}}{\\Delta x} \\implies \\Delta t_{\\mathrm{correct}} = s \\frac{\\Delta x}{|a|} = 0.9 \\frac{\\Delta x}{|a|}\n    $$\n\n此过程基于数值稳定性的基本原理，为不稳定性问题提供了直接的诊断和稳健的修正方法。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes the stability of a first-order upwind scheme for several test cases,\n    determines if the given time step leads to instability, and computes a\n    corrected, stable time step based on the CFL condition.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each tuple contains: (a, L, n_x, dt_buggy_str)\n    # dt_buggy_str is a string to be evaluated.\n    test_cases = [\n        (2.0, 1.0, 100, \"0.006\"),\n        (1.5, 2.0, 200, \"L/(n_x * a)\"),\n        (-3.0, 1.0, 100, \"0.8 * L / abs(a)\"),\n        (0.5, 1.0, 400, \"0.004\"),\n        (2.0, 1.0, 50, \"0.012\"),\n    ]\n\n    results = []\n    safety_factor = 0.9\n\n    for a, L, n_x, dt_buggy_str in test_cases:\n        # Evaluate the potentially buggy time step using the provided formula\n        # This allows handling cases like dt = L/(n_x*a)\n        dt_buggy = eval(dt_buggy_str, {\"L\": L, \"n_x\": n_x, \"a\": a})\n        \n        # 1. Compute grid spacing dx\n        dx = L / n_x\n        \n        # 2. Compute the Courant number for the buggy timestep\n        # The CFL condition is based on the magnitude of the velocity\n        # C' = |a|*dt/dx\n        # Handle the case a=0 to avoid division by zero, though not in test set.\n        if a == 0:\n            courant_buggy = 0.0 # Any timestep is stable if a=0\n        else:\n            courant_buggy = np.abs(a) * dt_buggy / dx\n            \n        # 3. Determine if the stability criterion is violated\n        # The first-order upwind scheme is unstable if C' > 1.\n        # The case C'=1 is marginally stable.\n        is_unstable = courant_buggy > 1.0\n        \n        # 4. Compute the corrected, CFL-limited time step with a safety factor\n        # dt_correct = s * dx / |a|\n        if a == 0:\n            # If a is 0, the equation is u_t=0, any dt is stable.\n            # We can set dt_correct to a large number, e.g., representing infinity\n            # For this problem, we just need a valid float. Let's use dt_buggy or 1.0\n            dt_correct = 1.0 \n        else:\n            dt_correct = safety_factor * dx / np.abs(a)\n            \n        results.append(str(is_unstable).lower())\n        results.append(dt_correct)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "现在，让我们将CFL条件的应用提升到计算海洋学领域的专业级别。在复杂的海洋环流模型中，一个核心挑战是处理不同物理过程的多重时间尺度。通常，模型中传播速度最快的波（即外部模态或正压重力波）决定了整个显式模型所能使用的最大时间步长，即使这些快速波动仅占总能量的一小部分。这个高级练习  直接面向这一挑战，要求你为二维浅水方程推导CFL稳定性约束，并将其应用于一个真实的、大西洋尺度的海洋模型。更重要的是，它将引导你思考这个苛刻的 $\\Delta t$ 限制对于准确模拟潮汐等现象的深远计算意义，从而让你体会到“分裂显式”（split-explicit）等高级数值方案为何至关重要。",
            "id": "3814555",
            "problem": "考虑一个用于模拟大西洋的海盆尺度海洋模型的分裂-显式正压更新，该模型具有均匀的水平网格间距和恒定的深度。外部（正压）模态由 $f$ 平面上的线性化、无粘性浅水方程控制，该方程在静止状态附近进行了线性化：\n$$\n\\frac{\\partial u}{\\partial t} - f v = - g \\frac{\\partial \\eta}{\\partial x},\n$$\n$$\n\\frac{\\partial v}{\\partial t} + f u = - g \\frac{\\partial \\eta}{\\partial y},\n$$\n$$\n\\frac{\\partial \\eta}{\\partial t} + H\\left(\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}\\right) = 0,\n$$\n其中 $u$ 和 $v$ 是正压速度，$\\eta$ 是自由表面高度，$g$ 是重力加速度，$H$ 是恒定深度，$f$ 是科里奥利参数。假设为了分析快速正压重力波的稳定性约束，在估计最严格的 Courant-Friedrichs-Lewy (CFL) 条件时可以忽略科里奥利项。\n\n外部模态在 $\\Delta x = \\Delta y$ 的均匀方形网格上，采用标准的前后差时间步进和二阶中心空间差分进行显式推进。将时间步长记为 $\\Delta t$。对平面波解的离散格式进行 von Neumann 稳定性分析，以推导CFL稳定性要求，该要求用外部重力波速、网格间距和时间步长表示。然后，使用 $\\Delta x = 10\\,\\text{km}$，$\\Delta y = 10\\,\\text{km}$，$H = 4000\\,\\text{m}$ 和 $g = 9.81\\,\\text{m}\\,\\text{s}^{-2}$，计算正压 CFL 约束所允许的最大稳定 $\\Delta t$。\n\n最后，简要讨论这个 $\\Delta t$ 对于用显式积分的外部模态表示主要太阴半日（M2）潮汐的影响，注意其周期为 $T_{\\mathrm{M2}} \\approx 12.42\\,\\text{小时}$，并讨论由此产生的采样和计算方面的考虑。\n\n最大稳定 $\\Delta t$ 的最终数值答案以秒 (s) 为单位表示，并四舍五入到三位有效数字。最终答案必须是一个单一的实数值。",
            "solution": "该问题是有效的，因为它在科学上基于地球物理流体动力学和数值分析的原理，是适定的，并且提供了所有必要的信息。\n\n第一步是推导给定系统的 Courant-Friedrichs-Lewy (CFL) 稳定性要求。问题要求在分析快速正压重力波施加的稳定性约束时忽略科里奥利项 ($f=0$)。线性化的浅水方程于是简化为：\n$$\n\\frac{\\partial u}{\\partial t} = - g \\frac{\\partial \\eta}{\\partial x}\n$$\n$$\n\\frac{\\partial v}{\\partial t} = - g \\frac{\\partial \\eta}{\\partial y}\n$$\n$$\n\\frac{\\partial \\eta}{\\partial t} + H\\left(\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}\\right) = 0\n$$\n为了分析重力波的传播，我们可以将这三个一阶偏微分方程（PDE）组合成一个关于自由表面高度 $\\eta$ 的单一二阶偏微分方程。我们将第三个方程对时间 $t$ 求导：\n$$\n\\frac{\\partial^2 \\eta}{\\partial t^2} + H\\left(\\frac{\\partial}{\\partial t}\\frac{\\partial u}{\\partial x} + \\frac{\\partial}{\\partial t}\\frac{\\partial v}{\\partial y}\\right) = 0\n$$\n假设场是足够光滑的，我们可以交换微分的顺序：\n$$\n\\frac{\\partial^2 \\eta}{\\partial t^2} + H\\left(\\frac{\\partial}{\\partial x}\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial y}\\frac{\\partial v}{\\partial t}\\right) = 0\n$$\n现在，将前两个方程（动量方程）代入这个表达式中：\n$$\n\\frac{\\partial^2 \\eta}{\\partial t^2} + H\\left(\\frac{\\partial}{\\partial x}\\left(-g \\frac{\\partial \\eta}{\\partial x}\\right) + \\frac{\\partial}{\\partial y}\\left(-g \\frac{\\partial \\eta}{\\partial y}\\right)\\right) = 0\n$$\n由于 $g$ 和 $H$ 是常数，我们得到二维线性波动方程：\n$$\n\\frac{\\partial^2 \\eta}{\\partial t^2} = gH \\left(\\frac{\\partial^2 \\eta}{\\partial x^2} + \\frac{\\partial^2 \\eta}{\\partial y^2}\\right)\n$$\n这个方程描述了以相速度 $c = \\sqrt{gH}$ 传播的波。\n\n接下来，我们对这个波动方程的离散形式进行 von Neumann 稳定性分析。问题指定了空间上的二阶中心差分和一种标准的显式时间步进格式，对于二阶波动方程，这指的是时间中心、空间中心 (CTCS) 或蛙跳格式。令 $\\eta_{j,k}^n$ 表示 $\\eta(j\\Delta x, k\\Delta y, n\\Delta t)$ 的数值近似。离散化的方程是：\n$$\n\\frac{\\eta_{j,k}^{n+1} - 2\\eta_{j,k}^n + \\eta_{j,k}^{n-1}}{(\\Delta t)^2} = c^2 \\left( \\frac{\\eta_{j+1,k}^n - 2\\eta_{j,k}^n + \\eta_{j-1,k}^n}{(\\Delta x)^2} + \\frac{\\eta_{j,k+1}^n - 2\\eta_{j,k}^n + \\eta_{j,k-1}^n}{(\\Delta y)^2} \\right)\n$$\n我们寻求单一傅里叶模态形式的解：\n$$\n\\eta_{j,k}^n = \\lambda^n \\exp(i(k_x j \\Delta x + k_y k \\Delta y))\n$$\n其中 $\\lambda$ 是放大因子，$k_x$ 和 $k_y$ 是波数矢量的分量，$i = \\sqrt{-1}$。将此代入有限差分方程，得到：\n$$\n\\frac{\\lambda^{n+1} - 2\\lambda^n + \\lambda^{n-1}}{(\\Delta t)^2} = c^2 \\lambda^n \\left[ \\frac{\\exp(ik_x\\Delta x) - 2 + \\exp(-ik_x\\Delta x)}{(\\Delta x)^2} + \\frac{\\exp(ik_y\\Delta y) - 2 + \\exp(-ik_y\\Delta y)}{(\\Delta y)^2} \\right]\n$$\n两边同除以 $\\lambda^{n-1}$（并消去所有项共有的空间指数项）得到：\n$$\n\\frac{\\lambda^2 - 2\\lambda + 1}{(\\Delta t)^2} = c^2 \\lambda \\left[ \\frac{2\\cos(k_x\\Delta x) - 2}{(\\Delta x)^2} + \\frac{2\\cos(k_y\\Delta y) - 2}{(\\Delta y)^2} \\right]\n$$\n使用半角恒等式 $1-\\cos(\\theta) = 2\\sin^2(\\theta/2)$，我们得到：\n$$\n\\lambda^2 - 2\\lambda + 1 = -4 c^2 (\\Delta t)^2 \\lambda \\left[ \\frac{\\sin^2(k_x\\Delta x/2)}{(\\Delta x)^2} + \\frac{\\sin^2(k_y\\Delta y/2)}{(\\Delta y)^2} \\right]\n$$\n这是一个关于放大因子 $\\lambda$ 的二次方程：\n$$\n\\lambda^2 - 2\\lambda \\left( 1 - 2 c^2 (\\Delta t)^2 \\left[ \\frac{\\sin^2(k_x\\Delta x/2)}{(\\Delta x)^2} + \\frac{\\sin^2(k_y\\Delta y/2)}{(\\Delta y)^2} \\right] \\right) + 1 = 0\n$$\n为使格式稳定，放大因子的模必须满足 $|\\lambda| \\le 1$。一个形如 $\\lambda^2 - 2B\\lambda + 1 = 0$ 的二次方程，其根的模等于 $1$ 的充分必要条件是 $|B| \\le 1$。在我们的例子中，\n$$\nB = 1 - 2 c^2 (\\Delta t)^2 \\left[ \\frac{\\sin^2(k_x\\Delta x/2)}{(\\Delta x)^2} + \\frac{\\sin^2(k_y\\Delta y/2)}{(\\Delta y)^2} \\right]\n$$\n条件 $B \\le 1$ 总是满足的，因为从 $1$ 中减去的项是非负的。因此，稳定性条件由 $B \\ge -1$ 决定：\n$$\n1 - 2 c^2 (\\Delta t)^2 \\left[ \\frac{\\sin^2(k_x\\Delta x/2)}{(\\Delta x)^2} + \\frac{\\sin^2(k_y\\Delta y/2)}{(\\Delta y)^2} \\right] \\ge -1\n$$\n$$\nc^2 (\\Delta t)^2 \\left[ \\frac{\\sin^2(k_x\\Delta x/2)}{(\\Delta x)^2} + \\frac{\\sin^2(k_y\\Delta y/2)}{(\\Delta y)^2} \\right] \\le 1\n$$\n这个条件必须对所有可能的波数都成立。最严格（最坏情况）的情形发生在左侧达到最大值时。这发生在最短可分辨波长（奈奎斯特频率）处，此时 $k_x = \\pi/\\Delta x$ 且 $k_y = \\pi/\\Delta y$。对于这些波数，$\\sin^2(k_x\\Delta x/2) = \\sin^2(\\pi/2) = 1$ 且 $\\sin^2(k_y\\Delta y/2) = \\sin^2(\\pi/2) = 1$。稳定性判据变为：\n$$\nc^2 (\\Delta t)^2 \\left( \\frac{1}{(\\Delta x)^2} + \\frac{1}{(\\Delta y)^2} \\right) \\le 1\n$$\n这就是该格式的一般 CFL 条件。由于问题指定了 $\\Delta x = \\Delta y$，该条件简化为：\n$$\nc^2 (\\Delta t)^2 \\left( \\frac{2}{(\\Delta x)^2} \\right) \\le 1\n$$\n解出 $\\Delta t$ 得到稳定性要求：\n$$\n\\Delta t \\le \\frac{\\Delta x}{c\\sqrt{2}}\n$$\n现在，我们使用给定的数值计算最大稳定时间步长 $\\Delta t_{\\max}$：$\\Delta x = 10\\,\\text{km} = 10 \\times 10^3\\,\\text{m}$，$H = 4000\\,\\text{m}$，以及 $g = 9.81\\,\\text{m}\\,\\text{s}^{-2}$。\n首先，我们计算正压重力波速 $c$：\n$$\nc = \\sqrt{gH} = \\sqrt{(9.81\\,\\text{m}\\,\\text{s}^{-2})(4000\\,\\text{m})} = \\sqrt{39240}\\,\\text{m}\\,\\text{s}^{-1}\n$$\n现在我们可以计算 $\\Delta t_{max}$：\n$$\n\\Delta t_{max} = \\frac{\\Delta x}{c\\sqrt{2}} = \\frac{\\Delta x}{\\sqrt{2gH}} = \\frac{10000\\,\\text{m}}{\\sqrt{2 \\times 9.81\\,\\text{m}\\,\\text{s}^{-2} \\times 4000\\,\\text{m}}} = \\frac{10000}{\\sqrt{78480}}\\,\\text{s}\n$$\n$$\n\\Delta t_{max} \\approx 35.6960...\\,\\text{s}\n$$\n四舍五入到三位有效数字，最大稳定时间步长为 $35.7\\,\\text{s}$。\n\n最后，我们讨论这对表示周期为 $T_{\\mathrm{M2}} \\approx 12.42\\,\\text{小时}$ 的主要太阴半日潮（M2）的影响。\nM2 周期以秒为单位是 $T_{\\mathrm{M2}} \\approx 12.42\\,\\text{h} \\times 3600\\,\\text{s/h} \\approx 44712\\,\\text{s}$。\n采样一个 M2 周期所需的时间步数是 $N = T_{\\mathrm{M2}} / \\Delta t \\approx 44712\\,\\text{s} / 35.7\\,\\text{s} \\approx 1252$。\n从采样的角度来看，每个周期超过 $1200$ 个点提供了极好的时间分辨率，远超奈奎斯特准则，足以高精度地表示 M2 潮汐的时间演变。\n主要影响与计算成本有关。$\\Delta t \\approx 35.7\\,\\text{s}$ 的小时间步长是一个严格的约束。在分裂-显式模型中，三维斜压（内部）动力学使用一个大得多的时间步长 $\\Delta t_{int}$ 进行积分，可能在小时量级（$3600\\,\\text{s}$）。对于斜压模态的每一步，二维正压（外部）模态必须推进 $N_{sub} = \\Delta t_{int}/\\Delta t$ 个子循环。在这种情况下，$N_{sub} \\approx 3600/35.7 \\approx 101$。这意味着，对于计算开销大的三维模型的每一步，计算开销较小的二维正压模型必须运行大约 $100$ 次。尽管这比用小的正压时间步长运行完整的三维模型更有效，但外部模态的积分仍然占总计算开销的很大一部分，特别是对于潮汐研究所需的长时间模拟。这一严重限制是开发替代时间步进格式的主要动机，例如自由表面的半隐式或全隐式方法，这些方法不受此 CFL 条件的约束。",
            "answer": "$$\n\\boxed{35.7}\n$$"
        }
    ]
}