{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握柯朗-弗里德里希斯-列维（CFL）条件，研究数值格式完美捕捉物理现实的特殊情况会很有启发性。这个思想实验探讨了当柯朗数恰好为1时会发生什么，揭示了将数值依赖域与物理特征线相匹配的核心原理。理解这个理想情景为我们提供了基础直觉，解释了为什么违反该条件会导致错误。",
            "id": "2139538",
            "problem": "考虑一维线性平流方程，该方程模拟了某个量 $u$ 以恒定速度的输运过程。该方程由下式给出：\n$$\n\\frac{\\partial u}{\\partial t} + c \\frac{\\partial u}{\\partial x} = 0\n$$\n其中 $u(x, t)$ 是在位置 $x$ 和时间 $t$ 的输运量，而 $c$ 是一个恒定的正平流速度 ($c > 0$)。该方程在空间域 $x \\in (-\\infty, \\infty)$ 和时间 $t \\ge 0$ 上求解。\n\n在 $t=0$ 时的初始条件是一个定义良好的局部脉冲，$u(x, 0) = f(x)$，它仅在一个有限区间上非零。\n\n为了数值求解此方程，我们建立一个具有均匀空间步长 $\\Delta x$ 和均匀时间步长 $\\Delta t$ 的计算网格。网格点表示为 $x_j = j \\Delta x$ 和 $t_n = n \\Delta t$，其中 $j$ 是整数，$n$ 是非负整数。令 $U_j^n$ 表示 $u(x_j, t_n)$ 的数值近似。\n\n数值求解采用一阶迎风有限差分格式。给定正平流速度 $c>0$，该格式通过对时间导数使用向前差分、对空间导数使用向后差分来定义：\n$$\n\\frac{U_j^{n+1} - U_j^n}{\\Delta t} + c \\frac{U_j^n - U_{j-1}^n}{\\Delta x} = 0\n$$\n特别选择网格步长 $\\Delta x$ 和时间步长 $\\Delta t$，使得定义为 $\\sigma = \\frac{c \\Delta t}{\\Delta x}$ 的库朗数（Courant number）恰好等于 1。\n\n在系统演化 $N$ 个时间步长后（其中 $N$ 是一个正整数），下列哪个陈述最能描述数值解的剖面 $\\{U_j^N\\}_{j \\in \\mathbb{Z}}$ 相对于初始离散剖面 $\\{U_j^0\\}_{j \\in \\mathbb{Z}}$ 的关系？\n\nA. 在网格点上，数值解与精确解析解完全相同，表示初始剖面的一个完美的、保持形状的平移。\n\nB. 脉冲的峰值减小，其基底变宽，表明存在数值耗散。\n\nC. 数值解中出现了伪振荡，特别是在初始脉冲梯度较大的区域附近。\n\nD. 数值解的量值无界增长，表明存在数值不稳定性。\n\nE. 脉冲发生了平移，但变得不对称，一侧比另一侧更陡峭。\n\nF. 脉冲保持在其初始位置的中心，但其振幅随时间衰减。",
            "solution": "连续问题是具有恒定正速度 $c>0$ 的线性平流方程，\n$$\n\\frac{\\partial u}{\\partial t} + c \\frac{\\partial u}{\\partial x} = 0,\n$$\n其初始条件 $u(x,0)=f(x)$ 是紧支的。根据特征线法，沿着满足 $\\frac{\\mathrm{d}x}{\\mathrm{d}t}=c$ 的曲线，解是恒定的。因此，精确解为\n$$\nu(x,t) = f(x - c t).\n$$\n\n在一个具有 $x_j=j \\Delta x$，$t_n=n \\Delta t$ 的均匀网格上，针对 $c>0$ 的一阶迎风格式为\n$$\n\\frac{U_j^{n+1} - U_j^n}{\\Delta t} + c \\frac{U_j^n - U_{j-1}^n}{\\Delta x} = 0.\n$$\n引入库朗数 $\\sigma = \\frac{c \\Delta t}{\\Delta x}$ 并重新整理可得\n$$\nU_j^{n+1} = U_j^n - \\sigma \\left(U_j^n - U_{j-1}^n\\right) = (1-\\sigma) U_j^n + \\sigma U_{j-1}^n.\n$$\n当特别选择 $\\sigma=1$ 时，此更新方程简化为纯粹的平移算子\n$$\nU_j^{n+1} = U_{j-1}^n.\n$$\n将此恒等式迭代 $N$ 个时间步长，得到\n$$\nU_j^{N} = U_{j-1}^{N-1} = \\cdots = U_{j-N}^{0}.\n$$\n因此，离散剖面向右精确平移了 $N$ 个网格单元，其形状或振幅没有任何变化。\n\n为了与时间 $t_N = N \\Delta t$ 时网格点上的精确解进行比较，我们计算\n$$\nu(x_j, t_N) = f(x_j - c t_N) = f\\big(j \\Delta x - c N \\Delta t\\big).\n$$\n由于 $\\sigma= \\frac{c \\Delta t}{\\Delta x} = 1$，我们有 $c N \\Delta t = N \\Delta x$，因此\n$$\nu(x_j, t_N) = f\\big((j-N)\\Delta x\\big) = f(x_{j-N}).\n$$\n根据初始离散数据的定义，$U_{j-N}^{0} = f(x_{j-N})$，所以\n$$\nU_j^{N} = U_{j-N}^{0} = u(x_j, t_N).\n$$\n因此，在网格点上，数值解与解析解完全吻合，代表了初始剖面向右平移 $N$ 个单元的完美的、保持形状的平移。在这种情况下，数值耗散、伪振荡、不稳定性、不对称性或静止衰减等效应均未发生。\n\n正确选项是 A。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在实际的科学计算中，数值不稳定性是一个常见的障碍，通常表现为非物理结果或程序崩溃。本练习将您置于调试者的角色，任务是诊断一个不稳定的平流方程模拟。通过从第一性原理推导稳定性条件并将其应用于一个有问题的代码场景，您将培养将数值理论与实际问题解决联系起来的关键技能。",
            "id": "3220109",
            "problem": "一位开发人员报告称，一个用于求解线性平流方程的一维显式有限差分解算器产生了“非数值”(Not a Number) 的结果，并怀疑是时间步长的选择不正确。您必须诊断其稳定性误差，并使用 Courant-Friedrichs-Lewy (CFL) 条件计算一个修正后的时间步长。请完全使用数学术语，并始终使用带量纲的物理单位。\n\n考虑线性平流方程\n$$\nu_t + a\\,u_x = 0,\n$$\n其中 $u(x,t)$ 是一个标量场，$a$ 是一个恒定的平流速度，$x$ 是位置，$t$ 是时间。该解算器在一个长度为 $L$ 的周期性域上使用一个包含 $n_x$ 个点的均匀网格，网格间距为 $\\Delta x = L / n_x$。解算器采用显式一阶迎风格式和时间向前差分。当 $a > 0$ 时，空间离散化采用时间向前空间向后 (FTBS) 格式，\n$$\nu_j^{n+1} = u_j^n - C\\left(u_j^n - u_{j-1}^n\\right),\n$$\n当 $a  0$ 时，则切换为时间向前空间向前 (FTFS) 格式，\n$$\nu_j^{n+1} = u_j^n - C\\left(u_{j+1}^n - u_j^n\\right),\n$$\n其中 $C$ 是 Courant 数\n$$\nC = \\frac{a\\,\\Delta t}{\\Delta x},\n$$\n$\\Delta t$ 是时间步长，$j$ 是网格点的索引，$n$ 是时间步的索引。代码将 $u(x,0)$ 初始化为一个光滑的周期场，并使用周期性边界条件进行演化。\n\n从线性常系数差分方程的解可以通过离散傅里叶模进行分析这一基本点出发，并考虑到显式平流格式要求波信息不能超越数值模板的范围，请推导对 $C$ 的稳定性约束，以确保放大因子的幅值不超过 1。然后，用此来解释为何一个计算不当的时间步长可能导致增长过快，以至于浮点数溢出，在后续算术运算中产生“非数值”结果。最后，计算一个修正后的、受 CFL 条件限制的 $\\Delta t$，并使用一个严格的安全系数以避免临界相等情况。\n\n您的任务是编写一个程序，为每个给定的测试用例执行以下操作：\n- 计算 $\\Delta x = L/n_x$。\n- 使用给定的（可能不正确的）时间步长 $\\Delta t_{\\mathrm{buggy}}$，计算 Courant 数 $C = a\\,\\Delta t_{\\mathrm{buggy}}/\\Delta x$。\n- 确定一个布尔标志：如果 CFL 稳定性准则被违反（因此代码预计会因不稳定性而产生“非数值”），则该标志为真，否则为假。请使用您逻辑推导出的准则；不要模拟该偏微分方程。\n- 计算一个修正后的时间步长（单位为秒），公式为\n$$\n\\Delta t_{\\mathrm{correct}} = s \\frac{\\Delta x}{|a|},\n$$\n其中 $s$ 是一个严格安全系数 $s = 0.9$。\n\n所有时间步长均以秒为单位表示。如果涉及角度，必须使用弧度，但此处没有角度输入或输出。最终输出应按顺序汇总每个测试用例的不稳定性布尔值和紧随其后的修正后时间步长（浮点数）。您的程序应生成单行输出，其中包含一个逗号分隔的列表，并用方括号括起来，例如\n$$\n[\\text{true},0.0045,\\text{false},0.006]\n$$\n使用小写字面量 \"true\" 或 \"false\" 或其编程语言等效形式。\n\n请使用以下测试套件，它涵盖了一般情况、边界情况、负速度情况以及几个额外的边缘情况：\n1. $a = 2.0$ $\\mathrm{m/s}$, $L = 1.0$ $\\mathrm{m}$, $n_x = 100$, $\\Delta t_{\\mathrm{buggy}} = 0.006$ $\\mathrm{s}$。\n2. $a = 1.5$ $\\mathrm{m/s}$, $L = 2.0$ $\\mathrm{m}$, $n_x = 200$, $\\Delta t_{\\mathrm{buggy}} = L/(n_x a)$ $\\mathrm{s}$ (即 $\\Delta t_{\\mathrm{buggy}} = \\Delta x/a$)，恰好在稳定性边界上。\n3. $a = -3.0$ $\\mathrm{m/s}$, $L = 1.0$ $\\mathrm{m}$, $n_x = 100$, $\\Delta t_{\\mathrm{buggy}} = 0.8\\,L/|a|$ $\\mathrm{s}$ (这是一个由使用域长度而非网格间距引起的错误)。\n4. $a = 0.5$ $\\mathrm{m/s}$, $L = 1.0$ $\\mathrm{m}$, $n_x = 400$, $\\Delta t_{\\mathrm{buggy}} = 0.004$ $\\mathrm{s}$。\n5. $a = 2.0$ $\\mathrm{m/s}$, $L = 1.0$ $\\mathrm{m}$, $n_x = 50$, $\\Delta t_{\\mathrm{buggy}} = 0.012$ $\\mathrm{s}$。\n\n您的程序必须仅使用每个案例提供的参数，执行所述计算，并以上述指定格式输出一个包含不稳定性布尔值和修正后时间步长（单位为秒）的组合列表。",
            "solution": "该问题要求分析线性平流方程 $u_t + a\\,u_x = 0$ 的一阶迎风格式的数值稳定性。此分析将用于诊断报告的浮点数错误，并计算一个修正后的稳定时间步长 $\\Delta t$。分析的核心是使用 Von Neumann 稳定性分析方法推导给定格式的 Courant-Friedrichs-Lewy (CFL) 条件。\n\n如果误差（如舍入误差）在模拟过程中不会无限增长，则数值格式是稳定的。对于周期性域上的线性常系数偏微分方程，Von Neumann 分析法检验解的单个傅里叶模的放大情况。我们将时间层为 $n$、空间位置为 $j$ 的数值解的一个分量表示为单个傅里叶模：\n$$\nu_j^n = \\hat{u}^n(k) e^{i k x_j}\n$$\n其中 $k$ 是波数，$x_j = j\\Delta x$ 是网格点位置，$i = \\sqrt{-1}$，$\\hat{u}^n(k)$ 是该模在时间步 $n$ 的振幅。格式的稳定性取决于放大因子 $G(k)$，其定义关系为 $\\hat{u}^{n+1}(k) = G(k) \\hat{u}^n(k)$。为保证稳定性，放大因子的幅值对所有可能的波数都必须不超过 1，即 $|G(k)| \\leq 1$。\n\n问题根据平流速度 $a$ 的符号指定了两种格式。我们分别对每种情况进行分析。\n\n**情况 1：$a > 0$，时间向前空间向后 (FTBS) 格式**\n\nFTBS 格式由下式给出：\n$$\nu_j^{n+1} = u_j^n - C(u_j^n - u_{j-1}^n)\n$$\n其中 $C = a\\,\\Delta t/\\Delta x$ 是 Courant 数。由于 $a > 0$、$\\Delta t > 0$ 和 $\\Delta x > 0$，我们有 $C > 0$。将傅里叶模代入差分方程得到：\n$$\n\\hat{u}^{n+1}(k) e^{i k j \\Delta x} = \\hat{u}^n(k) e^{i k j \\Delta x} - C \\left( \\hat{u}^n(k) e^{i k j \\Delta x} - \\hat{u}^n(k) e^{i k (j-1) \\Delta x} \\right)\n$$\n两边同除以 $\\hat{u}^n(k) e^{i k j \\Delta x}$，得到放大因子 $G(k)$：\n$$\nG(k) = \\frac{\\hat{u}^{n+1}(k)}{\\hat{u}^n(k)} = 1 - C(1 - e^{-i k \\Delta x})\n$$\n为了找到稳定性约束，我们计算 $G(k)$ 的幅值平方：\n$$\n|G(k)|^2 = |1 - C(1 - \\cos(k \\Delta x) - i \\sin(k \\Delta x))|^2\n$$\n$$\n|G(k)|^2 = |(1 - C + C\\cos(k \\Delta x)) + i C\\sin(k \\Delta x)|^2\n$$\n$$\n|G(k)|^2 = (1 - C + C\\cos(k \\Delta x))^2 + (C\\sin(k \\Delta x))^2\n$$\n$$\n|G(k)|^2 = (1 - C)^2 + 2C(1-C)\\cos(k \\Delta x) + C^2\\cos^2(k \\Delta x) + C^2\\sin^2(k \\Delta x)\n$$\n$$\n|G(k)|^2 = 1 - 2C + C^2 + 2C\\cos(k \\Delta x) - 2C^2\\cos(k \\Delta x) + C^2\n$$\n$$\n|G(k)|^2 = 1 - 2C(1-C) - 2C(1-C)(-\\cos(k \\Delta x)) = 1 - 2C(1-C)(1 - \\cos(k \\Delta x))\n$$\n使用恒等式 $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$，我们得到：\n$$\n|G(k)|^2 = 1 - 4C(1-C)\\sin^2(k \\Delta x/2)\n$$\n为保证稳定性，我们要求 $|G(k)|^2 \\leq 1$。这意味着 $1 - 4C(1-C)\\sin^2(k \\Delta x/2) \\leq 1$，化简得 $-4C(1-C)\\sin^2(k \\Delta x/2) \\leq 0$。由于 $\\sin^2(k \\Delta x/2) \\geq 0$，这要求 $C(1-C) \\geq 0$。因为 $C > 0$，所以条件变为 $1-C \\geq 0$，即 $C \\leq 1$。因此，对于 $a > 0$，稳定性条件是 $0 \\leq C \\leq 1$。\n\n**情况 2：$a  0$，时间向前空间向前 (FTFS) 格式**\n\nFTFS 格式由下式给出：\n$$\nu_j^{n+1} = u_j^n - C(u_{j+1}^n - u_j^n)\n$$\n此处，$C = a\\,\\Delta t/\\Delta x$ 是负数。代入傅里叶模：\n$$\n\\hat{u}^{n+1}(k) e^{i k j \\Delta x} = \\hat{u}^n(k) e^{i k j \\Delta x} - C \\left( \\hat{u}^n(k) e^{i k (j+1) \\Delta x} - \\hat{u}^n(k) e^{i k j \\Delta x} \\right)\n$$\n放大因子是：\n$$\nG(k) = 1 - C(e^{i k \\Delta x} - 1)\n$$\n对其幅值平方进行类似处理：\n$$\n|G(k)|^2 = |1 - C(\\cos(k \\Delta x) - 1) - i C \\sin(k \\Delta x)|^2\n$$\n$$\n|G(k)|^2 = (1 - C(\\cos(k \\Delta x) - 1))^2 + (-C \\sin(k \\Delta x))^2\n$$\n$$\n|G(k)|^2 = 1 + 2C(1 - \\cos(k \\Delta x)) + C^2(1 - \\cos(k \\Delta x))^2 + C^2 \\sin^2(k \\Delta x)\n$$\n$$\n|G(k)|^2 = 1 + 2C(1 - \\cos(k \\Delta x)) + C^2( (1-2\\cos+\\cos^2) + \\sin^2) = 1 + 2C(1-\\cos) + 2C^2(1-\\cos)\n$$\n$$\n|G(k)|^2 = 1 + (2C + 2C^2)(1 - \\cos(k \\Delta x)) = 1 + 2C(1+C)(1 - \\cos(k \\Delta x))\n$$\n稳定性条件 $|G(k)|^2 \\leq 1$ 要求 $2C(1+C)(1 - \\cos(k \\Delta x)) \\leq 0$。由于 $1 - \\cos(k \\Delta x) \\geq 0$，这意味着 $C(1+C) \\leq 0$。因为 $C  0$，所以条件变为 $1+C \\geq 0$，即 $C \\geq -1$。因此，对于 $a  0$，稳定性条件是 $-1 \\leq C \\leq 0$。\n\n**合并的稳定性条件 (CFL 条件)**\n\n综合两种情况，一阶迎风格式是稳定的当且仅当：\n- 对于 $a > 0$，有 $0 \\leq C \\leq 1$\n- 对于 $a  0$，有 $-1 \\leq C \\leq 0$\n\n这可以用 Courant 数的绝对值简洁地表示：\n$$\n|C| = \\left|\\frac{a \\Delta t}{\\Delta x}\\right| = \\frac{|a| \\Delta t}{\\Delta x} \\leq 1\n$$\n这就是该格式的 CFL 条件。它有一个清晰的物理解释：数值依赖域（对于 FTBS 是 $[x_{j-1}, x_j]$，对于 FTFS 是 $[x_j, x_{j+1}]$）必须包含点 $(x_j, t^{n+1})$ 的物理依赖域。在一个时间步 $\\Delta t$ 内，特征波传播的距离是 $a \\Delta t$。条件 $|a \\Delta t| \\leq \\Delta x$ 确保了此信息传播的距离不超过一个网格单元，从而保持在模板内部。\n\n**“非数值” (NaN) 错误的原因**\n\n当稳定性条件被违反时，即 $|C| > 1$，对于某些波数，放大因子 $|G(k)|$ 将大于 1。这些傅里叶模的振幅将随着每个时间步呈指数级增长。例如，对于 FTBS 格式且 $C > 1$，增长最快的模具有 $|G| = 2C-1 > 1$。经过 $N$ 步后，其振幅被乘以 $(2C-1)^N$。这种极快的增长会迅速超过标准浮点数据类型可表示的最大值（例如，双精度浮点数约为 ~$1.8 \\times 10^{308}$），导致结果变为 `inf` (无穷大)。后续的算术运算，如 `inf - inf`，是未定义的，会产生 `NaN` (非数值)，然后污染整个解数组。\n\n**计算任务**\n\n程序将实现推导出的条件。对于每个测试用例，它将：\n1.  计算网格间距 $\\Delta x = L/n_x$。\n2.  使用给定的可能不正确的时间步长 $\\Delta t_{\\mathrm{buggy}}$ 计算有效 Courant 数：$C'_{\\mathrm{buggy}} = |a|\\Delta t_{\\mathrm{buggy}}/\\Delta x$。\n3.  确定格式是否不稳定。当 $C'_{\\mathrm{buggy}} > 1$ 时发生。$C'_{\\mathrm{buggy}} = 1$ 的情况是临界情况，但被认为是稳定的。\n4.  计算一个修正后的安全时间步长 $\\Delta t_{\\mathrm{correct}}$。我们强制 Courant 数为 $s = 0.9$ 作为安全系数：\n    $$\n    s = \\frac{|a| \\Delta t_{\\mathrm{correct}}}{\\Delta x} \\implies \\Delta t_{\\mathrm{correct}} = s \\frac{\\Delta x}{|a|} = 0.9 \\frac{\\Delta x}{|a|}\n    $$\n\n此过程基于数值稳定性的基本原理，为不稳定性问题提供了直接的诊断和稳健的修正方案。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes the stability of a first-order upwind scheme for several test cases,\n    determines if the given time step leads to instability, and computes a\n    corrected, stable time step based on the CFL condition.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each tuple contains: (a, L, n_x, dt_buggy_str)\n    # dt_buggy_str is a string to be evaluated.\n    test_cases = [\n        (2.0, 1.0, 100, \"0.006\"),\n        (1.5, 2.0, 200, \"L/(n_x * a)\"),\n        (-3.0, 1.0, 100, \"0.8 * L / abs(a)\"),\n        (0.5, 1.0, 400, \"0.004\"),\n        (2.0, 1.0, 50, \"0.012\"),\n    ]\n\n    results = []\n    safety_factor = 0.9\n\n    for a, L, n_x, dt_buggy_str in test_cases:\n        # Evaluate the potentially buggy time step using the provided formula\n        # This allows handling cases like dt = L/(n_x*a)\n        dt_buggy = eval(dt_buggy_str, {\"L\": L, \"n_x\": n_x, \"a\": a})\n        \n        # 1. Compute grid spacing dx\n        dx = L / n_x\n        \n        # 2. Compute the Courant number for the buggy timestep\n        # The CFL condition is based on the magnitude of the velocity\n        # C' = |a|*dt/dx\n        # Handle the case a=0 to avoid division by zero, though not in test set.\n        if a == 0:\n            courant_buggy = 0.0 # Any timestep is stable if a=0\n        else:\n            courant_buggy = np.abs(a) * dt_buggy / dx\n            \n        # 3. Determine if the stability criterion is violated\n        # The first-order upwind scheme is unstable if C' > 1.\n        # The case C'=1 is marginally stable.\n        is_unstable = courant_buggy > 1.0\n        \n        # 4. Compute the corrected, CFL-limited time step with a safety factor\n        # dt_correct = s * dx / |a|\n        if a == 0:\n            # If a is 0, the equation is u_t=0, any dt is stable.\n            # We can set dt_correct to a large number, e.g., representing infinity\n            # For this problem, we just need a valid float. Let's use dt_buggy or 1.0\n            dt_correct = 1.0 \n        else:\n            dt_correct = safety_factor * dx / np.abs(a)\n            \n        results.append(str(is_unstable).lower())\n        results.append(dt_correct)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在大尺度地球物理模型中，CFL条件成为一个关键的制约因素，直接影响模型的设计和计算成本。这个高级练习将概念扩展到一个由浅水方程控制的、真实的二维海洋模型中。您将计算由快速移动的正压重力波所施加的严格时间步长限制，并分析其对模拟潮汐等基本海洋现象的深远影响——这是计算海洋学中的一个核心挑战。",
            "id": "3814555",
            "problem": "考虑一个用于模拟大西洋的盆地尺度海洋模型的分裂-显式正压更新，该模型具有均匀的水平网格间距和恒定的深度。外部（正压）模态由 $f$ 平面上的线性化、无粘性浅水方程控制，该方程在静止状态下进行线性化：\n$$\n\\frac{\\partial u}{\\partial t} - f v = - g \\frac{\\partial \\eta}{\\partial x}, \\quad\n\\frac{\\partial v}{\\partial t} + f u = - g \\frac{\\partial \\eta}{\\partial y}, \\quad\n\\frac{\\partial \\eta}{\\partial t} + H\\left(\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}\\right) = 0,\n$$\n其中 $u$ 和 $v$ 是正压速度，$\\eta$ 是自由表面高度，$g$ 是重力加速度，$H$ 是恒定深度，$f$ 是科里奥利参数。假设为了满足快速正压重力波的稳定性约束，在估算最严格的库朗-弗里德里希斯-列维（CFL）条件时可以忽略科里奥利项。\n\n外部模态使用标准的向前-向后时间步进和二阶中心空间差分在 $ \\Delta x = \\Delta y$ 的均匀方形网格上进行显式推进。将时间步长记为 $ \\Delta t$。对平面波解的离散格式进行冯·诺依曼稳定性分析，以推导以外部重力波速、网格间距和时间步长表示的CFL稳定性要求。然后，使用 $ \\Delta x = 10\\,\\text{km}$、$ \\Delta y = 10\\,\\text{km}$、$ H = 4000\\,\\text{m}$ 和 $ g = 9.81\\,\\text{m}\\,\\text{s}^{-2}$，计算由正压CFL约束所隐含的最大稳定时间步长 $ \\Delta t$。\n\n最后，简要讨论这个 $ \\Delta t$ 对使用显式积分的外部模态表示主要太阴半日潮（$\\mathrm{M2}$）的影响，注意其周期为 $T_{\\mathrm{M2}} \\approx 12.42\\,\\text{小时}$，以及由此产生的采样和计算方面的考虑。\n\n以秒（s）为单位表示最大稳定时间步长 $ \\Delta t$ 的最终数值答案，并将答案四舍五入到三位有效数字。最终答案必须是单个实数值。",
            "solution": "第一步是推导给定系统的库朗-弗里德里希斯-列维（CFL）稳定性要求。为了分析快速正压重力波带来的稳定性约束，问题要求忽略科里奥利项 ($f=0$)。线性化浅水方程简化为：\n$$\n\\frac{\\partial u}{\\partial t} = - g \\frac{\\partial \\eta}{\\partial x}\n$$\n$$\n\\frac{\\partial v}{\\partial t} = - g \\frac{\\partial \\eta}{\\partial y}\n$$\n$$\n\\frac{\\partial \\eta}{\\partial t} + H\\left(\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}\\right) = 0\n$$\n为了分析重力波的传播，我们可以将这三个一阶偏微分方程（PDE）合并成一个关于自由表面高度 $\\eta$ 的单个二阶偏微分方程。我们将第三个方程对时间 $t$ 求导：\n$$\n\\frac{\\partial^2 \\eta}{\\partial t^2} + H\\left(\\frac{\\partial}{\\partial t}\\frac{\\partial u}{\\partial x} + \\frac{\\partial}{\\partial t}\\frac{\\partial v}{\\partial y}\\right) = 0\n$$\n假设场足够光滑，我们可以交换求导顺序：\n$$\n\\frac{\\partial^2 \\eta}{\\partial t^2} + H\\left(\\frac{\\partial}{\\partial x}\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial y}\\frac{\\partial v}{\\partial t}\\right) = 0\n$$\n现在，将前两个方程（动量方程）代入此表达式：\n$$\n\\frac{\\partial^2 \\eta}{\\partial t^2} + H\\left(\\frac{\\partial}{\\partial x}\\left(-g \\frac{\\partial \\eta}{\\partial x}\\right) + \\frac{\\partial}{\\partial y}\\left(-g \\frac{\\partial \\eta}{\\partial y}\\right)\\right) = 0\n$$\n由于 $g$ 和 $H$ 是常数，我们得到二维线性波动方程：\n$$\n\\frac{\\partial^2 \\eta}{\\partial t^2} = gH \\left(\\frac{\\partial^2 \\eta}{\\partial x^2} + \\frac{\\partial^2 \\eta}{\\partial y^2}\\right)\n$$\n该方程描述了以相速 $c = \\sqrt{gH}$ 传播的波。\n\n接下来，我们对该波动方程的离散形式进行冯·诺依曼稳定性分析。问题指定了空间上的二阶中心差分和标准的显式时间步进格式，对于二阶波动方程，这即是时间中心、空间中心（CTCS）格式或蛙跳格式。令 $\\eta_{j,k}^n$ 表示 $\\eta(j\\Delta x, k\\Delta y, n\\Delta t)$ 的数值近似。离散化方程为：\n$$\n\\frac{\\eta_{j,k}^{n+1} - 2\\eta_{j,k}^n + \\eta_{j,k}^{n-1}}{(\\Delta t)^2} = c^2 \\left( \\frac{\\eta_{j+1,k}^n - 2\\eta_{j,k}^n + \\eta_{j-1,k}^n}{(\\Delta x)^2} + \\frac{\\eta_{j,k+1}^n - 2\\eta_{j,k}^n + \\eta_{j,k-1}^n}{(\\Delta y)^2} \\right)\n$$\n我们寻求单个傅里叶模形式的解：\n$$\n\\eta_{j,k}^n = \\lambda^n \\exp(i(k_x j \\Delta x + k_y k \\Delta y))\n$$\n其中 $\\lambda$ 是放大因子，$k_x$ 和 $k_y$ 是波数矢量的分量，$i = \\sqrt{-1}$。将此代入有限差分方程，得到：\n$$\n\\frac{\\lambda^{n+1} - 2\\lambda^n + \\lambda^{n-1}}{(\\Delta t)^2} = c^2 \\lambda^n \\left[ \\frac{\\exp(ik_x\\Delta x) - 2 + \\exp(-ik_x\\Delta x)}{(\\Delta x)^2} + \\frac{\\exp(ik_y\\Delta y) - 2 + \\exp(-ik_y\\Delta y)}{(\\Delta y)^2} \\right]\n$$\n除以 $\\lambda^{n-1}$（并消去所有项共有的空间指数项），得到：\n$$\n\\frac{\\lambda^2 - 2\\lambda + 1}{(\\Delta t)^2} = c^2 \\lambda \\left[ \\frac{2\\cos(k_x\\Delta x) - 2}{(\\Delta x)^2} + \\frac{2\\cos(k_y\\Delta y) - 2}{(\\Delta y)^2} \\right]\n$$\n使用半角恒等式 $1-\\cos(\\theta) = 2\\sin^2(\\theta/2)$，我们得到：\n$$\n\\lambda^2 - 2\\lambda + 1 = -4 c^2 (\\Delta t)^2 \\lambda \\left[ \\frac{\\sin^2(k_x\\Delta x/2)}{(\\Delta x)^2} + \\frac{\\sin^2(k_y\\Delta y/2)}{(\\Delta y)^2} \\right]\n$$\n这是一个关于放大因子 $\\lambda$ 的二次方程：\n$$\n\\lambda^2 - 2\\lambda \\left( 1 - 2 c^2 (\\Delta t)^2 \\left[ \\frac{\\sin^2(k_x\\Delta x/2)}{(\\Delta x)^2} + \\frac{\\sin^2(k_y\\Delta y/2)}{(\\Delta y)^2} \\right] \\right) + 1 = 0\n$$\n为使格式稳定，放大因子的模必须满足 $|\\lambda| \\le 1$。形式为 $\\lambda^2 - 2B\\lambda + 1 = 0$ 的二次方程，其根的模等于 1 的充分必要条件是 $|B| \\le 1$。在我们的例子中，\n$$\nB = 1 - 2 c^2 (\\Delta t)^2 \\left[ \\frac{\\sin^2(k_x\\Delta x/2)}{(\\Delta x)^2} + \\frac{\\sin^2(k_y\\Delta y/2)}{(\\Delta y)^2} \\right]\n$$\n条件 $B \\le 1$ 总是满足的，因为从 1 中减去的项是非负的。因此，稳定性条件由 $B \\ge -1$ 决定：\n$$\n1 - 2 c^2 (\\Delta t)^2 \\left[ \\frac{\\sin^2(k_x\\Delta x/2)}{(\\Delta x)^2} + \\frac{\\sin^2(k_y\\Delta y/2)}{(\\Delta y)^2} \\right] \\ge -1\n$$\n$$\nc^2 (\\Delta t)^2 \\left[ \\frac{\\sin^2(k_x\\Delta x/2)}{(\\Delta x)^2} + \\frac{\\sin^2(k_y\\Delta y/2)}{(\\Delta y)^2} \\right] \\le 1\n$$\n该条件必须对所有可能的波数成立。最严格（最坏情况）的场景发生在左侧最大化时。这发生在最短可分辨波长（奈奎斯特频率）处，此时 $k_x = \\pi/\\Delta x$ 且 $k_y = \\pi/\\Delta y$。对于这些波数，$\\sin^2(k_x\\Delta x/2) = \\sin^2(\\pi/2) = 1$ 且 $\\sin^2(k_y\\Delta y/2) = \\sin^2(\\pi/2) = 1$。稳定性判据变为：\n$$\nc^2 (\\Delta t)^2 \\left( \\frac{1}{(\\Delta x)^2} + \\frac{1}{(\\Delta y)^2} \\right) \\le 1\n$$\n这是该格式的一般CFL条件。由于问题指定 $\\Delta x = \\Delta y$，这简化为：\n$$\nc^2 (\\Delta t)^2 \\left( \\frac{2}{(\\Delta x)^2} \\right) \\le 1\n$$\n求解 $\\Delta t$ 得到稳定性要求：\n$$\n\\Delta t \\le \\frac{\\Delta x}{c\\sqrt{2}}\n$$\n现在，我们使用给定值计算最大稳定时间步长 $\\Delta t_{max}$：$\\Delta x = 10\\,\\text{km} = 10 \\times 10^3\\,\\text{m}$，$H = 4000\\,\\text{m}$，以及 $g = 9.81\\,\\text{m}\\,\\text{s}^{-2}$。\n首先，我们计算正压重力波速 $c$：\n$$\nc = \\sqrt{gH} = \\sqrt{(9.81\\,\\text{m}\\,\\text{s}^{-2})(4000\\,\\text{m})} = \\sqrt{39240}\\,\\text{m}\\,\\text{s}^{-1}\n$$\n现在我们可以计算 $\\Delta t_{max}$：\n$$\n\\Delta t_{max} = \\frac{\\Delta x}{c\\sqrt{2}} = \\frac{\\Delta x}{\\sqrt{2gH}} = \\frac{10000\\,\\text{m}}{\\sqrt{2 \\times 9.81\\,\\text{m}\\,\\text{s}^{-2} \\times 4000\\,\\text{m}}} = \\frac{10000}{\\sqrt{78480}}\\,\\text{s}\n$$\n$$\n\\Delta t_{max} \\approx 35.6960...\\,\\text{s}\n$$\n四舍五入到三位有效数字，最大稳定时间步长为 $35.7\\,\\text{s}$。\n\n最后，我们讨论这对表示主太阴半日潮（M2）的影响，其周期为 $T_{\\mathrm{M2}} \\approx 12.42\\,\\text{小时}$。\nM2周期以秒为单位是 $T_{\\mathrm{M2}} \\approx 12.42\\,\\text{h} \\times 3600\\,\\text{s/h} \\approx 44712\\,\\text{s}$。\n采样一个M2周期所需的时间步数是 $N = T_{\\mathrm{M2}} / \\Delta t \\approx 44712\\,\\text{s} / 35.7\\,\\text{s} \\approx 1252$。\n从采样的角度来看，每个周期超过1200个点提供了极好的时间分辨率，远超奈奎斯特准则，足以高精度地表示M2潮汐的时间演变。\n主要影响与计算成本有关。$\\Delta t \\approx 35.7\\,\\text{s}$ 的小时间步长是一个严格的约束。在分裂-显式模型中，三维斜压（内部）动力学使用大得多的时间步长 $\\Delta t_{int}$ 进行积分，可能在小时量级（$3600\\,\\text{s}$）。对于斜压模态的每一步，二维正压（外部）模态必须推进 $N_{sub} = \\Delta t_{int}/\\Delta t$ 个子循环。在这种情况下，$N_{sub} \\approx 3600/35.7 \\approx 101$。这意味着，对于昂贵的3D模型的每一步，计算上更便宜的2D正压模型必须运行大约100次。虽然这比使用小的正压时间步长运行完整的3D模型更有效率，但外部模态的积分仍然占总计算开销的很大一部分，特别是对于潮汐研究所需的长时间模拟。这一严格的限制是开发替代时间步进格式的主要动机，例如用于自由表面的半隐式或全隐式方法，这些方法不受此CFL条件的约束。",
            "answer": "$$\n\\boxed{35.7}\n$$"
        }
    ]
}