{
    "hands_on_practices": [
        {
            "introduction": "A crucial first step in developing any numerical model is to verify that the code correctly implements the chosen algorithm. This practice guides you through a fundamental verification technique: the grid refinement study. By comparing your numerical results for a simple advection-diffusion problem against a known analytic solution at different grid resolutions, you can quantitatively measure the code's convergence and determine its observed order of accuracy . This process is essential for building confidence in your solver before applying it to more complex problems where exact solutions are not available.",
            "id": "3795833",
            "problem": "Consider the one-dimensional periodic advectionâ€“diffusion of a passive tracer with constant velocity and diffusivity, a canonical model used in Computational Oceanography. Let the concentration field be denoted by $c(x,t)$ on the domain $x \\in [0,L]$, with $L$ the domain length. The governing equation is the conservation law\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(u\\,c\\right) \\;=\\; \\frac{\\partial}{\\partial x}\\left(\\kappa\\,\\frac{\\partial c}{\\partial x}\\right),\n$$\nwhere $u$ is the constant advective velocity and $\\kappa$ is the constant diffusivity. Periodic boundary conditions are imposed at $x=0$ and $x=L$, and the initial condition is a single Fourier mode,\n$$\nc(x,0) \\;=\\; \\sin\\!\\left(k\\,x\\right), \\quad k \\;=\\; \\frac{2\\pi m}{L},\n$$\nwith $m$ a positive integer ensuring periodicity.\n\nThe analytic solution of this initial value problem is given by\n$$\nc_{\\text{exact}}(x,t) \\;=\\; \\exp\\!\\left(-\\kappa\\,k^2\\,t\\right)\\,\\sin\\!\\left(k\\left(x - u\\,t\\right)\\right).\n$$\nBecause the numerical method evolves cell-averaged values, the exact cell-average over a cell of width $\\Delta x$ centered at $x_i$ is\n$$\n\\bar{c}_{\\text{exact},i}(t) \\;=\\; \\exp\\!\\left(-\\kappa\\,k^2\\,t\\right)\\,\\sin\\!\\left(k\\left(x_i - u\\,t\\right)\\right)\\,\\frac{2\\,\\sin\\!\\left(\\frac{k\\,\\Delta x}{2}\\right)}{k\\,\\Delta x}.\n$$\n\nYou must implement a uniform-mesh Finite Volume Method (FVM) for this equation with the following specifications, starting from the integral conservation law over a control volume and consistent face fluxes:\n\n- Mesh: divide $[0,L]$ into $N$ uniform cells of width $\\Delta x = L/N$ with periodic connectivity. Store and evolve the cell averages $\\bar{c}_i(t)$.\n- Face flux: write the total flux as $F = u\\,c - \\kappa\\,\\frac{\\partial c}{\\partial x}$. At a cell face $x_{i+1/2}$, approximate the advective flux as $F^{\\text{adv}}_{i+1/2} = u\\,\\hat{c}_{i+1/2}$ using first-order upwind for $\\hat{c}_{i+1/2}$ depending on the sign of $u$, and approximate the diffusive flux as $F^{\\text{diff}}_{i+1/2} = -\\kappa\\,\\frac{\\bar{c}_{i+1} - \\bar{c}_i}{\\Delta x}$ using a second-order central difference of cell averages. The total face flux is $F_{i+1/2} = F^{\\text{adv}}_{i+1/2} + F^{\\text{diff}}_{i+1/2}$.\n- Time stepping: use the forward Euler (first-order) method applied to the semi-discrete FVM update,\n$$\n\\bar{c}_i^{n+1} \\;=\\; \\bar{c}_i^n \\;-\\; \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^n - F_{i-1/2}^n\\right),\n$$\nwith periodic indexing. Choose the time step to satisfy stability and to minimize temporal error contamination in the spatial grid refinement study by\n$$\n\\Delta t \\;=\\; \\min\\!\\left(c_a\\,\\frac{\\Delta x}{|u|}, \\; c_d\\,\\frac{\\Delta x^2}{\\kappa}\\right),\n$$\nwhere $c_a = 0.5$ and $c_d = 0.25$. To reach the prescribed final time $T$ exactly, take $n_{\\text{steps}} = \\lceil T/\\Delta t \\rceil$ and reset $\\Delta t \\leftarrow T/n_{\\text{steps}}$.\n\nDefine the discrete root-mean-square (RMS) error at time $T$ by\n$$\nE(\\Delta x) \\;=\\; \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1}\\left(\\bar{c}_i(T) - \\bar{c}_{\\text{exact},i}(T)\\right)^2},\n$$\nand compute the observed order of accuracy between successive grid sizes in a refinement sequence with halving $\\Delta x$ as\n$$\np \\;=\\; \\frac{\\log\\!\\left(E(\\Delta x_{\\text{coarse}})/E(\\Delta x_{\\text{fine}})\\right)}{\\log\\!\\left(\\Delta x_{\\text{coarse}}/\\Delta x_{\\text{fine}}\\right)}.\n$$\n\nPerform a grid refinement study for the following test suite, which explores different regimes through the velocity $u$, diffusivity $\\kappa$, wavelength index $m$, and mesh sequences. All physical parameters must be used with their units as given. The reported observed orders are dimensionless.\n\n- Case $\\#1$ (advection-dominated): $L = 1000\\,\\mathrm{m}$, $u = 0.5\\,\\mathrm{m/s}$, $\\kappa = 0.01\\,\\mathrm{m^2/s}$, $m = 1$, $T = 1000\\,\\mathrm{s}$, $N$ sequence $[20,40,80,160,320]$.\n- Case $\\#2$ (diffusion-dominated): $L = 1000\\,\\mathrm{m}$, $u = 0.05\\,\\mathrm{m/s}$, $\\kappa = 5\\,\\mathrm{m^2/s}$, $m = 1$, $T = 1000\\,\\mathrm{s}$, $N$ sequence $[20,40,80,160,320]$.\n- Case $\\#3$ (mixed with coarse meshes): $L = 1000\\,\\mathrm{m}$, $u = 0.5\\,\\mathrm{m/s}$, $\\kappa = 0.5\\,\\mathrm{m^2/s}$, $m = 4$, $T = 1000\\,\\mathrm{s}$, $N$ sequence $[10,20,40,80,160]$.\n\nYour program must:\n- Initialize $\\bar{c}_i(0)$ to the exact cell average of the prescribed initial condition.\n- Advance the solution to $t=T$ using the specified FVM and time-stepping.\n- For each case, compute the error $E(\\Delta x)$ at each $N$ and the observed orders $p$ between successive grid sizes.\n- Produce a single line of output containing the results as a comma-separated list of lists, where each inner list corresponds to one case and contains the observed orders for that case in the order of successive refinements. For example, output of the form\n$[[p_{1,1},p_{1,2},p_{1,3},p_{1,4}],[p_{2,1},p_{2,2},p_{2,3},p_{2,4}],[p_{3,1},p_{3,2},p_{3,3},p_{3,4}]]$,\nwith each $p_{i,j}$ a floating-point number.\n\nAll angles (e.g., in trigonometric functions) are in radians. All physical inputs are in International System of Units (SI): $L$ in $\\mathrm{m}$, $u$ in $\\mathrm{m/s}$, $\\kappa$ in $\\mathrm{m^2/s}$, and $T$ in $\\mathrm{s}$. The final output observed orders are dimensionless floats. The study must be designed to reveal and measure the observed order of accuracy and to enable discussion of potential causes for non-asymptotic behavior on coarse meshes.",
            "solution": "The problem requires the implementation and analysis of a finite volume method (FVM) for the one-dimensional advection-diffusion equation. The analysis is to be performed via a grid refinement study to determine the observed order of accuracy of the numerical scheme.\n\nThe governing partial differential equation (PDE) for the concentration $c(x,t)$ is:\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0, \\quad \\text{where } F(c) = u\\,c - \\kappa\\,\\frac{\\partial c}{\\partial x}\n$$\nHere, $u$ is the constant advective velocity and $\\kappa$ is the constant diffusivity. The term $F(c)$ represents the total flux, composed of an advective part, $F^{\\text{adv}} = u\\,c$, and a diffusive part, $F^{\\text{diff}} = -\\kappa\\,\\frac{\\partial c}{\\partial x}$.\n\nWe discretize the spatial domain $[0, L]$ into $N$ uniform control volumes (cells), each of width $\\Delta x = L/N$. The cell centers are located at $x_i = (i+0.5)\\Delta x$ for $i = 0, 1, \\dots, N-1$. The FVM evolves the cell-averaged concentration, defined as:\n$$\n\\bar{c}_i(t) = \\frac{1}{\\Delta x} \\int_{x_i - \\Delta x/2}^{x_i + \\Delta x/2} c(x,t)\\,dx\n$$\nIntegrating the PDE over the $i$-th cell gives the exact evolution equation for the cell average:\n$$\n\\frac{d\\bar{c}_i}{dt} + \\frac{1}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right) = 0\n$$\nwhere $F_{i\\pm1/2}$ are the fluxes at the cell faces located at $x_{i\\pm1/2} = x_i \\pm \\Delta x/2$. We must approximate these face fluxes using the known cell-averaged values $\\bar{c}_j$.\n\nThe total flux at face $x_{i+1/2}$ is approximated as $F_{i+1/2} \\approx F^{\\text{adv}}_{i+1/2} + F^{\\text{diff}}_{i+1/2}$.\n1.  **Advective Flux ($F^{\\text{adv}}$)**: The problem specifies a first-order upwind scheme. For a velocity $u > 0$ (as is true for all test cases), the value of the tracer at the face is determined by the \"upwind\" cell, which is cell $i$. Thus, the advected quantity at the face is approximated by the cell average $\\bar{c}_i$.\n    $$\n    F^{\\text{adv}}_{i+1/2} = u\\,\\bar{c}_i\n    $$\n    This scheme is first-order accurate in space.\n\n2.  **Diffusive Flux ($F^{\\text{diff}}$)**: The problem specifies a second-order central difference approximation for the gradient at the face, using the adjacent cell averages:\n    $$\n    F^{\\text{diff}}_{i+1/2} = -\\kappa \\left( \\frac{\\partial c}{\\partial x} \\right)_{i+1/2} \\approx -\\kappa\\,\\frac{\\bar{c}_{i+1} - \\bar{c}_i}{\\Delta x}\n    $$\n    This scheme is second-order accurate.\n\nCombining these gives the total numerical flux at face $x_{i+1/2}$:\n$$\nF_{i+1/2} = u\\,\\bar{c}_i - \\kappa\\,\\frac{\\bar{c}_{i+1} - \\bar{c}_i}{\\Delta x}\n$$\nAnd similarly for the face at $x_{i-1/2}$:\n$$\nF_{i-1/2} = u\\,\\bar{c}_{i-1} - \\kappa\\,\\frac{\\bar{c}_{i} - \\bar{c}_{i-1}}{\\Delta x}\n$$\nSubstituting these into the semi-discrete FVM equation yields:\n$$\n\\frac{d\\bar{c}_i}{dt} = -\\frac{1}{\\Delta x} \\left( \\left(u\\,\\bar{c}_i - \\kappa\\,\\frac{\\bar{c}_{i+1} - \\bar{c}_i}{\\Delta x}\\right) - \\left(u\\,\\bar{c}_{i-1} - \\kappa\\,\\frac{\\bar{c}_{i} - \\bar{c}_{i-1}}{\\Delta x}\\right) \\right)\n$$\nRearranging terms gives the spatial discretization for the right-hand side (RHS) of the ordinary differential equation system for the $\\bar{c}_i$'s:\n$$\n\\frac{d\\bar{c}_i}{dt} = -u \\left(\\frac{\\bar{c}_i - \\bar{c}_{i-1}}{\\Delta x}\\right) + \\kappa \\left(\\frac{\\bar{c}_{i+1} - 2\\bar{c}_i + \\bar{c}_{i-1}}{\\Delta x^2}\\right)\n$$\nThe overall spatial accuracy of this scheme is determined by the lowest-order term, which is the first-order upwind advection. Thus, the spatial scheme is first-order accurate.\n\nFor time integration, the forward Euler method is specified. Denoting the solution at time step $n$ as $\\bar{c}_i^n$, the update is:\n$$\n\\frac{\\bar{c}_i^{n+1} - \\bar{c}_i^n}{\\Delta t} = -u \\left(\\frac{\\bar{c}_i^n - \\bar{c}_{i-1}^n}{\\Delta x}\\right) + \\kappa \\left(\\frac{\\bar{c}_{i+1}^n - 2\\bar{c}_i^n + \\bar{c}_{i-1}^n}{\\Delta x^2}\\right)\n$$\nThis is an explicit scheme. The time step $\\Delta t$ must be chosen to ensure stability. The problem prescribes a Courant-Friedrichs-Lewy (CFL)-like condition:\n$$\n\\Delta t = \\min\\left(c_a\\,\\frac{\\Delta x}{|u|}, \\; c_d\\,\\frac{\\Delta x^2}{\\kappa}\\right)\n$$\nwith $c_a = 0.5$ and $c_d = 0.25$. These values ensure that the coefficients of $\\bar{c}_i^n$, $\\bar{c}_{i-1}^n$, and $\\bar{c}_{i+1}^n$ in the rearranged update formula are non-negative, a sufficient condition for stability of this scheme. To reach the final time $T$ exactly, the number of steps is computed as $n_{\\text{steps}} = \\lceil T/\\Delta t \\rceil$, and the time step is adjusted to $\\Delta t = T/n_{\\text{steps}}$.\n\nThe initial condition for the numerical simulation must be the cell average of the continuous initial condition $c(x,0) = \\sin(kx)$. This is given by:\n$$\n\\bar{c}_i(0) = \\frac{1}{\\Delta x}\\int_{x_i-\\Delta x/2}^{x_i+\\Delta x/2} \\sin(kx)\\,dx = \\sin(kx_i)\\,\\frac{2\\sin(k\\Delta x/2)}{k\\Delta x}\n$$\nThe simulation is run for each specified grid resolution $N$. The final numerical solution $\\bar{c}_i(T)$ is compared against the exact cell-averaged solution $\\bar{c}_{\\text{exact},i}(T)$ to compute the RMS error $E(\\Delta x)$. The observed order of accuracy $p$ is then calculated from the errors of two successive resolutions, $E_{\\text{coarse}}$ and $E_{\\text{fine}}$, corresponding to grid spacings $\\Delta x_{\\text{coarse}}$ and $\\Delta x_{\\text{fine}}$ where $\\Delta x_{\\text{coarse}}/\\Delta x_{\\text{fine}} = 2$:\n$$\np = \\frac{\\log(E_{\\text{coarse}}/E_{\\text{fine}})}{\\log(\\Delta x_{\\text{coarse}}/\\Delta x_{\\text{fine}})} = \\frac{\\log(E_{\\text{coarse}}/E_{\\text{fine}})}{\\log(2)} = \\log_2(E_{\\text{coarse}}/E_{\\text{fine}})\n$$\nSince the numerical scheme is first-order accurate in both space and time (with $\\Delta t$ scaling with $\\Delta x$ or $\\Delta x^2$), we anticipate that the observed order $p$ will approach $1$ as the grid is refined. Deviations from this value on coarser grids can occur due to the influence of higher-order error terms or poor resolution of the solution features, as explored in Case $\\#3$ where the wavelength is short relative to the coarsest grid spacings.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef run_refinement_study(L, u, kappa, m, T, N_list):\n    \"\"\"\n    Performs a grid refinement study for a single test case.\n\n    Args:\n        L (float): Domain length.\n        u (float): Advective velocity.\n        kappa (float): Diffusivity.\n        m (int): Wavenumber index.\n        T (float): Final time.\n        N_list (list of int): Sequence of grid sizes for the study.\n\n    Returns:\n        list of float: The observed orders of accuracy between successive refinements.\n    \"\"\"\n    errors = []\n    \n    for N in N_list:\n        # Step 1: Set up the grid and parameters\n        dx = L / N\n        # Cell centers\n        x = np.arange(0.5, N, 1.0) * dx\n        k = 2.0 * np.pi * m / L\n\n        # Step 2: Set the initial condition (exact cell-averaged)\n        # The factor accounts for averaging sin(kx) over a cell width dx\n        # sinc(z) = sin(z)/z. This is sinc(k*dx/2) * sin(k*x_i)\n        sinc_factor = (2.0 * np.sin(k * dx / 2.0)) / (k * dx)\n        c0 = np.sin(k * x) * sinc_factor\n        \n        # Step 3: Set the time step\n        ca = 0.5\n        cd = 0.25\n        # The problem guarantees u != 0 and kappa != 0 for the given cases.\n        dt_ideal = min(ca * dx / abs(u), cd * dx**2 / kappa)\n        n_steps = math.ceil(T / dt_ideal)\n        dt = T / n_steps\n\n        # Step 4: Time integration using Forward Euler\n        c = c0.copy()\n        \n        for _ in range(n_steps):\n            # Handle periodic boundaries using np.roll\n            c_im1 = np.roll(c, 1) # c_{i-1}\n            c_ip1 = np.roll(c, -1) # c_{i+1}\n            \n            # Since u > 0 for all cases, advection is a backward difference\n            # d(c_i)/dt = -u * (c_i - c_{i-1}) / dx\n            advection_rhs = -u * (c - c_im1) / dx\n            \n            # Diffusion is a central difference\n            # d(c_i)/dt = kappa * (c_{i+1} - 2c_i + c_{i-1}) / dx^2\n            diffusion_rhs = kappa * (c_ip1 - 2.0 * c + c_im1) / (dx**2)\n            \n            # Update solution\n            c += dt * (advection_rhs + diffusion_rhs)\n            \n        # Step 5: Calculate the error\n        # Exact cell-averaged solution at time T\n        c_exact = np.exp(-kappa * k**2 * T) * np.sin(k * (x - u * T)) * sinc_factor\n        \n        # RMS error\n        error = np.sqrt(np.mean((c - c_exact)**2))\n        errors.append(error)\n        \n    # Step 6: Compute the observed order of accuracy\n    orders = []\n    for i in range(len(N_list) - 1):\n        # p = log(E_coarse / E_fine) / log(dx_coarse / dx_fine)\n        # Since dx_coarse / dx_fine = 2, this simplifies to log2(...)\n        order = np.log2(errors[i] / errors[i+1])\n        orders.append(order)\n        \n    return orders\n\ndef solve():\n    \"\"\"\n    Main solver function that runs all test cases and prints the final result.\n    \"\"\"\n    test_cases = [\n        # Case #1 (advection-dominated)\n        {'L': 1000.0, 'u': 0.5, 'kappa': 0.01, 'm': 1, 'T': 1000.0, 'N_list': [20, 40, 80, 160, 320]},\n        # Case #2 (diffusion-dominated)\n        {'L': 1000.0, 'u': 0.05, 'kappa': 5.0, 'm': 1, 'T': 1000.0, 'N_list': [20, 40, 80, 160, 320]},\n        # Case #3 (mixed with coarse meshes)\n        {'L': 1000.0, 'u': 0.5, 'kappa': 0.5, 'm': 4, 'T': 1000.0, 'N_list': [10, 20, 40, 80, 160]},\n    ]\n    \n    all_results = []\n    for case in test_cases:\n        orders = run_refinement_study(\n            case['L'],\n            case['u'],\n            case['kappa'],\n            case['m'],\n            case['T'],\n            case['N_list']\n        )\n        all_results.append(orders)\n\n    # Format the final output string as specified\n    # e.g., [[p1,p2,p3],[q1,q2,q3],...]\n    output_str = '[' + ','.join([str(res) for res in all_results]) + ']'\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "Finite volume methods for systems of hyperbolic equations, like the shallow water equations, require a deep understanding of how information propagates through the domain. This practice involves a \"hands-on\" theoretical derivation to uncover these propagation speeds by analyzing the underlying mathematical structure of the equations. By deriving the eigenvalues of the flux Jacobian, you will identify the characteristic wave speeds that govern the system and learn how these speeds directly inform the design of Godunov-type upwind fluxes, which are essential for creating stable and physically realistic simulations .",
            "id": "3795849",
            "problem": "You are modeling depth-averaged flow with the two-dimensional shallow water equations in a coastal shelf model using a finite volume method (FVM). Consider a single planar cell face with unit normal $\\hat{\\boldsymbol{n}} = (n_x, n_y)$ pointing from a left cell to a right cell. Let the conserved state be $\\boldsymbol{U} = [H, \\; H u, \\; H v]^{\\mathsf{T}}$, where $H$ is the total water depth and $(u, v)$ are the depth-averaged velocity components. The gravitational acceleration is $g$, assumed constant. Ignore source terms associated with bathymetry variations, Coriolis force, and friction when computing the numerical flux across this face.\n\nStarting from the integral conservation laws and the hydrostatic pressure closure for the shallow water equations, derive the characteristic wave speeds associated with the face-normal Riemann problem by:\n- expressing the face-normal flux $\\boldsymbol{F}_n(\\boldsymbol{U})$ in a rotated basis aligned with the face normal, with variables $H$, the face-normal velocity $u_n = u n_x + v n_y$, and the face-tangential velocity $u_t = -u n_y + v n_x$,\n- writing the flux components in terms of the conserved variables $H$, $m_n = H u_n$, and $m_t = H u_t$,\n- linearizing the face-normal flux about a state with $H > 0$ and finite $u_n$, and\n- computing the eigenvalues of the resulting Jacobian restricted to the $\\{H, m_n\\}$ subsystem.\n\nExplain how the signs and magnitudes of these characteristic speeds inform upwinding decisions for a Godunov-type numerical flux in a finite volume method, including the cases where all waves move from left to right, all waves move from right to left, or waves straddle zero speed across the face.\n\nAnswer specification:\n- Provide the two face-normal characteristic speeds as a single closed-form analytic expression depending only on $g$, $H$, and $u_n$.\n- Write your final answer as a two-entry row vector $\\bigl[s_{-} \\; s_{+}\\bigr]$ using the LaTeX `pmatrix` environment.\n- Express the speeds in meters per second, but do not include units in your final boxed expression.\n- No numerical rounding is required.",
            "solution": "The problem requires the derivation of the characteristic wave speeds for the face-normal Riemann problem of the two-dimensional shallow water equations and an explanation of their role in constructing numerical fluxes for a finite volume method.\n\nThe two-dimensional shallow water equations in conservative form are given by:\n$$\n\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\frac{\\partial \\boldsymbol{F}_x}{\\partial x} + \\frac{\\partial \\boldsymbol{F}_y}{\\partial y} = \\boldsymbol{S}\n$$\nwhere $\\boldsymbol{U}$ is the vector of conserved variables, $\\boldsymbol{F}_x$ and $\\boldsymbol{F}_y$ are the flux vectors in the $x$ and $y$ directions respectively, and $\\boldsymbol{S}$ is a source term vector. The state and flux vectors are:\n$$\n\\boldsymbol{U} = \\begin{pmatrix} H \\\\ Hu \\\\ Hv \\end{pmatrix}, \\quad\n\\boldsymbol{F}_x = \\begin{pmatrix} Hu \\\\ Hu^2 + \\frac{1}{2}gH^2 \\\\ Huv \\end{pmatrix}, \\quad\n\\boldsymbol{F}_y = \\begin{pmatrix} Hv \\\\ Huv \\\\ Hv^2 + \\frac{1}{2}gH^2 \\end{pmatrix}\n$$\nHere, $H$ is the total water depth, $(u, v)$ are the depth-averaged velocity components, and $g$ is the gravitational acceleration.\n\nFor a finite volume method, we consider the flux across a cell face with unit normal vector $\\hat{\\boldsymbol{n}} = (n_x, n_y)$. The face-normal flux, $\\boldsymbol{F}_n$, is the projection of the flux tensor onto this normal:\n$$\n\\boldsymbol{F}_n(\\boldsymbol{U}) = \\boldsymbol{F}_x n_x + \\boldsymbol{F}_y n_y = \\begin{pmatrix} Hu \\\\ Hu^2 + \\frac{1}{2}gH^2 \\\\ Huv \\end{pmatrix} n_x + \\begin{pmatrix} Hv \\\\ Huv \\\\ Hv^2 + \\frac{1}{2}gH^2 \\end{pmatrix} n_y\n$$\n$$\n\\boldsymbol{F}_n(\\boldsymbol{U}) = \\begin{pmatrix}\nH(u n_x + v n_y) \\\\\nHu(u n_x + v n_y) + \\frac{1}{2}gH^2 n_x \\\\\nHv(u n_x + v n_y) + \\frac{1}{2}gH^2 n_y\n\\end{pmatrix}\n$$\nWe define the face-normal velocity $u_n = u n_x + v n_y$ and the face-tangential velocity $u_t = -u n_y + v n_x$. Inverting this rotation gives $u = u_n n_x - u_t n_y$ and $v = u_n n_y + u_t n_x$.\n\nThe analysis is simplified by rotating the momentum equations into a basis aligned with the face. We define a rotated state vector $\\boldsymbol{U}_{rot} = [H, m_n, m_t]^{\\mathsf{T}}$, where $m_n = H u_n$ is the face-normal momentum and $m_t = H u_t$ is the face-tangential momentum. The flux vector corresponding to this rotated state vector is $\\boldsymbol{F}_{n, rot} = R \\boldsymbol{F}_n(\\boldsymbol{U})$, where $R$ is the rotation matrix for the state vector:\n$$\nR = \\begin{pmatrix} 1  0  0 \\\\ 0  n_x  n_y \\\\ 0  -n_y  n_x \\end{pmatrix}\n$$\nApplying this rotation to the flux vector $\\boldsymbol{F}_n$ expressed in terms of $u, v, H$:\n$$\n\\boldsymbol{F}_{n, rot} = \\begin{pmatrix} 1  0  0 \\\\ 0  n_x  n_y \\\\ 0  -n_y  n_x \\end{pmatrix} \\begin{pmatrix}\nH u_n \\\\\nH u u_n + \\frac{1}{2}gH^2 n_x \\\\\nH v u_n + \\frac{1}{2}gH^2 n_y\n\\end{pmatrix}\n$$\nThe components of the rotated flux vector are:\n1.  Mass flux: $H u_n = m_n$.\n2.  Normal momentum flux: $n_x(H u u_n + \\frac{1}{2}gH^2 n_x) + n_y(H v u_n + \\frac{1}{2}gH^2 n_y) = H u_n (u n_x + v n_y) + \\frac{1}{2}gH^2(n_x^2 + n_y^2) = H u_n^2 + \\frac{1}{2}gH^2$.\n3.  Tangential momentum flux: $-n_y(H u u_n + \\frac{1}{2}gH^2 n_x) + n_x(H v u_n + \\frac{1}{2}gH^2 n_y) = H u_n (-u n_y + v n_x) + \\frac{1}{2}gH^2(-n_y n_x + n_x n_y) = H u_n u_t$.\n\nWriting these flux components in terms of the conserved variables $H$, $m_n=Hu_n$, and $m_t=Hu_t$:\n$$\n\\boldsymbol{F}_{n, rot}(\\boldsymbol{U}_{rot}) = \\begin{pmatrix} m_n \\\\ \\frac{m_n^2}{H} + \\frac{1}{2}gH^2 \\\\ \\frac{m_n m_t}{H} \\end{pmatrix}\n$$\nThe characteristic wave speeds are the eigenvalues of the flux Jacobian matrix $A_{rot} = \\frac{\\partial \\boldsymbol{F}_{n, rot}}{\\partial \\boldsymbol{U}_{rot}}$. We compute the partial derivatives with respect to $\\boldsymbol{U}_{rot} = [H, m_n, m_t]^{\\mathsf{T}}$:\n$$\nA_{rot} = \\begin{pmatrix}\n\\frac{\\partial (m_n)}{\\partial H}  \\frac{\\partial (m_n)}{\\partial m_n}  \\frac{\\partial (m_n)}{\\partial m_t} \\\\\n\\frac{\\partial}{\\partial H}\\left(\\frac{m_n^2}{H} + \\frac{1}{2}gH^2\\right)  \\frac{\\partial}{\\partial m_n}\\left(\\frac{m_n^2}{H} + \\frac{1}{2}gH^2\\right)  \\frac{\\partial}{\\partial m_t}\\left(\\frac{m_n^2}{H} + \\frac{1}{2}gH^2\\right) \\\\\n\\frac{\\partial}{\\partial H}\\left(\\frac{m_n m_t}{H}\\right)  \\frac{\\partial}{\\partial m_n}\\left(\\frac{m_n m_t}{H}\\right)  \\frac{\\partial}{\\partial m_t}\\left(\\frac{m_n m_t}{H}\\right)\n\\end{pmatrix}\n$$\nEvaluating the derivatives and expressing them in terms of primitive variables $H$, $u_n$, and $u_t$ for clarity:\n$$\nA_{rot} = \\begin{pmatrix}\n0  1  0 \\\\\n-\\frac{m_n^2}{H^2} + gH  \\frac{2m_n}{H}  0 \\\\\n-\\frac{m_n m_t}{H^2}  \\frac{m_t}{H}  \\frac{m_n}{H}\n\\end{pmatrix} = \\begin{pmatrix}\n0  1  0 \\\\\ngH - u_n^2  2u_n  0 \\\\\n-u_n u_t  u_t  u_n\n\\end{pmatrix}\n$$\nThe problem asks for the eigenvalues of the Jacobian restricted to the $\\{H, m_n\\}$ subsystem. This corresponds to the $2 \\times 2$ upper-left block of the full Jacobian, as the equations for $H$ and $m_n$ are independent of $m_t$. Let this sub-matrix be $A_{sub}$:\n$$\nA_{sub} = \\begin{pmatrix}\n0  1 \\\\\ngH - u_n^2  2u_n\n\\end{pmatrix}\n$$\nThe eigenvalues $\\lambda$ are found by solving the characteristic equation $\\det(A_{sub} - \\lambda I) = 0$:\n$$\n\\det \\begin{pmatrix}\n-\\lambda  1 \\\\\ngH - u_n^2  2u_n - \\lambda\n\\end{pmatrix} = (-\\lambda)(2u_n - \\lambda) - (1)(gH - u_n^2) = 0\n$$\n$$\n-2u_n\\lambda + \\lambda^2 - gH + u_n^2 = 0\n$$\n$$\n\\lambda^2 - 2u_n\\lambda + (u_n^2 - gH) = 0\n$$\nUsing the quadratic formula to solve for $\\lambda$:\n$$\n\\lambda = \\frac{-(-2u_n) \\pm \\sqrt{(-2u_n)^2 - 4(1)(u_n^2 - gH)}}{2(1)} = \\frac{2u_n \\pm \\sqrt{4u_n^2 - 4u_n^2 + 4gH}}{2}\n$$\n$$\n\\lambda = \\frac{2u_n \\pm \\sqrt{4gH}}{2} = \\frac{2u_n \\pm 2\\sqrt{gH}}{2} = u_n \\pm \\sqrt{gH}\n$$\nThus, the two characteristic wave speeds associated with the $\\{H, m_n\\}$ subsystem are $s_{-} = u_n - \\sqrt{gH}$ and $s_{+} = u_n + \\sqrt{gH}$. These speeds represent the propagation of surface gravity waves, with speed $c = \\sqrt{gH}$, Doppler-shifted by the normal flow velocity $u_n$. The third eigenvalue of the full system is $\\lambda = u_n$, corresponding to the advection of tangential velocity.\n\nThese characteristic speeds are fundamental to Godunov-type finite volume methods. They determine the direction of information propagation in the solution to the local Riemann problem at a cell face, which dictates the upwinding strategy for the numerical flux $\\boldsymbol{F}^*$. Let's consider a face between a left cell (state $\\boldsymbol{U}_L$) and a right cell (state $\\boldsymbol{U}_R$), and evaluate the wave speeds at some relevant intermediate state (e.g., a Roe average).\n\n1.  **All waves move from left to right:** This occurs in right-moving supercritical flow, where $u_n > \\sqrt{gH}$. In this case, the slowest characteristic speed is positive: $s_{-} = u_n - \\sqrt{gH} > 0$. All information propagates from left to right. The state at the interface is determined solely by the left state $\\boldsymbol{U}_L$. The numerical flux is purely upwinded from the left: $\\boldsymbol{F}^* = \\boldsymbol{F}_n(\\boldsymbol{U}_L)$.\n\n2.  **All waves move from right to left:** This occurs in left-moving supercritical flow, where $u_n  -\\sqrt{gH}$. The fastest characteristic speed is negative: $s_{+} = u_n + \\sqrt{gH}  0$. All information propagates from right to left. The state at the interface is determined solely by the right state $\\boldsymbol{U}_R$. The numerical flux is purely upwinded from the right: $\\boldsymbol{F}^* = \\boldsymbol{F}_n(\\boldsymbol{U}_R)$.\n\n3.  **Waves straddle zero speed:** This occurs in subcritical flow, where $|u_n|  \\sqrt{gH}$. In this regime, $s_{-}  0$ and $s_{+} > 0$. Information propagates from both the left and right states towards the interface. The numerical flux must account for contributions from both $\\boldsymbol{U}_L$ and $\\boldsymbol{U}_R$. Schemes like Roe's or HLL/HLLC are designed for this case. For example, the diffusive term in a Roe solver, $\\frac{1}{2}\\sum_k |\\bar{\\lambda}_k| \\Delta W_k \\bar{\\boldsymbol{r}}_k$, uses the absolute values of the characteristic speeds $|\\lambda_k|$ to scale the dissipation applied to each wave family, ensuring stability by adding dissipation only where needed and in the correct upwind-biased manner. The signs of the eigenvalues determine how the jump in state variables across the interface is decomposed into different wave contributions.\n\nIn conclusion, the signs of the characteristic speeds determine the upwind direction(s), while their magnitudes influence the numerical dissipation required for a stable and accurate scheme.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} u_n - \\sqrt{gH}  u_n + \\sqrt{gH} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Many real-world oceanographic problems involve a balance between physical forces, such as the balance between the pressure gradient and gravity over a sloping bathymetry. A robust numerical scheme must preserve these delicate equilibria. This exercise introduces the critical concept of a 'well-balanced' finite volume method by guiding you through the derivation of a numerical discretization that maintains a 'lake-at-rest' state exactly . Mastering this principle is fundamental to preventing spurious numerical currents and ensuring the long-term stability and accuracy of geophysical models.",
            "id": "3795793",
            "problem": "Consider the one-dimensional shallow water equations (SWE) with bathymetry for a horizontally uniform ocean channel, written in conservative form over a spatial coordinate $x$ as\n$$\n\\frac{\\partial h}{\\partial t} + \\frac{\\partial (h u)}{\\partial x} = 0, \\quad\n\\frac{\\partial (h u)}{\\partial t} + \\frac{\\partial \\left(h u^{2} + \\frac{1}{2} g h^{2}\\right)}{\\partial x} = - g h \\frac{\\partial H}{\\partial x},\n$$\nwhere $u(x,t)$ is the horizontal velocity, $\\eta(x,t)$ is the free-surface elevation, $H(x)$ is the bathymetry (positive downward), $h(x,t) = \\eta(x,t) - H(x)$ is the water depth, and $g$ is the constant gravitational acceleration. A lake-at-rest equilibrium is defined by $u(x,t) = 0$ and $\\eta(x,t) = \\eta_{\\ast}$ constant in space and time, with $h(x,t) = \\eta_{\\ast} - H(x)$ strictly positive (no dry states).\n\nLet the domain be partitioned into uniform finite volumes with cell centers at $x_{i}$ and cell faces at $x_{i \\pm \\frac{1}{2}}$, with cell width $\\Delta x$. Consider a Finite Volume Method (FVM) for the momentum equation in which the hydrostatic pressure gradient and the bathymetry source are discretized in a manner intended to preserve the lake-at-rest equilibrium. Assume a piecewise linear reconstruction that preserves constant free-surface elevation in equilibrium, so that the reconstructed face values satisfy $\\eta_{i \\pm \\frac{1}{2}} = \\eta_{\\ast}$ and $h_{i \\pm \\frac{1}{2}} = \\eta_{\\ast} - H_{i \\pm \\frac{1}{2}}$, with $H_{i \\pm \\frac{1}{2}}$ defined by any consistent second-order face averaging of $H$.\n\nStarting from the governing equations and first principles, derive a well-balanced discrete balance at the cell level that makes the lake-at-rest state an exact discrete equilibrium. Specifically, work with the identity that relates the hydrostatic pressure gradient and the bathymetry slope to the free-surface gradient, and use it to define a discrete hydrostatic pressure flux gradient term and a discrete bathymetry source term that cancel in equilibrium. Let the cell-centered depth be $h_{i} = \\eta_{\\ast} - H_{i}$. Define the cell momentum residual $R_{i}$ as the sum of the discrete hydrostatic pressure flux gradient and the discrete bathymetry source, both taken on the left-hand side of the semidiscrete finite volume balance.\n\nUnder the lake-at-rest assumptions stated above, compute the dimensionless normalized residual\n$$\nR_{i}^{\\mathrm{norm}} = \\frac{R_{i}}{(g h_{i})/\\Delta x},\n$$\nfor any cell $i$. Provide the exact value of $R_{i}^{\\mathrm{norm}}$ as your final answer. No rounding is required. If you introduce any auxiliary quantities, express them in terms of $h_{i}$, $H_{i \\pm \\frac{1}{2}}$, and $\\eta_{\\ast}$ to maintain physical interpretability.",
            "solution": "The one-dimensional shallow water momentum equation with bathymetry is given in conservative form as:\n$$\n\\frac{\\partial (h u)}{\\partial t} + \\frac{\\partial \\left(h u^{2} + \\frac{1}{2} g h^{2}\\right)}{\\partial x} = - g h \\frac{\\partial H}{\\partial x}\n$$\nTo analyze the hydrostatic balance, it is convenient to move all spatial derivative terms to one side:\n$$\n\\frac{\\partial (h u)}{\\partial t} + \\frac{\\partial (h u^{2})}{\\partial x} + \\frac{\\partial \\left(\\frac{1}{2} g h^{2}\\right)}{\\partial x} + g h \\frac{\\partial H}{\\partial x} = 0\n$$\nThe terms responsible for the hydrostatic balance are the pressure gradient and the bathymetric source term, which are $\\frac{\\partial}{\\partial x} \\left(\\frac{1}{2} g h^{2}\\right)$ and $g h \\frac{\\partial H}{\\partial x}$, respectively. We can use the product rule on the pressure term, $\\frac{\\partial}{\\partial x} \\left(\\frac{1}{2} g h^{2}\\right) = g h \\frac{\\partial h}{\\partial x}$. The sum of these two terms is then:\n$$\ng h \\frac{\\partial h}{\\partial x} + g h \\frac{\\partial H}{\\partial x} = g h \\left(\\frac{\\partial h}{\\partial x} + \\frac{\\partial H}{\\partial x}\\right) = g h \\frac{\\partial (h+H)}{\\partial x}\n$$\nBy definition, the water surface elevation is $\\eta(x,t) = h(x,t) + H(x)$. Therefore, the sum of the hydrostatic pressure and bathymetry terms is equivalent to $g h \\frac{\\partial \\eta}{\\partial x}$.\nThe momentum equation can be rewritten as:\n$$\n\\frac{\\partial (h u)}{\\partial t} + \\frac{\\partial (h u^{2})}{\\partial x} + g h \\frac{\\partial \\eta}{\\partial x} = 0\n$$\nA lake-at-rest is defined by the conditions $u(x,t) = 0$ and $\\eta(x,t) = \\eta_{\\ast}$, where $\\eta_{\\ast}$ is a constant. In this state, $\\frac{\\partial \\eta}{\\partial x} = 0$, and the momentum equation simplifies to $0=0$. This demonstrates that the continuous equations inherently preserve the lake-at-rest state, as the hydrostatic pressure gradient and the bathymetric source term exactly balance.\n\nA Finite Volume Method (FVM) must replicate this balance discretely to be considered \"well-balanced\". We integrate the momentum equation over a finite volume cell $i$, from $x_{i-\\frac{1}{2}}$ to $x_{i+\\frac{1}{2}}$:\n$$\n\\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} \\left( \\frac{\\partial (h u)}{\\partial t} + \\frac{\\partial (h u^{2})}{\\partial x} + \\frac{\\partial \\left(\\frac{1}{2} g h^{2}\\right)}{\\partial x} + g h \\frac{\\partial H}{\\partial x} \\right) dx = 0\n$$\nApplying the integral and dividing by the cell width $\\Delta x = x_{i+\\frac{1}{2}} - x_{i-\\frac{1}{2}}$ yields the semi-discrete form:\n$$\n\\frac{d (h_i u_i)}{dt} + \\frac{F_{adv, i+\\frac{1}{2}} - F_{adv, i-\\frac{1}{2}}}{\\Delta x} + \\frac{F_{p, i+\\frac{1}{2}} - F_{p, i-\\frac{1}{2}}}{\\Delta x} + S_{b,i} = 0\n$$\nwhere $h_i$ and $u_i$ are cell-averaged quantities, $F_{adv} = hu^2$ is the advective flux, $F_p = \\frac{1}{2} g h^2$ is the hydrostatic pressure flux, and $S_{b,i}$ is the discrete bathymetric source term, representing $\\frac{1}{\\Delta x} \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} g h \\frac{\\partial H}{\\partial x} dx$.\n\nThe problem defines the cell momentum residual $R_i$ as the sum of the discrete hydrostatic pressure flux gradient and the discrete bathymetry source term, evaluated at the lake-at-rest equilibrium. The discrete pressure gradient is:\n$$\nP_i = \\frac{F_{p, i+\\frac{1}{2}} - F_{p, i-\\frac{1}{2}}}{\\Delta x} = \\frac{1}{\\Delta x} \\left( \\frac{1}{2} g h_{i+\\frac{1}{2}}^2 - \\frac{1}{2} g h_{i-\\frac{1}{2}}^2 \\right)\n$$\nThe residual is thus $R_i = P_i + S_{b,i}$ under the conditions $u=0$ and $\\eta=\\eta_{\\ast}$.\n\nA well-balanced scheme is specifically constructed such that this residual is zero. To demonstrate this, we must define $S_{b,i}$ in a way that achieves this cancellation. A common well-balanced discretization for the source term, consistent with a piecewise linear reconstruction, is:\n$$\nS_{b,i} = \\frac{g}{2 \\Delta x} \\left( (h_i + h_{i+\\frac{1}{2}})(H_{i+\\frac{1}{2}} - H_i) + (h_i + h_{i-\\frac{1}{2}})(H_i - H_{i-\\frac{1}{2}}) \\right)\n$$\nWe now evaluate $R_i$ for a lake-at-rest. The problem states that the reconstruction yields face values $h_{i \\pm \\frac{1}{2}} = \\eta_{\\ast} - H_{i \\pm \\frac{1}{2}}$, and we have the cell-centered value $h_i = \\eta_{\\ast} - H_i$.\n\nFirst, we evaluate the pressure term $P_i$:\n$$\nP_i = \\frac{g}{2 \\Delta x} \\left( (\\eta_{\\ast} - H_{i+\\frac{1}{2}})^2 - (\\eta_{\\ast} - H_{i-\\frac{1}{2}})^2 \\right)\n$$\n$$\nP_i = \\frac{g}{2 \\Delta x} \\left( (\\eta_{\\ast}^2 - 2 \\eta_{\\ast} H_{i+\\frac{1}{2}} + H_{i+\\frac{1}{2}}^2) - (\\eta_{\\ast}^2 - 2 \\eta_{\\ast} H_{i-\\frac{1}{2}} + H_{i-\\frac{1}{2}}^2) \\right)\n$$\n$$\nP_i = \\frac{g}{2 \\Delta x} \\left( -2 \\eta_{\\ast} (H_{i+\\frac{1}{2}} - H_{i-\\frac{1}{2}}) + (H_{i+\\frac{1}{2}}^2 - H_{i-\\frac{1}{2}}^2) \\right)\n$$\nNext, we evaluate the source term $S_{b,i}$ using the lake-at-rest values:\n$$\nS_{b,i} = \\frac{g}{2 \\Delta x} \\left( ((\\eta_{\\ast}-H_i) + (\\eta_{\\ast}-H_{i+\\frac{1}{2}}))(H_{i+\\frac{1}{2}} - H_i) + ((\\eta_{\\ast}-H_i) + (\\eta_{\\ast}-H_{i-\\frac{1}{2}}))(H_i - H_{i-\\frac{1}{2}}) \\right)\n$$\n$$\nS_{b,i} = \\frac{g}{2 \\Delta x} \\left( (2\\eta_{\\ast} - H_i - H_{i+\\frac{1}{2}})(H_{i+\\frac{1}{2}} - H_i) + (2\\eta_{\\ast} - H_i - H_{i-\\frac{1}{2}})(H_i - H_{i-\\frac{1}{2}}) \\right)\n$$\nExpanding the products:\n$$\nS_{b,i} = \\frac{g}{2 \\Delta x} \\left( 2\\eta_{\\ast}(H_{i+\\frac{1}{2}} - H_i) - (H_{i+\\frac{1}{2}}^2 - H_i^2) + 2\\eta_{\\ast}(H_i - H_{i-\\frac{1}{2}}) - (H_i^2 - H_{i-\\frac{1}{2}}^2) \\right)\n$$\nThe terms involving $H_i$ and $H_i^2$ cancel out:\n$$\nS_{b,i} = \\frac{g}{2 \\Delta x} \\left( 2\\eta_{\\ast}(H_{i+\\frac{1}{2}} - H_{i-\\frac{1}{2}}) - (H_{i+\\frac{1}{2}}^2 - H_{i-\\frac{1}{2}}^2) \\right)\n$$\nThe residual $R_i$ is the sum $P_i + S_{b,i}$:\n$$\nR_i = \\frac{g}{2 \\Delta x} \\left[ \\left( -2 \\eta_{\\ast} (H_{i+\\frac{1}{2}} - H_{i-\\frac{1}{2}}) + (H_{i+\\frac{1}{2}}^2 - H_{i-\\frac{1}{2}}^2) \\right) + \\left( 2\\eta_{\\ast}(H_{i+\\frac{1}{2}} - H_{i-\\frac{1}{2}}) - (H_{i+\\frac{1}{2}}^2 - H_{i-\\frac{1}{2}}^2) \\right) \\right]\n$$\nAll terms in the square brackets cancel, leading to:\n$$\nR_i = 0\n$$\nThis derivation confirms that a FVM designed to be well-balanced for the lake-at-rest state, as specified in the problem, will by construction have a zero residual for the hydrostatic terms. The problem is a direct test of this fundamental principle.\n\nThe final step is to compute the dimensionless normalized residual $R_{i}^{\\mathrm{norm}}$:\n$$\nR_{i}^{\\mathrm{norm}} = \\frac{R_{i}}{(g h_{i})/\\Delta x}\n$$\nSince $R_i=0$ and the problem states that the water depth $h$ is strictly positive, the denominator $(g h_{i})/\\Delta x$ is a non-zero, finite value. Therefore, the normalized residual is:\n$$\nR_{i}^{\\mathrm{norm}} = \\frac{0}{(g h_{i})/\\Delta x} = 0\n$$",
            "answer": "$$\\boxed{0}$$"
        }
    ]
}