{
    "hands_on_practices": [
        {
            "introduction": "在有限元方法中，将控制方程的弱形式转化为离散的代数系统，其核心在于计算单元级别的矩阵。本练习将指导你完成一个基础但至关重要的任务：为一个二维标量扩散问题计算单元刚度矩阵。通过在一个典型的三角形单元上进行操作，你将实践使用等参映射处理非标准几何形状，并学习如何将诺伊曼边界条件（Neumann boundary conditions）整合到离散系统中 。这个实践是理解有限元法如何将连续物理问题转化为可解的线性方程组的基石。",
            "id": "3793132",
            "problem": "考虑一个与区域海洋建模相关的水平二维示踪剂扩散问题。设示踪剂场由 $T(x,y)$ 表示，考虑在一个三角形有限元上，扩散算子为 $-\\nabla \\cdot ( \\mathbf{K} \\nabla T )$，其中 $\\mathbf{K} \\in \\mathbb{R}^{2 \\times 2}$ 是一个常数、对称、正定的涡动扩散张量。单元内部的控制强形式偏微分方程 (PDE) 为 $-\\nabla \\cdot ( \\mathbf{K} \\nabla T ) = f$，并在与诺伊曼 (Neumann) 边界重合的单元边界段上服从诺伊曼边界条件 (NBC) $\\mathbf{n} \\cdot \\mathbf{K} \\nabla T = q$，其中 $\\mathbf{n}$ 是单位外法向量，$q$ 是给定的边界通量。\n\n你将使用带有线性拉格朗日 ($P_1$) 等参元的有限元法 (FEM)。设单元的物理节点坐标为 $(x_1,y_1) = (0,0)$、$(x_2,y_2) = (50000,0)$ 和 $(x_3,y_3) = (0,30000)$，所有长度单位为米。从具有局部坐标 $(\\xi,\\eta)$ 和形函数 $\\hat{N}_1(\\xi,\\eta) = 1 - \\xi - \\eta$、$\\hat{N}_2(\\xi,\\eta) = \\xi$、$\\hat{N}_3(\\xi,\\eta) = \\eta$ 的参考三角形到该单元的映射是等参映射：$x(\\xi,\\eta) = \\sum_{i=1}^{3} x_i \\hat{N}_i(\\xi,\\eta)$ 及 $y(\\xi,\\eta) = \\sum_{i=1}^{3} y_i \\hat{N}_i(\\xi,\\eta)$。扩散张量为\n$$\n\\mathbf{K} = \\begin{pmatrix}\n1000  & 200 \\\\\n200  & 800\n\\end{pmatrix},\n$$\n其各项单位为 $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$。\n\n任务：\n1. 从偏微分方程和诺伊曼边界条件 (NBC) 推导出的弱形式出发，并使用等参映射，推导单元级扩散刚度项 $a_{ij} = \\int_{T} \\nabla N_i^{\\top} \\mathbf{K} \\nabla N_j \\,\\mathrm{d}A$ 的表达式，其中 $N_i$ 是对应于节点 $i=1,2,3$ 的物理形函数。\n2. 对于给定的单元几何形状和 $\\mathbf{K}$，显式计算非对角项 $a_{12}$。\n3. 展示在节点 2 和 3 之间的直边上给定一个恒定通量 $q_0$ 时，诺伊曼边界积分贡献是如何在右侧项中组装的。将得到的边级载荷贡献 $b_2^{(e)}$ 和 $b_3^{(e)}$ 写成积分形式，并以闭合形式求值，用边长表示它们。\n\n请提供标量 $a_{12}$ 的最终数值作为你的答案。最终答案以 $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$ 为单位。给出精确值，不要四舍五入。",
            "solution": "**任务1：单元级刚度矩阵表达式的推导**\n\n控制偏微分方程 (PDE) 为\n$$\n-\\nabla \\cdot (\\mathbf{K} \\nabla T) = f\n$$\n有限元法的第一步是推导弱形式。我们将 PDE 乘以一个检验函数 $v$，并在单元域 $T_e$ 上积分。\n$$\n-\\int_{T_e} v \\left( \\nabla \\cdot (\\mathbf{K} \\nabla T) \\right) \\,\\mathrm{d}A = \\int_{T_e} v f \\,\\mathrm{d}A\n$$\n对左侧项应用分部积分（Green 第一恒等式）得到：\n$$\n\\int_{T_e} (\\nabla v)^{\\top} (\\mathbf{K} \\nabla T) \\,\\mathrm{d}A - \\int_{\\partial T_e} v (\\mathbf{n} \\cdot \\mathbf{K} \\nabla T) \\,\\mathrm{d}S = \\int_{T_e} v f \\,\\mathrm{d}A\n$$\n其中 $\\partial T_e$ 是单元的边界，$\\mathbf{n}$ 是单位外法向量。项 $\\mathbf{n} \\cdot \\mathbf{K} \\nabla T$ 表示穿过边界的扩散通量。对于指定了诺伊曼条件的边界段，该项等于给定的通量 $q$。\n$$\n\\int_{T_e} (\\nabla v)^{\\top} (\\mathbf{K} \\nabla T) \\,\\mathrm{d}A = \\int_{T_e} v f \\,\\mathrm{d}A + \\int_{\\partial T_e} v q \\,\\mathrm{d}S\n$$\n在伽辽金 (Galerkin) 有限元法中，未知场 $T$ 和检验函数 $v$ 使用同一组形函数 $N_i(x,y)$ 进行近似。对于一个 $P_1$ 三角形单元，近似为 $T(x,y) \\approx T_h(x,y) = \\sum_{j=1}^{3} T_j N_j(x,y)$，其中 $T_j$ 是节点值。我们选择检验函数 $v$ 为其中一个形函数，即 $v = N_i(x,y)$。\n\n将这些代入弱形式，得到线性方程组 $\\mathbf{A}\\mathbf{T} = \\mathbf{b}$，其中单元刚度矩阵 $\\mathbf{A}$ 的各项由下式给出：\n$$\na_{ij} = \\int_{T_e} (\\nabla N_i)^{\\top} \\mathbf{K} (\\nabla N_j) \\,\\mathrm{d}A\n$$\n这就是所要求的表达式。为了计算，我们将此积分映射到具有局部坐标 $(\\xi, \\eta)$ 的参考单元上。物理坐标 $(x,y)$ 由等参映射给出：\n$$\nx(\\xi,\\eta) = \\sum_{k=1}^{3} x_k \\hat{N}_k(\\xi,\\eta), \\quad y(\\xi,\\eta) = \\sum_{k=1}^{3} y_k \\hat{N}_k(\\xi,\\eta)\n$$\n其中 $\\hat{N}_k$ 是参考单元上的形函数。形函数的梯度通过映射的雅可比矩阵 $\\mathbf{J}$ 相关联：\n$$\n\\nabla N_j = \\begin{pmatrix} \\frac{\\partial N_j}{\\partial x} \\\\ \\frac{\\partial N_j}{\\partial y} \\end{pmatrix} = \\mathbf{J}^{-1} \\hat{\\nabla} \\hat{N}_j = \\mathbf{J}^{-1} \\begin{pmatrix} \\frac{\\partial \\hat{N}_j}{\\partial \\xi} \\\\ \\frac{\\partial \\hat{N}_j}{\\partial \\eta} \\end{pmatrix}\n$$\n雅可比矩阵由 $\\mathbf{J} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi}  & \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta}  & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix}$ 给出。对于线性等参单元，$\\mathbf{J}$ 是常数。其各项为：\n$\\frac{\\partial x}{\\partial \\xi} = x_2-x_1$, $\\frac{\\partial y}{\\partial \\xi} = y_2-y_1$, $\\frac{\\partial x}{\\partial \\eta} = x_3-x_1$, $\\frac{\\partial y}{\\partial \\eta} = y_3-y_1$。\n使用给定的节点坐标 $(x_1,y_1)=(0,0)$、$(x_2,y_2)=(50000,0)$ 和 $(x_3,y_3)=(0,30000)$：\n$$\n\\mathbf{J} = \\begin{pmatrix} 50000 - 0  & 0 - 0 \\\\ 0 - 0  & 30000 - 0 \\end{pmatrix} = \\begin{pmatrix} 50000  & 0 \\\\ 0  & 30000 \\end{pmatrix}\n$$\n行列式为 $\\det(\\mathbf{J}) = 50000 \\times 30000 = 15 \\times 10^8$。微分面积元变换为 $\\mathrm{d}A = \\det(\\mathbf{J}) \\mathrm{d}\\xi \\mathrm{d}\\eta$。将此代入 $a_{ij}$ 的积分中：\n$$\na_{ij} = \\int_{\\hat{T}_e} (\\mathbf{J}^{-1} \\hat{\\nabla} \\hat{N}_i)^{\\top} \\mathbf{K} (\\mathbf{J}^{-1} \\hat{\\nabla} \\hat{N}_j) \\det(\\mathbf{J}) \\,\\mathrm{d}\\xi \\mathrm{d}\\eta\n$$\n对于 $P_1$ 单元，参考形函数的梯度 $\\hat{\\nabla} \\hat{N}_j$ 是常数向量。这意味着整个被积函数是常数。\n$$\n\\hat{\\nabla} \\hat{N}_1 = \\begin{pmatrix} -1 \\\\ -1 \\end{pmatrix}, \\quad \\hat{\\nabla} \\hat{N}_2 = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}, \\quad \\hat{\\nabla} \\hat{N}_3 = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}\n$$\n在参考单元上的积分是其面积，$\\int_{\\hat{T}_e} \\mathrm{d}\\xi \\mathrm{d}\\eta = \\frac{1}{2}$。\n因此，刚度项的表达式为：\n$$\na_{ij} = \\frac{1}{2}\\det(\\mathbf{J}) \\left( \\hat{\\nabla} \\hat{N}_i \\right)^{\\top} (\\mathbf{J}^{-1})^{\\top} \\mathbf{K} \\mathbf{J}^{-1} \\left( \\hat{\\nabla} \\hat{N}_j \\right)\n$$\n或者，我们可以首先计算物理空间中的梯度 $\\mathbf{B}_j = \\nabla N_j = \\mathbf{J}^{-1} \\hat{\\nabla} \\hat{N}_j$，这些梯度是常数。然后刚度矩阵为 $a_{ij} = A_e (\\mathbf{B}_i^\\top \\mathbf{K} \\mathbf{B}_j)$，其中 $A_e = \\frac{1}{2} \\det(\\mathbf{J})$ 是物理单元的面积。\n\n**任务2：刚度项 $a_{12}$ 的计算**\n\n我们首先计算物理梯度 $\\mathbf{B}_j = \\nabla N_j$。雅可比矩阵的逆为：\n$$\n\\mathbf{J}^{-1} = \\frac{1}{15 \\times 10^8} \\begin{pmatrix} 30000  & 0 \\\\ 0  & 50000 \\end{pmatrix} = \\begin{pmatrix} 1/50000  & 0 \\\\ 0  & 1/30000 \\end{pmatrix}\n$$\n现在我们计算 $\\mathbf{B}_1$ 和 $\\mathbf{B}_2$：\n$$\n\\mathbf{B}_1 = \\nabla N_1 = \\mathbf{J}^{-1} \\hat{\\nabla} \\hat{N}_1 = \\begin{pmatrix} 1/50000  & 0 \\\\ 0  & 1/30000 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} -1/50000 \\\\ -1/30000 \\end{pmatrix}\n$$\n$$\n\\mathbf{B}_2 = \\nabla N_2 = \\mathbf{J}^{-1} \\hat{\\nabla} \\hat{N}_2 = \\begin{pmatrix} 1/50000  & 0 \\\\ 0  & 1/30000 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1/50000 \\\\ 0 \\end{pmatrix}\n$$\n单元的面积是 $A_e = \\frac{1}{2} \\times \\text{底} \\times \\text{高} = \\frac{1}{2} \\times 50000 \\times 30000 = 7.5 \\times 10^8 \\,\\mathrm{m}^2$。\n刚度项 $a_{12}$ 由下式给出：\n$$\na_{12} = A_e (\\mathbf{B}_1^{\\top} \\mathbf{K} \\mathbf{B}_2)\n$$\n我们计算乘积 $\\mathbf{B}_1^{\\top} \\mathbf{K} \\mathbf{B}_2$：\n$$\n\\mathbf{K} \\mathbf{B}_2 = \\begin{pmatrix} 1000  & 200 \\\\ 200  & 800 \\end{pmatrix} \\begin{pmatrix} 1/50000 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1000/50000 \\\\ 200/50000 \\end{pmatrix} = \\begin{pmatrix} 1/50 \\\\ 1/250 \\end{pmatrix}\n$$\n$$\n\\mathbf{B}_1^{\\top} (\\mathbf{K} \\mathbf{B}_2) = \\begin{pmatrix} -1/50000  & -1/30000 \\end{pmatrix} \\begin{pmatrix} 1/50 \\\\ 1/250 \\end{pmatrix}\n$$\n$$\n= \\left( -\\frac{1}{50000} \\right) \\left( \\frac{1}{50} \\right) + \\left( -\\frac{1}{30000} \\right) \\left( \\frac{1}{250} \\right) = -\\frac{1}{25 \\times 10^5} - \\frac{1}{75 \\times 10^5}\n$$\n$$\n= -\\frac{3}{75 \\times 10^5} - \\frac{1}{75 \\times 10^5} = -\\frac{4}{75 \\times 10^5} = -\\frac{4}{7.5 \\times 10^6}\n$$\n最后，我们乘以面积 $A_e$：\n$$\na_{12} = (7.5 \\times 10^8) \\times \\left( -\\frac{4}{7.5 \\times 10^6} \\right) = -4 \\times \\frac{10^8}{10^6} = -4 \\times 10^2 = -400\n$$\n$a_{12}$ 的单位是 $(\\mathrm{m}^{-1})(\\mathrm{m}^2 \\mathrm{s}^{-1})(\\mathrm{m}^{-1})(\\mathrm{m}^2) = \\mathrm{m}^2 \\mathrm{s}^{-1}$。\n\n**任务3：诺伊曼边界条件贡献**\n\n诺伊曼边界条件对单元载荷向量 $\\mathbf{b}^{(e)}$ 的贡献来自弱形式中的边界积分 $\\int_{\\partial T_e} v q \\,\\mathrm{d}S$。当 $v=N_i$ 时，对载荷向量第 $i$ 项的贡献是 $b_i^{(e)} = \\int_{\\partial T_{e,N}} N_i q \\,\\mathrm{d}S$。\n在连接节点 2 和节点 3 的边上，给定了一个恒定通量 $q_0$。在这条边上，只有形函数 $N_2$ 和 $N_3$ 是非零的（$N_1=0$）。因此，贡献仅限于 $b_2^{(e)}$ 和 $b_3^{(e)}$：\n$$\nb_2^{(e)} = \\int_{\\text{edge 2-3}} N_2 q_0 \\,\\mathrm{d}S, \\qquad b_3^{(e)} = \\int_{\\text{edge 2-3}} N_3 q_0 \\,\\mathrm{d}S\n$$\n让我们用弧长 $l$ 来参数化直边 2-3，从节点 2 ($l=0$) 开始，到节点 3 ($l=L_{23}$) 结束。边的长度为：\n$$\nL_{23} = \\sqrt{(x_3 - x_2)^2 + (y_3 - y_2)^2} = \\sqrt{(0-50000)^2 + (30000-0)^2} = \\sqrt{25\\times 10^8 + 9\\times 10^8} = \\sqrt{34\\times 10^8} = 10000\\sqrt{34} \\, \\mathrm{m}\n$$\n沿这条边，线性形函数随参数 $l$ 线性变化：\n$$\nN_2(l) = 1 - \\frac{l}{L_{23}}, \\qquad N_3(l) = \\frac{l}{L_{23}}\n$$\n我们现在可以以闭合形式计算积分：\n$$\nb_2^{(e)} = \\int_0^{L_{23}} q_0 \\left(1 - \\frac{l}{L_{23}}\\right) \\mathrm{d}l = q_0 \\left[ l - \\frac{l^2}{2L_{23}} \\right]_0^{L_{23}} = q_0 \\left( L_{23} - \\frac{L_{23}^2}{2L_{23}} \\right) = \\frac{q_0 L_{23}}{2}\n$$\n$$\nb_3^{(e)} = \\int_0^{L_{23}} q_0 \\left(\\frac{l}{L_{23}}\\right) \\mathrm{d}l = q_0 \\left[ \\frac{l^2}{2L_{23}} \\right]_0^{L_{23}} = q_0 \\left( \\frac{L_{23}^2}{2L_{23}} \\right) = \\frac{q_0 L_{23}}{2}\n$$\n边上的总通量 $q_0 L_{23}$ 在该边的两个节点之间平均分配，这与线性单元的预期相符。",
            "answer": "$$\\boxed{-400}$$"
        },
        {
            "introduction": "有限元法不仅能求解稳态扩散等边界值问题，它在分析波动和模态结构方面同样强大。本练习将有限元法应用于一个经典的物理海洋学问题：确定一个两层流体中内波的相速度。你将首先推导描述垂直结构函数的斯图姆-刘维尔（Sturm-Liouville）特征值问题，然后使用一维线性元对其进行离散化求解 。通过这个过程，你将理解有限元法如何被用来求解物理模态，这是海洋模型中分析内波、垂直环流结构等现象的关键技术。",
            "id": "3793152",
            "problem": "考虑一个总深度为 $H = H_1 + H_2$ 的双层海洋，其上层厚度为 $H_1$，密度为 $\\rho_1$，下层厚度为 $H_2$，密度为 $\\rho_2$，且 $\\rho_2 > \\rho_1$。设垂直坐标为 $z$，向上为正，刚盖表面位于 $z=0$，平坦底部位于 $z=-H$，密度界面位于 $z=-H_1$。假设Boussinesq近似、静力近似、小振幅运动和长波极限。设 $g$ 表示重力加速度，并定义折合重力 $g' = g(\\rho_2 - \\rho_1)/\\rho_0$，其中 $\\rho_0$ 是一个恒定的参考密度。\n\n从静力、Boussinesq原始方程和内长波的标准分离变量法出发，推导在 $z=0$ 和 $z=-H$ 处齐次Dirichlet边界条件下的斜压垂直结构函数 $\\phi(z)$ 的适当弱（变分）形式。然后，在划分 $\\{-H, -H_1, 0\\}$ 上使用连续分段线性基函数构建一个垂直有限元法（FEM）近似空间，并施加本质边界条件，使得只有界面节点基函数保持活跃。组装得到的离散广义特征值问题，并将其简化为长波相速度 $c$ 的标量Rayleigh商。\n\n使用您的离散公式，为以下物理上合理的参数计算内长波相速度 $c$ 的数值：\n- $H_1 = 100 \\ \\mathrm{m}$，\n- $H_2 = 3900 \\ \\mathrm{m}$，\n- $\\rho_1 = 1024 \\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$，\n- $\\rho_2 = 1026 \\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$，\n- $\\rho_0 = 1025 \\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$，\n- $g = 9.81 \\ \\mathrm{m}\\,\\mathrm{s}^{-2}$。\n\n以 $\\mathrm{m}\\,\\mathrm{s}^{-1}$ 为单位表示最终速度，并将答案四舍五入到四位有效数字。您的最终答案必须是一个实数。",
            "solution": "小振幅内长波的垂直结构由一个Sturm-Liouville特征值问题控制。对于静力近似下的Boussinesq流体，压力扰动场 $p'(x,y,z,t) = P(x,y,t)\\phi(z)$ 的垂直结构函数 $\\phi(z)$ 满足以下方程：\n$$\n\\frac{d^2\\phi}{dz^2} + \\frac{N^2(z)}{c^2}\\phi(z) = 0\n$$\n其中 $c$ 是长波相速度（特征值），$N^2(z)$ 是Brunt-Väisälä频率的平方，定义为 $N^2(z) = -\\frac{g}{\\rho_0}\\frac{d\\bar{\\rho}}{dz}$。对于给定的密度为 $\\rho_1$ 和 $\\rho_2$ 且界面在 $z=-H_1$ 的双层流体，背景密度剖面 $\\bar{\\rho}(z)$ 是一个阶跃函数。其导数是一个Dirac delta函数：$\\frac{d\\bar{\\rho}}{dz} = -(\\rho_2 - \\rho_1)\\delta(z+H_1)$。\n因此，浮力频率为 $N^2(z) = \\frac{g(\\rho_2 - \\rho_1)}{\\rho_0}\\delta(z+H_1) = g'\\delta(z+H_1)$，其中 $g'$ 是折合重力。控制方程变为：\n$$\n\\frac{d^2\\phi}{dz^2} + \\frac{g'}{c^2}\\delta(z+H_1)\\phi(z) = 0\n$$\n该问题指定了齐次Dirichlet边界条件，对应于表面（$z=0$）的刚盖和底部（$z=-H$）的平坦刚性边界。对于斜压模态，垂直速度在这些边界上为零，这转化为对压力模态 $\\phi(z)$ 的条件：\n$$\n\\phi(0) = 0, \\quad \\phi(-H) = 0\n$$\n为推导弱（变分）形式，我们将控制方程乘以一个来自适当函数空间（此处为一阶导数平方可积且满足相同齐次边界条件的函数空间，$H_0^1([-H,0])$）的检验函数 $v(z)$，并在定义域 $z \\in [-H, 0]$ 上积分：\n$$\n\\int_{-H}^{0} v(z) \\frac{d^2\\phi}{dz^2} dz + \\int_{-H}^{0} v(z) \\frac{g'}{c^2}\\delta(z+H_1)\\phi(z) dz = 0\n$$\n对第一项进行分部积分：\n$$\n\\left[v(z)\\frac{d\\phi}{dz}\\right]_{-H}^{0} - \\int_{-H}^{0} \\frac{dv}{dz}\\frac{d\\phi}{dz} dz + \\frac{g'}{c^2} v(-H_1)\\phi(-H_1) = 0\n$$\n边界项 $\\left[v(z)\\frac{d\\phi}{dz}\\right]_{-H}^{0}$ 为零，因为检验函数 $v(z)$ 必须满足 $v(0)=0$ 和 $v(-H)=0$。重新整理方程得到弱形式：求 $\\phi \\in H_0^1([-H,0])$ 和特征值 $c^2$，使得对于所有 $v \\in H_0^1([-H,0])$，\n$$\n\\int_{-H}^{0} \\frac{d\\phi}{dz}\\frac{dv}{dz} dz = \\frac{g'}{c^2} \\phi(-H_1)v(-H_1)\n$$\n这是一个形式为 $a(\\phi, v) = \\lambda b(\\phi, v)$ 的广义特征值问题，其中 $\\lambda = 1/c^2$，$a(\\phi, v) = \\int \\phi'v' dz$，$b(\\phi, v) = g'\\phi(-H_1)v(-H_1)$。\n\n接下来，我们构建一个有限元法（FEM）近似。定义域由节点 $z_0 = -H$，$z_1 = -H_1$ 和 $z_2 = 0$ 划分。我们使用连续分段线性基函数（帽函数）$\\psi_j(z)$，使得 $\\psi_j(z_k) = \\delta_{jk}$。近似解 $\\phi_h(z)$ 写为这些基函数的线性组合：\n$$\n\\phi_h(z) = \\sum_{j=0}^{2} \\Phi_j \\psi_j(z)\n$$\n其中 $\\Phi_j = \\phi_h(z_j)$ 是节点值。通过将相应的节点值设为零来施加本质边界条件 $\\phi(0)=0$ 和 $\\phi(-H)=0$：$\\Phi_2=0$ 和 $\\Phi_0=0$。这只留下一个与界面节点 $z_1 = -H_1$ 相关联的活跃自由度 $\\Phi_1$。近似解变为：\n$$\n\\phi_h(z) = \\Phi_1 \\psi_1(z)\n$$\n基函数 $\\psi_1(z)$ 定义为：\n$$\n\\psi_1(z) = \\begin{cases} \\frac{z - z_0}{z_1 - z_0} = \\frac{z + H}{H_2}  & \\text{for } z \\in [-H, -H_1] \\\\ \\frac{z_2 - z}{z_2 - z_1} = \\frac{-z}{H_1}  & \\text{for } z \\in [-H_1, 0] \\end{cases}\n$$\n导数 $\\frac{d\\psi_1}{dz}$ 是分段常数：\n$$\n\\frac{d\\psi_1}{dz} = \\begin{cases} \\frac{1}{H_2}  & \\text{for } z \\in [-H, -H_1) \\\\ -\\frac{1}{H_1}  & \\text{for } z \\in (-H_1, 0] \\end{cases}\n$$\n我们将试探函数 $\\phi$ 的 $\\phi_h(z) = \\Phi_1 \\psi_1(z)$ 和检验函数 $v$ 的 $\\psi_1(z)$ 代入弱形式中。这产生一个 $1 \\times 1$ 的离散广义特征值问题 $K_{11} \\Phi_1 = \\frac{1}{c^2} M_{11} \\Phi_1$。\n刚度“矩阵”元 $K_{11}$ 是：\n$$\nK_{11} = \\int_{-H}^{0} \\left(\\frac{d\\psi_1}{dz}\\right)^2 dz = \\int_{-H}^{-H_1} \\left(\\frac{1}{H_2}\\right)^2 dz + \\int_{-H_1}^{0} \\left(-\\frac{1}{H_1}\\right)^2 dz\n$$\n$$\nK_{11} = \\frac{1}{H_2^2} (H_2) + \\frac{1}{H_1^2} (H_1) = \\frac{1}{H_2} + \\frac{1}{H_1}\n$$\n质量“矩阵”项 $M_{11}$ 从弱形式的右侧导出：$g' \\psi_1(-H_1) \\psi_1(-H_1)$。根据定义，$\\psi_1(-H_1) = 1$，所以：\n$$\nM_{11} = g'(1)^2 = g'\n$$\n离散特征值问题是 $(\\frac{1}{H_1} + \\frac{1}{H_2})\\Phi_1 = \\frac{g'}{c^2}\\Phi_1$。由于对于非平凡解 $\\Phi_1 \\neq 0$，我们可以消去它来求解 $c^2$：\n$$\n\\frac{1}{c^2} = \\frac{\\frac{1}{H_1} + \\frac{1}{H_2}}{g'} = \\frac{H_1 + H_2}{g'H_1 H_2}\n$$\n这给出了 $c^2$ 的Rayleigh商：\n$$\nc^2 = g' \\frac{H_1 H_2}{H_1 + H_2}\n$$\n这个结果与双层流体的精确解析解相同，因为真实的垂直结构函数是分段线性的，因此完全位于所选的有限元空间内。\n\n现在，我们使用给定的参数计算数值：\n$H_1 = 100 \\ \\mathrm{m}$\n$H_2 = 3900 \\ \\mathrm{m}$\n$\\rho_1 = 1024 \\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$\n$\\rho_2 = 1026 \\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$\n$\\rho_0 = 1025 \\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$\n$g = 9.81 \\ \\mathrm{m}\\,\\mathrm{s}^{-2}$\n\n首先，计算折合重力 $g'$：\n$$\ng' = g \\frac{\\rho_2 - \\rho_1}{\\rho_0} = 9.81 \\ \\mathrm{m}\\,\\mathrm{s}^{-2} \\times \\frac{1026 \\ \\mathrm{kg}\\,\\mathrm{m}^{-3} - 1024 \\ \\mathrm{kg}\\,\\mathrm{m}^{-3}}{1025 \\ \\mathrm{kg}\\,\\mathrm{m}^{-3}} = 9.81 \\times \\frac{2}{1025} \\ \\mathrm{m}\\,\\mathrm{s}^{-2}\n$$\n$$\ng' = \\frac{19.62}{1025} \\ \\mathrm{m}\\,\\mathrm{s}^{-2} \\approx 0.01914146 \\ \\mathrm{m}\\,\\mathrm{s}^{-2}\n$$\n接下来，计算等效深度项 $\\frac{H_1 H_2}{H_1 + H_2}$：\n$$\n\\frac{H_1 H_2}{H_1 + H_2} = \\frac{100 \\ \\mathrm{m} \\times 3900 \\ \\mathrm{m}}{100 \\ \\mathrm{m} + 3900 \\ \\mathrm{m}} = \\frac{390000}{4000} \\ \\mathrm{m} = 97.5 \\ \\mathrm{m}\n$$\n现在，计算 $c^2$：\n$$\nc^2 = g' \\frac{H_1 H_2}{H_1 + H_2} = \\left(\\frac{19.62}{1025} \\ \\mathrm{m}\\,\\mathrm{s}^{-2}\\right) \\times (97.5 \\ \\mathrm{m}) = \\frac{19.62 \\times 97.5}{1025} \\ \\mathrm{m^2}\\,\\mathrm{s}^{-2}\n$$\n$$\nc^2 = \\frac{1912.95}{1025} \\ \\mathrm{m^2}\\,\\mathrm{s}^{-2} \\approx 1.86629268 \\ \\mathrm{m^2}\\,\\mathrm{s}^{-2}\n$$\n最后，通过取平方根计算相速度 $c$：\n$$\nc = \\sqrt{1.86629268} \\ \\mathrm{m}\\,\\mathrm{s}^{-1} \\approx 1.36612323 \\ \\mathrm{m}\\,\\mathrm{s}^{-1}\n$$\n四舍五入到四位有效数字，内长波相速度为 $1.366 \\ \\mathrm{m}\\,\\mathrm{s}^{-1}$。",
            "answer": "$$\n\\boxed{1.366}\n$$"
        },
        {
            "introduction": "一个成功的海洋数值模型不仅需要能够稳定地求解方程，更重要的是，它必须能高保真地模拟物理过程，如波的传播。本练习将引导你深入分析一个用于求解线性浅水方程的有限元格式的动力学特性。你将结合空间上的有限元法和时间上的克兰克-尼科尔森（Crank-Nicolson）格式，并运用冯·诺伊曼（von Neumann）分析来推导数值频散关系 。这项实践将让你掌握评估数值方案性能的核心技能，理解模型中的波速如何依赖于网格分辨率和时间步长，这对于解释模型结果和改进模型设计至关重要。",
            "id": "3793162",
            "problem": "考虑在恒定深度 $\\,H\\,$ 上，关于自由表面高程 $\\,\\eta(x,t)\\,$ 和垂向平均速度 $\\,u(x,t)\\,$ 的一维线性化浅水方程 (LSWE)：\n$$\n\\frac{\\partial \\eta}{\\partial t} + H \\frac{\\partial u}{\\partial x} = 0, \n\\qquad\n\\frac{\\partial u}{\\partial t} + g \\frac{\\partial \\eta}{\\partial x} = 0,\n$$\n其中 $\\,g\\,$ 是重力加速度。设空间域是周期性的，并被间距为 $\\,h\\,$ 的均匀网格所覆盖。使用带有一致质量矩阵的标准连续分片线性有限元方法 (FEM) 在空间上进行离散。用 $\\,\\{\\phi_j(x)\\}\\,$ 表示节点基函数，用 $\\,\\boldsymbol{\\eta}(t)\\,$ 和 $\\,\\mathbf{u}(t)\\,$ 分别表示 $\\,\\eta\\,$ 和 $\\,u\\,$ 的节点系数向量，并将一致质量矩阵 $\\,M\\,$ 和梯度耦合矩阵 $\\,C\\,$ 定义为\n$$\nM_{ij} = \\int \\phi_i(x)\\,\\phi_j(x)\\,dx, \n\\qquad\nC_{ij} = \\int \\frac{d\\phi_i}{dx}(x)\\,\\phi_j(x)\\,dx.\n$$\n使用时间步长为 $\\,\\Delta t\\,$ 的 Crank–Nicolson (CN) 方法对得到的半离散系统进行时间离散。假设在均匀周期网格上有一个形式如下的 von Neumann (vN) 傅里叶模式\n$$\n\\eta_j^n = A\\,z^n \\exp(\\mathrm{i} j \\theta), \\qquad u_j^n = B\\,z^n \\exp(\\mathrm{i} j \\theta),\n$$\n其中 $\\,j\\,$ 是节点索引，$\\,\\theta = k h\\in (0,\\pi]\\,$ 是无量纲波数，$\\,n\\,$ 是时间层，$\\,z = \\exp(-\\mathrm{i}\\,\\omega\\,\\Delta t)\\,$ 是放大因子，$\\,\\omega\\,$ 是离散角频率，$\\,A\\,$ 和 $\\,B\\,$ 是复振幅，$\\,\\mathrm{i}\\,$ 是虚数单位。\n\n从控制方程以及所述的空间和时间离散化出发，推导全离散的二乘二模态系统，并获得连接 $\\,\\omega\\,$ 和 $\\,k\\,$ 的离散色散关系。通过连续 LSWE 色散关系定义精确的浅水相速度 $\\,c\\,$，并定义数值相速度 $\\,c_{\\text{num}} = \\omega/k\\,$。引入 Courant 数 $\\,\\sigma = \\sqrt{g H}\\,\\Delta t / h\\,$。通过消去所有中间变量，提供关于 $\\,\\sigma\\,$ 和 $\\,\\theta\\,$ 的比率 $\\,c_{\\text{num}}/c\\,$ 的最终闭式解析表达式。您的答案必须是单一的无单位解析表达式。不要进行四舍五入。",
            "solution": "### 解的推导\n\n**1. 使用 FEM 进行半离散化**\n\n我们使用连续分片线性基函数 $\\phi_j(x)$ 来近似场 $\\eta(x,t)$ 和 $u(x,t)$：\n$$\n\\eta(x,t) \\approx \\eta_h(x,t) = \\sum_j \\eta_j(t) \\phi_j(x), \\qquad u(x,t) \\approx u_h(x,t) = \\sum_j u_j(t) \\phi_j(x)\n$$\n我们将 Galerkin 方法应用于 LSWE。对于每个基函数 $\\phi_i(x)$，我们有：\n$$\n\\int \\phi_i \\left( \\frac{\\partial \\eta_h}{\\partial t} + H \\frac{\\partial u_h}{\\partial x} \\right) dx = 0 \\\\\n\\int \\phi_i \\left( \\frac{\\partial u_h}{\\partial t} + g \\frac{\\partial \\eta_h}{\\partial x} \\right) dx = 0\n$$\n通过对空间项进行分部积分并利用周期性，我们将此转化为半离散矩阵系统。对于连续体方程：\n$$\n\\sum_j \\left( \\int \\phi_i \\phi_j dx \\right) \\frac{d\\eta_j}{dt} + H \\sum_j \\left( \\int \\phi_i \\frac{d\\phi_j}{dx} dx \\right) u_j = 0\n$$\n这里，第二个积分项 $\\int \\phi_i (d\\phi_j/dx) dx$ 是 $C_{ji}$ 的转置，而不是 $C_{ij}$。标准的Galerkin方法得到对称的梯度算子，即 $\\int v (\\partial u / \\partial x) dx = - \\int (\\partial v / \\partial x) u dx$。因此，空间项变成 $H \\int \\phi_i \\frac{d u_h}{dx} dx = -H \\int \\frac{d\\phi_i}{dx} u_h dx = -H \\sum_j C_{ij} u_j$。\n因此，半离散系统是：\n$$\nM \\frac{d\\boldsymbol{\\eta}}{dt} + H C^T \\mathbf{u} = \\mathbf{0}, \\qquad M \\frac{d\\mathbf{u}}{dt} + g C^T \\boldsymbol{\\eta} = \\mathbf{0}\n$$\n但是，问题中定义的 $C_{ij} = \\int (d\\phi_i/dx) \\phi_j dx$ 是一个非对称矩阵。让我们遵循这个定义。因此，半离散系统是：\n$$\nM \\frac{d\\boldsymbol{\\eta}}{dt} = -H C^T \\mathbf{u}, \\qquad M \\frac{d\\mathbf{u}}{dt} = -g C^T \\boldsymbol{\\eta}\n$$\n*注意：在有限元文献中，刚度矩阵 $K_{ij} = \\int (d\\phi_i/dx)(d\\phi_j/dx) dx$ 更常见。这里的 $C$ 矩阵是一个对流矩阵。对于标准的中心差分，$\\int v (\\partial u/\\partial x) \\approx v_i (u_{i+1}-u_{i-1})/(2h)$。对于Galerkin，$\\int \\phi_i (\\partial u_h/\\partial x) dx$ 导致 $\\sum_j u_j \\int \\phi_i (d\\phi_j/dx) dx$。这个积分的模板是 $h/2 [-1, 0, 1]$，其傅里叶符号是 $i \\sin\\theta$。而问题中定义的 $C_{ij}$ 模板是 $1/2 [-1, 0, 1]$，其符号是 $i\\sin\\theta$（没有h）。我们将遵循问题定义，并假设 $C$ 的符号是 $i\\sin\\theta$。\n\n**2. 使用 Crank-Nicolson 进行全离散化**\n\n应用 Crank-Nicolson 格式：\n$$\nM \\frac{\\boldsymbol{\\eta}^{n+1} - \\boldsymbol{\\eta}^n}{\\Delta t} = -H C^T \\frac{\\mathbf{u}^{n+1} + \\mathbf{u}^n}{2} \\\\\nM \\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^n}{\\Delta t} = -g C^T \\frac{\\boldsymbol{\\eta}^{n+1} + \\boldsymbol{\\eta}^n}{2}\n$$\n重新排列，将时间层 $n+1$ 的项组合在左边，时间层 $n$ 的项在右边：\n$$\nM \\boldsymbol{\\eta}^{n+1} + \\frac{H \\Delta t}{2} C^T \\mathbf{u}^{n+1} = M \\boldsymbol{\\eta}^n - \\frac{H \\Delta t}{2} C^T \\mathbf{u}^n \\\\\nM \\mathbf{u}^{n+1} + \\frac{g \\Delta t}{2} C^T \\boldsymbol{\\eta}^{n+1} = M \\mathbf{u}^n - \\frac{g \\Delta t}{2} C^T \\boldsymbol{\\eta}^n\n$$\n\n**3. Von Neumann 分析**\n\n我们代入傅里叶模式假定 $\\boldsymbol{\\eta}^n = A z^n \\mathbf{v}$ 和 $\\mathbf{u}^n = B z^n \\mathbf{v}$，其中 $(\\mathbf{v})_j = \\exp(\\mathrm{i} j \\theta)$。矩阵 $M$ 和 $C^T$ 作为标量乘子作用于特征向量 $\\mathbf{v}$，其特征值（傅里叶符号）为 $\\hat{M}$ 和 $\\widehat{C^T}$。\n\n对于间距为 $h$ 的均匀网格上的分片线性基函数：\n-   质量矩阵 $M$ 的模板为 $h[\\frac{1}{6}, \\frac{4}{6}, \\frac{1}{6}]$。其特征值为：\n    $\\hat{M}(\\theta) = h (\\frac{1}{6} e^{-\\mathrm{i}\\theta} + \\frac{4}{6} + \\frac{1}{6} e^{\\mathrm{i}\\theta}) = \\frac{h}{3}(2+\\cos\\theta)$。\n-   $C_{ij} = \\int (d\\phi_i/dx)\\phi_j dx$ 的模板是 $[-1/2, 0, 1/2]$。其特征值为 $\\hat{C}(\\theta) = i\\sin\\theta$。\n-   $C^T$ 的特征值是 $\\hat{C}$ 的复共轭：$\\widehat{C^T}(\\theta) = -i\\sin\\theta$。\n\n将假定和特征值代入全离散系统，并除以 $z^n$：\n$$\n\\hat{M} z A + \\frac{H \\Delta t}{2} \\widehat{C^T} z B = \\hat{M} A - \\frac{H \\Delta t}{2} \\widehat{C^T} B \\\\\n\\hat{M} z B + \\frac{g \\Delta t}{2} \\widehat{C^T} z A = \\hat{M} B - \\frac{g \\Delta t}{2} \\widehat{C^T} A\n$$\n这是一个关于振幅 $A$ 和 $B$ 的 $2 \\times 2$ 线性系统：\n$$\n\\begin{pmatrix} \\hat{M}(z-1)  & \\frac{H \\Delta t}{2}\\widehat{C^T}(z+1) \\\\ \\frac{g \\Delta t}{2}\\widehat{C^T}(z+1)  & \\hat{M}(z-1) \\end{pmatrix} \\begin{pmatrix} A \\\\ B \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n对于非平凡解 $(A, B)$，矩阵的行列式必须为零：\n$$\n(\\hat{M}(z-1))^2 - \\left(\\frac{\\Delta t}{2}\\right)^2 gH (\\widehat{C^T}(z+1))^2 = 0\n$$\n$$\n(z-1)^2 \\hat{M}^2 = (z+1)^2 \\frac{gH (\\Delta t)^2}{4} (\\widehat{C^T})^2\n$$\n对两边取平方根：\n$$\n(z-1)\\hat{M} = \\pm (z+1) \\frac{\\sqrt{gH} \\Delta t}{2} \\widehat{C^T}\n$$\n求解放大因子 $z$：\n$$\nz \\left( \\hat{M} \\mp \\frac{\\sqrt{gH} \\Delta t}{2} \\widehat{C^T} \\right) = \\hat{M} \\pm \\frac{\\sqrt{gH} \\Delta t}{2} \\widehat{C^T} \\implies z = \\frac{\\hat{M} \\pm \\frac{\\sqrt{gH} \\Delta t}{2} \\widehat{C^T}}{\\hat{M} \\mp \\frac{\\sqrt{gH} \\Delta t}{2} \\widehat{C^T}}\n$$\n\n**4. 离散色散关系和相速度**\n\n代入特征值 $\\hat{M} = \\frac{h}{3}(2+\\cos\\theta)$ 和 $\\widehat{C^T} = -\\mathrm{i}\\sin\\theta$：\n$$\nz = \\frac{\\frac{h}{3}(2+\\cos\\theta) \\pm \\frac{\\sqrt{gH} \\Delta t}{2} (-\\mathrm{i}\\sin\\theta)}{\\frac{h}{3}(2+\\cos\\theta) \\mp \\frac{\\sqrt{gH} \\Delta t}{2} (-\\mathrm{i}\\sin\\theta)}\n$$\n使用 Courant 数 $\\sigma = \\frac{\\sqrt{gH} \\Delta t}{h}$，我们可以写出 $\\frac{\\sqrt{gH} \\Delta t}{2} = \\frac{\\sigma h}{2}$。\n$$\nz = \\frac{\\frac{h}{3}(2+\\cos\\theta) \\mp \\mathrm{i} \\frac{\\sigma h}{2} \\sin\\theta}{\\frac{h}{3}(2+\\cos\\theta) \\pm \\mathrm{i} \\frac{\\sigma h}{2} \\sin\\theta}\n$$\n设分子为 $X \\mp \\mathrm{i}Y$，分母为 $X \\pm \\mathrm{i}Y$。放大因子为 $z = \\exp(-\\mathrm{i}\\omega\\Delta t)$。模为 $|z|=1$，因此该格式是中性稳定的。$z$ 的相位是 $-\\omega\\Delta t$。\n复数 $\\frac{X-\\mathrm{i}Y}{X+\\mathrm{i}Y}$ 的相位是 $-2\\arctan(Y/X)$。取上方的符号（对应于其中一个波传播方向）：\n$$\n-\\omega \\Delta t = -2 \\arctan\\left(\\frac{\\frac{\\sigma h}{2}\\sin\\theta}{\\frac{h}{3}(2+\\cos\\theta)}\\right)\n$$\n因此，离散色散关系为：\n$$\n\\omega \\Delta t = 2 \\arctan\\left(\\frac{3 \\sigma \\sin\\theta}{2(2+\\cos\\theta)}\\right)\n$$\n数值相速度为 $c_{\\text{num}} = \\omega/k$。由连续 LSWE 得到的精确相速度为 $c = \\sqrt{gH}$。比率为：\n$$\n\\frac{c_{\\text{num}}}{c} = \\frac{\\omega/k}{\\sqrt{gH}} = \\frac{\\omega}{k\\sqrt{gH}}\n$$\n使用 $\\theta=kh$ 和 $\\sigma=\\frac{\\sqrt{gH}\\Delta t}{h}$，我们可以重写该比率：\n$$\n\\frac{c_{\\text{num}}}{c} = \\frac{\\omega \\Delta t}{k \\Delta t \\sqrt{gH}} = \\frac{\\omega \\Delta t}{(kh) \\frac{\\Delta t \\sqrt{gH}}{h}} = \\frac{\\omega \\Delta t}{\\theta \\sigma}\n$$\n代入 $\\omega \\Delta t$ 的表达式：\n$$\n\\frac{c_{\\text{num}}}{c} = \\frac{1}{\\sigma \\theta} \\left[ 2 \\arctan\\left(\\frac{3 \\sigma \\sin\\theta}{2(2+\\cos\\theta)}\\right) \\right]\n$$\n这就是数值相速度与精确相速度之比关于 Courant 数 $\\sigma$ 和无量纲波数 $\\theta$ 的最终表达式。\n最终表达式：\n$$\n\\frac{c_{\\text{num}}}{c} = \\frac{2}{\\sigma \\theta} \\arctan\\left(\\frac{3 \\sigma \\sin\\theta}{2(2+\\cos\\theta)}\\right)\n$$",
            "answer": "$$\n\\boxed{\\frac{2}{\\sigma \\theta} \\arctan\\left(\\frac{3 \\sigma \\sin\\theta}{2(2+\\cos\\theta)}\\right)}\n$$"
        }
    ]
}