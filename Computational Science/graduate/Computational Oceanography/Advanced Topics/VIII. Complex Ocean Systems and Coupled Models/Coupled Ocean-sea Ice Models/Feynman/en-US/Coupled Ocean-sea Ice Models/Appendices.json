{
    "hands_on_practices": [
        {
            "introduction": "A critical component of any sea ice model is its handling of incoming solar radiation, as this energy drives surface and internal melt, determining the ice's seasonal evolution. This first practice  provides a foundational exercise in modeling radiative transfer, asking you to implement a widely used two-stream model based on the Beer-Lambert Law. By doing so, you will partition incident shortwave radiation into its constituent reflected, absorbed, and transmitted fluxes, a core calculation in the sea ice energy budget.",
            "id": "3789166",
            "problem": "You are tasked with computing the partitioning of incident Shortwave Radiation (SWR) into three categories for a horizontally homogeneous sea ice slab over the ocean: surface reflection, absorption within ice, and transmission to the ocean. The sea ice is treated using a two-band spectral model (\"two-stream\" in the sense of two spectral streams) with distinct extinction coefficients. Your program must implement the partitioning for the specified test suite and produce the required outputs.\n\nThe physical setting is as follows. A downward SWR flux $F_0$ (in $\\mathrm{W\\,m^{-2}}$) is incident on the air-ice interface. A fraction $R_s$ (dimensionless) of $F_0$ is reflected at the surface due to optical properties of the air-ice interface (e.g., Fresnel reflection and immediate near-surface effects). The remaining fraction $(1 - R_s)$ enters the ice. Within the ice, the SWR is represented as two spectral streams with fractions $f_1$ and $f_2 = 1 - f_1$, each attenuated exponentially through the slab with extinction coefficients $k_1$ and $k_2$ (units $\\mathrm{m^{-1}}$) over thickness $H$ (in $\\mathrm{m}$). All radiation reaching the ice-ocean interface is assumed to transmit into the ocean, where it is absorbed without further reflection.\n\nYour derivation must start from physically grounded principles appropriate to computational oceanography and coupled ocean-sea ice models, specifically:\n- Energy conservation for radiative fluxes.\n- The Beer-Lambert Law (BLL) for attenuation in a homogeneous absorbing medium.\n\nBased on these principles, compute for each test case:\n- Surface reflection $F_{\\text{surf}}$ (in $\\mathrm{W\\,m^{-2}}$).\n- Absorption within ice $F_{\\text{abs}}$ (in $\\mathrm{W\\,m^{-2}}$).\n- Transmission to the ocean $F_{\\text{trans}}$ (in $\\mathrm{W\\,m^{-2}}$).\n\nYour program must process the following test suite with parameter sets $(F_0, H, R_s, f_1, k_1, k_2)$:\n1. Happy path: $(F_0 = 300\\,\\mathrm{W\\,m^{-2}}, H = 1.2\\,\\mathrm{m}, R_s = 0.06, f_1 = 0.55, k_1 = 1.2\\,\\mathrm{m^{-1}}, k_2 = 4.0\\,\\mathrm{m^{-1}})$.\n2. Boundary case (zero thickness): $(F_0 = 300\\,\\mathrm{W\\,m^{-2}}, H = 0.0\\,\\mathrm{m}, R_s = 0.06, f_1 = 0.55, k_1 = 1.2\\,\\mathrm{m^{-1}}, k_2 = 4.0\\,\\mathrm{m^{-1}})$.\n3. Edge case (very thick ice): $(F_0 = 300\\,\\mathrm{W\\,m^{-2}}, H = 5.0\\,\\mathrm{m}, R_s = 0.06, f_1 = 0.55, k_1 = 1.2\\,\\mathrm{m^{-1}}, k_2 = 4.0\\,\\mathrm{m^{-1}})$.\n4. Edge case (one non-attenuating stream): $(F_0 = 300\\,\\mathrm{W\\,m^{-2}}, H = 1.2\\,\\mathrm{m}, R_s = 0.06, f_1 = 0.30, k_1 = 0.0\\,\\mathrm{m^{-1}}, k_2 = 10.0\\,\\mathrm{m^{-1}})$.\n5. Edge case (high surface reflectance): $(F_0 = 300\\,\\mathrm{W\\,m^{-2}}, H = 1.2\\,\\mathrm{m}, R_s = 0.50, f_1 = 0.55, k_1 = 1.2\\,\\mathrm{m^{-1}}, k_2 = 4.0\\,\\mathrm{m^{-1}})$.\n\nAll outputs must be expressed in $\\mathrm{W\\,m^{-2}}$ as decimal floats with exactly six digits after the decimal. Your program should produce a single line of output containing the results as a comma-separated list of per-test-case triplets enclosed in square brackets, where each triplet is itself a bracketed comma-separated list in the order $[F_{\\text{surf}}, F_{\\text{abs}}, F_{\\text{trans}}]$. For example: $[[x_1,y_1,z_1],[x_2,y_2,z_2],\\dots]$.\n\nDo not read any input. Use the parameters provided above directly in your program. Ensure the computations follow from the specified principles, and ensure energy conservation such that $F_{\\text{surf}} + F_{\\text{abs}} + F_{\\text{trans}}$ equals $F_0$ within numerical tolerance.",
            "solution": "The problem has been validated and is deemed sound. It is scientifically grounded, well-posed, objective, and contains all necessary information for a unique and meaningful solution. The physical model, while simplified, is a standard representation used in computational oceanography and sea ice modeling.\n\nThe task is to compute the partitioning of incident Shortwave Radiation (SWR) into three components: surface reflection ($F_{\\text{surf}}$), absorption within the ice ($F_{\\text{abs}}$), and transmission to the ocean ($F_{\\text{trans}}$). The derivation will be based on the principles of energy conservation and the Beer-Lambert Law for radiative attenuation.\n\nLet $F_0$ be the downward SWR flux incident on the air-ice interface.\n\nStep 1: Surface Reflection\nThe problem states that a fraction $R_s$ of the incident flux is reflected at the surface. The total reflected flux, $F_{\\text{surf}}$, is therefore:\n$$\nF_{\\text{surf}} = R_s \\cdot F_0\n$$\nThis component of the radiation does not enter the ice slab.\n\nStep 2: Flux Entering the Ice\nBy energy conservation at the air-ice interface, the flux that is not reflected must penetrate the ice surface. Let this flux be $F_{\\text{in}}$.\n$$\nF_{\\text{in}} = F_0 - F_{\\text{surf}} = F_0 - R_s F_0 = (1 - R_s) F_0\n$$\n\nStep 3: Two-Band Spectral Attenuation\nThe problem specifies a two-band spectral model. The flux entering the ice, $F_{\\text{in}}$, is partitioned into two spectral streams.\n- The flux in the first stream at the surface ($z=0$) is $F_{1, \\text{in}} = f_1 \\cdot F_{\\text{in}}$.\n- The flux in the second stream at the surface ($z=0$) is $F_{2, \\text{in}} = f_2 \\cdot F_{\\text{in}} = (1 - f_1) F_{\\text{in}}$.\n\nEach stream is attenuated as it propagates through the ice of thickness $H$. The Beer-Lambert Law describes this exponential decay. The flux $F(z)$ at a depth $z$ for a stream with an extinction coefficient $k$ is given by $F(z) = F(0) e^{-kz}$, where $F(0)$ is the flux at the surface.\n\nThe flux of each stream that reaches the ice-ocean interface at depth $z=H$ is:\n- For the first stream: $F_{1, \\text{trans}}(H) = F_{1, \\text{in}} \\cdot e^{-k_1 H} = f_1 (1 - R_s) F_0 e^{-k_1 H}$.\n- For the second stream: $F_{2, \\text{trans}}(H) = F_{2, \\text{in}} \\cdot e^{-k_2 H} = (1 - f_1) (1 - R_s) F_0 e^{-k_2 H}$.\n\nStep 4: Transmission to the Ocean\nIt is stated that all radiation reaching the ice-ocean interface is transmitted into the ocean without further reflection. Therefore, the total transmitted flux, $F_{\\text{trans}}$, is the sum of the transmitted fluxes from both spectral streams.\n$$\nF_{\\text{trans}} = F_{1, \\text{trans}}(H) + F_{2, \\text{trans}}(H)\n$$\nSubstituting the expressions from Step 3:\n$$\nF_{\\text{trans}} = f_1 (1 - R_s) F_0 e^{-k_1 H} + (1 - f_1) (1 - R_s) F_0 e^{-k_2 H}\n$$\nFactoring out the common terms, we obtain the final expression for the transmitted flux:\n$$\nF_{\\text{trans}} = (1 - R_s) F_0 \\left[ f_1 e^{-k_1 H} + (1 - f_1) e^{-k_2 H} \\right]\n$$\n\nStep 5: Absorption within the Ice\nThe total incident flux must be conserved. It is either reflected, absorbed, or transmitted.\n$$\nF_0 = F_{\\text{surf}} + F_{\\text{abs}} + F_{\\text{trans}}\n$$\nWe can solve for the absorbed flux, $F_{\\text{abs}}$, by rearranging this conservation equation:\n$$\nF_{\\text{abs}} = F_0 - F_{\\text{surf}} - F_{\\text{trans}}\n$$\nThis approach ensures that the energy budget is closed by definition.\n\nAlternatively, we can calculate the absorbed flux directly as the difference between the energy that enters the ice and the energy that is transmitted through it:\n$$\nF_{\\text{abs}} = F_{\\text{in}} - F_{\\text{trans}}\n$$\nSubstituting the expressions for $F_{\\text{in}}$ and $F_{\\text{trans}}$:\n$$\nF_{\\text{abs}} = (1 - R_s) F_0 - (1 - R_s) F_0 \\left[ f_1 e^{-k_1 H} + (1 - f_1) e^{-k_2 H} \\right]\n$$\n$$\nF_{\\text{abs}} = (1 - R_s) F_0 \\left( 1 - \\left[ f_1 e^{-k_1 H} + (1 - f_1) e^{-k_2 H} \\right] \\right)\n$$\nBoth methods for calculating $F_{\\text{abs}}$ are equivalent and will yield the same numerical results, assuming floating-point arithmetic of sufficient precision. The numerical implementation will use the conservation of energy principle for its robustness.\n\nSummary of Formulas for Computation:\n1.  $F_{\\text{surf}} = R_s F_0$\n2.  $F_{\\text{trans}} = (1 - R_s) F_0 \\left[ f_1 e^{-k_1 H} + (1 - f_1) e^{-k_2 H} \\right]$\n3.  $F_{\\text{abs}} = F_0 - F_{\\text{surf}} - F_{\\text{trans}}$\n\nThese three formulas will be applied to each of the provided test cases to compute the required flux partitions.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the partitioning of incident Shortwave Radiation (SWR) for sea ice\n    into surface reflection, absorption within the ice, and transmission to the ocean.\n    The model is based on energy conservation and the Beer-Lambert Law for a\n    two-band spectral representation.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (F0, H, Rs, f1, k1, k2)\n    # F0: Incident SWR flux (W/m^2)\n    # H: Ice thickness (m)\n    # Rs: Surface reflectance (dimensionless)\n    # f1: Fraction of penetrating SWR in the first spectral band (dimensionless)\n    # k1: Extinction coefficient for the first band (1/m)\n    # k2: Extinction coefficient for the second band (1/m)\n    test_cases = [\n        # 1. Happy path\n        (300.0, 1.2, 0.06, 0.55, 1.2, 4.0),\n        # 2. Boundary case (zero thickness)\n        (300.0, 0.0, 0.06, 0.55, 1.2, 4.0),\n        # 3. Edge case (very thick ice)\n        (300.0, 5.0, 0.06, 0.55, 1.2, 4.0),\n        # 4. Edge case (one non-attenuating stream)\n        (300.0, 1.2, 0.06, 0.30, 0.0, 10.0),\n        # 5. Edge case (high surface reflectance)\n        (300.0, 1.2, 0.50, 0.55, 1.2, 4.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        F0, H, Rs, f1, k1, k2 = case\n        f2 = 1.0 - f1\n\n        # 1. Compute surface reflection (F_surf)\n        # Fraction Rs of the incident flux F0 is reflected at the surface.\n        F_surf = Rs * F0\n\n        # 2. Compute transmission to the ocean (F_trans)\n        # The remaining flux (1 - Rs)*F0 enters the ice and is partitioned into\n        # two streams, f1 and f2, which are attenuated exponentially according\n        # to the Beer-Lambert Law.\n        F_in = (1.0 - Rs) * F0\n        \n        # Calculate transmitted flux for each stream and sum them.\n        # F_trans_1 = F_in * f1 * exp(-k1 * H)\n        # F_trans_2 = F_in * f2 * exp(-k2 * H)\n        # F_trans = F_trans_1 + F_trans_2\n        F_trans = F_in * (f1 * np.exp(-k1 * H) + f2 * np.exp(-k2 * H))\n\n        # 3. Compute absorption within the ice (F_abs)\n        # By energy conservation, the total flux must be accounted for.\n        # F0 = F_surf + F_abs + F_trans\n        F_abs = F0 - F_surf - F_trans\n\n        # Store the triplet [F_surf, F_abs, F_trans]\n        # In the edge case of H=0, F_abs can be a very small negative number\n        # due to floating point inaccuracies, so we clip it at 0.\n        if abs(F_abs) < 1e-12:\n            F_abs = 0.0\n\n        results.append([F_surf, F_abs, F_trans])\n\n    # Format the final output string as specified.\n    # [[x1,y1,z1],[x2,y2,z2],...]\n    # Each number must have exactly six digits after the decimal point.\n    formatted_results = []\n    for res_triplet in results:\n        formatted_triplet = [f\"{val:.6f}\" for val in res_triplet]\n        formatted_results.append(f\"[{','.join(formatted_triplet)}]\")\n    \n    final_output = f\"[{','.join(formatted_results)}]\"\n\n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "While physical laws provide the blueprint for our models, their numerical implementation must be rigorously verified to ensure fidelity. A cornerstone of any geophysical model is the conservation of mass, especially during phase changes where numerical errors can easily accumulate. This exercise  guides you through the design of a crucial verification test, where you will confirm that the mass lost from a melting ice field precisely matches the freshwater flux entering the ocean, a fundamental check for any coupled model's integrity.",
            "id": "3789184",
            "problem": "You are asked to implement and verify mass conservation for freshwater in a coupled ocean–sea ice model under a controlled melting scenario. The verification must start from the statement of conservation of mass: the decrease in total sea ice mass must equal the freshwater flux into the ocean resulting from melting when no other sources or sinks are present. You must use a discrete representation of the sea ice field on a rectangular grid, with the following physically grounded assumptions: (i) all meltwater is added to the ocean as freshwater, (ii) no freezing, sublimation, or snow processes act during the test interval, (iii) sea ice density is constant, and (iv) the ice thickness does not become negative; complete melting is handled by limiting melt to the available thickness.\n\nLet the total sea ice mass at time $t$ be $M_i(t) = \\rho_i \\int_{\\Omega} A(x,y) H_i(x,y,t) \\,\\mathrm{d}A$, where $A(x,y)$ is the ice area fraction, $H_i(x,y,t)$ is the ice thickness, $\\rho_i$ is the ice density, and $\\Omega$ is the horizontal domain. Let the spatially uniform melt rate be $\\dot{m}$ in $\\mathrm{m}\\,\\mathrm{s}^{-1}$ applied for duration $\\Delta t$ in $\\mathrm{s}$. Over one time step, the melt thickness applied at each grid cell is $\\Delta H_m(x,y) = \\min\\left(H_i(x,y,t), \\dot{m}\\,\\Delta t\\right)$, and the post-melt thickness is $H_i(x,y,t+\\Delta t) = H_i(x,y,t) - \\Delta H_m(x,y)$. The integrated freshwater flux into the ocean over the time step, measured in $\\mathrm{kg}$, is defined as $Q_{\\mathrm{fw}} = \\rho_i \\int_{\\Omega} A(x,y) \\,\\Delta H_m(x,y) \\,\\mathrm{d}A$. Under the assumptions above, conservation of mass implies $M_i(t) - M_i(t+\\Delta t) = Q_{\\mathrm{fw}}$.\n\nYou must implement a program that constructs a set of test cases in which the ice melts completely (that is, $H_i(x,y,t+\\Delta t) = 0$ everywhere), computes $M_i(t)$, $M_i(t+\\Delta t)$, and $Q_{\\mathrm{fw}}$ using double-precision arithmetic, and evaluates whether the equality $M_i(t) - M_i(t+\\Delta t) = Q_{\\mathrm{fw}}$ holds to machine precision. For numerical robustness in summation, you should use a compensated summation method to reduce round-off error. You must report the relative error\n$$E_{\\mathrm{rel}} = \\frac{\\left|Q_{\\mathrm{fw}} - \\left(M_i(t) - M_i(t+\\Delta t)\\right)\\right|}{\\max\\left(M_i(t), 1\\right)}$$\nand declare the test successful if $E_{\\mathrm{rel}} \\le \\tau$, where $\\tau$ is a threshold representing machine precision. Use $\\tau = 512\\,\\epsilon$, where $\\epsilon$ is the machine epsilon for double precision.\n\nPhysical units and constants:\n- Sea ice density $\\rho_i$ is specified in $\\mathrm{kg}\\,\\mathrm{m}^{-3}$.\n- Ice thickness $H_i$ and melt thickness $\\Delta H_m$ are specified in $\\mathrm{m}$.\n- Time step $\\Delta t$ is specified in $\\mathrm{s}$.\n- Cell areas are specified in $\\mathrm{m}^2$.\n- The freshwater flux $Q_{\\mathrm{fw}}$ and the total mass $M_i$ are in $\\mathrm{kg}$.\n\nImplement the following test suite. In every case, ensure complete melting by using $\\dot{m}\\,\\Delta t$ larger than or equal to the maximum initial thickness. Use a fixed pseudorandom seed to make the fields deterministic.\n\n- Test case $1$ (general two-dimensional domain, constant cell area):\n  - Grid size: $64 \\times 64$.\n  - Grid cell size: $\\Delta x = 10{,}000\\,\\mathrm{m}$, $\\Delta y = 10{,}000\\,\\mathrm{m}$ (constant over the domain).\n  - Ice area fraction: $A(x,y) = 0.6$ (constant).\n  - Initial thickness: Uniformly distributed in $[0.1, 2.0]\\,\\mathrm{m}$.\n  - Sea ice density: $\\rho_i = 917\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$.\n  - Melt rate and time: $\\dot{m} = 3\\times 10^{-6}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $\\Delta t = 3\\times 10^{6}\\,\\mathrm{s}$.\n\n- Test case $2$ (spatially varying cell area and area fraction):\n  - Grid size: $32 \\times 32$.\n  - Grid cell sizes: $\\Delta x(i)$ linearly spaced from $5{,}000\\,\\mathrm{m}$ to $20{,}000\\,\\mathrm{m}$ along the $x$-direction, $\\Delta y(j)$ linearly spaced from $5{,}000\\,\\mathrm{m}$ to $20{,}000\\,\\mathrm{m}$ along the $y$-direction, so that the cell area is $\\Delta x(i)\\,\\Delta y(j)$.\n  - Ice area fraction: Uniformly distributed in $[0, 1]$.\n  - Initial thickness: Uniformly distributed in $[0.0, 2.0]\\,\\mathrm{m}$.\n  - Sea ice density: $\\rho_i = 917\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$.\n  - Melt rate and time: $\\dot{m} = 3\\times 10^{-6}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $\\Delta t = 3\\times 10^{6}\\,\\mathrm{s}$.\n\n- Test case $3$ (no initial ice):\n  - Grid size: $16 \\times 16$.\n  - Grid cell size: $\\Delta x = 10{,}000\\,\\mathrm{m}$, $\\Delta y = 10{,}000\\,\\mathrm{m}$.\n  - Ice area fraction: Uniformly distributed in $[0, 1]$.\n  - Initial thickness: Identically $0\\,\\mathrm{m}$.\n  - Sea ice density: $\\rho_i = 917\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$.\n  - Melt rate and time: $\\dot{m} = 3\\times 10^{-6}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $\\Delta t = 3\\times 10^{6}\\,\\mathrm{s}$.\n\n- Test case $4$ (thin new ice layer, structured area fraction):\n  - Grid size: $8 \\times 8$.\n  - Grid cell size: $\\Delta x = 10{,}000\\,\\mathrm{m}$, $\\Delta y = 10{,}000\\,\\mathrm{m}$.\n  - Ice area fraction: $A(i,j) = \\left(\\frac{i}{8}\\right)\\left(\\frac{j}{8}\\right)$ for indices $i=1,\\dots,8$, $j=1,\\dots,8$.\n  - Initial thickness: Uniformly distributed in $[0.005, 0.02]\\,\\mathrm{m}$.\n  - Sea ice density: $\\rho_i = 917\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$.\n  - Melt rate and time: $\\dot{m} = 3\\times 10^{-6}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $\\Delta t = 3\\times 10^{6}\\,\\mathrm{s}$.\n\nYour program must compute $M_i(t)$, $M_i(t+\\Delta t)$, $Q_{\\mathrm{fw}}$, and $E_{\\mathrm{rel}}$ for each test case, evaluate the condition $E_{\\mathrm{rel}} \\le \\tau$, and produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[r_1,r_2,r_3,r_4]$, where each $r_k$ is a boolean indicating whether the verification succeeded for test case $k$.",
            "solution": "The problem requires the numerical verification of the principle of mass conservation for freshwater in a coupled ocean-sea ice model. The verification is performed under a controlled scenario of complete sea ice melt. The core of the task is to implement the physical model in a discrete-grid context and to check if the numerically computed change in ice mass equals the numerically computed freshwater flux, within a tolerance defined by machine precision.\n\nThe physical principle is the conservation of mass. In the given context, with no sources or sinks other than melting, the decrease in the total mass of sea ice, $M_i$, over a time interval $\\Delta t$ must be equal to the total mass of freshwater, $Q_{\\mathrm{fw}}$, that flows into the ocean due to melting. This is expressed by the equation:\n$$M_i(t) - M_i(t+\\Delta t) = Q_{\\mathrm{fw}}$$\nThe problem provides the continuous integral definitions for the total ice mass and the freshwater flux. The total mass at a time $t$ is given by the integral of ice volume multiplied by density over the domain $\\Omega$:\n$$M_i(t) = \\rho_i \\int_{\\Omega} A(x,y) H_i(x,y,t) \\,\\mathrm{d}A$$\nHere, $\\rho_i$ is the constant sea ice density, $A(x,y)$ is the ice area fraction (concentration), and $H_i(x,y,t)$ is the ice thickness.\n\nThe simulation is performed on a discrete rectangular grid with indices $(i,j)$. The continuous integrals are therefore approximated by summations over all grid cells. The area element $\\mathrm{d}A$ becomes the discrete cell area $\\text{Area}_{ij} = \\Delta x_i \\Delta y_j$. The discretized form of the initial mass is:\n$$M_i(t) = \\sum_{i,j} \\rho_i \\cdot \\text{Area}_{ij} \\cdot A_{ij} \\cdot H_{i,ij}(t)$$\n\nThe melting process is modeled over a single time step of duration $\\Delta t$ with a uniform melt rate $\\dot{m}$. This defines a potential melt thickness $H_p = \\dot{m}\\Delta t$. The actual melt thickness in each cell, $\\Delta H_{m,ij}$, cannot exceed the ice thickness available in that cell. This is captured by the relation:\n$$\\Delta H_{m,ij} = \\min\\left(H_{i,ij}(t), H_p\\right)$$\nThe ice thickness after melting is:\n$$H_{i,ij}(t+\\Delta t) = H_{i,ij}(t) - \\Delta H_{m,ij}$$\nFrom this, the total mass at time $t+\\Delta t$ is computed as:\n$$M_i(t+\\Delta t) = \\sum_{i,j} \\rho_i \\cdot \\text{Area}_{ij} \\cdot A_{ij} \\cdot H_{i,ij}(t+\\Delta t)$$\nThe total freshwater flux into the ocean is the sum of mass melted from all cells:\n$$Q_{\\mathrm{fw}} = \\sum_{i,j} \\rho_i \\cdot \\text{Area}_{ij} \\cdot A_{ij} \\cdot \\Delta H_{m,ij}$$\n\nA key condition of the test cases is that melting is complete, i.e., $H_i(x,y,t+\\Delta t) = 0$ everywhere. This is ensured by choosing $H_p$ to be greater than the maximum possible initial ice thickness. Under this condition, $\\Delta H_{m,ij}$ simplifies to $H_{i,ij}(t)$ for all $(i,j)$, and consequently, $H_{i,ij}(t+\\Delta t)$ becomes $0$. This implies that the computed total mass $M_i(t+\\Delta t)$ will be $0$. The conservation equation then simplifies to verifying whether the computed $M_i(t)$ is equal to the computed $Q_{\\mathrm{fw}}$. Since $\\Delta H_{m,ij} = H_{i,ij}(t)$, the summations for $M_i(t)$ and $Q_{\\mathrm{fw}}$ are over identical sets of terms.\n$$M_i(t) = \\sum_{i,j} \\rho_i \\cdot \\text{Area}_{ij} \\cdot A_{ij} \\cdot H_{i,ij}(t)$$\n$$Q_{\\mathrm{fw}} = \\sum_{i,j} \\rho_i \\cdot \\text{Area}_{ij} \\cdot A_{ij} \\cdot \\Delta H_{m,ij} = \\sum_{i,j} \\rho_i \\cdot \\text{Area}_{ij} \\cdot A_{ij} \\cdot H_{i,ij}(t)$$\nThe verification thus becomes a test of numerical self-consistency.\n\nDue to the finite precision of floating-point arithmetic (double-precision, or $64$-bit, floats are used), summing a large number of values can lead to an accumulation of round-off errors. To mitigate this, the problem specifies the use of a compensated summation method. The Kahan summation algorithm is a standard choice for this purpose. It maintains a running compensation term, $c$, which accumulates the error lost in each addition. For each value $x$ to be added to the sum $s$:\n$1$. $y = x - c$ (Subtract the-prior error from the current term).\n$2$. $t = s + y$ (Add the corrected term to the sum; some low-order bits of $y$ may be lost).\n$3$. $c = (t - s) - y$ (The lost part is recovered and stored in $c$).\n$4$. $s = t$ (Update the sum).\nThis procedure ensures that the final sum is significantly more accurate than a naive summation.\n\nThe verification of the conservation law is performed by computing the relative error, $E_{\\mathrm{rel}}$:\n$$E_{\\mathrm{rel}} = \\frac{\\left|Q_{\\mathrm{fw}} - \\left(M_i(t) - M_i(t+\\Delta t)\\right)\\right|}{\\max\\left(M_i(t), 1\\right)}$\nThe use of $\\max(M_i(t), 1)$ in the denominator prevents division by zero or errors from a very small denominator, for instance in Test Case $3$ where the initial mass is zero. The test is considered successful if $E_{\\mathrm{rel}}$ is below a threshold $\\tau = 512\\epsilon$, where $\\epsilon$ is the machine epsilon for double-precision numbers. This tolerance allows for minute floating-point discrepancies that might arise even with compensated summation.\n\nThe implementation will proceed by constructing each of the four test cases. A fixed-seed pseudorandom number generator ensures the deterministic creation of ice thickness and area fraction fields. For each case, the algorithm will:\n$1$. Initialize the grid, parameters, and random fields.\n$2$. Calculate the per-cell values for initial mass, final mass, and freshwater flux.\n$3$. Sum these per-cell values using the Kahan-compensated summation algorithm to obtain the total quantities $M_i(t)$, $M_i(t+\\Delta t)$, and $Q_{\\mathrm{fw}}$.\n$4$. Compute $E_{\\mathrm{rel}}$ using these total quantities.\n$5$. Compare $E_{\\mathrm{rel}}$ with $\\tau$ to determine if the test passes.\nThe boolean results from all four tests are collected and printed in the specified format. Since the problem is constructed such that the quantities being compared are computed from identical terms, the numerical error is expected to be zero, and all tests should pass.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compensated_sum(arr: np.ndarray) -> float:\n    \"\"\"\n    Performs Kahan compensated summation on a numpy array.\n    This reduces numerical error compared to a naive sum.\n    \"\"\"\n    s = np.float64(0.0)\n    c = np.float64(0.0)\n    for x in arr.flatten():\n        y = np.float64(x) - c\n        t = s + y\n        c = (t - s) - y\n        s = t\n    return s\n\ndef solve():\n    \"\"\"\n    Implements and verifies mass conservation for freshwater in a coupled \n    ocean–sea ice model under four controlled melting scenarios.\n    \"\"\"\n    \n    # Common physical constants and parameters\n    rho_i = np.float64(917.0)  # Sea ice density in kg/m^3\n    m_dot = np.float64(3e-6)   # Melt rate in m/s\n    delta_t = np.float64(3e6)  # Time step in s\n    potential_melt_thickness = m_dot * delta_t # Potential melt thickness in m\n\n    # Use a fixed seed for reproducible random fields\n    rng = np.random.default_rng(12345)\n\n    # Machine precision for verification\n    epsilon = np.finfo(np.float64).eps\n    tau = np.float64(512.0) * epsilon\n\n    results = []\n\n    # --- Test Case 1: General 2D domain, constant cell area ---\n    nx, ny = 64, 64\n    cell_area = np.float64(10000.0) * np.float64(10000.0)\n    A_frac = np.full((nx, ny), 0.6, dtype=np.float64)\n    H_initial = rng.uniform(0.1, 2.0, size=(nx, ny)).astype(np.float64)\n    \n    delta_H_melt = np.minimum(H_initial, potential_melt_thickness)\n    H_final = H_initial - delta_H_melt\n    \n    mass_terms_initial = rho_i * cell_area * A_frac * H_initial\n    mass_terms_final = rho_i * cell_area * A_frac * H_final\n    flux_terms = rho_i * cell_area * A_frac * delta_H_melt\n    \n    M_i_t = compensated_sum(mass_terms_initial)\n    M_i_t_dt = compensated_sum(mass_terms_final)\n    Q_fw = compensated_sum(flux_terms)\n    \n    mass_decrease = M_i_t - M_i_t_dt\n    denominator = max(M_i_t, 1.0)\n    E_rel = abs(Q_fw - mass_decrease) / denominator\n    results.append(E_rel <= tau)\n\n    # --- Test Case 2: Spatially varying cell area and area fraction ---\n    nx, ny = 32, 32\n    dx = np.linspace(5000.0, 20000.0, nx, dtype=np.float64)\n    dy = np.linspace(5000.0, 20000.0, ny, dtype=np.float64)\n    cell_areas = np.outer(dx, dy)\n    A_frac = rng.uniform(0.0, 1.0, size=(nx, ny)).astype(np.float64)\n    H_initial = rng.uniform(0.0, 2.0, size=(nx, ny)).astype(np.float64)\n\n    delta_H_melt = np.minimum(H_initial, potential_melt_thickness)\n    H_final = H_initial - delta_H_melt\n\n    mass_terms_initial = rho_i * cell_areas * A_frac * H_initial\n    mass_terms_final = rho_i * cell_areas * A_frac * H_final\n    flux_terms = rho_i * cell_areas * A_frac * delta_H_melt\n\n    M_i_t = compensated_sum(mass_terms_initial)\n    M_i_t_dt = compensated_sum(mass_terms_final)\n    Q_fw = compensated_sum(flux_terms)\n\n    mass_decrease = M_i_t - M_i_t_dt\n    denominator = max(M_i_t, 1.0)\n    E_rel = abs(Q_fw - mass_decrease) / denominator\n    results.append(E_rel <= tau)\n\n    # --- Test Case 3: No initial ice ---\n    nx, ny = 16, 16\n    cell_area = np.float64(10000.0) * np.float64(10000.0)\n    A_frac = rng.uniform(0.0, 1.0, size=(nx, ny)).astype(np.float64)\n    H_initial = np.zeros((nx, ny), dtype=np.float64)\n\n    delta_H_melt = np.minimum(H_initial, potential_melt_thickness)\n    H_final = H_initial - delta_H_melt\n\n    mass_terms_initial = rho_i * cell_area * A_frac * H_initial\n    mass_terms_final = rho_i * cell_area * A_frac * H_final\n    flux_terms = rho_i * cell_area * A_frac * delta_H_melt\n\n    M_i_t = compensated_sum(mass_terms_initial)\n    M_i_t_dt = compensated_sum(mass_terms_final)\n    Q_fw = compensated_sum(flux_terms)\n\n    mass_decrease = M_i_t - M_i_t_dt\n    denominator = max(M_i_t, 1.0)\n    E_rel = abs(Q_fw - mass_decrease) / denominator\n    results.append(E_rel <= tau)\n\n    # --- Test Case 4: Thin new ice, structured area fraction ---\n    nx, ny = 8, 8\n    cell_area = np.float64(10000.0) * np.float64(10000.0)\n    i_indices = np.arange(1, nx + 1, dtype=np.float64).reshape(nx, 1)\n    j_indices = np.arange(1, ny + 1, dtype=np.float64).reshape(1, ny)\n    A_frac = (i_indices / np.float64(nx)) * (j_indices / np.float64(ny))\n    H_initial = rng.uniform(0.005, 0.02, size=(nx, ny)).astype(np.float64)\n    \n    delta_H_melt = np.minimum(H_initial, potential_melt_thickness)\n    H_final = H_initial - delta_H_melt\n\n    mass_terms_initial = rho_i * cell_area * A_frac * H_initial\n    mass_terms_final = rho_i * cell_area * A_frac * H_final\n    flux_terms = rho_i * cell_area * A_frac * delta_H_melt\n\n    M_i_t = compensated_sum(mass_terms_initial)\n    M_i_t_dt = compensated_sum(mass_terms_final)\n    Q_fw = compensated_sum(flux_terms)\n\n    mass_decrease = M_i_t - M_i_t_dt\n    denominator = max(M_i_t, 1.0)\n    E_rel = abs(Q_fw - mass_decrease) / denominator\n    results.append(E_rel <= tau)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having examined a key forcing and verified mass conservation, we now turn to the behavior of the coupled system as a whole. A robust climate model must conserve energy over long timescales to avoid unphysical drift, a common challenge in long-term simulations. In this final practice , you will test the thermodynamic stability of a simplified ocean-ice column model by subjecting it to an annual forcing cycle with zero net energy input, verifying that the system returns to its initial state and thus conserves energy over the full cycle.",
            "id": "3789204",
            "problem": "Consider a one-dimensional vertical column model that couples a well-mixed ocean layer and a sea ice layer through energy conservation and instantaneous phase equilibrium at the seawater freezing point. The column is forced by a prescribed analytic surface heat flux that is periodic over one year. The objective is to design the forcing such that the net annual energy input is zero and to verify, by numerical time stepping, that the coupled ocean-sea ice state returns to its initial condition within a specified numerical tolerance after exactly one year.\n\nAssumptions and definitions:\n- Let the mixed-layer ocean temperature be $T$ in degrees Celsius and the sea ice thickness be $H$ in meters. The seawater freezing point is $T_f = -1.8^\\circ\\text{C}$.\n- Define the column enthalpy relative to seawater at the freezing point as\n$$\nE = C_o \\left(T - T_f\\right) - L_i \\rho_i H\n$$\nwhere $C_o$ is the ocean mixed-layer heat capacity per unit area, $L_i$ is the latent heat of fusion of ice, and $\\rho_i$ is the density of ice. The constants are\n$$\n\\rho_w = 1025 \\ \\text{kg m}^{-3}, \\quad c_p = 3990 \\ \\text{J kg}^{-1} \\text{K}^{-1}, \\quad h = 50 \\ \\text{m},\n$$\n$$\nC_o = \\rho_w c_p h \\ \\text{J m}^{-2} \\text{K}^{-1}, \\quad L_i = 3.34 \\times 10^5 \\ \\text{J kg}^{-1}, \\quad \\rho_i = 917 \\ \\text{kg m}^{-3}.\n$$\nAll fluxes are in watts per square meter ($\\text{W m}^{-2}$), all times are in seconds, temperatures are in degrees Celsius, and thicknesses are in meters.\n\nGoverning law and coupling:\n- By the First Law of Thermodynamics applied to the column, the enthalpy $E$ evolves according to\n$$\n\\frac{dE}{dt} = F(t),\n$$\nwhere $F(t)$ is the externally prescribed net surface heat flux into the column (positive downward). The ocean-sea ice coupling is enforced by mapping the enthalpy back to the state $(T,H)$ at each time step under the constraints of instantaneous phase equilibrium:\n  - If $E \\ge 0$, then $H = 0$ and $T = T_f + E/C_o$.\n  - If $E < 0$, then $T = T_f$ and $H = -E/(L_i \\rho_i)$.\nThis mapping encodes freezing and melting: negative enthalpy corresponds to latent energy stored as ice thickness, and positive enthalpy corresponds to sensible heat in the ocean above the freezing point.\n\nAnalytic forcing cycle:\n- Let $T_{\\text{year}} = 365 \\times 86400$ seconds.\n- Use a zero-mean analytic forcing composed of harmonics of the annual cycle:\n$$\nF(t) = A \\sin\\left( \\frac{2\\pi t}{T_{\\text{year}}} \\right) + B \\sin\\left( \\frac{4\\pi t}{T_{\\text{year}}} \\right).\n$$\nBy construction, the integral of $F(t)$ over exactly one year is zero:\n$$\n\\int_0^{T_{\\text{year}}} F(t) \\, dt = 0.\n$$\n\nNumerical algorithm to be implemented:\n- Advance the system for exactly one year using the explicit midpoint rule with uniform step size $\\Delta t$ for full steps and a final partial step $\\Delta t_{\\text{rem}}$ to reach exactly $T_{\\text{year}}$ if $T_{\\text{year}}$ is not an integer multiple of $\\Delta t$.\n- At each step, compute the enthalpy increment $\\Delta E = F(t_{\\text{mid}}) \\Delta t$, where $t_{\\text{mid}}$ is the step midpoint. Update enthalpy $E \\leftarrow E + \\Delta E$, then map $(E)$ to $(T,H)$ using the coupling rules above.\n- After one year, compare the final $(T,H)$ to the initial $(T_0,H_0)$ and declare success if both $|T(T_{\\text{year}}) - T_0|$ and $|H(T_{\\text{year}}) - H_0|$ are strictly less than their specified tolerances.\n\nTest suite:\nImplement the program to run the following four test cases, each specified by the tuple $(T_0, H_0, A, B, \\Delta t, \\text{tol}_T, \\text{tol}_H)$ with units as defined above:\n1. Case $1$ (happy path with seasonal freeze and melt): $(T_0 = -1.0, H_0 = 0.0, A = 200.0, B = 50.0, \\Delta t = 3600.0, \\text{tol}_T = 1.0 \\times 10^{-4}, \\text{tol}_H = 1.0 \\times 10^{-5})$.\n2. Case $2$ (always ice; small amplitude): $(T_0 = -1.8, H_0 = 1.0, A = 20.0, B = 0.0, \\Delta t = 3600.0, \\text{tol}_T = 1.0 \\times 10^{-4}, \\text{tol}_H = 1.0 \\times 10^{-5})$.\n3. Case $3$ (coarse time step edge case): $(T_0 = -1.0, H_0 = 0.0, A = 200.0, B = 50.0, \\Delta t = 604800.0, \\text{tol}_T = 1.0 \\times 10^{-4}, \\text{tol}_H = 1.0 \\times 10^{-5})$.\n4. Case $4$ (zero forcing amplitude): $(T_0 = -1.2, H_0 = 0.2, A = 0.0, B = 0.0, \\Delta t = 86400.0, \\text{tol}_T = 1.0 \\times 10^{-4}, \\text{tol}_H = 1.0 \\times 10^{-5})$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry is a boolean indicating whether the final state returned to the initial state within tolerance for the corresponding test case (e.g., $[r_1,r_2,r_3,r_4]$).",
            "solution": "The problem has been validated and is determined to be a well-posed, scientifically sound, and self-contained exercise in computational physics. It requires the numerical integration of a simplified, one-dimensional coupled ocean-sea ice model and the verification of a fundamental property related to energy conservation over a periodic cycle.\n\nThe solution will be developed by first outlining the physical principles, then detailing the numerical algorithm, and finally implementing it to test the specified cases.\n\n**1. Physical and Mathematical Framework**\n\nThe core of the model is the conservation of energy for the ocean-ice column, governed by the First Law of Thermodynamics. The total energy content of the column, represented by the enthalpy $E$, changes in response to the net surface heat flux $F(t)$. This is expressed by the ordinary differential equation (ODE):\n$$\n\\frac{dE}{dt} = F(t)\n$$\nThe total change in enthalpy over one year, defined as the period $T_{\\text{year}} = 365 \\times 86400$ seconds, is the time integral of the forcing:\n$$\n\\Delta E_{\\text{total}} = E(T_{\\text{year}}) - E(0) = \\int_0^{T_{\\text{year}}} F(t) \\, dt\n$$\nThe problem specifies an analytic forcing function composed of annual and semi-annual harmonics:\n$$\nF(t) = A \\sin\\left( \\frac{2\\pi t}{T_{\\text{year}}} \\right) + B \\sin\\left( \\frac{4\\pi t}{T_{\\text{year}}} \\right)\n$$\nBy construction, the integral of any sine function with frequency $k \\cdot (2\\pi/T_{\\text{year}})$ for an integer $k \\ge 1$ over the interval $[0, T_{\\text{year}}]$ is exactly zero. Therefore, for the given $F(t)$, we have:\n$$\n\\int_0^{T_{\\text{year}}} F(t) \\, dt = 0\n$$\nThis implies that, in the exact continuous system, the enthalpy must return to its initial value after one full cycle, i.e., $E(T_{\\text{year}}) = E(0)$. Consequently, the physical state $(T(T_{\\text{year}}), H(T_{\\text{year}}))$ must be identical to the initial state $(T_0, H_0)$. The problem asks to verify if this property holds true to within a specified numerical tolerance when the system is integrated numerically.\n\nThe key innovation of this model is the enthalpy formulation, which combines sensible heat (related to temperature) and latent heat (related to phase change) into a single prognostic variable $E$. The definition is:\n$$\nE = C_o (T - T_f) - L_i \\rho_i H\n$$\nwhere $T_f = -1.8^\\circ\\text{C}$ is the freezing point of seawater. The term $C_o (T - T_f)$ represents the sensible heat of the ocean mixed layer relative to a state where the water is at the freezing point. The term $L_i \\rho_i H$ represents the energy required to melt the existing ice of thickness $H$. The negative sign indicates that this is an energy \"deficit\" that must be overcome by surface heating before the ocean can warm. The constant $C_o$ is the heat capacity of the mixed layer per unit area, calculated as $C_o = \\rho_w c_p h$, where $\\rho_w = 1025 \\, \\text{kg m}^{-3}$ is water density, $c_p = 3990 \\, \\text{J kg}^{-1} \\text{K}^{-1}$ is its specific heat, and $h = 50 \\, \\text{m}$ is the mixed layer depth. Other constants are the latent heat of ice $L_i = 3.34 \\times 10^5 \\, \\text{J kg}^{-1}$ and ice density $\\rho_i = 917 \\, \\text{kg m}^{-3}$.\n\nThe coupling between the ocean and sea ice is enforced by a diagnostic mapping from the prognostic variable $E$ to the physical state variables $(T, H)$. This mapping reflects the principle of instantaneous phase equilibrium:\n- If $E \\ge 0$: All potential ice has melted. There is no ice, so $H = 0$. The positive enthalpy manifests as sensible heat, warming the ocean above the freezing point: $T = T_f + E/C_o$.\n- If $E < 0$: The system has an energy deficit relative to the freezing point. This deficit is physically stored as latent heat in the ice. The ocean temperature is pinned at the freezing point, $T = T_f$, and the ice thickness is determined by the magnitude of the enthalpy deficit: $H = -E / (L_i \\rho_i)$.\n\n**2. Numerical Algorithm Design**\n\nThe task is to integrate the ODE for $E$ over one year. Since the right-hand side $F(t)$ does not depend on $E$, the integration is a direct quadrature of $F(t)$. The problem specifies the explicit midpoint rule. For a time step $\\Delta t$, the change in enthalpy is:\n$$\n\\Delta E = F(t_{\\text{mid}}) \\Delta t\n$$\nwhere $t_{\\text{mid}} = t_{\\text{current}} + \\Delta t / 2$. The enthalpy is updated as $E_{\\text{new}} = E_{\\text{current}} + \\Delta E$.\n\nThe integration must cover the exact period $T_{\\text{year}}$. If $T_{\\text{year}}$ is not an integer multiple of the given time step $\\Delta t$, a final, smaller time step is required. The algorithm proceeds as follows:\n1.  Initialize system parameters: Calculate $C_o$ and $L_i \\rho_i$. Set $T_{\\text{year}}$.\n2.  For each test case with parameters $(T_0, H_0, A, B, \\Delta t, \\text{tol}_T, \\text{tol}_H)$:\n    a.  Compute the initial enthalpy $E_0$ from the initial state $(T_0, H_0)$ using the formula: $E_0 = C_o (T_0 - T_f) - L_i \\rho_i H_0$.\n    b.  Initialize the current state: $E = E_0$ and $t = 0$.\n    c.  Determine the number of full time steps: $N_{\\text{full}} = \\text{int}(T_{\\text{year}} / \\Delta t)$.\n    d.  Iterate $N_{\\text{full}}$ times to perform the full steps:\n        i.  Calculate midpoint time: $t_{\\text{mid}} = t + \\Delta t/2$.\n        ii. Calculate flux at midpoint: $F_{\\text{mid}} = A \\sin(2\\pi t_{\\text{mid}}/T_{\\text{year}}) + B \\sin(4\\pi t_{\\text{mid}}/T_{\\text{year}})$.\n        iii.Update enthalpy: $E \\leftarrow E + F_{\\text{mid}} \\cdot \\Delta t$.\n        iv. Update time: $t \\leftarrow t + \\Delta t$.\n    e.  Calculate the remaining time for the final partial step: $\\Delta t_{\\text{rem}} = T_{\\text{year}} - t$.\n    f.  If $\\Delta t_{\\text{rem}}$ is non-negligible (e.g., greater than a small floating-point epsilon):\n        i.  Calculate final midpoint: $t_{\\text{mid}} = t + \\Delta t_{\\text{rem}}/2$.\n        ii. Calculate flux: $F_{\\text{mid}} = A \\sin(2\\pi t_{\\text{mid}}/T_{\\text{year}}) + B \\sin(4\\pi t_{\\text{mid}}/T_{\\text{year}})$.\n        iii.Perform the final update: $E \\leftarrow E + F_{\\text{mid}} \\cdot \\Delta t_{\\text{rem}}$.\n    g.  The final enthalpy is now $E(T_{\\text{year}})$. Convert this back to the final physical state $(T_{\\text{final}}, H_{\\text{final}})$ using the diagnostic mapping.\n    h.  Check for success by comparing the final state to the initial state against the given tolerances:\n        $$\n        |\\, T_{\\text{final}} - T_0 \\,| < \\text{tol}_T \\quad \\text{and} \\quad |\\, H_{\\text{final}} - H_0 \\,| < \\text{tol}_H\n        $$\n    i.  Record the boolean result of this check.\n3.  After processing all test cases, print the collected results in the specified format.\n\nThis structured approach ensures that the numerical simulation correctly implements the physical model and verification criteria. The use of the midpoint rule, a second-order accurate method, should provide sufficient accuracy for the given tolerances, although Case 3 with its extremely large time step will test the limits of this accuracy.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the coupled ocean-sea ice model problem for a suite of test cases.\n    \"\"\"\n    # Define physical constants\n    rho_w = 1025.0  # Water density (kg m^-3)\n    c_p = 3990.0    # Specific heat of water (J kg^-1 K^-1)\n    h = 50.0        # Mixed layer depth (m)\n    L_i = 3.34e5    # Latent heat of fusion of ice (J kg^-1)\n    rho_i = 917.0     # Ice density (kg m^-3)\n    T_f = -1.8      # Seawater freezing point (°C)\n    T_year = 365.0 * 86400.0  # Duration of one year (s)\n\n    # Derived constants\n    C_o = rho_w * c_p * h  # Ocean mixed-layer heat capacity (J m^-2 K^-1)\n    L_rho_i = L_i * rho_i  # Latent heat per unit volume of ice (J m^-3)\n\n    # Test suite\n    test_cases = [\n        # (T0, H0, A, B, dt, tol_T, tol_H)\n        (-1.0, 0.0, 200.0, 50.0, 3600.0, 1.0e-4, 1.0e-5),\n        (-1.8, 1.0, 20.0, 0.0, 3600.0, 1.0e-4, 1.0e-5),\n        (-1.0, 0.0, 200.0, 50.0, 604800.0, 1.0e-4, 1.0e-5),\n        (-1.2, 0.2, 0.0, 0.0, 86400.0, 1.0e-4, 1.0e-5),\n    ]\n\n    results = []\n\n    # Helper functions\n    def forcing_flux(t, A, B):\n        \"\"\"Calculates the analytic surface heat flux F(t).\"\"\"\n        omega1 = 2.0 * np.pi / T_year\n        omega2 = 4.0 * np.pi / T_year\n        return A * np.sin(omega1 * t) + B * np.sin(omega2 * t)\n\n    def state_to_enthalpy(T, H):\n        \"\"\"Converts physical state (T, H) to enthalpy E.\"\"\"\n        return C_o * (T - T_f) - L_rho_i * H\n\n    def enthalpy_to_state(E):\n        \"\"\"Converts enthalpy E to physical state (T, H).\"\"\"\n        if E >= 0:\n            H = 0.0\n            T = T_f + E / C_o\n        else:\n            T = T_f\n            H = -E / L_rho_i\n        return T, H\n\n    for case in test_cases:\n        T0, H0, A, B, dt, tol_T, tol_H = case\n\n        # 1. Calculate initial enthalpy\n        E_current = state_to_enthalpy(T0, H0)\n        t_current = 0.0\n\n        # 2. Determine number of full and one partial time step\n        num_full_steps = int(T_year / dt)\n        dt_rem = T_year - num_full_steps * dt\n\n        # 3. Time stepping with explicit midpoint rule (full steps)\n        for _ in range(num_full_steps):\n            t_mid = t_current + dt / 2.0\n            F_mid = forcing_flux(t_mid, A, B)\n            E_current += F_mid * dt\n            t_current += dt\n\n        # 4. Final partial step to reach T_year exactly\n        if dt_rem > 1e-9:  # Check for non-negligible remainder\n            t_mid = t_current + dt_rem / 2.0\n            F_mid = forcing_flux(t_mid, A, B)\n            E_current += F_mid * dt_rem\n\n        # 5. Calculate final state from final enthalpy\n        T_final, H_final = enthalpy_to_state(E_current)\n\n        # 6. Verify if the final state is within tolerance of the initial state\n        is_success = (abs(T_final - T0) < tol_T) and (abs(H_final - H0) < tol_H)\n        results.append(str(is_success).lower())\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}