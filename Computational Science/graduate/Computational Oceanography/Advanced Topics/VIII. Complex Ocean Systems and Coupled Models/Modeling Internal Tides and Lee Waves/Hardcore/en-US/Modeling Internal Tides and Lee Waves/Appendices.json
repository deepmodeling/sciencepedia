{
    "hands_on_practices": [
        {
            "introduction": "This first practice solidifies your understanding of the fundamental physics governing lee wave generation. By deriving the vertical wavenumber from the dispersion relation for steady flow over topography, you will uncover the critical conditions that distinguish between vertically propagating and evanescent wave regimes . This exercise is crucial for developing an intuition for when and where topographically generated internal waves are likely to be found.",
            "id": "3800117",
            "problem": "A two-dimensional (2D) barotropic flow of speed $U$ passes over sinusoidal topography of along-stream wavenumber $k$ in a uniformly stratified, rotating, Boussinesq ocean of constant buoyancy frequency $N$ and Coriolis parameter $f$. Assume small-amplitude linear response and hydrostatic–Boussinesq dynamics.\n\nUse as your fundamental base the linear internal gravity wave dispersion relation in a uniformly stratified, rotating fluid,\n$$\n\\hat{\\omega}^{2} \\;=\\; \\frac{N^{2} k^{2} + f^{2} m^{2}}{k^{2} + m^{2}},\n$$\nwhere $\\hat{\\omega}$ is the intrinsic (fluid-frame) frequency, $k$ is the horizontal wavenumber aligned with the mean flow, and $m$ is the vertical wavenumber. For steady topography-forced waves, the intrinsic frequency equals the Doppler shift by the mean flow, namely $\\hat{\\omega} = k U$.\n\nStarting from the dispersion relation and the steady forcing condition above, derive the vertical wavenumber $m$ as a function of $N$, $f$, $k$, and $U$. From first principles, identify the regimes for which the solution is vertically propagating (real $m$) versus evanescent (imaginary $m$). Then, for the parameter values\n- $N = 5.0 \\times 10^{-3}\\ \\mathrm{s^{-1}}$,\n- $f = 1.0 \\times 10^{-4}\\ \\mathrm{s^{-1}}$,\n- $U = 0.20\\ \\mathrm{m\\,s^{-1}}$,\n- $k = \\dfrac{2\\pi}{L}$ with $L = 5.0 \\times 10^{3}\\ \\mathrm{m}$,\n\ncompute the resonant vertical wavenumber $m$ for the vertically propagating branch. Express your final value in $\\mathrm{m^{-1}}$ and round your answer to four significant figures. State clearly, based on your derivation, whether the chosen parameters lie in the propagating or evanescent regime, but provide only the numerical value of $m$ as your final answer.",
            "solution": "The problem is subjected to validation according to the specified criteria.\n\n### Step 1: Extract Givens\n- Flow type: Two-dimensional (2D) barotropic flow\n- Flow speed: $U$\n- Topography: Sinusoidal with along-stream wavenumber $k$\n- Ocean properties: Uniformly stratified, rotating, Boussinesq\n- Buoyancy frequency: Constant, $N$\n- Coriolis parameter: Constant, $f$\n- Dynamics: Small-amplitude linear response, hydrostatic–Boussinesq (but a non-hydrostatic dispersion relation is provided and mandated for use)\n- Dispersion relation: $\\hat{\\omega}^{2} = \\frac{N^{2} k^{2} + f^{2} m^{2}}{k^{2} + m^{2}}$\n- Intrinsic frequency definition: $\\hat{\\omega}$ is the fluid-frame frequency\n- Horizontal wavenumber: $k$ (aligned with the mean flow)\n- Vertical wavenumber: $m$\n- Steady forcing condition: $\\hat{\\omega} = k U$\n- Numerical values:\n  - $N = 5.0 \\times 10^{-3}\\ \\mathrm{s^{-1}}$\n  - $f = 1.0 \\times 10^{-4}\\ \\mathrm{s^{-1}}$\n  - $U = 0.20\\ \\mathrm{m\\,s^{-1}}$\n  - $k = \\frac{2\\pi}{L}$ with $L = 5.0 \\times 10^{3}\\ \\mathrm{m}$\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed for validity.\n- **Scientifically Grounded**: The problem is a classic exercise in geophysical fluid dynamics, specifically concerning the theory of lee waves generated by stratified flow over topography. The provided dispersion relation is the standard one for internal gravity waves in a rotating, stratified fluid under the Boussinesq approximation. The steady forcing condition $\\hat{\\omega} = kU$ correctly represents the transformation from the time-dependent problem in the fluid frame to a stationary problem in the topographic frame. The physics is well-established.\n- **Well-Posed**: The problem is well-posed. It provides all necessary information and a clear set of tasks: derive an expression, identify physical regimes, and compute a numerical value. The tasks lead to a unique, meaningful solution.\n- **Objective**: The problem is stated using precise, objective, and standard scientific terminology.\n- **Other Flaws**: The problem is free from the listed flaws. It is formalizable, self-contained, and scientifically feasible. The provided numerical values are realistic for oceanic conditions. The slight ambiguity of mentioning \"hydrostatic\" dynamics while providing a \"non-hydrostatic\" dispersion relation is resolved by the explicit instruction to use the provided relation as the fundamental basis, making the instruction set internally consistent.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A full solution will be provided.\n\nThe starting point is the given dispersion relation for linear internal gravity waves in a uniformly stratified, rotating fluid:\n$$\n\\hat{\\omega}^{2} = \\frac{N^{2} k^{2} + f^{2} m^{2}}{k^{2} + m^{2}}\n$$\nwhere $\\hat{\\omega}$ is the intrinsic frequency, $k$ is the horizontal wavenumber, $m$ is the vertical wavenumber, $N$ is the buoyancy frequency, and $f$ is the Coriolis parameter.\n\nFor steady waves forced by flow over topography, the frequency in the frame of reference of the moving fluid, $\\hat{\\omega}$, is the Doppler-shifted frequency. For a mean flow $U$ aligned with the wavenumber $k$, this is given by the steady forcing condition:\n$$\n\\hat{\\omega} = k U\n$$\nSubstituting this condition into the dispersion relation yields:\n$$\n(k U)^{2} = \\frac{N^{2} k^{2} + f^{2} m^{2}}{k^{2} + m^{2}}\n$$\nOur goal is to solve this equation for the vertical wavenumber $m$. We begin by rearranging the equation to isolate terms involving $m^2$:\n$$\n(k U)^{2} (k^{2} + m^{2}) = N^{2} k^{2} + f^{2} m^{2}\n$$\n$$\nk^{4} U^{2} + k^{2} U^{2} m^{2} = N^{2} k^{2} + f^{2} m^{2}\n$$\n$$\nk^{2} U^{2} m^{2} - f^{2} m^{2} = N^{2} k^{2} - k^{4} U^{2}\n$$\nFactoring out $m^{2}$ on the left side and $k^2$ on the right side gives:\n$$\nm^{2} (k^{2} U^{2} - f^{2}) = k^{2} (N^{2} - k^{2} U^{2})\n$$\nSolving for $m^{2}$, we obtain:\n$$\nm^{2} = k^{2} \\frac{N^{2} - k^{2} U^{2}}{k^{2} U^{2} - f^{2}}\n$$\nThis can also be written in terms of the steady intrinsic frequency $\\hat{\\omega} = kU$:\n$$\nm^{2} = k^{2} \\frac{N^{2} - \\hat{\\omega}^{2}}{\\hat{\\omega}^{2} - f^{2}}\n$$\nThe vertical wavenumber $m$ is the square root of this expression. We are interested in the resonant vertical wavenumber for the propagating branch, so we consider the positive root:\n$$\nm = |k| \\sqrt{\\frac{N^{2} - \\hat{\\omega}^{2}}{\\hat{\\omega}^{2} - f^{2}}}\n$$\nSince wavenumber $k$ is typically defined as a positive quantity ($k = 2\\pi/L > 0$), we can write $m = k \\sqrt{\\frac{N^{2} - (kU)^{2}}{(kU)^{2} - f^{2}}}$.\n\nNext, we identify the regimes for vertically propagating versus evanescent solutions.\n- **Vertically propagating waves** require a real vertical wavenumber, which means $m^{2}  0$. Since $k^2$ is always positive, this condition is satisfied if the term $\\frac{N^{2} - \\hat{\\omega}^{2}}{\\hat{\\omega}^{2} - f^{2}}$ is positive. This occurs when the numerator and denominator have the same sign. In typical oceanic conditions, $N  f$.\n  1. Both positive: $N^{2} - \\hat{\\omega}^{2}  0$ and $\\hat{\\omega}^{2} - f^{2}  0$. This implies $\\hat{\\omega}^2  N^2$ and $\\hat{\\omega}^2  f^2$. As frequencies are positive, this gives the condition $f  \\hat{\\omega}  N$.\n  2. Both negative: $N^{2} - \\hat{\\omega}^{2}  0$ and $\\hat{\\omega}^{2} - f^{2}  0$. This implies $\\hat{\\omega}  N$ and $\\hat{\\omega}  f$. Since $N  f$, these conditions are mutually exclusive.\n  Therefore, the vertically propagating regime corresponds to an intrinsic frequency $\\hat{\\omega} = kU$ that lies between the Coriolis frequency and the buoyancy frequency: $f  kU  N$.\n\n- **Evanescent waves** require an imaginary vertical wavenumber, meaning $m^{2}  0$. This occurs when the numerator and denominator have opposite signs.\n  1. $N^{2} - \\hat{\\omega}^{2}  0$ and $\\hat{\\omega}^{2} - f^{2}  0$. This gives $\\hat{\\omega}  N$ and $\\hat{\\omega}  f$. Since $f  N$, this simplifies to $\\hat{\\omega}  f$. This is the sub-inertial (or rotational) evanescent regime.\n  2. $N^{2} - \\hat{\\omega}^{2}  0$ and $\\hat{\\omega}^{2} - f^{2}  0$. This gives $\\hat{\\omega}  N$ and $\\hat{\\omega}  f$. Since $N  f$, this simplifies to $\\hat{\\omega}  N$. This is the supercritical (or buoyancy) evanescent regime.\n\nNow, we use the provided numerical values to determine the regime and compute $m$.\nThe given parameters are:\n- $N = 5.0 \\times 10^{-3}\\ \\mathrm{s^{-1}}$\n- $f = 1.0 \\times 10^{-4}\\ \\mathrm{s^{-1}}$\n- $U = 0.20\\ \\mathrm{m\\,s^{-1}}$\n- $L = 5.0 \\times 10^{3}\\ \\mathrm{m}$\n\nFirst, we calculate the horizontal wavenumber $k$:\n$$\nk = \\frac{2\\pi}{L} = \\frac{2\\pi}{5.0 \\times 10^{3}} = \\frac{\\pi}{2500}\\ \\mathrm{m^{-1}} \\approx 1.2566 \\times 10^{-3}\\ \\mathrm{m^{-1}}\n$$\nNext, we calculate the intrinsic frequency $\\hat{\\omega} = kU$:\n$$\n\\hat{\\omega} = kU = \\left(\\frac{\\pi}{2500}\\ \\mathrm{m^{-1}}\\right) (0.20\\ \\mathrm{m\\,s^{-1}}) = \\frac{0.2\\pi}{2500}\\ \\mathrm{s^{-1}} = \\frac{\\pi}{12500}\\ \\mathrm{s^{-1}} \\approx 2.5133 \\times 10^{-4}\\ \\mathrm{s^{-1}}\n$$\nWe check if the parameters lie in the propagating regime by testing the condition $f  \\hat{\\omega}  N$:\n$$\n1.0 \\times 10^{-4}\\ \\mathrm{s^{-1}}  2.5133 \\times 10^{-4}\\ \\mathrm{s^{-1}}  5.0 \\times 10^{-3}\\ \\mathrm{s^{-1}}\n$$\nThe condition is satisfied, since $1.0  2.5133$ and $2.5133 \\times 10^{-4}  50 \\times 10^{-4}$. Thus, the chosen parameters indeed correspond to vertically propagating waves.\n\nWe proceed to compute the value of $m$ using the derived formula:\n$$\nm^2 = k^2 \\frac{N^2 - (kU)^2}{(kU)^2 - f^2}\n$$\nWe have the following squared values:\n- $k^2 = \\left(\\frac{\\pi}{2500}\\right)^2 = \\frac{\\pi^2}{6.25 \\times 10^{6}}\\ \\mathrm{m^{-2}}$\n- $N^2 = (5.0 \\times 10^{-3})^2 = 2.5 \\times 10^{-5}\\ \\mathrm{s^{-2}}$\n- $(kU)^2 = \\left(\\frac{\\pi}{12500}\\right)^2 = \\frac{\\pi^2}{1.5625 \\times 10^{8}}\\ \\mathrm{s^{-2}}$\n- $f^2 = (1.0 \\times 10^{-4})^2 = 1.0 \\times 10^{-8}\\ \\mathrm{s^{-2}}$\n\nSubstituting these into the expression for $m^2$:\n$$\nm^2 = \\left(\\frac{\\pi^2}{6.25 \\times 10^{6}}\\right) \\frac{2.5 \\times 10^{-5} - \\frac{\\pi^2}{1.5625 \\times 10^{8}}}{\\frac{\\pi^2}{1.5625 \\times 10^{8}} - 1.0 \\times 10^{-8}}\n$$\nApproximating $\\pi^2 \\approx 9.8696044$:\n$$\n(kU)^2 \\approx \\frac{9.8696044}{1.5625 \\times 10^{8}} \\approx 6.3165468 \\times 10^{-8}\\ \\mathrm{s^{-2}}\n$$\n$$\nk^2 \\approx \\frac{9.8696044}{6.25 \\times 10^{6}} \\approx 1.5791367 \\times 10^{-6}\\ \\mathrm{m^{-2}}\n$$\n$$\nm^2 \\approx (1.5791367 \\times 10^{-6}) \\frac{2.5 \\times 10^{-5} - 6.3165468 \\times 10^{-8}}{6.3165468 \\times 10^{-8} - 1.0 \\times 10^{-8}}\n$$\n$$\nm^2 \\approx (1.5791367 \\times 10^{-6}) \\frac{2.4936835 \\times 10^{-5}}{5.3165468 \\times 10^{-8}}\n$$\n$$\nm^2 \\approx (1.5791367 \\times 10^{-6}) (469.0345)\n$$\n$$\nm^2 \\approx 7.40679 \\times 10^{-4}\\ \\mathrm{m^{-2}}\n$$\nTaking the square root to find $m$:\n$$\nm = \\sqrt{7.40679 \\times 10^{-4}}\\ \\mathrm{m^{-1}} \\approx 0.0272154\\ \\mathrm{m^{-1}}\n$$\nRounding the result to four significant figures, we get $0.02722$.\nThe resonant vertical wavenumber for the vertically propagating branch is $m \\approx 0.02722\\ \\mathrm{m^{-1}}$.",
            "answer": "$$\n\\boxed{0.02722}\n$$"
        },
        {
            "introduction": "Building on the basic physics, this practice explores how the vertical structure of internal waves is determined by the ocean's stratification and boundary conditions. You will derive the classic vertical mode equation, a Sturm-Liouville problem, and see how the choice of a surface boundary condition—the computationally efficient rigid-lid versus the physically realistic free-surface—fundamentally alters the potential for barotropic-to-baroclinic energy conversion . This skill is essential for interpreting the results of different types of ocean models.",
            "id": "3800115",
            "problem": "Consider a stratified, inviscid ocean of constant reference density $\\rho_0$, depth $H$, and constant buoyancy frequency $N$ governed by the linearized Boussinesq, hydrostatic, and incompressible equations (no rotation for simplicity):\n- Horizontal momentum: $u_t = -\\frac{1}{\\rho_0} p_x$, $v_t = -\\frac{1}{\\rho_0} p_y$.\n- Hydrostatic balance: $p_z = - \\rho_0 b$.\n- Buoyancy evolution: $b_t + N^2 w = 0$.\n- Continuity: $u_x + v_y + w_z = 0$.\nLet the free surface be at $z=0$ and the bottom at $z=-H$. At the bottom, impose impermeability $w(-H) = 0$. At the surface, either:\n- Rigid-lid: $w(0) = 0$ and $\\eta(0) = 0$ (no surface displacement), or\n- Free-surface: kinematic condition $w(0) = \\eta_t$ and dynamic condition $p(0) = \\rho_0 g \\eta$, where $\\eta(x,y,t)$ is the surface elevation and $g$ is gravitational acceleration.\n\nAssume a vertical-mode separation of variables for the pressure perturbation:\n$$\np'(x,y,z,t) = \\rho_0\\, \\Phi(x,y,t)\\, F(z),\n$$\nwhere $F(z)$ is a dimensionless vertical structure function and $\\Phi(x,y,t)$ is a horizontal–temporal amplitude. Using the governing equations and the separation ansatz, derive, from first principles, the vertical eigenvalue problem for $F(z)$ of the form\n$$\n\\frac{d}{dz}\\left(\\frac{1}{N^2}\\frac{dF}{dz}\\right) + \\frac{1}{c^2} F = 0,\n$$\nwhere $c$ is a separation constant with dimensions of speed. Then derive the corresponding top boundary condition for $F(z)$ under both the rigid-lid and free-surface cases, and state the bottom boundary condition.\n\nFinally, using your derived operator and boundary conditions, determine which of the following statements correctly describes how the rigid-lid versus free-surface choice modifies the vertical mode structure and the presence of barotropic–baroclinic coupling (where “barotropic” refers to the vertically uniform mode associated with surface gravity waves, and “baroclinic” refers to internal modes):\n\nA. Under rigid-lid, the top boundary for $F(z)$ is Neumann, $F'(0)=0$, eliminating the barotropic surface gravity mode; under free-surface, the top boundary is Robin, $\\frac{1}{N^2(0)}F'(0) = \\frac{1}{g} F(0)$, which admits a vertically uniform barotropic mode with phase speed $c_0=\\sqrt{gH}$ and enables barotropic–baroclinic energy exchange via projection of the barotropic tide onto baroclinic modes.\n\nB. Under rigid-lid, the top boundary is Dirichlet, $F(0)=0$, which preserves surface gravity waves; under free-surface, the top boundary is Neumann, $F'(0)=0$, eliminating the barotropic mode and thereby preventing barotropic–baroclinic coupling.\n\nC. The vertical operator changes from $\\frac{d}{dz}\\left(\\frac{1}{N^2} \\frac{d}{dz}\\right)$ to $\\frac{d^2}{dz^2}$ when using a free surface, drastically altering interior eigenfunctions; as a consequence, barotropic–baroclinic coupling is impossible without bottom roughness.\n\nD. Both boundary choices yield identical vertical eigenfunctions and the same coupling properties; the only difference is the numerical filtering of fast surface waves, which does not affect modal structures or energy exchange.",
            "solution": "The problem statement is a standard exercise in geophysical fluid dynamics, asking for the derivation of the vertical mode equation and boundary conditions for internal waves in a stratified ocean under the hydrostatic and Boussinesq approximations.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- **Ocean Properties:** Stratified, inviscid, constant reference density $\\rho_0$, depth $H$, constant buoyancy frequency $N$.\n- **Governing Equations:**\n  - Horizontal momentum: $u_t = -\\frac{1}{\\rho_0} p_x$, $v_t = -\\frac{1}{\\rho_0} p_y$.\n  - Hydrostatic balance: $p_z = - \\rho_0 b$.\n  - Buoyancy evolution: $b_t + N^2 w = 0$.\n  - Continuity: $u_x + v_y + w_z = 0$.\n- **Geometry:** Free surface at $z=0$, flat bottom at $z=-H$.\n- **Bottom Boundary Condition:** Impermeability, $w(-H) = 0$.\n- **Surface Boundary Conditions (Two Cases):**\n  1.  **Rigid-lid:** $w(0) = 0$ and surface displacement $\\eta(0) = 0$.\n  2.  **Free-surface:** Kinematic condition $w(0) = \\eta_t$ and dynamic condition $p(0) = \\rho_0 g \\eta$.\n- **Separation Ansatz:** $p'(x,y,z,t) = \\rho_0\\, \\Phi(x,y,t)\\, F(z)$. Let us assume $p$ in the equations refers to the pressure perturbation $p'$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded:** The problem uses the standard, linearized Boussinesq equations under the hydrostatic approximation. These are fundamental to the study of low-frequency geophysical flows like internal waves and tides. The setup is scientifically sound.\n- **Well-Posed:** The problem asks to derive a Sturm-Liouville eigenvalue problem with specified boundary conditions. This is a well-posed mathematical problem that admits a set of orthogonal eigenfunctions (vertical modes) and corresponding eigenvalues.\n- **Objective:** The problem is stated using precise, standard terminology from physical oceanography and mathematics. There is no subjective or ambiguous language.\n- **Flaws Check:** The problem statement is free of the listed flaws. It is self-contained, consistent, and represents a classic derivation in the field. The assumption of constant $N$ is a simplification but a valid one for an idealized problem.\n\n**Step 3: Verdict and Action**\nThe problem statement is **valid**. We may proceed to the solution.\n\n### Derivation of the Vertical Eigenvalue Problem\n\nWe start with the five governing equations. Our goal is to find a single partial differential equation for the pressure perturbation, $p$.\n\n1.  Take the time derivative of the continuity equation:\n    $$ (u_x)_t + (v_y)_t + (w_z)_t = 0 $$\n    Assuming derivatives are interchangeable, this is $(u_t)_x + (v_t)_y + (w_t)_z = 0$.\n\n2.  Substitute the horizontal momentum equations into this expression:\n    $$ \\left(-\\frac{1}{\\rho_0} p_x\\right)_x + \\left(-\\frac{1}{\\rho_0} p_y\\right)_y + w_{zt} = 0 $$\n    $$ -\\frac{1}{\\rho_0} (p_{xx} + p_{yy}) + w_{zt} = 0 $$\n    This gives a relationship between the horizontal Laplacian of pressure, $\\nabla_H^2 p = p_{xx} + p_{yy}$, and the vertical velocity:\n    $$ \\nabla_H^2 p = \\rho_0 w_{zt} $$\n\n3.  Next, we relate the vertical velocity $w$ back to the pressure $p$ using the hydrostatic and buoyancy equations.\n    - From the hydrostatic balance, $p_z = -\\rho_0 b$. Taking the time derivative: $p_{zt} = -\\rho_0 b_t$.\n    - From the buoyancy evolution equation, $b_t = -N^2 w$.\n    - Substituting for $b_t$: $p_{zt} = -\\rho_0(-N^2 w) = \\rho_0 N^2 w$.\n    - This gives an expression for $w$ in terms of $p$, valid where $N^2 \\neq 0$:\n      $$ w = \\frac{1}{\\rho_0 N^2} p_{zt} $$\n\n4.  To obtain a single equation for $p$, we substitute this expression for $w$ into the equation from step 2. We need $w_{zt}$:\n    $$ w_{zt} = \\frac{\\partial}{\\partial z} \\left( \\frac{\\partial}{\\partial t} \\left( \\frac{1}{\\rho_0 N^2} p_{zt} \\right) \\right) = \\frac{1}{\\rho_0} \\frac{\\partial}{\\partial z} \\left(\\frac{1}{N^2} p_{ztt}\\right) $$\n    Substituting this into $\\nabla_H^2 p = \\rho_0 w_{zt}$:\n    $$ \\nabla_H^2 p = \\rho_0 \\left[ \\frac{1}{\\rho_0} \\frac{\\partial}{\\partial z} \\left(\\frac{1}{N^2} p_{ztt}\\right) \\right] = \\frac{\\partial}{\\partial z} \\left(\\frac{1}{N^2} p_{ztt}\\right) $$\n\n5.  Now, we apply the separation of variables. We assume the horizontal and temporal dependence can be described by a wave equation, which defines the separation constant $c$ (the horizontal phase speed):\n    $$ \\Phi_{tt} = c^2 \\nabla_H^2 \\Phi \\implies \\nabla_H^2 \\Phi = \\frac{1}{c^2} \\Phi_{tt} $$\n    Applying this relation to $p = \\rho_0 \\Phi F$, we get:\n    $$ \\nabla_H^2 p = \\frac{1}{c^2} p_{tt} $$\n    Substituting this into the equation from step 4:\n    $$ \\frac{1}{c^2} p_{tt} = \\frac{\\partial}{\\partial z} \\left(\\frac{1}{N^2} p_{ztt}\\right) $$\n    For non-trivial time dependence ($p_{tt} \\neq 0$), we can formally cancel the $\\frac{\\partial^2}{\\partial t^2}$ operator:\n    $$ \\frac{1}{c^2} p = \\frac{\\partial}{\\partial z} \\left(\\frac{1}{N^2} p_z\\right) $$\n\n6.  Finally, substitute the ansatz $p = \\rho_0 \\Phi(x,y,t) F(z)$. Since $\\rho_0$ is constant and $\\Phi$ does not depend on $z$:\n    $$ \\frac{1}{c^2} \\rho_0 \\Phi F(z) = \\frac{d}{dz} \\left(\\frac{1}{N^2} \\frac{d}{dz} (\\rho_0 \\Phi F(z))\\right) $$\n    $$ \\frac{1}{c^2} \\rho_0 \\Phi F(z) = \\rho_0 \\Phi \\frac{d}{dz} \\left(\\frac{1}{N^2} \\frac{dF}{dz}\\right) $$\n    Dividing by $\\rho_0 \\Phi$ (for non-trivial solutions) and rearranging gives the desired vertical eigenvalue problem:\n    $$ \\frac{d}{dz}\\left(\\frac{1}{N^2}\\frac{dF}{dz}\\right) + \\frac{1}{c^2} F = 0 $$\n\n### Derivation of Boundary Conditions for $F(z)$\n\nTo translate the physical boundary conditions on $w$ into mathematical boundary conditions on $F(z)$, we need a direct relation between $w$ and $F$. From step 3 above, $p_{zt} = \\rho_0 N^2 w$. Now using the ansatz $p = \\rho_0 \\Phi F$:\n$$ p_{zt} = \\frac{\\partial}{\\partial z}\\left(\\frac{\\partial}{\\partial t}(\\rho_0 \\Phi F(z))\\right) = \\rho_0 \\Phi_t \\frac{dF}{dz} = \\rho_0 \\Phi_t F'(z) $$\nEquating the two expressions for $p_{zt}$:\n$$ \\rho_0 \\Phi_t F'(z) = \\rho_0 N^2 w \\implies w(x,y,z,t) = \\frac{\\Phi_t(x,y,t)}{N^2(z)} F'(z) $$\nThis relation allows us to define the boundary conditions for $F(z)$.\n\n**Bottom Boundary Condition ($z=-H$):**\nThe condition is impermeability, $w(-H) = 0$. Using the relation above:\n$$ w(-H) = \\frac{\\Phi_t}{N^2(-H)} F'(-H) = 0 $$\nFor non-trivial motion ($\\Phi_t \\neq 0$), this requires:\n$$ F'(-H) = 0 $$\n\n**Top Boundary Conditions ($z=0$):**\n\n**Case 1: Rigid-Lid**\nThe condition is $w(0) = 0$.\n$$ w(0) = \\frac{\\Phi_t}{N^2(0)} F'(0) = 0 $$\nThis requires:\n$$ F'(0) = 0 $$\nThis is a homogeneous Neumann boundary condition.\n\n**Case 2: Free-Surface**\nThe conditions are $w(0) = \\eta_t$ and $p(0) = \\rho_0 g \\eta$. We eliminate the surface elevation $\\eta$. Take the time derivative of the dynamic condition: $p_t(0) = \\rho_0 g \\eta_t$. Substitute the kinematic condition:\n$$ p_t(0) = \\rho_0 g w(0) $$\nNow, we substitute the expressions for $p_t$ and $w$ in terms of our separated variables:\n- $p_t(0) = \\rho_0 \\Phi_t F(0)$\n- $w(0) = \\frac{\\Phi_t}{N^2(0)} F'(0)$\nSubstituting these into the combined surface condition:\n$$ \\rho_0 \\Phi_t F(0) = \\rho_0 g \\left( \\frac{\\Phi_t}{N^2(0)} F'(0) \\right) $$\nCanceling the common factor $\\rho_0 \\Phi_t$ yields the condition on $F(z)$:\n$$ F(0) = \\frac{g}{N^2(0)} F'(0) $$\nThis can be rearranged into the form given in Option A:\n$$ \\frac{1}{N^2(0)}F'(0) = \\frac{1}{g} F(0) $$\nThis is a Robin (or mixed) boundary condition.\n\n### Evaluation of Options\n\n**A. Under rigid-lid, the top boundary for $F(z)$ is Neumann, $F'(0)=0$, eliminating the barotropic surface gravity mode; under free-surface, the top boundary is Robin, $\\frac{1}{N^2(0)}F'(0) = \\frac{1}{g} F(0)$, which admits a vertically uniform barotropic mode with phase speed $c_0=\\sqrt{gH}$ and enables barotropic–baroclinic energy exchange via projection of the barotropic tide onto baroclinic modes.**\n\n- The derived boundary condition for the rigid lid is $F'(0)=0$, which is a Neumann condition. This is correct. The physical consequence is the filtering of external surface gravity waves (the \"barotropic mode\" in this context), as there is no vertical motion at the surface to support them. This is correct.\n- The derived boundary condition for the free surface is $\\frac{1}{N^2(0)}F'(0) = \\frac{1}{g} F(0)$, which is a Robin condition. This is correct.\n- The free-surface condition allows for a surface elevation $\\eta$, which is the hallmark of the barotropic surface gravity wave mode. This mode, governed by the shallow water equations, has a phase speed $c_0=\\sqrt{gH}$. Its existence is permitted by the free-surface physics. The presence of this large-scale barotropic mode is a prerequisite for barotropic-to-baroclinic energy conversion, which typically occurs over topography. The statement accurately describes the physics.\n- **Verdict: Correct.**\n\n**B. Under rigid-lid, the top boundary is Dirichlet, $F(0)=0$, which preserves surface gravity waves; under free-surface, the top boundary is Neumann, $F'(0)=0$, eliminating the barotropic mode and thereby preventing barotropic–baroclinic coupling.**\n\n- The rigid-lid condition is Neumann, $F'(0)=0$, not Dirichlet, $F(0)=0$. This is incorrect.\n- The free-surface condition is Robin, not Neumann. This is incorrect.\n- The physical interpretations are reversed and incorrect.\n- **Verdict: Incorrect.**\n\n**C. The vertical operator changes from $\\frac{d}{dz}\\left(\\frac{1}{N^2} \\frac{d}{dz}\\right)$ to $\\frac{d^2}{dz^2}$ when using a free surface, drastically altering interior eigenfunctions; as a consequence, barotropic–baroclinic coupling is impossible without bottom roughness.**\n\n- The vertical operator $\\frac{d}{dz}\\left(\\frac{1}{N^2} \\frac{d}{dz}\\right)$ is derived from the interior governing equations, which are the same for both the rigid-lid and free-surface cases. The operator does not change; only the top boundary condition changes. This is incorrect.\n- The eigenfunctions are altered by the change in boundary condition, but the operator itself is invariant.\n- **Verdict: Incorrect.**\n\n**D. Both boundary choices yield identical vertical eigenfunctions and the same coupling properties; the only difference is the numerical filtering of fast surface waves, which does not affect modal structures or energy exchange.**\n\n- The boundary conditions for the Sturm-Liouville problem are different ($F'(0)=0$ vs. $F(0) = \\frac{g}{N^2(0)} F'(0)$). Different boundary conditions lead to different sets of eigenfunctions and eigenvalues. Therefore, the modal structures are not identical.\n- The choice fundamentally affects the system's physics by either including or excluding the barotropic surface gravity mode, which directly impacts the potential for barotropic-to-baroclinic energy exchange.\n- **Verdict: Incorrect.**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "This final practice bridges the gap between continuous theory and discrete numerical implementation, a central challenge in computational oceanography. By combining analytical derivation with a hands-on coding exercise, you will quantify how the choice of a numerical discretization scheme introduces errors that are not present in the underlying physical equations . This will provide you with a concrete understanding of numerical diffusion and its impact on simulating fine-scale structures like internal wave beams.",
            "id": "3800152",
            "problem": "You will quantify the impact of algorithmic diffusion introduced by an implicit Laplacian closure on the cross-beam structure of an internal tide beam, and assess its effect relative to physical viscosity. Consider a small-amplitude, linear internal wave beam in a uniformly stratified, inviscid background, modeled under the Boussinesq approximation. For internal gravity waves, the continuous dispersion relation between the frequency $\\omega$, the buoyancy frequency $N$, and the wavevector components $(k_x,k_z)$ is given by\n$$\n\\omega^2 = N^2 \\frac{k_x^2}{k_x^2 + k_z^2}.\n$$\nUnder a paraxial, slowly varying envelope approximation along the beam-aligned coordinate $s$ and the cross-beam coordinate $n$, and retaining linear viscous damping through a Laplacian closure, the envelope $u(n,s,t)$ satisfies the scalar advection-diffusion model\n$$\n\\frac{\\partial u}{\\partial t} + c_b \\frac{\\partial u}{\\partial s} = D_{\\mathrm{phys}} \\frac{\\partial^2 u}{\\partial n^2},\n$$\nwhere $c_b$ is the along-beam group speed and $D_{\\mathrm{phys}}$ is an effective physical diffusivity proportional to the kinematic viscosity projected onto the beam. You will isolate the cross-beam diffusion at fixed $s$ and focus on $u(n,t)$ governed by\n$$\n\\frac{\\partial u}{\\partial t} = D_{\\mathrm{phys}} \\frac{\\partial^2 u}{\\partial n^2},\n$$\nwhich captures the leading-order effect of viscosity on beam thickness and amplitude in time at a fixed along-beam station, while advection along $s$ only shifts the beam without altering the cross-beam structure.\n\nYou will treat diffusion numerically using an implicit Laplacian closure with backward Euler in time and a second-order centered finite difference in space on a periodic domain. Denote the spatial grid spacing by $\\Delta x$, the time step by $\\Delta t$, and the discrete Laplacian operator by $L_h$. The numerical update for one time step is\n$$\nu^{n+1} - \\Delta t\\, D_{\\mathrm{closure}} L_h u^{n+1} = u^n,\n$$\nwhere $D_{\\mathrm{closure}}$ is the closure coefficient used by the model. In a discrete Fourier representation on the periodic grid, the discrete Laplacian has symbol\n$$\n\\lambda_h(k) = \\frac{4 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)}{\\Delta x^2},\n$$\nwhere $k$ is the continuous wavenumber compatible with the periodic grid. The one-step amplification factor of the implicit scheme for mode $k$ is then\n$$\nG_{\\mathrm{num}}(k) = \\frac{1}{1 + \\Delta t\\, D_{\\mathrm{closure}}\\, \\lambda_h(k)}.\n$$\n\nTask A (Derivation): Starting from the above, derive the effective numerical diffusivity $D_{\\mathrm{eff}}(k,\\Delta x)$ such that the numerical amplification factor can be written in the continuum form\n$$\nG_{\\mathrm{num}}(k) = \\frac{1}{1 + \\Delta t\\, D_{\\mathrm{eff}}(k,\\Delta x)\\, k^2}.\n$$\nExpress $D_{\\mathrm{eff}}(k,\\Delta x)$ explicitly in terms of $D_{\\mathrm{closure}}$, $k$, and $\\Delta x$, and show its leading-order deviation from $D_{\\mathrm{closure}}$ as $\\Delta x \\to 0$ for fixed $k$.\n\nTask B (Analytical beam evolution): Let the cross-beam amplitude at time $t=0$ be a Gaussian,\n$$\nu(n,0) = \\exp\\left(-\\frac{n^2}{w_0^2}\\right),\n$$\nwith initial width $w_0$ measured in meters. Solve the diffusion equation analytically to obtain the width $w(t)$ and the center amplitude $A(t) = u(0,t)$ as functions of time $t$ and $D_{\\mathrm{phys}}$. Report explicit formulas for $w(t)$ and $A(t)$.\n\nTask C (Numerical experiment and assessment): Implement a spectral method on a periodic domain of length $L = N \\Delta x$ with $N$ grid points to evolve the Gaussian profile for a total time $T = N_{\\mathrm{steps}} \\Delta t$ using the implicit Laplacian closure with $D_{\\mathrm{closure}} = D_{\\mathrm{phys}}$. Use the discrete Fourier transform to apply the per-step amplification factor $G_{\\mathrm{num}}(k)$ to each mode $k$ for $N_{\\mathrm{steps}}$ steps, and reconstruct $u(n,T)$. Compute:\n- The numerical center amplitude $A_{\\mathrm{num}}(T)$.\n- The numerical width $w_{\\mathrm{num}}(T)$ defined by the second-moment estimator\n$$\nw_{\\mathrm{num}}^2(T) = \\frac{2 \\int_{-L/2}^{L/2} n^2 u(n,T)\\, \\mathrm{d}n}{\\int_{-L/2}^{L/2} u(n,T)\\, \\mathrm{d}n},\n$$\nimplemented with discrete sums on the grid.\n- The analytical predictions $A_{\\mathrm{anal}}(T)$ and $w_{\\mathrm{anal}}(T)$ from Task B.\n- The relative error metrics\n$$\n\\varepsilon_w = w_{\\mathrm{num}}(T) - w_{\\mathrm{anal}}(T), \\quad \\varepsilon_A = A_{\\mathrm{num}}(T) - A_{\\mathrm{anal}}(T),\n$$\nexpressed respectively in meters and dimensionless amplitude units. Additionally, quantify the ratio between the effective numerical diffusivity and the physical closure for the Gaussian’s root-mean-square wavenumber $k_{\\mathrm{rms}}$ defined by the Gaussian’s Fourier variance, which for $u(n,0)$ above is $k_{\\mathrm{rms}} = \\sqrt{2}/w_0$. Compute\n$$\nR_D = \\frac{D_{\\mathrm{eff}}(k_{\\mathrm{rms}},\\Delta x)}{D_{\\mathrm{phys}}},\n$$\nto measure the numerical under- or over-diffusion introduced by the discrete Laplacian symbol at the dominant wavenumber scale of the beam.\n\nPhysical units and output requirements:\n- Express all lengths (including $w_0$, $w_{\\mathrm{num}}(T)$, $w_{\\mathrm{anal}}(T)$, and $\\varepsilon_w$) in meters.\n- Express all times (including $T$) in seconds.\n- Express all diffusivities (including $D_{\\mathrm{phys}}$) in $\\mathrm{m}^2/\\mathrm{s}$.\n- Center amplitude $A$ is dimensionless.\n- Angles are not required in this problem; if any trigonometric arguments occur, they must be in radians.\n- For each test case below, your program must output a list of three floats: $[\\varepsilon_w,\\varepsilon_A,R_D]$. Aggregate the lists from all test cases into a single line in the format \"[[e11,e12,e13],[e21,e22,e23],[e31,e32,e33]]\" with no extra text.\n\nTest suite:\nUse the following parameter sets to evaluate your implementation:\n- Case $1$ (happy path, fine resolution): $\\Delta x = 1.0\\,\\mathrm{m}$, $N=2048$, $D_{\\mathrm{phys}} = 0.01\\,\\mathrm{m}^2/\\mathrm{s}$, $w_0 = 10.0\\,\\mathrm{m}$, $\\Delta t = 0.5\\,\\mathrm{s}$, $T = 100.0\\,\\mathrm{s}$.\n- Case $2$ (coarse grid impact): $\\Delta x = 5.0\\,\\mathrm{m}$, $N=2048$, $D_{\\mathrm{phys}} = 0.01\\,\\mathrm{m}^2/\\mathrm{s}$, $w_0 = 10.0\\,\\mathrm{m}$, $\\Delta t = 1.0\\,\\mathrm{s}$, $T = 200.0\\,\\mathrm{s}$.\n- Case $3$ (near-high-wavenumber content): $\\Delta x = 2.0\\,\\mathrm{m}$, $N=2048$, $D_{\\mathrm{phys}} = 0.01\\,\\mathrm{m}^2/\\mathrm{s}$, $w_0 = 2.0\\,\\mathrm{m}$, $\\Delta t = 0.5\\,\\mathrm{s}$, $T = 200.0\\,\\mathrm{s}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets and with nested lists exactly ordered as:\n$$\n[[\\varepsilon_{w,1},\\varepsilon_{A,1},R_{D,1}],[\\varepsilon_{w,2},\\varepsilon_{A,2},R_{D,2}],[\\varepsilon_{w,3},\\varepsilon_{A,3},R_{D,3}]].\n$$",
            "solution": "The problem statement has been critically examined and is determined to be valid. It is scientifically grounded in the principles of wave mechanics and numerical analysis, well-posed, and entirely objective. All definitions, parameters, and tasks are specified with sufficient clarity to permit a unique and verifiable solution.\n\n### Task A: Derivation of Effective Numerical Diffusivity\n\nThe goal is to find the effective numerical diffusivity $D_{\\mathrm{eff}}(k,\\Delta x)$ that links the numerical amplification factor $G_{\\mathrm{num}}(k)$ to a continuum-like form.\n\nThe numerical amplification factor for the implicit scheme is given by:\n$$\nG_{\\mathrm{num}}(k) = \\frac{1}{1 + \\Delta t\\, D_{\\mathrm{closure}}\\, \\lambda_h(k)}\n$$\nwhere $\\lambda_h(k)$ is the symbol of the discrete Laplacian:\n$$\n\\lambda_h(k) = \\frac{4 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)}{\\Delta x^2}\n$$\nWe want to express this amplification factor in the form:\n$$\nG_{\\mathrm{num}}(k) = \\frac{1}{1 + \\Delta t\\, D_{\\mathrm{eff}}(k,\\Delta x)\\, k^2}\n$$\nBy equating the denominators of the two expressions for $G_{\\mathrm{num}}(k)$, we obtain:\n$$\n1 + \\Delta t\\, D_{\\mathrm{closure}}\\, \\lambda_h(k) = 1 + \\Delta t\\, D_{\\mathrm{eff}}(k,\\Delta x)\\, k^2\n$$\nThis simplifies to:\n$$\nD_{\\mathrm{closure}}\\, \\lambda_h(k) = D_{\\mathrm{eff}}(k,\\Delta x)\\, k^2\n$$\nSolving for $D_{\\mathrm{eff}}(k,\\Delta x)$ yields:\n$$\nD_{\\mathrm{eff}}(k,\\Delta x) = D_{\\mathrm{closure}} \\frac{\\lambda_h(k)}{k^2}\n$$\nSubstituting the expression for $\\lambda_h(k)$:\n$$\nD_{\\mathrm{eff}}(k,\\Delta x) = D_{\\mathrm{closure}} \\frac{4 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)}{\\Delta x^2 k^2}\n$$\nTo analyze the leading-order deviation from $D_{\\mathrm{closure}}$ as the grid spacing $\\Delta x \\to 0$, we perform a Taylor series expansion of $\\sin(x)$ for small $x$. Let $x = \\frac{k \\Delta x}{2}$.\nThe expansion is $\\sin(x) = x - \\frac{x^3}{6} + \\mathcal{O}(x^5)$.\nThen $\\sin^2(x) = \\left(x - \\frac{x^3}{6} + \\dots\\right)^2 = x^2 - \\frac{x^4}{3} + \\mathcal{O}(x^6)$.\nSubstituting back $x = \\frac{k \\Delta x}{2}$:\n$$\n\\sin^2\\left(\\frac{k \\Delta x}{2}\\right) = \\left(\\frac{k \\Delta x}{2}\\right)^2 - \\frac{1}{3}\\left(\\frac{k \\Delta x}{2}\\right)^4 + \\mathcal{O}((\\Delta x)^6) = \\frac{k^2 \\Delta x^2}{4} - \\frac{k^4 \\Delta x^4}{48} + \\mathcal{O}((\\Delta x)^6)\n$$\nNow we substitute this into the expression for $\\lambda_h(k)$:\n$$\n\\lambda_h(k) = \\frac{4}{\\Delta x^2} \\left[ \\frac{k^2 \\Delta x^2}{4} - \\frac{k^4 \\Delta x^4}{48} + \\dots \\right] = k^2 - \\frac{k^4 \\Delta x^2}{12} + \\mathcal{O}((\\Delta x)^4)\n$$\nFinally, we substitute this expanded $\\lambda_h(k)$ into the expression for $D_{\\mathrm{eff}}$:\n$$\nD_{\\mathrm{eff}}(k,\\Delta x) = D_{\\mathrm{closure}} \\frac{k^2 - \\frac{k^4 \\Delta x^2}{12} + \\dots}{k^2} = D_{\\mathrm{closure}} \\left(1 - \\frac{k^2 \\Delta x^2}{12} + \\mathcal{O}((\\Delta x)^4)\\right)\n$$\nThe leading-order deviation from $D_{\\mathrm{closure}}$ is $-\\frac{D_{\\mathrm{closure}} k^2 \\Delta x^2}{12}$. This demonstrates that the second-order centered finite difference scheme is hypodiffusive ($D_{\\mathrm{eff}}  D_{\\mathrm{closure}}$ for $k \\ne 0$), meaning it applies less diffusion than intended, especially at higher wavenumbers (or for coarser grids), and that the error in the diffusivity is second-order in the grid spacing $\\Delta x$.\n\n### Task B: Analytical Beam Evolution\n\nWe solve the one-dimensional diffusion equation $\\frac{\\partial u}{\\partial t} = D_{\\mathrm{phys}} \\frac{\\partial^2 u}{\\partial n^2}$ with the Gaussian initial condition $u(n,0) = \\exp\\left(-\\frac{n^2}{w_0^2}\\right)$.\nThis is a standard problem, most elegantly solved using Fourier transforms. Let $\\hat{u}(k,t)$ be the Fourier transform of $u(n,t)$. The PDE transforms to:\n$$\n\\frac{\\partial \\hat{u}}{\\partial t} = -D_{\\mathrm{phys}} k^2 \\hat{u}(k,t)\n$$\nThis is a first-order ordinary differential equation in time for each wavenumber $k$, with the solution:\n$$\n\\hat{u}(k,t) = \\hat{u}(k,0) e^{-D_{\\mathrm{phys}} k^2 t}\n$$\nThe Fourier transform of the initial condition, a Gaussian $A_0 e^{-n^2/w_0^2}$ (where $A_0=1$), is also a Gaussian:\n$$\n\\hat{u}(k,0) = \\mathcal{F}\\left[e^{-n^2/w_0^2}\\right](k) = \\sqrt{\\pi} w_0 e^{-k^2 w_0^2 / 4}\n$$\nSubstituting this into the time-evolved solution in Fourier space:\n$$\n\\hat{u}(k,t) = \\left(\\sqrt{\\pi} w_0 e^{-k^2 w_0^2 / 4}\\right) e^{-D_{\\mathrm{phys}} k^2 t} = \\sqrt{\\pi} w_0 e^{-k^2 \\left(\\frac{w_0^2}{4} + D_{\\mathrm{phys}} t\\right)}\n$$\nTo find the solution in physical space, we recognize that this is the Fourier transform of a Gaussian of the form $u(n,t) = A(t) e^{-n^2/w(t)^2}$. Its transform is $\\hat{u}(k,t) = A(t) \\sqrt{\\pi} w(t) e^{-k^2 w(t)^2 / 4}$.\nBy comparing the two expressions for $\\hat{u}(k,t)$, we equate the terms in the exponent and the pre-factors.\nFrom the exponent:\n$$\n\\frac{w(t)^2}{4} = \\frac{w_0^2}{4} + D_{\\mathrm{phys}} t \\implies w(t)^2 = w_0^2 + 4 D_{\\mathrm{phys}} t\n$$\nThus, the analytical width is:\n$$\nw_{\\mathrm{anal}}(t) = \\sqrt{w_0^2 + 4 D_{\\mathrm{phys}} t}\n$$\nFrom the pre-factor:\n$$\nA(t) \\sqrt{\\pi} w(t) = \\sqrt{\\pi} w_0 \\implies A(t) = \\frac{w_0}{w(t)}\n$$\nThus, the analytical center amplitude is:\n$$\nA_{\\mathrm{anal}}(t) = \\frac{w_0}{\\sqrt{w_0^2 + 4 D_{\\mathrm{phys}} t}}\n$$\n\n### Task C: Numerical Experiment and Assessment\n\nThe numerical simulation will be performed using a spectral method. The core principle is to evolve the solution in the Fourier domain where the diffusion operator becomes a simple multiplication.\n\n1.  **Discretization**: A periodic domain of length $L = N \\Delta x$ is discretized into $N$ points. We define a centered spatial grid $n_j = \\Delta x (j - N/2)$ for $j=0, \\dots, N-1$. The corresponding wavenumbers are given by $k_m = 2\\pi m / L$ for $m=-N/2, \\dots, N/2-1$, which are conveniently generated by `numpy.fft.fftfreq`.\n\n2.  **Initialization**: The initial Gaussian profile $u(n,0)$ is evaluated on the discrete grid $n$. To use the `numpy.fft` library correctly with our centered spatial grid, the spatial data must be reordered from `[-N/2, ..., N/2-1]` to `[0, ..., N/2-1, -N/2, ..., -1]` order before the transform using `ifftshift`, and the output must be shifted back using `fftshift`.\n\n3.  **Time Evolution**: The solution is advanced from $t=0$ to $t=T$ in $N_{\\mathrm{steps}} = T/\\Delta t$ steps. In Fourier space, each step corresponds to multiplying the Fourier coefficients $\\hat{u}(k)$ by the amplification factor $G_{\\mathrm{num}}(k)$. After $N_{\\mathrm{steps}}$, the final state in Fourier space is $\\hat{u}(k,T) = \\hat{u}(k,0) \\cdot [G_{\\mathrm{num}}(k)]^{N_{\\mathrm{steps}}}$.\n\n4.  **Final State Analysis**:\n    *   The numerical solution $u(n,T)$ is recovered by applying the inverse Fast Fourier Transform to $\\hat{u}(k,T)$.\n    *   The numerical amplitude $A_{\\mathrm{num}}(T)$ is the maximum value of the computed profile $u(n,T)$.\n    *   The numerical width $w_{\\mathrm{num}}(T)$ is calculated using the discrete second-moment estimator:\n        $$\n        w_{\\mathrm{num}}^2(T) = \\frac{2 \\sum_{j=0}^{N-1} n_j^2 u(n_j,T)}{\\sum_{j=0}^{N-1} u(n_j,T)}\n        $$\n        where the sum is over all grid points.\n    *   The error metrics $\\varepsilon_w = w_{\\mathrm{num}}(T) - w_{\\mathrm{anal}}(T)$ and $\\varepsilon_A = A_{\\mathrm{num}}(T) - A_{\\mathrm{anal}}(T)$ quantify the discrepancy between the numerical and analytical results.\n    *   The ratio $R_D = D_{\\mathrm{eff}}(k_{\\mathrm{rms}},\\Delta x)/D_{\\mathrm{phys}}$ is computed using the formula for $D_{\\mathrm{eff}}$ from Task A, evaluated at the root-mean-square wavenumber of the initial Gaussian, $k_{\\mathrm{rms}} = \\sqrt{2}/w_0$. This ratio directly measures the numerical scheme's accuracy at the dominant scale of the beam. A ratio less than $1$ indicates hypodiffusion, which causes the numerical beam to spread slower and decay less than its analytical counterpart.\n\nThis procedure provides a complete framework for quantifying the numerical error introduced by the spatial discretization of the Laplacian operator.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of quantifying numerical diffusion for an internal tide beam\n    modeled by a 1D diffusion equation, comparing numerical and analytical results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (happy path, fine resolution)\n        {'dx': 1.0, 'N': 2048, 'D_phys': 0.01, 'w0': 10.0, 'dt': 0.5, 'T': 100.0},\n        # Case 2 (coarse grid impact)\n        {'dx': 5.0, 'N': 2048, 'D_phys': 0.01, 'w0': 10.0, 'dt': 1.0, 'T': 200.0},\n        # Case 3 (near-high-wavenumber content)\n        {'dx': 2.0, 'N': 2048, 'D_phys': 0.01, 'w0': 2.0, 'dt': 0.5, 'T': 200.0},\n    ]\n\n    results = []\n    for case in test_cases:\n        dx = case['dx']\n        N = case['N']\n        D_phys = case['D_phys']\n        w0 = case['w0']\n        dt = case['dt']\n        T = case['T']\n\n        # D_closure is set to be equal to D_phys as per the problem statement\n        D_closure = D_phys\n        \n        # --- Numerical Simulation ---\n\n        # 1. Grid and Initial Condition Setup\n        L = N * dx\n        # Centered spatial grid from -L/2 to L/2-dx\n        n = dx * (np.arange(N) - N / 2)\n        # Wavenumber grid in standard FFT order\n        k = 2 * np.pi * np.fft.fftfreq(N, d=dx)\n        \n        # Initial condition: Gaussian profile, centered on the grid\n        u0 = np.exp(-n**2 / w0**2)\n        \n        # 2. Fourier Space Evolution\n        # Transform initial condition to Fourier space.\n        # We must reorder the centered u0 to standard [0, ..., N-1] order before FFT.\n        u0_hat = np.fft.fft(np.fft.ifftshift(u0))\n\n        # Number of time steps\n        n_steps = int(round(T / dt))\n\n        # Calculate the symbol of the discrete Laplacian\n        # Use a small epsilon to avoid division by zero at k=0, although sin(0)=0 handles it\n        lambda_h = (4 / dx**2) * np.sin(k * dx / 2)**2\n\n        # Calculate the one-step amplification factor for the implicit scheme\n        G_num = 1.0 / (1.0 + dt * D_closure * lambda_h)\n        \n        # Evolve in Fourier space for n_steps\n        uT_hat = u0_hat * (G_num**n_steps)\n\n        # 3. Transform back to physical space and analyze\n        # Inverse transform and reorder back to a centered profile\n        uT_numerical = np.fft.fftshift(np.fft.ifft(uT_hat)).real\n\n        # --- Calculation of Metrics ---\n        \n        # Numerical amplitude: maximum value of the final profile\n        A_num = np.max(uT_numerical)\n        \n        # Numerical width: using the second-moment estimator\n        # The dx terms in the discrete integral form cancel out\n        sum_uT = np.sum(uT_numerical)\n        sum_n2_uT = np.sum(n**2 * uT_numerical)\n        if sum_uT > 0:\n            w_num_sq = (2 * sum_n2_uT) / sum_uT\n            w_num = np.sqrt(w_num_sq)\n        else:\n            w_num = 0.0\n\n        # Analytical predictions at time T\n        w_anal_sq = w0**2 + 4 * D_phys * T\n        w_anal = np.sqrt(w_anal_sq)\n        A_anal = w0 / w_anal\n        \n        # Error metrics\n        eps_w = w_num - w_anal\n        eps_A = A_num - A_anal\n\n        # Ratio of effective numerical diffusivity to physical diffusivity\n        k_rms = np.sqrt(2) / w0\n        \n        # Use sinc(x) = sin(x)/x. R_D = sinc(k_rms * dx / 2)^2\n        arg = k_rms * dx / 2.0\n        if arg == 0:\n            R_D = 1.0\n        else:\n            sinc_val = np.sin(arg) / arg\n            R_D = sinc_val**2\n            \n        results.append([eps_w, eps_A, R_D])\n\n    # Format the final output string as a list of lists of floats\n    final_output_str = f\"[{','.join([f'[{e[0]},{e[1]},{e[2]}]' for e in results])}]\"\n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}