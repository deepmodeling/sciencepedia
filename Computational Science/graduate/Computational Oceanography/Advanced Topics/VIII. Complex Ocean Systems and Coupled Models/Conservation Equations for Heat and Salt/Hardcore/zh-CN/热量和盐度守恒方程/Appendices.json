{
    "hands_on_practices": [
        {
            "introduction": "守恒方程的第一步是准确定义要守恒的量。在现代海洋学中，TEOS-10 温盐标准框架为热含量提供了最精确的度量——保守温度（$\\Theta$）。本练习  旨在通过一个思想实验，量化在大型环流计算中使用传统的位温（$\\theta$）代替保守温度所引入的误差，从而突显选择正确热力学变量的实际重要性。",
            "id": "3787789",
            "problem": "在一个纬向重入的中纬度海盆中，考虑一个稳定的双层经向翻转环流，该环流穿过位于北纬 $32^{\\circ}\\,\\mathrm{N}$ 的一个固定断面。上层（$0$ 至 $1000\\,\\mathrm{m}$）向北输运体积，输运量为 $V_{1}$；下层（$1000\\,\\mathrm{m}$ 至海底）向南输运体积，输运量为 $V_{2}$。假设断面积分的体积输运为零，这与稳定的盐和质量收支相符。海水具有恒定的现场密度 $\\rho$，并遵循海水热力学方程 (TEOS-10)。根据该方程，比焓 $h$ 与保守温度 $\\Theta$ 成线性正比，比例常数为参考等压热容 $c_{p}^{0}$。由于可压缩性和状态方程的非线性，位温 $\\theta$ 在海洋中并非焓的严格度量。用 $\\Theta$ 计算的穿过该断面的大尺度经向热输运为\n$$\nQ_{\\Theta}=\\int_{A}\\rho\\,h\\,v\\,\\mathrm{d}A,\n$$\n其中 $v$ 是经向速度，$A$ 是断面面积。一种常见但不完美的做法是通过在焓的代理中用 $\\theta$ 替代 $\\Theta$ 来计算 $Q_{\\theta}$。从热量和盐量的局地守恒方程以及焓通量的定义出发，推导输运误差 $\\Delta Q \\equiv Q_{\\theta}-Q_{\\Theta}$ 的一个以层积分量表示的闭合形式表达式。然后，使用以下科学上合理且自洽的参数计算 $\\Delta Q$：\n\n- 上层向北输运量 $V_{1}=18\\times10^{6}\\,\\mathrm{m}^{3}\\,\\mathrm{s}^{-1}$。\n- 下层向南输运量 $V_{2}=-18\\times10^{6}\\,\\mathrm{m}^{3}\\,\\mathrm{s}^{-1}$。\n- 现场密度 $\\rho=1027\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$。\n- TEOS-10 参考等压热容 $c_{p}^{0}=3991.867\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$。\n- 在每个层内，$\\theta$ 和 $\\Theta$ 在水平方向上是均匀的，测得的层平均差异在上层为 $\\delta_{1}=\\theta_{1}-\\Theta_{1}=0.000\\,\\mathrm{K}$，在下层为 $\\delta_{2}=\\theta_{2}-\\Theta_{2}=-0.035\\,\\mathrm{K}$。\n\n以向北的输运为正。以拍瓦（petawatt）为单位表示最终的热输运误差 $\\Delta Q$，并将您的答案四舍五入到三位有效数字。使用 $1\\,\\mathrm{PW}=10^{15}\\,\\mathrm{W}$。仅提供最终的单个数值作为您的答案。",
            "solution": "该问题要求推导经向热输运误差 $\\Delta Q$ 的表达式，该误差源于使用位温 $\\theta$ 作为焓的代理，而不是使用热力学上更合适的保守温度 $\\Theta$。\n\n穿过面积为 $A$ 的断面的经向热输运的正式定义由平流比焓 $h$ 的积分给出：\n$$Q = \\int_{A} \\rho \\, h \\, v \\, \\mathrm{d}A$$\n其中 $\\rho$ 是现场密度，$v$ 是垂直于断面的经向速度分量。问题指明，海水遵循 TEOS-10 标准，其中比焓 $h$ 最好地表示为与保守温度 $\\Theta$ 成正比，比例常数为参考等压热容 $c_p^0$。因此，正确的热输运为：\n$$Q_{\\Theta} = \\int_{A} \\rho c_p^0 \\Theta v \\, \\mathrm{d}A$$\n\n一种常见但不太准确的做法是使用位温 $\\theta$ 作为热含量的代理。以此方式计算的热输运为：\n$$Q_{\\theta} = \\int_{A} \\rho c_p^0 \\theta v \\, \\mathrm{d}A$$\n\n误差 $\\Delta Q$ 是近似热输运表达式与正确热输运表达式之间的差值：\n$$\\Delta Q = Q_{\\theta} - Q_{\\Theta} = \\int_{A} \\rho c_p^0 \\theta v \\, \\mathrm{d}A - \\int_{A} \\rho c_p^0 \\Theta v \\, \\mathrm{d}A$$\n利用积分算子的线性性质，我们可以合并这两项：\n$$\\Delta Q = \\int_{A} \\rho c_p^0 (\\theta - \\Theta) v \\, \\mathrm{d}A$$\n\n该环流被描述为一个双层系统。总横截面积 $A$ 包括上层面积 $A_1$ 和下层面积 $A_2$。因此，我们可以将积分分成对应于每一层的两部分：\n$$\\Delta Q = \\int_{A_1} \\rho c_p^0 (\\theta - \\Theta) v \\, \\mathrm{d}A + \\int_{A_2} \\rho c_p^0 (\\theta - \\Theta) v \\, \\mathrm{d}A$$\n\n问题陈述，在每个层内，相关属性是均匀的。密度 $\\rho$ 和热容 $c_p^0$ 在整个区域内是恒定的。位温和保守温度之差在每一层内是恒定的：上层为 $\\delta_1 = \\theta_1 - \\Theta_1$，下层为 $\\delta_2 = \\theta_2 - \\Theta_2$。因此，我们可以将这些常量移到各自的积分之外：\n$$\\Delta Q = \\rho c_p^0 \\delta_1 \\int_{A_1} v \\, \\mathrm{d}A + \\rho c_p^0 \\delta_2 \\int_{A_2} v \\, \\mathrm{d}A$$\n\n每一层中的体积输运定义为速度在该层面积上的积分：$V_1 = \\int_{A_1} v \\, \\mathrm{d}A$ 和 $V_2 = \\int_{A_2} v \\, \\mathrm{d}A$。代入这些定义，可得到以层积分量表示的输运误差的最终闭合形式表达式：\n$$\\Delta Q = \\rho c_p^0 (\\delta_1 V_1 + \\delta_2 V_2)$$\n\n我们被给予以下参数来评估这个表达式：\n- $\\rho = 1027\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$\n- $c_p^0 = 3991.867\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$\n- $V_1 = 18 \\times 10^6\\,\\mathrm{m}^3\\,\\mathrm{s}^{-1}$\n- $V_2 = -18 \\times 10^6\\,\\mathrm{m}^3\\,\\mathrm{s}^{-1}$\n- $\\delta_1 = 0.000\\,\\mathrm{K}$\n- $\\delta_2 = -0.035\\,\\mathrm{K}$\n\n将这些值代入推导出的表达式：\n$$\\Delta Q = (1027) \\times (3991.867) \\times [ (0.000) \\times (18 \\times 10^6) + (-0.035) \\times (-18 \\times 10^6) ]$$\n方括号中项的单位是 $\\mathrm{K}\\,\\mathrm{m}^3\\,\\mathrm{s}^{-1}$，乘积 $\\rho c_p^0$ 的单位是 $\\mathrm{J}\\,\\mathrm{m}^{-3}\\,\\mathrm{K}^{-1}$。$\\Delta Q$ 的结果单位是 $\\mathrm{J}\\,\\mathrm{s}^{-1}$，即瓦特 ($\\mathrm{W}$)，这符合热输运（功率）的预期。\n\n首先，计算方括号内的项：\n$$[ (0.000) \\times (18 \\times 10^6) + (-0.035) \\times (-18 \\times 10^6) ] = 0 + (0.035 \\times 18 \\times 10^6) = 0.63 \\times 10^6 = 6.3 \\times 10^5$$\n现在，将此结果代回 $\\Delta Q$ 的方程中：\n$$\\Delta Q = (1027) \\times (3991.867) \\times (6.3 \\times 10^5)\\,\\mathrm{W}$$\n$$\\Delta Q = (4099657.409) \\times (6.3 \\times 10^5)\\,\\mathrm{W}$$\n$$\\Delta Q \\approx 2.582784 \\times 10^{12}\\,\\mathrm{W}$$\n\n问题要求以拍瓦 ($\\mathrm{PW}$) 为单位给出答案，其中 $1\\,\\mathrm{PW} = 10^{15}\\,\\mathrm{W}$。为了转换单位，我们除以 $10^{15}$：\n$$\\Delta Q = \\frac{2.582784 \\times 10^{12}}{10^{15}}\\,\\mathrm{PW} = 2.582784 \\times 10^{-3}\\,\\mathrm{PW}$$\n\n最后，将结果四舍五入到三位有效数字，我们得到：\n$$\\Delta Q \\approx 2.58 \\times 10^{-3}\\,\\mathrm{PW}$$",
            "answer": "$$\\boxed{2.58 \\times 10^{-3}}$$"
        },
        {
            "introduction": "即使我们从正确的连续物理方程出发，在将其转化为离散的数值模型时，守恒性也可能被破坏。本概念性练习  探讨了数值方案中几个常见的、会无意中产生或消耗示踪剂的陷阱，例如非守恒形式的平流项和空间变化的扩散系数。理解这些理论上的陷阱对于构建和调试可靠的海洋模型至关重要。",
            "id": "3787795",
            "problem": "在一个 $3$ 维 Boussinesq 海洋模型中，考虑一个代表位温或盐度的被动示踪剂 $C$。连续的非守恒方程写作 $D_t C = \\kappa \\nabla^2 C$，其中 $D_t = \\partial_t + \\boldsymbol{u}\\cdot\\nabla$，$\\boldsymbol{u}$ 是速度，$\\kappa$ 是（可能随空间和时间变化的）扩散系数。计算区域具有不渗透边界（无法向流）和用于扩散的均匀 Neumann 边界条件（无扩散通量）。该模型在均匀的笛卡尔网格上进行离散化，在网格中心使用配置的标量，并使用交错速度（Arakawa C-网格），平流项采用非守恒形式 $\\boldsymbol{u}\\cdot\\nabla C$ 的二阶中心差分，扩散项采用直接拉普拉斯算子 $\\kappa \\nabla^2 C$。自由表面随时间演变，因此层厚度 $h(i,j,k,t)$ 会发生变化；然而，实施者在离散化之前没有将方程乘以 $h$。速度场在连续方程中满足 $\\nabla\\cdot\\boldsymbol{u} = 0$，但离散求解器会产生一个小的、非零的离散散度。扩散系数 $\\kappa$ 可能是空间变化的，例如由于 K-剖面参数化（KPP）。\n\n仅使用诸如 Reynolds 输运定理和散度定理等基本输运原理，论证在所述非守恒离散化下 $C$ 的离散全局守恒性。以下哪些陈述正确地指出了非守恒误差的后果和来源？选择所有适用项。\n\nA. 如果离散速度场具有非零的离散散度，中心差分的非守恒平流项 $\\boldsymbol{u}\\cdot\\nabla C$ 会引入一个与 $C$ 乘以离散散度的离散和成正比的区域积分源项，因此即使在不渗透和无通量边界条件下，$C$ 的全局总和也不守恒。\n\nB. 将方程以通量形式 $\\partial_t C + \\nabla\\cdot(\\boldsymbol{u} C) = \\nabla\\cdot(\\kappa \\nabla C)$ 书写和离散化，使用有限体积法为每个面计算单个面通量，并应用不渗透和无通量边界条件，可以保证 $C$ 的单元体积加权总和在机器精度内精确守恒，这与 $\\boldsymbol{u}$ 的离散散度无关。\n\nC. 使用随空间变化的 $\\kappa$ 的 $\\kappa \\nabla^2 C$ 等价于 $\\nabla\\cdot(\\kappa \\nabla C)$，因此它不能在区域积分的示踪剂中引入非守恒源项。\n\nD. 在时变厚度 $h(i,j,k,t)$ 的层中，离散化 $D_t C$ 而不先乘以 $h$，会引入与 $\\partial_t h$ 成正比的体积积分示踪剂的伪源或伪汇，即使在连续意义上 $\\nabla\\cdot\\boldsymbol{u} = 0$ 且边通量为零。\n\nE. 在不渗透和无通量边界条件下，以通量形式离散化的迎风平流可以改变 $C$ 的全局积分，因为其数值扩散充当了 $C$ 的内部源或汇。\n\nF. 如果 $\\kappa$ 随空间变化，将扩散离散化为 $\\kappa \\nabla^2 C$ 而不是扩散通量的散度 $\\nabla\\cdot(\\kappa \\nabla C)$，会产生一个与 $\\nabla \\kappa \\cdot \\nabla C$ 成正比的内部源项，即使在无通量边界条件下，这也会改变 $C$ 的全局总和。",
            "solution": "在进行求解之前，对问题陈述进行了严格验证。\n\n### 第 1 步：提取已知条件\n- **模型与物理**：三维 Boussinesq 海洋模型。\n- **示踪剂**：被动示踪剂 $C$（位温或盐度）。\n- **控制方程（连续）**：$D_t C = \\kappa \\nabla^2 C$，其中物质导数为 $D_t = \\partial_t + \\boldsymbol{u}\\cdot\\nabla$。\n- **变量与参数**：$\\boldsymbol{u}$ 是速度矢量。$\\kappa$ 是扩散系数，可能随空间和时间变化。\n- **区域与边界条件**：计算区域具有不渗透边界，意味着无法向流（边界处 $\\boldsymbol{u} \\cdot \\boldsymbol{n} = 0$）。对于扩散，应用均匀 Neumann 边界条件，意味着边界上没有扩散通量（$(\\kappa \\nabla C) \\cdot \\boldsymbol{n} = 0$）。\n- **离散化细节**：\n    - **网格**：均匀笛卡尔网格，网格中心配置标量 $C$，速度 $\\boldsymbol{u}$ 交错布置（Arakawa C-网格）。\n    - **平流项**：非守恒形式 $\\boldsymbol{u}\\cdot\\nabla C$ 使用二阶中心差分进行离散化。\n    - **扩散项**：离散化为直接拉普拉斯算子 $\\kappa \\nabla^2 C$。\n- **附加条件**：\n    - 自由表面演变，导致层厚度 $h(i,j,k,t)$ 变化。控制方程在离散化前未乘以 $h$。\n    - 连续速度场是无散度的，$\\nabla\\cdot\\boldsymbol{u} = 0$。\n    - 来自求解器的离散速度场具有一个小的、非零的离散散度。\n    - 扩散系数 $\\kappa$ 可以是空间变化的。\n\n### 第 2 步：使用提取的已知条件进行验证\n- **科学依据**：是。问题陈述牢固地植根于计算流体动力学和海洋学的原理。它描述了常见的标准数值方法（Arakawa C-网格、中心差分）、物理近似（Boussinesq）以及众所周知的挑战（离散非无散度流、时变网格上的守恒性、守恒与非守恒形式的选择）。\n- **适定性**：是。问题要求对一个具体描述的数值格式的守恒性质进行分析。所提供的细节足以基于基本原理进行此分析。\n- **客观性**：是。语言是技术性的、精确的，并且没有主观或模糊的术语。\n- **缺陷检查清单**：问题陈述没有违反任何无效性标准。它是科学合理的、可形式化的、完整的、现实的且适定的。连续性质（例如 $\\nabla\\cdot\\boldsymbol{u} = 0$）与其离散对应物之间的区别是该问题的一个关键特征，而不是矛盾。\n\n### 第 3 步：结论与行动\n问题陈述是有效的。将推导解答。\n\n### 基于原理的推导\n\n示踪剂 $C$ 的全局守恒指的是整个区域体积 $V$ 中示踪剂总量的变化率。总量为 $\\int_V C \\, dV$。其守恒性由 Reynolds 输运定理决定，该定理指出，对于具有边界 $S$ 的固定区域 $V$：\n$$ \\frac{d}{dt} \\int_V C \\, dV = \\int_V \\frac{\\partial C}{\\partial t} \\, dV $$\n代入给定的连续方程 $\\partial_t C = -\\boldsymbol{u}\\cdot\\nabla C + \\kappa \\nabla^2 C$，我们得到：\n$$ \\frac{d}{dt} \\int_V C \\, dV = \\int_V (-\\boldsymbol{u}\\cdot\\nabla C + \\kappa \\nabla^2 C) \\, dV $$\n为了使 $C$ 的总量守恒，右侧的积分必须等于通过边界的净通量。如果边界通量为零，则该积分必须为零。我们分析每一项的离散对应物。\n\n对每个选项的分析如下：\n\n**A. 如果离散速度场具有非零的离散散度，中心差分的非守恒平流项 $\\boldsymbol{u}\\cdot\\nabla C$ 会引入一个与 $C$ 乘以离散散度的离散和成正比的区域积分源项，因此即使在不渗透和无通量边界条件下，$C$ 的全局总和也不守恒。**\n\n让我们分析平流项的体积积分 $\\int_V \\boldsymbol{u}\\cdot\\nabla C \\, dV$。使用矢量恒等式 $\\nabla \\cdot (C\\boldsymbol{u}) = (\\nabla \\cdot \\boldsymbol{u})C + \\boldsymbol{u} \\cdot \\nabla C$，我们可以将该项重写为：\n$$ \\boldsymbol{u}\\cdot\\nabla C = \\nabla \\cdot (C\\boldsymbol{u}) - C(\\nabla \\cdot \\boldsymbol{u}) $$\n对区域体积 $V$ 进行积分：\n$$ \\int_V \\boldsymbol{u}\\cdot\\nabla C \\, dV = \\int_V \\nabla \\cdot (C\\boldsymbol{u}) \\, dV - \\int_V C(\\nabla \\cdot \\boldsymbol{u}) \\, dV $$\n根据散度定理，右边的第一项变成边界通量：$\\int_V \\nabla \\cdot (C\\boldsymbol{u}) \\, dV = \\oint_S C(\\boldsymbol{u} \\cdot \\boldsymbol{n}) \\, dS$。对于不渗透边界，$\\boldsymbol{u} \\cdot \\boldsymbol{n} = 0$，所以这个面积分为零。因此，平流项的体积积分变为：\n$$ \\int_V \\boldsymbol{u}\\cdot\\nabla C \\, dV = - \\int_V C(\\nabla \\cdot \\boldsymbol{u}) \\, dV $$\n在连续情况下，问题陈述 $\\nabla \\cdot \\boldsymbol{u} = 0$，所以此项为零。然而，问题陈述*离散*速度场具有非零的离散散度，我们称之为 $(\\nabla_d \\cdot \\boldsymbol{u})$。当非守恒平流项被离散化并对所有网格单元求和（积分的离散模拟）时，分部求和恒等式的离散版本成立。离散平流项在区域体积上的总和变为：\n$$ \\sum_{i,j,k} (\\boldsymbol{u}\\cdot\\nabla C)_{d} V_{cell} = - \\sum_{i,j,k} C (\\nabla_d \\cdot \\boldsymbol{u}) V_{cell} $$\n由于 $(\\nabla_d \\cdot \\boldsymbol{u})$ 非零，此项充当一个与 $C$ 乘以离散散度成正比的伪源或伪汇。因此，$C$ 的全局总和不守恒。\n\n**结论：正确。**\n\n**B. 将方程以通量形式 $\\partial_t C + \\nabla\\cdot(\\boldsymbol{u} C) = \\nabla\\cdot(\\kappa \\nabla C)$ 书写和离散化，使用有限体积法为每个面计算单个面通量，并应用不渗透和无通量边界条件，可以保证 $C$ 的单元体积加权总和在机器精度内精确守恒，这与 $\\boldsymbol{u}$ 的离散散度无关。**\n\n在通量形式（或守恒形式）中，方程为 $\\partial_t C = -\\nabla \\cdot \\boldsymbol{F}$，其中总通量为 $\\boldsymbol{F} = \\boldsymbol{u}C - \\kappa\\nabla C$。对此为一个单元 $i$ 进行的有限体积离散化是：\n$$ \\frac{d(C_i V_i)}{dt} = -\\sum_{f \\in \\text{faces}(i)} \\boldsymbol{F}_f \\cdot \\boldsymbol{A}_f $$\n其中 $V_i$ 是单元体积，$\\boldsymbol{F}_f$ 是面 $f$ 处的通量，$\\boldsymbol{A}_f$ 是面 $f$ 的面积矢量。当我们将此方程对区域中所有单元 $i$ 求和时：\n$$ \\frac{d}{dt} \\sum_i C_i V_i = -\\sum_i \\sum_{f \\in \\text{faces}(i)} \\boldsymbol{F}_f \\cdot \\boldsymbol A_f $$\n对于单元 $i$ 和单元 $j$ 之间共享的任何内部面，离开 $i$ 的通量就是进入 $j$ 的通量。由于该方法为每个面计算一个单一、唯一的通量，因此所有内部面的贡献在全局总和中相互抵消。总和简化为仅通过外部边界面的通量。问题指定了不渗透和无通量边界条件，这意味着这些边界通量为零。因此，$\\frac{d}{dt} \\sum_i C_i V_i = 0$。此属性的成立与 $\\boldsymbol{F}$ 的构造方式无关，因此它与 $\\boldsymbol{u}$ 的离散散度无关。该陈述正确地描述了通量形式有限体积离散化的性质。\n\n**结论：正确。**\n\n**C. 使用随空间变化的 $\\kappa$ 的 $\\kappa \\nabla^2 C$ 等价于 $\\nabla\\cdot(\\kappa \\nabla C)$，因此它不能在区域积分的示踪剂中引入非守恒源项。**\n\n这个陈述基于一个错误的前提。扩散通量是 $\\boldsymbol{F}_{diff} = -\\kappa \\nabla C$。该通量的散度，代表了物理上守恒的扩散形式，是 $\\nabla \\cdot (\\kappa \\nabla C)$。使用散度的乘积法则，它展开为：\n$$ \\nabla \\cdot (\\kappa \\nabla C) = (\\nabla \\kappa) \\cdot (\\nabla C) + \\kappa (\\nabla \\cdot \\nabla C) = \\nabla \\kappa \\cdot \\nabla C + \\kappa \\nabla^2 C $$\n显然，当 $\\kappa$ 随空间变化时（即 $\\nabla \\kappa \\neq 0$），$\\kappa \\nabla^2 C$ 不等价于 $\\nabla \\cdot (\\kappa \\nabla C)$。它们的差是 $\\nabla \\kappa \\cdot \\nabla C$。由于前提是错误的，结论是无根据的。正如选项 F 的分析所示，使用 $\\kappa \\nabla^2 C$ 确实会引入一个非守恒源项。\n\n**结论：不正确。**\n\n**D. 在时变厚度 $h(i,j,k,t)$ 的层中，离散化 $D_t C$ 而不先乘以 $h$，会引入与 $\\partial_t h$ 成正比的体积积分示踪剂的伪源或伪汇，即使在连续意义上 $\\nabla\\cdot\\boldsymbol{u} = 0$ 且边通量为零。**\n\n网格单元中的守恒量不是浓度 $C$ 本身，而是总量，即 $C V_{cell}$。在一个水平维度 $\\Delta x$ 和 $\\Delta y$ 固定的网格中，单元体积是 $V_{cell} = h \\Delta x \\Delta y$，其中 $h$ 是层厚度。因此，守恒量与 $hC$ 成正比。此量的变化率是：\n$$ \\frac{\\partial (hC)}{\\partial t} = h \\frac{\\partial C}{\\partial t} + C \\frac{\\partial h}{\\partial t} $$\n该模型离散化的是关于 $\\partial_t C$（或 $D_t C$）的方程，而不是关于 $\\partial_t(hC)$ 的方程。当模型根据其计算出的倾向项更新 $C$ 时，它实际上是在求解 $h (\\partial_t C)$。然而，守恒总量的总变化必须考虑 $C(\\partial_t h)$ 项。通过直接离散化 $C$ 的方程，该格式未能考虑到由于单元体积变化导致的示踪剂总量变化。这个缺失的项 $C(\\partial_t h)$，充当了全局积分示踪剂的伪源或伪汇。\n\n**结论：正确。**\n\n**E. 在不渗透和无通量边界条件下，以通量形式离散化的迎风平流可以改变 $C$ 的全局积分，因为其数值扩散充当了 $C$ 的内部源或汇。**\n\n该陈述不正确。正如选项 B 的分析所确立的，任何以通量形式（即作为通量的散度，每个面计算单个通量）书写的平流格式，包括迎风格式，只要边界通量为零，都将在机器精度内保守示踪剂的全局积分。内部通量的抵消是通量形式有限体积法的一个结构特性。虽然迎风格式确实会引入数值扩散，但这种扩散是在区域内重新分布示踪剂，而不是全局性地产生或消灭示踪剂。全局积分的源或汇不是一个正确制定的守恒格式中数值扩散的属性。\n\n**结论：不正确。**\n\n**F. 如果 $\\kappa$ 随空间变化，将扩散离散化为 $\\kappa \\nabla^2 C$ 而不是扩散通量的散度 $\\nabla\\cdot(\\kappa \\nabla C)$，会产生一个与 $\\nabla \\kappa \\cdot \\nabla C$ 成正比的内部源项，即使在无通量边界条件下，这也会改变 $C$ 的全局总和。**\n\n正如选项 C 的分析所示，物理上守恒的扩散项是 $\\nabla\\cdot(\\kappa \\nabla C)$。离散化的项是 $\\kappa \\nabla^2 C$。差值为：\n$$ \\kappa \\nabla^2 C - \\nabla \\cdot (\\kappa \\nabla C) = - \\nabla \\kappa \\cdot \\nabla C $$\n求解的方程实际上是 $\\partial_t C + \\dots = \\text{守恒扩散} - \\nabla \\kappa \\cdot \\nabla C$。对区域体积进行积分：\n$$ \\frac{d}{dt} \\int_V C \\, dV = \\dots + \\int_V \\nabla \\cdot (\\kappa \\nabla C) \\, dV - \\int_V (\\nabla \\kappa \\cdot \\nabla C) \\, dV $$\n项 $\\int_V \\nabla \\cdot (\\kappa \\nabla C) \\, dV = \\oint_S (\\kappa \\nabla C) \\cdot \\boldsymbol{n} \\, dS$ 是穿过边界的净扩散通量。无通量边界条件将其设为零。然而，项 $-\\int_V (\\nabla \\kappa \\cdot \\nabla C) \\, dV$ 仍然存在。这是一个不保证为零的人为内部源/汇项。该项与 $\\nabla \\kappa \\cdot \\nabla C$ 成正比，并直接改变 $C$ 的全局总和。\n\n**结论：正确。**",
            "answer": "$$\\boxed{ABDF}$$"
        },
        {
            "introduction": "本章的最终实践将理论付诸行动。在理解了应守恒的物理量和需要避免的数值陷阱之后，本练习  要求您从第一性原理出发，构建一个一维示踪剂模型。通过采用构造上即守恒的有限体积法，您将亲手实现一个能够精确保证热和盐离散守恒的数值方案，并通过计算验证其守恒特性。",
            "id": "3787752",
            "problem": "您的任务是为示踪剂守恒方程设计并实现一种一维有限体积法（Finite Volume Method, FVM）。该方法在计算海洋学中用于在没有源和汇的情况下，通过平流和扩散来演化作为被动示踪剂的热量和盐度。您的设计必须保证，当层厚、密度和材料属性在空间上均匀且边界条件为周期性时，每个示踪剂的区域积分示踪剂含量分别实现离散守恒。您必须从基本守恒原理出发，推导出一个在构造上即守恒的控制体积更新方案，然后用代码实现它。\n\n请从一个通用示踪剂浓度场的基本守恒定律开始，该定律以通量形式表达在一个控制体积上。考虑一个长度为 $L$ 的一维周期性区域，该区域被划分为 $N$ 个宽度为 $\\Delta x = L/N$ 的均匀控制体积（单元），单元平均示踪剂值 $C_i(t)$ 位于单元中心 $x_i$。假设层厚和密度在空间上均匀且恒定，从而单元积分示踪剂的守恒等价于热量和盐度含量守恒（相差一个常数因子）。假设没有源和汇。设平流速度 $u$ 在空间和时间上恒定，分子或亚网格扩散率 $K$ 在空间和时间上恒定。设平流通量为 $u C$，扩散通量为 $-K \\partial C / \\partial x$。\n\n您的任务是：\n\n1) 从第一性原理出发，通过在单个以 $x_{i-1/2}$ 和 $x_{i+1/2}$ 为界的控制体积上对通量形式的守恒定律进行积分，推导出一个关于 $C_i$ 的时间和空间上离散的更新公式，该公式使用显式时间步长 $\\Delta t$，并以其面上的净通量差表示。您的推导必须清楚地说明面通量如何对单元更新做出贡献，以及为什么这种伸缩形式在没有源和汇的情况下，能保证周期性边界条件下区域积分示踪剂的离散守恒。您必须在不调用任何现成的离散化公式的情况下推导有限体积更新。\n\n2) 指定在空间上局域且一致的面通量定义，当用于有限体积更新时，能够保证守恒性。对于平流，选择一个依赖于 $u$ 符号的迎风通量。对于扩散，选择一个对面梯度使用中心差分近似。根据平流项的 Courant–Friedrichs–Lewy 条件和显式扩散限制，以 $u$、$K$ 和 $\\Delta x$ 的函数形式，陈述对 $\\Delta t$ 的任何必要稳定性条件。\n\n3) 实现您的离散化方案，以同时演化两个具有不同初始条件的示踪剂：温度 $T$（热量代理）和盐度 $S$（盐分）。使用周期性边界条件。对于下述每个测试用例，使用具有恒定时间步长 $\\Delta t$ 的显式向前欧拉法从 $t=0$ 演化到 $t=T_{\\text{end}}$。对于每个示踪剂，独立计算初始区域积分含量 $M_0 = \\sum_{i=0}^{N-1} C_i(0)\\,\\Delta x$ 和最终含量 $M_1 = \\sum_{i=0}^{N-1} C_i(T_{\\text{end}})\\,\\Delta x$，然后计算绝对相对变化 $E = \\lvert M_1 - M_0 \\rvert / \\lvert M_0 \\rvert$。对于每个测试用例，报告两个示踪剂的绝对相对变化中的最大值，即 $E_{\\max} = \\max\\{E_T,E_S\\}$。\n\n初始条件、网格和参数必须设置如下：\n- 空间网格：$x_i = (i+0.5)\\Delta x$，其中 $i \\in \\{0,1,\\dots,N-1\\}$ 且 $\\Delta x = L/N$。\n- 温度初始条件：$T(x) = 10 + \\cos\\left(2\\pi x/L\\right)$，其中 $10$ 和 $\\pi$ 是标准常数；温度单位为摄氏度，但由于只测试相对守恒性，报告的指标是无量纲的。\n- 盐度初始条件：$S(x) = 35 + 0.2 \\sin\\left(2\\pi x/L\\right) + 0.1 \\exp\\left(-\\frac{(x-0.3 L)^2}{2\\sigma^2}\\right)$，其中 $\\sigma = 0.05 L$。盐度采用实用盐度单位（无量纲），报告的指标是无量纲的。\n\n数值单位和报告：\n- 长度必须以米为单位，时间以秒为单位，速度以米/秒为单位，扩散率以平方米/秒为单位。\n- 测试用例的最终报告答案必须是代表每个用例 $E_{\\max}$ 的无量纲小数值。\n\n测试套件：\n为以下参数集提供结果，每个参数集均以上述单位表示。\n- 情况 $1$（仅平流）：$N=200$, $L=1000$, $u=0.5$, $K=0$, $\\Delta t=4.0$, $T_{\\text{end}}=1000.0$。\n- 情况 $2$（仅扩散）：$N=200$, $L=1000$, $u=0.0$, $K=10^{-2}$, $\\Delta t=1000.0$, $T_{\\text{end}}=10000.0$。\n- 情况 $3$（平流–扩散）：$N=400$, $L=2000$, $u=0.2$, $K=2\\times 10^{-3}$, $\\Delta t=8.0$, $T_{\\text{end}}=1600.0$。\n- 情况 $4$（无输运）：$N=128$, $L=500$, $u=0.0$, $K=0.0$, $\\Delta t=1.0$, $T_{\\text{end}}=100.0$。\n- 情况 $5$（接近 Courant 极限）：$N=100$, $L=100$, $u=1.0$, $K=10^{-5}$, $\\Delta t=0.9$, $T_{\\text{end}}=90.0$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按上述用例的顺序排列结果。每个条目必须是该用例的 $E_{\\max}$ 小数值（无量纲）。例如：“[e1,e2,e3,e4,e5]”。",
            "solution": "用户提供了一个有效、适定且在计算流体动力学中有科学依据的问题。任务是为被动示踪剂的平流-扩散问题推导并实现一种守恒的一维有限体积法。问题是自洽的，所有参数都已明确指定。验证检查通过，将提供一个解决方案。\n\n### 1. 守恒型有限体积法的推导\n\n基本原理是在给定体积内示踪剂量 $C(x,t)$ 的守恒。在一维且没有源和汇的情况下，守恒定律以微分通量形式表示为：\n$$\n\\frac{\\partial C}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0\n$$\n其中 $F(x,t)$ 是示踪剂的总通量。对于受速度为 $u$ 的平流和扩散率为 $K$ 的菲克扩散影响的被动示踪剂，其通量由下式给出：\n$$\nF = uC - K \\frac{\\partial C}{\\partial x}\n$$\n这里，假设 $u$ 和 $K$ 在空间和时间上是恒定的。\n\n为了推导一个在构造上即守恒的数值格式，我们使用有限体积法（FVM）。我们将长度为 $L$ 的一维区域划分为 $N$ 个均匀的控制体积（单元），索引为 $i \\in \\{0, 1, \\dots, N-1\\}$。每个单元 $i$ 的宽度为 $\\Delta x = L/N$，覆盖空间区间 $[x_{i-1/2}, x_{i+1/2}]$，其中心位于 $x_i = (i+0.5)\\Delta x$。\n\n我们在第 $i$ 个控制体积上对守恒定律进行积分：\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial C}{\\partial t} \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial F}{\\partial x} \\,dx = 0\n$$\n假设具有必要的平滑性以交换运算顺序，并对通量项应用微积分基本定理，我们得到：\n$$\n\\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} C(x,t) \\,dx + \\left[ F(x,t) \\right]_{x_{i-1/2}}^{x_{i+1/2}} = 0\n$$\n$$\n\\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} C(x,t) \\,dx + F(x_{i+1/2}, t) - F(x_{i-1/2}, t) = 0\n$$\n这个方程是一个精确的陈述：控制体积内示踪剂总量的变化率恰好由流入和流出该体积的通量之差平衡。\n\n现在我们引入单元平均浓度 $C_i(t)$，定义为：\n$$\nC_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} C(x,t) \\,dx\n$$\n由于 $\\Delta x$ 是常数，积分形式变为关于单元平均值的常微分方程：\n$$\n\\Delta x \\frac{dC_i}{dt} = F_{i-1/2} - F_{i+1/2}\n$$\n其中 $F_{i \\pm 1/2}$ 表示在相应单元面上计算的通量。\n\n为了获得一个完全离散的格式，我们使用时间步长为 $\\Delta t$ 的显式向前欧拉法对时间进行离散化。设 $C_i^n$ 是在时间 $t = n\\Delta t$ 时 $C_i(t)$ 的近似值，时间导数近似为 $(C_i^{n+1} - C_i^n)/\\Delta t$。这产生了更新规则：\n$$\n\\frac{C_i^{n+1} - C_i^n}{\\Delta t} = \\frac{1}{\\Delta x} (F_{i-1/2}^n - F_{i+1/2}^n)\n$$\n$$\nC_i^{n+1} = C_i^n + \\frac{\\Delta t}{\\Delta x} (F_{i-1/2}^n - F_{i+1/2}^n)\n$$\n通量 $F^n$ 是使用时间层 $n$ 的值计算的。\n\n对于周期性边界条件，此公式内在地保证了区域上总示踪剂含量的离散守恒。为了证明这一点，我们将所有单元的总含量 $M^{n+1} = \\sum_{i=0}^{N-1} C_i^{n+1} \\Delta x$ 相加：\n$$\nM^{n+1} = \\sum_{i=0}^{N-1} \\left(C_i^n \\Delta x + \\Delta t (F_{i-1/2}^n - F_{i+1/2}^n)\\right) = \\left(\\sum_{i=0}^{N-1} C_i^n \\Delta x\\right) + \\Delta t \\sum_{i=0}^{N-1} (F_{i-1/2}^n - F_{i+1/2}^n)\n$$\n通量差之和形成一个伸缩级数：\n$$\n\\sum_{i=0}^{N-1} (F_{i-1/2}^n - F_{i+1/2}^n) = (F_{-1/2}^n - F_{1/2}^n) + (F_{1/2}^n - F_{3/2}^n) + \\dots + (F_{N-3/2}^n - F_{N-1/2}^n) = F_{-1/2}^n - F_{N-1/2}^n\n$$\n在周期性区域中，单元 $0$ 的左边界与单元 $N-1$ 的右边界相邻。因此，$x_{-1/2}$ 等价于 $x_{N-1/2}$，通量必须相等：$F_{-1/2}^n = F_{N-1/2}^n$。这使得穿过区域边界的净通量为零。因此：\n$$\nM^{n+1} = M^n + \\Delta t \\cdot 0 \\implies M^{n+1} = M^n\n$$\n在每次实际计算中，总示踪剂含量在每个时间步都精确守恒，仅受机器浮点精度的限制。\n\n### 2. 数值通量定义和稳定性条件\n\n通过指定在单元面上的平流通量和扩散通量的数值近似，该格式得以完善。\n\n**平流通量 ($F_a$)：** 选择一阶迎风格式因其稳定性。面上的示踪剂浓度取自“迎风”单元，由速度 $u$ 的符号决定。在单元 $i$ 和 $i+1$ 之间的面 $x_{i+1/2}$ 处：\n- 如果 $u > 0$（流向从左到右），则迎风单元是 $i$：$F_{a, i+1/2}^n = u C_i^n$。\n- 如果 $u  0$（流向从右到左），则迎风单元是 $i+1$：$F_{a, i+1/2}^n = u C_{i+1}^n$。\n这可以简明地写成：\n$$\nF_{a, i+1/2}^n = \\max(u, 0) C_i^n + \\min(u, 0) C_{i+1}^n\n$$\n\n**扩散通量 ($F_d$)：** 使用二阶中心差分来近似面 $x_{i+1/2}$ 处的梯度：\n$$\n\\left. \\frac{\\partial C}{\\partial x} \\right|_{i+1/2}^n \\approx \\frac{C_{i+1}^n - C_i^n}{\\Delta x}\n$$\n于是扩散通量为：\n$$\nF_{d, i+1/2}^n = -K \\frac{C_{i+1}^n - C_i^n}{\\Delta x}\n$$\n\n面 $i+1/2$ 处的总数值通量是 $F_{i+1/2}^n = F_{a, i+1/2}^n + F_{d, i+1/2}^n$ 之和。\n\n**稳定性条件：** 使用显式向前欧拉时间步进格式对时间步长 $\\Delta t$ 施加了稳定性约束：\n1.  **平流的 Courant–Friedrichs–Lewy (CFL) 条件：** Courant 数 $c$ 必须不大于 $1$。\n    $$\n    c = \\frac{|u| \\Delta t}{\\Delta x} \\le 1\n    $$\n2.  **扩散的稳定性条件：** 扩散数 $d$ 必须不大于 $0.5$。\n    $$\n    d = \\frac{K \\Delta t}{(\\Delta x)^2} \\le 0.5\n    $$\n为使模拟稳定，必须选择 $\\Delta t$ 以同时满足这两个条件。所有指定测试用例的参数都已选择以满足这些标准。\n\n### 3. 实现与分析\n\n所推导的格式被实现用来同时但独立地演化两个示踪剂场：温度 $T$ 和盐度 $S$。对于每个测试用例，模型使用指定的条件进行初始化，并运行至 $t=T_{\\text{end}}$。对 $T$ 和 $S$ 分别计算初始区域积分含量 $M_0 = \\sum_{i=0}^{N-1} C_i(0)\\Delta x$ 和最终含量 $M_1 = \\sum_{i=0}^{N-1} C_i(T_{\\text{end}})\\Delta x$。然后计算每个示踪剂的绝对相对变化 $E = |M_1 - M_0|/|M_0|$。每个用例的最终结果是这两个值中的最大值，$E_{\\max} = \\max\\{E_T, E_S\\}$，它量化了由浮点运算引起的数值守恒误差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(N, L, u, K, dt, T_end):\n    \"\"\"\n    Solves the 1D advection-diffusion equation for two tracers (T, S)\n    using a conservative finite volume method.\n\n    Args:\n        N (int): Number of grid cells.\n        L (float): Domain length (m).\n        u (float): Advection velocity (m/s).\n        K (float): Diffusivity (m^2/s).\n        dt (float): Time step (s).\n        T_end (float): Total simulation time (s).\n\n    Returns:\n        float: The maximum absolute relative change in total tracer content.\n    \"\"\"\n    # 1. Grid and parameter setup\n    dx = L / N\n    x = (np.arange(N) + 0.5) * dx\n    n_steps = int(round(T_end / dt))\n\n    # 2. Initial Conditions\n    # Temperature\n    T = 10.0 + np.cos(2.0 * np.pi * x / L)\n    \n    # Salinity\n    sigma = 0.05 * L\n    S = 35.0 + 0.2 * np.sin(2.0 * np.pi * x / L) + \\\n        0.1 * np.exp(-((x - 0.3 * L)**2) / (2.0 * sigma**2))\n\n    # 3. Calculate initial total content for each tracer\n    # The total content is sum(C_i) * dx. dx is a constant factor that\n    # cancels in the relative error calculation, so we can use sum(C_i).\n    M0_T = np.sum(T)\n    M0_S = np.sum(S)\n\n    # Pre-calculate factors for efficiency\n    u_pos = max(u, 0)\n    u_neg = min(u, 0)\n    adv_diff_factor = dt / dx\n    diff_factor = K / dx\n\n    # 4. Time-stepping loop\n    for _ in range(n_steps):\n        # --- Update Temperature (T) ---\n        # Get values from neighboring cells using periodic boundaries\n        T_right = np.roll(T, -1)  # T_{i+1}\n        \n        # Calculate advective flux at the right face of each cell (i+1/2)\n        flux_adv_T = u_pos * T + u_neg * T_right\n        \n        # Calculate diffusive flux at the right face of each cell (i+1/2)\n        flux_diff_T = -diff_factor * (T_right - T)\n        \n        # Total flux at the right face (i+1/2)\n        flux_total_T = flux_adv_T + flux_diff_T\n        \n        # Flux at the left face (i-1/2), which is the right face of cell i-1\n        flux_in_T = np.roll(flux_total_T, 1) # flux_{i-1/2}\n\n        # Update cell average using the conservative FVM formula\n        T += adv_diff_factor * (flux_in_T - flux_total_T)\n\n        # --- Update Salinity (S) ---\n        # Get values from neighboring cells\n        S_right = np.roll(S, -1) # S_{i+1}\n        \n        # Calculate advective and diffusive fluxes\n        flux_adv_S = u_pos * S + u_neg * S_right\n        flux_diff_S = -diff_factor * (S_right - S)\n        \n        # Total flux at the right face (i+1/2)\n        flux_total_S = flux_adv_S + flux_diff_S\n        \n        # Flux at the left face (i-1/2)\n        flux_in_S = np.roll(flux_total_S, 1) # flux_{i-1/2}\n        \n        # Update cell average\n        S += adv_diff_factor * (flux_in_S - flux_total_S)\n\n    # 5. Calculate final total content and relative change\n    M1_T = np.sum(T)\n    M1_S = np.sum(S)\n\n    # Avoid division by zero, though ICs make M0 non-zero here.\n    E_T = np.abs((M1_T - M0_T) / M0_T) if M0_T != 0 else 0.0\n    E_S = np.abs((M1_S - M0_S) / M0_S) if M0_S != 0 else 0.0\n\n    return max(E_T, E_S)\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple is (N, L, u, K, dt, T_end)\n    test_cases = [\n        (200, 1000.0, 0.5, 0.0, 4.0, 1000.0),            # Case 1\n        (200, 1000.0, 0.0, 1e-2, 1000.0, 10000.0),       # Case 2\n        (400, 2000.0, 0.2, 2e-3, 8.0, 1600.0),           # Case 3\n        (128, 500.0, 0.0, 0.0, 1.0, 100.0),             # Case 4\n        (100, 100.0, 1.0, 1e-5, 0.9, 90.0),              # Case 5\n    ]\n\n    results = []\n    for params in test_cases:\n        E_max = run_simulation(*params)\n        results.append(E_max)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}