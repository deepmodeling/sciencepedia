{
    "hands_on_practices": [
        {
            "introduction": "守恒律的离散化是计算海洋学中的核心挑战。理论上的守恒定律必须在其数值对应物中得到精确反映，以避免在模拟中产生虚假的物质或能量源汇。本练习 () 将指导您从第一性原理出发，构建一个一维示踪剂输运模型，通过有限体积法确保离散格式在结构上是守恒的。这是建立可靠的海洋和气候模型的基础技能。",
            "id": "3787752",
            "problem": "你的任务是设计并实现一种一维有限体积法（Finite Volume Method, FVM），用于求解计算海洋学中的示踪剂守恒方程，以在没有源汇项的情况下，通过平流和扩散来演化作为被动示踪剂的热量和盐度。当层厚度、密度和材料属性在空间上均匀且边界条件为周期性时，你的设计必须保证每个示踪剂的区域积分含量是离散守恒的。你必须从基本守恒原理出发，推导出一个在构造上即守恒的控制体更新方案，然后用代码实现它。\n\n从一个通用示踪剂浓度场的基本守恒定律出发，该定律以在控制体上的通量形式表示。考虑一个长度为 $L$ 的一维周期性区域，该区域被划分为 $N$ 个宽度为 $\\Delta x = L/N$ 的均匀控制体（单元），单元平均示踪剂值 $C_i(t)$ 位于单元中心 $x_i$。假设层厚度和密度在空间上均匀且恒定，因此单元积分示踪剂的守恒在相差一个常数因子的情况下等价于热量和盐度含量的守恒。假设没有源项和汇项。设平流速度 $u$ 在空间和时间上是恒定的，分子或亚网格扩散率 $K$ 在空间和时间上是恒定的。设平流通量为 $u C$，扩散通量为 $-K \\partial C / \\partial x$。\n\n你的任务是：\n\n1) 从第一性原理出发，通过在单个以 $x_{i-1/2}$ 和 $x_{i+1/2}$ 为边界的控制体上对通量形式的守恒定律进行积分，推导出一个关于 $C_i$ 的时间和空间上都离散的更新方案。该方案用其表面的净通量差和显式时间步长 $\\Delta t$ 来表示。你的推导必须清楚地指明面通量如何对单元更新做出贡献，以及为什么在没有源汇项和周期性边界的条件下，这种伸缩形式保证了区域积分示踪剂的离散守恒。你必须在不调用任何现成的离散化公式的情况下推导有限体积更新方案。\n\n2) 为面通量指定一致的、空间局部的定义，当这些定义用于有限体积更新方案时，能保证守恒性。对于平流，选择一个依赖于 $u$ 符号的迎风格式通量。对于扩散，为面梯度选择一个中心差分近似。根据平流项的 Courant–Friedrichs–Lewy 条件和显式扩散限制，以 $u$、$K$ 和 $\\Delta x$ 的函数形式，陈述对 $\\Delta t$ 的任何必要稳定性条件。\n\n3) 实现你的离散化方案，以同时演化两个具有不同初始条件的示踪剂：温度 $T$（热量代理）和盐度 $S$（盐分）。使用周期性边界条件。对于下面的每个测试案例，使用具有恒定时间步长 $\\Delta t$ 的显式前向欧拉法从 $t=0$ 演化到 $t=T_{\\text{end}}$。对每个示踪剂独立地计算初始区域积分含量 $M_0 = \\sum_{i=0}^{N-1} C_i(0)\\,\\Delta x$ 和最终含量 $M_1 = \\sum_{i=0}^{N-1} C_i(T_{\\text{end}})\\,\\Delta x$，然后计算绝对相对变化 $E = \\lvert M_1 - M_0 \\rvert / \\lvert M_0 \\rvert$。对于每个测试案例，报告两种示踪剂的绝对相对变化中的最大值，即 $E_{\\max} = \\max\\{E_T,E_S\\}$。\n\n初始条件、网格和参数必须设置如下：\n- 空间网格：$x_i = (i+0.5)\\Delta x$，其中 $i \\in \\{0,1,\\dots,N-1\\}$ 且 $\\Delta x = L/N$。\n- 温度初始条件：$T(x) = 10 + \\cos\\left(2\\pi x/L\\right)$，其中 $10$ 和 $\\pi$ 是标准常数；温度单位为摄氏度，但由于只测试相对守恒性，报告的指标是无量纲的。\n- 盐度初始条件：$S(x) = 35 + 0.2 \\sin\\left(2\\pi x/L\\right) + 0.1 \\exp\\left(-\\frac{(x-0.3 L)^2}{2\\sigma^2}\\right)$，其中 $\\sigma = 0.05 L$。盐度采用实用盐度单位（无量纲），报告的指标是无量纲的。\n\n数值单位和报告：\n- 长度单位必须是米，时间单位是秒，速度单位是米/秒，扩散率单位是平方米/秒。\n- 测试案例的最终答案必须是无量纲的十进制数，表示每种情况下的 $E_{\\max}$。\n\n测试套件：\n为以下参数集提供结果，每个参数集均使用上述单位表示。\n- 案例 1（仅平流）：$N=200$，$L=1000$，$u=0.5$，$K=0$，$\\Delta t=4.0$，$T_{\\text{end}}=1000.0$。\n- 案例 2（仅扩散）：$N=200$，$L=1000$，$u=0.0$，$K=10^{-2}$，$\\Delta t=1000.0$，$T_{\\text{end}}=10000.0$。\n- 案例 3（平流-扩散）：$N=400$，$L=2000$，$u=0.2$，$K=2\\times 10^{-3}$，$\\Delta t=8.0$，$T_{\\text{end}}=1600.0$。\n- 案例 4（无输运）：$N=128$，$L=500$，$u=0.0$，$K=0.0$，$\\Delta t=1.0$，$T_{\\text{end}}=100.0$。\n- 案例 5（接近 Courant 极限）：$N=100$，$L=100$，$u=1.0$，$K=10^{-5}$，$\\Delta t=0.9$，$T_{\\text{end}}=90.0$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按上述案例的顺序排列。每个条目必须是该案例的 $E_{\\max}$ 的十进制值（无量纲）。例如：“[e1,e2,e3,e4,e5]”。",
            "solution": "用户提供了一个有效、适定的问题，该问题在计算流体动力学方面有坚实的科学基础。任务是推导并实现一个用于被动示踪剂平流-扩散的一维守恒有限体积法。问题是自包含的，所有参数都已明确指定。验证检查通过，将提供一个解决方案。\n\n### 1. 守恒有限体积法的推导\n\n基本原理是在给定体积内示踪剂数量 $C(x,t)$ 的守恒。在一维情况下，且无源汇项时，守恒定律的微分通量形式表示为：\n$$\n\\frac{\\partial C}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0\n$$\n其中 $F(x,t)$ 是示踪剂的总通量。对于一个受速度为 $u$ 的平流和扩散率为 $K$ 的菲克扩散影响的被动示踪剂，其通量由下式给出：\n$$\nF = uC - K \\frac{\\partial C}{\\partial x}\n$$\n这里，假设 $u$ 和 $K$ 在空间和时间上是常数。\n\n为了推导出一个在构造上即守恒的数值格式，我们使用有限体积法（FVM）。我们将长度为 $L$ 的一维区域划分为 $N$ 个均匀的控制体（单元），索引为 $i \\in \\{0, 1, \\dots, N-1\\}$。每个单元 $i$ 的宽度为 $\\Delta x = L/N$，空间范围为 $[x_{i-1/2}, x_{i+1/2}]$，其中心位于 $x_i = (i+0.5)\\Delta x$。\n\n我们在第 $i$ 个控制体上对守恒定律进行积分：\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial C}{\\partial t} \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial F}{\\partial x} \\,dx = 0\n$$\n假设具有必要的平滑性以交换运算顺序，并对通量项应用微积分基本定理，我们得到：\n$$\n\\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} C(x,t) \\,dx + \\left[ F(x,t) \\right]_{x_{i-1/2}}^{x_{i+1/2}} = 0\n$$\n$$\n\\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} C(x,t) \\,dx + F(x_{i+1/2}, t) - F(x_{i-1/2}, t) = 0\n$$\n这个方程是一个精确的陈述：控制体内示踪剂总量的变化率恰好由流入和流出该体积的通量之差所平衡。\n\n现在我们引入单元平均浓度 $C_i(t)$，其定义为：\n$$\nC_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} C(x,t) \\,dx\n$$\n由于 $\\Delta x$ 是常数，积分形式变为一个关于单元平均值的常微分方程：\n$$\n\\Delta x \\frac{dC_i}{dt} = F_{i-1/2} - F_{i+1/2}\n$$\n其中 $F_{i \\pm 1/2}$ 表示在相应单元面上计算的通量。\n\n为了得到一个完全离散的格式，我们使用时间步长为 $\\Delta t$ 的显式前向欧拉法对时间进行离散化。令 $C_i^n$ 为在时间 $t = n\\Delta t$ 时对 $C_i(t)$ 的近似，时间导数近似为 $(C_i^{n+1} - C_i^n)/\\Delta t$。这得出了更新法则：\n$$\n\\frac{C_i^{n+1} - C_i^n}{\\Delta t} = \\frac{1}{\\Delta x} (F_{i-1/2}^n - F_{i+1/2}^n)\n$$\n$$\nC_i^{n+1} = C_i^n + \\frac{\\Delta t}{\\Delta x} (F_{i-1/2}^n - F_{i+1/2}^n)\n$$\n通量 $F^n$ 是使用时间层 $n$ 的值计算的。\n\n对于周期性边界条件，这种形式内在地保证了区域上总示踪剂含量的离散守恒。为了证明这一点，我们对所有单元的总含量 $M^{n+1} = \\sum_{i=0}^{N-1} C_i^{n+1} \\Delta x$ 进行求和：\n$$\nM^{n+1} = \\sum_{i=0}^{N-1} \\left(C_i^n \\Delta x + \\Delta t (F_{i-1/2}^n - F_{i+1/2}^n)\\right) = \\left(\\sum_{i=0}^{N-1} C_i^n \\Delta x\\right) + \\Delta t \\sum_{i=0}^{N-1} (F_{i-1/2}^n - F_{i+1/2}^n)\n$$\n通量差的和构成一个伸缩级数：\n$$\n\\sum_{i=0}^{N-1} (F_{i-1/2}^n - F_{i+1/2}^n) = (F_{-1/2}^n - F_{1/2}^n) + (F_{1/2}^n - F_{3/2}^n) + \\dots + (F_{N-3/2}^n - F_{N-1/2}^n) = F_{-1/2}^n - F_{N-1/2}^n\n$$\n在周期性区域中，单元 $0$ 的左边界与单元 $N-1$ 的右边界相连。因此，$x_{-1/2}$ 等价于 $x_{N-1/2}$，通量必须相等：$F_{-1/2}^n = F_{N-1/2}^n$。这使得穿过区域边界的净通量为零。因此：\n$$\nM^{n+1} = M^n + \\Delta t \\cdot 0 \\implies M^{n+1} = M^n\n$$\n在实际计算中，总示踪剂含量在每个时间步都精确守恒，仅受机器浮点精度的限制。\n\n### 2. 数值通量定义和稳定性条件\n\n通过指定在单元面上的平流通量和扩散通量的数值近似，该格式得以完善。\n\n**平流通量 ($F_a$)：** 为其稳定性选择了一阶迎风格式。面上的示踪剂浓度取自“上风”单元，该单元由速度 $u$ 的符号决定。在单元 $i$ 和 $i+1$ 之间的面 $x_{i+1/2}$ 处：\n- 如果 $u > 0$（流向从左到右），上风单元是 $i$：$F_{a, i+1/2}^n = u C_i^n$。\n- 如果 $u   0$（流向从右到左），上风单元是 $i+1$：$F_{a, i+1/2}^n = u C_{i+1}^n$。\n这可以简洁地写成：\n$$\nF_{a, i+1/2}^n = \\max(u, 0) C_i^n + \\min(u, 0) C_{i+1}^n\n$$\n\n**扩散通量 ($F_d$)：** 使用二阶中心差分来近似面 $x_{i+1/2}$ 处的梯度：\n$$\n\\left. \\frac{\\partial C}{\\partial x} \\right|_{i+1/2}^n \\approx \\frac{C_{i+1}^n - C_i^n}{\\Delta x}\n$$\n扩散通量则为：\n$$\nF_{d, i+1/2}^n = -K \\frac{C_{i+1}^n - C_i^n}{\\Delta x}\n$$\n\n面 $i+1/2$ 处的总数值通量是 $F_{i+1/2}^n = F_{a, i+1/2}^n + F_{d, i+1/2}^n$ 的和。\n\n**稳定性条件：** 使用显式前向欧拉时间步进格式对时间步长 $\\Delta t$ 施加了稳定性约束：\n1.  **针对平流的 Courant–Friedrichs–Lewy (CFL) 条件：** Courant 数 $c$ 不得大于 $1$。\n    $$\n    c = \\frac{|u| \\Delta t}{\\Delta x} \\le 1\n    $$\n2.  **针对扩散的稳定性条件：** 扩散数 $d$ 不得大于 $0.5$。\n    $$\n    d = \\frac{2K \\Delta t}{(\\Delta x)^2} \\le 1\n    $$\n为使模拟稳定，必须选择 $\\Delta t$ 以同时满足这两个条件。所有指定测试案例的参数都已选择以满足这些标准。\n\n### 3. 实现与分析\n\n所推导的格式被实现来同时但独立地演化两个示踪剂场，即温度 $T$ 和盐度 $S$。对于每个测试案例，模型使用指定的条件进行初始化，并运行直到 $t=T_{\\text{end}}$。计算 $T$ 和 $S$ 的初始区域积分含量 $M_0 = \\sum_{i=0}^{N-1} C_i(0)\\Delta x$ 和最终含量 $M_1 = \\sum_{i=0}^{N-1} C_i(T_{\\text{end}})\\Delta x$。对每个示踪剂计算绝对相对变化 $E = |M_1 - M_0|/|M_0|$。每个案例的最终结果是这两个值的最大值 $E_{\\max} = \\max\\{E_T, E_S\\}$，它量化了由浮点运算引起的数值守恒误差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(N, L, u, K, dt, T_end):\n    \"\"\"\n    Solves the 1D advection-diffusion equation for two tracers (T, S)\n    using a conservative finite volume method.\n\n    Args:\n        N (int): Number of grid cells.\n        L (float): Domain length (m).\n        u (float): Advection velocity (m/s).\n        K (float): Diffusivity (m^2/s).\n        dt (float): Time step (s).\n        T_end (float): Total simulation time (s).\n\n    Returns:\n        float: The maximum absolute relative change in total tracer content.\n    \"\"\"\n    # 1. Grid and parameter setup\n    dx = L / N\n    x = (np.arange(N) + 0.5) * dx\n    n_steps = int(round(T_end / dt))\n\n    # 2. Initial Conditions\n    # Temperature\n    T = 10.0 + np.cos(2.0 * np.pi * x / L)\n    \n    # Salinity\n    sigma = 0.05 * L\n    S = 35.0 + 0.2 * np.sin(2.0 * np.pi * x / L) + \\\n        0.1 * np.exp(-((x - 0.3 * L)**2) / (2.0 * sigma**2))\n\n    # 3. Calculate initial total content for each tracer\n    # The total content is sum(C_i) * dx. dx is a constant factor that\n    # cancels in the relative error calculation, so we can use sum(C_i).\n    M0_T = np.sum(T)\n    M0_S = np.sum(S)\n\n    # Pre-calculate factors for efficiency\n    u_pos = max(u, 0)\n    u_neg = min(u, 0)\n    adv_diff_factor = dt / dx\n    diff_factor = K / dx\n\n    # 4. Time-stepping loop\n    for _ in range(n_steps):\n        # --- Update Temperature (T) ---\n        # Get values from neighboring cells using periodic boundaries\n        T_right = np.roll(T, -1)  # T_{i+1}\n        \n        # Calculate advective flux at the right face of each cell (i+1/2)\n        flux_adv_T = u_pos * T + u_neg * T_right\n        \n        # Calculate diffusive flux at the right face of each cell (i+1/2)\n        flux_diff_T = -diff_factor * (T_right - T)\n        \n        # Total flux at the right face (i+1/2)\n        flux_total_T = flux_adv_T + flux_diff_T\n        \n        # Flux at the left face (i-1/2), which is the right face of cell i-1\n        flux_in_T = np.roll(flux_total_T, 1) # flux_{i-1/2}\n\n        # Update cell average using the conservative FVM formula\n        T += adv_diff_factor * (flux_in_T - flux_total_T)\n\n        # --- Update Salinity (S) ---\n        # Get values from neighboring cells\n        S_right = np.roll(S, -1) # S_{i+1}\n        \n        # Calculate advective and diffusive fluxes\n        flux_adv_S = u_pos * S + u_neg * S_right\n        flux_diff_S = -diff_factor * (S_right - S)\n        \n        # Total flux at the right face (i+1/2)\n        flux_total_S = flux_adv_S + flux_diff_S\n        \n        # Flux at the left face (i-1/2)\n        flux_in_S = np.roll(flux_total_S, 1) # flux_{i-1/2}\n        \n        # Update cell average\n        S += adv_diff_factor * (flux_in_S - flux_total_S)\n\n    # 5. Calculate final total content and relative change\n    M1_T = np.sum(T)\n    M1_S = np.sum(S)\n\n    # Avoid division by zero, though ICs make M0 non-zero here.\n    E_T = np.abs((M1_T - M0_T) / M0_T) if M0_T != 0 else 0.0\n    E_S = np.abs((M1_S - M0_S) / M0_S) if M0_S != 0 else 0.0\n\n    return max(E_T, E_S)\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple is (N, L, u, K, dt, T_end)\n    test_cases = [\n        (200, 1000.0, 0.5, 0.0, 4.0, 1000.0),            # Case 1\n        (200, 1000.0, 0.0, 1e-2, 1000.0, 10000.0),       # Case 2\n        (400, 2000.0, 0.2, 2e-3, 8.0, 1600.0),           # Case 3\n        (128, 500.0, 0.0, 0.0, 1.0, 100.0),             # Case 4\n        (100, 100.0, 1.0, 1e-5, 0.9, 90.0),              # Case 5\n    ]\n\n    results = []\n    for params in test_cases:\n        E_max = run_simulation(*params)\n        results.append(E_max)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了如何构建守恒格式后，我们必须仔细考虑我们究竟在守恒什么量。本练习 () 深入探讨了现代海洋学中的一个关键细节：位温 ($\\theta$) 和保守温度 ($\\Theta$) 之间的区别。通过计算使用旧的、不太准确的热含量代理所引入的热输送误差，您将对为何 TEOS-10 框架对于精确的气候研究至关重要获得切实的理解。",
            "id": "3787789",
            "problem": "在一个纬向重入的中纬度海盆中，考虑一个稳定的、双层的经向翻转环流，该环流穿过北纬 $32^{\\circ}$ 的一个固定断面。上层（$0$至$1000\\,\\mathrm{m}$）以 $V_{1}$ 的输运量向北输运海水，下层（$1000\\,\\mathrm{m}$至海底）以 $V_{2}$ 的输运量向南输运海水。假设断面积分的体积输运为零，这与稳定的盐和质量收支相符。海水具有恒定的原位密度 $\\rho$ 并遵循海水热力学方程（TEOS-10），根据该方程，比焓 $h$ 与保守温度 $\\Theta$ 成线性比例，其比例常数为一个恒定的参考等压热容 $c_{p}^{0}$。由于可压缩性和状态方程的非线性，位温 $\\theta$ 在海洋中并不是焓的严格量度。用 $\\Theta$ 计算的穿过该断面的大尺度经向热输运为\n$$\nQ_{\\Theta}=\\int_{A}\\rho\\,h\\,v\\,\\mathrm{d}A,\n$$\n其中 $v$ 是经向速度，$A$ 是断面面积。一种常见但不完善的做法是在焓的代理计算中用 $\\theta$ 代替 $\\Theta$ 来计算 $Q_{\\theta}$。从热量和盐量的局地守恒方程以及焓通量的定义出发，推导输运误差 $\\Delta Q \\equiv Q_{\\theta}-Q_{\\Theta}$ 的一个以层积分量表示的闭合表达式。然后，使用以下科学上合理且自洽的参数来评估 $\\Delta Q$：\n\n- 上层向北输运量 $V_{1}=18\\times10^{6}\\,\\mathrm{m}^{3}\\,\\mathrm{s}^{-1}$。\n- 下层向南输运量 $V_{2}=-18\\times10^{6}\\,\\mathrm{m}^{3}\\,\\mathrm{s}^{-1}$。\n- 原位密度 $\\rho=1027\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$。\n- TEOS-10 参考等压热容 $c_{p}^{0}=3991.867\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$。\n- 在每一层内，$\\theta$ 和 $\\Theta$ 在水平方向上是均匀的，测得的层平均差异在上层为 $\\delta_{1}=\\theta_{1}-\\Theta_{1}=0.000\\,\\mathrm{K}$，在下层为 $\\delta_{2}=\\theta_{2}-\\Theta_{2}=-0.035\\,\\mathrm{K}$。\n\n规定向北的输运为正。以拍瓦（petawatts）为单位表示最终的热输运误差 $\\Delta Q$，并将您的答案四舍五入到三位有效数字。使用 $1\\,\\mathrm{PW}=10^{15}\\,\\mathrm{W}$。只需提供最终的数值作为您的答案。",
            "solution": "该问题要求推导经向热输运误差 $\\Delta Q$ 的表达式，该误差源于使用位温 $\\theta$ 而非热力学上更恰当的保守温度 $\\Theta$ 作为焓的代理。\n\n穿过面积为 $A$ 的断面的经向热输运的正式定义由平流比焓 $h$ 的积分给出：\n$$Q = \\int_{A} \\rho \\, h \\, v \\, \\mathrm{d}A$$\n其中 $\\rho$ 是原位密度，$v$ 是垂直于断面的经向速度分量。问题指明，海水遵循TEOS-10标准，其中比焓 $h$ 最好地表示为与保守温度 $\\Theta$ 成正比，比例常数为参考等压热容 $c_p^0$。因此，正确的输运热量为：\n$$Q_{\\Theta} = \\int_{A} \\rho c_p^0 \\Theta v \\, \\mathrm{d}A$$\n\n一种常见但不太准确的做法是使用位温 $\\theta$ 作为热含量的代理。以此方式计算的热输运为：\n$$Q_{\\theta} = \\int_{A} \\rho c_p^0 \\theta v \\, \\mathrm{d}A$$\n\n误差 $\\Delta Q$ 是近似热输运表达式与正确热输运表达式之差：\n$$\\Delta Q = Q_{\\theta} - Q_{\\Theta} = \\int_{A} \\rho c_p^0 \\theta v \\, \\mathrm{d}A - \\int_{A} \\rho c_p^0 \\Theta v \\, \\mathrm{d}A$$\n利用积分算子的线性性质，我们可以合并这两项：\n$$\\Delta Q = \\int_{A} \\rho c_p^0 (\\theta - \\Theta) v \\, \\mathrm{d}A$$\n\n该环流被描述为一个双层系统。总横截面积 $A$ 包括上层面积 $A_1$ 和下层面积 $A_2$。因此，我们可以将积分分成对应于每一层的两部分：\n$$\\Delta Q = \\int_{A_1} \\rho c_p^0 (\\theta - \\Theta) v \\, \\mathrm{d}A + \\int_{A_2} \\rho c_p^0 (\\theta - \\Theta) v \\, \\mathrm{d}A$$\n\n问题陈述，在每一层内，相关属性是均匀的。密度 $\\rho$ 和热容 $c_p^0$ 在整个区域内是恒定的。位温和保守温度之间的差异在每一层内是恒定的：上层为 $\\delta_1 = \\theta_1 - \\Theta_1$，下层为 $\\delta_2 = \\theta_2 - \\Theta_2$。因此，我们可以将这些常量移到各自的积分之外：\n$$\\Delta Q = \\rho c_p^0 \\delta_1 \\int_{A_1} v \\, \\mathrm{d}A + \\rho c_p^0 \\delta_2 \\int_{A_2} v \\, \\mathrm{d}A$$\n\n每一层中的体积输运定义为速度在该层面积上的积分：$V_1 = \\int_{A_1} v \\, \\mathrm{d}A$ 和 $V_2 = \\int_{A_2} v \\, \\mathrm{d}A$。代入这些定义，即可得到以层积分量表示的输运误差的最终闭合表达式：\n$$\\Delta Q = \\rho c_p^0 (\\delta_1 V_1 + \\delta_2 V_2)$$\n\n为计算此表达式，我们给定了以下参数：\n- $\\rho = 1027\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$\n- $c_p^0 = 3991.867\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$\n- $V_1 = 18 \\times 10^6\\,\\mathrm{m}^3\\,\\mathrm{s}^{-1}$\n- $V_2 = -18 \\times 10^6\\,\\mathrm{m}^3\\,\\mathrm{s}^{-1}$\n- $\\delta_1 = 0.000\\,\\mathrm{K}$\n- $\\delta_2 = -0.035\\,\\mathrm{K}$\n\n将这些值代入推导出的表达式中：\n$$\\Delta Q = (1027) \\times (3991.867) \\times [ (0.000) \\times (18 \\times 10^6) + (-0.035) \\times (-18 \\times 10^6) ]$$\n方括号中项的单位是 $\\mathrm{K}\\,\\mathrm{m}^3\\,\\mathrm{s}^{-1}$，而乘积 $\\rho c_p^0$ 的单位是 $\\mathrm{J}\\,\\mathrm{m}^{-3}\\,\\mathrm{K}^{-1}$。因此，$\\Delta Q$ 的结果单位是 $\\mathrm{J}\\,\\mathrm{s}^{-1}$，即瓦特（$\\mathrm{W}$），这符合热输运（功率）的预期。\n\n首先，计算方括号内的项：\n$$[ (0.000) \\times (18 \\times 10^6) + (-0.035) \\times (-18 \\times 10^6) ] = 0 + (0.035 \\times 18 \\times 10^6) = 0.63 \\times 10^6 = 6.3 \\times 10^5$$\n现在，将此结果代回 $\\Delta Q$ 的方程中：\n$$\\Delta Q = (1027) \\times (3991.867) \\times (6.3 \\times 10^5)\\,\\mathrm{W}$$\n$$\\Delta Q = (4099657.409) \\times (6.3 \\times 10^5)\\,\\mathrm{W}$$\n$$\\Delta Q \\approx 2.582784 \\times 10^{12}\\,\\mathrm{W}$$\n\n问题要求以拍瓦（$\\mathrm{PW}$）为单位给出答案，其中 $1\\,\\mathrm{PW} = 10^{15}\\,\\mathrm{W}$。为了转换单位，我们除以 $10^{15}$：\n$$\\Delta Q = \\frac{2.582784 \\times 10^{12}}{10^{15}}\\,\\mathrm{PW} = 2.582784 \\times 10^{-3}\\,\\mathrm{PW}$$\n\n最后，将结果四舍五入到三位有效数字，我们得到：\n$$\\Delta Q \\approx 2.58 \\times 10^{-3}\\,\\mathrm{PW}$$",
            "answer": "$$\\boxed{2.58 \\times 10^{-3}}$$"
        },
        {
            "introduction": "理论方程和数值模型在理想化的世界中运行，但现实世界的海洋学研究依赖于不完美的观测数据。最后一个练习 () 通过一项任务连接了理论与应用：使用带有相关不确定性的模拟“观测”数据来闭合一个区域热收支。您将学习不确定性传播的基本技能，并判断一个收支在统计上是否“闭合”，这是地球科学诊断研究的基石。",
            "id": "3787758",
            "problem": "考虑一个具有侧向边界和自由表面的固定控制体积矩形海域。令热含量定义为 $H(t) = \\int_{V} \\rho c_p T(\\mathbf{x},t)\\, \\mathrm{d}V$，其中 $\\rho$ 是海水密度，$c_p$ 是恒压比热容，$T$ 是原位温度，$V$ 是该区域的体积。假设 Boussinesq 近似（质量守恒中 $\\rho$ 为常数），并且对于此收支而言，除表面热通量外的内部热源在主导阶上可以忽略不计。从能量守恒出发，并利用 Gauss 定理处理穿过控制面的通量，可以将箱式积分的热收支写成趋势项和边界通量的形式。定义以下带符号的、体积积分的项，每项均以瓦特（Watts）为单位表示，符号约定为正值表示控制体积内海洋热含量的增加：\n- 趋势项 $T_{\\mathrm{HC}} = \\mathrm{d}H/\\mathrm{d}t$。\n- 在表面上积分的净表面热通量 $Q_{\\mathrm{surf}} = \\int_{A} Q_{\\mathrm{net}}(\\mathbf{x},t)\\, \\mathrm{d}A$，其中 $Q_{\\mathrm{net}}$ 指向海洋为正。\n- 侧向平流热输送 $F_{\\mathrm{adv}} = \\oint_{\\partial V_{\\mathrm{lat}}} \\rho c_p T\\, \\mathbf{u}\\cdot \\mathbf{n}\\, \\mathrm{d}S$，其中 $\\mathbf{u}$ 是速度，$\\mathbf{n}$ 是侧向边界 $\\partial V_{\\mathrm{lat}}$ 上的外向法向量。\n- 侧向扩散或混合热输送 $F_{\\mathrm{diff}} = -\\oint_{\\partial V_{\\mathrm{lat}}} k \\nabla T \\cdot \\mathbf{n}\\, \\mathrm{d}S$，其中 $k$ 是有效侧向扩散系数。\n\n在这些假设下，收支的闭合条件为\n$$\nT_{\\mathrm{HC}} = Q_{\\mathrm{surf}} + F_{\\mathrm{adv}} + F_{\\mathrm{diff}}。\n$$\n定义残差\n$$\nR = T_{\\mathrm{HC}} - \\left(Q_{\\mathrm{surf}} + F_{\\mathrm{adv}} + F_{\\mathrm{diff}}\\right)。\n$$\n在实践中，每一项都是根据观测产品估算的，并带有不确定性。令 $\\sigma_{T}$、$\\sigma_{Q}$、$\\sigma_{A}$ 和 $\\sigma_{D}$ 分别表示与 $T_{\\mathrm{HC}}$、$Q_{\\mathrm{surf}}$、$F_{\\mathrm{adv}}$ 和 $F_{\\mathrm{diff}}$ 相关联的单标准差不确定性（单位为瓦特）。假设这些不确定性是独立的且近似为高斯分布，则残差的组合标准不确定性为\n$$\n\\sigma_{R} = \\sqrt{\\sigma_{T}^{2} + \\sigma_{Q}^{2} + \\sigma_{A}^{2} + \\sigma_{D}^{2}}。\n$$\n定义一个 $k$-sigma 闭合准则：对于选定的 $k$（例如，在高斯假设下，$k=2$ 对应约 $95\\%$ 的置信水平），如果 $|R| \\le k \\sigma_{R}$，则宣布收支“闭合”。在本练习中，您将为几组参数集验证闭合性。\n\n您的任务是实现一个程序，该程序：\n1. 为每个测试用例计算 $R$ 和 $\\sigma_{R}$。\n2. 评估布尔闭合条件 $|R| \\le k \\sigma_{R}$。\n3. 生成单行输出，其中包含每个测试用例的列表 $[R,\\sigma_{R},\\text{closed}]$，其中 $R$ 和 $\\sigma_{R}$ 是以瓦特为单位的浮点数（以 $\\mathrm{W}$ 表示您的值），$\\text{closed}$ 是一个布尔值。最终的单行输出必须是这些按用例排列的列表的逗号分隔列表，并用方括号括起来，例如 $[[r_1,\\sigma_1,\\mathrm{True}],[r_2,\\sigma_2,\\mathrm{False}]]$.\n\n使用以下测试套件，它涵盖了一般情况、边界情况、非闭合情况以及侧向输送可忽略不计的情况。所有值及其不确定性的单位均为瓦特，$k$ 是无量纲的：\n- 测试用例 $1$（一般“理想”情况）：\n  - $T_{\\mathrm{HC}} = 3.0\\times 10^{13}$, $\\sigma_{T} = 0.6\\times 10^{13}$。\n  - $Q_{\\mathrm{surf}} = 2.2\\times 10^{13}$, $\\sigma_{Q} = 0.3\\times 10^{13}$。\n  - $F_{\\mathrm{adv}} = 0.9\\times 10^{13}$, $\\sigma_{A} = 0.25\\times 10^{13}$。\n  - $F_{\\mathrm{diff}} = -0.1\\times 10^{13}$, $\\sigma_{D} = 0.1\\times 10^{13}$。\n  - $k = 2$。\n- 测试用例 $2$（$2\\sigma$ 闭合的边界）：\n  - $T_{\\mathrm{HC}} = 4.0\\times 10^{13}$, $\\sigma_{T} = 0.4\\times 10^{13}$。\n  - $Q_{\\mathrm{surf}} = 1.5\\times 10^{13}$, $\\sigma_{Q} = 0.4\\times 10^{13}$。\n  - $F_{\\mathrm{adv}} = 1.20385186032\\times 10^{13}$, $\\sigma_{A} = 0.3\\times 10^{13}$。\n  - $F_{\\mathrm{diff}} = 0.0$, $\\sigma_{D} = 0.1\\times 10^{13}$。\n  - $k = 2$。\n- 测试用例 $3$（明显超出 $2\\sigma$ 的非闭合）：\n  - $T_{\\mathrm{HC}} = 8.0\\times 10^{13}$, $\\sigma_{T} = 0.5\\times 10^{13}$。\n  - $Q_{\\mathrm{surf}} = 3.3\\times 10^{13}$, $\\sigma_{Q} = 0.2\\times 10^{13}$。\n  - $F_{\\mathrm{adv}} = 2.6\\times 10^{13}$, $\\sigma_{A} = 0.2\\times 10^{13}$。\n  - $F_{\\mathrm{diff}} = 0.1\\times 10^{13}$, $\\sigma_{D} = 0.1\\times 10^{13}$。\n  - $k = 2$。\n- 测试用例 $4$（表面损失占主导，侧向输送可忽略不计）：\n  - $T_{\\mathrm{HC}} = -1.6\\times 10^{13}$, $\\sigma_{T} = 0.2\\times 10^{13}$。\n  - $Q_{\\mathrm{surf}} = -1.5\\times 10^{13}$, $\\sigma_{Q} = 0.2\\times 10^{13}$。\n  - $F_{\\mathrm{adv}} = 0.0$, $\\sigma_{A} = 0.05\\times 10^{13}$。\n  - $F_{\\mathrm{diff}} = 0.0$, $\\sigma_{D} = 0.05\\times 10^{13}$。\n  - $k = 2$。\n\n科学真实性要求：\n- 使用上述符号约定。正的 $Q_{\\mathrm{surf}}$、$F_{\\mathrm{adv}}$ 和 $F_{\\mathrm{diff}}$ 会增加 $H$；负值则会减少 $H$。\n- 在组合以获得 $\\sigma_{R}$ 时，将不确定性视为独立的和高斯分布的。\n- 将 $R$ 和 $\\sigma_{R}$ 的结果以 $\\mathrm{W}$ 为单位表示为浮点数。布尔值必须是 True 或 False。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例由其自己的列表 $[R,\\sigma_{R},\\text{closed}]$ 表示。",
            "solution": "该问题是有效的。它提出了一个在科学和数学上都合理的关于收支分析和误差传播的练习，这是包括其所述的计算海洋学在内的众多定量科学的核心。所有必要的数据和定义都已提供，问题是适定的、明确的，并且没有矛盾。\n\n任务是评估几个测试用例中海洋热收支的闭合情况。收支的闭合是关于控制体积能量守恒的陈述。其支配原则是，体积内热含量的时间变化率 $T_{\\mathrm{HC}}$ 必须与穿过其边界的所有热通量的净和相平衡。问题将这些通量定义为净表面热通量 $Q_{\\mathrm{surf}}$、净侧向平流热输送 $F_{\\mathrm{adv}}$ 和净侧向扩散热输送 $F_{\\mathrm{diff}}$。\n\n理想化的收支方程为：\n$$\nT_{\\mathrm{HC}} = Q_{\\mathrm{surf}} + F_{\\mathrm{adv}} + F_{\\mathrm{diff}}\n$$\n在实践中，所有项都源自测量或模型，并存在不确定性。因此，预计会存在不平衡，即残差 $R$。残差定义为观测到的趋势项与估算的通量项之和的差：\n$$\nR = T_{\\mathrm{HC}} - \\left(Q_{\\mathrm{surf}} + F_{\\mathrm{adv}} + F_{\\mathrm{diff}}\\right)\n$$\n非零残差 $R$ 表明收支不完全闭合。这可能是由于估算项中的观测或采样误差，或者是忽略了收支中未考虑的物理过程。核心问题是计算出的残差是否具有统计显著性，或者它是否足够小，可以被视为测量不确定性中的“噪音”。\n\n为了回答这个问题，我们传播各个项的不确定性，以找出残差的不确定性 $\\sigma_R$。假设每个项的不确定性——$T_{\\mathrm{HC}}$ 的 $\\sigma_T$、$Q_{\\mathrm{surf}}$ 的 $\\sigma_Q$、$F_{\\mathrm{adv}}$ 的 $\\sigma_A$ 和 $F_{\\mathrm{diff}}$ 的 $\\sigma_D$——是独立的且服从高斯分布，则残差的标准差由方差的正交和给出：\n$$\n\\sigma_{R} = \\sqrt{\\sigma_{T}^{2} + \\sigma_{Q}^{2} + \\sigma_{A}^{2} + \\sigma_{D}^{2}}\n$$\n计算出 $R$ 和 $\\sigma_R$ 后，我们可以应用指定的 $k$-sigma 闭合准则。如果残差的绝对值在零的 $k$ 个标准差之内，则认为收支是“闭合的”。对于这个问题，$k=2$，这大约对应于 $95\\%$ 的置信区间。形式条件是：\n$$\n|R| \\le k \\sigma_{R}\n$$\n如果这个不等式成立，那么在所选的置信水平上，残差被认为在统计上与零无法区分，收支被宣布为闭合。\n\n解决每个测试用例的算法步骤如下：\n1.  给定 $T_{\\mathrm{HC}}$、$Q_{\\mathrm{surf}}$、$F_{\\mathrm{adv}}$ 和 $F_{\\mathrm{diff}}$ 的值，计算残差 $R$。所有值的单位都是瓦特 ($W$)。\n2.  给定不确定性 $\\sigma_T$、$\\sigma_Q$、$\\sigma_A$ 和 $\\sigma_D$，使用正交和公式计算残差的组合不确定性 $\\sigma_R$。\n3.  使用给定的值 $k=2$，评估布尔闭合条件 $|R| \\le k \\sigma_{R}$。\n4.  将每个用例的结果合并为 $[R, \\sigma_R, \\text{closed}]$ 格式的列表。\n\n例如，让我们考虑测试用例 1：\n-   给定项：$T_{\\mathrm{HC}} = 3.0 \\times 10^{13} \\, \\mathrm{W}$，$Q_{\\mathrm{surf}} = 2.2 \\times 10^{13} \\, \\mathrm{W}$，$F_{\\mathrm{adv}} = 0.9 \\times 10^{13} \\, \\mathrm{W}$，$F_{\\mathrm{diff}} = -0.1 \\times 10^{13} \\, \\mathrm{W}$。\n-   通量之和为 $(2.2 + 0.9 - 0.1) \\times 10^{13} = 3.0 \\times 10^{13} \\, \\mathrm{W}$。\n-   残差为 $R = (3.0 \\times 10^{13}) - (3.0 \\times 10^{13}) = 0.0 \\, \\mathrm{W}$。\n-   给定不确定性：$\\sigma_{T} = 0.6 \\times 10^{13} \\, \\mathrm{W}$，$\\sigma_{Q} = 0.3 \\times 10^{13} \\, \\mathrm{W}$，$\\sigma_{A} = 0.25 \\times 10^{13} \\, \\mathrm{W}$，$\\sigma_{D} = 0.1 \\times 10^{13} \\, \\mathrm{W}$。\n-   组合不确定性为 $\\sigma_{R} = \\sqrt{(0.6^2 + 0.3^2 + 0.25^2 + 0.1^2)} \\times 10^{13} = \\sqrt{0.36 + 0.09 + 0.0625 + 0.01} \\times 10^{13} = \\sqrt{0.5225} \\times 10^{13} \\approx 0.7228 \\times 10^{13} \\, \\mathrm{W}$。\n-   闭合条件为 $|0.0| \\le 2 \\times (0.7228 \\times 10^{13})$，结果为 True。\n-   结果列表为 $[0.0, 7.228... \\times 10^{12}, \\text{True}]$。\n\n将此相同过程应用于所有提供的测试用例，以生成最终输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the residual, its uncertainty, and a closure criterion for an\n    ocean heat budget for a series of test cases.\n    \"\"\"\n\n    # Test cases are structured as tuples:\n    # (T_HC, sigma_T, Q_surf, sigma_Q, F_adv, sigma_A, F_diff, sigma_D, k)\n    # All energy/power values are in Watts.\n    test_cases = [\n        # Test Case 1 (general “happy path”)\n        (3.0e13, 0.6e13, 2.2e13, 0.3e13, 0.9e13, 0.25e13, -0.1e13, 0.1e13, 2),\n        # Test Case 2 (boundary of 2-sigma closure)\n        (4.0e13, 0.4e13, 1.5e13, 0.4e13, 1.20385186032e13, 0.3e13, 0.0, 0.1e13, 2),\n        # Test Case 3 (clear non-closure beyond 2-sigma)\n        (8.0e13, 0.5e13, 3.3e13, 0.2e13, 2.6e13, 0.2e13, 0.1e13, 0.1e13, 2),\n        # Test Case 4 (dominant surface loss, negligible lateral transports)\n        (-1.6e13, 0.2e13, -1.5e13, 0.2e13, 0.0, 0.05e13, 0.0, 0.05e13, 2),\n    ]\n\n    results = []\n    for case in test_cases:\n        T_HC, sigma_T, Q_surf, sigma_Q, F_adv, sigma_A, F_diff, sigma_D, k = case\n\n        # 1. Compute the residual R\n        # R = T_HC - (Q_surf + F_adv + F_diff)\n        flux_sum = Q_surf + F_adv + F_diff\n        R = T_HC - flux_sum\n\n        # 2. Compute the combined uncertainty sigma_R\n        # sigma_R = sqrt(sigma_T^2 + sigma_Q^2 + sigma_A^2 + sigma_D^2)\n        sum_of_variances = sigma_T**2 + sigma_Q**2 + sigma_A**2 + sigma_D**2\n        sigma_R = np.sqrt(sum_of_variances)\n\n        # 3. Evaluate the boolean closure condition\n        # |R| = k * sigma_R\n        closed = abs(R) = k * sigma_R\n\n        # 4. Append the result list [R, sigma_R, closed]\n        results.append([R, sigma_R, closed])\n\n    # Format the final output string as a list of lists.\n    # Each inner list is formatted as [float,float,Boolean]\n    formatted_results = [f\"[{r[0]},{r[1]},{str(r[2])}]\" for r in results]\n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    \n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}