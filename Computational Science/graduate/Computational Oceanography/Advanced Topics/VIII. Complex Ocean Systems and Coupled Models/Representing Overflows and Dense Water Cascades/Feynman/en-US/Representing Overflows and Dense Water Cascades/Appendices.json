{
    "hands_on_practices": [
        {
            "introduction": "The transport of dense water through sills and channels is often governed by a process known as hydraulic control. This state is characterized by the internal Froude number, $Fr$, a dimensionless ratio comparing the flow's speed to the propagation speed of long internal gravity waves. This exercise  will guide you through deriving this crucial parameter from the two-layer shallow-water equations, helping you build an intuitive understanding of subcritical and supercritical flow regimes and their implications for how information propagates within the overflow.",
            "id": "3810000",
            "problem": "A dense overflow of thickness $h$ descends along a continental slope beneath a much thicker ambient layer, idealized as a two-layer system under the hydrostatic and Boussinesq approximations and the long-wave (shallow-water) limit. In such flows, hydraulic control and the formation of dense water cascades are governed by a non-dimensional ratio that compares the advective speed of the current to the long internal gravity wave speed of the stratified system. Starting from the two-layer shallow-water framework, derive the appropriate non-dimensional measure for hydraulic control in terms of the reduced gravity $g'$ and the active-layer thickness $h$, and then evaluate it for the overflow parameters $g' = 0.02\\,\\mathrm{m\\,s^{-2}}$, $h = 150\\,\\mathrm{m}$, and current speed $U = 0.6\\,\\mathrm{m\\,s^{-1}}$. Based on your derivation, interpret the computed value in terms of subcritical versus supercritical regimes for dense overflows and explain the physical meaning of this classification in relation to upstream communication by internal waves. Round your final numerical value to three significant figures and report it as a dimensionless number.",
            "solution": "The user has provided a problem in the field of geophysical fluid dynamics, specifically concerning dense overflows in a two-layer ocean model. The problem is to derive the non-dimensional number governing hydraulic control, calculate its value for given parameters, and interpret the physical meaning.\n\nThe problem is first validated against the specified criteria.\n\n### Step 1: Extract Givens\n- System description: A dense overflow of thickness $h$ descends along a continental slope beneath a much thicker ambient layer.\n- Idealizations: Two-layer system, hydrostatic approximation, Boussinesq approximation, long-wave (shallow-water) limit.\n- Governing phenomenon: Hydraulic control and formation of dense water cascades.\n- Governing physics: Comparison of advective speed ($U$) to the long internal gravity wave speed.\n- Derivation terms: Reduced gravity $g'$ and active-layer thickness $h$.\n- Parameters for evaluation:\n  - Reduced gravity, $g' = 0.02\\,\\mathrm{m\\,s^{-2}}$\n  - Active-layer thickness, $h = 150\\,\\mathrm{m}$\n  - Current speed, $U = 0.6\\,\\mathrm{m\\,s^{-1}}$\n- Required output:\n  - Derivation of the non-dimensional measure.\n  - Evaluation of this measure, rounded to three significant figures.\n  - Interpretation of the value in terms of flow regimes (subcritical/supercritical) and its relation to upstream wave communication.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem is based on the well-established two-layer shallow-water model, a cornerstone of geophysical fluid dynamics used to study stratified flows. The concepts of reduced gravity, long internal waves, and the internal Froude number for hydraulic control are fundamental and factually sound. The provided numerical values for $g'$, $h$, and $U$ are physically realistic for oceanic dense water overflows.\n- **Well-Posed:** The problem is clearly stated and contains all necessary information to derive the required quantity, compute its value, and provide a physical interpretation. A unique, meaningful solution exists. The assumption that the ambient layer is \"much thicker\" is a standard and necessary condition for simplifying the two-layer system to a one-and-a-half-layer (or reduced gravity) model, where the upper layer is dynamically inactive.\n- **Objective:** The problem is expressed in precise, technical language, free from any subjectivity or bias.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid** as it is scientifically sound, well-posed, objective, and complete. A full solution will be provided.\n\n### Solution Derivation and Interpretation\n\nThe problem asks for the non-dimensional measure that governs hydraulic control in a two-layer system. This measure is the internal Froude number, which is the ratio of the flow speed to the speed of long internal gravity waves. We begin by deriving the speed of these waves.\n\nConsider a two-layer fluid system with an active, dense bottom layer of thickness $h$ and velocity $u$, and a deep, quiescent upper layer. The Boussinesq approximation is applied. The governing equations for the bottom layer in the long-wave limit are the shallow-water equations, modified for a two-layer system.\n\nThe momentum equation for the lower, active layer is:\n$$ \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} = - \\frac{1}{\\rho_1} \\frac{\\partial p}{\\partial x} $$\nwhere $\\rho_1$ is the density of the lower layer and $p$ is the pressure. The pressure at a depth $z$ within the lower layer is determined by the weight of the fluid above it. Let the interface height be $h(x,t)$ and the free surface height be $\\eta(x,t)$. Assuming the upper layer is infinitely deep and at rest (the reduced gravity model), the pressure gradient at the interface drives the flow. The horizontal pressure gradient force within the active layer is due to the slope of the interface, giving:\n$$ \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} = -g' \\frac{\\partial h}{\\partial x} $$\nHere, $g' = g \\frac{\\rho_1 - \\rho_2}{\\rho_0}$ is the reduced gravity, where $\\rho_2$ is the density of the upper layer and $\\rho_0$ is a reference density. This equation accounts for the buoyancy force at the interface.\n\nThe continuity equation for the active layer is:\n$$ \\frac{\\partial h}{\\partial t} + \\frac{\\partial (uh)}{\\partial x} = 0 $$\n\nTo find the speed of long internal waves, we linearize these two equations for small perturbations around a state of rest ($u_0=0$) and constant mean thickness $h_0$. Let $u = u'$ and $h = h_0 + h'$, where $u'$ and $h'$ are small perturbations.\n\nThe linearized momentum equation becomes:\n$$ \\frac{\\partial u'}{\\partial t} = -g' \\frac{\\partial h'}{\\partial x} $$\n\nThe linearized continuity equation becomes:\n$$ \\frac{\\partial h'}{\\partial t} + h_0 \\frac{\\partial u'}{\\partial x} = 0 $$\n\nTo obtain a wave equation, we differentiate the momentum equation with respect to $x$ and the continuity equation with respect to $t$:\n$$ \\frac{\\partial^2 u'}{\\partial t \\partial x} = -g' \\frac{\\partial^2 h'}{\\partial x^2} $$\n$$ \\frac{\\partial^2 h'}{\\partial t^2} + h_0 \\frac{\\partial^2 u'}{\\partial t \\partial x} = 0 $$\n\nSubstituting the first expression into the second gives:\n$$ \\frac{\\partial^2 h'}{\\partial t^2} + h_0 \\left( -g' \\frac{\\partial^2 h'}{\\partial x^2} \\right) = 0 $$\n$$ \\frac{\\partial^2 h'}{\\partial t^2} = g' h_0 \\frac{\\partial^2 h'}{\\partial x^2} $$\nThis is the standard one-dimensional wave equation, $\\frac{\\partial^2 \\psi}{\\partial t^2} = c^2 \\frac{\\partial^2 \\psi}{\\partial x^2}$. By comparison, the phase speed $c_i$ of long internal gravity waves is:\n$$ c_i = \\sqrt{g' h_0} $$\nFor the given problem, the relevant thickness is the layer thickness $h$. Thus, $c_i = \\sqrt{g' h}$.\n\nThe non-dimensional measure for hydraulic control, the internal Froude number ($Fr$), is defined as the ratio of the characteristic flow speed $U$ to the internal wave speed $c_i$.\n$$ Fr = \\frac{U}{c_i} = \\frac{U}{\\sqrt{g' h}} $$\nThis is the derived non-dimensional measure.\n\nNow, we evaluate this Froude number using the provided parameters:\n$g' = 0.02\\,\\mathrm{m\\,s^{-2}}$\n$h = 150\\,\\mathrm{m}$\n$U = 0.6\\,\\mathrm{m\\,s^{-1}}$\n\nFirst, we calculate the internal wave speed $c_i$:\n$$ c_i = \\sqrt{g' h} = \\sqrt{(0.02\\,\\mathrm{m\\,s^{-2}}) \\times (150\\,\\mathrm{m})} = \\sqrt{3.0\\,\\mathrm{m^2\\,s^{-2}}} = \\sqrt{3}\\,\\mathrm{m\\,s^{-1}} $$\nThe numerical value of the wave speed is approximately $c_i \\approx 1.732\\,\\mathrm{m\\,s^{-1}}$.\n\nNext, we calculate the Froude number:\n$$ Fr = \\frac{U}{c_i} = \\frac{0.6\\,\\mathrm{m\\,s^{-1}}}{\\sqrt{3}\\,\\mathrm{m\\,s^{-1}}} = \\frac{0.6}{\\sqrt{3}} $$\nNumerically, this is:\n$$ Fr \\approx 0.34641016... $$\nRounding to three significant figures, the Froude number is $0.346$.\n\n### Interpretation\n\nThe computed Froude number is $Fr \\approx 0.346$. The state of the flow is classified based on the value of $Fr$ relative to $1$:\n- $Fr  1$: The flow is **subcritical**.\n- $Fr = 1$: The flow is **critical**.\n- $Fr  1$: The flow is **supercritical**.\n\nSince $Fr \\approx 0.346  1$, the overflow is in a **subcritical** regime.\n\nThe physical meaning of this classification relates to the propagation of information, which travels at the wave speed $c_i$.\n- In a **subcritical** flow ($U  c_i$), internal waves can propagate both upstream and downstream. This means that information about downstream conditions (e.g., changes in topography, obstacles) can travel upstream against the current. The flow is therefore able to adjust to downstream controls; it is \"communicatively connected\" to the entire flow domain.\n- In a **supercritical** flow ($U  c_i$), the current is faster than any internal wave. Consequently, all information is swept downstream. Disturbances cannot propagate upstream, so the flow is \"unaware\" of downstream conditions. Its state is determined entirely by upstream conditions.\n- A **critical** flow ($U = c_i$) represents a special state where the flow transitions between subcritical and supercritical. This is known as a hydraulic control, and it often occurs at a topographic constriction like a sill or a narrow channel. At such a point, the flow is \"choked,\" and this condition sets the transport rate of the dense water cascade. The flow accelerates through the control from a subcritical state to a supercritical state.\n\nFor the given parameters, the subcritical nature of the flow implies that the current speed of $0.6\\,\\mathrm{m\\,s^{-1}}$ is not yet fast enough to prevent upstream communication by internal waves, which travel at approximately $1.73\\,\\mathrm{m\\,s^{-1}}$.",
            "answer": "$$ \\boxed{0.346} $$"
        },
        {
            "introduction": "Moving from idealized dynamics to computational practice, a primary challenge is to preserve the water mass properties of an overflow as it descends. In numerical models, the discretization of the advection process can introduce artificial (or \"spurious\") mixing across density surfaces, a phenomenon that can dramatically alter the plume's trajectory and fate. This practice  delves into this issue by quantifying the numerical diapycnal diffusivity in a standard depth-level ($z$-coordinate) model and contrasting it with the behavior of an idealized isopycnal-coordinate model, revealing the fundamental trade-offs between different modeling strategies.",
            "id": "3810018",
            "problem": "Consider a two-dimensional, steady, dense overflow descending a uniform planar slope within an ocean model that resolves the horizontal coordinate and the vertical coordinate. The overflow is characterized by a uniform speed and an orientation with respect to the horizontal, and its buoyancy (or density anomaly) surfaces are tilted with respect to the horizontal. Two numerical representations are compared: (i) a model that advects on fixed depth levels (a depth-level or $z$-level model), and (ii) an idealized isopycnal-advection representation in which flow-aligned transport occurs strictly along isopycnal surfaces. The aim is to quantify cross-isopycnal (diapycnal) mixing implied purely by numerical advection of a tracer representing buoyancy, for each representation, under scientifically plausible conditions for an overflow.\n\nStart from the advection of a passive scalar field $b(x,z,t)$ that represents buoyancy in a vertically stratified ocean, with $x$ the along-slope horizontal coordinate and $z$ the vertical coordinate. Use the two-dimensional advection equation for $b$ with velocity components $(u,w)$, the definitions of Courant–Friedrichs–Lewy (CFL) numbers, and a first-order upwind finite-volume discretization applied in a directionally split manner along $x$ and $z$. Using a modified equation analysis, infer the leading-order, scheme-implied numerical diffusion along each grid direction for the $z$-level discretization, and combine these to obtain a scalar diapycnal diffusivity by projecting the resulting diffusion tensor onto the normal to the isopycnal surfaces, which are tilted by a specified angle. Separately, for the isopycnal-advection representation, assume the ideal case of strictly along-isopycnal transport with zero cross-isopycnal velocity and determine the implied diapycnal diffusivity arising solely from numerical advection in this representation.\n\nAssumptions and givens:\n- The overflow has a uniform speed $U$ (units $\\mathrm{m\\,s^{-1}}$) and descends at an angle $\\theta$ (units degrees) measured from the horizontal, so that its velocity components are $u=U\\cos\\theta$ and $w=-U\\sin\\theta$.\n- The isopycnal surfaces are tilted by an angle $\\alpha$ (units degrees) relative to the horizontal; the unit tangent to the isopycnal is $\\boldsymbol{t}=(\\cos\\alpha,\\sin\\alpha)$ and the unit normal is $\\boldsymbol{n}=(-\\sin\\alpha,\\cos\\alpha)$.\n- The $z$-level discretization uses uniform grid spacings $\\Delta x$ and $\\Delta z$ (units $\\mathrm{m}$), and a uniform time step $\\Delta t$ (units $\\mathrm{s}$). The advection is discretized by first-order upwind in a dimensionally split manner along each axis.\n- The Courant–Friedrichs–Lewy (CFL) numbers are $C_x=u\\Delta t/\\Delta x$ and $C_z=w\\Delta t/\\Delta z$, each constrained by $\\lvert C_x\\rvert\\le 1$ and $\\lvert C_z\\rvert\\le 1$.\n\nTasks:\n1. From the advection equation for $b(x,z,t)$ and the first-order upwind discretization along $x$ (with spacing $\\Delta x$ and Courant number $C_x$), derive the leading-order equivalent numerical diffusion coefficient along $x$ in the modified equation. Repeat for $z$ to obtain the vertical coefficient. Treat advection signs correctly via absolute values where appropriate.\n2. Assemble the implied diffusion tensor of the $z$-level discretization as diagonal in $(x,z)$ coordinates and project it onto the isopycnal-normal direction $\\boldsymbol{n}$ to obtain a scalar diapycnal diffusivity $K_{\\mathrm{dia}}^{(z)}$ (units $\\mathrm{m^2\\,s^{-1}}$).\n3. For the isopycnal-advection representation, formulate the advection in isopycnal-aligned coordinates $(s,n)$, with $s$ along-isopycnal and $n$ normal-to-isopycnal. Under the ideal assumption of strictly along-isopycnal flow (i.e., $u_n=0$) and first-order upwind along $s$, deduce the implied diapycnal diffusivity $K_{\\mathrm{dia}}^{(\\mathrm{iso})}$ (units $\\mathrm{m^2\\,s^{-1}}$).\n4. Implement a program that, for each test case below, computes $K_{\\mathrm{dia}}^{(z)}$ and $K_{\\mathrm{dia}}^{(\\mathrm{iso})}$ and outputs both values.\n\nAngle units are degrees and must be treated as degrees in all trigonometric evaluations. Express all diffusivities in $\\mathrm{m^2\\,s^{-1}}$ as floating-point numbers.\n\nTest suite (each tuple is $(U,\\theta,\\alpha,\\Delta x,\\Delta z,\\Delta t)$ with units $(\\mathrm{m\\,s^{-1}},\\mathrm{deg},\\mathrm{deg},\\mathrm{m},\\mathrm{m},\\mathrm{s})$):\n- Case $1$: $(0.2,5,5,1000,50,600)$\n- Case $2$: $(0.5,15,10,500,20,120)$\n- Case $3$ (near-CFL along $x$ while respecting vertical stability): $(0.3,2,2,100,50,317)$\n- Case $4$ (horizontal isopycnals): $(0.1,10,0,2000,50,600)$\n- Case $5$ (steeper isopycnals, coarse horizontal grid): $(0.25,12,30,1000,25,300)$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as $[K_{\\mathrm{dia}}^{(z)}\\_{\\text{case 1}},K_{\\mathrm{dia}}^{(\\mathrm{iso})}\\_{\\text{case 1}},K_{\\mathrm{dia}}^{(z)}\\_{\\text{case 2}},K_{\\mathrm{dia}}^{(\\mathrm{iso})}\\_{\\text{case 2}},\\dots]$, with all values in $\\mathrm{m^2\\,s^{-1}}$ and angles treated in degrees as stated.",
            "solution": "The problem requires the calculation and comparison of numerical diapycnal diffusivities for two computational representations of a dense overflow: a standard depth-level ($z$-level) model and an idealized isopycnal-advection model.\n\nThe derivation begins with the modified equation analysis of the first-order upwind scheme, which is used to discretize the two-dimensional advection equation for a passive scalar $b(x,z,t)$ representing buoyancy:\n$$\n\\frac{\\partial b}{\\partial t} + u \\frac{\\partial b}{\\partial x} + w \\frac{\\partial b}{\\partial z} = 0\n$$\nThe problem specifies a dimensionally split, first-order upwind finite-volume discretization on a grid with uniform spacings $\\Delta x$ and $\\Delta z$, and a uniform time step $\\Delta t$. We derive the leading-order numerical diffusion coefficients for each spatial direction separately.\n\nFor the $x$-direction, the 1D advection equation is $\\frac{\\partial b}{\\partial t} + u \\frac{\\partial b}{\\partial x} = 0$. The first-order upwind scheme can be expressed as:\n$$\n\\frac{b_i^{n+1} - b_i^n}{\\Delta t} = -u \\frac{b_i^n - b_{i-1}^n}{\\Delta x} \\quad (\\text{for } u0)\n$$\nA Taylor series expansion of all terms around the point $(x_i, t_n)$ reveals the PDE that the numerical scheme actually solves, known as the modified equation. The leading-order form of this equation is:\n$$\n\\frac{\\partial b}{\\partial t} + u \\frac{\\partial b}{\\partial x} = \\frac{|u|\\Delta x}{2} \\left(1 - \\frac{|u|\\Delta t}{\\Delta x}\\right) \\frac{\\partial^2 b}{\\partial x^2} + \\mathcal{O}(\\Delta x^2, \\Delta t^2)\n$$\nThe term on the right-hand side represents a numerical diffusion process. The numerical diffusion coefficient along the $x$-direction, $K_x$, is therefore:\n$$\nK_x = \\frac{|u|\\Delta x}{2} \\left(1 - \\frac{|u|\\Delta t}{\\Delta x}\\right) = \\frac{|u|\\Delta x}{2}(1 - |C_x|)\n$$\nwhere $C_x = u \\Delta t / \\Delta x$ is the Courant number in the $x$-direction. The use of absolute value $|u|$ ensures the formula is general for any flow direction. By an identical derivation for the $z$-direction, the corresponding numerical diffusion coefficient is:\n$$\nK_z = \\frac{|w|\\Delta z}{2}(1 - |C_z|)\n$$\nwhere $C_z = w \\Delta t / \\Delta z$. For a dimensionally split scheme, the modified equation for the 2D problem combines these effects:\n$$\n\\frac{\\partial b}{\\partial t} + u \\frac{\\partial b}{\\partial x} + w \\frac{\\partial b}{\\partial z} = K_x \\frac{\\partial^2 b}{\\partial x^2} + K_z \\frac{\\partial^2 b}{\\partial z^2}\n$$\n\nNext, we calculate the scalar diapycnal diffusivity for the $z$-level model, $K_{\\mathrm{dia}}^{(z)}$. The numerical diffusion is described by a tensor $\\boldsymbol{\\mathrm{K}}$, which is diagonal in the Cartesian $(x,z)$ coordinate system of the model grid:\n$$\n\\boldsymbol{\\mathrm{K}} = \\begin{pmatrix} K_x  0 \\\\ 0  K_z \\end{pmatrix}\n$$\nThe diapycnal (cross-isopycnal) direction is defined by the unit vector $\\boldsymbol{n}=(-\\sin\\alpha, \\cos\\alpha)$, which is normal to the isopycnal surfaces tilted at an angle $\\alpha$ to the horizontal. The scalar diffusivity in a specific direction $\\boldsymbol{n}$ resulting from a tensor process $\\boldsymbol{\\mathrm{K}}$ is found by the projection $\\boldsymbol{n}^T \\boldsymbol{\\mathrm{K}} \\boldsymbol{n}$. Thus, the numerical diapycnal diffusivity for the $z$-level model is:\n$$\nK_{\\mathrm{dia}}^{(z)} = \\begin{pmatrix} -\\sin\\alpha  \\cos\\alpha \\end{pmatrix} \\begin{pmatrix} K_x  0 \\\\ 0  K_z \\end{pmatrix} \\begin{pmatrix} -\\sin\\alpha \\\\ \\cos\\alpha \\end{pmatrix}\n$$\n$$\nK_{\\mathrm{dia}}^{(z)} = K_x \\sin^2\\alpha + K_z \\cos^2\\alpha\n$$\nThis expression quantifies how the grid-aligned numerical diffusion projects onto the physically relevant cross-isopycnal direction. The velocity components $u$ and $w$ are given by the overflow speed $U$ and angle $\\theta$ as $u=U\\cos\\theta$ and $w=-U\\sin\\theta$.\n\nFinally, we determine the diapycnal diffusivity for the idealized isopycnal-advection representation, $K_{\\mathrm{dia}}^{(\\mathrm{iso})}$. This model is formulated in a coordinate system $(s,n)$ aligned with the isopycnals, where $s$ is the along-isopycnal coordinate and $n$ is the cross-isopycnal (diapycnal) coordinate. The model is idealized with the assumption that transport occurs strictly along isopycnal surfaces. Consequently, the advection equation for a tracer considers only the along-isopycnal velocity component, $u_s$:\n$$\n\\frac{\\partial b}{\\partial t} + u_s \\frac{\\partial b}{\\partial s} = 0\n$$\nThe cross-isopycnal velocity component, $u_n$, is treated as zero within the advection operator, by definition of this idealized model framework. The numerical scheme is a first-order upwind discretization along the $s$-coordinate. This introduces a numerical diffusion term exclusively in the $s$-direction, leading to a modified equation of the form:\n$$\n\\frac{\\partial b}{\\partial t} + u_s \\frac{\\partial b}{\\partial s} = K_s \\frac{\\partial^2 b}{\\partial s^2}\n$$\nwhere $K_s$ is the along-isopycnal numerical diffusivity. By construction, the numerical scheme produces no diffusion in the $n$-direction. The numerical diffusion tensor in this $(s,n)$ coordinate system is therefore:\n$$\n\\boldsymbol{\\mathrm{K}}_{\\mathrm{iso}} = \\begin{pmatrix} K_s  0 \\\\ 0  0 \\end{pmatrix}\n$$\nThe diapycnal diffusivity is the component of this tensor in the diapycnal ($n$) direction. From the tensor, this component is manifestly zero.\n$$\nK_{\\mathrm{dia}}^{(\\mathrm{iso})} = 0\n$$\nThis result is a direct consequence of the idealization and highlights the fundamental design goal of isopycnal coordinate models: to eliminate spurious numerical diapycnal mixing arising from the discretization of advection.\n\nThe final formulas to be implemented are:\n1.  For a given test case $(U,\\theta,\\alpha,\\Delta x,\\Delta z,\\Delta t)$:\n2.  Convert angles to radians: $\\theta_{\\mathrm{rad}} = \\theta \\cdot \\pi/180$, $\\alpha_{\\mathrm{rad}} = \\alpha \\cdot \\pi/180$.\n3.  Calculate velocity components: $u = U\\cos(\\theta_{\\mathrm{rad}})$, $w=-U\\sin(\\theta_{\\mathrm{rad}})$.\n4.  Calculate Courant numbers: $C_x = u\\Delta t/\\Delta x$, $C_z = w\\Delta t/\\Delta z$.\n5.  Calculate grid-aligned diffusivities: $K_x = \\frac{|u|\\Delta x}{2}(1-|C_x|)$, $K_z = \\frac{|w|\\Delta z}{2}(1-|C_z|)$.\n6.  Calculate the $z$-level diapycnal diffusivity: $K_{\\mathrm{dia}}^{(z)} = K_x \\sin^2(\\alpha_{\\mathrm{rad}}) + K_z \\cos^2(\\alpha_{\\mathrm{rad}})$.\n7.  The isopycnal-level diapycnal diffusivity is $K_{\\mathrm{dia}}^{(\\mathrm{iso})} = 0.0$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes numerical diapycnal diffusivity for z-level and isopycnal models.\n\n    The function processes a set of test cases, each defining an oceanic overflow scenario.\n    For each case, it calculates:\n    1. K_dia_z: The diapycnal diffusivity for a z-level model using a first-order\n       upwind scheme. This is derived from a modified equation analysis, where\n       grid-aligned numerical diffusion is projected onto the cross-isopycnal\n       direction.\n    2. K_dia_iso: The diapycnal diffusivity for an idealized isopycnal-advection\n       model. In this ideal case, numerical diffusion only occurs along isopycnals,\n       so the cross-isopycnal (diapycnal) component is zero by construction.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each tuple is (U, theta, alpha, delta_x, delta_z, delta_t) with units\n    # (m/s, deg, deg, m, m, s).\n    test_cases = [\n        (0.2, 5, 5, 1000, 50, 600),\n        (0.5, 15, 10, 500, 20, 120),\n        (0.3, 2, 2, 100, 50, 317),\n        (0.1, 10, 0, 2000, 50, 600),\n        (0.25, 12, 30, 1000, 25, 300),\n    ]\n\n    results = []\n    for case in test_cases:\n        U, theta_deg, alpha_deg, delta_x, delta_z, delta_t = case\n        \n        # Convert angles from degrees to radians for trigonometric functions\n        theta_rad = np.deg2rad(theta_deg)\n        alpha_rad = np.deg2rad(alpha_deg)\n\n        # 1. Calculate velocity components\n        u = U * np.cos(theta_rad)\n        w = -U * np.sin(theta_rad)\n\n        # 2. Calculate Courant–Friedrichs–Lewy (CFL) numbers\n        Cx = u * delta_t / delta_x\n        Cz = w * delta_t / delta_z\n\n        # 3. Calculate grid-aligned numerical diffusion coefficients (Kx, Kz)\n        Kx = (np.abs(u) * delta_x / 2.0) * (1.0 - np.abs(Cx))\n        Kz = (np.abs(w) * delta_z / 2.0) * (1.0 - np.abs(Cz))\n\n        # 4. Calculate scalar diapycnal diffusivity for the z-level model (K_dia_z)\n        # This is the projection of the diffusion tensor onto the isopycnal-normal direction.\n        sin_alpha_sq = np.sin(alpha_rad)**2\n        cos_alpha_sq = np.cos(alpha_rad)**2\n        K_dia_z = Kx * sin_alpha_sq + Kz * cos_alpha_sq\n        \n        # 5. Determine diapycnal diffusivity for the idealized isopycnal model (K_dia_iso)\n        # By definition of the idealized model, advection and its associated numerical\n        # diffusion occur strictly along isopycnals. Thus, the diapycnal diffusivity is 0.\n        K_dia_iso = 0.0\n\n        results.append(K_dia_z)\n        results.append(K_dia_iso)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Large-scale climate models lack the resolution to explicitly simulate overflows, necessitating their representation through sub-grid scale parameterizations. This final exercise  provides a capstone experience where you will construct such a parameterization from first principles. By synthesizing concepts of entrainment, hydraulic control ($Fr \\approx 1$), and mass conservation, you will build and implement a simple one-dimensional model that predicts the downstream evolution of an overflow and its ultimate injection depth into the ocean interior.",
            "id": "3810057",
            "problem": "You are asked to design and implement a minimal yet dynamically consistent parameterization for a dense overflow cascading downslope into a stratified ambient ocean. The goal is to compute, for each specified source and slope configuration, the downstream neutral-buoyancy injection depth and the associated transport, using a reduced-gravity, entraining gravity current model that obeys hydrostatic balance and a critical control at the sill. The program you write must execute the same computations for all test cases and return their results in a single aggregated output.\n\nThe parameterization must be derived from the following fundamental base for computational oceanography:\n- Hydrostatic balance for slowly varying motions in a stably stratified fluid.\n- The Boussinesq approximation for small density contrasts, where momentum depends on density anomalies only through buoyancy.\n- Mass conservation for the overflow layer, treated as a layer of thickness $h$ and width $W$ moving at speed $U$ downslope.\n- A control at the sill such that the along-flow Froude number equals unity at the control, and remains order one downstream.\n- A classic entrainment closure for gravity currents, where the entrainment velocity at the top of the layer is proportional to the layer speed.\n\nYou must derive, from these bases only, a closed system that evolves the overflow along the downslope direction until it reaches a neutral-buoyancy depth, defined by the equality between the evolving layer-mean density and the ambient density at the same depth. Your derivation and algorithm must be purely from these principles and must not assume any specialized overflow formula as a starting point.\n\nDefinitions, geometry, and closures to use:\n- Let $x$ be the along-slope coordinate measured in $\\mathrm{m}$ from the sill crest at $x=0$. Let $z$ be the depth in $\\mathrm{m}$, positive downward, with $z(x)$ increasing as the plume descends. The bottom has a constant slope $s = \\mathrm{d}z/\\mathrm{d}x$ (dimensionless).\n- The ambient density profile is linear with depth, $\\rho_{a}(z) = \\rho_{0} + \\gamma z$, where $\\rho_{0}$ is a reference density in $\\mathrm{kg\\,m^{-3}}$, and $\\gamma$ is a constant density gradient in $\\mathrm{kg\\,m^{-4}}$.\n- The overflow is initialized at $x=0$ at depth $z(0)=z_{0}$, with source transport $Q_{s}$ in $\\mathrm{m^{3}\\,s^{-1}}$, source layer-mean density $\\rho_{s}$ in $\\mathrm{kg\\,m^{-3}}$, and it has a fixed width $W$ in $\\mathrm{m}$. The gravitational acceleration is $g$ in $\\mathrm{m\\,s^{-2}}$.\n- Let $\\rho(x)$ denote the evolving layer-mean density of the overflow, and $Q(x)$ its transport in $\\mathrm{m^{3}\\,s^{-1}}$. The reduced gravity is $g'(x) = g\\left(\\rho(x) - \\rho_{a}(z(x))\\right)/\\rho_{0}$, with the requirement $g'(x)\\ge 0$ while the current is denser than the ambient.\n- Let the entrainment velocity be $w_{e} = \\alpha_{e} U$, where $\\alpha_{e}$ is a constant entrainment coefficient (dimensionless), and $U$ is the along-slope layer speed in $\\mathrm{m\\,s^{-1}}$.\n- The control condition is that the Froude number defined as $Fr = U/\\sqrt{g'h}$ is of order one; at the sill take it to be unity, and use this criticality consistently to close the system together with mass conservation.\n\nFrom these bases, derive the governing evolution system in the along-slope coordinate $x$ for $Q(x)$, $\\rho(x)$, and $z(x)$, and show how to determine the neutral-buoyancy injection depth $z_{\\mathrm{inj}}$ such that $\\rho(x_{\\mathrm{inj}}) = \\rho_{a}(z_{\\mathrm{inj}})$, where $x_{\\mathrm{inj}}$ is the corresponding along-slope distance. If the current is not denser than the ambient at the sill crest, take $z_{\\mathrm{inj}} = z_{0}$ and the downstream transport equal to $Q_{s}$. If the current remains denser than ambient down to a maximum allowed depth $z_{\\max}$, then set $z_{\\mathrm{inj}}=z_{\\max}$ with the transport equal to the transport reached there.\n\nImplementation requirements:\n- Implement a numerical integration in $x$ using an explicit method that is consistent with the derived system and the assumptions above. Use a fixed step $\\Delta x$ and ensure numerical stability by stopping the integration when the neutral condition is crossed. Use linear interpolation between the last two points to estimate $z_{\\mathrm{inj}}$ and the transport at neutral buoyancy for improved accuracy. Prevent division by zero or taking real roots of negative quantities by stopping the integration once neutral buoyancy is reached and by enforcing nonnegativity of the reduced gravity during the march.\n- Use the following constant parameters for all cases: reference density $\\rho_{0} = 1027.0\\,\\mathrm{kg\\,m^{-3}}$, gravitational acceleration $g = 9.81\\,\\mathrm{m\\,s^{-2}}$, entrainment coefficient $\\alpha_{e} = 0.001$, step size $\\Delta x = 10\\,\\mathrm{m}$, and maximum allowed depth $z_{\\max} = 3000\\,\\mathrm{m}$.\n- Your program must compute, for each case, the pair consisting of the injection depth and the corresponding transport expressed in International System of Units (SI). Express the final injection depth in $\\mathrm{m}$ and the final transport in $\\mathrm{m^{3}\\,s^{-1}}$, each rounded to three digits after the decimal point.\n\nTest suite:\nFor each of the following test cases, compute the injection depth and transport using the algorithm described. Each parameter not listed inherits the shared constants above.\n\n- Case A (happy path, moderate slope and strong source):\n  - Width $W = 15000\\,\\mathrm{m}$, sill depth $z_{0} = 600\\,\\mathrm{m}$, source density $\\rho_{s} = 1028.2\\,\\mathrm{kg\\,m^{-3}}$, source transport $Q_{s} = 1.2\\times 10^{6}\\,\\mathrm{m^{3}\\,s^{-1}}$, ambient gradient $\\gamma = 5.0\\times 10^{-4}\\,\\mathrm{kg\\,m^{-4}}$, slope $s = 0.010$.\n- Case B (gentle slope, weaker source):\n  - Width $W = 20000\\,\\mathrm{m}$, sill depth $z_{0} = 800\\,\\mathrm{m}$, source density $\\rho_{s} = 1028.0\\,\\mathrm{kg\\,m^{-3}}$, source transport $Q_{s} = 6.0\\times 10^{5}\\,\\mathrm{m^{3}\\,s^{-1}}$, ambient gradient $\\gamma = 6.0\\times 10^{-4}\\,\\mathrm{kg\\,m^{-4}}$, slope $s = 0.003$.\n- Case C (narrower overflow, steeper slope):\n  - Width $W = 8000\\,\\mathrm{m}$, sill depth $z_{0} = 500\\,\\mathrm{m}$, source density $\\rho_{s} = 1028.5\\,\\mathrm{kg\\,m^{-3}}$, source transport $Q_{s} = 8.0\\times 10^{5}\\,\\mathrm{m^{3}\\,s^{-1}}$, ambient gradient $\\gamma = 4.0\\times 10^{-4}\\,\\mathrm{kg\\,m^{-4}}$, slope $s = 0.020$.\n- Case D (edge case, barely dense source):\n  - Width $W = 12000\\,\\mathrm{m}$, sill depth $z_{0} = 700\\,\\mathrm{m}$, ambient gradient $\\gamma = 7.0\\times 10^{-4}\\,\\mathrm{kg\\,m^{-4}}$, and source density chosen to be slightly denser than ambient at the sill, $\\rho_{s} = \\rho_{0} + \\gamma z_{0} + 0.05\\,\\mathrm{kg\\,m^{-3}}$, source transport $Q_{s} = 4.0\\times 10^{5}\\,\\mathrm{m^{3}\\,s^{-1}}$, slope $s = 0.006$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of pairs, in the order of the test cases above, enclosed in square brackets. Each pair must itself be a two-element list in the order $[z_{\\mathrm{inj}}, Q_{\\mathrm{inj}}]$, with both entries rounded to three digits after the decimal point and in SI units as specified. For example, a valid output for two hypothetical cases would look like: [[1000.000,500000.000],[1200.500,750000.250]].",
            "solution": "The problem is valid. It presents a well-posed, scientifically grounded task in computational oceanography, based on established first principles of fluid dynamics. All necessary data and definitions are provided, and there are no internal contradictions or ambiguities.\n\nThe problem requires the derivation and implementation of a parameterization for a dense overflow. The goal is to determine the neutral-buoyancy injection depth, $z_{\\mathrm{inj}}$, and the corresponding transport, $Q_{\\mathrm{inj}}$, for a gravity current descending a slope. The derivation will be based on the principles of mass and density conservation, hydrostatic balance under the Boussinesq approximation, a critical Froude number condition, and an entrainment closure.\n\nThe state of the overflow is described by its transport $Q(x)$, layer-mean density $\\rho(x)$, and depth $z(x)$, where $x$ is the along-slope coordinate. We will derive a system of ordinary differential equations (ODEs) for these variables.\n\n**1. Geometric and Kinematic Relations**\n\nThe geometry is defined by a constant bottom slope, $s = \\mathrm{d}z/\\mathrm{d}x$. Integrating this with the initial condition $z(0) = z_0$ gives the depth of the plume as a function of along-slope distance:\n$$\nz(x) = z_0 + s x\n$$\nThe transport $Q(x)$ is defined as the volume flux across a section of the overflow, which has width $W$, thickness $h(x)$, and layer-averaged speed $U(x)$:\n$$\nQ(x) = U(x) W h(x)\n$$\n\n**2. Mass Conservation and Entrainment**\n\nThe problem states that the overflow entrains ambient water at a rate determined by the entrainment velocity $w_e = \\alpha_e U$. The increase in transport $dQ$ over a distance $dx$ is the volume of water entrained over that segment, which has a surface area of $W dx$.\n$$\ndQ = w_e (W dx) = (\\alpha_e U) W dx\n$$\nThis gives the first ODE for the evolution of transport:\n$$\n\\frac{dQ}{dx} = \\alpha_e W U(x)\n$$\n\n**3. Density Evolution**\n\nThe density of the overflow, $\\rho(x)$, changes due to the entrainment of ambient water with density $\\rho_a(z(x))$. We consider the conservation of the density tracer. The total amount of \"density substance\" in a control volume is $\\rho Q$. The change in this quantity, $d(\\rho Q)$, must equal the amount of density substance added by entrainment, which is $\\rho_a(z) dQ$.\n$$\nd(\\rho Q) = \\rho_a(z) dQ\n$$\nDividing by $dx$ and using the product rule for differentiation on the left-hand side:\n$$\n\\rho \\frac{dQ}{dx} + Q \\frac{d\\rho}{dx} = \\rho_a(z) \\frac{dQ}{dx}\n$$\nRearranging for the evolution of density, we obtain the second ODE:\n$$\n\\frac{d\\rho}{dx} = \\frac{\\rho_a(z(x)) - \\rho(x)}{Q(x)} \\frac{dQ}{dx}\n$$\nThe ambient density is given by the linear profile $\\rho_a(z) = \\rho_0 + \\gamma z$.\n\n**4. Dynamical Closure: Critical Froude Number**\n\nThe system is not yet closed because the speed $U(x)$ is unknown. The problem provides a dynamical closure by stating that the flow is critically controlled, with a Froude number of unity:\n$$\nFr = \\frac{U}{\\sqrt{g'h}} = 1\n$$\nThis implies $U^2 = g'h$. The reduced gravity, $g'$, is defined under the Boussinesq approximation as:\n$$\ng'(x) = g \\frac{\\rho(x) - \\rho_a(z(x))}{\\rho_0}\n$$\nWe need to express $U$ in terms of the evolving state variables, $Q$ and $\\rho$. From the transport relation, we have $h = Q / (UW)$. Substituting this into the Froude number condition:\n$$\nU^2 = g' \\left(\\frac{Q}{UW}\\right) \\implies U^3 = \\frac{g'Q}{W}\n$$\nThis yields an expression for the velocity:\n$$\nU(x) = \\left(\\frac{g'(x) Q(x)}{W}\\right)^{1/3}\n$$\nThis equation closes the system. With this, the rate of change of transport becomes:\n$$\n\\frac{dQ}{dx} = \\alpha_e W \\left(\\frac{g'(x) Q(x)}{W}\\right)^{1/3}\n$$\n\n**5. Synthesis of the Governing System and Numerical Implementation**\n\nFor numerical stability and elegance, it is convenient to evolve the density anomaly, $\\Delta\\rho(x) = \\rho(x) - \\rho_a(z(x))$, directly. Note that $g'(x) = g \\Delta\\rho(x) / \\rho_0$. The derivative of $\\Delta\\rho$ is:\n$$\n\\frac{d(\\Delta\\rho)}{dx} = \\frac{d\\rho}{dx} - \\frac{d\\rho_a(z(x))}{dx} = \\frac{d\\rho}{dx} - \\frac{d\\rho_a}{dz}\\frac{dz}{dx} = \\frac{d\\rho}{dx} - \\gamma s\n$$\nSubstituting the expression for $d\\rho/dx$:\n$$\n\\frac{d(\\Delta\\rho)}{dx} = -\\frac{\\Delta\\rho(x)}{Q(x)}\\frac{dQ}{dx} - \\gamma s\n$$\nThe complete system of ODEs to be integrated in $x$ is thus:\n1.  $\\displaystyle \\frac{dQ}{dx} = \\alpha_e W \\left(\\frac{g}{\\rho_0} \\frac{\\Delta\\rho(x) Q(x)}{W}\\right)^{1/3}$\n2.  $\\displaystyle \\frac{d(\\Delta\\rho)}{dx} = -\\frac{\\Delta\\rho(x)}{Q(x)}\\frac{dQ}{dx} - \\gamma s$\n\n**Algorithm:**\nThe system is solved using an explicit forward Euler method with a step size $\\Delta x$.\n1.  **Initialization**: At $x_0=0$, set the initial conditions: $Q_0 = Q_s$, $z_0 = z_0$, and calculate the initial density anomaly $\\Delta\\rho_0 = \\rho_s - (\\rho_0 + \\gamma z_0)$.\n2.  **Initial Check**: If $\\Delta\\rho_0 \\le 0$, the overflow is not denser than the ambient at the sill. The process terminates, and the injection parameters are $z_{\\mathrm{inj}} = z_0$ and $Q_{\\mathrm{inj}} = Q_s$.\n3.  **Integration Loop**: For $i = 0, 1, 2, ...$\n    a. Check termination conditions: If $\\Delta\\rho_i \\le 0$ or $z_i \\ge z_{\\max}$, stop the integration.\n    b. Calculate the derivatives at step $i$:\n       i. $\\displaystyle \\left(\\frac{dQ}{dx}\\right)_i = \\alpha_e W \\left(\\frac{g}{\\rho_0} \\frac{\\Delta\\rho_i Q_i}{W}\\right)^{1/3}$\n       ii. $\\displaystyle \\left(\\frac{d(\\Delta\\rho)}{dx}\\right)_i = -\\frac{\\Delta\\rho_i}{Q_i}\\left(\\frac{dQ}{dx}\\right)_i - \\gamma s$\n    c. Store the current state $(z_i, Q_i, \\Delta\\rho_i)$.\n    d. Update the state variables for the next step $i+1$:\n       i. $x_{i+1} = x_i + \\Delta x$\n       ii. $z_{i+1} = z_i + s \\Delta x$\n       iii. $Q_{i+1} = Q_i + \\left(\\frac{dQ}{dx}\\right)_i \\Delta x$\n       iv. $\\Delta\\rho_{i+1} = \\Delta\\rho_i + \\left(\\frac{d(\\Delta\\rho)}{dx}\\right)_i \\Delta x$\n4.  **Finalization**:\n    a. If the loop terminated because $z_i \\ge z_{\\max}$, the injection parameters are $z_{\\mathrm{inj}} = z_{\\max}$ and $Q_{\\mathrm{inj}} = Q_i$.\n    b. If the loop terminated because $\\Delta\\rho_{i+1} \\le 0$, the neutral buoyancy level was crossed between step $i$ and $i+1$. We find the precise location using linear interpolation. Let the last state with $\\Delta\\rho  0$ be $(\\text{prev})$ and the first with $\\Delta\\rho \\le 0$ be $(\\text{curr})$. The interpolation fraction is $f = \\Delta\\rho_{\\text{prev}} / (\\Delta\\rho_{\\text{prev}} - \\Delta\\rho_{\\text{curr}})$.\n    c. The final injection depth and transport are:\n       i. $z_{\\mathrm{inj}} = z_{\\text{prev}} + (z_{\\text{curr}} - z_{\\text{prev}}) \\times f$\n       ii. $Q_{\\mathrm{inj}} = Q_{\\text{prev}} + (Q_{\\text{curr}} - Q_{\\text{prev}}) \\times f$\n5. The final results are rounded to three decimal places as required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements a parameterization for a dense overflow,\n    computing the neutral-buoyancy injection depth and transport.\n    \"\"\"\n    \n    # Global constants\n    RHO_0 = 1027.0  # Reference density, kg/m^3\n    G = 9.81        # Gravitational acceleration, m/s^2\n    ALPHA_E = 0.001 # Entrainment coefficient, dimensionless\n    DX = 10.0       # Step size for integration, m\n    Z_MAX = 3000.0  # Maximum allowed depth, m\n\n    # Test suite: (W, z0, rho_s, Qs, gamma, s)\n    # rho_s is 'auto' for Case D to be calculated based on other params.\n    test_cases_params = [\n        # Case A: happy path, moderate slope and strong source\n        {'W': 15000.0, 'z0': 600.0, 'rho_s': 1028.2, 'Qs': 1.2e6, 'gamma': 5.0e-4, 's': 0.010, 'case_id': 'A'},\n        # Case B: gentle slope, weaker source\n        {'W': 20000.0, 'z0': 800.0, 'rho_s': 1028.0, 'Qs': 6.0e5, 'gamma': 6.0e-4, 's': 0.003, 'case_id': 'B'},\n        # Case C: narrower overflow, steeper slope\n        {'W': 8000.0, 'z0': 500.0, 'rho_s': 1028.5, 'Qs': 8.0e5, 'gamma': 4.0e-4, 's': 0.020, 'case_id': 'C'},\n        # Case D: edge case, barely dense source\n        {'W': 12000.0, 'z0': 700.0, 'rho_s': 'auto', 'Qs': 4.0e5, 'gamma': 7.0e-4, 's': 0.006, 'case_id': 'D'}\n    ]\n\n    results = []\n\n    for params in test_cases_params:\n        W = params['W']\n        z0 = params['z0']\n        Qs = params['Qs']\n        gamma = params['gamma']\n        s = params['s']\n        \n        # Calculate rho_s for Case D\n        if params['rho_s'] == 'auto':\n            rho_s = RHO_0 + gamma * z0 + 0.05\n        else:\n            rho_s = params['rho_s']\n\n        # Initial conditions\n        x = 0.0\n        z = z0\n        Q = Qs\n        \n        rho_a_0 = RHO_0 + gamma * z0\n        delta_rho = rho_s - rho_a_0\n\n        # Check if plume is dense at the sill\n        if delta_rho = 0:\n            results.append([z0, Qs])\n            continue\n        \n        # Lists to store history for interpolation\n        history = []\n        \n        # Integration loop\n        while True:\n            # Check termination conditions\n            if delta_rho = 0 or z = Z_MAX:\n                break\n                \n            # Store state before update\n            history.append({'z': z, 'Q': Q, 'delta_rho': delta_rho})\n\n            # Calculate reduced gravity\n            g_prime = (G / RHO_0) * delta_rho\n            \n            # Avoid root of negative number, though loop condition should prevent it\n            if g_prime * Q  0:\n                break\n\n            # Layer speed from critical Froude number condition\n            U = np.cbrt(g_prime * Q / W)\n            \n            # Derivatives\n            dQ_dx = ALPHA_E * W * U\n            d_delta_rho_dx = (-delta_rho / Q) * dQ_dx - gamma * s\n            \n            # Update variables using Forward Euler method\n            x += DX\n            z += s * DX\n            Q += dQ_dx * DX\n            delta_rho += d_delta_rho_dx * DX\n\n        # Finalization\n        if z = Z_MAX and delta_rho  0: # Reached max depth while still dense\n            z_inj = Z_MAX\n            q_inj = Q\n        else: # Crossed neutral buoyancy\n            if not history: # Could happen if it's not dense on the first step\n                 results.append([z0, Qs])\n                 continue\n                 \n            prev_state = history[-1]\n            z_prev, Q_prev, delta_rho_prev = prev_state['z'], prev_state['Q'], prev_state['delta_rho']\n            \n            # Current state is the one that terminated the loop\n            z_curr, Q_curr, delta_rho_curr = z, Q, delta_rho\n\n            # Linear interpolation to find where delta_rho is zero\n            if (delta_rho_prev - delta_rho_curr) == 0:\n                # This should not happen if delta_rho is changing\n                fraction = 0.5\n            else:\n                fraction = delta_rho_prev / (delta_rho_prev - delta_rho_curr)\n\n            z_inj = z_prev + (z_curr - z_prev) * fraction\n            q_inj = Q_prev + (Q_curr - Q_prev) * fraction\n            \n        results.append([z_inj, q_inj])\n\n    # Format output as required\n    formatted_pairs = []\n    for z_final, q_final in results:\n        formatted_pairs.append(f\"[{z_final:.3f},{q_final:.3f}]\")\n    \n    final_output_str = f\"[{','.join(formatted_pairs)}]\"\n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}