{
    "hands_on_practices": [
        {
            "introduction": "Before attempting a numerical solution, it is crucial to ensure a problem is mathematically well-posed. This exercise grounds the abstract Poisson equation in the tangible physical context of an estuary, where river inflow acts as a source term. By applying the divergence theorem, you will derive the analytical compatibility condition that connects the boundary fluxes to the internal sources, a step that guarantees a physically meaningful solution by enforcing mass conservation .",
            "id": "3787077",
            "problem": "Consider a steady, depth-integrated, barotropic flow in a rectangular estuary domain $\\Omega = \\{(x,y)\\,|\\, 0 < x < L,\\; 0 < y < W\\}$ of constant width $W$ and length $L$. Let the depth-integrated transport vector be $\\mathbf{U}(x,y)$, and assume irrotational flow so that there exists a velocity potential $\\phi(x,y)$ with $\\mathbf{U} = \\nabla \\phi$. The steady depth-integrated mass continuity for transport in the presence of a distributed river inflow per unit area $q(x,y)$ is $\\nabla \\cdot \\mathbf{U} = q(x,y)$.\n\nThe river inflow is modeled as a spatially distributed source that is strongest near the river head and decays downstream:\n$$\nq(x,y) = \\frac{Q_{r}}{W \\,\\ell}\\,\\exp\\!\\left(-\\frac{x}{\\ell}\\right),\n$$\nwhere $Q_{r} > 0$ is a specified discharge scale and $\\ell > 0$ is a decay length scale. The impermeable sidewalls at $y=0$ and $y=W$ and the closed river head at $x=0$ enforce no-normal-flow boundaries. At the ocean mouth $x=L$, the outward normal transport per unit width is prescribed by a Neumann boundary condition of the form\n$$\n\\frac{\\partial \\phi}{\\partial n}\\Big|_{x=L} = g(y) = c \\left[1 + \\alpha \\cos\\!\\left(\\frac{2\\pi y}{W}\\right)\\right],\n$$\nwhere $\\alpha$ is a given shape parameter with $|\\alpha| < 1$, and $c$ is an unknown amplitude that must be determined to ensure well-posedness.\n\nTasks:\n- Starting from the steady depth-integrated continuity and the definition of the velocity potential, formulate the governing partial differential equation and all boundary conditions for $\\phi(x,y)$ on $\\Omega$.\n- By invoking the divergence theorem, derive the Neumann compatibility (solvability) condition that must hold for $\\phi$ to exist.\n- Using this condition and the given data, determine a closed-form expression for the amplitude $c$ in terms of $Q_{r}$, $L$, $W$, $\\ell$, and $\\alpha$.\n\nGive the final result as a single closed-form analytic expression for $c$. No numerical evaluation or rounding is required, and no units should be included in the final expression.",
            "solution": "The problem requires the determination of a constant $c$ in a boundary condition for a potential flow problem, such that the problem is well-posed. This is achieved by first formulating the governing partial differential equation (PDE) and boundary conditions for the velocity potential $\\phi(x,y)$, and then applying the divergence theorem to establish a solvability condition.\n\n**Step 1: Formulation of the Governing PDE and Boundary Conditions**\n\nThe depth-integrated transport vector $\\mathbf{U}(x,y)$ is related to the velocity potential $\\phi(x,y)$ by the definition of an irrotational flow:\n$$\n\\mathbf{U} = \\nabla \\phi\n$$\nwhere $\\nabla$ is the gradient operator, so $\\mathbf{U} = \\frac{\\partial \\phi}{\\partial x}\\mathbf{i} + \\frac{\\partial \\phi}{\\partial y}\\mathbf{j}$.\n\nThe steady depth-integrated mass continuity equation is given as:\n$$\n\\nabla \\cdot \\mathbf{U} = q(x,y)\n$$\nSubstituting the definition of the velocity potential into the continuity equation yields the governing PDE for $\\phi(x,y)$:\n$$\n\\nabla \\cdot (\\nabla \\phi) = q(x,y)\n$$\nThis is the Poisson equation:\n$$\n\\nabla^2 \\phi = \\frac{\\partial^2 \\phi}{\\partial x^2} + \\frac{\\partial^2 \\phi}{\\partial y^2} = q(x,y)\n$$\nwhere the source term is given by $q(x,y) = \\frac{Q_{r}}{W \\,\\ell}\\,\\exp\\!\\left(-\\frac{x}{\\ell}\\right)$.\n\nNext, we formulate the boundary conditions on the rectangular domain $\\Omega = \\{(x,y)\\,|\\, 0 < x < L,\\; 0 < y < W\\}$. The no-normal-flow condition means that the component of the transport vector $\\mathbf{U}$ normal to the boundary is zero. The normal derivative of the potential, $\\frac{\\partial \\phi}{\\partial n} = \\nabla \\phi \\cdot \\mathbf{n}$, represents the normal component of the velocity, where $\\mathbf{n}$ is the outward unit normal vector.\n\n1.  **River head at $x=0$**: The outward unit normal is $\\mathbf{n} = -\\mathbf{i}$. The no-flow condition is $\\mathbf{U} \\cdot \\mathbf{n} = (\\nabla\\phi) \\cdot (-\\mathbf{i}) = -\\frac{\\partial \\phi}{\\partial x} = 0$. Thus, $\\frac{\\partial \\phi}{\\partial x}(0,y) = 0$ for $0 < y < W$.\n\n2.  **Sidewall at $y=0$**: The outward unit normal is $\\mathbf{n} = -\\mathbf{j}$. The no-flow condition is $\\mathbf{U} \\cdot \\mathbf{n} = (\\nabla\\phi) \\cdot (-\\mathbf{j}) = -\\frac{\\partial \\phi}{\\partial y} = 0$. Thus, $\\frac{\\partial \\phi}{\\partial y}(x,0) = 0$ for $0 < x < L$.\n\n3.  **Sidewall at $y=W$**: The outward unit normal is $\\mathbf{n} = \\mathbf{j}$. The no-flow condition is $\\mathbf{U} \\cdot \\mathbf{n} = (\\nabla\\phi) \\cdot \\mathbf{j} = \\frac{\\partial \\phi}{\\partial y} = 0$. Thus, $\\frac{\\partial \\phi}{\\partial y}(x,W) = 0$ for $0 < x < L$.\n\n4.  **Ocean mouth at $x=L$**: The outward unit normal is $\\mathbf{n} = \\mathbf{i}$. The problem prescribes the outward normal transport per unit width as $\\frac{\\partial \\phi}{\\partial n} = g(y)$. Therefore, $\\frac{\\partial \\phi}{\\partial x}(L,y) = g(y) = c \\left[1 + \\alpha \\cos\\!\\left(\\frac{2\\pi y}{W}\\right)\\right]$ for $0 < y < W$.\n\nThe complete problem is a Neumann boundary value problem for the Poisson equation.\n\n**Step 2: Derivation of the Neumann Compatibility (Solvability) Condition**\n\nFor a solution to the Neumann problem $\\nabla^2 \\phi = f$ on a domain $\\Omega$ with boundary condition $\\frac{\\partial \\phi}{\\partial n} = h$ on the boundary $\\partial \\Omega$, a compatibility condition must be satisfied. This condition arises from the divergence theorem (also known as Green's theorem in the plane).\n\nThe divergence theorem states:\n$$\n\\iint_{\\Omega} (\\nabla \\cdot \\mathbf{F}) \\,dA = \\oint_{\\partial \\Omega} (\\mathbf{F} \\cdot \\mathbf{n}) \\,ds\n$$\nLet's choose the vector field $\\mathbf{F} = \\nabla \\phi$. Then $\\nabla \\cdot \\mathbf{F} = \\nabla \\cdot (\\nabla \\phi) = \\nabla^2 \\phi$. The flux term is $\\mathbf{F} \\cdot \\mathbf{n} = \\nabla \\phi \\cdot \\mathbf{n} = \\frac{\\partial \\phi}{\\partial n}$.\nSubstituting these into the divergence theorem gives:\n$$\n\\iint_{\\Omega} \\nabla^2 \\phi \\,dx\\,dy = \\oint_{\\partial \\Omega} \\frac{\\partial \\phi}{\\partial n} \\,ds\n$$\nUsing the PDE $\\nabla^2 \\phi = q(x,y)$, the solvability condition becomes:\n$$\n\\iint_{\\Omega} q(x,y) \\,dx\\,dy = \\oint_{\\partial \\Omega} \\frac{\\partial \\phi}{\\partial n} \\,ds\n$$\nThis condition has a clear physical meaning: the total mass generated by sources inside the domain must equal the total net mass flux out of the domain through its boundary.\n\n**Step 3: Determination of the Amplitude $c$**\n\nWe now evaluate both sides of the compatibility condition using the given data.\n\nThe left-hand side (LHS) is the integral of the source term over the domain:\n$$\n\\text{LHS} = \\iint_{\\Omega} q(x,y) \\,dx\\,dy = \\int_{0}^{W} \\int_{0}^{L} \\frac{Q_{r}}{W \\,\\ell}\\,\\exp\\!\\left(-\\frac{x}{\\ell}\\right) \\,dx\\,dy\n$$\nSince the integrand does not depend on $y$, we can separate the integrals:\n$$\n\\text{LHS} = \\frac{Q_{r}}{W \\,\\ell} \\left(\\int_{0}^{W} dy\\right) \\left(\\int_{0}^{L} \\exp\\!\\left(-\\frac{x}{\\ell}\\right) \\,dx\\right)\n$$\nThe integral with respect to $y$ is $W$. The integral with respect to $x$ is:\n$$\n\\int_{0}^{L} \\exp\\!\\left(-\\frac{x}{\\ell}\\right) \\,dx = \\left[-\\ell \\exp\\!\\left(-\\frac{x}{\\ell}\\right)\\right]_{0}^{L} = -\\ell \\exp\\!\\left(-\\frac{L}{\\ell}\\right) - (-\\ell \\exp(0)) = \\ell \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right)\n$$\nSubstituting these back into the expression for the LHS:\n$$\n\\text{LHS} = \\frac{Q_{r}}{W \\,\\ell} \\cdot W \\cdot \\ell \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right) = Q_{r} \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right)\n$$\n\nThe right-hand side (RHS) is the line integral of the normal derivative of $\\phi$ along the boundary $\\partial \\Omega$. The boundary consists of four segments.\n$$\n\\text{RHS} = \\oint_{\\partial \\Omega} \\frac{\\partial \\phi}{\\partial n} \\,ds = \\int_{x=0} + \\int_{y=0} + \\int_{x=L} + \\int_{y=W}\n$$\nThe contributions from the boundaries at $x=0$, $y=0$, and $y=W$ are zero because the no-flow condition $\\frac{\\partial \\phi}{\\partial n} = 0$ is imposed on them. The only non-zero contribution comes from the ocean mouth at $x=L$:\n$$\n\\text{RHS} = \\int_{0}^{W} \\frac{\\partial \\phi}{\\partial x}(L,y) \\,dy = \\int_{0}^{W} g(y) \\,dy\n$$\nSubstituting the expression for $g(y)$:\n$$\n\\text{RHS} = \\int_{0}^{W} c \\left[1 + \\alpha \\cos\\!\\left(\\frac{2\\pi y}{W}\\right)\\right] \\,dy\n$$\nWe compute the integral:\n$$\n\\text{RHS} = c \\left[ \\int_{0}^{W} 1 \\,dy + \\alpha \\int_{0}^{W} \\cos\\!\\left(\\frac{2\\pi y}{W}\\right) \\,dy \\right]\n$$\n$$\n\\text{RHS} = c \\left[ [y]_{0}^{W} + \\alpha \\left[\\frac{W}{2\\pi} \\sin\\!\\left(\\frac{2\\pi y}{W}\\right)\\right]_{0}^{W} \\right]\n$$\n$$\n\\text{RHS} = c \\left[ (W-0) + \\alpha \\left(\\frac{W}{2\\pi} \\sin(2\\pi) - \\frac{W}{2\\pi} \\sin(0)\\right) \\right]\n$$\nSince $\\sin(2\\pi) = 0$ and $\\sin(0) = 0$, the second term vanishes.\n$$\n\\text{RHS} = c W\n$$\n\nFinally, we equate the LHS and RHS to enforce the compatibility condition:\n$$\nQ_{r} \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right) = c W\n$$\nSolving for the unknown amplitude $c$ yields the final expression:\n$$\nc = \\frac{Q_{r}}{W} \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right)\n$$",
            "answer": "$$\n\\boxed{\\frac{Q_{r}}{W} \\left(1 - \\exp\\left(-\\frac{L}{\\ell}\\right)\\right)}\n$$"
        },
        {
            "introduction": "This practice moves from analytical theory to direct numerical implementation, focusing on the cornerstone technique for decomposing a velocity field in a periodic domain. You will use spectral methods, powered by the Fast Fourier Transform (FFT), to solve the Poisson equations for the streamfunction $\\psi$ and velocity potential $\\phi$. By reconstructing the velocity field from your computed potentials and verifying the error, you will build a robust understanding of this fundamental \"round-trip\" computational workflow, which is central to analyzing data from many oceanic and atmospheric models .",
            "id": "3787062",
            "problem": "Consider a horizontally two-dimensional ocean surface velocity field $\\mathbf{u}(x,y,t)$ on a rectangular, periodic domain with lengths $L_x$ and $L_y$ in meters. The field is assumed sufficiently smooth and decays no faster than polynomially, so that classical vector calculus applies. Use the following foundational base:\n\n- The Helmholtz decomposition on a periodic domain: any smooth vector field can be represented as the sum of an irrotational component (the gradient of a scalar potential) and a solenoidal component (the skew-gradient of a streamfunction).\n- The definitions of divergence and vertical vorticity: for $\\mathbf{u}=(u,v)$, $\\nabla\\cdot\\mathbf{u}=\\partial_x u+\\partial_y v$ (with unit $\\mathrm{s}^{-1}$) and $\\zeta=\\hat{\\mathbf{z}}\\cdot(\\nabla\\times\\mathbf{u})=\\partial_x v-\\partial_y u$ (also with unit $\\mathrm{s}^{-1}$), where $\\hat{\\mathbf{z}}$ is the unit vector perpendicular to the horizontal plane.\n- The definition of the Laplacian operator $\\nabla^2=\\partial_x^2+\\partial_y^2$.\n\nStarting from these bases, derive how to reconstruct $\\mathbf{u}$ from the velocity potential $\\phi$ and streamfunction $\\psi$ obtained by solving Poisson equations on the periodic domain, and quantify the reconstruction error in terms of residual divergence and residual vertical vorticity.\n\nYour program must implement the following steps in purely mathematical terms:\n\n1. Construct a synthetic, smooth “true” velocity field $\\mathbf{u}_{\\mathrm{true}}(x,y)$ by combining an irrotational component generated from a scalar potential $\\phi_{\\mathrm{true}}(x,y)$ and a solenoidal component generated from a streamfunction $\\psi_{\\mathrm{true}}(x,y)$, defined on a uniform grid with $N_x\\times N_y$ points over $[0,L_x)\\times[0,L_y)$ with periodic boundary conditions. Use the forms\n   - $\\phi_{\\mathrm{true}}(x,y)=A_\\phi\\cos\\left(\\frac{2\\pi n x}{L_x}\\right)\\sin\\left(\\frac{2\\pi m y}{L_y}\\right)$,\n   - $\\psi_{\\mathrm{true}}(x,y)=A_\\psi\\sin\\left(\\frac{2\\pi p x}{L_x}\\right)\\sin\\left(\\frac{2\\pi q y}{L_y}\\right)$,\n   where $A_\\phi$ and $A_\\psi$ are amplitudes in $\\mathrm{m}^2/\\mathrm{s}$, and $n,m,p,q$ are nonnegative integers controlling spatial scales. From these, compute $\\mathbf{u}_{\\mathrm{true}}$ according to the fundamental definitions linking velocity to potentials implied by the Helmholtz decomposition (do not use any shortcut formulas beyond what can be derived from the provided bases).\n\n2. Compute $\\nabla\\cdot\\mathbf{u}_{\\mathrm{true}}$ and $\\zeta_{\\mathrm{true}}$ using mathematically valid differentiation that honors the periodic boundary conditions.\n\n3. Solve the Poisson equations for the velocity potential and streamfunction on the periodic domain,\n   - $\\nabla^2\\phi=\\nabla\\cdot\\mathbf{u}_{\\mathrm{true}}$,\n   - $\\nabla^2\\psi=\\zeta_{\\mathrm{true}}$,\n   fixing the gauge by setting the zero-wavenumber Fourier component of both $\\phi$ and $\\psi$ to zero (i.e., zero mean).\n\n4. Reconstruct the velocity field $\\mathbf{u}_{\\mathrm{rec}}$ from the computed $\\phi$ and $\\psi$ based solely on the decomposition implied by the foundational definitions.\n\n5. Quantify reconstruction error in terms of:\n   - residual divergence $r_{\\mathrm{div}}=\\left(\\mathrm{RMS}\\left[\\nabla\\cdot(\\mathbf{u}_{\\mathrm{rec}}-\\mathbf{u}_{\\mathrm{true}})\\right]\\right)$,\n   - residual vertical vorticity $r_{\\mathrm{vort}}=\\left(\\mathrm{RMS}\\left[\\hat{\\mathbf{z}}\\cdot\\nabla\\times(\\mathbf{u}_{\\mathrm{rec}}-\\mathbf{u}_{\\mathrm{true}})\\right]\\right)$.\n   Both $r_{\\mathrm{div}}$ and $r_{\\mathrm{vort}}$ must be reported in $\\mathrm{s}^{-1}$.\n\nImplementation constraints:\n- Use a uniform grid and periodic boundary conditions in both $x$ and $y$ directions.\n- Use a spectrally consistent method for differentiation and solving the Poisson equations that is valid on a periodic domain.\n\nTest suite:\nRun your program for the following four parameter sets, each defined by $(N_x,N_y,L_x,L_y,A_\\phi,A_\\psi,n,m,p,q)$:\n- Case $1$: $(128,128,1.2\\times 10^6,8.0\\times 10^5,7.5\\times 10^4,5.0\\times 10^4,4,5,3,2)$.\n- Case $2$ (purely irrotational): $(128,128,1.0\\times 10^6,1.0\\times 10^6,6.0\\times 10^4,0.0,6,5,1,1)$.\n- Case $3$ (purely solenoidal): $(128,128,9.0\\times 10^5,1.1\\times 10^6,0.0,8.5\\times 10^4,1,1,7,4)$.\n- Case $4$ (anisotropic with one zero mode in $\\phi$): $(96,96,8.0\\times 10^5,6.0\\times 10^5,2.5\\times 10^4,3.0\\times 10^4,0,8,10,1)$.\n\nAnswer specification:\n- For each case, return a list of two floats $[r_{\\mathrm{div}},r_{\\mathrm{vort}}]$ in $\\mathrm{s}^{-1}$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each case’s result itself a list, for example, $[[r_{\\mathrm{div},1},r_{\\mathrm{vort},1}],[r_{\\mathrm{div},2},r_{\\mathrm{vort},2}],\\dots]$.",
            "solution": "### Principle-Based Design\n\nThe core of this problem is the Helmholtz-Hodge decomposition of a vector field on a two-dimensional periodic torus. This theorem states that any sufficiently smooth vector field $\\mathbf{u}$ can be uniquely decomposed into a divergence-free (solenoidal) component and a curl-free (irrotational) component.\n\nThe irrotational component is the gradient of a scalar potential, $\\phi$, denoted $\\mathbf{u}_{\\phi} = \\nabla \\phi$. By construction, its curl is zero: $\\nabla \\times (\\nabla \\phi) = \\mathbf{0}$.\n\nThe solenoidal component is derived from a streamfunction, $\\psi$. The problem states that this component is the \"skew-gradient of a streamfunction\" and provides the Poisson equation $\\nabla^2\\psi = \\zeta$, where $\\zeta = \\hat{\\mathbf{z}}\\cdot(\\nabla\\times\\mathbf{u})$ is the vertical vorticity. Let us derive the precise relationship. Let the solenoidal velocity component be $\\mathbf{u}_{\\psi} = (u_{\\psi}, v_{\\psi})$. For this field to be solenoidal, its divergence must be zero: $\\nabla \\cdot \\mathbf{u}_{\\psi} = \\partial_x u_{\\psi} + \\partial_y v_{\\psi} = 0$. This condition implies the existence of a scalar field $\\psi$ such that $u_{\\psi} = -\\partial_y \\psi$ and $v_{\\psi} = \\partial_x \\psi$. Adopting this convention, let us compute the vorticity of this component:\n$$\n\\zeta_{\\psi} = \\hat{\\mathbf{z}}\\cdot(\\nabla \\times \\mathbf{u}_{\\psi}) = \\partial_x v_{\\psi} - \\partial_y u_{\\psi} = \\partial_x(\\partial_x \\psi) - \\partial_y(-\\partial_y \\psi) = \\partial_x^2 \\psi + \\partial_y^2 \\psi = \\nabla^2 \\psi\n$$\nThis result, $\\zeta_{\\psi} = \\nabla^2 \\psi$, is consistent with the Poisson equation $\\nabla^2\\psi = \\zeta_{\\mathrm{true}}$ given in the problem statement. Therefore, we must define the total velocity field $\\mathbf{u}=(u,v)$ in terms of the potential $\\phi$ and streamfunction $\\psi$ as:\n$$\n\\mathbf{u} = \\nabla \\phi + \\hat{\\mathbf{z}} \\times \\nabla \\psi\n$$\nor in component form:\n$$\nu(x,y) = \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} \\\\\nv(x,y) = \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x}\n$$\nThe full decomposition process involves taking the divergence and curl of the total velocity field:\n$$\n\\nabla \\cdot \\mathbf{u} = \\nabla \\cdot (\\nabla \\phi + \\hat{\\mathbf{z}} \\times \\nabla \\psi) = \\nabla^2 \\phi + \\nabla \\cdot (\\hat{\\mathbf{z}} \\times \\nabla \\psi) = \\nabla^2 \\phi\n$$\n$$\n\\hat{\\mathbf{z}} \\cdot (\\nabla \\times \\mathbf{u}) = \\zeta = \\hat{\\mathbf{z}} \\cdot (\\nabla \\times (\\nabla \\phi + \\hat{\\mathbf{z}} \\times \\nabla \\psi)) = \\hat{\\mathbf{z}} \\cdot (\\nabla \\times (\\hat{\\mathbf{z}} \\times \\nabla \\psi)) = \\nabla^2 \\psi\n$$\nThus, to find $\\phi$ and $\\psi$ from $\\mathbf{u}$, one must solve the two Poisson equations specified in the problem. The reconstruction of $\\mathbf{u}$ from $\\phi$ and $\\psi$ then uses the component relations derived above.\n\nThe numerical implementation will leverage the properties of the Fourier transform on a periodic domain, which provides a spectrally accurate method for differentiation and for solving the Poisson equation.\n\n#### Step 1: Construct the \"True\" Velocity Field\n\nFirst, we define a discrete grid with $N_x \\times N_y$ points spanning the domain $[0, L_x) \\times [0, L_y)$. The grid coordinates are $(x_i, y_j)$ for $i \\in \\{0, ..., N_x-1\\}$ and $j \\in \\{0, ..., N_y-1\\}$.\nThe true scalar potential $\\phi_{\\mathrm{true}}$ and streamfunction $\\psi_{\\mathrm{true}}$ are given by:\n$$\n\\phi_{\\mathrm{true}}(x,y)=A_\\phi\\cos\\left(\\frac{2\\pi n x}{L_x}\\right)\\sin\\left(\\frac{2\\pi m y}{L_y}\\right)\n$$\n$$\n\\psi_{\\mathrm{true}}(x,y)=A_\\psi\\sin\\left(\\frac{2\\pi p x}{L_x}\\right)\\sin\\left(\\frac{2\\pi q y}{L_y}\\right)\n$$\nUsing the consistent relationships derived above, the components of the true velocity field $\\mathbf{u}_{\\mathrm{true}} = (u_{\\mathrm{true}}, v_{\\mathrm{true}})$ are analytically:\n$$\nu_{\\mathrm{true}} = \\frac{\\partial \\phi_{\\mathrm{true}}}{\\partial x} - \\frac{\\partial \\psi_{\\mathrm{true}}}{\\partial y} = -A_\\phi\\frac{2\\pi n}{L_x}\\sin\\left(\\frac{2\\pi n x}{L_x}\\right)\\sin\\left(\\frac{2\\pi m y}{L_y}\\right) - A_\\psi\\frac{2\\pi q}{L_y}\\sin\\left(\\frac{2\\pi p x}{L_x}\\right)\\cos\\left(\\frac{2\\pi q y}{L_y}\\right)\n$$\n$$\nv_{\\mathrm{true}} = \\frac{\\partial \\phi_{\\mathrm{true}}}{\\partial y} + \\frac{\\partial \\psi_{\\mathrm{true}}}{\\partial x} = A_\\phi\\frac{2\\pi m}{L_y}\\cos\\left(\\frac{2\\pi n x}{L_x}\\right)\\cos\\left(\\frac{2\\pi m y}{L_y}\\right) + A_\\psi\\frac{2\\pi p}{L_x}\\cos\\left(\\frac{2\\pi p x}{L_x}\\right)\\sin\\left(\\frac{2\\pi q y}{L_y}\\right)\n$$\nThese expressions will be evaluated on the discrete grid to generate the synthetic \"true\" velocity field.\n\n#### Step 2: Compute Divergence and Vorticity of the True Field\n\nFor a function $f(x,y)$ on the periodic grid, its partial derivatives can be computed spectrally. Let $\\hat{f}(k_x, k_y)$ be the 2D discrete Fourier transform of $f$. The Fourier transforms of the partial derivatives are:\n$$\n\\mathcal{F}\\left\\{\\frac{\\partial f}{\\partial x}\\right\\} = i k_x \\hat{f}(k_x, k_y) \\quad , \\quad \\mathcal{F}\\left\\{\\frac{\\partial f}{\\partial y}\\right\\} = i k_y \\hat{f}(k_x, k_y)\n$$\nwhere $(k_x, k_y)$ are the wavenumbers corresponding to the discrete grid.\nThe divergence $\\delta_{\\mathrm{true}} = \\nabla \\cdot \\mathbf{u}_{\\mathrm{true}}$ and vorticity $\\zeta_{\\mathrm{true}} = \\hat{\\mathbf{z}}\\cdot(\\nabla \\times \\mathbf{u}_{\\mathrm{true}})$ are computed by applying this principle. Let $\\hat{u}_{\\mathrm{true}}$ and $\\hat{v}_{\\mathrm{true}}$ be the Fourier transforms of the velocity components. Then the transforms of the divergence and vorticity are:\n$$\n\\hat{\\delta}_{\\mathrm{true}}(k_x, k_y) = i k_x \\hat{u}_{\\mathrm{true}} + i k_y \\hat{v}_{\\mathrm{true}}\n$$\n$$\n\\hat{\\zeta}_{\\mathrm{true}}(k_x, k_y) = i k_x \\hat{v}_{\\mathrm{true}} - i k_y \\hat{u}_{\\mathrm{true}}\n$$\nAn inverse Fourier transform on $\\hat{\\delta}_{\\mathrm{true}}$ and $\\hat{\\zeta}_{\\mathrm{true}}$ yields the fields in physical space.\n\n#### Step 3: Solve the Poisson Equations\n\nWe solve $\\nabla^2\\phi = \\delta_{\\mathrm{true}}$ and $\\nabla^2\\psi = \\zeta_{\\mathrm{true}}$. In Fourier space, the Laplacian operator $\\nabla^2$ becomes multiplication by $-(k_x^2 + k_y^2)$. Let $K^2 = k_x^2 + k_y^2$. The equations transform to:\n$$\n-K^2 \\hat{\\phi} = \\hat{\\delta}_{\\mathrm{true}}\n$$\n$$\n-K^2 \\hat{\\psi} = \\hat{\\zeta}_{\\mathrm{true}}\n$$\nThe solutions for the transformed potentials are:\n$$\n\\hat{\\phi} = -\\frac{\\hat{\\delta}_{\\mathrm{true}}}{K^2} \\quad , \\quad \\hat{\\psi} = -\\frac{\\hat{\\zeta}_{\\mathrm{true}}}{K^2}\n$$\nFor the zero-wavenumber mode ($k_x=0, k_y=0$), $K^2=0$, leading to a singularity. However, the physical problem is well-posed. The spatial average of a Laplacian must be zero on a periodic domain, which means $\\hat{\\delta}_{\\mathrm{true}}(0,0)=0$ and $\\hat{\\zeta}_{\\mathrm{true}}(0,0)=0$. This leads to a $0/0$ indeterminate form. The problem statement provides the gauge condition: the zero-wavenumber component of both $\\phi$ and $\\psi$ must be zero. This resolves the ambiguity. We set $\\hat{\\phi}(0,0)=0$ and $\\hat{\\psi}(0,0)=0$. The numerical solutions $\\phi$ and $\\psi$ are then found by taking the inverse Fourier transform of $\\hat{\\phi}$ and $\\hat{\\psi}$.\n\n#### Step 4: Reconstruct the Velocity Field\n\nThe reconstructed velocity field $\\mathbf{u}_{\\mathrm{rec}} = (u_{\\mathrm{rec}}, v_{\\mathrm{rec}})$ is computed from the numerical potentials $\\phi$ and $\\psi$ using spectral differentiation, following the definitions established initially:\n$$\n\\hat{u}_{\\mathrm{rec}}(k_x, k_y) = i k_x \\hat{\\phi} - i k_y \\hat{\\psi}\n$$\n$$\n\\hat{v}_{\\mathrm{rec}}(k_x, k_y) = i k_y \\hat{\\phi} + i k_x \\hat{\\psi}\n$$\nInverse Fourier transforms of $\\hat{u}_{\\mathrm{rec}}$ and $\\hat{v}_{\\mathrm{rec}}$ yield the reconstructed velocity field in physical space. Since the source fields are real, the resulting velocity fields will be real, and any residual imaginary part due to floating-point error should be discarded.\n\n#### Step 5: Quantify Reconstruction Error\n\nThe error in reconstruction is assessed by examining the residual fields. The velocity error is $\\mathbf{u}_{\\mathrm{err}} = \\mathbf{u}_{\\mathrm{rec}} - \\mathbf{u}_{\\mathrm{true}}$. We calculate the divergence and vorticity of this error field, again using spectral methods:\n$$\nd_{\\mathrm{err}} = \\nabla \\cdot \\mathbf{u}_{\\mathrm{err}}\n$$\n$$\n\\zeta_{\\mathrm{err}} = \\hat{\\mathbf{z}}\\cdot(\\nabla \\times \\mathbf{u}_{\\mathrm{err}})\n$$\nThe final error metrics are the Root Mean Square (RMS) of these residual fields, computed over all $N_x \\times N_y$ grid points:\n$$\nr_{\\mathrm{div}} = \\sqrt{\\frac{1}{N_x N_y} \\sum_{i,j} (d_{\\mathrm{err}}(x_i, y_j))^2}\n$$\n$$\nr_{\\mathrm{vort}} = \\sqrt{\\frac{1}{N_x N_y} \\sum_{i,j} (\\zeta_{\\mathrm{err}}(x_i, y_j))^2}\n$$\nSince the entire process uses spectrally accurate methods for a smooth, analytic problem, the reconstruction should be exact up to machine precision. The resulting residual errors $r_{\\mathrm{div}}$ and $r_{\\mathrm{vort}}$ are therefore expected to be extremely small.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import fft\n\ndef compute_reconstruction_error(Nx, Ny, Lx, Ly, A_phi, A_psi, n, m, p, q):\n    \"\"\"\n    Implements the Helmholtz decomposition and reconstruction process.\n    \n    This function follows the steps outlined in the problem:\n    1. Constructs a true velocity field from analytic potentials.\n    2. Computes its divergence and vorticity using spectral methods.\n    3. Solves the Poisson equations to recover the potentials.\n    4. Reconstructs the velocity field from the computed potentials.\n    5. Quantifies the reconstruction error via residual divergence and vorticity.\n    \"\"\"\n    \n    # Grid setup\n    x = np.linspace(0, Lx, Nx, endpoint=False)\n    y = np.linspace(0, Ly, Ny, endpoint=False)\n    xx, yy = np.meshgrid(x, y)\n\n    # Wavenumber grid setup\n    dx = Lx / Nx\n    dy = Ly / Ny\n    kx_1d = 2 * np.pi * fft.fftfreq(Nx, d=dx)\n    ky_1d = 2 * np.pi * fft.fftfreq(Ny, d=dy)\n    kx, ky = np.meshgrid(kx_1d, ky_1d)\n\n    # Step 1: Construct the \"True\" Velocity Field\n    # Wavenumbers for the analytic functions\n    kn_phi = 2 * np.pi * n / Lx if Lx != 0 else 0\n    km_phi = 2 * np.pi * m / Ly if Ly != 0 else 0\n    kp_psi = 2 * np.pi * p / Lx if Lx != 0 else 0\n    kq_psi = 2 * np.pi * q / Ly if Ly != 0 else 0\n\n    # Analytic forms of the potentials\n    phi_true = A_phi * np.cos(kn_phi * xx) * np.sin(km_phi * yy)\n    psi_true = A_psi * np.sin(kp_psi * xx) * np.sin(kq_psi * yy)\n\n    # True velocity field from analytic derivatives of potentials\n    # u = d(phi)/dx - d(psi)/dy\n    # v = d(phi)/dy + d(psi)/dx\n    u_true = -A_phi * kn_phi * np.sin(kn_phi * xx) * np.sin(km_phi * yy) \\\n             -A_psi * kq_psi * np.sin(kp_psi * xx) * np.cos(kq_psi * yy)\n    \n    v_true =  A_phi * km_phi * np.cos(kn_phi * xx) * np.cos(km_phi * yy) \\\n             +A_psi * kp_psi * np.cos(kp_psi * xx) * np.sin(kq_psi * yy)\n\n    # Step 2: Compute Divergence and Vorticity of the True Field\n    u_true_hat = fft.fft2(u_true)\n    v_true_hat = fft.fft2(v_true)\n\n    delta_true_hat = 1j * kx * u_true_hat + 1j * ky * v_true_hat\n    zeta_true_hat = 1j * kx * v_true_hat - 1j * ky * u_true_hat\n\n    # Step 3: Solve the Poisson Equations\n    K2 = kx**2 + ky**2\n    \n    # To avoid division by zero at kx=ky=0\n    with np.errstate(divide='ignore', invalid='ignore'):\n        phi_hat = -delta_true_hat / K2\n        psi_hat = -zeta_true_hat / K2\n\n    # Apply gauge: zero mean potential (zero-wavenumber component is zero)\n    phi_hat[0, 0] = 0.0\n    psi_hat[0, 0] = 0.0\n    \n    # Step 4: Reconstruct the Velocity Field\n    # u_rec = d(phi)/dx - d(psi)/dy\n    # v_rec = d(phi)/dy + d(psi)/dx\n    u_rec_hat = 1j * kx * phi_hat - 1j * ky * psi_hat\n    v_rec_hat = 1j * ky * phi_hat + 1j * kx * psi_hat\n\n    u_rec = fft.ifft2(u_rec_hat).real\n    v_rec = fft.ifft2(v_rec_hat).real\n    \n    # Step 5: Quantify Reconstruction Error\n    u_err = u_rec - u_true\n    v_err = v_rec - v_true\n\n    u_err_hat = fft.fft2(u_err)\n    v_err_hat = fft.fft2(v_err)\n\n    # Residual divergence\n    d_err_hat = 1j * kx * u_err_hat + 1j * ky * v_err_hat\n    d_err = fft.ifft2(d_err_hat).real\n    r_div = np.sqrt(np.mean(d_err**2))\n\n    # Residual vorticity\n    z_err_hat = 1j * kx * v_err_hat - 1j * ky * u_err_hat\n    z_err = fft.ifft2(z_err_hat).real\n    r_vort = np.sqrt(np.mean(z_err**2))\n    \n    return [r_div, r_vort]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (128, 128, 1.2e6, 8.0e5, 7.5e4, 5.0e4, 4, 5, 3, 2),\n        (128, 128, 1.0e6, 1.0e6, 6.0e4, 0.0, 6, 5, 1, 1),\n        (128, 128, 9.0e5, 1.1e6, 0.0, 8.5e4, 1, 1, 7, 4),\n        (96, 96, 8.0e5, 6.0e5, 2.5e4, 3.0e4, 0, 8, 10, 1),\n    ]\n\n    results = []\n    for case in test_cases:\n        r_div, r_vort = compute_reconstruction_error(*case)\n        results.append(f\"[{r_div:.8e},{r_vort:.8e}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Idealized computations provide a clean foundation, but real-world oceanography relies on imperfect, noisy data. This exercise confronts that challenge by investigating how measurement noise propagates through the mathematical inversion for the velocity potential $\\phi$. You will use spectral analysis to prove that white noise in velocity measurements becomes \"red\" noise in the potential, biasing its variance, and then explore a standard statistical method, the Wiener filter, to mitigate this effect and recover a more accurate signal .",
            "id": "3787012",
            "problem": "Consider a horizontally two-dimensional ocean surface velocity field $\\boldsymbol{u}(\\boldsymbol{x}) = \\big(u(\\boldsymbol{x}), v(\\boldsymbol{x})\\big)$ defined on a large, statistically homogeneous domain, within which spectral methods are appropriate. The true velocity field admits a Helmholtz decomposition into an irrotational component $\\nabla \\phi(\\boldsymbol{x})$ (with velocity potential $\\phi$) and a solenoidal component orthogonal to $\\nabla \\phi(\\boldsymbol{x})$ (with streamfunction $\\psi$). The measured velocity field $\\boldsymbol{u}_{m}(\\boldsymbol{x})$ is contaminated by sensor noise that is independent of the signal and has a white spectrum in both components:\n$$\n\\boldsymbol{u}_{m}(\\boldsymbol{x}) = \\boldsymbol{u}(\\boldsymbol{x}) + \\boldsymbol{n}(\\boldsymbol{x}), \\quad \\boldsymbol{n}(\\boldsymbol{x}) = \\big(n_{u}(\\boldsymbol{x}), n_{v}(\\boldsymbol{x})\\big),\n$$\nwhere in the spectral domain (Fourier transform convention consistent with continuous spectra), each component noise has constant two-sided power spectral density (PSD) $S_{n}$ and the two components are mutually independent and isotropic.\n\nStarting from the definitions of the velocity potential and the Helmholtz decomposition, and using Fourier-domain arguments that are standard in computational oceanography, derive the expected bias introduced by $\\boldsymbol{n}$ in the diagnosed variance of $\\phi$ when $\\phi$ is estimated by projecting $\\boldsymbol{u}_{m}$ onto its irrotational component in wavenumber space. Assume the true oceanic signal is band-limited to isotropic wavenumbers $k \\in [k_{0}, k_{1}]$ with $0 < k_{0} < k_{1} < \\infty$, and that the diagnosis of $\\phi$ uses the divergence-based inversion on this band. Provide a closed-form expression, in terms of $S_{n}$, $k_{0}$, and $k_{1}$, for the expected additive bias in the diagnosed variance $\\mathbb{E}\\big[\\mathrm{Var}(\\phi_{\\text{diagnosed}})\\big] - \\mathrm{Var}(\\phi_{\\text{true}})$ attributable solely to the measurement noise.\n\nThen, propose a physically and statistically justified deconvolution or regularization strategy in the spectral domain to mitigate this bias at the level of the estimated field $\\hat{\\phi}(\\boldsymbol{k})$, describing the governing estimator in terms of the signal PSD of $\\phi$ and the noise PSD. You may assume isotropy so that all quantities depend only on $k = |\\boldsymbol{k}|$. Your final answer must be the analytic expression for the expected bias of the diagnosed $\\phi$ variance. Express your final result symbolically; no numerical evaluation or rounding is required, and no units should be included in your final expression.",
            "solution": "The problem asks for two results: first, the expected additive bias in the variance of the velocity potential $\\phi$ due to white measurement noise, and second, a strategy to mitigate this bias.\n\n### Part 1: Derivation of the Variance Bias\n\nThe velocity field $\\boldsymbol{u}$ admits a Helmholtz decomposition into an irrotational part, which is the gradient of a velocity potential $\\phi$, and a solenoidal (divergence-free) part. The relationship between the velocity field and the potential is given by the divergence:\n$$\n\\nabla \\cdot \\boldsymbol{u} = \\nabla \\cdot (\\nabla \\phi) = \\nabla^2 \\phi\n$$\nThis relationship provides the basis for inverting for $\\phi$ from $\\boldsymbol{u}$. We can express this relationship in the Fourier domain. Let $\\hat{f}(\\boldsymbol{k})$ denote the Fourier transform of a field $f(\\boldsymbol{x})$, where $\\boldsymbol{k} = (k_x, k_y)$ is the wavenumber vector. The Fourier transforms of the divergence and Laplacian operators are $\\widehat{\\nabla\\cdot} \\rightarrow i\\boldsymbol{k}\\cdot$ and $\\widehat{\\nabla^2} \\rightarrow -|\\boldsymbol{k}|^2 = -k^2$, respectively. Applying these to the equation above gives:\n$$\ni\\boldsymbol{k} \\cdot \\hat{\\boldsymbol{u}}(\\boldsymbol{k}) = -k^2 \\hat{\\phi}(\\boldsymbol{k})\n$$\nThis leads to the expression for the Fourier transform of the potential:\n$$\n\\hat{\\phi}(\\boldsymbol{k}) = -\\frac{i\\boldsymbol{k} \\cdot \\hat{\\boldsymbol{u}}(\\boldsymbol{k})}{k^2}\n$$\nThe problem states that $\\phi$ is diagnosed from the measured velocity field $\\boldsymbol{u}_m(\\boldsymbol{x})$, which is the sum of the true velocity $\\boldsymbol{u}(\\boldsymbol{x})$ and a noise field $\\boldsymbol{n}(\\boldsymbol{x})$. In the Fourier domain:\n$$\n\\hat{\\boldsymbol{u}}_m(\\boldsymbol{k}) = \\hat{\\boldsymbol{u}}(\\boldsymbol{k}) + \\hat{\\boldsymbol{n}}(\\boldsymbol{k})\n$$\nThe diagnosed potential, $\\phi_{\\text{diagnosed}}$, is therefore estimated as:\n$$\n\\hat{\\phi}_{\\text{diagnosed}}(\\boldsymbol{k}) = -\\frac{i\\boldsymbol{k} \\cdot \\hat{\\boldsymbol{u}}_m(\\boldsymbol{k})}{k^2} = -\\frac{i\\boldsymbol{k} \\cdot \\big(\\hat{\\boldsymbol{u}}(\\boldsymbol{k}) + \\hat{\\boldsymbol{n}}(\\boldsymbol{k})\\big)}{k^2}\n$$\nWe can separate this into the true potential and a noise-induced error term:\n$$\n\\hat{\\phi}_{\\text{diagnosed}}(\\boldsymbol{k}) = \\underbrace{-\\frac{i\\boldsymbol{k} \\cdot \\hat{\\boldsymbol{u}}(\\boldsymbol{k})}{k^2}}_{\\hat{\\phi}_{\\text{true}}(\\boldsymbol{k})} + \\underbrace{\\left(-\\frac{i\\boldsymbol{k} \\cdot \\hat{\\boldsymbol{n}}(\\boldsymbol{k})}{k^2}\\right)}_{\\hat{\\phi}_{\\text{noise}}(\\boldsymbol{k})}\n$$\nThe variance of a zero-mean, statistically homogeneous field is given by the integral of its power spectral density (PSD) over the wavenumber domain. The expected variance of the diagnosed potential is:\n$$\n\\mathbb{E}\\big[\\mathrm{Var}(\\phi_{\\text{diagnosed}})\\big] = \\int \\mathbb{E}\\big[|\\hat{\\phi}_{\\text{diagnosed}}(\\boldsymbol{k})|^2\\big] \\,d^2\\boldsymbol{k}\n$$\n(Note: Constants like $(2\\pi)^{-2}$ from Fourier transform conventions are implicitly absorbed into the definition of the PSD, a common practice).\nThe PSD of the diagnosed potential is:\n$$\n\\mathbb{E}\\big[|\\hat{\\phi}_{\\text{diagnosed}}(\\boldsymbol{k})|^2\\big] = \\mathbb{E}\\Big[\\big|\\hat{\\phi}_{\\text{true}}(\\boldsymbol{k}) + \\hat{\\phi}_{\\text{noise}}(\\boldsymbol{k})\\big|^2\\Big] = \\mathbb{E}\\Big[|\\hat{\\phi}_{\\text{true}}|^2 + |\\hat{\\phi}_{\\text{noise}}|^2 + 2\\text{Re}\\big\\{\\hat{\\phi}_{\\text{true}}\\hat{\\phi}_{\\text{noise}}^*\\big\\}\\Big]\n$$\nThe noise $\\boldsymbol{n}$ is independent of the true signal $\\boldsymbol{u}$, and the noise has zero mean, $\\mathbb{E}[\\boldsymbol{n}] = \\boldsymbol{0}$. Consequently, $\\mathbb{E}[\\hat{\\boldsymbol{n}}] = \\boldsymbol{0}$, which implies $\\mathbb{E}[\\hat{\\phi}_{\\text{noise}}] = 0$. The cross-term's expectation vanishes: $\\mathbb{E}\\big[\\hat{\\phi}_{\\text{true}}\\hat{\\phi}_{\\text{noise}}^*\\big] = \\mathbb{E}\\big[\\hat{\\phi}_{\\text{true}}\\big]\\mathbb{E}\\big[\\hat{\\phi}_{\\text{noise}}^*\\big]=0$. Therefore, the spectra add linearly:\n$$\n\\mathbb{E}\\big[|\\hat{\\phi}_{\\text{diagnosed}}|^2\\big] = \\mathbb{E}\\big[|\\hat{\\phi}_{\\text{true}}|^2\\big] + \\mathbb{E}\\big[|\\hat{\\phi}_{\\text{noise}}|^2\\big]\n$$\nThe expected additive bias in the variance is the total variance contributed by the noise term, integrated over the specified band-limit of the diagnosis, $k \\in [k_0, k_1]$:\n$$\n\\text{Bias} = \\int_{k_0 \\le |\\boldsymbol{k}| \\le k_1} \\mathbb{E}\\big[|\\hat{\\phi}_{\\text{noise}}(\\boldsymbol{k})|^2\\big] \\,d^2\\boldsymbol{k}\n$$\nWe must first find the PSD of the noise potential, $\\Phi_{\\phi,n}(\\boldsymbol{k}) = \\mathbb{E}\\big[|\\hat{\\phi}_{\\text{noise}}|^2\\big]$.\n$$\n\\Phi_{\\phi,n}(\\boldsymbol{k}) = \\mathbb{E}\\left[\\left|-\\frac{i\\boldsymbol{k} \\cdot \\hat{\\boldsymbol{n}}(\\boldsymbol{k})}{k^2}\\right|^2\\right] = \\frac{1}{k^4}\\mathbb{E}\\big[|\\boldsymbol{k} \\cdot \\hat{\\boldsymbol{n}}(\\boldsymbol{k})|^2\\big]\n$$\nLet $\\hat{\\boldsymbol{n}} = (\\hat{n}_u, \\hat{n}_v)$. The term in the expectation is:\n$$\n|\\boldsymbol{k} \\cdot \\hat{\\boldsymbol{n}}|^2 = (k_x \\hat{n}_u + k_y \\hat{n}_v)(k_x \\hat{n}_u^* + k_y \\hat{n}_v^*) = k_x^2|\\hat{n}_u|^2 + k_y^2|\\hat{n}_v|^2 + k_x k_y(\\hat{n}_u\\hat{n}_v^* + \\hat{n}_u^*\\hat{n}_v)\n$$\nThe noise components $n_u$ and $n_v$ are given as mutually independent. This implies that their Fourier transforms are uncorrelated, so $\\mathbb{E}[\\hat{n}_u\\hat{n}_v^*]=0$. Taking the expectation, we get:\n$$\n\\mathbb{E}\\big[|\\boldsymbol{k} \\cdot \\hat{\\boldsymbol{n}}|^2\\big] = k_x^2\\mathbb{E}\\big[|\\hat{n}_u|^2\\big] + k_y^2\\mathbb{E}\\big[|\\hat{n}_v|^2\\big]\n$$\nThe problem states that each noise component has a constant PSD of $S_n$. This means $\\mathbb{E}\\big[|\\hat{n}_u(\\boldsymbol{k})|^2\\big] = S_n$ and $\\mathbb{E}\\big[|\\hat{n}_v(\\boldsymbol{k})|^2\\big] = S_n$ for all $\\boldsymbol{k}$.\n$$\n\\mathbb{E}\\big[|\\boldsymbol{k} \\cdot \\hat{\\boldsymbol{n}}|^2\\big] = k_x^2 S_n + k_y^2 S_n = (k_x^2 + k_y^2)S_n = k^2 S_n\n$$\nSubstituting this back into the expression for the noise potential's PSD:\n$$\n\\Phi_{\\phi,n}(\\boldsymbol{k}) = \\frac{k^2 S_n}{k^4} = \\frac{S_n}{k^2}\n$$\nThis is the PSD of the error in $\\phi$ due to the measurement noise. The bias is the integral of this quantity over the annulus in wavenumber space defined by $k_0 \\le k \\le k_1$. We convert to polar coordinates $(k, \\theta)$, where $d^2\\boldsymbol{k} = k \\,dk \\,d\\theta$.\n$$\n\\text{Bias} = \\int_{0}^{2\\pi} \\int_{k_0}^{k_1} \\left(\\frac{S_n}{k^2}\\right) k \\,dk \\,d\\theta\n$$\n$$\n\\text{Bias} = 2\\pi \\int_{k_0}^{k_1} \\frac{S_n}{k} \\,dk = 2\\pi S_n \\big[\\ln(k)\\big]_{k_0}^{k_1}\n$$\n$$\n\\text{Bias} = 2\\pi S_n \\big(\\ln(k_1) - \\ln(k_0)\\big) = 2\\pi S_n \\ln\\left(\\frac{k_1}{k_0}\\right)\n$$\nThis is the final expression for the expected additive bias in the diagnosed variance of $\\phi$.\n\n### Part 2: Bias Mitigation Strategy\n\nThe analysis above reveals that the inversion operator, proportional to $k^{-2}$, amplifies the noise contribution at low wavenumbers (large spatial scales), leading to a \"red\" noise spectrum $\\propto k^{-2}$ for the potential error, even though the original velocity noise was \"white\" (constant spectrum).\n\nA physically and statistically justified strategy to mitigate this bias is to apply an optimal filter in the spectral domain. The Wiener filter is the linear mean-square error optimal filter. It provides an improved estimate of the true field, $\\hat{\\phi}_{\\text{est}}(\\boldsymbol{k})$, from the diagnosed field, $\\hat{\\phi}_{\\text{diagnosed}}(\\boldsymbol{k})$, by weighting it according to the signal-to-noise ratio at each wavenumber.\n\nThe Wiener filter $W(\\boldsymbol{k})$ is defined as:\n$$\nW(\\boldsymbol{k}) = \\frac{\\Phi_{\\text{signal}}(\\boldsymbol{k})}{\\Phi_{\\text{signal}}(\\boldsymbol{k}) + \\Phi_{\\text{noise}}(\\boldsymbol{k})}\n$$\nIn our case, the \"signal\" is the true potential $\\phi_{\\text{true}}$ and the \"noise\" is the error term $\\phi_{\\text{noise}}$. Their respective PSDs are $\\Phi_{\\phi,\\text{true}}(k) = \\mathbb{E}[|\\hat{\\phi}_{\\text{true}}(\\boldsymbol{k})|^2]$ and $\\Phi_{\\phi,\\text{noise}}(k) = S_n/k^2$. The optimal estimator for the true potential in the Fourier domain is thus:\n$$\n\\hat{\\phi}_{\\text{est}}(\\boldsymbol{k}) = W(k) \\hat{\\phi}_{\\text{diagnosed}}(\\boldsymbol{k}) = \\left( \\frac{\\Phi_{\\phi,\\text{true}}(k)}{\\Phi_{\\phi,\\text{true}}(k) + S_n/k^2} \\right) \\hat{\\phi}_{\\text{diagnosed}}(\\boldsymbol{k})\n$$\nThis can be rewritten as:\n$$\n\\hat{\\phi}_{\\text{est}}(\\boldsymbol{k}) = \\left( \\frac{k^2 \\Phi_{\\phi,\\text{true}}(k)}{k^2 \\Phi_{\\phi,\\text{true}}(k) + S_n} \\right) \\hat{\\phi}_{\\text{diagnosed}}(\\boldsymbol{k})\n$$\nThis filter correctly passes information at wavenumbers where the signal is strong relative to the noise and attenuates information where the noise dominates. Implementation requires an estimate of the true potential's power spectrum, $\\Phi_{\\phi,\\text{true}}(k)$, which can often be obtained from theoretical models or estimated from the diagnosed spectrum itself under certain assumptions. This deconvolution strategy provides a regularized and statistically optimal estimate of the velocity potential, mitigating the bias introduced by the measurement noise.",
            "answer": "$$\n\\boxed{2\\pi S_{n} \\ln\\left(\\frac{k_{1}}{k_{0}}\\right)}\n$$"
        }
    ]
}