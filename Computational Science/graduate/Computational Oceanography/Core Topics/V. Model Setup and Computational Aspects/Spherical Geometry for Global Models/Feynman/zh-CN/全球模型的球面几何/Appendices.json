{
    "hands_on_practices": [
        {
            "introduction": "经纬度网格是全球模型最常用的基础。本练习通过分析坐标基向量来探讨其基本几何性质。通过计算它们的正交性和范数 ，我们将揭示“极点问题”背后的数学原理，这是球面上数值模拟的一个关键挑战。",
            "id": "3810984",
            "problem": "考虑嵌入在三维欧几里得空间中的二维单位球面，记为 $S^2 \\subset \\mathbb{R}^3$，但具有一个适用于球形地球近似的一般常数半径 $a>0$。使用标准的地理参数化，以经度 $\\lambda \\in (-\\pi,\\pi]$ 和纬度 $\\phi \\in \\left[-\\frac{\\pi}{2},\\frac{\\pi}{2}\\right]$（两者均以弧度为单位）表示，由光滑映射 $\\mathbf{x} : (-\\pi,\\pi] \\times \\left[-\\frac{\\pi}{2},\\frac{\\pi}{2}\\right] \\to \\mathbb{R}^3$ 定义如下：\n$$\n\\mathbf{x}(\\lambda,\\phi) \\;=\\; \\big(a \\cos\\phi \\cos\\lambda,\\; a \\cos\\phi \\sin\\lambda,\\; a \\sin\\phi\\big).\n$$\n在计算海洋学和全球大气环流模型（GCM）网格中，常数 $\\lambda$（经线）和常数 $\\phi$（纬线）的坐标线被用来定义网格单元。仅从上述参数化、$\\mathbb{R}^3$ 中的欧几里得内积以及参数化曲面上坐标基向量 $\\partial_{\\lambda}\\mathbf{x}$ 和 $\\partial_{\\phi}\\mathbf{x}$ 的定义出发，完成以下任务：\n\n1. 证明坐标基向量 $\\partial_{\\lambda}\\mathbf{x}$ 和 $\\partial_{\\phi}\\mathbf{x}$ 在 $S^2$ 的每一点上都是正交的。\n2. 计算范数 $|\\partial_{\\lambda}\\mathbf{x}|$ 和 $|\\partial_{\\phi}\\mathbf{x}|$，作为 $a$ 和 $\\phi$ 的函数。\n3. 利用第一基本形式（从 $\\mathbb{R}^3$ 诱导的度量）的基本概念以及参数化曲面上无穷小长度和面积的定义，推导微分面积元 $\\mathrm{d}A$（用 $\\lambda$ 和 $\\phi$ 表示），然后求出当 $\\mathrm{d}\\lambda=\\mathrm{d}\\phi$ 时，与坐标线对齐的无穷小网格单元的纵横比 $R(\\phi)$，其定义为\n$$\nR(\\phi) \\;=\\; \\frac{|\\partial_{\\lambda}\\mathbf{x}|}{|\\partial_{\\phi}\\mathbf{x}|}.\n$$\n简要解释在全球海洋模型所使用的等角经纬度网格中，这些结果对不同纬度下网格单元的形状和面积产生的影响。\n\n作为最终答案，提供三元组 $\\big(|\\partial_{\\lambda}\\mathbf{x}|,\\; |\\partial_{\\phi}\\mathbf{x}|,\\; R(\\phi)\\big)$ 的闭式解析表达式。无需进行数值计算。",
            "solution": "该问题陈述通过了所有验证标准。它是科学上合理的、适定的、客观的，并包含了得出唯一且有意义解所需的所有必要信息。该问题是曲面微分几何中的一个标准练习，直接适用于计算海洋学和全球气候模拟领域。\n\n我们首先解决问题中列出的任务。该曲面是一个半径为 $a > 0$ 的球面，由经度 $\\lambda$ 和纬度 $\\phi$ 参数化如下：\n$$\n\\mathbf{x}(\\lambda,\\phi) \\;=\\; \\big(a \\cos\\phi \\cos\\lambda,\\; a \\cos\\phi \\sin\\lambda,\\; a \\sin\\phi\\big)\n$$\n\n坐标基向量是位置向量 $\\mathbf{x}$ 关于参数 $\\lambda$ 和 $\\phi$ 的偏导数。\n\n首先，我们计算与经度坐标相关的基向量 $\\partial_{\\lambda}\\mathbf{x}$：\n$$\n\\partial_{\\lambda}\\mathbf{x} = \\frac{\\partial \\mathbf{x}}{\\partial \\lambda} = \\frac{\\partial}{\\partial \\lambda} \\big(a \\cos\\phi \\cos\\lambda,\\; a \\cos\\phi \\sin\\lambda,\\; a \\sin\\phi\\big) = \\big(-a \\cos\\phi \\sin\\lambda,\\; a \\cos\\phi \\cos\\lambda,\\; 0\\big)\n$$\n\n接着，我们计算与纬度坐标相关的基向量 $\\partial_{\\phi}\\mathbf{x}$：\n$$\n\\partial_{\\phi}\\mathbf{x} = \\frac{\\partial \\mathbf{x}}{\\partial \\phi} = \\frac{\\partial}{\\partial \\phi} \\big(a \\cos\\phi \\cos\\lambda,\\; a \\cos\\phi \\sin\\lambda,\\; a \\sin\\phi\\big) = \\big(-a \\sin\\phi \\cos\\lambda,\\; -a \\sin\\phi \\sin\\lambda,\\; a \\cos\\phi\\big)\n$$\n\n**1. 证明坐标基向量是正交的。**\n\n为证明 $\\partial_{\\lambda}\\mathbf{x}$ 和 $\\partial_{\\phi}\\mathbf{x}$ 是正交的，我们计算它们在 $\\mathbb{R}^3$ 中的欧几里得内积（点积），并证明它对所有的 $(\\lambda, \\phi)$ 都为零。\n$$\n\\partial_{\\lambda}\\mathbf{x} \\cdot \\partial_{\\phi}\\mathbf{x} = \\big(-a \\cos\\phi \\sin\\lambda\\big)\\big(-a \\sin\\phi \\cos\\lambda\\big) + \\big(a \\cos\\phi \\cos\\lambda\\big)\\big(-a \\sin\\phi \\sin\\lambda\\big) + \\big(0\\big)\\big(a \\cos\\phi\\big)\n$$\n$$\n= a^2 \\cos\\phi \\sin\\phi \\sin\\lambda \\cos\\lambda - a^2 \\cos\\phi \\sin\\phi \\cos\\lambda \\sin\\lambda + 0\n$$\n$$\n= 0\n$$\n由于内积为零，向量 $\\partial_{\\lambda}\\mathbf{x}$ 和 $\\partial_{\\phi}\\mathbf{x}$ 在参数化有定义的球面上的每一点都是正交的。这意味着经线（常数 $\\lambda$ 的线）和纬线（常数 $\\phi$ 的线）相互垂直。\n\n**2. 计算范数 $|\\partial_{\\lambda}\\mathbf{x}|$ 和 $|\\partial_{\\phi}\\mathbf{x}|$。**\n\n向量的范数是其与自身内积的平方根。\n对于 $\\partial_{\\lambda}\\mathbf{x}$：\n$$\n|\\partial_{\\lambda}\\mathbf{x}|^2 = \\partial_{\\lambda}\\mathbf{x} \\cdot \\partial_{\\lambda}\\mathbf{x} = (-a \\cos\\phi \\sin\\lambda)^2 + (a \\cos\\phi \\cos\\lambda)^2 + 0^2\n$$\n$$\n= a^2 \\cos^2\\phi \\sin^2\\lambda + a^2 \\cos^2\\phi \\cos^2\\lambda\n$$\n$$\n= a^2 \\cos^2\\phi (\\sin^2\\lambda + \\cos^2\\lambda) = a^2 \\cos^2\\phi\n$$\n取平方根，我们得到范数：\n$$\n|\\partial_{\\lambda}\\mathbf{x}| = \\sqrt{a^2 \\cos^2\\phi} = |a \\cos\\phi|\n$$\n因为 $a > 0$ 且纬度 $\\phi$ 在范围 $\\left[-\\frac{\\pi}{2}, \\frac{\\pi}{2}\\right]$ 内，所以 $\\cos\\phi \\ge 0$。因此， $|a \\cos\\phi| = a \\cos\\phi$。\n$$\n|\\partial_{\\lambda}\\mathbf{x}| = a \\cos\\phi\n$$\n对于 $\\partial_{\\phi}\\mathbf{x}$：\n$$\n|\\partial_{\\phi}\\mathbf{x}|^2 = \\partial_{\\phi}\\mathbf{x} \\cdot \\partial_{\\phi}\\mathbf{x} = (-a \\sin\\phi \\cos\\lambda)^2 + (-a \\sin\\phi \\sin\\lambda)^2 + (a \\cos\\phi)^2\n$$\n$$\n= a^2 \\sin^2\\phi \\cos^2\\lambda + a^2 \\sin^2\\phi \\sin^2\\lambda + a^2 \\cos^2\\phi\n$$\n$$\n= a^2 \\sin^2\\phi (\\cos^2\\lambda + \\sin^2\\lambda) + a^2 \\cos^2\\phi\n$$\n$$\n= a^2 \\sin^2\\phi + a^2 \\cos^2\\phi = a^2 (\\sin^2\\phi + \\cos^2\\phi) = a^2\n$$\n取平方根，我们得到范数：\n$$\n|\\partial_{\\phi}\\mathbf{x}| = \\sqrt{a^2} = a\n$$\n\n**3. 推导微分面积元 $\\mathrm{d}A$ 和纵横比 $R(\\phi)$。**\n\n参数化曲面上的微分面积元 $\\mathrm{d}A$ 由第一基本形式给出。第一基本形式的系数是 $g_{\\lambda\\lambda} = |\\partial_{\\lambda}\\mathbf{x}|^2$、$g_{\\phi\\phi} = |\\partial_{\\phi}\\mathbf{x}|^2$ 和 $g_{\\lambda\\phi} = \\partial_{\\lambda}\\mathbf{x} \\cdot \\partial_{\\phi}\\mathbf{x}$。根据我们之前的计算，我们有：\n$$\ng_{\\lambda\\lambda} = a^2 \\cos^2\\phi, \\quad g_{\\phi\\phi} = a^2, \\quad g_{\\lambda\\phi} = g_{\\phi\\lambda} = 0\n$$\n面积元是 $\\mathrm{d}A = \\sqrt{\\det(g)} \\, \\mathrm{d}\\lambda \\, \\mathrm{d}\\phi$，其中 $g$ 是系数矩阵。\n$$\n\\det(g) = g_{\\lambda\\lambda}g_{\\phi\\phi} - g_{\\lambda\\phi}^2 = (a^2 \\cos^2\\phi)(a^2) - 0^2 = a^4 \\cos^2\\phi\n$$\n$$\n\\sqrt{\\det(g)} = \\sqrt{a^4 \\cos^2\\phi} = a^2 |\\cos\\phi| = a^2 \\cos\\phi \\quad (\\text{因为 } \\cos\\phi \\ge 0)\n$$\n因此，微分面积元是：\n$$\n\\mathrm{d}A = a^2 \\cos\\phi \\, \\mathrm{d}\\lambda \\, \\mathrm{d}\\phi\n$$\n当 $\\mathrm{d}\\lambda = \\mathrm{d}\\phi$ 时，无穷小网格单元的纵横比 $R(\\phi)$ 定义为 $\\lambda$ 方向上边的物理长度与 $\\phi$ 方向上边的物理长度之比。这些长度是 $\\mathrm{d}s_\\lambda = |\\partial_{\\lambda}\\mathbf{x}|\\mathrm{d}\\lambda$ 和 $\\mathrm{d}s_\\phi = |\\partial_{\\phi}\\mathbf{x}|\\mathrm{d}\\phi$。\n问题将纵横比定义为：\n$$\nR(\\phi) = \\frac{|\\partial_{\\lambda}\\mathbf{x}|}{|\\partial_{\\phi}\\mathbf{x}|} = \\frac{a \\cos\\phi}{a} = \\cos\\phi\n$$\n\n**对等角经纬度网格的影响：**\n\n在等角网格中，增量 $\\Delta\\lambda$ 和 $\\Delta\\phi$ 是恒定的。\n网格单元在南北（经向）方向上的物理长度约为 $\\Delta s_\\phi = |\\partial_{\\phi}\\mathbf{x}| \\Delta\\phi = a \\Delta\\phi$。这个长度是恒定的，不随纬度变化。\n网格单元在东西（纬向）方向上的物理长度约为 $\\Delta s_\\lambda = |\\partial_{\\lambda}\\mathbf{x}| \\Delta\\lambda = a \\cos\\phi \\Delta\\lambda$。这个长度随纬度的余弦值变化。\n单元的纵横比 $R(\\phi) = \\cos\\phi$ 量化了它们的形状。在赤道（$\\phi=0$），$R(0)=1$，网格单元近似为正方形（对于 $\\Delta\\lambda \\approx \\Delta\\phi$）。当向两极移动时（$\\phi \\to \\pm \\frac{\\pi}{2}$），$R(\\phi) \\to 0$，单元在东西方向上变得越来越窄，在极点处汇聚成一点。\n网格单元的面积 $\\Delta A \\approx a^2 \\cos\\phi \\Delta\\lambda \\Delta\\phi$ 也依赖于纬度。它在赤道处最大，在两极处缩小为零。这个“极点问题”对数值模型有严重影响。由于靠近极点的纬向网格间距趋近于零，经线的汇聚要求显式数值格式的时间步长被急剧减小以满足稳定性标准（如CFL条件），这使得模型在计算上变得不可行。这使得现代GCM必须使用特殊的滤波器或替代的网格系统（例如，立方球面网格或二十面体网格）。\n\n因此，推导出的三元组 $(|\\partial_{\\lambda}\\mathbf{x}|, |\\partial_{\\phi}\\mathbf{x}|, R(\\phi))$ 是 $(a \\cos\\phi, a, \\cos\\phi)$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} a \\cos\\phi  a  \\cos\\phi \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在平面地图上，两点之间的最短距离是直线，但在球面上并非如此。本练习旨在量化真实最短路径——大圆航线——与在常用地图投影上看似笔直的恒定纬度线路径之间的偏差 。在全球海洋中，要准确模拟物质输运和轨迹，理解这种差异至关重要。",
            "id": "3810929",
            "problem": "考虑一个半径为 $R=6371\\,\\text{km}$ 的球形地球。在一个使用 plate carrée（等距圆柱）地图投影的全球海洋模型中，投影由 $x=R\\lambda$ 和 $y=R\\phi$ 定义，其中 $\\lambda$（经度）和 $\\phi$（纬度）是弧度表示的角坐标。一条中纬度样带连接了位于同一纬度 $\\phi_0=45^\\circ$ 但经度分别为 $\\lambda_A=-30^\\circ$ 和 $\\lambda_B=+30^\\circ$ 的两个点 $A$ 和 $B$。在投影地图上，一种常见的简化表示方法是在投影的端点之间画一条直线段，这里即为水平线段 $y=R\\phi_0$，其中 $\\lambda\\in[-30^\\circ,30^\\circ]$。\n\n从球面几何的第一性原理出发，仅利用大圆是球面与穿过地心的平面的交线这一事实，推导出通过 $A$ 和 $B$ 的大圆方程，形式为 $\\phi(\\lambda)$。然后，在 plate carrée 投影中，将经度 $\\lambda$ 处的垂直地图偏差定义为 $\\delta y(\\lambda)=|y_{\\text{gc}}(\\lambda)-y_{\\text{lin}}(\\lambda)|$，其中 $y_{\\text{gc}}(\\lambda)=R\\phi(\\lambda)$ 且 $y_{\\text{lin}}(\\lambda)=R\\phi_0$。通过将最大 $\\delta y$ 转换为沿子午线的测地距离，利用此定义来量化在 $\\lambda\\in[-30^\\circ,30^\\circ]$ 范围内，球面上大圆与地图上直线表示之间的最大物理间隔。\n\n计算中所有角度均以弧度为单位，最终数值答案以 $\\text{km}$ 表示。将您的答案四舍五入到四位有效数字。",
            "solution": "所述问题在科学上基于球面几何和地图投影，问题陈述清晰，信息充分且一致，并使用了客观、精确的语言。推导所需的所有参数均已提供。因此，该问题被认为是有效的，并将提供解答。\n\n任务是找出连接点 $A$ 和 $B$ 的大圆路径与连接它们的纬线之间的最大物理间隔。点 $A$ 的经度为 $\\lambda_A = -30^\\circ$，纬度为 $\\phi_0 = 45^\\circ$；点 $B$ 的经度为 $\\lambda_B = +30^\\circ$，纬度同样为 $\\phi_0 = 45^\\circ$。地球被建模为半径 $R=6371\\,\\text{km}$ 的球体。\n\n首先，我们将给定的角度坐标从度转换为弧度以便计算。\n$\\phi_0 = 45^\\circ = \\frac{\\pi}{4}$ 弧度。\n$\\lambda_A = -30^\\circ = -\\frac{\\pi}{6}$ 弧度。\n$\\lambda_B = +30^\\circ = \\frac{\\pi}{6}$ 弧度。\n\n我们建立一个地心笛卡尔坐标系 $(x,y,z)$，其原点位于地心。$z$ 轴穿过北极，$x$ 轴穿过赤道 ($\\phi=0$) 和本初子午线 ($\\lambda=0$) 的交点，$y$ 轴与两者正交，穿过点 $(\\phi=0, \\lambda=\\pi/2)$。从球面坐标 $(\\lambda, \\phi)$ 到笛卡尔坐标的转换方程为：\n$x = R \\cos\\phi \\cos\\lambda$\n$y = R \\cos\\phi \\sin\\lambda$\n$z = R \\sin\\phi$\n\n接下来，我们求点 $A$ 和 $B$ 的笛卡尔坐标。\n对于点 $A(\\lambda_A, \\phi_0)$:\n$x_A = R \\cos(\\frac{\\pi}{4}) \\cos(-\\frac{\\pi}{6}) = R \\left(\\frac{\\sqrt{2}}{2}\\right) \\left(\\frac{\\sqrt{3}}{2}\\right) = \\frac{R\\sqrt{6}}{4}$\n$y_A = R \\cos(\\frac{\\pi}{4}) \\sin(-\\frac{\\pi}{6}) = R \\left(\\frac{\\sqrt{2}}{2}\\right) \\left(-\\frac{1}{2}\\right) = -\\frac{R\\sqrt{2}}{4}$\n$z_A = R \\sin(\\frac{\\pi}{4}) = \\frac{R\\sqrt{2}}{2}$\n\n对于点 $B(\\lambda_B, \\phi_0)$:\n$x_B = R \\cos(\\frac{\\pi}{4}) \\cos(\\frac{\\pi}{6}) = R \\left(\\frac{\\sqrt{2}}{2}\\right) \\left(\\frac{\\sqrt{3}}{2}\\right) = \\frac{R\\sqrt{6}}{4}$\n$y_B = R \\cos(\\frac{\\pi}{4}) \\sin(\\frac{\\pi}{6}) = R \\left(\\frac{\\sqrt{2}}{2}\\right) \\left(\\frac{1}{2}\\right) = \\frac{R\\sqrt{2}}{4}$\n$z_B = R \\sin(\\frac{\\pi}{4}) = \\frac{R\\sqrt{2}}{2}$\n\n大圆是球面与一个穿过其中心的平面的交线。这个平面由原点以及点 $A$ 和 $B$ 唯一确定。该平面的法向量 $\\mathbf{n}$ 可以通过位置向量 $\\mathbf{r}_A = (x_A, y_A, z_A)$ 和 $\\mathbf{r}_B = (x_B, y_B, z_B)$ 的叉积求得。\n$\\mathbf{n} = \\mathbf{r}_A \\times \\mathbf{r}_B = \\begin{vmatrix} \\mathbf{i}  \\mathbf{j}  \\mathbf{k} \\\\ x_A  y_A  z_A \\\\ x_B  y_B  z_B \\end{vmatrix}$\n$\\mathbf{n}$ 的分量为：\n$n_x = y_A z_B - z_A y_B = \\left(-\\frac{R\\sqrt{2}}{4}\\right)\\left(\\frac{R\\sqrt{2}}{2}\\right) - \\left(\\frac{R\\sqrt{2}}{2}\\right)\\left(\\frac{R\\sqrt{2}}{4}\\right) = -\\frac{R^2}{4} - \\frac{R^2}{4} = -\\frac{R^2}{2}$\n$n_y = z_A x_B - x_A z_B = \\left(\\frac{R\\sqrt{2}}{2}\\right)\\left(\\frac{R\\sqrt{6}}{4}\\right) - \\left(\\frac{R\\sqrt{6}}{4}\\right)\\left(\\frac{R\\sqrt{2}}{2}\\right) = 0$\n$n_z = x_A y_B - y_A x_B = \\left(\\frac{R\\sqrt{6}}{4}\\right)\\left(\\frac{R\\sqrt{2}}{4}\\right) - \\left(-\\frac{R\\sqrt{2}}{4}\\right)\\left(\\frac{R\\sqrt{6}}{4}\\right) = \\frac{R^2\\sqrt{12}}{16} + \\frac{R^2\\sqrt{12}}{16} = \\frac{2R^2(2\\sqrt{3})}{16} = \\frac{R^2\\sqrt{3}}{4}$\n\n法向量为 $\\mathbf{n} = (-\\frac{R^2}{2}, 0, \\frac{R^2\\sqrt{3}}{4})$。我们可以通过除以 $-\\frac{R^2}{4}$ 来使用一个更简单的平行向量，得到 $\\mathbf{n}' = (2, 0, -\\sqrt{3})$。\n大圆所在平面的方程为 $\\mathbf{n}' \\cdot \\mathbf{r} = 0$，其中 $\\mathbf{r}=(x,y,z)$ 是平面上的任意一点。\n$2x - \\sqrt{3}z = 0$\n\n为了得到 $\\phi(\\lambda)$ 形式的大圆路径方程，我们将用 $\\phi$ 和 $\\lambda$ 表示的笛卡尔表达式代入平面方程：\n$2(R\\cos\\phi \\cos\\lambda) - \\sqrt{3}(R\\sin\\phi) = 0$\n$2\\cos\\phi \\cos\\lambda = \\sqrt{3}\\sin\\phi$\n两边同除以 $\\cos\\phi$（假设 $\\cos\\phi \\neq 0$，这是成立的，因为路径不会到达两极），我们得到：\n$\\tan\\phi = \\frac{2}{\\sqrt{3}}\\cos\\lambda$\n因此，大圆路径的纬度作为经度的函数是：\n$\\phi(\\lambda) = \\arctan\\left(\\frac{2}{\\sqrt{3}}\\cos\\lambda\\right)$\n\n问题将 plate carrée 投影中的垂直地图偏差定义为 $\\delta y(\\lambda) = |y_{\\text{gc}}(\\lambda) - y_{\\text{lin}}(\\lambda)|$。\n地图上大圆的路径为 $y_{\\text{gc}}(\\lambda) = R\\phi(\\lambda) = R \\arctan\\left(\\frac{2}{\\sqrt{3}}\\cos\\lambda\\right)$。\n地图上的直线表示是恒定纬度线 $y_{\\text{lin}}(\\lambda) = R\\phi_0 = R\\frac{\\pi}{4}$。\n偏差为 $\\delta y(\\lambda) = \\left|R \\arctan\\left(\\frac{2}{\\sqrt{3}}\\cos\\lambda\\right) - R\\frac{\\pi}{4}\\right|$。\n\n我们需要求出在 $\\lambda \\in [-\\frac{\\pi}{6}, \\frac{\\pi}{6}]$ 区间内该偏差的最大值。大圆路径的纬度 $\\phi(\\lambda)$ 是 $\\lambda$ 的偶函数，其值由 $\\cos\\lambda$ 决定。在区间 $[-\\frac{\\pi}{6}, \\frac{\\pi}{6}]$ 内，$\\cos\\lambda$ 在 $\\lambda=0$ 处取得最大值，此时 $\\cos(0)=1$。由于 $\\arctan(u)$ 是一个单调递增函数，因此 $\\phi(\\lambda)$ 也在 $\\lambda=0$ 处取得最大值。\n在端点 $\\lambda = \\pm\\frac{\\pi}{6}$ 处，$\\cos(\\pm\\frac{\\pi}{6}) = \\frac{\\sqrt{3}}{2}$，所以 $\\phi(\\pm\\frac{\\pi}{6}) = \\arctan(\\frac{2}{\\sqrt{3}}\\frac{\\sqrt{3}}{2}) = \\arctan(1) = \\frac{\\pi}{4} = \\phi_0$。\n对于任何 $\\lambda \\in (-\\frac{\\pi}{6}, \\frac{\\pi}{6})$，$\\cos\\lambda  \\frac{\\sqrt{3}}{2}$，这意味着 $\\phi(\\lambda)  \\frac{\\pi}{4}$。因此，大圆路径在地图上总是位于恒定纬度路径的“上方”，所以我们可以去掉绝对值符号。\n$\\delta y(\\lambda) = R \\left[ \\arctan\\left(\\frac{2}{\\sqrt{3}}\\cos\\lambda\\right) - \\frac{\\pi}{4} \\right]$。\n\n最大偏差 $\\delta y_{\\max}$ 出现在 $\\lambda=0$ 处：\n$\\delta y_{\\max} = \\delta y(0) = R \\left[ \\arctan\\left(\\frac{2}{\\sqrt{3}}\\cos(0)\\right) - \\frac{\\pi}{4} \\right] = R \\left[ \\arctan\\left(\\frac{2}{\\sqrt{3}}\\right) - \\frac{\\pi}{4} \\right]$。\n\n问题要求的是球体上的最大物理间隔，即对应于最大纬度差的沿子午线的测地距离。沿子午线对应于纬度差 $\\Delta\\phi = \\phi_2 - \\phi_1$ 的物理距离 $d$ 由弧长公式 $d = R \\Delta\\phi$ 给出。\n最大间隔 $d_{\\max}$ 发生在 $\\lambda=0$ 处，对应于纬度差 $\\Delta\\phi_{\\max} = \\phi(0) - \\phi_0$。\n$d_{\\max} = R(\\phi(0) - \\phi_0) = R \\left[ \\arctan\\left(\\frac{2}{\\sqrt{3}}\\right) - \\frac{\\pi}{4} \\right]$。\n这与 $\\delta y_{\\max}$ 是相同的。\n\n我们现在使用 $R = 6371\\,\\text{km}$ 计算数值。所有角度必须以弧度为单位。\n$\\arctan\\left(\\frac{2}{\\sqrt{3}}\\right) \\approx \\arctan(1.1547005) \\approx 0.85707195$ 弧度。\n$\\frac{\\pi}{4} \\approx 0.78539816$ 弧度。\n纬度差为 $\\Delta\\phi_{\\max} \\approx 0.85707195 - 0.78539816 = 0.07167379$ 弧度。\n最大间隔为：\n$d_{\\max} = 6371\\,\\text{km} \\times 0.07167379 \\approx 456.635\\,\\text{km}$。\n\n四舍五入到四位有效数字，最大物理间隔为 $456.6\\,\\text{km}$。",
            "answer": "$$\n\\boxed{456.6}\n$$"
        },
        {
            "introduction": "除了在物理网格上表示场之外，另一种方法是使用全局函数的光谱基。本练习介绍了球谐函数这一强大的方法，它们是球体的自然基函数 。您将实现一个数值谱变换，将一个场分解为其组成模态并进行重构，从而可以直接研究截断误差的概念。",
            "id": "3810986",
            "problem": "给定一个球上的实标量场，记为 $f(\\lambda,\\phi)$，其中 $\\lambda \\in [0,2\\pi)$ 是经度，$\\phi \\in [-\\pi/2,\\pi/2]$ 是纬度。令 $\\theta \\in [0,\\pi]$ 表示余纬，使得 $\\theta = \\frac{\\pi}{2} - \\phi$。考虑物理学惯例下的复球谐函数 $Y_{\\ell}^{m}(\\lambda,\\theta)$，它们在球面面积测度下是标准正交的。球谐函数满足标准正交关系\n$$\n\\int_{0}^{2\\pi}\\int_{0}^{\\pi} Y_{\\ell}^{m}(\\lambda,\\theta)\\,(Y_{\\ell'}^{m'}(\\lambda,\\theta))^{*}\\,\\sin\\theta\\,d\\theta\\,d\\lambda \\;=\\; \\delta_{\\ell\\ell'}\\,\\delta_{mm'} ,\n$$\n其中 $^{*}$ 表示复共轭，$\\delta$ 表示克罗内克δ函数。面积测度可以等效地写为 $d\\Omega = d\\lambda\\,d\\mu$，其中 $\\mu = \\cos\\theta \\in [-1,1]$，这利用了恒等式 $d\\mu = -\\sin\\theta\\,d\\theta$。\n\n从球谐函数的完备性出发，任何足够光滑的场 $f(\\lambda,\\phi)$ 都可以展开为\n$$\nf(\\lambda,\\phi) = \\sum_{\\ell=0}^{\\infty}\\sum_{m=-\\ell}^{\\ell} a_{\\ell m}\\,Y_{\\ell}^{m}(\\lambda,\\theta),\n$$\n其复系数由内积给出\n$$\na_{\\ell m} \\;=\\; \\int_{0}^{2\\pi}\\int_{0}^{\\pi} f(\\lambda,\\phi)\\,(Y_{\\ell}^{m}(\\lambda,\\theta))^{*}\\,\\sin\\theta\\,d\\theta\\,d\\lambda \\;=\\; \\int_{0}^{2\\pi}\\int_{-1}^{1} f(\\lambda,\\phi(\\mu))\\,(Y_{\\ell}^{m}(\\lambda,\\theta(\\mu)))^{*}\\,d\\mu\\,d\\lambda .\n$$\n\n你的任务是设计一个程序，该程序：\n- 使用数值积分来近似内积，从而计算在 $0 \\le \\ell \\le L_{\\max}$ 和 $-\\ell \\le m \\le \\ell$ 范围内的截断球谐系数 $a_{\\ell m}$，\n- 重构截断场\n$$\nf_{L_{\\max}}(\\lambda,\\phi) \\;=\\; \\sum_{\\ell=0}^{L_{\\max}}\\sum_{m=-\\ell}^{\\ell} a_{\\ell m}\\,Y_{\\ell}^{m}(\\lambda,\\theta),\n$$\n- 使用相对 $L_2$ 范数评估截断误差\n$$\n\\varepsilon(L_{\\max}) \\;=\\; \\frac{\\left\\| f - f_{L_{\\max}} \\right\\|_{L_2}}{\\left\\| f \\right\\|_{L_2}}, \\quad \\text{其中 } \\left\\| g \\right\\|_{L_2}^{2} = \\int_{0}^{2\\pi}\\int_{-1}^{1} |g(\\lambda,\\phi(\\mu))|^{2}\\,d\\mu\\,d\\lambda .\n$$\n\n使用具有 $N_{\\theta}$ 个点的高斯-勒让德积分来近似在 $\\mu \\in [-1,1]$ 上的积分，并使用具有 $N_{\\lambda}$ 个点的梯形（均匀）法则来近似在 $\\lambda \\in [0,2\\pi)$ 上的积分。角度必须以弧度为单位。采用球谐函数的物理学惯例，并确保与所述的标准正交性保持一致。\n\n实现以下测试套件（所有角度单位为弧度，输出为无量纲浮点数）：\n- 测试用例1：$f(\\lambda,\\phi) = \\operatorname{Re}\\{Y_{8}^{3}(\\lambda,\\theta)\\}$，其中 $L_{\\max} = 8$，使用 $N_{\\lambda} = 256$ 和 $N_{\\theta} = 128$。\n- 测试用例2：$f(\\lambda,\\phi) = \\exp\\!\\left(0.25\\,\\sin\\phi\\right)\\,\\cos(7\\lambda)$，其中 $L_{\\max} = 12$，使用 $N_{\\lambda} = 256$ 和 $N_{\\theta} = 128$。\n- 测试用例3：$f(\\lambda,\\phi) = 1 + 0.1\\,\\sin(2\\phi)\\,\\cos(3\\lambda)$，其中 $L_{\\max} = 3$，使用 $N_{\\lambda} = 256$ 和 $N_{\\theta} = 128$。\n- 测试用例4：$f(\\lambda,\\phi) = 1 + 0.1\\,\\sin(2\\phi)\\,\\cos(3\\lambda)$，其中 $L_{\\max} = 0$，使用 $N_{\\lambda} = 256$ 和 $N_{\\theta} = 128$。\n\n你的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[r_{1},r_{2},r_{3},r_{4}]$），其中 $r_{k}$ 是测试用例 $k$ 的相对 $L_2$ 截断误差 $\\varepsilon(L_{\\max})$。所有计算都必须使用弧度。不涉及物理单位；将每个 $r_{k}$ 报告为浮点数。",
            "solution": "该问题经评估有效。它在科学上基于成熟的球谐函数理论，这是数学物理和地球科学中的一个基本工具。该问题是适定的，提供了一套完整且一致的定义、参数和目标。所有术语在数学上都是精确的，而任务——实现数值球谐变换并评估其截断误差——是计算科学中一个标准且有意义的问题。所提供的测试用例适合验证实现的正确性。\n\n解决方案分三步展开：首先，概述球谐变换的理论框架；其次，详细说明连续理论的数值离散化；第三，指定计算算法。\n\n球面上的一个标量场 $f(\\lambda, \\phi)$ 可以表示为复球谐函数 $Y_{\\ell}^{m}(\\lambda, \\theta)$ 的无穷级数，其中 $\\lambda \\in [0, 2\\pi)$ 是经度，$\\phi \\in [-\\pi/2, \\pi/2]$ 是纬度，$\\theta = \\pi/2 - \\phi \\in [0, \\pi]$ 是余纬。该展开式由下式给出：\n$$\nf(\\lambda,\\phi) = \\sum_{\\ell=0}^{\\infty}\\sum_{m=-\\ell}^{\\ell} a_{\\ell m}\\,Y_{\\ell}^{m}(\\lambda,\\theta)\n$$\n函数 $Y_{\\ell}^{m}(\\lambda, \\theta)$ 在球面上关于面积测度 $d\\Omega = \\sin\\theta\\,d\\theta\\,d\\lambda$ 构成一个标准正交基。其标准正交性属性为：\n$$\n\\int_{0}^{2\\pi}\\int_{0}^{\\pi} Y_{\\ell}^{m}(\\lambda,\\theta)\\,(Y_{\\ell'}^{m'}(\\lambda,\\theta))^{*}\\,\\sin\\theta\\,d\\theta\\,d\\lambda \\;=\\; \\delta_{\\ell\\ell'}\\,\\delta_{mm'}\n$$\n其中 $^{*}$ 表示复共轭，$\\delta$ 是克罗内克δ函数。该属性允许通过内积（投影）确定复系数 $a_{\\ell m}$：\n$$\na_{\\ell m} \\;=\\; \\langle f, Y_{\\ell}^{m} \\rangle \\;=\\; \\int_{0}^{2\\pi}\\int_{0}^{\\pi} f(\\lambda,\\phi)\\,(Y_{\\ell}^{m}(\\lambda,\\theta))^{*}\\,\\sin\\theta\\,d\\theta\\,d\\lambda\n$$\n对于实际计算，无穷级数必须在最大阶数 $L_{\\max}$ 处截断，得到一个近似 $f_{L_{\\max}}$：\n$$\nf_{L_{\\max}}(\\lambda,\\phi) \\;=\\; \\sum_{\\ell=0}^{L_{\\max}}\\sum_{m=-\\ell}^{\\ell} a_{\\ell m}\\,Y_{\\ell}^{m}(\\lambda,\\theta)\n$$\n此截断的误差由相对 $L_2$ 范数 $\\varepsilon(L_{\\max})$ 量化，定义为残差的范数与原始场的范数之比：\n$$\n\\varepsilon(L_{\\max}) \\;=\\; \\frac{\\left\\| f - f_{L_{\\max}} \\right\\|_{L_2}}{\\left\\| f \\right\\|_{L_2}}\n$$\n一个函数 $g$ 的 $L_2$ 范数的平方由其幅值平方在球面上的积分给出：\n$$\n\\left\\| g \\right\\|_{L_2}^{2} = \\int_{S^2} |g|^2 \\,d\\Omega = \\int_{0}^{2\\pi}\\int_{0}^{\\pi} |g(\\lambda,\\theta)|^{2}\\,\\sin\\theta\\,d\\theta\\,d\\lambda\n$$\n使用 $\\mu = \\cos\\theta \\in [-1, 1]$ 和 $d\\mu = -\\sin\\theta\\,d\\theta$ 可以将其写为：\n$$\n\\left\\| g \\right\\|_{L_2}^{2} = \\int_{0}^{2\\pi}\\int_{-1}^{1} |g(\\lambda,\\theta(\\mu))|^{2}\\,d\\mu\\,d\\lambda\n$$\n为了计算系数和范数，我们必须对这些积分进行数值近似。问题指定了乘积求积法则。对经度 $\\lambda \\in [0, 2\\pi)$ 的积分使用梯形法则在 $N_{\\lambda}$ 个点的均匀网格上近似，$\\lambda_j = j \\frac{2\\pi}{N_\\lambda}$，$j=0, \\dots, N_\\lambda-1$。对于周期函数，这等效于权重为 $w_j^{\\lambda} = \\frac{2\\pi}{N_{\\lambda}}$ 的矩形法则。对 $\\mu \\in [-1, 1]$ 的积分使用具有 $N_{\\theta}$ 个点 $\\mu_k$ 和相应权重 $w_k^{\\mu}$ 的高斯-勒让德积分来近似。余纬点则为 $\\theta_k = \\arccos(\\mu_k)$。\n\n因此，系数 $a_{\\ell m}$ 的离散近似是一个加权和：\n$$\na_{\\ell m} \\approx \\sum_{k=0}^{N_{\\theta}-1} \\sum_{j=0}^{N_{\\lambda}-1} f(\\lambda_j, \\theta_k) \\, (Y_{\\ell}^{m}(\\lambda_j, \\theta_k))^{*} \\, w_k^{\\mu} \\left(\\frac{2\\pi}{N_{\\lambda}}\\right)\n$$\n类似地，在网格上求值的函数 $g$ 的 $L_2$ 范数的平方是：\n$$\n\\|g\\|_{L_2}^2 \\approx \\sum_{k=0}^{N_{\\theta}-1} \\sum_{j=0}^{N_{\\lambda}-1} |g(\\lambda_j, \\theta_k)|^2 \\, w_k^{\\mu} \\left(\\frac{2\\pi}{N_{\\lambda}}\\right)\n$$\n\n总体算法流程如下：\n1.  **网格和权重生成**：对于给定的 $N_{\\lambda}$ 和 $N_{\\theta}$，生成经度点 $\\lambda_j$ 和常数权重 $w^{\\lambda} = 2\\pi/N_{\\lambda}$。生成高斯-勒让德点 $\\mu_k$ 和权重 $w_k^{\\mu}$，并由此计算出余纬点 $\\theta_k$。构建一个 $(\\lambda_j, \\theta_k)$ 点的二维网格。\n2.  **场求值**：在二维网格上对给定函数 $f(\\lambda,\\phi(\\theta))$ 进行求值，生成场值矩阵 $f_{jk} = f(\\lambda_j, \\theta_k)$。\n3.  **谱分析（正变换）**：对于从 $0$ 到 $L_{\\max}$ 的每个阶 $\\ell$ 和从 $-\\ell$ 到 $\\ell$ 的每个级 $m$，使用上述离散求和公式计算系数 $a_{\\ell m}$。这涉及到在网格上计算 $(Y_{\\ell}^{m}(\\lambda_j, \\theta_k))^{*}$。\n4.  **场重构（逆变换）**：在同一网格上重构截断场 $f_{L_{\\max}}$。初始化一个零值网格，然后对于每个 $(\\ell, m)$ 对，将贡献 $a_{\\ell m} Y_{\\ell}^{m}(\\lambda_j, \\theta_k)$ 添加到网格中。\n5.  **误差计算**：计算原始场网格与重构场网格之间的差值 $d_{jk} = f_{jk} - (f_{L_{\\max}})_{jk}$。使用离散范数公式计算平方范数 $\\|f - f_{L_{\\max}}\\|_{L_2}^2$ 和 $\\|f\\|_{L_2}^2$。所求误差 $\\varepsilon(L_{\\max})$ 是它们比值的平方根。\n\n对于测试用例1，$f(\\lambda, \\phi) = \\operatorname{Re}\\{Y_8^3(\\lambda, \\theta)\\} = \\frac{1}{2}(Y_8^3 - (Y_8^{-3})^*)$。由于 $L_{\\max}=8$，截断级数包含了精确场的所有非零谱分量。因此，重构应该是精确的，数值误差 $\\varepsilon(8)$ 预计接近机器精度，仅受积分精度和浮点运算的限制。当 $N_\\lambda=256$ 和 $N_\\theta=128$ 时，积分对于该函数非常精确。\n\n对于测试用例3和4，函数为 $f(\\lambda,\\phi) = 1 + 0.1\\,\\sin(2\\phi)\\,\\cos(3\\lambda)$。$1$ 是一个常数，对应于 $l=0$ 模态。第二项 $g=0.1\\sin(2\\phi)\\cos(3\\lambda)$，由于其关于赤道的奇对称性 ($\\theta \\to \\pi-\\theta$)，其球谐展开仅包含偶数阶 $l$ 和 $m=\\pm3$ 的模态，例如 $l=4, 6, \\dots$。因此，在 $L_{max}=3$ 截断时，该项的所有谱系数应为零。这意味着对于 $L_{max}=3$ 和 $L_{max}=0$ 的截断，重构场都应为函数的均值，即 $f_{recon} = 1$。因此，两种情况下的截断误差应相同，等于未被捕获的项 $g$ 的相对范数。\n\n以下是实现上述算法的 Python 代码，可用于计算测试用例的误差。\n\n```python\nimport numpy as np\nfrom scipy.special import sph_harm\n\ndef calculate_error(f, L_max, N_lambda, N_theta):\n    \"\"\"\n    Computes the relative L2 truncation error for a spherical harmonic expansion.\n\n    Args:\n        f (callable): The scalar field f(lambda, theta) to analyze.\n        L_max (int): The maximum degree of the spherical harmonic expansion.\n        N_lambda (int): The number of points for the longitude grid.\n        N_theta (int): The number of points for the colatitude grid (Gauss-Legendre nodes).\n\n    Returns:\n        float: The relative L2 truncation error epsilon(L_max).\n    \"\"\"\n    \n    # 1. Grid and Weight Generation\n    lambda_pts = np.linspace(0, 2 * np.pi, N_lambda, endpoint=False)\n    lambda_w = 2 * np.pi / N_lambda\n\n    mu_pts, mu_w = np.polynomial.legendre.leggauss(N_theta) # mu = cos(theta) in [-1, 1]\n    theta_pts = np.arccos(mu_pts) \n\n    lambda_grid, theta_grid = np.meshgrid(lambda_pts, theta_pts)\n\n    # 2. Field Evaluation\n    f_grid = f(lambda_grid, theta_grid)\n\n    # 3. Spectral Analysis (Forward Transform)\n    coeffs = {}\n    for l in range(L_max + 1):\n        for m in range(-l, l + 1):\n            Ylm_conj = np.conj(sph_harm(m, l, lambda_grid, theta_grid))\n            integrand = f_grid * Ylm_conj\n            # mu_w is (N_theta,), needs to be (N_theta, 1) for broadcasting\n            a_lm = np.sum(integrand * mu_w[:, np.newaxis] * lambda_w)\n            coeffs[(l, m)] = a_lm\n\n    # 4. Field Reconstruction (Inverse Transform)\n    f_recon_grid = np.zeros_like(f_grid, dtype=np.complex128)\n    for l in range(L_max + 1):\n        for m in range(-l, l + 1):\n            Ylm = sph_harm(m, l, lambda_grid, theta_grid)\n            f_recon_grid += coeffs[(l, m)] * Ylm\n    \n    if np.isrealobj(f_grid):\n        f_recon_grid = np.real(f_recon_grid)\n\n    # 5. Error Calculation\n    norm_f_sq = np.sum(np.abs(f_grid)**2 * mu_w[:, np.newaxis] * lambda_w)\n    diff_grid = f_grid - f_recon_grid\n    norm_err_sq = np.sum(np.abs(diff_grid)**2 * mu_w[:, np.newaxis] * lambda_w)\n\n    if norm_f_sq == 0:\n        return np.sqrt(norm_err_sq) if norm_err_sq > 0 else 0.0\n\n    return np.sqrt(norm_err_sq / norm_f_sq)\n```",
            "answer": "[2.8441113e-15,0.0031804364,0.051571585,0.051571585]"
        }
    ]
}