{
    "hands_on_practices": [
        {
            "introduction": "A significant challenge in ocean models that use terrain-following coordinates is the accurate calculation of the horizontal pressure gradient over steep topography. This so-called Pressure Gradient Error (PGE) can be particularly problematic at the interface between coarse and fine grids, where interpolation can introduce inconsistencies. This practical exercise guides you through coding a test case to diagnose and quantify the PGE at a nested boundary, allowing you to directly compare the performance of one-way and two-way coupling strategies in a controlled, analytical setting .",
            "id": "3805945",
            "problem": "Consider a one-dimensional, hydrostatic, Boussinesq ocean model discretized with a terrain-following vertical coordinate (commonly called a sigma-coordinate). Assume the following foundational laws and definitions apply: hydrostatic balance $\\frac{\\partial p}{\\partial z} = -\\rho g$, the Boussinesq approximation treats density variations only in buoyancy and pressure gradient forces with a constant reference density, and a linear equation of state is used for density. Let the density field be prescribed analytically as a smooth function\n$$\n\\rho(x,z) = \\rho_0 + \\gamma_x x + \\gamma_z z,\n$$\nwith $x$ measured horizontally in meters, $z$ measured vertically in meters with $z=0$ at the free surface and $z<0$ downward, $\\rho_0$ in kilograms per cubic meter, and constant gradients $\\gamma_x$ and $\\gamma_z$ with units kilograms per cubic meter per meter. The bathymetric depth is a smooth function $H(x)$ in meters. The terrain-following vertical coordinate is defined by\n$$\n\\sigma = -\\frac{z}{H(x)}, \\quad \\sigma \\in [0,1],\n$$\nso that a fixed $\\sigma$ corresponds to a physical depth $z(x,\\sigma) = -\\sigma H(x)$ that varies in $x$ for sloping bathymetry.\n\nFrom hydrostatic balance and the prescribed density, the exact hydrostatic pressure at a point $(x,z)$ under a zero free surface elevation is\n$$\np(x,z) = g \\int_{z}^{0} \\rho(x,\\zeta)\\,d\\zeta = g\\left[-(\\rho_0 + \\gamma_x x)z - \\frac{\\gamma_z}{2}z^2\\right],\n$$\nwith $g$ the gravitational acceleration in meters per second squared. The exact horizontal pressure gradient at constant geometric depth $z$ is\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = -g \\gamma_x z.\n$$\n\nIn a sigma-coordinate discretization, a common numerical approximation to the horizontal pressure gradient near a boundary is the finite difference along a fixed $\\sigma$ level,\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} \\approx \\frac{p(x+\\Delta x, z(x+\\Delta x,\\sigma)) - p(x-\\Delta x, z(x-\\Delta x,\\sigma))}{2\\Delta x},\n$$\nwhich follows a path of varying geometric depth when $H(x)$ is not constant. The difference between this sigma-path gradient and the exact constant-$z$ gradient is the pressure gradient error (PGE),\n$$\n\\mathrm{PGE}(x,\\sigma) = \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} - \\left.\\frac{\\partial p}{\\partial x}\\right|_{z}.\n$$\n\nYou will design a nested-grid test focused on boundary effects. Let there be a coarse outer grid with $N_c$ nodes spanning $x\\in[0,L]$ with uniform spacing $\\Delta x_c = L/(N_c-1)$, and a fine inner grid nested within $[x_s,x_e] \\subset (0,L)$ with $N_f$ nodes and $\\Delta x_f = \\Delta x_c/r$ for some integer refinement ratio $r \\ge 2$. The bathymetry is linear,\n$$\nH(x) = H_0 + \\alpha x,\n$$\nwith $H_0>0$ and slope $\\alpha$ in meters per meter. The isopycnal slope is implicitly determined by the ratio $s = -\\gamma_x/\\gamma_z$; with $\\gamma_z<0$ and $\\gamma_x>0$ this slope is positive, ensuring isopycnals tilt and cross any vertical boundary.\n\nAt the left fine-grid boundary located at $x_b = x_s + \\Delta x_f$, consider a discrete central difference approximation of the sigma-path horizontal pressure gradient using values at $\\sigma_j = j/(M+1)$ for $j=1,\\dots,M$ (mid-levels avoiding endpoints) with $M \\ge 2$:\n- Use $p(x_b+\\Delta x_f, z(x_b+\\Delta x_f,\\sigma_j))$ from the fine grid interior.\n- Supply the left ghost value $p(x_b-\\Delta x_f, z(x_b-\\Delta x_f,\\sigma_j))$ from the coarse grid using one of two coupling strategies:\n    1. One-way nesting: interpolate the coarse-grid pressure values at the same $\\sigma_j$ to $x_b-\\Delta x_f$ using linear interpolation between the nearest coarse nodes.\n    2. Two-way nesting: compute the same coarse interpolation, then blend it with a fine-grid linear extrapolation from the interior at the same $\\sigma_j$ using a feedback weight $\\lambda \\in (0,1)$, i.e., $p_{\\text{ghost}} = (1-\\lambda) p_{\\text{coarse-interp}} + \\lambda p_{\\text{fine-extrap}}$ where the fine extrapolation is $p_{\\text{fine-extrap}} = p(x_b,\\sigma_j) - [p(x_b+\\Delta x_f,\\sigma_j) - p(x_b,\\sigma_j)]$.\n\nFor each $\\sigma_j$, compute the sigma-path finite difference\n$$\nG_{\\sigma}(x_b,\\sigma_j) = \\frac{p(x_b+\\Delta x_f, z(x_b+\\Delta x_f,\\sigma_j)) - p_{\\text{ghost}}(x_b-\\Delta x_f, \\sigma_j)}{2\\Delta x_f},\n$$\nand the exact constant-$z$ gradient at the representative depth $z_b(\\sigma_j) = -\\sigma_j H(x_b)$,\n$$\nG_{z}(x_b,\\sigma_j) = -g \\gamma_x z_b(\\sigma_j).\n$$\nDefine the root-mean-square pressure gradient error at the boundary,\n$$\nE_{\\mathrm{RMS}} = \\sqrt{\\frac{1}{M}\\sum_{j=1}^{M} \\left( G_{\\sigma}(x_b,\\sigma_j) - G_{z}(x_b,\\sigma_j) \\right)^2 }.\n$$\n\nYour task is to implement a complete program that:\n1. Computes $p(x,z)$ exactly from the analytic formula above.\n2. Constructs coarse and fine grids as described.\n3. Implements one-way and two-way nesting for the boundary ghost value and computes $E_{\\mathrm{RMS}}$ at the left fine-grid boundary.\n4. Evaluates $E_{\\mathrm{RMS}}$ for the provided test suite and prints the results.\n\nUse the following constants and test suite. All outputs must be expressed in pascals per meter (Pa/m) as decimal floats.\n\nConstants:\n- $g = 9.81 \\ \\mathrm{m/s^2}$, $\\rho_0 = 1025 \\ \\mathrm{kg/m^3}$, refinement ratio $r = 2$, feedback weight $\\lambda = 0.5$, number of sigma mid-levels $M = 20$.\n\nTest suite parameter sets $(L,H_0,\\alpha,N_c,\\gamma_x,\\gamma_z,x_s,x_e,\\mathrm{mode})$:\n- Case 1 (happy path, one-way): $(10000, 100, 1.0\\times 10^{-3}, 65, 1.0\\times 10^{-5}, -1.0\\times 10^{-2}, 2500, 7500, \\text{one-way})$.\n- Case 2 (happy path, two-way): $(10000, 100, 1.0\\times 10^{-3}, 65, 1.0\\times 10^{-5}, -1.0\\times 10^{-2}, 2500, 7500, \\text{two-way})$.\n- Case 3 (boundary condition edge, flat bathymetry): $(10000, 100, 0, 65, 1.0\\times 10^{-5}, -1.0\\times 10^{-2}, 2500, 7500, \\text{one-way})$.\n- Case 4 (steeper bathymetry, one-way): $(10000, 100, 1.0\\times 10^{-2}, 65, 1.0\\times 10^{-5}, -1.0\\times 10^{-2}, 2500, 7500, \\text{one-way})$.\n- Case 5 (steeper bathymetry, two-way): $(10000, 100, 1.0\\times 10^{-2}, 65, 1.0\\times 10^{-5}, -1.0\\times 10^{-2}, 2500, 7500, \\text{two-way})$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test cases above, for example, \"[result1,result2,result3,result4,result5]\". Each result shall be the corresponding $E_{\\mathrm{RMS}}$ value in Pa/m for the indicated case.",
            "solution": "The problem requires the computation of the root-mean-square pressure gradient error ($E_{\\mathrm{RMS}}$) at the boundary of a nested grid in a simplified one-dimensional ocean model. The solution involves several computational steps based on the provided physical and numerical framework.\n\nFirst, we define the core physical functions based on the problem statement. The bathymetric depth $H(x)$ is a linear function of the horizontal coordinate $x$:\n$$\nH(x) = H_0 + \\alpha x\n$$\nwhere $H_0$ is the depth at $x=0$ and $\\alpha$ is the constant bottom slope.\n\nThe terrain-following sigma-coordinate, $\\sigma$, is related to the geometric vertical coordinate, $z$, by:\n$$\nz(x, \\sigma) = -\\sigma H(x) = -\\sigma(H_0 + \\alpha x)\n$$\nThis transformation maps the domain $(x, \\sigma) \\in [0,L] \\times [0,1]$ to the physical domain bounded by the free surface $z=0$ and the sea floor $z=-H(x)$.\n\nThe hydrostatic pressure $p(x,z)$ is given by the analytical formula derived from integrating the prescribed density field $\\rho(x,z) = \\rho_0 + \\gamma_x x + \\gamma_z z$:\n$$\np(x,z) = g\\left[-(\\rho_0 + \\gamma_x x)z - \\frac{\\gamma_z}{2}z^2\\right]\n$$\nwhere $g$ is the gravitational acceleration.\n\nThe problem requires a comparison between the exact horizontal pressure gradient on a constant-depth ($z$) surface and its numerical approximation on a constant-sigma ($\\sigma$) surface. The exact gradient at a point $(x,z)$ is:\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = -g \\gamma_x z\n$$\nThe evaluation will take place at discrete vertical levels $\\sigma_j = j/(M+1)$ for $j=1,\\dots,M$, at the horizontal location $x_b$. The corresponding physical depths are $z_b(\\sigma_j) = z(x_b, \\sigma_j) = -\\sigma_j H(x_b)$. Thus, the exact gradient to compare against is:\n$$\nG_{z}(x_b, \\sigma_j) = \\left.\\frac{\\partial p}{\\partial x}\\right|_{z=z_b(\\sigma_j)} = -g \\gamma_x z_b(\\sigma_j) = g \\gamma_x \\sigma_j H(x_b)\n$$\n\nNext, we establish the numerical grid structure. A coarse grid spans the domain $x \\in [0,L]$ with $N_c$ nodes, yielding a grid spacing of $\\Delta x_c = L/(N_c-1)$. A fine grid is nested within $[x_s, x_e]$ with a spacing of $\\Delta x_f = \\Delta x_c / r$, where $r$ is the refinement ratio.\n\nThe numerical pressure gradient is calculated using a centered finite difference at the location $x_b = x_s + \\Delta x_f$, which is the second node of the fine grid. The stencil uses points at $x_b - \\Delta x_f = x_s$ and $x_b + \\Delta x_f = x_s + 2\\Delta x_f$. For a given $\\sigma_j$ level, the numerical gradient is:\n$$\nG_{\\sigma}(x_b, \\sigma_j) = \\frac{p(x_R, z_R) - p_{\\text{ghost}}(x_L, \\sigma_j)}{2\\Delta x_f}\n$$\nwhere:\n- The right point is $x_R = x_b + \\Delta x_f$. The pressure is evaluated at the physical location $(x_R, z_R)$ where $z_R = z(x_R, \\sigma_j)$. So, the pressure term is $p_R = p(x_R, z(x_R, \\sigma_j))$.\n- The left point is $x_L = x_b - \\Delta x_f = x_s$. The pressure at this boundary point is not computed directly but is supplied as a \"ghost\" value, $p_{\\text{ghost}}$, whose calculation depends on the nesting strategy. The problem statement implies $p_{\\text{ghost}}$ is a value at the sigma-level $\\sigma_j$ for the horizontal location $x_L$, but its physical depth corresponds to the bathymetry at $x_L$, i.e., $z_L = z(x_L, \\sigma_j)$.\n\nThe calculation of $p_{\\text{ghost}}$ at location $x_L = x_s$ for each $\\sigma_j$ proceeds as follows:\n\n1.  **Coarse-grid Interpolation**: First, we find the value $p_{\\text{coarse-interp}}$ by linearly interpolating from the two nearest coarse-grid nodes that bracket $x_L$. Let these nodes be $x_{c,k}$ and $x_{c,k+1}$ such that $x_{c,k} \\le x_L < x_{c,k+1}$. The index $k$ can be found as $k = \\lfloor x_L / \\Delta x_c \\rfloor$. The interpolation weights are determined by the position of $x_L$ relative to these nodes. The pressure values at the coarse nodes are computed on the same $\\sigma_j$ surface:\n    $$\n    p_{c,k} = p(x_{c,k}, z(x_{c,k}, \\sigma_j))\n    $$\n    $$\n    p_{c,k+1} = p(x_{c,k+1}, z(x_{c,k+1}, \\sigma_j))\n    $$\n    The interpolated value is:\n    $$\n    p_{\\text{coarse-interp}} = p_{c,k} + \\frac{p_{c,k+1} - p_{c,k}}{x_{c,k+1} - x_{c,k}} (x_L - x_{c,k})\n    $$\n\n2.  **Nesting Strategy**:\n    *   **One-way nesting**: The ghost value is simply the coarse-grid interpolation:\n      $$\n      p_{\\text{ghost}} = p_{\\text{coarse-interp}}\n      $$\n    *   **Two-way nesting**: The ghost value is a blend of the coarse-grid interpolation and an extrapolation from the fine-grid interior. The fine-grid extrapolation, $p_{\\text{fine-extrap}}$, uses values at $x_b$ and $x_b+\\Delta x_f$ to estimate the value at $x_b - \\Delta x_f = x_L$:\n      $$\n      p_{\\text{fine-extrap}} = p(x_b, z(x_b, \\sigma_j)) - \\left[ p(x_b+\\Delta x_f, z(x_b+\\Delta x_f, \\sigma_j)) - p(x_b, z(x_b, \\sigma_j)) \\right]\n      $$\n      The final ghost value is a weighted average using the feedback weight $\\lambda$:\n      $$\n      p_{\\text{ghost}} = (1-\\lambda) p_{\\text{coarse-interp}} + \\lambda p_{\\text{fine-extrap}}\n      $$\n\nFinally, for each test case, the root-mean-square error is computed by averaging the squared differences between the numerical and exact gradients over all $M$ sigma levels:\n$$\nE_{\\mathrm{RMS}} = \\sqrt{\\frac{1}{M}\\sum_{j=1}^{M} \\left( G_{\\sigma}(x_b, \\sigma_j) - G_{z}(x_b, \\sigma_j) \\right)^2 }\n$$\n\nThe overall algorithm is:\n1.  For each test case, parse the parameters $(L, H_0, \\alpha, N_c, \\gamma_x, \\gamma_z, x_s, x_e, \\mathrm{mode})$.\n2.  Set the global constants $g, \\rho_0, r, \\lambda, M$.\n3.  Define the grid parameters: $\\Delta x_c = L/(N_c-1)$ and $\\Delta x_f = \\Delta x_c/r$.\n4.  Define the key horizontal locations: $x_b = x_s + \\Delta x_f$, $x_L = x_s$, $x_R = x_s + 2\\Delta x_f$.\n5.  Initialize an array to store the squared errors for each $\\sigma_j$.\n6.  Loop $j$ from $1$ to $M$:\n    a.  Set $\\sigma_j = j/(M+1)$.\n    b.  Calculate the bathymetry $H(x)$ at all required $x$ locations.\n    c.  Calculate the exact gradient $G_{z}(x_b, \\sigma_j) = g \\gamma_x \\sigma_j H(x_b)$.\n    d.  Calculate $p_R = p(x_R, z(x_R, \\sigma_j))$.\n    e.  Calculate $p_{\\text{ghost}}$ at $x_L$ according to the specified `mode` ('one-way' or 'two-way'), which involves computing $p_{\\text{coarse-interp}}$ and, if needed, $p_{\\text{fine-extrap}}$.\n    f.  Calculate the numerical gradient $G_{\\sigma}(x_b, \\sigma_j) = (p_R - p_{\\text{ghost}}) / (2\\Delta x_f)$.\n    g.  Store the squared difference $(G_{\\sigma} - G_{z})^2$.\n7.  Compute $E_{\\mathrm{RMS}}$ by taking the square root of the mean of the stored squared errors.\n8.  Collect the $E_{\\mathrm{RMS}}$ for all test cases and format the output as specified.\n\nFor the special case where $\\alpha = 0$, the bathymetry $H(x) = H_0$ is constant. Consequently, for any fixed $\\sigma_j$, the depth $z(x,\\sigma_j) = -\\sigma_j H_0$ is also constant. The pressure function $p(x,z)$ is linear in $x$ for a fixed $z$. Therefore, linear interpolation in $x$ is exact. The coarse-grid interpolation will yield the exact pressure value, so $p_{\\text{coarse-interp}}$ will be exact. This means for one-way nesting, the numerical gradient $G_\\sigma$ will be exactly equal to the analytical finite difference on a $z$-level, which for a linear pressure field is equal to the true derivative. Thus, for Case 3, we anticipate $E_{\\mathrm{RMS}} = 0$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the RMS pressure gradient error for a series of nested-grid test cases.\n    \"\"\"\n    # Constants\n    g = 9.81  # m/s^2\n    rho_0 = 1025.0  # kg/m^3\n    r = 2.0  # refinement ratio\n    lambda_blend = 0.5  # two-way feedback weight\n    M = 20  # number of sigma mid-levels\n\n    # Test suite parameter sets\n    # (L, H0, alpha, Nc, gamma_x, gamma_z, x_s, x_e, mode)\n    test_cases = [\n        (10000.0, 100.0, 1.0e-3, 65, 1.0e-5, -1.0e-2, 2500.0, 7500.0, 'one-way'),\n        (10000.0, 100.0, 1.0e-3, 65, 1.0e-5, -1.0e-2, 2500.0, 7500.0, 'two-way'),\n        (10000.0, 100.0, 0.0, 65, 1.0e-5, -1.0e-2, 2500.0, 7500.0, 'one-way'),\n        (10000.0, 100.0, 1.0e-2, 65, 1.0e-5, -1.0e-2, 2500.0, 7500.0, 'one-way'),\n        (10000.0, 100.0, 1.0e-2, 65, 1.0e-5, -1.0e-2, 2500.0, 7500.0, 'two-way'),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        L, H0, alpha, Nc, gamma_x, gamma_z, x_s, x_e, mode = case\n\n        # Helper functions defined within the case scope to capture parameters\n        def H(x):\n            return H0 + alpha * x\n\n        def z_coord(x, sigma):\n            return -sigma * H(x)\n\n        def pressure(x, z_val):\n            term1 = -(rho_0 + gamma_x * x) * z_val\n            term2 = - (gamma_z / 2.0) * z_val**2\n            return g * (term1 + term2)\n\n        # Grid setup\n        dx_c = L / (Nc - 1)\n        dx_f = dx_c / r\n\n        # Key x-locations for the finite difference stencil\n        x_b = x_s + dx_f  # Stencil center\n        x_L = x_b - dx_f  # Left point (ghost)\n        x_R = x_b + dx_f  # Right point\n\n        # Sigma levels\n        sigma_levels = np.array([j / (M + 1) for j in range(1, M + 1)])\n\n        squared_errors = []\n\n        for sigma_j in sigma_levels:\n            # --- Exact Gradient ---\n            z_at_xb = z_coord(x_b, sigma_j)\n            G_z = -g * gamma_x * z_at_xb\n\n            # --- Numerical Gradient Calculation ---\n            \n            # 1. Right point value (fine grid interior)\n            z_at_xR = z_coord(x_R, sigma_j)\n            p_R = pressure(x_R, z_at_xR)\n\n            # 2. Left point value (ghost point at x_L = x_s)\n            \n            # 2a. Coarse-grid interpolation to x_L\n            k = int(np.floor(x_L / dx_c))\n            x_c_k = k * dx_c\n            x_c_k1 = (k + 1) * dx_c\n            \n            z_c_k = z_coord(x_c_k, sigma_j)\n            p_c_k = pressure(x_c_k, z_c_k)\n            \n            z_c_k1 = z_coord(x_c_k1, sigma_j)\n            p_c_k1 = pressure(x_c_k1, z_c_k1)\n\n            interp_weight = (x_L - x_c_k) / dx_c\n            p_coarse_interp = p_c_k * (1.0 - interp_weight) + p_c_k1 * interp_weight\n\n            p_ghost = 0.0\n            if mode == 'one-way':\n                p_ghost = p_coarse_interp\n            elif mode == 'two-way':\n                # 2b. Fine-grid extrapolation to x_L\n                z_at_xb_fine = z_coord(x_b, sigma_j)\n                p_at_xb_fine = pressure(x_b, z_at_xb_fine)\n                \n                z_at_xR_fine = z_coord(x_R, sigma_j)\n                p_at_xR_fine = pressure(x_R, z_at_xR_fine)\n                \n                p_fine_extrap = p_at_xb_fine - (p_at_xR_fine - p_at_xb_fine)\n                \n                # 2c. Blending\n                p_ghost = (1.0 - lambda_blend) * p_coarse_interp + lambda_blend * p_fine_extrap\n\n            # 3. Compute numerical gradient G_sigma\n            G_sigma = (p_R - p_ghost) / (2.0 * dx_f)\n\n            # 4. Store squared error\n            squared_errors.append((G_sigma - G_z)**2)\n        \n        # Compute RMS error for the case\n        E_rms = np.sqrt(np.mean(squared_errors))\n        results.append(E_rms)\n\n    # Print results in the required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While two-way nesting allows for high-resolution information to improve the coarse-grid solution, the method used to apply this feedback is critical for model stability. Abruptly replacing the coarse solution with the fine one can introduce spurious noise, contaminating the simulation. This exercise provides a theoretical framework to compare the 'replacement' feedback method against a gentler 'incremental update' approach, analytically demonstrating how the latter can significantly reduce the injection of numerical shocks into the parent grid .",
            "id": "3805941",
            "problem": "Consider the one-dimensional linear advection–diffusion equation for a passive tracer field $u(x,t)$,\n$$\n\\frac{\\partial u}{\\partial t} + c\\,\\frac{\\partial u}{\\partial x} = \\kappa\\,\\frac{\\partial^{2} u}{\\partial x^{2}},\n$$\non a periodic domain $x \\in [0, L]$, where $c$ is a constant advection speed and $\\kappa$ is a constant diffusivity. A parent grid with uniform spacing $\\Delta x_{p}$ covers the whole domain, and a nested child grid with uniform spacing $\\Delta x_{c} = \\Delta x_{p}/r$ (with integer refinement factor $r \\geq 2$) covers a contiguous subdomain $\\Omega_{\\mathrm{nest}} \\subset [0,L]$. Both grids advance using the same time step $\\Delta t$ and the same stable finite-volume discretization for advection–diffusion, but the details of the time integrator are not required in this problem.\n\nAssume the child grid resolves the true solution $u(x,t)$ within $\\Omega_{\\mathrm{nest}}$ to negligible error at coupling time $t^{n+1}$, while the parent grid’s free forecast $u_{p}^{n+1,\\mathrm{f}}(x)$ deviates from the truth within $\\Omega_{\\mathrm{nest}}$ by an error field $e(x)$ such that $u_{p}^{n+1,\\mathrm{f}}(x) = u(x,t^{n+1}) + e(x)$ for $x \\in \\Omega_{\\mathrm{nest}}$. Outside $\\Omega_{\\mathrm{nest}}$, no feedback is applied and the parent grid remains unchanged.\n\nTwo standard two-way nesting feedback strategies are considered to update the parent grid at $t^{n+1}$ using the child solution restricted to the parent grid. Let $\\mathcal{A}$ denote the linear restriction operator that maps the child-grid solution to parent-grid cell averages over $\\Omega_{\\mathrm{nest}}$. The strategies are:\n- Replacement feedback: set the parent grid to the restricted child solution, $u_{p}^{n+1,\\mathrm{rep}} = \\mathcal{A}[u_{c}^{n+1}]$ in $\\Omega_{\\mathrm{nest}}$.\n- Incremental update feedback: set the parent grid to the free forecast plus a weighted increment toward the restricted child solution, $u_{p}^{n+1,\\mathrm{inc}} = u_{p}^{n+1,\\mathrm{f}} + \\alpha\\big(\\mathcal{A}[u_{c}^{n+1}] - u_{p}^{n+1,\\mathrm{f}}\\big)$ in $\\Omega_{\\mathrm{nest}}$, with a fixed weight $0 < \\alpha < 1$.\n\nTo quantify spurious noise injected into the parent by the feedback at $t^{n+1}$, define the parent-grid update increment as $\\Delta u_{p}^{n+1} = u_{p}^{n+1} - u_{p}^{n+1,\\mathrm{f}}$ and measure its discrete $L^{2}$ norm over the parent cells that lie within $\\Omega_{\\mathrm{nest}}$:\n$$\n\\|\\Delta u_{p}^{n+1}\\|_{2} \\equiv \\left(\\Delta x_{p} \\sum_{j \\in \\Omega_{\\mathrm{nest}}} \\big[\\Delta u_{p,j}^{n+1}\\big]^{2}\\right)^{1/2},\n$$\nwhere $u_{p,j}^{n+1}$ and $\\Delta u_{p,j}^{n+1}$ denote parent-grid cell averages and their corresponding increments, and the sum is over the indices of parent-grid cells within $\\Omega_{\\mathrm{nest}}$.\n\nFor a linear advection–diffusion test, take the true solution at $t^{n+1}$ to be a single spatial Fourier mode, $u(x,t^{n+1}) = U_{0}\\cos\\big(2\\pi k x/L\\big)$ with wavenumber $k \\in \\mathbb{N}$, and suppose the parent free-forecast error within $\\Omega_{\\mathrm{nest}}$ is $e(x) = E_{0}\\cos\\big(2\\pi m x/L\\big)$ for some integer $m$. The child solution is assumed exact within $\\Omega_{\\mathrm{nest}}$, so $\\mathcal{A}[u_{c}^{n+1}] = \\mathcal{A}[u(\\cdot,t^{n+1})]$ on the parent grid. Let the refinement factor be $r = 4$, and let the incremental update weight be $\\alpha = \\tfrac{1}{2}$. You may assume $\\mathcal{A}$ is a volume-average over each parent cell and linear, and that the discrete $L^{2}$ norm above is consistent with the continuous $L^{2}$ norm under such restriction.\n\nCompute the ratio\n$$\nR \\equiv \\frac{\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{inc}}}{\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{rep}}},\n$$\nwhere $\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{inc}}$ and $\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{rep}}$ are the parent-grid update $L^{2}$ norms produced by the incremental update and replacement feedback, respectively, evaluated immediately after coupling at $t^{n+1}$. Express your final answer as a dimensionless number rounded to four significant figures.",
            "solution": "The problem statement has been validated and is deemed self-contained, scientifically grounded, and well-posed. It presents a theoretical question in the field of numerical methods for partial differential equations, specifically concerning grid nesting techniques. Though it contains a significant amount of information pertaining to the physical and numerical context (the specific advection-diffusion equation, the Fourier mode representation of the solution and error, the grid refinement ratio), the core question can be resolved by carefully applying the definitions of the feedback strategies and the properties of the discrete $L^{2}$ norm.\n\nLet us denote the parent-grid cell average of a quantity $f(x)$ over the $j$-th cell as $f_j$. The problem provides the following key definitions and relationships for the parent-grid values at time $t^{n+1}$ within the nested domain $\\Omega_{\\mathrm{nest}}$:\n\n1.  The parent-grid free forecast, $u_{p,j}^{n+1,\\mathrm{f}}$, is the cell average of the continuous field $u_{p}^{n+1,\\mathrm{f}}(x) = u(x,t^{n+1}) + e(x)$. Let $u_j^{n+1}$ and $e_j$ be the cell averages of the true solution $u(x,t^{n+1})$ and the error field $e(x)$, respectively. By the linearity of the averaging operator, we have:\n    $$u_{p,j}^{n+1,\\mathrm{f}} = u_j^{n+1} + e_j$$\n2.  The child solution $u_c^{n+1}$ is assumed to be exact. The restriction operator $\\mathcal{A}$ performs cell averaging. Thus, the restricted child solution on the parent grid corresponds to the cell averages of the true solution:\n    $$\\big(\\mathcal{A}[u_c^{n+1}]\\big)_j = u_j^{n+1}$$\n3.  The update increment for the parent grid is defined as:\n    $$\\Delta u_{p,j}^{n+1} = u_{p,j}^{n+1} - u_{p,j}^{n+1,\\mathrm{f}}$$\n\nWe now calculate this increment for each of the two feedback strategies.\n\nFor the **replacement feedback** strategy, the updated parent-grid state $u_{p,j}^{n+1,\\mathrm{rep}}$ is given by:\n$$u_{p,j}^{n+1,\\mathrm{rep}} = \\big(\\mathcal{A}[u_c^{n+1}]\\big)_j = u_j^{n+1}$$\nThe corresponding update increment, $\\Delta u_{p,j}^{n+1,\\mathrm{rep}}$, is:\n$$\\Delta u_{p,j}^{n+1,\\mathrm{rep}} = u_{p,j}^{n+1,\\mathrm{rep}} - u_{p,j}^{n+1,\\mathrm{f}} = u_j^{n+1} - (u_j^{n+1} + e_j) = -e_j$$\n\nFor the **incremental update feedback** strategy, with weight $\\alpha$, the updated parent-grid state $u_{p,j}^{n+1,\\mathrm{inc}}$ is:\n$$u_{p,j}^{n+1,\\mathrm{inc}} = u_{p,j}^{n+1,\\mathrm{f}} + \\alpha\\left(\\big(\\mathcal{A}[u_c^{n+1}]\\big)_j - u_{p,j}^{n+1,\\mathrm{f}}\\right)$$\nThe update increment, $\\Delta u_{p,j}^{n+1,\\mathrm{inc}}$, is by definition the second term on the right-hand side:\n$$\\Delta u_{p,j}^{n+1,\\mathrm{inc}} = \\alpha\\left(\\big(\\mathcal{A}[u_c^{n+1}]\\big)_j - u_{p,j}^{n+1,\\mathrm{f}}\\right)$$\nSubstituting the known expressions for the terms in the parenthesis:\n$$\\Delta u_{p,j}^{n+1,\\mathrm{inc}} = \\alpha\\left(u_j^{n+1} - (u_j^{n+1} + e_j)\\right) = -\\alpha e_j$$\n\nFrom these derivations, we find a direct relationship between the update increments for the two strategies for any parent-grid cell $j$:\n$$\\Delta u_{p,j}^{n+1,\\mathrm{inc}} = \\alpha \\cdot \\Delta u_{p,j}^{n+1,\\mathrm{rep}}$$\nThis simple algebraic relationship is the key to solving the problem. The detailed forms of the true solution $u(x,t^{n+1})$ and the error $e(x)$ are not required to establish this.\n\nNow, we compute the discrete $L^2$ norms of these increments. The norm for the replacement feedback is:\n$$\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{rep}} = \\left(\\Delta x_{p} \\sum_{j \\in \\Omega_{\\mathrm{nest}}} \\big[\\Delta u_{p,j}^{n+1,\\mathrm{rep}}\\big]^{2}\\right)^{1/2}$$\nThe norm for the incremental update feedback is:\n$$\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{inc}} = \\left(\\Delta x_{p} \\sum_{j \\in \\Omega_{\\mathrm{nest}}} \\big[\\Delta u_{p,j}^{n+1,\\mathrm{inc}}\\big]^{2}\\right)^{1/2}$$\nSubstituting the relationship $\\Delta u_{p,j}^{n+1,\\mathrm{inc}} = \\alpha \\cdot \\Delta u_{p,j}^{n+1,\\mathrm{rep}}$ into the expression for the incremental update norm:\n$$\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{inc}} = \\left(\\Delta x_{p} \\sum_{j \\in \\Omega_{\\mathrm{nest}}} \\big[\\alpha \\cdot \\Delta u_{p,j}^{n+1,\\mathrm{rep}}\\big]^{2}\\right)^{1/2} = \\left(\\Delta x_{p} \\sum_{j \\in \\Omega_{\\mathrm{nest}}} \\alpha^2 \\big[\\Delta u_{p,j}^{n+1,\\mathrm{rep}}\\big]^{2}\\right)^{1/2}$$\nSince $\\alpha$ is a constant, we can factor $\\alpha^2$ out of the summation:\n$$\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{inc}} = \\left(\\alpha^2 \\left(\\Delta x_{p} \\sum_{j \\in \\Omega_{\\mathrm{nest}}} \\big[\\Delta u_{p,j}^{n+1,\\mathrm{rep}}\\big]^{2}\\right)\\right)^{1/2} = |\\alpha| \\left(\\Delta x_{p} \\sum_{j \\in \\Omega_{\\mathrm{nest}}} \\big[\\Delta u_{p,j}^{n+1,\\mathrm{rep}}\\big]^{2}\\right)^{1/2}$$\nThis simplifies to:\n$$\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{inc}} = |\\alpha| \\cdot \\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{rep}}$$\nThe problem statement requires the computation of the ratio $R$:\n$$R \\equiv \\frac{\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{inc}}}{\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{rep}}} = \\frac{|\\alpha| \\cdot \\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{rep}}}{\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{rep}}}$$\nAssuming the error field $e(x)$ is not identically zero after cell-averaging (which is the only non-trivial case, as otherwise both increments and norms would be zero), we can cancel the norm terms:\n$$R = |\\alpha|$$\nThe problem specifies that the weight $\\alpha$ is in the range $0 < \\alpha < 1$, so $|\\alpha| = \\alpha$.\nThe given value for the weight is $\\alpha = \\frac{1}{2}$.\nTherefore, the ratio is:\n$$R = \\frac{1}{2} = 0.5$$\nThe problem asks for the result to be rounded to four significant figures. This gives $0.5000$. The extraneous information, such as $c$, $\\kappa$, $r=4$, $U_0$, $E_0$, $k$, and $m$, does not affect the final ratio.",
            "answer": "$$\\boxed{0.5000}$$"
        },
        {
            "introduction": "Having established the benefits of a smoother feedback mechanism, a remaining practical question is how to initiate two-way coupling mid-simulation without generating large, unphysical transients. Simply switching the feedback 'on' can shock the system, exciting spurious waves that corrupt the solution. This advanced practice applies the calculus of variations to derive an optimal time-dependent ramping function for the feedback coefficient, minimizing the energy of boundary transients and ensuring a smooth, dynamically consistent transition from one-way to two-way nesting .",
            "id": "3805897",
            "problem": "A regional ocean model with nested grids is run with one-way nesting until time $t=0$, when the configuration is switched to two-way nesting with a time-dependent feedback coefficient $\\alpha(t)$ applied at the interface to blend the parent and child solutions. Consider the dominant boundary-adjustment response of the parent grid as a coastally trapped Kelvin wave excited by the change in interface forcing. Assume the following modeling framework for the boundary transient dynamics:\n\n- The along-boundary adjustment is governed by the linearized shallow-water energy budget with linear friction, leading to an exponential decay for boundary disturbances with a characteristic boundary-damping timescale $\\tau_{b} > 0$.\n- The net energy injected into the boundary mode by changing the feedback coefficient is proportional to the square of the temporal rate of change of the feedback, and the subsequent decay under linear friction imposes an exponential weighting on the contribution of earlier injections.\n\nUnder these assumptions, the total transient energy generated during the ramp, measured over a finite ramp interval $t \\in [0, T]$, is modeled by the functional\n$$\nE[\\alpha] \\;=\\; K \\int_{0}^{T} \\exp\\!\\left(-\\frac{2 t}{\\tau_{b}}\\right) \\left(\\frac{d\\alpha}{dt}(t)\\right)^{2} \\, dt,\n$$\nwhere $K>0$ is a proportionality constant that depends on the mismatch amplitude at the interface and dimensional parameters of the shallow-water dynamics, and $\\tau_{b}$ and $T$ are given.\n\nYou are tasked to quantify the boundary transients and propose a ramping protocol for the feedback coefficient that minimizes $E[\\alpha]$ subject to the constraints $\\alpha(0)=0$ and $\\alpha(T)=\\alpha_{f}$, where $\\alpha_{f}>0$ is the desired final two-way feedback strength. Starting from the linear shallow-water energy budget with linear friction and the calculus of variations, derive the analytic expression for the optimal ramp $\\alpha(t)$ on $[0, T]$ that minimizes $E[\\alpha]$ under the endpoint constraints. Express the final answer as a single closed-form expression in terms of $\\alpha_{f}$, $T$, and $\\tau_{b}$. State any additional regularity assumptions you require for $\\alpha(t)$ explicitly. The feedback coefficient $\\alpha(t)$ is dimensionless, so no physical units are needed in the final expression. Your final answer must be a single analytic expression for $\\alpha(t)$ on $[0, T]$.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n**Step 1: Extract Givens**\n- The total transient energy functional to be minimized is $E[\\alpha] = K \\int_{0}^{T} \\exp\\left(-\\frac{2 t}{\\tau_{b}}\\right) \\left(\\frac{d\\alpha}{dt}(t)\\right)^{2} \\, dt$.\n- The minimization is over the time interval $t \\in [0, T]$.\n- The constants are $K > 0$, $\\tau_b > 0$, and $T > 0$.\n- The boundary conditions for the feedback coefficient $\\alpha(t)$ are $\\alpha(0) = 0$ and $\\alpha(T) = \\alpha_f$, where $\\alpha_f > 0$.\n- The task is to find the function $\\alpha(t)$ that minimizes the functional $E[\\alpha]$ subject to these constraints.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem is well-grounded in the physics of fluid dynamics and the mathematics of optimization. The functional represents a physically plausible model for energy associated with a boundary transient, incorporating frictional damping and forcing related to the rate of change of a parameter. This is a standard approach in modeling physical systems.\n- **Well-Posedness**: The problem is a classic example of a problem in the calculus of variations. It asks for the minimization of a well-defined functional subject to fixed endpoint conditions. The integrand is quadratic in the first derivative of the unknown function, which typically leads to a well-posed problem with a unique solution.\n- **Objectivity and Completeness**: The problem is stated using precise mathematical and physical terminology. All necessary parameters ($K$, $T$, $\\tau_b$, $\\alpha_f$) and conditions are provided. It does not contain subjective statements or ambiguities.\n\n**Step 3: Verdict and Action**\nThe problem is deemed valid. It is a well-posed, scientifically sound problem in the calculus of variations. We may proceed with the derivation of the solution.\n\nThe problem requires finding the function $\\alpha(t)$ that minimizes the energy functional\n$$\nE[\\alpha] \\;=\\; K \\int_{0}^{T} \\exp\\!\\left(-\\frac{2 t}{\\tau_{b}}\\right) \\left(\\frac{d\\alpha}{dt}\\right)^{2} \\, dt\n$$\nsubject to the boundary conditions $\\alpha(0) = 0$ and $\\alpha(T) = \\alpha_f$. This is a standard problem in the calculus of variations. The function $\\alpha(t)$ that minimizes this integral must satisfy the Euler-Lagrange equation.\n\nThe integrand, which we identify as the Lagrangian $L$, is a function of $t$ and $\\alpha' \\equiv \\frac{d\\alpha}{dt}$:\n$$\nL(t, \\alpha, \\alpha') = K \\exp\\left(-\\frac{2t}{\\tau_b}\\right) (\\alpha')^2\n$$\nThe Euler-Lagrange equation is given by\n$$\n\\frac{\\partial L}{\\partial \\alpha} - \\frac{d}{dt}\\left(\\frac{\\partial L}{\\partial \\alpha'}\\right) = 0\n$$\nTo apply this equation, we require that the solution $\\alpha(t)$ be at least twice continuously differentiable, i.e., $\\alpha(t) \\in C^2[0, T]$.\n\nFirst, we compute the partial derivatives of $L$:\nThe partial derivative with respect to $\\alpha$ is\n$$\n\\frac{\\partial L}{\\partial \\alpha} = 0\n$$\nsince $L$ does not explicitly depend on $\\alpha(t)$.\n\nThe partial derivative with respect to $\\alpha'$ is\n$$\n\\frac{\\partial L}{\\partial \\alpha'} = K \\exp\\left(-\\frac{2t}{\\tau_b}\\right) \\cdot (2\\alpha') = 2K \\exp\\left(-\\frac{2t}{\\tau_b}\\right) \\frac{d\\alpha}{dt}\n$$\nSubstituting these into the Euler-Lagrange equation gives:\n$$\n0 - \\frac{d}{dt}\\left(2K \\exp\\left(-\\frac{2t}{\\tau_b}\\right) \\frac{d\\alpha}{dt}\\right) = 0\n$$\nSince $2K$ is a non-zero constant, we can divide it out, yielding a simpler differential equation:\n$$\n\\frac{d}{dt}\\left(\\exp\\left(-\\frac{2t}{\\tau_b}\\right) \\frac{d\\alpha}{dt}\\right) = 0\n$$\nThis equation implies that the quantity inside the derivative must be a constant. Integrating with respect to $t$, we get:\n$$\n\\exp\\left(-\\frac{2t}{\\tau_b}\\right) \\frac{d\\alpha}{dt} = C_1\n$$\nwhere $C_1$ is the first constant of integration.\n\nTo find $\\alpha(t)$, we first solve for $\\frac{d\\alpha}{dt}$:\n$$\n\\frac{d\\alpha}{dt} = C_1 \\exp\\left(\\frac{2t}{\\tau_b}\\right)\n$$\nNow, we integrate this equation with respect to $t$ to find $\\alpha(t)$:\n$$\n\\alpha(t) = \\int C_1 \\exp\\left(\\frac{2t}{\\tau_b}\\right) dt = C_1 \\left(\\frac{\\tau_b}{2}\\right) \\exp\\left(\\frac{2t}{\\tau_b}\\right) + C_2\n$$\nwhere $C_2$ is the second constant of integration.\n\nNext, we apply the given boundary conditions to determine the constants $C_1$ and $C_2$.\nThe first condition is $\\alpha(0) = 0$:\n$$\n\\alpha(0) = C_1 \\left(\\frac{\\tau_b}{2}\\right) \\exp(0) + C_2 = C_1 \\frac{\\tau_b}{2} + C_2 = 0\n$$\nThis gives $C_2 = -C_1 \\frac{\\tau_b}{2}$. We can substitute this back into the solution for $\\alpha(t)$:\n$$\n\\alpha(t) = C_1 \\frac{\\tau_b}{2} \\exp\\left(\\frac{2t}{\\tau_b}\\right) - C_1 \\frac{\\tau_b}{2} = C_1 \\frac{\\tau_b}{2} \\left( \\exp\\left(\\frac{2t}{\\tau_b}\\right) - 1 \\right)\n$$\nThe second condition is $\\alpha(T) = \\alpha_f$:\n$$\n\\alpha(T) = C_1 \\frac{\\tau_b}{2} \\left( \\exp\\left(\\frac{2T}{\\tau_b}\\right) - 1 \\right) = \\alpha_f\n$$\nFrom this, we can solve for the constant quantity $C_1 \\frac{\\tau_b}{2}$:\n$$\nC_1 \\frac{\\tau_b}{2} = \\frac{\\alpha_f}{\\exp\\left(\\frac{2T}{\\tau_b}\\right) - 1}\n$$\nFinally, we substitute this expression back into the equation for $\\alpha(t)$ to obtain the optimal ramp function:\n$$\n\\alpha(t) = \\frac{\\alpha_f}{\\exp\\left(\\frac{2T}{\\tau_b}\\right) - 1} \\left( \\exp\\left(\\frac{2t}{\\tau_b}\\right) - 1 \\right)\n$$\nThis can be rewritten as:\n$$\n\\alpha(t) = \\alpha_f \\frac{\\exp\\left(\\frac{2t}{\\tau_b}\\right) - 1}{\\exp\\left(\\frac{2T}{\\tau_b}\\right) - 1}\n$$\nTo confirm that this solution corresponds to a minimum, we can check the Legendre necessary condition, which for this problem states that $\\frac{\\partial^2 L}{\\partial (\\alpha')^2} \\ge 0$.\n$$\n\\frac{\\partial^2 L}{\\partial (\\alpha')^2} = \\frac{\\partial}{\\partial \\alpha'} \\left( 2K \\exp\\left(-\\frac{2t}{\\tau_b}\\right) \\alpha' \\right) = 2K \\exp\\left(-\\frac{2t}{\\tau_b}\\right)\n$$\nSince $K > 0$ and the exponential function is always positive, $\\frac{\\partial^2 L}{\\partial (\\alpha')^2} > 0$ for all $t \\in [0, T]$. This, along with the nature of the problem (a convex functional), ensures that the derived path $\\alpha(t)$ is indeed the unique global minimizer for the energy functional $E[\\alpha]$.\nThe final expression provides the analytic form for the optimal ramp of the feedback coefficient $\\alpha(t)$ on the interval $[0, T]$.",
            "answer": "$$\n\\boxed{\\alpha_f \\frac{\\exp\\left(\\frac{2t}{\\tau_b}\\right) - 1}{\\exp\\left(\\frac{2T}{\\tau_b}\\right) - 1}}\n$$"
        }
    ]
}