{
    "hands_on_practices": [
        {
            "introduction": "在评估海洋模型对特定事件（如浪高超阈值）的“是/否”预测时，简单的准确率可能会产生误导，因为它未考虑随机猜对的可能性。公平威胁评分（Equitable Threat Score, ETS）等技巧评分通过从预报成功总数中扣除随机成功的次数，为我们提供了一个更稳健的衡量标准。这项练习将引导您推导并计算ETS，从而深入理解如何评估分类预报的真实技巧。",
            "id": "3799780",
            "problem": "一个数值波浪模型针对浮标观测数据进行验证，以检验其对有效波高超过 $6 \\ \\mathrm{m}$ 这一固定阈值的预报能力。验证使用了 $N = 5000$ 个独立的预报-观测并置点。每个并置点根据以下规则被归入一个 $2 \\times 2$ 列联表：如果预报和观测都超过阈值，则为命中（$H$）；如果观测超过阈值但预报未超过，则为漏报（$M$）；如果预报超过阈值但观测未超过，则为空报（$F$）；其他情况则为正确拒绝（$C$）。在本次验证实验中，各项计数为 $H = 150$，$M = 90$，$F = 150$，而 $C$ 由 $C = N - H - M - F$ 计算得出。\n\n任务：\n1. 从联合概率和边缘概率的定义出发，假设在无技巧（随机）预报下，预报与观测之间统计独立，推导出随机命中预期数 $H_{r}$ 关于 $H$、$M$、$F$ 和 $N$ 的表达式。然后，利用此表达式推导出公平威胁评分 (ETS)，该评分对威胁评分中的随机命中进行了修正。\n2. 在阈值超越检测的背景下，用 $H$、$M$、$F$ 和 $C$ 定义命中率和空报率，并明确每种率所依赖的条件事件基数。\n3. 使用上述计数，计算公平威胁评分 (ETS)。将最终的 ETS 结果表示为小数，并四舍五入到四位有效数字。最终答案中不要包含百分号或任何单位。",
            "solution": "问题陈述已经过验证，被认为是具有科学依据、提法得当、客观且完整的。我们可以着手解决。该问题按要求分为三部分进行解答。\n\n用于二分类（是/否）预报检验的列联表由以下计数定义：\n- $H$：命中（预报=是，观测=是）\n- $M$：漏报（预报=否，观测=是）\n- $F$：空报（预报=是，观测=否）\n- $C$：正确拒绝（预报=否，观测=否）\n样本总数为 $N = H + M + F + C$。\n\n**1. 随机命中（$H_r$）与公平威胁评分（ETS）的推导**\n\n设 $O$ 为观测值超过阈值的事件， $F_c$ 为预报值超过阈值的事件。根据 $N$ 个样本，我们可以估计这些事件发生的边缘概率。观测到超越阈值的经验概率是观测到的超越阈值总数 $H+M$ 除以总样本量 $N$：\n$$P(O) = \\frac{H + M}{N}$$\n类似地，预报超越阈值的经验概率（预报的气候学频率或偏差）是预报的超越阈值总数 $H+F$ 除以 $N$：\n$$P(F_c) = \\frac{H + F}{N}$$\n“无技巧”或纯随机预报是指预报事件与观测事件在统计上是独立的。在独立性假设下，一次命中（事件同时被预报和观测到）的联合概率是边缘概率的乘积：\n$$P(\\text{random hit}) = P(O \\cap F_c) = P(O) \\times P(F_c)$$\n在大小为 $N$ 的样本中，随机命中的期望数 $H_r$ 是 $N$ 乘以这个联合概率：\n$$H_r = N \\times P(\\text{random hit}) = N \\times \\left(\\frac{H + M}{N}\\right) \\times \\left(\\frac{H + F}{N}\\right)$$\n$$H_r = \\frac{(H + M)(H + F)}{N}$$\n这是在给定观测和预报事件频率的情况下，由于随机机会导致的命中期望数的表达式。\n\n威胁评分 (TS)，也称为临界成功指数 (CSI)，衡量的是相对于事件被预报或观测到的案例集合的预报准确性。其定义为：\n$$TS = \\frac{H}{H + M + F}$$\n公平威胁评分 (ETS)，也称为吉尔伯特技巧评分 (GSS)，通过修正纯粹由随机机会所期望产生的命中，对 TS 进行了改进。技巧评分衡量的是预报相对于参考预报（在此情况下为随机预报）的改进程度。技巧评分的通用公式是：\n$$\\text{Skill Score} = \\frac{\\text{Score}_{\\text{forecast}} - \\text{Score}_{\\text{random}}}{\\text{Score}_{\\text{perfect}} - \\text{Score}_{\\text{random}}}$$\n在命中的情境下，“评分”就是命中次数。\n- 预报的命中次数为 $H$。\n- 随机预报的期望命中次数为 $H_r$。\n- 对于完美预报，所有事件都将被命中，不存在漏报（$M=0$）或空报（$F=0$）。事件总数是 $H+M+F$。因此，完美预报会将所有这些事件都命中。TS 的分母是观测事件和预报事件的并集。所以完美评分的潜在命中数是 $H+M+F$。\n可归因于预报技巧的命中数是实际命中数减去随机期望的命中数：$H - H_r$。这构成了 ETS 的分子。\n分母代表了可以展示技巧的事件总数。这是预报或观测到的事件总集合 $H+M+F$ 减去随机期望的命中数 $H_r$。通过从分母中移除 $H_r$，我们是在评估那些不能用随机机会解释的事件集合上的技巧。\n因此，公平威胁评分的表达式为：\n$$ETS = \\frac{H - H_r}{H + M + F - H_r}$$\n\n**2. 命中率和空报率的定义**\n\n命中率 (HR)，也称为探测概率 (POD) 或召回率，是指被正确预报的观测事件所占的比例。它定义为命中次数除以观测事件总数。\n$$HR = \\frac{H}{H+M}$$\n命中率的条件事件基数是所有观测值超过阈值的案例集合。\n\n空报率 (FARate)，也称为虚警概率 (POFD)，是指在未观测到事件的情况下，被错误预报为事件的案例所占的比例。它定义为空报次数除以事件未被观测到的案例总数。\n$$FARate = \\frac{F}{F+C}$$\n空报率的条件事件基数是所有观测值未超过阈值的案例集合。它不应与空报*比率*相混淆，后者的表达式为 $F/(H+F)$，并且是以事件被预报为条件。\n\n**3. 公平威胁评分 (ETS) 的计算**\n\n我们从验证实验中得到了以下计数：\n- $H = 150$\n- $M = 90$\n- $F = 150$\n- $N = 5000$\n\n首先，我们计算正确拒绝的次数 $C$：\n$$C = N - H - M - F = 5000 - 150 - 90 - 150 = 5000 - 390 = 4610$$\n接着，我们使用第 1 部分推导的公式计算随机命中的期望数 $H_r$。我们需要边际总数：\n- 观测事件总数：$H + M = 150 + 90 = 240$\n- 预报事件总数：$H + F = 150 + 150 = 300$\n现在，我们计算 $H_r$：\n$$H_r = \\frac{(H + M)(H + F)}{N} = \\frac{240 \\times 300}{5000} = \\frac{72000}{5000} = 14.4$$\n最后，我们使用推导出的公式计算 ETS：\n$$ETS = \\frac{H - H_r}{H + M + F - H_r}$$\n事件总数（预报或观测到的）是 $H + M + F = 150 + 90 + 150 = 390$。\n将数值代入 ETS 公式：\n$$ETS = \\frac{150 - 14.4}{390 - 14.4} = \\frac{135.6}{375.6}$$\n进行除法计算并四舍五入到四位有效数字：\n$$ETS \\approx 0.36102236...$$\n$$ETS \\approx 0.3610$$",
            "answer": "$$\\boxed{0.3610}$$"
        },
        {
            "introduction": "像全局平均偏差这样的单一汇总指标可能会掩盖模型中存在的复杂误差结构，例如模型在冷水区系统性偏高而在暖水区系统性偏低。通过分析依赖于观测状态的条件偏差，我们可以揭示这些隐藏的缺陷。这项动手编程练习将教您如何诊断和量化非线性偏差，从而对模型的行为获得更深刻的见解。",
            "id": "3799836",
            "problem": "给定海表温度（SST）的模型输出和观测值的配对序列，分别表示为 $M_i$ 和 $O_i$，$i=1,\\dots,N$。时间索引 $i$ 处的误差定义为 $e_i = M_i - O_i$，单位为摄氏度（Celsius）。目标是通过计算作为观测状态函数的全局偏差和条件偏差来验证模型，并诊断仅考虑全局偏差时被掩盖的非线性偏差结构。\n\n从条件期望的基本定义出发，条件偏差函数 $b(o)$ 定义为 $b(o) = \\mathbb{E}[e \\mid O = o]$。由于在有限样本下直接评估 $\\mathbb{E}[e \\mid O = o]$ 是不切实际的，您必须使用观测状态 $O$ 上的分箱来估计 $b(o)$。为此：\n- 将观测值 $\\{O_i\\}$ 划分为 $K$ 个分位数分箱（等频分箱），其中 $K=6$。设这些分箱由边界 $q_0, q_1, \\dots, q_6$ 定义，其中 $q_j$ 是 $\\{O_i\\}$ 的 $j/6$ 阶经验分位数。对于每个分箱 $j$，计算条件偏差估计值 $b_j$，即 $\\{e_i: O_i \\in [q_{j-1}, q_j)\\}$ 的样本均值，并将最后一个分箱视为 $[q_5, q_6]$ 以包含最大值。设条件偏差范围为 $R = \\max_j b_j - \\min_j b_j$，单位为摄氏度（Celsius）。\n- 计算全局偏差 $B = \\frac{1}{N}\\sum_{i=1}^N e_i$，单位同样为摄氏度（Celsius）。\n\n为诊断非线性偏差结构，将误差建模为观测状态的多项式函数，\n$$\ne_i = a_0 + a_1 O_i + a_2 O_i^2 + \\varepsilon_i,\n$$\n并通过最小二乘法估计系数 $\\hat{a}_0, \\hat{a}_1, \\hat{a}_2$。使用经典的嵌套模型 $F$-检验，将二次模型与嵌套的线性模型\n$$\ne_i = c_0 + c_1 O_i + \\eta_i\n$$\n进行比较。设 $\\mathrm{SSE}_1$ 和 $\\mathrm{SSE}_2$ 分别是线性和二次模型的残差平方和，线性模型有 $p_1=2$ 个参数，二次模型有 $p_2=3$ 个参数。对于 $N$ 个样本，计算检验统计量\n$$\nF = \\frac{\\left(\\mathrm{SSE}_1 - \\mathrm{SSE}_2\\right)/(p_2 - p_1)}{\\mathrm{SSE}_2/(N - p_2)},\n$$\n并在具有 $(p_2 - p_1, N - p_2)$ 自由度的 Fisher-Snedecor 分布（F 分布）下计算其$p$-值。一个小的$p$-值表示包含二次项显著改善了拟合效果，从而诊断出非线性偏差。报告 $\\hat{a}_2$（单位为摄氏度每平方摄氏度，Celsius per Celsius$^2$）和在 $[0,1]$ 范围内的十进制$p$-值。\n\n您的程序必须实现上述过程，并将其应用于以下测试套件。在每个测试用例中，应根据指定的规则综合生成观测值和模型输出。所有 SST 值都以摄氏度（Celsius）为单位，噪声为零均值高斯噪声。\n\n测试套件（四个用例）：\n1. 具有近零全局偏差的非线性偏差：\n   - 样本大小 $N = 2000$。\n   - 观测值 $O_i$ 独立地从 $[10, 30]$ 上的均匀分布中抽取。\n   - 确定性偏差项 $d(O_i) = 0.02\\,(O_i - 20)^2 - c$，其中 $c$ 是在 $O \\sim \\mathrm{Uniform}(10, 30)$ 条件下 $0.02\\,(O - 20)^2$ 的解析均值，即 $c = 0.02 \\times \\mathrm{Var}(O) = 0.02 \\times \\frac{(30-10)^2}{12}$。\n   - 噪声标准差 $\\sigma = 0.1$。模型输出 $M_i = O_i + d(O_i) + \\epsilon_i$，其中 $\\epsilon_i \\sim \\mathcal{N}(0, \\sigma^2)$。\n\n2. 纯线性偏差：\n   - 样本大小 $N = 2000$。\n   - 观测值 $O_i \\sim \\mathrm{Uniform}(5, 30)$。\n   - 确定性偏差项 $d(O_i) = 0.5 + 0.03\\,(O_i - 17.5)$。\n   - 噪声标准差 $\\sigma = 0.15$。模型输出 $M_i = O_i + d(O_i) + \\epsilon_i$。\n\n3. 具有随机噪声的无偏模型：\n   - 样本大小 $N = 2000$。\n   - 观测值 $O_i \\sim \\mathrm{Uniform}(5, 30)$。\n   - 确定性偏差项 $d(O_i) = 0$。\n   - 噪声标准差 $\\sigma = 0.2$。模型输出 $M_i = O_i + \\epsilon_i$。\n\n4. 异方差噪声和以零均值为中心的细微二次偏差：\n   - 样本大小 $N = 80$。\n   - 首先通过抽样 $X_i \\sim \\mathrm{Beta}(\\alpha=2,\\beta=5)$，然后设置 $O_i = 5 + 25 X_i$ 将其映射到 $[5, 30]$，从而得出观测值 $O_i$。\n   - 确定性偏差项 $d(O_i) = 0.015\\,(O_i - 15)^2 - c$，其中 $c$ 在此用例中被数值上选择为 $0.015\\,(O_i - 15)^2$ 在已实现的 $\\{O_i\\}$ 上的样本均值，以使确定性偏差的全局均值接近于零。\n   - 噪声标准差取决于 $O_i$，为 $\\sigma_i = 0.05 + 0.01\\,(O_i - 5)$。\n   - 模型输出 $M_i = O_i + d(O_i) + \\epsilon_i$，其中 $\\epsilon_i \\sim \\mathcal{N}(0, \\sigma_i^2)$。\n\n对于每个测试用例，计算：\n- 全局偏差 $B$，单位为摄氏度（Celsius）。\n- 条件偏差范围 $R$，单位为摄氏度（Celsius）。\n- 估计的二次系数 $\\hat{a}_2$，单位为摄氏度每平方摄氏度（Celsius per Celsius$^2$）。\n- 嵌套模型$F$-检验的$p$-值（以十进制表示）。\n\n角度单位不适用于此问题。所有物理量必须以指定的单位处理。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，格式如下：\n- 对于每个测试用例，输出列表 $[B, R, \\hat{a}_2, p]$。\n- 将四个测试用例的结果汇总到一个列表中，产生类似 $[[B_1,R_1,\\hat{a}_{2,1},p_1],[B_2,R_2,\\hat{a}_{2,2},p_2],[B_3,R_3,\\hat{a}_{2,3},p_3],[B_4,R_4,\\hat{a}_{2,4},p_4]]$ 的输出。",
            "solution": "问题陈述已经过分析，并被确定为有效。它在科学上基于用于模型验证的标准统计和数值方法，其提法是适定的，指令清晰明确，并以客观、正式的语言表述。所有必要的数据、参数和程序都已提供，以构建一个唯一且可验证的解决方案。\n\n该问题要求实现一个统计验证程序，用于对照观测数据验证海表温度（SST）模型。此过程涉及量化模型误差或偏差的不同方面，定义为 $e_i = M_i - O_i$，其中 $M_i$ 是模型输出，$O_i$ 是观测值。对每个测试用例的分析包括三个主要部分：计算全局偏差、估计条件偏差，以及基于回归的非线性偏差结构诊断。\n\n首先，我们根据指定的随机模型为四个测试用例中的每一个生成合成数据序列 $\\{O_i\\}_{i=1}^N$ 和 $\\{M_i\\}_{i=1}^N$。然后将误差序列 $\\{e_i\\}_{i=1}^N$ 计算为它们的差值。\n\n全局偏差 $B$ 是最简单的模型性能度量，定义为所有误差的均值：\n$$\nB = \\frac{1}{N}\\sum_{i=1}^N e_i\n$$\n接近于零的 $B$ 值表明，平均而言，该模型没有系统性地高估或低估观测值。然而，零全局偏差可能掩盖显著的状态依赖性误差。\n\n为揭示此类结构，我们估计条件偏差 $b(o) = \\mathbb{E}[e \\mid O = o]$，即在给定特定观测值 $o$ 下的期望误差。由于在有限数据下精确的条件期望是难以处理的，我们通过对数据进行分箱来近似它。观测到的 SST 值范围被划分为 $K=6$ 个等频（分位数）分箱。分箱边界由观测序列 $\\{O_i\\}$ 的经验分位数确定。设基于分位数的边界为 $q_0, q_1, \\dots, q_K$，其中 $q_j$ 是 $j/K$ 阶的经验分位数。第 $j$ 个分箱（$j=1, \\dots, K$）的条件偏差估计为相应观测值落入该分箱内的误差的样本均值：\n$$\nb_j = \\text{mean}\\{e_i \\mid O_i \\in [q_{j-1}, q_j') \\}\n$$\n其中当 $j  K$ 时区间为 $[q_{j-1}, q_j)$，当 $j=K$ 时为 $[q_{K-1}, q_K]$，以确保包含最大观测值。条件偏差范围 $R = \\max_j b_j - \\min_j b_j$ 量化了偏差在系统不同状态下变化的幅度。相对于全局偏差 $B$ 而言较大的 $R$ 值表示存在显著的状态依赖性偏差结构。\n\n最后，为了正式诊断和量化非线性偏差，我们将误差 $e_i$ 建模为观测值 $O_i$ 的多项式函数。我们通过普通最小二乘法（OLS）拟合一个二次模型：\n$$\ne_i = a_0 + a_1 O_i + a_2 O_i^2 + \\varepsilon_i\n$$\n估计系数 $\\hat{a}_2$ 提供了偏差凹凸性的直接度量。非零的 $\\hat{a}_2$ 表明模型误差随观测到的 SST 呈二次变化。为评估此二次项的统计显著性，我们执行一个嵌套模型 $F$-检验，将完整的二次模型（含 $p_2=3$ 个参数：$a_0, a_1, a_2$）与一个更简单的嵌套线性模型（含 $p_1=2$ 个参数：$c_0, c_1$）进行比较：\n$$\ne_i = c_0 + c_1 O_i + \\eta_i\n$$\n$F$-统计量由线性模型（$\\mathrm{SSE}_1$）和二次模型（$\\mathrm{SSE}_2$）的残差平方和（SSE）计算得出：\n$$\nF = \\frac{(\\mathrm{SSE}_1 - \\mathrm{SSE}_2)/(p_2 - p_1)}{\\mathrm{SSE}_2/(N - p_2)}\n$$\n在二次项为零的原假设（$H_0: a_2 = 0$）下，该统计量服从具有 $(p_2 - p_1, N - p_2)$ 自由度的 $F$-分布。与此 $F$-统计量相关的$p$-值表示，如果真实关系是线性的，偶然观察到拟合度有如此改善（从线性到二次）的概率。一个小的$p$-值（例如，$  0.05$）为反对原假设提供了强有力的证据，证实了显著非线性偏差结构的存在。\n\n将此完整程序应用于四个指定的测试用例中的每一个。所需的输出——全局偏差 $B$、条件偏差范围 $R$、二次系数 $\\hat{a}_2$ 以及$F$-检验的$p$-值——被计算和汇总。值得注意的是，对于用例 4，OLS 的同方差性假设被设计所违反（$\\sigma_i$ 依赖于 $O_i$）。虽然 OLS 系数估计值保持无偏，但从标准 $F$-检验得出的$p$-值应谨慎解释。然而，计算是按规定执行的。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import f as f_dist\n\ndef solve():\n    \"\"\"\n    Main function to run the validation procedure for all test cases.\n    \"\"\"\n\n    # Using a fixed seed for reproducibility of the random process.\n    rng = np.random.default_rng(seed=42)\n\n    test_cases = [\n        # Case 1: Nonlinear bias with near-zero global bias\n        {\n            \"N\": 2000,\n            \"O_dist\": lambda n: rng.uniform(10, 30, size=n),\n            \"d_func\": lambda O: 0.02 * (O - 20)**2 - (0.02 * (30 - 10)**2 / 12),\n            \"sigma\": 0.1,\n            \"heteroscedastic\": False\n        },\n        # Case 2: Pure linear bias\n        {\n            \"N\": 2000,\n            \"O_dist\": lambda n: rng.uniform(5, 30, size=n),\n            \"d_func\": lambda O: 0.5 + 0.03 * (O - 17.5),\n            \"sigma\": 0.15,\n            \"heteroscedastic\": False\n        },\n        # Case 3: Unbiased model with random noise\n        {\n            \"N\": 2000,\n            \"O_dist\": lambda n: rng.uniform(5, 30, size=n),\n            \"d_func\": lambda O: 0.0,\n            \"sigma\": 0.2,\n            \"heteroscedastic\": False\n        },\n        # Case 4: Heteroscedastic noise and subtle quadratic bias\n        {\n            \"N\": 80,\n            \"O_dist\": lambda n: 5 + 25 * rng.beta(2, 5, size=n),\n            \"d_func\": \"special\", # Handle this case inside the loop\n            \"sigma_func\": lambda O: 0.05 + 0.01 * (O - 5),\n            \"heteroscedastic\": True\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        N = case[\"N\"]\n        K = 6\n\n        # 1. Generate synthetic data\n        O = case[\"O_dist\"](N)\n        \n        if case[\"heteroscedastic\"]:\n            if case[\"d_func\"] == \"special\":\n                # As per problem, c is sample mean for this case\n                T = 0.015 * (O - 15)**2\n                c = np.mean(T)\n                d = T - c\n            sigma_i = case[\"sigma_func\"](O)\n            epsilon = rng.normal(0, sigma_i, size=N)\n        else:\n            d = case[\"d_func\"](O)\n            sigma = case[\"sigma\"]\n            epsilon = rng.normal(0, sigma, size=N)\n        \n        # Error is the deterministic bias plus random noise\n        e = d + epsilon\n\n        # 2. Calculate global bias B\n        B = np.mean(e)\n\n        # 3. Calculate conditional bias range R\n        q_edges = np.quantile(O, np.linspace(0, 1, K + 1))\n        \n        b_means = []\n        for j in range(1, K + 1):\n            if j  K:\n                # Interval [q_{j-1}, q_j)\n                indices = (O >= q_edges[j-1])  (O  q_edges[j])\n            else:\n                # Last bin [q_{K-1}, q_K] inclusive\n                indices = (O >= q_edges[j-1])  (O = q_edges[j])\n            \n            # Handle potentially empty bins if quantiles are not unique\n            if np.any(indices):\n                b_means.append(np.mean(e[indices]))\n            else:\n                # Append nan for empty bin, will be ignored by max/min\n                b_means.append(np.nan)\n        \n        b_means = np.array(b_means)\n        R = np.nanmax(b_means) - np.nanmin(b_means)\n        \n        # 4. Polynomial regression and F-test\n        p1, p2 = 2, 3\n\n        # Linear model: e = c0 + c1*O\n        X1 = np.vstack([O, np.ones(N)]).T\n        _, sse1_list, _, _ = np.linalg.lstsq(X1, e, rcond=None)\n        sse1 = sse1_list[0] if len(sse1_list) > 0 else 0.0\n\n        # Quadratic model: e = a0 + a1*O + a2*O^2\n        X2 = np.vstack([O**2, O, np.ones(N)]).T\n        coeffs2, sse2_list, _, _ = np.linalg.lstsq(X2, e, rcond=None)\n        a2_hat = coeffs2[0]\n        sse2 = sse2_list[0] if len(sse2_list) > 0 else 0.0\n        \n        # F-test\n        df1 = p2 - p1\n        df2 = N - p2\n        \n        if df2 > 0 and sse2 > 1e-12: # Check forvalid degrees of freedom and non-zero denominator\n            f_stat = ((sse1 - sse2) / df1) / (sse2 / df2)\n            p_value = f_dist.sf(f_stat, df1, df2)\n        else: # Handle degenerate cases\n            f_stat = np.nan\n            p_value = np.nan\n\n        results.append([B, R, a2_hat, p_value])\n    \n    # Format the final output precisely as requested\n    formatted_results = ','.join([str(res) for res in results])\n    print(f\"[{formatted_results}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "海洋学时间序列数据普遍存在序列相关性，这意味着数据点之间并非相互独立，这违反了许多标准统计检验的基本假设。忽略这种自相关性会导致我们对模型技巧的评估过于自信，例如得出过窄的置信区间。本练习将通过推导“有效样本量” $N_{\\text{eff}}$ 来解决这一关键问题，并用它来校正相关性技巧评分的置信区间，从而进行更严谨的统计推断。",
            "id": "3799822",
            "problem": "一个区域海洋环流模型通过与一个西边界流区域的卫星衍生海表温度（SST）异常进行对比验证。设 $M_t$ 表示月度模型异常，$O_t$ 表示月度观测异常，两者均以固定的月度间隔采样，共计 $N=120$ 个月。这些异常值近似为零均值、弱平稳且服从联合高斯分布。$M_t$ 和 $O_t$ 之间的样本皮尔遜相关系数为 $r=0.65$。两个序列都表现出与一阶自回归（AR(1)）过程一致的序列相关性，其中 $M_t$ 的滞后1阶自相关为 $\\phi_M=0.6$，$O_t$ 的滞后1阶自相关为 $\\phi_O=0.8$。\n\n您将推导一个考虑了序列相关的有效样本量，并用它来调整相关技巧度量的置信区间。请按以下步骤进行：\n\n1. 从具有依赖性的时间序列的有效基础出发，使用自相关函数的定义和相关随机变量和的方差来论证为Fisher z变换后的相关性构建有效样本量 $N_{\\text{eff}}$ 的合理性。特别地，回想一下，对于独立样本，Fisher变换 $z=\\operatorname{arctanh}(r)$ 近似服从正态分布，其方差为 $1/(N-3)$。对于相关样本，通过将相关情况下的 $z$ 的方差与独立样本的形式进行匹配来定义 $N_{\\text{eff}}$。\n\n2. 在上述AR(1)假设下，推导出以 $N$、$\\phi_M$ 和 $\\phi_O$ 表示的 $N_{\\text{eff}}$ 的闭式解析表达式。\n\n3. 使用您推导出的 $N_{\\text{eff}}$，通过应用Fisher z变换和正态分位数来构建真实相关的 $95\\%$ 置信区间的下界。以小数形式表示最终的下界。将您的最终数值答案四舍五入到四位有效数字。\n\n您的最终答案无需物理单位。",
            "solution": "该问题要求推导有效样本量 $N_{\\text{eff}}$，用于计算两个自相关时间序列之间相关系数的置信区间。这将分三步完成：论证 $N_{\\text{eff}}$ 形式的合理性，为一阶自回归（AR(1)）过程推导特定公式，最后计算给定数据的 $95\\%$ 置信区间的下界。\n\n**步骤1：有效样本量 $N_{\\text{eff}}$ 的合理性论证**\n\n起点是样本皮尔逊相关系数 $r$ 的Fisher z变换：\n$$ z = \\operatorname{arctanh}(r) = \\frac{1}{2} \\ln\\left(\\frac{1+r}{1-r}\\right) $$\n对于具有 $N$ 个独立配对样本的两个联合高斯随机变量，$z$ 的抽样分布近似为正态分布，其均值为 $\\operatorname{arctanh}(\\rho)$（其中 $\\rho$ 是真实总体相关性），方差由下式给出：\n$$ \\operatorname{Var}(z) \\approx \\frac{1}{N-3} $$\n当时间序列 $M_t$ 和 $O_t$ 在时间上不是独立的（即它们表现出序列相关性）时，样本就不是独立的，此时 $z$ 的方差大于独立样本公式给出的方差。为了解释这种方差膨胀，引入了有效样本量 $N_{\\text{eff}}$ 的概念。我们定义 $N_{\\text{eff}}$，使得相关样本的 $z$ 的方差可以表示为与独立情况类似的形式：\n$$ \\operatorname{Var}_{\\text{dep}}(z) \\approx \\frac{1}{N_{\\text{eff}}-3} $$\n对于大样本量，两个自相关时间序列的 $z$ 的方差可以通过将独立方差乘以一个取决于两个序列自相关函数 $\\rho_M(k)$ 和 $\\rho_O(k)$ 的因子来很好地近似。这导出了以下关系：\n$$ \\operatorname{Var}_{\\text{dep}}(z) \\approx \\frac{1}{N} \\sum_{k=-\\infty}^{\\infty} \\rho_M(k) \\rho_O(k) $$\n将这个大$N$近似与标准形式 $\\operatorname{Var}(z) \\approx 1/N_{\\text{eff}}$ 进行比较，引出了以下关于 $N_{\\text{eff}}$ 的定义：\n$$ \\frac{1}{N_{\\text{eff}}} \\approx \\frac{1}{N} \\sum_{k=-(N-1)}^{N-1} \\rho_M(k) \\rho_O(k) $$\n其中，对于有限样本量 $N$，该和被截断。注意到 $\\rho(k) = \\rho(-k)$ 和 $\\rho(0)=1$，这可以改写为：\n$$ \\frac{N}{N_{\\text{eff}}} \\approx 1 + 2 \\sum_{k=1}^{N-1} \\rho_M(k) \\rho_O(k) $$\n该表达式为构建 $N_{\\text{eff}}$ 提供了理论依据。它有效地表示了为得到目标统计量（此处为Fisher变换后的相关性）的正确方差，样本数量必须减少的因子。对于大$N$，近似式 $\\frac{N-3}{N_{\\text{eff}}-3} \\approx \\frac{N}{N_{\\text{eff}}}$ 成立，从而验证了这种方法的有效性。\n\n**步骤2：AR(1)过程的 $N_{\\text{eff}}$ 推导**\n\n问题陈述两个时间序列 $M_t$ 和 $O_t$ 都遵循AR(1)过程。对于滞后1阶自相关为 $\\phi$ 的平稳AR(1)过程，其自相关函数由 $\\rho(k) = \\phi^{|k|}$ 给出，其中 $k$ 为整数滞后。\n给定 $\\rho_M(1) = \\phi_M = 0.6$ 和 $\\rho_O(1) = \\phi_O = 0.8$。因此，对于 $k \\ge 0$，自相关函数为 $\\rho_M(k) = \\phi_M^k$ 和 $\\rho_O(k) = \\phi_O^k$。\n\n我们将这些代入步骤1中的求和式。对于大样本量 $N$（此处 $N=120$ 足够大），我们可以用无穷和来近似有限和：\n$$ \\sum_{k=1}^{N-1} \\rho_M(k) \\rho_O(k) = \\sum_{k=1}^{N-1} (\\phi_M \\phi_O)^k \\approx \\sum_{k=1}^{\\infty} (\\phi_M \\phi_O)^k $$\n这是一个首项和公比均为 $\\phi_M \\phi_O$ 的无穷几何级数。因为 $|\\phi_M|  1$ 且 $|\\phi_O|  1$，所以有 $|\\phi_M \\phi_O|  1$，级数收敛于：\n$$ \\sum_{k=1}^{\\infty} (\\phi_M \\phi_O)^k = \\frac{\\phi_M \\phi_O}{1 - \\phi_M \\phi_O} $$\n将此结果代回 $N_{\\text{eff}}$ 的表达式中：\n$$ \\frac{N}{N_{\\text{eff}}} \\approx 1 + 2 \\left( \\frac{\\phi_M \\phi_O}{1 - \\phi_M \\phi_O} \\right) = \\frac{(1 - \\phi_M \\phi_O) + 2 \\phi_M \\phi_O}{1 - \\phi_M \\phi_O} = \\frac{1 + \\phi_M \\phi_O}{1 - \\phi_M \\phi_O} $$\n对该表达式求逆，得到有效样本量的闭式解析公式：\n$$ N_{\\text{eff}} \\approx N \\frac{1 - \\phi_M \\phi_O}{1 + \\phi_M \\phi_O} $$\n\n**步骤3：95%置信区间下界的计算**\n\n给定以下数值：\n-   样本量：$N = 120$\n-   样本相关系数：$r = 0.65$\n-   AR(1)系数：$\\phi_M = 0.6$ 和 $\\phi_O = 0.8$\n\n首先，我们计算AR(1)系数的乘积：\n$$ \\phi_M \\phi_O = 0.6 \\times 0.8 = 0.48 $$\n接下来，我们使用推导出的公式计算有效样本量 $N_{\\text{eff}}$：\n$$ N_{\\text{eff}} = 120 \\frac{1 - 0.48}{1 + 0.48} = 120 \\frac{0.52}{1.48} = 120 \\frac{13}{37} = \\frac{1560}{37} \\approx 42.16216 $$\n现在，我们对样本相关系数 $r=0.65$ 进行Fisher z变换：\n$$ z = \\operatorname{arctanh}(0.65) = \\frac{1}{2}\\ln\\left(\\frac{1+0.65}{1-0.65}\\right) = \\frac{1}{2}\\ln\\left(\\frac{1.65}{0.35}\\right) = \\frac{1}{2}\\ln\\left(\\frac{33}{7}\\right) \\approx 0.77530 $$\n$z$ 的标准误 $\\sigma_z$ 使用 $N_{\\text{eff}}$ 计算：\n$$ \\sigma_z = \\sqrt{\\frac{1}{N_{\\text{eff}}-3}} = \\sqrt{\\frac{1}{\\frac{1560}{37}-3}} = \\sqrt{\\frac{1}{\\frac{1560-111}{37}}} = \\sqrt{\\frac{37}{1449}} \\approx 0.15980 $$\n对于 $95\\%$ 的置信区间，来自标准正态分布的临界值为 $z_{\\alpha/2} = z_{0.025}$，约等于 $1.96$。更精确地， $z_{0.025} \\approx 1.95996$。\n真实Fisher变换后相关性 $\\zeta = \\operatorname{arctanh}(\\rho)$ 的置信区间下界为：\n$$ \\zeta_{\\text{lower}} = z - z_{0.025} \\sigma_z \\approx 0.77530 - 1.95996 \\times 0.15980 \\approx 0.77530 - 0.31320 \\approx 0.46210 $$\n最后，为了找到真实相关系数 $\\rho$ 的下界，我们对 $\\zeta_{\\text{lower}}$ 应用Fisher逆变换（双曲正切）：\n$$ \\rho_{\\text{lower}} = \\tanh(\\zeta_{\\text{lower}}) \\approx \\tanh(0.46210) $$\n$$ \\rho_{\\text{lower}} \\approx 0.43178 $$\n将最终结果四舍五入到四位有效数字，得到 $0.4318$。",
            "answer": "$$\\boxed{0.4318}$$"
        }
    ]
}