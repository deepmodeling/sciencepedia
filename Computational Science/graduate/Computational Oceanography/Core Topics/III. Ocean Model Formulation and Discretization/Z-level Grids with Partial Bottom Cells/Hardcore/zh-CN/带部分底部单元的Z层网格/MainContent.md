## 引言
在计算海洋学中，对海底地形的精确描述是成功模拟[海洋环流](@entry_id:195237)的基石。然而，在选择垂向坐标系时，研究人员常常面临一个棘手的权衡：一方面，使用固定的分层坐标（Z-level）可以简化控制方程，尤其能精确计算水平压力梯度；但其阶梯状的地形表示法会在陡峭区域引入显著的[数值误差](@entry_id:635587)。另一方面，[地形跟随坐标](@entry_id:1132950)（Sigma-coordinate）虽能平滑地贴合海底，却因坐标面倾斜而导致压力梯度计算变得复杂，并可能产生巨大的虚假力。这个固有的矛盾限制了海洋模型的准确性。

本文旨在深入探讨一种先进的解决方案——**Z-level网格中的部分底层网格（Partial Bottom Cells, PBC）**技术。该方法巧妙地结合了两种传统坐标系的优点，在保留Z-level坐标物理简洁性的同时，通过允许最底层的网格厚度局部可变，来精确匹配真实水深。这种方法不仅极大地提升了地形表示的几何精度，更重要的是，它显著降低了由离散化引起的虚假压力梯度误差。

在接下来的章节中，我们将系统地剖析这一强大技术。**“原理与机制”**一章将阐明其核心思想，解释它如何从根本上减少[数值误差](@entry_id:635587)，并探讨其在有限体积模型中的守恒实现方式以及应对[数值稳定性](@entry_id:175146)的策略。随后，**“应用与跨学科联系”**一章将展示PBC在模拟大规模环流、海岸动力学乃至与[冰冻圈](@entry_id:1123254)耦合等多样化场景中的实际应用，并揭示其与[地球物理流体动力学](@entry_id:150356)等领域的深刻联系。最后，通过**“动手实践”**部分，读者将有机会通过具体的计算和设计练习，将理论知识转化为实践能力，从而真正掌握这一现代海洋建模的关键技术。

## 原理与机制

在计算海洋学中，精确地表示海底地形是模拟[海洋环流](@entry_id:195237)的关键挑战之一。[垂直坐标系](@entry_id:1133787)的选择对模型的精度、稳定性和计算效率有着深远的影响。本章将深入探讨在垂向采用固定[地球位势高度](@entry_id:269053)（即 $z$ 坐标）的网格系统中，一种被称为**部分底层网格 (Partial Bottom Cells, PBC)** 的先进技术。我们将阐述其基本原理、相较于其他坐标系的核心优势、数值实现细节及其在实践中面临的挑战与对策。

### 海底地形表示：坐标系的选择与权衡

为了理解部分底层网格的意义，我们首先需要将其置于不同垂向坐标策略的背景下进行比较。

最常用的两类垂向坐标是**分层坐标 ($z$-level)** 和 **[地形跟随坐标](@entry_id:1132950) ($\sigma$-coordinate)**。

**分层坐标**，或称地球位势坐标，其坐标面是固定的水平面。这种选择的最大优点是物理上的简洁性。由于坐标面是等位势面，水平压力[梯度力](@entry_id:166847)的计算不涉及因坐标面倾斜而产生的复杂转换和度量项。这使得在平坦或缓坡海底区域，压力梯度的计算非常直接和精确 。然而，当海底地形复杂且陡峭时，固定的水平网格层只能以“阶梯状”来近似地形。这种阶梯状表示法是造成[数值误差](@entry_id:635587)的一个主要来源，我们将在后续章节详细讨论。

与此相对，**[地形跟随坐标](@entry_id:1132950)**（或称 $\sigma$ 坐标）使用一个归一化的垂向变量 $s$（通常从海底的 $s=-1$ 到海面的 $s=0$ 变化），其坐标面会随着海底地形和自由表面的起伏而伸缩。例如，一个常见的 $\sigma$ 坐标定义为 $z(x,y,s,t) = \eta(x,y,t) + (H(x,y)+\eta(x,y,t))s$，其中 $H(x,y)$ 是海底深度，$\eta(x,y,t)$ 是海面高度 。这种方法的优点是能够平滑地贴合任意复杂的海底地形，从而避免了阶梯状表示。然而，代价是坐标系本身变为非正交的。在存在地形坡度 $(\nabla H \neq \mathbf{0})$ 的地方，坐标面是倾斜的，这导致在控制方程中出现了非对角的度量张量项。特别是在计算水平压力梯度时，需要分解为沿倾斜坐标面的梯度和一个涉及密度和地形坡度的修正项。在陡峭地形和强层结区域，这两个项的数值离散可能很大但符号相反，它们的差值计算会引入巨大的[截断误差](@entry_id:140949)，即所谓的**虚假压力[梯度力](@entry_id:166847) (spurious pressure gradient force)** 。

此外，还存在一些[混合坐标系](@entry_id:1126230)，如**重[标高](@entry_id:263754)度坐标 ($z^*$-coordinate)**，它试图在两者之间取得平衡。例如，通过 $z = \eta + (H_r+\eta)z^*/H_r$（其中 $H_r$ 是一个常考参考深度）定义的坐标，其坐标面不跟随海底地形，但会随海面高度变化而伸缩，从而将海面变化的影响分布到整个水体 。

部分底层网格技术正是在这一背景下，作为对传统 $z$-level 坐标阶梯表示法的一种重要改进而提出的。它旨在保留 $z$-level 坐标在物理方程上的简洁性，同时显著提高其对海底地形的几何表示精度。

### 从阶梯地形到部分底层网格

在经典的 $z$-level 模型中，最简单的地形表示方法是**全单元阶梯地形 (full-cell staircase topography)**。在这种方法中，每个网格单元要么被完全视为“海洋”（湿单元），要么完全视为“陆地”（干单元）。模型的底部边界被强制与最接近真实海底的网格层界面对齐，从而形成一个不连续的阶梯状地形。

**部分底层网格 (Partial Bottom Cells, PBC)** 通过允许最底层的湿单元格厚度是“部分的”来改进这一点 。其构建遵循以下核心原则：

1.  **水体厚度一致性**: 在任一水平位置 $(x,y)$，模型中所有垂向网格层的总厚度必须精确等于当地的实际水深 $H(x,y)$。即 $\sum_{k=1}^{N} \Delta z_k(x,y) = H(x,y)$，其中 $N$ 是该水柱中的总层数。

2.  **内部层厚度固定**: 除最底层外，所有内部（非底层）网格层 $k  N$ 都具有固定的、名义上的厚度 $\Delta z_{\text{full}}$。

3.  **底层厚度调整**: 最底层网格（第 $N$ 层）的厚度 $\Delta z_N(x,y)$ 被设定为吸收剩余的水深，以满足总厚度约束。

根据这些原则，我们可以确定底层网格的厚度。首先，确定包含海底的层指数 $N$，它满足 $(N-1)\Delta z_{\text{full}}  H(x,y) \le N\Delta z_{\text{full}}$。然后，从总厚度约束出发：
$$
\Delta z_N(x,y) = H(x,y) - \sum_{k=1}^{N-1} \Delta z_k(x,y)
$$
由于内部层厚度固定，上式简化为：
$$
\Delta z_N(x,y) = H(x,y) - (N-1)\Delta z_{\text{full}}
$$
这个 $\Delta z_N(x,y)$ 就是“剩余深度”。根据 $N$ 的选择方式，可以保证 $0  \Delta z_N(x,y) \le \Delta z_{\text{full}}$。这意味着底层单元的厚度 $h_N = \Delta z_N$ 可以小于名义厚度，但不会超过它。这种表示方法使得模型的离散测深能够更平滑、更精确地逼近真实地形，从而为减小[数值误差](@entry_id:635587)奠定了基础。

### 减小[静压](@entry_id:275419)压力梯度误差

使用部分底层网格最主要的动机是减小由阶梯地形引起的虚假水平压力[梯度力](@entry_id:166847) 。在[静力平衡](@entry_id:163498)假定下，压力由上覆水体的重量决定，即 $\partial p / \partial z = -\rho g$。在 $z$-level 网格中，水平压力[梯度力](@entry_id:166847)在 $k$ 层的离散形式为：
$$
F_x(i,k) = -\frac{1}{\rho_0} \frac{p_{i+1}(z_k) - p_i(z_k)}{\Delta x}
$$
其中，压力 $p_i(z_k)$ 是通过对 $i$ 水柱中 $z_k$ 以上所有网格层的密度进行垂向积分（求和）得到的。

在阶梯地形模型中，相邻水柱的底部边界位于不同的深度层。当存在密度梯度（层结），且等密度面倾斜穿过这些阶梯时，问题就出现了。计算一个“湿”单元和一个相邻的“干”单元（或一个更浅的湿单元）之间的压力梯度时，需要在“干”单元的位置估算一个压力值，这通常通过某种外插法实现。这种在离散地形边界上的人为处理，导致了对连续压[力场](@entry_id:147325)的巨大[截断误差](@entry_id:140949)，产生了即使在真实流体中不存在水平压力梯度的情况下也会驱动流动的虚假力。

部分底层网格通过更精确地表示海底几何形状，极大地缓解了这个问题。由于模型的底部更贴近真实地形，相邻水柱底部的几何“台阶”变得非常小。这使得在计算压力时，对密度的垂向积分范围更为准确，从而显著减小了 $p_{i+1} - p_i$ 的计算误差，进而降低了虚假的压力[梯度力](@entry_id:166847)。

我们可以通过一个无量纲的**地形坡度参数** $r$ 来量化这种改进 。该参数定义为：
$$
r \equiv \frac{|\nabla H|}{2\Delta z}
$$
其中 $|\nabla H|$ 是每个水平网格单元的地形高度变化量，$\Delta z$ 是垂向网格间距。该参数衡量了地形坡度相对于垂向分辨率的陡峭程度。理论分析和数值实验表明：

*   对于**全单元阶梯地形**，由压力梯度计算引入的主导[截断误差](@entry_id:140949)与 $r$ **[线性相关](@entry_id:185830)**，即误差 $\propto r$。
*   对于**部分底层网格**，由于其更精确的几何表示，线性误差项被消除，主导[截断误差](@entry_id:140949)与 $r$ 的**平方相关**，即误差 $\propto r^2$。

从[线性依赖](@entry_id:185830)到平方依赖的转变，意味着在地形陡峭（即 $r$ 较大）的区域，部分底层网格能够将压力梯度误差降低一个数量级，这是其在现代海洋模型中被广泛应用的核心原因。

### 数值实现与守恒特性

为了在模型中正确地实现部分底层网格，必须确保离散格式满足[质量守恒](@entry_id:204015)和几何一致性。这通常在交错网格（如 **Arakawa C-grid**）上实现，其中标量（如示踪剂浓度 $T$）位于网格中心，而速度分量位于网格的面上。

#### 几何与掩码定义

在含有部分底层网格的系统中，每个网格单元 $(k,i,j)$ 都有一个**湿区体积分数** $f(k,i,j) \in [0, 1]$，它表示该单元的名义体积中有多少是流体。对于内部层，该分数为 $0$ 或 $1$；对于部分底层，该分数在 $(0, 1]$ 之间。网格单元的实际流体体积为 $V_T(k,i,j) = A_h(i,j) \Delta z_k f(k,i,j)$，其中 $A_h$ 是水平面积，$\Delta z_k$ 是名义厚度 。

为了确保通量计算的正确性，需要为每个变量位置定义**干/湿掩码**。

*   **示踪剂掩码 $m_T$**: 一个示踪剂单元只要含有流体就是“湿”的，因此 $m_T(k,i,j) = \mathbf{1}_{f(k,i,j)>0}$。

*   **水平速度掩码 $m_U, m_V$**: 水平通量发生在两个相邻的示踪剂单元之间。只有当两个单元都含有流体时，通量才可能存在。因此，速度点的掩码应是相邻示踪剂掩码的逻辑与（AND），例如 $m_U(i+\frac{1}{2},j,k) = m_T(k,i,j) \cdot m_T(k,i+1,j)$ 。

*   **垂向速度掩码 $m_W$**: 同理，垂向通量发生在两个垂向相邻的单元之间，其掩码为 $m_W(k+\frac{1}{2},i,j) = m_T(k,i,j) \cdot m_T(k+1,i,j)$。这个定义有一个重要的推论：在海底，部分底层单元格 $k$ 是湿的 ($m_T(k)=1$)，但其下的单元格 $k+1$ 是“干”的 ($m_T(k+1)=0$)。因此，海底界面的垂向速度掩码 $m_W$ 自动变为0。这自然地实现了**无穿透边界条件**，即 $w=0$ 在海底 。

*   **分数界面面积**: 水平通量的大小还取决于界面的开放面积。该面积受限于相邻两个单元中较浅的那个。因此，水平界面 $i+\frac{1}{2}$ 的有效垂向开放高度分数应为 $f_U = \min(f(k,i,j), f(k,i+1,j))$。相应地，界面的面积为 $A_U = \Delta y \cdot \Delta z_k \cdot f_U$  。

#### [示踪剂守恒](@entry_id:1122906)

在有限体积框架下，示踪剂的[守恒方程](@entry_id:1122898)以[通量形式](@entry_id:273811)给出。对于底层单元格 $N$，其单位水平面积内的示踪剂总量 $h_N T_N$（其中 $h_N = f_N \Delta z$ 是部分厚度）的变化率等于进出该单元的净通量 ：
$$
\frac{\partial (h_N T_N)}{\partial t} = - \nabla \cdot (\mathbf{U}_N T_N) - (F^{\text{adv}}_{N+1/2} - F^{\text{adv}}_{N-1/2}) + \dots (\text{扩散项})
$$
其中 $\mathbf{U}_N=h_N\mathbf{u}_N$ 是厚度加权的水平输运，$F$ 是垂向通量。关键在于，垂向通量 $F_{N-1/2}$（通过单元顶部）的计算不应乘以部分厚度分数 $f_N$，因为通量是跨界面的物理过程，必须与[上层](@entry_id:198114)单元的通量计算保持一致才能确保守恒。而海底的通量 $F_{N+1/2}$ 由于[无穿透条件](@entry_id:191795)而为零。

由此可得示踪剂浓度的变化趋势：
$$
\frac{\partial T_N}{\partial t} = \frac{1}{h_N} \times (\text{净通量散度})
$$
这意味着，对于一个给定的通量，一个很薄的底层单元（$h_N$ 很小）将会经历非常剧烈的浓度变化。这个 $1/h_N$ 的放大效应是使用部分底层网格时必须面对的一个核心数值挑战。

### 实践挑战与先进对策

尽管部分底层网格在表示地形和减小压力梯度误差方面具有显著优势，但其引入的薄单元格也带来了严峻的[数值稳定性](@entry_id:175146)问题。

#### 时间步长限制

对于[显式时间积分](@entry_id:165797)方案，时间步长 $\Delta t$ 受到 Courant-Friedrichs-Lewy (CFL) 条件的限制。这个限制与网格尺寸直接相关。对于一个厚度为 $h_N$ 的薄底层单元：

*   **垂向平流稳定性**: 稳定性要求无量纲的 Courant 数 $C = w \Delta t / h_N$ 必须小于一个阈值（对于[一阶迎风格式](@entry_id:749417)，约为1）。这导致时间步长限制为 $\Delta t_{\text{adv}} \le h_N / w$。

*   **垂向扩散稳定性**: 对于显式扩散方案，限制更为严格，时间步长与厚度的平方成正比：$\Delta t_{\text{diff}} \le h_N^2 / (2K)$，其中 $K$ 是垂向扩散系数。

由于 $h_N$ 可能非常小，这两个条件——特别是对扩散的限制——会导致 $\Delta t$ 变得极小，使得模型的长时间积分不切实际 。例如，在一个典型设置中，如果底层厚度 $h_N = 0.3\,\mathrm{m}$，垂向速度 $w = 2 \times 10^{-4}\,\mathrm{m\,s^{-1}}$，扩散系数 $K = 5 \times 10^{-5}\,\mathrm{m^2\,s^{-1}}$，那么平流限制的时间步长约为 $1500\,\mathrm{s}$，而[扩散限制](@entry_id:153636)的时间步长仅为 $900\,\mathrm{s}$。

#### 厚度下限与单元合并

为了解决这个问题，现代海洋模型采用了一种**厚度下限 (thickness floor)** 和 **单元合并 (cell merging)** 的策略 。

1.  **设置厚度下限 $h_{\min}$**: 首先，根据稳定性准则和模型所用的时间步长 $\Delta t$，计算一个可接受的最小单元厚度。例如，基于扩散稳定性，可以设定 $h_{\min} = s \sqrt{2 K \Delta t}$，其中 $s \ge 1$ 是一个安全因子。

2.  **检查与合并**: 在每个时间步，检查底层单元的厚度 $h_b$。
    *   如果 $h_b \ge h_{\min}$，则无需任何操作。
    *   如果 $h_b  h_{\min}$，则该底层单元被视为“过薄”，并将其与紧邻其上的单元格（设为 $a$）合并。

3.  **守恒合并**: 合并过程必须守恒质量、动量和示踪剂总量。新合并的单元格厚度为 $h_a' = h_a + h_b$。其示踪剂浓度 $c_a'$ 和水平速度 $u_a'$ 通过厚度加权平均得到，以确保守恒：
    $$
    c_a' = \frac{c_a h_a + c_b h_b}{h_a + h_b}
    $$
    $$
    u_a' = \frac{u_a h_a + u_b h_b}{h_a + h_b}
    $$
    合并后，原来的底层单元被移除，新的合并单元成为该水柱新的底层。这种动态调整策略有效地避免了因过薄单元格而导致的数值不稳定，同时保持了模型的物理守恒性，使得部分底层网格技术在实际应用中变得稳健和高效。