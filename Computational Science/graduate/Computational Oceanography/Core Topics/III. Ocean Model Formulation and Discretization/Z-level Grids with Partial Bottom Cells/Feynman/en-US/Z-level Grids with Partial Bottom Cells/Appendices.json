{
    "hands_on_practices": [
        {
            "introduction": "To begin our hands-on exploration, we first need to master the fundamental arithmetic of partial bottom cells. This exercise focuses on the direct application of definitions to calculate a partial cell's thickness and its fractional value from a given water depth. Mastering this initial step is crucial for building a solid foundation before tackling more complex theoretical and computational challenges .",
            "id": "3819515",
            "problem": "A three-dimensional ocean model employs a fixed vertical coordinate with depth levels of constant thickness, commonly called a z-level grid. To avoid systematic mismatches between the discrete grid and the continuous bathymetry, many models include a partial bottom cell that closes the remainder of the water column beneath the deepest full level. Consider a single water column whose bathymetric depth is $H$, discretized by $N_{\\mathrm{full}}$ full cells of uniform thickness $\\Delta z_{\\mathrm{full}}$, plus one partial bottom cell. The defining relationships for this representation are that the continuous water-column height equals the sum of the discrete layer thicknesses and that the bottom cell fraction $f$ is the ratio of the partial cell thickness to the full-cell thickness. From these principles, determine the bottom-cell fraction $f$ and the bottom-cell thickness $\\Delta z_{N}$ for the case $H=2375\\,\\mathrm{m}$, $\\Delta z_{\\mathrm{full}}=100\\,\\mathrm{m}$, and $N_{\\mathrm{full}}=23$. Then, using the constraints that the partial bottom cell must satisfy $0 \\leq f  1$ in a $z$-level grid with partial bottom cells, provide a justification for whether an additional full level should or should not be included at this location.\n\nExpress the bottom cell thickness in meters and the fraction $f$ as a unitless number. No rounding is required; provide exact values.",
            "solution": "The problem is valid as it is scientifically grounded in the established practices of computational oceanography, is well-posed with sufficient and consistent information, and is stated objectively.\n\nThe problem asks for the determination of the partial bottom cell thickness, $\\Delta z_{N}$, and its corresponding fraction, $f$, for a z-level grid, and for a justification regarding the number of full grid cells.\n\nThe fundamental principle provided is that the total bathymetric depth, $H$, is exactly represented by the sum of the thicknesses of all discrete vertical cells. This water column is composed of $N_{\\mathrm{full}}$ full cells of uniform thickness $\\Delta z_{\\mathrm{full}}$ and one partial bottom cell of thickness $\\Delta z_{N}$. This relationship can be expressed mathematically as:\n$$H = (N_{\\mathrm{full}} \\times \\Delta z_{\\mathrm{full}}) + \\Delta z_{N}$$\n\nWe are given the following values:\nTotal depth, $H = 2375 \\, \\mathrm{m}$.\nThickness of a full cell, $\\Delta z_{\\mathrm{full}} = 100 \\, \\mathrm{m}$.\nNumber of full cells, $N_{\\mathrm{full}} = 23$.\n\nFirst, we calculate the total thickness of the full cells:\n$$N_{\\mathrm{full}} \\times \\Delta z_{\\mathrm{full}} = 23 \\times 100 \\, \\mathrm{m} = 2300 \\, \\mathrm{m}$$\n\nNext, we can solve for the thickness of the partial bottom cell, $\\Delta z_{N}$, by rearranging the first equation:\n$$\\Delta z_{N} = H - (N_{\\mathrm{full}} \\times \\Delta z_{\\mathrm{full}})$$\nSubstituting the known values:\n$$\\Delta z_{N} = 2375 \\, \\mathrm{m} - 2300 \\, \\mathrm{m} = 75 \\, \\mathrm{m}$$\n\nThe second principle provided defines the bottom cell fraction, $f$, as the ratio of the partial cell thickness to the full-cell thickness:\n$$f = \\frac{\\Delta z_{N}}{\\Delta z_{\\mathrm{full}}}$$\nUsing the calculated value for $\\Delta z_{N}$ and the given value for $\\Delta z_{\\mathrm{full}}$:\n$$f = \\frac{75 \\, \\mathrm{m}}{100 \\, \\mathrm{m}} = 0.75$$\nThis value is unitless, as required.\n\nThe second part of the problem requires a justification for whether an additional full level should be included, given the constraint $0 \\leq f  1$.\n\nIn a z-level grid formulation, the number of full cells, $N_{\\mathrm{full}}$, is not an arbitrary choice. It is determined by the total depth $H$ and the full-cell thickness $\\Delta z_{\\mathrm{full}}$. Specifically, $N_{\\mathrm{full}}$ must be the largest integer number of full cells that can fit within the total depth. This is mathematically expressed using the floor function:\n$$N_{\\mathrm{full}} = \\left\\lfloor \\frac{H}{\\Delta z_{\\mathrm{full}}} \\right\\rfloor$$\nLet's verify this for the given case:\n$$N_{\\mathrm{full}} = \\left\\lfloor \\frac{2375}{100} \\right\\rfloor = \\lfloor 23.75 \\rfloor = 23$$\nThis confirms that the given value $N_{\\mathrm{full}} = 23$ is the correct one for this discretization scheme.\n\nThe constraint $0 \\leq f  1$ is a direct consequence of this definition of $N_{\\mathrm{full}}$. By definition of the floor function, for any real number $x$, we have $\\lfloor x \\rfloor \\leq x  \\lfloor x \\rfloor + 1$. Applying this with $x = H / \\Delta z_{\\mathrm{full}}$:\n$$N_{\\mathrm{full}} \\leq \\frac{H}{\\Delta z_{\\mathrm{full}}}  N_{\\mathrm{full}} + 1$$\nSubtracting $N_{\\mathrm{full}}$ from all parts of the inequality gives:\n$$0 \\leq \\frac{H}{\\Delta z_{\\mathrm{full}}} - N_{\\mathrm{full}}  1$$\nRecognizing that $f = \\frac{\\Delta z_{N}}{\\Delta z_{\\mathrm{full}}} = \\frac{H - N_{\\mathrm{full}}\\Delta z_{\\mathrm{full}}}{\\Delta z_{\\mathrm{full}}} = \\frac{H}{\\Delta z_{\\mathrm{full}}} - N_{\\mathrm{full}}$, we see that the constraint is mathematically guaranteed:\n$$0 \\leq f  1$$\nOur calculated value $f=0.75$ correctly falls within this range.\n\nTo address the question of adding an additional full level, let us consider the hypothetical case where we set the number of full levels to $N'_{\\mathrm{full}} = N_{\\mathrm{full}} + 1 = 23 + 1 = 24$.\nThe total thickness of these $24$ full cells would be:\n$$N'_{\\mathrm{full}} \\times \\Delta z_{\\mathrm{full}} = 24 \\times 100 \\, \\mathrm{m} = 2400 \\, \\mathrm{m}$$\nThis discretized depth ($2400 \\, \\mathrm{m}$) is greater than the actual bathymetric depth ($H = 2375 \\, \\mathrm{m}$). This is a physically impossible scenario, as it would mean the model's seafloor is below the real seafloor, with the bottom grid cell extending into the solid earth.\n\nTherefore, an additional full level should not, and indeed cannot, be included. The number of full levels is fixed at $23$ by the geophysical parameters of the problem. The configuration with $N_{\\mathrm{full}}=23$ and a partial bottom cell of thickness $75 \\, \\mathrm{m}$ (with $f=0.75$) is the only valid discretization for this water column under the specified model rules.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.75  75\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Having established how to calculate partial cell properties, we now explore *why* they are so important. This practice delves into the core motivation for using partial bottom cells: the significant reduction of spurious pressure gradient errors. By deriving the mathematical expression for this numerical error, you will quantitatively demonstrate the advantage of this method over simpler staircase discretizations .",
            "id": "3819508",
            "problem": "Consider a hydrostatic ocean model on a $z$-level grid with Partial Bottom Cells (PBC). Two adjacent vertical columns share the same free-surface elevation $\\eta$ and the same number $N \\in \\mathbb{N}$ of full cells, each of uniform thickness $\\Delta z$. In each column, the bottom-most fluid layer is a partial cell of thickness $h_i = f_i \\Delta z$, where $f_i \\in (0,1]$ is the fractional thickness in column $i$ for $i \\in \\{1,2\\}$. The horizontal grid spacing between the two columns is $\\Delta x$. The density is constant, $\\rho = \\rho_0$, and gravitational acceleration is constant, $g$. Assume the pressure gauge is chosen such that $p(\\eta) = 0$.\n\nThe discrete horizontal pressure gradient at the center of the bottom-most layer is computed by a centered finite difference of the hydrostatic pressures evaluated at the centers of the bottom cells in the two columns, i.e., $(p_1 - p_2)/\\Delta x$.\n\nStarting only from the hydrostatic balance and these grid definitions, derive a closed-form expression for the magnitude of the spurious discrete horizontal pressure gradient at the bottom, $|\\frac{p_1 - p_2}{\\Delta x}|$, in terms of $\\rho_0$, $g$, $\\Delta z$, $\\Delta x$, and $f_1, f_2$. Then, for comparison, consider a full-cell staircase representation of the same bathymetric contrast in which one column instead has one additional full $z$-level at the bottom (so the centers of the bottom-most cells in the two columns are offset by exactly $\\Delta z$). Use this to identify the reduction factor of the PBC-induced mismatch relative to the full-cell mismatch and explain how it depends on $|f_1 - f_2|$.\n\nExpress the final pressure gradient magnitude in Pascal per meter $(\\mathrm{Pa}\\ \\mathrm{m}^{-1})$. Your final answer must be a single closed-form analytic expression; do not provide intermediate steps or an equation for the reduction factor in the final answer.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It is based on fundamental principles of fluid dynamics (hydrostatic balance) and standard numerical methods in computational oceanography. All necessary information is provided, and the objective is clearly stated. We may proceed with the solution.\n\nThe problem requires the derivation of the magnitude of a spurious horizontal pressure gradient that arises from the discretization of bathymetry in a $z$-level ocean model using Partial Bottom Cells (PBC).\n\nFirst, we establish the physical principle and coordinate system. The ocean is assumed to be hydrostatic, meaning the pressure $p$ at any depth is determined by the weight of the water column above it. The governing equation is the hydrostatic balance:\n$$\n\\frac{dp}{dz} = -\\rho_0 g\n$$\nwhere $z$ is the vertical coordinate (positive upwards), $\\rho_0$ is the constant water density, and $g$ is the gravitational acceleration. We are given that the pressure at the free surface, $z=\\eta$, is zero, i.e., $p(\\eta) = 0$. Integrating the hydrostatic equation from a coordinate $z$ up to $\\eta$ yields:\n$$\n\\int_{p(z)}^{p(\\eta)} dp' = \\int_{z}^{\\eta} (-\\rho_0 g) dz'\n$$\n$$\np(\\eta) - p(z) = -\\rho_0 g (\\eta - z)\n$$\nGiven $p(\\eta)=0$, the pressure at any vertical coordinate $z$ is:\n$$\np(z) = \\rho_0 g (\\eta - z)\n$$\nTo simplify the geometry, we can set the origin of the vertical axis at the free surface, such that $\\eta = 0$. The pressure equation simplifies to $p(z) = -\\rho_0 g z$ for $z \\le 0$.\n\nNext, we define the vertical grid structure for each column $i \\in \\{1, 2\\}$. Each column has $N$ full cells of uniform thickness $\\Delta z$ below the free surface, and a partial cell at the very bottom.\nThe $N$ full cells occupy the vertical range from $z=0$ down to $z=-N \\Delta z$.\nThe bottom-most cell in column $i$ is a partial cell of thickness $h_i = f_i \\Delta z$, where $f_i \\in (0, 1]$. This partial cell occupies the vertical range from $z = -N \\Delta z$ to $z = -N \\Delta z - h_i = -(N + f_i)\\Delta z$.\n\nThe problem states that the discrete pressure gradient is computed using pressures evaluated at the centers of these bottom cells. Let's find the vertical coordinate, $z_{c,i}$, of the center of the bottom cell in column $i$. The center is the midpoint of its vertical extent:\n$$\nz_{c,i} = \\frac{(-N \\Delta z) + (-(N+f_i)\\Delta z)}{2} = -\\frac{2N + f_i}{2}\\Delta z = -\\left(N + \\frac{f_i}{2}\\right)\\Delta z\n$$\nNow, we can calculate the hydrostatic pressure, $p_i$, at the center of the bottom cell in each column $i \\in \\{1, 2\\}$ using the pressure formula $p(z) = -\\rho_0 g z$:\nFor column $1$:\n$$\np_1 = p(z_{c,1}) = -\\rho_0 g z_{c,1} = -\\rho_0 g \\left[-\\left(N + \\frac{f_1}{2}\\right)\\Delta z\\right] = \\rho_0 g \\left(N + \\frac{f_1}{2}\\right)\\Delta z\n$$\nFor column $2$:\n$$\np_2 = p(z_{c,2}) = -\\rho_0 g z_{c,2} = -\\rho_0 g \\left[-\\left(N + \\frac{f_2}{2}\\right)\\Delta z\\right] = \\rho_0 g \\left(N + \\frac{f_2}{2}\\right)\\Delta z\n$$\nThe pressure difference between the two cell centers is:\n$$\np_1 - p_2 = \\rho_0 g \\left(N + \\frac{f_1}{2}\\right)\\Delta z - \\rho_0 g \\left(N + \\frac{f_2}{2}\\right)\\Delta z\n$$\n$$\np_1 - p_2 = \\rho_0 g \\Delta z \\left[\\left(N + \\frac{f_1}{2}\\right) - \\left(N + \\frac{f_2}{2}\\right)\\right] = \\rho_0 g \\Delta z \\left(\\frac{f_1 - f_2}{2}\\right)\n$$\nThe problem asks for the magnitude of the discrete horizontal pressure gradient, which is defined as $|(p_1 - p_2)/\\Delta x|$, where $\\Delta x$ is the horizontal distance between the column centers.\n$$\n\\left|\\frac{p_1 - p_2}{\\Delta x}\\right| = \\left|\\frac{\\rho_0 g \\Delta z (f_1 - f_2)}{2 \\Delta x}\\right| = \\frac{\\rho_0 g \\Delta z}{2 \\Delta x}|f_1 - f_2|\n$$\nThis is the closed-form expression for the magnitude of the spurious pressure gradient in a PBC model. This gradient is spurious because it arises even in a resting fluid ($\\eta=\\text{constant}$) solely due to the grid's representation of the bathymetry. Ideally, for a fluid at rest, the horizontal pressure gradient should be zero everywhere.\n\nFor comparison, we consider a full-cell staircase representation. The problem specifies that in this case, one column has one additional full cell, leading to a vertical offset of exactly $\\Delta z$ between the centers of the bottom-most cells. Let column $1$ have $K$ cells and column $2$ have $K+1$ cells.\nThe center of the bottom cell in column $1$ is at $z_{c,1,stair} = -(K - 1/2)\\Delta z$.\nThe center of the bottom cell in column $2$ is at $z_{c,2,stair} = -((K+1) - 1/2)\\Delta z = -(K + 1/2)\\Delta z$.\nThe pressure difference is $p_{1,stair} - p_{2,stair}$:\n$$\np_{1,stair} - p_{2,stair} = \\rho_0 g (K - 1/2)\\Delta z - \\rho_0 g (K + 1/2)\\Delta z = \\rho_0 g \\Delta z (K - 1/2 - K - 1/2) = -\\rho_0 g \\Delta z\n$$\nThe magnitude of the spurious pressure gradient in the staircase model is:\n$$\n\\left|\\frac{p_{1,stair} - p_{2,stair}}{\\Delta x}\\right| = \\left|\\frac{-\\rho_0 g \\Delta z}{\\Delta x}\\right| = \\frac{\\rho_0 g \\Delta z}{\\Delta x}\n$$\nThe reduction factor of the PBC-induced error relative to the full-cell staircase error is the ratio of their magnitudes:\n$$\n\\text{Reduction Factor} = \\frac{\\frac{\\rho_0 g \\Delta z}{2 \\Delta x}|f_1 - f_2|}{\\frac{\\rho_0 g \\Delta z}{\\Delta x}} = \\frac{1}{2}|f_1 - f_2|\n$$\nThis factor demonstrates the principal advantage of the PBC method. The spurious pressure gradient is proportional to $|f_1 - f_2|$, the difference in the fractional thicknesses of the bottom cells. Since $f_1, f_2 \\in (0, 1]$, $|f_1-f_2|$ is in the range $[0, 1)$. Therefore, the PBC error is always less than half the staircase error (which occurs for $|f_1-f_2| \\to 1$) and is significantly smaller when the bathymetry slope is gentle, such that adjacent partial cells have similar thicknesses ($|f_1-f_2| \\ll 1$). In the ideal case of a flat bottom, $f_1=f_2$, and the PBC method correctly yields a zero spurious pressure gradient, unlike the staircase model which would still produce an error unless the bottom aligns perfectly with a grid level. The error in the staircase model is of order $\\mathcal{O}(\\rho_0 g \\Delta z / \\Delta x)$, whereas the PBC error is of order $\\mathcal{O}(\\rho_0 g \\Delta z |f_1-f_2| / \\Delta x)$, representing a substantial improvement in accuracy.",
            "answer": "$$\n\\boxed{\\frac{\\rho_0 g \\Delta z |f_1 - f_2|}{2 \\Delta x}}\n$$"
        },
        {
            "introduction": "This final practice bridges the gap between theory and real-world application, focusing on the practical implementation of the partial bottom cell concept. You will design and code an algorithm to process a two-dimensional bathymetry field and compute the corresponding partial cell fractions. This task requires careful handling of various edge cases and numerical tolerances, solidifying your understanding by translating the abstract concept into a robust computational tool .",
            "id": "3819497",
            "problem": "You are given a two-dimensional gridded bathymetry field $H(i,j)$ in meters and a one-dimensional, strictly increasing list of standard depths (z-levels) $z_k$ in meters, with $k \\in \\{0,1,\\dots,K\\}$ and $z_0 = 0$ at the ocean surface and $z_K$ the deepest level. Assume the vertical coordinate is positive downward. The computational task is to determine, for each horizontal grid cell $(i,j)$, the fraction $f(i,j)$ of the bottom-most vertical cell that is filled with water under a z-level discretization with partial bottom cells. The fraction $f(i,j)$ is defined by the ratio of the filled thickness of the deepest grid cell to its nominal thickness. Starting from the core definition of z-level discretization and the idea that the partial bottom cell is the interval $[z_{N-1}, z_N]$ whose bounds immediately straddle the local depth $H(i,j)$, derive and implement an algorithm that, for each $(i,j)$, identifies the index $N$ such that $z_{N-1} \\le H(i,j) \\le z_{N}$ and then computes\n$$\nf(i,j) = \\frac{H(i,j) - z_{N-1}}{z_N - z_{N-1}} \\, .\n$$\nThe algorithm must enforce $f(i,j) \\in [0,1]$ and handle the following scientifically realistic edge cases:\n- If $H(i,j)$ aligns with a level within a small tolerance $\\varepsilon$ (in meters), interpret alignment as follows:\n  - If $|H(i,j) - z_N| \\le \\varepsilon$, set $f(i,j) = 1$.\n  - If $|H(i,j) - z_{N-1}| \\le \\varepsilon$, set $f(i,j) = 0$.\n- If $H(i,j)  z_0$, set $f(i,j) = 0$.\n- If $H(i,j)  z_K$, set $f(i,j) = 1$ for the deepest cell $[z_{K-1}, z_K]$.\nIn all computations, lengths must be treated as physical quantities in meters. The output $f(i,j)$ is dimensionless and must be reported as floats rounded to six decimal places.\n\nBegin your derivation from foundational definitions of z-level discretization and the interpretation of partial bottom cells as filled fractions of the deepest interval that contains the bottom. Justify each algorithmic decision from these principles, avoiding any shortcut formulas that skip the logical steps.\n\nImplement the algorithm as a complete, runnable program. Your implementation must process a fixed test suite of cases defined below and produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test caseâ€™s result must be the flattened list of $f(i,j)$ values (row-major order) enclosed in its own brackets, and the overall output must be the list of these lists in order:\n$$\n\\big[ [\\text{case 1 values}], [\\text{case 2 values}], \\dots \\big] \\, .\n$$\n\nTest suite (all depths in meters, angles do not apply, and all reported fractions are dimensionless floats rounded to six decimal places):\n- Case $1$ (general case with mixed depths and alignments): $H = \\begin{bmatrix} 37.5  12.0  95.0 \\\\ 0.0  49.9  100.0 \\end{bmatrix}$, $z = [0.0, 50.0, 100.0, 150.0]$, $\\varepsilon = 10^{-9}$.\n- Case $2$ (alignment to discrete levels including the ocean surface): $H = \\begin{bmatrix} 0.0  10.0  20.0 \\\\ 30.0  40.0  50.0 \\end{bmatrix}$, $z = [0.0, 10.0, 20.0, 30.0, 40.0, 50.0]$, $\\varepsilon = 10^{-9}$.\n- Case $3$ (shallower than the first cell thickness): $H = \\begin{bmatrix} 2.0  5.0 \\\\ 7.5  9.999 \\end{bmatrix}$, $z = [0.0, 10.0, 20.0]$, $\\varepsilon = 10^{-9}$.\n- Case $4$ (one depth inside the deepest interval and one deeper than the deepest level): $H = \\begin{bmatrix} 105.0  151.0 \\end{bmatrix}$, $z = [0.0, 50.0, 100.0, 150.0]$, $\\varepsilon = 10^{-9}$.\n- Case $5$ (tolerance-based alignment near level boundaries): $H = \\begin{bmatrix} 49.9999995  100.0000004  0.0000003 \\end{bmatrix}$, $z = [0.0, 50.0, 100.0]$, $\\varepsilon = 10^{-6}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[\\text{result}_1,\\text{result}_2,\\text{result}_3]$), where each $\\text{result}_n$ is the flattened list of fractions for the $n$-th test case, itself enclosed in brackets. No additional text should be printed.",
            "solution": "The problem requires the derivation and implementation of an algorithm to calculate the fractional fill of the bottom-most cell in a z-level vertical grid, a common task in computational oceanography. The solution proceeds from the fundamental principles of vertical discretization.\n\nA z-level coordinate system discretizes the vertical dimension of an ocean model into a series of layers defined by fixed, horizontally uniform depths $z_k$. We are given a strictly increasing sequence of these depths $z = [z_0, z_1, \\dots, z_K]$, where $z_0 = 0$ is the sea surface and the vertical coordinate is positive downward. A vertical grid cell, indexed $k$, is the region between depths $z_{k-1}$ and $z_k$, having a nominal thickness of $\\Delta z_k = z_k - z_{k-1}$.\n\nFor any horizontal location $(i,j)$, the ocean floor is at a depth $H(i,j)$. The water column at this location occupies the depth interval $[0, H(i,j)]$. In the discrete z-level representation, this water column is modeled as a stack of cells that are either completely full or partially full. The \"bottom-most vertical cell\" is the first cell from the top that is not completely full. This cell is the one whose depth interval contains the sea floor.\n\nThe core of the algorithm is to identify this cell and then compute the fraction of it that is filled with water.\n\n**Step 1: Identification of the Partial Bottom Cell**\nFor a given bathymetric depth $H(i,j)$, we must find the index $N$ corresponding to the vertical cell $[z_{N-1}, z_N]$ that contains $H(i,j)$. This is formally stated as finding the integer $N \\in \\{1, \\dots, K\\}$ such that $z_{N-1} \\le H(i,j) \\le z_N$. Since the array of z-levels $z_k$ is sorted, this search can be performed efficiently using a binary search algorithm. Computationally, this is equivalent to finding the index where $H(i,j)$ would be inserted into the sorted array $z_k$ to maintain order.\n\nThe problem specifies a convention for cases where $H(i,j)$ coincides with a z-level interface, $H(i,j) = z_k$. The provided tolerance rules imply a specific choice: if $H(i,j) \\approx z_k$, the relevant cell is $[z_{k-1}, z_k]$, which is considered fully occupied ($f(i,j)=1$), while the cell below, $[z_k, z_{k+1}]$, is considered empty ($f(i,j)=0$). This convention is realized by searching for the index $N$ such that $z_{N-1} \\le H(i,j)  z_N$ for a strictly interior point, and if $H(i,j)=z_N$, the interval is $[z_{N-1}, z_N]$. A left-sided binary search (such as `numpy.searchsorted` with `side='left'`) accomplishes this: it returns an index $N$ such that for a value $v$, all `z[i]  v` have `i  N` and all `z[i] = v` have `i = N`. Thus, if $v=z_k$, it returns $k$. For a value $v$ between $z_{k-1}$ and $z_k$, it returns $k$. So, for a given $H(i,j)$, we find $N = \\text{searchsorted}(z, H(i,j), \\text{side='left'})$. The interval of interest is then $[z_{N-1}, z_N]$.\n\n**Step 2: Calculation of the Fractional Fill**\nOnce the index $N$ is identified, the partial bottom cell is defined by the interval $[z_{N-1}, z_N]$.\nThe nominal thickness of this cell is $\\Delta z_N = z_N - z_{N-1}$.\nThe water fills this cell from its top boundary, $z_{N-1}$, down to the seabed at $H(i,j)$.\nThe thickness of the filled portion is therefore $H(i,j) - z_{N-1}$.\nThe fractional fill $f(i,j)$ is the ratio of the filled thickness to the nominal cell thickness:\n$$\nf(i,j) = \\frac{\\text{Filled Thickness}}{\\text{Nominal Thickness}} = \\frac{H(i,j) - z_{N-1}}{z_N - z_{N-1}}\n$$\nThis formula is valid for $z_{N-1}  H(i,j)  z_N$.\n\n**Step 3: Algorithmic Implementation with Edge Cases**\nA robust algorithm must systematically handle all cases defined in the problem statement. The steps for processing each depth value $H$ are as follows:\n\n1.  **Handle depths outside the grid range:**\n    - If $H  z_0$, the location is above the sea surface. The water depth is zero, so the fraction is $f(i,j) = 0$.\n    - If $H  z_K$, the seabed is deeper than the deepest defined z-level. Per the problem, the deepest cell $[z_{K-1}, z_K]$ is considered completely full, so $f(i,j) = 1$.\n\n2.  **Handle depths within the grid range ($z_0 \\le H \\le z_K$):**\n    a. Determine the cell index $N$ using a left-sided binary search on the z-level array $z_k$: $N = \\text{searchsorted}(z, H)$.\n    b. If $H = z_0$, the search returns $N=0$. This corresponds to an empty water column, so the fraction for the first cell $[z_0, z_1]$ is $f(i,j) = 0$. This case is handled separately.\n    c. For $N \\ge 1$, the cell is bounded by $z_{top} = z_{N-1}$ and $z_{bot} = z_N$.\n    d. Apply the specified tolerance rules, which take precedence over the formula. These rules are critical for handling floating-point inaccuracies and ensuring consistent behavior when the bathymetry aligns with a grid interface.\n        - If $|H - z_{bot}| \\le \\varepsilon$, the depth is considered to be at the bottom of the cell. The cell is full: $f(i,j) = 1$.\n        - Else if $|H - z_{top}| \\le \\varepsilon$, the depth is considered to be at the top of the cell. The cell is empty: $f(i,j) = 0$.\n    e. If neither tolerance condition is met, the depth is strictly between the cell boundaries. Compute the fraction using the derived formula: $f(i,j) = (H - z_{top}) / (z_{bot} - z_{top})$.\n\n3.  **Final Output:** The calculated fraction $f(i,j)$ is a dimensionless float, which must be rounded to six decimal places as required. The algorithm is applied to every point $(i,j)$ in the bathymetry grid $H(i,j)$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the partial bottom cell fraction problem for a suite of test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"H\": np.array([[37.5, 12.0, 95.0], [0.0, 49.9, 100.0]]),\n            \"z\": np.array([0.0, 50.0, 100.0, 150.0]),\n            \"epsilon\": 1e-9\n        },\n        {\n            \"H\": np.array([[0.0, 10.0, 20.0], [30.0, 40.0, 50.0]]),\n            \"z\": np.array([0.0, 10.0, 20.0, 30.0, 40.0, 50.0]),\n            \"epsilon\": 1e-9\n        },\n        {\n            \"H\": np.array([[2.0, 5.0], [7.5, 9.999]]),\n            \"z\": np.array([0.0, 10.0, 20.0]),\n            \"epsilon\": 1e-9\n        },\n        {\n            \"H\": np.array([[105.0, 151.0]]),\n            \"z\": np.array([0.0, 50.0, 100.0, 150.0]),\n            \"epsilon\": 1e-9\n        },\n        {\n            \"H\": np.array([[49.9999995, 100.0000004, 0.0000003]]),\n            \"z\": np.array([0.0, 50.0, 100.0]),\n            \"epsilon\": 1e-6\n        }\n    ]\n\n    overall_results = []\n\n    for case in test_cases:\n        H, z, epsilon = case[\"H\"], case[\"z\"], case[\"epsilon\"]\n        \n        K = len(z) - 1\n        z_0 = z[0]\n        z_K = z[K]\n        \n        case_results = []\n        # Iterate through H in row-major (C-style) order.\n        for h_val in H.flat:\n            \n            # Handle cases where depth is outside the z-level range, as per problem.\n            if h_val  z_0:\n                fraction = 0.0\n            elif h_val  z_K:\n                fraction = 1.0\n            else:\n                # Find the index N for the interval [z_{N-1}, z_N]\n                # `searchsorted` with `side='left'` finds N such that z[N-1]  h_val = z[N]\n                # or if h_val = z[N], it returns N.\n                N = np.searchsorted(z, h_val, side='left')\n\n                # Handle the specific case where h_val is exactly z_0. `searchsorted`\n                # returns N=0. The bottom-most cell is [z_0, z_1] and it's empty.\n                if N == 0:\n                    fraction = 0.0\n                else:\n                    z_top = z[N - 1]\n                    z_bot = z[N]\n\n                    # Apply tolerance rules which take precedence.\n                    if abs(h_val - z_bot) = epsilon:\n                        fraction = 1.0\n                    elif abs(h_val - z_top) = epsilon:\n                        fraction = 0.0\n                    else:\n                        # Standard interior case.\n                        fraction = (h_val - z_top) / (z_bot - z_top)\n            \n            # Round to six decimal places as required.\n            case_results.append(round(fraction, 6))\n            \n        overall_results.append(case_results)\n\n    # Final print statement in the exact required format.\n    # The default string representation of a list is `[...]` with spaces.\n    # To match the required format without spaces, we process each list.\n    formatted_results = []\n    for res_list in overall_results:\n        formatted_list = f\"[{','.join(map(str, res_list))}]\"\n        formatted_results.append(formatted_list)\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}