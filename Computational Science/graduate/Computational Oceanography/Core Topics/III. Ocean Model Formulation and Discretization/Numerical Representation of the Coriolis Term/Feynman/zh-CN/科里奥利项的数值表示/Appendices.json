{
    "hands_on_practices": [
        {
            "introduction": "在对科里奥利项进行数值离散之前，我们必须首先理解其物理起源和数学形式。这个练习将引导您从地球自转矢量出发，推导出科里奥利参数 $f$，并阐明海洋模型中广泛使用的“传统近似”的含义。通过计算 $f$ 随纬度的变化，您将体会到为何一个空间变化的科里奥利参数会对数值格式的设计构成挑战。",
            "id": "3803933",
            "problem": "考虑旋转地球的水平动量方程，该方程在一个非惯性（旋转）参考系中由牛顿第二定律导出，其中视加速度包含科里奥利项 $2\\,\\boldsymbol{\\Omega}\\times\\boldsymbol{u}$。这里，$\\boldsymbol{\\Omega}$ 是地球的自转矢量，其大小为 $\\Omega$，$\\boldsymbol{u}$ 是局地流体速度。在纬度 $\\phi$ 处的局地东-北-天基矢 $\\{\\hat{\\boldsymbol{e}},\\hat{\\boldsymbol{n}},\\hat{\\boldsymbol{k}}\\}$ 中，假设采用地球物理流体动力学中的传统近似，即只有 $2\\,\\boldsymbol{\\Omega}$ 平行于 $\\hat{\\boldsymbol{k}}$ 的分量作用于水平运动。从这些基础出发，利用 $\\boldsymbol{\\Omega}$ 在局地基矢中的几何分解，推导在海洋模型所使用的线性化动量方程中与水平速度相乘的标准标量科里奥利参数 $f(\\phi)$。然后，使用地球的恒星自转速率 $\\Omega=7.2921159\\times 10^{-5}\\,\\mathrm{s}^{-1}$，计算在纬度 $\\phi=30^{\\circ}\\,\\mathrm{N}$ 和 $\\phi=60^{\\circ}\\,\\mathrm{N}$ 处的 $f$ 值，并量化其相对变化\n$$\\delta_f=\\frac{|f(60^{\\circ})-f(30^{\\circ})|}{|f(30^{\\circ})|}$$\n以评估数值格式对 $f$ 随纬度变化的敏感性。所有角度均以度为单位。将最终的相对变化 $\\delta_f$ 表示为小数，并将最终答案四舍五入到四位有效数字。如果计算了 $f$ 的中间值，请以 $\\mathrm{s}^{-1}$ 为单位表示，但最终报告的答案必须是单个数字 $\\delta_f$。",
            "solution": "该问题陈述清晰，并有地球物理流体动力学原理作为坚实的科学基础。我们将进行推导和计算。\n\n地球的自转由角速度矢量 $\\boldsymbol{\\Omega}$ 描述，该矢量沿地球自转轴从南极指向北极，其大小为 $\\Omega$。我们在地球表面纬度为 $\\phi$ 的一点上定义一个局地笛卡尔坐标系。其基矢为 $\\{\\hat{\\boldsymbol{e}}, \\hat{\\boldsymbol{n}}, \\hat{\\boldsymbol{k}}\\}$，分别代表局地东、北和上（垂直）方向。\n\n自转矢量 $\\boldsymbol{\\Omega}$ 可以分解到这个局地基矢中。根据几何构造，局地垂直方向 $\\hat{\\boldsymbol{k}}$与地球自转轴之间的夹角为 $90^{\\circ} - \\phi$。因此，局地北向 $\\hat{\\boldsymbol{n}}$（位于水平面内）与自转轴之间的夹角为 $\\phi$。由于 $\\boldsymbol{\\Omega}$ 位于局地北-垂直平面内，其分解为：\n$$\n\\boldsymbol{\\Omega} = (\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{n}})\\hat{\\boldsymbol{n}} + (\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{k}})\\hat{\\boldsymbol{k}}\n$$\n其投影为 $\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{n}} = \\Omega\\cos(\\phi)$ 和 $\\boldsymbol{\\Omega}\\cdot\\hat{\\boldsymbol{k}} = \\Omega\\sin(\\phi)$。因此，在局地基矢中的自转矢量为：\n$$\n\\boldsymbol{\\Omega} = \\Omega\\cos(\\phi)\\hat{\\boldsymbol{n}} + \\Omega\\sin(\\phi)\\hat{\\boldsymbol{k}}\n$$\n旋转参考系中的动量方程包含科里奥利加速度项，由 $-2\\boldsymbol{\\Omega}\\times\\boldsymbol{u}$ 给出，其中 $\\boldsymbol{u}$ 是局地参考系中的流体速度矢量。速度矢量为 $\\boldsymbol{u} = u\\hat{\\boldsymbol{e}} + v\\hat{\\boldsymbol{n}} + w\\hat{\\boldsymbol{k}}$。\n\n问题指定使用传统近似，在该近似中，仅考虑 $2\\boldsymbol{\\Omega}$ 平行于局地垂直方向 $\\hat{\\boldsymbol{k}}$ 的分量对水平运动的作用。水平速度为 $\\boldsymbol{u}_h = u\\hat{\\boldsymbol{e}} + v\\hat{\\boldsymbol{n}}$。$2\\boldsymbol{\\Omega}$ 平行于 $\\hat{\\boldsymbol{k}}$ 的分量为 $2\\boldsymbol{\\Omega}_{\\text{vert}} = 2\\Omega\\sin(\\phi)\\hat{\\boldsymbol{k}}$。\n\n在此近似下，水平动量方程中的科里奥利加速度项是 $-2\\boldsymbol{\\Omega}_{\\text{vert}} \\times \\boldsymbol{u}_h$ 的水平分量：\n$$\n\\boldsymbol{a}_{c,h} \\approx - (2\\Omega\\sin(\\phi)\\hat{\\boldsymbol{k}}) \\times (u\\hat{\\boldsymbol{e}} + v\\hat{\\boldsymbol{n}})\n$$\n我们使用右手系的关系式展开叉积：$\\hat{\\boldsymbol{k}}\\times\\hat{\\boldsymbol{e}} = \\hat{\\boldsymbol{n}}$ 和 $\\hat{\\boldsymbol{k}}\\times\\hat{\\boldsymbol{n}} = -\\hat{\\boldsymbol{e}}$。\n$$\n\\boldsymbol{a}_{c,h} \\approx -2\\Omega\\sin(\\phi) [u(\\hat{\\boldsymbol{k}}\\times\\hat{\\boldsymbol{e}}) + v(\\hat{\\boldsymbol{k}}\\times\\hat{\\boldsymbol{n}})]\n$$\n$$\n\\boldsymbol{a}_{c,h} \\approx -2\\Omega\\sin(\\phi) [u\\hat{\\boldsymbol{n}} - v\\hat{\\boldsymbol{e}}]\n$$\n$$\n\\boldsymbol{a}_{c,h} \\approx (2\\Omega\\sin(\\phi)v)\\hat{\\boldsymbol{e}} - (2\\Omega\\sin(\\phi)u)\\hat{\\boldsymbol{n}}\n$$\n线性化的水平动量方程通常写为：\n$$\n\\frac{du}{dt} = fv + \\dots\n$$\n$$\n\\frac{dv}{dt} = -fu + \\dots\n$$\n其中所示项为科里奥利加速度的分量。将我们推导出的加速度分量与此标准形式进行比较，我们确定科里奥利参数 $f$（也称为行星涡度）为：\n$$\nf(\\phi) = 2\\Omega\\sin(\\phi)\n$$\n至此，推导完成。现在，我们计算所需的值。地球的恒星自转速率给定为 $\\Omega=7.2921159\\times 10^{-5}\\,\\mathrm{s}^{-1}$。\n\n在纬度 $\\phi=30^{\\circ}\\,\\mathrm{N}$ 处：\n$$\nf(30^{\\circ}) = 2 \\times (7.2921159\\times 10^{-5}\\,\\mathrm{s}^{-1}) \\times \\sin(30^{\\circ})\n$$\n由于 $\\sin(30^{\\circ}) = 1/2$，\n$$\nf(30^{\\circ}) = 2 \\times (7.2921159\\times 10^{-5}\\,\\mathrm{s}^{-1}) \\times \\frac{1}{2} = 7.2921159\\times 10^{-5}\\,\\mathrm{s}^{-1}\n$$\n\n在纬度 $\\phi=60^{\\circ}\\,\\mathrm{N}$ 处：\n$$\nf(60^{\\circ}) = 2 \\times (7.2921159\\times 10^{-5}\\,\\mathrm{s}^{-1}) \\times \\sin(60^{\\circ})\n$$\n由于 $\\sin(60^{\\circ}) = \\sqrt{3}/2$，\n$$\nf(60^{\\circ}) = 2 \\times (7.2921159\\times 10^{-5}\\,\\mathrm{s}^{-1}) \\times \\frac{\\sqrt{3}}{2} = \\sqrt{3} \\times (7.2921159\\times 10^{-5}\\,\\mathrm{s}^{-1})\n$$\n$$\nf(60^{\\circ}) \\approx 1.263053\\times 10^{-4}\\,\\mathrm{s}^{-1}\n$$\n\n接下来，我们计算相对变化 $\\delta_f$：\n$$\n\\delta_f = \\frac{|f(60^{\\circ})-f(30^{\\circ})|}{|f(30^{\\circ})|}\n$$\n代入 $f(\\phi)$ 的表达式：\n$$\n\\delta_f = \\frac{|2\\Omega\\sin(60^{\\circ})-2\\Omega\\sin(30^{\\circ})|}{|2\\Omega\\sin(30^{\\circ})|}\n$$\n由于 $\\phi$ 在北半球且介于 $0^{\\circ}$ 和 $90^{\\circ}$ 之间，$\\sin(\\phi)$ 为正且递增，因此我们可以去掉绝对值符号：\n$$\n\\delta_f = \\frac{2\\Omega(\\sin(60^{\\circ})-\\sin(30^{\\circ}))}{2\\Omega\\sin(30^{\\circ})} = \\frac{\\sin(60^{\\circ})}{\\sin(30^{\\circ})} - 1\n$$\n代入精确的三角函数值：\n$$\n\\delta_f = \\frac{\\sqrt{3}/2}{1/2} - 1 = \\sqrt{3} - 1\n$$\n为获得最终数值答案，我们计算此表达式并四舍五入到四位有效数字：\n$$\n\\delta_f = \\sqrt{3} - 1 \\approx 1.7320508 - 1 = 0.7320508\n$$\n四舍五入到四位有效数字，第五位有效数字是 $5$，所以我们将第四位数字向上取整。\n$$\n\\delta_f \\approx 0.7321\n$$\n这个超过 73% 的相对变化表明，科里奥利参数随纬度显著变化，这是影响数值海洋模型准确性的一个关键因素。",
            "answer": "$$\\boxed{0.7321}$$"
        },
        {
            "introduction": "在建立了控制方程之后，下一步便是将其数值化。本练习通过分析最简单的时间步进方法——前向欧拉法，给出了一个至关重要的警示。您将通过解析推导，明确这种看似直接的方法如何引入非物理的能量增长和相位误差，从而揭示其在应用于惯性运动这类振荡系统时所固有的不稳定性。",
            "id": "3803906",
            "problem": "考虑一个在以恒定行星涡度旋转的参考系中的无摩擦、水平均匀的海水质块，其水平速度矢量为 $\\mathbf{u}(t) = (u(t), v(t))$。其动力学由以下线性常微分方程（ODE）描述：\n$$\n\\partial_{t}\\mathbf{u}(t) + f\\,\\hat{\\mathbf{k}}\\times\\mathbf{u}(t) = \\mathbf{0},\n$$\n其中 $f$ 是恒定的科里奥利参数，$\\hat{\\mathbf{k}}$ 是垂直向上的单位矢量。设时间步长为 $\\Delta t > 0$，并定义无量纲步长参数 $\\nu \\equiv f\\,\\Delta t$。\n\n从适用于旋转参考系动力学的第一性原理和核心定义以及一致的数值时间积分出发，完成以下任务：\n\n- 推导用于在一个时间步长 $\\Delta t$ 内近似该 ODE 的显式前向欧拉时间步进更新 $\\mathbf{u}^{n} \\mapsto \\mathbf{u}^{n+1}$。\n- 在欧几里得意义下，使用基于范数的放大解释，确定每步放大因子 $g(\\nu)$，该因子定义为对于任意 $\\mathbf{u}^{n}\\neq\\mathbf{0}$，$\\mathbf{u}^{n+1}$ 的欧几里得范数与 $\\mathbf{u}^{n}$ 的欧几里得范数之比。\n- 将前向欧拉更新的每步作用解释为水平面内的一个旋转与一个均匀缩放的复合。角度以弧度为单位，并遵循正角度对应于 $(u,v)$ 平面中逆时针旋转的标准数学约定，计算数值每步旋转角，并减去由连续动力学在相同时间间隔 $\\Delta t$ 内所隐含的精确每步旋转角，以获得相位误差 $\\delta\\phi(\\nu)$，该误差定义为数值旋转角减去精确旋转角。\n\n将您的最终答案表示为一对关于 $\\nu$ 的闭合形式解析表达式 $(g(\\nu), \\delta\\phi(\\nu))$。不需要进行数值计算或四舍五入。角度必须以弧度表示。最终的数对应以最简解析形式给出，且最终方框内的表达式不包含单位。",
            "solution": "控制方程为线性常微分方程：\n$$\n\\partial_{t}\\mathbf{u}(t) + f\\,\\hat{\\mathbf{k}}\\times\\mathbf{u}(t) = \\mathbf{0},\n$$\n其中 $f$ 为常数。在水平面内将 $\\mathbf{u}$写作 $\\mathbf{u} = (u, v)$，叉积 $\\hat{\\mathbf{k}}\\times\\mathbf{u}$ 等于 $(-v, u)$。因此，该常微分方程的分量形式变为：\n$$\n\\frac{d}{dt}\\begin{pmatrix}u \\\\ v\\end{pmatrix} = -f\\,\\begin{pmatrix}-v \\\\ u\\end{pmatrix} = -f\\,\\mathbf{J}\\,\\begin{pmatrix}u \\\\ v\\end{pmatrix},\n$$\n其中斜对称矩阵 $\\mathbf{J}$ 为\n$$\n\\mathbf{J} \\equiv \\begin{pmatrix}0  -1 \\\\ 1  0\\end{pmatrix}.\n$$\n此 $\\mathbf{J}$ 满足 $\\mathbf{J}^{2} = -\\mathbf{I}$，其中 $\\mathbf{I}$ 是单位矩阵。在时间间隔 $\\Delta t$ 内，连续系统的精确解是一个角度为 $-f\\,\\Delta t$ 的刚性旋转（当 $f>0$ 时为顺时针），因为\n$$\n\\exp\\!\\left(-f\\,\\Delta t\\,\\mathbf{J}\\right) = \\mathbf{I}\\,\\cos(f\\,\\Delta t) - \\mathbf{J}\\,\\sin(f\\,\\Delta t),\n$$\n这是角度为 $-f\\,\\Delta t$ 的旋转矩阵。\n\n为了构建前向欧拉格式，用一阶前向差分来近似时间导数：\n$$\n\\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^{n}}{\\Delta t} \\approx \\partial_{t}\\mathbf{u}(t^{n}).\n$$\n在时间层 $n$ 代入常微分方程的右侧，得到：\n$$\n\\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^{n}}{\\Delta t} = -f\\,\\mathbf{J}\\,\\mathbf{u}^{n}.\n$$\n因此，显式更新为：\n$$\n\\mathbf{u}^{n+1} = \\left(\\mathbf{I} - f\\,\\Delta t\\,\\mathbf{J}\\right)\\mathbf{u}^{n} = \\left(\\mathbf{I} - \\nu\\,\\mathbf{J}\\right)\\mathbf{u}^{n},\n$$\n其中 $\\nu \\equiv f\\,\\Delta t$ 是无量纲步长参数。\n\n接下来，确定每步放大因子。考虑欧几里得范数 $\\|\\cdot\\|_{2}$。放大因子 $g(\\nu)$ 定义为：\n$$\ng(\\nu) \\equiv \\frac{\\|\\mathbf{u}^{n+1}\\|_{2}}{\\|\\mathbf{u}^{n}\\|_{2}} = \\frac{\\|(\\mathbf{I} - \\nu\\,\\mathbf{J})\\mathbf{u}^{n}\\|_{2}}{\\|\\mathbf{u}^{n}\\|_{2}}.\n$$\n因为 $\\mathbf{J}$ 是正交的（$\\mathbf{J}^{\\top}\\mathbf{J} = \\mathbf{I}$）且是斜对称的（$\\mathbf{J}^{\\top} = -\\mathbf{J}$），我们有：\n$$\n(\\mathbf{I} - \\nu\\,\\mathbf{J})^{\\top}(\\mathbf{I} - \\nu\\,\\mathbf{J}) = \\mathbf{I} + \\nu^{2}\\,\\mathbf{J}^{\\top}\\mathbf{J} = \\mathbf{I} + \\nu^{2}\\,\\mathbf{I} = (1 + \\nu^{2})\\,\\mathbf{I}.\n$$\n这表明，在欧几里得范数下，$(\\mathbf{I} - \\nu\\,\\mathbf{J})$ 的作用是按因子 $\\sqrt{1 + \\nu^{2}}$ 进行均匀缩放，且与 $\\mathbf{u}^{n}$ 的方向无关。因此，\n$$\ng(\\nu) = \\sqrt{1 + \\nu^{2}}.\n$$\n\n为了描述相位，将水平速度表示为复标量 $z \\equiv u + i\\,v$ 会很方便，其中 $i$ 是虚数单位。在这种表示下，$\\mathbf{J}$ 作用于 $(u, v)$ 对应于乘以 $i$，因为 $\\mathbf{J}\\,(u, v)^{\\top} = (-v, u)^{\\top}$，且 $i\\,(u + i\\,v) = -v + i\\,u$。前向欧拉更新变为：\n$$\nz^{n+1} = z^{n} - \\nu\\,i\\,z^{n} = (1 - i\\,\\nu)\\,z^{n}.\n$$\n因此，一个前向欧拉步将复数状态乘以复数 $(1 - i\\,\\nu)$。$(1 - i\\,\\nu)$ 的模为 $\\sqrt{1 + \\nu^{2}}$，这与上面推导的放大因子一致。其辐角（主值）为：\n$$\n\\arg(1 - i\\,\\nu) = -\\arctan(\\nu),\n$$\n其中角度以弧度为单位，并遵循标准的逆时针为正的约定。因此，数值每步旋转角为 $-\\arctan(\\nu)$。\n\n在相同时间间隔 $\\Delta t$ 内的精确每步旋转角为 $-f\\,\\Delta t = -\\nu$。根据给定的定义，相位误差 $\\delta\\phi(\\nu)$ 是数值旋转角减去精确旋转角：\n$$\n\\delta\\phi(\\nu) \\equiv \\left[-\\arctan(\\nu)\\right] - \\left[-\\nu\\right] = \\nu - \\arctan(\\nu).\n$$\n\n总之，放大因子和相位误差作为 $\\nu$ 的函数分别为：\n$$\ng(\\nu) = \\sqrt{1 + \\nu^{2}}, \\qquad \\delta\\phi(\\nu) = \\nu - \\arctan(\\nu),\n$$\n角度以弧度为单位。",
            "answer": "$$\\boxed{\\begin{pmatrix}\\sqrt{1 + \\nu^{2}}  \\nu - \\arctan(\\nu)\\end{pmatrix}}$$"
        },
        {
            "introduction": "认识到朴素离散化的陷阱后，这个实践将聚焦于一种解决方案：结构保持离散化。您将亲手实现并比较一个非守恒格式与一个能量守恒格式，直观地观察不同数值选择所带来的后果。这个动手编程练习将巩固您的理解，即为何在数值模拟中保持连续系统的物理性质（如能量守恒）对于获得长期稳定且准确的结果至关重要。",
            "id": "3803917",
            "problem": "考虑在一个科里奥利参数恒定的平面（f平面近似）上的二维水平惯性运动，无压力梯度且无摩擦。控制向东和向北速度分量的动量方程是以下常微分方程\n$$ \\frac{d u}{d t} = f\\, v, \\qquad \\frac{d v}{d t} = - f\\, u, $$\n其中 $u$ 和 $v$ 是以 $\\mathrm{m}\\ \\mathrm{s}^{-1}$ 为单位的水平速度分量，$t$ 是以 $\\mathrm{s}$ 为单位的时间，$f$ 是以 $\\mathrm{s}^{-1}$ 为单位的科里奥利参数。连续方程守恒单位质量的动能，\n$$ K(t) = \\frac{1}{2}\\left(u(t)^2 + v(t)^2\\right), $$\n对于所有 $t$ 均成立，这是由于线性科里奥利算子的斜对称性。\n\n您的任务是设计、实现并测试一种时间离散的数值方法，该方法表示科里奥利项的方式能够在每个离散时间 $t_n = n\\,\\Delta t$ 上，在浮点机器精度范围内精确地保持离散动能 $K_n = \\frac{1}{2}(u_n^2+v_n^2)$。从上述连续方程及其结构出发，推导出一个通过确保离散科里奥利算子在离散意义下保持斜对称性来守恒 $K_n$ 的离散更新方案。然后实现两种方法：\n- 一个能够精确到机器精度来保持 $K_n$ 的能量守恒方法。\n- 一个不强制斜对称性并且通常无法随时间保持能量守恒的朴素显式方法。\n\n对于每种方法，从给定的初始条件 $(u_0, v_0)$ 开始，对系统进行指定时间步数的数值积分，并计算在整个积分过程中动能的最大相对偏差，\n$$ \\varepsilon = \\max_{0 \\le n \\le N} \\frac{\\left|K_n - K_0\\right|}{K_0}, $$\n这是一个以小数表示的无量纲标量。\n\n使用以下涵盖典型条件、极限情况和边缘场景的参数集测试套件。所有速度单位必须为 $\\mathrm{m}\\ \\mathrm{s}^{-1}$，时间单位为 $\\mathrm{s}$，科里奥利参数单位为 $\\mathrm{s}^{-1}$：\n- 测试 A（中纬度，中等时间步长）：$f = 1.0\\times 10^{-4}\\ \\mathrm{s}^{-1}$，$\\Delta t = 900\\ \\mathrm{s}$，$N = 1000$，$u_0 = 0.5\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$，$v_0 = -0.3\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$。\n- 测试 B（赤道，科里奥利参数为零）：$f = 0.0\\ \\mathrm{s}^{-1}$，$\\Delta t = 1800\\ \\mathrm{s}$，$N = 1000$，$u_0 = 1.2\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$，$v_0 = -0.8\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$。\n- 测试 C（接近半圈的大时间步长）：$f = 1.0\\times 10^{-4}\\ \\mathrm{s}^{-1}$，$\\Delta t = 28274\\ \\mathrm{s}$，$N = 10$，$u_0 = 0.7\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$，$v_0 = 0.1\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$。\n- 测试 D（南半球，负科里奥利参数）：$f = -1.0\\times 10^{-4}\\ \\mathrm{s}^{-1}$，$\\Delta t = 1200\\ \\mathrm{s}$，$N = 500$，$u_0 = 0.9\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$，$v_0 = 0.4\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$。\n\n对于每个测试用例，计算两个浮点数：\n- $\\varepsilon_{\\mathrm{conserving}}$，对于适当的能量守恒离散化方法，其最大相对能量偏差。\n- $\\varepsilon_{\\mathrm{naive}}$，对于朴素显式方法，其最大相对能量偏差。\n\n最终输出格式：您的程序应生成一行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。每个测试用例的结果本身必须是一个包含在方括号中的双元素逗号分隔浮点数列表。例如，总输出必须具有\n$$ [\\,[\\varepsilon_{\\mathrm{conserving,A}},\\varepsilon_{\\mathrm{naive,A}}],\\,[\\varepsilon_{\\mathrm{conserving,B}},\\varepsilon_{\\mathrm{naive,B}}],\\,\\ldots\\,] $$\n的形式，且不含空格。浮点数必须以语言默认或选择的浮点数格式打印为十进制或科学记数法。",
            "solution": "该问题要求为f平面上的惯性运动方程设计并实现两种数值时间步进格式：一种是特意设计用于守恒动能的，另一种是朴素的、不守恒动能的格式。\n\n控制方程是一个线性常微分方程组（ODEs）：\n$$\n\\frac{d u}{d t} = f v \\\\\n\\frac{d v}{d t} = - f u\n$$\n其中 $u(t)$ 和 $v(t)$ 是速度分量，$t$ 是时间，$f$ 是恒定的科里奥利参数。该系统可以写成向量形式 $\\frac{d\\mathbf{u}}{dt} = \\mathbf{A}\\mathbf{u}$，其中 $\\mathbf{u} = \\begin{pmatrix} u \\\\ v \\end{pmatrix}$，科里奥利算子由矩阵 $\\mathbf{A} = \\begin{pmatrix} 0  f \\\\ -f  0 \\end{pmatrix}$ 表示。\n\n单位质量的动能由 $K(t) = \\frac{1}{2}(u(t)^2 + v(t)^2) = \\frac{1}{2}\\mathbf{u}^T\\mathbf{u}$ 给出。其随时间的变化为：\n$$ \\frac{dK}{dt} = u \\frac{du}{dt} + v \\frac{dv}{dt} = u(fv) + v(-fu) = fuv - fuv = 0 $$\n或者，使用矩阵表示法，$\\frac{dK}{dt} = \\frac{1}{2}\\frac{d}{dt}(\\mathbf{u}^T\\mathbf{u}) = \\mathbf{u}^T\\frac{d\\mathbf{u}}{dt} = \\mathbf{u}^T\\mathbf{A}\\mathbf{u}$。矩阵 $\\mathbf{A}$ 是斜对称的，即 $\\mathbf{A}^T = -\\mathbf{A}$。对于任何向量 $\\mathbf{u}$ 和任何斜对称矩阵 $\\mathbf{A}$，二次型 $\\mathbf{u}^T\\mathbf{A}\\mathbf{u}$ 恒为零。因此，科里奥利算子的斜对称性是连续系统中动能守恒的根本原因。我们的目标是在离散系统中保持这一性质。\n\n设离散时间为 $t_n = n \\Delta t$，速度分量为 $(u_n, v_n)$。在时间 $t_n$ 的动能为 $K_n = \\frac{1}{2}(u_n^2 + v_n^2)$。\n\n**1. 朴素显式方法（前向欧拉法）**\n\n最简单的显式离散化是前向欧拉法，其中时间导数用前向差分近似，右侧项在当前时间步 $n$ 进行计算。\n$$ \\frac{u_{n+1} - u_n}{\\Delta t} = f v_n $$\n$$ \\frac{v_{n+1} - v_n}{\\Delta t} = -f u_n $$\n这得到了更新规则：\n$$ u_{n+1} = u_n + f \\Delta t v_n $$\n$$ v_{n+1} = v_n - f \\Delta t u_n $$\n让我们分析离散动能的变化 $K_{n+1} = \\frac{1}{2}(u_{n+1}^2 + v_{n+1}^2)$：\n$$ u_{n+1}^2 + v_{n+1}^2 = (u_n + f \\Delta t v_n)^2 + (v_n - f \\Delta t u_n)^2 $$\n$$ = (u_n^2 + 2 f \\Delta t u_n v_n + (f \\Delta t)^2 v_n^2) + (v_n^2 - 2 f \\Delta t u_n v_n + (f \\Delta t)^2 u_n^2) $$\n$$ = u_n^2 + v_n^2 + (f \\Delta t)^2 (u_n^2 + v_n^2) = (1 + (f \\Delta t)^2) (u_n^2 + v_n^2) $$\n因此，下一时间步的动能与当前动能的关系为：\n$$ K_{n+1} = K_n (1 + (f \\Delta t)^2) $$\n对于任何非零的 $f$ 和 $\\Delta t$，因子 $(1 + (f \\Delta t)^2)$ 都大于1。因此，该格式在每一步都会人为地产生能量，导致动能出现指数级的、非物理的增长。它未能保持连续算子的斜对称性。\n\n**2. 能量守恒方法（梯形法则）**\n\n为了构建一个能量守恒的格式，我们必须以一种保持科里奥利算子斜对称性的方式对系统进行离散化。对于线性系统，实现这一目标的标准方法是梯形法则（也称为 Crank-Nicolson 方法），其中右侧项在时间区间 $[t_n, t_{n+1}]$ 上取平均值。\n$$ \\frac{u_{n+1} - u_n}{\\Delta t} = f \\left(\\frac{v_n + v_{n+1}}{2}\\right) $$\n$$ \\frac{v_{n+1} - v_n}{\\Delta t} = -f \\left(\\frac{u_n + u_{n+1}}{2}\\right) $$\n为了验证能量守恒，我们将第一个方程乘以 $(u_n + u_{n+1})$，第二个方程乘以 $(v_n + v_{n+1})$，然后将它们相加：\n$$ \\frac{u_{n+1}^2 - u_n^2}{\\Delta t} + \\frac{v_{n+1}^2 - v_n^2}{\\Delta t} = f \\left(\\frac{v_n + v_{n+1}}{2}\\right)(u_n + u_{n+1}) - f \\left(\\frac{u_n + u_{n+1}}{2}\\right)(v_n + v_{n+1}) = 0 $$\n乘以 $\\frac{\\Delta t}{2}$ 得到 $\\frac{1}{2}(u_{n+1}^2 + v_{n+1}^2) - \\frac{1}{2}(u_n^2 + v_n^2) = 0$，即 $K_{n+1} - K_n = 0$。该格式精确地守恒动能，$K_{n+1} = K_n$，误差在机器浮点精度范围内。\n\n这是一个隐式格式，因为未知值 $(u_{n+1}, v_{n+1})$ 出现在方程两边。我们必须为它们求解一个线性系统。设 $\\alpha = \\frac{f \\Delta t}{2}$。方程为：\n$$ u_{n+1} - \\alpha v_{n+1} = u_n + \\alpha v_n $$\n$$ \\alpha u_{n+1} + v_{n+1} = v_n - \\alpha u_n $$\n矩阵形式为：\n$$ \\begin{pmatrix} 1  -\\alpha \\\\ \\alpha  1 \\end{pmatrix} \\begin{pmatrix} u_{n+1} \\\\ v_{n+1} \\end{pmatrix} = \\begin{pmatrix} 1  \\alpha \\\\ -\\alpha  1 \\end{pmatrix} \\begin{pmatrix} u_n \\\\ v_n \\end{pmatrix} $$\n左侧矩阵的逆是 $\\frac{1}{1+\\alpha^2}\\begin{pmatrix} 1  \\alpha \\\\ -\\alpha  1 \\end{pmatrix}$。将其应用于两边，得到显式更新规则：\n$$ \\begin{pmatrix} u_{n+1} \\\\ v_{n+1} \\end{pmatrix} = \\frac{1}{1+\\alpha^2} \\begin{pmatrix} 1  \\alpha \\\\ -\\alpha  1 \\end{pmatrix} \\begin{pmatrix} 1  \\alpha \\\\ -\\alpha  1 \\end{pmatrix} \\begin{pmatrix} u_n \\\\ v_n \\end{pmatrix} = \\frac{1}{1+\\alpha^2} \\begin{pmatrix} 1-\\alpha^2  2\\alpha \\\\ -2\\alpha  1-\\alpha^2 \\end{pmatrix} \\begin{pmatrix} u_n \\\\ v_n \\end{pmatrix} $$\n这给出了能量守恒格式的最终算法：\n$$ u_{n+1} = \\frac{(1-\\alpha^2)u_n + 2\\alpha v_n}{1+\\alpha^2} $$\n$$ v_{n+1} = \\frac{-2\\alpha u_n + (1-\\alpha^2)v_n}{1+\\alpha^2} $$\n其中 $\\alpha = f \\Delta t / 2$。该形式将用于实现。\n\n对于 $f=0$ 的特殊情况（测试 B），我们有 $\\alpha=0$。朴素方法给出 $u_{n+1}=u_n, v_{n+1}=v_n$。守恒方法也给出 $u_{n+1}=u_n, v_{n+1}=v_n$。在这种情况下，两者都是精确的，应该产生能量偏差 $\\varepsilon$ 为0。对于所有其他 $f \\ne 0$ 的测试，我们预期朴素格式会产生一个大的 $\\varepsilon_{\\mathrm{naive}}$，而守恒格式应该产生一个接近机器精度的 $\\varepsilon_{\\mathrm{conserving}}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(method: str, f: float, dt: float, N: int, u0: float, v0: float) - float:\n    \"\"\"\n    Numerically integrates the inertial motion equations and computes the maximum relative energy deviation.\n\n    Args:\n        method: The integration method to use ('naive' or 'conserving').\n        f: Coriolis parameter (s^-1).\n        dt: Time step (s).\n        N: Number of time steps.\n        u0: Initial eastward velocity (m/s).\n        v0: Initial northward velocity (m/s).\n\n    Returns:\n        The maximum relative deviation of kinetic energy over the integration.\n    \"\"\"\n    \n    k0 = 0.5 * (u0**2 + v0**2)\n    \n    # If initial kinetic energy is zero, any subsequent velocity results in infinite\n    # relative error. However, if u0=v0=0, velocity remains zero. Thus, deviation is 0.\n    if k0 == 0.0:\n        return 0.0\n\n    u_hist = np.zeros(N + 1, dtype=np.float64)\n    v_hist = np.zeros(N + 1, dtype=np.float64)\n    u_hist[0], v_hist[0] = u0, v0\n\n    if method == 'naive':\n        # Forward Euler method\n        for n in range(N):\n            u_prev, v_prev = u_hist[n], v_hist[n]\n            u_hist[n+1] = u_prev + f * dt * v_prev\n            v_hist[n+1] = v_prev - f * dt * u_prev\n    elif method == 'conserving':\n        # Trapezoidal method (Crank-Nicolson)\n        alpha = f * dt / 2.0\n        denom = 1.0 + alpha**2\n        \n        c1 = (1.0 - alpha**2) / denom\n        c2 = (2.0 * alpha) / denom\n\n        for n in range(N):\n            u_prev, v_prev = u_hist[n], v_hist[n]\n            u_hist[n+1] = c1 * u_prev + c2 * v_prev\n            v_hist[n+1] = -c2 * u_prev + c1 * v_prev\n    else:\n        raise ValueError(\"Unknown method specified.\")\n\n    k_hist = 0.5 * (u_hist**2 + v_hist**2)\n    \n    # Calculate max relative deviation, avoiding division by zero if k0 is zero (already handled)\n    rel_dev = np.abs(k_hist - k0) / k0\n    max_rel_dev = np.max(rel_dev)\n\n    return max_rel_dev\n\ndef solve():\n    \"\"\"\n    Defines test cases, runs simulations, and prints results in the specified format.\n    \"\"\"\n    # Test cases: (f, dt, N, u0, v0)\n    test_cases = [\n        # Test A (mid-latitude, moderate time step)\n        (1.0e-4, 900.0, 1000, 0.5, -0.3),\n        # Test B (equator, zero Coriolis parameter)\n        (0.0, 1800.0, 1000, 1.2, -0.8),\n        # Test C (large time step near half-turn)\n        (1.0e-4, 28274.0, 10, 0.7, 0.1),\n        # Test D (Southern Hemisphere, negative Coriolis parameter)\n        (-1.0e-4, 1200.0, 500, 0.9, 0.4),\n    ]\n\n    results = []\n    for case in test_cases:\n        f_param, dt_param, N_param, u0_param, v0_param = case\n        \n        eps_conserving = run_simulation('conserving', f_param, dt_param, N_param, u0_param, v0_param)\n        eps_naive = run_simulation('naive', f_param, dt_param, N_param, u0_param, v0_param)\n        \n        results.append(f\"[{eps_conserving},{eps_naive}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}