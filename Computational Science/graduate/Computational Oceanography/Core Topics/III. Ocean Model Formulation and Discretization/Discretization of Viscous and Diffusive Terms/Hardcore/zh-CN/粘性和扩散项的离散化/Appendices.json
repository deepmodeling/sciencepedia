{
    "hands_on_practices": [
        {
            "introduction": "显式时间积分方案因其简单性而备受青睐，但它们在求解扩散问题时是条件稳定的。本练习将引导你运用冯·诺伊曼稳定性分析这一基本工具，来确定一个高阶空间离散格式的稳定性条件。通过推导这个约束，你将深刻理解时间步长、网格间距和物理扩散系数之间相互关联的内在机制()，这是设计和运行稳健数值模拟的一项关键技能。",
            "id": "3791055",
            "problem": "考虑在一个长度为 $L$ 的周期性域中，一个理想化的海洋混合层内被动示踪剂的一维扩散。该区域具有均匀的网格间距 $\\Delta x$ 和恒定的扩散系数 $\\kappa$（单位为 $\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$）。从菲克第一扩散定律 $J = -\\kappa\\,\\partial_{x} C$ 和局部守恒 $\\partial_{t} C + \\partial_{x} J = 0$ 出发，得到连续扩散方程为 $\\partial_{t} C = \\kappa\\,\\partial_{x x} C$。定义 $u(x,t)$ 为示踪剂浓度，并令 $u_{i}(t)$ 表示在周期性边界条件下其在网格点 $x_{i} = i\\,\\Delta x$ 处的值。使用四阶精度的五点中心有限差分格式对空间二阶导数 $\\partial_{x x} u$ 进行离散化\n$$\n\\delta_{x x}^{(4)} u_{i} \\;=\\; \\frac{-\\,u_{i-2} \\;+\\; 16\\,u_{i-1} \\;-\\; 30\\,u_{i} \\;+\\; 16\\,u_{i+1} \\;-\\; u_{i+2}}{12\\,\\Delta x^{2}}\\,,\n$$\n并构建半离散系统\n$$\n\\frac{\\mathrm{d} u_{i}}{\\mathrm{d} t} \\;=\\; \\kappa\\,\\delta_{x x}^{(4)} u_{i}\\,.\n$$\n使用前向欧拉法对该系统进行时间推进\n$$\nu_{i}^{n+1} \\;=\\; u_{i}^{n} \\;+\\; \\Delta t\\,\\kappa\\,\\delta_{x x}^{(4)} u_{i}^{n}\\,,\n$$\n其中 $\\Delta t$ 是时间步长。使用与周期性边界条件一致的傅里叶模态 ansatz，并通过严格的放大因子分析，推导该显式格式线性稳定性的最大允许时间步长 $\\Delta t_{\\max}$，并将其表示为 $\\kappa$ 和 $\\Delta x$ 的解析表达式。将您关于 $\\Delta t_{\\max}$ 的最终答案以秒为单位表示。不要提供不等式；请给出 $\\Delta t_{\\max}$ 的一个封闭形式表达式。",
            "solution": "该问题是有效的，因为它在应用于计算海洋学的数值分析领域提出了一个适定的、有科学依据的问题。所有必要的信息都已提供，问题没有矛盾或含糊之处。\n\n任务是确定一个用于近似一维扩散方程 $\\partial_{t} u = \\kappa\\,\\partial_{x x} u$ 的数值格式的线性稳定性极限。该格式对空间导数采用四阶中心差分，对时间积分采用前向欧拉法。我们将使用 von Neumann 稳定性分析方法来研究这个显式格式的稳定性，该方法适用于周期性域上的常系数线性问题。\n\n完全离散的格式由下式给出：\n$$ u_{i}^{n+1} \\;=\\; u_{i}^{n} \\;+\\; \\Delta t\\,\\kappa\\,\\delta_{x x}^{(4)} u_{i}^{n} $$\n代入四阶有限差分算子 $\\delta_{x x}^{(4)}$ 的定义，我们得到：\n$$ u_{i}^{n+1} \\;=\\; u_{i}^{n} \\;+\\; \\frac{\\kappa \\Delta t}{12\\,\\Delta x^{2}} \\left( -u_{i-2}^{n} \\;+\\; 16\\,u_{i-1}^{n} \\;-\\; 30\\,u_{i}^{n} \\;+\\; 16\\,u_{i+1}^{n} \\;-\\; u_{i+2}^{n} \\right) $$\n对于 von Neumann 分析，我们考虑在网格点 $x_i = i\\Delta x$ 和时间步 $n$ 处的数值解的单个傅里叶模态 ansatz：\n$$ u_{i}^{n} = G(k)^{n} \\hat{u}_{0}(k) \\exp(I k x_{i}) $$\n其中 $k$ 是波数，$I = \\sqrt{-1}$ 是虚数单位，$\\hat{u}_{0}(k)$ 是该模态的初始振幅，$G(k)$ 是放大因子，表示每个时间步长模态振幅所乘的因子。该格式稳定的充分必要条件是，对于所有可能的波数，放大因子的模长小于或等于 1，即 $|G(k)| \\le 1$。\n\n将 ansatz 代入网格点 $i-2, i-1, i, i+1, i+2$ 的离散方程中：\n\\begin{align*} u_{j}^{n} = G^{n} \\hat{u}_{0} \\exp(I k j \\Delta x) \\\\ u_{j}^{n+1} = G^{n+1} \\hat{u}_{0} \\exp(I k j \\Delta x) \\end{align*}\n离散方程变为：\n$$ G^{n+1} \\hat{u}_{0} \\exp(I k i \\Delta x) = G^{n} \\hat{u}_{0} \\exp(I k i \\Delta x) + \\frac{\\kappa \\Delta t}{12\\,\\Delta x^{2}} G^{n} \\hat{u}_{0} \\left( -\\exp(I k (i-2) \\Delta x) + \\dots - \\exp(I k (i+2) \\Delta x) \\right) $$\n两边同除以公共非零因子 $G^{n} \\hat{u}_{0} \\exp(I k i \\Delta x)$，得到放大因子 $G = G(k)$ 的表达式：\n$$ G = 1 + \\frac{\\kappa \\Delta t}{12\\,\\Delta x^{2}} \\left( -\\exp(-2 I k \\Delta x) + 16 \\exp(-I k \\Delta x) - 30 + 16 \\exp(I k \\Delta x) - \\exp(2 I k \\Delta x) \\right) $$\n令 $\\theta = k \\Delta x$ 为无量纲波数，或每个网格单元的相角。我们将复指数项分组：\n$$ G = 1 + \\frac{\\kappa \\Delta t}{12\\,\\Delta x^{2}} \\left( 16(\\exp(I \\theta) + \\exp(-I \\theta)) - (\\exp(2 I \\theta) + \\exp(-2 I \\theta)) - 30 \\right) $$\n使用欧拉公式 $\\cos(\\phi) = \\frac{\\exp(I\\phi) + \\exp(-I\\phi)}{2}$，我们可以简化表达式：\n$$ G(\\theta) = 1 + \\frac{\\kappa \\Delta t}{12\\,\\Delta x^{2}} \\left( 32\\cos(\\theta) - 2\\cos(2\\theta) - 30 \\right) $$\n放大因子 $G(\\theta)$ 是一个实值函数，这对于应用于扩散方程的对称空间格式是符合预期的。因此，稳定性条件 $|G(\\theta)| \\le 1$ 等价于双重不等式 $-1 \\le G(\\theta) \\le 1$。\n\n我们将扩散问题的 Courant-Friedrichs-Lewy (CFL) 数定义为 $r = \\frac{\\kappa \\Delta t}{\\Delta x^{2}}$。$G(\\theta)$ 的表达式变为：\n$$ G(\\theta) = 1 + \\frac{r}{12} \\left( 32\\cos(\\theta) - 2\\cos(2\\theta) - 30 \\right) $$\n稳定性条件是：\n$$ -1 \\le 1 + \\frac{r}{12} \\left( 32\\cos(\\theta) - 2\\cos(2\\theta) - 30 \\right) \\le 1 $$\n不等式各部分都减去 1，得到：\n$$ -2 \\le \\frac{r}{12} \\left( 32\\cos(\\theta) - 2\\cos(2\\theta) - 30 \\right) \\le 0 $$\n我们来分析三角多项式 $P(\\theta) = 32\\cos(\\theta) - 2\\cos(2\\theta) - 30$。使用二倍角恒等式 $\\cos(2\\theta) = 2\\cos^{2}(\\theta) - 1$：\n$$ P(\\theta) = 32\\cos(\\theta) - 2(2\\cos^{2}(\\theta) - 1) - 30 = -4\\cos^{2}(\\theta) + 32\\cos(\\theta) - 28 $$\n这可以因式分解为：\n$$ P(\\theta) = -4(\\cos^{2}(\\theta) - 8\\cos(\\theta) + 7) = -4(\\cos(\\theta) - 1)(\\cos(\\theta) - 7) $$\n对于任意实数 $\\theta$，我们有 $-1 \\le \\cos(\\theta) \\le 1$。这意味着因子 $(\\cos(\\theta) - 1)$ 总是小于或等于零，而因子 $(\\cos(\\theta) - 7)$ 总是严格为负。因此，这两个因子的乘积总是大于或等于零。所以，对于所有的 $\\theta$，$P(\\theta) = -4(\\cos(\\theta) - 1)(\\cos(\\theta) - 7) \\le 0$。\n\n由于 $r = \\frac{\\kappa \\Delta t}{\\Delta x^{2}} > 0$ 且 $P(\\theta) \\le 0$，稳定性不等式的右半部分 $\\frac{r}{12} P(\\theta) \\le 0$ 总是满足的。\n\n我们现在必须满足不等式的左半部分：\n$$ -2 \\le \\frac{r}{12} P(\\theta) $$\n由于 $P(\\theta)$ 是非正的，我们可以写成：\n$$ r \\le \\frac{-24}{P(\\theta)} \\quad \\text{for } P(\\theta) \\neq 0 $$\n为了确保对所有可能的波数都稳定，我们必须在使约束最严格的 $\\theta$ 值下满足此条件。这种情况发生在右侧取最小值时，这对应于 $P(\\theta)$ 的最小值。\n我们需要找到 $\\min_{\\theta} P(\\theta)$。令 $y = \\cos(\\theta)$。我们寻求二次函数 $p(y) = -4(y-1)(y-7) = -4y^2 + 32y - 28$ 在区间 $y \\in [-1, 1]$ 上的最小值。这是一个开口向下的抛物线，其顶点在 $y = -\\frac{32}{2(-4)} = 4$。由于顶点在区间 $[-1, 1]$ 之外，该区间上的最小值必然出现在某个端点上。\n在 $y=1$ 处（对应于 $\\theta=0$，最长波长），$p(1) = -4(1-1)(1-7) = 0$。\n在 $y=-1$ 处（对应于 $\\theta = \\pi$，最短可分辨波长或奈奎斯特频率），$p(-1) = -4(-1-1)(-1-7) = -4(-2)(-8) = -64$。\n$P(\\theta)$ 的最小值是 $-64$。这是稳定性的“最坏情况”。\n\n将这个最小值代入稳定性条件中：\n$$ r \\le \\frac{-24}{\\min P(\\theta)} = \\frac{-24}{-64} = \\frac{3 \\times 8}{8 \\times 8} = \\frac{3}{8} $$\n所以，稳定性极限是 $r \\le \\frac{3}{8}$。\n当 Courant 数达到这个最大值时，我们得到最大允许时间步长 $\\Delta t_{\\max}$：\n$$ \\frac{\\kappa \\Delta t_{\\max}}{\\Delta x^{2}} = \\frac{3}{8} $$\n求解 $\\Delta t_{\\max}$ 可得：\n$$ \\Delta t_{\\max} = \\frac{3}{8} \\frac{\\Delta x^{2}}{\\kappa} $$\n该表达式的单位是 $\\mathrm{m}^{2} / (\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}) = \\mathrm{s}$，与时间步长的单位一致。",
            "answer": "$$\n\\boxed{\\frac{3 \\Delta x^{2}}{8 \\kappa}}\n$$"
        },
        {
            "introduction": "海洋等真实环境中，材料属性（例如不同水团之间的扩散系数）常常出现急剧变化。标准的有限差分格式在处理这些界面时可能会失效。本练习将展示如何通过强制施加浓度和通量的物理连续性原则，来构建一个能够正确处理不连续系数的守恒有限体积离散格式。通过推导界面上的有效扩散系数()，你将掌握一种精确模拟非均匀介质中输运现象的强大技术，这是计算海洋学中一个普遍而关键的挑战。",
            "id": "3790999",
            "problem": "在一个代表分层海洋的一维垂直柱中，考虑一个被动示踪剂的扩散，其浓度场 $C(z,t)$ 由菲克扩散 (Fickian diffusion) 控制。控制方程是守恒定律 $\\partial_t C = \\partial_z(\\kappa \\,\\partial_z C)$，其中菲克定律为 $J = -\\kappa\\,\\partial_z C$，$\\kappa$ 是分子或湍流扩散率。假设在位于两个相邻控制体积中心 $z_{i-1}$ 和 $z_i$ 之间的 $z=z_I$ 处存在一个尖锐的物质界面，跨越此界面，扩散率是具有不连续性的分段常数：当 $z  z_I$ 时，扩散率为 $\\kappa_L$；当 $z > z_I$ 时，扩散率为 $\\kappa_R$。假设在界面两侧浓度和通量都是连续的。\n\n采用有限体积法离散化，其中数值通量 $F_{i-\\frac{1}{2}}$ 近似为通过位于 $z_{i-1}$ 和 $z_i$ 中间的单元界面的通量。该数值通量可以写成以下形式：\n$$\nF_{i-\\frac{1}{2}} = -\\kappa_{\\mathrm{face}} \\frac{C_i - C_{i-1}}{d}\n$$\n其中 $C_{i-1}$ 和 $C_i$ 分别是 $z_{i-1}$ 和 $z_i$ 处的浓度值，$d=z_i - z_{i-1}$ 是单元中心之间的距离，$\\kappa_{\\mathrm{face}}$ 是待确定的有效界面扩散率。\n\n为了推导 $\\kappa_{\\mathrm{face}}$，假设浓度场 $C(z)$ 在每个材料区域内呈分段线性分布，即在区间 $[z_{i-1}, z_I]$ 和 $[z_I, z_i]$ 内，$\\partial_z C$ 是常数。\n\n给定以下参数：\n- 单元中心间距：$d = 1.0\\,\\mathrm{m}$\n- 从左侧单元中心到物质界面的距离：$d_L = z_I - z_{i-1} = 0.3\\,\\mathrm{m}$\n- 左侧区域的扩散率：$\\kappa_L = 1.0 \\times 10^{-6}\\,\\mathrm{m^{2}\\,s^{-1}}$\n- 右侧区域的扩散率：$\\kappa_R = 1.0 \\times 10^{-5}\\,\\mathrm{m^{2}\\,s^{-1}}$\n\n计算有效界面扩散率 $\\kappa_{\\mathrm{face}}$ 的数值（单位为 $\\mathrm{m^{2}\\,s^{-1}}$）。将您的答案四舍五入到四位有效数字。",
            "solution": "该问题陈述在科学上是合理的，提法恰当，并为获得唯一解提供了所有必要信息。它描述了一种在有限体积框架下处理扩散方程不连续系数的标准方法。因此，我们可以开始推导。\n\n我们的目标是确定两个控制体积之间界面上的有效扩散率 $\\kappa_{\\mathrm{face}}$，使得数值通量 $F_{i-\\frac{1}{2}}$ 在给定条件下能够正确地表示物理通量。物质界面 $z=z_I$ 处的物理条件是浓度连续，$C(z_I^-) = C(z_I^+)$，和通量连续，$J(z_I^-) = J(z_I^+)$。\n\n问题陈述要求假设在每个物质段内浓度场 $C(z)$ 呈分段线性分布。这意味着在每个段内梯度 $\\partial_z C$ 是一个常数。设单元中心位于 $z_{i-1}$ 和 $z_i$，对应的浓度为 $C_{i-1} = C(z_{i-1})$ 和 $C_i = C(z_i)$。物质界面位于 $z_I$，在 $z_{i-1}$ 和 $z_i$ 之间。\n\n在左侧段，对于 $z \\in [z_{i-1}, z_I]$，浓度分布是线性的。梯度是恒定的，可以表示为：\n$$\n\\left(\\frac{\\partial C}{\\partial z}\\right)_L = \\frac{C_I - C_{i-1}}{z_I - z_{i-1}} = \\frac{C_I - C_{i-1}}{d_L}\n$$\n其中 $C_I$ 是界面 $z=z_I$ 处的浓度，而 $d_L = z_I - z_{i-1}$。\n\n在右侧段，对于 $z \\in [z_I, z_i]$，浓度分布也是线性的。梯度是恒定的，可以表示为：\n$$\n\\left(\\frac{\\partial C}{\\partial z}\\right)_R = \\frac{C_i - C_I}{z_i - z_I} = \\frac{C_i - C_I}{d_R}\n$$\n其中 $d_R = z_i - z_I$。\n\n根据菲克定律，每个段内的扩散通量由 $J = -\\kappa\\,\\partial_z C$ 给出。对于无源区域，在有限体积法中，穿过单元界面的通量 $F_{i-\\frac{1}{2}}$ 在单元中心 $z_{i-1}$ 和 $z_i$ 之间的整个区间内必须是常数。这隐含地满足了在 $z=z_I$ 处的通量连续性条件。\n\n将菲克定律应用于左侧段：\n$$\nF_{i-\\frac{1}{2}} = -\\kappa_L \\left(\\frac{\\partial C}{\\partial z}\\right)_L = -\\kappa_L \\frac{C_I - C_{i-1}}{d_L}\n$$\n对此式求解 $C_I$ 可得：\n$$\nC_I - C_{i-1} = -\\frac{F_{i-\\frac{1}{2}} d_L}{\\kappa_L} \\implies C_I = C_{i-1} - \\frac{F_{i-\\frac{1}{2}} d_L}{\\kappa_L}\n$$\n\n将菲克定律应用于右侧段：\n$$\nF_{i-\\frac{1}{2}} = -\\kappa_R \\left(\\frac{\\partial C}{\\partial z}\\right)_R = -\\kappa_R \\frac{C_i - C_I}{d_R}\n$$\n对此式求解 $C_I$ 可得：\n$$\nC_i - C_I = -\\frac{F_{i-\\frac{1}{2}} d_R}{\\kappa_R} \\implies C_I = C_i + \\frac{F_{i-\\frac{1}{2}} d_R}{\\kappa_R}\n$$\n\n现在我们得到了界面浓度 $C_I$ 的两个表达式。由于浓度必须是连续的，这两个表达式必须相等。令它们相等可以消去未知数 $C_I$：\n$$\nC_{i-1} - \\frac{F_{i-\\frac{1}{2}} d_L}{\\kappa_L} = C_i + \\frac{F_{i-\\frac{1}{2}} d_R}{\\kappa_R}\n$$\n现在，我们求解通量 $F_{i-\\frac{1}{2}}$：\n$$\nC_{i-1} - C_i = F_{i-\\frac{1}{2}} \\left( \\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R} \\right)\n$$\n$$\nF_{i-\\frac{1}{2}} = \\frac{C_{i-1} - C_i}{\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R}} = - \\frac{C_i - C_{i-1}}{\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R}}\n$$\n问题要求将此通量表示为以下形式：\n$$\nF_{i-\\frac{1}{2}} = -\\kappa_{\\mathrm{face}} \\frac{C_i - C_{i-1}}{d}\n$$\n通过将推导出的通量表达式与所要求的形式进行比较，我们可以确定 $\\kappa_{\\mathrm{face}}$ 的表达式：\n$$\n-\\kappa_{\\mathrm{face}} \\frac{C_i - C_{i-1}}{d} = - \\frac{C_i - C_{i-1}}{\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R}}\n$$\n这意味着：\n$$\n\\frac{\\kappa_{\\mathrm{face}}}{d} = \\frac{1}{\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R}}\n$$\n因此，有效界面扩散率为：\n$$\n\\kappa_{\\mathrm{face}} = \\frac{d}{\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R}}\n$$\n这个结果在物理上类似于计算两个串联电阻的等效电导，其中每一层的扩散“阻力”由其厚度除以其扩散率（$d/\\kappa$）给出。总阻力是各个阻力之和，而有效扩散率与此总阻力成反比。\n\n现在，我们代入给定的数值来计算 $\\kappa_{\\mathrm{face}}$：\n$d = 1.0\\,\\mathrm{m}$\n$d_L = 0.3\\,\\mathrm{m}$\n$\\kappa_L = 1.0 \\times 10^{-6}\\,\\mathrm{m^{2}\\,s^{-1}}$\n$\\kappa_R = 1.0 \\times 10^{-5}\\,\\mathrm{m^{2}\\,s^{-1}}$\n\n首先，我们确定 $d_R$：\n$d_R = d - d_L = 1.0\\,\\mathrm{m} - 0.3\\,\\mathrm{m} = 0.7\\,\\mathrm{m}$。\n\n接下来，我们将这些值代入 $\\kappa_{\\mathrm{face}}$ 的表达式中：\n$$\n\\kappa_{\\mathrm{face}} = \\frac{1.0}{\\frac{0.3}{1.0 \\times 10^{-6}} + \\frac{0.7}{1.0 \\times 10^{-5}}}\n$$\n我们来计算分母中的各项：\n$$\n\\frac{d_L}{\\kappa_L} = \\frac{0.3}{1.0 \\times 10^{-6}} = 3.0 \\times 10^5\\,\\mathrm{s\\,m^{-1}}\n$$\n$$\n\\frac{d_R}{\\kappa_R} = \\frac{0.7}{1.0 \\times 10^{-5}} = \\frac{0.7}{10.0 \\times 10^{-6}} = 7.0 \\times 10^4\\,\\mathrm{s\\,m^{-1}}\n$$\n分母的和为：\n$$\n\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R} = (3.0 \\times 10^5) + (0.7 \\times 10^5) = 3.7 \\times 10^5\\,\\mathrm{s\\,m^{-1}}\n$$\n现在我们可以计算 $\\kappa_{\\mathrm{face}}$：\n$$\n\\kappa_{\\mathrm{face}} = \\frac{1.0}{3.7 \\times 10^5} = \\frac{1}{3.7} \\times 10^{-5} \\approx 0.270270... \\times 10^{-5}\\,\\mathrm{m^{2}\\,s^{-1}}\n$$\n用标准科学记数法表示，即为：\n$$\n\\kappa_{\\mathrm{face}} \\approx 2.70270... \\times 10^{-6}\\,\\mathrm{m^{2}\\,s^{-1}}\n$$\n根据问题陈述的要求，四舍五入到四位有效数字，我们得到：\n$$\n\\kappa_{\\mathrm{face}} \\approx 2.703 \\times 10^{-6}\\,\\mathrm{m^{2}\\,s^{-1}}\n$$",
            "answer": "$$\n\\boxed{2.703 \\times 10^{-6}}\n$$"
        },
        {
            "introduction": "在推导和分析了数值方案之后，最关键的一步是在代码中正确实现它并验证其准确性。本练习将采用已知解析解的方法进行代码验证，通过将数值输出与精确解进行比较，我们可以量化我们实现的误差。这项动手编码任务()将理论分析与实际应用联系起来，你将实现显式（FTCS）和隐式（Crank-Nicolson）两种方案，测量它们的数值误差，并直接观察稳定性与准确性等理论概念在计算实验中是如何体现的。",
            "id": "3791011",
            "problem": "要求您量化在计算海洋学中，因离散一维空间中示踪剂浓度场的扩散项而产生的数值误差。考虑由线性偏微分方程（PDE）控制的一维示踪剂扩散：$$\\frac{\\partial C}{\\partial t} = \\kappa \\frac{\\partial^2 C}{\\partial x^2},$$ 其中 $C(x,t)$ 是以千克/立方米（$\\mathrm{kg/m^3}$）为单位的示踪剂浓度，$x$ 是以米（$\\mathrm{m}$）为单位的水平坐标，$t$ 是以秒（$\\mathrm{s}$）为单位的时间，而 $\\kappa$ 是以平方米/秒（$\\mathrm{m^2/s}$）为单位的分子扩散系数。初始条件是一个高斯斑：$$C(x,0) = A \\exp\\left(-\\frac{(x-x_0)^2}{2 s_0^2}\\right),$$ 其中心位于 $x_0$，振幅为 $A$，标准差为 $s_0$。定义域为有限区间 $[0,L]$，具有齐次诺伊曼边界条件：$$\\frac{\\partial C}{\\partial x}(0,t) = 0, \\quad \\frac{\\partial C}{\\partial x}(L,t) = 0.$$ 假设在所选参数和模拟时间范围内，定义域足够大，使得边界不会显著干扰解。\n\n从该偏微分方程和高斯初始条件的定义出发，通过以下步骤推导出一个离散模型：\n- 使用二阶中心有限差分法在均匀网格（间距为 $\\Delta x$）上近似二阶导数 $\\frac{\\partial^2 C}{\\partial x^2}$，并使用幽灵单元实现齐次诺伊曼边界条件。\n- 使用前向时间中心空间（FTCS）显式格式或克兰克-尼科尔森（Crank–Nicolson）隐式格式进行时间推进。对于 FTCS，请注意稳定性对时间步长 $\\Delta t$ 相对于 $\\Delta x$ 和 $\\kappa$ 存在限制。\n- 使用无限域上高斯初始条件的解析解，$$C_{\\text{exact}}(x,t) = A \\frac{s_0}{\\sqrt{s_0^2 + 2 \\kappa t}} \\exp\\left(-\\frac{(x-x_0)^2}{2 \\left(s_0^2 + 2 \\kappa t\\right)}\\right),$$ 作为参考，以估计在最终时间 $t_f$ 的数值误差。\n\n您的程序必须：\n1. 在 $[0,L]$ 上构建空间网格，其均匀间距为 $\\Delta x$，网格点数为 $N$，使得 $N = \\left\\lfloor \\frac{L}{\\Delta x} \\right\\rfloor + 1$，并将实际网格间距设置为 $\\Delta x_{\\text{eff}} = \\frac{L}{N-1}$。将高斯中心置于 $x_0 = \\frac{L}{2}$。\n2. 使用幽灵单元实现带有齐次诺伊曼边界条件的离散拉普拉斯算子，其中 $C_{-1} \\equiv C_{1}$ 和 $C_{N} \\equiv C_{N-2}$，从而得到边界处的二阶导数：$$\\left.\\frac{\\partial^2 C}{\\partial x^2}\\right|_{i=0} \\approx \\frac{2 C_1 - 2 C_0}{\\Delta x_{\\text{eff}}^2}, \\quad \\left.\\frac{\\partial^2 C}{\\partial x^2}\\right|_{i=N-1} \\approx \\frac{2 C_{N-2} - 2 C_{N-1}}{\\Delta x_{\\text{eff}}^2},$$ 以及内部的二阶导数：$$\\left.\\frac{\\partial^2 C}{\\partial x^2}\\right|_{i} \\approx \\frac{C_{i+1} - 2 C_{i} + C_{i-1}}{\\Delta x_{\\text{eff}}^2}.$$\n3. 使用 FTCS $$C^{n+1} = C^n + \\kappa \\Delta t \\, \\Delta_x C^n,$$（其中 $\\Delta_x$ 表示离散拉普拉斯算子）或 Crank–Nicolson $$\\left(I - \\frac{\\kappa \\Delta t}{2} \\Delta_x\\right) C^{n+1} = \\left(I + \\frac{\\kappa \\Delta t}{2} \\Delta_x\\right) C^n$$ 将解推进到 $t_f$。使用 $n_{\\text{steps}} = \\mathrm{round}\\left(\\frac{t_f}{\\Delta t}\\right)$ 并设置 $\\Delta t_{\\text{eff}} = \\frac{t_f}{n_{\\text{steps}}}$，以确保精确达到最终时间。\n4. 使用上述公式计算网格点上的解析解 $C_{\\text{exact}}(x,t_f)$。\n5. 报告每个测试案例的均方根（RMS）误差：$$E_{\\mathrm{RMS}} = \\sqrt{\\frac{1}{N} \\sum_{i=0}^{N-1} \\left(C_i(t_f) - C_{\\text{exact}}(x_i,t_f)\\right)^2}$$ 以千克/立方米（$\\mathrm{kg/m^3}$）为单位表示 RMS 误差。\n\n除非另有说明，所有测试案例均使用以下科学上一致的参数：$L = 100{,}000 \\, \\mathrm{m}$，$A = 1 \\, \\mathrm{kg/m^3}$，$s_0 = 5{,}000 \\, \\mathrm{m}$，$\\kappa = 100 \\, \\mathrm{m^2/s}$，$t_f = 2{,}000{,}000 \\, \\mathrm{s}$。空间离散化和时间步长因案例而异。高斯中心位于 $x_0 = L/2$。\n\n测试套件：\n- 案例 1（通用稳定 FTCS）：方法 FTCS，$\\Delta x = 1{,}000 \\, \\mathrm{m}$，$\\Delta t = 2{,}000 \\, \\mathrm{s}$。\n- 案例 2（FTCS 接近稳定性极限）：方法 FTCS，$\\Delta x = 1{,}000 \\, \\mathrm{m}$，$\\Delta t = 4{,}900 \\, \\mathrm{s}$。\n- 案例 3（FTCS 粗空间网格）：方法 FTCS，$\\Delta x = 5{,}000 \\, \\mathrm{m}$，$\\Delta t = 120{,}000 \\, \\mathrm{s}$。\n- 案例 4（Crank–Nicolson 大时间步长）：方法 Crank–Nicolson，$\\Delta x = 1{,}000 \\, \\mathrm{m}$，$\\Delta t = 20{,}000 \\, \\mathrm{s}$。\n\n您的程序应生成一行输出，其中包含案例 1 到案例 4 的 RMS 误差（单位为 $\\mathrm{kg/m^3}$），按顺序排列，格式为用方括号括起来的逗号分隔列表（例如，“[e1,e2,e3,e4]”）。",
            "solution": "所提出的问题是数值分析中一个明确定义的练习，具体涉及抛物线型偏微分方程的求解。它在科学上是合理的，数学上是一致的，并为进行求解提供了所有必要的信息。\n\n控制物理过程是一维扩散，由线性偏微分方程（PDE）描述：\n$$\n\\frac{\\partial C}{\\partial t} = \\kappa \\frac{\\partial^2 C}{\\partial x^2}\n$$\n这里，$C(x,t)$ 是作为空间坐标 $x$ 和时间 $t$ 的函数的示踪剂浓度，$\\kappa$ 是常数扩散系数。\n\n系统在 $t=0$ 时的初始状态是一个高斯分布：\n$$\nC(x,0) = A \\exp\\left(-\\frac{(x-x_0)^2}{2 s_0^2}\\right)\n$$\n其中 $A$ 是峰值振幅，$x_0$ 是中心，$s_0$ 是初始标准差。\n\n空间域是有限区间 $[0, L]$，边界条件为零通量（齐次诺伊曼条件）：\n$$\n\\frac{\\partial C}{\\partial x}(0,t) = 0, \\quad \\frac{\\partial C}{\\partial x}(L,t) = 0\n$$\n\n为了进行比较，问题提供了无限域上的精确解析解，该解在模拟时间 $t_f$ 内边界效应可以忽略不计的假设下是有效的：\n$$\nC_{\\text{exact}}(x,t) = A \\frac{s_0}{\\sqrt{s_0^2 + 2 \\kappa t}} \\exp\\left(-\\frac{(x-x_0)^2}{2 \\left(s_0^2 + 2 \\kappa t\\right)}\\right)\n$$\n\n为了数值求解该偏微分方程，我们首先将空间域离散化为一个均匀网格。按照问题的规定，网格点数为 $N = \\left\\lfloor \\frac{L}{\\Delta x} \\right\\rfloor + 1$，这导致有效网格间距为 $\\Delta x_{\\text{eff}} = \\frac{L}{N-1}$。网格点位于 $x_i = i \\cdot \\Delta x_{\\text{eff}}$，其中 $i=0, 1, \\dots, N-1$。浓度场 $C(x,t)$ 由一个长度为 $N$ 的向量 $\\mathbf{C}(t)$ 表示，其中第 $i$ 个分量 $C_i(t)$ 近似于 $C(x_i, t)$。\n\n二阶空间导数 $\\frac{\\partial^2 C}{\\partial x^2}$ 使用二阶中心有限差分格式进行近似。这可以表示为矩阵形式 $\\frac{\\partial^2 \\mathbf{C}}{\\partial x^2} \\approx \\frac{1}{\\Delta x_{\\text{eff}}^2} \\mathbf{L} \\mathbf{C}$，其中 $\\mathbf{L}$ 是离散拉普拉斯矩阵。对于内部点（$0  i  N-1$），近似值为 $\\frac{C_{i+1} - 2C_i + C_{i-1}}{\\Delta x_{\\text{eff}}^2}$。齐次诺伊曼边界条件通过使用幽灵单元来实现，其中域外的浓度被反射，即 $C_{-1} = C_1$ 和 $C_{N} = C_{N-2}$。这导致了在边界处的指定二阶导数近似值：\n- 在 $i=0$ 处：$\\frac{2C_1 - 2C_0}{\\Delta x_{\\text{eff}}^2}$\n- 在 $i=N-1$ 处：$\\frac{2C_{N-2} - 2C_{N-1}}{\\Delta x_{\\text{eff}}^2}$\n\n相应的 $N \\times N$ 矩阵 $\\mathbf{L}$ 是一个三对角矩阵：\n$$\n\\mathbf{L} = \n\\begin{pmatrix}\n-2  2  0  \\cdots  0 \\\\\n1  -2  1  \\cdots  0 \\\\\n0  1  -2  1  \\cdots \\\\\n\\vdots    \\ddots    \\vdots \\\\\n0  \\cdots  0  2  -2\n\\end{pmatrix}\n$$\n第一行是 $[ -2, 2, 0, \\dots ]$，最后一行是 $[ \\dots, 0, 2, -2 ]$。\n\n通过这种空间离散化，半离散的偏微分方程变成了关于向量 $\\mathbf{C}(t)$ 的常微分方程：\n$$\n\\frac{d\\mathbf{C}}{dt} = \\frac{\\kappa}{\\Delta x_{\\text{eff}}^2} \\mathbf{L} \\mathbf{C}\n$$\n\n然后对该系统进行时间积分。我们用步长 $\\Delta t$ 对时间进行离散化，其中步数为 $n_{\\text{steps}} = \\mathrm{round}(t_f/\\Delta t)$，有效时间步长为 $\\Delta t_{\\text{eff}} = t_f/n_{\\text{steps}}$。令 $\\mathbf{C}^n$ 为时间 $t_n = n \\Delta t_{\\text{eff}}$ 时的数值解。\n\n**前向时间中心空间（FTCS）** 格式是一种显式方法，定义为：\n$$\n\\mathbf{C}^{n+1} = \\mathbf{C}^n + \\Delta t_{\\text{eff}} \\left( \\frac{\\kappa}{\\Delta x_{\\text{eff}}^2} \\mathbf{L} \\mathbf{C}^n \\right) = \\left( \\mathbf{I} + \\alpha \\mathbf{L} \\right) \\mathbf{C}^n\n$$\n其中 $\\mathbf{I}$ 是单位矩阵，$\\alpha = \\frac{\\kappa \\Delta t_{\\text{eff}}}{\\Delta x_{\\text{eff}}^2}$ 是无量纲扩散数。该格式是条件稳定的，要求 $\\alpha \\le 1/2$。\n\n**克兰克-尼科尔森（Crank–Nicolson）** 格式是一种隐式方法，通过对时间 $n$ 和 $n+1$ 处的空间导数进行平均来定义：\n$$\n\\frac{\\mathbf{C}^{n+1} - \\mathbf{C}^n}{\\Delta t_{\\text{eff}}} = \\frac{1}{2} \\left( \\frac{\\kappa}{\\Delta x_{\\text{eff}}^2} \\mathbf{L} \\mathbf{C}^n + \\frac{\\kappa}{\\Delta x_{\\text{eff}}^2} \\mathbf{L} \\mathbf{C}^{n+1} \\right)\n$$\n重新整理各项以求解 $\\mathbf{C}^{n+1}$，得到一个线性方程组：\n$$\n\\left( \\mathbf{I} - \\frac{\\alpha}{2} \\mathbf{L} \\right) \\mathbf{C}^{n+1} = \\left( \\mathbf{I} + \\frac{\\alpha}{2} \\mathbf{L} \\right) \\mathbf{C}^n\n$$\n对于所有 $\\alpha > 0$ 的值，该格式都是无条件稳定的。在每个时间步，都必须为未知数 $\\mathbf{C}^{n+1}$ 求解这个线性系统。\n\n每个测试案例的算法步骤如下：\n1.  设置共享的物理参数：$L = 100000$，$A = 1$，$s_0 = 5000$，$\\kappa = 100$，$t_f = 2000000$，以及 $x_0 = L/2$。\n2.  对于具体案例，根据给定的名义 $\\Delta x$ 确定空间网格参数 $N$ 和 $\\Delta x_{\\text{eff}}$。\n3.  根据给定的名义 $\\Delta t$ 确定时间步进参数 $n_{\\text{steps}}$ 和 $\\Delta t_{\\text{eff}}$。\n4.  构建空间网格向量 $\\mathbf{x} = [x_0, x_1, \\dots, x_{N-1}]$。\n5.  通过在每个网格点 $x_i$ 处计算 $C(x,0)$ 来初始化浓度向量 $\\mathbf{C}^0$。\n6.  构建离散拉普拉斯矩阵 $\\mathbf{L}$。\n7.  根据指定的方法（FTCS 或 Crank-Nicolson），执行时间步进迭代 $n_{\\text{steps}}$ 次，以找到最终的数值解 $\\mathbf{C}(t_f)$。\n    - 对于 FTCS，应用显式更新规则。\n    - 对于 Crank-Nicolson，构建左侧矩阵 $\\mathbf{M}_{\\text{lhs}} = \\mathbf{I} - \\frac{\\alpha}{2}\\mathbf{L}$ 和右侧矩阵 $\\mathbf{M}_{\\text{rhs}} = \\mathbf{I} + \\frac{\\alpha}{2}\\mathbf{L}$。在每一步中，计算 $\\mathbf{b} = \\mathbf{M}_{\\text{rhs}} \\mathbf{C}^n$ 并求解系统 $\\mathbf{M}_{\\text{lhs}} \\mathbf{C}^{n+1} = \\mathbf{b}$。\n8.  通过在每个网格点 $x_i$ 处计算 $C_{\\text{exact}}(x, t_f)$ 来计算精确解向量 $\\mathbf{C}_{\\text{exact}}(t_f)$。\n9.  计算最终数值解与精确解之间的均方根（RMS）误差：\n$$\nE_{\\mathrm{RMS}} = \\sqrt{\\frac{1}{N} \\sum_{i=0}^{N-1} \\left(C_i(t_f) - C_{\\text{exact}}(x_i,t_f)\\right)^2}\n$$\n对所提供的四个测试案例中的每一个都执行此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries are needed for this implementation.\n\ndef run_simulation(case_params, shared_params):\n    \"\"\"\n    Runs a single simulation case for the 1D diffusion equation.\n\n    Args:\n        case_params (dict): Parameters for the specific test case.\n        shared_params (dict): Parameters shared across all cases.\n\n    Returns:\n        float: The RMS error for the case.\n    \"\"\"\n    # Unpack parameters\n    method = case_params['method']\n    dx_nominal = case_params['dx']\n    dt_nominal = case_params['dt']\n    \n    L = shared_params['L']\n    A = shared_params['A']\n    s0 = shared_params['s0']\n    kappa = shared_params['kappa']\n    tf = shared_params['tf']\n    x0 = L / 2.0\n\n    # 1. Construct the spatial grid\n    N = int(np.floor(L / dx_nominal)) + 1\n    dx_eff = L / (N - 1)\n    x = np.linspace(0, L, N)\n\n    # 2. Set up initial condition\n    C = A * np.exp(-(x - x0)**2 / (2 * s0**2))\n\n    # 3. Set up time stepping\n    n_steps = int(round(tf / dt_nominal))\n    dt_eff = tf / n_steps\n\n    # 4. Construct discrete Laplacian matrix L with Neumann BCs\n    L_mat = np.zeros((N, N))\n    # Interior points\n    for i in range(1, N - 1):\n        L_mat[i, i-1] = 1\n        L_mat[i, i]   = -2\n        L_mat[i, i+1] = 1\n    # Boundary points (Neumann)\n    L_mat[0, 0] = -2\n    L_mat[0, 1] = 2\n    L_mat[N-1, N-2] = 2\n    L_mat[N-1, N-1] = -2\n\n    # 5. Perform time integration\n    alpha = kappa * dt_eff / dx_eff**2\n\n    if method == 'FTCS':\n        # FTCS stability check\n        if alpha > 0.5:\n             # This problem sets up cases that are stable, but it is good practice.\n             # In a real scenario, one would raise an error.\n             # print(f\"Warning: FTCS stability condition not met. alpha = {alpha}\")\n             pass\n        \n        M_update = np.identity(N) + alpha * L_mat\n        for _ in range(n_steps):\n            C = M_update @ C\n\n    elif method == 'Crank-Nicolson':\n        I = np.identity(N)\n        A_lhs = I - (alpha / 2.0) * L_mat\n        B_rhs = I + (alpha / 2.0) * L_mat\n        for _ in range(n_steps):\n            b = B_rhs @ C\n            C = np.linalg.solve(A_lhs, b)\n\n    # 6. Compute analytic solution at tf\n    s_tf = np.sqrt(s0**2 + 2 * kappa * tf)\n    C_exact = A * (s0 / s_tf) * np.exp(-(x - x0)**2 / (2 * s_tf**2))\n\n    # 7. Compute RMS error\n    rms_error = np.sqrt(np.mean((C - C_exact)**2))\n    \n    return rms_error\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define shared parameters from the problem statement\n    shared_params = {\n        'L': 100000.0,      # m\n        'A': 1.0,           # kg/m^3\n        's0': 5000.0,       # m\n        'kappa': 100.0,     # m^2/s\n        'tf': 2000000.0,    # s\n    }\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        {'method': 'FTCS', 'dx': 1000.0, 'dt': 2000.0},\n        {'method': 'FTCS', 'dx': 1000.0, 'dt': 4900.0},\n        {'method': 'FTCS', 'dx': 5000.0, 'dt': 120000.0},\n        {'method': 'Crank-Nicolson', 'dx': 1000.0, 'dt': 20000.0},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(case, shared_params)\n        results.append(result)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}