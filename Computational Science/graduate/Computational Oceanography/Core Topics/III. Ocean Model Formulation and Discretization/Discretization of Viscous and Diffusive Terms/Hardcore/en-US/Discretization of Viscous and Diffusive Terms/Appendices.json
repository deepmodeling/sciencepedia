{
    "hands_on_practices": [
        {
            "introduction": "Real-world ocean environments are rarely uniform; they are often stratified, featuring sharp changes in properties like temperature, salinity, and, consequently, turbulent diffusivity. A robust numerical model must correctly handle these jumps in parameters while upholding fundamental physical laws like the continuity of flux. This analytical exercise guides you through deriving a conservative finite-volume discretization for a diffusive flux across such a material interface, leading to the powerful concept of an effective face diffusivity that correctly represents the underlying physics .",
            "id": "3790999",
            "problem": "In a one-dimensional vertical column representative of a stratified ocean, consider the diffusion of a passive tracer with concentration field $C(z,t)$ governed by Fickian diffusion. The governing equation is the conservation law $\\partial_t C = \\partial_z(\\kappa \\,\\partial_z C)$ with Fick’s law of diffusion $J = -\\kappa\\,\\partial_z C$, where $\\kappa$ is the molecular or turbulent diffusivity. Suppose that across a sharp material interface located at $z=z_I$ between two adjacent control-volume centers at $z_{i-1}$ and $z_i$, the diffusivity is piecewise constant with a discontinuity: $\\kappa(z) = \\kappa_L$ for $z<z_I$ and $\\kappa(z) = \\kappa_R$ for $z>z_I$. Physically realistic matching conditions at $z=z_I$ are continuity of the tracer, $C(z_I^-)=C(z_I^+)$, and continuity of the diffusive flux, $-\\kappa_L\\,\\partial_z C|_{z_I^-} = -\\kappa_R\\,\\partial_z C|_{z_I^+}$ (no singular source at the interface).\n\nYou are to construct a conservative finite-volume discretization of the diffusive flux between the two adjacent control volumes centered at $z_{i-1}$ and $z_i$ that is consistent with these interface conditions, even when $z_I$ does not coincide with either center. Let the center-to-center distance be $d = z_i - z_{i-1}$, and let the interface location be such that $d_L = z_I - z_{i-1}$ and $d_R = z_i - z_I$, so that $d = d_L + d_R$. Assume cross-sectional area equal to unity and piecewise linear profiles of $C$ within each material segment.\n\nDerive from first principles an expression of the form\n$$\nF_{i-\\frac{1}{2}} \\;=\\; -\\,\\kappa_{\\mathrm{face}}\\,\\frac{C_i - C_{i-1}}{d},\n$$\nwhere $F_{i-\\frac{1}{2}}$ is the diffusive flux from cell $i-1$ to cell $i$, and $\\kappa_{\\mathrm{face}}$ is an effective face diffusivity that enforces continuity of flux and the correct jump in gradient at $z_I$. Then, for the specific case\n$\\,d = 1.0\\,\\mathrm{m}$, $\\,d_L = 0.3\\,\\mathrm{m}$, $\\,\\kappa_L = 1.0 \\times 10^{-6}\\,\\mathrm{m^{2}\\,s^{-1}}$, and $\\,\\kappa_R = 1.0 \\times 10^{-5}\\,\\mathrm{m^{2}\\,s^{-1}}$, evaluate $\\kappa_{\\mathrm{face}}$.\n\nExpress the final answer in $\\mathrm{m^{2}\\,s^{-1}}$ and round to four significant figures.",
            "solution": "The problem statement is scientifically grounded, well-posed, and provides all necessary information for a unique solution. It describes a standard method for handling discontinuous coefficients in a finite-volume framework for the diffusion equation. We may therefore proceed with the derivation.\n\nThe goal is to determine the effective diffusivity at the face between two control volumes, $\\kappa_{\\mathrm{face}}$, such that the numerical flux $F_{i-\\frac{1}{2}}$ correctly represents the physical flux under the given conditions. The physical conditions at the material interface $z=z_I$ are continuity of concentration, $C(z_I^-) = C(z_I^+)$, and continuity of flux, $J(z_I^-) = J(z_I^+)$.\n\nThe problem states to assume piecewise linear profiles of the concentration field $C(z)$ within each material segment. This means that the gradient $\\partial_z C$ is constant within each segment. Let the cell centers be at $z_{i-1}$ and $z_i$, with corresponding concentrations $C_{i-1} = C(z_{i-1})$ and $C_i = C(z_i)$. The material interface is at $z_I$, which lies between $z_{i-1}$ and $z_i$.\n\nIn the left segment, for $z \\in [z_{i-1}, z_I]$, the concentration profile is linear. The gradient is constant and can be expressed as:\n$$\n\\left(\\frac{\\partial C}{\\partial z}\\right)_L = \\frac{C_I - C_{i-1}}{z_I - z_{i-1}} = \\frac{C_I - C_{i-1}}{d_L}\n$$\nwhere $C_I$ is the concentration at the interface $z=z_I$, and $d_L = z_I - z_{i-1}$.\n\nIn the right segment, for $z \\in [z_I, z_i]$, the concentration profile is also linear. The gradient is constant and can be expressed as:\n$$\n\\left(\\frac{\\partial C}{\\partial z}\\right)_R = \\frac{C_i - C_I}{z_i - z_I} = \\frac{C_i - C_I}{d_R}\n$$\nwhere $d_R = z_i - z_I$.\n\nAccording to Fick's law, the diffusive flux in each segment is given by $J = -\\kappa\\,\\partial_z C$. In a finite-volume method for a source-free region, the flux across the cell face, $F_{i-\\frac{1}{2}}$, must be constant throughout the interval between the cell centers $z_{i-1}$ and $z_i$. This implicitly satisfies the flux continuity condition at $z=z_I$.\n\nApplying Fick's law to the left segment:\n$$\nF_{i-\\frac{1}{2}} = -\\kappa_L \\left(\\frac{\\partial C}{\\partial z}\\right)_L = -\\kappa_L \\frac{C_I - C_{i-1}}{d_L}\n$$\nSolving this for $C_I$ gives:\n$$\nC_I - C_{i-1} = -\\frac{F_{i-\\frac{1}{2}} d_L}{\\kappa_L} \\implies C_I = C_{i-1} - \\frac{F_{i-\\frac{1}{2}} d_L}{\\kappa_L}\n$$\n\nApplying Fick's law to the right segment:\n$$\nF_{i-\\frac{1}{2}} = -\\kappa_R \\left(\\frac{\\partial C}{\\partial z}\\right)_R = -\\kappa_R \\frac{C_i - C_I}{d_R}\n$$\nSolving this for $C_I$ gives:\n$$\nC_i - C_I = -\\frac{F_{i-\\frac{1}{2}} d_R}{\\kappa_R} \\implies C_I = C_i + \\frac{F_{i-\\frac{1}{2}} d_R}{\\kappa_R}\n$$\n\nWe now have two expressions for the interface concentration $C_I$. Since the concentration must be continuous, these two expressions must be equal. Equating them allows us to eliminate the unknown $C_I$:\n$$\nC_{i-1} - \\frac{F_{i-\\frac{1}{2}} d_L}{\\kappa_L} = C_i + \\frac{F_{i-\\frac{1}{2}} d_R}{\\kappa_R}\n$$\nNow, we solve for the flux $F_{i-\\frac{1}{2}}$:\n$$\nC_{i-1} - C_i = F_{i-\\frac{1}{2}} \\left( \\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R} \\right)\n$$\n$$\nF_{i-\\frac{1}{2}} = \\frac{C_{i-1} - C_i}{\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R}} = - \\frac{C_i - C_{i-1}}{\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R}}\n$$\nThe problem requires this flux to be expressed in the form:\n$$\nF_{i-\\frac{1}{2}} = -\\kappa_{\\mathrm{face}} \\frac{C_i - C_{i-1}}{d}\n$$\nBy comparing the derived expression for the flux with the required form, we can identify the expression for $\\kappa_{\\mathrm{face}}$:\n$$\n-\\kappa_{\\mathrm{face}} \\frac{C_i - C_{i-1}}{d} = - \\frac{C_i - C_{i-1}}{\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R}}\n$$\nThis implies:\n$$\n\\frac{\\kappa_{\\mathrm{face}}}{d} = \\frac{1}{\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R}}\n$$\nTherefore, the effective face diffusivity is:\n$$\n\\kappa_{\\mathrm{face}} = \\frac{d}{\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R}}\n$$\nThis result is physically analogous to calculating the equivalent conductance of two resistors in series, where the \"resistance\" to diffusion in each layer is given by its thickness divided by its diffusivity ($d/\\kappa$). The total resistance is the sum of the individual resistances, and the effective diffusivity is inversely proportional to this total resistance.\n\nNow, we evaluate $\\kappa_{\\mathrm{face}}$ for the given numerical values:\n$d = 1.0\\,\\mathrm{m}$\n$d_L = 0.3\\,\\mathrm{m}$\n$\\kappa_L = 1.0 \\times 10^{-6}\\,\\mathrm{m^{2}\\,s^{-1}}$\n$\\kappa_R = 1.0 \\times 10^{-5}\\,\\mathrm{m^{2}\\,s^{-1}}$\n\nFirst, we determine $d_R$:\n$d_R = d - d_L = 1.0\\,\\mathrm{m} - 0.3\\,\\mathrm{m} = 0.7\\,\\mathrm{m}$.\n\nNext, we substitute these values into the expression for $\\kappa_{\\mathrm{face}}$:\n$$\n\\kappa_{\\mathrm{face}} = \\frac{1.0}{\\frac{0.3}{1.0 \\times 10^{-6}} + \\frac{0.7}{1.0 \\times 10^{-5}}}\n$$\nLet's compute the terms in the denominator:\n$$\n\\frac{d_L}{\\kappa_L} = \\frac{0.3}{1.0 \\times 10^{-6}} = 3.0 \\times 10^5\\,\\mathrm{s\\,m^{-1}}\n$$\n$$\n\\frac{d_R}{\\kappa_R} = \\frac{0.7}{1.0 \\times 10^{-5}} = \\frac{0.7}{10.0 \\times 10^{-6}} = 7.0 \\times 10^4\\,\\mathrm{s\\,m^{-1}}\n$$\nThe sum in the denominator is:\n$$\n\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R} = (3.0 \\times 10^5) + (0.7 \\times 10^5) = 3.7 \\times 10^5\\,\\mathrm{s\\,m^{-1}}\n$$\nNow we can compute $\\kappa_{\\mathrm{face}}$:\n$$\n\\kappa_{\\mathrm{face}} = \\frac{1.0}{3.7 \\times 10^5} = \\frac{1}{3.7} \\times 10^{-5} \\approx 0.270270... \\times 10^{-5}\\,\\mathrm{m^{2}\\,s^{-1}}\n$$\nIn standard scientific notation, this is:\n$$\n\\kappa_{\\mathrm{face}} \\approx 2.70270... \\times 10^{-6}\\,\\mathrm{m^{2}\\,s^{-1}}\n$$\nRounding to four significant figures, as required by the problem statement, we get:\n$$\n\\kappa_{\\mathrm{face}} \\approx 2.703 \\times 10^{-6}\\,\\mathrm{m^{2}\\,s^{-1}}\n$$",
            "answer": "$$\n\\boxed{2.703 \\times 10^{-6}}\n$$"
        },
        {
            "introduction": "After mastering the discretization of the spatial operator, the next step is to construct and evaluate a full time-dependent solver. This hands-on computational exercise tasks you with implementing two foundational time-stepping schemes for the one-dimensional diffusion equation: the explicit Forward-Time Centered-Space (FTCS) method and the unconditionally stable implicit Crank-Nicolson method . By comparing your numerical results to a known analytical solution, you will gain practical experience in quantifying numerical error and directly observing the performance trade-offs between explicit and implicit approaches.",
            "id": "3791011",
            "problem": "You are asked to quantify numerical errors arising from discretizing diffusive terms in one spatial dimension for a tracer concentration field in computational oceanography. Consider the one-dimensional tracer diffusion governed by the linear Partial Differential Equation (PDE) $$\\frac{\\partial C}{\\partial t} = \\kappa \\frac{\\partial^2 C}{\\partial x^2},$$ where $C(x,t)$ is the tracer concentration measured in kilograms per cubic meter ($\\mathrm{kg\\,m^{-3}}$), $x$ is the horizontal coordinate in meters ($\\mathrm{m}$), $t$ is time in seconds ($\\mathrm{s}$), and $\\kappa$ is the molecular diffusivity in square meters per second ($\\mathrm{m^2\\,s^{-1}}$). The initial condition is a Gaussian blob $$C(x,0) = A \\exp\\left(-\\frac{(x-x_0)^2}{2 s_0^2}\\right),$$ centered at $x_0$ with amplitude $A$ and standard deviation $s_0$. The domain is the finite interval $[0,L]$ with homogeneous Neumann boundary conditions $$\\frac{\\partial C}{\\partial x}(0,t) = 0, \\quad \\frac{\\partial C}{\\partial x}(L,t) = 0.$$ Assume the domain is sufficiently large that the boundaries do not significantly perturb the solution for the chosen parameters over the simulated time horizon.\n\nStarting from the PDE and the definition of the Gaussian initial condition, derive a discrete model by:\n- Approximating the second derivative $\\frac{\\partial^2 C}{\\partial x^2}$ using second-order centered finite differences on a uniform grid with spacing $\\Delta x$, and homogeneous Neumann boundary conditions implemented via ghost-cell reflections.\n- Advancing in time using either the Forward Time Centered Space (FTCS) explicit scheme or the Crank–Nicolson implicit scheme. For FTCS, recall that stability imposes a restriction on the time step size $\\Delta t$ relative to $\\Delta x$ and $\\kappa$.\n- Using the analytic solution on an infinite domain for the Gaussian initial condition, $$C_{\\text{exact}}(x,t) = A \\frac{s_0}{\\sqrt{s_0^2 + 2 \\kappa t}} \\exp\\left(-\\frac{(x-x_0)^2}{2 \\left(s_0^2 + 2 \\kappa t\\right)}\\right),$$ as a reference to estimate numerical errors at a final time $t_f$.\n\nYour program must:\n1. Construct the spatial grid over $[0,L]$ with uniform spacing $\\Delta x$ and $N$ grid points such that $N = \\left\\lfloor \\frac{L}{\\Delta x} \\right\\rfloor + 1$, and set the actual grid spacing to $\\Delta x_{\\text{eff}} = \\frac{L}{N-1}$. Place the Gaussian center at $x_0 = \\frac{L}{2}$.\n2. Implement the discrete Laplacian with homogeneous Neumann boundary conditions using ghost cells where $C_{-1} \\equiv C_{1}$ and $C_{N} \\equiv C_{N-2}$, resulting in boundary second derivatives $$\\left.\\frac{\\partial^2 C}{\\partial x^2}\\right|_{i=0} \\approx \\frac{2 C_1 - 2 C_0}{\\Delta x_{\\text{eff}}^2}, \\quad \\left.\\frac{\\partial^2 C}{\\partial x^2}\\right|_{i=N-1} \\approx \\frac{2 C_{N-2} - 2 C_{N-1}}{\\Delta x_{\\text{eff}}^2},$$ and interior second derivatives $$\\left.\\frac{\\partial^2 C}{\\partial x^2}\\right|_{i} \\approx \\frac{C_{i+1} - 2 C_{i} + C_{i-1}}{\\Delta x_{\\text{eff}}^2}.$$\n3. Advance the solution to $t_f$ using either FTCS $$C^{n+1} = C^n + \\kappa \\Delta t \\, \\Delta_x C^n,$$ where $\\Delta_x$ denotes the discrete Laplacian, or Crank–Nicolson $$\\left(I - \\frac{\\kappa \\Delta t}{2} \\Delta_x\\right) C^{n+1} = \\left(I + \\frac{\\kappa \\Delta t}{2} \\Delta_x\\right) C^n.$$ Use $n_{\\text{steps}} = \\mathrm{round}\\left(\\frac{t_f}{\\Delta t}\\right)$ and set $\\Delta t_{\\text{eff}} = \\frac{t_f}{n_{\\text{steps}}}$ so that the final time is reached exactly.\n4. Compute the analytic solution $C_{\\text{exact}}(x,t_f)$ at grid points using the formula above.\n5. Report the root-mean-square (RMS) error $$E_{\\mathrm{RMS}} = \\sqrt{\\frac{1}{N} \\sum_{i=0}^{N-1} \\left(C_i(t_f) - C_{\\text{exact}}(x_i,t_f)\\right)^2}$$ for each test case. Express the RMS error in kilograms per cubic meter ($\\mathrm{kg\\,m^{-3}}$).\n\nUse the following scientifically consistent parameters shared by all test cases unless otherwise specified: $L = 100{,}000 \\, \\mathrm{m}$, $A = 1 \\, \\mathrm{kg\\,m^{-3}}$, $s_0 = 5{,}000 \\, \\mathrm{m}$, $\\kappa = 100 \\, \\mathrm{m^2\\,s^{-1}}$, $t_f = 2{,}000{,}000 \\, \\mathrm{s}$. The spatial discretization and time step will vary per case. The Gaussian center is at $x_0 = L/2$.\n\nTest Suite:\n- Case 1 (general stable FTCS): method FTCS, $\\Delta x = 1{,}000 \\, \\mathrm{m}$, $\\Delta t = 2{,}000 \\, \\mathrm{s}$.\n- Case 2 (FTCS near stability limit): method FTCS, $\\Delta x = 1{,}000 \\, \\mathrm{m}$, $\\Delta t = 4{,}900 \\, \\mathrm{s}$.\n- Case 3 (FTCS coarse spatial grid): method FTCS, $\\Delta x = 5{,}000 \\, \\mathrm{m}$, $\\Delta t = 120{,}000 \\, \\mathrm{s}$.\n- Case 4 (Crank–Nicolson with large time step): method Crank–Nicolson, $\\Delta x = 1{,}000 \\, \\mathrm{m}$, $\\Delta t = 20{,}000 \\, \\mathrm{s}$.\n\nYour program should produce a single line of output containing the RMS errors in $\\mathrm{kg\\,m^{-3}}$ for Case 1 through Case 4, in order, as a comma-separated list enclosed in square brackets (e.g., \"[e1,e2,e3,e4]\").",
            "solution": "The problem posed is a well-defined exercise in numerical analysis, specifically pertaining to the solution of a parabolic partial differential equation. It is scientifically sound, mathematically consistent, and provides all necessary information to proceed with a solution.\n\nThe governing physical process is one-dimensional diffusion, described by the linear partial differential equation (PDE):\n$$\n\\frac{\\partial C}{\\partial t} = \\kappa \\frac{\\partial^2 C}{\\partial x^2}\n$$\nHere, $C(x,t)$ is the tracer concentration as a function of spatial coordinate $x$ and time $t$, and $\\kappa$ is the constant diffusivity.\n\nThe initial state of the system at $t=0$ is a Gaussian distribution:\n$$\nC(x,0) = A \\exp\\left(-\\frac{(x-x_0)^2}{2 s_0^2}\\right)\n$$\nwhere $A$ is the peak amplitude, $x_0$ is the center, and $s_0$ is the initial standard deviation.\n\nThe spatial domain is the finite interval $[0, L]$, with boundary conditions of zero flux (homogeneous Neumann conditions):\n$$\n\\frac{\\partial C}{\\partial x}(0,t) = 0, \\quad \\frac{\\partial C}{\\partial x}(L,t) = 0\n$$\n\nFor comparison, the problem provides the exact analytical solution on an infinite domain, which is valid under the assumption that boundary effects are negligible over the simulation time $t_f$:\n$$\nC_{\\text{exact}}(x,t) = A \\frac{s_0}{\\sqrt{s_0^2 + 2 \\kappa t}} \\exp\\left(-\\frac{(x-x_0)^2}{2 \\left(s_0^2 + 2 \\kappa t\\right)}\\right)\n$$\n\nTo solve the PDE numerically, we first discretize the spatial domain into a uniform grid. Following the problem's prescription, the number of grid points is $N = \\left\\lfloor \\frac{L}{\\Delta x} \\right\\rfloor + 1$, leading to an effective grid spacing of $\\Delta x_{\\text{eff}} = \\frac{L}{N-1}$. The grid points are located at $x_i = i \\cdot \\Delta x_{\\text{eff}}$ for $i=0, 1, \\dots, N-1$. The concentration field $C(x,t)$ is represented by a vector $\\mathbf{C}(t)$ of length $N$, where the $i$-th component $C_i(t)$ approximates $C(x_i, t)$.\n\nThe second spatial derivative, $\\frac{\\partial^2 C}{\\partial x^2}$, is approximated using a second-order centered finite difference scheme. This can be expressed in matrix form as $\\frac{\\partial^2 \\mathbf{C}}{\\partial x^2} \\approx \\frac{1}{\\Delta x_{\\text{eff}}^2} \\mathbf{L} \\mathbf{C}$, where $\\mathbf{L}$ is the discrete Laplacian matrix. For interior points ($0 < i < N-1$), the approximation is $\\frac{C_{i+1} - 2C_i + C_{i-1}}{\\Delta x_{\\text{eff}}^2}$. The homogeneous Neumann boundary conditions are implemented using ghost cells, where the concentration outside the domain is reflected, i.e., $C_{-1} = C_1$ and $C_{N} = C_{N-2}$. This leads to the specified second derivative approximations at the boundaries:\n- At $i=0$: $\\frac{2C_1 - 2C_0}{\\Delta x_{\\text{eff}}^2}$\n- At $i=N-1$: $\\frac{2C_{N-2} - 2C_{N-1}}{\\Delta x_{\\text{eff}}^2}$\n\nThe corresponding $N \\times N$ matrix $\\mathbf{L}$ is a tridiagonal matrix:\n$$\n\\mathbf{L} = \n\\begin{pmatrix}\n-2 & 2 & 0 & \\cdots & 0 \\\\\n1 & -2 & 1 & \\cdots & 0 \\\\\n0 & 1 & -2 & 1 & \\cdots \\\\\n\\vdots & & \\ddots & & \\vdots \\\\\n0 & \\cdots & 2 & -2\n\\end{pmatrix}\n$$\nThe first row is $[ -2, 2, 0, \\dots ]$ and the last row is $[ \\dots, 0, 2, -2 ]$.\n\nWith this spatial discretization, the semi-discrete PDE becomes an ordinary differential equation in time for the vector $\\mathbf{C}(t)$:\n$$\n\\frac{d\\mathbf{C}}{dt} = \\frac{\\kappa}{\\Delta x_{\\text{eff}}^2} \\mathbf{L} \\mathbf{C}\n$$\n\nThis system is then integrated in time. We discretize time with a step $\\Delta t$, where the number of steps is $n_{\\text{steps}} = \\mathrm{round}(t_f/\\Delta t)$ and the effective time step is $\\Delta t_{\\text{eff}} = t_f/n_{\\text{steps}}$. Let $\\mathbf{C}^n$ be the numerical solution at time $t_n = n \\Delta t_{\\text{eff}}$.\n\nThe **Forward Time Centered Space (FTCS)** scheme is an explicit method defined as:\n$$\n\\mathbf{C}^{n+1} = \\mathbf{C}^n + \\Delta t_{\\text{eff}} \\left( \\frac{\\kappa}{\\Delta x_{\\text{eff}}^2} \\mathbf{L} \\mathbf{C}^n \\right) = \\left( \\mathbf{I} + \\alpha \\mathbf{L} \\right) \\mathbf{C}^n\n$$\nwhere $\\mathbf{I}$ is the identity matrix and $\\alpha = \\frac{\\kappa \\Delta t_{\\text{eff}}}{\\Delta x_{\\text{eff}}^2}$ is the non-dimensional diffusion number. This scheme is conditionally stable, requiring $\\alpha \\le 1/2$.\n\nThe **Crank–Nicolson** scheme is an implicit method defined by averaging the spatial derivative at times $n$ and $n+1$:\n$$\n\\frac{\\mathbf{C}^{n+1} - \\mathbf{C}^n}{\\Delta t_{\\text{eff}}} = \\frac{1}{2} \\left( \\frac{\\kappa}{\\Delta x_{\\text{eff}}^2} \\mathbf{L} \\mathbf{C}^n + \\frac{\\kappa}{\\Delta x_{\\text{eff}}^2} \\mathbf{L} \\mathbf{C}^{n+1} \\right)\n$$\nRearranging terms to solve for $\\mathbf{C}^{n+1}$ gives a linear system of equations:\n$$\n\\left( \\mathbf{I} - \\frac{\\alpha}{2} \\mathbf{L} \\right) \\mathbf{C}^{n+1} = \\left( \\mathbf{I} + \\frac{\\alpha}{2} \\mathbf{L} \\right) \\mathbf{C}^n\n$$\nThis scheme is unconditionally stable for all values of $\\alpha > 0$. At each time step, one must solve this linear system for the unknown $\\mathbf{C}^{n+1}$.\n\nThe algorithmic procedure for each test case is as follows:\n1.  Set the shared physical parameters: $L = 100000$, $A = 1$, $s_0 = 5000$, $\\kappa = 100$, $t_f = 2000000$, and $x_0 = L/2$.\n2.  For the specific case, determine the spatial grid parameters $N$ and $\\Delta x_{\\text{eff}}$ from the given nominal $\\Delta x$.\n3.  Determine the temporal stepping parameters $n_{\\text{steps}}$ and $\\Delta t_{\\text{eff}}$ from the given nominal $\\Delta t$.\n4.  Construct the spatial grid vector $\\mathbf{x} = [x_0, x_1, \\dots, x_{N-1}]$.\n5.  Initialize the concentration vector $\\mathbf{C}^0$ by evaluating $C(x,0)$ at each grid point $x_i$.\n6.  Construct the discrete Laplacian matrix $\\mathbf{L}$.\n7.  Based on the specified method (FTCS or Crank-Nicolson), perform the time-stepping iteration for $n_{\\text{steps}}$ steps to find the final numerical solution $\\mathbf{C}(t_f)$.\n    - For FTCS, apply the explicit update rule.\n    - For Crank-Nicolson, construct the left-hand side matrix $\\mathbf{M}_{\\text{lhs}} = \\mathbf{I} - \\frac{\\alpha}{2}\\mathbf{L}$ and right-hand side matrix $\\mathbf{M}_{\\text{rhs}} = \\mathbf{I} + \\frac{\\alpha}{2}\\mathbf{L}$. In each step, compute $\\mathbf{b} = \\mathbf{M}_{\\text{rhs}} \\mathbf{C}^n$ and solve the system $\\mathbf{M}_{\\text{lhs}} \\mathbf{C}^{n+1} = \\mathbf{b}$.\n8.  Calculate the exact solution vector $\\mathbf{C}_{\\text{exact}}(t_f)$ by evaluating $C_{\\text{exact}}(x, t_f)$ at each grid point $x_i$.\n9.  Compute the root-mean-square (RMS) error between the final numerical and exact solutions:\n$$\nE_{\\mathrm{RMS}} = \\sqrt{\\frac{1}{N} \\sum_{i=0}^{N-1} \\left(C_i(t_f) - C_{\\text{exact}}(x_i,t_f)\\right)^2}\n$$\nThis procedure is implemented for each of the four test cases provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries are needed for this implementation.\n\ndef run_simulation(case_params, shared_params):\n    \"\"\"\n    Runs a single simulation case for the 1D diffusion equation.\n\n    Args:\n        case_params (dict): Parameters for the specific test case.\n        shared_params (dict): Parameters shared across all cases.\n\n    Returns:\n        float: The RMS error for the case.\n    \"\"\"\n    # Unpack parameters\n    method = case_params['method']\n    dx_nominal = case_params['dx']\n    dt_nominal = case_params['dt']\n    \n    L = shared_params['L']\n    A = shared_params['A']\n    s0 = shared_params['s0']\n    kappa = shared_params['kappa']\n    tf = shared_params['tf']\n    x0 = L / 2.0\n\n    # 1. Construct the spatial grid\n    N = int(np.floor(L / dx_nominal)) + 1\n    dx_eff = L / (N - 1)\n    x = np.linspace(0, L, N)\n\n    # 2. Set up initial condition\n    C = A * np.exp(-(x - x0)**2 / (2 * s0**2))\n\n    # 3. Set up time stepping\n    n_steps = int(round(tf / dt_nominal))\n    dt_eff = tf / n_steps\n\n    # 4. Construct discrete Laplacian matrix L with Neumann BCs\n    L_mat = np.zeros((N, N))\n    # Interior points\n    for i in range(1, N - 1):\n        L_mat[i, i-1] = 1\n        L_mat[i, i]   = -2\n        L_mat[i, i+1] = 1\n    # Boundary points (Neumann)\n    L_mat[0, 0] = -2\n    L_mat[0, 1] = 2\n    L_mat[N-1, N-2] = 2\n    L_mat[N-1, N-1] = -2\n\n    # 5. Perform time integration\n    alpha = kappa * dt_eff / dx_eff**2\n\n    if method == 'FTCS':\n        # FTCS stability check\n        if alpha > 0.5:\n             # This problem sets up cases that are stable, but it is good practice.\n             # In a real scenario, one would raise an error.\n             # print(f\"Warning: FTCS stability condition not met. alpha = {alpha}\")\n             pass\n        \n        M_update = np.identity(N) + alpha * L_mat\n        for _ in range(n_steps):\n            C = M_update @ C\n\n    elif method == 'Crank-Nicolson':\n        I = np.identity(N)\n        A_lhs = I - (alpha / 2.0) * L_mat\n        B_rhs = I + (alpha / 2.0) * L_mat\n        for _ in range(n_steps):\n            b = B_rhs @ C\n            C = np.linalg.solve(A_lhs, b)\n\n    # 6. Compute analytic solution at tf\n    s_tf = np.sqrt(s0**2 + 2 * kappa * tf)\n    C_exact = A * (s0 / s_tf) * np.exp(-(x - x0)**2 / (2 * s_tf**2))\n\n    # 7. Compute RMS error\n    rms_error = np.sqrt(np.mean((C - C_exact)**2))\n    \n    return rms_error\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define shared parameters from the problem statement\n    shared_params = {\n        'L': 100000.0,      # m\n        'A': 1.0,           # kg/m^3\n        's0': 5000.0,       # m\n        'kappa': 100.0,     # m^2/s\n        'tf': 2000000.0,    # s\n    }\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        {'method': 'FTCS', 'dx': 1000.0, 'dt': 2000.0},\n        {'method': 'FTCS', 'dx': 1000.0, 'dt': 4900.0},\n        {'method': 'FTCS', 'dx': 5000.0, 'dt': 120000.0},\n        {'method': 'Crank-Nicolson', 'dx': 1000.0, 'dt': 20000.0},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(case, shared_params)\n        results.append(result)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While second-order schemes are workhorses in computational modeling, higher-order methods can provide significantly greater accuracy for smooth solutions, allowing for coarser grids. This advantage, however, often comes with more restrictive stability constraints for explicit schemes. This advanced analytical problem challenges you to apply Fourier (von Neumann) stability analysis to a fourth-order spatial stencil, a common choice for high-fidelity simulations . By rigorously deriving the exact stability limit from first principles, you will develop a crucial skill for designing, analyzing, and using advanced numerical models effectively.",
            "id": "3791055",
            "problem": "Consider one-dimensional diffusion of a passive tracer in an idealized oceanic mixed layer on a periodic domain of length $L$, with uniform grid spacing $\\Delta x$ and constant diffusivity $\\kappa$ (units of $\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$). Starting from Fick’s first law of diffusion $J = -\\kappa\\,\\partial_{x} C$ and local conservation $\\partial_{t} C + \\partial_{x} J = 0$, the continuous diffusion equation is $\\partial_{t} C = \\kappa\\,\\partial_{x x} C$. Define $u(x,t)$ as the tracer concentration and let $u_{i}(t)$ denote its value at grid point $x_{i} = i\\,\\Delta x$ under periodic boundary conditions. Discretize the spatial second derivative $\\partial_{x x} u$ with the fourth-order accurate, five-point central finite-difference stencil\n$$\n\\delta_{x x}^{(4)} u_{i} \\;=\\; \\frac{-\\,u_{i-2} \\;+\\; 16\\,u_{i-1} \\;-\\; 30\\,u_{i} \\;+\\; 16\\,u_{i+1} \\;-\\; u_{i+2}}{12\\,\\Delta x^{2}}\\,,\n$$\nand form the semi-discrete system\n$$\n\\frac{\\mathrm{d} u_{i}}{\\mathrm{d} t} \\;=\\; \\kappa\\,\\delta_{x x}^{(4)} u_{i}\\,.\n$$\nAdvance this system in time using the forward Euler method\n$$\nu_{i}^{n+1} \\;=\\; u_{i}^{n} \\;+\\; \\Delta t\\,\\kappa\\,\\delta_{x x}^{(4)} u_{i}^{n}\\,,\n$$\nwhere $\\Delta t$ is the time step. Using a Fourier-mode ansatz consistent with periodic boundary conditions and a rigorous amplification-factor analysis, derive the largest admissible time step $\\Delta t_{\\max}$ for linear stability of the explicit scheme as an analytic expression in terms of $\\kappa$ and $\\Delta x$. Express your final answer for $\\Delta t_{\\max}$ in seconds. Do not provide an inequality; give a single closed-form expression for $\\Delta t_{\\max}$.",
            "solution": "The problem is valid as it presents a well-posed, scientifically grounded question in the field of numerical analysis as applied to computational oceanography. All necessary information is provided, and the problem is free of contradictions or ambiguities.\n\nThe task is to determine the linear stability limit for a numerical scheme that approximates the one-dimensional diffusion equation, $\\partial_{t} u = \\kappa\\,\\partial_{x x} u$. The scheme employs a fourth-order central difference for the spatial derivative and a forward Euler method for time integration. The stability of this explicit scheme will be investigated using the von Neumann stability analysis method, which is appropriate for linear problems with constant coefficients on a periodic domain.\n\nThe fully discrete scheme is given by:\n$$ u_{i}^{n+1} \\;=\\; u_{i}^{n} \\;+\\; \\Delta t\\,\\kappa\\,\\delta_{x x}^{(4)} u_{i}^{n} $$\nSubstituting the definition of the fourth-order finite-difference operator, $\\delta_{x x}^{(4)}$, we have:\n$$ u_{i}^{n+1} \\;=\\; u_{i}^{n} \\;+\\; \\frac{\\kappa \\Delta t}{12\\,\\Delta x^{2}} \\left( -u_{i-2}^{n} \\;+\\; 16\\,u_{i-1}^{n} \\;-\\; 30\\,u_{i}^{n} \\;+\\; 16\\,u_{i+1}^{n} \\;-\\; u_{i+2}^{n} \\right) $$\nFor the von Neumann analysis, we consider a single Fourier mode ansatz for the numerical solution at grid point $x_i = i\\Delta x$ and time step $n$:\n$$ u_{i}^{n} = G(k)^{n} \\hat{u}_{0}(k) \\exp(I k x_{i}) $$\nwhere $k$ is the wavenumber, $I = \\sqrt{-1}$ is the imaginary unit, $\\hat{u}_{0}(k)$ is the initial amplitude of the mode, and $G(k)$ is the amplification factor, which represents the factor by which the amplitude of the mode is multiplied at each time step. The scheme is stable if and only if the magnitude of the amplification factor is less than or equal to one for all possible wavenumbers, i.e., $|G(k)| \\le 1$.\n\nSubstituting the ansatz into the discrete equation for grid points $i-2, i-1, i, i+1, i+2$:\n\\begin{align*} u_{j}^{n} &= G^{n} \\hat{u}_{0} \\exp(I k j \\Delta x) \\\\ u_{j}^{n+1} &= G^{n+1} \\hat{u}_{0} \\exp(I k j \\Delta x) \\end{align*}\nThe discrete equation becomes:\n$$ G^{n+1} \\hat{u}_{0} \\exp(I k i \\Delta x) = G^{n} \\hat{u}_{0} \\exp(I k i \\Delta x) + \\frac{\\kappa \\Delta t}{12\\,\\Delta x^{2}} G^{n} \\hat{u}_{0} \\left( -\\exp(I k (i-2) \\Delta x) + \\dots - \\exp(I k (i+2) \\Delta x) \\right) $$\nDividing through by the common non-zero factor $G^{n} \\hat{u}_{0} \\exp(I k i \\Delta x)$ yields the expression for the amplification factor $G = G(k)$:\n$$ G = 1 + \\frac{\\kappa \\Delta t}{12\\,\\Delta x^{2}} \\left( -\\exp(-2 I k \\Delta x) + 16 \\exp(-I k \\Delta x) - 30 + 16 \\exp(I k \\Delta x) - \\exp(2 I k \\Delta x) \\right) $$\nLet $\\theta = k \\Delta x$ be the non-dimensional wavenumber, or phase angle per grid cell. We group the complex exponential terms:\n$$ G = 1 + \\frac{\\kappa \\Delta t}{12\\,\\Delta x^{2}} \\left( 16(\\exp(I \\theta) + \\exp(-I \\theta)) - (\\exp(2 I \\theta) + \\exp(-2 I \\theta)) - 30 \\right) $$\nUsing Euler's identity, $\\cos(\\phi) = \\frac{\\exp(I\\phi) + \\exp(-I\\phi)}{2}$, we can simplify the expression:\n$$ G(\\theta) = 1 + \\frac{\\kappa \\Delta t}{12\\,\\Delta x^{2}} \\left( 32\\cos(\\theta) - 2\\cos(2\\theta) - 30 \\right) $$\nThe amplification factor $G(\\theta)$ is a real-valued function, as expected for a symmetric spatial stencil applied to the diffusion equation. Therefore, the stability condition $|G(\\theta)| \\le 1$ is equivalent to the double inequality $-1 \\le G(\\theta) \\le 1$.\n\nLet's define the Courant-Friedrichs-Lewy (CFL) number for diffusion as $r = \\frac{\\kappa \\Delta t}{\\Delta x^{2}}$. The expression for $G(\\theta)$ becomes:\n$$ G(\\theta) = 1 + \\frac{r}{12} \\left( 32\\cos(\\theta) - 2\\cos(2\\theta) - 30 \\right) $$\nThe stability condition is:\n$$ -1 \\le 1 + \\frac{r}{12} \\left( 32\\cos(\\theta) - 2\\cos(2\\theta) - 30 \\right) \\le 1 $$\nSubtracting $1$ from all parts of the inequality gives:\n$$ -2 \\le \\frac{r}{12} \\left( 32\\cos(\\theta) - 2\\cos(2\\theta) - 30 \\right) \\le 0 $$\nLet's analyze the trigonometric polynomial $P(\\theta) = 32\\cos(\\theta) - 2\\cos(2\\theta) - 30$. Using the double-angle identity $\\cos(2\\theta) = 2\\cos^{2}(\\theta) - 1$:\n$$ P(\\theta) = 32\\cos(\\theta) - 2(2\\cos^{2}(\\theta) - 1) - 30 = -4\\cos^{2}(\\theta) + 32\\cos(\\theta) - 28 $$\nThis can be factored:\n$$ P(\\theta) = -4(\\cos^{2}(\\theta) - 8\\cos(\\theta) + 7) = -4(\\cos(\\theta) - 1)(\\cos(\\theta) - 7) $$\nFor any real value of $\\theta$, we have $-1 \\le \\cos(\\theta) \\le 1$. This implies that the factor $(\\cos(\\theta) - 1)$ is always less than or equal to zero, and the factor $(\\cos(\\theta) - 7)$ is always strictly negative. The product of these two factors is therefore always greater than or equal to zero. Consequently, $P(\\theta) = -4(\\cos(\\theta) - 1)(\\cos(\\theta) - 7) \\le 0$ for all $\\theta$.\n\nSince $r = \\frac{\\kappa \\Delta t}{\\Delta x^{2}} > 0$ and $P(\\theta) \\le 0$, the right-hand side of the stability inequality, $\\frac{r}{12} P(\\theta) \\le 0$, is always satisfied.\n\nWe must now satisfy the left-hand side of the inequality:\n$$ -2 \\le \\frac{r}{12} P(\\theta) $$\nSince $P(\\theta)$ is non-positive, we can write:\n$$ r \\le \\frac{-24}{P(\\theta)} \\quad \\text{for } P(\\theta) \\neq 0 $$\nTo ensure stability for all possible wavenumbers, we must satisfy this condition for the value of $\\theta$ that makes the constraint most restrictive. This occurs where the right-hand side is minimized, which corresponds to the minimum value of $P(\\theta)$.\nWe need to find $\\min_{\\theta} P(\\theta)$. Let $y = \\cos(\\theta)$. We seek the minimum of the quadratic function $p(y) = -4(y-1)(y-7) = -4y^2 + 32y - 28$ on the interval $y \\in [-1, 1]$. This is a downward-opening parabola with its vertex at $y = -\\frac{32}{2(-4)} = 4$. Since the vertex is outside the interval $[-1, 1]$, the minimum value on this interval must occur at one of the endpoints.\nAt $y=1$ (corresponding to $\\theta=0$, the longest wavelength), $p(1) = -4(1-1)(1-7) = 0$.\nAt $y=-1$ (corresponding to $\\theta = \\pi$, the shortest resolvable wavelength or Nyquist frequency), $p(-1) = -4(-1-1)(-1-7) = -4(-2)(-8) = -64$.\nThe minimum value of $P(\\theta)$ is $-64$. This is the \"worst-case\" scenario for stability.\n\nSubstituting this minimum value into the stability condition:\n$$ r \\le \\frac{-24}{\\min P(\\theta)} = \\frac{-24}{-64} = \\frac{3 \\times 8}{8 \\times 8} = \\frac{3}{8} $$\nSo, the stability limit is $r \\le \\frac{3}{8}$.\nThe largest admissible time step, $\\Delta t_{\\max}$, is obtained when the Courant number reaches this maximum value:\n$$ \\frac{\\kappa \\Delta t_{\\max}}{\\Delta x^{2}} = \\frac{3}{8} $$\nSolving for $\\Delta t_{\\max}$ gives:\n$$ \\Delta t_{\\max} = \\frac{3}{8} \\frac{\\Delta x^{2}}{\\kappa} $$\nThe units of this expression are $\\mathrm{m}^{2} / (\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}) = \\mathrm{s}$, which is consistent with a time step.",
            "answer": "$$\n\\boxed{\\frac{3 \\Delta x^{2}}{8 \\kappa}}\n$$"
        }
    ]
}