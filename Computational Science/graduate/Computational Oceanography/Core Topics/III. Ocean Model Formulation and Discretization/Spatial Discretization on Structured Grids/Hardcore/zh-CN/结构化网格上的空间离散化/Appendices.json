{
    "hands_on_practices": [
        {
            "introduction": "有限差分格式是许多海洋模型的基石。本练习将指导您完成一个基本过程：为任意指定精度的中心差分格式推导其系数。掌握这种基于泰勒级数展开的技术，对于理解、实现甚至创造新的空间导数数值格式至关重要。",
            "id": "3810594",
            "problem": "考虑一个平滑示踪剂场 $u(x)$ 的一维纬向梯度，该场在一个间距为 $h$ 的均匀、结构化海洋模型网格上采样。您希望在一个网格点 $x_{i}$ 处，使用一个宽度为 $2m+1$ 个点（其中 $m \\in \\mathbb{N}$）的中心差分格式来近似 $\\partial_{x} u$，其形式如下：\n$$\n\\partial_{x} u(x_{i}) \\approx \\frac{1}{h} \\sum_{j=-m}^{m} c_{j} \\, u(x_{i} + j h),\n$$\n其中系数 $c_{j}$ 是无量纲的，并且与 $h$ 和 $x_{i}$ 无关。使用关于 $x_{i}$ 点的泰勒级数匹配条件，推导系数 $c_{j}$，使得在该均匀网格上对 $\\partial_{x} u(x_{i})$ 的截断误差为 $\\mathcal{O}(h^{2m})$ 阶。您的推导应从 $u(x_{i} + j h)$ 关于 $x_{i}$ 的泰勒展开开始，对最高 $2m$ 次的多项式强制要求精确性，并强制执行一阶导数的中心差分格式所要求的必要对称性。请将您的最终结果表示为 $c_{j}$ 关于 $m$ 和 $j$ 的单个闭式解析表达式。\n\n不需要数值。请提供关于通用 $m$ 和 $j$ 的表达式。最终答案必须是单个闭式解析表达式（无单位）。",
            "solution": "用户希望我解决以下问题：\n考虑一个平滑示踪剂场 $u(x)$ 的一维纬向梯度，该场在一个间距为 $h$ 的均匀、结构化海洋模型网格上采样。您希望在一个网格点 $x_{i}$ 处，使用一个宽度为 $2m+1$ 个点（其中 $m \\in \\mathbb{N}$）的中心差分格式来近似 $\\partial_{x} u$，其形式如下：\n$$\n\\partial_{x} u(x_{i}) \\approx \\frac{1}{h} \\sum_{j=-m}^{m} c_{j} \\, u(x_{i} + j h),\n$$\n其中系数 $c_{j}$ 是无量纲的，并且与 $h$ 和 $x_{i}$ 无关。使用关于 $x_{i}$ 点的泰勒级数匹配条件，推导系数 $c_{j}$，使得在该均匀网格上对 $\\partial_{x} u(x_{i})$ 的截断误差为 $\\mathcal{O}(h^{2m})$ 阶。您的推导应从 $u(x_{i} + j h)$ 关于 $x_{i}$ 的泰勒展开开始，对最高 $2m$ 次的多项式强制要求精确性，并强制执行一阶导数的中心差分格式所要求的必要对称性。请将您的最终结果表示为 $c_{j}$ 关于 $m$ 和 $j$ 的单个闭式解析表达式。\n\n不需要数值。请提供关于通用 $m$ 和 $j$ 的表达式。最终答案必须是单个闭式解析表达式（无单位）。\n\n### 步骤 1：提取已知条件\n- 待微分的场是一个平滑函数 $u(x)$。\n- 网格是均匀且结构化的，间距为 $h$。\n- 在点 $x_i$ 处，一阶导数 $\\partial_x u$ 的近似由以下公式给出：$\\partial_{x} u(x_{i}) \\approx \\frac{1}{h} \\sum_{j=-m}^{m} c_{j} \\, u(x_{i} + j h)$。\n- 差分格式是中心的，宽度为 $2m+1$ 个点，其中 $m \\in \\mathbb{N}$。\n- 系数 $c_j$ 是无量纲的，且与 $h$ 和 $x_i$ 无关。\n- 所需的截断误差为 $\\mathcal{O}(h^{2m})$ 阶。\n- 推导方法是使用泰勒级数匹配，这等同于要求公式对所有最高 $2m$ 次的多项式都精确。\n- 必须强制执行一阶导数中心差分格式的对称性。\n- 最终目标是得到一个关于 $m$ 和 $j$ 的 $c_j$ 的单个闭式解析表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，因为它是数值分析中发展有限差分格式的一个基本问题，而有限差分格式广泛应用于计算科学与工程领域，包括计算海洋学。该问题是适定的；它要求为给定的差分格式尺寸和精度阶数找到一组唯一的系数，这是一个称为待定系数法的标准程序。问题陈述是客观的，并使用了精确的数学语言。没有矛盾、缺失信息或不切实际的假设。该问题并非微不足道，需要严谨的数学推导。\n\n### 步骤 3：结论与行动\n问题有效。我将继续推导解答。\n\n### 推导\n问题是找到有限差分近似\n$$\n\\partial_{x} u(x_{i}) \\approx \\frac{1}{h} \\sum_{j=-m}^{m} c_{j} u(x_{i} + j h)\n$$\n的系数 $c_j$，使得该近似具有 $\\mathcal{O}(h^{2m})$ 阶的截断误差。\n\n我们首先将 $u(x_{i} + jh)$ 在点 $x_i$ 附近展开为泰勒级数：\n$$\nu(x_i + jh) = \\sum_{k=0}^{\\infty} \\frac{(jh)^k}{k!} \\frac{d^k u}{dx^k}\\bigg|_{x=x_i}\n$$\n将此展开式代入有限差分公式，得到：\n$$\n\\frac{1}{h} \\sum_{j=-m}^{m} c_{j} \\sum_{k=0}^{\\infty} \\frac{(jh)^k}{k!} u^{(k)}(x_i)\n$$\n其中 $u^{(k)}(x_i)$ 表示 $u$ 在 $x_i$ 处的 $k$ 阶导数。我们可以交换求和顺序：\n$$\n\\sum_{k=0}^{\\infty} \\frac{h^{k-1}}{k!} u^{(k)}(x_i) \\left( \\sum_{j=-m}^{m} c_j j^k \\right)\n$$\n我们希望这个表达式是 $\\partial_x u(x_i) = u^{(1)}(x_i)$ 的最佳近似。这意味着我们必须将级数中 $u^{(k)}(x_i)$ 的系数与目标表达式 $1 \\cdot u^{(1)}(x_i)$ 中的系数相匹配。\n这导出了一个关于系数 $c_j$ 的线性方程组：\n$$\n\\frac{h^{k-1}}{k!} \\left( \\sum_{j=-m}^{m} c_j j^k \\right) = \\delta_{k,1}\n$$\n其中 $\\delta_{k,1}$ 是克罗内克 δ。这必须对尽可能多的 $k$ 值成立。该差分格式有 $2m+1$ 个点，允许我们指定 $2m+1$ 个约束条件。为了使该方案具有 $\\mathcal{O}(h^{2m})$ 的截断误差，我们必须确保该公式对于最高 $2m$ 次的多项式是精确的，这对应于满足 $k=0, 1, \\dots, 2m$ 的条件。\n该方程组为：\n$$\n\\sum_{j=-m}^{m} c_j j^k = \\delta_{k,1}, \\quad \\text{对于 } k = 0, 1, 2, \\dots, 2m\n$$\n- 对于 $k=0$: $\\sum_{j=-m}^{m} c_j = 0$\n- 对于 $k=1$: $\\sum_{j=-m}^{m} c_j j = 1$\n- 对于 $k \\in \\{2, 3, \\dots, 2m\\}$: $\\sum_{j=-m}^{m} c_j j^k = 0$\n\n解决这个系统的一个优雅且具有建设性的方法是考虑拉格朗日插值多项式的微分。让我们构建一个次数最多为 $2m$ 的多项式 $P(x)$，它在 $2m+1$ 个模板点 $\\{x_i + jh\\}_{j=-m}^m$ 处对函数 $u(x)$ 进行插值。导数的近似值即为 $u'(x_i) \\approx P'(x_i)$。\n\n我们定义一个局部坐标 $s = (x-x_i)/h$，因此插值节点是整数 $s \\in \\{-m, \\dots, m\\}$。节点 $j$ 的拉格朗日基多项式为：\n$$\n\\ell_j(s) = \\prod_{\\substack{k=-m \\\\ k \\neq j}}^{m} \\frac{s-k}{j-k}\n$$\n插值多项式为 $p(s) = \\sum_{j=-m}^{m} u(x_i+jh) \\ell_j(s)$。关于 $x$ 的导数通过链式法则与关于 $s$ 的导数相关联：$\\frac{d}{dx} = \\frac{ds}{dx}\\frac{d}{ds} = \\frac{1}{h}\\frac{d}{ds}$。\n在 $x=x_i$ (对应于 $s=0$) 处计算导数，得到：\n$$\nP'(x_i) = \\frac{1}{h} \\frac{dp}{ds}\\bigg|_{s=0} = \\frac{1}{h} \\sum_{j=-m}^{m} u(x_i+jh) \\ell_j'(0)\n$$\n通过将其与给定的有限差分公式进行比较，我们确定系数为 $c_j = \\ell_j'(0)$。\n\n为了计算 $\\ell_j'(0)$，我们将 $\\ell_j(s)$ 写成 $N_j(s)/D_j$，其中分子是 $N_j(s) = \\prod_{k=-m, k \\neq j}^{m} (s-k)$，分母是常数 $D_j = \\prod_{k=-m, k \\neq j}^{m} (j-k)$。\n首先，我们分析 $j \\neq 0$ 的情况。我们可以将 $N_j(s)$ 表示为 $\\frac{P(s)}{s-j}$，其中 $P(s) = \\prod_{k=-m}^{m} (s-k)$。\n导数为 $N_j'(s) = \\frac{P'(s)(s-j) - P(s)}{(s-j)^2}$。\n在 $s=0$ 时，这给出 $N_j'(0) = \\frac{P'(0)(-j) - P(0)}{(-j)^2}$。由于 $P(s)$ 包含因子 $s$，我们有 $P(0)=0$。\n因此，$N_j'(0) = \\frac{-j P'(0)}{j^2} = -\\frac{P'(0)}{j}$。\n为了找到 $P'(0)$，我们将 $P(s)$ 写成 $P(s) = s \\prod_{k=1}^{m} (s-k) \\prod_{k=1}^{m} (s+k) = s \\prod_{k=1}^{m} (s^2-k^2)$。\n对 $s$ 求导得出 $P'(s) = \\prod_{k=1}^{m} (s^2-k^2) + s \\frac{d}{ds}\\left(\\prod_{k=1}^{m} (s^2-k^2)\\right)$。\n在 $s=0$ 处求值：$P'(0) = \\prod_{k=1}^{m} (-k^2) = (\\prod_{k=1}^{m} (-1)) (\\prod_{k=1}^{m} k^2) = (-1)^m (m!)^2$。\n所以，对于 $j \\neq 0$，$N_j'(0) = -\\frac{(-1)^m (m!)^2}{j}$。\n\n接下来，我们计算分母 $D_j = \\prod_{k=-m, k \\neq j}^{m} (j-k)$。\n$D_j = \\left(\\prod_{k=-m}^{j-1} (j-k)\\right) \\left(\\prod_{k=j+1}^{m} (j-k)\\right)$。\n第一部分是 $(j-(-m))\\cdots(j-(j-1)) = (j+m)\\cdots(1) = (j+m)!$。\n第二部分是 $(j-(j+1))\\cdots(j-m) = (-1)\\cdots(j-m)$。有 $m-j$ 个项，所以这个乘积是 $(-1)^{m-j} (m-j)!$。\n因此，$D_j = (m+j)! (-1)^{m-j} (m-j)!$。\n\n结合这些结果来求 $j \\neq 0$ 时的 $c_j$：\n$$\nc_j = \\frac{N_j'(0)}{D_j} = \\frac{-\\frac{(-1)^m (m!)^2}{j}}{(-1)^{m-j}(m+j)!(m-j)!} = \\frac{(-1)^{1+m-(m-j)}}{j} \\frac{(m!)^2}{(m+j)!(m-j)!}\n$$\n$$\nc_j = \\frac{(-1)^{j+1}}{j} \\frac{(m!)^2}{(m+j)!(m-j)!}\n$$\n此公式对 $j \\in \\{-m, \\ldots, -1, 1, \\ldots, m\\}$ 有效。\n\n对于 $j=0$ 的情况，我们必须找到 $c_0 = \\ell'_0(0)$。\n问题指定了一阶导数的中心差分格式，这意味着反对称性，$c_{-j} = -c_j$。对于 $j=0$，这要求 $c_0 = -c_0$，即 $c_0=0$。\n或者，从我们的方程组来看，条件 $\\sum_{j=-m}^{m} c_j = 0$ 必须成立。\n推导出的 $j \\neq 0$ 的系数满足反对称性：\n$$\nc_{-j} = \\frac{(-1)^{-j+1}}{-j} \\frac{(m!)^2}{(m-j)!(m+j)!} = - \\frac{(-1)^{-j+1}}{j} \\frac{(m!)^2}{(m-j)!(m+j)!} = - \\frac{(-1)^{j+1}}{j} \\frac{(m!)^2}{(m+j)!(m-j)!} = -c_j\n$$\n因为 $(-1)^{-j+1} = (-1)^{-j+1+2j} = (-1)^{j+1}$。\n使用这个性质，$k=0$ 的求和变为：\n$$\n\\sum_{j=-m}^{m} c_j = c_0 + \\sum_{j=1}^{m} (c_j + c_{-j}) = c_0 + \\sum_{j=1}^{m} (c_j - c_j) = c_0\n$$\n由于这个和必须为零，我们必须有 $c_0=0$。因此，中心点的系数为零。\n\n系数 $c_j$ 的最终表达式由下式给出：$c_0=0$ 且对于 $j \\in \\{-m, \\dots, m\\}$ 且 $j \\neq 0$：\n$$\nc_j = \\frac{(-1)^{j+1}}{j} \\frac{(m!)^2}{(m+j)!(m-j)!}\n$$\n该公式提供了用于一阶导数的 $(2m+1)$ 点中心差分公式的系数，其精度为 $\\mathcal{O}(h^{2m})$ 阶。",
            "answer": "$$\n\\boxed{\\frac{(-1)^{j+1}}{j} \\frac{(m!)^2}{(m+j)!(m-j)!}}\n$$"
        },
        {
            "introduction": "构建了数值格式后，我们必须理解其内在误差，即离散算子对于不同波长的近似效果如何。本实践介绍了“修正波数分析”，这是一个强大的工具，用以量化格式的数值频散（相位误差）和数值耗散（振幅误差）。通过比较简单的一阶格式和更高阶的格式，您将具体理解为何在精确模拟海洋中无处不在的波动传播现象时，高阶格式往往是必需的。",
            "id": "3810592",
            "problem": "考虑在一个均匀、结构化的一维空间网格上的被动示踪物线性平流问题。其控制方程是线性平流方程，这是一个经过充分检验的地球物理输运基础模型，由下式给出：$$\\frac{\\partial T}{\\partial t} + c \\frac{\\partial T}{\\partial x} = 0,$$ 其中 $T(x,t)$ 是示踪物浓度，$c$ 是一个恒定的背景速度。该区域由一个均匀网格离散化，网格间距为 $\\Delta x$，网格点为 $x_i = i \\Delta x$，其中 $i$ 是一个整数索引。\n\n假设一个具有物理波数 $k$ 的正弦示踪物剖面，由下式给出：$$T(x,0) = A \\sin(k x),$$ 其中 $A$ 是一个实数振幅，$k = \\frac{2\\pi}{\\lambda}$，$\\lambda$ 为物理波长。在离散修正波数分析中，我们分析离散空间导数算子对复傅里叶模态的作用：$$T_i = \\exp(\\mathrm{i} k x_i) = \\exp(\\mathrm{i} i \\theta),$$ 其中 $\\theta = k \\Delta x$。对于任何近似 $\\frac{\\partial}{\\partial x}$ 的线性、平移不变的有限差分算子，其对 $T_i$ 的作用等效于乘以一个复符号 $S(\\theta)$，定义为 $$D[T]_i = S(\\theta) \\, T_i.$$ 精确导数对应于 $S_{\\text{exact}}(\\theta) = \\mathrm{i} k$。离散修正波数 $k^\\ast$ 的定义使得 $$\\mathrm{i} k^\\ast = S(\\theta),$$ 因此 $$k^\\ast = -\\mathrm{i} S(\\theta).$$ 实部 $\\operatorname{Re}(k^\\ast)$ 表征了数值色散，虚部 $\\operatorname{Im}(k^\\ast)$ 表征了由空间离散化引起的数值耗散。在线性平流方程下，半离散振幅的演化由增长（或衰减）率 $$\\sigma = c \\, \\operatorname{Im}(k^\\ast),$$ 控制，其单位为秒的倒数，并且当 $c > 0$ 时，对于耗散格式，该值为负。\n\n您的任务是为以下两种适用于 $c > 0$ 的迎风格式，推导并实现其符号 $S(\\theta)$ 以及相关的修正波数 $k^\\ast$ 和耗散率 $\\sigma$：\n\n- 一阶迎风格式（单侧，使用点 $\\{x_i, x_{i-1}\\}$），该格式是相容的，且在空间上具有一阶精度。\n- 三阶迎风偏置格式（单侧，使用点 $\\{x_i, x_{i-1}, x_{i-2}, x_{i-3}\\}$），该格式是相容的，且在空间上具有三阶精度。\n\n从均匀网格上关于 $x_i$ 点的泰勒展开所定义的阶数条件出发，为每种格式推导保证目标空间精度和相容性的有限差分系数。然后，使用离散傅里叶模态 $T_i = \\exp(\\mathrm{i} i \\theta)$，构建相应的离散符号 $S(\\theta)$，计算 $$k^\\ast(\\theta) = -\\mathrm{i} S(\\theta),$$ 并评估 $$\\sigma(\\theta) = c \\, \\operatorname{Im}\\big(k^\\ast(\\theta)\\big).$$ 以“弧度/米”为单位报告 $\\operatorname{Re}(k^\\ast)$ 和 $\\operatorname{Im}(k^\\ast)$，以“秒的倒数”为单位报告 $\\sigma$。\n\n实现一个程序，为以下测试套件评估这些量，该套件探讨了不同的分辨率范围：\n\n- 案例 1：$\\Delta x = 1000$ 米，$\\lambda = 10000$ 米，$c = 0.5$ 米/秒。\n- 案例 2：$\\Delta x = 1000$ 米，$\\lambda = 2000$ 米，$c = 0.5$ 米/秒。\n- 案例 3：$\\Delta x = 5000$ 米，$\\lambda = 500000$ 米，$c = 0.2$ 米/秒。\n- 案例 4：$\\Delta x = 1000$ 米，$\\lambda = 4000$ 米，$c = 0.5$ 米/秒。\n\n对于每个案例，计算并返回一个包含六个浮点数的列表 $$\\big[\\operatorname{Re}(k^\\ast_{\\text{FOU}}), \\operatorname{Im}(k^\\ast_{\\text{FOU}}), \\sigma_{\\text{FOU}}, \\operatorname{Re}(k^\\ast_{\\text{U3}}), \\operatorname{Im}(k^\\ast_{\\text{U3}}), \\sigma_{\\text{U3}}\\big],$$ 其中 $\\text{FOU}$ 表示一阶迎风格式，$\\text{U3}$ 表示三阶迎风偏置格式。所有值必须表示为：$\\operatorname{Re}(k^\\ast)$ 和 $\\operatorname{Im}(k^\\ast)$ 以“弧度/米”为单位，$\\sigma$ 以“秒的倒数”为单位，每个值都四舍五入到 $8$ 位小数。\n\n您的程序应生成单行输出，其中包含所有案例的结果，格式为方括号括起来的、由逗号分隔的列表组成的列表，例如 $$[\\text{case1\\_list},\\text{case2\\_list},\\text{case3\\_list},\\text{case4\\_list}].$$ 不允许有其他任何输出。",
            "solution": "该问题要求推导并实现用于近似线性平流方程 $\\frac{\\partial T}{\\partial t} + c \\frac{\\partial T}{\\partial x} = 0$ 中空间导数的两种迎风有限差分格式的修正波数 $k^\\ast$ 和数值耗散率 $\\sigma$。分析在均匀网格上进行，网格间距为 $\\Delta x$，针对离散傅里叶模态 $T_i = \\exp(\\mathrm{i} k x_i) = \\exp(\\mathrm{i} i \\theta)$，其中 $\\theta = k \\Delta x$ 是无量纲波数。\n\n在网格点 $x_i$ 处对 $\\frac{\\partial T}{\\partial x}$ 的有限差分近似的一般形式由下式给出\n$$\nD[T]_i = \\frac{1}{\\Delta x} \\sum_{j} a_j T_{i+j}\n$$\n系数 $a_j$ 是通过将每个 $T_{i+j}$ 在 $x_i$ 处进行泰勒级数展开，并将所得展开式的系数与精确导数（即 $T'(x_i)$）的泰勒级数系数进行匹配来确定的。该离散算子对傅里叶模态 $T_i$ 的作用是 $D[T]_i = S(\\theta) T_i$，其中 $S(\\theta)$ 是算子的符号。修正波数 $k^\\ast$ 随之定义为 $k^\\ast = -\\mathrm{i} S(\\theta)$，耗散率为 $\\sigma = c \\, \\operatorname{Im}(k^\\ast)$。\n\n### 一阶迎风（FOU）格式\n\n对于正速度 $c > 0$，该格式使用模板 $\\{x_i, x_{i-1}\\}$。其近似式为\n$$\n\\frac{\\partial T}{\\partial x} \\bigg|_{x_i} \\approx \\frac{a_0 T_i + a_{-1} T_{i-1}}{\\Delta x}\n$$\n将 $T_{i-1} = T(x_i - \\Delta x)$ 进行泰勒级数展开：\n$$\nT_{i-1} = T_i - \\Delta x T'_i + \\frac{(\\Delta x)^2}{2!} T''_i - O((\\Delta x)^3)\n$$\n将其代入近似式可得：\n$$\n\\frac{a_0 T_i + a_{-1} (T_i - \\Delta x T'_i + \\dots)}{\\Delta x} = \\frac{(a_0+a_{-1})}{\\Delta x}T_i - a_{-1} T'_i + O(\\Delta x)\n$$\n为了近似 $T'_i$，我们将 $T_i$ 的系数设为 $0$，将 $T'_i$ 的系数设为 $1$。\n\\begin{itemize}\n    \\item $a_0 + a_{-1} = 0$\n    \\item $-a_{-1} = 1 \\implies a_{-1} = -1$\n\\end{itemize}\n这得到 $a_0 = 1$。该格式为\n$$\nD_{\\text{FOU}}[T]_i = \\frac{T_i - T_{i-1}}{\\Delta x}\n$$\n主导误差项为 $-\\frac{\\Delta x}{2} T''_i$，因此该格式为一阶精度。\n\n为求符号 $S_{\\text{FOU}}(\\theta)$，我们将算子应用于 $T_i = \\exp(\\mathrm{i} i \\theta)$：\n$$\nD_{\\text{FOU}}[e^{\\mathrm{i} i \\theta}]_i = \\frac{e^{\\mathrm{i} i \\theta} - e^{\\mathrm{i} (i-1) \\theta}}{\\Delta x} = \\frac{e^{\\mathrm{i} i \\theta}(1 - e^{-\\mathrm{i}\\theta})}{\\Delta x}\n$$\n因此，符号为 $S_{\\text{FOU}}(\\theta) = \\frac{1 - e^{-\\mathrm{i}\\theta}}{\\Delta x}$。\n\n修正波数 $k^\\ast_{\\text{FOU}}$ 为：\n$$\nk^\\ast_{\\text{FOU}} = -\\mathrm{i} S_{\\text{FOU}}(\\theta) = -\\mathrm{i} \\frac{1 - e^{-\\mathrm{i}\\theta}}{\\Delta x} = -\\mathrm{i} \\frac{1 - (\\cos\\theta - \\mathrm{i}\\sin\\theta)}{\\Delta x} = \\frac{\\sin\\theta - \\mathrm{i}(1-\\cos\\theta)}{\\Delta x}\n$$\n其实部和虚部分别为：\n$$\n\\operatorname{Re}(k^\\ast_{\\text{FOU}}) = \\frac{\\sin\\theta}{\\Delta x}\n$$\n$$\n\\operatorname{Im}(k^\\ast_{\\text{FOU}}) = -\\frac{1-\\cos\\theta}{\\Delta x}\n$$\n耗散率 $\\sigma_{\\text{FOU}}$ 为：\n$$\n\\sigma_{\\text{FOU}} = c \\operatorname{Im}(k^\\ast_{\\text{FOU}}) = -c \\frac{1-\\cos\\theta}{\\Delta x}\n$$\n由于 $c > 0$ 且 $1-\\cos\\theta \\ge 0$，$\\sigma_{\\text{FOU}}$ 始终非正，表明该格式是耗散的。\n\n### 三阶迎风偏置（U3）格式\n\n该格式使用模板 $\\{x_i, x_{i-1}, x_{i-2}, x_{i-3}\\}$，旨在达到三阶精度。其近似式为\n$$\n\\frac{\\partial T}{\\partial x} \\bigg|_{x_i} \\approx \\frac{a_0 T_i + a_{-1} T_{i-1} + a_{-2} T_{i-2} + a_{-3} T_{i-3}}{\\Delta x}\n$$\n我们对 $j=1, 2, 3$ 的 $T_{i-j}$ 进行展开，并要求该近似对于最高为 3 次的多项式是精确的。这导出了关于系数 $a_j$ 的一个线性方程组：\n\\begin{align*}\n    a_0 + a_{-1} + a_{-2} + a_{-3} = 0 \\\\\n    -(a_{-1} + 2a_{-2} + 3a_{-3}) = 1 \\\\\n    a_{-1} + 4a_{-2} + 9a_{-3} = 0 \\\\\n    a_{-1} + 8a_{-2} + 27a_{-3} = 0\n\\end{align*}\n求解该方程组可得系数：\n$$\na_0 = \\frac{11}{6}, \\quad a_{-1} = -3, \\quad a_{-2} = \\frac{3}{2}, \\quad a_{-3} = -\\frac{1}{3}\n$$\n该格式为：\n$$\nD_{\\text{U3}}[T]_i = \\frac{1}{\\Delta x} \\left( \\frac{11}{6} T_i - 3 T_{i-1} + \\frac{3}{2} T_{i-2} - \\frac{1}{3} T_{i-3} \\right)\n$$\n为求符号 $S_{\\text{U3}}(\\theta)$，我们将算子应用于 $T_i = \\exp(\\mathrm{i} i \\theta)$：\n$$\nD_{\\text{U3}}[e^{\\mathrm{i} i \\theta}]_i = \\frac{e^{\\mathrm{i} i \\theta}}{\\Delta x} \\left( \\frac{11}{6} - 3 e^{-\\mathrm{i}\\theta} + \\frac{3}{2} e^{-2\\mathrm{i}\\theta} - \\frac{1}{3} e^{-3\\mathrm{i}\\theta} \\right)\n$$\n符号为 $S_{\\text{U3}}(\\theta) = \\frac{1}{\\Delta x} \\left( \\frac{11}{6} - 3 e^{-\\mathrm{i}\\theta} + \\frac{3}{2} e^{-2\\mathrm{i}\\theta} - \\frac{1}{3} e^{-3\\mathrm{i}\\theta} \\right)$。\n\n修正波数 $k^\\ast_{\\text{U3}}$ 为：\n$$\nk^\\ast_{\\text{U3}} = -\\mathrm{i} S_{\\text{U3}}(\\theta) = -\\frac{\\mathrm{i}}{\\Delta x} \\left[ \\frac{11}{6} - 3\\cos\\theta + \\frac{3}{2}\\cos(2\\theta) - \\frac{1}{3}\\cos(3\\theta) + \\mathrm{i} \\left( 3\\sin\\theta - \\frac{3}{2}\\sin(2\\theta) + \\frac{1}{3}\\sin(3\\theta) \\right) \\right]\n$$\n分离实部和虚部：\n$$\n\\operatorname{Re}(k^\\ast_{\\text{U3}}) = \\frac{1}{\\Delta x} \\left( 3\\sin\\theta - \\frac{3}{2}\\sin(2\\theta) + \\frac{1}{3}\\sin(3\\theta) \\right)\n$$\n$$\n\\operatorname{Im}(k^\\ast_{\\text{U3}}) = -\\frac{1}{\\Delta x} \\left( \\frac{11}{6} - 3\\cos\\theta + \\frac{3}{2}\\cos(2\\theta) - \\frac{1}{3}\\cos(3\\theta) \\right)\n$$\n耗散率 $\\sigma_{\\text{U3}}$ 为：\n$$\n\\sigma_{\\text{U3}} = c \\operatorname{Im}(k^\\ast_{\\text{U3}}) = -\\frac{c}{\\Delta x} \\left( \\frac{11}{6} - 3\\cos\\theta + \\frac{3}{2}\\cos(2\\theta) - \\frac{1}{3}\\cos(3\\theta) \\right)\n$$\n代码实现将为指定的测试案例计算这些公式。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and calculates modified wavenumber and dissipation rates for FOU and U3 schemes.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (delta_x, lambda, c)\n        (1000.0, 10000.0, 0.5),\n        (1000.0, 2000.0, 0.5),\n        (5000.0, 500000.0, 0.2),\n        (1000.0, 4000.0, 0.5),\n    ]\n\n    results = []\n    for dx, lam, c in test_cases:\n        # Calculate physical and dimensionless wavenumbers\n        k = 2 * np.pi / lam\n        theta = k * dx\n\n        # --- First-Order Upwind (FOU) Scheme ---\n        # Re(k*) = (1/dx) * sin(theta)\n        # Im(k*) = -(1/dx) * (1 - cos(theta))\n        # sigma = c * Im(k*)\n        \n        re_k_star_fou = (1 / dx) * np.sin(theta)\n        im_k_star_fou = -(1 / dx) * (1 - np.cos(theta))\n        sigma_fou = c * im_k_star_fou\n        \n        # --- Third-Order Upwind-Biased (U3) Scheme ---\n        # Re(k*) = (1/dx) * (3*sin(theta) - 1.5*sin(2*theta) + (1/3)*sin(3*theta))\n        # Im(k*) = -(1/dx) * (11/6 - 3*cos(theta) + 1.5*cos(2*theta) - (1/3)*cos(3*theta))\n        # sigma = c * Im(k*)\n\n        re_k_star_u3 = (1 / dx) * (\n            3 * np.sin(theta) - 1.5 * np.sin(2 * theta) + (1 / 3) * np.sin(3 * theta)\n        )\n        \n        im_k_star_u3 = -(1 / dx) * (\n            11 / 6\n            - 3 * np.cos(theta)\n            + 1.5 * np.cos(2 * theta)\n            - (1 / 3) * np.cos(3 * theta)\n        )\n        \n        sigma_u3 = c * im_k_star_u3\n        \n        # Collect results for the current case\n        case_result = [\n            re_k_star_fou, im_k_star_fou, sigma_fou,\n            re_k_star_u3, im_k_star_u3, sigma_u3\n        ]\n        results.append(case_result)\n\n    # Format the final output string as a list of lists, with each value\n    # rounded to 8 decimal places and no spaces within the sublists.\n    case_strings = []\n    for case_result in results:\n        # Format each float to 8 decimal places and join into a comma-separated string\n        s = \",\".join(f\"{val:.8f}\" for val in case_result)\n        case_strings.append(f\"[{s}]\")\n    \n    final_output = f\"[{','.join(case_strings)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "对于长期的气候和海洋模拟而言，仅仅达到高阶精度是不够的；数值格式还必须遵循基本的物理守恒定律。这项高级练习深入探讨了阿拉卡瓦(Arakawa)雅可比算子，这是一个著名的“结构保持”离散化方案的例子，其设计旨在精确地保持能量和拟涡能的离散模拟量守恒。通过数值验证这些守恒特性，您将体会到构建模型所需的精妙设计原则，这些模型不仅要保证短期准确性，还要在长期积分中保持稳定和物理意义。",
            "id": "3810632",
            "problem": "您的任务是推导并验证在二维周期性结构化网格上，使用 Arakawa 雅可比格式求解的正压涡度方程的离散能量和离散拟涡能守恒。目标是从第一性原理出发，证明该离散格式在没有外力强迫和扩散的情况下守恒这些不变量，并实现一个程序，在多个测试案例上数值验证其守恒特性。\n\n从 $f$ 平面（科里奥利参数为常数）上的连续、无粘性正压涡度方程开始：\n$$\n\\frac{\\partial \\zeta}{\\partial t} + J(\\psi, \\zeta) = 0,\n$$\n其中 $\\zeta$ 是相对涡度，$\\psi$ 是流函数，$J(\\psi, \\zeta)$ 是雅可比算子 $J(\\psi,\\zeta) = \\psi_x \\zeta_y - \\psi_y \\zeta_x$。对于二维不可压流，速度场通过流函数定义为 $u = -\\partial \\psi / \\partial y$ 和 $v = \\partial \\psi / \\partial x$，相对涡度满足 $\\zeta = \\nabla^2 \\psi$。\n\n定义连续不变量：\n- 单位密度的动能：\n$$\nE = \\frac{1}{2} \\int_{\\Omega} |\\nabla \\psi|^2 \\, dA = -\\frac{1}{2}\\int_{\\Omega} \\psi \\, \\zeta \\, dA,\n$$\n在周期性边界条件下。\n- 拟涡能：\n$$\nZ = \\frac{1}{2} \\int_{\\Omega} \\zeta^2 \\, dA.\n$$\n\n在均匀、周期性的结构化网格上离散化该域，网格在 $x$ 方向有 $N_x$ 个点，在 $y$ 方向有 $N_y$ 个点，网格间距分别为 $d_x$ 和 $d_y$。用数组 $\\psi_{j,i}$ 和 $\\zeta_{j,i}$ 表示网格中心的离散场，其中 $0 \\leq i \\leq N_x - 1$ 和 $0 \\leq j \\leq N_y - 1$，并在两个方向上施加周期性。空间导数使用二阶中心差分。离散拉普拉斯算子为\n$$\n\\zeta_{j,i} = \\frac{\\psi_{j,i+1} - 2\\psi_{j,i} + \\psi_{j,i-1}}{d_x^2} + \\frac{\\psi_{j+1,i} - 2\\psi_{j,i} + \\psi_{j-1,i}}{d_y^2},\n$$\n其中索引是周期性循环的。在每个网格点上的 Arakawa 雅可比算子 $J^{A}(\\psi,\\zeta)$ 定义为三种二阶离散形式的平均值：\n$$\nJ^{A}(\\psi,\\zeta) = \\frac{1}{3}\\left(J_1 + J_2 + J_3\\right),\n$$\n其中\n$$\nJ_1 = \\frac{(\\psi_{j,i+1}-\\psi_{j,i-1})(\\zeta_{j+1,i}-\\zeta_{j-1,i}) - (\\psi_{j+1,i}-\\psi_{j-1,i})(\\zeta_{j,i+1}-\\zeta_{j,i-1})}{4 d_x d_y},\n$$\n$$\nJ_2 = \\frac{\\psi_{j,i+1}(\\zeta_{j+1,i+1}-\\zeta_{j-1,i+1}) - \\psi_{j,i-1}(\\zeta_{j+1,i-1}-\\zeta_{j-1,i-1}) - \\psi_{j+1,i}(\\zeta_{j+1,i+1}-\\zeta_{j+1,i-1}) + \\psi_{j-1,i}(\\zeta_{j-1,i+1}-\\zeta_{j-1,i-1})}{4 d_x d_y},\n$$\n$$\nJ_3 = \\frac{\\zeta_{j,i+1}(\\psi_{j+1,i+1}-\\psi_{j-1,i+1}) - \\zeta_{j,i-1}(\\psi_{j+1,i-1}-\\psi_{j-1,i-1}) - \\zeta_{j+1,i}(\\psi_{j+1,i+1}-\\psi_{j+1,i-1}) + \\zeta_{j-1,i}(\\psi_{j-1,i+1}-\\psi_{j-1,i-1})}{4 d_x d_y},\n$$\n所有索引都以 $N_x$ 和 $N_y$ 为模进行周期性解释。\n\n在周期性边界条件下，Arakawa 雅可比算子的设计使得以下离散内积为零，这确保了在没有强迫和扩散的情况下离散能量和离散拟涡能的守恒：\n$$\n\\sum_{j,i} \\psi_{j,i} \\, J^{A}(\\psi,\\zeta)_{j,i} \\, d_x d_y = 0, \\quad \\sum_{j,i} \\zeta_{j,i} \\, J^{A}(\\psi,\\zeta)_{j,i} \\, d_x d_y = 0.\n$$\n离散能量和离散拟涡能计算如下：\n$$\nE_d = -\\frac{1}{2}\\sum_{j,i} \\psi_{j,i} \\, \\zeta_{j,i} \\, d_x d_y, \\quad Z_d = \\frac{1}{2}\\sum_{j,i} \\zeta_{j,i}^2 \\, d_x d_y.\n$$\n\n您的程序必须：\n1. 如下文所述，在周期性网格上构建测试流函数 $\\psi_{j,i}$。\n2. 使用离散拉普拉斯算子计算 $\\zeta$。\n3. 使用 Arakawa 格式计算 $J^{A}(\\psi,\\zeta)$。\n4. 计算离散内积 $S_\\psi = \\sum \\psi \\, J^{A}(\\psi,\\zeta) \\, d_x d_y$ 和 $S_\\zeta = \\sum \\zeta \\, J^{A}(\\psi,\\zeta) \\, d_x d_y$。\n5. 对于每个测试案例，如果 $|S_\\psi|$ 和 $|S_\\zeta|$ 都小于一个固定的绝对容差 $T$，则返回布尔值 true，否则返回 false。在无量纲单位中，使用 $T = 10^{-9}$。本次作业中所有量都视为无量纲量；不使用物理单位。\n\n测试套件：\n- 案例1（理想路径）：$N_x = 32$，$N_y = 32$，$d_x = 1.0$，$d_y = 1.0$。初始化 $\\psi_{j,i} = \\sin\\left(2\\pi k_x x_i / L_x\\right) \\sin\\left(2\\pi k_y y_j / L_y\\right)$，其中 $k_x=4$，$k_y=5$，$x_i = i d_x$，$y_j = j d_y$，$L_x = N_x d_x$，$L_y = N_y d_y$。\n- 案例2（各向异性网格）：$N_x = 64$，$N_y = 48$，$d_x = 1.0$，$d_y = 2.0$。使用从种子为 $42$ 的标准正态分布中提取的可复现伪随机场来初始化 $\\psi$。\n- 案例3（均匀场边界情况）：$N_x = 16$，$N_y = 16$，$d_x = 1.0$，$d_y = 1.0$。初始化 $\\psi_{j,i} = c$，其中 $c = 2.0$（常数）。\n- 案例4（最小周期分辨率）：$N_x = 3$，$N_y = 3$，$d_x = 1.0$，$d_y = 1.0$。初始化 $\\psi_{j,i} = i + 2 j$（一个周期性循环的简单线性模式）。\n- 案例5（奇数尺寸，混合模态）：$N_x = 33$，$N_y = 31$，$d_x = 0.5$，$d_y = 0.7$。初始化 $\\psi_{j,i} = \\cos\\left(2\\pi m x_i / L_x\\right) + 0.5 \\sin\\left(2\\pi n y_j / L_y\\right)$，其中 $m=3$，$n=7$。\n\n您的程序应生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表，例如“[result1,result2,result3,result4,result5]”。每个结果必须是一个布尔值，指示对应测试案例的两个内积是否都低于容差。",
            "solution": "所提出的问题是计算流体力学中一个适定且科学合理的问题，具体涉及 Arakawa 雅可比格式在正压涡度方程中的数值守恒性质。它要求从第一性原理出发，并通过数值验证来证明 Arakawa 离散格式守恒动能和拟涡能的离散模拟。该问题是自洽的，提供了所有必要的方程、参数和测试案例。\n\n### 问题验证\n\n**第1步：提取给定信息**\n\n- **控制方程**：$\\frac{\\partial \\zeta}{\\partial t} + J(\\psi, \\zeta) = 0$，其中 $\\zeta = \\nabla^2 \\psi$ 是相对涡度，$\\psi$ 是流函数，$J(\\psi, \\zeta) = \\psi_x \\zeta_y - \\psi_y \\zeta_x$ 是雅可比算子。\n- **连续不变量**：\n    - 动能：$E = \\frac{1}{2} \\int_{\\Omega} |\\nabla \\psi|^2 \\, dA = -\\frac{1}{2}\\int_{\\Omega} \\psi \\, \\zeta \\, dA$。\n    - 拟涡能：$Z = \\frac{1}{2} \\int_{\\Omega} \\zeta^2 \\, dA$。\n- **离散化**：均匀、周期性的结构化网格，包含 $N_x \\times N_y$ 个点，网格间距为 $d_x, d_y$。\n- **离散拉普拉斯算子**：$\\zeta_{j,i} = \\frac{\\psi_{j,i+1} - 2\\psi_{j,i} + \\psi_{j,i-1}}{d_x^2} + \\frac{\\psi_{j+1,i} - 2\\psi_{j,i} + \\psi_{j-1,i}}{d_y^2}$。\n- **Arakawa 雅可比算子**：$J^{A}(\\psi,\\zeta) = \\frac{1}{3}\\left(J_1 + J_2 + J_3\\right)$，其中：\n    - $J_1 = \\frac{(\\psi_{j,i+1}-\\psi_{j,i-1})(\\zeta_{j+1,i}-\\zeta_{j-1,i}) - (\\psi_{j+1,i}-\\psi_{j-1,i})(\\zeta_{j,i+1}-\\zeta_{j,i-1})}{4 d_x d_y}$\n    - $J_2 = \\frac{\\psi_{j,i+1}(\\zeta_{j+1,i+1}-\\zeta_{j-1,i+1}) - \\psi_{j,i-1}(\\zeta_{j+1,i-1}-\\zeta_{j-1,i-1}) - \\psi_{j+1,i}(\\zeta_{j+1,i+1}-\\zeta_{j+1,i-1}) + \\psi_{j-1,i}(\\zeta_{j-1,i+1}-\\zeta_{j-1,i-1})}{4 d_x d_y}$\n    - $J_3 = \\frac{\\zeta_{j,i+1}(\\psi_{j+1,i+1}-\\psi_{j-1,i+1}) - \\zeta_{j,i-1}(\\psi_{j+1,i-1}-\\psi_{j-1,i-1}) - \\zeta_{j+1,i}(\\psi_{j+1,i+1}-\\psi_{j+1,i-1}) + \\zeta_{j-1,i}(\\psi_{j-1,i+1}-\\psi_{j-1,i-1})}{4 d_x d_y}$\n- **离散守恒条件**：$\\sum_{j,i} \\psi_{j,i} \\, J^{A}(\\psi,\\zeta)_{j,i} \\, d_x d_y = 0$ 和 $\\sum_{j,i} \\zeta_{j,i} \\, J^{A}(\\psi,\\zeta)_{j,i} \\, d_x d_y = 0$。\n- **离散不变量**：\n    - 能量：$E_d = -\\frac{1}{2}\\sum_{j,i} \\psi_{j,i} \\, \\zeta_{j,i} \\, d_x d_y$。\n    - 拟涡能：$Z_d = \\frac{1}{2}\\sum_{j,i} \\zeta_{j,i}^2 \\, d_x d_y$。\n- **任务**：计算 $S_\\psi = \\sum \\psi \\, J^{A} \\, d_x d_y$ 和 $S_\\zeta = \\sum \\zeta \\, J^{A} \\, d_x d_y$。\n- **容差**：$T = 10^{-9}$。如果 $|S_\\psi|  T$ 且 $|S_\\zeta|  T$，则结果为 true。\n- **测试案例**：\n    1. $N_x=32, N_y=32, d_x=1, d_y=1$。$\\psi_{j,i} = \\sin(2\\pi k_x x_i / L_x) \\sin(2\\pi k_y y_j / L_y)$，其中 $k_x=4, k_y=5$。\n    2. $N_x=64, N_y=48, d_x=1, d_y=2$。$\\psi$ 为随机正态分布，种子为 $42$。\n    3. $N_x=16, N_y=16, d_x=1, d_y=1$。$\\psi_{j,i} = 2.0$。\n    4. $N_x=3, N_y=3, d_x=1, d_y=1$。$\\psi_{j,i} = i + 2j$。\n    5. $N_x=33, N_y=31, d_x=0.5, d_y=0.7$。$\\psi_{j,i} = \\cos(2\\pi m x_i / L_x) + 0.5 \\sin(2\\pi n y_j / L_y)$，其中 $m=3, n=7$。\n\n**第2步：使用提取的给定信息进行验证**\n该问题科学上是合理的，适定的，且客观的。它提出了一个地球物理流体力学中一个基础数值方法的标准验证研究。方程是正确的，参数是完整的，任务是明确的。\n\n**第3步：结论与行动**\n问题有效。将提供解决方案。\n\n### 基于原理的设计与求解\n\n#### 理论基础\n\n对于周期性域 $\\Omega$ 上的无粘性正压涡度方程，连续动能 $E$ 和拟涡能 $Z$ 的时间演化由雅可比算子的性质决定。对不变量关于时间求导可得：\n\n$\\frac{dE}{dt} = \\frac{d}{dt} \\left(-\\frac{1}{2} \\int_{\\Omega} \\psi \\zeta \\, dA \\right) = -\\frac{1}{2} \\int_{\\Omega} \\left( \\psi_t \\zeta + \\psi \\zeta_t \\right) \\, dA$\n在周期性边界条件下，对第一项使用分部积分法（格林第一恒等式），$\\int \\psi_t \\zeta \\, dA = \\int \\psi_t \\nabla^2 \\psi \\, dA = -\\int \\nabla\\psi_t \\cdot \\nabla\\psi \\, dA$。对第二项应用相同的恒等式得到 $\\int \\psi \\zeta_t \\, dA = \\int \\psi \\nabla^2 \\psi_t \\, dA = -\\int \\nabla\\psi \\cdot \\nabla\\psi_t \\, dA$。因此，这两项相等，我们可以写出：\n$\\frac{dE}{dt} = -\\int_{\\Omega} \\psi \\zeta_t \\, dA$\n代入涡度方程 $\\zeta_t = -J(\\psi, \\zeta)$：\n$\\frac{dE}{dt} = \\int_{\\Omega} \\psi J(\\psi, \\zeta) \\, dA$\n\n类似地，对于拟涡能：\n$\\frac{dZ}{dt} = \\frac{d}{dt} \\left( \\frac{1}{2} \\int_{\\Omega} \\zeta^2 \\, dA \\right) = \\int_{\\Omega} \\zeta \\zeta_t \\, dA = -\\int_{\\Omega} \\zeta J(\\psi, \\zeta) \\, dA$\n\n能量和拟涡能的守恒（$dE/dt = 0$, $dZ/dt = 0$）取决于雅可比算子的积分性质：$\\int \\psi J(\\psi, \\zeta) \\, dA = 0$ 和 $\\int \\zeta J(\\psi, \\zeta) \\, dA = 0$。可以证明，对于连续雅可比算子，在周期性域上使用分部积分法，这些积分为零。\n\n#### 离散模拟与 Arakawa 格式\n\n在离散化方程时，目标是找到一个离散雅可比算子 $J^A$，它能模拟这些关键的守恒性质。这确保了数值格式不会虚假地产生或消耗能量或拟涡能，从而使长期积分更加稳定且物理上一致。离散能量 $E_d$ 和离散拟涡能 $Z_d$ 的时间导数为：\n\n$\\frac{dE_d}{dt} \\propto \\sum_{j,i} \\psi_{j,i} J^A_{j,i}$\n$\\frac{dZ_d}{dt} \\propto \\sum_{j,i} \\zeta_{j,i} J^A_{j,i}$\n\n其中求和遍历所有网格点。守恒要求这些和为零。标准的二阶中心差分近似雅可比算子不能保证这一点。\n\nAkio Arakawa 在其 1966 年的开创性论文中引入了一种专为满足这些离散守恒定律而构造的格式。算子 $J^A$ 是三种不同的二阶精度模板（$J_1$, $J_2$ 和 $J_3$）的精心加权平均。每个分量的代数结构都贡献了一个特定的守恒性质，它们的线性组合确保了两个二次不变量的守恒。实现这一点的 underlying 数学原理是分部求和法，即分部积分法的离散模拟。当在周期性网格上求和时，离散雅可比算子中的项会重新排列并相互抵消，从而在理论上迫使总和 $S_\\psi = \\sum \\psi J^A$ 和 $S_\\zeta = \\sum \\zeta J^A$ 精确为零。在浮点运算中，这些和将在机器精度范围内为零。\n\n#### 算法实现\n\n程序将为每个测试案例执行以下步骤：\n1.  **网格与场生成**：根据案例规范构建二维网格坐标 $(x_i, y_j)$ 并初始化流函数数组 $\\psi_{j,i}$。\n2.  **涡度计算**：通过将所提供的二阶离散拉普拉斯算子应用于 $\\psi_{j,i}$ 来计算相对涡度场 $\\zeta_{j,i}$。这需要访问相邻网格点，可以通过对周期性网格使用数组移位操作来高效处理。\n3.  **Arakawa 雅可比算子计算**：在每个网格点上评估三个分量 $J_1$、$J_2$ 和 $J_3$。这是最复杂的一步，涉及许多访问第一、第二和对角邻居的模板。同样，数组移位是同时在整个网格上实现这些模板的合适方法。最终的雅可比算子 $J^A$ 是这三个分量的平均值。\n4.  **守恒检验**：计算两个内积 $S_\\psi = d_x d_y \\sum_{j,i} \\psi_{j,i} J^A_{j,i}$ 和 $S_\\zeta = d_x d_y \\sum_{j,i} \\zeta_{j,i} J^A_{j,i}$。\n5.  **验证**：将 $S_\\psi$ 和 $S_\\zeta$ 的绝对值与指定的容差 $T=10^{-9}$ 进行比较。当且仅当两者都低于容差时，该案例通过。存储布尔结果。\n\n此过程对 Arakawa 雅可比算子在各种场配置下的代数性质进行数值验证，确认其守恒特性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and verifies discrete conservation of energy and enstrophy for the\n    barotropic vorticity equation using the Arakawa Jacobian scheme.\n    \"\"\"\n    \n    test_cases = [\n        {'Nx': 32, 'Ny': 32, 'dx': 1.0, 'dy': 1.0, 'case_type': 'sinsin', 'params': {'kx': 4, 'ky': 5}},\n        {'Nx': 64, 'Ny': 48, 'dx': 1.0, 'dy': 2.0, 'case_type': 'random', 'params': {'seed': 42}},\n        {'Nx': 16, 'Ny': 16, 'dx': 1.0, 'dy': 1.0, 'case_type': 'constant', 'params': {'c': 2.0}},\n        {'Nx': 3, 'Ny': 3, 'dx': 1.0, 'dy': 1.0, 'case_type': 'linear', 'params': {}},\n        {'Nx': 33, 'Ny': 31, 'dx': 0.5, 'dy': 0.7, 'case_type': 'mixed_modes', 'params': {'m': 3, 'n': 7}}\n    ]\n    \n    TOLERANCE = 1e-9\n    results = []\n\n    for case in test_cases:\n        Nx, Ny, dx, dy = case['Nx'], case['Ny'], case['dx'], case['dy']\n        Lx, Ly = Nx * dx, Ny * dy\n\n        # 1. Construct test streamfunctions\n        x = np.arange(Nx) * dx\n        y = np.arange(Ny) * dy\n        xx, yy = np.meshgrid(x, y)\n        \n        psi = np.zeros((Ny, Nx))\n        \n        if case['case_type'] == 'sinsin':\n            kx, ky = case['params']['kx'], case['params']['ky']\n            psi = np.sin(2 * np.pi * kx * xx / Lx) * np.sin(2 * np.pi * ky * yy / Ly)\n        elif case['case_type'] == 'random':\n            seed = case['params']['seed']\n            rng = np.random.default_rng(seed)\n            psi = rng.standard_normal((Ny, Nx))\n        elif case['case_type'] == 'constant':\n            psi.fill(case['params']['c'])\n        elif case['case_type'] == 'linear':\n            psi = xx + 2 * yy\n        elif case['case_type'] == 'mixed_modes':\n            m, n = case['params']['m'], case['params']['n']\n            psi = np.cos(2 * np.pi * m * xx / Lx) + 0.5 * np.sin(2 * np.pi * n * yy / Ly)\n\n        # 2. Compute vorticity using discrete Laplacian\n        psi_ip1 = np.roll(psi, -1, axis=1)\n        psi_im1 = np.roll(psi, 1, axis=1)\n        psi_jp1 = np.roll(psi, -1, axis=0)\n        psi_jm1 = np.roll(psi, 1, axis=0)\n        \n        zeta = (psi_ip1 - 2*psi + psi_im1) / (dx**2) + \\\n               (psi_jp1 - 2*psi + psi_jm1) / (dy**2)\n               \n        # 3. Compute Arakawa Jacobian\n        # Pre-compute all shifted fields for clarity and efficiency\n        zeta_ip1 = np.roll(zeta, -1, axis=1)\n        zeta_im1 = np.roll(zeta, 1, axis=1)\n        zeta_jp1 = np.roll(zeta, -1, axis=0)\n        zeta_jm1 = np.roll(zeta, 1, axis=0)\n        \n        psi_jp1_ip1 = np.roll(psi, (-1, -1), axis=(0, 1))\n        psi_jm1_ip1 = np.roll(psi, (1, -1), axis=(0, 1))\n        psi_jp1_im1 = np.roll(psi, (-1, 1), axis=(0, 1))\n        psi_jm1_im1 = np.roll(psi, (1, 1), axis=(0, 1))\n\n        zeta_jp1_ip1 = np.roll(zeta, (-1, -1), axis=(0, 1))\n        zeta_jm1_ip1 = np.roll(zeta, (1, -1), axis=(0, 1))\n        zeta_jp1_im1 = np.roll(zeta, (-1, 1), axis=(0, 1))\n        zeta_jm1_im1 = np.roll(zeta, (1, 1), axis=(0, 1))\n\n        # J1\n        j1 = ((psi_ip1 - psi_im1) * (zeta_jp1 - zeta_jm1) - \n              (psi_jp1 - psi_jm1) * (zeta_ip1 - zeta_im1)) / (4 * dx * dy)\n        \n        # J2\n        j2 = (psi_ip1 * (zeta_jp1_ip1 - zeta_jm1_ip1) - \n              psi_im1 * (zeta_jp1_im1 - zeta_jm1_im1) -\n              psi_jp1 * (zeta_jp1_ip1 - zeta_jp1_im1) +\n              psi_jm1 * (zeta_jm1_ip1 - zeta_jm1_im1)) / (4 * dx * dy)\n\n        # J3\n        j3 = (zeta_ip1 * (psi_jp1_ip1 - psi_jm1_ip1) -\n              zeta_im1 * (psi_jp1_im1 - psi_jm1_im1) -\n              zeta_jp1 * (psi_jp1_ip1 - psi_jp1_im1) +\n              zeta_jm1 * (psi_jm1_ip1 - psi_jm1_im1)) / (4 * dx * dy)\n\n        j_arakawa = (j1 + j2 + j3) / 3.0\n\n        # 4. Compute discrete inner products\n        s_psi = np.sum(psi * j_arakawa) * dx * dy\n        s_zeta = np.sum(zeta * j_arakawa) * dx * dy\n        \n        # 5. Verify conservation\n        is_conserved = abs(s_psi)  TOLERANCE and abs(s_zeta)  TOLERANCE\n        results.append(is_conserved)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(str(r).lower() for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}