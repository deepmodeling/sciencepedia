{
    "hands_on_practices": [
        {
            "introduction": "构建保正数值格式的理论基石在于确保数值更新可以表达为一种凸组合。这项基本练习将指导您从第一性原理出发，为一个包含平流和扩散的组合格式推导其稳定性条件。通过这个过程，您将理解来自平流（库朗数）和扩散（扩散数）的限制是如何融合成一个单一且全面的时间步长约束的 。",
            "id": "3802486",
            "problem": "考虑海洋混合层中无源汇的被动示踪物浓度 $C(x,y,t)$ 的守恒输运，该过程由二维平流-扩散方程控制，\n$$\n\\frac{\\partial C}{\\partial t} + \\frac{\\partial (u\\,C)}{\\partial x} + \\frac{\\partial (v\\,C)}{\\partial y} \\;=\\; \\frac{\\partial}{\\partial x}\\!\\left(K_x \\frac{\\partial C}{\\partial x}\\right) + \\frac{\\partial}{\\partial y}\\!\\left(K_y \\frac{\\partial C}{\\partial y}\\right),\n$$\n其中 $u$ 和 $v$ 是恒定的水平速度（单位为 $\\mathrm{m}\\,\\mathrm{s}^{-1}$），$K_x$ 和 $K_y$ 是恒定的水平扩散系数（单位为 $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$）。该区域在两个方向上都是周期的，并在间距为 $\\Delta x$ 和 $\\Delta y$ 的均匀笛卡尔网格上进行离散化。设 $C_{i,j}^n$ 表示在时间层 $t^n$ 时，网格单元 $(i,j)$ 内的网格平均浓度。\n\n使用时间上的前向欧拉法，为 $C_{i,j}^{n+1}$ 构建一个显式、单步、守恒的有限体积更新格式。在每个垂直网格面 $(i+\\tfrac{1}{2},j)$ 上，使用供体单元迎风通量分裂 $u^{+} C_{i,j}^n + u^{-} C_{i+1,j}^n$ 来近似平流通量，其中 $u^{+}=\\max(u,0)$ 且 $u^{-}=\\min(u,0)$；并使用中心差分 $-\\,K_x\\,(C_{i+1,j}^n - C_{i,j}^n)/\\Delta x$ 来近似扩散通量。在 $y$ 方向的水平网格面上，对 $v$、$K_y$ 和 $\\Delta y$ 使用类似的公式。\n\n假设所有 $(i,j)$ 的初始数据 $C_{i,j}^0 \\ge 0$ 且边界是周期的，推导关于时间步长 $\\Delta t$ 的一个充分必要条件，以使该格式保持非负性，即对所有 $n \\in \\mathbb{N}$，$C_{i,j}^{n} \\ge 0$ 意味着对所有 $(i,j)$，$C_{i,j}^{n+1} \\ge 0$。你的推导必须从每个控制体积的守恒定律出发，并得出具有非负系数且系数和为1的更新格式的凸组合形式。\n\n将你的最终结果表示为最大允许时间步长 $\\Delta t_{\\max}$（单位为秒）的单个闭式解析表达式，用 $|u|$、$|v|$、$\\Delta x$、$\\Delta y$、$K_x$ 和 $K_y$ 表示。不要提供不等式；只提供 $\\Delta t_{\\max}$ 的显式表达式。",
            "solution": "示踪物浓度 $C$ 的输运控制偏微分方程（PDE）为\n$$\n\\frac{\\partial C}{\\partial t} + \\frac{\\partial (uC)}{\\partial x} + \\frac{\\partial (vC)}{\\partial y} = \\frac{\\partial}{\\partial x}\\left(K_x \\frac{\\partial C}{\\partial x}\\right) + \\frac{\\partial}{\\partial y}\\left(K_y \\frac{\\partial C}{\\partial y}\\right)\n$$\n由于速度 $u$ 和 $v$ 以及扩散系数 $K_x$ 和 $K_y$ 是常数，我们可以将方程重写为守恒形式：\n$$\n\\frac{\\partial C}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(uC - K_x \\frac{\\partial C}{\\partial x}\\right) + \\frac{\\partial}{\\partial y}\\left(vC - K_y \\frac{\\partial C}{\\partial y}\\right) = 0\n$$\n这是 $\\frac{\\partial C}{\\partial t} + \\nabla \\cdot \\mathbf{F} = 0$ 的形式，其中总通量矢量为 $\\mathbf{F} = (F_x, F_y)$，分量通量为 $F_x = uC - K_x \\frac{\\partial C}{\\partial x}$ 和 $F_y = vC - K_y \\frac{\\partial C}{\\partial y}$。\n\n我们通过在面积为 $\\Delta x \\Delta y$ 的控制体积 $\\Omega_{i,j} = [x_{i-1/2}, x_{i+1/2}] \\times [y_{j-1/2}, y_{j+1/2}]$ 上对PDE进行积分来应用有限体积法。网格平均浓度定义为 $C_{i,j}(t) = \\frac{1}{\\Delta x \\Delta y} \\iint_{\\Omega_{i,j}} C(x,y,t) \\,dx\\,dy$。\n对PDE进行积分并应用散度定理，得到网格平均浓度的精确演化方程：\n$$\n\\frac{d C_{i,j}}{dt} = -\\frac{1}{\\Delta x} \\left( F_{x, i+1/2, j} - F_{x, i-1/2, j} \\right) - \\frac{1}{\\Delta y} \\left( F_{y, i, j+1/2} - F_{y, i, j-1/2} \\right)\n$$\n这里，$F_{x, i+1/2, j}$ 是穿过网格单元右侧面的通量，以此类推。\n\n我们使用前向欧拉法在时间上离散化该方程，通量在时间层 $n$ 进行评估：\n$$\n\\frac{C_{i,j}^{n+1} - C_{i,j}^n}{\\Delta t} = \\frac{1}{\\Delta x} \\left( F_{x, i-1/2, j}^n - F_{x, i+1/2, j}^n \\right) + \\frac{1}{\\Delta y} \\left( F_{y, i, j-1/2}^n - F_{y, i, j+1/2}^n \\right)\n$$\n问题指定了总通量的离散化。在面 $(i+\\tfrac{1}{2}, j)$ 的总通量是平流通量和扩散通量之和：\n$$\nF_{x, i+1/2, j}^n = \\left( u^{+}C_{i,j}^n + u^{-}C_{i+1,j}^n \\right) - K_x \\frac{C_{i+1,j}^n - C_{i,j}^n}{\\Delta x}\n$$\n类似地，在左侧面 $(i-\\tfrac{1}{2}, j)$ 的通量为：\n$$\nF_{x, i-1/2, j}^n = \\left( u^{+}C_{i-1,j}^n + u^{-}C_{i,j}^n \\right) - K_x \\frac{C_{i,j}^n - C_{i-1,j}^n}{\\Delta x}\n$$\n$y$ 方向的通量是类似的：\n$$\nF_{y, i, j+1/2}^n = \\left( v^{+}C_{i,j}^n + v^{-}C_{i,j+1}^n \\right) - K_y \\frac{C_{i,j+1}^n - C_{i,j}^n}{\\Delta y}\n$$\n$$\nF_{y, i, j-1/2}^n = \\left( v^{+}C_{i,j-1}^n + v^{-}C_{i,j}^n \\right) - K_y \\frac{C_{i,j}^n - C_{i,j-1}^n}{\\Delta y}\n$$\n现在，我们将这些离散通量代入时间推进方程：\n$$\nC_{i,j}^{n+1} = C_{i,j}^n + \\frac{\\Delta t}{\\Delta x} \\left( F_{x, i-1/2, j}^n - F_{x, i+1/2, j}^n \\right) + \\frac{\\Delta t}{\\Delta y} \\left( F_{y, i, j-1/2}^n - F_{y, i, j+1/2}^n \\right)\n$$\n让我们计算 $x$ 方向的净通量项：\n$$\nF_{x, i-1/2, j}^n - F_{x, i+1/2, j}^n = \\left[ u^{+}C_{i-1,j}^n + u^{-}C_{i,j}^n - K_x \\frac{C_{i,j}^n - C_{i-1,j}^n}{\\Delta x} \\right] - \\left[ u^{+}C_{i,j}^n + u^{-}C_{i+1,j}^n - K_x \\frac{C_{i+1,j}^n - C_{i,j}^n}{\\Delta x} \\right]\n$$\n按网格单元索引分组各项：\n$$\n= C_{i-1,j}^n \\left( u^{+} + \\frac{K_x}{\\Delta x} \\right) + C_{i+1,j}^n \\left( -u^{-} + \\frac{K_x}{\\Delta x} \\right) + C_{i,j}^n \\left( u^{-} - u^{+} - \\frac{2K_x}{\\Delta x} \\right)\n$$\n使用恒等式 $u=u^++u^-$ 和 $|u|=u^+-u^-$，我们有 $u^--u^+ = -|u|$。净 $x$ 通量变为：\n$$\n= C_{i-1,j}^n \\left( u^{+} + \\frac{K_x}{\\Delta x} \\right) + C_{i+1,j}^n \\left( -u^{-} + \\frac{K_x}{\\Delta x} \\right) - C_{i,j}^n \\left( |u| + \\frac{2K_x}{\\Delta x} \\right)\n$$\n净 $y$ 通量是类似的：\n$$\nF_{y, i, j-1/2}^n - F_{y, i, j+1/2}^n = C_{i,j-1}^n \\left( v^{+} + \\frac{K_y}{\\Delta y} \\right) + C_{i,j+1}^n \\left( -v^{-} + \\frac{K_y}{\\Delta y} \\right) - C_{i,j}^n \\left( |v| + \\frac{2K_y}{\\Delta y} \\right)\n$$\n将这些代入 $C_{i,j}^{n+1}$ 的更新方程：\n$$\nC_{i,j}^{n+1} = C_{i,j}^n + \\frac{\\Delta t}{\\Delta x} \\left[ C_{i-1,j}^n \\left( u^{+} + \\frac{K_x}{\\Delta x} \\right) + C_{i+1,j}^n \\left( -u^{-} + \\frac{K_x}{\\Delta x} \\right) - C_{i,j}^n \\left( |u| + \\frac{2K_x}{\\Delta x} \\right) \\right] + \\frac{\\Delta t}{\\Delta y} \\left[ C_{i,j-1}^n \\left( v^{+} + \\frac{K_y}{\\Delta y} \\right) + C_{i,j+1}^n \\left( -v^- + \\frac{K_y}{\\Delta y} \\right) - C_{i,j}^n \\left( |v| + \\frac{2K_y}{\\Delta y} \\right) \\right]\n$$\n为了获得凸组合形式 $C_{i,j}^{n+1} = \\sum \\alpha C^n$，我们收集每个模板点的系数：\n$$\nC_{i,j}^{n+1} = \\alpha_{0,0} C_{i,j}^n + \\alpha_{1,0} C_{i+1,j}^n + \\alpha_{-1,0} C_{i-1,j}^n + \\alpha_{0,1} C_{i,j+1}^n + \\alpha_{0,-1} C_{i,j-1}^n\n$$\n系数为：\n$\\alpha_{1,0} = \\frac{\\Delta t}{\\Delta x} \\left( -u^{-} + \\frac{K_x}{\\Delta x} \\right)$\n$\\alpha_{-1,0} = \\frac{\\Delta t}{\\Delta x} \\left( u^{+} + \\frac{K_x}{\\Delta x} \\right)$\n$\\alpha_{0,1} = \\frac{\\Delta t}{\\Delta y} \\left( -v^{-} + \\frac{K_y}{\\Delta y} \\right)$\n$\\alpha_{0,-1} = \\frac{\\Delta t}{\\Delta y} \\left( v^{+} + \\frac{K_y}{\\Delta y} \\right)$\n$\\alpha_{0,0} = 1 - \\frac{\\Delta t}{\\Delta x} \\left( |u| + \\frac{2K_x}{\\Delta x} \\right) - \\frac{\\Delta t}{\\Delta y} \\left( |v| + \\frac{2K_y}{\\Delta y} \\right)$\n$\\alpha_{0,0} = 1 - \\Delta t \\left( \\frac{|u|}{\\Delta x} + \\frac{2K_x}{\\Delta x^2} + \\frac{|v|}{\\Delta y} + \\frac{2K_y}{\\Delta y^2} \\right)$\n\n为了使格式成为一个凸组合，系数必须为非负且和为1。我们首先检查和：\n$\\sum \\alpha = \\alpha_{0,0} + \\alpha_{1,0} + \\alpha_{-1,0} + \\alpha_{0,1} + \\alpha_{0,-1}$\n$= 1 - \\Delta t \\left( \\frac{|u|}{\\Delta x} + \\frac{2K_x}{\\Delta x^2} + \\frac{|v|}{\\Delta y} + \\frac{2K_y}{\\Delta y^2} \\right) + \\frac{\\Delta t}{\\Delta x} \\left( u^{+}-u^{-} + \\frac{2K_x}{\\Delta x} \\right) + \\frac{\\Delta t}{\\Delta y} \\left( v^{+}-v^{-} + \\frac{2K_y}{\\Delta y} \\right)$\n使用 $|u|=u^+-u^-$ 和 $|v|=v^+-v^-$：\n$= 1 - \\Delta t \\left( \\frac{|u|}{\\Delta x} + \\frac{2K_x}{\\Delta x^2} + \\frac{|v|}{\\Delta y} + \\frac{2K_y}{\\Delta y^2} \\right) + \\Delta t \\left( \\frac{|u|}{\\Delta x} + \\frac{2K_x}{\\Delta x^2} \\right) + \\Delta t \\left( \\frac{|v|}{\\Delta y} + \\frac{2K_y}{\\Delta y^2} \\right) = 1$\n系数之和为1，因此该格式是守恒的。\n\n接下来，我们对每个系数强制要求非负性。\n- 由于 $\\Delta t > 0$，$\\Delta x > 0$，$K_x \\ge 0$，$u^{+} \\ge 0$ 且 $-u^{-} \\ge 0$，系数 $\\alpha_{1,0}$ 和 $\\alpha_{-1,0}$ 总是非负的。\n- 类似地，$\\alpha_{0,1}$ 和 $\\alpha_{0,-1}$ 总是非负的。\n- 因此，保持非负性的条件完全取决于中心系数 $\\alpha_{0,0}$。我们必须有 $\\alpha_{0,0} \\ge 0$。\n$$\n1 - \\Delta t \\left( \\frac{|u|}{\\Delta x} + \\frac{2K_x}{\\Delta x^2} + \\frac{|v|}{\\Delta y} + \\frac{2K_y}{\\Delta y^2} \\right) \\ge 0\n$$\n解出 $\\Delta t$：\n$$\n\\Delta t \\le \\frac{1}{\\frac{|u|}{\\Delta x} + \\frac{|v|}{\\Delta y} + \\frac{2K_x}{\\Delta x^2} + \\frac{2K_y}{\\Delta y^2}}\n$$\n这个条件是充分且必要的。如果该条件成立，则所有系数都非负且和为1。给定对所有 $(i,j)$ 均有 $C_{i,j}^n \\ge 0$，更新后的 $C_{i,j}^{n+1}$ 是非负值的非负权重加权和，因此也是非负的。如果该条件被违反，$\\alpha_{0,0}  0$，并且可以构造初始数据（例如，$C_{i,j}^n=1$，其他所有为0），从而得到 $C_{i,j}^{n+1} = \\alpha_{0,0}  0$。\n\n最大允许时间步长 $\\Delta t_{\\max}$ 是满足此不等式的 $\\Delta t$ 的最大值。\n$$\n\\Delta t_{\\max} = \\frac{1}{\\frac{|u|}{\\Delta x} + \\frac{|v|}{\\Delta y} + \\frac{2K_x}{\\Delta x^2} + \\frac{2K_y}{\\Delta y^2}}\n$$\n这可以写成一个更紧凑的形式。",
            "answer": "$$\n\\boxed{\\left( \\frac{|u|}{\\Delta x} + \\frac{|v|}{\\Delta y} + \\frac{2K_x}{\\Delta x^2} + \\frac{2K_y}{\\Delta y^2} \\right)^{-1}}\n$$"
        },
        {
            "introduction": "在实际的建模工作中，物理边界的完美遵守并非总能得到保证，尤其是在模型开发阶段或使用高阶格式时。因此，一项至关重要的技能是能够量化这些违规行为。这项练习要求您为上边界的超调和负示踪剂质量的产生定义精确且具有物理意义的诊断指标，这些技能对于模型验证和方案比较至关重要 。",
            "id": "3802474",
            "problem": "您正在评估一个海岸海洋模型中数值示踪剂输运步骤的质量。示踪剂浓度场 $c(\\mathbf{x},t)$ 由标准的被动示踪剂平流-扩散偏微分方程（PDE）控制\n$$\n\\frac{\\partial c}{\\partial t} + \\nabla \\cdot (\\mathbf{u}\\,c - \\mathbf{K}\\,\\nabla c) = S,\n$$\n其中 $\\mathbf{u}$ 是速度，$\\mathbf{K}$ 是对称半正定扩散张量，$S$ 是源-汇项。在理想情况下，即 $S=0$、周期性或不可渗透边界、非负扩散率、且边界无示踪剂注入时，连续极值原理意味着如果 $c(\\mathbf{x},0)\\in [C_{\\min}, C_{\\max}]$，那么对于所有后续时间，$c(\\mathbf{x},t)\\in [C_{\\min}, C_{\\max}]$，而正值保持则对应于 $c(\\mathbf{x},t)\\ge 0$。\n\n在一个离散的有限体积模型中，一个时间步长后，您有 $N$ 个控制体积（单元），其单元体积为 $\\{V_i\\}_{i=1}^N$，单元平均浓度为 $\\{c_i\\}_{i=1}^N$。您被告知，物理上允许的上限是 $C_{\\max}$，而正值下限是 $0$。您希望定义两个标量诊断量来衡量违规情况：\n\n- 一个单调性诊断量 $D_{\\text{over}}$，它捕捉了点态上最大的上限违规量，是非负的，具有浓度的单位，并且当且仅当对于所有 $i$ 都有 $c_i \\le C_{\\max}$ 时，该诊断量为零。\n- 一个正值诊断量 $D_{\\text{neg}}$，它捕捉了总的负示踪剂数量，是非负的，具有示踪剂质量的单位，并且当且仅当对于所有 $i$ 都有 $c_i \\ge 0$ 时，该诊断量为零。\n\n从以下概念出发：(i) 质量是浓度的体积积分，其离散模拟是体积加权和；(ii) 连续问题中的最大值和最小值是逐点评估的；(iii) 违规量不应因跨单元平均而抵消。请选择定义了满足所有给定标准且在网格细化时与连续极限一致的诊断量对 $\\left(D_{\\text{over}}, D_{\\text{neg}}\\right)$ 的选项。\n\nA. $D_{\\text{over}} = \\max_i \\left[ \\max\\left(0,\\, c_i - C_{\\max}\\right) \\right]$, 且 $D_{\\text{neg}} = \\sum_{i=1}^N \\max\\left(0,\\,-c_i\\right)\\, V_i$。\n\nB. $D_{\\text{over}} = \\sum_{i=1}^N \\max\\left(0,\\, c_i - C_{\\max}\\right)\\, V_i$, 且 $D_{\\text{neg}} = \\max_i \\left[ \\max\\left(0,\\,-c_i\\right) \\right]$。\n\nC. $D_{\\text{over}} = \\left(\\sum_{i=1}^N \\left(c_i - C_{\\max}\\right)^2 V_i \\right)^{1/2}$, 且 $D_{\\text{neg}} = \\begin{cases}\\sum_{i=1}^N \\left(-c_i\\right)\\, V_i,  \\text{若 } \\min_i c_i  0,\\\\ 0,  \\text{其他情况。}\\end{cases}$\n\nD. $D_{\\text{over}} = \\max_i \\left(c_i - C_{\\max}\\right)$, 且 $D_{\\text{neg}} = \\dfrac{\\sum_{i=1}^N \\max\\left(0,\\,-c_i\\right)\\, V_i}{\\sum_{i=1}^N V_i}$。\n\n选择正确的选项。可能有一个以上的正确答案；请选择所有适用的选项，并根据基本守恒、量纲一致性和极值原理来证明您的选择。除了正体积 $\\{V_i\\}$ 和分段常数的单元平均值 $\\{c_i\\}$ 外，不要假定网格有任何特殊结构。",
            "solution": "在评估选项之前，我们将根据所述标准推导出 $D_{\\text{over}}$ 和 $D_{\\text{neg}}$ 的正确函数形式。\n\n**单调性诊断量（$D_{\\text{over}}$）的分析**\n\n1.  **捕捉点态上最大的上限违规量**：“点态”指的是每个单元 $i$。单元 $i$ 中的违规量是 $c_i$ 超过 $C_{\\max}$ 的程度，由 $c_i - C_{\\max}$ 给出。由于我们只关心违规（超调），所以只有当这个量为正时才有意义。这可以用表达式 $\\max(0, c_i - C_{\\max})$ 来捕捉。问题要求的是所有单元中此类违规量的*最大值*，数学上表示为 $\\max_{i} \\left[ \\max(0, c_i - C_{\\max}) \\right]$。这等价于 $\\max(0, \\max_i(c_i - C_{\\max}))$。\n2.  **是非负的**：函数 $\\max(0, x)$ 根据定义是非负的。一组非负数的最大值也是非负的。此标准得到满足。\n3.  **具有浓度的单位**：量 $c_i$ 和 $C_{\\max}$ 的单位是浓度。它们的差值 $c_i - C_{\\max}$ 的单位也是浓度。$\\max$ 算子保留单位。因此，最终的诊断量具有浓度的单位。此标准得到满足。\n4.  **当且仅当对所有 $i$ 都有 $c_i \\le C_{\\max}$ 时为零**：\n    -   如果对所有 $i$ 都有 $c_i \\le C_{\\max}$，则 $c_i - C_{\\max} \\le 0$。因此，对所有 $i$ 都有 $\\max(0, c_i - C_{\\max}) = 0$。一组零的最大值是 $0$。所以，$D_{\\text{over}} = 0$。\n    -   如果 $D_{\\text{over}} = \\max_{i} \\left[ \\max(0, c_i - C_{\\max}) \\right] = 0$，这意味着对于每个单元 $i$，$\\max(0, c_i - C_{\\max}) = 0$。这仅在 $c_i - C_{\\max} \\le 0$ 时成立，即对所有 $i$ 都有 $c_i \\le C_{\\max}$。\n    此标准得到满足。\n\n因此，单调性诊断量的正确形式是 $D_{\\text{over}} = \\max_i \\left[ \\max(0, c_i - C_{\\max}) \\right]$。\n\n**正值诊断量（$D_{\\text{neg}}$）的分析**\n\n1.  **捕捉总的负示踪剂数量**：问题指明“质量是浓度的体积积分，其离散模拟是体积加权和”。因此，“数量”指的是质量。单元 $i$ 中的“负浓度”在 $c_i  0$ 时为 $-c_i$，否则为 $0$。这可以用 $\\max(0, -c_i)$ 来捕捉。单元 $i$ 中的负*质量*是此浓度乘以体积，即 $\\max(0, -c_i) V_i$。 “总”负质量是所有单元的总和：$\\sum_{i=1}^N \\max(0, -c_i) V_i$。\n2.  **是非负的**：对于任何 $c_i$，$\\max(0, -c_i) \\ge 0$。由于单元体积 $V_i$ 被给定为正值，所以和中的每一项 $\\max(0, -c_i) V_i$ 都是非负的。非负项的和也是非负的。此标准得到满足。\n3.  **具有示踪剂质量的单位**：让浓度的单位 $[c]$ 为 质量/体积（$[M][L]^{-3}$），体积的单位 $[V]$ 为 $[L]^3$。乘积 $\\max(0, -c_i) V_i$ 的单位是 $([M][L]^{-3}) \\times [L]^3 = [M]$，即质量。质量的总和仍然是质量。此标准得到满足。\n4.  **当且仅当对所有 $i$ 都有 $c_i \\ge 0$ 时为零**：\n    -   如果对所有 $i$ 都有 $c_i \\ge 0$，则 $-c_i \\le 0$。因此，对所有 $i$ 都有 $\\max(0, -c_i) = 0$。总和 $\\sum_{i=1}^N 0 \\cdot V_i = 0$。所以，$D_{\\text{neg}} = 0$。\n    -   如果 $D_{\\text{neg}} = \\sum_{i=1}^N \\max(0, -c_i) V_i = 0$，由于和中的每一项都是非负的，所以只有当每一项都为零时，和才能为零。对于每个 $i$，$\\max(0, -c_i) V_i = 0$。由于 $V_i  0$，这意味着 $\\max(0, -c_i) = 0$，这仅在 $-c_i \\le 0$ 或 $c_i \\ge 0$ 时成立。这必须对所有 $i$ 都成立。\n    此标准得到满足。\n\n因此，正值诊断量的正确形式是 $D_{\\text{neg}} = \\sum_{i=1}^N \\max(0, -c_i) V_i$。\n\n我们现在根据推导出的正确形式和所述标准来评估每个选项。\n\n**选项 A：**\n$D_{\\text{over}} = \\max_i \\left[ \\max\\left(0,\\, c_i - C_{\\max}\\right) \\right]$, 和 $D_{\\text{neg}} = \\sum_{i=1}^N \\max\\left(0,\\,-c_i\\right)\\, V_i$。\n-   $D_{\\text{over}}$ 的表达式与我们推导的形式完全匹配，并满足其所有标准（点态最大违规量、非负性、浓度单位和为零条件）。\n-   $D_{\\text{neg}}$ 的表达式与我们推导的形式完全匹配，并满足其所有标准（总负质量、非负性、质量单位和为零条件）。\n\n**结论：正确。**\n\n**选项 B：**\n$D_{\\text{over}} = \\sum_{i=1}^N \\max\\left(0,\\, c_i - C_{\\max}\\right)\\, V_i$, 和 $D_{\\text{neg}} = \\max_i \\left[ \\max\\left(0,\\,-c_i\\right) \\right]$。\n-   $D_{\\text{over}}$ 的表达式表示超过 $C_{\\max}$ 的*总超额质量*，而不是*点态上的最大浓度违规量*。此外，其单位是质量（浓度 $\\times$ 体积），这违反了要求其单位为浓度的规定。\n-   $D_{\\text{neg}}$ 的表达式表示*点态上最大的负浓度违规量*，而不是*总负质量*。其单位是浓度，这违反了要求其单位为质量的规定。\n这些定义与要求不符。\n\n**结论：不正确。**\n\n**选项 C：**\n$D_{\\text{over}} = \\left(\\sum_{i=1}^N \\left(c_i - C_{\\max}\\right)^2 V_i \\right)^{1/2}$, 和 $D_{\\text{neg}} = \\begin{cases}\\sum_{i=1}^N \\left(-c_i\\right)\\, V_i,  \\text{若 } \\min_i c_i  0,\\\\ 0,  \\text{其他情况。}\\end{cases}$\n-   $D_{\\text{over}}$ 的表达式是一个体积加权的 $L_2$ 范数。其单位是 $\\sqrt{([C]^2 [L]^3)} = [C][L]^{3/2}$，而不是浓度的单位。当所有 $i$ 的 $c_i \\le C_{\\max}$ 时，它也不为零；它仅在所有 $i$ 的 $c_i = C_{\\max}$ 时才为零。它衡量的是与 $C_{\\max}$ 的偏差，而不仅仅是超调。\n-   $D_{\\text{neg}}$ 的表达式存在缺陷。如果至少有一个单元的 $c_i  0$，而其他单元的 $c_j  0$，则求和 $\\sum_{i=1}^N (-c_i) V_i$ 会包含正项和负项，从而可能发生抵消。结果不保证是非负的。例如，如果 $c_1=-1, V_1=1$ 和 $c_2=2, V_2=1$，那么 $D_{\\text{neg}} = (-(-1))V_1 + (-2)V_2 = 1-2 = -1$，这违反了非负性要求。\n\n**结论：不正确。**\n\n**选项 D：**\n$D_{\\text{over}} = \\max_i \\left(c_i - C_{\\max}\\right)$, 和 $D_{\\text{neg}} = \\dfrac{\\sum_{i=1}^N \\max\\left(0,\\,-c_i\\right)\\, V_i}{\\sum_{i=1}^N V_i}$。\n-   $D_{\\text{over}}$ 的表达式不保证是非负的。如果所有 $c_i \\le C_{\\max}$（这种情况不构成违规），该诊断量将是非正的。而要求是诊断量在这种情况下为零且非负。\n-   $D_{\\text{neg}}$ 的表达式表示*区域平均*的负浓度。分子是总负质量，分母是总体积。最终的单位是浓度（质量/体积），而不是质量，这违反了一项关键要求。\n\n**结论：不正确。**\n\n基于此综合分析，只有选项 A 根据所有指定约束正确定义了两个诊断量。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "海洋模型很少孤立地模拟输运过程，它们通常涉及复杂的相互作用，例如生物地球化学反应。这项练习探讨了一个耦合的平流-反应系统，这是通过算子分裂法处理的常见情景。您将发现，源汇项会引入其自身的稳定性约束，这与平流的CFL条件无关，从而揭示了为何在综合地球系统模型中必须采用整体方法来维持物理真实性 。",
            "id": "3802464",
            "problem": "考虑一维周期性海洋柱中的两种生物地球化学示踪物：硝酸盐和浮游植物，其浓度分别用 $N(x,t)$ 和 $P(x,t)$ 表示，单位为毫摩尔氮每立方米（$\\mathrm{mmol\\,N\\,m^{-3}}$）。示踪物在恒定的正速度 $u$（米/秒）的线性平流作用下，以及具有化学计量产率的局部吸收/反应作用下演变。其控制守恒律是带有源项的示踪物守恒方程：\n$$\n\\frac{\\partial N}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(u N\\right) = -U(N,P), \\qquad\n\\frac{\\partial P}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(u P\\right) = Y\\,U(N,P) - m\\,P,\n$$\n其中 $U(N,P)$ 是吸收速率，$Y \\in (0,1]$ 是一个无量纲产率（每单位消耗的硝酸盐所产生的浮游植物氮），$m \\ge 0$ 是一个线性死亡率（单位：每秒）。吸收由经过充分检验的 Michaelis–Menten 形式给出：\n$$\nU(N,P) = \\mu \\,\\frac{N\\,P}{K + N},\n$$\n其中 $\\mu$ 是最大比吸收速率（单位：每秒），$K0$ 是半饱和常数（单位：$\\mathrm{mmol\\,N\\,m^{-3}}$）。\n\n你将实现一个算子分裂时间步，它由一个平流子步和一个反应子步组成。该计算在一个均匀周期性网格上进行，网格间距为 $\\Delta x$（米），并采用恒定的时间步长 $\\Delta t$（秒）。对于平流，使用适用于 $u0$ 的一阶迎风格式：\n$$\nC_i^{*} = C_i^{n} - \\lambda \\left(C_i^{n} - C_{i-1}^{n}\\right), \\quad \\lambda = \\frac{u\\,\\Delta t}{\\Delta x},\n$$\n该格式分别应用于 $C=N$ 和 $C=P$，其中对 $i-1$ 使用周期性索引。对于反应子步，逐点应用显式向前欧拉法：\n$$\nU_i^{*} = \\mu\\,\\frac{N_i^{*}\\,P_i^{*}}{K + N_i^{*}}, \\quad\nN_i^{n+1} = N_i^{*} - \\Delta t\\,U_i^{*}, \\quad\nP_i^{n+1} = P_i^{*} + Y\\,\\Delta t\\,U_i^{*} - m\\,\\Delta t\\,P_i^{*}.\n$$\n\n定义在执行这一个时间步后要测试的以下数值属性：\n\n- 正定性保持：对于所有网格索引 $i$，$N_i^{n+1} \\ge 0$ 和 $P_i^{n+1} \\ge 0$。\n- 平流后的单调性：对于每个示踪物 $C\\in\\{N,P\\}$，平流后的值 $C_i^{*}$ 对于所有 $i$ 均满足 $C_i^{*}\\in\\left[\\min_j C_j^{n},\\,\\max_j C_j^{n}\\right]$。\n- 吸收作用下的化学计量上限：对于所有索引 $i$，反应后的浮游植物满足 $P_i^{n+1} \\le P_i^{*} + Y\\,N_i^{*}$，这意味着在产率为 $Y$ 时，显式吸收过程在同一个时间步内，在同一个单元格中，不能产生比可用硝酸盐更多的浮游植物氮。\n\n在具有 $N_x$ 个均匀单元格、总长度为 $L = N_x \\,\\Delta x$ 且具有周期性边界条件的域上实现上述过程。在时间 $t^n$ 用空间变化的平滑剖面初始化示踪物场：\n$$\nN_i^{n} = 2.0 + 1.5 \\sin\\left( \\frac{2\\pi x_i}{L} \\right), \\qquad\nP_i^{n} = 0.8 + 0.7 \\cos\\left( \\frac{2\\pi x_i}{L} \\right),\n$$\n其中对于 $i=0,1,\\dots,N_x-1$，$x_i = i\\,\\Delta x$。这些初始条件的单位是 $\\mathrm{mmol\\,N\\,m^{-3}}$。\n\n你的程序必须实现单步更新，并为以下每个测试用例评估上述三个属性（所有角度以弧度为单位，所有距离以米为单位，所有时间以秒为单位，所有浓度以 $\\mathrm{mmol\\,N\\,m^{-3}}$ 为单位）：\n\n- 测试用例1（理想路径，中等吸收，中等库朗数）：$N_x=128$, $\\Delta x=1000$, $u=0.5$, $\\Delta t=1200$, $\\mu=0.005$, $K=0.5$, $Y=0.8$, $m=0.0$。\n- 测试用例2（边界库朗数 $\\lambda=1$，单位产率）：$N_x=128$, $\\Delta x=1000$, $u=1.0$, $\\Delta t=1000$, $\\mu=0.02$, $K=0.5$, $Y=1.0$, $m=0.0$。\n- 测试用例3（强吸收可能导致违例）：$N_x=128$, $\\Delta x=1000$, $u=0.2$, $\\Delta t=4000$, $\\mu=2.0$, $K=0.2$, $Y=0.9$, $m=0.0$。\n- 测试用例4（死亡率主导的衰减边界情况）：$N_x=128$, $\\Delta x=1000$, $u=0.2$, $\\Delta t=4000$, $\\mu=0.0$, $K=0.5$, $Y=0.8$, $m=0.001$。\n\n对于每个测试用例，计算三个布尔值：正定性是否保持、化学计量上限是否保持、平流后单调性是否保持。你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素本身是针对四个测试用例的、按上述顺序排列的三个布尔值的列表。例如，输出格式必须与此完全一样：\n$[ [b_{11},b_{12},b_{13}], [b_{21},b_{22},b_{23}], [b_{31},b_{32},b_{33}], [b_{41},b_{42},b_{43}] ]$，\n其中每个 $b_{ij}$ 是 $\\mathrm{True}$ 或 $\\mathrm{False}$。",
            "solution": "目标是评估硝酸盐和浮游植物的耦合平流-反应更新是否在强吸收条件下保持正定性、平流后的单调性以及浮游植物的化学计量上限。设计始于基本守恒律和经过充分检验的数值离散化方法。\n\n控制方程体现了带源项的示踪物守恒：\n$$\n\\frac{\\partial C}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(u C\\right) = S_C, \\quad C\\in\\{N,P\\},\n$$\n其中 $S_N = -U(N,P)$ 且 $S_P = Y U(N,P) - mP$。吸收项 $U(N,P) = \\mu \\,\\frac{N\\,P}{K+N}$ 对于 $N$ 和 $P$ 都是单调递增的，并且当 $N\\ge 0$ 和 $P\\ge 0$ 时为非负。离散化采用一阶迎风格式处理平流，显式向前欧拉法处理反应。算子分裂序列是先平流后反应，这利用了海洋示踪物模拟中公认的稳健做法。\n\n对于平流，在均匀网格上针对 $u0$ 的一维迎风更新为：\n$$\nC_i^{*} = C_i^{n} - \\lambda \\left(C_i^{n} - C_{i-1}^{n}\\right),\n$$\n其中库朗数 $\\lambda = \\frac{u\\Delta t}{\\Delta x}$。这个公式可以写成一个凸组合：\n$$\nC_i^{*} = (1-\\lambda) C_i^{n} + \\lambda C_{i-1}^{n}.\n$$\n当 $0 \\le \\lambda \\le 1$ 时，这个凸组合蕴含了两个关键属性：\n\n- 平流作用下的正定性保持：如果对所有 $i$ 都有 $C_i^{n}\\ge 0$，那么对所有 $i$ 也都有 $C_i^{*}\\ge 0$，因为非负数的非负凸组合是非负的。\n- 单调性，具体来说即不产生新的极值：每个 $C_i^{*}$ 都位于由 $C_i^{n}$ 和 $C_{i-1}^{n}$ 所张成的区间内；因此 $C_i^{*}\\in\\left[\\min(C_i^{n},C_{i-1}^{n}),\\,\\max(C_i^{n},C_{i-1}^{n})\\right]$。因此，全局最小值不会减小，全局最大值不会增加，即对于所有 $i$，$C_i^{*}\\in\\left[\\min_j C_j^{n},\\,\\max_j C_j^{n}\\right]$。\n\n这些属性源于具有恒定速度的线性平流算子的一阶迎风离散化方法的线性性质和凸结构。\n\n对于反应步骤，在平流后逐点应用显式向前欧拉更新：\n$$\nU_i^{*} = \\mu\\,\\frac{N_i^{*}\\,P_i^{*}}{K + N_i^{*}}, \\quad\nN_i^{n+1} = N_i^{*} - \\Delta t\\,U_i^{*}, \\quad\nP_i^{n+1} = P_i^{*} + Y\\,\\Delta t\\,U_i^{*} - m\\,\\Delta t\\,P_i^{*}.\n$$\n检验两个关键属性：\n\n- 正定性保持：从更新公式看，$N_i^{n+1}\\ge 0$ 要求 $\\Delta t\\,U_i^{*} \\le N_i^{*}$，等价于 $\\Delta t \\,\\mu \\,\\frac{N_i^{*}\\,P_i^{*}}{K + N_i^{*}} \\le N_i^{*}$，可简化为 $\\Delta t \\,\\mu \\,\\frac{P_i^{*}}{K + N_i^{*}} \\le 1$。对于浮游植物，$P_i^{n+1}\\ge 0$ 要求 $P_i^{*} + Y\\,\\Delta t\\,U_i^{*} - m\\,\\Delta t\\,P_i^{*} \\ge 0$。在死亡率主导的情景（$U_i^{*}=0$）中，这简化为 $1 - m\\,\\Delta t \\ge 0$。在强吸收条件下，如果 $\\Delta t$ 过大，显式欧拉法可能会违反这些不等式，导致 $N_i^{n+1}$ 为负，并且当 $m\\,\\Delta t  1$ 或数值过冲与衰减相结合时，可能导致 $P_i^{n+1}$ 为负。\n\n- 吸收作用下的化学计量上限：因为吸收过程消耗硝酸盐并以产率 $Y$ 产生浮游植物，所以在单个显式欧拉步中一个有物理意义的界限是\n$$\nP_i^{n+1} \\le P_i^{*} + Y\\,N_i^{*}.\n$$\n该界限强制要求，在产率为 $Y$ 时，浮游植物氮的产生不能超过同一单元格和时间步内可用的硝酸盐氮。从显式欧拉公式来看，只要 $\\Delta t\\,U_i^{*} \\le N_i^{*}$（与防止硝酸盐变为负值的条件相同），这个不等式就成立。如果显式欧拉法导致 $\\Delta t\\,U_i^{*}  N_i^{*}$，那么在强吸收条件下，硝酸盐的正定性和化学计量上限都可能被违反，这表明时间步长过大，或者反应积分需要进行保持正定性的修正。\n\n算法步骤如下：\n\n- 使用平滑的空间剖面初始化 $N_i^{n}$ 和 $P_i^{n}$，以确保正定性和非平凡梯度。\n- 对 $N$ 和 $P$ 使用带周期性边界条件的一阶迎风格式计算平流步骤，得到 $N_i^{*}$ 和 $P_i^{*}$。\n- 通过对每个示踪物 $C$ 在所有索引上验证 $N_i^{*},P_i^{*}\\in[\\min_j C_j^{n},\\max_j C_j^{n}]$ 来检查平流后的单调性。\n- 计算吸收项 $U_i^{*}$ 并应用显式欧拉反应更新以获得 $N_i^{n+1}$ 和 $P_i^{n+1}$。\n- 检查正定性（对所有 $i$，$N_i^{n+1}\\ge 0$，$P_i^{n+1}\\ge 0$）和化学计量上限（对所有 $i$，$P_i^{n+1} \\le P_i^{*} + Y\\,N_i^{*}$）。\n\n将这些步骤应用于指定的测试套件：\n\n- 测试用例1中 $\\lambda = \\frac{0.5 \\times 1200}{1000} = 0.6 \\in [0,1]$；平流是单调且保持正定性的。吸收是中等的（$\\mu = 0.005$），$\\Delta t$ 是适中的，所以在整个域上 $\\Delta t\\,U_i^{*} \\ll N_i^{*}$。我们预期正定性和上限都会被保持。\n- 测试用例2中 $\\lambda = \\frac{1.0 \\times 1000}{1000} = 1$；在边界库朗数下，平流仍然是单调且保持正定性的。对于给定的初始场，当 $\\mu = 0.02$ 和 $\\Delta t = 1000$ 时，吸收项仍然产生 $\\Delta t\\,U_i^{*} \\lesssim N_i^{*}$，保持了正定性和上限。\n- 测试用例3中 $\\lambda = \\frac{0.2 \\times 4000}{1000} = 0.8 \\in [0,1]$，所以平流的单调性成立。然而，强吸收（$\\mu = 2.0$）和大的 $\\Delta t = 4000$ 在域的某些部分产生 $\\Delta t\\,U_i^{*} \\gg N_i^{*}$，由于过度的显式消耗，导致 $N_i^{n+1}  0$ 并违反了 $P_i^{n+1} \\le P_i^{*} + Y\\,N_i^{*}$。正定性和上限不满足。\n- 测试用例4中 $\\lambda = \\frac{0.2 \\times 4000}{1000} = 0.8$，所以平流的单调性再次得到满足。吸收为零（$\\mu=0$），但死亡率很显著，有 $m\\,\\Delta t = 0.001 \\times 4000 = 4$。反应更新给出 $P_i^{n+1} = P_i^{*}(1 - 4) = -3 P_i^{*}$，使得浮游植物处处为负；因此正定性不满足。上限 $P_i^{n+1} \\le P_i^{*} + Y\\,N_i^{*}$ 自然成立，因为 $P_i^{n+1}$ 是负的，而右侧是正的。\n\n程序将使用指定的离散化方法数值计算这些更新，并为每个测试用例报告三个布尔值，分别指示是否保持了正定性、化学计量上限和平流单调性。输出是一个包含四个列表的单一列表，每个列表按规定的顺序包含三个布尔值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef upwind_advection_positive_velocity(C, u, dt, dx):\n    \"\"\"\n    First-order upwind advection for constant positive velocity with periodic BC.\n    C: array of tracer concentration at time n\n    Returns C_star after advection substep.\n    \"\"\"\n    lam = u * dt / dx  # Courant number\n    # Periodic left neighbor\n    C_left = np.roll(C, 1)\n    C_star = C - lam * (C - C_left)\n    return C_star, lam\n\ndef reaction_euler(N_star, P_star, mu, K, Y, m, dt):\n    \"\"\"\n    Explicit Euler reaction update:\n    U = mu * N_star * P_star / (K + N_star)\n    N_new = N_star - dt * U\n    P_new = P_star + Y * dt * U - m * dt * P_star\n    \"\"\"\n    # Prevent division issues: K > 0 per problem statement; N_star may be zero.\n    U = mu * N_star * P_star / (K + N_star)\n    N_new = N_star - dt * U\n    P_new = P_star + Y * dt * U - m * dt * P_star\n    return N_new, P_new, U\n\ndef check_monotonicity_after_advection(C_old, C_star, tol=1e-12):\n    \"\"\"\n    Check that each entry of C_star lies within [min(C_old), max(C_old)].\n    \"\"\"\n    cmin = np.min(C_old)\n    cmax = np.max(C_old)\n    return np.all(C_star >= cmin - tol) and np.all(C_star = cmax + tol)\n\ndef run_case(Nx, dx, u, dt, mu, K, Y, m):\n    # Domain setup\n    L = Nx * dx\n    x = np.arange(Nx) * dx\n\n    # Initial conditions (mmol N m^-3)\n    N0 = 2.0 + 1.5 * np.sin(2.0 * np.pi * x / L)\n    P0 = 0.8 + 0.7 * np.cos(2.0 * np.pi * x / L)\n\n    # Advection substep\n    N_star, lam_N = upwind_advection_positive_velocity(N0, u, dt, dx)\n    P_star, lam_P = upwind_advection_positive_velocity(P0, u, dt, dx)\n\n    # Monotonicity checks for advection\n    mono_N = check_monotonicity_after_advection(N0, N_star)\n    mono_P = check_monotonicity_after_advection(P0, P_star)\n    monotonicity_preserved = mono_N and mono_P\n\n    # Reaction substep\n    N_new, P_new, U_star = reaction_euler(N_star, P_star, mu, K, Y, m, dt)\n\n    # Positivity check\n    tol = 1e-12\n    positivity_preserved = (np.all(N_new >= -tol) and np.all(P_new >= -tol))\n\n    # Stoichiometric upper bound: P_new = P_star + Y * N_star\n    upper_bound_preserved = np.all(P_new = P_star + Y * N_star + tol)\n\n    return [positivity_preserved, upper_bound_preserved, monotonicity_preserved]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Nx, dx, u, dt, mu, K, Y, m)\n        (128, 1000.0, 0.5, 1200.0, 0.005, 0.5, 0.8, 0.0),   # Test Case 1\n        (128, 1000.0, 1.0, 1000.0, 0.02, 0.5, 1.0, 0.0),    # Test Case 2\n        (128, 1000.0, 0.2, 4000.0, 2.0, 0.2, 0.9, 0.0),     # Test Case 3\n        (128, 1000.0, 0.2, 4000.0, 0.0, 0.5, 0.8, 0.001),   # Test Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        Nx, dx, u, dt, mu, K, Y, m = case\n        result = run_case(Nx, dx, u, dt, mu, K, Y, m)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # Python's print of list of lists matches the specified bracketed, comma-separated format.\n    print(f\"{results}\")\n\nsolve()\n```"
        }
    ]
}