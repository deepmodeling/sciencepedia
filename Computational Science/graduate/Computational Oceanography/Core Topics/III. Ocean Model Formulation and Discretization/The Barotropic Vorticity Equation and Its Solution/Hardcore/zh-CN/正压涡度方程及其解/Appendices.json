{
    "hands_on_practices": [
        {
            "introduction": "在深入研究复杂的数值模型之前，理解主导性的物理平衡至关重要。斯韦尔德鲁普关系（Sverdrup relation）便是一个核心范例，它将风应力与广阔大洋内部缓慢的南北向流动联系起来。这项练习  提供了一个亲身实践的机会，让您推导这一基本关系，并使用真实世界的参数进行计算，从而对控制大尺度海洋环流的物理机制获得切实的感受。",
            "id": "3813697",
            "problem": "考虑一个位于 $\\beta$ 平面上的矩形中纬度海洋内部，其参考密度 $\\rho_{0}$ 为常数，深度 $H$ 均匀。假设海洋处于稳态、Boussinesq、静力平衡状态，其内部的涡度平衡由远离边界的深度积分、线性、正压涡度动力学控制。风应力纯粹是纬向的，并随经向变化如下\n$$\n\\tau_{x}(y) \\;=\\; \\tau_{0}\\,\\sin\\!\\left(\\frac{2\\pi\\, y}{L_{y}}\\right), \n\\qquad \n\\tau_{y}(x,y)\\;=\\;0,\n$$\n其中 $0 \\le y \\le L_{y}$，且 $\\tau_{0}  0$。使用亚热带环流内部的典型参数：\n$$\n\\beta \\;=\\; 2.0 \\times 10^{-11}\\ \\mathrm{m}^{-1}\\,\\mathrm{s}^{-1},\\quad \n\\rho_{0} \\;=\\; 1025\\ \\mathrm{kg}\\,\\mathrm{m}^{-3},\\quad \nH \\;=\\; 4000\\ \\mathrm{m},\\quad \n\\tau_{0} \\;=\\; 0.10\\ \\mathrm{N}\\,\\mathrm{m}^{-2},\\quad \nL_{y} \\;=\\; 3.0 \\times 10^{6}\\ \\mathrm{m}.\n$$\n\n从适用于此背景的适当的深度积分定律出发，推导连接深度平均经向速度 $v(y)$ 与风应力旋度的稳态内部关系。然后，利用该关系，计算 $y = L_{y}/3$ 处的内部深度平均经向速度。将最终数值答案四舍五入到四位有效数字，并以 $\\mathrm{m}\\,\\mathrm{s}^{-1}$ 为单位表示。在推导过程中，清楚地说明允许忽略某些项的假设，并简要解释在此内部平衡中 $v$ 的大小如何依赖于 $H$。",
            "solution": "该问题经评估具有科学依据、提法明确、客观，并包含完整且一致的设定。对于指定的海洋学背景，这些参数是物理上现实的。因此，该问题被认为是有效的，可以构建完整的解答。\n\n问题要求从 $\\beta$ 平面上正压海洋的控制动力学推导稳态的内部经向速度。出发点是 Boussinesq 流体的水平动量方程组，通过稳态（$\\frac{\\partial}{\\partial t} = 0$）和线性动力学（忽略平流项）的假设进行简化。\n\n线性化的稳态水平动量方程为：\n$$\n-f v = -\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial x} + \\frac{1}{\\rho_0}\\frac{\\partial \\tau_x}{\\partial z}\n$$\n$$\nf u = -\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial y} + \\frac{1}{\\rho_0}\\frac{\\partial \\tau_y}{\\partial z}\n$$\n其中 $u$ 和 $v$ 分别是纬向和经向速度，$f = f_0 + \\beta y$ 是 $\\beta$ 平面上的科里奥利参数，$p$ 是压力，$\\rho_0$ 是恒定的参考密度，$\\tau_x$ 和 $\\tau_y$ 是粘性应力的水平分量。\n\n我们将这些方程在海洋的整个深度上进行积分，从底部的 $z = -H$ 到表面的 $z=0$。我们定义深度积分输运（或体积输运）为 $U = \\int_{-H}^{0} u \\,dz$ 和 $V = \\int_{-H}^{0} v \\,dz$。深度平均速度则为 $\\bar{u} = U/H$ 和 $\\bar{v} = V/H$。对于正压流，$u$ 和 $v$ 与深度无关，因此 $U = uH$ 和 $V = vH$。问题要求的是深度平均速度，在最后步骤中我们将其简单地记为 $v(y)$，与问题陈述一致。\n\n对动量方程进行积分得到：\n$$\n-f \\int_{-H}^{0} v \\,dz = -\\frac{1}{\\rho_0}\\int_{-H}^{0} \\frac{\\partial p}{\\partial x} \\,dz + \\frac{1}{\\rho_0}\\int_{-H}^{0} \\frac{\\partial \\tau_x}{\\partial z} \\,dz\n$$\n$$\nf \\int_{-H}^{0} u \\,dz = -\\frac{1}{\\rho_0}\\int_{-H}^{0} \\frac{\\partial p}{\\partial y} \\,dz + \\frac{1}{\\rho_0}\\int_{-H}^{0} \\frac{\\partial \\tau_y}{\\partial z} \\,dz\n$$\n这些方程变为：\n$$\n-fV = -\\frac{1}{\\rho_0}\\frac{\\partial P}{\\partial x} + \\frac{1}{\\rho_0}\\left[\\tau_x(z=0) - \\tau_x(z=-H)\\right]\n$$\n$$\nfU = -\\frac{1}{\\rho_0}\\frac{\\partial P}{\\partial y} + \\frac{1}{\\rho_0}\\left[\\tau_y(z=0) - \\tau_y(z=-H)\\right]\n$$\n其中 $P = \\int_{-H}^{0} p \\,dz$ 是深度积分压力。表面的应力是风应力，$\\vec{\\tau}_{\\text{wind}} = (\\tau_x(z=0), \\tau_y(z=0))$，这是已知的。在海洋内部，一个标准的假设是底部摩擦可以忽略不计，因此 $\\tau_x(z=-H)=0$ 且 $\\tau_y(z=-H)=0$。方程简化为：\n$$\n-fV = -\\frac{1}{\\rho_0}\\frac{\\partial P}{\\partial x} + \\frac{\\tau_x}{\\rho_0}\n$$\n$$\nfU = -\\frac{1}{\\rho_0}\\frac{\\partial P}{\\partial y} + \\frac{\\tau_y}{\\rho_0}\n$$\n其中 $\\tau_x$ 和 $\\tau_y$ 现在代表表面风应力的分量。\n\n为了得到涡度平衡，我们对这些输运方程取旋度：对第二个方程求 $\\frac{\\partial}{\\partial x}$，减去对第一个方程求 $\\frac{\\partial}{\\partial y}$。\n$$\n\\frac{\\partial}{\\partial x}(fU) - \\frac{\\partial}{\\partial y}(-fV) = -\\frac{1}{\\rho_0}\\left(\\frac{\\partial^2 P}{\\partial x \\partial y} - \\frac{\\partial^2 P}{\\partial y \\partial x}\\right) + \\frac{1}{\\rho_0}\\left(\\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y}\\right)\n$$\n压力项消失了，因为偏导数可以交换次序（$\\frac{\\partial^2 P}{\\partial x \\partial y} = \\frac{\\partial^2 P}{\\partial y \\partial x}$）。右边变为 $\\frac{1}{\\rho_0} \\mathrm{curl}_z(\\vec{\\tau})$。左边展开为：\n$$\n\\frac{\\partial}{\\partial x}(fU) + \\frac{\\partial}{\\partial y}(fV) = f\\left(\\frac{\\partial U}{\\partial x} + \\frac{\\partial V}{\\partial y}\\right) + U\\frac{\\partial f}{\\partial x} + V\\frac{\\partial f}{\\partial y}\n$$\n对于一个具有平坦底部的正压流体，深度积分的连续性方程（$\\int_{-H}^0 (\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} + \\frac{\\partial w}{\\partial z}) dz = 0$）简化为 $\\frac{\\partial U}{\\partial x} + \\frac{\\partial V}{\\partial y} = 0$。此外，在 $\\beta$ 平面上，$f$ 仅随纬度 $y$ 变化，所以 $\\frac{\\partial f}{\\partial x} = 0$ 且 $\\frac{\\partial f}{\\partial y} = \\beta$。因此，涡度平衡简化为：\n$$\n\\beta V = \\frac{1}{\\rho_0}\\left(\\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y}\\right) \\equiv \\frac{1}{\\rho_0} \\mathrm{curl}_z(\\vec{\\tau})\n$$\n这就是斯维尔德鲁普关系，它将内部经向质量输运与风应力旋度联系起来。\n\n问题要求的是深度平均经向速度，$v(y) = V(y)/H$（因为对于正压流，速度与深度无关）。因此，该关系为：\n$$\nv(y) = \\frac{1}{\\beta \\rho_0 H} \\left( \\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y} \\right)\n$$\n这就是所求的内部关系。此推导中的关键假设是：稳态、线性动力学（小罗斯贝数）、$\\beta$ 平面近似、可忽略的底部摩擦以及平坦底部（恒定 $H$）。\n\n关于 $v$ 对 $H$ 的依赖关系，该关系表明，对于给定的风应力旋度，经向速度的大小 $|v|$ 与海洋深度 $H$ 成反比。单位纬向宽度的总经向输运 $V = vH$，仅由风应力旋度和行星涡度梯度 $\\beta$ 决定。更深的海洋可以通过较慢的深度平均速度来适应这种输运。\n\n现在我们根据给定的风应力计算速度：\n$$\n\\tau_{x}(y) = \\tau_{0}\\,\\sin\\!\\left(\\frac{2\\pi\\, y}{L_{y}}\\right), \\qquad \\tau_{y}(x,y) = 0\n$$\n风应力的旋度为：\n$$\n\\mathrm{curl}_z(\\vec{\\tau}) = \\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y} = \\frac{\\partial}{\\partial x}(0) - \\frac{\\partial}{\\partial y}\\left[\\tau_{0}\\,\\sin\\!\\left(\\frac{2\\pi\\, y}{L_{y}}\\right)\\right]\n$$\n$$\n\\mathrm{curl}_z(\\vec{\\tau}) = - \\tau_0 \\left( \\frac{2\\pi}{L_y} \\right) \\cos\\!\\left(\\frac{2\\pi\\, y}{L_{y}}\\right)\n$$\n将此代入 $v(y)$ 的表达式中：\n$$\nv(y) = \\frac{1}{\\beta \\rho_0 H} \\left[ - \\frac{2\\pi \\tau_0}{L_y} \\cos\\!\\left(\\frac{2\\pi\\, y}{L_{y}}\\right) \\right] = - \\frac{2\\pi \\tau_0}{\\beta \\rho_0 H L_y} \\cos\\!\\left(\\frac{2\\pi\\, y}{L_{y}}\\right)\n$$\n我们需要在 $y = L_y/3$ 处计算该值：\n$$\nv\\left(\\frac{L_y}{3}\\right) = - \\frac{2\\pi \\tau_0}{\\beta \\rho_0 H L_y} \\cos\\!\\left(\\frac{2\\pi}{L_y} \\cdot \\frac{L_y}{3}\\right) = - \\frac{2\\pi \\tau_0}{\\beta \\rho_0 H L_y} \\cos\\!\\left(\\frac{2\\pi}{3}\\right)\n$$\n余弦项的值为 $\\cos(2\\pi/3) = -1/2$。\n$$\nv\\left(\\frac{L_y}{3}\\right) = - \\frac{2\\pi \\tau_0}{\\beta \\rho_0 H L_y} \\left(-\\frac{1}{2}\\right) = \\frac{\\pi \\tau_0}{\\beta \\rho_0 H L_y}\n$$\n现在，我们代入给定的数值：\n$\\beta = 2.0 \\times 10^{-11}\\ \\mathrm{m}^{-1}\\,\\mathrm{s}^{-1}$\n$\\rho_0 = 1025\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$\n$H = 4000\\ \\mathrm{m}$\n$\\tau_0 = 0.10\\ \\mathrm{N}\\,\\mathrm{m}^{-2}$\n$L_y = 3.0 \\times 10^{6}\\ \\mathrm{m}$\n\n$$\nv\\left(\\frac{L_y}{3}\\right) = \\frac{\\pi (0.10)}{(2.0 \\times 10^{-11})(1025)(4000)(3.0 \\times 10^6)}\n$$\n$$\nv\\left(\\frac{L_y}{3}\\right) = \\frac{0.10 \\pi}{ (2.0 \\times 1025 \\times 4000 \\times 3.0) \\times 10^{-5} } = \\frac{0.10 \\pi}{24600000 \\times 10^{-5}}\n$$\n$$\nv\\left(\\frac{L_y}{3}\\right) = \\frac{0.10 \\pi}{246} \\approx \\frac{0.314159}{246} \\approx 0.00127707\\ \\mathrm{m}\\,\\mathrm{s}^{-1}\n$$\n四舍五入到四位有效数字，结果为 $1.277 \\times 10^{-3}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$。",
            "answer": "$$\n\\boxed{1.277 \\times 10^{-3}}\n$$"
        },
        {
            "introduction": "尽管像斯韦尔德鲁普平衡这样的解析解能够很好地描述大洋内部，但要捕捉包括强烈边界流在内的完整环流，我们必须借助数值方法。这项练习  将指导您使用有限差分法——计算科学中的主力工具——从零开始构建一个数值求解器。您将学习如何将控制流函数的泊松方程离散化并处理不同的边界条件，从而将一个连续的物理问题转化为一个可计算的代数问题。",
            "id": "3813684",
            "problem": "考虑一个矩形域上的二维、正压、不可压缩的海洋流，其水平速度场由标量流函数 $\\psi(x,y)$ 表示，使得 $\\mathbf{u} = (u,v) = \\left(-\\frac{\\partial \\psi}{\\partial y}, \\frac{\\partial \\psi}{\\partial x}\\right)$。相对涡度 $\\zeta(x,y)$ 定义为 $\\zeta = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}$。对于正压流，这些定义意味着流函数和涡度之间存在一个 Poisson 关系，即 $\\nabla^2 \\psi = \\zeta$。\n\n您的任务是：\n1. 仅从流函数和相对涡度的定义以及不可压缩流的性质出发，推导出控制性 Poisson 方程，并在单位正方形域 $[0,1] \\times [0,1]$ 上对 Laplacian 算子 $\\nabla^2 \\psi$ 进行二阶、均匀网格的有限差分离散化。该域有 $N \\times N$ 个网格点，两个方向上的网格间距均为 $h = \\frac{1}{N-1}$。请明确说明应如何在内部点上构建离散算子。\n2. 为两种类型的边界条件制定边界处理方法：\n   - Dirichlet 边界条件：在所有四个边界上给定 $\\psi$ 的值。\n   - 齐次 Neumann 边界条件：在所有四个边界上 $\\frac{\\partial \\psi}{\\partial n} = 0$，其中 $\\frac{\\partial \\psi}{\\partial n}$ 表示垂直于边界的导数。请确保您的公式与邻近边界点的离散 Laplacian 算子相一致。在齐次 Neumann 条件下，讨论可解性条件以及解在相差一个可加常数下的非唯一性；定义一个规范以固定 $\\psi$ 的平均值。\n3. 提出并实现一个适用于大区域的迭代求解器，该求解器使用点松弛策略，根据离散化的 Poisson 方程局部更新 $\\psi$。用松弛参数描述迭代过程，并说明新值如何依赖于相邻点。解释基于离散 Poisson 算子导出的残差范数的停止准则。讨论该方法随 $N$ 的扩展性，并评论对于非常大的 $N$ 更有效的替代迭代方法。\n4. 在单位正方形上使用制造解法验证求解器。设 $(x_i, y_j)$ 表示网格点坐标。使用以下测试套件，其涵盖了内部点更新、边界处理、小网格行为和中等网格行为。对于每种情况，从制造的精确解 $\\psi(x_i,y_j)$ 构建 $\\zeta(x_i,y_j)$，应用适当的边界条件，运行您的求解器直至收敛，然后计算最大绝对逐点误差 $\\max_{i,j} |\\psi_{\\text{num}}(x_i,y_j) - \\psi_{\\text{exact}}(x_i,y_j)|$：\n   - 情况 A (Dirichlet, 理想情况)：$N = 33$。精确流函数为 $ \\psi_{\\text{exact}}(x,y) = \\sin(2\\pi x)\\sin(3\\pi y)$。所有边界上的 Dirichlet 边界值由 $\\psi_{\\text{exact}}$ 给出。通过在网格上逐点计算连续恒等式 $\\zeta = \\nabla^2 \\psi_{\\text{exact}}$ 来定义 $\\zeta(x,y)$。\n   - 情况 B (齐次 Neumann, 满足相容性)：$N = 33$。精确流函数为 $\\psi_{\\text{exact}}(x,y) = \\cos(2\\pi x) + \\cos(2\\pi y)$。所有边界上施加齐次 Neumann 边界条件 $\\frac{\\partial \\psi}{\\partial n} = 0$。通过 $\\zeta = \\nabla^2 \\psi_{\\text{exact}}$ 来定义 $\\zeta(x,y)$。通过在所有迭代中强制 $\\psi$ 的均值为零来施加规范。\n   - 情况 C (Dirichlet, 小网格边缘情况)：$N = 5$。精确流函数为 $ \\psi_{\\text{exact}}(x,y) = \\sin(2\\pi x)\\sin(3\\pi y)$。Dirichlet 边界值来自 $\\psi_{\\text{exact}}$；$\\zeta$ 的定义同前。\n   - 情况 D (齐次 Neumann, 中等网格)：$N = 49$。精确流函数为 $\\psi_{\\text{exact}}(x,y) = \\cos(2\\pi x) + \\cos(2\\pi y)$。齐次 Neumann 边界条件为 $\\frac{\\partial \\psi}{\\partial n} = 0$，并带有零均值规范。通过 $\\zeta = \\nabla^2 \\psi_{\\text{exact}}$ 来定义 $\\zeta$。\n\n实现要求：\n- 使用基于您的离散化并带有松弛参数的点松弛法。当离散残差 $r_{i,j} = \\left(\\nabla^2_h \\psi\\right)_{i,j} - \\zeta_{i,j}$ 的最大范数低于预设容差或达到最大迭代次数时，停止迭代。\n- 程序必须是自包含的，且不要求任何输入。\n- 对于每个测试用例，计算并报告在所有网格点上数值解 $\\psi$ 和精确解 $\\psi$ 之间的最大绝对逐点误差。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须包含分别对应于情况 A、B、C 和 D 的四个数字。每个数字必须是最大绝对逐点误差，并格式化为具有六位有效数字的科学记数法（例如，$[1.23\\text{e-}04,5.67\\text{e-}05,8.90\\text{e-}06,1.23\\text{e-}04]$）。结果无量纲，不适用任何物理单位或角度单位。",
            "solution": "所提出的问题是计算流体动力学中一个适定且标准的练习，具体来说是椭圆偏微分方程的数值解法。它要求推导和实现一个求解正压、不可压缩流中流函数所遵循的 Poisson 方程的有限差分求解器。该问题具有科学依据、自成体系，并且所有提供的数据和条件都是一致的。因此，我们可以进行完整求解。\n\n解决方案分为四个部分，与问题陈述中列出的任务相对应。\n\n### 1. 控制方程与有限差分离散化\n\n速度场 $\\mathbf{u} = (u,v)$ 和标量流函数 $\\psi(x,y)$ 之间的关系由下式给出：\n$$\nu = -\\frac{\\partial \\psi}{\\partial y}, \\qquad v = \\frac{\\partial \\psi}{\\partial x}\n$$\n不可压缩条件 $\\nabla \\cdot \\mathbf{u} = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} = 0$ 由此定义恒等满足，前提是 $\\psi$ 具有连续的二阶偏导数：\n$$\n\\frac{\\partial}{\\partial x}\\left(-\\frac{\\partial \\psi}{\\partial y}\\right) + \\frac{\\partial}{\\partial y}\\left(\\frac{\\partial \\psi}{\\partial x}\\right) = -\\frac{\\partial^2 \\psi}{\\partial x \\partial y} + \\frac{\\partial^2 \\psi}{\\partial y \\partial x} = 0\n$$\n相对涡度 $\\zeta$ 定义为速度场的旋度：\n$$\n\\zeta = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}\n$$\n将 $u$ 和 $v$ 的流函数定义代入 $\\zeta$ 的表达式，得到控制性 Poisson 方程：\n$$\n\\zeta = \\frac{\\partial}{\\partial x}\\left(\\frac{\\partial \\psi}{\\partial x}\\right) - \\frac{\\partial}{\\partial y}\\left(-\\frac{\\partial \\psi}{\\partial y}\\right) = \\frac{\\partial^2 \\psi}{\\partial x^2} + \\frac{\\partial^2 \\psi}{\\partial y^2} = \\nabla^2 \\psi\n$$\n为了数值求解该方程，我们在 $[0,1] \\times [0,1]$ 域上使用一个包含 $N \\times N$ 个点的均匀网格进行离散化。在 $x$ 和 $y$ 方向上的网格间距均为 $h = \\frac{1}{N-1}$。网格点的坐标为 $(x_i, y_j) = (i h, j h)$，其中 $i, j \\in \\{0, 1, \\dots, N-1\\}$。该点处的流函数值记为 $\\psi_{i,j}$。\n\nLaplacian 算子 $\\nabla^2 \\psi$ 在内部网格点 $(i,j)$ 处使用二阶精度的中心有限差分来离散化二阶偏导数：\n$$\n\\frac{\\partial^2 \\psi}{\\partial x^2}\\bigg|_{i,j} \\approx \\frac{\\psi_{i+1,j} - 2\\psi_{i,j} + \\psi_{i-1,j}}{h^2}\n$$\n$$\n\\frac{\\partial^2 \\psi}{\\partial y^2}\\bigg|_{i,j} \\approx \\frac{\\psi_{i,j+1} - 2\\psi_{i,j} + \\psi_{i,j-1}}{h^2}\n$$\n将这些相加得到五点模板的离散 Laplacian 算子 $(\\nabla^2_h \\psi)_{i,j}$：\n$$\n(\\nabla^2_h \\psi)_{i,j} = \\frac{\\psi_{i+1,j} + \\psi_{i-1,j} + \\psi_{i,j+1} + \\psi_{i,j-1} - 4\\psi_{i,j}}{h^2}\n$$\n因此，在任意内部点 $(i,j)$ 处的离散 Poisson 方程为：\n$$\n\\frac{\\psi_{i+1,j} + \\psi_{i-1,j} + \\psi_{i,j+1} + \\psi_{i,j-1} - 4\\psi_{i,j}}{h^2} = \\zeta_{i,j}\n$$\n\n### 2. 边界条件处理\n\n**Dirichlet 边界条件**：在所有边界上给定 $\\psi$ 的值。\n在这种情况下，对于 $i \\in \\{0, N-1\\}$ 或 $j \\in \\{0, N-1\\}$，$\\psi_{i,j}$ 的值是已知的。迭代求解器仅更新内部点，即 $i,j \\in \\{1, \\dots, N-2\\}$。当更新邻近边界的点（例如 $(1,j)$）时，模板中将使用已知的边界值 $\\psi_{0,j}$。\n\n**齐次 Neumann 边界条件**：在所有边界上 $\\frac{\\partial \\psi}{\\partial n} = 0$。\n此条件通过在域外引入“虚拟点”来处理。例如，在左边界（$x=0, i=0$）上，条件为 $\\frac{\\partial \\psi}{\\partial x}=0$。在 $i=0$ 处的二阶中心差分近似为 $\\frac{\\psi_{1,j} - \\psi_{-1,j}}{2h} = 0$，这意味着虚拟点的值为 $\\psi_{-1,j} = \\psi_{1,j}$。我们现在可以在边界点 $(0,j)$ 处写出离散 Laplacian 算子：\n$$\n(\\nabla^2_h \\psi)_{0,j} = \\frac{\\psi_{1,j} + \\psi_{-1,j} + \\psi_{0,j+1} + \\psi_{0,j-1} - 4\\psi_{0,j}}{h^2} = \\frac{2\\psi_{1,j} + \\psi_{0,j+1} + \\psi_{0,j-1} - 4\\psi_{0,j}}{h^2}\n$$\n这给了我们在边界点上需要求解的方程。其他三个边界和四个角点也可以推导出类似的模板。对于一个角点，例如 $(0,0)$，我们同时有 $\\frac{\\partial \\psi}{\\partial x}=0$ 和 $\\frac{\\partial \\psi}{\\partial y}=0$，这导致 $\\psi_{-1,0}=\\psi_{1,0}$ 和 $\\psi_{0,-1}=\\psi_{0,1}$。离散化方程变为：\n$$\n(\\nabla^2_h \\psi)_{0,0} = \\frac{2\\psi_{1,0} + 2\\psi_{0,1} - 4\\psi_0,0}{h^2} = \\zeta_{0,0}\n$$\nPoisson 方程的 Neumann 问题有解的充要条件是源项满足可解性条件。在域 $\\Omega$ 上对 $\\nabla^2\\psi = \\zeta$ 积分并应用散度定理：$\\iint_\\Omega \\zeta \\,dA = \\iint_\\Omega \\nabla \\cdot (\\nabla \\psi) \\,dA = \\oint_{\\partial\\Omega} \\nabla\\psi \\cdot \\mathbf{n} \\,ds = \\oint_{\\partial\\Omega} \\frac{\\partial\\psi}{\\partial n} \\,ds$。对于齐次 Neumann 条件，这要求 $\\iint_\\Omega \\zeta \\,dA = 0$。测试用例中的制造解满足此积分约束。\n此外，如果 $\\psi$ 是一个解，那么对于任意常数 $C$，$\\psi+C$ 也是解。这种非唯一性通过施加一个规范来解决。按照规定，我们通过在每次迭代中减去 $\\psi$ 的网格均值来强制解的均值为零：$\\psi_{i,j} \\leftarrow \\psi_{i,j} - \\frac{1}{N^2}\\sum_{k,l} \\psi_{k,l}$。\n\n### 3. 迭代求解器：逐次超松弛法 (SOR)\n\n一个合适的点松弛法是逐次超松弛法 (Successive Over-Relaxation, SOR)。该方法根据邻近点和松弛参数 $\\omega$ 来更新点 $\\psi_{i,j}$。首先，我们重排离散 Poisson 方程，用邻近点来表示 $\\psi_{i,j}$。对于一个内部点：\n$$\n\\psi_{i,j} = \\frac{1}{4}(\\psi_{i+1,j} + \\psi_{i-1,j} + \\psi_{i,j+1} + \\psi_{i,j-1} - h^2 \\zeta_{i,j})\n$$\n在顺序扫描中使用最新的 $\\psi$ 值计算右侧项，定义了 Gauss-Seidel 更新，即 $\\psi_{i,j}^{\\text{GS}}$。SOR 方法通过对该更新进行“超松弛”，将当前值 $\\psi_{i,j}^{(k)}$ 修改为新值 $\\psi_{i,j}^{(k+1)}$：\n$$\n\\psi_{i,j}^{(k+1)} = (1-\\omega)\\psi_{i,j}^{(k)} + \\omega \\psi_{i,j}^{\\text{GS}}\n$$\n其中 $k$ 是迭代指数，$\\omega$ 是松弛参数。为保证收敛，$0  \\omega  2$。当 $\\omega > 1$ 时，该方法是“超松弛”的，收敛会加速。对于方形网格上的此问题，最优的 $\\omega$ 近似为 $\\omega_{\\text{opt}} \\approx \\frac{2}{1 + \\sin(\\pi h)} = \\frac{2}{1 + \\sin(\\pi/(N-1))}$。\n\n当离散系统求解达到期望精度时，迭代终止。这通过残差的范数来衡量，$r_{i,j} = (\\nabla^2_h \\psi)_{i,j} - \\zeta_{i,j}$。当残差的最大范数 $\\|r\\|_\\infty = \\max_{i,j} |r_{i,j}|$ 低于指定的容差 $\\epsilon$ 或达到最大迭代次数时，迭代停止。\n\n**扩展性与替代方法**：SOR 收敛到固定容差所需的迭代次数与 $O(N)$ 成比例。由于每次迭代涉及 $O(N^2)$ 次操作，总计算成本增长为 $O(N^3)$。对于非常大的 $N$，这变得不切实际。更高效的现代方法包括：\n- **共轭梯度法 (Conjugate Gradient, CG)**：一种用于求解线性系统 $A\\mathbf{x}=\\mathbf{b}$ 的算法，其中 $A$ 是对称正定矩阵。它通常比 SOR 收敛得快得多。预处理共轭梯度法 (Preconditioned CG, PCG) 可以进一步提高性能。\n- **多重网格法**：这些方法在一系列层次化的网格上操作，利用较粗的网格来有效消除低频误差分量。它们是最高效的求解器之一，计算复杂度为 $O(N^2)$，这是最优的。\n- **快速傅里叶变换 (FFT) 求解器**：对于矩形域和某些边界条件，离散 Poisson 方程可以在傅里叶空间中对角化，从而可以用 $O(N^2 \\log N)$ 的复杂度进行非常快速的求解。\n\n### 4. 使用制造解法进行验证\n\n求解器通过制造解法进行验证。选择一个精确解 $\\psi_{\\text{exact}}$，并从中导出相应的强迫项 $\\zeta_{\\text{exact}} = \\nabla^2 \\psi_{\\text{exact}}$ 和边界条件。然后在此设置下运行数值求解器，并将其输出 $\\psi_{\\text{num}}$ 与 $\\psi_{\\text{exact}}$ 进行比较。最大绝对逐点误差 $\\max_{i,j} |\\psi_{\\text{num}}(x_i,y_j) - \\psi_{\\text{exact}}(x_i,y_j)|$ 量化了实现的准确性。所提供的测试套件涵盖了不同网格尺寸下的 Dirichlet 和 Neumann 边界条件，详见问题陈述。实现遵循上述原则。",
            "answer": "```python\nimport numpy as np\n\ndef solve_poisson(N, bc_type, psi_exact_func, zeta_func, tol=1e-9, max_iter=30000):\n    \"\"\"\n    Solves the Poisson equationnabla^2 psi = zeta on a unit square.\n    \"\"\"\n    h = 1.0 / (N - 1)\n    hsq = h * h\n\n    # Grid and exact solutions\n    x = np.linspace(0, 1, N)\n    y = np.linspace(0, 1, N)\n    xx, yy = np.meshgrid(x, y, indexing='ij')\n\n    psi_exact = psi_exact_func(xx, yy)\n    zeta = zeta_func(xx, yy)\n\n    # Initial guess for psi\n    psi = np.zeros((N, N), dtype=float)\n\n    # Set Dirichlet boundary conditions on the initial guess\n    if bc_type == 'dirichlet':\n        psi[0, :] = psi_exact[0, :]\n        psi[N-1, :] = psi_exact[N-1, :]\n        psi[:, 0] = psi_exact[:, 0]\n        psi[:, N-1] = psi_exact[:, N-1]\n\n    # Optimal relaxation parameter for SOR\n    omega = 2.0 / (1.0 + np.sin(np.pi * h))\n\n    # SOR Iteration\n    for k in range(max_iter):\n        if bc_type == 'dirichlet':\n            # Update only interior points\n            for i in range(1, N - 1):\n                for j in range(1, N - 1):\n                    neighbors_sum = psi[i-1, j] + psi[i+1, j] + psi[i, j-1] + psi[i, j+1]\n                    gs_target = 0.25 * (neighbors_sum - hsq * zeta[i, j])\n                    psi[i, j] = (1 - omega) * psi[i, j] + omega * gs_target\n        \n        elif bc_type == 'neumann':\n            # Update all points with appropriate stencils\n            for i in range(N):\n                for j in range(N):\n                    # Interior\n                    if 0  i  N - 1 and 0  j  N - 1:\n                        neighbors_sum = psi[i-1, j] + psi[i+1, j] + psi[i, j-1] + psi[i, j+1]\n                    # Edges\n                    elif i == 0 and 0  j  N - 1: # Left\n                        neighbors_sum = 2 * psi[i+1, j] + psi[i, j-1] + psi[i, j+1]\n                    elif i == N - 1 and 0  j  N - 1: # Right\n                        neighbors_sum = 2 * psi[i-1, j] + psi[i, j-1] + psi[i, j+1]\n                    elif 0  i  N - 1 and j == 0: # Bottom\n                        neighbors_sum = psi[i-1, j] + psi[i+1, j] + 2 * psi[i, j+1]\n                    elif 0  i  N - 1 and j == N - 1: # Top\n                        neighbors_sum = psi[i-1, j] + psi[i+1, j] + 2 * psi[i, j-1]\n                    # Corners\n                    elif i == 0 and j == 0: # Bottom-left\n                        neighbors_sum = 2 * psi[i+1, j] + 2 * psi[i, j+1]\n                    elif i == N - 1 and j == 0: # Bottom-right\n                        neighbors_sum = 2 * psi[i-1, j] + 2 * psi[i, j+1]\n                    elif i == 0 and j == N - 1: # Top-left\n                        neighbors_sum = 2 * psi[i+1, j] + 2 * psi[i, j-1]\n                    elif i == N - 1 and j == N - 1: # Top-right\n                        neighbors_sum = 2 * psi[i-1, j] + 2 * psi[i, j-1]\n\n                    gs_target = 0.25 * (neighbors_sum - hsq * zeta[i, j])\n                    psi[i, j] = (1 - omega) * psi[i, j] + omega * gs_target\n            \n            # Apply zero-mean gauge\n            psi -= np.mean(psi)\n\n        # Check for convergence based on residual (every 25 iterations to save time)\n        if k % 25 == 0:\n            residual = np.zeros_like(psi)\n            # Dirichlet residual is on interior points\n            if bc_type == 'dirichlet':\n                lap_psi = (psi[:-2, 1:-1] + psi[2:, 1:-1] + psi[1:-1, :-2] + psi[1:-1, 2:] - 4*psi[1:-1, 1:-1]) / hsq\n                residual[1:-1,1:-1] = lap_psi - zeta[1:-1,1:-1]\n                max_res = np.max(np.abs(residual[1:-1,1:-1]))\n            # Neumann residual is on all points\n            else:\n                for i in range(N):\n                    for j in range(N):\n                        if 0  i  N - 1 and 0  j  N - 1:\n                            lap_psi_ij = (psi[i-1,j] + psi[i+1,j] + psi[i,j-1] + psi[i,j+1] - 4*psi[i,j]) / hsq\n                        elif i == 0 and 0  j  N - 1:\n                            lap_psi_ij = (2*psi[i+1,j] + psi[i,j-1] + psi[i,j+1] - 4*psi[i,j]) / hsq\n                        elif i == N - 1 and 0  j  N - 1:\n                            lap_psi_ij = (2*psi[i-1,j] + psi[i,j-1] + psi[i,j+1] - 4*psi[i,j]) / hsq\n                        elif 0  i  N - 1 and j == 0:\n                            lap_psi_ij = (psi[i-1,j] + psi[i+1,j] + 2*psi[i,j+1] - 4*psi[i,j]) / hsq\n                        elif 0  i  N - 1 and j == N - 1:\n                            lap_psi_ij = (psi[i-1,j] + psi[i+1,j] + 2*psi[i,j-1] - 4*psi[i,j]) / hsq\n                        elif i == 0 and j == 0:\n                            lap_psi_ij = (2*psi[i+1,j] + 2*psi[i,j+1] - 4*psi[i,j]) / hsq\n                        elif i == N - 1 and j == 0:\n                            lap_psi_ij = (2*psi[i-1,j] + 2*psi[i,j+1] - 4*psi[i,j]) / hsq\n                        elif i == 0 and j == N - 1:\n                            lap_psi_ij = (2*psi[i+1,j] + 2*psi[i,j-1] - 4*psi[i,j]) / hsq\n                        elif i == N - 1 and j == N - 1:\n                            lap_psi_ij = (2*psi[i-1,j] + 2*psi[i,j-1] - 4*psi[i,j]) / hsq\n                        residual[i,j] = lap_psi_ij - zeta[i,j]\n                max_res = np.max(np.abs(residual))\n            \n            if max_res  tol:\n                break\n    \n    # Final error calculation\n    error = np.max(np.abs(psi - psi_exact))\n    return error\n\n\ndef solve():\n    # Case definitions\n    psi_A_C = lambda x, y: np.sin(2 * np.pi * x) * np.sin(3 * np.pi * y)\n    zeta_A_C = lambda x, y: -( (2*np.pi)**2 + (3*np.pi)**2 ) * np.sin(2 * np.pi * x) * np.sin(3 * np.pi * y)\n    \n    psi_B_D = lambda x, y: np.cos(2 * np.pi * x) + np.cos(2 * np.pi * y)\n    zeta_B_D = lambda x, y: -(2 * np.pi)**2 * (np.cos(2 * np.pi * x) + np.cos(2 * np.pi * y))\n\n    test_cases = [\n        # (N, bc_type, psi_exact_func, zeta_func)\n        (33, 'dirichlet', psi_A_C, zeta_A_C),  # Case A\n        (33, 'neumann',   psi_B_D, zeta_B_D),  # Case B\n        (5,  'dirichlet', psi_A_C, zeta_A_C),  # Case C\n        (49, 'neumann',   psi_B_D, zeta_B_D),  # Case D\n    ]\n\n    results = []\n    for N, bc_type, psi_func, zeta_func in test_cases:\n        error = solve_poisson(N, bc_type, psi_func, zeta_func)\n        results.append(error)\n\n    # Format output\n    formatted_results = [f\"{r:.5e}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "除了有限差分法，谱方法为求解偏微分方程提供了另一种强大且通常精度极高的途径，尤其适用于具有简单几何形状和光滑解的问题。在本次实践中 ，您将通过使用问题自身的特征函数（即双正弦级数）作为基底来求解流函数泊松方程，从而探索这种优雅的求解方式。这将涉及推导解的模态表示，并用数值方法计算展开系数，从而加深您对物理过程和数值技术的理解。",
            "id": "3813669",
            "problem": "您需要在一个矩形盆地中，使用双重正弦级数，实现并验证诊断性正压流函数的谱解。从 beta 平面上带有线性底拖曳和风应力旋度强迫的正压涡度方程出发，然后论证在稳定、线性、高摩擦和小 beta 条件下，该问题可以简化为流函数的诊断性 Poisson 问题。设无量纲化方程为\n$$\n\\nabla^2 \\psi(x,y) = F(x,y),\n$$\n该方程定义在矩形 $0  x  L_x$，$0  y  L_y$ 上，并具有齐次 Dirichlet 边界条件\n$$\n\\psi(0,y)=\\psi(L_x,y)=\\psi(x,0)=\\psi(x,L_y)=0.\n$$\n所有三角函数均使用弧度。所有量均为无量纲。\n\n您的任务是：\n- 从分离变量法和正交性的第一性原理出发，推导出满足所述边界条件的双重正弦特征函数展开式。\n- 推导连接 $\\psi$ 和 $F$ 展开系数的模态方程，包括来自矩形上正交性的正确归一化常数。\n- 实现一个程序，对于给定的强迫场 $F(x,y)$ 和整数 $(m,n)$，计算 $\\psi$ 在双重正弦级数中的模态振幅 $A_{mn}$。级数表示必须具有以下形式\n$$\n\\psi(x,y) = \\sum_{m=1}^{\\infty} \\sum_{n=1}^{\\infty} A_{mn} \\sin\\!\\left(\\frac{m\\pi x}{L_x}\\right)\\sin\\!\\left(\\frac{n\\pi y}{L_y}\\right),\n$$\n并伴有 $F(x,y)$ 在相同基上的相应投影。该程序应：\n  - 使用二维 Gauss–Legendre 求积法在 $[0,L_x]\\times[0,L_y]$ 上数值计算 $F_{mn}$ 的投影积分，\n  - 使用推导出的模态关系计算 $A_{mn}$，\n  - 针对指定的测试输入返回 $A_{mn}$。\n\n请使用以下测试套件。每个测试用例指定 $(L_x,L_y)$、一个构造为双重正弦有限和的强迫，以及您必须为其计算 $A_{mn}$ 的目标模态 $(m,n)$。在每个强迫定义中，记号 $\\sin\\!\\left(\\frac{p\\pi x}{L_x}\\right)\\sin\\!\\left(\\frac{q\\pi y}{L_y}\\right)$ 缩写为具有单位振幅的数对 $(p,q)$。所有三角函数参数均以弧度为单位。\n\n- 测试 1（正常路径，匹配单模态）：$L_x=1$，$L_y=1$，强迫 $F=\\{(1,1)\\}$，目标模态 $(m,n)=(1,1)$。\n- 测试 2（更高波数）：$L_x=1$，$L_y=1$，强迫 $F=\\{(2,3)\\}$，目标模态 $(2,3)$。\n- 测试 3（正交性零情况）：$L_x=1$，$L_y=1$，强迫 $F=\\{(2,3)\\}$，目标模态 $(1,1)$。\n- 测试 4（各向异性域）：$L_x=2$，$L_y=1$，强迫 $F=\\{(1,2)\\}$，目标模态 $(1,2)$。\n- 测试 5（双模态之和，单目标）：$L_x=1$，$L_y=1$，强迫 $F=\\{(1,2),(3,1)\\}$，目标模态 $(1,2)$。\n\n您的程序必须计算与上述五个测试用例对应的结果列表 $[A_{mn}^{(1)},A_{mn}^{(2)},A_{mn}^{(3)},A_{mn}^{(4)},A_{mn}^{(5)}]$，并生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表，例如\n\"[r1,r2,r3,r4,r5]\"。\n每个条目必须是四舍五入到 $12$ 位小数的浮点数。\n\n您的答案必须是一个完整的、可运行的程序，无需用户输入即可执行这些计算。",
            "solution": "用户提供的问题已经过分析，并被确定为**有效**。这是一个适定且有科学依据的计算海洋学领域问题，不存在问题验证规则中列出的任何使其无效的缺陷。该问题是自洽的，提供了确定唯一解所需的所有必要数据、方程和条件。\n\n### 1. 理论框架与推导\n\n该问题要求解高摩擦状态下无量纲化、稳态、线性的正压涡度方程，该方程可简化为流函数 $\\psi(x,y)$ 的 Poisson 方程：\n$$\n\\nabla^2 \\psi(x,y) = F(x,y)\n$$\n该方程定义在矩形域 $D = \\{ (x,y) \\,|\\, 0  x  L_x, \\, 0  y  L_y \\}$ 上，具有齐次 Dirichlet 边界条件，对应于盆地固壁处的无垂直流：\n$$\n\\psi(0,y) = \\psi(L_x,y) = \\psi(x,0) = \\psi(x,L_y) = 0\n$$\n\n解是使用特征函数展开构建的，这是求解线性偏微分方程的标准技术。基函数是满足给定边界条件的拉普拉斯算子 $\\nabla^2$ 的特征函数。\n\n#### 1.1. 通过分离变量法进行特征函数展开\n\n我们寻求特征值问题 $\\nabla^2 \\phi(x,y) = -\\lambda \\phi(x,y)$ 在相同齐次 Dirichlet 边界条件下的解。假设可分离解的形式为 $\\phi(x,y) = X(x)Y(y)$，方程变为：\n$$\n\\frac{X''(x)}{X(x)} + \\frac{Y''(y)}{Y(y)} = -\\lambda\n$$\n由于左侧的项是独立变量的函数，它们必须等于常数。我们设 $\\frac{X''(x)}{X(x)} = -k_x^2$ 和 $\\frac{Y''(y)}{Y(y)} = -k_y^2$，得到 $\\lambda = k_x^2 + k_y^2$。\n\n$\\psi$ 上的边界条件转化为 $X(0)=X(L_x)=0$ 和 $Y(0)=Y(L_y)=0$。具有这些边界条件的 Sturm-Liouville 问题 $X''(x) + k_x^2 X(x) = 0$ 的解为 $x$ 方向的特征值和特征函数：\n$$\nk_{x,m} = \\frac{m\\pi}{L_x}, \\quad X_m(x) = \\sin\\left(\\frac{m\\pi x}{L_x}\\right), \\quad m = 1, 2, 3, \\dots\n$$\n类似地，对于 $y$ 方向：\n$$\nk_{y,n} = \\frac{n\\pi}{L_y}, \\quad Y_n(y) = \\sin\\left(\\frac{n\\pi y}{L_y}\\right), \\quad n = 1, 2, 3, \\dots\n$$\n矩形上二维拉普拉斯算子的特征函数是这些一维解的乘积：\n$$\n\\phi_{mn}(x,y) = \\sin\\left(\\frac{m\\pi x}{L_x}\\right)\\sin\\left(\\frac{n\\pi y}{L_y}\\right)\n$$\n对应的特征值 $\\lambda_{mn}$ 为：\n$$\n\\lambda_{mn} = k_{x,m}^2 + k_{y,n}^2 = \\pi^2 \\left( \\frac{m^2}{L_x^2} + \\frac{n^2}{L_y^2} \\right)\n$$\n将拉普拉斯算子应用于特征函数可得 $\\nabla^2 \\phi_{mn} = -\\lambda_{mn} \\phi_{mn}$。这些特征函数为在域 $D$ 上且在边界处为零的函数构成了一个完备的正交基。\n\n#### 1.2. 振幅的模态方程\n\n我们在此基中展开解 $\\psi$ 和强迫 $F$：\n$$\n\\psi(x,y) = \\sum_{m=1}^{\\infty} \\sum_{n=1}^{\\infty} A_{mn} \\phi_{mn}(x,y)\n$$\n$$\nF(x,y) = \\sum_{m=1}^{\\infty} \\sum_{n=1}^{\\infty} F_{mn} \\phi_{mn}(x,y)\n$$\n将这些级数代入 Poisson 方程 $\\nabla^2 \\psi = F$：\n$$\n\\nabla^2 \\left( \\sum_{m,n} A_{mn} \\phi_{mn}(x,y) \\right) = \\sum_{m,n} F_{mn} \\phi_{mn}(x,y)\n$$\n利用线性和特征值性质 $\\nabla^2 \\phi_{mn} = -\\lambda_{mn} \\phi_{mn}$：\n$$\n\\sum_{m,n} A_{mn} (-\\lambda_{mn} \\phi_{mn}(x,y)) = \\sum_{m,n} F_{mn} \\phi_{mn}(x,y)\n$$\n根据正交性，每个基函数的系数必须相等：\n$$\n-\\lambda_{mn} A_{mn} = F_{mn} \\quad \\implies \\quad A_{mn} = -\\frac{F_{mn}}{\\lambda_{mn}}\n$$\n\n为了求出强迫系数 $F_{mn}$，我们使用内积 $\\langle f,g \\rangle = \\int_0^{L_y} \\int_0^{L_x} f(x,y)g(x,y) \\,dx\\,dy$ 将 $F(x,y)$ 投影到基函数 $\\phi_{mn}(x,y)$ 上。\n$$\n\\langle F, \\phi_{mn} \\rangle = \\left\\langle \\sum_{p,q} F_{pq} \\phi_{pq}, \\phi_{mn} \\right\\rangle = \\sum_{p,q} F_{pq} \\langle \\phi_{pq}, \\phi_{mn} \\rangle\n$$\n正交性积分为：\n$$\n\\langle \\phi_{pq}, \\phi_{mn} \\rangle = \\int_0^{L_x} \\sin\\left(\\frac{p\\pi x}{L_x}\\right)\\sin\\left(\\frac{m\\pi x}{L_x}\\right) \\,dx \\int_0^{L_y} \\sin\\left(\\frac{q\\pi y}{L_y}\\right)\\sin\\left(\\frac{n\\pi y}{L_y}\\right) \\,dy\n$$\n使用对于整数 $k \\ge 1$ 的恒等式 $\\int_0^L \\sin^2\\left(\\frac{k\\pi z}{L}\\right)dz = L/2$，该积分的计算结果为 $(\\frac{L_x}{2}\\delta_{pm})(\\frac{L_y}{2}\\delta_{qn})$，其中 $\\delta_{ij}$ 是 Kronecker delta。因此：\n$$\n\\int_0^{L_y} \\int_0^{L_x} F(x,y) \\phi_{mn}(x,y) \\,dx\\,dy = F_{mn} \\frac{L_x L_y}{4}\n$$\n求解 $F_{mn}$：\n$$\nF_{mn} = \\frac{4}{L_x L_y} \\int_0^{L_y} \\int_0^{L_x} F(x,y) \\sin\\left(\\frac{m\\pi x}{L_x}\\right)\\sin\\left(\\frac{n\\pi y}{L_y}\\right) \\,dx\\,dy\n$$\n结合这些结果，得到流函数模态振幅 $A_{mn}$ 的最终表达式：\n$$\nA_{mn} = -\\frac{1}{\\lambda_{mn}} F_{mn} = -\\frac{\\frac{4}{L_x L_y} \\int_0^{L_y} \\int_0^{L_x} F(x,y) \\phi_{mn}(x,y) \\,dx\\,dy}{\\pi^2 \\left( \\frac{m^2}{L_x^2} + \\frac{n^2}{L_y^2} \\right)}\n$$\n\n### 2. 数值实现\n\n核心计算任务是计算 $F_{mn}$ 的二维投影积分。问题指定使用二维 Gauss-Legendre 求积法。\n\n#### 2.1. Gauss-Legendre 求积法\n任意区间 $[a, b]$ 上的一维积分可以通过变换到标准区间 $[-1, 1]$ 来使用 Gauss-Legendre 求积法进行近似：\n$$\n\\int_a^b g(z) \\,dz = \\frac{b-a}{2} \\int_{-1}^1 g\\left(\\frac{b-a}{2}\\xi + \\frac{a+b}{2}\\right) \\,d\\xi \\approx \\frac{b-a}{2} \\sum_{i=1}^{N} w_i g\\left(\\frac{b-a}{2}\\xi_i + \\frac{a+b}{2}\\right)\n$$\n其中 $\\{\\xi_i, w_i\\}_{i=1}^N$ 是 $[-1, 1]$ 上的 $N$ 点求积节点和权重。\n\n对于 $[0, L_x] \\times [0, L_y]$ 上的二维积分，我们将此变换应用于每个维度。二重积分变为二重求和：\n$$\nI = \\int_0^{L_y} \\int_0^{L_x} g(x,y) \\,dx\\,dy \\approx \\frac{L_x L_y}{4} \\sum_{j=1}^{N_y} \\sum_{i=1}^{N_x} w_j w_i \\, g\\left(\\frac{L_x}{2}(\\xi_i+1), \\frac{L_y}{2}(\\eta_j+1)\\right)\n$$\n该方法将使用 `numpy.polynomial.legendre.leggauss` 来获取节点和权重。选择足够高的求积阶数（例如，$N_x=N_y=128$）以确保所涉及的光滑被积函数的高精度。\n\n#### 2.2. 算法步骤\n对于每个测试用例：\n1.  将强迫函数 $F(x,y)$ 定义为所提供的正弦模态之和。\n2.  定义投影的完整被积函数：$\\text{integrand}(x,y) = F(x,y) \\cdot \\phi_{mn}(x,y)$，其中 $(m,n)$ 是目标模态。\n3.  获取选定阶数 $N_{quad}$ 的 Gauss-Legendre 节点和权重。\n4.  将节点从 $[-1, 1]$ 映射到 $[0, L_x]$ 和 $[0, L_y]$。\n5.  在映射节点的二维网格上计算被积函数。\n6.  计算由相应权重乘积加权后的二重求和，并通过雅可比因子 $\\frac{L_x L_y}{4}$ 进行缩放，以求得积分值 $I_{mn}$。\n7.  计算强迫系数 $F_{mn} = \\frac{4}{L_x L_y} I_{mn}$。\n8.  计算特征值 $\\lambda_{mn} = \\pi^2 \\left( \\frac{m^2}{L_x^2} + \\frac{n^2}{L_y^2} \\right)$。\n9.  计算最终振幅 $A_{mn} = -F_{mn} / \\lambda_{mn}$。\n\n此数值程序可以按要求精确计算模态振幅。测试用例中，强迫由基特征函数组成，这为对照已知的解析结果（例如，对于正交模态，投影应为零；对于匹配模态，投影应与归一化常数相关）验证数值实现提供了绝佳机会。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the modal amplitude A_mn of the streamfunction psi for a given\n    forcing in the Poisson equation nabla^2(psi) = F on a rectangular domain\n    with homogeneous Dirichlet boundary conditions. The solution uses a\n    double sine series spectral method, with projection integrals evaluated\n    using 2D Gauss-Legendre quadrature.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is (Lx, Ly, list_of_forcing_modes, target_mode)\n    # A forcing mode (p,q) corresponds to sin(p*pi*x/Lx)*sin(q*pi*y/Ly).\n    test_cases = [\n        (1.0, 1.0, [(1, 1)], (1, 1)),\n        (1.0, 1.0, [(2, 3)], (2, 3)),\n        (1.0, 1.0, [(2, 3)], (1, 1)),\n        (2.0, 1.0, [(1, 2)], (1, 2)),\n        (1.0, 1.0, [(1, 2), (3, 1)], (1, 2)),\n    ]\n\n    results = []\n    # Use a sufficiently high order for the quadrature to ensure precision.\n    N_QUAD = 128\n\n    # Get Gauss-Legendre nodes and weights for the standard interval [-1, 1].\n    # These will be reused for all test cases.\n    nodes, weights = np.polynomial.legendre.leggauss(N_QUAD)\n\n    for Lx, Ly, forcing_modes, target_mode in test_cases:\n        m, n = target_mode\n\n        # 1. Define the forcing function F(x, y)\n        def F(x, y, lx_loc, ly_loc, f_modes):\n            res = 0.0\n            for p, q in f_modes:\n                res += np.sin(p * np.pi * x / lx_loc) * np.sin(q * np.pi * y / ly_loc)\n            return res\n\n        # 2. Define the full integrand for the projection integral\n        def integrand(x, y, lx_loc, ly_loc, f_modes, m_loc, n_loc):\n            forcing_val = F(x, y, lx_loc, ly_loc, f_modes)\n            basis_func_val = np.sin(m_loc * np.pi * x / lx_loc) * np.sin(n_loc * np.pi * y / ly_loc)\n            return forcing_val * basis_func_val\n\n        # 3. Perform 2D Gauss-Legendre Quadrature\n        # Map nodes from [-1, 1] to [0, Lx] and [0, Ly]\n        x_mapped = 0.5 * Lx * (nodes + 1.0)\n        y_mapped = 0.5 * Ly * (nodes + 1.0)\n\n        # Vectorized calculation: create a grid of points and weights\n        xx, yy = np.meshgrid(x_mapped, y_mapped)\n        wx, wy = np.meshgrid(weights, weights)\n\n        # Evaluate the integrand on the grid of quadrature points\n        integrand_values = integrand(xx, yy, Lx, Ly, forcing_modes, m, n)\n\n        # Compute the integral by summing weighted integrand values\n        # and scaling by the Jacobian of the transformation\n        integral_val = np.sum(wx * wy * integrand_values)\n        I_mn = integral_val * (Lx / 2.0) * (Ly / 2.0)\n\n        # 4. Calculate the forcing coefficient F_mn\n        # F_mn = (4 / (Lx * Ly)) * I_mn\n        # Note: A small Lx*Ly can cause floating point issues if not handled carefully.\n        # But for this problem, the domains are well-behaved.\n        if Lx * Ly > 0:\n            F_mn = (4.0 / (Lx * Ly)) * I_mn\n        else:\n            F_mn = 0.0\n\n        # 5. Calculate the eigenvalue lambda_mn\n        lambda_mn = (np.pi**2) * ((m / Lx)**2 + (n / Ly)**2)\n\n        # 6. Compute the final amplitude A_mn\n        # Handle the case where lambda_mn is zero (m=0, n=0), though m,n >= 1\n        # in this problem, so lambda_mn will always be positive.\n        if lambda_mn == 0:\n            A_mn = 0.0\n        else:\n            A_mn = -F_mn / lambda_mn\n        \n        results.append(A_mn)\n\n    # 7. Format the output to 12 decimal places as specified.\n    formatted_results = [f\"{r:.12f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}