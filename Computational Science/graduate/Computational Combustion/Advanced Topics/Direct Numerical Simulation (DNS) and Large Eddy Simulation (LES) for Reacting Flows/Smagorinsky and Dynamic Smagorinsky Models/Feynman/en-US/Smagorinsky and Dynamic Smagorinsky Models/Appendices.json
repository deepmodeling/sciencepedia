{
    "hands_on_practices": [
        {
            "introduction": "The Smagorinsky model's predictive power hinges on the value of its single coefficient, $C_s$. This first practice demystifies the origin of this constant by guiding you through an *a priori* analysis, a cornerstone of turbulence model development. By comparing the modeled subgrid-scale (SGS) stress against the exact stress derived from high-fidelity data, you will compute the optimal $C_s$ that minimizes the error, gaining hands-on experience with a fundamental validation technique .",
            "id": "4063988",
            "problem": "You are given the task of performing an a priori test, based on density-weighted (Favre) filtering, to determine the optimal Smagorinsky constant for Large Eddy Simulation (LES) modeling of a planar reacting shear layer. The goal is to derive and implement a program that, for a set of prescribed filter widths, computes the single scalar value of the dimensionless Smagorinsky coefficient that minimizes the mean-square error between the modeled and the exact deviatoric subgrid-scale (SGS) stress obtained from filtering a synthetic Direct Numerical Simulation (DNS)-like field.\n\nStart from the following base definitions and principles:\n- Consider a two-dimensional periodic domain with lengths $L_x$ and $L_y$, with spatial coordinates $x$ and $y$ and uniform grid spacing. All quantities are nondimensional.\n- Let $\\rho(x,y)$ denote the density, and let $u_i(x,y)$ denote the velocity components for $i \\in \\{x,y\\}$. Use density-weighted (Favre) filtering, defined for any field $\\phi$ by $\\tilde{\\phi} = \\overline{\\rho \\phi}/\\overline{\\rho}$, where the overbar denotes spatial filtering with a normalized isotropic Gaussian kernel in two dimensions. The two-dimensional Gaussian kernel must have standard deviation $\\sigma$, and the filter width $\\Delta$ used in modeling must be related to $\\sigma$ by $\\sigma = \\Delta/2$. The spatial filtering must be performed consistently with the periodic domain.\n- Define the exact Favre SGS stress tensor by $\\tau_{ij} = \\overline{\\rho u_i u_j}/\\overline{\\rho} - \\tilde{u}_i \\tilde{u}_j$. In two dimensions, define the deviatoric part by $\\tau_{ij}^{d} = \\tau_{ij} - \\frac{1}{2} \\tau_{kk} \\delta_{ij}$, where $\\delta_{ij}$ is the Kronecker delta and indices $i,j \\in \\{x,y\\}$.\n- Define the filtered strain-rate tensor by $S_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\tilde{u}_i}{\\partial x_j} + \\frac{\\partial \\tilde{u}_j}{\\partial x_i}\\right)$, and its magnitude by $|S| = \\sqrt{2 S_{ij} S_{ij}}$, with summation over repeated indices in two dimensions.\n- Invoke the Boussinesq eddy-viscosity hypothesis for compressible variable-density flow, stating that the deviatoric part of the Favre SGS stress is proportional to the filtered density, the eddy viscosity, and the strain-rate tensor. Assume the eddy viscosity is proportional to the square of the filter width and the strain-rate magnitude, with a single unknown dimensionless constant that must be identified by minimizing the mean-square error between modeled and exact deviatoric SGS stresses. Your program must derive and use this relation to set up and solve the scalar least-squares problem for that constant for each filter width.\n\nConstruct a synthetic DNS-like planar reacting shear layer with the following specifications to make the test self-contained and scientifically plausible:\n- Domain: $L_x = 2\\pi$, $L_y = 2\\pi$, with periodic boundary conditions in both directions. Use a uniform grid with $N_x = 128$, $N_y = 128$.\n- The shear layer is centered at $y_0 = L_y/2$. Define a base streamwise velocity component $u(x,y)$ by $u(x,y) = U\\, \\tanh\\!\\left(\\frac{y - y_0}{\\theta}\\right) + A_u \\sin(k_x x)\\, \\mathrm{sech}\\!\\left(\\frac{y - y_0}{\\theta_p}\\right)$, and the cross-stream velocity component $v(x,y)$ by $v(x,y) = A_v \\cos(k_x x)\\, \\mathrm{sech}\\!\\left(\\frac{y - y_0}{\\theta_v}\\right)$, where $\\mathrm{sech}(\\cdot)$ is the hyperbolic secant. Use parameters $U = 1$, $\\theta = L_y/20$, $\\theta_p = L_y/18$, $\\theta_v = L_y/16$, $A_u = 0.15$, $A_v = 0.10$, and $k_x = 4$.\n- The density field accounts for stream-to-stream asymmetry and heat release. Define a mixed density profile $\\rho_{\\mathrm{mix}}(y) = \\frac{1}{2}(\\rho_1 + \\rho_2) + \\frac{1}{2}(\\rho_2 - \\rho_1)\\, \\tanh\\!\\left(\\frac{y - y_0}{\\theta_\\rho}\\right)$ with $\\rho_1 = 1.0$, $\\rho_2 = 2.0$, and $\\theta_\\rho = L_y/22$. Define a reaction progress variable $c(x,y) = \\exp\\!\\left(-\\frac{(y - y_0)^2}{w^2}\\right)\\, \\left[\\frac{1}{2} + \\frac{1}{2}\\sin(k_x x)\\right]$, with $w = L_y/30$. The final density is $\\rho(x,y) = \\rho_{\\mathrm{mix}}(y) \\left[1 - \\beta\\, c(x,y)\\right]$, with $\\beta = 0.3$. This yields lower density in regions of higher reaction progress, consistent with heat release.\n\nYour program must:\n1. Implement two-dimensional periodic Gaussian filtering for any field by means of a Fourier-space filter with multiplier $\\exp\\!\\left(-\\frac{1}{2}\\sigma^2(k_x^2+k_y^2)\\right)$, where $k_x$ and $k_y$ are the wavenumbers consistent with the periodic domain.\n2. Compute $\\overline{\\rho}$, $\\tilde{u}_i$, and $\\overline{\\rho u_i u_j}$ via density-weighted filtering using the Gaussian kernel defined by the test case filter width $\\Delta$.\n3. Form the exact deviatoric SGS stress $\\tau_{ij}^{d}$ in two dimensions.\n4. Compute the filtered strain-rate tensor $S_{ij}$ and its magnitude $|S|$ from the Favre-filtered velocity, using spectral differentiation consistent with the periodic domain.\n5. Set up the mean-square error minimization between the model deviatoric stress based on the Boussinesq eddy viscosity with unknown dimensionless constant and the exact deviatoric stress $\\tau_{ij}^{d}$, and solve the scalar least-squares problem to obtain the optimal constant. Finally, compute the corresponding Smagorinsky coefficient.\n6. For numerical robustness, if the least-squares denominator is below $10^{-12}$, return $0$ for that test case.\n\nTest Suite:\n- Use the following four filter widths, expressed as multiples of the grid spacing in the $x$ direction, $\\Delta = \\alpha\\, \\Delta_x$, where $\\Delta_x = L_x / N_x$ and $\\alpha \\in \\{2.0, 4.0, 8.0, 16.0\\}$.\n\nOutput specification:\n- For each test case, the result is a single floating-point number representing the optimal Smagorinsky coefficient, which is dimensionless.\n- Your program should produce a single line of output containing the four results as a comma-separated list enclosed in square brackets (e.g., \"[c1,c2,c3,c4]\"). Express the results as Python float string representations.",
            "solution": "The problem requires the determination of an optimal Smagorinsky constant, $C_s$, for a Large Eddy Simulation (LES) of a variable-density reacting shear layer. This is achieved through an *a priori* test, which involves generating a synthetic Direct Numerical Simulation (DNS)-like data field, explicitly filtering this field to a coarser resolution, and then finding the value of $C_s$ that minimizes the mean-square error between the exact and modeled subgrid-scale (SGS) stresses. The analysis is based on density-weighted (Favre) filtering.\n\nFirst, we establish the theoretical framework. The Favre-filtered value of a quantity $\\phi$ is defined as $\\tilde{\\phi} = \\overline{\\rho \\phi} / \\overline{\\rho}$, where $\\rho$ is the density and the overbar denotes a spatial filtering operation. The exact Favre-filtered SGS stress tensor, $\\tau_{ij}$, which represents the effect of the unresolved scales on the resolved-scale momentum transport, is given by\n$$ \\tau_{ij} = \\widetilde{u_i u_j} - \\tilde{u}_i \\tilde{u}_j = \\frac{\\overline{\\rho u_i u_j}}{\\overline{\\rho}} - \\tilde{u}_i \\tilde{u}_j $$\nwhere $u_i$ are the velocity components. Since the Smagorinsky model is a model for the anisotropic part of the stress tensor, we work with the deviatoric (trace-free) part of $\\tau_{ij}$. In two dimensions ($i,j \\in \\{x,y\\}$), this is defined as\n$$ \\tau_{ij}^{d} = \\tau_{ij} - \\frac{1}{2} \\tau_{kk} \\delta_{ij} $$\nwhere $\\delta_{ij}$ is the Kronecker delta and summation is implied over the repeated index $k$.\n\nThe Smagorinsky model for the deviatoric SGS stress is based on the Boussinesq eddy-viscosity hypothesis. For a compressible, variable-density flow, this hypothesis relates the deviatoric stress to the deviatoric part of the Favre-filtered strain-rate tensor, $S_{ij}^d$:\n$$ \\tau_{ij}^{d, \\text{mod}} = -2 \\overline{\\rho} \\nu_t S_{ij}^d $$\nThe Favre-filtered strain-rate tensor is $S_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\tilde{u}_i}{\\partial x_j} + \\frac{\\partial \\tilde{u}_j}{\\partial x_i}\\right)$, and its deviatoric part in two dimensions is $S_{ij}^d = S_{ij} - \\frac{1}{2} S_{kk} \\delta_{ij}$. The eddy viscosity, $\\nu_t$, is modeled by the Smagorinsky closure as\n$$ \\nu_t = (C_s \\Delta)^2 |S| $$\nwhere $C_s$ is the dimensionless Smagorinsky constant, $\\Delta$ is the filter width, and $|S|$ is the magnitude of the strain-rate tensor, defined as $|S| = \\sqrt{2 S_{ij} S_{ij}}$. Combining these expressions, the modeled deviatoric SGS stress is\n$$ \\tau_{ij}^{d, \\text{mod}} = -2 (C_s \\Delta)^2 \\overline{\\rho} |S| S_{ij}^d $$\nThe problem is to find the single scalar value of $C_s$ that best fits the exact stress $\\tau_{ij}^d$ calculated from the DNS data. This is a scalar least-squares problem. We seek to minimize the spatially-averaged mean-square error, $E$:\n$$ E(C_s) = \\left\\langle \\left( \\tau_{ij}^d - \\tau_{ij}^{d, \\text{mod}} \\right)^2 \\right\\rangle $$\nwhere $\\langle \\cdot \\rangle$ denotes a spatial average over the domain, and summation over indices $i,j$ is implied. Let us define the parameter to be found as $K = C_s^2$ and the model basis tensor as $M_{ij} = -2 \\Delta^2 \\overline{\\rho} |S| S_{ij}^d$. The model is then $\\tau_{ij}^{d, \\text{mod}} = K M_{ij}$, and the error functional becomes\n$$ E(K) = \\left\\langle (\\tau_{ij}^d - K M_{ij})(\\tau_{ij}^d - K M_{ij}) \\right\\rangle = \\left\\langle (\\tau_{ij}^d)^2 - 2K \\tau_{ij}^d M_{ij} + K^2 (M_{ij})^2 \\right\\rangle $$\nTo find the minimum, we differentiate with respect to $K$ and set the result to zero:\n$$ \\frac{dE}{dK} = \\left\\langle -2 \\tau_{ij}^d M_{ij} + 2K (M_{ij})^2 \\right\\rangle = 0 $$\nSolving for $K$ yields the optimal value:\n$$ K_{\\text{opt}} = C_s^2 = \\frac{\\left\\langle \\tau_{ij}^d M_{ij} \\right\\rangle}{\\left\\langle M_{ij} M_{ij} \\right\\rangle} $$\nThe spatial average $\\langle \\cdot \\rangle$ corresponds to summing over all grid points. Substituting the expression for $M_{ij}$:\n$$ C_s^2 = \\frac{\\left\\langle \\tau_{ij}^d (-2 \\Delta^2 \\overline{\\rho} |S| S_{ij}^d) \\right\\rangle}{\\left\\langle (-2 \\Delta^2 \\overline{\\rho} |S| S_{ij}^d)^2 \\right\\rangle} = \\frac{-\\left\\langle \\overline{\\rho} |S| (\\tau_{ij}^d S_{ij}^d) \\right\\rangle}{2\\Delta^2 \\left\\langle (\\overline{\\rho}|S|)^2 (S_{kl}^d S_{kl}^d) \\right\\rangle} $$\nFor a physically meaningful dissipative model, $C_s^2$ should be non-negative. If the calculation yields a negative value, it implies that the optimal real-valued $C_s$ is $0$, as this would minimize the error for non-negative $C_s^2$. Therefore, the final Smagorinsky constant is computed as $C_s = \\sqrt{\\max(0, C_s^2)}$.\n\nThe computational procedure is as follows:\n1.  **Grid and Field Generation**: A uniform grid of size $N_x \\times N_y = 128 \\times 128$ is created on the domain $[0, L_x] \\times [0, L_y]$ with $L_x = L_y = 2\\pi$. The synthetic DNS-like velocity fields $u_x(x,y)$, $u_y(x,y)$ and density field $\\rho(x,y)$ are computed at each grid point using the provided analytical expressions.\n2.  **Fourier-Space Operations**: Due to the periodic domain, both filtering and spatial differentiation are performed efficiently and accurately in Fourier space using the Fast Fourier Transform (FFT).\n    *   Wavenumber arrays $k_x$ and $k_y$ are constructed corresponding to the grid.\n    *   The spatial filtering operation $\\overline{\\phi}$ is performed by multiplying the 2D FFT of the field $\\phi$ by the Gaussian filter transfer function $G(k_x, k_y) = \\exp(-\\frac{1}{2}\\sigma^2(k_x^2+k_y^2))$, where $\\sigma = \\Delta/2$, and then performing an inverse FFT.\n    *   Spatial derivatives, e.g., $\\partial \\phi / \\partial x$, are computed by multiplying the FFT of $\\phi$ by $i k_x$ (where $i=\\sqrt{-1}$) and taking the inverse FFT.\n3.  **A Priori Analysis Loop**: For each specified filter width $\\Delta$:\n    a. The filter kernel standard deviation $\\sigma = \\Delta/2$ is calculated.\n    b. The necessary filtered quantities are computed: $\\overline{\\rho}$, $\\overline{\\rho u_x}$, $\\overline{\\rho u_y}$, $\\overline{\\rho u_x^2}$, $\\overline{\\rho u_y^2}$, and $\\overline{\\rho u_x u_y}$.\n    c. The Favre-filtered velocities $\\tilde{u}_x$ and $\\tilde{u}_y$ are determined.\n    d. The exact SGS stress tensor components $\\tau_{xx}, \\tau_{yy}, \\tau_{xy}$ are calculated, followed by their deviatoric counterparts $\\tau_{xx}^d, \\tau_{yy}^d, \\tau_{xy}^d$.\n    e. The Favre-filtered strain-rate tensor components $S_{xx}, S_{yy}, S_{xy}$ are computed using spectral differentiation of $\\tilde{u}_x, \\tilde{u}_y$.\n    f. The strain-rate magnitude $|S|$ and the deviatoric strain-rate tensor $S_{ij}^d$ are computed.\n    g. The numerator $\\mathcal{N} = \\sum_{\\text{grid}} \\tau_{ij}^d M_{ij}$ and denominator $\\mathcal{D} = \\sum_{\\text{grid}} M_{ij}^2$ of the expression for $C_s^2$ are calculated, where the sum is over all grid points and tensor components. A numerical tolerance of $10^{-12}$ is applied to the denominator.\n    h. The optimal $C_s^2 = \\mathcal{N}/\\mathcal{D}$ is calculated, and the final Smagorinsky constant is found as $C_s = \\sqrt{\\max(0, C_s^2)}$.\nThis procedure is repeated for each filter width in the test suite, yielding a set of optimal constants.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Performs an a priori test to determine the optimal Smagorinsky constant.\n    \"\"\"\n    # 1. Synthetic DNS Data Generation\n    # Domain and Grid\n    Lx, Ly = 2 * np.pi, 2 * np.pi\n    Nx, Ny = 128, 128\n    dx, dy = Lx / Nx, Ly / Ny\n\n    x = np.linspace(0, Lx, Nx, endpoint=False)\n    y = np.linspace(0, Ly, Ny, endpoint=False)\n    X, Y = np.meshgrid(x, y)\n\n    # Wavenumbers for spectral methods\n    kx_vec = 2 * np.pi * np.fft.fftfreq(Nx, d=dx)\n    ky_vec = 2 * np.pi * np.fft.fftfreq(Ny, d=dy)\n    Kx, Ky = np.meshgrid(kx_vec, ky_vec)\n    K2 = Kx**2 + Ky**2\n    \n    # Parameters for the synthetic fields\n    U = 1.0\n    y0 = Ly / 2.0\n    theta = Ly / 20.0\n    theta_p = Ly / 18.0\n    theta_v = Ly / 16.0\n    Au = 0.15\n    Av = 0.10\n    kx_pert = 4.0\n    \n    rho1, rho2 = 1.0, 2.0\n    theta_rho = Ly / 22.0\n    w = Ly / 30.0\n    beta = 0.3\n\n    # Velocity fields\n    u_x = U * np.tanh((Y - y0) / theta) + Au * np.sin(kx_pert * X) * (1.0 / np.cosh((Y - y0) / theta_p))\n    u_y = Av * np.cos(kx_pert * X) * (1.0 / np.cosh((Y - y0) / theta_v))\n\n    # Density field\n    rho_mix = 0.5 * (rho1 + rho2) + 0.5 * (rho2 - rho1) * np.tanh((Y - y0) / theta_rho)\n    c = np.exp(-((Y - y0)**2) / w**2) * (0.5 + 0.5 * np.sin(kx_pert * X))\n    rho = rho_mix * (1 - beta * c)\n\n    # Helper functions for spectral operations\n    def spectral_filter(phi, filter_kernel):\n        return np.fft.ifft2(np.fft.fft2(phi) * filter_kernel).real\n\n    def spectral_grad(phi_hat, K_component):\n        return np.fft.ifft2(1j * K_component * phi_hat).real\n\n    # Test suite\n    test_alphas = [2.0, 4.0, 8.0, 16.0]\n    results = []\n\n    for alpha in test_alphas:\n        # 2. Filtering\n        delta = alpha * dx\n        sigma = delta / 2.0\n        \n        # Gaussian filter in Fourier space\n        filter_kernel = np.exp(-0.5 * sigma**2 * K2)\n        \n        # Filtered quantities\n        rho_bar = spectral_filter(rho, filter_kernel)\n        \n        rho_ux_bar = spectral_filter(rho * u_x, filter_kernel)\n        rho_uy_bar = spectral_filter(rho * u_y, filter_kernel)\n        \n        rho_ux_ux_bar = spectral_filter(rho * u_x * u_x, filter_kernel)\n        rho_uy_uy_bar = spectral_filter(rho * u_y * u_y, filter_kernel)\n        rho_ux_uy_bar = spectral_filter(rho * u_x * u_y, filter_kernel)\n\n        # Favre-filtered velocities\n        u_tilde_x = rho_ux_bar / rho_bar\n        u_tilde_y = rho_uy_bar / rho_bar\n\n        # 3. Exact SGS Stress Calculation\n        tau_xx = rho_ux_ux_bar / rho_bar - u_tilde_x**2\n        tau_yy = rho_uy_uy_bar / rho_bar - u_tilde_y**2\n        tau_xy = rho_ux_uy_bar / rho_bar - u_tilde_x * u_tilde_y\n        \n        tau_kk = tau_xx + tau_yy\n        tau_d_xx = tau_xx - 0.5 * tau_kk\n        tau_d_yy = tau_yy - 0.5 * tau_kk\n        tau_d_xy = tau_xy\n        tau_d_yx = tau_xy\n\n        # 4. Modeled Stress Calculation Components\n        # FFT of Favre-filtered velocities\n        u_tilde_x_hat = np.fft.fft2(u_tilde_x)\n        u_tilde_y_hat = np.fft.fft2(u_tilde_y)\n        \n        # Strain-rate tensor S_ij\n        S_xx = spectral_grad(u_tilde_x_hat, Kx)\n        S_yy = spectral_grad(u_tilde_y_hat, Ky)\n        S_xy = 0.5 * (spectral_grad(u_tilde_x_hat, Ky) + spectral_grad(u_tilde_y_hat, Kx))\n        S_yx = S_xy\n        \n        # Strain-rate magnitude |S|\n        S_mag = np.sqrt(2 * (S_xx**2 + S_yy**2 + 2 * S_xy**2))\n        \n        # Deviatoric strain-rate tensor S_ij^d\n        S_kk = S_xx + S_yy\n        S_d_xx = S_xx - 0.5 * S_kk\n        S_d_yy = S_yy - 0.5 * S_kk\n        S_d_xy = S_xy\n        S_d_yx = S_xy\n\n        # 5. Least-Squares Minimization\n        # Model basis tensor M_ij\n        model_prefactor = -2.0 * delta**2 * rho_bar * S_mag\n        M_xx = model_prefactor * S_d_xx\n        M_yy = model_prefactor * S_d_yy\n        M_xy = model_prefactor * S_d_xy\n        M_yx = M_xy\n\n        # Numerator and denominator for C_s^2\n        numerator = np.sum(tau_d_xx * M_xx + tau_d_yy * M_yy + tau_d_xy * M_xy + tau_d_yx * M_yx)\n        denominator = np.sum(M_xx**2 + M_yy**2 + M_xy**2 + M_yx**2)\n        \n        # 6. Compute Cs\n        if denominator < 1e-12:\n            Cs2 = 0.0\n        else:\n            Cs2 = numerator / denominator\n        \n        Cs = np.sqrt(max(0.0, Cs2))\n        results.append(Cs)\n        \n    # Format and print output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "Moving from momentum to scalar transport, which is paramount in reacting flows, we now investigate how SGS models affect predictions of mixing and combustion. This exercise contrasts the simple constant turbulent Schmidt number assumption with a dynamic procedure that adapts to local flow conditions . You will calculate how these different modeling choices lead to different predictions for the scalar dissipation rate, $\\chi$, and flame extinction, revealing the direct impact of SGS modeling on capturing critical combustion physics.",
            "id": "4063980",
            "problem": "You are tasked to implement a numerical analysis comparing the effects of a constant turbulent Schmidt number and a dynamically computed turbulent Schmidt number on the scalar dissipation rate and extinction in opposed-jet flames with differential diffusion, within the Large-Eddy Simulation (LES) framework using the Smagorinsky closure. The evaluation must be performed at a local point using resolved gradients, filter widths, and Leonard terms for the scalar flux.\n\nFundamental base:\n- Start with the filtered transport of mixture fraction and the definition of scalar dissipation rate in terms of the effective diffusivity and the resolved gradient magnitude. The scalar dissipation rate is defined as $$\\chi = 2\\,D_{\\mathrm{eff}}\\,\\|\\nabla Z\\|^2$$, where $D_{\\mathrm{eff}} = D_{\\mathrm{m}} + D_{\\mathrm{t}}$, $D_{\\mathrm{m}}$ is the molecular diffusivity, $D_{\\mathrm{t}}$ is the subgrid-scale eddy diffusivity, and $\\nabla Z$ is the resolved mixture-fraction gradient vector. The units of $\\chi$ must be expressed in $\\mathrm{s}^{-1}$.\n- Model the subgrid eddy viscosity using the Smagorinsky model, with $$\\nu_{\\mathrm{t}} = \\left(C_{\\mathrm{s}}\\,\\Delta\\right)^2\\,\\|S\\|$$, where $C_{\\mathrm{s}}$ is the Smagorinsky constant, $\\Delta$ is the LES filter width, and $\\|S\\|$ is the magnitude of the resolved strain-rate tensor, computed from the resolved velocity gradient tensor $G$ by $S = \\left(G + G^{\\top}\\right)/2$ and $$\\|S\\| = \\sqrt{2\\,S_{ij}S_{ij}}$$.\n- For the constant turbulent Schmidt number case, take $$D_{\\mathrm{t,const}} = \\frac{\\nu_{\\mathrm{t}}}{Sc_{\\mathrm{t,const}}}$$.\n- For the dynamic turbulent Schmidt number case, use the dynamic scalar model based on the Germano identity for the subgrid scalar flux. The modeled subgrid flux is $q_i = -D_{\\mathrm{t}}\\,\\frac{\\partial Z}{\\partial x_i}$ with $D_{\\mathrm{t}} = C_{\\kappa}\\,\\Delta^2\\,\\|S\\|$. Under the test filter of width $\\tilde{\\Delta} = \\alpha\\,\\Delta$, the Leonard term $L_i$ and model consistency lead to $$L_i \\approx -\\,C_{\\kappa}\\,M_i$$, where $$M_i = \\left(\\alpha^2 - 1\\right)\\,\\Delta^2\\,\\|S\\|\\,\\frac{\\partial Z}{\\partial x_i}$$. Compute the dynamic scalar coefficient $$C_{\\kappa} = -\\frac{\\sum_i L_i M_i}{\\sum_i M_i^2}$$, and enforce non-negativity by setting $C_{\\kappa} = \\max\\left(C_{\\kappa},\\,0\\right)$ to avoid non-physical negative diffusivities. Then use $$D_{\\mathrm{t,dyn}} = C_{\\kappa}\\,\\Delta^2\\,\\|S\\|$$.\n- Model molecular diffusivity using a Lewis-number-based relation $$D_{\\mathrm{m}} = \\frac{D_{\\mathrm{ref}}}{Le}$$, where $D_{\\mathrm{ref}}$ is a reference molecular diffusivity and $Le$ is the (effective) Lewis number to account for differential diffusion effects.\n- Define extinction via the Damköhler number at the stoichiometric plane, using the mixing time scale $\\tau_{\\mathrm{mix}} = 1/\\chi$ and a given local chemical time scale $\\tau_{\\mathrm{chem}}$ (in $\\mathrm{s}$). Extinction is deemed to occur if $$Da = \\frac{\\tau_{\\mathrm{mix}}}{\\tau_{\\mathrm{chem}}} < 1$$, equivalently if $$\\chi\\,\\tau_{\\mathrm{chem}} > 1$$. Return a boolean indicating extinction.\n\nTask:\n- Implement a program that, for each test case, computes:\n  - the resolved strain-rate magnitude $\\|S\\|$ from the velocity gradient tensor $G$,\n  - the subgrid eddy viscosity $\\nu_{\\mathrm{t}}$ using the Smagorinsky model,\n  - the constant-case eddy diffusivity $D_{\\mathrm{t,const}}$,\n  - the dynamic-case eddy diffusivity $D_{\\mathrm{t,dyn}}$ via the dynamic scalar model described above,\n  - the scalar dissipation rates $\\chi_{\\mathrm{const}}$ and $\\chi_{\\mathrm{dyn}}$ (in $\\mathrm{s}^{-1}$),\n  - and the extinction booleans for the constant and dynamic cases based on the criterion $\\chi\\,\\tau_{\\mathrm{chem}} > 1$.\n\nUnits:\n- Report $\\chi$ in $\\mathrm{s}^{-1}$.\n- Use $D_{\\mathrm{ref}}$ in $\\mathrm{m}^2/\\mathrm{s}$, $\\Delta$ in $\\mathrm{m}$, $\\|S\\|$ and entries of $G$ in $\\mathrm{s}^{-1}$, and gradients $\\nabla Z$ in $\\mathrm{m}^{-1}$.\n\nInput test suite:\n- The program must use the following set of four test cases, each specified by $ (G, \\nabla Z, \\Delta, \\alpha, C_{\\mathrm{s}}, Sc_{\\mathrm{t,const}}, D_{\\mathrm{ref}}, Le, L, \\tau_{\\mathrm{chem}}) $, with $G$ a $3\\times 3$ matrix, $\\nabla Z$ and $L$ $3$-vectors:\n  1. Case $1$ (moderate strain, mild differential diffusion, happy path):\n     - $G = \\begin{bmatrix} 0 & 400 & 0 \\\\ 0 & 0 & 0 \\\\ 0 & 0 & 0 \\end{bmatrix}\\,(\\mathrm{s}^{-1})$,\n     - $\\nabla Z = \\begin{bmatrix} 100 \\\\ 0 \\\\ 0 \\end{bmatrix}\\,(\\mathrm{m}^{-1})$,\n     - $\\Delta = 1.0\\times 10^{-3}\\,(\\mathrm{m})$,\n     - $\\alpha = 2.0$,\n     - $C_{\\mathrm{s}} = 0.17$,\n     - $Sc_{\\mathrm{t,const}} = 0.7$,\n     - $D_{\\mathrm{ref}} = 1.5\\times 10^{-5}\\,(\\mathrm{m}^2/\\mathrm{s})$,\n     - $Le = 1.2$,\n     - $L = \\begin{bmatrix} -1.0\\times 10^{-4} \\\\ 0 \\\\ 0 \\end{bmatrix}$,\n     - $\\tau_{\\mathrm{chem}} = 1.0\\times 10^{-2}\\,(\\mathrm{s})$.\n  2. Case $2$ (near-zero scalar gradient, boundary case):\n     - $G = \\begin{bmatrix} 0 & 400 & 0 \\\\ 0 & 0 & 0 \\\\ 0 & 0 & 0 \\end{bmatrix}\\,(\\mathrm{s}^{-1})$,\n     - $\\nabla Z = \\begin{bmatrix} 1.0\\times 10^{-2} \\\\ 0 \\\\ 0 \\end{bmatrix}\\,(\\mathrm{m}^{-1})$,\n     - $\\Delta = 1.0\\times 10^{-3}\\,(\\mathrm{m})$,\n     - $\\alpha = 2.0$,\n     - $C_{\\mathrm{s}} = 0.17$,\n     - $Sc_{\\mathrm{t,const}} = 0.7$,\n     - $D_{\\mathrm{ref}} = 1.5\\times 10^{-5}\\,(\\mathrm{m}^2/\\mathrm{s})$,\n     - $Le = 1.2$,\n     - $L = \\begin{bmatrix} -1.0\\times 10^{-6} \\\\ 0 \\\\ 0 \\end{bmatrix}$,\n     - $\\tau_{\\mathrm{chem}} = 1.0\\times 10^{-2}\\,(\\mathrm{s})$.\n  3. Case $3$ (high strain, strong differential diffusion, extinction expected):\n     - $G = \\begin{bmatrix} 0 & 800 & 0 \\\\ 0 & 0 & 0 \\\\ 0 & 0 & 0 \\end{bmatrix}\\,(\\mathrm{s}^{-1})$,\n     - $\\nabla Z = \\begin{bmatrix} 500 \\\\ 0 \\\\ 0 \\end{bmatrix}\\,(\\mathrm{m}^{-1})$,\n     - $\\Delta = 8.0\\times 10^{-4}\\,(\\mathrm{m})$,\n     - $\\alpha = 2.0$,\n     - $C_{\\mathrm{s}} = 0.17$,\n     - $Sc_{\\mathrm{t,const}} = 0.7$,\n     - $D_{\\mathrm{ref}} = 1.5\\times 10^{-5}\\,(\\mathrm{m}^2/\\mathrm{s})$,\n     - $Le = 2.0$,\n     - $L = \\begin{bmatrix} -5.0\\times 10^{-2} \\\\ 0 \\\\ 0 \\end{bmatrix}$,\n     - $\\tau_{\\mathrm{chem}} = 1.0\\times 10^{-1}\\,(\\mathrm{s})$.\n  4. Case $4$ (negative dynamic coefficient scenario, clipping edge case):\n     - $G = \\begin{bmatrix} 0 & 300 & 0 \\\\ 0 & 0 & 0 \\\\ 0 & 0 & 0 \\end{bmatrix}\\,(\\mathrm{s}^{-1})$,\n     - $\\nabla Z = \\begin{bmatrix} 200 \\\\ 0 \\\\ 0 \\end{bmatrix}\\,(\\mathrm{m}^{-1})$,\n     - $\\Delta = 1.0\\times 10^{-3}\\,(\\mathrm{m})$,\n     - $\\alpha = 2.0$,\n     - $C_{\\mathrm{s}} = 0.17$,\n     - $Sc_{\\mathrm{t,const}} = 0.7$,\n     - $D_{\\mathrm{ref}} = 1.5\\times 10^{-5}\\,(\\mathrm{m}^2/\\mathrm{s})$,\n     - $Le = 0.8$,\n     - $L = \\begin{bmatrix} 1.0\\times 10^{-2} \\\\ 0 \\\\ 0 \\end{bmatrix}$,\n     - $\\tau_{\\mathrm{chem}} = 2.0\\times 10^{-2}\\,(\\mathrm{s})$.\n\nOutput specification:\n- For each case, return a list of four values $[\\chi_{\\mathrm{const}},\\,\\chi_{\\mathrm{dyn}},\\,\\mathrm{ext}_{\\mathrm{const}},\\,\\mathrm{ext}_{\\mathrm{dyn}}]$, where $\\chi_{\\mathrm{const}}$ and $\\chi_{\\mathrm{dyn}}$ are floats in $\\mathrm{s}^{-1}$, and $\\mathrm{ext}_{\\mathrm{const}}$ and $\\mathrm{ext}_{\\mathrm{dyn}}$ are booleans.\n- Your program should produce a single line of output containing the results for all test cases as a comma-separated list of these lists enclosed in square brackets, for example, $$[\\,[\\chi_{\\mathrm{const},1},\\,\\chi_{\\mathrm{dyn},1},\\,\\mathrm{ext}_{\\mathrm{const},1},\\,\\mathrm{ext}_{\\mathrm{dyn},1}],\\ldots\\,].$$",
            "solution": "The problem statement has been critically reviewed and is determined to be valid. It is scientifically grounded in the principles of computational fluid dynamics and combustion modeling, specifically Large-Eddy Simulation (LES). All necessary equations, parameters, and data are provided, constituting a well-posed, objective, and formalizable problem. There are no internal contradictions, unsound premises, or ambiguities.\n\nThe task is to perform a local analysis comparing two models for the subgrid-scale (SGS) scalar transport in an LES context: a standard model assuming a constant turbulent Schmidt number ($Sc_{\\mathrm{t}}$) and a dynamic model where the model coefficient is computed based on resolved flow quantities. The comparison is centered on the calculation of the scalar dissipation rate, $\\chi$, a key quantity in combustion that measures the rate of molecular mixing at the smallest scales and governs reaction rates. The analysis also includes an assessment of local flame extinction.\n\nThe solution proceeds by calculating the required quantities step-by-step, following the provided model definitions.\n\n**1. Common Quantities**\n\nCertain quantities are foundational to both models and are calculated first. These include the resolved strain-rate tensor magnitude, $\\|\\boldsymbol{S}\\|$, and the molecular diffusivity, $D_{\\mathrm{m}}$.\n\nThe resolved strain-rate tensor, $\\boldsymbol{S}$, is the symmetric part of the resolved velocity gradient tensor, $\\boldsymbol{G}$:\n$$S = \\frac{1}{2}\\left(G + G^{\\top}\\right)$$\nIts magnitude is defined as:\n$$\\|S\\| = \\sqrt{2 S_{ij}S_{ij}} = \\sqrt{2 \\sum_{i=1}^{3}\\sum_{j=1}^{3} S_{ij}^2}$$\nThis quantity characterizes the rate of deformation of fluid elements at the resolved scales and drives the production of subgrid turbulence.\n\nThe molecular diffusivity, $D_{\\mathrm{m}}$, is modeled based on a reference diffusivity, $D_{\\mathrm{ref}}$, and the Lewis number, $Le$, which represents the ratio of thermal diffusivity to mass diffusivity. This formulation accounts for differential diffusion effects, where different species (or heat) diffuse at different rates.\n$$D_{\\mathrm{m}} = \\frac{D_{\\mathrm{ref}}}{Le}$$\n\n**2. Constant Turbulent Schmidt Number Model**\n\nThis approach models the subgrid eddy diffusivity, $D_{\\mathrm{t}}$, as proportional to the subgrid eddy viscosity, $\\nu_{\\mathrm{t}}$, via a constant turbulent Schmidt number, $Sc_{\\mathrm{t,const}}$.\n\nFirst, the eddy viscosity is calculated using the Smagorinsky model:\n$$\\nu_{\\mathrm{t}} = \\left(C_{\\mathrm{s}}\\,\\Delta\\right)^2\\,\\|S\\|$$\nwhere $C_{\\mathrm{s}}$ is the Smagorinsky constant and $\\Delta$ is the LES filter width.\n\nThe constant-case eddy diffusivity, $D_{\\mathrm{t,const}}$, is then:\n$$D_{\\mathrm{t,const}} = \\frac{\\nu_{\\mathrm{t}}}{Sc_{\\mathrm{t,const}}}$$\nThe total effective diffusivity is the sum of molecular and turbulent contributions:\n$$D_{\\mathrm{eff,const}} = D_{\\mathrm{m}} + D_{\\mathrm{t,const}}$$\n\nFinally, the scalar dissipation rate for the constant $Sc_{\\mathrm{t}}$ model is computed as:\n$$\\chi_{\\mathrm{const}} = 2\\,D_{\\mathrm{eff,const}}\\,\\|\\nabla Z\\|^2$$\nwhere $\\|\\nabla Z\\|^2 = \\sum_{i=1}^{3} \\left(\\frac{\\partial Z}{\\partial x_i}\\right)^2$ is the squared magnitude of the resolved mixture fraction gradient.\n\n**3. Dynamic Turbulent Schmidt Number Model**\n\nThe dynamic model avoids the assumption of a constant $Sc_{\\mathrm{t}}$ by computing a model coefficient dynamically from the resolved flow field. The eddy diffusivity is modeled as:\n$$D_{\\mathrm{t}} = C_{\\kappa}\\,\\Delta^2\\,\\|S\\|$$\nThe dynamic coefficient, $C_{\\kappa}$, is determined using the Germano identity, which relates the subgrid stresses at two different filter levels (the grid filter $\\Delta$ and a test filter $\\tilde{\\Delta} = \\alpha\\,\\Delta$). This leads to an algebraic equation for $C_{\\kappa}$:\n$$C_{\\kappa} = -\\frac{\\sum_i L_i M_i}{\\sum_i M_i^2}$$\nwhere $L_i$ is the Leonard term, representing the resolved part of the subgrid scalar flux, and $M_i$ is a term derived from the model form:\n$$M_i = \\left(\\alpha^2 - 1\\right)\\,\\Delta^2\\,\\|S\\|\\,\\frac{\\partial Z}{\\partial x_i}$$\nThe summations are over the spatial dimensions, $i \\in \\{1, 2, 3\\}$. To ensure physical realism (i.e., that turbulence enhances mixing), the computed coefficient is clipped at zero:\n$$C_{\\kappa} = \\max\\left(C_{\\kappa, \\text{computed}},\\,0\\right)$$\nA resulting value of $C_{\\kappa}=0$ implies that the model predicts no turbulent scalar transport (a scenario known as \"backscatter\" if the unclipped value was negative), and only molecular diffusion remains at the subgrid level.\n\nOnce $C_{\\kappa}$ is determined, the dynamic eddy diffusivity, $D_{\\mathrm{t,dyn}}$, is:\n$$D_{\\mathrm{t,dyn}} = C_{\\kappa}\\,\\Delta^2\\,\\|S\\|$$\nThe total effective diffusivity is:\n$$D_{\\mathrm{eff,dyn}} = D_{\\mathrm{m}} + D_{\\mathrm{t,dyn}}$$\nAnd the corresponding scalar dissipation rate is:\n$$\\chi_{\\mathrm{dyn}} = 2\\,D_{\\mathrm{eff,dyn}}\\,\\|\\nabla Z\\|^2$$\n\n**4. Extinction Criterion**\n\nFlame extinction is assessed using the Damköhler number, $Da$, defined as the ratio of a characteristic mixing time scale, $\\tau_{\\mathrm{mix}}$, to a chemical time scale, $\\tau_{\\mathrm{chem}}$. The mixing time is taken as the inverse of the scalar dissipation rate, $\\tau_{\\mathrm{mix}} = 1/\\chi$. Extinction occurs when mixing is faster than chemistry, i.e., when $Da < 1$. This condition is equivalent to:\n$$\\frac{\\tau_{\\mathrm{mix}}}{\\tau_{\\mathrm{chem}}} < 1 \\implies \\frac{1}{\\chi\\,\\tau_{\\mathrm{chem}}} < 1 \\implies \\chi\\,\\tau_{\\mathrm{chem}} > 1$$\nFor each model, we evaluate this condition to determine the extinction boolean ($True$ if extinction occurs, $False$ otherwise). For the constant $Sc_{\\mathrm{t}}$ case, the check is $\\chi_{\\mathrm{const}}\\,\\tau_{\\mathrm{chem}} > 1$, and for the dynamic case, it is $\\chi_{\\mathrm{dyn}}\\,\\tau_{\\mathrm{chem}} > 1$.\n\nThe provided code implements these calculations for each of the four test cases specified in the problem statement, yielding the scalar dissipation rate and extinction status for both subgrid-scale models.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes scalar dissipation rates and extinction for constant and dynamic\n    turbulent Schmidt number models in LES.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: moderate strain, mild differential diffusion, happy path\n        {\n            \"G\": np.array([[0, 400, 0], [0, 0, 0], [0, 0, 0]], dtype=float),\n            \"nabla_Z\": np.array([100, 0, 0], dtype=float),\n            \"Delta\": 1.0e-3,\n            \"alpha\": 2.0,\n            \"C_s\": 0.17,\n            \"Sc_t_const\": 0.7,\n            \"D_ref\": 1.5e-5,\n            \"Le\": 1.2,\n            \"L\": np.array([-1.0e-4, 0, 0], dtype=float),\n            \"tau_chem\": 1.0e-2,\n        },\n        # Case 2: near-zero scalar gradient, boundary case\n        {\n            \"G\": np.array([[0, 400, 0], [0, 0, 0], [0, 0, 0]], dtype=float),\n            \"nabla_Z\": np.array([1.0e-2, 0, 0], dtype=float),\n            \"Delta\": 1.0e-3,\n            \"alpha\": 2.0,\n            \"C_s\": 0.17,\n            \"Sc_t_const\": 0.7,\n            \"D_ref\": 1.5e-5,\n            \"Le\": 1.2,\n            \"L\": np.array([-1.0e-6, 0, 0], dtype=float),\n            \"tau_chem\": 1.0e-2,\n        },\n        # Case 3: high strain, strong differential diffusion, extinction expected\n        {\n            \"G\": np.array([[0, 800, 0], [0, 0, 0], [0, 0, 0]], dtype=float),\n            \"nabla_Z\": np.array([500, 0, 0], dtype=float),\n            \"Delta\": 8.0e-4,\n            \"alpha\": 2.0,\n            \"C_s\": 0.17,\n            \"Sc_t_const\": 0.7,\n            \"D_ref\": 1.5e-5,\n            \"Le\": 2.0,\n            \"L\": np.array([-5.0e-2, 0, 0], dtype=float),\n            \"tau_chem\": 1.0e-1,\n        },\n        # Case 4: negative dynamic coefficient scenario, clipping edge case\n        {\n            \"G\": np.array([[0, 300, 0], [0, 0, 0], [0, 0, 0]], dtype=float),\n            \"nabla_Z\": np.array([200, 0, 0], dtype=float),\n            \"Delta\": 1.0e-3,\n            \"alpha\": 2.0,\n            \"C_s\": 0.17,\n            \"Sc_t_const\": 0.7,\n            \"D_ref\": 1.5e-5,\n            \"Le\": 0.8,\n            \"L\": np.array([1.0e-2, 0, 0], dtype=float),\n            \"tau_chem\": 2.0e-2,\n        },\n    ]\n\n    def solve_case(case):\n        # Unpack case parameters\n        G = case[\"G\"]\n        nabla_Z = case[\"nabla_Z\"]\n        Delta = case[\"Delta\"]\n        alpha = case[\"alpha\"]\n        C_s = case[\"C_s\"]\n        Sc_t_const = case[\"Sc_t_const\"]\n        D_ref = case[\"D_ref\"]\n        Le = case[\"Le\"]\n        L = case[\"L\"]\n        tau_chem = case[\"tau_chem\"]\n\n        # 1. Common calculations\n        S = 0.5 * (G + G.T)\n        S_mag = np.sqrt(2 * np.sum(S**2))\n        D_m = D_ref / Le\n        nabla_Z_mag_sq = np.sum(nabla_Z**2)\n\n        # 2. Constant Sc_t model\n        nu_t = (C_s * Delta)**2 * S_mag\n        D_t_const = nu_t / Sc_t_const\n        D_eff_const = D_m + D_t_const\n        chi_const = 2 * D_eff_const * nabla_Z_mag_sq\n        ext_const = (chi_const * tau_chem) > 1\n\n        # 3. Dynamic Sc_t model\n        M = (alpha**2 - 1) * Delta**2 * S_mag * nabla_Z\n        \n        C_kappa_num = -np.dot(L, M)\n        C_kappa_den = np.dot(M, M)\n\n        if C_kappa_den == 0:\n            # If M is zero (e.g., zero scalar gradient), C_kappa is indeterminate (0/0).\n            # Physically, no scalar gradient means no subgrid flux, so C_kappa is effectively 0.\n            C_kappa_unclipped = 0.0\n        else:\n            C_kappa_unclipped = C_kappa_num / C_kappa_den\n        \n        C_kappa = max(0.0, C_kappa_unclipped)\n        \n        D_t_dyn = C_kappa * Delta**2 * S_mag\n        D_eff_dyn = D_m + D_t_dyn\n        chi_dyn = 2 * D_eff_dyn * nabla_Z_mag_sq\n        ext_dyn = (chi_dyn * tau_chem) > 1\n\n        return [chi_const, chi_dyn, ext_const, ext_dyn]\n\n    results = []\n    for case in test_cases:\n        result = solve_case(case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The default string representation of a list of lists matches the required format.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "After examining local model accuracy, we now broaden our perspective to the global role of SGS models within a complete simulation. This practice guides you in constructing a diagnostic to verify one of the most fundamental principles: the conservation of energy . You will quantify the global energy dissipation due to the subgrid scales and use it to check the overall energy balance of a simulated combustor, a crucial step in verifying the physical and numerical integrity of any CFD simulation.",
            "id": "4063907",
            "problem": "You are given a hypothetical Large Eddy Simulation (LES) of a low-Mach reactive combustor with adiabatic walls, one inlet, and one outlet. The domain is discretized into uniform control volumes and the simulation advances a filtered total energy consistent with the conservation of energy. Your task is to construct a programmatic diagnostic that checks the global energy balance including the subgrid-scale (SGS) contributions modeled by both the classical Smagorinsky model and the dynamic Smagorinsky model, and to identify discrepancies attributable to modeling or numerical errors.\n\nStarting point for reasoning: conservation of total energy for compressible flow and its filtered Large Eddy Simulation (LES) counterpart, together with the definition of the subgrid-scale stress in an eddy-viscosity closure and the relation between strain-rate and dissipation. Do not assume any shortcut formulas not derivable from these principles.\n\nAssumptions for the diagnostic:\n- The boundaries are adiabatic and viscous work at the boundaries is negligible.\n- The only external energy exchange is through the net resolved convective energy flux at the inlet and outlet and volumetric chemical heat release inside the domain.\n- The subgrid-scale thermal conduction appears only as a boundary flux, which is zero under adiabatic walls, so volumetric SGS contribution to the resolved total energy is entirely through the SGS viscous dissipation.\n- The resolved strain-rate magnitude is provided as $S_{\\mathrm{mag}}$, defined by $S_{\\mathrm{mag}} = \\sqrt{2 S_{ij} S_{ij}}$.\n- The Smagorinsky eddy viscosity uses a constant coefficient $C_s$ and the filter width $\\Delta$; the dynamic Smagorinsky uses a spatially varying coefficient $C_d$ with optional nonnegative clipping to enforce purely dissipative behavior.\n\nDefine the global balance residual $R$ for a given SGS closure as the difference between the instantaneous rate of change of the resolved total energy inside the domain and the right-hand side comprising the net resolved boundary energy flux plus volumetric chemical heat release minus the modeled SGS viscous dissipation. Express $R$ in watts ($\\mathrm{W}$).\n\nYour program must:\n- For each test case, compute the global SGS viscous dissipation based on the provided data and then compute two residuals: one using the constant Smagorinsky coefficient ($C_s$), and one using the dynamic coefficient ($C_d$) clipped to be nonnegative.\n- Return, for each test case, a list containing the Smagorinsky residual, the clipped dynamic Smagorinsky residual, and a boolean flag that is $\\,\\mathrm{True}\\,$ if the absolute value of the clipped dynamic residual is less than or equal to the specified tolerance and $\\,\\mathrm{False}\\,$ otherwise.\n- All results must be in watts ($\\mathrm{W}$).\n\nUnits and inputs:\n- Cell volume $V_{\\mathrm{cell}}$ in $\\mathrm{m}^3$.\n- Filter width $\\Delta$ in $\\mathrm{m}$.\n- Density array $\\rho_i$ in $\\mathrm{kg}/\\mathrm{m}^3$.\n- Strain-rate magnitude array $S_{\\mathrm{mag},i}$ in $\\mathrm{s}^{-1}$.\n- Smagorinsky coefficient $C_s$ (dimensionless).\n- Dynamic Smagorinsky coefficient array $C_{d,i}$ (dimensionless).\n- Inlet resolved convective energy flux $F_{\\mathrm{in}}$ in $\\mathrm{W}$.\n- Outlet resolved convective energy flux $F_{\\mathrm{out}}$ in $\\mathrm{W}$.\n- Volumetric chemical heat release rate integrated over the domain $Q_{\\mathrm{tot}}$ in $\\mathrm{W}$.\n- Instantaneous rate of change of the resolved total energy inside the domain $\\mathrm{d}E/\\mathrm{d}t$ in $\\mathrm{W}$.\n- Tolerance $\\mathrm{tol}$ in $\\mathrm{W}$.\n\nTest suite (each case is independent; arrays are ordered per cell):\n1. Happy-path, moderately turbulent, adiabatic walls:\n   - $V_{\\mathrm{cell}} = 0.02$, $\\Delta = 0.05$, $\\rho = [1.2, 1.18, 1.22, 1.19]$, $S_{\\mathrm{mag}} = [400.0, 450.0, 420.0, 430.0]$, $C_s = 0.18$, $C_d = [0.16, 0.20, 0.17, 0.19]$, $F_{\\mathrm{in}} = 2600.0$, $F_{\\mathrm{out}} = 1800.0$, $Q_{\\mathrm{tot}} = 500.0$, $\\mathrm{d}E/\\mathrm{d}t = 705.0$, $\\mathrm{tol} = 25.0$.\n2. Boundary case with zero strain-rate (no SGS dissipation):\n   - $V_{\\mathrm{cell}} = 0.02$, $\\Delta = 0.03$, $\\rho = [1.0, 1.0, 1.0, 1.0]$, $S_{\\mathrm{mag}} = [0.0, 0.0, 0.0, 0.0]$, $C_s = 0.18$, $C_d = [0.0, 0.0, 0.0, 0.0]$, $F_{\\mathrm{in}} = 1000.0$, $F_{\\mathrm{out}} = 800.0$, $Q_{\\mathrm{tot}} = 150.0$, $\\mathrm{d}E/\\mathrm{d}t = 350.0$, $\\mathrm{tol} = 0.5$.\n3. High-strain case where large constant $C_s$ yields strong dissipation:\n   - $V_{\\mathrm{cell}} = 0.015$, $\\Delta = 0.06$, $\\rho = [0.95, 0.90, 0.92, 0.94]$, $S_{\\mathrm{mag}} = [650.0, 700.0, 680.0, 660.0]$, $C_s = 0.18$, $C_d = [0.12, 0.15, 0.14, 0.13]$, $F_{\\mathrm{in}} = 4000.0$, $F_{\\mathrm{out}} = 3000.0$, $Q_{\\mathrm{tot}} = 600.0$, $\\mathrm{d}E/\\mathrm{d}t = -380.0$, $\\mathrm{tol} = 10.0$.\n4. Dynamic model with negative coefficients (clipped to nonnegative):\n   - $V_{\\mathrm{cell}} = 0.03$, $\\Delta = 0.04$, $\\rho = [1.1, 1.05, 1.08, 1.06]$, $S_{\\mathrm{mag}} = [300.0, 350.0, 320.0, 310.0]$, $C_s = 0.17$, $C_d = [-0.10, 0.05, -0.02, 0.0]$, $F_{\\mathrm{in}} = 1800.0$, $F_{\\mathrm{out}} = 1300.0$, $Q_{\\mathrm{tot}} = 400.0$, $\\mathrm{d}E/\\mathrm{d}t = 895.0$, $\\mathrm{tol} = 3.0$.\n5. Small filter width (weak SGS dissipation) sensitivity:\n   - $V_{\\mathrm{cell}} = 0.01$, $\\Delta = 0.01$, $\\rho = [1.2, 1.21, 1.19, 1.18, 1.20]$, $S_{\\mathrm{mag}} = [200.0, 220.0, 210.0, 205.0, 215.0]$, $C_s = 0.18$, $C_d = [0.17, 0.16, 0.18, 0.17, 0.15]$, $F_{\\mathrm{in}} = 1200.0$, $F_{\\mathrm{out}} = 1050.0$, $Q_{\\mathrm{tot}} = 130.0$, $\\mathrm{d}E/\\mathrm{d}t = 260.0$, $\\mathrm{tol} = 15.0$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets.\n- Each test-case result must itself be a list of the form $[R_{\\mathrm{Smag}}, R_{\\mathrm{DynClip}}, \\mathrm{flag}]$, where $R_{\\mathrm{Smag}}$ and $R_{\\mathrm{DynClip}}$ are floats in watts and $\\mathrm{flag}$ is boolean.\n- Example top-level formatting: $[[r_1^{\\mathrm{Smag}}, r_1^{\\mathrm{Dyn}}, \\mathrm{True}], [r_2^{\\mathrm{Smag}}, r_2^{\\mathrm{Dyn}}, \\mathrm{False}], \\dots]$.",
            "solution": "We begin from conservation of total energy for compressible flow. The unfiltered total energy equation in conservative form is\n$$\n\\frac{\\partial}{\\partial t} (\\rho E) + \\nabla \\cdot (\\rho E \\mathbf{u} + p \\mathbf{u}) = \\nabla \\cdot (\\boldsymbol{\\tau} \\cdot \\mathbf{u} - \\mathbf{q}) + \\rho \\dot{q},\n$$\nwhere $\\rho$ is density, $E = e + \\tfrac{1}{2} |\\mathbf{u}|^2$ is specific total energy (internal $e$ plus kinetic), $\\mathbf{u}$ is velocity, $p$ is pressure, $\\boldsymbol{\\tau}$ is viscous stress, $\\mathbf{q}$ is heat flux, and $\\dot{q}$ is volumetric chemical heat release per unit mass. Under a spatial filter appropriate for Large Eddy Simulation (LES), we obtain the filtered equation for resolved quantities, which introduces subgrid-scale (SGS) terms due to unresolved fluctuations. Denoting filtered variables with an overbar and ignoring density-weighted complications for brevity, the filtered total energy equation can be expressed schematically as\n$$\n\\frac{\\partial}{\\partial t} (\\bar{\\rho} \\bar{E}) + \\nabla \\cdot (\\bar{\\rho} \\bar{E}\\, \\bar{\\mathbf{u}} + \\bar{p} \\,\\bar{\\mathbf{u}}) = \\nabla \\cdot (\\boldsymbol{\\tau}_{\\mathrm{res}} \\cdot \\bar{\\mathbf{u}} - \\mathbf{q}_{\\mathrm{res}}) - \\nabla \\cdot (\\boldsymbol{\\tau}_{\\mathrm{sgs}} \\cdot \\bar{\\mathbf{u}} - \\mathbf{q}_{\\mathrm{sgs}}) - \\boldsymbol{\\tau}_{\\mathrm{sgs}} : \\bar{\\nabla \\mathbf{u}} + \\bar{\\rho} \\,\\bar{\\dot{q}},\n$$\nin which $\\boldsymbol{\\tau}_{\\mathrm{res}}$ and $\\mathbf{q}_{\\mathrm{res}}$ are resolved viscous stress and heat flux, and $\\boldsymbol{\\tau}_{\\mathrm{sgs}}$ and $\\mathbf{q}_{\\mathrm{sgs}}$ are SGS stress and heat flux closures. The double contraction $-\\boldsymbol{\\tau}_{\\mathrm{sgs}} : \\bar{\\nabla \\mathbf{u}}$ represents energy transfer from resolved to subgrid scales (dissipation of resolved energy). Under adiabatic walls, $\\mathbf{q}_{\\mathrm{res}}$ and $\\mathbf{q}_{\\mathrm{sgs}}$ contribute no net boundary flux. Viscous work at the boundary is negligible by assumption.\n\nIntegrating over the domain volume $V$ and applying the divergence theorem yields the global balance:\n$$\n\\frac{d}{dt} \\int_V \\bar{\\rho} \\bar{E} \\, dV\n= \\underbrace{ \\oint_{\\partial V} \\mathbf{n} \\cdot (\\bar{\\rho} \\bar{E}\\, \\bar{\\mathbf{u}} + \\bar{p}\\, \\bar{\\mathbf{u}}) \\, dA }_{\\text{resolved convective/power flux}}\n+ \\underbrace{\\int_V \\bar{\\rho} \\, \\bar{\\dot{q}} \\, dV}_{\\text{chemical heat release}}\n\\; - \\; \\underbrace{\\int_V \\boldsymbol{\\tau}_{\\mathrm{sgs}} : \\bar{\\nabla \\mathbf{u}} \\, dV}_{\\text{SGS viscous dissipation}}.\n$$\nWith one inlet and one outlet, we model the boundary integral by the net resolved energy flux $F_{\\mathrm{in}} - F_{\\mathrm{out}}$ provided. Denote the resolved energy time derivative by $\\frac{dE}{dt} = \\frac{d}{dt} \\int_V \\bar{\\rho} \\bar{E} \\, dV$, the integrated chemical source by $Q_{\\mathrm{tot}} = \\int_V \\bar{\\rho} \\, \\bar{\\dot{q}} \\, dV$, and the SGS viscous dissipation by $\\varepsilon_{\\mathrm{sgs}} = \\int_V \\boldsymbol{\\tau}_{\\mathrm{sgs}} : \\bar{\\nabla \\mathbf{u}} \\, dV$ (which is nonnegative for purely dissipative closures). Then\n$$\n\\frac{dE}{dt} = (F_{\\mathrm{in}} - F_{\\mathrm{out}}) + Q_{\\mathrm{tot}} - \\varepsilon_{\\mathrm{sgs}}.\n$$\nThe diagnostic residual is\n$$\nR = \\frac{dE}{dt} - \\left[(F_{\\mathrm{in}} - F_{\\mathrm{out}}) + Q_{\\mathrm{tot}} - \\varepsilon_{\\mathrm{sgs}}\\right],\n$$\nwhich should be $0$ in exact arithmetic and perfect modeling; deviations indicate modeling or numerical errors.\n\nTo evaluate $\\varepsilon_{\\mathrm{sgs}}$, we adopt the eddy-viscosity hypothesis for the SGS stress:\n$$\n\\boldsymbol{\\tau}_{\\mathrm{sgs}} = 2 \\bar{\\rho} \\, \\nu_t \\, \\bar{\\mathbf{S}} - \\frac{2}{3} \\bar{\\rho} \\, k_{\\mathrm{sgs}} \\mathbf{I},\n$$\nwhere $\\nu_t$ is the eddy viscosity, $\\bar{\\mathbf{S}}$ is the resolved strain-rate tensor with components $\\bar{S}_{ij} = \\tfrac{1}{2} (\\partial \\bar{u}_i / \\partial x_j + \\partial \\bar{u}_j / \\partial x_i)$, and $k_{\\mathrm{sgs}}$ is subgrid kinetic energy. In low-Mach LES of combustors, the term involving $k_{\\mathrm{sgs}}$ contributes via $\\nabla \\cdot \\bar{\\mathbf{u}}$, which is negligible under near-incompressibility. Therefore,\n$$\n\\varepsilon_{\\mathrm{sgs}} \\approx \\int_V 2 \\bar{\\rho} \\, \\nu_t \\, \\bar{S}_{ij} \\bar{S}_{ij} \\, dV.\n$$\nUsing $S_{\\mathrm{mag}} = \\sqrt{2 \\bar{S}_{ij} \\bar{S}_{ij}}$, we have $\\bar{S}_{ij} \\bar{S}_{ij} = \\tfrac{1}{2} S_{\\mathrm{mag}}^2$. Hence,\n$$\n\\varepsilon_{\\mathrm{sgs}} \\approx \\int_V \\bar{\\rho} \\, \\nu_t \\, S_{\\mathrm{mag}}^2 \\, dV.\n$$\nFor the Smagorinsky closure,\n$$\n\\nu_t = (C \\Delta)^2 \\, S_{\\mathrm{mag}},\n$$\nwith $C = C_s$ for the constant Smagorinsky model and $C = C_d(\\mathbf{x})$ for the dynamic Smagorinsky model. Substituting gives\n$$\n\\varepsilon_{\\mathrm{sgs}} \\approx \\int_V \\bar{\\rho} \\, (C^2 \\Delta^2) \\, S_{\\mathrm{mag}}^3 \\, dV,\n$$\nwhich is evaluated numerically by summation over cells:\n$$\n\\varepsilon_{\\mathrm{sgs}} \\approx \\sum_{i} \\rho_i \\, C_i^2 \\, \\Delta^2 \\, S_{\\mathrm{mag},i}^3 \\, V_{\\mathrm{cell}}.\n$$\nIf $C = C_s$ is constant, then $C_i = C_s$ for all $i$. For the dynamic Smagorinsky model, $C_i = C_{d,i}$ may be negative due to backscatter. The purely dissipative variant clips $C_{d,i}$ to $C_{d,i}^{+} = \\max(C_{d,i}, 0)$, ensuring $\\varepsilon_{\\mathrm{sgs}} \\ge 0$.\n\nAlgorithm for each test case:\n1. Read $V_{\\mathrm{cell}}$, $\\Delta$, arrays $\\rho_i$ and $S_{\\mathrm{mag},i}$, constants $C_s$ and $C_{d,i}$, and scalars $F_{\\mathrm{in}}$, $F_{\\mathrm{out}}$, $Q_{\\mathrm{tot}}$, $\\frac{dE}{dt}$, and $\\mathrm{tol}$.\n2. Compute $\\varepsilon_{\\mathrm{sgs}}^{\\mathrm{Smag}} = \\sum_i \\rho_i \\, C_s^2 \\, \\Delta^2 \\, S_{\\mathrm{mag},i}^3 \\, V_{\\mathrm{cell}}$.\n3. Compute $\\varepsilon_{\\mathrm{sgs}}^{\\mathrm{DynClip}} = \\sum_i \\rho_i \\, (\\max(C_{d,i},0))^2 \\, \\Delta^2 \\, S_{\\mathrm{mag},i}^3 \\, V_{\\mathrm{cell}}$.\n4. Compute residuals\n   $$R_{\\mathrm{Smag}} = \\frac{dE}{dt} - \\left[(F_{\\mathrm{in}} - F_{\\mathrm{out}}) + Q_{\\mathrm{tot}} - \\varepsilon_{\\mathrm{sgs}}^{\\mathrm{Smag}} \\right]$$\n   and\n   $$R_{\\mathrm{DynClip}} = \\frac{dE}{dt} - \\left[(F_{\\mathrm{in}} - F_{\\mathrm{out}}) + Q_{\\mathrm{tot}} - \\varepsilon_{\\mathrm{sgs}}^{\\mathrm{DynClip}} \\right]$$.\n5. Flag $\\mathrm{True}$ if $|R_{\\mathrm{DynClip}}| \\le \\mathrm{tol}$, else $\\mathrm{False}$.\n6. Output the list $[R_{\\mathrm{Smag}}, R_{\\mathrm{DynClip}}, \\mathrm{flag}]$ for each case and aggregate them into a single top-level list printed on one line.\n\nScientific realism and coverage:\n- Case $1$ exercises a typical turbulent combustor LES where SGS dissipation is moderate and the residuals are expected to be small if the model and numerics are consistent.\n- Case $2$ verifies the boundary condition of zero SGS dissipation when $S_{\\mathrm{mag},i} = 0$, testing the diagnostic’s correct handling of edge conditions.\n- Case $3$ explores high strain with large constant $C_s$, where SGS dissipation is strong; the dynamic model yields lower dissipation and the residual highlights possible model-form discrepancy or numerical inconsistency.\n- Case $4$ tests dynamic coefficients with negative values; clipping enforces nonnegative dissipation and the diagnostic confirms acceptable residual within tolerance.\n- Case $5$ uses a small filter width $\\Delta$ that suppresses SGS dissipation, highlighting sensitivity and potential under-dissipation leading to a significant residual.\n\nAll outputs are expressed in watts ($\\mathrm{W}$). No angles or percentages are involved. The final printed format is a single line comprising a top-level list with one sublist per test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef sgs_dissipation(rho, S_mag, delta, C, V_cell, clip_negative=False):\n    \"\"\"\n    Compute SGS viscous dissipation:\n        epsilon_sgs = sum_i rho_i * (C_i^2 * delta^2) * S_mag_i^3 * V_cell\n    where:\n        - rho: array of densities (kg/m^3)\n        - S_mag: array of strain-rate magnitudes (1/s)\n        - delta: filter width (m)\n        - C: scalar Smagorinsky constant or array of dynamic coefficients\n        - V_cell: cell volume (m^3)\n        - clip_negative: if True, clip dynamic coefficients to be nonnegative\n    Returns epsilon_sgs in Watts (J/s).\n    \"\"\"\n    rho = np.asarray(rho, dtype=float)\n    S_mag = np.asarray(S_mag, dtype=float)\n    C_arr = np.asarray(C, dtype=float)\n    if C_arr.ndim == 0:\n        C_arr = np.full_like(S_mag, C_arr)\n    if clip_negative:\n        C_arr = np.maximum(C_arr, 0.0)\n    epsilon = np.sum(rho * (C_arr**2) * (delta**2) * (S_mag**3) * V_cell)\n    return float(epsilon)\n\ndef compute_residuals(case):\n    \"\"\"\n    Compute residuals for Smagorinsky and clipped dynamic Smagorinsky,\n    and flag whether the dynamic residual magnitude is within tolerance.\n    \"\"\"\n    V_cell = case[\"V_cell\"]\n    delta = case[\"delta\"]\n    rho = case[\"rho\"]\n    S_mag = case[\"S_mag\"]\n    C_s = case[\"C_s\"]\n    C_d = case[\"C_d\"]\n    F_in = case[\"F_in\"]\n    F_out = case[\"F_out\"]\n    Q_tot = case[\"Q_tot\"]\n    dE_dt = case[\"dE_dt\"]\n    tol = case[\"tol\"]\n\n    eps_smag = sgs_dissipation(rho, S_mag, delta, C_s, V_cell, clip_negative=False)\n    eps_dyn_clip = sgs_dissipation(rho, S_mag, delta, C_d, V_cell, clip_negative=True)\n\n    rhs_smag = (F_in - F_out) + Q_tot - eps_smag\n    rhs_dyn_clip = (F_in - F_out) + Q_tot - eps_dyn_clip\n\n    R_smag = dE_dt - rhs_smag\n    R_dyn_clip = dE_dt - rhs_dyn_clip\n\n    flag = abs(R_dyn_clip) <= tol\n    return [R_smag, R_dyn_clip, flag]\n\ndef format_results_no_spaces(results):\n    \"\"\"\n    Format nested lists with booleans into a single-line string without spaces,\n    as required by the output specification.\n    \"\"\"\n    parts = []\n    for item in results:\n        # item is [float, float, bool]\n        r1 = item[0]\n        r2 = item[1]\n        flag = item[2]\n        parts.append(f\"[{r1},{r2},{flag}]\")\n    return \"[\" + \",\".join(parts) + \"]\"\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"V_cell\": 0.02,\n            \"delta\": 0.05,\n            \"rho\": [1.2, 1.18, 1.22, 1.19],\n            \"S_mag\": [400.0, 450.0, 420.0, 430.0],\n            \"C_s\": 0.18,\n            \"C_d\": [0.16, 0.20, 0.17, 0.19],\n            \"F_in\": 2600.0,\n            \"F_out\": 1800.0,\n            \"Q_tot\": 500.0,\n            \"dE_dt\": 705.0,\n            \"tol\": 25.0\n        },\n        {\n            \"V_cell\": 0.02,\n            \"delta\": 0.03,\n            \"rho\": [1.0, 1.0, 1.0, 1.0],\n            \"S_mag\": [0.0, 0.0, 0.0, 0.0],\n            \"C_s\": 0.18,\n            \"C_d\": [0.0, 0.0, 0.0, 0.0],\n            \"F_in\": 1000.0,\n            \"F_out\": 800.0,\n            \"Q_tot\": 150.0,\n            \"dE_dt\": 350.0,\n            \"tol\": 0.5\n        },\n        {\n            \"V_cell\": 0.015,\n            \"delta\": 0.06,\n            \"rho\": [0.95, 0.90, 0.92, 0.94],\n            \"S_mag\": [650.0, 700.0, 680.0, 660.0],\n            \"C_s\": 0.18,\n            \"C_d\": [0.12, 0.15, 0.14, 0.13],\n            \"F_in\": 4000.0,\n            \"F_out\": 3000.0,\n            \"Q_tot\": 600.0,\n            \"dE_dt\": -380.0,\n            \"tol\": 10.0\n        },\n        {\n            \"V_cell\": 0.03,\n            \"delta\": 0.04,\n            \"rho\": [1.1, 1.05, 1.08, 1.06],\n            \"S_mag\": [300.0, 350.0, 320.0, 310.0],\n            \"C_s\": 0.17,\n            \"C_d\": [-0.10, 0.05, -0.02, 0.0],\n            \"F_in\": 1800.0,\n            \"F_out\": 1300.0,\n            \"Q_tot\": 400.0,\n            \"dE_dt\": 895.0,\n            \"tol\": 3.0\n        },\n        {\n            \"V_cell\": 0.01,\n            \"delta\": 0.01,\n            \"rho\": [1.2, 1.21, 1.19, 1.18, 1.20],\n            \"S_mag\": [200.0, 220.0, 210.0, 205.0, 215.0],\n            \"C_s\": 0.18,\n            \"C_d\": [0.17, 0.16, 0.18, 0.17, 0.15],\n            \"F_in\": 1200.0,\n            \"F_out\": 1050.0,\n            \"Q_tot\": 130.0,\n            \"dE_dt\": 260.0,\n            \"tol\": 15.0\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = compute_residuals(case)\n        results.append(result)\n\n    # Final print statement in the exact required format (single line).\n    print(format_results_no_spaces(results))\n\nsolve()\n```"
        }
    ]
}