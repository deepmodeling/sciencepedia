{
    "hands_on_practices": [
        {
            "introduction": "Smagorinsky模型的预测精度在很大程度上取决于其核心参数——Smagorinsky常数 $C_s$ 的取值。本实践将引导您使用一种称为“先验”（a priori）测试的强大技术，通过将模型预测与高保真度模拟（如直接数值模拟）得到的“精确”亚格子应力进行比较，来确定最优的 $C_s$ 值。您将通过一个可变密度反应剪切层的经典算例，亲手计算最优常数，为评估和开发亚格子模型奠定坚实的基础 ``。",
            "id": "4063988",
            "problem": "您的任务是执行一项基于密度加权（Favre）滤波的先验测试，以确定用于平面反应剪切层大涡模拟（LES）建模的最优 Smagorinsky 常数。目标是推导并实现一个程序，该程序对于一组给定的滤波器宽度，计算无量纲 Smagorinsky 系数的单个标量值，该值使得通过对一个合成的类直接数值模拟（DNS）场进行滤波所得到的模拟与精确的偏亚格子尺度（SGS）应力之间的均方误差最小。\n\n从以下基本定义和原理开始：\n- 考虑一个长度为 $L_x$ 和 $L_y$ 的二维周期性域，空间坐标为 $x$ 和 $y$，网格间距均匀。所有物理量均为无量纲。\n- 令 $\\rho(x,y)$ 表示密度，令 $u_i(x,y)$ 表示速度分量，其中 $i \\in \\{x,y\\}$。使用密度加权（Favre）滤波，对于任意场 $\\phi$ 定义为 $\\tilde{\\phi} = \\overline{\\rho \\phi}/\\overline{\\rho}$，其中上划线表示使用二维归一化各向同性高斯核进行空间滤波。二维高斯核的标准差必须为 $\\sigma$，且建模中使用的滤波器宽度 $\\Delta$ 必须通过 $\\sigma = \\Delta/2$ 与 $\\sigma$ 相关联。空间滤波的执行必须与周期性域保持一致。\n- 定义精确 Favre SGS 应力张量为 $\\tau_{ij} = \\overline{\\rho u_i u_j}/\\overline{\\rho} - \\tilde{u}_i \\tilde{u}_j$。在二维情况下，定义其偏量部分为 $\\tau_{ij}^{d} = \\tau_{ij} - \\frac{1}{2} \\tau_{kk} \\delta_{ij}$，其中 $\\delta_{ij}$ 是克罗内克 δ，索引 $i,j \\in \\{x,y\\}$。\n- 定义滤波后的应变率张量为 $S_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\tilde{u}_i}{\\partial x_j} + \\frac{\\partial \\tilde{u}_j}{\\partial x_i}\\right)$，其大小为 $|S| = \\sqrt{2 S_{ij} S_{ij}}$，在二维情况下对重复索引求和。\n- 引用适用于可压缩变密度流的 Boussinesq 涡粘性假设，该假设指出 Favre SGS 应力的偏量部分与滤波后的密度、涡粘性以及应变率张量成正比。假设涡粘性与滤波器宽度的平方和应变率大小成正比，其中包含一个未知的无量纲常数，该常数必须通过最小化模拟与精确的偏 SGS 应力之间的均方误差来确定。您的程序必须推导并使用此关系，为每个滤波器宽度建立并求解该常数的标量最小二乘问题。\n\n构建一个具有以下规格的合成类 DNS 平面反应剪切层，以使测试自洽且科学上合理：\n- 域：$L_x = 2\\pi$，$L_y = 2\\pi$，在两个方向上均具有周期性边界条件。使用 $N_x = 128$，$N_y = 128$ 的均匀网格。\n- 剪切层中心位于 $y_0 = L_y/2$。定义基础流向速度分量 $u(x,y)$ 为 $u(x,y) = U\\, \\tanh\\!\\left(\\frac{y - y_0}{\\theta}\\right) + A_u \\sin(k_x x)\\, \\mathrm{sech}\\!\\left(\\frac{y - y_0}{\\theta_p}\\right)$，横流速度分量 $v(x,y)$ 为 $v(x,y) = A_v \\cos(k_x x)\\, \\mathrm{sech}\\!\\left(\\frac{y - y_0}{\\theta_v}\\right)$，其中 $\\mathrm{sech}(\\cdot)$ 是双曲正割函数。使用参数 $U = 1$，$\\theta = L_y/20$，$\\theta_p = L_y/18$，$\\theta_v = L_y/16$， $A_u = 0.15$，$A_v = 0.10$ 和 $k_x = 4$。\n- 密度场考虑了流间不对称性和热释放。定义混合密度剖面 $\\rho_{\\mathrm{mix}}(y) = \\frac{1}{2}(\\rho_1 + \\rho_2) + \\frac{1}{2}(\\rho_2 - \\rho_1)\\, \\tanh\\!\\left(\\frac{y - y_0}{\\theta_\\rho}\\right)$，其中 $\\rho_1 = 1.0$，$\\rho_2 = 2.0$ 和 $\\theta_\\rho = L_y/22$。定义反应进程变量 $c(x,y) = \\exp\\!\\left(-\\frac{(y - y_0)^2}{w^2}\\right)\\, \\left[\\frac{1}{2} + \\frac{1}{2}\\sin(k_x x)\\right]$，其中 $w = L_y/30$。最终密度为 $\\rho(x,y) = \\rho_{\\mathrm{mix}}(y) \\left[1 - \\beta\\, c(x,y)\\right]$，其中 $\\beta = 0.3$。这导致在反应进程较高的区域密度较低，与热释放一致。\n\n您的程序必须：\n1. 通过傅里叶空间滤波器为任意场实现二维周期性高斯滤波，该滤波器的乘子为 $\\exp\\!\\left(-\\frac{1}{2}\\sigma^2(k_x^2+k_y^2)\\right)$，其中 $k_x$ 和 $k_y$ 是与周期性域一致的波数。\n2. 使用由测试用例滤波器宽度 $\\Delta$ 定义的高斯核，通过密度加权滤波计算 $\\overline{\\rho}$、$\\tilde{u}_i$ 和 $\\overline{\\rho u_i u_j}$。\n3. 在二维情况下构建精确的偏 SGS 应力 $\\tau_{ij}^{d}$。\n4. 根据 Favre 滤波后的速度，使用与周期性域一致的谱方法微分，计算滤波后的应变率张量 $S_{ij}$ 及其大小 $|S|$。\n5. 建立基于带有未知无量纲常数的 Boussinesq 涡粘性的模型偏应力与精确偏应力 $\\tau_{ij}^{d}$ 之间的均方误差最小化问题，并求解标量最小二乘问题以获得最优常数。最后，计算相应的 Smagorinsky 系数。\n6. 为确保数值鲁棒性，如果最小二乘分母低于 $10^{-12}$，则该测试用例返回 $0$。\n\n测试套件：\n- 使用以下四个滤波器宽度，表示为 $x$ 方向网格间距的倍数，$\\Delta = \\alpha\\, \\Delta_x$，其中 $\\Delta_x = L_x / N_x$ 且 $\\alpha \\in \\{2.0, 4.0, 8.0, 16.0\\}$。\n\n输出规格：\n- 对于每个测试用例，结果是一个浮点数，代表最优的无量纲 Smagorinsky 系数。\n- 您的程序应生成单行输出，其中包含四个结果，以逗号分隔并用方括号括起来（例如，“[c1,c2,c3,c4]”）。结果应表示为 Python 浮点字符串格式。",
            "solution": "该问题要求为变密度反应剪切层的大涡模拟（LES）确定一个最优 Smagorinsky 常数 $C_s$。这是通过一项*先验*测试实现的，该测试涉及生成一个合成的类直接数值模拟（DNS）数据场，将该场显式滤波到更粗的分辨率，然后找到使精确与模拟的亚格子尺度（SGS）应力之间的均方误差最小化的 $C_s$ 值。该分析基于密度加权（Favre）滤波。\n\n首先，我们建立理论框架。一个量 $\\phi$ 的 Favre 滤波值定义为 $\\tilde{\\phi} = \\overline{\\rho \\phi} / \\overline{\\rho}$，其中 $\\rho$ 是密度，上划线表示空间滤波操作。精确的 Favre 滤波 SGS 应力张量 $\\tau_{ij}$ 代表了未解析尺度对已解析尺度动量输运的影响，其表达式为\n$$ \\tau_{ij} = \\widetilde{u_i u_j} - \\tilde{u}_i \\tilde{u}_j = \\frac{\\overline{\\rho u_i u_j}}{\\overline{\\rho}} - \\tilde{u}_i \\tilde{u}_j $$\n其中 $u_i$ 是速度分量。由于 Smagorinsky 模型是对应力张量各向异性部分的模型，我们处理 $\\tau_{ij}$ 的偏量（无迹）部分。在二维情况下（$i,j \\in \\{x,y\\}$），其定义为\n$$ \\tau_{ij}^{d} = \\tau_{ij} - \\frac{1}{2} \\tau_{kk} \\delta_{ij} $$\n其中 $\\delta_{ij}$ 是克罗内克 δ，并且对重复索引 $k$ 进行求和。\n\n用于偏 SGS 应力的 Smagorinsky 模型基于 Boussinesq 涡粘性假设。对于可压缩变密度流，该假设将偏应力与 Favre 滤波后的应变率张量 $S_{ij}^d$ 的偏量部分相关联：\n$$ \\tau_{ij}^{d, \\text{mod}} = -2 \\overline{\\rho} \\nu_t S_{ij}^d $$\nFavre 滤波后的应变率张量为 $S_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\tilde{u}_i}{\\partial x_j} + \\frac{\\partial \\tilde{u}_j}{\\partial x_i}\\right)$，其在二维中的偏量部分为 $S_{ij}^d = S_{ij} - \\frac{1}{2} S_{kk} \\delta_{ij}$。涡粘性 $\\nu_t$ 通过 Smagorinsky 闭合模型建模为\n$$ \\nu_t = (C_s \\Delta)^2 |S| $$\n其中 $C_s$ 是无量纲 Smagorinsky 常数，$\\Delta$ 是滤波器宽度，而 $|S|$ 是应变率张量的大小，定义为 $|S| = \\sqrt{2 S_{ij} S_{ij}}$。结合这些表达式，模拟的偏 SGS 应力为\n$$ \\tau_{ij}^{d, \\text{mod}} = -2 (C_s \\Delta)^2 \\overline{\\rho} |S| S_{ij}^d $$\n问题在于找到能够最佳拟合从 DNS 数据计算出的精确应力 $\\tau_{ij}^d$ 的 $C_s$ 的单个标量值。这是一个标量最小二乘问题。我们寻求最小化空间平均的均方误差 $E$：\n$$ E(C_s) = \\left\\langle \\left( \\tau_{ij}^d - \\tau_{ij}^{d, \\text{mod}} \\right)^2 \\right\\rangle $$\n其中 $\\langle \\cdot \\rangle$ 表示在域上的空间平均，并且隐含了对索引 $i,j$ 的求和。让我们定义待求参数为 $K = C_s^2$，模型基张量为 $M_{ij} = -2 \\Delta^2 \\overline{\\rho} |S| S_{ij}^d$。则模型变为 $\\tau_{ij}^{d, \\text{mod}} = K M_{ij}$，误差泛函变为\n$$ E(K) = \\left\\langle (\\tau_{ij}^d - K M_{ij})(\\tau_{ij}^d - K M_{ij}) \\right\\rangle = \\left\\langle (\\tau_{ij}^d)^2 - 2K \\tau_{ij}^d M_{ij} + K^2 (M_{ij})^2 \\right\\rangle $$\n为了找到最小值，我们对 $K$ 求导并令其结果为零：\n$$ \\frac{dE}{dK} = \\left\\langle -2 \\tau_{ij}^d M_{ij} + 2K (M_{ij})^2 \\right\\rangle = 0 $$\n求解 $K$ 得到最优值：\n$$ K_{\\text{opt}} = C_s^2 = \\frac{\\left\\langle \\tau_{ij}^d M_{ij} \\right\\rangle}{\\left\\langle M_{ij} M_{ij} \\right\\rangle} $$\n空间平均 $\\langle \\cdot \\rangle$ 对应于对所有网格点求和。代入 $M_{ij}$ 的表达式：\n$$ C_s^2 = \\frac{\\left\\langle \\tau_{ij}^d (-2 \\Delta^2 \\overline{\\rho} |S| S_{ij}^d) \\right\\rangle}{\\left\\langle (-2 \\Delta^2 \\overline{\\rho} |S| S_{ij}^d)^2 \\right\\rangle} = \\frac{-\\left\\langle \\overline{\\rho} |S| (\\tau_{ij}^d S_{ij}^d) \\right\\rangle}{2\\Delta^2 \\left\\langle (\\overline{\\rho}|S|)^2 (S_{kl}^d S_{kl}^d) \\right\\rangle} $$\n对于一个物理上有意义的耗散模型，$C_s^2$ 应该是非负的。如果计算结果为负值，则意味着最优的实数值 $C_s$ 是 $0$，因为这将使非负 $C_s^2$ 的误差最小化。因此，最终的 Smagorinsky 常数计算为 $C_s = \\sqrt{\\max(0, C_s^2)}$。\n\n计算流程如下：\n1.  **网格和场生成**：在域 $[0, L_x] \\times [0, L_y]$ 上创建一个大小为 $N_x \\times N_y = 128 \\times 128$ 的均匀网格，其中 $L_x = L_y = 2\\pi$。使用提供的解析表达式在每个网格点上计算合成的类 DNS 速度场 $u_x(x,y)$、$u_y(x,y)$ 和密度场 $\\rho(x,y)$。\n2.  **傅里叶空间操作**：由于域是周期性的，滤波和空间微分都使用快速傅里叶变换（FFT）在傅里叶空间中高效、准确地执行。\n    *   构建与网格对应的波数数组 $k_x$ 和 $k_y$。\n    *   空间滤波操作 $\\overline{\\phi}$ 通过将场 $\\phi$ 的二维 FFT 与高斯滤波器传递函数 $G(k_x, k_y) = \\exp(-\\frac{1}{2}\\sigma^2(k_x^2+k_y^2))$ 相乘，然后执行逆 FFT 来完成，其中 $\\sigma = \\Delta/2$。\n    *   空间导数，例如 $\\partial \\phi / \\partial x$，通过将 $\\phi$ 的 FFT 乘以 $i k_x$（其中 $i=\\sqrt{-1}$）并进行逆 FFT 来计算。\n3.  **先验分析循环**：对于每个指定的滤波器宽度 $\\Delta$：\n    a. 计算滤波器核的标准差 $\\sigma = \\Delta/2$。\n    b. 计算必要的滤波量：$\\overline{\\rho}$、$\\overline{\\rho u_x}$、$\\overline{\\rho u_y}$、$\\overline{\\rho u_x^2}$、$\\overline{\\rho u_y^2}$ 和 $\\overline{\\rho u_x u_y}$。\n    c. 确定 Favre 滤波后的速度 $\\tilde{u}_x$ 和 $\\tilde{u}_y$。\n    d. 计算精确的 SGS 应力张量分量 $\\tau_{xx}、\\tau_{yy}、\\tau_{xy}$，然后计算它们的偏量对应项 $\\tau_{xx}^d、\\tau_{yy}^d、\\tau_{xy}^d$。\n    e. 使用 $\\tilde{u}_x、\\tilde{u}_y$ 的谱方法微分计算 Favre 滤波后的应变率张量分量 $S_{xx}、S_{yy}、S_{xy}$。\n    f. 计算应变率大小 $|S|$ 和偏应变率张量 $S_{ij}^d$。\n    g. 计算 $C_s^2$ 表达式的分子 $\\mathcal{N} = \\sum_{\\text{grid}} \\tau_{ij}^d M_{ij}$ 和分母 $\\mathcal{D} = \\sum_{\\text{grid}} M_{ij}^2$，其中求和遍历所有网格点和张量分量。对分母应用 $10^{-12}$ 的数值容差。\n    h. 计算最优的 $C_s^2 = \\mathcal{N}/\\mathcal{D}$，并最终得到 Smagorinsky 常数 $C_s = \\sqrt{\\max(0, C_s^2)}$。\n对测试套件中的每个滤波器宽度重复此过程，得出一组最优常数。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Performs an a priori test to determine the optimal Smagorinsky constant.\n    \"\"\"\n    # 1. Synthetic DNS Data Generation\n    # Domain and Grid\n    Lx, Ly = 2 * np.pi, 2 * np.pi\n    Nx, Ny = 128, 128\n    dx, dy = Lx / Nx, Ly / Ny\n\n    x = np.linspace(0, Lx, Nx, endpoint=False)\n    y = np.linspace(0, Ly, Ny, endpoint=False)\n    X, Y = np.meshgrid(x, y)\n\n    # Wavenumbers for spectral methods\n    kx_vec = 2 * np.pi * np.fft.fftfreq(Nx, d=dx)\n    ky_vec = 2 * np.pi * np.fft.fftfreq(Ny, d=dy)\n    Kx, Ky = np.meshgrid(kx_vec, ky_vec)\n    K2 = Kx**2 + Ky**2\n    \n    # Parameters for the synthetic fields\n    U = 1.0\n    y0 = Ly / 2.0\n    theta = Ly / 20.0\n    theta_p = Ly / 18.0\n    theta_v = Ly / 16.0\n    Au = 0.15\n    Av = 0.10\n    kx_pert = 4.0\n    \n    rho1, rho2 = 1.0, 2.0\n    theta_rho = Ly / 22.0\n    w = Ly / 30.0\n    beta = 0.3\n\n    # Velocity fields\n    u_x = U * np.tanh((Y - y0) / theta) + Au * np.sin(kx_pert * X) * (1.0 / np.cosh((Y - y0) / theta_p))\n    u_y = Av * np.cos(kx_pert * X) * (1.0 / np.cosh((Y - y0) / theta_v))\n\n    # Density field\n    rho_mix = 0.5 * (rho1 + rho2) + 0.5 * (rho2 - rho1) * np.tanh((Y - y0) / theta_rho)\n    c = np.exp(-((Y - y0)**2) / w**2) * (0.5 + 0.5 * np.sin(kx_pert * X))\n    rho = rho_mix * (1 - beta * c)\n\n    # Helper functions for spectral operations\n    def spectral_filter(phi, filter_kernel):\n        return np.fft.ifft2(np.fft.fft2(phi) * filter_kernel).real\n\n    def spectral_grad(phi_hat, K_component):\n        return np.fft.ifft2(1j * K_component * phi_hat).real\n\n    # Test suite\n    test_alphas = [2.0, 4.0, 8.0, 16.0]\n    results = []\n\n    for alpha in test_alphas:\n        # 2. Filtering\n        delta = alpha * dx\n        sigma = delta / 2.0\n        \n        # Gaussian filter in Fourier space\n        filter_kernel = np.exp(-0.5 * sigma**2 * K2)\n        \n        # Filtered quantities\n        rho_bar = spectral_filter(rho, filter_kernel)\n        \n        rho_ux_bar = spectral_filter(rho * u_x, filter_kernel)\n        rho_uy_bar = spectral_filter(rho * u_y, filter_kernel)\n        \n        rho_ux_ux_bar = spectral_filter(rho * u_x * u_x, filter_kernel)\n        rho_uy_uy_bar = spectral_filter(rho * u_y * u_y, filter_kernel)\n        rho_ux_uy_bar = spectral_filter(rho * u_x * u_y, filter_kernel)\n\n        # Favre-filtered velocities\n        u_tilde_x = rho_ux_bar / rho_bar\n        u_tilde_y = rho_uy_bar / rho_bar\n\n        # 3. Exact SGS Stress Calculation\n        tau_xx = rho_ux_ux_bar / rho_bar - u_tilde_x**2\n        tau_yy = rho_uy_uy_bar / rho_bar - u_tilde_y**2\n        tau_xy = rho_ux_uy_bar / rho_bar - u_tilde_x * u_tilde_y\n        \n        tau_kk = tau_xx + tau_yy\n        tau_d_xx = tau_xx - 0.5 * tau_kk\n        tau_d_yy = tau_yy - 0.5 * tau_kk\n        tau_d_xy = tau_xy\n        tau_d_yx = tau_xy\n\n        # 4. Modeled Stress Calculation Components\n        # FFT of Favre-filtered velocities\n        u_tilde_x_hat = np.fft.fft2(u_tilde_x)\n        u_tilde_y_hat = np.fft.fft2(u_tilde_y)\n        \n        # Strain-rate tensor S_ij\n        S_xx = spectral_grad(u_tilde_x_hat, Kx)\n        S_yy = spectral_grad(u_tilde_y_hat, Ky)\n        S_xy = 0.5 * (spectral_grad(u_tilde_x_hat, Ky) + spectral_grad(u_tilde_y_hat, Kx))\n        S_yx = S_xy\n        \n        # Strain-rate magnitude |S|\n        S_mag = np.sqrt(2 * (S_xx**2 + S_yy**2 + 2 * S_xy**2))\n        \n        # Deviatoric strain-rate tensor S_ij^d\n        S_kk = S_xx + S_yy\n        S_d_xx = S_xx - 0.5 * S_kk\n        S_d_yy = S_yy - 0.5 * S_kk\n        S_d_xy = S_xy\n        S_d_yx = S_xy\n\n        # 5. Least-Squares Minimization\n        # Model basis tensor M_ij\n        model_prefactor = -2.0 * delta**2 * rho_bar * S_mag\n        M_xx = model_prefactor * S_d_xx\n        M_yy = model_prefactor * S_d_yy\n        M_xy = model_prefactor * S_d_xy\n        M_yx = M_xy\n\n        # Numerator and denominator for C_s^2\n        numerator = np.sum(tau_d_xx * M_xx + tau_d_yy * M_yy + tau_d_xy * M_xy + tau_d_yx * M_yx)\n        denominator = np.sum(M_xx**2 + M_yy**2 + M_xy**2 + M_yx**2)\n        \n        # 6. Compute Cs\n        if denominator  1e-12:\n            Cs2 = 0.0\n        else:\n            Cs2 = numerator / denominator\n        \n        Cs = np.sqrt(max(0.0, Cs2))\n        results.append(Cs)\n        \n    # Format and print output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "在掌握了如何校准一个恒定系数后，下一步是探索动态模型如何通过适应局部流动条件来改进预测。本实践将焦点从动量输运转向对燃烧至关重要的标量输运，并演示如何为湍流施密特数（turbulent Schmidt number）实现一个动态计算流程 ``。通过这个练习，您将清晰地看到亚格子尺度（SGS）模型的选择如何直接影响对标量耗散率 $\\chi$ 的预测，并最终影响对火焰熄火这一物理现象的判断。",
            "id": "4063980",
            "problem": "你的任务是实现一个数值分析，在采用 Smagorinsky 闭合模型的大涡模拟 (LES) 框架内，比较恒定湍流施密特数和动态计算湍流施密特数对具有差异扩散的对冲射流火焰中标量耗散率和熄火的影响。评估必须使用解析梯度、滤波宽度和标量通量的 Leonard 项在一个局部点上进行。\n\n基本原理：\n- 从混合分数的滤波输运方程以及根据有效扩散系数和解析梯度模长定义的标量耗散率开始。标量耗散率定义为 $\\chi = 2 D_{\\mathrm{eff}} \\|\\nabla Z\\|^2,$ 其中 $D_{\\mathrm{eff}} = D_{\\mathrm{m}} + D_{\\mathrm{t}}$，$D_{\\mathrm{m}}$ 是分子扩散系数，$D_{\\mathrm{t}}$ 是亚格子尺度涡扩散系数，$\\nabla Z$ 是解析混合分数梯度向量。$\\chi$ 的单位必须以 $\\mathrm{s}^{-1}$ 表示。\n- 使用 Smagorinsky 模型对亚格子涡粘性系数进行建模，即 $\\nu_{\\mathrm{t}} = (C_{\\mathrm{s}} \\Delta)^2 \\|S\\|,$ 其中 $C_{\\mathrm{s}}$ 是 Smagorinsky 常数，$\\Delta$ 是 LES 滤波宽度，$\\|S\\|$ 是解析应变率张量的模长，由解析速度梯度张量 $G$ 通过 $S = (G + G^{\\top})/2$ 和 $\\|S\\| = \\sqrt{2 S_{ij}S_{ij}}$ 计算得出。\n- 对于恒定湍流施密特数情况，取 $D_{\\mathrm{t,const}} = \\frac{\\nu_{\\mathrm{t}}}{Sc_{\\mathrm{t,const}}}.$\n- 对于动态湍流施密特数情况，使用基于 Germano 恒等式的亚格子标量通量动态标量模型。建模的亚格子通量为 $q_i = -D_{\\mathrm{t}}\\,\\partial Z/\\partial x_i$，其中 $D_{\\mathrm{t}} = C_{\\kappa}\\,\\Delta^2\\,\\|S\\|$。在宽度为 $\\tilde{\\Delta} = \\alpha\\,\\Delta$ 的测试滤波器下，Leonard 项 $L_i$ 和模型一致性导致 $L_i \\approx - C_{\\kappa} M_i,$ 其中 $M_i = (\\alpha^2 - 1) \\Delta^2 \\|S\\| \\frac{\\partial Z}{\\partial x_i}.$ 计算动态标量系数 $C_{\\kappa} = -\\frac{\\sum_i L_i M_i}{\\sum_i M_i^2},$ 并通过设置 $C_{\\kappa} = \\max(C_{\\kappa}, 0)$ 来强制其非负，以避免非物理的负扩散系数。然后使用 $D_{\\mathrm{t,dyn}} = C_{\\kappa} \\Delta^2 \\|S\\|.$\n- 使用基于刘易斯数的关系式对分子扩散系数进行建模：$D_{\\mathrm{m}} = \\frac{D_{\\mathrm{ref}}}{Le},$ 其中 $D_{\\mathrm{ref}}$ 是一个参考分子扩散系数，$Le$ 是（有效）刘易斯数，用于解释差异扩散效应。\n- 通过化学计量平面上的 Damköhler 数来定义熄火，使用混合时间尺度 $\\tau_{\\mathrm{mix}} = 1/\\chi$ 和给定的局部化学时间尺度 $\\tau_{\\mathrm{chem}}$（单位为 $\\mathrm{s}$）。如果 $Da = \\frac{\\tau_{\\mathrm{mix}}}{\\tau_{\\mathrm{chem}}}  1,$ 即等效于 $\\chi \\tau_{\\mathrm{chem}} > 1,$ 则认为发生熄火。返回一个指示是否熄火的布尔值。\n\n任务：\n- 为每个测试用例实现一个程序，计算：\n  - 由速度梯度张量 $G$ 计算出的解析应变率模长 $\\|S\\|$，\n  - 使用 Smagorinsky 模型计算的亚格子涡粘性系数 $\\nu_{\\mathrm{t}}$，\n  - 恒定情况下的涡扩散系数 $D_{\\mathrm{t,const}}$，\n  - 通过上述动态标量模型计算的动态情况下的涡扩散系数 $D_{\\mathrm{t,dyn}}$，\n  - 标量耗散率 $\\chi_{\\mathrm{const}}$ 和 $\\chi_{\\mathrm{dyn}}$ (单位为 $\\mathrm{s}^{-1}$)，\n  - 以及基于准则 $\\chi\\,\\tau_{\\mathrm{chem}} > 1$ 的恒定和动态情况下的熄火布尔值。\n\n单位：\n- 以 $\\mathrm{s}^{-1}$ 报告 $\\chi$。\n- 使用 $D_{\\mathrm{ref}}$ 单位为 $\\mathrm{m}^2/\\mathrm{s}$，$\\Delta$ 单位为 $\\mathrm{m}$，$\\|S\\|$ 和 $G$ 的条目单位为 $\\mathrm{s}^{-1}$，梯度 $\\nabla Z$ 单位为 $\\mathrm{m}^{-1}$。\n\n输入测试套件：\n- 程序必须使用以下四个测试用例集，每个用例由 $(G,\\,\\nabla Z,\\,\\Delta,\\,\\alpha,\\,C_{\\mathrm{s}},\\,Sc_{\\mathrm{t,const}},\\,D_{\\mathrm{ref}},\\,Le,\\,L,\\,\\tau_{\\mathrm{chem}})$ 指定，其中 $G$ 是一个 $3\\times 3$ 矩阵，$\\nabla Z$ 和 $L$ 是 $3$ 维向量：\n  1. 案例 1 (中等应变，弱差异扩散，理想情况)：\n     - $G = \\begin{bmatrix} 0  400  0 \\\\ 0  0  0 \\\\ 0  0  0 \\end{bmatrix}\\,(\\mathrm{s}^{-1})$，\n     - $\\nabla Z = \\begin{bmatrix} 100 \\\\ 0 \\\\ 0 \\end{bmatrix}\\,(\\mathrm{m}^{-1})$，\n     - $\\Delta = 1.0\\times 10^{-3}\\,(\\mathrm{m})$，\n     - $\\alpha = 2.0$，\n     - $C_{\\mathrm{s}} = 0.17$，\n     - $Sc_{\\mathrm{t,const}} = 0.7$，\n     - $D_{\\mathrm{ref}} = 1.5\\times 10^{-5}\\,(\\mathrm{m}^2/\\mathrm{s})$，\n     - $Le = 1.2$，\n     - $L = \\begin{bmatrix} -1.0\\times 10^{-4} \\\\ 0 \\\\ 0 \\end{bmatrix}$，\n     - $\\tau_{\\mathrm{chem}} = 1.0\\times 10^{-2}\\,(\\mathrm{s})$。\n  2. 案例 2 (接近零的标量梯度，边界情况)：\n     - $G = \\begin{bmatrix} 0  400  0 \\\\ 0  0  0 \\\\ 0  0  0 \\end{bmatrix}\\,(\\mathrm{s}^{-1})$，\n     - $\\nabla Z = \\begin{bmatrix} 1.0\\times 10^{-2} \\\\ 0 \\\\ 0 \\end{bmatrix}\\,(\\mathrm{m}^{-1})$，\n     - $\\Delta = 1.0\\times 10^{-3}\\,(\\mathrm{m})$，\n     - $\\alpha = 2.0$，\n     - $C_{\\mathrm{s}} = 0.17$，\n     - $Sc_{\\mathrm{t,const}} = 0.7$，\n     - $D_{\\mathrm{ref}} = 1.5\\times 10^{-5}\\,(\\mathrm{m}^2/\\mathrm{s})$，\n     - $Le = 1.2$，\n     - $L = \\begin{bmatrix} -1.0\\times 10^{-6} \\\\ 0 \\\\ 0 \\end{bmatrix}$，\n     - $\\tau_{\\mathrm{chem}} = 1.0\\times 10^{-2}\\,(\\mathrm{s})$。\n  3. 案例 3 (高应变，强差异扩散，预期熄火)：\n     - $G = \\begin{bmatrix} 0  800  0 \\\\ 0  0  0 \\\\ 0  0  0 \\end{bmatrix}\\,(\\mathrm{s}^{-1})$，\n     - $\\nabla Z = \\begin{bmatrix} 500 \\\\ 0 \\\\ 0 \\end{bmatrix}\\,(\\mathrm{m}^{-1})$，\n     - $\\Delta = 8.0\\times 10^{-4}\\,(\\mathrm{m})$，\n     - $\\alpha = 2.0$，\n     - $C_{\\mathrm{s}} = 0.17$，\n     - $Sc_{\\mathrm{t,const}} = 0.7$，\n     - $D_{\\mathrm{ref}} = 1.5\\times 10^{-5}\\,(\\mathrm{m}^2/\\mathrm{s})$，\n     - $Le = 2.0$，\n     - $L = \\begin{bmatrix} -5.0\\times 10^{-2} \\\\ 0 \\\\ 0 \\end{bmatrix}$，\n     - $\\tau_{\\mathrm{chem}} = 1.0\\times 10^{-1}\\,(\\mathrm{s})$。\n  4. 案例 4 (动态系数为负的场景，裁剪边界情况)：\n     - $G = \\begin{bmatrix} 0  300  0 \\\\ 0  0  0 \\\\ 0  0  0 \\end{bmatrix}\\,(\\mathrm{s}^{-1})$，\n     - $\\nabla Z = \\begin{bmatrix} 200 \\\\ 0 \\\\ 0 \\end{bmatrix}\\,(\\mathrm{m}^{-1})$，\n     - $\\Delta = 1.0\\times 10^{-3}\\,(\\mathrm{m})$，\n     - $\\alpha = 2.0$，\n     - $C_{\\mathrm{s}} = 0.17$，\n     - $Sc_{\\mathrm{t,const}} = 0.7$，\n     - $D_{\\mathrm{ref}} = 1.5\\times 10^{-5}\\,(\\mathrm{m}^2/\\mathrm{s})$，\n     - $Le = 0.8$，\n     - $L = \\begin{bmatrix} 1.0\\times 10^{-2} \\\\ 0 \\\\ 0 \\end{bmatrix}$，\n     - $\\tau_{\\mathrm{chem}} = 2.0\\times 10^{-2}\\,(\\mathrm{s})$。\n\n输出规格：\n- 对于每个案例，返回一个包含四个值的列表 $[\\chi_{\\mathrm{const}},\\,\\chi_{\\mathrm{dyn}},\\,\\mathrm{ext}_{\\mathrm{const}},\\,\\mathrm{ext}_{\\mathrm{dyn}}]$，其中 $\\chi_{\\mathrm{const}}$ 和 $\\chi_{\\mathrm{dyn}}$ 是以 $\\mathrm{s}^{-1}$ 为单位的浮点数，而 $\\mathrm{ext}_{\\mathrm{const}}$ 和 $\\mathrm{ext}_{\\mathrm{dyn}}$ 是布尔值。\n- 您的程序应生成一行输出，其中包含所有测试用例的结果，形式为一个逗号分隔的列表，该列表包含上述各个列表，并用方括号括起来，例如 $[[\\chi_{\\mathrm{const},1},\\,\\chi_{\\mathrm{dyn},1},\\,\\mathrm{ext}_{\\mathrm{const},1},\\,\\mathrm{ext}_{\\mathrm{dyn},1}],\\ldots].$",
            "solution": "问题陈述已经过严格审查，并被确定为有效。它在科学上基于计算流体动力学和燃烧模拟的原理，特别是大涡模拟（LES）。所有必需的方程、参数和数据均已提供，构成了一个适定、客观且可形式化的问题。不存在内部矛盾、不可靠的前提或歧义。\n\n任务是执行局部分析，比较 LES 环境下两种亚格子尺度（SGS）标量输运模型：一种是假设湍流施密特数（$Sc_{\\mathrm{t}}$）恒定的标准模型，另一种是模型系数基于解析流场量计算的动态模型。比较的核心是计算标量耗散率 $\\chi$，这是燃烧学中的一个关键量，它衡量最小尺度上的分子混合速率并控制反应速率。该分析还包括对局部火焰熄火的评估。\n\n该解决方案按照所提供的模型定义，逐步计算所需量。\n\n**1. 公共量**\n\n某些量是两种模型的基础，因此首先计算。这些量包括解析应变率张量模长 $\\|\\boldsymbol{S}\\|$ 和分子扩散系数 $D_{\\mathrm{m}}$。\n\n解析应变率张量 $\\boldsymbol{S}$ 是解析速度梯度张量 $\\boldsymbol{G}$ 的对称部分：\n$$S = \\frac{1}{2}\\left(G + G^{\\top}\\right)$$\n其模长定义为：\n$$\\|S\\| = \\sqrt{2 S_{ij}S_{ij}} = \\sqrt{2 \\sum_{i=1}^{3}\\sum_{j=1}^{3} S_{ij}^2}$$\n该量表征了解析尺度上流体微元的变形速率，并驱动亚格子湍流的产生。\n\n分子扩散系数 $D_{\\mathrm{m}}$ 基于参考扩散系数 $D_{\\mathrm{ref}}$ 和刘易斯数 $Le$ 进行建模，$Le$ 代表热扩散率与质量扩散率之比。该公式考虑了差异扩散效应，即不同物质（或热量）以不同速率扩散。\n$$D_{\\mathrm{m}} = \\frac{D_{\\mathrm{ref}}}{Le}$$\n\n**2. 恒定湍流施密特数模型**\n\n此方法通过一个恒定的湍流施密特数 $Sc_{\\mathrm{t,const}}$，将亚格子涡扩散系数 $D_{\\mathrm{t}}$ 建模为与亚格子涡粘性系数 $\\nu_{\\mathrm{t}}$ 成正比。\n\n首先，使用 Smagorinsky 模型计算涡粘性系数：\n$$\\nu_{\\mathrm{t}} = \\left(C_{\\mathrm{s}}\\,\\Delta\\right)^2\\,\\|S\\|$$\n其中 $C_{\\mathrm{s}}$ 是 Smagorinsky 常数，$\\Delta$ 是 LES 滤波宽度。\n\n然后，恒定情况下的涡扩散系数 $D_{\\mathrm{t,const}}$ 为：\n$$D_{\\mathrm{t,const}} = \\frac{\\nu_{\\mathrm{t}}}{Sc_{\\mathrm{t,const}}}$$\n总有效扩散系数是分子和湍流贡献的总和：\n$$D_{\\mathrm{eff,const}} = D_{\\mathrm{m}} + D_{\\mathrm{t,const}}$$\n\n最后，对于恒定 $Sc_{\\mathrm{t}}$ 模型，标量耗散率计算如下：\n$$\\chi_{\\mathrm{const}} = 2\\,D_{\\mathrm{eff,const}}\\,\\|\\nabla Z\\|^2$$\n其中 $\\|\\nabla Z\\|^2 = \\sum_{i=1}^{3} \\left(\\frac{\\partial Z}{\\partial x_i}\\right)^2$ 是解析混合分数梯度的模长平方。\n\n**3. 动态湍流施密特数模型**\n\n动态模型通过从解析流场中动态计算模型系数，避免了 $Sc_{\\mathrm{t}}$ 恒定的假设。涡扩散系数建模为：\n$$D_{\\mathrm{t}} = C_{\\kappa}\\,\\Delta^2\\,\\|S\\|$$\n动态系数 $C_{\\kappa}$ 使用 Germano 恒等式确定，该恒等式关联了两个不同滤波水平（网格滤波器 $\\Delta$ 和测试滤波器 $\\tilde{\\Delta} = \\alpha\\,\\Delta$）上的亚格子应力。这导出了一个关于 $C_{\\kappa}$ 的代数方程：\n$$C_{\\kappa} = -\\frac{\\sum_i L_i M_i}{\\sum_i M_i^2}$$\n其中 $L_i$ 是 Leonard 项，代表亚格子标量通量的解析部分，$M_i$ 是从模型形式推导出的项：\n$$M_i = \\left(\\alpha^2 - 1\\right)\\,\\Delta^2\\,\\|S\\|\\,\\frac{\\partial Z}{\\partial x_i}$$\n求和是针对空间维度 $i \\in \\{1, 2, 3\\}$ 进行的。为确保物理真实性（即湍流增强混合），计算出的系数在零处进行裁剪：\n$$C_{\\kappa} = \\max\\left(C_{\\kappa, \\text{computed}},\\,0\\right)$$\n得到 $C_{\\kappa}=0$ 的值意味着模型预测没有湍流标量输运（如果未裁剪值为负，则此情景称为“反向散射”），在亚格子尺度上只剩下分子扩散。\n\n一旦确定了 $C_{\\kappa}$，动态涡扩散系数 $D_{\\mathrm{t,dyn}}$ 为：\n$$D_{\\mathrm{t,dyn}} = C_{\\kappa}\\,\\Delta^2\\,\\|S\\|$$\n总有效扩散系数为：\n$$D_{\\mathrm{eff,dyn}} = D_{\\mathrm{m}} + D_{\\mathrm{t,dyn}}$$\n而相应的标量耗散率为：\n$$\\chi_{\\mathrm{dyn}} = 2\\,D_{\\mathrm{eff,dyn}}\\,\\|\\nabla Z\\|^2$$\n\n**4. 熄火准则**\n\n火焰熄火通过 Damköhler 数 $Da$ 进行评估，该数定义为特征混合时间尺度 $\\tau_{\\mathrm{mix}}$ 与化学时间尺度 $\\tau_{\\mathrm{chem}}$ 之比。混合时间取为标量耗散率的倒数，即 $\\tau_{\\mathrm{mix}} = 1/\\chi$。当混合比化学反应快时，即 $Da  1$ 时，发生熄火。该条件等效于：\n$$\\frac{\\tau_{\\mathrm{mix}}}{\\tau_{\\mathrm{chem}}}  1 \\implies \\frac{1}{\\chi\\,\\tau_{\\mathrm{chem}}}  1 \\implies \\chi\\,\\tau_{\\mathrm{chem}} > 1$$\n对于每个模型，我们评估此条件以确定熄火布尔值（如果发生熄火则为 $True$，否则为 $False$）。对于恒定 $Sc_{\\mathrm{t}}$ 的情况，检查条件为 $\\chi_{\\mathrm{const}}\\,\\tau_{\\mathrm{chem}} > 1$；对于动态情况，检查条件为 $\\chi_{\\mathrm{dyn}}\\,\\tau_{\\mathrm{chem}} > 1$。\n\n所提供的代码为问题陈述中指定的四个测试用例中的每一个都实现了这些计算，得出了两种亚格子尺度模型的标量耗散率和熄火状态。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes scalar dissipation rates and extinction for constant and dynamic\n    turbulent Schmidt number models in LES.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: moderate strain, mild differential diffusion, happy path\n        {\n            \"G\": np.array([[0, 400, 0], [0, 0, 0], [0, 0, 0]], dtype=float),\n            \"nabla_Z\": np.array([100, 0, 0], dtype=float),\n            \"Delta\": 1.0e-3,\n            \"alpha\": 2.0,\n            \"C_s\": 0.17,\n            \"Sc_t_const\": 0.7,\n            \"D_ref\": 1.5e-5,\n            \"Le\": 1.2,\n            \"L\": np.array([-1.0e-4, 0, 0], dtype=float),\n            \"tau_chem\": 1.0e-2,\n        },\n        # Case 2: near-zero scalar gradient, boundary case\n        {\n            \"G\": np.array([[0, 400, 0], [0, 0, 0], [0, 0, 0]], dtype=float),\n            \"nabla_Z\": np.array([1.0e-2, 0, 0], dtype=float),\n            \"Delta\": 1.0e-3,\n            \"alpha\": 2.0,\n            \"C_s\": 0.17,\n            \"Sc_t_const\": 0.7,\n            \"D_ref\": 1.5e-5,\n            \"Le\": 1.2,\n            \"L\": np.array([-1.0e-6, 0, 0], dtype=float),\n            \"tau_chem\": 1.0e-2,\n        },\n        # Case 3: high strain, strong differential diffusion, extinction expected\n        {\n            \"G\": np.array([[0, 800, 0], [0, 0, 0], [0, 0, 0]], dtype=float),\n            \"nabla_Z\": np.array([500, 0, 0], dtype=float),\n            \"Delta\": 8.0e-4,\n            \"alpha\": 2.0,\n            \"C_s\": 0.17,\n            \"Sc_t_const\": 0.7,\n            \"D_ref\": 1.5e-5,\n            \"Le\": 2.0,\n            \"L\": np.array([-5.0e-2, 0, 0], dtype=float),\n            \"tau_chem\": 1.0e-1,\n        },\n        # Case 4: negative dynamic coefficient scenario, clipping edge case\n        {\n            \"G\": np.array([[0, 300, 0], [0, 0, 0], [0, 0, 0]], dtype=float),\n            \"nabla_Z\": np.array([200, 0, 0], dtype=float),\n            \"Delta\": 1.0e-3,\n            \"alpha\": 2.0,\n            \"C_s\": 0.17,\n            \"Sc_t_const\": 0.7,\n            \"D_ref\": 1.5e-5,\n            \"Le\": 0.8,\n            \"L\": np.array([1.0e-2, 0, 0], dtype=float),\n            \"tau_chem\": 2.0e-2,\n        },\n    ]\n\n    def solve_case(case):\n        # Unpack case parameters\n        G = case[\"G\"]\n        nabla_Z = case[\"nabla_Z\"]\n        Delta = case[\"Delta\"]\n        alpha = case[\"alpha\"]\n        C_s = case[\"C_s\"]\n        Sc_t_const = case[\"Sc_t_const\"]\n        D_ref = case[\"D_ref\"]\n        Le = case[\"Le\"]\n        L = case[\"L\"]\n        tau_chem = case[\"tau_chem\"]\n\n        # 1. Common calculations\n        S = 0.5 * (G + G.T)\n        S_mag = np.sqrt(2 * np.sum(S**2))\n        D_m = D_ref / Le\n        nabla_Z_mag_sq = np.sum(nabla_Z**2)\n\n        # 2. Constant Sc_t model\n        nu_t = (C_s * Delta)**2 * S_mag\n        D_t_const = nu_t / Sc_t_const\n        D_eff_const = D_m + D_t_const\n        chi_const = 2 * D_eff_const * nabla_Z_mag_sq\n        ext_const = (chi_const * tau_chem) > 1\n\n        # 3. Dynamic Sc_t model\n        M = (alpha**2 - 1) * Delta**2 * S_mag * nabla_Z\n        \n        C_kappa_num = -np.dot(L, M)\n        C_kappa_den = np.dot(M, M)\n\n        if C_kappa_den == 0:\n            # If M is zero (e.g., zero scalar gradient), C_kappa is indeterminate (0/0).\n            # Physically, no scalar gradient means no subgrid flux, so C_kappa is effectively 0.\n            C_kappa_unclipped = 0.0\n        else:\n            C_kappa_unclipped = C_kappa_num / C_kappa_den\n        \n        C_kappa = max(0.0, C_kappa_unclipped)\n        \n        D_t_dyn = C_kappa * Delta**2 * S_mag\n        D_eff_dyn = D_m + D_t_dyn\n        chi_dyn = 2 * D_eff_dyn * nabla_Z_mag_sq\n        ext_dyn = (chi_dyn * tau_chem) > 1\n\n        return [chi_const, chi_dyn, ext_const, ext_dyn]\n\n    results = []\n    for case in test_cases:\n        result = solve_case(case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The default string representation of a list of lists matches the required format.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "一个优秀的亚格子模型不仅要能准确预测应力和通量，还必须在物理上保持一致性，尤其是在能量方面。最后一个实践将视角提升到系统层面，检验Smagorinsky模型作为能量从大尺度向未解析尺度级联过程的物理体现 ``。您将为一个模拟燃烧室构建一个全局能量平衡诊断程序，通过量化亚格子黏性耗散项，来识别可能由模型或数值方法引入的能量不平衡，从而深化对SGS模型物理意义的理解。",
            "id": "4063907",
            "problem": "给定一个假设的低马赫数反应燃烧室的大涡模拟 (LES)，该燃烧室具有绝热壁面、一个入口和一个出口。域被离散为均匀的控制体，模拟推进一个与能量守恒一致的滤波后总能量。你的任务是构建一个程序化诊断工具，用于检查全局能量平衡，包括由经典 Smagorinsky 模型和动态 Smagorinsky 模型建模的亚格子尺度 (SGS) 贡献，并识别可归因于模型或数值误差的差异。\n\n推理起点：可压缩流动的总能量守恒及其滤波后的大涡模拟 (LES) 对应形式，以及涡粘性闭合中亚格子尺度应力的定义，还有应变率与耗散之间的关系。不要假设任何不能从这些原理推导出的简化公式。\n\n诊断的假设：\n- 边界是绝热的，且边界上的粘性功可以忽略不计。\n- 唯一的外部能量交换是通过入口和出口处的净解析对流能量通量以及域内的体积化学热释放。\n- 亚格子尺度热传导仅作为边界通量出现，在绝热壁面下该通量为零，因此 SGS 对解析总能量的体积贡献完全来自 SGS 粘性耗散。\n- 解析应变率的大小由 $S_{\\mathrm{mag}}$ 给出，定义为 $S_{\\mathrm{mag}} = \\sqrt{2 S_{ij} S_{ij}}$。\n- Smagorinsky 涡粘性使用一个恒定系数 $C_s$ 和滤波宽度 $\\Delta$；动态 Smagorinsky 模型使用一个空间变化的系数 $C_d$，并可选择进行非负裁剪以强制纯耗散行为。\n\n将全局平衡残差 $R$ 定义为在给定 SGS 闭合下，域内解析总能量的瞬时变化率与由净解析边界能量通量、体积化学热释放以及减去建模的 SGS 粘性耗散所构成的右侧项之间的差值。以瓦特 ($\\mathrm{W}$) 为单位表示 $R$。\n\n你的程序必须：\n- 对于每个测试用例，根据提供的数据计算全局 SGS 粘性耗散，然后计算两个残差：一个使用恒定 Smagorinsky 系数 ($C_s$)，另一个使用裁剪为非负的动态系数 ($C_d$)。\n- 对于每个测试用例，返回一个列表，其中包含 Smagorinsky 残差、裁剪后的动态 Smagorinsky 残差，以及一个布尔标志，如果裁剪后的动态残差的绝对值小于或等于指定的容差，则为 $\\,\\mathrm{True}\\,$，否则为 $\\,\\mathrm{False}\\,$。\n- 所有结果必须以瓦特 ($\\mathrm{W}$) 为单位。\n\n单位和输入：\n- 单元体积 $V_{\\mathrm{cell}}$，单位为 $\\mathrm{m}^3$。\n- 滤波宽度 $\\Delta$，单位为 $\\mathrm{m}$。\n- 密度数组 $\\rho_i$，单位为 $\\mathrm{kg}/\\mathrm{m}^3$。\n- 应变率大小数组 $S_{\\mathrm{mag},i}$，单位为 $\\mathrm{s}^{-1}$。\n- Smagorinsky 系数 $C_s$（无量纲）。\n- 动态 Smagorinsky 系数数组 $C_{d,i}$（无量纲）。\n- 入口解析对流能量通量 $F_{\\mathrm{in}}$，单位为 $\\mathrm{W}$。\n- 出口解析对流能量通量 $F_{\\mathrm{out}}$，单位为 $\\mathrm{W}$。\n- 在域上积分的体积化学热释放率 $Q_{\\mathrm{tot}}$，单位为 $\\mathrm{W}$。\n- 域内解析总能量的瞬时变化率 $\\mathrm{d}E/\\mathrm{d}t$，单位为 $\\mathrm{W}$。\n- 容差 $\\mathrm{tol}$，单位为 $\\mathrm{W}$。\n\n测试套件（每个用例都是独立的；数组按单元排序）：\n1. 理想情况，中等湍流，绝热壁面：\n   - $V_{\\mathrm{cell}} = 0.02$, $\\Delta = 0.05$, $\\rho = [1.2, 1.18, 1.22, 1.19]$, $S_{\\mathrm{mag}} = [400.0, 450.0, 420.0, 430.0]$, $C_s = 0.18$, $C_d = [0.16, 0.20, 0.17, 0.19]$, $F_{\\mathrm{in}} = 2600.0$, $F_{\\mathrm{out}} = 1800.0$, $Q_{\\mathrm{tot}} = 500.0$, $\\mathrm{d}E/\\mathrm{d}t = 705.0$, $\\mathrm{tol} = 25.0$。\n2. 零应变率的边界情况（无 SGS 耗散）：\n   - $V_{\\mathrm{cell}} = 0.02$, $\\Delta = 0.03$, $\\rho = [1.0, 1.0, 1.0, 1.0]$, $S_{\\mathrm{mag}} = [0.0, 0.0, 0.0, 0.0]$, $C_s = 0.18$, $C_d = [0.0, 0.0, 0.0, 0.0]$, $F_{\\mathrm{in}} = 1000.0$, $F_{\\mathrm{out}} = 800.0$, $Q_{\\mathrm{tot}} = 150.0$, $\\mathrm{d}E/\\mathrm{d}t = 350.0$, $\\mathrm{tol} = 0.5$。\n3. 大的常数 $C_s$ 产生强耗散的高应变情况：\n   - $V_{\\mathrm{cell}} = 0.015$, $\\Delta = 0.06$, $\\rho = [0.95, 0.90, 0.92, 0.94]$, $S_{\\mathrm{mag}} = [650.0, 700.0, 680.0, 660.0]$, $C_s = 0.18$, $C_d = [0.12, 0.15, 0.14, 0.13]$, $F_{\\mathrm{in}} = 4000.0$, $F_{\\mathrm{out}} = 3000.0$, $Q_{\\mathrm{tot}} = 600.0$, $\\mathrm{d}E/\\mathrm{d}t = -380.0$, $\\mathrm{tol} = 10.0$。\n4. 具有负系数的动态模型（裁剪为非负）：\n   - $V_{\\mathrm{cell}} = 0.03$, $\\Delta = 0.04$, $\\rho = [1.1, 1.05, 1.08, 1.06]$, $S_{\\mathrm{mag}} = [300.0, 350.0, 320.0, 310.0]$, $C_s = 0.17$, $C_d = [-0.10, 0.05, -0.02, 0.0]$, $F_{\\mathrm{in}} = 1800.0$, $F_{\\mathrm{out}} = 1300.0$, $Q_{\\mathrm{tot}} = 400.0$, $\\mathrm{d}E/\\mathrm{d}t = 895.0$, $\\mathrm{tol} = 3.0$。\n5. 小滤波宽度（弱 SGS 耗散）的灵敏度：\n   - $V_{\\mathrm{cell}} = 0.01$, $\\Delta = 0.01$, $\\rho = [1.2, 1.21, 1.19, 1.18, 1.20]$, $S_{\\mathrm{mag}} = [200.0, 220.0, 210.0, 205.0, 215.0]$, $C_s = 0.18$, $C_d = [0.17, 0.16, 0.18, 0.17, 0.15]$, $F_{\\mathrm{in}} = 1200.0$, $F_{\\mathrm{out}} = 1050.0$, $Q_{\\mathrm{tot}} = 130.0$, $\\mathrm{d}E/\\mathrm{d}t = 260.0$, $\\mathrm{tol} = 15.0$。\n\n要求的最终输出格式：\n- 你的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。\n- 每个测试用例的结果本身必须是一个形如 $[R_{\\mathrm{Smag}}, R_{\\mathrm{DynClip}}, \\mathrm{flag}]$ 的列表，其中 $R_{\\mathrm{Smag}}$ 和 $R_{\\mathrm{DynClip}}$ 是以瓦特为单位的浮点数，$\\mathrm{flag}$ 是布尔值。\n- 顶层格式示例：$[[r_1^{\\mathrm{Smag}}, r_1^{\\mathrm{Dyn}}, \\mathrm{True}], [r_2^{\\mathrm{Smag}}, r_2^{\\mathrm{Dyn}}, \\mathrm{False}], \\dots]$。",
            "solution": "我们从可压缩流动的总能量守恒开始。守恒形式的未滤波总能量方程为\n$$\n\\frac{\\partial}{\\partial t} (\\rho E) + \\nabla \\cdot (\\rho E \\mathbf{u} + p \\mathbf{u}) = \\nabla \\cdot (\\boldsymbol{\\tau} \\cdot \\mathbf{u} - \\mathbf{q}) + \\rho \\dot{q},\n$$\n其中 $\\rho$ 是密度，$E = e + \\tfrac{1}{2} |\\mathbf{u}|^2$ 是比总能（内能 $e$ 加动能），$\\mathbf{u}$ 是速度，$p$ 是压力，$\\boldsymbol{\\tau}$ 是粘性应力，$\\mathbf{q}$ 是热通量，$\\dot{q}$ 是每单位质量的体积化学热释放。在大涡模拟 (LES) 的空间滤波下，我们得到解析量的滤波方程，该方程由于未解析的脉动而引入了亚格子尺度 (SGS) 项。为简洁起见，用上划线表示滤波后的变量并忽略密度加权的复杂性，滤波后的总能量方程可以示意性地表示为\n$$\n\\frac{\\partial}{\\partial t} (\\bar{\\rho} \\bar{E}) + \\nabla \\cdot (\\bar{\\rho} \\bar{E}\\, \\bar{\\mathbf{u}} + \\bar{p} \\,\\bar{\\mathbf{u}}) = \\nabla \\cdot (\\boldsymbol{\\tau}_{\\mathrm{res}} \\cdot \\bar{\\mathbf{u}} - \\mathbf{q}_{\\mathrm{res}}) - \\nabla \\cdot (\\boldsymbol{\\tau}_{\\mathrm{sgs}} \\cdot \\bar{\\mathbf{u}} - \\mathbf{q}_{\\mathrm{sgs}}) - \\boldsymbol{\\tau}_{\\mathrm{sgs}} : \\bar{\\nabla \\mathbf{u}} + \\bar{\\rho} \\,\\bar{\\dot{q}},\n$$\n其中 $\\boldsymbol{\\tau}_{\\mathrm{res}}$ 和 $\\mathbf{q}_{\\mathrm{res}}$ 是解析的粘性应力和热通量，$\\boldsymbol{\\tau}_{\\mathrm{sgs}}$ 和 $\\mathbf{q}_{\\mathrm{sgs}}$ 是 SGS 应力和热通量闭合项。双点积 $-\\boldsymbol{\\tau}_{\\mathrm{sgs}} : \\bar{\\nabla \\mathbf{u}}$ 表示从解析尺度到亚格子尺度的能量传递（解析能量的耗散）。在绝热壁面下，$\\mathbf{q}_{\\mathrm{res}}$ 和 $\\mathbf{q}_{\\mathrm{sgs}}$ 不产生净边界通量。根据假设，边界上的粘性功可以忽略不计。\n\n在域体积 $V$ 上积分并应用散度定理可得全局平衡：\n$$\n\\frac{d}{dt} \\int_V \\bar{\\rho} \\bar{E} \\, dV\n= \\underbrace{ \\oint_{\\partial V} \\mathbf{n} \\cdot (\\bar{\\rho} \\bar{E}\\, \\bar{\\mathbf{u}} + \\bar{p}\\, \\bar{\\mathbf{u}}) \\, dA }_{\\text{解析的对流/功率通量}}\n+ \\underbrace{\\int_V \\bar{\\rho} \\, \\bar{\\dot{q}} \\, dV}_{\\text{化学热释放}}\n\\; - \\; \\underbrace{\\int_V \\boldsymbol{\\tau}_{\\mathrm{sgs}} : \\bar{\\nabla \\mathbf{u}} \\, dV}_{\\text{SGS 粘性耗散}}。\n$$\n对于一个入口和一个出口，我们用给定的净解析能量通量 $F_{\\mathrm{in}} - F_{\\mathrm{out}}$ 来建模边界积分。将解析能量时间导数记为 $\\frac{dE}{dt} = \\frac{d}{dt} \\int_V \\bar{\\rho} \\bar{E} \\, dV$，积分化学源记为 $Q_{\\mathrm{tot}} = \\int_V \\bar{\\rho} \\, \\bar{\\dot{q}} \\, dV$，SGS 粘性耗散记为 $\\varepsilon_{\\mathrm{sgs}} = \\int_V \\boldsymbol{\\tau}_{\\mathrm{sgs}} : \\bar{\\nabla \\mathbf{u}} \\, dV$（对于纯耗散闭合项为非负）。那么\n$$\n\\frac{dE}{dt} = (F_{\\mathrm{in}} - F_{\\mathrm{out}}) + Q_{\\mathrm{tot}} - \\varepsilon_{\\mathrm{sgs}}。\n$$\n诊断残差为\n$$\nR = \\frac{dE}{dt} - \\left[(F_{\\mathrm{in}} - F_{\\mathrm{out}}) + Q_{\\mathrm{tot}} - \\varepsilon_{\\mathrm{sgs}}\\right],\n$$\n在精确计算和完美建模的情况下，该值应为 $0$；偏差表示模型或数值误差。\n\n为计算 $\\varepsilon_{\\mathrm{sgs}}$，我们采用 SGS 应力的涡粘性假设：\n$$\n\\boldsymbol{\\tau}_{\\mathrm{sgs}} = 2 \\bar{\\rho} \\, \\nu_t \\, \\bar{\\mathbf{S}} - \\frac{2}{3} \\bar{\\rho} \\, k_{\\mathrm{sgs}} \\mathbf{I},\n$$\n其中 $\\nu_t$ 是涡粘性，$\\bar{\\mathbf{S}}$ 是解析应变率张量，其分量为 $\\bar{S}_{ij} = \\tfrac{1}{2} (\\partial \\bar{u}_i / \\partial x_j + \\partial \\bar{u}_j / \\partial x_i)$，$k_{\\mathrm{sgs}}$ 是亚格子动能。在燃烧室的低马赫数 LES 中，涉及 $k_{\\mathrm{sgs}}$ 的项通过 $\\nabla \\cdot \\bar{\\mathbf{u}}$ 产生贡献，在近不可压缩条件下可以忽略。因此，\n$$\n\\varepsilon_{\\mathrm{sgs}} \\approx \\int_V 2 \\bar{\\rho} \\, \\nu_t \\, \\bar{S}_{ij} \\bar{S}_{ij} \\, dV。\n$$\n使用 $S_{\\mathrm{mag}} = \\sqrt{2 \\bar{S}_{ij} \\bar{S}_{ij}}$，我们有 $\\bar{S}_{ij} \\bar{S}_{ij} = \\tfrac{1}{2} S_{\\mathrm{mag}}^2$。因此，\n$$\n\\varepsilon_{\\mathrm{sgs}} \\approx \\int_V \\bar{\\rho} \\, \\nu_t \\, S_{\\mathrm{mag}}^2 \\, dV。\n$$\n对于 Smagorinsky 闭合，\n$$\n\\nu_t = (C \\Delta)^2 \\, S_{\\mathrm{mag}},\n$$\n其中对于恒定 Smagorinsky 模型，$C = C_s$；对于动态 Smagorinsky 模型，$C = C_d(\\mathbf{x})$。代入可得\n$$\n\\varepsilon_{\\mathrm{sgs}} \\approx \\int_V \\bar{\\rho} \\, (C^2 \\Delta^2) \\, S_{\\mathrm{mag}}^3 \\, dV,\n$$\n其通过对单元求和进行数值计算：\n$$\n\\varepsilon_{\\mathrm{sgs}} \\approx \\sum_{i} \\rho_i \\, C_i^2 \\, \\Delta^2 \\, S_{\\mathrm{mag},i}^3 \\, V_{\\mathrm{cell}}。\n$$\n如果 $C = C_s$ 是常数，则对于所有 $i$，$C_i = C_s$。对于动态 Smagorinsky 模型，$C_i = C_{d,i}$ 可能因回传而为负值。纯耗散变体将 $C_{d,i}$ 裁剪为 $C_{d,i}^{+} = \\max(C_{d,i}, 0)$，以确保 $\\varepsilon_{\\mathrm{sgs}} \\ge 0$。\n\n每个测试用例的算法：\n1. 读取 $V_{\\mathrm{cell}}$、$\\Delta$、数组 $\\rho_i$ 和 $S_{\\mathrm{mag},i}$、常数 $C_s$ 和 $C_{d,i}$，以及标量 $F_{\\mathrm{in}}$、$F_{\\mathrm{out}}$、$Q_{\\mathrm{tot}}$、$\\frac{dE}{dt}$ 和 $\\mathrm{tol}$。\n2. 计算 $\\varepsilon_{\\mathrm{sgs}}^{\\mathrm{Smag}} = \\sum_i \\rho_i \\, C_s^2 \\, \\Delta^2 \\, S_{\\mathrm{mag},i}^3 \\, V_{\\mathrm{cell}}$。\n3. 计算 $\\varepsilon_{\\mathrm{sgs}}^{\\mathrm{DynClip}} = \\sum_i \\rho_i \\, (\\max(C_{d,i},0))^2 \\, \\Delta^2 \\, S_{\\mathrm{mag},i}^3 \\, V_{\\mathrm{cell}}$。\n4. 计算残差\n   $R_{\\mathrm{Smag}} = \\frac{dE}{dt} - \\left[(F_{\\mathrm{in}} - F_{\\mathrm{out}}) + Q_{\\mathrm{tot}} - \\varepsilon_{\\mathrm{sgs}}^{\\mathrm{Smag}} \\right]$\n   和\n   $R_{\\mathrm{DynClip}} = \\frac{dE}{dt} - \\left[(F_{\\mathrm{in}} - F_{\\mathrm{out}}) + Q_{\\mathrm{tot}} - \\varepsilon_{\\mathrm{sgs}}^{\\mathrm{DynClip}} \\right]$。\n5. 如果 $|R_{\\mathrm{DynClip}}| \\le \\mathrm{tol}$，则标志为 $\\mathrm{True}$，否则为 $\\mathrm{False}$。\n6. 为每个用例输出列表 $[R_{\\mathrm{Smag}}, R_{\\mathrm{DynClip}}, \\mathrm{flag}]$，并将它们聚合到单行打印的顶层列表中。\n\n科学真实性和覆盖范围：\n- 用例 1 模拟一个典型的湍流燃烧室 LES，其中 SGS 耗散适中，如果模型和数值方法一致，残差预计会很小。\n- 用例 2 在 $S_{\\mathrm{mag},i} = 0$ 时验证零 SGS 耗散的边界条件，测试诊断工具对边缘条件的正确处理。\n- 用例 3 探讨高应变情况，其中大的常数 $C_s$ 产生强耗散；动态模型产生较低的耗散，残差突显了可能的模型形式差异或数值不一致性。\n- 用例 4 测试具有负值的动态系数；裁剪强制非负耗散，诊断确认残差在容差范围内可接受。\n- 用例 5 使用小滤波宽度 $\\Delta$ 来抑制 SGS 耗散，突显了灵敏度和可能导致显著残差的耗散不足问题。\n\n所有输出均以瓦特 ($\\mathrm{W}$) 表示。不涉及角度或百分比。最终打印格式是包含一个顶层列表的单行，每个测试用例一个子列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef sgs_dissipation(rho, S_mag, delta, C, V_cell, clip_negative=False):\n    \"\"\"\n    Compute SGS viscous dissipation:\n        epsilon_sgs = sum_i rho_i * (C_i^2 * delta^2) * S_mag_i^3 * V_cell\n    where:\n        - rho: array of densities (kg/m^3)\n        - S_mag: array of strain-rate magnitudes (1/s)\n        - delta: filter width (m)\n        - C: scalar Smagorinsky constant or array of dynamic coefficients\n        - V_cell: cell volume (m^3)\n        - clip_negative: if True, clip dynamic coefficients to be nonnegative\n    Returns epsilon_sgs in Watts (J/s).\n    \"\"\"\n    rho = np.asarray(rho, dtype=float)\n    S_mag = np.asarray(S_mag, dtype=float)\n    C_arr = np.asarray(C, dtype=float)\n    if C_arr.ndim == 0:\n        C_arr = np.full_like(S_mag, C_arr)\n    if clip_negative:\n        C_arr = np.maximum(C_arr, 0.0)\n    epsilon = np.sum(rho * (C_arr**2) * (delta**2) * (S_mag**3) * V_cell)\n    return float(epsilon)\n\ndef compute_residuals(case):\n    \"\"\"\n    Compute residuals for Smagorinsky and clipped dynamic Smagorinsky,\n    and flag whether the dynamic residual magnitude is within tolerance.\n    \"\"\"\n    V_cell = case[\"V_cell\"]\n    delta = case[\"delta\"]\n    rho = case[\"rho\"]\n    S_mag = case[\"S_mag\"]\n    C_s = case[\"C_s\"]\n    C_d = case[\"C_d\"]\n    F_in = case[\"F_in\"]\n    F_out = case[\"F_out\"]\n    Q_tot = case[\"Q_tot\"]\n    dE_dt = case[\"dE_dt\"]\n    tol = case[\"tol\"]\n\n    eps_smag = sgs_dissipation(rho, S_mag, delta, C_s, V_cell, clip_negative=False)\n    eps_dyn_clip = sgs_dissipation(rho, S_mag, delta, C_d, V_cell, clip_negative=True)\n\n    rhs_smag = (F_in - F_out) + Q_tot - eps_smag\n    rhs_dyn_clip = (F_in - F_out) + Q_tot - eps_dyn_clip\n\n    R_smag = dE_dt - rhs_smag\n    R_dyn_clip = dE_dt - rhs_dyn_clip\n\n    flag = abs(R_dyn_clip) = tol\n    return [R_smag, R_dyn_clip, flag]\n\ndef format_results_no_spaces(results):\n    \"\"\"\n    Format nested lists with booleans into a single-line string without spaces,\n    as required by the output specification.\n    \"\"\"\n    parts = []\n    for item in results:\n        # item is [float, float, bool]\n        r1 = item[0]\n        r2 = item[1]\n        flag = str(item[2])\n        parts.append(f\"[{r1},{r2},{flag}]\")\n    return \"[\" + \",\".join(parts) + \"]\"\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"V_cell\": 0.02,\n            \"delta\": 0.05,\n            \"rho\": [1.2, 1.18, 1.22, 1.19],\n            \"S_mag\": [400.0, 450.0, 420.0, 430.0],\n            \"C_s\": 0.18,\n            \"C_d\": [0.16, 0.20, 0.17, 0.19],\n            \"F_in\": 2600.0,\n            \"F_out\": 1800.0,\n            \"Q_tot\": 500.0,\n            \"dE_dt\": 705.0,\n            \"tol\": 25.0\n        },\n        {\n            \"V_cell\": 0.02,\n            \"delta\": 0.03,\n            \"rho\": [1.0, 1.0, 1.0, 1.0],\n            \"S_mag\": [0.0, 0.0, 0.0, 0.0],\n            \"C_s\": 0.18,\n            \"C_d\": [0.0, 0.0, 0.0, 0.0],\n            \"F_in\": 1000.0,\n            \"F_out\": 800.0,\n            \"Q_tot\": 150.0,\n            \"dE_dt\": 350.0,\n            \"tol\": 0.5\n        },\n        {\n            \"V_cell\": 0.015,\n            \"delta\": 0.06,\n            \"rho\": [0.95, 0.90, 0.92, 0.94],\n            \"S_mag\": [650.0, 700.0, 680.0, 660.0],\n            \"C_s\": 0.18,\n            \"C_d\": [0.12, 0.15, 0.14, 0.13],\n            \"F_in\": 4000.0,\n            \"F_out\": 3000.0,\n            \"Q_tot\": 600.0,\n            \"dE_dt\": -380.0,\n            \"tol\": 10.0\n        },\n        {\n            \"V_cell\": 0.03,\n            \"delta\": 0.04,\n            \"rho\": [1.1, 1.05, 1.08, 1.06],\n            \"S_mag\": [300.0, 350.0, 320.0, 310.0],\n            \"C_s\": 0.17,\n            \"C_d\": [-0.10, 0.05, -0.02, 0.0],\n            \"F_in\": 1800.0,\n            \"F_out\": 1300.0,\n            \"Q_tot\": 400.0,\n            \"dE_dt\": 895.0,\n            \"tol\": 3.0\n        },\n        {\n            \"V_cell\": 0.01,\n            \"delta\": 0.01,\n            \"rho\": [1.2, 1.21, 1.19, 1.18, 1.20],\n            \"S_mag\": [200.0, 220.0, 210.0, 205.0, 215.0],\n            \"C_s\": 0.18,\n            \"C_d\": [0.17, 0.16, 0.18, 0.17, 0.15],\n            \"F_in\": 1200.0,\n            \"F_out\": 1050.0,\n            \"Q_tot\": 130.0,\n            \"dE_dt\": 260.0,\n            \"tol\": 15.0\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = compute_residuals(case)\n        results.append(result)\n\n    # Final print statement in the exact required format (single line).\n    print(format_results_no_spaces(results))\n\nsolve()\n```"
        }
    ]
}