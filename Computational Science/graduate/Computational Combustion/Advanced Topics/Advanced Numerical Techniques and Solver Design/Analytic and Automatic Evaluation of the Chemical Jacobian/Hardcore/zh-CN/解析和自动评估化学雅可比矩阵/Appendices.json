{
    "hands_on_practices": [
        {
            "introduction": "掌握化学雅可比矩阵的第一步是亲手构建它。本练习将指导您为一个简化的氢氧反应体系，从基本的质量作用定律和化学计量关系出发，一步步推导并计算出完整的雅可比矩阵。通过这个过程，您将直观地理解反应机理如何决定雅可比矩阵的稀疏性（即零元素的位置）和非对称性，这些是大型化学动力学模拟中至关重要的结构特性 。",
            "id": "4007129",
            "problem": "考虑一个恒压、等温的均相反应器，该反应器模拟了一个简化的氢氧（$H_2/O_2$）化学子集，其中包含三个不可逆基元反应：\n1. $H_{2} + O \\rightarrow H + OH$\n2. $H + O_{2} \\rightarrow O + OH$\n3. $H_{2} + OH \\rightarrow H_{2}O + H$\n\n假设为理想气体行为和质量作用动力学。设物种浓度向量排序为 $c = (c_{H_{2}}, c_{O_{2}}, c_{O}, c_{H}, c_{OH}, c_{H_{2}O})$，在温度 $T = 1200\\,\\mathrm{K}$ 和压力 $p = 1\\,\\mathrm{atm}$ 下，其摩尔浓度如下：\n$c_{H_{2}} = 5.0\\,\\text{mol/m}^3$，$c_{O_{2}} = 2.5\\,\\text{mol/m}^3$，$c_{O} = 0.01\\,\\text{mol/m}^3$，$c_{H} = 0.02\\,\\text{mol/m}^3$，$c_{OH} = 0.03\\,\\text{mol/m}^3$，$c_{H_{2}O} = 2.6\\,\\text{mol/m}^3$。随温度变化的速率系数遵循在燃烧动力学中广泛使用的Arrhenius型定律：\n- 反应 $1$：$k_{1}(T) = A_{1}\\,\\exp(-T_{a,1}/T)$，其中 $A_{1} = 3.51 \\times 10^{10}\\,\\mathrm{m^3/(mol \\cdot s)}$ 且 $T_{a,1} = 16599\\,\\mathrm{K}$。\n- 反应 $2$：$k_{2}(T) = A_{2}\\,T^{n_{2}}\\,\\exp(-T_{a,2}/T)$，其中 $A_{2} = 2.65 \\times 10^{10}\\,\\mathrm{m^3/(mol \\cdot s)}$，$n_{2} = -0.670$ 且 $T_{a,2} = 17041\\,\\mathrm{K}$。\n- 反应 $3$：$k_{3}(T) = A_{3}\\,T^{n_{3}}\\,\\exp(-T_{a,3}/T)$，其中 $A_{3} = 2.16 \\times 10^{2}\\,\\mathrm{m^3/(mol \\cdot s)}$，$n_{3} = 1.51$ 且 $T_{a,3} = 1726\\,\\mathrm{K}$。\n\n根据这些定义，反应速率为 $r_{1} = k_{1} c_{H_{2}} c_{O}$，$r_{2} = k_{2} c_{H} c_{O_{2}}$ 和 $r_{3} = k_{3} c_{H_{2}} c_{OH}$。物种生成速率由化学计量平衡给出：\n$\\omega_{H_{2}} = -r_{1} - r_{3}$，$\\omega_{O_{2}} = -r_{2}$，$\\omega_{O} = -r_{1} + r_{2}$，$\\omega_{H} = r_{1} - r_{2} + r_{3}$，$\\omega_{OH} = r_{1} + r_{2} - r_{3}$，$\\omega_{H_{2}O} = r_{3}$。化学雅可比矩阵定义为 $J = \\frac{\\partial \\omega}{\\partial c}$，其中第 $(i,j)$ 个元素为 $J_{ij} = \\frac{\\partial \\omega_{i}}{\\partial c_{j}}$。\n\n任务：\n- 从质量作用速率定律和化学计量出发，在给定的热化学状态下，数值组装完整的 $6 \\times 6$ 化学雅可比矩阵 $J$。\n- 使用组装好的 $J$，识别零元素和非零元素以验证稀疏性，并讨论非零交叉耦合项 $J_{ij}$ 和 $J_{ji}$ 是否在该三反应子集的稀疏模式中表现出任何对称性。\n- 将稀疏度定义为完整雅可比矩阵中零元素的比例，即零元素的数量除以 $36$。将此稀疏度计算为一个实数，并将其作为最终答案报告。\n\n将最终稀疏度值表示为小数，并四舍五入到四位有效数字。最终答案中不应包含任何物理单位。",
            "solution": "首先验证问题，以确保其具有科学依据、适定且客观。\n\n### 步骤 1：提取已知条件\n- **物种**：$H_2, O_2, O, H, OH, H_2O$。\n- **物种浓度向量**：$c = (c_{H_2}, c_{O_2}, c_{O}, c_{H}, c_{OH}, c_{H_2O})$。\n- **热力学状态**：恒定压力 $p = 1\\,\\mathrm{atm}$，等温温度 $T = 1200\\,\\mathrm{K}$。\n- **摩尔浓度（$c_i$，单位为 $\\text{mol/m}^3$）**：\n  - $c_{H_2} = 5.0$\n  - $c_{O_2} = 2.5$\n  - $c_{O} = 0.01$\n  - $c_{H} = 0.02$\n  - $c_{OH} = 0.03$\n  - $c_{H_2O} = 2.6$\n- **反应（不可逆，基元）**：\n  1. $H_2 + O \\rightarrow H + OH$\n  2. $H + O_2 \\rightarrow O + OH$\n  3. $H_2 + OH \\rightarrow H_2O + H$\n- **速率系数（$k_i(T)$）**：\n  - $k_1(T) = A_1\\,\\exp(-T_{a,1}/T)$，其中 $A_1 = 3.51 \\times 10^{10}\\,\\mathrm{m^3/(mol \\cdot s)}$，$T_{a,1} = 16599\\,\\mathrm{K}$。\n  - $k_2(T) = A_2\\,T^{n_2}\\,\\exp(-T_{a,2}/T)$，其中 $A_2 = 2.65 \\times 10^{10}\\,\\mathrm{m^3/(mol \\cdot s)}$，$n_2 = -0.670$，$T_{a,2} = 17041\\,\\mathrm{K}$。\n  - $k_3(T) = A_3\\,T^{n_3}\\,\\exp(-T_{a,3}/T)$，其中 $A_3 = 2.16 \\times 10^{2}\\,\\mathrm{m^3/(mol \\cdot s)}$，$n_3 = 1.51$，$T_{a,3} = 1726\\,\\mathrm{K}$。\n- **反应速率（质量作用动力学）**：\n  - $r_1 = k_1\\,c_{H_2}\\,c_{O}$\n  - $r_2 = k_2\\,c_{H}\\,c_{O_2}$\n  - $r_3 = k_3\\,c_{H_2}\\,c_{OH}$\n- **物种生成速率（$\\omega_i$）**：\n  - $\\omega_{H_2} = -r_1 - r_3$\n  - $\\omega_{O_2} = -r_2$\n  - $\\omega_{O} = -r_1 + r_2$\n  - $\\omega_{H} = r_1 - r_2 + r_3$\n  - $\\omega_{OH} = r_1 + r_2 - r_3$\n  - $\\omega_{H_2O} = r_3$\n- **雅可比矩阵定义**：$J = \\frac{\\partial \\omega}{\\partial c}$，其中 $J_{ij} = \\frac{\\partial \\omega_i}{\\partial c_j}$。\n- **任务**：组装数值 $6 \\times 6$ 雅可比矩阵 $J$，分析其稀疏模式和对称性，并计算稀疏度（零元素的比例），结果四舍五入到四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题基于化学动力学的基本原理，特别是质量作用速率定律和Arrhenius型温度依赖性，这些都是计算燃烧学中的标准方法。所给的化学机理是一个公认且有效的氢氧化学子集。提供的数据对于高温反应流是物理上现实的。\n- **适定性**：问题定义清晰。所有必要的数据（浓度、速率参数、温度）和定义（反应速率、生成速率、雅可比矩阵）都已提供。这使得可以计算出单一、唯一的数值雅可比矩阵。\n- **客观性**：问题使用精确、无偏见和正式的科学语言陈述。没有主观因素。\n- **完整性和一致性**：问题是自洽的。定义与标准化学动力学文献一致。没有缺失数据或矛盾的约束条件。等温条件通过使速率系数与浓度变化无关来简化问题，这对于定义化学雅可比矩阵是标准的做法。\n\n### 步骤 3：结论与行动\n问题被判定为**有效**。将提供完整解答。\n\n### 解答\n任务是确定给定反应机理和热化学状态下的化学雅可比矩阵 $J$，然后计算其稀疏度。物种索引如下：$1: H_2$，$2: O_2$，$3: O$，$4: H$，$5: OH$，$6: H_2O$。\n\n首先，我们将物种生成速率 $\\omega_i$ 表示为物种浓度 $c_j$ 的显式函数。\n$$ \\omega_{H_{2}} (\\omega_1) = -k_1 c_{H_2} c_O - k_3 c_{H_2} c_{OH} $$\n$$ \\omega_{O_{2}} (\\omega_2) = -k_2 c_H c_{O_2} $$\n$$ \\omega_{O} (\\omega_3) = -k_1 c_{H_2} c_O + k_2 c_H c_{O_2} $$\n$$ \\omega_{H} (\\omega_4) = k_1 c_{H_2} c_O - k_2 c_H c_{O_2} + k_3 c_{H_2} c_{OH} $$\n$$ \\omega_{OH} (\\omega_5) = k_1 c_{H_2} c_O + k_2 c_H c_{O_2} - k_3 c_{H_2} c_{OH} $$\n$$ \\omega_{H_{2}O} (\\omega_6) = k_3 c_{H_2} c_{OH} $$\n\n雅可比矩阵元素由 $J_{ij} = \\frac{\\partial \\omega_i}{\\partial c_j}$ 给出。我们通过对生成速率表达式求导来推导每个元素的解析形式。例如，对于第一行（$i=1$，对应于 $H_2$）：\n$J_{11} = \\frac{\\partial \\omega_1}{\\partial c_1} = \\frac{\\partial}{\\partial c_{H_2}}(-k_1 c_{H_2} c_O - k_3 c_{H_2} c_{OH}) = -k_1 c_O - k_3 c_{OH}$\n$J_{12} = \\frac{\\partial \\omega_1}{\\partial c_2} = \\frac{\\partial}{\\partial c_{O_2}}(-k_1 c_{H_2} c_O - k_3 c_{H_2} c_{OH}) = 0$\n$J_{13} = \\frac{\\partial \\omega_1}{\\partial c_3} = \\frac{\\partial}{\\partial c_{O}}(-k_1 c_{H_2} c_O - k_3 c_{H_2} c_{OH}) = -k_1 c_{H_2}$\n以此类推。对所有 $36$ 个元素应用此过程，得到解析的雅可比矩阵：\n$$\nJ = \\begin{pmatrix}\n-k_1 c_O - k_3 c_{OH}  & 0  & -k_1 c_{H_2}  & 0  & -k_3 c_{H_2}  & 0 \\\\\n0  & -k_2 c_H  & 0  & -k_2 c_{O_2}  & 0  & 0 \\\\\n-k_1 c_O  & k_2 c_H  & -k_1 c_{H_2}  & k_2 c_{O_2}  & 0  & 0 \\\\\nk_1 c_O + k_3 c_{OH}  & -k_2 c_H  & k_1 c_{H_2}  & -k_2 c_{O_2}  & k_3 c_{H_2}  & 0 \\\\\nk_1 c_O - k_3 c_{OH}  & k_2 c_H  & k_1 c_{H_2}  & k_2 c_{O_2}  & -k_3 c_{H_2}  & 0 \\\\\nk_3 c_{OH}  & 0  & 0  & 0  & k_3 c_{H_2}  & 0\n\\end{pmatrix}\n$$\n这个结构揭示了稀疏模式。最后一列完全为零，因为在这个不可逆机理中，$H_2O$ 只是一个产物，所以其浓度不影响任何反应速率。类似地，许多其他元素也为零，因为给定的物种 $j$ 没有作为反应物出现在任何对物种 $i$ 的生成速率有贡献的反应中。\n\n接下来，我们计算在 $T = 1200\\,\\mathrm{K}$ 时速率系数的数值：\n$k_1 = (3.51 \\times 10^{10}) \\exp\\left(-\\frac{16599}{1200}\\right) \\approx 3.4514 \\times 10^{4}\\,\\mathrm{m^3/(mol \\cdot s)}$\n$k_2 = (2.65 \\times 10^{10}) (1200)^{-0.670} \\exp\\left(-\\frac{17041}{1200}\\right) \\approx 1.7082 \\times 10^{2}\\,\\mathrm{m^3/(mol \\cdot s)}$\n$k_3 = (2.16 \\times 10^{2}) (1200)^{1.51} \\exp\\left(-\\frac{1726}{1200}\\right) \\approx 2.1504 \\times 10^{6}\\,\\mathrm{m^3/(mol \\cdot s)}$\n\n使用这些值和给定的浓度，我们计算雅可比矩阵中出现的各项：\n$k_1 c_O = (3.4514 \\times 10^4)(0.01) \\approx 3.4514 \\times 10^2$\n$k_1 c_{H_2} = (3.4514 \\times 10^4)(5.0) \\approx 1.7257 \\times 10^5$\n$k_2 c_H = (1.7082 \\times 10^2)(0.02) \\approx 3.4164$\n$k_2 c_{O_2} = (1.7082 \\times 10^2)(2.5) \\approx 4.2705 \\times 10^2$\n$k_3 c_{OH} = (2.1504 \\times 10^6)(0.03) \\approx 6.4512 \\times 10^4$\n$k_3 c_{H_2} = (2.1504 \\times 10^6)(5.0) \\approx 1.0752 \\times 10^7$\n\n将这些值代入解析的雅可比矩阵，得到数值雅可比矩阵 $J$（单位为 $s^{-1}$）：\n$$\nJ \\approx \\begin{pmatrix}\n-6.49 \\times 10^4  & 0  & -1.73 \\times 10^5  & 0  & -1.08 \\times 10^7  & 0 \\\\\n0  & -3.42  & 0  & -4.27 \\times 10^2  & 0  & 0 \\\\\n-3.45 \\times 10^2  & 3.42  & -1.73 \\times 10^5  & 4.27 \\times 10^2  & 0  & 0 \\\\\n6.49 \\times 10^4  & -3.42  & 1.73 \\times 10^5  & -4.27 \\times 10^2  & 1.08 \\times 10^7  & 0 \\\\\n-6.42 \\times 10^4  & 3.42  & 1.73 \\times 10^5  & 4.27 \\times 10^2  & -1.08 \\times 10^7  & 0 \\\\\n6.45 \\times 10^4  & 0  & 0  & 0  & 1.08 \\times 10^7  & 0\n\\end{pmatrix}\n$$\n\n雅可比矩阵的稀疏模式如下，其中 `N` 表示非零元素，`Z` 表示零元素：\n$$\n\\text{稀疏模式} = \\begin{pmatrix}\nN  & Z  & N  & Z  & N  & Z \\\\\nZ  & N  & Z  & N  & Z  & Z \\\\\nN  & N  & N  & N  & Z  & Z \\\\\nN  & N  & N  & N  & N  & Z \\\\\nN  & N  & N  & N  & N  & Z \\\\\nN  & Z  & Z  & Z  & N  & Z\n\\end{pmatrix}\n$$\n稀疏模式是不对称的。例如，$J_{23} = 0$ 而 $J_{32} = k_2 c_H \\neq 0$。这种不对称性是化学雅可比矩阵的一个普遍特征。从物理上讲，这意味着物种 $j$ 的浓度对物种 $i$ 生成速率的影响，不一定与物种 $i$ 的浓度对物种 $j$ 生成速率的影响相关。在本例中，氧原子（$O$，物种3）的浓度不影响反应2的速率，而反应2是唯一影响氧分子（$O_2$，物种2）净生成速率的反应。因此，$\\frac{\\partial \\omega_{O_2}}{\\partial c_O} = 0$。然而，氧分子的浓度确实影响反应2的速率，而反应2对氧原子的生成速率有贡献，所以 $\\frac{\\partial \\omega_O}{\\partial c_{O_2}} \\neq 0$。\n\n为了计算稀疏度，我们计算零元素的数量。\n- 第1行：$3$个零\n- 第2行：$4$个零\n- 第3行：$2$个零\n- 第4行：$1$个零\n- 第5行：$1$个零\n- 第6行：$4$个零\n零元素的总数为 $3+4+2+1+1+4 = 15$。\n这个 $6 \\times 6$ 矩阵中的元素总数为 $36$。\n稀疏度是零元素的比例：\n$$ \\text{稀疏度} = \\frac{\\text{零元素数量}}{\\text{元素总数}} = \\frac{15}{36} = \\frac{5}{12} $$\n换算成小数，其值为 $5 \\div 12 \\approx 0.416666...$。\n四舍五入到四位有效数字得到 $0.4167$。",
            "answer": "$$\\boxed{0.4167}$$"
        },
        {
            "introduction": "在实际的科学计算中，仅仅推导出解析形式是不够的，我们必须验证其实现的正确性。本练习的核心任务是设计一个数值测试，将解析计算的雅可比矩阵与通过中心有限差分法得到的数值近似结果进行比较。这个实践不仅能巩固您对雅可比矩阵定义的理解，还能让您掌握一种在开发复杂模拟代码时用于验证导数计算的标准技术 。",
            "id": "4007106",
            "problem": "考虑一个包含三种化学物种 $A$、$B$ 和 $C$ 的均相、等温、恒容反应体系，其状态由浓度向量 $\\mathbf{c} = [c_A, c_B, c_C]^\\top$ 表示，单位为 $\\text{mol/m}^3$。假设遵循基元质量作用动力学，以及以下具有科学上一致的化学计量和速率表达式的反应机理：\n\n- 反应 $\\mathrm{R1}$：$A + B \\rightarrow C$，正向速率为 $r_1 = k_1 c_A c_B$，其中 $k_1$ 的单位为 $\\mathrm{m^3/(mol \\cdot s)}$。\n- 反应 $\\mathrm{R2}$：$C \\rightarrow A$，速率为 $r_2 = k_2 c_C$，其中 $k_2$ 的单位为 $\\mathrm{s^{-1}}$。\n- 反应 $\\mathrm{R3}$：$C \\rightarrow B$，速率为 $r_3 = k_3 c_C$，其中 $k_3$ 的单位为 $\\mathrm{s^{-1}}$。\n\n设每个反应的净化学计量变化向量为\n$$\n\\boldsymbol{\\nu}_1 = \\begin{bmatrix}-1\\\\-1\\\\+1\\end{bmatrix},\\quad\n\\boldsymbol{\\nu}_2 = \\begin{bmatrix}+1\\\\0\\\\-1\\end{bmatrix},\\quad\n\\boldsymbol{\\nu}_3 = \\begin{bmatrix}0\\\\+1\\\\-1\\end{bmatrix},\n$$\n均以每次反应事件的分子数表示，并通过质量作用定律应用于浓度动力学。物种生成速率向量 $\\mathbf{f}(\\mathbf{c}) = \\frac{d\\mathbf{c}}{dt}$（单位为 $\\text{mol/(m}^3 \\cdot \\text{s)}$）根据基本原理，由各反应的贡献之和给出：\n$$\n\\mathbf{f}(\\mathbf{c}) = \\boldsymbol{\\nu}_1 r_1 + \\boldsymbol{\\nu}_2 r_2 + \\boldsymbol{\\nu}_3 r_3.\n$$\n\n定义化学雅可比矩阵为偏导数矩阵\n$$\nJ(\\mathbf{c}) = \\left[\\frac{\\partial f_i(\\mathbf{c})}{\\partial c_j}\\right]_{i,j=1}^3,\n$$\n其元素的单位为 $\\mathrm{s^{-1}}$。\n\n您的任务是设计并实现一个程序，该程序针对指定的参数集，计算：\n- 从第一性原理（质量作用速率定律和化学计量）推导出的解析雅可比矩阵 $J(\\mathbf{c})$，\n- 一个中心有限差分近似 $\\tilde{J}(\\mathbf{c})$，其元素为\n$$\n\\tilde{J}_{ij}(\\mathbf{c}) \\approx \\frac{f_i(\\mathbf{c} + \\delta_j \\mathbf{e}_j) - f_i(\\mathbf{c} - \\delta_j \\mathbf{e}_j)}{2\\delta_j},\n$$\n其中 $\\mathbf{e}_j$ 是第 $j$ 个标准基向量，扰动大小选择为\n$$\n\\delta_j = \\max\\left(\\delta_{\\min},\\, \\delta_{\\mathrm{rel}} \\cdot \\max(1, |c_j|)\\right).\n$$\n使用 $\\delta_{\\mathrm{rel}} = 10^{-8}$ 和 $\\delta_{\\min} = 10^{-20}$。\n\n对于每个测试用例，计算元素间的最大绝对差\n$$\n\\Delta_{\\max} = \\max_{i,j} \\left| J_{ij}(\\mathbf{c}) - \\tilde{J}_{ij}(\\mathbf{c}) \\right|,\n$$\n并将此值以浮点数形式报告，单位为 $\\mathrm{s^{-1}}$。\n\n实现程序以评估以下测试套件，每个测试用例由 $(\\mathbf{c}, \\mathbf{k})$ 指定，其中 $\\mathbf{k} = [k_1, k_2, k_3]$：\n- 测试 $1$（一般情况）：$\\mathbf{c} = [1.0, 2.0, 0.5]\\, \\text{mol/m}^3$，$\\mathbf{k} = [10.0, 1.0, 0.1]$，其中 $k_1$ 单位为 $\\mathrm{m^3/(mol \\cdot s)}$，$k_2$ 和 $k_3$ 单位为 $\\mathrm{s^{-1}}$。\n- 测试 $2$（包含零的边界情况）：$\\mathbf{c} = [0.0, 1.0, 0.0]\\, \\text{mol/m}^3$，$\\mathbf{k} = [1000.0, 5.0, 0.0]$，单位同上。\n- 测试 $3$（刚性量级和微小浓度）：$\\mathbf{c} = [10^{-12}, 10^{-12}, 10^{-3}]\\, \\text{mol/m}^3$，$\\mathbf{k} = [10^{9}, 10^{5}, 2 \\times 10^{5}]$，单位同上。\n- 测试 $4$（大浓度，温和速率）：$\\mathbf{c} = [100.0, 200.0, 300.0]\\, \\text{mol/m}^3$，$\\mathbf{k} = [10^{-3}, 0.2, 0.3]$，单位同上。\n\n您的程序应产生单行输出，其中包含一个由方括号括起来的逗号分隔列表（例如 $[x_1,x_2,x_3,x_4]$），其中每个 $x_i$ 是对应测试用例的 $\\Delta_{\\max}$ 值，单位为 $\\mathrm{s^{-1}}$。不应打印任何额外文本。不涉及角度，因此不需要角度单位。不涉及百分比。通过在整个计算过程中遵守指定的单位和定义来确保科学真实性，并以 $\\mathrm{s^{-1}}$ 为单位表示所有输出。",
            "solution": "问题陈述被评估为有效。它在科学上基于化学动力学原理，在数学上是适定的，并且为获得唯一解提供了所有必要的参数和定义。\n\n问题的核心是，对于给定的反应体系，比较解析推导的化学雅可比矩阵与其通过有限差分获得的数值近似值。\n\n首先，我们必须确定物种生成速率向量 $\\mathbf{f}(\\mathbf{c})$ 的显式形式。状态向量为 $\\mathbf{c} = [c_A, c_B, c_C]^\\top$。问题提供了反应、速率表达式和化学计量向量：\n- 反应 $\\mathrm{R1}$：$A + B \\rightarrow C$，速率为 $r_1 = k_1 c_A c_B$，化学计量向量为 $\\boldsymbol{\\nu}_1 = [-1, -1, +1]^\\top$。\n- 反应 $\\mathrm{R2}$：$C \\rightarrow A$，速率为 $r_2 = k_2 c_C$，化学计量向量为 $\\boldsymbol{\\nu}_2 = [+1, 0, -1]^\\top$。\n- 反应 $\\mathrm{R3}$：$C \\rightarrow B$，速率为 $r_3 = k_3 c_C$，化学计量向量为 $\\boldsymbol{\\nu}_3 = [0, +1, -1]^\\top$。\n\n物种生成速率向量 $\\mathbf{f}(\\mathbf{c}) = [f_A(\\mathbf{c}), f_B(\\mathbf{c}), f_C(\\mathbf{c})]^\\top$ 由基本关系式 $\\mathbf{f}(\\mathbf{c}) = \\sum_k \\boldsymbol{\\nu}_k r_k$ 给出。\n$$\n\\mathbf{f}(\\mathbf{c}) = \\frac{d\\mathbf{c}}{dt} = \\boldsymbol{\\nu}_1 r_1 + \\boldsymbol{\\nu}_2 r_2 + \\boldsymbol{\\nu}_3 r_3 = \\begin{bmatrix}-1\\\\-1\\\\+1\\end{bmatrix} (k_1 c_A c_B) + \\begin{bmatrix}+1\\\\0\\\\-1\\end{bmatrix} (k_2 c_C) + \\begin{bmatrix}0\\\\+1\\\\-1\\end{bmatrix} (k_3 c_C)\n$$\n由此可得出每个物种的独立速率方程：\n$$ f_A(\\mathbf{c}) = \\frac{dc_A}{dt} = -k_1 c_A c_B + k_2 c_C $$\n$$ f_B(\\mathbf{c}) = \\frac{dc_B}{dt} = -k_1 c_A c_B + k_3 c_C $$\n$$ f_C(\\mathbf{c}) = \\frac{dc_C}{dt} = k_1 c_A c_B - k_2 c_C - k_3 c_C = k_1 c_A c_B - (k_2 + k_3) c_C $$\n\n接下来，我们推导解析雅可比矩阵 $J(\\mathbf{c})$，其元素定义为 $J_{ij} = \\frac{\\partial f_i}{\\partial c_j}$。我们令物种索引为 $1 \\leftrightarrow A$，$2 \\leftrightarrow B$，$3 \\leftrightarrow C$。\n\n偏导数计算如下：\n\n第1行（$f_A$ 的导数）：\n$$ J_{11} = \\frac{\\partial f_A}{\\partial c_A} = \\frac{\\partial}{\\partial c_A}(-k_1 c_A c_B + k_2 c_C) = -k_1 c_B $$\n$$ J_{12} = \\frac{\\partial f_A}{\\partial c_B} = \\frac{\\partial}{\\partial c_B}(-k_1 c_A c_B + k_2 c_C) = -k_1 c_A $$\n$$ J_{13} = \\frac{\\partial f_A}{\\partial c_C} = \\frac{\\partial}{\\partial c_C}(-k_1 c_A c_B + k_2 c_C) = k_2 $$\n\n第2行（$f_B$ 的导数）：\n$$ J_{21} = \\frac{\\partial f_B}{\\partial c_A} = \\frac{\\partial}{\\partial c_A}(-k_1 c_A c_B + k_3 c_C) = -k_1 c_B $$\n$$ J_{22} = \\frac{\\partial f_B}{\\partial c_B} = \\frac{\\partial}{\\partial c_B}(-k_1 c_A c_B + k_3 c_C) = -k_1 c_A $$\n$$ J_{23} = \\frac{\\partial f_B}{\\partial c_C} = \\frac{\\partial}{\\partial c_C}(-k_1 c_A c_B + k_3 c_C) = k_3 $$\n\n第3行（$f_C$ 的导数）：\n$$ J_{31} = \\frac{\\partial f_C}{\\partial c_A} = \\frac{\\partial}{\\partial c_A}(k_1 c_A c_B - (k_2 + k_3) c_C) = k_1 c_B $$\n$$ J_{32} = \\frac{\\partial f_C}{\\partial c_B} = \\frac{\\partial}{\\partial c_B}(k_1 c_A c_B - (k_2 + k_3) c_C) = k_1 c_A $$\n$$ J_{33} = \\frac{\\partial f_C}{\\partial c_C} = \\frac{\\partial}{\\partial c_C}(k_1 c_A c_B - (k_2 + k_3) c_C) = -(k_2 + k_3) $$\n\n综合这些元素，解析雅可比矩阵为：\n$$\nJ(\\mathbf{c}) = \\begin{bmatrix}\n-k_1 c_B  & -k_1 c_A  & k_2 \\\\\n-k_1 c_B  & -k_1 c_A  & k_3 \\\\\nk_1 c_B  & k_1 c_A  & -(k_2 + k_3)\n\\end{bmatrix}\n$$\n所有元素的单位都正确地为 $\\mathrm{s^{-1}}$。\n\n数值近似 $\\tilde{J}(\\mathbf{c})$ 使用二阶中心有限差分格式计算。其元素 $\\tilde{J}_{ij}$ 由下式给出：\n$$\n\\tilde{J}_{ij}(\\mathbf{c}) = \\frac{f_i(\\mathbf{c} + \\delta_j \\mathbf{e}_j) - f_i(\\mathbf{c} - \\delta_j \\mathbf{e}_j)}{2\\delta_j}\n$$\n其中 $\\mathbf{e}_j$ 是第 $j$ 个标准基向量。扰动 $\\delta_j$ 由一个标准的混合绝对-相对步长公式确定，以在浓度值大小悬殊时都能保持精度：\n$$\n\\delta_j = \\max\\left(\\delta_{\\min},\\, \\delta_{\\mathrm{rel}} \\cdot \\max(1, |c_j|)\\right)\n$$\n常数为 $\\delta_{\\mathrm{rel}} = 10^{-8}$ 和 $\\delta_{\\min} = 10^{-20}$。\n\n从中心差分近似的泰勒级数展开中可以得出一个关键的观察。该格式的截断误差为 $O(\\delta_j^2)$ 阶，并取决于函数的三阶导数。对于我们特定的速率函数 $f_i$，每个函数对于任何单个浓度变量 $c_j$ 最多是线性的。因此，所有形如 $\\frac{\\partial^2 f_i}{\\partial c_j^2}$ 的二阶偏导数均为零，所以所有 $n \\ge 2$ 的高阶导数 $\\frac{\\partial^n f_i}{\\partial c_j^n}$ 也均为零。这意味着对于此特定问题，中心差分格式的截断误差为零。因此，解析雅可比矩阵和数值雅可比矩阵应该完全相同，计算出的差值 $\\Delta_{\\max}$ 应只反映浮点舍入误差的大小，预计会是一个非常小的数。\n\n程序将通过实现两个分别对应解析和数值雅可比矩阵计算的函数来执行。第三个函数将实现物种生成速率方程。对于每个测试用例，程序将：\n1.  定义输入浓度向量 $\\mathbf{c}$ 和速率常数向量 $\\mathbf{k}$。\n2.  使用推导的公式计算解析雅可比矩阵 $J(\\mathbf{c})$。\n3.  使用有限差分公式逐列计算数值雅可比矩阵 $\\tilde{J}(\\mathbf{c})$，首先为每一列 $j$ 计算合适的 $\\delta_j$。\n4.  计算 $J$ 和 $\\tilde{J}$ 之间的元素级绝对差。\n5.  确定此差值的最大值 $\\Delta_{\\max}$。该值即为该测试用例的结果。\n所有测试用例的结果将被收集并按规定格式化。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum absolute entrywise difference between the analytic\n    and numerical Jacobians for a given set of test cases in a chemical kinetics problem.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple of (concentration_vector, rate_constant_vector).\n    # Units: c in mol/m^3, k1 in m^3/(mol*s), k2, k3 in s^-1.\n    test_cases = [\n        # Test 1: general case\n        (np.array([1.0, 2.0, 0.5]), np.array([10.0, 1.0, 0.1])),\n        # Test 2: edge with zeros\n        (np.array([0.0, 1.0, 0.0]), np.array([1000.0, 5.0, 0.0])),\n        # Test 3: stiff magnitudes and tiny concentrations\n        (np.array([1e-12, 1e-12, 1e-3]), np.array([1e9, 1e5, 2e5])),\n        # Test 4: large concentrations, mild rates\n        (np.array([100.0, 200.0, 300.0]), np.array([1e-3, 0.2, 0.3])),\n    ]\n\n    # Parameters for finite difference calculation\n    delta_rel = 1e-8\n    delta_min = 1e-20\n\n    results = []\n\n    def species_production_rate_f(c, k):\n        \"\"\"\n        Calculates the species production rate vector f(c).\n        c: concentration vector [c_A, c_B, c_C]\n        k: rate constant vector [k1, k2, k3]\n        Returns: rate vector [f_A, f_B, f_C]\n        \"\"\"\n        c_A, c_B, c_C = c\n        k1, k2, k3 = k\n        \n        # Reaction rates\n        r1 = k1 * c_A * c_B\n        r2 = k2 * c_C\n        r3 = k3 * c_C\n        \n        # Species production rates\n        f_A = -r1 + r2\n        f_B = -r1 + r3\n        f_C = r1 - r2 - r3\n        \n        return np.array([f_A, f_B, f_C])\n\n    def analytic_jacobian(c, k):\n        \"\"\"\n        Calculates the analytic Jacobian matrix J(c).\n        c: concentration vector [c_A, c_B, c_C]\n        k: rate constant vector [k1, k2, k3]\n        Returns: 3x3 analytic Jacobian matrix\n        \"\"\"\n        c_A, c_B, _ = c\n        k1, k2, k3 = k\n        \n        J = np.zeros((3, 3))\n        \n        # Row 1\n        J[0, 0] = -k1 * c_B\n        J[0, 1] = -k1 * c_A\n        J[0, 2] = k2\n        \n        # Row 2\n        J[1, 0] = -k1 * c_B\n        J[1, 1] = -k1 * c_A\n        J[1, 2] = k3\n        \n        # Row 3\n        J[2, 0] = k1 * c_B\n        J[2, 1] = k1 * c_A\n        J[2, 2] = -(k2 + k3)\n        \n        return J\n\n    def numerical_jacobian(c, k):\n        \"\"\"\n        Calculates the numerical Jacobian matrix J_tilde(c) using central differences.\n        c: concentration vector [c_A, c_B, c_C]\n        k: rate constant vector [k1, k2, k3]\n        Returns: 3x3 numerical Jacobian matrix\n        \"\"\"\n        num_species = len(c)\n        J_tilde = np.zeros((num_species, num_species))\n        \n        for j in range(num_species):\n            # Calculate perturbation delta_j\n            delta_j = max(delta_min, delta_rel * max(1.0, abs(c[j])))\n            \n            # Create perturbed concentration vectors\n            c_plus = c.copy()\n            c_minus = c.copy()\n            c_plus[j] += delta_j\n            c_minus[j] -= delta_j\n            \n            # Calculate production rates at perturbed points\n            f_plus = species_production_rate_f(c_plus, k)\n            f_minus = species_production_rate_f(c_minus, k)\n            \n            # Calculate the j-th column of the Jacobian\n            jacobian_col = (f_plus - f_minus) / (2 * delta_j)\n            J_tilde[:, j] = jacobian_col\n            \n        return J_tilde\n\n    for c_vec, k_vec in test_cases:\n        # Compute analytic and numerical Jacobians\n        J_analytic = analytic_jacobian(c_vec, k_vec)\n        J_numerical = numerical_jacobian(c_vec, k_vec)\n        \n        # Compute the maximum absolute entrywise difference\n        delta_max = np.max(np.abs(J_analytic - J_numerical))\n        results.append(delta_max)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.10e}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "理论的完美应用往往会遇到现实世界的“陷阱”，单位不一致就是其中最常见也最致命的一个。本练习模拟了一个在计算化学中极易发生的错误：直接使用了数据库中单位不匹配的反应速率常数。通过推导这个错误对雅可比矩阵范数（衡量其“大小”的指标）的影响，您将深刻体会到在科学计算中保持量纲一致性的极端重要性，以及一个微小的疏忽如何导致结果数量级的巨大偏差 。",
            "id": "4007169",
            "problem": "考虑一个空间均匀、恒压、恒温的气体混合物，其中发生了一个基元不可逆反应 $A + B \\rightarrow C$。设摩尔浓度分别用 $c_A$、$c_B$ 和 $c_C$ 表示，单位为 $\\text{mol/m}^3$。总摩尔浓度遵循理想气体关系 $c_{\\mathrm{tot}} = p/(R T)$，其中 $p$ 是压力，$T$ 是温度，$R$ 是通用气体常数，并且 $c_i = X_i c_{\\mathrm{tot}}$，其中 $X_i$ 是组分 $i$ 的摩尔分数。组分生成速率 $\\dot{\\omega}_i$ 的单位定义为 $\\mathrm{mol/(m^3 \\cdot s)}$，并遵循质量作用动力学，其正向反应进程速率为 $R_f = k_f c_A c_B$，其中 $k_f$ 是正向反应速率常数。各组分的源项为 $\\dot{\\omega}_A = -R_f$，$\\dot{\\omega}_B = -R_f$ 和 $\\dot{\\omega}_C = R_f$。化学源项关于摩尔浓度的雅可比矩阵是 $J$，其元素为 $J_{ij} = \\partial \\dot{\\omega}_i / \\partial c_j$。雅可比矩阵的大小由弗罗贝尼乌斯范数衡量，定义为 $\\|J\\|_F = \\left(\\sum_{i,j} J_{ij}^2\\right)^{1/2}$。\n\n一个动力学数据库以 $\\mathrm{cm^3/(mol \\cdot s)}$ 为单位列表提供了 $k_f$，但仿真代码以 $\\text{mol/m}^3$ 计算浓度，并以 $\\mathrm{mol/(m^3 \\cdot s)}$ 计算源项。从理想气体定律和 $R_f$ 的质量作用定义出发，推导为保持 $\\dot{\\omega}_i$ 单位一致性所需的 $k_f$ 的正确单位转换。然后，考虑这样一种情况：一位工程师错误地使用了数据库中列表的 $k_f$ 值而未进行单位转换，同时保持 $c_A$ 和 $c_B$ 的单位为 $\\text{mol/m}^3$。在这种错误下，确定雅可比矩阵的大小（由 $\\|J\\|_F$ 衡量）相对于单位正确的雅可比矩阵被缩放的确切乘法因子。将最终因子以单个实数值形式给出。无需四舍五入。",
            "solution": "该问题要求确定由于单位转换错误导致的化学雅可比矩阵大小的缩放因子。解题过程分为几个步骤：首先，确定速率常数的正确单位；其次，推导单位转换因子；第三，计算雅可比矩阵的一般符号形式及其弗罗贝尼乌斯范数；最后，比较有无单位错误时的范数以找到缩放因子。\n\n首先，我们分析单位以确保一致性。反应进程速率 $R_f$ 与组分生成速率 $\\dot{\\omega}_i$ 的单位相同，均为 $\\text{mol/(m}^3 \\cdot \\text{s)}$。反应进程速率由质量作用定律定义：\n$$R_f = k_f c_A c_B$$\n摩尔浓度 $c_A$ 和 $c_B$ 的单位为 $\\text{mol/m}^3$。为确保量纲一致性，速率常数 $k_f$ 的单位必须满足：\n$$[\\text{Units of } \\dot{\\omega}_i] = [\\text{Units of } k_f] \\times [\\text{Units of } c_A] \\times [\\text{Units of } c_B]$$\n代入已知单位：\n$$\\frac{\\mathrm{mol}}{\\mathrm{m^3 \\cdot s}} = [\\text{Units of } k_f] \\times \\left(\\frac{\\mathrm{mol}}{\\mathrm{m^3}}\\right) \\times \\left(\\frac{\\mathrm{mol}}{\\mathrm{m^3}}\\right)$$\n求解仿真代码所需的 $k_f$ 单位可得：\n$$[\\text{Units of } k_{f, \\text{correct}}] = \\frac{\\mathrm{mol}}{\\mathrm{m^3 \\cdot s}} \\cdot \\frac{\\mathrm{m^6}}{\\mathrm{mol^2}} = \\frac{\\mathrm{m^3}}{\\mathrm{mol \\cdot s}}$$\n动力学数据库以 $\\mathrm{cm^3/(mol \\cdot s)}$ 为单位提供速率常数，我们称之为 $k_{f, \\text{db}}$。立方米和立方厘米之间的转换关系是：\n$$1 \\, \\mathrm{m} = 100 \\, \\mathrm{cm} \\implies 1 \\, \\mathrm{m^3} = (100 \\, \\mathrm{cm})^3 = 10^6 \\, \\mathrm{cm^3}$$\n因此，$1 \\, \\mathrm{cm^3} = 10^{-6} \\, \\mathrm{m^3}$。\n为了将数据库的值转换为仿真所需的正确单位，我们必须应用这个因子。设数据库中的数值为 $k_0$。那么 $k_{f, \\text{db}} = k_0 \\, \\mathrm{cm^3/(mol \\cdot s)}$，正确转换后的速率常数为：\n$$k_{f, \\text{correct}} = k_0 \\times 10^{-6} \\, \\frac{\\mathrm{m^3}}{\\mathrm{mol \\cdot s}}$$\n\n接下来，我们构建化学源项的雅可比矩阵 $J$。组分索引为 $A, B, C$。组分源项向量 $\\dot{\\omega}$ 为：\n$$\\dot{\\omega} = \\begin{pmatrix} \\dot{\\omega}_A \\\\ \\dot{\\omega}_B \\\\ \\dot{\\omega}_C \\end{pmatrix} = \\begin{pmatrix} -k_f c_A c_B \\\\ -k_f c_A c_B \\\\ k_f c_A c_B \\end{pmatrix}$$\n雅可比矩阵的元素为 $J_{ij} = \\partial \\dot{\\omega}_i / \\partial c_j$，其中 $j$ 也遍历组分 $A, B, C$。我们计算偏导数：\n$$J_{Aj} = \\frac{\\partial \\dot{\\omega}_A}{\\partial c_j}: \\quad \\frac{\\partial (-k_f c_A c_B)}{\\partial c_A} = -k_f c_B, \\quad \\frac{\\partial (-k_f c_A c_B)}{\\partial c_B} = -k_f c_A, \\quad \\frac{\\partial (-k_f c_A c_B)}{\\partial c_C} = 0$$\n$$J_{Bj} = \\frac{\\partial \\dot{\\omega}_B}{\\partial c_j}: \\quad \\frac{\\partial (-k_f c_A c_B)}{\\partial c_A} = -k_f c_B, \\quad \\frac{\\partial (-k_f c_A c_B)}{\\partial c_B} = -k_f c_A, \\quad \\frac{\\partial (-k_f c_A c_B)}{\\partial c_C} = 0$$\n$$J_{Cj} = \\frac{\\partial \\dot{\\omega}_C}{\\partial c_j}: \\quad \\frac{\\partial (k_f c_A c_B)}{\\partial c_A} = k_f c_B, \\quad \\frac{\\partial (k_f c_A c_B)}{\\partial c_B} = k_f c_A, \\quad \\frac{\\partial (k_f c_A c_B)}{\\partial c_C} = 0$$\n将这些元素组合起来得到雅可比矩阵：\n$$J = \\begin{pmatrix}\n-k_f c_B  & -k_f c_A  & 0 \\\\\n-k_f c_B  & -k_f c_A  & 0 \\\\\nk_f c_B  & k_f c_A  & 0\n\\end{pmatrix}$$\n该矩阵的大小由弗罗贝尼乌斯范数 $\\|J\\|_F = \\left(\\sum_{i,j} J_{ij}^2\\right)^{1/2}$ 衡量。我们计算 $J$ 元素平方的和：\n$$\\sum_{i,j} J_{ij}^2 = (-k_f c_B)^2 + (-k_f c_A)^2 + 0^2 + (-k_f c_B)^2 + (-k_f c_A)^2 + 0^2 + (k_f c_B)^2 + (k_f c_A)^2 + 0^2$$\n$$\\sum_{i,j} J_{ij}^2 = 3(k_f^2 c_B^2) + 3(k_f^2 c_A^2) = 3 k_f^2 (c_A^2 + c_B^2)$$\n那么弗罗贝尼乌斯范数为：\n$$\\|J\\|_F = \\sqrt{3 k_f^2 (c_A^2 + c_B^2)} = k_f \\sqrt{3(c_A^2 + c_B^2)}$$\n我们假设 $k_f > 0$，这是正向反应速率常数的物理要求。\n\n现在，我们比较正确情况和错误情况下的范数。\n在正确情况下，$k_f = k_{f, \\text{correct}} = k_0 \\times 10^{-6} \\, \\mathrm{m^3/(mol \\cdot s)}$。正确计算的雅可比矩阵的大小为：\n$$\\|J_{\\text{correct}}\\|_F = (k_0 \\times 10^{-6}) \\sqrt{3(c_A^2 + c_B^2)}$$\n在错误情况下，工程师未经转换就使用了数据库中的数值 $k_0$。仿真代码将其解释为代码的原生单位。因此，错误的速率常数为 $k_{f, \\text{error}} = k_0 \\, \\mathrm{m^3/(mol \\cdot s)}$。错误计算的雅可比矩阵的大小为：\n$$\\|J_{\\text{error}}\\|_F = k_0 \\sqrt{3(c_A^2 + c_B^2)}$$\n问题要求的是大小被缩放的乘法因子。这是错误范数与正确范数的比值：\n$$\\text{因子} = \\frac{\\|J_{\\text{error}}\\|_F}{\\|J_{\\text{correct}}\\|_F} = \\frac{k_0 \\sqrt{3(c_A^2 + c_B^2)}}{(k_0 \\times 10^{-6}) \\sqrt{3(c_A^2 + c_B^2)}}$$\n项 $k_0$ 和 $\\sqrt{3(c_A^2 + c_B^2)}$ 被消去，剩下：\n$$\\text{因子} = \\frac{1}{10^{-6}} = 10^6$$\n单位错误导致雅可比矩阵的大小被缩放了一百万倍。",
            "answer": "$$\\boxed{10^6}$$"
        }
    ]
}