{
    "hands_on_practices": [
        {
            "introduction": "Understanding the Jacobian begins with its construction. This practice guides you through the fundamental process of deriving the Jacobian matrix from a given set of elementary reactions and their mass-action rate laws. By assembling the matrix for a small hydrogen-oxygen mechanism, you will develop a concrete intuition for how reaction stoichiometry and kinetics directly translate into the Jacobian's structure, including its characteristic sparsity. ",
            "id": "4007129",
            "problem": "Consider a constant-pressure, isothermal homogeneous reactor modeling a reduced hydrogen-oxygen ($H_2/O_2$) chemistry subset with three irreversible elementary reactions:\n1. $H_{2} + O \\rightarrow H + OH$\n2. $H + O_{2} \\rightarrow O + OH$\n3. $H_{2} + OH \\rightarrow H_{2}O + H$\n\nAssume ideal gas behavior and mass-action kinetics. Let the species concentration vector be ordered as $c = \\big(c_{H_{2}}, c_{O_{2}}, c_{O}, c_{H}, c_{OH}, c_{H_{2}O}\\big)$, with the following molar concentrations at temperature $T = 1200\\,\\mathrm{K}$ and pressure $p = 1\\,\\mathrm{atm}$:\n$c_{H_{2}} = 5.0\\,\\mathrm{mol/m^{3}}$, $c_{O_{2}} = 2.5\\,\\mathrm{mol/m^{3}}$, $c_{O} = 0.01\\,\\mathrm{mol/m^{3}}$, $c_{H} = 0.02\\,\\mathrm{mol/m^{3}}$, $c_{OH} = 0.03\\,\\mathrm{mol/m^{3}}$, $c_{H_{2}O} = 2.6\\,\\mathrm{mol/m^{3}}$. The temperature-dependent rate coefficients follow Arrhenius-type laws that are widely used in combustion kinetics:\n- Reaction $1$: $k_{1}(T) = A_{1}\\,\\exp\\!\\big(-T_{a,1}/T\\big)$, with $A_{1} = 3.51 \\times 10^{10}\\,\\mathrm{m^{3}/(mol\\,s)}$ and $T_{a,1} = 16599\\,\\mathrm{K}$.\n- Reaction $2$: $k_{2}(T) = A_{2}\\,T^{n_{2}}\\,\\exp\\!\\big(-T_{a,2}/T\\big)$, with $A_{2} = 2.65 \\times 10^{10}\\,\\mathrm{m^{3}/(mol\\,s)}$, $n_{2} = -0.670$, and $T_{a,2} = 17041\\,\\mathrm{K}$.\n- Reaction $3$: $k_{3}(T) = A_{3}\\,T^{n_{3}}\\,\\exp\\!\\big(-T_{a,3}/T\\big)$, with $A_{3} = 2.16 \\times 10^{2}\\,\\mathrm{m^{3}/(mol\\,s)}$, $n_{3} = 1.51$, and $T_{a,3} = 1726\\,\\mathrm{K}$.\n\nUsing these definitions, the reaction rates are $r_{1} = k_{1}\\,c_{H_{2}}\\,c_{O}$, $r_{2} = k_{2}\\,c_{H}\\,c_{O_{2}}$, and $r_{3} = k_{3}\\,c_{H_{2}}\\,c_{OH}$. The species production rates are given by the stoichiometric balances:\n$\\omega_{H_{2}} = -r_{1} - r_{3}$, $\\omega_{O_{2}} = -r_{2}$, $\\omega_{O} = -r_{1} + r_{2}$, $\\omega_{H} = r_{1} - r_{2} + r_{3}$, $\\omega_{OH} = r_{1} + r_{2} - r_{3}$, $\\omega_{H_{2}O} = r_{3}$. The chemical Jacobian matrix is defined as $J = \\frac{\\partial \\omega}{\\partial c}$, where the $(i,j)$ entry is $J_{ij} = \\frac{\\partial \\omega_{i}}{\\partial c_{j}}$.\n\nTask:\n- Starting from the mass-action rate laws and stoichiometry, assemble the full $6 \\times 6$ chemical Jacobian $J$ numerically at the given thermochemical state.\n- Using the assembled $J$, identify the zero and nonzero entries to verify sparsity and discuss whether nonzero cross-couplings $J_{ij}$ and $J_{ji}$ exhibit any symmetry in their sparsity pattern for the three-reaction subset.\n- Let the sparsity be defined as the fraction of zero entries in the full Jacobian matrix, i.e., the number of zero entries divided by $36$. Compute this sparsity as a real number and report it as the final answer.\n\nExpress the final sparsity value as a decimal rounded to four significant figures. No physical units should be included in the final answer.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n### Step 1: Extract Givens\n- **Species**: $H_{2}, O_{2}, O, H, OH, H_{2}O$.\n- **Species Concentration Vector**: $c = \\big(c_{H_{2}}, c_{O_{2}}, c_{O}, c_{H}, c_{OH}, c_{H_{2}O}\\big)$.\n- **Thermodynamic State**: Constant pressure $p = 1\\,\\mathrm{atm}$, isothermal temperature $T = 1200\\,\\mathrm{K}$.\n- **Molar Concentrations ($c_i$ in $\\mathrm{mol/m^{3}}$)**:\n  - $c_{H_{2}} = 5.0$\n  - $c_{O_{2}} = 2.5$\n  - $c_{O} = 0.01$\n  - $c_{H} = 0.02$\n  - $c_{OH} = 0.03$\n  - $c_{H_{2}O} = 2.6$\n- **Reactions (irreversible, elementary)**:\n  1. $H_{2} + O \\rightarrow H + OH$\n  2. $H + O_{2} \\rightarrow O + OH$\n  3. $H_{2} + OH \\rightarrow H_{2}O + H$\n- **Rate Coefficients ($k_i(T)$)**:\n  - $k_{1}(T) = A_{1}\\,\\exp(-T_{a,1}/T)$, with $A_{1} = 3.51 \\times 10^{10}\\,\\mathrm{m^{3}/(mol\\,s)}$, $T_{a,1} = 16599\\,\\mathrm{K}$.\n  - $k_{2}(T) = A_{2}\\,T^{n_{2}}\\,\\exp(-T_{a,2}/T)$, with $A_{2} = 2.65 \\times 10^{10}\\,\\mathrm{m^{3}/(mol\\,s)}$, $n_{2} = -0.670$, $T_{a,2} = 17041\\,\\mathrm{K}$.\n  - $k_{3}(T) = A_{3}\\,T^{n_{3}}\\,\\exp(-T_{a,3}/T)$, with $A_{3} = 2.16 \\times 10^{2}\\,\\mathrm{m^{3}/(mol\\,s)}$, $n_{3} = 1.51$, $T_{a,3} = 1726\\,\\mathrm{K}$.\n- **Reaction Rates (mass-action kinetics)**:\n  - $r_{1} = k_{1}\\,c_{H_{2}}\\,c_{O}$\n  - $r_{2} = k_{2}\\,c_{H}\\,c_{O_{2}}$\n  - $r_{3} = k_{3}\\,c_{H_{2}}\\,c_{OH}$\n- **Species Production Rates ($\\omega_i$)**:\n  - $\\omega_{H_{2}} = -r_{1} - r_{3}$\n  - $\\omega_{O_{2}} = -r_{2}$\n  - $\\omega_{O} = -r_{1} + r_{2}$\n  - $\\omega_{H} = r_{1} - r_{2} + r_{3}$\n  - $\\omega_{OH} = r_{1} + r_{2} - r_{3}$\n  - $\\omega_{H_{2}O} = r_{3}$\n- **Jacobian Definition**: $J = \\frac{\\partial \\omega}{\\partial c}$, with $J_{ij} = \\frac{\\partial \\omega_{i}}{\\partial c_{j}}$.\n- **Task**: Assemble the numerical $6 \\times 6$ Jacobian $J$, analyze its sparsity pattern and symmetry, and compute the sparsity (fraction of zero entries) rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is based on fundamental principles of chemical kinetics, specifically mass-action rate laws and Arrhenius-type temperature dependence, which are standard in computational combustion. The chemical mechanism is a recognized and valid subset of hydrogen-oxygen chemistry. The data provided are physically realistic for a high-temperature reacting flow.\n- **Well-Posed**: The problem is clearly defined. All necessary data (concentrations, rate parameters, temperature) and definitions (reaction rates, production rates, Jacobian matrix) are provided. This allows for the calculation of a single, unique numerical Jacobian matrix.\n- **Objective**: The problem is stated using precise, unbiased, and formal scientific language. There are no subjective elements.\n- **Completeness and Consistency**: The problem is self-contained. The definitions are consistent with standard chemical kinetics literature. There are no missing data or contradictory constraints. The isothermal condition simplifies the problem by making rate coefficients independent of concentration changes, which is standard for the definition of the chemical Jacobian.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. A full solution will be provided.\n\n### Solution\nThe task is to determine the chemical Jacobian matrix, $J$, for the given reaction mechanism and thermochemical state, and then to compute its sparsity. The species are indexed as follows: $1: H_2$, $2: O_2$, $3: O$, $4: H$, $5: OH$, $6: H_2O$.\n\nFirst, we express the species production rates, $\\omega_i$, as explicit functions of the species concentrations, $c_j$.\n$$ \\omega_{H_{2}} (\\omega_1) = -k_1 c_{H_2} c_O - k_3 c_{H_2} c_{OH} $$\n$$ \\omega_{O_{2}} (\\omega_2) = -k_2 c_H c_{O_2} $$\n$$ \\omega_{O} (\\omega_3) = -k_1 c_{H_2} c_O + k_2 c_H c_{O_2} $$\n$$ \\omega_{H} (\\omega_4) = k_1 c_{H_2} c_O - k_2 c_H c_{O_2} + k_3 c_{H_2} c_{OH} $$\n$$ \\omega_{OH} (\\omega_5) = k_1 c_{H_2} c_O + k_2 c_H c_{O_2} - k_3 c_{H_2} c_{OH} $$\n$$ \\omega_{H_{2}O} (\\omega_6) = k_3 c_{H_2} c_{OH} $$\n\nThe Jacobian matrix entries are given by $J_{ij} = \\frac{\\partial \\omega_i}{\\partial c_j}$. We derive the analytical form of each entry by differentiating the production rate expressions. For example, for the first row ($i=1$, corresponding to $H_2$):\n$J_{11} = \\frac{\\partial \\omega_1}{\\partial c_1} = \\frac{\\partial}{\\partial c_{H_2}}(-k_1 c_{H_2} c_O - k_3 c_{H_2} c_{OH}) = -k_1 c_O - k_3 c_{OH}$\n$J_{12} = \\frac{\\partial \\omega_1}{\\partial c_2} = \\frac{\\partial}{\\partial c_{O_2}}(-k_1 c_{H_2} c_O - k_3 c_{H_2} c_{OH}) = 0$\n$J_{13} = \\frac{\\partial \\omega_1}{\\partial c_3} = \\frac{\\partial}{\\partial c_{O}}(-k_1 c_{H_2} c_O - k_3 c_{H_2} c_{OH}) = -k_1 c_{H_2}$\nAnd so on. Applying this procedure for all $36$ entries yields the analytical Jacobian matrix:\n$$\nJ = \\begin{pmatrix}\n-k_1 c_O - k_3 c_{OH} & 0 & -k_1 c_{H_2} & 0 & -k_3 c_{H_2} & 0 \\\\\n0 & -k_2 c_H & 0 & -k_2 c_{O_2} & 0 & 0 \\\\\n-k_1 c_O & k_2 c_H & -k_1 c_{H_2} & k_2 c_{O_2} & 0 & 0 \\\\\nk_1 c_O + k_3 c_{OH} & -k_2 c_H & k_1 c_{H_2} & -k_2 c_{O_2} & k_3 c_{H_2} & 0 \\\\\nk_1 c_O - k_3 c_{OH} & k_2 c_H & k_1 c_{H_2} & k_2 c_{O_2} & -k_3 c_{H_2} & 0 \\\\\nk_3 c_{OH} & 0 & 0 & 0 & k_3 c_{H_2} & 0\n\\end{pmatrix}\n$$\nThis structure reveals the sparsity pattern. The final column is entirely zero because $H_2O$ is only a product in this irreversible mechanism, so its concentration does not affect any reaction rate. Similarly, many other entries are zero because a given species $j$ does not appear as a reactant in any of the reactions contributing to the production rate of species $i$.\n\nNext, we calculate the numerical values of the rate coefficients at $T = 1200\\,\\mathrm{K}$:\n$k_1 = (3.51 \\times 10^{10}) \\exp\\left(-\\frac{16599}{1200}\\right) \\approx 3.4514 \\times 10^{4}\\,\\mathrm{m^3/(mol \\cdot s)}$\n$k_2 = (2.65 \\times 10^{10}) (1200)^{-0.670} \\exp\\left(-\\frac{17041}{1200}\\right) \\approx 1.8914 \\times 10^{2}\\,\\mathrm{m^3/(mol \\cdot s)}$\n$k_3 = (2.16 \\times 10^{2}) (1200)^{1.51} \\exp\\left(-\\frac{1726}{1200}\\right) \\approx 2.2631 \\times 10^{6}\\,\\mathrm{m^3/(mol \\cdot s)}$\n\nUsing these values and the given concentrations, we compute the terms appearing in the Jacobian:\n$k_1 c_O = (3.4514 \\times 10^4)(0.01) \\approx 3.451 \\times 10^2$\n$k_1 c_{H_2} = (3.4514 \\times 10^4)(5.0) \\approx 1.726 \\times 10^5$\n$k_2 c_H = (1.8914 \\times 10^2)(0.02) \\approx 3.783$\n$k_2 c_{O_2} = (1.8914 \\times 10^2)(2.5) \\approx 4.728 \\times 10^2$\n$k_3 c_{OH} = (2.2631 \\times 10^6)(0.03) \\approx 6.789 \\times 10^4$\n$k_3 c_{H_2} = (2.2631 \\times 10^6)(5.0) \\approx 1.132 \\times 10^7$\n\nSubstituting these values into the analytical Jacobian matrix gives the numerical Jacobian $J$:\n$J_{11} \\approx -3.451 \\times 10^2 - 6.789 \\times 10^4 = -6.824 \\times 10^4$\n$J_{13} \\approx -1.726 \\times 10^5$\n$J_{15} \\approx -1.132 \\times 10^7$\n...and so on for all non-zero entries. The fully assembled numerical Jacobian is (with values in $s^{-1}$):\n$$\nJ \\approx \\begin{pmatrix}\n-6.82 \\times 10^4 & 0 & -1.73 \\times 10^5 & 0 & -1.13 \\times 10^7 & 0 \\\\\n0 & -3.78 & 0 & -4.73 \\times 10^2 & 0 & 0 \\\\\n-3.45 \\times 10^2 & 3.78 & -1.73 \\times 10^5 & 4.73 \\times 10^2 & 0 & 0 \\\\\n6.82 \\times 10^4 & -3.78 & 1.73 \\times 10^5 & -4.73 \\times 10^2 & 1.13 \\times 10^7 & 0 \\\\\n-6.75 \\times 10^4 & 3.78 & 1.73 \\times 10^5 & 4.73 \\times 10^2 & -1.13 \\times 10^7 & 0 \\\\\n6.79 \\times 10^4 & 0 & 0 & 0 & 1.13 \\times 10^7 & 0\n\\end{pmatrix}\n$$\n\nThe sparsity pattern of the Jacobian, where `N` denotes a non-zero entry and `Z` denotes a zero entry, is:\n$$\n\\text{Sparsity Pattern} = \\begin{pmatrix}\nN & Z & N & Z & N & Z \\\\\nZ & N & Z & N & Z & Z \\\\\nN & N & N & N & Z & Z \\\\\nN & N & N & N & N & Z \\\\\nN & N & N & N & N & Z \\\\\nN & Z & Z & Z & N & Z\n\\end{pmatrix}\n$$\nThe sparsity pattern is not symmetric. For example, $J_{23} = 0$ while $J_{32} = k_2 c_H \\neq 0$. This asymmetry is a general feature of chemical Jacobians. Physically, it means the influence of species $j$'s concentration on the production rate of species $i$ is not necessarily related to the influence of species $i$'s concentration on the production rate of species $j$. In this case, the concentration of atomic oxygen ($O$, species $3$) does not affect the rate of reaction $2$, which is the only reaction affecting the net production rate of molecular oxygen ($O_2$, species $2$). Thus, $\\frac{\\partial \\omega_{O_2}}{\\partial c_O} = 0$. However, the concentration of molecular oxygen does affect the rate of reaction $2$, which contributes to the production rate of atomic oxygen, so $\\frac{\\partial \\omega_O}{\\partial c_{O_2}} \\neq 0$.\n\nTo calculate the sparsity, we count the number of zero entries.\n- Row 1: $3$ zeros\n- Row 2: $4$ zeros\n- Row 3: $2$ zeros\n- Row 4: $1$ zero\n- Row 5: $1$ zero\n- Row 6: $4$ zeros\nThe total number of zero entries is $3+4+2+1+1+4 = 15$.\nThe total number of entries in the $6 \\times 6$ matrix is $36$.\nSparsity is the fraction of zero entries:\n$$ \\text{Sparsity} = \\frac{\\text{Number of zero entries}}{\\text{Total number of entries}} = \\frac{15}{36} = \\frac{5}{12} $$\nAs a decimal, this is $5 \\div 12 \\approx 0.416666...$.\nRounding to four significant figures gives $0.4167$.",
            "answer": "$$\\boxed{0.4167}$$"
        },
        {
            "introduction": "In computational science, a critical step is verifying that an analytically derived expression is implemented correctly. This exercise puts you in the role of a code developer, tasking you with creating a numerical test to validate an analytic Jacobian. By comparing your analytic results against a carefully constructed finite-difference approximation, you will practice a cornerstone technique for building robust and reliable simulation tools. ",
            "id": "4007106",
            "problem": "Consider a homogeneous, isothermal, constant-volume reacting system with three chemical species $A$, $B$, and $C$, whose state is represented by the concentration vector $\\mathbf{c} = [c_A, c_B, c_C]^\\top$ in units of $\\mathrm{mol/m^3}$. Assume elementary mass-action kinetics and the following reaction mechanism with scientifically consistent stoichiometry and rate expressions:\n\n- Reaction $\\mathrm{R1}$: $A + B \\rightarrow C$ with forward rate $r_1 = k_1 c_A c_B$, where $k_1$ has units $\\mathrm{m^3/(mol \\cdot s)}$.\n- Reaction $\\mathrm{R2}$: $C \\rightarrow A$ with rate $r_2 = k_2 c_C$, where $k_2$ has units $\\mathrm{s^{-1}}$.\n- Reaction $\\mathrm{R3}$: $C \\rightarrow B$ with rate $r_3 = k_3 c_C$, where $k_3$ has units $\\mathrm{s^{-1}}$.\n\nLet the net stoichiometric change vectors per reaction be\n$$\n\\boldsymbol{\\nu}_1 = \\begin{bmatrix}-1\\\\-1\\\\+1\\end{bmatrix},\\quad\n\\boldsymbol{\\nu}_2 = \\begin{bmatrix}+1\\\\0\\\\-1\\end{bmatrix},\\quad\n\\boldsymbol{\\nu}_3 = \\begin{bmatrix}0\\\\+1\\\\-1\\end{bmatrix},\n$$\nall expressed in molecules per reaction event and applied to concentration dynamics via the Law of Mass Action. The species production rate vector $\\mathbf{f}(\\mathbf{c}) = \\frac{d\\mathbf{c}}{dt}$ in units of $\\mathrm{mol/(m^3 \\cdot s)}$ is given by the sum of contributions from each reaction according to fundamental principles:\n$$\n\\mathbf{f}(\\mathbf{c}) = \\boldsymbol{\\nu}_1 r_1 + \\boldsymbol{\\nu}_2 r_2 + \\boldsymbol{\\nu}_3 r_3.\n$$\n\nDefine the chemical Jacobian matrix as the matrix of partial derivatives\n$$\nJ(\\mathbf{c}) = \\left[\\frac{\\partial f_i(\\mathbf{c})}{\\partial c_j}\\right]_{i,j=1}^3,\n$$\nwith entries in units of $\\mathrm{s^{-1}}$.\n\nYour task is to design and implement a program that, for specified parameter sets, computes:\n- the analytic Jacobian $J(\\mathbf{c})$ derived from first principles (mass-action rate laws and stoichiometry),\n- a central finite difference approximation $\\tilde{J}(\\mathbf{c})$ with entries\n$$\n\\tilde{J}_{ij}(\\mathbf{c}) \\approx \\frac{f_i(\\mathbf{c} + \\delta_j \\mathbf{e}_j) - f_i(\\mathbf{c} - \\delta_j \\mathbf{e}_j)}{2\\delta_j},\n$$\nwhere $\\mathbf{e}_j$ is the $j$-th standard basis vector and the perturbation magnitudes are chosen as\n$$\n\\delta_j = \\max\\left(\\delta_{\\min},\\, \\delta_{\\mathrm{rel}} \\cdot \\max(1, |c_j|)\\right).\n$$\nUse $\\delta_{\\mathrm{rel}} = 10^{-8}$ and $\\delta_{\\min} = 10^{-20}$.\n\nFor each test case, compute the maximum absolute entrywise difference\n$$\n\\Delta_{\\max} = \\max_{i,j} \\left| J_{ij}(\\mathbf{c}) - \\tilde{J}_{ij}(\\mathbf{c}) \\right|,\n$$\nand report this value as a float in $\\mathrm{s^{-1}}$.\n\nImplement the program to evaluate the following test suite, each test case specified by $(\\mathbf{c}, \\mathbf{k})$ where $\\mathbf{k} = [k_1, k_2, k_3]$:\n- Test $1$ (general case): $\\mathbf{c} = [1.0, 2.0, 0.5]$ $\\mathrm{mol/m^3}$, $\\mathbf{k} = [10.0, 1.0, 0.1]$ with $k_1$ in $\\mathrm{m^3/(mol \\cdot s)}$, $k_2$ and $k_3$ in $\\mathrm{s^{-1}}$.\n- Test $2$ (edge with zeros): $\\mathbf{c} = [0.0, 1.0, 0.0]$ $\\mathrm{mol/m^3}$, $\\mathbf{k} = [1000.0, 5.0, 0.0]$ with units as above.\n- Test $3$ (stiff magnitudes and tiny concentrations): $\\mathbf{c} = [10^{-12}, 10^{-12}, 10^{-3}]$ $\\mathrm{mol/m^3}$, $\\mathbf{k} = [10^{9}, 10^{5}, 2 \\times 10^{5}]$ with units as above.\n- Test $4$ (large concentrations, mild rates): $\\mathbf{c} = [100.0, 200.0, 300.0]$ $\\mathrm{mol/m^3}$, $\\mathbf{k} = [10^{-3}, 0.2, 0.3]$ with units as above.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[x_1,x_2,x_3,x_4]$), where each $x_i$ is the value of $\\Delta_{\\max}$ in $\\mathrm{s^{-1}}$ for the corresponding test case. No additional text should be printed. Angles are not involved, and thus no angle unit is required. Percentages are not involved. Ensure scientific realism by adhering to the specified units and definitions throughout the computation, and express all outputs in $\\mathrm{s^{-1}}$.",
            "solution": "The problem statement is evaluated as valid. It is scientifically grounded in the principles of chemical kinetics, mathematically well-posed, and all necessary parameters and definitions for a unique solution are provided.\n\nThe core of the problem is to compare the analytically derived chemical Jacobian matrix with its numerical approximation via finite differences for a given reaction system.\n\nFirst, we must establish the explicit form of the species production rate vector, $\\mathbf{f}(\\mathbf{c})$. The state vector is $\\mathbf{c} = [c_A, c_B, c_C]^\\top$. The problem provides the reactions, rate expressions, and stoichiometric vectors:\n- Reaction $\\mathrm{R1}$: $A + B \\rightarrow C$, with rate $r_1 = k_1 c_A c_B$ and stoichiometric vector $\\boldsymbol{\\nu}_1 = [-1, -1, +1]^\\top$.\n- Reaction $\\mathrm{R2}$: $C \\rightarrow A$, with rate $r_2 = k_2 c_C$ and stoichiometric vector $\\boldsymbol{\\nu}_2 = [+1, 0, -1]^\\top$.\n- Reaction $\\mathrm{R3}$: $C \\rightarrow B$, with rate $r_3 = k_3 c_C$ and stoichiometric vector $\\boldsymbol{\\nu}_3 = [0, +1, -1]^\\top$.\n\nThe species production rate vector $\\mathbf{f}(\\mathbf{c}) = [f_A(\\mathbf{c}), f_B(\\mathbf{c}), f_C(\\mathbf{c})]^\\top$ is given by the fundamental relation $\\mathbf{f}(\\mathbf{c}) = \\sum_k \\boldsymbol{\\nu}_k r_k$.\n$$\n\\mathbf{f}(\\mathbf{c}) = \\frac{d\\mathbf{c}}{dt} = \\boldsymbol{\\nu}_1 r_1 + \\boldsymbol{\\nu}_2 r_2 + \\boldsymbol{\\nu}_3 r_3 = \\begin{bmatrix}-1\\\\-1\\\\+1\\end{bmatrix} (k_1 c_A c_B) + \\begin{bmatrix}+1\\\\0\\\\-1\\end{bmatrix} (k_2 c_C) + \\begin{bmatrix}0\\\\+1\\\\-1\\end{bmatrix} (k_3 c_C)\n$$\nThis yields the individual rate equations for each species:\n$$ f_A(\\mathbf{c}) = \\frac{dc_A}{dt} = -k_1 c_A c_B + k_2 c_C $$\n$$ f_B(\\mathbf{c}) = \\frac{dc_B}{dt} = -k_1 c_A c_B + k_3 c_C $$\n$$ f_C(\\mathbf{c}) = \\frac{dc_C}{dt} = k_1 c_A c_B - k_2 c_C - k_3 c_C = k_1 c_A c_B - (k_2 + k_3) c_C $$\n\nNext, we derive the analytic Jacobian matrix, $J(\\mathbf{c})$, defined by its entries $J_{ij} = \\frac{\\partial f_i}{\\partial c_j}$. We let the species indices be $1 \\leftrightarrow A$, $2 \\leftrightarrow B$, $3 \\leftrightarrow C$.\n\nThe partial derivatives are calculated as follows:\n\nRow 1 ($f_A$ derivatives):\n$$ J_{11} = \\frac{\\partial f_A}{\\partial c_A} = \\frac{\\partial}{\\partial c_A}(-k_1 c_A c_B + k_2 c_C) = -k_1 c_B $$\n$$ J_{12} = \\frac{\\partial f_A}{\\partial c_B} = \\frac{\\partial}{\\partial c_B}(-k_1 c_A c_B + k_2 c_C) = -k_1 c_A $$\n$$ J_{13} = \\frac{\\partial f_A}{\\partial c_C} = \\frac{\\partial}{\\partial c_C}(-k_1 c_A c_B + k_2 c_C) = k_2 $$\n\nRow 2 ($f_B$ derivatives):\n$$ J_{21} = \\frac{\\partial f_B}{\\partial c_A} = \\frac{\\partial}{\\partial c_A}(-k_1 c_A c_B + k_3 c_C) = -k_1 c_B $$\n$$ J_{22} = \\frac{\\partial f_B}{\\partial c_B} = \\frac{\\partial}{\\partial c_B}(-k_1 c_A c_B + k_3 c_C) = -k_1 c_A $$\n$$ J_{23} = \\frac{\\partial f_B}{\\partial c_C} = \\frac{\\partial}{\\partial c_C}(-k_1 c_A c_B + k_3 c_C) = k_3 $$\n\nRow 3 ($f_C$ derivatives):\n$$ J_{31} = \\frac{\\partial f_C}{\\partial c_A} = \\frac{\\partial}{\\partial c_A}(k_1 c_A c_B - (k_2 + k_3) c_C) = k_1 c_B $$\n$$ J_{32} = \\frac{\\partial f_C}{\\partial c_B} = \\frac{\\partial}{\\partial c_B}(k_1 c_A c_B - (k_2 + k_3) c_C) = k_1 c_A $$\n$$ J_{33} = \\frac{\\partial f_C}{\\partial c_C} = \\frac{\\partial}{\\partial c_C}(k_1 c_A c_B - (k_2 + k_3) c_C) = -(k_2 + k_3) $$\n\nCombining these entries, the analytic Jacobian matrix is:\n$$\nJ(\\mathbf{c}) = \\begin{bmatrix}\n-k_1 c_B & -k_1 c_A & k_2 \\\\\n-k_1 c_B & -k_1 c_A & k_3 \\\\\nk_1 c_B & k_1 c_A & -(k_2 + k_3)\n\\end{bmatrix}\n$$\nAll entries correctly have units of $\\mathrm{s^{-1}}$.\n\nThe numerical approximation $\\tilde{J}(\\mathbf{c})$ is computed using a second-order central finite difference scheme. The entries $\\tilde{J}_{ij}$ are given by:\n$$\n\\tilde{J}_{ij}(\\mathbf{c}) = \\frac{f_i(\\mathbf{c} + \\delta_j \\mathbf{e}_j) - f_i(\\mathbf{c} - \\delta_j \\mathbf{e}_j)}{2\\delta_j}\n$$\nwhere $\\mathbf{e}_j$ is the $j$-th standard basis vector. The perturbation $\\delta_j$ is determined by a standard mixed absolute-relative step size formula to maintain accuracy for both large and small concentration values:\n$$\n\\delta_j = \\max\\left(\\delta_{\\min},\\, \\delta_{\\mathrm{rel}} \\cdot \\max(1, |c_j|)\\right)\n$$\nwith constants $\\delta_{\\mathrm{rel}} = 10^{-8}$ and $\\delta_{\\min} = 10^{-20}$.\n\nA crucial observation arises from the Taylor series expansion of the central difference approximation. The truncation error of this scheme is of order $O(\\delta_j^2)$ and depends on the third derivative of the function. For our specific rate functions $f_i$, each is at most linear in any single concentration variable $c_j$. As a result, all second partial derivatives of the form $\\frac{\\partial^2 f_i}{\\partial c_j^2}$ are zero, and consequently, all higher-order derivatives $\\frac{\\partial^n f_i}{\\partial c_j^n}$ for $n \\ge 2$ are also zero. This implies that the central difference scheme has zero truncation error for this particular problem. Therefore, the analytic and numerical Jacobians should be identical, and the calculated difference $\\Delta_{\\max}$ should only reflect the magnitude of floating-point round-off error, which is expected to be a very small number.\n\nThe program will proceed by implementing two functions corresponding to the analytic and numerical Jacobian calculations. A third function will implement the species production rate equations. For each test case, the program will:\n1.  Define the input concentration vector $\\mathbf{c}$ and rate constant vector $\\mathbf{k}$.\n2.  Calculate the analytic Jacobian $J(\\mathbf{c})$ using the derived formula.\n3.  Calculate the numerical Jacobian $\\tilde{J}(\\mathbf{c})$ column-by-column using the finite difference formula, first computing the appropriate $\\delta_j$ for each column $j$.\n4.  Compute the entrywise absolute difference between $J$ and $\\tilde{J}$.\n5.  Determine the maximum value of this difference, $\\Delta_{\\max}$. This value is the result for the test case.\nThe results from all test cases will be collected and formatted as specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum absolute entrywise difference between the analytic\n    and numerical Jacobians for a given set of test cases in a chemical kinetics problem.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple of (concentration_vector, rate_constant_vector).\n    # Units: c in mol/m^3, k1 in m^3/(mol*s), k2, k3 in s^-1.\n    test_cases = [\n        # Test 1: general case\n        (np.array([1.0, 2.0, 0.5]), np.array([10.0, 1.0, 0.1])),\n        # Test 2: edge with zeros\n        (np.array([0.0, 1.0, 0.0]), np.array([1000.0, 5.0, 0.0])),\n        # Test 3: stiff magnitudes and tiny concentrations\n        (np.array([1e-12, 1e-12, 1e-3]), np.array([1e9, 1e5, 2e5])),\n        # Test 4: large concentrations, mild rates\n        (np.array([100.0, 200.0, 300.0]), np.array([1e-3, 0.2, 0.3])),\n    ]\n\n    # Parameters for finite difference calculation\n    delta_rel = 1e-8\n    delta_min = 1e-20\n\n    results = []\n\n    def species_production_rate_f(c, k):\n        \"\"\"\n        Calculates the species production rate vector f(c).\n        c: concentration vector [c_A, c_B, c_C]\n        k: rate constant vector [k1, k2, k3]\n        Returns: rate vector [f_A, f_B, f_C]\n        \"\"\"\n        c_A, c_B, c_C = c\n        k1, k2, k3 = k\n        \n        # Reaction rates\n        r1 = k1 * c_A * c_B\n        r2 = k2 * c_C\n        r3 = k3 * c_C\n        \n        # Species production rates\n        f_A = -r1 + r2\n        f_B = -r1 + r3\n        f_C = r1 - r2 - r3\n        \n        return np.array([f_A, f_B, f_C])\n\n    def analytic_jacobian(c, k):\n        \"\"\"\n        Calculates the analytic Jacobian matrix J(c).\n        c: concentration vector [c_A, c_B, c_C]\n        k: rate constant vector [k1, k2, k3]\n        Returns: 3x3 analytic Jacobian matrix\n        \"\"\"\n        c_A, c_B, _ = c\n        k1, k2, k3 = k\n        \n        J = np.zeros((3, 3))\n        \n        # Row 1\n        J[0, 0] = -k1 * c_B\n        J[0, 1] = -k1 * c_A\n        J[0, 2] = k2\n        \n        # Row 2\n        J[1, 0] = -k1 * c_B\n        J[1, 1] = -k1 * c_A\n        J[1, 2] = k3\n        \n        # Row 3\n        J[2, 0] = k1 * c_B\n        J[2, 1] = k1 * c_A\n        J[2, 2] = -(k2 + k3)\n        \n        return J\n\n    def numerical_jacobian(c, k):\n        \"\"\"\n        Calculates the numerical Jacobian matrix J_tilde(c) using central differences.\n        c: concentration vector [c_A, c_B, c_C]\n        k: rate constant vector [k1, k2, k3]\n        Returns: 3x3 numerical Jacobian matrix\n        \"\"\"\n        num_species = len(c)\n        J_tilde = np.zeros((num_species, num_species))\n        \n        for j in range(num_species):\n            # Calculate perturbation delta_j\n            delta_j = max(delta_min, delta_rel * max(1.0, abs(c[j])))\n            \n            # Create perturbed concentration vectors\n            c_plus = c.copy()\n            c_minus = c.copy()\n            c_plus[j] += delta_j\n            c_minus[j] -= delta_j\n            \n            # Calculate production rates at perturbed points\n            f_plus = species_production_rate_f(c_plus, k)\n            f_minus = species_production_rate_f(c_minus, k)\n            \n            # Calculate the j-th column of the Jacobian\n            jacobian_col = (f_plus - f_minus) / (2 * delta_j)\n            J_tilde[:, j] = jacobian_col\n            \n        return J_tilde\n\n    for c_vec, k_vec in test_cases:\n        # Compute analytic and numerical Jacobians\n        J_analytic = analytic_jacobian(c_vec, k_vec)\n        J_numerical = numerical_jacobian(c_vec, k_vec)\n        \n        # Compute the maximum absolute entrywise difference\n        delta_max = np.max(np.abs(J_analytic - J_numerical))\n        results.append(delta_max)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.10e}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Real-world combustion simulations involve complex interactions where chemical kinetics are tightly coupled with thermodynamics. This practice elevates the verification challenge to a full thermo-chemical system, where temperature and composition are interdependent state variables. You will analyze and select reliable methods for numerically approximating the Jacobian, forcing you to consider subtle but critical details like mass-fraction constraints and the dependence of thermodynamic properties on the state. ",
            "id": "4007109",
            "problem": "A homogeneous, adiabatic, constant-pressure reactor with a mixture of $N_{\\mathrm{s}}$ species is modeled with the state vector $\\,\\mathbf{U} = \\big(Y_{1},\\dots,Y_{N_{\\mathrm{s}}-1},T\\big)^{\\top}\\,$, where $\\,Y_{N_{\\mathrm{s}}} = 1 - \\sum_{k=1}^{N_{\\mathrm{s}}-1} Y_{k}\\,$ enforces the unity mass-fraction constraint. Let $\\,\\omega_{k}(\\mathbf{U})\\,$ denote the chemical mass production rate of species $\\,k\\,$ per unit volume, with the sign convention that $\\,\\omega_{k} > 0\\,$ when species $\\,k\\,$ is produced. The mixture density is $\\,\\rho(\\mathbf{U})\\,$, the specific heat at constant pressure is $\\,c_{p}(\\mathbf{U})\\,$, and the species specific enthalpies are $\\,h_{k}(\\mathbf{U})\\,$. Under the constant-pressure assumption, the governing Ordinary Differential Equations (ODEs) for the homogeneous reactor are written in source-term form as\n$$\n\\frac{\\mathrm{d}Y_{i}}{\\mathrm{d}t} = \\frac{\\omega_{i}(\\mathbf{U})}{\\rho(\\mathbf{U})}\\quad\\text{for } i \\in \\{1,\\dots,N_{\\mathrm{s}}-1\\},\\qquad\n\\frac{\\mathrm{d}T}{\\mathrm{d}t} = -\\frac{1}{\\rho(\\mathbf{U})\\,c_{p}(\\mathbf{U})}\\sum_{k=1}^{N_{\\mathrm{s}}} h_{k}(\\mathbf{U})\\,\\omega_{k}(\\mathbf{U}) \\, .\n$$\nDefine the source-term vector $\\,\\mathbf{F}(\\mathbf{U})\\,$ by stacking the right-hand sides,\n$$\n\\mathbf{F}(\\mathbf{U}) \\equiv \\begin{bmatrix} \\omega_{1}(\\mathbf{U})/\\rho(\\mathbf{U}) \\\\ \\vdots \\\\ \\omega_{N_{\\mathrm{s}}-1}(\\mathbf{U})/\\rho(\\mathbf{U}) \\\\[4pt] -\\left(\\rho(\\mathbf{U})\\,c_{p}(\\mathbf{U})\\right)^{-1}\\sum_{k=1}^{N_{\\mathrm{s}}} h_{k}(\\mathbf{U})\\,\\omega_{k}(\\mathbf{U}) \\end{bmatrix} \\, ,\n$$\nand the associated chemical Jacobian (with respect to $\\,\\mathbf{U}\\,$) as $\\,\\mathbf{J}_{\\mathrm{a}}(\\mathbf{U}) \\equiv \\partial \\mathbf{F}(\\mathbf{U})/\\partial \\mathbf{U}\\,$. An in-house analytic generator produces $\\,\\mathbf{J}_{\\mathrm{a}}(\\mathbf{U})\\,$ automatically. To guard against sign-convention errors in the generated entries, you are asked to design an automated verification that perturbs each component of $\\,\\mathbf{U}\\,$ and compares the resulting source-term responses.\n\nStarting only from the definitions above, select all verification designs that will reliably detect a sign mistake in a nonzero entry of $\\,\\mathbf{J}_{\\mathrm{a}}(\\mathbf{U})\\,$ while respecting thermodynamic and compositional constraints. A design is considered reliable if, for entries whose true magnitude exceeds a specified small threshold $\\,\\tau_{\\mathrm{s}} > 0\\,$, it will correctly flag a sign mismatch without being confounded by the $\\,Y$-sum constraint or by thermodynamic property updates.\n\nA. For each independent component $\\,U_{j}\\,$ of $\\,\\mathbf{U}\\,$, form symmetric perturbations $\\,\\mathbf{U}^{\\pm} = \\mathbf{U} \\pm \\varepsilon\\,\\mathbf{e}_{j}\\,$, where $\\,\\mathbf{e}_{j}\\,$ is the $\\,j$-th unit vector in the independent variables $\\,(Y_{1},\\dots,Y_{N_{\\mathrm{s}}-1},T)\\,$. When perturbing a mass fraction $\\,Y_{j}\\,$, enforce $\\,Y_{N_{\\mathrm{s}}} = 1 - \\sum_{k=1}^{N_{\\mathrm{s}}-1} Y_{k}\\,$ after the perturbation. For each perturbed state, recompute all derived thermodynamic quantities $\\,\\rho,\\,c_{p},\\,h_{k}\\,$ consistently from the equation of state and thermochemistry at the perturbed $\\,\\mathbf{U}^{\\pm}\\,$. Approximate the $\\,j$-th column of the numerical Jacobian by the central difference\n$$\n\\mathbf{J}_{\\mathrm{num}}^{(:,j)} \\approx \\frac{\\mathbf{F}(\\mathbf{U}^{+}) - \\mathbf{F}(\\mathbf{U}^{-})}{2\\,\\varepsilon} \\, ,\n$$\nwith a step $\\,\\varepsilon = \\eta\\,\\max\\!\\big(|U_{j}|,1\\big)\\,$ for some small $\\,\\eta \\in (0,1)\\,$. For each pair $\\,\\big(i,j\\big)\\,$ with $\\,\\big|\\mathbf{J}_{\\mathrm{num}}^{(i,j)}\\big| \\ge \\tau_{\\mathrm{s}}\\,$, compare $\\,\\mathrm{sign}\\!\\big(\\mathbf{J}_{\\mathrm{num}}^{(i,j)}\\big)\\,$ to $\\,\\mathrm{sign}\\!\\big(\\mathbf{J}_{\\mathrm{a}}^{(i,j)}\\big)\\,$ and flag a sign mismatch when they differ.\n\nB. Perturb each mass fraction $\\,Y_{j}\\,$ by adding a step $\\,\\varepsilon\\,$ and then renormalize all species by scaling the entire vector $\\,(Y_{1},\\dots,Y_{N_{\\mathrm{s}}})\\,$ by the same constant so that the sum returns to unity, leaving temperature unchanged. Compute the forward-difference quotient of the production-rate vector $\\,\\boldsymbol{\\omega}(\\mathbf{U})\\,$,\n$$\n\\widehat{\\mathbf{J}}_{\\omega}^{(:,j)} \\approx \\frac{\\boldsymbol{\\omega}(\\mathbf{U} + \\varepsilon\\,\\mathbf{e}_{j}) - \\boldsymbol{\\omega}(\\mathbf{U})}{\\varepsilon} \\, ,\n$$\nand compare the sign of $\\,\\widehat{\\mathbf{J}}_{\\omega}^{(:,j)}\\,$ directly to the sign of the corresponding entries of $\\,\\mathbf{J}_{\\mathrm{a}}(\\mathbf{U})\\,$.\n\nC. Use the complex-step method on $\\,\\mathbf{F}\\,$: for each independent component $\\,U_{j}\\,$, evaluate $\\,\\mathbf{F}\\!\\big(\\mathbf{U} + \\mathrm{i}\\,\\varepsilon\\,\\mathbf{e}_{j}\\big)\\,$ with $\\,\\varepsilon > 0\\,$, enforcing $\\,Y_{N_{\\mathrm{s}}} = 1 - \\sum_{k=1}^{N_{\\mathrm{s}}-1} Y_{k}\\,$ at the complex-perturbed composition and recomputing $\\,\\rho,\\,c_{p},\\,h_{k}\\,$ consistently at that state. Approximate the $\\,j$-th column of the Jacobian by\n$$\n\\mathbf{J}_{\\mathrm{num}}^{(:,j)} \\approx \\frac{\\operatorname{Im}\\!\\big(\\mathbf{F}(\\mathbf{U} + \\mathrm{i}\\,\\varepsilon\\,\\mathbf{e}_{j})\\big)}{\\varepsilon} \\, ,\n$$\nand then compare the sign of $\\,\\mathbf{J}_{\\mathrm{num}}^{(i,j)}\\,$ to that of $\\,\\mathbf{J}_{\\mathrm{a}}^{(i,j)}\\,$ for all entries with $\\,\\big|\\mathbf{J}_{\\mathrm{num}}^{(i,j)}\\big| \\ge \\tau_{\\mathrm{s}}\\,$.\n\nD. To avoid recomputing thermodynamic properties, freeze $\\,\\rho,\\,c_{p},\\,h_{k}\\,$ at their unperturbed values and perturb $\\,\\mathbf{U}\\,$ componentwise as in option A, forming the central difference quotient of the heat-release term only,\n$$\n\\widetilde{J}^{(T,j)} \\approx \\frac{1}{2\\,\\varepsilon}\\left[-\\frac{1}{\\rho\\,c_{p}}\\sum_{k} h_{k}\\,\\omega_{k}(\\mathbf{U} + \\varepsilon\\,\\mathbf{e}_{j}) \\;+\\; \\frac{1}{\\rho\\,c_{p}}\\sum_{k} h_{k}\\,\\omega_{k}(\\mathbf{U} - \\varepsilon\\,\\mathbf{e}_{j})\\right] \\, ,\n$$\nand compare the sign of $\\,\\widetilde{J}^{(T,j)}\\,$ to $\\,\\mathbf{J}_{\\mathrm{a}}^{(T,j)}\\,$. Treat species rows analogously, always using the frozen $\\,\\rho\\,$ in the quotient.",
            "solution": "The problem asks for reliable automated verification designs to check for sign errors in an analytically computed chemical Jacobian, $\\mathbf{J}_{\\mathrm{a}}(\\mathbf{U})$. A reliable design must correctly approximate the true Jacobian, $\\mathbf{J}(\\mathbf{U}) = \\partial \\mathbf{F}(\\mathbf{U}) / \\partial \\mathbf{U}$, by respecting all functional dependencies and constraints inherent in the definition of the source-term vector $\\mathbf{F}(\\mathbf{U})$.\n\nThe state vector is $\\mathbf{U} = \\big(Y_{1},\\dots,Y_{N_{\\mathrm{s}}-1},T\\big)^{\\top}$, of size $N_{\\mathrm{s}}$. The source-term vector $\\mathbf{F}(\\mathbf{U})$ has components $F_i(\\mathbf{U})$ for $i \\in \\{1, \\dots, N_{\\mathrm{s}}-1\\}$ corresponding to species, and a final component $F_{N_{\\mathrm{s}}}(\\mathbf{U})$ for temperature. For clarity, let us denote the components of $\\mathbf{F}$ as $F_i$ for $i=1,\\dots,N_{\\mathrm{s}}-1$ and $F_T$ for the temperature component.\n$$\nF_{i}(\\mathbf{U}) = \\frac{\\omega_{i}(\\mathbf{U})}{\\rho(\\mathbf{U})}, \\quad i \\in \\{1,\\dots,N_{\\mathrm{s}}-1\\}\n$$\n$$\nF_{T}(\\mathbf{U}) = -\\frac{1}{\\rho(\\mathbf{U})\\,c_{p}(\\mathbf{U})}\\sum_{k=1}^{N_{\\mathrm{s}}} h_{k}(\\mathbf{U})\\,\\omega_{k}(\\mathbf{U})\n$$\nThe Jacobian entries are the partial derivatives $J_{ij} = \\partial F_i / \\partial U_j$. The crucial point for validation is that the thermodynamic properties $\\rho$, $c_{p}$, and $h_{k}$ are all functions of the state vector $\\mathbf{U}$, as are the chemical production rates $\\omega_{k}$. Furthermore, the mass fraction of the last species, $Y_{N_{\\mathrm{s}}}$, is not an independent variable but is determined by the constraint $Y_{N_{\\mathrm{s}}}(\\mathbf{U}) = 1 - \\sum_{k=1}^{N_{\\mathrm{s}}-1} Y_{k}$.\n\nTherefore, a correct numerical approximation of a Jacobian entry, for example $\\partial F_i / \\partial Y_j$ where $i,j \\in \\{1, \\dots, N_{\\mathrm{s}}-1\\}$, must account for all these dependencies via the chain rule.\n$$\n\\frac{\\partial F_i}{\\partial Y_j} = \\frac{\\partial}{\\partial Y_j} \\left( \\frac{\\omega_i}{\\rho} \\right) = \\frac{1}{\\rho} \\frac{\\partial \\omega_i}{\\partial Y_j} - \\frac{\\omega_i}{\\rho^2} \\frac{\\partial \\rho}{\\partial Y_j}\n$$\nHere, the derivative $\\partial/\\partial Y_j$ is a total derivative with respect to the independent variable $Y_j$. For any function $g(\\mathbf{U})$ that also explicitly depends on the full composition vector $(Y_1, \\dots, Y_{N_{\\mathrm{s}}})$, its total derivative with respect to an independent mass fraction $Y_j$ ($j < N_{\\mathrm{s}}$) is:\n$$\n\\frac{\\mathrm{d}g}{\\mathrm{d}Y_j} = \\frac{\\partial g}{\\partial Y_j} + \\frac{\\partial g}{\\partial Y_{N_{\\mathrm{s}}}} \\frac{\\partial Y_{N_{\\mathrm{s}}}}{\\partial Y_j} = \\frac{\\partial g}{\\partial Y_j} - \\frac{\\partial g}{\\partial Y_{N_{\\mathrm{s}}}}\n$$\nA reliable numerical method must approximate this total derivative. This is achieved by perturbing the independent variable $Y_j$, correctly updating the dependent variable $Y_{N_{\\mathrm{s}}}$, and then re-evaluating all properties $(\\rho, c_p, h_k, \\omega_k)$ based on the fully updated state before computing the finite difference or complex-step quotient.\n\nLet us evaluate each option based on this principle.\n\nA. This option proposes using a central-difference approximation.\nThe procedure is as follows:\n1.  Perturb an independent state variable $U_j$: $\\mathbf{U}^{\\pm} = \\mathbf{U} \\pm \\varepsilon\\,\\mathbf{e}_{j}$.\n2.  If $U_j$ is a mass fraction $Y_j$, the constraint $Y_{N_{\\mathrm{s}}} = 1 - \\sum_{k=1}^{N_{\\mathrm{s}}-1} Y_k$ is enforced. This means that for the \"plus\" perturbation, the new independent mass fractions are $(Y_1, \\dots, Y_j+\\varepsilon, \\dots, Y_{N_{\\mathrm{s}}-1})$, and the new dependent mass fraction is $Y'_{N_{\\mathrm{s}}} = 1 - (\\sum_{k=1, k\\neq j}^{N_{\\mathrm{s}}-1} Y_k + Y_j+\\varepsilon) = Y_{N_{\\mathrm{s}}} - \\varepsilon$. This correctly implements the dependence of $Y_{N_{\\mathrm{s}}}$ on $Y_j$.\n3.  All thermodynamic quantities ($\\rho$, $c_p$, $h_k$) are recomputed at the new perturbed state $\\mathbf{U}^{\\pm}$. This step is critical as it ensures that the function being differentiated is the complete source term $\\mathbf{F}(\\mathbf{U})$ with all its dependencies.\n4.  The central difference formula, $\\mathbf{J}_{\\mathrm{num}}^{(:,j)} \\approx (\\mathbf{F}(\\mathbf{U}^{+}) - \\mathbf{F}(\\mathbf{U}^{-}))/(2\\,\\varepsilon)$, is then applied. This is a standard second-order accurate numerical differentiation scheme.\n5.  Finally, the signs of the numerically computed Jacobian entries are compared to the analytical ones.\n\nThis procedure correctly mirrors the mathematical definition of the partial derivative by perturbing one independent variable while accounting for all consequent changes in dependent quantities. Thus, the numerical Jacobian computed this way is a valid approximation of the true Jacobian. The method is reliable.\nVerdict: **Correct**.\n\nB. This option proposes a different perturbation scheme and object of differentiation.\n1.  The perturbation of a mass fraction $Y_j$ is done by adding $\\varepsilon$ and then renormalizing the entire mass fraction vector $(Y_1, \\dots, Y_{N_{\\mathrm{s}}})$ to sum to unity. If the initial vector is $\\mathbf{Y}$ and we form $\\mathbf{Y}'_{un} = (Y_1, \\dots, Y_j+\\varepsilon, \\dots, Y_{N_{\\mathrm{s}}})$, the sum is $S = 1+\\varepsilon$. The new state is $\\mathbf{Y}' = \\mathbf{Y}'_{un}/S$. The change in any component $Y_k$ is $\\Delta Y_k = Y'_k - Y_k = \\frac{Y_k}{1+\\varepsilon} - Y_k \\approx -\\varepsilon Y_k$ for $k \\ne j$, and $\\Delta Y_j = \\frac{Y_j+\\varepsilon}{1+\\varepsilon} - Y_j \\approx \\varepsilon(1-Y_j)$. This is not a perturbation purely in the direction of the basis vector $\\mathbf{e}_j$. Instead, it is a perturbation in a complex direction that depends on the current state $\\mathbf{Y}$. The resulting finite-difference quotient would not approximate $\\partial \\mathbf{F} / \\partial Y_j$.\n2.  The method approximates the Jacobian of the chemical production rate vector $\\boldsymbol{\\omega}$ instead of the full source term vector $\\mathbf{F}$. This is fundamentally incorrect. For the species equations, it neglects the derivative of the density, i.e., the term $-\\omega_i/\\rho^2 \\cdot \\partial \\rho/\\partial U_j$. For the temperature equation, it neglects the derivatives of $\\rho$, $c_p$, and $h_k$.\nThese two major flaws make the method unreliable for verifying the true Jacobian $\\mathbf{J}_{\\mathrm{a}}$.\nVerdict: **Incorrect**.\n\nC. This option proposes using the complex-step method.\n1.  The state vector is perturbed in the imaginary direction: $\\mathbf{U} + \\mathrm{i}\\,\\varepsilon\\,\\mathbf{e}_{j}$.\n2.  Crucially, it specifies that the constraint $Y_{N_{\\mathrm{s}}} = 1 - \\sum_{k=1}^{N_{\\mathrm{s}}-1} Y_{k}$ is enforced on the complex-valued mass fractions. This means perturbing $Y_j$ to $Y_j + \\mathrm{i}\\varepsilon$ correctly induces a change in $Y_{N_{\\mathrm{s}}}$ to $Y_{N_{\\mathrm{s}}} - \\mathrm{i}\\varepsilon$. This correctly handles the compositional constraint.\n3.  It also specifies that all thermodynamic properties ($\\rho$, $c_p$, $h_k$) are recomputed at the complex-perturbed state. This assumes the property evaluation routines can handle complex inputs, which is a standard requirement for applying the complex-step method. This ensures that the full function $\\mathbf{F}$ is evaluated with all its dependencies.\n4.  The formula $\\mathbf{J}_{\\mathrm{num}}^{(:,j)} \\approx \\operatorname{Im}\\!\\big(\\mathbf{F}(\\mathbf{U} + \\mathrm{i}\\,\\varepsilon\\,\\mathbf{e}_{j})\\big)/\\varepsilon$ is the standard complex-step derivative approximation. It is known to be highly accurate and numerically stable, avoiding the subtraction cancellation errors of finite-difference methods.\n\nThis procedure is a sophisticated and robust implementation of numerical differentiation. It correctly handles all functional dependencies and constraints described in the problem. It is therefore a reliable verification design.\nVerdict: **Correct**.\n\nD. This option proposes a simplified central-difference scheme.\nThe key feature is to \"freeze $\\rho, c_p, h_k$ at their unperturbed values\" to avoid recomputing them. This is a fatal flaw. By doing this, the method does not compute the derivative of the true source term $\\mathbf{F}(\\mathbf{U})$, but rather the derivative of a simplified function where the thermodynamic properties are treated as constants with respect to the perturbation.\nFor a species source term $F_i = \\omega_i/\\rho$, this method would approximate $(1/\\rho)\\cdot(\\partial\\omega_i/\\partial U_j)$, completely ignoring the term $-(\\omega_i/\\rho^2)\\cdot(\\partial \\rho/\\partial U_j)$.\nFor the temperature source term $F_T = -(\\sum_k h_k \\omega_k)/(\\rho c_p)$, this method would approximate $-1/(\\rho c_p) \\cdot \\sum_k h_k (\\partial\\omega_k/\\partial U_j)$. This misses the derivatives of $\\rho$, $c_p$, and $h_k$, which can be significant contributors to the Jacobian entries.\nThe problem statement explicitly requires a design that is not \"confounded by... thermodynamic property updates.\" This design is not only confounded by them, it completely ignores them, guaranteeing an incorrect result for any Jacobian entry where the derivatives of these properties are nonzero.\nVerdict: **Incorrect**.\n\nIn summary, methods A and C describe valid and reliable procedures for numerically approximating the chemical Jacobian, while methods B and D contain fundamental flaws that make them unreliable.",
            "answer": "$$\\boxed{AC}$$"
        }
    ]
}