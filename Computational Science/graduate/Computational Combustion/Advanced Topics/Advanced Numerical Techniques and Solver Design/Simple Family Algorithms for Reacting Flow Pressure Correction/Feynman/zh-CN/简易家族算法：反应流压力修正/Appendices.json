{
    "hands_on_practices": [
        {
            "introduction": "为了有效地使用和开发数值算法，我们必须首先理解它们的数学行为。本练习聚焦于一个基本问题：SIMPLE算法是如何收敛的？通过执行局部模态分析，你将剖析SIMPLE迭代过程，并揭示其关键参数（如亚松弛因子）如何控制不同频率误差的衰减，从而深刻理解为何SIMPLE常被视为一种有效的“平滑器”。",
            "id": "4063149",
            "problem": "考虑一个周期性域上的一维、低马赫数、变密度反应流，该流动围绕一个稳态基态进行线性化，以便为了局部分析的目的，将局部平均密度冻结在一个恒定值 $\\rho_{0} > 0$。假设线性化的稳态动量平衡可以表示为一个扩散-反应算子，该算子由压力梯度驱动速度场 $u(x)$，即\n$$\n\\sigma\\,u(x) - \\mu\\,\\frac{d^{2}u}{dx^{2}} = -\\frac{dp}{dx},\n$$\n其中 $\\mu > 0$ 是有效粘度，$\\sigma > 0$ 集合了对流和反应源项线性化后的局部线性贡献。在低马赫数变密度极限下，质量守恒局部简化为\n$$\n\\frac{d}{dx}\\left(\\rho_{0}\\,u(x)\\right) = 0.\n$$\n在均匀网格上进行离散化，并对波数为 $k > 0$ 的单个模态进行局部模态（Fourier/von Neumann）分析。在傅里叶空间中，将梯度、散度和动量算子的符号表示为\n$$\nG(k) = i\\,k,\\quad D(k) = i\\,k\\,\\rho_{0},\\quad A(k) = \\sigma + \\mu\\,k^{2}.\n$$\n使用应用于误差场的标准 SIMPLE 步骤，分析压力耦合方程组的半隐式方法（SIMPLE）迭代，其中速度的欠松弛因子为 $\\alpha_{u} \\in (0,1]$，压力的欠松弛因子为 $\\alpha_{p} \\in (0,1]$：\n1. 速度预测：从 $A(k)\\,\\hat{u} = -G(k)\\,e_{p}^{n}$ 求解预测的速度误差 $\\hat{u}$。\n2. 速度欠松弛：$e_{u}^{*} = e_{u}^{n} + \\alpha_{u}\\left(\\hat{u} - e_{u}^{n}\\right)$。\n3. 压力修正方程：使用对角动量逆近似 $M_{d} = m > 0$ 来定义 $H(k) = D(k)\\,M_{d}\\,G(k)$，并求解 $H(k)\\,p' = D(k)\\,e_{u}^{*}$。\n4. 压力更新：$e_{p}^{n+1} = e_{p}^{n} + \\alpha_{p}\\,p'$。\n5. 速度修正：$e_{u}^{n+1} = e_{u}^{*} - M_{d}\\,G(k)\\,p'$。\n\n假设迭代作用于波数为 $k>0$ 的非零傅里叶模态，并且密度 $\\rho_{0}$ 在迭代过程中保持不变（反应流效应被嵌入在 $\\sigma$ 和 $\\mu$ 中）。使用上述算子和步骤，针对一个完整的 SIMPLE 迭代，推导由 $e_{p}^{n+1} = G(k)\\,e_{p}^{n}$ 定义的单模态压力误差放大因子 $G(k)$。将您的最终答案表示为一个关于 $\\alpha_{u}$、$\\alpha_{p}$、$m$、$\\sigma$、$\\mu$ 和 $k$ 的闭式解析表达式。不需要进行数值舍入。仅提供 $G(k)$ 的表达式作为您的最终答案。",
            "solution": "我们的目标是推导压力误差放大因子 $G(k)$，其定义为 $e_{p}^{n+1} = G(k)e_{p}^{n}$。为此，我们需要将 $e_{p}^{n+1}$ 表示为 $e_{p}^{n}$ 的函数。\n\n我们遵循问题中给出的五个步骤，并分析误差场的演化。一个关键的假设对于这类投影方法的分析是标准的：即在每次迭代开始时，速度误差场是无散度的。我们可以通过分析算法的一个步骤来证明这一点：步骤5定义了速度误差的更新，$e_{u}^{n+1} = e_{u}^{*} - M_{d}\\,G(k)\\,p'$。对其应用散度算子 $D(k)$，我们得到 $D(k)e_{u}^{n+1} = D(k)e_{u}^{*} - D(k)M_{d}\\,G(k)\\,p'$。根据步骤3中 $H(k)$ 的定义，$D(k)M_{d}\\,G(k) = H(k)$。因此，$D(k)e_{u}^{n+1} = D(k)e_{u}^{*} - H(k)p'$。同样根据步骤3，$H(k)p' = D(k)e_{u}^{*}$，这意味着右侧为零。所以 $D(k)e_{u}^{n+1} = 0$。这表明，在第一次迭代之后，所有后续迭代的速度误差场都将是无散度的。因此，为了分析渐近收敛性，我们可以安全地假设 $D(k)e_{u}^{n}=0$。\n\n现在我们开始推导：\n\n1.  **从压力更新开始**：\n    $e_{p}^{n+1} = e_{p}^{n} + \\alpha_{p}\\,p'$\n    我们需要找到 $p'$。\n\n2.  **求解压力修正量 $p'$**：\n    根据步骤3，$p' = H(k)^{-1}D(k)e_{u}^{*}$。\n    我们需要找到 $e_{u}^{*}$。\n\n3.  **确定预测速度误差 $e_{u}^{*}$**：\n    根据步骤2，$e_{u}^{*} = (1-\\alpha_u)e_u^n + \\alpha_u \\hat{u}$。\n    对其应用散度算子 $D(k)$，并使用我们的核心假设 $D(k)e_{u}^{n}=0$：\n    $D(k)e_{u}^{*} = (1-\\alpha_u)D(k)e_u^n + \\alpha_u D(k)\\hat{u} = \\alpha_u D(k)\\hat{u}$。\n    将这个关系代入步骤2中 $p'$ 的表达式：\n    $p' = H(k)^{-1} (\\alpha_u D(k)\\hat{u})$。\n    现在我们需要找到 $\\hat{u}$。\n\n4.  **确定预测速度 $\\hat{u}$**：\n    根据步骤1，$A(k)\\,\\hat{u} = -G(k)\\,e_{p}^{n}$，因此 $\\hat{u} = -A(k)^{-1}G(k)e_{p}^{n}$。\n\n5.  **组合所有部分**：\n    将 $\\hat{u}$ 的表达式代入 $p'$ 的表达式中：\n    $p' = H(k)^{-1} \\alpha_u D(k) \\left(-A(k)^{-1}G(k)e_{p}^{n}\\right) = -\\alpha_u H(k)^{-1}D(k)A(k)^{-1}G(k)e_{p}^{n}$。\n\n6.  **推导最终的放大因子**：\n    将 $p'$ 的最终表达式代回步骤1的压力更新方程：\n    $e_{p}^{n+1} = e_{p}^{n} + \\alpha_{p} \\left( -\\alpha_u H(k)^{-1}D(k)A(k)^{-1}G(k)e_{p}^{n} \\right)$\n    $e_{p}^{n+1} = \\left( 1 - \\alpha_p \\alpha_u H(k)^{-1}D(k)A(k)^{-1}G(k) \\right) e_{p}^{n}$。\n\n    因此，放大因子为 $G(k) = 1 - \\alpha_p \\alpha_u \\frac{D(k)A(k)^{-1}G(k)}{H(k)}$。\n\n7.  **代入算子定义**：\n    分子为：$D(k)A(k)^{-1}G(k) = (i k \\rho_0) (\\sigma + \\mu k^2)^{-1} (i k) = \\frac{-k^2 \\rho_0}{\\sigma + \\mu k^2}$。\n    分母为：$H(k) = D(k) M_d G(k) = (i k \\rho_0) (m) (i k) = -m k^2 \\rho_0$。\n\n    它们的比率为：\n    $\\frac{D(k)A(k)^{-1}G(k)}{H(k)} = \\frac{-k^2 \\rho_0 / (\\sigma + \\mu k^2)}{-m k^2 \\rho_0} = \\frac{1}{m(\\sigma + \\mu k^2)}$。\n\n8.  **最终表达式**：\n    将此比率代回放大因子的表达式，我们得到最终答案：\n    $G(k) = 1 - \\frac{\\alpha_{p} \\alpha_{u}}{m(\\sigma + \\mu k^{2})}$。",
            "answer": "$$\n\\boxed{1 - \\frac{\\alpha_{p} \\alpha_{u}}{m (\\sigma + \\mu k^{2})}}\n$$"
        },
        {
            "introduction": "从理论转向实践，我们经常会遇到各种数值伪影，其中“棋盘格”不稳定性是在并置网格上求解流场时的经典难题。本动手编程练习将指导你实现一个基于傅里叶谱分析的诊断工具，用以量化识别这种压力-速度解耦现象。更重要的是，你将学习如何将诊断结果与具体的修正措施（如Rhie-Chow插值）联系起来，这是开发稳健CFD求解器的一项关键技能。",
            "id": "4063108",
            "problem": "要求您编写一个完整且可运行的程序，通过评估网格中心压力和面法向质量通量散度的离散谱，来检测和诊断在用于反应流的同位网格SIMPLE（压力耦合方程组的半隐式方法）族算法中出现的压力-速度解耦（棋盘格现象）。该任务必须基于第一性原理：质量守恒、动量守恒和标准的离散傅里叶分析。您必须以一种数学上通用的方式实现该分析，这种方式不依赖于任何特定编程语言的特性，并能为预定义的测试套件产生可量化的输出。\n\n从以下基本基础开始：\n- 质量守恒（连续性）：对于恒定密度，其稳态形式是一个离散约束，即网格单元的质量通量散度为零，也就是说，应用于面法向通量的离散算子为零。\n- 动量守恒：通过动量平衡及其离散形式，压力梯度对面的质量通量有贡献。在同位网格上，从未经压力加权耦合的网格中心变量朴素地插值面通量，会产生伪奇偶解耦模式。\n- 离散傅里叶变换 (DFT)：周期性均匀网格上的任何离散场都允许唯一地展开为离散傅里叶模式；高波数模式可以捕捉到棋盘格等网格尺度的振荡。奈奎斯特波数处的模式是可分辨的最高频率模式，也是奇偶振荡的典型代表。\n\n您将需要精确地实现以下定义：\n- 考虑一个大小为 $N_x \\times N_y$ 的均匀、周期性二维网格，其单元索引为 $i \\in \\{0,\\dots,N_x-1\\}$ 和 $j \\in \\{0,\\dots,N_y-1\\}$。设坐标为 $x_i = i/N_x$, $y_j = j/N_y$。使用无量纲单位，使得 $x$ 方向的网格间距为 $1/N_x$，$y$ 方向的网格间距为 $1/N_y$，并将密度设为1。\n- 设 $p_{i,j}$ 表示网格中心压力。设 $u_{i+1/2,j}$ 和 $v_{i,j+1/2}$ 分别表示 $x$ 和 $y$ 方向上的面法向质量通量，存储在周期性面网格上。使用周期性索引，通过与单元格形状相同的数组来表示面：对于 $x$ 方向的面，索引 $u_{j,i}$ 代表 $u_{i+1/2,j}$；对于 $y$ 方向的面，索引 $v_{j,i}$ 代表 $v_{i,j+1/2}$。单元格 $(i,j)$ 处的离散散度为\n\n$$\nd_{i,j} = \\left(u_{i+1/2,j} - u_{i-1/2,j}\\right) + \\left(v_{i,j+1/2} - v_{i,j-1/2}\\right),\n$$\n\n其中 $i-1$ 和 $j-1$ 使用周期性索引。\n- 对于网格上的任意实值场 $f_{i,j}$，使用标准的非幺正约定，为其定义二维离散傅里叶变换 $F_{k_x,k_y}$，其中 $k_x \\in \\{0,\\dots,N_x-1\\}$ 且 $k_y \\in \\{0,\\dots,N_y-1\\}$。定义总谱能量为\n\n$$\nE_\\text{tot}(f) = \\sum_{k_x=0}^{N_x-1} \\sum_{k_y=0}^{N_y-1} \\left|F_{k_x,k_y}\\right|^2.\n$$\n\n- 将 $x$ 方向的奈奎斯特指数定义为 $k_x^\\star = N_x/2$（如果 $N_x$ 是偶数，否则无定义），同样地定义 $k_y^\\star = N_y/2$。定义奈奎斯特集合 $\\mathcal{N} = \\{(k_x,k_y) \\mid k_x = k_x^\\star \\lor k_y = k_y^\\star\\}$。定义场 $f$ 的奈奎斯特能量分数为\n\n$$\nr(f) = \\frac{\\sum_{(k_x,k_y)\\in \\mathcal{N}} \\left|F_{k_x,k_y}\\right|^2}{E_\\text{tot}(f)},\n$$\n\n约定当 $E_\\text{tot}(f)=0$ 时 $r(f)=0$。\n- 使用检测阈值 $\\tau = 0.6$。定义压力场的奈奎斯特能量分数为 $r_p = r(p)$，面法向质量通量散度的为 $r_d = r(d)$。定义 $r_\\text{max} = \\max(r_p, r_d)$。如果 $r_\\text{max} \\ge \\tau$，则定义棋盘格检测布尔值 $C$ 为真 (true)，否则为假 (false)。\n\n您还必须根据插值和离散化选择，将修正措施编码为整数代码：\n- 措施代码 $0$：建议不作更改。\n- 措施代码 $1$：在面上应用压力加权动量插值（Rhie–Chow 滤波），以在同位网格上耦合压力和速度。\n- 措施代码 $2$：在面质量通量插值中增加耗散，或减少动量亚松弛，以抑制高频通量散度（例如，对于对流通量，向迎风格式混合，或增加压力权重）。\n\n根据以下逻辑选择措施代码：如果 $r_p \\ge \\tau$，则措施代码为 $1$；否则，如果 $r_d \\ge \\tau$，则措施代码为 $2$；否则措施代码为 $0$。\n\n在 $N_x = N_y = 32$ 的条件下，实现以下包含人工合成的周期性场的测试套件，以测试不同的工况。对于每种情况，按照描述构造 $p_{i,j}$、$u_{i+1/2,j}$ 和 $v_{i,j+1/2}$。\n\n- 情况 A（光滑基流，无棋盘格）：定义\n\n$$\np_{i,j} = \\sin\\left(2\\pi x_i\\right)\\sin\\left(2\\pi y_j\\right).\n$$\n\n定义网格中心流函数 $\\psi_{i,j} = \\sin\\left(2\\pi x_i\\right)\\sin\\left(2\\pi y_j\\right)$，并通过 $u^\\text{cc}_{i,j} = \\frac{\\partial \\psi}{\\partial y} \\approx 2\\pi \\cos\\left(2\\pi y_j\\right)\\sin\\left(2\\pi x_i\\right)$ 和 $v^\\text{cc}_{i,j} = -\\frac{\\partial \\psi}{\\partial x} \\approx -2\\pi \\cos\\left(2\\pi x_i\\right)\\sin\\left(2\\pi y_j\\right)$ 来近似网格中心速度。然后通过对面进行算术平均来定义面通量：$u_{i+1/2,j} = \\frac{1}{2}\\left(u^\\text{cc}_{i,j} + u^\\text{cc}_{i+1,j}\\right)$ 和 $v_{i,j+1/2} = \\frac{1}{2}\\left(v^\\text{cc}_{i,j} + v^\\text{cc}_{i,j+1}\\right)$，使用周期性索引。\n\n- 情况 B（压力场中的典型二维棋盘格）：定义\n\n$$\np_{i,j} = (-1)^{i+j},\n$$\n\n并将所有面上的 $u_{i+1/2,j}$ 和 $v_{i,j+1/2}$ 设为 $0$。\n\n- 情况 C（压力场中沿 $x$ 方向的一维棋盘格）：定义\n\n$$\np_{i,j} = (-1)^i,\n$$\n\n并将所有面上的 $u_{i+1/2,j}$ 和 $v_{i,j+1/2}$ 设为 $0$。\n\n- 情况 D（光滑压力，通量中存在棋盘格）：按照情况 A 定义 $p_{i,j}$。对于所有 $j$，定义 $u_{i+1/2,j} = (-1)^i$；对于所有 $i, j$，定义 $v_{i,j+1/2} = 0$。\n\n您的程序必须为每种情况计算 $r_p$、$r_d$ 和 $r_\\text{max}$，确定 $C$，并根据所述逻辑选择措施代码。每种情况的最终结果必须是一个列表 $[C, a, r_\\text{max}]$，其中 $C$ 是一个布尔值， $a$ 是一个整数措施代码，$r_\\text{max}$ 是一个浮点数。\n\n最终输出格式：\n- 您的程序必须生成单行输出，其中包含一个 Python 风格的列表，该列表包含四个情况的结果，每个结果本身也是一个 Python 风格的列表 $[C, a, r_\\text{max}]$。例如，一个有效的结构是 $[[C_A,a_A,r_A],[C_B,a_B,r_B],[C_C,a_C,r_C],[C_D,a_D,r_D]]$。布尔值必须以 Python 的规范大写形式（True/False）打印为 true 或 false。浮点数可以以标准十进制表示法打印。\n\n不应打印任何其他文本。不需要物理单位，因为所有场都是无量纲的。根据构造，三角函数中的角度以弧度为单位。测试套件已在上面完全指定，并且必须在您的解决方案中进行硬编码。",
            "solution": "我们通过依赖控制守恒定律和离散傅里叶表示的性质，为同位网格SIMPLE（压力耦合方程组的半隐式方法）算法中的压力-速度解耦推导出一个基于原理的谱检测器。\n\n1.  **基本原理和棋盘格现象的起源**：\n    *   对于恒定密度，离散的稳态质量守恒表述为每个控制体中面质量通量的离散散度为零。在具有周期性边界条件的均匀网格上，应用于面法向质量通量 $u_{i+1/2,j}$ 和 $v_{i,j+1/2}$ 的离散散度算子是\n    \n    $$\n    d_{i,j} = \\left(u_{i+1/2,j} - u_{i-1/2,j}\\right) + \\left(v_{i,j+1/2} - v_{i,j-1/2}\\right).\n    $$\n    \n    *   在同位网格布局中，动量方程将面质量通量与网格中心速度和压力梯度联系起来。对面速度进行未经压力加权耦合的朴素线性插值，允许从压力到面通量的非唯一映射，这会支持压力场中伪奇偶振荡的产生，而这种振荡对线性插值得到的面通量影响极小。这表现为奈奎斯特波数处的高波数模式，即所谓的棋盘格现象。\n    *   在压力耦合方程组的半隐式方法中，Rhie–Chow 动量插值在面通量中显式地引入了压力差的贡献，从而一致地耦合了压力和质量通量，并抑制了解耦模式。\n\n2.  **谱检测原理**：\n    *   周期性均匀网格上的任何离散场 $f_{i,j}$ 都允许进行二维离散傅里叶变换 $F_{k_x,k_y}$，该变换将其唯一地表示为正交模式的叠加。奈奎斯特波数 $k_x^\\star = N_x/2$ 和 $k_y^\\star = N_y/2$（对于偶数 $N_x$ 和 $N_y$）对应于最高的空间频率，其空间变化周期为两个网格单元（符号交替）。\n    *   棋盘格现象的特征是这些奈奎斯特模式在压力场 $p$ 或面质量通量散度 $d$ 中占主导地位。因此，一个合适的诊断工具是测量位于奈奎斯特集合 $\\mathcal{N} = \\{(k_x,k_y)\\mid k_x=k_x^\\star \\lor k_y=k_y^\\star\\}$ 上的谱能量分数。定义\n    \n    $$\n    E_\\text{tot}(f) = \\sum_{k_x=0}^{N_x-1} \\sum_{k_y=0}^{N_y-1} \\left|F_{k_x,k_y}\\right|^2, \\quad\n    r(f) = \\frac{\\sum_{(k_x,k_y)\\in \\mathcal{N}} \\left|F_{k_x,k_y}\\right|^2}{E_\\text{tot}(f)}.\n    $$\n    \n    如果 $r(f)$ 很大，则奈奎斯特模式在该场中占主导地位。\n\n3.  **基于守恒定律的决策逻辑**：\n    *   计算 $r_p = r(p)$ 和 $r_d = r(d)$。量 $r_p$ 捕捉与解耦压力修正相关的伪压力振荡，而 $r_d$ 捕捉与动量/对流通量的不一致或过度中心的的面插值相关的高频散度振荡。\n    *   定义 $r_\\text{max} = \\max(r_p, r_d)$ 和一个阈值 $\\tau = 0.6$。如果 $r_\\text{max} \\ge \\tau$，则棋盘格现象显著：将检测布尔值 $C$ 设为真 (true)。否则，将 $C$ 设为假 (false)。\n    *   选择与插值和离散化选择相关的修正措施代码 $a$：\n        *   如果 $r_p \\ge \\tau$，返回 $a=1$：应用 Rhie–Chow 动量插值，将压力差直接引入面质量通量，从而消除解耦的压力模式。\n        *   否则，如果 $r_d \\ge \\tau$，返回 $a=2$：在面质量通量插值中增加耗散或阻尼（例如，对于对流通量，向迎风格式混合，或减少动量亚松弛），这会抑制高频散度振荡。\n        *   否则，返回 $a=0$（不作更改）。\n\n4.  **测试套件设计与覆盖范围**：\n    *   情况 A 定义了一个光滑的压力场和一个由流函数导出的无散速度场。其谱集中在低波数，因此 $r_p$ 和 $r_d$ 会很小；预期结果为 $C=$ false 和 $a=0$。\n    *   情况 B 定义了典型的二维棋盘格压力场 $p_{i,j} = (-1)^{i+j}$。其离散傅里叶变换集中在 $(k_x^\\star,k_y^\\star)$，即两个方向上的奈奎斯特模式，因此 $r_p \\approx 1$；预期结果为 $C=$ true 和 $a=1$。\n    *   情况 C 定义了一个沿 $x$ 方向的一维棋盘格压力场 $p_{i,j} = (-1)^i$。其变换集中在 $(k_x^\\star,0)$，该点位于 $\\mathcal{N}$ 中；因此 $r_p \\approx 1$；预期结果为 $C=$ true 和 $a=1$。\n    *   情况 D 定义了一个如情况 A 中的光滑压力场，但在面 $u$-通量中施加了一个棋盘格模式，这会产生一个沿 $x$ 方向具有强奈奎斯特分量的散度场 $d_{i,j}$。因此 $r_d \\approx 1$；预期结果为 $C=$ true 和 $a=2$。\n\n5.  **实现的算法步骤**：\n    *   构建 $N_x=N_y=32$ 且具有周期性索引的网格。按规定为每种情况计算 $p$、$u$、$v$。对于情况 A，从 $\\psi$ 计算网格中心速度并平均到面上；对于其他情况，按指定直接设置面上的值。\n    *   使用面通量的周期性差分计算离散散度 $d$。\n    *   通过对 $p$ 和 $d$ 进行二维离散傅里叶变换，求平方幅值的和得到 $E_\\text{tot}$，并求奈奎斯特集合 $\\mathcal{N}$ 上的平方幅值之和，来计算 $r_p$ 和 $r_d$。通过将比率定义为零来处理 $E_\\text{tot}=0$ 的情况。\n    *   应用决策逻辑来确定每种情况的 $C$、$a$ 和 $r_\\text{max}$。\n    *   将结果聚合并以指定的单行格式打印，格式为一个包含四个列表 $[C,a,r_\\text{max}]$ 的列表。\n\n该方法将控制定律与谱分析相结合，既能检测棋盘格现象的标志性特征，又能推荐植根于 SIMPLE 族算法中标准的插值和离散化选择的、有物理动机的修正措施。",
            "answer": "```python\nimport numpy as np\n\ndef generate_grid(Nx, Ny):\n    x = np.arange(Nx) / Nx\n    y = np.arange(Ny) / Ny\n    X, Y = np.meshgrid(x, y, indexing='xy')  # shape (Ny, Nx)\n    return X, Y\n\ndef compute_fft_nyquist_ratio(field):\n    \"\"\"\n    Compute the fraction of spectral energy located on the Nyquist set:\n    modes where kx = Nx/2 or ky = Ny/2 (for even dimensions).\n    \"\"\"\n    Ny, Nx = field.shape\n    F = np.fft.fft2(field)\n    energy = (F * np.conj(F)).real\n    total_energy = energy.sum()\n    if total_energy == 0.0:\n        return 0.0\n    # Nyquist indices for even sizes\n    kx_star = Nx // 2 if Nx % 2 == 0 else None\n    ky_star = Ny // 2 if Ny % 2 == 0 else None\n\n    kx = np.arange(Nx)[None, :]  # shape (1, Nx)\n    ky = np.arange(Ny)[:, None]  # shape (Ny, 1)\n    mask = np.zeros((Ny, Nx), dtype=bool)\n    if kx_star is not None:\n        mask |= (kx == kx_star)\n    if ky_star is not None:\n        mask |= (ky == ky_star)\n\n    nyquist_energy = energy[mask].sum()\n    ratio = float(nyquist_energy / total_energy)\n    return ratio\n\ndef make_case_A(Nx, Ny):\n    # Smooth pressure and smooth divergence-free velocity from streamfunction\n    X, Y = generate_grid(Nx, Ny)\n    p = np.sin(2*np.pi*X) * np.sin(2*np.pi*Y)\n    # Cell-centered velocities from streamfunction psi = sin(2πx) sin(2πy)\n    u_cc = 2*np.pi * np.cos(2*np.pi*Y) * np.sin(2*np.pi*X)\n    v_cc = -2*np.pi * np.cos(2*np.pi*X) * np.sin(2*np.pi*Y)\n    # Average to faces with periodicity\n    # u_faces[j,i] at i+1/2: average u_cc[j,i] and u_cc[j,i+1]\n    u_faces = 0.5 * (u_cc + np.roll(u_cc, shift=-1, axis=1))\n    # v_faces[j,i] at j+1/2: average v_cc[j,i] and v_cc[j+1,i]\n    v_faces = 0.5 * (v_cc + np.roll(v_cc, shift=-1, axis=0))\n    return p, u_faces, v_faces\n\ndef make_case_B(Nx, Ny):\n    # 2D checkerboard pressure, zero fluxes\n    i = np.arange(Nx)[None, :]\n    j = np.arange(Ny)[:, None]\n    p = ((-1.0) ** (i + j)).astype(float)\n    u_faces = np.zeros((Ny, Nx), dtype=float)\n    v_faces = np.zeros((Ny, Nx), dtype=float)\n    return p, u_faces, v_faces\n\ndef make_case_C(Nx, Ny):\n    # 1D checkerboard along x in pressure, zero fluxes\n    i = np.arange(Nx)[None, :]\n    p_row = ((-1.0) ** i).astype(float)  # shape (1, Nx)\n    p = np.repeat(p_row, Ny, axis=0)\n    u_faces = np.zeros((Ny, Nx), dtype=float)\n    v_faces = np.zeros((Ny, Nx), dtype=float)\n    return p, u_faces, v_faces\n\ndef make_case_D(Nx, Ny):\n    # Smooth pressure as in A, but checkerboard flux in u\n    X, Y = generate_grid(Nx, Ny)\n    p = np.sin(2*np.pi*X) * np.sin(2*np.pi*Y)\n    i = np.arange(Nx)[None, :]\n    u_faces_row = ((-1.0) ** i).astype(float)  # shape (1, Nx)\n    u_faces = np.repeat(u_faces_row, Ny, axis=0)\n    v_faces = np.zeros((Ny, Nx), dtype=float)\n    return p, u_faces, v_faces\n\ndef divergence_from_faces(u_faces, v_faces):\n    \"\"\"\n    Compute discrete divergence d[j,i] = (u[i+1/2,j]-u[i-1/2,j]) + (v[i,j+1/2]-v[i,j-1/2])\n    using periodic boundary conditions. Arrays use shape (Ny,Nx).\n    \"\"\"\n    # Differences with periodic wrap\n    du = u_faces - np.roll(u_faces, shift=1, axis=1)  # along x faces\n    dv = v_faces - np.roll(v_faces, shift=1, axis=0)  # along y faces\n    d = du + dv\n    return d\n\ndef analyze_case(p, u_faces, v_faces, tau=0.6):\n    d = divergence_from_faces(u_faces, v_faces)\n    rp = compute_fft_nyquist_ratio(p)\n    rd = compute_fft_nyquist_ratio(d)\n    rmax = max(rp, rd)\n    checkerboard = (rmax >= tau)\n    if rp >= tau:\n        action = 1\n    elif rd >= tau:\n        action = 2\n    else:\n        action = 0\n    # Round rmax for cleaner output\n    rmax_out = float(np.round(rmax, 6))\n    return [checkerboard, action, rmax_out]\n\ndef solve():\n    Nx = 32\n    Ny = 32\n    # Define test cases\n    cases = []\n    cases.append(make_case_A(Nx, Ny))\n    cases.append(make_case_B(Nx, Ny))\n    cases.append(make_case_C(Nx, Ny))\n    cases.append(make_case_D(Nx, Ny))\n\n    results = []\n    for (p, u_faces, v_faces) in cases:\n        res = analyze_case(p, u_faces, v_faces, tau=0.6)\n        results.append(res)\n\n    print(str(results))\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "真实的燃烧过程通常伴随着由放热引起的剧烈密度变化，这对压力修正格式的稳健性构成了严峻挑战。本练习将探讨SIMPLE算法家族中的不同变体（特别是SIMPLEC和SIMPLER）如何应对这一挑战。通过在一个简化的模型中分析它们的收敛特性，你将深入理解在变密度流中采用不同平均方法（算术平均与调和平均）对算法稳定性的深刻影响。",
            "id": "4063159",
            "problem": "考虑一个一维、周期性、同位网格的有限体积离散，用于描述一种低马赫数反应流。在该流动中，强放热在热区和冷区之间产生了巨大的密度比。其压力-速度耦合问题通过源于压力关联方程的半隐式方法 (Semi-Implicit Method for Pressure-Linked Equations, SIMPLE) 族的算法求解，特别是 SIMPLE-Consistent (SIMPLEC) 和 SIMPLE-Revised (SIMPLER) 这两种变体。假设在压力修正阶段有以下科学上真实的设定：\n\n- 基态在零速度附近进行线性化，产生一个均匀的对角动量系数 $a$，该系数源于离散化和线性化的动量方程残差。\n- 面上的质量通量修正被建模为与局部压力梯度成正比，其有效传导率为 $\\kappa_{f} = \\rho_{f}/a$，其中 $\\rho_{f}$ 是面密度，而由于围绕基态的线性化，$a$ 被视为空域上均匀的常数。\n- 计算域由两个相等的子域组成，其密度分别为 $\\rho_{c}$（冷）和 $\\rho_{h}$（热），密度比为 $r = \\rho_{h}/\\rho_{c}$，两者之间存在一个尖锐但与网格对齐的界面。这种理想化模型是分析变密度压力修正在大密度比条件下鲁棒性的标准模型。\n- 采用 Rhie and Chow 插值（Rhie–Chow）以防止压力棋盘格现象，并且压力修正以因子 $\\alpha_{p} \\in (0,1]$ 进行欠松弛。\n- 对于波数为 $k$ 的离散傅里叶模，压力修正迭代的线性化放大因子形式为 $g = 1 - \\alpha_{p} \\, C \\, \\kappa_{f} \\, \\sin^{2}(k \\Delta x / 2)$，其中 $C>0$ 是一个与网格和算子相关但与 $\\kappa_{f}$ 的平均方法选择无关的常数，而 $\\Delta x$ 是均匀的单元尺寸。\n\n在这些假设下：\n- SIMPLEC 在冷热界面上使用传导率的算术平均值，$\\kappa_{A} = \\frac{1}{2}\\left(\\frac{\\rho_{c}}{a} + \\frac{\\rho_{h}}{a}\\right)$。\n- SIMPLER 在冷热界面上使用传导率的调和平均值，$\\kappa_{H} = \\left( \\frac{1}{2}\\left(\\frac{a}{\\rho_{c}} + \\frac{a}{\\rho_{h}}\\right) \\right)^{-1} = \\frac{2}{a}\\,\\frac{\\rho_{c}\\rho_{h}}{\\rho_{c}+\\rho_{h}}$。\n\n线性化迭代的最坏情况谱半径 $\\rho$ 对应于最高可分辨模态，此时 $\\sin^{2}(k \\Delta x/2)=1$。\n\n定义无量纲松弛强度为 $s = \\alpha_{p} \\, C \\, \\frac{\\rho_{c}}{a}$。\n\n从变密度连续性约束和线性化的动量-压力耦合等第一性原理出发，推导最坏情况谱半径之比\n$$\\frac{\\rho_{\\text{SIMPLEC}}}{\\rho_{\\text{SIMPLER}}}$$\n作为密度比 $r$ 和无量纲松弛强度 $s$ 的函数的闭式表达式。\n\n您的最终答案必须是单一的闭式解析表达式。无需进行数值计算，最终方框内的答案中也不应包含任何单位。如果引入任何中间近似，请根据给定的假设和基本定律进行论证。不要使用或引用任何针对这些算法的快捷公式；相反，应在低马赫数反应流的背景下，从连续性方程、离散化的动量平衡以及它们所蕴含的压力修正机制出发，构建推导过程。",
            "solution": "该推导过程基于用于求解低马赫数范围内Navier-Stokes方程的SIMPLE族算法的基本原理。\n\n在像SIMPLE这样的基于压力的求解器中，一个关键步骤是求解由连续性方程导出的压力修正方程。线性化动量方程提供了速度修正量 $\\mathbf{u'}$ 与压力修正量梯度 $\\nabla p'$ 之间的关系。问题将此关系概括为面 $f$ 上的质量通量修正与离散压力梯度成正比：\n$$ \\delta(\\rho u)_f = - \\kappa_f \\frac{p'_{R} - p'_{L}}{\\Delta x} $$\n其中 $p'_{L}$ 和 $p'_{R}$ 是相邻单元的压力修正量，$\\kappa_f = \\rho_f/a$ 是有效传导率。\n\n将此通量修正代入离散连续性方程，会得到一个关于 $p'$ 的类泊松方程。该方程迭代解的收敛行为可以通过分析其傅里叶模态的放大因子 $g$ 来研究。问题给出了 $g$ 的函数形式：\n$$ g = 1 - \\alpha_{p} \\, C \\, \\kappa_{f} \\, \\sin^{2}\\left(\\frac{k \\Delta x}{2}\\right) $$\n其中 $\\alpha_p$ 是压力松弛因子，$C$ 是一个常数。\n\n最坏情况的收敛性由谱半径 $\\rho$ 决定，它对应于最高可分辨模态，此时 $k \\Delta x = \\pi$，因此 $\\sin^2(k \\Delta x / 2) = 1$。谱半径由下式给出：\n$$ \\rho = \\left| g \\right|_{k \\Delta x = \\pi} = \\left| 1 - \\alpha_{p} \\, C \\, \\kappa_{f} \\right| $$\n这里的 $\\kappa_f$ 是在冷热界面上的值。SIMPLEC和SIMPLER的区别在于如何计算这个界面传导率。\n\n首先，分析SIMPLEC算法。它使用传导率的算术平均值：\n$$ \\kappa_A = \\frac{1}{2} \\left( \\frac{\\rho_c}{a} + \\frac{\\rho_h}{a} \\right) = \\frac{\\rho_c}{2a} (1 + r) $$\n其中 $r = \\rho_h / \\rho_c$ 是密度比。SIMPLEC的谱半径为：\n$$ \\rho_{\\text{SIMPLEC}} = \\left| 1 - \\alpha_{p} \\, C \\, \\kappa_A \\right| = \\left| 1 - \\alpha_{p} \\, C \\, \\frac{\\rho_c}{a} \\frac{1+r}{2} \\right| $$\n使用无量纲松弛强度的定义 $s = \\alpha_{p} \\, C \\, \\frac{\\rho_{c}}{a}$，我们得到：\n$$ \\rho_{\\text{SIMPLEC}} = \\left| 1 - s \\frac{1+r}{2} \\right| $$\n\n接下来，分析SIMPLER算法。它使用传导率的调和平均值：\n$$ \\kappa_H = \\left( \\frac{1}{2} \\left[ \\left(\\frac{\\rho_c}{a}\\right)^{-1} + \\left(\\frac{\\rho_h}{a}\\right)^{-1} \\right] \\right)^{-1} = \\frac{2a \\rho_c \\rho_h}{\\rho_c + \\rho_h} $$\n用基准密度 $\\rho_c$ 和密度比 $r$ 来表示：\n$$ \\kappa_H = \\frac{2a \\rho_c (r \\rho_c)}{\\rho_c + r \\rho_c} = \\frac{\\rho_c}{a} \\frac{2r}{1+r} $$\nSIMPLER的谱半径为：\n$$ \\rho_{\\text{SIMPLER}} = \\left| 1 - \\alpha_{p} \\, C \\, \\kappa_H \\right| = \\left| 1 - \\alpha_{p} \\, C \\, \\frac{\\rho_c}{a} \\frac{2r}{1+r} \\right| $$\n代入无量纲松弛强度 $s$：\n$$ \\rho_{\\text{SIMPLER}} = \\left| 1 - s \\frac{2r}{1+r} \\right| $$\n\n最后，计算最坏情况谱半径之比：\n$$ \\frac{\\rho_{\\text{SIMPLEC}}}{\\rho_{\\text{SIMPLER}}} = \\frac{\\left| 1 - s \\frac{1+r}{2} \\right|}{\\left| 1 - s \\frac{2r}{1+r} \\right|} $$\n这就是该比率作为密度比 $r$ 和无量纲松弛强度 $s$ 的函数的最终闭式表达式。由于问题没有提供保证绝对值内参数为正的关于 $s$ 的约束条件，因此保留了绝对值符号。",
            "answer": "$$\n\\boxed{\\frac{\\left| 1 - s \\frac{1+r}{2} \\right|}{\\left| 1 - s \\frac{2r}{1+r} \\right|}}\n$$"
        }
    ]
}