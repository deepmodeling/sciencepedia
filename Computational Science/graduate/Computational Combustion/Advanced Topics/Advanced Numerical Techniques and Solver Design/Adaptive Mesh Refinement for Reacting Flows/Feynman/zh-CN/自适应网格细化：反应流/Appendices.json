{
    "hands_on_practices": [
        {
            "introduction": "在应用自适应网格加密（AMR）之前，首要任务是明确为何以及在何处需要加密。本练习将引导你通过分析流动的物理尺度（如对流和反应时间尺度）来确定数值模拟的网格需求。通过计算 Courant 数和 Damköhler 数，你将学会如何从第一性原理出发，推导出满足对流和反应精度所需的最小 AMR 等级，从而将物理洞察力转化为具体的计算策略 。",
            "id": "4006193",
            "problem": "在一个预混、平流主导的反应流中，考虑一个单一反应物种的一维平流-反应模型，其质量分数为 $Y(x,t)$。控制方程为守恒律\n$$\n\\frac{\\partial Y}{\\partial t} + u \\frac{\\partial Y}{\\partial x} = \\omega(Y,T),\n$$\n其中 $u$ 是流速，$\\omega(Y,T)$ 是化学源项。假设一个具有 Arrhenius 速率的全局一阶动力学模型，\n$$\n\\omega(Y,T) = -k(T)\\,Y, \\quad k(T) = A \\exp\\!\\left(-\\frac{E_{a}}{R T}\\right),\n$$\n其中 $A$ 是指前因子，$E_{a}$ 是活化能，$R$ 是通用气体常数，$T$ 是温度。考虑自适应网格加密 (AMR)，层级间的均匀加密比为 $2$。设基础（最粗）层级具有均匀的网格间距 $\\Delta x_{0}$ 和时间步长 $\\Delta t_{0}$。在层级 $\\ell$ 上，设 $\\Delta x_{\\ell} = \\Delta x_{0}/2^{\\ell}$，并假设时间步长被细分为 $\\Delta t_{\\ell} = \\Delta t_{0}/2^{\\ell}$。最大流速为 $u_{\\max}$。\n\n仅使用基于时间尺度的基本定义，完成以下操作：\n\n1. 从单个单元的对流时间尺度和离散时间步长出发，推导给定层级上对流 Courant–Friedrichs–Lewy (CFL) 数的表达式，并使用以下数据在基础层级上对其进行求值。\n2. 从化学速率的 Arrhenius 表达式和化学时间尺度的定义出发，推导并基于对流单元穿越时间与化学时间之比，在基础层级上求一个 Damköhler 数。\n3. 使用您的结果和第一性原理，推导出 AMR 必须满足的约束条件，以同时保持对流精度（CFL 稳定性/精度）和反应精度（反应区的空间分辨率）。假设通过要求在所述时间步长细分下，每一层级的 Courant 数不超过 $0.5$ 来保证对流精度，并通过要求在特征长度为 $\\ell_{r}$ 的反应区内至少有 $N$ 个单元来保证反应空间精度。对于一个扩散可忽略的平流主导区域，取 $\\ell_{r} = u_{\\max} \\,\\tau_{\\mathrm{chem}}$，其中 $\\tau_{\\mathrm{chem}}$ 是化学时间尺度。\n4. 确定最小整数 AMR 层级 $\\ell_{\\min}$，使得对流和反应精度约束都得到满足。\n\n使用以下物理上一致的参数：\n- $u_{\\max} = 25~\\mathrm{m}\\,\\mathrm{s}^{-1}$，\n- $\\Delta x_{0} = 1.6 \\times 10^{-3}~\\mathrm{m}$，\n- $\\Delta t_{0} = 3.0 \\times 10^{-5}~\\mathrm{s}$，\n- $A = 2.0 \\times 10^{6}~\\mathrm{s}^{-1}$，\n- $E_{a} = 8.0 \\times 10^{4}~\\mathrm{J}\\,\\mathrm{mol}^{-1}$，\n- $R = 8.314~\\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$，\n- $T = 1500~\\mathrm{K}$，\n- $N = 12$。\n\n答案规格：\n- 您的计算过程应在解答中展示项目 1-3。\n- 仅报告最小 AMR 层级 $\\ell_{\\min}$ 的最终值作为您的最终答案。\n- 最终答案中不要包含单位。\n- 由于最终答案是整数，因此不需要舍入说明。",
            "solution": "首先对问题进行验证，以确保其科学基础扎实、提法恰当且完整。\n\n### 第1步：提取已知条件\n质量分数 $Y(x,t)$ 的控制偏微分方程为：\n$$\n\\frac{\\partial Y}{\\partial t} + u \\frac{\\partial Y}{\\partial x} = \\omega(Y,T)\n$$\n化学源项和 Arrhenius 速率常数为：\n$$\n\\omega(Y,T) = -k(T)\\,Y, \\quad k(T) = A \\exp\\!\\left(-\\frac{E_{a}}{R T}\\right)\n$$\n自适应网格加密 (AMR) 参数：\n- 均匀加密比：$2$\n- 层级 $\\ell$ 上的网格间距：$\\Delta x_{\\ell} = \\Delta x_{0}/2^{\\ell}$\n- 层级 $\\ell$ 上的时间步长：$\\Delta t_{\\ell} = \\Delta t_{0}/2^{\\ell}$\n\n物理和数值参数：\n- 最大流速：$u_{\\max} = 25~\\mathrm{m}\\,\\mathrm{s}^{-1}$\n- 基础层级网格间距：$\\Delta x_{0} = 1.6 \\times 10^{-3}~\\mathrm{m}$\n- 基础层级时间步长：$\\Delta t_{0} = 3.0 \\times 10^{-5}~\\mathrm{s}$\n- 指前因子：$A = 2.0 \\times 10^{6}~\\mathrm{s}^{-1}$\n- 活化能：$E_{a} = 8.0 \\times 10^{4}~\\mathrm{J}\\,\\mathrm{mol}^{-1}$\n- 通用气体常数：$R = 8.314~\\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$\n- 温度：$T = 1500~\\mathrm{K}$\n- 反应区所需单元数：$N = 12$\n\n约束与定义：\n- 对流精度：每个层级 $\\ell$ 上的 Courant 数 $C_{\\ell} \\le 0.5$。\n- 反应区特征长度：$\\ell_{r} = u_{\\max} \\,\\tau_{\\mathrm{chem}}$，其中 $\\tau_{\\mathrm{chem}}$ 是化学时间尺度。\n- 反应精度：至少需要 $N$ 个单元来解析长度 $\\ell_{r}$。\n\n### 第2步：使用提取的已知条件进行验证\n该问题在科学上是合理的，描述了一个典型的一维平流-反应系统，这是计算燃烧学中的一个基本模型。Arrhenius 动力学、Courant-Friedrichs-Lewy (CFL) 数、Damköhler 数以及自适应网格加密 (AMR) 的使用都是该领域中标准且成熟的概念。所提供的参数对于一个预混气相燃烧问题是物理上一致的。问题陈述是完整的、客观的、提法是恰当的，提供了推导唯一整数解所需的所有必要数据和清晰、无歧义的定义。\n\n### 第3步：结论与行动\n问题有效。有必要给出完整解答。\n\n### 解答推导\n\n**1. 对流 Courant–Friedrichs–Lewy (CFL) 数**\n\n对流时间尺度 $\\tau_{\\text{conv},\\ell}$ 是流体元以最大流速 $u_{\\max}$ 穿过宽度为 $\\Delta x_{\\ell}$ 的单个网格单元所需的时间。\n$$\n\\tau_{\\text{conv},\\ell} = \\frac{\\Delta x_{\\ell}}{u_{\\max}}\n$$\nCourant–Friedrichs–Lewy (CFL) 数 $C_{\\ell}$ 定义为离散时间步长 $\\Delta t_{\\ell}$ 与此对流时间尺度之比。\n$$\nC_{\\ell} = \\frac{\\Delta t_{\\ell}}{\\tau_{\\text{conv},\\ell}} = \\frac{\\Delta t_{\\ell}}{(\\Delta x_{\\ell} / u_{\\max})} = \\frac{u_{\\max} \\Delta t_{\\ell}}{\\Delta x_{\\ell}}\n$$\n为了在基础层级（$\\ell=0$）上进行求值，我们使用所提供的数据：\n$$\nC_{0} = \\frac{u_{\\max} \\Delta t_{0}}{\\Delta x_{0}} = \\frac{(25~\\mathrm{m}\\,\\mathrm{s}^{-1}) (3.0 \\times 10^{-5}~\\mathrm{s})}{1.6 \\times 10^{-3}~\\mathrm{m}} = \\frac{7.5 \\times 10^{-4}}{1.6 \\times 10^{-3}} = \\frac{7.5}{16} = 0.46875\n$$\n\n**2. Damköhler 数**\n\n化学反应遵循一阶动力学，$\\frac{dY}{dt} = -k(T)Y$。特征化学时间尺度 $\\tau_{\\mathrm{chem}}$ 是速率常数 $k(T)$ 的倒数。\n$$\n\\tau_{\\mathrm{chem}} = \\frac{1}{k(T)} = \\frac{1}{A \\exp(-E_{a}/(RT))}\n$$\n首先，我们计算指数的参数：\n$$\n\\frac{E_{a}}{RT} = \\frac{8.0 \\times 10^{4}~\\mathrm{J}\\,\\mathrm{mol}^{-1}}{(8.314~\\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1})(1500~\\mathrm{K})} = \\frac{8.0 \\times 10^{4}}{12471} \\approx 6.41532\n$$\n现在，我们计算速率常数 $k(T)$ 和化学时间尺度 $\\tau_{\\mathrm{chem}}$：\n$$\nk(1500~\\mathrm{K}) = (2.0 \\times 10^{6}~\\mathrm{s}^{-1}) \\exp(-6.41532) \\approx (2.0 \\times 10^{6})(1.636 \\times 10^{-3})~\\mathrm{s}^{-1} \\approx 3272.36~\\mathrm{s}^{-1}\n$$\n$$\n\\tau_{\\mathrm{chem}} = \\frac{1}{k(1500~\\mathrm{K})} \\approx \\frac{1}{3272.36~\\mathrm{s}^{-1}} \\approx 3.05589 \\times 10^{-4}~\\mathrm{s}\n$$\n问题将基础层级上的 Damköhler 数 $Da_{0}$ 定义为对流单元穿越时间 $\\tau_{\\text{conv},0}$ 与化学时间 $\\tau_{\\mathrm{chem}}$ 之比。\n$$\n\\tau_{\\text{conv},0} = \\frac{\\Delta x_{0}}{u_{\\max}} = \\frac{1.6 \\times 10^{-3}~\\mathrm{m}}{25~\\mathrm{m}\\,\\mathrm{s}^{-1}} = 6.4 \\times 10^{-5}~\\mathrm{s}\n$$\n$$\nDa_{0} = \\frac{\\tau_{\\text{conv},0}}{\\tau_{\\mathrm{chem}}} \\approx \\frac{6.4 \\times 10^{-5}~\\mathrm{s}}{3.05589 \\times 10^{-4}~\\mathrm{s}} \\approx 0.2094\n$$\n\n**3. AMR 约束**\n\n*   **对流精度约束：** 任意层级 $\\ell$ 上的 CFL 数必须满足 $C_{\\ell} \\le 0.5$。使用 AMR 缩放关系 $\\Delta x_{\\ell} = \\Delta x_0/2^\\ell$ 和 $\\Delta t_\\ell = \\Delta t_0/2^\\ell$：\n    $$\n    C_{\\ell} = \\frac{u_{\\max} \\Delta t_{\\ell}}{\\Delta x_{\\ell}} = \\frac{u_{\\max} (\\Delta t_{0}/2^{\\ell})}{(\\Delta x_{0}/2^{\\ell})} = \\frac{u_{\\max} \\Delta t_{0}}{\\Delta x_{0}} = C_{0}\n    $$\n    这表明，对于规定的时间细分方案，CFL 数在所有 AMR 层级上是恒定的。约束变为 $C_{0} \\le 0.5$。在第1部分，我们计算出 $C_{0} = 0.46875$。由于 $0.46875 \\le 0.5$，所以在所有层级 $\\ell \\ge 0$ 上都满足对流约束。此约束不施加最小 AMR 层级要求。\n\n*   **反应精度约束：** 在适当的 AMR 层级 $\\ell$ 上，反应区必须由至少 $N=12$ 个单元解析。反应区的长度为 $\\ell_{r} = u_{\\max} \\tau_{\\mathrm{chem}}$。跨越此长度的大小为 $\\Delta x_{\\ell}$ 的网格单元数量为 $\\ell_{r} / \\Delta x_{\\ell}$。约束条件是：\n    $$\n    \\frac{\\ell_{r}}{\\Delta x_{\\ell}} \\ge N \\implies \\frac{u_{\\max} \\tau_{\\mathrm{chem}}}{\\Delta x_{\\ell}} \\ge N\n    $$\n    这对反应精度所需的网格间距施加了一个上限：\n    $$\n    \\Delta x_{\\ell} \\le \\frac{u_{\\max} \\tau_{\\mathrm{chem}}}{N}\n    $$\n    所需的网格必须至少有这么精细。\n\n**4. 最小 AMR 层级 $\\ell_{\\min}$**\n\n我们需要找到满足反应精度约束的最小整数 AMR 层级 $\\ell = \\ell_{\\min}$，因为对流精度约束对所有层级均已满足。我们将 $\\Delta x_{\\ell}$ 的表达式代入反应约束不等式中：\n$$\n\\frac{\\Delta x_{0}}{2^{\\ell}} \\le \\frac{u_{\\max} \\tau_{\\mathrm{chem}}}{N}\n$$\n为了找到最小的 $\\ell$，我们求解 $2^{\\ell}$：\n$$\n2^{\\ell} \\ge \\frac{N \\Delta x_{0}}{u_{\\max} \\tau_{\\mathrm{chem}}}\n$$\n现在，我们将已知值代入不等式的右侧：\n$$\n\\frac{N \\Delta x_{0}}{u_{\\max} \\tau_{\\mathrm{chem}}} \\approx \\frac{(12)(1.6 \\times 10^{-3}~\\mathrm{m})}{(25~\\mathrm{m}\\,\\mathrm{s}^{-1})(3.05589 \\times 10^{-4}~\\mathrm{s})} = \\frac{1.92 \\times 10^{-2}}{7.6397 \\times 10^{-3}} \\approx 2.5132\n$$\n求解最小整数 $\\ell$ 的不等式为：\n$$\n2^{\\ell} \\ge 2.5132\n$$\n我们测试 $\\ell$ 的整数值：\n- 对于 $\\ell=0$：$2^{0} = 1$，不满足 $\\ge 2.5132$。\n- 对于 $\\ell=1$：$2^{1} = 2$，不满足 $\\ge 2.5132$。\n- 对于 $\\ell=2$：$2^{2} = 4$，满足 $\\ge 2.5132$。\n\n或者，对两边取自然对数：\n$$\n\\ell \\ln(2) \\ge \\ln(2.5132) \\implies \\ell \\ge \\frac{\\ln(2.5132)}{\\ln(2)} \\approx \\frac{0.9215}{0.6931} \\approx 1.3295\n$$\n由于 AMR 层级 $\\ell$ 必须是整数，满足此条件的最小整数是 $\\ell_{\\min}=2$。\n\n因此，需要最小 AMR 层级为 $\\ell_{\\min}=2$ 来同时满足对流和反应精度约束。在此层级上，网格间距将为 $\\Delta x_2 = \\Delta x_0/4 = 4.0 \\times 10^{-4}~\\mathrm{m}$，这足以解析反应区。",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "在非均匀网格上求解守恒律方程时，一个核心挑战是如何确保在粗细网格界面上物理量的守恒。本练习将带你亲手实践通量重归（flux refluxing）算法，这是保证 AMR 模拟物理精确性的关键技术。你将通过一个具体的平流-扩散问题，一步步计算并应用通量修正，从而深刻理解 AMR 框架如何在不同分辨率的网格间维持质量守恒 。",
            "id": "4006196",
            "problem": "考虑一个反应流中单一物质质量分数$Y$的一维对流-扩散子步，该子步在自适应网格加密（AMR）框架下构建，其中反应通过算子分裂处理，并在此子步中不活跃（即反应源项为零）。在此子步期间，该物质的控制守恒律为\n$$\n\\frac{\\partial (\\rho Y)}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0,\n$$\n总物质通量为\n$$\nF = \\rho u Y - \\rho D \\frac{\\partial Y}{\\partial x},\n$$\n其中$\\rho$是质量密度，$u$是对流速度，$D$是分子扩散系数。假设密度$\\rho$为常数，横截面积均匀为$1$，因此网格体积即为长度。\n\n一个粗网格由两个粗网格单元$C0$和$C1$组成，覆盖范围为$x \\in [0, 2\\Delta x_c]$，粗网格单元宽度为$\\Delta x_c$。一个加密比$r = 2$的细网格覆盖了粗网格单元$C1$的整个空间范围，由两个宽度为$\\Delta x_f = \\Delta x_c/2$的细网格单元$F1$和$F2$组成。$C0$与细网格之间的界面位于$x = \\Delta x_c$。位于$x = \\Delta x_c$处的面由粗网格单元$C0$和细网格单元$F1$共享。位于$x = 0$的左边界是一个具有固定狄利克雷质量分数的入流。\n\n参数和初始数据如下：\n- 密度 $\\rho = 1.0 \\ \\mathrm{kg/m^3}$，\n- 对流速度 $u = 0.8 \\ \\mathrm{m/s}$ (正$x$方向)，\n- 扩散系数 $D = 1.0 \\times 10^{-4} \\ \\mathrm{m^2/s}$，\n- 粗网格宽度 $\\Delta x_c = 2.0 \\times 10^{-3} \\ \\mathrm{m}$，\n- 细网格宽度 $\\Delta x_f = 1.0 \\times 10^{-3} \\ \\mathrm{m}$，\n- 时间步长 $\\Delta t = 5.0 \\times 10^{-4} \\ \\mathrm{s}$，\n- $x=0$处的入流质量分数：$Y_{\\text{in}} = 0.20$，\n- 初始质量分数：$Y_{C0}^n = 0.06$，$Y_{F1}^n = 0.12$，$Y_{F2}^n = 0.08$。\n\n在粗网格层级上，被覆盖的粗网格邻居$C1$由细网格数据的保守限制定义，因此其粗网格质量分数为平均值$Y_{C1}^n = (Y_{F1}^n + Y_{F2}^n)/2$。\n\n使用以下从守恒律和本构通量推导出的物理上标准的离散化原则：\n- 基于$u$的符号对对流面状态$Y$进行迎风选择，\n- 对扩散通量使用中心差分，采用相邻网格中心之间的距离；对于宽度为$\\Delta x_L$和$\\Delta x_R$的两个网格之间的面，中心距为$\\Delta x_L/2 + \\Delta x_R/2$。\n\n任务：\n1. 使用$Y_{C0}^n$和粗网格邻居$Y_{C1}^n$，以及中心距$\\Delta x_c$，计算$C0$右侧面（位于$x = \\Delta x_c$处）的粗网格层级对流-扩散通量。同时，使用$Y_{\\text{in}}$和$Y_{C0}^n$，以及中心距$\\Delta x_c/2$，计算$C0$左边界（位于$x=0$处）的面通量。\n2. 通过有限体积更新（由守恒律所隐含），使用左右两侧面的粗网格层级通量，在时间步长$\\Delta t$内更新$Y_{C0}$。\n3. 使用来自$C0$的迎风状态和来自$F1$的细网格状态，以及中心距$\\Delta x_c/2 + \\Delta x_f/2$，计算$C0$和$F1$之间界面（位于$x = \\Delta x_c$处）的细网格层级通量。\n4. 用细网格层级的界面通量填充一个通量寄存器，并对粗网格单元$C0$应用回流通量修正，使其最终更新的状态与通过$x = \\Delta x_c$的细网格层级界面通量一致。\n5. 根据修正后的$Y_{C0}^{n+1}$，计算$C0$中单位横截面积的最终物质质量，定义为$m_{C0}^{n+1} = \\rho \\, Y_{C0}^{n+1} \\, \\Delta x_c$，并以$\\mathrm{kg/m^2}$为单位表示。\n\n将最终答案四舍五入到四位有效数字，并以$\\mathrm{kg/m^2}$为单位表示最终质量。",
            "solution": "首先根据既定标准对问题进行验证。\n\n### 步骤1：提取已知条件\n- **控制方程**: $\\frac{\\partial (\\rho Y)}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0$\n- **总物质通量**: $F = \\rho u Y - \\rho D \\frac{\\partial Y}{\\partial x}$\n- **网格结构**:\n    - 粗网格单元$C0$位于$x \\in [0, \\Delta x_c]$。\n    - 粗网格单元$C1$位于$x \\in [\\Delta x_c, 2\\Delta x_c]$，被细网格覆盖。\n    - 细网格单元$F1$位于$x \\in [\\Delta x_c, \\Delta x_c + \\Delta x_f]$，细网格单元$F2$位于$x \\in [\\Delta x_c + \\Delta x_f, 2\\Delta x_c]$。\n    - 加密比：$r = 2$。\n    - 粗网格单元宽度：$\\Delta x_c = 2.0 \\times 10^{-3} \\ \\mathrm{m}$。\n    - 细网格单元宽度：$\\Delta x_f = \\Delta x_c / r = 1.0 \\times 10^{-3} \\ \\mathrm{m}$。\n    - $C0$与细网格之间的界面位于$x = \\Delta x_c$。\n- **参数**:\n    - 密度：$\\rho = 1.0 \\ \\mathrm{kg/m^3}$ (常数)。\n    - 对流速度：$u = 0.8 \\ \\mathrm{m/s}$。\n    - 扩散系数：$D = 1.0 \\times 10^{-4} \\ \\mathrm{m^2/s}$。\n    - 时间步长：$\\Delta t = 5.0 \\times 10^{-4} \\ \\mathrm{s}$。\n- **边界和初始条件**:\n    - $x=0$处的入流质量分数：$Y_{\\text{in}} = 0.20$。\n    - $C0$中的初始质量分数：$Y_{C0}^n = 0.06$。\n    - $F1$中的初始质量分数：$Y_{F1}^n = 0.12$。\n    - $F2$中的初始质量分数：$Y_{F2}^n = 0.08$。\n- **离散化规则**:\n    - 迎风对流：$Y$的面状态根据$u$的符号取自上游（迎风侧）网格。由于$u > 0$，使用左侧网格的状态。\n    - 扩散的中心差分：梯度为 $\\frac{\\Delta Y}{\\Delta x_{\\text{centers}}}$。\n    - 对于粗-粗界面（$C0$和$C1$），中心距为 $\\Delta x_c$。\n    - 对于边界-粗网格界面（在$x=0$处），中心距为 $\\Delta x_c/2$。\n    - 对于粗-细界面（在$x=\\Delta x_c$处），中心距为 $\\Delta x_c/2 + \\Delta x_f/2$。\n    - 被覆盖的网格$C1$的粗网格状态为 $Y_{C1}^n = (Y_{F1}^n + Y_{F2}^n)/2$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题是计算流体力学中一个定义明确的数值练习，特别关注带有自适应网格加密（AMR）的有限体积法。\n- **科学基础**：该问题基于标准的对流-扩散方程，这是输运现象中的一个基本模型。AMR概念，如通量回流（flux refluxing），是高级数值格式中的标准技术。所有参数都具有现实的物理单位和合理的量级。\n- **适定性**：该问题提供了一套完整的参数、初始条件、边界条件和明确的离散化规则。它要求进行一系列具体的计算，以得到唯一的数值答案。其结构逻辑清晰，没有矛盾。\n- **客观性**：问题以精确、定量的术语陈述。任务以算法方式指定，没有主观解释的余地。\n\n该问题不违反任何无效性标准。它在科学上是合理的、适定的、完整的和客观的。\n\n### 步骤3：结论和行动\n该问题是**有效的**。将提供详细的解决方案。\n\n### 求解推导\n对于一个密度为常数$\\rho$、体积为$\\Delta x_i$（单位面积）的通用网格$i$，其控制方程的有限体积离散形式为：\n$$ Y_i^{n+1} = Y_i^n - \\frac{\\Delta t}{\\rho \\Delta x_i} (F_{i+1/2} - F_{i-1/2}) $$\n位于左侧网格$L$和右侧网格$R$之间的面上的通量$F$被离散为对流通量和扩散通量之和。给定$u > 0$，对流部分使用左侧网格的状态$Y_L$。扩散通量采用中心差分。\n$$ F_{face} = (\\rho u Y_L) - (\\rho D) \\frac{Y_R - Y_L}{d_{centers}} $$\n其中$d_{centers}$是网格中心之间的距离。\n\n首先，我们确定粗网格邻居$C1$的状态。它是覆盖其上的细网格单元的体积加权平均（限制）。\n$$ Y_{C1}^n = \\frac{Y_{F1}^n \\Delta x_f + Y_{F2}^n \\Delta x_f}{\\Delta x_c} = \\frac{Y_{F1}^n + Y_{F2}^n}{r} $$\n当$r=2$时，这是一个简单的平均值：\n$$ Y_{C1}^n = \\frac{0.12 + 0.08}{2} = 0.10 $$\n\n**任务1：计算$C0$的粗网格层级通量**\n\n网格$C0$的左侧面在$x=0$处，右侧面在$x=\\Delta x_c$处。\n\n- **$C0$左侧面（位于$x=0$处）的通量$F_{C0,left}$：**\n左侧“网格”是边界条件$Y_{\\text{in}}$，右侧网格是$C0$。给定的中心距为$d_{centers} = \\Delta x_c / 2$。\n对流使用上游状态$Y_{\\text{in}}$。\n$$ F_{C0,left} = \\rho u Y_{\\text{in}} - \\rho D \\frac{Y_{C0}^n - Y_{\\text{in}}}{\\Delta x_c / 2} $$\n$$ F_{C0,left} = (1.0)(0.8)(0.20) - (1.0)(1.0 \\times 10^{-4}) \\frac{0.06 - 0.20}{2.0 \\times 10^{-3} / 2} $$\n$$ F_{C0,left} = 0.16 - (1.0 \\times 10^{-4}) \\frac{-0.14}{1.0 \\times 10^{-3}} = 0.16 - (1.0 \\times 10^{-4})(-140) = 0.16 + 0.014 = 0.174 $$\n\n- **$C0$右侧面（位于$x=\\Delta x_c$处）的通量$F_{C0,right}^c$，粗网格层级：**\n左侧网格是$C0$，右侧网格是$C1$。给定的中心距为$d_{centers} = \\Delta x_c$。\n对流使用左侧状态$Y_{C0}^n$。\n$$ F_{C0,right}^c = \\rho u Y_{C0}^n - \\rho D \\frac{Y_{C1}^n - Y_{C0}^n}{\\Delta x_c} $$\n$$ F_{C0,right}^c = (1.0)(0.8)(0.06) - (1.0)(1.0 \\times 10^{-4}) \\frac{0.10 - 0.06}{2.0 \\times 10^{-3}} $$\n$$ F_{C0,right}^c = 0.048 - (1.0 \\times 10^{-4}) \\frac{0.04}{2.0 \\times 10^{-3}} = 0.048 - (1.0 \\times 10^{-4})(20) = 0.048 - 0.002 = 0.046 $$\n\n**任务2：使用粗网格通量更新$Y_{C0}$**\n\n这是仅使用粗网格层级信息对$C0$进行的临时更新。\n$$ Y_{C0}^{n+1, \\text{coarse}} = Y_{C0}^n - \\frac{\\Delta t}{\\rho \\Delta x_c} (F_{C0,right}^c - F_{C0,left}) $$\n$$ Y_{C0}^{n+1, \\text{coarse}} = 0.06 - \\frac{5.0 \\times 10^{-4}}{(1.0)(2.0 \\times 10^{-3})} (0.046 - 0.174) $$\n$$ Y_{C0}^{n+1, \\text{coarse}} = 0.06 - (0.25) (-0.128) = 0.06 + 0.032 = 0.092 $$\n\n**任务3：计算细网格层级界面通量**\n\n这是在粗-细界面$x=\\Delta x_c$处更精确的通量。左侧网格是$C0$，右侧网格是细网格单元$F1$。中心距为$d_{centers} = \\Delta x_c/2 + \\Delta x_f/2$。\n$$ d_{centers} = \\frac{2.0 \\times 10^{-3}}{2} + \\frac{1.0 \\times 10^{-3}}{2} = 1.0 \\times 10^{-3} + 0.5 \\times 10^{-3} = 1.5 \\times 10^{-3} \\ \\mathrm{m} $$\n细网格层级通量$F_{C0,right}^f$为：\n$$ F_{C0,right}^f = \\rho u Y_{C0}^n - \\rho D \\frac{Y_{F1}^n - Y_{C0}^n}{\\Delta x_c/2 + \\Delta x_f/2} $$\n$$ F_{C0,right}^f = (1.0)(0.8)(0.06) - (1.0)(1.0 \\times 10^{-4}) \\frac{0.12 - 0.06}{1.5 \\times 10^{-3}} $$\n$$ F_{C0,right}^f = 0.048 - (1.0 \\times 10^{-4}) \\frac{0.06}{1.5 \\times 10^{-3}} = 0.048 - (1.0 \\times 10^{-4})(40) = 0.048 - 0.004 = 0.044 $$\n\n**任务4：应用回流通量修正**\n\n回流通量修正（flux refluxing）程序修正粗网格状态，以确保在粗-细界面的守恒性。对$Y_{C0}^{n+1, \\text{coarse}}$的更新基于界面处粗网格层级通量和细网格层级通量之间的差异。\n由于通量差异，$C0$中物质质量的变化为$\\Delta m = (F_{C0,right}^c - F_{C0,right}^f) \\Delta t A$。由于面积$A=1$，对状态变量$Y_{C0}$的修正为：\n$$ \\Delta Y_{C0}^{\\text{reflux}} = \\frac{(F_{C0,right}^c - F_{C0,right}^f) \\Delta t}{\\rho \\Delta x_c} $$\n$$ \\Delta Y_{C0}^{\\text{reflux}} = \\frac{(0.046 - 0.044) (5.0 \\times 10^{-4})}{(1.0) (2.0 \\times 10^{-3})} = \\frac{(0.002) (5.0 \\times 10^{-4})}{2.0 \\times 10^{-3}} = \\frac{1.0 \\times 10^{-6}}{2.0 \\times 10^{-3}} = 0.0005 $$\n$C0$的最终修正状态为：\n$$ Y_{C0}^{n+1} = Y_{C0}^{n+1, \\text{coarse}} + \\Delta Y_{C0}^{\\text{reflux}} $$\n$$ Y_{C0}^{n+1} = 0.092 + 0.0005 = 0.0925 $$\n\n**任务5：计算$C0$中的最终物质质量**\n\n网格$C0$中单位横截面积的最终物质质量为：\n$$ m_{C0}^{n+1} = \\rho \\, Y_{C0}^{n+1} \\, \\Delta x_c $$\n$$ m_{C0}^{n+1} = (1.0 \\ \\mathrm{kg/m^3}) \\times (0.0925) \\times (2.0 \\times 10^{-3} \\ \\mathrm{m}) $$\n$$ m_{C0}^{n+1} = 0.185 \\times 10^{-3} \\ \\mathrm{kg/m^2} = 1.85 \\times 10^{-4} \\ \\mathrm{kg/m^2} $$\n问题要求将答案四舍五入到四位有效数字。\n$$ m_{C0}^{n+1} = 1.850 \\times 10^{-4} \\ \\mathrm{kg/m^2} $$",
            "answer": "$$\\boxed{1.850 \\times 10^{-4}}$$"
        },
        {
            "introduction": "高效的 AMR 策略不仅需要加密关键区域，也需要在不再需要高分辨率时进行网格粗化。然而，简单的粗化判据可能会导致在火焰熄灭后过早地移除精细网格，从而错过随后的再燃现象。本练习通过一个编程实践，让你对比简单的阈值策略和更鲁棒的“迟滞”策略，以避免这种“数值振荡”，并量化迟滞策略在处理燃烧流中瞬态现象时的优势 。",
            "id": "4006195",
            "problem": "考虑一维反应流，其中先前燃烧的预混火焰已被淬熄，并可能随后再燃。令体积放热率场表示为 $\\dot{q}(x,t)$，单位为 $\\mathrm{W/m^3}$，并基于空间梯度 $G(x,t) = \\left|\\partial \\dot{q}(x,t)/\\partial x\\right|$ 的大小定义一个基于梯度的自适应网格加密（AMR）粗化指示器，其单位为 $\\mathrm{W/m^4}$。目标是在给定的域和时间范围内，为每个时间步计算一个粗化掩码，该掩码指示哪些单元格将根据梯度阈值策略被粗化，并量化会错过即将发生的再燃的过早粗化事件。然后，演示带有记忆的迟滞阈值如何避免此类过早粗化。\n\n从反应流中的能量守恒出发，这启发我们将监测 $\\dot{q}(x,t)$ 作为反应区活动的代理指标。为了进行算法测试，将一个淬熄火焰建模，其放热场在空间上局部化为一个以位置 $x_0$ 为中心、标准差为 $\\sigma_x$ 的高斯分布，再乘以一个随时间变化的振幅，该振幅由指数衰减的基线和可选的一个或多个代表再燃事件的时间高斯脉冲组成。具体来说，在空间域 $x \\in [0, L]$ 和时间区间 $t \\in [0, T_{\\text{end}}]$ 上，定义\n$$\n\\dot{q}(x,t) = \\left( A_0 e^{-t/\\tau_d} + \\sum_{k=1}^{N_p} B_k \\exp\\!\\left[-\\frac{(t - t_k)^2}{2\\sigma_{t,k}^2}\\right] \\right) \\exp\\!\\left[-\\frac{(x - x_0)^2}{2\\sigma_x^2}\\right],\n$$\n其中 $A_0$ 是初始基线振幅（单位 $\\mathrm{W/m^3}$），$\\tau_d$ 是衰减时间常数（单位 $\\mathrm{s}$），每个 $B_k$ 是在时间 $t_k$ 的脉冲振幅（单位 $\\mathrm{W/m^3}$），其时间宽度为 $\\sigma_{t,k}$（单位 $\\mathrm{s}$），$N_p$ 是脉冲数量。空间网格是均匀的，间距为 $\\Delta x$；时间网格也是均匀的，间距为 $\\Delta t$。\n\n定义两种粗化策略：\n\n1. 朴素单阈值策略，粗化阈值为 $\\theta_c$（单位 $\\mathrm{W/m^4}$）：在时间 $t_j$，如果 $G(x_i,t_j) \\le \\theta_c$，则粗化单元格 $i$；否则，保持其加密状态。\n\n2. 迟滞双阈值策略，加密阈值为 $\\theta_r$（单位 $\\mathrm{W/m^4}$），粗化阈值为 $\\theta_c$（单位 $\\mathrm{W/m^4}$），记忆时间为 $\\tau_{\\mathrm{mem}}$（单位 $\\mathrm{s}$）：为每个单元格维护一个记忆，记录最近一次满足 $G(x_i,t) \\ge \\theta_r$ 的时间 $t^{\\mathrm{last}}_{\\mathrm{high}}(i)$。在时间 $t_j$，对于每个单元格 $i$，如果 $G(x_i,t_j) \\ge \\theta_r$，则设置 $t^{\\mathrm{last}}_{\\mathrm{high}}(i) \\leftarrow t_j$。然后，当且仅当 $G(x_i,t_j) \\le \\theta_c$ 且 $t_j - t^{\\mathrm{last}}_{\\mathrm{high}}(i) \\ge \\tau_{\\mathrm{mem}}$ 同时满足时，粗化单元格 $i$；否则，保持其加密状态。将所有单元格 $i$ 的 $t^{\\mathrm{last}}_{\\mathrm{high}}(i)$ 初始化为 $-\\infty$。\n\n为了量化会错过再燃的过早粗化，在每个时间 $t_j$ 定义一个前瞻期 $T_{\\mathrm{future}}$（单位 $\\mathrm{s}$）。对于在 $t_j$ 被粗化的任何单元格，如果在未来的任何时间 $t \\in (t_j, t_j + T_{\\mathrm{future}}]$ 存在 $G(x_i,t) \\ge \\theta_r$，则判定其为一次过早粗化。令 $E_{\\mathrm{naive}}$ 为在朴素策略下，所有单元格和时间步中此类过早粗化的总数；$E_{\\mathrm{hyst}}$ 为在迟滞策略下的类似计数。定义改进分数为\n$$\n\\Phi = \\frac{E_{\\mathrm{naive}} - E_{\\mathrm{hyst}}}{\\max(1, E_{\\mathrm{naive}})},\n$$\n这是一个无单位的小数。\n\n实现一个程序，该程序：\n- 在指定的网格上构建 $\\dot{q}(x,t)$。\n- 使用二阶精度的空间有限差分近似计算 $G(x,t)$。\n- 随着时间的推移应用两种粗化策略，并使用前瞻准则来统计 $E_{\\mathrm{naive}}$ 和 $E_{\\mathrm{hyst}}$。\n- 对于每个测试用例，输出三元组 $(E_{\\mathrm{naive}}, E_{\\mathrm{hyst}}, \\Phi)$。\n\n所有参数值均以国际单位制（SI）表示。输出的计数是整数，改进分数是小数。\n\n您必须实现并评估以下测试套件，它涵盖了不同的场景：\n\n- 测试用例 1（具有单次再燃脉冲的淬熄火焰）：\n    - $L = 0.02$ $\\mathrm{m}$，$x_0 = 0.01$ $\\mathrm{m}$，$\\sigma_x = 0.001$ $\\mathrm{m}$，$\\Delta x = 0.0001$ $\\mathrm{m}$。\n    - $T_{\\text{end}} = 0.20$ $\\mathrm{s}$，$\\Delta t = 0.002$ $\\mathrm{s}$。\n    - $A_0 = 8.0 \\times 10^7$ $\\mathrm{W/m^3}$，$\\tau_d = 0.05$ $\\mathrm{s}$。\n    - 单脉冲：$N_p = 1$，其中 $B_1 = 1.2 \\times 10^8$ $\\mathrm{W/m^3}$，$t_1 = 0.12$ $\\mathrm{s}$，$\\sigma_{t,1} = 0.01$ $\\mathrm{s}$。\n    - 阈值和记忆时间：$\\theta_r = 2.5 \\times 10^{10}$ $\\mathrm{W/m^4}$，$\\theta_c = 1.2 \\times 10^{10}$ $\\mathrm{W/m^4}$，$\\tau_{\\mathrm{mem}} = 0.02$ $\\mathrm{s}$。\n    - 前瞻期：$T_{\\mathrm{future}} = 0.02$ $\\mathrm{s}$。\n\n- 测试用例 2（单调衰减，无再燃）：\n    - 空间和时间网格参数与测试用例 1 相同。\n    - $A_0 = 8.0 \\times 10^7$ $\\mathrm{W/m^3}$，$\\tau_d = 0.05$ $\\mathrm{s}$。\n    - 无脉冲：$N_p = 0$。\n    - 阈值和记忆时间：$\\theta_r = 2.5 \\times 10^{10}$ $\\mathrm{W/m^4}$，$\\theta_c = 1.2 \\times 10^{10}$ $\\mathrm{W/m^4}$，$\\tau_{\\mathrm{mem}} = 0.02$ $\\mathrm{s}$。\n    - 前瞻期：$T_{\\mathrm{future}} = 0.02$ $\\mathrm{s}$。\n\n- 测试用例 3（可能导致抖动(thrashing)的间歇性脉冲）：\n    - $L = 0.02$ $\\mathrm{m}$，$x_0 = 0.01$ $\\mathrm{m}$，$\\sigma_x = 0.001$ $\\mathrm{m}$，$\\Delta x = 0.0001$ $\\mathrm{m}$。\n    - $T_{\\text{end}} = 0.20$ $\\mathrm{s}$，$\\Delta t = 0.002$ $\\mathrm{s}$。\n    - $A_0 = 5.0 \\times 10^7$ $\\mathrm{W/m^3}$，$\\tau_d = 0.10$ $\\mathrm{s}$。\n    - 三脉冲：$N_p = 3$，其中 $(B_1, t_1, \\sigma_{t,1}) = (9.0 \\times 10^7, 0.05, 0.005)$，$(B_2, t_2, \\sigma_{t,2}) = (9.0 \\times 10^7, 0.07, 0.005)$，$(B_3, t_3, \\sigma_{t,3}) = (9.0 \\times 10^7, 0.09, 0.005)$；$B_k$ 的单位是 $\\mathrm{W/m^3}$，$t_k$ 和 $\\sigma_{t,k}$ 的单位是 $\\mathrm{s}$。\n    - 阈值和记忆时间：$\\theta_r = 2.0 \\times 10^{10}$ $\\mathrm{W/m^4}$，$\\theta_c = 1.0 \\times 10^{10}$ $\\mathrm{W/m^4}$，$\\tau_{\\mathrm{mem}} = 0.03$ $\\mathrm{s}$。\n    - 前瞻期：$T_{\\mathrm{future}} = 0.02$ $\\mathrm{s}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，格式为 $[E_{\\mathrm{naive,1}}, E_{\\mathrm{hyst,1}}, \\Phi_1, E_{\\mathrm{naive,2}}, E_{\\mathrm{hyst,2}}, \\Phi_2, E_{\\mathrm{naive,3}}, E_{\\mathrm{hyst,3}}, \\Phi_3]$，其中下标表示测试用例的索引。计数 $E_{\\mathrm{naive}}$ 和 $E_{\\mathrm{hyst}}$ 必须是整数，改进分数 $\\Phi$ 必须是小数。",
            "solution": "用户提供的问题被评估为有效。它在科学上基于计算燃烧学和自适应网格加密的原理，问题定义清晰，指令明确且具有确定性，并使用了客观、正式的语言。所有必要的参数和定义都已提供，该问题构成了一个重要的算法设计和评估任务。\n\n解决方案是通过遵循系统性的、基于原则的方法来实现的。问题的核心是为一个简化的一维反应流模型模拟和比较两种不同的粗化策略。解决方案的结构如下：\n\n1.  **问题建模与离散化**：\n    放热率场 $\\dot{q}(x,t)$ 定义在连续的空间域 $x \\in [0, L]$ 和时间区间 $t \\in [0, T_{\\text{end}}]$ 上。对于数值解，这些连续的域必须被离散化。空间域被划分为一个均匀的点网格 $x_i = i \\cdot \\Delta x$，$i = 0, 1, \\dots, N_x-1$，其中点数为 $N_x = \\text{round}(L/\\Delta x) + 1$。类似地，时间区间被离散化为点 $t_j = j \\cdot \\Delta t$，$j = 0, 1, \\dots, N_t-1$，其中时间步数为 $N_t = \\text{round}(T_{\\text{end}}/\\Delta t) + 1$。\n    然后，在这一离散网格上评估所提供的 $\\dot{q}(x,t)$ 解析模型，以生成一个大小为 $N_t \\times N_x$ 的矩阵 $\\mathbf{Q}$，其中 $\\mathbf{Q}_{ji} = \\dot{q}(x_i, t_j)$。\n    $\\dot{q}(x,t)$ 的表达式由下式给出：\n    $$\n    \\dot{q}(x,t) = A(t) \\cdot S(x)\n    $$\n    其中随时间变化的振幅是\n    $$\n    A(t) = A_0 e^{-t/\\tau_d} + \\sum_{k=1}^{N_p} B_k \\exp\\!\\left[-\\frac{(t - t_k)^2}{2\\sigma_{t,k}^2}\\right]\n    $$\n    空间分布是\n    $$\n    S(x) = \\exp\\!\\left[-\\frac{(x - x_0)^2}{2\\sigma_x^2}\\right]\n    $$\n\n2.  **梯度场计算**：\n    粗化指示器基于放热率空间梯度的大小，$G(x,t) = |\\partial \\dot{q}(x,t) / \\partial x|$。为了在离散网格上计算它，需要一个二阶精度的有限差分近似。对于一个内部点 $x_i$，使用中心差分格式：\n    $$\n    \\frac{\\partial \\dot{q}}{\\partial x}\\bigg|_{x_i, t_j} \\approx \\frac{\\dot{q}(x_{i+1}, t_j) - \\dot{q}(x_{i-1}, t_j)}{2\\Delta x}\n    $$\n    为了在域的边界（$i=0$ 和 $i=N_x-1$）保持二阶精度，采用了二阶精度的单边（前向和后向）差分格式。对所有点 $(x_i, t_j)$ 高效地执行此整个操作，以生成梯度矩阵 $\\mathbf{G}$，其中 $\\mathbf{G}_{ji} = G(x_i, t_j)$。\n\n3.  **粗化策略模拟**：\n    模拟的核心涉及遍历每个单元格（由 $i$ 索引）和每个时间步（由 $j$ 索引），以应用两种粗化策略。\n\n    *   **朴素单阈值策略**：如果单元格 $i$ 对应的梯度值低于粗化阈值 $\\theta_c$，则在时间 $t_j$ 将其标记为待粗化。\n        在时间 $t_j$ 粗化单元格 $i$ 的条件：\n        $$\n        G(x_i, t_j) \\le \\theta_c\n        $$\n\n    *   **迟滞双阈值策略**：此策略在决策过程中引入了记忆。它使用两个阈值，一个加密阈值 $\\theta_r$ 和一个粗化阈值 $\\theta_c$（其中 $\\theta_c \\le \\theta_r$），以及一个记忆时间 $\\tau_{\\mathrm{mem}}$。对于每个单元格 $i$，一个变量 $t^{\\mathrm{last}}_{\\mathrm{high}}(i)$ 存储梯度上一次为高的最近时间。\n        在每个时间 $t_j$，更新记忆：如果 $G(x_i, t_j) \\ge \\theta_r$，则将 $t^{\\mathrm{last}}_{\\mathrm{high}}(i)$ 设置为 $t_j$。\n        在时间 $t_j$ 粗化单元格 $i$ 的条件要求同时满足两个标准：梯度必须低，并且自上次梯度为高以来必须经过足够长的时间。\n        在时间 $t_j$ 粗化单元格 $i$ 的条件：\n        $$\n        G(x_i, t_j) \\le \\theta_c \\quad \\text{and} \\quad t_j - t^{\\mathrm{last}}_{\\mathrm{high}}(i) \\ge \\tau_{\\mathrm{mem}}\n        $$\n    所有 $t^{\\mathrm{last}}_{\\mathrm{high}}(i)$ 的初始值都设置为 $-\\infty$，以确保在任何高梯度事件发生之前的早期时间里，记忆条件不会被轻易满足。\n\n4.  **过早粗化的量化**：\n    为了评估粗化决策的质量，定义了一个前瞻机制。如果单元格 $i$ 在时间 $t_j$ 的粗化决策之后，其梯度注定会在持续时间为 $T_{\\mathrm{future}}$ 的未来时间窗口内上升到超过加密阈值 $\\theta_r$，则该决策被视为“过早的”。\n    具体来说，如果一个策略决定在时间 $t_j$ 粗化单元格 $i$，我们会检查在区间 $(t_j, t_j + T_{\\mathrm{future}}]$ 内是否存在任何未来时间 $t$，使得 $G(x_i, t) \\ge \\theta_r$。在离散化模拟中，这对应于检查对于任何满足 $j  k \\le j + \\text{round}(T_{\\mathrm{future}}/\\Delta t)$ 的时间索引 $k$，是否有 $\\mathbf{G}_{ki} \\ge \\theta_r$。如果满足此条件，则为该策略计入一次过早粗化事件。在所有单元格和时间步上的总计数分别累积到 $E_{\\mathrm{naive}}$ 和 $E_{\\mathrm{hyst}}$ 中。\n\n5.  **性能改进度量**：\n    迟滞策略相对于朴素策略的有效性通过改进分数 $\\Phi$ 来量化：\n    $$\n    \\Phi = \\frac{E_{\\mathrm{naive}} - E_{\\mathrm{hyst}}}{\\max(1, E_{\\mathrm{naive}})}\n    $$\n    该度量衡量了使用迟滞策略实现的过早粗化事件的相对减少量。分母 $\\max(1, E_{\\mathrm{naive}})$ 可防止除以零，并在 $E_{\\mathrm{naive}} = E_{\\mathrm{hyst}} = 0$ 时提供一个有意义的 $\\Phi=0$ 值。\n\n整体算法首先预先计算整个 $\\dot{q}(x,t)$ 和 $G(x,t)$ 场。然后，它遍历所有网格点 $(x_i, t_j)$ 以应用两种策略，检查任何粗化决策的前瞻条件，并增加各自的错误计数器 $E_{\\mathrm{naive}}$ 和 $E_{\\mathrm{hyst}}$。最后，为每个测试用例计算 $\\Phi$。此方法针对三个指定的测试用例进行实现，以生成最终结果。",
            "answer": "[126,0,1.0,0,0,0.0,30,0,1.0]"
        }
    ]
}