{
    "hands_on_practices": [
        {
            "introduction": "In many computational combustion models, thermodynamic properties are pre-tabulated against a conserved scalar like mixture fraction, $Z$, to reduce computational cost. This exercise guides you through constructing such a thermochemical state relation, $T(Z,p)$, for a transcritical fluid where pseudo-boiling introduces a strong, non-linear coupling between temperature and enthalpy. By numerically integrating a surrogate model for the specific heat capacity, $c_p$, you will build an enthalpy table and then invert it to map the mixture state back to temperature, a fundamental skill in modeling non-ideal fluid mixing .",
            "id": "4055428",
            "problem": "You are asked to formalize the mixture fraction definition for a non-reacting, single-component transcritical jet and to construct a numerically invertible thermochemical state relation mapping the mixture fraction to temperature at a specified pressure. You must then implement the computation in a fully deterministic program that evaluates this state relation for a prescribed test suite.\n\nConsider a non-reacting, single-component transcritical jet of a fluid injected into a hotter environment. Assume constant pressure mixing and neglect heat of mixing and compressibility work. Let the pressure be denoted by $p$, the temperature by $T$, the specific heat capacity at constant pressure by $c_{p}$, and the specific enthalpy by $h$.\n\nFundamental bases to use:\n- Conservation of mass for two-stream mixing implies a conserved scalar for any passively transported quantity. Define the two-stream mixture fraction $Z$ such that any conserved scalar $\\phi$ satisfies $\\phi(Z)=Z\\,\\phi_{\\mathrm{jet}}+\\left(1-Z\\right)\\phi_{\\mathrm{env}}$, where the subscripts denote values in the jet and environment streams, respectively.\n- At constant pressure, the specific enthalpy satisfies $h(T,p)=h(T_{\\mathrm{ref}},p)+\\int_{T_{\\mathrm{ref}}}^{T} c_{p}(T',p)\\,dT'$, where $T_{\\mathrm{ref}}$ is any reference temperature and $c_{p}(T,p)>0$.\n- Pseudo-boiling is represented as a peak in $c_{p}(T,p)$ near a Widom-like locus $T_{\\mathrm{w}}(p)$ above the critical point, leading to a sharp variation of $h(T,p)$ with $T$ near $T_{\\mathrm{w}}(p)$ while remaining strictly monotone in $T$.\n\nModel and numerical construction to use for the real-fluid tables:\n- Use an analytic model for the specific heat capacity with a Gaussian peak superimposed on a baseline,\n$$\nc_{p}(T,p)=c_{p,0}+A(p)\\,\\exp\\!\\left(-\\dfrac{\\left(T-T_{\\mathrm{w}}(p)\\right)^{2}}{2\\,\\sigma^{2}}\\right),\n$$\nwith $c_{p,0}>0$, peak amplitude $A(p)>0$, width $\\sigma>0$, and Widom-like temperature $T_{\\mathrm{w}}(p)$ given by\n$$\nT_{\\mathrm{w}}(p)=T_{\\mathrm{c}}+a\\,\\ln\\!\\left(\\dfrac{p}{p_{\\mathrm{c}}}\\right),\n\\quad\nA(p)=A_{0}\\,\\exp\\!\\left(-\\left(\\dfrac{\\ln\\!\\left(p/p_{\\mathrm{c}}\\right)}{b}\\right)^{2}\\right).\n$$\n- Use the following constants (representative of an oxygen-like fluid):\n$T_{\\mathrm{c}}=154.6\\,\\mathrm{K}$, $p_{\\mathrm{c}}=5.043\\times 10^{6}\\,\\mathrm{Pa}$, $c_{p,0}=1200\\,\\mathrm{J}\\cdot\\mathrm{kg}^{-1}\\cdot\\mathrm{K}^{-1}$, $A_{0}=20000\\,\\mathrm{J}\\cdot\\mathrm{kg}^{-1}\\cdot\\mathrm{K}^{-1}$, $\\sigma=6\\,\\mathrm{K}$, $a=35\\,\\mathrm{K}$, $b=1.0$.\n- Build a temperature table $T_{i}$ on a uniform grid from $T_{\\min}=80\\,\\mathrm{K}$ to $T_{\\max}=400\\,\\mathrm{K}$ and tabulate $h(T_{i},p)$ using numerical quadrature starting from $h(T_{\\min},p)=0$.\n\nDefinition of the mixture fraction and the state relation:\n- Define the two-stream mixture fraction $Z$ as the conserved-scalar interpolant for specific enthalpy at constant pressure,\n$$\nh_{\\mathrm{mix}}(Z,p)=Z\\,h\\!\\left(T_{\\mathrm{jet}},p\\right)+\\left(1-Z\\right)\\,h\\!\\left(T_{\\mathrm{env}},p\\right).\n$$\n- Define the thermochemical state relation $T(Z,p)$ as the unique temperature solving\n$$\nh\\!\\left(T(Z,p),p\\right)=h_{\\mathrm{mix}}(Z,p),\n$$\nwith $T(Z,p)\\in[T_{\\min},T_{\\max}]$. Because $c_{p}(T,p)>0$, $h(T,p)$ is strictly increasing in $T$, so $T(Z,p)$ exists and is unique for $h_{\\mathrm{mix}}(Z,p)\\in[h(T_{\\min},p),h(T_{\\max},p)]$.\n\nProgram requirements:\n- Implement the construction of the $c_{p}(T,p)$ model, the enthalpy table $h(T,p)$ by numerical quadrature, and an inversion routine to obtain $T(Z,p)$ from $h_{\\mathrm{mix}}(Z,p)$ by table inversion.\n- Use $T_{\\mathrm{jet}}=120\\,\\mathrm{K}$ and $T_{\\mathrm{env}}=300\\,\\mathrm{K}$. All temperatures must be expressed and returned in Kelvin. All pressures must be in Pascal.\n- The final answers must be the temperatures $T(Z,p)$ in Kelvin, rounded to one decimal place.\n\nTest suite:\nEvaluate $T(Z,p)$ for the following ordered list of cases, each specified as $(p,Z)$ with $p$ in Pascal and $Z$ dimensionless:\n$1.$ $(5.5\\times 10^{6},\\,0.0)$,\n$2.$ $(5.5\\times 10^{6},\\,1.0)$,\n$3.$ $(5.5\\times 10^{6},\\,0.5)$,\n$4.$ $(1.0\\times 10^{7},\\,0.5)$,\n$5.$ $(2.0\\times 10^{7},\\,0.5)$,\n$6.$ $(5.5\\times 10^{6},\\,0.2)$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the same order as the test suite, for example in the form $[T_{1},T_{2},T_{3},T_{4},T_{5},T_{6}]$, where each $T_{k}$ is a floating-point number in Kelvin rounded to one decimal place.",
            "solution": "The problem is valid as it is scientifically grounded in thermodynamics and fluid mechanics, well-posed, objective, and provides a complete set of definitions, models, and data for a formal solution. The task is to compute the temperature $T$ as a function of mixture fraction $Z$ and pressure $p$ for a non-reacting, single-component transcritical jet. This relationship, $T(Z,p)$, is known as a thermochemical state relation.\n\nThe solution is constructed by following the steps outlined in the problem statement, which involves modeling the fluid's thermophysical properties and then using conservation principles to determine the mixture state.\n\nFirst, we define the component's specific heat capacity at constant pressure, $c_p(T,p)$, using the provided analytical model:\n$$\nc_{p}(T,p) = c_{p,0} + A(p)\\,\\exp\\!\\left(-\\dfrac{\\left(T-T_{\\mathrm{w}}(p)\\right)^{2}}{2\\,\\sigma^{2}}\\right)\n$$\nThis model consists of a constant baseline specific heat capacity, $c_{p,0}$, and a Gaussian function to represent the sharp increase in heat capacity near the Widom line, a phenomenon characteristic of pseudo-boiling in supercritical fluids. The pressure-dependent peak amplitude $A(p)$ and peak temperature $T_{\\mathrm{w}}(p)$ are given by:\n$$\nA(p) = A_{0}\\,\\exp\\!\\left(-\\left(\\dfrac{\\ln\\!\\left(p/p_{\\mathrm{c}}\\right)}{b}\\right)^{2}\\right)\n$$\n$$\nT_{\\mathrm{w}}(p) = T_{\\mathrm{c}} + a\\,\\ln\\!\\left(\\dfrac{p}{p_{\\mathrm{c}}}\\right)\n$$\nAll constants ($T_{\\mathrm{c}}$, $p_{\\mathrm{c}}$, $c_{p,0}$, $A_{0}$, $\\sigma$, $a$, $b$) are provided.\n\nSecond, we determine the specific enthalpy $h(T,p)$ from the specific heat capacity. For a constant pressure process, the change in specific enthalpy is the integral of the specific heat capacity:\n$$\nh(T,p) = h(T_{\\mathrm{ref}},p) + \\int_{T_{\\mathrm{ref}}}^{T} c_{p}(T',p)\\,dT'\n$$\nThe problem specifies the reference state as $h(T_{\\min},p)=0$, where $T_{\\min}=80\\,\\mathrm{K}$. Thus, we have $T_{\\mathrm{ref}}=T_{\\min}$ and:\n$$\nh(T,p) = \\int_{T_{\\min}}^{T} c_{p}(T',p)\\,dT'\n$$\nThis integral is computed numerically. We establish a fine, uniform temperature grid on the interval $[T_{\\min}, T_{\\max}] = [80\\,\\mathrm{K}, 400\\,\\mathrm{K}]$. The function $c_p(T,p)$ is evaluated at each point on this grid for a given pressure $p$. The enthalpy $h(T,p)$ is then calculated at each grid point using a numerical quadrature method, specifically the trapezoidal rule implemented cumulatively. This creates a discrete table of $h$ as a function of $T$ at constant $p$. For this implementation, the `scipy.integrate.cumulative_trapezoid` function is highly suitable.\n\nThird, we use the definition of the mixture fraction, $Z$. The problem states that $Z$ is a conserved scalar, and for two-stream mixing under the given assumptions, specific enthalpy is also a conserved scalar. Therefore, the specific enthalpy of the mixture, $h_{\\mathrm{mix}}$, is a linear interpolation of the enthalpies of the two streams (jet and environment):\n$$\nh_{\\mathrm{mix}}(Z,p) = Z\\,h_{\\mathrm{jet}} + \\left(1-Z\\right)\\,h_{\\mathrm{env}}\n$$\nwhere $h_{\\mathrm{jet}} = h(T_{\\mathrm{jet}}, p)$ and $h_{\\mathrm{env}} = h(T_{\\mathrm{env}}, p)$, with $T_{\\mathrm{jet}}=120\\,\\mathrm{K}$ and $T_{\\mathrm{env}}=300\\,\\mathrm{K}$. The values of $h_{\\mathrm{jet}}$ and $h_{\\mathrm{env}}$ are found by interpolating the pre-computed enthalpy table at their respective temperatures.\n\nFinally, the state relation $T(Z,p)$ is found by inverting the function $h(T,p)$. We seek the temperature $T$ that satisfies the equation:\n$$\nh(T, p) = h_{\\mathrm{mix}}(Z,p)\n$$\nSince the specific heat capacity $c_p(T,p)$ is strictly positive for all $T$ and $p$, the specific enthalpy $h(T,p)$ is a strictly monotonically increasing function of $T$. This guarantees that a unique inverse $T(h,p)$ exists. Computationally, this inversion is performed as a reverse table lookup. We use linear interpolation on the generated tables, but with enthalpy as the independent variable and temperature as the dependent variable, to find the temperature corresponding to the calculated $h_{\\mathrm{mix}}(Z,p)$.\n\nThe overall algorithm for each test case $(p, Z)$ is as follows:\n1.  For the given pressure $p$, generate a table of $c_{p}(T_i, p)$ over a fine temperature grid $T_i \\in [80\\,\\mathrm{K}, 400\\,\\mathrm{K}]$.\n2.  Numerically integrate the $c_p$ table to produce a corresponding enthalpy table $h(T_i, p)$.\n3.  Use linear interpolation on the $h(T_i, p)$ table to find the specific enthalpies $h(T_{\\mathrm{jet}}, p)$ and $h(T_{\\mathrm{env}}, p)$.\n4.  Calculate the mixture enthalpy $h_{\\mathrm{mix}}(Z, p)$ using the mixture fraction rule.\n5.  Invert the function $h(T,p)$ by using linear interpolation on the tabulated data to find the temperature $T$ that corresponds to $h_{\\mathrm{mix}}(Z,p)$.\n6.  Round the resulting temperature to one decimal place as required.\n\nThis procedure is deterministic and directly implements the physics specified in the problem statement.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Computes the temperature T(Z, p) for a transcritical jet\n    based on a thermochemical state relation.\n    \"\"\"\n    \n    # Define physical and model constants\n    T_c = 154.6  # K\n    p_c = 5.043e6  # Pa\n    c_p0 = 1200.0  # J/kg/K\n    A0 = 20000.0  # J/kg/K\n    sigma = 6.0  # K\n    a = 35.0  # K\n    b = 1.0\n\n    # Define problem conditions\n    T_min = 80.0  # K\n    T_max = 400.0  # K\n    T_jet = 120.0  # K\n    T_env = 300.0  # K\n    N_points = 10001 # Number of points for numerical tables\n\n    # Define the temperature grid for tabulation\n    T_grid = np.linspace(T_min, T_max, N_points)\n\n    def get_T_from_Z_p(p, Z):\n        \"\"\"\n        Calculates T(Z,p) by building and inverting the state relation.\n        \n        Args:\n            p (float): Pressure in Pascal.\n            Z (float): Mixture fraction (dimensionless).\n        \n        Returns:\n            float: Temperature in Kelvin.\n        \"\"\"\n        # 1. Calculate pressure-dependent model parameters\n        log_pr = np.log(p / p_c)\n        T_w = T_c + a * log_pr\n        A = A0 * np.exp(-((log_pr / b)**2))\n\n        # 2. Build the specific heat capacity table c_p(T) at pressure p\n        cp_table = c_p0 + A * np.exp(-((T_grid - T_w)**2) / (2 * sigma**2))\n\n        # 3. Build the enthalpy table h(T) by numerical quadrature\n        # h(T) = integral from T_min to T of cp(T') dT'\n        # The reference enthalpy h(T_min, p) is 0.\n        h_integral = cumulative_trapezoid(cp_table, T_grid, initial=0.0)\n        h_table = h_integral\n\n        # 4. Calculate enthalpies of jet and environment streams\n        # Use linear interpolation on the generated tables\n        h_jet = np.interp(T_jet, T_grid, h_table)\n        h_env = np.interp(T_env, T_grid, h_table)\n\n        # 5. Calculate mixture enthalpy using the mixture fraction definition\n        h_mix = Z * h_jet + (1.0 - Z) * h_env\n\n        # 6. Invert the h(T) relation to find T(h_mix)\n        # Use linear interpolation with h as x-axis and T as y-axis\n        T_result = np.interp(h_mix, h_table, T_grid)\n        \n        return T_result\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (5.5e6, 0.0),\n        (5.5e6, 1.0),\n        (5.5e6, 0.5),\n        (1.0e7, 0.5),\n        (2.0e7, 0.5),\n        (5.5e6, 0.2),\n    ]\n\n    results = []\n    for p_case, Z_case in test_cases:\n        temp_result = get_T_from_Z_p(p_case, Z_case)\n        # Format to one decimal place\n        results.append(f\"{temp_result:.1f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While surrogate models are useful for illustration, quantitative predictions require a more rigorous foundation, typically a real-fluid equation of state (EoS). This practice challenges you to implement the Peng-Robinson EoS to model methane properties, identify the pseudo-boiling temperature based on the density gradient, and ultimately predict its physical location within a simplified one-dimensional mixing layer . Completing this exercise provides direct experience in linking fundamental thermodynamic theory to a concrete transport problem, a core competency in high-pressure flow simulation.",
            "id": "4055399",
            "problem": "Consider a single-component, steady, one-dimensional planar shear layer between two parallel streams at a uniform, supercritical pressure. A cold, dense jet composed of methane mixes with a hotter, lighter coflow, both being methane, at the same pressure. Let the coordinate $y \\in [0,L]$ denote the cross-stream direction, with $y=0$ at the jet side and $y=L$ at the ambient side. The goal is to predict the position $y_{pb}$ where the local temperature equals the pseudo-boiling temperature $T_{pb}$ within the shear layer, using conservation principles and a real-fluid Equation of State (EoS).\n\nAssumptions and fundamental bases:\n- The flow is steady, one-dimensional, and the pressure $P$ is uniform and constant across $y$.\n- There is no chemical reaction and no volumetric heat source. The flow is single-component methane, and all transport is purely diffusive in the $y$ direction.\n- The species mass fraction is unity everywhere because the fluid is a single component, but temperature and enthalpy vary due to thermal diffusion and mixing.\n- The mixture fraction $\\,\\xi(y)\\,$ is a conserved scalar satisfying the steady diffusion equation with constant diffusivity: $\\dfrac{d}{dy}\\left( \\Gamma \\dfrac{d\\xi}{dy} \\right) = 0$ with boundary conditions $\\xi(0)=1$ and $\\xi(L)=0$, implying a linear profile $\\xi(y) = 1 - y/L$.\n- Under unity Lewis number and equal diffusivities of sensible enthalpy and mixture fraction, the specific enthalpy (on a molar basis) is a linear function of the mixture fraction: $h(y) = \\xi(y)\\, h_j + [1 - \\xi(y)]\\, h_a$, where $h_j = h(T_j,P)$ is the jet-side molar enthalpy and $h_a = h(T_a,P)$ is the ambient-side molar enthalpy.\n- The molar enthalpy is modeled as $h(T,P) = h^{\\mathrm{ideal}}(T) + h^{\\mathrm{res}}(T,P)$, where $h^{\\mathrm{ideal}}(T)$ is the ideal-gas enthalpy and $h^{\\mathrm{res}}(T,P)$ is the residual enthalpy due to non-ideal effects from a cubic real-fluid EoS.\n- The ideal-gas enthalpy is modeled as $h^{\\mathrm{ideal}}(T) = c_{p,\\mathrm{ideal}}\\, T$ with a constant molar heat capacity $c_{p,\\mathrm{ideal}}$, and zero reference at $T=0\\,\\mathrm{K}$. This choice preserves enthalpy differences consistently under the linear mixing assumption.\n- The real-fluid EoS is the Peng–Robinson Equation of State (PR EoS). For a pure fluid, the PR EoS parameters are\n  $$ a = 0.45724 \\dfrac{R^2 T_c^2}{P_c} \\,\\alpha(T), \\quad b = 0.07780 \\dfrac{R T_c}{P_c}, $$\n  $$ \\alpha(T) = \\left[1 + \\kappa \\left(1 - \\sqrt{\\dfrac{T}{T_c}}\\right)\\right]^2, \\quad \\kappa = 0.37464 + 1.54226\\,\\omega - 0.26992\\,\\omega^2, $$\n  where $R$ is the universal gas constant, $T_c$ is the critical temperature, $P_c$ is the critical pressure, and $\\omega$ is the acentric factor. Defining\n  $$ A = \\dfrac{a P}{R^2 T^2}, \\quad B = \\dfrac{b P}{R T}, $$\n  the compressibility factor $Z$ is the real root of\n  $$ Z^3 - (1 - B) Z^2 + (A - 3 B^2 - 2 B) Z - (A B - B^2 - B^3) = 0. $$\n  For supercritical single-phase conditions, select the largest real root to represent the gas-like phase. The molar density is related by\n  $$ \\rho_{\\mathrm{mol}}(T,P) = \\dfrac{P}{Z R T}, \\quad \\rho_{\\mathrm{mass}}(T,P) = \\dfrac{M P}{Z R T}, $$\n  where $M$ is the molar mass.\n- The residual enthalpy for Peng–Robinson is\n  $$ h^{\\mathrm{res}}(T,P) = R T (Z - 1) + \\dfrac{T \\dfrac{da}{dT} - a}{2 \\sqrt{2}\\, b} \\,\\ln\\!\\left( \\dfrac{Z + (1 + \\sqrt{2}) B}{Z + (1 - \\sqrt{2}) B} \\right), $$\n  with\n  $$ \\dfrac{da}{dT} = 0.45724 \\dfrac{R^2 T_c^2}{P_c}\\, \\dfrac{d\\alpha}{dT}, \\quad \\dfrac{d\\alpha}{dT} = - \\dfrac{\\kappa}{T_c} \\left[1 + \\kappa \\left(1 - \\sqrt{\\dfrac{T}{T_c}}\\right)\\right] \\dfrac{1}{\\sqrt{\\dfrac{T}{T_c}}}. $$\n- The pseudo-boiling temperature $T_{pb}$ along an isobar is defined here as the temperature at which the magnitude of the isobaric temperature derivative of the mass density is maximal:\n  $$ T_{pb}(P) = \\underset{T}{\\mathrm{argmax}}\\;\\left| \\left(\\dfrac{\\partial \\rho_{\\mathrm{mass}}}{\\partial T}\\right)_{P} \\right|. $$\n  This definition is consistent with the concept of the Widom line as the locus of maxima of response functions in supercritical fluids.\n\nComputational task:\n- For methane, use the following constants: $T_c = 190.564\\,\\mathrm{K}$, $P_c = 4.5992\\times 10^{6}\\,\\mathrm{Pa}$, $\\omega = 0.01142$, $M = 0.016043\\,\\mathrm{kg/mol}$, $R = 8.314462618\\,\\mathrm{J/(mol\\cdot K)}$, and $c_{p,\\mathrm{ideal}} = 35.0\\,\\mathrm{J/(mol\\cdot K)}$.\n- For each test case below, compute $T_{pb}(P)$ by scanning temperature $T$ in the interval $[0.7 T_c, 3.0 T_c]$ and locating the maximum of $\\left|\\partial \\rho_{\\mathrm{mass}}/\\partial T\\right|_{P}$ using a central finite-difference approximation on a uniform grid. Use a temperature step of $1\\,\\mathrm{K}$.\n- Compute $h_j = h(T_j,P)$, $h_a = h(T_a,P)$, and $h_{pb} = h(T_{pb},P)$. Under the linear enthalpy mixing model, the mixture fraction at which $T=T_{pb}$ is\n  $$ \\xi_{pb} = \\dfrac{h_{pb} - h_a}{h_j - h_a}, $$\n  and the position is\n  $$ y_{pb} = L\\,(1 - \\xi_{pb}). $$\n- If $T_{pb}$ is not within the temperature interval $[\\min(T_j,T_a),\\, \\max(T_j,T_a)]$, then output $y_{pb} = -1.0$ since the pseudo-boiling state is not achieved within the shear layer.\n- If $h_j \\approx h_a$ (within a small numerical tolerance, indicating no enthalpy gradient), then output $y_{pb} = -1.0$.\n\nAnswer units and output format:\n- Express $y_{pb}$ in meters, as a float rounded to six decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\").\n\nTest suite:\n- Case 1 (typical transcritical mixing with a wide temperature span): $P = 8.0\\times 10^{6}\\,\\mathrm{Pa}$, $T_j = 140\\,\\mathrm{K}$, $T_a = 340\\,\\mathrm{K}$, $L = 3.0\\times 10^{-3}\\,\\mathrm{m}$.\n- Case 2 (narrow warm mixing range, likely above pseudo-boiling): $P = 8.0\\times 10^{6}\\,\\mathrm{Pa}$, $T_j = 240\\,\\mathrm{K}$, $T_a = 260\\,\\mathrm{K}$, $L = 2.0\\times 10^{-3}\\,\\mathrm{m}$.\n- Case 3 (near-critical pressure band with moderate temperature span): $P = 4.6\\times 10^{6}\\,\\mathrm{Pa}$, $T_j = 150\\,\\mathrm{K}$, $T_a = 220\\,\\mathrm{K}$, $L = 4.0\\times 10^{-3}\\,\\mathrm{m}$.\n- Case 4 (cold mixing range, likely below pseudo-boiling): $P = 1.2\\times 10^{7}\\,\\mathrm{Pa}$, $T_j = 130\\,\\mathrm{K}$, $T_a = 160\\,\\mathrm{K}$, $L = 1.5\\times 10^{-3}\\,\\mathrm{m}$.",
            "solution": "The problem statement has been validated and is deemed sound. It is scientifically grounded, well-posed, and objective. The provided physical model, based on the Peng-Robinson Equation of State (PR EoS) and standard transport phenomena assumptions, is consistent and complete. The computational task is clearly defined with all necessary constants, equations, and boundary conditions, allowing for a unique and verifiable solution.\n\nThe solution proceeds by first implementing the thermodynamic property calculations based on the PR EoS for methane. Subsequently, a numerical search is performed to identify the pseudo-boiling temperature. Finally, using a linear enthalpy mixing rule, the spatial position corresponding to this temperature within the shear layer is determined for each test case.\n\nThe overall algorithm is structured as follows:\n\n1.  **Peng-Robinson EoS and Thermodynamic Properties:** A set of functions is developed to compute thermodynamic properties as a function of temperature $T$ and pressure $P$.\n    - The parameters $\\kappa$, $b$, and the temperature-dependent term $\\alpha(T)$ are computed from the given fluid properties: critical temperature $T_c$, critical pressure $P_c$, and acentric factor $\\omega$.\n    $$ \\kappa = 0.37464 + 1.54226\\,\\omega - 0.26992\\,\\omega^2 $$\n    $$ b = 0.07780 \\dfrac{R T_c}{P_c} $$\n    $$ \\alpha(T) = \\left[1 + \\kappa \\left(1 - \\sqrt{\\dfrac{T}{T_c}}\\right)\\right]^2 $$\n    - The parameter $a(T)$ is then calculated:\n    $$ a(T) = 0.45724 \\dfrac{R^2 T_c^2}{P_c} \\,\\alpha(T) $$\n    - With $a(T)$ and $b$, the dimensionless parameters $A$ and $B$ are determined:\n    $$ A = \\dfrac{a(T) P}{R^2 T^2}, \\quad B = \\dfrac{b P}{R T} $$\n    - The compressibility factor $Z$ is found by solving the cubic PR EoS. The equation is rearranged into a standard polynomial form, $Z^3 + c_2 Z^2 + c_1 Z + c_0 = 0$, where:\n    $$ c_2 = -(1 - B) $$\n    $$ c_1 = A - 3 B^2 - 2 B $$\n    $$ c_0 = -(A B - B^2 - B^3) $$\n    This polynomial is solved for its roots. As specified for supercritical single-phase conditions, the largest real root is selected as the valid compressibility factor $Z$.\n    - The mass density $\\rho_{\\mathrm{mass}}(T,P)$ is calculated using the determined value of $Z$:\n    $$ \\rho_{\\mathrm{mass}}(T,P) = \\dfrac{M P}{Z R T} $$\n    - The molar enthalpy $h(T,P)$ is computed as the sum of an ideal-gas part, $h^{\\mathrm{ideal}}(T)$, and a residual part, $h^{\\mathrm{res}}(T,P)$.\n    $$ h^{\\mathrm{ideal}}(T) = c_{p,\\mathrm{ideal}}\\, T $$\n    The residual enthalpy is given by the PR EoS formula:\n    $$ h^{\\mathrm{res}}(T,P) = R T (Z - 1) + \\dfrac{T \\dfrac{da}{dT} - a}{2 \\sqrt{2}\\, b} \\,\\ln\\!\\left( \\dfrac{Z + (1 + \\sqrt{2}) B}{Z + (1 - \\sqrt{2}) B} \\right) $$\n    The derivative $\\dfrac{da}{dT}$ is calculated analytically:\n    $$ \\dfrac{d\\alpha}{dT} = - \\dfrac{\\kappa}{T_c} \\left[1 + \\kappa \\left(1 - \\sqrt{\\dfrac{T}{T_c}}\\right)\\right] \\dfrac{1}{\\sqrt{\\dfrac{T}{T_c}}} $$\n    $$ \\dfrac{da}{dT} = 0.45724 \\dfrac{R^2 T_c^2}{P_c}\\, \\dfrac{d\\alpha}{dT} $$\n\n2.  **Pseudo-Boiling Temperature $T_{pb}$ Calculation:** For a given pressure $P$, the pseudo-boiling temperature $T_{pb}$ is found by locating the temperature at which the magnitude of the isobaric temperature derivative of mass density is maximal.\n    - A discrete temperature grid is created over the interval $[0.7 T_c, 3.0 T_c]$ with a step size of $\\Delta T = 1\\,\\mathrm{K}$.\n    - The mass density $\\rho_{\\mathrm{mass}}(T,P)$ is calculated for each temperature on this grid.\n    - The derivative $(\\partial \\rho_{\\mathrm{mass}} / \\partial T)_P$ is approximated at each grid point $T_i$ (excluding the boundaries) using a second-order central finite-difference scheme:\n    $$ \\left(\\dfrac{\\partial \\rho_{\\mathrm{mass}}}{\\partial T}\\right)_{P, T=T_i} \\approx \\dfrac{\\rho_{\\mathrm{mass}}(T_{i+1}, P) - \\rho_{\\mathrm{mass}}(T_{i-1}, P)}{2 \\Delta T} $$\n    - The temperature corresponding to the maximum value of $|\\partial \\rho_{\\mathrm{mass}} / \\partial T|_P$ is identified as $T_{pb}$.\n\n3.  **Shear Layer Position $y_{pb}$ Calculation:** For each test case, the position $y_{pb}$ is computed.\n    - The pseudo-boiling temperature $T_{pb}$ is first determined for the given system pressure $P$.\n    - A check is performed to determine if $T_{pb}$ falls within the temperature range of the shear layer, $[\\min(T_j,T_a), \\max(T_j,T_a)]$. If it does not, the pseudo-boiling state is not physically realized within the mixing layer, and the position is set to $y_{pb} = -1.0$.\n    - If $T_{pb}$ is within the valid range, the molar enthalpies at the jet boundary $h_j = h(T_j, P)$, the ambient boundary $h_a = h(T_a, P)$, and at the pseudo-boiling temperature $h_{pb} = h(T_{pb}, P)$ are calculated using the thermodynamic functions from Step 1.\n    - The enthalpy gradient is checked. If $h_j$ and $h_a$ are nearly equal (i.e., $|h_j - h_a| < 10^{-9}$), the denominator in the mixture fraction calculation becomes ill-defined, and we set $y_{pb} = -1.0$.\n    - The mixture fraction $\\xi_{pb}$ where the temperature is $T_{pb}$ is found using the linear enthalpy mixing rule:\n    $$ \\xi_{pb} = \\dfrac{h_{pb} - h_a}{h_j - h_a} $$\n    - Finally, the spatial position $y_{pb}$ is calculated from the linear mixture fraction profile $\\xi(y) = 1 - y/L$:\n    $$ y_{pb} = L\\,(1 - \\xi_{pb}) $$\n    The result is rounded to six decimal places as required. The entire procedure is encapsulated into a program that processes the given test suite.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the pseudo-boiling position in a transcritical shear layer.\n    \"\"\"\n    \n    # Constants for Methane\n    METHANE_CONSTANTS = {\n        'Tc': 190.564,          # K\n        'Pc': 4.5992e6,         # Pa\n        'omega': 0.01142,       # acentric factor\n        'M': 0.016043,          # kg/mol\n        'R': 8.314462618,       # J/(mol.K)\n        'cp_ideal': 35.0,       # J/(mol.K)\n    }\n\n    class ThermodynamicCalculator:\n        \"\"\"\n        A class to calculate thermodynamic properties based on the Peng-Robinson EoS.\n        \"\"\"\n        def __init__(self, constants):\n            self.const = constants\n            # Pre-calculate constant parts of PR EoS parameters\n            self.kappa = (0.37464 + 1.54226 * self.const['omega'] \n                          - 0.26992 * self.const['omega']**2)\n            self.b = 0.07780 * self.const['R'] * self.const['Tc'] / self.const['Pc']\n            self.ac_factor = 0.45724 * self.const['R']**2 * self.const['Tc']**2 / self.const['Pc']\n            self.sqrt2 = np.sqrt(2)\n\n        def get_properties_at_T_P(self, T, P):\n            \"\"\"\n            Computes a full set of thermodynamic properties at a given T and P.\n            \"\"\"\n            # Calculate alpha(T) and its derivative\n            Tr = T / self.const['Tc']\n            sqrt_Tr = np.sqrt(Tr)\n            alpha_term = 1 + self.kappa * (1 - sqrt_Tr)\n            alpha = alpha_term**2\n            \n            dalpha_dT_term = 1 + self.kappa * (1 - sqrt_Tr)\n            dalpha_dT = - (self.kappa / (self.const['Tc'] * sqrt_Tr)) * dalpha_dT_term\n\n            # Calculate a(T) and its derivative\n            a = self.ac_factor * alpha\n            da_dT = self.ac_factor * dalpha_dT\n\n            # Calculate dimensionless groups A and B\n            A = a * P / (self.const['R']**2 * T**2)\n            B = self.b * P / (self.const['R'] * T)\n\n            # Solve cubic equation for Z\n            coeffs = [\n                1,\n                -(1 - B),\n                A - 3 * B**2 - 2 * B,\n                -(A * B - B**2 - B**3)\n            ]\n            roots = np.roots(coeffs)\n            real_roots = roots[np.isreal(roots)].real\n            if not real_roots.any():\n                # Should not happen in supercritical state, but as a fallback\n                raise ValueError(f\"No real roots for Z at T={T} K, P={P} Pa\")\n            Z = np.max(real_roots)\n            \n            return Z, a, A, B, da_dT\n\n        def get_rho_mass(self, T, P):\n            \"\"\"Calculates mass density.\"\"\"\n            Z, _, _, _, _ = self.get_properties_at_T_P(T, P)\n            rho_mass = self.const['M'] * P / (Z * self.const['R'] * T)\n            return rho_mass\n\n        def get_h(self, T, P):\n            \"\"\"Calculates molar enthalpy.\"\"\"\n            Z, a, _, B, da_dT = self.get_properties_at_T_P(T, P)\n            \n            # Ideal gas enthalpy\n            h_ideal = self.const['cp_ideal'] * T\n            \n            # Residual enthalpy\n            ln_term_num = Z + (1 + self.sqrt2) * B\n            ln_term_den = Z + (1 - self.sqrt2) * B\n            \n            if ln_term_num <= 0 or ln_term_den <= 0:\n                # Fallback if log argument becomes non-positive\n                h_res = self.const['R'] * T * (Z - 1)\n            else:\n                log_term = np.log(ln_term_num / ln_term_den)\n                h_res = (self.const['R'] * T * (Z - 1) + \n                         (T * da_dT - a) / (2 * self.sqrt2 * self.b) * log_term)\n            \n            return h_ideal + h_res\n\n    def find_Tpb(P, calculator):\n        \"\"\"\n        Finds the pseudo-boiling temperature by finding the max of |d(rho)/dT|_P.\n        \"\"\"\n        Tc = calculator.const['Tc']\n        T_min_scan, T_max_scan = 0.7 * Tc, 3.0 * Tc\n        T_step = 1.0\n        \n        T_range = np.arange(T_min_scan, T_max_scan + T_step, T_step)\n        \n        try:\n            rho_values = np.array([calculator.get_rho_mass(T, P) for T in T_range])\n        except ValueError:\n            return -1 # Indicate failure if Z calculation fails in the range\n\n        # Central difference for derivative\n        d_rho_dT = (rho_values[2:] - rho_values[:-2]) / (2 * T_step)\n        \n        if len(d_rho_dT) == 0:\n            return -1 # Not enough points\n            \n        # Find T corresponding to max |d(rho)/dT|\n        max_idx = np.argmax(np.abs(d_rho_dT))\n        Tpb = T_range[max_idx + 1] # +1 because derivative array is offset\n        \n        return Tpb\n\n    # Initialize calculator\n    calc = ThermodynamicCalculator(METHANE_CONSTANTS)\n\n    # Test suite from the problem statement\n    test_cases = [\n        # (P in Pa, Tj in K, Ta in K, L in m)\n        (8.0e6, 140.0, 340.0, 3.0e-3), # Case 1\n        (8.0e6, 240.0, 260.0, 2.0e-3), # Case 2\n        (4.6e6, 150.0, 220.0, 4.0e-3), # Case 3\n        (1.2e7, 130.0, 160.0, 1.5e-3), # Case 4\n    ]\n\n    results = []\n    TOLERANCE = 1e-9\n\n    for P, Tj, Ta, L in test_cases:\n        Tpb = find_Tpb(P, calc)\n        \n        T_mix_min = min(Tj, Ta)\n        T_mix_max = max(Tj, Ta)\n        \n        if Tpb < T_mix_min or Tpb > T_mix_max:\n            results.append(-1.0)\n            continue\n            \n        try:\n            hj = calc.get_h(Tj, P)\n            ha = calc.get_h(Ta, P)\n            hpb = calc.get_h(Tpb, P)\n        except ValueError:\n            results.append(-1.0) # Calculation failed\n            continue\n\n        if abs(hj - ha) < TOLERANCE:\n            results.append(-1.0)\n            continue\n            \n        xi_pb = (hpb - ha) / (hj - ha)\n        \n        # Check if xi_pb is physically meaningful (between 0 and 1)\n        if not (0.0 <= xi_pb <= 1.0):\n             # This can happen if T-h relation is non-monotonic\n            results.append(-1.0)\n            continue\n\n        y_pb = L * (1.0 - xi_pb)\n        \n        results.append(round(y_pb, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "After modeling pseudo-boiling, the next step for a computational scientist is to identify its signatures within the vast datasets produced by CFD simulations. This practice introduces a robust, data-driven approach to detect pseudo-boiling by analyzing the statistical distribution of thermodynamic states. You will implement an algorithm that classifies flow regimes by quantifying the concurrent appearance of a heat capacity peak and a steep density gradient, learning how to translate theoretical concepts into practical post-processing tools .",
            "id": "4055423",
            "problem": "You are given ensembles of thermodynamic samples representative of Computational Fluid Dynamics (CFD) cell fields for transcritical mixing at a single pressure level. Each ensemble consists of triplets $\\left(T_i,\\rho_i,c_{p,i}\\right)$ for $i=1,\\dots,N$, where $T$ is temperature in $K$, $\\rho$ is density in $\\mathrm{kg/m^3}$, and $c_p$ is isobaric heat capacity in $\\mathrm{J/(kg\\cdot K)}$. Your task is to develop and implement a principled detection method for pseudo-boiling using the joint probability density function (PDF) of $\\left(T,\\rho\\right)$ and a confirmation by the presence of a local maximum of $c_p$.\n\nBegin from the thermodynamic definition of isobaric heat capacity $c_p$ and the observation that pseudo-boiling at supercritical pressure is associated with a pronounced peak of $c_p$ along a narrow temperature band (pseudo-critical region) and a steep density variation with temperature. Using these foundations, derive a detection rule that classifies an ensemble as exhibiting pseudo-boiling if and only if all of the following conditions are met:\n\n- A clear peak in $c_p$ exists as a function of $T$, identified by the maximum of a bin-averaged $c_p(T)$.\n- The joint PDF of $\\left(T,\\rho\\right)$ concentrates a nontrivial probability mass within a narrow band around the candidate pseudo-boiling temperature.\n- The conditional change in $\\rho$ across the narrow temperature band is sufficiently sharp relative to the overall density range in the ensemble.\n\nYou must implement the following algorithmic steps for each ensemble:\n1. Estimate $T_{\\mathrm{pb}}$ (candidate pseudo-boiling temperature) as the center of the temperature bin at which the bin-averaged $c_p$ attains its maximum.\n2. Define a symmetric temperature band of width $2w_T$ around $T_{\\mathrm{pb}}$, where $w_T$ is in $K$.\n3. Compute the baseline $c_p$ outside the band as the median of $c_p$ for samples with $T$ not in $\\left[T_{\\mathrm{pb}}-w_T,\\,T_{\\mathrm{pb}}+w_T\\right]$. Compute the peak-to-baseline ratio $R_{cp}=\\dfrac{\\max_i c_{p,i}}{\\mathrm{median}\\left(c_{p,i}\\,|\\,T_i\\notin\\left[T_{\\mathrm{pb}}-w_T,\\,T_{\\mathrm{pb}}+w_T\\right]\\right)}$.\n4. Estimate the joint PDF $p(T,\\rho)$ by a normalized two-dimensional histogram (using equally spaced bins along $T$ and $\\rho$). Let $P_{\\mathrm{band}}$ be the probability mass contained in the temperature bins whose centers lie in $\\left[T_{\\mathrm{pb}}-w_T,\\,T_{\\mathrm{pb}}+w_T\\right]$.\n5. Compute a dimensionless sharpness metric $S$ as $S=\\dfrac{\\left|\\mu_{\\rho}^{+}-\\mu_{\\rho}^{-}\\right|}{\\rho_{\\max}-\\rho_{\\min}}$, where $\\mu_{\\rho}^{-}$ is the mean of $\\rho$ over samples with $T\\in\\left[T_{\\mathrm{pb}}-w_T,\\,T_{\\mathrm{pb}}\\right]$, $\\mu_{\\rho}^{+}$ is the mean of $\\rho$ over samples with $T\\in\\left[T_{\\mathrm{pb}},\\,T_{\\mathrm{pb}}+w_T\\right]$, and $\\rho_{\\max}$ and $\\rho_{\\min}$ are the maximum and minimum densities in the ensemble.\n\nClassify the ensemble as pseudo-boiling if and only if $R_{cp}\\ge R_{cp,0}$, $P_{\\mathrm{band}}\\ge P_0$, and $S\\ge S_0$, where the thresholds are $R_{cp,0}=2.0$, $P_0=0.2$, $S_0=0.5$, and the band half-width is $w_T=10.0\\,K$. These thresholds and units must be used exactly as specified.\n\nImplement the above method as a complete, runnable program. The input ensembles are embedded within the program as a test suite consisting of three synthetic cases designed to mimic CFD outputs:\n- Case A (clear pseudo-boiling): $N=5000$ samples with temperatures concentrated near $T\\approx 650\\,K$ and a strong $c_p$ peak, with densities exhibiting a steep logistic transition across $T\\approx 650\\,K$. Use $T$ formed by concatenating $3000$ samples linearly spaced in $\\left[642,658\\right]$ and $2000$ samples linearly spaced in $\\left[500,800\\right]$. Let $\\rho(T)=\\rho_{\\mathrm{low}}+\\dfrac{\\rho_{\\mathrm{high}}-\\rho_{\\mathrm{low}}}{1+\\exp\\left(\\dfrac{T-T_{\\mathrm{pb}}}{\\alpha}\\right)}$ with $\\rho_{\\mathrm{high}}=600\\,\\mathrm{kg/m^3}$, $\\rho_{\\mathrm{low}}=60\\,\\mathrm{kg/m^3}$, $T_{\\mathrm{pb}}=650\\,K$, and $\\alpha=4\\,K$. Let $c_p(T)=c_{p,0}+A\\exp\\left(-\\dfrac{\\left(T-T_{\\mathrm{pb}}\\right)^2}{2\\sigma^2}\\right)$ with $c_{p,0}=2000\\,\\mathrm{J/(kg\\cdot K)}$, $A=12000\\,\\mathrm{J/(kg\\cdot K)}$, and $\\sigma=6\\,K$.\n- Case B (boundary, near-threshold): $N=5000$ samples with a modest $c_p$ peak and moderate density change. Use $T$ formed by concatenating $1000$ samples linearly spaced in $\\left[646,654\\right]$ and $4000$ samples linearly spaced in $\\left[500,800\\right]$. Let $\\rho(T)$ be logistic with $\\rho_{\\mathrm{high}}=360\\,\\mathrm{kg/m^3}$, $\\rho_{\\mathrm{low}}=100\\,\\mathrm{kg/m^3}$, $T_{\\mathrm{pb}}=650\\,K$, and $\\alpha=25\\,K$. Let $c_p(T)=c_{p,0}+A\\exp\\left(-\\dfrac{\\left(T-T_{\\mathrm{pb}}\\right)^2}{2\\sigma^2}\\right)$ with $c_{p,0}=2200\\,\\mathrm{J/(kg\\cdot K)}$, $A=2420\\,\\mathrm{J/(kg\\cdot K)}$, and $\\sigma=8\\,K$.\n- Case C (no pseudo-boiling): $N=5000$ samples with temperatures uniformly spanning $\\left[500,800\\right]$, weak variation in $c_p$, and nearly linear density variation. Use $T$ as $5000$ samples linearly spaced in $\\left[500,800\\right]$. Let $\\rho(T)=\\rho_0-\\beta\\left(T-500\\right)$ with $\\rho_0=250\\,\\mathrm{kg/m^3}$ and $\\beta=0.1\\,\\mathrm{kg/(m^3\\cdot K)}$. Let $c_p(T)=c_{p,0}+A\\exp\\left(-\\dfrac{\\left(T-T_{\\mathrm{pb}}\\right)^2}{2\\sigma^2}\\right)$ with $c_{p,0}=2200\\,\\mathrm{J/(kg\\cdot K)}$, $A=200\\,\\mathrm{J/(kg\\cdot K)}$, $\\sigma=50\\,K$, and $T_{\\mathrm{pb}}=650\\,K$.\n\nYour program must implement the joint PDF using a normalized two-dimensional histogram with $n_T$ and $n_\\rho$ equally spaced bins along $T$ and $\\rho$ respectively; use $n_T=40$ and $n_\\rho=40$. For each case, apply the detection rule and produce a boolean classification.\n\nFinal output format requirement:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $\\left[\\mathrm{result1},\\mathrm{result2},\\mathrm{result3}\\right]$). Each $\\mathrm{result}$ must be a boolean ($\\mathrm{True}$ or $\\mathrm{False}$) indicating pseudo-boiling detection for the corresponding case. All temperatures must be in $K$, all densities in $\\mathrm{kg/m^3}$, and all heat capacities in $\\mathrm{J/(kg\\cdot K)}$. Angles are not used. Express any ratio or fraction as a decimal number within the algorithm. No external inputs are permitted; the program must be self-contained and runnable as is.",
            "solution": "The problem of detecting pseudo-boiling in transcritical fluid mixing is validated as scientifically grounded, well-posed, and objective. The provided methodology is based on established thermodynamic principles and common practices in the analysis of computational fluid dynamics (CFD) data. The problem is self-contained, with all necessary data, parameters, and algorithms explicitly defined. Therefore, a solution is warranted.\n\nThe fundamental principle behind the detection method is the thermodynamic behavior of fluids at supercritical pressures. Unlike subcritical boiling, which occurs at a single saturation temperature for a given pressure, transcritical \"pseudo-boiling\" manifests as a continuous but rapid transition from a liquid-like state to a gas-like state over a narrow temperature range, known as the pseudo-critical region. This transition is characterized by a pronounced peak in the isobaric heat capacity, $c_p \\equiv \\left(\\frac{\\partial h}{\\partial T}\\right)_P$, where $h$ is the specific enthalpy, $T$ is temperature, and $P$ is pressure. Concurrently, physical properties like density, $\\rho$, exhibit a steep gradient with respect to temperature in this same region. The proposed algorithm systematically quantifies these two key signatures.\n\nWe are given an ensemble of $N$ thermodynamic state samples, each represented by a triplet $(T_i, \\rho_i, c_{p,i})$ for $i=1, \\dots, N$. The task is to classify the ensemble as exhibiting pseudo-boiling based on a set of three quantitative criteria. The algorithm proceeds as follows:\n\n**1. Identification of Candidate Pseudo-Boiling Temperature ($T_{\\mathrm{pb}}$)**\nThe pseudo-boiling temperature, $T_{\\mathrm{pb}}$, is defined as the temperature at which $c_p$ reaches its maximum. To estimate this from discrete sample data, we first partition the temperature range $[\\min(T_i), \\max(T_i)]$ into $n_T = 40$ equally spaced bins. For each bin, we compute the average of the $c_{p,i}$ values for all samples whose $T_i$ falls within that bin. The candidate temperature $T_{\\mathrm{pb}}$ is then set to the center of the bin that yields the maximum average $c_p$.\n\n**2. Definition of the Pseudo-Critical Temperature Band**\nA symmetric temperature band of width $2w_T$ is defined around the candidate temperature $T_{\\mathrm{pb}}$. With the given half-width $w_T = 10.0\\,K$, this band is the interval $[T_{\\mathrm{pb}} - w_T, T_{\\mathrm{pb}} + w_T]$. This band represents the narrow region where pseudo-boiling phenomena are expected to be most prominent.\n\n**3. Peak-to-Baseline Ratio of Heat Capacity ($R_{cp}$)**\nThis metric quantifies the prominence of the $c_p$ peak. It is calculated as the ratio of the absolute maximum heat capacity observed in the entire ensemble to a baseline value representative of the non-pseudo-boiling regions.\n$$R_{cp} = \\frac{\\max_{i} c_{p,i}}{\\mathrm{median}\\{c_{p,i} \\mid T_i \\notin [T_{\\mathrm{pb}} - w_T, T_{\\mathrm{pb}} + w_T]\\}}$$\nThe baseline is calculated as the median of all $c_{p,i}$ values for samples lying outside the pseudo-critical temperature band. The median is used to provide a robust estimate, insensitive to outliers. The ensemble is considered to have a sufficiently strong peak if $R_{cp} \\ge R_{cp,0}$, where the threshold is $R_{cp,0} = 2.0$.\n\n**4. Probability Mass Concentration ($P_{\\mathrm{band}}$)**\nA key feature of pseudo-boiling in a mixing layer is the statistical prevalence of fluid parcels within the pseudo-critical temperature range. We quantify this by estimating the joint probability density function (PDF), $p(T, \\rho)$, using a two-dimensional histogram with $n_T = 40$ bins for temperature and $n_\\rho = 40$ bins for density. The histogram counts are normalized by the total number of samples, $N$, to approximate the PDF. $P_{\\mathrm{band}}$ is the total probability mass contained within the temperature bins whose centers fall inside the pseudo-critical band $[T_{\\mathrm{pb}} - w_T, T_{\\mathrm{pb}} + w_T]$. This is computed by summing the probabilities of all $(T, \\rho)$ cells corresponding to these temperature bins.\n$$P_{\\mathrm{band}} = \\sum_{j \\in J_{\\mathrm{band}}} \\sum_{k=1}^{n_\\rho} p(T_j^{\\mathrm{center}}, \\rho_k^{\\mathrm{center}})$$\nwhere $J_{\\mathrm{band}} = \\{j \\mid T_j^{\\mathrm{center}} \\in [T_{\\mathrm{pb}} - w_T, T_{\\mathrm{pb}} + w_T]\\}$. A significant concentration of samples is required, specifically $P_{\\mathrm{band}} \\ge P_0$, with the threshold $P_0 = 0.2$.\n\n**5. Density Gradient Sharpness ($S$)**\nThis metric assesses the steepness of the density change across the pseudo-critical region. It is a dimensionless quantity defined as the normalized difference between the mean densities on either side of $T_{\\mathrm{pb}}$ within the band.\n$$S = \\frac{|\\mu_{\\rho}^{+} - \\mu_{\\rho}^{-}|}{\\rho_{\\max} - \\rho_{\\min}}$$\nHere, $\\mu_{\\rho}^{-}$ is the mean density of samples with temperatures in the lower half of the band, $T_i \\in [T_{\\mathrm{pb}} - w_T, T_{\\mathrm{pb}}]$, and $\\mu_{\\rho}^{+}$ is the mean density of samples with temperatures in the upper half, $T_i \\in [T_{\\mathrm{pb}}, T_{\\mathrm{pb}} + w_T]$. Note that samples with $T_i = T_{\\mathrm{pb}}$ are included in both averages as per the problem specification. The density difference is normalized by the total density range in the ensemble, $\\rho_{\\max} - \\rho_{\\min}$. A sharp transition is indicated by a large value of $S$. The condition for a sufficiently sharp transition is $S \\ge S_0$, with the threshold $S_0 = 0.5$.\n\n**Final Classification**\nAn ensemble is classified as exhibiting pseudo-boiling if and only if all three conditions are met simultaneously:\n$$\n(R_{cp} \\ge R_{cp,0}) \\land (P_{\\mathrm{band}} \\ge P_0) \\land (S \\ge S_0)\n$$\nwhere $R_{cp,0} = 2.0$, $P_0 = 0.2$, and $S_0 = 0.5$. This multi-criteria approach ensures that the detection is robust, requiring confirmation from the perspectives of thermodynamic property peaks ($c_p$), statistical distribution ($p(T, \\rho)$), and transport property gradients (approximated by $\\rho(T)$). The following program implements this complete logic for the specified test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import binned_statistic\n\ndef generate_case_data(case_type):\n    \"\"\"\n    Generates synthetic ensemble data for a given case type.\n    \"\"\"\n    N = 5000\n    if case_type == 'A':\n        # Case A: Clear pseudo-boiling\n        T1 = np.linspace(642, 658, 3000)\n        T2 = np.linspace(500, 800, 2000)\n        T = np.concatenate((T1, T2))\n        \n        rho_high, rho_low, T_pb_model, alpha = 600.0, 60.0, 650.0, 4.0\n        rho = rho_low + (rho_high - rho_low) / (1 + np.exp((T - T_pb_model) / alpha))\n        \n        c_p0, A, sigma = 2000.0, 12000.0, 6.0\n        c_p = c_p0 + A * np.exp(-((T - T_pb_model)**2) / (2 * sigma**2))\n\n    elif case_type == 'B':\n        # Case B: Boundary, near-threshold\n        T1 = np.linspace(646, 654, 1000)\n        T2 = np.linspace(500, 800, 4000)\n        T = np.concatenate((T1, T2))\n        \n        rho_high, rho_low, T_pb_model, alpha = 360.0, 100.0, 650.0, 25.0\n        rho = rho_low + (rho_high - rho_low) / (1 + np.exp((T - T_pb_model) / alpha))\n        \n        c_p0, A, sigma = 2200.0, 2420.0, 8.0\n        c_p = c_p0 + A * np.exp(-((T - T_pb_model)**2) / (2 * sigma**2))\n\n    elif case_type == 'C':\n        # Case C: No pseudo-boiling\n        T = np.linspace(500, 800, N)\n        \n        rho_0, beta = 250.0, 0.1\n        rho = rho_0 - beta * (T - 500.0)\n        \n        c_p0, A, T_pb_model, sigma = 2200.0, 200.0, 650.0, 50.0\n        c_p = c_p0 + A * np.exp(-((T - T_pb_model)**2) / (2 * sigma**2))\n    \n    else:\n        raise ValueError(\"Unknown case type\")\n\n    # Add small random noise to avoid singularities in binning/statistics\n    rng = np.random.default_rng(seed=42)\n    T += rng.normal(0, 1e-6, T.shape)\n    rho += rng.normal(0, 1e-6, rho.shape)\n    c_p += rng.normal(0, 1e-6, c_p.shape)\n    \n    return T, rho, c_p\n\ndef detect_pseudo_boiling(ensemble):\n    \"\"\"\n    Applies the detection rule to a given ensemble (T, rho, c_p).\n    \"\"\"\n    T, rho, c_p = ensemble\n    N = len(T)\n\n    # --- Parameters and Thresholds ---\n    w_T = 10.0\n    R_cp0 = 2.0\n    P0 = 0.2\n    S0 = 0.5\n    n_T = 40\n    n_rho = 40\n\n    # --- Step 1: Estimate T_pb ---\n    # Bin c_p by T and find the bin with the maximum average c_p\n    # Binned_statistic handles empty bins by returning NaN.\n    mean_cp_binned, bin_edges, _ = binned_statistic(T, c_p, statistic='mean', bins=n_T)\n    # Find the index of the bin with the maximum mean c_p, ignoring NaNs\n    try:\n        max_bin_idx = np.nanargmax(mean_cp_binned)\n        # Calculate T_pb as the center of that bin\n        T_pb = (bin_edges[max_bin_idx] + bin_edges[max_bin_idx + 1]) / 2.0\n    except ValueError: # All bins were empty or contained NaNs\n        return False\n\n    # --- Step 2: Define Temperature Band ---\n    T_band_lower, T_band_upper = T_pb - w_T, T_pb + w_T\n\n    # --- Step 3: Calculate R_cp ---\n    c_p_peak = np.max(c_p)\n    mask_outside_band = (T < T_band_lower) | (T > T_band_upper)\n    \n    if not np.any(mask_outside_band):\n        # All points are inside the band, baseline is undefined.\n        # This case does not represent a localized peak, so R_cp fails.\n        R_cp = 0.0\n    else:\n        c_p_baseline = np.median(c_p[mask_outside_band])\n        if c_p_baseline > 1e-9: # Avoid division by zero\n            R_cp = c_p_peak / c_p_baseline\n        else:\n            R_cp = np.inf\n\n    # --- Step 4: Calculate P_band ---\n    # Create a 2D histogram\n    hist_range = [[np.min(T), np.max(T)], [np.min(rho), np.max(rho)]]\n    hist, T_edges, rho_edges = np.histogram2d(T, rho, bins=[n_T, n_rho], range=hist_range)\n\n    # Normalize to get the joint PDF\n    pdf = hist / N\n    \n    # Identify temperature bins whose centers are in the band\n    T_bin_centers = (T_edges[:-1] + T_edges[1:]) / 2.0\n    band_bin_mask = (T_bin_centers >= T_band_lower) & (T_bin_centers <= T_band_upper)\n    \n    # Sum probabilities in these bins\n    P_band = np.sum(pdf[band_bin_mask, :])\n\n    # --- Step 5: Calculate S ---\n    rho_min, rho_max = np.min(rho), np.max(rho)\n    rho_range = rho_max - rho_min\n\n    mask_lower_half = (T >= T_band_lower) & (T <= T_pb)\n    mask_upper_half = (T >= T_pb) & (T <= T_band_upper)\n    \n    # Calculate means, handling empty slices\n    mu_rho_minus = np.mean(rho[mask_lower_half]) if np.any(mask_lower_half) else 0.0\n    mu_rho_plus = np.mean(rho[mask_upper_half]) if np.any(mask_upper_half) else 0.0\n\n    if rho_range > 1e-9:\n        S = np.abs(mu_rho_plus - mu_rho_minus) / rho_range\n    else:\n        S = 0.0\n\n    # --- Classification ---\n    is_pb = (R_cp >= R_cp0) and (P_band >= P0) and (S >= S0)\n    \n    return is_pb\n\ndef solve():\n    \"\"\"\n    Main solver function to process test cases and print results.\n    \"\"\"\n    test_cases_defs = ['A', 'B', 'C']\n    ensembles = [generate_case_data(case) for case in test_cases_defs]\n\n    results = []\n    for ensemble in ensembles:\n        result = detect_pseudo_boiling(ensemble)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}