{
    "hands_on_practices": [
        {
            "introduction": "理想气体定律是热力学建模的基石，但在燃烧等高压应用中，我们需要更精确的模型。维里方程 (Virial Equation) 为系统地描述分子间相互作用力提供了一条途径。本练习将指导您完成一项工程师的日常任务：利用压缩因子 $Z$ 的实验数据来确定第二维里系数 $B(T)$，后者是量化分子对相互作用的关键物理参数，从而培养您在数据分析和模型参数化方面的基础技能。",
            "id": "4023518",
            "problem": "为您提供了一份人工合成但科学上合理的氮气压缩因子值数据集，表示为$Z(p,T)$，涵盖了一系列与燃烧室相关的压力和温度。目标是推断氮气的第二维里系数$B(T)$随温度变化的依赖关系，并评估截断的维里状态方程 (EOS) 在最高 $20$ bar 压力下的准确性。\n\n基本原理：从气体的压缩因子 $Z$ 的定义和维里展开的概念出发。使用在低至中等密度下有效的截断维里状态方程，将数据$Z(p,T)$与第二维里系数$B(T)$联系起来。然后，在给定的温度范围内，为$B(T)$拟合一个参数化的函数形式。\n\n数据和单位：\n- 使用普适气体常数 $R_u = 8.314462618$ $\\mathrm{J/(mol\\cdot K)}$。\n- 全程使用摩尔基准，压力单位使用帕斯卡。使用$1\\,\\text{bar} = 10^5\\,\\text{Pa}$将巴（bar）转换为帕斯卡（Pascal）。\n- 温度 $T$ 的单位为开尔文（Kelvin），压缩因子 $Z$ 为无量纲。\n\n数据集：\n- 温度（开尔文）：$[300,500,1000,2000]$。\n- 压力（巴）：$[1,5,10,15,20]$。\n- 下列矩阵包含$Z(p,T)$值，其中每一行对应一个温度（顺序同上），每一列对应一个压力（顺序同上）。所有数值均为无量纲：\n$$\n\\begin{bmatrix}\n0.996993  0.979465  0.960730  0.938695  0.920460 \\\\\n0.999432  0.994359  0.987917  0.982476  0.977334 \\\\\n0.999780  0.999701  0.998602  0.998303  0.997304 \\\\\n1.000256  1.000080  1.000661  1.000741  1.001121\n\\end{bmatrix}\n$$\n\n任务：\n1. 对于数据集中的每个温度 $T$，通过在固定 $T$下对 $Z$ 与压力 $p$ 进行线性回归，从提供的$Z(p,T)$值推断出第二维里系数$B(T)$。使用带有自由截距的模型以避免测量偏移带来的偏差。然后，转换拟合得到的斜率，以获得基于摩尔的$B(T)$。\n2. 使用参数模型$B(T) = a_0 + a_1/T$，通过对给定的温度数据集进行线性最小二乘拟合，来拟合第二维里系数的温度依赖关系。\n3. 使用拟合得到的$B(T)$，在所提供的温度和压力的完整网格上预测$Z(p,T)$，并评估截断维里状态方程的准确性。\n\n要求输出与测试套件：\n计算以下五个量，除非另有说明，每个量都应表示为浮点数：\n- 项目1（浮点数）：在所有 $4 \\times 5$ 个数据点上，预测的$Z(p,T)$与提供的$Z(p,T)$之间的均方根误差 (RMSE)。报告为无量纲值，保留六位小数。\n- 项目2（浮点数）：在 $p = 20$ bar 压力下，四个温度中的最大绝对偏差。报告为无量纲值，保留六位小数。\n- 项目3（浮点数）：使用拟合的$B(T)$预测在 $T = 1800$ 开尔文和 $p = 20$ bar 条件下的压缩因子。报告为无量纲值，保留六位小数。\n- 项目4（布尔值）：拟合的$B(T)$是否在区间 $[300,2000]$ 开尔文内穿过零点。返回一个布尔值。\n- 项目5（浮点数）：使用拟合的$B(T)$预测在 $T = 300$ 开尔文和 $p = 0$ bar 条件下的压缩因子。报告为无量纲值，保留六位小数。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来并以逗号分隔的结果列表，顺序与上文所列一致，浮点数保留六位小数。例如：\n\"[rmse,max_abs_err,z_1800K_20bar,zero_crossing,z_300K_0bar]\".",
            "solution": "用户要求对氮气压缩因子 $Z$ 的一个人工合成数据集进行分析。目标是确定第二维里系数 $B(T)$，将其拟合到参数模型，并评估由此得到的截断维里状态方程的准确性。\n\n该问题具有坚实的科学基础，内容自洽，并且在算法上是可解的。其前提与物理化学和热力学原理一致。获得唯一解所需的所有数据和常数均已提供。因此，该问题被视为有效。\n\n解决方案按问题陈述中概述的三个主要步骤进行。\n\n**步骤1：推断第二维里系数 $B(T)$**\n\n维里状态方程 (EOS) 提供了一种形式体系，用于描述真实气体行为与理想气体行为的偏差。它将压缩因子 $Z = \\frac{pv}{R_u T}$ 表示为摩尔密度 $1/v$ 的幂级数，其中 $p$ 为压力，$v$ 为摩尔体积，$T$ 为绝对温度，$R_u$ 为普适气体常数。\n$$Z = 1 + \\frac{B(T)}{v} + \\frac{C(T)}{v^2} + O(v^{-3})$$\n系数 $B(T)$、$C(T)$ 等分别是第二、第三等维里系数，它们仅是温度的函数。\n\n在低至中等压力下，该方程可以被截断并重排为压力的幂级数。在第二项中使用近似 $v \\approx \\frac{R_u T}{p}$，我们得到以压力表示的截断维里状态方程：\n$$Z(p, T) \\approx 1 + \\frac{B(T) p}{R_u T}$$\n该方程表明，在固定温度 $T$ 下，压缩因子 $Z$ 近似为压力 $p$ 的线性函数。其截距为 $1$，斜率为 $\\frac{B(T)}{R_u T}$。\n\n问题指定在每个给定温度 $T_i$ 下，使用带有自由截距的经验模型 $Z(p) = c_0 + c_1 p$ 对 $Z$ 与 $p$ 进行线性回归。这是一种稳健的方法，可以容纳 $Z$ 数据中可能存在的系统性偏移，在这种情况下，理想截距 $1$ 可能无法完美达到。此回归的斜率 $c_1$ 与理论斜率等同：\n$$c_1(T) = \\frac{B(T)}{R_u T}$$\n根据此关系，我们可以推断数据集中每个温度下的第二维里系数：\n$$B(T) = c_1(T) \\cdot R_u T$$\n该过程将应用于提供的 $Z(p,T)$ 矩阵中的四个温度行。压力首先从 bar 转换为 Pascal（$1 \\text{ bar} = 10^5 \\text{ Pa}$）。\n\n**步骤2：对 $B(T)$ 的温度依赖性进行参数拟合**\n\n第二维里系数 $B(T)$ 捕捉了成对分子间相互作用的影响。其温度依赖性通常可以用简单的经验或半经验模型来描述。问题指定将计算出的 $B(T_i)$ 值拟合到以下双参数模型：\n$$B(T) = a_0 + \\frac{a_1}{T}$$\n该方程相对于变量 $1/T$ 是线性的。因此，可以通过将计算出的 $B(T_i)$ 值与相应的 $1/T_i$ 值进行线性最小二乘拟合来确定系数 $a_0$（截距）和 $a_1$（斜率）。参数 $a_0$ 代表 $B(T)$ 的高温极限，与分子的有效体积（硬球排斥）相关，而 $a_1$ 则与分子间引力的强度相关。\n\n**步骤3：预测、误差分析与评估**\n\n在确定系数 $a_0$ 和 $a_1$ 后，我们就得到了第二维里系数的一个连续解析模型，$B_{fit}(T) = a_0 + a_1/T$。该模型可用于通过基本理论状态方程形式，预测在任何压力 $p$ 和温度 $T$（在有效范围内）下的压缩因子：\n$$Z_{pred}(p, T) = 1 + \\frac{B_{fit}(T) p}{R_u T} = 1 + \\frac{(a_0 + a_1/T) p}{R_u T}$$\n注意，截距固定为 $1$，这与 $Z$ 的物理定义一致，即当 $p \\to 0$ 时，$Z$ 必须趨近于 $1$。\n\n所需的输出按如下方式计算：\n\n1.  **均方根误差 (RMSE)：** 通过计算所有 $N=20$ 个数据点上预测值 $Z_{pred}$与原始数据 $Z_{data}$ 之间的 RMSE 来评估拟合模型的准确性：\n    $$\\text{RMSE} = \\sqrt{\\frac{1}{N} \\sum_{i=1}^{4} \\sum_{j=1}^{5} (Z_{pred}(p_j, T_i) - Z_{data, ij})^2}$$\n2.  **在 $p = 20$ bar 时的最大绝对偏差：** 该指标量化了模型在数据集中最高压力下的最差性能表现：\n    $$\\text{MaxDev}_{20\\text{bar}} = \\max_{i} |Z_{pred}(p=20 \\text{ bar}, T_i) - Z_{data}(p=20 \\text{ bar}, T_i)|$$\n3.  **在 $T=1800$ K 和 $p=20$ bar 时的预测 $Z$ 值：** 这是将预测公式直接应用于原始数据集中不存在的点，用以测试模型的插值能力。\n4.  **$B(T)$ 的零点穿越：** 玻意耳温度 $T_B$ 是使 $B(T)=0$ 的温度。对于拟合模型，这发生在 $a_0 + a_1/T_B = 0$ 时，由此得出 $T_B = -a_1/a_0$。返回一个布尔值，指示该温度是否落在给定区间 $[300, 2000]$ K 内。\n5.  **在 $T=300$ K 和 $p=0$ bar 时的预测 $Z$ 值：** 根据预测模型的定义，对于任何温度，$Z_{pred}(p=0, T) = 1$。这可作为一个概念性检查。结果为 $1.0$。\n\n下面的 Python 代码实现了这整个过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of inferring the second virial coefficient for nitrogen,\n    fitting a model, and evaluating its accuracy.\n    \"\"\"\n    # ------------------ Givens and Constants ------------------\n    R_u = 8.314462618  # J/(mol*K)\n    \n    # Dataset\n    temperatures_K = np.array([300.0, 500.0, 1000.0, 2000.0])\n    pressures_bar = np.array([1.0, 5.0, 10.0, 15.0, 20.0])\n    Z_data = np.array([\n        [0.996993, 0.979465, 0.960730, 0.938695, 0.920460],\n        [0.999432, 0.994359, 0.987917, 0.982476, 0.977334],\n        [0.999780, 0.999701, 0.998602, 0.998303, 0.997304],\n        [1.000256, 1.000080, 1.000661, 1.000741, 1.001121]\n    ])\n    \n    # Convert pressure to SI units (Pascal)\n    pressures_Pa = pressures_bar * 1.0e5\n\n    # ------------------ Task 1: Infer B(T) for each T ------------------\n    B_values = []\n    for i, T in enumerate(temperatures_K):\n        z_row = Z_data[i, :]\n        # Perform linear regression: Z = c1*p + c0\n        c1, c0 = np.polyfit(pressures_Pa, z_row, 1)\n        \n        # Infer B(T) from the slope c1: c1 = B(T) / (R_u * T)\n        b_t = c1 * R_u * T\n        B_values.append(b_t)\n    \n    B_values = np.array(B_values)\n\n    # ------------------ Task 2: Fit B(T) = a0 + a1/T ------------------\n    inv_T = 1.0 / temperatures_K\n    \n    # Perform linear regression: B = a1*(1/T) + a0\n    a1, a0 = np.polyfit(inv_T, B_values, 1)\n\n    # ------------------ Task 3: Predict Z(p,T) and Evaluate ------------------\n    def B_fit(T):\n        \"\"\"Calculates B(T) using the fitted model.\"\"\"\n        return a0 + a1 / T\n\n    def Z_pred(p, T):\n        \"\"\"Predicts Z(p,T) using the fitted B(T) and truncated virial EOS.\"\"\"\n        return 1.0 + (B_fit(T) * p) / (R_u * T)\n\n    # Predict Z over the entire grid\n    Z_pred_matrix = np.zeros_like(Z_data)\n    for i, T in enumerate(temperatures_K):\n        for j, p in enumerate(pressures_Pa):\n            Z_pred_matrix[i, j] = Z_pred(p, T)\n\n    # ------------------ Required Outputs Calculation ------------------\n\n    # Item 1: RMSE between predicted and provided Z(p,T)\n    rmse = np.sqrt(np.mean((Z_pred_matrix - Z_data)**2))\n\n    # Item 2: Maximum absolute deviation at p = 20 bar\n    max_abs_err_20bar = np.max(np.abs(Z_pred_matrix[:, -1] - Z_data[:, -1]))\n\n    # Item 3: Predicted Z at T = 1800 K and p = 20 bar\n    p_eval = 20.0 * 1.0e5\n    T_eval = 1800.0\n    z_1800K_20bar = Z_pred(p_eval, T_eval)\n\n    # Item 4: Whether B(T) crosses zero in [300, 2000] K\n    # B(T) = 0 = a0 + a1/T = 0 = T = -a1/a0\n    zero_crossing = False\n    if a0 != 0:\n        boyle_temp = -a1 / a0\n        if 300.0 = boyle_temp = 2000.0:\n            zero_crossing = True\n\n    # Item 5: Predicted Z at T = 300 K and p = 0 bar\n    # By definition of the model used for prediction, Z(p=0,T)=1.\n    z_300K_0bar = Z_pred(0.0, 300.0)\n\n    # ------------------ Final Output Formatting ------------------\n    results = [\n        f\"{rmse:.6f}\",\n        f\"{max_abs_err_20bar:.6f}\",\n        f\"{z_1800K_20bar:.6f}\",\n        str(zero_crossing),\n        f\"{z_300K_0bar:.6f}\"\n    ]\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了通常仅限于低压范围的维里方程之后，我们转向更强大的立方状态方程。Soave-Redlich-Kwong (SRK) 和 Peng-Robinson (PR) 方程是化学工程和燃烧模拟中最重要的两个模型。本练习要求您从基本形式出发，实现这两个模型，求解由此产生的三次多项式以获得压缩因子 $Z$，并批判性地比较它们在燃烧相关高温下的预测性能，从而揭示吸引力参数 $\\alpha(T)$ 的不同数学形式如何影响模型的准确性。",
            "id": "4023485",
            "problem": "您的任务是构建一个完整、可运行的程序，用于比较使用两种广泛应用的立方状态方程——Soave-Redlich-Kwong (SRK) 模型和 Peng-Robinson (PR) 模型——对氢气压缩因子 $Z$ 的预测。目的是分析与温度相关的吸引力参数 $\\alpha(T)$ 如何影响高温行为。您的推导和实现必须从基本的热力学定义和定律出发，并且必须避免依赖或引用问题陈述中的简化公式。该程序将使用氢气作为单组分流体，在固定的高温和一系列压力下，求解气相压缩因子 $Z$。\n\n需要使用的基本原理：\n- 压缩因子的定义：$Z = \\dfrac{p v}{R T}$，其中 $p$ 是压力，$v$ 是摩尔体积，$R$ 是通用气体常数，$T$ 是温度。\n- 立方状态方程的一般原理是将对压力的贡献分离为排斥项和吸引项，其中参数 $b$ 捕捉排斥体积效应，参数 $a(T)$ 捕捉吸引相互作用；对于 SRK 和 PR 模型，$a(T)$ 被分解为 $a_c \\alpha(T)$，其中 $a_c$ 是一个取决于临界性质的常数，而 $\\alpha(T)$ 是一个与温度相关的修正因子。\n- 纯组分临界性质关系式，它们允许用临界温度 $T_c$ 和临界压力 $p_c$ 来表示 SRK 和 PR 模型中各自的 $a_c$ 和 $b$。\n- 通过 $\\alpha(T)$ 进入两个模型的温度依赖关系中的偏心因子 $\\omega$。\n\n您必须：\n1. 从上述基本原理以及 SRK 和 PR 状态方程的结构形式出发，推导出相应的关于纯组分压缩因子 $Z$ 的立方方程，该方程用由 $a_c \\alpha(T)$、$b$、$p$、$R$ 和 $T$ 构建的折合参数 $A$ 和 $B$ 表示，然后实现一个鲁棒的数值求根方法来获得物理上允许的 $Z$ 值。SRK 和 PR 状态方程以及 $\\alpha(T)$、$a_c$ 和 $b$ 的显式公式应在您的解答中展开，而不是在本问题陈述中。\n2. 在指定的高温下，使用 $Z$ 的最大实根来表示所有给定压力下的气相解。\n3. 实现 SRK 和 PR 各自的原生 $\\alpha(T)$ 公式。此外，实现交叉替换实验，即在 PR 方程中使用 SRK 的 $\\alpha(T)$，在 SRK 方程中使用 PR 的 $\\alpha(T)$。这可以分离出 $\\alpha(T)$ 公式对高温预测的影响。\n4. 通过计算每个情况下与完美气体极限的绝对偏差（定义为 $|Z - 1|$）来量化高温准确性。\n5. 使用以下氢气常数和通用常数：\n   - 通用气体常数：$R = 8.314462618$ J/mol/K。\n   - 氢气临界温度：$T_c = 33.19$ K。\n   - 氢气临界压力：$p_c = 12.8$ bar。\n   - 氢气偏心因子：$\\omega = -0.215$。\n6. 使用固定温度 $T = 900$ K 以及以下测试组中的压力 $p$（以 bar 为单位）：$p \\in \\{1, 50, 100\\}$。\n7. 单位一致性：在使用状态方程之前，将所有压力从 bar 转换为帕斯卡。最终的压缩因子 $Z$ 和偏差 $|Z-1|$ 是无量纲的，并且必须以浮点数形式输出。\n8. 测试组覆盖范围和输出：\n   - 计算在三种压力下，使用原生 $\\alpha(T)$ 的 SRK 和使用原生 $\\alpha(T)$ 的 PR 的 $Z$ 值列表。\n   - 计算在三种压力下，原生 SRK 和原生 PR 的 $|Z-1|$ 值列表。\n   - 计算在三种压力下，差异 $Z_{\\mathrm{PR,native}} - Z_{\\mathrm{SRK,native}}$ 的列表。\n   - 计算在三种压力下，当使用 SRK 的 $\\alpha(T)$ 代替 PR 的 $\\alpha(T)$ 时 PR $Z$ 的变化列表，定义为 $Z_{\\mathrm{PR,SRK}\\,\\alpha(T)} - Z_{\\mathrm{PR,native}}$。\n   - 计算在三种压力下，当使用 PR 的 $\\alpha(T)$ 代替 SRK 的 $\\alpha(T)$ 时 SRK $Z$ 的变化列表，定义为 $Z_{\\mathrm{SRK,PR}\\,\\alpha(T)} - Z_{\\mathrm{SRK,native}}$。\n9. 最终输出格式：\n   - 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素都是上面描述的列表之一，并严格按照以下顺序排列：\n     - $[Z_{\\mathrm{SRK,native}}, Z_{\\mathrm{PR,native}}, |Z_{\\mathrm{SRK,native}}-1|, |Z_{\\mathrm{PR,native}}-1|, Z_{\\mathrm{PR,native}} - Z_{\\mathrm{SRK,native}}, Z_{\\mathrm{PR,SRK}\\,\\alpha(T)} - Z_{\\mathrm{PR,native}}, Z_{\\mathrm{SRK,PR}\\,\\alpha(T)} - Z_{\\mathrm{SRK,native}}]$。\n   - 每个内部列表必须包含三个浮点数，分别对应于 $p=1$ bar、$p=50$ bar 和 $p=100$ bar，并且必须是无量纲的。\n   - 单行输出不得包含任何额外文本。\n\n此程序必须是自包含的，并且不需要用户输入。它必须对每种情况数值求解所推导出的关于 $Z$ 的立方方程，并将所有结果汇总为指定的最终输出格式。该问题强调从第一性原理进行推导和清晰的算法实现，而不是依赖于记忆的公式。",
            "solution": "该问题是有效的。它在科学上基于化学热力学原理，特别是使用立方状态方程来模拟真实气体行为。这是一个适定问题，提供了所有必要的常数、条件和一组明确的目标，从而可以得出一个唯一的、可验证的数值解。问题陈述客观且没有歧义。因此，我们可以继续提供完整的解答。\n\n主要目标是使用两种常见的立方状态方程（EoS）：Soave-Redlich-Kwong (SRK) 和 Peng-Robinson (PR) 模型，求解在高温（$T=900$ K）和不同压力（$p \\in \\{1, 50, 100\\}$ bar）下氢气的压缩因子 $Z$。这涉及到从这些 EoS 的基本压力显式形式推导 $Z$ 的三次多项式，实现数值解法，并比较结果，包括对与温度相关的吸引力参数 $\\alpha(T)$ 的分析。\n\n一个通用的双参数立方 EoS 可以写成压力显式形式：\n$$\np = \\frac{R T}{v - b} - \\frac{a(T)}{v^2 + u b v + w b^2}\n$$\n其中 $p$ 是绝对压力，$T$ 是绝对温度，$v$ 是摩尔体积，$R$ 是通用气体常数。参数 $b$ 代表排斥的摩尔体积，而 $a(T)$ 则解释了分子间的吸引力。常数 $u$ 和 $w$ 定义了具体的模型。\n\n对于 SRK EoS，$u=1$ 且 $w=0$：\n$$\np_{\\text{SRK}} = \\frac{R T}{v - b} - \\frac{a(T)}{v(v+b)}\n$$\n\n对于 PR EoS，$u=2$ 且 $w=-1$：\n$$\np_{\\text{PR}} = \\frac{R T}{v - b} - \\frac{a(T)}{v(v+b) + b(v-b)} = \\frac{R T}{v - b} - \\frac{a(T)}{v^2 + 2bv - b^2}\n$$\n\n该分析需要求解压缩因子，其定义为 $Z = \\frac{pv}{RT}$。为此，我们首先将压力显式的 EoS 转换为一个关于 $Z$ 的三次多项式。\n\n**SRK EoS 的 Z 三次多项式推导**\n\n从 SRK 方程开始：\n$$\np = \\frac{R T}{v - b} - \\frac{a(T)}{v(v+b)}\n$$\n我们将整个方程乘以 $\\frac{v(v+b)(v-b)}{p}$ 以消除分母：\n$$\nv(v+b)(v-b) = \\frac{RT}{p}v(v+b) - \\frac{a(T)}{p}(v-b)\n$$\n展开各项可得：\n$$\nv^3 - b^2v = \\frac{RT}{p}(v^2 + bv) - \\frac{a(T)}{p}v + \\frac{a(T)b}{p}\n$$\n整理成关于 $v$ 的多项式形式：\n$$\nv^3 - \\left(\\frac{RT}{p}\\right)v^2 - \\left(b^2 - \\frac{RTb}{p} + \\frac{a(T)}{p}\\right)v - \\frac{a(T)b}{p} = 0\n$$\n为了将其转换为关于 $Z$ 的多项式，我们代入 $v = Z\\frac{RT}{p}$：\n$$\n\\left(Z\\frac{RT}{p}\\right)^3 - \\left(\\frac{RT}{p}\\right)\\left(Z\\frac{RT}{p}\\right)^2 - \\left(b^2 - \\frac{RTb}{p} + \\frac{a(T)}{p}\\right)\\left(Z\\frac{RT}{p}\\right) - \\frac{a(T)b}{p} = 0\n$$\n将整个方程乘以 $\\left(\\frac{p}{RT}\\right)^3$ 可以简化表达式：\n$$\nZ^3 - Z^2 - \\left(\\frac{b^2p^2}{R^2T^2} - \\frac{bp}{RT} + \\frac{a(T)p}{R^2T^2}\\right)Z - \\frac{a(T)b p^2}{R^3T^3} = 0\n$$\n我们定义无量纲参数 $A = \\frac{a(T)p}{R^2T^2}$ 和 $B = \\frac{bp}{RT}$。代入这些参数，得到 SRK 模型的最终 Z 三次方程：\n$$\nZ^3 - Z^2 + (A - B - B^2)Z - AB = 0\n$$\n\n**PR EoS 的 Z 三次多项式推导**\n\nPR 模型的推导是类似的。从以下方程开始：\n$$\np = \\frac{R T}{v - b} - \\frac{a(T)}{v^2 + 2bv - b^2}\n$$\n重新排列方程以分离各项，并形成一个关于 $v$ 的多项式：\n$$\np(v-b)(v^2+2bv-b^2) = RT(v^2+2bv-b^2) - a(T)(v-b)\n$$\n展开并合并 $v$ 的同次幂项：\n$$\np(v^3 + bv^2 - 3b^2v + b^3) = RTv^2 + 2RTbv - RTb^2 - a(T)v + a(T)b\n$$\n$$\nv^3 + \\left(b - \\frac{RT}{p}\\right)v^2 + \\left(-3b^2 - \\frac{2RTb}{p} + \\frac{a(T)}{p}\\right)v + \\left(b^3 + \\frac{RTb^2}{p} - \\frac{a(T)b}{p}\\right) = 0\n$$\n代入 $v = Z\\frac{RT}{p}$ 并乘以 $\\left(\\frac{p}{RT}\\right)^3$：\n$$\nZ^3 + \\left(\\frac{bp}{RT}-1\\right)Z^2 + \\left(-\\frac{3b^2p^2}{R^2T^2} - \\frac{2bp}{RT} + \\frac{a(T)p}{R^2T^2}\\right)Z + \\left(\\frac{b^3p^3}{R^3T^3} + \\frac{b^2p^2}{R^2T^2} - \\frac{a(T)bp^2}{R^3T^3}\\right) = 0\n$$\n使用与之前相同的 $A$ 和 $B$ 定义，我们得到 PR 模型的 Z 三次方程：\n$$\nZ^3 - (1-B)Z^2 + (A - 2B - 3B^2)Z - (AB - B^2 - B^3) = 0\n$$\n\n**模型参数**\n\n参数 $a_c$ 和 $b$ 不是任意的；它们是通过流体的临界性质（$T_c, p_c$）并强制满足临界条件（$\\frac{\\partial p}{\\partial v}|_{T_c} = 0$ 和 $\\frac{\\partial^2 p}{\\partial v^2}|_{T_c} = 0$）来确定的。参数 $a$ 也是温度的函数，表示为 $a(T) = a_c \\alpha(T)$，其中 $a_c = a(T_c)$。\n\n对于 **SRK 模型**：\n$$\na_c = \\Omega_a \\frac{R^2 T_c^2}{p_c} \\quad \\text{with} \\quad \\Omega_a = 0.42748\n$$\n$$\nb = \\Omega_b \\frac{R T_c}{p_c} \\quad \\text{with} \\quad \\Omega_b = 0.08664\n$$\n$$\n\\alpha_{\\text{SRK}}(T) = \\left[ 1 + m_{\\text{SRK}} \\left( 1 - \\sqrt{\\frac{T}{T_c}} \\right) \\right]^2\n$$\n$$\nm_{\\text{SRK}} = 0.480 + 1.574 \\omega - 0.176 \\omega^2\n$$\n\n对于 **PR 模型**：\n$$\na_c = \\Omega_a \\frac{R^2 T_c^2}{p_c} \\quad \\text{with} \\quad \\Omega_a = 0.45724\n$$\n$$\nb = \\Omega_b \\frac{R T_c}{p_c} \\quad \\text{with} \\quad \\Omega_b = 0.07780\n$$\n$$\n\\alpha_{\\text{PR}}(T) = \\left[ 1 + m_{\\text{PR}} \\left( 1 - \\sqrt{\\frac{T}{T_c}} \\right) \\right]^2\n$$\n$$\nm_{\\text{PR}} = 0.37464 + 1.54226 \\omega - 0.26992 \\omega^2\n$$\n在这里，$\\omega$ 是 Pitzer 偏心因子，它表征了分子势场的不对称性。\n\n**数值求解算法**\n\n对于每个指定的压力 $p$ 和给定的温度 $T=900$ K，我们对 EoS (SRK/PR) 和 $\\alpha(T)$ 函数（原生/交叉替换）的每种组合执行以下步骤：\n\n1.  将压力从 bar 转换为帕斯卡：$p \\,[\\text{Pa}] = p \\,[\\text{bar}] \\times 10^5$。\n2.  计算折合温度 $T_r = T/T_c$。\n3.  根据所选的 $\\alpha(T)$ 公式和偏心因子 $\\omega$ 计算相应的 $m$ 参数。\n4.  使用所选公式计算 $\\alpha(T)$。\n5.  根据所选的 EoS 结构（SRK 或 PR）计算特定于该 EoS 的参数 $a_c$ 和 $b$。\n6.  计算与温度相关的吸引力参数 $a(T) = a_c \\alpha(T)$。\n7.  计算无量纲参数 $A = \\frac{a(T)p}{R^2T^2}$ 和 $B = \\frac{bp}{RT}$。\n8.  构建与所选 EoS 结构对应的关于 $Z$ 的三次多项式的系数。\n9.  求解该三次方程的三个根。将使用标准的多项式数值求根算法。\n10. 根可以是实数或复数。对于单相流体，将有一个或三个实根。我们选择最大的实根，它对应于气相的压缩因子。\n11. 使用计算出的 $Z$ 值，我们计算所需的导出量：与理想气体行为的偏差 $|Z-1|$、原生 SRK 和 PR 预测值之间的差异、以及由于交叉替换 $\\alpha(T)$ 函数而引起的 $Z$ 的变化。\n\n此过程被系统地应用于所有测试用例，并将结果汇总以用于最终输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes compressibility factors and related quantities for hydrogen\n    using SRK and PR equations of state, including cross-substitutions\n    of the alpha function.\n    \"\"\"\n\n    # --- Givens and Constants ---\n    R = 8.314462618  # Universal gas constant, J/(mol*K)\n    T_C_H2 = 33.19  # Critical temperature of H2, K\n    P_C_H2 = 12.8  # Critical pressure of H2, bar\n    OMEGA_H2 = -0.215  # Acentric factor of H2\n\n    T = 900.0  # Temperature, K\n    PRESSURES_BAR = [1.0, 50.0, 100.0]  # Pressures, bar\n    \n    # Convert critical pressure to Pascals\n    P_C_H2_PA = P_C_H2 * 1e5\n\n    def get_alpha_parameters(omega):\n        \"\"\"Calculates m_SRK and m_PR for the alpha functions.\"\"\"\n        m_srk = 0.480 + 1.574 * omega - 0.176 * omega**2\n        m_pr = 0.37464 + 1.54226 * omega - 0.26992 * omega**2\n        return m_srk, m_pr\n\n    def calculate_alpha(T, T_c, m):\n        \"\"\"Calculates the temperature-dependent alpha parameter.\"\"\"\n        T_r = T / T_c\n        return (1 + m * (1 - np.sqrt(T_r)))**2\n\n    def get_eos_parameters(eos_type):\n        \"\"\"Returns the constants Omega_a and Omega_b for SRK or PR.\"\"\"\n        if eos_type == 'SRK':\n            omega_a = 0.42748\n            omega_b = 0.08664\n        elif eos_type == 'PR':\n            omega_a = 0.45724\n            omega_b = 0.07780\n        else:\n            raise ValueError(\"Unknown EoS type\")\n        return omega_a, omega_b\n\n    def solve_Z(p_pa, T_kelvin, eos_type, alpha_type):\n        \"\"\"\n        Solves the cubic equation of state for the compressibility factor Z.\n\n        Args:\n            p_pa (float): Pressure in Pascals.\n            T_kelvin (float): Temperature in Kelvin.\n            eos_type (str): 'SRK' or 'PR' for the equation structure.\n            alpha_type (str): 'SRK' or 'PR' for the alpha function formulation.\n        \n        Returns:\n            float: The largest real root for Z (vapor phase).\n        \"\"\"\n        # 1. Get m parameters for both alpha functions\n        m_srk, m_pr = get_alpha_parameters(OMEGA_H2)\n        \n        # 2. Select appropriate m and calculate alpha\n        if alpha_type == 'SRK':\n            m = m_srk\n        else: # 'PR'\n            m = m_pr\n        alpha = calculate_alpha(T_kelvin, T_C_H2, m)\n        \n        # 3. Get EoS constants and calculate a_c and b\n        omega_a_eos, omega_b_eos = get_eos_parameters(eos_type)\n        a_c = omega_a_eos * (R**2 * T_C_H2**2) / P_C_H2_PA\n        b = omega_b_eos * (R * T_C_H2) / P_C_H2_PA\n        \n        # 4. Calculate a(T)\n        a_T = a_c * alpha\n        \n        # 5. Calculate dimensionless parameters A and B\n        A = a_T * p_pa / (R**2 * T_kelvin**2)\n        B = b * p_pa / (R * T_kelvin)\n        \n        # 6. Define polynomial coefficients based on EoS type\n        if eos_type == 'SRK':\n            # Z^3 - Z^2 + (A - B - B^2)Z - AB = 0\n            coeffs = [1, -1, A - B - B**2, -A * B]\n        else: # 'PR'\n            # Z^3 - (1-B)Z^2 + (A - 2B - 3B^2)Z - (AB - B^2 - B^3) = 0\n            coeffs = [1, -(1 - B), A - 2*B - 3*B**2, -(A*B - B**2 - B**3)]\n            \n        # 7. Solve for roots and select the largest real root\n        roots = np.roots(coeffs)\n        real_roots = roots[np.isreal(roots)].real\n        \n        if len(real_roots) == 0:\n            # Should not happen under these conditions\n            return np.nan\n        \n        return np.max(real_roots)\n\n    # --- Main Calculation Loop ---\n    z_srk_native_list = []\n    z_pr_native_list = []\n    z_pr_srk_alpha_list = []\n    z_srk_pr_alpha_list = []\n\n    for p_bar in PRESSURES_BAR:\n        p_pascal = p_bar * 1e5\n        \n        # Native models\n        z_srk_native = solve_Z(p_pascal, T, 'SRK', 'SRK')\n        z_pr_native = solve_Z(p_pascal, T, 'PR', 'PR')\n        \n        # Cross-substitution models\n        z_pr_srk_alpha = solve_Z(p_pascal, T, 'PR', 'SRK')\n        z_srk_pr_alpha = solve_Z(p_pascal, T, 'SRK', 'PR')\n        \n        z_srk_native_list.append(z_srk_native)\n        z_pr_native_list.append(z_pr_native)\n        z_pr_srk_alpha_list.append(z_pr_srk_alpha)\n        z_srk_pr_alpha_list.append(z_srk_pr_alpha)\n\n    # --- Post-processing to calculate required quantities ---\n    z_srk_native_arr = np.array(z_srk_native_list)\n    z_pr_native_arr = np.array(z_pr_native_list)\n    z_pr_srk_alpha_arr = np.array(z_pr_srk_alpha_list)\n    z_srk_pr_alpha_arr = np.array(z_srk_pr_alpha_list)\n\n    # Absolute deviations from ideal gas (Z=1)\n    dev_srk_list = np.abs(z_srk_native_arr - 1).tolist()\n    dev_pr_list = np.abs(z_pr_native_arr - 1).tolist()\n    \n    # Difference between native PR and SRK\n    diff_pr_srk_list = (z_pr_native_arr - z_srk_native_arr).tolist()\n    \n    # Change in Z due to alpha cross-substitution\n    change_pr_list = (z_pr_srk_alpha_arr - z_pr_native_arr).tolist()\n    change_srk_list = (z_srk_pr_alpha_arr - z_srk_native_arr).tolist()\n\n    # --- Format final output ---\n    results = [\n        z_srk_native_list,\n        z_pr_native_list,\n        dev_srk_list,\n        dev_pr_list,\n        diff_pr_srk_list,\n        change_pr_list,\n        change_srk_list,\n    ]\n\n    # Convert lists of floats to a string representation for the final print\n    # e.g., [[1.0, 2.0], [3.0, 4.0]] - \"[[1.0, 2.0],[3.0, 4.0]]\"\n    output_str = str(results).replace(\" \", \"\")\n\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "在实现了立方状态方程后，理解其在物理和数值计算的挑战性区域中的行为至关重要。本练习聚焦于 Peng-Robinson (PR) 方程在临界点附近的行为，在这一区域气相和液相变得无法区分，数值求解器可能变得不稳定。通过检验当流体接近其临界状态时方程根的行为，您将深入理解多重解的物理意义，以及为燃烧模拟开发可靠的热力学物性库时鲁棒数值策略的重要性。",
            "id": "4023555",
            "problem": "考虑与计算燃烧相关的单组分流体和二元混合物。使用 Peng–Robinson 状态方程（PR EOS）作为热力学性质的本构模型。您将推导计算可压缩因子所需的表达式，并评估近临界行为。然后，您将编写一个程序，为选定的测试状态计算可压缩因子和与温度相关的吸引力参数。\n\n基本原理：\n- 可压缩因子定义为 $Z \\equiv \\dfrac{p\\,v}{R\\,T}$，其中 $p$ 是压力，$v$ 是摩尔体积，$R$ 是通用气体常数，$T$ 是温度。\n- Peng–Robinson 状态方程是一个经过广泛验证的立方状态方程，用于模拟真实气体行为。对于单组分，其摩尔形式写作\n$$\np = \\frac{R\\,T}{v - b} - \\frac{a(T)}{v^2 + 2\\,b\\,v - b^2},\n$$\n其中 $a(T)$ 是与温度相关的吸引力参数，$b$ 是协体积参数。对于混合物，代数形式保持不变，但混合物参数 $a_{\\mathrm{m}}(T)$ 和 $b_{\\mathrm{m}}$ 通过混合规则计算。\n- Peng–Robinson 参数化方法使用临界性质和偏心因子通过以下方式定义 $a(T)$ 和 $b$：\n$$\na(T) = a_{\\mathrm{c}}\\,\\alpha(T),\\quad a_{\\mathrm{c}} = 0.45724\\,\\frac{R^2\\,T_{\\mathrm{c}}^2}{p_{\\mathrm{c}}},\\quad b = 0.07780\\,\\frac{R\\,T_{\\mathrm{c}}}{p_{\\mathrm{c}}},\n$$\n$$\n\\alpha(T) = \\left[1 + \\kappa\\left(1 - \\sqrt{\\frac{T}{T_{\\mathrm{c}}}}\\right)\\right]^2,\\quad \\kappa = 0.37464 + 1.54226\\,\\omega - 0.26992\\,\\omega^2,\n$$\n其中 $T_{\\mathrm{c}}$ 是临界温度，$p_{\\mathrm{c}}$ 是临界压力，$\\omega$ 是偏心因子（无量纲）。\n\n对于组分 $i \\in \\{1,2\\}$、摩尔分数为 $x_i$ 的二元混合物，经典混合规则定义为\n$$\na_{\\mathrm{m}}(T) = \\sum_{i=1}^{2}\\sum_{j=1}^{2} x_i\\,x_j\\,\\sqrt{a_i(T)\\,a_j(T)}\\,(1 - k_{ij}),\\quad b_{\\mathrm{m}} = \\sum_{i=1}^{2} x_i\\,b_i,\n$$\n其中 $k_{ij}$ 是二元相互作用参数（根据惯例 $k_{ii} = 0$）。\n\n任务：\n1. 从上面给出的 PR EOS 定义和可压缩因子定义 $Z = p\\,v/(R\\,T)$ 出发，推导出一个关于 $Z$ 的三次多项式，其系数用无量纲参数表示\n$$\nA \\equiv \\frac{a(T)\\,p}{R^2\\,T^2},\\quad B \\equiv \\frac{b\\,p}{R\\,T}\n$$\n对于单组分情况，以及类似地使用 $a_{\\mathrm{m}}(T)$、$b_{\\mathrm{m}}$ 对于混合物。您必须展示从基本定义到最终 $Z$ 的三次式的每一步，不得假定中间的简化公式。\n2. 使用推导出的关系，实现一个稳健的数值策略，以计算给定状态下关于 $Z$ 的三次方程的所有实根。选择最大的实根作为类气相可压缩因子，最小的实根作为类液相可压缩因子。在只有一个实根的状态下，将该值同时报告为类气相和类液相的 $Z$，因为在临界点附近各相重合。\n3. 数值分析当 $T \\to T_{\\mathrm{c}}$ 时 $a(T)$ 的行为，以及三次方程的实根在临界状态附近如何合并或分离。您的算法必须包含适用于临界条件下燃烧性质计算的计算保障措施（例如，缩放到无量纲群组、根分类的容差以及温度比的正则化）。\n4. 对下面指定的每个测试状态，计算类气相可压缩因子 $Z_{\\mathrm{v}}$ 和吸引力参数（对于单组分为 $a$，对于混合物为 $a_{\\mathrm{m}}$）。报告无量纲的 $Z_{\\mathrm{v}}$ 和单位为 $\\mathrm{Pa\\, m^6\\, mol^{-2}}$ 的 $a$（或 $a_{\\mathrm{m}}$）。每个测试用例的结果必须是两个数字：首先是 $Z_{\\mathrm{v}}$（无量纲），然后是 $a$（或 $a_{\\mathrm{m}}$），单位为 $\\mathrm{Pa\\, m^6\\, mol^{-2}}$。\n\n物理常数和性质（使用国际单位制）：\n- 使用 $R = 8.314462618\\ \\mathrm{J\\, mol^{-1}\\, K^{-1}}$。\n- 甲烷（$\\mathrm{CH_4}$）：$T_{\\mathrm{c}} = 190.564\\ \\mathrm{K}$，$p_{\\mathrm{c}} = 4.5992\\times 10^{6}\\ \\mathrm{Pa}$，$\\omega = 0.011$。\n- 氮气（$\\mathrm{N_2}$）：$T_{\\mathrm{c}} = 126.192\\ \\mathrm{K}$，$p_{\\mathrm{c}} = 3.3958\\times 10^{6}\\ \\mathrm{Pa}$，$\\omega = 0.0372$。\n- 甲烷-氮气二元相互作用参数：$k_{12} = k_{21} = 0.03$ 且 $k_{11} = k_{22} = 0$。\n\n测试套件：\n- 情况 1（单组分 $\\mathrm{CH_4}$，近临界点以下）：$T = T_{\\mathrm{c}}(1 - 10^{-6})$，$p = p_{\\mathrm{c}}$。\n- 情况 2（单组分 $\\mathrm{CH_4}$，在临界点）：$T = T_{\\mathrm{c}}$，$p = p_{\\mathrm{c}}$。\n- 情况 3（单组分 $\\mathrm{CH_4}$，近临界点以上）：$T = T_{\\mathrm{c}}(1 + 10^{-6})$，$p = p_{\\mathrm{c}}$。\n- 情况 4（单组分 $\\mathrm{CH_4}$，稀薄气体）：$T = 300\\ \\mathrm{K}$，$p = 1.0\\times 10^{5}\\ \\mathrm{Pa}$。\n- 情况 5（二元混合物 $\\mathrm{CH_4}/\\mathrm{N_2}$，组分 $x_{\\mathrm{CH_4}} = 0.7$，$x_{\\mathrm{N_2}} = 0.3$，接近甲烷临界压力）：$T = 190.564\\ \\mathrm{K}$，$p = 4.0\\times 10^{6}\\ \\mathrm{Pa}$。\n- 情况 6（二元混合物 $\\mathrm{CH_4}/\\mathrm{N_2}$，组分 $x_{\\mathrm{CH_4}} = 0.7$，$x_{\\mathrm{N_2}} = 0.3$，与高温燃烧相关）：$T = 1500\\ \\mathrm{K}$，$p = 1.0\\times 10^{5}\\ \\mathrm{Pa}$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须包含每个测试用例的有序对 $(Z_{\\mathrm{v}},a)$，按用例升序排列并展平成一个列表。例如，输出必须采用以下形式\n[$Z_{\\mathrm{v},1},a_1,Z_{\\mathrm{v,2}},a_2,\\dots,Z_{\\mathrm{v,6}},a_6$],\n其中 $Z_{\\mathrm{v,i}}$ 是无量纲的，$a_i$ 的单位是 $\\mathrm{Pa\\, m^6\\, mol^{-2}}$。",
            "solution": "所提出的问题是有效的，因为它科学地基于化学热力学的既定原理，数学上是适定的，并且没有歧义或矛盾。它要求推导和实现一个标准模型，即 Peng–Robinson 状态方程（PR EOS），以计算单组分和二元混合物流体的热力学性质，这是计算热力学和燃烧建模中的一个典型任务。所有必要的数据和常数都已提供。因此，我将提供完整的解决方案。\n\n第 1 部分：可压缩因子 $Z$ 的三次多项式推导\n\n问题从以摩尔体积 $v$ 定义的 Peng–Robinson 状态方程开始：\n$$\np = \\frac{R\\,T}{v - b} - \\frac{a(T)}{v^2 + 2\\,b\\,v - b^2}\n$$\n以及可压缩因子 $Z$ 的定义：\n$$\nZ = \\frac{p\\,v}{R\\,T} \\implies v = \\frac{Z\\,R\\,T}{p}\n$$\n我们的目标是推导出一个关于 $Z$ 的三次多项式。最直接的方法是首先将 PR EOS 重排成一个关于 $v$ 的三次多项式，然后将 $v$ 用 $Z$ 表示的表达式代入。\n\n首先，我们通过重排 EOS 来消除分母：\n$$\np + \\frac{a(T)}{v^2 + 2\\,b\\,v - b^2} = \\frac{R\\,T}{v - b}\n$$\n两边同乘以 $(v - b)(v^2 + 2\\,b\\,v - b^2)$：\n$$\np\\,(v - b)\\,(v^2 + 2\\,b\\,v - b^2) + a(T)\\,(v - b) = R\\,T\\,(v^2 + 2\\,b\\,v - b^2)\n$$\n展开多项式项：\n$$\np\\,(v^3 + 2\\,b\\,v^2 - b^2v - b\\,v^2 - 2\\,b^2v + b^3) + a\\,v - a\\,b = R\\,T\\,v^2 + 2\\,R\\,T\\,b\\,v - R\\,T\\,b^2\n$$\n合并 $v$ 的同次幂项：\n$$\np\\,v^3 + p\\,(b\\,v^2) - p\\,(3\\,b^2v) + p\\,b^3 + a\\,v - a\\,b = R\\,T\\,v^2 + 2\\,R\\,T\\,b\\,v - R\\,T\\,b^2\n$$\n将所有项移到左侧，形成一个齐次多项式方程：\n$$\np\\,v^3 + (p\\,b - R\\,T)\\,v^2 + (a - 3\\,p\\,b^2 - 2\\,R\\,T\\,b)\\,v + (p\\,b^3 + R\\,T\\,b^2 - a\\,b) = 0\n$$\n为了无量纲化，我们将整个方程除以 $p$：\n$$\nv^3 + (b - \\frac{R\\,T}{p})\\,v^2 + (\\frac{a}{p} - 3\\,b^2 - 2\\,b\\frac{R\\,T}{p})\\,v + (b^3 + b^2\\frac{R\\,T}{p} - \\frac{a\\,b}{p}) = 0\n$$\n现在，将 $v = Z \\frac{R\\,T}{p}$ 代入这个关于 $v$ 的三次方程：\n$$\n\\left(Z\\frac{R\\,T}{p}\\right)^3 + \\left(b - \\frac{R\\,T}{p}\\right)\\left(Z\\frac{R\\,T}{p}\\right)^2 + \\left(\\frac{a}{p} - 3\\,b^2 - 2\\,b\\frac{R\\,T}{p}\\right)\\left(Z\\frac{R\\,T}{p}\\right) + \\left(b^3 + b^2\\frac{R\\,T}{p} - \\frac{a\\,b}{p}\\right) = 0\n$$\n为简化起见，将整个方程乘以 $\\left(\\frac{p}{R\\,T}\\right)^3$：\n$$\nZ^3 + \\left(b\\frac{p}{R\\,T} - 1\\right)Z^2 + \\left(\\frac{a\\,p}{(R\\,T)^2} - 3\\,b^2\\frac{p^2}{(R\\,T)^2} - 2\\,b\\frac{p}{R\\,T}\\right)Z + \\left(b^3\\frac{p^3}{(R\\,T)^3} + b^2\\frac{p^2}{(R\\,T)^2} - \\frac{a\\,b\\,p^2}{(R\\,T)^3}\\right) = 0\n$$\n问题定义了无量纲参数 $A$ 和 $B$：\n$$\nA \\equiv \\frac{a\\,p}{R^2\\,T^2}, \\quad B \\equiv \\frac{b\\,p}{R\\,T}\n$$\n将 $A$ 和 $B$ 代入方程得到：\n$$\nZ^3 + (B - 1)Z^2 + (A - 3B^2 - 2B)Z + (B^3 + B^2 - A\\,B) = 0\n$$\n重排成标准多项式形式 $Z^3 + c_2Z^2 + c_1Z + c_0 = 0$，我们有：\n$$\nc_2 = B - 1\n$$\n$$\nc_1 = A - 2B - 3B^2\n$$\n$$\nc_0 = B^3 + B^2 - AB\n$$\n为方便起见，这通常写作：\n$$\nZ^3 - (1 - B)Z^2 + (A - 2B - 3B^2)Z - (AB - B^2 - B^3) = 0\n$$\n这就是所要求的关于可压缩因子 $Z$ 的三次多项式。同样的形式也适用于混合物，前提是参数 $a$ 和 $b$ 被混合物参数 $a_{\\mathrm{m}}$ 和 $b_{\\mathrm{m}}$ 替代，这又会改变 $A$ 和 $B$ 的定义。\n\n第 2 部分：数值策略与实现\n\n问题的解决方案需要一个数值算法来计算参数 $a$ 和 $b$，构建关于 $Z$ 的三次多项式的系数，找到其根，并报告所需的量。\n\n总体算法如下：\n1.  对于给定的状态（$T$，$p$）和组成（组分 $i$ 的摩尔分数 $x_i$），首先计算各组分的特定参数。对于每个组分 $i$：\n    -   $a_{c,i} = 0.45724\\,\\frac{R^2\\,T_{\\mathrm{c},i}^2}{p_{\\mathrm{c},i}}$\n    -   $b_i = 0.07780\\,\\frac{R\\,T_{\\mathrm{c},i}}{p_{\\mathrm{c},i}}$\n    -   $\\kappa_i = 0.37464 + 1.54226\\,\\omega_i - 0.26992\\,\\omega_i^2$\n    -   $\\alpha_i(T) = \\left[1 + \\kappa_i\\left(1 - \\sqrt{T/T_{\\mathrm{c},i}}\\right)\\right]^2$\n    -   $a_i(T) = a_{c,i}\\,\\alpha_i(T)$\n\n2.  如果流体是混合物，使用提供的混合规则计算混合物参数 $a_{\\mathrm{m}}(T)$ 和 $b_{\\mathrm{m}}$：\n    -   $b_{\\mathrm{m}} = \\sum_i x_i b_i$\n    -   $a_{\\mathrm{m}}(T) = \\sum_i \\sum_j x_i x_j \\sqrt{a_i(T)a_j(T)}(1-k_{ij})$，其中 $k_{ii}=0$。\n    对于单组分，$a_{\\mathrm{m}}(T) = a(T)$ 且 $b_{\\mathrm{m}} = b$。\n\n3.  使用 $a_{\\mathrm{m}}$ 和 $b_{\\mathrm{m}}$（或纯流体的 $a$ 和 $b$），计算无量纲群组 $A$ 和 $B$：\n    -   $A = \\frac{a_{\\mathrm{m}}\\,p}{R^2\\,T^2}$\n    -   $B = \\frac{b_{\\mathrm{m}}\\,p}{R\\,T}$\n\n4.  构建三次多项式 $Z^3 + c_2Z^2 + c_1Z + c_0 = 0$ 的系数：\n    -   $c_2 = B - 1$\n    -   $c_1 = A - 2B - 3B^2$\n    -   $c_0 = B^3 + B^2 - AB$\n\n5.  求解三次多项式的根。一个稳健的方法是使用伴随矩阵特征值算法，例如 `numpy.roots` 中的实现。这将产生三个根，它们可能是实数或共轭复数对。\n\n6.  分离实根。由于系数是实数，任何复数根必须成共轭对出现。一个三次多项式必须至少有一个实根。我们通过检查其虚部的绝对值是否小于一个小的数值容差（例如，$10^{-9}$）来识别实根。\n\n7.  根据问题规范，类气相可压缩因子 $Z_{\\mathrm{v}}$ 是最大的实根。在单相区或临界点，只有一个实根，代表流体的可压缩性。在两相（气-液）区，有三个不同的实根；最大的对应于气相，最小的对应于液相，中间的根在物理上是不稳定的。\n\n数值实现将使用双精度浮点运算，这足以处理 $T$ 非常接近 $T_{\\mathrm{c}}$ 的近临界测试用例。对于所有 $T0$，$\\sqrt{T/T_{\\mathrm{c}}}$ 项是良态的。对于指定的测试用例，预计不会出现需要超出标准浮点实践的特殊正则化的灾难性抵消或其他数值不稳定性。\n\n此过程系统地应用于问题中定义的六个测试用例中的每一个，从而得出所需的 $(Z_{\\mathrm{v}}, a)$ 或 $(Z_{\\mathrm{v}}, a_{\\mathrm{m}})$ 对。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Peng-Robinson EOS for compressibility factor and attraction\n    parameter for a series of test cases.\n    \"\"\"\n\n    # Physical constants and properties\n    R = 8.314462618  # J mol^-1 K^-1\n\n    PROPERTIES = {\n        'CH4': {'Tc': 190.564, 'pc': 4.5992e6, 'omega': 0.011},\n        'N2':  {'Tc': 126.192, 'pc': 3.3958e6, 'omega': 0.0372}\n    }\n\n    # Binary interaction parameters {frozenset({comp1, comp2}): kij}\n    K_IJ = {\n        frozenset(['CH4', 'N2']): 0.03\n    }\n\n    def get_pr_eos_results(T, p, composition):\n        \"\"\"\n        Calculates the vapor-like compressibility factor Z_v and the mixture\n        attraction parameter a_m for a given state and composition.\n\n        Args:\n            T (float): Temperature in K.\n            p (float): Pressure in Pa.\n            composition (list): A list of tuples, where each tuple contains\n                                a component name (str) and its mole fraction (float).\n\n        Returns:\n            tuple: A tuple containing (Z_v, a_m), where Z_v is dimensionless and\n                   a_m is in Pa m^6 mol^-2.\n        \"\"\"\n        num_components = len(composition)\n        comp_names = [c[0] for c in composition]\n        mole_fractions = np.array([c[1] for c in composition])\n\n        # Step 1: Calculate individual component parameters\n        a_i_T = np.zeros(num_components)\n        b_i = np.zeros(num_components)\n\n        for i in range(num_components):\n            name = comp_names[i]\n            prop = PROPERTIES[name]\n            Tc, pc, omega = prop['Tc'], prop['pc'], prop['omega']\n\n            ac_i = 0.45724 * (R**2 * Tc**2) / pc\n            b_i[i] = 0.07780 * (R * Tc) / pc\n            \n            kappa_i = 0.37464 + 1.54226 * omega - 0.26992 * omega**2\n            \n            Tr = T / Tc\n            alpha_i_T = (1 + kappa_i * (1 - np.sqrt(Tr)))**2\n            a_i_T[i] = ac_i * alpha_i_T\n\n        # Step 2: Apply mixing rules\n        b_m = np.sum(mole_fractions * b_i)\n\n        a_m = 0.0\n        for i in range(num_components):\n            for j in range(num_components):\n                key = frozenset([comp_names[i], comp_names[j]])\n                k_ij = K_IJ.get(key, 0.0)\n                a_m += mole_fractions[i] * mole_fractions[j] * np.sqrt(a_i_T[i] * a_i_T[j]) * (1 - k_ij)\n        \n        # Step 3: Calculate dimensionless parameters A and B\n        A = a_m * p / (R**2 * T**2)\n        B = b_m * p / (R * T)\n\n        # Step 4: Formulate cubic polynomial coefficients for Z\n        # Z^3 + c2*Z^2 + c1*Z + c0 = 0\n        c2 = B - 1\n        c1 = A - 2 * B - 3 * B**2\n        c0 = B**3 + B**2 - A * B\n        \n        coeffs = [1, c2, c1, c0]\n\n        # Step 5  6: Solve for roots and find real roots\n        roots = np.roots(coeffs)\n        real_roots = roots[np.isclose(roots.imag, 0)].real\n\n        # Step 7: Select vapor-like root Z_v\n        Z_v = np.max(real_roots)\n        \n        return Z_v, a_m\n\n    # Test Suite\n    CH4_Tc = PROPERTIES['CH4']['Tc']\n    CH4_pc = PROPERTIES['CH4']['pc']\n    \n    test_cases = [\n        # Case 1: single-component CH4, near-critical below\n        {'T': CH4_Tc * (1 - 1e-6), 'p': CH4_pc, 'composition': [('CH4', 1.0)]},\n        # Case 2: single-component CH4, at critical\n        {'T': CH4_Tc, 'p': CH4_pc, 'composition': [('CH4', 1.0)]},\n        # Case 3: single-component CH4, near-critical above\n        {'T': CH4_Tc * (1 + 1e-6), 'p': CH4_pc, 'composition': [('CH4', 1.0)]},\n        # Case 4: single-component CH4, dilute-gas\n        {'T': 300.0, 'p': 1.0e5, 'composition': [('CH4', 1.0)]},\n        # Case 5: binary mixture CH4/N2, near methane critical pressure\n        {'T': 190.564, 'p': 4.0e6, 'composition': [('CH4', 0.7), ('N2', 0.3)]},\n        # Case 6: binary mixture CH4/N2, high-T combustion\n        {'T': 1500.0, 'p': 1.0e5, 'composition': [('CH4', 0.7), ('N2', 0.3)]},\n    ]\n\n    results = []\n    for case in test_cases:\n        Z_v, a_val = get_pr_eos_results(case['T'], case['p'], case['composition'])\n        results.append(Z_v)\n        results.append(a_val)\n    \n    # Format and print the final output\n    print(f\"[{','.join(f'{val:.8e}' for val in results)}]\")\n\nsolve()\n```"
        }
    ]
}