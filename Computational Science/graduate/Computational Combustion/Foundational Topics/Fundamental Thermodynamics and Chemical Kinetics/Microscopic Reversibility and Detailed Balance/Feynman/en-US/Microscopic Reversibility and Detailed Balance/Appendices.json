{
    "hands_on_practices": [
        {
            "introduction": "The principle of detailed balance provides a crucial link between chemical kinetics and thermodynamics. A cornerstone of this connection is the equilibrium constant, $K_{\\mathrm{eq}}(T)$, which dictates the ratio of forward and reverse rate constants. This first practice establishes the fundamental skill of calculating $K_{\\mathrm{eq}}(T)$ from standard thermochemical data, such as the widely used NASA polynomials, grounding our kinetic models in robust thermodynamic reality. ",
            "id": "4039337",
            "problem": "You are given the National Aeronautics and Space Administration (NASA) seven-coefficient polynomial thermochemistry representation for ideal-gas species, valid over two temperature subranges. Your task is to derive, from first principles grounded in statistical mechanics, how to compute the standard Gibbs free energy change $\\Delta G^\\circ(T)$ for a gas-phase reaction at the standard-state pressure $p^\\circ$ and then the equilibrium constant $K_{\\mathrm{eq}}(T)$ in a form consistent with microscopic reversibility and detailed balance. The derivation must explicitly account for translational, rotational, vibrational, and electronic contributions to the molecular partition functions, and must connect those contributions to the thermodynamic functions used in computation.\n\nThe program you produce must implement the following computational specification:\n\n1. Use the NASA seven-coefficient polynomials to evaluate the dimensionless functions $c_p/R$, $h/(RT)$, and $s/R$ for each species $i$, where $R$ is the universal gas constant. The polynomials are, for temperature $T$ in kelvin,\n   - Low-temperature range: $T \\in [200,1000]$,\n   - High-temperature range: $T \\in (1000,6000]$.\n2. For each species, the low-range coefficients $\\{a_1,\\dots,a_7\\}$ and the high-range coefficients $\\{a_1,\\dots,a_7\\}$ are provided. The dimensionless functions are to be evaluated using the standard NASA functional forms:\n   - $c_p/R = a_1 + a_2 T + a_3 T^2 + a_4 T^3 + a_5 T^4$,\n   - $h/(RT) = a_1 + a_2 \\dfrac{T}{2} + a_3 \\dfrac{T^2}{3} + a_4 \\dfrac{T^3}{4} + a_5 \\dfrac{T^4}{5} + a_6 \\dfrac{1}{T}$,\n   - $s/R = a_1 \\ln T + a_2 T + a_3 \\dfrac{T^2}{2} + a_4 \\dfrac{T^3}{3} + a_5 \\dfrac{T^4}{4} + a_7$.\n3. The universal gas constant is $R = 8.31446261815324$ joules per mole per kelvin, or $R = 8.31446261815324\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$. The standard-state pressure is $p^\\circ = 1.0\\times10^5\\,\\mathrm{Pa}$.\n4. The standard molar Gibbs free energy of species $i$ is $G_i^\\circ(T) = H_i^\\circ(T) - T S_i^\\circ(T)$, where $H_i^\\circ(T) = R T \\, h_i/(RT)$ and $S_i^\\circ(T) = R \\, s_i/R$. For a reaction with stoichiometric coefficients $\\nu_i$ (products positive, reactants negative), the standard Gibbs free energy change is $\\Delta G^\\circ(T) = \\sum_i \\nu_i G_i^\\circ(T)$.\n5. To ensure numerical stability across wide temperature ranges, your program must compute and output the natural logarithm of the equilibrium constant, $\\ln K_{\\mathrm{eq}}(T)$, rather than $K_{\\mathrm{eq}}(T)$ itself. Under ideal-gas standard-state assumptions, $\\ln K_{\\mathrm{eq}}(T) = -\\Delta G^\\circ(T)/(R T)$.\n6. Implement the reaction $ \\mathrm{H_2} + \\tfrac{1}{2}\\mathrm{O_2} \\rightarrow \\mathrm{H_2O} $, with stoichiometric coefficients $\\nu_{\\mathrm{H_2O}} = +1$, $\\nu_{\\mathrm{H_2}} = -1$, $\\nu_{\\mathrm{O_2}} = -\\tfrac{1}{2}$.\n7. Use the following NASA seven-coefficient polynomials (valid in $T \\in [200,6000]$ K) for the species:\n\n   For $\\mathrm{H_2}$:\n   - Low-range ($T \\in [200,1000]$): $[a_1,\\dots,a_7] = [2.34433112\\times 10^{0},\\,7.98052075\\times 10^{-3},\\,-1.94781510\\times 10^{-5},\\,2.01572094\\times 10^{-8},\\,-7.37611761\\times 10^{-12},\\,-9.17935173\\times 10^{2},\\,6.83010238\\times 10^{0}]$,\n   - High-range ($T \\in (1000,6000]$): $[a_1,\\dots,a_7] = [3.33727920\\times 10^{0},\\,-4.94024731\\times 10^{-5},\\,4.99456778\\times 10^{-7},\\,-1.79566394\\times 10^{-10},\\,2.00255376\\times 10^{-14},\\,-9.50158922\\times 10^{2},\\,-3.20502331\\times 10^{0}]$.\n\n   For $\\mathrm{O_2}$:\n   - Low-range ($T \\in [200,1000]$): $[a_1,\\dots,a_7] = [3.78245636\\times 10^{0},\\,-2.99673416\\times 10^{-3},\\,9.84730201\\times 10^{-6},\\,-9.68129509\\times 10^{-9},\\,3.24372837\\times 10^{-12},\\,-1.06394356\\times 10^{3},\\,3.65767573\\times 10^{0}]$,\n   - High-range ($T \\in (1000,6000]$): $[a_1,\\dots,a_7] = [3.28253784\\times 10^{0},\\,1.48308754\\times 10^{-3},\\,-7.57966669\\times 10^{-7},\\,2.09470555\\times 10^{-10},\\,-2.16717794\\times 10^{-14},\\,-1.08845772\\times 10^{3},\\,5.45323129\\times 10^{0}]$.\n\n   For $\\mathrm{H_2O}$:\n   - Low-range ($T \\in [200,1000]$): $[a_1,\\dots,a_7] = [4.19864056\\times 10^{0},\\,-2.03643410\\times 10^{-3},\\,6.52040211\\times 10^{-6},\\,-5.48797062\\times 10^{-9},\\,1.77197817\\times 10^{-12},\\,-3.02937267\\times 10^{4},\\,-8.49032208\\times 10^{-1}]$,\n   - High-range ($T \\in (1000,6000]$): $[a_1,\\dots,a_7] = [3.03399249\\times 10^{0},\\,2.17691804\\times 10^{-3},\\,-1.64072518\\times 10^{-7},\\,-9.70419870\\times 10^{-11},\\,1.68200992\\times 10^{-14},\\,-3.00042971\\times 10^{4},\\,4.96677010\\times 10^{0}]$.\n\n8. The test suite consists of three temperatures to evaluate $\\ln K_{\\mathrm{eq}}(T)$:\n   - Case A: $T = 298.15$ kelvin,\n   - Case B (boundary): $T = 1000.00$ kelvin,\n   - Case C: $T = 2500.00$ kelvin.\n9. Output specification: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each result must be a floating-point number equal to $\\ln K_{\\mathrm{eq}}(T)$ for the corresponding test case in the order A, B, C. For example, the output format is $[\\ell_A,\\ell_B,\\ell_C]$. No other text should be printed.\n\nAll physical quantities must be handled in a scientifically consistent way with ideal-gas assumptions. Angles do not appear. The equilibrium constant must be reported as the natural logarithm (dimensionless). Ensure that your derivation in the solution starts from statistical mechanics definitions and connects to the NASA thermochemistry representation without relying on shortcut formulas beyond standard, well-validated relations.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. It presents a standard task in computational thermochemistry that connects fundamental principles of statistical mechanics to practical engineering models.\n\nThe task is to derive the means of computing the equilibrium constant $K_{\\mathrm{eq}}(T)$ for a gas-phase reaction from first principles, and then to implement this computation using the NASA seven-coefficient polynomial representation for thermodynamic properties. The derivation must establish the link between statistical mechanics, thermodynamics, and the principle of detailed balance.\n\n### 1. Statistical Mechanics Foundation of Thermodynamic Properties\n\nWe begin with the fundamental connection between the microscopic states of a system and its macroscopic thermodynamic properties, as described by statistical mechanics. For a system of non-interacting, indistinguishable particles in the canonical ensemble (constant number of particles $N$, volume $V$, and temperature $T$), the canonical partition function $Q$ is related to the molecular partition function $q$ by:\n$$\nQ = \\frac{q^N}{N!}\n$$\nThe molecular partition function $q$ is a sum over all possible energy states $\\epsilon_j$ of a single molecule:\n$$\nq = \\sum_j g_j e^{-\\epsilon_j / (k_B T)}\n$$\nwhere $k_B$ is the Boltzmann constant and $g_j$ is the degeneracy of the energy level $\\epsilon_j$. Under the Born-Oppenheimer approximation, the molecular energy can be separated into translational, rotational, vibrational, and electronic contributions. Consequently, the molecular partition function can be factored:\n$$\nq = q_{\\text{trans}} q_{\\text{rot}} q_{\\text{vib}} q_{\\text{elec}}\n$$\nKey thermodynamic properties can be derived from $Q$. The molar Gibbs free energy $G_m(T,p)$ is of primary interest. It is standardly derived from the Helmholtz free energy $A = -k_B T \\ln Q$. Using Stirling's approximation, $\\ln N! \\approx N \\ln N - N$, for a large number of particles like one mole ($N=N_A$, Avogadro's constant), and the ideal gas law $pV_m=RT$, where $R=N_A k_B$:\n$$\nG_m^\\circ(T) = H_m^\\circ(T) - T S_m^\\circ(T)\n$$\nThe standard molar enthalpy $H_m^\\circ(T)$ and standard molar entropy $S_m^\\circ(T)$ for an ideal gas can themselves be expressed in terms of the molecular partition function $q$. The partition functions are typically calculated with energies $\\epsilon_j$ relative to the ground-state energy $\\epsilon_0$. The absolute energy scale is established by incorporating the molar enthalpy of formation at $0\\,\\mathrm{K}$, $\\Delta_f H_m^\\circ(0)$. The full statistical mechanical expressions are:\n$$\nH_m^\\circ(T) = \\Delta_f H_m^\\circ(0) + RT^2 \\frac{d \\ln q}{dT} + RT\n$$\n$$\nS_m^\\circ(T) = R \\left( \\ln\\left(\\frac{q^\\circ}{N_A}\\right) + T \\frac{d \\ln q}{dT} + 1 \\right)\n$$\nHere, $q^\\circ$ signifies that the translational component of the partition function is evaluated at the standard-state pressure $p^\\circ$ by setting the volume to $V_m = RT/p^\\circ$.\n\nThe standard molar Gibbs free energy for a species $i$ is then:\n$$\nG_{i,m}^\\circ(T) = H_{i,m}^\\circ(T) - T S_{i,m}^\\circ(T)\n$$\nThis framework provides a rigorous path from the quantum mechanical energy levels of a molecule to its macroscopic thermodynamic properties.\n\n### 2. The NASA Polynomial Representation\n\nDirectly calculating the partition functions and their derivatives across a wide range of temperatures is computationally intensive. The NASA seven-coefficient polynomials provide an accurate and efficient empirical fit to thermodynamic data derived from these fundamental principles or from experimental measurements. For a given species $i$ and temperature $T$, these polynomials represent the dimensionless specific heat capacity at constant pressure $c_{p,i}/R$, the dimensionless specific enthalpy $h_i/(RT)$, and the dimensionless specific entropy $s_i/R$.\n\nThe standard molar enthalpy $H_i^\\circ(T)$ and entropy $S_i^\\circ(T)$ are recovered as:\n$$\nH_i^\\circ(T) = R T \\left( \\frac{h_i}{RT} \\right)\n$$\n$$\nS_i^\\circ(T) = R \\left( \\frac{s_i}{R} \\right)\n$$\nThe functional forms for $h_i/(RT)$ and $s_i/R$ are given by:\n$$\n\\frac{h_i}{RT} = a_{i,1} + a_{i,2} \\frac{T}{2} + a_{i,3} \\frac{T^2}{3} + a_{i,4} \\frac{T^3}{4} + a_{i,5} \\frac{T^4}{5} + \\frac{a_{i,6}}{T}\n$$\n$$\n\\frac{s_i}{R} = a_{i,1} \\ln T + a_{i,2} T + a_{i,3} \\frac{T^2}{2} + a_{i,4} \\frac{T^3}{3} + a_{i,5} \\frac{T^4}{4} + a_{i,7}\n$$\nThe set of coefficients $\\{a_{i,1}, \\dots, a_{i,7}\\}$ is specific to each species $i$ and to a particular temperature range.\n\n### 3. Reaction Gibbs Free Energy and the Equilibrium Constant\n\nFor a chemical reaction represented by $\\sum_i \\nu_i M_i = 0$, where $\\nu_i$ are the stoichiometric coefficients (positive for products, negative for reactants) and $M_i$ are the chemical species, the standard Gibbs free energy change of reaction, $\\Delta_r G^\\circ(T)$, is the sum of the standard Gibbs free energies of the products minus those of the reactants, weighted by their stoichiometry:\n$$\n\\Delta_r G^\\circ(T) = \\sum_i \\nu_i G_i^\\circ(T)\n$$\nThe relationship between the standard Gibbs free energy change and the thermodynamic equilibrium constant $K_{\\mathrm{eq}}(T)$ is a cornerstone of chemical thermodynamics:\n$$\n\\Delta_r G^\\circ(T) = -RT \\ln K_{\\mathrm{eq}}(T)\n$$\nFor gas-phase reactions, $K_{\\mathrm{eq}}(T)$ is equivalent to $K_p(T)$, the equilibrium constant expressed in terms of partial pressures relative to the standard-state pressure $p^\\circ$.\n\nTo ensure numerical stability and for convenient computation, we work with the natural logarithm of the equilibrium constant:\n$$\n\\ln K_{\\mathrm{eq}}(T) = -\\frac{\\Delta_r G^\\circ(T)}{RT}\n$$\nSubstituting the expressions for $G_i^\\circ(T)$, $H_i^\\circ(T)$, and $S_i^\\circ(T)$:\n$$\n\\ln K_{\\mathrm{eq}}(T) = -\\frac{1}{RT} \\sum_i \\nu_i \\left[ H_i^\\circ(T) - T S_i^\\circ(T) \\right] = -\\sum_i \\nu_i \\left[ \\frac{H_i^\\circ(T)}{RT} - \\frac{S_i^\\circ(T)}{R} \\right]\n$$\nUsing the NASA polynomial dimensionless forms:\n$$\n\\ln K_{\\mathrm{eq}}(T) = -\\sum_i \\nu_i \\left( \\frac{h_i}{RT} - \\frac{s_i}{R} \\right) = \\sum_i \\nu_i \\left( \\frac{s_i}{R} - \\frac{h_i}{RT} \\right)\n$$\n\n### 4. Connection to Microscopic Reversibility and Detailed Balance\n\nThe principle of microscopic reversibility states that at the molecular level, any elementary process and its reverse process occur with equal probability, following time-reversed paths. At equilibrium, the principle of detailed balance emerges as a consequence: the rate of every elementary forward reaction is exactly equal to the rate of its corresponding reverse reaction.\n\nFor an elementary reaction $A \\rightleftharpoons B$, detailed balance implies $k_f [A]_{\\text{eq}} = k_r [B]_{\\text{eq}}$, where $k_f$ and $k_r$ are the forward and reverse rate constants. This rearranges to:\n$$\n\\frac{k_f}{k_r} = \\frac{[B]_{\\text{eq}}}{[A]_{\\text{eq}}} = K_c(T)\n$$\nwhere $K_c(T)$ is the equilibrium constant in terms of concentrations. The concentration-based constant $K_c$ is related to the pressure-based constant $K_p$ (which we denote $K_{\\mathrm{eq}}$) by $K_p = K_c (RT/p^\\circ)^{\\Delta\\nu}$, where $\\Delta\\nu = \\sum_i \\nu_i$.\n\nThe value of $K_{\\mathrm{eq}}(T)$ derived from thermodynamic data (the NASA polynomials, which are themselves rooted in statistical mechanics) provides a rigid constraint on the ratio of the kinetic rate constants. Any valid chemical kinetic mechanism must have rate constants that satisfy this thermodynamic constraint for every elementary reaction in the mechanism. Our derivation of $\\ln K_{\\mathrm{eq}}(T)$ from first principles thus provides the necessary link to ensure that kinetic models are consistent with the second law of thermodynamics and the principle of detailed balance.\n\n### 5. Computational Algorithm\n\nThe final algorithm for computing $\\ln K_{\\mathrm{eq}}(T)$ for the reaction $\\mathrm{H_2} + \\frac{1}{2}\\mathrm{O_2} \\rightarrow \\mathrm{H_2O}$ is as follows:\n\n1.  For a given temperature $T$, select the appropriate set of seven coefficients $\\{a_1, \\dots, a_7\\}$ for each species ($\\mathrm{H_2}$, $\\mathrm{O_2}$, $\\mathrm{H_2O}$), based on whether $T$ falls in the low-temperature range ($T \\le 1000\\,\\mathrm{K}$) or the high-temperature range ($T > 1000\\,\\mathrm{K}$).\n\n2.  For each species $i$, calculate the dimensionless quantities $h_i/(RT)$ and $s_i/R$ using the NASA formulas.\n\n3.  Calculate the change in the dimensionless entropy and enthalpy for the reaction:\n    $$ \\Delta \\left(\\frac{s}{R}\\right) = \\sum_i \\nu_i \\frac{s_i}{R} = (1)\\frac{s_{\\mathrm{H_2O}}}{R} - (1)\\frac{s_{\\mathrm{H_2}}}{R} - (\\tfrac{1}{2})\\frac{s_{\\mathrm{O_2}}}{R} $$\n    $$ \\Delta \\left(\\frac{h}{RT}\\right) = \\sum_i \\nu_i \\frac{h_i}{RT} = (1)\\frac{h_{\\mathrm{H_2O}}}{RT} - (1)\\frac{h_{\\mathrm{H_2}}}{RT} - (\\tfrac{1}{2})\\frac{h_{\\mathrm{O_2}}}{RT} $$\n\n4.  Compute the natural logarithm of the equilibrium constant using the derived relationship:\n    $$ \\ln K_{\\mathrm{eq}}(T) = \\Delta \\left(\\frac{s}{R}\\right) - \\Delta \\left(\\frac{h}{RT}\\right) $$\nThis procedure will be implemented for the specified test temperatures.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes the equilibrium constant for the H2/O2 reaction\n    using NASA seven-coefficient polynomials.\n    \"\"\"\n\n    # Define constants\n    R = 8.31446261815324  # J/mol/K\n\n    # Stoichiometric coefficients\n    stoich_coeffs = {\n        \"H2\": -1.0,\n        \"O2\": -0.5,\n        \"H2O\": 1.0,\n    }\n\n    # NASA 7-coefficient polynomial data for the species\n    nasa_data = {\n        \"H2\": {\n            \"low_coeffs\": np.array([\n                2.34433112e+00, 7.98052075e-03, -1.94781510e-05,\n                2.01572094e-08, -7.37611761e-12, -9.17935173e+02,\n                6.83010238e+00\n            ]),\n            \"high_coeffs\": np.array([\n                3.33727920e+00, -4.94024731e-05, 4.99456778e-07,\n                -1.79566394e-10, 2.00255376e-14, -9.50158922e+02,\n                -3.20502331e+00\n            ]),\n        },\n        \"O2\": {\n            \"low_coeffs\": np.array([\n                3.78245636e+00, -2.99673416e-03, 9.84730201e-06,\n                -9.68129509e-09, 3.24372837e-12, -1.06394356e+03,\n                3.65767573e+00\n            ]),\n            \"high_coeffs\": np.array([\n                3.28253784e+00, 1.48308754e-03, -7.57966669e-07,\n                2.09470555e-10, -2.16717794e-14, -1.08845772e+03,\n                5.45323129e+00\n            ]),\n        },\n        \"H2O\": {\n            \"low_coeffs\": np.array([\n                4.19864056e+00, -2.03643410e-03, 6.52040211e-06,\n                -5.48797062e-09, 1.77197817e-12, -3.02937267e+04,\n                -8.49032208e-01\n            ]),\n            \"high_coeffs\": np.array([\n                3.03399249e+00, 2.17691804e-03, -1.64072518e-07,\n                -9.70419870e-11, 1.68200992e-14, -3.00042971e+04,\n                4.96677010e+00\n            ]),\n        },\n    }\n\n    def get_thermo_properties(T, a):\n        \"\"\"\n        Calculates h/(RT) and s/R for a species at temperature T using its\n        7 coefficients.\n\n        Args:\n            T (float): Temperature in Kelvin.\n            a (np.ndarray): Array of 7 NASA coefficients.\n\n        Returns:\n            tuple: A tuple containing (h_over_RT, s_over_R).\n        \"\"\"\n        # h/(RT) = a1 + a2*T/2 + a3*T^2/3 + a4*T^3/4 + a5*T^4/5 + a6/T\n        h_over_RT = (\n            a[0] +\n            a[1] * T / 2.0 +\n            a[2] * T**2 / 3.0 +\n            a[3] * T**3 / 4.0 +\n            a[4] * T**4 / 5.0 +\n            a[5] / T\n        )\n\n        # s/R = a1*ln(T) + a2*T + a3*T^2/2 + a4*T^3/3 + a5*T^4/4 + a7\n        s_over_R = (\n            a[0] * np.log(T) +\n            a[1] * T +\n            a[2] * T**2 / 2.0 +\n            a[3] * T**3 / 3.0 +\n            a[4] * T**4 / 4.0 +\n            a[6]\n        )\n        \n        return h_over_RT, s_over_R\n\n    def calculate_ln_K_eq(T):\n        \"\"\"\n        Calculates the natural logarithm of the equilibrium constant at a\n        given temperature T.\n        \"\"\"\n        delta_h_over_RT = 0.0\n        delta_s_over_R = 0.0\n\n        for species, nu in stoich_coeffs.items():\n            species_data = nasa_data[species]\n            \n            # Select coefficients based on temperature range\n            # Low range: [200, 1000], High range: (1000, 6000]\n            if T <= 1000.0:\n                coeffs = species_data[\"low_coeffs\"]\n            else:\n                coeffs = species_data[\"high_coeffs\"]\n\n            h_over_RT, s_over_R = get_thermo_properties(T, coeffs)\n\n            delta_h_over_RT += nu * h_over_RT\n            delta_s_over_R += nu * s_over_R\n\n        # ln(K_eq) = - (delta_G_circ / RT)\n        # delta_G_circ / RT = delta_H_circ / RT - delta_S_circ / R\n        delta_g_over_RT = delta_h_over_RT - delta_s_over_R\n        \n        ln_K_eq = -delta_g_over_RT\n        return ln_K_eq\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        298.15,   # Case A\n        1000.00,  # Case B (boundary)\n        2500.00   # Case C\n    ]\n\n    results = []\n    for T in test_cases:\n        result = calculate_ln_K_eq(T)\n        results.append(f\"{result:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "For a complex reaction network with multiple pathways, ensuring local detailed balance for each reaction is not sufficient; the entire network must be globally consistent. The Wegscheider conditions provide a necessary set of algebraic constraints on the equilibrium constants for any closed loop within the reaction graph. This exercise guides you through developing a graph-based algorithm to detect violations of these conditions, offering a powerful *a priori* check on the thermodynamic integrity of a proposed kinetic mechanism. ",
            "id": "4039343",
            "problem": "Consider a finite network of reversible elementary reactions under the framework of mass-action kinetics relevant to computational combustion. Let the species set be indexed by $i \\in \\{1,\\dots,N\\}$ and the reversible reaction set be indexed by $j \\in \\{1,\\dots,M\\}$. Each reaction $j$ has a forward rate constant $k_j^+ > 0$ and a reverse rate constant $k_j^- > 0$, both expressed in consistent physical units appropriate for the reaction order. For the unimolecular interconversion networks considered in this problem, take all rate constants $k_j^+$ and $k_j^-$ in $\\mathrm{s^{-1}}$ so that the ratio $K_j = k_j^+ / k_j^-$ is dimensionless.\n\nMicroscopic reversibility implies that at thermodynamic equilibrium, detailed balance holds at the reaction level. The Wegscheider conditions are algebraic constraints stating that in any closed reaction loop, the product of the equilibrium constants equals $1$. Equivalently, the sum of the logarithms of the equilibrium constants taken with appropriate orientation along any cycle is $0$.\n\nYour task is to design and implement a network-level test that detects cycles violating Wegscheider conditions and to use this test to illustrate the equivalence between these algebraic constraints and enforcing detailed balance in closed reaction loops. Restrict attention to unimolecular interconversion networks where reactions have the form $X_u \\rightleftharpoons X_v$ with a single reactant and a single product, so the stoichiometric change vector for the forward direction is $-\\mathbf{e}_u + \\mathbf{e}_v$, where $\\mathbf{e}_u$ is the $u$-th canonical basis vector.\n\nDefinitions to use as the fundamental base:\n- Mass-action kinetics: for a reversible reaction $j$ between species $u$ and $v$, the forward and reverse rates are $r_j^+ = k_j^+ c_u$ and $r_j^- = k_j^- c_v$, respectively, where $c_u$ and $c_v$ are molar concentrations in $\\mathrm{mol/m^3}$.\n- Detailed balance: at equilibrium, for every reaction $j$, $r_j^+ = r_j^-$.\n- Equilibrium constant for an elementary unimolecular interconversion: $K_j = \\dfrac{k_j^+}{k_j^-}$, which is dimensionless when both rate constants are in $\\mathrm{s^{-1}}$.\n\nNetwork representation and cycle test:\n- Represent the species as nodes in an undirected graph, and each reversible reaction $j$ as an undirected edge $\\{u,v\\}$ with a stored forward orientation $(u \\to v)$ and its associated $K_j = k_j^+ / k_j^-$.\n- Extract a fundamental cycle basis of the graph using any correct spanning-tree method such as Breadth-First Search (BFS) to produce the set of cycles formed by adding each non-tree edge (chord) to the unique path between its endpoints in the spanning tree.\n- For each cycle, fix an orientation around the loop and compute the signed sum of the logarithms of the equilibrium constants,\n$$\n\\Delta = \\sum_{j \\in \\text{cycle}} \\sigma_j \\ln K_j,\n$$\nwhere $\\sigma_j = +1$ if the edge is traversed in its stored forward orientation and $\\sigma_j = -1$ if it is traversed in the reverse orientation.\n- A cycle violates Wegscheider conditions if $|\\Delta|$ exceeds a specified tolerance $\\tau > 0$ (dimensionless); equivalently, $\\left|\\prod_{j \\in \\text{cycle}} K_j^{\\sigma_j} - 1\\right|$ is nonzero beyond numerical tolerance.\n\nImplement a program that, for a given test suite of networks, computes the maximum absolute cycle log-sum $E = \\max_{\\text{cycles}} |\\Delta|$ and returns a boolean for each network indicating whether any cycle violates the Wegscheider conditions, that is, whether $E > \\tau$.\n\nAngle units are not applicable. All rate constants must be provided in $\\mathrm{s^{-1}}$. All logarithms are natural logarithms. Tolerance $\\tau$ is dimensionless.\n\nTest suite:\n- Case $1$ (happy path, single triangle cycle, no violation): $N = 3$ with edges $(0,1)$, $(1,2)$, $(2,0)$ and rate constants\n  - $(0,1)$: $k^+ = 2.0\\,\\mathrm{s^{-1}}$, $k^- = 1.0\\,\\mathrm{s^{-1}}$ so $K = 2$;\n  - $(1,2)$: $k^+ = 3.0\\,\\mathrm{s^{-1}}$, $k^- = 1.0\\,\\mathrm{s^{-1}}$ so $K = 3$;\n  - $(2,0)$: $k^+ = 1.0\\,\\mathrm{s^{-1}}$, $k^- = 6.0\\,\\mathrm{s^{-1}}$ so $K = \\dfrac{1}{6}$;\n  Use $\\tau = 10^{-9}$.\n- Case $2$ (single triangle cycle, violation): $N = 3$ with edges $(0,1)$, $(1,2)$, $(2,0)$ and rate constants\n  - $(0,1)$: $k^+ = 2.0$, $k^- = 1.0$ so $K = 2$;\n  - $(1,2)$: $k^+ = 3.0$, $k^- = 1.0$ so $K = 3$;\n  - $(2,0)$: $k^+ = 1.0$, $k^- = 4.0$ so $K = \\dfrac{1}{4}$;\n  Use $\\tau = 10^{-9}$.\n- Case $3$ (single triangle cycle, near-boundary non-violation due to tolerance): $N = 3$ with edges $(0,1)$, $(1,2)$, $(2,0)$ and rate constants\n  - $(0,1)$: $k^+ = 2.0$, $k^- = 1.0$ so $K = 2$;\n  - $(1,2)$: $k^+ = 3.0$, $k^- = 1.0$ so $K = 3$;\n  - $(2,0)$: $k^+ = 1.0$, $k^- = \\dfrac{6.0}{1+10^{-10}}$ so $K = \\dfrac{1+10^{-10}}{6}$;\n  Use $\\tau = 10^{-9}$.\n- Case $4$ (no cycles): $N = 2$ with a single edge $(0,1)$ and rate constants\n  - $(0,1)$: $k^+ = 5.0$, $k^- = 2.5$ so $K = 2$;\n  Use $\\tau = 10^{-9}$.\n- Case $5$ (multiple cycles, one violating): $N = 4$ with edges $(0,1)$, $(1,2)$, $(2,3)$, $(3,0)$, $(0,2)$ and rate constants\n  - $(0,1)$: $k^+ = 2.0$, $k^- = 1.0$ so $K = 2$;\n  - $(1,2)$: $k^+ = 2.0$, $k^- = 1.0$ so $K = 2$;\n  - $(2,3)$: $k^+ = 0.5$, $k^- = 1.0$ so $K = \\dfrac{1}{2}$;\n  - $(3,0)$: $k^+ = 0.5$, $k^- = 1.0$ so $K = \\dfrac{1}{2}$;\n  - $(0,2)$: $k^+ = 3.0$, $k^- = 1.0$ so $K = 3$;\n  Use $\\tau = 10^{-9}$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for the five cases above, in order. Each entry must be a boolean indicating whether any cycle violates the Wegscheider conditions for that case, that is, whether $E > \\tau$. For example, a valid output looks like $[{\\texttt{False}},{\\texttt{True}},\\dots]$.",
            "solution": "The problem requires the design and implementation of a computational test to verify the thermodynamic consistency of a network of reversible unimolecular reactions. This property, embodied by the Wegscheider conditions, is a direct consequence of the principle of microscopic reversibility and the resulting detailed balance that must hold at thermodynamic equilibrium.\n\nThe fundamental principle is that for a system at equilibrium, every elementary process must be in equilibrium with its reverse process. This is the principle of detailed balance. For a unimolecular reaction $X_u \\rightleftharpoons X_v$, with forward rate constant $k_{uv}^+$ and reverse rate constant $k_{vu}^-$, the forward rate is $r^+ = k_{uv}^+ c_u$ and the reverse rate is $r^- = k_{vu}^- c_v$, where $c_u$ and $c_v$ are the concentrations of species $X_u$ and $X_v$, respectively. At equilibrium, the concentrations are $c_u^{\\mathrm{eq}}$ and $c_v^{\\mathrm{eq}}$, and detailed balance requires $r^+ = r^-$. This gives $k_{uv}^+ c_u^{\\mathrm{eq}} = k_{vu}^- c_v^{\\mathrm{eq}}$. The ratio of equilibrium concentrations is thus related to the rate constants through the equilibrium constant $K_{uv}$:\n$$\n\\frac{c_v^{\\mathrm{eq}}}{c_u^{\\mathrm{eq}}} = \\frac{k_{uv}^+}{k_{vu}^-} = K_{uv}\n$$\nwhere for the unimolecular reactions considered, with rate constants in units of $\\mathrm{s}^{-1}$, $K_{uv}$ is dimensionless.\n\nNow, consider a closed cycle of reactions, for instance, $X_1 \\rightleftharpoons X_2 \\rightleftharpoons \\dots \\rightleftharpoons X_L \\rightleftharpoons X_1$. At equilibrium, the following relations must hold simultaneously:\n$$\n\\frac{c_2^{\\mathrm{eq}}}{c_1^{\\mathrm{eq}}} = K_{12}, \\quad \\frac{c_3^{\\mathrm{eq}}}{c_2^{\\mathrm{eq}}} = K_{23}, \\quad \\dots, \\quad \\frac{c_1^{\\mathrm{eq}}}{c_L^{\\mathrm{eq}}} = K_{L1}\n$$\nMultiplying these equations together yields:\n$$\n\\left(\\frac{c_2^{\\mathrm{eq}}}{c_1^{\\mathrm{eq}}}\\right) \\left(\\frac{c_3^{\\mathrm{eq}}}{c_2^{\\mathrm{eq}}}\\right) \\dots \\left(\\frac{c_1^{\\mathrm{eq}}}{c_L^{\\mathrm{eq}}}\\right) = K_{12} K_{23} \\dots K_{L1}\n$$\nThe left-hand side is identically equal to $1$. Therefore, the product of the equilibrium constants around any closed loop must also equal $1$. This is the Wegscheider condition. Taking the natural logarithm of this product gives the equivalent additive form:\n$$\n\\sum_{j \\in \\text{cycle}} \\sigma_j \\ln K_j = 0\n$$\nwhere $\\sigma_j = +1$ or $\\sigma_j = -1$ depending on the direction of traversal of reaction $j$ relative to its defined forward direction. A network that satisfies this condition for all possible cycles is thermodynamically consistent.\n\nTo implement a test for this condition, we can model the reaction network as a graph where species are nodes and reactions are edges. The problem of checking all cycles can be simplified by recognizing that any cycle in the graph can be constructed from a linear combination (symmetric difference) of a set of fundamental cycles. Therefore, it is sufficient to verify the Wegscheider condition for a fundamental cycle basis.\n\nThe algorithm proceeds as follows:\n\n$1$. **Graph Representation**: The $N$ species are represented as nodes $\\{0, 1, \\dots, N-1\\}$. Each reversible reaction between species $u$ and $v$ is an edge. We store the natural logarithm of the equilibrium constant for a defined forward direction, e.g., for $u \\to v$, we store $\\ln K_{uv}$. The graph is treated as undirected for connectivity purposes but the directional information of the equilibrium constant is preserved.\n\n$2$. **Decomposition and Spanning Tree Construction**: A reaction network may consist of multiple disconnected components. The algorithm must analyze each component independently. For each connected component, we construct a spanning tree using a graph traversal algorithm such as Breadth-First Search (BFS). This partitions the edges of the component into tree edges and non-tree edges (also known as chords).\n\n$3$. **Fundamental Cycle Identification**: Each chord, when added to the spanning tree, creates exactly one fundamental cycle. This cycle consists of the chord itself and the unique path in the spanning tree connecting the chord's endpoints.\n\n$4$. **Thermodynamic Potential Calculation**: A highly efficient way to calculate the log-sum $\\Delta$ for each fundamental cycle is to define a \"thermodynamic potential\" $\\phi_i$ for each node $i$. Within a connected component, we can arbitrarily set the potential of a reference node (the root of the BFS tree) to zero: $\\phi_{\\text{root}} = 0$. The potential of any other node $u$ is then defined as the sum of the signed $\\ln K_j$ values along the unique path in the spanning tree from the root to $u$:\n$$\n\\phi_u = \\sum_{j \\in \\text{path}(\\text{root} \\to u)} \\sigma_j \\ln K_j\n$$\nThese potentials can be computed for all nodes in one pass during the BFS traversal that builds the spanning tree. If the parent of node $v$ is $u$, then $\\phi_v = \\phi_u + \\ln K_{uv}$, assuming the forward direction is $u \\to v$.\n\n$5$. **Cycle Violation Test**: For each chord connecting nodes $u$ and $v$ with a forward equilibrium constant $K_{uv}$, the log-sum of the corresponding fundamental cycle is given by the expression:\n$$\n\\Delta = \\ln K_{uv} - (\\phi_v - \\phi_u)\n$$\nHere, $(\\phi_v - \\phi_u)$ represents the sum of log-constants along the tree path from $u$ to $v$. The equation thus computes the log-sum around the cycle closed by the chord $(u,v)$. The Wegscheider condition requires $\\Delta = 0$. We test this numerically by checking if $|\\Delta| > \\tau$, where $\\tau$ is a small positive tolerance.\n\n$6$. **Final Verdict**: The algorithm computes $|\\Delta|$ for every fundamental cycle in the graph. The maximum absolute value, $E = \\max_{\\text{cycles}} |\\Delta|$, is determined. The network is declared to violate the Wegscheider conditions if $E > \\tau$. For a network with no cycles (a tree or forest), $E$ is trivially $0$.\n\nThis procedure provides a rigorous and computationally efficient method to test any reaction network for thermodynamic consistency, grounding the abstract algebraic conditions in a concrete graph-theoretic algorithm. The implementation will process the provided test cases according to this logic.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom collections import deque\n\ndef solve():\n    \"\"\"\n    Solves the problem by testing a series of reaction networks for violations\n    of the Wegscheider conditions.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Happy path, single triangle cycle, no violation\n        {\n            \"N\": 3,\n            \"edges\": [\n                (0, 1, 2.0, 1.0),  # K = 2.0\n                (1, 2, 3.0, 1.0),  # K = 3.0\n                (2, 0, 1.0, 6.0),  # K = 1/6\n            ],\n            \"tau\": 1e-9,\n        },\n        # Case 2: Single triangle cycle, violation\n        {\n            \"N\": 3,\n            \"edges\": [\n                (0, 1, 2.0, 1.0),  # K = 2.0\n                (1, 2, 3.0, 1.0),  # K = 3.0\n                (2, 0, 1.0, 4.0),  # K = 1/4\n            ],\n            \"tau\": 1e-9,\n        },\n        # Case 3: Near-boundary non-violation due to tolerance\n        {\n            \"N\": 3,\n            \"edges\": [\n                (0, 1, 2.0, 1.0),             # K = 2.0\n                (1, 2, 3.0, 1.0),             # K = 3.0\n                (2, 0, 1.0, 6.0 / (1 + 1e-10)), # K = (1+1e-10)/6\n            ],\n            \"tau\": 1e-9,\n        },\n        # Case 4: No cycles\n        {\n            \"N\": 2,\n            \"edges\": [\n                (0, 1, 5.0, 2.5),  # K = 2.0\n            ],\n            \"tau\": 1e-9,\n        },\n        # Case 5: Multiple cycles, one violating\n        {\n            \"N\": 4,\n            \"edges\": [\n                (0, 1, 2.0, 1.0),  # K = 2.0\n                (1, 2, 2.0, 1.0),  # K = 2.0\n                (2, 3, 0.5, 1.0),  # K = 0.5\n                (3, 0, 0.5, 1.0),  # K = 0.5\n                (0, 2, 3.0, 1.0),  # K = 3.0\n            ],\n            \"tau\": 1e-9,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        N = case[\"N\"]\n        edges = case[\"edges\"]\n        tau = case[\"tau\"]\n\n        # Build graph representation\n        adj = {i: [] for i in range(N)}\n        log_K_map = {}\n        for u, v, k_plus, k_minus in edges:\n            adj[u].append(v)\n            adj[v].append(u)\n            log_K_map[(u, v)] = np.log(k_plus / k_minus)\n\n        visited = [False] * N\n        max_abs_delta = 0.0\n\n        # Iterate through all nodes to handle disconnected components\n        for i in range(N):\n            if not visited[i]:\n                # New connected component found\n                root = i\n                potentials = {}\n                parent = {}\n                q = deque([(root, None)])  # (node, parent_node)\n                \n                visited[root] = True\n                potentials[root] = 0.0\n                parent[root] = None\n                \n                # BFS to build spanning tree and find non-tree edges (chords)\n                # We use a secondary queue to process nodes level by level\n                # and correctly identify chords\n                bfs_q = deque([root])\n                chords = []\n\n                while bfs_q:\n                    u = bfs_q.popleft()\n                    for v in adj[u]:\n                        if v == parent[u]:\n                            continue # Skip edge leading back to parent in the tree\n                        \n                        if not visited[v]: # Tree edge\n                            visited[v] = True\n                            parent[v] = u\n                            bfs_q.append(v)\n\n                            # Calculate potential of v\n                            if (u, v) in log_K_map:\n                                logK_uv = log_K_map[(u, v)]\n                            else: # The edge must be stored in reverse\n                                logK_uv = -log_K_map.get((v, u), 0.0)\n                            potentials[v] = potentials[u] + logK_uv\n                        else: # Non-tree edge (chord)\n                            # Ensure we only add each chord once, e.g., by sorting\n                            if u < v:\n                                chords.append((u, v))\n                \n                # Calculate cycle log-sums for this component\n                for u, v in chords:\n                    if (u, v) in log_K_map:\n                        logK_uv = log_K_map[(u, v)]\n                    else:\n                        logK_uv = -log_K_map.get((v, u), 0.0)\n                    \n                    # Cycle sum is based on potentials derived from the spanning tree\n                    delta = logK_uv - (potentials[v] - potentials[u])\n                    max_abs_delta = max(max_abs_delta, abs(delta))\n\n        # Check if the max violation exceeds the tolerance\n        results.append(max_abs_delta > tau)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having established how to calculate equilibrium constants and verify the structural consistency of a reaction network, we now explore the dynamic consequences of detailed balance. This practice demonstrates numerically that a thermodynamically consistent kinetic model correctly identifies the equilibrium state as a stable stationary point. By simulating a system initialized at equilibrium, you will observe how a model that violates detailed balance leads to an unphysical drift, underscoring the principle's vital role in ensuring the long-term stability and predictive accuracy of combustion simulations. ",
            "id": "4039319",
            "problem": "Consider a minimal reversible reaction mechanism relevant to computational combustion that exhibits microscopic reversibility and the Law of Detailed Balance. The mechanism consists of three species, $A$, $B$, and $C$, and two elementary reversible reactions:\n- Isomerization: $A \\rightleftharpoons B$,\n- Dimerization: $A + B \\rightleftharpoons C$.\n\nAssume an isothermal, isochoric, well-mixed ideal solution. Use activities equal to dimensionless concentrations $c_A$, $c_B$, and $c_C$ scaled by a standard state of $1\\,\\mathrm{mol/L}$ so that the activity of species $i$ is $a_i = c_i$ (dimensionless). Let the standard chemical potentials be $\\mu_A^\\circ$, $\\mu_B^\\circ$, and $\\mu_C^\\circ$ (units $\\mathrm{J/mol}$). The absolute temperature is $T$ (units $\\mathrm{K}$), and the universal gas constant is $R = 8.314\\,\\mathrm{J/(mol\\,K)}$.\n\nFundamental base:\n- For an ideal mixture, the chemical potential is $\\mu_i = \\mu_i^\\circ + RT \\ln c_i$.\n- Equilibrium arises from minimizing the total Gibbs free energy subject to stoichiometric element conservation constraints, yielding equalities of chemical potentials consistent with the stoichiometry for each elementary step.\n- The Law of Detailed Balance states that at the equilibrium composition $c^\\star = (c_A^\\star, c_B^\\star, c_C^\\star)$, each elementary reaction has equal forward and reverse rates: $r_{f,i}(c^\\star) = r_{r,i}(c^\\star)$.\n- The Mass Action Law for elementary reactions gives forward and reverse rates $r_{f,1} = k_{1f} c_A c_B$, $r_{r,1} = k_{1r} c_C$ for $A+B \\rightleftharpoons C$ and $r_{f,2} = k_{2f} c_A$, $r_{r,2} = k_{2r} c_B$ for $A \\rightleftharpoons B$, where $k_{1f}$, $k_{1r}$, $k_{2f}$, and $k_{2r}$ are rate constants with units of $\\mathrm{s^{-1}}$ under the chosen dimensionless activity convention.\n\nDerivation requirements:\n1. Starting from the ideal mixture chemical potentials and stoichiometry, derive the equilibrium relations among concentrations:\n   - For isomerization, show that $\\mu_A = \\mu_B$ at equilibrium implies $c_B^\\star = K_1 c_A^\\star$, where $K_1 = \\exp\\!\\big(-(\\mu_B^\\circ - \\mu_A^\\circ)/(RT)\\big)$.\n   - For dimerization, show that $\\mu_C = \\mu_A + \\mu_B$ at equilibrium implies $c_C^\\star = K_2 c_A^\\star c_B^\\star$, where $K_2 = \\exp\\!\\big(-(\\mu_C^\\circ - \\mu_A^\\circ - \\mu_B^\\circ)/(RT)\\big)$.\n2. Impose the element conservation constraint consistent with stoichiometry: species $A$ and $B$ each contain one unit of a conserved composition vector and species $C$ contains two units. Thus the scalar conserved total is $N = c_A + c_B + 2 c_C$ (dimensionless). Use the equilibrium relations to obtain a quadratic equation for $c_A^\\star$ and solve for its positive root, then compute $c_B^\\star$ and $c_C^\\star$.\n3. Derive the Ordinary Differential Equations (ODEs) for the species concentrations from stoichiometry and the Mass Action Law:\n   $$\\frac{dc_A}{dt} = -r_{f,1} + r_{r,1} - r_{f,2} + r_{r,2},\\quad \\frac{dc_B}{dt} = -r_{f,1} + r_{r,1} + r_{f,2} - r_{r,2},\\quad \\frac{dc_C}{dt} = r_{f,1} - r_{r,1}.$$\n4. Construct two kinetic parameterizations:\n   - Detailed balance enforced: choose $k_{2f}$ and $k_{2r}$ such that $k_{2f}/k_{2r} = K_1$, and choose $k_{1f}$ and $k_{1r}$ such that $k_{1f}/k_{1r} = K_2$.\n   - Detailed balance broken: perturb the forward rate constants by a factor $(1+\\delta_2)$ for isomerization and $(1-\\delta_1)$ for dimerization so that $k_{2f}/k_{2r} \\neq K_1$ and $k_{1f}/k_{1r} \\neq K_2$.\n5. Initialize the mechanism at the thermodynamic equilibrium composition $c^\\star$ derived in step 2, then integrate the ODEs over a specified finite time horizon. Compute the maximum absolute deviation from equilibrium:\n   $$\\Delta_{\\max} = \\max_{t \\in [0,t_{\\mathrm{end}}]} \\left\\|c(t) - c^\\star\\right\\|_{\\infty} = \\max_{t \\in [0,t_{\\mathrm{end}}]} \\max\\left\\{\\,|c_A(t)-c_A^\\star|,\\,|c_B(t)-c_B^\\star|,\\,|c_C(t)-c_C^\\star|\\,\\right\\}.$$\n6. Demonstrate numerically that when detailed balance is enforced, $\\Delta_{\\max}$ remains below a tight tolerance, whereas when detailed balance is broken, $\\Delta_{\\max}$ exceeds a looser tolerance due to drift from equilibrium.\n\nUnits:\n- $\\mu_i^\\circ$ must be provided in $\\mathrm{J/mol}$.\n- $T$ must be provided in $\\mathrm{K}$.\n- Time must be in $\\mathrm{s}$.\n- Concentrations $c_i$ are dimensionless activities relative to the standard state $1\\,\\mathrm{mol/L}$.\n\nTest suite and required output:\nImplement a program that, for each test case below, performs the computations in steps 1â€“5 and returns a boolean indicating success if and only if the following two conditions hold simultaneously: (i) with detailed balance enforced, $\\Delta_{\\max} \\leq \\text{tol}_{\\mathrm{DB}}$, and (ii) with detailed balance broken, $\\Delta_{\\max} > \\text{tol}_{\\mathrm{nonDB}}$.\n\nProvide the following test cases, each as one set of parameters:\n- Case 1 (happy path, moderate kinetics):\n  - $\\mu_A^\\circ = 0\\,\\mathrm{J/mol}$, $\\mu_B^\\circ = 2965\\,\\mathrm{J/mol}$, $\\mu_C^\\circ = 16356\\,\\mathrm{J/mol}$,\n  - $T = 1000\\,\\mathrm{K}$,\n  - $N = 2.0$ (dimensionless),\n  - $k_{2r} = 0.5\\,\\mathrm{s^{-1}}$, $k_{1r} = 0.2\\,\\mathrm{s^{-1}}$,\n  - $\\delta_2 = 0.3$, $\\delta_1 = 0.3$,\n  - $t_{\\mathrm{end}} = 40\\,\\mathrm{s}$,\n  - $\\text{tol}_{\\mathrm{DB}} = 1\\times 10^{-9}$, $\\text{tol}_{\\mathrm{nonDB}} = 1\\times 10^{-6}$.\n- Case 2 (edge case, near-degenerate isomerization and slow kinetics):\n  - $\\mu_A^\\circ = 0\\,\\mathrm{J/mol}$, $\\mu_B^\\circ = 341\\,\\mathrm{J/mol}$, $\\mu_C^\\circ = 46313\\,\\mathrm{J/mol}$,\n  - $T = 800\\,\\mathrm{K}$,\n  - $N = 1.0$ (dimensionless),\n  - $k_{2r} = 5\\times 10^{-4}\\,\\mathrm{s^{-1}}$, $k_{1r} = 1\\times 10^{-4}\\,\\mathrm{s^{-1}}$,\n  - $\\delta_2 = 0.5$, $\\delta_1 = 0.5$,\n  - $t_{\\mathrm{end}} = 20000\\,\\mathrm{s}$,\n  - $\\text{tol}_{\\mathrm{DB}} = 1\\times 10^{-9}$, $\\text{tol}_{\\mathrm{nonDB}} = 1\\times 10^{-7}$.\n- Case 3 (edge case, strong dimerization):\n  - $\\mu_A^\\circ = 0\\,\\mathrm{J/mol}$, $\\mu_B^\\circ = 9160\\,\\mathrm{J/mol}$, $\\mu_C^\\circ = -13829\\,\\mathrm{J/mol}$,\n  - $T = 1200\\,\\mathrm{K}$,\n  - $N = 2.0$ (dimensionless),\n  - $k_{2r} = 0.8\\,\\mathrm{s^{-1}}$, $k_{1r} = 0.4\\,\\mathrm{s^{-1}}$,\n  - $\\delta_2 = 0.25$, $\\delta_1 = 0.25$,\n  - $t_{\\mathrm{end}} = 30\\,\\mathrm{s}$,\n  - $\\text{tol}_{\\mathrm{DB}} = 1\\times 10^{-9}$, $\\text{tol}_{\\mathrm{nonDB}} = 1\\times 10^{-6}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\"), where each result is a boolean for the corresponding case. No other text should be printed.",
            "solution": "The problem statement is scientifically sound, well-posed, and provides a complete set of parameters and instructions to numerically demonstrate the principle of detailed balance in a chemical reaction system. The problem is valid.\n\nThe core of this problem is to demonstrate that for a system of elementary chemical reactions, the state of thermodynamic equilibrium, defined by the equality of chemical potentials, is also a stationary point of the kinetic rate equations if and only if the kinetic rate constants satisfy the principle of detailed balance.\n\n**1. Derivation of Equilibrium Relations**\n\nThermodynamic equilibrium for a closed system at constant temperature and volume is achieved when the total Gibbs free energy is minimized, subject to elemental conservation. For an elementary reaction, this minimization implies a specific relationship between the chemical potentials $\\mu_i$ of the reactants and products. The chemical potential of species $i$ in an ideal mixture is given by $\\mu_i = \\mu_i^\\circ + RT \\ln c_i$, where $\\mu_i^\\circ$ is the standard chemical potential, $R$ is the universal gas constant, $T$ is the absolute temperature, and $c_i$ is the dimensionless concentration (activity).\n\nFor the isomerization reaction $A \\rightleftharpoons B$, the equilibrium condition is $\\mu_A = \\mu_B$.\n$$ \\mu_A^\\circ + RT \\ln c_A^\\star = \\mu_B^\\circ + RT \\ln c_B^\\star $$\nRearranging the terms to solve for the ratio of equilibrium concentrations, $c_B^\\star/c_A^\\star$:\n$$ RT \\ln\\left(\\frac{c_B^\\star}{c_A^\\star}\\right) = \\mu_A^\\circ - \\mu_B^\\circ = -(\\mu_B^\\circ - \\mu_A^\\circ) $$\n$$ \\frac{c_B^\\star}{c_A^\\star} = \\exp\\left(-\\frac{\\mu_B^\\circ - \\mu_A^\\circ}{RT}\\right) $$\nThis defines the equilibrium constant for the first reaction, $K_1$. Thus, at equilibrium, $c_B^\\star = K_1 c_A^\\star$.\n\nFor the dimerization reaction $A + B \\rightleftharpoons C$, the equilibrium condition is $\\mu_A + \\mu_B = \\mu_C$.\n$$ (\\mu_A^\\circ + RT \\ln c_A^\\star) + (\\mu_B^\\circ + RT \\ln c_B^\\star) = \\mu_C^\\circ + RT \\ln c_C^\\star $$\nRearranging the terms:\n$$ RT \\ln c_C^\\star - RT \\ln c_A^\\star - RT \\ln c_B^\\star = \\mu_A^\\circ + \\mu_B^\\circ - \\mu_C^\\circ $$\n$$ RT \\ln\\left(\\frac{c_C^\\star}{c_A^\\star c_B^\\star}\\right) = -(\\mu_C^\\circ - \\mu_A^\\circ - \\mu_B^\\circ) $$\n$$ \\frac{c_C^\\star}{c_A^\\star c_B^\\star} = \\exp\\left(-\\frac{\\mu_C^\\circ - \\mu_A^\\circ - \\mu_B^\\circ}{RT}\\right) $$\nThis defines the equilibrium constant for the second reaction, $K_2$. Thus, at equilibrium, $c_C^\\star = K_2 c_A^\\star c_B^\\star$.\n\n**2. Calculation of Equilibrium Composition**\n\nThe equilibrium concentrations, denoted by $c^\\star = (c_A^\\star, c_B^\\star, c_C^\\star)$, must satisfy the two equilibrium relations derived above, as well as the element conservation constraint. The problem specifies a conserved quantity $N = c_A + c_B + 2 c_C$. At equilibrium, this becomes:\n$$ N = c_A^\\star + c_B^\\star + 2 c_C^\\star $$\nWe substitute the equilibrium relations, $c_B^\\star = K_1 c_A^\\star$ and $c_C^\\star = K_2 c_A^\\star c_B^\\star = K_2 c_A^\\star (K_1 c_A^\\star) = K_1 K_2 (c_A^\\star)^2$, into the conservation equation:\n$$ N = c_A^\\star + (K_1 c_A^\\star) + 2(K_1 K_2 (c_A^\\star)^2) $$\nRearranging this gives a quadratic equation in terms of $c_A^\\star$:\n$$ (2 K_1 K_2) (c_A^\\star)^2 + (1 + K_1) c_A^\\star - N = 0 $$\nThis is a standard quadratic equation of the form $ax^2 + bx + c = 0$, with $x = c_A^\\star$, $a = 2 K_1 K_2$, $b = 1 + K_1$, and $c = -N$. The solution is given by the quadratic formula. Since concentration must be a non-negative quantity, and since $K_1$, $K_2$, and $N$ are all positive, we must select the positive root:\n$$ c_A^\\star = \\frac{-(1+K_1) + \\sqrt{(1+K_1)^2 - 4(2 K_1 K_2)(-N)}}{2(2 K_1 K_2)} = \\frac{-(1+K_1) + \\sqrt{(1+K_1)^2 + 8 K_1 K_2 N}}{4 K_1 K_2} $$\nOnce $c_A^\\star$ is calculated, the other equilibrium concentrations are found directly:\n$$ c_B^\\star = K_1 c_A^\\star $$\n$$ c_C^\\star = K_1 K_2 (c_A^\\star)^2 $$\n\n**3. Kinetic Rate Equations (ODEs)**\n\nFollowing the Law of Mass Action for the elementary reactions, the forward and reverse rates are:\n- $A+B \\rightleftharpoons C$: $r_{f,1} = k_{1f} c_A c_B$, $r_{r,1} = k_{1r} c_C$\n- $A \\rightleftharpoons B$: $r_{f,2} = k_{2f} c_A$, $r_{r,2} = k_{2r} c_B$\n\nThe net rate of change for each species is the sum of the rates of reactions that produce it minus the sum of the rates of reactions that consume it. This yields the following system of ordinary differential equations (ODEs):\n$$ \\frac{dc_A}{dt} = (r_{r,1} + r_{r,2}) - (r_{f,1} + r_{f,2}) = -k_{1f}c_A c_B + k_{1r}c_C - k_{2f}c_A + k_{2r}c_B $$\n$$ \\frac{dc_B}{dt} = (r_{r,1} + r_{f,2}) - (r_{f,1} + r_{r,2}) = -k_{1f}c_A c_B + k_{1r}c_C + k_{2f}c_A - k_{2r}c_B $$\n$$ \\frac{dc_C}{dt} = r_{f,1} - r_{r,1} = k_{1f}c_A c_B - k_{1r}c_C $$\nThis system describes the evolution of the species' concentrations over time.\n\n**4. Enforcing and Breaking Detailed Balance**\n\nThe Law of Detailed Balance states that at equilibrium, the forward and reverse rates of *each elementary reaction* are equal.\n- For $A \\rightleftharpoons B$: $k_{2f}c_A^\\star = k_{2r}c_B^\\star \\implies \\frac{k_{2f}}{k_{2r}} = \\frac{c_B^\\star}{c_A^\\star} = K_1$.\n- For $A+B \\rightleftharpoons C$: $k_{1f}c_A^\\star c_B^\\star = k_{1r}c_C^\\star \\implies \\frac{k_{1f}}{k_{1r}} = \\frac{c_C^\\star}{c_A^\\star c_B^\\star} = K_2$.\n\nTo construct the two kinetic parameterizations:\n- **Detailed Balance (DB) Enforced:** We use the thermodynamic equilibrium constants to define the forward rate constants from the given reverse rate constants:\n  $k_{2f} = K_1 k_{2r}$ and $k_{1f} = K_2 k_{1r}$. With this set of constants, the kinetic system is thermodynamically consistent.\n- **Detailed Balance (DB) Broken:** We introduce perturbations $\\delta_1$ and $\\delta_2$ to the forward rate constants, violating the thermodynamic constraint:\n  $k_{2f} = K_1 (1+\\delta_2) k_{2r}$ and $k_{1f} = K_2 (1-\\delta_1) k_{1r}$. The ratios of rate constants no longer equal the equilibrium constants.\n\n**5. & 6. Numerical Verification**\n\nThe crucial test is to initialize the ODE system precisely at the thermodynamic equilibrium point $c^\\star$.\n- If detailed balance is enforced, then for each reaction $i$, $r_{f,i}(c^\\star) = r_{r,i}(c^\\star)$. The net rate of change for every species will be zero: $\\frac{dc_A}{dt} = \\frac{dc_B}{dt} = \\frac{dc_C}{dt} = 0$. The system is at a stationary point and should not evolve. Any deviation from $c^\\star$ during numerical integration will be due solely to machine precision and solver error, and thus $\\Delta_{\\max}$ should be very small.\n- If detailed balance is broken, then $r_{f,i}(c^\\star) \\neq r_{r,i}(c^\\star)$ for at least one reaction. The net rates of change will be non-zero, causing the system to immediately drift away from the thermodynamic equilibrium point $c^\\star$. This drift will accumulate over time, leading to a significant $\\Delta_{\\max}$.\n\nThe program will perform these steps for each test case. It will calculate $c^\\star$, set up the DB and non-DB kinetic parameters, integrate the ODEs from $c(0)=c^\\star$, compute the maximum deviation $\\Delta_{\\max}$ for both scenarios, and verify if $\\Delta_{\\max, \\mathrm{DB}} \\le \\text{tol}_{\\mathrm{DB}}$ and $\\Delta_{\\max, \\mathrm{nonDB}} > \\text{tol}_{\\mathrm{nonDB}}$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It demonstrates the principle of detailed balance in a chemical reaction system.\n    \"\"\"\n    test_cases = [\n        # Case 1 (happy path, moderate kinetics)\n        {\n            \"mu_A_circ\": 0.0, \"mu_B_circ\": 2965.0, \"mu_C_circ\": 16356.0, \"T\": 1000.0,\n            \"N\": 2.0, \"k2r\": 0.5, \"k1r\": 0.2, \"delta2\": 0.3, \"delta1\": 0.3,\n            \"t_end\": 40.0, \"tol_db\": 1e-9, \"tol_nondb\": 1e-6\n        },\n        # Case 2 (edge case, near-degenerate isomerization and slow kinetics)\n        {\n            \"mu_A_circ\": 0.0, \"mu_B_circ\": 341.0, \"mu_C_circ\": 46313.0, \"T\": 800.0,\n            \"N\": 1.0, \"k2r\": 5e-4, \"k1r\": 1e-4, \"delta2\": 0.5, \"delta1\": 0.5,\n            \"t_end\": 20000.0, \"tol_db\": 1e-9, \"tol_nondb\": 1e-7\n        },\n        # Case 3 (edge case, strong dimerization)\n        {\n            \"mu_A_circ\": 0.0, \"mu_B_circ\": 9160.0, \"mu_C_circ\": -13829.0, \"T\": 1200.0,\n            \"N\": 2.0, \"k2r\": 0.8, \"k1r\": 0.4, \"delta2\": 0.25, \"delta1\": 0.25,\n            \"t_end\": 30.0, \"tol_db\": 1e-9, \"tol_nondb\": 1e-6\n        }\n    ]\n\n    R = 8.314  # J/(mol K)\n    results = []\n\n    for case in test_cases:\n        # Unpack parameters\n        mu_A_circ, mu_B_circ, mu_C_circ = case[\"mu_A_circ\"], case[\"mu_B_circ\"], case[\"mu_C_circ\"]\n        T, N = case[\"T\"], case[\"N\"]\n        k1r, k2r = case[\"k1r\"], case[\"k2r\"]\n        delta1, delta2 = case[\"delta1\"], case[\"delta2\"]\n        t_end, tol_db, tol_nondb = case[\"t_end\"], case[\"tol_db\"], case[\"tol_nondb\"]\n\n        # Step 1: Calculate thermodynamic equilibrium constants\n        K1 = np.exp(-(mu_B_circ - mu_A_circ) / (R * T))\n        K2 = np.exp(-(mu_C_circ - mu_A_circ - mu_B_circ) / (R * T))\n\n        # Step 2: Solve for equilibrium concentrations\n        a_quad = 2 * K1 * K2\n        b_quad = 1 + K1\n        c_quad = -N\n\n        if np.abs(a_quad) < 1e-15:\n            # Linear case, though not expected for the given test cases\n            c_A_star = -c_quad / b_quad\n        else:\n            # Quadratic case\n            discriminant = b_quad**2 - 4 * a_quad * c_quad\n            c_A_star = (-b_quad + np.sqrt(discriminant)) / (2 * a_quad)\n        \n        c_B_star = K1 * c_A_star\n        c_C_star = K1 * K2 * c_A_star**2\n        c_star = np.array([c_A_star, c_B_star, c_C_star])\n\n        # Step 3: Define the ODE system\n        def dcdt(t, c, k1f, k1r, k2f, k2r):\n            cA, cB, cC = c\n            r_f1 = k1f * cA * cB\n            r_r1 = k1r * cC\n            r_f2 = k2f * cA\n            r_r2 = k2r * cB\n            \n            dcA_dt = -r_f1 + r_r1 - r_f2 + r_r2\n            dcB_dt = -r_f1 + r_r1 + r_f2 - r_r2\n            dcC_dt =  r_f1 - r_r1\n            return [dcA_dt, dcB_dt, dcC_dt]\n\n        # Integration settings\n        t_span = [0, t_end]\n        t_eval = np.linspace(t_span[0], t_span[1], 500)\n\n        # === Detailed Balance Enforced Run ===\n        # Step 4 (DB): Set kinetically consistent rate constants\n        k1f_db = K2 * k1r\n        k2f_db = K1 * k2r\n        # Step 5 (DB): Integrate and compute deviation\n        ode_db_func = lambda t, c: dcdt(t, c, k1f_db, k1r, k2f_db, k2r)\n        sol_db = solve_ivp(ode_db_func, t_span, c_star, t_eval=t_eval, method='LSODA')\n        deviation_db = np.abs(sol_db.y - c_star[:, np.newaxis])\n        delta_max_db = np.max(deviation_db)\n\n        # === Detailed Balance Broken Run ===\n        # Step 4 (non-DB): Set kinetically *inconsistent* rate constants\n        k1f_nondb = K2 * (1 - delta1) * k1r\n        k2f_nondb = K1 * (1 + delta2) * k2r\n        # Step 5 (non-DB): Integrate and compute deviation\n        ode_nondb_func = lambda t, c: dcdt(t, c, k1f_nondb, k1r, k2f_nondb, k2r)\n        sol_nondb = solve_ivp(ode_nondb_func, t_span, c_star, t_eval=t_eval, method='LSODA')\n        deviation_nondb = np.abs(sol_nondb.y - c_star[:, np.newaxis])\n        delta_max_nondb = np.max(deviation_nondb)\n\n        # Step 6: Check conditions and record result\n        success_db = delta_max_db <= tol_db\n        success_nondb = delta_max_nondb > tol_nondb\n        result = success_db and success_nondb\n        results.append(result)\n\n    # Format the final output string as required\n    print(f\"[{','.join(map(str, results))}]\")\n\n# Execute the solver\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}