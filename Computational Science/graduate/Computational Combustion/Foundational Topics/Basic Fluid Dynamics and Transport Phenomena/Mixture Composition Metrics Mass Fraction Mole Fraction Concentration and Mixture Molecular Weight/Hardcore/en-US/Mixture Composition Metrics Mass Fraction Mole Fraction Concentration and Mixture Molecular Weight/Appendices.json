{
    "hands_on_practices": [
        {
            "introduction": "In computational combustion, we frequently switch between different metrics to describe mixture composition. While mass fractions ($Y_i$) are the natural conserved variables in transport equations, mole fractions ($X_i$) are often more convenient for chemical kinetics, and molar concentrations ($c_i$) are required to evaluate reaction rates. This exercise () builds a solid foundation by guiding you to derive two distinct pathways to compute molar concentration—one starting from mass-based quantities and another from mole-based quantities—and to rigorously prove their equivalence for an ideal gas. The subsequent numerical verification ensures that theory translates correctly into robust code.",
            "id": "4040326",
            "problem": "You are to design and implement a complete algorithmic workflow that computes species molar concentrations in gas mixtures from fundamental definitions and laws relevant to computational combustion. The aim is to derive expressions for species concentration from different composition metrics and to prove their equivalence under specified conditions, then verify this equivalence numerically on a test suite.\n\nStarting point and definitions:\n- Let $i$ index chemical species. Let $n_i$ denote the number of moles of species $i$, $m_i$ its mass, and $W_i$ its molecular weight in $\\text{kg}/\\text{mol}$. Let $n = \\sum_i n_i$ and $m = \\sum_i m_i$ denote the total moles and total mass of the mixture, respectively. Let $V$ denote the total volume of the mixture in $\\text{m}^3$, $\\rho$ its mass density in $\\text{kg}/\\text{m}^3$, $p$ its pressure in $\\text{Pa}$, and $T$ its temperature in $\\text{K}$. The universal gas constant is $R_u$ in $\\text{J}/(\\text{mol}\\cdot\\text{K})$.\n- Mass fraction is defined by $Y_i = m_i/m$.\n- Mole fraction is defined by $X_i = n_i/n$.\n- Species molar concentration is defined by $c_i = n_i/V$ in $\\text{mol}/\\text{m}^3$.\n- Mixture molecular weight is defined by $W = m/n$.\n- Under ideal-gas conditions, the Ideal Gas Law holds: $pV = n R_u T$.\n\nTasks:\n1. Starting from the above definitions of $Y_i$, $X_i$, $c_i$, $\\rho$, $W$, $m_i=n_i W_i$, and the ideal-gas law, derive an expression for $c_i$ in terms of $Y_i$, $\\rho$, and $W_i$. Separately, derive an expression for $c_i$ in terms of $X_i$, $p$, and $T$ under ideal-gas conditions. Prove rigorously that these expressions are equivalent when the mixture obeys the ideal-gas law and the definitions of $Y_i$, $X_i$, and $W$ are consistently applied.\n2. Design and implement an algorithm with clear steps that:\n   - Converts between mass fractions $Y_i$ and mole fractions $X_i$ using the definitions.\n   - Computes mixture molecular weight $W$ from $X_i$ and $W_i$.\n   - Computes $\\rho$ from $p$, $T$, and $W$ under ideal-gas conditions.\n   - Computes $c_i$ from $\\rho$ and $Y_i$ using only the fundamental definitions.\n   - Computes $c_i$ from $X_i$, $p$, and $T$ using the ideal-gas law.\n   - Validates the numerical equivalence of the two $c_i$ computations by reporting the maximum absolute discrepancy across species for each test case.\n\nPhysical units and reporting:\n- Molecular weights $W_i$ and mixture molecular weight $W$ must be handled in $\\text{kg}/\\text{mol}$.\n- Pressure $p$ must be in $\\text{Pa}$, temperature $T$ in $\\text{K}$, density $\\rho$ in $\\text{kg}/\\text{m}^3$, and concentration $c_i$ in $\\text{mol}/\\text{m}^3$.\n- Your program must compute and report, for each test case, a single real number equal to the maximum absolute difference $\\max_i |c_i^{(\\text{mass})} - c_i^{(\\text{mole})}|$ in $\\text{mol}/\\text{m}^3$.\n\nTest suite:\nUse the following scientifically consistent test cases. For each case, the mixture is ideal, and you must construct all necessary quantities internally from the provided parameters.\n\n- Case A (multicomponent methane–air-like mixture):\n  - Species: $\\text{CH}_4$, $\\text{O}_2$, $\\text{N}_2$\n  - $W_i$: $[0.016043, 0.031998, 0.0280134]$ $\\text{kg}/\\text{mol}$\n  - Mole fractions $X_i$: $[0.05, 0.21, 0.74]$\n  - $p = 101325$ $\\text{Pa}$, $T = 1000$ $\\text{K}$\n- Case B (single-species oxygen):\n  - Species: $\\text{O}_2$\n  - $W_i$: $[0.031998]$ $\\text{kg}/\\text{mol}$\n  - Mole fractions $X_i$: $[1.0]$\n  - $p = 5 \\times 101325$ $\\text{Pa}$, $T = 300$ $\\text{K}$\n- Case C (trace hydrogen in air at low pressure and high temperature):\n  - Species: $\\text{H}_2$, $\\text{O}_2$, $\\text{N}_2$\n  - $W_i$: $[0.00201588, 0.031998, 0.0280134]$ $\\text{kg}/\\text{mol}$\n  - Mole fractions $X_i$: $[10^{-6}, 0.21, 0.789999]$\n  - $p = 50000$ $\\text{Pa}$, $T = 1500$ $\\text{K}$\n- Case D (combustion products mixture):\n  - Species: $\\text{CO}_2$, $\\text{H}_2\\text{O}$\n  - $W_i$: $[0.0440095, 0.01801528]$ $\\text{kg}/\\text{mol}$\n  - Mole fractions $X_i$: $[0.3, 0.7]$\n  - $p = 2 \\times 101325$ $\\text{Pa}$, $T = 2300$ $\\text{K}$\n\nAnswer specification:\n- For each case, compute both sets of species concentrations and then output a single float equal to the maximum absolute difference across species, in $\\text{mol}/\\text{m}^3$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, preserving the order of the cases as listed: for example, $[r_A,r_B,r_C,r_D]$, where each $r_\\cdot$ is a real number.\n\nNo user input is permitted; all data must be hard-coded as above. Your code must be a complete, runnable program that implements all steps and prints only the specified final line.",
            "solution": "The problem statement has been meticulously reviewed and is determined to be valid. It is scientifically grounded, well-posed, objective, and provides a complete and consistent set of definitions and data. We may therefore proceed with a full solution.\n\nThe core of this problem consists of two parts: a theoretical derivation and proof of equivalence for two methods of calculating species molar concentration, followed by the design and implementation of an algorithm to numerically verify this equivalence.\n\n### Task 1: Theoretical Derivations and Proof of Equivalence\n\nWe are tasked with deriving two distinct expressions for the molar concentration of species $i$, denoted $c_i$, and then proving their equivalence under ideal-gas conditions.\n\n**Derivation 1: Concentration from Mass Fraction, Density, and Molecular Weight**\n\nThis derivation, which we shall use to calculate $c_i^{(\\text{mass})}$, proceeds from the fundamental definitions provided.\n\n1.  The definition of species molar concentration is $c_i = n_i / V$, where $n_i$ is the number of moles of species $i$ and $V$ is the total volume of the mixture.\n2.  The mass of species $i$, $m_i$, is related to its molar quantity $n_i$ and molecular weight $W_i$ by the formula $m_i = n_i W_i$. This can be rearranged to express $n_i$ as $n_i = m_i / W_i$.\n3.  Substituting this expression for $n_i$ into the definition of $c_i$ yields:\n    $$c_i = \\frac{(m_i / W_i)}{V} = \\frac{m_i}{V W_i}$$\n4.  The mass fraction of species $i$, $Y_i$, is defined as $Y_i = m_i / m$, where $m$ is the total mass of the mixture. This can be rearranged to express $m_i$ as $m_i = Y_i m$.\n5.  Substituting this for $m_i$ into our expression for $c_i$:\n    $$c_i = \\frac{Y_i m}{V W_i} = \\frac{Y_i}{W_i} \\left(\\frac{m}{V}\\right)$$\n6.  The term $(m/V)$ is the definition of the mixture's mass density, $\\rho$.\n7.  Therefore, we arrive at the first expression for species molar concentration:\n    $$c_i^{(\\text{mass})} = \\frac{\\rho Y_i}{W_i}$$\n\n**Derivation 2: Concentration from Mole Fraction, Pressure, and Temperature (Ideal Gas)**\n\nThis second derivation, which we will use to calculate $c_i^{(\\text{mole})}$, incorporates the ideal-gas law.\n\n1.  We again begin with the definition of molar concentration, $c_i = n_i / V$.\n2.  The mole fraction of species $i$, $X_i$, is defined as $X_i = n_i / n$, where $n$ is the total number of moles in the mixture. This can be rearranged as $n_i = X_i n$.\n3.  Substituting this expression for $n_i$ into the definition of $c_i$:\n    $$c_i = \\frac{X_i n}{V} = X_i \\left(\\frac{n}{V}\\right)$$\n4.  For a mixture behaving as an ideal gas, the ideal-gas law states $pV = n R_u T$, where $p$ is the pressure, $T$ is the temperature, and $R_u$ is the universal gas constant.\n5.  We can rearrange the ideal-gas law to solve for the term $(n/V)$, which represents the total molar concentration of the mixture:\n    $$\\frac{n}{V} = \\frac{p}{R_u T}$$\n6.  Substituting this result into our expression for $c_i$ yields the second required formula:\n    $$c_i^{(\\text{mole})} = X_i \\frac{p}{R_u T}$$\n\n**Proof of Equivalence**\n\nTo prove that $c_i^{(\\text{mass})} = c_i^{(\\text{mole})}$ under ideal-gas conditions, we must demonstrate that $\\rho Y_i / W_i = X_i p / (R_u T)$ by consistently applying the given definitions. We will start with the expression for $c_i^{(\\text{mass})}$ and show that it can be transformed into the expression for $c_i^{(\\text{mole})}$.\n\n1.  Start with the expression for $c_i^{(\\text{mass})}$:\n    $$c_i^{(\\text{mass})} = \\frac{\\rho Y_i}{W_i}$$\n2.  We need to express the mass-based quantities $\\rho$ and $Y_i$ in terms of mole-based quantities and state variables ($p$, $T$).\n3.  First, let's establish the relationship between mass fraction $Y_i$ and mole fraction $X_i$.\n    -   By definition, $Y_i = m_i / m$.\n    -   Substituting $m_i = n_i W_i$ and $m = \\sum_j m_j = \\sum_j (n_j W_j)$:\n        $$Y_i = \\frac{n_i W_i}{\\sum_j n_j W_j}$$\n    -   Dividing both the numerator and the denominator by the total moles $n = \\sum_j n_j$:\n        $$Y_i = \\frac{(n_i/n) W_i}{\\sum_j (n_j/n) W_j} = \\frac{X_i W_i}{\\sum_j X_j W_j}$$\n    -   The denominator, $\\sum_j X_j W_j$, is the definition of the mean molecular weight of the mixture, $W$. This can be shown from the primary definition $W = m/n$: $W = (\\sum_j m_j)/n = (\\sum_j n_j W_j)/n = \\sum_j (n_j/n) W_j = \\sum_j X_j W_j$.\n    -   Thus, the conversion formula is $Y_i = (X_i W_i)/W$.\n4.  Next, let's express the mixture density $\\rho$ for an ideal gas.\n    -   By definition, $\\rho = m/V$.\n    -   Using the ideal-gas law $V = n R_u T / p$:\n        $$\\rho = \\frac{m}{n R_u T / p} = \\frac{m}{n} \\frac{p}{R_u T}$$\n    -   Recognizing that $W = m/n$, we find the equation of state for density: $\\rho = W p / (R_u T)$.\n5.  Now, substitute the derived expressions for $Y_i$ and $\\rho$ back into the formula for $c_i^{(\\text{mass})}$:\n    $$c_i^{(\\text{mass})} = \\left( \\frac{W p}{R_u T} \\right) \\left( \\frac{X_i W_i}{W} \\right) \\left( \\frac{1}{W_i} \\right)$$\n6.  The mixture molecular weight $W$ in the numerator and denominator cancels out. The species molecular weight $W_i$ also cancels out.\n    $$c_i^{(\\text{mass})} = \\frac{p}{R_u T} X_i$$\n7.  This final expression is identical to the expression for $c_i^{(\\text{mole})}$. This completes the proof:\n    $$c_i^{(\\text{mass})} = c_i^{(\\text{mole})}$$\nThis rigorous proof confirms that both formulations are theoretically equivalent for any gas mixture that obeys the ideal-gas law.\n\n### Task 2: Algorithmic Workflow for Numerical Verification\n\nThe theoretical equivalence will now be numerically verified. The algorithm proceeds as follows for each test case provided. The inputs for each case are the set of species molecular weights $\\{W_i\\}$, the set of species mole fractions $\\{X_i\\}$, the mixture pressure $p$, and the mixture temperature $T$. The universal gas constant $R_u = 8.314462618 \\, \\text{J}/(\\text{mol} \\cdot \\text{K})$ is a required physical constant.\n\n**Step 1: Calculate Concentrations via the Mole Fraction Path**\nThis is the most direct calculation.\n- Compute the total molar concentration of the mixture, $c = p / (R_u T)$.\n- Compute the concentration of each species $i$ using the formula derived previously: $c_i^{(\\text{mole})} = X_i \\cdot c = X_i (p / (R_u T))$.\n\n**Step 2: Calculate Concentrations via the Mass Fraction Path**\nThis path involves several intermediate calculations.\n- **2(a) Compute Mixture Molecular Weight ($W$):** Calculate the mean molecular weight of the mixture as the mole-fraction-weighted average of the species molecular weights:\n  $$W = \\sum_i X_i W_i$$\n- **2(b) Convert Mole Fractions to Mass Fractions ($\\{X_i\\} \\to \\{Y_i\\}$):** For each species, compute its mass fraction using the conversion formula:\n  $$Y_i = \\frac{X_i W_i}{W}$$\n- **2(c) Compute Mixture Density ($\\rho$):** Use the ideal-gas equation of state to find the mixture mass density from the pressure, temperature, and mixture molecular weight:\n  $$\\rho = \\frac{p W}{R_u T}$$\n- **2(d) Compute Species Concentrations ($c_i^{(\\text{mass})}$):** Calculate the concentration for each species using the mass-based formula:\n  $$c_i^{(\\text{mass})} = \\frac{\\rho Y_i}{W_i}$$\n\n**Step 3: Compare Results and Report Discrepancy**\n- For each test case, a set of concentrations $\\{c_i^{(\\text{mole})}\\}$ and $\\{c_i^{(\\text{mass})}\\}$ has been computed.\n- Calculate the element-wise absolute difference between these two sets: $\\Delta c_i = |c_i^{(\\text{mass})} - c_i^{(\\text{mole})}|$.\n- The final result for the test case is the maximum value found in the set of absolute differences:\n  $$\\text{Discrepancy} = \\max_i(\\Delta c_i)$$\nThis discrepancy should be close to zero, limited only by the finite precision of floating-point arithmetic. The implementation of this algorithm is provided in the final answer.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and validates species molar concentrations in gas mixtures.\n\n    This function implements the algorithmic workflow to:\n    1. Calculate species molar concentrations from mole fractions, pressure, and temperature.\n    2. Calculate the same concentrations via an alternative path involving mass fractions\n       and density.\n    3. Numerically validate the equivalence of the two methods by computing the maximum\n       absolute difference in the results for several test cases.\n    \"\"\"\n    # Universal gas constant in J/(mol·K)\n    R_u = 8.31446261815324\n\n    # Define the test cases from the problem statement.\n    # Each case is a dictionary containing species names, molecular weights (W_i),\n    # mole fractions (X_i), pressure (p), and temperature (T).\n    test_cases = [\n        {\n            \"name\": \"Case A (methane–air-like mixture)\",\n            \"species\": [\"CH4\", \"O2\", \"N2\"],\n            \"W_i\": np.array([0.016043, 0.031998, 0.0280134]),  # kg/mol\n            \"X_i\": np.array([0.05, 0.21, 0.74]),\n            \"p\": 101325.0,  # Pa\n            \"T\": 1000.0,  # K\n        },\n        {\n            \"name\": \"Case B (single-species oxygen)\",\n            \"species\": [\"O2\"],\n            \"W_i\": np.array([0.031998]),  # kg/mol\n            \"X_i\": np.array([1.0]),\n            \"p\": 5.0 * 101325.0,  # Pa\n            \"T\": 300.0,  # K\n        },\n        {\n            \"name\": \"Case C (trace hydrogen in air)\",\n            \"species\": [\"H2\", \"O2\", \"N2\"],\n            \"W_i\": np.array([0.00201588, 0.031998, 0.0280134]),  # kg/mol\n            \"X_i\": np.array([1e-6, 0.21, 0.789999]),\n            \"p\": 50000.0,  # Pa\n            \"T\": 1500.0,  # K\n        },\n        {\n            \"name\": \"Case D (combustion products)\",\n            \"species\": [\"CO2\", \"H2O\"],\n            \"W_i\": np.array([0.0440095, 0.01801528]),  # kg/mol\n            \"X_i\": np.array([0.3, 0.7]),\n            \"p\": 2.0 * 101325.0,  # Pa\n            \"T\": 2300.0,  # K\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        W_i = case[\"W_i\"]\n        X_i = case[\"X_i\"]\n        p = case[\"p\"]\n        T = case[\"T\"]\n\n        # --- Calculation Path 1: Mole Fraction Based ---\n        # c_i = X_i * (p / (R_u * T))\n        total_molar_concentration = p / (R_u * T)\n        c_i_mole = X_i * total_molar_concentration\n\n        # --- Calculation Path 2: Mass Fraction Based ---\n        # 1. Compute mixture molecular weight (W)\n        # W = sum(X_i * W_i)\n        W_mixture = np.dot(X_i, W_i)\n\n        # 2. Convert mole fractions (X_i) to mass fractions (Y_i)\n        # Y_i = X_i * W_i / W_mixture\n        # Adding a small epsilon to W_mixture to avoid division by zero in edge cases,\n        # although not strictly necessary with the given test data.\n        Y_i = (X_i * W_i) / (W_mixture + 1e-30)\n\n        # 3. Compute mixture density (rho) using the ideal gas law\n        # rho = p * W_mixture / (R_u * T)\n        rho_mixture = p * W_mixture / (R_u * T)\n\n        # 4. Compute species concentrations (c_i) from mass-based quantities\n        # c_i = rho * Y_i / W_i\n        c_i_mass = (rho_mixture * Y_i) / (W_i + 1e-30)\n\n        # --- Validation ---\n        # Compute the maximum absolute difference between the two computed concentration vectors.\n        # This value should be near machine precision (~0.0).\n        max_abs_diff = np.max(np.abs(c_i_mass - c_i_mole))\n        results.append(max_abs_diff)\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Moving from analytical formulas to practical implementation, we confront the realities of finite-precision arithmetic. Numerical errors from transport and reaction solvers can cause the computed mass fraction vector to drift away from physical validity, violating the constraints $\\sum_i Y_i = 1$ and $Y_i \\ge 0$. This exercise () introduces a powerful and elegant solution: treating the set of all valid mass fraction vectors as a geometric object (a simplex) and finding the \"closest\" valid point to our erroneous vector. You will derive and implement an algorithm that projects a perturbed vector onto this simplex, a fundamentally important technique for ensuring mass conservation and physical realism in numerical simulations.",
            "id": "4040311",
            "problem": "You are given a finite set of chemical species indexed by $i \\in \\{1,\\dots,n\\}$ in a reacting mixture. The mass fraction of species $i$ is denoted by $Y_i$, the mole fraction is denoted by $X_i$, and the molecular weight (mass per mole) of species $i$ is denoted by $W_i$. Due to floating-point roundoff and algorithmic truncation in numerical combustion simulations, one often obtains a vector of perturbed mass fractions $\\tilde{Y} \\in \\mathbb{R}^n$ that may fail to satisfy the two core constraints of mass fractions, namely $\\sum_{i=1}^n Y_i = 1$ and $Y_i \\ge 0$ for all $i$. The mixture molecular weight $W_{\\mathrm{mix}}$ is defined in terms of the mass fractions and molecular weights by $$W_{\\mathrm{mix}} = \\left(\\sum_{i=1}^n \\frac{Y_i}{W_i}\\right)^{-1},$$ which is well-defined when $Y_i \\ge 0$, $\\sum_i Y_i = 1$, and $W_i > 0$ for all $i$. Your task is to derive, from first principles, a normalization strategy that takes any $\\tilde{Y}$ produced by floating-point computation and returns a corrected vector $Y^\\star$ satisfying the mass-fraction constraints with the smallest possible perturbation measured in an appropriate metric. You must begin from the fundamental constraints of mass conservation for mass fractions (nonnegativity and unit-sum), and the basic optimization principle of minimizing a physically meaningful deviation from $\\tilde{Y}$, and reason to a concrete algorithm. Then, you must prove that the strategy is feasible on the simplex $$\\Delta^{n-1} = \\left\\{Y \\in \\mathbb{R}^n \\;\\middle|\\; \\sum_{i=1}^n Y_i = 1,\\; Y_i \\ge 0 \\;\\forall i\\right\\}.$$ In your proof, you should establish existence, uniqueness, and that the constructed $Y^\\star$ lies in $\\Delta^{n-1}$, together with an argument that the perturbation is minimal in the chosen metric.\n\nProgrammatic requirements: Implement your normalization strategy in a program and apply it to the test suite below. For each test case, compute the corrected mass fractions $Y^\\star$ and the corresponding mixture molecular weight $W_{\\mathrm{mix}}$ using the corrected $Y^\\star$. The mass fraction is dimensionless, while the molecular weights must be treated in units of $\\text{kg}/\\text{kmol}$, and your program must report $W_{\\mathrm{mix}}$ in $\\text{kg}/\\text{kmol}$. You must produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case’s result should itself be a two-element list whose first element is the list of corrected mass fractions $Y^\\star$ (in the same species order as given) and whose second element is the scalar $W_{\\mathrm{mix}}$ in $\\text{kg}/\\text{kmol}$. The final output must have the form $$\\left[\\left[Y^\\star_{(1)}, W_{\\mathrm{mix},(1)}\\right], \\left[Y^\\star_{(2)}, W_{\\mathrm{mix},(2)}\\right], \\dots \\right],$$ where $Y^\\star_{(k)}$ is a list of $n$ floats and $W_{\\mathrm{mix},(k)}$ is a float.\n\nFundamental bases permitted for derivation:\n- The mass fraction constraints $\\sum_{i=1}^n Y_i = 1$ and $Y_i \\ge 0$ for all $i$.\n- The principle of minimizing deviation according to a norm-induced distance in $\\mathbb{R}^n$ (choose and justify an appropriate norm from first principles in this context).\n- The definition of mixture molecular weight $W_{\\mathrm{mix}}$ in terms of mass fractions and molecular weights.\n\nTest suite:\n- Species and molecular weights: Consider $n = 5$ species with molecular weights (in $\\text{kg}/\\text{kmol}$) in the following fixed order: nitrogen ($\\mathrm{N}_2$) $W_1 = 28.0134$, oxygen ($\\mathrm{O}_2$) $W_2 = 31.9988$, carbon dioxide ($\\mathrm{CO}_2$) $W_3 = 44.0095$, water ($\\mathrm{H}_2\\mathrm{O}$) $W_4 = 18.01528$, methane ($\\mathrm{CH}_4$) $W_5 = 16.04246$.\n- Test cases specify $\\tilde{Y}$ as follows in the same species order:\n    1. Happy-path perturbation: $\\tilde{Y}^{(1)} = [0.755, 0.205, 0.001, 0.039, 0.0009]$.\n    2. Tiny negative entry due to roundoff with near-unit sum: $\\tilde{Y}^{(2)} = [0.7000000001, 0.2099999999, -10^{-12}, 0.09, 0]$.\n    3. Extreme rounding collapse (boundary stress test): $\\tilde{Y}^{(3)} = [0, 0, 0, 0, 0]$.\n    4. Already near-feasible with tiny sum error: $\\tilde{Y}^{(4)} = [0.7800000000001, 0.2099999999999, 0, 0.01, 0]$.\n    5. Highly skewed with a tiny negative entry: $\\tilde{Y}^{(5)} = [1 + 10^{-9}, -10^{-9}, 0, 0, 0]$.\n\nAnswer specification:\n- For each test case, return the corrected $Y^\\star$ and the resulting $W_{\\mathrm{mix}}$ as described above. All numbers must be reported as plain decimal floats without units in the output line, but your derivation and program must treat $W_i$ in $\\text{kg}/\\text{kmol}$ and interpret $W_{\\mathrm{mix}}$ in $\\text{kg}/\\text{kmol}$.\n- Your program must produce exactly one line containing the list $$\\left[\\left[Y^\\star_{(1)}, W_{\\mathrm{mix},(1)}\\right],\\left[Y^\\star_{(2)}, W_{\\mathrm{mix},(2)}\\right],\\left[Y^\\star_{(3)}, W_{\\mathrm{mix},(3)}\\right],\\left[Y^\\star_{(4)}, W_{\\mathrm{mix},(4)}\\right],\\left[Y^\\star_{(5)}, W_{\\mathrm{mix},(5)}\\right]\\right].$$\n\nFeasibility and coverage:\n- Your test suite includes a general case, cases with small negative entries, a boundary case of total collapse, and a highly skewed case. You must ensure your normalization strategy returns valid mass fractions $Y^\\star$ in all cases with $\\sum_i Y^\\star_i = 1$ and $Y^\\star_i \\ge 0$.\n- The output for each test case must be a list consisting of a list of floats and a float, as specified, ensuring that each test case’s answer is quantifiable and automatically verifiable.",
            "solution": "The problem of correcting a perturbed vector of mass fractions $\\tilde{Y} \\in \\mathbb{R}^n$ to satisfy physical constraints is a classic problem in computational modeling, particularly in fields like combustion where mass conservation is paramount. The goal is to find a corrected vector $Y^\\star$ that adheres to the constraints defining the standard simplex, $\\Delta^{n-1}$, while being as \"close\" as possible to the original perturbed vector $\\tilde{Y}$.\n\nThe constraints for a vector of mass fractions $Y = [Y_1, \\dots, Y_n]^T$ are:\n$1$. Sum-to-one constraint: $\\sum_{i=1}^n Y_i = 1$.\n$2$. Non-negativity constraint: $Y_i \\ge 0$ for all $i \\in \\{1, \\dots, n\\}$.\n\nThe task is to find a vector $Y^\\star$ that minimizes the deviation from $\\tilde{Y}$ subject to these constraints. This can be formally expressed as an optimization problem.\n\nFirst, we must choose a metric to quantify the deviation $\\|Y^\\star - \\tilde{Y}\\|$. The most natural and mathematically convenient choice is the standard Euclidean distance (or $L_2$ norm). Minimizing the distance $\\|Y^\\star - \\tilde{Y}\\|_2$ is equivalent to minimizing its square, $\\|Y^\\star - \\tilde{Y}\\|_2^2$. This choice is justified because it yields a strictly convex quadratic objective function, which guarantees a unique solution. It treats perturbations in all species fractions equally, without introducing any arbitrary weighting.\n\nThe optimization problem is therefore to find the Euclidean projection of $\\tilde{Y}$ onto the simplex $\\Delta^{n-1}$:\n$$\n\\begin{align*}\n\\underset{Y^\\star \\in \\mathbb{R}^n}{\\text{minimize}} & \\quad f(Y^\\star) = \\frac{1}{2} \\|Y^\\star - \\tilde{Y}\\|_2^2 = \\frac{1}{2} \\sum_{i=1}^n (Y^\\star_i - \\tilde{Y}_i)^2 \\\\\n\\text{subject to} & \\quad \\sum_{i=1}^n Y^\\star_i = 1 \\\\\n& \\quad Y^\\star_i \\ge 0 \\quad \\text{for } i = 1, \\dots, n\n\\end{align*}\n$$\nThe factor of $\\frac{1}{2}$ is included for algebraic convenience when taking derivatives. This is a convex optimization problem (a quadratic program) as the objective function is strictly convex and the constraint set is convex.\n\nWe solve this using the Karush-Kuhn-Tucker (KKT) conditions. The Lagrangian $\\mathcal{L}$ for this problem is:\n$$ \\mathcal{L}(Y^\\star, \\mu, \\lambda) = \\frac{1}{2} \\sum_{i=1}^n (Y^\\star_i - \\tilde{Y}_i)^2 - \\mu \\left( \\sum_{i=1}^n Y^\\star_i - 1 \\right) - \\sum_{i=1}^n \\lambda_i Y^\\star_i $$\nwhere $\\mu$ is the Lagrange multiplier for the equality constraint and $\\lambda_i$ are the multipliers for the non-negativity inequality constraints.\n\nThe KKT conditions for optimality are:\n$1$. **Stationarity:** $\\frac{\\partial \\mathcal{L}}{\\partial Y^\\star_i} = Y^\\star_i - \\tilde{Y}_i - \\mu - \\lambda_i = 0$ for all $i \\in \\{1,\\dots,n\\}$. This implies $Y^\\star_i = \\tilde{Y}_i + \\mu + \\lambda_i$.\n$2$. **Primal Feasibility:** $\\sum_{i=1}^n Y^\\star_i = 1$ and $Y^\\star_i \\ge 0$ for all $i$.\n$3$. **Dual Feasibility:** $\\lambda_i \\ge 0$ for all $i$.\n$4$. **Complementary Slackness:** $\\lambda_i Y^\\star_i = 0$ for all $i$.\n\nFrom the complementary slackness condition, for each species $i$, either $\\lambda_i=0$ or $Y^\\star_i=0$.\n- If $Y^\\star_i > 0$, then we must have $\\lambda_i = 0$. The stationarity condition simplifies to $Y^\\star_i = \\tilde{Y}_i + \\mu$. The condition $Y^\\star_i > 0$ implies $\\tilde{Y}_i + \\mu > 0$.\n- If $Y^\\star_i = 0$, then $\\lambda_i \\ge 0$. The stationarity condition gives $0 = \\tilde{Y}_i+\\mu+\\lambda_i$. Since $\\lambda_i \\ge 0$, this requires $\\tilde{Y}_i + \\mu \\le 0$.\n\nCombining these two cases gives a compact expression for the solution $Y^\\star_i$:\n$$ Y^\\star_i = \\max(0, \\tilde{Y}_i + \\mu) $$\nThis elegant result shows that the solution is obtained by a simple uniform shift of the original vector $\\tilde{Y}$ by a value $\\mu$, followed by clipping at zero. The only unknown is the Lagrange multiplier $\\mu$.\n\nTo find $\\mu$, we enforce the primal feasibility constraint $\\sum_{i=1}^n Y^\\star_i = 1$:\n$$ \\sum_{i=1}^n \\max(0, \\tilde{Y}_i + \\mu) = 1 $$\nLet's define a function $g(\\mu) = \\sum_{i=1}^n \\max(0, \\tilde{Y}_i + \\mu)$. We need to find the root of $g(\\mu) = 1$. The function $g(\\mu)$ is continuous, piecewise linear, and monotonically non-decreasing. This guarantees that a unique solution for $\\mu$ exists.\n\nTo solve for $\\mu$ efficiently, let us sort the components of $\\tilde{Y}$ in descending order: $u_1 \\ge u_2 \\ge \\dots \\ge u_n$. The condition $\\tilde{Y}_i + \\mu > 0$ will hold for the components with the largest values of $\\tilde{Y}_i$. Let $\\rho$ be the number of elements for which this condition holds. These $\\rho$ elements form the \"active set\" whose values will be positive in the final solution. For these $\\rho$ elements, $Y^\\star_i = u_i + \\mu$, and for the remaining $n-\\rho$ elements, $Y^\\star_i = 0$.\n\nThe sum constraint becomes:\n$$ \\sum_{j=1}^\\rho (u_j + \\mu) = 1 \\implies \\left(\\sum_{j=1}^\\rho u_j\\right) + \\rho \\mu = 1 $$\nSolving for $\\mu$ yields:\n$$ \\mu = \\frac{1 - \\sum_{j=1}^\\rho u_j}{\\rho} $$\nThe correct value of $\\rho$ is the one for which the active set is consistent, i.e., $u_j + \\mu > 0$ for $j \\le \\rho$ and $u_j + \\mu \\le 0$ for $j > \\rho$. The critical condition is at the boundary of the active set, $j=\\rho$. We need to find the largest $\\rho \\in \\{1, \\dots, n\\}$ such that:\n$$ u_\\rho + \\frac{1 - \\sum_{j=1}^\\rho u_j}{\\rho} > 0 $$\nThis inequality can be rewritten as $\\rho u_\\rho + 1 - \\sum_{j=1}^\\rho u_j > 0$, or $\\rho u_\\rho > \\left(\\sum_{j=1}^\\rho u_j\\right) - 1$.\n\nThis leads to the following algorithm:\n$1$. Given the input vector $\\tilde{Y} \\in \\mathbb{R}^n$.\n$2$. Sort $\\tilde{Y}$ in descending order to get a new vector $u = [u_1, u_2, \\dots, u_n]$.\n$3$. Compute the cumulative sums of $u$, $S_j = \\sum_{i=1}^j u_i$.\n$4$. Find the largest integer $\\rho \\in \\{1,\\dots,n\\}$ that satisfies the condition $j u_j > S_j - 1$ for $j=1, \\dots, \\rho$.\n$5$. With this $\\rho$, calculate the shift parameter $\\mu = (1 - S_\\rho) / \\rho$.\n$6$. The final corrected vector $Y^\\star$ is then computed element-wise as $Y^\\star_i = \\max(0, \\tilde{Y}_i + \\mu)$.\n\nA proof of this algorithm's correctness must establish existence, uniqueness, and feasibility of the solution $Y^\\star$.\n- **Existence and Uniqueness:** The objective function $f(Y^\\star)$ is strictly convex and continuous. The constraint set, the simplex $\\Delta^{n-1}$, is a non-empty, closed, and convex (and thus compact) subset of $\\mathbb{R}^n$. The Weierstrass extreme value theorem guarantees the existence of a minimum. The strict convexity of $f$ guarantees this minimum is unique.\n- **Feasibility:** By construction, $Y^\\star_i = \\max(0, \\tilde{Y}_i + \\mu)$ ensures $Y^\\star_i \\ge 0$. The sum is $\\sum_{i=1}^n Y^\\star_i = \\sum_{i=1}^n \\max(0, \\tilde{Y}_i + \\mu) = \\sum_{j=1}^\\rho (u_j + \\mu)$, where the second sum is over the elements of the sorted vector $u$ corresponding to the active set. This evaluates to $(\\sum_{j=1}^\\rho u_j) + \\rho \\mu = S_\\rho + \\rho \\frac{1 - S_\\rho}{\\rho} = S_\\rho + 1 - S_\\rho = 1$. Thus, the solution $Y^\\star$ lies on the simplex $\\Delta^{n-1}$.\n- **Optimality:** Since the optimization problem is convex, the KKT conditions are both necessary and sufficient for a global optimum. Our derivation found a unique solution that satisfies these conditions, hence it is the unique optimal solution.\n\nFinally, with the corrected mass fractions $Y^\\star$, the mixture molecular weight $W_\\mathrm{mix}$ is computed using its definition:\n$$ W_{\\mathrm{mix}} = \\left(\\sum_{i=1}^n \\frac{Y^\\star_i}{W_i}\\right)^{-1} $$\nwhere $W_i > 0$ are the molecular weights of the species. Since $Y^\\star_i \\ge 0$ and $\\sum_i Y^\\star_i=1$, and not all $Y^\\star_i$ can be $0$, the denominator is well-defined and positive, ensuring $W_\\mathrm{mix}$ is also well-defined and positive.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the mass fraction normalization problem for a suite of test cases.\n    \"\"\"\n\n    # Define the species molecular weights (kg/kmol) in a fixed order.\n    # N2, O2, CO2, H2O, CH4\n    molecular_weights = np.array([\n        28.0134,    # W_1 (N2)\n        31.9988,    # W_2 (O2)\n        44.0095,    # W_3 (CO2)\n        18.01528,   # W_4 (H2O)\n        16.04246    # W_5 (CH4)\n    ])\n\n    # Define the test cases for the perturbed mass fraction vector tilde_Y.\n    test_cases = [\n        # 1. Happy-path perturbation\n        np.array([0.755, 0.205, 0.001, 0.039, 0.0009]),\n        # 2. Tiny negative entry due to roundoff\n        np.array([0.7000000001, 0.2099999999, -1e-12, 0.09, 0.0]),\n        # 3. Extreme rounding collapse (boundary stress test)\n        np.array([0.0, 0.0, 0.0, 0.0, 0.0]),\n        # 4. Already near-feasible with tiny sum error\n        np.array([0.7800000000001, 0.2099999999999, 0.0, 0.01, 0.0]),\n        # 5. Highly skewed with a tiny negative entry\n        np.array([1.0 + 1e-9, -1e-9, 0.0, 0.0, 0.0])\n    ]\n\n    results = []\n    for y_tilde in test_cases:\n        # Normalize the mass fraction vector\n        y_star = _project_to_simplex(y_tilde)\n        \n        # Calculate the mixture molecular weight using the corrected mass fractions\n        # W_mix = (sum(Y_i / W_i))^-1\n        # To avoid division by zero if a W_i is zero (not the case here),\n        # we can filter. Since W_i are all > 0, this is robust.\n        # Likewise, if a Y_i is zero, its term is zero.\n        w_mix = 1.0 / np.sum(y_star / molecular_weights)\n        \n        # Store the results for this case. y_star is converted to a list for formatting.\n        results.append([y_star.tolist(), w_mix])\n\n    # Format the final output string exactly as specified in the problem statement.\n    # The format is [[Y*_1, W_mix_1], [Y*_2, W_mix_2], ...]\n    # where each Y* is a list of floats.\n    output_str = f\"[{','.join(f'[{str(y)},{w}]' for y, w in results)}]\"\n    print(output_str)\n\ndef _project_to_simplex(y_tilde: np.ndarray) -> np.ndarray:\n    \"\"\"\n    Projects a vector onto the standard simplex using a fast projection algorithm.\n\n    This algorithm finds the Euclidean projection of a vector y_tilde onto the\n    simplex {x | sum(x) = 1, x_i >= 0}, which is equivalent to solving the\n    optimization problem:\n    \n    minimize   0.5 * ||x - y_tilde||^2\n    subject to sum(x) = 1, x_i >= 0\n    \n    Args:\n        y_tilde: A numpy array representing the vector to be projected.\n\n    Returns:\n        A numpy array representing the projected vector on the simplex.\n    \"\"\"\n    n = y_tilde.shape[0]\n    \n    # Sort the input vector in descending order.\n    u = np.sort(y_tilde)[::-1]\n    \n    # Calculate the cumulative sum of the sorted vector.\n    s = np.cumsum(u)\n    \n    # Find the largest index rho such that u_rho + (1 - s_rho) / rho > 0.\n    # This is implemented by finding all j that satisfy the condition and taking the max.\n    # The condition is vectorized as: u_j > (s_j - 1) / j for j=1...n\n    # Using 1-based indexing for j in the formula corresponds to 0-based index `j-1` in arrays.\n    j_indices = np.arange(1, n + 1)\n    condition = u > (s - 1) / j_indices\n    \n    # The set of indices j for which the condition holds is never empty because for j=1,\n    # u_1 > (u_1 - 1)/1 is 0 > -1, which is always true.\n    # So we can safely access the last element.\n    rho = np.where(condition)[0][-1] + 1\n    \n    # Calculate the Lagrange multiplier (the shift value mu).\n    # mu = (1 - s[rho-1]) / rho, where s[rho-1] is the sum of the top rho elements.\n    mu = (1 - s[rho - 1]) / rho\n    \n    # Apply the shift and clip at zero to get the projected vector.\n    y_star = np.maximum(0, y_tilde + mu)\n    \n    return y_star\n\nsolve()\n```"
        },
        {
            "introduction": "This final practice elevates our analysis to explore the subtle interplay and sensitivity between composition metrics. When converting from one set of fractions to another, it is crucial to understand how uncertainties in the input propagate to the output. This exercise () delves into this question by tasking you with the derivation of the partial derivative $\\frac{\\partial X_i}{\\partial Y_k}$. Analyzing the structure of this derivative provides profound insight into error propagation, explaining why a small measurement error in the mass fraction of a heavy, abundant species can lead to a disproportionately large relative error in the calculated mole fraction of a light, trace species—a critical consideration in both high-fidelity modeling and the interpretation of experimental data.",
            "id": "4040305",
            "problem": "Consider a chemically inert gas mixture relevant to computational combustion consisting of $N$ species indexed by $i \\in \\{1,2,\\dots,N\\}$, each with fixed molecular weight $W_i$. Let $m_i$ and $n_i$ denote the mass and mole number of species $i$, respectively, and let $m = \\sum_{j=1}^{N} m_j$ and $n = \\sum_{j=1}^{N} n_j$ denote the total mass and total mole number of the mixture. The mass fraction of species $i$ is defined as $Y_i = m_i / m$ and the mole fraction of species $i$ is defined as $X_i = n_i / n$. The mixture molecular weight is defined by $\\bar{W} = m / n$. The species molecular weights $W_i$ relate mass and mole number by $m_i = W_i n_i$. Assume $\\sum_{i=1}^{N} Y_i = 1$ and $\\sum_{i=1}^{N} X_i = 1$, and treat $\\{Y_i\\}$ as the primary composition variables.\n\nStarting strictly from these definitions and identities and without invoking any pre-derived conversion formulas, derive the inverse mapping from mass fractions to mole fractions, $X_i(\\{Y_j\\},\\{W_j\\})$, and then compute the mixed partial derivative $\\partial X_i / \\partial Y_k$ in closed form for arbitrary $i$ and $k$. Express your final derivative in terms of $X_i$, $\\bar{W}$, the molecular weights, and Kronecker delta $\\delta_{ik}$ only.\n\nThen, using the derivative you obtain, reason about error propagation: explain why small absolute errors in the mass fraction of a heavy species (large $W_k$) can lead to disproportionately large relative errors in the mole fraction of a light trace species (small $W_i$ and $X_i \\ll 1$), even when the resulting absolute change in $X_i$ is small. Your explanation should rely solely on the structure and scaling of the derivative you derived, and should articulate the role of $\\bar{W}$ and $W_k$.\n\nProvide the final derivative as a single closed-form analytic expression. No numerical evaluation is required. The final expression should be free of units.",
            "solution": "This problem requires us to derive the relationship between mole fractions and mass fractions, compute its derivative, and use this result to analyze error propagation.\n\n**1. Derivation of the Mapping $X_i(\\{Y_j\\})$**\n\nWe begin with the fundamental definitions provided. The mole fraction of species $i$ is $X_i = n_i / n$. We need to express the molar quantities $n_i$ and $n$ in terms of mass fractions $\\{Y_j\\}$.\n\n1.  Relate the moles of species $i$, $n_i$, to its mass $m_i$: $n_i = m_i / W_i$.\n2.  Relate the mass of species $i$, $m_i$, to its mass fraction $Y_i$: $m_i = m Y_i$, where $m$ is the total mixture mass.\n3.  Combine these to express $n_i$ in terms of $Y_i$: $n_i = m Y_i / W_i$.\n4.  The total number of moles in the mixture, $n$, is the sum over all species: $n = \\sum_j n_j = \\sum_j (m Y_j / W_j) = m \\sum_j (Y_j / W_j)$.\n5.  Now, substitute the expressions for $n_i$ and $n$ into the definition of $X_i$:\n    $$ X_i = \\frac{n_i}{n} = \\frac{m Y_i / W_i}{m \\sum_j (Y_j / W_j)} $$\n6.  The total mass $m$ cancels, yielding the desired mapping from mass fractions to mole fractions:\n    $$ X_i = \\frac{Y_i / W_i}{\\sum_{j=1}^{N} Y_j / W_j} $$\n\n**2. Derivation of the Partial Derivative $\\partial X_i / \\partial Y_k$**\n\nTo simplify the differentiation, we first relate the denominator of the expression for $X_i$ to the mixture molecular weight, $\\bar{W}$. By definition, $\\bar{W} = m/n$. Substituting the expression for $n$ from step 4 above:\n$$ \\bar{W} = \\frac{m}{m \\sum_j (Y_j / W_j)} = \\frac{1}{\\sum_j (Y_j / W_j)} $$\nSo, the denominator is simply the reciprocal of the mixture molecular weight, $1/\\bar{W}$. This allows us to write $X_i$ in a more compact form:\n$$ X_i = \\frac{Y_i}{W_i} \\bar{W} $$\nNow we can compute the partial derivative of $X_i$ with respect to an arbitrary mass fraction $Y_k$. Since $\\bar{W}$ is a function of all $Y_j$, we must use the product rule:\n$$ \\frac{\\partial X_i}{\\partial Y_k} = \\frac{\\partial}{\\partial Y_k} \\left( \\frac{Y_i \\bar{W}}{W_i} \\right) = \\frac{1}{W_i} \\left[ \\frac{\\partial Y_i}{\\partial Y_k} \\bar{W} + Y_i \\frac{\\partial \\bar{W}}{\\partial Y_k} \\right] $$\nThe term $\\frac{\\partial Y_i}{\\partial Y_k}$ is simply the Kronecker delta, $\\delta_{ik}$. To proceed, we need the derivative of $\\bar{W}$ with respect to $Y_k$. Using the chain rule on $\\bar{W} = (\\sum_j Y_j/W_j)^{-1}$:\n$$ \\frac{\\partial \\bar{W}}{\\partial Y_k} = \\frac{d\\bar{W}}{d(\\sum \\dots)} \\frac{\\partial (\\sum_j Y_j/W_j)}{\\partial Y_k} = - \\left(\\sum_j \\frac{Y_j}{W_j}\\right)^{-2} \\left(\\frac{1}{W_k}\\right) = -(\\bar{W})^2 \\frac{1}{W_k} = -\\frac{\\bar{W}^2}{W_k} $$\nSubstituting this back into the expression for $\\partial X_i / \\partial Y_k$:\n$$ \\frac{\\partial X_i}{\\partial Y_k} = \\frac{1}{W_i} \\left[ \\delta_{ik} \\bar{W} - Y_i \\frac{\\bar{W}^2}{W_k} \\right] = \\frac{\\bar{W}}{W_i}\\delta_{ik} - \\frac{Y_i \\bar{W}^2}{W_i W_k} $$\nFinally, we express the result purely in terms of the requested variables by substituting $Y_i = (X_i W_i) / \\bar{W}$:\n$$ \\frac{\\partial X_i}{\\partial Y_k} = \\frac{\\bar{W}}{W_i}\\delta_{ik} - \\frac{(X_i W_i / \\bar{W}) \\bar{W}^2}{W_i W_k} = \\frac{\\bar{W}}{W_i}\\delta_{ik} - \\frac{X_i \\bar{W}}{W_k} $$\nThis is the final expression for the derivative.\n\n**3. Analysis of Error Propagation**\n\nThe derived partial derivative forms the Jacobian matrix that maps changes in mass fractions to changes in mole fractions. A physically consistent set of errors in mass fractions, $\\{\\Delta Y_j\\}$, must sum to zero: $\\sum_j \\Delta Y_j = 0$. The resulting change in a given mole fraction $X_i$ is given by the total differential:\n$$ \\Delta X_i \\approx \\sum_j \\frac{\\partial X_i}{\\partial Y_j} \\Delta Y_j $$\nSubstituting our derived expression for the partial derivative:\n$$ \\Delta X_i \\approx \\sum_j \\left( \\frac{\\bar{W}}{W_i}\\delta_{ij} - \\frac{X_i \\bar{W}}{W_j} \\right) \\Delta Y_j = \\frac{\\bar{W}}{W_i}\\Delta Y_i - X_i \\bar{W} \\sum_j \\frac{\\Delta Y_j}{W_j} $$\nThe relative error in $X_i$ is $\\Delta X_i / X_i$. Let's analyze the scenario from the prompt: we are interested in the error in a light trace species $i$ (small $W_i$, $X_i \\ll 1$) caused by an error in some other species. This means we are analyzing a case where $i \\neq j$ for any non-zero $\\Delta Y_j$, so $\\Delta Y_i = 0$. The expression simplifies to:\n$$ \\Delta X_i \\approx - X_i \\bar{W} \\sum_j \\frac{\\Delta Y_j}{W_j} \\quad \\implies \\quad \\frac{\\Delta X_i}{X_i} \\approx - \\bar{W} \\sum_j \\frac{\\Delta Y_j}{W_j} $$\nThis key relation shows that the relative error in any trace species $i$ is driven by the mixture molecular weight $\\bar{W}$ and a weighted sum of all the mass fraction errors, with each error $\\Delta Y_j$ being weighted by the reciprocal of its molecular weight, $1/W_j$.\n\nNow, consider the specific scenario: a small absolute error $\\Delta Y_k = \\epsilon$ in a heavy species ($W_k$ is large). This error must be compensated by errors in other species. If the error is primarily balanced by a change in a very light species $b$ ($W_b$ is small), we have $\\Delta Y_b \\approx -\\epsilon$. The sum becomes:\n$$ \\sum_j \\frac{\\Delta Y_j}{W_j} \\approx \\frac{\\epsilon}{W_k} - \\frac{\\epsilon}{W_b} = \\epsilon \\left(\\frac{1}{W_k} - \\frac{1}{W_b}\\right) $$\nSince $W_k$ is large and $W_b$ is small, $1/W_k$ is small and $1/W_b$ is large. The sum is therefore dominated by the light species: $\\sum_j \\frac{\\Delta Y_j}{W_j} \\approx -\\epsilon/W_b$.\n\nSubstituting this back into the relative error formula for our trace species $i$:\n$$ \\frac{\\Delta X_i}{X_i} \\approx - \\bar{W} \\left( -\\frac{\\epsilon}{W_b} \\right) = \\frac{\\bar{W}}{W_b} \\epsilon = \\frac{\\bar{W}}{W_b} \\Delta Y_k $$\nThe magnitude of the relative error in $X_i$ is amplified from the absolute error in $Y_k$ by a factor of $\\bar{W}/W_b$. This amplification factor can be very large. For instance, in a mixture of mostly nitrogen ($\\bar{W} \\approx 28 \\, \\text{g/mol}$) with trace amounts of other species, if an error in a heavy component is balanced by adjusting the mass fraction of hydrogen ($W_b \\approx 2 \\, \\text{g/mol}$), the amplification factor is approximately $28/2 = 14$. A mere 1% absolute error in the heavy species' mass fraction ($\\Delta Y_k = 0.01$) would induce a $14 \\times 1\\% = 14\\%$ relative error in the mole fraction of any other trace species. This is a \"disproportionately large\" relative error.\n\nAt the same time, the absolute change in $X_i$ is $\\Delta X_i = X_i \\times (\\text{relative error})$. Since species $i$ is a trace species, its mole fraction $X_i$ is very small ($X_i \\ll 1$). Therefore, even with a large relative error, the absolute change $\\Delta X_i$ remains small, just as the prompt states.",
            "answer": "$$ \\boxed{ \\frac{\\partial X_i}{\\partial Y_k} = \\frac{\\bar{W}}{W_i}\\delta_{ik} - \\frac{X_i \\bar{W}}{W_k} } $$"
        }
    ]
}