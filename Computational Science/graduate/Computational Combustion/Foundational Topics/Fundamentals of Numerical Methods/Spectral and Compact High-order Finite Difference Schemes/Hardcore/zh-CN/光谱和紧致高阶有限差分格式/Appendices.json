{
    "hands_on_practices": [
        {
            "introduction": "谱方法的核心在于通过傅里叶变换实现高精度的导数计算。本练习将指导您实现伪谱导数，让您亲眼见证其卓越的“谱精度”，并探索其在不同波数下的行为，包括关键的奈奎斯特频率。完成此练习  将巩固您对谱微分基本机理的理解。",
            "id": "4066305",
            "problem": "考虑一个周期性的一维域 $[0,2\\pi)$，该域在计算燃烧学中模拟反应流的直接数值模拟 (Direct Numerical Simulation) 中的一个均匀方向，其中物种和温度场需要高保真度的梯度。令 $N$ 表示网格点的数量，均匀网格由 $x_j = \\frac{2\\pi}{N} j$ 定义，其中 $j \\in \\{0,1,\\dots,N-1\\}$，角度以弧度为单位。令 $f(x)$ 为在该网格上采样的标量场。周期域上的伪谱一阶导数使用离散傅里叶变换 (DFT) 和快速傅里叶变换 (FFT) 计算算法，这些是经过充分检验的周期性问题数值工具。\n\n从一个足够光滑的周期函数的傅里叶级数表示以及网格 $x_j$ 上相关的离散傅里叶变换 (DFT) 对出发，推导函数 $f(x) = \\sin(kx)$ 的伪谱一阶导数算子，并实现它以计算在 $N=32$ 和 $k=7$ 的情况下网格上的逐点导数。推导必须从标准的DFT定义以及物理空间中的微分对应于谱空间中乘以波数的性质开始，不能预设最终的算法。\n\n你必须验证伪谱导数与精确解析导数之间的最大逐点绝对误差为机器零，该值通过适合双精度浮点运算的阈值 $T$ 来量化。对于本问题，将机器零定义为 $\\lvert \\text{error} \\rvert \\le T$，其中 $T = 10^{-12}$。\n\n你的程序必须：\n- 使用弧度作为角度单位。\n- 对所有测试使用 $N=32$。\n- 在 $[0,2\\pi)$ 上构建周期性网格 $x_j$。\n- 对于每个测试用例，使用给定的整数 $k$ 定义 $f_j = f(x_j)$，其中 $f(x) = \\sin(kx)$。\n- 在周期性网格上使用基于DFT/FFT的方法计算伪谱一阶导数。\n- 计算 $f(x)=\\sin(kx)$ 的精确解析导数 $f'(x)=k\\cos(kx)$，并在网格点上求值。\n- 计算整个网格上的最大逐点绝对误差，并返回一个布尔值，指示该误差是否小于或等于 $T$。\n\n测试套件：\n- 一般可解析模式：$N=32$, $k=7$。\n- 高但可解析的模式：$N=32$, $k=15$。\n- 奈奎斯特模式边界情况：$N=32$, $k=16$。\n- 超出奈奎斯特频率的混叠：$N=32$, $k=17$。\n- 导数为常数的平凡情况：$N=32$, $k=0$。\n\n你的程序应产生单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，“[result1,result2,result3]”），每个条目是一个布尔值，表示相应测试用例的最大逐点绝对误差是否小于或等于 $T$，顺序如上所列。不允许有其他输出。",
            "solution": "该问题是有效的，因为它在科学上基于傅里叶分析和数值方法的原理，问题设定良好，有明确的目标和所有必要的数据，并以客观、正式的语言表述。这些测试用例是谱方法分析中的标准用例，旨在探究算法在可解析模式、奈奎斯特极限和混叠情况下的行为。\n\n我们的任务是推导并实现在域 $[0, 2\\pi)$ 上的周期函数 $f(x)$ 的伪谱一阶导数算子。推导将从傅里叶级数和离散傅里叶变换 (DFT) 的原理开始。\n\n令一个足够光滑的 $2\\pi$-周期函数 $f(x)$ 由其复傅里叶级数表示：\n$$\nf(x) = \\sum_{m=-\\infty}^{\\infty} \\hat{f}_m e^{imx}\n$$\n其中 $\\hat{f}_m$ 是复傅里叶系数，$m$ 是整数波数。对 $x$ 求导得出：\n$$\nf'(x) = \\frac{d}{dx} \\sum_{m=-\\infty}^{\\infty} \\hat{f}_m e^{imx} = \\sum_{m=-\\infty}^{\\infty} (im) \\hat{f}_m e^{imx}\n$$\n这展示了谱方法的基本原理：物理空间中的微分等价于在谱（傅里叶）空间中乘以 $im$，其中 $i = \\sqrt{-1}$。\n\n在计算环境中，连续函数 $f(x)$ 在离散网格上进行采样。问题定义了一个由 $N$ 个点组成的均匀网格 $x_j = \\frac{2\\pi}{N} j$，其中 $j \\in \\{0, 1, \\dots, N-1\\}$。此网格上的函数值记为 $f_j = f(x_j)$。连续傅里叶级数被离散傅里叶变换 (DFT) 对所取代。正向DFT（分析变换）和逆DFT（合成变换）定义如下：\n$$\n\\hat{f}_m^{\\text{DFT}} = \\sum_{j=0}^{N-1} f_j e^{-imx_j} = \\sum_{j=0}^{N-1} f_j e^{-i \\frac{2\\pi mj}{N}}, \\quad m \\in \\{0, 1, \\dots, N-1\\}\n$$\n$$\nf_j = \\frac{1}{N} \\sum_{m=0}^{N-1} \\hat{f}_m^{\\text{DFT}} e^{imx_j} = \\frac{1}{N} \\sum_{m=0}^{N-1} \\hat{f}_m^{\\text{DFT}} e^{i \\frac{2\\pi mj}{N}}, \\quad j \\in \\{0, 1, \\dots, N-1\\}\n$$\n伪谱微分算法利用这个离散框架来近似导数 $f'(x_j)$：\n\n1.  **变换到谱空间**：计算离散函数值 $f_j$ 的DFT，以获得谱系数 $\\hat{f}_m^{\\text{DFT}}$。这通常使用快速傅里叶变换 (FFT) 算法高效完成。\n    $$\n    \\{\\hat{f}_0^{\\text{DFT}}, \\hat{f}_1^{\\text{DFT}}, \\dots, \\hat{f}_{N-1}^{\\text{DFT}}\\} = \\text{FFT}(\\{f_0, f_1, \\dots, f_{N-1}\\})\n    $$\n\n2.  **在谱空间中微分**：将每个谱系数 $\\hat{f}_m^{\\text{DFT}}$ 乘以其对应的有效波数，并乘以 $i$。DFT索引 $m \\in \\{0, 1, \\dots, N-1\\}$ 必须映射到它们所代表的物理波数。对于实值信号，波数关于零对称。对于偶数个点 $N$，DFT索引按如下方式映射到有效波数向量 $m'_{\\text{eff}}$：\n    -   对于 $0 \\le m  N/2$，索引 $m$ 对应于物理波数 $m' = m$。\n    -   对于 $N/2  m  N$，索引 $m$ 对应于一个负（混叠）波数。映射关系为 $m' = m - N$。例如，$m=N-1$ 对应于 $m'=-1$。\n    -   索引 $m=N/2$ 是特殊的，对应于奈奎斯特波数。对于实值输入函数 $f_j$，其导数 $f'_j$ 也必须是实数。序列 $\\hat{g}_m$ 的逆DFT产生实值结果，当且仅当该序列具有厄米共轭对称性，即 $\\hat{g}_m = \\overline{\\hat{g}_{N-m}}$（其中上划线表示复共轭）。让我们将导数的DFT表示为 $\\hat{g}_m = i m'_{\\text{eff}}(m) \\hat{f}_m^{\\text{DFT}}$。对于实数输入 $f_j$，有 $\\hat{f}_m^{\\text{DFT}} = \\overline{\\hat{f}_{N-m}^{\\text{DFT}}}$。对于 $m \\ne 0, N/2$，我们有 $m'_{\\text{eff}}(N-m) = (N-m)-N = -m = -m'_{\\text{eff}}(m)$。那么 $\\hat{g}_{N-m} = i m'_{\\text{eff}}(N-m) \\hat{f}_{N-m}^{\\text{DFT}} = -im'_{\\text{eff}}(m) \\overline{\\hat{f}_m^{\\text{DFT}}} = \\overline{i m'_{\\text{eff}}(m) \\hat{f}_m^{\\text{DFT}}} = \\overline{\\hat{g}_m}$。对称性成立。然而，在奈奎斯特频率 $m=N/2$ 处，$m' = N/2$。对于实信号，$\\hat{f}_{N/2}^{\\text{DFT}}$ 必须是一个实数。微分会得到 $\\hat{g}_{N/2} = i(N/2)\\hat{f}_{N/2}^{\\text{DFT}}$，这是一个纯虚数。这破坏了厄米共轭对称性，因为除非它为零，否则 $\\hat{g}_{N/2} \\ne \\overline{\\hat{g}_{N/2}}$。为确保实函数的导数保持为实数，一个常见的约定是将奈奎斯特模式的导数设为零。\n\n    因此，应用于DFT索引 $m \\in \\{0, 1, \\dots, N-1\\}$ 的有效波数向量 $m'_{\\text{eff}}$ 是：\n    $$\n    m'_{\\text{eff}}(m) = \\begin{cases} m  \\text{if } 0 \\le m  N/2 \\\\ 0  \\text{if } m = N/2 \\\\ m-N  \\text{if } N/2  m  N \\end{cases}\n    $$\n    导数的谱系数 $\\hat{g}_m^{\\text{DFT}}$ 随后计算为：\n    $$\n    \\hat{g}_m^{\\text{DFT}} = i m'_{\\text{eff}}(m) \\hat{f}_m^{\\text{DFT}}\n    $$\n\n3.  **变换回物理空间**：计算修改后的谱系数 $\\hat{g}_m^{\\text{DFT}}$ 的逆DFT，以获得网格上的导数值 $f'_j$。\n    $$\n    \\{f'_0, f'_1, \\dots, f'_{N-1}\\} = \\text{IFFT}(\\{\\hat{g}_0^{\\text{DFT}}, \\hat{g}_1^{\\text{DFT}}, \\dots, \\hat{g}_{N-1}^{\\text{DFT}}\\})\n    $$\n\n对于函数 $f(x) = \\sin(kx) = \\frac{e^{ikx} - e^{-ikx}}{2i}$，其解析导数为 $f'(x) = k\\cos(kx)$。\n-   **情况 $k=7$ 和 $k=15$ ($N=32$)：** 由于 $0  k  N/2 = 16$，波数可以被网格良好地解析。DFT可以精确表示两个正弦分量 $e^{ikx}$ 和 $e^{-ikx}$。伪谱导数将是数值精确的，误差将在机器精度级别。与 $T=10^{-12}$ 的布尔值检查应为真。\n-   **情况 $k=16$ ($N=32$)：** 这是奈奎斯特波数，$k=N/2$。网格上的函数值为 $f_j = \\sin(16 \\cdot \\frac{2\\pi j}{32}) = \\sin(\\pi j) = 0$ (对所有 $j$ 成立)。全零向量的DFT是全零向量。因此，数值导数为零。而解析导数为 $f'(x_j) = 16\\cos(16x_j) = 16\\cos(\\pi j) = 16(-1)^j$。数值结果和解析结果显著不同，因此误差会很大。布尔值检查将为假。\n-   **情况 $k=17$ ($N=32$)：** 这个波数超出了奈奎斯特极限，$|k|N/2$。信号发生了混叠。在网格上，频率 $k=17$ 与频率 $k' = k-N = 17-32 = -15$ 是无法区分的。也就是说，$\\sin(17x_j) = \\sin((32-15)x_j) = \\sin(2\\pi j - 15x_j) = \\sin(-15x_j) = -\\sin(15x_j)$。数值方法将计算 $-\\sin(15x)$ 的导数，即 $-15\\cos(15x)$。这与真实导数 $17\\cos(17x)$ 不相等。误差会很大，布尔值检查将为假。\n-   **情况 $k=0$ ($N=32$)：** 函数为 $f(x) = \\sin(0) = 0$ (对所有 $x$ 成立)。数值导数为零。解析导数为 $f'(x) = 0 \\cdot \\cos(0) = 0$。误差恒为零。布尔值检查将为真。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the pseudo-spectral derivative for f(x) = sin(kx) on a periodic grid\n    and verifies its accuracy against the analytical derivative for several test cases.\n    \"\"\"\n    # Define problem constants\n    N = 32\n    T = 1e-12\n\n    # Define the test suite of wavenumbers k\n    test_cases = [\n        7,  # General resolvable mode\n        15, # High but resolvable mode\n        16, # Nyquist mode edge case\n        17, # Aliasing beyond Nyquist\n        0,  # Trivial constant derivative case\n    ]\n\n    results = []\n    \n    # Construct the periodic grid\n    # x_j = (2*pi/N) * j for j in {0, ..., N-1}\n    x_grid = (2 * np.pi / N) * np.arange(N)\n\n    # Define the effective wavenumbers for differentiation\n    # For a real signal, the derivative of the Nyquist component is set to 0\n    # to ensure the resulting derivative is also real.\n    # np.fft.fftfreq(N) * N gives [0, 1, ..., N/2-1, -N/2, -N/2+1, ..., -1]\n    m_eff = np.fft.fftfreq(N) * N\n    # Set the derivative of the Nyquist mode to zero\n    if N % 2 == 0:\n        m_eff[N // 2] = 0.0\n\n    for k in test_cases:\n        # 1. Define the function f(x) = sin(kx) on the grid\n        f_vals = np.sin(k * x_grid)\n\n        # 2. Compute the pseudo-spectral first derivative\n        # a. Forward FFT to get spectral coefficients\n        f_hat = np.fft.fft(f_vals)\n\n        # b. Multiply by i*m_eff in spectral space\n        df_hat = 1j * m_eff * f_hat\n\n        # c. Inverse FFT to get derivative in physical space\n        # Result should be real; take the real part to discard negligible\n        # imaginary components from floating-point inaccuracies.\n        df_dx_spectral = np.real(np.fft.ifft(df_hat))\n\n        # 3. Compute the exact analytical derivative f'(x) = k*cos(kx) on the grid\n        df_dx_analytical = k * np.cos(k * x_grid)\n\n        # 4. Compute the maximum pointwise absolute error\n        max_abs_error = np.max(np.abs(df_dx_spectral - df_dx_analytical))\n\n        # 5. Verify if the error is within the specified tolerance T\n        results.append(max_abs_error = T)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在实际应用中，由于混叠误差的存在，评估流体动力学中的对流项 $u \\partial_x u$ 等非线性项带来了巨大挑战。本练习  对朴素求值方法和一种更复杂的斜对称形式（一种用于提高模拟稳定性和准确性的技术）进行了定量比较。通过计算混叠误差的减少量，您将深入了解设计稳健数值格式的实用技巧。",
            "id": "4066241",
            "problem": "考虑周期域 $[0,2\\pi]$ 上的无粘伯格斯方程，\n$$\\partial_t u + \\partial_x \\left(\\tfrac{1}{2} u^2\\right) = 0,$$\n将其作为计算燃烧学中非线性对流输运的典型模型。在伪谱离散化中，非线性项通常在物理空间中计算，然后变换回谱空间，这会因未解析的高波数相互作用的离散卷积截断而引起混叠。在用于反应流的高阶格式中，一种常用的补救方法是采用斜对称分裂形式，以减轻由混叠驱动的向未解析模态的能量传递。\n\n您的任务是定量比较在有限分辨率 $N$ 下，两种伪谱计算非线性项所产生的混叠误差：\n\n- 朴素计算，定义为 $u$ 与其谱导数 $u_x$ 的逐点相乘：\n$$\\mathcal{N}_{\\mathrm{naive}}(x) := u(x) \\, \\partial_x u(x)。$$\n\n- 斜对称分裂形式，定义为对流形式和通量形式的算术平均值：\n$$\\mathcal{N}_{\\mathrm{skew}}(x) := \\tfrac{1}{2}\\left(u(x)\\,\\partial_x u(x) + \\partial_x\\left(\\tfrac{1}{2}u(x)^2\\right)\\right)。$$\n\n为了在分辨率 $N$ 下定义一个参考（无混叠）非线性项，请使用 $3/2$ 反混叠规则。具体步骤如下：\n1. 将 $u(x)$ 解析地上采样到大小为 $N_p = \\lfloor \\tfrac{3}{2}N \\rfloor$ 的精细网格上，该网格覆盖相同的周期域 $[0,2\\pi]$。\n2. 在精细网格上计算 $u(x)^2$。\n3. 在精细网格上计算 $\\tfrac{1}{2}u(x)^2$ 的谱导数。\n4. 将精细网格谱截断回粗分辨率 $N$（仅保留低波数内容），然后进行反变换，以获得一个粗网格物理空间场，记为 $\\mathcal{N}^\\star(x)$。\n\n定义一个近似值 $\\mathcal{N}(x)$ 在分辨率 $N$ 下的相对混叠误差为无量纲均方根范数\n$$E(\\mathcal{N}) := \\frac{\\left\\|\\mathcal{N}(x) - \\mathcal{N}^\\star(x)\\right\\|_2}{\\left\\|\\mathcal{N}^\\star(x)\\right\\|_2},$$\n其中 $L^2$ 范数是在大小为 $N$ 的粗网格上对 $[0,2\\pi]$ 计算的。通过缩减因子\n$$R := \\frac{E(\\mathcal{N}_{\\mathrm{naive}})}{E(\\mathcal{N}_{\\mathrm{skew}})}$$\n来量化斜对称形式相对于朴素形式实现的混叠误差缩减。\n\n角度必须以弧度解释。不涉及物理单位。您的程序必须为以下每个测试用例计算 $R$，每个测试用例由 $(N,\\text{components})$ 指定，其中\n$$u(x) = \\sum_{j=1}^{J_s} A_j \\sin(k_j x + \\phi_j) + \\sum_{\\ell=1}^{J_c} B_\\ell \\cos(m_\\ell x + \\psi_\\ell),$$\n具有整数波数以及实数振幅和相位：\n\n- 测试用例 1：$N=64$，分量 $\\left[(\\sin, A=1.0, k=3, \\phi=0), (\\sin, A=0.5, k=7, \\phi=0), (\\cos, B=0.25, m=5, \\psi=0)\\right]$。\n- 测试用例 2：$N=32$，分量 $\\left[(\\sin, A=1.0, k=15, \\phi=0), (\\sin, A=0.7, k=16, \\phi=0)\\right]$。\n- 测试用例 3：$N=128$，分量 $\\left[(\\sin, A=1.0, k=20, \\phi=0), (\\sin, A=0.8, k=27, \\phi=0), (\\cos, B=0.6, m=9, \\psi=0), (\\cos, B=0.4, m=13, \\psi=0)\\right]$。\n- 测试用例 4：$N=128$，分量 $\\left[(\\sin, A=1.0, k=2, \\phi=0)\\right]$。\n\n您的程序应生成单行输出，其中包含上述测试用例的四个缩减因子 $R$，格式为方括号括起来的逗号分隔列表（例如，$[r_1,r_2,r_3,r_4]$）。结果必须是浮点数。",
            "solution": "该问题要求对无粘伯格斯方程 $\\partial_t u + \\partial_x \\left(\\tfrac{1}{2} u^2\\right) = 0$ 中非线性对流项的两种不同伪谱计算方法所产生的混叠误差进行定量比较。这两种形式是朴素乘积 $\\mathcal{N}_{\\mathrm{naive}}(x)$ 和斜对称公式 $\\mathcal{N}_{\\mathrm{skew}}(x)$。比较基于一个缩减因子 $R$，该因子衡量了斜对称形式相对于朴素形式在减轻混叠误差方面的改进程度。混叠误差本身是通过将每种近似与一个高保真度参考项 $\\mathcal{N}^\\star(x)$ 进行比较来量化的，该参考项使用 $3/2$ 反混叠规则计算得出。\n\n整个过程在由均匀网格离散化的周期域 $[0, 2\\pi]$ 上进行数值计算。核心的数值工具是用于在物理空间和谱（波数）空间之间转换的快速傅里叶变换（FFT），以及谱微分。\n\n**1. 伪谱离散化**\n\n周期域 $[0, 2\\pi]$ 上的函数 $f(x)$ 由其在 $N$ 个离散点 $x_j = j \\frac{2\\pi}{N}$（其中 $j=0, 1, \\dots, N-1$）上的值表示。离散傅里叶变换（DFT）通过FFT高效计算，将此物理空间表示 $f(x_j)$ 映射到谱空间表示 $\\hat{f}_k$，即有限傅里叶级数展开的系数。\n\n空间导数 $\\partial_x f(x)$ 在谱空间中计算。导数的傅里叶变换 $\\widehat{\\partial_x f}_k$ 是通过将每个傅里叶系数 $\\hat{f}_k$ 乘以 $ik$ 得到的，其中 $i = \\sqrt{-1}$，$k$ 是整数波数。对于一个 $N$ 点网格，其所能表示的波数通常为 $k \\in \\{0, \\pm 1, \\dots, \\pm(N/2-1), N/2\\}$（对于偶数 $N$），其中最高正波数和负波数在奈奎斯特频率 $N/2$ 处混叠。然后通过对所得谱 $\\widehat{\\partial_x f}_k$ 应用逆FFT来求得导数。对于实值函数，此过程可以使用实数到复数的FFT（`rfft`）及其逆变换进行优化。奈奎斯特模态 $k=N/2$ 的导数被设为零，因为它在网格上没有明确定义。\n\n**2. 近似非线性项的计算**\n\n$\\mathcal{N}_{\\mathrm{naive}}(x)$ 和 $\\mathcal{N}_{\\mathrm{skew}}(x)$ 都在大小为 $N$ 的粗网格上计算。令 $D_N$ 表示此网格上的谱微分算子。\n\n- **朴素形式**：$\\mathcal{N}_{\\mathrm{naive}}(x) := u(x) \\, \\partial_x u(x)$。\n算法如下：\n1.  从在 $N$ 点网格上求值的函数 $u(x)$ 开始，得到向量 $u$。\n2.  计算其谱导数，$u_x = D_N(u)$。\n3.  计算逐点乘积 $\\mathcal{N}_{\\mathrm{naive}} = u \\odot u_x$，其中 $\\odot$ 表示逐元素相乘。\n\n这种计算被称为“朴素”计算，因为由 $N$ 个傅里叶模态表示的两个函数进行逐点相乘会产生更高波数的模态，而这些模态在 $N$ 点网格上无法表示。这些无法解析的模态会发生混叠，即它们被错误地投影到已解析的波数上，从而引入误差。\n\n- **斜对称形式**：$\\mathcal{N}_{\\mathrm{skew}}(x) := \\tfrac{1}{2}\\left(u(x)\\,\\partial_x u(x) + \\partial_x\\left(\\tfrac{1}{2}u(x)^2\\right)\\right)$。\n这是对流形式 $u u_x$ 和通量散度形式 $\\partial_x(\\frac{1}{2}u^2)$ 的算术平均。\n算法如下：\n1.  计算朴素项，$\\mathcal{N}_{\\mathrm{naive}} = u \\odot D_N(u)$。\n2.  计算通量散度项：\n    a. 在网格上逐点计算 $u^2$。\n    b. 应用谱微分算子：$\\mathcal{N}_{\\mathrm{flux}} = D_N(\\tfrac{1}{2}u^2)$。\n3.  对两种形式求平均：$\\mathcal{N}_{\\mathrm{skew}} = \\tfrac{1}{2}(\\mathcal{N}_{\\mathrm{naive}} + \\mathcal{N}_{\\mathrm{flux}})$。\n\n虽然在连续形式下等价，但这两种形式在离散情况下并不相同。已知斜对称形式具有更好的守恒性质，并且可以减轻由混叠引起的稳定性问题。\n\n**3. 参考“无混叠”项 ($\\mathcal{N}^\\star$)**\n\n参考项 $\\mathcal{N}^\\star(x)$ 使用 $3/2$ 反混叠规则计算，该规则提供的结果不受影响粗网格计算的混叠误差的影响。\n其过程如下：\n1.  定义一个大小为 $N_p = \\lfloor \\tfrac{3}{2}N \\rfloor$ 的精细网格。\n2.  在此精细网格上计算解析函数 $u(x)$，得到 $u_{pad}$。\n3.  在精细网格上逐点计算通量 $\\tfrac{1}{2}u^2$，得到 $(\\tfrac{1}{2}u^2)_{pad}$。\n4.  使用算子 $D_{N_p}$ 在精细网格上计算谱导数：$\\mathcal{N}_{pad} = D_{N_p}((\\tfrac{1}{2}u^2)_{pad})$。此结果被认为是无混叠的，因为精细网格足够大，可以表示由 $u(x)$（其模态在粗网格上是可解析的）的二次非线性产生的所有波数相互作用。\n5.  通过FFT将 $\\mathcal{N}_{pad}$ 变换到谱域：$\\hat{\\mathcal{N}}_{pad} = \\text{FFT}(\\mathcal{N}_{pad})$。\n6.  通过仅保留在粗糙 $N$ 点网格上可解析的模态来截断谱 $\\hat{\\mathcal{N}}_{pad}$。这包括保留实数FFT谱的前 $N/2+1$ 个系数。\n7.  对截断后的谱应用大小为 $N$ 的逆FFT，以在粗网格上获得参考项 $\\mathcal{N}^\\star(x)$。\n\n**4. 误差量化**\n\n近似的准确性通过相对混叠误差来衡量，该误差定义为与参考项之差的离散 $L^2$ 范数，并由参考项本身的 $L^2$ 范数进行归一化。对于 $N$ 点网格上的向量 $f$，其范数为 $\\|f\\|_2 = \\sqrt{\\sum_{j=0}^{N-1} |f_j|^2}$。\n$$E(\\mathcal{N}) := \\frac{\\|\\mathcal{N} - \\mathcal{N}^\\star\\|_2}{\\|\\mathcal{N}^\\star\\|_2}$$\n计算出两个误差 $E(\\mathcal{N}_{\\mathrm{naive}})$ 和 $E(\\mathcal{N}_{\\mathrm{skew}})$。\n\n最终的度量标准是缩减因子 $R$，它比较这两个误差：\n$$R := \\frac{E(\\mathcal{N}_{\\mathrm{naive}})}{E(\\mathcal{N}_{\\mathrm{skew}})}$$\n$R  1$ 的值表明斜对称形式比朴素形式更准确。\n\n整体算法通过为每个指定的测试用例执行这些步骤来进行。函数 $u(x)$ 是由给定的正弦和余弦分量构建的。所有的谱操作（微分、截断）都使用 `numpy.fft.rfft` 和 `numpy.fft.irfft` 来实现，以保证效率和对实值数据的正确处理。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the aliasing error reduction factor for pseudo-spectral evaluations\n    of the nonlinear term in Burgers' equation.\n    \"\"\"\n\n    test_cases = [\n        (64, [('sin', 1.0, 3, 0), ('sin', 0.5, 7, 0), ('cos', 0.25, 5, 0)]),\n        (32, [('sin', 1.0, 15, 0), ('sin', 0.7, 16, 0)]),\n        (128, [('sin', 1.0, 20, 0), ('sin', 0.8, 27, 0), ('cos', 0.6, 9, 0), ('cos', 0.4, 13, 0)]),\n        (128, [('sin', 1.0, 2, 0)])\n    ]\n\n    results = []\n\n    for N, components in test_cases:\n        # Step 0: Define a factory for the analytical function u(x)\n        def get_u_func(comps):\n            def u_func(x):\n                val = np.zeros_like(x)\n                for comp in comps:\n                    form, amp, k, phase = comp\n                    if form == 'sin':\n                        val += amp * np.sin(k * x + phase)\n                    elif form == 'cos':\n                        val += amp * np.cos(k * x + phase)\n                return val\n            return u_func\n\n        # Step 1: Define grids and evaluate analytical solution u(x)\n        Np = int(1.5 * N)\n        x_coarse = np.linspace(0, 2 * np.pi, N, endpoint=False)\n        x_pad = np.linspace(0, 2 * np.pi, Np, endpoint=False)\n\n        u_func = get_u_func(components)\n        u_coarse = u_func(x_coarse)\n        u_pad = u_func(x_pad)\n\n        # Helper function for spectral derivative using real FFTs\n        def rspectral_derivative(f, n_grid):\n            # The length of the rfft output is n_grid//2 + 1\n            k_vec = np.arange(n_grid // 2 + 1)\n            f_hat = np.fft.rfft(f)\n            \n            # Derivative in spectral space is multiplication by ik\n            df_hat = 1j * k_vec * f_hat\n            \n            # The derivative of the Nyquist mode is zero on the grid\n            if n_grid % 2 == 0:\n                df_hat[-1] = 0.0\n            \n            # Inverse FFT to get derivative in physical space\n            return np.fft.irfft(df_hat, n=n_grid)\n\n        # Step 2: Compute the naive term N_naive on the coarse grid\n        du_dx_coarse = rspectral_derivative(u_coarse, N)\n        N_naive = u_coarse * du_dx_coarse\n\n        # Step 3: Compute the skew-symmetric term N_skew on the coarse grid\n        u2_coarse = 0.5 * u_coarse**2\n        flux_form = rspectral_derivative(u2_coarse, N)\n        N_skew = 0.5 * (N_naive + flux_form)\n\n        # Step 4: Compute the reference term N_star using 3/2 de-aliasing rule\n        u2_pad = 0.5 * u_pad**2\n        N_pad = rspectral_derivative(u2_pad, Np)\n\n        # Truncate the fine-grid spectrum to the coarse grid resolution\n        hat_N_pad = np.fft.rfft(N_pad)\n        k_max_coarse_len = N // 2 + 1\n        hat_N_star = np.zeros(k_max_coarse_len, dtype=complex)\n        \n        # Copy the low-wavenumber content from the padded spectrum\n        hat_N_star[:k_max_coarse_len] = hat_N_pad[:k_max_coarse_len]\n        \n        # Invert the truncated spectrum to get the coarse-grid reference field\n        N_star = np.fft.irfft(hat_N_star, n=N)\n\n        # Step 5: Compute errors and the reduction factor R\n        norm_N_star = np.linalg.norm(N_star)\n\n        if norm_N_star  1e-15:\n            # If reference is zero, any non-zero approximation gives infinite error.\n            # If both approx are also zero, errors are 0, ratio is undefined (treat as 1).\n            if np.linalg.norm(N_naive)  1e-15 and np.linalg.norm(N_skew)  1e-15:\n                R = 1.0\n            else:\n                R = np.nan\n        else:\n            E_naive = np.linalg.norm(N_naive - N_star) / norm_N_star\n            E_skew = np.linalg.norm(N_skew - N_star) / norm_N_star\n\n            if E_skew  1e-15:\n                # If skew-symmetric form is (nearly) perfect\n                if E_naive  1e-15:\n                    # and naive form is also perfect, the ratio is 1.\n                    R = 1.0\n                else:\n                    # but naive form has error, the reduction is infinite.\n                    R = np.inf\n            else:\n                R = E_naive / E_skew\n        \n        results.append(R)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "除了谱方法，紧致有限差分格式为实现高阶精度提供了另一条途径，其窄模板的特性尤为有利。然而，空间离散化的选择在与时间步进方法耦合时，会深刻影响整个模拟的稳定性。本问题  深入探讨了这一关键联系，要求您对一个高阶紧致格式进行冯·诺依曼稳定性分析，从而确定显式和隐式时间积分器的操作极限。",
            "id": "4066301",
            "problem": "在计算燃烧学的预混火焰模拟中，温度或物质组分的扩散输运可以局部理想化为一维热方程。考虑定义在间距为 $\\Delta x$ 的均匀周期性网格上的纯扩散方程 $u_{t}=\\nu\\,u_{xx}$，其空间项采用六阶紧致三对角近似来逼近二阶导数。紧致拉普拉斯算子由以下关系隐式定义\n$$\n\\alpha\\,\\delta^{(2)} u_{j-1}+\\delta^{(2)} u_{j}+\\alpha\\,\\delta^{(2)} u_{j+1}\n=\\frac{1}{\\Delta x^{2}}\\Big[a\\,(u_{j-1}-2u_{j}+u_{j+1})+b\\,(u_{j-2}-2u_{j}+u_{j+2})\\Big],\n$$\n其中 $\\delta^{(2)} u_{j}$ 表示在网格点 $x_{j}$ 处对 $u_{xx}$ 的有限差分近似，常数 $\\alpha$、$a$ 和 $b$ 的选择使得 $\\delta^{(2)}$ 的截断误差为 $\\mathcal{O}(\\Delta x^{6})$。\n\n仅使用泰勒级数相容性和在周期性网格上以弧度为单位的无量纲波数进行的傅里叶模态分析，确定最大的无量纲时间步长比 $C_{\\max}=\\nu\\,\\Delta t/\\Delta x^{2}$，使得将此空间离散格式与前向欧拉 (Forward Euler, FE) 时间积分器耦合得到的全离散格式对所有可分辨的傅里叶模态都是线性稳定的。然后，通过报告将 Crank–Nicolson (CN) 时间积分器应用于相同空间离散格式时对应的 $C_{\\max}$，与 CN 方法进行比较。\n\n您的答案必须是一个数对，依次给出前向欧拉和 Crank–Nicolson 的最大稳定比率。以闭合形式表示任何精确值；无需四舍五入。最终答案中不要包含单位。",
            "solution": "用户提供了一个有效的问题陈述。该问题具有科学依据、良定、客观，并包含了求解所需的所有必要信息。\n\n问题要求求解一维扩散方程 $u_t = \\nu u_{xx}$ 的最大稳定无量纲时间步长比 $C_{\\max} = \\nu \\Delta t / \\Delta x^2$。该方程使用六阶紧致有限差分格式对空间导数进行离散，并采用两种不同的时间积分器：前向欧拉 (Forward Euler, FE) 和 Crank-Nicolson (CN)。\n\n求解过程包括三个主要部分：\n1.  确定六阶紧致空间格式的系数。\n2.  对 FE 时间积分器进行 von Neumann 稳定性分析，以求得 $C_{\\max, FE}$。\n3.  对 CN 时间积分器进行 von Neumann 稳定性分析，以求得 $C_{\\max, CN}$。\n\n**第一部分：确定紧致格式的系数**\n\n在网格点 $x_j$ 处，对二阶导数 $u_{xx}$ 的六阶紧致近似 $\\delta^{(2)}u_j$ 定义为：\n$$\n\\alpha\\,\\delta^{(2)} u_{j-1}+\\delta^{(2)} u_{j}+\\alpha\\,\\delta^{(2)} u_{j+1}\n=\\frac{1}{\\Delta x^{2}}\\Big[a\\,(u_{j-1}-2u_{j}+u_{j+1})+b\\,(u_{j-2}-2u_{j}+u_{j+2})\\Big]\n$$\n为了找到确保六阶精度的系数 $\\alpha$、$a$ 和 $b$，我们在傅里叶空间中分析该格式。令 $u_j = \\exp(i k x_j) = \\exp(i k j \\Delta x)$。精确的二阶导数为 $u_{xx} = -k^2 u_j$。数值近似可以写为 $\\delta^{(2)} u_j = -(k')^2 u_j$，其中 $k'$ 是修正波数。令 $\\xi = k \\Delta x$ 为无量纲波数。\n\n将傅里叶模态 $u_j = \\exp(i j \\xi)$ 代入定义关系式中，得到：\n$$\n-(k')^2 \\left( \\alpha e^{-i\\xi} + 1 + \\alpha e^{i\\xi} \\right) u_j = \\frac{1}{\\Delta x^2} \\left( a(e^{-i\\xi} - 2 + e^{i\\xi}) + b(e^{-2i\\xi} - 2 + e^{2i\\xi}) \\right) u_j\n$$\n化简后得到：\n$$\n-(k')^2 (1 + 2\\alpha \\cos\\xi) = \\frac{1}{\\Delta x^2} \\left( 2a(\\cos\\xi - 1) + 2b(\\cos(2\\xi) - 1) \\right)\n$$\n求解 $(k')^2$：\n$$\n(k')^2 = \\frac{1}{\\Delta x^2} \\frac{2a(1-\\cos\\xi) + 2b(1-\\cos(2\\xi))}{1+2\\alpha\\cos\\xi}\n$$\n使用恒等式 $1-\\cos\\xi = 2\\sin^2(\\xi/2)$ 和 $1-\\cos(2\\xi) = 2\\sin^2(\\xi)$，我们得到：\n$$\n(k'\\Delta x)^2 = \\frac{4a\\sin^2(\\xi/2) + 4b\\sin^2(\\xi)}{1+2\\alpha\\cos\\xi}\n$$\n为了达到六阶精度，空间算子的截断误差必须为 $\\mathcal{O}(\\Delta x^6)$。这意味着数值算子的符号 $(k'\\Delta x)^2$ 必须与精确算子的符号 $(k\\Delta x)^2 = \\xi^2$ 匹配，直到 $\\mathcal{O}(\\xi^8)$ 项。\n$$\n\\frac{4a\\sin^2(\\xi/2) + 4b\\sin^2(\\xi)}{1+2\\alpha\\cos\\xi} = \\xi^2 + \\mathcal{O}(\\xi^8)\n$$\n这可以重写为：\n$$\n4a\\sin^2(\\xi/2) + 4b\\sin^2(\\xi) = \\xi^2(1+2\\alpha\\cos\\xi) + \\mathcal{O}(\\xi^8)\n$$\n我们将两边在 $\\xi=0$ 附近展开为泰勒级数：\n左手边 (LHS) 为：\n$$\n\\text{LHS} = 4a\\left(\\frac{\\xi^2}{4}-\\frac{\\xi^4}{48}+\\frac{\\xi^6}{1440} - \\dots\\right) + 4b\\left(\\xi^2-\\frac{\\xi^4}{3}+\\frac{2\\xi^6}{45} - \\dots\\right)\n$$\n$$\n\\text{LHS} = (a+4b)\\xi^2 - \\left(\\frac{a}{12}+\\frac{4b}{3}\\right)\\xi^4 + \\left(\\frac{a}{360}+\\frac{8b}{45}\\right)\\xi^6 + \\mathcal{O}(\\xi^8)\n$$\n右手边 (RHS) 为：\n$$\n\\text{RHS} = \\xi^2\\left[1+2\\alpha\\left(1-\\frac{\\xi^2}{2}+\\frac{\\xi^4}{24}-\\frac{\\xi^6}{720}+\\dots\\right)\\right]\n$$\n$$\n\\text{RHS} = (1+2\\alpha)\\xi^2 - \\alpha\\xi^4 + \\frac{\\alpha}{12}\\xi^6 - \\frac{\\alpha}{360}\\xi^8 + \\mathcal{O}(\\xi^{10})\n$$\n匹配 $\\xi^2$、$\\xi^4$ 和 $\\xi^6$ 的幂次系数：\n1.  $\\xi^2$: $a+4b = 1+2\\alpha \\implies a+4b-2\\alpha = 1$\n2.  $\\xi^4$: $-\\left(\\frac{a}{12}+\\frac{4b}{3}\\right) = -\\alpha \\implies a+16b = 12\\alpha \\implies a+16b-12\\alpha = 0$\n3.  $\\xi^6$: $\\frac{a}{360}+\\frac{8b}{45} = \\frac{\\alpha}{12} \\implies a+64b = 30\\alpha \\implies a+64b-30\\alpha = 0$\n\n我们求解这个线性系统。将(2)式减去(1)式得到 $12b-10\\alpha = -1$。将(3)式减去(2)式得到 $48b-18\\alpha=0$，化简为 $8b = 3\\alpha$，即 $\\alpha = \\frac{8}{3}b$。\n将此代入 $12b-10\\alpha=-1$：\n$$\n12b - 10\\left(\\frac{8}{3}b\\right) = -1 \\implies 12b - \\frac{80}{3}b = -1 \\implies \\frac{36-80}{3}b = -1 \\implies -\\frac{44}{3}b = -1 \\implies b = \\frac{3}{44}\n$$\n现在我们求 $\\alpha$ 和 $a$：\n$$\n\\alpha = \\frac{8}{3}b = \\frac{8}{3}\\left(\\frac{3}{44}\\right) = \\frac{8}{44} = \\frac{2}{11}\n$$\n$$\na = 1 - 4b + 2\\alpha = 1 - 4\\left(\\frac{3}{44}\\right) + 2\\left(\\frac{2}{11}\\right) = 1 - \\frac{3}{11} + \\frac{4}{11} = 1 + \\frac{1}{11} = \\frac{12}{11}\n$$\n系数为 $\\alpha = \\frac{2}{11}$，$a = \\frac{12}{11}$ 和 $b = \\frac{3}{44}$。\n\n**第二部分：前向欧拉格式的稳定性**\n\n半离散方程为 $\\frac{du_j}{dt} = \\nu \\delta^{(2)} u_j$。在傅里叶空间中，这变为 $\\frac{d\\hat{u}}{dt} = \\nu \\lambda(\\xi) \\hat{u}$，其中 $\\lambda(\\xi)$ 是 $\\delta^{(2)}$ 算子的符号：\n$$\n\\lambda(\\xi) = -(k')^2 = -\\frac{1}{\\Delta x^2} \\frac{4a\\sin^2(\\xi/2) + 4b\\sin^2(\\xi)}{1+2\\alpha\\cos\\xi}\n$$\n我们定义一个非负函数 $f(\\xi)$：\n$$\nf(\\xi) = \\frac{4a\\sin^2(\\xi/2) + 4b\\sin^2(\\xi)}{1+2\\alpha\\cos\\xi}\n$$\n使得 $\\lambda(\\xi) = -f(\\xi)/\\Delta x^2$。前向欧拉格式为 $u_j^{n+1} = u_j^n + \\Delta t (\\nu \\delta^{(2)} u_j^n)$。放大因子 $G(\\xi)$ 为：\n$$\nG_{FE}(\\xi) = 1 + \\nu \\Delta t \\lambda(\\xi) = 1 - \\frac{\\nu \\Delta t}{\\Delta x^2} f(\\xi) = 1 - C f(\\xi)\n$$\n其中 $C = \\nu \\Delta t / \\Delta x^2$。为保证稳定性，对于所有 $\\xi \\in [-\\pi, \\pi]$，必须满足 $|G_{FE}(\\xi)| \\le 1$。由于 $C  0$ 且 $f(\\xi) \\ge 0$，此条件变为：\n$$\n-1 \\le 1 - C f(\\xi) \\le 1 \\implies C f(\\xi) \\le 2\n$$\n此条件必须对所有 $\\xi$ 成立，因此我们要求 $C \\cdot \\max_{\\xi} f(\\xi) \\le 2$。因此，最大稳定时间步长为：\n$$\nC_{\\max, FE} = \\frac{2}{\\max_{\\xi \\in [-\\pi, \\pi]} f(\\xi)}\n$$\n我们必须找到 $f(\\xi)$ 的最大值。代入系数：\n$$\nf(\\xi) = \\frac{4\\left(\\frac{12}{11}\\right)\\sin^2(\\frac{\\xi}{2}) + 4\\left(\\frac{3}{44}\\right)\\sin^2(\\xi)}{1+2\\left(\\frac{2}{11}\\right)\\cos\\xi} = \\frac{\\frac{48}{11}\\sin^2(\\frac{\\xi}{2}) + \\frac{3}{11}\\sin^2(\\xi)}{1+\\frac{4}{11}\\cos\\xi} = \\frac{48\\sin^2(\\frac{\\xi}{2}) + 3\\sin^2(\\xi)}{11+4\\cos\\xi}\n$$\n使用 $\\sin^2(\\frac{\\xi}{2}) = \\frac{1-\\cos\\xi}{2}$ 和 $\\sin^2(\\xi)=1-\\cos^2\\xi$：\n$$\nf(\\xi) = \\frac{48\\left(\\frac{1-\\cos\\xi}{2}\\right) + 3(1-\\cos^2\\xi)}{11+4\\cos\\xi} = \\frac{24(1-\\cos\\xi) + 3(1-\\cos\\xi)(1+\\cos\\xi)}{11+4\\cos\\xi} = \\frac{(1-\\cos\\xi)(24 + 3(1+\\cos\\xi))}{11+4\\cos\\xi} = \\frac{(1-\\cos\\xi)(27+3\\cos\\xi)}{11+4\\cos\\xi}\n$$\n令 $y = \\cos\\xi$。当 $\\xi$ 在 $[-\\pi, \\pi]$ 范围内变化时，$y$ 在 $[-1, 1]$ 范围内变化。我们需要求函数 $g(y) = \\frac{(1-y)(27+3y)}{11+4y}$ 在 $y \\in [-1, 1]$ 上的最大值。\n导数 $g'(y)$ 的一个更直接的计算给出其分子为 $-12y^2-66y-372 = -6(2y^2+11y+62)$。二次式 $2y^2+11y+62$ 的判别式为 $11^2 - 4(2)(62) = 121 - 496 = -375  0$。由于首项系数为正，该二次式恒为正。因此，分子恒为负，故 $g'(y)  0$。\n函数 $g(y)$ 在其定义域上是单调递减的。在区间 $y \\in [-1, 1]$ 上的最大值出现在左端点，即 $y = -1$。这对应于 $\\xi = \\pm\\pi$。\n$$\n\\max_{\\xi} f(\\xi) = g(-1) = \\frac{(1 - (-1))(27 + 3(-1))}{11 + 4(-1)} = \\frac{(2)(24)}{7} = \\frac{48}{7}\n$$\n前向欧拉格式的最大稳定比率为：\n$$\nC_{\\max, FE} = \\frac{2}{48/7} = \\frac{14}{48} = \\frac{7}{24}\n$$\n\n**第三部分：Crank-Nicolson 格式的稳定性**\n\nCrank-Nicolson 格式为 $u_j^{n+1} = u_j^n + \\frac{\\Delta t}{2} \\nu (\\delta^{(2)} u_j^{n+1} + \\delta^{(2)} u_j^n)$。其放大因子为：\n$$\nG_{CN}(\\xi) = \\frac{1 + \\frac{1}{2} \\nu \\Delta t \\lambda(\\xi)}{1 - \\frac{1}{2} \\nu \\Delta t \\lambda(\\xi)} = \\frac{1 - \\frac{1}{2} C f(\\xi)}{1 + \\frac{1}{2} C f(\\xi)}\n$$\n为保证稳定性，我们要求 $|G_{CN}(\\xi)| \\le 1$。令 $X = \\frac{1}{2} C f(\\xi)$。由于 $C0$ 且我们已确定 $f(\\xi) \\ge 0$，因此有 $X \\ge 0$。稳定性条件为：\n$$\n\\left| \\frac{1-X}{1+X} \\right| \\le 1\n$$\n由于 $X$ 是一个非负实数，所以 $1+X \\ge 1$。其模为 $|1-X|/(1+X)$。\n$$\n|1-X| \\le 1+X\n$$\n两边平方（由于两边都非负，这是有效的）：\n$$\n(1-X)^2 \\le (1+X)^2 \\implies 1 - 2X + X^2 \\le 1 + 2X + X^2 \\implies -2X \\le 2X \\implies 0 \\le 4X\n$$\n这个不等式对所有 $X \\ge 0$ 都成立。这意味着对于任何 $C \\ge 0$ 的选择，稳定性条件都得到满足。Crank-Nicolson 格式对于此问题是无条件稳定的。因此，最大稳定时间步长比是无穷大。\n$$\nC_{\\max, CN} = \\infty\n$$\n\n最终答案是分别对应于前向欧拉格式和 Crank-Nicolson 格式的最大稳定比率对。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{7}{24}  \\infty \\end{pmatrix}}\n$$"
        }
    ]
}