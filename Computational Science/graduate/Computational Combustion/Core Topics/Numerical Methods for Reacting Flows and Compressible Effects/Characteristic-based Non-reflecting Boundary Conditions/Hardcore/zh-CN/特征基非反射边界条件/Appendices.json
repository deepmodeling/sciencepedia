{
    "hands_on_practices": [
        {
            "introduction": "理论学习之后，最好的检验方法就是动手实践。第一个练习将引导你从零开始构建一个经典的一维声学脉冲测试。通过这个练习，你将数值模拟一个高斯声波的传播，并应用基于特征线的边界条件，最终通过能量积分来量化边界的反射率。这个过程不仅能加深你对特征波分解的理解，也是验证边界条件实现是否正确的重要手段。",
            "id": "4011716",
            "problem": "考虑与计算燃烧学相关、在均匀介质中的一维小振幅声学问题，其模型为围绕恒定平均态的线性化可压缩流。设平均密度为 $\\rho_0$，声速为 $c_0$，平均流速为 $U_0$。设空间域为区间 $x \\in [0,L]$，在 $x=L$ 处的单位外法线与 $x$ 轴正方向对齐。设 $p'(x,t)$ 和 $u'(x,t)$ 分别表示围绕平均态的压力和速度扰动，并假设其足够小以使线性化成立。线性化控制方程表明，声扰动沿特征线以速度 $U_0 \\pm c_0$ 传播，且通过法向速度为 $u_n'$ 的边界的单位面积瞬时声能通量由乘积 $p' u_n'$ 给出。\n\n您将构造一个纯粹向右传播的高斯声脉冲，并使用基于特征线的边界条件来控制右边界 $x=L$ 处的反射。您的任务是通过在 $x=L$ 处对 $p' u_n'$ 进行时域积分来量化反射能量，使用特征分解来分离入射和出射的贡献，并报告能量反射比。\n\n使用的基本原理：\n- 关于均匀平均流的线性化一维声学：声学信息以速度 $U_0 \\pm c_0$ 传播；可以选择向右传播和向左传播的特征线，使其一者以速度 $U_0 + c_0$ 传播，另一者以速度 $U_0 - c_0$ 传播。\n- 单位面积的声能通量等于 $p' u_n'$。\n- 小振幅（线性）声学：忽略黏性、热释放以及熵或涡模式。\n\n高斯声脉冲测试的设计：\n- 定义向右传播的特征变量（以速度 $U_0 + c_0$ 传播的那个），并在时间 $t=0$ 时将其初始化为一个振幅为 $A$、中心位于 $x=x_0$、标准差为 $\\sigma$ 的高斯脉冲，而向左传播的特征变量（以速度 $U_0 - c_0$ 传播的那个）初始时处处为零。这确保了在 $t=0$ 时有一个纯粹向右传播的声脉冲。\n- 通过尊重特征平流方向的适当稳定数值方法，将特征变量随时间向前演化。使用与 Courant–Friedrichs–Lewy 条件一致的时间步长。\n- 在 $x=L$ 处施加一个基于特征线的边界条件，使得那里的入射特征线与出射特征线成正比，比例系数为预设的反射系数 $r$（可正可负）。在 $x=0$ 处，不注入波；确保没有伪波从 $x=0$ 进入。\n\n右边界处的能量计算：\n- 在 $x=L$ 处，在每个时间点从特征变量中恢复 $p'(L,t)$ 和 $u'(L,t)$，并计算瞬时能量通量 $p'(L,t) \\, u_n'(L,t)$，其中 $u_n'$ 是垂直于边界的速度分量（与 $x$ 轴对齐）。\n- 使用特征分解，分离出射（向右传播）和入射（向左传播）的声学贡献，以便计算由向右传播的波带到边界的入射能量 $E_{\\mathrm{inc}}$ 和由向左传播的波从边界带入域内的反射能量 $E_{\\mathrm{ref}}$。通过在相互作用的整个持续时间内对适当的时间分辨贡献进行积分来计算这些能量。报告无量纲的能量反射比 $\\mathcal{R}_E = E_{\\mathrm{ref}} / E_{\\mathrm{inc}}$。\n\n单位和数值要求：\n- 始终使用国际单位制：距离单位为米，时间单位为秒，密度单位为千克/立方米，速度单位为米/秒。\n- 最终量 $\\mathcal{R}_E$ 是无量纲的；以浮点数形式报告。\n- 选择适当的空间和时间分辨率以精确解析高斯脉冲及其与边界的相互作用。高斯振幅应足够小，以保持在线性范围内。\n\n测试套件：\n对于每组参数，计算如上定义的单个标量输出 $\\mathcal{R}_E$。\n\n所有测试的通用参数：\n- $\\rho_0 = 1.2$ 千克/立方米。\n- $c_0 = 340$ 米/秒。\n- $L = 1.0$ 米。\n- 高斯参数：$x_0 = 0.2$ 米，$\\sigma = 0.05$ 米，$A = 1.0 \\times 10^{-3}$（为保证线性的小振幅）。\n- 演化足够长的时间，以使向右传播的脉冲到达 $x=L$，并且反射信号在 $x=L$ 处被完全生成和计算。\n\n不同测试中的变化参数：\n- 测试 1：马赫数 $M = 0.0$（因此 $U_0 = M c_0$）和反射系数 $r = 0.0$。\n- 测试 2：马赫数 $M = 0.4$ 和反射系数 $r = 0.3$。\n- 测试 3：马赫数 $M = 0.8$ 和反射系数 $r = -0.5$。\n- 测试 4：马赫数 $M = 0.2$ 和反射系数 $r = 0.9$。\n\n您的程序应按上面列出的顺序为四个测试中的每一个计算 $\\mathcal{R}_E$，并生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如 $[\\mathcal{R}_E^{(1)},\\mathcal{R}_E^{(2)},\\mathcal{R}_E^{(3)},\\mathcal{R}_E^{(4)}]$。每个条目必须是四舍五入到四位小数的浮点数。不应打印其他任何文本。",
            "solution": "该问题要求计算在一维流中声脉冲与边界相互作用时的能量反射比 $\\mathcal{R}_E$。解决方案涉及基于特征线法的数值模拟。我将首先形式化物理和数学模型，然后描述数值实现，最后详细说明所需能量比的计算。\n\n### 1. 控制方程和特征变量\n\n该问题通过关于均匀平均态 $(\\rho_0, U_0, p_0)$ 的等熵流的一维线性化欧拉方程进行建模。压力扰动 $p'(x,t)$ 和速度扰动 $u'(x,t)$ 的控制方程可以写成矩阵形式：\n$$\n\\frac{\\partial \\mathbf{q}}{\\partial t} + \\mathbf{A} \\frac{\\partial \\mathbf{q}}{\\partial x} = \\mathbf{0}\n$$\n其中 $\\mathbf{q} = [p', u']^T$ 是状态变量的向量，系统矩阵 $\\mathbf{A}$ 为：\n$$\n\\mathbf{A} = \\begin{pmatrix} U_0  \\rho_0 c_0^2 \\\\ 1/\\rho_0  U_0 \\end{pmatrix}\n$$\n这里，$\\rho_0$ 是平均密度，$c_0$ 是平均声速，$U_0$ 是平均流速。其中已包含了等熵关系 $p' = c_0^2 \\rho'$。\n\n为了求解这个双曲系统，我们使用其特征分解将其转换为一组独立的平流方程。$\\mathbf{A}$ 的特征值给出了特征速度：\n$$\n\\lambda_{1,2} = U_0 \\pm c_0\n$$\n相应的左特征向量 $\\mathbf{l}_{1,2}$ 允许我们定义特征变量（或黎曼不变量）$\\mathcal{L}_1$ 和 $\\mathcal{L}_2$：\n$$\n\\mathbf{l}_1 = [1, \\rho_0 c_0] \\quad \\implies \\quad \\mathcal{L}_1 = p' + \\rho_0 c_0 u' \\quad (\\text{向右传播的波})\n$$\n$$\n\\mathbf{l}_2 = [1, -\\rho_0 c_0] \\quad \\implies \\quad \\mathcal{L}_2 = p' - \\rho_0 c_0 u' \\quad (\\text{向左传播的波})\n$$\n这些特征变量满足简单的平流方程：\n$$\n\\frac{\\partial \\mathcal{L}_1}{\\partial t} + (U_0 + c_0) \\frac{\\partial \\mathcal{L}_1}{\\partial x} = 0\n$$\n$$\n\\frac{\\partial \\mathcal{L}_2}{\\partial t} + (U_0 - c_0) \\frac{\\partial \\mathcal{L}_2}{\\partial x} = 0\n$$\n物理变量 $p'$ 和 $u'$ 可以从特征变量中恢复：\n$$\np' = \\frac{\\mathcal{L}_1 + \\mathcal{L}_2}{2}, \\quad u' = \\frac{\\mathcal{L}_1 - \\mathcal{L}_2}{2 \\rho_0 c_0}\n$$\n\n### 2. 数值实现\n\n我们在离散网格上数值求解这两个解耦的平流方程。空间域 $x \\in [0, L]$ 被离散为 $N_x$ 个点，间距为 $\\Delta x$。时间以步长 $\\Delta t$ 向前推进。为简单和稳定起见，采用了一阶迎风格式。\n\n对于 $\\mathcal{L}_1$，平流速度为 $v_1 = U_0 + c_0$。对于所有测试用例，$M = U_0/c_0 < 1$，所以 $v_1 > 0$。该格式使用来自左侧（迎风方向）的信息：\n$$\n\\mathcal{L}_{1,i}^{n+1} = \\mathcal{L}_{1,i}^n - \\frac{v_1 \\Delta t}{\\Delta x} (\\mathcal{L}_{1,i}^n - \\mathcal{L}_{1,i-1}^n)\n$$\n对于 $\\mathcal{L}_2$，平流速度为 $v_2 = U_0 - c_0 < 0$。该格式使用来自右侧的信息：\n$$\n\\mathcal{L}_{2,i}^{n+1} = \\mathcal{L}_{2,i}^n - \\frac{v_2 \\Delta t}{\\Delta x} (\\mathcal{L}_{2,i+1}^n - \\mathcal{L}_{2,i}^n)\n$$\n时间步长 $\\Delta t$ 的选择要满足 Courant-Friedrichs-Lewy (CFL) 条件：$\\Delta t \\le \\text{CFL} \\cdot \\frac{\\Delta x}{\\max(|v_1|, |v_2|)}$，其中 CFL 数选择为小于 $1$。\n\n### 3. 初始和边界条件\n\n**初始条件 ($t=0$)：** 初始化一个纯粹向右传播的高斯脉冲。向左传播的特征线设置为零。\n$$\n\\mathcal{L}_1(x, 0) = A \\exp\\left(-\\frac{(x-x_0)^2}{2\\sigma^2}\\right), \\quad \\mathcal{L}_2(x, 0) = 0\n$$\n其中 $A$、$x_0$ 和 $\\sigma$ 是给定的脉冲振幅、中心和标准差。\n\n**边界条件：**\n- 在左边界 ($x=0$)，我们必须指定进入域的特征线，即 $\\mathcal{L}_1$（因为 $v_1 > 0$）。为防止波注入，我们将其值在所有时间内设置为零：$\\mathcal{L}_1(0, t) = 0$。出射特征线 $\\mathcal{L}_2$ 使用迎风格式从内部计算。\n- 在右边界 ($x=L$)，出射特征线是 $\\mathcal{L}_1$，从内部计算得出。入射特征线是 $\\mathcal{L}_2$（因为 $v_2 < 0$）。其值由问题指定为与出射特征线成正比，反射系数为 $r$：\n$$\n\\mathcal{L}_2(L, t) = r \\cdot \\mathcal{L}_1(L, t)\n$$\n\n### 4. 能量反射比\n\n问题将声能通量定义为 $I(x, t) = p'(x, t) u'(x, t)$。我们在右边界 $x=L$ 处评估此值。为了找到入射和反射能量，我们必须分解这个通量。将 $p'$ 和 $u'$ 以 $\\mathcal{L}_1$ 和 $\\mathcal{L}_2$ 表示的表达式代入：\n$$\nI(L, t) = \\left(\\frac{\\mathcal{L}_1(L,t) + \\mathcal{L}_2(L,t)}{2}\\right) \\left(\\frac{\\mathcal{L}_1(L,t) - \\mathcal{L}_2(L,t)}{2 \\rho_0 c_0}\\right) = \\frac{1}{4 \\rho_0 c_0} \\left( \\mathcal{L}_1(L,t)^2 - \\mathcal{L}_2(L,t)^2 \\right)\n$$\n这个表达式自然地分解为一个向右传播的分量和一个向左传播的分量。由向右传播的波 $\\mathcal{L}_1$ 携带的入射能量通量被确定为：\n$$\nI_{\\mathrm{inc}}(t) = \\frac{\\mathcal{L}_1(L, t)^2}{4 \\rho_0 c_0}\n$$\n由向左传播的波 $\\mathcal{L}_2$ 携带的反射能量通量的大小为：\n$$\nI_{\\mathrm{ref}}(t) = \\frac{\\mathcal{L}_2(L, t)^2}{4 \\rho_0 c_0}\n$$\n总入射能量 $E_{\\mathrm{inc}}$ 和总反射能量 $E_{\\mathrm{ref}}$ 是通过在边界处波相互作用的持续时间内对这些通量进行积分得到的：\n$$\nE_{\\mathrm{inc}} = \\int_0^{T_{\\mathrm{final}}} I_{\\mathrm{inc}}(t) \\, dt, \\quad E_{\\mathrm{ref}} = \\int_0^{T_{\\mathrm{final}}} I_{\\mathrm{ref}}(t) \\, dt\n$$\n能量反射比 $\\mathcal{R}_E$ 是这些积分能量的比值：\n$$\n\\mathcal{R}_E = \\frac{E_{\\mathrm{ref}}}{E_{\\mathrm{inc}}} = \\frac{\\int_0^{T_{\\mathrm{final}}} \\frac{\\mathcal{L}_2(L, t)^2}{4 \\rho_0 c_0} \\, dt}{\\int_0^{T_{\\mathrm{final}}} \\frac{\\mathcal{L}_1(L, t)^2}{4 \\rho_0 c_0} \\, dt} = \\frac{\\int_0^{T_{\\mathrm{final}}} \\mathcal{L}_2(L, t)^2 \\, dt}{\\int_0^{T_{\\mathrm{final}}} \\mathcal{L}_1(L, t)^2 \\, dt}\n$$\n代入边界条件 $\\mathcal{L}_2(L, t) = r \\cdot \\mathcal{L}_1(L, t)$：\n$$\n\\mathcal{R}_E = \\frac{\\int_0^{T_{\\mathrm{final}}} [r \\cdot \\mathcal{L}_1(L, t)]^2 \\, dt}{\\int_0^{T_{\\mathrm{final}}} \\mathcal{L}_1(L, t)^2 \\, dt} = \\frac{r^2 \\int_0^{T_{\\mathrm{final}}} \\mathcal{L}_1(L, t)^2 \\, dt}{\\int_0^{T_{\\mathrm{final}}} \\mathcal{L}_1(L, t)^2 \\, dt} = r^2\n$$\n这个解析结果表明，在所提供的简化通量定义下，能量反射比就是特征反射系数的平方，与平均流马赫数 $M$ 无关。数值模拟必须对给定的测试用例在计算上验证这一发现。任何数值误差，例如来自一阶格式的耗散，都会影响 $\\mathcal{L}_1(L,t)$，但会通过边界条件按比例传递给 $\\mathcal{L}_2(L,t)$，从而在积分结果中保持 $r^2$ 的比率。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import trapezoid\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It simulates the propagation of a Gaussian acoustic pulse and calculates\n    the energy reflection ratio at the right boundary.\n    \"\"\"\n\n    def solve_case(M, r):\n        \"\"\"\n        Performs the numerical simulation for a single test case.\n\n        Args:\n            M (float): The mean flow Mach number.\n            r (float): The characteristic reflection coefficient at the right boundary.\n\n        Returns:\n            float: The computed energy reflection ratio, R_E.\n        \"\"\"\n        # Common parameters from the problem statement\n        rho0 = 1.2  # kg/m^3\n        c0 = 340.0  # m/s\n        L = 1.0     # m\n        x0 = 0.2    # m\n        sigma = 0.05 # m\n        A = 1.0e-3  # a.u. (small amplitude)\n\n        # Numerical parameters\n        Nx = 801  # Number of grid points for high resolution\n        dx = L / (Nx - 1)\n        x_grid = np.linspace(0, L, Nx)\n        CFL = 0.9\n\n        # Case-specific parameters based on Mach number\n        U0 = M * c0\n        v1 = U0 + c0  # Characteristic speed for L1 (right-running)\n        v2 = U0 - c0  # Characteristic speed for L2 (left-running)\n\n        # Time-stepping setup\n        # The simulation must run long enough to capture the entire pulse interaction at x=L\n        t_final = 0.006  # seconds, empirically chosen to be sufficient for all cases\n        dt = CFL * dx / max(abs(v1), abs(v2))\n        num_steps = int(t_final / dt)\n        \n        # Characteristic variables arrays\n        L1 = A * np.exp(-(x_grid - x0)**2 / (2 * sigma**2))\n        L2 = np.zeros(Nx)\n\n        # Arrays to store the time history of characteristic variables at the right boundary (x=L)\n        L1_boundary_hist = np.zeros(num_steps + 1)\n        L2_boundary_hist = np.zeros(num_steps + 1)\n\n        # Courant numbers for the upwind scheme\n        C1 = v1 * dt / dx\n        C2 = v2 * dt / dx\n\n        # Main time-integration loop\n        for n in range(num_steps):\n            # Store the boundary values at the current time step\n            L1_boundary_hist[n] = L1[-1]\n            L2_boundary_hist[n] = L2[-1]\n\n            # Keep a copy of the arrays from the previous time step\n            L1_old = L1.copy()\n            L2_old = L2.copy()\n            \n            # --- Update interior points using first-order upwind scheme ---\n            \n            # L1 advects to the right (v1 > 0), so upwind from the left\n            L1[1:] = L1_old[1:] - C1 * (L1_old[1:] - L1_old[0:-1])\n            \n            # L2 advects to the left (v2  0 for M  1), so upwind from the right\n            L2[0:-1] = L2_old[0:-1] - C2 * (L2_old[1:] - L2_old[0:-1])\n\n            # --- Apply boundary conditions ---\n            \n            # Left boundary (x=0): non-injecting condition for incoming characteristic L1\n            L1[0] = 0.0\n            # Outgoing characteristic L2[0] is already updated from the interior\n\n            # Right boundary (x=L): reflection condition for incoming characteristic L2\n            # Outgoing characteristic L1[-1] is already updated from the interior\n            L2[-1] = r * L1[-1]\n        \n        # Store the final boundary values at t_final\n        L1_boundary_hist[-1] = L1[-1]\n        L2_boundary_hist[-1] = L2[-1]\n\n        # --- Energy Calculation ---\n        \n        # The energy is proportional to the time integral of the square of the characteristic variable.\n        # The constant of proportionality 1/(4*rho0*c0) cancels out in the ratio.\n        # We use trapezoidal integration for accuracy.\n        \n        # Incident energy corresponds to the right-running wave L1\n        E_inc = trapezoid(L1_boundary_hist**2, dx=dt)\n        \n        # Reflected energy corresponds to the left-running wave L2\n        E_ref = trapezoid(L2_boundary_hist**2, dx=dt)\n\n        # Avoid division by zero if no wave reaches the boundary (not expected here)\n        if E_inc == 0.0:\n            return 0.0\n        \n        # Compute the energy reflection ratio\n        R_E = E_ref / E_inc\n        return R_E\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0.0, 0.0),   # Test 1: M, r\n        (0.4, 0.3),   # Test 2: M, r\n        (0.8, -0.5),  # Test 3: M, r\n        (0.2, 0.9),   # Test 4: M, r\n    ]\n\n    results = []\n    for M_case, r_case in test_cases:\n        R_E_case = solve_case(M_case, r_case)\n        # Append the result rounded to four decimal places as required.\n        results.append(f\"{R_E_case:.4f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在计算燃烧学中，为了处理低马赫数流动带来的数值刚性问题，预处理技术被广泛应用。然而，预处理会改变控制方程的特征结构，因此边界条件也必须做出相应调整。本练习将指导你如何在预处理后的欧拉方程体系下，重新定义特征变量并设计非反射边界条件。这对于在现代计算流体力学程序中正确实施边界条件至关重要，它展示了如何将声学理论与先进的数值方法相结合。",
            "id": "4011719",
            "problem": "考虑与计算燃烧学相关的一维线性化可压缩欧拉方程，该方程以原始变量形式写出，描述了围绕均匀基态的小扰动。设原始变量向量为 $q = [\\rho, u, p]^T$，其中 $\\rho$ 是密度，$u$ 是速度，$p$ 是压力。关于常数参考态 $(\\rho_0, u_0, p_0)$ 的线性化产生一个常系数双曲系统 $ \\partial_t q + A \\partial_x q = 0 $，其中原始变量下的通量雅可比矩阵 $A$ 由下式给出\n$$\nA = \\begin{bmatrix}\nu_0  \\rho_0  0 \\\\\n0  u_0  \\frac{1}{\\rho_0} \\\\\n0  \\gamma p_0  u_0 \n\\end{bmatrix},\n$$\n其中理想气体声速为 $a_0 = \\sqrt{\\gamma p_0 / \\rho_0}$，比热比 $\\gamma$ 为常数。\n\n在低马赫数下，预处理通过修改时间算子来缓解刚性问题。考虑一个作用于原始变量的对角预处理器，它缩放压力方程，定义为\n$$\n\\Pi = \\mathrm{diag}\\left(1,\\,1,\\,\\frac{1}{\\beta^2}\\right),\n$$\n其中Turkel型预处理参数为\n$$\n\\beta(M) = \\max\\left(\\min\\left(M,\\,1\\right),\\,\\beta_{\\min}\\right), \\quad M = \\frac{|u_0|}{a_0}.\n$$\n预处理特征算子为 $ \\tilde{J} = \\Pi^{-1} A $。\n\n基于特征的无反射边界条件 (NRBC) 是通过将扰动分解为相对于边界外法线的特征变量来构建的。对于位于 $x = L$ 的右边界，其外法线方向为 $+x$ 方向。定义预处理雅可比矩阵 $ \\tilde{J} $ 的右特征向量矩阵 $\\tilde{R}$ 和左特征向量矩阵 $\\tilde{L} = \\tilde{R}^{-1}$，以及特征变量\n$$\nw = \\tilde{L}\\,(q - q_{\\mathrm{ref}}),\n$$\n其中 $q_{\\mathrm{ref}}$ 是一个已知的外部参考态。如果一个特征模态的右特征向量在速度或压力分量上具有非零项，则将其归类为“声学”模态；如果右特征向量仅投影到密度上，则将其归类为“熵/对流”模态。对于右边界，特征值 $\\lambda  0$ 的模态为“传入”模态，特征值 $\\lambda  0$ 的模态为“传出”模态。\n\n设计一个边界更新方案，通过将传入声学模态的特征振幅设置为零来抵消它们，同时保持传出模态和熵/对流模态不变：\n$$\nw_i^{\\mathrm{new}} =\n\\begin{cases}\n0,  \\text{若模态 $i$ 是声学且传入（即 $\\lambda_i  0$）} \\\\\nw_i,  \\text{其他情况。}\n\\end{cases}\n$$\n通过以下方式重构修正后的边界扰动和状态：\n$$\n(q - q_{\\mathrm{ref}})^{\\mathrm{new}} = \\tilde{R}\\,w^{\\mathrm{new}}, \\qquad q_{\\mathrm{boundary}} = q_{\\mathrm{ref}} + (q - q_{\\mathrm{ref}})^{\\mathrm{new}}.\n$$\n\n使用所提供的参数，通过数值方法实现此过程，并计算每个测试用例的修正后边界压力 $p_{\\mathrm{boundary}}$，单位为帕斯卡（Pascals）。使用以下具有科学合理值的测试套件：\n\n- 测试用例 1（亚音速出流）：$\\rho_0 = 1.2$ 千克/立方米 (kg/m^3)，$u_0 = 40$ 米/秒 (m/s)，$p_0 = 101325$ 帕斯卡 (Pa)，$\\gamma = 1.4$，内部状态 $q_{\\mathrm{int}} = [1.19, 41.0, 101625]^T$，参考态 $q_{\\mathrm{ref}} = [1.2, 40.0, 101325]^T$，以及 $\\beta_{\\min} = 0.05$。\n- 测试用例 2（超音速出流，预处理不起作用）：$\\rho_0 = 1.0$ kg/m^3，$u_0 = 800.0$ m/s，$p_0 = 100000.0$ Pa，$\\gamma = 1.4$，$q_{\\mathrm{int}} = [1.01, 795.0, 99500.0]^T$，$q_{\\mathrm{ref}} = [1.0, 800.0, 100000.0]^T$，以及 $\\beta_{\\min} = 0.05$。\n- 测试用例 3（近零马赫数出流）：$\\rho_0 = 1.0$ kg/m^3，$u_0 = 5.0$ m/s，$p_0 = 100000.0$ Pa，$\\gamma = 1.4$，$q_{\\mathrm{int}} = [1.02, 6.5, 100250.0]^T$，$q_{\\mathrm{ref}} = [1.0, 5.0, 100000.0]^T$，以及 $\\beta_{\\min} = 0.05$。\n- 测试用例 4（速度为负的入流）：$\\rho_0 = 1.0$ kg/m^3，$u_0 = -20.0$ m/s，$p_0 = 100000.0$ Pa，$\\gamma = 1.4$，$q_{\\mathrm{int}} = [0.98, -18.5, 99800.0]^T$，$q_{\\mathrm{ref}} = [1.0, -20.0, 100000.0]^T$，以及 $\\beta_{\\min} = 0.05$。\n\n算法要求：\n- 计算 $a_0 = \\sqrt{\\gamma p_0/\\rho_0}$、$M = |u_0|/a_0$ 和 $\\beta = \\max(\\min(M, 1), \\beta_{\\min})$。\n- 构造 $A$ 和 $\\Pi^{-1} = \\mathrm{diag}(1, 1, \\beta^2)$，然后构造 $\\tilde{J} = \\Pi^{-1} A$。\n- 计算 $\\tilde{J}$ 的特征值和右特征向量，构造 $\\tilde{L} = \\tilde{R}^{-1}$，以及 $\\Delta q = q_{\\mathrm{int}} - q_{\\mathrm{ref}}$ 的特征振幅 $w$。\n- 将 $w$ 的所有传入声学分量置零，并重构 $q_{\\mathrm{boundary}}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，格式为“[p1,p2,p3,p4]”，单位为帕斯卡，每个值格式化为六位小数。",
            "solution": "该问题要求为一维线性化可压缩欧拉方程实现一种基于特征的无反射边界条件 (NRBC)，并结合低马赫数预处理器。其目标是根据内部数据和参考状态，通过选择性地消除传入的声学波，计算边界处的修正压力。\n\n该过程基于双曲偏微分方程理论。系统 $\\partial_t q + A \\partial_x q = 0$ 可通过从原始变量 $q$ 到一组特征变量 $w$ 的变量变换进行对角化。每个特征变量对应一个波，其传播速度由通量雅可比矩阵 A 的一个特征值给出。在边界处，其中一些波传播出计算域（传出波），而另一些则传播入计算域（传入波）。无反射边界条件旨在让传出波不受阻碍地通过边界，同时防止虚假的、非物理的波从外部反射或进入。\n\n这通过为传入的特征变量指定边界数据来实现。一种常见且有效的NRBC，特别是在外部状态已知或假定为静止时，是将传入特征扰动的振幅设置为零。然后，根据修正后的特征变量集重构边界状态，该变量集现在仅包含来自计算域内部的传出波的贡献以及任何指定的物理传入信息。\n\n在低马赫数流动的背景下（例如计算燃烧学中经常遇到的情况），欧拉方程会变得刚性。这是因为声波速度 ($u_0 \\pm a_0$) 远大于对流速度 ($u_0$)，导致通量雅可比矩阵的特征值范围差异巨大。这种刚性对显式数值方法施加了严格的时间步长限制。Turkel型预处理通过修改时间导数项来解决此问题，对于常系数系统，这等效于用矩阵 $\\Pi^{-1}$ 左乘通量雅可比矩阵。在此，$\\Pi = \\mathrm{diag}(1, 1, 1/\\beta^2)$ 缩放压力方程，在低马赫数下有效减慢修正后系统中的声波速度，使其与流速处于同一量级。参数 $\\beta$ 是马赫数 $M = |u_0|/a_0$ 的函数，其设计旨在仅在低马赫数时激活 ($\\beta  1$)，而在 $M \\ge 1$ 时关闭 ($\\beta = 1$)，从而恢复为原始欧拉方程。\n\n因此，必须对预处理后的雅可比矩阵 $\\tilde{J} = \\Pi^{-1} A$ 执行NRBC的特征分析。实现指定边界条件的步骤如下：\n\n1.  **参数计算**：对于每个测试用例，使用平均流参数 $(\\rho_0, u_0, p_0)$ 和比热比 $\\gamma$ 来计算声速 $a_0 = \\sqrt{\\gamma p_0 / \\rho_0}$、马赫数 $M = |u_0|/a_0$ 和预处理参数 $\\beta = \\max(\\min(M, 1), \\beta_{\\min})$。\n\n2.  **矩阵构建**：构建原始变量通量雅可比矩阵 $A$ 和预处理矩阵的逆 $\\Pi^{-1}$。然后计算预处理后的雅可比矩阵 $\\tilde{J} = \\Pi^{-1} A$。\n    $$\n    A = \\begin{bmatrix} u_0  \\rho_0  0 \\\\ 0  u_0  1/\\rho_0 \\\\ 0  \\gamma p_0  u_0 \\end{bmatrix}, \\quad \\Pi^{-1} = \\begin{bmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  \\beta^2 \\end{bmatrix} \\implies \\tilde{J} = \\begin{bmatrix} u_0  \\rho_0  0 \\\\ 0  u_0  1/\\rho_0 \\\\ 0  \\beta^2 \\gamma p_0  u_0 \\end{bmatrix}\n    $$\n\n3.  **特征分解**：计算 $\\tilde{J}$ 的特征值 $\\lambda_i$ 和右特征向量（矩阵 $\\tilde{R}$ 的列）。$\\tilde{J}$ 的特征值为 $\\lambda_1 = u_0$、$\\lambda_2 = u_0 + \\beta a_0$ 和 $\\lambda_3 = u_0 - \\beta a_0$。这些代表了预处理后特征波的速度。通过对右特征向量矩阵求逆得到左特征向量矩阵，即 $\\tilde{L} = \\tilde{R}^{-1}$。\n\n4.  **特征分解**：边界处的扰动由内部状态 $q_{\\mathrm{int}}$ 与外部参考状态 $q_{\\mathrm{ref}}$ 之差来近似，即 $\\Delta q = q_{\\mathrm{int}} - q_{\\mathrm{ref}}$。通过计算特征振幅向量 $w = \\tilde{L} \\Delta q$，将此扰动投影到特征基上。\n\n5.  **边界条件应用**：NRBC的核心是识别并消除传入的声学模态。在右边界（外法线方向为 $+x$），如果一个模态的传播速度（特征值）$\\lambda_i$ 为负，则该模态是传入的。如果一个模态对应的右特征向量在速度或压力变量上有非零分量，则该模态被归类为声学模态。问题指明，熵/对流模态（对应于 $\\lambda_1 = u_0$）的右特征向量与 $[1, 0, 0]^T$ 成比例。另外两个模态是声学模态。通过对每个既是声学模态又是传入模态的模态 $i$ 设置 $w_i^{\\mathrm{new}} = 0$，否则设置 $w_i^{\\mathrm{new}} = w_i$，形成一个新的特征振幅向量 $w^{\\mathrm{new}}$。\n\n6.  **状态重构**：通过从特征基变换回原始变量，重构修正后的扰动：$\\Delta q^{\\mathrm{new}} = \\tilde{R} w^{\\mathrm{new}}$。\n\n7.  **最终边界状态**：将修正后的扰动加到参考状态上，得到最终的边界状态：$q_{\\mathrm{boundary}} = q_{\\mathrm{ref}} + \\Delta q^{\\mathrm{new}}$。所需的输出是该向量的压力分量 $p_{\\mathrm{boundary}}$。\n\n此过程被系统地应用于每个测试用例，以确定修正后的边界压力。数值线性代数程序用于特征分解和矩阵求逆。必须注意正确识别由数值特征求解器返回的模态，并应用指定的逻辑。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the non-reflecting boundary condition problem for the given test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Subsonic outflow\n        {'rho0': 1.2, 'u0': 40.0, 'p0': 101325.0, 'gamma': 1.4,\n         'q_int': np.array([1.19, 41.0, 101625.0]), 'q_ref': np.array([1.2, 40.0, 101325.0]), 'beta_min': 0.05},\n        # Case 2: Supersonic outflow\n        {'rho0': 1.0, 'u0': 800.0, 'p0': 100000.0, 'gamma': 1.4,\n         'q_int': np.array([1.01, 795.0, 99500.0]), 'q_ref': np.array([1.0, 800.0, 100000.0]), 'beta_min': 0.05},\n        # Case 3: Near-zero Mach outflow\n        {'rho0': 1.0, 'u0': 5.0, 'p0': 100000.0, 'gamma': 1.4,\n         'q_int': np.array([1.02, 6.5, 100250.0]), 'q_ref': np.array([1.0, 5.0, 100000.0]), 'beta_min': 0.05},\n        # Case 4: Inflow\n        {'rho0': 1.0, 'u0': -20.0, 'p0': 100000.0, 'gamma': 1.4,\n         'q_int': np.array([0.98, -18.5, 99800.0]), 'q_ref': np.array([1.0, -20.0, 100000.0]), 'beta_min': 0.05},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        p_boundary = calculate_boundary_pressure(case)\n        results.append(f\"{p_boundary:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_boundary_pressure(params):\n    \"\"\"\n    Implements the characteristic-based NRBC procedure for a single case.\n    \"\"\"\n    rho0 = params['rho0']\n    u0 = params['u0']\n    p0 = params['p0']\n    gamma = params['gamma']\n    q_int = params['q_int']\n    q_ref = params['q_ref']\n    beta_min = params['beta_min']\n    \n    # 1. Parameter Calculation\n    a0 = np.sqrt(gamma * p0 / rho0)\n    M = np.abs(u0) / a0\n    beta = max(min(M, 1.0), beta_min)\n\n    # 2. Matrix Formulation\n    A = np.array([\n        [u0, rho0, 0],\n        [0, u0, 1/rho0],\n        [0, gamma * p0, u0]\n    ])\n    \n    Pi_inv = np.diag([1.0, 1.0, beta**2])\n    J_tilde = Pi_inv @ A\n\n    # 3. Eigen-Decomposition\n    # eigenvalues and right eigenvectors\n    # W contains eigenvectors as columns\n    eigenvalues, R_tilde = np.linalg.eig(J_tilde)\n    # left eigenvectors are rows of inv(W)\n    L_tilde = np.linalg.inv(R_tilde)\n    \n    # 4. Characteristic Decomposition\n    delta_q = q_int - q_ref\n    w = L_tilde @ delta_q\n\n    # 5. Boundary Condition Application\n    w_new = w.copy()\n    \n    for i in range(len(eigenvalues)):\n        lambda_i = eigenvalues[i]\n        r_i = R_tilde[:, i]\n\n        # Identify mode type: check if velocity or pressure components are non-zero\n        # The entropy mode has an eigenvector proportional to [1, 0, 0]^T\n        is_acoustic = not np.allclose(r_i[1:], [0, 0], atol=1e-9)\n        \n        # Identify incoming modes for a right boundary\n        is_incoming = lambda_i  0\n\n        # Apply NRBC rule\n        if is_acoustic and is_incoming:\n            w_new[i] = 0.0\n\n    # 6. State Reconstruction\n    delta_q_new = R_tilde @ w_new\n    \n    # 7. Final Boundary State\n    q_boundary = q_ref + delta_q_new\n    p_boundary = q_boundary[2]\n    \n    return p_boundary\n\nsolve()\n\n```"
        }
    ]
}