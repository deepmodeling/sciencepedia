{
    "hands_on_practices": [
        {
            "introduction": "本实践将侧重于颗粒负载流中的一个基本概念：颗粒对载体流体运动的响应。我们将计算斯托克斯数（$Stk$），这是一个关键的无量纲参数，用于量化颗粒的惯性。该练习  至关重要，因为它要求您在高温高压的燃烧条件下，从第一性原理出发推导气体属性，并应用必要的非连续介质效应修正，这些都是精确模拟颗粒轨迹所必需的技能。",
            "id": "4034575",
            "problem": "考虑一个直径为 $d_{p}$ 的烟尘颗粒，悬浮在高压、高温的预混甲烷-空气火焰中。气体压力为 $p$，气体温度为 $T$，平均流动的特征速度尺度为 $U$，特征长度尺度为 $L$。假设颗粒为球形，材料密度为 $\\rho_{p}$，周围气体处于连续介质区，但存在有限克努森数（Knudsen number (Kn)）效应，需要进行滑移修正，并且颗粒雷诺数足够小，以至于线性（斯托克斯）曳力有效。忽略重力沉降、附加质量、Basset历史力和除曳力以外的体积力。\n\n从牛顿第二定律和连续介质极限下小球的斯托克斯曳力定义出发，并结合经过充分验证的针对有限克努森数的Cunningham滑移修正，推导颗粒速度弛豫时间，并用它与流动时间尺度的比值来构成斯托克斯数。使用理想气体和分子动理论基础计算气体平均自由程，并使用标准的空气高温粘度关系式。\n\n根据以下物理上合理的燃烧室条件计算斯托克斯数：\n- 气体压力 $p = 2.0 \\times 10^{6}\\ \\mathrm{Pa}$（即 $20$ bar）。\n- 气体温度 $T = 1800\\ \\mathrm{K}$。\n- 颗粒直径 $d_{p} = 5.0 \\times 10^{-8}\\ \\mathrm{m}$。\n- 颗粒密度 $\\rho_{p} = 1800\\ \\mathrm{kg/m^{3}}$。\n- 流动速度尺度 $U = 20\\ \\mathrm{m/s}$。\n- 流动长度尺度 $L = 2.0 \\times 10^{-3}\\ \\mathrm{m}$。\n- 玻尔兹曼常数 $k_{B} = 1.380649 \\times 10^{-23}\\ \\mathrm{J/K}$。\n- 空气的代表性分子直径 $d_{g} = 3.7 \\times 10^{-10}\\ \\mathrm{m}$。\n\n对于空气的随温度变化的动力粘度，使用Sutherland定律，参数为\n$ \\mu_{0} = 1.716 \\times 10^{-5}\\ \\mathrm{Pa \\cdot s}$ 在 $T_{0} = 273\\ \\mathrm{K}$ 和 Sutherland 常数 $S = 111\\ \\mathrm{K}$。\n\n对于Cunningham滑移修正，使用系数 $A = 1.257$, $B = 0.4$ 和 $C = 1.1$。\n\n将最终的斯托克斯数表示为无量纲小数，并四舍五入到四位有效数字。",
            "solution": "问题陈述被认为是有效的。它在科学上基于流体力学和分子动理论的既定原理，问题设置良好，提供了所有必要的数据，并且语言客观。对于计算燃烧这一特定背景，所给条件和参数在物理上是合理的。\n\n颗粒的运动遵循牛顿第二定律。根据问题陈述，我们只考虑作用在颗粒上的曳力 $\\vec{F}_D$。运动方程为：\n$$m_{p} \\frac{d\\vec{v}_{p}}{dt} = \\vec{F}_D$$\n其中 $m_p$ 是颗粒质量，$\\vec{v}_p$ 是颗粒速度。假设颗粒是直径为 $d_p$、密度为 $\\rho_p$ 的球体，因此其质量为：\n$$m_{p} = \\rho_{p} V_{p} = \\rho_{p} \\left( \\frac{1}{6}\\pi d_{p}^{3} \\right)$$\n在斯托克斯区域内，经过滑移流效应修正的曳力由以下公式给出：\n$$\\vec{F}_D = \\frac{3\\pi\\mu d_p}{C_c} (\\vec{v}_g - \\vec{v}_p)$$\n这里，$\\mu$ 是气体的动力粘度，$\\vec{v}_g$ 是当地气体速度，$C_c$ 是Cunningham滑移修正因子。将 $m_p$ 和 $\\vec{F}_D$ 的表达式代入运动方程，得到：\n$$\\rho_{p} \\left( \\frac{1}{6}\\pi d_{p}^{3} \\right) \\frac{d\\vec{v}_{p}}{dt} = \\frac{3\\pi\\mu d_p}{C_c} (\\vec{v}_g - \\vec{v}_p)$$\n将此方程重排为一阶线性常微分方程的标准形式，我们得到：\n$$\\frac{d\\vec{v}_{p}}{dt} = \\frac{18\\mu}{\\rho_{p} d_{p}^{2} C_c} (\\vec{v}_g - \\vec{v}_p)$$\n该方程描述了颗粒速度向气体速度的弛豫过程。速度差项的系数是颗粒速度弛豫时间 $\\tau_p$ 的倒数。\n$$\\tau_p = \\frac{\\rho_{p} d_{p}^{2} C_c}{18\\mu}$$\n特征流动时间尺度 $\\tau_f$ 由给定的流动速度尺度 $U$ 和长度尺度 $L$ 定义：\n$$\\tau_f = \\frac{L}{U}$$\n斯托克斯数 $\\mathrm{Stk}$ 是颗粒弛豫时间与流动时间尺度的无量纲比值：\n$$\\mathrm{Stk} = \\frac{\\tau_p}{\\tau_f} = \\frac{\\left(\\frac{\\rho_{p} d_{p}^{2} C_c}{18\\mu}\\right)}{\\left(\\frac{L}{U}\\right)} = \\frac{\\rho_{p} d_{p}^{2} C_c U}{18\\mu L}$$\n为了计算斯托克斯数，我们必须首先计算 $\\mu$、$\\lambda$（气体平均自由程）、克努森数 $\\mathrm{Kn}$ 和 $C_c$。\n\n1.  **气体动力粘度 ($\\mu$)**\n    我们使用Sutherland定律和给定参数： $T = 1800\\ \\mathrm{K}$，$T_0 = 273\\ \\mathrm{K}$，$\\mu_0 = 1.716 \\times 10^{-5}\\ \\mathrm{Pa \\cdot s}$，和 $S = 111\\ \\mathrm{K}$。\n    $$\\mu = \\mu_0 \\left(\\frac{T}{T_0}\\right)^{\\frac{3}{2}} \\frac{T_0 + S}{T + S}$$\n    $$\\mu = (1.716 \\times 10^{-5}) \\left(\\frac{1800}{273}\\right)^{1.5} \\frac{273 + 111}{1800 + 111} = (1.716 \\times 10^{-5}) (6.5934)^{1.5} \\frac{384}{1911}$$\n    $$\\mu \\approx (1.716 \\times 10^{-5}) (16.963) (0.20094) \\approx 5.8504 \\times 10^{-5}\\ \\mathrm{Pa \\cdot s}$$\n\n2.  **气体平均自由程 ($\\lambda$)**\n    根据理想气体的分子动理论，$\\lambda$ 由以下公式给出：\n    $$\\lambda = \\frac{k_B T}{\\sqrt{2} \\pi d_g^2 p}$$\n    使用所提供的值： $k_B = 1.380649 \\times 10^{-23}\\ \\mathrm{J/K}$，$T = 1800\\ \\mathrm{K}$，$d_g = 3.7 \\times 10^{-10}\\ \\mathrm{m}$，以及 $p = 2.0 \\times 10^6\\ \\mathrm{Pa}$。\n    $$\\lambda = \\frac{(1.380649 \\times 10^{-23}) (1800)}{\\sqrt{2} \\pi (3.7 \\times 10^{-10})^2 (2.0 \\times 10^6)}$$\n    $$\\lambda \\approx \\frac{2.48517 \\times 10^{-20}}{1.21853 \\times 10^{-12}} \\approx 2.0395 \\times 10^{-8}\\ \\mathrm{m}$$\n\n3.  **克努森数 ($\\mathrm{Kn}$)**\n    克努森数是平均自由程与颗粒直径 $d_p = 5.0 \\times 10^{-8}\\ \\mathrm{m}$ 的比值。\n    $$\\mathrm{Kn} = \\frac{\\lambda}{d_p} = \\frac{2.0395 \\times 10^{-8}}{5.0 \\times 10^{-8}} \\approx 0.4079$$\n    由于 $0.1  \\mathrm{Kn}  10$，流动处于滑移流区，这证实了使用Cunningham修正是合理的。\n\n4.  **Cunningham滑移修正因子 ($C_c$)**\n    该修正因子由以下公式给出：\n    $$C_c = 1 + \\mathrm{Kn} [A + B \\exp(-C/\\mathrm{Kn})]$$\n    系数为 $A = 1.257$，$B = 0.4$，$C = 1.1$，以及 $\\mathrm{Kn} \\approx 0.4079$。\n    $$C_c = 1 + 0.4079 [1.257 + 0.4 \\exp(-1.1/0.4079)]$$\n    $$C_c \\approx 1 + 0.4079 [1.257 + 0.4 \\exp(-2.6967)]$$\n    $$C_c \\approx 1 + 0.4079 [1.257 + 0.4(0.06742)] \\approx 1 + 0.4079 [1.28397] \\approx 1.5237$$\n\n5.  **斯托克斯数 ($\\mathrm{Stk}$)**\n    最后，我们将所有值代入斯托克斯数的表达式中：$\\rho_p = 1800\\ \\mathrm{kg/m^3}$，$d_p = 5.0 \\times 10^{-8}\\ \\mathrm{m}$，$U = 20\\ \\mathrm{m/s}$，$L = 2.0 \\times 10^{-3}\\ \\mathrm{m}$，$\\mu \\approx 5.8504 \\times 10^{-5}\\ \\mathrm{Pa \\cdot s}$，以及 $C_c \\approx 1.5237$。\n    $$\\mathrm{Stk} = \\frac{\\rho_{p} d_{p}^{2} C_c U}{18\\mu L}$$\n    $$\\mathrm{Stk} = \\frac{(1800) (5.0 \\times 10^{-8})^2 (1.5237) (20)}{18 (5.8504 \\times 10^{-5}) (2.0 \\times 10^{-3})}$$\n    $$\\mathrm{Stk} = \\frac{(1800) (2.5 \\times 10^{-15}) (1.5237) (20)}{18 (5.8504 \\times 10^{-5}) (2.0 \\times 10^{-3})} \\approx \\frac{1.3713 \\times 10^{-10}}{2.1061 \\times 10^{-6}}$$\n    $$\\mathrm{Stk} \\approx 6.5109 \\times 10^{-5}$$\n    将其表示为小数并四舍五入到四位有效数字，得到 $0.00006511$。",
            "answer": "$$\\boxed{0.00006511}$$"
        },
        {
            "introduction": "在单颗粒动力学的基础上，我们现在将探讨颗粒群体的集体行为，这是燃料喷雾中的常见情景。该练习  引入了“屏蔽”效应的概念，即单个液滴的蒸发会因周围液滴产生的蒸汽而受到抑制。您将使用均质化源模型和自洽性条件来推导屏蔽因子，从而深入了解用于连接微观液滴物理与宏观喷雾行为的强大技术。",
            "id": "4034621",
            "problem": "考虑一种静止、等温、氧化的气体，其密度 $\\rho_{g}$ 和稀燃料蒸气的二元扩散系数 $D$ 为常数。一个由 $N$ 个半径为 $R_{d}$ 的相同反应性燃料液滴组成的球形团簇，均匀分布在半径为 $R_{c}$ 的球形区域内。每个液滴被视为一个拉格朗日粒子，在其界面处以燃料质量分数 $Y_{s}$ 蒸发，气相中的燃料蒸气在整个气体中经历一级化学消耗反应，反应速率常数为 $k$ (单位为 $\\mathrm{s}^{-1}$)。远场足够大，使得燃料蒸气质量分数因反应而趋于零，即当 $r \\to \\infty$ 时，$Y(r) \\to 0$。假设：\n- 忽略斯特凡流和气体中的热效应（扩散控制蒸发），\n- 气体性质在空间上均匀（$\\rho_{g}$ 和 $D$ 是常数），\n- 准稳态条件，\n- 来自液滴的分布源可以在团簇内部被均化为一个均匀的体积源 $S_{m} = N \\dot{m}_{d} / V_{c}$，其中 $\\dot{m}_{d}$ 是每个液滴的（未知）蒸发速率，而 $V_{c} = \\frac{4}{3}\\pi R_{c}^{3}$ 是团簇体积，\n- 在团簇外部没有体积源。\n\n从带有菲克定律的稳态组分守恒方程出发，推导团簇内部平均燃料蒸气质量分数 $\\overline{Y}$ 作为 $S_{m}$、$D$、$k$ 和 $R_{c}$ 的函数的解析表达式，然后通过将单个液滴在质量分数为 $\\overline{Y}$ 的均匀环境中的扩散控制蒸发与 $\\dot{m}_{d}$ 联系起来，从而强制实现自洽性。定义屏蔽因子 $S_{f}$ 为液滴群中单个液滴的实际蒸发速率与一个孤立液滴在相同气体中蒸发到远场燃料蒸气为零的环境中的蒸发速率之比，即\n$$\nS_{f} \\equiv \\frac{\\dot{m}_{d}}{\\dot{m}_{d}^{\\mathrm{iso}}}.\n$$\n根据以下参数值计算 $S_{f}$：\n- $N = 10^{4}$，\n- $R_{d} = 50 \\times 10^{-6}\\ \\mathrm{m}$，\n- $R_{c} = 5.0 \\times 10^{-3}\\ \\mathrm{m}$，\n- $D = 6.0 \\times 10^{-5}\\ \\mathrm{m}^{2}\\cdot\\mathrm{s}^{-1}$，\n- $k = 75\\ \\mathrm{s}^{-1}$，\n- $Y_{s}$ 是常数但未指定具体值。\n\n将 $S_{f}$ 表示为一个无量纲数，并将最终数值结果四舍五入到三位有效数字。",
            "solution": "首先对问题进行验证，以确保其是自洽的、有科学依据且适定的。\n\n### 第 1 步：提取已知条件\n- **系统：** 静止、等温、氧化的气体。\n- **气体性质：** 恒定密度 $\\rho_{g}$，恒定二元扩散系数 $D$。\n- **燃料：** 稀燃料蒸气。\n- **液滴：** 由 $N$ 个相同的反应性燃料液滴组成的球形团簇。\n- **液滴半径：** $R_{d}$。\n- **团簇半径：** $R_{c}$。\n- **液滴分布：** 在团簇内均匀分布。\n- **液滴蒸发：** 发生在液滴表面，该处燃料质量分数为 $Y_{s}$。\n- **反应：** 速率常数为 $k$ 的一级化学消耗反应。\n- **远场条件：** 当 $r \\to \\infty$ 时，$Y(r) \\to 0$。\n- **假设：** 准稳态条件，忽略斯特凡流，气体性质恒定，以及一个均化的体积源项 $S_{m} = N \\dot{m}_{d} / V_{c}$ 适用于 $r \\le R_c$（当 $r > R_c$ 时 $S_m=0$），其中 $V_{c} = \\frac{4}{3}\\pi R_{c}^{3}$。\n- **定义：** 屏蔽因子 $S_{f} \\equiv \\frac{\\dot{m}_{d}}{\\dot{m}_{d}^{\\mathrm{iso}}}$。\n- **数值：** $N = 10^{4}$，$R_{d} = 50 \\times 10^{-6}\\ \\mathrm{m}$，$R_{c} = 5.0 \\times 10^{-3}\\ \\mathrm{m}$，$D = 6.0 \\times 10^{-5}\\ \\mathrm{m}^{2}\\cdot\\mathrm{s}^{-1}$，$k = 75\\ \\mathrm{s}^{-1}$。\n\n### 第 2 步：使用提取的已知条件进行验证\n- **科学依据：** 该问题基于标准的组分输运方程，并采用了“均化”或“连续介质”建模方法，这是喷雾燃烧和多相流研究中一种成熟的方法。其物理原理是合理的。\n- **适定性：** 该问题指定了一个二阶常微分方程，并给出了足够的边界条件（$r=0$ 处的对称性，$r=R_c$ 处的连续性，以及 $r \\to \\infty$ 处的衰减），以确保燃料质量分数分布 $Y(r)$ 存在唯一解。附加的自洽性要求提供了求解未知蒸发速率所需的封闭关系。\n- **客观性与清晰度：** 该问题使用精确的数学和物理术语进行陈述，没有歧义或主观因素。\n\n### 第 3 步：结论与行动\n该问题被判定为**有效**。将推导完整解。\n\n### 屏蔽因子的推导\n\n分析从燃料蒸气质量分数 $Y$ 的稳态组分守恒方程开始。在给定假设（静止流、恒定性质）下，该方程得以简化。在球坐标系下，假设对称性，我们有两个区域：内部区域（$r \\le R_c$，下标为 $1$）和外部区域（$r > R_c$，下标为 $2$）。\n\n控制方程为：\n$$ \\frac{1}{r^2} \\frac{d}{dr} \\left( r^2 \\frac{dY_1}{dr} \\right) - \\frac{k}{D} Y_1 = -\\frac{S_m}{\\rho_g D} \\quad \\text{对于 } r \\le R_c $$\n$$ \\frac{1}{r^2} \\frac{d}{dr} \\left( r^2 \\frac{dY_2}{dr} \\right) - \\frac{k}{D} Y_2 = 0 \\quad \\text{对于 } r > R_c $$\n令 $\\lambda = \\sqrt{k/D}$。方程变为修正的亥姆霍兹方程。\n\n边界条件为：\n1.  $Y_1(r)$ 在 $r=0$ 处是有限的，这意味着 $\\frac{dY_1}{dr}\\Big|_{r=0} = 0$。\n2.  当 $r \\to \\infty$ 时，$Y_2(r) \\to 0$。\n3.  在团簇边缘质量分数的连续性：$Y_1(R_c) = Y_2(R_c)$。\n4.  在团簇边缘质量通量的连续性：$\\frac{dY_1}{dr}\\Big|_{r=R_c} = \\frac{dY_2}{dr}\\Big|_{r=R_c}$。\n\n通解为：\n$$ Y_1(r) = A_1 \\frac{\\sinh(\\lambda r)}{r} + B_1 \\frac{\\cosh(\\lambda r)}{r} + \\frac{S_m}{\\rho_g k} $$\n$$ Y_2(r) = A_2 \\frac{e^{\\lambda r}}{r} + B_2 \\frac{e^{-\\lambda r}}{r} $$\n\n应用边界条件 1 和 2，分别要求 $B_1=0$ 和 $A_2=0$。解变为：\n$$ Y_1(r) = A_1 \\frac{\\sinh(\\lambda r)}{r} + \\frac{S_m}{\\rho_g k} $$\n$$ Y_2(r) = B_2 \\frac{e^{-\\lambda r}}{r} $$\n\n首要任务是求出内部平均质量分数 $\\overline{Y}$。这可以通过对 $Y_1$ 的控制方程在团簇体积 $V_c = \\frac{4}{3}\\pi R_c^3$ 上积分得到：\n$$ \\int_{V_c} \\nabla^2 Y_1 \\, dV - \\lambda^2 \\int_{V_c} Y_1 \\, dV = -\\frac{S_m V_c}{\\rho_g D} $$\n使用散度定理，$\\int_{V_c} \\nabla^2 Y_1 \\, dV = \\oint_{A_c} \\nabla Y_1 \\cdot d\\mathbf{A} = 4\\pi R_c^2 \\frac{dY_1}{dr}\\Big|_{R_c}$。\n$Y_1$ 的体积分是 $\\overline{Y} V_c$。因此：\n$$ 4\\pi R_c^2 \\frac{dY_1}{dr}\\Big|_{R_c} - \\lambda^2 \\overline{Y} V_c = -\\frac{S_m V_c}{\\rho_g D} $$\n整理得到 $\\overline{Y}$：\n$$ \\overline{Y} = \\frac{1}{\\lambda^2} \\left( \\frac{4\\pi R_c^2}{V_c} \\frac{dY_1}{dr}\\Big|_{R_c} + \\frac{S_m}{\\rho_g D} \\right) = \\frac{3}{\\lambda^2 R_c} \\frac{dY_1}{dr}\\Big|_{R_c} + \\frac{S_m}{\\rho_g k} $$\n这里，我们使用了 $\\frac{4\\pi R_c^2}{V_c} = \\frac{3}{R_c}$ 和 $\\lambda^2 = k/D$。\n\n为了继续推导，我们必须确定 $\\frac{dY_1}{dr}\\Big|_{R_c}$。应用 $r=R_c$ 处的连续性条件：\n$$ A_1 \\frac{\\sinh(\\lambda R_c)}{R_c} + \\frac{S_m}{\\rho_g k} = B_2 \\frac{e^{-\\lambda R_c}}{R_c} $$\n$$ A_1 \\left( \\frac{\\lambda \\cosh(\\lambda R_c)}{R_c} - \\frac{\\sinh(\\lambda R_c)}{R_c^2} \\right) = B_2 \\left( -\\frac{\\lambda e^{-\\lambda R_c}}{R_c} - \\frac{e^{-\\lambda R_c}}{R_c^2} \\right) $$\n求解这个关于 $A_1$ 和 $B_2$ 的方程组可以得到完整解。在 $R_c$ 处的导数被求得为：\n$$ \\frac{dY_1}{dr}\\Big|_{R_c} = -\\frac{S_m}{\\rho_g k \\lambda} \\frac{(\\lambda R_c+1) (\\lambda R_c \\cosh(\\lambda R_c) - \\sinh(\\lambda R_c))}{\\lambda R_c e^{\\lambda R_c}} $$\n将此代入 $\\overline{Y}$ 的表达式中：\n$$ \\overline{Y} = \\frac{S_m}{\\rho_g k} \\left[ 1 - \\frac{3(\\lambda R_c+1)}{(\\lambda R_c)^3 e^{\\lambda R_c}} (\\lambda R_c \\cosh(\\lambda R_c) - \\sinh(\\lambda R_c)) \\right] $$\n我们定义 $\\eta_c = \\lambda R_c$ 并将括号中的项定义为函数 $f(\\eta_c)$。\n$$ \\overline{Y} = \\frac{S_m}{\\rho_g k} f(\\eta_c) $$\n至此，推导的第一部分完成。\n\n接下来，我们强制实现自洽性。在平均质量分数为 $\\overline{Y}$ 的环境中，单个液滴的蒸发速率 $\\dot{m}_d$ 由标准的扩散控制模型给出：\n$$ \\dot{m}_d = 4\\pi \\rho_g D R_d (Y_s - \\overline{Y}) $$\n均化源项为 $S_m = \\frac{N \\dot{m}_d}{V_c}$。代入 $\\dot{m}_d$ 的表达式：\n$$ S_m = \\frac{N}{\\frac{4}{3}\\pi R_c^3} \\left[ 4\\pi \\rho_g D R_d (Y_s - \\overline{Y}) \\right] = \\frac{3 N \\rho_g D R_d}{R_c^3} (Y_s - \\overline{Y}) $$\n现在我们得到了一个关于 $S_m$ 和 $\\overline{Y}$ 的双方程系统。将它们联立：\n$$ \\overline{Y} = \\frac{f(\\eta_c)}{\\rho_g k} \\left[ \\frac{3 N \\rho_g D R_d}{R_c^3} (Y_s - \\overline{Y}) \\right] = \\frac{3 N D R_d}{k R_c^3} f(\\eta_c) (Y_s - \\overline{Y}) $$\n令 $\\phi^2 = \\frac{3 N D R_d}{k R_c^3}$。方程变为 $\\overline{Y} = \\phi^2 f(\\eta_c) (Y_s - \\overline{Y})$。解出 $\\overline{Y}$：\n$$ \\overline{Y} = Y_s \\frac{\\phi^2 f(\\eta_c)}{1 + \\phi^2 f(\\eta_c)} $$\n现在我们求出实际蒸发速率 $\\dot{m}_d$：\n$$ \\dot{m}_d = 4\\pi \\rho_g D R_d (Y_s - \\overline{Y}) = 4\\pi \\rho_g D R_d Y_s \\left( 1 - \\frac{\\phi^2 f(\\eta_c)}{1 + \\phi^2 f(\\eta_c)} \\right) = \\frac{4\\pi \\rho_g D R_d Y_s}{1 + \\phi^2 f(\\eta_c)} $$\n一个孤立液滴在背景为零（$Y_\\infty=0$）的介质中的蒸发速率为：\n$$ \\dot{m}_{d}^{\\mathrm{iso}} = 4\\pi \\rho_g D R_d (Y_s - 0) = 4\\pi \\rho_g D R_d Y_s $$\n屏蔽因子 $S_f$ 是这两个速率之比：\n$$ S_f = \\frac{\\dot{m}_d}{\\dot{m}_{d}^{\\mathrm{iso}}} = \\frac{1}{1 + \\phi^2 f(\\eta_c)} $$\n这就是最终的解析表达式。\n\n### 数值计算\n\n现在我们代入给定值来计算 $S_f$。\n首先，计算无量纲参数 $\\eta_c$ 和 $\\phi^2$：\n$$ \\eta_c = R_c \\sqrt{\\frac{k}{D}} = (5.0 \\times 10^{-3}\\ \\mathrm{m}) \\sqrt{\\frac{75\\ \\mathrm{s}^{-1}}{6.0 \\times 10^{-5}\\ \\mathrm{m}^{2}\\cdot\\mathrm{s}^{-1}}} = (5.0 \\times 10^{-3}) \\sqrt{1.25 \\times 10^6} \\approx 5.59017 $$\n$$ \\phi^2 = \\frac{3 N D R_d}{k R_c^3} = \\frac{3 (10^4) (6.0 \\times 10^{-5}\\ \\mathrm{m}^{2}\\cdot\\mathrm{s}^{-1}) (50 \\times 10^{-6}\\ \\mathrm{m})}{(75\\ \\mathrm{s}^{-1}) (5.0 \\times 10^{-3}\\ \\mathrm{m})^3} = 9.6 $$\n接下来，计算当 $\\eta_c \\approx 5.59017$ 时 $f(\\eta_c)$ 的值：\n$$ f(\\eta_c) = 1 - \\frac{3(\\eta_c+1)}{\\eta_c^3 e^{\\eta_c}} (\\eta_c \\cosh(\\eta_c) - \\sinh(\\eta_c)) $$\n考虑到 $\\eta_c$ 很大，我们可以使用近似 $\\cosh(\\eta_c) \\approx \\sinh(\\eta_c) \\approx \\frac{1}{2} e^{\\eta_c}$。\n$$ \\eta_c \\cosh(\\eta_c) - \\sinh(\\eta_c) \\approx \\frac{1}{2}e^{\\eta_c}(\\eta_c-1) $$\n所以，从 $1$ 中减去的项变为：\n$$ \\frac{3(\\eta_c+1)}{\\eta_c^3 e^{\\eta_c}} \\left( \\frac{1}{2}e^{\\eta_c}(\\eta_c-1) \\right) = \\frac{3(\\eta_c^2-1)}{2 \\eta_c^3} $$\n由 $\\eta_c^2 = R_c^2 k/D = (5.0 \\times 10^{-3})^2 (75) / (6.0 \\times 10^{-5}) = 31.25$，我们得到：\n$$ \\frac{3(31.25 - 1)}{2 (5.59017)^3} \\approx \\frac{3 \\times 30.25}{2 \\times 174.73} \\approx \\frac{90.75}{349.46} \\approx 0.2597 $$\n所以，$f(\\eta_c) \\approx 1 - 0.2597 = 0.7403$。\n最后，我们计算屏蔽因子：\n$$ S_f = \\frac{1}{1 + \\phi^2 f(\\eta_c)} = \\frac{1}{1 + (9.6)(0.7403)} = \\frac{1}{1 + 7.10688} = \\frac{1}{8.10688} \\approx 0.12335 $$\n四舍五入到三位有效数字，结果是 $0.123$。\n结果 $S_f  1$ 表明，由于相邻液滴的存在，蒸发速率降低了，这是屏蔽作用的预期物理行为。",
            "answer": "$$\n\\boxed{0.123}\n$$"
        },
        {
            "introduction": "最后的实践将我们的重点从理论建模转向计算数据分析，这是现代燃烧研究的一个关键部分。拉格朗日模拟会产生大量的颗粒数据，从中提取具有物理意义的统计数据是核心任务。在本练习  中，您将实现一个复杂的、基于核函数的估计器，从颗粒系综中计算条件平均量，学习如何处理边界效应和数据稀疏性等实际挑战，从而将模拟输出与基本的火焰特性联系起来。",
            "id": "4034629",
            "problem": "给定一个反应性非预混火焰的拉格朗日表示，其中计算粒子沿平流和扩散控制的轨迹携带热化学状态。混合分数被建模为一个守恒标量，温度通过热释放而演化。目标是通过对粒子系综进行统计采样，使用从第一性原理推导出的符合科学原理的估计器，来估计给定混合分数下的条件温度均值。您必须实现一个程序，该程序通过一个基于核的估计器从粒子数据计算条件温度均值，该估计器尊重混合分数的有界域并使用粒子质量加权，然后为指定的测试套件生成所要求的输出。\n\n此任务的基本基础由以下几点给出：\n- 使用牛顿运动学沿拉格朗日轨迹守恒的粒子位置和标量状态，即 $\\frac{d\\boldsymbol{X}}{dt} = \\boldsymbol{u}(\\boldsymbol{X},t)$，以及形式为 $\\frac{d\\phi}{dt} = \\text{源} + \\text{扩散}$ 的标量演化定律。\n- 混合分数 $Z$ 是一个有界的、无量綱的守恒标量（无化学源），在欧拉层面上遵循平流-扩散方程，而温度 $T$ 通过能量平衡 $\\frac{dT}{dt} = \\frac{\\dot{q}}{\\rho c_p} + \\text{扩散}$ 演化，其中 $\\dot{q}$ 是体积热释放率，$\\rho$ 是密度，$c_p$ 是比热。\n- 在拉格朗日蒙特卡洛表示中，一个质量为 $w_i > 0$ 的粒子系综通过狄拉克测度的总和来近似 $Z$ 和 $T$ 的联合分布。\n\n您的任务是：\n- 从上述基础和条件期望的标准定义中，推导出一个可从粒子数据 $\\{(Z_i, T_i, w_i)\\}_{i=1}^N$ 实现的条件温度均值 $\\mathbb{E}[T \\mid Z = z]$ 的估计器。该估计器必须：\n  - 基于用一个具有严格为正的带宽 $h > 0$ 的平滑核替换狄拉克测度，\n  - 通过边界修正尊重物理域 $Z \\in [0,1]$，确保在 $Z=0$ 和 $Z=1$ 附近没有质量的人为损失，\n  - 包含粒子质量加权 $w_i$，\n  - 包括一个数值上稳健的正则化方法，以避免除以零，同时在有足够数据时不会扭曲估计值。\n- 实现此估计器，以计算在指定的查询混合分数下的条件温度均值。所有报告的温度必须以开尔文表示，并四舍五入到三位小数。\n\n在您的推导和实现中应使用的定义和约束：\n- 条件均值 $\\mathbb{E}[T \\mid Z=z]$ 是根据 $T$ 和 $Z$ 的联合分布定义的，并且可以使用狄拉克测度和粒子系综平均来表示。\n- 核必须是带宽为 $h$ 的高斯核。混合分数域为 $Z \\in [0,1]$，必须通过与反射边界条件一致的适当边界修正来处理，不能让概率泄漏到域外。\n- 粒子温度 $T$ 应被视为以开尔文为单位的物理量。混合分数 $Z$ 是无量纲的。\n- 对粒子使用质量权重 $w_i$。当查询值处的有效核权重在数值上可以忽略不计时，应用一个物理上合理的正则化方案，该方案保持与系综的一致性。\n\n测试套件规范：\n您必须实现该估计器并为以下三个测试用例计算条件温度均值。每个测试用例包括粒子状态和权重、一组查询混合分数以及一个核带宽。\n\n- 测试用例 $\\mathbf{A}$ (类层流非预混火焰剖面):\n  - 粒子数: $N = 100$.\n  - 粒子混合分数: $Z_i = \\frac{i}{N-1}$ for $i=0,1,\\dots,N-1$, 所以 $Z_i \\in [0,1]$.\n  - 粒子温度 (开尔文): $$T_i = 300 + 1600\\,\\exp\\!\\left(-\\left(\\frac{Z_i - 0.06}{0.08}\\right)^2\\right) + 50\\,\\sin(2\\pi Z_i).$$\n  - 粒子权重: $w_i = 1$ for all $i$.\n  - 查询混合分数: $z_q \\in \\{0.0,\\,0.06,\\,0.5,\\,1.0\\}$.\n  - 核带宽: $h = 0.05$.\n\n- 测试用例 $\\mathbf{B}$ (双峰和局部熄火结构):\n  - 粒子数: $N = 80$.\n  - 粒子混合分数: $Z_i = \\frac{i}{N-1}$ for $i=0,1,\\dots,N-1$.\n  - 粒子温度 (开尔文): $$T_i = 300 + 1500\\,\\exp\\!\\left(-\\left(\\frac{Z_i - 0.06}{0.04}\\right)^2\\right) - 600\\,\\exp\\!\\left(-\\left(\\frac{Z_i - 0.06}{0.01}\\right)^2\\right) + 400\\,\\exp\\!\\left(-\\left(\\frac{Z_i - 0.7}{0.05}\\right)^2\\right).$$\n  - 粒子权重: $w_i = 1$ for all $i$.\n  - 查询混合分数: $z_q \\in \\{0.06,\\,0.7\\}$.\n  - 核带宽: $h = 0.04$.\n\n- 测试用例 $\\mathbf{C}$ (靠近边界相关区域的稀疏团簇，具有非均匀质量权重):\n  - 粒子数: $N = 40$.\n  - 粒子混合分数: $$Z_i = 0.2 + 0.02\\,\\cos\\!\\left(\\frac{2\\pi i}{N}\\right), \\quad i=0,1,\\dots,N-1,$$ 这会产生 $Z_i \\in [0.18,\\,0.22]$.\n  - 粒子温度 (开尔文): $$T_i = 300 + 1000\\,Z_i.$$\n  - 粒子权重: $$w_i = 1 + 0.5\\,\\cos(4\\pi Z_i), \\quad \\text{所以 } w_i \\in [0.5,\\,1.5].$$\n  - 查询混合分数: $z_q \\in \\{0.0,\\,0.1,\\,0.9,\\,1.0\\}$.\n  - 核带宽: $h = 0.06$.\n\n程序要求：\n- 实现上述估计器，并将其应用于所有测试用例。对于每个测试用例，计算在指定的查询混合分数下的条件温度均值列表，以开尔文表示并四舍五入到三位小数。\n- 最终输出格式：您的程序应生成单行输出，包含一个由逗号分隔的列表，列表内是对应于每个测试用例的浮点数列表，例如 $[[T_{A,1},T_{A,2},\\dots],[T_{B,1},T_{B,2}],[T_{C,1},\\dots]]$。精确打印一行，不含任何额外文本。",
            "solution": "用户希望推导并实现一个基于核的估计器，用于根据一组拉格朗日粒子数据计算一个标量（温度 $T$）在给定另一个标量（混合分数 $Z$）值时的条件均值。该问题设置在计算燃烧学的背景下。\n\n### 步骤1：问题验证\n\n#### 提取已知信息\n- **任务**：从粒子数据 $\\{(Z_i, T_i, w_i)\\}_{i=1}^N$ 推导并实现一个条件温度均值 $\\mathbb{E}[T \\mid Z = z]$ 的估计器。\n- **估计器要求**：\n    1.  基于核，使用带宽为 $h > 0$ 的高斯核。\n    2.  对域 $Z \\in [0,1]$ 进行边界修正，该修正与反射边界一致。\n    3.  包含粒子质量权重 $w_i > 0$。\n    4.  采用数值正则化以处理除以零或接近零的情况。\n- **物理背景**：\n    - 拉格朗日粒子，具有位置 $\\boldsymbol{X}$、混合分数 $Z$、温度 $T$ 和质量 $w_i$。\n    - 混合分数 $Z$ 是一个守恒标量，有界于 $[0,1]$。\n    - 温度 $T$ 随热释放和扩散而演化。\n- **定义与约束**：\n    - 条件均值通过 $T$ 和 $Z$ 的联合分布定义。\n    - 核：高斯核，带宽为 $h$。\n    - 域：$Z \\in [0,1]$。\n    - 输出：温度以开尔文为单位，四舍五入到三位小数。\n- **测试用例**：\n    - **用例 A**：$N = 100$。$Z_i = \\frac{i}{N-1}$ for $i=0, \\dots, N-1$。$T_i = 300 + 1600\\,\\exp\\!\\left(-\\left(\\frac{Z_i - 0.06}{0.08}\\right)^2\\right) + 50\\,\\sin(2\\pi Z_i)$。$w_i = 1$。查询 $z_q \\in \\{0.0,\\,0.06,\\,0.5,\\,1.0\\}$。带宽 $h = 0.05$。\n    - **用例 B**：$N = 80$。$Z_i = \\frac{i}{N-1}$ for $i=0, \\dots, N-1$。$T_i = 300 + 1500\\,\\exp\\!\\left(-\\left(\\frac{Z_i - 0.06}{0.04}\\right)^2\\right) - 600\\,\\exp\\!\\left(-\\left(\\frac{Z_i - 0.06}{0.01}\\right)^2\\right) + 400\\,\\exp\\!\\left(-\\left(\\frac{Z_i - 0.7}{0.05}\\right)^2\\right)$。$w_i = 1$。查询 $z_q \\in \\{0.06,\\,0.7\\}$。带宽 $h = 0.04$。\n    - **用例 C**：$N = 40$。$Z_i = 0.2 + 0.02\\,\\cos\\!\\left(\\frac{2\\pi i}{N}\\right)$ for $i=0, \\dots, N-1$。$T_i = 300 + 1000\\,Z_i$。$w_i = 1 + 0.5\\,\\cos(4\\pi Z_i)$。查询 $z_q \\in \\{0.0,\\,0.1,\\,0.9,\\,1.0\\}$。带宽 $h = 0.06$。\n- **输出格式**：单行打印一个浮点数列表的列表，例如 $[[T_{A,1}, \\dots], [T_{B,1}, \\dots], [T_{C,1}, \\dots]]$。\n\n#### 使用提取的已知信息进行验证\n根据验证标准对问题进行评估。\n- **科学基础**：该问题深深植根于统计力学、计算流体力学和燃烧理论等领域。拉格朗日粒子法、混合分数形式论和核密度估计都是标准的科学工具。这些概念在物理和数学上都是合理的。\n- **良构性**：问题被完全指定。它提供了理论基础、估计器的精确要求，以及三个不同测试用例的完整数值数据。目标是计算一个确定性的数值结果，这是明确定义的。\n- **客观性**：问题陈述使用了精确、无歧义的科学语言。定义和约束是定量的和客观的。\n\n该问题未表现出任何无效性缺陷：\n1.  **科学或事实不健全**：无。所涉及的物理和数学是标准的。\n2.  **不可形式化或不相关**：问题高度可形式化，并且是指定主题的核心。\n3.  **不完整或矛盾的设置**：无。所有必要信息都已提供。\n4.  **不切实际或不可行**：无。粒子数据和物理参数虽然是合成的，但代表了模拟中遇到的情况。\n5.  **病态或结构不良**：无。任务导向一个唯一、稳定且有意义的解。\n6.  **伪深刻、琐碎或同义反复**：问题是实质性的，要求推导一个带有特定约束（边界修正、加权、正则化）的非平凡统计估计器，并进行仔细实现。\n7.  **超出科学可验证性**：结果是计算上确定性的，并且可以验证。\n\n#### 结论与行动\n问题是有效的。将提供一个完整、合理的解决方案。\n\n### 基于原理的解决方案推导与算法设计\n\n目标是推导一个用于给定混合分数 $Z=z$ 时温度 $T$ 的条件期望的估计器，记为 $\\mathbb{E}[T \\mid Z=z]$。\n\n**1. 条件期望的正式定义**\n根据定义，$T$ 在给定 $Z=z$ 时的条件期望是在条件概率分布 $p(T \\mid z)$ 上的 $T$ 的平均值：\n$$ \\mathbbE}[T \\mid Z=z] = \\int T p(T \\mid z) \\, dT $$\n使用关系 $p(T \\mid z) = p(T, z) / p(z)$，其中 $p(T, z)$ 是联合概率密度函数 (PDF)，$p(z)$ 是 $Z$ 的边际 PDF，我们有：\n$$ \\mathbb{E}[T \\mid Z=z] = \\frac{\\int T p(T, z) \\, dT}{p(z)} $$\n\n**2. 拉格朗日粒子近似**\n在拉格朗日粒子方法中，联合 PDF $p(T, Z)$ 由一组 $N$ 个离散粒子近似，每个粒子携带质量 $w_i$ 并具有状态 $(Z_i, T_i)$。这表示为加权狄拉克 delta 函数的和：\n$$ p(T, Z) \\approx \\frac{1}{W} \\sum_{i=1}^N w_i \\delta(Z - Z_i) \\delta(T - T_i) $$\n其中 $W = \\sum_{j=1}^N w_j$ 是系综的总质量。\n\n将此代入分子和分母的表达式中得到：\n- 分母（$Z$ 的边际 PDF）：$p(z) = \\int p(T, z) \\, dT \\approx \\frac{1}{W} \\sum_{i=1}^N w_i \\delta(z - Z_i)$\n- 分子：$\\int T p(T, z) \\, dT \\approx \\frac{1}{W} \\sum_{i=1}^N w_i T_i \\delta(z - Z_i)$\n\n这导致了一个原始的、未平滑的表示，该表示是奇异的，并且仅在粒子位置 $Z_i$ 处有定义。\n\n**3. 核密度估计**\n为了获得平滑、连续的估计，我们将狄拉克 delta 函数 $\\delta(u)$ 替换为一个平滑的核函数 $K_h(u) = \\frac{1}{h}K(\\frac{u}{h})$，其中 $h$ 是带宽。问题指定了高斯核，其形式为 $K(u) = \\frac{1}{\\sqrt{2\\pi}} e^{-u^2/2}$。条件均值的估计器，称为 Nadaraya-Watson 估计器，变为：\n$$ \\hat{\\mathbb{E}}[T \\mid Z=z] = \\frac{\\sum_{i=1}^N w_i T_i K_h(z - Z_i)}{\\sum_{i=1}^N w_i K_h(z - Z_i)} $$\n总质量 $W$ 和来自核的归一化常数在分子和分母之间抵消。\n\n**4. 有界域的边界修正**\n混合分数 $Z$ 被限制在域 $[0,1]$ 内。在边界附近的标准核会将其概率质量“泄漏”到该域之外，导致估计有偏。问题要求一种与反射边界条件一致的修正。这通过反射法实现，该方法在边界处添加“虚拟”粒子反射，以确保域内的总概率守恒。\n\n对于位于 $Z_i$ 的粒子和查询点 $z \\in [0,1]$，我们考虑其关于边界 $Z=0$ 的反射（位于 $-Z_i$）和关于边界 $Z=1$ 的反射（位于 $1+(1-Z_i) = 2-Z_i$）。更高阶的反射存在，但对于像高斯核这样快速衰减的核，其贡献可以忽略不计。从粒子 $i$ 到点 $z$ 的有效、经边界修正的核贡献是主核及其反射图像的总和：\n$$ K_{eff}(z, Z_i; h) = K_h(z - Z_i) + K_h(z - (-Z_i)) + K_h(z - (2-Z_i)) $$\n$$ K_{eff}(z, Z_i; h) = K_h(z - Z_i) + K_h(z + Z_i) + K_h(z - 2 + Z_i) $$\n由于高斯核是对稱的，即 $K_h(u) = K_h(-u)$，这等价于 $K_h(z - Z_i) + K_h(z + Z_i) + K_h(2 - z - Z_i)$。为了实现方便，使用与核成比例的函数进行计算，因为常数因子会抵消。令 $G(u; h) = \\exp\\left(-\\frac{u^2}{2h^2}\\right)$。从粒子 $i$ 对查询点 $z$ 的有效权重与以下成正比：\n$$ G_{eff}(z, Z_i; h) = G(z-Z_i; h) + G(z+Z_i; h) + G(z-(2-Z_i); h) $$\n\n**5. 完整估计器公式**\n将经边界修正的有效核权重代入 Nadaraya-Watson 公式，得到最终的估计器：\n$$ \\hat{\\mathbb{E}}[T \\mid Z=z] = \\frac{\\sum_{i=1}^N w_i T_i G_{eff}(z, Z_i; h)}{\\sum_{i=1}^N w_i G_{eff}(z, Z_i; h)} $$\n\n**6. 正则化**\n如果查询点 $z$ 远离所有粒子位置 $Z_i$，带宽 $h$ 可能太小，以至于没有任何粒子能做出显著贡献。在这种情况下，分母 $D(z) = \\sum_{i=1}^N w_i G_{eff}(z, Z_i; h)$ 可能在数值上与零无法区分，导致除以零。一种物理上合理的正则化方法是返回最佳可用估计，即整个粒子系综的无条件平均温度：\n$$ \\bar{T}_{ensemble} = \\frac{\\sum_{k=1}^N w_k T_k}{\\sum_{k=1}^N w_k} $$\n算法将按如下方式实现：\n如果 $D(z)  \\epsilon_{tol}$，其中 $\\epsilon_{tol}$ 是一个小的数值容差（例如 $10^{-12}$），则估计温度为 $\\bar{T}_{ensemble}$。否则，使用上述比率计算该值。这种方法确保了数值稳定性，并在数据稀疏区域提供了一个物理上有意义的结果。\n\n**7. 算法实现**\n实现将遵循以下步骤：\n- 对于每个测试用例，生成粒子数据数组 $\\{Z_i\\}$, $\\{T_i\\}$, and $\\{w_i\\}$。\n- 对于每个查询点 $z_q$：\n    1.  计算高斯函数的参数向量：$u_1 = z_q - Z_i$, $u_2 = z_q + Z_i$, and $u_3 = z_q - (2 - Z_i)$。\n    2.  使用这些参数和带宽 $h$ 计算所有粒子的有效核权重 $G_{eff}$。\n    3.  使用向量化求和计算分子 $N(z_q) = \\sum w_i T_i G_{eff}(z_q, Z_i; h)$ 和分母 $D(z_q) = \\sum w_i G_{eff}(z_q, Z_i; h)$。\n    4.  应用正则化：如果 $D(z_q)$ 低于容差，则使用预先计算的系综平均温度。否则，计算比率 $N(z_q)/D(z_q)$。\n    5.  将最终温度四舍五入到三位小数。\n- 收集所有测试用例的结果，并将其格式化为指定的输出字符串。\n\n此算法设计将推导出的原理直接转化为一个稳健的数值程序。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to compute and print results for all test cases.\n    \"\"\"\n\n    def get_test_cases():\n        \"\"\"\n        Generates the particle data and parameters for all three test cases.\n        \"\"\"\n        cases = []\n\n        # Test case A\n        N_A = 100\n        z_i_A = np.linspace(0.0, 1.0, N_A)\n        T_i_A = 300.0 + 1600.0 * np.exp(-((z_i_A - 0.06) / 0.08)**2) + 50.0 * np.sin(2 * np.pi * z_i_A)\n        w_i_A = np.ones(N_A)\n        z_q_A = [0.0, 0.06, 0.5, 1.0]\n        h_A = 0.05\n        cases.append(((z_i_A, T_i_A, w_i_A), z_q_A, h_A))\n\n        # Test case B\n        N_B = 80\n        z_i_B = np.linspace(0.0, 1.0, N_B)\n        T_i_B = (300.0 + 1500.0 * np.exp(-((z_i_B - 0.06) / 0.04)**2) -\n                 600.0 * np.exp(-((z_i_B - 0.06) / 0.01)**2) +\n                 400.0 * np.exp(-((z_i_B - 0.7) / 0.05)**2))\n        w_i_B = np.ones(N_B)\n        z_q_B = [0.06, 0.7]\n        h_B = 0.04\n        cases.append(((z_i_B, T_i_B, w_i_B), z_q_B, h_B))\n\n        # Test case C\n        N_C = 40\n        i_C = np.arange(N_C)\n        z_i_C = 0.2 + 0.02 * np.cos(2 * np.pi * i_C / N_C)\n        T_i_C = 300.0 + 1000.0 * z_i_C\n        w_i_C = 1.0 + 0.5 * np.cos(4 * np.pi * z_i_C)\n        z_q_C = [0.0, 0.1, 0.9, 1.0]\n        h_C = 0.06\n        cases.append(((z_i_C, T_i_C, w_i_C), z_q_C, h_C))\n        \n        return cases\n\n    def compute_conditional_mean(particle_data, query_points, h, epsilon=1e-12):\n        \"\"\"\n        Computes the conditional mean temperature using a boundary-corrected kernel estimator.\n\n        Args:\n            particle_data (tuple): Contains particle Z, T, and w as numpy arrays.\n            query_points (list): A list of Z values at which to evaluate the mean.\n            h (float): The kernel bandwidth.\n            epsilon (float): Tolerance for regularization.\n\n        Returns:\n            list: A list of computed conditional mean temperatures, rounded.\n        \"\"\"\n        Z_particles, T_particles, w_particles = particle_data\n        results = []\n\n        # Pre-calculate the regularized value (unconditional ensemble mean)\n        # This is the fallback for data-sparse regions.\n        total_mass = np.sum(w_particles)\n        if total_mass > 0:\n            unconditional_mean_T = np.sum(w_particles * T_particles) / total_mass\n        else: # Handle case of zero total mass, though problem givens w_i > 0\n            unconditional_mean_T = 0.0\n\n        for zq in query_points:\n            # G(u; h) = exp(-u^2 / (2*h^2))\n            inv_2h_sq = 1.0 / (2.0 * h**2)\n            \n            # Primary kernel term\n            u1 = zq - Z_particles\n            k1 = np.exp(-u1**2 * inv_2h_sq)\n            \n            # Boundary reflection at Z=0\n            u2 = zq + Z_particles\n            k2 = np.exp(-u2**2 * inv_2h_sq)\n\n            # Boundary reflection at Z=1\n            u3 = zq - (2.0 - Z_particles)\n            k3 = np.exp(-u3**2 * inv_2h_sq)\n            \n            # Effective kernel weight with boundary correction\n            k_eff = k1 + k2 + k3\n            \n            # Numerator of the Nadaraya-Watson estimator\n            numerator = np.sum(w_particles * T_particles * k_eff)\n            \n            # Denominator of the Nadaraya-Watson estimator\n            denominator = np.sum(w_particles * k_eff)\n            \n            # Apply regularization if denominator is close to zero\n            if denominator  epsilon:\n                cond_mean_T = unconditional_mean_T\n            else:\n                cond_mean_T = numerator / denominator\n            \n            results.append(round(cond_mean_T, 3))\n            \n        return results\n\n    all_results = []\n    test_cases = get_test_cases()\n\n    for p_data, z_q, h in test_cases:\n        case_results = compute_conditional_mean(p_data, z_q, h)\n        all_results.append(case_results)\n\n    # Format the final output string as required\n    output_str = \"[\" + \",\".join([f\"[{','.join(map(str, res))}]\" for res in all_results]) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}