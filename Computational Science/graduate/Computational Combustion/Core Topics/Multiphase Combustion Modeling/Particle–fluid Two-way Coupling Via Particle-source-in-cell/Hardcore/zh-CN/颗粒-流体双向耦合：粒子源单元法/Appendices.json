{
    "hands_on_practices": [
        {
            "introduction": "在任何双向耦合方法中，第一步都是精确计算粒子与流体间的相互作用力（即源项）。本练习提供了一个具体示例，基于基本的曳力定律，计算单个计算网格中一团液滴产生的动量源项。该练习将抽象的源项概念建立在具体的计算之上，帮助您掌握从物理定律到计算流体力学（CFD）源项的基本转换 。",
            "id": "4048800",
            "problem": "考虑在一个欧拉控制体内，分散的液体燃料液滴相与气态载体之间的双向动量耦合，该过程采用网格中质点源法（Particle-Source-In-Cell, PSC）处理，其中质点力作为气体动量方程中的源项进行汇集。气态载体的密度为 $\\rho$，动力粘度为 $\\mu$，其在单元格内的局部速度是均匀的，等于 $\\mathbf{u}$。在体积为 $V_c$ 的单元格内，有 $N$ 个直径为 $d_p$、瞬时速度为 $\\mathbf{v}_p$ 的相同球形液滴。假设液滴上的重力、附加质量力、Basset 历史力、升力和压力梯度力与空气动力阻力相比可以忽略不计，并且液滴足够小，在动量耦合中可被视作点质点。\n\n使用标准的稳态阻力公式，其中球体的阻力系数关联式由 Schiller–Naumann 关联式给出：\n$$\nC_D(\\mathrm{Re}_p) \\;=\\; \\frac{24}{\\mathrm{Re}_p}\\left(1 + 0.15\\,\\mathrm{Re}_p^{0.687}\\right),\n$$\n其中质点雷诺数为\n$$\n\\mathrm{Re}_p \\;=\\; \\frac{\\rho\\,|\\mathbf{u}-\\mathbf{v}_p|\\,d_p}{\\mu}.\n$$\n液滴上的瞬时阻力模型为\n$$\n\\mathbf{F}_d \\;=\\; \\frac{1}{2}\\,\\rho\\,A_p\\,C_D(\\mathrm{Re}_p)\\,|\\mathbf{u}-\\mathbf{v}_p|\\,(\\mathbf{u}-\\mathbf{v}_p),\n$$\n其中 $A_p = \\pi d_p^2/4$ 是球体的投影面积。在 PSC 框架中，添加到气相动量方程的动量源是质点施加于流体的力的总和，以单位体积计。根据牛顿第三定律，该源等于在单元格内汇集的质点阻力的负值，并按单元格体积归一化，\n$$\n\\mathbf{S}_{\\mathbf{u}} \\;=\\; -\\frac{1}{V_c}\\sum_{i=1}^{N}\\mathbf{F}_{d,i}.\n$$\n\n根据以下给定数据，计算单元动量源 $\\mathbf{S}_{\\mathbf{u}}$ 的三个笛卡尔分量：\n- $N = 100$,\n- $d_p = 30\\times 10^{-6}\\;\\mathrm{m}$,\n- $\\rho = 1.2\\;\\mathrm{kg/m^3}$,\n- $\\mu = 1.8\\times 10^{-5}\\;\\mathrm{Pa\\cdot s}$,\n- $\\mathbf{u} = (2.0,\\;0,\\;0)\\;\\mathrm{m/s}$,\n- $\\mathbf{v}_p = (1.0,\\;0,\\;0)\\;\\mathrm{m/s}$,\n- $V_c = 1.0\\times 10^{-6}\\;\\mathrm{m^3}$。\n\n将您的最终答案 $\\mathbf{S}_{\\mathbf{u}}$ 以 $\\mathrm{N/m^3}$ 为单位，表示为一个三分量行向量，并将每个分量四舍五入到四位有效数字。",
            "solution": "目标是计算在单个控制体积内添加到气相动量方程的动量源项 $\\mathbf{S}_{\\mathbf{u}}$。源项定义为质点施加于流体的力的总和，以单位体积计。\n\n源项由下式给出：\n$$\n\\mathbf{S}_{\\mathbf{u}} = -\\frac{1}{V_c}\\sum_{i=1}^{N}\\mathbf{F}_{d,i}\n$$\n问题陈述指出，有 $N$ 个相同的液滴，它们都具有相同的瞬时速度 $\\mathbf{v}_p$。因此，所有 $N$ 个液滴的阻力 $\\mathbf{F}_{d,i}$ 都是相同的。求和可以简化为：\n$$\n\\mathbf{S}_{\\mathbf{u}} = -\\frac{N}{V_c}\\mathbf{F}_d\n$$\n单个液滴上的阻力 $\\mathbf{F}_d$ 由下式给出：\n$$\n\\mathbf{F}_d = \\frac{1}{2}\\,\\rho\\,A_p\\,C_D(\\mathrm{Re}_p)\\,|\\mathbf{u}-\\mathbf{v}_p|\\,(\\mathbf{u}-\\mathbf{v}_p)\n$$\n计算按以下步骤进行：\n\n1.  **计算相对速度矢量及其大小。**\n    气体速度为 $\\mathbf{u} = (2.0, 0, 0)\\;\\mathrm{m/s}$，液滴速度为 $\\mathbf{v}_p = (1.0, 0, 0)\\;\\mathrm{m/s}$。\n    相对速度矢量为：\n    $$\n    \\mathbf{u} - \\mathbf{v}_p = (2.0 - 1.0, 0 - 0, 0 - 0) = (1.0, 0, 0)\\;\\mathrm{m/s}\n    $$\n    相对速度的大小为：\n    $$\n    |\\mathbf{u} - \\mathbf{v}_p| = \\sqrt{1.0^2 + 0^2 + 0^2} = 1.0\\;\\mathrm{m/s}\n    $$\n\n2.  **计算质点雷诺数 $\\mathrm{Re}_p$。**\n    使用给定值 $\\rho = 1.2\\;\\mathrm{kg/m^3}$、$d_p = 30 \\times 10^{-6}\\;\\mathrm{m}$、$\\mu = 1.8 \\times 10^{-5}\\;\\mathrm{Pa\\cdot s}$ 和 $|\\mathbf{u} - \\mathbf{v}_p| = 1.0\\;\\mathrm{m/s}$：\n    $$\n    \\mathrm{Re}_p = \\frac{\\rho\\,|\\mathbf{u}-\\mathbf{v}_p|\\,d_p}{\\mu} = \\frac{(1.2\\;\\mathrm{kg/m^3})(1.0\\;\\mathrm{m/s})(30 \\times 10^{-6}\\;\\mathrm{m})}{1.8 \\times 10^{-5}\\;\\mathrm{Pa\\cdot s}} = \\frac{3.6 \\times 10^{-5}}{1.8 \\times 10^{-5}} = 2.0\n    $$\n    质点雷诺数恰好为 $2.0$。\n\n3.  **计算阻力系数 $C_D$。**\n    使用 Schiller–Naumann 关联式，其中 $\\mathrm{Re}_p = 2.0$：\n    $$\n    C_D(\\mathrm{Re}_p=2.0) = \\frac{24}{2.0}\\left(1 + 0.15 \\times (2.0)^{0.687}\\right)\n    $$\n    首先，计算幂次项：\n    $$\n    (2.0)^{0.687} \\approx 1.61036\n    $$\n    现在，将此值代入 $C_D$ 方程：\n    $$\n    C_D = 12 \\left(1 + 0.15 \\times 1.61036\\right) = 12 \\left(1 + 0.241554\\right) = 12(1.241554) \\approx 14.8986\n    $$\n\n4.  **计算液滴的投影面积 $A_p$。**\n    液滴是一个直径为 $d_p = 30 \\times 10^{-6}\\;\\mathrm{m}$ 的球体。\n    $$\n    A_p = \\frac{\\pi d_p^2}{4} = \\frac{\\pi (30 \\times 10^{-6}\\;\\mathrm{m})^2}{4} = \\frac{\\pi (900 \\times 10^{-12}\\;\\mathrm{m^2})}{4} = 225\\pi \\times 10^{-12}\\;\\mathrm{m^2}\n    $$\n    $A_p \\approx 7.06858 \\times 10^{-10}\\;\\mathrm{m^2}$。\n\n5.  **计算阻力矢量 $\\mathbf{F}_d$。**\n    将计算出的值代入阻力方程：\n    $$\n    \\mathbf{F}_d = \\frac{1}{2}(1.2)(7.06858 \\times 10^{-10})(14.8986)(1.0)(1.0, 0, 0)\\;\\mathrm{N}\n    $$\n    $$\n    \\mathbf{F}_d = (0.6)(7.06858 \\times 10^{-10})(14.8986)(1.0, 0, 0)\\;\\mathrm{N}\n    $$\n    力的大小为：\n    $$\n    |\\mathbf{F}_d| \\approx 6.31834 \\times 10^{-9}\\;\\mathrm{N}\n    $$\n    力矢量为：\n    $$\n    \\mathbf{F}_d \\approx (6.31834 \\times 10^{-9}, 0, 0)\\;\\mathrm{N}\n    $$\n\n6.  **计算单元动量源 $\\mathbf{S}_{\\mathbf{u}}$。**\n    使用 $N = 100$ 和 $V_c = 1.0 \\times 10^{-6}\\;\\mathrm{m^3}$：\n    $$\n    \\mathbf{S}_{\\mathbf{u}} = -\\frac{N}{V_c}\\mathbf{F}_d = -\\frac{100}{1.0 \\times 10^{-6}\\;\\mathrm{m^3}} (6.31834 \\times 10^{-9}, 0, 0)\\;\\mathrm{N}\n    $$\n    $$\n    \\mathbf{S}_{\\mathbf{u}} = -(10^8\\;\\mathrm{m^{-3}})(6.31834 \\times 10^{-9}, 0, 0)\\;\\mathrm{N}\n    $$\n    $$\n    \\mathbf{S}_{\\mathbf{u}} = -(0.631834, 0, 0)\\;\\mathrm{N/m^3}\n    $$\n\n7.  **最终答案的形成。**\n    问题要求将最终答案的每个分量四舍五入到四位有效数字。\n    - x 分量为 $-0.631834$。前四位有效数字是 $6, 3, 1, 8$。第五位数字是 $3$，因此向下舍入。该分量变为 $-0.6318$。\n    - y 和 z 分量恰好为 $0$。它们不需要四舍五入。\n    最终的矢量是 $\\mathbf{S}_{\\mathbf{u}} = (-0.6318, 0, 0)\\;\\mathrm{N/m^3}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -0.6318 & 0 & 0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在计算出源项之后，下一个关键步骤是将这个在拉格朗日框架下描述的“点”信息投影到欧拉网格上。本练习演示了云胞追踪法（Cloud-in-Cell, CIC），这是一种广泛用于此投影的格式。通过从基本守恒原理出发推导并应用权重函数，您将理解单个粒子的影响是如何被守恒地分配到相邻的网格节点上的 。",
            "id": "4048825",
            "problem": "在计算燃烧学的颗粒-流体双向耦合中，单元内颗粒源 (PSI-C) 方法通过使用一个紧支集核函数，将颗粒的源贡献以狄拉克δ分布的正则化近似形式分布到欧拉网格上。考虑一个间距为 $\\Delta x$、$\\Delta y$ 和 $\\Delta z$ 的均匀、结构化的笛卡尔网格，并假设单个颗粒位于位置 $\\mathbf{x}_{p} = (x_{p}, y_{p}, z_{p})$，该颗粒所在网格单元的左后下顶点坐标为 $(x_{0}, y_{0}, z_{0})$。该分布需要满足以下由守恒性和一致性产生的基本约束：(i) 在最近的8个顶点上具有紧支集，(ii) 正定性，(iii) 单位分解，以及 (iv) 在均匀网格上精确再现常数场和线性场（仿射完备性）。\n\n从这些约束出发，通过将核函数构建为沿每个坐标方向的一维分段线性函数的张量积，来为最近的8个顶点构建云中单元 (CIC) 形函数（权重）。设局部无量纲坐标定义为 $\\xi = (x_{p} - x_{0}) / \\Delta x$，$\\eta = (y_{p} - y_{0}) / \\Delta y$ 和 $\\zeta = (z_{p} - z_{0}) / \\Delta z$，其中 $\\xi, \\eta, \\zeta \\in [0,1]$。将8个顶点权重 $\\{w_{mnp}\\}$（其中 $m, n, p \\in \\{0,1\\}$ 是相对于 $(x_{0}, y_{0}, z_{0})$ 在 $x$、$y$ 和 $z$ 方向上的偏移索引）用 $\\xi$、$\\eta$ 和 $\\zeta$ 明确表示出来。\n\n然后，对于 $\\Delta x = \\Delta y = \\Delta z = 1$ 且颗粒位于 $(x_{p}, y_{p}, z_{p}) = (x_{0} + 0.3 \\Delta x, y_{0} + 0.7 \\Delta y, z_{0} + 0.4 \\Delta z)$ 的特定情况，按字典序 $(m, n, p) = (0,0,0), (1,0,0), (0,1,0), (0,0,1), (1,1,0), (1,0,1), (0,1,1), (1,1,1)$ 计算8个权重的数值。将最终数值四舍五入到四位有效数字。将最终答案以包含八个权重的单行矩阵形式报告。由于权重是无量纲的，因此不要包含单位。",
            "solution": "该问题要求基于一组基本约束，为笛卡尔网格单元内的颗粒构建云中单元 (CIC) 形函数（权重），然后为特定的颗粒位置计算这些权重。\n\n求解推导如下：\n我们从一维情况开始，沿 $x$ 坐标。局部坐标是 $\\xi \\in [0,1]$。一维单元段的两个顶点位于局部坐标 $0$ 和 $1$ 处。设相应的权重为 $W_{0}(\\xi)$ 和 $W_{1}(\\xi)$。简化到一维的约束是：\n1. 正定性：对于 $m \\in \\{0,1\\}$ 和 $\\xi \\in [0,1]$，$W_m(\\xi) \\ge 0$。\n2. 单位分解（零阶矩守恒）：$W_{0}(\\xi) + W_{1}(\\xi) = 1$。这确保了常数场被精确再现，从而保留了守恒量。\n3. 仿射完备性（一阶矩守恒）：顶点位置的加权平均值必须等于颗粒的位置。在局部坐标中，即 $0 \\cdot W_{0}(\\xi) + 1 \\cdot W_{1}(\\xi) = \\xi$。\n\n从一阶矩条件，我们直接得到 $W_{1}(\\xi) = \\xi$。\n将此代入单位分解条件，得到 $W_{0}(\\xi) + \\xi = 1$，从而得出 $W_{0}(\\xi) = 1 - \\xi$。\n这些函数 $W_{0}(\\xi) = 1 - \\xi$ 和 $W_{1}(\\xi) = \\xi$ 是分段线性的，并且对于 $\\xi \\in [0,1]$ 满足正定性约束。\n\n根据问题陈述，三维核函数是一维函数的张量积。在距离单元原点局部欧几里得坐标偏移为 $(m, n, p)$ 的顶点处的权重 $w_{mnp}$（其中 $m, n, p \\in \\{0,1\\}$）由每个方向相应的一维权重的乘积给出：\n$$w_{mnp}(\\xi, \\eta, \\zeta) = W_m(\\xi) W_n(\\eta) W_p(\\zeta)$$\n与 $x$ 方向类似，$y$ 和 $z$ 方向的一维权重为：\n$W_0(\\eta) = 1-\\eta$, $W_1(\\eta) = \\eta$\n$W_0(\\zeta) = 1-\\zeta$, $W_1(\\zeta) = \\zeta$\n\n因此，立方体单元顶点的八个权重由三线性插值函数给出：\n$w_{000} = W_0(\\xi)W_0(\\eta)W_0(\\zeta) = (1-\\xi)(1-\\eta)(1-\\zeta)$\n$w_{100} = W_1(\\xi)W_0(\\eta)W_0(\\zeta) = \\xi(1-\\eta)(1-\\zeta)$\n$w_{010} = W_0(\\xi)W_1(\\eta)W_0(\\zeta) = (1-\\xi)\\eta(1-\\zeta)$\n$w_{001} = W_0(\\xi)W_0(\\eta)W_1(\\zeta) = (1-\\xi)(1-\\eta)\\zeta$\n$w_{110} = W_1(\\xi)W_1(\\eta)W_0(\\zeta) = \\xi\\eta(1-\\zeta)$\n$w_{101} = W_1(\\xi)W_0(\\eta)W_1(\\zeta) = \\xi(1-\\eta)\\zeta$\n$w_{011} = W_0(\\xi)W_1(\\eta)W_1(\\zeta) = (1-\\xi)\\eta\\zeta$\n$w_{111} = W_1(\\xi)W_1(\\eta)W_1(\\zeta) = \\xi\\eta\\zeta$\n\n这些就是用局部坐标 $\\xi$、$\\eta$ 和 $\\zeta$ 表示的八个 CIC 权重表达式。\n\n接下来，我们为所提供的特定情况计算数值。颗粒位置给定为 $(x_{p}, y_{p}, z_{p}) = (x_{0} + 0.3 \\Delta x, y_{0} + 0.7 \\Delta y, z_{0} + 0.4 \\Delta z)$。局部坐标计算如下：\n$\\xi = \\frac{x_{p} - x_{0}}{\\Delta x} = \\frac{(x_{0} + 0.3 \\Delta x) - x_{0}}{\\Delta x} = 0.3$\n$\\eta = \\frac{y_{p} - y_{0}}{\\Delta y} = \\frac{(y_{0} + 0.7 \\Delta y) - y_{0}}{\\Delta y} = 0.7$\n$\\zeta = \\frac{z_{p} - z_{0}}{\\Delta z} = \\frac{(z_{0} + 0.4 \\Delta z) - z_{0}}{\\Delta z} = 0.4$\n\n我们也可以计算互补值：\n$1-\\xi = 1 - 0.3 = 0.7$\n$1-\\eta = 1 - 0.7 = 0.3$\n$1-\\zeta = 1 - 0.4 = 0.6$\n\n现在，我们将这些数值代入权重表达式。权重将按照问题陈述中给出的特定顺序列出：\n1. 对于 $(m,n,p)=(0,0,0)$: $w_{000} = (0.7)(0.3)(0.6) = 0.126$\n2. 对于 $(m,n,p)=(1,0,0)$: $w_{100} = (0.3)(0.3)(0.6) = 0.054$\n3. 对于 $(m,n,p)=(0,1,0)$: $w_{010} = (0.7)(0.7)(0.6) = 0.294$\n4. 对于 $(m,n,p)=(0,0,1)$: $w_{001} = (0.7)(0.3)(0.4) = 0.084$\n5. 对于 $(m,n,p)=(1,1,0)$: $w_{110} = (0.3)(0.7)(0.6) = 0.126$\n6. 对于 $(m,n,p)=(1,0,1)$: $w_{101} = (0.3)(0.3)(0.4) = 0.036$\n7. 对于 $(m,n,p)=(0,1,1)$: $w_{011} = (0.7)(0.7)(0.4) = 0.196$\n8. 对于 $(m,n,p)=(1,1,1)$: $w_{111} = (0.3)(0.7)(0.4) = 0.084$\n\n一个验证步骤是求所有权重的和，根据单位分解约束，其总和必须等于 $1$：\n$\\sum w = 0.126 + 0.054 + 0.294 + 0.084 + 0.126 + 0.036 + 0.196 + 0.084 = 1.000$。计算正确。\n\n问题要求四舍五入到四位有效数字。由于结果精确到三位小数，我们添加尾随零以满足此要求。\n$w_{000} = 0.1260$\n$w_{100} = 0.05400$\n$w_{010} = 0.2940$\n$w_{001} = 0.08400$\n$w_{110} = 0.1260$\n$w_{101} = 0.03600$\n$w_{011} = 0.1960$\n$w_{111} = 0.08400$\n\n这八个值被组合成一个单行矩阵作为最终答案。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.1260 & 0.05400 & 0.2940 & 0.08400 & 0.1260 & 0.03600 & 0.1960 & 0.08400\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "为了全面理解，理论必须付诸实践。本练习将指导您实现一个简单的一维双向耦合传热模拟，整合源项计算与网格投影。检验一个基于守恒律的数值方法的最终标准是检查该物理量是否在离散系统中真正守恒；本练习的最后一步便是验证耦合系统中的能量守恒，这是计算物理学中的一项关键技能 。",
            "id": "4048795",
            "problem": "您的任务是为一个在气体中经历瞬态加热的单个炭颗粒实现一维粒子-源项-网格 (Particle-Source-In-Cell, PSI) 耦合，该耦合需与计算燃烧学中的能量守恒相一致。其基本控制原理是颗粒和气体控制体积上的能量平衡。从热力学第一定律、牛顿冷却定律以及温度作为内能度量的定义推导出的颗粒能量平衡开始：\n- 颗粒遵循 $m_p c_{p,p} \\frac{d T_p}{dt} = h A_p \\left(T_g(x_p,t) - T_p(t)\\right)$，其中 $m_p$ 是颗粒质量，$c_{p,p}$ 是颗粒比热容，$T_p$ 是颗粒温度，$h$ 是对流传热系数，$A_p$ 是颗粒表面积，$T_g(x_p,t)$ 是在颗粒位置 $x_p$ 处的插值气体温度。\n- 气体遵循每个单元 $i$ 的有限体积能量平衡，其体积为 $V_i$，密度为 $\\rho_g$，比热容为 $c_{p,g}$：颗粒向周围单元施加一个分布式的功率汇 $S_h(t) = h A_p \\left(T_g(x_p,t) - T_p(t)\\right)$。在一维空间中使用带有线性形函数的粒子-源项-网格 (PSI) 方法，该汇通过满足 $\\sum_i w_i = 1$ 的权重 $\\{w_i\\}$ 进行分配，得出单元 $i$ 的温度演化为 $\\frac{d T_{g,i}}{dt} = -\\frac{w_i S_h(t)}{\\rho_g c_{p,g} V_i}$。\n\n实现一个长度为 $L$ 的均匀一维域，其中包含 $N$ 个等大小的有限体积单元。设单元宽度为 $dx = L/N$，单元中心位于 $x_i = (i+\\frac{1}{2}) dx$，其中 $i = 0, 1, \\ldots, N-1$。假设单位横截面积，因此 $V_i = dx$。气体属性 $\\rho_g$ 和 $c_{p,g}$ 在空间和时间上是恒定的。颗粒固定在位置 $x_p$ 上，不移动，并且仅通过对流与气体进行热交换。\n\n使用显式一阶时间积分，在 $n_{\\text{steps}}$ 个时间步长（大小为 $\\Delta t$）上进行。在每个时间步：\n- 使用线性权重，根据最近的两个单元中心插值计算颗粒位置的气体温度。权重定义如下：\n  - 如果 $x_p \\le x_0$，则设置 $w_0 = 1$，所有其他权重 $w_i = 0$。\n  - 如果 $x_p \\ge x_{N-1}$，则设置 $w_{N-1} = 1$，所有其他权重 $w_i = 0$。\n  - 否则，找到 $j$ 使得 $x_j \\le x_p \\le x_{j+1}$，并设置 $w_j = \\frac{x_{j+1}-x_p}{x_{j+1}-x_j}$ 和 $w_{j+1} = \\frac{x_p - x_j}{x_{j+1}-x_j}$，所有其他权重 $w_i = 0$。\n- 计算 $S_h(t) = h A_p \\left(T_g^{\\text{interp}} - T_p\\right)$，其中 $T_g^{\\text{interp}} = \\sum_i w_i T_{g,i}$。\n- 通过 $T_p \\leftarrow T_p + \\Delta t \\frac{S_h}{m_p c_{p,p}}$ 更新颗粒温度 $T_p$。\n- 通过 $T_{g,i} \\leftarrow T_{g,i} - \\Delta t \\frac{w_i S_h}{\\rho_g c_{p,g} V_i}$ 更新每个受影响的气体单元温度。\n\n在所有时间步结束后，计算能量守恒残差\n$$\nE_{\\text{res}} = \\left| m_p c_{p,p} \\left(T_p^{\\text{end}} - T_p^{0}\\right) + \\sum_{i=0}^{N-1} \\rho_g c_{p,g} V_i \\left(T_{g,i}^{\\text{end}} - T_{g,i}^{0}\\right) \\right|,\n$$\n如果离散化是一致且守恒的，该值应接近于 $0$。\n\n您的程序必须对以下参数集的测试套件执行上述过程。所有量都必须使用指定的单位进行处理，所有温度必须以开尔文（$\\mathrm{K}$）表示，长度以米（$\\mathrm{m}$）表示，时间以秒（$\\mathrm{s}$）表示，密度以千克每立方米（$\\mathrm{kg}/\\mathrm{m}^3$）表示，比热以焦耳每千克每开尔文（$\\mathrm{J}/(\\mathrm{kg}\\,\\mathrm{K})$）表示，面积以平方米（$\\mathrm{m}^2$）表示，对流系数以瓦特每平方米每开尔文（$\\mathrm{W}/(\\mathrm{m}^2\\,\\mathrm{K})$）表示。\n\n测试套件：\n- 案例 1 (通用情况): $N = 10$, $L = 0.1\\,\\mathrm{m}$, $\\rho_g = 1.2\\,\\mathrm{kg}/\\mathrm{m}^3$, $c_{p,g} = 1000\\,\\mathrm{J}/(\\mathrm{kg}\\,\\mathrm{K})$, $m_p = 1.0\\times 10^{-6}\\,\\mathrm{kg}$, $c_{p,p} = 1000\\,\\mathrm{J}/(\\mathrm{kg}\\,\\mathrm{K})$, $A_p = 1.0\\times 10^{-6}\\,\\mathrm{m}^2$, $h = 100\\,\\mathrm{W}/(\\mathrm{m}^2\\,\\mathrm{K})$, $\\Delta t = 1.0\\times 10^{-3}\\,\\mathrm{s}$, $n_{\\text{steps}} = 400$, $x_p = 0.045\\,\\mathrm{m}$, $T_p^0 = 300\\,\\mathrm{K}$, $T_{g,i}^0 = 1200\\,\\mathrm{K}$ for all $i$.\n- 案例 2 (边界映射): $N = 10$, $L = 0.1\\,\\mathrm{m}$, $\\rho_g = 1.2\\,\\mathrm{kg}/\\mathrm{m}^3$, $c_{p,g} = 1000\\,\\mathrm{J}/(\\mathrm{kg}\\,\\mathrm{K})$, $m_p = 1.0\\times 10^{-6}\\,\\mathrm{kg}$, $c_{p,p} = 1000\\,\\mathrm{J}/(\\mathrm{kg}\\,\\mathrm{K})$, $A_p = 1.0\\times 10^{-6}\\,\\mathrm{m}^2$, $h = 100\\,\\mathrm{W}/(\\mathrm{m}^2\\,\\mathrm{K})$, $\\Delta t = 1.0\\times 10^{-3}\\,\\mathrm{s}$, $n_{\\text{steps}} = 400$, $x_p = 0.001\\,\\mathrm{m}$, $T_p^0 = 300\\,\\mathrm{K}$, $T_{g,i}^0 = 1200\\,\\mathrm{K}$ for all $i$.\n- 案例 3 (零耦合边界情况): $N = 10$, $L = 0.1\\,\\mathrm{m}$, $\\rho_g = 1.2\\,\\mathrm{kg}/\\mathrm{m}^3$, $c_{p,g} = 1000\\,\\mathrm{J}/(\\mathrm{kg}\\,\\mathrm{K})$, $m_p = 1.0\\times 10^{-6}\\,\\mathrm{kg}$, $c_{p,p} = 1000\\,\\mathrm{J}/(\\mathrm{kg}\\,\\mathrm{K})$, $A_p = 1.0\\times 10^{-6}\\,\\mathrm{m}^2$, $h = 0\\,\\mathrm{W}/(\\mathrm{m}^2\\,\\mathrm{K})$, $\\Delta t = 1.0\\times 10^{-3}\\,\\mathrm{s}$, $n_{\\text{steps}} = 200$, $x_p = 0.055\\,\\mathrm{m}$, $T_p^0 = 300\\,\\mathrm{K}$, $T_{g,i}^0 = 1200\\,\\mathrm{K}$ for all $i$.\n- 案例 4 (强双向耦合): $N = 10$, $L = 0.1\\,\\mathrm{m}$, $\\rho_g = 1.2\\,\\mathrm{kg}/\\mathrm{m}^3$, $c_{p,g} = 1000\\,\\mathrm{J}/(\\mathrm{kg}\\,\\mathrm{K})$, $m_p = 5.0\\times 10^{-7}\\,\\mathrm{kg}$, $c_{p,p} = 1000\\,\\mathrm{J}/(\\mathrm{kg}\\,\\mathrm{K})$, $A_p = 1.0\\times 10^{-6}\\,\\mathrm{m}^2$, $h = 5000\\,\\mathrm{W}/(\\mathrm{m}^2\\,\\mathrm{K})$, $\\Delta t = 1.0\\times 10^{-4}\\,\\mathrm{s}$, $n_{\\text{steps}} = 5000$, $x_p = 0.049\\,\\mathrm{m}$, $T_p^0 = 300\\,\\mathrm{K}$, $T_{g,i}^0 = 1000\\,\\mathrm{K}$ for all $i$.\n\n对于每个案例，计算：\n- 最终颗粒温度 $T_p^{\\text{end}}$，单位为 $\\mathrm{K}$，四舍五入到三位小数。\n- 能量守恒残差 $E_{\\text{res}}$，单位为 $\\mathrm{J}$，四舍五入到六位小数。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素都是对应案例的子列表 $[T_p^{\\text{end}}, E_{\\text{res}}]$，不含空格。例如：$[[300.000,0.000000],[\\ldots],[\\ldots],[\\ldots]]$。",
            "solution": "该解决方案将遵循问题中概述的原理和算法步骤来开发。\n\n**1. 科学原理与模型构建**\n\n问题的核心在于由单个颗粒及其周围气体组成的耦合系统的能量守恒。\n\n- **颗粒能量平衡**：颗粒的温度 $T_p$ 根据热力学第一定律演化，其内能的变化与来自气体的热传递相平衡。使用牛顿冷却定律描述对流传热，可表示为：\n$$m_p c_{p,p} \\frac{d T_p}{dt} = h A_p \\left(T_g(x_p,t) - T_p(t)\\right)$$\n此处，$m_p$ 是颗粒质量，$c_{p,p}$ 是其比热，$A_p$ 是其表面积，$h$ 是对流传热系数，$T_g(x_p,t)$ 是在颗粒位置 $x_p$ 处的气体温度。右侧的项 $S_h(t) = h A_p \\left(T_g(x_p,t) - T_p(t)\\right)$ 代表交换的功率（传热速率）。\n\n- **气体能量平衡**：气相被离散化为有限体积单元。对于每个单元 $i$，其内能的变化是由于它与颗粒交换的热量。来自颗粒的功率 $S_h(t)$ 作为体积源/汇项分布到周围的气体单元中。单元 $i$ 的温度 $T_{g,i}$ 的演化由下式给出：\n$$\\rho_g c_{p,g} V_i \\frac{d T_{g,i}}{dt} = -w_i S_h(t)$$\n其中 $\\rho_g, c_{p,g}$ 是气体密度和比热，$V_i$ 是单元体积，$w_i$ 是来自 PSI 方法的权重因子，用于将总源项 $S_h(t)$ 分配到各个单元中。负号表示如果颗粒从气体中获得能量 ($S_h > 0$)，气体必须失去该能量。\n\n**2. 离散化与数值格式**\n\n- **空间离散化**：长度为 $L$ 的一维域被划分为 $N$ 个均匀单元。每个单元的宽度为 $dx = L/N$。单元中心（代表单元属性，如温度 $T_{g,i}$ 的存储位置）位于 $x_i = (i + 1/2)dx$，其中 $i=0, \\ldots, N-1$。对于单位横截面积，每个单元的体积为 $V_i = dx$。\n\n- **时间离散化**：使用一阶显式（前向欧拉）方法对控制常微分方程 (ODEs) 进行时间积分。对于一个时间步长 $\\Delta t$，温度从时间 $t^n$ 更新到 $t^{n+1} = t^n + \\Delta t$ 如下：\n$$T_p^{n+1} = T_p^n + \\Delta t \\frac{S_h^n}{m_p c_{p,p}}$$\n$$T_{g,i}^{n+1} = T_{g,i}^n - \\Delta t \\frac{w_i S_h^n}{\\rho_g c_{p,g} V_i}$$\n其中 $S_h^n$ 是使用时间 $t^n$ 的温度计算出的源项。\n\n**3. 粒子-源项-网格 (PSI) 耦合**\n\nPSI 方法提供了一种将拉格朗日颗粒与欧拉网格进行守恒耦合的方式。在每个时间层级，它包括两个主要步骤：\n\n- **插值 (Gather)**：计算传热速率需要颗粒连续位置 $x_p$ 处的气体温度，记为 $T_g^{\\text{interp}}$。这是通过使用线性形函数（权重）$\\{w_i\\}$ 从单元中心的离散温度 $T_{g,i}$ 插值得到的：\n$$T_g^{\\text{interp}} = \\sum_{i=0}^{N-1} w_i T_{g,i}$$\n权重是根据颗粒相对于最近的两个单元中心（例如 $x_j$ 和 $x_{j+1}$）的位置定义的。如果 $x_j \\le x_p \\le x_{j+1}$，则权重为 $w_j = (x_{j+1}-x_p)/dx$ 和 $w_{j+1} = (x_p-x_j)/dx$。对于超出单元中心范围的颗粒，定义了特殊处理。关键是，这种公式确保了 $\\sum_i w_i = 1$。\n\n- **分布 (Scatter)**：计算出的点源 $S_h = h A_p (T_g^{\\text{interp}} - T_p)$ 必须分布回网格上。使用相同的权重 $\\{w_i\\}$ 来分配源项，以确保一致性。单元 $i$ 的源项变为 $w_i S_h$。\n\n**4. 能量守恒**\n\n在插值和分布中使用相同的权重保证了离散双向耦合方案是守恒的。在一个时间步长内，颗粒的总能量变化为 $\\Delta E_p = m_p c_{p,p} (T_p^{n+1} - T_p^n) = \\Delta t S_h^n$。气体的总能量变化为 $\\Delta E_g = \\sum_i \\rho_g c_{p,g} V_i (T_{g,i}^{n+1} - T_{g,i}^n) = \\sum_i (-\\Delta t w_i S_h^n) = -\\Delta t S_h^n \\sum_i w_i$。由于 $\\sum_i w_i = 1$，系统的总能量变化为 $\\Delta E_{\\text{total}} = \\Delta E_p + \\Delta E_g = \\Delta t S_h^n - \\Delta t S_h^n = 0$。\n该模拟将计算整个模拟时间内的累积能量残差：\n$$E_{\\text{res}} = \\left| \\Delta E_p^{\\text{total}} + \\Delta E_g^{\\text{total}} \\right| = \\left| m_p c_{p,p} (T_p^{\\text{end}} - T_p^0) + \\sum_{i=0}^{N-1} \\rho_g c_{p,g} V_i (T_{g,i}^{\\text{end}} - T_{g,i}^0) \\right|$$\n对于一个守恒的方案，该值应为零，只受浮点算术误差的影响。\n\n**5. 算法实现**\n\n对于每个指定的测试案例，执行以下过程：\n1.  初始化所有物理和数值参数，包括颗粒 ($T_p$) 和气体网格 ($T_g$) 的初始温度数组。存储初始温度以用于最终的残差计算。\n2.  预先计算网格单元中心 ($x_i$) 和恒定的单元体积 ($V_i=dx$)”。\n3.  根据静态颗粒位置 $x_p$ 确定非零插值权重 ($w_i$) 和相应的单元索引。\n4.  执行一个包含 $n_{\\text{steps}}$ 个时间步的循环。在每个步骤中：\n    a. 计算颗粒位置处的插值气体温度 $T_g^{\\text{interp}}$。\n    b. 计算热源项 $S_h$。\n    c. 使用前向欧拉步长更新颗粒温度 $T_p$。\n    d. 使用前向欧拉步长更新受影响气体单元的温度 $T_{g,i}$。\n5.  循环终止后，计算颗粒能量的总变化和气体能量的总变化。\n6.  计算这些能量变化之和的绝对值，以求得能量守恒残差 $E_{\\text{res}}$。\n7.  存储最终颗粒温度 $T_p^{\\text{end}}$ 和残差 $E_{\\text{res}}$，并四舍五入到指定的精度。\n然后将所有测试案例的最终结果格式化为所需的输出字符串。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Executes the Particle-Source-In-Cell (PSI) simulation for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1 (general)\n        {\n            \"N\": 10, \"L\": 0.1, \"rho_g\": 1.2, \"cp_g\": 1000.0,\n            \"m_p\": 1.0e-6, \"cp_p\": 1000.0, \"A_p\": 1.0e-6, \"h\": 100.0,\n            \"dt\": 1.0e-3, \"n_steps\": 400, \"xp\": 0.045,\n            \"T0_p\": 300.0, \"T0_g\": 1200.0\n        },\n        # Case 2 (boundary mapping)\n        {\n            \"N\": 10, \"L\": 0.1, \"rho_g\": 1.2, \"cp_g\": 1000.0,\n            \"m_p\": 1.0e-6, \"cp_p\": 1000.0, \"A_p\": 1.0e-6, \"h\": 100.0,\n            \"dt\": 1.0e-3, \"n_steps\": 400, \"xp\": 0.001,\n            \"T0_p\": 300.0, \"T0_g\": 1200.0\n        },\n        # Case 3 (zero coupling edge case)\n        {\n            \"N\": 10, \"L\": 0.1, \"rho_g\": 1.2, \"cp_g\": 1000.0,\n            \"m_p\": 1.0e-6, \"cp_p\": 1000.0, \"A_p\": 1.0e-6, \"h\": 0.0,\n            \"dt\": 1.0e-3, \"n_steps\": 200, \"xp\": 0.055,\n            \"T0_p\": 300.0, \"T0_g\": 1200.0\n        },\n        # Case 4 (strong two-way coupling)\n        {\n            \"N\": 10, \"L\": 0.1, \"rho_g\": 1.2, \"cp_g\": 1000.0,\n            \"m_p\": 5.0e-7, \"cp_p\": 1000.0, \"A_p\": 1.0e-6, \"h\": 5000.0,\n            \"dt\": 1.0e-4, \"n_steps\": 5000, \"xp\": 0.049,\n            \"T0_p\": 300.0, \"T0_g\": 1000.0\n        },\n    ]\n\n    all_results = []\n    for params in test_cases:\n        result = run_simulation(params)\n        all_results.append(result)\n\n    # Format the output string as required\n    result_strings = [f\"[{tp_end:.3f},{e_res:.6f}]\" for tp_end, e_res in all_results]\n    print(f\"[{','.join(result_strings)}]\")\n\n\ndef run_simulation(params):\n    \"\"\"\n    Runs a single particle-gas heat exchange simulation.\n    \n    Args:\n        params (dict): A dictionary containing all parameters for the simulation.\n        \n    Returns:\n        tuple: A tuple containing the final particle temperature and the energy residual.\n    \"\"\"\n    # Unpack parameters\n    N, L, rho_g, cp_g = params[\"N\"], params[\"L\"], params[\"rho_g\"], params[\"cp_g\"]\n    m_p, cp_p, A_p, h = params[\"m_p\"], params[\"cp_p\"], params[\"A_p\"], params[\"h\"]\n    dt, n_steps, xp = params[\"dt\"], params[\"n_steps\"], params[\"xp\"]\n    T0_p, T0_g = params[\"T0_p\"], params[\"T0_g\"]\n\n    # --- Initialization ---\n    dx = L / N\n    V_i = dx  # Cell volume with unit cross-sectional area\n    x_centers = np.array([(i + 0.5) * dx for i in range(N)])\n\n    Tp = T0_p\n    Tg = np.full(N, T0_g, dtype=float)\n    \n    # Store initial state for residual calculation\n    initial_Tp = T0_p\n    initial_Tg = np.copy(Tg)\n\n    # --- Pre-calculate interpolation weights ---\n    indices = []\n    weights = []\n\n    if xp = x_centers[0]:\n        indices.append(0)\n        weights.append(1.0)\n    elif xp >= x_centers[N - 1]:\n        indices.append(N - 1)\n        weights.append(1.0)\n    else:\n        # Find j such that x_j = xp = x_{j+1}\n        found = False\n        for j in range(N - 1):\n            if x_centers[j] = xp and xp = x_centers[j+1]:\n                x_j, x_j1 = x_centers[j], x_centers[j + 1]\n                w_j = (x_j1 - xp) / dx\n                w_j1 = (xp - x_j) / dx\n                indices.extend([j, j + 1])\n                weights.extend([w_j, w_j1])\n                found = True\n                break\n        if not found:\n             # Should not happen with the logic above, but for safety\n             raise ValueError(\"Particle position is not within any cell interval.\")\n\n\n    # --- Time-stepping loop ---\n    for _ in range(n_steps):\n        # Interpolate gas temperature at particle location\n        Tg_interp = 0.0\n        for i, idx in enumerate(indices):\n            Tg_interp += weights[i] * Tg[idx]\n\n        # Calculate heat source term\n        S_h = h * A_p * (Tg_interp - Tp)\n\n        # Update particle temperature\n        Tp += dt * S_h / (m_p * cp_p)\n\n        # Update gas cell temperatures\n        for i, idx in enumerate(indices):\n            Tg[idx] -= dt * weights[i] * S_h / (rho_g * cp_g * V_i)\n\n    # --- Post-processing ---\n    # Final particle temperature\n    Tp_end = Tp\n\n    # Calculate energy conservation residual\n    dE_p = m_p * cp_p * (Tp_end - initial_Tp)\n    dE_g_total = np.sum(rho_g * cp_g * V_i * (Tg - initial_Tg))\n    E_res = abs(dE_p + dE_g_total)\n\n    return Tp_end, E_res\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}