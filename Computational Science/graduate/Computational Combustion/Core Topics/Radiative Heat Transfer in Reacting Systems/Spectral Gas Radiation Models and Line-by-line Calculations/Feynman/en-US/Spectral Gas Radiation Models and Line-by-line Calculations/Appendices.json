{
    "hands_on_practices": [
        {
            "introduction": "In reality, spectral lines are not infinitely thin but are broadened by physical processes. This practice explores the Voigt profile, which arises from the combination of thermal Doppler broadening (a Gaussian shape) and collisional pressure broadening (a Lorentzian shape). By computing the width and peak of the line under different conditions, you will gain a concrete understanding of how the line shape transitions from Gaussian-dominated to Lorentzian-dominated, a core concept in line-by-line modeling .",
            "id": "4066433",
            "problem": "Consider a single isolated spectral line in a homogeneous, isothermal gas parcel as treated in line-by-line spectral radiation modeling in computational combustion. The line shape results from the convolution of thermal Doppler broadening (modeled by a Gaussian) and collisional pressure broadening (modeled by a Lorentzian). Let the spectral coordinate be the wavenumber $\\tilde{\\nu}$ in $\\mathrm{cm^{-1}}$. Define the Gaussian line-shape kernel $G(\\tilde{\\nu};\\sigma)$ of unit area and the Lorentzian line-shape kernel $L(\\tilde{\\nu};\\gamma)$ of unit area, where $\\sigma$ is the Gaussian standard deviation and $\\gamma$ is the Lorentzian half width at half maximum (Half Width at Half Maximum (HWHM)). The Voigt line shape $V(\\tilde{\\nu};\\sigma,\\gamma)$ is the convolution\n$$\nV(\\tilde{\\nu};\\sigma,\\gamma) = \\int_{-\\infty}^{+\\infty} G(\\xi;\\sigma)\\,L(\\tilde{\\nu}-\\xi;\\gamma)\\,\\mathrm{d}\\xi.\n$$\nAssume that the Doppler half width at half maximum $\\,\\alpha_D\\,$ is given, and it is related to the Gaussian standard deviation by\n$$\n\\sigma = \\frac{\\alpha_D}{\\sqrt{2\\ln 2}}.\n$$\nAssume that the pressure broadening parameter $\\,\\gamma_L\\,$ is the Lorentzian half width at half maximum.\n\nStarting from these definitions and the convolution structure of the Voigt profile (without using any target shortcut formulas supplied in the problem statement), write a program to numerically compute, for a set of parameter pairs $(\\alpha_D,\\gamma_L)$:\n\n- the full width at half maximum (Full Width at Half Maximum (FWHM)) of $V(\\tilde{\\nu};\\sigma,\\gamma)$, denoted by $\\,\\mathrm{FWHM}(\\alpha_D,\\gamma_L)\\,$, in $\\mathrm{cm^{-1}}$, and\n- the peak value $\\,V(0;\\sigma,\\gamma)\\,$ at line center $\\tilde{\\nu}=0$, in $\\mathrm{cm}$ (note that the amplitude unit is the reciprocal of the wavenumber unit).\n\nYour program must implement a numerically robust method to evaluate $V(\\tilde{\\nu};\\sigma,\\gamma)$ for general $(\\alpha_D,\\gamma_L)$, and then determine $\\,\\mathrm{FWHM}(\\alpha_D,\\gamma_L)\\,$ by solving for the positive root $\\tilde{\\nu}_{1/2}0$ of the equation\n$$\nV(\\tilde{\\nu}_{1/2};\\sigma,\\gamma) = \\frac{1}{2}V(0;\\sigma,\\gamma),\n$$\nand using $\\mathrm{FWHM} = 2\\,\\tilde{\\nu}_{1/2}$. Your method must correctly handle the limiting cases where one of the broadenings vanishes (pure Gaussian with $\\gamma_L=0$ and pure Lorentzian with $\\alpha_D=0$), consistent with the underlying definitions.\n\nExpress the $\\mathrm{FWHM}$ values in $\\mathrm{cm^{-1}}$ and the peak values in $\\mathrm{cm}$, and round all reported numbers to $6$ decimal places.\n\nTest suite:\n- Case $\\,1\\,$: $(\\alpha_D,\\gamma_L) = (0.05, 0.0)$ in $\\mathrm{cm^{-1}}$.\n- Case $\\,2\\,$: $(\\alpha_D,\\gamma_L) = (0.05, 0.01)$ in $\\mathrm{cm^{-1}}$.\n- Case $\\,3\\,$: $(\\alpha_D,\\gamma_L) = (0.05, 0.05)$ in $\\mathrm{cm^{-1}}$.\n- Case $\\,4\\,$: $(\\alpha_D,\\gamma_L) = (0.05, 0.20)$ in $\\mathrm{cm^{-1}}$.\n- Case $\\,5\\,$: $(\\alpha_D,\\gamma_L) = (0.0, 0.05)$ in $\\mathrm{cm^{-1}}$.\n\nDesign for coverage: Case $\\,1\\,$ probes the pure Gaussian limit; Case $\\,2\\,$ is Gaussian-dominated; Case $\\,3\\,$ explores the transitional regime; Case $\\,4\\,$ is Lorentzian-dominated; Case $\\,5\\,$ probes the pure Lorentzian limit. These cases together demonstrate the transition from Gaussian-like to Lorentz-like shape through the behavior of both width and peak value.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output two numbers in order: first the $\\mathrm{FWHM}$ in $\\mathrm{cm^{-1}}$, then the peak value $V(0)$ in $\\mathrm{cm}$. The overall list orders the test cases $\\,1$ through $\\,5$ sequentially. For example, the output must have the form\n$$\n[\\mathrm{FWHM}_1,\\mathrm{Peak}_1,\\mathrm{FWHM}_2,\\mathrm{Peak}_2,\\mathrm{FWHM}_3,\\mathrm{Peak}_3,\\mathrm{FWHM}_4,\\mathrm{Peak}_4,\\mathrm{FWHM}_5,\\mathrm{Peak}_5],\n$$\nwith each entry rounded to $6$ decimal places.",
            "solution": "The user-provided problem has been validated and is determined to be a well-posed, scientifically grounded problem in the field of computational physics and spectral line modeling. It requires the numerical computation of key properties of the Voigt profile, which is fundamental in spectroscopy.\n\nThe complete solution is derived from first principles as follows.\n\n**1. Problem Formulation**\n\nThe task is to compute the peak value $V(0;\\sigma,\\gamma)$ and the Full Width at Half Maximum (FWHM) of the Voigt line shape, $V(\\tilde{\\nu};\\sigma,\\gamma)$, for several pairs of Doppler and collisional broadening parameters $(\\alpha_D, \\gamma_L)$. The Voigt profile is the convolution of a Gaussian profile $G(\\tilde{\\nu};\\sigma)$ representing thermal (Doppler) broadening and a Lorentzian profile $L(\\tilde{\\nu};\\gamma)$ representing collisional (pressure) broadening.\n\n**2. Constitutive Line Shape Kernels**\n\nThe problem states that the kernels are of unit area. Their standard definitions are:\n\nThe Gaussian kernel, modeling Doppler broadening, is given by:\n$$\nG(\\tilde{\\nu};\\sigma) = \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\left(-\\frac{\\tilde{\\nu}^2}{2\\sigma^2}\\right)\n$$\nHere, $\\tilde{\\nu}$ is the wavenumber in $\\mathrm{cm^{-1}}$, and $\\sigma$ is the Gaussian standard deviation. The problem relates $\\sigma$ to the Doppler Half Width at Half Maximum (HWHM), $\\alpha_D$, via the formula $\\sigma = \\alpha_D / \\sqrt{2\\ln 2}$. The FWHM of this pure Gaussian profile is $2\\alpha_D$.\n\nThe Lorentzian kernel, modeling pressure broadening, is given by:\n$$\nL(\\tilde{\\nu};\\gamma) = \\frac{1}{\\pi} \\frac{\\gamma}{\\tilde{\\nu}^2 + \\gamma^2}\n$$\nHere, $\\gamma$ is the Lorentzian HWHM, which is given as $\\gamma_L$ in the problem. The FWHM of this pure Lorentzian profile is $2\\gamma_L$.\n\nBoth $G(\\tilde{\\nu};\\sigma)$ and $L(\\tilde{\\nu};\\gamma)$ have units of $(\\mathrm{cm^{-1}})^{-1}$, which is $\\mathrm{cm}$, ensuring their integrals over $\\tilde{\\nu}$ are dimensionless.\n\n**3. Voigt Profile Calculation**\n\nThe Voigt profile $V(\\tilde{\\nu};\\sigma,\\gamma)$ is the convolution:\n$$\nV(\\tilde{\\nu};\\sigma,\\gamma) = (G * L)(\\tilde{\\nu}) = \\int_{-\\infty}^{+\\infty} G(\\xi;\\sigma)\\,L(\\tilde{\\nu}-\\xi;\\gamma)\\,\\mathrm{d}\\xi\n$$\nWhile this integral can be evaluated numerically, a more robust and computationally standard method relies on the Faddeeva function, also known as the complex complementary error function, $w(z)$. The Voigt profile can be expressed as the real part of the Faddeeva function with appropriate scaling:\n$$\nV(\\tilde{\\nu};\\sigma,\\gamma) = \\frac{\\text{Re}[w(z)]}{\\sigma\\sqrt{2\\pi}}\n$$\nwhere the complex argument $z$ is defined as:\n$$\nz = \\frac{\\tilde{\\nu} + i\\gamma}{\\sigma\\sqrt{2}}\n$$\nThis formulation is numerically stable and is implemented in standard scientific libraries like SciPy. Since the convolution of two unit-area functions results in a unit-area function, this formulation of $V$ correctly maintains unit area.\n\n**4. Calculation of Peak and FWHM**\n\nFor a given pair of parameters $(\\alpha_D, \\gamma_L)$, we first compute the requisite profile parameters $\\sigma = \\alpha_D / \\sqrt{2\\ln 2}$ and $\\gamma = \\gamma_L$.\n\n**Peak Value, $V(0)$**:\nThe peak of the Voigt profile occurs at the line center, $\\tilde{\\nu}=0$.\n$$\nV(0;\\sigma,\\gamma) = V(\\tilde{\\nu}=0;\\sigma,\\gamma) = \\frac{\\text{Re}\\left[w\\left(\\frac{i\\gamma}{\\sigma\\sqrt{2}}\\right)\\right]}{\\sigma\\sqrt{2\\pi}}\n$$\nThis value is computed directly using the Faddeeva function.\n\n**Full Width at Half Maximum (FWHM)**:\nThe FWHM is defined as $2\\tilde{\\nu}_{1/2}$, where $\\tilde{\\nu}_{1/2}$ is the positive wavenumber at which the profile's value is half of its peak value. We must solve the following non-linear equation for $\\tilde{\\nu}_{1/2}$:\n$$\nV(\\tilde{\\nu}_{1/2};\\sigma,\\gamma) = \\frac{1}{2}V(0;\\sigma,\\gamma)\n$$\nThis equation does not have a general closed-form analytical solution and must be solved numerically. A reliable approach is to use a root-finding algorithm, such as Brent's method, on the function $f(\\tilde{\\nu}) = V(\\tilde{\\nu};\\sigma,\\gamma) - \\frac{1}{2}V(0;\\sigma,\\gamma)$. Since $V(\\tilde{\\nu})$ is an even, positive function that monotonically decreases for $\\tilde{\\nu}0$, a unique positive root $\\tilde{\\nu}_{1/2}$ is guaranteed to exist.\n\n**5. Handling of Limiting Cases**\n\nThe problem requires a robust implementation that correctly handles the limits where one broadening mechanism vanishes. Instead of relying on the general numerical method to handle near-zero parameters, it is more accurate and robust to implement the analytical solutions for these pure cases.\n\n**Case 1: Pure Gaussian Profile ($\\gamma_L = 0, \\alpha_D  0$)**\nThe Voigt profile degenerates to the Gaussian kernel, $V(\\tilde{\\nu};\\sigma,0) = G(\\tilde{\\nu};\\sigma)$.\n- **FWHM**: The FWHM is analytically known to be $2\\sigma\\sqrt{2\\ln 2}$. Using the given relation $\\sigma = \\alpha_D / \\sqrt{2\\ln 2}$, the FWHM is exactly $2\\alpha_D$.\n- **Peak Value**: The peak is $G(0) = \\frac{1}{\\sigma\\sqrt{2\\pi}}$. Substituting for $\\sigma$, we get $V(0) = \\frac{\\sqrt{2\\ln 2}}{\\alpha_D\\sqrt{2\\pi}} = \\frac{\\sqrt{\\ln 2 / \\pi}}{\\alpha_D}$.\n\n**Case 2: Pure Lorentzian Profile ($\\alpha_D = 0, \\gamma_L  0$)**\nIn this limit, $\\sigma \\to 0$, and the Gaussian kernel approaches a Dirac delta function $\\delta(\\tilde{\\nu})$. The convolution of any function with $\\delta(\\tilde{\\nu})$ is the function itself. Thus, the Voigt profile degenerates to the Lorentzian kernel, $V(\\tilde{\\nu};0,\\gamma) = L(\\tilde{\\nu};\\gamma)$.\n- **FWHM**: The FWHM of a Lorentzian is, by definition of its HWHM $\\gamma_L$, exactly $2\\gamma_L$.\n- **Peak Value**: The peak is $L(0) = \\frac{1}{\\pi\\gamma_L}$.\n\n**6. Algorithm Summary**\n\nThe implementation will follow these steps for each test case $(\\alpha_D, \\gamma_L)$:\n1.  Check if $\\gamma_L = 0$. If so, apply the analytical formulas for the pure Gaussian case.\n2.  Check if $\\alpha_D = 0$. If so, apply the analytical formulas for the pure Lorentzian case.\n3.  For the general (mixed) case where $\\alpha_D  0$ and $\\gamma_L  0$:\n    a.  Calculate $\\sigma = \\alpha_D / \\sqrt{2\\ln 2}$.\n    b.  Define a function `voigt(nu, ...)` that computes the Voigt profile using `scipy.special.wofz`.\n    c.  Calculate the `peak_value` by calling `voigt(0, ...)`.\n    d.  Define an objective function `f(nu) = voigt(nu, ...) - 0.5 * peak_value`.\n    e.  Use a numerical root-finder (`scipy.optimize.root_scalar` with Brent's method) to find the root $\\tilde{\\nu}_{1/2}$ of `f(nu)=0` in a suitable interval, e.g., $[0, 10(\\alpha_D + \\gamma_L)]$.\n    f.  The FWHM is $2 \\times \\tilde{\\nu}_{1/2}$.\n4.  Store the calculated FWHM and peak values.\n5.  After processing all cases, format the results into a single string with the specified precision and structure.\n\nThis methodology is faithful to the first principles of line shape theory, numerically robust, and correctly handles all specified physical regimes.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import wofz\nfrom scipy.optimize import root_scalar\n\ndef solve():\n    \"\"\"\n    Solves for the FWHM and peak value of the Voigt profile for a series of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0.05, 0.0),   # Case 1: Pure Gaussian\n        (0.05, 0.01),  # Case 2: Gaussian-dominated\n        (0.05, 0.05),  # Case 3: Transitional\n        (0.05, 0.20),  # Case 4: Lorentzian-dominated\n        (0.0, 0.05)    # Case 5: Pure Lorentzian\n    ]\n\n    all_results = []\n    \n    for alpha_D, gamma_L in test_cases:\n        fwhm, peak = calculate_voigt_properties(alpha_D, gamma_L)\n        all_results.append(fwhm)\n        all_results.append(peak)\n\n    # Format the final output string with 6 decimal places.\n    formatted_results = [f\"{r:.6f}\" for r in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef calculate_voigt_properties(alpha_D, gamma_L):\n    \"\"\"\n    Calculates the FWHM and peak value for a given set of Doppler and Lorentz HWHMs.\n\n    Args:\n        alpha_D (float): Doppler Half Width at Half Maximum (HWHM).\n        gamma_L (float): Lorentzian Half Width at Half Maximum (HWHM).\n\n    Returns:\n        tuple: A tuple containing the FWHM and the peak value.\n    \"\"\"\n    # Handle the pure Gaussian limit analytically.\n    if gamma_L == 0.0 and alpha_D  0.0:\n        fwhm = 2.0 * alpha_D\n        peak = np.sqrt(np.log(2.0) / np.pi) / alpha_D\n        return fwhm, peak\n\n    # Handle the pure Lorentzian limit analytically.\n    if alpha_D == 0.0 and gamma_L  0.0:\n        fwhm = 2.0 * gamma_L\n        peak = 1.0 / (np.pi * gamma_L)\n        return fwhm, peak\n    \n    # Handle the pathological case of no broadening. Not in test suite.\n    if alpha_D == 0.0 and gamma_L == 0.0:\n        return 0.0, np.inf\n\n    # General Voigt profile calculation for the mixed case.\n    sigma = alpha_D / np.sqrt(2.0 * np.log(2.0))\n\n    def voigt(nu):\n        \"\"\"Computes the Voigt profile V(nu) using the Faddeeva function.\"\"\"\n        # The argument for the Faddeeva function w(z)\n        z = (nu + 1j * gamma_L) / (sigma * np.sqrt(2.0))\n        # The Voigt profile is proportional to the real part of w(z).\n        # Normalization ensures the profile has unit area.\n        return np.real(wofz(z)) / (sigma * np.sqrt(2.0 * np.pi))\n\n    # The peak value is at the line center (nu = 0).\n    peak_value = voigt(0.0)\n\n    # Define the equation whose root gives the HWHM.\n    def half_max_equation(nu):\n        return voigt(nu) - 0.5 * peak_value\n\n    # Find the HWHM (nu_half) by finding the root of the equation.\n    # The Voigt profile is monotonically decreasing, so a root is guaranteed.\n    # A generous but safe upper bound for the search bracket is chosen.\n    # A small positive lower bound is used to avoid any issues at nu=0.\n    search_bracket = [1e-9, 10.0 * (alpha_D + gamma_L)]\n    try:\n        sol = root_scalar(half_max_equation, bracket=search_bracket, method='brentq')\n        nu_half = sol.root\n    except ValueError:\n        # Fallback if the initial bracket is not wide enough, though unlikely\n        sol = root_scalar(half_max_equation, bracket=[1e-9, 100.0 * (alpha_D + gamma_L)], method='brentq')\n        nu_half = sol.root\n\n\n    # FWHM is twice the HWHM.\n    fwhm = 2.0 * nu_half\n\n    return fwhm, peak_value\n\n# Execute the main function.\nsolve()\n```"
        },
        {
            "introduction": "The shape of a spectral line is complemented by its strength, or integrated intensity $S$, which varies significantly with temperature. This exercise delves into the underlying statistical mechanics, guiding you to derive and compute the temperature-dependent line intensity $S(T)$ based on the Boltzmann distribution and the correction for stimulated emission. Mastering this calculation is crucial for accurately modeling gas radiation in high-temperature environments such as flames and engines .",
            "id": "4066431",
            "problem": "A homogeneous, isothermal, and optically thin slab of water vapor is analyzed using a line-by-line spectral radiation model. Consider a single transition of the main isotopologue of water vapor ($\\mathrm{H_2^{16}O}$) at line center wavenumber $\\nu_0$ with lower-state energy $E''$. The objective is to compute the temperature-dependent line intensity $S(T)$ and to compare the computed values against reference values representative of the High-resolution Transmission molecular absorption database (HITRAN) tables.\n\nStarting from fundamental statistical mechanics and radiative transfer principles for molecular transitions, and without using shortcut formulas, derive the temperature dependence of the integrated line intensity $S(T)$ based on:\n- The Boltzmann distribution for lower-state population.\n- The internal partition function $Q(T)$.\n- The correction for stimulated emission.\nThen, express $S(T)$ in terms of the known reference intensity $S(T_0)$ at a standard temperature $T_0$, eliminating any unknown transition-specific constants.\n\nUse the following physically consistent parameters and constants:\n- Standard temperature $T_0 = 296\\ \\mathrm{K}$.\n- Known reference intensity $S(T_0) = 1.5\\times 10^{-22}\\ \\mathrm{cm}^{-1}/(\\mathrm{molecule}\\cdot \\mathrm{cm}^{-2})$.\n- Line center wavenumber $\\nu_0 = 3800\\ \\mathrm{cm}^{-1}$.\n- Lower-state energy $E'' = 500\\ \\mathrm{cm}^{-1}$.\n- Second radiation constant $c_2 = \\frac{h c}{k_{\\mathrm{B}}}$ with $c_2 = 1.438776877\\ \\mathrm{cm}\\cdot \\mathrm{K}$.\n- Partition function values for $\\mathrm{H_2^{16}O}$ at the test temperatures:\n  - $Q(150\\ \\mathrm{K}) = 83.49$\n  - $Q(296\\ \\mathrm{K}) = 174.12$\n  - $Q(1000\\ \\mathrm{K}) = 1197.00$\n  - $Q(2000\\ \\mathrm{K}) = 4605.00$\n\nDefine the comparison against a reference HITRAN-style table constructed consistently with the same physics but using a rounded second radiation constant $c_2^{\\mathrm{ref}} = 1.4387770\\ \\mathrm{cm}\\cdot \\mathrm{K}$. The comparison temperatures are:\n- $T = 296\\ \\mathrm{K}$ (consistency check),\n- $T = 150\\ \\mathrm{K}$ (low-temperature edge),\n- $T = 1000\\ \\mathrm{K}$ (typical high-temperature combustion application),\n- $T = 2000\\ \\mathrm{K}$ (extreme combustion-relevant high temperature).\n\nYour tasks:\n1. Derive, from first principles, an expression for $S(T)$ in terms of $S(T_0)$, $E''$, $\\nu_0$, $Q(T)$, $Q(T_0)$, and $c_2$.\n2. Implement this expression to compute $S(T)$ for $T \\in \\{150\\ \\mathrm{K}, 296\\ \\mathrm{K}, 1000\\ \\mathrm{K}, 2000\\ \\mathrm{K}\\}$ using the provided $Q(T)$ values and constants.\n3. Construct reference intensities $S_{\\mathrm{ref}}(T)$ for the same temperatures using the same expression but with $c_2^{\\mathrm{ref}}$ in place of $c_2$.\n4. Compute the fractional deviation for each test temperature as\n   $$\\delta(T) = \\dfrac{S(T) - S_{\\mathrm{ref}}(T)}{S_{\\mathrm{ref}}(T)}.$$\n5. Report the four values of $\\delta(T)$ in the order $[296\\ \\mathrm{K}, 150\\ \\mathrm{K}, 1000\\ \\mathrm{K}, 2000\\ \\mathrm{K}]$.\n\nPhysical units and numerical requirements:\n- The line intensity $S(T)$ must be computed in $\\mathrm{cm}^{-1}/(\\mathrm{molecule}\\cdot \\mathrm{cm}^{-2})$.\n- Temperatures are in $\\mathrm{K}$.\n- Wavenumbers and lower-state energy are in $\\mathrm{cm}^{-1}$.\n- The fractional deviations $\\delta(T)$ are unitless decimal values.\n\nTest suite and final output specification:\n- Use the four temperatures listed above as the test suite.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[x_1,x_2,x_3,x_4]$), where each $x_i$ is the computed $\\delta(T)$ for the corresponding temperature in the order specified.",
            "solution": "The user has requested the derivation and computation of the temperature-dependent line intensity for a single rovibrational transition of water vapor, followed by a comparison highlighting the sensitivity to the second radiation constant, $c_2$.\n\n### Step 1: Problem Validation\n\n**Extraction of Givens:**\n- Standard temperature: $T_0 = 296\\ \\mathrm{K}$.\n- Reference intensity at $T_0$: $S(T_0) = 1.5\\times 10^{-22}\\ \\mathrm{cm}^{-1}/(\\mathrm{molecule}\\cdot \\mathrm{cm}^{-2})$.\n- Line center wavenumber: $\\nu_0 = 3800\\ \\mathrm{cm}^{-1}$.\n- Lower-state energy: $E'' = 500\\ \\mathrm{cm}^{-1}$.\n- Second radiation constant: $c_2 = \\dfrac{h c}{k_{\\mathrm{B}}} = 1.438776877\\ \\mathrm{cm}\\cdot \\mathrm{K}$.\n- Reference second radiation constant: $c_2^{\\mathrm{ref}} = 1.4387770\\ \\mathrm{cm}\\cdot \\mathrm{K}$.\n- Partition function values for $\\mathrm{H_2^{16}O}$:\n  - $Q(296\\ \\mathrm{K}) = 174.12$\n  - $Q(150\\ \\mathrm{K}) = 83.49$\n  - $Q(1000\\ \\mathrm{K}) = 1197.00$\n  - $Q(2000\\ \\mathrm{K}) = 4605.00$\n- Test temperatures: $T \\in \\{150\\ \\mathrm{K}, 296\\ \\mathrm{K}, 1000\\ \\mathrm{K}, 2000\\ \\mathrm{K}\\}$.\n- Formula for fractional deviation: $\\delta(T) = \\dfrac{S(T) - S_{\\mathrm{ref}}(T)}{S_{\\mathrm{ref}}(T)}$.\n- Required output order for $\\delta(T)$: $[296\\ \\mathrm{K}, 150\\ \\mathrm{K}, 1000\\ \\mathrm{K}, 2000\\ \\mathrm{K}]$.\n\n**Validation Assessment:**\nThe problem is scientifically grounded, well-posed, and objective. It is based on fundamental principles of statistical mechanics and radiative transfer, specifically the Boltzmann distribution and stimulated emission, which are central to line-by-line spectral models. All necessary data and constants are provided, and their values are physically realistic for a water vapor transition. The task is specific, and the required calculations lead to a unique, meaningful solution. The problem is free of any of the invalidating flaws listed in the instructions.\n\n**Verdict:**\nThe problem is valid.\n\n### Step 2: Derivation of Temperature-Dependent Line Intensity, $S(T)$\n\nThe integrated line intensity, $S(T)$, for a spectral line is a measure of the total absorption per molecule for a specific transition. For a transition from a lower energy state, denoted by a double prime ($''$), to an upper state, denoted by a single prime ($'$), the intensity at temperature $T$ can be expressed as:\n$$ S(T) = (\\text{Constant}) \\times (\\text{Lower state population}) \\times (\\text{Stimulated emission correction}) $$\nThe constant term includes fundamental constants and transition-specific properties like the Einstein coefficient, which are independent of temperature.\n\n1.  **Lower-State Population**: According to the Boltzmann distribution, the fraction of molecules in the lower energy state $E''$ with degeneracy $g''$ at thermal equilibrium temperature $T$ is given by:\n    $$ N_{E''} = \\frac{g'' \\exp\\left(-\\frac{E''}{k_{\\mathrm{B}} T}\\right)}{Q(T)} $$\n    where $k_{\\mathrm{B}}$ is the Boltzmann constant and $Q(T) = \\sum_i g_i \\exp(-E_i / k_{\\mathrm{B}} T)$ is the total internal partition function, which sums over all possible energy states $i$.\n\n2.  **Stimulated Emission Correction**: The net absorption of radiation must account for both absorption from the lower state and stimulated emission from the upper state. The correction factor is given by $\\left(1 - \\frac{N_{E'} g''}{N_{E''} g'}\\right)$, where $N_{E'}$ is the population fraction of the upper state. Using the Boltzmann distribution for the ratio of populations, this becomes:\n    $$ 1 - \\exp\\left(-\\frac{E' - E''}{k_{\\mathrm{B}} T}\\right) $$\n    The energy difference between the states is related to the line center wavenumber $\\nu_0$ by $E' - E'' = h c \\nu_0$, where $h$ is the Planck constant and $c$ is the speed of light. Thus, the correction term is:\n    $$ 1 - \\exp\\left(-\\frac{h c \\nu_0}{k_{\\mathrm{B}} T}\\right) $$\n\nCombining these parts, the line intensity $S(T)$ takes the form:\n$$ S(T) = C \\cdot \\frac{1}{Q(T)} \\cdot \\exp\\left(-\\frac{E''}{k_{\\mathrm{B}} T}\\right) \\cdot \\left[1 - \\exp\\left(-\\frac{h c \\nu_0}{k_{\\mathrm{B}} T}\\right)\\right] $$\nwhere $C$ is a temperature-independent constant specific to the transition. To facilitate calculation, we introduce the second radiation constant, $c_2 = \\frac{h c}{k_{\\mathrm{B}}}$, with units of $\\mathrm{cm}\\cdot\\mathrm{K}$. Note that for this to be dimensionally correct, energy terms like $E''$ and wavenumber $\\nu_0$ must be expressed in units of $\\mathrm{cm}^{-1}$. The expression for $S(T)$ becomes:\n$$ S(T) = C \\frac{\\exp(-c_2 E'' / T)}{Q(T)} \\left[1 - \\exp(-c_2 \\nu_0 / T)\\right] $$\n\nTo eliminate the unknown constant $C$, we formulate a ratio with the known reference intensity $S(T_0)$ at a standard temperature $T_0$:\n$$ \\frac{S(T)}{S(T_0)} = \\frac{C \\frac{\\exp(-c_2 E'' / T)}{Q(T)} \\left[1 - \\exp(-c_2 \\nu_0 / T)\\right]}{C \\frac{\\exp(-c_2 E'' / T_0)}{Q(T_0)} \\left[1 - \\exp(-c_2 \\nu_0 / T_0)\\right]} $$\nThe constant $C$ cancels out. Rearranging to solve for $S(T)$ yields the desired expression:\n$$ S(T) = S(T_0) \\frac{Q(T_0)}{Q(T)} \\frac{\\exp(-c_2 E'' / T)}{\\exp(-c_2 E'' / T_0)} \\frac{1 - \\exp(-c_2 \\nu_0 / T)}{1 - \\exp(-c_2 \\nu_0 / T_0)} $$\nThis can be written more compactly as:\n$$ S(T) = S(T_0) \\frac{Q(T_0)}{Q(T)} \\exp\\left[-c_2 E''\\left(\\frac{1}{T} - \\frac{1}{T_0}\\right)\\right] \\frac{1 - \\exp(-c_2 \\nu_0 / T)}{1 - \\exp(-c_2 \\nu_0 / T_0)} $$\nThis is the final expression used for calculation. It correctly models the temperature dependence of line intensity based on the scaling of the partition function, the lower-state Boltzmann population, and the stimulated emission correction.\n\n### Step 3: Derivation of the Fractional Deviation, $\\delta(T)$\n\nThe problem requires computing the fractional deviation $\\delta(T)$ between the line intensity $S(T)$ calculated with $c_2$, and a reference intensity $S_{\\mathrm{ref}}(T)$ calculated with $c_2^{\\mathrm{ref}}$.\n$$ \\delta(T) = \\frac{S(T) - S_{\\mathrm{ref}}(T)}{S_{\\mathrm{ref}}(T)} = \\frac{S(T)}{S_{\\mathrm{ref}}(T)} - 1 $$\nThe expression for $S_{\\mathrm{ref}}(T)$ is identical to that for $S(T)$, but with $c_2^{\\mathrm{ref}}$ replacing $c_2$:\n$$ S_{\\mathrm{ref}}(T) = S(T_0) \\frac{Q(T_0)}{Q(T)} \\exp\\left[-c_2^{\\mathrm{ref}} E''\\left(\\frac{1}{T} - \\frac{1}{T_0}\\right)\\right] \\frac{1 - \\exp(-c_2^{\\mathrm{ref}} \\nu_0 / T)}{1 - \\exp(-c_2^{\\mathrm{ref}} \\nu_0 / T_0)} $$\nWhen we take the ratio $S(T) / S_{\\mathrm{ref}}(T)$, the common terms $S(T_0)$ and $\\frac{Q(T_0)}{Q(T)}$ cancel out:\n$$ \\frac{S(T)}{S_{\\mathrm{ref}}(T)} = \\frac{\\exp\\left[-c_2 E''\\left(\\frac{1}{T} - \\frac{1}{T_0}\\right)\\right]}{\\exp\\left[-c_2^{\\mathrm{ref}} E''\\left(\\frac{1}{T} - \\frac{1}{T_0}\\right)\\right]} \\cdot \\frac{\\frac{1 - \\exp(-c_2 \\nu_0 / T)}{1 - \\exp(-c_2 \\nu_0 / T_0)}}{\\frac{1 - \\exp(-c_2^{\\mathrm{ref}} \\nu_0 / T)}{1 - \\exp(-c_2^{\\mathrm{ref}} \\nu_0 / T_0)}} $$\nThis simplifies to:\n$$ \\frac{S(T)}{S_{\\mathrm{ref}}(T)} = \\exp\\left[(c_2^{\\mathrm{ref}} - c_2) E''\\left(\\frac{1}{T} - \\frac{1}{T_0}\\right)\\right] \\cdot \\frac{1 - \\exp(-c_2 \\nu_0 / T)}{1 - \\exp(-c_2^{\\mathrm{ref}} \\nu_0 / T)} \\cdot \\frac{1 - \\exp(-c_2^{\\mathrm{ref}} \\nu_0 / T_0)}{1 - \\exp(-c_2 \\nu_0 / T_0)} $$\nThe fractional deviation $\\delta(T)$ is then computed by subtracting $1$ from this ratio. For the special case where $T=T_0$, the term $\\left(\\frac{1}{T} - \\frac{1}{T_0}\\right)$ becomes zero, and all ratios become $1$. Thus, $\\frac{S(T_0)}{S_{\\mathrm{ref}}(T_0)} = 1$, and $\\delta(T_0) = 0$, as expected.\n\n### Step 4: Implementation and Calculation\n\nThe derived expression for $\\delta(T)$ will be implemented in Python. The calculation will be performed for each specified temperature using the provided constants $c_2$ and $c_2^{\\mathrm{ref}}$, and the results will be reported in the required order. High-precision floating-point arithmetic is used to accurately capture the small differences.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the fractional deviation in line intensity due to a small\n    difference in the second radiation constant, c2.\n    \"\"\"\n\n    # Define the physical parameters and constants from the problem statement.\n    T0 = 296.0  # Standard temperature in K\n    # S_T0 is not needed for the delta calculation, but included for completeness.\n    # S_T0 = 1.5e-22  # Reference intensity in cm^-1/(molecule.cm^-2)\n    nu0 = 3800.0  # Line center wavenumber in cm^-1\n    E_pp = 500.0  # Lower-state energy (E'') in cm^-1\n\n    # Second radiation constants in cm.K\n    c2 = 1.438776877\n    c2_ref = 1.4387770\n\n    # Test temperatures in the required output order\n    test_temperatures = [296.0, 150.0, 1000.0, 2000.0]\n\n    # The partition function values Q(T) are not needed for the calculation\n    # of the fractional deviation delta(T) as they cancel out in the ratio.\n\n    # List to store the results\n    results = []\n\n    # Loop through each test temperature to compute the fractional deviation\n    for T in test_temperatures:\n        # For the case T = T0, the deviation is exactly zero by definition.\n        if T == T0:\n            delta = 0.0\n            results.append(delta)\n            continue\n\n        # Calculate the ratio S(T) / S_ref(T) using the derived formula.\n        # This formula directly computes the ratio, avoiding intermediate calculations\n        # of S(T) and S_ref(T), which improves numerical stability.\n\n        # Term 1: Contribution from the Boltzmann factor for the lower state population\n        boltzmann_ratio_exp = (c2_ref - c2) * E_pp * (1.0/T - 1.0/T0)\n        boltzmann_ratio = np.exp(boltzmann_ratio_exp)\n\n        # Term 2: Ratio of stimulated emission corrections at temperature T\n        stim_emission_num_T = 1.0 - np.exp(-c2 * nu0 / T)\n        stim_emission_den_T = 1.0 - np.exp(-c2_ref * nu0 / T)\n        stim_emission_ratio_T = stim_emission_num_T / stim_emission_den_T\n\n        # Term 3: Ratio of stimulated emission corrections at reference temperature T0\n        stim_emission_num_T0 = 1.0 - np.exp(-c2_ref * nu0 / T0)\n        stim_emission_den_T0 = 1.0 - np.exp(-c2 * nu0 / T0)\n        stim_emission_ratio_T0 = stim_emission_num_T0 / stim_emission_den_T0\n        \n        # The total ratio of line intensities S(T) / S_ref(T)\n        s_ratio = boltzmann_ratio * stim_emission_ratio_T * stim_emission_ratio_T0\n\n        # The fractional deviation is the ratio minus 1\n        delta = s_ratio - 1.0\n        results.append(delta)\n\n    # Format the final output as a comma-separated list in brackets.\n    # The str() conversion ensures standard decimal representation.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "This final practice bridges the gap from single-line theory to the computational reality of modeling a full spectral band with many lines. It highlights a critical challenge: ensuring the computational grid is fine enough to resolve the sharp features of each line. You will determine the minimum grid resolution needed to accurately calculate an important engineering quantity, the Planck-mean absorption coefficient, thereby building essential skills for developing robust radiative transfer codes .",
            "id": "4066442",
            "problem": "Consider a one-dimensional spectral band in wavenumber space, denoted by the variable $\\,\\sigma\\,$ with unit $\\mathrm{cm}^{-1}$. The absorption coefficient of a gas is modeled by a set of $\\,N_\\ell\\,$ discrete spectral lines, each represented by a pressure-broadened Lorentz profile. The spectral absorption coefficient is defined as\n$$\nk(\\sigma) \\;=\\; \\sum_{i=1}^{N_\\ell} S_i \\, L\\!\\left(\\sigma;\\sigma_i,\\gamma_i\\right),\n$$\nwhere $\\,S_i\\,$ is the line strength, $\\,\\sigma_i\\,$ is the line center, and $\\,\\gamma_i\\,$ is the half-width at half-maximum (HWHM) broadening parameter. The Lorentz line shape is given by\n$$\nL\\!\\left(\\sigma;\\sigma_i,\\gamma_i\\right) \\;=\\; \\frac{1}{\\pi}\\,\\frac{\\gamma_i}{(\\sigma-\\sigma_i)^2+\\gamma_i^2},\n$$\nwhich is normalized such that $\\,\\int_{-\\infty}^{\\infty} L(\\sigma;\\sigma_i,\\gamma_i)\\,d\\sigma \\;=\\; 1\\,$.\n\nLet the Planck function in wavenumber form be\n$$\nB_\\sigma(T) \\;=\\; \\frac{2 h c^2 \\sigma^3}{\\exp\\!\\left(\\frac{h c \\sigma}{k_B T}\\right) - 1},\n$$\nwhere $\\,h\\,$ is Planck’s constant, $\\,c\\,$ is the speed of light, $\\,k_B\\,$ is Boltzmann’s constant, and $\\,T\\,$ is the absolute temperature. In this problem, $\\,\\sigma\\,$ is in $\\mathrm{cm}^{-1}$ and $\\,c\\,$ is to be taken in $\\mathrm{cm/s}$ to maintain consistency.\n\nDefine the band-integrated absorption over a finite wavenumber interval $[\\sigma_a,\\sigma_b]$ as\n$$\nI \\;=\\; \\int_{\\sigma_a}^{\\sigma_b} k(\\sigma)\\,d\\sigma,\n$$\nand the band-limited Planck mean absorption coefficient as\n$$\nk_P(T;\\sigma_a,\\sigma_b) \\;=\\; \\frac{\\int_{\\sigma_a}^{\\sigma_b} k(\\sigma)\\,B_\\sigma(T)\\,d\\sigma}{\\int_{\\sigma_a}^{\\sigma_b} B_\\sigma(T)\\,d\\sigma}.\n$$\n\nIn computational practice, these integrals are approximated on uniform grids using the trapezoidal rule. However, under-resolution (i.e., too few grid points relative to narrow spectral features) can cause significant errors. Your task is to analyze the under-resolution effects on $\\,I\\,$ and to identify the minimum grid density (number of uniform points across the band) required to achieve a robust Planck mean $\\,k_P\\,$ with a specified relative error tolerance.\n\nStarting from the definitions above and using only well-established physical laws (e.g., the Planck function) and standard numerical quadrature (e.g., the trapezoidal rule), implement a program that:\n- Computes the exact band-integrated absorption $\\,I\\,$ analytically using the properties of the Lorentz profile over a finite interval.\n- Computes a high-accuracy reference for $\\,k_P\\,$ using numerically accurate integration over the band (not the coarse trapezoid sum), and compares this reference to trapezoidal-rule approximations on progressively refined uniform grids.\n- Determines the minimum number of grid points $\\,N_{\\min}\\,$ such that the relative error in the trapezoidal $\\,k_P\\,$ is less than or equal to a specified tolerance $\\,\\tau\\,$.\n- Quantifies the under-resolution effect on $\\,I\\,$ by reporting the relative error of the trapezoidal approximation of $\\,I\\,$ at a specified coarse grid size $N_\\text{coarse}$.\n\nAll reported errors must be dimensionless relative errors of the form\n$$\n\\varepsilon_X \\;=\\; \\left|\\frac{X_{\\text{approx}} - X_{\\text{ref}}}{X_{\\text{ref}}}\\right|,\n$$\nwhere $\\,X\\,$ stands for either $\\,I\\,$ or $\\,k_P\\,$ as appropriate. The reference for $\\,I\\,$ must be the analytic finite-interval Lorentz integral, and the reference for $\\,k_P\\,$ must be a numerically accurate integration using a non-trapezoidal high-accuracy method.\n\nYour program must produce results for the following three test cases. In all cases, $\\,S_i\\,$ is specified in consistent units with $\\,k(\\sigma)\\,$ such that the Lorentz profile normalization is respected; all outputs are dimensionless except $\\,N_{\\min}\\,$ which is an integer count of grid points.\n\nTest Case 1 (General \"happy path\"):\n- Band: $[\\sigma_a,\\sigma_b] = [2200,\\,2400]$ in $\\mathrm{cm}^{-1}$.\n- Temperature: $\\,T = 1800\\,$ K.\n- Lines: \n  - $\\,(\\sigma_1,S_1,\\gamma_1) = (2280,\\,1.0,\\,0.25)$,\n  - $\\,(\\sigma_2,S_2,\\gamma_2) = (2350,\\,0.6,\\,0.15)$,\n  - $\\,(\\sigma_3,S_3,\\gamma_3) = (2390,\\,0.8,\\,0.40)$.\n- Coarse grid for $\\,I\\,$ error: $\\,N_{\\text{coarse}} = 400$.\n- Planck mean tolerance: $\\,\\tau = 0.01$.\n\nTest Case 2 (Boundary and under-resolution stress test with very narrow lines):\n- Band: $[\\sigma_a,\\sigma_b] = [2199.5,\\,2200.5]$ in $\\mathrm{cm}^{-1}$.\n- Temperature: $\\,T = 1200\\,$ K.\n- Lines:\n  - $\\,(\\sigma_1,S_1,\\gamma_1) = (2200.0,\\,1.5,\\,0.01)$,\n  - $\\,(\\sigma_2,S_2,\\gamma_2) = (2199.7,\\,0.7,\\,0.008)$.\n- Coarse grid for $\\,I\\,$ error: $\\,N_{\\text{coarse}} = 50$.\n- Planck mean tolerance: $\\,\\tau = 0.01$.\n\nTest Case 3 (Mixed widths and strengths, sensitivity across a different band):\n- Band: $[\\sigma_a,\\sigma_b] = [3500,\\,3600]$ in $\\mathrm{cm}^{-1}$.\n- Temperature: $\\,T = 800\\,$ K.\n- Lines:\n  - $\\,(\\sigma_1,S_1,\\gamma_1) = (3525,\\,0.2,\\,0.05)$,\n  - $\\,(\\sigma_2,S_2,\\gamma_2) = (3555,\\,1.8,\\,0.20)$,\n  - $\\,(\\sigma_3,S_3,\\gamma_3) = (3599,\\,0.5,\\,0.03)$,\n  - $\\,(\\sigma_4,S_4,\\gamma_4) = (3570,\\,0.1,\\,0.005)$.\n- Coarse grid for $\\,I\\,$ error: $\\,N_{\\text{coarse}} = 300$.\n- Planck mean tolerance: $\\,\\tau = 0.01$.\n\nAlgorithmic requirements:\n- Use the trapezoidal rule on uniform grids to approximate integrals for $\\,I\\,$ and $\\,k_P\\,$ at specified grid densities.\n- Use a high-accuracy numerical integrator to construct the reference for $\\,k_P\\,$ over each band.\n- Identify $\\,N_{\\min}\\,$ from the candidate set $\\,\\{64,\\,128,\\,256,\\,512,\\,1024,\\,2048,\\,4096,\\,8192,\\,16384\\}\\,$ as the smallest grid size meeting the tolerance requirement. If none meet the tolerance, take $\\,N_{\\min}\\,$ to be the largest candidate and report the achieved error.\n\nFinal output requirement:\n- Your program should produce a single line of output containing the nine results in the order\n  $$\n  [\\varepsilon_I^{(1)}, \\varepsilon_{k_P}^{(1)}, N_{\\min}^{(1)}, \\varepsilon_I^{(2)}, \\varepsilon_{k_P}^{(2)}, N_{\\min}^{(2)}, \\varepsilon_I^{(3)}, \\varepsilon_{k_P}^{(3)}, N_{\\min}^{(3)}],\n  $$\n  where superscripts denote the test case index. The floating-point values must be printed as standard decimals, and the grid counts as integers, all comma-separated and enclosed in square brackets. No additional text must be printed. All error outputs are dimensionless numbers as defined above. The grid counts are pure integers without units.",
            "solution": "The problem requires an analysis of numerical under-resolution effects in the calculation of radiative properties of a gas. Specifically, we are asked to quantify the error in band-integrated absorption, $I$, and to determine the minimum grid resolution, $N_{\\min}$, required to compute the Planck mean absorption coefficient, $k_P$, within a specified tolerance. The analysis is to be performed for three distinct test cases. The solution involves a combination of analytical integration, high-accuracy numerical quadrature, and the trapezoidal rule on uniform grids.\n\nFirst, we define the necessary physical and mathematical functions. The spectral absorption coefficient, $k(\\sigma)$, is given by the sum of $N_\\ell$ Lorentz profiles:\n$$\nk(\\sigma) = \\sum_{i=1}^{N_\\ell} S_i \\, L(\\sigma;\\sigma_i,\\gamma_i)\n$$\nwhere $S_i$ is the line strength, $\\sigma_i$ is the line center, and $\\gamma_i$ is the half-width at half-maximum (HWHM). The normalized Lorentz line shape function, $L(\\sigma;\\sigma_i,\\gamma_i)$, is:\n$$\nL(\\sigma;\\sigma_i,\\gamma_i) = \\frac{1}{\\pi}\\,\\frac{\\gamma_i}{(\\sigma-\\sigma_i)^2+\\gamma_i^2}\n$$\nThe thermal radiation is described by the Planck function in wavenumber form, $B_\\sigma(T)$:\n$$\nB_\\sigma(T) = \\frac{2 h c^2 \\sigma^3}{\\exp\\left(\\frac{h c \\sigma}{k_B T}\\right) - 1}\n$$\nwhere $h$, $c$, and $k_B$ are Planck's constant, the speed of light, and Boltzmann's constant, respectively.\n\nThe primary quantities of interest are the band-integrated absorption, $I$, and the band-limited Planck mean absorption coefficient, $k_P$, defined over a wavenumber interval $[\\sigma_a, \\sigma_b]$:\n$$\nI = \\int_{\\sigma_a}^{\\sigma_b} k(\\sigma)\\,d\\sigma \\quad \\text{and} \\quad k_P(T;\\sigma_a,\\sigma_b) = \\frac{\\int_{\\sigma_a}^{\\sigma_b} k(\\sigma)\\,B_\\sigma(T)\\,d\\sigma}{\\int_{\\sigma_a}^{\\sigma_b} B_\\sigma(T)\\,d\\sigma}\n$$\n\nThe solution proceeds in three main steps for each test case.\n\nFirst, we establish a reference value for the band-integrated absorption, $I_{\\text{ref}}$. This is achieved by analytically integrating the sum of Lorentz profiles over the finite interval $[\\sigma_a, \\sigma_b]$. The integral of a single Lorentz profile is an arctangent function:\n$$\n\\int_{\\sigma_a}^{\\sigma_b} L(\\sigma;\\sigma_i,\\gamma_i)\\,d\\sigma = \\frac{1}{\\pi} \\left[ \\arctan\\left(\\frac{\\sigma_b - \\sigma_i}{\\gamma_i}\\right) - \\arctan\\left(\\frac{\\sigma_a - \\sigma_i}{\\gamma_i}\\right) \\right]\n$$\nSumming over all lines gives the exact value, $I_{\\text{ref}} = \\sum_i S_i \\int_{\\sigma_a}^{\\sigma_b} L(\\sigma;\\sigma_i,\\gamma_i)\\,d\\sigma$. We then compute a numerical approximation, $I_{\\text{approx}}$, using the trapezoidal rule on a coarse grid of $N_{\\text{coarse}}$ points. The relative error, $\\varepsilon_I$, is calculated as $\\varepsilon_I = |(I_{\\text{approx}} - I_{\\text{ref}}) / I_{\\text{ref}}|$.\n\nSecond, we determine a high-accuracy reference value for the Planck mean absorption coefficient, $k_{P, \\text{ref}}$. Both the numerator and denominator integrals defining $k_P$ are computed using a robust numerical quadrature method, for which `scipy.integrate.quad` is an excellent choice. This function implements an adaptive quadrature scheme that provides high accuracy. To improve its robustness, especially for test cases with very narrow spectral lines (small $\\gamma_i$), the locations of the line centers, $\\sigma_i$, are provided as points where the integrand may be difficult. This yields reference values for the numerator, $N_{\\text{ref}} = \\int_{\\sigma_a}^{\\sigma_b} k(\\sigma)\\,B_\\sigma(T)\\,d\\sigma$, and the denominator, $D_{\\text{ref}} = \\int_{\\sigma_a}^{\\sigma_b} B_\\sigma(T)\\,d\\sigma$, from which $k_{P, \\text{ref}} = N_{\\text{ref}} / D_{\\text{ref}}$ is found.\n\nThird, we find the minimum number of grid points, $N_{\\min}$, from a specified candidate set $\\{64, 128, \\dots, 16384\\}$ required for the trapezoidal approximation of $k_P$ to achieve a relative error $\\varepsilon_{k_P}$ less than or equal to a given tolerance $\\tau = 0.01$. We iterate through the candidate grid sizes in increasing order. For each size $N$, we construct a uniform grid of $\\sigma$ values from $\\sigma_a$ to $\\sigma_b$ and compute the integrands $k(\\sigma)B_\\sigma(T)$ and $B_\\sigma(T)$ at these grid points. The trapezoidal rule, as implemented in `numpy.trapz`, is used to approximate the numerator $N_{\\text{approx}}$ and denominator $D_{\\text{approx}}$, yielding $k_{P, \\text{approx}} = N_{\\text{approx}} / D_{\\text{approx}}$. The relative error $\\varepsilon_{k_P} = |(k_{P, \\text{approx}} - k_{P, \\text{ref}}) / k_{P, \\text{ref}}|$ is then computed. The first value of $N$ that satisfies $\\varepsilon_{k_P} \\le \\tau$ is selected as $N_{\\min}$. If no candidate grid size meets the tolerance, $N_{\\min}$ is taken as the largest size in the set ($16384$), and the error achieved at this resolution is reported.\n\nThis procedure is systematically applied to each of the three test cases provided, and the results—$\\varepsilon_I$, the final $\\varepsilon_{k_P}$ corresponding to the chosen $N_{\\min}$, and $N_{\\min}$ itself—are collected for the final output. The implementation will use `numpy` for numerical arrays and operations, and `scipy.integrate` for the high-accuracy reference calculation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the three test cases.\n    It encapsulates all logic as required.\n    \"\"\"\n\n    # Physical constants\n    H = 6.62607015e-34  # Planck's constant in J*s\n    C = 2.99792458e10   # Speed of light in cm/s\n    KB = 1.380649e-23     # Boltzmann's constant in J/K\n\n    def lorentz_profile(sigma, sigma_i, gamma_i):\n        \"\"\"Computes the Lorentz line shape L(sigma; sigma_i, gamma_i).\"\"\"\n        return (1.0 / np.pi) * (gamma_i / ((sigma - sigma_i)**2 + gamma_i**2))\n\n    def absorption_coefficient(sigma, lines):\n        \"\"\"Computes the spectral absorption coefficient k(sigma).\"\"\"\n        if isinstance(sigma, (int, float)):\n            k_val = 0.0\n        else:\n            k_val = np.zeros_like(sigma, dtype=float)\n        \n        for sigma_i, S_i, gamma_i in lines:\n            k_val += S_i * lorentz_profile(sigma, sigma_i, gamma_i)\n        return k_val\n\n    def planck_function(sigma, T):\n        \"\"\"Computes the Planck function B_sigma(T).\"\"\"\n        c2 = H * C / KB  # Second radiation constant in cm*K\n        exponent = c2 * sigma / T\n        # Handle potential overflow in exp, though unlikely with given inputs\n        # np.exp handles large values, returning inf.\n        denominator = np.exp(exponent) - 1.0\n        # Prevent division by zero if denominator is zero (at sigma=0, or T=inf)\n        denominator[denominator == 0] = np.inf\n        numerator = 2.0 * H * C**2 * sigma**3\n        return numerator / denominator\n\n    def analytic_I_ref(sigma_a, sigma_b, lines):\n        \"\"\"Computes the analytical band-integrated absorption I_ref.\"\"\"\n        total_I = 0.0\n        for sigma_i, S_i, gamma_i in lines:\n            term_b = np.arctan((sigma_b - sigma_i) / gamma_i)\n            term_a = np.arctan((sigma_a - sigma_i) / gamma_i)\n            total_I += (S_i / np.pi) * (term_b - term_a)\n        return total_I\n\n    def solve_case(case_params):\n        \"\"\"Processes a single test case and returns the required results.\"\"\"\n        sigma_a, sigma_b = case_params[\"band\"]\n        T = case_params[\"T\"]\n        lines = case_params[\"lines\"]\n        N_coarse = case_params[\"N_coarse\"]\n        tau = case_params[\"tau\"]\n        N_candidates = [64, 128, 256, 512, 1024, 2048, 4096, 8192, 16384]\n\n        # --- Part 1: Calculate relative error in I at N_coarse ---\n        I_ref = analytic_I_ref(sigma_a, sigma_b, lines)\n        \n        sigma_coarse_grid = np.linspace(sigma_a, sigma_b, N_coarse)\n        k_coarse_vals = absorption_coefficient(sigma_coarse_grid, lines)\n        I_approx_coarse = np.trapz(k_coarse_vals, x=sigma_coarse_grid)\n        \n        eps_I = np.abs((I_approx_coarse - I_ref) / I_ref) if I_ref != 0 else 0.0\n\n        # --- Part 2: Find N_min and corresponding error for k_P ---\n        # Define integrands for high-accuracy reference calculation\n        line_centers = [line[0] for line in lines]\n        \n        def k_B_integrand(s):\n            return absorption_coefficient(s, lines) * planck_function(np.array([s]), T)[0]\n\n        def B_integrand(s):\n            return planck_function(np.array([s]), T)[0]\n\n        # High-accuracy reference k_P using scipy.integrate.quad\n        k_B_integral_ref, _ = integrate.quad(k_B_integrand, sigma_a, sigma_b, points=line_centers)\n        B_integral_ref, _ = integrate.quad(B_integrand, sigma_a, sigma_b)\n        \n        k_P_ref = k_B_integral_ref / B_integral_ref if B_integral_ref != 0 else 0.0\n\n        # Find N_min by iterating through candidate grid sizes\n        N_min = -1\n        eps_kP_at_Nmin = -1.0\n\n        for N in N_candidates:\n            sigma_grid = np.linspace(sigma_a, sigma_b, N)\n            k_vals = absorption_coefficient(sigma_grid, lines)\n            B_vals = planck_function(sigma_grid, T)\n            \n            k_B_integral_approx = np.trapz(k_vals * B_vals, x=sigma_grid)\n            B_integral_approx = np.trapz(B_vals, x=sigma_grid)\n            \n            k_P_approx = k_B_integral_approx / B_integral_approx if B_integral_approx != 0 else 0.0\n            \n            current_eps_kP = np.abs((k_P_approx - k_P_ref) / k_P_ref) if k_P_ref != 0 else 0.0\n            eps_kP_at_Nmin = current_eps_kP\n            \n            if current_eps_kP = tau:\n                N_min = N\n                break\n        \n        if N_min == -1: # Tolerance not met by any candidate\n            N_min = N_candidates[-1]\n        \n        return eps_I, eps_kP_at_Nmin, N_min\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"band\": [2200.0, 2400.0], \"T\": 1800.0,\n            \"lines\": [ (2280.0, 1.0, 0.25), (2350.0, 0.6, 0.15), (2390.0, 0.8, 0.40) ],\n            \"N_coarse\": 400, \"tau\": 0.01\n        },\n        {\n            \"band\": [2199.5, 2200.5], \"T\": 1200.0,\n            \"lines\": [ (2200.0, 1.5, 0.01), (2199.7, 0.7, 0.008) ],\n            \"N_coarse\": 50, \"tau\": 0.01\n        },\n        {\n            \"band\": [3500.0, 3600.0], \"T\": 800.0,\n            \"lines\": [ (3525.0, 0.2, 0.05), (3555.0, 1.8, 0.20), (3599.0, 0.5, 0.03), (3570.0, 0.1, 0.005) ],\n            \"N_coarse\": 300, \"tau\": 0.01\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        results_for_case = solve_case(case)\n        all_results.extend(results_for_case)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n\n```"
        }
    ]
}