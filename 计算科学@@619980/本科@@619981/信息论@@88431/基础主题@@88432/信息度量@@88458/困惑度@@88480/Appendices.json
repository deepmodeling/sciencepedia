{"hands_on_practices": [{"introduction": "理解困惑度最直观的方法是从均匀分布开始，其中每个结果发生的可能性都相同。这个练习将通过一个关于个人识别码（PIN）安全性的实际场景来探讨这种情况 [@problem_id:1646104]。通过计算，你会发现当所有有效 PIN 码都是等可能的时候，困惑度恰好等于有效 PIN 码的总数，这揭示了困惑度作为“有效选项数量”的核心含义。", "problem": "一位安全分析师正在研究 4 位个人识别码 (PIN) 的模式。PIN 是一个由四个数字组成的有序序列，其中每个数字是 0 到 9 之间（含两端）的整数。该分析师对一种常见的用户行为进行建模，即人们会避免紧接着重复使用同一个数字。例如，在此模型下，像 '3435' 这样的 PIN 被认为是有效的，但 '3345' 和 '3445' 则不是。\n\n假设每个满足此非连续重复规则的 4 位 PIN 被选择的概率均等，那么在所有可能的 PIN 集合上所产生的概率分布的困惑度是多少？\n\n请以单个整数形式提供答案。", "solution": "一个 4 位的 PIN 是一个有序四元组，其数字来自集合 $\\{0,1,2,\\dots,9\\}$。非连续重复规则要求，对于每个位置 $i \\in \\{2,3,4\\}$，位置 $i$ 上的数字不得与位置 $i-1$ 上的数字相同。\n\n计算有效 PIN 的数量：\n- 对于第一位数字，有 $10$ 种选择。\n- 对于之后的每一位数字，都有 $9$ 种选择（除紧邻的前一位数字外的任何数字）。\n因此，有效 PIN 的总数为\n$$\nN = 10 \\times 9^{3}.\n$$\n具体计算如下：\n$$\nN = 10 \\times 729 = 7290.\n$$\n\n一个熵为 $H$（单位为比特）的分布，其困惑度定义为 $2^{H}$。对于 $N$ 个结果上的均匀分布，\n$$\nH = \\log_{2}(N) \\quad \\Rightarrow \\quad \\text{perplexity} = 2^{H} = 2^{\\log_{2}(N)} = N.\n$$\n因此，困惑度等于有效 PIN 的数量，即 $7290$。", "answer": "$$\\boxed{7290}$$", "id": "1646104"}, {"introduction": "在现实世界中，不同的结果往往具有不同的概率。这个练习将我们带入自然语言处理领域，在这里，困惑度是评估预测模型不确定性的一个关键指标 [@problem_id:1646124]。你将为一个简化的字符预测模型计算困惑度，从而练习如何处理非均匀概率分布，并理解为什么一个较低的困惑度意味着一个更自信、更准确的模型。", "problem": "一位计算机科学家正在分析一个简化的字符级预测模型。该模型的目的是根据训练语料库的统计数据来预测序列中的下一个字符。在观察特定字符序列后，该模型查询其训练数据，并发现先前在此上下文中出现的字符具有以下频率：\n- 字符 'a' 出现了 125 次。\n- 字符 'e' 出现了 125 次。\n- 字符 'i' 出现了 60 次。\n- 字符 'o' 出现了 60 次。\n- 字符 'u' 出现了 30 次。\n\n该模型将下一个字符为特定字符的概率定义为与其观察到的频率成正比。任何未在上述列表中的字符出现的概率为零。基于此概率分布，计算该模型预测的困惑度。\n\n在任何对数计算中使用自然对数。将最终答案表示为保留三位有效数字的数值。", "solution": "该模型根据观察到的频率按比例分配概率。设计数为 $f_{a}=125$, $f_{e}=125$, $f_{i}=60$, $f_{o}=60$, $f_{u}=30$。总计数为\n$$\nF=\\sum f=125+125+60+60+30=400.\n$$\n因此概率为\n$$\np(a)=\\frac{125}{400}=\\frac{5}{16},\\quad p(e)=\\frac{5}{16},\\quad p(i)=\\frac{60}{400}=\\frac{3}{20},\\quad p(o)=\\frac{3}{20},\\quad p(u)=\\frac{30}{400}=\\frac{3}{40}.\n$$\n使用自然对数的单步预测分布的困惑度定义为\n$$\n\\mathrm{PPL}=\\exp\\!\\left(H\\right),\\quad H=-\\sum_{x}p(x)\\ln p(x).\n$$\n计算熵：\n$$\nH=-\\Bigg[2\\cdot\\frac{5}{16}\\ln\\!\\left(\\frac{5}{16}\\right)+2\\cdot\\frac{3}{20}\\ln\\!\\left(\\frac{3}{20}\\right)+\\frac{3}{40}\\ln\\!\\left(\\frac{3}{40}\\right)\\Bigg].\n$$\n数值计算对数和乘积（使用 $\\ln$）：\n$$\nH\\approx -\\Big[2\\cdot 0.3125\\cdot(-1.1631508098)+2\\cdot 0.15\\cdot(-1.8971199849)+0.075\\cdot(-2.5902671654)\\Big]\\approx 1.4903752890.\n$$\n因此困惑度为\n$$\n\\mathrm{PPL}=\\exp(H)\\approx \\exp(1.4903752890)\\approx 4.4387610695.\n$$\n保留三位有效数字，困惑度为 $4.44$。", "answer": "$$\\boxed{4.44}$$", "id": "1646124"}, {"introduction": "这个最终练习将困惑度的计算与基础概率论紧密结合起来。在计算困惑度之前，你首先需要为一个随机变量（两个骰子点数之和）推导出其完整的概率分布 [@problem_id:1646154]。这个两步过程不仅能巩固你对困惑度公式的运用，还能加深你对“困惑度是概率分布的一个内在属性”这一核心思想的理解。", "problem": "考虑两个独立且均匀的四面骰子，每个骰子的面上标有整数 1、2、3 和 4。定义一个离散随机变量 $S$ 为掷一次这两个骰子后，顶面上显示的数字之和。\n\n计算随机变量 $S$ 的困惑度。\n\n将您的最终答案表示为精确的、封闭形式的解析表达式。", "solution": "一个概率质量函数为 $p(s)$ 的离散随机变量的困惑度定义为 $\\exp(H)$，其中以奈特（nats）为单位的香农熵为\n$$\nH=-\\sum_{s} p(s)\\ln p(s).\n$$\n对于两个面为 $\\{1,2,3,4\\}$ 的独立均匀四面骰子，共有 $16$ 种等可能的结果。和 $S$ 的取值为 $2,3,4,5,6,7,8$，其概率分别为\n$$\np(2)=\\frac{1}{16},\\quad p(3)=\\frac{2}{16},\\quad p(4)=\\frac{3}{16},\\quad p(5)=\\frac{4}{16},\\quad p(6)=\\frac{3}{16},\\quad p(7)=\\frac{2}{16},\\quad p(8)=\\frac{1}{16}.\n$$\n因此\n$$\nH=-\\sum_{s=2}^{8} p(s)\\ln p(s)\n= -\\left[2\\cdot\\frac{1}{16}\\ln\\!\\left(\\frac{1}{16}\\right)+2\\cdot\\frac{2}{16}\\ln\\!\\left(\\frac{2}{16}\\right)+2\\cdot\\frac{3}{16}\\ln\\!\\left(\\frac{3}{16}\\right)+\\frac{4}{16}\\ln\\!\\left(\\frac{4}{16}\\right)\\right].\n$$\n使用 $\\ln\\!\\left(\\frac{k}{16}\\right)=\\ln k-\\ln 16$ 以及重复数 $m_{1}=2$，$m_{2}=2$，$m_{3}=2$，$m_{4}=1$，我们得到\n$$\nH=-\\frac{1}{16}\\sum_{k\\in\\{1,2,3,4\\}} m_{k}k\\ln k+\\left(\\sum_{k} m_{k}\\frac{k}{16}\\right)\\ln 16.\n$$\n由于 $\\sum_{k} m_{k}\\frac{k}{16}=1$ 且 $\\sum_{k} m_{k}k\\ln k=2\\cdot 1\\ln 1+2\\cdot 2\\ln 2+2\\cdot 3\\ln 3+1\\cdot 4\\ln 4=12\\ln 2+6\\ln 3$，可得\n$$\nH=\\ln 16-\\frac{1}{16}\\left(12\\ln 2+6\\ln 3\\right)\n=4\\ln 2-\\frac{12}{16}\\ln 2-\\frac{6}{16}\\ln 3\n=\\frac{13}{4}\\ln 2-\\frac{3}{8}\\ln 3.\n$$\n因此，困惑度为\n$$\n\\exp(H)=\\exp\\!\\left(\\frac{13}{4}\\ln 2-\\frac{3}{8}\\ln 3\\right)=2^{13/4}\\,3^{-3/8}=\\left(\\frac{2^{26}}{27}\\right)^{1/8}.\n$$", "answer": "$$\\boxed{\\left(\\frac{2^{26}}{27}\\right)^{1/8}}$$", "id": "1646154"}]}