{"hands_on_practices": [{"introduction": "要理解从 3SAT 到哈密顿路径的归约，关键在于掌握其核心构件——“变量构件” (variable gadget) 的工作原理。这个练习将带你亲手追踪一个给定的布尔赋值如何在图中具体表现为一条路径。通过在一个简化的模型中实践这一基本操作，你将直观地理解如何用图的遍历来编码逻辑上的“真”与“假”。", "problem": "在计算复杂性理论中，证明一个问题是 NP 完全的关键技术是提供一个从已知 NP 完全问题到该问题的多项式时间归约。一个经典的例子是从 3-可满足性问题 (3SAT) 到有向哈密顿路径问题 (HAM-PATH) 的归约。\n\n考虑此归约的标准构造。对于一个给定的具有 $n$ 个变量 ($x_1, \\dots, x_n$) 和 $m$ 个子句 ($C_1, \\dots, C_m$) 的 3SAT 公式 $\\phi$，我们构造一个有向图 $G$。该构造为每个变量包含一个“部件”(gadget)。我们来定义这些部件的结构和遍历规则。\n\n**变量部件构造：**\n- 对于每个变量 $x_i$ (其中 $1 \\le i \\le n$)，对应的部件包括一个入口节点 $a_i$、一个出口节点 $b_i$ 以及一个由 $m+1$ 个内部节点 $v_{i,0}, v_{i,1}, \\dots, v_{i,m}$ 组成的链。\n- 入口节点 $a_i$ 有指向内部链两端的有向边：$(a_i, v_{i,0})$ 和 $(a_i, v_{i,m})$。\n- 内部链的两端有指向出口节点 $b_i$ 的有向边：$(v_{i,0}, b_i)$ 和 $(v_{i,m}, b_i)$。\n- 内部链本身由所有 $j$ 从 $0$ 到 $m-1$ 的有向边 $(v_{i,j}, v_{i,j+1})$ 组成。\n\n**真值指派的路径语义：**\n对应于一个真值指派的哈密顿路径必须按从 $i=1$ 到 $n$ 的顺序遍历变量部件。从部件 $i$到部件 $i+1$ 的路径由一条从 $b_i$ 到 $a_{i+1}$ 的有向边构成。在每个变量 $x_i$ 的部件内部，路径必须从 $a_i$ 开始，恰好访问所有内部节点 $v_{i,0}, \\dots, v_{i,m}$ 一次，并以 $b_i$ 结束。内部节点的访问顺序决定了 $x_i$ 的真值指派：\n- **若 $x_i = \\text{true}$：** 路径以“正向”顺序遍历内部链：$a_i \\to v_{i,0} \\to v_{i,1} \\to \\dots \\to v_{i,m} \\to b_i$。\n- **若 $x_i = \\text{false}$：** 路径按索引递减的“反向”顺序遍历内部链：$a_i \\to v_{i,m} \\to \\dots \\to v_{i,1} \\to v_{i,0} \\to b_i$。为使此路径有效，我们假定存在相应的反向边 $(v_{i,j+1}, v_{i,j})$。\n\n**问题：**\n考虑一个有 $n=2$ 个变量 ($x_1, x_2$) 和 $m=2$ 个子句的 3SAT 公式。根据上述构造，确定与真值指派 $x_1 = \\text{true}$ 和 $x_2 = \\text{false}$ 相对应的哈密顿路径部分所访问的节点序列。该路径应始于第一个部件的入口节点 $a_1$，并终于第二个部件的出口节点 $b_2$。\n\n以下哪个序列代表了正确的路径？\n\nA. $a_1, v_{1,0}, v_{1,1}, v_{1,2}, b_1, a_2, v_{2,2}, v_{2,1}, v_{2,0}, b_2$\n\nB. $a_1, v_{1,0}, v_{1,1}, v_{1,2}, b_1, a_2, v_{2,0}, v_{2,1}, v_{2,2}, b_2$\n\nC. $a_1, v_{1,2}, v_{1,1}, v_{1,0}, b_1, a_2, v_{2,2}, v_{2,1}, v_{2,0}, b_2$\n\nD. $a_1, v_{1,0}, v_{1,1}, v_{1,2}, b_1, v_{2,2}, v_{2,1}, v_{2,0}, b_2$\n\nE. $a_1, v_{1,0}, v_{1,1}, b_1, a_2, v_{2,2}, v_{2,1}, b_2$", "solution": "目标是在给定特定真值指派的情况下，确定一条穿过变量 $x_1$ 和 $x_2$ 的部件的有向路径中的节点序列。该构造基于一个有 $n=2$ 个变量和 $m=2$ 个子句的 3SAT 公式。\n\n问题指明了以下内容：\n- 真值指派：$x_1 = \\text{true}$，$x_2 = \\text{false}$。\n- 变量数量，$n=2$。\n- 子句数量，$m=2$。\n\n我们需要追踪穿过两个串联的部件（一个用于 $x_1$，一个用于 $x_2$）的路径。\n\n步骤1：确定穿过 $x_1$ 部件的路径。\n第一个变量的指派是 $x_1 = \\text{true}$。根据问题描述，'true' 指派对应于对内部节点的“正向”遍历。$x_1$ 的部件有内部节点 $v_{1,0}, v_{1,1}, \\dots, v_{1,m}$。由于 $m=2$，这些节点是 $v_{1,0}, v_{1,1}, v_{1,2}$。\n对应于 $x_1 = \\text{true}$ 的路径从入口节点 $a_1$ 开始，按索引递增的顺序遍历内部节点，并在出口节点 $b_1$ 结束。此子路径的序列为：$a_1 \\to v_{1,0} \\to v_{1,1} \\to v_{1,2} \\to b_1$。\n\n步骤2：确定穿过 $x_2$ 部件的路径。\n第二个变量的指派是 $x_2 = \\text{false}$。根据问题描述，'false' 指派对应于对内部节点的“反向”遍历。$x_2$ 的部件有内部节点 $v_{2,0}, v_{2,1}, \\dots, v_{2,m}$。由于 $m=2$，这些节点是 $v_{2,0}, v_{2,1}, v_{2,2}$。\n对应于 $x_2 = \\text{false}$ 的路径从入口节点 $a_2$ 开始，按索引递减的顺序遍历内部节点，并在出口节点 $b_2$ 结束。此子路径的序列为：$a_2 \\to v_{2,2} \\to v_{2,1} \\to v_{2,0} \\to b_2$。\n\n步骤3：组合子路径。\n问题指出，变量部件是串联的，从一个部件的出口节点到下一个部件的入口节点有一条有向边。因此，存在一条从 $b_1$ 到 $a_2$ 的有向边。为了形成从 $a_1$ 到 $b_2$ 的完整路径，我们将 $x_1$ 的路径、连接边以及 $x_2$ 的路径连接起来。\n\n$x_1$ 的路径：$(a_1, v_{1,0}, v_{1,1}, v_{1,2}, b_1)$\n连接：路径从 $b_1$ 继续到 $a_2$。\n$x_2$ 的路径：$(a_2, v_{2,2}, v_{2,1}, v_{2,0}, b_2)$\n\n将它们组合起来，得到完整的被访问节点序列：\n$a_1, v_{1,0}, v_{1,1}, v_{1,2}, b_1, a_2, v_{2,2}, v_{2,1}, v_{2,0}, b_2$。\n\n步骤4：将结果与给定选项进行比较。\n- A: $a_1, v_{1,0}, v_{1,1}, v_{1,2}, b_1, a_2, v_{2,2}, v_{2,1}, v_{2,0}, b_2$\n- B: $a_1, v_{1,0}, v_{1,1}, v_{1,2}, b_1, a_2, v_{2,0}, v_{2,1}, v_{2,2}, b_2$ (不正确，这表示 $x_2=\\text{true}$)\n- C: $a_1, v_{1,2}, v_{1,1}, v_{1,0}, b_1, a_2, v_{2,2}, v_{2,1}, v_{2,0}, b_2$ (不正确，这表示 $x_1=\\text{false}$)\n- D: $a_1, v_{1,0}, v_{1,1}, v_{1,2}, b_1, v_{2,2}, v_{2,1}, v_{2,0}, b_2$ (不正确，缺少第二个部件的入口节点 $a_2$)\n- E: $a_1, v_{1,0}, v_{1,1}, b_1, a_2, v_{2,2}, v_{2,1}, b_2$ (不正确，缺少内部节点 $v_{1,2}$ 和 $v_{2,0}$)\n\n推导出的序列与选项A匹配。", "answer": "$$\\boxed{A}$$", "id": "1442746"}, {"introduction": "掌握了如何编码单个赋值后，我们来探讨归约的精髓：它如何将一个逻辑上不可满足的公式转化为一个结构上不存在哈密顿路径的图。本练习将采用一种更标准的“菱形构件” (diamond gadget) 构造，并以一个简单的不可满足公式为例。你将看到，公式中的逻辑矛盾（例如，一个变量需要同时为真又为假）如何导致路径在图中面临一个无法两全的选择，从而证明哈密顿路径不存在。", "problem": "在计算复杂性理论中，多项式时间归约的概念是问题分类的基础。一个常见的例子是从 3-可满足性 (3SAT) 问题到有向哈密顿路径 (HAM-PATH) 问题的归约。本题要求你分析对一个特定的、简单的 3SAT 实例进行此归约后的结果。\n\n首先，我们来定义问题和归约过程。\n- **3-可满足性 (3SAT)**：给定一个 3-合取范式 (3-CNF) 的布尔公式，该公式是子句的合取 (AND)，其中每个子句是恰好三个文字（一个变量或其否定形式）的析取 (OR)，是否存在对变量的一组真值赋值，使得整个公式为真？\n- **有向哈密顿路径 (HAM-PATH)**：给定一个有向图 $G=(V, E)$ 和两个指定的顶点 $s, t \\in V$，是否存在一条从 $s$到 $t$ 的有向路径，该路径恰好访问 $V$ 中的每个顶点一次？\n\n从 3SAT 公式 $\\phi$ 到有向图 $G$ 的归约过程如下：\n设 $\\phi$ 有 $n$ 个变量 $x_1, \\dots, x_n$ 和 $m$ 个子句 $c_1, \\dots, c_m$。\n\n1.  **全局结构**：创建一个特殊的起始顶点 $s$ 和一个特殊的结束顶点 $t$。\n2.  **变量构件**：对每个变量 $x_i$（从 $i=1$ 到 $n$），创建一个菱形构件。该构件有一个入口顶点 $v_{i, \\text{in}}$ 和一个出口顶点 $v_{i, \\text{out}}$。在这两个顶点之间，创建两条平行的有向节点路径：\n    - “真”路径，表示 $x_i = \\text{true}$，由 $2m$ 个中间顶点 $p_{i,1}^T, \\dots, p_{i,2m}^T$ 组成。添加边以形成路径：$(v_{i, \\text{in}}, p_{i,1}^T)$，然后是 $(p_{i,j}^T, p_{i,j+1}^T)$（对于 $j=1, \\dots, 2m-1$），最后是 $(p_{i,2m}^T, v_{i, \\text{out}})$。\n    - “假”路径，表示 $x_i = \\text{false}$，与之类似，有 $2m$ 个顶点 $p_{i,1}^F, \\dots, p_{i,2m}^F$ 和相应的边。\n3.  **子句构件**：对每个子句 $c_j$（从 $j=1$ 到 $m$），创建一个单一顶点 $C_j$。\n4.  **连接构件**：\n    - 串联变量构件：添加一条从 $s$ 到 $v_{1, \\text{in}}$ 的边。对于 $i=1, \\dots, n-1$，添加一条边 $(v_{i, \\text{out}}, v_{i+1, \\text{in}})$。最后，添加一条边 $(v_{n, \\text{out}}, t)$。\n    - 对于每个子句 $c_j$，将其连接到变量构件。如果文字 $x_i$ 出现在子句 $c_j$ 中，则添加有向边 $(p_{i,2j-1}^T, C_j)$ 和 $(C_j, p_{i,2j}^T)$。如果文字 $\\neg x_i$ 出现在子句 $c_j$ 中，则添加有向边 $(p_{i,2j-1}^F, C_j)$ 和 $(C_j, p_{i,2j}^F)$。注意，即使一个文字在子句中多次出现，相应的一对边也只添加一次。\n\n现在，考虑以下 3SAT 公式 $\\phi$：\n$$ \\phi = (x_1 \\lor x_1 \\lor x_1) \\land (\\neg x_1 \\lor \\neg x_1 \\lor \\neg x_1) $$\n设第一个子句为 $c_1 = (x_1 \\lor x_1 \\lor x_1)$，第二个子句为 $c_2 = (\\neg x_1 \\lor \\neg x_1 \\lor \\neg x_1)$。\n\n将上述归约应用于此公式 $\\phi$ 以构建有向图 $G$。关于生成的图 $G$，以下哪个陈述是正确的？\n\nA. 生成的图 G 包含一条从 s 到 t 的哈密顿路径。\n\nB. 生成的图 G 不包含从 s 到 t 的哈密顿路径，因为任何包含子句 c1 顶点的路径都无法同时包含子句 c2 的顶点。\n\nC. 对于此公式，该构造失败，并生成一个其中某些顶点与 s 和 t 之间的路径完全断开的图。\n\nD. 由于存在重复的文字，所提供的公式不是一个有效的 3-CNF 公式，因此无法应用该构造。\n\nE. 生成的图 G 包含一条从 s 到 t 的哈密顿路径，但该路径不对应于变量 x1 的一个有效真值赋值。", "solution": "问题要求我们使用一个标准归约，分析由一个特定的 3SAT 公式 $\\phi$ 构造出的有向图 $G$，并确定它是否含有哈密顿路径。\n\n给定的 3SAT 公式是 $\\phi = (x_1 \\lor x_1 \\lor x_1) \\land (\\neg x_1 \\lor \\neg x_1 \\lor \\neg x_1)$。\n这个公式有 $n=1$ 个变量 $x_1$ 和 $m=2$ 个子句，$c_1 = (x_1 \\lor x_1 \\lor x_1)$ 和 $c_2 = (\\neg x_1 \\lor \\neg x_1 \\lor \\neg x_1)$。\n\n我们根据提供的规则来构造图 $G$。\n\n1.  **顶点**：\n    - 全局顶点：$s, t$。\n    - 子句顶点：$C_1, C_2$。\n    - 变量 $x_1$ 的构件（因为 $n=1, m=2$）：\n        - 入口/出口点：$v_{1, \\text{in}}, v_{1, \\text{out}}$。\n        - “真”路径顶点（$2m = 4$ 个）：$p_{1,1}^T, p_{1,2}^T, p_{1,3}^T, p_{1,4}^T$。\n        - “假”路径顶点（$2m = 4$ 个）：$p_{1,1}^F, p_{1,2}^F, p_{1,3}^F, p_{1,4}^F$。\n    图中顶点总数为 $2 (\\text{全局}) + 2 (\\text{子句}) + 2 (\\text{入口/出口}) + 4 (\\text{真路径}) + 4 (\\text{假路径}) = 14$ 个顶点。一条哈密顿路径必须恰好访问这 14 个顶点中的每一个一次。\n\n2.  **边**：\n    - **主干边**：由于 $n=1$，变量构件直接连接到 $s$ 和 $t$。边为 $(s, v_{1, \\text{in}})$ 和 $(v_{1, \\text{out}}, t)$。\n    - **变量 $x_1$ 的构件边**：\n        - 真路径：$(v_{1, \\text{in}}, p_{1,1}^T)$, $(p_{1,1}^T, p_{1,2}^T)$, $(p_{1,2}^T, p_{1,3}^T)$, $(p_{1,3}^T, p_{1,4}^T)$, $(p_{1,4}^T, v_{1, \\text{out}})$。\n        - 假路径：$(v_{1, \\text{in}}, p_{1,1}^F)$, $(p_{1,1}^F, p_{1,2}^F)$, $(p_{1,2}^F, p_{1,3}^F)$, $(p_{1,3}^F, p_{1,4}^F)$, $(p_{1,4}^F, v_{1, \\text{out}})$。\n    - **子句连接边**：\n        - 子句 $c_1 = (x_1 \\lor x_1 \\lor x_1)$。该子句包含文字 $x_1$。此子句的索引为 $j=1$。根据规则，我们在变量 $x_1$ 的“真”路径上位置为 $2j-1=1$ 和 $2j=2$ 的地方添加连接边。这些边是 $(p_{1,1}^T, C_1)$ 和 $(C_1, p_{1,2}^T)$。\n        - 子句 $c_2 = (\\neg x_1 \\lor \\neg x_1 \\lor \\neg x_1)$。该子句包含文字 $\\neg x_1$。此子句的索引为 $j=2$。我们在变量 $x_1$ 的“假”路径上位置为 $2j-1=3$ 和 $2j=4$ 的地方添加连接边。这些边是 $(p_{1,3}^F, C_2)$ 和 $(C_2, p_{1,4}^F)$。\n\n3.  **哈密顿路径分析**：\n    哈密顿路径必须从 $s$ 开始，到 $t$ 结束，并恰好访问其他每个顶点一次。\n    路径必须以边 $(s, v_{1, \\text{in}})$ 开始。在 $v_{1, \\text{in}}$ 处，路径有一个选择：要么通过 $p_{1,1}^T$ 进入“真”路径，要么通过 $p_{1,1}^F$ 进入“假”路径。单条路径不能同时遍历这两条路径，因为它们是平行的，并且没有边连接它们。这个选择对应于设置变量 $x_1$ 的真值。\n\n    **情况 1：路径选择“真”路径（模拟 $x_1=\\text{true}$）**。\n    路径必须遍历“真”路径的所有顶点：$p_{1,1}^T, p_{1,2}^T, p_{1,3}^T, p_{1,4}^T$。为了做到这一点，路径的一部分必须看起来像 $v_{1, \\text{in}} \\to \\dots \\to v_{1, \\text{out}}$。为了访问图中的所有节点，这条路径还必须以某种方式访问 $C_1, C_2$ 和所有“假”路径节点 $p_{1,j}^F$。\n    - **访问 $C_1$**：可以通过从“真”路径绕道来访问顶点 $C_1$：$... \\to p_{1,1}^T \\to C_1 \\to p_{1,2}^T \\to ...$。这是一种在保持总体“真”路径轨迹的同时访问 $C_1$ 的有效方式。\n    - **访问 $C_2$**：要访问顶点 $C_2$，路径必须使用通向它或来自它的边之一。唯一的此类边是 $(p_{1,3}^F, C_2)$ 和 $(C_2, p_{1,4}^F)$。这意味着路径必须遍历子路径 $p_{1,3}^F \\to C_2 \\to p_{1,4}^F$。这要求路径位于“假”路径上。\n    - **矛盾**：如果我们的路径选择了“真”路径，它就无法访问任何 $p_{1,j}^F$ 顶点。因此，它不能使用访问 $C_2$ 所需的边。所以，如果我们为 $x_1$ 选择“真”路径，我们可以访问 $C_1$，但不能访问 $C_2$。该路径将错过 $C_2$ 和所有 $p_{1,j}^F$ 节点，因此它不是哈密顿路径。\n\n    **情况 2：路径选择“假”路径（模拟 $x_1=\\text{false}$）**。\n    路径必须遍历“假”路径的所有顶点：$p_{1,1}^F, p_{1,2}^F, p_{1,3}^F, p_{1,4}^F$。\n    - **访问 $C_2$**：可以通过绕道 $... \\to p_{1,3}^F \\to C_2 \\to p_{1,4}^F \\to ...$ 来访问顶点 $C_2$。这是一种访问 $C_2$ 的有效方式。\n    - **访问 $C_1$**：要访问顶点 $C_1$，路径必须遍历子路径 $p_{1,1}^T \\to C_1 \\to p_{1,2}^T$。这要求路径位于“真”路径上。\n    - **矛盾**：如果我们的路径选择了“假”路径，它就无法访问任何 $p_{1,j}^T$ 顶点。因此，它不能使用访问 $C_1$ 所需的边。所以，如果我们为 $x_1$ 选择“假”路径，我们可以访问 $C_2$，但不能访问 $C_1$。该路径将错过 $C_1$ 和所有 $p_{1,j}^T$ 节点，因此它不是哈密顿路径。\n\n    **结论**：由于通过变量构件的两种路径选择都无法访问所有顶点，因此不存在从 $s$ 到 $t$ 的哈密顿路径。这反映了公式 $\\phi$ 是不可满足的（它要求 $x_1$ 同时为真和为假）。\n\n4.  **评估选项**：\n    - A. 生成的图 G 包含一条从 s 到 t 的哈密顿路径。(错误)\n    - B. 生成的图 G 不包含从 s 到 t 的哈密顿路径，因为任何包含子句 c1 顶点的路径都无法同时包含子句 c2 的顶点。(正确。如上所示，访问 $C_1$ 需要使用“真”路径，而访问 $C_2$ 需要使用“假”路径。单条路径无法同时做到这两点。)\n    - C. 对于此公式，该构造失败...生成一个其中某些顶点与 ... 完全断开的图。(错误。该图是完全连通的；例如，从任何节点都可以找到一条到 $t$ 的路径。)\n    - D. 所提供的公式不是一个有效的 3-CNF 公式... (错误。3-CNF 允许子句内有重复的文字。其定义是子句的合取，其中每个子句是三个文字的析取。)\n    - E. 生成的图 G 包含一条哈密顿路径...，但该路径不对应于一个有效真值赋值... (错误。根本不存在哈密顿路径。)\n\n因此，正确的陈述是 B。", "answer": "$$\\boxed{B}$$", "id": "1442737"}, {"introduction": "我们现在转换视角，从“构造图”转向“分析图”。如果我们已经知道一个图是 3SAT 归约的产物，我们能否反向推断出原始公式的某些特性？这个练习将让你扮演一位计算侦探的角色，利用图中顶点的总数来反推出原始 3SAT 公式中子句的数量 $m$。这不仅能检验你对归约构造规则的精确理解，还能让你体会到这种变换的代数特性。", "problem": "一位计算复杂性理论课程的学生拿到了一个有向图 $G=(V, E)$。他被告知，这个图是将一个3-可满足性（3SAT）公式 $\\phi$ 通过标准多项式时间归约到有向哈密顿路径问题后得到的结果。已知的原始布尔公式 $\\phi$ 有 $n$ 个变量和 $m$ 个子句。\n\n从公式 $\\phi$ 构造图 $G$ 的规则如下：\n\n1.  顶点集 $V$ 被划分为三个不相交的子集：用于“变量构件”的顶点集 $V_X$；用于“子句构件”的顶点集 $V_C$；以及一个包含两个特殊顶点 $\\{s, t\\}$ 的集合，其中 $s$ 是哈密顿路径的指定起始顶点，$t$ 是终止顶点。\n2.  集合 $V_X$ 是通过为 $\\phi$ 中的 $n$ 个变量中的每一个创建一个不同的子图（或称“构件”）来构造的。这 $n$ 个变量构件中的每一个在结构上都是相同的，并且包含特定数量的顶点，该数量取决于子句的数量 $m$。准确地说，每个变量构件由恰好 $2m+2$ 个顶点组成。\n3.  集合 $V_C$ 是通过为 $\\phi$ 中的 $m$ 个子句中的每一个创建一个顶点来构造的。\n4.  整个图 $G$ 的总顶点数为526。原始公式 $\\phi$ 中的变量数为 $n=10$。\n\n根据所提供的关于归约和结果图的信息，确定原始3SAT公式 $\\phi$ 中的子句数量 $m$。", "solution": "根据题意，顶点集被划分为 $V = V_{X} \\cup V_{C} \\cup \\{s,t\\}$，其中 $V_{X}$ 由 $n$ 个相同的变量构件组成，每个构件恰好有 $2m+2$ 个顶点，$V_{C}$ 恰好有 $m$ 个子句顶点。两个特殊顶点是 $s$ 和 $t$。因此，总顶点数满足\n$$\n|V| = |V_{X}| + |V_{C}| + 2 = n(2m+2) + m + 2.\n$$\n已知 $|V| = 526$ 且 $n = 10$，代入可得\n$$\n526 = 10(2m+2) + m + 2.\n$$\n展开并合并同类项得到\n$$\n526 = 20m + 20 + m + 2 = 21m + 22.\n$$\n求解 $m$ 可得\n$$\n21m = 526 - 22 = 504 \\quad \\Rightarrow \\quad m = \\frac{504}{21} = 24.\n$$\n因此，原始公式中的子句数量为 $m=24$。", "answer": "$$\\boxed{24}$$", "id": "1442708"}]}