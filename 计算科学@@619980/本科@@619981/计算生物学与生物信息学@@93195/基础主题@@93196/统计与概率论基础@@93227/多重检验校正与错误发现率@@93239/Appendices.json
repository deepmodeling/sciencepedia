{"hands_on_practices": [{"introduction": "在大规模数据分析中，我们经常会遇到一个令人困惑的情景：一个未经校正的原始 $p$ 值显示出显著性，但经过多重检验校正后的 $q$ 值（或称校正 $p$ 值）却不再显著。这个练习将带你直面这个核心问题，通过一个具体的基因表达案例，帮助你理解为什么必须进行校正，以及如何正确地根据设定的显著性阈值（例如 5% 的 FDR）得出最终结论。掌握这一技能对于避免在数千次检验中被虚假的“发现”所误导至关重要。[@problem_id:1450340]", "problem": "在一个大规模的差异基因表达研究中，一位系统生物学家使用核糖核酸测序（RNA-seq）来比较用新药处理过的癌细胞与未经处理的对照细胞中的基因活性。该分析涉及同时检验20,000个基因，以确定哪些基因的表达水平显示出统计上显著的变化。\n\n对于一个特定的基因`GENE123`，初始的统计检验得出的原始 $p$ 值为0.04。然而，为了考虑到大量的同时检验，这位生物学家采用了一种多重检验校正程序来控制错误发现率（FDR）。经过此校正后，`GENE123`的经FDR校正的 $p$ 值（也称为q值）计算得出为0.35。\n\n该研究团队将本研究的显著性阈值设定为 5% 的 FDR（即0.05）。基于这些信息，关于`GENE123`的差异表达，以下哪个结论最为恰当？\n\nA. 该基因是显著差异表达的，因为其原始p值（0.04）小于常规的显著性水平0.05。\n\nB. 该基因不是显著差异表达的，因为其经FDR校正的p值（0.35）大于所选的FDR阈值（0.05）。\n\nC. 结果不确定；原始p值表明显著，而校正后的p值则不然，因此需要新的实验来解决这一矛盾。\n\nD. 该基因是显著差异表达的，因为经FDR校正的p值为0.35表明，在所有发现中，预计只有35%是错误的。\n\nE. 该基因是一个已知的假阳性发现，因为其原始p值没有远小于0.05，导致了大幅度的校正。", "solution": "我们将该情景形式化。设 $m=20000$ 为同时检验的假设（基因）数量，设目标错误发现率为 $\\alpha=0.05$。对于该特定基因，记原始 $p$ 值为 $p$，经FDR校正的 $p$ 值（q值）为 $\\tilde{p}$。数据给出 $p=0.04$ 和 $\\tilde{p}=0.35$。\n\n在FDR控制（例如，Benjamini–Hochberg或任何等效的FDR控制程序）下的决策规则是：当且仅当 $\\tilde{p} \\leq \\alpha$ 时，在水平 $\\alpha$ 下拒绝某个给定基因的原假设（即宣布其为显著差异表达）。量 $\\tilde{p}$ 是该基因被判为显著时所需的最低FDR水平。\n\n应用 $\\alpha=0.05$ 的规则，我们将 $\\tilde{p}=0.35$ 与 $\\alpha=0.05$ 进行比较，得到 $0.35 > 0.05$，因此我们不拒绝该基因的原假设。因此，在所选的FDR水平上，该基因不是显著差异表达的。\n\n评估各个选项：\n- A是错误的，因为它忽略了多重检验；在多重性校正后，决策必须基于 $\\tilde{p}$，而不仅仅是原始的 $p$。\n- B是正确的：因为 $\\tilde{p}=0.35 > 0.05$，所以该基因不显著。\n- C是错误的，因为不存在矛盾；校正恰当地改变了多重检验下的决策阈值。\n- D反映了一种误解：$\\tilde{p}=0.35$ 意味着只有当研究者愿意将FDR控制在0.35时，该基因才会被判为显著，而这超出了所选的 $\\alpha=0.05$；因此，在该研究的阈值下，它不显著。\n- E是错误的，因为不能将该基因标记为“已知的假阳性”；正确的结论仅仅是它在指定的FDR水平上不显著。\n\n因此，正确选项是B。", "answer": "$$\\boxed{B}$$", "id": "1450340"}, {"introduction": "当我们决定校正 $p$ 值时，面临着一个关键选择：是采用严格控制“族系误差率”（FWER）的方法，还是选择更灵活地控制“错误发现率”（FDR）的方法？这个练习让你亲手操作这两种策略——Holm-Bonferroni（控制FWER）和Benjamini-Hochberg（控制FDR），并直接比较它们在同一数据集上的结果。通过计算，你将直观地感受到这两种方法在统计功效和错误控制哲学上的根本差异。[@problem_id:2408529]", "problem": "一项差异表达研究检验了 $m=10$ 个独立的基因层面原假设，这些假设是关于两种条件下平均表达量相等的。检验得到了以下双边 p 值（未排序）：$\\{0.2,\\,0.043,\\,0.013,\\,0.028,\\,0.006,\\,0.001,\\,0.019,\\,0.037,\\,0.024,\\,0.009\\}$。请在目标错误发现率 (FDR) $q=0.05$ 的水平下应用 Benjamini–Hochberg (BH) 升阶程序，并分别在族错误率 (FWER) $\\alpha=0.05$ 的水平下应用 Holm–Bonferroni 降阶程序，以决定在每种情况下拒绝哪些原假设。设 $N_{\\mathrm{BH}}$ 为 BH 程序下拒绝的原假设数量，$N_{\\mathrm{Holm}}$ 为 Holm–Bonferroni 程序下拒绝的原假设数量。计算单个数值 $N_{\\mathrm{BH}}-N_{\\mathrm{Holm}}$。无需四舍五入。", "solution": "解析并验证问题陈述。\n\n### 第 1 步：提取已知条件\n- 独立的基因层面原假设数量：$m=10$。\n- p 值集合：$\\{0.2, 0.043, 0.013, 0.028, 0.006, 0.001, 0.019, 0.037, 0.024, 0.009\\}$。\n- Benjamini–Hochberg (BH) 程序的目标错误发现率 (FDR)：$q=0.05$。\n- Holm–Bonferroni 程序的目标族错误率 (FWER)：$\\alpha=0.05$。\n- $N_{\\mathrm{BH}}$ 是 BH 程序下拒绝的数量。\n- $N_{\\mathrm{Holm}}$ 是 Holm–Bonferroni 程序下拒绝的数量。\n- 目标是计算 $N_{\\mathrm{BH}}-N_{\\mathrm{Holm}}$ 的值。\n\n### 第 2 步：使用提取的已知条件进行验证\n评估问题的有效性。\n- **科学依据：** 该问题基于已建立的标准统计方法进行多重假设检验校正（Benjamini–Hochberg 和 Holm–Bonferroni 程序），这些方法是计算生物学和生物信息学等领域的基础。该问题在科学上是合理的。\n- **适定性：** 问题定义清晰，包含所有必要的数据和参数。这些程序是算法性的，能够得出一个唯一、稳定且有意义的解。\n- **客观性：** 问题陈述语言精确、量化且无歧义。\n\n### 第 3 步：结论与行动\n问题有效。将提供完整解答。\n\n应用这两种多重检验校正程序的第一步，是按升序排列这 $m=10$ 个 p 值。设 $p_{(i)}$ 为第 $i$ 小的 p 值。\n给定的 p 值集合为 $\\{0.2, 0.043, 0.013, 0.028, 0.006, 0.001, 0.019, 0.037, 0.024, 0.009\\}$。\n排序后的 p 值为：\n$p_{(1)} = 0.001$\n$p_{(2)} = 0.006$\n$p_{(3)} = 0.009$\n$p_{(4)} = 0.013$\n$p_{(5)} = 0.019$\n$p_{(6)} = 0.024$\n$p_{(7)} = 0.028$\n$p_{(8)} = 0.037$\n$p_{(9)} = 0.043$\n$p_{(10)} = 0.2$\n\n首先，我们应用 Benjamini–Hochberg (BH) 升阶程序，将 FDR 控制在 $q=0.05$ 的水平。\n该程序旨在找到满足 $p_{(k)} \\le \\frac{k}{m}q$ 的最大整数 $k \\in \\{1, 2, \\dots, m\\}$。\n如果存在这样的 $k$，我们便拒绝与 p 值 $p_{(1)}, p_{(2)}, \\dots, p_{(k)}$ 对应的原假设。否则，不拒绝任何假设。\n在此，$m=10$ 且 $q=0.05$。我们需要找到满足 $p_{(k)} \\le \\frac{k}{10}(0.05) = k \\times 0.005$ 的最大 $k$。\n我们对每个 $i=1, \\dots, 10$ 检查此条件：\n- 对于 $i=1$：$p_{(1)} = 0.001$。与 $\\frac{1}{10}(0.05) = 0.005$ 比较。由于 $0.001 \\le 0.005$，条件成立。\n- 对于 $i=2$：$p_{(2)} = 0.006$。与 $\\frac{2}{10}(0.05) = 0.01$ 比较。由于 $0.006 \\le 0.01$，条件成立。\n- 对于 $i=3$：$p_{(3)} = 0.009$。与 $\\frac{3}{10}(0.05) = 0.015$ 比较。由于 $0.009 \\le 0.015$，条件成立。\n- 对于 $i=4$：$p_{(4)} = 0.013$。与 $\\frac{4}{10}(0.05) = 0.02$ 比较。由于 $0.013 \\le 0.02$，条件成立。\n- 对于 $i=5$：$p_{(5)} = 0.019$。与 $\\frac{5}{10}(0.05) = 0.025$ 比较。由于 $0.019 \\le 0.025$，条件成立。\n- 对于 $i=6$：$p_{(6)} = 0.024$。与 $\\frac{6}{10}(0.05) = 0.03$ 比较。由于 $0.024 \\le 0.03$，条件成立。\n- 对于 $i=7$：$p_{(7)} = 0.028$。与 $\\frac{7}{10}(0.05) = 0.035$ 比较。由于 $0.028 \\le 0.035$，条件成立。\n- 对于 $i=8$：$p_{(8)} = 0.037$。与 $\\frac{8}{10}(0.05) = 0.04$ 比较。由于 $0.037 \\le 0.04$，条件成立。\n- 对于 $i=9$：$p_{(9)} = 0.043$。与 $\\frac{9}{10}(0.05) = 0.045$ 比较。由于 $0.043 \\le 0.045$，条件成立。\n- 对于 $i=10$：$p_{(10)} = 0.2$。与 $\\frac{10}{10}(0.05) = 0.05$ 比较。由于 $0.2 \\not\\le 0.05$，条件不成立。\n满足条件 $p_{(k)} \\le \\frac{k}{m}q$ 的最大索引 $k$ 为 $k=9$。\n因此，BH 程序拒绝了与 9 个最小 p 值相对应的 9 个原假设。拒绝的数量为 $N_{\\mathrm{BH}} = 9$。\n\n接下来，我们应用 Holm–Bonferroni 降阶程序，将 FWER 控制在 $\\alpha=0.05$ 的水平。\n该程序按顺序检验排序后的 p 值。对于每个 $i=1, \\dots, m$，我们将 $p_{(i)}$ 与调整后的显著性水平 $\\frac{\\alpha}{m-i+1}$ 进行比较。当首次出现索引 $k$ 使得 $p_{(k)} > \\frac{\\alpha}{m-k+1}$ 时，程序停止。然后，我们拒绝与 $p_{(1)}, \\dots, p_{(k-1)}$ 对应的原假设，而不拒绝其余的假设。\n在此，$m=10$ 且 $\\alpha=0.05$。我们检查条件 $p_{(i)} \\le \\frac{0.05}{10-i+1}$。\n- 对于 $i=1$：$p_{(1)} = 0.001$。阈值为 $\\frac{0.05}{10-1+1} = \\frac{0.05}{10} = 0.005$。由于 $0.001 \\le 0.005$，我们拒绝第一个原假设并进入下一步。\n- 对于 $i=2$：$p_{(2)} = 0.006$。阈值为 $\\frac{0.05}{10-2+1} = \\frac{0.05}{9} \\approx 0.00556$。由于 $0.006 > \\frac{0.05}{9}$，条件不成立。程序在此停止。\n我们拒绝 $i  2$ 的原假设，这意味着只有与 $p_{(1)}$ 对应的假设被拒绝。所有其他假设（对于 $i=2, \\dots, 10$）均不被拒绝。\n因此，在 Holm–Bonferroni 程序下拒绝的数量为 $N_{\\mathrm{Holm}} = 1$。\n\n最后，我们计算所需的值，即两种程序拒绝数量的差值：\n$N_{\\mathrm{BH}} - N_{\\mathrm{Holm}} = 9 - 1 = 8$。\n这表明，与控制更严格的 FWER 的 Holm–Bonferroni 程序相比，控制较不严格的 FDR 的 Benjamini–Hochberg 程序通常具有更高的统计功效。", "answer": "$$\\boxed{8}$$", "id": "2408529"}, {"introduction": "在现代生物信息学中，Benjamini-Hochberg（BH）方法是控制错误发现率（FDR）最广泛使用的“主力军”。这个练习将让你深入实践BH程序的具体步骤，从一组给定的$p$值中确定出用于判断显著性的最终阈值。通过这个计算，你将巩固对BH程序工作机制的理解，这是解读和执行大规模组学研究结果的一项核心技能。[@problem_id:2860696]", "problem": "在一个数据依赖性采集的免疫肽组学实验中，将肽谱匹配（peptide-spectrum matches）聚合到肽段层面，以检验每个候选肽段是否由细胞表面的主要组织相容性复合体（MHC）呈递。对于 $m$ 个关于非呈递的肽段层面零假设中的每一个，都从一个经过校准的目标-诱饵竞争校准分数中获得一个 $p$ 值。假设在任何为真的零假设下，其 $p$ 值都随机劣于 $[0,1]$ 上的均匀分布，并且不同假设间的 $p$ 值是独立的或满足子集正回归依赖（PRDS）条件，这在基于诱饵的校准后通常被近似接受。\n\n从错误发现率（FDR）的定义 $\\operatorname{FDR}=\\mathbb{E}\\!\\left[\\frac{V}{\\max(R,1)}\\right]$（其中 $V$ 是错误拒绝的数量，$R$ 是总拒绝数量）出发，推导一个升阶式多重检验法则，该法则保证在任何有 $m_{0}$ 个为真零假设的配置下都有 $\\operatorname{FDR}\\leq \\alpha$，并且在所述的依赖条件下，其 FDR 有界于 $\\operatorname{FDR}\\leq \\frac{m_{0}}{m}\\alpha$。然后，将你推导的法则应用于以下 $m=10$ 个肽段层面的 $p$ 值（已按升序排列），以在 $\\alpha=0.01$ 的水平上控制 FDR：\n$\\{0.0005,\\,0.001,\\,0.002,\\,0.004,\\,0.006,\\,0.008,\\,0.012,\\,0.02,\\,0.03,\\,0.05\\}$。\n请报告单一的 Benjamini–Hochberg 拒绝阈值 $p^{\\star}$（即，在你的法则下被拒绝的假设中的最大 $p$ 值），结果应为一个无单位的纯数。无需四舍五入。", "solution": "我们从错误发现率（FDR）的定义开始。对于 $m$ 个假设，其中有 $m_{0}$ 个为真的零假设，令 $R$ 表示被拒绝的假设总数，$V$ 表示被拒绝的为真的零假设数量。错误发现率是 $\\operatorname{FDR}=\\mathbb{E}\\!\\left[\\frac{V}{\\max(R,1)}\\right]$。我们假设对于每个为真的零假设，其对应的 $p$ 值（记作 $p_{j}$）满足对所有 $t\\in[0,1]$ 都有 $\\mathbb{P}(p_{j}\\leq t)\\leq t$（超均匀性），并且 $p$ 值向量是独立的，或满足子集正回归依赖（PRDS）条件。\n\n我们的目标是构建一个数据依赖的拒绝法则，以确保对于选定的目标 $\\alpha\\in(0,1)$，有 $\\operatorname{FDR}\\leq \\alpha$，并满足标准的 Benjamini–Hochberg (BH) 上界 $\\operatorname{FDR}\\leq \\frac{m_{0}}{m}\\alpha$。\n\n我们考虑一个递升法则：将观察到的 $p$ 值按非降序排列，$p_{(1)}\\leq p_{(2)}\\leq\\cdots\\leq p_{(m)}$。对于 $[0,1]$ 中的一个非降序临界值序列 $\\{c_{i}\\}_{i=1}^{m}$，定义递升索引\n$$\nk=\\max\\{i\\in\\{1,\\dots,m\\}: p_{(i)}\\leq c_{i}\\},\n$$\n约定如果该集合为空，则 $k=0$。然后拒绝所有 $p$ 值不大于 $p_{(k)}$ 的假设（等价地，所有 $p$ 值不大于 $c_{k}$ 的假设）。我们将选择 $c_{i}=\\frac{i}{m}\\alpha$ 并证明 Benjamini–Hochberg 保证。\n\n为 $m_{0}$ 个为真的零假设定义指示变量：对于索引为 $j$ 的为真的零假设，令 $I_{j}=\\mathbf{1}\\{p_{j}\\text{ is rejected}\\}$。在 $c_{i}=\\frac{i}{m}\\alpha$ 的递升法则下，事件 $\\{p_{j}\\text{ is rejected}\\}$ 意味着 $p_{j}\\leq c_{R}=\\frac{R}{m}\\alpha$，因为拒绝阈值关于 $R$ 是单调的，并且被拒绝的最大排序 $p$ 值满足 $p_{(R)}\\leq \\frac{R}{m}\\alpha$。因此，\n$$\n\\frac{V}{\\max(R,1)}=\\sum_{j\\in\\mathcal{H}_{0}}\\frac{I_{j}}{\\max(R,1)}=\\sum_{j\\in\\mathcal{H}_{0}}\\frac{\\mathbf{1}\\{p_{j}\\leq \\frac{R}{m}\\alpha\\}}{\\max(R,1)}.\n$$\n取期望并使用全期望定律，\n$$\n\\operatorname{FDR}=\\mathbb{E}\\!\\left[\\frac{V}{\\max(R,1)}\\right]=\\sum_{j\\in\\mathcal{H}_{0}}\\mathbb{E}\\!\\left[\\frac{\\mathbf{1}\\{p_{j}\\leq \\frac{R}{m}\\alpha\\}}{\\max(R,1)}\\right].\n$$\n在独立性或 PRDS 条件下，以除 $j$ 之外的所有假设的 $p$ 值为条件，随机变量 $R$ 相对于由其他 $p$ 值生成的 $\\sigma$-代数是可测的，并且 $p_{j}$ 仍然是超均匀的。因此，\n$$\n\\mathbb{E}\\!\\left[\\left.\\mathbf{1}\\left\\{p_{j}\\leq \\frac{R}{m}\\alpha\\right\\}\\right|\\mathcal{F}_{-j}\\right]\\leq \\frac{R}{m}\\alpha,\n$$\n其中 $\\mathcal{F}_{-j}$ 表示由除 $p_{j}$ 之外的所有 $p$ 值生成的 $\\sigma$-代数。除以 $\\max(R,1)$ 并取期望可得\n$$\n\\mathbb{E}\\!\\left[\\frac{\\mathbf{1}\\{p_{j}\\leq \\frac{R}{m}\\alpha\\}}{\\max(R,1)}\\right]\\leq \\mathbb{E}\\!\\left[\\frac{\\frac{R}{m}\\alpha}{\\max(R,1)}\\right]\\leq \\frac{\\alpha}{m},\n$$\n其中最后一个不等式使用了 $\\frac{R}{\\max(R,1)}\\leq 1$。对 $m_{0}$ 个为真的零假设求和可得\n$$\n\\operatorname{FDR}\\leq \\sum_{j\\in\\mathcal{H}_{0}}\\frac{\\alpha}{m}=\\frac{m_{0}}{m}\\alpha\\leq \\alpha.\n$$\n因此，在所述条件下，使用临界值 $c_{i}=\\frac{i}{m}\\alpha$ 的递升法则将错误发现率控制在水平 $\\alpha$。这就是 Benjamini–Hochberg 程序。\n\n现在我们将此法则应用于给定的 $m=10$ 个肽段层面的 $p$ 值（已排序）：\n$$\n\\{0.0005,\\,0.001,\\,0.002,\\,0.004,\\,0.006,\\,0.008,\\,0.012,\\,0.02,\\,0.03,\\,0.05\\},\n$$\n目标为 $\\alpha=0.01$。计算 BH 临界值序列 $c_{i}=\\frac{i}{m}\\alpha=\\frac{i}{10}\\cdot 0.01$（对于 $i=1,\\dots,10$）：\n$$\nc_{1}=0.001,\\; c_{2}=0.002,\\; c_{3}=0.003,\\; c_{4}=0.004,\\; c_{5}=0.005,\\; c_{6}=0.006,\\; c_{7}=0.007,\\; c_{8}=0.008,\\; c_{9}=0.009,\\; c_{10}=0.010.\n$$\n比较 $p_{(i)}$ 与 $c_{i}$ 以找到满足 $p_{(k)} \\leq c_{k}$ 的最大索引 $k$：\n- 对于 $i=1$：$0.0005\\leq 0.001$ 成立。\n- 对于 $i=2$：$0.001\\leq 0.002$ 成立。\n- 对于 $i=3$：$0.002\\leq 0.003$ 成立。\n- 对于 $i=4$：$0.004\\leq 0.004$ 成立。\n- 对于 $i=5$：$0.006\\leq 0.005$ 不成立。\n\n因此，最大索引为 $k=4$。BH 拒绝阈值 $p^{\\star}$ 定义为被拒绝的假设中的最大 $p$ 值（等价于 $p_{(k)}$），即\n$$\np^{\\star}=p_{(4)}=0.004.\n$$\n因此，所有 $p$ 值不大于 $0.004$ 的假设都被拒绝，所要求的单一数值阈值为 $0.004$。", "answer": "$$\\boxed{0.004}$$", "id": "2860696"}]}