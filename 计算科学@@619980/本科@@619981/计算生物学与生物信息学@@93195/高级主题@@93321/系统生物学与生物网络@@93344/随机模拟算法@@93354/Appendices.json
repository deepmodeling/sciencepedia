{"hands_on_practices": [{"introduction": "理论学习之后，最好的理解方式就是亲手实践。本练习旨在通过“纸笔推演”的方式，让你体验Gillespie算法的每一个核心步骤。你将为一个简单的生灭过程计算反应倾向性（propensity），采样等待时间，并决定下一个发生的反应，从而将抽象的算法流程具体化，为后续的编程实现打下坚实的基础。[@problem_id:2678033]", "problem": "考虑一个单物种生灭过程，用于描述一个分子布居 $X(t)$，其包含两个反应通道：\n- 生成：$X \\to X + 1$，以恒定速率 $\\lambda$ 发生（这等同于 $\\varnothing \\to X$，其倾向性为 $\\lambda$）。\n- 消亡：$X \\to X - 1$，其发生速率与当前布居成正比，倾向性为 $\\mu X$。\n\n假设 $\\lambda = 2\\,\\mathrm{s^{-1}}$，$\\mu = 0.25\\,\\mathrm{s^{-1}}$ 每分子，以及初始条件 $X(0) = 3$。使用 Gillespie 直接法（也称为随机模拟算法），将每个事件间的等待时间视为一个指数随机变量，其速率等于瞬时总倾向性，并根据与当前倾向性成正比的概率选择下一个反应的通道。现提供三对独立的均匀随机种子 $(u_{1,k},u_{2,k})$，其中 $k \\in \\{1,2,3\\}$。对于每个事件 $k$，$u_{1,k}$ 用于抽样等待时间，$u_{2,k}$ 用于选择反应通道：\n- $(u_{1,1}, u_{2,1}) = (\\exp(-1.1), 0.8)$，\n- $(u_{1,2}, u_{2,2}) = (\\exp(-0.05), 0.2)$，\n- $(u_{1,3}, u_{2,3}) = (\\exp(-0.3), 0.55)$。\n\n从时间 $t=0$ 开始，手动执行 Gillespie 直接法的前三个事件，并在每个事件后更新状态 $X$ 和绝对时间。仅使用上述定义，确定第三个反应事件发生的绝对时间 $t_3$。请用秒为单位，以精确值形式表示您的最终答案。不要四舍五入；如可能，请提供精确分数。最终答案必须是一个实数。", "solution": "对问题陈述进行验证。\n\n**步骤 1：提取给定条件**\n- 系统：一个单物种生灭过程，布居 $X(t)$。\n- 反应与倾向性：\n  - 生成：$X \\to X + 1$ (或 $\\varnothing \\to X$)，倾向性 $a_1 = \\lambda$。\n  - 消亡：$X \\to X - 1$，倾向性 $a_2 = \\mu X$。\n- 速率常数：\n  - $\\lambda = 2\\,\\mathrm{s^{-1}}$。\n  - $\\mu = 0.25\\,\\mathrm{s^{-1}}$ 每分子。\n- 初始条件：$X(0) = 3$，时间 $t=0$。\n- 算法：Gillespie 直接法。事件间等待时间 $\\tau$ 从速率为 $a_{total}$（所有倾向性之和）的指数分布中抽样。其公式为 $\\tau = \\frac{1}{a_{total}} \\ln(\\frac{1}{u_1})$。下一个反应通道根据与单个倾向性成比例的概率，使用第二个均匀随机数 $u_2$ 来选择。\n- 随机种子：三对均匀随机种子 $(u_{1,k}, u_{2,k})$，用于事件 $k = 1, 2, 3$：\n  - $(u_{1,1}, u_{2,1}) = (\\exp(-1.1), 0.8)$。\n  - $(u_{1,2}, u_{2,2}) = (\\exp(-0.05), 0.2)$。\n  - $(u_{1,3}, u_{2,3}) = (\\exp(-0.3), 0.55)$。\n- 目标：确定第三个反应事件的绝对时间 $t_3$。\n\n**步骤 2：使用提取的给定条件进行验证**\n根据验证标准评估问题。\n- **科学依据**：该问题描述了一个标准的生灭过程，这是随机化学动力学中的一个基本模型。Gillespie 算法是用于此类系统的权威、精确的模拟方法。其表述完全符合既定的科学原理。\n- **适定性**：该问题是适定的。它提供了所有必要的参数、初始条件以及一个特定的随机数序列，以便确定性地追踪随机模拟的前三个事件。目标清晰明确。\n- **客观性**：问题以精确、客观的语言陈述，不含任何主观或非科学内容。\n\n**结论与行动**\n该问题在科学上是合理的，是自洽且适定的。没有可识别的缺陷。因此，该问题是**有效的**。将推导求解。\n\n模拟按事件逐一进行，每一步都更新系统状态 $(t, X)$。第 $k$ 步开始时的状态是 $(t_{k-1}, X_{k-1})$。\n\n**初始状态 ($k=0$):**\n系统在时间 $t_0 = 0$ 开始，初始布居为 $X_0 = 3$。\n\n**事件 1 ($k=1$):**\n首先，我们根据状态 $(t_0, X_0)$ 计算两个反应通道的倾向性。\n- 生成倾向性：$a_1 = \\lambda = 2$。\n- 消亡倾向性：$a_2 = \\mu X_0 = (0.25) \\cdot 3 = 0.75$。\n\n总倾向性是各个倾向性之和：\n$$a_{total,0} = a_1 + a_2 = 2 + 0.75 = 2.75 = \\frac{11}{4}$$\n第一个事件的等待时间 $\\tau_1$ 使用第一个随机种子 $u_{1,1} = \\exp(-1.1)$ 计算。\n$$\\tau_1 = \\frac{1}{a_{total,0}} \\ln\\left(\\frac{1}{u_{1,1}}\\right) = \\frac{1}{11/4} \\ln\\left(\\frac{1}{\\exp(-1.1)}\\right) = \\frac{4}{11} \\ln(\\exp(1.1)) = \\frac{4}{11} \\cdot (1.1) = \\frac{4.4}{11} = 0.4 = \\frac{2}{5}$$\n第一个事件的发生时间是：\n$$t_1 = t_0 + \\tau_1 = 0 + 0.4 = 0.4$$\n接下来，我们使用第二个随机种子 $u_{2,1} = 0.8$ 来确定发生哪个反应。如果 $u_{2,1} \\le \\frac{a_1}{a_{total,0}}$，则发生生成反应（通道 1）。\n$$\\frac{a_1}{a_{total,0}} = \\frac{2}{2.75} = \\frac{2}{11/4} = \\frac{8}{11} \\approx 0.727$$\n由于 $u_{2,1} = 0.8 > \\frac{8}{11}$，选择消亡反应（通道 2）。相应地更新布居：\n$$X_1 = X_0 - 1 = 3 - 1 = 2$$\n第一个事件后的状态是 $(t_1, X_1) = (0.4, 2)$。\n\n**事件 2 ($k=2$):**\n我们从状态 $(t_1, X_1) = (0.4, 2)$ 继续。\n- 生成倾向性：$a_1 = \\lambda = 2$。\n- 消亡倾向性：$a_2 = \\mu X_1 = (0.25) \\cdot 2 = 0.5$。\n\n总倾向性是：\n$$a_{total,1} = a_1 + a_2 = 2 + 0.5 = 2.5 = \\frac{5}{2}$$\n第二个事件的等待时间 $\\tau_2$ 使用 $u_{1,2} = \\exp(-0.05)$ 计算。\n$$\\tau_2 = \\frac{1}{a_{total,1}} \\ln\\left(\\frac{1}{u_{1,2}}\\right) = \\frac{1}{5/2} \\ln\\left(\\frac{1}{\\exp(-0.05)}\\right) = \\frac{2}{5} \\ln(\\exp(0.05)) = \\frac{2}{5} \\cdot (0.05) = \\frac{0.1}{5} = 0.02 = \\frac{1}{50}$$\n第二个事件的发生时间是：\n$$t_2 = t_1 + \\tau_2 = 0.4 + 0.02 = 0.42 = \\frac{42}{100} = \\frac{21}{50}$$\n使用 $u_{2,2} = 0.2$ 选择反应。生成反应的条件是 $u_{2,2} \\le \\frac{a_1}{a_{total,1}}$。\n$$\\frac{a_1}{a_{total,1}} = \\frac{2}{2.5} = \\frac{4}{5} = 0.8$$\n由于 $u_{2,2} = 0.2 \\le 0.8$，选择生成反应。布居变为：\n$$X_2 = X_1 + 1 = 2 + 1 = 3$$\n第二个事件后的状态是 $(t_2, X_2) = (0.42, 3)$。\n\n**事件 3 ($k=3$):**\n我们从状态 $(t_2, X_2) = (0.42, 3)$ 继续。布居数已返回其初始值。\n- 生成倾向性：$a_1 = \\lambda = 2$。\n- 消亡倾向性：$a_2 = \\mu X_2 = (0.25) \\cdot 3 = 0.75$。\n\n总倾向性与第一步相同：\n$$a_{total,2} = a_1 + a_2 = 2 + 0.75 = 2.75 = \\frac{11}{4}$$\n第三个事件的等待时间 $\\tau_3$ 使用 $u_{1,3} = \\exp(-0.3)$ 计算。\n$$\\tau_3 = \\frac{1}{a_{total,2}} \\ln\\left(\\frac{1}{u_{1,3}}\\right) = \\frac{1}{11/4} \\ln\\left(\\frac{1}{\\exp(-0.3)}\\right) = \\frac{4}{11} \\ln(\\exp(0.3)) = \\frac{4}{11} \\cdot (0.3) = \\frac{1.2}{11} = \\frac{12}{110} = \\frac{6}{55}$$\n第三个事件的绝对时间 $t_3$ 是等待时间的累积和：\n$$t_3 = t_2 + \\tau_3 = \\frac{21}{50} + \\frac{6}{55}$$\n为将这些分数相加，我们找到一个公分母，即 $\\mathrm{lcm}(50, 55) = \\mathrm{lcm}(2 \\cdot 5^2, 5 \\cdot 11) = 2 \\cdot 5^2 \\cdot 11 = 550$（最小公倍数）。\n$$t_3 = \\frac{21 \\cdot 11}{50 \\cdot 11} + \\frac{6 \\cdot 10}{55 \\cdot 10} = \\frac{231}{550} + \\frac{60}{550} = \\frac{231 + 60}{550} = \\frac{291}{550}$$\n分数 $\\frac{291}{550}$ 是不可约分的，因为分子的质因数是 $291 = 3 \\cdot 97$，分母的质因数是 $550 = 2 \\cdot 5^2 \\cdot 11$，它们没有共同的因子。\n\n问题只要求时间 $t_3$。为完整起见，第三个反应将是生成反应，因为 $u_{2,3} = 0.55 \\le \\frac{8}{11}$。\n\n最终答案是第三个事件发生的绝对时间。", "answer": "$$\\boxed{\\frac{291}{550}}$$", "id": "2678033"}, {"introduction": "在构建随机模拟时，正确地写出每个反应的倾向性函数（propensity function）是至关重要的一步。这个练习聚焦于一个常见却关键的细节：如何区分涉及不同分子（如 $A+B \\to C$）与相同分子（如 $A+A \\to D$）的反应倾向性。通过精确计算和比较，你将深入理解组合学在随机动力学中的作用，避免在建立模型时犯下常见的错误。[@problem_id:2430872]", "problem": "在一个由 Gillespie 随机模拟算法 (SSA) 模拟的充分混合的等温系统中，考虑两个可能从同一状态发生的反应通道：\n- 反应 $\\mathrm{R}_1$：$A + B \\to C$，其随机速率常数为 $k$，倾向性为 $a_1 = k \\, X_A X_B$。\n- 反应 $\\mathrm{R}_2$：$A + A \\to D$，其随机速率常数同样为 $k$，倾向性为 $a_2 = k \\, X_A \\, (X_A - 1)/2$。\n\n假设当前状态的分子数为 $X_A = 4$、$X_B = 3$、$X_C = 0$ 和 $X_D = 0$。令总倾向性为 $a_0 = a_1 + a_2$。一个 SSA 步骤的进行方式是：以与其倾向性成正比的概率选择下一个发生的反应，然后根据反应的化学计量更新状态。\n\n对于此步骤，哪个选项正确且完整地描述了以下四项内容：\n(i) $a_0$，\n(ii) 反应 $\\mathrm{R}_1$ 下一个发生的概率，\n(iii) 每次反应发生所引起的状态更新，以及\n(iv) 在给定状态下，反应 $\\mathrm{R}_1$ 单次发生后即时的新倾向性 $a_1'$ 和 $a_2'$？\n\nA. $a_0 = 18k$；$\\mathbb{P}(\\mathrm{R}_1 \\text{ 下一个发生}) = 2/3$；若 $\\mathrm{R}_1$ 发生，则 $X_A \\to 3$、$X_B \\to 2$、$X_C \\to 1$，$X_D$ 不变；若 $\\mathrm{R}_2$ 发生，则 $X_A \\to 2$、$X_D \\to 1$，$X_B$、$X_C$ 不变；$\\mathrm{R}_1$ 发生后，$a_1' = 6k$、$a_2' = 3k$。\n\nB. $a_0 = 28k$；$\\mathbb{P}(\\mathrm{R}_1 \\text{ 下一个发生}) = 3/7$；若 $\\mathrm{R}_1$ 发生，则 $X_A \\to 3$、$X_B \\to 2$、$X_C \\to 1$；若 $\\mathrm{R}_2$ 发生，则 $X_A \\to 3$、$X_D \\to 1$；$\\mathrm{R}_1$ 发生后，$a_1' = 6k$、$a_2' = 9k$。\n\nC. $a_0 = 18k$，其中 $a_1 = k \\, X_A X_B / 2$ 且 $a_2 = k \\, X_A (X_A - 1)$；$\\mathbb{P}(\\mathrm{R}_1 \\text{ 下一个发生}) = 1/3$；若 $\\mathrm{R}_2$ 发生，则 $X_A \\to 3$、$X_D \\to 1$；$\\mathrm{R}_1$ 发生后，$a_1' = 3k$、$a_2' = 6k$。\n\nD. $a_0 = 18k$；$\\mathbb{P}(\\mathrm{R}_1 \\text{ 下一个发生}) = 2/3$；若 $\\mathrm{R}_1$ 发生，则 $X_A \\to 3$、$X_B \\to 2$、$X_C \\to 1$；若 $\\mathrm{R}_2$ 发生，则 $X_A \\to 3$、$X_D \\to 1$；$\\mathrm{R}_1$ 发生后，$a_1' = 6k$、$a_2' = 6k$。", "solution": "我们使用化学主方程下基元反应的倾向性定义：\n- 对于异源二聚化反应 $A + B \\to C$，不同反应物对的数量是 $X_A X_B$，因此 $a_1 = k \\, X_A X_B$。\n- 对于同源二聚化反应 $A + A \\to D$，无序反应物对的数量是 $\\binom{X_A}{2} = X_A (X_A - 1)/2$，因此 $a_2 = k \\, X_A (X_A - 1)/2$。\n总倾向性为 $a_0 = a_1 + a_2$，反应 $\\mathrm{R}_j$ 下一个发生的概率为 $a_j / a_0$。单次反应发生后，状态根据所发生反应的化学计量变化向量进行更新。\n\n根据给定状态 $X_A = 4$ 和 $X_B = 3$：\n- 计算 $a_1$：$a_1 = k \\cdot 4 \\cdot 3 = 12k$。\n- 计算 $a_2$：$a_2 = k \\cdot 4 \\cdot (4 - 1)/2 = k \\cdot 4 \\cdot 3 / 2 = 6k$。\n因此，$a_0 = a_1 + a_2 = 12k + 6k = 18k$，且 $\\mathbb{P}(\\mathrm{R}_1 \\text{ 下一个发生}) = a_1/a_0 = 12k/18k = 2/3$。\n\n单次反应发生的状态更新：\n- 如果 $\\mathrm{R}_1$ 发生 ($A + B \\to C$)：$X_A \\to 4 - 1 = 3$，$X_B \\to 3 - 1 = 2$，$X_C \\to 0 + 1 = 1$，$X_D$ 不变。\n- 如果 $\\mathrm{R}_2$ 发生 ($A + A \\to D$)：$X_A \\to 4 - 2 = 2$ (消耗两个)，$X_D \\to 0 + 1 = 1$，$X_B$ 和 $X_C$ 不变。\n\n如果 $\\mathrm{R}_1$ 发生，新状态为 $X_A = 3$，$X_B = 2$，$X_C = 1$，$X_D = 0$。重新计算倾向性：\n- $a_1' = k \\cdot X_A \\cdot X_B = k \\cdot 3 \\cdot 2 = 6k$。\n- $a_2' = k \\cdot X_A (X_A - 1)/2 = k \\cdot 3 \\cdot 2 / 2 = 3k$。\n\n逐一分析选项：\n\nA. 给出 $a_0 = 18k$，$\\mathbb{P}(\\mathrm{R}_1 \\text{ 下一个发生}) = 2/3$，两个反应的化学计量更新正确（$\\mathrm{R}_1$ 消耗一个 $A$ 和一个 $B$，$\\mathrm{R}_2$ 消耗两个 $A$），并且 $\\mathrm{R}_1$ 发生后给出 $a_1' = 6k, a_2' = 3k$。所有这些都与上面的计算一致。结论 — 正确。\n\nB. 隐含地使用了 $a_2 = k X_A^2$（因为 $a_0 = 28k$ 和 $a_1 = 12k$ 会推导出 $a_2 = 16k$），这重复计算了有序对，对于同源二聚化反应是不正确的。它还给出了 $\\mathrm{R}_2$ 的错误更新（它列出的是 $X_A \\to 3$ 而不是消耗两个 $A$），并且 $\\mathrm{R}_1$ 发生后的 $a_2'$ 为 $9k$（再次反映了 $k X_A^2$）。结论 — 错误。\n\nC. 将异源二聚化倾向性除以2，并省略了同源二聚化倾向性中的因子 $1/2$，这两者都是不正确的。它还列出了 $\\mathrm{R}_2$ 的错误更新（仅消耗一个 $A$）。推导出的概率和反应后倾向性都源于这些错误的公式，因此是不正确的。结论 — 错误。\n\nD. 给出了正确的 $a_0$ 和 $\\mathbb{P}(\\mathrm{R}_1 \\text{ 下一个发生})$ 以及 $\\mathrm{R}_1$ 的正确更新，但列出了 $\\mathrm{R}_2$ 的错误更新（消耗一个 $A$ 而不是两个）以及 $\\mathrm{R}_1$ 发生后不正确的 $a_2'$（$6k$ 而不是 $3k$）。结论 — 错误。\n\n因此，只有选项 A 正确并完整地捕捉了在 Gillespie SSA 中实现 $A + B \\to C$ 与 $A + A \\to D$ 的差异，包括同源二聚化倾向性的组合因子、正确的选择概率以及正确的化学计量和倾向性更新。", "answer": "$$\\boxed{A}$$", "id": "2430872"}, {"introduction": "随机模拟的真正威力在于它能揭示确定性模型无法捕捉的现象，例如随机开关行为。本练习将指导你为一个经典的自催化反应网络编写完整的Gillespie模拟程序。通过运行大量独立的模拟轨迹，你将亲眼见证初始条件完全相同的系统如何因内在的随机性而走向两种截然不同的命运——群体灭绝或爆发，从而深刻理解随机性在生物决策过程中的关键作用。[@problem_id:2430922]", "problem": "您需要实现精确的随机模拟算法 (SSA)，也称为 Gillespie 算法，用以研究一个表现出双峰结果的自催化反应网络。该化学系统由两个反应组成，在混合均匀、等温、恒容条件下进行，并遵循基元质量作用动力学：\n- 反应 $\\mathrm{R}_1$：$A + X \\rightarrow 2X$\n- 反应 $\\mathrm{R}_2$：$X \\rightarrow \\varnothing$\n\n从混合均匀的马尔可夫跳跃过程的化学主方程（Chemical Master Equation）和基元步骤的质量作用原理（mass-action principle）的基本定义出发。对于一个分子数为 $A$ 和 $X$ 的状态，其反应倾向性（reaction propensities）为：\n- $a_1(A,X) = c \\cdot A \\cdot X$\n- $a_2(A,X) = d \\cdot X$\n\n总倾向性为 $a_0(A,X) = a_1(A,X) + a_2(A,X)$。到下一次反应的等待时间是一个均值为 $1/a_0$ 的指数随机变量，而下一个反应的索引是根据与倾向性成比例的概率选择的。在有限资源下，该系统表现出两个相互竞争的吸收边界：\n- 绝灭边界：$X$ 达到 $0$（没有自催化剂来维持增长）。\n- 爆炸边界（资源耗尽）：$A$ 达到 $0$（在绝灭前底物完全转化）。\n\n您的任务是为这个双反应系统实现精确的 SSA，并通过重复模拟来估计在固定的视界时间 $T_{\\max}$ 内两种结果的经验概率：\n- 绝灭的经验概率是指在时间 $T_{\\max}$ 到达前、且在 $A$ 达到 $0$ 之前， $X$ 先达到 $0$ 的轨迹所占的比例。\n- 爆炸的经验概率是指在时间 $T_{\\max}$ 到达前、且在 $X$ 达到 $0$ 之前， $A$ 先达到 $0$ 的轨迹所占的比例。\n在时间 $T_{\\max}$ 之前未达到任一吸收边界的轨迹不计入任何一种结果。\n\n使用以上定义，实现一个程序，对于每个测试用例，在固定的随机种子下运行 $N$ 次独立轨迹以确保可复现性，并返回两个浮点数：绝灭的经验概率和爆炸的经验概率，每个数都四舍五入到三位小数。该算法必须是精确的 Gillespie 方法，在每一步中，从速率为 $a_0$ 的指数分布中抽取时间增量 $\\tau$，并根据 $a_1/a_0$ 和 $a_2/a_0$ 的比例来选择反应索引。\n\n测试套件：\n- 案例 $1$（绝灭主导区）：$(A_0, X_0, c, d, T_{\\max}, N, \\text{seed}) = (60, 3, 0.001, 0.2, 200.0, 2000, 1729)$\n- 案例 $2$（近阈值区）：$(A_0, X_0, c, d, T_{\\max}, N, \\text{seed}) = (100, 10, 0.005, 0.5, 100.0, 2000, 1733)$\n- 案例 $3$（爆炸主导区）：$(A_0, X_0, c, d, T_{\\max}, N, \\text{seed}) = (200, 5, 0.01, 0.05, 50.0, 2000, 1737)$\n\n实现要求：\n- 使用上文所述的、基于化学主方程和质量作用倾向性的精确 Gillespie 算法。\n- 对于每个案例，从 $(A_0, X_0)$ 开始模拟 $N$ 条轨迹，直到 $A=0$、$X=0$ 或 $t \\ge T_{\\max}$。\n- 完全按照上述方式定义两种结果。\n- 为每个案例报告两个浮点数：绝灭的经验概率和爆炸的经验概率，每个数都四舍五入到三位小数。\n- 最终输出格式：您的程序应生成单行输出，其中包含所有三个测试用例的结果，形式为一个包含六个浮点数的逗号分隔列表，并用方括号括起来。顺序必须是：案例 1 绝灭概率、案例 1 爆炸概率、案例 2 绝灭概率、案例 2 爆炸概率、案例 3 绝灭概率、案例 3 爆炸概率。例如：“[0.913,0.085,0.501,0.495,0.002,0.997]”。\n- 输出中不需要物理单位，因为概率是无量纲的。所有报告的数字必须是小数，而不是百分比。\n\n您的程序必须是自包含的，且不需要任何输入。它必须通过在运行每个案例的 $N$ 条轨迹之前，使用为该案例提供的种子来初始化随机数生成器，从而确定性地复现相同的结果。", "solution": "该问题已经过验证，确认为有效。这是一个计算生物学领域中定义明确的问题，基于已建立的随机化学动力学理论，并为获得唯一的、可复现的解提供了所有必要的参数和条件。\n\n任务是使用精确的随机模拟算法（SSA）（通常称为 Gillespie 算法）来模拟一个随机化学系统。该算法生成由化学主方程（CME）控制的马尔可夫跳跃过程的统计上正确的轨迹。\n\n该系统由两种化学物种组成：一个底物 $A$ 和一个自催化剂 $X$，它们在混合均匀、恒温的体积内参与两个基元反应：\n1.  $X$ 的自催化生产：$R_1: A + X \\xrightarrow{c} 2X$\n2.  $X$ 的降解：$R_2: X \\xrightarrow{d} \\varnothing$\n\n在任意时间 $t$，系统的状态由分子数的整数向量 $\\mathbf{n}(t) = (A(t), X(t))$ 定义。每个反应引起的状态变化由状态改变向量给出：\n- 对于 $R_1$：$\\mathbf{v}_1 = (-1, +1)$，表示一个 $A$ 分子转化为一个 $X$ 分子。\n- 对于 $R_2$：$\\mathbf{v}_2 = (0, -1)$，表示一个 $X$ 分子被移除。\n\n根据基元反应的质量作用动力学原理，每个反应的速率与其反应物数量的乘积成正比。这些速率被定义为倾向函数 $a_j(\\mathbf{n})$：\n- $R_1$ 的倾向性：$a_1(A, X) = c \\cdot A \\cdot X$\n- $R_2$ 的倾向性：$a_2(X) = d \\cdot X$\n\n总倾向性 $a_0(\\mathbf{n})$ 是各个倾向性之和，表示任何反应可能发生的总速率：\n$$a_0(A, X) = a_1(A, X) + a_2(X) = c \\cdot A \\cdot X + d \\cdot X$$\n\nGillespie 算法是一种精确的模拟方法，其在每一步通过回答两个问题来进行：下一次反应何时发生？以及它将是哪个反应？\n\n1.  **到下一次反应的时间 ($\\tau$)**：对于处于状态 $\\mathbf{n}$ 的系统，到下一次反应事件的时间 $\\tau$ 是一个从速率参数为 $a_0(\\mathbf{n})$ 的指数分布中抽取的随机变量。其概率密度函数为 $p(\\tau | \\mathbf{n}) = a_0(\\mathbf{n}) e^{-a_0(\\mathbf{n})\\tau}$。可以使用逆变换采样生成 $\\tau$ 的值：\n    $$\\tau = \\frac{1}{a_0(\\mathbf{n})} \\ln\\left(\\frac{1}{r_1}\\right)$$\n    其中 $r_1$ 是从 $(0, 1)$ 上的均匀分布中抽取的随机数。\n\n2.  **下一次反应的身份 ($\\mu$)**：下一次反应是 $R_j$ 的概率由其倾向性与总倾向性的比值给出，$P(\\mu=j | \\mathbf{n}) = a_j(\\mathbf{n}) / a_0(\\mathbf{n})$。通过抽取第二个均匀随机数 $r_2 \\in U(0, 1)$ 并找到满足以下条件的最小整数索引 $\\mu$ 来选择具体反应：\n    $$\\sum_{j=1}^{\\mu} a_j(\\mathbf{n}) > r_2 \\cdot a_0(\\mathbf{n})$$\n    对于我们的双反应系统，这可以简化为：\n    - 如果 $r_2 \\cdot a_0 \\le a_1$，则下一个反应是 $R_1$。\n    - 否则，下一个反应是 $R_2$。\n\n单条轨迹的逐步模拟如下：\n- **初始化**：设置时间 $t = 0.0$ 和初始分子数 $(A, X) = (A_0, X_0)$。\n- **迭代循环**：当终止条件未满足时：\n    1.  计算倾向性 $a_1 = c \\cdot A \\cdot X$ 和 $a_2 = d \\cdot X$，以及总倾向性 $a_0 = a_1 + a_2$。\n    2.  如果 $a_0 = 0$，系统处于吸收态（对于此系统，这意味着 $X=0$）。该轨迹的模拟结束。\n    3.  从速率为 $a_0$ 的指数分布中抽取时间步长 $\\tau$。\n    4.  检查时间视界：如果下一个事件时间 $t + \\tau$ 大于或等于最大模拟时间 $T_{\\max}$，则轨迹因时间限制而终止。此轨迹不记录任何结果。\n    5.  更新时间：$t \\leftarrow t + \\tau$。\n    6.  根据倾向性选择反应 $\\mu$。\n    7.  更新状态：$(A, X) \\leftarrow (A, X) + \\mathbf{v}_{\\mu}$。\n    8.  检查吸收边界：如果 $A = 0$ 或 $X = 0$，则轨迹终止。\n\n为了估计经验概率，此过程对 $N$ 条独立的轨迹重复进行。每条轨迹都从相同的初始状态 $(A_0, X_0)$ 开始，但由于随机性而遵循不同的路径。为两种指定的结果分别维护一个计数器：\n- **绝灭**：如果一条轨迹因在 $A > 0$ 且 $t  T_{\\max}$ 的条件下 $X$ 变为 0 而终止，则计为一次“绝灭”事件。\n- **爆炸**：如果一条轨迹因在 $X > 0$ 且 $t  T_{\\max}$ 的条件下 $A$ 变为 0 而终止，则计为一次“爆炸”（资源耗尽）事件。\n\n在对给定参数集运行所有 $N$ 条轨迹后，经验概率计算为导致每种结果的轨迹所占的比例：\n$$P_{\\text{extinction}} = \\frac{\\text{extinction\\_count}}{N}$$\n$$P_{\\text{explosion}} = \\frac{\\text{explosion\\_count}}{N}$$\n\n为保证可复现性，在开始每个测试用例的 $N$ 次模拟之前，使用指定的值为随机数生成器设定种子。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the exact Stochastic Simulation Algorithm (Gillespie algorithm)\n    to study an autocatalytic reaction network and estimate the probabilities\n    of extinction and explosion outcomes.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (A_0, X_0, c, d, T_max, N, seed)\n        (60, 3, 0.001, 0.2, 200.0, 2000, 1729),  # Case 1: extinction-dominated\n        (100, 10, 0.005, 0.5, 100.0, 2000, 1733), # Case 2: near-threshold\n        (200, 5, 0.01, 0.05, 50.0, 2000, 1737),   # Case 3: explosion-dominated\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        A0, X0, c, d, T_max, N, seed = case\n        \n        # Initialize random number generator with the specified seed for reproducibility\n        rng = np.random.default_rng(seed)\n\n        extinction_count = 0\n        explosion_count = 0\n\n        # Run N independent trajectories\n        for _ in range(N):\n            t = 0.0\n            A = A0\n            X = X0\n\n            # Main Gillespie algorithm loop for a single trajectory\n            while True:\n                # Check for absorbing state termination (species depletion)\n                # These checks are placed before the time check to correctly attribute\n                # the outcome if the boundary is hit at the start of an interval.\n                if X == 0:\n                    # Condition for extinction: X depletes before A and before T_max\n                    extinction_count += 1\n                    break\n                if A == 0:\n                    # Condition for explosion: A depletes before X and before T_max\n                    explosion_count += 1\n                    break\n                \n                # Check for time horizon termination\n                if t >= T_max:\n                    # Trajectory ends due to time limit, neither outcome is counted.\n                    break\n\n                # Step 1: Calculate propensity functions\n                propensity_r1 = c * A * X\n                propensity_r2 = d * X\n                propensity_total = propensity_r1 + propensity_r2\n\n                # If total propensity is zero, no more reactions can occur.\n                # In this system, this only happens if X is zero, which is already handled.\n                if propensity_total = 0:\n                    break\n\n                # Step 2: Draw time to next reaction from exponential distribution\n                # tau = (1.0 / propensity_total) * np.log(1.0 / rng.random()) is equivalent\n                tau = rng.exponential(scale=1.0 / propensity_total)\n\n                # Check if the next reaction would occur after the time horizon\n                if t + tau >= T_max:\n                    # The trajectory runs until T_max but doesn't hit a boundary in time.\n                    break\n                \n                # Step 4: Update time\n                t += tau\n\n                # Step 3: Choose which reaction occurs\n                if rng.random() * propensity_total  propensity_r1:\n                    # Reaction R1: A + X -> 2X\n                    # Stoichiometry vector: (-1, +1)\n                    A -= 1\n                    X += 1\n                else:\n                    # Reaction R2: X -> 0\n                    # Stoichiometry vector: (0, -1)\n                    X -= 1\n\n        # Calculate empirical probabilities\n        prob_extinction = extinction_count / N\n        prob_explosion = explosion_count / N\n        \n        # Append results formatted to three decimal places\n        results.append(f\"{prob_extinction:.3f}\")\n        results.append(f\"{prob_explosion:.3f}\")\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2430922"}]}