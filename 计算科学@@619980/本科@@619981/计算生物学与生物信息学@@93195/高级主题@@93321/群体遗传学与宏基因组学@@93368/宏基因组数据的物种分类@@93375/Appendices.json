{"hands_on_practices": [{"introduction": "在宏基因组分箱中，成对末端测序读数是连接不同重叠群（contigs）的有力证据。本练习将引导你使用贝叶斯推断和信息论，来量化这些连接信息在多大程度上增强了“两个重叠群来自同一物种”这一假设的可信度 [@problem_id:2433913]。通过这个实践，你将学会如何将生物学直觉转化为严谨的数学模型，并利用香农熵（Shannon entropy）来衡量新证据带来的信息增益。", "problem": "在宏基因组数据的物种分类分箱中，如果来自同一DNA片段的配对读段能够以正确的方向和插入片段大小唯一地比对到两个不同的重叠群上（每个重叠群一个），那么这些双末端测序读段信息就可以支持这两个重叠群的连接。考虑两个重叠群以及一个二元潜在假设：$S$（来自同一物种）与 $D$（来自不同物种）。假设先验概率为 $P(S) = 0.2$，且 $P(D) = 1 - P(S)$。假设在两个重叠群之间观测到的正确比对的双末端连接数 $K$ 服从泊松分布，在假设 $S$ 下均值为 $\\lambda_{S} = 8$，在假设 $D$ 下均值为 $\\lambda_{D} = 0.5$。即，对于 $k \\in \\{0,1,2,\\dots\\}$,\n$$\nP(K = k \\mid S) = \\exp(-\\lambda_{S}) \\frac{\\lambda_{S}^{k}}{k!}, \\quad P(K = k \\mid D) = \\exp(-\\lambda_{D}) \\frac{\\lambda_{D}^{k}}{k!}.\n$$\n您观测到 $K = 5$。将使用双末端数据所带来的信息增益定义为指示两个重叠群是否来自同一物种的二元变量的香农熵（以比特为单位）的减少量，即\n$$\n\\Delta I \\equiv H_{\\text{prior}} - H_{\\text{posterior}},\n$$\n其中，对于伯努利参数 $p \\in (0,1)$，$H(p) = -\\big[p \\log_{2}(p) + (1-p)\\log_{2}(1-p)\\big]$，$H_{\\text{prior}} = H\\big(P(S)\\big)$，以及 $H_{\\text{posterior}} = H\\big(P(S \\mid K=5)\\big)$。计算 $\\Delta I$（以比特为单位）。将您的答案四舍五入到四位有效数字。以比特为单位表示最终结果。", "solution": "该问题要求计算信息增益 $\\Delta I$，其定义为在观测到数据 $K=5$ 后，状态变量 $S$ 的香农熵的减少量。信息增益由下式给出：\n$$\n\\Delta I = H_{\\text{prior}} - H_{\\text{posterior}}\n$$\n其中 $H_{\\text{prior}}$ 是 $S$ 的先验分布的熵，$H_{\\text{posterior}}$ 是在给定观测值的情况下 $S$ 的后验分布的熵。对于参数为 $p$ 的伯努利变量，其香农熵（以比特为单位）定义为 $H(p) = -\\left[p \\log_{2}(p) + (1-p)\\log_{2}(1-p)\\right]$。\n\n首先，我们计算先验熵 $H_{\\text{prior}}$。两个重叠群来自同一物种的先验概率为 $P(S) = 0.2$。\n令 $p_{\\text{prior}} = P(S) = 0.2$。则 $1 - p_{\\text{prior}} = P(D) = 0.8$。\n先验熵为：\n$$\nH_{\\text{prior}} = H(p_{\\text{prior}}) = H(0.2) = -\\left[0.2 \\log_{2}(0.2) + 0.8 \\log_{2}(0.8)\\right]\n$$\n使用换底公式 $\\log_{2}(x) = \\frac{\\ln(x)}{\\ln(2)}$，我们得到：\n$$\nH_{\\text{prior}} = -\\frac{1}{\\ln(2)} \\left[0.2 \\ln(0.2) + 0.8 \\ln(0.8)\\right]\n$$\n代入数值 $\\ln(0.2) \\approx -1.609438$、$\\ln(0.8) \\approx -0.223144$ 以及 $\\ln(2) \\approx 0.693147$：\n$$\nH_{\\text{prior}} \\approx -\\frac{1}{0.693147} \\left[0.2(-1.609438) + 0.8(-0.223144)\\right] \\approx -\\frac{-0.500403}{0.693147} \\approx 0.721928 \\text{ bits}\n$$\n\n接下来，我们必须求出后验概率 $P(S \\mid K=5)$ 以计算后验熵 $H_{\\text{posterior}}$。我们使用贝叶斯定理：\n$$\nP(S \\mid K=5) = \\frac{P(K=5 \\mid S) P(S)}{P(K=5)}\n$$\n观测到 $K=5$ 的边缘概率 $P(K=5)$ 由全概率公式给出：\n$$\nP(K=5) = P(K=5 \\mid S) P(S) + P(K=5 \\mid D) P(D)\n$$\n条件概率（或似然）由泊松概率质量函数给出。\n对于假设 $S$，有 $\\lambda_S = 8$：\n$$\nP(K=5 \\mid S) = \\frac{\\lambda_S^5 \\exp(-\\lambda_S)}{5!} = \\frac{8^5 \\exp(-8)}{120}\n$$\n对于假设 $D$，有 $\\lambda_D = 0.5$：\n$$\nP(K=5 \\mid D) = \\frac{\\lambda_D^5 \\exp(-\\lambda_D)}{5!} = \\frac{(0.5)^5 \\exp(-0.5)}{120}\n$$\n因此，后验概率 $p_{\\text{posterior}} = P(S \\mid K=5)$ 为：\n$$\np_{\\text{posterior}} = \\frac{P(K=5 \\mid S) P(S)}{P(K=5 \\mid S) P(S) + P(K=5 \\mid D) P(D)}\n$$\n代入似然表达式以及先验概率 $P(S)=0.2$ 和 $P(D)=0.8$：\n$$\np_{\\text{posterior}} = \\frac{\\frac{8^5 \\exp(-8)}{120} \\times 0.2}{\\frac{8^5 \\exp(-8)}{120} \\times 0.2 + \\frac{(0.5)^5 \\exp(-0.5)}{120} \\times 0.8}\n$$\n分子和分母中的项 $1/120$ 可以约去：\n$$\np_{\\text{posterior}} = \\frac{8^5 \\exp(-8) \\times 0.2}{8^5 \\exp(-8) \\times 0.2 + (0.5)^5 \\exp(-0.5) \\times 0.8}\n$$\n我们计算各项的值：\n$8^5 \\exp(-8) = 32768 \\times \\exp(-8) \\approx 32768 \\times 0.00033546 = 10.9936$\n$(0.5)^5 \\exp(-0.5) = 0.03125 \\times \\exp(-0.5) \\approx 0.03125 \\times 0.60653 = 0.018954$\n$$\np_{\\text{posterior}} \\approx \\frac{10.9936 \\times 0.2}{10.9936 \\times 0.2 + 0.018954 \\times 0.8} = \\frac{2.19872}{2.19872 + 0.015163} = \\frac{2.19872}{2.213883} \\approx 0.9931499\n$$\n这就得到了重叠群来自同一物种的后验概率。现在我们可以计算后验熵 $H_{\\text{posterior}}$：\n$$\nH_{\\text{posterior}} = H(p_{\\text{posterior}}) \\approx H(0.99315) = -\\left[0.99315 \\log_{2}(0.99315) + (1-0.99315)\\log_{2}(1-0.99315)\\right]\n$$\n令 $p_{\\text{post}} \\approx 0.99315$ 且 $1-p_{\\text{post}} \\approx 0.00685$。\n$$\nH_{\\text{posterior}} \\approx -\\frac{1}{\\ln(2)} \\left[0.99315 \\ln(0.99315) + 0.00685 \\ln(0.00685)\\right]\n$$\n$$\nH_{\\text{posterior}} \\approx -\\frac{1}{0.693147} \\left[0.99315(-0.00687) + 0.00685(-4.9836)\\right] \\approx -\\frac{-0.00682 - 0.03414}{0.693147} \\approx \\frac{0.04096}{0.693147} \\approx 0.059101 \\text{ bits}\n$$\n最后，信息增益 $\\Delta I$ 是先验熵和后验熵之差：\n$$\n\\Delta I = H_{\\text{prior}} - H_{\\text{posterior}} \\approx 0.721928 - 0.059101 = 0.662827\n$$\n将结果四舍五入到四位有效数字，得到 $0.6628$。", "answer": "$$\n\\boxed{0.6628}\n$$", "id": "2433913"}, {"introduction": "物种分箱的一个核心挑战是区分那些基因组特征非常相似的物种。本练习模拟了一个经典的难题：一个“神秘物种”，其GC含量恰好是群落中两个最丰富物种的加权平均值 [@problem_id:2433879]。你将通过编写代码，实现一个基于GC含量的分箱器，并评估其在这种挑战性场景下的表现，从而深刻理解单一特征方法的局限性以及评估分类器性能的重要性。", "problem": "给定一个简化的概率模型，该模型仅基于鸟嘌呤-胞嘧啶（GC）含量对宏基因组读段进行物种分类分箱。考虑一个由 $n$ 个生物组成的集合，其索引为 $i \\in \\{1,\\dots,n\\}$。每个生物都有一个 GC 概率 $p_i \\in (0,1)$ 和一个严格为正的预归一化丰度权重 $w_i \\in \\mathbb{R}_{>0}$。读段是长度固定的独立同分布随机变量，长度为 $L \\in \\mathbb{N}$。对于来自生物 $i$ 的一条读段，每个碱基以概率 $p_i$ 独立地被抽为 G 或 C，以概率 $1 - p_i$ 被抽为 A 或 T，其中 G/C 对内和 A/T 对内的选择是等概率的。\n\n将长度为 $L$ 的读段中的 GC 碱基数定义为随机变量 $K$，因此，对于生物 $i$，$K \\sim \\mathrm{Binomial}(L, p_i)$。每条读段的 GC分数是 $r = K / L$。\n\n引入一个额外的生物，称为隐匿生物，其预归一化丰度权重为 $w_c \\in \\mathbb{R}_{>0}$，GC 概率 $p_c$ 定义为两个丰度最高的原始生物的 GC 概率的加权平均值。设 $a$ 和 $b$ 是 $\\{w_1,\\dots,w_n\\}$ 中两个最大元素的索引，若权重相同，则选择较小的索引。那么\n$$\np_c \\;=\\; \\frac{w_a\\,p_a + w_b\\,p_b}{w_a + w_b}.\n$$\n在添加隐匿生物后，将所有丰度权重（包括 $w_c$）除以总和进行归一化，使得归一化后的权重总和为 $1$。\n\n定义一个分箱规则，将 GC 分数为 $r$ 的读段分配给生物索引\n$$\n\\hat{\\imath}(r) \\;=\\; \\arg\\min_{j \\in \\{1,\\dots,n,n+1\\}} \\big| r - p_j \\big|,\n$$\n其中 $j = n+1$ 表示隐匿生物，若距离相同，则选择最小的索引。\n\n定义以下量：\n- 整体期望准确率，\n$$\n\\mathrm{ACC} \\;=\\; \\sum_{i=1}^{n+1} \\tilde{w}_i \\cdot \\sum_{k=0}^{L} \\Pr(K=k \\mid i)\\, \\mathbf{1}\\!\\left(\\hat{\\imath}\\!\\left(\\frac{k}{L}\\right) = i\\right),\n$$\n其中 $\\tilde{w}_i$ 是归一化后的权重，且 $\\Pr(K=k \\mid i) = \\binom{L}{k} p_i^{k} (1-p_i)^{L-k}$。\n- 隐匿生物分箱的阳性预测值（PPV），\n$$\n\\mathrm{PPV}_c \\;=\\; \\begin{cases}\n\\displaystyle \\frac{\\tilde{w}_{c} \\cdot \\sum_{k=0}^{L} \\Pr(K=k \\mid c) \\, \\mathbf{1}\\!\\left(\\hat{\\imath}\\!\\left(\\frac{k}{L}\\right) = c\\right)}{\\sum_{j=1}^{n+1} \\tilde{w}_{j} \\cdot \\sum_{k=0}^{L} \\Pr(K=k \\mid j) \\, \\mathbf{1}\\!\\left(\\hat{\\imath}\\!\\left(\\frac{k}{L}\\right) = c\\right)} & \\text{如果分母不为零}，\\\\\n0 & \\text{如果分母为零}。\n\\end{cases}\n$$\n- 隐匿生物读段被错分到两个丰度最高的原始生物 $a$ 和 $b$ 的概率，\n$$\nm_{c \\to a} \\;=\\; \\sum_{k=0}^{L} \\Pr(K=k \\mid c)\\, \\mathbf{1}\\!\\left(\\hat{\\imath}\\!\\left(\\frac{k}{L}\\right) = a\\right), \\qquad\nm_{c \\to b} \\;=\\; \\sum_{k=0}^{L} \\Pr(K=k \\mid c)\\, \\mathbf{1}\\!\\left(\\hat{\\imath}\\!\\left(\\frac{k}{L}\\right) = b\\right).\n$$\n\n您的任务是编写一个完整的程序，对下面指定的每个测试用例，构建隐匿生物，归一化丰度，对所有 $k \\in \\{0,\\dots,L\\}$ 使用 $r = k/L$ 应用分箱规则，并计算四个指标：$\\mathrm{ACC}$、$\\mathrm{PPV}_c$、$m_{c \\to a}$ 和 $m_{c \\to b}$。所有浮点数结果必须四舍五入到 $6$ 位小数。本问题不涉及物理单位。\n\n测试套件：\n- 测试用例 1：\n  - 原始 GC 概率： $[0.35,\\, 0.62,\\, 0.48]$。\n  - 原始预归一化丰度： $[0.5,\\, 0.3,\\, 0.2]$。\n  - 隐匿生物预归一化丰度： $0.1$。\n  - 读段长度： $L = 100$。\n- 测试用例 2：\n  - 原始 GC 概率： $[0.49,\\, 0.5,\\, 0.61,\\, 0.39]$。\n  - 原始预归一化丰度： $[0.4,\\, 0.35,\\, 0.15,\\, 0.10]$。\n  - 隐匿生物预归一化丰度： $0.2$。\n  - 读段长度： $L = 60$。\n- 测试用例 3：\n  - 原始 GC 概率： $[0.2,\\, 0.8]$。\n  - 原始预归一化丰度： $[0.55,\\, 0.45]$。\n  - 隐匿生物预归一化丰度： $0.2$。\n  - 读段长度： $L = 30$。\n\n最终输出格式：\n- 您的程序必须生成单行输出，其中包含三个测试用例的结果，格式为一个由逗号分隔的列表，并用方括号括起来。每个测试用例的结果本身必须是一个包含四个浮点数 $[\\mathrm{ACC},\\, \\mathrm{PPV}_c,\\, m_{c \\to a},\\, m_{c \\to b)]$ 的列表，每个浮点数四舍五入到 $6$ 位小数。例如：$[[x_{11},x_{12},x_{13},x_{14}],[x_{21},x_{22},x_{23},x_{24}],[x_{31},x_{32},x_{33},x_{34}]]$.", "solution": "该问题陈述是有效的。它在计算生物学领域有科学依据，在数学上是适定的，并且是客观定义的。所有为得到唯一解所必需的数据、公式和条件都已提供。该模型虽然简化，但是一个基于 GC 含量的物种分类分箱问题的一致性表示，所要求的指标是分类任务的标准性能度量。该问题没有矛盾、歧义或伪科学主张。\n\n我们将采用系统化的方法进行求解。对于每个测试用例，总体步骤包括三个主要阶段：首先，构建包括隐匿生物在内的完整生物集合；其次，根据 GC 含量确定分箱规则；第三，使用此规则和给定的概率模型计算指定的性能指标。\n\n我们用索引 $j \\in \\{1, \\dots, n\\}$ 表示原始生物的集合。隐匿生物将用索引 $c = n+1$ 表示。\n\n**1. 构建完整生物集合**\n\n给定一个包含 $n$ 个原始生物的集合，其 GC 概率为 $\\{p_1, \\dots, p_n\\}$，预归一化权重为 $\\{w_1, \\dots, w_n\\}$。\n\n首先，我们确定在 $\\{w_1, \\dots, w_n\\}$ 中对应两个最大权重的索引 $a, b \\in \\{1, \\dots, n\\}$。根据规定，若权重相同，则选择较小的索引。\n\n引入索引为 $c=n+1$ 的隐匿生物。其预归一化丰度权重给定为 $w_c = w_{n+1}$，其 GC 概率 $p_c = p_{n+1}$ 计算为两个丰度最高的原始生物的 GC 概率的加权平均值：\n$$\np_c = \\frac{w_a p_a + w_b p_b}{w_a + w_b}\n$$\n这样就得到了一个包含 $n+1$ 个生物的完整集合。完整的 GC 概率集合为 $P = \\{p_1, \\dots, p_n, p_{n+1}\\}$，完整的预归一化丰度权重集合为 $W = \\{w_1, \\dots, w_n, w_{n+1}\\}$。\n\n接下来，将所有丰度权重归一化，使其总和为 $1$。每个生物 $j \\in \\{1, \\dots, n+1\\}$ 的归一化丰度 $\\tilde{w}_j$ 为：\n$$\n\\tilde{w}_j = \\frac{w_j}{\\sum_{i=1}^{n+1} w_i}\n$$\n\n**2. 概率模型和分箱规则**\n\n模型规定，对于来自生物 $j$ 的一条长度为 $L$ 的读段，GC 碱基的数量 $K$ 是一个服从二项分布的随机变量，$K \\sim \\mathrm{Binomial}(L, p_j)$。对于一个特定的 GC 计数 $k \\in \\{0, \\dots, L\\}$，其概率质量函数（PMF）由以下公式给出：\n$$\n\\Pr(K=k \\mid j) = \\binom{L}{k} p_j^k (1-p_j)^{L-k}\n$$\n我们将为每个生物 $j \\in \\{1, \\dots, n+1\\}$ 和每个可能的 GC 计数 $k$ 计算这些概率。\n\n读段根据其每读段 GC 分数 $r = k/L$ 被分配到分类单元分箱中。分箱规则将读段分配给其特征 GC 概率与读段 GC 分数最接近的生物。分配的索引 $\\hat{\\imath}(r)$ 由以下公式确定：\n$$\n\\hat{\\imath}(r) = \\arg\\min_{j \\in \\{1, \\dots, n+1\\}} |r - p_j|\n$$\n该最小化过程中的平局通过选择最小的生物索引 $j$ 来解决。我们为从 $0$ 到 $L$ 的所有可能的整数值 $k$ 预先计算这个分配 $\\hat{\\imath}(k/L)$。\n\n**3. 指标计算**\n\n在确定了归一化丰度 $\\tilde{w}_j$、二项概率 $\\Pr(K=k \\mid j)$ 和分箱分配 $\\hat{\\imath}(k/L)$ 后，我们计算所需的四个指标。\n\n**整体期望准确率 (ACC)：**该指标表示从宏基因组中随机抽取的一条读段被正确分类的概率。它通过对每个生物的正确分类概率按其归一化丰度进行加权求和来计算。\n$$\n\\mathrm{ACC} = \\sum_{j=1}^{n+1} \\tilde{w}_j \\cdot P(\\text{correctly classified}|j) = \\sum_{j=1}^{n+1} \\tilde{w}_j \\left( \\sum_{k=0}^{L} \\Pr(K=k \\mid j) \\mathbf{1}\\!\\left[\\hat{\\imath}(k/L) = j\\right] \\right)\n$$\n其中 $\\mathbf{1}[\\cdot]$ 是指示函数，当条件为真时其值为 $1$，否则为 $0$。\n\n**隐匿生物分箱的阳性预测值 (PPV$_c$)：**隐匿生物分箱（索引为 $c$）的 PPV 是指被分配到隐匿生物分箱的读段真正来源于隐匿生物的概率。它是该分箱的真正例数与总（真和假）正例数之比。\n$$\n\\mathrm{PPV}_c = \\frac{\\text{Prob(is } c \\text{ AND binned as } c)}{\\text{Prob(binned as } c)} = \\frac{\\tilde{w}_{c} \\sum_{k=0}^{L} \\Pr(K=k \\mid c) \\, \\mathbf{1}\\!\\left[\\hat{\\imath}(k/L) = c\\right]}{\\sum_{j=1}^{n+1} \\tilde{w}_{j} \\sum_{k=0}^{L} \\Pr(K=k \\mid j) \\, \\mathbf{1}\\!\\left[\\hat{\\imath}(k/L) = c\\right]}\n$$\n如果分母为零（即，没有读段被分箱为 $c$），则 $\\mathrm{PPV}_c$ 定义为 $0$。\n\n**错分概率 ($m_{c \\to a}$ 和 $m_{c \\to b}$)：**这些是从隐匿生物 $c$ 来源的读段分别被错分到生物 $a$ 或生物 $b$ 分箱的总概率（其中 $a$ 和 $b$ 是两个丰度最高的原始生物的索引）。\n$$\nm_{c \\to a} = \\sum_{k=0}^{L} \\Pr(K=k \\mid c) \\mathbf{1}\\!\\left[\\hat{\\imath}(k/L) = a\\right]\n$$\n$$\nm_{c \\to b} = \\sum_{k=0}^{L} \\Pr(K=k \\mid c) \\mathbf{1}\\!\\left[\\hat{\\imath}(k/L) = b\\right]\n$$\n\n实现将对三个测试用例中的每一个应用此完整过程，并按要求将最终数值结果四舍入到 $6$ 位小数。", "answer": "[[0.963496,0.222343,0.36015,0.485601],[0.932909,0.518608,0.489376,0.510624],[0.96695,0.602888,0.375376,0.375376]]", "id": "2433879"}, {"introduction": "在这个综合性的编程实践中，你将构建一个两阶段的混合分箱器，它首先使用快速的 $k$-mer 相似性搜索来筛选候选分类，然后通过更精确但计算密集的蛋白质域对齐进行验证 [@problem_id:2433908]。这个练习模拟了真实生物信息学工具的设计哲学——在速度和准确性之间寻求最佳平衡，让你掌握构建复杂分析流程的实践技能。", "problem": "给定一个有限的分类单元集合，每个分类单元由一条脱氧核糖核酸（DNA）参考序列和一个蛋白质域特征序列定义。您必须实现一个两阶段决策函数，该函数将每个输入的 DNA 读段映射到一个唯一的分类单元索引或一个未分配值。所有步骤都必须严格按照下文定义实现，且仅能使用所提供的参数和定义。DNA 的字母表为 $\\{A,C,G,T\\}$，蛋白质的字母表为 $20$ 种标准氨基酸外加终止符号 $*$。\n\n阶段 1 (快速集合相似度预筛选)：对于一个 DNA 字符串 $s$ 和一个正整数 $k$，将 $k$-mer 集合 $K(s,k)$ 定义为 $s$ 中所有长度为 $k$ 的子串的集合（包括重叠子串）。对于一个读段 $r$ 和一个参考基因组 $g_i$，定义 Jaccard 相似度\n$$\nJ_k(r,g_i) \\coloneqq \\frac{\\lvert K(r,k)\\cap K(g_i,k)\\rvert}{\\lvert K(r,k)\\cup K(g_i,k)\\rvert}.\n$$\n给定一个阈值 $\\tau_k$ 和一个最大候选数量 $m$，为读段 $r$ 定义候选集 $C(r)$ 如下：\n- 对每个分类单元索引 $i$ 计算 $J_k(r,g_i)$。\n- 令 $S_{\\ge}(r) \\coloneqq \\{ i : J_k(r,g_i) \\ge \\tau_k \\}$。如果 $\\lvert S_{\\ge}(r)\\rvert = 0$，则将 $C(r)$ 设为具有最大 $J_k(r,g_i)$ 值的 $m$ 个索引的集合，若值相同则优先选择较小的索引。否则，将 $C(r)$ 设为 $S_{\\ge}(r)$ 中具有最大 $J_k(r,g_i)$ 值的最多 $m$ 个索引的子集，若值相同则优先选择较小的索引。如果 $\\lvert S_{\\ge}(r)\\rvert < m$，则 $\\lvert C(r)\\rvert = \\lvert S_{\\ge}(r)\\rvert$。\n\n阶段 2 (通过局部比对进行慢速域级别验证)：将 DNA 读段 $r$ 的翻译 $\\mathcal{T}(r)$ 定义为使用标准遗传密码和三核苷酸密码子长度，从其第一个核苷酸开始沿正向翻译得到的氨基酸序列，忽略任何尾部不完整的密码子（如果 $r$ 的长度不能被 3 整除）。终止密码子翻译为 $*$，并且 $*$ 被视为一个字面字符。令 $d_i$ 为分类单元 $i$ 的蛋白质域特征序列。\n\n对于两个蛋白质字符串 $x$ 和 $y$，使用以下线性计分方法定义 Smith–Waterman 局部比对得分 $SW(x,y)$：\n- 匹配得分 $s_{\\mathrm{match}} = +2$，\n- 错配得分 $s_{\\mathrm{mismatch}} = -1$，\n- 空位罚分 $s_{\\mathrm{gap}} = -2$ （每个空位符号），\n以及动态规划递推式\n$$\nH_{a,b} \\coloneqq \\max\\Big(0,\\ H_{a-1,b-1} + \\sigma(x_a,y_b),\\ H_{a-1,b} + s_{\\mathrm{gap}},\\ H_{a,b-1} + s_{\\mathrm{gap}}\\Big),\n$$\n其中对于所有的 $a,b$，有 $H_{0,b} = 0$ 和 $H_{a,0} = 0$，并且\n$$\n\\sigma(u,v) \\coloneqq\n\\begin{cases}\ns_{\\mathrm{match}} & \\text{if } u=v,\\\\\ns_{\\mathrm{mismatch}} & \\text{if } u\\ne v.\n\\end{cases}\n$$\n局部比对得分是 $\\max_{a,b} H_{a,b}$。\n\n分配规则：对于一个读段 $r$，计算 $x=\\mathcal{T}(r)$，并对 $C(r)$ 中的每个 $i$ 计算 $SW(x,d_i)$。令 $i^\\star$ 为 $C(r)$ 中具有最大 $SW(x,d_i)$ 的索引；若值相同则选择较小的索引。给定一个域得分阈值 $\\tau_d$，如果 $SW(x,d_{i^\\star}) \\ge \\tau_d$，则输出 $i^\\star$；否则输出 $-1$。\n\n所有索引都是从零开始的整数。未分配值为整数 $-1$。\n\n所有计算中使用的参数：\n- $k = 3$,\n- $\\tau_k = 0.2$,\n- $m = 2$,\n- $s_{\\mathrm{match}} = +2$,\n- $s_{\\mathrm{mismatch}} = -1$,\n- $s_{\\mathrm{gap}} = -2$,\n- $\\tau_d = 4$.\n\n分类单元和序列：\n- 分类单元 $0$：参考基因组 $g_0 = \\texttt{ATGGCCATTGTAATGGGCCGCTGAAAGGGTGCCCGATAG}$，蛋白质域 $d_0 = \\texttt{MAIVMGRKG}$。\n- 分类单元 $1$：参考基因组 $g_1 = \\texttt{ATGGCGGCTGCTGCTGAAAACCCGTTGAATGCCGCCGAA}$，蛋白质域 $d_1 = \\texttt{MAAAAAK}$。\n- 分类单元 $2$：参考基因组 $g_2 = \\texttt{TTGAAACCCGGGTTTAAACCCGGGTTTAAAGGGCCCAA}$，蛋白质域 $d_2 = \\texttt{MKTLLILAL}$。\n\n遗传密码：使用标准遗传密码，从核苷酸位置 1 开始在正向读码框中进行翻译；忽略任何不构成完整密码子的尾部 1 或 2 个核苷酸。\n\n测试集 (读段)：\n- 读段 $r_1 = \\texttt{ATGGCCATTGTAATGGGCCGCTG}$,\n- 读段 $r_2 = \\texttt{ATGGCGGCTGCTGCT}$,\n- 读段 $r_3 = \\texttt{TTTTTTTTTTTTTTT}$,\n- 读段 $r_4 = \\texttt{ATGGCC}$.\n\n您的程序必须按 $(r_1,r_2,r_3,r_4)$ 的顺序处理这些读段，并生成一行输出，其中包含一个用方括号括起来的、以逗号分隔的整数分配列表（例如，$\\texttt{[0,1,-1,0]}$）。对于每个读段，唯一允许的输出是 $-1$、$0$、$1$ 或 $2$。", "solution": "该任务指定了一个将每个 DNA 读段映射到一个分类单元索引或未分配值的两阶段映射。解决方案通过将每个阶段形式化，并将其确定性地应用于所提供的输入来展开。\n\n阶段 1 形式化：对于固定的 $k=3$，$k$-mer 集合 $K(s,3)$ 包含 $s$ 中所有长度为 3 的连续子串。Jaccard 相似度为 $J_3(r,g_i) = \\lvert K(r,3)\\cap K(g_i,3)\\rvert / \\lvert K(r,3)\\cup K(g_i,3)\\rvert$。对于每个读段 $r$，我们为 $i\\in\\{0,1,2\\}$ 计算 $J_3(r,g_i)$。我们定义集合 $S_{\\ge}(r)=\\{i: J_3(r,g_i)\\ge \\tau_k\\}$，其中 $\\tau_k = 0.2$。如果 $\\lvert S_{\\ge}(r)\\rvert = 0$，则 $C(r)$ 包含具有最大 $J_3(r,g_i)$ 值的 $m=2$ 个索引，若值相同则选择较小的索引。否则，$C(r)$ 包含 $S_{\\ge}(r)$ 中具有最大 $J_3(r,g_i)$ 值的最多 $m$ 个索引，若值相同则选择较小的索引；如果 $S_{\\ge}(r)$ 中索引数量少于 $m$ 个，则全部包含在内。\n\n阶段 2 形式化：我们使用标准遗传密码，从第一个核苷酸开始，在正向读码框中翻译每个 DNA 读段，并忽略任何尾部不完整的密码子。这会得到 $x=\\mathcal{T}(r)$。对于每个候选 $i\\in C(r)$，我们使用递推式计算 Smith–Waterman 局部比对得分 $SW(x,d_i)$：\n$$\nH_{a,b} = \\max\\left(0,\\,H_{a-1,b-1} + \\sigma(x_a,y_b),\\,H_{a-1,b} + s_{\\mathrm{gap}},\\,H_{a,b-1} + s_{\\mathrm{gap}}\\right),\n$$\n其中 $y=d_i$，$s_{\\mathrm{match}}=+2$，$s_{\\mathrm{mismatch}}=-1$，以及 $s_{\\mathrm{gap}}=-2$。计分函数 $\\sigma(u,v)$ 在 $u=v$ 时为 $+2$，否则为 $-1$。局部得分是 $\\max_{a,b} H_{a,b}$。我们找出使 $SW(x,d_i)$ 最大化的 $i^\\star\\in C(r)$，若值相同则选择较小的索引。给定 $\\tau_d=4$，如果 $SW(x,d_{i^\\star})\\ge 4$，我们分配 $i^\\star$；否则我们输出 $-1$。\n\n应用于给定的测试集：\n\n- 读段 $r_1 = \\texttt{ATGGCCATTGTAATGGGCCGCTG}$。在正向读码框中翻译得到 $\\mathcal{T}(r_1) = \\texttt{MAIVMGR}$，因为密码子是 $\\texttt{ATG}\\to \\texttt{M}$、$\\texttt{GCC}\\to \\texttt{A}$、$\\texttt{ATT}\\to \\texttt{I}$、$\\texttt{GTA}\\to \\texttt{V}$、$\\texttt{ATG}\\to \\texttt{M}$、$\\texttt{GGC}\\to \\texttt{G}$、$\\texttt{CGC}\\to \\texttt{R}$，尾部的 $\\texttt{TG}$ 被忽略。由于 $r_1$ 是 $g_0$ 的子串，$r_1$ 的 $3$-mer 集合与 $K(g_0,3)$ 有大量重叠，因此 $J_3(r_1,g_0)$ 相对于 $J_3(r_1,g_1)$ 和 $J_3(r_1,g_2)$ 很大。所以 $0\\in C(r_1)$，且 $C(r_1)$ 最多将包含另一个索引。局部比对 $SW(\\texttt{MAIVMGR}, \\texttt{MAIVMGRKG})$ 产生了一个长度为 7 的完美连续匹配，得分为 $7\\times 2=14$。与 $d_1=\\texttt{MAAAAAK}$ 或 $d_2=\\texttt{MKTLLILAL}$ 的任何比对最多是一个短的前缀匹配；对于 $d_1$，最佳连续匹配是 $\\texttt{MA}$，得分为 $2\\times 2=4$；对于 $d_2$，最多是 $\\texttt{M}$，得分为 2。因此 $i^\\star=0$ 且 $SW\\ge 4$，所以分配结果为 $0$。\n\n- 读段 $r_2 = \\texttt{ATGGCGGCTGCTGCT}$。翻译得到 $\\mathcal{T}(r_2)=\\texttt{MAAAA}$，来自 $\\texttt{ATG}\\to \\texttt{M}$、$\\texttt{GCG}\\to \\texttt{A}$、$\\texttt{GCT}\\to \\texttt{A}$、$\\texttt{GCT}\\to \\texttt{A}$、$\\texttt{GCT}\\to \\texttt{A}$。其 $3$-mer 内容与 $K(g_1,3)$ 的重叠比与 $K(g_0,3)$ 或 $K(g_2,3)$ 更强，因此 $1\\in C(r_2)$（可能由于 $m=2$ 而有另一个索引）。比对 $SW(\\texttt{MAAAA}, \\texttt{MAAAAAK})$ 产生一个长度为 5 的连续匹配，得分为 10。与 $d_0$ 或 $d_2$ 的比对由于共享前缀较短，得分最多为 4 或更低。因此 $i^\\star=1$，得分为 $10 \\ge 4$，所以分配结果为 $1$。\n\n- 读段 $r_3 = \\texttt{TTTTTTTTTTTTTTT}$。翻译产生 $\\mathcal{T}(r_3)=\\texttt{FFFFF}$，因为 $\\texttt{TTT}\\to \\texttt{F}$ 重复出现。其 $3$-mer 集合 $K(r_3,3)=\\{\\texttt{TTT}\\}$ 与 $K(g_0,3)$ 和 $K(g_1,3)$ 的重叠极少，如果 $\\texttt{TTT}$ 出现，则与 $K(g_2,3)$ 有一些重叠，但无论 $C(r_3)$ 的构成如何（受 $m=2$ 限制），对于 $i\\in C(r_3)$ 的局部比对得分 $SW(\\texttt{FFFFF}, d_i)$ 均为 $0$，因为 $d_0=\\texttt{MAIVMGRKG}$、$d_1=\\texttt{MAAAAAK}$ 和 $d_2=\\texttt{MKTLLILAL}$ 都不包含 $\\texttt{F}$，任何比对都会累积错配和空位，在以 0 为下限的局部比对递推式下是没有益处的。因此，最佳得分为 $0 < \\tau_d$，分配结果为 $-1$。\n\n- 读段 $r_4 = \\texttt{ATGGCC}$。翻译得到 $\\mathcal{T}(r_4)=\\texttt{MA}$。$r_4$ 的 $3$-mer 是 $\\{\\texttt{ATG},\\texttt{TGG},\\texttt{GGC},\\texttt{GCC}\\}$，它们与 $K(g_0,3)$ 和 $K(g_1,3)$ 都有重叠，因此在应用 $m=2$ 上限和 $\\tau_k$ 阈值后，$C(r_4)$ 将包含索引 $\\{0,1\\}$。局部比对得分 $SW(\\texttt{MA}, \\texttt{MAIVMGRKG})$ 和 $SW(\\texttt{MA}, \\texttt{MAAAAAK})$ 通过匹配前缀 $\\texttt{MA}$ 都达到了 4 分，而 $SW(\\texttt{MA}, \\texttt{MKTLLILAL})$ 则更小。因此，在最大得分上，索引 0 和 1 之间出现了平局，平局决胜规则选择了较小的索引 0。由于 $4 \\ge \\tau_d$，分配结果为 $0$。\n\n按 $(r_1,r_2,r_3,r_4)$ 的顺序收集这些结果，得到最终列表 $[0,1,-1,0]$。", "answer": "[0,1,-1,0]", "id": "2433908"}]}