{"hands_on_practices": [{"introduction": "贝叶斯系统发育分析的核心产出是来自后验分布的树集样本。一项基本且关键的实践任务是评估对特定进化关系（即进化枝）的支持度。本练习将指导您如何通过处理马尔可夫链蒙特卡洛（MCMC）样本来计算一个特定进化枝的后验概率，这是解释系统发育推断结果的基础技能。[@problem_id:2415452]", "problem": "对一个分子序列比对进行的贝叶斯系统发育分析，在指定的替换模型和先验条件下，通过马尔可夫链蒙特卡洛 (MCMC) 方法产生了一个包含 $10000$ 棵有根树的后验样本。最大后验 (MAP) 树是在采样状态中具有最高后验概率的单棵树 $T^{\\ast}$。现考虑一个由一组固定的分类单元定义的特定单系群 $C$。这个单系群 $C$ 并不存在于 MAP 树 $T^{\\ast}$ 中。MCMC 被诊断为在迭代 $2000$ 次后达到平稳性，前 $2000$ 棵树作为预烧期 (burn-in) 被丢弃。为了减少自相关性，从剩余的 $8000$ 棵树中每隔 $5$ 棵树保留一棵，从而得到一个包含 $1600$ 棵树的后验样本。在这个保留的样本中，单系群 $C$ 恰好出现在 $482$ 棵树中。请仅使用这个保留的后验样本，计算单系群 $C$ 在给定数据 $D$ 下的后验概率 $\\Pr(C \\mid D)$。将您的答案表示为小数，并四舍五入到 $4$ 位有效数字。", "solution": "该问题要求计算一个单系群（或称支系）$C$ 在给定一组分子序列数据 $D$ 下的后验概率。这个量表示为 $\\Pr(C \\mid D)$。\n\n在贝叶斯系统发育学的框架中，推断的核心对象是系统发育树的后验概率分布 $\\Pr(T \\mid D)$，其中 $T$ 代表一棵树的拓扑结构及其相关的枝长。该分布通过贝叶斯定理获得：\n$$\n\\Pr(T \\mid D) = \\frac{\\Pr(D \\mid T) \\Pr(T)}{\\Pr(D)}\n$$\n其中 $\\Pr(D \\mid T)$ 是给定树时数据的似然，$\\Pr(T)$ 是树的先验概率，$\\Pr(D)$ 是边缘似然，一个归一化常数。\n\n树的某个特定特征（例如支系 $C$）的后验概率定义为所有包含该特征的树的后验概率之和。这对应于对后验分布进行边缘化。如果我们设 $I(C \\in T)$ 为一个指示函数，当树 $T$ 包含支系 $C$ 时其值为 $1$，否则为 $0$，那么 $C$ 的后验概率由该指示函数在后验分布上的期望给出：\n$$\n\\Pr(C \\mid D) = \\int I(C \\in T) \\Pr(T \\mid D) \\, dT\n$$\n对所有可能树的巨大空间进行积分，在计算上是难以解析求解的。因此，通常使用通过马尔可夫链蒙特卡洛 (MCMC) 算法从后验分布 $\\Pr(T \\mid D)$ 中抽取的一组样本来近似这个积分。\n\n马尔可夫链的遍历定理指出，对于一个足够长的链，采样序列中某个状态的频率会收敛到其在平稳分布中的真实概率。因此，支系 $C$ 的后验概率可以估计为 MCMC 样本中包含 $C$ 的树的比例。\n\n问题提供了关于 MCMC 模拟的以下细节：\n- 初始的 MCMC 运行产生了 $10000$ 棵树的样本。\n- 前 $2000$ 棵树作为预烧期 (burn-in) 被丢弃。这是一个标准步骤，以确保样本是从马尔可夫链的平稳分布中抽取的。\n- 预烧期后剩余的树的数量是 $10000 - 2000 = 8000$。\n- 为了减少连续样本间的自相关性，对链进行了稀疏化处理，每隔 $5$ 棵树保留一棵。\n- 最终的有效后验样本包含 $N = \\frac{8000}{5} = 1600$ 棵树。\n\n问题指出，在这个包含 $1600$ 棵树的最终样本中，支系 $C$ 恰好存在于 $N_C = 482$ 棵树中。\n\n支系 $C$ 的后验概率估计值即为其在该最终样本中出现的频率：\n$$\n\\Pr(C \\mid D) \\approx \\frac{N_C}{N} = \\frac{482}{1600}\n$$\n关于支系 $C$ 不存在于最大后验 (MAP) 树 $T^{\\ast}$ 中的信息与此计算无关。MAP 树是对应于后验分布众数的单点估计。然而，一个支系的后验概率是一个边缘概率，它代表了所有包含该支系的树的总概率质量。在系统发育推断中，一个支系具有显著的后验概率（例如，大于 $0.5$）但却不存在于 MAP 树中是常见现象，特别是当后验分布分散在多个具有相似概率的冲突拓扑上时。\n\n进行计算：\n$$\n\\frac{482}{1600} = 0.30125\n$$\n问题要求答案以小数形式表示，并四舍五入到 $4$ 位有效数字。前四位有效数字是 $3$、$0$、$1$ 和 $2$。第五位是 $5$，所以我们将第四位数字向上取整。这得到：\n$$\n\\Pr(C \\mid D) \\approx 0.3013\n$$", "answer": "$$\\boxed{0.3013}$$", "id": "2415452"}, {"introduction": "除了评估单个进化枝的可信度，我们还可以利用后验样本来检验更复杂的演化假说，例如一个类群是否为并系群。这个练习展示了如何将一个抽象的系统发育概念（并系）转化为一个可在 MCMC 样本中被量化的具体事件。通过这种方式，我们可以计算出支持特定演化情景的后验概率。[@problem_id:2415499]", "problem": "您正在分析来自四个分类单元的DNA序列数据 $\\mathcal{D}$：三个内群物种 $A$、$B$ 和 $C$（统称为 $G=\\{A,B,C\\}$），以及一个焦点分类单元 $O$。您在一个时间可逆的替换模型下，使用严格分子钟和确定根的化石校准，进行贝叶斯系统发育推断，并且您对这四个分类单元的所有有根二叉拓扑结构设置了均匀先验。在舍弃预烧期 (burn-in)并确认收敛后，您使用马尔可夫链蒙特卡洛（MCMC (Markov Chain Monte Carlo)）方法，得到了一个包含 $N=2000$ 棵有根树的等权重后验样本。\n\n定义事件 $E$ 为：“$G$ 相对于 $O$ 是并系的”，意即 $A$、$B$ 和 $C$ 的最近共同祖先以 $O$ 为一个后代（等价地，包含 $A$、$B$ 和 $C$ 的最小演化支也包含 $O$）。\n\n您的 MCMC 样本可以被划分为以下互斥且穷尽的类别，其计数如下：\n- $1200$ 棵树，$G$ 是单系的，且 $O$ 在包含 $A$、$B$ 和 $C$ 的演化支之外。\n- $400$ 棵树，$O$ 与 $A$ 在由 $A$、$B$ 和 $C$ 的最近共同祖先所界定的演化支内部形成一个演化支。\n- $280$ 棵树，$O$ 与 $B$ 在由 $A$、$B$ 和 $C$ 的最近共同祖先所界定的演化支内部形成一个演化支。\n- $120$ 棵树，$O$ 与 $C$ 在由 $A$、$B$ 和 $C$ 的最近共同祖先所界定的演化支内部形成一个演化支。\n\n从树的贝叶斯后验的定义以及将后验概率解释为在该后验下的期望值出发，推导后验概率 $\\Pr(E \\mid \\mathcal{D})$ 的表达式，并使用提供的 MCMC 样本进行计算。将最终答案以小数形式表示，并四舍五入到四位有效数字。不要使用百分号。", "solution": "我们从给定分类单元上的有根二叉树的离散空间 $\\mathcal{T}$ 的贝叶斯定理开始。对于任何树 $T \\in \\mathcal{T}$，\n$$\n\\Pr(T \\mid \\mathcal{D}) \\propto \\Pr(\\mathcal{D} \\mid T)\\,\\Pr(T),\n$$\n其中比例常数由模型证据给出。在所述的对有根二叉拓扑结构的均匀先验下，并且分支长度在其先验下被积分掉，这定义了在 $\\mathcal{T}$ 上的后验概率质量函数。\n\n对于一个事件 $E \\subseteq \\mathcal{T}$，其后验概率是指示函数 $I_{E}(T)$ 的后验期望，\n$$\n\\Pr(E \\mid \\mathcal{D}) \\;=\\; \\sum_{T \\in \\mathcal{T}} I_{E}(T)\\,\\Pr(T \\mid \\mathcal{D}) \\;=\\; \\mathbb{E}_{T \\sim \\Pr(\\cdot \\mid \\mathcal{D})}\\!\\big[I_{E}(T)\\big],\n$$\n其中如果 $T \\in E$，则 $I_{E}(T)=1$，否则 $I_{E}(T)=0$。\n\n马尔可夫链蒙特卡洛（MCMC）方法通过蒙特卡洛积分提供了对该期望的经验近似。给定从 $\\Pr(\\cdot \\mid \\mathcal{D})$ 中抽取的等权重后验样本 $\\{T_{i}\\}_{i=1}^{N}$，$\\Pr(E \\mid \\mathcal{D})$ 的蒙特卡洛估计量为\n$$\n\\widehat{\\Pr}(E \\mid \\mathcal{D}) \\;=\\; \\frac{1}{N}\\sum_{i=1}^{N} I_{E}(T_{i}) \\;=\\; \\frac{\\#\\{i: T_{i} \\in E\\}}{N}.\n$$\n\n根据问题的定义，事件 $E$ 发生当且仅当 $O$ 是 $A$、$B$ 和 $C$ 的最近共同祖先的后代，即 $O$ 嵌套在包含 $A$、$B$ 和 $C$ 的最小演化支内。在所提供的分类中，事件 $E$ 精确对应于 $O$ 与 $A$、$B$ 或 $C$ 中的一个在由 $A$、$B$ 和 $C$ 的最近共同祖先所界定的演化支内部形成演化支的三种类别。\n\n设 $n_{AO}$、$n_{BO}$ 和 $n_{CO}$ 分别表示 $O$ 与 $A$、$B$ 和 $C$ 形成演化支的树的计数，并设 $n_{\\text{mono}}$ 表示 $G$ 是单系且 $O$ 在外的树的计数。我们已知\n$$\nn_{\\text{mono}} = 1200,\\quad n_{AO} = 400,\\quad n_{BO} = 280,\\quad n_{CO} = 120,\\quad N=2000.\n$$\n满足 $E$ 的样本数量为\n$$\nn_{E} \\;=\\; n_{AO} + n_{BO} + n_{CO} \\;=\\; 400 + 280 + 120 \\;=\\; 800.\n$$\n因此，\n$$\n\\widehat{\\Pr}(E \\mid \\mathcal{D}) \\;=\\; \\frac{n_{E}}{N} \\;=\\; \\frac{800}{2000} \\;=\\; 0.4.\n$$\n\n按要求四舍五入到四位有效数字，得到 $0.4000$。", "answer": "$$\\boxed{0.4000}$$", "id": "2415499"}, {"introduction": "虽然进化枝的后验概率揭示了对树的特定部分的置信度，但我们常常需要一个全局指标来概括整个拓扑结构空间上的总体不确定性。香农熵 ($H$) 是源自信息论的一个强大工具，可以用来量化这种不确定性。本练习将教您如何计算拓扑结构后验分布的熵，从而对系统发育分析结果的明确性或模糊性得出一个单一的、可解释的度量。[@problem_id:2415418]", "problem": "对四个分类单元进行了一次贝叶斯系统发育分析，得到了一个关于三种可能的无根、完全解析的树拓扑（记为 $T_{1}$、$T_{2}$ 和 $T_{3}$）的后验分布。在对分支长度和替换模型参数进行积分后，这些拓扑的边缘后验概率为：\n$p(T_{1}) = 0.60$，$p(T_{2}) = 0.25$ 和 $p(T_{3}) = 0.15$。\n将此视为关于树拓扑的离散后验分布。使用自然对数计算该分布的香农熵 $H$，即以奈特 (nats) 为单位进行度量。最终结果以纯数（无量纲）形式报告，并四舍五入到 $4$ 位有效数字。", "solution": "该问题要求计算一个给定离散概率分布的香农熵。该分布描述了三种不同的无根系统发育树拓扑（记为 $T_{1}$、$T_{2}$ 和 $T_{3}$）的后验概率。给定的概率为 $p(T_{1}) = 0.60$，$p(T_{2}) = 0.25$ 和 $p(T_{3}) = 0.15$。这些概率的总和为 $0.60 + 0.25 + 0.15 = 1.00$，这证实了它是一个有效的概率质量函数。\n\n对于一个具有可能结果集 $\\{x_1, x_2, \\dots, x_n\\}$ 及相应概率 $p(x_i)$ 的离散随机变量，其香农熵 $H$ 定义为以下公式：\n$$ H = - \\sum_{i=1}^{n} p(x_i) \\log_{b} p(x_i) $$\n在本问题中，熵以奈特 (nats) 为单位度量，这意味着使用自然对数（以 $e$ 为底）。因此，公式变为：\n$$ H = - \\sum_{i=1}^{n} p(x_i) \\ln(p(x_i)) $$\n\n对于给定的这三种拓扑及其后验概率，熵的计算如下：\n$$ H = - \\left[ p(T_{1})\\ln(p(T_{1})) + p(T_{2})\\ln(p(T_{2})) + p(T_{3})\\ln(p(T_{3})) \\right] $$\n代入概率的数值：\n$$ H = - \\left[ 0.60 \\ln(0.60) + 0.25 \\ln(0.25) + 0.15 \\ln(0.15) \\right] $$\n括号内的各项分别为：\n$$ 0.60 \\ln(0.60) \\approx 0.60 \\times (-0.5108256) \\approx -0.30649536 $$\n$$ 0.25 \\ln(0.25) \\approx 0.25 \\times (-1.3862944) \\approx -0.34657360 $$\n$$ 0.15 \\ln(0.15) \\approx 0.15 \\times (-1.8971200) \\approx -0.28456800 $$\n将这些值相加，得到括号内的总和：\n$$ \\sum_{i=1}^{3} p(T_{i}) \\ln(p(T_{i})) \\approx -0.30649536 - 0.34657360 - 0.28456800 \\approx -0.93763696 $$\n熵 $H$ 是该总和的负值：\n$$ H = -(-0.93763696) \\approx 0.93763696 $$\n问题要求最终答案以纯数形式报告，并四舍五入到 $4$ 位有效数字。前四位有效数字是 $9, 3, 7, 6$。第五位有效数字是 $3$，小于 $5$，因此无需进位。\n因此，四舍五入到 $4$ 位有效数字后的熵为 $0.9376$。", "answer": "$$\\boxed{0.9376}$$", "id": "2415418"}]}