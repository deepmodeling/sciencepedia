{"hands_on_practices": [{"introduction": "本练习通过一个思想实验探索了模型拓扑结构如何决定比对结果。通过将一个关键的转移概率设置为零，您将探究维特比算法如何响应这种“硬”约束，这有助于加深对模型参数如何直接塑造最优路径的理解。这个练习强调了转移概率在定义比对的允许结构中的重要作用。 [@problem_id:2411626]", "problem": "考虑一个用于双序列比对的标准配对隐马尔可夫模型 (HMM)，它有三个发射状态：匹配 $M$、在 $X$ 中插入（记为 $X$）以及在 $Y$ 中插入（记为 $Y$）。匹配状态 $M$ 发射一对符号 $(x_i,y_j)$，状态 $X$ 发射一个与 $Y$ 中的一个空位对齐的符号 $x_i$，状态 $Y$ 发射一个与 $X$ 中的一个空位对齐的符号 $y_j$。此外，还有只在比对的开始和结束时出现的静默开始状态 $B$ 和结束状态 $E$。令 $a_{s,t}$ 表示从状态 $s$ 到状态 $t$ 的转移概率，令 $e_M(x_i,y_j)$、$e_X(x_i)$、$e_Y(y_j)$ 表示相应状态下的发射概率。假设对于每个发射状态 $s \\in \\{M,X,Y\\}$，其出射转移概率满足 $\\sum_{t \\in \\{M,X,Y,E\\}} a_{s,t} = 1$，并且所有有效符号的发射概率都严格为正。假设从匹配状态到其自身的转移概率被设为 $a_{M,M} = 0$，而 $\\{M,X,Y\\}$ 之间以及从这些状态到 $E$ 的所有其他转移概率保持严格为正且不变。\n\n在这些条件下，对于给定的两个序列，这对 Viterbi 比对（即最大后验状态路径及其蕴含的比对）有什么影响？\n\nA. Viterbi 路径永远不会进入匹配状态 $M$，因此比对只包含空位，无法比对任何符号对。\n\nB. Viterbi 路径中匹配状态 $M$ 的任何出现都必须是孤立的；不可能出现连续两次匹配，因此任何两个比对上的符号对都必须由至少一个空位状态隔开。\n\nC. Viterbi 比对不受影响，因为当发射概率占主导时，最可能路径会忽略自转移概率。\n\nD. 该模型仍然可以通过将静默的开始或结束状态作为桥梁进行路由来产生连续的匹配，因此连续匹配仍然是可能的。\n\nE. 由于零转移概率的存在，Viterbi 动态规划变得不适定，因此无法计算出最优路径。", "solution": "在尝试任何解答之前，必须首先验证问题陈述的正确性和清晰度。\n\n### 步骤 1：提取已知条件\n该问题描述了一个用于双序列比对的配对隐马尔可夫模型 (HMM)，其包含以下组成部分和条件：\n- **状态**：三个发射状态：匹配 ($M$)、在序列 $X$ 中插入 ($X$)、以及在序列 $Y$ 中插入 ($Y$)。两个静默状态：开始 ($B$) 和结束 ($E$)。\n- **发射**：\n    - 状态 $M$ 发射一对符号 $(x_i, y_j)$。发射概率为 $e_M(x_i,y_j)$。\n    - 状态 $X$ 发射一个符号 $x_i$（与空位对齐）。发射概率为 $e_X(x_i)$。\n    - 状态 $Y$ 发射一个符号 $y_j$（与空位对齐）。发射概率为 $e_Y(y_j)$。\n- **转移**：\n    - 从状态 $s$ 到状态 $t$ 的转移概率记为 $a_{s,t}$。\n    - 对于每个发射状态 $s \\in \\{M,X,Y\\}$，其出射转移概率总和为一：$\\sum_{t \\in \\{M,X,Y,E\\}} a_{s,t} = 1$。\n- **概率约束**：\n    - 所有有效符号的发射概率都严格为正。\n    - 从匹配状态到其自身的转移概率被设为零：$a_{M,M} = 0$。\n    - $\\{M,X,Y\\}$ 之间以及从这些状态到 $E$ 的所有其他转移概率保持严格为正。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据验证标准对问题陈述进行评估。\n- **科学依据**：该问题基于标准的配对 HMM 框架，这是计算生物学和生物信息学中序列比对的基石。所描述的模型是一个简化但标准的版本（例如，“三状态配对 HMM”）。其前提是科学合理的。\n- **适定性**：问题询问一个特定参数变化（$a_{M,M} = 0$）对 Viterbi 算法输出的影响。这是一个定义明确的问题，在 HMM 框架内有唯一的逻辑推论。\n- **客观性**：语言精确，没有主观性。所有术语都是该领域的标准术语。\n- **完整性与一致性**：模型描述充分。约束 $a_{M,M}=0$ 是对一个标准模型的特定、一致的修改。其他转移概率保持为正的事实确保了模型不会变得无意义或不连通。\n- **现实性**：将转移概率设为零是一种有效的建模选择，通常用于在比对上强制施加某些结构性约束。这是一个现实的理论练习。\n\n### 步骤 3：结论与行动\n问题陈述是**有效的**。这是一个关于标准生物信息学算法属性的、定义明确且有科学依据的问题。我将继续推导解决方案。\n\n###\n### 解答推导\nViterbi 算法旨在找到能够生成给定序列对 $(x_1...x_L, y_1...y_N)$ 的最可能的状态路径（Viterbi 路径）。特定路径 $\\pi = (\\pi_1, \\pi_2, ..., \\pi_K)$ 及相应观测序列的概率由以下公式给出：\n$$P(\\text{sequences}, \\pi) = a_{B,\\pi_1} \\prod_{k=1}^{K-1} a_{\\pi_k, \\pi_{k+1}} \\prod_{k=1}^{K} P(\\text{emission}_k | \\pi_k)$$\n其中最后的转移是到结束状态 $E$，即 $\\pi_K \\rightarrow E$。为简洁起见，这可以写成 $a_{\\pi_K, E}$。\n\nViterbi 算法使用动态规划来找到使此概率最大化的路径 $\\pi^*$。令 $V_s(i, j)$ 为生成了前缀 $x_1...x_i$ 和 $y_1...y_j$ 且结束于状态 $s \\in \\{M, X, Y\\}$ 的最可能路径的概率。这些分数的递推关系如下：\n\n对于位置 $(i,j)$ 处的匹配状态 $M$：\n$$V_M(i,j) = e_M(x_i, y_j) \\times \\max \\begin{cases} V_M(i-1, j-1) \\cdot a_{M,M} \\\\ V_X(i-1, j-1) \\cdot a_{X,M} \\\\ V_Y(i-1, j-1) \\cdot a_{Y,M} \\end{cases}$$\n\n对于位置 $(i,j)$ 处的空位状态 $X$：\n$$V_X(i,j) = e_X(x_i) \\times \\max \\begin{cases} V_M(i-1, j) \\cdot a_{M,X} \\\\ V_X(i-1, j) \\cdot a_{X,X} \\\\ V_Y(i-1, j) \\cdot a_{Y,X} \\end{cases}$$\n\n对于位置 $(i,j)$ 处的空位状态 $Y$：\n$$V_Y(i,j) = e_Y(y_j) \\times \\max \\begin{cases} V_M(i, j-1) \\cdot a_{M,Y} \\\\ V_X(i, j-1) \\cdot a_{X,Y} \\\\ V_Y(i, j-1) \\cdot a_{Y,Y} \\end{cases}$$\n计算从初始状态开始，其中 $V_B(0,0)=1$。\n\n问题陈述指出，匹配状态的自转移概率为零：$a_{M,M} = 0$。我们必须分析此约束对 Viterbi 路径的后果。\n\n我们来检查 $V_M(i,j)$ 的递推关系：\n$$V_M(i,j) = e_M(x_i, y_j) \\times \\max \\begin{cases} V_M(i-1, j-1) \\cdot 0 \\\\ V_X(i-1, j-1) \\cdot a_{X,M} \\\\ V_Y(i-1, j-1) \\cdot a_{Y,M} \\end{cases}$$\n项 $V_M(i-1, j-1) \\cdot a_{M,M}$ 变为 $V_M(i-1, j-1) \\cdot 0 = 0$。这意味着通过在 $(i-1,j-1)$ 的状态 $M$ 到达在 $(i,j)$ 的状态 $M$ 的路径，其概率贡献恒为 $0$。\n\nViterbi 算法旨在最大化路径概率。除非所有进入状态 $M$ 的可能路径的概率都为零（但事实并非如此，因为 $a_{X,M} > 0$ 且 $a_{Y,M} > 0$），否则该算法永远不会选择从 $M$ 到 $M$ 的转移作为最优路径的一部分。最可能的路径，即 Viterbi 路径，是一个状态序列 $\\pi^* = (\\pi_1^*, \\pi_2^*, ... , \\pi_K^*)$。条件 $a_{M,M}=0$ 意味着此路径中任何两个连续的状态都不可能同为 $M$，即 $\\pi_k^*=M$ 和 $\\pi_{k+1}^*=M$ 不可能同时发生。\n\n就比对而言，状态 $M$ 对应于一对对齐的符号。连续两次匹配的序列将对应于子路径 $M \\to M$。由于此转移的概率为 $0$，任何包含它的路径的总概率也为 $0$。Viterbi 算法会舍弃这样的路径，转而选择任何存在非零概率的路径。\n\n因此，Viterbi 路径中匹配状态 $M$ 的任何出现都必须被一个不同的状态所前后跟随。其他发射状态是 $X$ 和 $Y$，它们对应于比对中的空位。这意味着任何两个对齐的符号对都必须由至少一个插入或删除的空位隔开。\n\n### 选项评估\n\n**A. Viterbi 路径永远不会进入匹配状态 $M$，因此比对只包含空位，无法比对任何符号对。**\n这是**不正确的**。模型可以从状态 $X$ 或 $Y$ 转移到状态 $M$，因为问题陈述指出 $a_{X,M}$ 和 $a_{Y,M}$ 严格为正。例如，路径片段 $... \\to X \\to M \\to Y \\to ...$ 是可能的，并且可能是最优的。这将产生一个带有孤立匹配对的比对。因此，路径永远不会进入状态 $M$ 的说法是错误的。\n\n**B. Viterbi 路径中匹配状态 $M$ 的任何出现都必须是孤立的；不可能出现连续两次匹配，因此任何两个比对上的符号对都必须由至少一个空位状态隔开。**\n这是**正确的**。如上所述，条件 $a_{M,M} = 0$ 使得任何包含从状态 $M$ 到状态 $M$ 的转移的路径的总概率为 $0$。如果存在任何具有正概率的路径，Viterbi 算法就不会选择这样的路径。这禁止了状态 $M$ 的连续出现。在比对中，状态 $M$ 代表对齐的符号对，状态 $X$ 和 $Y$ 代表空位。因此，任何两个对齐的符号对都必须由至少一个空位隔开。\n\n**C. Viterbi 比对不受影响，因为当发射概率占主导时，最可能路径会忽略自转移概率。**\n这是**不正确的**。这种说法表明了对 Viterbi 算法的基本误解。路径概率是发射概率和转移概率的乘积。一个零转移概率会使乘积为零，无论发射概率有多大。Viterbi 算法不会“忽略”任何概率；它严格计算完整的路径概率。设置 $a_{M,M}=0$ 肯定会影响比对。\n\n**D. 该模型仍然可以通过将静默的开始或结束状态作为桥梁进行路由来产生连续的匹配，因此连续匹配仍然是可能的。**\n这是**不正确的**。静默状态 $B$ 和 $E$ 有其特定的角色。开始状态 $B$ 是任何路径的唯一起点，在处理任何符号之前（在索引 $(0,0)$ 处）。结束状态 $E$ 是唯一的终止点，只有在处理完一个或两个序列中所有期望的符号后才能进入。它们不能在比对中间用作中间的“桥梁”状态。动态规划表的结构强制序列索引单调递增，使得这种路由不可能实现。\n\n**E. 由于零转移概率的存在，Viterbi 动态规划变得不适定，因此无法计算出最优路径。**\n这是**不正确的**。零概率是概率模型中参数的一个有效值。Viterbi 算法及其动态规划递推关系是完全适定的，可以毫无问题地执行。涉及 $a_{M,M}$ 的项简单地计算为 $0$，而 `max` 操作照常进行。一个最优路径可以并且将被计算出来；它只是被约束在不包含 $M \\to M$ 转移的路径上。", "answer": "$$\\boxed{B}$$", "id": "2411626"}, {"introduction": "这个练习超越了寻找单一最佳比对（维特比路径）的范畴，要求您计算所有可能比对的加权平均属性。您将通过手动计算在给定两条序列的情况下，插入事件的后验期望次数，来深入实践配对HMM的完整概率框架。这项练习能够锻炼精确的计算能力，并具体化了后验期望这一核心概念，这对于高级模型分析至关重要。 [@problem_id:2411573]", "problem": "考虑一个用于全局比对的配对隐马尔可夫模型 (pair HMM)，它有五个状态：一个起始状态 $B$、一个匹配状态 $M$、两个插入状态 $I_{x}$ 和 $I_{y}$（分别从序列 $X$ 或 $Y$ 发射一个符号，并与另一个序列中的空位对齐），以及一个结束状态 $E$。字母表为 $\\{A,C\\}$。只允许发生下面列出的转移，其概率已给定；所有其他转移的概率均为 $0$。\n\n- 从 $B$ 出发：$B \\to M$ 的概率为 $0.7$，$B \\to I_{x}$ 的概率为 $0.25$，$B \\to I_{y}$ 的概率为 $0.05$。\n- 从 $M$ 出发：$M \\to M$ 的概率为 $0.4$，$M \\to I_{x}$ 的概率为 $0.3$，$M \\to I_{y}$ 的概率为 $0.1$，$M \\to E$ 的概率为 $0.2$。\n- 从 $I_{x}$ 出发：$I_{x} \\to I_{x}$ 的概率为 $0.5$，$I_{x} \\to M$ 的概率为 $0.25$，$I_{x} \\to I_{y}$ 的概率为 $0.05$，$I_{x} \\to E$ 的概率为 $0.2$。\n- 从 $I_{y}$ 出发：$I_{y} \\to I_{y}$ 的概率为 $0.5$，$I_{y} \\to M$ 的概率为 $0.25$，$I_{y} \\to I_{x}$ 的概率为 $0.05$，$I_{y} \\to E$ 的概率为 $0.2$。\n\n发射概率如下。在匹配状态 $M$ 中，发射符号对 $(x,y) \\in \\{A,C\\} \\times \\{A,C\\}$ 的概率为\n$P_{M}(A,A)=0.5$，$P_{M}(A,C)=0.1$，$P_{M}(C,A)=0.2$，$P_{M}(C,C)=0.2$。\n在插入状态 $I_{x}$ 中，发射单个符号 $x \\in \\{A,C\\}$ 的概率为 $P_{I_{x}}(A)=0.6$，$P_{I_{x}}(C)=0.4$。\n在插入状态 $I_{y}$ 中，发射单个符号 $y \\in \\{A,C\\}$ 的概率为 $P_{I_{y}}(A)=0.7$，$P_{I_{y}}(C)=0.3$。\n\n给定两个观测序列：$X=AC$ 和 $Y=A$。一个状态路径从 $B$ 开始，根据状态的发射及其消耗规则（状态 $M$ 从每个序列中消耗一个符号，状态 $I_{x}$ 仅从 $X$ 中消耗一个符号，状态 $I_{y}$ 仅从 $Y$ 中消耗一个符号）按顺序精确发射给定的序列，然后转移到 $E$。将一个状态路径的“插入数”定义为在插入状态中产生的发射总数，即路径中来自 $I_{x}$ 的发射数与来自 $I_{y}$ 的发射数之和。\n\n计算在给定模型和观测序列的条件下，后验期望插入数，即在发射了序列 $X$ 和 $Y$ 的条件下，所有有效状态路径的分布下该计数的期望。请以精确的既约分数形式给出答案。不要包含任何单位。", "solution": "本题要求在给定一个特定的配对隐马尔可夫模型 (HMM) 的情况下，为序列 $X=AC$ 和 $Y=A$ 的比对计算后验期望插入数。\n\n首先，我们将问题形式化。设 $\\Pi$ 为所有从起始状态 $B$ 开始，生成序列 $X$ 和 $Y$，并在结束状态 $E$ 终止的有效状态路径的集合。对于任意给定的路径 $\\pi \\in \\Pi$，设 $P(\\pi, X, Y)$ 为该路径和观测序列的联合概率。观测到序列的总概率为 $P(X, Y) = \\sum_{\\pi \\in \\Pi} P(\\pi, X, Y)$。\n设 $\\text{ins}(\\pi)$ 表示路径 $\\pi$ 的插入数，其定义为来自状态 $I_x$ 和 $I_y$ 的发射总数。后验期望插入数由以下公式给出：\n$$E[\\text{ins} | X, Y] = \\sum_{\\pi \\in \\Pi} \\text{ins}(\\pi) P(\\pi | X, Y) = \\frac{\\sum_{\\pi \\in \\Pi} \\text{ins}(\\pi) P(\\pi, X, Y)}{P(X, Y)}$$\n\n一条路径必须消耗 $X$ 和 $Y$ 的所有符号。设 $|X|=L_x=2$ 和 $|Y|=L_y=1$。设 $n_M$、$n_{I_x}$ 和 $n_{I_y}$ 分别是路径访问状态 $M$、$I_x$ 和 $I_y$ 的次数。状态 $M$ 从每个序列中消耗一个符号。状态 $I_x$ 从 $X$ 中消耗一个符号。状态 $I_y$ 从 $Y$ 中消耗一个符号。对于全局比对，我们必须满足：\n$$n_M + n_{I_x} = L_x = 2$$\n$$n_M + n_{I_y} = L_y = 1$$\n由于 $n_M, n_{I_x}, n_{I_y}$ 必须是非负整数，我们可以确定它们的可能值。根据第二个方程，$n_{I_y} = 1 - n_M$，这意味着 $n_M$ 只能是 $0$ 或 $1$。\n\n情况 1：$n_M = 1$。\n这意味着 $n_{I_y} = 1 - 1 = 0$ 且 $n_{I_x} = 2 - 1 = 1$。\n此类别中任何路径的插入数为 $\\text{ins} = n_{I_x} + n_{I_y} = 1 + 0 = 1$。\n\n情况 2：$n_M = 0$。\n这意味着 $n_{I_y} = 1 - 0 = 1$ 且 $n_{I_x} = 2 - 0 = 2$。\n此类别中任何路径的插入数为 $\\text{ins} = n_{I_x} + n_{I_y} = 2 + 1 = 3$。\n\n设 $P_1$ 为所有具有 $1$ 个插入的路径的总概率， $P_3$ 为所有具有 $3$ 个插入的路径的总概率。则 $P(X, Y) = P_1 + P_3$。期望值为：\n$$E[\\text{ins} | X, Y] = \\frac{1 \\cdot P_1 + 3 \\cdot P_3}{P_1 + P_3}$$\n\n我们现在为每种情况枚举所有可能的路径并计算它们的概率。设 $a_{kl}$ 为从状态 $k$ 到状态 $l$ 的转移概率， $P_k(\\cdot)$ 为状态 $k$ 的发射概率。序列为 $X=x_1x_2=AC$ 和 $Y=y_1=A$。\n\n计算 $P_1$（路径满足 $n_M=1$, $n_{I_x}=1$, $n_{I_y}=0$）：\n发射状态 $\\{M, I_x\\}$ 有两种可能的排序：\n路径 1a：发射状态序列为 $(M, I_x)$。完整路径为 $B \\to M \\to I_x \\to E$。\n该路径必须从状态 $M$ 发射 $(x_1, y_1) = (A, A)$，从状态 $I_x$ 发射 $x_2 = C$。\n其概率为 $P_{1a} = a_{BM} \\cdot P_M(A,A) \\cdot a_{MI_x} \\cdot P_{I_x}(C) \\cdot a_{I_xE}$。\n$P_{1a} = (0.7) \\cdot (0.5) \\cdot (0.3) \\cdot (0.4) \\cdot (0.2) = \\frac{7}{10} \\cdot \\frac{1}{2} \\cdot \\frac{3}{10} \\cdot \\frac{2}{5} \\cdot \\frac{1}{5} = \\frac{42}{5000} = \\frac{21}{2500}$。\n\n路径 1b：发射状态序列为 $(I_x, M)$。完整路径为 $B \\to I_x \\to M \\to E$。\n该路径必须从状态 $I_x$ 发射 $x_1 = A$，从状态 $M$ 发射 $(x_2, y_1) = (C, A)$。\n其概率为 $P_{1b} = a_{BI_x} \\cdot P_{I_x}(A) \\cdot a_{I_xM} \\cdot P_M(C,A) \\cdot a_{ME}$。\n$P_{1b} = (0.25) \\cdot (0.6) \\cdot (0.25) \\cdot (0.2) \\cdot (0.2) = \\frac{1}{4} \\cdot \\frac{3}{5} \\cdot \\frac{1}{4} \\cdot \\frac{1}{5} \\cdot \\frac{1}{5} = \\frac{3}{2000}$。\n\n情况1的总概率：$P_1 = P_{1a} + P_{1b} = \\frac{21}{2500} + \\frac{3}{2000} = \\frac{84}{10000} + \\frac{15}{10000} = \\frac{99}{10000}$。\n\n计算 $P_3$（路径满足 $n_M=0$, $n_{I_x}=2$, $n_{I_y}=1$）：\n发射状态 $\\{I_x, I_x, I_y\\}$ 有 $\\binom{3}{1}=3$ 种可能的排序。\n路径 2a：状态序列为 $(I_x, I_x, I_y)$。路径：$B \\to I_x \\to I_x \\to I_y \\to E$。\n发射：第一个 $I_x$ 发射 $x_1=A$，第二个 $I_x$ 发射 $x_2=C$，$I_y$ 发射 $y_1=A$。\n$P_{2a} = a_{BI_x} \\cdot P_{I_x}(A) \\cdot a_{I_xI_x} \\cdot P_{I_x}(C) \\cdot a_{I_xI_y} \\cdot P_{I_y}(A) \\cdot a_{I_yE}$。\n$P_{2a} = (0.25)(0.6)(0.5)(0.4)(0.05)(0.7)(0.2) = \\frac{1}{4}\\frac{3}{5}\\frac{1}{2}\\frac{2}{5}\\frac{1}{20}\\frac{7}{10}\\frac{1}{5} = \\frac{42}{200000} = \\frac{21}{100000}$。\n\n路径 2b：状态序列为 $(I_x, I_y, I_x)$。路径：$B \\to I_x \\to I_y \\to I_x \\to E$。\n发射：第一个 $I_x$ 发射 $x_1=A$，$I_y$ 发射 $y_1=A$，第二个 $I_x$ 发射 $x_2=C$。\n$P_{2b} = a_{BI_x} \\cdot P_{I_x}(A) \\cdot a_{I_xI_y} \\cdot P_{I_y}(A) \\cdot a_{I_yI_x} \\cdot P_{I_x}(C) \\cdot a_{I_xE}$。\n$P_{2b} = (0.25)(0.6)(0.05)(0.7)(0.05)(0.4)(0.2) = \\frac{1}{4}\\frac{3}{5}\\frac{1}{20}\\frac{7}{10}\\frac{1}{20}\\frac{2}{5}\\frac{1}{5} = \\frac{42}{2000000} = \\frac{21}{1000000}$。\n\n路径 2c：状态序列为 $(I_y, I_x, I_x)$。路径：$B \\to I_y \\to I_x \\to I_x \\to E$。\n发射：$I_y$ 发射 $y_1=A$，第一个 $I_x$ 发射 $x_1=A$，第二个 $I_x$ 发射 $x_2=C$。\n$P_{2c} = a_{BI_y} \\cdot P_{I_y}(A) \\cdot a_{I_yI_x} \\cdot P_{I_x}(A) \\cdot a_{I_xI_x} \\cdot P_{I_x}(C) \\cdot a_{I_xE}$。\n$P_{2c} = (0.05)(0.7)(0.05)(0.6)(0.5)(0.4)(0.2) = \\frac{1}{20}\\frac{7}{10}\\frac{1}{20}\\frac{3}{5}\\frac{1}{2}\\frac{2}{5}\\frac{1}{5} = \\frac{42}{1000000} = \\frac{21}{500000}$。\n\n情况2的总概率：$P_3 = P_{2a} + P_{2b} + P_{2c} = \\frac{21}{100000} + \\frac{21}{1000000} + \\frac{42}{1000000} = \\frac{210}{1000000} + \\frac{21}{1000000} + \\frac{42}{1000000} = \\frac{273}{1000000}$。\n\n现在我们可以计算期望值了。\n分子：$1 \\cdot P_1 + 3 \\cdot P_3 = \\frac{99}{10000} + 3 \\cdot \\frac{273}{1000000} = \\frac{9900}{1000000} + \\frac{819}{1000000} = \\frac{10719}{1000000}$。\n分母：$P_1 + P_3 = \\frac{99}{10000} + \\frac{273}{1000000} = \\frac{9900}{1000000} + \\frac{273}{1000000} = \\frac{10173}{1000000}$。\n\n$E[\\text{ins} | X, Y] = \\frac{\\frac{10719}{1000000}}{\\frac{10173}{1000000}} = \\frac{10719}{10173}$。\n\n为了化简该分数，我们求分子和分母的最大公约数。\n$10719$ 的各位数字之和为 $1+0+7+1+9 = 18$，因此它可以被 $9$ 整除。\n$10173$ 的各位数字之和为 $1+0+1+7+3 = 12$，因此它可以被 $3$ 整除，但不能被 $9$ 整除。\n我们可以将两者都除以 $3$。\n$10719 \\div 3 = 3573$。\n$10173 \\div 3 = 3391$。\n分数变为 $\\frac{3573}{3391}$。\n使用欧几里得算法求 $\\text{gcd}(3573, 3391)$：\n$3573 = 1 \\cdot 3391 + 182$\n$3391 = 18 \\cdot 182 + 115$\n$182 = 1 \\cdot 115 + 67$\n$115 = 1 \\cdot 67 + 48$\n$67 = 1 \\cdot 48 + 19$\n$48 = 2 \\cdot 19 + 10$\n$19 = 1 \\cdot 10 + 9$\n$10 = 1 \\cdot 9 + 1$\n最大公约数为 $1$。因此，分数 $\\frac{3573}{3391}$ 是既约分数。", "answer": "$$\\boxed{\\frac{3573}{3391}}$$", "id": "2411573"}, {"introduction": "这个高级练习挑战您分析一个具有非传统参数的配对HMM，其中错配的发射概率高于匹配。通过分析这种反直觉模型在维特比解码、后验概率计算和鲍姆-韦尔奇训练下的行为，您可以培养批判性思维。这项练习揭示了HMM是一个通用的概率建模工具，其行为完全由其参数决定，而不仅仅是为标准生物学同源性搜索而设计的。 [@problem_id:2411583]", "problem": "考虑一个用于双序列比对的标准三状态对隐马尔可夫模型 (pair HMM)，其状态为 $M$ (匹配)、$X$ (仅在 $x$ 中插入) 和 $Y$ (仅在 $y$ 中插入)。设有限字母表为 $\\Sigma$。允许的转移如下：从 $M$ 到 $M$, $X$, 或 $Y$；从 $X$ 到 $X$ 或 $M$；以及从 $Y$ 到 $Y$ 或 $M$。所有列出的转移概率都严格介于 $0$ 和 $1$ 之间，并且从每个状态出发的转移概率之和为 $1$。匹配状态 $M$ 发射有序符号对 $(x,y)\\in\\Sigma\\times\\Sigma$，概率为 $e_M(x,y)$。插入状态发射单个符号和一个空位：状态 $X$ 发射 $(x,\\text{-})$，其在 $\\Sigma$ 上的发射分布为 $e_X(x)$；状态 $Y$ 发射 $(\\text{-},y)$，其在 $\\Sigma$ 上的发射分布为 $e_Y(y)$。假设 $e_X(\\cdot)$ 和 $e_Y(\\cdot)$ 在 $\\Sigma$ 上是固定的且严格为正。\n\n假设对于所有 $x\\in\\Sigma$ 以及所有 $y\\in\\Sigma$ 且 $y\\neq x$，匹配状态的发射概率满足\n$$ e_M(x,y) > e_M(x,x) $$\n也就是说，在匹配状态下，每个错配的发射概率都高于相应匹配的发射概率。其他方面的转移是任意但固定的，且如上所述严格为正。\n\n以下关于该模型在解码和推断下的行为的陈述中，哪些是正确的？选择所有适用项。\n\nA. 相对于一个 $e_M(x,x) > e_M(x,y)$ 的模型，Viterbi 解码会倾向于偏好具有更多 $M$ 状态错配和更少 $M$ 状态匹配的比对，并且只要用较高概率事件替换 $M$ 状态匹配发射所带来的增益超过了额外的转移惩罚，它就可能会用连续的 $X$ 和/或 $Y$ 状态插入来换掉一些 $M$ 状态的匹配。\n\nB. 在保持所有转移概率和插入状态发射分布 $e_X(\\cdot)$ 和 $e_Y(\\cdot)$ 固定的情况下，随着 $e_M(x,x)$ 相对于 $e_M(x,y)$ 的降低，一个特定的相同字母对 $(x,x)$ 通过 $M$ 状态比对的后验概率会单调递减。\n\nC. 对于从 $\\Sigma$ 中均匀抽取的两个独立序列，当 $e_M$ 如上所述地偏好错配而非匹配时，在 Viterbi 比对中分配给 $M$ 的列的期望分数达到最大。\n\nD. 如果这个模型（对于所有 $x\\neq y$ 都有 $e_M(x,y) > e_M(x,x)$）被用作通过期望最大化 (EM) 进行 Baum–Welch 训练的初始化，在一个包含许多完全匹配的真实同源序列对的数据集上进行训练，那么在收敛时，学习到的发射概率必然会将不等式翻转为 $e_M(x,x) > e_M(x,y)$。\n\nE. 对于两个相同的序列 $x=y$，在此模型下的最优 (Viterbi) 比对必须包含零个 $M$ 状态列，无论转移概率如何，因为 $M$ 状态的匹配因其发射概率而不被偏好。", "solution": "在这里，我将对问题陈述进行严格的验证，然后详细推导解决方案。\n\n### 步骤1：提取已知条件\n\n-   **模型：** 一个标准的三状态对隐马尔可夫模型 (pair HMM)。\n-   **状态：** $M$ (匹配)，$X$ (在序列 $x$ 中插入)，和 $Y$ (在序列 $y$ 中插入)。\n-   **字母表：** 一个有限集 $\\Sigma$。\n-   **转移：** 允许的转移如下：从 $M$ 到 $M$, $X$, 或 $Y$；从 $X$ 到 $X$ 或 $M$；以及从 $Y$ 到 $Y$ 或 $M$。所有指定的转移概率都严格介于 $0$ 和 $1$ 之间。从任何给定状态出发的转移概率之和为 $1$。值得注意的是，转移 $X \\to Y$ 和 $Y \\to X$ 未被列出，因此假设其概率为 $0$。\n-   **发射：**\n    -   状态 $M$ 以概率 $e_M(x,y)$ 发射一个有序符号对 $(x,y) \\in \\Sigma \\times \\Sigma$。\n    -   状态 $X$ 以概率 $e_X(x)$ (对于 $x \\in \\Sigma$) 发射一个符号-空位对 $(x, \\text{-})$。\n    -   状态 $Y$ 以概率 $e_Y(y)$ (对于 $y \\in \\Sigma$) 发射一个空位-符号对 $(\\text{-}, y)$。\n-   **发射约束：**\n    -   对所有 $x \\in \\Sigma$，$e_X(x) > 0$。\n    -   对所有 $y \\in \\Sigma$，$e_Y(y) > 0$。\n    -   **关键条件：** 对于所有 $x \\in \\Sigma$ 以及所有 $y \\in \\Sigma$ 且 $y \\neq x$，匹配状态的发射概率满足 $e_M(x,y) > e_M(x,x)$。这规定了在匹配状态下，任何错配都比相应的匹配更可能发生。\n\n### 步骤2：使用提取的已知条件进行验证\n\n-   **科学依据：** 该问题描述了一个对隐马尔可夫模型，这是计算生物学和生物信息学中的一个标准基础模型。三状态结构 ($M, X, Y$) 是典范的。所有组成部分（状态、转移、发射）在 HMM 理论中都有明确的定义。中心条件 $e_M(x,y) > e_M(x,x)$ 对于建模生物同源性（通常偏好匹配）来说不寻常，但它是一个在数学上和概率上都一致的参数化。它针对模型在特定（尽管非典型）参数下的行为提出了一个有效的理论问题。该问题具有科学依据。\n-   **适定性：** 模型被足够详细地指定，可以用来分析像 Viterbi、前向-后向和 Baum-Welch 这样的标准算法的行为。选项中提出的问题是关于给定参数条件的定性后果，这些问题可以通过对这些算法的分析来回答。该问题是适定的。\n-   **客观性：** 问题以精确的数学语言陈述，没有主观性或模糊性。\n\n### 步骤3：结论与行动\n\n问题陈述是有效的。这是一个关于标准科学模型的适定的理论问题。我现在将开始分析每个选项。\n\n---\n\n这个问题的核心在于理解匹配状态 $M$ 的不寻常发射概率分布所带来的后果，即对所有 $x \\neq y$ 都有 $e_M(x,y) > e_M(x,x)$。这意味着该模型在处于 $M$ 状态时，本质上更偏好比对错配的字符，而不是匹配的字符。\n\n### 选项 A 分析\n\n该陈述声称 Viterbi 解码将偏好具有更多 $M$ 状态错配的比对，并可能用插入来换取 $M$ 状态的匹配。\n\n1.  **对 M 状态错配的偏好：** Viterbi 算法寻找生成观测序列的最可能的状态和发射路径。路径的概率是转移概率和发射概率的乘积。在对数空间中，该算法最大化对数概率之和（一个分数）。对于在状态 $M$ 中比对字符 $x_i$ 和 $y_j$ 的一列，其分数贡献是 $\\log e_M(x_i, y_j)$。鉴于条件 $e_M(x,y) > e_M(x,x)$ (对于 $x \\neq y$)，可推断出 $\\log e_M(x,y) > \\log e_M(x,x)$。因此，在所有其他因素（如转移概率）相同的情况下，如果一个 $M$ 状态列是错配，Viterbi 算法会比它是匹配时赋予更高的分数。这将产生一种倾向，即偏好使用 $M$ 状态进行错配的比对。\n\n2.  **用插入换取匹配：** 一个 $M$ 状态的匹配 $(x,x)$ 贡献了一个低分项 $\\log e_M(x,x)$。Viterbi 算法旨在最大化总分。如果另一条比对路径可以避免这个低分事件，它可能会被偏好。一种这样的替代方案是不比对匹配的字符，而是用插入和删除（状态 $X$ 和 $Y$）来表示它们。例如，模型可以不通过 $M$ 状态将字符 $c$ 与自身比对，而是将 $c$ 与一个空位比对（状态 $X$），然后在别处将一个空位与 $c$ 比对（状态 $Y$）。这条替代路径涉及不同的发射概率 ($e_X(c)$, $e_Y(c)$) 和不同的转移概率（例如，进入和退出空位状态的惩罚）。如果 $\\log e_M(c,c)$ 这一项足够小（负值），那么涉及插入/删除的路径的分数完全有可能高于使用 $M$ 状态匹配的路径。该陈述正确地将其描述为一种权衡，其中“用较高概率事件替换 $M$ 状态匹配发射所带来的增益超过了额外的转移惩罚”，这正是 Viterbi 算法的动态规划逻辑所执行的计算。\n\n陈述的两个部分都准确地描述了 Viterbi 算法在给定条件下的行为。\n\n**结论：正确**。\n\n### 选项 B 分析\n\n该陈述涉及比对的后验概率，该概率使用前向-后向算法计算。一个特定的相同字符对 $(x_i, y_j)$（其中 $x_i=y_j=c$）在状态 $M$ 中比对的后验概率由下式给出：\n$$\nP(\\pi_{i,j}=M | \\mathbf{x}, \\mathbf{y}, \\theta) = \\frac{f_M(i,j) b_M(i,j)}{P(\\mathbf{x}, \\mathbf{y} | \\theta)}\n$$\n在此，$f_M(i,j)$ 是将前缀 $\\mathbf{x}_{1..i}$ 和 $\\mathbf{y}_{1..j}$ 比对且比对在 $(i,j)$ 处以状态 $M$ 结束的前向概率，而 $b_M(i,j)$ 是相应的后向概率。对于任何将 $(x_i, y_j)$ 与状态 $M$ 比对的路径 $\\pi$，其总概率 $P(\\mathbf{x}, \\mathbf{y}, \\pi | \\theta)$ 将包含因子 $e_M(x_i, y_j) = e_M(c,c)$。\n\n让我们对所有将 $(x_i,y_j)$ 与状态 $M$ 比对的路径的概率求和。这个和与 $e_M(c,c)$ 成正比，可以写成 $A \\cdot e_M(c,c)$，其中 $A$ 包含了这些路径上所有其他的转移和发射概率。所有*不*将 $(x_i,y_j)$ 与状态 $M$ 比对的路径的概率之和不依赖于 $e_M(c,c)$；设这个和为 $B$。观测到序列的总概率是 $P(\\mathbf{x}, \\mathbf{y} | \\theta) = A \\cdot e_M(c,c) + B$。\n\n那么后验概率是：\n$$\nP(\\pi_{i,j}=M | \\mathbf{x}, \\mathbf{y}, \\theta) = \\frac{A \\cdot e_M(c,c)}{A \\cdot e_M(c,c) + B}\n$$\n假设所有其他参数都固定，令 $u = e_M(c,c)$。我们分析函数 $f(u) = \\frac{Au}{Au+B}$。它对 $u$ 的导数是：\n$$\nf'(u) = \\frac{A(Au+B) - A(Au)}{(Au+B)^2} = \\frac{AB}{(Au+B)^2}\n$$\n由于所有概率都严格为正，所以 $A > 0$ 且 $B > 0$。因此，$f'(u) > 0$，这意味着后验概率是 $e_M(c,c)$ 的一个单调递增函数。因此，随着 $e_M(c,c)$ 的减小，该对 $(c,c)$ 通过 $M$ 状态比对的后验概率单调递减。“相对于 $e_M(x,y)$” 这个短语是上下文，而不是一个混淆因素，因为问题分析的是在保持其他参数固定的情况下改变 $e_M(x,x)$ 的影响。\n\n**结论：正确**。\n\n### 选项 C 分析\n\n该陈述声称对于随机序列，当 $e_M$ 偏好错配时，Viterbi 比对中 $M$ 状态列的期望分数被*最大化*。\n\n对于从大小为 $S$ 的字母表 $\\Sigma$ 中均匀抽取的两个独立序列，任何给定字符对 $(x,y)$ 的概率是均匀的：$P(x,y) = 1/S^2$。一个匹配 $(x,x)$ 的概率是 $S/S^2 = 1/S$，而一个错配 $(x,y)$（其中 $x \\neq y$）的概率是 $(S^2-S)/S^2 = (S-1)/S$。对于任何合理大小的字母表，错配都远比匹配频繁。\n\n$e_M(x,y) > e_M(x,x)$ 的模型为更频繁的事件（错配）分配了更高的发射概率（从而得到更好的分数）。一个偏好匹配的模型，$e_M(x,x) > e_M(x,y)$，会为较不频繁的事件分配更高的分数。因此，偏好错配的模型对随机数据有更好的“调优”，大量使用状态 $M$ 的比对路径的总分将高于偏好匹配的模型。与偏好匹配的模型相比，这会导致*更高*的 $M$ 状态比例。\n\n然而，该陈述声称这个比例是*最大化*的。考虑一个替代的发射分布，其中对所有对 $(x,y)$ 都有 $e_M(x,y) = 1/S^2$。这种均匀分布不偏好错配胜过匹配（它平等对待它们）。根据凹函数对数的琴生不等式，每个 $M$ 列的期望对数发射分数，$E[\\log e_M(x,y)] = \\frac{1}{S^2}\\sum_{x,y} \\log e_M(x,y)$，在 $e_M$ 是均匀分布时最大化。来自状态 $M$ 的更高平均分数贡献通常会鼓励 Viterbi 算法更频繁地使用状态 $M$，从而导致更高比例的 $M$ 列。指定的偏好错配的分布是非均匀的，因此它产生的期望对数发射分数会低于均匀分布。由于均匀分布不满足 $e_M(x,y)>e_M(x,x)$，问题中给出的条件不会导致 $M$ 状态的最大比例。“最大化”这个词使得陈述过于强烈。\n\n**结论：不正确**。\n\n### 选项 D 分析\n\n该陈述声称，在具有许多匹配的同源序列上进行 Baum-Welch 训练，将*必然*导致学习到的发射概率翻转为 $e_M(x,x) > e_M(x,y)$。\n\nBaum-Welch (EM) 算法是一个迭代过程，它寻找数据似然函数的局部最大值。其收敛点在很大程度上取决于初始参数。初始模型的参数设置为 $e_M(x,y) > e_M(x,x)$。这个模型“认为”状态 $M$ 是用来生成错配的。\n\n在期望 (E) 步骤中，算法使用*当前*模型计算后验概率。当面对一个富含匹配的训练集（例如，许多 $(c,c)$ 对）时，当前模型由于其较低的 $e_M(c,c)$ 值，将为这些匹配是由状态 $M$ 生成的事件分配一个较低的后验概率（根据选项 B 的分析）。它很可能会推断这些匹配可以通过其他更复杂的路径（例如，涉及空位状态的路径）得到更好的解释。\n\n在最大化 (M) 步骤中，新参数是根据 E 步骤中计算的期望计数来估计的。由于状态 $M$ 被用于匹配的期望计数会很低，重新估计的 $e_M(x,x)$ 也会很低。相反，状态 $M$ 中错配的期望计数会很高，从而加强了高的 $e_M(x,y)$ 值。\n\n因此，算法很可能会陷入一个局部似然最大值，其中状态 $M$ 继续专门用于建模错配，而数据中的真实匹配则被次优地建模。“必然”一词意味着收敛到全局最优，而这对于 EM 算法来说是没有保证的。\n\n**结论：不正确**。\n\n### 选项 E 分析\n\n该陈述断言，对于两个相同的序列， Viterbi 比对*必须*包含零个 $M$ 状态列。\n\n两个非空序列 $S_1$ 和 $S_2$ 的比对，对应于动态规划网格中从坐标 $(0,0)$到 $(|S_1|,|S_2|)$ 的一条路径。\n-   向右移动对应于在 $S_1$ 中插入（一列如 $(-,y)$，状态 $Y$）。\n-   向下移动对应于在 $S_2$ 中插入（一列如 $(x,-)$，状态 $X$）。\n-   对角线移动对应于比对两个字符（一列如 $(x,y)$，状态 $M$）。\n\n指定的转移规则是：从 $M$ 到 $\\{M, X, Y\\}$；从 $X$ 到 $\\{X, M\\}$；从 $Y$ 到 $\\{Y, M\\}$。关键是，状态 $X$ 和状态 $Y$ 之间没有转移。这意味着要从一系列 $X$ 状态发射切换到 $Y$ 状态发射（反之亦然），比对路径必须经过状态 $M$。\n\n一个包含“零个 M 状态列”的比对意味着路径完全由集合 $\\{X, Y\\}$ 中的状态组成。这样的路径要么只由 $X$ 状态组成，要么只由 $Y$ 状态组成。一条全为 $X$ 状态的路径将 $S_1$ 与一个空序列比对。一条全为 $Y$ 状态的路径将一个空序列与 $S_2$ 比对。两者都不能产生两个非空序列的比对。\n任何涉及插入和删除（即同时包含 $X$ 和 $Y$ 状态）的两个非空序列的比对，由于缺少 $X \\leftrightarrow Y$ 转移，必须包含至少一个 $M$ 状态作为桥梁。\n\n因此，使用零个 $M$ 状态列来构建两个相同的非空序列的比对在结构上是不可能的。最优路径必须包含至少一个 $M$ 状态。该陈述是错误的，无论发射和转移概率如何；它与模型的基本转移结构相矛盾。\n\n**结论：不正确**。", "answer": "$$\\boxed{AB}$$", "id": "2411583"}]}