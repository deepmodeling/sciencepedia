{"hands_on_practices": [{"introduction": "分子力学力场的基石在于其势能函数，它将分子的几何构型与其能量联系起来。通过从头开始为单个水分子编写一个简化的能量计算程序[@problem_id:2407803]，你将亲手实践键长、键角和非键相互作用如何共同决定分子的总势能。这个练习是理解更复杂生物分子模拟中能量计算核心逻辑的绝佳起点。", "problem": "给定一个由三个原子（标记为氢 $H_1$、氧 $O$ 和氢 $H_2$）组成的孤立水分子。总势能将根据分子力学基本原理计算，其值为两个 $O\\!-\\!H$ 键的谐波键伸缩、$H\\!-\\!O\\!-\\!H$ 角的谐波角弯曲以及仅两个氢原子之间的静电库仑相互作用之和。直接成键的原子对之间的相互作用不包括在静电计算中。此设置中不包含 Lennard–Jones 贡献。\n\n定义以下总势能：\n$$\nE_{\\text{total}} = \\sum_{i=1}^{2} \\frac{1}{2} k_r \\left(r_i - r_0\\right)^2 \\;+\\; \\frac{1}{2} k_\\theta \\left(\\theta - \\theta_0\\right)^2 \\;+\\; k_e \\frac{q_H q_H}{r_{HH}},\n$$\n其中 $r_1$ 和 $r_2$ 是两个 $O\\!-\\!H$ 键的长度，$\\theta$ 是位于氧原子上的 $H\\!-\\!O\\!-\\!H$ 键角，而 $r_{HH}$ 是两个氢原子之间的距离。氢原子带有相同的局部电荷 $q_H$，键力常数为 $k_r$，角力常数为 $k_\\theta$。库仑常数为 $k_e$。键能平衡参数为 $r_0$ 和 $\\theta_0$。$O\\!-\\!H$ 的静电作用被排除，因为这些原子是直接成键的；只包括 $H_1\\!-\\!H_2$ 的库仑相互作用。所有能量必须以千焦/摩尔表示。\n\n在所有计算中使用以下固定参数：\n- 键平衡长度 $r_0 = 0.9572$ Å。\n- 角平衡值 $\\theta_0 = 104.52$ 度。\n- 键力常数 $k_r = 1882.8$ kJ/mol·Å$^2$。\n- 角力常数 $k_\\theta = 230.12$ kJ/mol·rad$^2$。\n- 氢原子局部电荷 $q_H = +0.417$ 基本电荷。\n- 库仑常数 $k_e = 138.935456$ kJ·Å/(mol·e$^2$)。\n\n几何约定：\n- 输入角度 $\\theta$ 以度为单位提供，输入时也必须按度处理，但谐波角弯曲项必须使用弧度。因此，对于角弯曲项和三角函数，请将 $\\theta$ 和 $\\theta_0$ 转换为弧度。\n- 距离 $r_{HH}$ 是三角形中与角 $\\theta$ 相对的边的长度，该三角形的两条边 $r_1$ 和 $r_2$ 在氧原子处相交，$r_{HH}$ 必须根据欧几里得几何一致地计算。\n- 键长 $r_1$和 $r_2$ 以埃（Å）为单位提供，计算中的所有距离都必须以埃（Å）为单位，以与 $k_e$ 的单位保持一致。\n\n测试套件（每个测试用例是一个元组 $(r_1, r_2, \\theta_{\\text{deg}})$）：\n- 案例 1：$(0.9572, 0.9572, 104.52)$\n- 案例 2：$(1.0000, 1.0000, 104.52)$\n- 案例 3：$(0.9572, 0.9572, 100.00)$\n- 案例 4：$(0.9500, 1.0000, 104.52)$\n\n您的任务是编写一个完整、可运行的程序，使用上述定义为每个案例计算 $E_{\\text{total}}$，并以千焦/摩尔为单位生成结果。三角函数内部和角弯曲项中使用的角度必须是弧度。最终输出必须是一行，包含一个用方括号括起来的、逗号分隔的四个能量列表，例如 $[x_1,x_2,x_3,x_4]$，其中每个 $x_i$ 是一个以 kJ/mol 为单位的浮点数。不应打印任何额外文本。", "solution": "该问题陈述具有科学依据，表述清晰，客观且内容完整。它提出了一项计算化学中的标准练习，特别是使用简化的分子力学力场计算势能。所有必需的参数、公式和条件均已提供，不存在内部矛盾或违反科学原理之处。因此，该问题是有效的，并将提供一个解决方案。\n\n目标是计算单个水分子在四种不同几何构型下的总势能 $E_{\\text{total}}$。总能量定义为三个分量的总和：键伸缩项 $E_{\\text{bond}}$、角弯曲项 $E_{\\text{angle}}$ 和非键静电项 $E_{\\text{Coulomb}}$。\n$$\nE_{\\text{total}} = E_{\\text{bond}} + E_{\\text{angle}} + E_{\\text{Coulomb}}\n$$\n我们将根据提供的参数分析每一项的计算。\n\n固定参数如下：\n- 键平衡长度 $r_0 = 0.9572$ Å。\n- 角平衡值 $\\theta_0 = 104.52$ 度。\n- 键力常数 $k_r = 1882.8$ kJ/mol·Å$^2$。\n- 角力常数 $k_\\theta = 230.12$ kJ/mol·rad$^2$。\n- 氢原子局部电荷 $q_H = +0.417$ 基本电荷。\n- 库仑常数 $k_e = 138.935456$ kJ·Å/(mol·e$^2$)。\n\n**1. 键伸缩能 ($E_{\\text{bond}}$)**\n\n键能项模拟了当两个 $O-H$ 键的长度偏离其平衡长度 $r_0$ 时储存在键中的势能。该能量使用每个键的谐势计算：\n$$\nE_{\\text{bond}} = \\sum_{i=1}^{2} \\frac{1}{2} k_r (r_i - r_0)^2 = \\frac{1}{2} k_r (r_1 - r_0)^2 + \\frac{1}{2} k_r (r_2 - r_0)^2\n$$\n此处，$r_1$ 和 $r_2$ 是给定的两个 $O-H$ 键的长度，单位为埃（Å）。使用常数 $k_r = 1882.8$ kJ/mol·Å$^2$ 和 $r_0 = 0.9572$ Å。单位是一致的，最终得到的能量单位为 kJ/mol。\n\n**2. 角弯曲能 ($E_{\\text{angle}}$)**\n\n角弯曲能项模拟了当 $H-O-H$ 键角 $\\theta$ 偏离其平衡值 $\\theta_0$ 时的势能变化。这也由一个谐势描述：\n$$\nE_{\\text{angle}} = \\frac{1}{2} k_\\theta (\\theta_{\\text{rad}} - \\theta_{0,\\text{rad}})^2\n$$\n这里的关键步骤是将角度从度转换为弧度，因为力常数 $k_\\theta$ 的单位是 kJ/mol·rad$^2$。输入角度 $\\theta_{\\text{deg}}$ 和平衡角 $\\theta_0 = 104.52$ 度都必须进行转换。转换公式为：\n$$\n\\alpha_{\\text{rad}} = \\alpha_{\\text{deg}} \\times \\frac{\\pi}{180}\n$$\n因此，我们从输入 $\\theta_{\\text{deg}}$ 计算 $\\theta_{\\text{rad}}$，并从 $\\theta_0$ 计算常数 $\\theta_{0,\\text{rad}}$：\n$$\n\\theta_{0,\\text{rad}} = 104.52 \\times \\frac{\\pi}{180} \\approx 1.824218 \\text{ rad}\n$$\n将角度转换为弧度后，我们可以使用 $k_\\theta = 230.12$ kJ/mol·rad$^2$ 计算 $E_{\\text{angle}}$。\n\n**3. 静电能 ($E_{\\text{Coulomb}}$)**\n\n静电能源于两个带有局部电荷的氢原子之间的库仑相互作用。问题指定只考虑 $H_1-H_2$ 之间的相互作用。能量由库仑定律给出：\n$$\nE_{\\text{Coulomb}} = k_e \\frac{q_H q_H}{r_{HH}} = k_e \\frac{q_H^2}{r_{HH}}\n$$\n其中 $q_H = +0.417$ e，$k_e = 138.935456$ kJ·Å/(mol·e$^2$)，而 $r_{HH}$ 是两个氢原子之间的距离，单位为Å。\n\n距离 $r_{HH}$ 必须根据分子几何结构计算。原子 $H_1$、$O$ 和 $H_2$ 形成一个三角形，其中长度为 $r_1$ 和 $r_2$ 的 $O-H_1$ 和 $O-H_2$ 键构成了与氧原子处夹角 $\\theta$ 相邻的两条边。距离 $r_{HH}$ 是与角 $\\theta$ 相对的边的长度。根据余弦定理：\n$$\nr_{HH}^2 = r_1^2 + r_2^2 - 2 r_1 r_2 \\cos(\\theta_{\\text{rad}})\n$$\n因此，距离为：\n$$\nr_{HH} = \\sqrt{r_1^2 + r_2^2 - 2 r_1 r_2 \\cos(\\theta_{\\text{rad}})}\n$$\n在余弦函数中使用的角度 $\\theta$ 必须是弧度，这一点至关重要。一旦确定了 $r_{HH}$，就可以计算 $E_{\\text{Coulomb}}$。单位是一致的，最终得到的能量单位为 kJ/mol。\n\n**每个测试用例 $(r_1, r_2, \\theta_{\\text{deg}})$ 的计算摘要**\n\n对于每个给定的元组，通过对三个分量求和来计算总能量：\n1. 使用键长 $r_1$ 和 $r_2$ 计算 $E_{\\text{bond}}$。\n2. 将 $\\theta_{\\text{deg}}$ 转换为 $\\theta_{\\text{rad}}$ 并计算 $E_{\\text{angle}}$。\n3. 使用 $\\theta_{\\text{rad}}$、$r_1$ 和 $r_2$ 通过余弦定理计算 $r_{HH}$。\n4. 使用 $r_{HH}$ 计算 $E_{\\text{Coulomb}}$。\n5. 将能量相加：$E_{\\text{total}} = E_{\\text{bond}} + E_{\\text{angle}} + E_{\\text{Coulomb}}$。\n对问题陈述中提供的所有四个测试用例重复此过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the total potential energy of a water molecule based on a\n    simplified molecular mechanics force field.\n    \"\"\"\n\n    # Define the fixed parameters with their respective units.\n    # Bond equilibrium length in Angstroms\n    r_0 = 0.9572  # Å\n    # Angle equilibrium value in degrees\n    theta_0_deg = 104.52  # degrees\n    # Bond force constant in kJ/mol·Å^2\n    k_r = 1882.8  # kJ/mol·Å^2\n    # Angle force constant in kJ/mol·rad^2\n    k_theta = 230.12  # kJ/mol·rad^2\n    # Hydrogen partial charge in elementary charge units\n    q_H = 0.417  # e\n    # Coulomb constant in kJ·Å/(mol·e^2)\n    k_e = 138.935456  # kJ·Å/(mol·e^2)\n\n    # Pre-calculate angle in radians for efficiency\n    theta_0_rad = np.deg2rad(theta_0_deg)\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (r1, r2, theta_deg) where r1, r2 are in Å\n    # and theta_deg is in degrees.\n    test_cases = [\n        (0.9572, 0.9572, 104.52),  # Case 1\n        (1.0000, 1.0000, 104.52),  # Case 2\n        (0.9572, 0.9572, 100.00),  # Case 3\n        (0.9500, 1.0000, 104.52),  # Case 4\n    ]\n\n    results = []\n    for r1, r2, theta_deg in test_cases:\n        # 1. Calculate Bond Stretching Energy (E_bond)\n        e_bond = 0.5 * k_r * ((r1 - r_0)**2 + (r2 - r_0)**2)\n\n        # 2. Calculate Angle Bending Energy (E_angle)\n        # Convert the current angle from degrees to radians for the calculation\n        theta_rad = np.deg2rad(theta_deg)\n        e_angle = 0.5 * k_theta * (theta_rad - theta_0_rad)**2\n\n        # 3. Calculate Electrostatic Energy (E_coulomb)\n        # First, calculate the distance between the two hydrogen atoms (r_HH)\n        # using the Law of Cosines. The angle must be in radians.\n        r_hh_squared = r1**2 + r2**2 - 2 * r1 * r2 * np.cos(theta_rad)\n        r_hh = np.sqrt(r_hh_squared)\n        \n        # Then, calculate the Coulombic potential energy.\n        e_coulomb = k_e * (q_H**2) / r_hh\n\n        # 4. Calculate Total Potential Energy\n        e_total = e_bond + e_angle + e_coulomb\n        results.append(e_total)\n\n    # Format the results to six decimal places as required.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2407803"}, {"introduction": "静电相互作用是蛋白质结构和功能中的关键驱动力，尤其是在盐桥等稳定结构中。本练习[@problem_id:2407798]将理论付诸实践，让你使用一个简化的点电荷模型和库仑定律，来估算一个常见的氨基酸突变对盐桥稳定性的影响。这种估算能力对于快速评估突变后果和指导蛋白质设计至关重要。", "problem": "一个点电荷分子力学 (MM) 模型被用来估算，在蛋白质内部，从天冬氨酸 (D) 到谷氨酸 (E) 的突变如何扰动与附近精氨酸 (R) 形成的盐桥的静电稳定作用。假设采用以下理想化模型：\n- 精氨酸侧链在其胍基中心带有一个电荷 $+e$，天冬氨酸/谷氨酸侧链在其羧基中心带有一个电荷 $-e$。\n- 局部环境是均匀的，相对介电常数 $\\varepsilon_{r} = 4$。\n- 对于天冬氨酸-精氨酸对，带电基团之间的中心间距为 $r_{D} = 3.0\\,\\text{\\AA}$；对于谷氨酸-精氨酸对，中心间距为 $r_{E} = 4.5\\,\\text{\\AA}$。\n- 使用均匀电介质中的库仑相互作用来估算静电对能。\n- 将静电能的变化定义为 $\\Delta E_{\\text{elec}} = E_{\\text{elec}}(\\text{E}) - E_{\\text{elec}}(\\text{D})$。\n\n使用常数 $e = 1.602176634 \\times 10^{-19}\\,\\text{C}$，$\\varepsilon_{0} = 8.8541878128 \\times 10^{-12}\\,\\text{C}^{2}\\,\\text{N}^{-1}\\,\\text{m}^{-2}$，$N_{A} = 6.02214076 \\times 10^{23}\\,\\text{mol}^{-1}$，以及 $1\\,\\text{\\AA} = 1.0 \\times 10^{-10}\\,\\text{m}$。计算每摩尔的 $\\Delta E_{\\text{elec}}$，并以 $\\text{kJ}\\,\\text{mol}^{-1}$ 为单位表示您的最终结果。将您的答案四舍五入到三位有效数字。", "solution": "在相对介电常数为 $\\varepsilon_{r}$ 的均匀介质中，两个相距为 $r$ 的点电荷 $q_{1}$ 和 $q_{2}$ 之间的静电相互作用能由下式给出\n$$\nE_{\\text{pair}} = \\frac{1}{4\\pi \\varepsilon_{0} \\varepsilon_{r}} \\frac{q_{1} q_{2}}{r}.\n$$\n对于该盐桥，取 $q_{1} = +e$ (精氨酸) 和 $q_{2} = -e$ (天冬氨酸或谷氨酸的羧基)，所以\n$$\nE_{\\text{pair}}(r) = -\\frac{1}{4\\pi \\varepsilon_{0} \\varepsilon_{r}} \\frac{e^{2}}{r}.\n$$\n将突变引起的静电能变化定义为\n$$\n\\Delta E_{\\text{elec}} = E_{\\text{elec}}(\\text{E}) - E_{\\text{elec}}(\\text{D}) = -\\frac{1}{4\\pi \\varepsilon_{0} \\varepsilon_{r}} e^{2} \\left(\\frac{1}{r_{E}} - \\frac{1}{r_{D}}\\right).\n$$\n为了以每摩尔为单位表示，需乘以阿伏伽德罗常数 $N_{A}$：\n$$\n\\Delta E_{\\text{elec, mol}} = -N_{A}\\,\\frac{1}{4\\pi \\varepsilon_{0} \\varepsilon_{r}} e^{2} \\left(\\frac{1}{r_{E}} - \\frac{1}{r_{D}}\\right).\n$$\n代入给定参数。首先将距离单位转换为米：\n$$\nr_{D} = 3.0 \\times 10^{-10}\\,\\text{m}, \\quad r_{E} = 4.5 \\times 10^{-10}\\,\\text{m}.\n$$\n为方便起见，记 $k_{e} = \\frac{1}{4\\pi \\varepsilon_{0}}$。则表达式变为\n$$\n\\Delta E_{\\text{elec, mol}} = -N_{A}\\,\\frac{k_{e}\\,e^{2}}{\\varepsilon_{r}} \\left(\\frac{1}{r_{E}} - \\frac{1}{r_{D}}\\right).\n$$\n使用 $k_{e} = \\frac{1}{4\\pi \\varepsilon_{0}}$，$e$，$N_{A}$ 和 $\\varepsilon_{r} = 4$，分步计算数值。在最终代入数值之前，保留符号形式：\n\n1. 符号形式：\n$$\n\\Delta E_{\\text{elec, mol}} = -\\frac{N_{A} e^{2}}{4\\pi \\varepsilon_{0} \\varepsilon_{r}} \\left(\\frac{1}{r_{E}} - \\frac{1}{r_{D}}\\right).\n$$\n\n2. 注意到 $r_{E} > r_{D}$，所以 $\\frac{1}{r_{E}} - \\frac{1}{r_{D}} < 0$，因此总的 $\\Delta E_{\\text{elec, mol}}$ 是正值，反映了稳定作用的减弱。\n\n3. 代入数值：\n- $N_{A} = 6.02214076 \\times 10^{23}\\,\\text{mol}^{-1}$,\n- $e = 1.602176634 \\times 10^{-19}\\,\\text{C}$,\n- $\\varepsilon_{0} = 8.8541878128 \\times 10^{-12}\\,\\text{C}^{2}\\,\\text{N}^{-1}\\,\\text{m}^{-2}$,\n- $\\varepsilon_{r} = 4$,\n- $r_{D} = 3.0 \\times 10^{-10}\\,\\text{m}$,\n- $r_{E} = 4.5 \\times 10^{-10}\\,\\text{m}$.\n\n首先计算 $k_{e} e^{2} = \\frac{e^{2}}{4\\pi \\varepsilon_{0}}$。数值上，\n$$\nk_{e} e^{2} \\approx 8.9875517923 \\times 10^{9}\\,\\text{N}\\,\\text{m}^{2}\\,\\text{C}^{-2} \\times \\left(1.602176634 \\times 10^{-19}\\,\\text{C}\\right)^{2} \\approx 2.30707755 \\times 10^{-28}\\,\\text{J}\\,\\text{m}.\n$$\n那么\n$$\n\\Delta E_{\\text{elec, mol}} = -\\frac{N_{A}}{\\varepsilon_{r}} \\, (k_{e} e^{2}) \\left(\\frac{1}{r_{E}} - \\frac{1}{r_{D}}\\right).\n$$\n计算括号内的项：\n$$\n\\frac{1}{r_{E}} - \\frac{1}{r_{D}} = \\frac{1}{4.5 \\times 10^{-10}\\,\\text{m}} - \\frac{1}{3.0 \\times 10^{-10}\\,\\text{m}} = \\left(2.222\\dots - 3.333\\dots\\right) \\times 10^{9}\\,\\text{m}^{-1} = -1.111\\overline{1} \\times 10^{9}\\,\\text{m}^{-1}.\n$$\n因此\n$$\n\\Delta E_{\\text{elec, mol}} = -\\frac{6.02214076 \\times 10^{23}}{4} \\times \\left(2.30707755 \\times 10^{-28}\\,\\text{J}\\,\\text{m}\\right) \\times \\left(-1.111\\overline{1} \\times 10^{9}\\,\\text{m}^{-1}\\right).\n$$\n合并符号和10的幂次：\n$$\n\\Delta E_{\\text{elec, mol}} \\approx \\frac{6.02214076 \\times 10^{23}}{4} \\times 2.30707755 \\times 10^{-28} \\times 1.111\\overline{1} \\times 10^{9}\\,\\text{J}\\,\\text{mol}^{-1}.\n$$\n计算数值因子：\n$$\n\\frac{6.02214076}{4} \\times 2.30707755 \\times 1.111\\overline{1} \\approx 1.50553519 \\times 2.30707755 \\times 1.111\\overline{1} \\approx 3.840 \\,\\,(\\text{approximately}),\n$$\n并且合并指数 $10^{23-28+9} = 10^{4}$，得到\n$$\n\\Delta E_{\\text{elec, mol}} \\approx 3.859 \\times 10^{4}\\,\\text{J}\\,\\text{mol}^{-1} = 38.59\\,\\text{kJ}\\,\\text{mol}^{-1}.\n$$\n四舍五入到三位有效数字，\n$$\n\\Delta E_{\\text{elec, mol}} = 38.6\\,\\text{kJ}\\,\\text{mol}^{-1}.\n$$\n这个正值表明，在所述的几何和介电假设下，从天冬氨酸到谷氨酸的突变削弱了盐桥（静电作用变得更不利）。", "answer": "$$\\boxed{38.6}$$", "id": "2407798"}, {"introduction": "分子动力学模拟不仅能计算静态能量，更能揭示分子的动态行为。本练习将引导你分析一个简化的分子轨迹[@problem_id:2407812]，通过计算不同能量项对总能量波动的贡献，来确定哪种类型的分子内运动（如键的伸缩、角度的弯曲或范德华相互作用）是系统动态变化的主要来源。这项基于协方差的分析技术是解读模拟结果、理解分子柔性的高级技能。", "problem": "给定一个线性三原子分子的极简分子力学模型，其原子标记为 $0$、$1$ 和 $2$，通过一个包含谐振键项、谐振角项以及原子 $0$ 和 $2$ 之间由 Lennard-Jones 势建模的范德华项的键合力场相互作用。在轨迹帧 $k$ 处，总势能是这三项贡献之和\n$$\nE_{\\text{tot}}^{(k)} = E_{\\text{bond}}^{(k)} + E_{\\text{angle}}^{(k)} + E_{\\text{vdW}}^{(k)}.\n$$\n键合项由以下基本公式定义。对于每个帧 $k$，键伸缩能为\n$$\nE_{\\text{bond}}^{(k)} = \\tfrac{1}{2} k_b \\left(r_{01}^{(k)} - r_0\\right)^2 + \\tfrac{1}{2} k_b \\left(r_{12}^{(k)} - r_0\\right)^2,\n$$\n原子 $1$ 处的角弯曲能为\n$$\nE_{\\text{angle}}^{(k)} = \\tfrac{1}{2} k_{\\theta} \\left(\\theta^{(k)} - \\theta_0\\right)^2,\n$$\n原子 $0$ 和 $2$ 之间的范德华能为\n$$\nE_{\\text{vdW}}^{(k)} = 4 \\varepsilon \\left[\\left(\\frac{\\sigma}{r_{02}^{(k)}}\\right)^{12} - \\left(\\frac{\\sigma}{r_{02}^{(k)}}\\right)^6 \\right].\n$$\n这里 $r_{ij}^{(k)}$ 表示在帧 $k$ 时原子 $i$ 和 $j$ 之间的距离，$\\theta^{(k)}$ 是由原子 $(0,1,2)$ 在原子 $1$ 处形成的键角，$r_0$ 是平衡键长，$\\theta_0$ 是平衡角，$k_b$ 和 $k_{\\theta}$ 是键和角的力常数，$\\varepsilon$ 和 $\\sigma$ 是 Lennard–Jones 参数。所有距离单位必须是纳米 (nm)，角度单位为弧度，能量单位为千焦/摩尔 (kJ/mol)。角度必须以弧度计算。\n\n对于每个帧 $k$，给定内坐标三元组 $\\left(r_{01}^{(k)}, r_{12}^{(k)}, \\theta^{(k)}\\right)$。非键合距离 $r_{02}^{(k)}$ 可通过余弦定理由这些坐标得到：\n$$\nr_{02}^{(k)} = \\sqrt{\\left(r_{01}^{(k)}\\right)^2 + \\left(r_{12}^{(k)}\\right)^2 - 2 \\, r_{01}^{(k)} r_{12}^{(k)} \\cos\\!\\left(\\theta^{(k)}\\right)}.\n$$\n\n将每一项 $i \\in \\{\\text{bond}, \\text{angle}, \\text{vdW}\\}$ 在 $N$ 个帧上对总能量涨落的贡献定义为基于协方差的分数\n$$\nc_i \\equiv \\frac{\\mathrm{Cov}\\!\\left(E_i, E_{\\text{tot}}\\right)}{\\mathrm{Var}\\!\\left(E_{\\text{tot}}\\right)},\n$$\n其中，使用总体（而非样本）定义：\n$$\n\\mu_X = \\frac{1}{N}\\sum_{k=1}^{N} X^{(k)}, \\quad\n\\mathrm{Cov}(X,Y) = \\frac{1}{N}\\sum_{k=1}^{N} \\left(X^{(k)} - \\mu_X\\right)\\left(Y^{(k)} - \\mu_Y\\right), \\quad\n\\mathrm{Var}(X) = \\mathrm{Cov}(X,X).\n$$\n如果 $\\mathrm{Var}\\!\\left(E_{\\text{tot}}\\right) = 0$，则将该测试的结果定义为 $-1$（因为没有涨落，所以贡献未定义）。否则，将“贡献最大的项”定义为绝对贡献值最大的项 $\\arg\\max_{i \\in \\{\\text{bond}, \\text{angle}, \\text{vdW}\\}} \\left|c_i\\right|$，并根据映射关系将其编码为一个整数：键 $\\rightarrow$ $0$，角 $\\rightarrow$ $1$，范德华 $\\rightarrow$ $2$。\n\n使用以下测试套件。每个测试用例指定 $(k_b, r_0, k_{\\theta}, \\theta_0, \\varepsilon, \\sigma)$，其后是作为 $\\left(r_{01}^{(k)}, r_{12}^{(k)}, \\theta^{(k)}\\right)$ 的有序帧列表。\n\n- 测试用例 $1$（键主导的变化）:\n  - 参数: $k_b = 5000$, $r_0 = 0.100$, $k_{\\theta} = 50$, $\\theta_0 = 2.09439510239$, $\\varepsilon = 0.05$, $\\sigma = 0.200$.\n  - 帧 (nm, nm, rad):\n    - $\\left(0.080, 0.100, 2.10\\right)$,\n    - $\\left(0.100, 0.100, 2.09\\right)$,\n    - $\\left(0.120, 0.100, 2.08\\right)$,\n    - $\\left(0.090, 0.100, 2.11\\right)$,\n    - $\\left(0.110, 0.100, 2.09\\right)$.\n\n- 测试用例 $2$（角主导的变化）:\n  - 参数: $k_b = 100$, $r_0 = 0.100$, $k_{\\theta} = 3000$, $\\theta_0 = 2.09439510239$, $\\varepsilon = 0.05$, $\\sigma = 0.200$.\n  - 帧 (nm, nm, rad):\n    - $\\left(0.100, 0.100, 1.80\\right)$,\n    - $\\left(0.100, 0.100, 2.00\\right)$,\n    - $\\left(0.100, 0.100, 2.10\\right)$,\n    - $\\left(0.100, 0.100, 2.30\\right)$.\n\n- 测试用例 $3$（范德华主导的变化）:\n  - 参数: $k_b = 50$, $r_0 = 0.100$, $k_{\\theta} = 20$, $\\theta_0 = 2.09439510239$, $\\varepsilon = 5.0$, $\\sigma = 0.200$.\n  - 帧 (nm, nm, rad):\n    - $\\left(0.100, 0.100, 1.60\\right)$,\n    - $\\left(0.100, 0.100, 1.80\\right)$,\n    - $\\left(0.100, 0.100, 2.00\\right)$,\n    - $\\left(0.100, 0.100, 2.20\\right)$.\n\n- 测试用例 $4$（无涨落）:\n  - 参数: $k_b = 5000$, $r_0 = 0.100$, $k_{\\theta} = 50$, $\\theta_0 = 2.09439510239$, $\\varepsilon = 0.05$, $\\sigma = 0.200$.\n  - 帧 (nm, nm, rad):\n    - $\\left(0.100, 0.100, 2.09439510239\\right)$,\n    - $\\left(0.100, 0.100, 2.09439510239\\right)$,\n    - $\\left(0.100, 0.100, 2.09439510239\\right)$.\n\n你的任务是编写一个完整的、可运行的程序，该程序对每个测试用例，计算所有帧 $k$ 的 $E_{\\text{bond}}^{(k)}$、$E_{\\text{angle}}^{(k)}$、$E_{\\text{vdW}}^{(k)}$ 和 $E_{\\text{tot}}^{(k)}$，然后按上述定义计算 $c_{\\text{bond}}$、$c_{\\text{angle}}$ 和 $c_{\\text{vdW}}$，最后输出具有最大绝对贡献项的编码索引。如果 $\\mathrm{Var}\\!\\left(E_{\\text{tot}}\\right) = 0$，则为该测试用例输出 $-1$。\n\n最终输出格式：你的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的整数列表（例如，“[i1,i2,i3,i4]”），其顺序与测试用例 $1$ 到 $4$ 的顺序相同。", "solution": "本解法基于分子力学定义和关于涨落的概率论。对于每个帧 $k \\in \\{1,\\dots,N\\}$，我们有内坐标 $\\left(r_{01}^{(k)}, r_{12}^{(k)}, \\theta^{(k)}\\right)$。键能项直接由其谐振形式给出，而范德华相互作用由在非键合距离 $r_{02}^{(k)}$ 处计算的 Lennard–Jones 势给出，该距离通过余弦定理获得：\n$$\nr_{02}^{(k)} = \\sqrt{\\left(r_{01}^{(k)}\\right)^2 + \\left(r_{12}^{(k)}\\right)^2 - 2 r_{01}^{(k)} r_{12}^{(k)} \\cos\\!\\left(\\theta^{(k)}\\right)}.\n$$\n因此，对于每个帧 $k$，\n$$\nE_{\\text{bond}}^{(k)} = \\tfrac{1}{2} k_b \\left(r_{01}^{(k)} - r_0\\right)^2 + \\tfrac{1}{2} k_b \\left(r_{12}^{(k)} - r_0\\right)^2,\n$$\n$$\nE_{\\text{angle}}^{(k)} = \\tfrac{1}{2} k_{\\theta} \\left(\\theta^{(k)} - \\theta_0\\right)^2,\n$$\n$$\nE_{\\text{vdW}}^{(k)} = 4 \\varepsilon \\left[\\left(\\frac{\\sigma}{r_{02}^{(k)}}\\right)^{12} - \\left(\\frac{\\sigma}{r_{02}^{(k)}}\\right)^6 \\right],\n$$\n且\n$$\nE_{\\text{tot}}^{(k)} = E_{\\text{bond}}^{(k)} + E_{\\text{angle}}^{(k)} + E_{\\text{vdW}}^{(k)}.\n$$\n\n为量化各项对总涨落的贡献，我们采用基于协方差的分解方法。设 $E_i$ 表示时间序列 $\\{E_i^{(k)}\\}_{k=1}^{N}$，其中 $i \\in \\{\\text{bond}, \\text{angle}, \\text{vdW}\\}$，并设 $E_{\\text{tot}}$ 表示 $\\{E_{\\text{tot}}^{(k)}\\}_{k=1}^{N}$。使用总体定义，\n$$\n\\mu_X = \\frac{1}{N}\\sum_{k=1}^{N} X^{(k)}, \\quad \\mathrm{Cov}(X,Y) = \\frac{1}{N}\\sum_{k=1}^{N} \\left(X^{(k)} - \\mu_X\\right)\\left(Y^{(k)} - \\mu_Y\\right), \\quad \\mathrm{Var}(X) = \\mathrm{Cov}(X,X),\n$$\n我们定义\n$$\nc_i = \\frac{\\mathrm{Cov}\\!\\left(E_i, E_{\\text{tot}}\\right)}{\\mathrm{Var}\\!\\left(E_{\\text{tot}}\\right)}.\n$$\n根据协方差的双线性和恒等式 $E_{\\text{tot}} = E_{\\text{bond}} + E_{\\text{angle}} + E_{\\text{vdW}}$，我们有\n$$\n\\mathrm{Var}\\!\\left(E_{\\text{tot}}\\right) = \\sum_{i \\in \\{\\text{bond}, \\text{angle}, \\text{vdW}\\}} \\mathrm{Cov}\\!\\left(E_i, E_{\\text{tot}}\\right),\n$$\n所以 $c_i$ 的总和为 $1$。如果 $\\mathrm{Var}\\!\\left(E_{\\text{tot}}\\right) = 0$，则没有涨落，贡献未定义；根据题目要求，在这种情况下我们输出 $-1$。否则，所求索引是 $\\left|c_i\\right|$ 的 $\\arg\\max$，按键 $\\rightarrow 0$、角 $\\rightarrow 1$、范德华 $\\rightarrow 2$ 进行编码。\n\n将此方法应用于测试套件：\n\n- 测试用例 $1$ 的参数为 $k_b = 5000$，在 $r_{12}^{(k)}$ 保持在 $r_0$ 的同时，$r_{01}^{(k)}$ 有显著变化，而 $k_{\\theta} = 50$ 和 $\\varepsilon = 0.05$ 使角和范德华项的贡献相对较小。因此，$E_{\\text{bond}}$ 主导了涨落，得到索引 $0$。\n\n- 测试用例 $2$ 的参数为 $k_{\\theta} = 3000$，$\\theta^{(k)}$ 发生变化而键长固定在 $r_0$，同时 $\\varepsilon = 0.05$ 产生中等的范德华项变化。因此 $E_{\\text{angle}}$ 占主导地位，得到索引 $1$。\n\n- 测试用例 $3$ 的参数为 $\\varepsilon = 5.0$ 和 $\\sigma = 0.200$，在相对较小的 $k_{\\theta} = 20$ 和 $k_b = 50$ 以及键长固定在 $r_0$ 的情况下，$\\theta^{(k)}$ 发生变化。$\\theta^{(k)}$ 的变化会引起 $r_{02}^{(k)}$ 的改变，这通过具有较大 $\\varepsilon$ 的 Lennard–Jones 势，产生了主导性的 $E_{\\text{vdW}}$ 涨落，得到索引 $2$。\n\n- 测试用例 $4$ 重复了精确的平衡构型帧，所以 $\\mathrm{Var}\\!\\left(E_{\\text{tot}}\\right) = 0$，结果是 $-1$。\n\n因此，程序应按指定的确切格式，按顺序输出包含整数列表 $[0, 1, 2, -1]$ 的单行。", "answer": "```python\nimport numpy as np\n\ndef compute_contributions(frames, kb, r0, ktheta, theta0, eps, sigma, eps_var=1e-12):\n    \"\"\"\n    Compute the dominant contributor index for a given trajectory.\n\n    Parameters:\n        frames: list of tuples (r01, r12, theta) for each frame\n        kb, r0, ktheta, theta0, eps, sigma: force field parameters\n        eps_var: tolerance for zero variance detection\n\n    Returns:\n        int: 0 for bond, 1 for angle, 2 for vdW, or -1 if total variance is zero\n    \"\"\"\n    frames = np.array(frames, dtype=float)  # shape (N, 3)\n    r01 = frames[:, 0]\n    r12 = frames[:, 1]\n    theta = frames[:, 2]\n\n    # Compute r02 via law of cosines\n    r02_sq = r01**2 + r12**2 - 2.0 * r01 * r12 * np.cos(theta)\n    # Guard against tiny negative due to numerical errors\n    r02_sq = np.maximum(r02_sq, 0.0)\n    r02 = np.sqrt(r02_sq)\n\n    # Energies per frame\n    e_bond = 0.5 * kb * ((r01 - r0)**2 + (r12 - r0)**2)\n    e_angle = 0.5 * ktheta * ((theta - theta0)**2)\n    # Avoid division by zero by adding a tiny epsilon where r02 is zero\n    # (not expected in provided test cases)\n    safe_r02 = np.where(r02 > 0.0, r02, 1e-30)\n    ratio = sigma / safe_r02\n    ratio6 = ratio**6\n    e_vdw = 4.0 * eps * (ratio6**2 - ratio6)\n\n    e_tot = e_bond + e_angle + e_vdw\n\n    # Population variance and covariance\n    def pop_var(x):\n        xm = x - np.mean(x)\n        return np.mean(xm * xm)\n\n    def pop_cov(x, y):\n        xm = x - np.mean(x)\n        ym = y - np.mean(y)\n        return np.mean(xm * ym)\n\n    var_tot = pop_var(e_tot)\n    if var_tot <= eps_var:\n        return -1\n\n    cov_b = pop_cov(e_bond, e_tot)\n    cov_a = pop_cov(e_angle, e_tot)\n    cov_v = pop_cov(e_vdw, e_tot)\n\n    contributions = np.array([cov_b / var_tot, cov_a / var_tot, cov_v / var_tot], dtype=float)\n    idx = int(np.argmax(np.abs(contributions)))\n    return idx\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1\n        {\n            \"kb\": 5000.0, \"r0\": 0.100, \"ktheta\": 50.0, \"theta0\": 2.09439510239, \"eps\": 0.05, \"sigma\": 0.200,\n            \"frames\": [\n                (0.080, 0.100, 2.10),\n                (0.100, 0.100, 2.09),\n                (0.120, 0.100, 2.08),\n                (0.090, 0.100, 2.11),\n                (0.110, 0.100, 2.09),\n            ],\n        },\n        # Test case 2\n        {\n            \"kb\": 100.0, \"r0\": 0.100, \"ktheta\": 3000.0, \"theta0\": 2.09439510239, \"eps\": 0.05, \"sigma\": 0.200,\n            \"frames\": [\n                (0.100, 0.100, 1.80),\n                (0.100, 0.100, 2.00),\n                (0.100, 0.100, 2.10),\n                (0.100, 0.100, 2.30),\n            ],\n        },\n        # Test case 3\n        {\n            \"kb\": 50.0, \"r0\": 0.100, \"ktheta\": 20.0, \"theta0\": 2.09439510239, \"eps\": 5.0, \"sigma\": 0.200,\n            \"frames\": [\n                (0.100, 0.100, 1.60),\n                (0.100, 0.100, 1.80),\n                (0.100, 0.100, 2.00),\n                (0.100, 0.100, 2.20),\n            ],\n        },\n        # Test case 4\n        {\n            \"kb\": 5000.0, \"r0\": 0.100, \"ktheta\": 50.0, \"theta0\": 2.09439510239, \"eps\": 0.05, \"sigma\": 0.200,\n            \"frames\": [\n                (0.100, 0.100, 2.09439510239),\n                (0.100, 0.100, 2.09439510239),\n                (0.100, 0.100, 2.09439510239),\n            ],\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        idx = compute_contributions(\n            frames=case[\"frames\"],\n            kb=case[\"kb\"],\n            r0=case[\"r0\"],\n            ktheta=case[\"ktheta\"],\n            theta0=case[\"theta0\"],\n            eps=case[\"eps\"],\n            sigma=case[\"sigma\"],\n        )\n        results.append(idx)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2407812"}]}