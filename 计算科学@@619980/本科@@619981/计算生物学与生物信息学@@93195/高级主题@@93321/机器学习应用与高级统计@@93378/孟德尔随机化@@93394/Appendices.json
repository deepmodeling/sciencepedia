{"hands_on_practices": [{"introduction": "最简单的孟德尔随机化 (MR) 分析使用单个遗传变异作为工具变量。本练习将指导您完成使用 Wald 比率法计算因果效应的基础步骤，这是 MR 方法的基石。通过这个练习，您将学会如何利用已发表的全基因组关联研究 (GWAS) 汇总数据，估算暴露对结局的因果效应 ($\\beta_{EY}$)，并量化该估计的不确定性 [@problem_id:2854802]。", "problem": "一个单核苷酸多态性 (SNP) $G$ 作为基因调控网络中一个转录调节因子表达水平 $E$ 的顺式表达数量性状基因座 (cis-eQTL)，并且也与一个复杂性状 $Y$ 相关联。考虑一个双样本设置，其样本无重叠，因此 $Y$ 对 $G$ 和 $E$ 对 $G$ 的汇总关联估计值在统计上是独立的。假设存在线性关系、在适当尺度上的可加性、关联估计值的大样本正态性，以及孟德尔随机化 (MR) 的标准工具变量假设：工具变量相关性、工具变量与混杂因素的独立性，以及排除 $G$ 通过 $E$ 以外的任何路径影响 $Y$ 的可能性。给定以下来自回归分析的汇总估计值：$Y$ 对 $G$ 的关联为 $\\hat{\\beta}_{YG} = 0.10$，标准误为 $\\mathrm{SE}(\\hat{\\beta}_{YG}) = 0.03$；$E$ 对 $G$ 的关联为 $\\hat{\\beta}_{EG} = 0.25$，标准误为 $\\mathrm{SE}(\\hat{\\beta}_{EG}) = 0.05$。\n\n仅使用上述假设，计算：\n- $E$ 对 $Y$ 的孟德尔随机化因果效应估计值，\n- 其标准误，\n- 以及在显著性水平 $\\alpha = 0.05$ 下，检验因果效应为零的原假设的双侧 $p$ 值。\n\n将您的结果以行向量 $\\left[\\hat{\\beta}_{\\mathrm{MR}}, \\mathrm{SE}(\\hat{\\beta}_{\\mathrm{MR}}), p\\right]$ 的形式报告。将每个分量四舍五入至三位有效数字。无需单位。", "solution": "该问题要求在一个双样本设置中，计算孟德尔随机化 (MR) 的因果效应估计值、其标准误以及相应的 p 值。我们首先对问题陈述进行验证。\n\n已知条件如下：\n- 一个单核苷酸多态性 (SNP) $G$ 是一个工具变量 (IV)。\n- 暴露是转录调节因子的表达水平 $E$。\n- 结局是一个复杂性状 $Y$。\n- 采用双样本设计，样本无重叠，确保了汇总估计值的统计独立性。\n- 陈述了标准的 MR 假设成立：\n    1. 工具变量相关性：$G$ 与 $E$ 相关。\n    2. 工具变量与混杂因素的独立性：$G$ 与 $E-Y$ 关系中的任何未测量混杂因素均独立。\n    3. 排除限制性：$G$ 仅通过 $E$ 影响 $Y$。\n- $Y$ 对 $G$ 的关联估计值为 $\\hat{\\beta}_{YG} = 0.10$。\n- 该估计值的标准误为 $\\mathrm{SE}(\\hat{\\beta}_{YG}) = 0.03$。\n- $E$ 对 $G$ 的关联估计值为 $\\hat{\\beta}_{EG} = 0.25$。\n- 该估计值的标准误为 $\\mathrm{SE}(\\hat{\\beta}_{EG}) = 0.05$。\n- 假设了估计值的可加性、线性性和大样本正态性。\n- 用于检验的显著性水平为 $\\alpha = 0.05$。\n\n该问题具有科学依据、提法恰当、客观且内部一致。它描述了双样本孟德尔随机化中瓦尔德比率估计量的标准应用，这是遗传流行病学和系统遗传学中的一种基石方法。所有必要的数据和假设均已提供，可以推导出一个唯一且有意义的解。因此，该问题是有效的。\n\n我们开始求解。\n\n首先，我们计算 $E$ 对 $Y$ 的 MR 因果效应估计值，记为 $\\beta_{EY}$。在给定假设下，该效应可以通过 SNP-结局关联与 SNP-暴露关联的比率来估计。这就是瓦尔德比率估计量，对于我们的汇总数据，其形式为：\n$$ \\hat{\\beta}_{\\mathrm{MR}} = \\frac{\\hat{\\beta}_{YG}}{\\hat{\\beta}_{EG}} $$\n代入所提供的值：\n$$ \\hat{\\beta}_{\\mathrm{MR}} = \\frac{0.10}{0.25} = 0.4 $$\n\n其次，我们计算该估计值的标准误 $\\mathrm{SE}(\\hat{\\beta}_{\\mathrm{MR}})$。由于 $\\hat{\\beta}_{YG}$ 和 $\\hat{\\beta}_{EG}$ 来自无重叠样本，它们是独立的随机变量。可以使用一阶泰勒级数展开（Delta 方法）来近似其比率的方差。对于函数 $f(x, y) = x/y$，其方差可近似为：\n$$ \\mathrm{Var}\\left(\\frac{X}{Y}\\right) \\approx \\left(\\frac{\\mu_X}{\\mu_Y}\\right)^2 \\left( \\frac{\\mathrm{Var}(X)}{\\mu_X^2} + \\frac{\\mathrm{Var}(Y)}{\\mu_Y^2} \\right) $$\n将此应用于我们的估计值，其中 $\\mathrm{Var}(\\hat{\\beta}) = \\mathrm{SE}(\\hat{\\beta})^2$：\n$$ \\mathrm{Var}(\\hat{\\beta}_{\\mathrm{MR}}) \\approx \\left(\\frac{\\hat{\\beta}_{YG}}{\\hat{\\beta}_{EG}}\\right)^2 \\left( \\frac{\\mathrm{SE}(\\hat{\\beta}_{YG})^2}{\\hat{\\beta}_{YG}^2} + \\frac{\\mathrm{SE}(\\hat{\\beta}_{EG})^2}{\\hat{\\beta}_{EG}^2} \\right) $$\n从 Delta 方法推导出的一个更直接、更常用的形式是：\n$$ \\mathrm{Var}(\\hat{\\beta}_{\\mathrm{MR}}) \\approx \\frac{\\mathrm{SE}(\\hat{\\beta}_{YG})^2}{\\hat{\\beta}_{EG}^2} + \\frac{\\hat{\\beta}_{YG}^2 \\mathrm{SE}(\\hat{\\beta}_{EG})^2}{\\hat{\\beta}_{EG}^4} $$\n我们将使用这个公式。代入给定值：\n$$ \\mathrm{Var}(\\hat{\\beta}_{\\mathrm{MR}}) \\approx \\frac{(0.03)^2}{(0.25)^2} + \\frac{(0.10)^2 (0.05)^2}{(0.25)^4} $$\n$$ \\mathrm{Var}(\\hat{\\beta}_{\\mathrm{MR}}) \\approx \\frac{0.0009}{0.0625} + \\frac{(0.01)(0.0025)}{0.00390625} $$\n$$ \\mathrm{Var}(\\hat{\\beta}_{\\mathrm{MR}}) \\approx 0.0144 + \\frac{0.000025}{0.00390625} = 0.0144 + 0.0064 = 0.0208 $$\n标准误是方差的平方根：\n$$ \\mathrm{SE}(\\hat{\\beta}_{\\mathrm{MR}}) = \\sqrt{0.0208} \\approx 0.144222051... $$\n\n第三，我们计算原假设 $H_0: \\beta_{\\mathrm{MR}} = 0$ 的双侧 p 值。根据大样本正态性的假设，在原假设下，检验统计量 $Z$ 服从标准正态分布 $\\mathcal{N}(0, 1)$。\n$$ Z = \\frac{\\hat{\\beta}_{\\mathrm{MR}} - 0}{\\mathrm{SE}(\\hat{\\beta}_{\\mathrm{MR}})} = \\frac{\\hat{\\beta}_{\\mathrm{MR}}}{\\mathrm{SE}(\\hat{\\beta}_{\\mathrm{MR}})} $$\n代入计算出的值：\n$$ Z \\approx \\frac{0.4}{0.144222051...} \\approx 2.77350098... $$\n双侧 p 值是观测到至少与 $|Z|$ 一样极端的检验统计量的概率：\n$$ p = 2 \\times P(Z_{std} \\ge |Z|) = 2 \\times (1 - \\Phi(|Z|)) $$\n其中 $\\Phi$ 是标准正态分布的累积分布函数。\n$$ p \\approx 2 \\times (1 - \\Phi(2.7735)) \\approx 2 \\times (1 - 0.99723) \\approx 2 \\times 0.00277 = 0.00554 $$\n\n最后，我们将结果以行向量 $[\\hat{\\beta}_{\\mathrm{MR}}, \\mathrm{SE}(\\hat{\\beta}_{\\mathrm{MR}}), p]$ 的形式报告，并四舍五入至三位有效数字。\n- $\\hat{\\beta}_{\\mathrm{MR}} = 0.4$ 四舍五入至三位有效数字是 $0.400$。\n- $\\mathrm{SE}(\\hat{\\beta}_{\\mathrm{MR}}) \\approx 0.14422...$ 四舍五入至三位有效数字是 $0.144$。\n- $p \\approx 0.00554$ (已经有三位有效数字，$5, 5, 4$)。\n\n最终结果是向量 $[0.400, 0.144, 0.00554]$。", "answer": "$$\\boxed{\\begin{pmatrix} 0.400 & 0.144 & 0.00554 \\end{pmatrix}}$$", "id": "2854802"}, {"introduction": "在我们学习了如何诊断水平多效性之后，一个自然的问题是：当部分工具变量确实无效时，我们该如何获得可靠的因果估计呢？本练习介绍了两种强大的稳健估计方法：加权中位数法和加权众数法。通过实现这些方法，您将理解如何获得对 MR 核心假设（特别是“无水平多效性”假设）的违背不那么敏感的因果效应估计值 [@problem_id:2404047]。", "problem": "实现一个程序，在给定多个独立遗传变异的汇总双样本孟德尔随机化 (MR) 数据的情况下，计算三种因果效应估计量：逆方差加权 (IVW) 估计量、加权中位数估计量和加权众数估计量。背景为孟德尔随机化 (MR)，其中遗传变异可作为暴露-结局关系的工具变量。您将获得变异水平上与暴露和结局的关联估计值及其标准误，并且必须仅使用这些汇总输入，从第一性原理出发计算每种估计量。\n\n假设有 $m$ 个独立的遗传变异（单核苷酸多态性 (SNPs)），索引为 $i \\in \\{1,\\dots,m\\}$。对于每个变异 $i$，给定其与暴露的关联 $\\hat{\\gamma}_{X,i}$、其标准误 $\\operatorname{se}(\\hat{\\gamma}_{X,i})$、与结局的关联 $\\hat{\\gamma}_{Y,i}$ 及其标准误 $\\operatorname{se}(\\hat{\\gamma}_{Y,i})$。假设为无样本重叠的双样本 MR，因此在近似比率估计量的方差时，可以忽略 $\\hat{\\gamma}_{X,i}$ 中的测量误差。为每个变异定义比率估计值\n$$\n\\hat{\\beta}_i \\equiv \\frac{\\hat{\\gamma}_{Y,i}}{\\hat{\\gamma}_{X,i}},\n$$\n近似标准误\n$$\n\\hat{\\sigma}_{\\beta_i} \\equiv \\frac{\\operatorname{se}(\\hat{\\gamma}_{Y,i})}{\\lvert \\hat{\\gamma}_{X,i} \\rvert},\n$$\n以及逆方差权重\n$$\nw_i \\equiv \\frac{1}{\\hat{\\sigma}_{\\beta_i}^2} = \\left(\\frac{\\lvert \\hat{\\gamma}_{X,i} \\rvert}{\\operatorname{se}(\\hat{\\gamma}_{Y,i})}\\right)^2.\n$$\n\n三种估计量的定义如下：\n\n1. 逆方差加权 (IVW) 估计量：\n$$\n\\hat{\\beta}_{\\mathrm{IVW}} \\equiv \\frac{\\sum_{i=1}^m w_i \\hat{\\beta}_i}{\\sum_{i=1}^m w_i}.\n$$\n\n2. 加权中位数估计量：令 $(\\hat{\\beta}_{(1)}, \\dots, \\hat{\\beta}_{(m)})$ 为按非递减顺序排序的比率估计值，其对应的权重 $(w_{(1)}, \\dots, w_{(m)})$ 也进行一致的排列，并令 $W \\equiv \\sum_{i=1}^m w_i$。加权中位数是满足以下条件的任意 $\\hat{\\beta}_{(k)}$\n$$\n\\sum_{j=1}^{k-1} \\frac{w_{(j)}}{W} < 0.5 \\le \\sum_{j=1}^{k} \\frac{w_{(j)}}{W}.\n$$\n返回满足条件的最小的 $\\hat{\\beta}_{(k)}$。\n\n3. 加权众数估计量：对于一个固定的带宽 $h > 0$，为任意 $b \\in \\mathbb{R}$ 定义加权高斯核得分如下\n$$\nS_h(b) \\equiv \\sum_{i=1}^m w_i \\exp\\!\\left(-\\frac{(\\,b - \\hat{\\beta}_i\\,)^2}{2 h^2}\\right).\n$$\n加权众数估计量为\n$$\n\\hat{\\beta}_{\\mathrm{mode}}(h) \\equiv \\operatorname*{arg\\,max}_{b \\in \\mathbb{R}} S_h(b).\n$$\n在数值计算中，应在一个覆盖以下区间的均匀网格上评估 $S_h(b)$\n$$\n\\left[\\min_i \\hat{\\beta}_i - 0.2,\\; \\max_i \\hat{\\beta}_i + 0.2\\right]\n$$\n该网格至少包含 $20001$ 个均匀间隔的点，并取此网格上的最大值点。对所有测试用例使用一个通用的带宽 $h = 0.06$。\n\n您的程序必须为下方的每个测试用例计算 $(\\hat{\\beta}_{\\mathrm{IVW}}, \\hat{\\beta}_{\\mathrm{WM}}, \\hat{\\beta}_{\\mathrm{mode}})$，其中 $\\hat{\\beta}_{\\mathrm{WM}}$ 表示加权中位数，然后将所有结果作为列表的列表打印在单行上，每个内部列表按顺序对应一个测试用例，并且每个数值都四舍五入到恰好 $4$ 位小数。\n\n测试套件 (三个用例)：\n- 用例 A (所有工具变量均有效，围绕单一因果效应聚集)：$m = 12$，数据如下\n$$\n\\hat{\\gamma}_{X} = (0.10, 0.12, 0.08, -0.09, 0.15, -0.11, 0.07, 0.20, -0.13, 0.05, -0.16, 0.14),\n$$\n$$\n\\operatorname{se}(\\hat{\\gamma}_{X}) = (0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02),\n$$\n$$\n\\hat{\\gamma}_{Y} = (0.053, 0.056, 0.042, -0.044, 0.080, -0.057, 0.038, 0.094, -0.062, 0.026, -0.084, 0.072),\n$$\n$$\n\\operatorname{se}(\\hat{\\gamma}_{Y}) = (0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02).\n$$\n\n- 用例 B (恰好 $50\\%$ 的工具变量无效，形成两个聚类；无效集表现出与暴露关联成比例的方向性多效性)：$m = 12$，数据如下\n$$\n\\hat{\\gamma}_{X} = (0.10, 0.12, 0.08, -0.09, 0.15, -0.11, 0.07, 0.20, -0.13, 0.05, -0.16, 0.14),\n$$\n$$\n\\operatorname{se}(\\hat{\\gamma}_{X}) = (0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02),\n$$\n$$\n\\hat{\\gamma}_{Y} = (0.052, 0.057, 0.041, -0.043, 0.079, -0.056, 0.057, 0.156, -0.101, 0.042, -0.132, 0.115),\n$$\n$$\n\\operatorname{se}(\\hat{\\gamma}_{Y}) = (0.015, 0.015, 0.015, 0.015, 0.015, 0.015, 0.03, 0.03, 0.03, 0.03, 0.03, 0.03).\n$$\n在此用例中，$6$ 个变异（前 $6$ 个条目）是有效的，$6$ 个变异（后 $6$ 个条目）是无效的。\n\n- 用例 C (恰好 $50\\%$ 的工具变量无效，其中一个与暴露的关联非常弱)：$m = 12$，数据如下\n$$\n\\hat{\\gamma}_{X} = (0.02, 0.06, -0.07, 0.09, -0.05, 0.11, -0.10, 0.04, 0.13, -0.08, 0.03, 0.12),\n$$\n$$\n\\operatorname{se}(\\hat{\\gamma}_{X}) = (0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02),\n$$\n$$\n\\hat{\\gamma}_{Y} = (0.011, 0.047, -0.034, 0.0655, -0.026, 0.0855, -0.048, 0.029, 0.062, -0.058, 0.016, 0.086),\n$$\n$$\n\\operatorname{se}(\\hat{\\gamma}_{Y}) = (0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02).\n$$\n在此用例中，根据构造，$6$ 个变异是有效的，$6$ 个变异是无效的；第一个条目包含一个非常弱的暴露关联 $\\hat{\\gamma}_{X,1} = 0.02$。\n\n您的程序应生成单行输出，其中包含三个用例的结果，格式为逗号分隔的列表的列表，形式为\n$$\n\\big[\\,[\\hat{\\beta}_{\\mathrm{IVW}}^{(A)}, \\hat{\\beta}_{\\mathrm{WM}}^{(A)}, \\hat{\\beta}_{\\mathrm{mode}}^{(A)}],\\; [\\hat{\\beta}_{\\mathrm{IVW}}^{(B)}, \\hat{\\beta}_{\\mathrm{WM}}^{(B)}, \\hat{\\beta}_{\\mathrm{mode}}^{(B)}],\\; [\\hat{\\beta}_{\\mathrm{IVW}}^{(C)}, \\hat{\\beta}_{\\mathrm{WM}}^{(C)}, \\hat{\\beta}_{\\mathrm{mode}}^{(C)}] \\big],\n$$\n每个数值都四舍五入到恰好 $4$ 位小数。不应打印任何额外文本。角度和物理单位在此不适用。所有数值结果必须以指定的列表的列表格式报告为十进制浮点数。", "solution": "该问题陈述经确认为科学上合理、定义明确且客观。它提出了孟德尔随机化 (MR) 领域内的一项标准计算任务，这是一种在统计遗传学和流行病学中广泛应用的方法。所有必需的数据、数学定义和数值参数均已提供，使得问题本身具有独立性和明确性。所定义的估计量——逆方差加权 (IVW)、加权中位数和加权众数——在 MR 文献中都是标准方法。提供的数值数据对于来自全基因组关联研究的汇总统计数据是符合实际的。因此，我们着手进行求解。\n\n任务是使用来自 $m$ 个独立遗传变异（作为工具变量）的汇总数据，计算暴露对结局的因果效应的三种不同估计量。对于每个变异 $i \\in \\{1, \\dots, m\\}$，我们获得了其与暴露的关联估计值 $\\hat{\\gamma}_{X,i}$、其标准误 $\\operatorname{se}(\\hat{\\gamma}_{X,i})$、与结局的关联估计值 $\\hat{\\gamma}_{Y,i}$ 及其标准误 $\\operatorname{se}(\\hat{\\gamma}_{Y,i})$。\n\n首先，我们为每个变异 $i$ 计算两个关键量：因果效应的比率估计值 $\\hat{\\beta}_i$ 及其对应的逆方差权重 $w_i$。\n\n比率估计值是变异-结局关联与变异-暴露关联的比值：\n$$\n\\hat{\\beta}_i = \\frac{\\hat{\\gamma}_{Y,i}}{\\hat{\\gamma}_{X,i}}\n$$\n该估计值代表了由变异 $i$ 作为工具变量所测得的暴露对结局的因果效应。\n\n此比率估计值的方差可以使用 δ 方法 (delta method) 进行近似。在双样本 MR 且无样本重叠的假设下，$\\hat{\\gamma}_{X,i}$ 和 $\\hat{\\gamma}_{Y,i}$ 之间的协方差为零。此外，我们可以忽略分母 $\\hat{\\gamma}_{X,i}$ 中的不确定性（即针对暴露的“无测量误差”或 NOME 假设），当变异-暴露关联很强时，这是一种常见的简化方法。这导出了近似方差：\n$$\n\\operatorname{Var}(\\hat{\\beta}_i) \\approx \\frac{\\operatorname{Var}(\\hat{\\gamma}_{Y,i})}{\\gamma_{X,i}^2} = \\frac{\\operatorname{se}(\\hat{\\gamma}_{Y,i})^2}{\\gamma_{X,i}^2}\n$$\n用真实效应 $\\gamma_{X,i}$ 的估计值 $\\hat{\\gamma}_{X,i}$ 替换它，可得到比率估计值的估计标准误：\n$$\n\\hat{\\sigma}_{\\beta_i} = \\frac{\\operatorname{se}(\\hat{\\gamma}_{Y,i})}{|\\hat{\\gamma}_{X,i}|}\n$$\n使用绝对值是为了确保标准误为正。每个比率估计值的逆方差权重是其估计方差的倒数：\n$$\nw_i = \\frac{1}{\\hat{\\sigma}_{\\beta_i}^2} = \\left( \\frac{|\\hat{\\gamma}_{X,i}|}{\\operatorname{se}(\\hat{\\gamma}_{Y,i})} \\right)^2\n$$\n这些权重反映了每个单独比率估计值的精度。\n\n在为所有 $m$ 个变异计算出 $\\hat{\\beta}_i$ 和 $w_i$ 后，我们现在可以定义并计算所需的三种估计量。\n\n1.  **逆方差加权 (IVW) 估计量**\n    IVW 估计量 $\\hat{\\beta}_{\\mathrm{IVW}}$ 是各个比率估计值 $\\hat{\\beta}_i$ 的加权平均值，权重为 $w_i$：\n    $$\n    \\hat{\\beta}_{\\mathrm{IVW}} = \\frac{\\sum_{i=1}^m w_i \\hat{\\beta}_i}{\\sum_{i=1}^m w_i}\n    $$\n    在所有变异都是有效工具变量且不存在水平多效性（或任何多效性在零附近是平衡的）的假设下，该估计量是统计有效的。它等同于将 $\\hat{\\gamma}_{Y,i}$ 对 $\\hat{\\gamma}_{X,i}$ 进行加权线性回归（截距约束为零）时得到的斜率。\n\n2.  **加权中位数估计量**\n    当有相当大一部分（最多 $50\\%$）的遗传变异是无效工具变量（即表现出水平多效性）时，加权中位数估计量 $\\hat{\\beta}_{\\mathrm{WM}}$ 能提供一个稳健的估计。计算过程如下：\n    首先，将比率估计值 $\\hat{\\beta}_i$ 按非递减顺序排序，得到 $(\\hat{\\beta}_{(1)}, \\dots, \\hat{\\beta}_{(m)})$。对应的权重 $(w_{(1)}, \\dots, w_{(m)})$ 也进行一致的排列。\n    其次，计算总权重 $W = \\sum_{i=1}^m w_i$。\n    第三，我们找到最小的索引 $k$，使得归一化权重的累积和在该索引处至少为 $0.5$。形式上，我们寻找 $\\hat{\\beta}_{(k)}$ 满足：\n    $$\n    \\sum_{j=1}^{k-1} \\frac{w_{(j)}}{W} < 0.5 \\le \\sum_{j=1}^{k} \\frac{w_{(j)}}{W}\n    $$\n    于是加权中位数估计值为 $\\hat{\\beta}_{\\mathrm{WM}} = \\hat{\\beta}_{(k)}$。该算法包括按 $\\hat{\\beta}_i$ 对 $(\\hat{\\beta}_i, w_i)$ 对进行排序，并找出累积归一化权重首次达到或超过 $0.5$ 时的值。\n\n3.  **加权众数估计量**\n    加权众数估计量 $\\hat{\\beta}_{\\mathrm{mode}}$ 将因果效应确定为单个比率估计值分布的众数，并按其精度进行加权。当最大的一组变异是有效工具变量时，即使它们不占多数，这种方法也特别有用。该众数是通过寻找 $\\hat{\\beta}_i$ 值的加权核密度估计的最大值来估计的。对于给定的带宽 $h > 0$，加权高斯核得分函数 $S_h(b)$ 定义为：\n    $$\n    S_h(b) = \\sum_{i=1}^m w_i \\phi_h(b - \\hat{\\beta}_i) = \\sum_{i=1}^m w_i \\exp\\left(-\\frac{(b - \\hat{\\beta}_i)^2}{2 h^2}\\right)\n    $$\n    这里问题简化了高斯核的归一化因子。该估计量是使此得分最大化的 $b$ 值：\n    $$\n    \\hat{\\beta}_{\\mathrm{mode}}(h) = \\operatorname*{arg\\,max}_{b \\in \\mathbb{R}} S_h(b)\n    $$\n    在数值计算上，这个最大化过程通过网格搜索来执行。我们使用指定的带宽 $h = 0.06$。在区间 $[\\min_i \\hat{\\beta}_i - 0.2, \\max_i \\hat{\\beta}_i + 0.2]$ 上构建一个包含 $20001$ 个点的均匀网格。在此网格的每个点上计算得分 $S_h(b)$，并取产生最大得分的 $b$ 值作为估计值 $\\hat{\\beta}_{\\mathrm{mode}}$。\n\n该程序为所提供的每个测试用例实现了这三种估计量的计算。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes IVW, Weighted Median, and Weighted Mode estimators for Mendelian Randomization.\n    \"\"\"\n    test_cases = [\n        # Case A\n        {\n            \"gamma_x\": np.array([0.10, 0.12, 0.08, -0.09, 0.15, -0.11, 0.07, 0.20, -0.13, 0.05, -0.16, 0.14]),\n            \"se_gamma_x\": np.full(12, 0.02),\n            \"gamma_y\": np.array([0.053, 0.056, 0.042, -0.044, 0.080, -0.057, 0.038, 0.094, -0.062, 0.026, -0.084, 0.072]),\n            \"se_gamma_y\": np.full(12, 0.02),\n        },\n        # Case B\n        {\n            \"gamma_x\": np.array([0.10, 0.12, 0.08, -0.09, 0.15, -0.11, 0.07, 0.20, -0.13, 0.05, -0.16, 0.14]),\n            \"se_gamma_x\": np.full(12, 0.02),\n            \"gamma_y\": np.array([0.052, 0.057, 0.041, -0.043, 0.079, -0.056, 0.057, 0.156, -0.101, 0.042, -0.132, 0.115]),\n            \"se_gamma_y\": np.array([0.015, 0.015, 0.015, 0.015, 0.015, 0.015, 0.03, 0.03, 0.03, 0.03, 0.03, 0.03]),\n        },\n        # Case C\n        {\n            \"gamma_x\": np.array([0.02, 0.06, -0.07, 0.09, -0.05, 0.11, -0.10, 0.04, 0.13, -0.08, 0.03, 0.12]),\n            \"se_gamma_x\": np.full(12, 0.02),\n            \"gamma_y\": np.array([0.011, 0.047, -0.034, 0.0655, -0.026, 0.0855, -0.048, 0.029, 0.062, -0.058, 0.016, 0.086]),\n            \"se_gamma_y\": np.full(12, 0.02),\n        }\n    ]\n\n    H_BANDWIDTH = 0.06\n    MODE_GRID_POINTS = 20001\n    \n    all_results = []\n\n    for case in test_cases:\n        gamma_x = case[\"gamma_x\"]\n        gamma_y = case[\"gamma_y\"]\n        se_gamma_y = case[\"se_gamma_y\"]\n\n        # Calculate ratio estimates and weights\n        beta_hat = gamma_y / gamma_x\n        w = (np.abs(gamma_x) / se_gamma_y)**2\n\n        # 1. Inverse-variance weighted (IVW) estimator\n        ivw_est = np.sum(w * beta_hat) / np.sum(w)\n\n        # 2. Weighted median estimator\n        sorted_indices = np.argsort(beta_hat)\n        beta_hat_sorted = beta_hat[sorted_indices]\n        w_sorted = w[sorted_indices]\n        \n        total_weight = np.sum(w)\n        w_cumsum_norm = np.cumsum(w_sorted) / total_weight\n        \n        median_index = np.where(w_cumsum_norm >= 0.5)[0][0]\n        wm_est = beta_hat_sorted[median_index]\n        \n        # 3. Weighted mode estimator\n        b_min = np.min(beta_hat) - 0.2\n        b_max = np.max(beta_hat) + 0.2\n        b_grid = np.linspace(b_min, b_max, num=MODE_GRID_POINTS)\n\n        # Vectorized calculation of scores S_h(b)\n        b_grid_reshaped = b_grid[:, np.newaxis]\n        diff_sq = (b_grid_reshaped - beta_hat)**2\n        h_sq = 2 * H_BANDWIDTH**2\n        scores = np.sum(w * np.exp(-diff_sq / h_sq), axis=1)\n        \n        mode_est = b_grid[np.argmax(scores)]\n\n        all_results.append([ivw_est, wm_est, mode_est])\n\n    # Format the final output string as a list of lists with 4 decimal places\n    output_str_parts = []\n    for res in all_results:\n        inner_list_str = f\"[{res[0]:.4f}, {res[1]:.4f}, {res[2]:.4f}]\"\n        output_str_parts.append(inner_list_str)\n    \n    final_output_str = f\"[{', '.join(output_str_parts)}]\"\n    print(final_output_str)\n\nsolve()\n```", "id": "2404047"}]}