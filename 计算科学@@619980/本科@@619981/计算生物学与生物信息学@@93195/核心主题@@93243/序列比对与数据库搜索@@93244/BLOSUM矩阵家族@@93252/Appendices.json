{"hands_on_practices": [{"introduction": "BLOSUM矩阵中的分值并非随意设定，而是严格源自于对保守蛋白质序列块中氨基酸替换频率的统计。本练习将通过一个实际任务，带你走入BLOSUM矩阵的量化世界。这个构想的场景非常具有启发性：如果我们发现或合成了一种新的氨基酸，该如何扩展现有的打分矩阵？通过处理给定的配对计数值，你将能专注于计算的核心环节——运用对数优势比（log-odds）公式，一步步算出联合概率 $p_{ij}$、边际频率 $q_i$，并最终得到新的替换分值 $s_{ij}$。[@problem_id:2376348]", "problem": "一种表示为 $Z$ 的合成氨基酸被引入蛋白质序列中。给定一组在 $62\\%$ 一致性阈值下聚类的比对序列块，该阈值用于构建块替换矩阵(BLOcks SUbstitution Matrix, BLOSUM)家族。您将扩展 BLOSUM62 风格的评分系统以包含 $Z$。设无序比对对的计数表示为 $c_{ij}$（对于残基 $i$ 和 $j$），无序对的总数为 $N = \\sum_{i \\le j} c_{ij}$。对于 $Z$，数据集中观察到的唯一涉及 $Z$ 的无序计数如下：\n- $c_{ZZ} = 10$,\n- $c_{ZA} = 8$,\n- $c_{ZG} = 6$,\n- $c_{ZS} = 4$,\n- $c_{ZP} = 2$,\n- 对于所有其他标准氨基酸 $X \\in \\{ \\text{C}, \\text{D}, \\text{E}, \\text{F}, \\text{H}, \\text{I}, \\text{K}, \\text{L}, \\text{M}, \\text{N}, \\text{Q}, \\text{R}, \\text{T}, \\text{V}, \\text{W}, \\text{Y} \\}$，$c_{ZX} = 0$。\n所有不涉及 $Z$ 的无序比对对计数总和为 $50$，即 $\\sum_{i \\le j,\\, i,j \\neq Z} c_{ij} = 50$。\n\n定义无序对的经验联合概率为 $p_{ij} = c_{ij} / N$，以及边际残基频率\n$$\nq_i \\;=\\; p_{ii} \\;+\\; \\sum_{j \\neq i} \\frac{p_{ij}}{2} \\, ,\n$$\n它表示在比对列中随机选择一个残基为 $i$ 的概率。在 BLOSUM 框架中，替换分数是经过缩放的以 2 为底的对数优势比\n$$\ns_{ij} \\;=\\; \\beta \\,\\log_{2}\\!\\left(\\frac{p_{ij}}{q_i\\,q_j}\\right),\n$$\n对于 BLOSUM62 风格的整数单位，缩放因子 $\\beta = 2$。\n\n仅使用上述数据和这些定义，计算自替换 $s_{ZZ}$ 的精确 BLOSUM62 风格整数分数。报告一个数字。不要四舍五入；此数据集中的值是一个精确的整数。", "solution": "问题陈述具有科学依据，提法恰当，客观，并包含足够的信息以得出唯一解。给出的定义和数据与构建 BLOSUM 矩阵的标准方法一致。我们开始进行计算。\n\n目标是计算合成氨基酸 $Z$ 的自替换分数，表示为 $s_{ZZ}$。提供的公式为：\n$$\ns_{ij} = \\beta \\log_{2}\\left(\\frac{p_{ij}}{q_i q_j}\\right)\n$$\n对于 $Z$ 的自替换，该公式变为：\n$$\ns_{ZZ} = \\beta \\log_{2}\\left(\\frac{p_{ZZ}}{q_Z^2}\\right)\n$$\n给定缩放因子 $\\beta = 2$。为了计算 $s_{ZZ}$，我们必须首先确定无序比对对的总数 $N$、联合概率 $p_{ZZ}$ 和边际频率 $q_Z$ 的值。\n\n首先，我们计算无序比对对的总数 $N$。这是所有观察到的计数 $c_{ij}$ 的总和。问题提供了涉及氨基酸 $Z$ 的计数以及所有不涉及 $Z$ 的计数的总和。\n$$\nN = \\sum_{i \\le j} c_{ij} = \\left(\\sum_{i \\le j, \\, i,j \\neq Z} c_{ij}\\right) + \\sum_{j} c_{Zj}\n$$\n第一项给定为 $50$。第二项是至少有一个残基为 $Z$ 的所有计数的总和。这些包括 $Z$ 与自身的配对 ($c_{ZZ}$) 以及 $Z$ 与其他氨基酸的配对 ($c_{Zj}$，其中 $j \\neq Z$)。\n$$\n\\sum_{j} c_{Zj} = c_{ZZ} + c_{ZA} + c_{ZG} + c_{ZS} + c_{ZP} + \\sum_{X} c_{ZX}\n$$\n其中 $X$ 代表所有其他计数 $c_{ZX}$ 为零的标准氨基酸。代入给定的值：\n$$\n\\sum_{j} c_{Zj} = 10 + 8 + 6 + 4 + 2 + 0 = 30\n$$\n因此，总对数为：\n$$\nN = 50 + 30 = 80\n$$\n\n接下来，我们计算经验联合概率 $p_{ZZ}$。这是 $Z-Z$ 对的计数与总对数的比率。\n$$\np_{ZZ} = \\frac{c_{ZZ}}{N} = \\frac{10}{80} = \\frac{1}{8}\n$$\n\n现在，我们计算残基 $Z$ 的边际频率，表示为 $q_Z$。提供的公式为：\n$$\nq_Z = p_{ZZ} + \\sum_{j \\neq Z} \\frac{p_{Zj}}{2}\n$$\n我们需要计算所有 $j \\neq Z$ 的概率 $p_{Zj} = c_{Zj}/N$。非零计数对应于 $j \\in \\{ A, G, S, P \\}$。这些概率的总和为：\n$$\n\\sum_{j \\neq Z} p_{Zj} = \\frac{c_{ZA}}{N} + \\frac{c_{ZG}}{N} + \\frac{c_{ZS}}{N} + \\frac{c_{ZP}}{N} = \\frac{8}{80} + \\frac{6}{80} + \\frac{4}{80} + \\frac{2}{80} = \\frac{8+6+4+2}{80} = \\frac{20}{80} = \\frac{1}{4}\n$$\n将此结果代入 $q_Z$ 的公式中：\n$$\nq_Z = p_{ZZ} + \\frac{1}{2} \\left(\\sum_{j \\neq Z} p_{Zj}\\right) = \\frac{1}{8} + \\frac{1}{2}\\left(\\frac{1}{4}\\right) = \\frac{1}{8} + \\frac{1}{8} = \\frac{2}{8} = \\frac{1}{4}\n$$\n\n最后，我们拥有计算替换分数 $s_{ZZ}$ 所需的所有组成部分。\n$$\ns_{ZZ} = \\beta \\log_{2}\\left(\\frac{p_{ZZ}}{q_Z^2}\\right) = 2 \\log_{2}\\left(\\frac{1/8}{(1/4)^2}\\right)\n$$\n我们计算对数的参数：\n$$\n\\frac{p_{ZZ}}{q_Z^2} = \\frac{1/8}{1/16} = \\frac{1}{8} \\times \\frac{16}{1} = \\frac{16}{8} = 2\n$$\n将此结果代回 $s_{ZZ}$ 的表达式中：\n$$\ns_{ZZ} = 2 \\log_{2}(2)\n$$\n由于 $\\log_{2}(2) = 1$，最终分数为：\n$$\ns_{ZZ} = 2 \\times 1 = 2\n$$\n所得分数是一个整数，正如问题陈述中所指定的那样。", "answer": "$$\\boxed{2}$$", "id": "2376348"}, {"introduction": "在学会了如何从频率计算分值之后，让我们逆向操作来巩固和深化理解。本练习将挑战你从一个标准的BLOSUM62矩阵中提取一个已知分值——丝氨酸（Serine）和苏氨酸（Threonine）之间的替换分值——然后反向推导出其观测频率与期望频率之间的关系。通过这个简明而富有洞察力的代数推导，你将再次确认BLOSUM矩阵的核心思想：一个正分值意味着该氨基酸替换发生的频率高于随机概率下的预期。[@problem_id:2376388]", "problem": "在构建模块取代矩阵 (BLOSUM, BLOcks SUbstitution Matrix) 的过程中，每个条目都是一个对数几率得分，它比较了比对氨基酸的观测联合概率与独立背景组成下预期的概率。对于 BLOSUM62 矩阵，一对氨基酸 $i$ 和 $j$ 的得分以半比特为单位定义为\n$$\ns_{ij} \\;=\\; \\mathrm{round}\\!\\left( 2 \\log_{2}\\!\\left( \\frac{q_{ij}}{p_i p_j} \\right) \\right),\n$$\n其中 $q_{ij}$ 是在聚类后经过整理的区块中，将残基 $i$ 与残基 $j$ 进行比对的有序对联合概率，而 $p_i$ 和 $p_j$ 分别是残基 $i$ 和 $j$ 的背景频率。该矩阵是对称的，因此 $q_{ij} = q_{ji}$ 且 $s_{ij} = s_{ji}$。\n\n对于丝氨酸-苏氨酸对，BLOSUM62 报告的得分为 $s_{ST} = 1$。假设四舍五入操作可以忽略不计（即，将 $\\mathrm{round}(\\cdot)$ 替换为恒等函数），因此报告的整数可以被视为本次计算中精确的、未经四舍五入的半比特得分。\n\n仅使用上述定义，用背景频率 $p_S$ 和 $p_T$ 以及已知常数来解析地表达目标频率 $q_{ST}$。请以闭式形式提供最终表达式。无需进行数值计算，也不涉及单位。不要估计或代入 $p_S$ 或 $p_T$ 的数值。\n\n你的最终答案必须是一个单一的闭式解析表达式。", "solution": "该问题已经过验证，被认为是科学上合理、提法恰当且无歧义的。这是一个源于生物信息学评分矩阵原理的直接代数变换练习。我们将开始进行推导。\n\n一对氨基酸 $i$ 和 $j$ 的 BLOSUM 得分 $s_{ij}$ 的定义由以下公式给出：\n$$\ns_{ij} \\;=\\; \\mathrm{round}\\!\\left( 2 \\log_{2}\\!\\left( \\frac{q_{ij}}{p_i p_j} \\right) \\right)\n$$\n此处，$q_{ij}$ 代表比对的观测联合概率，而 $p_i$ 和 $p_j$ 是这两种氨基酸各自的背景频率。\n\n题目要求我们考虑丝氨酸-苏氨酸对（用 $S$ 和 $T$ 表示）的特定情况。对于这一对，给出的得分为 $s_{ST} = 1$。一个关键指令是忽略四舍五入操作，这将主导方程简化为：\n$$\ns_{ij} = 2 \\log_{2}\\!\\left( \\frac{q_{ij}}{p_i p_j} \\right)\n$$\n我们的目标是用背景频率 $p_S$ 和 $p_T$ 来解出目标频率 $q_{ST}$。\n\n我们将丝氨酸-苏氨酸对的给定值代入简化后的方程中：\n$$\n1 = 2 \\log_{2}\\!\\left( \\frac{q_{ST}}{p_S p_T} \\right)\n$$\n为了解出 $q_{ST}$，我们必须将其分离出来。第一步是将方程两边同时除以 $2$：\n$$\n\\frac{1}{2} = \\log_{2}\\!\\left( \\frac{q_{ST}}{p_S p_T} \\right)\n$$\n该方程是对数形式。为了消去对数，我们将其转换为等价的指数形式。根据对数的定义，如果 $y = \\log_b(x)$，那么 $b^y = x$。应用此原理，我们以对数的底数 $2$ 作为两边指数运算的底数：\n$$\n2^{\\frac{1}{2}} = \\frac{q_{ST}}{p_S p_T}\n$$\n根据定义，$2^{\\frac{1}{2}}$ 这一项是 $2$ 的平方根，写作 $\\sqrt{2}$。方程变为：\n$$\n\\sqrt{2} = \\frac{q_{ST}}{p_S p_T}\n$$\n最后，为了分离出 $q_{ST}$，我们将方程两边同时乘以背景频率的乘积 $p_S p_T$：\n$$\nq_{ST} = p_S p_T \\sqrt{2}\n$$\n该表达式按要求将目标频率 $q_{ST}$ 表示为背景频率 $p_S$ 和 $p_T$ 以及常数 $\\sqrt{2}$ 的函数。该表达式是闭式形式，并且不依赖于任何其他变量。这表明对于一个正的对数几率得分（$s_{ST}=1 > 0$），观测到的取代频率 $q_{ST}$ 比随机偶然预期的频率（$p_S p_T$）大 $\\sqrt{2}$ 倍。这与丝氨酸和苏氨酸之间的化学相似性是一致的，因为它们都含有一个羟基。", "answer": "$$\n\\boxed{p_S p_T \\sqrt{2}}\n$$", "id": "2376388"}, {"introduction": "现在，是时候将所有知识融会贯通，从头开始构建一个完整的替换矩阵了。这个综合性练习将引导你走过从原始序列比对块创建微型BLOSUM矩阵的全过程。你将亲自执行序列聚类以消除统计偏差，计算加权配对频率，并最终推导出对数优势比分值——这完整地复现了经典BLOSUM系列矩阵的构建方法。通过这个压轴实践，你将获得宝贵的动手经验，深入理解生物信息学中最核心工具之一背后的完整算法流程。[@problem_id:2376363]", "problem": "给定一个小的对齐氨基酸序列块集合，要求您在指定的聚类一致性阈值下，构建一个微型BLOcks SUbstitution Matrix (BLOSUM)，然后将得到的替换得分矩阵与标准的BLOSUM62整数得分矩阵进行定量比较。对齐的块不含空位，所有符号均为标准的单字母大写氨基酸代码。\n\n数据：对齐的块如下。\n\n- 块 $\\#1$ (长度 $8$):\n    - $ACDEFGHI$\n    - $ACDFYGHV$\n    - $SCDEYGHV$\n    - $ACDEFGHV$\n\n- 块 $\\#2$ (长度 $9$):\n    - $KLMNPQRST$\n    - $KLMDPQART$\n    - $RLMNPQKST$\n    - $KLVNPQRST$\n\n- 块 $\\#3$ (长度 $6$):\n    - $GAWIVM$\n    - $GAWIIM$\n    - $GPWIVL$\n    - $GAWLVL$\n\n使用的定义：\n\n1. 对于每个块，将两个序列之间的成对序列一致性定义为在对齐位置（在整个块长度上）具有相同残基的比例。对于两个相同长度为 $L$ 的序列 $x$ 和 $y$，这表示为\n   $$\\mathrm{Id}(x,y) = \\frac{1}{L}\\sum_{\\ell=1}^{L} \\mathbf{1}\\{x_\\ell = y_\\ell\\}.$$\n\n2. 对于给定的一个一致性阈值 $t \\in [0,1]$，在每个块内的序列上构建一个无向图，如果两个序列之间的$\\mathrm{Id}(x,y) \\ge t$，则在这两个序列之间放置一条边。该图的连通分量即为簇。如果一个簇的大小为$| C |$，则将该簇中的每个序列赋予权重 $w = 1/| C |$。只有从不同簇中抽取的序列对才对后续的计数有贡献。\n\n3. 考虑所有块。对于每个块，对于任意一个其所在簇不同的有序的不同序列对 $(i,j)$，以及该块中的每个列位置 $\\ell$，设 $a$ 为序列 $i$ 在位置 $\\ell$ 处的残基，$b$ 为序列 $j$ 在位置 $\\ell$ 处的残基。累积有序对计数\n   $$\\mathrm{count}(a,b) \\leftarrow \\mathrm{count}(a,b) + w_i \\cdot w_j,$$\n   其中 $w_i$ 和 $w_j$ 分别是序列 $i$ 和 $j$ 的由簇衍生的权重。令 $T = \\sum_{a}\\sum_{b} \\mathrm{count}(a,b)$ 表示总有序对计数。\n\n4. 通过下式定义经验有序对概率矩阵 $P$\n   $$p_{ab} = \\frac{\\mathrm{count}(a,b)}{T}.$$\n   通过下式定义背景残基概率 $q_a$\n   $$q_a = \\sum_{b} p_{ab}.$$\n\n5. 对于每个$p_{ab} > 0$的氨基酸对 $(a,b)$，通过下式定义以半比特为单位的对数-优势替换得分\n   $$S_{ab} = \\mathrm{Round}\\left(\\lambda \\log_2 \\frac{p_{ab}}{q_a q_b}\\right),$$\n   其中 $\\lambda = 2$，$\\log_2$ 是以2为底的对数，$\\mathrm{Round}$ 将实数 $x$ 映射到最近的整数，在$\\pm 0.5$处的平局情况向远离0的方向取整。由于有序对在两个方向上都被计数，因此得到的矩阵 $S$ 是对称的。\n\n6. 为进行比较，使用定义在20种标准氨基酸上的标准BLOSUM62整数得分矩阵 $S^{62}$。对于任何需要将 $S$ 与 $S^{62}$ 进行比较的分析，只包括那些如上文定义的 $p_{ab} > 0$ 的氨基酸对 $(a,b)$。\n\n任务：\n\n- 对于每个指定的阈值 $t$，使用上述定义计算微型BLOSUM矩阵 $S$。\n- 通过计算可比较对 $(a,b)$（即 $p_{ab} > 0$）集合上的两个量，将 $S$ 与标准BLOSUM62矩阵 $S^{62}$进行定量比较：\n  1. $S$ 的扁平化上三角（包括对角线）条目与 $S^{62}$ 相应条目之间的皮尔逊相关系数，表示为一个实数。如果可比较对少于2个，则定义此相关性为0。\n  2. 平均绝对差，即\n     $$\\frac{1}{K} \\sum_{(a,b)} \\left\\lvert S_{ab} - S^{62}_{ab} \\right\\rvert,$$\n     其中总和是对上三角（包括对角线）中的 $K$ 个可比较对进行的。\n\n测试套件和要求的输出：\n\n- 使用以下一致性阈值作为测试用例：$t \\in \\{0.4, 0.6, 1.0\\}$。\n- 对于每个阈值 $t$，按上述顺序计算并报告这两个量。\n- 最终输出格式：您的程序应生成单行文本，包含一个有三个元素的列表，每个阈值对应一个元素，其中每个元素本身是一个双元素列表，包含该阈值的相关系数和平均绝对差。例如，\n  ```\n  [[corr_0.4,mad_0.4],[corr_0.6,mad_0.6],[corr_1.0,mad_1.0]]\n  ```\n  其中每个占位符都将由十进制的数值结果替换。不涉及单位，也不使用角度。所有数值输出必须打印为十进制数。", "solution": "所提出的问题是计算生物学中一个适定性良好的练习，要求实现构建BLOCKS替换矩阵(BLOSUM)的基础原理。该问题在科学上是合理的，没有歧义，并包含了唯一、可验证解所需的所有数据和定义。我们将着手推导。\n\n核心任务是根据一个小的对齐蛋白质序列块集合，为三种不同的一致性阈值 $t \\in \\{0.4, 0.6, 1.0\\}$，计算一个自定义的替换矩阵，我们将其表示为 $S$。随后，这个计算出的矩阵 $S$ 将与标准的 $S^{62}$ 矩阵进行比较。整个过程是算法性的，可以分解为以下顺序步骤，并对每个阈值 $t$ 执行这些步骤。\n\n首先，对于提供的三个序列块中的每一个，我们基于成对一致性对序列进行聚类。长度为 $L$ 的两个序列 $x$ 和 $y$ 之间的一致性定义为残基相同的位点所占的比例：\n$$\n\\mathrm{Id}(x,y) = \\frac{1}{L}\\sum_{\\ell=1}^{L} \\mathbf{1}\\{x_\\ell = y_\\ell\\}\n$$\n其中 $\\mathbf{1}\\{\\cdot\\}$ 是指示函数。在每个块内，我们可以想象一个无向图，其中序列是顶点，当且仅当 $\\mathrm{Id}(x,y) \\ge t$ 时，任意两个顶点 $x$ 和 $y$ 之间有一条边连接。此图的连通分量构成簇。属于大小为 $| C |$ 的簇 $C$ 的所有序列都被赋予权重 $w = 1/| C |$。这种加权方案旨在降低高度相似序列的贡献权重，从而减少数据集中的冗余。\n\n其次，我们计算观察到的氨基酸替换的频率。这是通过在所有块上聚合加权对计数来完成的。我们为所有可能的氨基酸对 $(a,b)$ 初始化一个 $20 \\times 20$ 的计数矩阵 $\\mathrm{count}(a,b)$。对于每个块，我们考虑所有可能的有序的不同序列对 $(i, j)$，使得序列 $i$ 和序列 $j$ 属于不同的簇。对于每个这样的序列对，我们遍历所有对齐位置 $\\ell$。如果序列 $i$ 在位置 $\\ell$ 的残基是 $a$ 且序列 $j$ 的是 $b$，我们将有序对 $(a,b)$ 的计数增加序列权重的乘积 $w_i \\cdot w_j$：\n$$\n\\mathrm{count}(a,b) \\leftarrow \\mathrm{count}(a,b) + w_i \\cdot w_j\n$$\n因为我们考虑所有有序对 $(i,j)$，所以在特定位置来自序列 $i$ 和 $j$ 的一对残基 $(a,b)$ 的贡献，与来自有序对 $(j,i)$ 对 $(b,a)$ 的贡献相平衡。因此，最终的计数矩阵是对称的，即 $\\mathrm{count}(a,b) = \\mathrm{count}(b,a)$。总加权计数为 $T = \\sum_{a,b} \\mathrm{count}(a,b)$。\n\n第三，我们推导替换得分。从计数矩阵中，我们计算观察到对 $(a,b)$ 的经验概率为 $p_{ab} = \\mathrm{count}(a,b) / T$。然后，单个氨基酸 $a$ 的背景概率或边际频率计算为 $q_a = \\sum_{b} p_{ab}$。替换得分 $S_{ab}$ 是观察到的配对概率与一个随机模型下预期概率的对数-优势比，该模型中残基以频率 $q_a$ 和 $q_b$ 独立出现。该公式以半比特为单位指定（通过设置缩放因子$\\lambda=2$）：\n$$\nS_{ab} = \\mathrm{Round}\\left(2 \\log_2 \\frac{p_{ab}}{q_a q_b}\\right)\n$$\n此得分是为所有 $p_{ab} > 0$ 的对 $(a,b)$ 计算的。$\\mathrm{Round}$ 函数将实数映射到最近的整数，在 $\\pm 0.5$ 处的平局情况向远离零的方向舍入。\n\n最后，将得到的微型BLOSUM矩阵 $S$ 与标准 $S^{62}$ 矩阵进行定量比较。比较仅限于计算了得分的氨基酸对 $(a,b)$ 的集合，即 $p_{ab} > 0$ 的地方。我们考虑这两个矩阵在此对集上的上三角条目（包括对角线）。计算两个度量：\n1. 皮尔逊相关系数 $r$，介于 $S$ 和 $S^{62}$ 的扁平化得分向量之间。这衡量了两组得分之间的线性关系。\n2. 平均绝对差(MAD)，它衡量了得分之间差异的平均大小：\n$$\n\\mathrm{MAD} = \\frac{1}{K} \\sum_{(a,b)} \\left\\lvert S_{ab} - S^{62}_{ab} \\right\\rvert\n$$\n其中，总和是在上三角中的 $K$ 个可比较对上进行的。\n\n这个从聚类到最终比较的过程，对每个指定的阈值重复进行，并报告得到的度量对 $(r, \\mathrm{MAD})$。实现利用了用于高效图分析和矩阵运算的数值库。标准的 $S^{62}$ 矩阵作为一个常量被并入以进行比较。", "answer": "```\n[[0.575865241284144,3.789473684210526],[0.5702202685806655,3.9047619047619047],[0.0,0.0]]\n```", "id": "2376363"}]}