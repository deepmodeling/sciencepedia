{"hands_on_practices": [{"introduction": "要真正掌握邻接法（Neighbor-Joining method），没有什么比动手计算更有效了。第一个练习将指导你完成该算法关键的第一步：基于给定的遗传距离矩阵，确定首先被组合在一起的物种对。掌握这一计算是理解整个系统发育树如何迭代构建的基础。[@problem_id:1771208]", "problem": "一个植物学家团队正在研究五个新发现的向日葵物种之间的进化关系。他们对每个物种的一个特定基因进行了测序，并计算出了一个成对遗传距离矩阵，该矩阵量化了每对物种之间的分歧。这些物种是 *Helianthus arcanus* (HA)、*Helianthus borealis* (HB)、*Helianthus campestris* (HC)、*Helianthus deserticola* (HD) 和 *Helianthus elegans* (HE)。\n\n植物学家们决定使用邻接法（NJ）算法来构建一个系统发育树。您的任务是执行此算法的第一步，以确定哪两个物种最先被组合在一起，形成一个新的内部节点。\n\n遗传距离矩阵如下所示，其中的值代表无单位的遗传分歧度量：\n\n|        | HA | HB | HC | HD | HE |\n| :----: | :-: | :-: | :-: | :-: | :-: |\n| **HA** | 0  | 5  | 4  | 7  | 6  |\n| **HB** | 5  | 0  | 7  | 10 | 9  |\n| **HC** | 4  | 7  | 0  | 7  | 6  |\n| **HD** | 7  | 10 | 7  | 0  | 5  |\n| **HE** | 6  | 9  | 6  | 5  | 0  |\n\n根据此矩阵，下列哪个陈述正确地描述了邻接法算法第一步聚合的结果？\n\nA. 物种对 (*H. deserticola*, *H. elegans*) 被聚合。从该新节点到 *H. arcanus*、*H. borealis* 和 *H. campestris* 的新距离分别为4、7和4。\n\nB. 物种对 (*H. arcanus*, *H. borealis*) 被聚合。从该新节点到 *H. campestris*、*H. deserticola* 和 *H. elegans* 的新距离分别为3、6和5。\n\nC. 物种对 (*H. arcanus*, *H. campestris*) 被聚合。从该新节点到 *H. borealis*、*H. deserticola* 和 *H. elegans* 的新距离分别为4、5和4。\n\nD. 物种对 (*H. deserticola*, *H. elegans*) 被聚合。从该新节点到 *H. arcanus*、*H. borealis* 和 *H. campestris* 的新距离分别为3、2和3。\n\nE. 物种对 (*H. campestris*, *H. deserticola*) 被聚合。从该新节点到 *H. arcanus*、*H. borealis* 和 *H. elegans* 的新距离分别为5.5、8和4。", "solution": "要使用邻接法（NJ）算法，对分类单元 $\\{\\mathrm{HA}, \\mathrm{HB}, \\mathrm{HC}, \\mathrm{HD}, \\mathrm{HE}\\}$ 和距离矩阵 $d(i,j)$ 执行第一步，需要计算行和 $r_{i}=\\sum_{k} d(i,k)$ 以及 $Q$ 矩阵的元素\n$$\nQ(i,j)=(n-2)\\,d(i,j)-r_{i}-r_{j},\n$$\n其中 $n=5$。\n\n首先计算行和：\n$$\n\\begin{aligned}\nr_{\\mathrm{HA}}&=d(\\mathrm{HA},\\mathrm{HB})+d(\\mathrm{HA},\\mathrm{HC})+d(\\mathrm{HA},\\mathrm{HD})+d(\\mathrm{HA},\\mathrm{HE})=5+4+7+6=22,\\\\\nr_{\\mathrm{HB}}&=5+7+10+9=31,\\\\\nr_{\\mathrm{HC}}&=4+7+7+6=24,\\\\\nr_{\\mathrm{HD}}&=7+10+7+5=29,\\\\\nr_{\\mathrm{HE}}&=6+9+6+5=26.\n\\end{aligned}\n$$\n在 $n-2=3$ 的情况下，计算 $Q$ 值：\n$$\n\\begin{aligned}\nQ(\\mathrm{HA},\\mathrm{HB})&=3\\cdot 5-22-31=15-53=-38,\\\\\nQ(\\mathrm{HA},\\mathrm{HC})&=3\\cdot 4-22-24=12-46=-34,\\\\\nQ(\\mathrm{HA},\\mathrm{HD})&=3\\cdot 7-22-29=21-51=-30,\\\\\nQ(\\mathrm{HA},\\mathrm{HE})&=3\\cdot 6-22-26=18-48=-30,\\\\\nQ(\\mathrm{HB},\\mathrm{HC})&=3\\cdot 7-31-24=21-55=-34,\\\\\nQ(\\mathrm{HB},\\mathrm{HD})&=3\\cdot 10-31-29=30-60=-30,\\\\\nQ(\\mathrm{HB},\\mathrm{HE})&=3\\cdot 9-31-26=27-57=-30,\\\\\nQ(\\mathrm{HC},\\mathrm{HD})&=3\\cdot 7-24-29=21-53=-32,\\\\\nQ(\\mathrm{HC},\\mathrm{HE})&=3\\cdot 6-24-26=18-50=-32,\\\\\nQ(\\mathrm{HD},\\mathrm{HE})&=3\\cdot 5-29-26=15-55=-40.\n\\end{aligned}\n$$\n最小的 $Q$ 是 $Q(\\mathrm{HD},\\mathrm{HE})=-40$，所以第一个聚合的对是 $(\\mathrm{HD},\\mathrm{HE})$。\n\n根据NJ算法，聚合 $\\mathrm{HD}$ 和 $\\mathrm{HE}$ 形成的新节点 $U$ 到任何其余分类单元 $k$ 的距离由以下公式给出：\n$$\nd(U,k)=\\frac{d(\\mathrm{HD},k)+d(\\mathrm{HE},k)-d(\\mathrm{HD},\\mathrm{HE})}{2}.\n$$\n使用 $d(\\mathrm{HD},\\mathrm{HE})=5$，为 $k\\in\\{\\mathrm{HA},\\mathrm{HB},\\mathrm{HC}\\}$ 计算这些距离：\n$$\n\\begin{aligned}\nd(U,\\mathrm{HA})&=\\frac{d(\\mathrm{HD},\\mathrm{HA})+d(\\mathrm{HE},\\mathrm{HA})-d(\\mathrm{HD},\\mathrm{HE})}{2}=\\frac{7+6-5}{2}=4,\\\\\nd(U,\\mathrm{HB})&=\\frac{10+9-5}{2}=7,\\\\\nd(U,\\mathrm{HC})&=\\frac{7+6-5}{2}=4.\n\\end{aligned}\n$$\n因此，第一步聚合的是 $(\\mathrm{HD},\\mathrm{HE})$，新节点到 $\\mathrm{HA}$、$\\mathrm{HB}$ 和 $\\mathrm{HC}$ 的新距离分别为4、7和4，这与选项A相符。", "answer": "$$\\boxed{A}$$", "id": "1771208"}, {"introduction": "在掌握了基本计算之后，让我们通过一个更具概念性的问题来加深理解。本练习提供了一个对称且理想化的距离矩阵，让你能够专注于邻接法选择标准（即$Q$矩阵）的核心逻辑。通过分析这个简化案例，你将能建立起强大的直觉，理解为什么最小化$Q$值能准确地识别出数据集中的最近邻对。[@problem_id:2385845]", "problem": "考虑一个包含 $4$ 个分类单元（taxa）的集合，标记为 $A$、$B$、$C$ 和 $D$，其加性成对距离（additive pairwise distances）为 $d(A,B)=2$，$d(C,D)=2$，所有其他成对距离等于 $3$。在邻接（Neighbor-Joining, NJ）法中，要合并的第一对的选择是基于最小化标准矩阵 $Q(i,j)$，该矩阵为 $n$ 个分类单元定义如下：\n$$\nQ(i,j) = (n-2)\\,d(i,j) - \\sum_{k} d(i,k) - \\sum_{k} d(j,k),\n$$\n其中每个求和项都遍历集合中的所有分类单元。使用此定义及 $n=4$，在给定距离下，计算所有无序对 $\\{i,j\\}$ 的 $Q(i,j)$ 的最小值。请以精确整数形式提供您的答案。", "solution": "此问题是有效的，因为它在科学上基于计算生物学的原理，特别是用于系统发育重建的邻接（NJ）法。问题是适定的（well-posed）、客观的，并为获得唯一解提供了所有必要信息。\n\n任务是为一组 $n=4$ 个标记为 $A$、$B$、$C$ 和 $D$ 的分类单元，找到邻接法标准 $Q(i,j)$ 的最小值。给出的成对距离为 $d(A,B)=2$，$d(C,D)=2$，所有其他成对距离等于 $3$。具体来说，这意味着 $d(A,C)=3$，$d(A,D)=3$，$d(B,C)=3$ 和 $d(B,D)=3$。距离是对称的，因此对于任何分类单元对 $\\{i,j\\}$，都有 $d(i,j) = d(j,i)$。\n\nQ矩阵的公式提供如下：\n$$\nQ(i,j) = (n-2)\\,d(i,j) - \\sum_{k} d(i,k) - \\sum_{k} d(j,k)\n$$\n其中求和项遍历集合中的所有分类单元。\n对于 $n=4$ 个分类单元，公式变为：\n$$\nQ(i,j) = (4-2)\\,d(i,j) - \\sum_{k \\in \\{A,B,C,D\\}} d(i,k) - \\sum_{k \\in \\{A,B,C,D\\}} d(j,k)\n$$\n$$\nQ(i,j) = 2\\,d(i,j) - \\sum_{k \\in \\{A,B,C,D\\}} d(i,k) - \\sum_{k \\in \\{A,B,C,D\\}} d(j,k)\n$$\n我们定义 $S_i$ 为从分类单元 $i$ 到集合中所有其他分类单元的距离之和：\n$$\nS_i = \\sum_{k \\in \\{A,B,C,D\\}} d(i,k)\n$$\n那么，$Q(i,j)$ 的公式可以更紧凑地写成：\n$$\nQ(i,j) = 2\\,d(i,j) - S_i - S_j\n$$\n首先，我们为每个分类单元 $i \\in \\{A,B,C,D\\}$ 计算 $S_i$ 的值。按照惯例，一个分类单元到其自身的距离为 $d(i,i)=0$。\n\n对于分类单元 $A$：\n$S_A = d(A,A) + d(A,B) + d(A,C) + d(A,D) = 0 + 2 + 3 + 3 = 8$。\n\n对于分类单元 $B$：\n$S_B = d(B,A) + d(B,B) + d(B,C) + d(B,D) = 2 + 0 + 3 + 3 = 8$。\n\n对于分类单元 $C$：\n$S_C = d(C,A) + d(C,B) + d(C,C) + d(C,D) = 3 + 3 + 0 + 2 = 8$。\n\n对于分类单元 $D$：\n$S_D = d(D,A) + d(D,B) + d(D,C) + d(D,D) = 3 + 3 + 2 + 0 = 8$。\n\n所有的和 $S_i$ 都等于 $8$。现在，我们必须为所有不同的无序对 $\\{i,j\\}$ 计算 $Q(i,j)$。所有这些对的集合是 $\\{A,B\\}$、$\\{A,C\\}$、$\\{A,D\\}$、$\\{B,C\\}$、$\\{B,D\\}$ 和 $\\{C,D\\}$。由于给定距离矩阵的对称性，我们可以根据它们的距离值将这些对分组。对于非相同对，只有两个不同的距离值：$2$ 和 $3$。\n\n情况1：距离 $d(i,j)=2$ 的对。\n这组包括对 $\\{A,B\\}$ 和 $\\{C,D\\}$。我们来计算 $Q(A,B)$：\n$Q(A,B) = 2\\,d(A,B) - S_A - S_B = 2(2) - 8 - 8 = 4 - 16 = -12$。\n由于对称性，$Q(C,D)$ 的计算是相同的：\n$Q(C,D) = 2\\,d(C,D) - S_C - S_D = 2(2) - 8 - 8 = 4 - 16 = -12$。\n\n情况2：距离 $d(i,j)=3$ 的对。\n这组包括对 $\\{A,C\\}$、$\\{A,D\\}$、$\\{B,C\\}$ 和 $\\{B,D\\}$。我们来计算 $Q(A,C)$：\n$Q(A,C) = 2\\,d(A,C) - S_A - S_C = 2(3) - 8 - 8 = 6 - 16 = -10$。\n对于这组中的所有其他对，结果是相同的。例如，对于 $\\{B,D\\}$：\n$Q(B,D) = 2\\,d(B,D) - S_B - S_D = 2(3) - 8 - 8 = 6 - 16 = -10$。\n\n所有计算出的 $Q(i,j)$ 值的集合是 $\\{ -12, -10 \\}$。问题要求在所有无序对中找到 $Q(i,j)$ 的最小值。\n通过比较两种情况下的值可以找到最小值：\n$$\n\\min(Q(A,B), Q(A,C)) = \\min(-12, -10) = -12\n$$\nNJ算法会选择对 $\\{A,B\\}$ 或 $\\{C,D\\}$ 中的一个首先进行合并，因为它们对应于最小的 $Q$ 值。最小值本身是 $-12$。", "answer": "$$\n\\boxed{-12}\n$$", "id": "2385845"}, {"introduction": "现在我们来挑战一个更高级的问题，它将探索邻接法的局限性。这个问题介绍了“Felsenstein区”，这是一个典型的可能导致“长枝吸引”（Long-Branch Attraction, LBA）现象的场景，而长枝吸引是一种可能导致构建出错误系统发育树的人为结果。通过将邻接法应用于这个特定数据集并观察其为何会得出错误结论，你将能深入理解科学研究的一个关键方面：认识到你所选择的工具其背后的假设和潜在缺陷。[@problem_id:2408887]", "problem": "构造一个包含四个分类单元的案例，用于说明被称为Felsenstein区域的长枝吸引构型，具体如下。真实的无根拓扑是划分 $(A,B)\\,|\\,(C,D)$，其中分类单元 $A$ 和 $C$ 具有长外部支，分类单元 $B$ 和 $D$ 具有短外部支，它们由一个短内部支隔开。假设我们不使用模型校正的进化距离，而是使用根据足够长的独立同分布位点估计的未校正汉明距离（也称为 $p$-距离），得到关于分类单元 $\\{A,B,C,D\\}$ 的以下对称距离矩阵 $D = (d_{ij})$：\n$$\nD \\;=\\;\n\\begin{pmatrix}\n0 & 0.6669 & 0.7366 & 0.6692 \\\\\n0.6669 & 0 & 0.6692 & 0.2603 \\\\\n0.7366 & 0.6692 & 0 & 0.6669 \\\\\n0.6692 & 0.2603 & 0.6669 & 0\n\\end{pmatrix}.\n$$\n将邻接法（NJ）逐步应用于矩阵 $D$，以确定NJ方法会推断出的无根拓扑，并解释为何该拓扑相对于真实划分 $(A,B)\\,|\\,(C,D)$ 是不正确的。作为您报告的数值结果，请计算第一次NJ迭代中NJ $Q$-矩阵的最小负值项。将您的答案四舍五入到四位有效数字。以纯数字形式表示最终答案，不带单位。", "solution": "该问题要求将邻接法（NJ）应用于给定的四个分类单元 $\\{A, B, C, D\\}$ 的距离矩阵。目标是确定推断出的拓扑，解释为什么它相对于给定的真实拓扑是不正确的，并计算第一次迭代中NJ $Q$-矩阵的最小负值。\n\n首先验证问题。\n已知条件：\n1.  四个分类单元的集合：$\\{A, B, C, D\\}$。\n2.  真实的无根拓扑：划分 $(A,B)\\,|\\,(C,D)$。\n3.  支长特征（Felsenstein区域）：$A$ 和 $C$ 的外部支长；$B$ 和 $D$ 的外部支短；内部支短。\n4.  距离矩阵 $D$ 是一个未校正汉明距离的对称矩阵：\n    $$\n    D =\n    \\begin{pmatrix}\n    0 & 0.6669 & 0.7366 & 0.6692 \\\\\n    0.6669 & 0 & 0.6692 & 0.2603 \\\\\n    0.7366 & 0.6692 & 0 & 0.6669 \\\\\n    0.6692 & 0.2603 & 0.6669 & 0\n    \\end{pmatrix}\n    $$\n5.  最终的数值结果必须是初始 $Q$-矩阵的最小负值项，并四舍五入到四位有效数字。\n\n验证结论：该问题具有科学依据，提法明确，且客观。它描述了系统发育学中长枝吸引的一个经典场景，为应用标准的邻接算法提供了所有必要的数据。该问题是有效的。\n\n我们开始解题。\n\n邻接算法首先根据距离矩阵 $D$ 构建一个 $Q$-矩阵。对于一个包含 $n$ 个分类单元的集合， $Q$-矩阵的各项定义为：\n$$\nQ_{ij} = (n-2)d_{ij} - \\sum_{k=1}^{n} d_{ik} - \\sum_{k=1}^{n} d_{jk}\n$$\n其中 $d_{ij}$ 是分类单元 $i$ 和 $j$ 之间的距离。\n\n在本问题中，我们有 $n=4$ 个分类单元。因此，系数 $(n-2)$ 等于 $2$。我们定义 $u_i = \\sum_{k=1}^{4} d_{ik}$，它表示分类单元 $i$ 到所有其他分类单元的距离之和。$Q_{ij}$ 的公式变为：\n$$\nQ_{ij} = 2d_{ij} - u_i - u_j\n$$\n\n首先，我们为每个分类单元 $i \\in \\{A, B, C, D\\}$ 计算 $u_i$ 的值。\n$$\nu_A = d_{AB} + d_{AC} + d_{AD} = 0.6669 + 0.7366 + 0.6692 = 2.0727\n$$\n$$\nu_B = d_{BA} + d_{BC} + d_{BD} = 0.6669 + 0.6692 + 0.2603 = 1.5964\n$$\n$$\nu_C = d_{CA} + d_{CB} + d_{CD} = 0.7366 + 0.6692 + 0.6669 = 2.0727\n$$\n$$\nu_D = d_{DA} + d_{DB} + d_{DC} = 0.6692 + 0.2603 + 0.6669 = 1.5964\n$$\n\n接下来，我们计算 $Q$-矩阵中所有不同分类单元对的非对角线项。\n$$\nQ_{AB} = 2d_{AB} - u_A - u_B = 2(0.6669) - 2.0727 - 1.5964 = 1.3338 - 3.6691 = -2.3353\n$$\n$$\nQ_{AC} = 2d_{AC} - u_A - u_C = 2(0.7366) - 2.0727 - 2.0727 = 1.4732 - 4.1454 = -2.6722\n$$\n$$\nQ_{AD} = 2d_{AD} - u_A - u_D = 2(0.6692) - 2.0727 - 1.5964 = 1.3384 - 3.6691 = -2.3307\n$$\n$$\nQ_{BC} = 2d_{BC} - u_B - u_C = 2(0.6692) - 1.5964 - 2.0727 = 1.3384 - 3.6691 = -2.3307\n$$\n$$\nQ_{BD} = 2d_{BD} - u_B - u_D = 2(0.2603) - 1.5964 - 1.5964 = 0.5206 - 3.1928 = -2.6722\n$$\n$$\nQ_{CD} = 2d_{CD} - u_C - u_D = 2(0.6669) - 2.0727 - 1.5964 = 1.3338 - 3.6691 = -2.3353\n$$\n\n完整的 $Q$-矩阵（对角线项未定义）是：\n$$\nQ =\n\\begin{pmatrix}\n- & -2.3353 & -2.6722 & -2.3307 \\\\\n-2.3353 & - & -2.3307 & -2.6722 \\\\\n-2.6722 & -2.3307 & - & -2.3353 \\\\\n-2.3307 & -2.6722 & -2.3353 & -\n\\end{pmatrix}\n$$\n\n此 $Q$-矩阵中的最小负值项是 $-2.6722$。这个值出现在两对分类单元中：$(A,C)$ 和 $(B,D)$。将此值四舍五入到四位有效数字得到 $-2.672$。这就是所要求的数值结果。\n\n为了确定推断的拓扑，我们继续执行NJ算法。该算法识别使 $Q_{ij}$ 最小的分类单元对 $(i,j)$。在这种情况下，$(A,C)$ 和 $(B,D)$ 之间出现了平局。NJ算法可以通过选择任意一对继续进行。我们选择连接分类单元 $A$ 和 $C$。一个新的节点，我们称之为 $U$，被创建出来，并计算从 $U$ 到 $A$ 和 $C$ 的支长。然后为余下的分类单元 $\\{B, D, U\\}$ 计算一个新的距离矩阵。当只剩下三个分类单元时，算法通过将它们连接到一个中心节点而终止。最终的无根树结构将分支 $(A,C)$ 与 $B$ 和 $D$ 连接为姐妹群。这对应于由划分 $(A,C)\\,|\\,(B,D)$ 定义的无根拓扑。如果我们当初选择先连接对 $(B,D)$，结果将是相同的，产生同样的拓扑。\n\n问题陈述真实的拓扑是划分 $(A,B)\\,|\\,(C,D)$。然而，NJ算法推断出的拓扑是 $(A,C)\\,|\\,(B,D)$。因此，NJ算法返回了一个不正确的结果。\n\n这种失败的原因是系统发育重建中一个众所周知的非自然结果，称为长枝吸引（LBA）。该问题设置在所谓的Felsenstein区域内，该区域旨在诱导LBA。真实的树具有通往分类单元 $A$ 和 $C$ 的长外部支。在这些长枝上，发生了大量的替换。使用未校正的汉明（$p$-）距离未能考虑在同一位点发生的多次替换（饱和）。这导致对远缘相关分类单元之间的进化距离产生系统性低估。因此，测量出的距离 $d_{AC}$ 比真实的进化路径长度要短。\n\n此外，由于沿两条长枝发生了大量的独立替换，分类单元 $A$ 和 $C$ 有很大可能性会巧合地获得相同的性状状态（同塑性）。这使得它们看起来彼此之间比与它们各自真实的、关系更近的姐妹分类单元（即 $B$ 和 $D$）更相似，后者位于短枝上，经历的变化较少。\n\nNJ算法作为一种基于距离的方法，对输入距离矩阵的不准确性非常敏感。未经校正的距离因饱和和同塑性而失真，其非加性特征误导了该算法。$Q$-矩阵最小化准则错误地将长枝对 $(A,C)$ 识别为邻居，因为它们被低估的距离使得它们人为地显得很近。这导致该算法将长枝“吸引”到一起，从而得到不正确的拓扑 $(A,C)\\,|\\,(B,D)$，而不是真实的拓扑 $(A,B)\\,|\\,(C,D)$。这展示了一个经典案例，说明如果距离法不与适当的进化模型结合使用以校正多次击中，它们可能会失败。", "answer": "$$\n\\boxed{-2.672}\n$$", "id": "2408887"}]}