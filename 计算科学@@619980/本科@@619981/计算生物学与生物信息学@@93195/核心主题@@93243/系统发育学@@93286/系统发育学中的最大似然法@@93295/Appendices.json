{"hands_on_practices": [{"introduction": "最大似然法系统发育分析的输出不仅仅是一张树状图，其分支的长度蕴含着精确的统计学意义。这个练习将帮助您巩固对分支长度的理解，即它代表了在特定演化模型下估算出的演化变化量。准确解读分支长度是阅读和理解系统发育学文献的一项基本技能，能够避免将其与一些常见但错误的直觉（如“活化石”或物种形成速率）相混淆 [@problem_id:1946202]。", "problem": "一个进化生物学家团队正在使用来自一个线粒体基因的DNA序列数据，研究四种深海珊瑚（物种A、B、C和D）之间的关系。他们对序列进行比对，并采用最大似然（ML）系统发育分析，这是一种用于推断进化树的统计方法。ML算法会根据给定的树拓扑结构和核苷酸替换模型，计算观测到的序列数据的似然值，其输出包括一个分支长度图（phylogram），其中分支长度与估计的进化变化量成正比。\n\n得到的系统发育图显示了 ((A,B),C),D) 的树拓扑结构。通往物种A、物种B的分支以及连接它们的内部分支都相对较短。通往物种C的分支长度中等。然而，通往物种D的末端分支异常地长，这表明ML模型为该谱系估计的分支长度参数值很高。\n\n根据最大似然系统发育学的原理，以下哪个陈述为通往物种D的长分支提供了最直接和确切的解释？\n\nA. 物种D是一个“活化石”，代表了整个类群的祖先状态。\n\nB. 与其他谱系相比，通往物种D的谱系中的线粒体基因在每个位点上累积了显著更多的估计核苷酸替换数。\n\nC. 物种D的序列数据可能包含大量测序错误，模型将其误认为是真实的突变。\n\nD. 物种D必定是包含物种A、B和C的进化枝的外群。\n\nE. 在通往物种D的谱系中，物种形成速率要慢得多。", "solution": "在指定核苷酸替换模型的最大似然系统发育分析中，似然值为 $\\mathcal{L}(\\text{data} \\mid \\text{topology}, \\{\\ell_{i}\\}, \\theta)$，其中 $\\ell_{i}$ 是分支长度，$\\theta$ 是模型参数。分支长度的ML估计值使该似然值最大化，并被解释为沿每个分支每位点的预期替换数，通常以“替换数/位点”为单位表示。形式上，对于一个随时间变化的瞬时替换率为 $r(t)$ 的谱系，其分支长度为 $\\ell=\\int r(t)\\,dt$，因此，一个更大的 $\\ell$ 反映了沿该谱系累积的每位点预期替换数更大。\n\n在报告的分支长度图中，通往物种D的末端分支相对于其他分支异常地长。根据ML分支长度图中分支长度的定义，最直接和确切的解释是，ML模型估计出沿通往D的谱系发生的每位点核苷酸替换数远大于其他谱系。\n\n评估各个选项：\n- A是错误的：长分支并不表示祖先状态；它表示推断出的变化更大，而不是停滞或原始性。\n- B是正确的：在ML模型下，更长的分支长度直接意味着该谱系上每个位点的估计替换数更多。\n- C不是一个直接或确切的解释：虽然测序错误原则上可以夸大表观的变化，但这只是一个关于数据质量的推测性假设，并不能仅从ML的输出中得出。\n- D是错误的：长分支并不意味着是外群状态；确定根需要外部信息，而长分支吸引是一个已知的假象，但它既不是一个确定的结论，也不是外群的定义。\n- E是错误的：分支长度反映的是分子变化（每位点的替换数），而不是物种形成速率。\n\n因此，最直接和确切的解释是，通往物种D的谱系累积了更多的每位点估计替换数。", "answer": "$$\\boxed{B}$$", "id": "1946202"}, {"introduction": "在理解了分支长度的含义之后，下一步是深入探究似然值本身是如何计算的。这个练习是一个思想实验，它利用一个完全没有变异的理想化数据集，来揭示替换模型的核心参数（尤其是碱基的平稳频率）如何决定似然值的基线。通过这个极端简化的场景，您可以建立起关于最大似然法优化过程的直观认识 [@problem_id:2402753]。", "problem": "考虑四个标记为 $A$、$B$、$C$ 和 $D$ 的分类单元。设 $T_1$ 是无根二叉拓扑 $((A,B),(C,D))$， $T_2$ 是无根二叉拓扑 $((A,C),(B,D))$。序列沿着每棵树根据 Jukes–Cantor $1969$ (JC$69$) 模型进行演化，该模型假设所有核苷酸对之间具有相等的平衡碱基频率和相等的替换速率、平稳性以及时间可逆性。假设位点独立且各位点的演化参数相同。内部节点的状态是未观测到的，将通过求和进行边缘化。所有枝长都是自由的非负参数，将通过最大似然（maximum likelihood (ML)）进行优化。\n\n给定一个长度为 $10$ 的多序列比对，其中在每个位点，叶节点上观测到的核苷酸对于 $(A,B,C,D)$ 分别是 $(A,A,A,A)$。在上述 JC$69$ 模型下，给定该比对，通过优化各自的所有枝长，确定 $T_1$ 和 $T_2$ 可达到的最大对数似然（自然对数）。以精确的解析表达式报告该共同值。不要进行近似或四舍五入。", "solution": "在一个具有枝长的固定无根树上，单个位点在连续时间、时间可逆替换模型下的似然，是通过对内部节点所有可能的状态求和得到的。求和项为任意根节点状态的平衡概率与沿每条分支的转移概率的乘积。在 Jukes–Cantor $1969$ (JC$69$) 模型下，核苷酸的平衡分布是均匀的，因此 $\\pi_A = \\pi_C = \\pi_G = \\pi_T = \\frac{1}{4}$。\n\n对于给定的比对，10 个位点中每一个的叶节点观测状态都是 $(A,A,A,A)$。考虑任意一个位点。设所考虑的无根树的边集 $E$ 对应的枝长为 $\\{t_e\\}_{e \\in E}$。该位点的似然为\n$$\nL_{\\text{site}}(\\{t_e\\}) \\;=\\; \\sum_{r \\in \\{A,C,G,T\\}} \\pi_r \\sum_{\\text{internal assignments consistent with }r} \\prod_{e \\in E} P\\big(s_u \\to s_v \\,\\big|\\, t_e\\big),\n$$\n其中 $P(\\cdot \\mid t_e)$ 是 JC$69$ 模型下，在长度为 $t_e$ 的边 $e$ 上，从相邻节点状态 $s_u$ 转移到 $s_v$ 的转移概率。\n\n在 JC$69$ 模型下，对于任意长度为 $t_e$ 的边，不发生变化的概率至多为 $1$，且当且仅当 $t_e = 0$ 时等号成立，而任何变化的概率都是非负的。对于叶节点上的恒定模式 $(A,A,A,A)$，当内部节点的状态也都是 $A$ 且所有边都对应于不发生变化时，$L_{\\text{site}}$ 的贡献达到最大。因为沿任何分支从 $A$ 发生的任何变化，都需要树中其他地方发生补偿性变化才能使所有叶节点都回到 $A$，所以任何允许变化的严格正枝长都只会相对于所有枝长为零的情况降低这种模式的概率。因此，位点似然在所有枝长$t_e = 0$（对于所有 $e \\in E$）的边界处达到最大值：\n$$\nL_{\\text{site}}^{\\max} \\;=\\; \\sum_{r \\in \\{A,C,G,T\\}} \\pi_r \\cdot \\mathbf{1}\\{r = A\\} \\;=\\; \\pi_A \\;=\\; \\frac{1}{4}.\n$$\n这个最大值不依赖于树的拓扑结构，因为当所有边的$t_e = 0$时，每个转移矩阵都是单位矩阵，因此观测到 $(A,A,A,A)$ 的概率恰好是 $A$ 的平稳概率，而与分类单元的连接方式无关。\n\n根据位点间的独立性，完整比对的似然是各位点似然的乘积。对于 10 个相同的恒定位点，\n$$\nL_{\\text{alignment}}^{\\max} \\;=\\; \\left(\\frac{1}{4}\\right)^{10}.\n$$\n使用自然对数的对数似然为\n$$\n\\ln L_{\\text{alignment}}^{\\max} \\;=\\; 10 \\,\\ln\\!\\left(\\frac{1}{4}\\right) \\;=\\; -10 \\,\\ln 4.\n$$\n由于此论证同样适用于 $T_1$ 和 $T_2$，因此对于给定的比对，在 JC$69$ 模型下，两种拓扑结构都达到了相同的最大对数似然值 $-10 \\ln 4$。", "answer": "$$\\boxed{-10 \\ln 4}$$", "id": "2402753"}, {"introduction": "理论模型和计算方法最终要应用于真实的生物学数据，而真实数据往往是不完美的。这个实践问题将带您直面一个常见挑战：序列比对中的缺失数据。本练习旨在阐明最大似然框架如何严谨地处理不完整的信息，以及这对我们估算的演化参数（如分支长度 $b_D$）的准确性和精确性会产生何种影响 [@problem_id:2402743]。", "problem": "在最大似然（ML）法进行的系统发育分析中，考虑一个固定的、正确指定的四个分类单元的无根树，其拓扑结构已知，但枝长未知。假设一个时间同质、时间可逆、平稳的核苷酸替换模型，其碱基频率相等，替换速率也相等（Jukes–Cantor模型），并且有一个长度为 $N$ 的比对，其中各位点在该树上独立同分布地演化。其中一个分类单元，称为分类单元 $D$，其 $90\\%$ 的位点被编码为缺失数据（用符号“?”表示），且分类单元 $D$ 的数据缺失在各位点间独立发生，并且与真实的核苷酸状态无关（即完全随机缺失）。在标准的ML缺失数据处理方法下，叶节点上的“?”被视为未知/模糊状态，单位点似然值是在该叶节点所有可能的真实核苷酸状态上进行边缘化计算的。\n\n设 $b_{D}$ 表示连接到分类单元 $D$ 的末端枝长。以下哪个陈述最准确地描述了分类单元 $D$ 上 $90\\%$ 的缺失数据对 $b_{D}$ 的最大似然估计的影响？\n\nA. 只有能观察到分类单元 $D$ 的大约 $0.1N$ 个位点直接为 $b_{D}$ 提供信息；在模型下，剩下的大约 $0.9N$ 个位点对 $b_{D}$ 没有贡献任何信息，因此当 $N \\to \\infty$ 时，$b_{D}$ 的最大似然估计保持一致性，但相对于完整数据的情况，其方差增加了。\n\nB. 因为“?”被视为与每个核苷酸都匹配，缺失位点的单位点似然值对较长的枝长惩罚最强，因此随着 $N$ 的增加，$b_{D}$ 的最大似然估计被驱动向 $0$。\n\nC. 分类单元 $D$ 的 $90\\%$ 的缺失数据导致树中所有的枝长，包括与 $D$ 无关的内部枝，被低估大约 $90\\%$。\n\nD. 缺失位点诱导算法为分类单元 $D$ 填补随机的核苷酸，这会系统性地将 $b_{D}$ 的最大似然估计值抬高到其真实值之上。\n\nE. 无论其他分类单元的数据如何，在 $D$ 存在 $90\\%$ 缺失数据的情况下，与 $D$ 相邻的内部枝变得不可识别，因此对于该枝，最大似然估计问题缺少一个明确定义的最大值。", "solution": "鉴于独立性的假设，给定树拓扑和枝长 $\\mathbf{b}$ 时，比对 $S$ 的总似然是每个位点似然的乘积：\n$$L(\\mathbf{b} | S) = \\prod_{i=1}^{N} L_i(\\mathbf{b} | S_i)$$\n其中 $S_i$ 是位点 $i$ 的字符数据。对数似然为 $\\ell(\\mathbf{b}) = \\sum_{i=1}^{N} \\log L_i(\\mathbf{b} | S_i)$。\n\n单个位点的似然是使用 Felsenstein 的剪枝算法计算的。该算法通过在每个内部节点上递归计算“部分似然”，并对每个节点所有可能的状态求和，来计算树叶节点上观察到的状态的概率。\n\n让我们分析比对中两种类型位点的计算：\n1.  **能够观察到分类单元 $D$ 的位点**：这对应大约 $0.1N$ 个位点。在这样的位点上，分类单元 $D$ 的状态是一个特定的核苷酸（例如，$A$、$C$、$G$ 或 $T$）。剪枝算法从这个叶节点开始，其部分似然向量对于观察到的状态为 $1$，对于其他状态为 $0$（例如，对于状态 $A$，向量为 $(1, 0, 0, 0)^T$）。这个向量沿着长度为 $b_D$ 的枝向树的上方传播。该位点的似然贡献将明确地依赖于枝长为 $b_D$ 的转移概率。因此，这些位点包含有关 $b_D$ 的信息。\n\n2.  **分类单元 $D$ 缺失的位点**：这对应大约 $0.9N$ 个位点。分类单元 $D$ 的状态是“?”。标准的ML实践将其视为模糊性，意味着真实状态可能是任何可能的核苷酸。似然是通过对这些可能性进行边缘化计算得出的。在剪枝算法中，这是通过将分类单元 $D$ 的初始部分似然向量设置为 $(1, 1, 1, 1)^T$ 来实现的。\n\n设 $P(b_D)$ 是通向分类单元 $D$ 的枝的转移概率矩阵。该矩阵的元素 $[P(b_D)]_{xy}$ 给出了在祖先节点状态为 $x$ 的条件下，在叶节点观察到状态 $y$ 的概率。当这个向量从叶节点 $D$ 传播到其父节点 $u$ 时，得到的部分似然向量由 $P(b_D)^T (1, 1, 1, 1)^T$ 给出。\n\n对于任何时间可逆的替换模型，包括Jukes-Cantor模型，转移矩阵 $P(t)$ 的各列之和为 $1$。这是因为碱基的均匀分布是平稳分布。因此，转置矩阵 $P(t)^T$ 的每一行之和为 $1$。乘积 $P(b_D)^T (1, 1, 1, 1)^T$ 的结果是一个向量，其元素是 $P(b_D)^T$ 各行之和，即 $(1, 1, 1, 1)^T$。\n\n这意味着包含分类单元 $D$ 的子树对树其余部分的部分似然贡献是一个全为1的向量，该向量与枝长 $b_D$ 无关。因此，对于任何分类单元 $D$ 为“?”的位点，其总似然不是 $b_D$ 的函数。\n\n总对数似然可以被划分为：\n$$\\ell(\\mathbf{b}) = \\sum_{i \\in \\text{sites with observed } D} \\log L_i(\\mathbf{b}) + \\sum_{j \\in \\text{sites with missing } D} \\log L_j(\\mathbf{b})$$\n为了找到 $b_D$ 的最大似然估计，我们求解 $\\frac{\\partial \\ell(\\mathbf{b})}{\\partial b_D} = 0$。\n导数为：\n$$\\frac{\\partial \\ell(\\mathbf{b})}{\\partial b_D} = \\sum_{i \\in \\text{sites with observed } D} \\frac{\\partial \\log L_i(\\mathbf{b})}{\\partial b_D} + \\sum_{j \\in \\text{sites with missing } D} \\frac{\\partial \\log L_j(\\mathbf{b})}{\\partial b_D}$$\n由于对于 $D$ 处有缺失数据的位点，$L_j(\\mathbf{b})$ 与 $b_D$ 无关，因此第二项为零。\n$$\\frac{\\partial \\ell(\\mathbf{b})}{\\partial b_D} = \\sum_{i \\in \\text{sites with observed } D} \\frac{\\partial \\log L_i(\\mathbf{b})}{\\partial b_D}$$\n这表明，只有能够观察到分类单元 $D$ 数据的位点，才对其末端枝长 $b_D$ 的估计有贡献。\n\n其统计学后果如下：\n- **一致性**：$b_D$ 的最大似然估计量基于一个约为 $0.1N$ 的有效样本量。由于当 $N \\to \\infty$ 时，这个样本量仍然趋于无穷大，因此 $b_D$ 的最大似然估计量保持一致性（即，它依概率收敛于 $b_D$ 的真实值）。不存在系统性偏差。\n- **方差**：关于一个参数的信息量与样本量有关。$b_D$ 的费雪信息（Fisher Information）现在仅源自大约 $10\\%$ 的位点。由于最大似然估计量的渐近方差是费雪信息的倒数，因此 $b_D$ 估计的方差将大约是完整数据情况下的10倍。\n\n现在，我们评估每个选项：\n\n**A. 只有能观察到分类单元 $D$ 的大约 $0.1N$ 个位点直接为 $b_{D}$ 提供信息；在模型下，剩下的大约 $0.9N$ 个位点对 $b_{D}$ 没有贡献任何信息，因此当 $N \\to \\infty$ 时，$b_{D}$ 的最大似然估计保持一致性，但相对于完整数据的情况，其方差增加了。**\n该陈述与我们的推导完全一致。分类单元 $D$ 缺失数据的位点对对数似然关于 $b_D$ 的梯度的贡献为零，这意味着它们不为 $b_D$ 的估计提供任何信息。估计量保持一致性，因为信息位点的数量仍然随着 $N$ 的增长而趋于无穷。方差增加是因为有效样本量大大减少了。**正确。**\n\n**B. 因为“?”被视为与每个核苷酸都匹配，缺失位点的单位点似然值对较长的枝长惩罚最强，因此随着 $N$ 的增加，$b_{D}$ 的最大似然估计被驱动向 $0$。**\n这是不正确的。如上所示，缺失位置的单位点似然与 $b_D$ 无关。它既不惩罚也不奖励任何特定的 $b_D$ 值。$b_D$ 的最大似然估计是一致的，而不是偏向于 $0$。**不正确。**\n\n**C. 分类单元 $D$ 的 $90\\%$ 的缺失数据导致树中所有的枝长，包括与 $D$ 无关的内部枝，被低估大约 $90\\%$。**\n这是不正确的。其他枝长（例如，分类单元 $A$、$B$ 和 $C$ 子树内的枝长）的估计利用了所有 $N$ 个位点的信息。对于 $D$ 缺失的 $90\\%$ 的位点，数据表现得像一个三分类单元的比对，这对于 $A$、$B$ 和 $C$ 之间的关系仍然是信息性的。没有理由预期会出现系统性低估，更不用说低估 $90\\%$。所有枝长的估计量都应该是一致的。**不正确。**\n\n**D. 缺失位点诱导算法为分类单元 $D$ 填补随机的核苷酸，这会系统性地将 $b_{D}$ 的最大似然估计值抬高到其真实值之上。**\n这是对ML方法的错误描述。ML不会用随机值来填补（impute）缺失数据。它正确地对不确定性进行积分（边缘化）。这个过程不会引入系统性偏差；$b_D$ 的估计量是一致的。用随机数据填补可能会导致偏差（高估 $b_D$，因为随机数据会比真实数据看起来分化更大），但这不是指定算法所做的。**不正确。**\n\n**E. 无论其他分类单元的数据如何，在 $D$ 存在 $90\\%$ 缺失数据的情况下，与 $D$ 相邻的内部枝变得不可识别，因此对于该枝，最大似然估计问题缺少一个明确定义的最大值。**\n这是不正确的。一个无根的四分类单元树有一个内部枝。虽然在分类单元 $D$ 缺失的 $90\\%$ 的位点中，这个内部枝确实是不可识别的（因为数据退化为一个三分类单元的星状树），但它在所有四个分类单元都被观察到的 $10\\%$ 的位点中仍然是可识别的。只要有非零比例的位点具有完整数据，四分类单元树的所有参数在理论上都是可识别的。估计问题有一个明确定义的最大值，尽管对内部枝的估计精度会很差。**不正确。**", "answer": "$$\\boxed{A}$$", "id": "2402743"}]}