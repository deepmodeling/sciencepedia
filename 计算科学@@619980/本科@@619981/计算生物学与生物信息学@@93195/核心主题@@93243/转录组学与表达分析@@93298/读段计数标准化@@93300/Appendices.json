{"hands_on_practices": [{"introduction": "为了真正理解基因表达的变化，我们不能仅仅看原始的读数计数。第一个练习 [@problem_id:2424950] 将通过一个常见情景——在两个测序深度不同的样本中比较同一个基因——来展示其中的原因。通过计算 RPKM，你将亲身体验归一化如何校正文库大小的差异，从而避免对表达倍数变化得出错误结论。", "problem": "一项RNA测序实验对两个样本中的一个基因进行了分析。在样本A中，该基因获得了$1$个唯一比对上的读段（read），总唯一比对读段数为$10 \\times 10^{6}$。在样本B中，该基因获得了$2$个唯一比对上的读段，总唯一比对读段数为$20 \\times 10^{6}$。该基因的长度为$1$千碱基（kb）。每千碱基转录本每百万比对读段数（RPKM）的定义是：分配给一个基因的读段数，经过基因长度（以千碱基为单位）和总比对读段数（以百万为单位）的归一化。\n\n请计算该基因以RPKM衡量的表达倍数变化（fold-change），其定义为样本B中该基因的RPKM与样本A中该基因的RPKM之比。请以纯数字（无单位）形式报告您的答案，并四舍五入至三位有效数字。", "solution": "首先，我们来严格验证问题陈述。\n\n**步骤1：提取已知条件**\n- 样本A：基因获得$1$个唯一比对读段。\n- 样本A：总唯一比对读段数为$10 \\times 10^{6}$。\n- 样本B：基因获得$2$个唯一比对读段。\n- 样本B：总唯一比对读段数为$20 \\times 10^{6}$。\n- 基因长度：$1$千碱基（kb）。\n- RPKM（每千碱基转录本每百万比对读段数）的定义：`分配给一个基因的读段数，经过基因长度（以千碱基为单位）和总比对读段数（以百万为单位）的归一化`。\n- 要求计算：倍数变化，定义为样本B中基因的RPKM与样本A中基因的RPKM之比。\n- 要求格式：纯数字，四舍五入至三位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n根据所需标准对问题进行评估。\n- **科学依据充分**：该问题描述了RNA测序数据分析中的一个标准、基本的计算。RPKM是一个公认的（尽管现在常被取代）用于归一化基因表达的指标。所提供的值对于真实实验是合理的。该问题在科学上是合理的。\n- **问题定义明确**：所有必要的数据和定义都已提供。目标明确，并能导出一个唯一、稳定的解。该问题是适定（well-posed）的。\n- **客观性**：该问题使用精确、定量且无偏见的语言陈述。它不含主观或基于意见的论断。\n\n**步骤3：结论与行动**\n该问题是有效的。它有充分的科学依据，问题定义明确，客观且完整。现在，我们来推导解答。\n\n该问题要求计算两个样本之间基因表达的倍数变化，其中表达量使用每千碱基转录本每百万比对读段数（RPKM）指标进行量化。\n\n让我们根据问题陈述定义变量：\n- $C_A$：在样本A中比对到该基因的读段数，$C_A = 1$。\n- $N_A$：在样本A中的总比对读段数，$N_A = 10 \\times 10^{6}$。\n- $C_B$：在样本B中比对到该基因的读段数，$C_B = 2$。\n- $N_B$：在样本B中的总比对读段数，$N_B = 20 \\times 10^{6}$。\n- $L$：基因的长度（以千碱基为单位，kb），$L = 1$。\n\nRPKM的定义如下：\n$$ \\text{RPKM} = \\frac{\\text{读段数}}{(\\text{基因长度, kb}) \\times (\\text{总读段数, 百万})} $$\n这可以被数学公式化。总读段数（以百万为单位）是总读段数除以$10^6$。\n$$ \\text{RPKM} = \\frac{C}{L \\times (N / 10^6)} $$\n其中，$C$是该基因的读段数，$L$是基因长度（以kb为单位），$N$是文库总大小（总比对读段数）。\n\n首先，我们计算样本A的RPKM（$\\text{RPKM}_A$）：\n$$ \\text{RPKM}_A = \\frac{C_A}{L \\times (N_A / 10^6)} $$\n代入给定值：\n$$ \\text{RPKM}_A = \\frac{1}{1 \\times (10 \\times 10^6 / 10^6)} = \\frac{1}{1 \\times 10} = 0.1 $$\n\n接下来，我们计算样本B的RPKM（$\\text{RPKM}_B$）：\n$$ \\text{RPKM}_B = \\frac{C_B}{L \\times (N_B / 10^6)} $$\n代入给定值：\n$$ \\text{RPKM}_B = \\frac{2}{1 \\times (20 \\times 10^6 / 10^6)} = \\frac{2}{1 \\times 20} = \\frac{2}{20} = 0.1 $$\n\n问题要求计算倍数变化（FC），定义为$\\text{RPKM}_B$与$\\text{RPKM}_A$的比值。\n$$ \\text{FC} = \\frac{\\text{RPKM}_B}{\\text{RPKM}_A} $$\n代入计算出的RPKM值：\n$$ \\text{FC} = \\frac{0.1}{0.1} = 1 $$\n\n或者，我们可以先符号化地计算倍数变化，这是一种更稳健的方法。\n$$ \\text{FC} = \\frac{\\text{RPKM}_B}{\\text{RPKM}_A} = \\frac{\\frac{C_B}{L \\times (N_B / 10^6)}}{\\frac{C_A}{L \\times (N_A / 10^6)}} $$\n基因长度$L$和缩放因子$10^6$在分子和分母中是共有的，因此它们可以消去：\n$$ \\text{FC} = \\frac{C_B / N_B}{C_A / N_A} = \\frac{C_B}{C_A} \\times \\frac{N_A}{N_B} $$\n这个表达式表明，RPKM的倍数变化是原始读段数的比率，再用总文库大小的反比进行校正。现在，我们将数值代入这个简化后的表达式中：\n$$ \\text{FC} = \\frac{2}{1} \\times \\frac{10 \\times 10^6}{20 \\times 10^6} = 2 \\times \\frac{10}{20} = 2 \\times \\frac{1}{2} = 1 $$\n\n结果恰好为$1$。问题要求答案四舍五入到三位有效数字。为了用三位有效数字表示$1$，我们将其写为$1.00$。这表示该值精确到百分位。\n原始读段数的加倍（从$1$到$2$）被测序深度的加倍（从$1000$万到$2000$万读段）完全抵消，导致归一化后的表达值相同，因此倍数变化为$1$。", "answer": "$$\n\\boxed{1.00}\n$$", "id": "2424950"}, {"introduction": "除了比较不同样本，我们还经常需要在一个样本内部比较不同基因的表达水平。这带来了新的挑战：基因长度偏好性。这个练习 [@problem_id:2424999] 使用一个引人注目的假想案例，来说明 TPM 方法如何校正基因长度，并揭示原始读数计数在反映相对转录本丰度时可能是一个很差的指标。", "problem": "一项RNA测序实验得到了在同一样本中测量的两个单一同种型基因的唯一比对读数。基因 $\\mathcal{A}$ 的长度为 $500$ 碱基对 (bp)，有 $50$ 条比对读数。基因 $\\mathcal{B}$ 的长度为 $5000$ bp，有 $450$ 条比对读数。每百万转录本 (Transcripts Per Million, TPM) 定义为一种样本内表达量度量，其计算方法是：首先将每个基因的读数计数按其转录本的千碱基长度进行归一化，然后对所得值进行缩放，使样本中所有基因的这些值之和等于一百万。\n\n请仅根据以上信息和TPM的定义，通过计算比率 $\\mathrm{TPM}_{\\mathcal{A}} / \\mathrm{TPM}_{\\mathcal{B}}$，确定哪个基因在该样本中的表达量更高。请将答案表示为一个无单位的精确分数。最终答案必须是一个实数值。", "solution": "该问题要求计算来自单个RNA测序样本中两个基因 $\\mathcal{A}$ 和 $\\mathcal{B}$ 的每百万转录本 ($\\mathrm{TPM}$) 值的比率。\n\n首先，我们必须严格地将所提供的 $\\mathrm{TPM}$ 定义进行形式化。设 $C_i$ 为基因 $i$ 的唯一比对读数数量， $L_i$ 为基因 $i$ 的长度（单位为碱基对 bp）。该定义包含两个步骤。\n\n步骤 1：按千碱基(kb)为单位的基因长度对读数计数进行归一化。\n基因 $i$ 以千碱基为单位的长度，记为 $L_{i, \\text{kb}}$，由 $L_{i, \\text{kb}} = \\frac{L_i}{1000}$ 给出。\n长度归一化后的读数计数，我们称之为 $R_i$，是读数计数与以千碱基为单位的基因长度的比值：\n$$R_i = \\frac{C_i}{L_{i, \\text{kb}}} = \\frac{C_i}{L_i / 1000}$$\n\n步骤 2：缩放这些归一化后的计数，使其在样本中所有基因的总和等于一百万 ($10^6$)。\n设 $\\mathcal{G}$ 代表样本中所有基因的集合。所有长度归一化读数计数的总和由缩放因子 $S$ 给出：\n$$S = \\sum_{j \\in \\mathcal{G}} R_j$$\n单个基因 $i$ 的 $\\mathrm{TPM}$ 值则计算如下：\n$$\\mathrm{TPM}_i = \\left( \\frac{R_i}{S} \\right) \\times 10^6$$\n\n问题给出的数据如下：\n对于基因 $\\mathcal{A}$：\n- 读数计数：$C_{\\mathcal{A}} = 50$\n- 长度：$L_{\\mathcal{A}} = 500$ bp\n\n对于基因 $\\mathcal{B}$：\n- 读数计数：$C_{\\mathcal{B}} = 450$\n- 长度：$L_{\\mathcal{B}} = 5000$ bp\n\n我们现在对每个基因应用步骤1。\n对于基因 $\\mathcal{A}$，其以千碱基为单位的长度为 $L_{\\mathcal{A}, \\text{kb}} = \\frac{500}{1000} = 0.5$ kb。\n基因 $\\mathcal{A}$ 的长度归一化读数计数为：\n$$R_{\\mathcal{A}} = \\frac{C_{\\mathcal{A}}}{L_{\\mathcal{A}, \\text{kb}}} = \\frac{50}{0.5} = 100$$\n\n对于基因 $\\mathcal{B}$，其以千碱基为单位的长度为 $L_{\\mathcal{B}, \\text{kb}} = \\frac{5000}{1000} = 5$ kb。\n基因 $\\mathcal{B}$ 的长度归一化读数计数为：\n$$R_{\\mathcal{B}} = \\frac{C_{\\mathcal{B}}}{L_{\\mathcal{B}, \\text{kb}}} = \\frac{450}{5} = 90$$\n\n问题要求计算比率 $\\frac{\\mathrm{TPM}_{\\mathcal{A}}}{\\mathrm{TPM}_{\\mathcal{B}}}$。使用 $\\mathrm{TPM}$ 的公式，我们可以将此比率写为：\n$$\\frac{\\mathrm{TPM}_{\\mathcal{A}}}{\\mathrm{TPM}_{\\mathcal{B}}} = \\frac{\\left( \\frac{R_{\\mathcal{A}}}{S} \\right) \\times 10^6}{\\left( \\frac{R_{\\mathcal{B}}}{S} \\right) \\times 10^6}$$\n\n由于两个基因是在同一样本中测量的，因此每百万缩放因子 $10^6$ 和归一化读数的总和 $S$ 对它们来说是相同的。所以，这些项在比率计算中可以消掉：\n$$\\frac{\\mathrm{TPM}_{\\mathcal{A}}}{\\mathrm{TPM}_{\\mathcal{B}}} = \\frac{R_{\\mathcal{A}}}{R_{\\mathcal{B}}}$$\n这表明，在同一样本中，两个基因的 $\\mathrm{TPM}$ 值之比仅取决于它们各自的读数计数和长度，而与文库中的任何其他基因无关。\n\n代入计算出的 $R_{\\mathcal{A}}$ 和 $R_{\\mathcal{B}}$ 的值：\n$$\\frac{\\mathrm{TPM}_{\\mathcal{A}}}{\\mathrm{TPM}_{\\mathcal{B}}} = \\frac{100}{90}$$\n将此分数化简得到最终结果：\n$$\\frac{\\mathrm{TPM}_{\\mathcal{A}}}{\\mathrm{TPM}_{\\mathcal{B}}} = \\frac{10}{9}$$\n由于比率 $\\frac{10}{9} > 1$，显然 $\\mathrm{TPM}_{\\mathcal{A}} > \\mathrm{TPM}_{\\mathcal{B}}$，这意味着在该样本中基因 $\\mathcal{A}$ 的表达量高于基因 $\\mathcal{B}$。题目要求的是这个比率的数值。", "answer": "$$\\boxed{\\frac{10}{9}}$$", "id": "2424999"}, {"introduction": "现在，让我们将所有知识整合起来。最后一个动手实践 [@problem_id:2424928] 将挑战你处理一个包含多个具有不同长度和读数计数的基因的小型数据集。通过为一个特定基因计算 TPM，你将获得对该指标具体如何运作的实践理解，并认识到为什么选择不同的归一化方法——原始计数、RPKM 或 TPM——会从根本上改变我们对哪些基因最活跃的解读。", "problem": "一项实验使用单端RNA测序技术对单个样本中的信使核糖核酸 (mRNA) 表达进行分析。考虑以下基因水平数据集，其中每个基因 $G_{i}$ 都有一个转录本长度和一个观测到的原始读段计数。比对上的读段总数等于所示原始计数的总和。\n\n- 基因 $G_{1}$：长度 $2000$ bp，原始计数 $4000$\n- 基因 $G_{2}$：长度 $10000$ bp，原始计数 $9000$\n- 基因 $G_{3}$：长度 $1500$ bp，原始计数 $3500$\n- 基因 $G_{4}$：长度 $3000$ bp，原始计数 $5000$\n- 基因 $G_{5}$：长度 $500$ bp，原始计数 $1200$\n- 基因 $G_{6}$：长度 $8000$ bp，原始计数 $7000$\n- 基因 $G_{7}$：长度 $1200$ bp，原始计数 $3000$\n\n该数据集的构建使得在使用原始计数与使用标准化表达指标时，表达量最高的$5$个基因的排名顺序不同。请使用每千碱基每百万比对读段数 (RPKM) 和每百万转录本数 (TPM) 的标准单样本定义。由于数据是单端的，每千碱基转录本每百万比对片段数 (FPKM) 在此不适用。\n\n计算基因 $G_{5}$ 的TPM值。将您的答案四舍五入到四位有效数字。以TPM为单位表示最终值。", "solution": "该问题是生物信息学中的一个标准练习，具体涉及RNA测序数据的标准化。它要求根据给定的原始读段计数和基因长度数据集，计算特定基因的每百万转录本数 (TPM)。\n\n首先，评估问题的有效性。\n\n问题给出的条件如下：\n- 基因 $G_{1}$：长度 $2000$ bp，原始计数 $4000$\n- 基因 $G_{2}$：长度 $10000$ bp，原始计数 $9000$\n- 基因 $G_{3}$：长度 $1500$ bp，原始计数 $3500$\n- 基因 $G_{4}$：长度 $3000$ bp，原始计数 $5000$\n- 基因 $G_{5}$：长度 $500$ bp，原始计数 $1200$\n- 基因 $G_{6}$：长度 $8000$ bp，原始计数 $7000$\n- 基因 $G_{7}$：长度 $1200$ bp，原始计数 $3000$\n- 数据来自单端RNA测序。\n- 比对上的读段总数等于所示原始计数的总和。\n- RPKM和TPM的标准定义适用。\n- FPKM不适用。\n- 任务是计算基因 $G_{5}$ 的TPM值，并四舍五入到四位有效数字。\n\n该问题具有科学依据，因为TPM是广泛用于标准化基因表达数据的指标。它是一个适定问题，为求得唯一解提供了所有必要的数据（$7$个基因及其长度和读段计数）。其语言客观而精确。该问题不包含科学谬误、矛盾或模糊之处。因此，该问题是有效的。下面我们来推导一个严谨的解。\n\n每百万转录本数 (TPM) 标准化方法旨在校正来自基因长度和测序深度的双重偏差。计算分两步进行。首先，用基因转录本的长度对原始读段计数进行标准化。其次，再用样本中转录本的总“数量”对这些经过长度标准化的计数进行标准化，以确保所有TPM值的总和为一百万。\n\n设 $C_{i}$ 为基因 $i$ 的原始读段计数， $L_{i}$ 为基因 $i$ 的长度，单位为碱基对 (bp)。\n\n第1步：用每个基因的长度对其读段计数进行标准化。我们将基因长度以千碱基 (kb) 表示，其中 $1$ kb $= 1000$ bp。对于每个基因 $i$，我们计算一个比率 $R_{i}$，它代表每千碱基转录本的读段数。\n$$R_{i} = \\frac{C_{i}}{L_{i} / 1000}$$\n我们为数据集中的所有$7$个基因计算这个值。\n\n对于基因 $G_{1}$：$R_{1} = \\frac{4000}{2000 / 1000} = \\frac{4000}{2} = 2000$\n对于基因 $G_{2}$：$R_{2} = \\frac{9000}{10000 / 1000} = \\frac{9000}{10} = 900$\n对于基因 $G_{3}$：$R_{3} = \\frac{3500}{1500 / 1000} = \\frac{3500}{1.5} = \\frac{7000}{3}$\n对于基因 $G_{4}$：$R_{4} = \\frac{5000}{3000 / 1000} = \\frac{5000}{3}$\n对于基因 $G_{5}$：$R_{5} = \\frac{1200}{500 / 1000} = \\frac{1200}{0.5} = 2400$\n对于基因 $G_{6}$：$R_{6} = \\frac{7000}{8000 / 1000} = \\frac{7000}{8} = 875$\n对于基因 $G_{7}$：$R_{7} = \\frac{3000}{1200 / 1000} = \\frac{3000}{1.2} = 2500$\n\n第2步：将这些比率标准化，使它们的总和为一百万。为此，我们首先计算所有比率的总和，记为 $S$。\n$$S = \\sum_{i=1}^{7} R_{i}$$\n$$S = 2000 + 900 + \\frac{7000}{3} + \\frac{5000}{3} + 2400 + 875 + 2500$$\n分别合并整数项和分数项：\n$$S = (2000 + 900 + 2400 + 875 + 2500) + \\left(\\frac{7000}{3} + \\frac{5000}{3}\\right)$$\n$$S = 8675 + \\frac{12000}{3} = 8675 + 4000 = 12675$$\n这个总和 $S$ 是样本的缩放因子。\n\n然后，通过取特定基因 $i$ 的比率 $R_{i}$，除以比率总和 $S$，再乘以 $10^{6}$，来计算该基因的TPM值。\n$$TPM_{i} = \\frac{R_{i}}{S} \\times 10^{6}$$\n题目要求我们计算基因 $G_{5}$ 的TPM值。我们使用值 $R_{5} = 2400$ 和 $S = 12675$。\n$$TPM_{5} = \\frac{2400}{12675} \\times 10^{6}$$\n现在，我们进行数值计算：\n$$TPM_{5} \\approx 0.1893491124 \\times 10^{6} = 189349.1124$$\n问题要求答案四舍五入到四位有效数字。该数字是 $189349.1124...$。前四位有效数字是 $1$、$8$、$9$ 和 $3$。第五位有效数字是 $4$。由于 $4 < 5$，我们向下舍入，这意味着我们保持第四位有效数字不变，并将后续数字替换为零以维持数量级。\n舍入后的值为 $189300$。\n\n用科学记数法明确表示四位有效数字，结果是 $1.893 \\times 10^{5}$。单位是TPM，但根据全局格式化规则，最终的方框答案中省略了单位。", "answer": "$$\n\\boxed{1.893 \\times 10^{5}}\n$$", "id": "2424928"}]}