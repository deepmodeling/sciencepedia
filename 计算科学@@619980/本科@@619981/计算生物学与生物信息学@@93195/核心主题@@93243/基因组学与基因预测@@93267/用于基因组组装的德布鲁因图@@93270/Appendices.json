{"hands_on_practices": [{"introduction": "理论知识需要通过实践来巩固。这个练习旨在通过一个高度重复的合成基因组，让你亲手构建和分析德布鲁因图。通过仔细计算不同 $k$ 值下的节点和边，你将深刻理解 $k$ 值的选择以及线性基因组的边界效应如何影响图的拓扑结构，并最终决定欧拉路径或欧拉环的存在性 [@problem_id:2384050]。", "problem": "一个线性基因组 $G$ 定义为 $N$ 个 $4$-核苷酸模式 $\\text{ATCG}$ 的串联，即 $G = (\\text{ATCG})^N$，其中 $N \\ge 2$。考虑用于基因组组装的 $k$ 阶 de Bruijn 图 (dBG)，其定义如下：顶点集由作为 $G$ 的子串出现的所有不同 $(k-1)$-mer 组成，对于 $G$ 中每次出现的 $k$-mer $\\alpha_1 \\alpha_2 \\cdots \\alpha_k$，从对应其 $(k-1)$-前缀 $\\alpha_1 \\cdots \\alpha_{k-1}$ 的顶点向对应其 $(k-1)$-后缀 $\\alpha_2 \\cdots \\alpha_k$ 的顶点添加一条有向边。边的多重性等于对应 $k$-mer 在 $G$ 中出现的次数。该基因组是线性的，因此不会在 $G$ 的两端之间添加环绕子串。\n\n对于 $k=4$、$k=5$ 和 $k=3$，哪个选项正确描述了 dBG 的结构？\n\nA. 对于 $k \\in \\{3,4,5\\}$，dBG 是一个单一的有向 $4$-环，其中所有顶点的入度和出度相等（每种情况下都是一个欧拉回路）。\n\nB. 对于 $k=4$，顶点是 $\\text{ATC}$、$\\text{TCG}$、$\\text{CGA}$、$\\text{GAT}$，它们之间的四条边每条都恰好出现 $N$ 次；对于 $k=5$，顶点是 $\\text{ATCG}$、$\\text{TCGA}$、$\\text{CGAT}$、$\\text{GATC}$，它们之间的每条有向边都恰好出现 $N$ 次；对于 $k=3$，顶点是 $\\text{AT}$、$\\text{TC}$、$\\text{CG}$、$\\text{GA}$，它们之间的四条边每条都恰好出现 $N$ 次。因此，这三种情况都是欧拉回路。\n\nC. 对于 $k=4$，顶点 $\\text{ATC}$、$\\text{TCG}$、$\\text{CGA}$、$\\text{GAT}$ 排列成一个单一的有向 $4$-环，边的多重性为：$\\text{ATC} \\to \\text{TCG}$ 出现 $N$ 次，而 $\\text{TCG} \\to \\text{CGA}$、$\\text{CGA} \\to \\text{GAT}$ 和 $\\text{GAT} \\to \\text{ATC}$ 各出现 $N-1$ 次；只有 $\\text{ATC}$ 和 $\\text{TCG}$ 的度不平衡，差值为 $\\pm 1$，因此存在一条从 $\\text{ATC}$ 到 $\\text{TCG}$ 的唯一欧拉路径。对于 $k=5$，顶点 $\\text{ATCG}$、$\\text{TCGA}$、$\\text{CGAT}$、$\\text{GATC}$ 形成一个单一的有向 $4$-环，四条边中的每一条都出现 $N-1$ 次；所有顶点的度都是平衡的，因此存在一个欧拉回路。对于 $k=3$，顶点 $\\text{AT}$、$\\text{TC}$、$\\text{CG}$、$\\text{GA}$ 形成一个单一的有向 $4$-环，边的多重性为：$\\text{AT} \\to \\text{TC}$ 和 $\\text{TC} \\to \\text{CG}$ 出现 $N$ 次，而 $\\text{CG} \\to \\text{GA}$ 和 $\\text{GA} \\to \\text{AT}$ 出现 $N-1$ 次；只有 $\\text{AT}$ 和 $\\text{CG}$ 的度不平衡，差值为 $\\pm 1$，因此存在一条从 $\\text{AT}$ 到 $\\text{CG}$ 的唯一欧拉路径。\n\nD. 对于 $k=3$，重复的 $2$-mer 导致分支：顶点 $\\text{AT}$、$\\text{TC}$、$\\text{CG}$、$\\text{GA}$ 的出度为 $2$；对于 $k=4$ 和 $k=5$，dBG 是一条没有环结构的简单有向路径。", "solution": "问题陈述已提交验证。\n\n**步骤 1：提取已知条件**\n- 基因组为 $G = (\\text{ATCG})^N$。\n- 重复次数 $N \\ge 2$。\n- 基因组是线性的，没有环绕连接。\n- 构建一个 $k$ 阶 de Bruijn 图 (dBG)。\n- 顶点是 $G$ 中所有不同的 $(k-1)$-mer 的集合。\n- 如果 $(k-1)$-mer $u$ 是 $G$ 中某个 $k$-mer 的前缀，而 $(k-1)$-mer $v$ 是其后缀，则存在一条从顶点 $u$ 到顶点 $v$ 的有向边。\n- 边的多重性是对应 $k$-mer 在 $G$ 中出现的次数。\n- 任务是描述 $k=3$、$k=4$ 和 $k=5$ 时 dBG 的结构。\n\n**步骤 2：使用提取的已知条件进行验证**\n- 该问题具有科学依据。de Bruijn 图的定义在计算生物学中是标准的。基因组序列虽然是合成的，但对于此分析是一个有效的数学对象。\n- 该问题是适定 (well-posed) 的。所有术语都有明确的定义。参数 $G$、$N$ 和 $k$ 唯一地确定了图的结构。\n- 该问题是客观且自包含的。不需要外部信息或主观解释。\n\n**步骤 3：结论与行动**\n问题陈述被判定为 **有效**。将推导解答。\n\n分析将通过为每个指定的 $k$ 值构建 de Bruijn 图来进行。基因组是 $G = (\\text{ATCG})^N$，一个长度为 $4N$ 的线性序列。$G$ 中 $k$-mer 的数量是 $(4N - k + 1)$。\n\n**情况 1：对 $k=4$ 的分析**\n\ndBG 的顶点是不同的 $(k-1)$-mer，即 $3$-mer。$G$ 的周期性只产生四种不同的 $3$-mer：$\\text{ATC}$、$\\text{TCG}$、$\\text{CGA}$ 和 $\\text{GAT}$。因此，顶点集为 $V_4 = \\{\\text{ATC}, \\text{TCG}, \\text{CGA}, \\text{GAT}\\}$。\n\n边由 $G$ 中的 $4$-mer 决定。不同的 $4$-mer 是 $\\text{ATCG}$、$\\text{TCGA}$、$\\text{CGAT}$ 和 $\\text{GATC}$。这些对应于以下边：\n1.  $\\text{ATCG}$: 从 $\\text{ATC}$ 到 $\\text{TCG}$ 的边。\n2.  $\\text{TCGA}$: 从 $\\text{TCG}$ 到 $\\text{CGA}$ 的边。\n3.  $\\text{CGAT}$: 从 $\\text{CGA}$ 到 $\\text{GAT}$ 的边。\n4.  $\\text{GATC}$: 从 $\\text{GAT}$ 到 $\\text{ATC}$ 的边。\n这四条边形成一个单一的有向 $4$-环。\n\n我们现在必须通过计算线性序列 $G$ 中相应 $4$-mer 的出现次数来计算每条边的多重性。一个从位置 $i$ 开始的 $k$-mer 必须满足 $i+k-1 \\le 4N$，对于 $k=4$ 来说，即 $i \\le 4N-3$。\n-   $\\text{ATCG}$ 的出现：从位置 $1, 5, \\dots, 4(N-1)+1$ 开始。最后一个起始位置是 $4N-3$，是有效的。因此，有 $N$ 次出现。$\\text{ATC} \\to \\text{TCG}$ 的多重性为 $N$。\n-   $\\text{TCGA}$ 的出现：从位置 $2, 6, \\dots, 4(j)+2$ 开始。我们需要 $4j+2 \\le 4N-3$，所以 $4j \\le 4N-5$，意味着 $j \\le N-2$。所以 $j$ 的范围是从 $0$ 到 $N-2$，给出 $N-1$ 次出现。$\\text{TCG} \\to \\text{CGA}$ 的多重性为 $N-1$。\n-   $\\text{CGAT}$ 的出现：从位置 $3, 7, \\dots, 4(j)+3$ 开始。我们需要 $4j+3 \\le 4N-3$，所以 $4j \\le 4N-6$，意味着 $j \\le N-2$。这给出 $N-1$ 次出现。$\\text{CGA} \\to \\text{GAT}$ 的多重性为 $N-1$。\n-   $\\text{GATC}$ 的出现：从位置 $4, 8, \\dots, 4(j)+4$ 开始。我们需要 $4j+4 \\le 4N-3$，所以 $4j \\le 4N-7$，意味着 $j \\le N-2$。这给出 $N-1$ 次出现。$\\text{GAT} \\to \\text{ATC}$ 的多重性为 $N-1$。\n\n顶点度数：\n-   顶点 $\\text{ATC}$：$\\text{出度} = N$，$\\text{入度} = N-1$。不平衡度为 $+1$。\n-   顶点 $\\text{TCG}$：$\\text{出度} = N-1$，$\\text{入度} = N$。不平衡度为 $-1$。\n-   顶点 $\\text{CGA}$：$\\text{出度} = N-1$，$\\text{入度} = N-1$。平衡。\n-   顶点 $\\text{GAT}$：$\\text{出度} = N-1$，$\\text{入度} = N-1$。平衡。\n\n一个图存在欧拉路径的充要条件是它是连通的，并且最多有一个顶点的 $\\text{出度} - \\text{入度} = 1$，最多有一个顶点的 $\\text{入度} - \\text{出度} = 1$。此图满足这些条件，存在一条从 $\\text{ATC}$ 到 $\\text{TCG}$ 的唯一欧拉路径。\n\n**情况 2：对 $k=5$ 的分析**\n\n顶点是不同的 $4$-mer：$V_5 = \\{\\text{ATCG}, \\text{TCGA}, \\text{CGAT}, \\text{GATC}\\}$。\n边由 $5$-mer 决定。不同的 $5$-mer 是 $\\text{ATCGA}$、$\\text{TCGAT}$、$\\text{CGATC}$ 和 $\\text{GATCG}$。它们形成一个有向 $4$-环：$\\text{ATCG} \\to \\text{TCGA} \\to \\text{CGAT} \\to \\text{GATC} \\to \\text{ATCG}$。\n\n一个从位置 $i$ 开始的 $5$-mer 必须满足 $i \\le 4N-4$。\n-   $\\text{ATCGA}$ 的出现 (从 $4j+1$ 开始)：$4j+1 \\le 4N-4 \\Rightarrow j \\le N-2$。总共 $N-1$ 次出现。\n-   $\\text{TCGAT}$ 的出现 (从 $4j+2$ 开始)：$4j+2 \\le 4N-4 \\Rightarrow j \\le N-2$。总共 $N-1$ 次出现。\n-   $\\text{CGATC}$ 的出现 (从 $4j+3$ 开始)：$4j+3 \\le 4N-4 \\Rightarrow j \\le N-2$。总共 $N-1$ 次出现。\n-   $\\text{GATCG}$ 的出现 (从 $4j+4$ 开始)：$4j+4 \\le 4N-4 \\Rightarrow j \\le N-2$。总共 $N-1$ 次出现。\n\n环中所有四条边的多重性均为 $N-1$。因此，对于每个顶点，入度等于出度 $(N-1)$。该图是强连通的，并且每个顶点都是平衡的。因此，该图包含一个欧拉回路。\n\n**情况 3：对 $k=3$ 的分析**\n\n顶点是不同的 $2$-mer：$V_3 = \\{\\text{AT}, \\text{TC}, \\text{CG}, \\text{GA}\\}$。\n边由 $3$-mer 决定：$\\text{ATC}$、$\\text{TCG}$、$\\text{CGA}$ 和 $\\text{GAT}$。它们形成一个有向 $4$-环：$\\text{AT} \\to \\text{TC} \\to \\text{CG} \\to \\text{GA} \\to \\text{AT}$。\n\n一个从位置 $i$ 开始的 $3$-mer 必须满足 $i \\le 4N-2$。\n-   $\\text{ATC}$ 的出现 (从 $4j+1$ 开始)：$4j+1 \\le 4N-2 \\Rightarrow j \\le N-1$。总共 $N$ 次出现。边 $\\text{AT} \\to \\text{TC}$。\n-   $\\text{TCG}$ 的出现 (从 $4j+2$ 开始)：$4j+2 \\le 4N-2 \\Rightarrow j \\le N-1$。总共 $N$ 次出现。边 $\\text{TC} \\to \\text{CG}$。\n-   $\\text{CGA}$ 的出现 (从 $4j+3$ 开始)：$4j+3 \\le 4N-2 \\Rightarrow j \\le N-2$。总共 $N-1$ 次出现。边 $\\text{CG} \\to \\text{GA}$。\n-   $\\text{GAT}$ 的出现 (从 $4j+4$ 开始)：$4j+4 \\le 4N-2 \\Rightarrow j \\le N-2$。总共 $N-1$ 次出现。边 $\\text{GA} \\to \\text{AT}$。\n\n顶点度数：\n-   顶点 $\\text{AT}$：$\\text{出度} = N$，$\\text{入度} = N-1$。不平衡度为 $+1$。\n-   顶点 $\\text{TC}$：$\\text{出度} = N$，$\\text{入度} = N$。平衡。\n-   顶点 $\\text{CG}$：$\\text{出度} = N-1$，$\\text{入度} = N$。不平衡度为 $-1$。\n-   顶点 $\\text{GA}$：$\\text{出度} = N-1$，$\\text{入度} = N-1$。平衡。\n\n该图有一个顶点 ($\\text{AT}$) 的不平衡度为 $+1$，一个顶点 ($\\text{CG}$) 的不平衡度为 $-1$。 因此，存在一条从 $\\text{AT}$ 到 $\\text{CG}$ 的唯一欧拉路径。\n\n**评估选项**\n\nA. 对于 $k \\in \\{3,4,5\\}$，dBG 是一个单一的有向 $4$-环，其中所有顶点的入度和出度相等（每种情况下都是一个欧拉回路）。\n**错误**。对于 $k=3$ 和 $k=4$，这个陈述是错误的，因为基因组的线性特性导致顶点不平衡。只有当 $k=5$ 时，所有顶点才是平衡的。\n\nB. 对于 $k=4$，顶点是 $\\text{ATC}$、$\\text{TCG}$、$\\text{CGA}$、$\\text{GAT}$，它们之间的四条边每条都恰好出现 $N$ 次；对于 $k=5$，顶点是 $\\text{ATCG}$、$\\text{TCGA}$、$\\text{CGAT}$、$\\text{GATC}$，它们之间的每条有向边都恰好出现 $N$ 次；对于 $k=3$，顶点是 $\\text{AT}$、$\\text{TC}$、$\\text{CG}$、$\\text{GA}$，它们之间的四条边每条都恰好出现 $N$ 次。因此，这三种情况都是欧拉回路。\n**错误**。这个选项对所有三种情况都给出了错误的多重性。对于 $k=4$，多重性是 $N, N-1, N-1, N-1$。对于 $k=5$，多重性全部是 $N-1$。对于 $k=3$，多重性是 $N, N, N-1, N-1$。因此，三种情况都是欧拉回路的结论是有缺陷的。\n\nC. 对于 $k=4$，顶点 $\\text{ATC}$、$\\text{TCG}$、$\\text{CGA}$、$\\text{GAT}$ 排列成一个单一的有向 $4$-环，边的多重性为：$\\text{ATC} \\to \\text{TCG}$ 出现 $N$ 次，而 $\\text{TCG} \\to \\text{CGA}$、$\\text{CGA} \\to \\text{GAT}$ 和 $\\text{GAT} \\to \\text{ATC}$ 各出现 $N-1$ 次；只有 $\\text{ATC}$ 和 $\\text{TCG}$ 的度不平衡，差值为 $\\pm 1$，因此存在一条从 $\\text{ATC}$ 到 $\\text{TCG}$ 的唯一欧拉路径。对于 $k=5$，顶点 $\\text{ATCG}$、$\\text{TCGA}$、$\\text{CGAT}$、$\\text{GATC}$ 形成一个单一的有向 $4$-环，四条边中的每一条都出现 $N-1$ 次；所有顶点的度都是平衡的，因此存在一个欧拉回路。对于 $k=3$，顶点 $\\text{AT}$、$\\text{TC}$、$\\text{CG}$、$\\text{GA}$ 形成一个单一的有向 $4$-环，边的多重性为：$\\text{AT} \\to \\text{TC}$ 和 $\\text{TC} \\to \\text{CG}$ 出现 $N$ 次，而 $\\text{CG} \\to \\text{GA}$ 和 $\\text{GA} \\to \\text{AT}$ 出现 $N-1$ 次；只有 $\\text{AT}$ 和 $\\text{CG}$ 的度不平衡，差值为 $\\pm 1$，因此存在一条从 $\\text{AT}$ 到 $\\text{CG}$ 的唯一欧拉路径。\n**正确**。这个选项准确地描述了所有三种情况下的顶点、边的多重性、顶点平衡情况以及由此产生的图遍历属性（欧拉路径或回路），与我们从第一性原理的推导一致。\n\nD. 对于 $k=3$，重复的 $2$-mer 导致分支：顶点 $\\text{AT}$、$\\text{TC}$、$\\text{CG}$、$\\text{GA}$ 的出度为 $2$；对于 $k=4$ 和 $k=5$，dBG 是一条没有环结构的简单有向路径。\n**错误**。分析表明，在所有情况下，图都是一个单一的有向 $4$-环。没有分支；任何顶点的出度（忽略多重性）都是 $1$。$k=4$ 和 $k=5$ 的图是循环的，而不是简单的路径。这个选项在拓扑结构描述上是根本错误的。", "answer": "$$\\boxed{C}$$", "id": "2384050"}, {"introduction": "现在，让我们将理论应用于一个核心的生物信息学任务：从测序数据中估计基因组大小。这个练习模拟了分析 $k$-mer 频率谱的真实场景，你需要区分源于基因组的真实 $k$-mer 和测序错误产生的噪声 $k$-mer [@problem_id:2384041]。通过这个计算过程，你将学会如何利用覆盖度信息来推断基因组的一个基本属性，这是任何基因组组装项目关键的第一步。", "problem": "给定一个通过鸟枪法测序获得的核苷酸$k$-mer多重集，该多重集由$k$-mer丰度的直方图表示。考虑一个$k$阶有向de Bruijn图（DBG），其顶点是$(k-1)$-mer，有向边是$k$-mer。低丰度的$k$-mer主要由测序错误引起，应在估算中排除。在排除低于指定丰度阈值的易错$k$-mer后，估算以碱基对为单位的基因组大小$G$。\n\n具体来说，对于每个测试用例，您将获得：\n- 一个正整数$k$（$k$-mer的长度）。\n- 一个正整数$\\tau$（丰度阈值）。只有观测丰度大于或等于$\\tau$的$k$-mer才被认为是可信的。\n- 一个直方图，以有限的配对集合$\\{(i, H[i])\\}$形式给出，其中$i$是正整数丰度，$H[i]$是观测到恰好$i$次的独特$k$-mer的数量。如果某个丰度$i$未列出，则解释为$H[i]=0$。\n\n您的估算必须满足以下基于第一性原理的条件：\n- 令$S=\\sum_{i \\ge \\tau} i \\cdot H[i]$为可信$k$-mer观测的总数。\n- 令$c_{\\text{peak}}$为在可信丰度中使$H[i]$达到最大值的丰度$i \\ge \\tau$。如果存在多个这样的$i$，则使用最小的那个。\n- 估算的独特基因组$k$-mer数量为$S / c_{\\text{peak}}$。\n- 对于线性单倍体基因组，以碱基对为单位估算的基因组大小为$G \\approx S / c_{\\text{peak}} + k - 1$。\n- 如果没有可信的$k$-mer（即，如果$\\sum_{i \\ge \\tau} H[i] = 0$），则将估算值定义为$0$个碱基对。\n\n请将每个估算的基因组大小以碱基对（bp）为单位表示，并以浮点数形式保留$3$位小数。输出不得包含单位符号。\n\n测试套件。使用以下$5$个测试用例。每个用例都是一个三元组 $(k, \\tau, \\{(i, H[i])\\})$：\n- 用例1：$k = 21$，$\\tau = 4$，直方图配对\n  $(1, 120)$、$(2, 90)$、$(3, 60)$、$(25, 150)$、$(26, 180)$、$(27, 220)$、$(28, 240)$、$(29, 260)$、$(30, 250)$、$(31, 230)$、$(32, 200)$。\n- 用例2：$k = 31$，$\\tau = 2$，直方图配对\n  $(1, 300)$、$(2, 700)$、$(3, 350)$、$(4, 120)$。\n- 用例3：$k = 17$，$\\tau = 5$，直方图配对\n  $(1, 1000)$、$(2, 500)$、$(3, 200)$、$(4, 100)$。\n- 用例4：$k = 25$，$\\tau = 5$，直方图配对\n  $(1, 400)$、$(2, 300)$、$(3, 200)$、$(4, 150)$、$(55, 180)$、$(56, 200)$、$(57, 220)$、$(58, 240)$、$(59, 260)$、$(60, 280)$、$(61, 270)$、$(62, 250)$、$(63, 230)$。\n- 用例5：$k = 19$，$\\tau = 5$，直方图配对\n  $(1, 300)$、$(2, 250)$、$(3, 200)$、$(4, 150)$、$(18, 100)$、$(19, 150)$、$(20, 200)$、$(21, 220)$、$(22, 210)$、$(38, 120)$、$(39, 180)$、$(40, 240)$、$(41, 200)$、$(42, 160)$。\n\n最终输出格式。您的程序应生成单行输出，其中包含$5$个测试用例的结果，以逗号分隔的列表形式包含在方括号内，顺序与上面列出的相同。例如，输出必须具有以下形式：\n$[r_1,r_2,r_3,r_4,r_5]$,\n其中每个$r_j$都是按规定四舍五入的浮点估算值。", "solution": "从测序数据估算基因组大小是生物信息学中的一项基础任务。所提供的问题陈述概述了一种基于$k$-mer丰度直方图分析的有效、适定且有科学依据的方法论。该方法是与鸟枪法测序覆盖度相关的​​第一性原理的直接应用。\n\n问题验证如下：\n- **科学依据**：该方法是Lander-Waterman模型的一种简化形式，该模型假定对于随机鸟枪法测序，基因组中每个碱基被测序的次数遵循泊松分布。$k$-mer直方图的峰值（不包括错误峰）提供了平均覆盖度的估计。长度为$G$的基因组中$k$-mer的总数约为$G$。如果每个基因组$k$-mer平均被测序$c_{\\text{peak}}$次，则观测到的基因组$k$-mer总数约为$G \\cdot c_{\\text{peak}}$。问题将其改写为$G \\approx N_k$，其中$N_k$是独特基因组$k$-mer的数量。观测到的可信$k$-mer总数为$S$。因此，平均覆盖度通过$c_{\\text{peak}}$估算，而独特基因组$k$-mer的数量则估算为$N_k \\approx S / c_{\\text{peak}}$。对于线性染色体，最终的基因组大小估算值$G \\approx N_k + k - 1$正确地将独特$k$-mer的数量与序列长度关联起来。整个过程在逻辑上和科学上都是合理的。\n- **适定性**：问题为所有计算提供了明确的公式和无歧义的规则，包括处理$c_{\\text{peak}}$出现平局的情况以及没有可信$k$-mer的边缘情况。输入被清晰地定义。\n- **客观性**：问题以精确的数学和计算术语陈述，没有任何主观或模棱两可的语言。\n\n因此，该问题是有效的。我们现在通过将指定的算法应用于每个测试用例来求解。\n\n基因组大小估算的核心公式是：\n$$\nG \\approx \\frac{S}{c_{\\text{peak}}} + k - 1\n$$\n其中$k$是$k$-mer长度，$S = \\sum_{i \\ge \\tau} i \\cdot H[i]$是可信$k$-mer观测的总数（$\\tau$是丰度阈值），而$c_{\\text{peak}}$是对应于$i \\ge \\tau$时最高频率$H[i]$的丰度。\n\n**用例 1:**\n- 给定：$k = 21$，$\\tau = 4$。\n- 直方图提供配对$(i, H[i])$。我们只考虑丰度$i \\ge 4$的那些。\n- 可信的直方图条目是：$\\{(25, 150), (26, 180), (27, 220), (28, 240), (29, 260), (30, 250), (31, 230), (32, 200)\\}$。\n- 当$i \\ge 4$时，$H[i]$的最大值是$260$，出现在$i = 29$处。因此，$c_{\\text{peak}} = 29$。\n- 可信$k$-mer观测的总数$S$计算如下：\n$$\nS = (25 \\cdot 150) + (26 \\cdot 180) + (27 \\cdot 220) + (28 \\cdot 240) + (29 \\cdot 260) + (30 \\cdot 250) + (31 \\cdot 230) + (32 \\cdot 200)\n$$\n$$\nS = 3750 + 4680 + 5940 + 6720 + 7540 + 7500 + 7130 + 6400 = 49660\n$$\n- 估算的基因组大小$G$是：\n$$\nG \\approx \\frac{49660}{29} + 21 - 1 \\approx 1712.41379 + 20 \\approx 1732.414 \\text{ bp}\n$$\n\n**用例 2:**\n- 给定：$k = 31$，$\\tau = 2$。\n- 可信的直方图条目是：$\\{(2, 700), (3, 350), (4, 120)\\}$。\n- 当$i \\ge 2$时，$H[i]$的最大值是$700$，出现在$i = 2$处。因此，$c_{\\text{peak}} = 2$。\n- 可信$k$-mer观测的总数$S$计算如下：\n$$\nS = (2 \\cdot 700) + (3 \\cdot 350) + (4 \\cdot 120) = 1400 + 1050 + 480 = 2930\n$$\n- 估算的基因组大小$G$是：\n$$\nG \\approx \\frac{2930}{2} + 31 - 1 = 1465 + 30 = 1495.000 \\text{ bp}\n$$\n\n**用例 3:**\n- 给定：$k = 17$，$\\tau = 5$。\n- 提供的直方图条目是$\\{(1, 1000), (2, 500), (3, 200), (4, 100)\\}$。\n- 没有丰度$i \\ge \\tau = 5$的条目。可信$k$-mer的集合是空的。\n- 根据问题定义，如果$\\sum_{i \\ge \\tau} H[i] = 0$，则估算值为$G = 0$。\n- 估算的基因组大小：$G = 0.000 \\text{ bp}$。\n\n**用例 4:**\n- 给定：$k = 25$，$\\tau = 5$。\n- 可信的直方图条目是：$\\{(55, 180), (56, 200), (57, 220), (58, 240), (59, 260), (60, 280), (61, 270), (62, 250), (63, 230)\\}$。\n- 当$i \\ge 5$时，$H[i]$的最大值是$280$，出现在$i = 60$处。因此，$c_{\\text{peak}} = 60$。\n- 可信$k$-mer观测的总数$S$计算如下：\n$$\nS = (55 \\cdot 180) + (56 \\cdot 200) + (57 \\cdot 220) + (58 \\cdot 240) + (59 \\cdot 260) + (60 \\cdot 280) + (61 \\cdot 270) + (62 \\cdot 250) + (63 \\cdot 230)\n$$\n$$\nS = 9900 + 11200 + 12540 + 13920 + 15340 + 16800 + 16470 + 15500 + 14490 = 126160\n$$\n- 估算的基因组大小$G$是：\n$$\nG \\approx \\frac{126160}{60} + 25 - 1 \\approx 2102.6666... + 24 \\approx 2126.667 \\text{ bp}\n$$\n\n**用例 5:**\n- 给定：$k = 19$，$\\tau = 5$。\n- 可信的直方图条目是：$\\{(18, 100), (19, 150), (20, 200), (21, 220), (22, 210), (38, 120), (39, 180), (40, 240), (41, 200), (42, 160)\\}$。可信$k$-mer的分布是双峰的。\n- 当$i \\ge 5$时，$H[i]$的最大值是$240$，出现在$i = 40$处。因此，$c_{\\text{peak}} = 40$。\n- 可信$k$-mer观测的总数$S$计算如下：\n$$\nS = (18 \\cdot 100) + (19 \\cdot 150) + (20 \\cdot 200) + (21 \\cdot 220) + (22 \\cdot 210) + (38 \\cdot 120) + (39 \\cdot 180) + (40 \\cdot 240) + (41 \\cdot 200) + (42 \\cdot 160)\n$$\n$$\nS = 1800 + 2850 + 4000 + 4620 + 4620 + 4560 + 7020 + 9600 + 8200 + 6720 = 53990\n$$\n- 估算的基因组大小$G$是：\n$$\nG \\approx \\frac{53990}{40} + 19 - 1 = 1349.75 + 18 = 1367.750 \\text{ bp}\n$$", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport scipy as sp\n\ndef solve():\n    \"\"\"\n    Calculates the estimated genome size for a series of test cases based on k-mer histograms.\n    \"\"\"\n    test_cases = [\n        (21, 4, {1: 120, 2: 90, 3: 60, 25: 150, 26: 180, 27: 220, 28: 240, 29: 260, 30: 250, 31: 230, 32: 200}),\n        (31, 2, {1: 300, 2: 700, 3: 350, 4: 120}),\n        (17, 5, {1: 1000, 2: 500, 3: 200, 4: 100}),\n        (25, 5, {1: 400, 2: 300, 3: 200, 4: 150, 55: 180, 56: 200, 57: 220, 58: 240, 59: 260, 60: 280, 61: 270, 62: 250, 63: 230}),\n        (19, 5, {1: 300, 2: 250, 3: 200, 4: 150, 18: 100, 19: 150, 20: 200, 21: 220, 22: 210, 38: 120, 39: 180, 40: 240, 41: 200, 42: 160})\n    ]\n\n    results = []\n    for k, tau, hist in test_cases:\n        # Filter the histogram to include only trusted k-mers (multiplicity >= tau)\n        trusted_hist = {i: h for i, h in hist.items() if i >= tau}\n\n        # If there are no trusted k-mers, the estimated genome size is 0.\n        if not trusted_hist:\n            G = 0.0\n        else:\n            # Calculate S, the total number of trusted k-mer observations.\n            s_total = sum(i * h for i, h in trusted_hist.items())\n\n            # Find c_peak, the multiplicity at which H[i] is maximum for trusted k-mers.\n            # If there's a tie, the smallest multiplicity is chosen.\n            max_h_val = max(trusted_hist.values())\n            c_peak = min(i for i, h in trusted_hist.items() if h == max_h_val)\n\n            # Estimate genome size G using the provided formula.\n            G = (s_total / c_peak) + k - 1\n        \n        # Format the result to 3 decimal places.\n        results.append(f\"{G:.3f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2384041"}, {"introduction": "最后一个练习将引导你进行更高层次的思辨，探讨德布鲁因图方法的内在权衡。通过将其与重叠图（Overlap Graph）模型进行比较，你将分析将读长（reads）分解为 $k$-mer 时会丢失哪些关键信息 [@problem_id:2384010]。这项练习有助于培养批判性思维，让你深入理解不同组装策略在处理复杂基因组区域（如重复序列和单倍型定相）时的具体优势与局限。", "problem": "给定一组从二倍体基因组中抽样的、长度均为$L$的无错误单末端测序读段。考虑基于这些读段构建的两种组装图模型：(i) 在重叠-布局-一致性（OLC）范式下的重叠图，其中每个读段是一个顶点，有向边代表读段之间显著的后缀-前缀重叠；以及 (ii) 一个具有固定$k$-mer大小$k$（$1 \\ll k < L$）的de Bruijn图，其中顶点是$(k-1)$-mer，有向边对应于观察到的$k$-mer。假设没有可用的双末端或长读段信息，并且覆盖度足以使所有真实的$k$-mer都存在。请分析从重叠图转向de Bruijn图所带来的影响，重点关注当读段被分解为$k$-mer时，哪些基因组特征会因信息的非显式保留而受到最显著的影响。\n\n从重叠图转向de Bruijn图时，下列哪项基因组特征会因信息丢失而受到最显著的影响？选择所有适用项。\n\nA. 区分一个精确散在重复序列的多个拷贝，该重复单元的长度严格介于$k+1$和$L$之间，且出现在不同的侧翼序列环境中。\n\nB. 对同一条染色体上相距基因组距离为$d$（满足 $k < d \\leq L$）的两个杂合单核苷酸变异进行定相。\n\nC. 识别位于唯一基因组区域内的单核苷酸变异，其中 $k < L$。\n\nD. 重建一个长的唯一重叠群，其内部片段都是唯一的且远长于$k$。\n\nE. 解析一个串联重复序列阵列的拷贝数和位置，其重复单元长度$r$满足$r < k$，但其总阵列长度严格介于$k+1$和$L$之间。", "solution": "我们从图的定义开始。在重叠-布局-一致性（OLC）范式下的重叠图中，顶点是长度为$L$的完整读段，边连接后缀-前缀重叠超过阈值的读段，从而在长达$L$的范围内保留了读段水平的连贯性。相比之下，一个$k$-mer大小为$k$的de Bruijn图将观察到的$k$-mer表示为$(k-1)$-mer顶点之间的边，从而丢失了明确的读段身份以及每个读段内部超过$(k-1)$个碱基的长程连锁信息。因此，任何需要追踪哪些$k$-mer在同一读段内跨越超过$k$个碱基共同出现才能做出的区分，在de Bruijn图的表示中都可能丢失或被大大削弱。\n\n我们根据这些原则来评估每个选项。\n\n选项A：区分一个精确散在重复序列的多个拷贝，其重复单元长度严格介于$k+1$和$L$之间，且出现在不同的侧翼序列环境中。\n如果重复序列的长度 > $k$，那么该重复序列内部的所有$k$-mer都会在其所有拷贝之间共享。在de Bruijn图中，这会为该重复序列产生一条单一的坍缩路径，抹去了不同拷贝之间的区别，并且仅在侧翼的唯一序列区域产生分支点。在重叠图中，只要$L$超过重复单元的长度并且两侧有足够的唯一序列，从唯一侧翼延伸到重复序列中的长度为$L$的读段就可以通过重叠进行连接，从而保留了哪个唯一侧翼连接到哪个重复实例的信息。因此，区分具有不同侧翼的重复拷贝所需的信息在重叠图中得以保留，但在de Bruijn图中则大部分被坍缩。结论：正确。\n\n选项B：对同一条染色体上相距$d$个碱基（满足 $k < d \\leq L$）的两个杂合单核苷酸变异进行定相。\n定相需要知道这两个变异是否在同一读段路径内共同出现在同一单倍型上。在de Bruijn图中，如果两个位点之间的路径段由两个单倍型共享的$k$-mer组成，那么它就会坍缩；图本身并不能保留哪些$k$-mer被同一读段跨越超过$k$的距离所遍历。在重叠图中，一个跨越两个位点的长度为$L$的单个读段（或一串重叠的读段）会保留这种连锁关系，从而在$d \\leq L$时允许进行定相。因此，当$k < d \\leq L$时，转向de Bruijn图会移除对定相至关重要的读段水平的连锁信息。结论：正确。\n\n选项C：识别位于唯一基因组区域内的单核苷酸变异，其中 $k < L$。\n在唯一序列中的单核苷酸变异通常在de Bruijn图中表现为一个简单的“气泡”结构：两条局部不同的替代$k$-mer路径，这是许多变异检测工具使用的标志。重叠图也通过重叠区域内的错配来捕捉这一点。由于两种表示方法都支持检测，因此对于此特征，从重叠图转向de Bruijn图并没有特定的重大信息损失。结论：错误。\n\n选项D：重建一个长的唯一重叠群，其内部片段都是唯一的且远长于$k$。\n在唯一序列中，de Bruijn图和重叠图基本上都变成线性的。de Bruijn图的压缩是忠实的，对于组装这类区域，没有关键信息丢失。因此，相对于重叠图，这不会因信息损失而受到显著影响。结论：错误。\n\n选项E：解析一个串联重复序列阵列的拷贝数和位置，其重复单元长度$r < k$且总阵列长度严格介于$k+1$和$L$之间。\n即使当$r < k$时，一个足够长的串联阵列由于其周期性也会产生许多相同的$k$-mer，这会导致de Bruijn图将该阵列坍缩成一个短的环或路径，而这并不能编码拷贝数，通常需要借助丰度启发式方法。在重叠图中，跨越整个阵列并连接两侧唯一侧翼的长度为$L$的读段可以保留阵列的长度和位置，因为重叠关系在整个重复序列区域内保持了读段的连贯性。由于阵列长度介于$k+1$和$L$之间，重叠图原则上可以解析它，而de Bruijn图通常仅凭拓扑结构无法做到。结论：正确。\n\n总而言之，对于需要保留跨越大于$k$距离的读段水平连锁信息的特征，信息损失最为显著，特别是不同环境下的长精确重复序列、变异的长程定相，以及总长度超过$k$但可被读段跨越的串联重复序列阵列。", "answer": "$$\\boxed{ABE}$$", "id": "2384010"}]}