{"hands_on_practices": [{"introduction": "理解近似方法的最好途径之一是将其应用于一个简单的、可精确求解的系统中。本练习将引导你对氦原子应用局域密度近似（LDA）来计算交换能，并与精确的 Hartree-Fock 交换能进行比较 [@problem_id:2464278]。通过这种直接的量化比较，你将对 LDA 在一个简单的高密度系统中的准确性有一个直观的认识，从而更好地理解密度泛函理论中近似的本质。", "problem": "考虑处于基态的氦原子，其模型为一个自旋非极化的双电子系统，占据一个核电荷为 $Z=2$ 的单一类氢 $1s$ 空间轨道。在原子单位制下进行计算，其中 $\\hbar = 1$、$m_{e}=1$、$e=1$、$4\\pi\\varepsilon_{0}=1$，且玻尔半径 $a_{0}=1$。设归一化的类氢轨道为\n$$\n\\varphi_{1s}(r) \\;=\\; \\left(\\frac{Z^{3}}{\\pi}\\right)^{1/2}\\exp(-Z r),\n$$\n且对应的基态电子密度为\n$$\n\\rho(\\mathbf{r}) \\;=\\; 2\\,|\\varphi_{1s}(\\mathbf{r})|^{2}.\n$$\n局域密度近似 (LDA) 交换泛函定义为\n$$\nE_{x}^{\\mathrm{LDA}}[\\rho] \\;=\\; -\\,\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}\\int \\rho(\\mathbf{r})^{4/3}\\,d^{3}\\mathbf{r}.\n$$\n哈特里能量为\n$$\nE_{H}[\\rho] \\;=\\; \\frac{1}{2}\\int\\!\\!\\int \\frac{\\rho(\\mathbf{r}_{1})\\,\\rho(\\mathbf{r}_{2})}{|\\mathbf{r}_{1}-\\mathbf{r}_{2}|}\\,d^{3}\\mathbf{r}_{1}\\,d^{3}\\mathbf{r}_{2},\n$$\n对于占据同一空间轨道 $\\varphi_{1s}$ 的双电子单重态，其电子-电子排斥期望值为\n$$\nJ \\;=\\; \\int\\!\\!\\int \\frac{|\\varphi_{1s}(\\mathbf{r}_{1})|^{2}\\,|\\varphi_{1s}(\\mathbf{r}_{2})|^{2}}{|\\mathbf{r}_{1}-\\mathbf{r}_{2}|}\\,d^{3}\\mathbf{r}_{1}\\,d^{3}\\mathbf{r}_{2}.\n$$\n将此状态的哈特里-福克交换能 $E_{x}^{\\mathrm{HF}}$ 定义为与哈特里能量相加后可再现电子-电子排斥的量，即：\n$$\nE_{H}[\\rho] + E_{x}^{\\mathrm{HF}} \\;=\\; J.\n$$\n解析地计算当 $Z=2$ 时的 $E_{x}^{\\mathrm{LDA}}$ 和 $E_{x}^{\\mathrm{HF}}$，并给出无量纲的单一数值\n$$\nR \\;=\\; \\frac{E_{x}^{\\mathrm{LDA}}}{E_{x}^{\\mathrm{HF}}}.\n$$\n将 R 的最终结果四舍五入到4位有效数字。最终答案中不要包含单位。", "solution": "问题陈述已经过严格审查，确定其科学基础扎实、问题明确且客观。它呈现了一个在哈特里-福克理论和密度泛函理论框架下，针对一个简单的、可解析处理的系统的标准计算。所提供的定义与公认的原理一致。因此，我们继续进行解析求解。\n\n任务是计算一个由单一核电荷为 $Z$ 的类氢 $1s$ 轨道所描述的双电子系统的比值 $R = \\frac{E_{x}^{\\mathrm{LDA}}}{E_{x}^{\\mathrm{HF}}}$。\n\n首先，我们确定哈特里-福克交换能 $E_{x}^{\\mathrm{HF}}$。问题通过以下关系式定义了此量：\n$$\nE_{H}[\\rho] + E_{x}^{\\mathrm{HF}} = J\n$$\n该双电子系统的电子密度为 $\\rho(\\mathbf{r}) = 2|\\varphi_{1s}(\\mathbf{r})|^2$。哈特里能量 $E_{H}[\\rho]$ 是该电荷密度的经典静电自排斥能：\n$$\nE_{H}[\\rho] = \\frac{1}{2}\\int\\!\\!\\int \\frac{\\rho(\\mathbf{r}_{1})\\,\\rho(\\mathbf{r}_{2})}{|\\mathbf{r}_{1}-\\mathbf{r}_{2}|}\\,d^{3}\\mathbf{r}_{1}\\,d^{3}\\mathbf{r}_{2}\n$$\n代入 $\\rho(\\mathbf{r}) = 2|\\varphi_{1s}(\\mathbf{r})|^2$，我们发现：\n$$\nE_{H}[\\rho] = \\frac{1}{2}\\int\\!\\!\\int \\frac{(2|\\varphi_{1s}(\\mathbf{r}_{1})|^2)\\,(2|\\varphi_{1s}(\\mathbf{r}_{2})|^2)}{|\\mathbf{r}_{1}-\\mathbf{r}_{2}|}\\,d^{3}\\mathbf{r}_{1}\\,d^{3}\\mathbf{r}_{2} = 2 \\int\\!\\!\\int \\frac{|\\varphi_{1s}(\\mathbf{r}_{1})|^2\\,|\\varphi_{1s}(\\mathbf{r}_{2})|^2}{|\\mathbf{r}_{1}-\\mathbf{r}_{2}|}\\,d^{3}\\mathbf{r}_{1}\\,d^{3}\\mathbf{r}_{2}\n$$\n右侧的积分表达式正是库仑积分 $J$ 的定义。因此，我们得到简单关系式 $E_{H}[\\rho] = 2J$。\n将此结果代入问题中 $E_{x}^{\\mathrm{HF}}$ 的定义：\n$$\n2J + E_{x}^{\\mathrm{HF}} = J \\implies E_{x}^{\\mathrm{HF}} = -J\n$$\n这个结果是正确的；对于双电子单重态，哈特里-福克交换能恰好抵消了哈特里项中包含的电子与其自身相互作用的非物理性自相互作用。对于核电荷为 $Z$ 的归一化类氢 $1s$ 轨道，积分 $J$ 是量子力学中的一个标准结果：\n$$\nJ = \\int\\!\\!\\int \\frac{|\\varphi_{1s}(\\mathbf{r}_{1})|^{2}\\,|\\varphi_{1s}(\\mathbf{r}_{2})|^{2}}{|\\mathbf{r}_{1}-\\mathbf{r}_{2}|}\\,d^{3}\\mathbf{r}_{1}\\,d^{3}\\mathbf{r}_{2} = \\frac{5}{8}Z\n$$\n因此，哈特里-福克交换能为：\n$$\nE_{x}^{\\mathrm{HF}} = -\\frac{5}{8}Z\n$$\n\n接下来，我们计算局域密度近似 (LDA) 交换能 $E_{x}^{\\mathrm{LDA}}$。其泛函由下式给出：\n$$\nE_{x}^{\\mathrm{LDA}}[\\rho] = -\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}\\int \\rho(\\mathbf{r})^{4/3}\\,d^{3}\\mathbf{r}\n$$\n电子密度为 $\\rho(r) = 2|\\varphi_{1s}(r)|^2 = 2 \\frac{Z^3}{\\pi} \\exp(-2Zr)$。我们必须计算 $\\rho(r)^{4/3}$ 在全空间上的积分。由于密度是球对称的，我们在球坐标系中进行积分 ($d^{3}\\mathbf{r} = 4\\pi r^2 dr$)：\n$$\n\\int \\rho(r)^{4/3}\\,d^{3}\\mathbf{r} = \\int_{0}^{\\infty} \\left(2 \\frac{Z^3}{\\pi} \\exp(-2Zr)\\right)^{4/3} 4\\pi r^2\\,dr\n$$\n我们计算各项：\n$$\n\\left(2 \\frac{Z^3}{\\pi} \\exp(-2Zr)\\right)^{4/3} = 2^{4/3} \\frac{Z^4}{\\pi^{4/3}} \\exp\\left(-\\frac{8Zr}{3}\\right)\n$$\n积分变为：\n$$\n\\int \\rho(r)^{4/3}\\,d^{3}\\mathbf{r} = 4\\pi \\left(2^{4/3} \\frac{Z^4}{\\pi^{4/3}}\\right) \\int_{0}^{\\infty} r^2 \\exp\\left(-\\frac{8Zr}{3}\\right)\\,dr\n$$\n我们使用标准的伽马函数积分 $\\int_0^\\infty x^n \\exp(-ax)\\,dx = \\frac{n!}{a^{n+1}}$。在我们的情况下，$n=2$ 且 $a = \\frac{8Z}{3}$。\n$$\n\\int_{0}^{\\infty} r^2 \\exp\\left(-\\frac{8Zr}{3}\\right)\\,dr = \\frac{2!}{\\left(\\frac{8Z}{3}\\right)^3} = \\frac{2}{\\frac{512Z^3}{27}} = \\frac{54}{512Z^3} = \\frac{27}{256Z^3}\n$$\n将此结果代回积分后的密度表达式：\n$$\n\\int \\rho(r)^{4/3}\\,d^{3}\\mathbf{r} = 4\\pi \\cdot 2^{4/3} \\frac{Z^4}{\\pi^{4/3}} \\cdot \\frac{27}{256Z^3} = \\frac{108\\pi}{256} Z \\frac{2^{4/3}}{\\pi^{4/3}} = \\frac{27}{64} Z \\frac{2^{4/3}}{\\pi^{1/3}}\n$$\n现在，我们将此结果代入 $E_{x}^{\\mathrm{LDA}}$ 的公式中：\n$$\nE_{x}^{\\mathrm{LDA}} = -\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3} \\left(\\frac{27}{64} Z \\frac{2^{4/3}}{\\pi^{1/3}}\\right) = -Z \\frac{3 \\cdot 27}{4 \\cdot 64} \\frac{3^{1/3} \\cdot 2^{4/3}}{\\pi^{1/3} \\cdot \\pi^{1/3}}\n$$\n$$\nE_{x}^{\\mathrm{LDA}} = -Z \\frac{81}{256} \\frac{3^{1/3} \\cdot 2^{4/3}}{\\pi^{2/3}}\n$$\n\n最后，我们计算所要求的比值 $R$。核电荷 $Z$ 是一个公共因子，可以约去，这与预期相符。\n$$\nR = \\frac{E_{x}^{\\mathrm{LDA}}}{E_{x}^{\\mathrm{HF}}} = \\frac{-Z \\frac{81}{256} \\frac{3^{1/3} 2^{4/3}}{\\pi^{2/3}}}{-Z \\frac{5}{8}} = \\frac{81}{256} \\cdot \\frac{8}{5} \\cdot \\frac{3^{1/3} 2^{4/3}}{\\pi^{2/3}}\n$$\n简化数值系数：\n$$\nR = \\frac{81}{32 \\cdot 5} \\frac{3^{1/3} 2^{4/3}}{\\pi^{2/3}} = \\frac{81}{160} \\frac{(3 \\cdot 2^4)^{1/3}}{\\pi^{2/3}} = \\frac{81}{160} \\frac{48^{1/3}}{\\pi^{2/3}}\n$$\n通过提取 $8^{1/3} = 2$，可以进一步简化：\n$$\nR = \\frac{81}{160} \\frac{(8 \\cdot 6)^{1/3}}{\\pi^{2/3}} = \\frac{81 \\cdot 2 \\cdot 6^{1/3}}{160 \\pi^{2/3}} = \\frac{81}{80} \\frac{6^{1/3}}{\\pi^{2/3}}\n$$\n我们现在对此表达式进行数值计算。\n$6^{1/3} \\approx 1.81712$\n$\\pi^{2/3} \\approx 2.14503$\n$$\nR \\approx \\frac{81}{80} \\cdot \\frac{1.81712}{2.14503} \\approx 1.0125 \\cdot 0.84713 \\approx 0.8577328\n$$\n四舍五入到4位有效数字，我们得到最终结果。", "answer": "$$\n\\boxed{0.8577}\n$$", "id": "2464278"}, {"introduction": "现代交换相关泛函通常是结合了多种理论思想的复杂“配方”。本练习将揭开应用最广泛的 B3LYP 泛函的神秘面纱，通过一个具体的计算任务，你将亲手将其总交换相关能分解为其组成部分 [@problem_id:2464274]。这个过程可以帮助你深入理解现代“杂化”泛函是如何通过混合局域交换、梯度修正交换、局域与非局域相关以及精确的 Hartree-Fock 交换来构建的。", "problem": "给定在密度泛函理论 (DFT) 中用于闭壳层水分子的 Becke三参数Lee–Yang–Parr (B3LYP) 交换相关泛函的定义。该交换相关能由五个能量分量组合而成：Slater交换（局域自旋密度近似 (LSDA) 交换）、Becke 1988 交换修正、Vosko–Wilk–Nusair (VWN) 局域相关、Lee–Yang–Parr (LYP) 相关，以及 Hartree–Fock (HF) 精确交换。将这些未加权的能量分量分别表示为 $E_{x}^{\\mathrm{Slater}}$、$E_{x}^{\\mathrm{B88}}$、$E_{c}^{\\mathrm{VWN}}$、$E_{c}^{\\mathrm{LYP}}$ 和 $E_{x}^{\\mathrm{HF}}$，单位均为哈特里 (Hartree)。\n\n使用 B3LYP 的三个标准参数：$a_{0} = 0.20$、$a_{X} = 0.72$ 和 $a_{C} = 0.81$。B3LYP 交换相关能定义为以下线性组合\n$$\nE_{xc}^{\\mathrm{B3LYP}} = \\left(1 - a_{0}\\right) E_{x}^{\\mathrm{Slater}} + a_{X} E_{x}^{\\mathrm{B88}} + \\left(1 - a_{C}\\right) E_{c}^{\\mathrm{VWN}} + a_{C} E_{c}^{\\mathrm{LYP}} + a_{0} E_{x}^{\\mathrm{HF}}.\n$$\n对于下方的每个测试用例，请计算五个加权分量的贡献值以及它们的总和 $E_{xc}^{\\mathrm{B3LYP}}$，单位均为哈特里 (Hartree)。每个测试用例所需的输出是一个包含六个浮点数的列表，顺序如下：\n$$\n\\big[\\left(1 - a_{0}\\right) E_{x}^{\\mathrm{Slater}},\\; a_{X} E_{x}^{\\mathrm{B88}},\\; \\left(1 - a_{C}\\right) E_{c}^{\\mathrm{VWN}},\\; a_{C} E_{c}^{\\mathrm{LYP}},\\; a_{0} E_{x}^{\\mathrm{HF}},\\; E_{xc}^{\\mathrm{B3LYP}}\\big].\n$$\n\n所有输入和输出都必须以哈特里 (Hartree) 为单位。你的程序应生成单行输出，其中包含用方括号括起来的结果。结果是一个以逗号分隔的列表，其中每个元素是对应一个测试用例的列表（例如，$[\\text{case1},\\text{case2},\\dots]$）。\n\n测试集（每个元组对应于 $\\left(E_{x}^{\\mathrm{Slater}}, E_{x}^{\\mathrm{B88}}, E_{c}^{\\mathrm{VWN}}, E_{c}^{\\mathrm{LYP}}, E_{x}^{\\mathrm{HF}}\\right)$，单位为哈特里 (Hartree)）：\n- 用例 A（类水，一般情况）：$\\left(-8.000,\\; -1.200,\\; -0.300,\\; -0.500,\\; -7.500\\right)$\n- 用例 B（边界，所有分量为零）：$\\left(0.000,\\; 0.000,\\; 0.000,\\; 0.000,\\; 0.000\\right)$\n- 用例 C（边缘，梯度修正为正）：$\\left(-10.000,\\; +0.100,\\; -0.400,\\; -0.450,\\; -9.000\\right)$\n- 用例 D（边缘，分量数量级大）：$\\left(-20.000,\\; -5.000,\\; -1.000,\\; -1.200,\\; -18.000\\right)$", "solution": "任务要求通过指定的权重组合能量分量，来计算Becke三参数Lee–Yang–Parr (B3LYP) 交换相关能。B3LYP 泛函是一种杂化泛函，它将一部分 Hartree–Fock (HF) 精确交换与半局域交换和相关项混合。该定义使用了参数 $a_{0}$、$a_{X}$ 和 $a_{C}$。\n\n给定 $a_{0} = 0.20$、$a_{X} = 0.72$ 和 $a_{C} = 0.81$，我们将 B3LYP 交换相关能重写为按分量“分解”的形式：\n$$\nE_{xc}^{\\mathrm{B3LYP}} = \\underbrace{\\left(1 - a_{0}\\right) E_{x}^{\\mathrm{Slater}}}_{\\text{加权的 Slater 交换}} + \\underbrace{a_{X} E_{x}^{\\mathrm{B88}}}_{\\text{加权的 Becke 88 交换}} + \\underbrace{\\left(1 - a_{C}\\right) E_{c}^{\\mathrm{VWN}}}_{\\text{加权的 VWN 相关}} + \\underbrace{a_{C} E_{c}^{\\mathrm{LYP}}}_{\\text{加权的 LYP 相关}} + \\underbrace{a_{0} E_{x}^{\\mathrm{HF}}}_{\\text{加权的 HF 交换}}.\n$$\n明确定义各项权重：\n- Slater 交换权重：$c_{\\mathrm{Slater}} = 1 - a_{0} = 1 - 0.20 = 0.80$。\n- Becke 88 交换权重：$c_{\\mathrm{B88}} = a_{X} = 0.72$。\n- VWN 相关权重：$c_{\\mathrm{VWN}} = 1 - a_{C} = 1 - 0.81 = 0.19$。\n- LYP 相关权重：$c_{\\mathrm{LYP}} = a_{C} = 0.81$。\n- HF 交换权重：$c_{\\mathrm{HF}} = a_{0} = 0.20$。\n\n对于每个输入为 $\\left(E_{x}^{\\mathrm{Slater}}, E_{x}^{\\mathrm{B88}}, E_{c}^{\\mathrm{VWN}}, E_{c}^{\\mathrm{LYP}}, E_{x}^{\\mathrm{HF}}\\right)$ 的测试用例，计算：\n$$\n\\begin{aligned}\nW_{\\mathrm{Slater}} &= c_{\\mathrm{Slater}} \\, E_{x}^{\\mathrm{Slater}},\\\\\nW_{\\mathrm{B88}} &= c_{\\mathrm{B88}} \\, E_{x}^{\\mathrm{B88}},\\\\\nW_{\\mathrm{VWN}} &= c_{\\mathrm{VWN}} \\, E_{c}^{\\mathrm{VWN}},\\\\\nW_{\\mathrm{LYP}} &= c_{\\mathrm{LYP}} \\, E_{c}^{\\mathrm{LYP}},\\\\\nW_{\\mathrm{HF}} &= c_{\\mathrm{HF}} \\, E_{x}^{\\mathrm{HF}},\\\\\nE_{xc}^{\\mathrm{B3LYP}} &= W_{\\mathrm{Slater}} + W_{\\mathrm{B88}} + W_{\\mathrm{VWN}} + W_{\\mathrm{LYP}} + W_{\\mathrm{HF}}.\n\\end{aligned}\n$$\n\n现在对每个用例进行数值计算，单位为哈特里 (Hartree)：\n\n- 用例 A：$\\left(-8.000,\\; -1.200,\\; -0.300,\\; -0.500,\\; -7.500\\right)$\n$$\n\\begin{aligned}\nW_{\\mathrm{Slater}} &= 0.80 \\times (-8.000) = -6.400,\\\\\nW_{\\mathrm{B88}} &= 0.72 \\times (-1.200) = -0.864,\\\\\nW_{\\mathrm{VWN}} &= 0.19 \\times (-0.300) = -0.057,\\\\\nW_{\\mathrm{LYP}} &= 0.81 \\times (-0.500) = -0.405,\\\\\nW_{\\mathrm{HF}} &= 0.20 \\times (-7.500) = -1.500,\\\\\nE_{xc}^{\\mathrm{B3LYP}} &= -6.400 + (-0.864) + (-0.057) + (-0.405) + (-1.500) = -9.226.\n\\end{aligned}\n$$\n\n- 用例 B：$\\left(0.000,\\; 0.000,\\; 0.000,\\; 0.000,\\; 0.000\\right)$\n$$\n\\begin{aligned}\nW_{\\mathrm{Slater}} &= 0.80 \\times 0.000 = 0.000,\\\\\nW_{\\mathrm{B88}} &= 0.72 \\times 0.000 = 0.000,\\\\\nW_{\\mathrm{VWN}} &= 0.19 \\times 0.000 = 0.000,\\\\\nW_{\\mathrm{LYP}} &= 0.81 \\times 0.000 = 0.000,\\\\\nW_{\\mathrm{HF}} &= 0.20 \\times 0.000 = 0.000,\\\\\nE_{xc}^{\\mathrm{B3LYP}} &= 0.000.\n\\end{aligned}\n$$\n\n- 用例 C：$\\left(-10.000,\\; +0.100,\\; -0.400,\\; -0.450,\\; -9.000\\right)$\n$$\n\\begin{aligned}\nW_{\\mathrm{Slater}} &= 0.80 \\times (-10.000) = -8.000,\\\\\nW_{\\mathrm{B88}} &= 0.72 \\times (+0.100) = +0.072,\\\\\nW_{\\mathrm{VWN}} &= 0.19 \\times (-0.400) = -0.076,\\\\\nW_{\\mathrm{LYP}} &= 0.81 \\times (-0.450) = -0.3645,\\\\\nW_{\\mathrm{HF}} &= 0.20 \\times (-9.000) = -1.800,\\\\\nE_{xc}^{\\mathrm{B3LYP}} &= -8.000 + 0.072 - 0.076 - 0.3645 - 1.800 = -10.1685.\n\\end{aligned}\n$$\n\n- 用例 D：$\\left(-20.000,\\; -5.000,\\; -1.000,\\; -1.200,\\; -18.000\\right)$\n$$\n\\begin{aligned}\nW_{\\mathrm{Slater}} &= 0.80 \\times (-20.000) = -16.000,\\\\\nW_{\\mathrm{B88}} &= 0.72 \\times (-5.000) = -3.600,\\\\\nW_{\\mathrm{VWN}} &= 0.19 \\times (-1.000) = -0.190,\\\\\nW_{\\mathrm{LYP}} &= 0.81 \\times (-1.200) = -0.972,\\\\\nW_{\\mathrm{HF}} &= 0.20 \\times (-18.000) = -3.600,\\\\\nE_{xc}^{\\mathrm{B3LYP}} &= -16.000 - 3.600 - 0.190 - 0.972 - 3.600 = -24.362.\n\\end{aligned}\n$$\n\n因此，每个用例的分解输出（每个都是包含六个浮点数的列表，单位为哈特里 (Hartree)）如下：\n- 用例 A：$\\left[-6.400,\\; -0.864,\\; -0.057,\\; -0.405,\\; -1.500,\\; -9.226\\right]$\n- 用例 B：$\\left[0.000,\\; 0.000,\\; 0.000,\\; 0.000,\\; 0.000,\\; 0.000\\right]$\n- 用例 C：$\\left[-8.000,\\; 0.072,\\; -0.076,\\; -0.3645,\\; -1.800,\\; -10.1685\\right]$\n- 用例 D：$\\left[-16.000,\\; -3.600,\\; -0.190,\\; -0.972,\\; -3.600,\\; -24.362\\right]$\n\n程序应根据给定的输入计算这些值，并将它们以单行形式打印出来，格式为一个用方括号括起来的、以逗号分隔的列表，其中每个用例由其六元组列表表示，所有单位均为哈特里 (Hartree)。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef b3lyp_decomposition(E_slater, E_b88, E_vwn, E_lyp, E_hf, a0=0.20, aX=0.72, aC=0.81):\n    \"\"\"\n    Compute the B3LYP weighted component contributions and total.\n    Returns a list: [w_slater, w_b88, w_vwn, w_lyp, w_hf, total]\n    All energies are in Hartree.\n    \"\"\"\n    c_slater = 1.0 - a0\n    c_b88 = aX\n    c_vwn = 1.0 - aC\n    c_lyp = aC\n    c_hf = a0\n\n    w_slater = c_slater * E_slater\n    w_b88 = c_b88 * E_b88\n    w_vwn = c_vwn * E_vwn\n    w_lyp = c_lyp * E_lyp\n    w_hf = c_hf * E_hf\n    total = w_slater + w_b88 + w_vwn + w_lyp + w_hf\n\n    return [w_slater, w_b88, w_vwn, w_lyp, w_hf, total]\n\ndef format_list_of_floats(lst):\n    # Format floats consistently, avoiding scientific notation for given magnitudes\n    return \"[\" + \",\".join(f\"{x:.6f}\".rstrip('0').rstrip('.') if '.' in f\"{x:.6f}\" else f\"{x:.6f}\" for x in lst) + \"]\"\n\ndef solve():\n    # Define the test cases from the problem statement (Hartree units):\n    # Each tuple: (E_x^Slater, E_x^B88, E_c^VWN, E_c^LYP, E_x^HF)\n    test_cases = [\n        (-8.000, -1.200, -0.300, -0.500, -7.500),  # Case A\n        (0.000,  0.000,  0.000,  0.000,  0.000),   # Case B\n        (-10.000, 0.100, -0.400, -0.450, -9.000),  # Case C\n        (-20.000, -5.000, -1.000, -1.200, -18.000) # Case D\n    ]\n\n    results = []\n    for case in test_cases:\n        E_slater, E_b88, E_vwn, E_lyp, E_hf = case\n        result = b3lyp_decomposition(E_slater, E_b88, E_vwn, E_lyp, E_hf)\n        results.append(result)\n\n    # Build exact required format: a single line with a list of per-case lists, no extra text.\n    formatted_cases = [format_list_of_floats(r) for r in results]\n    print(f\"[{','.join(formatted_cases)}]\")\n\nsolve()\n```", "id": "2464274"}, {"introduction": "交换相关泛函并非完美无缺，它们存在一些系统性的内在误差。本练习将探讨常见泛函（如 PBE）最显著的缺陷之一：离域误差（delocalization error） [@problem_id:2464317]。通过一个简化的、被拉伸的 H₂⁺ 分子离子模型，你将看到这些泛函如何错误地预测在分离的原子上出现分数电荷，并将其与精确理论所应表现出的正确行为进行对比，从而深刻理解盲目“黑箱式”地使用密度泛函理论可能带来的风险。", "problem": "考虑双原子离子 $\\text{H}_2^+$ 的解离极限，在此极限下，核间距 $R$ 变得非常大，以至于氢原子 $1s$ 轨道间的重叠可以忽略不计。设 $n_{\\mathrm{A}}$ 和 $n_{\\mathrm{B}}$ 分别表示位于两个氢原子位置 $\\mathrm{A}$ 和 $\\mathrm{B}$ 上的电子数，并满足约束条件 $0 \\leq n_{\\mathrm{A}} \\leq 1$、$0 \\leq n_{\\mathrm{B}} \\leq 1$ 和 $n_{\\mathrm{A}} + n_{\\mathrm{B}} = 1$（总共一个电子）。\n\n为每个氢原子定义一个位点能量模型，该模型用位点占据数 $n$ 和一个小的位点能量偏置 $\\Delta$（单位为哈特里）来表示。当 $\\Delta > 0$ 时，能量偏向于位点 $\\mathrm{A}$；当 $\\Delta < 0$ 时，能量偏向于位点 $\\mathrm{B}$。孤立氢原子的单电子基态能量为 $E_1$（这是一个常数，在下文所有比较中都会被抵消）。需要考虑两种能量模型：\n\n- 精确的密度泛函理论 (DFT) 模型，其能量在整数电子数之间是电子数的分段线性函数，位点贡献为\n  $E_{\\text{site}}^{\\text{exact}}(n; s, \\Delta) = n E_1 - s \\Delta n$，其中对于位点 $\\mathrm{A}$，$s = +1$，对于位点 $\\mathrm{B}$，$s = -1$。\n\n- 一个代表 Perdew–Burke–Ernzerhof (PBE) 的半局域广义梯度近似模型，该模型在分数电子数下表现出对分段线性的凸性偏差，此处用曲率参数 $c > 0$（单位为哈特里）来模拟：\n  $E_{\\text{site}}^{\\text{PBE-like}}(n; s, \\Delta, c) = n E_1 - s \\Delta n - c\\, n (1 - n)$，其中 $s$ 的定义同上。\n\n在每个模型中，总能量是两个位点能量之和，\n$E^{\\ast}(n_{\\mathrm{A}}, n_{\\mathrm{B}}; \\Delta, c) = E_{\\text{site},\\mathrm{A}}^{\\ast}(n_{\\mathrm{A}}; +1, \\Delta, c) + E_{\\text{site},\\mathrm{B}}^{\\ast}(n_{\\mathrm{B}}; -1, \\Delta, c)$，其中 $\\ast \\in \\{\\text{exact}, \\text{PBE-like}\\}$，对于精确模型，$c$ 被忽略。参数 $E_1$ 在最小化过程中被抵消，因此无需指定。任务是在满足 $n_{\\mathrm{A}} + n_{\\mathrm{B}} = 1$ 和箱式约束的条件下，最小化 $E^{\\ast}$，以获得在位点 $\\mathrm{A}$ 上的预测电子数，记为 $n_{\\mathrm{A}}^{\\ast}$。当精确模型中存在多个极小值点时（例如，当 $\\Delta = 0$ 时），选择 $n_{\\mathrm{A}}^{\\text{exact}} = 1$ 作为确定性的破除简并约定。\n\n实现一个程序，对于每对参数 $(\\Delta, c)$，计算并返回 $n_{\\mathrm{A}}^{\\text{exact}}$ 和 $n_{\\mathrm{A}}^{\\text{PBE-like}}$。所有的 $\\Delta$ 和 $c$ 值均以哈特里为单位给出，输出值 $n_{\\mathrm{A}}^{\\text{exact}}$ 和 $n_{\\mathrm{A}}^{\\text{PBE-like}}$ 是无量纲的。将每个输出值四舍五入到六位小数后报告。\n\n使用以下参数值测试套件，这些参数用于探测对称性、弱不对称性和强不对称性、相反偏置以及数值稳定性：\n- 测试 1：$\\Delta = 0$，$c = 0.20$。\n- 测试 2：$\\Delta = 0.01$，$c = 0.20$。\n- 测试 3：$\\Delta = 0.20$，$c = 0.01$。\n- 测试 4：$\\Delta = -0.01$，$c = 0.20$。\n- 测试 5：$\\Delta = 0$，$c = 1.0\\times 10^{-9}$。\n\n你的程序应生成单行输出，其中包含一个逗号分隔的数对列表，每个数对是按顺序排列的两个值 $[n_{\\mathrm{A}}^{\\text{exact}}, n_{\\mathrm{A}}^{\\text{PBE-like}}]$，且整个列表用方括号括起来。例如，一个可接受的格式是 $[[x_1,y_1],[x_2,y_2],\\dots]$，其中每个 $x_i$ 和 $y_i$ 都是四舍五入到六位小数的小数。", "solution": "在 $\\mathrm{H}_2^+$ 的解离极限 $R \\to \\infty$ 下，两个氢1s轨道之间的电子耦合消失，因此电子数分布可以用两个位点占据数 $n_{\\mathrm{A}}$ 和 $n_{\\mathrm{B}}$ 来描述，它们满足 $n_{\\mathrm{A}} + n_{\\mathrm{B}} = 1$ 和 $0 \\leq n_{\\mathrm{A}}, n_{\\mathrm{B}} \\leq 1$。总能量是独立的位点能量之和。一个小的位点偏置 $\\Delta$ 模拟了一个无穷小的外势，当 $\\Delta > 0$ 时有利于位点 $\\mathrm{A}$，当 $\\Delta < 0$ 时有利于位点 $\\mathrm{B}$。\n\n对于精确的密度泛函，能量在整数电子数之间是电子数的分段线性函数。对于一个占据数为 $n$、符号为 $s \\in \\{+1,-1\\}$ （分别表示 $\\mathrm{A}$ 或 $\\mathrm{B}$）的位点，我们写作\n$$\nE_{\\text{site}}^{\\text{exact}}(n; s, \\Delta) = n E_1 - s \\Delta n,\n$$\n其中 $E_1$ 是氢的单电子基态能量。总能量为\n$$\nE^{\\text{exact}}(n_{\\mathrm{A}}, n_{\\mathrm{B}}; \\Delta) = n_{\\mathrm{A}} E_1 - (+1)\\Delta n_{\\mathrm{A}} + n_{\\mathrm{B}} E_1 - (-1)\\Delta n_{\\mathrm{B}}.\n$$\n使用 $n_{\\mathrm{B}} = 1 - n_{\\mathrm{A}}$，$E_1$ 项的总和为 $E_1$ 且为常数；因此，最小化 $E^{\\text{exact}}$ 可简化为最小化\n$$\n\\tilde{E}^{\\text{exact}}(n_{\\mathrm{A}}; \\Delta) = -\\Delta (2 n_{\\mathrm{A}} - 1)\n$$\n在 $0 \\leq n_{\\mathrm{A}} \\leq 1$ 的范围内。由于 $\\tilde{E}^{\\text{exact}}$ 关于 $n_{\\mathrm{A}}$ 是线性的，极小值点位于边界上：如果 $\\Delta > 0$，则 $n_{\\mathrm{A}}^{\\text{exact}} = 1$；如果 $\\Delta < 0$，则 $n_{\\mathrm{A}}^{\\text{exact}} = 0$；如果 $\\Delta = 0$，则任何 $n_{\\mathrm{A}} \\in [0,1]$ 都能使能量最小化。为了产生确定性的数值输出，我们采用规定的破除简并约定，即当 $\\Delta = 0$ 时，$n_{\\mathrm{A}}^{\\text{exact}} = 1$。\n\n对于像 Perdew–Burke–Ernzerhof (PBE) 这样的半局域广义梯度近似，由于离域误差，能量作为分数电子数的函数在整数之间是凸的。我们通过添加一个曲率项 $-c\\, n(1 - n)$（其中 $c > 0$）来模拟这种凸性，得到位点能量\n$$\nE_{\\text{site}}^{\\text{PBE-like}}(n; s, \\Delta, c) = n E_1 - s \\Delta n - c\\, n(1 - n).\n$$\n总能量（不计一个加性常数）变为\n$$\n\\tilde{E}^{\\text{PBE-like}}(n_{\\mathrm{A}}; \\Delta, c) = -2 c\\, n_{\\mathrm{A}} (1 - n_{\\mathrm{A}}) - \\Delta (2 n_{\\mathrm{A}} - 1),\n$$\n这里使用了 $n_{\\mathrm{B}} = 1 - n_{\\mathrm{A}}$。这是一个关于 $n_{\\mathrm{A}}$ 的凹二次函数乘以-1，再加上一个线性倾斜项；更明确地说，\n$$\n\\tilde{E}^{\\text{PBE-like}}(n_{\\mathrm{A}}; \\Delta, c) = -2 c \\left[n_{\\mathrm{A}} - \\tfrac{1}{2}\\right]^2 + \\tfrac{c}{2} - \\Delta (2 n_{\\mathrm{A}} - 1).\n$$\n为了找到无约束的极小值点，对 $n_{\\mathrm{A}}$ 求导并令其为零：\n$$\n\\frac{d \\tilde{E}^{\\text{PBE-like}}}{d n_{\\mathrm{A}}} = -2 c (1 - 2 n_{\\mathrm{A}}) - 2 \\Delta = 0.\n$$\n求解得到\n$$\n1 - 2 n_{\\mathrm{A}} = - \\frac{\\Delta}{c} \\quad \\Rightarrow \\quad n_{\\mathrm{A}}^{\\text{unconstrained}} = \\frac{1}{2} \\left(1 + \\frac{\\Delta}{c}\\right).\n$$\n施加物理上的箱式约束 $0 \\leq n_{\\mathrm{A}} \\leq 1$ 得到最终解\n$$\nn_{\\mathrm{A}}^{\\text{PBE-like}}(\\Delta, c) = \\min\\left\\{1, \\max\\left\\{0, \\frac{1}{2} \\left(1 + \\frac{\\Delta}{c}\\right)\\right\\}\\right\\}.\n$$\n该表达式直接表明，当 $\\Delta = 0$ 时，得到 $n_{\\mathrm{A}}^{\\text{PBE-like}} = \\tfrac{1}{2}$；当 $\\Delta$ 为小的非零值时，会产生接近 $\\tfrac{1}{2}$ 的分数 $n_{\\mathrm{A}}$；并且只有当 $|\\Delta| \\geq c$ 时，解才会饱和到边界上的整数占据数。这证明了PBE在解离时预测分数电荷的典型趋势，与精确的分段线性泛函将电子完全定域在能量较低的位点上形成对比。\n\n对于每个测试对 $(\\Delta, c)$，算法实现如下：\n1. 根据规则计算 $n_{\\mathrm{A}}^{\\text{exact}}$：如果 $\\Delta \\geq 0$，则 $n_{\\mathrm{A}}^{\\text{exact}} = 1$；如果 $\\Delta < 0$，则 $n_{\\mathrm{A}}^{\\text{exact}} = 0$，同时遵守在 $\\Delta = 0$ 时的破除简并约定。\n2. 使用 $n_{\\mathrm{A}}^{\\text{unconstrained}} = \\tfrac{1}{2}\\left(1 + \\tfrac{\\Delta}{c}\\right)$ 计算 $n_{\\mathrm{A}}^{\\text{PBE-like}}$，然后将其限制在区间 $[0,1]$ 内。\n3. 将每个结果四舍五入到六位小数用于输出。\n\n将此方法应用于指定的测试套件：\n- 测试 1 ($\\Delta = 0$, $c = 0.20$)：$n_{\\mathrm{A}}^{\\text{exact}} = 1$，$n_{\\mathrm{A}}^{\\text{PBE-like}} = 0.500000$。\n- 测试 2 ($\\Delta = 0.01$, $c = 0.20$)：$n_{\\mathrm{A}}^{\\text{exact}} = 1$，$n_{\\mathrm{A}}^{\\text{PBE-like}} = \\tfrac{1}{2}(1 + 0.05) = 0.525000$。\n- 测试 3 ($\\Delta = 0.20$, $c = 0.01$)：$n_{\\mathrm{A}}^{\\text{exact}} = 1$，$n_{\\mathrm{A}}^{\\text{PBE-like}} = \\min\\{1, \\tfrac{1}{2}(1 + 20)\\} = 1.000000$。\n- 测试 4 ($\\Delta = -0.01$, $c = 0.20$)：$n_{\\mathrm{A}}^{\\text{exact}} = 0$，$n_{\\mathrm{A}}^{\\text{PBE-like}} = \\tfrac{1}{2}(1 - 0.05) = 0.475000$。\n- 测试 5 ($\\Delta = 0$, $c = 1.0 \\times 10^{-9}$)：$n_{\\mathrm{A}}^{\\text{exact}} = 1$，$n_{\\mathrm{A}}^{\\text{PBE-like}} = 0.500000$。\n\n这些结果证实，对于对称情况和小的非对称情况，类PBE的半局域模型在 $\\mathrm{H}_2^+$ 解离时会预测出分数电荷分布，这阐释了半局域交换关联泛函经典的离域误差。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef nA_exact(delta: float) -> float:\n    \"\"\"\n    Exact DFT piecewise-linear model:\n    - If delta > 0: all electron on A -> nA = 1.0\n    - If delta < 0: all electron on B -> nA = 0.0\n    - If delta == 0: tie -> choose nA = 1.0 (deterministic tie-break)\n    \"\"\"\n    if delta < 0.0:\n        return 0.0\n    else:\n        return 1.0\n\ndef nA_pbe_like(delta: float, c: float) -> float:\n    \"\"\"\n    Semi-local PBE-like convex model with curvature c > 0:\n    nA_unconstrained = 0.5 * (1 + delta / c)\n    Then clamp to [0.0, 1.0].\n    \"\"\"\n    # Defensive check: ensure c > 0 as per model; if not, treat as exact behavior.\n    if c <= 0.0:\n        return nA_exact(delta)\n    nA = 0.5 * (1.0 + (delta / c))\n    # Clamp to physical bounds\n    if nA < 0.0:\n        nA = 0.0\n    elif nA > 1.0:\n        nA = 1.0\n    return nA\n\ndef format_pair(x: float, y: float) -> str:\n    \"\"\"Format a pair [x,y] with each value rounded to six decimals, no spaces.\"\"\"\n    return f\"[{x:.6f},{y:.6f}]\"\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case is (Delta in Hartree, c in Hartree)\n    test_cases = [\n        (0.0, 0.20),        # Test 1: symmetric, moderate curvature\n        (0.01, 0.20),       # Test 2: weak asymmetry, moderate curvature\n        (0.20, 0.01),       # Test 3: strong asymmetry, small curvature\n        (-0.01, 0.20),      # Test 4: opposite bias\n        (0.0, 1.0e-9),      # Test 5: symmetric, tiny curvature\n    ]\n\n    results_str_parts = []\n    for delta, c in test_cases:\n        nA_ex = nA_exact(delta)\n        nA_pbe = nA_pbe_like(delta, c)\n        results_str_parts.append(format_pair(nA_ex, nA_pbe))\n\n    # Final print statement in the exact required format: list of pairs\n    print(f\"[{','.join(results_str_parts)}]\")\n\nsolve()\n```", "id": "2464317"}]}