{"hands_on_practices": [{"introduction": "这个练习直击自相互作用误差的核心。对于任何真实的单电子体系，其能量不应包含电子与自身相互排斥的项。本练习要求您亲自运用数学工具，证明在密度泛函理论中使用的经典哈特里能量项 ($E_\\text{H}$) 即便对于单个电子也不为零，而这个非零的能量完全是虚假的自排斥能。通过为一个简单的高斯密度分布解析地推导出这个能量，您将对自相互作用误差这一交换关联泛函必须设法消除的问题，建立起一个具体而定量的认识。", "problem": "在密度泛函理论 (DFT) 的背景下，自相互作用误差的产生是因为对于单电子体系，经典的静电（Hartree）能量错误地包含了电子与其自身的相互作用，而这部分能量本应被精确的交换相关泛函所抵消。在 Hartree 原子单位制中，电荷密度之间的库仑相互作用由 $1/|\\mathbf{r}-\\mathbf{r}'|$ 给出，密度 $\\rho(\\mathbf{r})$ 的 Hartree 能量定义为\n$$\nE_{\\mathrm{H}}[\\rho] \\equiv \\frac{1}{2}\\iint \\frac{\\rho(\\mathbf{r})\\,\\rho(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\,d^3\\mathbf{r}\\,d^3\\mathbf{r}'.\n$$\n考虑一个假想的单电子体系，其球对称的高斯试探密度（未归一化）由下式给出\n$$\n\\tilde{\\rho}(\\mathbf{r}) = \\exp\\!\\left(-\\alpha r^2\\right),\n$$\n其中 $\\alpha0$ 且 $r = |\\mathbf{r}|$。首先，通过确定归一化常数 $C$ 使得 $\\rho(\\mathbf{r}) = C\\,\\exp\\!\\left(-\\alpha r^2\\right)$，来满足单电子归一化条件 $\\int \\rho(\\mathbf{r})\\,d^3\\mathbf{r} = 1$。然后，利用上述 $E_{\\mathrm{H}}[\\rho]$ 的定义，推导这个单电子高斯密度的虚假库仑自相互作用能的封闭形式解析表达式（作为 $\\alpha$ 的函数）。\n\n将您的最终答案表示为以 Hartree 为单位的单一简化解析表达式。不需要进行数值近似或舍入。", "solution": "本题旨在计算一个单电子体系的静电自相互作用能，即 Hartree 能量 $E_{\\mathrm{H}}$，该体系的电荷密度由一个球对称高斯函数建模。这个过程分为两步：首先，对给定的密度分布进行归一化；其次，计算 Hartree 能量的六维积分。\n\n首先，我们必须确定密度 $\\rho(\\mathbf{r}) = C \\exp(-\\alpha r^2)$ 的归一化常数 $C$，其中 $r=|\\mathbf{r}|$。单电子体系的归一化条件要求密度在全空间上的积分等于 $1$。我们在球坐标系 $(r, \\theta, \\phi)$ 中进行计算，其体积元为 $d^3\\mathbf{r} = r^2\\sin\\theta\\,dr\\,d\\theta\\,d\\phi$。\n\n$$\n\\int \\rho(\\mathbf{r})\\,d^3\\mathbf{r} = 1\n$$\n$$\nC \\int_0^{2\\pi} d\\phi \\int_0^\\pi \\sin\\theta\\,d\\theta \\int_0^\\infty \\exp(-\\alpha r^2)\\,r^2\\,dr = 1\n$$\n\n角向积分的结果分别为 $2\\pi$ 和 $2$，总立体角为 $4\\pi$。\n\n$$\nC \\cdot 4\\pi \\int_0^\\infty r^2 \\exp(-\\alpha r^2) \\,dr = 1\n$$\n\n剩下的径向积分是一个标准的高斯积分。我们可以使用已知公式 $\\int_0^\\infty x^{2n} \\exp(-ax^2)\\,dx = \\frac{(2n-1)!!}{2^{n+1}} \\sqrt{\\frac{\\pi}{a^{2n+1}}}$ 来计算它。在我们的例子中，$n=1$ 且 $a=\\alpha$。双阶乘 $(2(1)-1)!! = 1!! = 1$。\n\n$$\n\\int_0^\\infty r^2 \\exp(-\\alpha r^2) \\,dr = \\frac{1!!}{2^{1+1}} \\sqrt{\\frac{\\pi}{\\alpha^{2(1)+1}}} = \\frac{1}{4} \\sqrt{\\frac{\\pi}{\\alpha^3}} = \\frac{\\sqrt{\\pi}}{4\\alpha^{3/2}}\n$$\n\n将此结果代回归一化方程：\n\n$$\nC \\cdot 4\\pi \\left( \\frac{\\sqrt{\\pi}}{4\\alpha^{3/2}} \\right) = C \\frac{\\pi^{3/2}}{\\alpha^{3/2}} = C \\left(\\frac{\\pi}{\\alpha}\\right)^{3/2} = 1\n$$\n\n求解归一化常数 $C$ 可得：\n\n$$\nC = \\left(\\frac{\\alpha}{\\pi}\\right)^{3/2}\n$$\n\n因此，归一化后的单电子密度为：\n\n$$\n\\rho(r) = \\left(\\frac{\\alpha}{\\pi}\\right)^{3/2} \\exp(-\\alpha r^2)\n$$\n\n接下来，我们计算 Hartree 能量 $E_{\\mathrm{H}}[\\rho]$，对于这个单电子体系，它代表了虚假的自相互作用能。\n\n$$\nE_{\\mathrm{H}}[\\rho] = \\frac{1}{2}\\iint \\frac{\\rho(\\mathbf{r})\\,\\rho(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\,d^3\\mathbf{r}\\,d^3\\mathbf{r}'\n$$\n\n这可以理解为电荷分布与其自身静电势 $\\phi(\\mathbf{r})$ 相互作用能量的一半。\n\n$$\nE_{\\mathrm{H}}[\\rho] = \\frac{1}{2} \\int \\rho(\\mathbf{r}) \\phi(\\mathbf{r}) \\,d^3\\mathbf{r}\n$$\n其中电势 $\\phi(\\mathbf{r})$ 由下式给出：\n$$\n\\phi(\\mathbf{r}) = \\int \\frac{\\rho(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|} \\,d^3\\mathbf{r}'\n$$\n\n对于球对称的电荷密度 $\\rho(r')$，其电势 $\\phi(r)$ 也是球对称的，可以使用静电学中的一个标准结果（由高斯定律推导）来计算：\n\n$$\n\\phi(r) = 4\\pi \\left( \\frac{1}{r} \\int_0^r \\rho(r') r'^2 dr' + \\int_r^\\infty \\rho(r') r' dr' \\right)\n$$\n\n我们必须为我们特定的 $\\rho(r)$ 计算这两个积分。首先是 $r'  r$ 的积分：积分 $\\int_0^r r'^2 \\exp(-\\alpha r'^2) dr'$ 可以与误差函数 $\\operatorname{erf}(x) = \\frac{2}{\\sqrt{\\pi}}\\int_0^x \\exp(-t^2)dt$ 联系起来。半径 $r$ 内的总“电荷”为 $Q(r) = \\int_{|\\mathbf{r'}|r} \\rho(\\mathbf{r'}) d^3\\mathbf{r'} = \\operatorname{erf}(\\sqrt{\\alpha}r) - \\frac{2}{\\sqrt{\\pi}}\\sqrt{\\alpha}r\\exp(-\\alpha r^2)$。由此得到的电势是高斯分布的一个标准结果：\n\n$$\n\\phi(r) = \\frac{1}{r} \\operatorname{erf}(\\sqrt{\\alpha} r)\n$$\n这可以通过代入积分进行验证。当 $r$ 很大时，$\\operatorname{erf}(\\sqrt{\\alpha}r) \\to 1$，因此 $\\phi(r) \\to 1/r$，即单位点电荷的电势，这与预期相符。\n\n现在我们将 $\\rho(r)$ 和 $\\phi(r)$ 代入能量表达式：\n\n$$\nE_{\\mathrm{H}} = \\frac{1}{2} \\int_0^\\infty \\rho(r) \\phi(r) 4\\pi r^2 dr\n$$\n$$\nE_{\\mathrm{H}} = \\frac{1}{2} \\int_0^\\infty \\left[ \\left(\\frac{\\alpha}{\\pi}\\right)^{3/2} \\exp(-\\alpha r^2) \\right] \\left[ \\frac{1}{r}\\operatorname{erf}(\\sqrt{\\alpha}r) \\right] 4\\pi r^2 dr\n$$\n$$\nE_{\\mathrm{H}} = 2\\pi \\left(\\frac{\\alpha}{\\pi}\\right)^{3/2} \\int_0^\\infty r \\exp(-\\alpha r^2) \\operatorname{erf}(\\sqrt{\\alpha}r) dr\n$$\n\n为了计算该积分，我们进行换元，令 $x = \\sqrt{\\alpha} r$，因此 $r = x/\\sqrt{\\alpha}$ 且 $dr = dx/\\sqrt{\\alpha}$。\n\n$$\n\\int_0^\\infty r \\exp(-\\alpha r^2) \\operatorname{erf}(\\sqrt{\\alpha}r) dr = \\int_0^\\infty \\frac{x}{\\sqrt{\\alpha}} \\exp(-x^2) \\operatorname{erf}(x) \\frac{dx}{\\sqrt{\\alpha}} = \\frac{1}{\\alpha} \\int_0^\\infty x \\exp(-x^2) \\operatorname{erf}(x) dx\n$$\n\n我们使用分部积分法求解积分 $\\int_0^\\infty x \\exp(-x^2) \\operatorname{erf}(x) dx$。令 $u = \\operatorname{erf}(x)$ 和 $dv = x \\exp(-x^2) dx$。则 $du = \\frac{2}{\\sqrt{\\pi}}\\exp(-x^2)dx$ 且 $v = -\\frac{1}{2}\\exp(-x^2)$。\n\n$$\n\\int_0^\\infty u\\,dv = [uv]_0^\\infty - \\int_0^\\infty v\\,du\n$$\n$$\n\\int_0^\\infty x \\exp(-x^2) \\operatorname{erf}(x) dx = \\left[ -\\frac{1}{2}\\exp(-x^2)\\operatorname{erf}(x) \\right]_0^\\infty - \\int_0^\\infty \\left(-\\frac{1}{2}\\exp(-x^2)\\right)\\left(\\frac{2}{\\sqrt{\\pi}}\\exp(-x^2)\\right) dx\n$$\n\n边界项 $[-\\frac{1}{2}\\exp(-x^2)\\operatorname{erf}(x)]_0^\\infty$ 在上限处为 $0$（因为 $\\exp(-x^2) \\to 0$），在下限处也为 $0$（因为 $\\operatorname{erf}(0)=0$）。积分变为：\n\n$$\n\\frac{1}{\\sqrt{\\pi}} \\int_0^\\infty \\exp(-2x^2) dx\n$$\n\n这又是一个高斯积分。使用公式 $\\int_0^\\infty \\exp(-ax^2)dx = \\frac{1}{2}\\sqrt{\\frac{\\pi}{a}}$ 并取 $a=2$：\n\n$$\n\\frac{1}{\\sqrt{\\pi}} \\left( \\frac{1}{2}\\sqrt{\\frac{\\pi}{2}} \\right) = \\frac{1}{2\\sqrt{2}}\n$$\n\n因此，换元后的积分结果为 $\\frac{1}{\\alpha} \\frac{1}{2\\sqrt{2}}$。将此代回 $E_{\\mathrm{H}}$ 的表达式中：\n\n$$\nE_{\\mathrm{H}} = 2\\pi \\left(\\frac{\\alpha}{\\pi}\\right)^{3/2} \\left[ \\frac{1}{2\\sqrt{2}\\alpha} \\right] = \\pi \\frac{\\alpha^{3/2}}{\\pi^{3/2}} \\frac{1}{\\sqrt{2}\\alpha} = \\frac{1}{\\sqrt{\\pi}} \\frac{\\sqrt{\\alpha}}{\\sqrt{2}} = \\sqrt{\\frac{\\alpha}{2\\pi}}\n$$\n\n这就是高斯电荷密度自相互作用能的最终解析表达式。", "answer": "$$\n\\boxed{\\sqrt{\\frac{\\alpha}{2\\pi}}}\n$$", "id": "2462002"}, {"introduction": "自相互作用误差最有害的后果之一是“离域误差”，它导致近似泛函错误地倾向于将电子弥散在多个位点上，而不是正确地将其局域化。本练习将指导您构建一个简单而强大的计算模型来捕捉这一现象。通过对一个双中心体系中多余电子的能量学进行编程，您将直接观察到由自相互作用误差引起的对分段线性关系的偏离（由一个二次项模拟）如何导致非物理的、离域的非整数电荷。这个实践为您提供了一个关于密度泛函理论这一关键缺陷的直观展示。", "problem": "你的任务是形式化并实现一个最小的、自洽的计算实验，以演示密度泛函理论 (DFT) 中的自相互作用误差 (SIE) 如何人为地偏好对称混合价态二聚体中的电荷离域，这类似于混合价态配合物（如 $\\left[\\mathrm{Fe_2(OH)_3}\\right]^+$）中的额外电子。你的实验应基于以下纯数学模型，该模型抽象了将一个额外电子置于一个双位点系统上的能量学。\n\n- 令 $f \\in [0,1]$ 为位点 $1$ 上额外电子的比例（因此位点 $2$ 上的比例为 $1-f$）。\n- 令 $\\beta$（单位为 $\\mathrm{eV}$）量化一个位点能量的不对称性，该不对称性将电子线性地偏向一个位点：总能量通过 $\\beta f$ 线性地依赖于 $f$。\n- 令 $k \\ge 0$（单位为 $\\mathrm{eV}$）量化一个凸曲率，该曲率模拟了由 SIE 引入的对分段线性的偏离。正的 $k$ 会降低在 $f=0$ 和 $f=1$ 边界附近，分数占据（$f$ 接近 $\\tfrac{1}{2}$）的能量。\n\n定义两个能量模型作为 $f$ 的函数：\n\n- 一个受 SIE 影响的模型：\n$$\nE_{\\mathrm{SIE}}(f;\\beta,k) \\,=\\, E_0 \\,+\\, \\beta f \\,+\\, k\\left(f-\\tfrac{1}{2}\\right)^2,\n$$\n其中 $E_0$ 是一个恒定的参考能量，不影响对 $f$ 的最小化子。\n- 一个精确的（分段线性的）参考模型，没有凸性偏差：\n$$\nE_{\\mathrm{exact}}(f;\\beta) \\,=\\, E_0 \\,+\\, \\beta f.\n$$\n\n你的任务是编写一个完整的程序，对于每个指定的 $(\\beta,k)$ 对，计算以下量：\n\n1. 在 $0 \\le f \\le 1$ 的约束下，使 $E_{\\mathrm{SIE}}(f;\\beta,k)$ 最小化的占据比例 $f_{\\mathrm{SIE}} \\in [0,1]$。\n2. 在 $0 \\le f \\le 1$ 的范围内，使 $E_{\\mathrm{exact}}(f;\\beta)$ 最小化的占据比例 $f_{\\mathrm{exact}} \\in \\{0,1\\}$。如果 $\\beta  0$，选择 $f_{\\mathrm{exact}}=0$。如果 $\\beta  0$，选择 $f_{\\mathrm{exact}}=1$。如果 $\\beta = 0$，按照约定选择 $f_{\\mathrm{exact}}=0$。\n3. 一个布尔指示符 $D$，当且仅当 SIE 模型预测一个严格的分数最小值（即 $0  f_{\\mathrm{SIE}}  1$），而精确模型预测一个整数最小值（即 $f_{\\mathrm{exact}} \\in \\{0,1\\}$）时，$D$ 为 $\\mathrm{True}$。否则 $D=\\mathrm{False}$。\n\n数值和单位要求：\n\n- 所有的 $\\beta$ 和 $k$ 都以 $\\mathrm{eV}$ 为单位给出。占据比例 $f_{\\mathrm{SIE}}$ 和 $f_{\\mathrm{exact}}$ 是无量纲的。\n- 程序必须报告 $f_{\\mathrm{SIE}}$ 和 $f_{\\mathrm{exact}}$，并四舍五入到 $6$ 位小数。\n\n测试套件：\n\n- 使用以下四个测试用例，每个用例指定为 $(\\beta, k)$，单位为 $\\mathrm{eV}$：\n    - 用例 $1$: $(\\beta,k) = (\\,0.02,\\,0.40\\,)$.\n    - 用例 $2$: $(\\beta,k) = (\\,-0.03,\\,0.40\\,)$.\n    - 用例 $3$: $(\\beta,k) = (\\,0.45,\\,0.40\\,)$.\n    - 用例 $4$: $(\\beta,k) = (\\,0.00,\\,0.25\\,)$.\n\n最终输出格式：\n\n- 你的程序应生成单行输出，其中包含所有四个测试用例的结果，格式为由方括号括起来的逗号分隔列表。每个测试用例贡献一个包含三个项目的列表 $[f_{\\mathrm{SIE}}, f_{\\mathrm{exact}}, D]$。因此，最终输出应为单行，格式如下\n$[ [f_{\\mathrm{SIE},1},f_{\\mathrm{exact},1},D_1],[f_{\\mathrm{SIE},2},f_{\\mathrm{exact},2},D_2],[f_{\\mathrm{SIE},3},f_{\\mathrm{exact},3},D_3],[f_{\\mathrm{SIE},4},f_{\\mathrm{exact},4},D_4] ]$\n其中所有 $f$ 均四舍五入到 $6$ 位小数，而 $D$ 为 $\\mathrm{True}$ 或 $\\mathrm{False}$。", "solution": "所提出的问题是一个有效的约束优化练习，并可作为一个正确的教学模型，用于演示密度泛函理论中的自相互作用误差（SIE）。受SIE影响的能量模型 $E_{\\mathrm{SIE}}$ 和精确能量模型 $E_{\\mathrm{exact}}$ 都有明确的定义，而任务本身是微积分和分析的直接应用。我们将继续推导所需的量。\n\n问题要求我们在电子占据比例 $f \\in [0,1]$ 的定义域上找到两个能量函数的最小化子。\n\n**1. 精确能量 $E_{\\mathrm{exact}}(f;\\beta)$ 的最小化**\n\n精确能量模型由线性函数给出：\n$$\nE_{\\mathrm{exact}}(f;\\beta) = E_0 + \\beta f\n$$\n最小化在紧区间 $f \\in [0,1]$ 上进行。线性函数在区间上的最小值必然出现在其边界之一。\n\n- 如果 $\\beta  0$，函数 $E_{\\mathrm{exact}}(f)$ 随 $f$ 严格递增。因此，在 $f$ 的最小可能值，即 $f=0$ 处达到最小值。\n- 如果 $\\beta  0$，函数 $E_{\\mathrm{exact}}(f)$ 随 $f$ 严格递减。因此，在 $f$ 的最大可能值，即 $f=1$ 处达到最小值。\n- 如果 $\\beta = 0$，函数是常数，$E_{\\mathrm{exact}}(f) = E_0$，任何 $f \\in [0,1]$ 都是最小化子。问题陈述在此情况下指定了一个约定，即选择 $f=0$。\n\n因此，最小化占据比例 $f_{\\mathrm{exact}}$ 的确定如下：\n$$\nf_{\\mathrm{exact}} =\n\\begin{cases}\n1  \\text{如果 } \\beta  0 \\\\\n0  \\text{如果 } \\beta \\ge 0\n\\end{cases}\n$$\n根据此定义，$f_{\\mathrm{exact}}$ 始终为整数 $0$ 或 $1$，表示电荷完全定域在两个位点之一上。\n\n**2. 受SIE影响的能量 $E_{\\mathrm{SIE}}(f;\\beta,k)$ 的最小化**\n\n受SIE影响的能量模型是 $f$ 的二次函数：\n$$\nE_{\\mathrm{SIE}}(f;\\beta,k) = E_0 + \\beta f + k\\left(f-\\tfrac{1}{2}\\right)^2\n$$\n参数 $k \\ge 0$ 是给定的。最小化再次在 $f \\in [0,1]$ 上进行。\n\n为找到最小值，我们首先通过将关于 $f$ 的一阶导数设为零来找到无约束极值。\n$$\n\\frac{dE_{\\mathrm{SIE}}}{df} = \\beta + 2k\\left(f-\\tfrac{1}{2}\\right) = 0\n$$\n对 $f$ 求解，我们得到无约束最小化子，记为 $f_{unc}$。如果 $k  0$：\n$$\nf_{unc} = \\tfrac{1}{2} - \\frac{\\beta}{2k}\n$$\n二阶导数 $\\frac{d^2E_{\\mathrm{SIE}}}{df^2} = 2k$ 是非负的（因为 $k \\ge 0$），这证实了 $f_{unc}$ 对应于一个最小值。\n\n约束最小值 $f_{\\mathrm{SIE}}$ 必须位于区间 $[0,1]$ 内。由于 $E_{\\mathrm{SIE}}$ 是一个凸抛物线（对于 $k0$），在区间 $[0,1]$ 上的最小值由 $f_{unc}$ 相对于该区间的位置决定：\n- 如果 $f_{unc}$ 落在区间内，即 $0 \\le f_{unc} \\le 1$，那么 $f_{\\mathrm{SIE}} = f_{unc}$。\n- 如果 $f_{unc}  0$，函数在 $[0,1]$ 上单调递增，所以最小值在 $f_{\\mathrm{SIE}} = 0$。\n- 如果 $f_{unc}  1$，函数在 $[0,1]$ 上单调递减，所以最小值在 $f_{\\mathrm{SIE}} = 1$。\n\n这等效于将 $f_{unc}$ 的值裁剪到区间 $[0,1]$。\n\n条件 $0 \\le f_{unc} \\le 1$ 可以用 $\\beta$ 和 $k$ 来表示：\n$$\n0 \\le \\tfrac{1}{2} - \\frac{\\beta}{2k} \\le 1 \\implies -\\tfrac{1}{2} \\le -\\frac{\\beta}{2k} \\le \\tfrac{1}{2} \\implies -k \\le \\beta \\le k \\implies |\\beta| \\le k\n$$\n因此，对于 $k0$，解为：\n$$\nf_{\\mathrm{SIE}} =\n\\begin{cases}\n1  \\text{如果 } \\beta  -k \\\\\n\\tfrac{1}{2} - \\frac{\\beta}{2k}  \\text{如果 } |\\beta| \\le k \\\\\n0  \\text{如果 } \\beta  k\n\\end{cases}\n$$\n如果 $k=0$，模型简化为 $E_{\\mathrm{SIE}}(f;\\beta,0) = E_{\\mathrm{exact}}(f;\\beta)$，因此 $f_{\\mathrm{SIE}}$ 遵循与 $f_{\\mathrm{exact}}$ 相同的规则。\n\n**3. 指示符 $D$ 的确定**\n\n布尔指示符 $D$ 定义为 $\\mathrm{True}$ 当且仅当 SIE 模型预测一个严格的分数最小值（$0  f_{\\mathrm{SIE}}  1$）而精确模型预测一个整数最小值（$f_{\\mathrm{exact}} \\in \\{0,1\\}$）。如前所述，$f_{\\mathrm{exact}}$ 始终是整数。因此，$D$ 为 $\\mathrm{True}$ 的条件简化为当且仅当 $0  f_{\\mathrm{SIE}}  1$。\n\n根据对 $f_{\\mathrm{SIE}}$ 的分析，严格的分数值恰好在无约束最小值 $f_{unc}$ 严格位于区间 $(0,1)$ 内时出现。这对应于条件 $|\\beta|  k$ 且 $k0$。如果 $|\\beta| \\ge k$ 或 $k=0$，$f_{\\mathrm{SIE}}$ 将为 $0$ 或 $1$，使得 $D$ 等于 $\\mathrm{False}$。\n\n**算法总结**\n\n对于每个给定的参数对 $(\\beta, k)$：\n1.  根据 $\\beta$ 的符号计算 $f_{\\mathrm{exact}}$。\n2.  计算 $f_{\\mathrm{SIE}}$。如果 $k0$，计算 $f_{unc} = 0.5 - \\beta/(2k)$ 并将该值裁剪到 $[0,1]$ 区间。如果 $k=0$，则令 $f_{\\mathrm{SIE}}=f_{\\mathrm{exact}}$。\n3.  如果 $k0$ 且 $|\\beta|k$，则确定 $D$ 为 $\\mathrm{True}$，否则为 $\\mathrm{False}$。\n4.  按要求格式化结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates properties of a two-site charge model to demonstrate\n    self-interaction error in DFT.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (beta, k) in eV.\n    test_cases = [\n        (0.02, 0.40),\n        (-0.03, 0.40),\n        (0.45, 0.40),\n        (0.00, 0.25),\n    ]\n\n    processed_results = []\n    for beta, k in test_cases:\n        # 1. Calculate f_exact, the minimizer for the exact (piecewise-linear) model.\n        # This represents the charge-localized solution.\n        if beta  0:\n            f_exact = 0.0\n        elif beta  0:\n            f_exact = 1.0\n        else:  # beta == 0\n            # By convention specified in the problem\n            f_exact = 0.0\n\n        # 2. Calculate f_SIE, the minimizer for the SIE-affected model.\n        # This models how SIE can spuriously stabilize delocalized states.\n        f_sie = 0.0  # Initialize\n        # The parameter k must be non-negative.\n        if k  0:\n            # The unconstrained minimum of the quadratic energy function.\n            f_unc = 0.5 - beta / (2.0 * k)\n            # The minimum over the interval [0, 1] is the clipped value.\n            f_sie = np.clip(f_unc, 0.0, 1.0)\n        elif k == 0:\n            # If k=0, the SIE model is identical to the exact model.\n            f_sie = f_exact\n        else:\n            # k  0 is not allowed by the problem statement (k = 0).\n            # This case is included for robustness.\n            # The function would be concave, minimizer is always at a boundary.\n            if beta  0:\n                f_sie = 0.0\n            else:\n                f_sie = 1.0\n\n        # 3. Calculate the boolean indicator D.\n        # D is True iff the SIE model predicts a strictly fractional charge\n        # (0  f_SIE  1), which indicates artificial delocalization.\n        # This occurs precisely when the unconstrained minimum is inside the\n        # (0, 1) interval, which corresponds to |beta|  k for k  0.\n        # This analytical condition is robust against floating-point inaccuracies.\n        D = (k  0) and (abs(beta)  k)\n\n        # Append the formatted result string for the current test case.\n        # The f-string format specifier ':.6f' ensures 6 decimal places.\n        processed_results.append(\n            f\"[{f_sie:.6f},{f_exact:.6f},{D}]\"\n        )\n\n    # Final print statement in the exact required format.\n    # The list of result strings is joined by commas and enclosed in brackets.\n    print(f\"[{','.join(processed_results)}]\")\n\nsolve()\n```", "id": "2461989"}, {"introduction": "现在，让我们将自相互作用误差的理论概念与实际DFT计算中一个常见的难题联系起来。对于精确的泛函，Janak定理和电离势定理保证了最高占据轨道（HOMO）能量的负值等于第一电离势。然而，当使用近似泛函时，这一关系通常不成立，这种差异可能会让初学者感到困惑。本练习让您扮演一名计算化学家，观察到这一现象，并要求您找出正确的物理解释，从而巩固您对自相互作用误差如何破坏交换关联势、并导致不准确轨道能量的理解。", "problem": "一名学生使用 Kohn–Sham 密度泛函理论 (KS-DFT) 中的半局域广义梯度近似 (GGA) 计算氩的第一垂直电离能。在固定的中性原子几何构型下获得了两个值：Delta 自洽场 ($\\Delta$SCF) 能量差 $I_{\\Delta} = E(\\text{Ar}^+) - E(\\text{Ar})$，以及中性原子最高占据 Kohn–Sham 本征值的负值 $I_{\\epsilon} = -\\epsilon_{\\text{HOMO}}(\\text{Ar})$。该学生发现 $I_{\\epsilon}  I_{\\Delta}$。假设为自旋限制、充分收敛的基态，且基组误差、相对论效应和振动效应均可忽略不计。\n\n哪个选项最能解释这种差异，并提出了减小差异的修正方法？\n\nA. 近似的半局域泛函存在自相互作用误差 (SIE)，这使得 $E(N)$ 在整数之间是凸函数，并导致交换相关势的渐进衰减过快。这会将 $\\epsilon_{\\mathrm{HOMO}}$ 向上推 (使其负值更小)，因此 $I_{\\epsilon}$ 会低估电离能，而 $I_{\\Delta}$ 则受益于部分误差抵消。使用自相互作用校正泛函或范围分离杂化泛函会减小这种差异。\n\nB. 这种差异源于氩中的强静态相关；描述 $\\text{Ar}$ 需要多参考方法，而 Hartree–Fock 会使 $I_{\\epsilon}$ 恶化，因为它增加了静态相关。\n\nC. 即使对于精确泛函，Kohn–Sham 本征值也没有物理意义，因此 $-\\epsilon_{\\mathrm{HOMO}}$ 不应等于电离能；任何密度泛函都无法解决这个问题。\n\nD. 出现此误差是因为 $I_{\\Delta}$ 中忽略了轨道弛豫，而 $I_{\\epsilon}$ 中包含了轨道弛豫；因此 $I_{\\Delta}$ 系统性地偏小。使用遵循 Koopmans 定理的 Hartree–Fock 方法会使 $-\\epsilon_{\\mathrm{HOMO}}$ 精确。\n\nE. 对于任何局域或半局域泛函，Janak 定理保证了 $-\\epsilon_{\\mathrm{HOMO}} = E(N-1)-E(N)$ 精确成立，因此这种差异必定是数值噪音。", "solution": "该问题要求解释一个现象，即在使用密度泛函理论 (DFT) 中的半局域 GGA 泛函时，根据最高占据分子轨道 (HOMO) 本征值的负值计算的氩的电离能 $I_{\\epsilon} = -\\epsilon_{\\mathrm{HOMO}}(\\text{Ar})$，小于根据总能量差计算的电离能 $I_{\\Delta} = E(\\text{Ar}^+) - E(\\text{Ar})$。\n\n首先，我们分析这两个量作为真实第一电离能 $I$ 的近似值的理论基础。\n\n在 Kohn-Sham DFT 中，总能量 $E$ 是电子密度 $\\rho$ 的泛函，而电子密度又由 Kohn-Sham 轨道 $\\{\\phi_i\\}$ 构成。一个 $N$ 电子体系的总能量为 $E[N]$。$\\Delta$SCF 方法将电离能计算为 $(N-1)$ 电子体系与 $N$ 电子体系的总能量之间的有限差分：\n$$I_{\\Delta} = E(N-1) - E(N)$$\n在这个具体问题中，$N$ 对应于中性氩原子 $\\text{Ar}$，而 $N-1$ 对应于其阳离子 $\\text{Ar}^+$。能量 $E(\\text{Ar})$ 和 $E(\\text{Ar}^+)$ 是通过两次独立的、完全自洽的计算得到的。此过程明确地考虑了移除一个电子后电子结构的弛豫（即轨道和密度的变化）。\n\n第二个量 $I_{\\epsilon}$ 是基于最高占据 Kohn-Sham 轨道的能量 $\\epsilon_{\\mathrm{HOMO}}$。轨道本征值与能量导数之间的关系由 Janak 定理给出：\n$$ \\epsilon_{i} = \\frac{\\partial E}{\\partial n_{i}} $$\n其中 $n_i$ 是第 $i$ 个 Kohn-Sham 轨道的占据数。对于 HOMO，此关系为 $\\epsilon_{\\mathrm{HOMO}} = \\frac{\\partial E}{\\partial n_{\\mathrm{HOMO}}}$。\n\n对于*精确的*密度泛函，可以证明总能量 $E$ 作为电子数 $N$ 的函数，必须是一系列连接整数 $N$ 处各点的直线段。此性质被称为分段线性。对于具有此性质的函数，两个整数之间的导数是常数，且等于连接它们的线段的斜率。因此，对于精确泛函：\n$$ \\epsilon_{\\mathrm{HOMO}}^{\\text{exact}} = \\frac{\\partial E_{\\text{exact}}}{\\partial n_{\\mathrm{HOMO}}} \\bigg|_{N} = E_{\\text{exact}}(N) - E_{\\text{exact}}(N-1) = -I^{\\text{exact}} $$\n这就是 DFT 的电离势定理。它表明，对于精确泛函，HOMO 本征值的负值精确等于第一电离能。\n\n然而，该问题指定使用半局域 GGA 泛函。这类近似泛函（包括 LDA 和 GGA）存在**自相互作用误差 (SIE)**。一个电子会错误地与其自身的密度相互作用，因为近似的交换泛函未能完全抵消经典库仑（Hartree）能量中伪的自相互作用部分。SIE 的一个主要后果是能量泛函偏离了分段线性。对于近似泛函，能量 $E(N)$ 作为连续粒子数 $N$ 的函数，是伪的**凸函数**。\n\n对于凸函数，某一点的导数小于其左侧弦的斜率。数学上，对于整数 $N_{int}$：\n$$ \\frac{dE}{dN}\\bigg|_{N=N_{int}}  \\frac{E(N_{int}) - E(N_{int}-1)}{(N_{int}) - (N_{int}-1)} = E(N_{int}) - E(N_{int}-1) $$\n将此应用于我们的问题，把 $\\epsilon_{\\mathrm{HOMO}}$ 等同于导数，把 $I_{\\Delta}$ 等同于有限差分，我们得到：\n$$ \\epsilon_{\\mathrm{HOMO}}  E(N) - E(N-1) = -I_{\\Delta} $$\n乘以 $-1$ 后不等号反向：\n$$ -\\epsilon_{\\mathrm{HOMO}}  I_{\\Delta} $$\n这与学生的发现（$I_{\\epsilon}  I_{\\Delta}$）相符。让我们更仔细一点。分数电荷的能量泛函是通过系综定义的。Janak 定理中的导数是 $\\epsilon_\\mathrm{HOMO}(N) = \\partial E/\\partial N$。凸性意味着 $E(N)$ 向下弯曲。所以，对于基态，$E(\\lambda)  (1-\\lambda)E(0) + \\lambda E(1)$ 是错误的，对于近似泛函，曲率是相反的。Perdew 等人指出，精确能量是分段线性的。近似泛函是严格凸的。令 $E(N)$ 为能量作为电子数的函数。凸性意味着对于 $0  \\delta  1$，$E(N-\\delta)  (1-\\delta)E(N) + \\delta E(N-1)$。在 $N$ 处的导数是切线的斜率。由于凸性，此切线位于曲线下方。连接 $(N-1, E(N-1))$ 和 $(N, E(N))$ 的弦的斜率是 $E(N)-E(N-1)$。在 $N$ 处的导数是 $\\epsilon_{\\mathrm{HOMO}} = \\partial E / \\partial N$。根据凸性，$\\epsilon_{\\mathrm{HOMO}} > E(N) - E(N-1)$。因此，$-\\epsilon_{\\mathrm{HOMO}}  -(E(N) - E(N-1)) = E(N-1) - E(N) = I_{\\Delta}$。这意味着 $I_{\\epsilon}  I_{\\Delta}$，这恰好是问题中报告的观察结果。\n\nSIE 的另一个后果是，相应的交换相关势 $v_{xc}(\\mathbf{r})$ 在大距离处（$|\\mathbf{r}| \\to \\infty$）衰减过快。精确的势应以 $-1/r$ 的形式衰减，但对于 GGA 泛函，它呈指数衰减。这意味着势阱在远离原子核处过浅，因此最外层的电子（在 HOMO 中）束缚得不够紧。其能量本征值 $\\epsilon_{\\mathrm{HOMO}}$ 因此被推高到一个负值更小的值。因此，$I_{\\epsilon} = -\\epsilon_{\\mathrm{HOMO}}$ 低估了真实的电离能。\n\n$\\Delta$SCF 计算 $I_{\\Delta} = E(\\text{Ar}^+) - E(\\text{Ar})$ 在两次总能量计算中都包含 SIE。然而，在求差时，该误差有显著的抵消，这就是为什么 $I_{\\Delta}$ 通常比 $I_{\\epsilon}$ 是对真实电离能更好的近似。\n\n为了纠正这一点，必须使用能减轻 SIE 的泛函。\n- **自相互作用校正 (SIC)** 方法逐轨道地显式减去自相互作用能。\n- **杂化泛函** 混合了一部分精确的 Hartree-Fock 交换，根据定义，Hartree-Fock 交换没有自相互作用。这部分地纠正了凸性误差。\n- **范围分离杂化 (RSH) 泛函** 是一种更高级的杂化形式。它们在长程使用 100% 的精确交换，这正确地恢复了交换势的 $-1/r$ 渐进行为。这极大地提高了将 $\\epsilon_{\\mathrm{HOMO}}$ 作为电离能估计值的质量，使 $I_{\\epsilon}$ 更接近 $I_{\\Delta}$ 和实验值。\n\n现在，我们来评估给出的选项：\n\n**A. 近似的半局域泛函存在自相互作用误差 (SIE)，这使得 $E(N)$ 在整数之间是凸函数，并导致交换相关势的渐进衰减过快。这会将 $\\epsilon_{\\mathrm{HOMO}}$ 向上推 (使其负值更小)，因此 $I_{\\epsilon}$ 会低估电离能，而 $I_{\\Delta}$ 则受益于部分误差抵消。使用自相互作用校正泛函或范围分离杂化泛函会减小这种差异。**\n这个陈述是对问题的完整而正确的诊断。它正确地指出了 SIE 是原因，正确地描述了其主要后果（$E(N)$ 的凸性、不正确的势衰减），正确地将这些与观察到的不等式（$I_{\\epsilon}  I_{\\Delta}$）联系起来，并正确地提出了标准的、有效的补救措施。\n结论：**正确**。\n\n**B. 这种差异源于氩中的强静态相关；描述 $\\text{Ar}$ 需要多参考方法，而 Hartree–Fock 会使 $I_{\\epsilon}$ 恶化，因为它增加了静态相关。**\n这个陈述是不正确的。氩是一个闭壳层稀有气体原子，具有大的 HOMO-LUMO 能隙。它是动力学相关占主导地位的体系的典型例子，单参考方法非常适用于这类体系。问题所描述的是近似泛函的失败，而不是氩原子电子结构需要多参考处理的特性。Hartree-Fock 缺乏动力学相关；将其与“增加静态相关”联系起来是混淆不清的。\n结论：**不正确**。\n\n**C. 即使对于精确泛函，Kohn–Sham 本征值也没有物理意义，因此 $-\\epsilon_{\\mathrm{HOMO}}$ 不应等于电离能；任何密度泛函都无法解决这个问题。**\n这个陈述是根本错误的。电离势定理证明，对于精确泛函，$-\\epsilon_{\\mathrm{HOMO}}$ 精确等于第一电离能。问题出在近似泛函上。能更好地逼近精确泛函的泛函（例如，范围分离杂化泛函）确实在很大程度上“解决”了这个问题，使 $-\\epsilon_{\\mathrm{HOMO}}$ 成为对电离能更准确的近似。\n结论：**不正确**。\n\n**D. 出现此误差是因为 $I_{\\Delta}$ 中忽略了轨道弛豫，而 $I_{\\epsilon}$ 中包含了轨道弛豫；因此 $I_{\\Delta}$ 系统性地偏小。使用遵循 Koopmans 定理的 Hartree–Fock 方法会使 $-\\epsilon_{\\mathrm{HOMO}}$ 精确。**\n这个陈述颠倒了轨道弛豫的作用。$\\Delta$SCF 方法，$I_{\\Delta} = E(N-1) - E(N)$，完全包含了轨道弛豫，因为 $(N-1)$ 电子体系是变分优化的。相比之下，将 $I_{\\epsilon} = -\\epsilon_{\\mathrm{HOMO}}$ 解释为电离能（类似于 Koopmans 定理）则隐含地使用了 $N$ 电子体系的“冻结”轨道，因此*忽略了*轨道弛豫。此外，从 Hartree-Fock 计算得到的 $-\\epsilon_{\\mathrm{HOMO}}$ 并非精确的电离能；它是 Koopmans 定理下的一个近似，系统性地忽略了电子相关和轨道弛豫。\n结论：**不正确**。\n\n**E. 对于任何局域或半局域泛函，Janak 定理保证了 $-\\epsilon_{\\mathrm{HOMO}} = E(N-1)-E(N)$ 精确成立，因此这种差异必定是数值噪音。**\n这是对 Janak 定理的误解。该定理将本征值与能量对占据数的*导数*（$\\epsilon_i = \\partial E / \\partial n_i$）联系起来，而不是与*有限差分*（$E(N-1) - E(N)$）联系起来。这两个量仅当能量函数是线性时才相等，而由于 SIE，近似泛函的情况并非如此。这种差异是泛函的系统误差，而不是数值噪音。\n结论：**不正确**。\n\n基于此分析，选项 A 是唯一提供科学上合理且完整解释的选项。", "answer": "$$\n\\boxed{A}\n$$", "id": "2461991"}]}