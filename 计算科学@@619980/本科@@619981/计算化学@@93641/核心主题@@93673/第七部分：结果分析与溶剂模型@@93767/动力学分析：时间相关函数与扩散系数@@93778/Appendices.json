{"hands_on_practices": [{"introduction": "在深入研究如何从分子模拟中计算动力学性质之前，我们首先需要巩固对时间相关函数基本性质的理解。这个练习是一个思想实验，它探讨了在一个处于平衡态的系统中，时间相关函数（如速度自相关函数和均方位移）在时间反演下的行为。通过分析这个问题，你将加深对平稳过程和时间对称性这些核心概念的认识，这对正确解读模拟数据至关重要。[@problem_id:2454558]", "problem": "考虑一个简单液体在温度 $T$ 下的经典平衡分子动力学轨迹，其在等时间间隔 $t_n = n \\Delta t$（其中 $n = 0, 1, \\dots, N$，采样间隔 $\\Delta t > 0$）进行采样。保存的文件包含粒子 $i = 1, \\dots, N_{\\mathrm{p}}$ 在时刻 $t_n$ 的位置 $\\mathbf{r}_i(t_n)$ 和速度 $\\mathbf{v}_i(t_n)$。将均方位移 (MSD) 定义为延迟时间 $\\tau \\ge 0$ 的函数：\n$$\n\\mathrm{MSD}(\\tau) = \\left\\langle \\left\\lVert \\mathbf{r}_i(t_0+\\tau) - \\mathbf{r}_i(t_0) \\right\\rVert^2 \\right\\rangle_{i,t_0},\n$$\n并将速度自相关函数 (VACF) 定义为：\n$$\nC_v(\\tau) = \\left\\langle \\mathbf{v}_i(t_0) \\cdot \\mathbf{v}_i(t_0+\\tau) \\right\\rangle_{i,t_0},\n$$\n其中 $\\langle \\cdot \\rangle_{i,t_0}$ 表示对所有粒子和所有有效时间原点的平均。扩散系数 $D$ 可以通过 Einstein 关系式计算：\n$$\nD = \\lim_{\\tau \\to \\infty} \\frac{\\mathrm{MSD}(\\tau)}{2 d \\tau},\n$$\n或通过 Green–Kubo 关系式计算：\n$$\nD = \\frac{1}{d} \\int_0^{\\infty} C_v(\\tau)\\, \\mathrm{d}\\tau,\n$$\n其中 $d$ 是空间维度。\n\n假设严格按照时间倒序读取同一轨迹文件，即从 $t_N$ 到 $t_0$ 处理记录，而不改变每个保存时刻存储的 $\\mathbf{r}_i$ 和 $\\mathbf{v}_i$ 的数值。然后应用相同的算法，从倒序序列中计算作为 $\\tau \\ge 0$ 函数的 $\\mathrm{MSD}(\\tau)$ 和 $C_v(\\tau)$。\n\n以下哪个陈述最能描述按时间倒序读取文件对计算出的 $\\mathrm{MSD}(\\tau)$、$C_v(\\tau)$ 以及所得扩散系数 $D$ 的影响？请选择一项。\n\nA. 对于所有 $\\tau \\ge 0$，$\\mathrm{MSD}(\\tau)$ 和 $C_v(\\tau)$ 均保持不变，因此通过 Einstein 关系或 Green–Kubo 关系计算得到的 $D$ 也保持不变；物理上，这些时间相关可观测量在一个稳态平衡过程中仅依赖于时间差，并且在时间反演下是偶的。\n\nB. $\\mathrm{MSD}(\\tau)$ 保持不变，但对于所有 $\\tau > 0$，$C_v(\\tau)$ 的符号会改变，因此 Green–Kubo 扩散系数的符号会改变，而 Einstein 扩散系数保持不变。\n\nC. 当倒序读取时，$\\mathrm{MSD}(\\tau)$ 随 $\\tau$ 减小，因为位移变为负值，而 $C_v(\\tau)$ 保持不变；因此，Einstein 扩散系数减小。\n\nD. $\\mathrm{MSD}(\\tau)$ 和 $C_v(\\tau)$ 都被时间反转，使得 $\\widetilde{\\mathrm{MSD}}(\\tau) = \\mathrm{MSD}(-\\tau)$ 和 $\\widetilde{C}_v(\\tau) = C_v(-\\tau)$；因此，其长时行为与正向时间计算相比符号不同，从而改变了 $D$。", "solution": "该问题要求分析按时间倒序处理经典平衡分子动力学轨迹如何影响计算得到的均方位移 (MSD) 和速度自相关函数 (VACF)。这个问题的核心在于稳态系统中时间相关函数的性质。\n\n首先，让我们将问题设定形式化。原始轨迹包含粒子 $i=1, \\dots, N_{\\mathrm{p}}$ 在离散时间 $t_n = n \\Delta t$（其中 $n = 0, \\dots, N$）的数据点 $(\\mathbf{r}_i(t_n), \\mathbf{v}_i(t_n))$。系统处于热平衡状态，这意味着其底层的随机过程是稳态的。这意味着时间相关函数仅依赖于时间差（延迟时间 $\\tau$），而不依赖于绝对时间原点 $t_0$。\n\n问题陈述了轨迹文件是按倒序读取的。我们定义一个新的“计算时间”变量 $t'$ 来表示读取的顺序。当文件被倒序读取时，计算时间 $t'_n = n \\Delta t$ 处的数据对应于原始物理时间 $t_{N-n}$ 的数据。我们用波浪号表示这个倒序序列中的位置和速度：\n$$ \\tilde{\\mathbf{r}}_i(t'_n) = \\mathbf{r}_i(t_{N-n}) $$\n$$ \\tilde{\\mathbf{v}}_i(t'_n) = \\mathbf{v}_i(t_{N-n}) $$\n问题指明位置和速度向量的数值并未改变。这是关键的一点；这只是数据序列的倒置，而不是一个会涉及速度取反的物理时间反演操作。\n\n我们被要求使用相同的算法对这个新的、用波浪号标记的数据序列计算 MSD 和 VACF。设延迟时间为 $\\tau = k \\Delta t \\ge 0$。\n\n**均方位移 ($\\widetilde{\\mathrm{MSD}}$) 的分析**\n\n将 MSD 的标准定义应用于倒序序列：\n$$ \\widetilde{\\mathrm{MSD}}(\\tau) = \\left\\langle \\left\\lVert \\tilde{\\mathbf{r}}_i(t'_0+\\tau) - \\tilde{\\mathbf{r}}_i(t'_0) \\right\\rVert^2 \\right\\rangle_{i,t'_0} $$\n这里，$\\langle \\cdot \\rangle_{i,t'_0}$ 表示对所有粒子 $i$ 和所有有效计算时间原点 $t'_0$ 的平均。设一个特定的时间原点为 $t'_n = n \\Delta t$。平均值内的表达式变为：\n$$ \\left\\lVert \\tilde{\\mathbf{r}}_i(t'_{n+k}) - \\tilde{\\mathbf{r}}_i(t'_n) \\right\\rVert^2 = \\left\\lVert \\mathbf{r}_i(t_{N-(n+k)}) - \\mathbf{r}_i(t_{N-n}) \\right\\rVert^2 $$\n我们定义一个新的物理时间原点 $T_0 = t_{N-n} = (N-n)\\Delta t$。另一个时间点是 $t_{N-n-k} = (N-n-k)\\Delta t = T_0 - k\\Delta t = T_0 - \\tau$。因此，位移的平方为：\n$$ \\left\\lVert \\mathbf{r}_i(T_0-\\tau) - \\mathbf{r}_i(T_0) \\right\\rVert^2 = \\left\\lVert -(\\mathbf{r}_i(T_0) - \\mathbf{r}_i(T_0-\\tau)) \\right\\rVert^2 = \\left\\lVert \\mathbf{r}_i(T_0) - \\mathbf{r}_i(T_0-\\tau) \\right\\rVert^2 $$\n计算出的 $\\widetilde{\\mathrm{MSD}}(\\tau)$ 是该量对所有有效的物理时间原点 $T_0$ （这对应于对 $n$ 的平均）的平均值。所以，\n$$ \\widetilde{\\mathrm{MSD}}(\\tau) = \\left\\langle \\left\\lVert \\mathbf{r}_i(t-\\tau) - \\mathbf{r}_i(t) \\right\\rVert^2 \\right\\rangle_{i,t} $$\n因为该过程是稳态的，所以平均值与绝对时间无关。我们可以进行变量替换 $t' = t-\\tau$。对所有 $t$ 的平均等价于对所有 $t'$ 的平均。\n$$ \\widetilde{\\mathrm{MSD}}(\\tau) = \\left\\langle \\left\\lVert \\mathbf{r}_i(t') - \\mathbf{r}_i(t'+\\tau) \\right\\rVert^2 \\right\\rangle_{i,t'} = \\left\\langle \\left\\lVert -(\\mathbf{r}_i(t'+\\tau) - \\mathbf{r}_i(t')) \\right\\rVert^2 \\right\\rangle_{i,t'} $$\n由于欧几里德范数的平方满足 $\\lVert -\\mathbf{x} \\rVert^2 = \\lVert \\mathbf{x} \\rVert^2$，我们得到：\n$$ \\widetilde{\\mathrm{MSD}}(\\tau) = \\left\\langle \\left\\lVert \\mathbf{r}_i(t'+\\tau) - \\mathbf{r}_i(t') \\right\\rVert^2 \\right\\rangle_{i,t'} = \\mathrm{MSD}(\\tau) $$\n因此，计算出的均方位移保持不变。\n\n**速度自相关函数 ($\\widetilde{C}_v$) 的分析**\n\n类似地，VACF 由倒序序列计算得出：\n$$ \\widetilde{C}_v(\\tau) = \\left\\langle \\tilde{\\mathbf{v}}_i(t'_0) \\cdot \\tilde{\\mathbf{v}}_i(t'_0+\\tau) \\right\\rangle_{i,t'_0} $$\n对于一个特定的时间原点 $t'_n = n \\Delta t$，平均值内的项是：\n$$ \\tilde{\\mathbf{v}}_i(t'_n) \\cdot \\tilde{\\mathbf{v}}_i(t'_{n+k}) = \\mathbf{v}_i(t_{N-n}) \\cdot \\mathbf{v}_i(t_{N-(n+k)}) $$\n再次，设物理时间原点为 $T_0 = t_{N-n}$。那么第二个时间点是 $T_0 - \\tau$。这一项是 $\\mathbf{v}_i(T_0) \\cdot \\mathbf{v}_i(T_0-\\tau)$。计算出的 $\\widetilde{C}_v(\\tau)$ 是该量的平均值：\n$$ \\widetilde{C}_v(\\tau) = \\left\\langle \\mathbf{v}_i(t) \\cdot \\mathbf{v}_i(t-\\tau) \\right\\rangle_{i,t} $$\n根据定义，对于负延迟时间 $-\\tau$，原始的 VACF 是 $C_v(-\\tau) = \\langle \\mathbf{v}_i(t) \\cdot \\mathbf{v}_i(t-\\tau) \\rangle_{i,t}$。因此，倒序计算得到 $\\widetilde{C}_v(\\tau) = C_v(-\\tau)$。\n\n现在我们必须使用平衡系统中相关函数的一个基本性质。对于任何稳态过程：\n$$ C_v(\\tau) = \\langle \\mathbf{v}_i(t) \\cdot \\mathbf{v}_i(t+\\tau) \\rangle_{i,t} $$\n由于稳态性，我们可以将时间原点平移 $-\\tau$：\n$$ C_v(\\tau) = \\langle \\mathbf{v}_i(t-\\tau) \\cdot \\mathbf{v}_i(t) \\rangle_{i,t} $$\n由于标量积是可交换的 ($\\mathbf{a} \\cdot \\mathbf{b} = \\mathbf{b} \\cdot \\mathbf{a}$)，我们可以写成：\n$$ C_v(\\tau) = \\langle \\mathbf{v}_i(t) \\cdot \\mathbf{v}_i(t-\\tau) \\rangle_{i,t} $$\n这恰好是 $\\widetilde{C}_v(\\tau)$ 的表达式。因此，$\\widetilde{C}_v(\\tau) = C_v(\\tau)$。这也证明了 VACF 是延迟时间的偶函数，即 $C_v(\\tau) = C_v(-\\tau)$。\n\n**对扩散系数 ($D$) 的影响**\n\n由于 $\\mathrm{MSD}(\\tau)$ 和 $C_v(\\tau)$ 在时间倒序的计算下都保持不变：\n- Einstein 关系式，$D = \\lim_{\\tau \\to \\infty} \\frac{\\mathrm{MSD}(\\tau)}{2 d \\tau}$，将得到相同的 $D$ 值，因为 $\\mathrm{MSD}(\\tau)$ 保持不变。\n- Green–Kubo 关系式，$D = \\frac{1}{d} \\int_0^{\\infty} C_v(\\tau)\\, \\mathrm{d}\\tau$，也将得到相同的 $D$ 值，因为对于所有 $\\tau \\ge 0$，$C_v(\\tau)$ 都保持不变。\n\n**选项评估**\n\nA. **对于所有 $\\tau \\ge 0$，$\\mathrm{MSD}(\\tau)$ 和 $C_v(\\tau)$ 均保持不变，因此通过爱因斯坦关系式或格林-久保关系式计算得到的 $D$ 也保持不变；物理上，这些时间相关可观测量在一个稳态平衡过程中仅依赖于时间差，并且在时间反演下是偶的。**\n这个陈述与我们的推导完全一致。这两个函数确实都保持不变。因此，扩散系数 $D$ 也保持不变。所提供的物理原因也是正确的：稳态性是关键，并且相关函数是时间延迟的偶函数（在此上下文中，“在时间反演下是偶的”这一短语指的是这个性质）。**正确**。\n\nB. **$\\mathrm{MSD}(\\tau)$ 保持不变，但对于所有 $\\tau > 0$，$C_v(\\tau)$ 的符号会改变，因此 Green–Kubo 扩散系数的符号会改变，而 Einstein 扩散系数保持不变。**\n这不正确。我们已经证明 $\\widetilde{C}_v(\\tau) = C_v(\\tau)$，而不是 $-C_v(\\tau)$。符号改变会违反平衡相关函数的基本性质。**不正确**。\n\nC. **当倒序读取时，$\\mathrm{MSD}(\\tau)$ 随 $\\tau$ 减小，因为位移变为负值，而 $C_v(\\tau)$ 保持不变；因此，Einstein 扩散系数减小。**\n这个陈述是无稽之谈。MSD 是范数平方的平均值，必须为非负数。对于一个扩散系统，它是 $\\tau$ 的一个非递减函数。“位移变为负值”在这种情况下是一个不精确且无意义的短语。**不正确**。\n\nD. **$\\mathrm{MSD}(\\tau)$ 和 $C_v(\\tau)$ 都被时间反转，使得 $\\widetilde{\\mathrm{MSD}}(\\tau) = \\mathrm{MSD}(-\\tau)$ 和 $\\widetilde{C}_v(\\tau) = C_v(-\\tau)$；因此，其长时行为与正向时间计算相比符号不同，从而改变了 $D$。**\n该陈述的第一部分在数学上是正确的：倒序计算确实计算了负延迟时间下的相关函数。然而，得出的结论是错误的。它未能认识到，对于平衡稳态过程，$\\mathrm{MSD}(\\tau)$ 和 $C_v(\\tau)$ 都是 $\\tau$ 的偶函数，即 $\\mathrm{MSD}(-\\tau) = \\mathrm{MSD}(\\tau)$ 且 $C_v(-\\tau) = C_v(\\tau)$。因此，长时行为并*不*同，D 也保持不变。该选项做出了一个正确的中间步骤，但得出了一个错误的最终结论。**不正确**。\n\n唯一完全正确的陈述是 A。", "answer": "$$\\boxed{A}$$", "id": "2454558"}, {"introduction": "理论的理想情况与实际模拟之间常常存在差距，一个常见的“陷阱”就是系统的质心漂移。本练习将引导你分析一个具有非零净动量的系统，这在分子动力学模拟中是一个常见的伪影。通过这个实践，你将了解到即使是这样一个简单的设置错误，也会如何严重地破坏我们对扩散系数 $D$ 的计算，从而学会了在分析数据前进行有效性检验的重要性。[@problem_id:2454535]", "problem": "一个简单流体的分子动力学 (MD) 轨迹在温度 $T$ 和周期性边界条件下生成。由于初始化错误，系统带有一个恒定的非零净线性动量，导致质心 (COM) 在整个模拟过程中以一个均匀的漂移速度 $\\mathbf{v}_{\\mathrm{drift}}\\neq \\mathbf{0}$ 运动。一名学生在未移除质心运动的情况下分析该轨迹，计算了单粒子速度自相关函数 (VACF)，其定义为 $C_{vv}(t)=\\langle \\mathbf{v}_{i}(0)\\cdot \\mathbf{v}_{i}(t)\\rangle$，并用两种标准方法估算自扩散系数 $D$：(i) 通过 Green–Kubo 关系 $D = \\frac{1}{3}\\int_0^\\infty C_{vv}(t) dt$，以及 (ii) 通过 Einstein 均方位移 (MSD) 关系 $D=\\lim_{t\\to\\infty}\\frac{1}{6t}\\langle\\lvert \\mathbf{r}_{i}(t)-\\mathbf{r}_{i}(0)\\rvert^{2}\\rangle$。当质心漂移未被移除时，下列哪个选项最能描述长时间下 VACF 的行为以及通过每种方法计算出的 $D$ 值会发生什么？\n\nA. $C_{vv}(t)$ 像在平衡态中一样，当 $t\\to\\infty$ 时衰减到零；Green–Kubo 和 Einstein 对 $D$ 的估算均不受影响。\n\nB. 长时间下，$C_{vv}(t)$ 趋近于一个正常数 $\\lvert \\mathbf{v}_{\\mathrm{drift}}\\rvert^{2}$；Green–Kubo 时间积分发散，因此任何有限时间对 $D$ 的估算都会随积分上限线性增长，而 Einstein 估算显示的 MSD 包含一个时间的二次项，导致 $\\langle\\lvert \\mathbf{r}_{i}(t)-\\mathbf{r}_{i}(0)\\rvert^{2}\\rangle/(6t)$ 无界增长（没有长时间平台），除非移除漂移。\n\nC. 长时间下，由于漂移增强了流体动力学回流，$C_{vv}(t)$ 变为负值；两种方法都低估了相对于真实值的 $D$。\n\nD. $C_{vv}(t)$ 被向上平移一个常数，但由于平均速率是恒定的，Green–Kubo 积分保持有限；Einstein 估算不受影响，因为它仅取决于位移，而非速度。", "solution": "### 基于原理的推导\n问题的核心是理解实验室坐标系中的粒子速度 $\\mathbf{v}_i(t)$ 和位置 $\\mathbf{r}_i(t)$ 如何与它们在质心参考系中的对应量相关联，质心参考系是总动量为零且定义了真实扩散性质的坐标系。\n\n设 $\\mathbf{v}'_i(t)$ 为粒子 $i$ 在质心坐标系中的速度。那么实验室坐标系中的速度由一个简单的伽利略变换给出：\n$$ \\mathbf{v}_i(t) = \\mathbf{v}'_i(t) + \\mathbf{v}_{\\mathrm{drift}} $$\n其中 $\\mathbf{v}_{\\mathrm{drift}}$ 是恒定的质心速度。速度 $\\mathbf{v}'_i(t)$ 代表粒子的热运动。对于一个在质心坐标系中处于平衡态的系统，单个粒子热速度的系综平均值为零：$\\langle \\mathbf{v}'_i(t) \\rangle = \\mathbf{0}$。\n\n#### 速度自相关函数 ($C_{vv}(t)$) 的分析\n我们将 $\\mathbf{v}_i(t)$ 的表达式代入 $C_{vv}(t)$ 的定义 $C_{vv}(t)=\\langle \\mathbf{v}_{i}(0)\\cdot \\mathbf{v}_{i}(t)\\rangle$ 中：\n$$ C_{vv}(t) = \\langle (\\mathbf{v}'_{i}(0) + \\mathbf{v}_{\\mathrm{drift}})\\cdot (\\mathbf{v}'_{i}(t) + \\mathbf{v}_{\\mathrm{drift}})\\rangle $$\n展开点积并利用系综平均 $\\langle \\cdot \\rangle$ 的线性性质：\n$$ C_{vv}(t) = \\langle \\mathbf{v}'_{i}(0) \\cdot \\mathbf{v}'_{i}(t) \\rangle + \\langle \\mathbf{v}'_{i}(0) \\cdot \\mathbf{v}_{\\mathrm{drift}} \\rangle + \\langle \\mathbf{v}_{\\mathrm{drift}} \\cdot \\mathbf{v}'_{i}(t) \\rangle + \\langle \\mathbf{v}_{\\mathrm{drift}} \\cdot \\mathbf{v}_{\\mathrm{drift}} \\rangle $$\n我们来分析四项：\n1.  $\\langle \\mathbf{v}'_{i}(0) \\cdot \\mathbf{v}'_{i}(t) \\rangle$：这是质心坐标系中真实的 VACF，我们记作 $C'_{vv}(t)$。对于流体，热速度随时间去相关，因此当 $t \\to \\infty$ 时，该项趋于 $0$。\n2.  $\\langle \\mathbf{v}'_{i}(0) \\cdot \\mathbf{v}_{\\mathrm{drift}} \\rangle = \\langle \\mathbf{v}'_{i}(0) \\rangle \\cdot \\mathbf{v}_{\\mathrm{drift}} = \\mathbf{0} \\cdot \\mathbf{v}_{\\mathrm{drift}} = 0$，因为平均热速度为零。\n3.  $\\langle \\mathbf{v}_{\\mathrm{drift}} \\cdot \\mathbf{v}'_{i}(t) \\rangle = \\mathbf{v}_{\\mathrm{drift}} \\cdot \\langle \\mathbf{v}'_{i}(t) \\rangle = \\mathbf{v}_{\\mathrm{drift}} \\cdot \\mathbf{0} = 0$。\n4.  $\\langle \\mathbf{v}_{\\mathrm{drift}} \\cdot \\mathbf{v}_{\\mathrm{drift}} \\rangle = \\langle \\lvert \\mathbf{v}_{\\mathrm{drift}} \\rvert^2 \\rangle = \\lvert \\mathbf{v}_{\\mathrm{drift}} \\rvert^2$，因为 $\\mathbf{v}_{\\mathrm{drift}}$ 是一个常数。\n\n将这些结果代回 $C_{vv}(t)$ 的表达式中，我们得到测量到的 VACF 是：\n$$ C_{vv}(t) = C'_{vv}(t) + \\lvert \\mathbf{v}_{\\mathrm{drift}} \\rvert^2 $$\n当 $t \\to \\infty$ 时，$C'_{vv}(t) \\to 0$。因此，测量到的 VACF 趋近于一个非零正常数：\n$$ \\lim_{t\\to\\infty} C_{vv}(t) = \\lvert \\mathbf{v}_{\\mathrm{drift}} \\rvert^2 $$\n\n#### Green-Kubo 对 $D$ 的估算分析\n扩散系数通过 Green–Kubo 关系 $D = \\frac{1}{3}\\int_0^\\infty C_{vv}(t) dt$ 来计算。使用上面的结果：\n$$ D_{\\mathrm{GK}} = \\frac{1}{3} \\int_0^\\infty \\left( C'_{vv}(t) + \\lvert \\mathbf{v}_{\\mathrm{drift}} \\rvert^2 \\right) dt $$\n$$ D_{\\mathrm{GK}} = \\frac{1}{3} \\int_0^\\infty C'_{vv}(t) dt + \\frac{1}{3} \\int_0^\\infty \\lvert \\mathbf{v}_{\\mathrm{drift}} \\rvert^2 dt $$\n第一个积分项是真实的扩散系数 $D_{\\text{true}}$。第二个积分发散，因为被积函数是一个正常数：\n$$ \\frac{1}{3} \\int_0^\\infty \\lvert \\mathbf{v}_{\\mathrm{drift}} \\rvert^2 dt \\to \\infty $$\n在任何实际计算中，积分都会在有限时间 $t_{\\mathrm{max}}$ 处截断，此时对 $D$ 的估算值约为 $D_{\\text{true}} + \\frac{1}{3} t_{\\mathrm{max}} \\lvert \\mathbf{v}_{\\mathrm{drift}} \\rvert^2$。这表明计算出的 $D$ 值会随积分时间线性增长，并且不会收敛。\n\n#### Einstein 对 $D$ 的估算分析\n粒子 $i$ 从时间 $0$ 到 $t$ 的位移是 $\\Delta \\mathbf{r}_i(t) = \\mathbf{r}_i(t) - \\mathbf{r}_i(0)$。它可以通过对速度积分得到：\n$$ \\Delta \\mathbf{r}_i(t) = \\int_0^t \\mathbf{v}_i(\\tau) d\\tau = \\int_0^t (\\mathbf{v}'_i(\\tau) + \\mathbf{v}_{\\mathrm{drift}}) d\\tau = \\int_0^t \\mathbf{v}'_i(\\tau) d\\tau + \\int_0^t \\mathbf{v}_{\\mathrm{drift}} d\\tau $$\n这得到 $\\Delta \\mathbf{r}_i(t) = \\Delta \\mathbf{r}'_i(t) + t \\mathbf{v}_{\\mathrm{drift}}$，其中 $\\Delta \\mathbf{r}'_i(t)$ 是在质心坐标系中的位移。\n现在我们计算均方位移 (MSD)：\n$$ \\langle \\lvert \\Delta \\mathbf{r}_i(t) \\rvert^2 \\rangle = \\langle \\lvert \\Delta \\mathbf{r}'_i(t) + t \\mathbf{v}_{\\mathrm{drift}} \\rvert^2 \\rangle = \\langle (\\Delta \\mathbf{r}'_i(t) + t \\mathbf{v}_{\\mathrm{drift}}) \\cdot (\\Delta \\mathbf{r}'_i(t) + t \\mathbf{v}_{\\mathrm{drift}}) \\rangle $$\n展开点积：\n$$ \\langle \\lvert \\Delta \\mathbf{r}'_i(t) \\rvert^2 + 2t (\\Delta \\mathbf{r}'_i(t) \\cdot \\mathbf{v}_{\\mathrm{drift}}) + t^2 \\lvert \\mathbf{v}_{\\mathrm{drift}} \\rvert^2 \\rangle $$\n$$ = \\langle \\lvert \\Delta \\mathbf{r}'_i(t) \\rvert^2 \\rangle + 2t \\langle \\Delta \\mathbf{r}'_i(t) \\rangle \\cdot \\mathbf{v}_{\\mathrm{drift}} + t^2 \\lvert \\mathbf{v}_{\\mathrm{drift}} \\rvert^2 $$\n第一项是真实的 MSD，在长时间下约为 $\\langle \\lvert \\Delta \\mathbf{r}'_i(t) \\rvert^2 \\rangle \\approx 6 D_{\\text{true}} t$。第二项消失，因为由于对称性，粒子在质心坐标系中的平均位移为零，即 $\\langle \\Delta \\mathbf{r}'_i(t) \\rangle = \\mathbf{0}$。\n因此，对于大的 $t$，测量到的 MSD 是：\n$$ \\mathrm{MSD}(t) = \\langle \\lvert \\Delta \\mathbf{r}_i(t) \\rvert^2 \\rangle \\approx 6 D_{\\text{true}} t + t^2 \\lvert \\mathbf{v}_{\\mathrm{drift}} \\rvert^2 $$\n漂移引入了一个随时间二次增长的项。\n对 $D$ 的 Einstein 计算是：\n$$ D_E = \\lim_{t\\to\\infty} \\frac{\\mathrm{MSD}(t)}{6t} = \\lim_{t\\to\\infty} \\frac{6 D_{\\text{true}} t + t^2 \\lvert \\mathbf{v}_{\\mathrm{drift}} \\rvert^2}{6t} $$\n$$ D_E = \\lim_{t\\to\\infty} \\left( D_{\\text{true}} + \\frac{t}{6} \\lvert \\mathbf{v}_{\\mathrm{drift}} \\rvert^2 \\right) $$\n由于 $\\mathbf{v}_{\\mathrm{drift}} \\neq \\mathbf{0}$，该极限发散。计算出的量 $\\mathrm{MSD}(t)/(6t)$ 随时间线性增加，不会趋近于一个恒定的 $D$ 值。\n\n### 逐项分析\n\nA. $C_{vv}(t)$ 像在平衡态中一样，当 $t\\to\\infty$ 时衰减到零；Green–Kubo 和 Einstein 对 $D$ 的估算均不受影响。\n这是不正确的。根据推导，$C_{vv}(t)$ 衰减到一个正常数，而不是零。因此，Green-Kubo 和 Einstein 的估算都受到严重影响，导致发散。\n\nB. 长时间下，$C_{vv}(t)$ 趋近于一个正常数 $\\lvert \\mathbf{v}_{\\mathrm{drift}}\\rvert^{2}$；Green–Kubo 时间积分发散，因此任何有限时间对 $D$ 的估算都会随积分上限线性增长，而 Einstein 估算显示的 MSD 包含一个时间的二次项，导致 $\\langle\\lvert \\mathbf{r}_{i}(t)-\\mathbf{r}_{i}(0)\\rvert^{2}\\rangle/(6t)$ 无界增长（没有长时间平台），除非移除漂移。\n这个选项提供了一个完美的描述。\n-   $C_{vv}(t)$ 趋近于一个正常数 $\\lvert \\mathbf{v}_{\\mathrm{drift}}\\rvert^{2}$：正确。这与我们的推导相符。\n-   Green-Kubo 积分发散，有限时间估算线性增长：正确。这与推导相符。\n-   Einstein MSD 有一个 $t^2$ 项，其导出的 $D$ 发散：正确。这也与推导完全相符。\n这个选项是对物理现象的最佳描述。\n\nC. 长时间下，由于漂移增强了流体动力学回流，$C_{vv}(t)$ 变为负值；两种方法都低估了相对于真实值的 $D$。\n这是不正确的。在长时间下的主导效应是正的常数偏移，而不是流体动力学长时尾迹（其效应要弱得多，并且会叠加在偏移量上）。对 $D$ 的两种估算都是会发散的巨大高估，而不是低估。\n\nD. $C_{vv}(t)$ 被向上平移一个常数，但由于平均速率是恒定的，Green–Kubo 积分保持有限；Einstein 估算不受影响，因为它仅取决于位移，而非速度。\n这是不正确的。虽然 $C_{vv}(t)$ 被向上平移，但一个趋近于非零常数的函数的积分是发散的，而不是有限的。“因为平均速率是恒定的”这个理由是不相关的。Einstein 估算也受到根本性影响，因为恒定的速度漂移导致位移随时间线性增长，使得均方位移呈二次方增长。\n\n基于此分析，选项 B 是唯一正确描述所有量的定性行为的选项。", "answer": "$$\\boxed{B}$$", "id": "2454535"}, {"introduction": "从分子动力学轨迹中提取宏观性质，最后一步通常涉及对离散且充满噪声的数据进行数值处理。本练习将理论与实践联系起来，要求你评估不同的数值积分方案（如矩形法、梯形法和辛普森法则）在从含噪声的速度自相关函数 $C_{vv}(t)$ 计算扩散系数 $D$ 时的表现。这项实践将使你掌握一项关键技能：如何在不可避免的数值和统计误差存在的情况下，获得最准确的物理量估计。[@problem_id:2454571]", "problem": "您的任务是评估不同的数值积分方案如何影响从各向同性三维流体中含噪声的速度自相关函数估算自扩散系数。请使用基于平衡统计力学和数值分析的第一性原理表述。\n\n假设和基本定义：\n- 在约化单位下工作，其中玻尔兹曼常数乘以温度与粒子质量之比固定为一，即 $k_{\\mathrm{B}} T / m = 1$。在这些单位中，每个粒子分量的平衡平均速度平方为 $1$，零延迟的全维瞬时速度自相关函数满足 $C(0) = \\langle \\mathbf{v}(0) \\cdot \\mathbf{v}(0) \\rangle = 3$。\n- 速度自相关函数定义为 $C(t) = \\langle \\mathbf{v}(0) \\cdot \\mathbf{v}(t) \\rangle$。\n- 自扩散系数由 Green–Kubo 关系给出：$D = \\frac{1}{3} \\int_0^{\\infty} C(t)\\, dt$。\n\n数值采样协议：\n- 对于每个测试用例，您将获得一个解析、无噪声的目标函数 $C_{\\mathrm{true}}(t)$，它属于以下族之一：\n  1. 单指数衰减：$C_{\\mathrm{true}}(t) = 3 \\exp\\!\\left(-t/\\tau\\right)$。\n  2. 阻尼振荡：$C_{\\mathrm{true}}(t) = 3 \\exp\\!\\left(-t/\\tau\\right)\\cos(\\omega t)$。\n- 您必须在均匀时间网格 $t_i = i \\,\\Delta t$（其中 $i = 0, 1, \\dots, N-1$，$N = 1 + T_{\\max}/\\Delta t$）上对含噪声的速度自相关函数进行采样。所有给定的情况都满足 $T_{\\max}/\\Delta t$ 是一个偶数整数，因此 $N-1$ 是偶数。\n- 按 $C_i = C_{\\mathrm{true}}(t_i) + \\eta_i$ 构建含噪声的采样值，其中 $\\eta_i$ 是零均值、标准差为 $\\sigma = \\alpha\\, C(0) = 3 \\alpha$ 的独立同分布高斯随机变量。为确保可复现性，所有测试用例均使用相同的固定随机数生成器种子 $s = 12345$。\n\n数值积分方案：\n- 给定间距为 $\\Delta t$ 的采样点 $\\{C_i\\}_{i=0}^{N-1}$，定义时间积分 $I = \\int_0^{T_{\\max}} C(t)\\, dt$ 的以下离散近似：\n  - 左矩形（左黎曼）法则：\n    $$\n    I_{\\mathrm{rect}} = \\Delta t \\sum_{i=0}^{N-2} C_i.\n    $$\n  - 梯形法则：\n    $$\n    I_{\\mathrm{trap}} = \\Delta t \\left(\\tfrac{1}{2} C_0 + \\sum_{i=1}^{N-2} C_i + \\tfrac{1}{2} C_{N-1}\\right).\n    $$\n  - 复合 Simpson 法则（因 $N-1$ 为偶数而有效）：\n    $$\n    I_{\\mathrm{simp}} = \\frac{\\Delta t}{3} \\left(C_0 + C_{N-1} + 4 \\sum_{\\substack{i=1 \\\\ i \\ \\mathrm{odd}}}^{N-2} C_i + 2 \\sum_{\\substack{i=2 \\\\ i \\ \\mathrm{even}}}^{N-3} C_i \\right).\n    $$\n- 对于每种方法，通过 $D_{\\mathrm{method}} = \\frac{1}{3} I_{\\mathrm{method}}$ 估算扩散系数。不进行超出 $T_{\\max}$ 的尾部校正，也不进行平滑处理；直接将这些法则应用于含噪声的样本。\n\n解析参考值：\n- 在约化单位中，对应于每种情况的精确扩散系数为：\n  - 对于 $C_{\\mathrm{true}}(t) = 3 \\exp(-t/\\tau)$：\n    $$\n    D_{\\mathrm{true}} = \\tau.\n    $$\n  - 对于 $C_{\\mathrm{true}}(t) = 3 \\exp(-t/\\tau)\\cos(\\omega t)$：\n    $$\n    D_{\\mathrm{true}} = \\frac{\\tau}{1 + (\\omega \\tau)^2}.\n    $$\n\n误差度量与输出：\n- 对于每个测试用例和每种积分方案，计算绝对误差 $E = \\left| D_{\\mathrm{method}} - D_{\\mathrm{true}} \\right|$。将每个误差四舍五入到六位小数。\n- 将所有扩散系数和误差表示为约化单位下的纯数（无量纲），并按规定四舍五入。\n\n测试套件：\n- 使用以下五个测试用例，每个用例由一个描述 $(\\text{form}, \\tau, \\omega, \\Delta t, T_{\\max}, \\alpha)$ 的元组指定，其中 $\\text{form} \\in \\{\\text{exp}, \\text{osc}\\}$ 表示 $C_{\\mathrm{true}}(t)$ 的族：\n  1. $(\\text{exp},\\ 2.0,\\ 0.0,\\ 0.01,\\ 20.0,\\ 0.05)$\n  2. $(\\text{osc},\\ 1.0,\\ 2.0,\\ 0.002,\\ 10.0,\\ 0.02)$\n  3. $(\\text{exp},\\ 0.2,\\ 0.05,\\ 0.05,\\ 2.0,\\ 0.05)$\n  4. $(\\text{exp},\\ 1.5,\\ 0.0,\\ 0.01,\\ 15.0,\\ 0.20)$\n  5. $(\\text{exp},\\ 1.0,\\ 0.0,\\ 0.01,\\ 3.0,\\ 0.02)$\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含 $15$ 个四舍五入后的误差，格式为一个扁平、逗号分隔的列表，用方括号括起，不含空格。顺序必须是：按上文列出的顺序，对每个测试用例，其三个误差的顺序为左矩形、梯形、Simpson 法则。例如，结构必须是\n  $$\n  [E_{\\mathrm{rect}}^{(1)},E_{\\mathrm{trap}}^{(1)},E_{\\mathrm{simp}}^{(1)},\\dots,E_{\\mathrm{rect}}^{(5)},E_{\\mathrm{trap}}^{(5)},E_{\\mathrm{simp}}^{(5)}].\n  $$", "solution": "该问题陈述已经过严格验证。它在科学上基于统计力学的原理，特别是用于输运系数的 Green-Kubo 形式理论。所有参数、定义和数值步骤都得到了完整且明确的规定。该问题是适定的、客观的，并且没有内部矛盾或事实错误。因此，该问题被认为是有效的，有必要提供完整的解决方案。\n\n解决此问题的过程涉及对每个测试用例指定的步骤进行直接的数值实现。目标是量化在使用三种不同数值积分方案从含噪声的速度自相关函数 (VACF) 估算自扩散系数 $D$ 时产生的绝对误差 $E = | D_{\\mathrm{method}} - D_{\\mathrm{true}} |$。\n\n首先，对于每个测试用例，我们必须生成离散的、含噪声的 VACF 数据 $\\{C_i\\}$。每个用例的参数由元组 $(\\text{form}, \\tau, \\omega, \\Delta t, T_{\\max}, \\alpha)$ 给出。\n\n模拟时间最长延伸到 $T_{\\max}$，并以时间步长 $\\Delta t$ 进行采样。样本点数量 $N$ 由 $N = 1 + T_{\\max}/\\Delta t$ 给出。时间网格是一组等距点 $\\{t_i\\}_{i=0}^{N-1}$，其中 $t_i = i \\cdot \\Delta t$。\n\n真实的、无噪声的 VACF，$C_{\\mathrm{true}}(t)$，由 `form` 参数决定。\n对于 `form` = `exp`：\n$$C_{\\mathrm{true}}(t) = 3 \\exp(-t/\\tau)$$\n对于 `form` = `osc`：\n$$C_{\\mathrm{true}}(t) = 3 \\exp(-t/\\tau)\\cos(\\omega t)$$\n\n然后将噪声添加到这些真实值上。在时间 $t_i$ 的含噪声样本 $C_i$ 是 $C_i = C_{\\mathrm{true}}(t_i) + \\eta_i$。项 $\\eta_i$ 表示从均值为 $0$、标准差为 $\\sigma = \\alpha C(0)$ 的高斯分布中抽取的随机数。鉴于 $C(0) = 3$，标准差为 $\\sigma = 3\\alpha$。必须使用固定的随机数生成器种子 $s=12345$ 以确保随机部分的可复现性。\n\n接下来，我们使用生成的含噪声样本 $\\{C_i\\}$ 和三种指定的数值求积法则来计算定积分 $I = \\int_0^{T_{\\max}} C(t)\\, dt$：\n1.  左矩形法则：这是一种一阶方法，其中每个子区间 $[t_i, t_{i+1}]$ 上的积分由一个高为 $C_i$、宽为 $\\Delta t$ 的矩形面积来近似。总积分为：\n    $$I_{\\mathrm{rect}} = \\Delta t \\sum_{i=0}^{N-2} C_i$$\n2.  梯形法则：这种二阶方法通过由点 $(t_i, C_i)$ 和 $(t_{i+1}, C_{i+1})$ 形成的梯形面积来近似每个子区间上的积分。总积分为：\n    $$I_{\\mathrm{trap}} = \\Delta t \\left(\\frac{1}{2} C_0 + \\sum_{i=1}^{N-2} C_i + \\frac{1}{2} C_{N-1}\\right)$$\n3.  复合 Simpson 法则：这是一种四阶方法，它对连续的三点组拟合一个二次多项式。此方法在此处适用，因为区间数 $N-1$ 被指定为偶数。公式为：\n    $$I_{\\mathrm{simp}} = \\frac{\\Delta t}{3} \\left(C_0 + C_{N-1} + 4 \\sum_{\\substack{i=1 \\\\ i \\ \\mathrm{odd}}}^{N-2} C_i + 2 \\sum_{\\substack{i=2 \\\\ i \\ \\mathrm{even}}}^{N-3} C_i \\right)$$\n\n对于每种积分近似 $I_{\\mathrm{method}}$，我们使用给定的 Green-Kubo 关系计算相应的扩散系数估计值 $D_{\\mathrm{method}}$。由于公式中的积分除以因子 $3$，我们有：\n$$D_{\\mathrm{method}} = \\frac{1}{3} I_{\\mathrm{method}}$$\n\n为了评估准确性，我们将 $D_{\\mathrm{method}}$ 与从 $t=0$ 到 $t=\\infty$ 积分真实 VACF 得出的精确解析值 $D_{\\mathrm{true}}$ 进行比较。\n对于 $C_{\\mathrm{true}}(t) = 3 \\exp(-t/\\tau)$：\n$$D_{\\mathrm{true}} = \\frac{1}{3} \\int_0^{\\infty} 3 e^{-t/\\tau} dt = \\tau$$\n对于 $C_{\\mathrm{true}}(t) = 3 \\exp(-t/\\tau)\\cos(\\omega t)$：\n$$D_{\\mathrm{true}} = \\frac{1}{3} \\int_0^{\\infty} 3 e^{-t/\\tau}\\cos(\\omega t) dt = \\frac{\\tau}{1 + (\\omega \\tau)^2}$$\n请注意，数值积分是在有限区间 $[0, T_{\\max}]$ 上执行的，而 $D_{\\mathrm{true}}$ 对应于一个无穷积分。由此产生的截断误差是所测量的总误差的一部分。\n\n最后，每种方法的绝对误差计算为 $E_{\\mathrm{method}} = | D_{\\mathrm{method}} - D_{\\mathrm{true}} |$。然后按要求将这些误差四舍五入到六位小数。对所有五个测试用例重复整个过程，并将结果汇总到一个列表中。", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import simpson\n\ndef solve():\n    \"\"\"\n    Computes the absolute error in the diffusion coefficient calculation for\n    different numerical integration schemes based on noisy VACF data.\n    \"\"\"\n    # Test cases defined as (form, tau, omega, dt, T_max, alpha)\n    test_cases = [\n        ('exp', 2.0, 0.0, 0.01, 20.0, 0.05),\n        ('osc', 1.0, 2.0, 0.002, 10.0, 0.02),\n        ('exp', 0.2, 0.05, 0.05, 2.0, 0.05),\n        ('exp', 1.5, 0.0, 0.01, 15.0, 0.20),\n        ('exp', 1.0, 0.0, 0.01, 3.0, 0.02)\n    ]\n    \n    # Fixed seed for reproducibility as per problem statement\n    seed = 12345\n    rng = np.random.default_rng(seed)\n    \n    results = []\n    \n    for case in test_cases:\n        form, tau, omega, dt, T_max, alpha = case\n        \n        # Calculate derived parameters for sampling\n        # The problem guarantees T_max/dt is an integer\n        num_intervals = int(round(T_max / dt))\n        N = num_intervals + 1\n        \n        # Standard deviation of the Gaussian noise\n        # C(0) is 3 in reduced units\n        sigma = 3.0 * alpha\n        \n        # Generate the uniform time grid\n        t = np.linspace(0.0, T_max, N)\n        \n        # Calculate the true VACF and the true diffusion coefficient\n        if form == 'exp':\n            C_true = 3.0 * np.exp(-t / tau)\n            D_true = tau\n        elif form == 'osc':\n            C_true = 3.0 * np.exp(-t / tau) * np.cos(omega * t)\n            D_true = tau / (1.0 + (omega * tau)**2)\n        \n        # Generate noise and create the noisy VACF samples\n        noise = rng.normal(loc=0.0, scale=sigma, size=N)\n        C_noisy = C_true + noise\n        \n        # --- Numerical Integration ---\n        \n        # 1. Left-rectangle rule\n        # I = dt * sum(C_i from i=0 to N-2)\n        I_rect = dt * np.sum(C_noisy[:-1])\n        \n        # 2. Trapezoid rule (using numpy's implementation)\n        I_trap = np.trapz(C_noisy, dx=dt)\n        \n        # 3. Composite Simpson's rule (using scipy's implementation)\n        I_simp = simpson(C_noisy, dx=dt)\n        \n        # --- Diffusion Coefficient and Error Calculation ---\n        \n        # Calculate D for each method\n        D_rect = I_rect / 3.0\n        D_trap = I_trap / 3.0\n        D_simp = I_simp / 3.0\n        \n        # Calculate absolute errors and round to 6 decimal places\n        E_rect = round(abs(D_rect - D_true), 6)\n        E_trap = round(abs(D_trap - D_true), 6)\n        E_simp = round(abs(D_simp - D_true), 6)\n        \n        # Append errors to the results list in the specified order\n        results.extend([E_rect, E_trap, E_simp])\n        \n    # Format the final output as a single-line string\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2454571"}]}