{"hands_on_practices": [{"introduction": "任何机器学习模型的一个关键方面是其在训练数据范围之外进行外推（extrapolation）时的行为。本练习旨在探索高斯过程回归（GPR）模型在使用标准平方指数核时的这一特性。通过这个思想实验，您将理解一个基本属性：在数据稀疏的区域，GPR的预测均值会回归到其先验均值，而其预测不确定性则会回归到先验方差。理解这种行为对于批判性地评估基于GPR的势能面的可靠性至关重要。[@problem_id:2455949]", "problem": "在将分子势能面 (PES) 的一个 $1$ 维切片拟合为键角 $\\theta$ 的函数时，您使用了高斯过程回归 (GPR)，其先验均值为常数 $m(\\theta)=m_0$，协方差核为平稳平方指数核 $k(\\theta,\\theta')=\\sigma_f^2\\exp\\!\\big(-(\\theta-\\theta')^2/(2\\ell^2)\\big)$，且长度标度 $\\ell>0$ 为有限值。训练数据仅包含在区间 $\\left[\\pi/2,\\,2\\pi/3\\right]$（即约 $90^\\circ$ 到 $120^\\circ$）内对角度 $\\theta$ 采样的能量值。然后，您使用此 GPR 模型来预测该区间之外的角度 $\\theta$（包括 $\\theta\\approx 0$ 和 $\\theta\\approx \\pi$ 附近）构型的势能面和力。在此，沿角坐标的力分量定义为 $F_\\theta(\\theta)=-\\partial E(\\theta)/\\partial\\theta$。\n\n当此 GPR 模型用于训练范围之外的角度时，哪个选项最能描述其预期的失效模式？\n\nA. 在训练范围之外，预测均值趋向于先验均值 $m_0$，而预测方差接近先验方差的标度，从而产生一个非自然的平坦势能面，其预测的力 $F_\\theta(\\theta)\\approx 0$ 接近于零，且不确定性很大。\n\nB. 在训练范围之外，GPR 通过线性延续最后观测到的斜率来进行外推，并且离边界越远，预测不确定性越小，这常常因力持续增大而导致失控的动力学过程。\n\nC. 在训练范围之外，核函数自动强制角坐标的周期性，因此在 $\\left[\\pi/2,\\,2\\pi/3\\right]$ 上学到的行为被环绕应用到所有以 $2\\pi$ 为模的角度 $\\theta$ 上，从而在 $\\theta=0$ 和 $\\theta=\\pi$ 附近得到物理上准确的预测和力。\n\nD. 在训练范围之外，核函数的正定性迫使预测均值在 $|\\theta|$ 增大时发散到 $+\\infty$，这使得在这些区域预测的力激增至无穷大。", "solution": "必须首先验证用户提供的问题陈述的正确性和连贯性。\n\n### 步骤 1：提取已知条件\n- **系统**：分子势能面 (PES) 的一个 $1$ 维切片，表示为键角 $\\theta$ 的函数。\n- **模型**：高斯过程回归 (GPR)。\n- **先验均值函数**：常数，$m(\\theta) = m_0$。\n- **协方差核（函数）**：平稳平方指数核，$k(\\theta,\\theta')=\\sigma_f^2\\exp\\!\\big(-(\\theta-\\theta')^2/(2\\ell^2)\\big)$。\n- **核参数**：有限的长度标度 $\\ell > 0$ 和先验方差 $\\sigma_f^2$。\n- **训练数据**：在区间 $\\left[\\pi/2,\\,2\\pi/3\\right]$ 内对角度 $\\theta$ 采样的能量值。\n- **预测任务**：将势能面和力外推到训练区间之外的角度 $\\theta$，特别提到了 $\\theta\\approx 0$ 和 $\\theta\\approx \\pi$ 附近的区域。\n- **力的定义**：沿角坐标的力分量为 $F_\\theta(\\theta)=-\\partial E(\\theta)/\\partial\\theta$。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据标准的科学和数学原理评估问题陈述。\n- **科学依据**：该问题有充分的科学依据。GPR 是一种标准的非参数回归技术，广泛用于计算化学中，以模拟势能面。平方指数 (SE) 核，也称为径向基函数 (RBF) 核，是 GPR 最常用的选择之一。将力定义为势能的负梯度是物理学的一项基本原则。\n- **适定性**：该问题是适定的。它描述了一个特定的 GPR 模型（先验和核函数）和一个明确的外推场景。GPR 模型在远离训练数据区域的行为是由模型的先验假设决定的一个明确且可预测的特性。\n- **客观性**：语言技术性强、精确且客观。没有主观或模棱两可的陈述。\n- **完整性和一致性**：问题提供了推断模型定性行为所需的所有必要信息。它自成体系，没有矛盾。所选的核函数是明确的，这对分析至关重要。\n\n### 步骤 3：结论和行动\n问题陈述在科学上是合理的、适定的和完整的。因此，它是**有效的**。我将继续推导解决方案并评估所提供的选项。\n\n### 解题推导\n\n高斯过程由其均值函数 $m(\\theta)$ 和协方差函数 $k(\\theta, \\theta')$ 完全定义。给定一组训练数据点 $(\\boldsymbol{\\theta}, \\mathbf{y})$，其中 $\\boldsymbol{\\theta} = \\{\\theta_1, \\dots, \\theta_N\\}$ 是训练输入的向量，$\\mathbf{y} = \\{y_1, \\dots, y_N\\}$ 是观测能量的向量，对于一个新的测试点 $\\theta_*$，其预测分布是一个高斯分布，均值为 $\\mu_*(\\theta_*)$，方差为 $\\sigma_*^2(\\theta_*)$。\n\n预测均值和方差由以下公式给出：\n$$ \\mu_*(\\theta_*) = m(\\theta_*) + \\mathbf{k}_*^T \\mathbf{K}_y^{-1} (\\mathbf{y} - m(\\boldsymbol{\\theta})) $$\n$$ \\sigma_*^2(\\theta_*) = k(\\theta_*, \\theta_*) - \\mathbf{k}_*^T \\mathbf{K}_y^{-1} \\mathbf{k}_* $$\n其中：\n- $m(\\boldsymbol{\\theta})$ 是在训练点上计算的先验均值。\n- $\\mathbf{K}$ 是训练点的格拉姆矩阵，其元素为 $K_{ij} = k(\\theta_i, \\theta_j)$。\n- $\\mathbf{K}_y = \\mathbf{K} + \\sigma_n^2 \\mathbf{I}$ 是带噪声观测的协方差矩阵，其中 $\\sigma_n^2$ 是观测噪声的方差（如果未提及，则假定为零，但其存在不改变结论）。\n- $\\mathbf{k}_*$ 是测试点 $\\theta_*$ 与训练点之间的协方差向量，其元素为 $(\\mathbf{k}_*)_i = k(\\theta_*, \\theta_i)$。\n\n问题指定了常数先验均值 $m(\\theta) = m_0$ 和平方指数核 $k(\\theta,\\theta')=\\sigma_f^2\\exp\\!\\big(-(\\theta-\\theta')^2/(2\\ell^2)\\big)$。我们关注的是模型对于远离训练数据范围 $\\left[\\pi/2,\\,2\\pi/3\\right]$ 的测试点 $\\theta_*$ 的行为。\n\n对于这样的 $\\theta_*$，对所有训练点 $\\theta_i \\in \\left[\\pi/2,\\,2\\pi/3\\right]$，距离 $|\\theta_* - \\theta_i|$ 都很大。\n让我们检查向量 $\\mathbf{k}_*$ 的分量：\n$$ (\\mathbf{k}_*)_i = k(\\theta_*, \\theta_i) = \\sigma_f^2\\exp\\!\\left(-\\frac{(\\theta_*-\\theta_i)^2}{2\\ell^2}\\right) $$\n当 $|\\theta_* - \\theta_i| \\to \\infty$时，指数项迅速衰减到零。因此，向量 $\\mathbf{k}_*$ 的每个元素都趋近于$0$。用向量表示法即为 $\\mathbf{k}_* \\to \\mathbf{0}$。\n\n现在我们分析预测均值和方差的渐近行为。\n\n**预测均值行为：**\n当 $\\mathbf{k}_* \\to \\mathbf{0}$时，$\\mu_*(\\theta_*)$ 表达式中的第二项消失：\n$$ \\mathbf{k}_*^T \\mathbf{K}_y^{-1} (\\mathbf{y} - m(\\boldsymbol{\\theta})) \\to \\mathbf{0}^T \\mathbf{K}_y^{-1} (\\mathbf{y} - m(\\boldsymbol{\\theta})) = 0 $$\n因此，预测均值回归到先验均值：\n$$ \\mu_*(\\theta_*) \\to m(\\theta_*) = m_0 $$\n由于 $m_0$ 是一个常数，在远离训练数据的区域，预测的势能面变成一个非自然的平坦超平面。\n\n**预测方差行为：**\n同样，我们检查预测方差 $\\sigma_*^2(\\theta_*)$：\n$$ \\sigma_*^2(\\theta_*) = k(\\theta_*, \\theta_*) - \\mathbf{k}_*^T \\mathbf{K}_y^{-1} \\mathbf{k}_* $$\n当 $\\mathbf{k}_* \\to \\mathbf{0}$时，代表由数据引起的不确定性减少的第二项消失。\n因此，预测方差回归到该点处的先验方差：\n$$ \\sigma_*^2(\\theta_*) \\to k(\\theta_*, \\theta_*) = \\sigma_f^2\\exp\\!\\left(-\\frac{(\\theta_*-\\theta_*)^2}{2\\ell^2}\\right) = \\sigma_f^2 \\exp(0) = \\sigma_f^2 $$\n预测方差接近其最大可能值 $\\sigma_f^2$，这表示关于函数值存在高度不确定性。\n\n**预测力行为：**\n预测的力是预测平均能量的负导数：\n$$ F_\\theta(\\theta_*) = -\\frac{\\partial \\mu_*(\\theta_*)}{\\partial \\theta_*} $$\n在外推区域，$\\mu_*(\\theta_*) \\to m_0$。由于 $m_0$ 是一个常数，其导数为零。\n$$ F_\\theta(\\theta_*) \\to -\\frac{\\partial}{\\partial \\theta_*} (m_0) = 0 $$\n在远离训练数据的地方，预测的力衰减到零。\n\n总而言之，当在远离训练数据的地方进行外推时，具有常数先验均值和 SE 核的 GPR 模型会预测函数值为常数先验均值 $m_0$，不确定性为先验方差 $\\sigma_f^2$，力近似为零。这导致了一个不符合物理规律的、平坦的势能面，并伴有巨大的不确定性。\n\n### 逐项分析\n\n**A. 在训练范围之外，预测均值趋向于先验均值 $m_0$，而预测方差接近先验方差的标度，从而产生一个非自然的平坦势能面，其预测的力 $F_\\theta(\\theta)\\approx 0$ 接近于零，且不确定性很大。**\n这个陈述完美地总结了我们的推导过程。预测均值回归到常数先验 $m_0$，形成一个平坦的势能面。预测方差回归到先验方差 $\\sigma_f^2$，表明不确定性很大。常数均值的导数为零，因此预测的力接近于零。\n**结论：正确。**\n\n**B. 在训练范围之外，GPR 通过线性延续最后观测到的斜率来进行外推，并且离边界越远，预测不确定性越小，这常常因力持续增大而导致失控的动力学过程。**\n这一点在几个方面都是不正确的。线性外推是具有积分布朗运动先验（维纳过程）的 GPR 模型的特征，而不是平方指数核的特征。SE 核导致向均值回归。当远离数据时，预测不确定性是*增加*而不是减少。预测的力趋向于零，而不是增加。\n**结论：错误。**\n\n**C. 在训练范围之外，核函数自动强制角坐标的周期性，因此在 $\\left[\\pi/2,\\,2\\pi/3\\right]$ 上学到的行为被环绕应用到所有以 $2\\pi$ 为模的角度 $\\theta$ 上，从而在 $\\theta=0$ 和 $\\theta=\\pi$ 附近得到物理上准确的预测和力。**\n平方指数核 $k(\\theta,\\theta')=\\sigma_f^2\\exp\\!\\big(-(\\theta-\\theta')^2/(2\\ell^2)\\big)$ 是欧几里得距离 $(\\theta-\\theta')$ 的函数，并且不是周期性的。要对周期函数建模，需要一个特定的周期核，例如 $k_P(\\theta, \\theta') = \\sigma_f^2 \\exp(-\\frac{2\\sin^2((\\theta-\\theta')/2)}{\\ell^2})$。指定的核函数不知道坐标 $\\theta$ 的 $2\\pi$ 周期性。因此，该模型不会“环绕”学到的行为。\n**结论：错误。**\n\n**D. 在训练范围之外，核函数的正定性迫使预测均值在 $|\\theta|$ 增大时发散到 $+\\infty$，这使得在这些区域预测的力激增至无穷大。**\n正定性是任何协方差函数都必须具备的属性，以确保任何随机变量线性组合的方差为非负。它与预测均值的渐近行为没有直接关系。正如所推导的，预测均值不会发散；它回归到有限的常数先验均值 $m_0$。因此，力不会激增；它们趋向于零。\n**结论：错误。**", "answer": "$$\\boxed{A}$$", "id": "2455949"}, {"introduction": "将外推的概念更进一步，本练习提出了一个化学建模中的常见挑战：为一个在结构上与训练集中分子不同的异构体预测其性质。它阐明了即使使用具有化学感知能力的描述符，不同异构体在特征空间中仍占据不同区域，从而将预测任务转变为一个外推问题。这个实践有助于您深入理解势能面模型的适用范围和局限性，并强调模型的有效性仅限于其训练所覆盖的化学空间。[@problem_id:2455968]", "problem": "一个高斯过程回归（GPR）模型经过训练，用于近似势能面（PES），该势能面将原子核坐标 $\\mathbf{x}$ 映射到总电子能量 $E(\\mathbf{x})$。该模型使用一个旋转、平移和置换不变的描述符 $\\phi(\\mathbf{x})$ 以及一个平稳、平滑的核函数 $k\\!\\left(\\phi(\\mathbf{x}),\\phi(\\mathbf{x}')\\right)$。先验均值为 $m(\\mathbf{x}) = 0$。训练集完全由在 $\\mathrm{C}_4\\mathrm{H}_{10}$ 的线性异构体（丁烷）的低能构象周围采样的几何构型组成。训练集中不包含支链异构体（异丁烷）的任何几何构型。当预测属于异丁烷的几何构型 $\\mathbf{x}_*$ 的能量 $E(\\mathbf{x}_*)$ 时，该 GPR 模型的预期表现会是怎样的？\n\nA. 模型通常是不可靠的：因为异丁烷的几何构型在描述符空间中远离丁烷训练集，所以核相似度很小，预测均值趋向于先验均值，同时预测方差很大，误差可能也很大。\n\nB. 模型会是准确的：因为两种分子具有相同的分子式 $\\mathrm{C}_4\\mathrm{H}_{10}$，所以它们的势能面基本相同，模型可以很好地进行插值。\n\nC. 模型在相差一个加性常数的情况下是准确的：平稳核函数保证了对异丁烷的预测与真实能量之间仅相差一个恒定的能量偏移。\n\nD. 如果使用线性核函数，模型将会是准确的：线性模型的外推效果优于非线性核函数，因此缺少异丁烷数据不成问题。", "solution": "**解题推导**\n\n高斯过程（GP）由一个均值函数 $m(\\mathbf{x})$ 和一个协方差函数（核函数）$k(\\mathbf{x}, \\mathbf{x}')$ 完全确定。在此问题中，GP的输入是描述符 $\\phi(\\mathbf{x})$。\n\n问题的核心在于，仅在一种异构体（丁烷）上训练的模型，能否对另一种结构完全不同的异构体（异丁烷）做出可靠的预测。\n\n1.  **特征空间中的外推**：丁烷和异丁烷是结构异构体，具有不同的原子连接方式。因此，即使使用满足旋转、平移和置换不变性的描述符 $\\phi(\\mathbf{x})$，异丁烷构象所对应的特征向量 $\\phi(\\mathbf{x}_*)$ 也将位于特征空间中一个远离所有丁烷训练数据 $\\{\\phi(\\mathbf{x}_i)\\}$ 的区域。这意味着，对异丁烷的预测是一个典型的**外推**（extrapolation）问题。\n\n2.  **平稳核在外推区域的行为**：GPR的预测结果由核函数 $k(\\phi_*, \\phi_i)$ 决定，它衡量测试点与训练点之间的“相似性”。问题指定核函数是**平稳**且平滑的，这意味着其值主要取决于特征向量之间的距离 $||\\phi_* - \\phi_i||$。当测试点 $\\phi_*$ 远离所有训练点时，此距离很大，导致核相似度 $k(\\phi_*, \\phi_i)$ 趋近于零。\n\n3.  **预测均值和方差的回归**：\n    - **预测均值**: GPR的预测均值 $\\mu_* = \\mathbf{k}_*^T (\\mathbf{K} + \\sigma_n^2 \\mathbf{I})^{-1} \\mathbf{y}$ 正比于核相似度向量 $\\mathbf{k}_*$。当 $\\mathbf{k}_* \\to \\mathbf{0}$ 时，预测均值也趋于零。由于问题设定先验均值为0，这表明预测值回归到了**先验均值**。\n    - **预测方差**: GPR的预测方差 $\\sigma_*^2 = k(\\phi_*, \\phi_*) - \\mathbf{k}_*^T (\\mathbf{K} + \\sigma_n^2 \\mathbf{I})^{-1} \\mathbf{k}_*$。当 $\\mathbf{k}_* \\to \\mathbf{0}$ 时，方差中的第二项（代表数据提供的信息）消失，预测方差回归到**先验方差** $k(\\phi_*, \\phi_*)$，即模型不确定性的最大值。\n\n综上所述，当模型被要求对一个在特征空间中距离训练数据很远的样本进行预测时，它会“放弃”从数据中学到的信息，其预测会回归到先验假设（零均值，高方差）。这意味着预测将不可靠，且模型会通过报告高方差来表明这一点。\n\n**逐项分析选项**\n\n**A. 模型通常是不可靠的：因为异丁烷的几何构型在描述符空间中远离丁烷训练集，所以核相似度很小，预测均值趋向于先验均值，同时预测方差很大，误差可能也很大。**\n该陈述准确地总结了上述推导。\n**结论：正确**\n\n**B. 模型会是准确的：因为两种分子具有相同的分子式 $\\mathrm{C}_4\\mathrm{H}_{10}$，所以它们的势能面基本相同，模型可以很好地进行插值。**\n这是一个根本性的科学错误。结构异构体是具有不同势能面的独特化学物种。\n**结论：不正确**\n\n**C. 模型在相差一个加性常数的情况下是准确的：平稳核函数保证了对异丁烷的预测与真实能量之间仅相差一个恒定的能量偏移。**\n这是对平稳核性质的误解。平稳性不保证在外推区域的准确性。\n**结论：不正确**\n\n**D. 如果使用线性核函数，模型将会是准确的：线性模型的外推效果优于非线性核函数，因此缺少异丁烷数据不成问题。**\n线性模型的外推是线性的，对于高度非线性的势能面，这几乎肯定会产生灾难性的错误。带有衰减核的GPR能够“诚实地”报告其不确定性，这是一种更可取的行为。\n**结论：不正确**", "answer": "$$\\boxed{A}$$", "id": "2455968"}, {"introduction": "从概念理解转向实际应用，本练习要求您从零开始构建一个用于多维势能面的GPR模型。您将运用一项关键技术——构建复合核函数，即组合不同的核函数来分别模拟不同类型的分子运动，例如键的伸缩和二面角扭转。这反映了在实践中如何根据系统的潜在物理特性来定制模型的先验假设，通过亲手实现这些方程，您将获得GPR在分子建模中最强大、最灵活方面的实践经验。[@problem_id:2456000]", "problem": "您正在为一个由两个键伸缩和一个二面角描述的分子碎片建立一个降维势能面模型。令每个构型由描述符向量 $\\mathbf{x} = (r_1, r_2, \\phi)$ 表示，其中 $r_1$ 和 $r_2$ 是以 $\\text{\\AA}$ 为单位的键长，$\\phi$ 是以弧度为单位的二面角。您将假设一个零均值的高斯过程先验，其复合核函数是键伸缩部分的平方指數项和二面角部分的周期项之和：\n$$\nk(\\mathbf{x},\\mathbf{x}') \\equiv k_{\\mathrm{SE}}(\\mathbf{x},\\mathbf{x}') + k_{\\mathrm{Per}}(\\mathbf{x},\\mathbf{x}'),\n$$\n其中\n$$\nk_{\\mathrm{SE}}(\\mathbf{x},\\mathbf{x}') = \\sigma_s^2 \\exp\\left(-\\tfrac{1}{2}\\sum_{i=1}^{2}\\left(\\frac{r_i - r_i'}{\\ell_s}\\right)^2\\right),\n$$\n并且\n$$\nk_{\\mathrm{Per}}(\\mathbf{x},\\mathbf{x}') = \\sigma_p^2 \\exp\\left(-\\frac{2\\sin^2\\left(\\tfrac{\\phi - \\phi'}{2}\\right)}{\\ell_p^2}\\right).\n$$\n使用超参数 $\\sigma_s = 2.5$ $\\text{eV}$，$\\ell_s = 0.2$ $\\text{\\AA}$，$\\sigma_p = 0.4$ $\\text{eV}$ 和 $\\ell_p = 0.5$（在弧度单位下是无量纲的）。假设观测噪声是独立同分布的，其方差为 $\\sigma_n^2$，其中 $\\sigma_n = 0.02$ $\\text{eV}$。\n\n观测到的训练能量由一个具有物理动机的参考能量函数生成，该函数由两个相同的Morse键项和一个扭转项组成：\n$$\nE_{\\mathrm{ref}}(r_1,r_2,\\phi) = \\sum_{i=1}^{2}\\left[D\\left(1 - e^{-a(r_i - r_0)}\\right)^2 - D\\right] + V_0\\left(1 - \\cos(n\\phi)\\right),\n$$\n参数为 $D = 4.5$ $\\text{eV}$，$a = 1.7$ $\\text{\\AA}^{-1}$，$r_0 = 1.09$ $\\text{\\AA}$，$V_0 = 0.18$ $\\text{eV}$ 和 $n = 3$。训练输入 $\\{\\mathbf{x}_j\\}_{j=1}^{N}$ 和对应的输出 $\\{y_j\\}_{j=1}^{N}$ 由 $y_j = E_{\\mathrm{ref}}(\\mathbf{x}_j)$ 定义，对应于以下 $N = 5$ 个构型（单位：$r$ 以 $\\text{\\AA}$ 为单位，$\\phi$ 以弧度为单位）：\n- $\\mathbf{x}_1 = (r_0, r_0, 0.0)$,\n- $\\mathbf{x}_2 = (r_0 + 0.1, r_0, 0.5)$,\n- $\\mathbf{x}_3 = (r_0, r_0 + 0.15, 1.0)$,\n- $\\mathbf{x}_4 = (r_0 + 0.2, r_0 + 0.2, 2.0)$,\n- $\\mathbf{x}_5 = (r_0 - 0.1, r_0, 3.0)$.\n\n假设高斯过程先验的均值为零，协方差函数为上述的 $k(\\cdot,\\cdot)$，似然函数带有方差为 $\\sigma_n^2$ 的加性高斯噪声。令测试输入为以下 $M = 4$ 个构型（单位：$r$ 以 $\\text{\\AA}$ 为单位，$\\phi$ 以弧度为单位）：\n- $\\mathbf{x}_1^\\star = (r_0, r_0, 0.0)$,\n- $\\mathbf{x}_2^\\star = (r_0, r_0, \\pi)$,\n- $\\mathbf{x}_3^\\star = (r_0 + 0.3, r_0, -\\pi)$,\n- $\\mathbf{x}_4^\\star = (r_0 + 0.05, r_0 + 0.05, 1.0)$.\n\n计算高斯过程在每个测试输入处的后验预测均值。该值定义为在使用指定核函数和噪声方差的联合多元正态模型下，给定训练数据时预测能量的条件期望。所有预测能量均以 $\\text{eV}$ 表示。不允许使用角度制；所有角度必须以弧度制表示。\n\n您的程序必须严格按照上述规范实现，使用陈述的超参数和由 $E_{\\mathrm{ref}}$ 生成的训练数据。测试集包含上面列出的 $M=4$ 个测试构型，并覆盖以下情况：一个与训练构型重合的点，一个在 $\\phi = \\pi$ 处的最大交错二面角，一个在 $\\phi = -\\pi$ 处的周期性环绕，以及一个带有中等大小二面角的小的对称键伸缩。要求的输出是 $M = 4$ 个后验均值预测值，以 $\\text{eV}$ 为单位的实数表示。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个值都四舍五入到恰好 $6$ 位小数，例如 $[x_1,x_2,x_3,x_4]$，其中每个 $x_i$ 是一个代表能量（单位为 $\\text{eV}$）的十进制数。", "solution": "所述问题是高斯过程回归 (GPR) 在分子势能面建模中的一个定义明确的标准应用。它在科学上是合理的，数学上是一致的，并且包含了获得唯一解所需的所有必要信息。我们将着手进行推导。\n\n基本任务是给定一组训练数据，计算高斯过程 (GP) 在一组测试点上的后验预测均值。GP 定义了函数上的一个分布，在此背景下，我们将势能 $E$ 建模为分子构型 $\\mathbf{x}$ 的函数，使得 $E(\\mathbf{x}) \\sim \\mathcal{GP}(m(\\mathbf{x}), k(\\mathbf{x}, \\mathbf{x}'))$。\n\n该问题指定了一个零均值函数 $m(\\mathbf{x}) = 0$ 和一个复合协方差函数（核函数）$k(\\mathbf{x}, \\mathbf{x}')$。以 $y$ 表示的观测值被假定为真实能量函数 $E(\\mathbf{x})$ 的带噪测量值，即 $y = E(\\mathbf{x}) + \\epsilon$，其中噪声 $\\epsilon$ 来自一个均值为零、方差为 $\\sigma_n^2$ 的独立同分布高斯分布，即 $\\epsilon \\sim \\mathcal{N}(0, \\sigma_n^2)$。\n\n设训练数据为一组 $N$ 个构型 $X = \\{\\mathbf{x}_j\\}_{j=1}^{N}$ 及其对应的观测能量 $\\mathbf{y} = \\{y_j\\}_{j=1}^{N}$。设测试数据为一组 $M$ 个构型 $X_* = \\{\\mathbf{x}_i^\\star\\}_{i=1}^{M}$，我们希望预测其能量 $\\mathbf{E}_* = \\{E(\\mathbf{x}_i^\\star)\\}_{i=1}^M$。\n\n在 GP 模型下，观测到的训练输出 $\\mathbf{y}$ 和测试点上的潜在函数值 $\\mathbf{E}_*$ 的联合分布是一个多元高斯分布：\n$$\n\\begin{pmatrix} \\mathbf{y} \\\\ \\mathbf{E}_* \\end{pmatrix} \\sim \\mathcal{N}\\left(\n\\begin{pmatrix} \\mathbf{0} \\\\ \\mathbf{0} \\end{pmatrix},\n\\begin{pmatrix}\nK(X, X) + \\sigma_n^2 I & K(X, X_*) \\\\\nK(X_*, X) & K(X_*, X_*)\n\\end{pmatrix}\n\\right)\n$$\n此处，$K(X, X)$ 是在所有训练点对上求值得到的 $N \\times N$ 协方差矩阵，其元素为 $(K(X, X))_{ij} = k(\\mathbf{x}_i, \\mathbf{x}_j)$。类似地，$K(X_*, X)$ 是 $M \\times N$ 矩阵，其元素为 $(K(X_*, X))_{ij} = k(\\mathbf{x}_i^\\star, \\mathbf{x}_j)$，$K(X_*, X_*)$ 是测试点处的 $M \\times M$ 协方差矩阵。$I$ 是 $N \\times N$ 单位矩阵。\n\n后验预测分布 $p(\\mathbf{E}_* | X, \\mathbf{y}, X_*)$ 也是高斯分布。其均值是我们所求的量，由条件高斯分布的标准公式给出：\n$$\n\\bar{\\mathbf{E}}_* = \\mathbb{E}[\\mathbf{E}_* | X, \\mathbf{y}, X_*] = K(X_*, X) \\left[K(X, X) + \\sigma_n^2 I\\right]^{-1} \\mathbf{y}\n$$\n求解过程包含三个主要步骤：\n\n1.  **生成训练数据：** 训练输出 $\\mathbf{y}$ 没有直接给出，而是必须使用参考能量函数 $E_{\\mathrm{ref}}(r_1, r_2, \\phi)$ 对每个训练输入 $\\mathbf{x}_j$ 进行计算。\n    函数为：\n    $$\n    E_{\\mathrm{ref}}(r_1,r_2,\\phi) = \\sum_{i=1}^{2}\\left[D\\left(1 - e^{-a(r_i - r_0)}\\right)^2 - D\\right] + V_0\\left(1 - \\cos(n\\phi)\\right)\n    $$\n    参数为 $D = 4.5\\ \\text{eV}$，$a = 1.7\\ \\text{\\AA}^{-1}$，$r_0 = 1.09\\ \\text{\\AA}$，$V_0 = 0.18\\ \\text{eV}$ 和 $n=3$。我们对给定的 $N=5$ 个训练构型计算 $y_j = E_{\\mathrm{ref}}(\\mathbf{x}_j)$。\n\n2.  **构建核矩阵：** 我们必须构建协方差矩阵 $K(X, X)$ 和 $K(X_*, X)$。核函数是两个键長 $(r_1, r_2)$ 的平方指数项和二面角 $\\phi$ 的周期项之和：\n    $$\n    k(\\mathbf{x}, \\mathbf{x}') = \\sigma_s^2 \\exp\\left(-\\frac{1}{2\\ell_s^2}\\sum_{i=1}^{2}(r_i - r_i')^2\\right) + \\sigma_p^2 \\exp\\left(-\\frac{2\\sin^2\\left(\\tfrac{\\phi - \\phi'}{2}\\right)}{\\ell_p^2}\\right)\n    $$\n    超参数给定为 $\\sigma_s = 2.5\\ \\text{eV}$，$\\ell_s = 0.2\\ \\text{\\AA}$，$\\sigma_p = 0.4\\ \\text{eV}$ 和 $\\ell_p = 0.5$。噪声水平为 $\\sigma_n = 0.02\\ \\text{eV}$，因此噪声方差为 $\\sigma_n^2 = 0.0004\\ \\text{eV}^2$。我们计算 $5 \\times 5$ 矩阵 $K(X, X)$ 和 $4 \\times 5$ 矩阵 $K(X_*, X)$。\n\n3.  **计算后验均值：** 执行预测均值 $\\bar{\\mathbf{E}}_*$ 的最终计算。为了数值稳定性，我们不直接对矩阵 $\\left[K(X, X) + \\sigma_n^2 I\\right]$ 求逆。相反，我们首先求解以下线性方程组：\n    $$\n    \\left[K(X, X) + \\sigma_n^2 I\\right] \\boldsymbol{\\alpha} = \\mathbf{y}\n    $$\n    以求得权重向量 $\\boldsymbol{\\alpha}$。然后通过矩阵-向量积得到后验均值：\n    $$\n    \\bar{\\mathbf{E}}_* = K(X_*, X) \\boldsymbol{\\alpha}\n    $$\n此过程完全按照所述实现，以找出 $M=4$ 个测试构型的GPR预测能量。所有计算均使用浮点运算进行，角度以弧度为单位。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Gaussian process regression problem for a potential energy surface.\n    \"\"\"\n\n    # --- Define Constants and Hyperparameters ---\n    \n    # Reference energy function parameters\n    D = 4.5  # eV\n    a = 1.7  # 1/Angstrom\n    r0 = 1.09 # Angstrom\n    V0 = 0.18 # eV\n    n = 3    # dimensionless\n\n    # GPR kernel hyperparameters\n    sigma_s = 2.5  # eV\n    ell_s = 0.2    # Angstrom\n    sigma_p = 0.4  # eV\n    ell_p = 0.5    # dimensionless (for radians)\n    \n    # Observation noise\n    sigma_n = 0.02 # eV\n\n    # --- Define Training and Test Data ---\n\n    # Training configurations (N=5)\n    train_x = np.array([\n        [r0, r0, 0.0],\n        [r0 + 0.1, r0, 0.5],\n        [r0, r0 + 0.15, 1.0],\n        [r0 + 0.2, r0 + 0.2, 2.0],\n        [r0 - 0.1, r0, 3.0]\n    ])\n\n    # Test configurations (M=4)\n    test_x = np.array([\n        [r0, r0, 0.0],\n        [r0, r0, np.pi],\n        [r0 + 0.3, r0, -np.pi],\n        [r0 + 0.05, r0 + 0.05, 1.0]\n    ])\n\n    # --- Step 1: Generate Training Outputs (y) ---\n\n    def E_ref(r1, r2, phi):\n        \"\"\"Computes the reference energy.\"\"\"\n        morse_term = D * (1 - np.exp(-a * (r1 - r0)))**2 - D + \\\n                     D * (1 - np.exp(-a * (r2 - r0)))**2 - D\n        torsional_term = V0 * (1 - np.cos(n * phi))\n        return morse_term + torsional_term\n\n    train_y = np.array([E_ref(x[0], x[1], x[2]) for x in train_x])\n\n    # --- Step 2: Construct Kernel Matrices ---\n\n    def kernel(x1, x2):\n        \"\"\"Computes the composite kernel value k(x1, x2).\"\"\"\n        r1_1, r2_1, phi_1 = x1\n        r1_2, r2_2, phi_2 = x2\n\n        # Squared-exponential kernel for bond stretches\n        sq_dist_r = (r1_1 - r1_2)**2 + (r2_1 - r2_2)**2\n        k_se = (sigma_s**2) * np.exp(-0.5 * sq_dist_r / (ell_s**2))\n\n        # Periodic kernel for dihedral angle\n        d_phi = phi_1 - phi_2\n        k_per = (sigma_p**2) * np.exp(-2.0 * (np.sin(d_phi / 2.0)**2) / (ell_p**2))\n        \n        return k_se + k_per\n    \n    N = len(train_x)\n    M = len(test_x)\n\n    # K(X, X): training data covariance matrix (N x N)\n    K_XX = np.zeros((N, N))\n    for i in range(N):\n        for j in range(N):\n            K_XX[i, j] = kernel(train_x[i], train_x[j])\n\n    # K(X_*, X): test-training data covariance matrix (M x N)\n    K_starX = np.zeros((M, N))\n    for i in range(M):\n        for j in range(N):\n            K_starX[i, j] = kernel(test_x[i], train_x[j])\n\n    # --- Step 3: Compute the Posterior Mean ---\n    \n    # Add noise variance to the diagonal of K(X, X)\n    K_y = K_XX + (sigma_n**2) * np.eye(N)\n    \n    # Solve the linear system for alpha: K_y * alpha = y\n    try:\n        alpha = np.linalg.solve(K_y, train_y)\n    except np.linalg.LinAlgError:\n        # Fallback to pseudoinverse if solve fails, though not expected here\n        alpha = np.linalg.pinv(K_y) @ train_y\n\n    # Compute posterior predictive mean: E_star = K(X_*, X) * alpha\n    E_star_mean = K_starX @ alpha\n    \n    # --- Final Output Formatting ---\n    \n    results = [f\"{val:.6f}\" for val in E_star_mean]\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2456000"}]}