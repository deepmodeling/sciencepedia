{"hands_on_practices": [{"introduction": "我们首先从一个理想化的思想实验开始，探索固定节点扩散蒙特卡罗（Fixed-Node DMC）方法何时能够给出精确的基态能量。这个练习将引导我们思考一维量子系统的基态波函数所具有的一个基本性质，以及它如何与固定节点近似的误差直接相关。通过理解固定节点误差在何种条件下会消失，你将更深刻地体会到为何节点结构是DMC计算中至关重要的核心要素。[@problem_id:2454189]", "problem": "一个质量为 $m$ 的单个非相对论性粒子在一维（1D）实数、下方有界的标量势 $V(x)$ 中运动。不含时的薛定谔算符为 $H=-\\frac{\\hbar^2}{2m}\\frac{\\mathrm{d}^2}{\\mathrm{d}x^2}+V(x)$，其定义域具有适当的边界条件，使 $H$ 成为自伴算符。扩散蒙特卡洛（DMC）方法通过演化虚时薛定谔方程 $-\\frac{\\partial}{\\partial \\tau}\\Psi(x,\\tau)=(H-E_{\\text{ref}})\\Psi(x,\\tau)$ 来投影出 $H$ 的基态。为了控制费米子或符号变化的试探输入的符号问题，固定节点近似将演化中的解约束在一个实数试探波函数 $\\Psi_T(x)$ 的节点集 $\\mathcal{N}_T=\\{x:\\Psi_T(x)=0\\}$ 上为零，并找到在 $\\mathcal{N}_T$ 上服从狄利克雷边界条件的 $H$ 的最低能量本征函数。\n\n对于这种一维、实数标量势 $V(x)$ 的情况，请选择一个选项，其指定的势 $V(x)$ 会内在地导致固定节点DMC模拟灾难性地失败，无法找到真实的基态。这里的失败指的是，固定节点能量始终严格高于精确的基态能量，其差值非零，且无法通过减小时间步长偏差、统计误差或选择任何实数试探波函数来消除。\n\nA. 对称双阱势 $V(x)=a(x^2-b^2)^2$，其中 $a0$ 且 $b0$。\n\nB. 宽度为 $2L$ 的无限深方势阱，中心有一个吸引性点杂质：当 $|x|L$ 时 $V(x)=0$，当 $|x|\\ge L$ 时 $V(x)=+\\infty$，以及 $V(x)=-\\lambda\\,\\delta(x)$，其中 $\\lambda0$。\n\nC. 两个由不可穿透势垒隔开的不相交有限深势阱：当 $x0$ 时 $V(x)=V_1(x)$，当 $0\\le x\\le w$ 时 $V(x)=+\\infty$，当 $xw$ 时 $V(x)=V_2(x)$，其中 $V_1(x)$ 和 $V_2(x)$ 是具有不同极小值的光滑、有限深度势阱。\n\nD. 以上都不是；对于任何一维实数标量势 $V(x)$，固定节点DMC都可以通过选择一个无节点的实数试探函数来获得精确的基态能量，因此不存在仅由 $V(x)$ 引起的内在灾难性失败。", "solution": "首先验证问题陈述，以确保其科学上合理、适定且客观。\n\n### 步骤 1：提取已知条件\n- 系统：一个质量为 $m$ 的单个非相对论性粒子在一维（1D）空间中运动。\n- 势 $V(x)$：一个实数、下方有界的标量势。\n- 哈密顿算符：$H=-\\frac{\\hbar^2}{2m}\\frac{\\mathrm{d}^2}{\\mathrm{d}x^2}+V(x)$，在其定义域上被指定为自伴算符。\n- 扩散蒙特卡洛（DMC）方法：演化由虚时薛定谔方程 $-\\frac{\\partial}{\\partial \\tau}\\Psi(x,\\tau)=(H-E_{\\text{ref}})\\Psi(x,\\tau)$ 控制。\n- 固定节点（FN）近似：演化中的波函数被约束在给定实数试探波函数 $\\Psi_T(x)$ 的节点集 $\\mathcal{N}_T=\\{x:\\Psi_T(x)=0\\}$ 上为零。\n- FN 能量定义：FN 方法找到在 $\\mathcal{N}_T$ 上服从狄利克雷边界条件的 $H$ 的最低能量本征函数。\n- 问题：从选项中找出一个势 $V(x)$，它导致固定节点DMC模拟*内在地*失败。 “内在失败”定义为：对于*任何*实数试探波函数 $\\Psi_T(x)$ 的选择，固定节点能量 $E_{FN}$ 都严格大于精确基态能量 $E_0$（$E_{FN}  E_0$），且这种差异无法通过改善统计或减小时间步长偏差来消除。\n\n### 步骤 2：使用提取的已知条件进行验证\n问题陈述描述了量子力学中的一个标准情景以及一种成熟的计算方法——带固定节点近似的扩散蒙特卡洛的应用。所有术语都以标准方式定义。该设置在科学上基于量子力学和计算化学。对势（$V(x)$ 是实数且下方有界）和哈密顿算符（$H$ 是自伴的）的约束是适当的，以确保一个行为良好的量子系统具有稳定的基态。问题清晰、客观，其前提不包含科学不准确之处。该问题是一个关于固定节点近似在特定背景下局限性的概念性问题。\n\n### 步骤 3：结论与行动\n问题陈述是**有效的**。它是自洽的、科学上合理的和适定的。可以进行求解。\n\n### 推导\n这个问题的核心在于一维量子系统基态的性质以及扩散蒙特卡洛（DMC）中固定节点近似的本质。\n\n1.  **固定节点近似与能量**：固定节点DMC方法计算一个能量 $E_{FN}$，它是哈密顿算符 $H$ 在一个受试探波函数 $\\Psi_T(x)$ 节点限制的区域内的基态本征值。节点集 $\\mathcal{N}_T = \\{x | \\Psi_T(x) = 0\\}$ 充当了无限高的势垒，施加了狄利克雷边界条件。变分原理保证了这个固定节点能量是真实基态能量 $E_0$ 的一个上界，即 $E_{FN} \\ge E_0$。\n\n2.  **精确性条件**：等式 $E_{FN} = E_0$ 成立的充分必要条件是试探波函数的节点集 $\\mathcal{N}_T$ 与精确基态波函数的节点集 $\\mathcal{N}_0$ 完全相同。如果节点不正确，就会引入一个称为固定节点误差的误差，此时 $E_{FN}  E_0$。问题要求寻找一种情况，使得无论选择何种实数试探函数 $\\Psi_T$，这种不等式都不可避免。\n\n3.  **一维基态**：源于将斯图姆-刘维尔理论应用于一维不含时薛定谔方程的一条量子力学基本定理指出，对于在实势 $V(x)$ 中运动的单个粒子，束缚态的基态本征函数 $\\Psi_0(x)$ 总可以被选为实数且无节点（在它的定义域内没有零点）。$\\Psi_0(x)$ 唯一可能为零的点是定义域的边界，前提是那里的势为无穷大。\n\n4.  **对固定节点DMC的启示**：由于真实的基态波函数 $\\Psi_0(x)$ 是无节点的，其节点集是空集，即 $\\mathcal{N}_0 = \\emptyset$。为了获得精确的基态能量 $E_0$，固定节点DMC计算必须使用一个节点集同样是空集的试探波函数 $\\Psi_T(x)$。这需要选择一个无节点的试探波函数，即在定义域内的所有 $x$ 处都有 $\\Psi_T(x) \\neq 0$。\n\n5.  **可行性**：对于所描述的任何一种势，总是可以构造一个无节点的实数试探函数。一个常见且简单的选择是高斯函数，$\\Psi_T(x) = e^{-\\alpha x^2}$，其中常数 $\\alpha  0$。这个函数是实数且没有节点。\n\n6.  **结论**：如果使用一个无节点的试探函数 $\\Psi_T(x)$，固定节点约束就变得无关紧要。 “节点面”是空的，因此没有在定义域内部施加边界条件。DMC模拟在限制意义上不再是“固定节点”的；它执行的是对原始、无约束的哈密顿算符 $H$ 的基态的投影。这样的模拟在原理上（即，按问题陈述所说，忽略统计误差和时间步长误差）保证会收敛到精确的基态能量 $E_0$。\n\n因此，对于任何具有实势的单粒子一维系统，总是存在一类试探函数（无节点的函数），使得固定节点DMC能够获得精确的基态能量。在此框架内，不存在任何势 $V(x)$ 会*内在地*导致该方法对*任何*实数试探函数的选择都失败。固定节点DMC的灾难性失败是那些基态因对称性要求而必须有节点的系统的特征，最著名的是由于泡利不相容原理导致的多费米子系统，或者是对于激发态。\n\n### 逐项分析\n\nA. **对称双阱势 $V(x)=a(x^2-b^2)^2$，其中 $a0$ 且 $b0$。**\n该势是对称的，$V(x) = V(-x)$。基态波函数 $\\Psi_0(x)$ 必须是偶函数。它将在两个阱中出现峰值，并在势垒区域因隧穿效应而为非零。它处处为正，因此是无节点的。如上所述，选择一个无节点的试探函数（例如，一个对称的类高斯函数）将得到精确的基态能量。因此，这个势不会导致内在失败。**不正确**。\n\nB. **宽度为 $2L$ 的无限深方势阱，中心有一个吸引性点杂质：当 $|x|L$ 时 $V(x)=0$，当 $|x|\\ge L$ 时 $V(x)=+\\infty$，以及 $V(x)=-\\lambda\\,\\delta(x)$，其中 $\\lambda0$。**\n这是另一个对称势。原点的吸引性 delta 函数确保了基态波函数在 $x=0$ 处有一个尖点和最大值。该波函数在阱内（对于 $|x|L$）处处为正，并在边界 $x=\\pm L$ 处为零。它是无节点的。可以使用无节点的试探函数来恢复精确能量。因此，这个势不会导致内在失败。**不正确**。\n\nC. **两个由不可穿透势垒隔开的不相交有限深势阱：当 $x0$ 时 $V(x)=V_1(x)$，当 $0\\le x\\le w$ 时 $V(x)=+\\infty$，当 $xw$ 时 $V(x)=V_2(x)$，其中 $V_1(x)$ 和 $V_2(x)$ 是具有不同极小值的光滑、有限深度势阱。**\n该系统在物理上等效于两个独立的系统：一个在区域 $x0$，另一个在 $xw$。组合系统的基态就是两个子系统中基态能量较低的那个的基态。假设势阱 $V_1(x)$ 的基态能量较低，为 $E_{0,1}$。那么真实的基态 $\\Psi_0(x)$ 将是 $V_1(x)$ 系统的基态波函数（在其定义域 $x0$ 内是无节点的），并且对于 $x \\ge 0$ 将恒为零。为了用DMC找到这个能量，可以简单地使用一个也只局域在区域 $x0$ 并且在该区域内无节点的试探函数 $\\Psi_T(x)$。这将正确地收敛到 $E_{0,1}$。即使使用一个在两个阱中都有支撑的试探函数，行走子也无法穿过无限势垒。两个阱中的布居数独立演化，DMC算法会自然地投影出能量最低的状态。能量较高阱中的布居数将相对于能量较低阱中的布居数衰减，模拟将收敛到真实的基态能量。因此，这个势不会导致内在失败。**不正确**。\n\nD. **以上都不是；对于任何一维实数标量势 $V(x)$，固定节点DMC都可以通过选择一个无节点的实数试探函数来获得精确的基态能量，因此不存在仅由 $V(x)$ 引起的内在灾难性失败。**\n这个选项正确地陈述了我们推导的结论。基于一维单粒子系统基态是无节点的基本定理，总是可以选择一个试探函数，使其节点与真实基态的（空的）节点集相匹配。这种选择使得固定节点DMC在原理上能够计算出精确的基态能量。因此，所列的势以及此类中的任何其他势，都不能导致问题中所定义的那种*内在*失败。**正确**。", "answer": "$$\\boxed{D}$$", "id": "2454189"}, {"introduction": "从理想情况转向实际应用，我们来审视DMC计算中最常见的陷阱之一：布居不稳定性。这个练习提供了一个简化但功能强大的“流氓行走者”（rogue walker）模型，用于定量地展示仅仅一个具有极低局域能的行走者如何能够主导整个模拟。通过亲手计算有效布居数和有偏的平均能量，你将对权重方差及其对统计效率的破坏性影响获得一个具体而直观的理解。[@problem_id:2454178]", "problem": "考虑一个简化的扩散蒙特卡罗（DMC）虚时表述，其中一个包含 $N$ 个独立行走子的系综在常数时间步长 $\\Delta \\tau$ 下演化 $T$ 步，演化仅通过其标量权重进行。每个行走子 $i$ 都被赋予一个与时间无关的局域能量 $E_i$。设所有行走子 $i$ 的初始权重为 $w_i(0)=1$，并设 $E_{\\mathrm{ref}}$ 为一个固定的参考能量。一个时间步长后的权重更新定义为\n$$\nw_i(t+1)=w_i(t)\\exp\\!\\big(-\\Delta \\tau\\,(E_i-E_{\\mathrm{ref}})\\big),\\quad t=0,1,\\dots,T-1.\n$$\n经过 $T$ 步后，定义归一化权重 $\\tilde{w}_i(T)=\\frac{w_i(T)}{\\sum_{j=1}^N w_j(T)}$，有效布居数\n$$\nN_{\\mathrm{eff}}(T)=\\frac{1}{\\sum_{i=1}^N \\tilde{w}_i(T)^2},\n$$\n以及加权平均能量\n$$\nE_{\\mathrm{avg}}(T)=\\sum_{i=1}^N \\tilde{w}_i(T)\\,E_i.\n$$\n为了模拟单个“异常行走子”的影响，假设所有非异常行走子具有相同的局域能量 $E_{\\mathrm{typ}}$，而最多只有一个指定的异常行走子具有极低的局域能量 $E_{\\mathrm{rog}}E_{\\mathrm{typ}}$。如果在某个测试用例中没有异常行走子，则所有 $E_i=E_{\\mathrm{typ}}$。\n\n您的任务是根据上述定义，为每个指定的测试用例计算两个最终量 $E_{\\mathrm{avg}}(T)$ 和 $N_{\\mathrm{eff}}(T)$。不需要物理单位。不涉及角度。报告的每个数值答案必须四舍五入到 $6$ 位小数。\n\n测试套件（每行为一个测试用例，参数顺序为 $(N,\\Delta \\tau,T,E_{\\mathrm{typ}},E_{\\mathrm{ref}},r,E_{\\mathrm{rog}})$，其中 $r$ 是异常行走子的数量，为 $0$ 或 $1$；如果 $r=1$，则恰好有一个行走子是异常的，否则没有异常行走子）：\n- $(5,\\,0.1,\\,0,\\,1.0,\\,0.0,\\,0,\\,0.0)$\n- $(5,\\,0.1,\\,10,\\,1.0,\\,1.0,\\,0,\\,0.0)$\n- $(5,\\,0.1,\\,10,\\,1.0,\\,1.0,\\,1,\\,-50.0)$\n- $(10,\\,0.0,\\,100,\\,2.0,\\,1.0,\\,1,\\,-20.0)$\n\n您的程序应生成单行输出，其中包含结果，格式为方括号括起来的逗号分隔的数对列表，每个数对是对应测试用例的 $[E_{\\mathrm{avg}}(T),N_{\\mathrm{eff}}(T)]$。例如，整体输出格式必须是\n$[[E_{\\mathrm{avg}}^{(1)},N_{\\mathrm{eff}}^{(1)}],[E_{\\mathrm{avg}}^{(2)},N_{\\mathrm{eff}}^{(2)}],\\dots]$,\n每个浮点数四舍五入到 $6$ 位小数，不含附加文本。", "solution": "在尝试给出解答之前，首先对问题进行验证。\n\n### 步骤 1：提取已知信息\n-   行走子数量：$N$\n-   时间步长：$\\Delta \\tau$\n-   总步数：$T$\n-   所有行走子的初始权重：$w_i(0)=1$\n-   行走子 $i$ 的不依赖于时间的局域能量：$E_i$\n-   固定参考能量：$E_{\\mathrm{ref}}$\n-   权重更新规则：$w_i(t+1)=w_i(t)\\exp(-\\Delta \\tau\\,(E_i-E_{\\mathrm{ref}}))$，其中 $t=0,1,\\dots,T-1$\n-   归一化最终权重：$\\tilde{w}_i(T)=\\frac{w_i(T)}{\\sum_{j=1}^N w_j(T)}$\n-   有效布居数：$N_{\\mathrm{eff}}(T)=\\frac{1}{\\sum_{i=1}^N \\tilde{w}_i(T)^2}$\n-   加权平均能量：$E_{\\mathrm{avg}}(T)=\\sum_{i=1}^N \\tilde{w}_i(T)\\,E_i$\n-   异常行走子模型：\n    -   典型能量：$E_{\\mathrm{typ}}$\n    -   异常能量：$E_{\\mathrm{rog}}  E_{\\mathrm{typ}}$\n    -   异常行走子数量：$r \\in \\{0, 1\\}$\n    -   若 $r=0$，所有 $E_i=E_{\\mathrm{typ}}$。\n    -   若 $r=1$，一个行走子能量为 $E_{\\mathrm{rog}}$，$N-1$ 个行走子能量为 $E_{\\mathrm{typ}}$。\n-   测试用例：\n    1.  $(N, \\Delta \\tau, T, E_{\\mathrm{typ}}, E_{\\mathrm{ref}}, r, E_{\\mathrm{rog}}) = (5, 0.1, 0, 1.0, 0.0, 0, 0.0)$\n    2.  $(N, \\Delta \\tau, T, E_{\\mathrm{typ}}, E_{\\mathrm{ref}}, r, E_{\\mathrm{rog}}) = (5, 0.1, 10, 1.0, 1.0, 0, 0.0)$\n    3.  $(N, \\Delta \\tau, T, E_{\\mathrm{typ}}, E_{\\mathrm{ref}}, r, E_{\\mathrm{rog}}) = (5, 0.1, 10, 1.0, 1.0, 1, -50.0)$\n    4.  $(N, \\Delta \\tau, T, E_{\\mathrm{typ}}, E_{\\mathrm{ref}}, r, E_{\\mathrm{rog}}) = (10, 0.0, 100, 2.0, 1.0, 1, -20.0)$\n\n### 步骤 2：使用提取的已知信息进行验证\n该问题具有科学依据，描述了扩散蒙特卡罗（计算科学中的一种标准方法）中简化的权重传播过程。问题提法明确，所有必要的方程、初始条件和参数均已定义，确保每个测试用例都有唯一解。语言客观且数学上精确。设定是自洽的，没有矛盾。该问题未违反任何无效性标准。\n\n### 步骤 3：结论与行动\n此问题是**有效的**。将提供解答。\n\n### 基于原理的解答\n问题要求计算一个行走子系综的最终平均能量 $E_{\\mathrm{avg}}(T)$ 和有效布居数 $N_{\\mathrm{eff}}(T)$。问题的核心在于确定最终权重 $w_i(T)$。\n\n首先，我们寻找最终权重 $w_i(T)$ 的封闭形式表达式。权重更新规则是一个递推关系：\n$$\nw_i(t+1)=w_i(t)\\exp(-\\Delta \\tau\\,(E_i-E_{\\mathrm{ref}}))\n$$\n设行走子 $i$ 的增长因子为 $g_i = \\exp(-\\Delta \\tau\\,(E_i-E_{\\mathrm{ref}}))$。关系为 $w_i(t+1) = w_i(t) g_i$。根据初始条件 $w_i(0)=1$，我们可以展开这个递推关系：\n$w_i(1) = w_i(0) g_i = g_i$\n$w_i(2) = w_i(1) g_i = g_i^2$\n...\n经过 $T$ 步后，最终权重为：\n$$\nw_i(T) = w_i(0) g_i^T = g_i^T = \\exp(-T \\Delta \\tau\\,(E_i-E_{\\mathrm{ref}}))\n$$\n此公式适用于任意步数 $T \\ge 0$。如果 $T=0$，指数为 $0$，得出 $w_i(0)=1$，这与初始条件一致。\n\n问题根据异常行走子的数量 $r$ 定义了两种情况。\n\n**情况 1：无异常行走子 ($r=0$)**\n在这种情况下，所有 $N$ 个行走子都是相同的。它们的局域能量都等于 $E_{\\mathrm{typ}}$。\n$E_i = E_{\\mathrm{typ}}$ 对于所有 $i \\in \\{1, \\dots, N\\}$。\n因此，它们的最终权重也相同：\n$$\nw_i(T) = \\exp(-T \\Delta \\tau\\,(E_{\\mathrm{typ}}-E_{\\mathrm{ref}})) = w_{\\mathrm{typ}}(T)\n$$\n所有权重的总和是 $\\sum_{j=1}^N w_j(T) = N w_{\\mathrm{typ}}(T)$。归一化权重为：\n$$\n\\tilde{w}_i(T) = \\frac{w_{\\mathrm{typ}}(T)}{N w_{\\mathrm{typ}}(T)} = \\frac{1}{N}\n$$\n平均能量是能量的简单算术平均值，即 $E_{\\mathrm{typ}}$：\n$$\nE_{\\mathrm{avg}}(T) = \\sum_{i=1}^N \\tilde{w}_i(T) E_i = \\sum_{i=1}^N \\frac{1}{N} E_{\\mathrm{typ}} = N \\left(\\frac{E_{\\mathrm{typ}}}{N}\\right) = E_{\\mathrm{typ}}\n$$\n有效布居数计算如下：\n$$\nN_{\\mathrm{eff}}(T) = \\frac{1}{\\sum_{i=1}^N \\tilde{w}_i(T)^2} = \\frac{1}{\\sum_{i=1}^N \\left(\\frac{1}{N}\\right)^2} = \\frac{1}{N \\cdot \\frac{1}{N^2}} = \\frac{1}{1/N} = N\n$$\n因此，对于任何 $r=0$ 的情况，结果都是 $E_{\\mathrm{avg}}(T) = E_{\\mathrm{typ}}$ 和 $N_{\\mathrm{eff}}(T) = N$。\n\n**情况 2：有一个异常行走子 ($r=1$)**\n在这种情况下，有两种不同类型的行走子。不失一般性地，我们可以将索引 $i=1$ 赋给异常行走子，将索引 $i=2, \\dots, N$ 赋给典型行走子。\n-   异常行走子的能量为 $E_1 = E_{\\mathrm{rog}}$。\n-   $N-1$ 个典型行走子的能量为 $E_i = E_{\\mathrm{typ}}$，其中 $i  1$。\n\n它们的最终未归一化权重是：\n$$\nw_{\\mathrm{rog}}(T) \\equiv w_1(T) = \\exp(-T \\Delta \\tau\\,(E_{\\mathrm{rog}}-E_{\\mathrm{ref}}))\n$$\n$$\nw_{\\mathrm{typ}}(T) \\equiv w_i(T) \\text{ for } i1 = \\exp(-T \\Delta \\tau\\,(E_{\\mathrm{typ}}-E_{\\mathrm{ref}}))\n$$\n所有权重的总和 $S_w$ 是：\n$$\nS_w = w_{\\mathrm{rog}}(T) + (N-1)w_{\\mathrm{typ}}(T)\n$$\n归一化权重为 $\\tilde{w}_{\\mathrm{rog}}(T) = w_{\\mathrm{rog}}(T)/S_w$ 和 $\\tilde{w}_{\\mathrm{typ}}(T) = w_{\\mathrm{typ}}(T)/S_w$。平均能量是能量的加权和：\n$$\nE_{\\mathrm{avg}}(T) = \\tilde{w}_{\\mathrm{rog}}(T) E_{\\mathrm{rog}} + (N-1)\\tilde{w}_{\\mathrm{typ}}(T) E_{\\mathrm{typ}} = \\frac{w_{\\mathrm{rog}}(T) E_{\\mathrm{rog}} + (N-1)w_{\\mathrm{typ}}(T) E_{\\mathrm{typ}}}{w_{\\mathrm{rog}}(T) + (N-1)w_{\\mathrm{typ}}(T)}\n$$\n有效布居数为：\n$$\nN_{\\mathrm{eff}}(T) = \\frac{1}{\\tilde{w}_{\\mathrm{rog}}(T)^2 + (N-1)\\tilde{w}_{\\mathrm{typ}}(T)^2} = \\frac{S_w^2}{w_{\\mathrm{rog}}(T)^2 + (N-1)w_{\\mathrm{typ}}(T)^2}\n$$\n代入 $S_w$:\n$$\nN_{\\mathrm{eff}}(T) = \\frac{\\big(w_{\\mathrm{rog}}(T) + (N-1)w_{\\mathrm{typ}}(T)\\big)^2}{w_{\\mathrm{rog}}(T)^2 + (N-1)w_{\\mathrm{typ}}(T)^2}\n$$\n这些通用公式将用于解决测试用例。\n\n**将公式应用于测试用例：**\n\n-   **测试用例 1：** $(5, 0.1, 0, 1.0, 0.0, 0, 0.0)$\n    $r=0$。使用为此情况推导出的结果：$E_{\\mathrm{avg}}(0) = E_{\\mathrm{typ}} = 1.0$ 和 $N_{\\mathrm{eff}}(0) = N = 5.0$。\n\n-   **测试用例 2：** $(5, 0.1, 10, 1.0, 1.0, 0, 0.0)$\n    $r=0$。类似地，$E_{\\mathrm{avg}}(10) = E_{\\mathrm{typ}} = 1.0$ 和 $N_{\\mathrm{eff}}(10) = N = 5.0$。注意 $E_{\\mathrm{typ}} - E_{\\mathrm{ref}} = 0$，所以所有权重在整个模拟过程中都保持为 $1$，导致相同的结果。\n\n-   **测试用例 3：** $(5, 0.1, 10, 1.0, 1.0, 1, -50.0)$\n    $r=1$。参数：$N=5$, $\\Delta \\tau=0.1$, $T=10$, $E_{\\mathrm{typ}}=1.0$, $E_{\\mathrm{ref}}=1.0$, $E_{\\mathrm{rog}}=-50.0$。\n    乘积 $T \\Delta \\tau = 1.0$。\n    异常行走子的指数：$-T \\Delta \\tau (E_{\\mathrm{rog}} - E_{\\mathrm{ref}}) = -1.0(-50.0 - 1.0) = 51.0$。\n    典型行走子的指数：$-T \\Delta \\tau (E_{\\mathrm{typ}} - E_{\\mathrm{ref}}) = -1.0(1.0 - 1.0) = 0.0$。\n    权重：$w_{\\mathrm{rog}}(10) = \\exp(51.0)$，$w_{\\mathrm{typ}}(10) = \\exp(0.0) = 1.0$。\n    $N-1=4$。\n    $E_{\\mathrm{avg}}(10) = \\frac{\\exp(51.0) \\cdot (-50.0) + 4 \\cdot 1.0 \\cdot 1.0}{\\exp(51.0) + 4 \\cdot 1.0}$。由于 $\\exp(51.0)$ 是一个天文数字般的大数，$E_{\\mathrm{avg}}(10) \\approx \\frac{\\exp(51.0) \\cdot (-50.0)}{\\exp(51.0)} = -50.0$。\n    $N_{\\mathrm{eff}}(10) = \\frac{(\\exp(51.0) + 4)^2}{\\exp(51.0)^2 + 4}$。由于异常行走子的权重占主导地位，有效布居数趋近于 $1.0$。有效布居数坍缩到一个占主导地位的行走子上。\n    计算得出 $E_{\\mathrm{avg}}(10) \\approx -50.0$ 且 $N_{\\mathrm{eff}}(10) \\approx 1.0$。\n\n-   **测试用例 4：** $(10, 0.0, 100, 2.0, 1.0, 1, -20.0)$\n    $r=1$。参数：$N=10$, $\\Delta \\tau=0.0$, $T=100$, $E_{\\mathrm{typ}}=2.0$, $E_{\\mathrm{ref}}=1.0$, $E_{\\mathrm{rog}}=-20.0$。\n    时间步长 $\\Delta \\tau = 0.0$。这意味着权重更新中的指数始终为 $0$。\n    $w_i(T) = \\exp(-T \\cdot 0 \\cdot (E_i - E_{\\mathrm{ref}})) = \\exp(0) = 1$ 对所有行走子成立。\n    所有行走子的最终权重都为 $1$，无论其能量如何。系综是等权重的。\n    归一化权重为 $\\tilde{w}_i(100) = 1/N = 1/10$。\n    $E_{\\mathrm{avg}}(100)$ 是 $10$ 个行走子能量的简单平均值：\n    $E_{\\mathrm{avg}}(100) = \\frac{1}{10} (E_{\\mathrm{rog}} + (10-1)E_{\\mathrm{typ}}) = \\frac{1}{10}(-20.0 + 9 \\cdot 2.0) = \\frac{-2.0}{10} = -0.2$。\n    对于等权重的行走子，有效布居数为 $N$：\n    $N_{\\mathrm{eff}}(100) = N = 10.0$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the simplified Diffusion Monte Carlo problem for a given test suite.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple is (N, delta_tau, T, E_typ, E_ref, r, E_rog)\n    test_cases = [\n        (5, 0.1, 0, 1.0, 0.0, 0, 0.0),\n        (5, 0.1, 10, 1.0, 1.0, 0, 0.0),\n        (5, 0.1, 10, 1.0, 1.0, 1, -50.0),\n        (10, 0.0, 100, 2.0, 1.0, 1, -20.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, delta_tau, T, E_typ, E_ref, r, E_rog = case\n\n        if r == 0:\n            # All walkers are identical.\n            # Local energy for all walkers is E_typ.\n            # Normalized weights are all 1/N.\n            e_avg = E_typ\n            n_eff = float(N)\n        else: # r == 1\n            # One rogue walker and N-1 typical walkers.\n            \n            # The exponent term simplifies to T * delta_tau.\n            # This correctly handles cases where T=0 or delta_tau=0,\n            # as the product becomes 0 and exp(0)=1.\n            time_product = float(T) * delta_tau\n\n            # Calculate final unnormalized weights\n            w_rog = np.exp(-time_product * (E_rog - E_ref))\n            w_typ = np.exp(-time_product * (E_typ - E_ref))\n\n            # Sum of weights\n            sum_of_weights = w_rog + (N - 1.0) * w_typ\n\n            # Calculate weighted average energy\n            # E_avg = (w_rog*E_rog + (N-1)*w_typ*E_typ) / (w_rog + (N-1)*w_typ)\n            e_avg_numerator = w_rog * E_rog + (N - 1.0) * w_typ * E_typ\n            \n            # Handle the case where all weights might hypothetically decay to zero,\n            # although not expected with the given test cases.\n            if sum_of_weights == 0.0:\n                 # This would lead to a 0/0 division. In a real DMC, it means the \n                 # simulation died. A robust implementation would handle this,\n                 # but for this specific problem, we assume it does not occur.\n                 # With positive weights, this is impossible.\n                 e_avg = 0.0 # Placeholder\n            else:\n                e_avg = e_avg_numerator / sum_of_weights\n\n            # Calculate effective population\n            # N_eff = (sum_of_weights)^2 / (w_rog^2 + (N-1)*w_typ^2)\n            n_eff_numerator = sum_of_weights**2\n            n_eff_denominator = w_rog**2 + (N - 1.0) * w_typ**2\n            \n            if n_eff_denominator == 0.0:\n                # Similarly, handle division by zero.\n                n_eff = 0.0 # Placeholder\n            else:\n                n_eff = n_eff_numerator / n_eff_denominator\n\n        # Append formatted results for the current test case\n        results.append(f\"[{e_avg:.6f},{n_eff:.6f}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2454178"}, {"introduction": "最后的这个练习将前一个练习中抽象的布居不稳定性与一个具体的物理原因联系起来：不完美的试探波函数。我们将探究当试探波函数未能满足电子-原子核尖点条件时的后果，而这个条件对于任何精确的全电子波函数都至关重要。通过这个练习，你将清楚地看到试探波函数中的一个局部缺陷是如何导致局域能发散，并进而引发我们之前建模的布居不稳定性问题。[@problem_id:2454168]", "problem": "在一个核电荷为 $Z$ 的原子的全电子扩散蒙特卡洛 (DMC) 模拟中，考虑一个用于重要性采样的实、正的试探波函数 $\\Psi_{\\mathrm{T}}(\\mathbf{R})$，其中 $\\mathbf{R}$ 表示所有电子的坐标。原子单位制下的多电子哈密顿量为\n$$\n\\hat{H} \\;=\\; -\\frac{1}{2}\\sum_{i} \\nabla_i^2 \\;-\\; \\sum_{i,A} \\frac{Z_A}{r_{iA}} \\;+\\; \\sum_{ij} \\frac{1}{r_{ij}},\n$$\n其中 $r_{iA} = \\lvert \\mathbf{r}_i - \\mathbf{R}_A \\rvert$ 且 $r_{ij} = \\lvert \\mathbf{r}_i - \\mathbf{r}_j \\rvert$。用于分支过程的局域能量定义为\n$$\nE_{\\mathrm{L}}(\\mathbf{R}) \\;=\\; \\frac{\\hat{H}\\,\\Psi_{\\mathrm{T}}(\\mathbf{R})}{\\Psi_{\\mathrm{T}}(\\mathbf{R})}.\n$$\n假设在 $\\Psi_{\\mathrm{T}}$ 中没有正确地满足电子-原子核尖点条件，因此 $\\Psi_{\\mathrm{T}}$ 在原子核附近的短程行为不满足精确的库仑尖点。以下哪项最能描述这在 DMC 模拟中的实际后果？\n\nA. 当 $r_{iA}\\to 0$ 时，$E_{\\mathrm{L}}(\\mathbf{R})$ 表现出 $1/r$ 发散，导致行走者 (walker) 权重的巨大涨落和不稳定的布居数控制，这在实践中会放大时间步长偏差并可能导致分支不稳定性。\n\nB. 固定节点误差必然增加，因为违反尖点条件会改变节面 (nodal surface)，即使在时间步长 $\\,\\tau\\to 0\\,$ 时，也会使基态能量向上移动。\n\nC. 当违反尖点条件时，漂移速度 $\\mathbf{v}_d = 2 \\nabla \\ln \\lvert \\Psi_{\\mathrm{T}} \\rvert$ 在原子核处变为无穷大，因此行走者被确定性地排斥，方差减小。\n\nD. 对于任何平滑的 $\\Psi_{\\mathrm{T}}$，重要性采样都能精确抵消库仑奇点，因此即使没有尖点，混合估计量能量在有限时间步长 $\\,\\tau0\\,$ 时也保持精确。\n\nE. 使用赝势 (pseudopotential) 完全消除了所有与尖点相关的问题，因此在实践中违反尖点条件从不会有任何后果。", "solution": "首先必须验证问题陈述的科学合理性、自洽性和清晰度。\n\n**步骤 1：提取已知条件**\n- **系统**：一个核电荷为 $Z$ 的原子的全电子扩散蒙特卡洛 (DMC) 模拟。\n- **试探波函数**：$\\Psi_{\\mathrm{T}}(\\mathbf{R})$，一个用于重要性采样的实、正函数。$\\mathbf{R}$ 代表所有电子的坐标。\n- **哈密顿量**：原子单位制下的多电子哈密顿量给出为 $\\hat{H} = -\\frac{1}{2}\\sum_{i} \\nabla_i^2 - \\sum_{i,A} \\frac{Z_A}{r_{iA}} + \\sum_{ij} \\frac{1}{r_{ij}}$。\n- **定义**：$r_{iA} = \\lvert \\mathbf{r}_i - \\mathbf{R}_A \\rvert$ 且 $r_{ij} = \\lvert \\mathbf{r}_i - \\mathbf{r}_j \\rvert$。对于位于原点的单个原子，我们考虑原子核 $A$ 位于 $\\mathbf{R}_A=0$ 处，电荷为 $Z_A=Z$。\n- **局域能量**：局域能量定义为 $E_{\\mathrm{L}}(\\mathbf{R}) = \\frac{\\hat{H}\\,\\Psi_{\\mathrm{T}}(\\mathbf{R})}{\\Psi_{\\mathrm{T}}(\\mathbf{R})}$。\n- **条件**：试探波函数 $\\Psi_{\\mathrm{T}}$ 不满足电子-原子核尖点条件。\n- **问题**：在 DMC 模拟中，违反此条件的实际后果是什么？\n\n**步骤 2：使用已知条件进行验证**\n- **科学依据**：该问题设置在扩散蒙特卡洛的背景下，这是计算化学中的一种标准方法。所给出的哈密顿量是正确的非相对论性、Born-Oppenheimer 电子哈密顿量。局域能量的定义以及电子-原子核尖点条件的概念都是基础且正确的。该问题具有科学合理性。\n- **适定性 (Well-Posed)**：问题要求在标准 DMC 框架内，由试探波函数中的一个特定、明确的缺陷（$\\Psi_{\\mathrm{T}}$ 缺少正确的尖点）所导致的直接后果。问题的结构使其基于量子蒙特卡洛方法的理论，能够得出一个唯一的、具有物理意义的答案。\n- **客观性**：问题陈述使用了该领域通用的精确技术语言。它没有歧义和主观性。\n\n**步骤 3：结论与行动**\n该问题是有效的。它具有科学合理性、适定性和客观性。将基于这些已知条件推导求解。\n\n**推导**\n\n局域能量 $E_{\\mathrm{L}}(\\mathbf{R})$ 是 DMC 算法的核心。其性质决定了模拟的效率和稳定性。让我们分析当一个电子（比如电子 $i$）接近原子核 $A$ 时（我们将其置于原点，因此 $\\mathbf{r}_i \\to 0$ 且 $r_{iA} = r_i$），局域能量的行为。哈密顿量可以分为涉及电子 $i$ 的项和当 $r_i \\to 0$ 时保持有限的其他项。\n\n$$\nE_{\\mathrm{L}}(\\mathbf{R}) = \\frac{-\\frac{1}{2}\\nabla_i^2 \\Psi_{\\mathrm{T}}(\\mathbf{R})}{\\Psi_{\\mathrm{T}}(\\mathbf{R})} - \\frac{Z}{r_i} + \\left( \\frac{-\\frac{1}{2}\\sum_{j \\neq i} \\nabla_j^2 \\Psi_{\\mathrm{T}}}{\\Psi_{\\mathrm{T}}} - \\sum_{j \\neq i} \\frac{Z}{r_{jA}} + \\sum_{jk} \\frac{1}{r_{jk}} \\right)\n$$\n当 $r_i \\to 0$ 时，括号中的项保持有限。$E_{\\mathrm{L}}$ 的行为主要由电子 $i$ 的动能及其与原子核相互吸引的势能决定。\n\n$$\nE_{\\mathrm{L}}(\\mathbf{R}) \\approx \\frac{-\\frac{1}{2}\\nabla_i^2 \\Psi_{\\mathrm{T}}}{\\Psi_{\\mathrm{T}}} - \\frac{Z}{r_i} \\quad \\text{当 } r_i \\to 0\n$$\n\n对于精确波函数，Kato 尖点条件规定，为了使动能项能抵消势能中的奇点 $(-Z/r_i)$，波函数在原子核处必须具有特定的非解析形式。对原子核周围的波函数进行球平均，该条件为：\n$$\n\\lim_{r_i \\to 0} \\frac{1}{\\bar{\\Psi}(\\mathbf{R})} \\frac{\\partial \\bar{\\Psi}(\\mathbf{R})}{\\partial r_i} = -Z\n$$\n这意味着对于小的 $r_i$，$\\Psi_{\\mathrm{T}}$ 的行为应如 $\\Psi_{\\mathrm{T}} \\approx C(1 - Z r_i + \\dots)$，或更一般地，$\\bar{\\Psi}_{\\mathrm{T}} \\sim \\exp(-Z r_i)$。\n\n我们来分析两种情况：\n\n1.  **$\\Psi_{\\mathrm{T}}$ 满足尖点条件**：\n    如果我们假设 $\\Psi_{\\mathrm{T}}$ 的球平均部分行为如 $\\bar{\\Psi}_{\\mathrm{T}}(r_i) \\sim \\exp(-Z r_i)$，拉普拉斯算子的径向部分为 $\\nabla_i^2 = \\frac{\\partial^2}{\\partial r_i^2} + \\frac{2}{r_i}\\frac{\\partial}{\\partial r_i}$。\n    将此应用于 $\\bar{\\Psi}_{\\mathrm{T}}$，动能项变为：\n    $$\n    \\frac{-\\frac{1}{2}\\nabla_i^2 \\bar{\\Psi}_{\\mathrm{T}}}{\\bar{\\Psi}_{\\mathrm{T}}} = -\\frac{1}{2} \\left[ \\frac{\\partial^2/\\partial r_i^2 + (2/r_i)\\partial/\\partial r_i}{\\bar{\\Psi}_{\\mathrm{T}}} \\right] \\approx -\\frac{1}{2} \\left( Z^2 - \\frac{2Z}{r_i} \\right) = \\frac{Z}{r_i} - \\frac{Z^2}{2}\n    $$\n    于是局域能量变为：\n    $$\n    E_{\\mathrm{L}} \\approx \\left(\\frac{Z}{r_i} - \\frac{Z^2}{2}\\right) - \\frac{Z}{r_i} + \\text{有限项} = -\\frac{Z^2}{2} + \\text{有限项}\n    $$\n    $1/r_i$ 奇点被抵消，$E_{\\mathrm{L}}$ 在原子核处保持有限。这导致局域能量的方差 $\\sigma^2(E_{\\mathrm{L}})$ 是有限的，而这是高效稳定 DMC 模拟的先决条件。\n\n2.  **$\\Psi_{\\mathrm{T}}$ 不满足尖点条件**：\n    试探波函数通常由平滑的解析函数（例如高斯基组）构建。在这种情况下，在原子核附近，$\\Psi_{\\mathrm{T}}$ 可以展开为泰勒级数，$\\Psi_{\\mathrm{T}} \\approx C_0 + C_1 r_i + C_2 r_i^2 + \\dots$。对于在原点处有最大值的平滑函数，$C_1=0$。\n    那么，$\\frac{\\partial \\Psi_{\\mathrm{T}}}{\\partial r_i} \\approx 2C_2 r_i$ 且 $\\frac{\\partial^2 \\Psi_{\\mathrm{T}}}{\\partial r_i^2} \\approx 2C_2$。动能项变为：\n    $$\n    \\frac{-\\frac{1}{2}\\nabla_i^2 \\Psi_{\\mathrm{T}}}{\\Psi_{\\mathrm{T}}} \\approx \\frac{-\\frac{1}{2}(2C_2 + \\frac{2}{r_i}(2C_2 r_i))}{C_0} = \\frac{-3C_2}{C_0}\n    $$\n    这是一个有限的常数。于是局域能量的行为如下：\n    $$\n    E_{\\mathrm{L}} \\approx \\text{有限值} - \\frac{Z}{r_i}\n    $$\n    当 $r_i \\to 0$ 时，局域能量发散至 $-\\infty$。即使试探函数有尖点但斜率不正确（例如，$\\bar{\\Psi}_{\\mathrm{T}} \\sim \\exp(-a r_i)$ 且 $a \\neq Z$），类似的分析也表明 $E_{\\mathrm{L}} \\approx \\frac{a-Z}{r_i} + \\text{有限项}$，这同样会发散。\n\n发散的局域能量会带来严重的实际后果。DMC 中行走者 (walker) 的权重在每一步 $\\tau$ 中通过一个因子如 $\\exp[-(E_{\\mathrm{L}}(\\mathbf{R}) - E_{\\text{ref}})\\tau]$ 来更新。如果 $E_{\\mathrm{L}}$ 可能发散到 $+\\infty$ 或 $-\\infty$，偶尔进入这些构型空间区域的行走者的权重将会剧烈波动，变得接近于零或极大。这会导致模拟不稳定，行走者的布居数要么崩溃要么爆炸，这种现象被称为分支不稳定性。为缓解此问题，必须使用非常小的时间步长 $\\tau$，这使得模拟在计算上变得不可行。$E_{\\mathrm{L}}$ 的巨大变化也极大地增加了时间步长误差（偏差），因为 DMC 中使用的格林函数传播子的短时近似不再准确。\n\n**逐项分析**\n\n**A. 当 $r_{iA}\\to 0$ 时，$E_{\\mathrm{L}}(\\mathbf{R})$ 表现出 $1/r$ 发散，导致行走者 (walker) 权重的巨大涨落和不稳定的布居数控制，这在实践中会放大时间步长偏差并可能导致分支不稳定性。**\n如上所述，如果不满足尖点条件，$E_{\\mathrm{L}}$ 中的动能项和势能项之间的抵消就不完全，导致 $1/r_{iA}$ 发散。这种发散通过 DMC 算法中的指数权重因子引起行走者权重的极端波动。这种不稳定性是时间步长偏差的主要来源，并可能导致模拟在数值上变得不稳定（分支不稳定性）。这个陈述准确地描述了其后果。**正确**。\n\n**B. 固定节点误差必然增加，因为违反尖点条件会改变节面 (nodal surface)，即使在时间步长 $\\,\\tau\\to 0\\,$ 时，也会使基态能量向上移动。**\n问题指定了实、正的试探波函数 $\\Psi_{\\mathrm{T}}$。对于许多原子基态（例如 He、Be、Ne），精确的基态波函数也是无节点的。在这种情况下，没有节点，根据定义，固定节点误差为零。违反尖点条件的问题与节点的存在是独立的。一个波函数可以有节点且尖点正确，也可以无节点但尖点不正确。尖点条件和节面是波函数的两个不同属性。因此，违反尖点条件并*不一定*会改变节面或增加固定节点误差。**不正确**。\n\n**C. 当违反尖点条件时，漂移速度 $\\mathbf{v}_d = 2 \\nabla \\ln \\lvert \\Psi_{\\mathrm{T}} \\rvert$ 在原子核处变为无穷大，因此行走者被确定性地排斥，方差减小。**\n漂移速度为 $\\mathbf{v}_d = 2 \\frac{\\nabla \\Psi_{\\mathrm{T}}}{\\Psi_{\\mathrm{T}}}$。让我们分析其在原子核附近（$r_i \\to 0$）的行为。如果 $\\Psi_{\\mathrm{T}}$ 是平滑的，例如 $\\Psi_{\\mathrm{T}} \\approx C_0 + C_2 r_i^2$，那么 $\\nabla \\Psi_{\\mathrm{T}} \\approx 2C_2 r_i \\hat{\\mathbf{r}}_i$。因此，$\\mathbf{v}_d \\approx 2 \\frac{2C_2 r_i \\hat{\\mathbf{r}}_i}{C_0} \\to 0$ 当 $r_i \\to 0$ 时。漂移速度趋于零，而不是无穷大。如果尖点条件被正确满足，$\\mathbf{v}_d$ 会趋于一个有限值 $-2Z\\hat{\\mathbf{r}}_i$。漂移速度变为无穷大的前提是错误的。因此，方差减小的结论也是错误的；发散的局域能量意味着无穷大的方差。**不正确**。\n\n**D. 对于任何平滑的 $\\Psi_{\\mathrm{T}}$，重要性采样都能精确抵消库仑奇点，因此即使没有尖点，混合估计量能量在有限时间步长 $\\,\\tau0\\,$ 时也保持精确。**\n这个陈述与事实恰恰相反。重要性采样通过 $E_{\\mathrm{L}}$ 中的动能项抵消库仑奇点，*当且仅当*试探波函数满足尖点条件时才成立。对于一个平滑的 $\\Psi_{\\mathrm{T}}$，这种抵消会失败。此外，DMC 能量在有限时间步长 $\\tau0$ 时*绝不*是精确的；总是存在必须外推到零的时间步长误差。**不正确**。\n\n**E. 使用赝势 (pseudopotential) 完全消除了所有与尖点相关的问题，因此在实践中违反尖点条件从不会有任何后果。**\n使用赝势确实是一种避免全电子计算问题的常用策略。赝势用一个更平滑的有效势取代了核心电子和尖锐的核库仑势，从而完全移除了尖点条件。然而，问题明确设定为**全电子**模拟。此选项描述的是另一种类型的计算，因此不是所提问题的答案。它描述的是一种避免该问题的方法，而不是在指定情境下出现该问题的后果。**不正确**。", "answer": "$$\\boxed{A}$$", "id": "2454168"}]}