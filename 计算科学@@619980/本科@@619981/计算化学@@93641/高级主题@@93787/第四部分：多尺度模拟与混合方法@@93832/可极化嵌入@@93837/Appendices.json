{"hands_on_practices": [{"introduction": "在可极化嵌入模型中，核心思想是量子力学（$QM$）区域的电荷分布会引起周围分子力学（$MM$）环境的电子云响应，即产生诱导偶极。本练习将通过一个简化的思想实验，探讨$QM$区域描述的准确性如何影响$QM/MM$的极化能。你将亲手计算并观察到，随着我们用更高级的基组（在这里由更大的部分电荷代表）来描述$QM$分子，它对$MM$环境的极化作用也随之增强，从而更深入地理解这两种描述层次之间的耦合关系。[@problem_id:2460312]", "problem": "要求您实现一个极简可极化嵌入 (PE) 模型，用以量化当用于量子力学 (QM) 区域的基组增大时，总的量子力学/分子力学 (QM/MM) 极化能的变化。分子力学 (MM) 环境由可极化点偶极子表示。所有计算都必须以原子单位进行，其中距离单位为玻尔 (bohr)，能量单位为哈特里 (Hartree)，且最终数值答案必须以哈特里 (Hartree) 表示，并四舍五入到六位小数。\n\nQM 区域由两个位于固定位置的点电荷组成，代表一个沿 $x$ 轴的双原子分子。设其位置为 $\\mathbf{R}_\\mathrm{H}=(0.00,0.00,0.00)\\ \\mathrm{bohr}$ 和 $\\mathbf{R}_\\mathrm{Cl}=(2.41,0.00,0.00)\\ \\mathrm{bohr}$。分子力学 (MM) 环境由三个位于固定位置的可极化位点组成：$\\mathbf{r}_1=(0.00,5.00,0.00)\\ \\mathrm{bohr}$，$\\mathbf{r}_2=(5.00,0.00,3.00)\\ \\mathrm{bohr}$ 和 $\\mathbf{r}_3=(-4.00,-3.00,1.00)\\ \\mathrm{bohr}$，其各向同性极化率分别为 $\\alpha_1=0.80\\ \\mathrm{bohr}^3$，$\\alpha_2=0.60\\ \\mathrm{bohr}^3$ 和 $\\alpha_3=1.00\\ \\mathrm{bohr}^3$。\n\n在 MM 位点 $i$ 处，由 QM 点电荷产生的外部电场为\n$$\n\\mathbf{E}_i^{\\mathrm{ext}}=\\sum_{a=1}^{2} q_a \\frac{\\mathbf{r}_i-\\mathbf{R}_a}{\\lVert \\mathbf{r}_i-\\mathbf{R}_a\\rVert^3},\n$$\n其中 $q_a$ 和 $\\mathbf{R}_a$ 分别是 QM 位点 $a$ 的电荷和位置。\n\n每个 MM 位点 $i$ 都带有一个感生偶极子 $\\boldsymbol{\\mu}_i$，该偶极子对该位点处的总电场作出线性响应：\n$$\n\\boldsymbol{\\mu}_i=\\alpha_i\\,\\mathbf{E}_i^{\\mathrm{tot}}, \\quad \\mathbf{E}_i^{\\mathrm{tot}}=\\mathbf{E}_i^{\\mathrm{ext}}+\\sum_{j\\ne i}\\mathbf{T}_{ij}\\,\\boldsymbol{\\mu}_j,\n$$\n其中偶极-偶极相互作用张量为\n$$\n\\mathbf{T}_{ij}=\\frac{3\\,\\mathbf{r}_{ij}\\mathbf{r}_{ij}^\\top-\\lVert \\mathbf{r}_{ij}\\rVert^2\\mathbf{I}_3}{\\lVert \\mathbf{r}_{ij}\\rVert^5}, \\quad \\mathbf{r}_{ij}=\\mathbf{r}_i-\\mathbf{r}_j,\n$$\n且 $\\mathbf{I}_3$ 是 $3\\times 3$ 的单位矩阵。感生偶极子通过这些方程自洽地确定。\n\n一旦确定了感生偶极子，MM 环境在 QM 电荷场中的极化能为\n$$\nE_{\\mathrm{pol}}=-\\frac{1}{2}\\sum_{i=1}^{3}\\boldsymbol{\\mu}_i\\cdot\\mathbf{E}_i^{\\mathrm{ext}} \\quad \\text{(Hartree)}.\n$$\n\n为了模拟 QM 基组质量提高带来的影响，请使用以下几组 QM 点电荷 $(q_{\\mathrm{H}},q_{\\mathrm{Cl}})$，它们代表了随基组变化的合理电荷划分，同时保持 QM 位置如上所述固定不变：\n- 对于标记为 “STO-3G” 的最小基组：$(q_{\\mathrm{H}},q_{\\mathrm{Cl}})=(+0.10,-0.10)$。\n- 对于标记为 “6-31G*” 的分裂价层极化基组：$(q_{\\mathrm{H}},q_{\\mathrm{Cl}})=(+0.18,-0.18)$。\n- 对于标记为 “aug-cc-pVDZ” 的增广相关一致性基组：$(q_{\\mathrm{H}},q_{\\mathrm{Cl}})=(+0.24,-0.24)$。\n\n您的程序必须计算以下四个测试案例中每一个的 $E_{\\mathrm{pol}}$：\n1. “STO-3G” 电荷，$\\alpha_1=0.80$, $\\alpha_2=0.60$, $\\alpha_3=1.00$。\n2. “6-31G*” 电荷，$\\alpha_1=0.80$, $\\alpha_2=0.60$, $\\alpha_3=1.00$。\n3. “aug-cc-pVDZ” 电荷，$\\alpha_1=0.80$, $\\alpha_2=0.60$, $\\alpha_3=1.00$。\n4. 用于覆盖率测试的边界情况：“aug-cc-pVDZ” 电荷，但 $\\alpha_1=0.00$, $\\alpha_2=0.00$, $\\alpha_3=0.00$。\n\n所有位置单位为玻尔 (bohr)，所有电荷单位为基本电荷 $e$，所有极化率单位为 $\\mathrm{bohr}^3$。最终能量以哈特里 (Hartree) 表示，并四舍五入到六位小数。\n\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，顺序与测试案例一致 $\\left[\\text{案例 }1,\\text{案例 }2,\\text{案例 }3,\\text{案例 }4\\right]$，例如 $[\\dots]$，其中每个条目都是一个以哈特里为单位、四舍五入到六位小数的浮点数。\n\n最后，在生成数值输出后，请确保您的实现能够内在地反映并允许人们解释随基组变化的趋势：随着基组质量的提高，QM 部分电荷的量值增加，感生电场以及 $E_{\\mathrm{pol}}$ 的量值预计会相应地发生变化。", "solution": "问题陈述经过了严格的验证，并被认定是有效的。\n\n**1. 提取已知条件：**\n- QM 区域：两个点电荷。\n  - 电荷 $a=1$ (H) 的位置：$\\mathbf{R}_{\\mathrm{H}} = (0.00, 0.00, 0.00)\\ \\mathrm{bohr}$。\n  - 电荷 $a=2$ (Cl) 的位置：$\\mathbf{R}_{\\mathrm{Cl}} = (2.41, 0.00, 0.00)\\ \\mathrm{bohr}$。\n- MM 区域：三个可极化位点。\n  - 位点 $i=1$：$\\mathbf{r}_1 = (0.00, 5.00, 0.00)\\ \\mathrm{bohr}$, $\\alpha_1 = 0.80\\ \\mathrm{bohr}^3$。\n  - 位点 $i=2$：$\\mathbf{r}_2 = (5.00, 0.00, 3.00)\\ \\mathrm{bohr}$, $\\alpha_2 = 0.60\\ \\mathrm{bohr}^3$。\n  - 位点 $i=3$：$\\mathbf{r}_3 = (-4.00, -3.00, 1.00)\\ \\mathrm{bohr}$, $\\alpha_3 = 1.00\\ \\mathrm{bohr}^3$。\n- QM 电荷组：\n  - “STO-3G”：$(q_{\\mathrm{H}}, q_{\\mathrm{Cl}}) = (+0.10, -0.10)\\ e$。\n  - “6-31G*”：$(q_{\\mathrm{H}}, q_{\\mathrm{Cl}}) = (+0.18, -0.18)\\ e$。\n  - “aug-cc-pVDZ”：$(q_{\\mathrm{H}}, q_{\\mathrm{Cl}}) = (+0.24, -0.24)\\ e$。\n- 基本方程（原子单位制下，其中 $e=1$, $4\\pi\\epsilon_0=1$）：\n  - 外部电场：$\\mathbf{E}_i^{\\mathrm{ext}} = \\sum_{a=1}^{2} q_a \\frac{\\mathbf{r}_i - \\mathbf{R}_a}{\\lVert \\mathbf{r}_i - \\mathbf{R}_a\\rVert^3}$。\n  - 感生偶极子响应：$\\boldsymbol{\\mu}_i = \\alpha_i \\mathbf{E}_i^{\\mathrm{tot}} = \\alpha_i \\left( \\mathbf{E}_i^{\\mathrm{ext}} + \\sum_{j \\ne i} \\mathbf{T}_{ij} \\boldsymbol{\\mu}_j \\right)$。\n  - 偶极-偶极相互作用张量：$\\mathbf{T}_{ij} = \\frac{3\\,\\mathbf{r}_{ij}\\mathbf{r}_{ij}^\\top - \\lVert \\mathbf{r}_{ij}\\rVert^2\\mathbf{I}_3}{\\lVert \\mathbf{r}_{ij}\\rVert^5}$，其中 $\\mathbf{r}_{ij} = \\mathbf{r}_i - \\mathbf{r}_j$。\n  - 极化能：$E_{\\mathrm{pol}} = -\\frac{1}{2}\\sum_{i=1}^{3}\\boldsymbol{\\mu}_i \\cdot \\mathbf{E}_i^{\\mathrm{ext}}$。\n- 测试案例：\n  1. “STO-3G” 电荷，标准极化率。\n  2. “6-31G*” 电荷，标准极化率。\n  3. “aug-cc-pVDZ” 电荷，标准极化率。\n  4. “aug-cc-pVDZ” 电荷，零极化率 $(\\alpha_1, \\alpha_2, \\alpha_3) = (0.00, 0.00, 0.00)\\ \\mathrm{bohr}^3$。\n- 输出要求：一个以逗号分隔的 $E_{\\mathrm{pol}}$ 值列表（单位为 Hartree，四舍五入到六位小数），并用方括号括起来。\n\n**2. 验证结论：**\n问题是**有效的**。它在科学上基于经典静电学和 QM/MM 可极化嵌入框架的原理。这是一个适定问题，提供了一套完整且一致的数据和方程，从而可以得到唯一解。对于一个简化的分子模型来说，这些参数是物理上合理的。该问题是客观且可形式化的。\n\n**3. 求解方法：**\n核心任务是确定三个 MM 位点的自洽感生偶极子 $\\boldsymbol{\\mu}_i$。感生偶极子的控制方程是一个耦合线性方程组。\n对于每个 MM 位点 $i$，我们有：\n$$ \\boldsymbol{\\mu}_i = \\alpha_i \\left( \\mathbf{E}_i^{\\mathrm{ext}} + \\sum_{j \\neq i} \\mathbf{T}_{ij} \\boldsymbol{\\mu}_j \\right) $$\n这个方程可以重新排列以分离偶极子项：\n$$ \\frac{1}{\\alpha_i} \\boldsymbol{\\mu}_i - \\sum_{j \\neq i} \\mathbf{T}_{ij} \\boldsymbol{\\mu}_j = \\mathbf{E}_i^{\\mathrm{ext}} $$\n这构成了一个包含 $N_{\\mathrm{MM}} = 3$ 个矢量方程的系统，等价于一个包含 $3 \\times N_{\\mathrm{MM}} = 9$ 个标量线性方程的系统。我们可以将其表示为紧凑的矩阵形式：\n$$ \\mathbf{A} \\boldsymbol{\\mu} = \\mathbf{E}^{\\mathrm{ext}} $$\n此处，$\\boldsymbol{\\mu}$ 和 $\\mathbf{E}^{\\mathrm{ext}}$ 是 $9 \\times 1$ 的超矢量，由每个位点的 $3 \\times 1$ 矢量串联而成：\n$$ \\boldsymbol{\\mu} = \\begin{pmatrix} \\boldsymbol{\\mu}_1 \\\\ \\boldsymbol{\\mu}_2 \\\\ \\boldsymbol{\\mu}_3 \\end{pmatrix}, \\quad \\mathbf{E}^{\\mathrm{ext}} = \\begin{pmatrix} \\mathbf{E}_1^{\\mathrm{ext}} \\\\ \\mathbf{E}_2^{\\mathrm{ext}} \\\\ \\mathbf{E}_3^{\\mathrm{ext}} \\end{pmatrix} $$\n响应矩阵 $\\mathbf{A}$ 是一个 $9 \\times 9$ 的分块矩阵：\n$$ \\mathbf{A} = \\begin{pmatrix}\n\\alpha_1^{-1} \\mathbf{I}_3 & -\\mathbf{T}_{12} & -\\mathbf{T}_{13} \\\\\n-\\mathbf{T}_{21} & \\alpha_2^{-1} \\mathbf{I}_3 & -\\mathbf{T}_{23} \\\\\n-\\mathbf{T}_{31} & -\\mathbf{T}_{32} & \\alpha_3^{-1} \\mathbf{I}_3\n\\end{pmatrix} $$\n其中 $\\mathbf{I}_3$ 是 $3 \\times 3$ 的单位矩阵，非对角块 $-\\mathbf{T}_{ij}$ 是偶极-偶极相互作用张量的负值。注意 $\\mathbf{T}_{ij} = \\mathbf{T}_{ji}$，这使得 $\\mathbf{A}$ 成为一个对称矩阵。\n\n求解过程遵循以下步骤：\n1.  **构建相互作用张量：** 对于每对不同的 MM 位点 $(i, j)$，使用给定的公式和位点位置计算 $3 \\times 3$ 张量 $\\mathbf{T}_{ij}$。\n2.  **构建响应矩阵 $\\mathbf{A}$：** 对于每个测试案例，组装 $9 \\times 9$ 矩阵 $\\mathbf{A}$。对角线的 $3 \\times 3$ 块是 $\\alpha_i^{-1} \\mathbf{I}_3$，非对角块是 $-\\mathbf{T}_{ij}$。对于所有 $\\alpha_i = 0$ 的边界情况，该矩阵是未定义的。然而，检查原始方程 $\\boldsymbol{\\mu}_i = \\alpha_i \\mathbf{E}_i^{\\mathrm{tot}}$ 可知，如果 $\\alpha_i = 0$，则无论电场如何，$\\boldsymbol{\\mu}_i = \\mathbf{0}$。因此，对于测试案例 4，所有感生偶极子均为零，且极化能 $E_{\\mathrm{pol}} = 0$，无需解线性方程组。\n3.  **计算外部电场矢量 $\\mathbf{E}^{\\mathrm{ext}}$：** 对于每个测试案例指定的 QM 电荷 $q_a$，计算每个 MM 位点 $\\mathbf{r}_i$ 处的外部电场矢量 $\\mathbf{E}_i^{\\mathrm{ext}}$。将这些矢量串联起来，形成 $9 \\times 1$ 的超矢量 $\\mathbf{E}^{\\mathrm{ext}}$。\n4.  **求解感生偶极子：** 求解线性系统 $\\mathbf{A} \\boldsymbol{\\mu} = \\mathbf{E}^{\\mathrm{ext}}$ 以找到感生偶极子超矢量 $\\boldsymbol{\\mu}$。这可以使用标准的线性代数求解器（例如 `numpy.linalg.solve`）高效完成。\n5.  **计算极化能：** 一旦感生偶极子 $\\boldsymbol{\\mu}$ 和外部电场 $\\mathbf{E}^{\\mathrm{ext}}$ 已知，极化能就通过点积计算得出：\n    $$ E_{\\mathrm{pol}} = -\\frac{1}{2} \\boldsymbol{\\mu}^\\top \\mathbf{E}^{\\mathrm{ext}} $$\n\n**基组趋势的物理解释：**\n基组序列“STO-3G” $\\rightarrow$ “6-31G*” $\\rightarrow$ “aug-cc-pVDZ”对应于量子力学描述灵活性的增加。这种灵活性的增加通常能更准确地表示电子密度，特别是其为响应分子环境和自身内部分布而产生的极化。对于如此处建模的极性分子，这会导致更大的电荷分离。所提供的电荷量值 $|q|$ 从 $0.10$ 增加到 $0.18$ 再到 $0.24$。\n\n外部电场 $\\mathbf{E}^{\\mathrm{ext}}$ 与 QM 电荷的量值 $|q|$ 成正比。由于响应矩阵 $\\mathbf{A}$ 与 QM 电荷无关，解矢量 $\\boldsymbol{\\mu} = \\mathbf{A}^{-1} \\mathbf{E}^{\\mathrm{ext}}$ 也与 $|q|$ 成正比。\n极化能由 $E_{\\mathrm{pol}} = -\\frac{1}{2} \\boldsymbol{\\mu} \\cdot \\mathbf{E}^{\\mathrm{ext}}$ 给出。由于 $\\boldsymbol{\\mu}$ 和 $\\mathbf{E}^{\\mathrm{ext}}$ 均与 $|q|$ 成正比，极化能 $E_{\\mathrm{pol}}$ 与 $|q|^2$ 成正比。\n这种二次方依赖关系意味着，随着 QM 基组的改进和电荷分离 $|q|$ 的增加，极化能的量值 $|E_{\\mathrm{pol}}|$ 将呈二次方增长。这反映了极化程度更高的 QM 区域与可极化 MM 环境之间更强的静电相互作用。计算出的数值结果应证实这一趋势，案例 2 和案例 3 相对于案例 1 的能量比值分别近似为 $(0.18/0.10)^2 = 3.24$ 和 $(0.24/0.10)^2 = 5.76$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a minimal Polarizable Embedding (PE) model to calculate QM/MM polarization energy.\n    \"\"\"\n    # Define fixed positions for QM and MM sites in bohr.\n    R_qm = np.array([[0.00, 0.00, 0.00], [2.41, 0.00, 0.00]])  # H, Cl\n    r_mm = np.array([\n        [0.00, 5.00, 0.00],   # MM site 1\n        [5.00, 0.00, 3.00],   # MM site 2\n        [-4.00, -3.00, 1.00]  # MM site 3\n    ])\n    num_mm_sites = len(r_mm)\n\n    # Define the four test cases as per the problem statement.\n    test_cases = [\n        {'name': 'STO-3G', 'q': np.array([0.10, -0.10]), 'alpha': np.array([0.80, 0.60, 1.00])},\n        {'name': '6-31G*', 'q': np.array([0.18, -0.18]), 'alpha': np.array([0.80, 0.60, 1.00])},\n        {'name': 'aug-cc-pVDZ', 'q': np.array([0.24, -0.24]), 'alpha': np.array([0.80, 0.60, 1.00])},\n        {'name': 'aug-cc-pVDZ_boundary', 'q': np.array([0.24, -0.24]), 'alpha': np.array([0.00, 0.00, 0.00])}\n    ]\n\n    results = []\n\n    # Pre-calculate the dipole-dipole interaction tensors T_ij, as they are constant.\n    T_tensors = np.zeros((num_mm_sites, num_mm_sites, 3, 3))\n    for i in range(num_mm_sites):\n        for j in range(num_mm_sites):\n            if i == j:\n                continue\n            rij_vec = r_mm[i] - r_mm[j]\n            rij_norm = np.linalg.norm(rij_vec)\n            T_tensors[i, j] = (3 * np.outer(rij_vec, rij_vec) - (rij_norm**2) * np.eye(3)) / (rij_norm**5)\n\n    for case in test_cases:\n        q_qm = case['q']\n        alphas = case['alpha']\n\n        # Handle the boundary case where all polarizabilities are zero.\n        if np.all(alphas == 0):\n            E_pol = 0.0\n            results.append(f\"{E_pol:.6f}\")\n            continue\n\n        # A is a 9x9 matrix for 3 MM sites.\n        dim = num_mm_sites * 3\n        A = np.zeros((dim, dim))\n\n        # Construct the response matrix A.\n        for i in range(num_mm_sites):\n            # Diagonal blocks: alpha_i^-1 * I_3\n            start_row, end_row = i * 3, (i + 1) * 3\n            if alphas[i] == 0:\n                # This case is for mixed polarizabilities (not in this problem)\n                # An infinite diagonal element would force the corresponding dipole components to zero.\n                # Here we assume non-zero alpha if not the all-zero case.\n                pass \n            A[start_row:end_row, start_row:end_row] = (1.0 / alphas[i]) * np.eye(3)\n            \n            # Off-diagonal blocks: -T_ij\n            for j in range(num_mm_sites):\n                if i == j:\n                    continue\n                start_col, end_col = j * 3, (j + 1) * 3\n                A[start_row:end_row, start_col:end_col] = -T_tensors[i, j]\n\n        # Calculate the external electric field vector E_ext (9x1).\n        E_ext_flat = np.zeros(dim)\n        for i in range(num_mm_sites):\n            E_i = np.zeros(3)\n            for a in range(len(R_qm)):\n                ri_Ra = r_mm[i] - R_qm[a]\n                ri_Ra_norm = np.linalg.norm(ri_Ra)\n                E_i += q_qm[a] * ri_Ra / (ri_Ra_norm**3)\n            E_ext_flat[i*3:(i+1)*3] = E_i\n\n        # Solve the linear system A * mu = E_ext for the induced dipoles mu.\n        mu_flat = np.linalg.solve(A, E_ext_flat)\n\n        # Calculate the polarization energy: E_pol = -1/2 * mu . E_ext\n        E_pol = -0.5 * np.dot(mu_flat, E_ext_flat)\n        \n        # Format the result and add to the list.\n        results.append(f\"{E_pol:.6f}\")\n\n    # Print the final result in the specified format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2460312"}, {"introduction": "经典的静电模型虽然直观，但在处理短距离相互作用时会遇到问题，因为当$QM$和$MM$区域的电子云发生重叠时，它可能会高估极化效应，甚至导致被称为“极化灾变”（polarization catastrophe）的非物理结果。为了解决这个问题，研究人员引入了阻尼函数来修正短程相互作用。这个练习将指导你实现一个简单的指数阻尼函数，并量化其效应，让你切身体会到在构建精确的极化力场时，对泡利（Pauli）排斥效应的考量是多么重要。[@problem_id:2460304]", "problem": "您的任务是形式化并实现一个定量测试，该测试旨在证明一个标准的可极化模型在忽略排斥-极化耦合时，会如何高估一个电荷为 $q$ 的阴离子和一个被建模为可极化位点的稀有气体原子之间的吸引相互作用。全程使用原子单位：距离单位为玻尔 ($a_0$)，电荷单位为基本电荷 ($e$)，能量单位为哈特里 ($E_\\mathrm{h}$)。所有能量以哈特里为单位报告，并四舍五入到六位小数。\n\n考虑一个大小为 $q$ 的点电荷，其与一个被建模为单一各向同性可极化位点（极化率为 $\\alpha$）的稀有气体原子相距为 $r$。标准线性可极化模型由于电荷产生的电场 $\\mathbf{E}$，会在稀有气体位点上诱导出偶极矩 $\\boldsymbol{\\mu} = \\alpha \\mathbf{E}$。在原子单位中，电场强度的大小为 $E = |q|/r^2$，相应的诱导能为\n$$\nE_\\mathrm{std}(r,q,\\alpha) = -\\tfrac{1}{2}\\,\\alpha\\,E^2 \\;=\\; -\\tfrac{1}{2}\\,\\alpha\\,\\frac{q^2}{r^4}.\n$$\n为了在短程范围内对排斥-极化耦合进行建模，假定局部电场被以下因子进行唯象阻尼：\n$$\nf(r;b) \\;=\\; 1 - e^{-b r},\n$$\n其中 $b$ 是一个正参数，单位是玻尔的倒数。那么，耦合（阻尼）的诱导能为\n$$\nE_\\mathrm{cpl}(r,q,\\alpha,b) \\;=\\; -\\tfrac{1}{2}\\,\\alpha\\,\\left(f(r;b) E\\right)^2 \\;=\\; -\\tfrac{1}{2}\\,\\alpha\\,\\frac{q^2}{r^4}\\,f(r;b)^2.\n$$\n将忽略排斥-极化耦合所导致的吸引力高估的量值定义为非负量\n$$\n\\Delta(r,q,\\alpha,b) \\;=\\; E_\\mathrm{cpl}(r,q,\\alpha,b) \\;-\\; E_\\mathrm{std}(r,q,\\alpha),\n$$\n它等于能量之差，并且是严格非负的，因为 $E_\\mathrm{std} \\le 0$ 且 $0 \\le f(r;b) \\le 1$。如果 $\\alpha = 0$ 或 $q = 0$，则 $E_\\mathrm{std} = E_\\mathrm{cpl} = 0$ 且 $\\Delta = 0$。\n\n请实现一个程序，对于下面这组参数集测试套件 $(r,q,\\alpha,b)$，计算每种情况下的 $\\Delta$，并将结果输出为单行，形式为方括号内包含的逗号分隔列表。在指定情况下，使用稀有气体极化率 $\\alpha = 2.66$，该值代表原子单位下的氖：\n- 测试 $1$：$(r,q,\\alpha,b) = (3.0,-1.0,2.66,1.0)$\n- 测试 $2$：$(r,q,\\alpha,b) = (5.0,-1.0,2.66,1.0)$\n- 测试 $3$：$(r,q,\\alpha,b) = (1.5,-1.0,2.66,1.0)$\n- 测试 $4$：$(r,q,\\alpha,b) = (4.0,-1.0,2.66,0.2)$\n- 测试 $5$：$(r,q,\\alpha,b) = (4.0,0.0,2.66,1.0)$\n- 测试 $6$：$(r,q,\\alpha,b) = (4.0,-1.0,0.0,1.0)$\n- 测试 $7$：$(r,q,\\alpha,b) = (1.0,-1.0,2.66,1.0)$\n\n您的程序应产生单行输出，其中包含七个 $\\Delta$ 值的结果，以逗号分隔并包含在方括号内，例如 `\"[x_1,x_2,x_3,x_4,x_5,x_6,x_7]\"`，其中每个 $x_i$ 是一个以哈特里为单位的浮点数，小数点后恰好有六位数字。", "solution": "我们使用诱导偶极子的线性响应理论来形式化此物理情景。在原子单位中，距离 $r$ 处由大小为 $q$ 的点电荷产生的电场强度的大小为 $E = |q|/r^2$。对于极化率为 $\\alpha$ 的各向同性可极化位点，诱导偶极矩为 $\\boldsymbol{\\mu} = \\alpha \\mathbf{E}$。静电诱导能由在固定外场下极化位点所做的功给出，在经典线性响应中，其值为\n$$\nE_\\mathrm{ind} = -\\tfrac{1}{2}\\,\\boldsymbol{\\mu}\\cdot \\mathbf{E} = -\\tfrac{1}{2}\\,\\alpha\\,E^2.\n$$\n这就得到了标准可极化模型的能量\n$$\nE_\\mathrm{std}(r,q,\\alpha) = -\\tfrac{1}{2}\\,\\alpha\\,\\frac{q^2}{r^4},\n$$\n它仅依赖于 $r$、$q$ 和 $\\alpha$。该模型忽略了重叠电子密度之间的短程交换排斥效应，而这种效应会减小作用在可极化位点上的有效场（排斥-极化耦合）。一种包含此类耦合的常用方法是，用一个在 $r \\to 0$ 时趋近于零、在 $r \\to \\infty$ 时趋近于一的函数来阻尼短程场。一个简单的指数衰减形式为\n$$\nf(r;b) = 1 - e^{-b r}, \\quad b > 0.\n$$\n该函数满足 $f(0;b) = 0$ 和 $\\lim_{r\\to\\infty} f(r;b) = 1$，其中 $b$ 控制阻尼的长度尺度。因此，耦合（阻尼）的诱导能为\n$$\nE_\\mathrm{cpl}(r,q,\\alpha,b) = -\\tfrac{1}{2}\\,\\alpha\\,\\left(f(r;b)\\,\\frac{|q|}{r^2}\\right)^2 = -\\tfrac{1}{2}\\,\\alpha\\,\\frac{q^2}{r^4}\\,f(r;b)^2.\n$$\n忽略耦合所导致的高估量值被定义为\n$$\n\\Delta(r,q,\\alpha,b) = E_\\mathrm{cpl}(r,q,\\alpha,b) - E_\\mathrm{std}(r,q,\\alpha).\n$$\n因为 $E_\\mathrm{std} \\le 0$ 且 $0 \\le f(r;b) \\le 1$，我们有 $E_\\mathrm{cpl} \\ge E_\\mathrm{std}$，所以 $\\Delta \\ge 0$。等价地，使用其显式形式，\n$$\n\\Delta(r,q,\\alpha,b) = -\\tfrac{1}{2}\\,\\alpha\\,\\frac{q^2}{r^4}\\left(f(r;b)^2 - 1\\right) = \\tfrac{1}{2}\\,\\alpha\\,\\frac{q^2}{r^4}\\left(1 - f(r;b)^2\\right).\n$$\n此表达式提供了一种直接计算该非负差值的稳定方法。边界情况被自然地处理：如果 $q = 0$ 或 $\\alpha = 0$，那么 $E_\\mathrm{std}$ 和 $E_\\mathrm{cpl}$ 都为零，因此 $\\Delta = 0$。参数 $b$ 的单位是玻尔的倒数，它控制在给定 $r$ 处场的衰减强度：较小的 $b$ 对应于长程阻尼（在固定 $r$ 处有更强的削减），而较大的 $b$ 意味着短程阻尼（在相同的 $r$ 处有更弱的削减）。\n\n针对每个测试用例 $(r,q,\\alpha,b)$ 的算法步骤：\n1. 计算 $E_\\mathrm{std} = -\\tfrac{1}{2}\\,\\alpha\\,q^2/r^4$。\n2. 计算 $f = 1 - \\exp(-b r)$。\n3. 计算 $E_\\mathrm{cpl} = E_\\mathrm{std}\\,f^2$。\n4. 计算 $\\Delta = E_\\mathrm{cpl} - E_\\mathrm{std} = -E_\\mathrm{std}\\,(1 - f^2) \\ge 0$。\n5. 将 $\\Delta$ 四舍五入到六位小数并记录。\n\n该测试套件跨越多个区间以确保覆盖性：\n- 中等距离与典型阻尼参数（$r = 3.0$，$b = 1.0$），以显示可见但适度的高估。\n- 长程（$r = 5.0$，$b = 1.0$），此时阻尼消失，高估趋于零。\n- 短程（$r = 1.5$，$b = 1.0$），由于未阻尼模型中短程极化的增强，高估变得显著。\n- 对阻尼强度的敏感性（$r = 4.0$，$b = 0.2$），表明长程阻尼（较小的 $b$）产生更大的校正。\n- 电荷为零（$q = 0.0$）和极化率为零（$\\alpha = 0.0$）的边界情况，根据定义，两者都得出 $\\Delta = 0$。\n- 极短程（$r = 1.0$，$b = 1.0$），突显了标准模型中的严重高估。\n\n程序计算这七个值，并按要求将它们打印为单个带方括号的、以逗号分隔的列表，每个条目都是一个以哈特里为单位、四舍五入到六位小数的浮点数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef standard_induction_energy(r, q, alpha):\n    \"\"\"\n    Standard linear polarizable model induction energy (Hartree) in atomic units.\n    E_std = -0.5 * alpha * (q^2 / r^4)\n    \"\"\"\n    return -0.5 * alpha * (q * q) / (r ** 4)\n\ndef damping_factor(r, b):\n    \"\"\"\n    Exponential damping factor f(r; b) = 1 - exp(-b * r).\n    r in bohr, b in bohr^-1. Returns dimensionless f in [0,1).\n    \"\"\"\n    # Ensure numerical stability for large b*r by using numpy's exp\n    return 1.0 - np.exp(-b * r)\n\ndef coupled_induction_energy(r, q, alpha, b):\n    \"\"\"\n    Coupled (damped) induction energy using attenuated field: E_cpl = E_std * f^2.\n    \"\"\"\n    e_std = standard_induction_energy(r, q, alpha)\n    f = damping_factor(r, b)\n    return e_std * (f ** 2)\n\ndef overestimation_magnitude(r, q, alpha, b):\n    \"\"\"\n    Overestimation magnitude Δ = E_cpl - E_std (Hartree), nonnegative.\n    \"\"\"\n    e_std = standard_induction_energy(r, q, alpha)\n    e_cpl = coupled_induction_energy(r, q, alpha, b)\n    return e_cpl - e_std\n\ndef solve():\n    # Define the test cases from the problem statement: (r, q, alpha, b)\n    test_cases = [\n        (3.0, -1.0, 2.66, 1.0),  # Test 1\n        (5.0, -1.0, 2.66, 1.0),  # Test 2\n        (1.5, -1.0, 2.66, 1.0),  # Test 3\n        (4.0, -1.0, 2.66, 0.2),  # Test 4\n        (4.0,  0.0, 2.66, 1.0),  # Test 5 (q = 0 edge case)\n        (4.0, -1.0, 0.0, 1.0),   # Test 6 (alpha = 0 edge case)\n        (1.0, -1.0, 2.66, 1.0),  # Test 7 (very short range)\n    ]\n\n    results = []\n    for r, q, alpha, b in test_cases:\n        delta = overestimation_magnitude(r, q, alpha, b)\n        # Round to six decimals as required\n        results.append(f\"{delta:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2460304"}, {"introduction": "在前面的练习中，我们都假设$MM$环境中的原子是各向同性可极化的，即它们在所有方向上对电场的响应都相同，可以用一个标量 $\\alpha$ 来描述。然而，对于像苯这样的非球形对称分子，这是一个过于简化的假设。本练习将通过一个巧妙设计的苯环模型，让你对比各向同性极化率和更真实的各向异性极化率张量 $\\boldsymbol{\\alpha}$ 在预测分子响应时的巨大差异，从而深刻理解为分子选择合适物理模型的重要性。[@problem_id:2460372]", "problem": "考虑一个由 $N$ 个可极化位点组成的可极化嵌入子系统，这些位点在 $xy$ 平面内形成一个正六边形，模拟一个类苯环结构。每个位点 $i$ 位于位置 $\\mathbf{R}_i \\in \\mathbb{R}^3$，其模长 $\\lVert \\mathbf{R}_i \\rVert = R$ 且 $z$ 坐标为 $0$，其中 $N=6$ 且 $R=3.0\\,a_0$。角度必须以弧度表示。全文使用原子单位：距离单位为玻尔（$a_0$），电荷单位为基本电荷，电场单位为哈特里原子单位，极化率单位为 $a_0^3$。这些位点通过经典偶极-偶极耦合相互作用，并对施加的电场作出线性响应。\n\n设位点 $i$ 处的感生偶极为 $\\boldsymbol{\\mu}_i \\in \\mathbb{R}^3$。感生偶极满足线性响应的定义\n$$\n\\boldsymbol{\\mu}_i \\;=\\; \\boldsymbol{\\alpha}_i \\left( \\mathbf{E}_i^{\\mathrm{ext}} \\;+\\; \\sum_{\\substack{j=1 \\\\ j\\neq i}}^{N} \\mathbf{T}_{ij}\\, \\boldsymbol{\\mu}_j \\right),\n$$\n其中 $\\boldsymbol{\\alpha}_i \\in \\mathbb{R}^{3\\times 3}$ 是位点 $i$ 的极化率，$\\mathbf{E}_i^{\\mathrm{ext}}$ 是位点 $i$ 处的外部电场，$\\mathbf{T}_{ij}$ 是对应于向量 $\\mathbf{r}_{ij}=\\mathbf{R}_i-\\mathbf{R}_j$ 的偶极-偶极相互作用张量，由下式给出\n$$\n\\mathbf{T}_{ij} \\;=\\; \\frac{3\\,\\mathbf{r}_{ij}\\mathbf{r}_{ij}^{\\mathsf{T}} - \\lVert \\mathbf{r}_{ij} \\rVert^2 \\mathbf{I}}{\\lVert \\mathbf{r}_{ij} \\rVert^5}, \\quad i\\neq j, \\qquad \\mathbf{T}_{ii}=\\mathbf{0}.\n$$\n总感生偶极为\n$$\n\\mathbf{M} \\;=\\; \\sum_{i=1}^{N} \\boldsymbol{\\mu}_i.\n$$\n考虑每个位点的两种极化率模型：\n1) 张量模型：$\\boldsymbol{\\alpha}_i = \\mathrm{diag}(\\alpha_{\\parallel},\\alpha_{\\parallel},\\alpha_{\\perp})$，其中 $\\alpha_{\\parallel}=8.0\\,a_0^3$ 且 $\\alpha_{\\perp}=0.0\\,a_0^3$。\n2) 各向同性模型：$\\boldsymbol{\\alpha}_i = \\alpha_{\\mathrm{iso}}\\,\\mathbf{I}$，其中 $\\alpha_{\\mathrm{iso}}=8.0\\,a_0^3$。\n\n在所有情况下，环都位于 $xy$ 平面内，并且所有位点张量共享此公共主轴框架。\n\n位点 $i$ 处的外部电场 $\\mathbf{E}_i^{\\mathrm{ext}}$ 定义为位于 $\\mathbf{r}_q$ 的单个点电荷 $q$ 或均匀场 $\\mathbf{E}_0$ 的贡献的叠加：\n- 对于点电荷，\n$$\n\\mathbf{E}_i^{\\mathrm{ext}} \\;=\\; q \\, \\frac{\\mathbf{R}_i - \\mathbf{r}_q}{\\lVert \\mathbf{R}_i - \\mathbf{r}_q \\rVert^3}.\n$$\n- 对于均匀场，对所有 $i$ 都有 $\\mathbf{E}_i^{\\mathrm{ext}} = \\mathbf{E}_0$。\n我们关心的方向的单位向量是 $\\hat{\\mathbf{z}}=(0,0,1)^{\\mathsf{T}}$ 和 $\\hat{\\mathbf{x}}=(1,0,0)^{\\mathsf{T}}$。\n\n定义一个布尔指示符，用于判断各向同性模型相对于张量模型在指定方向 $\\hat{\\mathbf{u}}$ 上的定性失效，具体如下\n$$\n\\text{fail} \\;=\\; \n\\begin{cases}\n\\text{true}, & \\text{if } \\left|\\mathbf{M}_{\\mathrm{tensor}}\\cdot \\hat{\\mathbf{u}}\\right| \\le \\tau \\text{ and } \\left|\\mathbf{M}_{\\mathrm{iso}}\\cdot \\hat{\\mathbf{u}}\\right| > \\tau, \\\\\n\\text{true}, & \\text{if } \\left(\\mathbf{M}_{\\mathrm{tensor}}\\cdot \\hat{\\mathbf{u}}\\right)\\left(\\mathbf{M}_{\\mathrm{iso}}\\cdot \\hat{\\mathbf{u}}\\right) < 0, \\\\\n\\text{false}, & \\text{otherwise},\n\\end{cases}\n$$\n其中数值容差为 $\\tau=1.0\\times 10^{-8}$ 原子单位。\n\n测试套件（三个案例，涵盖一般情况、边界情况和对照情况）：\n- 案例 A（一般情况，平面外点电荷）：$q=+1$，$\\mathbf{r}_q=(0,0,h_1)$，其中 $h_1=4.0\\,a_0$，无均匀场，方向 $\\hat{\\mathbf{u}}=\\hat{\\mathbf{z}}$。\n- 案例 B（边界情况，平面外均匀场）：无点电荷，$\\mathbf{E}_0=(0,0,E_0)$，其中 $E_0=5.0\\times 10^{-3}$（原子单位），方向 $\\hat{\\mathbf{u}}=\\hat{\\mathbf{z}}$。\n- 案例 C（对照情况，平面内均匀场）：无点电荷，$\\mathbf{E}_0=(E_0,0,0)$，其中 $E_0=5.0\\times 10^{-3}$（原子单位），方向 $\\hat{\\mathbf{u}}=\\hat{\\mathbf{x}}$。\n\n对于每种情况，使用上述定义从第一性原理计算 $\\mathbf{M}_{\\mathrm{tensor}}$ 和 $\\mathbf{M}_{\\mathrm{iso}}$，并评估布尔指示符 $\\text{fail}$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，并使用小写布尔值，按 A、B、C 的顺序排列（例如，“[true,false,true]”）。", "solution": "该问题要求计算在不同外部电场下，以及对于两种不同的局域极化率模型，由 $N=6$ 个可极化位点组成的六边形排列的总感生偶极矩。需要参照一个物理上更详细的张量模型来评估各向同性极化率模型的有效性。\n\n控制该系统的基本方程是每个位点 $i$ 处的感生偶极 $\\boldsymbol{\\mu}_i$ 对该位点总电场 $\\mathbf{E}_i^{\\mathrm{tot}}$ 的线性响应：\n$$ \\boldsymbol{\\mu}_i = \\boldsymbol{\\alpha}_i \\mathbf{E}_i^{\\mathrm{tot}} $$\n总电场是外部电场 $\\mathbf{E}_i^{\\mathrm{ext}}$ 与系统中所有其他偶极子感生的电场之和：\n$$ \\mathbf{E}_i^{\\mathrm{tot}} = \\mathbf{E}_i^{\\mathrm{ext}} + \\sum_{\\substack{j=1 \\\\ j\\neq i}}^{N} \\mathbf{E}_j^{\\mathrm{ind}}(\\mathbf{R}_i) = \\mathbf{E}_i^{\\mathrm{ext}} + \\sum_{\\substack{j=1 \\\\ j\\neq i}}^{N} \\mathbf{T}_{ij} \\boldsymbol{\\mu}_j $$\n其中 $\\mathbf{T}_{ij}$ 是偶极-偶极相互作用张量。将总电场代入响应方程，得到一组关于未知感生偶极 $\\boldsymbol{\\mu}_i$ 的耦合线性方程组：\n$$ \\boldsymbol{\\mu}_i = \\boldsymbol{\\alpha}_i \\left( \\mathbf{E}_i^{\\mathrm{ext}} + \\sum_{\\substack{j=1 \\\\ j\\neq i}}^{N} \\mathbf{T}_{ij} \\boldsymbol{\\mu}_j \\right) $$\n为了求解偶极，我们重新整理这个方程组。假设极化率张量 $\\boldsymbol{\\alpha}_i$ 是可逆的，我们有 $\\boldsymbol{\\alpha}_i^{-1}\\boldsymbol{\\mu}_i = \\mathbf{E}_i^{\\mathrm{ext}} + \\sum_{j \\neq i} \\mathbf{T}_{ij} \\boldsymbol{\\mu}_j$。对于所有 $i=1, \\dots, N$，这可以写作：\n$$ \\boldsymbol{\\alpha}_i^{-1}\\boldsymbol{\\mu}_i - \\sum_{\\substack{j=1 \\\\ j\\neq i}}^{N} \\mathbf{T}_{ij} \\boldsymbol{\\mu}_j = \\mathbf{E}_i^{\\mathrm{ext}} $$\n这是一个由 $N$ 个向量方程组成的系统，它对应于一个关于偶极子分量的 $3N$ 个标量方程的大型系统。我们可以将其表示为紧凑的分块矩阵形式 $\\mathbf{A}\\boldsymbol{\\mu} = \\mathbf{E}^{\\mathrm{ext}}$，其中 $\\boldsymbol{\\mu}$ 是一个 $3N$ 维列向量，由所有偶极向量 $\\boldsymbol{\\mu}_i$ 堆叠而成，$\\mathbf{E}^{\\mathrm{ext}}$ 是一个由外部电场 $\\mathbf{E}_i^{\\mathrm{ext}}$ 组成的 $3N$ 维列向量。$3N \\times 3N$ 矩阵 $\\mathbf{A}$ 是一个由 $3 \\times 3$ 子块 $\\mathbf{A}_{ij}$ 组成的分块矩阵：\n$$\n\\mathbf{A}_{ij} =\n\\begin{cases}\n\\boldsymbol{\\alpha}_i^{-1} & \\text{if } i=j \\\\\n-\\mathbf{T}_{ij} & \\text{if } i\\neq j\n\\end{cases}\n$$\n然后通过求解此线性系统找到感生偶极的解：$\\boldsymbol{\\mu} = \\mathbf{A}^{-1} \\mathbf{E}^{\\mathrm{ext}}$。\n\n策略如下：\n1.  通过计算在 $xy$ 平面内形成半径为 $R=3.0\\,a_0$ 的正六边形的 $N=6$ 个位点的坐标 $\\mathbf{R}_i$ 来定义系统的几何结构。\n2.  对于每种极化率模型（张量和各向同性）和每个测试案例（A、B、C），构建矩阵 $\\mathbf{A}$ 和向量 $\\mathbf{E}^{\\mathrm{ext}}$。\n3.  求解线性系统以获得偶极向量 $\\boldsymbol{\\mu}$。\n4.  计算总偶极矩 $\\mathbf{M} = \\sum_{i=1}^{N} \\boldsymbol{\\mu}_i$。\n5.  使用得到的总偶极 $\\mathbf{M}_{\\mathrm{tensor}}$ 和 $\\mathbf{M}_{\\mathrm{iso}}$ 来评估布尔失效准则。\n\n让我们来分析这两种极化率模型。\n\n**各向同性模型**：\n极化率为 $\\boldsymbol{\\alpha}_i = \\alpha_{\\mathrm{iso}}\\mathbf{I}$，其中 $\\alpha_{\\mathrm{iso}}=8.0\\,a_0^3$。其逆矩阵是良定义的：$\\boldsymbol{\\alpha}_i^{-1} = (1/\\alpha_{\\mathrm{iso}})\\mathbf{I}$。必须构建并求解一个完整的 $18 \\times 18$ 系统。\n\n**张量模型**：\n极化率为 $\\boldsymbol{\\alpha}_i = \\mathrm{diag}(\\alpha_{\\parallel}, \\alpha_{\\parallel}, \\alpha_{\\perp})$，其中 $\\alpha_{\\parallel}=8.0\\,a_0^3$ 且 $\\alpha_{\\perp}=0.0\\,a_0^3$。$\\alpha_{\\perp}=0$ 的一个直接后果是感生偶极的 $z$ 分量必须为零，即 $\\mu_{iz}=0$，因为 $\\mu_{iz} = \\alpha_{\\perp} E_{iz}^{\\mathrm{tot}} = 0$。张量 $\\boldsymbol{\\alpha}_i$ 是奇异的，不可逆。我们必须使用原始方程。\n分量方程为：\n$$ \\mu_{ix} = \\alpha_{\\parallel} \\left( E_{ix}^{\\mathrm{ext}} + \\sum_{j \\neq i} (\\mathbf{T}_{ij}\\boldsymbol{\\mu}_j)_x \\right) $$\n$$ \\mu_{iy} = \\alpha_{\\parallel} \\left( E_{iy}^{\\mathrm{ext}} + \\sum_{j \\neq i} (\\mathbf{T}_{ij}\\boldsymbol{\\mu}_j)_y \\right) $$\n由于所有位点都在 $xy$ 平面内，向量 $\\mathbf{r}_{ij}$ 没有 $z$ 分量。这意味着相互作用张量 $\\mathbf{T}_{ij}$ 是分块对角阵，平面内（$xy$）分量和平面外（$z$）分量之间没有耦合。此外，我们知道对于所有 $j$，$\\mu_{jz}=0$。因此，平面内分量 $\\mu_{ix}, \\mu_{iy}$ 的方程构成一个封闭的 $2N \\times 2N$ 系统，与 $z$ 分量无关。我们可以定义一个平面内极化率 $\\boldsymbol{\\alpha}^{\\parallel} = \\mathrm{diag}(\\alpha_{\\parallel}, \\alpha_{\\parallel})$ 并求解这个 $12 \\times 12$ 系统来得到平面内偶极。平面外偶极全部为零。因此，总偶极 $\\mathbf{M}_{\\mathrm{tensor}}$ 的 $z$ 分量将为零。\n\n**对称性考虑与预期结果**：\n-   **案例 A 和 B**：外部电场（来自 $z$ 轴上的点电荷或沿 $z$ 轴的均匀场）具有绕 $z$ 轴的旋转对称性。位点的六边形排列在 $C_6$ 旋转下也是对称的。因此， $xy$ 平面内的总感生偶极矩 $\\mathbf{M}_{\\parallel} = \\sum_i \\boldsymbol{\\mu}_{i,\\parallel}$ 必须为零，因为任何非零向量都会破坏这种对称性。\n    -   对于张量模型，由于 $\\mu_{iz}=0$，这意味着 $\\mathbf{M}_{\\mathrm{tensor}}=\\mathbf{0}$。沿 $\\hat{\\mathbf{u}}=\\hat{\\mathbf{z}}$ 的分量为 $m_t = 0$。\n    -   对于各向同性模型，平面外电场将感生出非零的 $z$ 向偶极，导致非零的 $m_i = \\mathbf{M}_{\\mathrm{iso}} \\cdot \\hat{\\mathbf{z}}$。\n    -   失效条件 `abs(m_t) <= tau and abs(m_i) > tau` 将会满足。因此，对于案例 A 和 B，我们预期 `fail = true`。\n-   **案例 C**：外部电场沿 $x$ 轴均匀分布。两种模型都将产生非零响应。关键的观察是，由于所有位点都在 $xy$ 平面内，对于两种模型，系统都解耦为独立的平面内和平面外问题。由于在 $z$ 方向没有外部电场，两种模型的 $\\mu_{iz}=0$。平面内问题由以下方程控制：\n    $$ (\\boldsymbol{\\alpha}^{\\parallel})^{-1} \\boldsymbol{\\mu}_{i}^{\\parallel} - \\sum_{j \\neq i} \\mathbf{T}_{ij}^{\\parallel} \\boldsymbol{\\mu}_{j}^{\\parallel} = \\mathbf{E}_i^{\\mathrm{ext},\\parallel} $$\n    对于两种模型，平面内极化率是相同的：$\\alpha_{\\parallel} = \\alpha_{\\mathrm{iso}} = 8.0\\,a_0^3$。由于线性系统完全相同，它们的解也必须相同：$\\mathbf{M}_{\\mathrm{tensor}} = \\mathbf{M}_{\\mathrm{iso}}$。失效条件将不会被满足。因此，对于案例 C，我们预期 `fail = false`。\n\n该算法将使用 NumPy 进行线性代数运算，并按照上述步骤在 Python 脚本中实现。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_total_dipole(N, R, alpha_diag, e_ext_func):\n    \"\"\"\n    Calculates the total induced dipole moment for a system of N polarizable sites.\n\n    Args:\n        N (int): Number of sites.\n        R (float): Radius of the regular polygon on which sites are located.\n        alpha_diag (tuple): A tuple (alpha_xx, alpha_yy, alpha_zz) for the polarizability.\n        e_ext_func (callable): A function that takes a position vector and returns the external field vector.\n\n    Returns:\n        np.ndarray: The total induced dipole moment vector M.\n    \"\"\"\n    # 1. Generate site positions for a regular hexagon\n    positions = np.zeros((N, 3))\n    for i in range(N):\n        angle = i * 2.0 * np.pi / N\n        positions[i] = np.array([R * np.cos(angle), R * np.sin(angle), 0.0])\n\n    # 2. Handle the tensor model case (alpha_zz = 0) vs. isotropic model\n    is_tensor_model = np.isclose(alpha_diag[2], 0.0)\n\n    # In any case, because all sites are in the xy plane, the T-tensor is block-diagonal\n    # between xy and z components. The system decouples.\n\n    # 2a. Solve for in-plane (xy) components (2N x 2N system)\n    dim_xy = 2 * N\n    A_xy = np.zeros((dim_xy, dim_xy))\n    E_ext_xy = np.zeros(dim_xy)\n    \n    alpha_inv_xy = np.diag([1.0/alpha_diag[0], 1.0/alpha_diag[1]])\n\n    for i in range(N):\n        i_sl = slice(2 * i, 2 * (i + 1))\n        # Diagonal block\n        A_xy[i_sl, i_sl] = alpha_inv_xy\n        \n        # External field\n        E_ext_i = e_ext_func(positions[i])\n        E_ext_xy[i_sl] = E_ext_i[:2]\n        \n        # Off-diagonal blocks\n        for j in range(N):\n            if i == j:\n                continue\n            \n            j_sl = slice(2 * j, 2 * (j + 1))\n            r_ij = positions[i] - positions[j]\n            r_norm = np.linalg.norm(r_ij)\n            r_norm_sq = r_norm**2\n            r_norm5 = r_norm**5\n            \n            # T_ij = (3*r_ij*r_ij^T - |r_ij|^2 * I) / |r_ij|^5\n            # We only need the 2x2 xy-block\n            r_ij_xy = r_ij[:2]\n            T_ij_xy = (3 * np.outer(r_ij_xy, r_ij_xy) - r_norm_sq * np.identity(2)) / r_norm5\n            \n            A_xy[i_sl, j_sl] = -T_ij_xy\n            \n    mu_xy_flat = np.linalg.solve(A_xy, E_ext_xy)\n    mu_xy = mu_xy_flat.reshape(N, 2)\n\n    # 2b. Solve for out-of-plane (z) components (N x N system)\n    mu_z = np.zeros(N)\n    \n    # For the tensor model, alpha_perp=0, so mu_z is identically zero.\n    # For the isotropic model, we solve the decoupled z-system.\n    if not is_tensor_model:\n        dim_z = N\n        A_z = np.zeros((dim_z, dim_z))\n        E_ext_z = np.zeros(dim_z)\n        alpha_inv_z = 1.0 / alpha_diag[2]\n\n        for i in range(N):\n            A_z[i, i] = alpha_inv_z\n            E_ext_z[i] = e_ext_func(positions[i])[2]\n            \n            for j in range(N):\n                if i == j:\n                    continue\n                r_ij = positions[i] - positions[j]\n                r_norm3 = np.linalg.norm(r_ij)**3\n                # T_ij_zz = (3*r_z^2 - |r|^2)/|r|^5 = (0 - |r|^2)/|r|^5 = -1/|r|^3\n                T_ij_zz = -1.0 / r_norm3\n                A_z[i, j] = -T_ij_zz\n        \n        # Only solve if there is a non-zero external field in z.\n        # Otherwise, mu_z=0 is the only solution to the homogeneous equation.\n        if np.any(np.abs(E_ext_z) > 1e-15):\n             mu_z = np.linalg.solve(A_z, E_ext_z)\n\n    # 3. Combine dipoles and calculate total dipole moment\n    dipoles = np.hstack([mu_xy, mu_z.reshape(N, 1)])\n    total_dipole = np.sum(dipoles, axis=0)\n    \n    return total_dipole\n\n\ndef solve():\n    # Define problem constants\n    N = 6\n    R = 3.0  # a_0\n    alpha_parallel = 8.0  # a_0^3\n    alpha_perp = 0.0  # a_0^3\n    alpha_iso = 8.0  # a_0^3\n    tau = 1.0e-8  # atomic units\n\n    alpha_tensor_diag = (alpha_parallel, alpha_parallel, alpha_perp)\n    alpha_iso_diag = (alpha_iso, alpha_iso, alpha_iso)\n    \n    # Define External Field functions and test cases\n    test_cases = [\n        {\n            'name': 'A',\n            'e_ext_func': lambda pos: 1.0 * (pos - np.array([0, 0, 4.0])) / np.linalg.norm(pos - np.array([0, 0, 4.0]))**3,\n            'u_vec': np.array([0, 0, 1])\n        },\n        {\n            'name': 'B',\n            'e_ext_func': lambda pos: np.array([0, 0, 5.0e-3]),\n            'u_vec': np.array([0, 0, 1])\n        },\n        {\n            'name': 'C',\n            'e_ext_func': lambda pos: np.array([5.0e-3, 0, 0]),\n            'u_vec': np.array([1, 0, 0])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # Calculate total dipole for both models\n        M_tensor = calculate_total_dipole(N, R, alpha_tensor_diag, case['e_ext_func'])\n        M_iso = calculate_total_dipole(N, R, alpha_iso_diag, case['e_ext_func'])\n\n        # Project moments onto the direction of interest\n        u_vec = case['u_vec']\n        m_t = np.dot(M_tensor, u_vec)\n        m_i = np.dot(M_iso, u_vec)\n        \n        # Evaluate failure condition\n        fail = (abs(m_t) = tau and abs(m_i) > tau) or (m_t * m_i  0)\n        results.append(str(fail).lower())\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2460372"}]}