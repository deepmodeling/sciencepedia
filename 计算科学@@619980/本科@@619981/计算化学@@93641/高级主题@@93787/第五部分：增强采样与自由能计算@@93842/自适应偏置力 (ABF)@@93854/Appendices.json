{"hands_on_practices": [{"introduction": "在我们投入复杂的模拟来计算平均力势（PMF）之前，理解其确切含义至关重要。这个练习剥离了完整模拟的复杂性，专注于 PMF 的核心定义。通过为一个简单的双原子分子解析计算 PMF，你将看到它与简单势能的区别，因为它包含了一个与可用相空间相关的关键熵贡献。[@problem_id:2448528]", "problem": "一个三维空间中的双原子分子，其相互作用能仅取决于标量原子间距 $r$（单位：nm），并由莫尔斯势建模：\n$$\nU(r) \\;=\\; D_e\\left(1 - e^{-a\\,(r-r_e)}\\right)^2 \\;-\\; D_e,\n$$\n其中 $D_e$（单位：kJ/mol）是解离能，$a$（单位：nm$^{-1}$）是范围参数，$r_e$（单位：nm）是平衡键长。考虑一个自适应偏置力（Adaptive Biasing Force, ABF）模拟，其反应坐标是原子间距 $r$。在绝对温度为 $T$（单位：K）的正则系综中，沿 $r$ 的平均力势 $A_T(r)$（单位：kJ/mol）由 $r$ 的边际概率密度定义，可相差一个加性常数：\n$$\np_r(r) \\;\\propto\\; 4\\pi r^2 \\, e^{-\\beta U(r)},\n$$\n其中 $\\beta = 1/(R T)$，$R$ 是摩尔气体常数。我们感兴趣的量是在温度 $T$ 下，沿着反应坐标在参考点 $r_{\\min}$ 和目标点 $r_{\\max}$ 之间的自由能差：\n$$\n\\Delta A_T \\;=\\; A_T(r_{\\max}) - A_T(r_{\\min}),\n$$\n以 kJ/mol 为单位表示。这个量与 $A_T(r)$ 中的任意加性常数无关，代表了与解离事件相关的平均力势的变化。对于本问题，取 $r_{\\min} = r_e$。\n\n使用以下有物理依据的参数和常数：\n- $D_e = 50$ kJ/mol，\n- $a = 20$ nm$^{-1}$，\n- $r_e = 0.25$ nm，\n- $R = 0.008314462618$ kJ/(mol·K)。\n\n您的任务是为下面列出的参数集计算 $\\Delta A_T$。每个答案必须是一个浮点数值（单位：kJ/mol），四舍五入到三位小数。\n\n测试组：\n1. $T = 300$ K, $r_{\\max} = 0.80$ nm。\n2. $T = 350$ K, $r_{\\max} = 0.80$ nm。\n3. $T = 400$ K, $r_{\\max} = 0.80$ nm。\n4. $T = 300$ K, $r_{\\max} = 2.00$ nm。\n5. $T = 300$ K, $r_{\\max} = 0.26$ nm。\n\n最终输出格式：\n您的程序应该生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，\"[x1,x2,x3,x4,x5]\"），其中每个 $x_i$ 是计算出的 $\\Delta A_T$（单位：kJ/mol），四舍五入到三位小数，顺序与上述测试组相同。", "solution": "问题陈述已经过验证，被认为可以进行分析。它具有科学依据，问题明确且自洽。它提出了一个计算统计力学中的标准问题。我们将进行形式推导和求解。\n\n核心任务是计算一个双原子分子沿着由原子间距 $r$ 定义的反应坐标的自由能差 $\\Delta A_T$。系统处于温度为 $T$ 的正则系综中。\n\n平均力势（Potential of Mean Force, PMF），记作 $A_T(r)$，通过统计力学中的基本关系与反应坐标的边际概率密度 $p_r(r)$ 相关联：\n$$\nA_T(r) = -\\frac{1}{\\beta} \\ln p_r(r) + C\n$$\n其中 $\\beta = 1/(RT)$ 是每摩尔的逆热能，$R$ 是摩尔气体常数，$C$ 是一个依赖于概率密度归一化但与坐标 $r$ 无关的任意加性常数。\n\n问题陈述指出概率密度正比于\n$$\np_r(r) \\propto 4\\pi r^2 \\, e^{-\\beta U(r)}\n$$\n$4\\pi r^2$ 项是从三维笛卡尔坐标变换到球坐标并对角自由度积分时产生的雅可比因子。它代表了半径为 $r$ 的球壳的体积。$e^{-\\beta U(r)}$ 项是与相互作用势能 $U(r)$ 相关联的玻尔兹曼权重。\n\n将此代入 PMF 的定义中，我们得到：\n$$\nA_T(r) = -\\frac{1}{\\beta} \\ln \\left( K \\cdot 4\\pi r^2 e^{-\\beta U(r)} \\right) + C\n$$\n其中 $K$ 是比例常数。利用对数的性质，可以将其展开为：\n$$\nA_T(r) = -\\frac{1}{\\beta} \\left( \\ln(4\\pi K) + \\ln(r^2) + \\ln(e^{-\\beta U(r)}) \\right) + C\n$$\n$$\nA_T(r) = -\\frac{1}{\\beta} \\ln(4\\pi K) - \\frac{2}{\\beta} \\ln(r) - \\frac{1}{\\beta} (-\\beta U(r)) + C\n$$\n将所有常数项合并为一个新的常数 $C'$，并回顾 $1/\\beta = RT$，我们得到 PMF 的表达式：\n$$\nA_T(r) = U(r) - 2RT \\ln(r) + C'\n$$\n我们需要计算参考态 $r_{\\min}$ 和目标态 $r_{\\max}$ 之间的自由能差 $\\Delta A_T$：\n$$\n\\Delta A_T = A_T(r_{\\max}) - A_T(r_{\\min})\n$$\n代入推导出的 $A_T(r)$ 表达式：\n$$\n\\Delta A_T = \\left( U(r_{\\max}) - 2RT \\ln(r_{\\max}) + C' \\right) - \\left( U(r_{\\min}) - 2RT \\ln(r_{\\min}) + C' \\right)\n$$\n未知常数 $C'$ 被消去，这对于差异计算是符合预期的：\n$$\n\\Delta A_T = U(r_{\\max}) - U(r_{\\min}) - 2RT (\\ln(r_{\\max}) - \\ln(r_{\\min}))\n$$\n$$\n\\Delta A_T = U(r_{\\max}) - U(r_{\\min}) - 2RT \\ln\\left(\\frac{r_{\\max}}{r_{\\min}}\\right)\n$$\n问题将相互作用势 $U(r)$ 指定为移位的莫尔斯势：\n$$\nU(r) = D_e\\left(1 - e^{-a\\,(r-r_e)}\\right)^2 - D_e\n$$\n参数为 $D_e$、$a$ 和 $r_e$。参考坐标被设置为平衡键长，$r_{\\min} = r_e$。\n\n首先，我们计算参考点 $r_{\\min} = r_e$ 处的势能：\n$$\nU(r_e) = D_e\\left(1 - e^{-a\\,(r_e-r_e)}\\right)^2 - D_e = D_e\\left(1 - e^{0}\\right)^2 - D_e = D_e(1-1)^2 - D_e = -D_e\n$$\n接下来，我们计算目标点 $r_{\\max}$ 处的势能：\n$$\nU(r_{\\max}) = D_e\\left(1 - e^{-a\\,(r_{\\max}-r_e)}\\right)^2 - D_e\n$$\n现在，将这些势能值代回 $\\Delta A_T$ 的表达式中：\n$$\n\\Delta A_T = \\left( D_e\\left(1 - e^{-a\\,(r_{\\max}-r_e)}\\right)^2 - D_e \\right) - (-D_e) - 2RT \\ln\\left(\\frac{r_{\\max}}{r_e}\\right)\n$$\n$-D_e$ 项相互抵消，得到最终简化的自由能差表达式：\n$$\n\\Delta A_T = D_e\\left(1 - e^{-a\\,(r_{\\max}-r_e)}\\right)^2 - 2RT \\ln\\left(\\frac{r_{\\max}}{r_e}\\right)\n$$\n这就是我们必须实现的方程。给定的常数是：\n- $D_e = 50$ kJ/mol\n- $a = 20$ nm$^{-1}$\n- $r_e = 0.25$ nm\n- $R = 0.008314462618$ kJ/(mol·K)\n\n我们现在将此公式应用于测试组中提供的每组参数 $(T, r_{\\max})$。将执行计算，并将结果四舍五入到三位小数。\n\n例如，对于第一个测试用例（$T = 300$ K, $r_{\\max} = 0.80$ nm）：\n- $RT = 0.008314462618 \\times 300 \\approx 2.4943$ kJ/mol\n- 指数项：$-a(r_{\\max}-r_e) = -20 \\times (0.80 - 0.25) = -11.0$\n- 势能项：$50 \\times (1 - e^{-11.0})^2 \\approx 50 \\times (0.999983...)^2 \\approx 49.998$ kJ/mol\n- 熵项：$-2 \\times 2.4943 \\times \\ln(0.80 / 0.25) \\approx -4.9886 \\times \\ln(3.2) \\approx -4.9886 \\times 1.16315 \\approx -5.802$ kJ/mol\n- $\\Delta A_T \\approx 49.998 - 5.802 = 44.196$ kJ/mol。\n\n此过程将系统地应用于所有测试用例。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the free-energy difference for a diatomic molecule\n    based on a Morse potential and statistical mechanics principles.\n    \"\"\"\n    # Define physical constants and model parameters.\n    D_e = 50.0  # Dissociation energy in kJ/mol\n    a = 20.0  # Range parameter in nm^-1\n    r_e = 0.25  # Equilibrium bond length in nm\n    R = 0.008314462618  # Molar gas constant in kJ/(mol·K)\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple of (Temperature in K, r_max in nm).\n    test_cases = [\n        (300.0, 0.80),\n        (350.0, 0.80),\n        (400.0, 0.80),\n        (300.0, 2.00),\n        (300.0, 0.26),\n    ]\n\n    results = []\n    for case in test_cases:\n        T, r_max = case\n\n        # The derived formula for the free-energy difference is:\n        # ΔA_T = D_e * (1 - e^(-a*(r_max - r_e)))^2 - 2*R*T*ln(r_max / r_e)\n\n        # Term 1: Contribution from the potential energy difference (standard Morse part)\n        term1 = D_e * (1 - np.exp(-a * (r_max - r_e)))**2\n\n        # Term 2: Contribution from the change in phase space volume (entropic part)\n        term2 = -2 * R * T * np.log(r_max / r_e)\n\n        # Total free energy difference\n        delta_A_T = term1 + term2\n        \n        # Round the result to three decimal places\n        results.append(round(delta_A_T, 3))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2448528"}, {"introduction": "在自适应偏置力（ABF）和其他增强采样方法中，一个常见的陷阱是在系统充分探索整个反应坐标之前过早地终止模拟。这个思想实验模拟了这样一种情景，其中高能垒阻碍了两个状态之间的可逆采样。通过分析预期的结果，你将学会识别未收敛 PMF 的迹象，例如由于被称为迟滞的物理现象而导致的过高势垒和扭曲的势阱深度。[@problem_id:2448538]", "problem": "考虑一个由一维集体变量 (CV) $\\xi$ 描述的分子系统，该系统表现出两个深的、不等价的自由能极小值，并由一个高峰垒隔开。平均力势 (PMF) $A(\\xi)$ 由沿 $\\xi$ 的可逆功定义，其导数由下式给出：\n$$\n\\frac{\\mathrm{d}A(\\xi)}{\\mathrm{d}\\xi} = - \\left\\langle F_{\\xi} \\right\\rangle_{\\xi},\n$$\n其中 $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$ 是在固定 $\\xi$ 时，沿 $\\xi$ 投影的瞬时广义力的条件平衡平均值。在自适应偏置力 (Adaptive Biasing Force, ABF) 方法中，构造一个偏置势 $V_{\\mathrm{ABF}}(\\xi)$，使得 $\\mathrm{d}V_{\\mathrm{ABF}}/\\mathrm{d}\\xi$ 自适应地趋近于 $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$，其目的是通过对估计的平均力进行数值积分来改善采样并重建 $A(\\xi)$。\n\n假设一个 ABF 模拟在较低的自由能极小值处初始化，并在系统跨越势垒双向进行足够多次跃迁之前很久就终止了（即，在每个区间中达到局部条件平衡以及沿 $\\xi$ 的可逆性建立之前）。哪个选项最能描述由此产生的估计 PMF $\\hat{A}(\\xi)$ 的定性外观？\n\nA. $\\hat{A}(\\xi)$ 近乎平坦，具有两个深度相等的势阱和一个被严重低估的势垒，因为自适应偏置即使在样本很少的情况下也能使剖面平坦化。\n\nB. 对初始盆地有明显偏好：$\\hat{A}(\\xi)$ 再现了起始极小值附近的局部曲率，但势垒高度被高估，另一个极小值在自由能上显得过高；采样不足的区域是嘈杂或不规则的。\n\nC. 在访问过的区间内得到精确的 $A(\\xi)$，而在其他地方没有估计值，因为局部力平均强制得到精确梯度，而与采样方向性无关。\n\nD. 一个对称的双势阱 $\\hat{A}(\\xi)$，尽管极小值不等价，但它与真实的 $A(\\xi)$ 仅相差一个加性常数。\n\nE. 一个基本上是随机的且与真实势能面不相关的 PMF $\\hat{A}(\\xi)$，因为施加的偏置从一开始就主导了动力学。", "solution": "首先必须对问题陈述进行严格验证。\n\n### 第1步：提取已知条件\n- 系统由一维集体变量 (CV) $\\xi$ 描述。\n- 平均力势 (PMF) $A(\\xi)$ 有两个深的、不等价的极小值，由一个高峰垒隔开。\n- PMF 的导数定义为 $\\frac{\\mathrm{d}A(\\xi)}{\\mathrm{d}\\xi} = - \\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$，其中 $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$ 是在固定 $\\xi$ 时，沿 $\\xi$ 投影的瞬时广义力的条件平衡平均值。\n- 在自适应偏置力 (ABF) 方法中，构造一个偏置势 $V_{\\mathrm{ABF}}(\\xi)$，使其导数 $\\frac{\\mathrm{d}V_{\\mathrm{ABF}}}{\\mathrm{d}\\xi}$ 自适应地趋近于 $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$。\n- ABF 的目标是通过对估计的平均力进行数值积分来改善采样并重建 $A(\\xi)$。\n- 模拟条件是：\n    1.  在较低的自由能极小值处初始化。\n    2.  在“系统在势垒两侧经历足够多的跃迁之前”的很久就终止了。\n    3.  这意味着“在每个区间中未达到局部条件平衡”且“沿着 $\\xi$ 的可逆性未建立”。\n- 问题要求描述所得估计PMF $\\hat{A}(\\xi)$ 的定性外观。\n\n### 第2步：使用提取的已知条件进行验证\n问题陈述描述了在计算统计力学中应用增强采样方法（特别是ABF）的一个标准情景。\n\n- **科学依据：** PMF $A(\\xi)$ 的定义及其与平均力 $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$ 的关系是统计力学的基本原理。对 ABF 方法的描述与其标准表述一致。未收敛模拟的情景是一个常见且实际的问题。\n- **良态问题：** 问题定义明确。它指明了系统（两个不等价的极小值）、方法（ABF）、初始条件（从较低的极小值开始）和终止条件（跨势垒采样不足）。问题要求一个定性的但由物理决定的结果。基于该方法的原理，存在一个唯一的概念性答案。\n- **客观性：** 语言精确且专业。它避免了主观性和模糊性。\n\n### 第3步：结论与行动\n问题陈述有效。它在科学上是合理的、表述清晰且客观的。我将继续推导解决方案。\n\n自适应偏置力方法的核心原理是通过在沿着集体变量 $\\xi$ 的离散区间内累积瞬时力 $F_{\\xi}$ 的移动平均值来估计真实的平均力 $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$。然后，通过对这个估计的平均力的负值进行积分来获得估计的 PMF $\\hat{A}(\\xi)$：\n$$\n\\hat{A}(\\xi) = \\int_{\\xi_0}^{\\xi} \\frac{\\mathrm{d}A(x)}{\\mathrm{d}x} \\, \\mathrm{d}x \\approx - \\int_{\\xi_0}^{\\xi} \\hat{\\left\\langle F_{x} \\right\\rangle}_{x} \\, \\mathrm{d}x + C\n$$\n其中 $\\hat{\\left\\langle F_{x} \\right\\rangle}_{x}$ 是对应于坐标 $x$ 的区间中估计的平均力，而 $C$ 是一个积分常数。\n\n问题指明了两个关键条件：模拟在一个盆地中初始化，并在收敛前终止。ABF 的收敛要求沿着 $\\xi$ 的每个区间都满足两个条件：\n1.  **统计收敛**：必须收集足够多的 $F_{\\xi}$ 样本，以使平均值的统计误差较低。\n2.  **正交自由度的平衡**：在 $\\xi$ 值受约束的情况下，系统必须有时间在所有其他自由度上达到平衡。这就是“条件平衡平均”$\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$ 的含义。这要求系统从所有相邻区域（例如，从左侧和右侧）多次访问该区间，从而建立可逆性。\n\n问题明确指出，模拟在发生“足够多次跨越势垒双向的跃迁”之前就终止了。这直接违反了收敛的第二个条件，特别是在势垒区域。\n\n让我们分析其后果：\n- **在初始盆地中**：系统在此处初始化，并在跨越势垒之前花费大量时间探索该区域。因此采样是密集的。力的估计值 $\\hat{\\left\\langle F_{\\xi} \\right\\rangle}_{\\xi}$ 将在统计上是可靠的，且系统处于局部平衡。因此，积分 $\\hat{A}(\\xi)$ 将能在这个初始自由能阱内准确地再现 PMF $A(\\xi)$ 的真实形状和局部曲率。\n\n- **在势垒上和第二个盆地中**：随着 ABF 偏置将系统从初始极小值推开并推向自由能势垒，采样变得越来越稀疏。关键的失败在于缺乏可逆性。力 $F_{\\xi}$ 几乎完全是从第一个盆地“上坡”移动的轨迹中采样的。系统被主动驱动到高能区域，并且没有时间使其正交自由度弛豫到新的约束条件下。这种现象，称为滞后效应或系统延迟，会导致系统性误差。测得的恢复力通常被高估；它是拖动一个非平衡系统所需的力，而该力大于维持一个平衡系统所需的力。因此，在势垒区域，估计的平均力的大小 $|\\hat{\\left\\langle F_{\\xi} \\right\\rangle}_{\\xi}|$ 将系统性地大于真实的平衡值 $|\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}|$。\n\n- **对 $\\hat{A}(\\xi)$ 的影响**：对大小被高估的平均力进行积分，会导致重建的 PMF 过于陡峭。这意味着极小值和过渡态之间的自由能差——即势垒高度——将被**高估**。在这个被高估的势垒之后，随后向第二个盆地的下降将从一个人为的高自由能值开始。结果，相对于第一个极小值，第二个极小值将显得具有比实际高得多的自由能。此外，在样本非常少的区域（势垒顶部和第二个盆地），力估计中的高统计不确定性将表现为重建的 PMF $\\hat{A}(\\xi)$ 中的噪声或不规则的锯齿状特征。\n\n### 逐项分析\n\n**A. $\\hat{A}(\\xi)$ 近乎平坦，具有两个深度相等的势阱和一个被严重低估的势垒，因为自适应偏置即使在样本很少的情况下也能使剖面平坦化。**\n**不正确。** ABF 方法平坦化的是*修改后*的自由能面（物理势加上偏置势），而不是重建的 PMF $\\hat{A}(\\xi)$。$\\hat{A}(\\xi)$ 是对原始的、未平坦化的 PMF 的估计。没有理由让势阱变得深度相等，特别是在有偏采样的情况下。低估势垒也与预期的滞后效应相反。\n\n**B. 对初始盆地有明显偏好：$\\hat{A}(\\xi)$ 再现了起始极小值附近的局部曲率，但势垒高度被高估，另一个极小值在自由能上显得过高；采样不足的区域是嘈杂或不规则的。**\n**正确。** 这个陈述准确地总结了势垒穿越不足的非收敛 ABF 模拟的后果。在初始盆地中的良好采样确保了正确的局部曲率。缺乏可逆采样导致力的高估（滞后效应），从而导致势垒被高估。这反过来又使得随后的盆地在能量上显得被人为地抬高了。稀疏采样区域的统计数据不佳导致噪声。\n\n**C. 在访问过的区间内得到精确的 $A(\\xi)$，而在其他地方没有估计值，因为局部力平均强制得到精确梯度，而与采样方向性无关。**\n**不正确。** 这是根本错误的。局部力平均只有在局部平衡和充分采样的条件下才会收敛到精确梯度 $-\\frac{\\mathrm{d}A(\\xi)}{\\mathrm{d}\\xi}$。问题明确指出这些条件未被满足。采样的方向性对于避免系统性偏差至关重要。\n\n**D. 一个对称的双势阱 $\\hat{A}(\\xi)$，尽管极小值不等价，但它与真实的 $A(\\xi)$ 仅相差一个加性常数。**\n**不正确。** 真实的 PMF 是非对称的（“不等价的极小值”）。没有任何物理或算法上的理由可以解释为什么一个非对称开始的非收敛模拟会产生一个对称的结果。结果将是真实不对称剖面的一个扭曲版本，而不是一个完全对称的剖面。\n\n**E. 一个基本上是随机的且与真实势能面不相关的 PMF $\\hat{A}(\\xi)$，因为施加的偏置从一开始就主导了动力学。**\n**不正确。** 结果不是随机的。它是有系统性偏差的。在采样良好的初始区域，与真实势能面的相关性很高。偏置并非从一开始就占主导地位；它是从零的初始值自适应地建立起来的。因此，模拟的初始部分探索的是真实的势。最终结果虽然有缺陷，但远非随机。", "answer": "$$\\boxed{B}$$", "id": "2448538"}, {"introduction": "现实世界的模拟可能会产生不完美的数据。这个练习提出了一个常见的后处理挑战：当 ABF 模拟的原始平均力数据在关键区域（例如过渡态附近）丢失或损坏时，如何重建一个平滑、具有物理意义的 PMF。你将应用一种基于样条插值的稳健方法，该方法不仅能填补数据空白，还能通过强制施加一个物理上合理的平滑条件来实现这一点，为数据分析和清理提供了宝贵的技能。[@problem_id:2448511]", "problem": "您将处理一个以纯数学术语表述的一维自适应偏置力 (ABF) 数据重构任务。考虑一个无量纲反应坐标 $z \\in [0,1]$，其上有一个未知的真实平均力 $f_{\\star}(z)$。通过一次已完成的模拟，您在均匀网格 $z_i = \\frac{i}{N-1}$（其中 $i \\in \\{0,1,\\dots,N-1\\}$）上获得了一组分箱的平均力样本 $\\{(z_i,\\bar{F}_i)\\}_{i=0}^{N-1}$。某个指定子区间内的数据已损坏，必须被视为缺失数据。假设对于未损坏网格点所对应的索引 $i$，样本是精确的：$\\bar{F}_i = f_{\\star}(z_i)$。\n\n您的任务是重构一个二阶连续可微函数 $f:[0,1]\\to\\mathbb{R}$，该函数满足以下条件：\n\n- 对于所有未损坏的索引 $i$, $f(z_i) = \\bar{F}_i$。\n- 在所有满足上述条件的函数中，$f$ 在满足自然边界条件 $f''(0)=0$ 和 $f''(1)=0$ 的前提下，最小化弯曲能\n$$\n\\int_{0}^{1} \\left(f''(z)\\right)^2 \\, dz\n$$\n\n将重构的平均力势 (PMF) $W(z)$ 定义为\n$$\nW(z) = -\\int_{0}^{z} f(s)\\, ds,\n$$\n并设 $W(0)=0$。设精确的 PMF 为 $W_{\\star}(z) = -\\int_{0}^{z} f_{\\star}(s)\\, ds$，并设 $W_{\\star}(0)=0$。\n\n对于下述每个测试用例，在一个由 $M$ 个等间距点 $z^{(k)}=\\frac{k}{M-1}$（其中 $k \\in \\{0,1,\\dots,M-1\\}$）组成的密集网格上，计算 $W$ 和 $W_{\\star}$ 之间的均方根误差 (RMSE)：\n$$\n\\varepsilon = \\sqrt{\\frac{1}{M}\\sum_{k=0}^{M-1} \\left( W\\!\\left(z^{(k)}\\right) - W_{\\star}\\!\\left(z^{(k)}\\right) \\right)^2 }.\n$$\n\n所有量均为无量纲。使用 $M = 1001$。\n\n测试套件。对于每个用例，均指定了精确力 $f_{\\star}(z)$、样本数 $N$ 以及损坏区间 $\\mathcal{I}$。构建网格 $z_i=\\frac{i}{N-1}$ 并生成精确样本 $\\bar{F}_i=f_{\\star}(z_i)$。将任何满足 $z_i \\in \\mathcal{I}$ 的点视为已损坏，并在重构中排除这些点的约束。在所有用例中，端点 $z=0$ 和 $z=1$ 均未损坏。\n\n- 用例 $1$ (理想路径): $f_{\\star}(z) = \\sin\\!\\left(2\\pi z\\right)$, $N=33$, 损坏区间 $\\mathcal{I}=[0.45,\\,0.55]$。\n- 用例 $2$ (边界一致性): $f_{\\star}(z) = 3 z - 1$, $N=21$, 损坏区间 $\\mathcal{I}=[0.35,\\,0.50]$。\n- 用例 $3$ (宽缺失区域): $f_{\\star}(z) = e^{z}$, $N=15$, 损坏区间 $\\mathcal{I}=[0.30,\\,0.70]$。\n\n您的程序应生成单行输出，其中包含用例 1–3 的三个 RMSE 值。这些值应以逗号分隔的列表形式呈现，并用方括号括起来，每个值都四舍五入到六位小数（例如，“[0.001234,0.000000,0.012345]”）。", "solution": "我们从物理定义出发：在自适应偏置力 (ABF) 分析中，平均力势 (PMF) $W(z)$ 满足 $W'(z) = -f_{\\star}(z)$，其中 $f_{\\star}(z)$ 是沿反应坐标 $z$ 的精确平均力。当我们只有离散点上的力样本，且某个区域的数据已损坏时，我们必须在缺失区域内对力进行插值或推断，同时保持物理一致性，即对于宏观集体变量，力 $f$ 应该随 $z$ 足够光滑。在所有穿过未损坏样本点并满足 $f''(0)=f''(1)=0$ 的函数中，最小化弯曲能 $\\int_{0}^{1} \\left(f''(z)\\right)^2 dz$ 的要求将此问题形式化为一个适定的变分问题。\n\n原理 1：插值函数的变分表征。考虑函数空间 $\\mathcal{H} = \\{ f \\in C^2([0,1]) : f'' \\in L^2([0,1]) \\}$ 以及对所有未损坏的 $i$ 施加的线性约束 $f(z_i)=\\bar{F}_i$。泛函\n$$\nJ[f] = \\int_{0}^{1} \\left(f''(z)\\right)^2 \\, dz\n$$\n在 $\\mathcal{H}$ 上是严格凸的，由插值约束定义的可行集是仿射且非空的（因为存在穿过这些数据点的分段三次函数）。相关约束最小化问题的欧拉-拉格朗日方程表明，其解是一个在插值节点处具有连续一阶和二阶导数的分段三次多项式，并且满足 $f''(0)=f''(1)=0$（自然边界条件）。唯一性由严格凸性保证。这个最小化函数正是穿过所有未损坏数据点的自然三次样条插值函数。\n\n原理 2：PMF 的重构。一旦 $f$ 被重构出来，PMF 就由下式给出：\n$$\nW(z) = -\\int_{0}^{z} f(s)\\, ds,\n$$\n且 $W(0)=0$。这是微积分基本定理和 PMF 的 ABF 定义的直接应用。\n\n原理 3：误差量化。为量化重构质量，我们在一个密集网格 $\\{ z^{(k)} \\}_{k=0}^{M-1}$ 上计算均方根误差 (RMSE)：\n$$\n\\varepsilon = \\sqrt{\\frac{1}{M}\\sum_{k=0}^{M-1}\\left( W\\!\\left(z^{(k)}\\right) - W_{\\star}\\!\\left(z^{(k)}\\right) \\right)^2 }.\n$$\n对每个测试用例，$W_{\\star}(z)$ 均可通过对精确力 $f_{\\star}(z)$ 进行解析积分得到：\n- 用例 1: $f_{\\star}(z) = \\sin\\!\\left(2\\pi z\\right)$。则\n$$\nW_{\\star}(z) = -\\int_{0}^{z} \\sin(2\\pi s)\\, ds = -\\left[-\\frac{\\cos(2\\pi s)}{2\\pi}\\right]_{0}^{z} = \\frac{\\cos(2\\pi z) - 1}{2\\pi}.\n$$\n- 用例 2: $f_{\\star}(z) = 3 z - 1$。则\n$$\nW_{\\star}(z) = -\\int_{0}^{z} (3 s - 1)\\, ds = -\\left(\\frac{3}{2} z^2 - z\\right) = -\\frac{3}{2} z^2 + z.\n$$\n- 用例 3: $f_{\\star}(z) = e^{z}$。则\n$$\nW_{\\star}(z) = -\\int_{0}^{z} e^{s}\\, ds = -\\left(e^{z} - 1\\right) = 1 - e^{z}.\n$$\n\n算法实现。为了计算最小化函数，我们采用穿过未损坏节点 $\\{(z_i,\\bar{F}_i)\\}$ 的自然三次样条插值，其合理性已由上述变分表征证明。自然三次样条生成一个分段三次函数 $f$，该函数具有连续的一阶和二阶导数，并满足 $f''(0)=f''(1)=0$。然后对重构的 $f$ 进行积分以获得 $W$。在数值上，可以通过对三次样条的分段多项式表示进行积分来精确构造其反导数，从而能够对任意 $z$ 精确地计算 $W(z)$。我们为每个测试用例在包含 $M=1001$ 个点的密集网格上计算 RMSE $\\varepsilon$。\n\n测试套件覆盖范围。这三个用例探究了不同的行为：\n- 用例 1 测试一个光滑的振荡力，其损坏区间大小适中。\n- 用例 2 测试线性力；样条插值能精确地再现线性函数，因此 RMSE 预计将接近机器精度。\n- 用例 3 测试一个快速变化的单调力，其缺失区间很宽，这对跨越间隙的外插能力是一个考验。\n\n最终的程序构建网格，移除 $z_i$ 坐标位于指定损坏区间 $\\mathcal{I}$ 内的点，对剩余的点进行自然三次样条拟合，构造反导数以计算 $W$，在密集网格上计算 $W$ 和 $W_{\\star}$ 的值，计算 RMSE，并按要求将三个 RMSE 值以方括号括起的逗号分隔列表形式输出，每个值四舍五入到六位小数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.interpolate import CubicSpline\n\ndef true_force(case_id, z):\n    if case_id == 1:\n        return np.sin(2*np.pi*z)\n    elif case_id == 2:\n        return 3.0*z - 1.0\n    elif case_id == 3:\n        return np.exp(z)\n    else:\n        raise ValueError(\"Invalid case_id\")\n\ndef true_pmf(case_id, z):\n    # W*(z) with W*(0)=0\n    if case_id == 1:\n        return (np.cos(2*np.pi*z) - 1.0) / (2*np.pi)\n    elif case_id == 2:\n        return -1.5*z*z + z\n    elif case_id == 3:\n        return 1.0 - np.exp(z)\n    else:\n        raise ValueError(\"Invalid case_id\")\n\ndef reconstruct_rmse(case_id, N, corrupt_interval, M=1001):\n    # Build nodes and exact samples\n    z_nodes = np.linspace(0.0, 1.0, N)\n    f_exact = true_force(case_id, z_nodes)\n\n    a, b = corrupt_interval\n    # Keep points not in corrupted interval (inclusive bounds)\n    mask = ~((z_nodes >= a) & (z_nodes <= b))\n    # Ensure endpoints are kept (as stated in problem); just in case tolerance issues\n    mask[0] = True\n    mask[-1] = True\n\n    x = z_nodes[mask]\n    y = f_exact[mask]\n\n    # Fit natural cubic spline interpolant through uncorrupted points\n    spline = CubicSpline(x, y, bc_type='natural')\n\n    # Construct antiderivative to get PMF: W(z) = -(F(z) - F(0))\n    anti = spline.antiderivative()\n    F0 = anti(0.0)\n\n    # Dense grid for RMSE\n    z_dense = np.linspace(0.0, 1.0, M)\n    W_rec = -(anti(z_dense) - F0)\n    W_true = true_pmf(case_id, z_dense)\n\n    rmse = np.sqrt(np.mean((W_rec - W_true)**2))\n    return rmse\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (case_id, N, (a, b))\n        (1, 33, (0.45, 0.55)),  # Case 1\n        (2, 21, (0.35, 0.50)),  # Case 2\n        (3, 15, (0.30, 0.70)),  # Case 3\n    ]\n\n    results = []\n    for case_id, N, interval in test_cases:\n        rmse = reconstruct_rmse(case_id, N, interval, M=1001)\n        results.append(rmse)\n\n    # Round to six decimals and format\n    results_str = \",\".join(f\"{x:.6f}\" for x in results)\n    print(f\"[{results_str}]\")\n\nsolve()\n```", "id": "2448511"}]}