{"hands_on_practices": [{"introduction": "在进行昂贵的分子模拟之前，明智地规划计算资源至关重要。本练习 [@problem_id:2465769] 挑战你根据势能面的特征，制定出最优的伞形采样窗口放置策略。通过这个思想实验，你将学会如何将计算精力集中在最需要采样的区域，从而以固定的计算成本获得最精确的自由能曲线。", "problem": "需要利用伞形采样数据，通过加权直方图分析方法（WHAM）估算沿一维反应坐标 $\\xi$ 的配体解离平均力势。该坐标范围为 $\\xi \\in [0,L]$，其中 $\\xi \\approx 0$ 是一个紧密结合的势阱，$\\xi \\approx \\xi^{\\ddagger}$ 是一个带自由能垒的过渡态区域，而 $\\xi > \\xi^{\\ddagger}$ 趋近于一个平坦的、未结合的平台区。您将放置 $N$ 个具有相同弹性常数 $k$ 和中心 $\\{\\xi_i\\}_{i=1}^N$ 的谐波势伞，并且必须决定在总模拟时间 $T$ 固定并在各个窗口间平均分配的情况下，如何设置这些中心的间距。\n\n请仅使用以下基本原理来推断您的选择：\n\n- 在平衡状态下，$\\xi$ 的无偏边缘分布为 $p(\\xi) \\propto \\exp\\!\\big(-\\beta F(\\xi)\\big)$，其中 $F(\\xi)$ 是平均力势，$\\beta = 1/(k_{\\mathrm{B}}T)$，$k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是绝对温度。\n- 在带有谐波偏置势 $U_i(\\xi) = \\tfrac{1}{2} k (\\xi - \\xi_i)^2$ 的窗口中，沿 $\\xi$ 的采样分布为 $p_i(\\xi) \\propto \\exp\\!\\big(-\\beta[F(\\xi) + U_i(\\xi)]\\big)$。\n- 在给定的中心 $\\xi_i$ 附近，如果窗口将采样限制在局部区域，则二次展开 $F(\\xi) \\approx F(\\xi_i) + \\tfrac{1}{2}\\kappa_i(\\xi - \\xi_i)^2$ 是合适的，其中 $\\kappa_i = \\tfrac{\\partial^2 F}{\\partial \\xi^2}\\big|_{\\xi_i}$。\n- 当相邻窗口具有足够的直方图重叠，并且无偏概率密度 $p(\\xi)$ 低的区域被多个窗口采样，从而在重加权后有许多独立样本做出贡献时，WHAM 的统计效率会提高。\n\n在所述约束条件下，哪种间距策略最适合最小化 WHAM 估算的 $F(\\xi)$ 在整个路径上的方差？\n\nA. 将 $N$ 个伞形中心在 $[0,L]$ 上以均匀间距放置，并将时间 $T$ 在它们之间平均分配。\n\nB. 将 $N$ 个伞形中心在结合态势阱（$\\xi \\approx 0$）和过渡态区域（$\\xi \\approx \\xi^{\\ddagger}$）附近放置得更密集，而在平坦的未结合平台区采用更稀疏的间距；保持 $k$ 不变，并将时间 $T$ 平均分配。\n\nC. 仅在自由能平坦的未结合平台区（$\\xi > \\xi^{\\ddagger}$）更密集地放置 $N$ 个伞形中心，以最大化相邻窗口的重叠；保持 $k$ 不变，并将时间 $T$ 平均分配。\n\nD. 保持伞形中心均匀分布，但在结合态势阱和过渡态附近增加 $k$ 以限制采样；每个窗口保持相同的时间 $T/N$，并且各处的中心间距相同。", "solution": "用户要求对所提供的问题陈述进行严格评估并给出解答。验证和解答如下。\n\n### 问题验证\n\n**第 1 步：提取已知条件**\n\n- **系统**：由沿一维反应坐标 $\\xi$ 的平均力势 (PMF) $F(\\xi)$ 描述的配体解离过程。\n- **反应坐标范围**：$\\xi \\in [0,L]$。\n- **PMF 特征**：\n    - $\\xi \\approx 0$：一个紧密结合的势阱。\n    - $\\xi \\approx \\xi^{\\ddagger}$：一个包含自由能垒的过渡态区域。\n    - $\\xi > \\xi^{\\ddagger}$：一个平坦的、未结合的平台区。\n- **采样方法**：应用于伞形采样数据的加权直方图分析方法 (WHAM)。\n- **采样参数**：\n    - 伞的数量：$N$。\n    - 弹性常数：$k$，对所有伞均相同。\n    - 伞形中心：$\\{\\xi_i\\}_{i=1}^N$。\n    - 总模拟时间：$T$，在 $N$ 个窗口中平均分配。\n- **基本原理**：\n    1. 无偏边缘分布：$p(\\xi) \\propto \\exp(-\\beta F(\\xi))$，其中 $\\beta = 1/(k_{\\mathrm{B}}T)$。\n    2. 窗口 $i$ 中的偏置分布：$p_i(\\xi) \\propto \\exp(-\\beta[F(\\xi) + U_i(\\xi)])$，其中偏置势为 $U_i(\\xi) = \\tfrac{1}{2} k (\\xi - \\xi_i)^2$。\n    3. PMF 的局部二次近似：$F(\\xi) \\approx F(\\xi_i) + \\tfrac{1}{2}\\kappa_i(\\xi - \\xi_i)^2$，其中曲率为 $\\kappa_i = \\tfrac{\\partial^2 F}{\\partial \\xi^2}\\big|_{\\xi_i}$。\n    4. WHAM 效率的条件：相邻窗口间有足够的直方图重叠，并加强对无偏概率低的区域的采样。\n- **目标**：确定 $\\{\\xi_i\\}_{i=1}^N$ 的间距策略，使其最适合最小化 WHAM 估算的 $F(\\xi)$ 在整个路径 $[0,L]$ 上的方差。\n\n**第 2 步：使用提取的已知条件进行验证**\n\n对问题陈述的有效性进行检查：\n\n- **科学上成立**：该问题牢固地植根于统计力学和计算化学的原理。平均力势、伞形采样和加权直方图分析方法的概念是该领域的标准和成熟概念。所有提供的原理都是正确的理论陈述。对配体解离 PMF 的描述是典型的。\n- **问题定义明确**：该问题定义明确。它要求在一组选项中选择最合适的策略，以在指定的约束（固定的 $N$、$T$ 和 $k$）下实现一个明确定义的目标（最小化 PMF 方差）。可以从提供的原理中推导出唯一的定性答案。\n- **客观性**：问题以客观、科学的语言陈述。它不包含主观论断或模糊之处。\n\n**第 3 步：结论与行动**\n\n问题陈述有效。它在科学上是合理的、定义明确的、客观且完整的。我将继续进行解答的推导。\n\n### 解答推导\n\n目标是最小化估算的平均力势 $F(\\xi)$ 在其整个域上的统计方差。总模拟投入，以分配给 $N$ 个窗口的总时间 $T$ 为特征，是固定的。为了比较不同的间距策略，弹性常数 $k$ 也是固定的。\n\n根据原理 4，WHAM 的统计效率取决于两个关键因素：(i) 相邻窗口采样分布之间的足够重叠，以及 (ii) 对无偏概率密度 $p(\\xi)$ 低的区域的充分采样。\n\n让我们分析这些因素对反应坐标 $\\xi$ 不同区域的影响。\n\n1.  **低概率区域分析**：\n    从原理 1 可知，$p(\\xi) \\propto \\exp(-\\beta F(\\xi))$。这意味着高自由能 $F(\\xi)$ 的区域对应于无偏模拟中采样概率低的区域。问题描述了在过渡态 $\\xi \\approx \\xi^{\\ddagger}$ 处存在一个高自由能垒。因此，在该区域 $p(\\xi)$ 处于最小值。原理 4 指出，为了最小化 PMF 估算的方差，必须对这类低概率区域进行彻底采样。由于每个窗口的时间 $T/N$ 是固定的，增加在 $\\xi^{\\ddagger}$ 附近收集的总样本数的唯一方法是在此区域放置多个窗口，即，使伞形中心 $\\{\\xi_i\\}$ 的密度变高。\n\n2.  **直方图重叠分析**：\n    在以 $\\xi_i$ 为中心的窗口 $i$ 中采样的分布由原理 2 给出：$p_i(\\xi) \\propto \\exp(-\\beta[F(\\xi) + U_i(\\xi)])$。使用原理 3 的局部二次近似 $F(\\xi) \\approx F(\\xi_i) + \\frac{1}{2}\\kappa_i(\\xi - \\xi_i)^2$，我们可以近似其峰值附近的采样分布：\n    $$p_i(\\xi) \\propto \\exp\\left(-\\beta\\left[\\left(F(\\xi_i) + \\frac{1}{2}\\kappa_i(\\xi - \\xi_i)^2\\right) + \\frac{1}{2} k (\\xi - \\xi_i)^2\\right]\\right)$$\n    $$p_i(\\xi) \\propto \\exp\\left(-\\frac{\\beta}{2}(k + \\kappa_i)(\\xi - \\xi_i)^2\\right)$$\n    这表明局部采样分布近似为高斯分布，其方差为 $\\sigma_i^2 = (\\beta(k + \\kappa_i))^{-1}$。因此，采样直方图的宽度为 $\\sigma_i = 1 / \\sqrt{\\beta(k + \\kappa_i)}$。相邻窗口 $i$ 和 $i+1$（中心为 $\\xi_i$ 和 $\\xi_{i+1}$）之间的良好重叠要求它们的间距 $|\\xi_{i+1} - \\xi_i|$ 与采样宽度 $\\sigma_i$ 在同一数量级。\n\n    让我们将此应用于 PMF 的特定区域：\n    -   **结合态势阱（$\\xi \\approx 0$）**：这是一个深阱，意味着 PMF 在其两侧很陡峭。曲率 $\\kappa_i = F''(\\xi_i)$ 是大的正值。因此，有效弹性常数 $k + \\kappa_i$ 很大，采样宽度 $\\sigma_i$ 很小。为了保持足够的重叠，相邻伞形中心之间的距离必须很小。因此，在该区域需要高密度的窗口。\n    -   **过渡态区域（$\\xi \\approx \\xi^{\\ddagger}$）**：如前所述，这是一个需要密集采样的高能区域。在能垒顶峰，曲率 $\\kappa_i = F''(\\xi_i)$ 为负值。这使得有效弹性常数 $k+\\kappa_i$ 小于 $k$，导致更宽的采样分布 $\\sigma_i$。虽然这可能表明可以接受更宽的间距，但该区域的主要要求是通过集中采样来克服极低的无偏概率 $p(\\xi)$。因此，密集的窗口放置是必要的。\n    -   **未结合平台区（$\\xi > \\xi^{\\ddagger}$）**：在这里，PMF 被描述为平坦的。这意味着曲率 $\\kappa_i \\approx 0$。采样宽度近似恒定，$\\sigma_i \\approx 1/\\sqrt{\\beta k}$。由于底层的 PMF 是平坦的，不存在由高能垒或陡峭梯度引起的固有采样困难。因此，该区域需要最少的采样投入，窗口可以放置得更稀疏。\n\n**结论**：为了最小化估算 PMF 的总体方差，伞形窗口的密度应与采样的“难度”成正比。这意味着在自由能高的区域（过渡态）和 PMF 曲率大的区域（结合态势阱的壁）放置更密集的窗口。在平坦的、未结合的平台区，间距可以更稀疏。\n\n### 逐项分析\n\n-   **A. 将 $N$ 个伞形中心在 $[0,L]$ 上以均匀间距放置，并将时间 $T$ 在它们之间平均分配。**\n    该策略将采样资源均匀地分配到整个反应坐标上。它未能将投入集中在统计上具有挑战性的区域（能垒和陡峭的势阱），而在易于采样的平坦平台区浪费了资源。这将导致估算的 PMF 具有很高的统计不确定性，尤其是在能垒处。\n    **结论：不正确。**\n\n-   **B. 将 $N$ 个伞形中心在结合态势阱（$\\xi \\approx 0$）和过渡态区域（$\\xi \\approx \\xi^{\\ddagger}$）附近放置得更密集，而在平坦的未结合平台区采用更稀疏的间距；保持 $k$ 不变，并将时间 $T$ 平均分配。**\n    该策略直接实施了从第一性原理推导出的结论。它增加了在结合态势阱中的窗口密度，以确保在 PMF 陡峭处的重叠，并增加了在过渡态的密度，以充分采样这个高能区域。它正确地将较少的资源分配给简单的平台区域。这种自适应间距是在给定约束下优化 WHAM 计算的标准且最合适的方法。\n    **结论：正确。**\n\n-   **C. 仅在自由能平坦的未结合平台区（$\\xi > \\xi^{\\ddagger}$）更密集地放置 $N$ 个伞形中心，以最大化相邻窗口的重叠；保持 $k$ 不变，并将时间 $T$ 平均分配。**\n    该策略与最优方法背道而驰。它将采样集中在 PMF 最容易的部分，而忽略了最困难的区域。在平坦势上更密集地放置窗口并不会以任何有意义的方式“最大化重叠”，这仅仅是浪费。这将导致在关键的势阱和能垒区域的统计数据极差，方差极高。\n    **结论：不正确。**\n\n-   **D. 保持伞形中心均匀分布，但在结合态势阱和过渡态附近增加 $k$ 以限制采样；每个窗口保持相同的时间 $T/N$，并且各处的中心间距相同。**\n    该选项提出了一种通过改变弹性常数 $k$ 的不同方法。在某个区域增加 $k$ 会使采样分布变窄，因为 $\\sigma_i \\approx 1/\\sqrt{\\beta(k+\\kappa_i)}$。如果窗口中心保持均匀间距，增加 $k$ 将*减少*相邻窗口之间的重叠，从而降低 WHAM 计算的质量。为了补偿更大的 $k$，需要将窗口放置得*更近*，这与均匀间距的前提相矛盾。因此，所述的此策略存在缺陷。\n    **结论：不正确。**", "answer": "$$\\boxed{B}$$", "id": "2465769"}, {"introduction": "将一个算法从理论转化为可执行的程序，需要考虑真实的硬件限制。这个实际计算练习 [@problem_id:2465741] 让你扮演计算科学家的角色，估算一次二维WHAM分析所需的内存（RAM）。这个练习能帮助你理解WHAM在计算层面的具体构成，并将抽象的算法与具体的硬件资源需求联系起来。", "problem": "在二维加权直方图分析方法 (WHAM) 中，研究者会结合来自多个伞形采样窗口的加偏直方图，以在二维反应坐标网格上估计自由能面。考虑一个科学上真实的二维 WHAM 实现，在每次自洽迭代期间，它会同时在随机存取存储器 (RAM) 中存储以下数组：\n\n- 对于每个索引为 $i \\in \\{1,\\dots,K\\}$ 的窗口，在 $M_x \\times M_y$ 个分箱 $((j,k) \\in \\{1,\\dots,M_x\\}\\times\\{1,\\dots,M_y\\})$ 的笛卡尔网格上存在一个分箱计数直方图 $n_i(x_j,y_k)$。每个计数存储为 8 字节整数。\n- 对于每个窗口 $i$，存在一个在每个网格分箱上评估的预计算折合偏置势数组 $b_i(x_j,y_k)$，存储为 8 字节浮点数。\n- 网格上的当前折合概率密度估计值 $P(x_j,y_k)$，存储为 8 字节浮点数。\n- 一个工作数组 $D(x_j,y_k)$，用于在网格上累加多直方图分母，存储为 8 字节浮点数。\n- 网格上密度估计值的临时副本 $P^{\\text{new}}(x_j,y_k)$，存储为 8 字节浮点数。\n- 每个窗口的自由能偏移量 $f_i$，存储为 8 字节浮点数。\n- 每个窗口的总样本数 $N_i$，存储为 8 字节整数（每个窗口一个）。\n- 沿每个轴的分箱中心的网格坐标数组，$x_j$（对于 $j=1,\\dots,M_x$）和 $y_k$（对于 $k=1,\\dots,M_y$），每个都存储为 8 字节浮点数。\n- 对于谐波伞形偏置，保留每个窗口的参数 $(k_{x,i},k_{y,i},x_{0,i},y_{0,i})$；假设 $k_{x,i}$ 和 $k_{y,i}$ 合并为一个有效标量 $k_i$，因此每个窗口存储恰好三个 8 字节浮点值 $(k_i,x_{0,i},y_{0,i})$。\n\n假设有 $K=100$ 个窗口和一个 $M_x \\times M_y = 500 \\times 500$ 的网格。令 $M = M_x M_y$。使用以下基本事实：数组所需的内存等于其存储的元素数量乘以每个元素的字节数，并且独立数组的总和在字节数上是线性相加的。定义 $1\\,\\text{GB}$ 为 $1\\times 10^{9}$ 字节。\n\n从这些基础和定义出发，推导并计算同时容纳上述所有数组所需的总 RAM。用千兆字节 (GB) 表示最终答案，并将结果四舍五入到三位有效数字。", "solution": "该问题要求计算一个二维加权直方图分析方法 (2D-WHAM) 实现中，同时存储所有指定数据数组所需的总随机存取存储器 (RAM)。计算必须基于所提供的参数和定义。问题陈述经验证具有科学依据、提法恰当且客观。它包含了所有必要信息，没有矛盾之处。\n\n首先，我们定义符号及其给定值：\n伞形采样窗口的数量为 $K=100$。\n沿两个反应坐标的网格分箱数为 $M_x=500$ 和 $M_y=500$。\n二维网格上的总分箱数为 $M = M_x \\times M_y$。\n每个存储的数据元素（整数或浮点数）的大小为 $B=8$ 字节。\n千兆字节的转换因子为 $1\\,\\text{GB} = 1 \\times 10^9$ 字节。\n\n接下来，我们通过计算问题陈述中列出的每个数据结构所需的内存来继续。总内存 $S_{\\text{total}}$ 是每个组件所需内存的总和。\n\n1.  计数直方图 $n_i(x_j,y_k)$：有 $K$ 个窗口，每个窗口有一个跨越 $M$ 个网格分箱的直方图。每个计数为 $B$ 字节。所需内存为 $S_1 = K \\times M \\times B$。\n\n2.  偏置势数组 $b_i(x_j,y_k)$：与直方图类似，有 $K$ 个数组，每个大小为 $M$，元素大小为 $B$。所需内存为 $S_2 = K \\times M \\times B$。\n\n3.  概率密度 $P(x_j,y_k)$：这是一个覆盖 $M$ 个网格分箱的单一数组。所需内存为 $S_3 = M \\times B$。\n\n4.  分母数组 $D(x_j,y_k)$：这也是一个大小为 $M$ 的单一数组。所需内存为 $S_4 = M \\times B$。\n\n5.  新的密度估计值 $P^{\\text{new}}(x_j,y_k)$：这是第三个大小为 $M$ 的单一数组。所需内存为 $S_5 = M \\times B$。\n\n6.  自由能偏移量 $f_i$：$K$ 个窗口中的每一个都有一个偏移量。所需内存为 $S_6 = K \\times B$。\n\n7.  总样本数 $N_i$：$K$ 个窗口中的每一个都有一个总数。所需内存为 $S_7 = K \\times B$。\n\n8.  网格坐标数组 $x_j$：此数组存储沿 x 轴的 $M_x$ 个分箱的坐标。所需内存为 $S_8 = M_x \\times B$。\n\n9.  网格坐标数组 $y_k$：此数组存储沿 y 轴的 $M_y$ 个分箱的坐标。所需内存为 $S_9 = M_y \\times B$。\n\n10. 谐波偏置参数 $(k_i,x_{0,i},y_{0,i})$：对于 $K$ 个窗口中的每一个，存储 3 个参数。所需内存为 $S_{10} = 3 \\times K \\times B$。\n\n以字节为单位的总内存 $S_{\\text{total}}$ 是这些单独存储需求的总和：\n$$S_{\\text{total}} = S_1 + S_2 + S_3 + S_4 + S_5 + S_6 + S_7 + S_8 + S_9 + S_{10}$$\n代入符号表达式：\n$$S_{\\text{total}} = (K \\times M \\times B) + (K \\times M \\times B) + (M \\times B) + (M \\times B) + (M \\times B) + (K \\times B) + (K \\times B) + (M_x \\times B) + (M_y \\times B) + (3 \\times K \\times B)$$\n我们可以提取公因子 $B$ 并组合相似项：\n$$S_{\\text{total}} = B \\times [ (2 \\times K \\times M) + (3 \\times M) + (5 \\times K) + M_x + M_y ]$$\n现在，我们代入给定的数值：$K=100$, $M_x=500$, $M_y=500$ 以及 $B=8$。\n首先，我们计算网格分箱的总数：\n$$M = M_x \\times M_y = 500 \\times 500 = 250,000$$\n接下来，我们将这些值代入 $S_{\\text{total}}$ 的表达式中：\n$$S_{\\text{total}} = 8 \\times [ (2 \\times 100 \\times 250,000) + (3 \\times 250,000) + (5 \\times 100) + 500 + 500 ]$$\n我们计算括号内的各项：\n$$2 \\times 100 \\times 250,000 = 50,000,000$$\n$$3 \\times 250,000 = 750,000$$\n$$5 \\times 100 = 500$$\n$$500 + 500 = 1,000$$\n将这些项相加：\n$$50,000,000 + 750,000 + 500 + 1,000 = 50,751,500$$\n现在，乘以 $B=8$：\n$$S_{\\text{total}} = 8 \\times 50,751,500 = 406,012,000 \\text{ 字节}$$\n问题要求以千兆字节 (GB) 为单位给出答案，使用定义 $1\\,\\text{GB} = 10^9$ 字节。\n$$S_{\\text{GB}} = \\frac{S_{\\text{total}}}{10^9} = \\frac{406,012,000}{1,000,000,000} = 0.406012\\,\\text{GB}$$\n最后，我们将结果四舍五入到三位有效数字。前三位有效数字是 $4$、$0$ 和 $6$。随后的数字是 $0$，所以我们向下舍入。\n$$S_{\\text{GB}} \\approx 0.406$$\n因此，所需的总 RAM 为 $0.406$ GB。", "answer": "$$\n\\boxed{0.406}\n$$", "id": "2465741"}, {"introduction": "科学研究的道路上并非总是一帆风顺，模拟可能会意外中断，数据也可能丢失。本练习 [@problem_id:2465737] 提出了一个现实世界中的难题：当部分采样数据缺失时，你该如何处理？这个问题将考验你对WHAM核心要求（即统计重叠）的理解，并教会你如何科学、严谨地评估不完整数据集的分析结果及其局限性。", "problem": "您在一个温度为 $T = 300\\,\\mathrm{K}$ 的分子系统上，沿着一维反应坐标 $x$ 进行伞形采样。共有 $30$ 个窗口，中心位置为 $x_i = (i-1)\\times 0.10\\,\\mathrm{nm}$（$i \\in \\{1,2,\\dots,30\\}$），每个窗口都施加了谐波伞形偏置势 $w_i(x) = \\tfrac{1}{2}k (x - x_i)^2$，力常数为 $k = 1000\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}$。需要使用加权直方图分析方法 (WHAM) 来估计沿 $x$ 坐标的无偏平均力势 (PMF)。窗口 $\\#8$ 和 $\\#21$ 的时间序列数据已丢失，并且在当前的时间限制下无法恢复或重新模拟。您可以假设，在每个窗口内，潜在的无偏势能 $U_0(x)$ 在 $x_i$ 附近的局部变化与伞形势的曲率相比是温和的，因此对 $x$ 的偏置采样主要由伞形势主导，可以近似为局部高斯分布，其方差为 $\\sigma^2 \\approx k_B T / k$，其中 $k_B$ 是玻尔兹曼常数。\n\n在这些限制条件下，以下哪种策略能产生最佳的 PMF 结果？您预期结果中会出现什么缺陷？\n\nA. 沿 $x$ 轴对相邻直方图进行线性插值来填充缺失的直方图，然后对所有 $30$ 个窗口运行 WHAM 以强制连续性。得到的 PMF 将是连续的，其不确定性与邻近区域相当。\n\nB. WHAM 要求完整、连续的覆盖范围；没有缺失的窗口，WHAM 根本无法使用。唯一可行的选择是丢弃整个数据集，直到窗口 $\\#8$ 和 $\\#21$ 被重新模拟。\n\nC. 对可用的 $28$ 个窗口应用 WHAM（或多状态 Bennett 接受率方法 (MBAR)），首先检查沿 $x$ 轴的统计重叠。将数据视为由 $x_{\\#8}$ 和 $x_{\\#21}$ 处的间隙分隔开的最多三个连通分量。在每个连通分量上提取分段 PMF，并报告 (i) 不相连片段之间的相对自由能偏移是未定的，以及 (ii) 在邻近缺失窗口的边缘处，不确定性会增大，潜在的偏差也会增加。可选择使用更粗的 $x$ 坐标分箱来稳定噪声，但不要在没有新数据的情况下尝试弥合间隙。\n\nD. 通过后处理增加所有窗口的 $k$ 值来重加权轨迹，以等效于更强的伞形势，从而扩大有效覆盖范围并恢复跨越间隙的重叠。然后 WHAM 将重建一个单一的连续 PMF，其误差最多为一个均匀的加性常数。\n\nE. 从 WHAM 切换到伞形积分法，仅使用可用窗口对平均力 $\\langle \\partial w_i/\\partial x \\rangle$ 沿 $x$ 进行积分。因为力积分得到 PMF，所以 $x$ 坐标上的间隙不影响积分，得到的 PMF 将是正确的，只差一个全局的加性常数。", "solution": "首先对问题陈述进行严格验证。\n\n步骤 1：提取已知条件\n- 方法：伞形采样和加权直方图分析方法 (WHAM)。\n- 反应坐标：一维坐标 $x$。\n- 温度：$T = 300\\,\\mathrm{K}$。\n- 窗口数量：$30$。\n- 窗口中心：$x_i = (i-1)\\times 0.10\\,\\mathrm{nm}$，$i \\in \\{1,2,\\dots,30\\}$。\n- 伞形偏置势：$w_i(x) = \\tfrac{1}{2}k (x - x_i)^2$。\n- 力常数：$k = 1000\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}$。\n- 目标：估计无偏平均力势 (PMF)，$U_0(x)$。\n- 数据丢失：窗口 $\\#8$ 和 $\\#21$ 的时间序列数据已丢失。\n- 假设：在 $x_i$ 附近，潜在的无偏势能 $U_0(x)$ 的局部变化与伞形势的曲率相比是温和的。\n- 近似：在窗口 $i$ 中采样的 $x$ 的分布是局部高斯分布，其方差为 $\\sigma^2 \\approx k_B T / k$。\n- 常数：玻尔兹曼常数 $k_B$。\n\n步骤 2：使用提取的已知条件进行验证\n该问题描述了计算化学中的一个常见场景，涉及伞形采样模拟和使用 WHAM 进行 PMF 重建。所有概念，包括伞形势形式、WHAM、PMF 和高斯近似，都是标准的且科学合理的。所提供的温度、力常数和窗口间距的数值对于此类模拟是物理上现实的。问题的核心是确定处理一种特定且现实的数据丢失类型的最佳实践方法。该问题是适定的 (well-posed)，因为它要求的是最具科学依据的策略和预期的缺陷，而不是一个无法获得的精确解。语言客观而精确。该问题不违反任何有效性标准。\n\n步骤 3：结论和行动\n问题陈述被宣布为有效。将基于统计力学的基本原理和 WHAM 的形式体系推导解决方案。\n\nWHAM 的主要目的是结合来自多个偏置模拟（窗口）的数据，以获得沿坐标 $x$ 的无偏概率分布 $P_0(x)$ 的全局最优估计。然后 PMF 由 $U_0(x) = -k_B T \\ln P_0(x) + C$ 给出，其中 $C$ 是一个任意常数。WHAM 方程是一组自洽方程，用于求解 $P_0(x)$ 和对每个窗口进行偏置的相对自由能 $F_i$：\n$$ P_0(x) \\propto \\frac{\\sum_{i=1}^{M} N_i(x)}{\\sum_{j=1}^{M} n_j \\exp[-(w_j(x) - F_j)/(k_B T)]} $$\n$$ \\exp(-F_i / (k_B T)) = \\int P_0(x') \\exp(-w_i(x') / (k_B T)) dx' $$\n在此， $M$ 是窗口数，$N_i(x)$ 是来自窗口 $i$ 的坐标 $x$ 的直方图，而 $n_i = \\int N_i(x')dx'$ 是该窗口中的总样本数。\n\nWHAM 方程要在整个 $x$ 范围内产生单一、连续的 PMF，一个关键要求是相邻窗口之间存在统计重叠。这种重叠使得窗口之间的自由能差异（包含在 $F_i$ 项中）得以确定，从而将整个系列的模拟连接起来。\n\n让我们根据所提供的信息评估重叠情况。问题陈述指出，每个窗口中的偏置概率分布近似为方差 $\\sigma^2 \\approx k_B T / k$ 的高斯分布。\n使用 $k_B \\approx 8.314 \\times 10^{-3} \\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$，$T = 300\\,\\mathrm{K}$，以及 $k = 1000\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}$：\n$$ \\sigma^2 \\approx \\frac{(8.314 \\times 10^{-3} \\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}) \\times (300\\,\\mathrm{K})}{1000\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}} \\approx 2.494 \\times 10^{-3}\\,\\mathrm{nm^2} $$\n因此，标准差为：\n$$ \\sigma \\approx \\sqrt{2.494 \\times 10^{-3}\\,\\mathrm{nm^2}} \\approx 0.0499\\,\\mathrm{nm} \\approx 0.05\\,\\mathrm{nm} $$\n相邻窗口中心之间的间距是 $\\Delta x = 0.10\\,\\mathrm{nm}$。这对应于 $0.10\\,\\mathrm{nm} / 0.05\\,\\mathrm{nm} = 2\\sigma$ 的间距。这个间距是标准的，可确保相邻窗口之间有良好的统计重叠。\n\n然而，由于窗口 $\\#8$ 和 $\\#21$ 的缺失，我们在数据中有了两个间隙。\n1.  窗口 $\\#7$ (中心 $x_7 = 0.70\\,\\mathrm{nm}$) 和窗口 $\\#9$ (中心 $x_9 = 0.80\\,\\mathrm{nm}$) 之间。间距为 $0.20\\,\\mathrm{nm}$，约为 $4\\sigma$。\n2.  窗口 $\\#20$ (中心 $x_{20} = 1.90\\,\\mathrm{nm}$) 和窗口 $\\#22$ (中心 $x_{22} = 2.10\\,\\mathrm{nm}$) 之间。间距同样为 $0.20\\,\\mathrm{nm}$，约为 $4\\sigma$。\n\n相隔 $4\\sigma$ 的两个高斯分布之间的重叠极小。一个高斯分布在另一个高斯分布均值处的概率密度与 $\\exp(- (4\\sigma)^2 / (2\\sigma^2)) = \\exp(-8)$ 成正比，这是一个非常小的数。这种近乎为零的重叠意味着没有统计上有效的方法来连接跨越这些间隙的自由能。WHAM 程序将有效地将数据视为三个不相连的模拟集合（或“分量”）：\n-   分量1：窗口 $\\#1$ 到 $\\#7$。\n-   分量2：窗口 $\\#9$ 到 $\\#20$。\n-   分量3：窗口 $\\#22$ 到 $\\#30$。\n\nWHAM（或其更通用的变体 MBAR）可以单独应用于每个分量，以产生一个连续的 PMF 片段。然而，这三个片段之间的相对自由能偏移将是未定的。我们可以在 $[x_1, x_7]$、$[x_9, x_{20}]$ 和 $[x_{22}, x_{30}]$ 范围内找到 PMF 的形状，但我们无法知道如何垂直移动这三条曲线以将它们对齐成一个单一的全局 PMF。此外，在这些分量的边缘附近（例如，从窗口 $\\#7$、$\\#9$、$\\#20$ 和 $\\#22$ 导出的 PMF），估计的统计质量将会下降。$P_0(x)$ 的 WHAM 估计器受益于所有采样 $x$ 区域的窗口的贡献。在窗口 $\\#8$ 的间隙附近，数据缺少一个关键的贡献者，导致在 $x_7$ 和 $x_9$ 周围的 PMF 估计中出现更高的统计不确定性和潜在的偏差。\n\n基于此理解，我们来评估每个选项。\n\nA. 这个策略存在根本性缺陷。直方图是随机过程的结果，而不是一个平滑的确定性函数。对直方图进行插值相当于捏造数据。这种方法在统计力学中没有依据，会引入不可控且无法量化的系统误差。间隙内真实 PMF 的任何特征（例如，能垒或能阱）都将被人为地平滑掉。声称不确定性将与‘邻近区域相当’是错误的，因为捏造数据的误差属性是未知的。结论：**不正确**。\n\nB. 这种说法过于绝对且不切实际。WHAM 是一种稳健的方法，可以应用于任何状态（窗口）集合，无论它们是否连通。如果状态不连通，结果是一组相对偏移未知的 PMF，这仍然是有价值的信息。丢弃 $28$ 个有效的模拟是计算资源和数据的巨大浪费。提取部分信息远胜于不提取任何信息。结论：**不正确**。\n\nC. 这个策略是唯一在统计上严谨且科学上诚实的。它正确地指出了重叠不良的后果：数据集分割成不连通的分量。它正确地诊断了主要缺陷：这些分量之间的相对自由能是未定的。它还正确地预测了次要缺陷：由于信息缺失，在间隙边界处不确定性增加和潜在偏差。提及 MBAR 是恰当的，因为它是一个相关的、更通用的方法，会面临同样的限制。这种方法在最大程度上利用了可用数据，同时透明地报告了所得 PMF 的局限性。结论：**正确**。\n\nD. 这个提议是基于对重加权和力常数 $k$ 效应的双重误解。增加 $k$ 会使谐波约束*更强*或*更硬*，导致采样分布*更窄*，而不是更宽。这会恶化重叠，而不是恢复它。要扩大采样范围，需要重加权到一个更小的 $k$ 值。然而，重加权只有在目标分布和采样分布有显著重叠时才有效。试图通过重加权窗口 $\\#7$ 的数据来预测窗口 $\\#8$ 区域的行为（距离窗口 $\\#7$ 中心有 $2\\sigma$ 的间隙）已经很勉强了，而通过重加权来弥合窗口 $\\#7$ 和 $\\#9$ 均值之间完整的 $4\\sigma$ 间隙在统计上是毫无希望的。这将导致巨大的统计误差，因为权重将被少数不具代表性的数据点所主导。结论：**不正确**。\n\nE. 此选项不正确。伞形积分通过对无偏平均力进行积分来重建 PMF，即 $U_0(x) = -\\int \\langle F_{unbiased}(x') \\rangle dx'$。无偏平均力 $\\langle F_{unbiased}(x') \\rangle$ 本身必须在整个积分范围内的所有 $x'$ 值上进行估计。这通常通过合并所有窗口的数据来完成。由于窗口 $\\#8$ 和 $\\#21$ 的缺失，存在一些 $x$ 的区域，我们没有数据来估计 $\\langle F_{unbiased}(x') \\rangle$。‘$x$ 坐标上的间隙不影响积分’的说法是错误的。积分要求被积函数在整个积分域上是已知的。没有间隙中的数据，积分就无法跨越它们进行，PMF 也无法连接起来。这种方法与 WHAM 遭受同样的基本问题。结论：**不正确**。", "answer": "$$\\boxed{C}$$", "id": "2465737"}]}