{"hands_on_practices": [{"introduction": "在模拟如行星绕恒星运动等振荡系统的长期行为时，仅仅保证短期精度是远远不够的。本练习将探讨相位误差这一关键概念，它衡量了积分器在多个周期内跟踪系统频率的准确性。通过解析比较一个简单的辛积分器和一个高阶通用方法，你将揭示几何积分器在天体力学和分子动力学等领域中不可或缺的根本原因 [@problem_id:3235367]。", "problem": "考虑具有哈密顿量 $H(q,p) = \\frac{1}{2} p^{2} + \\frac{1}{2} \\omega^{2} q^{2}$ 的哈密顿简谐振子，因此哈密顿方程给出线性常微分方程（ODE）系统 $q' = p$, $p' = -\\omega^{2} q$，等价于 $y' = A y$，其中 $y = (q,p)^{\\mathsf{T}}$ 且 $A = \\begin{pmatrix} 0 & 1 \\\\ -\\omega^{2} & 0 \\end{pmatrix}$。对于步长为 $h$ 的单步法，数值频率 $\\Omega_{\\text{num}}$ 定义如下：如果单步更新为 $y_{n+1} = M y_{n}$，且矩阵 $M$ 的特征值为 $\\lambda_{\\pm} = \\rho \\exp(\\pm i \\theta)$，其中 $\\rho > 0$ 且 $\\theta \\in \\mathbb{R}$（对于足够小的 $h$），则每步的旋转角为 $\\theta$（单位为弧度），数值频率为 $\\Omega_{\\text{num}} = \\theta / h$。\n\n您将分析在 $h \\to 0$ 时，以下两种以固定步长 $h$ 应用于谐振子的方法的主阶相位误差（频率误差）$\\Delta \\Omega = \\Omega_{\\text{num}} - \\omega$：\n\n- 辛欧拉法（半隐式，先冲后漂）：$p_{n+1} = p_{n} - h \\,\\omega^{2} q_{n}$，$q_{n+1} = q_{n} + h\\, p_{n+1}$。假设 $0 < \\omega h < 2$ 以使更新为旋转。\n\n- 经典的四阶龙格-库塔方法 (RK4)：对于 $y' = f(y)$，步长为 $h$，该方法由下式给出：\n$k_{1} = f(y_{n})$, \n$k_{2} = f(y_{n} + \\frac{h}{2} k_{1})$, \n$k_{3} = f(y_{n} + \\frac{h}{2} k_{2})$, \n$k_{4} = f(y_{n} + h k_{3})$, \n$y_{n+1} = y_{n} + \\frac{h}{6} (k_{1} + 2 k_{2} + 2 k_{3} + k_{4})$。\n将此应用于 $f(y) = A y$。\n\n从这些定义和 $A$ 的线性代数出发，推导在 $h$ 较小时有效的相位误差 $\\Delta \\Omega_{\\text{SE}}$ 和 $\\Delta \\Omega_{\\text{RK4}}$ 作为 $\\omega$ 和 $h$ 的函数的主阶非零阶渐近表达式。\n\n将您的最终答案表示为一个单行矩阵，按 $\\bigl[\\Delta \\Omega_{\\text{SE}}, \\Delta \\Omega_{\\text{RK4}}\\bigr]$ 的顺序列出这两个表达式。角度使用弧度。不要包含单位。无需四舍五入；给出精确的符号系数。", "solution": "问题要求解两种数值方法应用于简谐振子系统 $y' = Ay$ 的主阶相位误差 $\\Delta \\Omega = \\Omega_{\\text{num}} - \\omega$，其中 $y = (q,p)^{\\mathsf{T}}$ 且 $A = \\begin{pmatrix} 0 & 1 \\\\ -\\omega^{2} & 0 \\end{pmatrix}$。数值频率 $\\Omega_{\\text{num}}$ 定义为 $\\theta/h$，其中 $\\theta$ 是单步更新矩阵 $M$ 的特征值 $\\rho \\exp(\\pm i\\theta)$ 所对应的每步旋转角。\n\n矩阵 $A$ 的特征值是 $\\lambda^2 + \\omega^2 = 0$ 的解，即 $\\lambda_{\\pm} = \\pm i\\omega$。步长为 $h$ 的精确流由矩阵指数 $\\exp(hA)$ 给出。其特征值为 $\\exp(\\pm i\\omega h)$。这对应于精确旋转角 $\\theta_{\\text{exact}} = \\omega h$ 和频率 $\\Omega_{\\text{exact}} = \\omega$。\n\n### 辛欧拉法（SE）分析\n\n定义的辛欧拉法为：\n$p_{n+1} = p_{n} - h \\omega^{2} q_{n}$\n$q_{n+1} = q_{n} + h p_{n+1}$\n\n将第一个方程代入第二个方程，得到 $y_{n} = (q_n, p_n)^{\\mathsf{T}}$ 的显式更新规则：\n$q_{n+1} = q_{n} + h (p_n - h \\omega^2 q_n) = (1 - \\omega^2 h^2) q_n + h p_n$\n$p_{n+1} = -h \\omega^2 q_n + p_n$\n\n这可以写成矩阵形式 $y_{n+1} = M_{\\text{SE}} y_n$，其中更新矩阵 $M_{\\text{SE}}$ 为：\n$$\nM_{\\text{SE}} = \\begin{pmatrix} 1 - \\omega^{2}h^{2} & h \\\\ -h\\omega^{2} & 1 \\end{pmatrix}\n$$\n$M_{\\text{SE}}$ 的特征值 $\\lambda$ 由特征方程 $\\det(M_{\\text{SE}} - \\lambda I) = 0$ 给出。\n$M_{\\text{SE}}$ 的迹为 $\\text{tr}(M_{\\text{SE}}) = 2 - \\omega^2 h^2$。\n行列式为 $\\det(M_{\\text{SE}}) = (1 - \\omega^2 h^2)(1) - (h)(-h\\omega^2) = 1$。\n特征方程为 $\\lambda^2 - \\text{tr}(M_{\\text{SE}})\\lambda + \\det(M_{\\text{SE}}) = 0$，即：\n$$\n\\lambda^{2} - (2 - \\omega^{2}h^{2})\\lambda + 1 = 0\n$$\n判别式为 $D = (2 - \\omega^2 h^2)^2 - 4 = 4 - 4\\omega^2 h^2 + \\omega^4 h^4 - 4 = \\omega^2 h^2(\\omega^2 h^2 - 4)$。\n条件 $0 < \\omega h < 2$ 意味着 $D < 0$，因此特征值是单位圆上的一对共轭复数（因为 $\\det(M_{\\text{SE}})=1$）。设特征值为 $\\lambda_{\\pm} = \\exp(\\pm i \\theta_{\\text{SE}})$。\n特征值之和为 $\\lambda_+ + \\lambda_- = 2\\cos(\\theta_{\\text{SE}})$，它必须等于 $M_{\\text{SE}}$ 的迹。\n$$\n2\\cos(\\theta_{\\text{SE}}) = 2 - \\omega^{2}h^{2} \\implies \\cos(\\theta_{\\text{SE}}) = 1 - \\frac{\\omega^{2}h^{2}}{2}\n$$\n数值频率为 $\\Omega_{\\text{SE}} = \\theta_{\\text{SE}}/h$。我们需要求解 $\\theta_{\\text{SE}}$ 并对小 $h$ 进行展开。\n$\\theta_{\\text{SE}} = \\arccos\\left(1 - \\frac{\\omega^{2}h^{2}}{2}\\right)$。\n令 $x = \\frac{\\omega^2 h^2}{2}$。对于小 $h$，$x$ 也很小。我们使用 $\\arccos(1-x)$ 对于小 $x>0$ 的泰勒级数展开：\n$\\arccos(1-x) = \\sqrt{2x} + \\frac{1}{6\\sqrt{2}}x^{3/2} + O(x^{5/2})$。\n代入 $x = \\frac{\\omega^2 h^2}{2}$：\n$$\n\\theta_{\\text{SE}} = \\sqrt{2 \\cdot \\frac{\\omega^{2}h^{2}}{2}} + \\frac{1}{6\\sqrt{2}}\\left(\\frac{\\omega^{2}h^{2}}{2}\\right)^{3/2} + O(h^5)\n$$\n$$\n\\theta_{\\text{SE}} = \\omega h + \\frac{1}{6\\sqrt{2}} \\frac{\\omega^{3}h^{3}}{2\\sqrt{2}} + O(h^5) = \\omega h + \\frac{\\omega^{3}h^{3}}{24} + O(h^5)\n$$\n数值频率为：\n$$\n\\Omega_{\\text{SE}} = \\frac{\\theta_{\\text{SE}}}{h} = \\omega + \\frac{\\omega^{3}h^{2}}{24} + O(h^4)\n$$\n辛欧拉法的主阶相位误差为：\n$$\n\\Delta \\Omega_{\\text{SE}} = \\Omega_{\\text{SE}} - \\omega = \\frac{\\omega^{3}h^{2}}{24}\n$$\n\n### 经典的 Runge-Kutta (RK4) 分析\n\n对于线性常微分方程 $y' = Ay$，RK4 方法给出了一个线性更新 $y_{n+1} = M_{\\text{RK4}}y_n$。矩阵 $M_{\\text{RK4}}$ 是一个关于 $hA$ 的多项式：\n$$\nM_{\\text{RK4}} = I + hA + \\frac{(hA)^2}{2!} + \\frac{(hA)^3}{3!} + \\frac{(hA)^4}{4!}\n$$\n$M_{\\text{RK4}}$ 的特征值 $\\lambda_{\\text{RK4}}$ 是通过将相同的多项式应用于 $A$ 的特征值 $\\pm i\\omega$ 得到的。令 $z=\\omega h$。\n$$\n\\lambda_{\\text{RK4}, \\pm} = 1 + (\\pm i\\omega h) + \\frac{(\\pm i\\omega h)^2}{2} + \\frac{(\\pm i\\omega h)^3}{6} + \\frac{(\\pm i\\omega h)^4}{24}\n$$\n$$\n\\lambda_{\\text{RK4}, \\pm} = 1 \\pm i(\\omega h) - \\frac{(\\omega h)^2}{2} \\mp i\\frac{(\\omega h)^3}{6} + \\frac{(\\omega h)^4}{24}\n$$\n$$\n\\lambda_{\\text{RK4}, \\pm} = \\left(1 - \\frac{z^2}{2} + \\frac{z^4}{24}\\right) \\pm i\\left(z - \\frac{z^3}{6}\\right)\n$$\n特征值的形式为 $\\rho \\exp(\\pm i\\theta_{\\text{RK4}})$。角度 $\\theta_{\\text{RK4}}$ 由复数 $\\lambda_{\\text{RK4},+}$ 的辐角给出。\n$$\n\\theta_{\\text{RK4}} = \\arg(\\lambda_{\\text{RK4},+}) = \\arctan\\left(\\frac{\\text{Im}(\\lambda_{\\text{RK4},+})}{\\text{Re}(\\lambda_{\\text{RK4},+})}\\right) = \\arctan\\left(\\frac{z - z^3/6}{1 - z^2/2 + z^4/24}\\right)\n$$\n为了找到主阶误差，我们对小 $z = \\omega h$ 展开此表达式。设反正切函数的自变量为 $X$。\n$$\nX = \\frac{z(1-z^2/6)}{1-z^2/2+z^4/24}\n$$\n我们将 $X$ 展开为 $z$ 的泰勒级数：\n$X = z\\left(1-\\frac{z^2}{6}\\right)\\left(1 - \\left(\\frac{z^2}{2}-\\frac{z^4}{24}\\right)\\right)^{-1}$\n$ = z\\left(1-\\frac{z^2}{6}\\right)\\left(1 + \\left(\\frac{z^2}{2}-\\frac{z^4}{24}\\right) + \\left(\\frac{z^2}{2}\\right)^2 + O(z^6)\\right)$\n$ = z\\left(1-\\frac{z^2}{6}\\right)\\left(1 + \\frac{z^2}{2} + \\frac{5z^4}{24} + O(z^6)\\right)$\n$ = z\\left(1 + \\frac{z^2}{2} + \\frac{5z^4}{24} - \\frac{z^2}{6} - \\frac{z^4}{12} + O(z^6)\\right)$\n$ = z\\left(1 + \\frac{z^2}{3} + \\frac{z^4}{8} + O(z^6)\\right) = z + \\frac{z^3}{3} + \\frac{z^5}{8} + O(z^7)$\n\n$\\tan(z)$ 的泰勒级数为 $\\tan(z) = z + \\frac{z^3}{3} + \\frac{2z^5}{15} + O(z^7)$。\n因此，我们可以用 $\\tan(z)$ 来表示 $X$：\n$X = \\tan(z) + \\left(\\frac{1}{8} - \\frac{2}{15}\\right)z^5 + O(z^7) = \\tan(z) - \\frac{z^5}{120} + O(z^7)$。\n\n现在我们求 $\\theta_{\\text{RK4}} = \\arctan(X)$。令 $T = \\tan(z)$ 且 $\\epsilon = -z^5/120 + O(z^7)$。\n$\\theta_{\\text{RK4}} = \\arctan(T+\\epsilon) = \\arctan(T) + \\frac{\\epsilon}{1+T^2} + O(\\epsilon^2)$。\n因为 $\\arctan(T)=\\arctan(\\tan(z)) = z$ 对于小 $z$ 成立，且 $1/(1+T^2) = 1/(1+\\tan^2(z)) = \\cos^2(z) = 1-z^2/2+O(z^4)$，我们有：\n$\\theta_{\\text{RK4}} = z + \\left(-\\frac{z^5}{120} + O(z^7)\\right)(\\cos^2(z)) = z - \\frac{z^5}{120} + O(z^7)$。\n代入 $z=\\omega h$：\n$$\n\\theta_{\\text{RK4}} = \\omega h - \\frac{(\\omega h)^5}{120} + O(h^7)\n$$\nRK4 的数值频率为：\n$$\n\\Omega_{\\text{RK4}} = \\frac{\\theta_{\\text{RK4}}}{h} = \\omega - \\frac{\\omega^5 h^4}{120} + O(h^6)\n$$\nRK4 的主阶相位误差为：\n$$\n\\Delta \\Omega_{\\text{RK4}} = \\Omega_{\\text{RK4}} - \\omega = -\\frac{\\omega^5 h^4}{120}\n$$\n最终结果由两个推导出的相位误差表达式组成。\n$\\Delta \\Omega_{\\text{SE}} = \\frac{\\omega^3 h^2}{24}$\n$\\Delta \\Omega_{\\text{RK4}} = -\\frac{\\omega^5 h^4}{120}$", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\omega^{3}h^{2}}{24} & -\\frac{\\omega^{5}h^{4}}{120} \\end{pmatrix}}\n$$", "id": "3235367"}, {"introduction": "理论分析固然强大，但亲眼所见更能加深理解。这个动手编程练习要求你为简谐振子实现并比较两种不同的数值方法。通过观察能量和相位的长期演化，你将对非辛方法中的数值能量漂移，以及像辛欧拉方法这类辛积分器卓越的长期稳定性，获得直观且深刻的实践认识 [@problem_id:3235506]。", "problem": "考虑一个保守谐振子，它由单位角频率的二阶常微分方程 (ODE) $q''(t) + q(t) = 0$ 控制。引入正则动量 $p(t) = q'(t)$，得到一阶系统 $q'(t) = p(t)$ 和 $p'(t) = -q(t)$，该系统定义了一个哈密顿系统，其哈密顿量为 $H(q,p) = \\frac{1}{2} q^2 + \\frac{1}{2} p^2$。其精确解使状态 $(q(t),p(t))$ 在半径为 $\\sqrt{q^2 + p^2}$ 的圆上以每秒 $1$ 弧度的角速度旋转。你的任务是为此系统实现两种数值积分器，比较它们的相位精度，并评估它们的能量行为。\n\n你必须实现：\n- 显式梯形（Heun）法，这是一种二阶双级龙格－库塔法，通过对预测步和校正步的斜率进行平均来构成。\n- 辛欧拉法（踢-漂移变体），该方法使用势梯度更新动量，然后使用新的动量更新位置，从而保持正则辛二形式。\n\n对于每个测试用例，执行以下步骤：\n1. 将二阶 ODE 转换为一阶系统 $q'(t) = p(t)$ 和 $p'(t) = -q(t)$。\n2. 使用两种方法从初始条件 $(q(0),p(0)) = (q_0,p_0)$ 开始，以均匀步长 $h$ 进行 $N = \\mathrm{round}(T/h)$ 步积分，其中 $T$ 是预期的总时间。令 $T_{\\text{eff}} = N h$ 表示有效积分时间。\n3. 计算在 $t = T_{\\text{eff}}$ 时的精确相位 $\\phi_{\\text{exact}} = \\phi_0 - T_{\\text{eff}}$，其中 $\\phi_0 = \\mathrm{atan2}(p_0,q_0)$。使用双参数反正切函数定义相位，并以弧度表示角度。\n4. 对于每种方法，计算最终状态 $(q_N,p_N)$ 的数值相位 $\\phi_{\\text{num}} = \\mathrm{atan2}(p_N,q_N)$。定义带符号的最小角差 $\\Delta \\phi = \\phi_{\\text{num}} - \\phi_{\\text{exact}}$，将其收纳到区间 $[-\\pi,\\pi]$ 内，并报告其绝对值 $|\\Delta \\phi|$ 作为相位误差（以弧度为单位）。\n5. 计算振幅比 $\\rho = \\frac{\\sqrt{q_N^2 + p_N^2}}{\\sqrt{q_0^2 + p_0^2}}$ 以评估与精确圆周运动的偏离。\n6. 为每个测试用例生成一个布尔标志，指示 Heun 法的绝对相位误差是否严格大于辛欧拉法。\n\n角度单位必须是弧度。时间 $T$ 和步长 $h$ 必须以秒为单位处理，角频率等于每秒 $1$ 弧度。所有浮点输出必须四舍五入到 $6$ 位小数。\n\n测试套件：\n- 情况 1：$(q_0,p_0) = (1.0,0.0)$，$h = 0.2$ 秒，$T = 40\\pi$ 秒。\n- 情况 2：$(q_0,p_0) = (1.0,0.0)$，$h = 0.9$ 秒，$T = 40\\pi$ 秒。\n- 情况 3：$(q_0,p_0) = (0.7,0.3)$，$h = 0.05$ 秒，$T = 80\\pi$ 秒。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例对应一个内部列表。每个内部列表必须具有以下形式：\n$[\\text{phase\\_error\\_Heun}, \\text{phase\\_error\\_SymplecticEuler}, \\text{amplitude\\_ratio\\_Heun}, \\text{amplitude\\_ratio\\_SymplecticEuler}, \\text{Heun\\_phase\\_worse}]$，\n其中前四个条目是四舍五入到 $6$ 位小数的浮点数，最后一个是布尔值。例如，输出格式必须类似于 $[[a_1,b_1,c_1,d_1,e_1],[a_2,b_2,c_2,d_2,e_2],[a_3,b_3,c_3,d_3,e_3]]$。", "solution": "问题陈述已经过分析，被认为是有效的。它具有科学依据、是良定的、客观的，并包含了进行求解所需的所有必要信息。\n\n该问题研究了一个简谐振子的数值积分，这是物理学中的一个基本模型。其控制的二阶常微分方程 (ODE) 是：\n$$\nq''(t) + q(t) = 0\n$$\n引入正则动量 $p(t) = q'(t)$，我们得到等效的一阶哈密顿系统：\n$$\n\\begin{cases}\nq'(t) = p(t) \\\\\np'(t) = -q(t)\n\\end{cases}\n$$\n该系统可以写成向量形式 $\\mathbf{y}'(t) = f(\\mathbf{y}(t))$，其中 $\\mathbf{y} = [q, p]^T$ 且 $f(\\mathbf{y}) = [p, -q]^T$。系统的哈密顿量 $H(q,p) = \\frac{1}{2}q^2 + \\frac{1}{2}p^2$ 是一个代表总能量的守恒量。精确解的轨迹是在 $(q,p)$ 相空间中的圆，对应于恒定的能量。\n\n我们将实现并比较两种数值方法来近似该系统的解。\n\n### 显式梯形（Heun）法\nHeun 法是一种二阶龙格－库塔法。它是一种显式的、双级的预测-校正法。给定在时间 $t_n$ 的状态 $\\mathbf{y}_n = [q_n, p_n]^T$，在 $t_{n+1} = t_n + h$ 的状态通过以下方式找到：\n1. 预测步：$\\mathbf{k}_1 = f(\\mathbf{y}_n) = [p_n, -q_n]^T$。使用前向欧拉法估计一个初步状态 $\\mathbf{y}^*$：$\\mathbf{y}^* = \\mathbf{y}_n + h \\mathbf{k}_1$。\n2. 校正步：在预测状态处评估斜率：$\\mathbf{k}_2 = f(\\mathbf{y}^*) = f(\\mathbf{y}_n + h \\mathbf{k}_1)$。\n3. 更新：平均两个斜率以更新状态：$\\mathbf{y}_{n+1} = \\mathbf{y}_n + \\frac{h}{2}(\\mathbf{k}_1 + \\mathbf{k}_2)$。\n\n对于我们的特定系统：\n$\\mathbf{k}_1 = [p_n, -q_n]^T$。\n$\\mathbf{y}^* = [q_n + h p_n, p_n - h q_n]^T$。\n$\\mathbf{k}_2 = [p_n - h q_n, -(q_n + h p_n)]^T$。\n更新方程为：\n$$\nq_{n+1} = q_n + \\frac{h}{2}(p_n + (p_n - h q_n)) = (1 - \\frac{h^2}{2})q_n + h p_n\n$$\n$$\np_{n+1} = p_n + \\frac{h}{2}(-q_n - (q_n + h p_n)) = -h q_n + (1 - \\frac{h^2}{2})p_n\n$$\n以矩阵形式，更新为 $\\mathbf{y}_{n+1} = M_H \\mathbf{y}_n$，其中放大矩阵 $M_H$ 为：\n$$\nM_H = \\begin{pmatrix} 1 - \\frac{h^2}{2} & h \\\\ -h & 1 - \\frac{h^2}{2} \\end{pmatrix}\n$$\n该矩阵的行列式为 $\\det(M_H) = (1 - \\frac{h^2}{2})^2 + h^2 = 1 + \\frac{h^4}{4}$。由于 $\\det(M_H) > 1$，该方法不是辛的。相空间元素的面积不被保留，对于此系统，数值能量（和振幅）会随时间系统性地增加。\n\n### 辛欧拉法（踢-漂移）\n辛积分器旨在保持哈密顿系统的正则辛二形式，这使得它们在长期稳定性方面表现优越，尤其是在能量守恒方面。指定的踢-漂移变体是一种一阶半隐式方法。它首先更新动量（踢），然后使用新的动量来更新位置（漂移）。\n对于可分哈密顿量 $H(q,p) = T(p) + V(q)$，更新过程为：\n1. 踢：$p_{n+1} = p_n - h V'(q_n)$。\n2. 漂移：$q_{n+1} = q_n + h T'(p_{n+1})$。\n\n对于我们的系统，$V(q) = \\frac{1}{2}q^2 \\implies V'(q)=q$ 且 $T(p) = \\frac{1}{2}p^2 \\implies T'(p)=p$。更新方程为：\n$$\np_{n+1} = p_n - h q_n\n$$\n$$\nq_{n+1} = q_n + h p_{n+1} = q_n + h (p_n - h q_n) = (1 - h^2)q_n + h p_n\n$$\n以矩阵形式，$\\mathbf{y}_{n+1} = M_{SE} \\mathbf{y}_n$，其放大矩阵 $M_{SE}$ 为：\n$$\nM_{SE} = \\begin{pmatrix} 1 - h^2 & h \\\\ -h & 1 \\end{pmatrix}\n$$\n行列式为 $\\det(M_{SE}) = (1 - h^2)(1) - (h)(-h) = 1$。该方法是辛的。它不守恒精确的哈密顿量 $H$，但它精确地守恒一个邻近的“影子”哈密顿量。因此，数值能量误差在长时间积分中保持有界。\n\n### 分析与计算过程\n对于每个具有初始条件 $(q_0, p_0)$、步长 $h$ 和总时间 $T$ 的测试用例，我们执行以下操作：\n1. 计算步数 $N = \\mathrm{round}(T/h)$ 和有效积分时间 $T_{\\text{eff}} = N h$。\n2. 对于两种方法，将各自的矩阵更新迭代 $N$ 次，以找到最终状态 $(q_N, p_N)$。\n3. 初始半径为 $R_0 = \\sqrt{q_0^2 + p_0^2}$。最终半径为 $R_N = \\sqrt{q_N^2 + p_N^2}$。振幅比为 $\\rho = R_N / R_0$。该比率衡量数值能量的耗散或增长，因为 $H = \\frac{1}{2}R^2$。\n4. 初始相位为 $\\phi_0 = \\mathrm{atan2}(p_0, q_0)$。精确解的相位演化为 $\\phi(t) = \\phi_0 - t$。因此，精确的最终相位为 $\\phi_{\\text{exact}} = \\phi_0 - T_{\\text{eff}}$。\n5. 数值最终相位为 $\\phi_{\\text{num}} = \\mathrm{atan2}(p_N, q_N)$。\n6. 相位误差是最小角差 $\\Delta\\phi = \\phi_{\\text{num}} - \\phi_{\\text{exact}}$。使用 $((\\Delta\\phi + \\pi) \\pmod{2\\pi}) - \\pi$ 将其收纳到区间 $[-\\pi, \\pi]$ 内。我们报告其绝对值 $|\\Delta\\phi|$。\n7. 我们比较绝对相位误差，以确定 Heun 法的误差是否严格大于辛欧拉法的误差。\n\n这个过程可以直接比较标准龙格－库塔法和几何积分器，凸显后者在保守系统长期模拟中的优势。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the harmonic oscillator problem using Heun's and Symplectic Euler\n    methods and compares their phase accuracy and amplitude stability.\n    \"\"\"\n\n    # Test suite with initial conditions, step size, and total time.\n    # (q0, p0), h, T\n    test_cases = [\n        ((1.0, 0.0), 0.2, 40 * np.pi),  # Case 1\n        ((1.0, 0.0), 0.9, 40 * np.pi),  # Case 2\n        ((0.7, 0.3), 0.05, 80 * np.pi), # Case 3\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        (q0, p0), h, T = case\n        \n        y0 = np.array([q0, p0])\n\n        # 1. Calculate integration parameters\n        N = int(np.round(T / h))\n        T_eff = N * h\n\n        # 2. Define update matrices for the methods\n        # Heun's method matrix\n        M_H = np.array([\n            [1 - 0.5 * h**2, h],\n            [-h, 1 - 0.5 * h**2]\n        ])\n\n        # Symplectic Euler (kick-drift) matrix\n        M_SE = np.array([\n            [1 - h**2, h],\n            [-h, 1]\n        ])\n\n        # 3. Integrate using both methods\n        y_heun = y0.copy()\n        for _ in range(N):\n            y_heun = M_H @ y_heun\n        \n        y_se = y0.copy()\n        for _ in range(N):\n            y_se = M_SE @ y_se\n        \n        qN_heun, pN_heun = y_heun\n        qN_se, pN_se = y_se\n\n        # 4. Compute exact quantities and initial values\n        phi0 = np.arctan2(p0, q0)\n        phi_exact = phi0 - T_eff\n        r0 = np.linalg.norm(y0)\n        # Handle the case of (0,0) initial condition to avoid division by zero\n        if r0 == 0:\n            r0 = 1.0\n\n        # Create a helper function for calculating metrics\n        def calculate_metrics(qN, pN):\n            # Compute numerical phase\n            phi_num = np.arctan2(pN, qN)\n            \n            # Compute and wrap phase error\n            delta_phi = phi_num - phi_exact\n            wrapped_delta_phi = (delta_phi + np.pi) % (2 * np.pi) - np.pi\n            phase_error = np.abs(wrapped_delta_phi)\n            \n            # Compute amplitude ratio\n            rN = np.linalg.norm(np.array([qN, pN]))\n            amplitude_ratio = rN / r0\n            \n            return phase_error, amplitude_ratio\n\n        # 5. Calculate metrics for each method\n        phase_error_heun, amp_ratio_heun = calculate_metrics(qN_heun, pN_heun)\n        phase_error_se, amp_ratio_se = calculate_metrics(qN_se, pN_se)\n        \n        # 6. Compare phase errors\n        heun_phase_worse = phase_error_heun > phase_error_se\n        \n        # 7. Collect and format results for the current test case\n        case_results = [\n            phase_error_heun,\n            phase_error_se,\n            amp_ratio_heun,\n            amp_ratio_se,\n            heun_phase_worse,\n        ]\n        all_results.append(case_results)\n\n    # 8. Format the final output string exactly as required\n    results_str_list = []\n    for res in all_results:\n        s = (f\"[{res[0]:.6f},{res[1]:.6f},\"\n             f\"{res[2]:.6f},{res[3]:.6f},\"\n             f\"{str(res[4]).lower()}]\")\n        results_str_list.append(s)\n    \n    final_output = f\"[{','.join(results_str_list)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "3235506"}, {"introduction": "我们已经看到，即使是一阶辛积分器也能提供出色的长期特性。那么，我们如何在保持这种几何结构的同时，构建出更精确的方法呢？本练习将深入探讨对称组合这一优雅而强大的技术，它是现代几何积分器设计的基石。你将推导所需满足的条件，通过将一个二阶积分器自身进行组合来创建一个四阶方法，从而揭示如何利用简单的构建模块来构造高度复杂的算法 [@problem_id:3235366]。", "problem": "考虑一个可分哈密顿系统，其哈密顿量为 $H(q,p)=T(p)+V(q)$，其中 $T$ 仅依赖于动量 $p$，$V$ 仅依赖于位置 $q$。令 $\\mathcal{L}_{T}$ 和 $\\mathcal{L}_{V}$ 分别表示生成 $T$ 和 $V$ 的精确流的哈密顿（刘维尔）算子，因此 $H$ 的精确时间-$h$ 流为 $\\exp\\!\\big(h(\\mathcal{L}_{T}+\\mathcal{L}_{V})\\big)$。标准的二阶对称分裂（蛙跳法，也称速度 Verlet 法）为\n$$\nS_{2}(h) \\;=\\; \\exp\\!\\left(\\tfrac{h}{2}\\mathcal{L}_{T}\\right)\\,\\exp\\!\\left(h\\,\\mathcal{L}_{V}\\right)\\,\\exp\\!\\left(\\tfrac{h}{2}\\mathcal{L}_{T}\\right).\n$$\n令 $\\operatorname{BCH}$ 表示 Baker–Campbell–Hausdorff 公式，该公式将非对易算子的指数乘积表示为一系列嵌套对易子的单个指数。根据 $S_{2}$ 的对称性，其指数中的局部误差展开仅包含 $h$ 的奇数次幂；特别地，存在一个算子 $\\mathcal{E}_{3}$，它是 $\\mathcal{L}_{T}$ 和 $\\mathcal{L}_{V}$ 的嵌套对易子的固定线性组合，使得\n$$\nS_{2}(h) \\;=\\; \\exp\\!\\left(h(\\mathcal{L}_{T}+\\mathcal{L}_{V}) \\;+\\; h^{3}\\,\\mathcal{E}_{3} \\;+\\; \\mathcal{O}(h^{5})\\right).\n$$\n考虑 $S_{2}$ 使用缩放步长的对称三重复合，\n$$\nS_{4}(h) \\;=\\; S_{2}(\\gamma_{1}h)\\,S_{2}(\\gamma_{2}h)\\,S_{2}(\\gamma_{1}h),\n$$\n其中 $\\gamma_{1}$ 和 $\\gamma_{2}$ 是待定的实系数。仅使用上述事实，推导为使 $S_{4}(h)$ 达到四阶所需要的关于 $\\gamma_{1}$ 和 $\\gamma_{2}$ 的阶条件，即\n$$\nS_{4}(h) \\;=\\; \\exp\\!\\left(h(\\mathcal{L}_{T}+\\mathcal{L}_{V}) \\;+\\; \\mathcal{O}(h^{5})\\right).\n$$\n求解这些条件，以获得 $\\gamma_{1}$ 和 $\\gamma_{2}$ 的精确闭式解。\n\n答案要求：\n- 以有序复合系数向量 $(\\gamma_{1},\\gamma_{2},\\gamma_{1})$ 的精确解析形式提供最终答案。\n- 不要近似或四舍五入；给出精确表达式。\n- 无需物理单位。", "solution": "我们从可分哈密顿量 $H(q,p)=T(p)+V(q)$ 出发，其流由哈密顿（刘维尔）算子 $\\mathcal{L}_{T}$ 和 $\\mathcal{L}_{V}$ 生成，因此精确时间-$h$ 流为 $\\exp\\!\\big(h(\\mathcal{L}_{T}+\\mathcal{L}_{V})\\big)$。蛙跳法（速度 Verlet 法）是二阶对称分裂格式\n$$\nS_{2}(h) \\;=\\; \\exp\\!\\left(\\tfrac{h}{2}\\mathcal{L}_{T}\\right)\\,\\exp\\!\\left(h\\,\\mathcal{L}_{V}\\right)\\,\\exp\\!\\left(\\tfrac{h}{2}\\mathcal{L}_{T}\\right).\n$$\n根据 Baker–Campbell–Hausdorff (BCH) 公式，由于 $S_{2}$ 是对称的，其单指数表示的指数中只包含 $h$ 的奇数次幂。因此，可以写出\n$$\nS_{2}(h) \\;=\\; \\exp\\!\\left(h(\\mathcal{L}_{T}+\\mathcal{L}_{V}) \\;+\\; h^{3}\\,\\mathcal{E}_{3} \\;+\\; \\mathcal{O}(h^{5})\\right),\n$$\n其中 $\\mathcal{E}_{3}$ 是 $\\mathcal{L}_{T}$ 和 $\\mathcal{L}_{V}$ 的嵌套对易子的一个固定线性组合（例如，$[\\mathcal{L}_{T},[\\mathcal{L}_{T},\\mathcal{L}_{V}]]$ 和 $[\\mathcal{L}_{V},[\\mathcal{L}_{T},\\mathcal{L}_{V}]]$ 的组合），且与 $h$ 无关。\n\n我们现在考虑对称复合\n$$\nS_{4}(h) \\;=\\; S_{2}(\\gamma_{1}h)\\,S_{2}(\\gamma_{2}h)\\,S_{2}(\\gamma_{1}h),\n$$\n并使用 BCH 公式来推导其有效指数。对于每个因子，\n$$\nS_{2}(\\gamma h) \\;=\\; \\exp\\!\\left(\\gamma h(\\mathcal{L}_{T}+\\mathcal{L}_{V}) \\;+\\; (\\gamma h)^{3}\\,\\mathcal{E}_{3} \\;+\\; \\mathcal{O}(h^{5})\\right).\n$$\n我们记 $\\mathcal{X}=\\mathcal{L}_{T}+\\mathcal{L}_{V}$ 和 $\\mathcal{Y}=\\mathcal{E}_{3}$。则\n$$\nS_{2}(\\gamma h) \\;=\\; \\exp\\!\\left(\\gamma h\\,\\mathcal{X} \\;+\\; \\gamma^{3} h^{3}\\,\\mathcal{Y} \\;+\\; \\mathcal{O}(h^{5})\\right).\n$$\n我们构造乘积\n$$\nS_{4}(h) \\;=\\; \\exp\\!\\left(\\gamma_{1} h\\,\\mathcal{X} + \\gamma_{1}^{3} h^{3}\\,\\mathcal{Y} + \\mathcal{O}(h^{5})\\right)\\,\n\\exp\\!\\left(\\gamma_{2} h\\,\\mathcal{X} + \\gamma_{2}^{3} h^{3}\\,\\mathcal{Y} + \\mathcal{O}(h^{5})\\right)\\,\n\\exp\\!\\left(\\gamma_{1} h\\,\\mathcal{X} + \\gamma_{1}^{3} h^{3}\\,\\mathcal{Y} + \\mathcal{O}(h^{5})\\right).\n$$\n迭代应用 BCH 公式并保留最终指数中最高到 $h^{3}$ 阶的项，我们观察到以下几点：\n- 指数中 $h$ 阶的主项就是各项 $h$ 阶项之和，因为 $\\mathcal{X}$ 与自身的对易子为零，而作用于 $\\mathcal{Y}$ 的对易子会使阶数超过 $h^{3}$。因此，$h$ 阶项为\n$$\n\\big(2\\gamma_{1} + \\gamma_{2}\\big)\\,h\\,\\mathcal{X}.\n$$\n- 指数中的 $h^{3}$ 阶项从每个因子中线性累加为 $\\big(2\\gamma_{1}^{3} + \\gamma_{2}^{3}\\big)\\,h^{3}\\,\\mathcal{Y}$，因为由 BCH 组合产生的额外对易子要么至少包含一个 $\\mathcal{X}$ 因子（由于对称性，产生 $h^{4}$ 及更高阶项），要么因对称性而抵消。\n\n因此，到 $h^{3}$ 阶为止，复合方法的指数为\n$$\n\\big(2\\gamma_{1} + \\gamma_{2}\\big)\\,h\\,\\mathcal{X} \\;+\\; \\big(2\\gamma_{1}^{3} + \\gamma_{2}^{3}\\big)\\,h^{3}\\,\\mathcal{Y} \\;+\\; \\mathcal{O}(h^{5}).\n$$\n为了使该复合方法与精确流 $\\exp(h\\mathcal{X})$ 在阶数上匹配到 $h^{4}$（包含 $h^{4}$），阶条件为：\n- $h$ 阶的相容性：\n$$\n2\\gamma_{1} + \\gamma_{2} \\;=\\; 1.\n$$\n- $h^{3}$ 阶误差的消除：\n$$\n2\\gamma_{1}^{3} + \\gamma_{2}^{3} \\;=\\; 0.\n$$\n\n我们现在求解该方程组\n$$\n2\\gamma_{1} + \\gamma_{2} \\;=\\; 1, \\qquad 2\\gamma_{1}^{3} + \\gamma_{2}^{3} \\;=\\; 0.\n$$\n从第一个方程中解出 $\\gamma_{2} = 1 - 2\\gamma_{1}$ 并代入第二个方程：\n$$\n2\\gamma_{1}^{3} + (1 - 2\\gamma_{1})^{3} \\;=\\; 0.\n$$\n展开得\n$$\n2\\gamma_{1}^{3} + \\big(1 - 6\\gamma_{1} + 12\\gamma_{1}^{2} - 8\\gamma_{1}^{3}\\big) \\;=\\; 0,\n$$\n所以\n$$\n1 - 6\\gamma_{1} + 12\\gamma_{1}^{2} - 6\\gamma_{1}^{3} \\;=\\; 0.\n$$\n令 $\\alpha = \\gamma_{1}$。通过引入 $\\beta = 2^{1/3}$ 并识别出二阶方法对称复合的已知解结构，可以解出这个三次方程。一个精确的实数解是\n$$\n\\gamma_{1} \\;=\\; \\frac{1}{\\,2 - 2^{1/3}\\,}.\n$$\n利用 $\\gamma_{2} = 1 - 2\\gamma_{1}$，我们得到\n$$\n\\gamma_{2} \\;=\\; 1 - \\frac{2}{\\,2 - 2^{1/3}\\,} \\;=\\; -\\,\\frac{2^{1/3}}{\\,2 - 2^{1/3}\\,}.\n$$\n直接检验可验证阶条件：\n$$\n2\\gamma_{1} + \\gamma_{2} \\;=\\; \\frac{2}{\\,2 - 2^{1/3}\\,} - \\frac{2^{1/3}}{\\,2 - 2^{1/3}\\,} \\;=\\; \\frac{2 - 2^{1/3}}{\\,2 - 2^{1/3}\\,} \\;=\\; 1,\n$$\n以及\n$$\n2\\gamma_{1}^{3} + \\gamma_{2}^{3} \\;=\\; \\frac{2}{\\,(2 - 2^{1/3})^{3}\\,} + \\frac{\\big(-2^{1/3}\\big)^{3}}{\\,(2 - 2^{1/3})^{3}\\,} \\;=\\; \\frac{2 - 2}{\\,(2 - 2^{1/3})^{3}\\,} \\;=\\; 0.\n$$\n因此，对称复合\n$$\nS_{4}(h) \\;=\\; S_{2}\\!\\left(\\frac{h}{\\,2 - 2^{1/3}\\,}\\right)\\,S_{2}\\!\\left(-\\,\\frac{2^{1/3}h}{\\,2 - 2^{1/3}\\,}\\right)\\,S_{2}\\!\\left(\\frac{h}{\\,2 - 2^{1/3}\\,}\\right)\n$$\n是一个四阶辛积分器，它是通过蛙跳法的对称复合构造的，其系数通常归功于 Forest–Ruth 和 Yoshida。\n\n所要求的有序复合系数向量 $(\\gamma_{1},\\gamma_{2},\\gamma_{1})$ 的精确形式因此为\n$$\n\\left(\\,\\frac{1}{\\,2 - 2^{1/3}\\,},\\;\\; -\\,\\frac{2^{1/3}}{\\,2 - 2^{1/3}\\,},\\;\\; \\frac{1}{\\,2 - 2^{1/3}\\,}\\,\\right).\n$$", "answer": "$$\\boxed{\\begin{pmatrix}\\dfrac{1}{\\,2 - 2^{1/3}\\,} & -\\,\\dfrac{2^{1/3}}{\\,2 - 2^{1/3}\\,} & \\dfrac{1}{\\,2 - 2^{1/3}\\,}\\end{pmatrix}}$$", "id": "3235366"}]}