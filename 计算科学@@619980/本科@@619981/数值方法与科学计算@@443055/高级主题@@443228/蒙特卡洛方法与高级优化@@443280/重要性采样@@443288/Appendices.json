{"hands_on_practices": [{"introduction": "在使用重要性抽样时，一个关键步骤是评估其性能，而估计量的方差是衡量其效率的主要指标。本练习将引导你应用重要性抽样估计量方差的基本公式，通过一个具体案例来计算其方差。通过解决这个问题 [@problem_id:767801]，你将获得计算方差的实践经验，并直观地理解提议分布的选择（特别是其方差 $\\sigma_q^2$）如何直接影响估计的精度。", "problem": "重要性采样是一种方差缩减技术，用于蒙特卡洛方法中，通过从一个不同的分布中采样来估计特定分布的性质。考虑估计期望 $I = E_p[h(x)]$ 的问题，其中 $p(x)$ 是目标概率密度函数 (PDF)，而 $h(x)$ 是我们感兴趣的函数。我们不从 $p(x)$ 中抽取样本，而是从一个提议分布 $q(x)$ 中抽取 $N$ 个样本 $\\{x_i\\}_{i=1}^N$。然后使用重要性采样估计量来估计该期望：\n$$\n\\hat{I}_N = \\frac{1}{N} \\sum_{i=1}^N w(x_i) h(x_i)\n$$\n其中 $w(x) = \\frac{p(x)}{q(x)}$ 是重要性权重。该估计量是无偏的，即 $E_q[\\hat{I}_N] = I$。单个样本 ($N=1$) 的估计量的方差由 $\\text{Var}_q(w(X)h(X))$ 给出，其中 $X \\sim q(x)$。\n\n**问题：**\n设目标分布 $p(x)$ 为标准正态分布 $\\mathcal{N}(x|0, 1)$，其概率密度函数为 $p(x) = \\frac{1}{\\sqrt{2\\pi}} e^{-x^2/2}$。我们希望估计该分布的四阶矩，对应于函数 $h(x) = x^4$。\n\n提议分布 $q(x)$ 被选为一个具有不同方差 $\\sigma_q^2$ 的零均值正态分布，即 $q(x) = \\mathcal{N}(x|0, \\sigma_q^2)$，其概率密度函数为 $q(x) = \\frac{1}{\\sqrt{2\\pi}\\sigma_q} e^{-x^2/(2\\sigma_q^2)}$。\n\n推导单样本重要性采样估计量的方差 $\\text{Var}_q(w(X)h(X))$ 作为 $\\sigma_q$ 的函数的闭式表达式。您可以假设方差是有限的，这在 $\\sigma_q^2 > 1/2$ 时成立。", "solution": "1. 方差为  \n$$\n\\mathrm{Var}_q\\bigl(w(X)h(X)\\bigr)\n=E_q\\bigl[(w(X)h(X))^2\\bigr]-\\bigl(E_q[w(X)h(X)]\\bigr)^2.\n$$\n由于 $h(x)=x^4$，$w(x)=\\frac{p(x)}{q(x)}$，且 $E_p[x^4]=3$，我们有 $\\bigl(E_q[w(X)h(X)]\\bigr)^2 = (E_p[h(X)])^2 = 3^2=9$。我们需要计算第一项： \n$$\nE_q\\bigl[(w(X)x^4)^2\\bigr]\n=\\int q(x)\\Bigl(\\frac{p(x)}{q(x)}\\Bigr)^2 x^8\\,dx\n=\\int \\frac{p(x)^2}{q(x)}\\,x^8\\,dx.\n$$\n\n2. 代入高斯密度函数：\n$$\np(x)=\\frac{1}{\\sqrt{2\\pi}}e^{-x^2/2},\\quad\nq(x)=\\frac{1}{\\sqrt{2\\pi}\\,\\sigma_q}e^{-x^2/(2\\sigma_q^2)}.\n$$\n则\n$$\n\\frac{p(x)^2}{q(x)}\n=\\frac{\\frac1{2\\pi}e^{-x^2}}{\\frac1{\\sqrt{2\\pi}\\,\\sigma_q}e^{-x^2/(2\\sigma_q^2)}}\n=\\frac{\\sigma_q}{\\sqrt{2\\pi}}\\,e^{-x^2\\bigl(1-\\tfrac1{2\\sigma_q^2}\\bigr)}.\n$$\n\n3. 积分项变为 $\\frac{\\sigma_q}{\\sqrt{2\\pi}}\\int_{-\\infty}^{\\infty}x^8 e^{-a x^2}dx$，其中 $a=1-\\frac1{2\\sigma_q^2}=\\frac{2\\sigma_q^2-1}{2\\sigma_q^2}$。利用高斯积分公式 $\\int_{-\\infty}^{\\infty}x^{2n}e^{-a x^2}dx = \\frac{(2n-1)!!}{(2a)^n}\\sqrt{\\frac{\\pi}{a}}$，对于 $n=4$：\n$$\n\\int_{-\\infty}^{\\infty}x^8e^{-a x^2}dx\n=\\frac{7!!}{2^4 a^4}\\sqrt{\\frac{\\pi}{a}}\n=\\frac{105\\sqrt\\pi}{16\\,a^{9/2}}.\n$$\n因此\n$$\nE_q\\bigl[(w(X)x^4)^2\\bigr]\n=\\frac{\\sigma_q}{\\sqrt{2\\pi}}\\cdot\\frac{105\\sqrt\\pi}{16\\,a^{9/2}}\n=\\frac{105\\,\\sigma_q}{16\\sqrt2\\,a^{9/2}}\n=\\frac{105\\,\\sigma_q}{16\\sqrt2}\\left(\\frac{2\\sigma_q^2-1}{2\\sigma_q^2}\\right)^{-9/2}\n=\\frac{105\\,\\sigma_q^{10}}{(2\\sigma_q^2-1)^{9/2}}.\n$$\n\n4. 综上所述，方差为：\n$$\n\\mathrm{Var}_q(w(X)x^4)\n=\\frac{105\\,\\sigma_q^{10}}{(2\\sigma_q^2-1)^{9/2}}-9.\n$$", "answer": "$$\\boxed{\\frac{105\\,\\sigma_q^{10}}{(2\\sigma_q^2-1)^{9/2}}-9}$$", "id": "767801"}, {"introduction": "在学会如何分析一个标准的估计量之后，理解重要性抽样在何种情况下会失效以及其背后的原因至关重要。这个练习探讨了一个经典场景：一个看似合理的提议分布（均匀分布）却导致了一个方差无穷大的估计量。通过深入分析这个问题 [@problem_id:3241984]，你将认识到，一个可靠的重要性抽样方案要求提议分布的“尾部”必须比目标被积函数更“重”，这是一个在实践中必须牢记的核心原则。", "problem": "考虑使用重要性采样（IS）估计积分 $$I=\\int_{-1}^{1}\\frac{1}{\\sqrt{1-x^{2}}}\\,dx$$，其中提议密度在区间 $$[-1,1]$$上是均匀分布的，即当 $$x\\in[-1,1]$$ 时 $$q(x)=\\frac{1}{2}$$，否则 $$q(x)=0$$。与样本 $$X\\sim q$$ 相关的重要性采样权重定义为 $$W=\\frac{f(X)}{q(X)}$$，其中 $$f(x)=\\frac{1}{\\sqrt{1-x^{2}}}$$。\n\n从重要性采样的基本定义和可积奇点的性质出发，进行以下分析以评估估计量的可靠性：\n- 显式地导出作为 $$X$$ 函数的重要性采样权重 $$W$$，并分析其在端点 $$x=\\pm 1$$ 附近的行为。\n- 使用提议分布下二阶矩的定义，确定 $$\\int_{-1}^{1}\\frac{f(x)^{2}}{q(x)}\\,dx$$ 是有限还是无限，并通过一个不依赖于启发式捷径的原则性论证来证明你的结论。\n- 为了量化 $$X\\sim q$$ 条件下 $$W$$ 的尾部厚重程度，确定当 $$t\\to\\infty$$ 时尾部概率 $$\\mathbb{P}(Wt)$$ 的精确领先阶渐近衰减。特别地，推导当 $$t\\to\\infty$$ 时渐近式 $$\\mathbb{P}(Wt)\\sim c\\,t^{-2}$$ 中的精确常数 $$c$$。\n\n从第一性原理出发，给出完整的推导过程。你最终报告的答案必须是单个常数 $$c$$（无中间量），以精确形式写出。不需要四舍五入，也不涉及单位。", "solution": "1.  首先，推导重要性权重 $W(x)$。对于 $x \\in (-1, 1)$：\n    $$W(x) = \\frac{f(x)}{q(x)} = \\frac{1/\\sqrt{1-x^2}}{1/2} = \\frac{2}{\\sqrt{1-x^2}}$$\n    要确定估计量的可靠性，我们检查其方差，这需要计算权重的二阶矩 $\\mathbb{E}_q[W^2]$：\n    $$\\mathbb{E}_q[W^2] = \\int_{-1}^{1} W(x)^2 q(x) \\, dx = \\int_{-1}^{1} \\left(\\frac{2}{\\sqrt{1-x^2}}\\right)^2 \\frac{1}{2} \\, dx = \\int_{-1}^{1} \\frac{2}{1-x^2} \\, dx$$\n    这是一个瑕积分，由于其不定积分 $\\ln\\left|\\frac{1+x}{1-x}\\right|$ 在 $x = \\pm 1$ 处发散，该积分值为无穷大。因此，估计量的方差是无限的。\n\n2.  接下来，我们推导尾部概率 $\\mathbb{P}(W > t)$ 的渐近行为，其中 $X \\sim \\text{Uniform}[-1, 1]$。\n    事件 $W > t$ 等价于：\n    $$\\frac{2}{\\sqrt{1-X^2}} > t \\implies \\sqrt{1-X^2}  \\frac{2}{t} \\implies X^2 > 1 - \\frac{4}{t^2}$$\n    对于足够大的 $t$（即 $t>2$），这意味着 $|X| > \\sqrt{1 - 4/t^2}$。\n    由于 $X$ 在 $[-1, 1]$ 上均匀分布，事件 $|X| > a$ 的概率为 $1-a$ (对于 $0  a  1$)。因此：\n    $$\\mathbb{P}(W > t) = 1 - \\sqrt{1 - \\frac{4}{t^2}}$$\n    当 $t \\to \\infty$ 时，$4/t^2 \\to 0$。使用泰勒展开 $\\sqrt{1-u} \\approx 1 - u/2$ (当 $u \\to 0$ 时)：\n    $$\\mathbb{P}(W > t) \\approx 1 - \\left(1 - \\frac{1}{2} \\cdot \\frac{4}{t^2}\\right) = \\frac{2}{t^2}$$\n    因此，当 $t \\to \\infty$ 时，$\\mathbb{P}(W>t) \\sim 2t^{-2}$，可得常数 $c=2$。", "answer": "$$\\boxed{2}$$", "id": "3241984"}, {"introduction": "在见证了重要性抽样的标准应用和严重失效的案例后，我们转向一种更高级的、系统性的方法来设计高效的重要性抽样估计量，这对于估计罕见事件概率等挑战性问题尤为重要。本练习介绍了指数倾斜（exponential tilting）技术，并利用大偏差理论来推导最优的倾斜参数。通过解决这个高级问题 [@problem_id:3241853]，你将学习如何将深刻的概率理论（如 Cramér 定理）与蒙特卡洛方法的实际设计相结合，从而构建出渐近最优的估计方案。", "problem": "设 $X_{1}, X_{2}, \\dots, X_{n}$ 是独立同分布的随机变量，且 $X_{i} \\sim \\text{Exp}(1)$，并定义部分和 $S_{n} = \\sum_{i=1}^{n} X_{i}$。考虑稀有事件概率 $\\mathbb{P}(S_{n}  c)$，其中 $c  n$ 是一个固定的阈值。为了高效地估计此概率，使用重要性采样方法，并进行指数倾斜的测度变换：对于参数 $\\theta  1$，在新的密度函数 $f_{\\theta}(x)$ 下对每个 $X_{i}$ 进行抽样，该密度函数与原始 $\\text{Exp}(1)$ 密度乘以 $\\exp(\\theta x)$ 成正比，并通过适当的似然比对样本进行加权，以构成 $\\mathbb{P}(S_{n}  c)$ 的无偏估计量。\n\n从以下基础出发：\n- 对于 $X \\sim \\text{Exp}(1)$，其矩生成函数 $M_{X}(\\theta) = \\mathbb{E}[\\exp(\\theta X)]$ 和累积量生成函数 $\\Lambda(\\theta) = \\ln M_{X}(\\theta)$，\n- 样本均值 $\\bar{X}_{n} = S_{n}/n$ 的 Cramér 大偏差原理，及其优良速率函数 $I(x) = \\sup_{\\theta  1} \\{\\theta x - \\Lambda(\\theta)\\}$，\n- 独立同分布和的 Esscher（指数）测度变换，\n\n请从第一性原理出发，不使用任何预先给出的捷径，根据大偏差理论，推导出当 $n \\to \\infty$ 时，能渐近最小化 $\\mathbb{P}(S_{n}  c)$ 的重要性采样估计量方差的指数倾斜参数 $\\theta^{\\star}$ 的选择。将最终答案表示为关于 $n$ 和 $c$ 的闭式解析表达式。不需要进行数值近似或四舍五入。", "solution": "我们的目标是确定一个指数倾斜参数，该参数能为估计稀有事件概率 $\\mathbb{P}(S_{n}  c)$（其中 $c  n$）提供一个渐近最优的重要性采样（IS）方案。推导过程从矩生成函数（MGF）、累积量生成函数（CGF）和 Cramér 大偏差原理的定义出发。\n\n首先，回顾对于 $X \\sim \\text{Exp}(1)$，其概率密度函数为 $f(x) = \\exp(-x)$（$x \\ge 0$）。矩生成函数 $M_{X}(\\theta)$ 和累积量生成函数 $\\Lambda(\\theta)$ 分别为\n$$\nM_{X}(\\theta) = \\mathbb{E}[\\exp(\\theta X)] = \\int_{0}^{\\infty} \\exp(\\theta x) \\exp(-x)\\, dx = \\frac{1}{1 - \\theta}, \\quad \\theta  1,\n$$\n$$\n\\Lambda(\\theta) = \\ln M_{X}(\\theta) = -\\ln(1 - \\theta), \\quad \\theta  1.\n$$\n\n在参数为 $\\theta$ 的指数倾斜下，$X$ 的新密度是 Esscher 变换\n$$\nf_{\\theta}(x) = \\exp\\big(\\theta x - \\Lambda(\\theta)\\big) f(x) = \\exp\\big(\\theta x + \\ln(1-\\theta)\\big) \\exp(-x) = (1-\\theta)\\,\\exp\\big(-(1-\\theta) x\\big),\n$$\n这是率（rate）为 $1 - \\theta$ 的指数分布的密度（因此倾斜后的 $X$ 的均值为 $1/(1-\\theta)$）。在此测度变换下，从 $f_{\\theta}$ 中独立抽取 $X_{1},\\dots,X_{n}$，得到的 $S_{n}$ 的分布是 $n$ 个率（rate）为 $1-\\theta$ 的独立指数分布之和，即形状参数为 $n$、率参数为 $1-\\theta$ 的伽马分布。\n\n使用此倾斜的 $\\mathbb{P}(S_{n}  c)$ 的重要性采样估计量是\n$$\n\\hat{p} = \\exp\\big(-n \\Lambda(\\theta)\\big) \\exp\\big(\\theta S_{n}\\big)\\,\\mathbf{1}\\{S_{n}  c\\},\n$$\n其中，对于一个路径 $\\{X_{i}\\}$ 的似然比等于 $\\prod_{i=1}^{n} \\exp(\\theta X_{i} - \\Lambda(\\theta)) = \\exp(\\theta S_{n} - n \\Lambda(\\theta))$。\n\n为了在 $n \\to \\infty$ 时渐近最小化 $\\hat{p}$ 的方差（等价于其二阶矩），我们使用大偏差理论。令 $\\bar{X}_{n} = S_{n}/n$。根据适用于具有共同 CGF $\\Lambda(\\theta)$ 的独立同分布随机变量的 Cramér 定理，样本均值满足一个大偏差原理（LDP），其优良凸速率函数由 Legendre 变换给出\n$$\nI(x) = \\sup_{\\theta  1}\\{\\theta x - \\Lambda(\\theta)\\}.\n$$\n对于此处考虑的指数分布，该速率函数可以显式计算，但我们只需要其变分特征。\n\n通过指数倾斜进行方差缩减的指导原则是，最优倾斜将新测度下的典型值与稀有事件的阈值对齐。形式上，渐近最小化 $\\hat{p}$ 二阶矩的 Esscher 倾斜，对应于选择在点 $x = c/n$ 处能最大化速率函数中变分表达式的倾斜参数。这是在 $x = c/n$ 处 Legendre 变换的最优解，它由一阶条件刻画\n$$\n\\Lambda'(\\theta^{\\star}) = x,\n$$\n在 $x = c/n$ 处求值。这个条件的出现是因为，当 $\\Lambda$ 是严格凸时，对于固定的 $x$，函数 $\\theta \\mapsto \\theta x - \\Lambda(\\theta)$ 在 $\\theta$ 上是严格凹的，并且其最大化者满足导数条件 $x - \\Lambda'(\\theta) = 0$。\n\n我们计算 $\\Lambda'(\\theta)$：\n$$\n\\Lambda(\\theta) = -\\ln(1-\\theta) \\quad \\Rightarrow \\quad \\Lambda'(\\theta) = \\frac{1}{1 - \\theta}.\n$$\n令 $\\Lambda'(\\theta^{\\star}) = c/n$ 可得\n$$\n\\frac{1}{1 - \\theta^{\\star}} = \\frac{c}{n}\n\\quad \\Rightarrow \\quad \n1 - \\theta^{\\star} = \\frac{n}{c}\n\\quad \\Rightarrow \\quad \n\\theta^{\\star} = 1 - \\frac{n}{c}.\n$$\n因为 $c  n$，我们有 $\\theta^{\\star} \\in (0, 1)$，这对于 Esscher 倾斜是允许的。解释这个选择：在最优倾斜下，每个倾斜后的 $X_{i}$ 的均值是\n$$\n\\mathbb{E}_{\\theta^{\\star}}[X_{i}] = \\frac{1}{1 - \\theta^{\\star}} = \\frac{c}{n},\n$$\n因此，在倾斜测度下，样本均值 $\\bar{X}_{n}$ 的典型值等于稀有事件阈值 $c/n$。根据大偏差原理和 Legendre 变换的凸对偶结构，这种对齐确保了该重要性采样方案在所有指数倾斜中能渐近地最小化估计量的方差。\n\n因此，从大偏差考虑推导出的最优指数倾斜参数是\n$$\n\\theta^{\\star} = 1 - \\frac{n}{c}.\n$$", "answer": "$$\\boxed{1 - \\frac{n}{c}}$$", "id": "3241853"}]}