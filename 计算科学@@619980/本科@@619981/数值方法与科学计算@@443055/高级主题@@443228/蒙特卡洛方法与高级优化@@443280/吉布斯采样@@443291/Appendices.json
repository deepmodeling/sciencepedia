{"hands_on_practices": [{"introduction": "要真正掌握吉布斯采样，我们必须从其基本机制入手。第一个练习提供了一个具体的分步操作，用于执行采样器的一次完整迭代，即从一个状态转移到下一个状态。通过亲手操作连续和离散变量的采样过程，您将巩固对如何利用条件分布在复杂联合概率空间中进行探索的理解 [@problem_id:1920320]。", "problem": "考虑一个二维随机向量 $(X, Y)$，其联合概率分布由以下全条件分布定义：\n- 给定 $Y=y$ 时，$X$ 的条件分布是速率参数为 $y$ 的指数分布。其概率密度函数为 $p(x|y) = y \\exp(-yx)$，其中 $x > 0$。\n- 给定 $X=x$ 时，$Y$ 的条件分布是均值参数为 $x$ 的泊松分布。其概率质量函数为 $p(y=k|x) = \\frac{x^k \\exp(-x)}{k!}$，其中 $k \\in \\{0, 1, 2, \\dots\\}$。\n\n你的任务是执行一次完整的 Gibbs 采样器迭代。从初始状态 $(x^{(0)}, y^{(0)}) = (2, 3)$ 开始，你将生成一个新状态 $(x^{(1)}, y^{(1)})$。迭代过程如下：首先，从分布 $p(x|y^{(0)})$ 中为 $x^{(1)}$ 抽取一个样本；然后，使用这个新值 $x^{(1)}$，从分布 $p(y|x^{(1)})$ 中为 $y^{(1)}$ 抽取一个样本。\n\n为了生成所需的随机变量，你必须使用逆变换采样法。请使用以下从 Uniform(0,1) 分布中抽取的随机数：\n- 生成 $x^{(1)}$ 时，使用均匀随机数 $u_x = 0.600$。\n- 生成 $y^{(1)}$ 时，使用均匀随机数 $u_y = 0.750$。\n\n新状态 $(x^{(1)}, y^{(1)})$ 的数值是多少？$x^{(1)}$ 的值必须四舍五入到四位有效数字。", "solution": "我们使用逆变换采样法执行一次 Gibbs 更新。\n\n1) 从 $p(x \\mid y^{(0)}=3)$ 中采样 $x^{(1)}$。\n对于速率为 $y$ 的指数分布，其条件累积分布函数 (CDF) 为\n$$\nF(x \\mid y)=1-\\exp(-yx), \\quad x>0.\n$$\n逆变换采样使用 $u_{x}=F(x \\mid y)$，因此\n$$\nx^{(1)}=F^{-1}(u_{x})=-\\frac{1}{y^{(0)}}\\ln\\!\\bigl(1-u_{x}\\bigr).\n$$\n当 $y^{(0)}=3$ 且 $u_{x}=0.600$ 时，\n$$\nx^{(1)}=-\\frac{1}{3}\\ln(1-0.600)=-\\frac{1}{3}\\ln(0.4)=\\frac{1}{3}\\ln(2.5)\\approx 0.3054302439.\n$$\n四舍五入到四位有效数字：$x^{(1)}=0.3054$。\n\n2) 使用 $u_{y}=0.750$ 从 $p(y \\mid x^{(1)})$ 中采样 $y^{(1)}$。\n对于均值为 $x$ 的泊松分布，其概率质量函数 (pmf) 为\n$$\np(y=k \\mid x)=\\frac{x^{k}\\exp(-x)}{k!}, \\quad k\\in\\{0,1,2,\\dots\\}.\n$$\n对于离散分布，逆变换采样选择满足 $F(k \\mid x)=\\sum_{j=0}^{k}p(j \\mid x)\\ge u_{y}$ 的最小 $k$。\n\n当 $x=x^{(1)}=\\frac{1}{3}\\ln(2.5)$ 时，计算\n$$\np(0 \\mid x)=\\exp(-x)=\\exp\\!\\Bigl(-\\tfrac{1}{3}\\ln(2.5)\\Bigr)=2.5^{-1/3}\\approx 0.7368.\n$$\n由于 $p(0 \\mid x) \\approx 0.7368  0.750$，继续计算 $k=1$ 的情况：\n$$\np(1 \\mid x)=x\\exp(-x)=x\\,2.5^{-1/3}\\approx 0.30543\\times 0.7368\\approx 0.2250.\n$$\n然后\n$$\nF(1 \\mid x)=p(0 \\mid x)+p(1 \\mid x)\\approx 0.7368+0.2250=0.96180.750,\n$$\n因此，满足 $F(k \\mid x)\\ge 0.750$ 的最小 $k$ 是 $k=1$。所以 $y^{(1)}=1$。\n\n因此，新状态为 $(x^{(1)},y^{(1)})=(0.3054,1)$，其中 $x^{(1)}$ 已四舍五入到四位有效数字。", "answer": "$$\\boxed{\\begin{pmatrix}0.3054  1\\end{pmatrix}}$$", "id": "1920320"}, {"introduction": "吉布斯采样虽然功能强大，但也并非没有挑战。本练习探讨了其最常见的陷阱之一：当变量高度相关时，采样器的混合速度会非常缓慢。通过一个制造业中的假设情景，您将观察到采样器如何仅取得微小的进展，这凸显了在实际应用中诊断 MCMC 链收敛性的重要性 [@problem_id:1363745]。", "problem": "在一个用于光学元件的高精度制造过程中，镜片的两个几何参数 $x_1$ 和 $x_2$ 对其性能至关重要。这些参数代表了与理想设计规格的归一化偏差。由于制造过程的物理原理，这些参数不是独立的。对生产数据的分析表明，它们的联合概率分布可以通过一个未归一化的密度函数 $f(x_1, x_2)$ 来建模，其形式如下：\n$$f(x_1, x_2) \\propto \\exp \\left( -\\frac{1}{2(1-\\rho^2)} (x_1^2 - 2\\rho x_1 x_2 + x_2^2) \\right)$$\n对于这个特定的过程，发现相关系数为 $\\rho = 0.99$。该分布的众数位于 $(0, 0)$，这对应于一个完美的元件。\n\n为了模拟过程中的变异，要求您使用 Gibbs 抽样器。您从初始状态 $(x_1^{(0)}, x_2^{(0)}) = (-4.0, -4.1)$ 开始，这代表一个处于可接受质量范围边缘的元件。\n\n您的任务是确定经过两次完整迭代后抽样器的状态 $(x_1^{(2)}, x_2^{(2)})$。一次完整迭代包括先更新 $x_1$，然后更新 $x_2$。为了使计算具有确定性，您必须假设在每个抽样步骤中，为变量抽取的新值等于其条件分布的均值。\n\n计算状态 $(x_1^{(2)}, x_2^{(2)})$ 的坐标。在您的最终答案中报告这两个坐标，并四舍五入到四位有效数字。", "solution": "我们识别出给定的未归一化联合密度\n$$\nf(x_{1},x_{2}) \\propto \\exp\\left(-\\frac{1}{2(1-\\rho^{2})}\\left(x_{1}^{2}-2\\rho x_{1}x_{2}+x_{2}^{2}\\right)\\right)\n$$\n是一个均值向量为 $(0,0)$、单位方差、相关系数为 $\\rho$ 的二元正态分布的核。为了推导全条件分布，我们对 $x_1$ 进行配方：\n$$\nx_{1}^{2}-2\\rho x_{1}x_{2}+x_{2}^{2}=(x_{1}-\\rho x_{2})^{2}+(1-\\rho^{2})x_{2}^{2}.\n$$\n因此，在给定 $x_{2}$ 的条件下，\n$$\nf(x_{1}\\mid x_{2}) \\propto \\exp\\left(-\\frac{1}{2(1-\\rho^{2})}(x_{1}-\\rho x_{2})^{2}\\right),\n$$\n这是一个正态分布的核，其分布为\n$$\nx_{1}\\mid x_{2} \\sim \\mathcal{N}\\!\\left(\\rho x_{2},\\,1-\\rho^{2}\\right).\n$$\n根据对称性，我们也有\n$$\nx_{2}\\mid x_{1} \\sim \\mathcal{N}\\!\\left(\\rho x_{1},\\,1-\\rho^{2}\\right).\n$$\n\nGibbs 抽样器首先使用 $x_2$ 更新 $x_1$，然后使用新的 $x_1$ 更新 $x_2$。在每次抽样值等于条件均值的确定性规则下，更新方程为\n$$\nx_{1}^{(t+1)}=\\rho\\,x_{2}^{(t)},\\qquad x_{2}^{(t+1)}=\\rho\\,x_{1}^{(t+1)}.\n$$\n结合这些方程，\n$$\nx_{2}^{(t+1)}=\\rho^{2}\\,x_{2}^{(t)},\\qquad x_{1}^{(t+1)}=\\rho\\,x_{2}^{(t)}.\n$$\n从 $(x_{1}^{(0)},x_{2}^{(0)})=(-4.0,-4.1)$ 开始，并使用 $\\rho=0.99$，第一次完整迭代得出：\n$$\nx_{1}^{(1)}=\\rho\\,x_{2}^{(0)}=0.99\\times(-4.1)=-4.059,\\qquad\nx_{2}^{(1)}=\\rho\\,x_{1}^{(1)}=0.99\\times(-4.059)=-4.01841.\n$$\n第二次完整迭代则给出：\n$$\nx_{1}^{(2)}=\\rho\\,x_{2}^{(1)}=0.99\\times(-4.01841)=-3.9782259,\\qquad\nx_{2}^{(2)}=\\rho\\,x_{1}^{(2)}=0.99\\times(-3.9782259)=-3.938443641.\n$$\n将每个坐标四舍五入到四位有效数字：\n$$\nx_{1}^{(2)}\\approx -3.978,\\qquad x_{2}^{(2)}\\approx -3.938.\n$$", "answer": "$$\\boxed{\\begin{pmatrix}-3.978  -3.938\\end{pmatrix}}$$", "id": "1363745"}, {"introduction": "为了从观察转向理解，我们现在深入探讨高相关系统中慢混合背后的理论。这个高级练习要求您推导在二元正态分布上吉布斯采样的自相关函数。此推导将从数学上证明为什么高相关性 ($\\rho$) 会直接导致生成样本中自相关性的缓慢衰減，为先前观察到的经验行为提供了严谨的理论基础 [@problem_id:3235784]。", "problem": "考虑一个均值为零、协方差矩阵为\n$$\\Sigma=\\begin{pmatrix}1  \\rho\\\\ \\rho  1\\end{pmatrix}$$\n的二元正态目标分布，其中 $|\\rho|1$。针对此目标分布，确定性扫描吉布斯采样器 (deterministic-scan Gibbs sampler) 在给定当前 $y$ 的条件下抽取 $x$ 和给定当前 $x$ 的条件下抽取 $y$ 之间交替进行，生成一个马尔可夫链 $(x,y)$，其平稳边缘分布为 $x\\sim \\mathcal{N}(0,1)$ 和 $y\\sim \\mathcal{N}(0,1)$。令 $x$-子链为序列 $\\{x_t\\}_{t\\geq 0}$，该序列是通过在每次 $x$-更新后立即记录 $x$ 的值而获得的。\n\n从吉布斯采样器的核心定义、多元正态分布的条件分布以及自相关的定义出发，推导平稳 $x$-子链的滞后-$k$ 自相关 (lag-$k$ autocorrelation) 的闭式表达式，其定义为\n$$\\mathrm{Corr}(x_t,x_{t+k})=\\frac{\\mathrm{Cov}(x_t,x_{t+k})}{\\mathrm{Var}(x_t)},$$\n作为 $\\rho$ 和 $k\\in\\{0,1,2,\\dots\\}$ 的函数。请将您的最终答案表示为关于 $\\rho$ 和 $k$ 的单个解析表达式。无需四舍五入。", "solution": "该问题要求推导由确定性扫描吉布斯采样器作用于二元正态分布所生成的平稳 $x$-子链的滞后-$k$ 自相关。\n\n首先，我们必须建立吉布斯采样器所需的条件分布。目标分布是随机向量 $(X, Y)^T$ 的二元正态分布，其均值向量为 $\\mu = (0, 0)^T$，协方差矩阵为：\n$$\n\\Sigma = \\begin{pmatrix} 1  \\rho \\\\ \\rho  1 \\end{pmatrix}\n$$\n边缘方差为 $\\mathrm{Var}(X) = \\sigma_x^2 = 1$ 和 $\\mathrm{Var}(Y) = \\sigma_y^2 = 1$。协方差为 $\\mathrm{Cov}(X, Y) = \\rho \\sigma_x \\sigma_y = \\rho$。\n\n对于一般的二元正态分布 $(X, Y)^T$，给定 $Y=y$ 时 $X$ 的条件分布是一个正态分布，其均值 $E[X|Y=y]$ 和方差 $\\mathrm{Var}(X|Y=y)$ 由以下公式给出：\n$$\nE[X|Y=y] = E[X] + \\frac{\\mathrm{Cov}(X,Y)}{\\mathrm{Var}(Y)}(y - E[Y])\n$$\n$$\n\\mathrm{Var}(X|Y=y) = \\mathrm{Var}(X) \\left(1 - \\frac{\\mathrm{Cov}(X,Y)^2}{\\mathrm{Var}(X)\\mathrm{Var}(Y)}\\right) = \\mathrm{Var}(X)(1-\\rho_{XY}^2)\n$$\n其中 $\\rho_{XY}$ 是 $X$ 和 $Y$ 之间的相关系数。\n\n在这个具体问题中，$E[X]=0$，$E[Y]=0$，$\\mathrm{Var}(X)=1$，$\\mathrm{Var}(Y)=1$，并且 $\\mathrm{Cov}(X,Y)=\\rho$。代入这些值可得：\n$$\nE[X|Y=y] = 0 + \\frac{\\rho}{1}(y - 0) = \\rho y\n$$\n$$\n\\mathrm{Var}(X|Y=y) = 1(1 - \\rho^2) = 1-\\rho^2\n$$\n因此，给定 $Y=y$ 时 $X$ 的条件分布为 $X|Y=y \\sim \\mathcal{N}(\\rho y, 1-\\rho^2)$。\n根据问题的对称性，给定 $X=x$ 时 $Y$ 的条件分布为 $Y|X=x \\sim \\mathcal{N}(\\rho x, 1-\\rho^2)$。\n\n吉布斯采样器生成一个状态序列。设在第 $t-1$ 次迭代完成时马尔可夫链的状态为 $(x_{t-1}, y_{t-1})$。确定性扫描吉布斯采样器按固定顺序更新每个分量。我们定义一次完整迭代（从 $t-1$ 到 $t$）为先更新 $y$，再更新 $x$。\n1.  从给定当前 $x$ 值（即 $x_{t-1}$）的条件分布中抽取一个新的 $y$ 值，记为 $y'_t$：\n    $y'_t \\sim p(y | x = x_{t-1})$，即 $y'_t \\sim \\mathcal{N}(\\rho x_{t-1}, 1-\\rho^2)$。\n2.  从给定新抽取的 $y$ 值（即 $y'_t$）的条件分布中抽取一个新的 $x$ 值，即 $x_t$：\n    $x_t \\sim p(x | y = y'_t)$，即 $x_t \\sim \\mathcal{N}(\\rho y'_t, 1-\\rho^2)$。\n\n问题要求的是 $x$-子链 $\\{x_t\\}_{t \\ge 0}$ 的自相关。我们需要找到 $x_t$ 和 $x_{t-1}$ 之间的关系。我们可以将采样步骤表示为随机方程。设 $\\epsilon_t$ 和 $\\delta_t$ 为在第 $t$ 次迭代中抽取的独立标准正态随机变量，即 $\\epsilon_t, \\delta_t \\sim \\mathcal{N}(0,1)$。\n根据步骤 1：\n$$\ny'_t = \\rho x_{t-1} + \\sqrt{1-\\rho^2} \\epsilon_t\n$$\n根据步骤 2：\n$$\nx_t = \\rho y'_t + \\sqrt{1-\\rho^2} \\delta_t\n$$\n将 $y'_t$ 的表达式代入 $x_t$ 的方程中：\n$$\nx_t = \\rho (\\rho x_{t-1} + \\sqrt{1-\\rho^2} \\epsilon_t) + \\sqrt{1-\\rho^2} \\delta_t\n$$\n$$\nx_t = \\rho^2 x_{t-1} + \\rho\\sqrt{1-\\rho^2} \\epsilon_t + \\sqrt{1-\\rho^2} \\delta_t\n$$\n这个方程描述了 $x$-子链的演化过程。这是一个一阶自回归过程，即 AR(1)。我们定义噪声项 $u_t = \\rho\\sqrt{1-\\rho^2} \\epsilon_t + \\sqrt{1-\\rho^2} \\delta_t$。由于 $\\epsilon_t$ 和 $\\delta_t$ 相互独立且独立于 $x_{t-1}$，所以噪声项 $u_t$ 也独立于 $x_{t-1}$。$u_t$ 的均值为 $E[u_t] = 0$。$u_t$ 的方差为：\n$$\n\\mathrm{Var}(u_t) = \\mathrm{Var}(\\rho\\sqrt{1-\\rho^2} \\epsilon_t) + \\mathrm{Var}(\\sqrt{1-\\rho^2} \\delta_t)\n$$\n$$\n\\mathrm{Var}(u_t) = (\\rho\\sqrt{1-\\rho^2})^2 \\mathrm{Var}(\\epsilon_t) + (1-\\rho^2) \\mathrm{Var}(\\delta_t)\n$$\n$$\n\\mathrm{Var}(u_t) = \\rho^2(1-\\rho^2)(1) + (1-\\rho^2)(1) = (1-\\rho^2)(\\rho^2+1) = 1-\\rho^4\n$$\n因此，$x$-子链遵循 AR(1) 过程：\n$$\nx_t = \\rho^2 x_{t-1} + u_t, \\quad \\text{其中 } u_t \\sim \\mathcal{N}(0, 1-\\rho^4)\n$$\n问题考虑的是平稳的 $x$-子链。$X$ 的平稳边缘分布是 $\\mathcal{N}(0,1)$，因此在平稳状态下，对于所有 $t$ 都有 $\\mathrm{Var}(x_t)=1$。我们可以验证这与 AR(1) 过程是一致的：$\\mathrm{Var}(x_t) = \\mathrm{Var}(\\rho^2 x_{t-1} + u_t) = (\\rho^2)^2 \\mathrm{Var}(x_{t-1}) + \\mathrm{Var}(u_t) = \\rho^4 \\mathrm{Var}(x_{t-1}) + 1-\\rho^4$。如果 $\\mathrm{Var}(x_{t-1})=1$，那么 $\\mathrm{Var}(x_t) = \\rho^4(1) + 1-\\rho^4 = 1$。这证实了平稳方差。\n\n我们需要求出滞后-$k$ 自相关 $\\mathrm{Corr}(x_t, x_{t+k})$。根据定义：\n$$\n\\mathrm{Corr}(x_t, x_{t+k}) = \\frac{\\mathrm{Cov}(x_t, x_{t+k})}{\\sqrt{\\mathrm{Var}(x_t)\\mathrm{Var}(x_{t+k})}}\n$$\n在平稳状态下，$\\mathrm{Var}(x_t) = \\mathrm{Var}(x_{t+k}) = 1$。因此，自相关等于自协方差：\n$$\n\\mathrm{Corr}(x_t, x_{t+k}) = \\mathrm{Cov}(x_t, x_{t+k})\n$$\n我们可以找到自协方差的递推关系。对于 $k \\ge 1$：\n$$\n\\mathrm{Cov}(x_t, x_{t+k}) = \\mathrm{Cov}(x_t, \\rho^2 x_{t+k-1} + u_{t+k})\n$$\n利用协方差的双线性性质：\n$$\n\\mathrm{Cov}(x_t, x_{t+k}) = \\mathrm{Cov}(x_t, \\rho^2 x_{t+k-1}) + \\mathrm{Cov}(x_t, u_{t+k})\n$$\n噪声项 $u_{t+k}$ 是由在第 $t+k$ 次迭代中抽取的随机变量 $\\epsilon_{t+k}$ 和 $\\delta_{t+k}$ 生成的。因此它独立于 $x_t$，因为 $x_t$ 只依赖于到第 $t$ 次迭代为止的噪声项。所以，$\\mathrm{Cov}(x_t, u_{t+k})=0$。\n这可将表达式简化为：\n$$\n\\mathrm{Cov}(x_t, x_{t+k}) = \\rho^2 \\mathrm{Cov}(x_t, x_{t+k-1})\n$$\n这是一个几何递推关系。令 $C(k) = \\mathrm{Cov}(x_t, x_{t+k})$。该关系为 $C(k) = \\rho^2 C(k-1)$。\n该递推的基准情形是滞后 $k=0$：\n$$\nC(0) = \\mathrm{Cov}(x_t, x_t) = \\mathrm{Var}(x_t) = 1\n$$\n求解该递推关系：\n$$\nC(k) = (\\rho^2)^k C(0) = (\\rho^2)^k \\cdot 1 = \\rho^{2k}\n$$\n此结果对任何非负整数 $k \\in \\{0, 1, 2, \\dots\\}$ 均有效。对于 $k=0$，结果为 $\\rho^0=1$，这是正确的，因为 $\\mathrm{Corr}(x_t, x_t)=1$。\n\n因此，平穩 $x$-子链的滞后-$k$ 自相关为 $\\rho^{2k}$。请注意，如果在吉布斯扫描中更新的顺序颠倒（先更新 $x$ 再更新 $y$），分量子链的 AR(1) 过程方程及其自相关将保持不变。", "answer": "$$\\boxed{\\rho^{2k}}$$", "id": "3235784"}]}