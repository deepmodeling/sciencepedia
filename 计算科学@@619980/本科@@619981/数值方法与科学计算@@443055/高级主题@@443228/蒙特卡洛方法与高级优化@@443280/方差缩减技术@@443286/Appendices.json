{"hands_on_practices": [{"introduction": "对偶采样法是一种直观的方差缩减技术，它通过对输入的均匀随机数成对使用（例如 $u$ 和 $1-u$）来诱导样本间的负相关性。当被积函数相对于输入变量是单调时，这种方法尤其有效，能够显著提高估计的稳定性。本练习 [@problem_id:1349000] 通过一个源于基础物理学的抛射体运动场景，让你亲手计算对偶采样估计值，从而直观地理解其工作原理和应用。", "problem": "一个工程师团队正在设计一种新型微型弹射系统。在该系统中，抛射体以相对于水平方向的固定角度 $\\theta$ 发射。由于能源的波动，初始发射速度 $v_0$ 是一个随机变量。已知其在最小速度 $v_{min}$ 和最大速度 $v_{max}$ 之间服从均匀分布。抛射体达到的最大高度 $H$ 由公式 $H(v_0) = \\frac{(v_0 \\sin\\theta)^2}{2g}$ 给出，其中 $g$ 是重力加速度。\n\n为了估计期望最大高度 $E[H]$，该团队采用对偶变量法，这是一种方差缩减技术。一个特定的发射速度 $v$ 通过逆变换采样公式从一个标准均匀随机变量 $u \\sim U(0,1)$ 生成：$v = v_{min} + (v_{max} - v_{min})u$。接着，使用一次抽样 $u_1$ 及其对偶对应项 $u'_1 = 1 - u_1$ 生成一对对偶速度 $(v_1, v'_1)$。\n\n给定该系统的以下参数：\n- 发射角度：$\\theta = 30^{\\circ}$\n- 最小速度：$v_{min} = 20.0$ m/s\n- 最大速度：$v_{max} = 50.0$ m/s\n- 重力加速度：$g = 9.81 \\, \\text{m/s}^2$\n\n基于从标准均匀分布 $U(0,1)$ 中单次随机抽取的样本 $u_1 = 0.300$，计算期望最大高度的对偶变量估计值。答案以米为单位表示，并四舍五入到三位有效数字。", "solution": "我们要求解使用一对对偶变量得到的期望最大高度的对偶变量估计值。最大高度作为发射速度的函数由下式给出\n$$\nH(v_{0})=\\frac{(v_{0}\\sin\\theta)^{2}}{2g}.\n$$\n对于在 $[v_{\\min},v_{\\max}]$ 上均匀分布的速度，其逆变换采样公式为\n$$\nv(u)=v_{\\min}+(v_{\\max}-v_{\\min})u,\n$$\n并且对偶对使用 $u_{1}$ 和 $u_{1}'=1-u_{1}$，得到速度\n$$\nv_{1}=v(u_{1}),\\qquad v_{1}'=v(u_{1}').\n$$\n基于一对变量的对偶变量估计量是其平均值\n$$\n\\widehat{E}_{\\text{AV}}=\\frac{H(v_{1})+H(v_{1}')}{2}.\n$$\n\n当 $\\theta=30^{\\circ}$ 时，我们使用 $\\sin(30^{\\circ})=\\frac{1}{2}$，因此\n$$\nH(v)=\\frac{v^{2}\\sin^{2}(30^{\\circ})}{2g}=\\frac{v^{2}}{8g}.\n$$\n给定 $v_{\\min}=20.0$，$v_{\\max}=50.0$ 以及 $u_{1}=0.300$，\n$$\nv_{1}=20.0+(50.0-20.0)\\cdot 0.300=20.0+30.0\\cdot 0.300=29.0,\n$$\n$$\nu_{1}'=1-0.300=0.700,\\qquad v_{1}'=20.0+30.0\\cdot 0.700=41.0.\n$$\n因此\n$$\nH(v_{1})=\\frac{29.0^{2}}{8g}=\\frac{841}{8g},\\qquad H(v_{1}')=\\frac{41.0^{2}}{8g}=\\frac{1681}{8g}.\n$$\n对偶估计值为\n$$\n\\widehat{E}_{\\text{AV}}=\\frac{1}{2}\\left(\\frac{841}{8g}+\\frac{1681}{8g}\\right)=\\frac{841+1681}{16g}=\\frac{2522}{16g}.\n$$\n当 $g=9.81$ 时，可得\n$$\n\\widehat{E}_{\\text{AV}}=\\frac{2522}{16\\times 9.81}=\\frac{2522}{156.96}\\approx 16.0678.\n$$\n四舍五入到三位有效数字，估计值为 $16.1$ 米。", "answer": "$$\\boxed{16.1}$$", "id": "1349000"}, {"introduction": "控制变量法是蒙特卡洛模拟中一种强大而通用的技术，其核心思想是利用一个已知期望值的辅助变量（即控制变量）来修正我们的估计量。通过利用主估计量与控制变量之间的相关性，我们可以有效地减少估计的方差。在这个练习 [@problem_id:1348989] 中，你将面对一项核心任务：推导最优的控制系数以实现方差的最小化，并精确计算方差缩减的比例，从而量化该技术的实际效益。", "problem": "一位分析师正在尝试估计 $\\theta = E[(U+1)^2]$ 的值，其中 $U$ 是在区间 $[0, 1]$ 上均匀分布的随机变量。标准方法是使用简单的蒙特卡洛估计量，即生成 $X = (U+1)^2$ 的样本并对其求平均值。该估计量的精度由单个样本的方差 $\\text{Var}(X)$ 决定。\n\n为了提高估计的效率，我们提出了一种控制变量技术。我们使用一个期望值已知的相关随机变量 $C = U$ 来构建一个新的估计量。单个样本的新估计量由 $X(b) = X - b(C - E[C])$ 给出，其中 $b$ 是一个待优化的实值常数系数。\n\n你的任务是确定该技术所能带来的理论上的改进。首先，找到使得新估计量方差 $\\text{Var}(X(b))$ 最小的最优系数 $b^*$。然后，计算方差缩减因子，即单个优化后控制变量样本的方差与单个简单样本的方差之比。\n\n将此方差缩减因子 $\\frac{\\text{Var}(X(b^*))}{\\text{Var}(X)}$ 表示为一个精确的分数。", "solution": "设 $U \\sim \\text{Unif}[0,1]$，$X=(U+1)^{2}$ 且 $C=U$。对于 $k \\geq 0$，$E[U^{k}]=\\frac{1}{k+1}$。因此 $E[U]=\\frac{1}{2}$，$E[U^{2}]=\\frac{1}{3}$，$E[U^{3}]=\\frac{1}{4}$，$E[U^{4}]=\\frac{1}{5}$，以及 $\\text{Var}(U)=\\frac{1}{12}$。\n\n将 $X$ 展开为 $X=U^{2}+2U+1$。那么\n$$\nE[X]=E[U^{2}]+2E[U]+1=\\frac{1}{3}+1+1=\\frac{7}{3}.\n$$\n另外\n$$\nX^{2}=(U^{2}+2U+1)^{2}=U^{4}+4U^{3}+6U^{2}+4U+1,\n$$\n所以\n$$\nE[X^{2}]=\\frac{1}{5}+4\\cdot\\frac{1}{4}+6\\cdot\\frac{1}{3}+4\\cdot\\frac{1}{2}+1=\\frac{31}{5}.\n$$\n因此\n$$\n\\text{Var}(X)=E[X^{2}]-(E[X])^{2}=\\frac{31}{5}-\\left(\\frac{7}{3}\\right)^{2}=\\frac{34}{45}.\n$$\n\n计算与 $C=U$ 的协方差：\n$$\n\\text{Cov}(U^{2},U)=E[U^{3}]-E[U^{2}]E[U]=\\frac{1}{4}-\\frac{1}{3}\\cdot\\frac{1}{2}=\\frac{1}{12},\n$$\n所以\n$$\n\\text{Cov}(X,C)=\\text{Cov}(U^{2}+2U+1,U)=\\frac{1}{12}+2\\cdot\\text{Var}(U)=\\frac{1}{12}+2\\cdot\\frac{1}{12}=\\frac{1}{4},\n$$\n且 $\\text{Var}(C)=\\text{Var}(U)=\\frac{1}{12}$。\n\n对于控制变量估计量 $X(b)=X-b(C-E[C])$，其方差为\n$$\n\\text{Var}(X(b))=\\text{Var}(X)-2b\\,\\text{Cov}(X,C)+b^{2}\\text{Var}(C).\n$$\n最小化关于 $b$ 的二次式可得\n$$\nb^{*}=\\frac{\\text{Cov}(X,C)}{\\text{Var}(C)}=\\frac{\\frac{1}{4}}{\\frac{1}{12}}=3,\n$$\n最小化的方差为\n$$\n\\text{Var}(X(b^{*}))=\\text{Var}(X)-\\frac{\\text{Cov}(X,C)^{2}}{\\text{Var}(C)}=\\frac{34}{45}-\\frac{\\left(\\frac{1}{4}\\right)^{2}}{\\frac{1}{12}}=\\frac{34}{45}-\\frac{3}{4}=\\frac{1}{180}.\n$$\n\n因此，方差缩减因子为\n$$\n\\frac{\\text{Var}(X(b^{*}))}{\\text{Var}(X)}=\\frac{\\frac{1}{180}}{\\frac{34}{45}}=\\frac{1}{136}.\n$$", "answer": "$$\\boxed{\\frac{1}{136}}$$", "id": "1348989"}, {"introduction": "重要性采样是一种处理罕见事件模拟和高维积分问题的尖端技术，其原理是从一个经过优化的“提议分布”中进行采样，然后通过权重修正来获得无偏估计。这个高级练习 [@problem_id:2446710] 不仅要求你应用该方法，更引导你从第一性原理出发，推导能够最小化（甚至消除）方差的最优提议分布。这揭示了重要性采样在理论上的强大威力，并展示了设计零方差估计器的可能性。", "problem": "考虑在计算经济学和金融学相关的蒙特卡罗背景下，计算一个正态分布随机变量的指数的期望值。令 $X \\sim \\mathcal{N}(0, 100)$，并定义 $h(x) = \\exp(x)$。你将使用重要性采样来估计量 $\\mathbb{E}[\\exp(X)]$，其中提议分布 $Q$ 由 $Y \\sim \\mathcal{N}(\\mu, 100)$ 给出，带有一个未知的平移参数 $\\mu \\in \\mathbb{R}$。令 $p(x)$ 和 $q_{\\mu}(x)$ 分别表示 $\\mathcal{N}(0, 100)$ 和 $\\mathcal{N}(\\mu, 100)$ 的概率密度函数。基于从 $q_{\\mu}$ 中抽取的 $n$ 个独立同分布样本 $\\{Y_i\\}_{i=1}^{n}$，重要性采样估计量为\n$$\nI_n(\\mu) \\;=\\; \\frac{1}{n}\\sum_{i=1}^{n} h(Y_i)\\, w_{\\mu}(Y_i), \\quad \\text{其中 } w_{\\mu}(y) \\;=\\; \\frac{p(y)}{q_{\\mu}(y)}.\n$$\n从第一性原理出发，不借助任何特定的方差缩减公式，完成以下任务：\n1. 推导 $\\mathbb{E}[\\exp(X)]$ 的闭式表达式。\n2. 推导 $\\operatorname{Var}_{q_{\\mu}}(h(Y)\\,w_{\\mu}(Y))$ 作为 $\\mu$ 的函数，并找出在 $\\mu \\in \\mathbb{R}$ 上使该方差最小化的值 $\\mu^{\\star}$。\n\n将你的最终答案以一个有序对的形式给出，该有序对包含 $\\mathbb{E}[\\exp(X)]$ 的精确值和最优平移量 $\\mu^{\\star}$。不需要进行数值四舍五入，你的答案应该是精确值，不带单位。", "solution": "我们首先回顾一下定义。目标分布是 $X \\sim \\mathcal{N}(0, 100)$，其密度函数为\n$$\np(x) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\, \\sigma}\\,\\exp\\!\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right), \\quad \\sigma^{2} = 100,\n$$\n提议分布是 $Y \\sim \\mathcal{N}(\\mu, 100)$，其密度函数为\n$$\nq_{\\mu}(x) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\, \\sigma}\\,\\exp\\!\\left(-\\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right), \\quad \\sigma^{2} = 100.\n$$\n重要性权重为 $w_{\\mu}(x) = p(x)/q_{\\mu}(x)$。\n\n步骤1：以闭式形式计算 $\\mathbb{E}[\\exp(X)]$。根据定义，\n$$\n\\mathbb{E}[\\exp(X)] \\;=\\; \\int_{-\\infty}^{\\infty} \\exp(x)\\, p(x)\\, dx \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\, \\sigma} \\int_{-\\infty}^{\\infty} \\exp\\!\\left(x - \\frac{x^{2}}{2\\sigma^{2}}\\right) dx.\n$$\n对指数部分进行配方。写出\n$$\nx - \\frac{x^{2}}{2\\sigma^{2}} \\;=\\; -\\frac{1}{2\\sigma^{2}}\\left(x^{2} - 2\\sigma^{2} x \\right) \\;=\\; -\\frac{1}{2\\sigma^{2}}\\left[(x - \\sigma^{2})^{2} - \\sigma^{4}\\right] \\;=\\; -\\frac{(x - \\sigma^{2})^{2}}{2\\sigma^{2}} + \\frac{\\sigma^{2}}{2}.\n$$\n因此，\n$$\n\\mathbb{E}[\\exp(X)] \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\, \\sigma} \\exp\\!\\left(\\frac{\\sigma^{2}}{2}\\right) \\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{(x - \\sigma^{2})^{2}}{2\\sigma^{2}}\\right) dx \\;=\\; \\exp\\!\\left(\\frac{\\sigma^{2}}{2}\\right),\n$$\n因为该积分等于 $\\sqrt{2\\pi}\\, \\sigma$。当 $\\sigma^{2} = 100$ 时，这得出\n$$\n\\mathbb{E}[\\exp(X)] \\;=\\; \\exp(50).\n$$\n\n步骤2：推导 $\\operatorname{Var}_{q_{\\mu}}(h(Y)\\, w_{\\mu}(Y))$ 并对其关于 $\\mu$ 进行最小化。注意\n$$\n\\operatorname{Var}_{q_{\\mu}}(h(Y)\\, w_{\\mu}(Y)) \\;=\\; \\mathbb{E}_{q_{\\mu}}\\!\\left[h(Y)^{2}\\, w_{\\mu}(Y)^{2}\\right] \\;-\\; \\left(\\mathbb{E}[\\exp(X)]\\right)^{2}.\n$$\n第二项不依赖于 $\\mu$，因此对关于 $\\mu$ 的方差进行最小化等价于对二阶矩进行最小化\n$$\nM(\\mu) \\;=\\; \\mathbb{E}_{q_{\\mu}}\\!\\left[h(Y)^{2}\\, w_{\\mu}(Y)^{2}\\right] \\;=\\; \\int_{-\\infty}^{\\infty} \\exp(2x)\\, \\frac{p(x)^{2}}{q_{\\mu}(x)}\\, dx.\n$$\n使用具有共同方差 $\\sigma^{2}$ 的 $p$ 和 $q_{\\mu}$ 的显式形式，\n$$\n\\frac{p(x)^{2}}{q_{\\mu}(x)} \\;=\\; \\frac{\\left(\\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\exp\\!\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right)\\right)^{2}}{\\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\exp\\!\\left(-\\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right)} \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left(-\\frac{x^{2}}{\\sigma^{2}} + \\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right).\n$$\n因此，\n$$\nM(\\mu) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\int_{-\\infty}^{\\infty} \\exp\\!\\left(2x - \\frac{x^{2}}{\\sigma^{2}} + \\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right) dx.\n$$\n合并指数部分：\n$$\n2x - \\frac{x^{2}}{\\sigma^{2}} + \\frac{(x-\\mu)^{2}}{2\\sigma^{2}} \\;=\\; -\\frac{x^{2}}{2\\sigma^{2}} + \\left(2 - \\frac{\\mu}{\\sigma^{2}}\\right) x + \\frac{\\mu^{2}}{2\\sigma^{2}}.\n$$\n通过定义以下式子进行配方\n$$\nm \\;=\\; 2\\sigma^{2} - \\mu,\n$$\n使得\n$$\n-\\frac{x^{2}}{2\\sigma^{2}} + \\left(2 - \\frac{\\mu}{\\sigma^{2}}\\right) x \\;=\\; -\\frac{(x - m)^{2}}{2\\sigma^{2}} + \\frac{m^{2}}{2\\sigma^{2}}.\n$$\n因此，\n$$\nM(\\mu) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\!\\left(\\frac{m^{2}}{2\\sigma^{2}} + \\frac{\\mu^{2}}{2\\sigma^{2}}\\right) \\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{(x - m)^{2}}{2\\sigma^{2}}\\right) dx \\;=\\; \\exp\\!\\left(\\frac{m^{2} + \\mu^{2}}{2\\sigma^{2}}\\right).\n$$\n代入 $m = 2\\sigma^{2} - \\mu$，\n$$\nm^{2} + \\mu^{2} \\;=\\; (2\\sigma^{2} - \\mu)^{2} + \\mu^{2} \\;=\\; 4\\sigma^{4} - 4\\mu \\sigma^{2} + 2\\mu^{2},\n$$\n因此\n$$\nM(\\mu) \\;=\\; \\exp\\!\\left(\\frac{4\\sigma^{4} - 4\\mu \\sigma^{2} + 2\\mu^{2}}{2\\sigma^{2}}\\right) \\;=\\; \\exp\\!\\left(2\\sigma^{2} - 2\\mu + \\frac{\\mu^{2}}{\\sigma^{2}}\\right).\n$$\n作为 $\\mu$ 的函数，最小化 $M(\\mu)$ 等价于最小化其指数\n$$\ng(\\mu) \\;=\\; \\frac{\\mu^{2}}{\\sigma^{2}} - 2\\mu + 2\\sigma^{2}.\n$$\n这是一个关于 $\\mu$ 的凸二次函数，其导数为\n$$\ng'(\\mu) \\;=\\; \\frac{2\\mu}{\\sigma^{2}} - 2,\n$$\n该导数在以下点为零\n$$\n\\mu^{\\star} \\;=\\; \\sigma^{2}.\n$$\n由于 $g''(\\mu) = 2/\\sigma^{2} > 0$，这个临界点是唯一的最小值点。当 $\\sigma^{2} = 100$ 时，最优平移量为\n$$\n\\mu^{\\star} \\;=\\; 100.\n$$\n在 $\\mu^{\\star} = \\sigma^{2}$ 时，提议密度 $q_{\\mu^{\\star}}$ 与 $h(x)\\, p(x)$ 成正比，这会产生一个零方差重要性采样估计量，与以下结果一致\n$$\n\\operatorname{Var}_{q_{\\mu^{\\star}}}(h(Y)\\,w_{\\mu^{\\star}}(Y)) \\;=\\; M(\\mu^{\\star}) - \\left(\\mathbb{E}[\\exp(X)]\\right)^{2} \\;=\\; \\exp(\\sigma^{2}) - \\exp(\\sigma^{2}) \\;=\\; 0.\n$$\n汇总结果，精确期望值为 $\\exp(50)$，最优平移量为 $\\mu^{\\star} = 100$。", "answer": "$$\\boxed{\\begin{pmatrix}\\exp(50)  100\\end{pmatrix}}$$", "id": "2446710"}]}