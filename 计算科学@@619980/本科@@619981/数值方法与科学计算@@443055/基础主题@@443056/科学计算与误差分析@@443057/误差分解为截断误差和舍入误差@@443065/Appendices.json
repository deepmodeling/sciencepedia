{"hands_on_practices": [{"introduction": "在数学上等价的公式在数值计算中可能表现出截然不同的行为。本练习 [@problem_id:3225142] 通过比较计算同一数值的两种方法，探讨了灾难性抵消（catastrophic cancellation）这一舍入误差的主要来源。它突出了算法重构对于保证数值稳定性的重要性。", "problem": "考虑在一个遵循电气和电子工程师协会 (IEEE) 754 浮点标准 (IEEE 754) 并采用“舍入到最近”模式的浮点系统中，为大的正数 $x$ 计算函数 $f(x)=\\sqrt{x+1}-\\sqrt{x}$。设单位舍入为 $u$，并采用标准浮点模型：每个基本运算（包括 $\\sqrt{\\cdot}$、 $+$、 $-$ 和 $/$）产生的结果等于精确结果乘以 $(1+\\delta)$，其中 $|\\delta|\\le u$，且 $\\delta$ 的不同实例虽有界但可能不同。假设 $\\sqrt{\\cdot}$ 按照 IEEE 754 的规定被正确舍入，因此不使用算法迭代，并且任何误差都纯粹是舍入误差。要求您考察截断误差与舍入误差，以及代数重构对数值稳定性的影响。\n\n考虑两种算法：\n- 算法 N（朴素方法）：计算 $a=\\sqrt{x+1}$ 和 $b=\\sqrt{x}$，然后返回 $a-b$。\n- 算法 R（重构方法）：使用一个避免了两个相近数相减的代数表达式，并用浮点运算对其进行求值。\n\n通过选择所有正确的选项来回答以下问题。您的推理应从浮点舍入模型以及截断误差（通过有限过程逼近数学问题而产生的误差）与舍入误差（由有限精度算术产生的误差）的定义出发。\n\nA. 在所述模型下，算法 N 的截断误差为零，并且由于 $a-b$ 中的抵消，其相对舍入误差对于大的 $x$ 大致按 $2ux$ 增长。\n\nB. 在所述模型下，算法 R 的截断误差为零，并且其相对舍入误差被一个常数乘以 $u$ 所界定，与 $x$ 无关。\n\nC. 将 $\\sqrt{x+1}-\\sqrt{x}$ 重写为 $\\dfrac{1}{\\sqrt{x+1}+\\sqrt{x}}$ 改变了其数学值，因此引入了截断误差。\n\nD. 对于满足 $ux\\gtrsim 1$ 的 $x$，算法 N 的相对误差变为 $\\mathcal{O}(1)$（或更差），结果可能会丢失大部分有效数字，而算法 R 避免了这种崩溃。\n\nE. 在算法 N 中，因为精确值 $f(x)$ 是 $\\mathcal{O}\\!\\left(\\dfrac{1}{\\sqrt{x}}\\right)$，所以 $a-b$ 中的绝对舍入误差是 $\\mathcal{O}\\!\\left(\\dfrac{u}{\\sqrt{x}}\\right)$。", "solution": "用户需要对一个关于大 $x$ 下求值 $f(x)=\\sqrt{x+1}-\\sqrt{x}$ 的数值方法问题进行批判性分析。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n\n-   待求值函数：$f(x)=\\sqrt{x+1}-\\sqrt{x}$，其中 $x$ 为大的正数。\n-   浮点系统：遵循 IEEE 754 标准，采用“舍入到最近”模式。\n-   单位舍入：$u$。\n-   浮点模型：对于一个基本运算 `op`，浮点结果为 $fl(\\text{result}) = (\\text{exact result}) \\times (1+\\delta)$，其中 $|\\delta| \\le u$。此模型适用于 $\\sqrt{\\cdot}$、 $+$、 $-$ 和 $/$。\n-   关于 $\\sqrt{\\cdot}$ 的假设：它根据 IEEE 754 标准被正确舍入。\n-   算法 N（朴素方法）：计算 $a=\\sqrt{x+1}$ 和 $b=\\sqrt{x}$，然后返回 $a-b$。\n-   算法 R（重构方法）：使用一个避免了两个相近数相减的代数表达式。标准的重构形式是 $f(x) = \\dfrac{1}{\\sqrt{x+1}+\\sqrt{x}}$。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n1.  科学依据：该问题是数值分析中的一个典型例子，用于演示灾难性抵消（有效数字损失）和算法重构的好处。浮点模型是一阶前向误差分析的标准模型。截断误差和舍入误差的概念是数值方法的核心。该问题在科学上是合理的。\n2.  适定性：该问题是适定的。它提供了两种算法和一个清晰的计算模型，并要求分析由此产生的误差。选项中提出的问题是具体的，可以通过基于所提供模型的严格推导来回答。\n3.  客观性：问题陈述使用了数值分析领域中精确、无歧义的术语。没有主观或基于观点的内容。\n4.  完整性：问题提供了进行误差分析所需的所有必要信息。\n5.  一致性：所提供的信息中没有矛盾之处。\n\n**步骤 3：结论和行动**\n\n问题陈述是有效的。这是数值分析中一个标准的、适定的问题。将继续进行求解过程。\n\n### 解题推导\n\n首先，我们分析一下当 $x$ 为大的正数时，精确数学函数 $f(x)=\\sqrt{x+1}-\\sqrt{x}$ 的性质。\n对于大的 $x$，$\\sqrt{x+1}$ 和 $\\sqrt{x}$ 的值非常接近。\n使用 $\\sqrt{1+z}$ 在 $z=0$ 附近的泰勒展开，其中 $z=1/x$：\n$\\sqrt{1+z} = 1 + \\frac{1}{2}z - \\frac{1}{8}z^2 + \\mathcal{O}(z^3)$。\n所以，$f(x) = \\sqrt{x}\\left(\\sqrt{1+\\frac{1}{x}}-1\\right) = \\sqrt{x}\\left(\\left(1 + \\frac{1}{2x} - \\frac{1}{8x^2} + \\mathcal{O}(x^{-3})\\right) - 1\\right) = \\frac{1}{2\\sqrt{x}} - \\frac{1}{8x^{3/2}} + \\mathcal{O}(x^{-5/2})$。\n对于大的 $x$，真实值 $f(x) \\approx \\frac{1}{2\\sqrt{x}}$，其数量级为 $\\mathcal{O}(x^{-1/2})$。\n\n重构的表达式是通过乘以共轭项得到的：\n$f(x) = (\\sqrt{x+1}-\\sqrt{x}) \\frac{\\sqrt{x+1}+\\sqrt{x}}{\\sqrt{x+1}+\\sqrt{x}} = \\frac{(x+1)-x}{\\sqrt{x+1}+\\sqrt{x}} = \\frac{1}{\\sqrt{x+1}+\\sqrt{x}}$。\n这是一个精确的代数恒等式。\n\n**算法 N（朴素方法）的分析**\n\n算法 N 计算 $f_N(x) = fl(fl(\\sqrt{x+1}) - fl(\\sqrt{x}))$。\n让我们分析舍入误差。\n计算分三步进行：\n1.  $a_c = fl(\\sqrt{x+1}) = \\sqrt{x+1}(1+\\delta_1)$，其中 $|\\delta_1| \\le u$。\n2.  $b_c = fl(\\sqrt{x}) = \\sqrt{x}(1+\\delta_2)$，其中 $|\\delta_2| \\le u$。\n3.  $f_N(x) = fl(a_c - b_c) = (a_c - b_c)(1+\\delta_3)$，其中 $|\\delta_3| \\le u$。\n\n将前两步代入第三步：\n$f_N(x) = (\\sqrt{x+1}(1+\\delta_1) - \\sqrt{x}(1+\\delta_2))(1+\\delta_3)$\n$f_N(x) = ((\\sqrt{x+1}-\\sqrt{x}) + \\sqrt{x+1}\\delta_1 - \\sqrt{x}\\delta_2)(1+\\delta_3)$\n令 $f(x) = \\sqrt{x+1}-\\sqrt{x}$。\n$f_N(x) = (f(x) + \\sqrt{x+1}\\delta_1 - \\sqrt{x}\\delta_2)(1+\\delta_3)$\n对 $\\delta_i$ 取一阶近似，绝对误差 $E_{abs} = f_N(x) - f(x)$ 为：\n$E_{abs} \\approx f(x)\\delta_3 + \\sqrt{x+1}\\delta_1 - \\sqrt{x}\\delta_2$。\n对于大的 $x$，$f(x) \\approx \\frac{1}{2\\sqrt{x}}$ 且 $\\sqrt{x+1} \\approx \\sqrt{x}$。\n$E_{abs} \\approx \\frac{\\delta_3}{2\\sqrt{x}} + \\sqrt{x}(\\delta_1 - \\delta_2)$。\n对于大的 $x$，$\\sqrt{x}(\\delta_1 - \\delta_2)$ 项占主导地位。该误差的最大量级约为 $2u\\sqrt{x}$。\n\n相对误差为 $E_{rel} = \\frac{E_{abs}}{f(x)}$。\n$E_{rel} \\approx \\frac{\\sqrt{x}(\\delta_1 - \\delta_2)}{1/(2\\sqrt{x})} = 2x(\\delta_1 - \\delta_2)$。\n相对舍入误差的量级上限约为 $|E_{rel}| \\le 2x(|\\delta_1|+|\\delta_2|) \\le 4ux$。因此，相对误差与 $x$ 成正比增长。\n\n截断误差是由于逼近数学过程（例如用有限和代替无穷级数）而引入的误差。算法 N 直接实现了 $f(x)$ 的精确公式。没有进行数学近似。因此，算法 N 的截断误差为零。\n\n**算法 R（重构方法）的分析**\n\n算法 R 计算 $f_R(x) = fl\\left(\\frac{1}{fl(fl(\\sqrt{x+1}) + fl(\\sqrt{x}))}\\right)$。\n让我们分析误差的传播。\n1.  $a_c = fl(\\sqrt{x+1}) = \\sqrt{x+1}(1+\\delta_1)$。\n2.  $b_c = fl(\\sqrt{x}) = \\sqrt{x}(1+\\delta_2)$。\n3.  $s_c = fl(a_c+b_c) = (a_c+b_c)(1+\\delta_3) = (\\sqrt{x+1}(1+\\delta_1) + \\sqrt{x}(1+\\delta_2))(1+\\delta_3)$。\n4.  $f_R(x) = fl(1/s_c) = (1/s_c)(1+\\delta_4)$。\n\n算法 R 中的所有运算都是良性的。加法 $\\sqrt{x+1}+\\sqrt{x}$ 涉及两个不相近的正数，因此是良态的。除以这个和也是良态的。\n让我们求总相对误差：\n$f_R(x) \\approx \\frac{1+\\delta_4}{(\\sqrt{x+1}+\\sqrt{x})(1+\\delta_3)(1+\\frac{\\sqrt{x+1}\\delta_1+\\sqrt{x}\\delta_2}{\\sqrt{x+1}+\\sqrt{x}})}$\n$f_R(x) \\approx f(x) \\frac{1+\\delta_4}{(1+\\delta_3)(1+\\epsilon)}$，其中 $\\epsilon = \\frac{\\sqrt{x+1}\\delta_1+\\sqrt{x}\\delta_2}{\\sqrt{x+1}+\\sqrt{x}}$。\n对于大的 $x$，$\\frac{\\sqrt{x+1}}{\\sqrt{x+1}+\\sqrt{x}} \\approx \\frac{1}{2}$ 且 $\\frac{\\sqrt{x}}{\\sqrt{x+1}+\\sqrt{x}} \\approx \\frac{1}{2}$。因此 $|\\epsilon| \\le \\frac{1}{2}|\\delta_1| + \\frac{1}{2}|\\delta_2| \\le u$。\n对一阶近似，相对误差为 $E_{rel} = \\frac{f_R(x)-f(x)}{f(x)} \\approx \\delta_4 - \\delta_3 - \\epsilon \\approx \\delta_4 - \\delta_3 - \\frac{1}{2}(\\delta_1+\\delta_2)$。\n相对误差的量级上限为 $|E_{rel}| \\le |\\delta_4| + |\\delta_3| + \\frac{1}{2}|\\delta_1| + \\frac{1}{2}|\\delta_2| \\le u + u + \\frac{1}{2}u + \\frac{1}{2}u = 3u$。\n相对舍入误差受一个与 $u$ 成正比的小常数限制，且与 $x$ 无关。\n\n重构 $f(x) = \\frac{1}{\\sqrt{x+1}+\\sqrt{x}}$ 是一个精确的数学恒等式。算法 R 实现了这个精确公式。因此，算法 R 的截断误差也为零。\n\n### 逐项分析\n\n**A. 在所述模型下，算法 N 的截断误差为零，并且由于 $a-b$ 中的抵消，其相对舍入误差对于大的 $x$ 大致按 $2ux$ 增长。**\n-   **截断误差**：如前所述，算法 N 使用浮点数计算精确函数 $f(x)$。它不依赖于数学近似（如截断级数）。因此，其截断误差为零。这部分是正确的。\n-   **舍入误差**：我们的分析表明，相对舍入误差约为 $2x(\\delta_1 - \\delta_2)$，其量级上限为 $4ux$。该陈述称其“大致按 $2ux$ 增长”。这正确地捕捉了对 $u$ 和 $x$ 的线性依赖关系。系数是 $2$ 还是 $4$ 是具体误差界定方法的微小细节，“大致按”的说法足够通用。其原因被正确地识别为抵消。\n-   **结论**：正确。\n\n**B. 在所述模型下，算法 R 的截断误差为零，并且其相对舍入误差被一个常数乘以 $u$ 所界定，与 $x$ 无关。**\n-   **截断误差**：重构是一个精确的代数恒等式。与算法 N 一样，算法 R 没有进行数学近似，所以其截断误差为零。这部分是正确的。\n-   **舍入误差**：我们的分析表明，算法 R 的相对舍入误差上限约为 $3u$。这是一个与 $u$ 成正比的常数，并且不依赖于 $x$。这部分是正确的。该算法是数值稳定的。\n-   **结论**：正确。\n\n**C. 将 $\\sqrt{x+1}-\\sqrt{x}$ 重写为 $\\dfrac{1}{\\sqrt{x+1}+\\sqrt{x}}$ 改变了其数学值，因此引入了截断误差。**\n-   该陈述声称重构改变了数学值。这是错误的。对于 $x \\ge 0$，$\\sqrt{x+1}-\\sqrt{x} = \\dfrac{1}{\\sqrt{x+1}+\\sqrt{x}}$ 是一个严格的数学恒等式。\n-   由于变换是精确的，它不引入任何截断误差。截断误差源于数学近似，而非精确的代数运算。\n-   **结论**：不正确。\n\n**D. 对于满足 $ux\\gtrsim 1$ 的 $x$，算法 N 的相对误差变为 $\\mathcal{O}(1)$（或更差），结果可能会丢失大部分有效数字，而算法 R 避免了这种崩溃。**\n-   根据对算法 N 的分析，相对误差约为 $\\approx C \\cdot ux$，其中 $C$ 是某个小常数（例如，$C \\le 4$）。\n-   如果 $ux \\gtrsim 1$，则相对误差 $\\gtrsim C$，其数量级为 $\\mathcal{O}(1)$。如此大的相对误差意味着计算出的答案与真实答案相比几乎没有或完全没有正确的有效数字（例如，当答案是 $1.0$ 时计算出 $0.1$）。这就是有效数字损失的定义。\n-   算法 R 的相对误差上限约为 $\\approx 3u$，无论 $x$ 多大都保持很小。因此，它避免了这种灾难性的崩溃。\n-   **结论**：正确。\n\n**E. 在算法 N 中，因为精确值 $f(x)$ 是 $\\mathcal{O}\\!\\left(\\dfrac{1}{\\sqrt{x}}\\right)$，所以 $a-b$ 中的绝对舍入误差是 $\\mathcal{O}\\!\\left(\\dfrac{u}{\\sqrt{x}}\\right)$。**\n-   精确值 $f(x)$ 确实是 $\\mathcal{O}(x^{-1/2})$。\n-   然而，我们对算法 N 的绝对误差 $E_{abs}$ 的分析表明 $E_{abs} \\approx \\sqrt{x}(\\delta_1 - \\delta_2)$。\n-   因此，绝对误差的数量级为 $\\mathcal{O}(u\\sqrt{x})$。\n-   该陈述声称绝对误差是 $\\mathcal{O}(u/\\sqrt{x})$。如果*相对*误差是一个常数界，那么这个说法就是正确的。$E_{abs} = E_{rel} \\times f(x)$。如果 $E_{rel} = \\mathcal{O}(u)$，那么 $E_{abs} = \\mathcal{O}(u) \\times \\mathcal{O}(x^{-1/2}) = \\mathcal{O}(ux^{-1/2})$。但对于算法 N，相对误差是 $\\mathcal{O}(ux)$，导致 $E_{abs} = \\mathcal{O}(ux) \\times \\mathcal{O}(x^{-1/2}) = \\mathcal{O}(ux^{1/2})$。\n-   **结论**：不正确。", "answer": "$$\\boxed{ABD}$$", "id": "3225142"}, {"introduction": "在理解了误差来源的基础上，本练习 [@problem_id:3225238] 转向一个量化分析的挑战。在应用有限差分法时，一个较小的步长 $h$ 虽然可以减小截断误差，但同时会增大舍入误差。本练习将引导你为一种四阶导数的近似方法推导出两种误差的表达式，并计算出能够平衡二者的最佳步长 $h$，从而揭示数值微分核心的基本权衡关系。", "problem": "给定一个对称的 $5$ 点模板，用于在点 $x$ 处近似计算一个足够光滑的函数 $f$ 的四阶导数：\n$$\nD^{(4)}_h f(x) \\;=\\; \\frac{f(x-2h) \\;-\\; 4 f(x-h) \\;+\\; 6 f(x) \\;-\\; 4 f(x+h) \\;+\\; f(x+2h)}{h^4}.\n$$\n考虑函数 $f(x) = \\cos(x)$ 和点 $x = 0$，其中角度以弧度为单位。假设函数求值是精确的，舍入误差仅在用于形成分子中的线性组合以及除以 $h^4$ 的浮点运算中发生。采用以下标准浮点模型：对于 $\\circ \\in \\{+,-,\\times,/\\}$，每个基本浮点运算都满足 $\\operatorname{fl}(a \\circ b) = (a \\circ b)(1+\\delta)$，其中 $|\\delta| \\le u$，$u$ 是该算法的单位舍入。在电气和电子工程师协会 (IEEE) $754$ binary$64$ (双精度) 环境下工作，取 $u = 2^{-53}$。\n\n使用关于 $x=0$ 的泰勒定理，推导 $D^{(4)}_h f(0)$ 的主阶截断误差，表示为 $h$ 的幂，直到并包括 $f^{(4)}(0)$ 之后的第一个非零项。然后，使用浮点模型和对所有实数 $t$ 成立的界 $|f(t)| \\le 1$，推导 $D^{(4)}_h f(0)$ 中舍入误差量级的一个关于 $u$ 的一阶上界，用 $h$ 和 $u$ 表示。通过令截断误差和舍入误差的量级相等，确定平衡这两个误差源的步长 $h$（即“最佳点”）。将最终的 $h$ 数值舍入到三位有效数字。", "solution": "用户想要分析一个四阶导数有限差分公式的误差特性。这个过程包括三个主要步骤：推导截断误差，推导舍入误差界，然后找到平衡这两个误差源的最优步长 `h`。\n\n### 步骤 1：问题验证\n\n**1.1. 提取已知条件：**\n- 有限差分公式：$D^{(4)}_h f(x) = \\frac{f(x-2h) - 4 f(x-h) + 6 f(x) - 4 f(x+h) + f(x+2h)}{h^4}$\n- 函数和点：$f(x) = \\cos(x)$ 在 $x=0$ 处。\n- 浮点模型：$\\operatorname{fl}(a \\circ b) = (a \\circ b)(1+\\delta)$，其中 $|\\delta| \\le u$。\n- 单位舍入：$u = 2^{-53}$ (IEEE 754 binary64)。\n- 函数界：$|f(t)| \\le 1$。\n- 假设：函数求值是精确的；舍入误差仅在算术运算期间发生。\n\n**1.2. 使用提取的已知条件进行验证：**\n- **科学依据：**该问题是数值分析中的一个标准练习，涉及用于误差分析的泰勒级数和用于浮点运算的标准模型。该有限差分模板是著名的四阶导数中心差分公式。所有概念都牢固地建立在数学和计算机科学的既定原则之上。\n- **适定性：**问题陈述清晰，要求具体的、可推导的量：一个截断误差项，一个舍入误差界，以及一个最优步长。所提供的信息足以找到一个唯一且有意义的解。\n- **客观性：**该问题使用精确、客观的数学语言进行表述，没有任何主观或有偏见的陈述。\n\n**1.3. 结论与行动：**\n问题有效。我们继续进行求解。\n\n### 步骤 2：推导截断误差\n\n截断误差 $T_h$ 定义为近似值与真实值之差：\n$$T_h = D^{(4)}_h f(x) - f^{(4)}(x)$$\n为了找到 $T_h$ 的主阶项，我们使用泰勒定理将 $D^{(4)}_h f(x)$ 分子中的每个函数求值在点 $x$ 附近展开。对于一个足够光滑的函数 $f$，展开式为：\n$$f(x \\pm ch) = \\sum_{k=0}^{\\infty} \\frac{(\\pm ch)^k}{k!} f^{(k)}(x)$$\n我们展开分子中的各项 $N(h) = f(x-2h) - 4 f(x-h) + 6 f(x) - 4 f(x+h) + f(x+2h)$，并按导数 $f^{(k)}(x)$ 的阶数收集项。\n\n- 对于 $f^{(0)}(x) = f(x)$：系数为 $1 - 4 + 6 - 4 + 1 = 0$。\n- 对于 $f^{(1)}(x)$：系数为 $\\frac{h}{1!}(-2 - 4(-1) - 4(1) + 2) = h(-2+4-4+2) = 0$。\n- 对于 $f^{(2)}(x)$：系数为 $\\frac{h^2}{2!}((-2)^2 - 4(-1)^2 - 4(1)^2 + (2)^2) = \\frac{h^2}{2}(4-4-4+4) = 0$。\n- 对于 $f^{(3)}(x)$：系数为 $\\frac{h^3}{3!}((-2)^3 - 4(-1)^3 - 4(1)^3 + (2)^3) = \\frac{h^3}{6}(-8+4-4+8) = 0$。\n- 对于 $f^{(4)}(x)$：系数为 $\\frac{h^4}{4!}((-2)^4 - 4(-1)^4 - 4(1)^4 + (2)^4) = \\frac{h^4}{24}(16-4-4+16) = \\frac{24h^4}{24} = h^4$。\n- 对于 $f^{(5)}(x)$：系数为 $\\frac{h^5}{5!}((-2)^5 - 4(-1)^5 - 4(1)^5 + (2)^5) = \\frac{h^5}{120}(-32+4-4+32) = 0$。\n- 对于 $f^{(6)}(x)$：系数为 $\\frac{h^6}{6!}((-2)^6 - 4(-1)^6 - 4(1)^6 + (2)^6) = \\frac{h^6}{720}(64-4-4+64) = \\frac{120h^6}{720} = \\frac{h^6}{6}$。\n\n因此，分子可以表示为：\n$$N(h) = h^4 f^{(4)}(x) + \\frac{h^6}{6} f^{(6)}(x) + O(h^8)$$\n除以 $h^4$ 得到近似值的表达式：\n$$D^{(4)}_h f(x) = \\frac{N(h)}{h^4} = f^{(4)}(x) + \\frac{h^2}{6} f^{(6)}(x) + O(h^4)$$\n因此，主阶截断误差为：\n$$T_h = D^{(4)}_h f(x) - f^{(4)}(x) = \\frac{h^2}{6} f^{(6)}(x) + O(h^4)$$\n对于特定函数 $f(x) = \\cos(x)$ 在 $x=0$ 处，我们计算所需的导数：\n- $f^{(4)}(x) = \\cos(x) \\implies f^{(4)}(0) = \\cos(0) = 1$。\n- $f^{(5)}(x) = -\\sin(x)$。\n- $f^{(6)}(x) = -\\cos(x) \\implies f^{(6)}(0) = -\\cos(0) = -1$。\n将 $f^{(6)}(0) = -1$ 代入 $T_h$ 的表达式，主阶截断误差为：\n$$T_h = -\\frac{h^2}{6}$$\n\n### 步骤 3：推导舍入误差界\n\n舍入误差源于计算 $D^{(4)}_h f(0)$ 值所使用的浮点运算。令 $\\tilde{D}^{(4)}_h f(0)$ 为计算所得的值。总舍入误差为 $R_h = \\tilde{D}^{(4)}_h f(0) - D^{(4)}_h f(0)$。\n\n计算过程包括在分子中形成一个线性组合，然后进行一次除法。一个主要的误差来源是分子的计算，特别是由于灾难性抵消：求和涉及 $O(1)$ 阶的项，它们相互抵消后产生一个 $O(h^4)$ 阶的结果。\n\n令精确的分子为 $N = f(-2h) - 4f(-h) + 6f(0) - 4f(h) + f(2h)$。\n令计算所得的分子为 $\\tilde{N}$。计算此和的误差 $\\epsilon_N = \\tilde{N} - N$ 的界是单位舍入 $u$ 与被加项的量级之和的倍数。令这些项为 $y_1=f(-2h)$, $y_2=-4f(-h)$, $y_3=6f(0)$, $y_4=-4f(h)$ 和 $y_5=f(2h)$。\n计算此和的误差的一阶界为：\n$$|\\epsilon_N| \\le u \\sum_{i=1}^5 |c_i f(x_i)|$$\n其中系数 $c_i \\in \\{1, -4, 6\\}$，$x_i$ 是求值点。我们还使用给定的界 $|f(t)| = |\\cos(t)| \\le 1$。\n$$|\\epsilon_N| \\le u \\left( |1 \\cdot f(-2h)| + |-4 \\cdot f(-h)| + |6 \\cdot f(0)| + |-4 \\cdot f(h)| + |1 \\cdot f(2h)| \\right)$$\n$$|\\epsilon_N| \\le u \\left( |f(-2h)| + 4|f(-h)| + 6|f(0)| + 4|f(h)| + |f(2h)| \\right)$$\n使用 $|f(t)| \\le 1$：\n$$|\\epsilon_N| \\le u (1 + 4 + 6 + 4 + 1) = 16u$$\n最终计算值为 $\\tilde{D}^{(4)}_h f(0) = \\operatorname{fl}(\\tilde{N}/h^4) = (\\tilde{N}/h^4)(1+\\delta)$，其中 $|\\delta| \\le u$。\n总舍入误差为：\n$$R_h = \\frac{\\tilde{N}(1+\\delta)}{h^4} - \\frac{N}{h^4} = \\frac{(\\tilde{N}-N) + \\tilde{N}\\delta}{h^4} = \\frac{\\epsilon_N + \\tilde{N}\\delta}{h^4}$$\n取量级：\n$$|R_h| \\le \\frac{|\\epsilon_N| + |\\tilde{N}||\\delta|}{h^4}$$\n我们有 $|\\epsilon_N| \\le 16u$ 和 $|\\delta| \\le u$。对于小的 $h$，$\\tilde{N} \\approx N \\approx h^4 f^{(4)}(0) = h^4$。\n$$|R_h| \\le \\frac{16u + |h^4|u}{h^4} = \\frac{16u}{h^4} + u$$\n对于小的 $h$，第一项占主导地位。因此，一个合适的舍入误差量级上界为：\n$$|R_h| \\le \\frac{16u}{h^4}$$\n\n### 步骤 4：确定最优步长\n\n总误差是截断误差和舍入误差之和，$E_h = T_h + R_h$。当这两个误差分量的量级大致相等时，它们的和最小，此时的步长 $h$ 即为最优步长。\n$$|T_h| \\approx |R_h|$$\n使用主阶截断误差和舍入误差界：\n$$\\left|-\\frac{h^2}{6}\\right| = \\frac{16u}{h^4}$$\n$$\\frac{h^2}{6} = \\frac{16u}{h^4}$$\n我们求解 $h$：\n$$h^6 = 6 \\times 16u = 96u$$\n$$h = (96u)^{1/6}$$\n代入给定的单位舍入值 $u = 2^{-53}$：\n$$h = (96 \\cdot 2^{-53})^{1/6}$$\n我们可以简化表达式：$96 = 32 \\times 3 = 2^5 \\times 3$。\n$$h = (2^5 \\cdot 3 \\cdot 2^{-53})^{1/6} = (3 \\cdot 2^{5-53})^{1/6} = (3 \\cdot 2^{-48})^{1/6}$$\n$$h = 3^{1/6} \\cdot (2^{-48})^{1/6} = 3^{1/6} \\cdot 2^{-8}$$\n现在，我们计算数值：\n$$h = \\frac{3^{1/6}}{2^8} = \\frac{3^{1/6}}{256}$$\n使用计算器，$3^{1/6} \\approx 1.20093695$。\n$$h \\approx \\frac{1.20093695}{256} \\approx 0.00469115996$$\n将结果舍入到三位有效数字，我们得到：\n$$h \\approx 0.00469$$\n这可以写成科学记数法 $4.69 \\times 10^{-3}$。", "answer": "$$\\boxed{4.69 \\times 10^{-3}}$$", "id": "3225238"}, {"introduction": "高阶方法旨在减小截断误差，似乎为获得更高精度提供了一条可靠的途径。然而，本练习 [@problem_id:3225129] 通过理查森外推法（Richardson extrapolation）讲述了一个发人深省的警示故事。你将看到，在特定条件下，一个理论上更优越的方法如何会极大地放大舍入误差，以至于产生完全无用的结果，从而揭示了理论精度提升在实践中的局限性。", "problem": "考虑使用有限差分和外推策略，对解析函数 $f(x) = \\exp(x)$ 在点 $x_{0} = 0$ 处的导数进行数值逼近。使用以下基本依据：\n\n- 定义：截断误差是在精确算术下，作用于 $f$ 的连续算子的精确值与其离散近似计算值之间的差。舍入误差是在有限精度下表示数和执行算术运算时引入的差异。\n- 经过充分检验的事实：$f$ 在 $x_{0}$ 附近的泰勒展开为有限差分公式提供了渐近描述，可用于设计更高阶的近似。\n\n任务：\n\n1. 从 $f(x_{0} + h)$ 和 $f(x_{0} - h)$ 关于 $x_{0}$ 的泰勒展开出发，推导 $f'(x_{0})$ 的中心差分近似，并确定其截断误差的主阶项。\n2. 使用相同的泰勒展开，构造一个由步长为 $h$ 和 $2h$ 的两个中心差分近似组成的线性组合，以消除主阶 $O(h^{2})$ 截断项。用 $f$、$h$ 和 $x_{0}$ 表示所得的近似，并确定其新的主截断阶。\n3. 现在引入有限精度算术：采用十进制的“四舍六入五成双”规则，保留 $t=8$ 位有效数字。在所有数值计算步骤中，每个 $f(\\cdot)$ 的值在进行任何减法之前都首先舍入到 $t=8$ 位有效数字；每次减法、乘法和除法的结果在进行下一步计算前也舍入到 $t=8$ 位有效数字。\n4. 当 $h = 10^{-9}$ 时，完全在上述有限精度模型下，评估两个中心差分近似以及任务2得到的外推近似。然后计算外推近似的绝对误差，\n   $$ E_{R} = \\left| R(h) - f'(0) \\right|, $$\n   其中 $R(h)$ 表示您在任务2中得到的外推近似，$f'(0)$ 是精确导数。\n5. 将 $E_{R}$ 的最终数值舍入到四位有效数字。不涉及物理单位。\n\n你设置的场景必须证明，外推法在精确算术中减少了截断误差，但在指定的有限精度算术中却显著放大了舍入误差。要求的最终答案是按规定舍入后的单个实数 $E_{R}$。", "solution": "我们从解析函数 $f(x) = \\exp(x)$ 开始，对于该函数，其在 $x_{0} = 0$ 处的所有阶导数都等于1，即，对于所有整数 $k \\geq 0$，都有 $f^{(k)}(0) = 1$。\n\n任务1：推导中心差分近似及其主截断误差。\n\n使用泰勒展开，\n\n$$\nf(x_{0} + h) = f(x_{0}) + f'(x_{0}) h + \\frac{f''(x_{0})}{2} h^{2} + \\frac{f^{(3)}(x_{0})}{6} h^{3} + \\frac{f^{(4)}(x_{0})}{24} h^{4} + \\frac{f^{(5)}(x_{0})}{120} h^{5} + O(h^{6}),\n$$\n\n\n$$\nf(x_{0} - h) = f(x_{0}) - f'(x_{0}) h + \\frac{f''(x_{0})}{2} h^{2} - \\frac{f^{(3)}(x_{0})}{6} h^{3} + \\frac{f^{(4)}(x_{0})}{24} h^{4} - \\frac{f^{(5)}(x_{0})}{120} h^{5} + O(h^{6}),\n$$\n\n它们的差为\n\n$$\nf(x_{0} + h) - f(x_{0} - h) = 2 f'(x_{0}) h + \\frac{f^{(3)}(x_{0})}{3} h^{3} + \\frac{f^{(5)}(x_{0})}{60} h^{5} + O(h^{7}).\n$$\n\n因此，中心差分公式\n\n$$\nD(h) = \\frac{f(x_{0} + h) - f(x_{0} - h)}{2 h}\n$$\n\n满足\n\n$$\nD(h) = f'(x_{0}) + \\frac{f^{(3)}(x_{0})}{6} h^{2} + \\frac{f^{(5)}(x_{0})}{120} h^{4} + O(h^{6}).\n$$\n\n因此，主截断误差为 $O(h^{2})$，其系数为 $\\frac{f^{(3)}(x_{0})}{6}$。\n\n对于在 $x_{0} = 0$ 处的 $f(x) = \\exp(x)$，这简化为\n\n$$\nD(h) = 1 + \\frac{1}{6} h^{2} + \\frac{1}{120} h^{4} + O(h^{6}).\n$$\n\n\n任务2：构造一个消除 $O(h^{2})$ 项的外推近似。\n\n我们考虑一个线性组合 $R(h) = a D(h) + b D(2h)$，并设 $a + b = 1$ 以确保相容性。使用展开式，\n\n$$\nD(2h) = f'(x_{0}) + \\frac{f^{(3)}(x_{0})}{6} (2h)^{2} + \\frac{f^{(5)}(x_{0})}{120} (2h)^{4} + O(h^{6}) = f'(x_{0}) + \\frac{4 f^{(3)}(x_{0})}{6} h^{2} + \\frac{16 f^{(5)}(x_{0})}{120} h^{4} + O(h^{6}).\n$$\n\n要求 $h^{2}$ 项相消，可得\n\n$$\na \\cdot \\frac{f^{(3)}(x_{0})}{6} h^{2} + b \\cdot \\frac{4 f^{(3)}(x_{0})}{6} h^{2} = 0 \\quad \\Longrightarrow \\quad a + 4 b = 0.\n$$\n\n求解 $a + b = 1$ 和 $a + 4 b = 0$ 得 $a = \\frac{4}{3}$ 和 $b = -\\frac{1}{3}$，因此\n\n$$\nR(h) = \\frac{4 D(h) - D(2h)}{3}.\n$$\n\n$h^{4}$ 项变换为\n\n$$\na \\cdot \\frac{f^{(5)}(x_{0})}{120} h^{4} + b \\cdot \\frac{16 f^{(5)}(x_{0})}{120} h^{4} = \\left( \\frac{4}{3} - \\frac{16}{3} \\right) \\frac{f^{(5)}(x_{0})}{120} h^{4} = -\\frac{12}{3} \\cdot \\frac{f^{(5)}(x_{0})}{120} h^{4} = -\\frac{f^{(5)}(x_{0})}{30} h^{4}.\n$$\n\n于是\n\n$$\nR(h) = f'(x_{0}) - \\frac{f^{(5)}(x_{0})}{30} h^{4} + O(h^{6}),\n$$\n\n其主截断误差为 $O(h^{4})$。\n\n对于在 $x_{0} = 0$ 处的 $f(x) = \\exp(x)$，$f^{(5)}(0) = 1$，所以\n\n$$\nR(h) = 1 - \\frac{1}{30} h^{4} + O(h^{6}).\n$$\n\n\n任务3：引入 $t = 8$ 位有效数字的有限精度算术。\n\n我们采用十进制的“四舍六入五成双”规则，保留 $t = 8$ 位有效数字。每次计算 $f(\\cdot)$ 的值在进行任何减法之前都舍入到 $t$ 位有效数字；每次减法、乘法和除法的结果在进行下一步计算前也舍入到 $t$ 位有效数字。\n\n任务4：使用 $h = 10^{-9}$ 进行计算，并求出 $E_{R} = |R(h) - f'(0)|$。\n\n首先，考虑精确值：\n\n$$\nf(h) = \\exp(10^{-9}) = 1 + 10^{-9} + \\frac{1}{2} \\cdot 10^{-18} + O(10^{-27}) \\approx 1.0000000010000000005\\ldots,\n$$\n\n\n$$\nf(-h) = \\exp(-10^{-9}) = 1 - 10^{-9} + \\frac{1}{2} \\cdot 10^{-18} + O(10^{-27}) \\approx 0.9999999990000000005\\ldots.\n$$\n\n将每个值舍入到 $t = 8$ 位有效数字：\n- $f(h)$ 的前8位有效数字是 $1.0000000$，下一位（第九位）有效数字是1，小于5，所以\n\n$$\n\\operatorname{round}_{8}\\big(f(h)\\big) = 1.0000000.\n$$\n\n- 对于 $f(-h)$，前8位有效数字是 $0.99999999$，第九位有效数字是9，大于5，所以舍入到最近的值得到\n\n$$\n\\operatorname{round}_{8}\\big(f(-h)\\big) = 1.0000000.\n$$\n\n因此，在指定的算术规则下，\n\n$$\n\\text{$D(h)$ 的分子}: \\quad \\operatorname{round}_{8}\\big(f(h)\\big) - \\operatorname{round}_{8}\\big(f(-h)\\big) = 1.0000000 - 1.0000000 = 0.00000000,\n$$\n\n在舍入到 $t = 8$ 位有效数字后，结果仍为 $0.00000000$。\n\n除以 $2h = 2 \\cdot 10^{-9}$，并舍入到 $t = 8$ 位有效数字，\n\n$$\nD(h) = \\operatorname{round}_{8}\\left( \\frac{0.00000000}{2 \\cdot 10^{-9}} \\right) = \\operatorname{round}_{8}(0) = 0.00000000.\n$$\n\n\n接下来，我们使用步长 $2h = 2 \\cdot 10^{-9}$ 进行计算：\n\n$$\nf(2h) = \\exp(2 \\cdot 10^{-9}) \\approx 1.000000002000000002\\ldots \\quad \\Rightarrow \\quad \\operatorname{round}_{8}\\big(f(2h)\\big) = 1.0000000 \\quad (\\text{第九位数字 } 2  5),\n$$\n\n\n$$\nf(-2h) = \\exp(-2 \\cdot 10^{-9}) \\approx 0.999999998000000002\\ldots \\quad \\Rightarrow \\quad \\operatorname{round}_{8}\\big(f(-2h)\\big) = 1.0000000 \\quad (\\text{第九位数字 } 8 > 5).\n$$\n\n因此，\n\n$$\n\\text{$D(2h)$ 的分子}: \\quad 1.0000000 - 1.0000000 = 0.00000000,\n$$\n\n并且\n\n$$\nD(2h) = \\operatorname{round}_{8}\\left( \\frac{0.00000000}{4 \\cdot 10^{-9}} \\right) = 0.00000000.\n$$\n\n\n现在构造外推近似\n\n$$\nR(h) = \\operatorname{round}_{8}\\left( \\frac{4 \\cdot D(h) - D(2h)}{3} \\right).\n$$\n\n我们有 $D(h) = 0.00000000$ 和 $D(2h) = 0.00000000$；因此\n\n$$\n4 \\cdot D(h) - D(2h) = 0.00000000,\n$$\n\n除以3并舍入后，\n\n$$\nR(h) = 0.00000000.\n$$\n\n\n最后，使用精确导数 $f'(0) = 1$ 计算绝对误差：\n\n$$\nE_{R} = | R(h) - f'(0) | = | 0 - 1 | = 1.\n$$\n\n\n为了完整性，我们注意到在精确算术下 $R(h)$ 的截断误差是\n\n$$\n\\left| -\\frac{1}{30} h^{4} \\right| = \\frac{1}{30} \\cdot (10^{-9})^{4} = \\frac{1}{30} \\cdot 10^{-36} \\approx 3.333\\ldots \\times 10^{-38},\n$$\n\n这个值远小于在指定的有限精度算术下观察到的舍入误差。这表明理查森外推法将截断误差从 $O(h^{2})$ 降低到 $O(h^{4})$，但是，在这个构造的场景中，由于输入数据和中间运算中的灾难性抵消，它显著放大了舍入误差。\n\n任务5：将最终数值 $E_{R} = 1$ 舍入到四位有效数字。舍入后的值为 $1.000$。", "answer": "$$\\boxed{1.000}$$", "id": "3225129"}]}