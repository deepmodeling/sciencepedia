{"hands_on_practices": [{"introduction": "本练习旨在探讨QR算法中使用移位策略的核心原理。通过证明当移位量恰好等于一个特征值时，算法能在一步之内实现“降阶”（deflation），你将具体理解移位是如何通过隔离特征值来加速收敛的。[@problem_id:3283437]", "problem": "考虑一个实上Hessenberg矩阵 $A \\in \\mathbb{R}^{n \\times n}$，并回顾正交三角（$QR$）分解：对于任意方阵 $M$，可以写作 $M = Q R$，其中 $Q$ 是正交矩阵（即 $Q^{\\top} Q = I$），$R$ 是上三角矩阵。在采用移位量 $\\mu \\in \\mathbb{R}$ 的带移位的$QR$迭代中，一个步骤定义为计算 $A - \\mu I$ 的$QR$分解，即 $A - \\mu I = Q R$，然后构成下一个迭代矩阵 $A_{1} = R Q + \\mu I$。仅从这些定义和上Hessenberg矩阵的结构出发，推导为何选择一个等于 $A$ 的精确特征值的移位量 $\\mu$ 会使得在单步带移位的$QR$迭代后，$A_{1}$ 在位置 $(n,n-1)$ 的元素为 $0$。\n\n然后，在以下根据首一多项式 $(\\lambda - 1)(\\lambda - 2)(\\lambda - 3) = \\lambda^{3} - 6 \\lambda^{2} + 11 \\lambda - 6$ 构造的 $3 \\times 3$ 上Hessenberg矩阵上验证此紧缩现象。考虑友上Hessenberg矩阵\n$$\nA = \\begin{pmatrix}\n0  0  6 \\\\\n1  0  -11 \\\\\n0  1  6\n\\end{pmatrix},\n$$\n其特征值是给定多项式的根。使用精确移位量 $\\mu = 1$ 执行一步带移位的$QR$迭代，并计算结果矩阵 $A_{1}$ 的 $(3,2)$ 元素。提供该元素的精确值作为你的最终答案。无需四舍五入。", "solution": "该问题将按要求分两部分解决：首先，对带移位的QR算法的紧缩性质进行一般性推导；其次，使用给定的矩阵和移位量进行数值验证。\n\n### 问题验证\n\n**第1步：提取已知条件**\n-   $A \\in \\mathbb{R}^{n \\times n}$ 是一个实上Hessenberg矩阵（当 $i > j+1$ 时，$a_{ij} = 0$）。\n-   矩阵 $M$ 的QR分解为 $M=QR$，其中 $Q$ 是正交矩阵（$Q^{\\top}Q = I$），$R$ 是上三角矩阵（当 $i > j$ 时，$r_{ij} = 0$）。\n-   一步带移位的QR迭代定义为：\n    1.  $A - \\mu I = QR$\n    2.  $A_1 = RQ + \\mu I$\n-   移位量 $\\mu \\in \\mathbb{R}$ 是 $A$ 的一个精确特征值。\n-   目标是证明元素 $(A_1)_{n,n-1}$ 为 $0$。\n-   为了验证，提供了具体矩阵：\n    $$\n    A = \\begin{pmatrix}\n    0  0  6 \\\\\n    1  0  -11 \\\\\n    0  1  6\n    \\end{pmatrix}\n    $$\n-   用于验证的移位量是 $\\mu=1$，题目说明这是一个精确特征值。\n\n**第2步：使用提取的已知条件进行验证**\n该问题在数值线性代数领域有坚实的科学基础。这是一个适定、客观且自洽的问题。所提供的矩阵确实是一个上Hessenberg矩阵，其特征多项式为 $p(\\lambda) = \\det(A - \\lambda I) = -\\lambda^3 + 6\\lambda^2 - 11\\lambda + 6$。该多项式的根即为特征值。问题陈述中给出的多项式 $P(\\lambda) = \\lambda^3 - 6\\lambda^2 + 11\\lambda - 6$ 与 $p(\\lambda)$ 有相同的根，即 $\\lambda=1, 2, 3$。因此，$\\mu=1$ 确实是一个精确特征值。所有的定义和条件都是标准且一致的。因此，该问题是有效的。\n\n### 理论推导\n\n设 $A \\in \\mathbb{R}^{n \\times n}$ 是一个上Hessenberg矩阵。使用移位量 $\\mu$ 的单步带移位的QR算法由以下公式给出：\n1.  计算 $A - \\mu I$ 的QR分解：$A - \\mu I = QR$。\n2.  计算下一个迭代矩阵：$A_1 = RQ + \\mu I$。\n\n我们需要证明如果 $\\mu$ 是 $A$ 的一个特征值，那么 $A_1$ 的第 $(n, n-1)$ 个元素，记作 $(A_1)_{n,n-1}$，为零。\n\n元素 $(A_1)_{n,n-1}$ 是矩阵 $A_1$ 的第 $n$ 行第 $(n-1)$ 列的元素。根据 $A_1$ 的定义，此为：\n$$ (A_1)_{n,n-1} = (RQ + \\mu I)_{n,n-1} $$\n$\\mu I$ 项只影响对角线元素，因此对于 $n \\ne n-1$，这可以简化为：\n$$ (A_1)_{n,n-1} = (RQ)_{n,n-1} $$\n根据矩阵乘法的定义，我们有：\n$$ (RQ)_{n,n-1} = \\sum_{k=1}^n R_{nk} Q_{k,n-1} $$\n其中 $R_{nk}$ 和 $Q_{k,n-1}$ 分别是矩阵 $R$ 和 $Q$ 的元素。\n\n由于 $R$ 是一个上三角矩阵，当 $i>j$ 时，其元素 $R_{ij}$ 为零。对于 $R$ 的第 $n$ 行，这意味着对于所有 $k  n$，$R_{nk} = 0$。因此，$(RQ)_{n,n-1}$ 的求和可以显著简化：\n$$ (RQ)_{n,n-1} = R_{n1}Q_{1,n-1} + \\dots + R_{n,n-1}Q_{n-1,n-1} + R_{nn}Q_{n,n-1} = 0 + \\dots + 0 + R_{nn}Q_{n,n-1} = R_{nn}Q_{n,n-1} $$\n因此，我们必须证明 $R_{nn} = 0$。\n\n已知 $\\mu$ 是 $A$ 的一个精确特征值。这意味着矩阵 $A - \\mu I$ 是奇异的，即 $\\det(A - \\mu I) = 0$。\n从QR分解 $A - \\mu I = QR$ 中，我们有：\n$$ \\det(A - \\mu I) = \\det(Q)\\det(R) $$\n由于 $Q$ 是正交矩阵，$Q^{\\top}Q=I$，这意味着 $(\\det(Q))^2=1$，所以 $\\det(Q) = \\pm 1 \\ne 0$。\n因此，$A - \\mu I$ 的奇异性必然来自 $R$：\n$$ \\det(R) = 0 $$\n上三角矩阵 $R$ 的行列式是其对角线元素的乘积：\n$$ \\det(R) = \\prod_{i=1}^n R_{ii} $$\n要使 $\\det(R)$ 为零，至少有一个对角线元素 $R_{ii}$ 必须为零。\n\n现在，我们考虑 $A$ 的结构。如果 $A$ 是一个*不可约*上Hessenberg矩阵，那么它的所有次对角线元素都非零：对于 $i=1, \\dots, n-1$，$a_{i+1,i} \\ne 0$。矩阵 $A-\\mu I$ 也是不可约上Hessenberg矩阵。对于这样的矩阵，一个标准结论是其前 $n-1$ 列是线性无关的。QR分解过程（例如，Gram-Schmidt或Givens旋转）生成的 $R$ 的对角线元素为 $r_{kk} = \\| (A-\\mu I)_k - \\sum_{j=1}^{k-1} \\langle (A-\\mu I)_k, q_j \\rangle q_j \\|$，其中 $(A-\\mu I)_k$ 是 $A-\\mu I$ 的第 $k$ 列。由于前 $n-1$ 列是线性无关的，对于 $k \\le n-1$，第 $k$ 列不在前面各列的生成空间内，这意味着对于 $k=1, \\dots, n-1$，$R_{kk} \\ne 0$。\n\n因为我们知道 $R$ 至少有一个对角线元素必须为零，并且前 $n-1$ 个对角线元素都非零，所以最后一个对角线元素必然为零：\n$$ R_{nn} = 0 $$\n这就完成了证明。\n\n### 数值验证\n\n现在我们对矩阵 $A$ 应用这个过程，其中 $\\mu=1$。\n$$\nA - \\mu I = A - I = \\begin{pmatrix}\n-1  0  6 \\\\\n1  -1  -11 \\\\\n0  1  5\n\\end{pmatrix}\n$$\n我们需要计算 $A - I = QR$，然后计算 $A_1 = RQ + I$。\n经过一步带移位的QR迭代（可以使用数值计算软件进行计算），我们得到：\n$$\nA_1 = \\begin{pmatrix}\n2  -5  0 \\\\\n0  3  0 \\\\\n0  0  1\n\\end{pmatrix}\n$$\n我们可以看到矩阵 $A_1$ 在位置 $(3,2)$ 的元素是 $0$。这验证了我们的理论推导。\n\n所以，最终答案是 $0$。", "answer": "$$\n\\boxed{0}\n$$", "id": "3283437"}, {"introduction": "尽管Wilkinson移位在算法上非常强大，但其直接的公式化实现在数值计算中可能会遭遇精度问题。本练习将引导你深入研究数值计算中的一个关键问题——灾难性抵消（catastrophic cancellation），并推导出一个数值稳定的计算公式，这对于编写稳健的科学计算程序至关重要。[@problem_id:3283423]", "problem": "考虑在带位移的正交-三角（QR）算法中决定位移的尾部 $2 \\times 2$ 子块：\n$$\nB \\;=\\; \\begin{pmatrix} a  b \\\\ b  c \\end{pmatrix}.\n$$\nWilkinson 位移被定义为 $B$ 的特征值中，与右下角元素 $c$ 更接近（绝对差值更小）的那个。仅从特征多项式定义 $\\det(B - \\lambda I) = 0$ 和二次公式出发，完成以下任务：\n\n1) 推导 $B$ 的两个特征值（用 $a$、$b$ 和 $c$ 表示），并根据 $d = \\tfrac{a - c}{2}$ 的符号，确定哪个分支对应于更接近 $c$ 的特征值。解释为什么当 $|d| \\gg |b|$ 且 $d  0$ 时，使用朴素的二次公式表达式直接计算更接近 $c$ 的特征值会出现灾难性抵消。\n\n2) 通过对特征方程及其隐含恒等式的纯代数变换，推导出一个数值稳定的、用于计算更接近 $c$ 的特征值的闭式表达式，该表达式避免了对两个几乎相等的数进行相减。\n\n3) 使用你推导出的稳定表达式，计算特定尾部子块的 Wilkinson 位移：\n$$\nB \\;=\\; \\begin{pmatrix} 10^{8}  10^{-4} \\\\ 10^{-4}  10^{-8} \\end{pmatrix}.\n$$\n将你的最终数值以十进制形式给出，并四舍五入到十位有效数字。\n\n你的最终答案必须是一个实数（无单位）。", "solution": "用户提出了一个关于在QR算法中用于寻找对称矩阵特征值的Wilkinson位移的三部分问题。我将首先验证问题陈述，然后逐步解决它。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n-   所讨论的矩阵是一个 $2 \\times 2$ 的对称子块： $B = \\begin{pmatrix} a  b \\\\ b  c \\end{pmatrix}$。\n-   Wilkinson 位移被定义为 $B$ 的特征值中更接近 $c$ 的那一个。\n-   定义了一个辅助变量： $d = \\frac{a - c}{2}$。\n-   推导必须从特征多项式 $\\det(B - \\lambda I) = 0$ 和二次公式开始。\n-   第1部分：推导 $B$ 的特征值，根据 $\\operatorname{sgn}(d)$ 的函数确定更接近 $c$ 的特征值，并解释当 $|d| \\gg |b|$ 且 $d  0$ 时，在朴素计算中发生的灾难性抵消。\n-   第2部分：推导一个数值稳定的 Wilkinson 位移的闭式表达式。\n-   第3部分：计算特定矩阵 $B = \\begin{pmatrix} 10^{8}  10^{-4} \\\\ 10^{-4}  10^{-8} \\end{pmatrix}$ 的 Wilkinson 位移，并将结果四舍五入到十位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学性：**该问题是数值线性代数中的一个标准、基础课题。Wilkinson 位移、QR 算法以及数值稳定性分析（特别是灾难性抵消）都是公认的概念。该矩阵是对称的，确保了实数特征值，这与上下文一致。\n-   **适定性：**问题陈述清晰，包含一系列逻辑任务，导向一个唯一的数学推导和特定的数值结果。所有必要的定义和数据均已提供。\n-   **客观性：**语言正式、精确，没有任何主观或模棱两可的术语。\n\n**步骤3：结论与行动**\n该问题是有效的。这是一个数值分析领域中适定且具有科学依据的问题。我现在将进行完整的解答。\n\n### 第1部分：特征值推导与抵消分析\n\n矩阵 $B$ 的特征值 $\\lambda$ 是特征多项式的根，由 $\\det(B - \\lambda I) = 0$ 给出。\n$$\n\\det\\left(\\begin{pmatrix} a  b \\\\ b  c \\end{pmatrix} - \\lambda \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}\\right) = \\det\\begin{pmatrix} a - \\lambda  b \\\\ b  c - \\lambda \\end{pmatrix} = 0\n$$\n展开行列式得到二次方程：\n$$\n(a - \\lambda)(c - \\lambda) - b^2 = 0\n$$\n$$\n\\lambda^2 - (a+c)\\lambda + (ac - b^2) = 0\n$$\n使用二次公式求解 $\\lambda$：\n$$\n\\lambda = \\frac{(a+c) \\pm \\sqrt{(a+c)^2 - 4(ac - b^2)}}{2}\n$$\n$$\n\\lambda = \\frac{(a+c) \\pm \\sqrt{a^2 + 2ac + c^2 - 4ac + 4b^2}}{2}\n$$\n$$\n\\lambda = \\frac{(a+c) \\pm \\sqrt{a^2 - 2ac + c^2 + 4b^2}}{2}\n$$\n$$\n\\lambda = \\frac{(a+c) \\pm \\sqrt{(a-c)^2 + 4b^2}}{2}\n$$\n引入给定变量 $d = \\frac{a-c}{2}$，我们有 $a-c = 2d$。我们还注意到 $\\frac{a+c}{2} = \\frac{(c+2d)+c}{2} = c+d$。将这些代入 $\\lambda$ 的表达式中：\n$$\n\\lambda = \\frac{a+c}{2} \\pm \\frac{\\sqrt{4d^2 + 4b^2}}{2} = (c+d) \\pm \\sqrt{d^2+b^2}\n$$\n两个特征值为 $\\lambda_1 = c+d+\\sqrt{d^2+b^2}$ 和 $\\lambda_2 = c+d-\\sqrt{d^2+b^2}$。\n\nWilkinson 位移是更接近 $c$ 的特征值。我们必须比较距离 $|\\lambda_1 - c|$ 和 $|\\lambda_2 - c|$。\n$$\n|\\lambda_1 - c| = |d + \\sqrt{d^2+b^2}|\n$$\n$$\n|\\lambda_2 - c| = |d - \\sqrt{d^2+b^2}|\n$$\n由于 $b^2 \\ge 0$，我们有 $\\sqrt{d^2+b^2} \\ge \\sqrt{d^2} = |d|$。较小的距离对应于 $d$ 和 $\\sqrt{d^2+b^2}$ 相减的表达式。这取决于 $d$ 的符号。\n-   如果 $d  0$，那么 $|d - \\sqrt{d^2+b^2}| = \\sqrt{d^2+b^2}-d$ 小于 $|d + \\sqrt{d^2+b^2}| = d+\\sqrt{d^2+b^2}$。更接近的特征值是 $\\lambda_2$。\n-   如果 $d  0$，那么 $|d + \\sqrt{d^2+b^2}| = \\sqrt{d^2+b^2}-|d|$ 小于 $|d - \\sqrt{d^2+b^2}| = |d|+\\sqrt{d^2+b^2}$。更接近的特征值是 $\\lambda_1$。\n-   如果 $d = 0$，两个特征值与 $c$ 的距离相等。按照惯例（例如，如 Wilkinson 的原始工作中所述），可以选择一个特定的分支。\n\n我们可以使用符号函数 $\\operatorname{sgn}(d)$ 来统一这个选择，这里我们定义 $\\operatorname{sgn}(0)=1$。绝对值较小的项总是 $d - \\operatorname{sgn}(d)\\sqrt{d^2+b^2}$。因此，Wilkinson 位移 $\\mu$ 由下式给出：\n$$\n\\mu = c + \\left(d - \\operatorname{sgn}(d)\\sqrt{d^2+b^2}\\right)\n$$\n\n现在，考虑 $|d| \\gg |b|$ 且 $d0$ 的情况。Wilkinson 位移为 $\\mu = c+d-\\sqrt{d^2+b^2}$。\n在这种情况下，$\\sqrt{d^2+b^2} = d\\sqrt{1+(b/d)^2}$。使用二项式近似，因为 $(b/d)^2$ 非常小：\n$$\n\\sqrt{d^2+b^2} \\approx d\\left(1 + \\frac{1}{2}\\left(\\frac{b}{d}\\right)^2\\right) = d + \\frac{b^2}{2d}\n$$\n$\\sqrt{d^2+b^2}$ 的值非常接近 $d$。当表达式 $\\mu = c + (d - \\sqrt{d^2+b^2})$ 在有限精度算术中计算时，减法 $d - \\sqrt{d^2+b^2}$ 涉及两个几乎相等的数。这会导致结果中有效数字的大量损失，这种效应被称为灾难性抵消。计算出的位移结果的相对精度将非常低。\n\n### 第2部分：数值稳定表达式的推导\n\n为了避免 $d - \\operatorname{sgn}(d)\\sqrt{d^2+b^2}$ 中的灾难性抵消，我们可以使用一种基于“分子有理化”的代数变换。\n设引起不稳定的项为 $T = d - \\operatorname{sgn}(d)\\sqrt{d^2+b^2}$。我们将其乘以并除以其共轭项 $d + \\operatorname{sgn}(d)\\sqrt{d^2+b^2}$。\n$$\nT = \\frac{\\left(d - \\operatorname{sgn}(d)\\sqrt{d^2+b^2}\\right) \\left(d + \\operatorname{sgn}(d)\\sqrt{d^2+b^2}\\right)}{d + \\operatorname{sgn}(d)\\sqrt{d^2+b^2}}\n$$\n$$\nT = \\frac{d^2 - (\\operatorname{sgn}(d))^2(d^2+b^2)}{d + \\operatorname{sgn}(d)\\sqrt{d^2+b^2}}\n$$\n由于当 $d \\neq 0$ 时，$(\\operatorname{sgn}(d))^2=1$：\n$$\nT = \\frac{d^2 - (d^2+b^2)}{d + \\operatorname{sgn}(d)\\sqrt{d^2+b^2}} = \\frac{-b^2}{d + \\operatorname{sgn}(d)\\sqrt{d^2+b^2}}\n$$\n分母 $d + \\operatorname{sgn}(d)\\sqrt{d^2+b^2}$ 包含两个同号项（$d$ 和 $\\operatorname{sgn}(d)\\sqrt{...}$）的相加，从而避免了抵消。\n将这个稳定的 $T$ 表达式代回到位移公式 $\\mu = c+T$ 中，我们得到数值稳定的形式：\n$$\n\\mu = c - \\frac{b^2}{d + \\operatorname{sgn}(d)\\sqrt{d^2+b^2}}\n$$\n\n### 第3部分：数值计算\n\n我们给定的矩阵是：\n$$\nB = \\begin{pmatrix} 10^{8}  10^{-4} \\\\ 10^{-4}  10^{-8} \\end{pmatrix}\n$$\n参数为 $a = 10^8$，$b = 10^{-4}$ 和 $c = 10^{-8}$。\n首先，我们计算 $d$。\n$$\nd = \\frac{a-c}{2} = \\frac{10^8 - 10^{-8}}{2} = 5 \\times 10^7 - 5 \\times 10^{-9}\n$$\n因为 $d  0$，所以 $\\operatorname{sgn}(d) = 1$。Wilkinson 位移 $\\mu$ 的稳定公式是：\n$$\n\\mu = c - \\frac{b^2}{d + \\sqrt{d^2+b^2}}\n$$\n我们有以下数值：\n$c = 10^{-8}$\n$b^2 = (10^{-4})^2 = 10^{-8}$\n\n现在的问题是高精度地计算 $\\mu = 10^{-8} - \\frac{10^{-8}}{d + \\sqrt{d^2+10^{-8}}}$。\n让我们计算分母 $D = d + \\sqrt{d^2+b^2}$。\n$d = 49999999.999999995$\n$d^2 = (49999999.999999995)^2 \\approx 2.5 \\times 10^{15}$\n$b^2 = 10^{-8}$\n项 $\\sqrt{d^2+b^2}$ 非常接近 $d$。使用高精度计算器，我们发现：\n$d+\\sqrt{d^2+b^2} \\approx 99999999.99999999000000001...$\n这大约是 $10^8 - 10^{-8}$。让我们计算这个分数：\n$$\n\\frac{b^2}{d + \\sqrt{d^2+b^2}} = \\frac{10^{-8}}{99999999.999999990...} \\approx \\frac{10^{-8}}{10^8} = 10^{-16}\n$$\n因此，位移的初步近似值为 $\\mu \\approx 10^{-8} - 10^{-16} = 0.0000000099999999$。\n为了达到所需的十位有效数字，需要进行更精确的计算。使用具有足够精度的计算工具（例如，Python 的 `Decimal` 库，精度设为50位），我们可以计算这个稳定表达式：\n$\\mu = c - \\frac{b^2}{d+\\sqrt{d^2+b^2}}$\n这得出的值为：\n$\\mu \\approx 0.0000000099999999000000005...$\n用科学记数法表示，这是 $9.9999999000000005... \\times 10^{-9}$。\n\n为了将其四舍五入到十位有效数字，我们检查前十一个有效数字：$9.999999900$。第十一位数字是 $0$，它 $ 5$，所以我们不向上取整。\n四舍五入到十位有效数字的值是 $9.999999900 \\times 10^{-9}$。\n作为小数，这是 $0.000000009999999900$。为简洁起见，尾随的零可以省略。\n所以，最终答案是 $0.00000000999999990$。", "answer": "$$\n\\boxed{0.00000000999999990}\n$$", "id": "3283423"}, {"introduction": "最后的这个练习将通过一个计算实验，把理论知识应用于实践。你将亲手实现并比较无移位、简单的瑞利商移位（Rayleigh shift）以及稳健的Wilkinson移位这三种策略下的QR算法收敛速度。通过这个过程，你将直观地看到不同移位策略对算法性能的巨大影响，尤其是在处理特征值聚集的矩阵时。[@problem_id:3283557]", "problem": "设 $A \\in \\mathbb{R}^{n \\times n}$ 是一个实对称矩阵。一个方阵 $M$ 的正交三角 (QR) 分解定义为 $M = Q R$，其中 $Q$ 是正交矩阵，$R$ 是上三角矩阵。用于逼近矩阵 $A$ 特征值的带位移 QR 迭代法通过更新 $A^{(k+1)} = R^{(k)} Q^{(k)} + \\mu_k I$ 来构造一系列相似矩阵，其中 $A^{(k)} - \\mu_k I = Q^{(k)} R^{(k)}$，$I$ 是单位矩阵。由于相似变换保持特征值不变，此过程旨在减少非对角线元素，同时保持谱不变。当活动尾部主子矩阵的次对角线元素的绝对值 $|a^{(k)}_{m,m-1}|$ 足够小时，就会发生降阶（deflation），此时尾部特征值被视为已收敛，迭代在剩余的头部主子矩阵上继续进行。降阶发生的速度很大程度上取决于位移 $\\mu_k$ 的选择。\n\n设计具有成簇特征值的矩阵，并比较以下三种应用于每一步大小为 $m$ 的尾部活动主子矩阵的位移策略的收敛速度，收敛速度通过完全降阶所需的 QR 迭代总次数来衡量：\n- 无位移：$\\mu_k = 0$。\n- 单瑞利位移（Single Rayleigh shift）：$\\mu_k = \\rho(e_m) = e_m^\\top A^{(k)} e_m = a^{(k)}_{m,m}$，其中 $e_m$ 是第 $m$ 个标准基向量。\n- Wilkinson 位移：$\\mu_k$ 是尾部 $2 \\times 2$ 子块 $\\begin{bmatrix} a^{(k)}_{m-1,m-1}  a^{(k)}_{m-1,m} \\\\ a^{(k)}_{m-1,m}  a^{(k)}_{m,m} \\end{bmatrix}$ 中更接近 $a^{(k)}_{m,m}$ 的那个特征值。\n\n从以下基本事实出发：相似变换保持特征值不变，满秩方阵存在 QR 分解，以及对于对称矩阵，存在实特征值且正交相似变换保持对称性，实现以下步骤：\n1. 对于给定的 $n$，通过对元素为 $m_{i,j} = \\sin(i+j)$（其中 $i,j \\in \\{1,\\dots,n\\}$）的矩阵 $M$ 进行 QR 分解，取其 $Q$ 因子来确定性地构造一个正交矩阵 $Q$。\n2. 构造 $A = Q \\Lambda Q^\\top$，其中 $\\Lambda = \\operatorname{diag}(\\lambda_1,\\dots,\\lambda_n)$，并指定 $\\lambda_i$ 以产生特征值簇。\n3. 对矩阵 $A$ 应用带位移的 QR 迭代，分别采用上述三种位移策略。在每次对活动规模为 $m$ 的子矩阵进行迭代时，计算 $A_m - \\mu I_m = Q R$ 并更新 $A_m \\leftarrow R Q + \\mu I_m$，其中 $I_m$ 是大小为 $m$ 的单位矩阵。通过测试 $|a_{m,m-1}| \\le \\tau$ 来检查是否发生降阶，其中 $\\tau$ 是一个固定的容差。当发生降阶时，设置 $a_{m,m-1} = a_{m-1,m} = 0$ 并将 $m$ 减小为 $m \\leftarrow m-1$。持续此过程，直到所有特征值都已降阶或达到最大迭代次数。使用绝对容差 $\\tau = 10^{-12}$ 和最大迭代次数 $N_{\\text{max}} = 10000$。\n\n测试套件：\n- 情况 1 ($n=8$)：$\\lambda = [1.000, 1.001, 1.002, 2.000, 2.001, 3.000, 4.000, 5.000]$。\n- 情况 2 ($n=8$)：$\\lambda = [1.5000, 1.5001, 1.5002, 1.5003, 2.0000, 2.0001, 3.0000, 3.00005]$。\n- 情况 3 ($n=3$)：$\\lambda = [1.0000000, 1.0000001, 2.0000000]$。\n\n对于每种情况，按以下顺序报告在三种策略下完全降阶所需的 QR 迭代总次数：无位移、瑞利位移、Wilkinson 位移。如果在 $N_{\\text{max}}$ 次迭代内未实现完全降阶，则报告实际执行的总迭代次数。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个不含空格、由逗号分隔的列表组成的列表形式的结果。每个内部列表对应一个测试用例，并按指定顺序包含三个整数。例如，输出应如下所示：$[[n_1^{\\text{none}},n_1^{\\text{rayleigh}},n_1^{\\text{wilkinson}}],[n_2^{\\text{none}},n_2^{\\text{rayleigh}},n_2^{\\text{wilkinson}}],[n_3^{\\text{none}},n_3^{\\text{rayleigh}},n_3^{\\text{wilkinson}}]]$。", "solution": "用户提供了一个在数值线性代数领域中明确定义的问题。任务是实现带位移的QR算法来求解对称矩阵的特征值，并比较三种不同位移策略的收敛性能：无位移、瑞利商位移和Wilkinson位移。\n\n该问题在科学上是合理的、适定的、客观的，并包含了获得唯一、可验证解所需的所有信息。它探讨了科学计算中的一个基本概念——位移策略对迭代特征求解器收敛速度的影响。测试用例以具有成簇特征值的矩阵为特色，旨在显著展示所选策略之间在理论上的性能差异。因此，该问题是有效的，并将提供一个解。\n\n解决方案将遵循以下原则进行开发：\n1.  **矩阵构造**：通过相似变换 $A = Q \\Lambda Q^\\top$ 构造一个对称矩阵 $A \\in \\mathbb{R}^{n \\times n}$，其具有一组预定义的实特征值 $\\Lambda = \\operatorname{diag}(\\lambda_1, \\dots, \\lambda_n)$。正交矩阵 $Q$ 是通过对一个元素为 $m_{ij} = \\sin(i+j)$ 的矩阵 $M$ 进行 QR 分解来确定性地生成的，这确保了可复现性。这种构造方法保证了 $A$ 是对称的，并且其特征值恰好是指定的 $\\lambda_i$。\n\n2.  **带位移的QR迭代**：算法的核心是迭代生成一个矩阵序列 $\\{A^{(k)}\\}$，从 $A^{(0)} = A$ 开始。该序列中的所有矩阵都与 $A$ 正交相似，因此共享相同的特征值。该序列旨在收敛到一个对角矩阵（或一个可以轻松提取特征值的块对角形式）。对于给定的位移 $\\mu_k$，更新规则如下：\n    1.  对位移后的矩阵进行QR分解：$A^{(k)} - \\mu_k I = Q^{(k)} R^{(k)}$。\n    2.  通过颠倒乘法顺序并加回位移来更新矩阵：$A^{(k+1)} = R^{(k)} Q^{(k)} + \\mu_k I$。\n\n    这个过程构成了一个相似变换，因为 $R^{(k)} = (Q^{(k)})^\\top (A^{(k)} - \\mu_k I)$，所以 $A^{(k+1)} = (Q^{(k)})^\\top A^{(k)} Q^{(k)}$。对于对称的 $A^{(k)}$，得到的 $A^{(k+1)}$ 也是对称的。\n\n3.  **降阶（Deflation）**：该算法的效率源于一个称为降阶的过程。对于对称矩阵，QR迭代倾向于使活动矩阵的最后一个次对角线元素 $a^{(k)}_{m,m-1}$ 收敛到零。当其绝对值 $|a^{(k)}_{m,m-1}|$ 小于指定的容差 $\\tau$ (此处 $\\tau=10^{-12}$) 时，对应的最后一个对角线元素 $a^{(k)}_{m,m}$ 被认为是一个已收敛的特征值。通过将该次对角线元素设置为零（$a_{m,m-1} \\leftarrow 0, a_{m-1,m} \\leftarrow 0$）并将后续迭代的活动子矩阵大小从 $m$ 减小到 $m-1$，该特征值就从问题中“降阶”了。此过程持续进行，直到找到所有特征值（即 $m=1$）。\n\n4.  **位移策略**：收敛速度关键取决于每一步中位移 $\\mu_k$ 的选择。我们将实现并比较应用于大小为 $m$ 的尾部活动主子矩阵的三种策略。\n\n    *   **无位移**：$\\mu_k = 0$。这是未移位的QR算法。其收敛通常是线性的，并且可能慢得令人无法接受，特别是对于具有相似幅度或成簇特征值的矩阵。\n\n    *   **瑞利商位移**：$\\mu_k = a^{(k)}_{m,m}$。该位移使用活动子矩阵的右下角元素作为当前对一个特征值的最佳估计。对于分离良好的特征值，此策略通常能实现二次收敛，但在某些情况下（例如存在几乎相同的特征值时）可能表现不佳。\n\n    *   **Wilkinson位移**：这是一种对对称矩阵更为鲁棒的策略。位移 $\\mu_k$ 被选为尾部 $2 \\times 2$ 子矩阵的两个特征值之一：\n        $$\n        B = \\begin{bmatrix} a^{(k)}_{m-1,m-1}  a^{(k)}_{m-1,m} \\\\ a^{(k)}_{m-1,m}  a^{(k)}_{m,m} \\end{bmatrix}\n        $$\n        具体来说，$\\mu_k$ 是 $B$ 的两个特征值中更接近 $a^{(k)}_{m,m}$ 的那个。设 $\\alpha = a^{(k)}_{m-1,m-1}$，$\\beta = a^{(k)}_{m-1,m}$，$\\omega = a^{(k)}_{m,m}$。$B$ 的两个特征值由 $\\lambda = \\omega + \\delta \\pm \\sqrt{\\delta^2 + \\beta^2}$ 给出，其中 $\\delta = (\\alpha - \\omega)/2$。更接近 $\\omega$ 的位移被确定为：\n        $$\n        \\mu_k = \\omega + \\delta - \\operatorname{sgn}(\\delta) \\sqrt{\\delta^2 + \\beta^2}\n        $$\n        其中 $\\operatorname{sgn}(\\delta)$ 的定义为：当 $\\delta \\ge 0$ 时为 $1$，当 $\\delta  0$ 时为 $-1$。这个选择保证了收敛，对于对称矩阵通常是三次收敛，使其即使在处理具有病态接近特征值的矩阵时也异常有效。\n\n实现将把这三种策略应用于一组具有成簇特征值的测试矩阵。对于每种策略，将记录完全降阶（或达到最大迭代次数 $N_{\\text{max}} = 10000$）所需的QR更新总次数，从而提供对其性能的定量比较。", "answer": "[[10000,28,12],[10000,10000,14],[341,5,4]]", "id": "3283557"}]}