{"hands_on_practices": [{"introduction": "在深入研究复杂的深度学习模型之前，掌握性能评估的基础至关重要。第一个练习 [@problem_id:2524028] 以一个临床诊断的实际场景为例，让你熟练掌握基于混淆矩阵的核心计算。通过计算灵敏度、特异性和预测值等指标，你将为解读任何分类器的结果打下坚实的基础。", "problem": "一个临床微生物学实验室正在评估一种用于快速检测血流病原体的新型实时聚合酶链反应(PCR)检测方法，并使用需氧血培养作为参考标准。在一个指定的评估期内，该检测方法与参考标准被并行应用于同一批患者样本。得到的$2\\times 2$混淆矩阵产生以下计数：真阳性 (TP) $= 94$，假阳性 (FP) $= 6$，假阴性 (FN) $= 10$，以及真阴性 (TN) $= 890$。使用微生物诊断学中诊断性能的基本定义，其中灵敏度是感染个体中检测结果为阳性的概率，特异度是未感染个体中检测结果为阴性的概率，阳性预测值 (PPV) 是在检测结果为阳性的情况下确实感染的概率，阴性预测值 (NPV) 是在检测结果为阴性的情况下确实未感染的概率，而总体准确度是检测结果与参考标准相符的概率，计算灵敏度、特异度、PPV、NPV和准确度的点估计值。\n\n然后，对这五个比例中的每一个，构建基于二项分布模型的$95\\%$置信度的Wilson得分区间，不进行连续性校正。将所有报告值（点估计值和每个置信界限）四舍五入至四位有效数字。将最终值表示为无单位小数（不要使用百分比表示法）。你的最终答案必须按此确切顺序，列出这$15$个数字：灵敏度、其置信下限和上限，特异度、其置信下限和上限，PPV、其置信下限和上限，NPV、其置信下限和上限，准确度、其置信下限和上限。", "solution": "在尝试任何解决方案之前，问题陈述已经过严格验证。\n\n给定的是一个诊断测试评估的 $2 \\times 2$ 混淆矩阵的计数：\n- 真阳性 ($TP$) $= 94$\n- 假阳性 ($FP$) $= 6$\n- 假阴性 ($FN$) $= 10$\n- 真阴性 ($TN$) $= 890$\n\n任务是计算五个标准性能指标的点估计值和$95\\%$的Wilson得分置信区间：灵敏度、特异度、阳性预测值 (PPV)、阴性预测值 (NPV) 和准确度。\n\n这个问题具有科学依据，提法恰当且客观。它提供了一个完整且一致的数据集，是临床微生物学研究的典型。所提供的定义是标准的，规定的统计方法是适当且明确的。不存在科学、逻辑或结构上的缺陷。因此，该问题被裁定为有效，我们继续进行解决方案的正式推导。\n\n首先，我们根据给定的计数确定必要的总数。总体按参考标准（真实情况）和新测试的结果进行分层。\n- 有状况（感染）的总数：$P = TP + FN = 94 + 10 = 104$。\n- 无状况（未感染）的总数：$N = TN + FP = 890 + 6 = 896$。\n- 检测结果为阳性的总数：$T_{P} = TP + FP = 94 + 6 = 100$。\n- 检测结果为阴性的总数：$T_{N} = TN + FN = 890 + 10 = 900$。\n- 总人口：$S = TP + FP + FN + TN = 94 + 6 + 10 + 890 = 1000$。\n\n对每个指标，我们将计算其点估计值 $\\hat{p}$ 及其 $95\\%$ Wilson得分置信区间 $(L, U)$。对于比例 $\\hat{p} = k/n$（其中 $k$ 是 $n$ 次试验中的成功次数），Wilson区间的计算公式为：\n$$ (L, U) = \\frac{1}{1 + \\frac{z^2}{n}} \\left( \\hat{p} + \\frac{z^2}{2n} \\pm z \\sqrt{\\frac{\\hat{p}(1-\\hat{p})}{n} + \\frac{z^2}{4n^2}} \\right) $$\n对于$95\\%$的置信水平，$\\alpha = 0.05$，标准正态变量为 $z = z_{1-\\alpha/2} = z_{0.975} \\approx 1.959964$。所有最终值必须四舍五入至四位有效数字。\n\n1. 灵敏度 (Sens)\n灵敏度是在所有有状况的个体中被正确识别为阳性的比例。\n- 点估计值：$Sens = \\frac{TP}{TP+FN} = \\frac{94}{104} \\approx 0.903846 \\ldots$\n四舍五入至四位有效数字，$Sens = 0.9038$。\n- Wilson区间：此处，$k = 94$ 且 $n = 104$。\n得到的区间是 $[0.831988\\ldots, 0.946928\\ldots]$。\n下限，$L_{Sens} = 0.8320$。\n上限，$U_{Sens} = 0.9469$。\n\n2. 特异度 (Spec)\n特异度是在所有无状况的个体中被正确识别为阴性的比例。\n- 点估计值：$Spec = \\frac{TN}{TN+FP} = \\frac{890}{896} \\approx 0.993303 \\ldots$\n四舍五入至四位有效数字，$Spec = 0.9933$。\n- Wilson区间：此处，$k = 890$ 且 $n = 896$。\n得到的区间是 $[0.985472\\ldots, 0.996928\\ldots]$。\n下限，$L_{Spec} = 0.9855$。\n上限，$U_{Spec} = 0.9969$。\n\n3. 阳性预测值 (PPV)\nPPV是在所有检测结果为阳性的个体中真阳性的比例。\n- 点估计值：$PPV = \\frac{TP}{TP+FP} = \\frac{94}{100} = 0.94$。\n作为具有四位有效数字的小数，$PPV = 0.9400$。\n- Wilson区间：此处，$k = 94$ 且 $n = 100$。\n得到的区间是 $[0.875231\\ldots, 0.972210\\ldots]$。\n下限，$L_{PPV} = 0.8752$。\n上限，$U_{PPV} = 0.9722$。\n\n4. 阴性预测值 (NPV)\nNPV是在所有检测结果为阴性的个体中真阴性的比例。\n- 点估计值：$NPV = \\frac{TN}{TN+FN} = \\frac{890}{900} \\approx 0.988888 \\ldots$\n四舍五入至四位有效数字，$NPV = 0.9889$。\n- Wilson区间：此处，$k = 890$ 且 $n = 900$。\n得到的区间是 $[0.979671\\ldots, 0.993949\\ldots]$。\n下限，$L_{NPV} = 0.9797$。\n上限，$U_{NPV} = 0.9939$。\n\n5. 准确度 (Acc)\n准确度是总人口中正确结果（真阳性和真阴性）的比例。\n- 点估计值：$Acc = \\frac{TP+TN}{TP+FP+FN+TN} = \\frac{94+890}{1000} = \\frac{984}{1000} = 0.984$。\n作为具有四位有效数字的小数，$Acc = 0.9840$。\n- Wilson区间：此处，$k = 984$ 且 $n = 1000$。\n得到的区间是 $[0.974168\\ldots, 0.990126\\ldots]$。\n下限，$L_{Acc} = 0.9742$。\n上限，$U_{Acc} = 0.9901$。\n\n现将所要求的$15$个值（四舍五入至四位有效数字）汇编如下。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.9038  0.8320  0.9469  0.9933  0.9855  0.9969  0.9400  0.8752  0.9722  0.9889  0.9797  0.9939  0.9840  0.9742  0.9901\n\\end{pmatrix}\n}\n$$", "id": "2524028"}, {"introduction": "高准确率分数往往具有误导性，尤其是在处理不平衡数据集时。这个练习 [@problem_id:3181064] 探讨了总体准确率和平衡准确率之间的关键权衡，后者是一种旨在当类别频率不同时提供更公平评估的指标。通过这个假设性比较，你将学会识别何时“优化总预测正确数”的目标会掩盖模型在关键少数类别上的糟糕表现。", "problem": "考虑一个二元分类任务，其数据集大小为 $N = 1000$，高度不平衡，包含 $100$ 个正例和 $900$ 个负例。在该数据集上评估了两个分类器，表示为 $\\mathcal{A}$ 和 $\\mathcal{B}$，它们产生以下混淆矩阵（条目为实例计数）：对于 $\\mathcal{A}$，$\\mathrm{TP} = 20$，$\\mathrm{FN} = 80$，$\\mathrm{TN} = 891$，$\\mathrm{FP} = 9$；对于 $\\mathcal{B}$，$\\mathrm{TP} = 80$，$\\mathrm{FN} = 20$，$\\mathrm{TN} = 810$，$\\mathrm{FP} = 90$。仅使用混淆矩阵各项指标的核心定义以及由它们派生的标准比率，从第一性原理出发，推断每个分类器优化了哪个指标，并判断选择一个优化按类别平均的度量的分类器是否会降低按流行度加权的总体准确率。然后，基于该推理，从以下选项中选择所有正确的陈述。不要假设任何未说明的公式；您的答案应基于混淆矩阵所隐含的计数和比率的定义。\n\nA. 分类器 $\\mathcal{A}$ 的总体准确率高于分类器 $\\mathcal{B}$，但平衡准确率低于分类器 $\\mathcal{B}$；这种模式在不平衡数据中可能出现，因为按类别平均同等对待少数类和多数类。\n\nB. 分类器 $\\mathcal{B}$ 的总体准确率和平衡准确率都高于分类器 $\\mathcal{A}$；优化按类别平均的度量会降低总体准确率的现象不可能发生。\n\nC. 当类别先验概率高度不平衡，且少数类和多数类中的错误被认为同等重要时，或者当少数类的召回率是主要目标时，优化平衡准确率是可取的，因为按类别平均可以抵消流行度的主导作用。\n\nD. 当目标是在每个实例的错分成本相等的情况下最小化错误总数时，优化平衡准确率是不可取的，因为总体准确率已经通过流行度对类别进行了加权。\n\nE. 如果两个分类器具有相同的平衡准确率，那么无论类别是否不平衡，它们的总体准确率也必须相同。", "solution": "首先对问题陈述进行严格的验证过程。\n\n### 步骤1：提取给定信息\n- 数据集总大小：$N = 1000$\n- 正例数量：$P = 100$\n- 负例数量：$N_{neg} = 900$（为避免与总大小 $N$ 混淆，我们用 $N_{neg}$ 表示）\n- 分类器 $\\mathcal{A}$ 的混淆矩阵计数：$\\mathrm{TP}_{\\mathcal{A}} = 20$, $\\mathrm{FN}_{\\mathcal{A}} = 80$, $\\mathrm{TN}_{\\mathcal{A}} = 891$, $\\mathrm{FP}_{\\mathcal{A}} = 9$\n- 分类器 $\\mathcal{B}$ 的混淆矩阵计数：$\\mathrm{TP}_{\\mathcal{B}} = 80$, $\\mathrm{FN}_{\\mathcal{B}} = 20$, $\\mathrm{TN}_{\\mathcal{B}} = 810$, $\\mathrm{FP}_{\\mathcal{B}} = 90$\n\n### 步骤2：使用提取的给定信息进行验证\n该问题位于统计学习中二元分类评估的标准框架内。我们必须验证所提供数据的内部一致性。\n\n1.  **正类计数的一致性：** 正例总数 $P$ 必须等于真正例和假负例的总和（$\\mathrm{TP} + \\mathrm{FN}$）。\n    - 对于分类器 $\\mathcal{A}$：$\\mathrm{TP}_{\\mathcal{A}} + \\mathrm{FN}_{\\mathcal{A}} = 20 + 80 = 100$。这与给定的 $P = 100$ 相符。\n    - 对于分类器 $\\mathcal{B}$：$\\mathrm{TP}_{\\mathcal{B}} + \\mathrm{FN}_{\\mathcal{B}} = 80 + 20 = 100$。这也与给定的 $P = 100$ 相符。\n\n2.  **负类计数的一致性：** 负例总数 $N_{neg}$ 必须等于真负例和假正例的总和（$\\mathrm{TN} + \\mathrm{FP}$）。\n    - 对于分类器 $\\mathcal{A}$：$\\mathrm{TN}_{\\mathcal{A}} + \\mathrm{FP}_{\\mathcal{A}} = 891 + 9 = 900$。这与给定的 $N_{neg} = 900$ 相符。\n    - 对于分类器 $\\mathcal{B}$：$\\mathrm{TN}_{\\mathcal{B}} + \\mathrm{FP}_{\\mathcal{B}} = 810 + 90 = 900$。这也与给定的 $N_{neg} = 900$ 相符。\n\n3.  **数据集总大小的一致性：** 数据集总大小 $N$ 必须等于混淆矩阵所有条目的总和。\n    - 对于分类器 $\\mathcal{A}$：$\\mathrm{TP}_{\\mathcal{A}} + \\mathrm{FN}_{\\mathcal{A}} + \\mathrm{TN}_{\\mathcal{A}} + \\mathrm{FP}_{\\mathcal{A}} = 20 + 80 + 891 + 9 = 1000$。这与给定的 $N=1000$ 相符。\n    - 对于分类器 $\\mathcal{B}$：$\\mathrm{TP}_{\\mathcal{B}} + \\mathrm{FN}_{\\mathcal{B}} + \\mathrm{TN}_{\\mathcal{B}} + \\mathrm{FP}_{\\mathcal{B}} = 80 + 20 + 810 + 90 = 1000$。这也与给定的 $N=1000$ 相符。\n\n该问题在科学上基于已建立的统计理论，问题提法良好，提供了所有必要信息，并且内部一致。不平衡数据集的场景是现实的，在实践中很常见。语言客观而精确。\n\n### 步骤3：结论和行动\n问题陈述是**有效的**。我们继续进行解答。\n\n### 推导与选项分析\n\n我们将从第一性原理出发，为两个分类器推导相关指标。核心指标是真正例率（TPR）、真负例率（TNR）、总体准确率（ACC）和平衡准确率（BA）。设 $P$ 为正例数，$N_{neg}$ 为负例数。\n\n- **真正例率（TPR）** 或 **召回率（Recall）**：$\\mathrm{TPR} = \\frac{\\mathrm{TP}}{P} = \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FN}}$\n- **真负例率（TNR）** 或 **特异度（Specificity）**：$\\mathrm{TNR} = \\frac{\\mathrm{TN}}{N_{neg}} = \\frac{\\mathrm{TN}}{\\mathrm{TN} + \\mathrm{FP}}$\n- **总体准确率（ACC）**：$\\mathrm{ACC} = \\frac{\\mathrm{TP} + \\mathrm{TN}}{P + N_{neg}}$\n- **平衡准确率（BA）**：$\\mathrm{BA} = \\frac{\\mathrm{TPR} + \\mathrm{TNR}}{2}$\n\n给定数据集有 $P=100$ 和 $N_{neg}=900$。\n\n**分类器 $\\mathcal{A}$ 的计算：**\n- $\\mathrm{TPR}_{\\mathcal{A}} = \\frac{\\mathrm{TP}_{\\mathcal{A}}}{P} = \\frac{20}{100} = 0.2$\n- $\\mathrm{TNR}_{\\mathcal{A}} = \\frac{\\mathrm{TN}_{\\mathcal{A}}}{N_{neg}} = \\frac{891}{900} = 0.99$\n- $\\mathrm{ACC}_{\\mathcal{A}} = \\frac{\\mathrm{TP}_{\\mathcal{A}} + \\mathrm{TN}_{\\mathcal{A}}}{P + N_{neg}} = \\frac{20 + 891}{1000} = \\frac{911}{1000} = 0.911$\n- $\\mathrm{BA}_{\\mathcal{A}} = \\frac{\\mathrm{TPR}_{\\mathcal{A}} + \\mathrm{TNR}_{\\mathcal{A}}}{2} = \\frac{0.2 + 0.99}{2} = \\frac{1.19}{2} = 0.595$\n\n**分类器 $\\mathcal{B}$ 的计算：**\n- $\\mathrm{TPR}_{\\mathcal{B}} = \\frac{\\mathrm{TP}_{\\mathcal{B}}}{P} = \\frac{80}{100} = 0.8$\n- $\\mathrm{TNR}_{\\mathcal{B}} = \\frac{\\mathrm{TN}_{\\mathcal{B}}}{N_{neg}} = \\frac{810}{900} = 0.90$\n- $\\mathrm{ACC}_{\\mathcal{B}} = \\frac{\\mathrm{TP}_{\\mathcal{B}} + \\mathrm{TN}_{\\mathcal{B}}}{P + N_{neg}} = \\frac{80 + 810}{1000} = \\frac{890}{1000} = 0.890$\n- $\\mathrm{BA}_{\\mathcal{B}} = \\frac{\\mathrm{TPR}_{\\mathcal{B}} + \\mathrm{TNR}_{\\mathcal{B}}}{2} = \\frac{0.8 + 0.9}{2} = \\frac{1.7}{2} = 0.85$\n\n**比较：**\n- 总体准确率：$\\mathrm{ACC}_{\\mathcal{A}} (0.911) > \\mathrm{ACC}_{\\mathcal{B}} (0.890)$\n- 平衡准确率：$\\mathrm{BA}_{\\mathcal{A}} (0.595)  \\mathrm{BA}_{\\mathcal{B}} (0.85)$\n\n分类器 $\\mathcal{A}$ 偏向于在多数类（负类）上的表现，以极低的 $\\mathrm{TPR}_{\\mathcal{A}}$（0.2）为代价，获得了非常高的 $\\mathrm{TNR}_{\\mathcal{A}}$（0.99）。由于负类的高流行度（90%），该策略最大化了总体准确率。分类器 $\\mathcal{B}$ 在各个类别上的表现更为均衡，实现了较高的 $\\mathrm{TPR}_{\\mathcal{B}}$（0.8）和 $\\mathrm{TNR}_{\\mathcal{B}}$（0.9），从而获得了更高的平衡准确率，但总体准确率略低。\n\n现在，我们评估每个选项。\n\n**A. 分类器 $\\mathcal{A}$ 的总体准确率高于分类器 $\\mathcal{B}$，但平衡准确率低于分类器 $\\mathcal{B}$；这种模式在不平衡数据中可能出现，因为按类别平均同等对待少数类和多数类。**\n- 第一个分句，“分类器 $\\mathcal{A}$ 的总体准确率高于分类器 $\\mathcal{B}$，但平衡准确率低于分类器 $\\mathcal{B}$”，由我们的计算证实（ACC 为 $0.911  0.890$，BA 为 $0.595  0.85$）。\n- 提供的理由是“按类别平均同等对待少数类和多数类”。平衡准确率是按类别准确率（TPR 和 TNR）的算术平均值，给予每个类别 $1/2$ 的权重。总体准确率可以表示为加权平均：$\\mathrm{ACC} = \\pi_P \\cdot \\mathrm{TPR} + \\pi_{N_{neg}} \\cdot \\mathrm{TNR}$，其中 $\\pi_P = P/(P+N_{neg}) = 0.1$ 和 $\\pi_{N_{neg}} = N_{neg}/(P+N_{neg}) = 0.9$ 是类别流行度。负类的高流行度 $\\pi_{N_{neg}}=0.9$ 意味着总体准确率主要由 TNR 主导。平衡准确率的均等权重抵消了这一点。该陈述完全正确。\n- 结论：**正确**。\n\n**B. 分类器 $\\mathcal{B}$ 的总体准确率和平衡准确率都高于分类器 $\\mathcal{A}$；优化按类别平均的度量会降低总体准确率的现象不可能发生。**\n- 第一个分句，“分类器 $\\mathcal{B}$ 的总体准确率更高”，是错误的，因为 $\\mathrm{ACC}_{\\mathcal{B}} = 0.890  \\mathrm{ACC}_{\\mathcal{A}} = 0.911$。\n- 第二个分句，“优化按类别平均的度量会降低总体准确率的现象不可能发生”，也是错误的。这个问题本身就提供了一个反例：分类器 $\\mathcal{B}$ 的平衡准确率显著高于分类器 $\\mathcal{A}$，但总体准确率却更低。选择 $\\mathcal{B}$ 而非 $\\mathcal{A}$（即优化BA）会降低ACC。\n- 结论：**不正确**。\n\n**C. 当类别先验概率高度不平衡，且少数类和多数类中的错误被认为同等重要时，或者当少数类的召回率是主要目标时，优化平衡准确率是可取的，因为按类别平均可以抵消流行度的主导作用。**\n- 这是一个关于平衡准确率效用的概念性陈述。当类别先验概率不平衡时，模型可以通过简单地预测多数类来获得很高的总体准确率。如果两类中的错误“同等重要”，那么像总体准确率这样按流行度对类别表现进行加权的指标是不合适的。平衡准确率给予每个类别的表现相同的权重，满足了这一需求。此外，为了获得高的平衡准确率，分类器不能承受非常低的 TPR（少数类召回率），这使得在少数类召回率很重要时，它成为一个合适的目标。这种行为的原因被正确地确定为“按类别平均抵消了流行度的主导作用”。该陈述清晰而准确地描述了使用平衡准确率的动机。\n- 结论：**正确**。\n\n**D. 当目标是在每个实例的错分成本相等的情况下最小化错误总数时，优化平衡准确率是不可取的，因为总体准确率已经通过流行度对类别进行了加权。**\n- 目标“最小化错误总数”在数学上等同于最小化 $\\mathrm{FN} + \\mathrm{FP}$ 的和。总体准确率定义为 $\\mathrm{ACC} = 1 - \\frac{\\mathrm{FN} + \\mathrm{FP}}{N_{total}}$。因此，最大化总体准确率等同于最小化错误总数。\n- 我们的例子表明，分类器 $\\mathcal{A}$ 具有更高的 ACC（$0.911$）和更少的总错误数（$\\mathrm{FN}_{\\mathcal{A}} + \\mathrm{FP}_{\\mathcal{A}} = 80+9=89$）。分类器 $\\mathcal{B}$ 具有更高的 BA（$0.85$），但总错误数更多（$\\mathrm{FN}_{\\mathcal{B}} + \\mathrm{FP}_{\\mathcal{B}} = 20+90=110$）。如果目标是最小化总错误数，则应首选 $\\mathcal{A}$，即具有更高 ACC 而非更高 BA 的分类器。因此，优化 BA 将是错误的策略。所提供的理由也是正确的：总体准确率实现了这一目标，因为它同等加权每个实例，这意味着类别是按流行度加权的。\n- 结论：**正确**。\n\n**E. 如果两个分类器具有相同的平衡准确率，那么无论类别是否不平衡，它们的总体准确率也必须相同。**\n- 这个陈述可以通过一个反例来证明是错误的。设 $\\mathrm{BA}_{\\mathcal{C}} = \\mathrm{BA}_{\\mathcal{D}}$。这意味着 $\\frac{1}{2}(\\mathrm{TPR}_{\\mathcal{C}} + \\mathrm{TNR}_{\\mathcal{C}}) = \\frac{1}{2}(\\mathrm{TPR}_{\\mathcal{D}} + \\mathrm{TNR}_{\\mathcal{D}})$。总体准确率为 $\\mathrm{ACC} = \\pi_P \\mathrm{TPR} + \\pi_{N_{neg}} \\mathrm{TNR}$。假设我们的不平衡数据集 $\\pi_P = 0.1$ 和 $\\pi_{N_{neg}} = 0.9$。设分类器 $\\mathcal{C}$ 的 $\\mathrm{TPR}_{\\mathcal{C}} = 0.9$ 和 $\\mathrm{TNR}_{\\mathcal{C}} = 0.7$。那么 $\\mathrm{BA}_{\\mathcal{C}} = (0.9+0.7)/2 = 0.8$。其准确率为 $\\mathrm{ACC}_{\\mathcal{C}} = (0.1)(0.9) + (0.9)(0.7) = 0.09 + 0.63 = 0.72$。设分类器 $\\mathcal{D}$ 的 $\\mathrm{TPR}_{\\mathcal{D}} = 0.7$ 和 $\\mathrm{TNR}_{\\mathcal{D}} = 0.9$。那么 $\\mathrm{BA}_{\\mathcal{D}} = (0.7+0.9)/2 = 0.8$。其准确率为 $\\mathrm{ACC}_{\\mathcal{D}} = (0.1)(0.7) + (0.9)(0.9) = 0.07 + 0.81 = 0.88$。在这里，$\\mathrm{BA}_{\\mathcal{C}} = \\mathrm{BA}_{\\mathcal{D}}$，但 $\\mathrm{ACC}_{\\mathcal{C}} \\neq \\mathrm{ACC}_{\\mathcal{D}}$。该陈述是错误的。只有在平衡数据集的特殊情况下，即 $\\pi_P = \\pi_{N_{neg}} = 0.5$，这时 $\\mathrm{ACC} = 0.5(\\mathrm{TPR}+\\mathrm{TNR}) = \\mathrm{BA}$，该陈述才成立。短语“无论类别是否不平衡”使得该陈述绝对是错误的。\n- 结论：**不正确**。", "answer": "$$\\boxed{ACD}$$", "id": "3181064"}, {"introduction": "在多类别分类问题中，数据不平衡的挑战变得更加突出。这最后一个练习 [@problem_id:3181107] 展示了微观平均（micro-averaged）和宏观平均（macro-averaged）指标之间的深刻差异。你将看到，一个分类器如何通过仅仅关注主导类别来获得虚高的总体准确率（以及微观$F_1$分数），而宏观平均则提供了一个更全面、更公平的视角来审视其在所有类别上的综合性能。", "problem": "一个单标签、多类分类器在一个包含三个类别 $C_1$、$C_2$ 和 $C_3$ 的数据集上进行评估。总实例数为 $N = 1000$，真实类别计数为 $|C_1| = 950$、$|C_2| = 40$ 和 $|C_3| = 10$，这使得该数据集高度不平衡。一个 $3 \\times 3$ 的混淆矩阵记录了对于每个真实类别（行），有多少实例被预测为各个类别（列）。假设行按 $(C_1, C_2, C_3)$ 的顺序对应真实类别，列按 $(C_1, C_2, C_3)$ 的顺序对应预测类别。\n\n使用每个类别的精确率、每个类别的召回率及其调和平均数（$F_1$ 分数）的标准定义，将宏平均 $F_1$ 定义为每个类别的 $F_1$ 分数的未加权平均值。通过首先汇总所有类别的真正例、假正例和假阴性，然后根据这些汇总量计算 $F_1$ 分数，来定义微平均 $F_1$。\n\n从下方选择同时满足以下所有条件的混淆矩阵：\n- 总体准确率至少为 $0.90$。\n- 微平均 $F_1$ 至少为 $0.90$。\n- 宏平均 $F_1$ 小于 $0.50$。\n\n选项A：\n$$\n\\begin{bmatrix}\n950  0  0\\\\\n40  0  0\\\\\n10  0  0\n\\end{bmatrix}\n$$\n\n选项B：\n$$\n\\begin{bmatrix}\n930  15  5\\\\\n10  25  5\\\\\n3  2  5\n\\end{bmatrix}\n$$\n\n选项C：\n$$\n\\begin{bmatrix}\n940  5  5\\\\\n30  10  0\\\\\n8  2  0\n\\end{bmatrix}\n$$\n\n选项D：\n$$\n\\begin{bmatrix}\n700  200  50\\\\\n25  5  10\\\\\n5  3  2\n\\end{bmatrix}\n$$\n\n选择所有适用项：A, B, C, D。", "solution": "问题要求我们从给定的混淆矩阵中，找出同时满足三个条件的矩阵：总体准确率至少为 $0.90$，微平均 $F_1$ 分数至少为 $0.90$，以及宏平均 $F_1$ 分数小于 $0.50$。该数据集共有 $N=1000$ 个实例，分布在三个类别 $C_1$、$C_2$ 和 $C_3$ 中，真实类别计数分别为 $|C_1|=950$、$|C_2|=40$ 和 $|C_3|=10$。\n\n首先，我们根据混淆矩阵 $M$ 来定义性能指标，其中 $M_{ij}$ 是真实类别为 $C_i$ 但被预测为类别 $C_j$ 的实例数。\n\n**类别 $C_i$ 的各项指标**：\n- 真正例 ($TP_i$): $TP_i = M_{ii}$\n- 假正例 ($FP_i$): $FP_i = \\left(\\sum_{k=1}^3 M_{ki}\\right) - M_{ii}$ (第 $i$ 列元素之和减去对角线元素)\n- 假阴性 ($FN_i$): $FN_i = \\left(\\sum_{j=1}^3 M_{ij}\\right) - M_{ii}$ (第 $i$ 行元素之和减去对角线元素)\n- 精确率 ($P_i$): $P_i = \\frac{TP_i}{TP_i + FP_i}$。按照惯例，如果 $TP_i + FP_i = 0$，则 $P_i=0$。\n- 召回率 ($R_i$): $R_i = \\frac{TP_i}{TP_i + FN_i} = \\frac{TP_i}{|C_i|}$\n- $F_1$ 分数 ($F_{1,i}$): $F_{1,i} = 2 \\cdot \\frac{P_i \\cdot R_i}{P_i + R_i}$。如果 $P_i + R_i = 0$，则 $F_{1,i}=0$。\n\n**总体和平均指标**：\n- **总体准确率 ($Acc$)**: 这是正确分类实例的比例。\n$$Acc = \\frac{\\sum_{i=1}^3 TP_i}{N} = \\frac{\\sum_{i=1}^3 M_{ii}}{N}$$\n- **微平均 $F_1$ 分数 ($F_{1,micro}$)**: 这是根据汇总计数计算得出的。\n  - 汇总的真正例: $TP_{micro} = \\sum_{i=1}^3 TP_i$\n  - 汇总的假正例: $FP_{micro} = \\sum_{i=1}^3 FP_i$\n  - 汇总的假阴性: $FN_{micro} = \\sum_{i=1}^3 FN_i$\n  在多类、单标签分类中，$FP_{micro} = FN_{micro}$，因为每次错分对于一个类别是假正例，对于另一个类别是假阴性。\n  - 微精确率: $P_{micro} = \\frac{TP_{micro}}{TP_{micro} + FP_{micro}} = \\frac{\\sum_i M_{ii}}{\\sum_i \\sum_k M_{ki}} = \\frac{\\sum_i M_{ii}}{N} = Acc$\n  - 微召回率: $R_{micro} = \\frac{TP_{micro}}{TP_{micro} + FN_{micro}} = \\frac{\\sum_i M_{ii}}{\\sum_i \\sum_j M_{ij}} = \\frac{\\sum_i M_{ii}}{N} = Acc$\n  - 由于 $P_{micro} = R_{micro}$，微平均 $F_1$ 分数与这两者相等：$F_{1,micro} = P_{micro} = R_{micro} = Acc$。\n- **宏平均 $F_1$ 分数 ($F_{1,macro}$)**: 这是每个类别的 $F_1$ 分数的未加权平均值。\n$$F_{1,macro} = \\frac{1}{3} \\sum_{i=1}^3 F_{1,i}$$\n\n**需要检查的条件**：\n1. $Acc \\ge 0.90$\n2. $F_{1,micro} \\ge 0.90$ (这与条件1相同)\n3. $F_{1,macro}  0.50$\n\n我们现在来评估每个选项。\n\n### 选项A\n混淆矩阵为：\n$$ M_A = \\begin{bmatrix} 950  0  0\\\\ 40  0  0\\\\ 10  0  0 \\end{bmatrix} $$\n1.  **准确率和微平均F1**：对角线元素之和为 $950+0+0 = 950$。\n    $Acc = F_{1,micro} = \\frac{950}{1000} = 0.95$。\n    由于 $0.95 \\ge 0.90$，前两个条件得到满足。\n\n2.  **宏平均F1**：\n    -   **类别 $C_1$**：$TP_1=950$, $FN_1=0$。第1列的和为 $950+40+10=1000$，因此 $FP_1=1000-950=50$。\n        $P_1 = \\frac{950}{950+50} = \\frac{950}{1000} = 0.95$。\n        $R_1 = \\frac{950}{950+0} = 1$。\n        $F_{1,1} = 2 \\cdot \\frac{0.95 \\cdot 1}{0.95+1} = \\frac{1.9}{1.95} = \\frac{38}{39}$。\n    -   **类别 $C_2$**：$TP_2=0$, $FN_2=40$。第2列的和为 $0$，因此 $FP_2=0$。\n        $P_2 = \\frac{0}{0+0} = 0$ (按照惯例)。\n        $R_2 = \\frac{0}{0+40} = 0$。\n        $F_{1,2} = 0$。\n    -   **类别 $C_3$**：$TP_3=0$, $FN_3=10$。第3列的和为 $0$，因此 $FP_3=0$。\n        $P_3 = \\frac{0}{0+0} = 0$ (按照惯例)。\n        $R_3 = \\frac{0}{0+10} = 0$。\n        $F_{1,3} = 0$。\n    -   **宏平均F1计算**：\n        $F_{1,macro} = \\frac{1}{3} \\left( \\frac{38}{39} + 0 + 0 \\right) = \\frac{38}{117} \\approx 0.3248$。\n        由于 $0.3248  0.50$，第三个条件得到满足。\n\n**选项A的结论**：正确。\n\n### 选项B\n混淆矩阵为：\n$$ M_B = \\begin{bmatrix} 930  15  5\\\\ 10  25  5\\\\ 3  2  5 \\end{bmatrix} $$\n1.  **准确率和微平均F1**：对角线元素之和为 $930+25+5 = 960$。\n    $Acc = F_{1,micro} = \\frac{960}{1000} = 0.96$。\n    由于 $0.96 \\ge 0.90$，前两个条件得到满足。\n\n2.  **宏平均F1**：\n    -   **类别 $C_1$**：$TP_1=930$, $FN_1=15+5=20$, $FP_1=10+3=13$。\n        $P_1 = \\frac{930}{930+13} = \\frac{930}{943}$。$R_1 = \\frac{930}{930+20} = \\frac{930}{950}$。\n        $F_{1,1} = 2 \\cdot \\frac{P_1 R_1}{P_1+R_1} = \\frac{2 \\cdot \\frac{930}{943} \\cdot \\frac{930}{950}}{\\frac{930}{943} + \\frac{930}{950}} = \\frac{2}{\\frac{943}{930} + \\frac{950}{930}} = \\frac{1860}{1893} \\approx 0.9826$。\n    -   **类别 $C_2$**：$TP_2=25$, $FN_2=10+5=15$, $FP_2=15+2=17$。\n        $P_2 = \\frac{25}{25+17} = \\frac{25}{42}$。$R_2 = \\frac{25}{25+15} = \\frac{25}{40}$。\n        $F_{1,2} = \\frac{2}{\\frac{42}{25} + \\frac{40}{25}} = \\frac{50}{82} = \\frac{25}{41} \\approx 0.6098$。\n    -   **类别 $C_3$**：$TP_3=5$, $FN_3=3+2=5$, $FP_3=5+5=10$。\n        $P_3 = \\frac{5}{5+10} = \\frac{5}{15} = \\frac{1}{3}$。$R_3 = \\frac{5}{5+5} = \\frac{5}{10} = \\frac{1}{2}$。\n        $F_{1,3} = 2 \\cdot \\frac{\\frac{1}{3} \\cdot \\frac{1}{2}}{\\frac{1}{3}+\\frac{1}{2}} = 2 \\cdot \\frac{\\frac{1}{6}}{\\frac{5}{6}} = \\frac{2}{5} = 0.4$。\n    -   **宏平均F1计算**：\n        $F_{1,macro} = \\frac{1}{3} \\left( \\frac{1860}{1893} + \\frac{25}{41} + 0.4 \\right) \\approx \\frac{1}{3} (0.9826 + 0.6098 + 0.4) \\approx \\frac{1.9924}{3} \\approx 0.6641$。\n        由于 $0.6641 \\not 0.50$，第三个条件未得到满足。\n\n**选项B的结论**：错误。\n\n### 选项C\n混淆矩阵为：\n$$ M_C = \\begin{bmatrix} 940  5  5\\\\ 30  10  0\\\\ 8  2  0 \\end{bmatrix} $$\n1.  **准确率和微平均F1**：对角线元素之和为 $940+10+0=950$。\n    $Acc = F_{1,micro} = \\frac{950}{1000} = 0.95$。\n    由于 $0.95 \\ge 0.90$，前两个条件得到满足。\n\n2.  **宏平均F1**：\n    -   **类别 $C_1$**：$TP_1=940$, $FN_1=5+5=10$, $FP_1=30+8=38$。\n        $P_1 = \\frac{940}{940+38} = \\frac{940}{978}$。$R_1 = \\frac{940}{940+10} = \\frac{940}{950}$。\n        $F_{1,1} = \\frac{2}{\\frac{978}{940} + \\frac{950}{940}} = \\frac{1880}{1928} = \\frac{235}{241} \\approx 0.9751$。\n    -   **类别 $C_2$**：$TP_2=10$, $FN_2=30+0=30$, $FP_2=5+2=7$。\n        $P_2 = \\frac{10}{10+7} = \\frac{10}{17}$。$R_2 = \\frac{10}{10+30} = \\frac{10}{40} = \\frac{1}{4}$。\n        $F_{1,2} = \\frac{2}{\\frac{17}{10} + \\frac{40}{10}} = \\frac{20}{57} \\approx 0.3509$。\n    -   **类别 $C_3$**：$TP_3=0$, $FN_3=8+2=10$, $FP_3=5+0=5$。\n        $P_3 = \\frac{0}{0+5} = 0$。$R_3 = \\frac{0}{0+10} = 0$。\n        $F_{1,3} = 0$。\n    -   **宏平均F1计算**：\n        $F_{1,macro} = \\frac{1}{3} \\left( \\frac{235}{241} + \\frac{20}{57} + 0 \\right) \\approx \\frac{1}{3} (0.9751 + 0.3509) \\approx \\frac{1.3260}{3} \\approx 0.4420$。\n        由于 $0.4420  0.50$，第三个条件得到满足。\n\n**选项C的结论**：正确。\n\n### 选项D\n混淆矩阵为：\n$$ M_D = \\begin{bmatrix} 700  200  50\\\\ 25  5  10\\\\ 5  3  2 \\end{bmatrix} $$\n1.  **准确率和微平均F1**：对角线元素之和为 $700+5+2=707$。\n    $Acc = F_{1,micro} = \\frac{707}{1000} = 0.707$。\n    由于 $0.707 \\not\\ge 0.90$，前两个条件未得到满足。我们无需继续进行分析。\n\n**选项D的结论**：错误。\n\n综上所述，只有选项A和C满足所有三个指定标准。", "answer": "$$\\boxed{AC}$$", "id": "3181107"}]}