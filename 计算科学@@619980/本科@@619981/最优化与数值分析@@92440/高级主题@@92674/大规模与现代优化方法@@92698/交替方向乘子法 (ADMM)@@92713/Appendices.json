{"hands_on_practices": [{"introduction": "掌握交替方向乘子法（ADMM）的第一步是理解如何求解其子问题。本练习将引导你推导 ADMM 迭代中最核心的一个环节：$x$变量的更新步骤。我们将探讨当目标函数 $f(x)$ 是一个简单的二次函数时，如何得到一个解析的闭式解，这为高效计算奠定了基础 [@problem_id:2153727]。", "problem": "交替方向乘子法 (ADMM) 是一种求解如下形式优化问题的算法：\n$$ \\min_{x, z} f(x) + g(z) $$\n$$ \\text{subject to } Ax + Bz = b $$\n其中变量为 $x \\in \\mathbb{R}^n$ 和 $z \\in \\mathbb{R}^m$，问题数据由矩阵 $A \\in \\mathbb{R}^{p \\times n}$、$B \\in \\mathbb{R}^{p \\times m}$、向量 $b \\in \\mathbb{R}^p$ 以及凸函数 $f: \\mathbb{R}^n \\to \\mathbb{R}$ 和 $g: \\mathbb{R}^m \\to \\mathbb{R}$ 给出。\n\n该算法基于增广拉格朗日函数：\n$$ L_\\rho(x, z, y) = f(x) + g(z) + y^T(Ax + Bz - b) + \\frac{\\rho}{2}\\|Ax + Bz - b\\|_2^2 $$\n其中 $y \\in \\mathbb{R}^p$ 是对偶变量（或拉格朗日乘子），$\\rho > 0$ 是一个惩罚参数。在每次迭代 $k$ 中，ADMM 顺序执行以下更新步骤：\n1.  $x^{k+1} := \\arg\\min_x L_\\rho(x, z^k, y^k)$\n2.  $z^{k+1} := \\arg\\min_z L_\\rho(x^{k+1}, z, y^k)$\n3.  $y^{k+1} := y^k + \\rho(Ax^{k+1} + Bz^{k+1} - b)$\n\n考虑该问题的一个具体实例，其中函数 $f(x)$ 定义为一个二次函数：\n$$ f(x) = \\frac{1}{2}\\|x - c\\|_2^2 $$\n对于一个给定的常数向量 $c \\in \\mathbb{R}^n$。\n\n推导 $x$ 更新步骤 $x^{k+1}$ 的闭式解析表达式。你的表达式应使用问题数据 $A, B, b, c$、惩罚参数 $\\rho$ 以及上一次迭代的值 $z^k$ 和 $y^k$ 来表示。在推导过程中，令 $I$ 表示 $n \\times n$ 的单位矩阵，并假设矩阵 $(I + \\rho A^T A)$ 是可逆的。", "solution": "我们通过在固定 $z^{k}$ 和 $y^{k}$ 的同时，对增广拉格朗日函数关于 $x$ 进行最小化，来推导 $x$ 的更新步骤。$x$ 子问题为\n$$\nx^{k+1} := \\arg\\min_{x}\\left\\{\\frac{1}{2}\\|x-c\\|_{2}^{2} + (y^{k})^{T}(Ax + B z^{k} - b) + \\frac{\\rho}{2}\\|Ax + B z^{k} - b\\|_{2}^{2}\\right\\}.\n$$\n定义 $d := B z^{k} - b$，则目标函数变为\n$$\n\\frac{1}{2}\\|x-c\\|_{2}^{2} + (y^{k})^{T}(A x + d) + \\frac{\\rho}{2}\\|A x + d\\|_{2}^{2}.\n$$\n与 $x$ 无关的项不影响最小化结果，因此我们只关注与 $x$ 相关的部分。对 $x$ 求梯度并令其为零，可得\n$$\n\\nabla_{x}\\left(\\frac{1}{2}\\|x-c\\|_{2}^{2}\\right) + \\nabla_{x}\\left((y^{k})^{T}A x\\right) + \\nabla_{x}\\left(\\frac{\\rho}{2}\\|A x + d\\|_{2}^{2}\\right) = 0,\n$$\n化简为\n$$\n(x - c) + A^{T} y^{k} + \\rho A^{T}(A x + d) = 0.\n$$\n合并关于 $x$ 的项，得到\n$$\n\\left(I + \\rho A^{T}A\\right) x = c - A^{T} y^{k} - \\rho A^{T} d.\n$$\n代入 $d = B z^{k} - b$，我们有\n$$\n\\left(I + \\rho A^{T}A\\right) x = c - A^{T} y^{k} - \\rho A^{T}(B z^{k} - b).\n$$\n在 $\\left(I + \\rho A^{T}A\\right)$ 是可逆的假设下，唯一的最小化解为\n$$\nx^{k+1} = \\left(I + \\rho A^{T}A\\right)^{-1}\\left(c - A^{T} y^{k} - \\rho A^{T}(B z^{k} - b)\\right).\n$$", "answer": "$$\\boxed{\\left(I+\\rho A^{T}A\\right)^{-1}\\left(c-A^{T}y^{k}-\\rho A^{T}\\left(Bz^{k}-b\\right)\\right)}$$", "id": "2153727"}, {"introduction": "ADMM 的强大之处在于其能优雅地处理各种约束。这个练习将向你展示一种关键技巧：如何通过指示函数将一个复杂的约束条件转化为一个几何投影操作。理解这个过程对于将复杂的约束优化问题转化为一系列更简单的 ADMM 迭代至关重要 [@problem_id:2153782]。", "problem": "我们考虑一个如下形式的优化问题：\n$$\n\\begin{aligned}\n& \\underset{x, z}{\\text{minimize}}\n& & f(x) + g(z) \\\\\n& \\text{subject to}\n& & x - z = 0\n\\end{aligned}\n$$\n其中 $f$ 和 $g$ 是凸函数。该问题可以使用交替方向乘子法（Alternating Direction Method of Multipliers, ADMM）来求解。该问题的缩放形式增广拉格朗日函数为：\n$$L_{\\rho}(x, z, u) = f(x) + g(z) + \\frac{\\rho}{2} \\|x - z + u\\|_2^2$$\n其中 $\\rho > 0$ 是一个惩罚参数，$u$ 是缩放对偶变量。ADMM 算法通过以下迭代更新进行：\n1. $x^{k+1} := \\arg\\min_{x} \\left( f(x) + \\frac{\\rho}{2} \\|x - z^k + u^k\\|_2^2 \\right)$\n2. $z^{k+1} := \\arg\\min_{z} \\left( g(z) + \\frac{\\rho}{2} \\|x^{k+1} - z + u^k\\|_2^2 \\right)$\n3. $u^{k+1} := u^k + x^{k+1} - z^{k+1}$\n\n假设函数 $g(z)$ 是一个非空闭凸集 $\\mathcal{C}$ 的指示函数。指示函数 $I_{\\mathcal{C}}(z)$ 定义为：\n$$\nI_{\\mathcal{C}}(z) = \\begin{cases} 0 & \\text{if } z \\in \\mathcal{C} \\\\ \\infty & \\text{if } z \\notin \\mathcal{C} \\end{cases}\n$$\n确定 $z$-更新（$z^{k+1}$）的闭式表达式。您的答案应使用投影算子 $\\Pi_{\\mathcal{C}}$、变量 $x^{k+1}$ 和缩放对偶变量 $u^k$ 来表示。一个向量 $v$ 到集合 $\\mathcal{C}$ 上的投影定义为 $\\Pi_{\\mathcal{C}}(v) = \\arg\\min_{w \\in \\mathcal{C}} \\|w - v\\|_2^2$。", "solution": "我们从缩放 ADMM 迭代中的 $z$-更新开始：\n$$\nz^{k+1} := \\arg\\min_{z} \\left( g(z) + \\frac{\\rho}{2} \\|x^{k+1} - z + u^{k}\\|_{2}^{2} \\right).\n$$\n当 $g(z)=I_{\\mathcal{C}}(z)$ 时，只要 $z \\notin \\mathcal{C}$，目标函数就为无穷大；当 $z \\in \\mathcal{C}$ 时，目标函数等于二次项。因此，最小化问题等价于\n$$\nz^{k+1} = \\arg\\min_{z \\in \\mathcal{C}} \\frac{\\rho}{2} \\|x^{k+1} - z + u^{k}\\|_{2}^{2}.\n$$\n由于 $\\rho>0$ 是一个正标量，将目标函数乘以一个正常数不会改变最小化点，因此我们可以去掉因子 $\\rho/2$ 而不影响 argmin：\n$$\nz^{k+1} = \\arg\\min_{z \\in \\mathcal{C}} \\|x^{k+1} - z + u^{k}\\|_{2}^{2}.\n$$\n利用欧几里得范数的对称性，我们将范数内的表达式重写为\n$$\n\\|x^{k+1} - z + u^{k}\\|_{2}^{2} = \\|z - (x^{k+1} + u^{k})\\|_{2}^{2}.\n$$\n因此，\n$$\nz^{k+1} = \\arg\\min_{z \\in \\mathcal{C}} \\|z - (x^{k+1} + u^{k})\\|_{2}^{2}.\n$$\n根据投影算子 $\\Pi_{\\mathcal{C}}(v) = \\arg\\min_{w \\in \\mathcal{C}} \\|w - v\\|_{2}^{2}$ 的定义，我们识别出 $v = x^{k+1} + u^{k}$，并获得闭式更新\n$$\nz^{k+1} = \\Pi_{\\mathcal{C}}(x^{k+1} + u^{k}).\n$$\n这就是 $x^{k+1} + u^{k}$ 到集合 $\\mathcal{C}$ 上的投影。", "answer": "$$\\boxed{\\Pi_{\\mathcal{C}}(x^{k+1}+u^{k})}$$", "id": "2153782"}, {"introduction": "在掌握了 ADMM 各个更新步骤的理论推导后，现在是时候将其付诸实践了。本练习将通过一个具体的资源分配问题，带你完整计算 ADMM 的第一次迭代。你将需要应用前面学到的原理，代入数值并求解线性方程组，从而体验从理论到实际计算的全过程 [@problem_id:2153755]。", "problem": "考虑一个简化的资源分配问题，我们希望确定一个状态向量 $x \\in \\mathbb{R}^n$，使其尽可能接近一个给定的目标状态 $c \\in \\mathbb{R}^n$，同时满足由 $Bx = z_{target}$ 给出的一组共 $k$ 个线性约束，其中 $B \\in \\mathbb{R}^{k \\times n}$ 且 $z_{target} \\in \\mathbb{R}^k$。该优化问题被表述为：\n$$ \\min_{x \\in \\mathbb{R}^n} \\frac{1}{2}\\|x-c\\|_2^2 \\quad \\text{subject to} \\quad Bx = z_{target} $$\n\n为了解决这个问题，我们可以使用交替方向乘子法（ADMM）。首先通过引入一个辅助变量 $z \\in \\mathbb{R}^k$ 将问题转化为ADMM的标准形式：\n$$ \\min_{x, z} f(x) + g(z) \\quad \\text{subject to} \\quad Bx - z = 0 $$\n其中 $f(x) = \\frac{1}{2}\\|x-c\\|_2^2$ 且 $g(z)$ 是点 $z_{target}$ 的指示函数，即如果 $z=z_{target}$，则 $g(z) = 0$；否则 $g(z) = \\infty$。\n\nADMM算法对迭代计数器 $j=0, 1, 2, \\dots$ 迭代以下步骤：\n1. $x^{(j+1)} := \\arg\\min_x \\left( f(x) + \\frac{\\rho}{2}\\|Bx - z^{(j)} + u^{(j)}\\|_2^2 \\right)$\n2. $z^{(j+1)} := \\arg\\min_z \\left( g(z) + \\frac{\\rho}{2}\\|Bx^{(j+1)} - z + u^{(j)}\\|_2^2 \\right)$\n3. $u^{(j+1)} := u^{(j)} + Bx^{(j+1)} - z^{(j+1)}$\n\n此处，$u$ 是缩放对偶变量，$\\rho > 0$ 是一个给定的罚参数。\n\n给定问题的具体数值如下：\n- 状态向量的维度，$n=4$。\n- 线性约束的数量，$k=2$。\n- 约束矩阵 $B = \\begin{pmatrix} 1 & 1 & 1 & 0 \\\\ 0 & 1 & 0 & 1 \\end{pmatrix}$。\n- 目标状态向量 $c = \\begin{pmatrix} 10 \\\\ 2 \\\\ 5 \\\\ 7 \\end{pmatrix}$。\n- 约束的目标值 $z_{target} = \\begin{pmatrix} 12 \\\\ 13 \\end{pmatrix}$。\n- 罚参数 $\\rho = 3$。\n- 初始辅助变量 $z^{(0)} = \\begin{pmatrix} 12 \\\\ 13 \\end{pmatrix}$。\n- 初始缩放对偶变量 $u^{(0)} = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。\n\n你的任务是计算第一次迭代（$j=0$）后的状态向量 $x^{(1)}$。具体来说，计算向量 $x^{(1)}$ 的第一个分量，记为 $x_1^{(1)}$。答案以实数形式给出，并四舍五入到四位有效数字。", "solution": "我们在 $j=0$ 时使用ADMM的 $x$-更新步骤：\n$$\nx^{(1)}=\\arg\\min_{x}\\left(\\frac{1}{2}\\|x-c\\|_{2}^{2}+\\frac{\\rho}{2}\\|Bx-z^{(0)}+u^{(0)}\\|_{2}^{2}\\right).\n$$\n这是一个严格凸二次问题；令梯度为零可得正规方程\n$$\n(x-c)+\\rho B^{\\top}(Bx-z^{(0)}+u^{(0)})=0 \\;\\;\\Longrightarrow\\;\\; (I+\\rho B^{\\top}B)x=c+\\rho B^{\\top}(z^{(0)}-u^{(0)}).\n$$\n根据给定的数据，\n$$\nB=\\begin{pmatrix}1&1&1&0\\\\0&1&0&1\\end{pmatrix},\\quad \\rho=3,\\quad c=\\begin{pmatrix}10\\\\2\\\\5\\\\7\\end{pmatrix},\\quad z^{(0)}=\\begin{pmatrix}12\\\\13\\end{pmatrix},\\quad u^{(0)}=\\begin{pmatrix}1\\\\-1\\end{pmatrix}.\n$$\n计算\n$$\nB^{\\top}=\\begin{pmatrix}1&0\\\\1&1\\\\1&0\\\\0&1\\end{pmatrix},\\quad B^{\\top}B=\\begin{pmatrix}1&1&1&0\\\\1&2&1&1\\\\1&1&1&0\\\\0&1&0&1\\end{pmatrix},\n$$\n因此\n$$\nA:=I+\\rho B^{\\top}B=\\begin{pmatrix}4&3&3&0\\\\3&7&3&3\\\\3&3&4&0\\\\0&3&0&4\\end{pmatrix}。\n$$\n接下来，\n$$\nd:=z^{(0)}-u^{(0)}=\\begin{pmatrix}11\\\\14\\end{pmatrix},\\quad B^{\\top}d=\\begin{pmatrix}11\\\\25\\\\11\\\\14\\end{pmatrix},\\quad \\rho B^{\\top}d=\\begin{pmatrix}33\\\\75\\\\33\\\\42\\end{pmatrix},\n$$\n所以\n$$\nb:=c+\\rho B^{\\top}(z^{(0)}-u^{(0)})=\\begin{pmatrix}43\\\\77\\\\38\\\\49\\end{pmatrix}。\n$$\n我们求解 $Ax=b$，即，\n$$\n\\begin{cases}\n4x_{1}+3x_{2}+3x_{3}=43,\\\\\n3x_{1}+7x_{2}+3x_{3}+3x_{4}=77,\\\\\n3x_{1}+3x_{2}+4x_{3}=38,\\\\\n3x_{2}+4x_{4}=49.\n\\end{cases}\n$$\n由第一个和第三个方程，相减可得 $x_{1}-x_{3}=5$，因此 $x_{1}=x_{3}+5$。使用第三个方程，\n$$\n3(x_{3}+5)+3x_{2}+4x_{3}=38 \\;\\;\\Longrightarrow\\;\\; 3x_{2}+7x_{3}=23.\n$$\n由第四个方程， $x_{4}=(49-3x_{2})/4$。将 $x_{1}=x_{3}+5$ 和 $x_{4}$ 代入第二个方程：\n$$\n3(x_{3}+5)+7x_{2}+3x_{3}+3\\frac{49-3x_{2}}{4}=77,\n$$\n化简为\n$$\n19x_{2}+24x_{3}=101.\n$$\n解线性方程组\n$$\n\\begin{cases}\n3x_{2}+7x_{3}=23,\\\\\n19x_{2}+24x_{3}=101,\n\\end{cases}\n$$\n可得 $x_{3}=\\frac{134}{61}$ 和 $x_{2}=\\frac{155}{61}$。因此，\n$$\nx_{1}=x_{3}+5=\\frac{134}{61}+5=\\frac{439}{61}.\n$$\n因此第一个分量是 $x_{1}^{(1)}=\\frac{439}{61}\\approx 7.196721\\ldots$，四舍五入到四位有效数字为 $7.197$。", "answer": "$$\\boxed{7.197}$$", "id": "2153755"}]}