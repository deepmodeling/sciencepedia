{"hands_on_practices": [{"introduction": "贝叶斯优化的核心在于其智能的采样策略，而这正是由“采集函数”驱动的。采集函数是指导我们下一步应该在何处评估目标函数的“大脑”。这个练习将带你动手实践最经典的采集函数之一——上置信界（UCB）。通过具体计算，你将亲身体会UCB如何巧妙地平衡“利用”（在已知的高性能区域进行精细搜索）和“探索”（在不确定的区域进行冒险尝试），从而高效地找到最优解 [@problem_id:2156656]。", "problem": "一位数据科学家正在使用贝叶斯优化和一个高斯过程代理模型来为一个机器学习模型调整超参数 $\\lambda$。目标是最大化模型的验证准确率。经过一组初始评估后，代理模型为 $\\lambda$ 的五个候选值提供了以下后验统计数据（平均准确率 $\\mu$ 和准确率标准差 $\\sigma$）：\n\n*   点 A：$\\lambda = 0.10$，平均准确率 $\\mu = 0.915$，标准差 $\\sigma = 0.010$\n*   点 B：$\\lambda = 0.25$，平均准确率 $\\mu = 0.920$，标准差 $\\sigma = 0.005$\n*   点 C：$\\lambda = 0.50$，平均准确率 $\\mu = 0.890$，标准差 $\\sigma = 0.025$\n*   点 D：$\\lambda = 0.75$，平均准确率 $\\mu = 0.910$，标准差 $\\sigma = 0.014$\n*   点 E：$\\lambda = 0.90$，平均准确率 $\\mu = 0.905$，标准差 $\\sigma = 0.018$\n\n该数据科学家正在使用上置信界（UCB）采集函数来决定接下来要评估哪个 $\\lambda$ 值。UCB 策略定义为选择使量 $A(x) = \\mu(x) + \\kappa \\sigma(x)$ 最大化的点 $x$。在此优化步骤中，探索-利用权衡参数设为 $\\kappa = 2.5$。\n\n基于 UCB 采集函数，将选择五个候选点中的哪一个进行下一次评估？\n\nA. 点 A\n\nB. 点 B\n\nC. 点 C\n\nD. 点 D\n\nE. 点 E", "solution": "我们使用上置信界（UCB）采集函数，该函数选择使 $A(x) = \\mu(x) + \\kappa \\sigma(x)$ 最大化的点 $x$。此处 $\\kappa = 2.5$。对于每个候选点：\n\n对于点 A：\n$$A(\\text{A}) = 0.915 + 2.5 \\times 0.010 = 0.915 + 0.025 = 0.940.$$\n\n对于点 B：\n$$A(\\text{B}) = 0.920 + 2.5 \\times 0.005 = 0.920 + 0.0125 = 0.9325.$$\n\n对于点 C：\n$$A(\\text{C}) = 0.890 + 2.5 \\times 0.025 = 0.890 + 0.0625 = 0.9525.$$\n\n对于点 D：\n$$A(\\text{D}) = 0.910 + 2.5 \\times 0.014 = 0.910 + 0.035 = 0.945.$$\n\n对于点 E：\n$$A(\\text{E}) = 0.905 + 2.5 \\times 0.018 = 0.905 + 0.045 = 0.950.$$\n\n比较这些采集值，最大值为 $0.9525$，在点 C 处取得。因此，UCB 策略选择点 C。", "answer": "$$\\boxed{C}$$", "id": "2156656"}, {"introduction": "掌握了如何使用采集函数之后，我们必须认识到其有效性高度依赖于代理模型的质量。在贝叶斯优化中，高斯过程的核函数编码了我们对未知目标函数性质（如平滑度）的先验假设。这个练习将通过一个思想实验，让你深入理解模型假设与现实问题之间的匹配度是多么重要。你将分析当我们的模型（由径向基函数RBF核定义，假设函数极度平滑）与一个带有尖锐特征的真实函数不匹配时，优化性能会受到怎样的影响 [@problem_id:2156686]。", "problem": "一位机器人工程师正在调试一个单一参数 $x$，该参数控制着机械手的抓取力。目标是在 $[0, 20]$ 的范围内找到使成本函数 $f(x)$ 最小化的 $x$ 值。较低的成本意味着更好的抓取效果：既不能太弱以致物体滑落，也不能太强以致压碎物体。工程师未知的真实成本函数由表达式 $f(x) = 3 + |2x - 15|$ 给出。\n\n工程师决定使用贝叶斯优化（BO）来高效地找到最小值。他们首先在 $x_1=2$，$x_2=10$ 和 $x_3=18$ 处收集了成本函数的三个初始测量值。\n\n为了继续进行，工程师考虑了两种不同的贝叶斯优化算法，这两种算法的区别仅在于其高斯过程（GP）代理模型中使用的核函数：\n- **优化器 A：** 使用带有径向基函数（RBF）核的高斯过程。这种核函数的选择隐含地假设了基础目标函数是无限可微的（即非常平滑）。\n- **优化器 B：** 使用马特恩（Matérn）核的高斯过程，其中平滑度参数 $\\nu$ 设置为 $3/2$。这种核函数的选择隐含地假设了目标函数仅是一次可微的。\n\n两个优化器都将从相同的三个初始数据点开始，并运行 15 次迭代。以下哪个陈述最准确地预测了这两个优化器在此任务中可能的性能？\n\nA. 优化器 B 更有可能高效地找到 $x=7.5$ 附近的真实最小值，因为其核函数的较弱平滑度假设与真实成本函数的尖锐、不可微的特性更匹配。\n\nB. 优化器 A 更有可能高效地找到真实最小值，因为 RBF 核强大的平滑特性使其能够忽略尖锐特征，将其视为噪声，并专注于全局趋势。\n\nC. 两个优化器的性能将几乎相同。初始的三个点对称分布在函数最小值周围，为两个模型提供了等效的信息，因此核函数的选择不会对结果产生重大影响。\n\nD. 两个优化器都不会有效。贝叶斯优化不适用于具有尖锐特征的函数，两者很可能都无法在 15 次迭代内收敛到最小值。\n\nE. 优化器 A 最初表现会较差，但在采样足够多的点后，最终会优于优化器 B。RBF 核需要更多数据来学习一个非平滑函数，但一旦学成，其预测会更稳定。", "solution": "我们首先分析真实的目标函数。成本由 $f(x)=3+|2x-15|$ 给出。绝对值函数形成一个 V 形，其拐点（kink）出现在绝对值参数为零的位置：\n$$\n2x-15=0 \\implies x=\\frac{15}{2}=7.5.\n$$\n当 $x<\\frac{15}{2}$ 时，$f(x)=3-(2x-15)=18-2x$；当 $x>\\frac{15}{2}$ 时，$f(x)=3+(2x-15)=2x-12$。因此，该函数是分段线性的，斜率分别为 $-2$ 和 $2$，并且在 $x=\\frac{15}{2}$ 处不可微。唯一的全局最小值出现在 $x=\\frac{15}{2}$ 处，其值为\n$$\nf\\!\\left(\\frac{15}{2}\\right)=3+|2\\cdot \\frac{15}{2}-15|=3.\n$$\n在 $x_{1}=2$，$x_{2}=10$ 和 $x_{3}=18$ 处的初始观测值分别为\n$$\nf(2)=3+|4-15|=14,\\quad f(10)=3+|20-15|=8,\\quad f(18)=3+|36-15|=24.\n$$\n请注意，初始点并非对称分布于最小值点 $x=\\frac{15}{2}$ 周围，因为它们与最小值点的距离分别为 $|2-7.5|=5.5$，$|10-7.5|=2.5$ 和 $|18-7.5|=10.5$。\n\n接下来，我们考虑两个优化器使用的高斯过程先验。使用径向基函数（RBF）核的高斯过程会产生 $C^{\\infty}$ 的样本路径，即无限可微，这意味着一个非常强的平滑性先验。使用马特恩（Matérn）核（参数 $\\nu=\\frac{3}{2}$）的高斯过程会产生均方一次可微的样本路径；这是一个较弱的平滑性先验。真实函数 $f$ 在 $x=\\frac{15}{2}$ 处不可微，因此马特恩（Matérn） $\\nu=\\frac{3}{2}$ 先验比 RBF 先验更接近真实的函数正则性。\n\n在贝叶斯优化中，代理模型的归纳偏置会强烈影响后验均值和方差，而这两者又驱动着采集函数（例如，期望提升或置信上界）。对于一个在最小值点有尖锐拐点的函数，RBF 先验倾向于将尖点（cusp）过度平滑为一个圆润的盆地。这可能导致低估拐点附近的后验不确定性，并使得后验均值预测的最小值偏离真实的拐点，从而导致采集函数在 $x=\\frac{15}{2}$ 附近的探索不够积极。相比之下，马特恩（Matérn） $\\nu=\\frac{3}{2}$ 核能更好地适应斜率的突变，在可能存在非平滑性的区域保持较高的后验方差，从而使采集函数能更高效地瞄准拐点区域。\n\n考虑到给定的初始点（一个在左侧，一个在右侧较近处，一个在右侧较远处），使用 RBF 核的高斯过程会进行平滑插值，并可能模糊掉 $x=\\frac{15}{2}$ 附近斜率的急剧变化。使用马特恩（Matérn）$\\nu=\\frac{3}{2}$ 核的高斯过程则更可能以一个更急剧的过渡来反映分段线性的趋势，从而在 $x=\\frac{15}{2}$ 附近的未采样区域保留不确定性，并因此促进样本点更快地向真实最小值集中。在一维空间和 15 次迭代的情况下，贝叶斯优化通常是有效的；因此，认为贝叶斯优化对此类函数无效的说法是不准确的，并且初始数据也并非以能消除核函数选择影响的方式对称分布。\n\n因此，最准确的预测是，使用马特恩（Matérn） $\\nu=\\frac{3}{2}$ 核的优化器会更高效地找到 $x=\\frac{15}{2}$ 附近的真实最小值，因为它对平滑性的假设与函数 $f$ 尖锐、不可微的特性更匹配。\n\n因此，正确选项是 A。", "answer": "$$\\boxed{A}$$", "id": "2156686"}, {"introduction": "贝叶斯优化的过程是通过迭代采样来构建和完善一个关于目标函数的概率模型。但是，当我们的实验预算用尽时，我们该如何从这个最终模型中得出最佳建议呢？这个练习将带你思考这一关键的最后一步。它将帮助你明确区分“为了进一步探索而选择下一个采样点”和“利用所有已获知识来推荐最终最优解”这两个不同目标，尤其是在处理充满噪声的真实世界测量数据时，理解这一点至关重要 [@problem_id:2156691]。", "problem": "一位材料科学家正在使用贝叶斯优化 (BO) 来寻找最优固化温度 $x$，以最大化一种新型聚合物复合材料的拉伸强度 $f(x)$。拉伸强度的测量会受到实验噪声的影响。该科学家使用高斯过程 (GP) 对未知函数 $f(x)$ 进行建模。\n\n在进行了四次实验后，优化预算已经用尽。收集到的数据由固化温度（单位：摄氏度）和对应的带噪拉伸强度测量值（单位：兆帕，MPa）组成。GP 模型为任意温度 $x$ 下的拉伸强度提供了后验均值 $\\mu(x)$ 和后验标准差 $\\sigma(x)$。\n\n四次实验的结果如下：\n\n| 实验 | 温度 $x$ ($^{\\circ}$C) | 观测强度 $y$ (MPa) | 后验均值 $\\mu(x)$ (MPa) | 后验标准差 $\\sigma(x)$ (MPa) |\n|------------|------------------------------|-------------------------------|---------------------------------|------------------------------------------|\n| 1          | 120                          | 315.4                         | 316.0                           | 1.8                                      |\n| 2          | 130                          | 325.1                         | 322.5                           | 1.7                                      |\n| 3          | 140                          | 324.8                         | 326.2                           | 1.9                                      |\n| 4          | 150                          | 320.7                         | 321.0                           | 2.5                                      |\n\n现在，这位科学家必须为该聚合物的量产推荐一个唯一的最佳温度。根据以上数据，应该推荐哪个温度？其正确理由是什么？\n\nA. 推荐 $140^{\\circ}$C，因为其对应的后验均值最高，这代表了模型在考虑所有数据并滤除噪声后，对真实最大强度的最佳估计。\n\nB. 推荐 $130^{\\circ}$C，因为它产生了直接观测到的最高拉伸强度，而经验测量值比模型预测更值得信赖。\n\nC. 推荐 $150^{\\circ}$C，因为该温度下的高后验标准差表明，它具有最大的未探索潜力，可能产生比已观测到的更高的强度。\n\nD. 推荐 $130^{\\circ}$C，因为它与其他点相比后验标准差相对较低，表明其高测量强度是一个可靠的结果。", "solution": "贝叶斯优化的目标是找到一个未知且可能带噪的函数 $f(x)$ 的全局最优值。在这个问题中，需要最大化的函数是聚合物的拉伸强度，它是固化温度的函数。优化过程已经结束，最终任务不是进一步探索，而是利用已获得的知识来做出最佳推荐。这意味着我们必须确定最有可能产生真实的、潜在函数 $f(x)$ 最大值的输入 $x$，而不仅仅是产生最大带噪观测值 $y$ 的输入。\n\n让我们分析一下问题的各个组成部分：\n1.  **观测强度 ($y$)**: 值 $y$ 是真实强度的带噪测量值。某一次特定的观测值可由 $y_i = f(x_i) + \\epsilon_i$ 给出，其中 $\\epsilon_i$ 是一个随机噪声项。因此，在 $x = 130^{\\circ}$C 时观测到的最高值 $y = 325.1$ MPa，可能是一个中等偏高的真实强度与一个较大的正向噪声波动相结合的结果。仅仅依赖于单次最佳观测值是一种脆弱的策略，因为它忽略了数据的噪声特性。\n\n2.  **后验均值 ($\\mu(x)$)**：高斯过程 (GP) 模型提供了在给定观测数据下函数 $f(x)$ 的后验分布。后验均值 $\\mu(x)$ 代表在输入 $x$ 处真实函数 $f(x)$ 的期望值。它是在考虑*所有*数据点的影响（根据它们的邻近度和模型的相关性假设进行加权）后计算得出的。因此，$\\mu(x)$ 可作为真实函数的去噪估计。为了最大化真实强度 $f(x)$，我们的最佳策略是选择能最大化我们对 $f(x)$ 的估计值的 $x$，而这个估计值正是后验均值 $\\mu(x)$。\n\n3.  **后验标准差 ($\\sigma(x)$)**：这个值量化了模型对其估计值 $\\mu(x)$ 的不确定性。在优化阶段（现已完成），高的不确定性对于探索是有价值的。例如，像上置信界 (UCB) 这样的采集函数，定义为 $\\text{UCB}(x) = \\mu(x) + \\beta \\sigma(x)$，它在高均值区域的利用 (exploiting) 和高不确定性区域的探索 (exploring) 之间进行权衡。然而，一旦过程结束并需要做出最终推荐，目标就是纯粹的利用。当需要一个最终的、唯一的最佳选择时，仅仅因为一个点的不确定性高（探索策略）而选择它是不正确的。\n\n基于此理解，我们来评估各个选项：\n-   **_选项 A_**：该选项建议选择 $x = 140^{\\circ}$C。从表格中看，后验均值 $\\mu(140) = 326.2$ MPa 是 $\\mu(x)$ 列中的最大值。其理由是后验均值是模型在滤除噪声后对真实函数的最佳估计。这与贝叶斯优化中的利用原则完全一致。我们应该推荐模型认为是真实最优点的位置。\n\n-   **_选项 B_**：该选项建议选择 $x = 130^{\\circ}$C，因为它产生了最高的观测值 $y = 325.1$ MPa。如前所述，这忽略了噪声的影响。模型在该点的后验均值 $\\mu(130) = 322.5$ MPa 显著低于观测值，表明模型将该高读数部分归因于正向噪声。这个选择并非最优。\n\n-   **_选项 C_**：该选项建议选择 $x = 150^{\\circ}$C，因其具有高的不确定性 ($\\sigma(150) = 2.5$ MPa)。这是一种探索策略，而不是利用策略。如果预算没有用尽，在决定*下一个*采样点时，这是一个有效的考虑因素，但它不是做出最终推荐的正确策略。现在的目标不再是改进模型，而是使用当前模型做出最佳选择。\n\n-   **_选项 D_**：该选项建议选择 $x = 130^{\\circ}$C，但其理由是基于其低不确定性。虽然低不确定性意味着可靠性，但主要目标是最大化函数值。一个对次优值的高度可靠的估计，并不比一个对更优值稍欠可靠的估计更好。推荐应基于期望结果 ($\\mu(x)$)，而不仅仅是其确定性 ($\\sigma(x)$)。点 $x = 140^{\\circ}$C 有更高的期望结果 $\\mu(140) = 326.2$ MPa，尽管其不确定性比 $x=130^{\\circ} \\text{C}$ 略高，但它仍然是更好的选择。\n\n因此，正确的做法是相信模型的去噪估计，即后验均值，并选择使其最大化的输入。最高的后验均值为 $326.2$ MPa，对应于 $140^{\\circ}$C 的温度。", "answer": "$$\\boxed{A}$$", "id": "2156691"}]}