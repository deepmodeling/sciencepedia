{"hands_on_practices": [{"introduction": "蒙特卡洛积分的核心思想是用样本均值来估计积分值，这在处理高维问题时尤其强大，因为传统数值积分方法在这些情况下往往会失效。本练习将通过一个直观的多维问题，让你亲手应用基本的蒙特卡洛积分公式。你将使用一小组给定的样本数据来估算一个四维积分的期望值，从而巩固对该方法基本流程的理解。[@problem_id:2188188]", "problem": "一种新型并行计算架构由四个独立的处理单元组成。对于一类特定的问题，该系统的整体性能由最快单元的输出决定。各单元的输出在归一化后，可以被建模为独立的随机变量 $x_1, x_2, x_3, x_4$，每个都服从区间 $[0, 1]$ 上的均匀分布。因此，预期的系统性能由积分 $I$ 给出：\n\n$$\nI = \\int_0^1 \\int_0^1 \\int_0^1 \\int_0^1 \\max(x_1, x_2, x_3, x_4) dx_1 dx_2 dx_3 dx_4\n$$\n\n一位工程师运行模拟来估计该值，并获得了以下五个四维样本点，其中每个坐标都从 $[0, 1]$ 上的均匀分布中抽取：\n*   $P_1 = (0.12, 0.83, 0.55, 0.41)$\n*   $P_2 = (0.91, 0.22, 0.67, 0.35)$\n*   $P_3 = (0.48, 0.76, 0.09, 0.88)$\n*   $P_4 = (0.62, 0.59, 0.95, 0.71)$\n*   $P_5 = (0.33, 0.81, 0.24, 0.50)$\n\n仅使用这五个样本点，计算预期系统性能 $I$ 的蒙特卡罗估计值。将您的最终答案四舍五入到三位有效数字。", "solution": "当 $(x_{1},x_{2},x_{3},x_{4})$ 在 $[0,1]^{4}$ 上均匀分布时，积分 $I$ 是 $f(x_{1},x_{2},x_{3},x_{4})=\\max(x_{1},x_{2},x_{3},x_{4})$ 的期望值。使用 $N$ 个独立样本 $P_{k}=(x_{1}^{(k)},x_{2}^{(k)},x_{3}^{(k)},x_{4}^{(k)})$ 的 $I$ 的蒙特卡罗估计量为\n$$\n\\hat{I}_{N}=\\frac{1}{N}\\sum_{k=1}^{N}\\max\\bigl(x_{1}^{(k)},x_{2}^{(k)},x_{3}^{(k)},x_{4}^{(k)}\\bigr).\n$$\n对于给定的五个样本，$N=5$。计算每个样本的最大值：\n$$\n\\max(P_{1})=\\max(0.12,0.83,0.55,0.41)=0.83,\n$$\n$$\n\\max(P_{2})=\\max(0.91,0.22,0.67,0.35)=0.91,\n$$\n$$\n\\max(P_{3})=\\max(0.48,0.76,0.09,0.88)=0.88,\n$$\n$$\n\\max(P_{4})=\\max(0.62,0.59,0.95,0.71)=0.95,\n$$\n$$\n\\max(P_{5})=\\max(0.33,0.81,0.24,0.50)=0.81.\n$$\n求和并取平均值：\n$$\n\\hat{I}_{5}=\\frac{0.83+0.91+0.88+0.95+0.81}{5}=\\frac{4.38}{5}=0.876.\n$$\n四舍五入到三位有效数字，蒙特卡罗估计值为 $0.876$。", "answer": "$$\\boxed{0.876}$$", "id": "2188188"}, {"introduction": "虽然基本的蒙特卡洛方法很强大，但我们常常希望用更少的计算量获得更精确的结果，而减小估计量的方差是实现这一目标的关键。对偶采样是一种简单而有效的方差缩减技术，尤其适用于单调函数，其原理是利用正负相关的样本来抵消随机波动。通过这个练习，你将分析并计算对偶采样技术对于一个特定函数能带来多大的方差缩减，直观地感受智能采样策略的威力。[@problem_id:2188199]", "problem": "在计算科学中，蒙特卡洛方法常用于近似计算定积分 $I = \\int_{0}^{1} f(x) \\,dx$ 的值。这些方法的一个关键方面是减小估计量的方差以提高准确性。\n\n考虑函数 $f(x) = (1+x)^2$ 在区间 $[0, 1]$ 上的积分。我们将比较该积分的两种蒙特卡洛估计量，两者都基于总共 $N$ 次函数求值，其中 $N$ 是一个偶数。\n\n1.  **标准蒙特卡洛估计量 ($\\hat{I}_{\\text{std}}$):**\n    该估计量通过从 Uniform(0,1) 分布中抽取 $N$ 个独立同分布的随机数 $X_1, X_2, \\ldots, X_N$ 来构成。该估计量由下式给出：\n    $$ \\hat{I}_{\\text{std}} = \\frac{1}{N} \\sum_{i=1}^{N} f(X_i) $$\n\n2.  **对偶变量估计量 ($\\hat{I}_{\\text{anti}}$):**\n    该估计量通过从 Uniform(0,1) 分布中抽取 $M = N/2$ 个独立的随机数 $U_1, U_2, \\ldots, U_M$ 来构成。对于每个 $U_i$，我们构成一对‘对偶’样本 $(U_i, 1-U_i)$。该估计量由下式给出：\n    $$ \\hat{I}_{\\text{anti}} = \\frac{1}{M} \\sum_{i=1}^{M} \\frac{f(U_i) + f(1-U_i)}{2} $$\n\n您的任务是对此特定函数，解析地确定使用对偶变量所实现的理论方差缩减。计算比率 $R = \\frac{\\text{Var}(\\hat{I}_{\\text{anti}})}{\\text{Var}(\\hat{I}_{\\text{std}})}$ 的精确值。", "solution": "令 $X\\sim \\text{Uniform}(0,1)$ 且 $f(x)=(1+x)^{2}=1+2x+x^{2}$。具有 $N$ 个独立同分布样本的标准蒙特卡洛估计量的方差为\n$$\n\\text{Var}(\\hat{I}_{\\text{std}})=\\frac{\\text{Var}(f(X))}{N}.\n$$\n通过计算 $E[f(X)]$ 和 $E[f(X)^{2}]$ 来计算 $\\text{Var}(f(X))$。使用 $E[X]=\\frac{1}{2}$，$E[X^{2}]=\\frac{1}{3}$，$E[X^{3}]=\\frac{1}{4}$，$E[X^{4}]=\\frac{1}{5}$，\n$$\nE[f(X)]=E[1+2X+X^{2}]=1+2\\cdot \\frac{1}{2}+\\frac{1}{3}=\\frac{7}{3},\n$$\n以及\n$$\nf(X)^{2}=(1+2X+X^{2})^{2}=1+4X+6X^{2}+4X^{3}+X^{4},\n$$\n所以\n$$\nE[f(X)^{2}]=1+4\\cdot \\frac{1}{2}+6\\cdot \\frac{1}{3}+4\\cdot \\frac{1}{4}+\\frac{1}{5}=\\frac{31}{5}.\n$$\n因此\n$$\n\\text{Var}(f(X))=E[f(X)^{2}]-\\left(E[f(X)]\\right)^{2}=\\frac{31}{5}-\\frac{49}{9}=\\frac{34}{45}.\n$$\n\n对于对偶估计量，定义 $M=\\frac{N}{2}$ 和 $Y=\\frac{f(U)+f(1-U)}{2}$，其中 $U\\sim \\text{Uniform}(0,1)$。那么\n$$\n\\text{Var}(\\hat{I}_{\\text{anti}})=\\frac{\\text{Var}(Y)}{M}.\n$$\n我们有\n$$\n\\text{Var}(Y)=\\frac{1}{4}\\text{Var}\\big(f(U)+f(1-U)\\big)=\\frac{1}{4}\\left(2\\,\\text{Var}(f(X))+2\\,\\text{Cov}(f(U),f(1-U))\\right)\n=\\frac{1}{2}\\left(\\text{Var}(f(X))+\\text{Cov}(f(U),f(1-U))\\right).\n$$\n因此方差之比为\n$$\nR=\\frac{\\text{Var}(\\hat{I}_{\\text{anti}})}{\\text{Var}(\\hat{I}_{\\text{std}})}\n=\\frac{\\frac{\\text{Var}(Y)}{M}}{\\frac{\\text{Var}(f(X))}{N}}\n=\\frac{\\text{Var}(Y)}{\\text{Var}(f(X))}\\cdot \\frac{N}{M}\n=\\frac{\\frac{1}{2}\\left(\\text{Var}(f(X))+\\text{Cov}(f(U),f(1-U))\\right)}{\\text{Var}(f(X))}\\cdot 2\n=1+\\frac{\\text{Cov}(f(U),f(1-U))}{\\text{Var}(f(X))}.\n$$\n\n接下来计算 $\\text{Cov}(f(U),f(1-U))$。由于 $f(1-U)=(2-U)^{2}=4-4U+U^{2}$，\n$$\nf(U)f(1-U)=(1+2U+U^{2})(4-4U+U^{2})=4+4U-3U^{2}-2U^{3}+U^{4}.\n$$\n因此\n$$\nE[f(U)f(1-U)]=4+4\\cdot \\frac{1}{2}-3\\cdot \\frac{1}{3}-2\\cdot \\frac{1}{4}+\\frac{1}{5}=\\frac{47}{10},\n$$\n并且已知 $E[f(U)]=\\frac{7}{3}$，\n$$\n\\text{Cov}(f(U),f(1-U))=E[f(U)f(1-U)]-\\left(E[f(U)]\\right)^{2}=\\frac{47}{10}-\\frac{49}{9}=-\\frac{67}{90}.\n$$\n因此，\n$$\nR=1+\\frac{-\\frac{67}{90}}{\\frac{34}{45}}=1-\\frac{67}{90}\\cdot \\frac{45}{34}=1-\\frac{67}{68}=\\frac{1}{68}.\n$$\n因此，对于此函数 $f$，对偶变量估计量所实现的方差是标准蒙特卡洛估计量方差的 $\\frac{1}{68}$。", "answer": "$$\\boxed{\\frac{1}{68}}$$", "id": "2188199"}, {"introduction": "在某些情况下，尤其当被积函数存在奇点或急剧变化时，朴素的蒙特卡洛积分不仅效率低下，甚至可能完全失效。重要性采样通过将采样点集中在对积分贡献最大的“重要”区域，并用权重校正偏差，从而巧妙地解决了这个问题。本练习展示了一个朴素蒙特卡洛估计量方差为无穷大的极端案例，你将通过应用重要性采样，将其转变为一个性质优良的有限方差估计量，从而体会到该技术在处理复杂积分时的必要性。[@problem_id:2188184]", "problem": "一位数值分析师的任务是使用蒙特卡洛方法估计反常积分 $I = \\int_0^1 x^{-2/3} dx$ 的值。考虑了两种不同的方法。\n\n设被积函数记为 $f(x) = x^{-2/3}$。\n\n**方法1：朴素蒙特卡洛**\n该方法涉及从 $(0, 1)$ 上的标准均匀分布（记为 $U \\sim \\text{Uniform}(0,1)$）中生成 $N$ 个独立随机样本 $U_1, U_2, \\dots, U_N$。然后使用样本均值来估计该积分：\n$$ \\hat{I}_N = \\frac{1}{N} \\sum_{i=1}^N f(U_i) $$\n该估计量的单个样本的理论方差是 $V_N = \\text{Var}(f(U))$。\n\n**方法2：重要性抽样**\n该方法涉及从一个定义在 $(0,1]$ 上的非均匀概率分布中生成 $N$ 个独立随机样本 $Y_1, Y_2, \\dots, Y_N$，其概率密度函数 (PDF) 为 $p(x)$。所选择的 PDF 为 $p(x) = \\frac{1}{2\\sqrt{x}}$。然后使用加权样本均值来估计该积分：\n$$ \\hat{I}_{IS} = \\frac{1}{N} \\sum_{i=1}^N \\frac{f(Y_i)}{p(Y_i)} $$\n该估计量的单个样本的理论方差是 $V_{IS} = \\text{Var}\\left(\\frac{f(Y)}{p(Y)}\\right)$。\n\n您的任务是分析估计量 $\\hat{I}_N$ 和 $\\hat{I}_{IS}$ 的理论统计性质，特别是它们的方差。根据你的分析，下列哪个陈述是正确的？\n\nA. $V_N$ 和 $V_{IS}$ 都是有限的，但 $V_N > V_{IS}$，表明重要性抽样更有效。\n\nB. $V_N$ 是有限的，但 $V_{IS}$ 是无穷的，表明所选的重要性抽样分布 $p(x)$ 是不合适的。\n\nC. 积分 $I$ 是发散的，因此两种蒙特卡洛方法都无法得出有意义的估计。\n\nD. $V_N$ 是无穷的，而 $V_{IS}$ 是有限的。这意味着朴素蒙特卡洛估计量不满足中心极限定理的条件，而重要性抽样估计量则满足。\n\nE. 两种估计量都是有偏的，意味着它们的期望值不等于 $I$，但重要性抽样估计量有更小的偏差。", "solution": "我们首先计算这个反常积分以确认其为有限值：\n$$\nI=\\int_{0}^{1} x^{-2/3}\\,dx=\\left[\\frac{x^{1/3}}{1/3}\\right]_{0}^{1}=3,\n$$\n所以该积分是收敛的。\n\n使用 $U\\sim\\text{Uniform}(0,1)$ 的朴素蒙特卡洛方法使用 $f(U)=U^{-2/3}$。其期望为\n$$\n\\mathbb{E}[f(U)]=\\int_{0}^{1} x^{-2/3}\\,dx=3,\n$$\n所以该估计量是无偏的。其方差为\n$$\nV_{N}=\\operatorname{Var}(f(U))=\\mathbb{E}[f(U)^{2}]-\\left(\\mathbb{E}[f(U)]\\right)^{2}.\n$$\n计算二阶矩：\n$$\n\\mathbb{E}[f(U)^{2}]=\\int_{0}^{1} x^{-4/3}\\,dx=\\lim_{\\varepsilon\\to 0^{+}}\\int_{\\varepsilon}^{1} x^{-4/3}\\,dx\n=\\lim_{\\varepsilon\\to 0^{+}}\\left[-3 x^{-1/3}\\right]_{\\varepsilon}^{1}\n=\\lim_{\\varepsilon\\to 0^{+}}\\left(-3+3\\varepsilon^{-1/3}\\right)=\\infty.\n$$\n因此 $V_{N}=\\infty$。\n\n对于重要性抽样，提议分布在 $(0,1]$ 上的密度为 $p(x)=\\frac{1}{2\\sqrt{x}}$，这是一个有效的 PDF，因为\n$$\n\\int_{0}^{1} p(x)\\,dx=\\int_{0}^{1} \\frac{1}{2\\sqrt{x}}\\,dx=\\left[\\sqrt{x}\\right]_{0}^{1}=1.\n$$\n设 $Y\\sim p$。单样本的重要性抽样权重为\n$$\nW=\\frac{f(Y)}{p(Y)}=\\frac{Y^{-2/3}}{1/(2\\sqrt{Y})}=2\\,Y^{-1/6}.\n$$\n其期望为\n$$\n\\mathbb{E}[W]=\\int_{0}^{1} \\frac{f(x)}{p(x)}\\,p(x)\\,dx=\\int_{0}^{1} f(x)\\,dx=I=3,\n$$\n所以重要性抽样（IS）估计量是无偏的。其方差为\n$$\nV_{IS}=\\operatorname{Var}(W)=\\mathbb{E}[W^{2}]-\\left(\\mathbb{E}[W]\\right)^{2}.\n$$\n计算二阶矩：\n$$\n\\mathbb{E}[W^{2}]=\\int_{0}^{1} \\left(\\frac{f(x)}{p(x)}\\right)^{2} p(x)\\,dx\n=\\int_{0}^{1} \\frac{f(x)^{2}}{p(x)}\\,dx\n=\\int_{0}^{1} \\frac{x^{-4/3}}{1/(2\\sqrt{x})}\\,dx\n=\\int_{0}^{1} 2\\,x^{-5/6}\\,dx\n=2\\left[\\frac{x^{1/6}}{1/6}\\right]_{0}^{1}=12.\n$$\n因此，\n$$\nV_{IS}=12-3^{2}=3<\\infty.\n$$\n\n结论：\n- $I$ 是有限的，所以 C 是错误的。\n- 朴素蒙特卡洛方差无穷大，所以 A 和 B 是错误的。\n- 两种估计量都是无偏的，所以 E 是错误的。\n- $V_{N}=\\infty$ 而 $V_{IS}=3<\\infty$；因此朴素估计量不满足中心极限定理的通常条件（有限方差），而重要性抽样（IS）估计量则满足这些条件。\n\n正确选项是 D。", "answer": "$$\\boxed{D}$$", "id": "2188184"}]}