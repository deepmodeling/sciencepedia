{"hands_on_practices": [{"introduction": "掌握新数值方法的最佳途径是将其应用于我们熟悉的问题。本练习将从一个经典的坐标转换——极坐标到笛卡尔坐标系的转换——入手。通过对这个我们熟知的函数应用前向差分公式，你将能够建立起计算有限差分雅可比矩阵的基础技能，并直观地体会数值近似与手动计算的解析导数之间的联系。[@problem_id:2171159]", "problem": "一个二维向量函数 $F: \\mathbb{R}^2 \\rightarrow \\mathbb{R}^2$ 表示从极坐标系 $(r, \\theta)$ 到笛卡尔坐标系 $(x, y)$ 的变换。该函数定义为：\n$$\nF(r, \\theta) = \\begin{pmatrix} x(r, \\theta) \\\\ y(r, \\theta) \\end{pmatrix} = \\begin{pmatrix} r\\cos\\theta \\\\ r\\sin\\theta \\end{pmatrix}\n$$\n你的任务是，对每个偏导数使用前向有限差分法，求出 $F$ 在通用点 $(r, \\theta)$ 处雅可比矩阵的近似值。设 $h$ 表示在有限差分计算中使用的微小的正步长。角度 $\\theta$ 以弧度为单位。\n\n请以一个 2x2 矩阵的形式给出你的答案，其元素需要用 $r$、$\\theta$ 和 $h$ 来表示。", "solution": "给定 $F(r,\\theta)=(x(r,\\theta),y(r,\\theta))$，其中 $x(r,\\theta)=r\\cos\\theta$ 且 $y(r,\\theta)=r\\sin\\theta$。雅可比矩阵为\n$$\nJ_{F}(r,\\theta)=\\begin{pmatrix}\n\\frac{\\partial x}{\\partial r} & \\frac{\\partial x}{\\partial \\theta} \\\\\n\\frac{\\partial y}{\\partial r} & \\frac{\\partial y}{\\partial \\theta}\n\\end{pmatrix}.\n$$\n对于一个标量函数 $g(r,\\theta)$，使用前向有限差分近似，\n$$\n\\frac{\\partial g}{\\partial r}(r,\\theta)\\approx \\frac{g(r+h,\\theta)-g(r,\\theta)}{h},\\qquad\n\\frac{\\partial g}{\\partial \\theta}(r,\\theta)\\approx \\frac{g(r,\\theta+h)-g(r,\\theta)}{h},\n$$\n我们计算每个矩阵元素。\n\n对于 $x(r,\\theta)=r\\cos\\theta$：\n$$\n\\frac{\\partial x}{\\partial r}(r,\\theta)\\approx \\frac{(r+h)\\cos\\theta-r\\cos\\theta}{h}=\\cos\\theta,\n$$\n$$\n\\frac{\\partial x}{\\partial \\theta}(r,\\theta)\\approx \\frac{r\\cos(\\theta+h)-r\\cos\\theta}{h}\n=\\frac{r\\left(\\cos(\\theta+h)-\\cos\\theta\\right)}{h}.\n$$\n\n对于 $y(r,\\theta)=r\\sin\\theta$：\n$$\n\\frac{\\partial y}{\\partial r}(r,\\theta)\\approx \\frac{(r+h)\\sin\\theta-r\\sin\\theta}{h}=\\sin\\theta,\n$$\n$$\n\\frac{\\partial y}{\\partial \\theta}(r,\\theta)\\approx \\frac{r\\sin(\\theta+h)-r\\sin\\theta}{h}\n=\\frac{r\\left(\\sin(\\theta+h)-\\sin\\theta\\right)}{h}.\n$$\n\n因此，在 $(r,\\theta)$ 处雅可比矩阵的前向有限差分近似为\n$$\n\\begin{pmatrix}\n\\cos\\theta & \\frac{r\\left(\\cos(\\theta+h)-\\cos\\theta\\right)}{h} \\\\\n\\sin\\theta & \\frac{r\\left(\\sin(\\theta+h)-\\sin\\theta\\right)}{h}\n\\end{pmatrix}.\n$$", "answer": "$$\\boxed{\\begin{pmatrix}\n\\cos\\theta & \\frac{r\\left(\\cos(\\theta+h)-\\cos\\theta\\right)}{h} \\\\\n\\sin\\theta & \\frac{r\\left(\\sin(\\theta+h)-\\sin\\theta\\right)}{h}\n\\end{pmatrix}}$$", "id": "2171159"}, {"introduction": "学会了如何计算有限差分雅可比矩阵后，一个自然而然的问题便是：我们的近似到底有多精确？本练习将引导你从简单的计算转向对近似方法*精度*的分析。通过研究当我们减小步长 $h$ 时误差如何变化，我们可以量化中心差分方法的理论收敛阶，这是为科学问题选择合适数值工具时的一个关键概念。[@problem_id:2171195]", "problem": "在一个新型二自由度执行器的简化模型中，输出状态向量与输入控制向量 $(q_1, q_2)$ 之间的关系由函数 $F: \\mathbb{R}^2 \\to \\mathbb{R}^2$ 给出，其定义为：\n$$ F(q_1, q_2) = \\begin{pmatrix} F_1(q_1, q_2) \\\\ F_2(q_1, q_2) \\end{pmatrix} = \\begin{pmatrix} \\exp(q_1 + q_2) \\\\ \\cos(q_1 - q_2) \\end{pmatrix} $$\n系统的控制依赖于其雅可比矩阵 $J(q_1, q_2)$，其元素为 $J_{ij} = \\frac{\\partial F_i}{\\partial q_j}$。\n\n在实际应用中，雅可比矩阵是通过数值方法来近似的。雅可比矩阵的中心差分近似记为 $J_h(q_1, q_2)$，它是通过使用以下公式来近似每个偏导数而构造的：\n$$ \\frac{\\partial F_i}{\\partial q_j} \\approx \\frac{F_i(\\mathbf{q} + h\\mathbf{e}_j) - F_i(\\mathbf{q} - h\\mathbf{e}_j)}{2h} $$\n其中 $\\mathbf{q} = (q_1, q_2)$ 是计算点，$h$ 是一个很小的步长，$\\mathbf{e}_j$ 是第 $j$ 个标准基向量（例如，$\\mathbf{e}_1 = (1, 0)$）。\n\n该近似的精度由误差矩阵 $E_h = J(q_1, q_2) - J_h(q_1, q_2)$ 来衡量。该误差的大小使用 Frobenius 范数来量化，对于一个通用的 $m \\times n$ 矩阵 $A$，其定义为 $\\|A\\|_F = \\sqrt{\\sum_{i=1}^m \\sum_{j=1}^n |A_{ij}|^2}$。令 $\\mathcal{E}(h) = \\|E_h\\|_F$ 表示在给定步长 $h$ 时的误差。\n\n为了理解该方法的收敛行为，我们分析当步长减小时误差如何变化。计算当步长减半时近似误差的理论比率。具体来说，对于雅可比矩阵良定义且非零的任意状态 $(q_1, q_2)$，计算以下极限的值：\n$$ R = \\lim_{h \\to 0} \\frac{\\mathcal{E}(h)}{\\mathcal{E}(h/2)} $$\n将你的最终答案表示为一个精确的整数或分数。", "solution": "给定 $F(q_{1},q_{2}) = \\begin{pmatrix} \\exp(q_{1}+q_{2}) \\\\ \\cos(q_{1}-q_{2}) \\end{pmatrix}$ 及其雅可比矩阵 $J(q_{1},q_{2})$，其元素为 $J_{ij} = \\partial_{q_{j}} F_{i}$。$\\partial_{q_{j}} F_{i}$ 在点 $\\mathbf{q}=(q_{1},q_{2})$ 处，步长为 $h$ 的中心差分近似是\n$$\n\\frac{F_{i}(\\mathbf{q}+h\\mathbf{e}_{j}) - F_{i}(\\mathbf{q}-h\\mathbf{e}_{j})}{2h}.\n$$\n固定 $i$ 和 $j$，并考虑单变量函数 $\\varphi(t) = F_{i}(\\mathbf{q} + t \\mathbf{e}_{j})$。在 $t=0$ 处的泰勒展开给出\n$$\nF_{i}(\\mathbf{q} + h \\mathbf{e}_{j}) = F_{i}(\\mathbf{q}) + h\\,\\partial_{q_{j}} F_{i}(\\mathbf{q}) + \\frac{h^{2}}{2}\\,\\partial_{q_{j}q_{j}} F_{i}(\\mathbf{q}) + \\frac{h^{3}}{6}\\,\\partial_{q_{j}q_{j}q_{j}} F_{i}(\\mathbf{q}) + O(h^{4}),\n$$\n$$\nF_{i}(\\mathbf{q} - h \\mathbf{e}_{j}) = F_{i}(\\mathbf{q}) - h\\,\\partial_{q_{j}} F_{i}(\\mathbf{q}) + \\frac{h^{2}}{2}\\,\\partial_{q_{j}q_{j}} F_{i}(\\mathbf{q}) - \\frac{h^{3}}{6}\\,\\partial_{q_{j}q_{j}q_{j}} F_{i}(\\mathbf{q}) + O(h^{4}).\n$$\n两式相减再除以 $2h$ 得到带有截断误差的中心差分公式\n$$\n\\frac{F_{i}(\\mathbf{q}+h\\mathbf{e}_{j}) - F_{i}(\\mathbf{q}-h\\mathbf{e}_{j})}{2h} = \\partial_{q_{j}} F_{i}(\\mathbf{q}) + \\frac{h^{2}}{6}\\,\\partial_{q_{j}q_{j}q_{j}} F_{i}(\\mathbf{q}) + O(h^{4}).\n$$\n因此，每个雅可比矩阵元素的误差是\n$$\nE_{ij}(h) = J_{ij} - (J_{h})_{ij} = -\\frac{h^{2}}{6}\\,\\partial_{q_{j}q_{j}q_{j}} F_{i}(\\mathbf{q}) + O(h^{4}).\n$$\n以矩阵形式，存在一个常数矩阵 $A$，其元素为 $A_{ij} = -\\tfrac{1}{6}\\,\\partial_{q_{j}q_{j}q_{j}} F_{i}(\\mathbf{q})$，使得\n$$\nE_{h} = h^{2} A + O(h^{4}).\n$$\n因此，根据 Frobenius 范数的齐次性和连续性，\n$$\n\\mathcal{E}(h) = \\|E_{h}\\|_{F} = \\|h^{2}A + O(h^{4})\\|_{F} = h^{2}\\|A\\|_{F} + O(h^{4}).\n$$\n对于给定的 $F$，沿坐标方向的三阶偏导数为\n$$\n\\partial_{q_{1}q_{1}q_{1}} F_{1} = \\exp(q_{1}+q_{2}), \\quad \\partial_{q_{2}q_{2}q_{2}} F_{1} = \\exp(q_{1}+q_{2}),\n$$\n$$\n\\partial_{q_{1}q_{1}q_{1}} F_{2} = \\sin(q_{1}-q_{2}), \\quad \\partial_{q_{2}q_{2}q_{2}} F_{2} = -\\sin(q_{1}-q_{2}).\n$$\n因此，由于 $\\exp(q_{1}+q_{2}) \\neq 0$，矩阵 $A$ 对所有 $(q_{1},q_{2})$ 都是非零的，这确保了 $\\|A\\|_{F} > 0$ 并确立了其主阶行为为 $\\mathcal{E}(h) = C h^{2} + O(h^{4})$，其中 $C = \\|A\\|_{F} > 0$。\n\n现在计算当 $h \\to 0$ 时的比率：\n$$\n\\frac{\\mathcal{E}(h)}{\\mathcal{E}(h/2)} = \\frac{h^{2}\\|A\\|_{F} + O(h^{4})}{(h/2)^{2}\\|A\\|_{F} + O(h^{4})} = \\frac{h^{2}\\|A\\|_{F}\\left(1 + O(h^{2})\\right)}{\\tfrac{h^{2}}{4}\\|A\\|_{F}\\left(1 + O(h^{2})\\right)} \\to 4 \\quad \\text{as } h \\to 0.\n$$\n因此，理论比率为 $R=4$，这反映了中心差分雅可比近似方法关于 $h$ 具有二阶精度。", "answer": "$$\\boxed{4}$$", "id": "2171195"}, {"introduction": "在现实世界的科学与工程应用中，系统可能涉及成千上万个变量。在这种情况下，逐列计算雅可比矩阵的朴素方法在计算上是不可行的。本练习将探索一种强大的优化技巧，它利用了雅可比矩阵的*稀疏性*——即矩阵中多数元素为零的特性——从而用极少数的函数求值次数来计算整个矩阵。[@problem_id:2171164] 这个实践让你得以一窥那些使大规模数值模拟与优化成为可能的巧妙算法。", "problem": "一个包含 $N=100$ 个变量、由 $N=100$ 个非线性方程构成的系统正在被分析，以求解 $F(x) = 0$。其变量由向量 $x = (x_1, x_2, \\dots, x_{100})$ 表示。向量函数 $F: \\mathbb{R}^{100} \\to \\mathbb{R}^{100}$ 的分量 $F_i$ 定义如下：\n\n- 对于 $i = 1, 2, \\dots, 99$：$F_i(x) = \\alpha_i x_i^2 + \\beta_i x_{i+1}^3 - \\gamma_i$\n- 对于 $i = 100$：$F_{100}(x) = \\delta x_{100}^2 - \\epsilon$\n\n此处，对于 $i \\in \\{1, ..., 99\\}$ 的 $\\alpha_i, \\beta_i, \\gamma_i$，以及 $\\delta, \\epsilon$ 均为已知的非零常数。\n\n为了使用像牛顿法这样的迭代方法求解该系统，需要计算 $F$ 的雅可比矩阵 $J$。雅可比矩阵的元素由 $J_{ij} = \\frac{\\partial F_i}{\\partial x_j}$ 给出。我们计划使用前向有限差分公式来数值近似这个雅可比矩阵。对于单个列 $j$，该公式为：\n$$J_{:,j} \\approx \\frac{F(x + h e_j) - F(x)}{h}$$\n其中 $J_{:,j}$ 是雅可比矩阵的第 $j$ 列，$e_j$ 是标准基向量，其第 $j$ 个位置为 1，其余位置为 0，$h$ 是一个很小的步长。一种朴素的方法是为每一列 $j=1, \\dots, 100$ 应用此公式，这将需要对函数 $F$ 进行 100 次单独的求值（此外还需要在基点 $x$ 处进行一次求值）。\n\n通过利用方程的特定结构，可以同时计算雅可比矩阵多个列的近似值。这可以通过使用一个扰动向量 $d$ 来实现，该向量可一次性扰动多个变量。\n\n请确定计算雅可比矩阵 $J$ 的完整数值近似所需的函数 $F$ 的绝对最小求值次数。一次求值定义为：对于一个给定的输入向量 $y$，计算完整的向量 $F(y)$。", "solution": "显式地计算雅可比矩阵的结构。对于 $i \\in \\{1,\\dots,99\\}$，\n$$\nF_{i}(x)=\\alpha_{i}x_{i}^{2}+\\beta_{i}x_{i+1}^{3}-\\gamma_{i},\n$$\n所以\n$$\n\\frac{\\partial F_{i}}{\\partial x_{i}}=2\\alpha_{i}x_{i},\\qquad \\frac{\\partial F_{i}}{\\partial x_{i+1}}=3\\beta_{i}x_{i+1}^{2},\\qquad \\frac{\\partial F_{i}}{\\partial x_{j}}=0\\ \\text{对于所有其他的 }j.\n$$\n对于 $i=100$，\n$$\nF_{100}(x)=\\delta x_{100}^{2}-\\epsilon,\\qquad \\frac{\\partial F_{100}}{\\partial x_{100}}=2\\delta x_{100},\\qquad \\frac{\\partial F_{100}}{\\partial x_{j}}=0\\ \\text{对于 }j\\neq 100.\n$$\n因此，每个 $i\\leq 99$ 的行仅在第 $i$ 列和第 $i+1$ 列有非零元，而第 100 行仅在第 100 列有非零元。等价地，如果 $|j-k|=1$，则两列 $j$ 和 $k$ 会发生冲突（即，它们不能被同时扰动，否则其影响会在至少一行中混合）。其列交集图是在集合 $\\{1,\\dots,100\\}$ 上的路径图，图中边连接着连续的索引。\n\n使用前向有限差分，对于任何扰动向量 $d\\in\\mathbb{R}^{100}$，\n$$\n\\frac{F(x+hd)-F(x)}{h}=J(x)\\,d+O(h).\n$$\n为了从同时扰动中恢复出各个单独的列，任何一行都不能从多于一个被扰动的变量中接收贡献；因此，每个种子向量 $d$ 的支撑集必须是该路径图中的一个独立集（即没有两个连续的索引）。为了覆盖所有 100 个列，我们必须将集合 $\\{1,\\dots,100\\}$ 划分为最少数目的独立集，这个数目就是该路径图的色数。路径图是二分图，所以两种颜色足够，而一种颜色则不够（因为图中存在边）。因此，种子向量的绝对最小数量为 $2$。\n\n一个显式的构造如下：\n- $d^{(1)}$，其中当 $j$ 为奇数时 $d^{(1)}_{j}=1$，当 $j$ 为偶数时 $d^{(1)}_{j}=0$。\n- $d^{(2)}$，其中当 $j$ 为偶数时 $d^{(2)}_{j}=1$，当 $j$ 为奇数时 $d^{(2)}_{j}=0$。\n\n定义\n$$\ng^{(k)}\\equiv \\frac{F(x+h d^{(k)})-F(x)}{h},\\quad k\\in\\{1,2\\}.\n$$\n对于每个 $i\\in\\{1,\\dots,99\\}$，$F_{i}$ 只依赖于 $x_{i}$ 和 $x_{i+1}$，这两者的索引具有相反的奇偶性。因此：\n- 如果 $i$ 是奇数，则 $g^{(1)}_{i}=J_{i,i}$ 且 $g^{(2)}_{i}=J_{i,i+1}$。\n- 如果 $i$ 是偶数，则 $g^{(2)}_{i}=J_{i,i}$ 且 $g^{(1)}_{i}=J_{i,i+1}$。\n对于 $i=100$（偶数），$g^{(2)}_{100}=J_{100,100}$ 且 $g^{(1)}_{100}=0$。因此，两次种子向量的求值可以恢复出所有非零的雅可比矩阵项，而零项的位置可从其结构中得知。\n\n在使用前向差分法的情况下计算求值次数：在基点 $F(x)$ 处的一次求值，加上每个种子向量需要的一次求值。由于至少需要两个种子向量（单个种子向量无法在不混合贡献的情况下覆盖任何一条边的两个端点，并且单个独立集无法包含所有 100 个顶点），因此绝对最小总次数为\n$$\n1\\ (\\text{基点})+2\\ (\\text{种子向量})=3.\n$$\n任何使用少于两次种子向量求值的方案都无法区分行 $i\\in\\{1,\\dots,99\\}$ 中的两个未知贡献，并且前向差分法需要基点求值，这便确立了最优性。", "answer": "$$\\boxed{3}$$", "id": "2171164"}]}