{"hands_on_practices": [{"introduction": "理论学习只有通过实践才能得到巩固。让我们从一个基本问题开始，直观地感受步长选择的重要性。这个练习将直接比较一个简单的固定步长策略和一个“理想的”精确线搜索策略，通过计算展示一个精心选择的步长如何能在单次迭代中带来显著更优的目标函数下降，从而揭示了学习线搜索方法的根本动机 [@problem_id:2184823]。", "problem": "考虑最小化函数 $f(x_1, x_2) = x_1^2 + 4x_2^2$ 的无约束优化问题。我们希望使用迭代法找到该函数的最小值。从点 $\\mathbf{x}_0 = (4, 1)^T$ 开始，根据更新规则 $\\mathbf{x}_1 = \\mathbf{x}_0 - \\alpha \\nabla f(\\mathbf{x}_0)$ 生成新的迭代点 $\\mathbf{x}_1$，其中 $\\nabla f(\\mathbf{x}_0)$ 是 $f$ 在 $\\mathbf{x}_0$ 处求得的梯度，$\\alpha > 0$ 是一个称为步长的标量。\n\n我们将比较两种选择步长的不同策略。\n\n策略 A：使用固定步长 $\\alpha_A = 0.1$。设得到的迭代点为 $\\mathbf{x}_{1,A}$。\n策略 B：执行精确线搜索以找到最优步长 $\\alpha_B$，该值是使一维函数 $g(\\alpha) = f(\\mathbf{x}_0 - \\alpha \\nabla f(\\mathbf{x}_0))$ 最小化的 $\\alpha$ 值。设得到的迭代点为 $\\mathbf{x}_{1,B}$。\n\n计算比率 $R = \\frac{f(\\mathbf{x}_{1,A})}{f(\\mathbf{x}_{1,B})}$。报告你的答案 $R$，四舍五入到三位有效数字。", "solution": "我们最小化函数 $f(x_{1},x_{2})=x_{1}^{2}+4x_{2}^{2}$，其梯度为 $\\nabla f(x_{1},x_{2})=(2x_{1},8x_{2})^{T}$。在 $\\mathbf{x}_{0}=(4,1)^{T}$ 处，梯度为\n$$\n\\nabla f(\\mathbf{x}_{0})=(2\\cdot 4,\\,8\\cdot 1)^{T}=(8,8)^{T}\n$$\n。\n更新规则为 $\\mathbf{x}_{1}=\\mathbf{x}_{0}-\\alpha \\nabla f(\\mathbf{x}_{0})$。\n\n策略 A：当 $\\alpha_{A}=0.1=\\frac{1}{10}$ 时，\n$$\n\\mathbf{x}_{1,A}=(4,1)^{T}-\\tfrac{1}{10}(8,8)^{T}=\\left(4-\\tfrac{8}{10},\\,1-\\tfrac{8}{10}\\right)^{T}=\\left(\\tfrac{16}{5},\\,\\tfrac{1}{5}\\right)^{T}\n$$\n。\n则\n$$\nf(\\mathbf{x}_{1,A})=\\left(\\tfrac{16}{5}\\right)^{2}+4\\left(\\tfrac{1}{5}\\right)^{2}=\\tfrac{256}{25}+\\tfrac{4}{25}=\\tfrac{260}{25}=\\tfrac{52}{5}\n$$\n。\n\n策略 B：对 $g(\\alpha)=f(\\mathbf{x}_{0}-\\alpha \\nabla f(\\mathbf{x}_{0}))$ 执行精确线搜索。使用 $\\mathbf{x}_{0}=(4,1)$ 和 $\\nabla f(\\mathbf{x}_{0})=(8,8)$，\n$$\ng(\\alpha)=f(4-8\\alpha,\\,1-8\\alpha)=(4-8\\alpha)^{2}+4(1-8\\alpha)^{2}\n$$\n。\n展开：\n$$\ng(\\alpha)=(16-64\\alpha+64\\alpha^{2})+4(1-16\\alpha+64\\alpha^{2})=20-128\\alpha+320\\alpha^{2}\n$$\n。\n求导并令其为零：\n$$\ng'(\\alpha)=-128+640\\alpha=0 \\;\\Rightarrow\\; \\alpha_{B}=\\tfrac{128}{640}=\\tfrac{1}{5}\n$$\n。\n因此\n$$\n\\mathbf{x}_{1,B}=(4,1)^{T}-\\tfrac{1}{5}(8,8)^{T}=\\left(4-\\tfrac{8}{5},\\,1-\\tfrac{8}{5}\\right)^{T}=\\left(\\tfrac{12}{5},\\,-\\tfrac{3}{5}\\right)^{T}\n$$\n，\n并且\n$$\nf(\\mathbf{x}_{1,B})=\\left(\\tfrac{12}{5}\\right)^{2}+4\\left(-\\tfrac{3}{5}\\right)^{2}=\\tfrac{144}{25}+\\tfrac{36}{25}=\\tfrac{180}{25}=\\tfrac{36}{5}\n$$\n。\n\n计算比率\n$$\nR=\\frac{f(\\mathbf{x}_{1,A})}{f(\\mathbf{x}_{1,B})}=\\frac{\\tfrac{52}{5}}{\\tfrac{36}{5}}=\\frac{52}{36}=\\frac{13}{9}\\approx 1.444\\ldots\n$$\n四舍五入到三位有效数字，得到 $R=1.44$。", "answer": "$$\\boxed{1.44}$$", "id": "2184823"}, {"introduction": "在实际应用中，执行精确线搜索往往成本过高甚至不可行。因此，我们通常寻求一个“足够好”而非“完美”的步长。本练习将介绍非精确线搜索的基石——Armijo 条件，并让你通过一个回溯算法来实践它，学习如何在保证函数值有实质性下降的同时，避免不必要的计算开销 [@problem_id:2184835]。", "problem": "一个优化算法被用来寻找实变量 $x$ 的函数 $f(x) = |x|$ 的最小值。在当前迭代中，点为 $x_k = 2$。选择的搜索方向为 $p_k = -1$。\n\n为了找到步长 $\\alpha$，采用了一种回溯线搜索算法。该算法从一个初始步长开始，并迭代地减小它，直到满足一个充分下降条件。被接受的步长是序列 $\\alpha_{init}, \\rho\\alpha_{init}, \\rho^2\\alpha_{init}, \\dots$ 中第一个满足以下条件的值：\n$$f(x_k + \\alpha p_k) \\leq f(x_k) + c \\alpha f'(x_k) p_k$$\n其中 $f'(x_k)$ 是 $f(x)$ 在 $x_k$ 处的导数。该算法的参数如下：\n- 初始步长 $\\alpha_{init} = 3.0$\n- 缩减因子 $\\rho = 0.5$\n- 充分下降常数 $c = 0.8$\n\n计算此算法所接受的步长 $\\alpha$ 的值。请以实数形式给出你的答案。", "solution": "我们寻求在回溯序列中，对于函数 $f(x) = |x|$、点 $x_{k} = 2$ 和搜索方向 $p_{k} = -1$，第一个满足 Armijo 充分下降条件的步长。函数 $f$ 的导数在 $x \\neq 0$ 时存在，当 $x > 0$ 时为 $f'(x) = 1$，当 $x < 0$ 时为 $f'(x) = -1$。由于 $x_{k} = 2 > 0$，我们有 $f'(x_{k}) = 1$。\n\nArmijo 条件是\n$$\nf(x_{k} + \\alpha p_{k}) \\leq f(x_{k}) + c\\,\\alpha\\,f'(x_{k})\\,p_{k}\n$$\n。\n将 $x_{k} = 2$、$p_{k} = -1$ 和 $f'(x_{k}) = 1$ 代入可得\n$$\n|2 - \\alpha| \\leq 2 - c\\alpha\n$$\n。\n我们对 $\\alpha$ 分情况讨论来解这个不等式。\n\n对于 $0 \\leq \\alpha \\leq 2$，我们有 $|2 - \\alpha| = 2 - \\alpha$，所以\n$$\n2 - \\alpha \\leq 2 - c\\alpha \\;\\;\\Longleftrightarrow\\;\\; -\\alpha \\leq -c\\alpha \\;\\;\\Longleftrightarrow\\;\\; \\alpha \\geq c\\alpha \\;\\;\\Longleftrightarrow\\;\\; (1 - c)\\alpha \\geq 0,\n$$\n由于在回溯线搜索中 $c \\in (0,1)$，此不等式对所有 $\\alpha \\geq 0$ 均成立。\n\n对于 $\\alpha > 2$，我们有 $|2 - \\alpha| = \\alpha - 2$，所以\n$$\n\\alpha - 2 \\leq 2 - c\\alpha \\;\\;\\Longleftrightarrow\\;\\; (1 + c)\\alpha \\leq 4 \\;\\;\\Longleftrightarrow\\;\\; \\alpha \\leq \\frac{4}{1 + c}.\n$$\n因此，Armijo 条件对所有 $\\alpha \\in [0, \\frac{4}{1 + c}]$ 成立。\n\n当 $c = 0.8$ 时，这个阈值是\n$$\n\\frac{4}{1 + c} = \\frac{4}{1.8} = \\frac{20}{9}.\n$$\n回溯的候选步长为 $\\alpha_{0} = \\alpha_{\\text{init}} = 3.0$，$\\alpha_{1} = \\rho \\alpha_{0} = 0.5 \\times 3.0 = 1.5$，$\\alpha_{2} = 0.75$，等等。由于 $3.0 > \\frac{20}{9}$，$\\alpha_{0}$ 不满足该条件。接下来，$\\alpha_{1} = 1.5 \\leq 2$，该值位于条件恒成立的区间内，所以它被接受。作为检验，\n$$\n|2 - 1.5| = 0.5 \\leq 2 - 0.8 \\times 1.5 = 0.8.\n$$\n因此，被接受的步长是 $\\alpha = 1.5$。", "answer": "$$\\boxed{1.5}$$", "id": "2184835"}, {"introduction": "除了简单的回溯，我们还能利用更多信息来更智能地选择步长。本练习将向你展示一种在现代优化求解器中广泛应用的高级技术：多项式插值。你将学习如何利用已知的函数值和导数值构建一个目标函数的一维三次模型，并求解该模型的极小值点来作为下一个试探步长，这大大提升了线搜索的效率 [@problem_id:2184822]。", "problem": "在线性搜索程序中处理无约束优化问题时，目标是找到一个步长 $\\alpha > 0$，以最小化沿给定搜索方向的函数 $\\phi(\\alpha)$。一个常见的策略是基于可用数据，使用一个更简单的模型来近似 $\\phi(\\alpha)$。\n\n考虑一个我们用三次多项式 $h(\\alpha)$ 来为 $\\phi(\\alpha)$ 建模的案例。我们已经评估了两个试验步长 $\\alpha_a$ 和 $\\alpha_b$，并获得了相应的函数值 $\\phi(\\alpha_a)$ 和 $\\phi(\\alpha_b)$，以及导数值 $\\phi'(\\alpha_a)$ 和 $\\phi'(\\alpha_b)$。三次模型 $h(\\alpha)$ 被构造为对这些数据进行插值的唯一三次多项式，这意味着它满足 $h(\\alpha_a) = \\phi(\\alpha_a)$、$h'(\\alpha_a) = \\phi'(\\alpha_a)$、$h(\\alpha_b) = \\phi(\\alpha_b)$ 和 $h'(\\alpha_b) = \\phi'(\\alpha_b)$。\n\n假设两个试验步长为 $\\alpha_a = 1$ 和 $\\alpha_b = 4$。评估得到的数据如下：\n- $\\phi(\\alpha_a) = 5$\n- $\\phi'(\\alpha_a) = -7$\n- $\\phi(\\alpha_b) = 8$\n- $\\phi'(\\alpha_b) = 2$\n\n基于这些信息，确定在区间 $[\\alpha_a, \\alpha_b]$ 内对应于插值三次多项式 $h(\\alpha)$ 局部最小值的新试验步长 $\\alpha_*$。\n\n将您的最终答案四舍五入到四位有效数字。", "solution": "我们用一个三次多项式 $h(\\alpha)$ 对 $\\phi(\\alpha)$ 进行建模，该多项式对 $\\alpha_{a}=1$ 和 $\\alpha_{b}=4$ 处的函数值和导数值进行插值。引入 $t=\\alpha-1$，则 $t\\in[0,3]$。令\n$$\nh(\\alpha)=p(t)=a t^{3}+b t^{2}+c t+d\n$$\n。\n埃尔米特插值条件为：\n$$\np(0)=\\phi(1)=5,\\quad p'(0)=\\phi'(1)=-7,\\quad p(3)=\\phi(4)=8,\\quad p'(3)=\\phi'(4)=2\n$$\n。\n由 $p(0)=d=5$ 和 $p'(0)=c=-7$。使用 $p(3)=27a+9b+3c+d=8$ 和 $p'(3)=27a+6b+c=2$，代入 $c=-7$ 和 $d=5$ 得到线性方程组\n$$\n27a+9b=24,\\quad 27a+6b=9\n$$\n。\n两式相减得到 $3b=15$，因此 $b=5$。然后 $27a+6\\cdot 5=9$ 意味着 $27a=-21$，所以 $a=-\\frac{7}{9}$。因此，\n$$\np(t)=-\\frac{7}{9}t^{3}+5t^{2}-7t+5,\\quad p'(t)=-\\frac{7}{3}t^{2}+10t-7\n$$\n。\n驻点满足 $p'(t)=0$：\n$$\n-\\frac{7}{3}t^{2}+10t-7=0\\;\\;\\Longleftrightarrow\\;\\;7t^{2}-30t+21=0\n$$\n。\n解得\n$$\nt=\\frac{30\\pm\\sqrt{900-588}}{14}=\\frac{30\\pm\\sqrt{312}}{14}=\\frac{15\\pm\\sqrt{78}}{7}\n$$\n。\n在 $t\\in[0,3]$ 上，只有 $t_{*}=\\frac{15-\\sqrt{78}}{7}$ 在此区间内。二阶导数为\n$$\np''(t)=-\\frac{14}{3}t+10\n$$\n，\n且 $p''(t_{*})>0$，这确认了该点是一个局部最小值。因此\n$$\n\\alpha_{*}=1+t_{*}=1+\\frac{15-\\sqrt{78}}{7}=\\frac{22-\\sqrt{78}}{7}\\approx 1.881177\\ldots\n$$\n四舍五入到四位有效数字，$\\alpha_{*}=1.881$。", "answer": "$$\\boxed{1.881}$$", "id": "2184822"}]}