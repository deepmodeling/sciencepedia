{"hands_on_practices": [{"introduction": "在深入研究 BFGS 更新公式本身之前，我们首先需要熟悉其基本构件。这个练习将指导你计算两个核心向量：步长向量 $s_k = x_{k+1} - x_k$ 和梯度差向量 $y_k = \\nabla f(x_{k+1}) - \\nabla f(x_k)$。掌握这些基本计算是理解和应用 BFGS 算法的第一步 [@problem_id:2208670]。", "problem": "在数值优化中，拟牛顿法是用于寻找函数局部最小值或最大值的一类算法。此类算法中一个著名的方法是Broyden-Fletcher-Goldfarb-Shanno (BFGS)算法，它通过迭代来近似目标函数的逆Hessian矩阵。该过程中的一个关键步骤是计算从一次迭代到下一次迭代的两个向量：步长向量 $s_k = x_{k+1} - x_k$ 和梯度差向量 $y_k = \\nabla f(x_{k+1}) - \\nabla f(x_k)$。\n\n考虑一个双变量函数 $f(x_1, x_2)$ 的优化问题，其定义如下：\n$$\nf(x_1, x_2) = x_1^2 \\sin(x_2) + x_2^2 \\cos(x_1)\n$$\n一个优化算法当前处于第 $k$ 次迭代，序列中最近的两个点由向量 $x_k = (0, \\pi)$ 和 $x_{k+1} = (\\frac{\\pi}{2}, 0)$ 给出。\n\n计算步长向量 $s_k = (s_{k,1}, s_{k,2})$ 和梯度差向量 $y_k = (y_{k,1}, y_{k,2})$ 的分量。将你的最终答案表示为一个单行矩阵，其中包含按 $s_{k,1}, s_{k,2}, y_{k,1}, y_{k,2}$ 顺序排列的四个分量。", "solution": "目标是针对给定的函数和点，计算步长向量 $s_k = x_{k+1} - x_k$ 和梯度差向量 $y_k = \\nabla f(x_{k+1}) - \\nabla f(x_k)$ 的分量。\n\n首先，我们计算步长向量 $s_k$。给定的点为 $x_k = (0, \\pi)$ 和 $x_{k+1} = (\\frac{\\pi}{2}, 0)$。\n$s_k$ 的分量通过将 $x_{k+1}$ 的分量减去 $x_k$ 的分量得到：\n$$\ns_k = x_{k+1} - x_k = \\begin{pmatrix} \\frac{\\pi}{2} \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 0 \\\\ \\pi \\end{pmatrix} = \\begin{pmatrix} \\frac{\\pi}{2} - 0 \\\\ 0 - \\pi \\end{pmatrix} = \\begin{pmatrix} \\frac{\\pi}{2} \\\\ -\\pi \\end{pmatrix}\n$$\n所以，$s_{k,1} = \\frac{\\pi}{2}$ 且 $s_{k,2} = -\\pi$。\n\n接下来，我们计算梯度差向量 $y_k$。这需要求出函数 $f(x_1, x_2)$ 的梯度，并在点 $x_k$ 和 $x_{k+1}$ 处对其求值。\n函数为 $f(x_1, x_2) = x_1^2 \\sin(x_2) + x_2^2 \\cos(x_1)$。\n梯度 $\\nabla f$ 是一个由偏导数组成的向量：\n$$\n\\nabla f(x_1, x_2) = \\begin{pmatrix} \\frac{\\partial f}{\\partial x_1} \\\\ \\frac{\\partial f}{\\partial x_2} \\end{pmatrix}\n$$\n关于 $x_1$ 的偏导数是：\n$$\n\\frac{\\partial f}{\\partial x_1} = \\frac{\\partial}{\\partial x_1} (x_1^2 \\sin(x_2) + x_2^2 \\cos(x_1)) = 2x_1 \\sin(x_2) - x_2^2 \\sin(x_1)\n$$\n关于 $x_2$ 的偏导数是：\n$$\n\\frac{\\partial f}{\\partial x_2} = \\frac{\\partial}{\\partial x_2} (x_1^2 \\sin(x_2) + x_2^2 \\cos(x_1)) = x_1^2 \\cos(x_2) + 2x_2 \\cos(x_1)\n$$\n所以梯度向量是：\n$$\n\\nabla f(x_1, x_2) = \\begin{pmatrix} 2x_1 \\sin(x_2) - x_2^2 \\sin(x_1) \\\\ x_1^2 \\cos(x_2) + 2x_2 \\cos(x_1) \\end{pmatrix}\n$$\n现在，我们在点 $x_k = (0, \\pi)$ 处计算梯度：\n$$\n\\nabla f(x_k) = \\nabla f(0, \\pi) = \\begin{pmatrix} 2(0) \\sin(\\pi) - \\pi^2 \\sin(0) \\\\ 0^2 \\cos(\\pi) + 2\\pi \\cos(0) \\end{pmatrix} = \\begin{pmatrix} 0 - \\pi^2(0) \\\\ 0(-1) + 2\\pi(1) \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 2\\pi \\end{pmatrix}\n$$\n接着，我们在点 $x_{k+1} = (\\frac{\\pi}{2}, 0)$ 处计算梯度：\n$$\n\\nabla f(x_{k+1}) = \\nabla f(\\frac{\\pi}{2}, 0) = \\begin{pmatrix} 2(\\frac{\\pi}{2}) \\sin(0) - 0^2 \\sin(\\frac{\\pi}{2}) \\\\ (\\frac{\\pi}{2})^2 \\cos(0) + 2(0) \\cos(\\frac{\\pi}{2}) \\end{pmatrix} = \\begin{pmatrix} \\pi(0) - 0(1) \\\\ \\frac{\\pi^2}{4}(1) + 0(0) \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ \\frac{\\pi^2}{4} \\end{pmatrix}\n$$\n最后，我们计算梯度差向量 $y_k$：\n$$\ny_k = \\nabla f(x_{k+1}) - \\nabla f(x_k) = \\begin{pmatrix} 0 \\\\ \\frac{\\pi^2}{4} \\end{pmatrix} - \\begin{pmatrix} 0 \\\\ 2\\pi \\end{pmatrix} = \\begin{pmatrix} 0 - 0 \\\\ \\frac{\\pi^2}{4} - 2\\pi \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ \\frac{\\pi^2}{4} - 2\\pi \\end{pmatrix}\n$$\n所以，$y_{k,1} = 0$ 且 $y_{k,2} = \\frac{\\pi^2}{4} - 2\\pi$。\n\n这四个分量是 $s_{k,1} = \\frac{\\pi}{2}$，$s_{k,2} = -\\pi$，$y_{k,1} = 0$ 和 $y_{k,2} = \\frac{\\pi^2}{4} - 2\\pi$。\n将这些分量按指定顺序组合成一个单行矩阵，得到：\n$$\n\\begin{pmatrix} \\frac{\\pi}{2} & -\\pi & 0 & \\frac{\\pi^2}{4} - 2\\pi \\end{pmatrix}\n$$", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\pi}{2} & -\\pi & 0 & \\frac{\\pi^{2}}{4} - 2\\pi \\end{pmatrix}}\n$$", "id": "2208670"}, {"introduction": "BFGS 算法的一个关键要求是“曲率条件”必须得到满足，即 $y_k^T s_k > 0$。这个条件确保了 Hessian 近似矩阵的正定性得以保持，这对于保证算法朝着最小值稳定收敛至关重要。通过这个练习，你将亲手验证在给定的迭代步中，这个条件是否成立 [@problem_id:2208660]。", "problem": "在无约束优化的背景下，拟牛顿法是用于寻找局部最小值的一类流行的迭代算法。该族中的一个关键算法是 Broyden-Fletcher-Goldfarb-Shanno (BFGS) 方法。对近似Hessian矩阵的 BFGS 更新要求在每一步都满足一个称为曲率条件的特定条件，以确保更新后的矩阵保持正定。\n\n考虑对一个由下式定义的函数 $f: \\mathbb{R}^2 \\to \\mathbb{R}$ 进行优化：\n$$f(x_1, x_2) = x_1^4 + x_1 x_2 + (1+x_2)^2$$\n\n假设一个迭代优化过程处于迭代点 $x_k = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$，并移动到下一个迭代点 $x_{k+1} = \\begin{pmatrix} 0.5 \\\\ 1 \\end{pmatrix}$。\n\n曲率条件由乘积 $y_k^T s_k$ 的符号来表征。向量 $s_k$ 和 $y_k$ 定义如下：\n- 步长向量：$s_k = x_{k+1} - x_k$\n- 梯度变化量：$y_k = \\nabla f(x_{k+1}) - \\nabla f(x_k)$\n\n计算在给定迭代点下表达式 $y_k^T s_k$ 的值。将你的最终答案四舍五入到三位有效数字。", "solution": "我们首先计算函数 $f(x_1, x_2) = x_1^4 + x_1 x_2 + (1+x_2)^2$ 的梯度。其偏导数为：\n$$\n\\frac{\\partial f}{\\partial x_1} = 4x_1^3 + x_2, \\qquad \\frac{\\partial f}{\\partial x_2} = x_1 + 2(1+x_2)\n$$\n因此，梯度向量为：\n$$\n\\nabla f(x_1, x_2) = \\begin{pmatrix} 4x_1^3 + x_2 \\\\ x_1 + 2(1+x_2) \\end{pmatrix}\n$$\n给定的迭代点为 $x_k = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$ 和 $x_{k+1} = \\begin{pmatrix} 0.5 \\\\ 1 \\end{pmatrix}$，步长向量为：\n$$\ns_k = x_{k+1} - x_k = \\begin{pmatrix} 0.5 - 1 \\\\ 1 - 1 \\end{pmatrix} = \\begin{pmatrix} -0.5 \\\\ 0 \\end{pmatrix}\n$$\n计算在两个点上的梯度值：\n$$\n\\nabla f(x_k) = \\nabla f(1,1) = \\begin{pmatrix} 4 \\cdot 1^3 + 1 \\\\ 1 + 2(1+1) \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 5 \\end{pmatrix}\n$$\n$$\n\\nabla f(x_{k+1}) = \\nabla f(0.5, 1) = \\begin{pmatrix} 4(0.5)^3 + 1 \\\\ 0.5 + 2(1+1) \\end{pmatrix} = \\begin{pmatrix} 4(0.125) + 1 \\\\ 0.5 + 4 \\end{pmatrix} = \\begin{pmatrix} 1.5 \\\\ 4.5 \\end{pmatrix}\n$$\n因此，梯度变化量为：\n$$\ny_k = \\nabla f(x_{k+1}) - \\nabla f(x_k) = \\begin{pmatrix} 1.5 - 5 \\\\ 4.5 - 5 \\end{pmatrix} = \\begin{pmatrix} -3.5 \\\\ -0.5 \\end{pmatrix}\n$$\n现在，计算曲率条件量 $y_k^T s_k$：\n$$\ny_k^T s_k = \\begin{pmatrix} -3.5 & -0.5 \\end{pmatrix} \\begin{pmatrix} -0.5 \\\\ 0 \\end{pmatrix} = (-3.5)(-0.5) + (-0.5)(0) = 1.75\n$$\n四舍五入到三位有效数字，其值为 $1.75$。", "answer": "$$\\boxed{1.75}$$", "id": "2208660"}, {"introduction": "现在，你已经熟悉了 BFGS 更新的构件和其先决条件，是时候将它们整合起来，执行一次完整的逆 Hessian 矩阵更新了。这个实践将引导你应用完整的 BFGS 公式，从一个初始的近似矩阵 $H_k$ 计算出更新后的矩阵 $H_{k+1}$。这是掌握 BFGS 方法核心机制的综合性练习 [@problem_id:2208621]。", "problem": "在数值优化中，拟牛顿法用于寻找函数的最小值。这些方法在每次迭代中构建逆赫斯矩阵的一个近似。最流行的更新过程之一是 Broyden-Fletcher-Goldfarb-Shanno (BFGS) 更新公式。\n\n设 $H_k$ 为第 $k$ 次迭代时逆赫斯矩阵的近似。从点 $x_k$ 移动一步到 $x_{k+1}$ 后，逆赫斯矩阵使用以下公式更新为 $H_{k+1}$：\n$$ H_{k+1} = \\left(I - \\frac{s_k y_k^T}{y_k^T s_k}\\right) H_k \\left(I - \\frac{y_k s_k^T}{y_k^T s_k}\\right) + \\frac{s_k s_k^T}{y_k^T s_k} $$\n其中 $I$ 是单位矩阵，步长向量为 $s_k = x_{k+1} - x_k$，梯度变化量为 $y_k = \\nabla f(x_{k+1}) - \\nabla f(x_k)$。\n\n考虑一个函数 $f: \\mathbb{R}^2 \\to \\mathbb{R}$。在第 $k$ 次迭代时，我们有以下信息：\n- 当前的逆赫斯矩阵近似为单位矩阵：$H_k = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix}$。\n- 当前点为 $x_k = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$。\n- 当前点的梯度为 $\\nabla f(x_k) = \\begin{pmatrix} -3 \\\\ 1 \\end{pmatrix}$。\n- 下一个点为 $x_{k+1} = \\begin{pmatrix} 2 \\\\ 0 \\end{pmatrix}$。\n- 下一个点的梯度为 $\\nabla f(x_{k+1}) = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。\n\n计算更新后的逆赫斯矩阵近似 $H_{k+1}$。确定 $H_{k+1}$ 的第二行第一列元素的值。将您的最终答案四舍五入到三位有效数字。", "solution": "我们使用 BFGS 逆赫斯更新公式：\n$$\nH_{k+1} = \\left(I - \\frac{s_k y_k^T}{y_k^T s_k}\\right) H_k \\left(I - \\frac{y_k s_k^T}{y_k^T s_k}\\right) + \\frac{s_k s_k^T}{y_k^T s_k}\n$$\n给定 $H_k = I$，$x_k = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$，$x_{k+1} = \\begin{pmatrix} 2 \\\\ 0 \\end{pmatrix}$，$\\nabla f(x_k) = \\begin{pmatrix} -3 \\\\ 1 \\end{pmatrix}$ 以及 $\\nabla f(x_{k+1}) = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$，我们首先计算 $s_k$ 和 $y_k$：\n$$\ns_k = x_{k+1} - x_k = \\begin{pmatrix} 2 - 1 \\\\ 0 - 2 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ -2 \\end{pmatrix}\n$$\n$$\ny_k = \\nabla f(x_{k+1}) - \\nabla f(x_k) = \\begin{pmatrix} 1 - (-3) \\\\ -1 - 1 \\end{pmatrix} = \\begin{pmatrix} 4 \\\\ -2 \\end{pmatrix}\n$$\n标量 $y_k^T s_k$ 为：\n$$\ny_k^T s_k = (4)(1) + (-2)(-2) = 4 + 4 = 8\n$$\n接下来，构建所需的矩阵：\n$$\ns_k s_k^T = \\begin{pmatrix} 1 \\\\ -2 \\end{pmatrix} \\begin{pmatrix} 1 & -2 \\end{pmatrix} = \\begin{pmatrix} 1 & -2 \\\\ -2 & 4 \\end{pmatrix}\n$$\n$$\ns_k y_k^T = \\begin{pmatrix} 1 \\\\ -2 \\end{pmatrix} \\begin{pmatrix} 4 & -2 \\end{pmatrix} = \\begin{pmatrix} 4 & -2 \\\\ -8 & 4 \\end{pmatrix}\n$$\n$$\ny_k s_k^T = (s_k y_k^T)^T = \\begin{pmatrix} 4 & -8 \\\\ -2 & 4 \\end{pmatrix}\n$$\n现在，计算更新公式中的项。由于 $H_k = I$，第一项简化为：\n$$\n\\left(I - \\frac{s_k y_k^T}{y_k^T s_k}\\right) H_k \\left(I - \\frac{y_k s_k^T}{y_k^T s_k}\\right) = \\left(I - \\frac{1}{8}s_k y_k^T\\right) \\left(I - \\frac{1}{8}y_k s_k^T\\right)\n$$\n其中\n$$\nI - \\frac{1}{8}s_k y_k^T = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix} - \\frac{1}{8}\\begin{pmatrix} 4 & -2 \\\\ -8 & 4 \\end{pmatrix} = \\begin{pmatrix} 1 - 1/2 & 1/4 \\\\ 1 & 1 - 1/2 \\end{pmatrix} = \\begin{pmatrix} 1/2 & 1/4 \\\\ 1 & 1/2 \\end{pmatrix}\n$$\n$$\nI - \\frac{1}{8}y_k s_k^T = \\left(I - \\frac{1}{8}s_k y_k^T\\right)^T = \\begin{pmatrix} 1/2 & 1 \\\\ 1/4 & 1/2 \\end{pmatrix}\n$$\n计算它们的乘积：\n$$\n\\begin{pmatrix} 1/2 & 1/4 \\\\ 1 & 1/2 \\end{pmatrix} \\begin{pmatrix} 1/2 & 1 \\\\ 1/4 & 1/2 \\end{pmatrix} = \\begin{pmatrix} (1/4)+(1/16) & (1/2)+(1/8) \\\\ (1/2)+(1/8) & 1+(1/4) \\end{pmatrix} = \\begin{pmatrix} 5/16 & 5/8 \\\\ 5/8 & 5/4 \\end{pmatrix}\n$$\n更新公式的第二项是：\n$$\n\\frac{s_k s_k^T}{y_k^T s_k} = \\frac{1}{8}\\begin{pmatrix} 1 & -2 \\\\ -2 & 4 \\end{pmatrix} = \\begin{pmatrix} 1/8 & -1/4 \\\\ -1/4 & 1/2 \\end{pmatrix}\n$$\n最后，将两项相加得到 $H_{k+1}$：\n$$\nH_{k+1} = \\begin{pmatrix} 5/16 & 5/8 \\\\ 5/8 & 5/4 \\end{pmatrix} + \\begin{pmatrix} 1/8 & -1/4 \\\\ -1/4 & 1/2 \\end{pmatrix} = \\begin{pmatrix} 5/16+2/16 & 5/8-2/8 \\\\ 5/8-2/8 & 5/4+2/4 \\end{pmatrix} = \\begin{pmatrix} 7/16 & 3/8 \\\\ 3/8 & 7/4 \\end{pmatrix}\n$$\n$H_{k+1}$ 的第二行第一列元素是 $\\frac{3}{8}=0.375$。四舍五入到三位有效数字得到 $0.375$。", "answer": "$$\\boxed{0.375}$$", "id": "2208621"}]}