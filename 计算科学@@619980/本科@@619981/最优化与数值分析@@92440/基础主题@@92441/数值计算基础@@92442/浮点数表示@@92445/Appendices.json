{"hands_on_practices": [{"introduction": "掌握浮点数的第一步是理解一个十进制值如何被转换成其二进制表示。这个练习将引导你将一个负小数值编码为一个自定义的、简化的浮点格式。通过这个实践，你将巩固确定符号、指数和尾数这些核心步骤，为理解更复杂的浮点数概念打下坚实的基础。[@problem_id:1937491]", "problem": "一位工程师正在为一个环境传感器节点设计一个专用的低功耗微控制器。为了节省硬件资源，该微控制器采用了一种自定义的8位浮点数格式来存储传感器读数。该格式定义如下：\n- 1位用于符号（S），其中1表示负数。\n- 4位用于偏置指数（E）。指数偏置值为7。\n- 3位用于小数部分（F），代表尾数。\n\n在此格式中，一个规格化数的值由公式 $V = (-1)^{S} \\times (1.F)_{2} \\times 2^{(E - \\text{bias})}$ 给出，其中 $(1.F)_{2}$ 是带有隐含前导1的有效数。\n\n传感器记录了一个温度偏差值 $-0.375$。你的任务是确定该值在这种自定义浮点格式下的正确8位二进制表示，表达为单个二进制字符串 S EEEE FFF。\n\n以下哪个选项表示了值 $-0.375$ 在这种8位格式下的表示？\n\nA. 10110100\n\nB. 00101100\n\nC. 10101100\n\nD. 10101011\n\nE. 10111011", "solution": "给定一个自定义的8位浮点格式，其字段为：符号位 $S$、偏置为 $7$ 的4位偏置指数 $E$ 以及3位小数部分 $F$。对于一个规格化数，其值为\n$$\nV = (-1)^{S} \\times (1.F)_{2} \\times 2^{E - \\text{bias}}。\n$$\n我们需要表示 $-0.375$。首先将其绝对值转换为二进制：\n$$\n0.375 = \\frac{3}{8} = \\frac{1}{4} + \\frac{1}{8} = 0.011_{2}.\n$$\n将其规格化为 $(1.F)_{2} \\times 2^{e}$ 的形式。将 $0.011_{2}$ 左移两位得到\n$$\n0.011_{2} = 1.1_{2} \\times 2^{-2}.\n$$\n因此，真实指数为 $e = -2$，规格化的有效数为 $(1.F)_{2} = 1.100\\ldots_{2}$。对于3位的小数部分，我们精确地取 $F = 100$（无需舍入）。\n\n存储的指数是偏置值\n$$\nE = e + \\text{bias} = -2 + 7 = 5,\n$$\n其4位二进制表示为 $0101$。\n\n符号为负，所以 $S = 1$。\n\n因此，8位模式 $S\\,EEEE\\,FFF$ 是\n$$\n1\\ 0101\\ 100 \\quad \\text{也就是} \\quad 10101100.\n$$\n这对应于选项C。验证其值：\n$$\nV = (-1)^{1} \\times (1.100)_{2} \\times 2^{5-7} = -\\left(1.5\\right) \\times 2^{-2} = -0.375,\n$$\n这是正确的。", "answer": "$$\\boxed{C}$$", "id": "1937491"}, {"introduction": "在掌握了表示法的基础之上，这个练习将探索其内在的局限性。我们将从自定义格式转向广泛使用的 IEEE 754 单精度标准，并探究一个关键问题：从何时起，可表示的数之间的间隔会变得大于1？这个练习揭示了为何即便是整数也并非总能被完美存储，这是理解数值误差的一个根本性概念。[@problem_id:2173582]", "problem": "在现代计算中，实数通常使用浮点表示法来近似。一个广泛采用的标准是 Institute of Electrical and Electronics Engineers (IEEE) 754 标准。该标准下的单精度格式使用 32 位来表示一个数。\n\n这 32 位分配如下：\n- 1 位用于符号（$s$）。\n- 8 位用于偏置指数（$E$）。\n- 23 位用于尾数（$f$）。\n\n对于一个正的、规格化的数（其中符号位 $s=0$），其值 $V$ 由以下公式确定：\n$$V = 2^{E-127} \\times (1.f)_2$$\n此处，$127$ 是指数偏置量。项 $(1.f)_2$ 表示二进制的有效数，其中“1.”是一个不被存储的隐藏前导位，而 $f$ 是存储在尾数位中的 23 位二进制小数。对于规格化的数，偏置指数 $E$ 的范围为 1 至 254。\n\n尽管这种格式可以表示很大范围的数，但其有限的精度意味着并非所有数都能被精确表示。在考虑整数时，这一局限性就变得特别有趣。例如，整数 5 可以写作 $1.25 \\times 4 = (1.01)_2 \\times 2^2$。这对应于尾数 $f=0100...0$ 和一个产生 2 的幂的指数部分，因此 5 是可以精确表示的。\n\n你的任务是找出不能用 IEEE 754 单精度浮点格式精确表示的最小正整数。", "solution": "一个规格化的单精度值具有以下形式\n$$V=2^{e}\\,(1.f)_{2},\\quad e=E-127,$$\n其中，有效数有一个隐藏的前导位加上 23 个存储的尾数位，从而给出 $p=24$ 位的有效精度。将尾数 $f$ 增加一个单位会使 $(1.f)_{2}$ 改变 $2^{-23}$，因此对于固定的指数 $e$，连续可表示数之间的间距（最后一位的单位，ulp）是\n$$\\mathrm{ulp}(e)=2^{e}\\cdot 2^{-23}=2^{e-23}.$$\n\n要在某个区间内精确表示每个整数，该区间的间距必须至多为 $1$。因此我们要求\n$$\\mathrm{ulp}(e)\\leq 1 \\quad \\Longleftrightarrow \\quad 2^{e-23}\\leq 1 \\quad \\Longleftrightarrow \\quad e\\leq 23.$$\n在范围 $[2^{23},\\,2^{24})$ 内的数有 $e=23$，因此 $\\mathrm{ulp}=1$，所以该范围内的每个整数都是可表示的。值 $2^{24}$ 本身也是可以精确表示的，它是一个 2 的幂，有效数为 $(1.0)_{2}$ 且 $e=24$。\n\n对于下一个范围 $[2^{24},\\,2^{25})$，我们有 $e=24$，因此\n$$\\mathrm{ulp}(24)=2^{24-23}=2,$$\n所以在此范围内只有 2 的倍数是可表示的。因此，这个范围内不能被精确表示的最小整数是最小的奇数，\n$$2^{24}+1.$$\n\n由于所有小于或等于 $2^{24}$ 的正整数都可以被精确表示，而 $2^{24}+1$ 不能，因此，不能用 IEEE 754 单精度格式精确表示的最小正整数是 $2^{24}+1$。", "answer": "$$\\boxed{16777217}$$", "id": "2173582"}, {"introduction": "浮点数的有限精度对算术运算有着令人惊讶的影响。本练习将证明，对于实数成立的加法结合律（即 $(a+b)+c = a+(b+c)$）在浮点数世界中并不总是适用，其根本原因在于每次运算后的舍入。通过一个具体的例子，你将亲眼见证运算顺序如何能够戏剧性地改变最终结果。[@problem_id:1937506]", "problem": "考虑一个为简单嵌入式系统设计的自定义6位浮点数表示法。该格式使用1位作为符号位 (S)，3位作为指数位 (E)，2位作为小数位 (F)。各位的排列顺序为 S E E E F F。\n\n数值由以下规则确定：\n- 如果指数域E不全为0或不全为1（即，对于 $1 \\leq E_{decimal} \\leq 6$），该数为规格化数，其值为 $V = (-1)^S \\times (1.F)_2 \\times 2^{E_{decimal} - 3}$。其中 `3` 是指数偏移量。\n- 如果指数域E全为0，该数为非规格化数，其值为 $V = (-1)^S \\times (0.F)_2 \\times 2^{-2}$。零由所有位均为0表示。\n- 如果指数域E全为1，该数表示无穷大（如果F=00）或非数 (NaN)（如果F不为00）。\n\n所有涉及这些数的算术运算都必须遵循以下步骤：以全精度执行运算，然后将结果舍入以适应6位格式，之后才能进行任何后续运算。使用的舍入方案是“向最接近的值舍入，平局时向偶数舍入”(round-to-nearest, ties-to-even)。\n\n给定三个以这种6位格式表示的数 $A$、$B$ 和 $C$：\n- $A = \\text{011010}$\n- $B = \\text{111010}$\n- $C = \\text{000100}$\n\n你的任务是证明浮点数加法不满足结合律。首先，计算 $X = (A+B)+C$ 的结果。其次，计算 $Y = A+(B+C)$ 的结果。最后，计算绝对差 $|X-Y|$。\n\n将你的最终答案表示为单个十进制数。", "solution": "6位格式使用 $S$（符号）、$E$（带有偏移量 $3$ 的3位指数）和 $F$（2位小数）。对于规格化数（$1 \\leq E_{\\text{decimal}} \\leq 6$），其值为 $V = (-1)^{S}(1.F)_{2}2^{E_{\\text{decimal}}-3}$。对于非规格化数（$E=0$），其值为 $V = (-1)^{S}(0.F)_{2}2^{-2}$。算术运算先精确执行，然后在进行任何后续运算之前，将结果舍入到6位格式（向最接近的值舍入，平局时向偶数舍入）。\n\n解码 $A=011010$。这里 $S=0$， $E=110$ 所以 $E_{\\text{decimal}}=6$，且 $F=10$。这是一个规格化数，指数 $e=6-3=3$，尾数 $(1.F)_{2}=1+2^{-1}= \\frac{3}{2}$。因此\n$$\nA = \\frac{3}{2}\\cdot 2^{3} = 12.\n$$\n\n解码 $B=111010$。这里 $S=1$， $E=110$ 所以 $e=3$，且 $F=10$；因此 $B=-\\frac{3}{2}\\cdot 2^{3}=-12$。\n\n解码 $C=000100$。这里 $S=0$， $E=001$ 所以 $e=1-3=-2$，且 $F=00$；因此 $(1.F)_{2}=1$ 且\n$$\nC = 1\\cdot 2^{-2} = \\frac{1}{4}.\n$$\n\n计算 $X=(A+B)+C$，每次运算后进行舍入。\n首先，精确和为\n$$\nA+B = 12 + (-12) = 0,\n$$\n该值可以被精确表示，所以 $\\operatorname{round}(A+B)=0$。接着，\n$$\n0 + C = \\frac{1}{4},\n$$\n且 $\\frac{1}{4}$ 可以被精确表示（规格化数，其中 $E=001, F=00$），所以 $X=\\frac{1}{4}$。\n\n计算 $Y=A+(B+C)$，每次运算后进行舍入。\n首先，\n$$\nB+C = -12 + \\frac{1}{4} = -\\frac{47}{4} = -11.75.\n$$\n在指数 $e=3$ 时，最接近的可表示规格化数的形式为 $(1+\\frac{q}{4})2^{3}$，其中 $q\\in\\{0,1,2,3\\}$，即量值为 $8,10,12,14$，当为负数时，给出 $\\{-14,-12,-10,-8\\}$。距离为\n$$\n\\left|-\\frac{47}{4}-(-12)\\right|=\\frac{1}{4},\\quad \\left|-\\frac{47}{4}-(-10)\\right|=\\frac{7}{4},\n$$\n所以根据向最接近的值舍入（无平局情况），$\\operatorname{round}(B+C)=-12$。然后\n$$\nA+(-12) = 12+(-12)=0,\n$$\n该值可以被精确表示，所以 $Y=0$。\n\n最后，\n$$\n|X-Y| = \\left|\\frac{1}{4}-0\\right| = \\frac{1}{4} = 0.25.\n$$", "answer": "$$\\boxed{0.25}$$", "id": "1937506"}]}