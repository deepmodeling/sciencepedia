{"hands_on_practices": [{"introduction": "向后误差分析与更直观的正向误差分析不同，它从一个独特的视角来审视计算或模型中的误差。与其问“给定输入的输出误差有多大？”，它反过来问“我们需要对输入进行多小的扰动，才能使输出变得完全精确？”。本练习通过一个简单的数据拟合问题，为这一概念提供了直观的几何解释。我们将计算一个数据点为了精确落在给定直线上所需做的最小调整，这个调整的量值正是该数据点的向后误差 [@problem_id:2155431]。", "problem": "在数值分析领域，后向误差分析是理解数学模型与观测数据之间偏差的强大工具。它不问“对于给定的输入，模型输出的误差有多大？”，而是问“对输入数据做多小的改动可以使模型的输出变得精确？”\n\n考虑一个由方程 $y = mx + c$ 给出的简单线性模型。我们采集了一个实验数据点 $(x_i, y_i)$，该点并不精确地落在这条直线上。我们希望找到与此数据点和模型相关的后向误差。\n\n后向误差定义为对数据点施加的最小扰动 $(\\delta x_i, \\delta y_i)$ 的大小，使得新点 $(x_i + \\delta x_i, y_i + \\delta y_i)$ 完全落在模型直线上。扰动的大小由标准欧几里得距离衡量，即我们寻求最小化 $\\sqrt{(\\delta x_i)^2 + (\\delta y_i)^2}$ 的值。\n\n请找到这个代表后向误差的最小扰动大小的符号表达式，用模型参数 $m$ 和 $c$ 以及数据坐标 $x_i$ 和 $y_i$ 来表示。", "solution": "我们寻求最小的扰动 $(\\delta x_{i}, \\delta y_{i})$，使得扰动后的点 $(x_{i} + \\delta x_{i}, y_{i} + \\delta y_{i})$ 精确地位于直线 $y = m x + c$ 上。这个要求施加了如下约束条件：\n$$\ny_{i} + \\delta y_{i} = m \\left(x_{i} + \\delta x_{i}\\right) + c,\n$$\n可以改写为\n$$\n\\delta y_{i} - m\\,\\delta x_{i} = m x_{i} + c - y_{i}.\n$$\n后向误差是欧几里得范数\n$$\n\\sqrt{(\\delta x_{i})^{2} + (\\delta y_{i})^{2}},\n$$\n在上述线性约束条件下的最小值。由于平方根函数是单调的，我们等价地最小化\n$$\nJ(\\delta x_{i}, \\delta y_{i}) = (\\delta x_{i})^{2} + (\\delta y_{i})^{2}\n$$\n其约束条件为\n$$\ng(\\delta x_{i}, \\delta y_{i}) = \\delta y_{i} - m\\,\\delta x_{i} - (m x_{i} + c - y_{i}) = 0.\n$$\n引入一个拉格朗日乘子 $\\lambda$，并构造函数\n$$\n\\mathcal{L} = (\\delta x_{i})^{2} + (\\delta y_{i})^{2} + \\lambda\\left(\\delta y_{i} - m\\,\\delta x_{i} - (m x_{i} + c - y_{i})\\right).\n$$\n令偏导数为零：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\delta x_{i}} = 2\\,\\delta x_{i} - \\lambda m = 0 \\quad \\Rightarrow \\quad \\delta x_{i} = \\frac{\\lambda m}{2},\n$$\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\delta y_{i}} = 2\\,\\delta y_{i} + \\lambda = 0 \\quad \\Rightarrow \\quad \\delta y_{i} = -\\frac{\\lambda}{2}.\n$$\n代入约束方程：\n$$\n\\delta y_{i} - m\\,\\delta x_{i} = m x_{i} + c - y_{i}.\n$$\n代入 $\\delta x_{i}$ 和 $\\delta y_{i}$ 的表达式：\n$$\n-\\frac{\\lambda}{2} - m\\left(\\frac{\\lambda m}{2}\\right) = m x_{i} + c - y_{i}\n\\quad \\Rightarrow \\quad\n-\\frac{\\lambda}{2}(1 + m^{2}) = m x_{i} + c - y_{i}.\n$$\n于是\n$$\n\\lambda = \\frac{2\\,(y_{i} - m x_{i} - c)}{1 + m^{2}}.\n$$\n因此，\n$$\n\\delta x_{i} = \\frac{\\lambda m}{2} = \\frac{m\\,(y_{i} - m x_{i} - c)}{1 + m^{2}}, \n\\quad\n\\delta y_{i} = -\\frac{\\lambda}{2} = -\\frac{y_{i} - m x_{i} - c}{1 + m^{2}}.\n$$\n最小平方值为\n$$\n(\\delta x_{i})^{2} + (\\delta y_{i})^{2} \n= \\frac{m^{2}(y_{i} - m x_{i} - c)^{2} + (y_{i} - m x_{i} - c)^{2}}{(1 + m^{2})^{2}}\n= \\frac{(y_{i} - m x_{i} - c)^{2}}{1 + m^{2}}.\n$$\n因此最小扰动大小（即后向误差）为\n$$\n\\frac{|y_{i} - m x_{i} - c|}{\\sqrt{1 + m^{2}}}.\n$$\n这就是点 $(x_{i}, y_{i})$ 到直线 $y = m x + c$ 的垂直距离。", "answer": "$$\\boxed{\\frac{|y_{i} - m x_{i} - c|}{\\sqrt{1 + m^{2}}}}$$", "id": "2155431"}, {"introduction": "由于计算机使用有限精度的浮点运算，数值算法的计算结果几乎总是包含舍入误差。向后误差分析是评估这些算法稳定性的核心工具。本练习将展示，一个通过数值方法计算出的多项式根，可以被精确地看作是一个系数稍有不同的“扰动”多项式的精确根。通过找到这个扰动后的多项式，我们可以量化算法的向后稳定性 [@problem_id:2155426]。", "problem": "在数值分析中，向后误差分析通过证明计算结果是某个邻近问题的精确解，来研究算法的稳定性。考虑对二次多项式 $p(x) = ax^2 + bx + c$ 在给定值 $\\hat{x}$ 处进行求值。该求值过程在浮点运算中采用霍纳方法进行，其运算序列对应于 $(a\\hat{x} + b)\\hat{x} + c$。\n\n我们采用一个简化的浮点运算模型，其中每个基本二元运算（`+`、`*`）都会引入一个相对误差。也就是说，对于任意两个数 $z_1$ 和 $z_2$，其浮点运算结果由 `fl(z_1 op z_2) = (z_1 op z_2)(1 + \\delta)` 给出，其中 $\\delta$ 是该特定运算特有的一个小的相对误差项。\n\n计算 $p(\\hat{x})$ 的浮点运算序列定义如下：\n1.  $a$ 与 $\\hat{x}$ 相乘，引入相对误差 $\\delta_1$。\n2.  步骤 1 的结果与 $b$ 相加，引入相对误差 $\\delta_2$。\n3.  步骤 2 的结果与 $\\hat{x}$ 相乘，引入相对误差 $\\delta_3$。\n4.  步骤 3 的结果与 $c$ 相加，引入相对误差 $\\delta_4$。\n\n一个数值求根算法产生了一个值 $\\hat{x}$，使得这个四步序列的最终计算结果恰好为零。这意味着 $\\hat{x}$ 可以被认为是该多项式的一个“机器根”。你的任务是应用向后误差分析，找到一个受扰动多项式 $\\hat{p}(x) = \\hat{a}x^2 + \\hat{b}x + \\hat{c}$ 的系数 $(\\hat{a}, \\hat{b}, \\hat{c})$，使得 $\\hat{x}$ 是该多项式的一个*精确*根。换句话说，方程 $\\hat{a}\\hat{x}^2 + \\hat{b}\\hat{x} + \\hat{c} = 0$ 在精确算术下必须成立。\n\n请用原始系数 $a, b, c$ 和误差项 $\\delta_1, \\delta_2, \\delta_3, \\delta_4$ 来表示系数 $\\hat{a}$、$\\hat{b}$ 和 $\\hat{c}$。", "solution": "我们将每个浮点运算建模为一次精确运算乘以一个乘性扰动。设 $\\hat{x}$ 是返回的“机器根”，霍纳求值过程如下：\n1) $y_{1}=\\mathrm{fl}(a\\hat{x})=a\\hat{x}(1+\\delta_{1})$，由浮点乘法模型得出。\n2) $y_{2}=\\mathrm{fl}(y_{1}+b)=(y_{1}+b)(1+\\delta_{2})=\\big(a\\hat{x}(1+\\delta_{1})+b\\big)(1+\\delta_{2})$，由浮点加法模型得出。\n3) $y_{3}=\\mathrm{fl}(y_{2}\\hat{x})=y_{2}\\hat{x}(1+\\delta_{3})=\\big(a\\hat{x}(1+\\delta_{1})+b\\big)(1+\\delta_{2})\\hat{x}(1+\\delta_{3})$，由浮点乘法模型得出。\n4) $y_{4}=\\mathrm{fl}(y_{3}+c)=(y_{3}+c)(1+\\delta_{4})$，由浮点加法模型得出。\n\n根据假设，计算结果恰好为零，所以 $y_{4}=0$。由于相对误差项很小，$1+\\delta_{4}\\neq 0$，因此\n$$\ny_{3}+c=0.\n$$\n将步骤 3 中的 $y_{3}$ 代入，得到\n$$\n\\big(a\\hat{x}(1+\\delta_{1})+b\\big)(1+\\delta_{2})\\hat{x}(1+\\delta_{3})+c=0.\n$$\n展开并按 $\\hat{x}$ 的幂次合并，得到\n$$\na\\hat{x}^{2}(1+\\delta_{1})(1+\\delta_{2})(1+\\delta_{3})+b\\hat{x}(1+\\delta_{2})(1+\\delta_{3})+c=0.\n$$\n定义受扰动的系数\n$$\n\\hat{a}=a(1+\\delta_{1})(1+\\delta_{2})(1+\\delta_{3}),\\quad\n\\hat{b}=b(1+\\delta_{2})(1+\\delta_{3}),\\quad\n\\hat{c}=c.\n$$\n于是，上述方程变为\n$$\n\\hat{a}\\hat{x}^{2}+\\hat{b}\\hat{x}+\\hat{c}=0,\n$$\n因此 $\\hat{x}$ 是受扰动多项式 $\\hat{p}(x)=\\hat{a}x^{2}+\\hat{b}x+\\hat{c}$ 的一个精确根。注意，$\\delta_{4}$ 没有出现在 $\\hat{a},\\hat{b},\\hat{c}$ 中，因为 $y_{4}=0$ 意味着 $y_{3}+c=0$，此结论与最后的乘性因子 $(1+\\delta_{4})$ 无关。", "answer": "$$\\boxed{\\begin{pmatrix} a(1+\\delta_{1})(1+\\delta_{2})(1+\\delta_{3}) & b(1+\\delta_{2})(1+\\delta_{3}) & c \\end{pmatrix}}$$", "id": "2155426"}, {"introduction": "“灾难性相消”（catastrophic cancellation）是数值计算中一个常见陷阱，当两个相近的数相减时，会导致相对误差急剧放大。本练习分析了一个在这种情况下表现不佳的函数。通过推导其计算过程的向后误差，我们将发现输入值 $x$ 越大，等效的输入扰动 $\\delta x$ 会变得异常巨大，这为我们清晰地揭示了为何该计算公式在数值上是不稳定的 [@problem_id:2155432]。", "problem": "考虑函数 $f(x) = \\sqrt{x+1} - \\sqrt{x}$。当使用浮点运算对一个大的正值 $x$ 计算该函数时，相减抵消可能导致相对精度的显著损失。\n\n后向误差分析旨在将计算结果 $\\hat{f}(x)$ 解释为原函数在扰动输入 $x + \\delta x$ 处的精确求值结果。换句话说，我们寻求找到一个后向误差 $\\delta x$ 使得 $\\hat{f}(x) = f(x+\\delta x)$。\n\n我们将浮点计算模型化如下。假设 $x$ 是一个可以在浮点系统中精确表示的数。计算值 $\\hat{f}(x)$ 是通过以下一系列运算获得的，其中每次运算都会引入一个小的相对误差：\n\n1.  $x+1$ 的值被精确计算。\n2.  第一个平方根计算为 $s_1 = \\mathrm{fl}(\\sqrt{x+1}) = \\sqrt{x+1}(1+\\epsilon_1)$。\n3.  第二个平方根计算为 $s_2 = \\mathrm{fl}(\\sqrt{x}) = \\sqrt{x}(1+\\epsilon_2)$。\n4.  最后的减法计算为 $\\hat{f}(x) = \\mathrm{fl}(s_1 - s_2) = (s_1 - s_2)(1+\\epsilon_3)$。\n\n此处，$\\epsilon_1$、$\\epsilon_2$ 和 $\\epsilon_3$ 是由浮点运算引入的、小的、独立的相对误差。\n\n假设 $x$ 非常大，请找到后向误差 $\\delta x$ 的一个近似表达式。你的推导应只保留所有 $\\epsilon_i$ 的一阶项，并且最终表达式应针对 $x$ 很大的情况进行简化。", "solution": "给定的浮点模型为\n$$\ns_{1}=\\mathrm{fl}(\\sqrt{x+1})=\\sqrt{x+1}\\,(1+\\epsilon_{1}),\\quad\ns_{2}=\\mathrm{fl}(\\sqrt{x})=\\sqrt{x}\\,(1+\\epsilon_{2}),\n$$\n以及\n$$\n\\hat{f}(x)=\\mathrm{fl}(s_{1}-s_{2})=(s_{1}-s_{2})(1+\\epsilon_{3}),\n$$\n其中 $|\\epsilon_{i}|\\ll 1$ 并且忽略了 $\\epsilon_{i}\\epsilon_{j}$ 阶的交叉项。在一阶近似下，\n\\begin{align*}\ns_{1}-s_{2}&=\\big(\\sqrt{x+1}-\\sqrt{x}\\big)+\\epsilon_{1}\\sqrt{x+1}-\\epsilon_{2}\\sqrt{x}\\\\\n&=f(x)+\\epsilon_{1}\\sqrt{x+1}-\\epsilon_{2}\\sqrt{x},\n\\end{align*}\n所以\n$$\n\\hat{f}(x)=(s_{1}-s_{2})(1+\\epsilon_{3})\\approx f(x)+\\epsilon_{1}\\sqrt{x+1}-\\epsilon_{2}\\sqrt{x}+\\epsilon_{3}f(x).\n$$\n\n后向误差分析要求找到 $\\delta x$ 使得 $\\hat{f}(x)=f(x+\\delta x)$。使用一阶泰勒展开，\n$$\nf(x+\\delta x)\\approx f(x)+f'(x)\\,\\delta x,\n$$\n我们比较两式可得\n$$\nf'(x)\\,\\delta x\\approx \\epsilon_{1}\\sqrt{x+1}-\\epsilon_{2}\\sqrt{x}+\\epsilon_{3}f(x),\n$$\n因此\n$$\n\\delta x\\approx \\frac{\\epsilon_{1}\\sqrt{x+1}-\\epsilon_{2}\\sqrt{x}+\\epsilon_{3}f(x)}{f'(x)}.\n$$\n\n计算 $f(x)$ 和 $f'(x)$ 的符号表达式：\n$$\nf(x)=\\sqrt{x+1}-\\sqrt{x}=\\frac{1}{\\sqrt{x+1}+\\sqrt{x}},\n$$\n以及\n$$\nf'(x)=\\frac{1}{2}\\left(\\frac{1}{\\sqrt{x+1}}-\\frac{1}{\\sqrt{x}}\\right)\n=-\\frac{1}{2\\,\\sqrt{x(x+1)}\\big(\\sqrt{x+1}+\\sqrt{x}\\big)}.\n$$\n因此，\n$$\n\\frac{1}{f'(x)}=-2\\,\\sqrt{x(x+1)}\\big(\\sqrt{x+1}+\\sqrt{x}\\big),\n$$\n并代入 $f(x)=\\frac{1}{\\sqrt{x+1}+\\sqrt{x}}$，\n\\begin{align*}\n\\delta x&\\approx -2\\,\\sqrt{x(x+1)}\\big(\\sqrt{x+1}+\\sqrt{x}\\big)\\left(\\epsilon_{1}\\sqrt{x+1}-\\epsilon_{2}\\sqrt{x}+\\frac{\\epsilon_{3}}{\\sqrt{x+1}+\\sqrt{x}}\\right)\\\\\n&= -2\\,\\sqrt{x(x+1)}\\big(\\sqrt{x+1}+\\sqrt{x}\\big)\\big(\\epsilon_{1}\\sqrt{x+1}-\\epsilon_{2}\\sqrt{x}\\big)\\;-\\;2\\,\\epsilon_{3}\\sqrt{x(x+1)}.\n\\end{align*}\n\n对于大的 $x$，使用渐近式 $\\sqrt{x+1}\\sim \\sqrt{x}$、$\\sqrt{x+1}+\\sqrt{x}\\sim 2\\sqrt{x}$ 和 $\\sqrt{x(x+1)}\\sim x$。保留 $x$ 的主导阶，\n\\begin{align*}\n-2\\,\\sqrt{x(x+1)}\\big(\\sqrt{x+1}+\\sqrt{x}\\big)\\big(\\epsilon_{1}\\sqrt{x+1}-\\epsilon_{2}\\sqrt{x}\\big)\n&\\sim -2\\cdot x\\cdot 2\\sqrt{x}\\cdot \\sqrt{x}\\,(\\epsilon_{1}-\\epsilon_{2})\\\\\n&= -4\\,x^{2}(\\epsilon_{1}-\\epsilon_{2}),\n\\end{align*}\n以及\n$$\n-2\\,\\epsilon_{3}\\sqrt{x(x+1)}\\sim -2\\,\\epsilon_{3}\\,x.\n$$\n因此，对 $\\epsilon_{i}$ 保留到一阶并在 $x$ 很大的情况下，\n$$\n\\delta x\\approx -4\\,x^{2}(\\epsilon_{1}-\\epsilon_{2})-2\\,x\\,\\epsilon_{3}.\n$$\n这表明后向误差以 $x^2$ 的量级增长，其主导贡献来自于两个平方根运算的舍入误差之差，而来自最后减法运算的舍入误差贡献了一个次主导的 $O(x)$ 阶项。", "answer": "$$\\boxed{-4 x^{2}\\left(\\epsilon_{1}-\\epsilon_{2}\\right)-2 x \\epsilon_{3}}$$", "id": "2155432"}]}