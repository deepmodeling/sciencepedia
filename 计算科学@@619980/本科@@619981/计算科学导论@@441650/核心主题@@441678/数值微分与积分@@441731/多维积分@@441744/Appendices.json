{"hands_on_practices": [{"introduction": "在深入研究强大的数值方法之前，让我们首先通过一个经典问题来巩固我们的分析基础。计算两个垂直相交圆柱体形成的斯坦梅茨体（Steinmetz solid）的体积，是多变量微积分中的一个标准练习。通过使用切片法将三维体积问题简化为一系列二维面积的积分，这个练习 [@problem_id:2414954] 不仅能锻炼我们建立和求解多重积分的能力，也为我们理解更复杂几何形状的体积计算提供了一个清晰的分析范例。", "problem": "考虑在三维欧几里得空间 $\\mathbb{R}^{3}$ 中，有两个半径为 $r0$ 的无限长圆柱体，它们的轴线相互垂直。设一个圆柱体的轴线为 $x$ 轴，因此其上的点满足 $y^{2}+z^{2}\\le r^{2}$；另一个圆柱体的轴线为 $y$ 轴，因此其上的点满足 $x^{2}+z^{2}\\le r^{2}$。这两个圆柱体的交集（一个斯坦梅茨体）是区域\n$$\nS=\\{(x,y,z)\\in\\mathbb{R}^{3}:\\ y^{2}+z^{2}\\le r^{2}\\ \\text{and}\\ x^{2}+z^{2}\\le r^{2}\\}.\n$$\n使用多维积分的基本原理，确定 $S$ 的精确体积，并以 $r$ 的封闭形式表达式给出。请以单一解析表达式的形式提供最终答案。无需四舍五入，也无需单位。", "solution": "首先对问题陈述进行验证。\n\n第 1 步：提取已知条件。\n- 两个位于 $\\mathbb{R}^{3}$ 中半径为 $r0$ 的无限长圆柱体。\n- 圆柱体的轴线相互垂直。\n- 第一个圆柱体的轴线为 $x$ 轴，由不等式 $y^{2}+z^{2}\\le r^{2}$ 描述。\n- 第二个圆柱体的轴线为 $y$ 轴，由不等式 $x^{2}+z^{2}\\le r^{2}$ 描述。\n- 两个圆柱体的交集是立体区域 $S=\\{(x,y,z)\\in\\mathbb{R}^{3}:\\ y^{2}+z^{2}\\le r^{2}\\ \\text{and}\\ x^{2}+z^{2}\\le r^{2}\\}$。\n- 任务是使用多维积分确定 $S$ 的精确体积，并以 $r$ 的封闭形式表达式表示。\n\n第 2 步：使用提取的已知条件进行验证。\n- **科学依据：** 这是一个多变量微积分中的标准练习题，涉及欧几里得空间中固体的几何学。它基于已建立的数学原理。\n- **适定性：** 实体 $S$ 是 $\\mathbb{R}^{3}$ 中一个定义明确的紧致区域。其体积是一个唯一的、定义明确的量，可以通过三重积分计算。该问题具有唯一、稳定且有意义的解。\n- **客观性：** 问题使用精确的数学语言和符号陈述。没有主观或含糊不清的术语。\n\n第 3 步：结论与行动。\n问题有效。这是一个适定的、标准的数学问题。开始求解。\n\n立体区域 $S$ 的体积 $V$ 由函数 $f(x,y,z)=1$ 在区域 $S$ 上的三重积分给出：\n$$\nV = \\iiint_{S} \\mathrm{d}V\n$$\n区域 $S$ 由两个不等式 $y^{2}+z^{2}\\le r^{2}$ 和 $x^{2}+z^{2}\\le r^{2}$ 定义。\n\n为了计算这个积分，我们将使用切片法。我们将对垂直于某个坐标轴的实体横截面的面积进行积分。我们选择 $z$ 轴。体积可以表示为：\n$$\nV = \\int_{z_{\\min}}^{z_{\\max}} A(z) \\, \\mathrm{d}z\n$$\n其中 $A(z)$ 是实体在平行于 $xy$ 平面、固定高度为 $z$ 的平面上的横截面面积。\n\n首先，我们确定 $z$ 的范围。对于实体 $S$ 中的任意点 $(x,y,z)$，两个不等式都必须成立。由 $x^{2}+z^{2}\\le r^{2}$，我们有 $x^{2} \\le r^{2}-z^{2}$。为了使 $x$ 存在实数解，必须有 $r^{2}-z^{2} \\ge 0$，这意味着 $z^{2} \\le r^{2}$。这给出了 $z$ 的范围为 $-r \\le z \\le r$。\n\n接下来，对于区间 $[-r, r]$ 中固定的 $z$ 值，定义横截面的不等式为：\n$$\ny^{2} \\le r^{2} - z^{2} \\quad \\implies \\quad -\\sqrt{r^{2}-z^{2}} \\le y \\le \\sqrt{r^{2}-z^{2}}\n$$\n$$\nx^{2} \\le r^{2} - z^{2} \\quad \\implies \\quad -\\sqrt{r^{2}-z^{2}} \\le x \\le \\sqrt{r^{2}-z^{2}}\n$$\n这些不等式描述了 $xy$ 平面中一个以原点为中心的正方形。该正方形的边长为 $2\\sqrt{r^{2}-z^{2}}$。\n\n这个正方形横截面的面积 $A(z)$ 是：\n$$\nA(z) = \\left(2\\sqrt{r^{2}-z^{2}}\\right)^{2} = 4(r^{2}-z^{2})\n$$\n现在，我们可以通过将此面积从 $z=-r$ 积分到 $z=r$ 来求得体积 $V$：\n$$\nV = \\int_{-r}^{r} A(z) \\, \\mathrm{d}z = \\int_{-r}^{r} 4(r^{2}-z^{2}) \\, \\mathrm{d}z\n$$\n被积函数 $4(r^{2}-z^{2})$ 是 $z$ 的偶函数，且积分区间 $[-r, r]$ 关于 $z=0$ 对称。因此，我们可以简化积分为：\n$$\nV = 2 \\int_{0}^{r} 4(r^{2}-z^{2}) \\, \\mathrm{d}z = 8 \\int_{0}^{r} (r^{2}-z^{2}) \\, \\mathrm{d}z\n$$\n现在我们对 $z$ 进行积分：\n$$\nV = 8 \\left[ r^{2}z - \\frac{z^{3}}{3} \\right]_{0}^{r}\n$$\n在积分上下限处计算反导数的值：\n$$\nV = 8 \\left( \\left( r^{2}(r) - \\frac{(r)^{3}}{3} \\right) - \\left( r^{2}(0) - \\frac{(0)^{3}}{3} \\right) \\right)\n$$\n$$\nV = 8 \\left( r^{3} - \\frac{r^{3}}{3} - 0 \\right)\n$$\n$$\nV = 8 \\left( \\frac{3r^{3} - r^{3}}{3} \\right)\n$$\n$$\nV = 8 \\left( \\frac{2r^{3}}{3} \\right)\n$$\n$$\nV = \\frac{16r^{3}}{3}\n$$\n这就是由两个半径为 $r$ 的圆柱体以直角相交形成的斯坦梅茨体的精确体积。", "answer": "$$ \\boxed{\\frac{16r^{3}}{3}} $$", "id": "2414954"}, {"introduction": "当解析积分变得异常困难或不可能时，尤其是在处理高维空间问题时，数值方法便显示出其强大的威力。蒙特卡洛方法是一种基于概率和随机抽样的强大技术，能够有效估算复杂区域的体积。在这个练习 [@problem_id:3162123] 中，你将通过编写程序，使用基本的接受-拒绝采样法来计算一个高维超立方体与一个超球体相交部分的体积，从而亲身体验蒙特卡洛方法如何巧妙地绕开“维度灾难”的障碍。", "problem": "您需要实现一个程序，使用蒙特卡洛（MC）接受-拒绝（AR）方法，估计一个单位超立方体与一个以该超立方体中点为中心的欧几里得球体之间交集的$d$维勒贝格体积。形式上，即估计\n$$\n\\text{Vol}\\left([0,1]^d \\cap \\left\\{\\left\\|\\mathbf{x}-\\tfrac{1}{2}\\mathbf{1}\\right\\|_2 \\le r\\right\\}\\right),\n$$\n其中，$d$是一个正整数维度，$r$是一个非负实数半径，$\\mathbf{x} \\in \\mathbb{R}^d$，$\\mathbf{1}$表示$d$维全1向量。\n\n您的任务是从第一性原理推导出估计量，并在程序中实现它。该估计量必须基于以下基本事实：\n- 如果$\\mathbf{X}$在$[0,1]^d$上均匀分布，那么对于任何可测集$A \\subseteq [0,1]^d$，\n$$\n\\mathbb{P}(\\mathbf{X} \\in A) = \\frac{\\text{Vol}(A)}{\\text{Vol}([0,1]^d)}.\n$$\n- 指示函数$I_A(\\mathbf{x})$在$\\mathbf{x} \\in A$时等于$1$，否则等于$0$。\n- 对于独立同分布的样本$\\mathbf{X}_1,\\dots,\\mathbf{X}_N \\sim \\text{Uniform}([0,1]^d)$，\n$$\n\\frac{1}{N}\\sum_{i=1}^N I_A(\\mathbf{X}_i)\n$$\n是$\\mathbb{P}(\\mathbf{X}\\in A)$的无偏估计量，其方差为\n$$\n\\frac{\\mathbb{P}(\\mathbf{X}\\in A)\\left(1-\\mathbb{P}(\\mathbf{X}\\in A)\\right)}{N}.\n$$\n\n基于这些事实，推导出一个算法，该算法从$[0,1]^d$中均匀采样$\\mathbf{X}_i$，如果$\\left\\|\\mathbf{X}_i-\\tfrac{1}{2}\\mathbf{1}\\right\\|_2 \\le r$，则接受该样本。所求体积的 MC AR 估计值是接受样本的比例乘以$\\text{Vol}([0,1]^d)$（即$1$）。\n\n您的程序必须：\n- 通过计算$\\left\\|\\mathbf{X}-\\tfrac{1}{2}\\mathbf{1}\\right\\|_2 \\le r$并使用欧几里得范数来实现接受测试。\n- 使用用户指定的整数伪随机种子以确保可复现性。\n- 正确处理边界情况，包括$r=0$（体积为$0$）和$r \\ge \\sqrt{d}/2$（球体完全覆盖超立方体，因此体积为$1$）。\n\n此问题不涉及物理单位或角度。\n\n测试套件：\n在以下参数集上运行您的实现，每个参数集以元组$(d,r,N,\\text{seed})$的形式给出，其中$N$是样本数量：\n- $(1, 0.3, 200000, 42)$\n- $(2, 0.5, 400000, 314159)$\n- $(3, 0.0, 100000, 7)$\n- $\\left(3, \\tfrac{\\sqrt{3}}{2} + 0.02, 100000, 2024\\right)$\n- $(5, 0.6, 600000, 271828)$\n- $(8, 0.5, 800000, 1001)$\n\n要求输出：\n您的程序应生成单行输出，其中包含按上述测试用例顺序排列的估计体积，形式为方括号内以逗号分隔的浮点数列表。每个浮点数必须四舍五入到六位小数。例如，输出格式必须为\n$$\n[\\text{v}_1,\\text{v}_2,\\text{v}_3,\\text{v}_4,\\text{v}_5,\\text{v}_6],\n$$\n其中每个$\\text{v}_i$是一个四舍五入到六位小数的浮点数。", "solution": "用户提交了一个问题以供验证和解答。\n\n### 步骤 1：提取已知条件\n- **目标**：估计一个单位超立方体与一个以该超立方体中点为中心的欧几里得球体之间交集的$d$维勒贝格体积。\n- **形式化表达式**：$\\text{Vol}\\left([0,1]^d \\cap \\left\\{\\mathbf{x} \\in \\mathbb{R}^d \\,:\\, \\left\\|\\mathbf{x}-\\tfrac{1}{2}\\mathbf{1}\\right\\|_2 \\le r\\right\\}\\right)$。\n- **参数**：$d$是正整数维度；$r$是非负实数半径。\n- **向量**：$\\mathbf{x} \\in \\mathbb{R}^d$；$\\mathbf{1}$是$d$维全1向量。\n- **方法**：蒙特卡洛（MC）接受-拒绝（AR）方法。\n- **理论基础**：\n    - 对于$\\mathbf{X} \\sim \\text{Uniform}([0,1]^d)$和一个可测集$A \\subseteq [0,1]^d$，$\\mathbb{P}(\\mathbf{X} \\in A) = \\frac{\\text{Vol}(A)}{\\text{Vol}([0,1]^d)}$。\n    - 使用独立同分布样本$\\mathbf{X}_1,\\dots,\\mathbf{X}_N$对$\\mathbb{P}(\\mathbf{X}\\in A)$的估计量是$\\frac{1}{N}\\sum_{i=1}^N I_A(\\mathbf{X}_i)$。\n- **实现要求**：\n    - 算法必须从$\\text{Uniform}([0,1]^d)$中采样$\\mathbf{X}_i$，并在$\\left\\|\\mathbf{X}_i-\\tfrac{1}{2}\\mathbf{1}\\right\\|_2 \\le r$时接受。\n    - 估计值是接受样本的比例乘以$\\text{Vol}([0,1]^d) = 1$。\n    - 必须使用用户指定的整数伪随机种子。\n    - 必须处理边界情况$r=0$（体积为$0$）和$r \\ge \\sqrt{d}/2$（体积为$1$）。\n- **测试套件**：\n    - $(1, 0.3, 200000, 42)$\n    - $(2, 0.5, 400000, 314159)$\n    - $(3, 0.0, 100000, 7)$\n    - $\\left(3, \\tfrac{\\sqrt{3}}{2} + 0.02, 100000, 2024\\right)$\n    - $(5, 0.6, 600000, 271828)$\n    - $(8, 0.5, 800000, 1001)$\n- **输出格式**：单行`[v_1,v_2,v_3,v_4,v_5,v_6]`，其中每个$v_i$是四舍五入到六位小数的浮点数。\n\n### 步骤 2：使用提取的已知条件进行验证\n对问题进行验证。\n- **科学上成立**：该问题是蒙特卡洛积分的标准应用，这是计算科学和统计学中的一项基本技术。其底层的数学原理是正确的。\n- **良态的**：该问题是良定义的。它要求使用明确描述的方法对特定体积进行数值估计。计算所需的所有参数都在测试套件中提供。\n- **客观的**：该问题使用精确且无歧义的数学语言陈述。\n- **缺陷分析**：\n    1.  **科学/事實不成立**：无。数学前提是正确的。\n    2.  **不可形式化/不相关**：无。该问题是一个可形式化且相关的多维积分练习。\n    3.  **设置不完整/矛盾**：无。该问题提供了所有必要的数据和定义。\n    4.  **不切实际/不可行**：不适用。该问题是一个数学抽象。\n    5.  **病态/结构不良**：无。可以计算出唯一（使用给定种子可复现）的解。\n    6.  **伪深刻/琐碎/同义反复**：无。虽然概念是基础性的，但其实现需要仔细应用原理，特别是在为了效率而采用向量化方式时。边界情况陈述正确，并作为重要的检查点。\n    7.  **超出科学可验证性**：无。结果由算法确定，并且是可验证的。\n\n### 步骤 3：结论与行动\n问题是**有效的**。将提供一个合理的解答。\n\n该问题要求估计$d$维欧几里得空间$\\mathbb{R}^d$中两个几何对象交集的体积。第一个对象是单位超立方体，定义为$H = [0,1]^d$。第二个对象是一个闭欧几里得球$B$，半径为$r \\ge 0$，中心点为$\\mathbf{c} = \\frac{1}{2}\\mathbf{1}$，其中$\\mathbf{1}$是$d$维全1向量。中心$\\mathbf{c}$是超立方体$H$的几何中点。球体形式上定义为$B = \\{\\mathbf{x} \\in \\mathbb{R}^d \\,:\\, \\|\\mathbf{x}-\\mathbf{c}\\|_2 \\le r\\}$。我们的任务是使用蒙特卡洛方法估计$\\text{Vol}(H \\cap B)$。\n\n此方法的基础在于概率论原理。令$A = H \\cap B$为我们希望估计其体积的区域。蒙特卡洛方法利用一个采样域，在这种情况下，自然选择单位超立方体$H$，因为$A$是$H$的子集。这个超立方体的体积是$\\text{Vol}(H) = 1^d = 1$。\n\n令$\\mathbf{X}$为一个在超立方体$H$上均匀分布的随机向量，记为$\\mathbf{X} \\sim \\text{Uniform}(H)$。对于任何可测子集$A \\subseteq H$，$\\mathbf{X}$落在$A$内的概率由体积之比给出：\n$$\n\\mathbb{P}(\\mathbf{X} \\in A) = \\frac{\\text{Vol}(A)}{\\text{Vol}(H)}\n$$\n由于$\\text{Vol}(H) = 1$，此关系简化为该问题的基本恒等式：\n$$\n\\mathbb{P}(\\mathbf{X} \\in A) = \\text{Vol}(A)\n$$\n这个恒等式意味着估计$A$的体积等价于估计概率$\\mathbb{P}(\\mathbf{X} \\in A)$。\n\n蒙特卡洛方法提供了一种估计这个概率的方法。我们生成大量的，即$N$个，独立同分布（i.i.d.）的随机样本$\\mathbf{X}_1, \\mathbf{X}_2, \\dots, \\mathbf{X}_N$，所有样本都从$H$上的均匀分布中抽取。\n\n对于每个样本$\\mathbf{X}_i$，我们检查它是否落在我们感兴趣的区域$A$内。这通过使用指示函数$I_A(\\mathbf{x})$来完成，其定义为：\n$$\nI_A(\\mathbf{x}) = \\begin{cases} 1  \\text{if } \\mathbf{x} \\in A \\\\ 0  \\text{if } \\mathbf{x} \\notin A \\end{cases}\n$$\n从$H$中抽取的样本$\\mathbf{X}_i$在$A = H \\cap B$内的充要条件是它也在$B$内。一个点$\\mathbf{x}$在$B$内的条件是$\\left\\|\\mathbf{x}-\\tfrac{1}{2}\\mathbf{1}\\right\\|_2 \\le r$。这是我们蒙特卡洛模拟的接受条件。\n\n根据大数定律，概率$\\mathbb{P}(\\mathbf{X} \\in A)$的一个无偏估计量是指示函数值的样本均值：\n$$\n\\widehat{\\mathbb{P}(\\mathbf{X} \\in A)} = \\frac{1}{N} \\sum_{i=1}^N I_A(\\mathbf{X}_i)\n$$\n令$N_{in}$为满足接受条件的样本数量。那么$N_{in} = \\sum_{i=1}^N I_A(\\mathbf{X}_i)$，概率的估计量就成为接受样本的比例：\n$$\n\\widehat{\\mathbb{P}(\\mathbf{X} \\in A)} = \\frac{N_{in}}{N}\n$$\n由于$\\text{Vol}(A) = \\mathbb{P}(\\mathbf{X} \\in A)$，我们对体积的估计$\\widehat{\\text{Vol}}(A)$是：\n$$\n\\widehat{\\text{Vol}}(A) = \\frac{N_{in}}{N}\n$$\n这与问题陈述中给出的定义一致：接受样本的比例乘以$\\text{Vol}([0,1]^d)$（即$1$）。\n\n对于给定的一组参数$(d, r, N, \\text{seed})$，算法流程如下：\n1. 将伪随机数生成器的种子设置为指定值，以确保可复现性。\n\n2. 处理半径$r$的边界情况。\n   - 如果$r \\le 0$，球$B$退化为单点$\\mathbf{c} = \\frac{1}{2}\\mathbf{1}$（或为空集）。对于$d \\ge 1$，$\\mathbb{R}^d$中单点的勒贝格体积为$0$。因此，交集的体积为$0$。\n   - 从中心$\\mathbf{c}$到$H$中任意点$\\mathbf{x}$的最大距离出现在超立方体的顶点处（例如，原点$\\mathbf{0}$或点$\\mathbf{1}$）。从中心到顶点的距离平方为$\\left\\|\\mathbf{0}-\\tfrac{1}{2}\\mathbf{1}\\right\\|_2^2 = \\sum_{j=1}^d (-\\tfrac{1}{2})^2 = d(\\tfrac{1}{4}) = \\tfrac{d}{4}$。因此，最大距离为$\\sqrt{\\tfrac{d}{4}} = \\tfrac{\\sqrt{d}}{2}$。如果半径$r$大于或等于这个最大距离，即$r \\ge \\tfrac{\\sqrt{d}}{2}$，则球$B$完全包含超立方体$H$。在这种情况下，交集$H \\cap B$就是$H$，其体积为$\\text{Vol}(H) = 1$。\n\n3. 如果两种边界情况都不适用（即$0  r  \\tfrac{\\sqrt{d}}{2}$），则进行蒙特卡洛模拟：\n   a. 初始化一个接受样本的计数器$N_{in}$为$0$。\n   b. 生成$N$个随机向量$\\mathbf{X}_1, \\dots, \\mathbf{X}_N$。每个向量$\\mathbf{X}_i \\in \\mathbb{R}^d$通过将其$d$个分量独立地从均匀分布$\\text{Uniform}([0,1])$中抽取而生成。\n   c. 对于每个样本$\\mathbf{X}_i$：\n      i. 计算其与超立方体中心的欧几里得距离的平方：$D^2 = \\left\\|\\mathbf{X}_i - \\tfrac{1}{2}\\mathbf{1}\\right\\|_2^2$。这可计算为$\\sum_{j=1}^d (X_{ij} - \\tfrac{1}{2})^2$，其中$X_{ij}$是向量$\\mathbf{X}_i$的第$j$个分量。\n      ii. 将距离的平方与半径的平方$r^2$进行比较。使用平方值可以避免在主循环内部进行计算成本高的平方根运算。如果$D^2 \\le r^2$，则接受该样本，并将计数器$N_{in}$加一。\n   d. 检查完所有$N$个样本后，估计体积计算为比率$\\frac{N_{in}}{N}$。\n\n对于实现，使用 NumPy 的向量化方法非常高效。所有$N$个样本的生成可以在单个操作中完成，创建一个$N \\times d$的矩阵。后续的距离计算和接受样本的最终计数也可以使用向量化数组操作来完成，相比显式循环，这能显著提高性能。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef estimate_volume(d: int, r: float, N: int, seed: int) - float:\n    \"\"\"\n    Estimates the volume of the intersection of a unit hypercube and a ball.\n\n    Args:\n        d: The dimension of the space.\n        r: The radius of the ball.\n        N: The number of Monte Carlo samples.\n        seed: The pseudorandom seed for reproducibility.\n\n    Returns:\n        The estimated volume.\n    \"\"\"\n    # Handle the boundary case where the radius is zero or negative.\n    # The intersection is a single point (or empty), which has zero volume.\n    if r = 0:\n        return 0.0\n\n    # Calculate the maximum distance from the center of the hypercube to any corner.\n    # This distance is sqrt(d * (1/2)^2) = sqrt(d)/2.\n    max_dist_from_center = np.sqrt(d) / 2.0\n    \n    # Handle the boundary case where the ball completely encloses the hypercube.\n    # The volume of the intersection is the volume of the hypercube, which is 1.\n    if r = max_dist_from_center:\n        return 1.0\n\n    # Set up the random number generator with the specified seed for reproducibility.\n    rng = np.random.default_rng(seed)\n\n    # Generate N random samples, each a d-dimensional vector. The components\n    # are uniformly distributed in [0, 1), which makes the vectors\n    # uniformly distributed in the hypercube [0, 1]^d.\n    # This creates a matrix of size N x d.\n    samples = rng.random((N, d))\n\n    # Center the samples around the origin by subtracting 0.5.\n    # This corresponds to computing the vector difference X - (1/2)*1.\n    # The hypercube is now effectively [-0.5, 0.5]^d.\n    centered_samples = samples - 0.5\n\n    # Calculate the squared Euclidean distance of each sample from the center (origin).\n    # This is done by squaring each component and summing along the rows (axis=1).\n    # Using squared distances avoids a costly square root operation for each sample.\n    sq_distances = np.sum(centered_samples**2, axis=1)\n\n    # The acceptance condition is that the distance is less than or equal to the radius r,\n    # which is equivalent to the squared distance being less than or equal to r^2.\n    r_squared = r**2\n    \n    # Count the number of samples that fall inside the ball.\n    # In NumPy, summing a boolean array treats True as 1 and False as 0.\n    accepted_count = np.sum(sq_distances = r_squared)\n\n    # The estimated volume is the fraction of accepted samples, since the volume\n    # of the sampling domain ([0,1]^d) is 1.\n    volume_estimate = accepted_count / N\n\n    return volume_estimate\n\ndef solve():\n    \"\"\"\n    Runs the volume estimation for the test suite specified in the problem.\n    \"\"\"\n    # Test Suite: (d, r, N, seed)\n    test_cases = [\n        (1, 0.3, 200000, 42),\n        (2, 0.5, 400000, 314159),\n        (3, 0.0, 100000, 7),\n        (3, np.sqrt(3)/2 + 0.02, 100000, 2024),\n        (5, 0.6, 600000, 271828),\n        (8, 0.5, 800000, 1001),\n    ]\n\n    results = []\n    for d, r, N, seed in test_cases:\n        volume = estimate_volume(d, r, N, seed)\n        # Format the result as a string rounded to six decimal places.\n        results.append(f\"{volume:.6f}\")\n\n    # Print the final list of results in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3162123"}, {"introduction": "虽然基本的蒙特卡洛方法功能强大，但其收敛速度可能很慢，尤其是在被积函数在定义域内变化剧烈时。重要性采样是一种高级技巧，通过智能地选择采样分布来显著提高计算效率和精度。在这个源于量子力学的练习 [@problem_id:2414989] 中，你的任务是为氢原子基态电子的某个期望值计算设计一个理想的重要性采样函数，以实现零方差估计。这不仅是一个计算挑战，更是一次关于如何优化数值实验设计的深刻实践。", "problem": "您想要使用三维蒙特卡罗（MC）积分中的重要性采样方法，来估计氢原子基态下电子的期望值 $\\langle 1/r \\rangle$。基态空间波函数是一个经过充分检验的结果，$\\psi_{100}(\\mathbf{r}) = \\dfrac{1}{\\sqrt{\\pi a_0^3}} e^{-r/a_0}$，其中 $a_0$ 是玻尔半径，$r = \\|\\mathbf{r}\\|$。该期望值可以写成在三维空间上的勒贝格积分，\n$$\n\\langle 1/r \\rangle \\;=\\; \\int_{\\mathbb{R}^3} \\frac{1}{r}\\,|\\psi_{100}(\\mathbf{r})|^2 \\, \\mathrm{d}^3 \\mathbf{r},\n$$\n您将通过从一个概率密度函数（PDF）$p(\\mathbf{r})$ 中进行随机采样，并使用重要性采样估计量来评估该积分。根据重要性采样的基本原理，一个理想的 $p(\\mathbf{r})$ 选择应在最小化估计量方差的同时，保持可归一化且在球坐标中易于采样。\n\n下列哪个在 $\\mathbb{R}^3$ 上的各向同性 PDF 能够为 $\\langle 1/r \\rangle$ 提供一个零方差、无偏的蒙特卡罗估计量，并且允许一个基于一维分布的简单径向采样规则？请选择一个选项。\n\nA. $p_A(\\mathbf{r}) \\;=\\; \\dfrac{1}{\\pi a_0^3}\\, e^{-2 r/a_0}$\n\nB. $p_B(\\mathbf{r}) \\;=\\; \\dfrac{1}{\\pi a_0^2}\\, \\dfrac{e^{-2 r/a_0}}{r}$\n\nC. $p_C(\\mathbf{r}) \\;=\\; \\dfrac{1}{Z}\\, \\dfrac{e^{-2 r/a_0}}{r^2}$，其中 $Z$ 是一个有限的归一化常数，其选择满足 $\\int_{\\mathbb{R}^3} p_C(\\mathbf{r})\\, \\mathrm{d}^3\\mathbf{r} = 1$\n\nD. $p_D(\\mathbf{r}) \\;=\\; \\dfrac{3}{4 \\pi R^3}$ 当 $r \\le R$ 时，且当 $rR$ 时 $p_D(\\mathbf{r})=0$，其中 $R0$ 是一个固定的截断半径", "solution": "我们从已知密度下的期望值定义以及重要性采样估计量的构建开始。期望值为\n$$\nI \\;\\equiv\\; \\langle 1/r \\rangle \\;=\\; \\int_{\\mathbb{R}^3} f(\\mathbf{r}) \\, \\mathrm{d}^3 \\mathbf{r}, \\quad \\text{其中} \\quad f(\\mathbf{r}) \\;=\\; \\frac{1}{r} |\\psi_{100}(\\mathbf{r})|^2.\n$$\n带有重要性采样的蒙特卡罗（MC）方法从一个概率密度函数（PDF）$p(\\mathbf{r})$ 中抽取 $\\mathbf{r}$，并估计\n$$\n\\widehat{I}_N \\;=\\; \\frac{1}{N} \\sum_{i=1}^N \\frac{f(\\mathbf{r}_i)}{p(\\mathbf{r}_i)}, \\quad \\mathbf{r}_i \\sim p(\\mathbf{r}).\n$$\n只要在 $f(\\mathbf{r})\\neq 0$ 的地方有 $p(\\mathbf{r})0$ 且 $\\int p(\\mathbf{r})\\,\\mathrm{d}^3\\mathbf{r}=1$，该估计量就是无偏的。其方差为\n$$\n\\mathrm{Var}_p\\!\\left[\\frac{f(\\mathbf{r})}{p(\\mathbf{r})}\\right] \\;=\\; \\int_{\\mathbb{R}^3} \\frac{f(\\mathbf{r})^2}{p(\\mathbf{r})} \\, \\mathrm{d}^3\\mathbf{r} \\;-\\; I^2,\n$$\n在归一化约束 $\\int p = 1$ 下，通过变分法可知，当选择如下形式时，该方差达到最小值：\n$$\np_{\\star}(\\mathbf{r}) \\;\\propto\\; |f(\\mathbf{r})| .\n$$\n当 $f(\\mathbf{r}) \\ge 0$ 时，这个最优 PDF 会产生一个零方差估计量，因为 $f(\\mathbf{r})/p_{\\star}(\\mathbf{r})$ 几乎处处为常数。\n\n对于氢原子基态，\n$$\n|\\psi_{100}(\\mathbf{r})|^2 \\;=\\; \\frac{1}{\\pi a_0^3} e^{-2r/a_0},\n$$\n所以\n$$\nf(\\mathbf{r}) \\;=\\; \\frac{1}{r}\\, |\\psi_{100}(\\mathbf{r})|^2 \\;=\\; \\frac{1}{\\pi a_0^3}\\, \\frac{e^{-2r/a_0}}{r}.\n$$\n因此，最优的重要性密度为\n$$\np_{\\star}(\\mathbf{r}) \\;=\\; C\\, \\frac{e^{-2r/a_0}}{r},\n$$\n其中归一化常数 $C$ 的选择需满足 $\\int_{\\mathbb{R}^3} p_{\\star}(\\mathbf{r})\\, \\mathrm{d}^3\\mathbf{r} = 1$。切换到球坐标并使用 $\\mathrm{d}^3\\mathbf{r} = 4\\pi r^2 \\mathrm{d}r$，我们发现\n$$\n1 \\;=\\; \\int_{\\mathbb{R}^3} p_{\\star}(\\mathbf{r})\\, \\mathrm{d}^3\\mathbf{r} \\;=\\; 4\\pi C \\int_{0}^{\\infty} r \\, e^{-2r/a_0}\\, \\mathrm{d}r \\;=\\; 4\\pi C \\left(\\frac{a_0^2}{4}\\right),\n$$\n所以\n$$\nC \\;=\\; \\frac{1}{\\pi a_0^2},\n$$\n因此\n$$\np_{\\star}(\\mathbf{r}) \\;=\\; \\frac{1}{\\pi a_0^2}\\, \\frac{e^{-2r/a_0}}{r}.\n$$\n采用这种选择，重要性权重为\n$$\n\\frac{f(\\mathbf{r})}{p_{\\star}(\\mathbf{r})} \\;=\\; \\frac{\\dfrac{1}{\\pi a_0^3}\\, \\dfrac{e^{-2r/a_0}}{r}}{\\dfrac{1}{\\pi a_0^2}\\, \\dfrac{e^{-2r/a_0}}{r}} \\;=\\; \\frac{1}{a_0},\n$$\n这是一个常数。因此，该估计量具有零方差且无偏，我们可以立即获得精确结果 $I=\\langle 1/r \\rangle = 1/a_0$。\n\n一个实用的采样规则源于由 $p_{\\star}(\\mathbf{r})$ 导出的径向 PDF：\n$$\np_{\\star,r}(r) \\;=\\; \\int p_{\\star}(\\mathbf{r})\\, \\mathrm{d}\\Omega \\;=\\; 4\\pi r^2\\, p_{\\star}(\\mathbf{r}) \\;=\\; \\frac{4}{a_0^2}\\, r\\, e^{-2r/a_0}, \\quad r \\ge 0,\n$$\n这是一个形状参数为 $k=2$、尺度参数为 $\\theta = a_0/2$ 的伽马分布。通过从 $\\mathrm{Gamma}(k=2,\\theta=a_0/2)$ 中采样 $r$ 并在单位球面上均匀采样一个方向，即可得到 $\\mathbf{r}$。\n\n我们现在分析每个选项：\n\n选项 A. $p_A(\\mathbf{r}) = \\dfrac{1}{\\pi a_0^3} e^{-2 r / a_0}$。这是物理上的组态空间概率密度 $|\\psi_{100}|^2$。从 $p_A$ 采样得到的估计量为 $\\dfrac{f(\\mathbf{r})}{p_A(\\mathbf{r})} = \\dfrac{1}{r}$，它是无偏的。然而，它不是零方差的。实际上，在 $p_A$ 下，径向 PDF 为 $p_{A,r}(r) = \\dfrac{4}{a_0^3} r^2 e^{-2r/a_0}$，对于该分布\n$$\n\\mathbb{E}_{p_A}\\!\\left[\\frac{1}{r}\\right] \\;=\\; \\frac{1}{a_0}, \\quad \\mathbb{E}_{p_A}\\!\\left[\\frac{1}{r^2}\\right] \\;=\\; \\frac{2}{a_0^2},\n$$\n所以\n$$\n\\mathrm{Var}_{p_A}\\!\\left[\\frac{1}{r}\\right] \\;=\\; \\frac{2}{a_0^2} - \\frac{1}{a_0^2} \\;=\\; \\frac{1}{a_0^2} \\;\\; 0.\n$$\n结论：不符合所述标准，因为它不产生零方差。\n\n选项 B. $p_B(\\mathbf{r}) = \\dfrac{1}{\\pi a_0^2} \\dfrac{e^{-2 r / a_0}}{r}$。这与上面推导出的 $p_{\\star}(\\mathbf{r})$ 相符。它被正确归一化，并产生常数权重 $\\dfrac{1}{a_0}$，因此是一个零方差、无偏的估计量。其径向 PDF 为 $p_{B,r}(r) = \\dfrac{4}{a_0^2} r e^{-2r/a_0}$，这是一个形状参数为 $k=2$、尺度参数为 $\\theta = a_0/2$ 的简单伽马分布，能够进行直接采样。结论：正确。\n\n选项 C. $p_C(\\mathbf{r}) = \\dfrac{1}{Z}\\, \\dfrac{e^{-2 r/a_0}}{r^2}$，其中 $Z$ 为有限值。由于 $\\int_{0}^{\\infty} e^{-2r/a_0}\\, \\mathrm{d}r$ 收敛，因此该分布是可归一化的；如果在重要性权重中使用，它也是无偏的。然而，其权重为\n$$\n\\frac{f(\\mathbf{r})}{p_C(\\mathbf{r})} \\;=\\; \\frac{\\dfrac{1}{\\pi a_0^3}\\, \\dfrac{e^{-2r/a_0}}{r}}{\\dfrac{1}{Z}\\, \\dfrac{e^{-2r/a_0}}{r^2}} \\;=\\; \\frac{Z}{\\pi a_0^3}\\, r,\n$$\n它不是一个常数，因此不会产生零方差。此外，相对于最优选择，其随 $r$ 的线性增长倾向于增加方差。结论：不符合所述标准。\n\n选项 D. $p_D(\\mathbf{r}) = \\dfrac{3}{4 \\pi R^3}$ 当 $r \\le R$ 时，否则为零，其中 $R0$ 是一个固定的截断半径。这个分布是可归一化的且易于采样，但对于任何有限的 $R$ 都会产生一个有偏估计量，因为对于所有 $r0$ 都有 $f(\\mathbf{r})0$，而当 $rR$ 时 $p_D(\\mathbf{r})=0$，因此积分中来自 $rR$ 的贡献被忽略了。如果尝试令 $R \\to \\infty$，则均匀密度在 $\\mathbb{R}^3$ 中将不可归一化。结论：不正确。\n\n因此，唯一能够提供零方差、无偏蒙特卡罗估计量且具有简单径向采样规则的选项是选项 B。", "answer": "$$\\boxed{B}$$", "id": "2414989"}]}