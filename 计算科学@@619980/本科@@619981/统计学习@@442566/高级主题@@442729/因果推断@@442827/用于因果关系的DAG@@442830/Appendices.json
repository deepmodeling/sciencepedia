{"hands_on_practices": [{"introduction": "辛普森悖论是统计学中一个著名的例子，揭示了边际关联和条件关联可能完全相反。通过亲手构建一个表现出此悖论的数据集，我们可以直观地理解混杂偏倚是如何产生的。这个练习将指导您使用有向无环图（DAG）的结构来生成数据，从而将混杂这一抽象概念转化为具体的、可计算的数值结果[@problem_id:3115837]。", "problem": "给定一个编码了辛普森悖论因果结构的有向无环图 (DAG)。该图包含顶点 $X$、$Y$、$Z$ 以及有向边 $Z \\to X$、$Z \\to Y$ 和 $X \\to Y$。此因果结构意味着联合分布 $p(Z,X,Y)$ 的马尔可夫分解为 $p(Z) \\, p(X \\mid Z) \\, p(Y \\mid X,Z)$。需要论证的悖论是，$X$ 和 $Y$ 在边际上可能呈负相关，但在以 $Z$ 为条件时则呈正相关。\n\n您的任务是编写一个程序，针对几个符合该 DAG 分解的参数化案例，通过将总样本量乘以精确的有理数概率，构建一个显式的 $2 \\times 2 \\times 2$ 计数表，用于 $(X,Y,Z)$，其中 $X \\in \\{0,1\\}$、$Y \\in \\{0,1\\}$、$Z \\in \\{0,1\\}$。对于每个案例，程序必须确定所构建的数据集是否展现了辛普森悖论，其精确定义如下：\n\n- 定义边际关联差异 $\\Delta = \\hat{p}(Y=1 \\mid X=1) - \\hat{p}(Y=1 \\mid X=0)$，根据所构建的计数计算。如果 $\\Delta < 0$，则边际关联为负。\n- 对于每个分层 $z \\in \\{0,1\\}$，定义条件关联差异 $\\Delta_z = \\hat{p}(Y=1 \\mid X=1, Z=z) - \\hat{p}(Y=1 \\mid X=0, Z=z)$。如果在分层 $z$ 中 $\\Delta_z > 0$，则条件关联为正。\n\n当且仅当 $\\Delta < 0$ 且 $\\Delta_0 > 0$ 和 $\\Delta_1 > 0$ 同时成立时，该数据集展现了辛普森悖论。\n\n您的推导和计算应基于以下核心定义和经过充分检验的事实：\n- 由有向无环图 (DAG) $Z \\to X$、$Z \\to Y$、$X \\to Y$ 导出的马尔可夫分解是 $p(Z,X,Y) = p(Z) p(X \\mid Z) p(Y \\mid X,Z)$。\n- 条件概率通过全概率定律结合：对于任何事件 $A$，$p(A) = \\sum_z p(A \\mid Z=z) p(Z=z)$。\n- 从精确整数计数计算出的样本比例，等于所构建的有限总体中相应的条件概率。\n\n您的程序不得使用随机性。对于每个测试用例，所有概率都以精确有理数形式提供，在给定总样本量的情况下，这些有理数能使相关计数成为整数。您必须使用这些有理数所隐含的整数算术来精确计算计数，并使用精确的整数比较（例如，通过交叉相乘而不是浮点数近似）来评估定义辛普森悖论的不等式。\n\n测试套件：\n- 案例 1（理想情况，强悖论）：\n  - 总样本量 $N = 1000$。\n  - $p(Z=1) = \\frac{1}{2}$。\n  - $p(X=1 \\mid Z=0) = \\frac{1}{10}$，$p(X=1 \\mid Z=1) = \\frac{9}{10}$。\n  - $p(Y=1 \\mid X=1,Z=0) = \\frac{4}{5}$，$p(Y=1 \\mid X=0,Z=0) = \\frac{7}{10}$。\n  - $p(Y=1 \\mid X=1,Z=1) = \\frac{3}{10}$，$p(Y=1 \\mid X=0,Z=1) = \\frac{1}{5}$。\n- 案例 2（边界情况，层内效应较弱的轻微悖论）：\n  - 总样本量 $N = 200$。\n  - $p(Z=1) = \\frac{1}{2}$。\n  - $p(X=1 \\mid Z=0) = \\frac{1}{5}$，$p(X=1 \\mid Z=1) = \\frac{4}{5}$。\n  - $p(Y=1 \\mid X=1,Z=0) = \\frac{11}{20}$，$p(Y=1 \\mid X=0,Z=0) = \\frac{21}{40}$。\n  - $p(Y=1 \\mid X=1,Z=1) = \\frac{21}{80}$，$p(Y=1 \\mid X=0,Z=1) = \\frac{1}{4}$。\n- 案例 3（对照情况，无悖论，因为不存在从 $Z$ 到 $X$ 的混淆）：\n  - 总样本量 $N = 1000$。\n  - $p(Z=1) = \\frac{1}{2}$。\n  - $p(X=1 \\mid Z=0) = \\frac{1}{2}$，$p(X=1 \\mid Z=1) = \\frac{1}{2}$。\n  - $p(Y=1 \\mid X=1,Z=0) = \\frac{3}{5}$，$p(Y=1 \\mid X=0,Z=0) = \\frac{2}{5}$。\n  - $p(Y=1 \\mid X=1,Z=1) = \\frac{3}{5}$，$p(Y=1 \\mid X=0,Z=1) = \\frac{2}{5}$。\n\n算法要求：\n- 对于每个案例，按照 DAG 分解顺序 $p(Z)$、$p(X \\mid Z)$、$p(Y \\mid X,Z)$，通过将 $N$ 乘以有理数概率来计算整数计数；例如，$n_{Z=1} = N \\cdot \\frac{a}{b}$，$n_{X=1,Z=z} = n_{Z=z} \\cdot \\frac{c_z}{d_z}$，$n_{Y=1,X=x,Z=z} = n_{X=x,Z=z} \\cdot \\frac{e_{x,z}}{f_{x,z}}$。所有中间结果必须是整数。\n- 使用得出的计数，计算 $\\Delta$ 和每个 $\\Delta_z$ 作为样本比例的差异，并使用精确的整数比较（无浮点数舍入）来判断辛普森悖论是否成立。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含三个案例的结果，格式为一个用方括号括起来的逗号分隔列表，顺序与案例顺序相同，其中每个结果是一个布尔值，当且仅当该案例的数据集展现了辛普森悖论时为 $True$，否则为 $False$。例如，形如 $[True,True,False]$ 的输出是可接受的。", "solution": "该问题陈述业经检验，内容有效。它在科学上基于因果推断和概率论的原理，内容自洽、提法明确且客观。所有提供的数值和约束都是一致的，可以得出一个唯一且有意义的解。\n\n该问题要求我们判断在三种不同情景下是否展现了辛普森悖论，每种情景都由一个因果模型的一组特定参数定义。其因果结构由有向无环图 (DAG) $Z \\to X$、$Z \\to Y$ 和 $X \\to Y$ 给出。变量 $X、Y、Z$ 均为二元变量，取值于 $\\{0, 1\\}$。该 DAG 意味着联合概率分布 $p(X, Y, Z)$ 的马尔可夫分解为：\n$$p(X, Y, Z) = p(Z) \\, p(X \\mid Z) \\, p(Y \\mid X, Z)$$\n在此背景下，辛普森悖论由一组特定条件定义：\n1.  $X$ 和 $Y$ 之间的边际关联为负。这由差异 $\\Delta = \\hat{p}(Y=1 \\mid X=1) - \\hat{p}(Y=1 \\mid X=0)$ 来量化，其中 $\\Delta < 0$。符号 $\\hat{p}$ 指的是从有限样本（计数数据）计算出的比例。\n2.  在给定 $Z$ 的条件下，$X$ 和 $Y$ 之间的条件关联在 $Z$ 的两个分层中均为正。这由差异 $\\Delta_z = \\hat{p}(Y=1 \\mid X=1, Z=z) - \\hat{p}(Y=1 \\mid X=0, Z=z)$ 对 $z \\in \\{0, 1\\}$ 进行量化。条件是 $\\Delta_0 > 0$ 和 $\\Delta_1 > 0$。\n\n我们的任务是为每个案例构建一个关于 $(X, Y, Z)$ 的列联表，然后验证这三个不等式。问题要求使用精确的整数算术以避免浮点精度误差。\n\n总体的算法流程如下：\n\n首先，我们计算 $2 \\times 2 \\times 2 = 8$ 种可能的 $(X=x, Y=y, Z=z)$ 组合中每一种的计数。问题指出，计数应从总样本量 $N$ 和所提供的精确有理数概率中得出。设 $n(A)$ 表示事件 $A$ 的计数。我们可以按照 DAG 分解所指示的因果顺序计算联合计数 $n(X=x, Y=y, Z=z)$。\n\n让所提供的概率表示为有理数。例如，$p(Z=1) = n_{Z=1}/d_{Z=1}$。\n\n1.  **计算 $Z$ 分层的计数**：\n    $Z$ 的每个分层中的个体数量为：\n    $$n(Z=1) = N \\cdot p(Z=1)$$\n    $$n(Z=0) = N \\cdot p(Z=0) = N \\cdot (1 - p(Z=1))$$\n\n2.  **计算 $(X, Z)$ 分层的联合计数**：\n    在 $Z$ 的每个分层内，我们计算 $X$ 的子分层的计数：\n    $$n(X=1, Z=0) = n(Z=0) \\cdot p(X=1 \\mid Z=0)$$\n    $$n(X=0, Z=0) = n(Z=0) - n(X=1, Z=0)$$\n    $$n(X=1, Z=1) = n(Z=1) \\cdot p(X=1 \\mid Z=1)$$\n    $$n(X=0, Z=1) = n(Z=1) - n(X=1, Z=1)$$\n    问题保证这些中间计数将是整数。\n\n3.  **计算完整的联合计数 $n(X, Y, Z)$**：\n    最后，我们计算每个 $(X, Z)$ 分层中 $Y=1$ 的个体数量。\n    $$n(Y=1, X=1, Z=0) = n(X=1, Z=0) \\cdot p(Y=1 \\mid X=1, Z=0)$$\n    $$n(Y=1, X=0, Z=0) = n(X=0, Z=0) \\cdot p(Y=1 \\mid X=0, Z=0)$$\n    $$n(Y=1, X=1, Z=1) = n(X=1, Z=1) \\cdot p(Y=1 \\mid X=1, Z=1)$$\n    $$n(Y=1, X=0, Z=1) = n(X=0, Z=1) \\cdot p(Y=1 \\mid X=0, Z=1)$$\n    $Y=0$ 的计数可以通过减法得到，例如，$n(Y=0, X=x, Z=z) = n(X=x, Z=z) - n(Y=1, X=x, Z=z)$。\n\n其次，利用完整的 $2 \\times 2 \\times 2$ 计数表，我们评估辛普森悖论的条件。\n\n1.  **验证条件关联 ($\\Delta_0 > 0, \\Delta_1 > 0$)**：\n    问题指出，从所构建计数得出的样本比例将等于其基础概率。因此，$\\hat{p}(Y=1 \\mid X=x, Z=z) = p(Y=1 \\mid X=x, Z=z)$。条件 $\\Delta_z > 0$ 简化为：\n    $$p(Y=1 \\mid X=1, Z=0) > p(Y=1 \\mid X=0, Z=0)$$\n    $$p(Y=1 \\mid X=1, Z=1) > p(Y=1 \\mid X=0, Z=1)$$\n    给定概率为分数，例如 $p_1 = a/b$ 和 $p_2 = c/d$，不等式 $p_1 > p_2$ 等价于 $a/b > c/d$。为保持精度，我们使用整数交叉相乘来检查：$a \\cdot d > c \\cdot b$，假设分母 $b, d$ 为正。两个条件都必须满足。\n\n2.  **验证边际关联 ($\\Delta < 0$)**：\n    边际关联需要对变量 $Z$ 的计数进行求和。\n    $X=1$ 的个体总数为 $n(X=1) = n(X=1, Z=0) + n(X=1, Z=1)$。\n    $Y=1$ 且 $X=1$ 的个体总数为 $n(Y=1, X=1) = n(Y=1, X=1, Z=0) + n(Y=1, X=1, Z=1)$。\n    边际概率估计为 $\\hat{p}(Y=1 \\mid X=1) = \\frac{n(Y=1, X=1)}{n(X=1)}$。\n    类似地，对于 $X=0$：\n    $n(X=0) = n(X=0, Z=0) + n(X=0, Z=1)$。\n    $n(Y=1, X=0) = n(Y=1, X=0, Z=0) + n(Y=1, X=0, Z=1)$。\n    $\\hat{p}(Y=1 \\mid X=0) = \\frac{n(Y=1, X=0)}{n(X=0)}$。\n\n    条件 $\\Delta < 0$ 变为 $\\hat{p}(Y=1 \\mid X=1) < \\hat{p}(Y=1 \\mid X=0)$，即：\n    $$\\frac{n(Y=1, X=1)}{n(X=1)} < \\frac{n(Y=1, X=0)}{n(X=0)}$$\n    为避免浮点误差，这个不等式通过整数交叉相乘进行验证：\n    $$n(Y=1, X=1) \\cdot n(X=0) < n(Y=1, X=0) \\cdot n(X=1)$$\n\n当且仅当两个条件关联均为正且边际关联为负时，辛普森悖论存在。此过程将应用于每个测试用例，以生成最终的布尔结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Simpson's paradox problem for a set of predefined test cases.\n    \"\"\"\n    \n    # Probabilities are represented as (numerator, denominator) tuples for exact rational arithmetic.\n    test_cases = [\n        # Case 1 (happy path, strong paradox)\n        {\n            \"N\": 1000,\n            \"p_z1\": (1, 2),\n            \"p_x1_z0\": (1, 10), \"p_x1_z1\": (9, 10),\n            \"p_y1_x1_z0\": (4, 5), \"p_y1_x0_z0\": (7, 10),\n            \"p_y1_x1_z1\": (3, 10), \"p_y1_x0_z1\": (1, 5)\n        },\n        # Case 2 (edge case, mild paradox with small within-stratum effects)\n        {\n            \"N\": 200,\n            \"p_z1\": (1, 2),\n            \"p_x1_z0\": (1, 5), \"p_x1_z1\": (4, 5),\n            \"p_y1_x1_z0\": (11, 20), \"p_y1_x0_z0\": (21, 40),\n            \"p_y1_x1_z1\": (21, 80), \"p_y1_x0_z1\": (1, 4)\n        },\n        # Case 3 (control case, no paradox because no confounding)\n        {\n            \"N\": 1000,\n            \"p_z1\": (1, 2),\n            \"p_x1_z0\": (1, 2), \"p_x1_z1\": (1, 2),\n            \"p_y1_x1_z0\": (3, 5), \"p_y1_x0_z0\": (2, 5),\n            \"p_y1_x1_z1\": (3, 5), \"p_y1_x0_z1\": (2, 5)\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N = case[\"N\"]\n        \n        # Unpack probabilities for convenience\n        p_z1 = case[\"p_z1\"]\n        p_x1_z0, p_x1_z1 = case[\"p_x1_z0\"], case[\"p_x1_z1\"]\n        p_y1_x1_z0, p_y1_x0_z0 = case[\"p_y1_x1_z0\"], case[\"p_y1_x0_z0\"]\n        p_y1_x1_z1, p_y1_x0_z1 = case[\"p_y1_x1_z1\"], case[\"p_y1_x0_z1\"]\n\n        # 1. Calculate counts of Z strata using exact integer division\n        n_z1 = N * p_z1[0] // p_z1[1]\n        n_z0 = N - n_z1\n\n        # 2. Calculate joint counts of (X, Z) strata\n        n_x1_z0 = n_z0 * p_x1_z0[0] // p_x1_z0[1]\n        n_x0_z0 = n_z0 - n_x1_z0\n        \n        n_x1_z1 = n_z1 * p_x1_z1[0] // p_x1_z1[1]\n        n_x0_z1 = n_z1 - n_x1_z1\n\n        # 3. Calculate full joint counts n(Y=1, X, Z)\n        n_y1_x1_z0 = n_x1_z0 * p_y1_x1_z0[0] // p_y1_x1_z0[1]\n        n_y1_x0_z0 = n_x0_z0 * p_y1_x0_z0[0] // p_y1_x0_z0[1]\n        \n        n_y1_x1_z1 = n_x1_z1 * p_y1_x1_z1[0] // p_y1_x1_z1[1]\n        n_y1_x0_z1 = n_x0_z1 * p_y1_x0_z1[0] // p_y1_x0_z1[1]\n\n        # 4. Check for positive conditional associations (Delta_z > 0)\n        # Using cross-multiplication for exact comparison of fractions a/b > c/d as a*d > c*b\n        cond_assoc_z0_pos = (p_y1_x1_z0[0] * p_y1_x0_z0[1]) > (p_y1_x0_z0[0] * p_y1_x1_z0[1])\n        cond_assoc_z1_pos = (p_y1_x1_z1[0] * p_y1_x0_z1[1]) > (p_y1_x0_z1[0] * p_y1_x1_z1[1])\n\n        all_cond_assoc_pos = cond_assoc_z0_pos and cond_assoc_z1_pos\n        \n        # 5. Check for negative marginal association (Delta  0)\n        # Aggregate counts to get marginals\n        n_y1_x1 = n_y1_x1_z0 + n_y1_x1_z1\n        n_x1 = n_x1_z0 + n_x1_z1\n        \n        n_y1_x0 = n_y1_x0_z0 + n_y1_x0_z1\n        n_x0 = n_x0_z0 + n_x0_z1\n\n        # Check for marginal_association  0 if denominators are non-zero\n        marg_assoc_neg = False\n        if n_x1 > 0 and n_x0 > 0:\n            # Check p(Y=1|X=1)  p(Y=1|X=0) via cross-multiplication\n            # n(Y=1,X=1)/n(X=1)  n(Y=1,X=0)/n(X=0) => n(Y=1,X=1)*n(X=0)  n(Y=1,X=0)*n(X=1)\n            marg_assoc_neg = (n_y1_x1 * n_x0)  (n_y1_x0 * n_x1)\n\n        # Simpson's Paradox holds if conditional associations are positive AND marginal association is negative.\n        paradox_exhibited = all_cond_assoc_pos and marg_assoc_neg\n        results.append(paradox_exhibited)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3115837"}, {"introduction": "在控制了混杂变量之后，我们可能会认为“控制的变量越多越好”，但这种直觉是危险的。这个练习聚焦于一种被称为M-偏倚的对撞偏倚，它恰恰是在我们错误地控制一个对撞节点时产生的。通过推导在这种情况下引入的协方差，您将量化这种偏倚，并深刻理解为什么在因果推断中选择控制变量必须依据DAG的结构，而非盲目地进行统计调整[@problem_id:3115768]。", "problem": "考虑由有向无环图 (DAG) 表示的以下因果结构：节点 $A$、$B$、$M$、$X$ 和 $Y$ 存在有向边 $A \\to X$、$A \\to M$、$B \\to M$ 和 $B \\to Y$。变量 $A$ 和 $B$ 是统计独立的，所有箭头都代表直接因果效应。假设数据生成过程是线性的、联合高斯的，且均值为零：\n$$\nX = \\alpha A + \\varepsilon_{X}, \\quad Y = \\beta B + \\varepsilon_{Y}, \\quad M = \\gamma_{A} A + \\gamma_{B} B + \\varepsilon_{M},\n$$\n其中 $A \\sim \\mathcal{N}(0,\\sigma_{A}^{2})$，$B \\sim \\mathcal{N}(0,\\sigma_{B}^{2})$，且噪声项 $\\varepsilon_{X} \\sim \\mathcal{N}(0,\\sigma_{X}^{2})$、$\\varepsilon_{Y} \\sim \\mathcal{N}(0,\\sigma_{Y}^{2})$、$\\varepsilon_{M} \\sim \\mathcal{N}(0,\\sigma_{M}^{2})$ 相互独立，并且也独立于 $A$ 和 $B$。\n\n首先，使用 $d$-分离的定义，从概念上解释为什么在该结构中，当不进行条件化时，$X$ 和 $Y$ 是不相关的，以及为什么以对撞节点 $M$ 为条件会打开一条路径，从而在 $X$ 和 $Y$ 之间引入统计依赖性（此步骤中请勿计算）。然后，在所述高斯假设下，从第一性原理推导出诱导的条件协方差 $\\operatorname{Cov}(X,Y \\mid M)$，并将其表示为包含 $\\alpha$、$\\beta$、$\\gamma_{A}$、$\\gamma_{B}$、$\\sigma_{A}^{2}$、$\\sigma_{B}^{2}$ 和 $\\sigma_{M}^{2}$ 的闭式解析表达式。\n\n您的最终答案必须是单个解析表达式。无需四舍五入。", "solution": "在尝试解答之前，对问题进行验证。\n\n### 步骤1：提取已知条件\n- **节点**：$A$、$B$、$M$、$X$、$Y$。\n- **有向边 (因果结构)**：$A \\to X$、$A \\to M$、$B \\to M$、$B \\to Y$。\n- **统计独立性**：$A$ 和 $B$ 统计独立。\n- **数据生成过程**：线性、联合高斯、零均值。\n- **结构方程**：\n  - $X = \\alpha A + \\varepsilon_{X}$\n  - $Y = \\beta B + \\varepsilon_{Y}$\n  - $M = \\gamma_{A} A + \\gamma_{B} B + \\varepsilon_{M}$\n- **分布**：\n  - $A \\sim \\mathcal{N}(0,\\sigma_{A}^{2})$\n  - $B \\sim \\mathcal{N}(0,\\sigma_{B}^{2})$\n  - $\\varepsilon_{X} \\sim \\mathcal{N}(0,\\sigma_{X}^{2})$\n  - $\\varepsilon_{Y} \\sim \\mathcal{N}(0,\\sigma_{Y}^{2})$\n  - $\\varepsilon_{M} \\sim \\mathcal{N}(0,\\sigma_{M}^{2})$\n- **噪声项独立性**：$\\varepsilon_{X}$、$\\varepsilon_{Y}$、$\\varepsilon_{M}$ 相互独立，并且也独立于 $A$ 和 $B$。\n\n### 步骤2：使用提取的已知条件进行验证\n1.  **科学依据**：该问题基于结构因果模型、有向无环图 (DAG)、d-分离和多元高斯分布等成熟的理论框架。这些是统计学、机器学习和计量经济学中的标准课题。\n2.  **良态问题 (Well-Posed)**：该问题是良态的。它要求基于d-分离进行概念性解释，并进行具体的解析推导 `Cov(X, Y | M)`。所提供的信息（线性高斯模型、所有参数和独立性假设）足以唯一确定此量。\n3.  **客观性**：问题陈述精确、量化，没有主观或含糊不清的语言。\n4.  **完整性和一致性**：问题是自洽的。所有必需的变量、参数和分布假设都已提供。设置中没有矛盾之处。\n5.  **相关性**：该问题与使用 DAG 进行因果推断的主题直接相关。\n\n### 步骤3：结论与行动\n问题有效。将提供完整的解答。\n\n---\n\n### 使用 d-分离进行概念性解释\n\n因果关系可以用给定的有向无环图 (DAG) 进行可视化。为了确定 $X$ 和 $Y$ 之间的统计依赖性，我们使用 $d$-分离的概念，该概念分析了两个节点之间的所有路径。\n\n在这个 DAG 中，节点 $X$ 和节点 $Y$ 之间只有一条路径。该路径是 $X \\leftarrow A \\to M \\leftarrow B \\to Y$。路径是连接边的序列，与其方向无关。\n\n如果一条路径包含以下情况，则称两个节点之间的该路径被阻断（意味着条件独立）：\n1.  一个链式结构 ($U \\to V \\to W$) 或一个分叉结构 ($U \\leftarrow V \\to W$)，其中中间节点 $V$ 位于条件集中。\n2.  一个对撞结构 ($U \\to V \\leftarrow W$)，其中中间节点 $V$ *不*在条件集中，并且 $V$ 的任何后代都不在条件集中。\n\n让我们在两种场景下分析路径 $X \\leftarrow A \\to M \\leftarrow B \\to Y$：\n\n1.  **无条件情况（无条件集）**：路径中 $A \\to M \\leftarrow B$ 的部分在节点 $M$ 处形成了一个对撞结构，因为有两个箭头指向 $M$。根据 $d$-分离的规则，如果一条路径包含一个对撞节点，且该对撞节点不在条件集中，则该路径被阻断。在这里，条件集是空的。因此，节点 $M$ 阻断了 $A$ 和 $B$ 之间的路径，从而也阻断了 $X$ 和 $Y$ 之间的路径。由于 $X$ 和 $Y$ 之间的所有路径都被阻断，它们是 $d$-分离的。对于联合高斯系统，$d$-分离意味着统计独立，因此 $X$ 和 $Y$ 是不相关的，即 $\\operatorname{Cov}(X,Y) = 0$。\n\n2.  **以 M 为条件**：当我们以对撞节点 $M$ 为条件时，$d$-分离的规则指出该路径现在被打开。以一个对撞节点（或其后代之一）为条件会解除对该部分路径的阻断。通过以 $M$ 为条件，我们在其父节点 $A$ 和 $B$ 之间引入了统计依赖性。这种现象通常被称为“解释消除”。例如，如果我们观察到 $M$ 的某个值，那么知道 $A$ 的值就能提供关于 $B$ 可能值的信息。这种在 $A$ 和 $B$ 之间诱导出的依赖性会沿着路径的其余部分传播：从 $A$ 到 $X$（通过 $A \\to X$）和从 $B$ 到 $Y$（通过 $B \\to Y$）。结果，路径 $X \\leftarrow A \\to M \\leftarrow B \\to Y$ 变为激活状态，而 $X$ 和 $Y$ 在以 $M$ 为条件下变得统计相关（相关）。\n\n### 条件协方差 $\\operatorname{Cov}(X,Y \\mid M)$ 的推导\n\n由于所有变量都由高斯随机变量的线性组合定义，因此 $(X, Y, M)$ 的联合分布是均值向量为零的多元高斯分布。对于多元高斯分布，条件协方差可以使用无条件协方差矩阵来计算。\n\n设随机向量为 $\\mathbf{V} = (X, Y, M)^T$。$\\mathbf{V}$ 的协方差矩阵记为 $\\Sigma$。我们将 $\\mathbf{V}$ 划分成 $\\mathbf{V_1} = (X, Y)^T$ 和 $\\mathbf{V_2} = (M)$。协方差矩阵 $\\Sigma$ 也作相应划分：\n$$\n\\Sigma = \\begin{pmatrix} \\Sigma_{11}  \\Sigma_{12} \\\\ \\Sigma_{21}  \\Sigma_{22} \\end{pmatrix}\n$$\n其中 $\\Sigma_{11} = \\operatorname{Cov}(\\mathbf{V_1})$，$\\Sigma_{22} = \\operatorname{Cov}(\\mathbf{V_2}) = \\operatorname{Var}(M)$，且 $\\Sigma_{12} = \\Sigma_{21}^T = \\operatorname{Cov}(\\mathbf{V_1}, \\mathbf{V_2})$。\n\n在给定 $\\mathbf{V_2}$ 的情况下，$\\mathbf{V_1}$ 的条件协方差矩阵由以下公式给出：\n$$\n\\operatorname{Cov}(X, Y \\mid M) = \\Sigma_{11} - \\Sigma_{12} \\Sigma_{22}^{-1} \\Sigma_{21}\n$$\n我们想要的特定元素是这个得到的 $2 \\times 2$ 矩阵的非对角线元素，它对应于 $\\operatorname{Cov}(X, Y \\mid M)$。\n这由下式给出：\n$$\n\\operatorname{Cov}(X, Y \\mid M) = \\operatorname{Cov}(X, Y) - \\frac{\\operatorname{Cov}(X, M) \\operatorname{Cov}(Y, M)}{\\operatorname{Var}(M)}\n$$\n我们需要计算右边的四项。由于所有变量的均值为零，协方差是乘积的期望，即 $\\operatorname{Cov}(U,V) = E[UV]$。\n\n1.  **计算 $\\operatorname{Cov}(X, Y)$**：\n    $$\n    \\operatorname{Cov}(X, Y) = E[XY] = E[(\\alpha A + \\varepsilon_{X})(\\beta B + \\varepsilon_{Y})]\n    $$\n    展开此式得到 $E[\\alpha\\beta AB + \\alpha A \\varepsilon_{Y} + \\beta B \\varepsilon_{X} + \\varepsilon_{X}\\varepsilon_{Y}]$。由于 $A, B, \\varepsilon_{X}, \\varepsilon_{Y}$ 的相互独立性及其零均值，所有项的期望都为零。例如，$E[AB] = E[A]E[B] = 0 \\cdot 0 = 0$。\n    $$\n    \\operatorname{Cov}(X, Y) = 0\n    $$\n    这证实了 $d$-分离分析的结果。\n\n2.  **计算 $\\operatorname{Var}(M)$**：\n    $$\n    \\operatorname{Var}(M) = \\operatorname{Var}(\\gamma_{A} A + \\gamma_{B} B + \\varepsilon_{M})\n    $$\n    由于 $A, B, \\varepsilon_{M}$ 相互独立：\n    $$\n    \\operatorname{Var}(M) = \\gamma_{A}^2 \\operatorname{Var}(A) + \\gamma_{B}^2 \\operatorname{Var}(B) + \\operatorname{Var}(\\varepsilon_{M}) = \\gamma_{A}^2 \\sigma_{A}^2 + \\gamma_{B}^2 \\sigma_{B}^2 + \\sigma_{M}^2\n    $$\n\n3.  **计算 $\\operatorname{Cov}(X, M)$**：\n    $$\n    \\operatorname{Cov}(X, M) = E[XM] = E[(\\alpha A + \\varepsilon_{X})(\\gamma_{A} A + \\gamma_{B} B + \\varepsilon_{M})]\n    $$\n    展开得到 $E[\\alpha\\gamma_{A}A^2 + \\alpha\\gamma_{B}AB + \\alpha A \\varepsilon_{M} + \\gamma_{A}A\\varepsilon_{X} + \\gamma_{B}B\\varepsilon_{X} + \\varepsilon_{X}\\varepsilon_{M}]$。由于独立性和零均值，除了第一项外，所有项的期望都为零。\n    $$\n    \\operatorname{Cov}(X, M) = \\alpha\\gamma_{A} E[A^2] = \\alpha\\gamma_{A} \\operatorname{Var}(A) = \\alpha\\gamma_{A} \\sigma_{A}^2\n    $$\n\n4.  **计算 $\\operatorname{Cov}(Y, M)$**：\n    $$\n    \\operatorname{Cov}(Y, M) = E[YM] = E[(\\beta B + \\varepsilon_{Y})(\\gamma_{A} A + \\gamma_{B} B + \\varepsilon_{M})]\n    $$\n    展开得到 $E[\\beta\\gamma_{A}AB + \\beta\\gamma_{B}B^2 + \\beta B \\varepsilon_{M} + \\gamma_{A}A\\varepsilon_{Y} + \\gamma_{B}B\\varepsilon_{Y} + \\varepsilon_{Y}\\varepsilon_{M}]$。由于独立性和零均值，除了第二项外，所有项的期望都为零。\n    $$\n    \\operatorname{Cov}(Y, M) = \\beta\\gamma_{B} E[B^2] = \\beta\\gamma_{B} \\operatorname{Var}(B) = \\beta\\gamma_{B} \\sigma_{B}^2\n    $$\n\n最后，将这些结果代入条件协方差的公式中：\n$$\n\\operatorname{Cov}(X, Y \\mid M) = 0 - \\frac{(\\alpha\\gamma_{A} \\sigma_{A}^2)(\\beta\\gamma_{B} \\sigma_{B}^2)}{\\gamma_{A}^2 \\sigma_{A}^2 + \\gamma_{B}^2 \\sigma_{B}^2 + \\sigma_{M}^2}\n$$\n这可以简化为最终的表达式：\n$$\n\\operatorname{Cov}(X, Y \\mid M) = - \\frac{\\alpha\\beta\\gamma_{A}\\gamma_{B}\\sigma_{A}^2\\sigma_{B}^2}{\\gamma_{A}^2 \\sigma_{A}^2 + \\gamma_{B}^2 \\sigma_{B}^2 + \\sigma_{M}^2}\n$$\n该表达式是非零的（除非系数 $\\alpha, \\beta, \\gamma_A, \\gamma_B$ 中有任意一个为零），这证明了以对撞节点 $M$ 为条件会在 $X$ 和 $Y$ 之间引入统计依赖性。", "answer": "$$\\boxed{-\\frac{\\alpha\\beta\\gamma_{A}\\gamma_{B}\\sigma_{A}^{2}\\sigma_{B}^{2}}{\\gamma_{A}^{2}\\sigma_{A}^{2} + \\gamma_{B}^{2}\\sigma_{B}^{2} + \\sigma_{M}^{2}}}$$", "id": "3115768"}, {"introduction": "当处理和结果之间存在未被观测到的混杂因素时，我们似乎无法估计因果效应。然而，前门准则提供了一条巧妙的出路，它利用了因果链条中的中介变量来识别效应。这个练习将带您应用前门调整公式，在一个存在未观测混杂的公共卫生场景中，准确计算出疫苗的因果效应，展示DAG在寻找识别策略方面的强大能力[@problem_id:3115795]。", "problem": "一个公共卫生团队正在使用有向无环图（DAG）研究疫苗接种对感染的因果效应。设 $V$ 表示疫苗接种状态，$A$ 表示接种后抗体反应，$I$ 表示后续感染，而 $C$ 表示年龄。该DAG为 $V \\to A \\to I$，且有 $C \\to V$ 和 $C \\to I$。从 $V$ 到 $I$ 没有直接边。在可用数据中，变量 $C$ 是未被观测到的。该团队怀疑 $C$ 是 $V$ 和 $I$ 的混杂因子，但除了通过 $V$ 之外，它不直接或间接影响 $A$。\n\n所有变量 $V$、$A$ 和 $I$ 都是二元的，其状态空间为 $\\{0,1\\}$。观测数据提供了以下概率：\n- $P(V=1) = 0.6$ 且 $P(V=0) = 0.4$。\n- $P(A=1 \\mid V=1) = 0.8$ 且 $P(A=1 \\mid V=0) = 0.2$；因此 $P(A=0 \\mid V=1) = 0.2$ 且 $P(A=0 \\mid V=0) = 0.8$。\n- $P(I=1 \\mid A=1, V=1) = 0.05$，$P(I=1 \\mid A=1, V=0) = 0.10$，$P(I=1 \\mid A=0, V=1) = 0.20$，以及 $P(I=1 \\mid A=0, V=0) = 0.30$。\n\n仅使用由DAG编码的图形假设以及连接干预与观测分布的标准法则，计算疫苗接种对感染的平均因果效应，其定义为\n$$\\tau \\equiv P(I=1 \\mid \\operatorname{do}(V=1)) - P(I=1 \\mid \\operatorname{do}(V=0)).$$\n将您的最终答案表示为一个小数，并四舍五入到4位有效数字。不要使用百分号。", "solution": "该问题是有效的。这是一个基于有向无环图（DAG）的因果推断领域中的良定问题。尽管存在未观测到的混杂因子 $C$，平均因果效应（ACE）仍可从所提供的观测数据中识别，因为该DAG的结构满足前门准则。\n\n因果关系由DAG给出：$C \\to V \\to A \\to I$ 和 $C \\to I$。变量 $C$ 是疫苗接种（$V$）和感染（$I$）之间关系的未观测混杂因子，因为它创建了一条后门路径 $V \\leftarrow C \\to I$。$V$ 对 $I$ 的效应完全由抗体反应（$A$）介导，因为从 $V$ 到 $I$ 的唯一有向路径是 $V \\to A \\to I$。\n\n如果满足三个条件，前门准则允许使用中介变量 $A$ 来识别 $V$ 对 $I$ 的因果效应：\n1.  $A$ 截断了从 $V$ 到 $I$ 的所有有向路径。这是成立的，因为唯一的此类路径是 $V \\to A \\to I$。\n2.  从 $V$ 到 $A$ 没有未被阻断的后门路径。从 $V$ 的祖先节点到 $A$ 的唯一路径是 $C \\to V \\to A$，这不是一条后门路径。因此，该条件得到满足。\n3.  从 $A$ 到 $I$ 的所有后门路径都被 $V$ 阻断。从 $A$ 到 $I$ 的唯一后门路径是 $A \\leftarrow V \\leftarrow C \\to I$。通过对 $V$ 进行条件化，该路径被阻断。\n\n由于所有条件都得到满足，$V$ 对 $I$ 的因果效应 $P(I=1 \\mid \\operatorname{do}(V=v))$ 可以使用前门调整公式计算：\n$$ P(I=1 \\mid \\operatorname{do}(V=v)) = \\sum_{a \\in \\{0, 1\\}} P(A=a \\mid V=v) \\sum_{v' \\in \\{0, 1\\}} P(I=1 \\mid A=a, V=v') P(V=v') $$\n右侧的所有概率均在问题描述中给出。\n\n我们首先计算内部求和项，该项与干预变量 $v$ 无关。我们将此项记为 $S_a$：\n$$ S_a \\equiv \\sum_{v' \\in \\{0, 1\\}} P(I=1 \\mid A=a, V=v') P(V=v') $$\n\n对于 $a=1$：\n$$ S_1 = P(I=1 \\mid A=1, V=0)P(V=0) + P(I=1 \\mid A=1, V=1)P(V=1) $$\n使用给定值：\n$$ S_1 = (0.10)(0.4) + (0.05)(0.6) = 0.04 + 0.03 = 0.07 $$\n\n对于 $a=0$：\n$$ S_0 = P(I=1 \\mid A=0, V=0)P(V=0) + P(I=1 \\mid A=0, V=1)P(V=1) $$\n使用给定值：\n$$ S_0 = (0.30)(0.4) + (0.20)(0.6) = 0.12 + 0.12 = 0.24 $$\n\n现在我们可以计算 $V=1$ 和 $V=0$ 的干预概率。\n\n对于干预 $\\operatorname{do}(V=1)$：\n$$ P(I=1 \\mid \\operatorname{do}(V=1)) = \\sum_{a \\in \\{0, 1\\}} P(A=a \\mid V=1) S_a $$\n$$ P(I=1 \\mid \\operatorname{do}(V=1)) = P(A=0 \\mid V=1)S_0 + P(A=1 \\mid V=1)S_1 $$\n使用给定值：\n$$ P(I=1 \\mid \\operatorname{do}(V=1)) = (0.2)(0.24) + (0.8)(0.07) = 0.048 + 0.056 = 0.104 $$\n\n对于干预 $\\operatorname{do}(V=0)$：\n$$ P(I=1 \\mid \\operatorname{do}(V=0)) = \\sum_{a \\in \\{0, 1\\}} P(A=a \\mid V=0) S_a $$\n$$ P(I=1 \\mid \\operatorname{do}(V=0)) = P(A=0 \\mid V=0)S_0 + P(A=1 \\mid V=0)S_1 $$\n使用给定值：\n$$ P(I=1 \\mid \\operatorname{do}(V=0)) = (0.8)(0.24) + (0.2)(0.07) = 0.192 + 0.014 = 0.206 $$\n\n最后，平均因果效应 $\\tau$ 是这两个量之差：\n$$ \\tau = P(I=1 \\mid \\operatorname{do}(V=1)) - P(I=1 \\mid \\operatorname{do}(V=0)) $$\n$$ \\tau = 0.104 - 0.206 = -0.102 $$\n\n问题要求答案四舍五入到4位有效数字。\n$$ \\tau = -0.1020 $$\n这表明疫苗接种在因果上将感染概率降低了 $0.1020$。", "answer": "$$\\boxed{-0.1020}$$", "id": "3115795"}]}