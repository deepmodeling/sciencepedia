{"hands_on_practices": [{"introduction": "在评估一个机器学习模型的公平性时，首要步骤之一是进行公平性审计。这个实践将指导你如何使用非参数统计方法来检验模型是否满足人口均等（Demographic Parity）[@problem_id:3120841]。你将学习如何根据模型输出的分数，为不同群体构建经验生存函数，并使用柯尔莫可洛夫-斯米尔诺夫（Kolmogorov-Smirnov）检验来量化和评估两个群体之间预测分布的差异。", "problem": "考虑一个二元敏感属性 $A \\in \\{0,1\\}$ 和一个分类器为每个个体输出的黑盒分数 $\\hat{p} \\in [0,1]$。在人口均等的条件下，二元决策 $\\hat{Y}$ 与 $A$ 无关。假设决策是通过在水平 $t \\in [0,1]$ 上对 $\\hat{p}$ 进行阈值化生成的，即 $\\hat{Y}_{t} = \\mathbf{1}\\{\\hat{p} \\ge t\\}$。使用生存函数 $S_{a}(t) = P(\\hat{p} \\ge t \\mid A=a)$ 以及两组之间的上确界型差异，通过检验 $\\hat{p}$ 的分布在两个组中是否相同，来非参数地审计人口均等。从第一性原理出发，从人口均等的独立性定义和经验分布函数的性质开始，推导出这个检验，而不对分数分布做任何参数形式的假设。\n\n给定两个独立的分数样本：\n- 组 $A=0$ 有 $n_{0}=6$ 个分数：$0.02$, $0.10$, $0.22$, $0.40$, $0.65$, $0.90$。\n- 组 $A=1$ 有 $n_{1}=8$ 个分数：$0.05$, $0.08$, $0.25$, $0.30$, $0.45$, $0.60$, $0.85$, $0.95$。\n\n为这些样本构建经验生存函数 $\\hat{S}_{0}(t)$ 和 $\\hat{S}_{1}(t)$，并计算由此产生的柯尔莫哥洛夫-斯米尔诺夫（KS）统计量，该统计量定义为两个经验生存函数在 $t \\in [0,1]$ 上的绝对差的上确界。报告此KS统计量的值。以精确值形式给出最终答案（不要四舍五入）。", "solution": "人口均等要求决策 $\\hat{Y}$ 与敏感属性 $A$ 无关。如果决策是通过在水平 $t \\in [0,1]$ 上对分数进行阈值化生成的，则 $\\hat{Y}_{t} = \\mathbf{1}\\{\\hat{p} \\ge t\\}$ 且在阈值 $t$ 处的人口均等意味着\n$$\nP(\\hat{Y}_{t}=1 \\mid A=0) \\;=\\; P(\\hat{Y}_{t}=1 \\mid A=1).\n$$\n根据 $\\hat{Y}_{t}$ 的定义，这个条件等价于\n$$\nP(\\hat{p} \\ge t \\mid A=0) \\;=\\; P(\\hat{p} \\ge t \\mid A=1),\n$$\n这就是在阈值 $t$ 处生存函数 $S_{0}(t)$ 和 $S_{1}(t)$ 相等。如果没有先验地指定阈值，那么在所有可能的阈值上审计人口均等就相当于检验\n$$\nS_{0}(t) \\;=\\; S_{1}(t) \\quad \\text{对所有 } t \\in [0,1].\n$$\n这等价于检验给定 $A=0$ 和 $A=1$ 时 $\\hat{p}$ 的条件分布是否相等，因为 $S_{a}(t) = 1 - F_{a}(t-)$，其中 $F_{a}$ 是给定 $A=a$ 时 $\\hat{p}$ 的累积分布函数。一种针对分布之间最大差异的非参数检验是柯尔莫哥洛夫-斯米尔诺夫（KS）检验，它比较的是经验分布函数之间绝对差的上确界。因为 $S_{a}(t)$ 和 $F_{a}(t)$ 仅相差一个补集，所以 $|\\hat{S}_{0}(t) - \\hat{S}_{1}(t)|$ 在 $t$ 上的上确界与根据累积分布函数计算的KS统计量产生相同的差异。\n\n为了从数据中非参数地估计 $S_{a}(t)$，我们使用经验生存函数\n$$\n\\hat{S}_{a}(t) \\;=\\; \\frac{1}{n_{a}} \\sum_{i: A_{i}=a} \\mathbf{1}\\{\\hat{p}_{i} \\ge t\\}.\n$$\n基于生存函数的KS统计量则为\n$$\nD \\;=\\; \\sup_{t \\in [0,1]} \\left| \\hat{S}_{0}(t) - \\hat{S}_{1}(t) \\right|.\n$$\n\n现在我们针对给定的样本计算在不同 $t$ 值下的 $\\hat{S}_{0}(t)$ 和 $\\hat{S}_{1}(t)$。因为经验生存函数是仅在观测到的分数处发生变化的右连续阶梯函数，所以只需在从观测值的并集中取出的阈值 $t$ 处进行评估。设 $n_{0} = 6$ 且 $n_{1} = 8$。排序后的分数为：\n- 对于 $A=0$：$0.02$, $0.10$, $0.22$, $0.40$, $0.65$, $0.90$。\n- 对于 $A=1$：$0.05$, $0.08$, $0.25$, $0.30$, $0.45$, $0.60$, $0.85$, $0.95$。\n\n我们在唯一的阈值 $t \\in \\{0.02, 0.05, 0.08, 0.10, 0.22, 0.25, 0.30, 0.40, 0.45, 0.60, 0.65, 0.85, 0.90, 0.95\\}$ 处评估 $\\hat{S}_{0}(t)$ 和 $\\hat{S}_{1}(t)$（并注意它们之间的行为）：\n\n- 在 $t=0.02$ 处：$\\hat{S}_{0}(0.02) = \\frac{6}{6} = 1$, $\\hat{S}_{1}(0.02) = \\frac{8}{8} = 1$, 差值为 $0$。\n- 在 $t=0.05$ 处：$\\hat{S}_{0}(0.05) = \\frac{5}{6}$, $\\hat{S}_{1}(0.05) = \\frac{8}{8} = 1$, 差值为 $\\left| \\frac{5}{6} - 1 \\right| = \\frac{1}{6}$。\n- 在 $t=0.08$ 处：$\\hat{S}_{0}(0.08) = \\frac{5}{6}$, $\\hat{S}_{1}(0.08) = \\frac{7}{8}$, 差值为 $\\left| \\frac{5}{6} - \\frac{7}{8} \\right| = \\frac{1}{24}$。\n- 在 $t=0.10$ 处：$\\hat{S}_{0}(0.10) = \\frac{5}{6}$, $\\hat{S}_{1}(0.10) = \\frac{6}{8} = \\frac{3}{4}$, 差值为 $\\left| \\frac{5}{6} - \\frac{3}{4} \\right| = \\frac{1}{12}$。\n- 在 $t=0.22$ 处：$\\hat{S}_{0}(0.22) = \\frac{4}{6} = \\frac{2}{3}$, $\\hat{S}_{1}(0.22) = \\frac{6}{8} = \\frac{3}{4}$, 差值为 $\\left| \\frac{2}{3} - \\frac{3}{4} \\right| = \\frac{1}{12}$。\n- 在 $t=0.25$ 处：$\\hat{S}_{0}(0.25) = \\frac{3}{6} = \\frac{1}{2}$, $\\hat{S}_{1}(0.25) = \\frac{6}{8} = \\frac{3}{4}$, 差值为 $\\left| \\frac{1}{2} - \\frac{3}{4} \\right| = \\frac{1}{4}$。\n- 在 $t=0.30$ 处：$\\hat{S}_{0}(0.30) = \\frac{3}{6} = \\frac{1}{2}$, $\\hat{S}_{1}(0.30) = \\frac{5}{8}$, 差值为 $\\left| \\frac{1}{2} - \\frac{5}{8} \\right| = \\frac{1}{8}$。\n- 在 $t=0.40$ 处：$\\hat{S}_{0}(0.40) = \\frac{3}{6} = \\frac{1}{2}$, $\\hat{S}_{1}(0.40) = \\frac{4}{8} = \\frac{1}{2}$, 差值为 $0$。\n- 在 $t=0.45$ 处：$\\hat{S}_{0}(0.45) = \\frac{2}{6} = \\frac{1}{3}$, $\\hat{S}_{1}(0.45) = \\frac{4}{8} = \\frac{1}{2}$, 差值为 $\\left| \\frac{1}{3} - \\frac{1}{2} \\right| = \\frac{1}{6}$。\n- 在 $t=0.60$ 处：$\\hat{S}_{0}(0.60) = \\frac{2}{6} = \\frac{1}{3}$, $\\hat{S}_{1}(0.60) = \\frac{3}{8}$, 差值为 $\\left| \\frac{1}{3} - \\frac{3}{8} \\right| = \\frac{1}{24}$。\n- 在 $t=0.65$ 处：$\\hat{S}_{0}(0.65) = \\frac{2}{6} = \\frac{1}{3}$, $\\hat{S}_{1}(0.65) = \\frac{2}{8} = \\frac{1}{4}$, 差值为 $\\left| \\frac{1}{3} - \\frac{1}{4} \\right| = \\frac{1}{12}$。\n- 在 $t=0.85$ 处：$\\hat{S}_{0}(0.85) = \\frac{1}{6}$, $\\hat{S}_{1}(0.85) = \\frac{2}{8} = \\frac{1}{4}$, 差值为 $\\left| \\frac{1}{6} - \\frac{1}{4} \\right| = \\frac{1}{12}$。\n- 在 $t=0.90$ 处：$\\hat{S}_{0}(0.90) = \\frac{1}{6}$, $\\hat{S}_{1}(0.90) = \\frac{1}{8}$, 差值为 $\\left| \\frac{1}{6} - \\frac{1}{8} \\right| = \\frac{1}{24}$。\n- 在 $t=0.95$ 处：$\\hat{S}_{0}(0.95) = 0$, $\\hat{S}_{1}(0.95) = \\frac{1}{8}$, 差值为 $\\left| 0 - \\frac{1}{8} \\right| = \\frac{1}{8}$。\n\n在这些阈值之间，经验生存函数在区间上是常数，因此绝对差等于每个区间内端点处的值。观测到的最大绝对差为 $\\frac{1}{4}$，它出现在区间 $[0.25, 0.30)$ 内的 $t$ 值（包括 $t=0.25$）。\n\n因此，基于经验生存函数的柯尔莫哥洛夫-斯米尔诺夫统计量是\n$$\nD \\;=\\; \\frac{1}{4}.\n$$", "answer": "$$\\boxed{\\frac{1}{4}}$$", "id": "3120841"}, {"introduction": "在追求公平性的过程中，我们有时会发现无法使用单一的确定性决策规则来同时满足公平性标准和性能要求。这个练习将通过一个离散分数的具体案例，揭示这一挑战，并展示为何在某些情况下无法实现均等化赔率（Equalized Odds）[@problem_id:3120831]。更重要的是，你将亲手构建一个随机化分类器，通过在两个不同决策阈值之间进行概率性选择，来精确地满足公平性约束。", "problem": "考虑一个二元分类场景，其中有一个受保护属性 $A \\in \\{a,b\\}$、一个二元标签 $Y \\in \\{0,1\\}$ 和一个离散风险评分 $S \\in \\{3,2,1,0\\}$。对于每个组 $A$，您将构建受试者工作特征 (ROC) 点，并评估均等化赔率 (EO) 的可行性。在阈值 $\\tau$ 处的受试者工作特征 (ROC) 点由点对 $(\\text{FPR}, \\text{TPR})$ 定义，其中假阳性率 (FPR) 是在 $Y=0$ 的条件下 $\\hat{Y}_{\\tau} = 1$ 的概率，真阳性率 (TPR) 是在 $Y=1$ 的条件下 $\\hat{Y}_{\\tau} = 1$ 的概率。当且仅当 $S \\ge \\tau$ 时，阈值为 $\\tau$ 的分类器预测 $\\hat{Y}_{\\tau} = 1$。均等化赔率 (EO) 要求分类器在 $A=a$ 和 $A=b$ 两个组中产生相同的 $\\text{FPR}$ 和 $\\text{TPR}$。在本问题中，您还必须遵守操作约束 $\\text{TPR} \\ge 0.6$ 和 $\\text{FPR} \\le 0.5$。\n\n给定一个由各组计数定义的合成数据集。对于 $A=a$，有 $10$ 个正例和 $10$ 个负例，其评分分配如下：\n- 对于 $Y=1$ (正例)：$5$ 个 $S=3$，$3$ 个 $S=2$，$1$ 个 $S=1$，$1$ 个 $S=0$。\n- 对于 $Y=0$ (负例)：$2$ 个 $S=3$，$2$ 个 $S=2$，$3$ 个 $S=1$，$3$ 个 $S=0$。\n\n对于 $A=b$，有 $10$ 个正例和 $10$ 个负例，其评分分配如下：\n- 对于 $Y=1$ (正例)：$6$ 个 $S=3$，$3$ 个 $S=2$，$1$ 个 $S=1$，$0$ 个 $S=0$。\n- 对于 $Y=0$ (负例)：$2$ 个 $S=3$，$3$ 个 $S=2$，$2$ 个 $S=1$，$3$ 个 $S=0$。\n\n任务：\n1. 使用 $\\text{TPR}$ 和 $\\text{FPR}$ 的定义，分别为 $A=a$ 和 $A=b$ 计算阈值为 $\\tau=3$ 和 $\\tau=2$ 时的 ROC 点 $(\\text{FPR}, \\text{TPR})$。\n2. 通过证明没有任何为每个组选择的单一阈值能够在 $A=a$ 和 $A=b$ 之间产生相同的 $(\\text{FPR}, \\text{TPR})$，来表明在约束 $\\text{TPR} \\ge 0.6$ 和 $\\text{FPR} \\le 0.5$ 下，不使用随机化的情况下，均等化赔率是不可行的。\n3. 现在考虑一个用于 $A=b$ 的混合分类器，它在阈值 $\\tau=3$ 和 $\\tau=2$ 之间进行随机化：以概率 $\\lambda$ 使用 $\\tau=2$，以概率 $1-\\lambda$ 使用 $\\tau=3$。设 $A=a$ 使用确定性阈值 $\\tau=2$。使用第一性原理，将用于 $A=b$ 的混合分类器的 $\\text{TPR}$ 和 $\\text{FPR}$ 表示为 $\\lambda$ 的函数，与为 $A=a$ 选择的点施加 EO 等式，并求解能够实现 EO 同时满足约束的 $\\lambda \\in [0,1]$。将混合概率 $\\lambda$ 报告为单个精确值。无需四舍五入。", "solution": "该问题要求对基于离散风险评分 $S$ 的二元分类器的公平性指标，特别是均等化赔率 (EO)，进行三部分分析。分析涉及两个组，$A=a$ 和 $A=b$。最终任务是为一个随机化分类器找到一个混合概率 $\\lambda$，使其在满足给定性能约束的同时实现 EO。\n\n首先，我们确立必要的定义和数据。如果分数 $S \\ge \\tau$，分类器预测 $\\hat{Y}_{\\tau} = 1$，否则预测 $\\hat{Y}_{\\tau} = 0$。\n真阳性率 (TPR) 是 $P(\\hat{Y}_{\\tau}=1|Y=1)$。\n假阳性率 (FPR) 是 $P(\\hat{Y}_{\\tau}=1|Y=0)$。\n使用每个组、标签和分数的个体计数来估计这些概率。\n\n对于组 $A=a$，正例 ($Y=1$) 的总数为 $N_{+,a}=10$，负例 ($Y=0$) 的总数为 $N_{-,a}=10$。分数分布如下：\n- 对于 $Y=1$：$5$ 个 $S=3$，$3$ 个 $S=2$，$1$ 个 $S=1$，$1$ 个 $S=0$。\n- 对于 $Y=0$：$2$ 个 $S=3$，$2$ 个 $S=2$，$3$ 个 $S=1$，$3$ 个 $S=0$。\n\n对于组 $A=b$，正例 ($Y=1$) 的总数为 $N_{+,b}=10$，负例 ($Y=0$) 的总数为 $N_{-,b}=10$。分数分布如下：\n- 对于 $Y=1$：$6$ 个 $S=3$，$3$ 个 $S=2$，$1$ 个 $S=1$，$0$ 个 $S=0$。\n- 对于 $Y=0$：$2$ 个 $S=3$，$3$ 个 $S=2$，$2$ 个 $S=1$，$3$ 个 $S=0$。\n\n**任务1：计算 $\\tau=3$ 和 $\\tau=2$ 时的 ROC 点**\n\n对于每个组和阈值，我们计算真阳性 (TP) 和假阳性 (FP) 的数量。\n- 真阳性是指 $Y=1$ 且 $S \\ge \\tau$ 的个体。\n- 假阳性是指 $Y=0$ 且 $S \\ge \\tau$ 的个体。\n\n对于组 $A=a$：\n- 在阈值 $\\tau=3$ 时：\n  - $\\text{TP}_a(\\tau=3) = (Y=1, S=3 \\text{ 的计数}) = 5$。\n  - $\\text{TPR}_a(\\tau=3) = \\frac{\\text{TP}_a(\\tau=3)}{N_{+,a}} = \\frac{5}{10} = 0.5$。\n  - $\\text{FP}_a(\\tau=3) = (Y=0, S=3 \\text{ 的计数}) = 2$。\n  - $\\text{FPR}_a(\\tau=3) = \\frac{\\text{FP}_a(\\tau=3)}{N_{-,a}} = \\frac{2}{10} = 0.2$。\n  - ROC 点为 $(\\text{FPR}_a, \\text{TPR}_a) = (0.2, 0.5)$。\n- 在阈值 $\\tau=2$ 时：\n  - $\\text{TP}_a(\\tau=2) = (Y=1, S \\ge 2 \\text{ 的计数}) = 5 + 3 = 8$。\n  - $\\text{TPR}_a(\\tau=2) = \\frac{8}{10} = 0.8$。\n  - $\\text{FP}_a(\\tau=2) = (Y=0, S \\ge 2 \\text{ 的计数}) = 2 + 2 = 4$。\n  - $\\text{FPR}_a(\\tau=2) = \\frac{4}{10} = 0.4$。\n  - ROC 点为 $(\\text{FPR}_a, \\text{TPR}_a) = (0.4, 0.8)$。\n\n对于组 $A=b$：\n- 在阈值 $\\tau=3$ 时：\n  - $\\text{TP}_b(\\tau=3) = (Y=1, S=3 \\text{ 的计数}) = 6$。\n  - $\\text{TPR}_b(\\tau=3) = \\frac{\\text{TP}_b(\\tau=3)}{N_{+,b}} = \\frac{6}{10} = 0.6$。\n  - $\\text{FP}_b(\\tau=3) = (Y=0, S=3 \\text{ 的计数}) = 2$。\n  - $\\text{FPR}_b(\\tau=3) = \\frac{\\text{FP}_b(\\tau=3)}{N_{-,b}} = \\frac{2}{10} = 0.2$。\n  - ROC 点为 $(\\text{FPR}_b, \\text{TPR}_b) = (0.2, 0.6)$。\n- 在阈值 $\\tau=2$ 时：\n  - $\\text{TP}_b(\\tau=2) = (Y=1, S \\ge 2 \\text{ 的计数}) = 6 + 3 = 9$。\n  - $\\text{TPR}_b(\\tau=2) = \\frac{9}{10} = 0.9$。\n  - $\\text{FP}_b(\\tau=2) = (Y=0, S \\ge 2 \\text{ 的计数}) = 2 + 3 = 5$。\n  - $\\text{FPR}_b(\\tau=2) = \\frac{5}{10} = 0.5$。\n  - ROC 点为 $(\\text{FPR}_b, \\text{TPR}_b) = (0.5, 0.9)$。\n\n**任务2：证明不使用随机化时均等化赔率的不可行性**\n\n均等化赔率 (EO) 要求分类器为 $A=a$ 和 $A=b$ 两组实现相同的 $(\\text{FPR}, \\text{TPR})$ 点对。我们还必须满足约束条件 $\\text{TPR} \\ge 0.6$ 和 $\\text{FPR} \\le 0.5$。我们需要检查所有可能的非随机化分类器，这对应于为每个组设置单个阈值 $\\tau$。可能的阈值是 $S$ 的值以及略高于/低于它们的值，实际上是 $\\tau > 3, \\tau=3, \\tau=2, \\tau=1, \\tau=0$。\n\n首先，我们为每个组找到满足约束的有效 ROC 点集合。\n对于组 $A=a$：\n- $\\tau>3$：$(\\text{FPR}, \\text{TPR})=(0,0)$。不满足 $\\text{TPR} \\ge 0.6$。\n- $\\tau=3$：$(\\text{FPR}, \\text{TPR})=(0.2, 0.5)$。不满足 $\\text{TPR} \\ge 0.6$。\n- $\\tau=2$：$(\\text{FPR}, \\text{TPR})=(0.4, 0.8)$。同时满足 $\\text{TPR} \\ge 0.6$ 和 $\\text{FPR} \\le 0.5$。有效。\n- $\\tau=1$：$(\\text{FPR}, \\text{TPR})=(\\frac{7}{10}, \\frac{9}{10}) = (0.7, 0.9)$。不满足 $\\text{FPR} \\le 0.5$。\n- $\\tau=0$：$(\\text{FPR}, \\text{TPR})=(1.0, 1.0)$。不满足 $\\text{FPR} \\le 0.5$。\n$A=a$ 组唯一的有效工作点是 $(0.4, 0.8)$，通过 $\\tau_a=2$ 实现。\n\n对于组 $A=b$：\n- $\\tau>3$：$(\\text{FPR}, \\text{TPR})=(0,0)$。不满足 $\\text{TPR} \\ge 0.6$。\n- $\\tau=3$：$(\\text{FPR}, \\text{TPR})=(0.2, 0.6)$。满足两个约束。有效。\n- $\\tau=2$：$(\\text{FPR}, \\text{TPR})=(0.5, 0.9)$。满足两个约束。有效。\n- $\\tau=1$：$(\\text{FPR}, \\text{TPR})=(\\frac{7}{10}, \\frac{10}{10}) = (0.7, 1.0)$。不满足 $\\text{FPR} \\le 0.5$。\n- $\\tau=0$：$(\\text{FPR}, \\text{TPR})=(1.0, 1.0)$。不满足 $\\text{FPR} \\le 0.5$。\n$A=b$ 组的有效工作点是 $(0.2, 0.6)$ (通过 $\\tau_b=3$ 实现) 和 $(0.5, 0.9)$ (通过 $\\tau_b=2$ 实现)。\n\n为了满足 EO，我们必须找到一个共同的有效点。$a$ 组唯一的有效点是 $(0.4, 0.8)$。这个点不在 $b$ 组的有效点集合中，即 $\\{(0.2, 0.6), (0.5, 0.9)\\}$。因此，不可能为每个组选择满足约束条件和 EO 条件的确定性阈值。不使用随机化，EO 是不可行的。\n\n**任务3：为均等化赔率找到混合概率 $\\lambda$**\n\n我们被指示将 $A=a$ 组的分类器固定为使用确定性阈值 $\\tau=2$。这产生的 ROC 点为 $(\\text{FPR}_a, \\text{TPR}_a) = (0.4, 0.8)$。如前所述，该点满足操作约束。\n\n对于 $A=b$ 组，我们使用一个在两个阈值之间随机化的混合分类器：它以概率 $\\lambda$ 使用 $\\tau=2$，以概率 $1-\\lambda$ 使用 $\\tau=3$。这些阈值对应于 $b$ 组的 ROC 点是：\n- 对于 $\\tau=2$：$(\\text{FPR}_{b, \\tau=2}, \\text{TPR}_{b, \\tau=2}) = (0.5, 0.9)$。\n- 对于 $\\tau=3$：$(\\text{FPR}_{b, \\tau=3}, \\text{TPR}_{b, \\tau=3}) = (0.2, 0.6)$。\n\n$b$ 组混合分类器的 TPR 和 FPR，记为 $\\text{TPR}_b(\\lambda)$ 和 $\\text{FPR}_b(\\lambda)$，是其组成阈值处速率的线性组合，并由各自的概率加权。\n使用全概率定律：\n$$ \\text{FPR}_b(\\lambda) = \\lambda \\cdot \\text{FPR}_{b, \\tau=2} + (1-\\lambda) \\cdot \\text{FPR}_{b, \\tau=3} $$\n$$ \\text{TPR}_b(\\lambda) = \\lambda \\cdot \\text{TPR}_{b, \\tau=2} + (1-\\lambda) \\cdot \\text{TPR}_{b, \\tau=3} $$\n代入数值：\n$$ \\text{FPR}_b(\\lambda) = \\lambda(0.5) + (1-\\lambda)(0.2) = 0.5\\lambda + 0.2 - 0.2\\lambda = 0.3\\lambda + 0.2 $$\n$$ \\text{TPR}_b(\\lambda) = \\lambda(0.9) + (1-\\lambda)(0.6) = 0.9\\lambda + 0.6 - 0.6\\lambda = 0.3\\lambda + 0.6 $$\n\n为了实现均等化赔率，我们必须强制要求各组的 TPR 和 FPR 相等：\n$$ \\text{FPR}_a = \\text{FPR}_b(\\lambda) \\implies 0.4 = 0.3\\lambda + 0.2 $$\n$$ \\text{TPR}_a = \\text{TPR}_b(\\lambda) \\implies 0.8 = 0.3\\lambda + 0.6 $$\n\n我们求解任一方程以得到 $\\lambda$。两个方程必须得出相同的解，才存在一致的解。\n从 FPR 方程得出：\n$$ 0.4 - 0.2 = 0.3\\lambda $$\n$$ 0.2 = 0.3\\lambda $$\n$$ \\lambda = \\frac{0.2}{0.3} = \\frac{2}{3} $$\n从 TPR 方程得出：\n$$ 0.8 - 0.6 = 0.3\\lambda $$\n$$ 0.2 = 0.3\\lambda $$\n$$ \\lambda = \\frac{0.2}{0.3} = \\frac{2}{3} $$\n两个方程都一致地得出 $\\lambda = \\frac{2}{3}$。该值在概率的有效范围 $[0,1]$ 内。\n两个组最终的 ROC 点都是 $(0.4, 0.8)$，满足约束 $\\text{TPR} \\ge 0.6$ 和 $\\text{FPR} \\le 0.5$。因此，混合概率 $\\lambda$ 是 $\\frac{2}{3}$。", "answer": "$$\\boxed{\\frac{2}{3}}$$", "id": "3120831"}, {"introduction": "掌握了经验数据上的公平性度量后，我们进一步深入理论层面，在一个理想化的场景中精确求解满足公平性约束的决策参数。本练习假设模型分数服从高斯分布，要求你从真阳性率（TPR）和假阳性率（FPR）的定义出发，分析推导出满足均等化赔率（Equalized Odds）的精确决策阈值[@problem_id:3120888]。这个过程将加深你对公平性度量、ROC曲线及其与底层概率分布之间关系的数学理解。", "problem": "考虑一个统计学习中的二元分类场景，其中有受保护属性 $A\\in\\{0,1\\}$ 和真实标签 $Y\\in\\{0,1\\}$。在进行阈值化之前，模型会产生一个分数 $X\\in\\mathbb{R}$。分类器使用特定于组的阈值：对于组 $g\\in\\{0,1\\}$，当且仅当 $X\\geq t_g$ 时，它预测 $\\hat{Y}=1$。生成的合成数据使得分数分布是高斯分布，并且是类别条件的，具有依赖于组的均值和共同的方差，具体如下\n$$\nX\\mid (A=0,Y=1)\\sim \\mathcal{N}(2,1),\\quad X\\mid (A=0,Y=0)\\sim \\mathcal{N}(0,1),\n$$\n$$\nX\\mid (A=1,Y=1)\\sim \\mathcal{N}(5,1),\\quad X\\mid (A=1,Y=0)\\sim \\mathcal{N}(3,1).\n$$\n仅从真阳性率 (TPR)、假阳性率 (FPR) 和受试者工作特征 (ROC) 的基本定义出发，其中对于给定组的受试者工作特征（ROC）曲线是通过改变阈值 $t_g$ 得到的所有可实现的 $(\\text{FPR},\\text{TPR})$ 对的集合，并利用高斯分布的标准性质（包括标准正态累积分布函数），执行以下任务：\n\n1. 对于每个组 $g\\in\\{0,1\\}$，解析地推导出作为阈值 $t_g$ 函数的各组 $\\text{TPR}$ 和 $\\text{FPR}$，并由此写出当 $t_g$ 在 $\\mathbb{R}$ 上变化时每个组的参数化 ROC 曲线。\n\n2. 使用均等化赔率 (EO) 的正式定义（该定义要求 $\\text{TPR}_0=\\text{TPR}_1$ 和 $\\text{FPR}_0=\\text{FPR}_1$），找到能精确满足均等化赔率并且能达到 $0.8$ 的共同真阳性率的阈值 $(t_0,t_1)$。\n\n将您的最终数值答案四舍五入到四位有效数字。将您的最终答案表示为有序对 $(t_0,t_1)$。", "solution": "### 解答推导\n\n**第1部分：各组 TPR、FPR 和参数化 ROC 的推导**\n\n设 $\\Phi(z)$ 为标准正态分布 $\\mathcal{N}(0, 1)$ 的累积分布函数 (CDF)。一个随机变量 $Z \\sim \\mathcal{N}(0, 1)$ 大于或等于某个值 $c$ 的概率为 $P(Z \\geq c) = 1 - P(Z  c) = 1 - \\Phi(c)$。\n\n对于来自组 $A=g$ 的个体，决策规则是 $\\hat{Y}=1 \\iff X \\ge t_g$。\n\n**对于组 $A=0$：**\n相关分布为 $X|(A=0,Y=1) \\sim \\mathcal{N}(\\mu_{0,1}=2, \\sigma^2=1)$ 和 $X|(A=0,Y=0) \\sim \\mathcal{N}(\\mu_{0,0}=0, \\sigma^2=1)$。\n\n组 0 的真阳性率 $\\text{TPR}_0$ 是阈值 $t_0$ 的函数：\n$$\n\\text{TPR}_0(t_0) = P(\\hat{Y}=1 | A=0, Y=1) = P(X \\ge t_0 | A=0, Y=1)\n$$\n为计算此概率，我们对随机变量 $X$ 进行标准化。设 $Z = \\frac{X - \\mu_{0,1}}{\\sigma} = \\frac{X-2}{1} = X-2$。$Z \\sim \\mathcal{N}(0,1)$。条件 $X \\ge t_0$ 变为 $Z \\ge t_0 - 2$。\n$$\n\\text{TPR}_0(t_0) = P(Z \\ge t_0 - 2) = 1 - \\Phi(t_0 - 2)\n$$\n组 0 的假阳性率 $\\text{FPR}_0$ 也是 $t_0$ 的函数：\n$$\n\\text{FPR}_0(t_0) = P(\\hat{Y}=1 | A=0, Y=0) = P(X \\ge t_0 | A=0, Y=0)\n$$\n在这种情况下，$X \\sim \\mathcal{N}(0,1)$，所以它已经是一个标准正态变量。\n$$\n\\text{FPR}_0(t_0) = P(X \\ge t_0) = 1 - \\Phi(t_0)\n$$\n组 0 的参数化 ROC 曲线是当 $t_0$ 在 $\\mathbb{R}$ 上变化时，点集 $(\\text{FPR}_0(t_0), \\text{TPR}_0(t_0))$：\n$$\n\\text{ROC}_0 = \\{ (1 - \\Phi(t_0), 1 - \\Phi(t_0 - 2)) \\mid t_0 \\in \\mathbb{R} \\}\n$$\n\n**对于组 $A=1$：**\n相关分布为 $X|(A=1,Y=1) \\sim \\mathcal{N}(\\mu_{1,1}=5, \\sigma^2=1)$ 和 $X|(A=1,Y=0) \\sim \\mathcal{N}(\\mu_{1,0}=3, \\sigma^2=1)$。\n\n组 1 的真阳性率 $\\text{TPR}_1$ 是 $t_1$ 的函数：\n$$\n\\text{TPR}_1(t_1) = P(\\hat{Y}=1 | A=1, Y=1) = P(X \\ge t_1 | A=1, Y=1)\n$$\n对 X 进行标准化：设 $Z = \\frac{X - \\mu_{1,1}}{\\sigma} = \\frac{X-5}{1} = X-5$。$Z \\sim \\mathcal{N}(0,1)$。条件 $X \\ge t_1$ 变为 $Z \\ge t_1 - 5$。\n$$\n\\text{TPR}_1(t_1) = P(Z \\ge t_1 - 5) = 1 - \\Phi(t_1 - 5)\n$$\n组 1 的假阳性率 $\\text{FPR}_1$ 是 $t_1$ 的函数：\n$$\n\\text{FPR}_1(t_1) = P(\\hat{Y}=1 | A=1, Y=0) = P(X \\ge t_1 | A=1, Y=0)\n$$\n对 X 进行标准化：设 $Z = \\frac{X - \\mu_{1,0}}{\\sigma} = \\frac{X-3}{1} = X-3$。$Z \\sim \\mathcal{N}(0,1)$。条件 $X \\ge t_1$ 变为 $Z \\ge t_1 - 3$。\n$$\n\\text{FPR}_1(t_1) = P(Z \\ge t_1 - 3) = 1 - \\Phi(t_1 - 3)\n$$\n组 1 的参数化 ROC 曲线是当 $t_1$ 在 $\\mathbb{R}$ 上变化时，点集 $(\\text{FPR}_1(t_1), \\text{TPR}_1(t_1))$：\n$$\n\\text{ROC}_1 = \\{ (1 - \\Phi(t_1 - 3), 1 - \\Phi(t_1 - 5)) \\mid t_1 \\in \\mathbb{R} \\}\n$$\n\n**第2部分：均等化赔率阈值的计算**\n\n均等化赔率的条件要求真阳性率和假阳性率在各组之间都相等：\n1. $\\text{TPR}_0(t_0) = \\text{TPR}_1(t_1)$\n2. $\\text{FPR}_0(t_0) = \\text{FPR}_1(t_1)$\n\n问题指定了一个附加约束：共同真阳性率必须为 $0.8$。\n$$\n\\text{TPR}_0(t_0) = \\text{TPR}_1(t_1) = 0.8\n$$\n我们可以使用这个约束分别求出 $t_0$ 和 $t_1$。\n\n**求 $t_0$：**\n我们设 $\\text{TPR}_0(t_0) = 0.8$：\n$$\n1 - \\Phi(t_0 - 2) = 0.8\n$$\n$$\n\\Phi(t_0 - 2) = 0.2\n$$\n应用逆正态累积分布函数 $\\Phi^{-1}$：\n$$\nt_0 - 2 = \\Phi^{-1}(0.2)\n$$\n$$\nt_0 = 2 + \\Phi^{-1}(0.2)\n$$\n\n**求 $t_1$：**\n我们设 $\\text{TPR}_1(t_1) = 0.8$:\n$$\n1 - \\Phi(t_1 - 5) = 0.8\n$$\n$$\n\\Phi(t_1 - 5) = 0.2\n$$\n应用逆正态累积分布函数 $\\Phi^{-1}$：\n$$\nt_1 - 5 = \\Phi^{-1}(0.2)\n$$\n$$\nt_1 = 5 + \\Phi^{-1}(0.2)\n$$\n\n现在我们必须验证均等化赔率的第二个条件，即 $\\text{FPR}_0(t_0) = \\text{FPR}_1(t_1)$，对于这些阈值是否成立。\n$$\n\\text{FPR}_0(t_0) = 1 - \\Phi(t_0) = 1 - \\Phi(2 + \\Phi^{-1}(0.2))\n$$\n$$\n\\text{FPR}_1(t_1) = 1 - \\Phi(t_1 - 3) = 1 - \\Phi((5 + \\Phi^{-1}(0.2)) - 3) = 1 - \\Phi(2 + \\Phi^{-1}(0.2))\n$$\n这两个表达式是相同的，因此 $\\text{FPR}_0(t_0) = \\text{FPR}_1(t_1)$ 成立。发生这种情况是因为对于两个组，正类和负类的均值之差是相同的：$\\mu_{0,1} - \\mu_{0,0} = 2 - 0 = 2$ 且 $\\mu_{1,1} - \\mu_{1,0} = 5 - 3 = 2$。这意味着两个组的 ROC 曲线是相同的。\n\n**数值计算：**\n我们需要求出 $\\Phi^{-1}(0.2)$ 的值。这是 z-分数，使得其左侧的标准正态曲线下的面积为 $0.2$。使用标准统计表或计算器，我们得到：\n$$\n\\Phi^{-1}(0.2) \\approx -0.8416212\n$$\n现在我们计算 $t_0$ 和 $t_1$：\n$$\nt_0 = 2 + (-0.8416212) = 1.1583788\n$$\n$$\nt_1 = 5 + (-0.8416212) = 4.1583788\n$$\n题目要求将最终答案四舍五入到四位有效数字。\n对于 $t_0 = 1.1583788$，四舍五入到四位有效数字为 $1.158$。\n$$\nt_0 \\approx 1.158\n$$\n对于 $t_1 = 4.1583788$，四舍五入到四位有效数字为 $4.158$。\n$$\nt_1 \\approx 4.158\n$$\n阈值为 $(t_0, t_1) = (1.158, 4.158)$。", "answer": "$$\n\\boxed{(1.158, 4.158)}\n$$", "id": "3120888"}]}