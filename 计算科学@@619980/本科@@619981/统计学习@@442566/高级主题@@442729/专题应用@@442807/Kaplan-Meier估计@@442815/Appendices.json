{"hands_on_practices": [{"introduction": "在进行任何生存分析之前，首要任务是有效地组织和总结原始数据。本练习将指导你完成这一关键的预处理步骤，将一个临床试验的原始观测数据（包括事件时间和删失时间）转化为一个结构化的汇总表。通过确定每个事件时间点的风险集大小 ($Y_j$)、事件数 ($d_j$) 和区间内的删失数 ($c_j$)，你将为后续的Kaplan-Meier估计奠定坚实的基础 [@problem_id:1961488]。", "problem": "一项临床试验旨在评估一种名为“Neurostabil”的新药在预防神经系统症状复发方面的疗效。十五名受试者参与了这项为期12个月的研究。对于每位受试者，数据以 `(时间, 状态)` 对的形式记录，其中 `时间` 是指直到症状复发（事件发生）或受试者被删失为止的月数，而 `状态` 是一个指示变量（1表示事件发生，0表示删失）。如果受试者退出研究，或者在研究结束前未发生事件，则该受试者被视为删失。\n\n这15名受试者的数据如下：\n(3, 1), (5, 1), (12, 0), (7, 1), (4, 0), (9, 1), (7, 1), (10, 0), (11, 1), (12, 0), (3, 1), (7, 1), (8, 0), (5, 0), (9, 1)\n\n为了准备进行Kaplan-Meier生存分析，您需要对这些数据进行总结。设 $t_1  t_2  \\dots  t_k$ 是唯一的、有序的事件时间序列。对于每个不同的事件时间 $t_j$（其中 $j=1, \\dots, k$），我们定义以下量：\n- $Y_j$：在时间 $t_j$ 之前瞬间处于风险中的受试者数量。如果在时间 $t_j$ 之前尚未发生事件或被删失，则认为该受试者处于风险中。\n- $d_j$：在时间 $t_j$ 发生事件的受试者数量。\n- $c_j$：在时间区间 $[t_{j-1}, t_j)$ 内被删失的受试者数量，其中 $t_0 = 0$。\n\n请确定所有不同事件时间的三元组序列 $(Y_j, d_j, c_j)$。将您的答案以矩阵形式呈现，其中第 $j$ 行包含第 $j$ 个事件时间的三元组。", "solution": "首先，我们将所有15个数据点按时间顺序排列，并标明是事件（1）还是删失（0）：\n(3, 1), (3, 1), (4, 0), (5, 1), (5, 0), (7, 1), (7, 1), (7, 1), (8, 0), (9, 1), (9, 1), (10, 0), (11, 1), (12, 0), (12, 0)。\n唯一的事件发生时间点为：3, 5, 7, 9, 11。我们将按这些时间点进行总结。\n\n**计算每个事件时间点的三元组 $(Y_j, d_j, c_j)$：**\n\n*   **初始状态:** 在研究开始时 ($t_0=0$)，所有15名受试者都处于风险中。\n\n*   **第一个事件时间, $t_1 = 3$:**\n    *   风险集：在时间3之前，没有受试者退出，所以风险集大小 $Y_1 = 15$。\n    *   事件数：在时间3，有2名受试者发生事件，所以 $d_1 = 2$。\n    *   区间内删失数：在时间区间 $[0, 3)$ 内，没有受试者被删失，所以 $c_1 = 0$。\n    *   三元组为 $(15, 2, 0)$。\n    *   事件后，风险集中的人数变为 $15 - 2 = 13$。\n\n*   **第二个事件时间, $t_2 = 5$:**\n    *   风险集：在时间区间 $[3, 5)$ 内，有1名受试者在时间4被删失。因此，在时间5之前瞬间，风险集大小为 $Y_2 = 13 - 1 = 12$。\n    *   事件数：在时间5，有1名受试者发生事件，所以 $d_2 = 1$。\n    *   区间内删失数：在时间区间 $[3, 5)$ 内被删失的人数为 $c_2 = 1$（在时间4）。\n    *   三元组为 $(12, 1, 1)$。\n    *   事件后，风险集中的人数变为 $12 - 1 = 11$。\n\n*   **第三个事件时间, $t_3 = 7$:**\n    *   风险集：在时间区间 $[5, 7)$ 内，有1名受试者在时间5被删失。因此，在时间7之前瞬间，风险集大小为 $Y_3 = 11 - 1 = 10$。\n    *   事件数：在时间7，有3名受试者发生事件，所以 $d_3 = 3$。\n    *   区间内删失数：在时间区间 $[5, 7)$ 内被删失的人数为 $c_3 = 1$（在时间5）。\n    *   三元组为 $(10, 3, 1)$。\n    *   事件后，风险集中的人数变为 $10 - 3 = 7$。\n\n*   **第四个事件时间, $t_4 = 9$:**\n    *   风险集：在时间区间 $[7, 9)$ 内，有1名受试者在时间8被删失。因此，在时间9之前瞬间，风险集大小为 $Y_4 = 7 - 1 = 6$。\n    *   事件数：在时间9，有2名受试者发生事件，所以 $d_4 = 2$。\n    *   区间内删失数：在时间区间 $[7, 9)$ 内被删失的人数为 $c_4 = 1$（在时间8）。\n    *   三元组为 $(6, 2, 1)$。\n    *   事件后，风险集中的人数变为 $6 - 2 = 4$。\n\n*   **第五个事件时间, $t_5 = 11$:**\n    *   风险集：在时间区间 $[9, 11)$ 内，有1名受试者在时间10被删失。因此，在时间11之前瞬间，风险集大小为 $Y_5 = 4 - 1 = 3$。\n    *   事件数：在时间11，有1名受试者发生事件，所以 $d_5 = 1$。\n    *   区间内删失数：在时间区间 $[9, 11)$ 内被删失的人数为 $c_5 = 1$（在时间10）。\n    *   三元组为 $(3, 1, 1)$。\n\n**汇总结果:**\n将所有三元组按事件时间顺序排列成矩阵形式，得到最终答案。", "answer": "$$\\boxed{\\begin{pmatrix}\n15   2   0 \\\\\n12   1   1 \\\\\n10   3   1 \\\\\n6   2   1 \\\\\n3   1   1\n\\end{pmatrix}}$$", "id": "1961488"}, {"introduction": "掌握了数据汇总的方法后，我们现在来实践Kaplan-Meier估计的核心计算。本练习将带你一步步应用乘积极限公式，计算在特定事件时间点的生存概率估计值 $\\hat{S}(t)$。通过这个练习，你将深入理解生存曲线是如何在每个事件发生时，通过更新风险集和条件生存概率而逐步构建起来的 [@problem_id:1961438]。", "problem": "一个材料科学研究小组正在测试一种新型可生物降解电子元件的耐久性。共有8个元件接受了加速老化测试。一个“事件”被定义为元件发生故障。由于测试设备的限制，一些测试在元件发生故障前就停止了；这些观测值被认为是“删失”的。该研究记录了以下数据，其中每一对代表（时间（小时），状态），状态'1'表示发生故障，状态'0'表示在该时间观测值被删失：\n\n(15, 1), (25, 1), (40, 1), (30, 0), (50, 1), (35, 0), (55, 0), (20, 1)\n\n计算在该研究中第二次观测到故障事件发生的确切时间点的生存函数Kaplan-Meier估计值 $\\hat{S}(t)$。将你的答案表示为保留三位有效数字的小数。", "solution": "该问题要求计算在特定时间点生存函数的Kaplan-Meier估计值 $\\hat{S}(t)$。Kaplan-Meier估计量是一种非参数统计量，用于从可能包含删失的寿命数据中估计生存函数。该估计量的公式是乘积限公式：\n$$ \\hat{S}(t) = \\prod_{i: t_i \\le t} \\left( 1 - \\frac{d_i}{n_i} \\right) $$\n其中 $t_i$ 是事件（故障）发生的离散时间点，$d_i$ 是在时间 $t_i$ 发生的事件数，而 $n_i$ 是在时间 $t_i$ 之前处于风险中的个体数（即仍在观察中且尚未发生故障的元件数）。\n\n首先，我们必须按时间顺序整理数据。数据集包含8个元件及其事件/删失时间：(15, 1), (25, 1), (40, 1), (30, 0), (50, 1), (35, 0), (55, 0), (20, 1)。按时间排序后得到：\n\n1.  时间 15: 故障 (事件)\n2.  时间 20: 故障 (事件)\n3.  时间 25: 故障 (事件)\n4.  时间 30: 删失\n5.  时间 35: 删失\n6.  时间 40: 故障 (事件)\n7.  时间 50: 故障 (事件)\n8.  时间 55: 删失\n\n问题要求计算在*第二次观测到故障事件*发生时的估计值 $\\hat{S}(t)$。从排序后的列表中，第一次故障事件发生在 $t=15$ 小时，第二次故障事件发生在 $t=20$ 小时。因此，我们需要计算 $\\hat{S}(20)$。\n\n计算过程涉及对所有直至并包括 $t=20$ 的离散事件时间进行乘积。相关的事件时间是 $t_1 = 15$ 和 $t_2 = 20$。\n\n在研究开始时，即 $t=0$ 时，所有8个元件都处于风险中。\n\n**步骤1：计算在 $t_1 = 15$ 时第一次事件的生存因子。**\n- 在 $t=15$ 之前处于风险中的元件数是 $n_1 = 8$。\n- 在 $t=15$ 时的故障数是 $d_1 = 1$。\n- 此次事件后的生存概率估计值被计算出来。此步骤的因子是 $\\left(1 - \\frac{d_1}{n_1}\\right) = \\left(1 - \\frac{1}{8}\\right) = \\frac{7}{8}$。\n- 对于区间 $[15, 20)$ 内的任何时间 $t$，Kaplan-Meier估计值为 $\\hat{S}(t) = \\frac{7}{8}$。\n\n**步骤2：计算在 $t_2 = 20$ 时第二次事件的生存因子。**\n- 要计算在 $t=20$ 之前处于风险中的元件数，我们从上一个事件之前处于风险中的数量（$n_1=8$）开始，并减去在该时间与当前时间之间发生事件或被删失的所有个体。一个元件在 $t=15$ 时发生故障。在 $t=15$ 和 $t=20$ 之间没有元件被删失。\n- 所以，在 $t=20$ 之前处于风险中的元件数是 $n_2 = 8 - 1 = 7$。\n- 在 $t=20$ 时的故障数是 $d_2 = 1$。\n- 此步骤的因子是 $\\left(1 - \\frac{d_2}{n_2}\\right) = \\left(1 - \\frac{1}{7}\\right) = \\frac{6}{7}$。\n\n**步骤3：结合这些因子求得 $\\hat{S}(20)$。**\nKaplan-Meier估计量在 $t=20$ 时的值是所有在此时间或之前发生的事件的生存因子的乘积。\n$$ \\hat{S}(20) = \\prod_{i: t_i \\le 20} \\left( 1 - \\frac{d_i}{n_i} \\right) = \\left(1 - \\frac{d_1}{n_1}\\right) \\times \\left(1 - \\frac{d_2}{n_2}\\right) $$\n$$ \\hat{S}(20) = \\left(\\frac{7}{8}\\right) \\times \\left(\\frac{6}{7}\\right) $$\n'7' 项相互抵消：\n$$ \\hat{S}(20) = \\frac{6}{8} = \\frac{3}{4} $$\n换算成小数，即为 $0.75$。\n\n问题要求答案保留三位有效数字。为了将 $0.75$ 表示为三位有效数字，我们在末尾加一个零。\n\n因此，Kaplan-Meier估计值为 $0.750$。", "answer": "$$\\boxed{0.750}$$", "id": "1961438"}, {"introduction": "理论的深刻理解往往来自于对边界情况的探索。本练习提出了一个思想实验：如果在一个研究中没有观察到任何事件，所有观测数据都被删失，Kaplan-Meier生存曲线会是什么样子？通过分析这个极端场景，你将揭示Kaplan-Meier估计的一个重要理论限制，即当最大观测时间点是删失数据时，生存函数在该时间点之后的估计是未定义的 [@problem_id:1961416]。", "problem": "为评估一种新型工业级灯泡的失效时间，进行了一项小规模的初步研究。安装了十个灯泡并进行持续监测。研究方案规定了最长3000小时的观察期，之后研究终止。在3000小时的节点，所有十个灯泡仍在正常工作。因此，所得数据集包含十个右删失观测值，均在3000小时。\n\n生存函数 $S(t)$ 表示一个灯泡的寿命 $T$ 超过给定时间 $t$ 的概率。该函数的非参数估计通过 Kaplan-Meier (KM) 估计量（记为 $\\hat{S}(t)$）获得。根据 KM 估计量的严格数学定义，在时间 $t = 3500$ 小时，$\\hat{S}(t)$ 的值或状态是什么？\n\nA. 估计量未定义。\n\nB. 值恰好为 0。\n\nC. 值恰好为 1。\n\nD. 值恰好为 0.5。\n\nE. 值等于 $\\exp(-1)$。", "solution": "我们有一个右删失样本，没有观测到失效事件：所有十个灯泡都在时间 $c=3000$ 时被删失。设 $n=10$。Kaplan-Meier (KM) 估计量使用不同的观测失效时间 $\\{t_{(j)}\\}$ 来定义，其中 $d_{j}$ 是在 $t_{(j)}$ 时的失效数，$n_{j}$ 是在 $t_{(j)}$ 之前处于风险中的个体数，其定义为\n$$\n\\hat{S}(t)=\\prod_{t_{(j)}\\le t}\\left(1-\\frac{d_{j}}{n_{j}}\\right).\n$$\n在这个数据集中，没有失效事件，因此失效时间的集合是空的。因此，对于任何严格小于仍在观察的最大观测时间 $t$（此处为 $t  3000$），乘积是基于空集的，因此等于 1，所以对于 $t  3000$，我们有 $\\hat{S}(t)=1$。\n\n然而，根据 KM 估计量作为右删失下生存函数的非参数最大似然估计 (NPMLE) 的严格定义，该估计量只在最大观测失效时间之前是可识别的。如果最大的观测值是删失的（如此处），那么估计量在该时间点之后是未定义的。这可以从似然函数中看出：当所有观测值都在 3000 时被删失，似然函数为\n$$\nL(S)=\\prod_{i=1}^{n} S(3000)=\\left[S(3000)\\right]^{n},\n$$\n这对 $t > 3000$ 时的 $S(t)$ 值除了单调性和右连续性之外没有施加任何约束。因此，NPMLE（也就是 KM 估计量）对于 $t > 3000$ 不是唯一的，并且在严格意义上，在该区域是未定义的。\n\n因此，在 $t=3500 > 3000$ 时，$\\hat{S}(t)$ 是未定义的。\n\n因此，正确选项是 A。", "answer": "$$\\boxed{A}$$", "id": "1961416"}]}