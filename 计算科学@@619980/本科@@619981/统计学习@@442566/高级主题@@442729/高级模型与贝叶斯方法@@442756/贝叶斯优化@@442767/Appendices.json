{"hands_on_practices": [{"introduction": "贝叶斯优化的核心在于平衡“探索”（Exploration）未知区域和“利用”（Exploitation）已知的高性能区域。上置信界（UCB）采集函数为此提供了一种直观且有效的方法。通过这个练习，你将亲手计算不同候选点的 UCB 值，从而理解模型预测的均值 $\\mu(x)$（利用）和标准差 $\\sigma(x)$（探索）如何共同指导模型寻找最优解 [@problem_id:2156656]。", "problem": "一位数据科学家正在使用带有高斯过程代理模型的贝叶斯优化来为一个机器学习模型调整超参数 $\\lambda$。其目标是最大化模型的验证准确率。经过一组初始评估后，代理模型为 $\\lambda$ 的五个候选值提供了以下后验统计量（平均准确率 $\\mu$ 和准确率的标准差 $\\sigma$）：\n\n*   点 A：$\\lambda = 0.10$，平均准确率 $\\mu = 0.915$，标准差 $\\sigma = 0.010$\n*   点 B：$\\lambda = 0.25$，平均准确率 $\\mu = 0.920$，标准差 $\\sigma = 0.005$\n*   点 C：$\\lambda = 0.50$，平均准确率 $\\mu = 0.890$，标准差 $\\sigma = 0.025$\n*   点 D：$\\lambda = 0.75$，平均准确率 $\\mu = 0.910$，标准差 $\\sigma = 0.014$\n*   点 E：$\\lambda = 0.90$，平均准确率 $\\mu = 0.905$，标准差 $\\sigma = 0.018$\n\n该数据科学家正在使用上置信界（UCB）采集函数来决定下一步要评估哪个 $\\lambda$ 值。UCB 策略定义为选择使量 $A(x) = \\mu(x) + \\kappa \\sigma(x)$ 最大化的点 $x$。对于此优化步骤，探索-利用权衡参数设置为 $\\kappa = 2.5$。\n\n根据 UCB 采集函数，下一个评估将选择五个候选点中的哪一个？\n\nA. 点 A\n\nB. 点 B\n\nC. 点 C\n\nD. 点 D\n\nE. 点 E", "solution": "我们使用上置信界（UCB）采集函数，它选择使 $A(x) = \\mu(x) + \\kappa \\sigma(x)$ 最大化的点 $x$。在这里，$\\kappa = 2.5$。对于每个候选点：\n\n对于点 A：\n$$A(\\text{A}) = 0.915 + 2.5 \\times 0.010 = 0.915 + 0.025 = 0.940.$$\n\n对于点 B：\n$$A(\\text{B}) = 0.920 + 2.5 \\times 0.005 = 0.920 + 0.0125 = 0.9325.$$\n\n对于点 C：\n$$A(\\text{C}) = 0.890 + 2.5 \\times 0.025 = 0.890 + 0.0625 = 0.9525.$$\n\n对于点 D：\n$$A(\\text{D}) = 0.910 + 2.5 \\times 0.014 = 0.910 + 0.035 = 0.945.$$\n\n对于点 E：\n$$A(\\text{E}) = 0.905 + 2.5 \\times 0.018 = 0.905 + 0.045 = 0.950.$$\n\n比较这些采集值，最大值为 $0.9525$，在点 C 处取得。因此，UCB 策略选择点 C。", "answer": "$$\\boxed{C}$$", "id": "2156656"}, {"introduction": "除了 UCB，预期增益（EI）是另一种强大且广泛应用的采集函数。EI 从决策理论的角度出发，计算采样一个新点预期能带来的目标函数值的增益，它综合考虑了根据模型后验分布所有可能的结果。本练习将指导你完成 EI 的计算，让你深入理解贝叶斯优化是如何量化信息价值，并做出更精细的决策 [@problem_id:2156694]。", "problem": "一位材料科学家正在使用贝叶斯优化框架来寻找能最大化一种新合金拉伸强度的最优退火温度 $x$。拉伸强度 $f(x)$ 以兆帕 (MPa) 为单位进行测量。函数 $f(x)$ 的评估成本很高，因此使用高斯过程模型来指导对最优值的搜索。\n\n经过几次实验，目前观测到的最高拉伸强度为 $f(x^+) = 350$ MPa。\n\n该科学家正在考虑一个新的、尚未评估的温度 $x_{new}$。模型预测，在这个新温度下的拉伸强度 $f(x_{new})$ 将服从均值为 $\\mu(x_{new}) = 360$ MPa、标准差为 $\\sigma(x_{new}) = 8$ MPa 的高斯（正态）分布。\n\n为了决定评估 $x_{new}$ 是否值得，该科学家计算了期望提升 (Expected Improvement, EI)。该指标表示相对于当前最佳观测值的改进的期望值，其中改进定义为 $\\max(0, f(x_{new}) - f(x^+))$。\n\n计算候选温度 $x_{new}$ 的期望提升。\n\n为帮助您计算，现给出与标准正态分布（均值为0，方差为1）相关的以下值。设 $\\phi(z)$ 为其概率密度函数，$\\Phi(z)$ 为其累积分布函数。对于 $z=1.25$，其值约为 $\\phi(1.25) = 0.1826$ 和 $\\Phi(1.25) = 0.8944$。\n\n请将最终答案以 MPa 为单位表示，并四舍五入到三位有效数字。", "solution": "我们要最大化拉伸强度，因此在 $x_{new}$ 处的改进定义为 $I=\\max\\{0, f(x_{new})-f(x^{+})\\}$，其中 $f(x_{new}) \\sim \\mathcal{N}(\\mu(x_{new}), \\sigma^{2}(x_{new}))$。期望提升 (EI) 为\n$$\n\\operatorname{EI}(x_{new})=\\mathbb{E}[I]=\\int_{f(x^{+})}^{\\infty} (y-f(x^{+})) \\frac{1}{\\sigma(x_{new})}\\,\\phi\\!\\left(\\frac{y-\\mu(x_{new})}{\\sigma(x_{new})}\\right)\\,dy.\n$$\n令 $\\mu=\\mu(x_{new})$，$\\sigma=\\sigma(x_{new})$，以及 $f^{+}=f(x^{+})$。进行换元，令 $t=(y-\\mu)/\\sigma$，则 $y=\\mu+\\sigma t$ 且 $dy=\\sigma\\,dt$。积分下限 $y=f^{+}$ 对应于 $t=(f^{+}-\\mu)/\\sigma$。于是\n$$\n\\operatorname{EI}=\\int_{(f^{+}-\\mu)/\\sigma}^{\\infty} \\left((\\mu+\\sigma t)-f^{+}\\right)\\phi(t)\\,dt\n=(\\mu-f^{+})\\int_{a}^{\\infty}\\phi(t)\\,dt+\\sigma\\int_{a}^{\\infty} t\\phi(t)\\,dt,\n$$\n其中 $a=(f^{+}-\\mu)/\\sigma$。利用 $\\int_{a}^{\\infty}\\phi(t)\\,dt=\\Phi(-a)$ 和 $\\int_{a}^{\\infty} t\\phi(t)\\,dt=\\phi(a)$（因为 $\\frac{d}{dt}\\phi(t)=-t\\phi(t)$），并定义 $z=(\\mu-f^{+})/\\sigma=-a$，我们得到标准的 EI 公式\n$$\n\\operatorname{EI}=(\\mu-f^{+})\\Phi(z)+\\sigma\\,\\phi(z), \\quad z=\\frac{\\mu-f^{+}}{\\sigma}.\n$$\n对于给定的值，$\\mu=360$ MPa，$f^{+}=350$ MPa，以及 $\\sigma=8$ MPa，所以\n$$\nz=\\frac{360-350}{8}=\\frac{10}{8}=1.25.\n$$\n使用给定的标准正态分布值 $\\Phi(1.25)=0.8944$ 和 $\\phi(1.25)=0.1826$，计算\n$$\n(\\mu-f^{+})\\Phi(z)=10\\times 0.8944=8.944,\\qquad \\sigma\\,\\phi(z)=8\\times 0.1826=1.4608,\n$$\n因此\n$$\n\\operatorname{EI}=8.944+1.4608=10.4048 \\text{ MPa}.\n$$\n四舍五入到三位有效数字，得到 $10.4$ MPa。", "answer": "$$\\boxed{10.4}$$", "id": "2156694"}, {"introduction": "当优化过程（例如，实验预算耗尽）结束后，我们需要根据已有模型给出最终的最优参数建议。在处理带有噪声的真实世界问题时，我们必须区分单次带有随机性的观测值和模型对真实函数值的估计。这个练习将挑战你思考并决定，应将最佳观测值对应的输入，还是将后验均值最高点对应的输入作为最终推荐，这对于在实践中正确应用贝叶斯优化至关重要 [@problem_id:2156691]。", "problem": "一位材料科学家正在使用贝叶斯优化（BO）来寻找最佳固化温度 $x$，以最大化一种新型聚合物复合材料的拉伸强度 $f(x)$。拉伸强度的测量会受到实验噪声的影响。该科学家使用高斯过程（GP）对未知函数 $f(x)$ 进行建模。\n\n在进行了四次实验后，优化预算已经用尽。收集到的数据包括固化温度（单位：摄氏度）和对应的带噪声的拉伸强度测量值（单位：兆帕，MPa）。高斯过程模型为任意温度 $x$ 下的拉伸强度提供了一个后验均值 $\\mu(x)$ 和一个后验标准差 $\\sigma(x)$。\n\n四次实验的结果如下：\n\n| 实验 | 温度 $x$ ($^{\\circ}$C) | 观测强度 $y$ (MPa) | 后验均值 $\\mu(x)$ (MPa) | 后验标准差 $\\sigma(x)$ (MPa) |\n|------------|------------------------------|-------------------------------|---------------------------------|------------------------------------------|\n| 1          | 120                          | 315.4                         | 316.0                           | 1.8                                      |\n| 2          | 130                          | 325.1                         | 322.5                           | 1.7                                      |\n| 3          | 140                          | 324.8                         | 326.2                           | 1.9                                      |\n| 4          | 150                          | 320.7                         | 321.0                           | 2.5                                      |\n\n现在，这位科学家必须为该聚合物的批量生产推荐一个单一的最佳温度。根据以上数据，应该推荐哪个温度？其正确的理由是什么？\n\nA. 推荐 $140^{\\circ}$C，因为其对应的后验均值最高，这代表了模型在考虑所有数据并滤除噪声后，对真实最大强度的最佳估计。\n\nB. 推荐 $130^{\\circ}$C，因为它产生了直接观测到的最高拉伸强度，并且经验测量值比模型预测更值得信赖。\n\nC. 推荐 $150^{\\circ}$C，因为该温度下的高后验标准差表明，它具有最大的未探索潜力，可能产生比已观测到的更高的强度。\n\nD. 推荐 $130^{\\circ}$C，因为它与其他点相比后验标准差相对较低，这表明其较高的测量强度是一个可靠的结果。", "solution": "贝叶斯优化的目标是找到一个未知的、可能带有噪声的函数 $f(x)$ 的全局最优解。在这个问题中，需要最大化的函数是聚合物的拉伸强度，它是固化温度的函数。优化过程已经结束，最终任务不是进一步探索，而是利用已获得的知识来做出最佳推荐。这意味着我们必须确定最有可能产生真实、潜在函数 $f(x)$ 最大值的输入 $x$，而不仅仅是带噪声的最大观测值 $y$。\n\n让我们分析一下问题的各个组成部分：\n1.  **观测强度 ($y$)**：值 $y$ 是真实强度的带噪声测量值。一个特定的观测值由 $y_i = f(x_i) + \\epsilon_i$ 给出，其中 $\\epsilon_i$ 是一个随机噪声项。因此，在 $x = 130^{\\circ}$C 处观测到的最高值 $y = 325.1$ MPa，可能是一个中等偏高的真实强度与一个较大的正向噪声波动相结合的结果。仅仅依赖于单次最佳观测值是一个脆弱的策略，因为它忽略了数据的噪声特性。\n\n2.  **后验均值 ($\\mu(x)$)**：高斯过程（GP）模型根据观测数据提供了函数 $f(x)$ 的后验分布。后验均值 $\\mu(x)$ 代表了在输入 $x$ 处真实函数 $f(x)$ 的期望值。它是通过考虑*所有*数据点的影响来计算的，这些影响根据它们的接近程度和模型的相关性假设进行加权。因此，$\\mu(x)$ 可作为真实函数的去噪估计。为了最大化真实强度 $f(x)$，我们的最佳策略是选择能够最大化我们对 $f(x)$ 估计值的 $x$，而这个估计值正是后验均值 $\\mu(x)$。\n\n3.  **后验标准差 ($\\sigma(x)$)**：这个值量化了模型对其估计值 $\\mu(x)$ 的不确定性。在优化阶段（现已完成），高的不确定性对于探索是有价值的。例如，像上置信界限（UCB）这样的采集函数，定义为 $\\text{UCB}(x) = \\mu(x) + \\kappa \\sigma(x)$，在高均值区域的利用（exploit）和高不确定性区域的探索（explore）之间进行权衡。然而，一旦过程结束并且需要做出最终推荐，目标就是纯粹的利用。当需要做出最终的、单一的最佳选择时，仅仅因为一个点的不确定性高（探索）而选择它是不正确的。\n\n基于以上理解，我们来评估各个选项：\n-   **_选项 A_**：该选项建议选择 $x = 140^{\\circ}$C。查看表格，后验均值 $\\mu(140) = 326.2$ MPa 是 $\\mu(x)$ 列中的最大值。其理由是，后验均值是模型对真实函数的最佳估计，因为它已经滤除了噪声。这与贝叶斯优化中的利用（exploitation）原则完全一致。我们应该推荐模型认为是真实最优点的那一点。\n\n-   **_选项 B_**：该选项建议选择 $x = 130^{\\circ}$C，因为它产生了最高的观测值 $y = 325.1$ MPa。如前所述，这种做法忽略了噪声的影响。模型在该点的后验均值 $\\mu(130) = 322.5$ MPa 显著低于观测值，这表明模型将这个高读数部分归因于正向噪声。这个选择不是最优的。\n\n-   **_选项 C_**：该选项建议选择 $x = 150^{\\circ}$C，理由是其不确定性高（$\\sigma(150) = 2.5$ MPa）。这是一种探索（exploration）策略，而非利用（exploitation）策略。如果预算没有用尽，这是一个决定*下一个*采样点的有效考虑因素，但对于做出最终推荐，这不是正确的策略。目标不再是改进模型，而是使用当前模型做出最佳选择。\n\n-   **_选项 D_**：该选项建议选择 $x = 130^{\\circ}$C，但其理由是基于其低不确定性。虽然低不确定性意味着可靠性，但主要目标是最大化函数值。一个对次优值的高度可靠的估计，并不比一个对更优值稍微不可靠的估计更好。推荐应基于期望结果（$\\mu(x)$），而不仅仅是其确定性（$\\sigma(x)$）。点 $x = 140^{\\circ}$C 具有更高的期望结果 $\\mu(140) = 326.2$ MPa，尽管其不确定性比 $x=130^{\\circ} \\text{C}$ 略高，但这使其成为更好的选择。\n\n因此，正确的做法是相信模型的去噪估计，即后验均值，并选择使其最大化的输入。最高的后验均值是 $326.2$ MPa，对应于 $140^{\\circ}$C 的温度。", "answer": "$$\\boxed{A}$$", "id": "2156691"}]}