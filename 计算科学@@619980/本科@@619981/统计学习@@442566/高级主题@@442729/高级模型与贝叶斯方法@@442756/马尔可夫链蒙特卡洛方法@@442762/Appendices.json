{"hands_on_practices": [{"introduction": "我们从Metropolis算法的核心决策过程——接受概率——开始。这个简单的计算决定了马尔可夫链是移动到一个新的提议状态还是停留在原地，它也是确保链最终从目标分布中采样的关键。本练习 [@problem_id:1371728] 将帮助你巩固对这一基本机制的理解。", "problem": "一位数据科学家正在实现一个马尔可夫链蒙特卡洛（MCMC）模拟，以便从参数 $x$ 的后验概率分布中抽取样本。目标分布 $\\pi(x)$ 与该参数负绝对值的指数成正比，即 $\\pi(x) \\propto \\exp(-|x|)$。\n\n该科学家使用 Metropolis 算法，并采用对称提议分布 $q(x'|x)$，其中给定当前状态 $x$ 提议新状态 $x'$ 的概率等于给定 $x'$ 提议 $x$ 的概率（即 $q(x'|x) = q(x|x')$）。\n\n假设在模拟的某一步中，链的当前状态为 $x = 1.5$。然后，算法提议移动到一个新的候选状态 $x' = 2.0$。\n\n计算此特定移动的接受概率。你的答案应该是一个无量纲的实数。将最终答案四舍五入到四位有效数字。", "solution": "对于从 $x$ 到 $x'$ 的移动，在对称提议分布 $q(x'|x)=q(x|x')$ 下，Metropolis 接受概率为\n$$\n\\alpha(x \\to x')=\\min\\left(1,\\frac{\\pi(x')q(x|x')}{\\pi(x)q(x'|x)}\\right)=\\min\\left(1,\\frac{\\pi(x')}{\\pi(x)}\\right).\n$$\n给定目标分布 $\\pi(x)\\propto \\exp(-|x|)$，该比率可简化为\n$$\n\\frac{\\pi(x')}{\\pi(x)}=\\frac{\\exp(-|x'|)}{\\exp(-|x|)}=\\exp\\!\\left(-\\left(|x'|-|x|\\right)\\right).\n$$\n当 $x=1.5$ 且 $x'=2.0$ 时，我们有 $|x|=1.5$ 和 $|x'|=2.0$，因此\n$$\n\\frac{\\pi(x')}{\\pi(x)}=\\exp\\!\\left(-\\left(2.0-1.5\\right)\\right)=\\exp(-0.5).\n$$\n因此，\n$$\n\\alpha(x \\to x')=\\min\\left(1,\\exp(-0.5)\\right)=\\exp(-0.5).\n$$\n数值上，$\\exp(-0.5)\\approx 0.6065$（四舍五入到四位有效数字）。", "answer": "$$\\boxed{0.6065}$$", "id": "1371728"}, {"introduction": "MCMC采样器的效率在很大程度上取决于它如何探索状态空间，这一行为由提议分布所控制。选择一个好的提议步长是一个典型的“金发姑娘问题”：步长太小，采样器移动太慢；步长太大，它又几乎不动。本练习 [@problem_id:1932810] 旨在探讨调整这一关键参数时所涉及的概念性权衡。", "problem": "一位分析师正在使用马尔可夫链蒙特卡洛 (MCMC) 方法，特别是随机游走 Metropolis 算法，从定义在实数线上的一个连续、单峰的目标概率密度函数 $\\pi(x)$ 中生成样本。该算法的流程如下：给定链的当前状态为 $x^{(t)}$，从一个对称的提议分布 $q(x'|x^{(t)})$ 中提议一个新的候选状态 $x'$。在此具体实现中，提议是通过添加一个随机扰动生成的：$x' = x^{(t)} + \\epsilon$，其中 $\\epsilon$ 从均值为 0、标准差为 $\\sigma$ 的正态分布中抽取，即 $\\epsilon \\sim N(0, \\sigma^2)$。提议的状态 $x'$ 以概率 $\\alpha(x', x^{(t)}) = \\min\\left(1, \\frac{\\pi(x')}{\\pi(x^{(t)})}\\right)$ 被接受为下一个状态 $x^{(t+1)} = x'$。如果提议被拒绝，链将保持在当前状态，即 $x^{(t+1)} = x^{(t)}$。\n\n该分析师正在试验提议分布标准差的两种不同设置：\n1.  一个非常窄的提议分布，其中 $\\sigma = \\sigma_{small}$ 是一个非常小的正数。\n2.  一个非常宽的提议分布，其中 $\\sigma = \\sigma_{large}$ 是一个非常大的正数。\n\n假设链已在一个具有不可忽略概率的区域（例如，在 $\\pi(x)$ 的众数附近）被初始化。在这两种情况下，以下哪个陈述最准确地描述了 MCMC 链的预期行为？\n\nA. 窄提议 ($\\sigma_{small}$) 将导致低接受率和慢速探索。宽提议 ($\\sigma_{large}$) 将导致高接受率和快速探索。\n\nB. 两种提议宽度将导致相似的接受率，但使用宽提议 ($\\sigma_{large}$) 的链比使用窄提议 ($\\sigma_{small}$) 的链探索状态空间的速度要快得多。\n\nC. 窄提议 ($\\sigma_{small}$) 将导致非常高的接受率，但链将非常缓慢地探索状态空间。宽提议 ($\\sigma_{large}$) 将导致非常低的接受率，使链在多次迭代中停留在同一状态。\n\nD. 窄提议 ($\\sigma_{small}$) 将导致高接受率和快速探索。宽提议 ($\\sigma_{large}$) 将导致低接受率和慢速探索。\n\nE. 提议分布的宽度对算法性能的影响可以忽略不计；接受率和探索速度主要由目标分布 $\\pi(x)$ 的性质决定。", "solution": "问题要求我们分析随机游走 Metropolis 算法的行为，重点关注提议分布 $N(0, \\sigma^2)$ 的宽度（标准差 $\\sigma$）如何影响链的接受率及其探索目标分布 $\\pi(x)$ 状态空间的能力。\n\n从 $x^{(t)}$ 到 $x'$ 的提议移动的接受概率由 $\\alpha(x', x^{(t)}) = \\min\\left(1, \\frac{\\pi(x')}{\\pi(x^{(t)})}\\right)$ 给出。让我们分别分析这两种情况。\n\n**情况1：窄提议分布 ($\\sigma = \\sigma_{small}$)**\n\n当标准差 $\\sigma_{small}$ 非常小时，从 $N(0, \\sigma_{small}^2)$ 中抽取的随机扰动 $\\epsilon$ 的量级也会非常小。这意味着提议的状态 $x' = x^{(t)} + \\epsilon$ 将非常接近当前状态 $x^{(t)}$。\n\n由于目标分布 $\\pi(x)$ 是连续的，如果 $x'$ 非常接近 $x^{(t)}$，那么这两点的概率密度值 $\\pi(x')$ 和 $\\pi(x^{(t)})$ 将会非常相似。\n因此，比率 $\\frac{\\pi(x')}{\\pi(x^{(t)})}$ 将非常接近 1。\n\n接受概率为 $\\alpha(x', x^{(t)}) = \\min\\left(1, \\frac{\\pi(x')}{\\pi(x^{(t)})}\\right)$。由于该比率接近 1，接受概率 $\\alpha$ 将会非常高（接近 1）。这意味着几乎每一个提议的移动都会被接受。\n\n然而，由于每次接受的移动都只是离前一个位置迈出了一小步，链在状态空间中的移动非常缓慢。这是一种低效的探索目标分布 $\\pi(x)$ 全范围（尤其是尾部）的方式。链表现出高自相关性，意味着连续的样本高度依赖，需要非常多次迭代才能获得一组具有代表性的独立样本。这构成了非常缓慢的探索。\n\n**情况2：宽提议分布 ($\\sigma = \\sigma_{large}$)**\n\n当标准差 $\\sigma_{large}$ 非常大时，随机扰动 $\\epsilon$ 的量级通常会很大。这意味着提议的状态 $x' = x^{(t)} + \\epsilon$ 很可能离当前状态 $x^{(t)}$ 非常远。\n\n题目给定目标分布 $\\pi(x)$ 是单峰的，且链从一个高概率区域（众数附近）开始。当链处于这样一个区域时，$\\pi(x^{(t)})$ 相对较大。从 $x^{(t)}$ 进行一次大跳跃很可能落到分布尾部很远的区域，那里的概率密度极低。因此，$\\pi(x') \\ll \\pi(x^{(t)})$ 的可能性非常高。\n\n在这种情况下，比率 $\\frac{\\pi(x')}{\\pi(x^{(t)})}$ 将非常接近 0。\n\n接受概率为 $\\alpha(x', x^{(t)}) = \\min\\left(1, \\frac{\\pi(x')}{\\pi(x^{(t)})}\\right)$。由于该比率非常小，接受概率 $\\alpha$ 也将非常小。这意味着绝大多数提议的移动都会被拒绝。\n\n当一个提议被拒绝时，链不会移动：$x^{(t+1)} = x^{(t)}$。因此，对于宽提议分布，链将在许多连续的迭代中停留在同一状态，等待一个罕见的、恰好落入另一个高概率区域的提议。这也是一种非常低效的状态空间探索方式。\n\n**结论与选项评估：**\n\n-   窄提议导致**高接受率**但**慢速探索**。\n-   宽提议导致**低接受率**和**慢速探索**（因为链被卡住了）。\n\n让我们基于此分析评估给定的选项：\n\n-   **A：**不正确。它声称宽提议导致高接受率。\n-   **B：**不正确。它声称两者接受率相似。\n-   **C：**该陈述正确地捕捉了两种行为。窄提议导致高接受率但慢速探索。宽提议导致非常低的接受率，使链被卡住。这是最准确的描述。\n-   **D：**不正确。它声称窄提议导致快速探索。\n-   **E：**不正确。提议分布的宽度是一个关键的调整参数，它深刻地影响算法的性能。\n\n因此，最准确的陈述是 C。", "answer": "$$\\boxed{C}$$", "id": "1932810"}, {"introduction": "虽然功能强大，但简单的MCMC算法有其众所周知的局限性。其中一个最重大的挑战出现在目标分布具有多个分离良好的峰（模态）时。本练习 [@problem_id:1932795] 将展示一个标准的随机游走采样器在这种情况下会如何失效，从而只提供了目标分布的不完整图像，并强调了仔细进行诊断的必要性。", "problem": "一位数据科学家正在使用马尔可夫链蒙特卡洛 (MCMC) 方法从一个复杂的一维目标概率密度函数 $\\pi(x)$ 中抽取样本。已知目标分布是一个对称双峰分布，具体是两个高斯分布的等权重混合。该密度与两个高斯概率密度函数之和成正比：\n$$ \\pi(x) \\propto \\exp\\left(-\\frac{(x - \\mu_A)^2}{2\\sigma_{mode}^2}\\right) + \\exp\\left(-\\frac{(x - \\mu_B)^2}{2\\sigma_{mode}^2}\\right) $$\n参数给定为 $\\mu_A = -10$，$\\mu_B = 10$ 和 $\\sigma_{mode} = 1$。这种结构导致在 $x=-10$ 和 $x=10$ 处出现两个狭窄且分离良好的概率模态，它们之间有一个概率密度极低的区域。\n\n该科学家使用随机游走 Metropolis 算法。在每一步中，从以当前状态 $x_t$ 为中心的高斯分布中提议一个新状态 $x'$，即 $x' \\sim N(x_t, \\sigma_{step}^2)$。为了获得高接受率，科学家选择了一个非常小的步长方差，设置 $\\sigma_{step} = 0.1$。MCMC 链在其中一个模态的峰值处初始化，即 $x_0 = -10$，并运行 $N=10^6$ 次迭代。\n\n以下哪个陈述最准确地描述了 MCMC 采样器的行为以及所得样本集 $\\{x_1, x_2, \\dots, x_N\\}$ 的统计特性？\n\nA. 样本将分布在目标分布的真实均值 $x=0$ 附近。样本均值将接近 0，但样本方差会很大（大于 100），准确反映了两个模态之间的显著分离。\n\nB. 提议移动的接受率将非常低（接近 0），因为步长没有很好地适应目标分布的整体尺度。链将保持在其初始位置 $x_0 = -10$ 或非常接近该位置。\n\nC. 提议移动的接受率将非常高（接近 1）。生成的样本将彻底探索对应于 $x=-10$ 处模态的区域，但链将无法转换到 $x=10$ 处的另一个模态。样本均值将约为 $-10$。\n\nD. 采样器将有效地探索整个状态空间。链将在两个模态之间频繁地来回跳跃，样本的直方图将正确地形成以 $x=-10$ 和 $x=10$ 为中心的两个不同峰值。\n\nE. 采样器将表现得像一个简单的随机游走，导致样本从起始点扩散开。最终的样本集合将在以 $x=-10$ 为中心的宽区间上近似均匀分布。", "solution": "我们将目标建模为两个具有共同标准差 $\\sigma_{mode}$ 和均值 $\\mu_{A}$、$\\mu_{B}$ 的高斯密度的等权重混合。在不考虑比例常数的情况下，\n$$\n\\pi(x) \\propto \\exp\\!\\left(-\\frac{(x-\\mu_{A})^{2}}{2\\sigma_{mode}^{2}}\\right) + \\exp\\!\\left(-\\frac{(x-\\mu_{B})^{2}}{2\\sigma_{mode}^{2}}\\right).\n$$\n对于使用对称高斯提议 $q(x' \\mid x)=\\mathcal{N}(x,\\sigma_{step}^{2})$ 的随机游走 Metropolis 采样器，在状态 $x_{t}$ 对提议 $x'$ 的 Metropolis–Hastings 接受概率为\n$$\n\\alpha(x_{t},x')=\\min\\!\\left(1,\\frac{\\pi(x')}{\\pi(x_{t})}\\right).\n$$\n\n在 $x_{0}=\\mu_{A}$ 处初始化。由于模态是良好分离的，当 $x$ 接近 $\\mu_{A}$ 时，$\\pi(x)$ 中来自 $\\mu_{B}$ 分量的贡献相对于来自 $\\mu_{A}$ 分量的贡献可以忽略不计。对于一个小的提议增量 $\\epsilon:=x'-x$ 且 $|\\epsilon| \\ll \\sigma_{mode}$，主导比率近似给出\n$$\n\\frac{\\pi(x')}{\\pi(x)} \\approx \\frac{\\exp\\!\\left(-\\frac{(x'+\\!-\\mu_{A})^{2}}{2\\sigma_{mode}^{2}}\\right)}{\\exp\\!\\left(-\\frac{(x-\\mu_{A})^{2}}{2\\sigma_{mode}^{2}}\\right)}=\\exp\\!\\left(-\\frac{(x'-\\mu_{A})^{2}-(x-\\mu_{A})^{2}}{2\\sigma_{mode}^{2}}\\right).\n$$\n在 $x\\approx\\mu_{A}$ 处，对于小的 $\\epsilon$，这可以简化为\n$$\n\\frac{\\pi(x')}{\\pi(x)} \\approx \\exp\\!\\left(-\\frac{\\epsilon^{2}}{2\\sigma_{mode}^{2}}\\right),\n$$\n因此，当 $\\sigma_{step} \\ll \\sigma_{mode}$ 时，接受概率接近 1，因为典型的 $|\\epsilon|$ 与 $\\sigma_{step}$ 是同一数量级。因此，当链在起始模态的邻域进行探索时，接受率非常高。\n\n在一次提议中，从 $\\mu_{A}$ 的邻域直接跳跃到 $\\mu_{B}$ 的邻域需要一个量级为 $|\\mu_{B}-\\mu_{A}|$ 的位移。在一个方差为 $\\sigma_{step}^{2}$ 的高斯提议下，这样一次跳跃的概率量级为\n$$\n\\exp\\!\\left(-\\frac{(\\mu_{B}-\\mu_{A})^{2}}{2\\sigma_{step}^{2}}\\right),\n$$\n当 $|\\mu_{B}-\\mu_{A}| \\gg \\sigma_{step}$ 时，这个概率是可以忽略的。\n\n通过许多小的被接受的步来穿过低密度区域，在有限的运行次数内也是极不可能的，因为谷中的平稳密度比峰值处的平稳密度要小指数级别。在中点 $x^{\\star}=(\\mu_{A}+\\mu_{B})/2$ 处，目标密度为\n$$\n\\pi(x^{\\star}) \\propto 2\\exp\\!\\left(-\\frac{(\\mu_{B}-\\mu_{A})^{2}}{8\\sigma_{mode}^{2}}\\right),\n$$\n而在 $x=\\mu_{A}$ 附近，密度为 $\\pi(\\mu_{A}) \\propto 1$（另一个分量在此处可以忽略不计）。因此，比率为\n$$\n\\frac{\\pi(x^{\\star})}{\\pi(\\mu_{A})} \\approx 2\\exp\\!\\left(-\\frac{(\\mu_{B}-\\mu_{A})^{2}}{8\\sigma_{mode}^{2}}\\right)\n$$\n当 $|\\mu_{B}-\\mu_{A}| \\gg \\sigma_{mode}$ 时，该比率是指数级小的。这意味着到达谷底或另一个模态的期望时间是指数级大的，量级为该比率的倒数，当分离很大且提议非常局部时，这个时间远超给定的 $N$。\n\n因此，当选择的 $\\sigma_{step}$ 相对于 $\\sigma_{mode}$ 非常小，并且模态良好分离时，链具有非常高的接受率，能够彻底探索起始模态 $x=\\mu_{A}$ 周围的局部盆地，在运行期间基本上从不转换到另一个模态，并产生一个约等于 $\\mu_{A}$ 的样本均值。在这些选项中，这对应于陈述 C。", "answer": "$$\\boxed{C}$$", "id": "1932795"}]}