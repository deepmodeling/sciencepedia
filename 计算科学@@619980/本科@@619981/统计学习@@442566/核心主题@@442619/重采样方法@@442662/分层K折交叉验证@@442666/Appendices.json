{"hands_on_practices": [{"introduction": "在应用分层 k 折交叉验证时，一个首要的实践问题是如何选择折数 $k$。这个选择并非越大越好，因为它需要在统计性能和计算成本之间进行权衡。本练习将指导你通过一个实际的优化问题，学习如何在给定的计算资源预算下，选择一个最优的 $k$ 值以最小化模型评估结果的方差 [@problem_id:3177490]。", "problem": "考虑一个总样本量为 $n=1200$ 的二分类数据集，其中包含一个拥有 $n_{+}=900$ 个样本的多数类和一个拥有 $n_{-}=300$ 个样本的少数类。您计划使用分层 $k$ 折交叉验证 (CV) 来评估一个固定的分类器，其中各折保持了总体的类别比例。令分层 $k$ 折交叉验证的风险估计量为 $\\hat{R}_{\\mathrm{CV}}(k)$，其定义为 $k$ 个留存折风险的算术平均值。\n\n假设以下建模和计算方面的事实是通过先前的测量和标准缩放确立的：\n- 风险估计量的方差服从参数模型 $V(k)\\approx \\frac{a}{k}+b$，其中常数 $a0$ 和 $b\\ge 0$ 概括了依赖于数据和模型的变异性。一项初步研究得出 $a=0.6$ 和 $b=0.01$。\n- 分类器的训练运行时间与训练样本数量 $m$ 呈线性关系，即每折的训练时间为 $t(m)=c\\,m$，其中 $c0$ 是一个常数。在大小为 $n=1200$ 的完整训练集上进行的一次初步拟合耗时 $60$ 秒，这意味着 $c=\\frac{60}{1200}$ 秒/样本。\n- 分层 $k$ 折交叉验证的总运行时间主要由模型拟合决定，并由公式 $T(k)=k\\,t((1-\\frac{1}{k})\\,n)=c\\,n\\,(k-1)$ 给出。\n- 运行时间预算为 $T_{\\max}=220$ 秒。\n\n在分层 $k$ 折交叉验证中，为确保每折的测试集至少包含来自每个类别的一个样本，并且在不产生空层的情况下保持类别比例，您必须满足分层可行性界限 $k\\le \\min\\{n_{+},n_{-}\\}$。\n\n请仅使用 $\\hat{R}_{\\mathrm{CV}}(k)$ 作为 $k$ 个留存风险平均值的定义、给定的方差模型 $V(k)$ 以及线性时间的训练规模关系，推导出在约束条件 $T(k)\\le T_{\\max}$ 和分层可行性下最小化 $V(k)$ 的整数 $k^{*}$。将 $k^{*}$ 作为单个整数报告。除了整数性所要求的取整外，不需要进行其他舍入。此外，通过说明多数类和少数类在每折测试集中的样本数量，来验证您选择的 $k^{*}$ 允许进行分层划分（不要将这些验证值包含在最终答案中）。", "solution": "我们从分层 $k$ 折交叉验证 (CV) 的定义开始：CV 风险估计量 $\\hat{R}_{\\mathrm{CV}}(k)$ 是 $k$ 个留存折风险的平均值，每个风险都是在大小为 $\\frac{n}{k}$ 且类别比例得以保持的测试集上计算的。根据大数定律，对 $k$ 个逐折估计值求平均可以减少变异性；与这一基本行为一致，给定的模型 $V(k)\\approx \\frac{a}{k}+b$ 捕捉了随着 $k$ 增加方差减小的趋势，以及由于模型不稳定性或数据异质性等不可约来源导致的非零下限 $b$。\n\n接下来，我们使用线性运行时间规模关系来刻画计算可行性。在 $m$ 个样本上的每折训练时间为 $t(m)=c\\,m$。初步测量提供了在 $n=1200$ 时 $t(n)=60$ 秒的校准值，因此\n$$\nc=\\frac{t(n)}{n}=\\frac{60}{1200}=0.05.\n$$\n在 $k$ 折交叉验证中，$k$ 次拟合中的每一次都使用 $(1-\\frac{1}{k})\\,n$ 个训练样本。因此，总运行时间为\n$$\nT(k)=k\\,t\\!\\left(\\left(1-\\frac{1}{k}\\right)n\\right)=k\\,c\\,\\left(1-\\frac{1}{k}\\right)n=c\\,n\\,(k-1).\n$$\n代入 $c=0.05$ 和 $n=1200$，我们得到\n$$\nT(k)=0.05\\times 1200 \\times (k-1)=60\\,(k-1).\n$$\n运行时间预算为 $T_{\\max}=220$，因此可行性条件 $T(k)\\le T_{\\max}$ 变为\n$$\n60\\,(k-1)\\le 220 \\quad \\Longrightarrow \\quad k-1\\le \\frac{220}{60}=\\frac{11}{3} \\quad \\Longrightarrow \\quad k\\le 1+\\frac{11}{3}=\\frac{14}{3}.\n$$\n由于 $k$ 必须是整数，运行时间允许的最大 $k$ 值为\n$$\nk\\le \\left\\lfloor \\frac{14}{3}\\right\\rfloor = 4.\n$$\n\n分层可行性进一步要求每个测试集至少包含来自每个类别的一个样本。一个充分条件是 $k\\le \\min\\{n_{+},n_{-}\\}$，在此即为\n$$\nk\\le \\min\\{900,300\\}=300.\n$$\n这个界限远比运行时间界限 $k\\le 4$ 宽松，因此起作用的约束是计算约束。\n\n为了在约束条件下最小化 $V(k)=\\frac{a}{k}+b$，我们利用单调性：对于 $a0$，$V(k)$ 是关于 $k$ 的严格递减函数，而 $b$ 不依赖于 $k$。因此，在约束条件下，最小值在可行的最大 $k$ 值处取得。综合各个界限，可行的最大 $k$ 值为\n$$\nk^{*}=4.\n$$\n\n最后，我们用 $k^{*}=4$ 来验证分层可行性。每个测试集的大小为 $\\frac{n}{k^{*}}=\\frac{1200}{4}=300$。保持类别比例可以得到每折的测试样本数量：\n$$\n\\text{多数类}:\\ \\frac{n_{+}}{k^{*}}=\\frac{900}{4}=225, \\qquad \\text{少数类}:\\ \\frac{n_{-}}{k^{*}}=\\frac{300}{4}=75,\n$$\n这些都是整数且为正数，因此分层折是可行的。由于 $V(k)$ 是 $k$ 的递减函数，且 $k^{*}=4$ 是运行时间预算允许的最大 $k$ 值，因此 $k^{*}=4$ 是在所述约束下使 $V(k)$ 最小化的值。", "answer": "$$\\boxed{4}$$", "id": "3177490"}, {"introduction": "选择了合适的折数 $k$ 之后，我们必须确保数据集的结构能够支持有效的分层。本练习探讨了一个核心的实际问题：对于一个给定的类别，需要多少样本才能保证在每一折中都能计算出有意义的性能指标（如召回率和精确率）[@problem_id:3177513]。这个问题揭示了在处理类别不平衡的数据集时进行稳健评估的一个关键先决条件，并介绍了在样本不足时如何使用平滑技术来修正指标。", "problem": "一个多类别分类任务的数据集包含一个特定的类别，标记为 $c$，其总数为 $n_c$。你计划使用分层 $k$ 折交叉验证来评估一个分类器，其中每一折使用一个分层分割作为验证集，剩下的 $k-1$ 个分割作为训练集。分层意味着每一折的验证集会接收到 $\\lfloor n_c/k \\rfloor$ 或 $\\lceil n_c/k \\rceil$ 个类别 $c$ 的实例，而相应的训练集则接收到类别 $c$ 的互补数量。\n\n在验证折上计算的类别 $c$ 的逐类召回率由混淆矩阵条目定义为 $\\mathrm{Recall}_c = \\frac{\\mathrm{TP}_c}{\\mathrm{TP}_c + \\mathrm{FN}_c}$，其中 $\\mathrm{TP}_c$ 和 $\\mathrm{FN}_c$ 分别表示在该折的验证集中类别 $c$ 的真正例和假负例的数量。逐类精确率定义为 $\\mathrm{Precision}_c = \\frac{\\mathrm{TP}_c}{\\mathrm{TP}_c + \\mathrm{FP}_c}$，其中 $\\mathrm{FP}_c$ 表示在该验证集中类别 $c$ 的假正例的数量。如果某个指标的分母为 $0$，则该指标在该折中是未定义的。\n\n仅从上述定义和分层 $k$ 折分配规则出发，推导出一个关于 $n_c$（作为 $k$ 的函数）的保守的最小逐类支持度要求，该要求能保证在每一折的验证集中，类别 $c$ 的实际支持度严格为正（从而召回率的分母严格为正），同时确保该折对应的训练集至少包含一个类别 $c$ 的实例。为消除取整的边界情况，施加一个更强的要求，即每个验证折必须至少包含 $2$ 个类别 $c$ 的实例。\n\n然后，对于 $n_c  2k$ 的情况，提出一种加性拉普拉斯平滑方案，使得无论计数值是否为零，逐类精确率和召回率在每一折中都有良好定义。具体来说，将一个对称的加性常数 $\\alpha  0$ 应用于验证集中类别 $c$ 的“一对多”分解的混淆矩阵的每个单元格，并根据 $\\mathrm{TP}_c$、$\\mathrm{FP}_c$、$\\mathrm{FN}_c$ 和 $\\alpha$ 推导出平滑后的逐类精确率和平滑后的逐类召回率的闭式表达式。\n\n你的最终答案必须列出：\n- 在所述保守要求下，以 $k$ 表示的满足条件的最小 $n_c$，以及\n- 拉普拉斯平滑后的逐类精确率和召回率的解析表达式。\n\n所有量均需以符号表示。不需要进行数值取整。", "solution": "这个问题包含两部分。第一部分是确定类别 $c$ 的最小总数 $n_c$，以满足在分层 $k$ 折交叉验证设置中的某些条件。第二部分是推导拉普拉斯平滑后的逐类精确率和召回率的表达式。\n\n第 1 部分：最小逐类支持度要求\n\n设 $n_c$ 是数据集中类别 $c$ 的实例总数，设 $k$ 是交叉验证的折数，其中 $k$ 是一个大于或等于 $2$ 的整数。\n\n在分层 $k$ 折交叉验证中，$n_c$ 个实例被划分成 $k$ 个不相交的子集（折）。对于任意给定的折 $i$（其中 $i \\in \\{1, 2, \\dots, k\\}$），该折的子集作为验证集，其他 $k-1$ 个子集的并集作为训练集。\n\n设 $n_{c, \\text{val}}^{(i)}$ 是折 $i$ 的验证集中类别 $c$ 的实例数。根据问题的分层规则，这个数量由下式给出：\n$$n_{c, \\text{val}}^{(i)} \\in \\{\\lfloor n_c/k \\rfloor, \\lceil n_c/k \\rceil\\}$$\n设 $n_{c, \\text{train}}^{(i)}$ 是折 $i$ 对应训练集中类别 $c$ 的实例数。由于训练集和验证集相对于类别 $c$ 的所有实例是互补的：\n$$n_{c, \\text{train}}^{(i)} = n_c - n_{c, \\text{val}}^{(i)}$$\n问题施加了两个必须对*每一*折 $i$ 都满足的要求：\n1. 每一折的验证集必须至少包含 $2$ 个类别 $c$ 的实例。\n2. 每一折的训练集必须至少包含 $1$ 个类别 $c$ 的实例。\n\n让我们将这些要求形式化为不等式。\n要求 1：对于所有 $i \\in \\{1, 2, \\dots, k\\}$，\n$$n_{c, \\text{val}}^{(i)} \\geq 2$$\n为保证每一折都满足此条件，该条件必须在接收到最少实例数的折中也成立。分配给任何一折验证集的最小实例数是 $\\lfloor n_c/k \\rfloor$。因此，我们必须强制要求：\n$$\\lfloor n_c/k \\rfloor \\geq 2$$\n根据向下取整函数的定义，如果对于整数 $m$，有 $\\lfloor x \\rfloor \\geq m$，则 $x \\geq m$。应用此定义，我们得到：\n$$\\frac{n_c}{k} \\geq 2 \\implies n_c \\geq 2k$$\n\n要求 2：对于所有 $i \\in \\{1, 2, \\dots, k\\}$，\n$$n_{c, \\text{train}}^{(i)} \\geq 1$$\n代入训练集数量的表达式，我们有：\n$$n_c - n_{c, \\text{val}}^{(i)} \\geq 1$$\n为保证每一折都满足此条件，该条件必须在训练集最小时也成立。当对应的验证集大小 $n_{c, \\text{val}}^{(i)}$ 最大时，训练集大小 $n_{c, \\text{train}}^{(i)}$ 最小化。分配给任何一折验证集的最大实例数是 $\\lceil n_c/k \\rceil$。因此，我们必须强制要求：\n$$n_c - \\lceil n_c/k \\rceil \\geq 1$$\n\n我们现在对 $n_c$ 有两个条件：$n_c \\geq 2k$ 和 $n_c - \\lceil n_c/k \\rceil \\geq 1$。$n_c$ 的最终最小值必须同时满足这两个条件。让我们检查一下第一个看起来更严格的条件 ($n_c \\geq 2k$) 是否足以满足第二个条件。\n\n假设 $n_c \\geq 2k$。我们知道对于任意实数 $x$，有 $\\lceil x \\rceil  x+1$。设 $x = n_c/k$。\n$$n_c - \\lceil n_c/k \\rceil > n_c - \\left(\\frac{n_c}{k} + 1\\right) = n_c \\left(1 - \\frac{1}{k}\\right) - 1 = \\frac{n_c(k-1)}{k} - 1$$\n因为我们假设了 $n_c \\geq 2k$，我们可以将其代入不等式中：\n$$\\frac{n_c(k-1)}{k} - 1 \\geq \\frac{2k(k-1)}{k} - 1 = 2(k-1) - 1 = 2k - 2 - 1 = 2k - 3$$\n所以，我们已经确定 $n_c - \\lceil n_c/k \\rceil > 2k-3$。要使条件 $n_c - \\lceil n_c/k \\rceil \\geq 1$ 成立，我们需要 $2k-3 \\geq 0$（因为左侧是整数）。这在 $k \\geq 1.5$ 时成立。由于 $k$ 代表折数，通常假设 $k \\geq 2$，所以这个条件是满足的。\n因此，$n_c \\geq 2k$ 是两个条件中更严格的一个，并且足以保证两个要求都得到满足。\n\n问题要求最小的逐类支持度 $n_c$。因为 $n_c$ 必须是整数，满足 $n_c \\geq 2k$ 的最小值是 $n_c = 2k$。\n\n第 2 部分：拉普拉斯平滑指标\n\n问题要求给出平滑后的逐类精确率和召回率的表达式。平滑是通过向类别 $c$ 的“一对多”混淆矩阵的每个单元格添加一个常数 $\\alpha  0$ 来执行的。\n\n类别 $c$ 的“一对多”混淆矩阵基于在验证集上做出的预测，有四个单元格：\n- $\\mathrm{TP}_c$：真正例（正确预测为类别 $c$）\n- $\\mathrm{FN}_c$：假负例（错误预测为非类别 $c$）\n- $\\mathrm{FP}_c$：假正例（错误预测为类别 $c$）\n- $\\mathrm{TN}_c$：真负例（正确预测为非类别 $c$）\n\n应用对称加性平滑后，平滑后的计数变为：\n- $\\mathrm{TP}'_c = \\mathrm{TP}_c + \\alpha$\n- $\\mathrm{FN}'_c = \\mathrm{FN}_c + \\alpha$\n- $\\mathrm{FP}'_c = \\mathrm{FP}_c + \\alpha$\n- $\\mathrm{TN}'_c = \\mathrm{TN}_c + \\alpha$\n\n类别 $c$ 的逐类召回率的标准定义是：\n$$\\mathrm{Recall}_c = \\frac{\\mathrm{TP}_c}{\\mathrm{TP}_c + \\mathrm{FN}_c}$$\n分母 $\\mathrm{TP}_c + \\mathrm{FN}_c$ 表示验证集中类别 $c$ 的实际实例总数。\n\n平滑后的召回率 $\\mathrm{Recall}'_c$ 是通过将平滑后的计数代入此公式得出的：\n$$\\mathrm{Recall}'_c = \\frac{\\mathrm{TP}'_c}{\\mathrm{TP}'_c + \\mathrm{FN}'_c} = \\frac{\\mathrm{TP}_c + \\alpha}{(\\mathrm{TP}_c + \\alpha) + (\\mathrm{FN}_c + \\alpha)} = \\frac{\\mathrm{TP}_c + \\alpha}{\\mathrm{TP}_c + \\mathrm{FN}_c + 2\\alpha}$$\n\n类别 $c$ 的逐类精确率的标准定义是：\n$$\\mathrm{Precision}_c = \\frac{\\mathrm{TP}_c}{\\mathrm{TP}_c + \\mathrm{FP}_c}$$\n分母 $\\mathrm{TP}_c + \\mathrm{FP}_c$ 表示被预测为类别 $c$ 的实例总数。\n\n平滑后的精确率 $\\mathrm{Precision}'_c$ 是通过将平滑后的计数代入此公式得出的：\n$$\\mathrm{Precision}'_c = \\frac{\\mathrm{TP}'_c}{\\mathrm{TP}'_c + \\mathrm{FP}'_c} = \\frac{\\mathrm{TP}_c + \\alpha}{(\\mathrm{TP}_c + \\alpha) + (\\mathrm{FP}_c + \\alpha)} = \\frac{\\mathrm{TP}_c + \\alpha}{\\mathrm{TP}_c + \\mathrm{FP}_c + 2\\alpha}$$\n由于 $\\alpha  0$ 并且计数（$\\mathrm{TP}_c$、$\\mathrm{FP}_c$、$\\mathrm{FN}_c$）是非负整数，这些平滑指标的分母保证是严格正数，从而确保指标总是有良好定义。\n\n最终答案需要三个组成部分：以 $k$ 表示的最小 $n_c$、平滑精确率的表达式以及平滑召回率的表达式。\n1. 最小 $n_c$：$2k$\n2. 平滑精确率：$\\frac{\\mathrm{TP}_c + \\alpha}{\\mathrm{TP}_c + \\mathrm{FP}_c + 2\\alpha}$\n3. 平滑召回率：$\\frac{\\mathrm{TP}_c + \\alpha}{\\mathrm{TP}_c + \\mathrm{FN}_c + 2\\alpha}$", "answer": "$$\\boxed{\\begin{pmatrix} 2k  \\frac{\\mathrm{TP}_c + \\alpha}{\\mathrm{TP}_c + \\mathrm{FP}_c + 2\\alpha}  \\frac{\\mathrm{TP}_c + \\alpha}{\\mathrm{TP}_c + \\mathrm{FN}_c + 2\\alpha} \\end{pmatrix}}$$", "id": "3177513"}, {"introduction": "在真实世界的应用中，我们用于训练和验证模型的数据分布，往往与模型未来部署环境中的数据分布不完全一致，这种现象被称为“类别分布偏移”。本练习将带你掌握一种高级但非常实用的技术——重要性加权，来校正交叉验证的评估结果 [@problem_id:3177452]。通过为每个样本赋予一个权重，我们可以得到模型在目标数据分布下性能的无偏估计，从而使评估结果更具现实指导意义。", "problem": "在一个使用分层 $k$-折交叉验证（CV）评估的二元分类任务中，假设真实的测试时类别先验为 $q_{1} = 0.6$ 和 $q_{0} = 0.4$，而经验类别比例因折而异。你将推导一个逐折的重要性重加权方案，该方案在测试时类别先验下产生对期望 $0$-$1$ 损失的无偏 CV 估计，然后为给定的一组折计算得出的调整后 CV 估计。\n\n从以下基本依据开始：\n- 在目标分布下，分类器的风险是损失的期望值：$R = \\mathbb{E}[\\ell]$。\n- 在类别先验漂移的情况下，测试时分布与训练分布仅在 $P(Y)$ 上有所不同，而类别条件分布保持稳定。\n- 重要性加权用于将一个分布下的期望值转换到另一个分布下的期望值。\n\n一个二元分类器通过分层 $k$-折 CV（其中 $k = 3$）进行训练和评估。对于每一折 $j \\in \\{1,2,3\\}$，给定在该折的留出数据上计算的混淆计数。设 $n^{(j)}$ 为该折的大小，$n_{1}^{(j)}$ 和 $n_{0}^{(j)}$ 分别为正例和负例的数量，$\\widehat{p}_{1}^{(j)} = n_{1}^{(j)}/n^{(j)}$ 和 $\\widehat{p}_{0}^{(j)} = n_{0}^{(j)}/n^{(j)}$ 为第 $j$ 折中的经验类别比例。每折的混淆计数如下：\n- 第 1 折：$n^{(1)} = 50$, $n_{1}^{(1)} = 30$, $n_{0}^{(1)} = 20$；$TP^{(1)} = 24$, $FN^{(1)} = 6$, $TN^{(1)} = 15$, $FP^{(1)} = 5$。\n- 第 2 折：$n^{(2)} = 50$, $n_{1}^{(2)} = 20$, $n_{0}^{(2)} = 30$；$TP^{(2)} = 14$, $FN^{(2)} = 6$, $TN^{(2)} = 24$, $FP^{(2)} = 6$。\n- 第 3 折：$n^{(3)} = 50$, $n_{1}^{(3)} = 25$, $n_{0}^{(3)} = 25$；$TP^{(3)} = 20$, $FN^{(3)} = 5$, $TN^{(3)} = 18$, $FP^{(3)} = 7$。\n\n任务：\n- 仅使用上述原理，推导逐折的类别权重 $\\alpha_{c}^{(j)}$（每折 $j$ 的每个类别 $c \\in \\{0,1\\}$ 有一个权重），使得当应用于每折内的 $0$-$1$ 损失时，得到的 CV 估计量对于目标先验 $\\{q_{c}\\}$ 下的期望测试时风险是无偏的。\n- 使用你推导出的 $\\alpha_{c}^{(j)}$，计算混合的重要性加权 CV 误分类风险估计，公式如下\n$$\n\\widehat{R} \\;=\\; \\frac{1}{N}\\sum_{j=1}^{3}\\sum_{i \\in \\text{fold } j} \\alpha_{Y_{i}}^{(j)} \\,\\mathbf{1}\\{ \\widehat{Y}_{i} \\neq Y_{i} \\},\n$$\n其中 $N = \\sum_{j=1}^{3} n^{(j)}$，$Y_{i}$ 是真实标签，$\\widehat{Y}_{i}$ 是预测标签。将你的最终数值答案表示为十进制小数，并四舍五入到 $4$ 位有效数字。", "solution": "问题要求推导一种重要性重加权方案，以在分层 $k$-折交叉验证（CV）设置中校正类别先验漂移，然后应用该方案计算调整后的风险估计。\n\n### 第 1 部分：重要性权重的推导\n\n设目标分布表示为 $P_{test}$，给定折 $j$ 的经验分布表示为 $P_{j}$。真实的测试时风险 $R_{test}$ 是在 $P_{test}$ 分布下期望的 $0$-$1$ 损失：\n$$\nR_{test} = \\mathbb{E}_{(X,Y) \\sim P_{test}}[\\mathbf{1}\\{\\widehat{Y}(X) \\neq Y\\}]\n$$\n其中 $\\widehat{Y}(X)$ 是分类器对输入 $X$ 的预测，$\\mathbf{1}\\{\\cdot\\}$ 是指示函数。该期望可以按类别 $c \\in \\{0,1\\}$ 分解：\n$$\nR_{test} = \\sum_{c \\in \\{0,1\\}} P_{test}(Y=c) \\mathbb{E}_{X \\sim P_{test}(X|Y=c)}[\\mathbf{1}\\{\\widehat{Y}(X) \\neq c\\}]\n$$\n设 $q_c = P_{test}(Y=c)$ 为目标类别先验，$R_c = \\mathbb{E}_{X|Y=c}[\\mathbf{1}\\{\\widehat{Y}(X) \\neq c\\}]$ 为类别 $c$ 的真实类别条件风险。那么目标风险为：\n$$\nR_{test} = q_1 R_1 + q_0 R_0\n$$\n问题陈述类别条件分布是稳定的，即对于任何折 $j$，$P_{test}(X|Y=c) = P_j(X|Y=c)$。这意味着真实的类别条件风险 $R_c$ 与分布的先验无关。分类器 $\\widehat{Y}$ 在不包括第 $j$ 折的数据上训练，我们假设它是最终分类器的一个合理代理，因此它在第 $j$ 折上的类别条件错误率 $R_c^{(j)}$ 是真实 $R_c$ 的良好估计。\n\n重要性采样原理允许我们使用来自提议分布 $P_j$ 的样本来估计目标分布 $P_{test}$ 下的期望：\n$$\n\\mathbb{E}_{P_{test}}[f(Z)] = \\mathbb{E}_{P_j}\\left[\\frac{P_{test}(Z)}{P_j(Z)} f(Z)\\right]\n$$\n在我们的案例中，$Z=(X,Y)$ 且 $f(Z) = \\mathbf{1}\\{\\widehat{Y}(X) \\neq Y\\}$。一个样本 $(X,Y)$ 的重要性权重是：\n$$\nw(X,Y) = \\frac{P_{test}(X,Y)}{P_j(X,Y)} = \\frac{P_{test}(X|Y)P_{test}(Y)}{P_j(X|Y)P_j(Y)}\n$$\n使用先验漂移假设 $P_{test}(X|Y) = P_j(X|Y)$，权重简化为仅依赖于类别标签 $Y$：\n$$\nw(Y) = \\frac{P_{test}(Y)}{P_j(Y)}\n$$\n对于第 $j$ 折中类别为 $c$ 的样本，权重是目标先验 $q_c$ 与该折中经验先验 $\\widehat{p}_c^{(j)} = n_c^{(j)}/n^{(j)}$ 的比值。我们被要求找到权重 $\\alpha_c^{(j)}$，使得加权估计量是无偏的。我们将第 $j$ 折中每个类别为 $c$ 的样本的权重设置为这个比率：\n$$\n\\alpha_c^{(j)} = \\frac{q_c}{\\widehat{p}_c^{(j)}}\n$$\n为验证这个权重选择能产生一个无偏估计量，考虑来自第 $j$ 折的单个观测 $i$ 的加权损失的期望：\n$$\n\\mathbb{E}_{(X_i,Y_i) \\sim P_j}[\\alpha_{Y_i}^{(j)}\\mathbf{1}\\{\\widehat{Y}_i \\neq Y_i\\}] = \\sum_{c \\in \\{0,1\\}} P_j(Y=c) \\mathbb{E}_{(X|Y=c)\\sim P_j}[\\alpha_c^{(j)}\\mathbf{1}\\{\\widehat{Y} \\neq c\\}]\n$$\n由于 $\\alpha_c^{(j)}$ 对于类别 $c$ 是常数，我们有：\n$$\n= \\sum_{c \\in \\{0,1\\}} \\widehat{p}_c^{(j)} \\alpha_c^{(j)} \\mathbb{E}_{(X|Y=c)\\sim P_j}[\\mathbf{1}\\{\\widehat{Y} \\neq c\\}] = \\sum_{c \\in \\{0,1\\}} \\widehat{p}_c^{(j)} \\alpha_c^{(j)} R_c^{(j)}\n$$\n代入我们推导出的权重 $\\alpha_c^{(j)} = q_c / \\widehat{p}_c^{(j)}$：\n$$\n= \\sum_{c \\in \\{0,1\\}} \\widehat{p}_c^{(j)} \\left(\\frac{q_c}{\\widehat{p}_c^{(j)}}\\right) R_c^{(j)} = \\sum_{c \\in \\{0,1\\}} q_c R_c^{(j)}\n$$\n假设 $R_c^{(j)} \\approx R_c$，这等于 $R_{test}$。完整的 CV 估计量 $\\widehat{R}$ 的期望是这些期望的平均值，也将是 $R_{test}$，这证实了它是一个无偏估计量。\n\n### 第 2 部分：调整后 CV 估计的计算\n\n混合的重要性加权 CV 估计由下式给出：\n$$\n\\widehat{R} \\;=\\; \\frac{1}{N}\\sum_{j=1}^{3}\\sum_{i \\in \\text{fold } j} \\alpha_{Y_{i}}^{(j)} \\,\\mathbf{1}\\{ \\widehat{Y}_{i} \\neq Y_{i} \\}\n$$\n其中 $N = \\sum_{j=1}^{3} n^{(j)}$ 是样本总数。内层求和可以通过对所有误分类样本的权重求和来计算。类别 1 的误分类样本是假阴性（$FN$），类别 0 的误分类样本是假阳性（$FP$）。因此，该公式可以使用每折的混淆计数重写为：\n$$\n\\widehat{R} = \\frac{1}{N} \\sum_{j=1}^{3} \\left( FN^{(j)} \\cdot \\alpha_1^{(j)} + FP^{(j)} \\cdot \\alpha_0^{(j)} \\right)\n$$\n样本总数为 $N = 50 + 50 + 50 = 150$。目标先验为 $q_1 = 0.6$ 和 $q_0 = 0.4$。\n\n**第 1 折：**\n- 数据：$n^{(1)} = 50$, $n_1^{(1)} = 30$, $n_0^{(1)} = 20$。\n- 经验先验：$\\widehat{p}_1^{(1)} = \\frac{30}{50} = 0.6$, $\\widehat{p}_0^{(1)} = \\frac{20}{50} = 0.4$。\n- 权重：$\\alpha_1^{(1)} = \\frac{q_1}{\\widehat{p}_1^{(1)}} = \\frac{0.6}{0.6} = 1$, $\\alpha_0^{(1)} = \\frac{q_0}{\\widehat{p}_0^{(1)}} = \\frac{0.4}{0.4} = 1$。\n- 混淆计数：$FN^{(1)} = 6$, $FP^{(1)} = 5$。\n- 加权误差和：$W_1 = (6 \\cdot 1) + (5 \\cdot 1) = 11$。\n\n**第 2 折：**\n- 数据：$n^{(2)} = 50$, $n_1^{(2)} = 20$, $n_0^{(2)} = 30$。\n- 经验先验：$\\widehat{p}_1^{(2)} = \\frac{20}{50} = 0.4$, $\\widehat{p}_0^{(2)} = \\frac{30}{50} = 0.6$。\n- 权重：$\\alpha_1^{(2)} = \\frac{q_1}{\\widehat{p}_1^{(2)}} = \\frac{0.6}{0.4} = 1.5$, $\\alpha_0^{(2)} = \\frac{q_0}{\\widehat{p}_0^{(2)}} = \\frac{0.4}{0.6} = \\frac{2}{3}$。\n- 混淆计数：$FN^{(2)} = 6$, $FP^{(2)} = 6$。\n- 加权误差和：$W_2 = (6 \\cdot 1.5) + (6 \\cdot \\frac{2}{3}) = 9 + 4 = 13$。\n\n**第 3 折：**\n- 数据：$n^{(3)} = 50$, $n_1^{(3)} = 25$, $n_0^{(3)} = 25$。\n- 经验先验：$\\widehat{p}_1^{(3)} = \\frac{25}{50} = 0.5$, $\\widehat{p}_0^{(3)} = \\frac{25}{50} = 0.5$。\n- 权重：$\\alpha_1^{(3)} = \\frac{q_1}{\\widehat{p}_1^{(3)}} = \\frac{0.6}{0.5} = 1.2$, $\\alpha_0^{(3)} = \\frac{q_0}{\\widehat{p}_0^{(3)}} = \\frac{0.4}{0.5} = 0.8$。\n- 混淆计数：$FN^{(3)} = 5$, $FP^{(3)} = 7$。\n- 加权误差和：$W_3 = (5 \\cdot 1.2) + (7 \\cdot 0.8) = 6 + 5.6 = 11.6$。\n\n**最终计算：**\n所有折的总加权误差和为：\n$$\n\\sum_{j=1}^{3} W_j = 11 + 13 + 11.6 = 35.6\n$$\n混合的重要性加权 CV 风险估计为：\n$$\n\\widehat{R} = \\frac{35.6}{150} \\approx 0.237333...\n$$\n四舍五入到 $4$ 位有效数字，我们得到 $0.2373$。", "answer": "$$\n\\boxed{0.2373}\n$$", "id": "3177452"}]}