{"hands_on_practices": [{"introduction": "掌握如何从距离矩阵构建树状图是一项基本技能。这个练习将带你使用完全连接聚类法，一步步地完成这个过程。这个方法在生物信息学等领域被广泛用于根据遗传差异推断物种的系统发育关系。[@problem_id:1423409]", "problem": "一个海洋生物学家团队正在研究一个最近发现的深海热液喷口的微生物生态系统。他们分离出了五种前所未知的细菌物种，标记为 S1、S2、S3、S4 和 S5。为了了解它们潜在的进化关系，他们进行了一次遗传分析，并根据其 16S 核糖体 RNA (rRNA) 基因序列的差异计算出了一个距离矩阵。矩阵中较大的值表示两个物种之间的遗传差异更大。\n\n得到的距离矩阵如下：\n\n| | S1 | S2 | S3 | S4 | S5 |\n|:--|:--:|:--:|:--:|:--:|:--:|\n| **S1**| 0 | 0.20 | 0.50 | 0.60 | 0.70 |\n| **S2**| 0.20 | 0 | 0.40 | 0.55 | 0.65 |\n| **S3**| 0.50 | 0.40 | 0 | 0.10 | 0.30 |\n| **S4**| 0.60 | 0.55 | 0.10 | 0 | 0.25 |\n| **S5**| 0.70 | 0.65 | 0.30 | 0.25 | 0 |\n\n你的任务是通过执行层次聚类来确定这些物种之间的系统发育关系。具体来说，你必须使用**完全连接凝聚聚类**（complete-linkage agglomerative clustering）方法。\n\n最终的关系将以树状图（dendrogram）的形式表示，该树状图可以用 Newick 格式进行文本描述。在 Newick 格式中，一棵树由嵌套的括号表示。例如，字符串 `((A,B),C);` 表示物种 A 和 B 首先被聚类在一起，然后这个簇再与物种 C 分组。\n\n以下哪个 Newick 格式字符串正确地表示了使用完全连接聚类从给定距离矩阵获得的树状图的拓扑结构？\n\nA. `((S1,S2),((S3,S4),S5));`\n\nB. `((((S3,S4),S5),S2),S1));`\n\nC. `(((S1,S2),S5),(S3,S4));`\n\nD. `((S1,S5),((S2,S3),S4));`\n\nE. `(((S3,S4),S2),(S1,S5));`", "solution": "在完全连接凝聚聚类中，两个簇 $A$ 和 $B$ 之间的距离定义为\n$$\nd_{\\text{complete}}(A,B)=\\max\\{d(i,j): i \\in A,\\ j \\in B\\}.\n$$\n从单例簇 $\\{S1\\},\\{S2\\},\\{S3\\},\\{S4\\},\\{S5\\}$ 和给定的成对距离开始。\n\n1) 识别单例簇中最近的一对。矩阵中最小的项是 $d(S3,S4)=0.10$，所以首先合并 $S3$ 和 $S4$ 形成 $C_{34}=\\{S3,S4\\}$。\n\n使用完全连接规则计算 $C_{34}$ 到其余单例簇的距离：\n$$\nd(C_{34},S1)=\\max\\{d(S3,S1),d(S4,S1)\\}=\\max\\{0.50,0.60\\}=0.60,\n$$\n$$\nd(C_{34},S2)=\\max\\{d(S3,S2),d(S4,S2)\\}=\\max\\{0.40,0.55\\}=0.55,\n$$\n$$\nd(C_{34},S5)=\\max\\{d(S3,S5),d(S4,S5)\\}=\\max\\{0.30,0.25\\}=0.30.\n$$\n当前的簇间距离包括 $d(S1,S2)=0.20$、$d(S1,S5)=0.70$、$d(S2,S5)=0.65$ 以及上面计算出的三个距离。\n\n2) 当前最小的距离是 $d(S1,S2)=0.20$，所以合并 $S1$ 和 $S2$ 形成 $C_{12}=\\{S1,S2\\}$。\n\n计算 $C_{12}$、$C_{34}$ 和 $S5$ 之间的距离：\n$$\nd(C_{12},S5)=\\max\\{d(S1,S5),d(S2,S5)\\}=\\max\\{0.70,0.65\\}=0.70,\n$$\n$$\nd(C_{12},C_{34})=\\max\\{d(S1,S3),d(S1,S4),d(S2,S3),d(S2,S4)\\}\n=\\max\\{0.50,0.60,0.40,0.55\\}=0.60,\n$$\n以及之前得到的 $d(C_{34},S5)=0.30$。\n\n3) 当前最小的距离是 $d(C_{34},S5)=0.30$，所以合并形成 $C_{345}=\\{S3,S4,S5\\}$，其结构为 $((S3,S4),S5)$。\n\n4) 现在剩下两个簇：$C_{12}=\\{S1,S2\\}$ 和 $C_{345}=\\{S3,S4,S5\\}$。它们之间的完全连接距离是\n$$\nd(C_{12},C_{345})=\\max\\{d(S1,S3),d(S1,S4),d(S1,S5),d(S2,S3),d(S2,S4),d(S2,S5)\\}\n=\\max\\{0.50,0.60,0.70,0.40,0.55,0.65\\}=0.70.\n$$\n因此，最终的合并是在 $(S1,S2)$ 和 $((S3,S4),S5)$ 之间进行的。\n\n最终得到的 Newick 格式的拓扑结构是 $((S1,S2),((S3,S4),S5));$，这对应于选项 A。", "answer": "$$\\boxed{A}$$", "id": "1423409"}, {"introduction": "树状图通过简化数据来揭示层次结构，但这种简化不可避免地会引入失真。本练习将介绍共表型相关系数，这是一个关键指标，用于衡量树状图中的距离在多大程度上忠实地反映了原始数据点之间的真实距离。通过这个计算，你可以量化一个聚类模型的“拟合优度”。[@problem_id:2439035]", "problem": "考虑以下关于分类单元 $A$、$B$、$C$、$D$ 和 $E$ 的对称相异性矩阵：\n- $d(A,B)=2$, $d(A,C)=9$, $d(A,D)=8$, $d(A,E)=4$\n- $d(B,C)=7$, $d(B,D)=8$, $d(B,E)=6$\n- $d(C,D)=3$, $d(C,E)=7$\n- $d(D,E)=9$\n\n对这些分类单元使用非加权对组平均法（UPGMA）构建的树状图由以下合并序列给出（所示高度为树状图上的聚类合并高度）：\n- 在高度 $2$ 处合并 $A$ 和 $B$。\n- 在高度 $3$ 处合并 $C$ 和 $D$。\n- 在高度 $5$ 处将聚类 $\\{A,B\\}$ 与 $E$ 合并。\n- 在高度 $8$ 处将聚类 $\\{A,B,E\\}$ 与聚类 $\\{C,D\\}$ 合并。\n\n使用原始矩阵和给定的UPGMA树状图：\n- 计算所有无序对原始距离向量与树状图所隐含的相应共表型距离向量之间的共表型相关系数。\n- 同时，确定哪个（些）无序分类单元对具有最大的绝对畸变，其定义为 $|d(i,j)-c(i,j)|$，其中 $d(i,j)$ 是原始距离，$c(i,j)$ 是共表型距离。\n\n仅报告共表型相关系数，四舍五入至四位有效数字。报告值无需单位。", "solution": "本问题已经过验证。\n\n第一步：提取已知条件。\n问题为5个分类单元（表示为 $A$、$B$、$C$、$D$ 和 $E$）提供了一个对称相异性矩阵。给定的相异性（距离）$d(i,j)$ 如下：\n- $d(A,B)=2$\n- $d(A,C)=9$\n- $d(A,D)=8$\n- $d(A,E)=4$\n- $d(B,C)=7$\n- $d(B,D)=8$\n- $d(B,E)=6$\n- $d(C,D)=3$\n- $d(C,E)=7$\n- $d(D,E)=9$\n\n一个树状图由一个合并序列和相应的高度指定：\n1. 在高度 $2$ 处合并 $A$ 和 $B$。\n2. 在高度 $3$ 处合并 $C$ 和 $D$。\n3. 在高度 $5$ 处将聚类 $\\{A,B\\}$ 与 $E$ 合并。\n4. 在高度 $8$ 处将聚类 $\\{A,B,E\\}$ 与聚类 $\\{C,D\\}$ 合并。\n\n任务是计算共表型相关系数，并找出具有最大绝对畸变的配对。最终报告值必须仅为共表型相关系数，并四舍五入至四位有效数字。\n\n第二步：使用提取的已知条件进行验证。\n该问题具有科学依据，在聚类分析和生物信息学的标准框架内运作，特别是UPGMA方法。相异性矩阵、树状图、共表型距离和共表型相关的概念定义明确。问题是客观的，并为唯一解提供了所有必要的数据。经检查确认，在合并高度等于合并聚类间全距离的约定下，所提供的合并序列和高度与将标准UPGMA算法应用于初始距离矩阵的结果一致。因此，该问题是适定的且内部一致的。没有科学缺陷、歧义或信息缺失。\n\n第三步：结论与行动。\n问题有效。将提供解答。\n\n主要任务是计算共表型相关系数。这是输入矩阵中的原始距离与从树状图派生出的共表型距离之间的皮尔逊相关系数。\n\n首先，我们必须确定所有无序分类单元对的共表型距离 $c(i,j)$。两个分类单元之间的共表型距离是它们在树状图中的最低共同祖先的高度。根据所提供的合并序列：\n- $A$ 和 $B$ 的最低共同祖先是高度为 $2$ 的节点 $\\{A,B\\}$。因此，$c(A,B) = 2$。\n- $C$ 和 $D$ 的最低共同祖先是高度为 $3$ 的节点 $\\{C,D\\}$。因此，$c(C,D) = 3$。\n- 对 $(A,E)$ 和 $(B,E)$ 而言，其最低共同祖先是高度为 $5$ 的节点 $\\{\\{A,B\\},E\\}$。因此，$c(A,E) = 5$ 且 $c(B,E) = 5$。\n- 高度为 $8$ 的根节点 $\\{\\{\\{A,B\\},E\\},\\{C,D\\}\\}$ 是所有其余配对的最低共同祖先：$(A,C)$、$(A,D)$、$(B,C)$、$(B,D)$、$(C,E)$ 和 $(D,E)$。因此，对于这些配对，共表型距离为 $8$。\n\n现在我们为所有 $\\binom{5}{2} = 10$ 个唯一的分类单元对组合两个距离向量。设 $\\mathbf{d}$ 为原始相异性向量，$\\mathbf{c}$ 为共表型距离向量。我们按一致的顺序列出这些配对：$(A,B)$、$(A,C)$、$(A,D)$、$(A,E)$、$(B,C)$、$(B,D)$、$(B,E)$、$(C,D)$、$(C,E)$、$(D,E)$。\n\n原始距离向量为：\n$$ \\mathbf{d} = (2, 9, 8, 4, 7, 8, 6, 3, 7, 9) $$\n\n相应的共表型距离向量为：\n$$ \\mathbf{c} = (2, 8, 8, 5, 8, 8, 5, 3, 8, 8) $$\n\n共表型相关系数 $\\rho$ 是 $\\mathbf{d}$ 和 $\\mathbf{c}$ 之间的皮尔逊相关系数。其公式为：\n$$ \\rho = \\frac{\\sum_{i=1}^{N} (d_i - \\bar{d})(c_i - \\bar{c})}{\\sqrt{\\sum_{i=1}^{N} (d_i - \\bar{d})^2 \\sum_{i=1}^{N} (c_i - \\bar{c})^2}} $$\n其中 $N=10$ 是配对的数量。\n\n首先，我们计算平均值 $\\bar{d}$ 和 $\\bar{c}$：\n$$ \\sum_{i=1}^{10} d_i = 2+9+8+4+7+8+6+3+7+9 = 63 $$\n$$ \\bar{d} = \\frac{63}{10} = 6.3 $$\n$$ \\sum_{i=1}^{10} c_i = 2+8+8+5+8+8+5+3+8+8 = 63 $$\n$$ \\bar{c} = \\frac{63}{10} = 6.3 $$\n\n接下来，我们计算公式所需的各项和。\n离差乘积之和（分子）：\n$$ \\sum_{i=1}^{10} (d_i - \\bar{d})(c_i - \\bar{c}) = (2-6.3)(2-6.3) + (9-6.3)(8-6.3) + (8-6.3)(8-6.3) + (4-6.3)(5-6.3) + (7-6.3)(8-6.3) + (8-6.3)(8-6.3) + (6-6.3)(5-6.3) + (3-6.3)(3-6.3) + (7-6.3)(8-6.3) + (9-6.3)(8-6.3) $$\n$$ = (-4.3)(-4.3) + (2.7)(1.7) + (1.7)(1.7) + (-2.3)(-1.3) + (0.7)(1.7) + (1.7)(1.7) + (-0.3)(-1.3) + (-3.3)(-3.3) + (0.7)(1.7) + (2.7)(1.7) $$\n$$ = 18.49 + 4.59 + 2.89 + 2.99 + 1.19 + 2.89 + 0.39 + 10.89 + 1.19 + 4.59 = 50.1 $$\n\n$\\mathbf{d}$ 的离差平方和：\n$$ \\sum_{i=1}^{10} (d_i - \\bar{d})^2 = (-4.3)^2 + (2.7)^2 + (1.7)^2 + (-2.3)^2 + (0.7)^2 + (1.7)^2 + (-0.3)^2 + (-3.3)^2 + (0.7)^2 + (2.7)^2 $$\n$$ = 18.49 + 7.29 + 2.89 + 5.29 + 0.49 + 2.89 + 0.09 + 10.89 + 0.49 + 7.29 = 56.1 $$\n\n$\\mathbf{c}$ 的离差平方和：\n$$ \\sum_{i=1}^{10} (c_i - \\bar{c})^2 = (-4.3)^2 + (1.7)^2 + (1.7)^2 + (-1.3)^2 + (1.7)^2 + (1.7)^2 + (-1.3)^2 + (-3.3)^2 + (1.7)^2 + (1.7)^2 $$\n$$ = 18.49 + 2.89 + 2.89 + 1.69 + 2.89 + 2.89 + 1.69 + 10.89 + 2.89 + 2.89 = 50.1 $$\n\n现在，将这些值代入相关公式：\n$$ \\rho = \\frac{50.1}{\\sqrt{56.1 \\times 50.1}} = \\frac{50.1}{\\sqrt{2810.61}} \\approx \\frac{50.1}{53.0151855} \\approx 0.945012... $$\n\n问题要求答案四舍五入到四位有效数字。\n$$ \\rho \\approx 0.9450 $$\n问题的第二部分要求确定具有最大绝对畸变 $|d(i,j)-c(i,j)|$ 的配对。对所有配对的畸变进行快速计算后，发现最大畸变为 $1$。具有此畸变的配对是 $(A,C)$、$(A,E)$、$(B,C)$、$(B,E)$、$(C,E)$ 和 $(D,E)$。最终答案不需要这部分内容。\n最终答案是共表型相关系数。", "answer": "$$\n\\boxed{0.9450}\n$$", "id": "2439035"}, {"introduction": "在掌握了计算之后，让我们来探讨一个更深层次的理论问题：不同的连接算法在特定数据条件下表现如何？这个思想实验将探究当数据集中出现重复点时，各种常用聚类方法的稳健性。通过分析，你将揭示不同连接准则在设计上的根本差异，这对于在实践中选择合适的算法至关重要。[@problem_id:3114193]", "problem": "考虑一个有限点集 $X = \\{x_1, x_2, \\dots, x_n\\} \\subset \\mathbb{R}^p$，其度量 $d$ 由标准欧几里得距离给出。使用以下连接标准之一在两个非空不相交的簇 $A$ 和 $B$ 之间执行层次凝聚聚类：单连接、全连接、平均连接（使用算术平均的非加权配对组法 (UPGMA)）、质心连接和 Ward 连接。根据所选的连接标准，通过重复合并簇间相异性最小的一对簇来构建一个树状图。设 $X' = X \\cup \\{x_{k'}\\}$ 是通过添加一个现有数据点 $x_k$ 的精确副本 $x_{k'}$ 而获得的数据集，因此 $x_{k'} = x_k$ 且 $d(x_k, x_{k'})) = 0$。假设每当有多对簇具有相同的相异性时，算法会使用一个确定性的打破平局规则，该规则会保留原始点集 $X$ 中合并的相对顺序。\n\n将一个连接标准的“对副本具有鲁棒性”定义为以下含义：对于任何 $X$ 和任何索引 $k \\in \\{1,\\dots,n\\}$，在 $X'$ 上构建的树状图与在 $X$ 上构建的树状图的唯一区别在于，在高度为 $0$ 的位置插入了一次合并以融合 $x_k$ 与 $x_{k'}$，此后，原始 $n$ 个点之间的合并顺序以及所有非零的合并高度均与从 $X$ 获得的结果相同。\n\n根据此定义，下列哪组连接标准对副本具有鲁棒性？\n\nA. 单连接、全连接和平均连接 (UPGMA)\n\nB. 仅单连接和全连接\n\nC. 平均连接 (UPGMA) 和 Ward 连接\n\nD. 仅 Ward 连接和质心连接\n\nE. 所列出的全部五种连接标准都对副本具有鲁棒性", "solution": "为了确定哪些连接标准对副本具有鲁棒性，我们需要分析在数据集中添加一个精确副本 $x_{k'} = x_k$ 后，每个连接标准的簇间距离计算会如何变化。根据问题的定义，鲁棒性意味着在 $x_k$ 和 $x_{k'}$ 于高度0合并形成新簇 $C_k^* = \\{x_k, x_{k'}\\}$ 之后，该簇与任何其他簇 $C_j$ 的距离必须与原始单例簇 $\\{x_k\\}$ 和 $C_j$ 的距离相同。即，我们需要验证对于任意簇 $C_j$，是否有 $d_{\\text{link}}(C_k^*, C_j) = d_{\\text{link}}(\\{x_k\\}, C_j)$。\n\n1.  **单连接 (Single Linkage):**\n    簇间距离定义为两个簇中最近元素的距离。\n    $d_{sl}(A, B) = \\min_{a \\in A, b \\in B} d(a, b)$\n    对于我们的情况，$C_k^* = \\{x_k, x_{k'}\\}$ 和任意其他簇 $C_j$：\n    $d_{sl}(C_k^*, C_j) = \\min_{x \\in C_k^*, y \\in C_j} d(x, y) = \\min(\\min_{y \\in C_j} d(x_k, y), \\min_{y \\in C_j} d(x_{k'}, y))$\n    因为 $x_{k'} = x_k$，所以 $d(x_k, y) = d(x_{k'}, y)$ 对于所有 $y$ 都成立。因此：\n    $d_{sl}(C_k^*, C_j) = \\min_{y \\in C_j} d(x_k, y) = d_{sl}(\\{x_k\\}, C_j)$\n    **单连接是鲁棒的。**\n\n2.  **全连接 (Complete Linkage):**\n    簇间距离定义为两个簇中最远元素的距离。\n    $d_{cl}(A, B) = \\max_{a \\in A, b \\in B} d(a, b)$\n    对于 $C_k^*$ 和 $C_j$：\n    $d_{cl}(C_k^*, C_j) = \\max_{x \\in C_k^*, y \\in C_j} d(x, y) = \\max(\\max_{y \\in C_j} d(x_k, y), \\max_{y \\in C_j} d(x_{k'}, y))$\n    同样，由于 $d(x_k, y) = d(x_{k'}, y)$：\n    $d_{cl}(C_k^*, C_j) = \\max_{y \\in C_j} d(x_k, y) = d_{cl}(\\{x_k\\}, C_j)$\n    **全连接是鲁棒的。**\n\n3.  **平均连接 (Average Linkage - UPGMA):**\n    簇间距离定义为所有跨簇元素对距离的平均值。\n    $d_{avg}(A, B) = \\frac{1}{|A||B|} \\sum_{a \\in A} \\sum_{b \\in B} d(a, b)$\n    对于 $C_k^*$ 和 $C_j$，其中 $|C_k^*| = 2$：\n    $d_{avg}(C_k^*, C_j) = \\frac{1}{2|C_j|} \\sum_{x \\in C_k^*} \\sum_{y \\in C_j} d(x, y) = \\frac{1}{2|C_j|} \\left( \\sum_{y \\in C_j} d(x_k, y) + \\sum_{y \\in C_j} d(x_{k'}, y) \\right)$\n    因为 $d(x_k, y) = d(x_{k'}, y)$，所以 $\\sum d(x_k, y) = \\sum d(x_{k'}, y)$。\n    $d_{avg}(C_k^*, C_j) = \\frac{1}{2|C_j|} \\left( 2 \\sum_{y \\in C_j} d(x_k, y) \\right) = \\frac{1}{|C_j|} \\sum_{y \\in C_j} d(x_k, y)$\n    这个结果恰好等于 $d_{avg}(\\{x_k\\}, C_j) = \\frac{1}{1 \\cdot |C_j|} \\sum_{y \\in C_j} d(x_k, y)$。\n    **平均连接是鲁棒的。**\n\n4.  **质心连接 (Centroid Linkage):**\n    簇间距离定义为簇质心之间的欧几里得距离。设 $c_A$ 为簇 $A$ 的质心。\n    $d_{cent}(A, B) = \\|c_A - c_B\\|$\n    $c_{\\{x_k\\}} = x_k$。$c_{C_k^*} = \\frac{x_k + x_{k'}}{2} = \\frac{x_k + x_k}{2} = x_k$。\n    因此，$d_{cent}(C_k^*, C_j) = \\|c_{C_k^*} - c_j\\| = \\|x_k - c_j\\| = d_{cent}(\\{x_k\\}, C_j)$。\n    然而，问题在于后续的合并。假设我们将 $C_k^*$ 和 $C_j$ 合并成新簇 $C_{new}'$。其质心为：\n    $c_{C_{new}'} = \\frac{|C_k^*|c_{C_k^*} + |C_j|c_j}{|C_k^*|+|C_j|} = \\frac{2x_k + |C_j|c_j}{2+|C_j|}$\n    在原始数据集中，合并 $\\{x_k\\}$ 和 $C_j$ 形成 $C_{new}$，其质心为：\n    $c_{C_{new}} = \\frac{|\\{x_k\\}|c_{\\{x_k\\}} + |C_j|c_j}{|\\{x_k\\}|+|C_j|} = \\frac{1x_k + |C_j|c_j}{1+|C_j|}$\n    由于 $c_{C_{new}'} \\neq c_{C_{new}}$，新形成的簇的质心发生了改变。这会影响该簇与所有其他簇的后续距离计算，从而改变了合并的顺序。因此，**质心连接不是鲁棒的。**\n\n5.  **Ward 连接 (Ward's Method):**\n    簇间距离定义为合并两个簇所导致的组内平方和增量。合并簇 $A$ 和 $B$ 的距离为：\n    $d_{ward}(A, B) = \\sqrt{\\frac{|A||B|}{|A|+|B|}} \\|c_A - c_B\\|$\n    我们比较 $d_{ward}(C_k^*, C_j)$ 和 $d_{ward}(\\{x_k\\}, C_j)$。质心 $c_{C_k^*} = c_{\\{x_k\\}} = x_k$。但是，权重项不同：\n    对于 $C_k^*$ 和 $C_j$：权重为 $\\frac{|C_k^*||C_j|}{|C_k^*|+|C_j|} = \\frac{2|C_j|}{2+|C_j|}$\n    对于 $\\{x_k\\}$ 和 $C_j$：权重为 $\\frac{|\\{x_k\\}||C_j|}{|\\{x_k\\}|+|C_j|} = \\frac{1|C_j|}{1+|C_j|}$\n    由于权重项不同，即使质心距离 $\\|x_k - c_j\\|$ 相同，Ward 距离也不同。\n    $d_{ward}(C_k^*, C_j) \\neq d_{ward}(\\{x_k\\}, C_j)$。\n    因此，**Ward 连接不是鲁棒的。**\n\n综上所述，只有单连接、全连接和平均连接 (UPGMA) 对副本具有鲁棒性。", "answer": "$$\\boxed{A}$$", "id": "3114193"}]}