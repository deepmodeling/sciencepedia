{"hands_on_practices": [{"introduction": "构建逻辑回归模型后，一个关键步骤是评估其拟合优度。本练习将指导您计算模型的偏差（deviance），这是广义线性模型中的一个关键指标，用于衡量模型预测与实际观测数据之间的差异。通过解决这个问题（[@problem_id:1930939]），您将巩固对如何通过对数几率链接（logit link）生成预测概率，并利用这些概率来量化模型性能的理解。", "problem": "在一项关于新型杀虫剂有效性的研究中，昆虫的结局是二元的：存活（记为 $y=0$）或死亡（记为 $y=1$）。死亡概率 $p$ 使用带有 logit 链接函数的广义线性模型（GLM）进行建模，这种方法通常被称为逻辑回归。该模型通过对数优势比（log-odds）的方程将概率 $p$ 与杀虫剂浓度 $x$（单位：百万分之几，ppm）联系起来：\n$$ \\ln\\left(\\frac{p}{1-p}\\right) = \\beta_0 + \\beta_1 x $$\n基于广泛的初步实验，拟合的模型参数被确定为 $\\beta_0 = -1.50$ 和 $\\beta_1 = 0.80$。\n\n在一小组四只昆虫上进行了一项新实验，得到以下数据：\n- 昆虫 1：浓度 $x_1 = 1.0$ ppm，结局 $y_1 = 0$（存活）\n- 昆虫 2：浓度 $x_2 = 2.0$ ppm，结局 $y_2 = 1$（死亡）\n- 昆虫 3：浓度 $x_3 = 3.0$ ppm，结局 $y_3 = 1$（死亡）\n- 昆虫 4：浓度 $x_4 = 4.0$ ppm，结局 $y_4 = 0$（存活）\n\n模型的总偏差（total deviance）是衡量模型拟合数据优良程度的指标。对于一组二元结局 $y_i$ ($i=1, \\dots, n$) 及其对应的模型拟合概率 $\\hat{p}_i$，总偏差由以下公式给出：\n$$ D = -2 \\sum_{i=1}^{n} \\left[ y_i \\ln(\\hat{p}_i) + (1-y_i)\\ln(1-\\hat{p}_i) \\right] $$\n\n计算该逻辑回归模型对于这四只昆虫的总偏差 $D$。将您的最终答案四舍五入到四位有效数字。", "solution": "该模型使用 logit 链接，因此对于每只浓度为 $x_{i}$ 的昆虫，线性预测值为 $\\eta_{i}=\\beta_{0}+\\beta_{1}x_{i}$，拟合概率为 $\\hat{p}_{i}=\\frac{1}{1+\\exp(-\\eta_{i})}$。\n\n给定 $\\beta_{0}=-1.50$ 和 $\\beta_{1}=0.80$，计算 $\\eta_{i}$ 和 $\\hat{p}_{i}$：\n- 昆虫 1：$x_{1}=1.0$, $\\eta_{1}=-1.5+0.8(1)=-0.7$，因此 $\\hat{p}_{1}=\\frac{1}{1+\\exp(0.7)}\\approx 0.331812227$。\n- 昆虫 2：$x_{2}=2.0$, $\\eta_{2}=-1.5+0.8(2)=0.1$，因此 $\\hat{p}_{2}=\\frac{1}{1+\\exp(-0.1)}\\approx 0.524979188$。\n- 昆虫 3：$x_{3}=3.0$, $\\eta_{3}=-1.5+0.8(3)=0.9$，因此 $\\hat{p}_{3}=\\frac{1}{1+\\exp(-0.9)}\\approx 0.710949501$。\n- 昆虫 4：$x_{4}=4.0$, $\\eta_{4}=-1.5+0.8(4)=1.7$，因此 $\\hat{p}_{4}=\\frac{1}{1+\\exp(-1.7)}\\approx 0.845534734$。\n\n总偏差为\n$$\nD=-2\\sum_{i=1}^{4}\\left[y_{i}\\ln(\\hat{p}_{i})+(1-y_{i})\\ln(1-\\hat{p}_{i})\\right].\n$$\n使用观测到的 $y_{i}$ 计算每一项：\n- 昆虫 1：$y_{1}=0$，贡献为 $-2\\ln(1-\\hat{p}_{1})=-2\\ln(0.668187773)\\approx 0.80637182$。\n- 昆虫 2：$y_{2}=1$，贡献为 $-2\\ln(\\hat{p}_{2})=-2\\ln(0.524979188)\\approx 1.28879255$。\n- 昆虫 3：$y_{3}=1$，贡献为 $-2\\ln(\\hat{p}_{3})=-2\\ln(0.710949501)\\approx 0.68230800$。\n- 昆虫 4：$y_{4}=0$，贡献为 $-2\\ln(1-\\hat{p}_{4})=-2\\ln(0.154465266)\\approx 3.73557206$。\n\n将各项贡献相加：\n$$\nD \\approx 0.80637182+1.28879255+0.68230800+3.73557206=6.51304443.\n$$\n四舍五入到四位有效数字，总偏差为 $6.513$。", "answer": "$$\\boxed{6.513}$$", "id": "1930939"}, {"introduction": "逻辑回归模型中的系数并非绝对值，它们的解释与输入特征的尺度密切相关。本练习通过一个思想实验来探讨这一基本概念，要求您确定在线性重缩放一个特征后，模型系数必须如何调整以确保模型的预测保持不变。通过这个问题（[@problem_id:3185465]），您将深入理解系数与特征变换之间的代数关系，这是准确解释模型的关键技能。", "problem": "考虑一个使用逻辑斯谛函数和logit链接函数的二元分类模型：对于一个特征向量 $x = (x_{1}, \\dots, x_{d})$，类别 $1$ 的条件概率为 $p(x) = \\frac{1}{1 + \\exp(-\\eta(x))}$，其中线性预测子为 $\\eta(x) = \\beta_{0} + \\sum_{k=1}^{d} \\beta_{k} x_{k}$。您决定改变单个特征 $x_{j}$ 的度量单位，方法是定义一个重缩放的特征 $x_{j}^{\\text{new}} = \\frac{x_{j} - u}{v}$，其中 $u$ 是一个固定的实数常量，$v$ 是一个固定的正实数常量。所有其他特征 $x_{k}$（其中 $k \\neq j$）保持不变。\n\n您希望在这次重缩放后，对于每一个输入，预测概率 $p(x)$ 都保持完全相同，同时模型要用转换后的特征 $x_{j}^{\\text{new}}$ 来表示。也就是说，您需要寻找新的系数 $\\tilde{\\beta}_{0}$、$\\tilde{\\beta}_{j}$ 和 $\\tilde{\\beta}_{k}$（其中 $k \\neq j$），使得转换后的线性预测子 $\\tilde{\\eta}(x) = \\tilde{\\beta}_{0} + \\tilde{\\beta}_{j} x_{j}^{\\text{new}} + \\sum_{k \\neq j} \\tilde{\\beta}_{k} x_{k}$ 对所有 $x$ 都满足 $p(x) = \\frac{1}{1 + \\exp(-\\tilde{\\eta}(x))}$。请用 $\\beta_{0}$、$\\beta_{j}$、$u$ 和 $v$ 以闭合形式表示系数对 $(\\tilde{\\beta}_{0}, \\tilde{\\beta}_{j})$。请使用 LaTeX 的 pmatrix 环境，将您的最终答案表示为一个行矩阵，其中元素按 $(\\tilde{\\beta}_{0}, \\tilde{\\beta}_{j})$ 的顺序排列。", "solution": "该问题要求，在对逻辑斯谛回归模型的单个特征 $x_{j}$ 进行线性变换后，找出新的系数 $(\\tilde{\\beta}_{0}, \\tilde{\\beta}_{j})$，以使得对于所有输入向量 $x$，预测概率保持不变。\n\n类别 1 的条件概率由逻辑斯谛函数给出，$p(x) = \\sigma(\\eta(x))$，其中 $\\sigma(z) = \\frac{1}{1 + \\exp(-z)}$ 且 $\\eta(x)$ 是线性预测子。逻辑斯谛函数 $\\sigma(z)$ 是其参数 $z$ 的严格单调递增函数。因此，要在变换特征 $x_{j}$ 后，对于任何给定的输入向量 $x$，预测概率都保持相同，线性预测子的值也必须保持不变。这意味着对于所有的 $x$，原始线性预测子 $\\eta(x)$ 必须等于新的线性预测子 $\\tilde{\\eta}(x)$。\n\n原始线性预测子由下式给出：\n$$ \\eta(x) = \\beta_{0} + \\sum_{k=1}^{d} \\beta_{k} x_{k} = \\beta_{0} + \\beta_{j} x_{j} + \\sum_{k \\neq j, k=1}^{d} \\beta_{k} x_{k} $$\n\n新特征 $x_{j}^{\\text{new}}$ 由以下变换定义：\n$$ x_{j}^{\\text{new}} = \\frac{x_{j} - u}{v} $$\n其中 $u$ 是一个实数常量，$v$ 是一个正实数常量。为了用新特征表示原始预测子，我们必须首先将 $x_j$ 表示为 $x_{j}^{\\text{new}}$ 的函数。重新整理变换方程可得：\n$$ v x_{j}^{\\text{new}} = x_{j} - u $$\n$$ x_{j} = v x_{j}^{\\text{new}} + u $$\n\n现在，我们将 $x_{j}$ 的这个表达式代回到原始线性预测子 $\\eta(x)$ 的方程中：\n$$ \\eta(x) = \\beta_{0} + \\beta_{j} (v x_{j}^{\\text{new}} + u) + \\sum_{k \\neq j} \\beta_{k} x_{k} $$\n\n分配 $\\beta_{j}$ 项并重新组合各项以匹配新线性预测子的结构，可得：\n$$ \\eta(x) = \\beta_{0} + \\beta_{j} v x_{j}^{\\text{new}} + \\beta_{j} u + \\sum_{k \\neq j} \\beta_{k} x_{k} $$\n$$ \\eta(x) = (\\beta_{0} + \\beta_{j} u) + (\\beta_{j} v) x_{j}^{\\text{new}} + \\sum_{k \\neq j} \\beta_{k} x_{k} $$\n\n新的线性预测子是用新系数 $\\tilde{\\beta}_{0}$、$\\tilde{\\beta}_{j}$ 和 $\\tilde{\\beta}_{k}$（其中 $k \\neq j$）来定义的：\n$$ \\tilde{\\eta}(x) = \\tilde{\\beta}_{0} + \\tilde{\\beta}_{j} x_{j}^{\\text{new}} + \\sum_{k \\neq j} \\tilde{\\beta}_{k} x_{k} $$\n\n为了使条件 $\\eta(x) = \\tilde{\\eta}(x)$ 对特征向量 $x$ 的所有可能值（因此也对 $x_{j}^{\\text{new}}$ 和 $k \\neq j$ 时的 $x_k$ 的所有值）都成立，两个线性预测子多项式表达式中对应项的系数必须相等。我们可以逐项地使系数相等：\n\n将用 $x_{j}^{\\text{new}}$ 表示的 $\\eta(x)$ 表达式与 $\\tilde{\\eta}(x)$ 的表达式进行比较：\n$$ (\\beta_{0} + \\beta_{j} u) + (\\beta_{j} v) x_{j}^{\\text{new}} + \\sum_{k \\neq j} \\beta_{k} x_{k} = \\tilde{\\beta}_{0} + \\tilde{\\beta}_{j} x_{j}^{\\text{new}} + \\sum_{k \\neq j} \\tilde{\\beta}_{k} x_{k} $$\n\n1.  使常数项（截距）相等：\n    $$ \\tilde{\\beta}_{0} = \\beta_{0} + \\beta_{j} u $$\n\n2.  使变换后特征 $x_{j}^{\\text{new}}$ 的系数相等：\n    $$ \\tilde{\\beta}_{j} = \\beta_{j} v $$\n\n3.  使其他特征 $x_{k}$（其中 $k \\neq j$）的系数相等：\n    $$ \\tilde{\\beta}_{k} = \\beta_{k} $$\n\n问题要求给出系数对 $(\\tilde{\\beta}_{0}, \\tilde{\\beta}_{j})$ 的表达式。根据上面的推导，它们是：\n$$ \\tilde{\\beta}_{0} = \\beta_{0} + \\beta_{j} u $$\n$$ \\tilde{\\beta}_{j} = \\beta_{j} v $$\n\n这些表达式给出了重缩放特征的新截距和新系数，确保了模型预测在特征 $x_j$ 的指定线性变换下保持不变。最终答案将按要求以行矩阵的形式呈现。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\beta_{0} + \\beta_{j} u  \\beta_{j} v\n\\end{pmatrix}\n}\n$$", "id": "3185465"}, {"introduction": "逻辑回归模型提供的是一个概率值，但许多现实世界的应用需要一个明确的二元分类决策。从概率到决策的转换取决于选择一个合适的阈值，而这个选择应该由不同错误的潜在成本来指导。这个问题（[@problem_id:3185480]）将挑战您应用贝叶斯决策理论，在考虑假阳性和假阴性具有不对称成本的情况下，推导出最小化期望成本的最优分类阈值。", "problem": "一个二元分类器经过训练，用于预测个体是否患有某种病症（$Y=1$）或未患此病症（$Y=0$）。在目标人群中，该病症的患病率为 $\\pi = \\mathbb{P}(Y=1)$，其中 $0  \\pi  1$。该分类器是一个逻辑回归模型，其线性预测器为 $\\eta(x)$，输出分数为 $q(x)$，由 logistic 函数 $\\sigma$ 和 logit 链接函数给出，即 $q(x) = \\sigma(\\eta(x))$，其中 $\\sigma(z) = \\left(1 + \\exp(-z)\\right)^{-1}$ 且 $\\operatorname{logit}(q) = \\ln\\!\\left(\\frac{q}{1-q}\\right) = \\eta(x)$。该模型在平衡数据集上进行训练，因此其分数 $q(x)$ 被校准为均等的类别先验，即 $q(x) = \\frac{f_{1}(x)}{f_{0}(x) + f_{1}(x)}$，其中 $f_{y}(x)$ 表示在给定 $Y=y$ 的情况下特征 $x$ 的类条件密度。\n\n您必须选择一个单一的概率阈值 $t$ 应用于 $q(x)$：当 $q(x) \\ge t$ 时预测 $Y=1$，否则预测 $Y=0$。错分类会产生非对称成本：假阴性（FN）产生的成本为 $C_{FN} > 0$，假阳性（FP）产生的成本为 $C_{FP} > 0$。从条件风险最小化和贝叶斯决策理论的核心定义出发，并将 $\\pi$、$C_{FN}$ 和 $C_{FP}$ 视为固定且已知的，推导出成本最优阈值 $t^{*}$ 作为 $\\pi$、$C_{FN}$ 和 $C_{FP}$ 的函数的闭式表达式，该阈值将直接应用于 $q(x)$。\n\n您的最终答案必须是关于 $t^{*}$ 的单一解析表达式。", "solution": "最优阈值 $t^*$ 的推导过程是通过最小化决策的期望成本来进行的，这是贝叶斯决策理论中称为条件风险最小化的一个原则。\n\n首先，我们为给定的特征向量 $x$ 定义与每个可能决策相关的条件风险。有两种行动：预测 $Y=1$（表示为 $\\alpha_1$）或预测 $Y=0$（表示为 $\\alpha_0$）。风险是在 $x$ 条件下的期望成本。\n\n预测 $Y=1$ 的风险是此行动出错（假阳性）的成本乘以其出错的概率。\n$$R(\\alpha_1|x) = C_{FP} \\cdot \\mathbb{P}(Y=0|x)$$\n\n预测 $Y=0$ 的风险是此行动出错（假阴性）的成本乘以其出错的概率。\n$$R(\\alpha_0|x) = C_{FN} \\cdot \\mathbb{P}(Y=1|x)$$\n\n贝叶斯最优决策规则是选择具有较低条件风险的行动。如果 $R(\\alpha_1|x) \\le R(\\alpha_0|x)$，我们应该预测 $Y=1$。包含边界情况的等式是为了与问题中的决策规则 $q(x) \\ge t$ 保持一致。\n$$C_{FP} \\cdot \\mathbb{P}(Y=0|x) \\le C_{FN} \\cdot \\mathbb{P}(Y=1|x)$$\n\n令 $p(x) = \\mathbb{P}(Y=1|x)$ 为目标人群中正类的真实后验概率。那么 $\\mathbb{P}(Y=0|x) = 1 - p(x)$。将这些代入不等式得到：\n$$C_{FP} (1 - p(x)) \\le C_{FN} p(x)$$\n由于 $p(x) \\in [0, 1]$ 且成本为正，我们可以重新整理这个不等式，以找到关于后验几率 $\\frac{p(x)}{1-p(x)}$ 的条件。\n$$C_{FP} \\le p(x) (C_{FN} + C_{FP})$$\n这暗示了在真实后验概率上的一个阈值。然而，使用几率来处理更为简洁。\n$$\\frac{p(x)}{1-p(x)} \\ge \\frac{C_{FP}}{C_{FN}}$$\n这是以真实后验几率表示的最优决策规则。\n\n接下来，我们必须将真实后验概率 $p(x)$ 与模型的分数 $q(x)$ 联系起来。分数 $q(x)$ 是在假设平衡先验（即 $\\mathbb{P}(Y=1)=\\mathbb{P}(Y=0)=0.5$）下计算的后验概率。问题陈述给出 $q(x) = \\frac{f_1(x)}{f_0(x) + f_1(x)}$。根据这个定义，我们可以用 $q(x)$ 推导出似然比 $\\frac{f_1(x)}{f_0(x)}$：\n$$q(x) (f_0(x) + f_1(x)) = f_1(x)$$\n$$q(x) f_0(x) = f_1(x) (1 - q(x))$$\n$$\\frac{f_1(x)}{f_0(x)} = \\frac{q(x)}{1-q(x)}$$\n右边是与分数 $q(x)$ 对应的几率。\n\n真实后验概率 $p(x)$ 由贝叶斯定理使用真实患病率 $\\pi$ 给出：\n$$p(x) = \\mathbb{P}(Y=1|x) = \\frac{p(x|Y=1)\\mathbb{P}(Y=1)}{p(x|Y=1)\\mathbb{P}(Y=1) + p(x|Y=0)\\mathbb{P}(Y=0)} = \\frac{f_1(x)\\pi}{f_1(x)\\pi + f_0(x)(1-\\pi)}$$\n相应的真实后验几率是：\n$$\\frac{p(x)}{1-p(x)} = \\frac{f_1(x)\\pi}{f_0(x)(1-\\pi)} = \\frac{f_1(x)}{f_0(x)} \\cdot \\frac{\\pi}{1-\\pi}$$\n代入似然比的表达式，我们建立了真实后验几率和分数几率之间的关键关系：\n$$\\frac{p(x)}{1-p(x)} = \\frac{q(x)}{1-q(x)} \\cdot \\frac{\\pi}{1-\\pi}$$\n\n现在，我们将这个关系代入我们的最优决策规则：\n$$\\frac{q(x)}{1-q(x)} \\cdot \\frac{\\pi}{1-\\pi} \\ge \\frac{C_{FP}}{C_{FN}}$$\n我们需要解这个关于 $q(x)$ 的不等式。这将得到阈值 $t^*$。\n$$\\frac{q(x)}{1-q(x)} \\ge \\frac{C_{FP}}{C_{FN}} \\cdot \\frac{1-\\pi}{\\pi}$$\n令右侧为一个常数 $K$：$K = \\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi}$。不等式为 $\\frac{q(x)}{1-q(x)} \\ge K$。由于 $q(x) \\in [0, 1)$，所以 $1-q(x) > 0$，我们可以将两边同乘以 $(1-q(x))$：\n$$q(x) \\ge K(1-q(x))$$\n$$q(x) \\ge K - Kq(x)$$\n$$q(x)(1+K) \\ge K$$\n$$q(x) \\ge \\frac{K}{1+K}$$\n阈值 $t^*$ 就是右边的值。我们将 $K$ 的表达式代回：\n$$t^* = \\frac{\\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi}}{1 + \\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi}}$$\n为了简化这个繁分数，我们将分子和分母同乘以 $C_{FN}\\pi$：\n$$t^* = \\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi + C_{FP}(1-\\pi)}$$\n这就是直接应用于模型分数 $q(x)$ 的成本最优阈值 $t^*$ 的闭式表达式。", "answer": "$$\\boxed{\\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi + C_{FP}(1-\\pi)}}$$", "id": "3185480"}]}