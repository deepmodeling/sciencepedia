{"hands_on_practices": [{"introduction": "统计学的一个基本原则是，样本为我们提供了一个观察总体的窗口。然而，由于随机性的存在，样本的特征可能会偏离总体的特征。本练习 [@problem_id:3159127] 将通过多重共线性的视角来探讨这一现象，展示当样本中预测变量之间的相关性碰巧强于总体时，它会如何显著地增大回归系数估计的方差。通过解决这个问题，你将具体地理解抽样变异性是如何影响模型稳定性的。", "problem": "考虑一个特征向量总体 $\\mathbf{X} = (X_{1}, X_{2})^{\\top}$，其联合分布为二元正态分布 $\\mathcal{N}(\\mathbf{0}, \\Sigma)$，其中总体协方差矩阵为\n$$\n\\Sigma = \\begin{pmatrix}\n4  5.4 \\\\\n5.4  9\n\\end{pmatrix}.\n$$\n这意味着总体相关系数为 $\\rho_{\\text{pop}} = \\frac{5.4}{\\sqrt{4 \\cdot 9}} = 0.90$，因此 $X_{1}$ 与 $X_{2}$ 强相关。从该总体中通过独立同分布抽样，收集了一个大小为 $n = 200$ 的数据集。在一个具体的实现样本中，观测到的 $X_1$ 的样本方差为 $4$，$X_2$ 的样本方差为 $9$，观测到的样本协方差为 $5.94$，对应的样本相关系数为 $\\rho_{\\text{samp}} = \\frac{5.94}{\\sqrt{4 \\cdot 9}} = 0.99$。\n\n假设响应变量 $Y$ 服从线性模型\n$$\nY = \\beta_{1} X_{1} + \\beta_{2} X_{2} + \\varepsilon,\n$$\n其中 $\\varepsilon \\sim \\mathcal{N}(0, \\sigma_{\\varepsilon}^{2})$ 独立于 $\\mathbf{X}$，且 $\\sigma_{\\varepsilon}^{2} = 1$。定义 $\\hat{\\beta} = (\\hat{\\beta}_{1}, \\hat{\\beta}_{2})^{\\top}$ 为基于观测样本的普通最小二乘 (OLS) 估计量。\n\n从协方差矩阵的基本定义以及同方差误差下线性回归估计量方差的定义出发（不使用任何预先给定的简化公式），推导 $\\operatorname{Var}(\\hat{\\beta}_{1})$ 关于预测变量的 $2 \\times 2$ 协方差矩阵的精确表达式。然后，假设边际方差如前所述，计算在实现样本设计（相关系数为 $0.99$）下 $\\operatorname{Var}(\\hat{\\beta}_{1})$ 的值是使用总体协方差矩阵（相关系数为 $0.90$）计算的方差的多少倍（即乘法因子）。将最终的因子以一个实数形式给出，并四舍五入到四位有效数字。", "solution": "该问题要求推导普通最小二乘 (OLS) 估计量 $\\hat{\\beta}_{1}$ 的方差，然后计算在两种不同的预测变量协方差结构情景下该方差的比率。\n\n首先，我们推导 $\\operatorname{Var}(\\hat{\\beta}_{1})$ 的表达式。线性模型以矩阵形式给出 $\\mathbf{Y} = \\mathbf{X}\\boldsymbol{\\beta} + \\boldsymbol{\\varepsilon}$，其中 $\\mathbf{Y}$ 是响应变量观测值的 $n \\times 1$ 向量，$\\mathbf{X}$ 是预测变量观测值的 $n \\times p$ 设计矩阵（本例中 $p=2$），$\\boldsymbol{\\beta}$ 是真实系数的 $p \\times 1$ 向量，$\\boldsymbol{\\varepsilon}$ 是误差的 $n \\times 1$ 向量。假设误差独立同分布，均值为 $0$，方差为 $\\sigma_{\\varepsilon}^{2}$，即 $\\operatorname{E}[\\boldsymbol{\\varepsilon}] = \\mathbf{0}$ 且 $\\operatorname{Var}(\\boldsymbol{\\varepsilon}) = \\sigma_{\\varepsilon}^{2}\\mathbf{I}_{n}$，其中 $\\mathbf{I}_{n}$ 是 $n \\times n$ 的单位矩阵。\n\nOLS 估计量 $\\hat{\\boldsymbol{\\beta}}$ 定义为：\n$$\n\\hat{\\boldsymbol{\\beta}} = (\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top}\\mathbf{Y}\n$$\n为了求 $\\hat{\\boldsymbol{\\beta}}$ 的方差，我们首先用真实系数 $\\boldsymbol{\\beta}$ 和误差项 $\\boldsymbol{\\varepsilon}$ 来表示它：\n$$\n\\hat{\\boldsymbol{\\beta}} = (\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top}(\\mathbf{X}\\boldsymbol{\\beta} + \\boldsymbol{\\varepsilon}) = (\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top}\\mathbf{X}\\boldsymbol{\\beta} + (\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top}\\boldsymbol{\\varepsilon} = \\boldsymbol{\\beta} + (\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top}\\boldsymbol{\\varepsilon}\n$$\n估计量在设计矩阵 $\\mathbf{X}$ 条件下的方差为：\n$$\n\\operatorname{Var}(\\hat{\\boldsymbol{\\beta}} | \\mathbf{X}) = \\operatorname{Var}(\\boldsymbol{\\beta} + (\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top}\\boldsymbol{\\varepsilon} | \\mathbf{X})\n$$\n由于 $\\boldsymbol{\\beta}$ 是一个常数向量，并且我们以 $\\mathbf{X}$ 为条件，这可以简化为：\n$$\n\\operatorname{Var}(\\hat{\\boldsymbol{\\beta}} | \\mathbf{X}) = \\operatorname{Var}((\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top}\\boldsymbol{\\varepsilon} | \\mathbf{X})\n$$\n使用性质：对于矩阵 $\\mathbf{A}$ 和随机向量 $\\mathbf{z}$，有 $\\operatorname{Var}(\\mathbf{A}\\mathbf{z}) = \\mathbf{A}\\operatorname{Var}(\\mathbf{z})\\mathbf{A}^{\\top}$，我们得到：\n$$\n\\operatorname{Var}(\\hat{\\boldsymbol{\\beta}} | \\mathbf{X}) = ((\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top}) \\operatorname{Var}(\\boldsymbol{\\varepsilon}) ((\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top})^{\\top}\n$$\n代入 $\\operatorname{Var}(\\boldsymbol{\\varepsilon}) = \\sigma_{\\varepsilon}^{2}\\mathbf{I}_{n}$：\n$$\n\\operatorname{Var}(\\hat{\\boldsymbol{\\beta}} | \\mathbf{X}) = \\sigma_{\\varepsilon}^{2} (\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top} (\\mathbf{X}((\\mathbf{X}^{\\top}\\mathbf{X})^{-1})^{\\top}) = \\sigma_{\\varepsilon}^{2} (\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top}\\mathbf{X}((\\mathbf{X}^{\\top}\\mathbf{X})^{\\top})^{-1}\n$$\n由于 $\\mathbf{X}^{\\top}\\mathbf{X}$ 是一个对称矩阵，$(\\mathbf{X}^{\\top}\\mathbf{X})^{\\top} = \\mathbf{X}^{\\top}\\mathbf{X}$，这得到：\n$$\n\\operatorname{Var}(\\hat{\\boldsymbol{\\beta}} | \\mathbf{X}) = \\sigma_{\\varepsilon}^{2} (\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top}\\mathbf{X}(\\mathbf{X}^{\\top}\\mathbf{X})^{-1} = \\sigma_{\\varepsilon}^{2} (\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\n$$\n问题陈述预测变量的总体均值为 $\\mathbf{0}$。对于一个中心化的设计矩阵，预测变量的样本协方差矩阵 $\\mathbf{S}$ 由 $\\mathbf{S} = \\frac{1}{n}\\mathbf{X}^{\\top}\\mathbf{X}$ 给出。因此，$\\mathbf{X}^{\\top}\\mathbf{X} = n\\mathbf{S}$。\n$\\hat{\\boldsymbol{\\beta}}$ 的方差-协方差矩阵则为：\n$$\n\\operatorname{Var}(\\hat{\\boldsymbol{\\beta}} | \\mathbf{X}) = \\sigma_{\\varepsilon}^{2} (n\\mathbf{S})^{-1} = \\frac{\\sigma_{\\varepsilon}^{2}}{n} \\mathbf{S}^{-1}\n$$\n对于这个问题，样本协方差矩阵是一个 $2 \\times 2$ 矩阵：\n$$\n\\mathbf{S} = \\begin{pmatrix} s_{1}^{2}  s_{12} \\\\ s_{12}  s_{2}^{2} \\end{pmatrix}\n$$\n其中 $s_{1}^{2}$ 和 $s_{2}^{2}$ 是 $X_{1}$ 和 $X_{2}$ 的样本方差，$s_{12}$ 是它们的样本协方差。\n$\\mathbf{S}$ 的逆矩阵是：\n$$\n\\mathbf{S}^{-1} = \\frac{1}{s_{1}^{2}s_{2}^{2} - s_{12}^{2}} \\begin{pmatrix} s_{2}^{2}  -s_{12} \\\\ -s_{12}  s_{1}^{2} \\end{pmatrix}\n$$\n$\\hat{\\beta}_{1}$ 的方差，记为 $\\operatorname{Var}(\\hat{\\beta}_{1})$，是矩阵 $\\operatorname{Var}(\\hat{\\boldsymbol{\\beta}} | \\mathbf{X})$ 的 $(1,1)$ 元素：\n$$\n\\operatorname{Var}(\\hat{\\beta}_{1}) = \\frac{\\sigma_{\\varepsilon}^{2}}{n} (\\mathbf{S}^{-1})_{11} = \\frac{\\sigma_{\\varepsilon}^{2}}{n} \\left( \\frac{s_{2}^{2}}{s_{1}^{2}s_{2}^{2} - s_{12}^{2}} \\right)\n$$\n这就是用协方差矩阵元素表示的所需表达式。我们可以使用样本相关系数 $\\rho_{\\text{samp}} = \\frac{s_{12}}{\\sqrt{s_{1}^{2}s_{2}^{2}}}$ 来简化这个表达式。分母可以重写为：\n$$\ns_{1}^{2}s_{2}^{2} - s_{12}^{2} = s_{1}^{2}s_{2}^{2} - (\\rho_{\\text{samp}}\\sqrt{s_{1}^{2}s_{2}^{2}})^{2} = s_{1}^{2}s_{2}^{2}(1 - \\rho_{\\text{samp}}^{2})\n$$\n将此代回方差的表达式中：\n$$\n\\operatorname{Var}(\\hat{\\beta}_{1}) = \\frac{\\sigma_{\\varepsilon}^{2}}{n} \\frac{s_{2}^{2}}{s_{1}^{2}s_{2}^{2}(1 - \\rho_{\\text{samp}}^{2})} = \\frac{\\sigma_{\\varepsilon}^{2}}{n s_{1}^{2}(1 - \\rho_{\\text{samp}}^{2})}\n$$\n现在，我们计算问题所要求的两个方差。\n\n$1$. 实现样本设计下的方差，我们记为 $V_{\\text{samp}}$。\n给定的样本值为 $n=200$，$s_{1}^{2}=4$，$\\rho_{\\text{samp}}=0.99$，以及 $\\sigma_{\\varepsilon}^{2}=1$。\n$$\nV_{\\text{samp}} = \\frac{1}{200 \\cdot 4 \\cdot (1 - 0.99^{2})}\n$$\n\n$2$. 使用总体协方差矩阵计算的方差，我们记为 $V_{\\text{pop}}$。这是一个假设性计算，其中样本统计量被其对应的总体参数所取代。问题陈述边际方差相同，$\\sigma_{1}^{2} = 4$。总体相关系数为 $\\rho_{\\text{pop}} = 0.90$。\n$$\nV_{\\text{pop}} = \\frac{1}{n \\sigma_{1}^{2}(1 - \\rho_{\\text{pop}}^{2})} = \\frac{1}{200 \\cdot 4 \\cdot (1 - 0.90^{2})}\n$$\n\n$V_{\\text{samp}}$ 超过 $V_{\\text{pop}}$ 的乘法因子是比率 $\\frac{V_{\\text{samp}}}{V_{\\text{pop}}}$：\n$$\n\\text{因子} = \\frac{\\frac{\\sigma_{\\varepsilon}^{2}}{n s_{1}^{2}(1 - \\rho_{\\text{samp}}^{2})}}{\\frac{\\sigma_{\\varepsilon}^{2}}{n \\sigma_{1}^{2}(1 - \\rho_{\\text{pop}}^{2})}}\n$$\n由于 $\\sigma_{\\varepsilon}^{2}=1$，$n=200$，且 $s_{1}^{2}=\\sigma_{1}^{2}=4$，这些项可以消去：\n$$\n\\text{因子} = \\frac{1 - \\rho_{\\text{pop}}^{2}}{1 - \\rho_{\\text{samp}}^{2}}\n$$\n代入给定的相关系数值：$\\rho_{\\text{pop}}=0.90$ 和 $\\rho_{\\text{samp}}=0.99$。\n$$\n\\text{因子} = \\frac{1 - 0.90^{2}}{1 - 0.99^{2}} = \\frac{1 - 0.81}{1 - 0.9801} = \\frac{0.19}{0.0199}\n$$\n计算数值：\n$$\n\\text{因子} = 9.54773869...\n$$\n四舍五入到四位有效数字，该因子为 $9.548$。", "answer": "$$\\boxed{9.548}$$", "id": "3159127"}, {"introduction": "除了随机抽样带来的变异性，一个更隐蔽的问题是数据收集过程本身存在偏差。本练习 [@problem_id:3159162] 提出了一个被称为“截断”的情景，即我们只能在结果变量超过某个阈值时才能观察到数据点，这在许多科学和经济研究中是个常见问题。你将推导出这种选择偏差如何系统性地扭曲变量之间估计出的关系，并且更重要的是，你将学会如何从有偏的样本数据中计算出真实的总体关系。", "problem": "一名研究人员希望研究一个大型总体中预测变量 $X$ 和响应变量 $Y$ 之间的线性关系，但抽样机制仅在观测到的响应满足 $|Y| \\ge \\tau$（阈值抽样）时才记录个体。假设 $(X,Y)$ 的总体联合分布为二元正态分布，其均值向量为 $(0,0)$，方差为 $\\operatorname{Var}(X) = \\sigma_{X}^{2}$ 和 $\\operatorname{Var}(Y) = \\sigma_{Y}^{2}$，相关系数为 $\\rho$。$Y$ 对 $X$ 的线性回归的总体斜率定义为 $\\beta_{\\text{pop}} = \\operatorname{Cov}(X,Y)/\\operatorname{Var}(X)$。研究人员在阈值样本中（即在 $|Y| \\ge \\tau$ 的条件下）通过普通最小二乘法（OLS）拟合 $Y$ 对 $X$ 的线性模型，并获得斜率估计值 $\\hat{b}_{t}$。假设样本量足够大，使得 $\\hat{b}_{t}$ 等于其在阈值抽样下的期望值。\n\n从协方差、方差和条件期望的核心定义出发，并利用关于正态分布的成熟性质，推导出阈值样本中的期望 OLS 斜率，作为总体相关系数 $\\rho$、方差 $\\sigma_{X}^{2}$ 和 $\\sigma_{Y}^{2}$ 以及阈值 $\\tau$ 的函数。然后，反解此关系，用观测到的阈值样本斜率 $\\hat{b}_{t}$ 以及已知的总体边际方差和阈值来表示总体斜率 $\\beta_{\\text{pop}}$。最后，根据以下科学上合理的设定，计算校正后的总体斜率 $\\beta_{\\text{pop}}$：\n- $\\sigma_{X} = 10$,\n- $\\sigma_{Y} = 10$,\n- $\\tau = 10$,\n- $\\hat{b}_{t} = 0.6000$。\n\n将最终数值答案四舍五入至四位有效数字。", "solution": "阈值样本中 $Y$ 对 $X$ 回归的 OLS 斜率由其大样本期望 $b_t$ 给出，该值是在条件 $|Y| \\ge \\tau$ 下定义的子总体中的理论斜率。该斜率定义为条件协方差与条件方差之比：\n$$b_t = \\frac{\\operatorname{Cov}(X,Y | |Y| \\ge \\tau)}{\\operatorname{Var}(X | |Y| \\ge \\tau)}$$\n令下标 $t$ 表示在 $|Y| \\ge \\tau$ 条件下的期望，例如 $E_t[\\cdot] = E[\\cdot | |Y| \\ge \\tau]$。则：\n$$b_t = \\frac{E_t[XY] - E_t[X]E_t[Y]}{E_t[X^2] - (E_t[X])^2}$$\n由于 $(X,Y)$ 的联合分布是一个以 $(0,0)$ 为中心的二元正态分布，并且截断条件 $|Y| \\ge \\tau$ 关于 0 是对称的，所以条件均值 $E_t[X]$ 和 $E_t[Y]$ 均为 0。推导如下：给定 $Y=y$ 时 $X$ 的条件均值为 $E[X|Y=y] = \\rho \\frac{\\sigma_X}{\\sigma_Y}y$。根据全期望定律，$E_t[X] = E\\left[\\rho \\frac{\\sigma_X}{\\sigma_Y}Y \\middle| |Y| \\ge \\tau\\right] = \\rho \\frac{\\sigma_X}{\\sigma_Y} E_t[Y]$。由于 $Y$ 的分布和截断条件都是对称的，条件分布 $f(y | |Y| \\ge \\tau)$ 是一个偶函数，因此 $E_t[Y] = \\int y f(y | |Y| \\ge \\tau) dy = 0$。因此，$E_t[X] = 0$。\n斜率表达式简化为：\n$$b_t = \\frac{E_t[XY]}{E_t[X^2]}$$\n我们使用全期望定律计算分子和分母：\n$E_t[XY] = E[Y E[X|Y] | |Y| \\ge \\tau] = E\\left[Y \\left(\\rho \\frac{\\sigma_X}{\\sigma_Y}Y\\right) \\middle| |Y| \\ge \\tau\\right] = \\rho \\frac{\\sigma_X}{\\sigma_Y} E_t[Y^2]$\n$E_t[X^2] = E[E[X^2|Y] | |Y| \\ge \\tau] = E[\\operatorname{Var}(X|Y) + (E[X|Y])^2 | |Y| \\ge \\tau]$\n对于二元正态分布，$\\operatorname{Var}(X|Y=y) = \\sigma_X^2(1-\\rho^2)$ 是一个常数。因此：\n$E_t[X^2] = \\sigma_X^2(1-\\rho^2) + E\\left[\\left(\\rho \\frac{\\sigma_X}{\\sigma_Y}Y\\right)^2 \\middle| |Y| \\ge \\tau\\right] = \\sigma_X^2(1-\\rho^2) + \\rho^2 \\frac{\\sigma_X^2}{\\sigma_Y^2} E_t[Y^2]$\n代入 $b_t$ 的表达式中：\n$$b_t = \\frac{\\rho \\frac{\\sigma_X}{\\sigma_Y} E_t[Y^2]}{\\sigma_X^2(1-\\rho^2) + \\rho^2 \\frac{\\sigma_X^2}{\\sigma_Y^2} E_t[Y^2]}$$\n总体斜率为 $\\beta_{\\text{pop}} = \\frac{\\operatorname{Cov}(X,Y)}{\\operatorname{Var}(X)} = \\rho \\frac{\\sigma_Y}{\\sigma_X}$，因此 $\\rho = \\beta_{\\text{pop}} \\frac{\\sigma_X}{\\sigma_Y}$。令 $C = E_t[Y^2]/\\sigma_Y^2$。代入并整理可得：\n$$b_t = \\beta_{\\text{pop}} \\frac{C}{1-\\rho^2 + \\rho^2 C} = \\beta_{\\text{pop}} \\frac{C}{1+\\rho^2(C-1)}$$\n现在，我们需要反解此关系以求出 $\\beta_{\\text{pop}}$。将 $\\rho$ 的表达式代入：\n$$b_t = \\beta_{\\text{pop}} \\frac{C}{1+\\left(\\beta_{\\text{pop}} \\frac{\\sigma_X}{\\sigma_Y}\\right)^2(C-1)}$$\n这是一个关于 $\\beta_{\\text{pop}}$ 的二次方程：\n$$b_t (C-1) \\left(\\frac{\\sigma_X}{\\sigma_Y}\\right)^2 \\beta_{\\text{pop}}^2 - C \\beta_{\\text{pop}} + b_t = 0$$\n解为：\n$$\\beta_{\\text{pop}} = \\frac{C \\pm \\sqrt{C^2 - 4 b_t^2 (C-1) (\\sigma_X/\\sigma_Y)^2}}{2 b_t (C-1) (\\sigma_X/\\sigma_Y)^2}$$\n为选择正确的根，我们考虑当截断效应消失时（$\\tau \\to 0$），$C \\to 1$ 且我们应有 $\\beta_{\\text{pop}} \\to b_t$。这要求我们选择负号的根。因此，校正后的总体斜率为：\n$$\\beta_{\\text{pop}} = \\frac{C - \\sqrt{C^2 - 4 \\hat{b}_t^2 (C-1) (\\sigma_X/\\sigma_Y)^2}}{2 \\hat{b}_t (C-1) (\\sigma_X/\\sigma_Y)^2}$$\n其中，$\\hat{b}_t$ 是观测到的样本斜率。\n接下来，计算常数 $C$。令 $Z=Y/\\sigma_Y \\sim \\mathcal{N}(0,1)$，$\\alpha = \\tau/\\sigma_Y$。\n$C = E[Z^2 | |Z| \\ge \\alpha] = 1 + \\alpha\\lambda(\\alpha)$，其中 $\\lambda(\\alpha) = \\frac{\\phi(\\alpha)}{1-\\Phi(\\alpha)}$ 是逆米尔斯比率，$\\phi$ 和 $\\Phi$ 分别是标准正态 PDF 和 CDF。\n根据给定数值：$\\sigma_X = 10$，$\\sigma_Y = 10$，$\\tau = 10$，以及 $\\hat{b}_t = 0.6000$。\n比率 $\\sigma_X/\\sigma_Y = 1$。标准化阈值 $\\alpha = \\tau/\\sigma_Y = 10/10 = 1$。\n使用标准正态分布在 $z=1$ 处的数值：$\\phi(1) \\approx 0.24197$ 和 $\\Phi(1) \\approx 0.84134$。\n$\\lambda(1) = \\frac{\\phi(1)}{1-\\Phi(1)} \\approx \\frac{0.24197}{1-0.84134} = \\frac{0.24197}{0.15866} \\approx 1.52514$。\n$C = 1 + \\lambda(1) \\approx 2.52514$。\n将数值代入 $\\beta_{\\text{pop}}$ 的公式：\n判别式 $C^2 - 4 \\hat{b}_t^2 (C-1) (1)^2 \\approx (2.52514)^2 - 4(0.6)^2(1.52514) \\approx 6.3763 - 1.44(1.52514) \\approx 6.3763 - 2.1962 = 4.1801$。\n平方根为 $\\sqrt{4.1801} \\approx 2.04453$。\n$$\\beta_{\\text{pop}} \\approx \\frac{2.52514 - 2.04453}{2 (0.6) (1.52514)} = \\frac{0.48061}{1.83017} \\approx 0.262604$$\n四舍五入到四位有效数字，我们得到 $\\beta_{\\text{pop}} = 0.2626$。正如预期的那样，真实的总体斜率在绝对值上小于在以 $|Y|$ 截断的样本中观察到的斜率。", "answer": "$$\\boxed{0.2626}$$", "id": "3159162"}, {"introduction": "在了解了非随机抽样如何导致有偏结论后，我们现在转向一种强大的修正技术。本练习 [@problem_id:3159121] 介绍了一种“随机缺失”（Missing At Random, MAR）的情况，即观察到数据点标签的可能性取决于该标签的真实值。你将实践逆概率加权（Inverse Probability Weighting, IPW）方法——这是因果推断和调查统计学的基石——从不完整、有偏的样本中获得对总体风险的无偏估计。这个练习为你提供了处理选择偏差最基本方法之一的实践经验。", "problem": "考虑一个二元分类总体 $\\mathcal{P}$，其定义如下。设标签 $Y \\in \\{0,1\\}$ 满足 $\\mathbb{P}(Y=1)=0.4$ 和 $\\mathbb{P}(Y=0)=0.6$。在给定 $Y$ 的条件下，特征 $X \\in \\mathbb{R}$ 的分布为 $X \\mid Y=1 \\sim \\mathcal{N}(2,1)$ 和 $X \\mid Y=0 \\sim \\mathcal{N}(0,1)$。对于一个固定的分类器 $f(x)=\\mathbb{I}\\{x \\ge 1\\}$ 和 $0$-$1$ 损失 $L(y,\\hat{y})=\\mathbb{I}\\{y \\ne \\hat{y}\\}$，总体风险为 $R(f)=\\mathbb{E}[L(Y,f(X))]$。\n\n标签的观测遵循一个与标签相关的随机缺失 (MAR) 机制：对每个个体，一个指示符 $S \\in \\{0,1\\}$ 记录其标签是否被观测到。该机制满足 $S \\perp X \\mid Y$ 且 $s(y)=\\mathbb{P}(S=1 \\mid Y=y)$（其中 $y \\in \\{0,1\\}$），这对分析师是未知的。给定两个独立的样本：\n\n- 一个大小为 $N=1000$ 的主样本，它是从 MAR 机制下的总体 $\\mathcal{P}$ 中独立同分布 (i.i.d.) 抽取的。在这个样本中，所有个体的 $X$ 和 $S$ 都被观测到；只有当 $S=1$ 时，$Y$ 才被观测到。在 $S=1$ 的个体中，有 $278$ 个个体的 $Y=1$，其中 $43$ 个被 $f$ 错误分类；有 $312$ 个个体的 $Y=0$，其中 $50$ 个被 $f$ 错误分类。\n\n- 一个大小为 $M=200$ 的校准样本，它是从总体 $\\mathcal{P}$ 中独立同分布抽取的，其中所有个体的 $Y$ 无论 $S$ 为何值都被观测到，并且 $S$ 也被记录下来。在这个校准样本中，有 $78$ 个个体的 $Y=1$，其中 $56$ 个的 $S=1$；有 $122$ 个个体的 $Y=0$，其中 $63$ 个的 $S=1$。\n\n从概率论和统计学习的核心定义出发，推导一个估计器，该估计器使用从样本中学习到的逆概率加权来重构总体风险 $R(f)$，其中的逆概率从校准样本中估计。然后，使用所提供的数据计算该估计器的数值。将你的最终答案四舍五入到四位有效数字。", "solution": "问题要求使用逆概率加权 (IPW) 方法，为分类器 $f$ 的总体风险 $R(f)$ 推导一个估计器并进行计算。问题为此提供了来自两个样本的数据。\n\n首先，让我们形式化目标量。对于一个使用 $0$-$1$ 损失函数 $L(y, \\hat{y}) = \\mathbb{I}\\{y \\ne \\hat{y}\\}$ 的分类器 $f(x)$，其总体风险 $R(f)$ 是在整个总体 $\\mathcal{P}$ 上的期望损失。\n$$R(f) = \\mathbb{E}[L(Y, f(X))] = \\mathbb{E}[\\mathbb{I}\\{Y \\ne f(X)\\}]$$\n该期望是关于 $(X, Y)$ 的联合分布计算的。使用全期望定律，我们可以将风险表示为：\n$$R(f) = \\mathbb{P}(Y=1)\\mathbb{P}(f(X) \\ne 1 \\mid Y=1) + \\mathbb{P}(Y=0)\\mathbb{P}(f(X) \\ne 0 \\mid Y=0)$$\n设 $p_y = \\mathbb{P}(Y=y)$ 为类别先验概率，$R_y(f) = \\mathbb{P}(f(X) \\ne y \\mid Y=y)$ 为类别条件风险。那么，\n$$R(f) = p_1 R_1(f) + p_0 R_0(f)$$\n问题陈述提供了总体参数 $p_1=0.4$ 和 $p_0=0.6$，以及条件分布 $X \\mid Y=1 \\sim \\mathcal{N}(2,1)$ 和 $X \\mid Y=0 \\sim \\mathcal{N}(0,1)$，但任务是使用提供的样本推导一个估计器，而不是从这些参数计算真实风险。\n\n在大小为 $N=1000$ 的主样本中，个体 $i$ 的真实标签 $Y_i$ 并非总是能被观测到。其观测与否由一个随机指示符 $S_i \\in \\{0,1\\}$ 决定。我们被告知标签是随机缺失 (MAR)，其形式化意义是，给定真实标签 $Y$，标签的观测与特征 $X$ 条件独立。\n$$S \\perp X \\mid Y$$\n观测到标签的概率，也称为倾向得分，仅依赖于真实标签 $y$：\n$$s(y) = \\mathbb{P}(S=1 \\mid Y=y)$$\n由于我们只观测到 $S_i=1$ 的数据，从此数据子集得出的风险的朴素估计是有偏的。逆概率加权是纠正这种选择偏差的标准技术。IPW 的原理依赖于以下恒等式：对于任意函数 $g(X,Y)$，\n$$\\mathbb{E}[g(X,Y)] = \\mathbb{E}\\left[\\frac{S}{s(Y)}g(X,Y)\\right]$$\n这基于 MAR 假设成立：\n$$\\mathbb{E}\\left[\\frac{S}{s(Y)}g(X,Y)\\right] = \\mathbb{E}\\left[\\mathbb{E}\\left[\\frac{S}{s(Y)}g(X,Y) \\mid X, Y\\right]\\right] = \\mathbb{E}\\left[\\frac{g(X,Y)}{s(Y)}\\mathbb{E}[S \\mid X, Y]\\right]$$\n根据 MAR，$\\mathbb{E}[S \\mid X, Y] = \\mathbb{P}(S=1 \\mid X,Y) = \\mathbb{P}(S=1 \\mid Y) = s(Y)$。因此，\n$$\\mathbb{E}\\left[\\frac{g(X,Y)}{s(Y)} s(Y)\\right] = \\mathbb{E}[g(X,Y)]$$\n将此应用于我们的问题，我们设 $g(X,Y) = L(Y, f(X))$。总体风险可以表示为：\n$$R(f) = \\mathbb{E}\\left[\\frac{S}{s(Y)}L(Y, f(X))\\right]$$\n该公式表明，可以基于样本 $\\{(X_i, Y_i, S_i)\\}_{i=1}^N$ 构建一个经验估计器。$R(f)$ 的一个相合估计器是加权损失的样本均值：\n$$\\hat{R}(f) = \\frac{1}{N} \\sum_{i=1}^N \\frac{S_i}{s(Y_i)}L(Y_i, f(X_i))$$\n由于倾向得分 $s(y)$ 是未知的，我们必须估计它们。问题为此提供了一个大小为 $M=200$ 的校准样本，其中 $Y$ 和 $S$ 均被完全观测。设 $M_y$ 是校准样本中标签为 $Y=y$ 的个体数量，$M_{y1}$ 是其中 $S=1$ 的个体数量。$s(y)$ 的最大似然估计器是样本比例：\n$$\\hat{s}(y) = \\frac{M_{y1}}{M_y}$$\n根据校准样本的数据：\n- 对于 $Y=1$：$M_1 = 78$ 且 $M_{11} = 56$。因此，$\\hat{s}(1) = \\frac{56}{78}$。\n- 对于 $Y=0$：$M_0 = 122$ 且 $M_{01} = 63$。因此，$\\hat{s}(0) = \\frac{63}{122}$。\n\n将这些估计值代入风险估计器公式，我们得到实用的 IPW 估计器：\n$$\\hat{R}(f) = \\frac{1}{N} \\sum_{i=1}^N \\frac{S_i}{\\hat{s}(Y_i)} L(Y_i, f(X_i))$$\n该求和仅对 $S_i=1$ 的个体非零。我们可以根据 $Y_i$ 的值将求和分开：\n$$\\hat{R}(f) = \\frac{1}{N} \\left( \\sum_{i: S_i=1, Y_i=1} \\frac{L(1, f(X_i))}{\\hat{s}(1)} + \\sum_{i: S_i=1, Y_i=0} \\frac{L(0, f(X_i))}{\\hat{s}(0)} \\right)$$\n问题提供了主样本中已观测部分里每个类别的总错分数量。\n设 $N_{11,m}$ 为 $S=1$ 且 $Y=1$ 的个体中被错误分类的数量。我们有 $N_{11,m} = 43$。\n设 $N_{01,m}$ 为 $S=1$ 且 $Y=0$ 的个体中被错误分类的数量。我们有 $N_{01,m} = 50$。\n注意 $L(y, f(X_i)) = \\mathbb{I}\\{Y_i \\ne f(X_i)\\}$，所以求和项就是错分的计数：\n$$\\sum_{i: S_i=1, Y_i=1} L(1, f(X_i)) = N_{11,m}$$\n$$\\sum_{i: S_i=1, Y_i=0} L(0, f(X_i)) = N_{01,m}$$\n该估计器简化为：\n$$\\hat{R}(f) = \\frac{1}{N} \\left( \\frac{N_{11,m}}{\\hat{s}(1)} + \\frac{N_{01,m}}{\\hat{s}(0)} \\right)$$\n现在我们代入问题陈述中的数值：\n- 主样本大小：$N = 1000$。\n- 主样本中的错分计数：$N_{11,m} = 43$，$N_{01,m} = 50$。\n- 从校准样本估计的倾向得分：$\\hat{s}(1) = \\frac{56}{78}$ 和 $\\hat{s}(0) = \\frac{63}{122}$。\n\n将这些值代入估计器：\n$$\\hat{R}(f) = \\frac{1}{1000} \\left( \\frac{43}{56/78} + \\frac{50}{63/122} \\right)$$\n$$\\hat{R}(f) = \\frac{1}{1000} \\left( 43 \\times \\frac{78}{56} + 50 \\times \\frac{122}{63} \\right)$$\n我们可以化简分数 $\\frac{78}{56} = \\frac{39}{28}$。\n$$\\hat{R}(f) = \\frac{1}{1000} \\left( \\frac{43 \\times 39}{28} + \\frac{50 \\times 122}{63} \\right)$$\n$$\\hat{R}(f) = \\frac{1}{1000} \\left( \\frac{1677}{28} + \\frac{6100}{63} \\right)$$\n现在我们计算括号内各项的数值：\n$$\\frac{1677}{28} \\approx 59.892857$$\n$$\\frac{6100}{63} \\approx 96.825397$$\n将这些值相加：\n$$59.892857 + 96.825397 = 156.718254$$\n最后，除以 $N=1000$：\n$$\\hat{R}(f) = \\frac{156.718254}{1000} = 0.156718254$$\n问题要求答案四舍五入到四位有效数字。\n$$0.156718254 \\approx 0.1567$$\n这个值是我们对总体风险 $R(f)$ 的最终估计。", "answer": "$$\\boxed{0.1567}$$", "id": "3159121"}]}