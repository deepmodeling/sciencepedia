{"hands_on_practices": [{"introduction": "在深入研究狗腿法的完整路径之前，我们首先要掌握其起点——沿着最速下降方向的移动。本练习要求你计算柯西点（Cauchy point），它是二次模型在梯度反方向上的最优解，但不能超出信赖域的边界。通过解决这个问题[@problem_id:2212704]，你将掌握如何确定狗腿路径的“膝盖”点，这是理解信赖域方法基本原理的关键一步。", "problem": "在数值优化领域，信赖域方法是用于求解非线性规划问题的一类算法。这些方法通过在当前点 $x_k$ 周围一个半径为 $\\Delta$ 的“信赖域”内最小化真实目标函数的一个模型函数 $m(p)$，来迭代地寻找步长 $p$。该模型通常是一个二次近似：\n$$m(p) = f(x_k) + g^T p + \\frac{1}{2} p^T B p$$\n其中 $g$ 是目标函数在 $x_k$ 处的梯度，而 $B$ 是 Hessian 矩阵的一个近似。\n\n许多信赖域算法（如狗腿法）的一个基本组成部分是计算柯西点（Cauchy point）$p_C$。柯西点被定义为沿着最速下降方向最小化二次模型 $m(p)$ 的向量，同时满足步长位于信赖域内的约束，即 $\\|p\\| \\le \\Delta$。\n\n考虑一个优化问题，在当前迭代点，梯度由 $g = \\begin{pmatrix} 3 \\\\ -4 \\end{pmatrix}$ 给出，Hessian 近似为单位矩阵 $B = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$。信赖域半径设置为 $\\Delta = 4$。\n\n计算此场景下的柯西点 $p_C$。你的答案应该是一个包含精确分数的 2x1 列向量。", "solution": "问题要求计算柯西点 $p_C$，它是以下约束优化问题的解：\n$$ \\min_{p} \\quad m(p) = f(x_k) + g^T p + \\frac{1}{2} p^T B p $$\n$$ \\text{subject to} \\quad p = -\\tau g \\text{ for some } \\tau \\ge 0, \\quad \\text{and} \\quad \\|p\\| \\le \\Delta $$\n\n搜索方向是最速下降方向 $d = -g$。沿此方向的任何点都可以参数化为 $p(\\tau) = -\\tau g$，其中标量 $\\tau \\ge 0$。\n\n首先，我们将其代入二次模型 $m(p)$，以获得关于单个变量 $\\tau$ 的函数：\n$$ \\phi(\\tau) = m(-\\tau g) = f(x_k) + g^T(-\\tau g) + \\frac{1}{2} (-\\tau g)^T B (-\\tau g) $$\n$$ \\phi(\\tau) = f(x_k) - \\tau (g^T g) + \\frac{1}{2} \\tau^2 (g^T B g) $$\n常数项 $f(x_k)$ 不影响最小化子，因此我们可以专注于最小化依赖于 $\\tau$ 的部分。\n\n接下来，我们将信赖域约束 $\\|p\\| \\le \\Delta$ 转换为对 $\\tau$ 的约束：\n$$ \\|p(\\tau)\\| = \\|-\\tau g\\| = |\\tau| \\|g\\| = \\tau \\|g\\| \\le \\Delta $$\n由于我们是在下降方向上寻找步长，所以 $\\tau \\ge 0$。因此，对 $\\tau$ 的约束是：\n$$ 0 \\le \\tau \\le \\frac{\\Delta}{\\|g\\|} $$\n\n现在，我们来求解二次函数 $\\phi(\\tau)$ 的无约束最小化子，方法是求其关于 $\\tau$ 的导数并令其为零。这将给出在没有信赖域约束的情况下的最优步长 $\\tau^*$。\n$$ \\frac{d\\phi}{d\\tau} = -g^T g + \\tau (g^T B g) = 0 $$\n求解 $\\tau$，我们得到：\n$$ \\tau^* = \\frac{g^T g}{g^T B g} $$\n二阶导数是 $\\frac{d^2\\phi}{d\\tau^2} = g^T B g$。如果它为正，我们就找到了一个最小值点。\n\n让我们使用给定的值计算所需的量：\n$g = \\begin{pmatrix} 3 \\\\ -4 \\end{pmatrix}$，$B = I = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$，以及 $\\Delta = 4$。\n\n1.  计算 $g^T g$：\n    $g^T g = (3)(3) + (-4)(-4) = 9 + 16 = 25$。\n\n2.  计算 $\\|g\\|$：\n    $\\|g\\| = \\sqrt{g^T g} = \\sqrt{25} = 5$。\n\n3.  计算 $g^T B g$：\n    因为 $B=I$，所以 $g^T B g = g^T I g = g^T g = 25$。\n\n二阶导数 $g^T B g = 25 > 0$，所以 $\\phi(\\tau)$ 是一个凸抛物线，其无约束最小值确实在 $\\tau^*$ 处。\n\n4.  计算无约束最优步长 $\\tau^*$：\n    $$ \\tau^* = \\frac{g^T g}{g^T B g} = \\frac{25}{25} = 1 $$\n\n5.  确定 $\\tau$ 的可行区间：\n    约束为 $0 \\le \\tau \\le \\frac{\\Delta}{\\|g\\|}$。\n    $$ \\frac{\\Delta}{\\|g\\|} = \\frac{4}{5} = 0.8 $$\n    所以，$\\tau$ 的可行区间是 $[0, 0.8]$。\n\n6.  找到约束最优步长 $\\tau_C$。无约束最小化子 $\\tau^* = 1$ 位于可行区间 $[0, 0.8]$ 之外。由于 $\\phi(\\tau)$ 是一个在 $\\tau=1$ 处取得最小值的凸抛物线，它在区间 $[0, 0.8]$ 上的最小值必然出现在离 $\\tau=1$ 最近的边界点。这个点是 $\\tau = 0.8$。\n    因此，柯西点的步长是 $\\tau_C = \\frac{\\Delta}{\\|g\\|} = \\frac{4}{5}$。\n\n7.  计算柯西点 $p_C$：\n    $$ p_C = -\\tau_C g = -\\frac{4}{5} \\begin{pmatrix} 3 \\\\ -4 \\end{pmatrix} = \\begin{pmatrix} -12/5 \\\\ 16/5 \\end{pmatrix} $$\n\n柯西点为 $p_C = \\begin{pmatrix} -12/5 \\\\ 16/5 \\end{pmatrix}$。我们来验证其范数：$\\|p_C\\| = \\sqrt{(-12/5)^2 + (16/5)^2} = \\sqrt{\\frac{144+256}{25}} = \\sqrt{\\frac{400}{25}} = \\sqrt{16} = 4$，它正好等于信赖域半径 $\\Delta$，正如预期。", "answer": "$$\n\\boxed{\n\\begin{pmatrix} -\\frac{12}{5} \\\\ \\frac{16}{5} \\end{pmatrix}\n}\n$$", "id": "2212704"}, {"introduction": "狗腿路径的最终目标是二次模型的无约束最优点，即牛顿点（Newton point）。这个练习将让你专注于计算该点，它代表了在忽略信赖域约束时，模型所能提供的“最理想”下降方向和步长。掌握牛顿点的计算[@problem_id:2212755]对于理解狗腿法如何在保守的梯度下降与激进的牛顿法之间取得平衡至关重要。", "problem": "在一个信赖域优化算法中，在当前迭代点，目标函数被一个形式为 $m(p) = f + g^T p + \\frac{1}{2} p^T B p$ 的二次模型所近似。这个模型描述了从当前点出发，走一步长 $p$ 后目标函数的变化。在许多信赖域策略（例如狗腿法）中，一个关键组成部分是牛顿步，它是该二次模型的无约束极小点。\n\n给定梯度向量 $g = \\begin{pmatrix} -4 \\\\ 6 \\end{pmatrix}$ 和一个正定Hessian近似矩阵 $B = \\begin{pmatrix} 2  0 \\\\ 0  3 \\end{pmatrix}$，计算该二次模型的牛顿步 $p_B$。", "solution": "牛顿步是二次模型 $m(p) = f + g^{T} p + \\frac{1}{2} p^{T} B p$ 的无约束极小点。对于一个对称正定的 $B$，通过将关于 $p$ 的梯度设为零可以得到一阶最优性条件：\n$$\n\\nabla m(p) = g + B p = 0.\n$$\n这就得到了线性系统\n$$\nB p_{B} = -g,\n$$\n所以牛顿步为\n$$\np_{B} = -B^{-1} g.\n$$\n当 $g = \\begin{pmatrix} -4 \\\\ 6 \\end{pmatrix}$ 且 $B = \\begin{pmatrix} 2  0 \\\\ 0  3 \\end{pmatrix}$ 时，其逆矩阵为\n$$\nB^{-1} = \\begin{pmatrix} \\frac{1}{2}  0 \\\\ 0  \\frac{1}{3} \\end{pmatrix}.\n$$\n因此，\n$$\nB^{-1} g = \\begin{pmatrix} \\frac{1}{2}  0 \\\\ 0  \\frac{1}{3} \\end{pmatrix} \\begin{pmatrix} -4 \\\\ 6 \\end{pmatrix} = \\begin{pmatrix} -2 \\\\ 2 \\end{pmatrix},\n$$\n并且\n$$\np_{B} = - \\begin{pmatrix} -2 \\\\ 2 \\end{pmatrix} = \\begin{pmatrix} 2 \\\\ -2 \\end{pmatrix}.\n$$", "answer": "$$\\boxed{\\begin{pmatrix} 2 \\\\ -2 \\end{pmatrix}}$$", "id": "2212755"}, {"introduction": "在分别计算了柯西点和牛顿点之后，真正的挑战在于如何将它们组合起来，根据信赖域的大小 $\\Delta$ 确定最终的步长 $p$。这个练习模拟了编写优化程序时所面临的核心决策过程，要求你选择正确的条件逻辑来构建完整的狗腿法。完成这个任务[@problem_id:2212701]，意味着你不仅理解了各个组成部分，更掌握了将这些部分融合成一个高效算法的精髓。", "problem": "在数值优化领域，信赖域方法是一类用于求解无约束非线性规划问题的算法。在每次迭代中，它们在当前点周围定义一个“信赖域”，在此区域内，目标函数的模型（通常是二次近似）被认为是可靠的。然后，算法在该信赖域内寻找一个使该模型最小化的步长。\n\n狗腿法（dogleg method）是近似求解此信赖域子问题的一种常用技术。该子问题是找到一个步长向量 $p$，以最小化二次模型\n$$m(p) = f_k + g^T p + \\frac{1}{2} p^T B p$$\n其约束条件为 $\\|p\\|_2 \\le \\Delta$，其中 $g$ 是目标函数的梯度，$B$ 是对Hessian矩阵的正定近似，$\\Delta > 0$ 是信赖域半径。所有向量和矩阵都在当前迭代点 $x_k$ 处进行计算。\n\n狗腿法通过考虑一条分段线性路径来构造一个试验步长 $p$。这条路径连接了原点、沿最速下降方向的无约束极小点，以及完整二次模型的无约束极小点。这两个关键点是：\n1.  拟牛顿步（quasi-Newton step），$p^B = -B^{-1}g$，它是 $m(p)$ 的无约束极小点。\n2.  最速下降步（steepest-descent step），$p^U = -\\frac{g^T g}{g^T B g}g$，它是 $m(p)$ 沿着负梯度 $-g$ 方向的极小点。\n\n你的任务是选择正确的条件逻辑块，程序将使用该逻辑块根据信赖域半径 $\\Delta$ 以及 $p^B$ 和 $p^U$ 的欧几里得范数来确定试验步长 $p$。为便于解决此问题，假设 `norm(v)` 计算欧几里得范数 $\\|v\\|_2$。\n\n以下哪个伪代码片段正确地实现了选择狗腿步长 $p$ 的逻辑？\n\nA.\n```\nIF norm(pB) = delta:\n  Set p = pB\nELSE:\n  IF norm(pU) >= delta:\n    Set p = delta * (pU / norm(pU))\n  ELSE:\n    // Find scalar tau >= 0 such that ||pU + tau*(pB - pU)|| = delta\n    Set p = pU + tau*(pB - pU)\n```\n\nB.\n```\nIF norm(pB) = delta:\n  Set p = pB\nELSE:\n  Set p = delta * (pB / norm(pB))\n```\n\nC.\n```\nIF norm(pB) = delta:\n  Set p = pB\nELSE:\n  Set p = delta * (pU / norm(pU))\n```\n\nD.\n```\nIF norm(pB) = delta:\n  Set p = pB\nELSE:\n  IF norm(pU)  delta:\n    // Find scalar tau >= 0 such that ||pU + tau*(pB - pU)|| = delta\n    Set p = pU + tau*(pB - pU)\n  ELSE:\n    Set p = delta * (pU / norm(pU))\n```\n\nE.\n```\nIF norm(pU) >= delta:\n  Set p = delta * (pU / norm(pU))\nELSE:\n  IF norm(pB) = delta:\n    Set p = pB\n  ELSE:\n    // Find scalar tau >= 0 such that ||pU + tau*(pB - pU)|| = delta\n    Set p = pU + tau*(pB - pU)\n```", "solution": "我们正在求解二次模型的信赖域子问题\n$$\nm(p) = f_{k} + g^{T}p + \\frac{1}{2} p^{T} B p\n$$\n其约束条件为 $\\|p\\|_{2} \\le \\Delta$，其中 $B$ 是正定的。狗腿法构造了一条分段线性路径，该路径由两段组成：从原点到最速下降（Cauchy）步 $p^{U}$，然后从 $p^{U}$ 到拟牛顿步 $p^{B}$。定义如下\n$$\np^{B} = -B^{-1} g, \\quad p^{U} = -\\frac{g^{T} g}{g^{T} B g}\\, g.\n$$\n\n正确的选择逻辑遵循由信赖域半径 $\\Delta$ 以及 $p^{B}$ 和 $p^{U}$ 的范数决定的三个互斥情况：\n\n1) 如果 $\\|p^{B}\\|_{2} \\le \\Delta$，那么无约束极小点 $p^{B}$ 是可行的。由于 $B$ 是正定的，$p^{B}$ 是 $m(p)$ 在所有 $p$ 上的唯一极小点，并且由于它是可行的，因此它也是有约束的极小点。所以，设\n$$\np = p^{B}.\n$$\n\n2) 否则，如果 $\\|p^{B}\\|_{2} > \\Delta$ 且 $\\|p^{U}\\|_{2} \\ge \\Delta$，那么信赖域边界与狗腿路径的第一段（从 $0$ 到 $p^{U}$）相交。在该边界上，沿此段的最优步长可通过缩放 $p^{U}$ 使其长度为 $\\Delta$ 来获得：\n$$\np = \\Delta \\frac{p^{U}}{\\|p^{U}\\|_{2}}.\n$$\n\n3) 否则，如果 $\\|p^{B}\\|_{2} > \\Delta$ 且 $\\|p^{U}\\|_{2}  \\Delta$，那么信赖域边界与第二段（从 $p^{U}$ 到 $p^{B}$）相交。我们找到唯一的 $\\tau \\in [0,1]$ 使得\n$$\n\\|p^{U} + \\tau (p^{B} - p^{U})\\|_{2} = \\Delta,\n$$\n并设\n$$\np = p^{U} + \\tau (p^{B} - p^{U}).\n$$\n\n与选项进行比较：\n- 选项A完全实现了这个逻辑：首先检查 $\\|p^{B}\\|_{2} \\le \\Delta$，否则如果 $\\|p^{U}\\|_{2} \\ge \\Delta$，则将 $p^{U}$ 缩放到边界，否则沿着从 $p^{U}$ 到 $p^{B}$ 的狗腿段求解 $\\tau$。\n- 选项B在 $p^{B}$ 位于外部时错误地缩放了 $p^{B}$，忽略了狗腿路径和 $p^{U}$ 的作用。\n- 选项C在 $p^{B}$ 位于外部时，即使 $\\|p^{U}\\|_{2}  \\Delta$ 也总是错误地缩放 $p^{U}$，但这并不在第一段边界交叉点上。\n- 选项D颠倒了 $p^{U}$ 的边界情况：它在 $\\|p^{U}\\|_{2}  \\Delta$ 时缩放 $p^{U}$，这是不正确的；在这种情况下，边界位于第二段上，需要使用 $\\tau$ 进行插值。\n- 选项E在检查 $\\|p^{B}\\|_{2} \\le \\Delta$ 之前检查 $\\|p^{U}\\|_{2} \\ge \\Delta$，这可能导致即使 $p^{B}$ 是可行的，也选择缩放后的 $p^{U}$；这违反了只要 $p^{B}$ 位于信赖域内就应选择它的规则。\n\n因此，正确的伪代码片段是选项A。", "answer": "$$\\boxed{A}$$", "id": "2212701"}]}