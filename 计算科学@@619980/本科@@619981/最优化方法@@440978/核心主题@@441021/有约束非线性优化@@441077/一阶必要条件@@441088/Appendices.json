{"hands_on_practices": [{"introduction": "本练习将把抽象的拉格朗日乘子法理论置于一个清晰的几何问题中。我们将看到，目标函数梯度必须与约束函数梯度平行这一一阶必要条件，如何转化为一个直观的概念：一个点到曲线上最近点的连线，必然与该曲线在该点处垂直（即法向）。通过求解一个点到椭圆的最短距离问题 [@problem_id:3129605]，这个练习将为理解约束优化打下坚实的几何直觉基础。", "problem": "考虑一个等式约束优化问题，该问题旨在最小化一个固定点到椭圆的欧几里得距离的平方。设目标函数为 $f(x_{1},x_{2}) = (x_{1}-y_{1})^{2} + (x_{2}-y_{2})^{2}$，约束条件为椭圆 $g(x_{1},x_{2}) = \\frac{x_{1}^{2}}{a^{2}} + \\frac{x_{2}^{2}}{b^{2}} - 1 = 0$，其中 $a0$ 且 $b0$。局部约束最小化点的一个具有物理意义的必要条件是，目标函数沿可行方向的一阶变分为零。从这一基本论述以及 $f$ 和 $g$ 的可微性出发，推导候选最小化点 $(x_{1}^{\\star},x_{2}^{\\star})$ 及其拉格朗日乘子 $\\mu^{\\star}$ 所需满足的一阶必要条件（拉格朗日条件），并解释为什么这些条件意味着从 $y$ 到最优点（优化器）的位移向量与椭圆在 $(x_{1}^{\\star},x_{2}^{\\star})$ 处的法向量对齐。\n\n然后，将此方法应用于参数为 $a=4$，$b=3$ 且点为 $y=(9,0)$ 的具体实例，即，\n$$\n\\min_{(x_{1},x_{2})\\in\\mathbb{R}^{2}} \\;\\; (x_{1}-9)^{2} + (x_{2}-0)^{2} \\quad \\text{subject to} \\quad \\frac{x_{1}^{2}}{16} + \\frac{x_{2}^{2}}{9} = 1.\n$$\n仅使用您推导的一阶必要条件，求出距离平方的最小值。请以单个精确数值的形式提供最终答案，无需四舍五入。", "solution": "我们从等式约束优化的基本论述开始：如果 $f:\\mathbb{R}^{n}\\to\\mathbb{R}$ 和 $g:\\mathbb{R}^{n}\\to\\mathbb{R}$ 是可微的，并且 $x^{\\star}$ 是 $f$ 在约束 $g(x)=0$ 下的局部最小化点，且 $\\nabla g(x^{\\star})\\neq 0$，那么 $f$ 在 $x^{\\star}$ 处沿任何可行方向的一阶变分必须为零。$x^{\\star}$ 处的可行方向 $d$ 满足线性化约束 $\\nabla g(x^{\\star})^{\\top} d = 0$。因此，对于每一个这样的 $d$，$f$ 在 $x^{\\star}$ 处沿 $d$ 的方向导数必须满足 $\\nabla f(x^{\\star})^{\\top} d = 0$。这意味着 $\\nabla f(x^{\\star})$ 与每一个与 $\\nabla g(x^{\\star})$ 正交的向量 $d$ 都正交，这便得出了经典的拉格朗日条件\n$$\n\\nabla f(x^{\\star}) + \\mu^{\\star} \\nabla g(x^{\\star}) = 0\n$$\n对于某个标量 $\\mu^{\\star}\\in\\mathbb{R}$，以及可行性条件 $g(x^{\\star})=0$。这些是等式约束问题的一阶必要条件（拉格朗日条件）。\n\n对于我们的具体问题，$f(x_{1},x_{2}) = (x_{1}-y_{1})^{2} + (x_{2}-y_{2})^{2}$ 且 $y=(9,0)$，所以 $f(x_{1},x_{2})=(x_{1}-9)^{2}+x_{2}^{2}$。约束条件是 $g(x_{1},x_{2})=\\frac{x_{1}^{2}}{16}+\\frac{x_{2}^{2}}{9}-1=0$。梯度为\n$$\n\\nabla f(x_{1},x_{2}) = \\begin{pmatrix} 2(x_{1}-9) \\\\ 2 x_{2} \\end{pmatrix}, \\quad\n\\nabla g(x_{1},x_{2}) = \\begin{pmatrix} \\frac{2 x_{1}}{16} \\\\ \\frac{2 x_{2}}{9} \\end{pmatrix} = \\begin{pmatrix} \\frac{x_{1}}{8} \\\\ \\frac{2 x_{2}}{9} \\end{pmatrix}.\n$$\n一阶必要（拉格朗日）条件为：\n$$\n\\begin{cases}\n2(x_{1}-9) + \\mu \\cdot \\frac{x_{1}}{8} = 0, \\\\\n2 x_{2} + \\mu \\cdot \\frac{2 x_{2}}{9} = 0, \\\\\n\\frac{x_{1}^{2}}{16} + \\frac{x_{2}^{2}}{9} = 1.\n\\end{cases}\n$$\n第二个平稳性方程可以写成\n$$\n2 x_{2} \\left( 1 + \\frac{\\mu}{9} \\right) = 0,\n$$\n这意味着要么 $x_{2}=0$，要么 $\\mu = -9$。如果 $\\mu=-9$，第一个平稳性方程变为\n$$\n2(x_{1}-9) - 9 \\cdot \\frac{x_{1}}{8} = 0 \\;\\;\\Longleftrightarrow\\;\\; 16(x_{1}-9) - 9 x_{1} = 0 \\;\\;\\Longleftrightarrow\\;\\; 7 x_{1} = 144 \\;\\;\\Longleftrightarrow\\;\\; x_{1} = \\frac{144}{7}.\n$$\n这个候选解不满足约束条件，因为\n$$\n\\frac{x_{1}^{2}}{16} \\;=\\; \\frac{(144/7)^{2}}{16} \\;=\\; \\frac{20736}{49 \\cdot 16} \\;\\; 1,\n$$\n所以不存在 $\\mu=-9$ 的可行点。因此，我们必须有 $x_{2}=0$。\n\n将 $x_{2}=0$ 代入约束条件得到\n$$\n\\frac{x_{1}^{2}}{16} = 1 \\;\\;\\Longrightarrow\\;\\; x_{1} = \\pm 4.\n$$\n我们现在使用第一个平稳性方程来确定相应的拉格朗日乘子，并验证其关于最优性的可行性。对于 $x_{1}=4$，\n$$\n2(4-9) + \\mu \\cdot \\frac{4}{8} = 0 \\;\\;\\Longleftrightarrow\\;\\; -10 + \\frac{\\mu}{2} = 0 \\;\\;\\Longleftrightarrow\\;\\; \\mu = 20.\n$$\n对于 $x_{1}=-4$，\n$$\n2(-4-9) + \\mu \\cdot \\frac{-4}{8} = 0 \\;\\;\\Longleftrightarrow\\;\\; -26 - \\frac{\\mu}{2} = 0 \\;\\;\\Longleftrightarrow\\;\\; \\mu = -52.\n$$\n两个候选解都满足平稳性和可行性条件；为了选出最小化点，我们计算目标函数值：\n$$\nf(4,0) = (4-9)^{2} + 0^{2} = 25, \\quad f(-4,0) = (-4-9)^{2} + 0^{2} = 169.\n$$\n因此，最小化点为 $(x_{1}^{\\star},x_{2}^{\\star})=(4,0)$，最小距离平方为 $25$。\n\n几何解释（法向对齐）：平稳性条件 $\\nabla f(x^{\\star}) + \\mu^{\\star} \\nabla g(x^{\\star})=0$ 可以改写为\n$$\n2\\big(x^{\\star} - y\\big) = - \\mu^{\\star} \\nabla g(x^{\\star}),\n$$\n这表明从 $y$ 到最优点 $x^{\\star}$ 的位移向量与约束的法向量 $\\nabla g(x^{\\star})$ 共线。这表示从 $y$ 到最近点的线段在切点处与椭圆垂直。\n\n因此，距离平方的最小值为 $25$。", "answer": "$$\\boxed{25}$$", "id": "3129605"}, {"introduction": "在简单的等式约束基础上，本练习引入了完整的卡罗需-库恩-塔克（KKT）条件，以同时处理等式和不等式约束。通过求解一个点在概率单纯形上的投影——这是机器学习和统计学中的一个常见任务 [@problem_id:3129540]——你将学会如何运用强大的互补松弛性条件。该条件提供了一种系统性的方法，来确定在最优解处哪些不等式约束是“激活”的（即以等式成立）。", "problem": "考虑在一个概率单纯形上最小化一个凸可微目标函数。令 $\\Delta^{5} \\subset \\mathbb{R}^{5}$ 表示集合 $\\Delta^{5} = \\{ p \\in \\mathbb{R}^{5} \\,:\\, \\mathbf{1}^{\\top} p = 1,\\; p \\ge 0 \\}$，其中不等式是按分量解释的。定义函数 $f: \\mathbb{R}^{5} \\to \\mathbb{R}$ 为\n$$\nf(p) = \\frac{1}{2}\\sum_{i=1}^{5} \\big(p_{i} - v_{i}\\big)^{2},\n$$\n其中 $v \\in \\mathbb{R}^{5}$ 是一个给定的数据向量。优化问题是\n$$\n\\min_{p \\in \\mathbb{R}^{5}} \\; f(p) \\quad \\text{subject to} \\quad \\mathbf{1}^{\\top} p = 1,\\;\\; p \\ge 0,\n$$\n也就是，在单纯形 $\\Delta^{5}$ 上最小化到 $v$ 的欧几里得距离的平方。\n\n任务：\n1) 仅从等式和不等式约束的拉格朗日函数定义以及一阶必要条件的概念出发，推导该问题的完整 Karush-Kuhn-Tucker (KKT) 条件。明确写出稳定性、原始可行性、对偶可行性和互补松弛性条件。\n\n2) 利用互补松弛性，解释如何确定优化器的哪些坐标变为零。提供一个逻辑论证，将对偶变量的符号与原始变量的零模式联系起来。\n\n3) 对于具体向量 $v = (0.7,\\; 0.6,\\; 0.4,\\; 0.1,\\; -0.2)$，精确求解 KKT 系统以获得优化器 $p^{\\star} \\in \\Delta^{5}$。将你的最终答案表示为精确的有理数。不需要四舍五入。", "solution": "该问题要求在一个由线性等式和不等式约束定义的凸集上最小化一个凸可微函数。Karush-Kuhn-Tucker (KKT) 条件为解的最优性提供了一阶必要条件。由于该问题是凸的，这些必要条件也是最优性的充分条件。\n\n### 任务 1: KKT 条件的推导\n\n优化问题可以写成标准形式：\n$$\n\\min_{p \\in \\mathbb{R}^{5}} f(p) = \\frac{1}{2}\\sum_{i=1}^{5} (p_{i} - v_{i})^{2}\n$$\n约束条件为：\n$$\nh(p) = \\sum_{i=1}^{5} p_i - 1 = 0 \\\\\ng_i(p) = -p_i \\le 0 \\quad \\text{for } i = 1, \\dots, 5\n$$\n拉格朗日函数 $L(p, \\lambda, \\mu)$ 是通过将目标函数与约束的加权和相加而构成的。我们将一个拉格朗日乘子 $\\lambda \\in \\mathbb{R}$ 与等式约束关联，并将一个拉格朗日乘子向量 $\\mu \\in \\mathbb{R}^5$ 与不等式约束关联，其中 $\\mu = (\\mu_1, \\dots, \\mu_5)$。\n$$\nL(p, \\lambda, \\mu) = f(p) + \\lambda h(p) + \\sum_{i=1}^{5} \\mu_i g_i(p)\n$$\n代入具体的函数，我们得到：\n$$\nL(p, \\lambda, \\mu) = \\frac{1}{2}\\sum_{i=1}^{5} (p_{i} - v_{i})^{2} + \\lambda \\left(\\sum_{i=1}^{5} p_i - 1\\right) + \\sum_{i=1}^{5} \\mu_i (-p_i)\n$$\nKKT 条件是在最优点 $p^{\\star}$ 及其对应的乘子 $\\lambda^{\\star}$ 和 $\\mu^{\\star}$ 处必须满足的一组四个条件。\n\n1.  **稳定性 (Stationarity)**：拉格朗日函数关于原始变量 $p$ 的梯度必须为零。对于每个分量 $p_i$，我们有：\n    $$\n    \\frac{\\partial L}{\\partial p_i} = (p_i^{\\star} - v_i) + \\lambda^{\\star} - \\mu_i^{\\star} = 0, \\quad \\text{for } i = 1, \\dots, 5\n    $$\n2.  **原始可行性 (Primal Feasibility)**：点 $p^{\\star}$ 必须满足所有约束。\n    $$\n    \\sum_{i=1}^{5} p_i^{\\star} = 1 \\\\\n    p_i^{\\star} \\ge 0, \\quad \\text{for } i = 1, \\dots, 5\n    $$\n3.  **对偶可行性 (Dual Feasibility)**：与不等式约束相关的拉格朗日乘子必须为非负。\n    $$\n    \\mu_i^{\\star} \\ge 0, \\quad \\text{for } i = 1, \\dots, 5\n    $$\n4.  **互补松弛性 (Complementary Slackness)**：每个不等式乘子与其对应的约束函数的乘积必须为零。\n    $$\n    \\mu_i^{\\star} g_i(p^{\\star}) = \\mu_i^{\\star} (-p_i^{\\star}) = 0, \\quad \\text{for } i = 1, \\dots, 5\n    $$\n    这等价于 $\\mu_i^{\\star} p_i^{\\star} = 0$。\n\n### 任务 2: 互补松弛性的作用\n\n互补松弛性条件，即对于每个 $i \\in \\{1, \\dots, 5\\}$ 都有 $\\mu_i p_i = 0$，是确定解结构的关键。由于 $p_i \\ge 0$（原始可行性）和 $\\mu_i \\ge 0$（对偶可行性），条件 $\\mu_i p_i = 0$ 意味着对于每个索引 $i$，$p_i$ 或 $\\mu_i$ 中至少有一个必须为零。\n\n我们通过将互补松弛性与稳定性条件 $p_i = v_i - \\lambda + \\mu_i$ 相结合来分析其含义。\n\n- **情况 1：优化器的第 $i$ 个坐标为严格正值，即 $p_i  0$。**\n  根据互补松弛性 ($\\mu_i p_i = 0$)，我们必须有 $\\mu_i = 0$。将 $\\mu_i = 0$ 代入稳定性方程得到 $p_i = v_i - \\lambda$。因为我们假设 $p_i  0$，所以必须有 $v_i - \\lambda  0$，这意味着 $v_i  \\lambda$。\n  因此，如果最优解的一个分量 $p_i$ 是正的，其对应的拉格朗日乘子 $\\mu_i$ 就是零，并且其在数据向量 $v_i$ 中的值必须严格大于乘子 $\\lambda$。\n\n- **情况 2：优化器的第 $i$ 个坐标为零，即 $p_i = 0$。**\n  在这种情况下，对于任何 $\\mu_i \\ge 0$，互补松弛性 ($\\mu_i p_i = 0$) 都得到满足。稳定性方程变为 $0 = v_i - \\lambda + \\mu_i$，这意味着 $\\mu_i = \\lambda - v_i$。对偶可行性条件要求 $\\mu_i \\ge 0$，所以我们必须有 $\\lambda - v_i \\ge 0$，这意味着 $v_i \\le \\lambda$。\n  因此，如果最优解的一个分量 $p_i$ 是零，相应的值 $v_i$ 必须小于或等于乘子 $\\lambda$。\n\n总而言之，拉格朗日乘子 $\\lambda$ 作为一个阈值。对于任何给定的分量 $i$：\n- 如果 $v_i  \\lambda$，那么 $p_i  0$ 且 $\\mu_i=0$。\n- 如果 $v_i \\le \\lambda$，那么 $p_i = 0$ 且 $\\mu_i \\ge 0$。\n\n这为找到解提供了一个清晰的步骤：找到 $\\lambda$ 的值，该值能正确地划分索引 $i$，并且满足求和约束 $\\sum p_i = 1$。\n\n### 任务 3: 求解优化器 $p^{\\star}$\n\n给定向量 $v = (0.7, 0.6, 0.4, 0.1, -0.2)$。\n从任务 2 的分析可知，最优解 $p^{\\star}$ 必须满足：如果 $p_i^{\\star}  0$，则 $p_i^{\\star} = v_i - \\lambda^{\\star}$；如果 $v_i \\le \\lambda^{\\star}$，则 $p_i^{\\star} = 0$。这可以紧凑地写成：\n$$\np_i^{\\star} = \\max(0, v_i - \\lambda^{\\star})\n$$\n$\\lambda^{\\star}$ 的值由原始可行性约束 $\\sum_{i=1}^{5} p_i^{\\star} = 1$ 确定：\n$$\n\\sum_{i=1}^{5} \\max(0, v_i - \\lambda^{\\star}) = 1\n$$\n我们需要求解这个关于 $\\lambda^{\\star}$ 的方程。函数 $g(\\lambda) = \\sum_{i=1}^{5} \\max(0, v_i - \\lambda)$ 是一个关于 $\\lambda$ 的连续、分段线性和单调递减的函数。$\\lambda$ 存在唯一解。一个系统的方法是将 $v$ 的分量按降序排序（它们已经是这样了），并假设 $p^{\\star}$ 的哪些分量是非零的。令 $I_{+} = \\{ i \\mid p_i^{\\star}0 \\}$。对于一个假设的集合 $I_{+}$，我们有当 $i \\notin I_{+}$ 时 $p_i^{\\star}=0$，当 $i \\in I_{+}$ 时 $p_i^{\\star} = v_i - \\lambda^{\\star}$。求和约束变为：\n$$\n\\sum_{i \\in I_{+}} (v_i - \\lambda^{\\star}) = 1 \\implies \\sum_{i \\in I_{+}} v_i - |I_{+}| \\lambda^{\\star} = 1\n$$\n这给出了一个基于假设的活动集 $I_{+}$ 计算 $\\lambda^{\\star}$ 的公式：\n$$\n\\lambda^{\\star} = \\frac{1}{|I_{+}|} \\left( \\sum_{i \\in I_{+}} v_i - 1 \\right)\n$$\n然后我们必须检查这个 $\\lambda^{\\star}$ 的值是否与我们的集合 $I_{+}$ 一致，即对于所有 $i \\in I_{+}$ 是否有 $v_i  \\lambda^{\\star}$，以及对于所有 $i \\notin I_{+}$ 是否有 $v_i \\le \\lambda^{\\star}$。\n\n让我们首先假设只有 $v$ 中值最大的分量会对应于非零的 $p_i$。让我们尝试 $I_{+} = \\{1, 2, 3\\}$，这意味着我们假设 $p_1^{\\star}, p_2^{\\star}, p_3^{\\star}  0$ 并且 $p_4^{\\star}, p_5^{\\star}=0$。\n首先，我们将 $v$ 转换为有理数：$v = (\\frac{7}{10}, \\frac{6}{10}, \\frac{4}{10}, \\frac{1}{10}, -\\frac{2}{10})$。\n在这个假设下， $|I_{+}| = 3$。对应的 $v_i$ 之和是：\n$$\n\\sum_{i \\in I_{+}} v_i = \\frac{7}{10} + \\frac{6}{10} + \\frac{4}{10} = \\frac{17}{10}\n$$\n现在，我们计算 $\\lambda^{\\star}$：\n$$\n\\lambda^{\\star} = \\frac{1}{3} \\left( \\frac{17}{10} - 1 \\right) = \\frac{1}{3} \\left( \\frac{17}{10} - \\frac{10}{10} \\right) = \\frac{1}{3} \\left( \\frac{7}{10} \\right) = \\frac{7}{30}\n$$\n接下来，我们检查一致性。\n对于 $i \\in I_{+} = \\{1, 2, 3\\}$，必须有 $v_i  \\lambda^{\\star} = \\frac{7}{30}$。\n- $v_1 = \\frac{7}{10} = \\frac{21}{30}$。$\\frac{21}{30}  \\frac{7}{30}$ 吗？是。\n- $v_2 = \\frac{6}{10} = \\frac{18}{30}$。$\\frac{18}{30}  \\frac{7}{30}$ 吗？是。\n- $v_3 = \\frac{4}{10} = \\frac{12}{30}$。$\\frac{12}{30}  \\frac{7}{30}$ 吗？是。\n\n对于 $i \\notin I_{+} = \\{4, 5\\}$，必须有 $v_i \\le \\lambda^{\\star} = \\frac{7}{30}$。\n- $v_4 = \\frac{1}{10} = \\frac{3}{30}$。$\\frac{3}{30} \\le \\frac{7}{30}$ 吗？是。\n- $v_5 = -\\frac{2}{10} = -\\frac{6}{30}$。$-\\frac{6}{30} \\le \\frac{7}{30}$ 吗？是。\n\n所有条件都满足。我们对 $I_{+}$ 的假设是正确的。现在我们可以计算优化器 $p^{\\star}$ 的分量。\n\n- 对于 $i \\in \\{1, 2, 3\\}$，$p_i^{\\star} = v_i - \\lambda^{\\star}$：\n  $$\n  p_1^{\\star} = \\frac{7}{10} - \\frac{7}{30} = \\frac{21 - 7}{30} = \\frac{14}{30} = \\frac{7}{15} \\\\\n  p_2^{\\star} = \\frac{6}{10} - \\frac{7}{30} = \\frac{18 - 7}{30} = \\frac{11}{30} \\\\\n  p_3^{\\star} = \\frac{4}{10} - \\frac{7}{30} = \\frac{12 - 7}{30} = \\frac{5}{30} = \\frac{1}{6}\n  $$\n- 对于 $i \\in \\{4, 5\\}$，$p_i^{\\star} = 0$：\n  $$\n  p_4^{\\star} = 0 \\\\\n  p_5^{\\star} = 0\n  $$\n作为最后检查，我们确认 $\\sum p_i^{\\star} = 1$：\n$$\n\\frac{7}{15} + \\frac{11}{30} + \\frac{1}{6} + 0 + 0 = \\frac{14}{30} + \\frac{11}{30} + \\frac{5}{30} = \\frac{14 + 11 + 5}{30} = \\frac{30}{30} = 1\n$$\n条件成立。优化器是 $p^{\\star} = (\\frac{7}{15}, \\frac{11}{30}, \\frac{1}{6}, 0, 0)$。", "answer": "$$ \\boxed{p^\\star = \\left(\\frac{7}{15}, \\frac{11}{30}, \\frac{1}{6}, 0, 0\\right)} $$", "id": "3129540"}, {"introduction": "最后一个练习旨在连接理论条件与实际应用，要求你编写一段程序。你将实现一个数值测试，通过检验目标函数梯度 $ \\nabla f(\\mathbf{x}) $ 与约束流形切空间的正交性，来验证一个点是否满足一阶平稳性条件 [@problem_id:3129549]。这个练习强调了理论原理可以转化为具体的算法，这在现代计算科学和工程中是一项至关重要的技能。", "problem": "给定形式为以下等式约束的最小化问题：最小化一个可微标量函数 $f(\\mathbf{x})$，约束条件为一个可微约束 $g(\\mathbf{x}) = 0$，其中 $\\mathbf{x}$ 位于适当维度的欧几里得空间中。根据约束最小化的基本定义和方向导数的概念，正则可行点的平稳性一阶必要条件要求 $f$ 沿每个可行方向（与由 $g(\\mathbf{x})=0$ 定义的流形相切）的方向导数为零。等价地，在这样的点上，目标函数的梯度 $ \\nabla f(\\mathbf{x}) $ 与流形的切空间正交，这意味着它位于由约束生成的法空间中。\n\n您的任务是通过投影实现对该平稳性条件的数值检验：对于每个指定的问题和候选点 $ \\mathbf{x}^\\star $，在指定容差内，计算 $ \\nabla f(\\mathbf{x}^\\star) $ 沿着在 $ \\mathbf{x}^\\star $ 处流形 $ g(\\mathbf{x}) = 0 $ 的切空间的分量是否可以忽略不计。除了检验平稳性，还要确保点 $ \\mathbf{x}^\\star $ 是可行的，并且流形在该点是正则的，即 $ \\lVert \\nabla g(\\mathbf{x}^\\star) \\rVert_2  0 $。\n\n使用以下容差：可行性容差 $ \\varepsilon_{\\text{feas}} = 10^{-9} $ 和平稳性容差 $ \\varepsilon_{\\text{stat}} = 10^{-9} $。如果 $ \\lvert g(\\mathbf{x}^\\star) \\rvert \\le \\varepsilon_{\\text{feas}} $，则认为候选点是可行的。当 $ \\nabla f(\\mathbf{x}^\\star) $ 投影到切空间上的分量的欧几里得范数至多为 $ \\varepsilon_{\\text{stat}} $ 时，平稳性检验应返回布尔值 $ \\text{True} $；否则返回 $ \\text{False} $。如果 $ \\lVert \\nabla g(\\mathbf{x}^\\star) \\rVert_2 = 0 $（一个非正则点），则返回 $ \\text{False} $。\n\n实现程序以评估以下测试套件。对于每种情况，都提供了 $ f $、$ g $ 和 $ \\mathbf{x}^\\star $。梯度必须通过解析计算得出。\n\n- 测试用例 1（二维线性约束，预期为平稳点）：\n  $f_1(x,y) = x^2 + y^2$， $g_1(x,y) = x + y - 1$， $\\mathbf{x}_1^\\star = \\left(\\frac{1}{2}, \\frac{1}{2}\\right)$。\n\n- 测试用例 2（二维线性约束，可行但非平稳点）：\n  $f_1(x,y) = x^2 + y^2$， $g_1(x,y) = x + y - 1$， $\\mathbf{x}_2^\\star = (1, 0)$。\n\n- 测试用例 3（二维圆形约束与各向异性目标函数，平稳点）：\n  $f_2(x,y) = x^2 + 4y^2$， $g_2(x,y) = x^2 + y^2 - 1$， $\\mathbf{x}_3^\\star = (1, 0)$。\n\n- 测试用例 4（三维平面约束，平稳点）：\n  $f_3(x,y,z) = x^2 + y^2 + z^2$， $g_3(x,y,z) = x + 2y + 3z - 6$， $\\mathbf{x}_4^\\star = \\left(\\frac{3}{7}, \\frac{6}{7}, \\frac{9}{7}\\right)$。\n\n- 测试用例 5（二维退化约束于一个可行点，非正则，应被拒绝）：\n  $f_4(x,y) = x^2 + y^2$， $g_4(x,y) = x^3$， $\\mathbf{x}_5^\\star = (0, 1)$。\n\n- 测试用例 6（二维圆形约束与各向异性目标函数，不可行点）：\n  $f_2(x,y) = x^2 + 4y^2$， $g_2(x,y) = x^2 + y^2 - 1$， $\\mathbf{x}_6^\\star = \\left(\\frac{1}{2}, \\frac{1}{2}\\right)$。\n\n您的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，按测试用例 1 到 6 的顺序排列，例如 $[\\text{True},\\text{False},\\dots]$。", "solution": "该问题要求对一个等式约束优化问题在候选点 $\\mathbf{x}^\\star$ 处的平稳性一阶必要条件进行数值验证，该优化问题的形式为：\n$$ \\text{minimize } f(\\mathbf{x}) \\quad \\text{subject to } g(\\mathbf{x}) = 0 $$\n其中 $f: \\mathbb{R}^n \\to \\mathbb{R}$ 和 $g: \\mathbb{R}^n \\to \\mathbb{R}$ 是可微函数。\n\n验证过程涉及三个主要检查：点的可行性、约束流形在该点的正则性以及平稳性条件本身。\n\n**1. 理论基础：一阶必要条件**\n\n一个点 $\\mathbf{x}^\\star$ 只有在满足一阶必要条件（通常称为 Karush-Kuhn-Tucker (KKT) 条件）时，才可能是局部最小值点。对于只有一个等式约束的问题，这些条件有清晰的几何解释。\n\n约束 $g(\\mathbf{x}) = 0$ 在 $\\mathbb{R}^n$ 中定义了一个流形（一个曲面、曲线等）。如果一个点 $\\mathbf{x}^\\star$ 位于这个流形上，即 $g(\\mathbf{x}^\\star) = 0$，则该点是可行的。\n\n在一个可行点 $\\mathbf{x}^\\star$ 处，约束函数的梯度 $\\nabla g(\\mathbf{x}^\\star)$ 是一个与该点处流形的切空间正交（法向）的向量。如果该梯度非零，即 $\\nabla g(\\mathbf{x}^\\star) \\neq \\mathbf{0}$，则称该点是*正则*的。如果一个点是正则的，$\\nabla g(\\mathbf{x}^\\star)$ 张成一维的*法空间*。所有与 $\\nabla g(\\mathbf{x}^\\star)$ 正交的向量集合构成了 $(n-1)$ 维的*切空间*，其中包含了从 $\\mathbf{x}^\\star$ 出发的所有可行运动方向。\n\n约束优化的核心原则是，在局部最小值点 $\\mathbf{x}^\\star$ 处，目标函数 $f$ 在任何可行方向上都不能减小。这意味着 $f$ 在任何与约束流形相切的方向上的方向导数必须为零。$f$ 在方向 $\\mathbf{d}$ 上的方向导数由 $\\nabla f(\\mathbf{x}^\\star) \\cdot \\mathbf{d}$ 给出。要使此值对于切空间中的所有向量 $\\mathbf{d}$ 都为零，目标函数的梯度 $\\nabla f(\\mathbf{x}^\\star)$ 必须与切空间正交。\n\n如果 $\\nabla f(\\mathbf{x}^\\star)$ 与切空间正交，它就必须位于法空间中。由于在一个正则点，法空间是由 $\\nabla g(\\mathbf{x}^\\star)$ 张成的，因此平稳性条件等价于陈述 $\\nabla f(\\mathbf{x}^\\star)$ 和 $\\nabla g(\\mathbf{x}^\\star)$ 必须共线。也就是说，必须存在一个标量 $\\lambda$（拉格朗日乘子），使得：\n$$ \\nabla f(\\mathbf{x}^\\star) + \\lambda \\nabla g(\\mathbf{x}^\\star) = \\mathbf{0} $$\n这等价于 $\\nabla f(\\mathbf{x}^\\star) = -\\lambda \\nabla g(\\mathbf{x}^\\star)$。\n\n**2. 通过投影进行数值验证**\n\n该问题要求通过将目标梯度 $\\nabla f(\\mathbf{x}^\\star)$ 投影到切空间上，并检查结果是否为近似零向量，来验证此平稳性条件。\n\n令 $\\mathbf{v} = \\nabla f(\\mathbf{x}^\\star)$ 且 $\\mathbf{n} = \\nabla g(\\mathbf{x}^\\star)$。\n假设 $\\mathbf{n} \\neq \\mathbf{0}$（正则性），任何向量 $\\mathbf{v}$ 都可以唯一地分解为一个与 $\\mathbf{n}$ 平行（在法空间中）的分量和一个与 $\\mathbf{n}$ 正交（在切空间中）的分量。\n\n$\\mathbf{v}$ 在法空间中的分量是它在 $\\mathbf{n}$ 上的投影：\n$$ \\mathbf{v}_{\\text{norm}} = \\text{proj}_{\\mathbf{n}}(\\mathbf{v}) = \\frac{\\mathbf{v} \\cdot \\mathbf{n}}{\\mathbf{n} \\cdot \\mathbf{n}} \\mathbf{n} = \\frac{\\langle \\mathbf{v}, \\mathbf{n} \\rangle}{\\lVert \\mathbf{n} \\rVert_2^2} \\mathbf{n} $$\n\n$\\mathbf{v}$ 在切空间中的分量 $\\mathbf{v}_{\\text{tan}}$ 是减去法向分量后剩下的部分：\n$$ \\mathbf{v}_{\\text{tan}} = \\mathbf{v} - \\mathbf{v}_{\\text{norm}} = \\mathbf{v} - \\frac{\\langle \\mathbf{v}, \\mathbf{n} \\rangle}{\\lVert \\mathbf{n} \\rVert_2^2} \\mathbf{n} $$\n\n平稳性条件 $\\nabla f(\\mathbf{x}^\\star) \\in \\text{span}\\{\\nabla g(\\mathbf{x}^\\star)\\}$ 成立，当且仅当 $\\nabla f(\\mathbf{x}^\\star)$ 的切向分量为零向量。在数值上，我们测试其欧几里得范数是否低于给定容差 $\\varepsilon_{\\text{stat}}$：\n$$ \\lVert \\mathbf{v}_{\\text{tan}} \\rVert_2 \\le \\varepsilon_{\\text{stat}} $$\n\n**3. 完整的验证算法**\n\n对于每个测试用例（由函数 $f$、$g$ 和点 $\\mathbf{x}^\\star$ 定义），我们按顺序执行以下检查，使用指定的容差 $\\varepsilon_{\\text{feas}} = 10^{-9}$ 和 $\\varepsilon_{\\text{stat}} = 10^{-9}$。\n\n1.  **可行性检查**：评估 $g(\\mathbf{x}^\\star)$。如果 $\\lvert g(\\mathbf{x}^\\star) \\rvert  \\varepsilon_{\\text{feas}}$，则该点不可行。平稳性条件不适用。测试失败，返回 `False`。\n\n2.  **正则性检查**：计算约束梯度 $\\mathbf{n} = \\nabla g(\\mathbf{x}^\\star)$。如果 $\\lVert \\mathbf{n} \\rVert_2 = 0$，则该点非正则。检验的几何基础无效。测试失败，返回 `False`。\n\n3.  **平稳性检查**：如果点既可行又正则，则继续计算目标梯度的切向分量。\n    a. 计算目标梯度 $\\mathbf{v} = \\nabla f(\\mathbf{x}^\\star)$。\n    b. 计算切向分量：$\\mathbf{v}_{\\text{tan}} = \\mathbf{v} - \\frac{\\langle \\mathbf{v}, \\mathbf{n} \\rangle}{\\lVert \\mathbf{n} \\rVert_2^2} \\mathbf{n}$。\n    c. 计算其欧几里得范数：$\\lVert \\mathbf{v}_{\\text{tan}} \\rVert_2$。\n    d. 如果 $\\lVert \\mathbf{v}_{\\text{tan}} \\rVert_2 \\le \\varepsilon_{\\text{stat}}$，则满足平稳性条件。测试通过，返回 `True`。否则，测试失败，返回 `False`。\n\n**4. 测试用例的解析梯度**\n\n问题要求解析计算梯度。\n\n- 对于 $f_1(x,y) = x^2 + y^2$ 和 $f_4(x,y) = x^2 + y^2$：$\\nabla f(x,y) = (2x, 2y)^T$。\n- 对于 $g_1(x,y) = x + y - 1$：$\\nabla g_1(x,y) = (1, 1)^T$。\n- 对于 $f_2(x,y) = x^2 + 4y^2$：$\\nabla f_2(x,y) = (2x, 8y)^T$。\n- 对于 $g_2(x,y) = x^2 + y^2 - 1$：$\\nabla g_2(x,y) = (2x, 2y)^T$。\n- 对于 $f_3(x,y,z) = x^2 + y^2 + z^2$：$\\nabla f_3(x,y,z) = (2x, 2y, 2z)^T$。\n- 对于 $g_3(x,y,z) = x + 2y + 3z - 6$：$\\nabla g_3(x,y,z) = (1, 2, 3)^T$。\n- 对于 $g_4(x,y) = x^3$：$\\nabla g_4(x,y) = (3x^2, 0)^T$。\n\n这些梯度将在实现中使用，以对每个测试用例执行验证算法。", "answer": "[True, False, True, True, False, False]", "id": "3129549"}]}