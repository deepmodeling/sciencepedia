{"hands_on_practices": [{"introduction": "在处理不确定性时，机会约束规划是一个强大的工具。本练习将带你入门，解决一个核心问题：当资源供给服从正态分布时，如何将其对应的机会约束转化为一个确定性的线性约束。通过解决这个在量子计算公司的资源调度问题[@problem_id:2177257]，你将掌握机会约束规划中最基本也是最重要的转换技巧，即如何利用正态分布的分位数来确保决策在一定概率下是可行的。", "problem": "一家尖端的量子软件即服务（SaaS）公司向外部客户提供其量子处理器上的计算时间。公司为客户运行两种主要的混合量子-经典作业：变分量子本征求解器（VQE）作业和量子近似优化算法（QAOA）作业。运营主管需要确定每天运行每种类型作业的最佳数量，以在多种资源限制下最大化收入。\n\n设 $x_1$ 为每天安排的VQE作业数量，$x_2$ 为每天安排的QAOA作业数量。公司的收入由目标函数 $Z = 10000x_1 + 4000x_2$ 给出，单位为美元。\n\n日程安排受以下约束条件限制：\n1.  **量子比特-小时容量：** 公司的量子处理器具有确定性的每日总容量，为180个量子比特-小时。每个VQE作业需要1个量子比特-小时，每个QAOA作业需要2个量子比特-小时。\n2.  **经典CPU约束：** 两种算法都需要一个在共享高性能计算集群上运行的经典优化循环。由于其他内部进程的不可预测需求，总可用中央处理器（CPU）时间 $B_C$ 是随机的。其可用性由一个正态分布建模，均值为 $\\mu_C = 183$ 核小时，标准差为 $\\sigma_C = 20$ 核小时。每个VQE作业需要2个核小时，每个QAOA作业需要3个核小时。运营团队要求安排的作业能够完成的概率至少为95%。\n3.  **控制系统约束：** 这些作业还依赖于一个专门用于量子比特控制的现场可编程门阵列（FPGA），其可用处理时间 $B_S$ 也是随机的。它遵循一个正态分布，均值为 $\\mu_S = 279$ 时间单位，标准差为 $\\sigma_S = 25$ 时间单位。每个VQE作业消耗4个时间单位，每个QAOA作业消耗1个时间单位。团队要求满足此资源约束的概率至少为97.5%。\n\n在计算中，您可以使用以下事实：对于标准正态随机变量 $Z \\sim N(0, 1)$，其 $\\alpha$-分位点 $z_\\alpha$ 是满足 $P(Z \\le z_\\alpha) = \\alpha$ 的值。所需的分位点为 $z_{0.05} = -1.65$ 和 $z_{0.025} = -1.96$。\n\n假设 $x_1$ 和 $x_2$ 可以是非整数值（代表部分完成或批量处理的作业），确定可能的最大日收入。用美元表示您的答案。", "solution": "我们在确定性约束和机会约束下，最大化线性收入函数 $Z = 10000 x_{1} + 4000 x_{2}$。\n\n确定性的量子比特-小时容量约束为 $x_{1} + 2 x_{2} \\leq 180$。\n\n对于CPU机会约束，设 $L_{C} = 2 x_{1} + 3 x_{2}$ 为所需的核小时数，$B_{C} \\sim N(\\mu_{C}, \\sigma_{C}^{2})$（其中 $\\mu_{C} = 183$ 且 $\\sigma_{C} = 20$）为可用的核小时数。要求是 $P(B_{C} \\geq L_{C}) \\geq 0.95$。这等价于 $P(B_{C} \\leq L_{C}) \\leq 0.05$。用 $Z \\sim N(0,1)$ 进行标准化，得到\n$$\nP\\!\\left(Z \\leq \\frac{L_{C} - \\mu_{C}}{\\sigma_{C}}\\right) \\leq 0.05 \\quad \\Longrightarrow \\quad \\frac{L_{C} - \\mu_{C}}{\\sigma_{C}} \\leq z_{0.05}.\n$$\n因此 $L_{C} \\leq \\mu_{C} + \\sigma_{C} z_{0.05}$。使用 $z_{0.05} = -1.65$，\n$$\n2 x_{1} + 3 x_{2} \\leq 183 + 20(-1.65) = 150.\n$$\n\n对于FPGA机会约束，设 $L_{S} = 4 x_{1} + x_{2}$ 且 $B_{S} \\sim N(\\mu_{S}, \\sigma_{S}^{2})$（其中 $\\mu_{S} = 279$ 且 $\\sigma_{S} = 25$）。要求是 $P(B_{S} \\geq L_{S}) \\geq 0.975$，即 $P(B_{S} \\leq L_{S}) \\leq 0.025$。标准化后得到\n$$\n\\frac{L_{S} - \\mu_{S}}{\\sigma_{S}} \\leq z_{0.025},\n$$\n所以 $L_{S} \\leq \\mu_{S} + \\sigma_{S} z_{0.025}$。使用 $z_{0.025} = -1.96$，\n$$\n4 x_{1} + x_{2} \\leq 279 + 25(-1.96) = 230.\n$$\n\n完整的线性规划问题是\n$$\n\\text{maximize } Z = 10000 x_{1} + 4000 x_{2}\n$$\n约束条件为\n$$\nx_{1} + 2 x_{2} \\leq 180,\\quad 2 x_{1} + 3 x_{2} \\leq 150,\\quad 4 x_{1} + x_{2} \\leq 230,\\quad x_{1} \\geq 0,\\ x_{2} \\geq 0.\n$$\n\n我们通过联立紧约束来寻找候选的最优顶点：\n1) $2 x_{1} + 3 x_{2} = 150$ 和 $4 x_{1} + x_{2} = 230$ 的交点：\n从 $4 x_{1} + x_{2} = 230$ 可得 $x_{2} = 230 - 4 x_{1}$。代入 $2 x_{1} + 3 x_{2} = 150$：\n$$\n2 x_{1} + 3(230 - 4 x_{1}) = 150 \\Longrightarrow 2 x_{1} + 690 - 12 x_{1} = 150 \\Longrightarrow -10 x_{1} = -540 \\Longrightarrow x_{1} = 54.\n$$\n则 $x_{2} = 230 - 4 \\cdot 54 = 14$。该点满足 $x_{1} + 2 x_{2} = 54 + 28 = 82 \\leq 180$。\n\n2) $2 x_{1} + 3 x_{2} = 150$ 与坐标轴的交点：$(x_{1}, x_{2}) = (0,50)$ 和 $(75,0)$。点 $(75,0)$ 不满足 $4 x_{1} + x_{2} \\leq 230$ 因为 $300 > 230$，故该点不可行。点 $(0,50)$ 是可行的。\n\n3) $4 x_{1} + x_{2} = 230$ 与坐标轴的交点：$(x_{1}, x_{2}) = (57.5,0)$ 和 $(0,230)$。点 $(0,230)$ 不满足 $2 x_{1} + 3 x_{2} \\leq 150$ 因为 $690 > 150$，故该点不可行。点 $(57.5,0)$ 是可行的。\n\n对于这些候选点，其余的界限和约束 $x_{1} + 2 x_{2} \\leq 180$ 都是非紧的。计算目标函数值：\n- 在点 $(54,14)$：$Z = 10000 \\cdot 54 + 4000 \\cdot 14 = 540000 + 56000 = 596000$。\n- 在点 $(57.5,0)$：$Z = 10000 \\cdot 57.5 = 575000$。\n- 在点 $(0,50)$：$Z = 4000 \\cdot 50 = 200000$。\n- 在点 $(0,0)$：$Z = 0$。\n\n因此，最大收入在点 $(x_{1}, x_{2}) = (54, 14)$ 处取得，为 $Z = 596000$ 美元。", "answer": "$$\\boxed{596000}$$", "id": "2177257"}, {"introduction": "现实世界中的不确定性并非总是符合优美的正态分布。本练习[@problem_id:3107905]将探讨一个更贴近实际的离散随机变量场景，即计算一个投资组合的二氧化碳排放上限。你将通过直接处理二项分布来计算精确的排放上限，并将其与基于中心极限定理（Central Limit Theorem, CLT）的正态近似结果进行比较，从而深刻理解近似方法在实践中的有效性与偏差。", "problem": "一位规划者必须为一个包含 $N=25$ 个相同单元的组合设定单日二氧化碳 (CO$_2$) 排放上限。对于单元 $i$，其单位产出的排放因子是不确定的：有 $p=0.2$ 的概率处于高排放状态，排放因子为 $e_H=2.0$ tCO$_2$/单位；有 $1-p=0.8$ 的概率处于低排放状态，排放因子为 $e_L=1.2$ tCO$_2$/单位。各单元的状态是相互独立的。决策向量为 $x \\in \\mathbb{R}^{25}$，其分量对所有 $i$ 均为 $x_i=1$，因此总排放量是随机和 $e(\\xi)^{\\top}x=\\sum_{i=1}^{25} e_i(\\xi)$。规划者施加了机会约束\n$$\n\\mathbb{P}\\!\\left(e(\\xi)^{\\top}x \\le E\\right) \\ge 1-\\alpha,\n$$\n其中可靠性水平为 $1-\\alpha=0.95$，上限为 $E$。\n\n从基本的概率定义和分布事实出发，完成以下任务：\n1) 通过处理高排放单元数量的精确分布，推导满足机会约束的精确最小上限 $E_{\\text{exact}}$。\n2) 使用中心极限定理 (CLT) 对二项分布进行正态近似（不使用连续性校正），以获得在相同可靠性水平下的近似上限 $E_{\\text{norm}}$。您可以使用由 $\\Phi(z_{0.95})=0.95$ 定义的标准正态分位数 $z_{0.95}$，其中 $\\Phi(\\cdot)$ 是标准正态分布的累积分布函数。\n3) 计算数值差异\n$$\n\\Delta \\;=\\; E_{\\text{norm}} - E_{\\text{exact}}.\n$$\n\n将您最终的 $\\Delta$ 数值答案四舍五入到四位有效数字。结果以公吨二氧化碳 (tCO$_2$) 表示。在最终答案框中仅报告数字，不要包含单位。", "solution": "### 解答推导\n\n总排放量 $S = e(\\xi)^{\\top}x$ 取决于处于高排放状态的单元数量。设 $K$ 为代表处于高排放状态的单元数量的随机变量。由于 $N=25$ 个单元是相同的，且它们的状态是独立的，每个单元处于高排放状态的概率为 $p=0.2$，因此 $K$ 服从二项分布。\n$$\nK \\sim \\text{Binomial}(n=N, p) = \\text{Binomial}(25, 0.2)\n$$\n$K$ 的概率质量函数由 $\\mathbb{P}(K=k) = \\binom{25}{k} (0.2)^k (0.8)^{25-k}$ 给出，其中 $k \\in \\{0, 1, \\dots, 25\\}$。\n\n总排放量 $S$ 可以表示为 $K$ 的函数。当所有 $i$ 的 $x_i=1$ 时，有 $K$ 个单元以 $e_H$ 的速率排放，有 $N-K$ 个单元以 $e_L$ 的速率排放。\n$$\nS(K) = K \\cdot e_H + (N-K) \\cdot e_L = K(e_H - e_L) + N e_L\n$$\n代入给定值 $e_H=2.0$，$e_L=1.2$ 和 $N=25$：\n$$\nS(K) = K(2.0 - 1.2) + 25(1.2) = 0.8K + 30\n$$\n由于 $e_H > e_L$，$S(K)$ 是 $K$ 的严格递增函数。\n\n机会约束为 $\\mathbb{P}(S \\le E) \\ge 1-\\alpha$，其中 $1-\\alpha = 0.95$。代入 $S$ 的表达式：\n$$\n\\mathbb{P}(0.8K + 30 \\le E) \\ge 0.95 \\implies \\mathbb{P}\\left(K \\le \\frac{E-30}{0.8}\\right) \\ge 0.95\n$$\n\n**1) 精确最小上限 $E_{\\text{exact}}$ 的推导**\n\n为了找到满足约束的最小上限 $E_{\\text{exact}}$，我们需要找到最小的整数 $k_{\\text{crit}}$，使得 $K$ 的累积分布函数 (CDF) $F_K(k) = \\mathbb{P}(K \\le k)$ 达到或超过可靠性水平 $1-\\alpha=0.95$。\n$$\nk_{\\text{crit}} = \\min \\{ k \\in \\mathbb{Z}_{\\ge 0} \\mid \\mathbb{P}(K \\le k) \\ge 0.95 \\}\n$$\n我们计算 $K \\sim \\text{Binomial}(25, 0.2)$ 的累积概率：\n$F_K(k) = \\sum_{j=0}^{k} \\binom{25}{j} (0.2)^j (0.8)^{25-j}$。\n- $\\mathbb{P}(K \\le 7) = \\sum_{j=0}^{7} \\binom{25}{j} (0.2)^j (0.8)^{25-j} \\approx 0.89087  0.95$\n- $\\mathbb{P}(K \\le 8) = \\sum_{j=0}^{8} \\binom{25}{j} (0.2)^j (0.8)^{25-j} \\approx 0.95321 \\ge 0.95$\n\n最小的整数是 $k_{\\text{crit}}=8$。如果 $(E-30)/0.8 \\ge k_{\\text{crit}}$，则约束 $\\mathbb{P}(K \\le (E-30)/0.8) \\ge 0.95$ 得到满足。为了找到最小上限，我们设 $(E_{\\text{exact}}-30)/0.8 = k_{\\text{crit}}$。\n$$\nE_{\\text{exact}} - 30 = 0.8 \\cdot k_{\\text{crit}} \\implies E_{\\text{exact}} = 0.8 \\cdot 8 + 30 = 6.4 + 30 = 36.4\n$$\n所以，精确最小上限是 $E_{\\text{exact}} = 36.4$ tCO$_2$。\n\n**2) 近似上限 $E_{\\text{norm}}$ 的推导**\n\n我们使用中心极限定理来近似总排放量 $S = \\sum_{i=1}^{N} e_i$ 的分布。这个和由 $N=25$ 个独立同分布的随机变量 $e_i$ 组成。单个单元的排放量 $e_i$ 具有以下分布：\n$$\ne_i = \\begin{cases} e_H = 2.0  \\text{概率为 } p=0.2 \\\\ e_L = 1.2  \\text{概率为 } 1-p=0.8 \\end{cases}\n$$\n$e_i$ 的均值是：\n$$\n\\mu_e = \\mathbb{E}[e_i] = p \\cdot e_H + (1-p) \\cdot e_L = 0.2(2.0) + 0.8(1.2) = 0.4 + 0.96 = 1.36\n$$\n$e_i$ 的方差是 $\\sigma_e^2 = \\mathbb{E}[e_i^2] - (\\mathbb{E}[e_i])^2$：\n$$\n\\mathbb{E}[e_i^2] = p \\cdot e_H^2 + (1-p) \\cdot e_L^2 = 0.2(2.0^2) + 0.8(1.2^2) = 0.2(4) + 0.8(1.44) = 0.8 + 1.152 = 1.952\n$$\n$$\n\\sigma_e^2 = 1.952 - (1.36)^2 = 1.952 - 1.8496 = 0.1024\n$$\n根据中心极限定理，和 $S = \\sum_{i=1}^{25} e_i$ 近似服从均值为 $\\mu_S = N\\mu_e$、方差为 $\\sigma_S^2 = N\\sigma_e^2$ 的正态分布。\n$$\n\\mu_S = 25 \\times 1.36 = 34\n$$\n$$\n\\sigma_S^2 = 25 \\times 0.1024 = 2.56 \\implies \\sigma_S = \\sqrt{2.56} = 1.6\n$$\n因此，$S \\approx \\mathcal{N}(\\mu_S=34, \\sigma_S^2=2.56)$。机会约束近似为：\n$$\n\\mathbb{P}(S \\le E) \\ge 0.95\n$$\n为了找到最小上限 $E_{\\text{norm}}$，我们基于连续正态近似将不等式视为等式：\n$$\n\\mathbb{P}(S \\le E_{\\text{norm}}) = 0.95\n$$\n对正态变量进行标准化：\n$$\n\\mathbb{P}\\left(\\frac{S - \\mu_S}{\\sigma_S} \\le \\frac{E_{\\text{norm}} - \\mu_S}{\\sigma_S}\\right) = 0.95\n$$\n设 $Z = (S-\\mu_S)/\\sigma_S \\sim \\mathcal{N}(0,1)$。该方程变为 $\\Phi\\left(\\frac{E_{\\text{norm}} - \\mu_S}{\\sigma_S}\\right) = 0.95$，其中 $\\Phi$ 是标准正态分布的 CDF。这意味着：\n$$\n\\frac{E_{\\text{norm}} - \\mu_S}{\\sigma_S} = z_{0.95}\n$$\n解出 $E_{\\text{norm}}$：\n$$\nE_{\\text{norm}} = \\mu_S + z_{0.95} \\cdot \\sigma_S = 34 + z_{0.95} \\cdot (1.6)\n$$\n\n**3) 差异 $\\Delta$ 的计算**\n\n我们现在计算差异 $\\Delta = E_{\\text{norm}} - E_{\\text{exact}}$。\n$$\n\\Delta = (34 + 1.6 z_{0.95}) - 36.4 = 1.6 z_{0.95} - 2.4\n$$\n标准正态分布的 $95^{\\text{th}}$ 百分位的标准值是 $z_{0.95} \\approx 1.6448536$。\n$$\n\\Delta \\approx 1.6 \\times 1.6448536 - 2.4 = 2.63176576 - 2.4 = 0.23176576\n$$\n将结果四舍五入到四位有效数字：\n$$\n\\Delta \\approx 0.2318\n$$\n该值的单位是公吨二氧化碳，tCO$_2$。", "answer": "$$\n\\boxed{0.2318}\n$$", "id": "3107905"}, {"introduction": "当处理多个随机约束时，一个诱人的捷径是将它们聚合成一个单一的约束。本练习揭示了这种方法的潜在危险，特别是当随机变量相互依赖时。通过构建一个简单而有力的反例[@problem_id:3107959]，你将认识到为什么联合机会约束（joint chance constraint）不能被轻易地替换为聚合约束，这对于建立严谨可靠的优化模型至关重要。", "problem": "考虑一个包含$2$个随机线性约束的联合机会约束优化模型，这些约束由一个二元随机向量 $\\boldsymbol{\\xi} = (\\xi_{1}, \\xi_{2})$ 驱动。该联合机会约束要求\n$$\n\\mathbb{P}\\left(\\xi_{1} x \\le b_{1},\\ \\xi_{2} x \\le b_{2}\\right) \\ge 1 - \\alpha,\n$$\n其中 $x \\in \\mathbb{R}$ 是决策变量，$b_{1}, b_{2} \\in \\mathbb{R}$ 是确定性界限，$\\alpha \\in (0,1)$ 是风险水平。一种常见的松弛方法是将左侧项进行聚合，并施加一个单一的机会约束\n$$\n\\mathbb{P}\\left(\\xi_{1} x + \\xi_{2} x \\le b_{1} + b_{2}\\right) \\ge 1 - \\alpha.\n$$\n从“机会约束要求所述事件满足的概率至少为 $1 - \\alpha$”这一基本定义出发，构造一个反例，以揭示当分布表现出尾部相关结构时，用聚合后的单一机会约束替代联合机会约束会如何产生误导。使用以下科学上合理的设定：\n\n- 设 $U \\sim \\mathrm{Unif}(0,1)$ 是一个在 $[0,1]$ 上服从均匀分布的标量随机变量。\n- 定义 $\\xi_{1} := 2U$ 和 $\\xi_{2} := 2(1-U)$，使得 $(\\xi_{1}, \\xi_{2})$ 具有完全负尾相关性（极端值以相反的模式出现）。\n- 固定 $x := 1$，$b_{1} := 1$，$b_{2} := 1$，并选择任意 $\\alpha \\in (0,1)$。\n\n在此设定下：\n1. 从第一性原理计算 $\\mathbb{P}\\left(\\xi_{1} + \\xi_{2} \\le 2\\right)$ 和 $\\mathbb{P}\\left(\\xi_{1} \\le 1,\\ \\xi_{2} \\le 1\\right)$。\n2. 为了量化聚合的误导性，定义\n$$\n\\Delta := \\mathbb{P}\\left(\\xi_{1} + \\xi_{2} \\le 2\\right) - \\mathbb{P}\\left(\\xi_{1} \\le 1,\\ \\xi_{2} \\le 1\\right).\n$$\n计算 $\\Delta$ 的精确值。\n\n你的最终答案必须是等于 $\\Delta$ 的单个实数。不需要四舍五入。", "solution": "该问题要求计算一个特定量 $\\Delta$，它在一个特定的概率模型下衡量了联合机会约束与其聚合松弛形式之间的概率差异，该模型旨在突显这种松弛方法的缺陷。该模型由一个二元随机向量 $(\\xi_{1}, \\xi_{2})$ 定义，其分量是单个潜在均匀随机变量 $U \\sim \\mathrm{Unif}(0,1)$ 的函数。参数固定为 $x=1$，$b_{1}=1$ 和 $b_{2}=1$。\n\n首先，我们必须评估与聚合约束相关的概率：\n$$ \\mathbb{P}\\left(\\xi_{1} x + \\xi_{2} x \\le b_{1} + b_{2}\\right) $$\n代入给定值 $x=1$，$b_{1}=1$ 和 $b_{2}=1$，表达式变为：\n$$ \\mathbb{P}\\left(\\xi_{1} + \\xi_{2} \\le 2\\right) $$\n随机变量 $\\xi_{1}$ 和 $\\xi_{2}$ 定义为：\n$$ \\xi_{1} := 2U $$\n$$ \\xi_{2} := 2(1-U) $$\n我们可以通过代入这些定义直接计算和 $\\xi_{1} + \\xi_{2}$：\n$$ \\xi_{1} + \\xi_{2} = 2U + 2(1-U) = 2U + 2 - 2U = 2 $$\n和 $\\xi_{1} + \\xi_{2}$ 是一个常数值 $2$，与随机变量 $U$ 的取值无关。因此，概率内的事件是 $\\xi_{1} + \\xi_{2} \\le 2$，这等价于陈述 $2 \\le 2$。这是一个必然事件，即一个总是为真的事件。根据定义，必然事件的概率是 $1$。\n$$ \\mathbb{P}\\left(\\xi_{1} + \\xi_{2} \\le 2\\right) = 1 $$\n\n其次，我们评估原始联合机会约束的概率：\n$$ \\mathbb{P}\\left(\\xi_{1} x \\le b_{1}, \\xi_{2} x \\le b_{2}\\right) $$\n代入相同的参数值，我们得到：\n$$ \\mathbb{P}\\left(\\xi_{1} \\le 1, \\xi_{2} \\le 1\\right) $$\n这是两个事件交集的概率。我们必须将这些事件转化为关于潜在随机变量 $U$ 的条件。\n第一个事件 $\\xi_{1} \\le 1$ 变为：\n$$ 2U \\le 1 \\implies U \\le \\frac{1}{2} $$\n第二个事件 $\\xi_{2} \\le 1$ 变为：\n$$ 2(1-U) \\le 1 \\implies 1-U \\le \\frac{1}{2} \\implies \\frac{1}{2} \\le U $$\n为了使联合事件 $(\\xi_{1} \\le 1 \\text{ and } \\xi_{2} \\le 1)$ 发生，关于 $U$ 的两个条件必须同时满足：$U \\le \\frac{1}{2}$ 和 $U \\ge \\frac{1}{2}$。唯一同时满足这两个不等式的实数是 $U = \\frac{1}{2}$。因此，该联合事件等价于 $U$ 取特定值 $\\frac{1}{2}$ 的事件。\n$$ \\mathbb{P}\\left(\\xi_{1} \\le 1, \\xi_{2} \\le 1\\right) = \\mathbb{P}\\left(U = \\frac{1}{2}\\right) $$\n随机变量 $U$ 被指定为在区间 $[0,1]$ 上服从均匀分布，这是一种连续概率分布。对于任何连续随机变量，其取任何单个精确值的概率为 $0$。\n$$ \\mathbb{P}\\left(U = \\frac{1}{2}\\right) = 0 $$\n因此，满足联合约束的概率为 $0$。\n\n最后，我们计算 $\\Delta$，即两个概率之间的差值：\n$$ \\Delta := \\mathbb{P}\\left(\\xi_{1} + \\xi_{2} \\le 2\\right) - \\mathbb{P}\\left(\\xi_{1} \\le 1,\\ \\xi_{2} \\le 1\\right) $$\n代入我们已计算出的值：\n$$ \\Delta = 1 - 0 = 1 $$\n这个结果量化了由聚合引入的误差。虽然聚合约束表明解是完全安全的（满足概率为 $1$），但真实的联合满足概率却是 $0$，这意味着在原始的、更准确的模型下，该解是不可行的。", "answer": "$$\\boxed{1}$$", "id": "3107959"}]}