{"hands_on_practices": [{"introduction": "第一个实践问题将让你扮演一位剧院经理，面对一个经典的超额预订困境。你需要对不确定的顾客出席率进行建模，并利用补救措施来填充空余座位，从而确定最佳的预售票数量。这个练习旨在通过明确权衡拒绝顾客的成本与空座位的机会成本，来锻炼你计算期望值的核心技能，这是随机规划的基石。[@problem_id:3194929]", "problem": "一家小型的、仅限少数人观看的预演影院提供了一组固定的高级座位。在演出开始前，需要做出一个规划决策，即发售多少张预售票。演出开始后，一些预订客户可能不会出现，影院可以接纳候补客户来填补空位。这可以建模为一个带追索权的两阶段随机规划问题，其中第一阶段决策是发售的预售票数量，第二阶段追索决策是在不确定性实现后接纳候补客户。\n\n影院的容量为 $S = 3$ 个高级座位。第一阶段决策是发售的预售票数量，为一个整数 $x \\in \\{0,1,2,3,4,5\\}$。每位预订客户独立地以概率 $s = 0.8$ 出席（独立同分布（i.i.d.）出席），因此实际到场人数 $Z$ 是一个随机数，服从二项分布 $Z \\sim \\text{Binomial}(x, s)$。影院仅对到场观众收取费用；预订观众入场时支付 $p_{a} = 30$。如果到场的预订观众少于座位数，影院可以接纳最多 $L = 2$ 名候补客户来填补剩余的空位，每位候补客户票价为 $p_{s} = 10$。如果到场的预订观众数量超过容量，超出的部分必须因消防法规而被拒绝入场，每位被拒的客户会产生 $c_{b} = 40$ 的罚款成本（假设他们不支付票价）。\n\n设第二阶段的追索决策为 $y(\\xi)$，其中 $\\xi$ 是 $x$ 张预售票中实际未到场的人数。等价地，设 $Z = x - \\xi$ 表示实际到场的预订观众人数。在观察到 $\\xi$（或 $Z$）之后，影院选择 $y(\\xi)$ 以最大化实际收入，同时受限于物理容量和候补人数上限。使用带追索权的两阶段随机规划的核心定义和标准概率知识来：\n\n1. 将实际收入表述为实现值 $Z$ 和追索决策 $y(\\xi)$ 的函数，并强制执行总入场人数不超过容量以及候补入场人数不超过 $L$ 的约束。\n2. 使用 $Z$ 的二项分布，推导出期望收入 $\\mathbb{E}[R(x)]$ 作为 $x$ 的函数。\n3. 计算每个 $x \\in \\{0,1,2,3,4,5\\}$ 对应的 $\\mathbb{E}[R(x)]$，并确定使期望收入最大化的值 $x^{\\star}$。\n\n提供 $x^{\\star}$ 的值作为最终答案。无需四舍五入。将最终答案表示为不带单位的纯数字。", "solution": "首先根据指定标准对问题进行验证。\n\n### 第1步：提取已知条件\n- 影院容量：$S = 3$ 个高级座位。\n- 第一阶段决策变量（预售票数量）：$x \\in \\{0, 1, 2, 3, 4, 5\\}$。\n- 预订客户到场概率：$s = 0.8$。\n- 预订观众到场人数的随机变量：$Z \\sim \\text{Binomial}(x, s)$。\n- 预订观众带来的收入：$p_{a} = 30$。\n- 最大候补客户数量：$L = 2$。\n- 候补客户带来的收入：$p_{s} = 10$。\n- 每位被拒客户的罚款：$c_{b} = 40$。\n- 第二阶段追索决策：$y(\\xi)$，其中 $\\xi$ 是未到场人数。\n- 实际到场的预订观众人数：$Z = x - \\xi$。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据、良定性及客观性。\n- **科学依据**：该问题是两阶段随机规划的标准应用，这是运筹学和优化理论中一个成熟的学科。使用二项分布来模拟独立的客户到达是一种常用且有效的方法。\n- **良定性**：该问题是良定的。它要求从一个有限集合中找到整数 $x$，以最大化一个明确定义的期望收入函数。所有必要的参数和约束都已给出，且没有矛盾。预期存在唯一的最优解。\n- **客观性**：该问题以精确的、定量的术语陈述，没有任何主观或模棱两可的语言。\n\n该问题没有表现出任何无效性缺陷。它是一个完整的、一致的、可形式化的问题，与指定主题*带追索权的两阶段随机规划*直接相关。\n\n### 第3步：结论与行动\n问题有效。将提供完整解答。\n\n### 解题过程\n\n这是一个两阶段随机规划问题。第一阶段决策是选择要出售的预售票数量 $x \\in \\{0, 1, 2, 3, 4, 5\\}$。做出此决策后，不确定性得以实现：实际到场的客户数量，用随机变量 $Z$ 表示。$Z$ 服从二项分布，$Z \\sim \\text{Binomial}(x, s)$，参数为 $x$ 和 $s=0.8$。第二阶段（追索）决策是在观察到 $Z$ 的实现值（比如 $k$）后，确定接纳多少候补客户 $y$。总体目标是选择 $x$ 以最大化期望总收入。\n\n**1. 构建实际收入（第二阶段问题）**\n\n设 $k$ 为实际到场的预订观众人数。在观察到 $k$ 后，影院就接纳的候补客户数量 $y$ 做出追索决策。目标是最大化该特定实现下的收入。\n\n被接纳的预订观众人数为 $\\min(k, S)$。\n被拒绝入场的预订观众人数为 $\\max(0, k-S)$。\n可供候补客户的座位数为 $S - k$（如果 $k  S$），否则为 $0$。这可以写作 $\\max(0, S-k)$。\n\n追索决策 $y$ 受到可用座位数和候补客户上限 $L$ 的约束：\n$$y \\le \\max(0, S-k)$$\n$$y \\le L$$\n$$y \\ge 0$$\n综合这些约束，我们得到 $0 \\le y \\le \\min(L, \\max(0, S-k))$。\n由于候补客户的收入 $p_s = 10$ 是正数，影院通过接纳尽可能多的候补客户来最大化其第二阶段收入。最优追索决策 $y^*(k)$ 为：\n$$y^*(k) = \\min(L, \\max(0, S-k))$$\n\n对于一个实现值 $k$，总实际收入 $R(k)$ 是来自被接纳的预订客户和候补客户的收入之和，减去因拒绝客户而产生的罚款。\n$$R(k) = p_a \\cdot \\min(k, S) + p_s \\cdot y^*(k) - c_b \\cdot \\max(0, k-S)$$\n代入 $y^*(k)$ 的表达式以及给定参数 $S=3$、$p_a=30$、$p_s=10$、$c_b=40$ 和 $L=2$：\n$$R(k) = 30 \\cdot \\min(k, 3) + 10 \\cdot \\min(2, \\max(0, 3-k)) - 40 \\cdot \\max(0, k-3)$$\n\n我们来计算 $k$ 的可能取值下该函数的值：\n- 当 $k=0$ 时：$R(0) = 30(0) + 10 \\cdot \\min(2, 3) - 40(0) = 20$。\n- 当 $k=1$ 时：$R(1) = 30(1) + 10 \\cdot \\min(2, 2) - 40(0) = 30 + 20 = 50$。\n- 当 $k=2$ 时：$R(2) = 30(2) + 10 \\cdot \\min(2, 1) - 40(0) = 60 + 10 = 70$。\n- 当 $k=3$ 时：$R(3) = 30(3) + 10 \\cdot \\min(2, 0) - 40(0) = 90$。\n- 当 $k=4$ 时：$R(4) = 30(3) + 10 \\cdot \\min(2, 0) - 40(1) = 90 - 40 = 50$。\n- 当 $k=5$ 时：$R(5) = 30(3) + 10 \\cdot \\min(2, 0) - 40(2) = 90 - 80 = 10$。\n\n**2. 推导期望收入**\n\n对于第一阶段决策 $x$，期望收入由 $\\mathbb{E}[R(x)]$ 给出。其计算方法是将所有可能结果 $k \\in \\{0, 1, \\dots, x\\}$ 的实际收入 $R(k)$ 按其各自的概率加权求和。对于 $Z \\sim \\text{Binomial}(x, 0.8)$，其概率质量函数为 $P(Z=k|x) = \\binom{x}{k} (0.8)^k (0.2)^{x-k}$。\n$$\\mathbb{E}[R(x)] = \\sum_{k=0}^{x} R(k) \\cdot P(Z=k|x)$$\n$$ \\mathbb{E}[R(x)] = \\sum_{k=0}^{x} \\left( 30 \\cdot \\min(k, 3) + 10 \\cdot \\min(2, \\max(0, 3-k)) - 40 \\cdot \\max(0, k-3) \\right) \\binom{x}{k} (0.8)^k (0.2)^{x-k} $$\n\n**3. 计算 $\\mathbb{E}[R(x)]$ 并确定最优的 $x^{\\star}$**\n\n我们现在为每个可能的 $x \\in \\{0, 1, 2, 3, 4, 5\\}$ 值计算期望收入。\n\n- **对于 $x=0$**：$P(Z=0)=1$。\n$\\mathbb{E}[R(0)] = R(0) \\cdot 1 = 20$。\n\n- **对于 $x=1$**：$P(Z=0) = 0.2$, $P(Z=1) = 0.8$。\n$\\mathbb{E}[R(1)] = R(0) \\cdot 0.2 + R(1) \\cdot 0.8 = 20(0.2) + 50(0.8) = 4 + 40 = 44$。\n\n- **对于 $x=2$**：$P(Z=0)=(0.2)^2=0.04$, $P(Z=1)=2(0.8)(0.2)=0.32$, $P(Z=2)=(0.8)^2=0.64$。\n$\\mathbb{E}[R(2)] = R(0)\\cdot(0.04) + R(1)\\cdot(0.32) + R(2)\\cdot(0.64) = 20(0.04) + 50(0.32) + 70(0.64) = 0.8 + 16 + 44.8 = 61.6$。\n\n- **对于 $x=3$**：$P(Z=0)=(0.2)^3=0.008$, $P(Z=1)=3(0.8)(0.2)^2=0.096$, $P(Z=2)=3(0.8)^2(0.2)=0.384$, $P(Z=3)=(0.8)^3=0.512$。\n$\\mathbb{E}[R(3)] = R(0)\\cdot(0.008) + R(1)\\cdot(0.096) + R(2)\\cdot(0.384) + R(3)\\cdot(0.512)$\n$\\mathbb{E}[R(3)] = 20(0.008) + 50(0.096) + 70(0.384) + 90(0.512) = 0.16 + 4.8 + 26.88 + 46.08 = 77.92$。\n\n- **对于 $x=4$**：$P(Z=0)=(0.2)^4=0.0016$, $P(Z=1)=4(0.8)(0.2)^3=0.0256$, $P(Z=2)=6(0.8)^2(0.2)^2=0.1536$, $P(Z=3)=4(0.8)^3(0.2)=0.4096$, $P(Z=4)=(0.8)^4=0.4096$。\n$\\mathbb{E}[R(4)] = R(0)P(0) + R(1)P(1) + R(2)P(2) + R(3)P(3) + R(4)P(4)$\n$\\mathbb{E}[R(4)] = 20(0.0016) + 50(0.0256) + 70(0.1536) + 90(0.4096) + 50(0.4096)$\n$\\mathbb{E}[R(4)] = 0.032 + 1.28 + 10.752 + 36.864 + 20.48 = 69.408$。\n\n- **对于 $x=5$**：$P(Z=0)=(0.2)^5=0.00032$, $P(Z=1)=5(0.8)(0.2)^4=0.0064$, $P(Z=2)=10(0.8)^2(0.2)^3=0.0512$, $P(Z=3)=10(0.8)^3(0.2)^2=0.2048$, $P(Z=4)=5(0.8)^4(0.2)=0.4096$, $P(Z=5)=(0.8)^5=0.32768$。\n$\\mathbb{E}[R(5)] = R(0)P(0) + R(1)P(1) + R(2)P(2) + R(3)P(3) + R(4)P(4) + R(5)P(5)$\n$\\mathbb{E}[R(5)] = 20(0.00032) + 50(0.0064) + 70(0.0512) + 90(0.2048) + 50(0.4096) + 10(0.32768)$\n$\\mathbb{E}[R(5)] = 0.0064 + 0.32 + 3.584 + 18.432 + 20.48 + 3.2768 = 46.0992$。\n\n总结期望收入如下：\n- $\\mathbb{E}[R(0)] = 20$\n- $\\mathbb{E}[R(1)] = 44$\n- $\\mathbb{E}[R(2)] = 61.6$\n- $\\mathbb{E}[R(3)] = 77.92$\n- $\\mathbb{E}[R(4)] = 69.408$\n- $\\mathbb{E}[R(5)] = 46.0992$\n\n最大期望收入为 $77.92$，出现在 $x=3$ 时。因此，要发售的最优预售票数量为 $x^{\\star} = 3$。", "answer": "$$\\boxed{3}$$", "id": "3194929"}, {"introduction": "这个练习不仅要求你找到一个最优策略，更提出了一个更深层次的问题：预知未来的价值是多少？通过分析一个存在中断风险的供应链采购问题，你不仅将确定最佳的初始采购计划，还将计算完美信息的期望价值（EVPI）。这项实践将帮助你理解如何量化减少不确定性所带来的经济效益，这是战略决策中的一个关键概念。[@problem_id:3195012]", "problem": "一家公司必须满足 $d = 100$ 个单位的确定性需求。在中断状态未知的第一阶段，它可以从两个供应商处采购：一个是有风险的供应商，单位成本为 $c_{s} = 5$，仅在中断状态为 $\\xi = 1$（无中断）时才交货；另一个是可靠的供应商，单位成本为 $c_{\\ell} = 8$，无论 $\\xi$ 为何值都交货。该公司决定在第一阶段向有风险的供应商分配 $x \\in [0, d]$ 的数量，向可靠的供应商分配 $d - x$ 的数量。中断状态是一个二元随机变量 $\\xi \\in \\{0,1\\}$，其中 $\\mathbb{P}(\\xi = 0) = q = 0.2$，$\\mathbb{P}(\\xi = 1) = 1 - q = 0.8$。如果 $\\xi = 0$（发生中断），有风险的供应商会失败，交付 $0$ 个单位；为了满足需求，该公司在观察到 $\\xi$ 后，会采取第二阶段的补救措施 $y(\\xi)$，以每单位 $p = 12$ 的惩罚价格购买任何未满足的数量。假设所有供应商付款都按交付单位计算，不允许出现未满足的需求，也不允许有超额或残值。\n\n使用带补救措施的两阶段随机规划的核心定义和完美信息期望值（EVPI）的定义，将期望总成本表示为 $x$ 的函数，并推导出不确定性下的最优第一阶段决策。然后，计算该采购问题中中断状态 $\\xi$ 的完美信息期望值（EVPI）。将 EVPI 表示为单个实数。不需要四舍五入，最终答案中不要包含单位。", "solution": "用户提供了一个两阶段随机规划问题，并要求推导最优第一阶段决策并计算完美信息期望值（EVPI）。\n\n### 步骤 1：提取已知条件\n- 确定性需求：$d = 100$ 单位。\n- 有风险的供应商单位成本：$c_s = 5$。\n- 可靠的供应商单位成本：$c_{\\ell} = 8$。\n- 第一阶段决策变量（从有风险的供应商处采购的数量）：$x \\in [0, d]$。\n- 从可靠的供应商处采购的数量：$d - x$。\n- 中断状态（随机变量）：$\\xi \\in \\{0, 1\\}$。\n- 中断概率（$\\xi = 0$）：$\\mathbb{P}(\\xi = 0) = q = 0.2$。\n- 无中断概率（$\\xi = 1$）：$\\mathbb{P}(\\xi = 1) = 1 - q = 0.8$。\n- 第二阶段补救措施惩罚价格：$p = 12$。\n- 补救措施（以惩罚价格购买的数量）：$y(\\xi)$。\n- 约束条件：不允许未满足的需求。按交付单位付款。无超额或残值。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题是带补救措施的两阶段随机线性规划的经典示例，这是运筹学和优化领域的一个成熟课题。\n- **科学依据：** 该问题基于随机优化的标准原理。所有概念（补救措施，EVPI）在该领域都有明确的定义。\n- **适定性：** 提供了所有必要数据（$d, c_s, c_{\\ell}, p, q$）。目标（最小化期望成本）和约束（$0 \\leq x \\leq d$，满足需求）是明确的，从而可以得出一个唯一的最优第一阶段决策和一个明确定义的 EVPI。\n- **客观性：** 该问题以精确、定量的术语陈述，没有任何主观或模糊的语言。\n该问题是自洽的、一致的，并且没有违反任何指定的无效标准。因此被认为是**有效的**。\n\n### 步骤 3：推导与求解\n\n问题是找到从有风险的供应商处采购的最优第一阶段数量 $x$，以最小化总期望成本。这就是**补救问题（Recourse Problem, RP）**。\n\n首先，我们将总成本定义为第一阶段决策 $x$ 和随机状态 $\\xi$ 实现值的函数。\n\n**情景 1：发生中断 ($\\xi = 0$)**\n- 有 $q = 0.2$ 的概率，有风险的供应商会失败，交付 $0$ 个单位。\n- 可靠的供应商交付 $d - x$ 个单位。\n- 采取补救措施前的总可用数量为 $d - x$。\n- 为了满足总需求 $d$，公司必须购买短缺部分，即 $d - (d - x) = x$。\n- 第二阶段的补救措施是 $y(0) = x$。\n- 在这种情景下的总成本 $C(x, 0)$ 是来自可靠供应商的单位成本和补救单位成本的总和：\n$$C(x, 0) = c_{\\ell}(d - x) + p \\cdot y(0) = c_{\\ell}(d - x) + px$$\n\n**情景 2：未发生中断 ($\\xi = 1$)**\n- 有 $1 - q = 0.8$ 的概率，有风险的供应商交付 $x$ 个单位。\n- 可靠的供应商交付 $d - x$ 个单位。\n- 总可用数量为 $x + (d - x) = d$。\n- 需求完全满足，因此不需要补救措施：$y(1) = 0$。\n- 在这种情景下的总成本 $C(x, 1)$ 是支付给两个供应商的款项总和，按交付单位计算：\n$$C(x, 1) = c_{\\ell}(d - x) + c_s x$$\n\n**补救问题 (RP)：最小化期望成本**\n目标是选择 $x$ 来最小化期望总成本 $Z(x)$。\n$$Z(x) = \\mathbb{E}[C(x, \\xi)] = \\mathbb{P}(\\xi=0) \\cdot C(x, 0) + \\mathbb{P}(\\xi=1) \\cdot C(x, 1)$$\n$$Z(x) = q [c_{\\ell}(d - x) + px] + (1-q) [c_{\\ell}(d - x) + c_s x]$$\n我们可以重新整理各项来分析函数 $Z(x)$：\n$$Z(x) = q c_{\\ell} d - q c_{\\ell} x + q p x + (1-q) c_{\\ell} d - (1-q) c_{\\ell} x + (1-q) c_s x$$\n$$Z(x) = (q + 1 - q) c_{\\ell} d + x [ -q c_{\\ell} + q p - (1-q) c_{\\ell} + (1-q) c_s ]$$\n$$Z(x) = c_{\\ell} d + x [ -c_{\\ell} + qp + (1-q) c_s ]$$\n这是一个在区间 $[0, d]$ 上关于 $x$ 的线性函数。$x$ 的最优值取决于 $x$ 的系数的符号。设这个系数为 $S$：\n$$S = (1-q)c_s + qp - c_{\\ell}$$\n代入给定值：\n$$S = (1 - 0.2)(5) + (0.2)(12) - 8$$\n$$S = (0.8)(5) + 2.4 - 8 = 4 + 2.4 - 8 = -1.6$$\n由于 $S  0$，函数 $Z(x)$ 是关于 $x$ 的递减函数。为了最小化 $Z(x)$，我们必须选择 $x$ 的最大可能值。可行范围是 $x \\in [0, d]$，因此最优的第一阶段决策是 $x^* = d = 100$。\n\n补救问题的最优期望成本，记为 $Z_{RP}$，是 $Z(x^*)$：\n$$Z_{RP} = Z(100) = c_{\\ell}d + 100 \\cdot S$$\n$$Z_{RP} = (8)(100) + 100(-1.6) = 800 - 160 = 640$$\n\n**等待-观察问题 (Wait-and-See, WS) 与 EVPI**\n完美信息期望值（EVPI）是补救问题的最优成本（$Z_{RP}$）与等待-观察问题的期望成本（$Z_{WS}$）之间的差值。$Z_{WS}$ 是在观察到 $\\xi$ 的值之后再做决策时的期望成本。\n\n如果我们事先知道 $\\xi=0$（中断）：有风险的供应商不可选。选择是在成本为 $c_{\\ell} = 8$ 的可靠供应商和成本为 $p = 12$ 的补救选项之间进行。由于 $c_{\\ell}  p$，最优策略是从可靠供应商处采购所有 $d = 100$ 个单位。成本是：\n$$C^*(0) = c_{\\ell}d = 8 \\cdot 100 = 800$$\n\n如果我们事先知道 $\\xi=1$（无中断）：有风险的供应商可用。选择是在成本为 $c_s = 5$ 的有风险供应商和成本为 $c_{\\ell} = 8$ 的可靠供应商之间进行。由于 $c_s  c_{\\ell}$，最优策略是从有风险的供应商处采购所有 $d = 100$ 个单位。成本是：\n$$C^*(1) = c_s d = 5 \\cdot 100 = 500$$\n\n等待-观察问题的期望成本是这些最优成本的期望值：\n$$Z_{WS} = \\mathbb{E}[C^*(\\xi)] = q \\cdot C^*(0) + (1-q) \\cdot C^*(1)$$\n$$Z_{WS} = (0.2)(800) + (0.8)(500) = 160 + 400 = 560$$\n\n最后，EVPI 是预先知道状态 $\\xi$ 的价值：\n$$EVPI = Z_{RP} - Z_{WS}$$\n$$EVPI = 640 - 560 = 80$$\nEVPI 是 $80$。这个值代表了公司为获得关于是否会发生中断的完美信息而愿意支付的最大金额。", "answer": "$$\\boxed{80}$$", "id": "3195012"}, {"introduction": "我们的最后一个实践问题是一个综合性练习，它整合了两阶段随机规划中的多个高级概念。你将解决一个产能投资问题，首先需要推导出代表第二阶段最优利润的分段线性补救函数。这个问题将挑战你计算EVPI和随机解的价值（VSS），让你不仅能深入理解信息的价值，还能理解随机模型本身相对于简化确定性方法的价值。[@problem_id:3194980]", "problem": "一家公司必须在产品收益和可用单位的不确定性揭晓之前，以单位成本 $c=7$ 选择一个第一阶段的容量投资 $x \\geq 0$。在第二阶段，当情景 $\\xi \\in \\{\\xi_{1}, \\xi_{2}\\}$ 实现后，公司通过非负分配量 $y_{A}(\\xi)$ 和 $y_{B}(\\xi)$ 将容量 $x$ 分配给产品 A 和 B，这些分配量需满足容量和可用性约束 $y_{A}(\\xi) + y_{B}(\\xi) \\leq x$，$y_{A}(\\xi) \\leq b_{A}(\\xi)$ 以及 $y_{B}(\\xi) \\leq b_{B}(\\xi)$。单位收益 $r_{A}(\\xi)$ 和 $r_{B}(\\xi)$ 以及可用性上限 $b_{A}(\\xi)$ 和 $b_{B}(\\xi)$ 是随机的，并取决于具体情景。存在两种情景，其概率分别为 $\\mathbb{P}(\\xi_{1}) = 0.4$ 和 $\\mathbb{P}(\\xi_{2}) = 0.6$，参数如下：\n- 情景 $\\xi_{1}$：$r_{A}(\\xi_{1}) = 9$，$r_{B}(\\xi_{1}) = 5$，$b_{A}(\\xi_{1}) = 3$，$b_{B}(\\xi_{1}) = 4$。\n- 情景 $\\xi_{2}$：$r_{A}(\\xi_{2}) = 6$，$r_{B}(\\xi_{2}) = 10$，$b_{A}(\\xi_{2}) = 2$，$b_{B}(\\xi_{2}) = 5$。\n\n对于一个已实现的情景 $\\xi$，第二阶段（追索）问题是选择 $y_{A}(\\xi)$ 和 $y_{B}(\\xi)$ 以最大化总收益 $r_{A}(\\xi) y_{A}(\\xi) + r_{B}(\\xi) y_{B}(\\xi)$，并遵循上述分配约束。第一阶段的目标是最大化期望净收益 $\\mathbb{E}[Q(x,\\xi)] - c x$，其中 $Q(x,\\xi)$ 表示在给定容量 $x$ 和情景 $\\xi$ 下的最优第二阶段收益。\n\n使用两阶段带追索的随机规划的基本定义，从基本原理推导出：\n1. 追索函数 $Q(x,\\xi_{1})$ 和 $Q(x,\\xi_{2})$ 作为 $x$ 的函数的分段线性表达式。\n2. 求解追索问题的最优第一阶段容量 $x^{\\star}$，以及相应的最优期望目标值。\n3. “等待-观望”（WS）基准，其定义为决策者在选择 $x$ 之前已知 $\\xi$ 时的期望最优值，以及相应的情景最优容量 $x^{\\star}(\\xi_{1})$ 和 $x^{\\star}(\\xi_{2})$。\n4. 通过将随机参数替换为其期望值得到的期望值（EV）确定性问题、EV最优容量 $x^{EV}$，以及使用EV解的期望结果（EEV），即当 $x^{EV}$ 在原始随机追索模型中进行评估时的期望目标值。\n5. 完美信息期望值（EVPI），定义为WS期望值与追索问题最优期望值之差；以及随机解的价值（VSS），定义为追索问题最优期望值与EEV之差。\n\n报告 EVPI 和 VSS 的最终数值。无需四舍五入。将最终答案以 $\\text{EVPI}, \\text{VSS}$ 的顺序表示为一个数对。", "solution": "用户希望我解决一个两阶段随机规划问题。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n\n*   **第一阶段决策变量：** 容量投资 $x \\geq 0$。\n*   **第一阶段成本：** 单位容量成本 $c = 7$。\n*   **第二阶段决策变量：** 产品分配量 $y_{A}(\\xi) \\geq 0$ 和 $y_{B}(\\xi) \\geq 0$。\n*   **情景：** $\\xi \\in \\{\\xi_{1}, \\xi_{2}\\}$。\n*   **概率：** $\\mathbb{P}(\\xi_{1}) = 0.4$，$\\mathbb{P}(\\xi_{2}) = 0.6$。\n*   **情景 $\\xi_1$ 参数：**\n    *   收益：$r_{A}(\\xi_{1}) = 9$，$r_{B}(\\xi_{1}) = 5$。\n    *   可用性：$b_{A}(\\xi_{1}) = 3$，$b_{B}(\\xi_{1}) = 4$。\n*   **情景 $\\xi_2$ 参数：**\n    *   收益：$r_{A}(\\xi_{2}) = 6$，$r_{B}(\\xi_{2}) = 10$。\n    *   可用性：$b_{A}(\\xi_{2}) = 2$，$b_{B}(\\xi_{2}) = 5$。\n*   **第二阶段约束（对每个 $\\xi$）：**\n    1.  $y_{A}(\\xi) + y_{B}(\\xi) \\leq x$\n    2.  $y_{A}(\\xi) \\leq b_{A}(\\xi)$\n    3.  $y_{B}(\\xi) \\leq b_{B}(\\xi)$\n*   **第二阶段目标（追索函数）：**\n    *   $Q(x,\\xi) = \\max_{y_A, y_B} \\{ r_{A}(\\xi) y_{A}(\\xi) + r_{B}(\\xi) y_{B}(\\xi) \\}$，受第二阶段约束限制。\n*   **第一阶段目标（追索问题）：**\n    *   最大化 $Z(x) = \\mathbb{E}[Q(x,\\xi)] - c x$。\n\n**步骤2：使用提取的已知条件进行验证**\n\n该问题是两阶段带追索的随机线性规划的经典示例。\n*   **科学依据：** 该问题基于优化和随机规划的既定原则。它是一个常见商业问题的数学公式化。\n*   **适定性：** 问题定义清晰，具有线性目标和线性约束。追索函数是凹函数，总目标函数也是凹函数，这确保了最大值的存在。\n*   **客观性：** 问题使用精确的数学语言和数值进行陈述，没有主观或模糊的术语。\n*   **完整性：** 所有必要的数据（成本、收益、概率、约束）都已提供。\n*   **一致性：** 问题陈述中没有矛盾之处。\n\n该问题不违反任何无效标准。\n\n**步骤3：结论与行动**\n\n问题有效。我将继续进行求解。\n\n### 解题推导\n\n**1. 推导追索函数 $Q(x, \\xi_{1})$ 和 $Q(x, \\xi_{2})$**\n\n第二阶段问题是一个针对给定容量 $x$ 求解的线性规划问题。最优策略是首先将容量分配给收益较高的产品，直至其可用性上限。\n\n**对于情景 $\\xi_1$**：\n问题是最大化 $9 y_{A}(\\xi_1) + 5 y_{B}(\\xi_1)$，约束条件为 $y_{A}(\\xi_1) + y_{B}(\\xi_1) \\leq x$，$y_{A}(\\xi_1) \\leq 3$，$y_{B}(\\xi_1) \\leq 4$ 以及非负性。\n由于 $r_{A}(\\xi_{1}) = 9 > r_{B}(\\xi_{1}) = 5$，我们优先分配给产品 A。\n\n*   如果 $0 \\leq x \\leq 3$：我们将所有容量分配给 A。$y_{A}(\\xi_1) = x$，$y_{B}(\\xi_1) = 0$。\n    $Q(x, \\xi_{1}) = 9x$。\n*   如果 $3  x \\leq 3+4=7$：我们首先满足 A 的全部可用性，$y_{A}(\\xi_1) = 3$。剩余容量 $x-3$ 分配给 B。$y_{B}(\\xi_1) = x-3$。\n    $Q(x, \\xi_{1}) = 9(3) + 5(x-3) = 27 + 5x - 15 = 5x + 12$。\n*   如果 $x > 7$：容量足以满足所有可用性。$y_{A}(\\xi_1) = 3$，$y_{B}(\\xi_1) = 4$。\n    $Q(x, \\xi_{1}) = 9(3) + 5(4) = 27 + 20 = 47$。\n\n所以，$Q(x, \\xi_{1}) = \\begin{cases} 9x  \\text{若 } 0 \\leq x \\leq 3 \\\\ 5x + 12  \\text{若 } 3  x \\leq 7 \\\\ 47  \\text{若 } x > 7 \\end{cases}$。\n\n**对于情景 $\\xi_2$**：\n问题是最大化 $6 y_{A}(\\xi_2) + 10 y_{B}(\\xi_2)$，约束条件为 $y_{A}(\\xi_2) + y_{B}(\\xi_2) \\leq x$，$y_{A}(\\xi_2) \\leq 2$，$y_{B}(\\xi_2) \\leq 5$ 以及非负性。\n由于 $r_{B}(\\xi_{2}) = 10 > r_{A}(\\xi_{2}) = 6$，我们优先分配给产品 B。\n\n*   如果 $0 \\leq x \\leq 5$：我们将所有容量分配给 B。$y_{B}(\\xi_2) = x$，$y_{A}(\\xi_2) = 0$。\n    $Q(x, \\xi_{2}) = 10x$。\n*   如果 $5  x \\leq 5+2=7$：我们首先满足 B 的全部可用性，$y_{B}(\\xi_2) = 5$。剩余容量 $x-5$ 分配给 A。$y_{A}(\\xi_2) = x-5$。\n    $Q(x, \\xi_{2}) = 10(5) + 6(x-5) = 50 + 6x - 30 = 6x + 20$。\n*   如果 $x > 7$：容量充足。$y_{B}(\\xi_2) = 5$，$y_{A}(\\xi_2) = 2$。\n    $Q(x, \\xi_{2}) = 10(5) + 6(2) = 50 + 12 = 62$。\n\n所以，$Q(x, \\xi_{2}) = \\begin{cases} 10x  \\text{若 } 0 \\leq x \\leq 5 \\\\ 6x + 20  \\text{若 } 5  x \\leq 7 \\\\ 62  \\text{若 } x > 7 \\end{cases}$。\n\n**2. 最优第一阶段容量 $x^{\\star}$ 和追索问题 (RP) 的值**\n\n第一阶段的目标是最大化 $Z(x) = \\mathbb{E}[Q(x,\\xi)] - cx$，其中 $c=7$。\n$Z(x) = 0.4 Q(x, \\xi_{1}) + 0.6 Q(x, \\xi_{2}) - 7x$。\n函数 $Z(x)$ 是分段线性和凹的。我们通过检查 $Z(x)$ 在由追索函数断点 $\\{3, 5, 7\\}$ 定义的每个区间内的导数（斜率）来找到最优点。\n\n*   对于 $x \\in [0, 3]$：\n    $Z(x) = 0.4(9x) + 0.6(10x) - 7x = (3.6 + 6 - 7)x = 2.6x$。\n    斜率为 $Z'(x)=2.6 > 0$。\n*   对于 $x \\in (3, 5]$：\n    $Z(x) = 0.4(5x+12) + 0.6(10x) - 7x = (2x + 4.8) + 6x - 7x = x + 4.8$。\n    斜率为 $Z'(x)=1 > 0$。\n*   对于 $x \\in (5, 7]$：\n    $Z(x) = 0.4(5x+12) + 0.6(6x+20) - 7x = (2x + 4.8) + (3.6x + 12) - 7x = -1.4x + 16.8$。\n    斜率为 $Z'(x)=-1.4  0$。\n\n目标函数 $Z(x)$ 的斜率在 $x=5$ 处由正转负。因此，最优的第一阶段容量是 $x^{\\star} = 5$。\n\n最优期望目标值（追索问题的值，RP）是 $Z_{RP} = Z(x^{\\star}=5)$。\n使用 $x \\in (3, 5]$ 的表达式，我们得到：\n$Z_{RP} = Z(5) = 5 + 4.8 = 9.8$。\n\n**3. “等待-观望”（WS）基准**\n\nWS 值是在选择 $x$ 之前已知情景时的期望最优利润。\n$Z_{WS} = \\sum_{i=1}^{2} \\mathbb{P}(\\xi_i) \\max_{x \\geq 0} \\{Q(x, \\xi_i) - cx\\}$。\n\n**对于情景 $\\xi_1$**：最大化 $W_1(x) = Q(x, \\xi_1) - 7x$。\n*   $x \\in [0, 3]$：$W_1(x) = 9x - 7x = 2x$。斜率为 $2$。\n*   $x \\in (3, 7]$：$W_1(x) = (5x+12) - 7x = 12 - 2x$。斜率为 $-2$。\n最大值在 $x=3$ 处。所以，$x^{\\star}(\\xi_1) = 3$。\n最优值为 $W_1^{\\star} = 2(3) = 6$。\n\n**对于情景 $\\xi_2$**：最大化 $W_2(x) = Q(x, \\xi_2) - 7x$。\n*   $x \\in [0, 5]$：$W_2(x) = 10x - 7x = 3x$。斜率为 $3$。\n*   $x \\in (5, 7]$：$W_2(x) = (6x+20) - 7x = 20 - x$。斜率为 $-1$。\n最大值在 $x=5$ 处。所以，$x^{\\star}(\\xi_2) = 5$。\n最优值为 $W_2^{\\star} = 3(5) = 15$。\n\nWS 值是这些情景最优值的期望：\n$Z_{WS} = \\mathbb{P}(\\xi_1) W_1^{\\star} + \\mathbb{P}(\\xi_2) W_2^{\\star} = 0.4(6) + 0.6(15) = 2.4 + 9.0 = 11.4$。\n\n**4. 期望值 (EV) 问题和 EEV**\n\n首先，计算随机参数的期望值：\n$\\mathbb{E}[r_A] = 0.4(9) + 0.6(6) = 3.6 + 3.6 = 7.2$。\n$\\mathbb{E}[r_B] = 0.4(5) + 0.6(10) = 2.0 + 6.0 = 8.0$。\n$\\mathbb{E}[b_A] = 0.4(3) + 0.6(2) = 1.2 + 1.2 = 2.4$。\n$\\mathbb{E}[b_B] = 0.4(4) + 0.6(5) = 1.6 + 3.0 = 4.6$。\n\nEV 问题是使用这些期望值来解决确定性问题：\n最大化 $Z^{EV}(x) = Q^{EV}(x) - 7x$，其中 $Q^{EV}(x)$ 是在期望参数下分配容量 $x$ 的最优收益。\n$Q^{EV}(x) = \\max \\{7.2y_A + 8y_B \\mid y_A+y_B \\le x, y_A \\le 2.4, y_B \\le 4.6, y_A,y_B \\ge 0 \\}$。\n由于 $\\mathbb{E}[r_B]=8.0 > \\mathbb{E}[r_A]=7.2$，我们优先考虑 $y_B$。\n\n*   对于 $x \\in [0, 4.6]$：$Z^{EV}(x) = 8x - 7x = x$。斜率为 $1$。\n*   对于 $x \\in (4.6, 4.6+2.4=7]$：$Q^{EV}(x) = 8(4.6) + 7.2(x-4.6) = 7.2x + 3.68$。\n    $Z^{EV}(x) = (7.2x + 3.68) - 7x = 0.2x + 3.68$。斜率为 $0.2$。\n*   对于 $x > 7$：$Q^{EV}(x) = 8(4.6) + 7.2(2.4) = 54.08$。\n    $Z^{EV}(x) = 54.08 - 7x$。斜率为 $-7$。\n\n斜率在 $x=7$ 之前一直为正，然后变为负。EV问题的最优容量是 $x^{EV} = 7$。\n\n使用EV解的期望结果（EEV）是通过在原始随机问题中使用 $x=x^{EV}=7$ 获得的值。\n$Z_{EEV} = \\mathbb{E}[Q(7, \\xi)] - 7(7)$。\n我们需要 $Q(7, \\xi_1)$ 和 $Q(7, \\xi_2)$：\n$Q(7, \\xi_1) = 5(7) + 12 = 47$。\n$Q(7, \\xi_2) = 6(7) + 20 = 62$。\n$\\mathbb{E}[Q(7, \\xi)] = 0.4(47) + 0.6(62) = 18.8 + 37.2 = 56$。\n$Z_{EEV} = 56 - 49 = 7$。\n\n**5. EVPI 和 VSS**\n\n完美信息期望值（EVPI）是拥有关于未来的完美信息所带来的增益。\n$EVPI = Z_{WS} - Z_{RP} = 11.4 - 9.8 = 1.6$。\n\n随机解的价值（VSS）是解决随机问题而非更简单的EV问题所带来的增益。\n$VSS = Z_{RP} - Z_{EEV} = 9.8 - 7 = 2.8$。\n\n最终要求的值是 $EVPI = 1.6$ 和 $VSS = 2.8$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.6  2.8\n\\end{pmatrix}\n}\n$$", "id": "3194980"}]}