{"hands_on_practices": [{"introduction": "向后递推是一种通过从终点开始反向求解来解决序列决策问题的强大技术。本练习 [@problem_id:3100097] 提供了一个基础且直观的应用：在时间扩展网络中寻找最短路径。通过从每个时间点开始，计算到达终点的最优“未来成本”（cost-to-go），你将直接应用贝尔曼最优性原理，并看到一个复杂的多阶段问题如何分解为一系列简单的单步决策。此外，这个问题也揭示了动态规划与线性规划对偶理论提供的经济学解释之间的深刻联系。", "problem": "考虑一个在有限时间范围 $T = 3$ 内的离散时间、确定性最短路径规划问题。该问题基于一个时空扩展网络，网络节点为 $\\{s, u, v, d\\}$，离散时间为 $t \\in \\{0, 1, 2, 3\\}$。一个单位的流量在时间 $t = 0$ 从节点 $s$ 出发，必须到达节点 $d$。存在一个截止时间 $T_{d} = 2$，如果到达节点 $d$ 的时间严格大于 $T_{d}$，则会产生 $M = 4$ 的固定截止时间惩罚。移动沿着有向弧发生，每次移动使时间推进一个单位。允许通过自环弧在节点上等待，这同样使时间推进一个单位。所有弧的成本都是时间相关的，并且沿路径是可加的。\n\n时空扩展弧及其成本如下。对于 $t = 0$：\n- 移动弧：$(s, 0) \\to (u, 1)$ 成本为 $2$，以及 $(s, 0) \\to (v, 1)$ 成本为 $3$。\n- 等待弧：$(s, 0) \\to (s, 1)$ 成本为 $1$，$(u, 0) \\to (u, 1)$ 成本为 $1$，$(v, 0) \\to (v, 1)$ 成本为 $2$，以及 $(d, 0) \\to (d, 1)$ 成本为 $0$。\n\n对于 $t = 1$：\n- 移动弧：$(u, 1) \\to (d, 2)$ 成本为 $4$，$(v, 1) \\to (d, 2)$ 成本为 $1$，以及 $(u, 1) \\to (v, 2)$ 成本为 $1$；此外，$(s, 1) \\to (u, 2)$ 成本为 $1$ 以及 $(s, 1) \\to (v, 2)$ 成本为 $3$。\n- 等待弧：$(s, 1) \\to (s, 2)$ 成本为 $2$，$(u, 1) \\to (u, 2)$ 成本为 $0$，$(v, 1) \\to (v, 2)$ 成本为 $1$，以及 $(d, 1) \\to (d, 2)$ 成本为 $0$。\n\n对于 $t = 2$：\n- 移动弧：$(u, 2) \\to (d, 3)$ 成本为 $2$，以及 $(v, 2) \\to (d, 3)$ 成本为 $5$。\n- 等待弧：$(s, 2) \\to (s, 3)$ 成本为 $3$，$(u, 2) \\to (u, 3)$ 成本为 $1$，$(v, 2) \\to (v, 3)$ 成本为 $1$，以及 $(d, 2) \\to (d, 3)$ 成本为 $0$。\n\n在时间 $t = 3$ 没有出弧。该惩罚被建模为在 $(d, 3)$ 处的终端成本，等于 $M = 4$，而在截止时间前到达（即在 $(d, 2)$ 处）产生的终端成本为零。\n\n从动态规划 (DP) 的基本最优性原理出发，在时空扩展网络上定义最优未来成本值 $V(i, t)$ 的反向递推，其终端边界值为 $V(d, 2) = 0$ 和 $V(d, 3) = M$。执行反向递推以计算最优值 $V(s, 0)$。\n\n然后，通过添加一个超级汇点 $\\omega$，以及成本为0的弧 $(d, 2) \\to \\omega$ 和成本为 $M$ 的弧 $(d, 3) \\to \\omega$，在时空扩展网络上构建相应的单位流量线性规划 (LP) 模型。该模型强制一个单位的流量从 $(s, 0)$ 流向 $\\omega$，并在所有中间节点-时间对上满足流量守恒。将反向递推值 $\\{V(i, t)\\}$ 解释为与流量守恒约束相关的拉格朗日乘子，并解释互补松弛性如何意味着最优路径所用弧的简约成本相等。\n\n最后，以单个实数的形式报告最小总成本 $V(s, 0)$。无需四舍五入。最终答案不带单位。", "solution": "所提出的问题是一个在有限时间范围内的时空扩展网络上的确定性最短路径问题。这是动态规划和网络优化领域中的一个良定问题。所有必要的数据，包括网络拓扑、时间相关的弧成本和终端条件，都已提供并且是自洽的。该问题具有科学依据，可以使用最优性原理来解决。\n\n解决方案的核心在于应用动态规划的反向递推逻辑。设 $V(i, t)$ 为在时间 $t \\in \\{0, 1, 2, 3\\}$ 处于节点 $i \\in \\{s, u, v, d\\}$ 的状态下的最优未来成本。状态转移沿着从时间 $t$ 到 $t+1$ 的弧发生。最优性原理为该问题提供了 Bellman 方程：\n$$V(i, t) = \\min_{(j, t+1)} \\{ c((i, t), (j, t+1)) + V(j, t+1) \\}$$\n其中，最小化操作遍及所有可在一个时间步内从节点 $i$ 到达的节点 $j$，$c((i, t), (j, t+1))$ 是从状态 $(i, t)$ 转移到状态 $(j, t+1)$ 所经过的弧的成本。递推从终端时间 $T=3$ 开始反向进行。\n\n终端条件已指定。在截止时间 $T_d=2$ 前到达目标节点 $d$ 产生的终端成本为 $0$，因此 $V(d, 2) = 0$。在截止时间后，即在 $t=3$ 到达，会产生 $M=4$ 的惩罚，因此 $V(d, 3) = 4$。对于在最终时间 $T=3$ 结束于非目标节点的任何路径，其成本实际上是无限的，因为它未能到达目的地；因此，我们为 $i \\in \\{s, u, v\\}$ 设置 $V(i, 3) = \\infty$。\n\n我们按如下方式执行反向递推：\n\n**步骤1：计算 $t=2$ 时的值**\n反向递推从倒数第二个时间步 $t=2$ 开始。\n$(d,2)$ 处的终端成本给定为 $V(d,2) = 0$。对于 $t=2$ 时的其他节点：\n\\begin{itemize}\n    \\item $V(u, 2) = \\min \\{ c((u, 2), (d, 3)) + V(d, 3), c((u, 2), (u, 3)) + V(u, 3) \\}$\n    \\\\ $V(u, 2) = \\min \\{ 2 + 4, 1 + \\infty \\} = 6$。\n    \\item $V(v, 2) = \\min \\{ c((v, 2), (d, 3)) + V(d, 3), c((v, 2), (v, 3)) + V(v, 3) \\}$\n    \\\\ $V(v, 2) = \\min \\{ 5 + 4, 1 + \\infty \\} = 9$。\n    \\item $V(s, 2) = c((s, 2), (s, 3)) + V(s, 3) = 3 + \\infty = \\infty$。\n\\end{itemize}\n$t=2$ 时的未来成本值为：$V(s, 2) = \\infty$, $V(u, 2) = 6$, $V(v, 2) = 9$, 以及 $V(d, 2) = 0$。\n\n**步骤2：计算 $t=1$ 时的值**\n使用为 $t=2$ 计算的值，我们递推回 $t=1$。\n\\begin{itemize}\n    \\item $V(s, 1) = \\min \\{ c((s, 1), (u, 2)) + V(u, 2), c((s, 1), (v, 2)) + V(v, 2), c((s, 1), (s, 2)) + V(s, 2) \\}$\n    \\\\ $V(s, 1) = \\min \\{ 1 + 6, 3 + 9, 2 + \\infty \\} = \\min \\{ 7, 12 \\} = 7$。\n    \\item $V(u, 1) = \\min \\{ c((u, 1), (d, 2)) + V(d, 2), c((u, 1), (v, 2)) + V(v, 2), c((u, 1), (u, 2)) + V(u, 2) \\}$\n    \\\\ $V(u, 1) = \\min \\{ 4 + 0, 1 + 9, 0 + 6 \\} = \\min \\{ 4, 10, 6 \\} = 4$。\n    \\item $V(v, 1) = \\min \\{ c((v, 1), (d, 2)) + V(d, 2), c((v, 1), (v, 2)) + V(v, 2) \\}$\n    \\\\ $V(v, 1) = \\min \\{ 1 + 0, 1 + 9 \\} = \\min \\{ 1, 10 \\} = 1$。\n    \\item $V(d, 1) = c((d, 1), (d, 2)) + V(d, 2) = 0 + 0 = 0$。\n\\end{itemize}\n$t=1$ 时的未来成本值为：$V(s, 1) = 7$, $V(u, 1) = 4$, $V(v, 1) = 1$, 以及 $V(d, 1) = 0$。\n\n**步骤3：计算 $t=0$ 时的值**\n最后，我们计算从起始状态 $(s, 0)$ 出发的最优成本。\n\\begin{itemize}\n    \\item $V(s, 0) = \\min \\{ c((s, 0), (u, 1)) + V(u, 1), c((s, 0), (v, 1)) + V(v, 1), c((s, 0), (s, 1)) + V(s, 1) \\}$\n    \\\\ $V(s, 0) = \\min \\{ 2 + 4, 3 + 1, 1 + 7 \\} = \\min \\{ 6, 4, 8 \\} = 4$。\n\\end{itemize}\n从 $(s, 0)$ 到达目标节点 $d$ 的最小总成本为 $V(s, 0) = 4$。\n\n该问题还要求构建相应的线性规划 (LP) 模型并讨论其对偶性。设 $x_{uv}$ 为在包含超级汇点 $\\omega$ 的完整时空扩展网络中，从节点 $u$到节点 $v$ 的弧上的流量。节点是形如 $(i, t)$ 的对。问题是在 $(s,0)$ 和 $\\omega$ 之间找到一条单位流量的路径，使其成本最小。\nLP 模型如下：\n$$ \\text{最小化} \\quad Z = \\sum_{((i, t), (j, t')) \\in A'} c((i, t), (j, t')) x_{((i, t), (j, t'))} $$\n约束条件为：\n1. 流量守恒约束：\n$$ \\sum_{k} x_{k,v} - \\sum_{k} x_{v,k} = b_v \\quad \\text{对于所有节点 } v$$\n其中，供给/需求向量 $b$ 定义为 $b_{(s,0)} = -1$（1个单位流出），$b_{\\omega} = 1$（1个单位流入），对于所有其他节点 $v$，$b_v = 0$。弧集 $A'$ 包括所有给定的时间相关弧，以及通往超级汇点的弧，$((d, 2), \\omega)$ 成本为 $0$，以及 $((d, 3), \\omega)$ 成本为 $M=4$。\n2. 流量非负性：\n$$ x_{uv} \\ge 0 \\quad \\text{对于所有弧 } (u,v) \\in A' $$\n\n这个最小成本流问题的对偶问题是通过为每个节点 $v$ 的流量守恒约束分配一个对偶变量或拉格朗日乘子 $\\lambda(v)$ 来构建的。不失一般性地设 $\\lambda(\\omega)=0$，对偶问题是：\n$$ \\text{最大化} \\quad \\lambda(s,0) $$\n约束条件为：\n$$ \\lambda(u) - \\lambda(v) \\le c_{uv} \\quad \\text{对于所有弧 } (u,v) \\in A' $$\n这些约束可以重写为 $\\lambda(u) \\le c_{uv} + \\lambda(v)$。对于任意给定节点 $u=(i,t)$，这变为：\n$$ \\lambda(i, t) \\le \\min_{(j, t+1)} \\{ c((i, t), (j, t+1)) + \\lambda(j, t+1) \\} $$\n为了最大化 $\\lambda(s,0)$，最优对偶变量 $\\lambda^*(i,t)$ 必须以等式形式满足此关系。这正是 Bellman 方程。动态规划的边界条件 $V(d, 2) = 0$ 和 $V(d, 3) = 4$ 对应于通往汇点的弧的对偶约束：$\\lambda(d, 2) \\le c((d, 2), \\omega) = 0$ 和 $\\lambda(d, 3) \\le c((d, 3), \\omega) = 4$，这些约束在最优点处等式成立。因此，反向递推得到的最优未来成本值 $V(i, t)$ 就是对偶变量的最优值 $\\lambda^*(i,t)$。\n\n互补松弛性将最优原始解 $x^*$ 和最优对偶解 $\\lambda^*$ 联系起来。对于任何弧 $(u,v)$，条件是 $x_{uv}^* (\\lambda^*(u) - \\lambda^*(v) - c_{uv}) = 0$。这意味着如果一条弧 $(u,v)$ 在最优路径上被使用（即 $x_{uv}^* > 0$），那么其对应的对偶约束必须是紧的（即等式成立）：$\\lambda^*(u) - \\lambda^*(v) = c_{uv}$。在优化术语中，弧的简约成本 $\\bar{c}_{uv} = c_{uv} - (\\lambda^*(u) - \\lambda^*(v))$ 必须为零。将 $\\lambda^*(i, t) = V(i, t)$ 代入，一条弧 $((i, t), (j, t+1))$ 处于最优路径上的条件是 $V(i, t) = c((i, t), (j, t+1)) + V(j, t+1)$。这证实了最优路径是由在 Bellman 递推的每一步中都达到最小值的弧组成的。\n\n计算得出 $V(s, 0) = 4$。最优路径可以向前追溯：\n\\begin{itemize}\n    \\item 从 $(s, 0)$ 出发，最小成本 $V(s,0)=4$ 是通过弧 $(s, 0) \\to (v, 1)$ 获得的，因为 $c((s, 0), (v, 1)) + V(v, 1) = 3 + 1 = 4$。\n    \\item 从 $(v, 1)$ 出发，最小成本 $V(v,1)=1$ 是通过弧 $(v, 1) \\to (d, 2)$ 获得的，因为 $c((v, 1), (d, 2)) + V(d, 2) = 1 + 0 = 1$。\n\\end{itemize}\n最优路径是 $(s, 0) \\to (v, 1) \\to (d, 2)$。总成本是弧成本之和 $3 + 1 = 4$，在 $t=2$ 到达，满足截止时间要求。\n\n最小总成本为 $V(s, 0)$。", "answer": "$$\n\\boxed{4}\n$$", "id": "3100097"}, {"introduction": "现实世界的问题很少是确定性的。本练习 [@problem_id:3100123] 将向后递推的应用扩展到不确定性领域，以一个经典的库存管理问题为例。你将学习如何通过优化期望未来成本来处理随机需求，这是随机动态规划的基石。你将发展的关键洞察力在于，成本函数的结构特性（如凸性）如何在递推过程中被保持并向后传播，从而自然地导出简洁而广泛应用的最佳策略结构——$(s, S)$策略。", "problem": "考虑一个有限期（$T=2$ 个周期）的周期性盘点库存系统，允许缺货。在每个周期 $t \\in \\{1,2\\}$ 的开始，决策者观察期初库存水平 $x_t \\in \\mathbb{R}$（负值代表缺货需求），并选择一个订货量 $q_t \\ge 0$。订货在需求实现前即时到达。每个周期中的随机需求 $D_t$ 在各周期之间是独立的，其离散分布已知。期末库存根据 $x_{t+1} = x_t + q_t - D_t$ 进行演变。在周期 $t$ 产生的单周期成本是固定订货成本 $K$（若 $q_t > 0$ 则发生）、线性采购成本 $c q_t$、线性持有成本 $h_t (x_{t+1})^{+}$ 以及线性缺货惩罚成本 $b_t (D_t - x_t - q_t)^{+}$ 的总和。第 2 周期结束时的期末成本为零。所有参数满足 $K > 0$、$c \\ge 0$、$h_t \\ge 0$ 和 $b_t \\ge 0$。\n\n任务 A（从第一性原理推导）：从动态规划（DP）原理和期望的凸性出发，推导在何种关于 $\\{h_t\\}$、$\\{b_t\\}$、$K$、$c$ 和需求分布的条件下，逆向递推能在每个周期 $t$ 得到一个最优的 $(s_t,S_t)$ 结构。您的推导应从 DP 递推开始，论证为何价值函数在没有固定成本时是凸的，在有固定成本时变为 K-凸，从而导出阈值订货策略。不要依赖已有的定理；从单周期成本的凸性和期望的性质进行推理。\n\n任务 B（数值实例）：对于一个特定的非平稳实例，设 $h_1 = 2$，$b_1 = 5$，$h_2 = 4$，$b_2 = 3$，$K = 8$，$c = 1$。需求是独立的，$D_1 \\in \\{0,1\\}$ 满足 $\\mathbb{P}(D_1 = 0) = 0.5$ 和 $\\mathbb{P}(D_1 = 1) = 0.5$；$D_2 \\in \\{0,2\\}$ 满足 $\\mathbb{P}(D_2 = 0) = 0.6$ 和 $\\mathbb{P}(D_2 = 2) = 0.4$。使用逆向递推和任务 A 中的凸性论证，确定最优订货至水平 $S_2$，然后计算最后一个周期的再订货阈值 $s_2$。将最终答案表示为 $s_2$ 的数值。无需四舍五入。", "solution": "该问题被评估为有效，因为它代表了随机优化和库存理论领域中一个定义明确、自成体系且有科学依据的问题。它不包含任何矛盾、歧义或事实上的不健全之处。\n\n根据要求，解决方案分为两部分：理论推导（任务 A）和数值计算（任务 B）。\n\n### 任务 A：$(s_t, S_t)$ 策略结构的推导\n\n问题是在 $T=2$ 个周期的有限期内最小化总期望成本。我们采用逆向递推，这是动态规划（DP）原理的直接应用。\n\n设 $V_t(x_t)$ 为从周期 $t$ 开始到规划期结束的最小期望未来成本，给定起始库存水平为 $x_t$。状态转移为 $x_{t+1} = x_t + q_t - D_t$，其中 $q_t \\ge 0$ 是订货量，$D_t$ 是随机需求。设 $y_t = x_t + q_t$ 为订货后的库存水平（订货至水平）。决策是选择 $y_t \\ge x_t$。\n\nDP 递推由下式给出：\n$$ V_t(x_t) = \\min_{y_t \\ge x_t} \\left\\{ K \\cdot \\mathbb{I}(y_t > x_t) + c(y_t - x_t) + \\mathbb{E}_{D_t} \\left[ C_t^{\\text{op}}(y_t, D_t) + V_{t+1}(y_t - D_t) \\right] \\right\\} $$\n对于 $t \\in \\{1, 2\\}$，其中 $\\mathbb{I}(\\cdot)$ 是指示函数。单周期运营成本为 $C_t^{\\text{op}}(y_t, D_t) = h_t (y_t - D_t)^{+} + b_t(D_t - y_t)^{+}$。期末价值函数为 $V_3(x_3) = 0$，因为期末成本为零。\n\n我们定义函数 $J_t(y_t)$，它表示采购成本、期望运营成本和未来成本之和，是订货至水平 $y_t$ 的函数：\n$$ J_t(y_t) = c y_t + \\mathbb{E}_{D_t} \\left[ C_t^{\\text{op}}(y_t, D_t) + V_{t+1}(y_t - D_t) \\right] $$\n由此，DP 递推简化为：\n$$ V_t(x_t) = \\min_{y_t \\ge x_t} \\left\\{ K \\cdot \\mathbb{I}(y_t > x_t) + J_t(y_t) \\right\\} - c x_t $$\n周期 $t$ 的最优策略结构由函数 $J_t(y_t)$ 的性质决定。我们通过逆向归纳法进行推导。\n\n**周期 $t=2$ (基本情况):**\n周期 2 的递推使用期末价值函数 $V_3(x_3) = 0$。由于 $V_3$ 是一个常数函数，所以它是凸函数。\n函数 $J_2(y_2)$ 是：\n$$ J_2(y_2) = c y_2 + \\mathbb{E}_{D_2} \\left[ h_2 (y_2 - D_2)^{+} + b_2(D_2 - y_2)^{+} + V_3(y_2 - D_2) \\right] $$\n$$ J_2(y_2) = c y_2 + \\mathbb{E}_{D_2} \\left[ h_2 (y_2 - D_2)^{+} + b_2(D_2 - y_2)^{+} \\right] $$\n对于任何实现的需求 $d$，函数 $g(y_2, d) = h_2(y_2 - d)^{+} + b_2(d - y_2)^{+}$ 是关于 $y_2$ 的凸函数，因为它是两个凸函数（由于 $h_2 \\ge 0$ 和 $b_2 \\ge 0$）的和。期望算子保持凸性，因此 $\\mathbb{E}_{D_2}[g(y_2, D_2)]$ 是关于 $y_2$ 的凸函数。项 $cy_2$ 是线性的。因此，$J_2(y_2)$ 是一个凸函数。\n\n周期 2 的决策是选择 $y_2 \\ge x_2$ 以最小化成本。\n- 如果不下订单（$q_2=0$，因此 $y_2=x_2$），成本为 $J_2(x_2) - cx_2$。\n- 如果下订单（$q_2>0$，因此 $y_2>x_2$），成本为 $K + J_2(y_2) - cx_2$。$y_2$ 的最佳选择是使凸函数 $J_2(y_2)$ 最小化的那一个。设这个最小化点为 $S_2$。订货时的最小成本是 $K + J_2(S_2) - cx_2$。\n\n当且仅当订货至 $S_2$ 的成本低于不订货的成本时，最优决策是订货：\n$$ K + J_2(S_2) - cx_2  J_2(x_2) - cx_2 \\quad \\iff \\quad J_2(x_2) > K + J_2(S_2) $$\n由于 $J_2(y_2)$ 是凸函数且 $S_2$ 是其最小化点，因此对于 $y_2  S_2$，$J_2(y_2)$ 是非增的。我们可以定义一个阈值 $s_2 \\le S_2$ 使得 $J_2(s_2) = K + J_2(S_2)$。对于任何库存水平 $x_2  s_2$，我们有 $J_2(x_2) > J_2(s_2) = K + J_2(S_2)$，因此订货是最优的。最优策略是：如果 $x_2  s_2$，则订货至 $S_2$；如果 $x_2 \\ge s_2$，则不订货。这正是一个 $(s_2, S_2)$ 策略。唯一需要的条件是 $h_2 \\ge 0$ 和 $b_2 \\ge 0$，这些条件在题目中已给出。\n\n周期 2 的价值函数可以写为：\n$$ V_2(x_2) = \\begin{cases} K + J_2(S_2) - cx_2  \\text{若 } x_2  s_2 \\\\ J_2(x_2) - cx_2  \\text{若 } x_2 \\ge s_2 \\end{cases} $$\n这个函数不是凸函数。然而，它属于一类被称为 K-凸函数的函数，这对于归纳的进行至关重要。\n\n**周期 $t=1$ (归纳步骤):**\n我们分析周期 1 的成本函数：\n$$ J_1(y_1) = c y_1 + \\mathbb{E}_{D_1} \\left[ h_1 (y_1 - D_1)^{+} + b_1(D_1 - y_1)^{+} + V_2(y_1 - D_1) \\right] $$\n这可以写成两项之和：\n$$ J_1(y_1) = \\underbrace{\\left( c y_1 + \\mathbb{E}_{D_1} \\left[ C_1^{\\text{op}}(y_1, D_1) \\right] \\right)}_{\\text{项 A}} + \\underbrace{\\mathbb{E}_{D_1} \\left[ V_2(y_1 - D_1) \\right]}_{\\text{项 B}} $$\n项 A 关于 $y_1$ 是凸的，原因与 $J_2(y_2)$ 是凸的相同（即 $h_1 \\ge 0, b_1 \\ge 0$）。\n项 B 是下一周期 K-凸价值函数的期望。库存理论中一个归功于 Scarf (1960) 的基本结果是，K-凸性在期望运算和与凸函数相加的运算下是保持的。也就是说，如果 $V_2(x)$ 是 K-凸的，那么 $\\mathbb{E}_{D_1}[V_2(y_1 - D_1)]$ 也是 K-凸的（使用相同或不同的常数 $K'$）。一个凸函数（项 A）和一个 K-凸函数（项 B）的和结果是一个 K-凸函数。\n\n因此，$J_1(y_1)$ 是一个 K-凸函数。一个 K-凸函数，当在最小化问题中与固定成本 $K$ 结合时，表现出与凸函数相似的结构特性。存在一个最优订货至水平 $S_1$（它最小化 $J_1(y_1)$）和一个再订货点 $s_1$（满足一个类似于 $J_1(s_1) = K + J_1(S_1)$ 的方程），它们定义了最优策略。因此，一个 $(s_1, S_1)$ 策略对于周期 1 也是最优的。\n\n在这种设定下，$(s_t, S_t)$ 策略最优性的一般条件是单周期持有成本和缺货成本参数的非负性，即对所有 $t$ 都有 $h_t \\ge 0$ 和 $b_t \\ge 0$。这些条件在问题陈述中是满足的。\n\n### 任务 B：$s_2$ 的数值计算\n\n我们需要找到最后一个周期的再订货阈值 $s_2$。这需要刻画函数 $J_2(y)$ 并找到其最小化点 $S_2$。参数为 $c=1$，$K=8$，$h_2=4$，$b_2=3$。需求 $D_2$ 在 $\\{0, 2\\}$ 中取值，概率为 $\\mathbb{P}(D_2=0)=0.6$ 和 $\\mathbb{P}(D_2=2)=0.4$。\n\n函数 $J_2(y)$ 是：\n$$ J_2(y) = c y + \\mathbb{E}_{D_2} \\left[ h_2 (y - D_2)^{+} + b_2 (D_2 - y)^{+} \\right] $$\n$$ J_2(y) = 1 \\cdot y + \\left[ 4(y-0)^{+} + 3(0-y)^{+} \\right] \\mathbb{P}(D_2=0) + \\left[ 4(y-2)^{+} + 3(2-y)^{+} \\right] \\mathbb{P}(D_2=2) $$\n$$ J_2(y) = y + 0.6 \\left[ 4y^{+} + 3(-y)^{+} \\right] + 0.4 \\left[ 4(y-2)^{+} + 3(2-y)^{+} \\right] $$\n这是一个分段线性凸函数。函数定义可能改变的点是 $y=0$ 和 $y=2$。我们在三个区域内分析 $J_2(y)$：\n\n1.  当 $y  0$ 时：$y^{+} = 0$， $(-y)^{+} = -y$， $(y-2)^{+} = 0$， $(2-y)^{+} = 2-y$。\n    $$ J_2(y) = y + 0.6(3(-y)) + 0.4(3(2-y)) = y - 1.8y + 2.4 - 1.2y = -2y + 2.4 $$\n    这个区域的斜率为 -2。\n\n2.  当 $0 \\le y  2$ 时：$y^{+} = y$， $(-y)^{+} = 0$， $(y-2)^{+} = 0$， $(2-y)^{+} = 2-y$。\n    $$ J_2(y) = y + 0.6(4y) + 0.4(3(2-y)) = y + 2.4y + 2.4 - 1.2y = 2.2y + 2.4 $$\n    这个区域的斜率为 2.2。\n\n3.  当 $y \\ge 2$ 时：$y^{+} = y$， $(-y)^{+} = 0$， $(y-2)^{+} = y-2$， $(2-y)^{+} = 0$。\n    $$ J_2(y) = y + 0.6(4y) + 0.4(4(y-2)) = y + 2.4y + 1.6y - 3.2 = 5y - 3.2 $$\n    这个区域的斜率为 5。\n\n$J_2(y)$ 的斜率在 $y=0$ 处从 -2 变为 2.2。由于斜率在这一点从负变正，凸函数 $J_2(y)$ 的全局最小值出现在 $y=0$。因此，最优订货至水平为 $S_2 = 0$。\n\n$J_2(y)$ 的最小值为 $J_2(S_2) = J_2(0)$。使用对 $0 \\le y  2$ 有效的表达式：\n$$ J_2(0) = 2.2(0) + 2.4 = 2.4 $$\n\n再订货阈值 $s_2$ 由方程 $J_2(s_2) = K + J_2(S_2)$ 定义。\n给定 $K=8$，我们有：\n$$ J_2(s_2) = 8 + 2.4 = 10.4 $$\n由于 $s_2 \\le S_2 = 0$，我们必须使用对 $y  0$ 有效的 $J_2(y)$ 表达式：\n$$ J_2(s_2) = -2s_2 + 2.4 $$\n令其等于 10.4：\n$$ -2s_2 + 2.4 = 10.4 $$\n$$ -2s_2 = 10.4 - 2.4 = 8 $$\n$$ s_2 = \\frac{8}{-2} = -4 $$\n周期 2 的再订货阈值为 $s_2 = -4$。这意味着如果在周期 2 开始时的库存水平低于 -4（即缺货量超过 4 个单位），则应下订单将库存水平提高到 $S_2 = 0$。否则，不下订单。", "answer": "$$\\boxed{-4}$$", "id": "3100123"}, {"introduction": "现在我们转向现代控制理论领域，在这里，向后递推体现为著名的“线性二次调节器”（LQR）问题中的里卡提方程。本练习 [@problem_id:3100095] 旨在解决一个具有连续状态的动态系统的控制问题，这是工程学和机器人学中无处不在的挑战。你将推导基于矩阵的“未来成本”函数（cost-to-go）的向后递推关系，更重要的是，你将分析一个具有不定（indefinite）终端成本的非标准场景。这种变化将促使你超越公式的死记硬背，批判性地审视保证最优控制律存在的条件，从而加深你对该理论基础的理解。", "problem": "考虑一个具有线性动态和二次代价的离散时间、有限时域最优控制问题。状态根据 $x_{t+1}=A x_t + B u_t$ 演化，其中 $x_t \\in \\mathbb{R}^2$，$u_t \\in \\mathbb{R}$，$A=\\mathrm{diag}(1,\\,\\tfrac{1}{2})$，且 $B=\\begin{pmatrix}1\\\\ \\tfrac{1}{2}\\end{pmatrix}$。阶段代价为 $c_t(x_t,u_t)=\\alpha_t \\|x_t\\|^2 + \\beta_t \\|u_t\\|^2$，其中对于所有 $t2$，代价参数为 $(\\alpha_0, \\beta_0) = (1,1)$ 和 $(\\alpha_1, \\beta_1) = (2,1)$。终端代价为 $J_2(x_2)=x_2^\\top P_2 x_2$，其中 $P_2 = \\begin{pmatrix}3  -3 \\\\ -3  3\\end{pmatrix}$。该终端代价矩阵是不定的。\n\n推导待去代价矩阵 $P_t$ 的一般离散时间里卡提方程。分析在何种条件下，反向递推能够产生一个有效且有界的代价函数，并确定该条件是否在每一步都得到满足。如果条件未满足，则该问题没有定义明确的解。如果条件得到满足，则计算 $(P_0)_{11}$。", "solution": "该问题是一个离散时间、有限时域最优控制问题，具体来说是一个带有非标准不定终端代价矩阵的线性二次调节器（LQR）问题。任务涉及推导待去代价矩阵的一般反向递推，分析其有效性条件，然后将其应用于给定的特定参数以找到特定的矩阵元素。\n\n首先，我们根据问题陈述统一并验证给定的参数：\n- 状态动态：$x_{t+1}=A x_t + B u_t$，其中 $x_t \\in \\mathbb{R}^2$ 且 $u_t \\in \\mathbb{R}$。\n- 状态矩阵：$A=\\mathrm{diag}(1,\\,\\tfrac{1}{2}) = \\begin{pmatrix} 1  0 \\\\ 0  \\frac{1}{2} \\end{pmatrix}$。\n- 输入矩阵：$B=\\begin{pmatrix}1\\\\ \\tfrac{1}{2}\\end{pmatrix}$。\n- 阶段代价：$c_t(x_t,u_t)=x_t^\\top Q_t x_t + u_t^\\top R_t u_t$。\n- 代价参数：$Q_0 = 1 \\cdot I_2, R_0 = 1$；$Q_1 = 2 \\cdot I_2, R_1 = 1$。\n- 终端代价矩阵：$P_2 = \\begin{pmatrix}3  -3\\\\ -3  3\\end{pmatrix}$。这是一个半正定矩阵，不是不定的。\n\n价值函数 $V_t(x_t)$ 具有二次形式 $x_t^\\top P_t x_t$。应用贝尔曼最优性原理，我们得到反向递推关系：\n$$V_t(x_t) = \\min_{u_t} \\{ x_t^\\top Q_t x_t + u_t^\\top R_t u_t + V_{t+1}(A x_t + B u_t) \\}$$\n$$x_t^\\top P_t x_t = \\min_{u_t} \\{ x_t^\\top Q_t x_t + u_t^\\top R_t u_t + (A x_t + B u_t)^\\top P_{t+1} (A x_t + B u_t) \\}$$\n通过对 $u_t$ 求导并令其为零，可以找到最优控制 $u_t^*$。这要求关于 $u_t$ 的二阶导数矩阵（Hessian矩阵）是正定的。Hessian矩阵是 $2(R_t + B^\\top P_{t+1} B)$。因此，一个明确的最优解存在的关键条件是 $R_t + B^\\top P_{t+1} B$ 是正定的（对于标量控制，即 $R_t + B^\\top P_{t+1} B  0$）。\n\n如果满足此条件，则最优控制为 $u_t^* = -(R_t + B^\\top P_{t+1} B)^{-1} B^\\top P_{t+1} A x_t$。将此代回方程，我们得到离散时间里卡提方程：\n$$P_t = Q_t + A^\\top P_{t+1} A - A^\\top P_{t+1} B (R_t + B^\\top P_{t+1} B)^{-1} B^\\top P_{t+1} A$$\n我们将从 $t=1$ 开始反向递推到 $t=0$。\n\n**步骤1：从 $t=2$ 到 $t=1$**\n我们需要计算 $P_1$。首先，验证条件是否满足：\n$$ B^\\top P_2 B = \\begin{pmatrix}1  \\tfrac{1}{2}\\end{pmatrix} \\begin{pmatrix}3  -3\\\\ -3  3\\end{pmatrix} \\begin{pmatrix}1\\\\ \\tfrac{1}{2}\\end{pmatrix} = \\begin{pmatrix}1.5  -1.5\\end{pmatrix} \\begin{pmatrix}1\\\\ 0.5\\end{pmatrix} = 1.5 - 0.75 = 0.75 $$\n$$ R_1 + B^\\top P_2 B = 1 + 0.75 = 1.75 > 0 $$\n条件满足。现在我们计算里卡提方程的各项：\n$$ A^\\top P_2 A = \\begin{pmatrix}1  0\\\\ 0  \\tfrac{1}{2}\\end{pmatrix} \\begin{pmatrix}3  -3\\\\ -3  3\\end{pmatrix} \\begin{pmatrix}1  0\\\\ 0  \\tfrac{1}{2}\\end{pmatrix} = \\begin{pmatrix}3  -3\\\\ -1.5  1.5\\end{pmatrix} \\begin{pmatrix}1  0\\\\ 0  \\tfrac{1}{2}\\end{pmatrix} = \\begin{pmatrix}3  -1.5\\\\ -1.5  0.75\\end{pmatrix} $$\n$$ A^\\top P_2 B = \\begin{pmatrix}1  0\\\\ 0  \\tfrac{1}{2}\\end{pmatrix} \\begin{pmatrix}3  -3\\\\ -3  3\\end{pmatrix} \\begin{pmatrix}1\\\\ \\tfrac{1}{2}\\end{pmatrix} = \\begin{pmatrix}1  0\\\\ 0  \\tfrac{1}{2}\\end{pmatrix} \\begin{pmatrix}1.5\\\\ -1.5\\end{pmatrix} = \\begin{pmatrix}1.5\\\\ -0.75\\end{pmatrix} = \\begin{pmatrix}3/2\\\\ -3/4\\end{pmatrix} $$\n$$ B^\\top P_2 A = \\begin{pmatrix}1  \\tfrac{1}{2}\\end{pmatrix} \\begin{pmatrix}3  -1.5\\\\ -1.5  0.75\\end{pmatrix} = \\begin{pmatrix}2.25  -1.125\\end{pmatrix} = \\begin{pmatrix}9/4  -9/8\\end{pmatrix} $$\n里卡提更新项为：\n$$ (A^\\top P_2 B) (R_1 + B^\\top P_2 B)^{-1} (B^\\top P_2 A) = \\begin{pmatrix}3/2\\\\ -3/4\\end{pmatrix} (1.75)^{-1} \\begin{pmatrix}9/4  -9/8\\end{pmatrix} = \\begin{pmatrix}3/2\\\\ -3/4\\end{pmatrix} \\frac{4}{7} \\begin{pmatrix}9/4  -9/8\\end{pmatrix} = \\begin{pmatrix}6/7\\\\ -3/7\\end{pmatrix} \\begin{pmatrix}9/4  -9/8\\end{pmatrix} = \\begin{pmatrix} 54/28  -54/56 \\\\ -27/28  27/56 \\end{pmatrix} = \\begin{pmatrix} 27/14  -27/28 \\\\ -27/28  27/56 \\end{pmatrix} $$\n现在计算 $P_1$：\n$$ P_1 = Q_1 + A^\\top P_2 A - (\\text{更新项}) = \\begin{pmatrix}2  0\\\\ 0  2\\end{pmatrix} + \\begin{pmatrix}3  -1.5\\\\ -1.5  0.75\\end{pmatrix} - \\begin{pmatrix} 27/14  -27/28 \\\\ -27/28  27/56 \\end{pmatrix} $$\n$$ P_1 = \\begin{pmatrix}5 - 27/14  -1.5 + 27/28\\\\ -1.5 + 27/28  2.75 - 27/56\\end{pmatrix} = \\begin{pmatrix}43/14  -15/28\\\\ -15/28  127/56\\end{pmatrix} $$\n\n**步骤2：从 $t=1$ 到 $t=0$**\n我们需要计算 $P_0$。首先，验证条件：\n$$ B^\\top P_1 B = \\begin{pmatrix}1  \\tfrac{1}{2}\\end{pmatrix} \\begin{pmatrix}43/14  -15/28\\\\ -15/28  127/56\\end{pmatrix} \\begin{pmatrix}1\\\\ \\tfrac{1}{2}\\end{pmatrix} = \\begin{pmatrix}\\frac{43}{14} - \\frac{15}{56}  -\\frac{15}{28} + \\frac{127}{112}\\end{pmatrix} \\begin{pmatrix}1\\\\ \\tfrac{1}{2}\\end{pmatrix} = \\begin{pmatrix}\\frac{157}{56}  \\frac{67}{112}\\end{pmatrix} \\begin{pmatrix}1\\\\ \\tfrac{1}{2}\\end{pmatrix} = \\frac{157}{56} + \\frac{67}{224} = \\frac{628+67}{224} = \\frac{695}{224} $$\n$$ R_0 + B^\\top P_1 B = 1 + \\frac{695}{224} = \\frac{224+695}{224} = \\frac{919}{224} > 0 $$\n条件满足。现在我们计算 $(P_0)_{11}$ 所需的各项：\n$$ A^\\top P_1 A = \\begin{pmatrix}1  0\\\\ 0  \\tfrac{1}{2}\\end{pmatrix} \\begin{pmatrix}43/14  -15/28\\\\ -15/28  127/56\\end{pmatrix} \\begin{pmatrix}1  0\\\\ 0  \\tfrac{1}{2}\\end{pmatrix} = \\begin{pmatrix}43/14  -15/56\\\\ -15/56  127/448\\end{pmatrix} $$\n因此，$(A^\\top P_1 A)_{11} = 43/14$。\n里卡提更新项的 $(1,1)$ 元素是 $(A^\\top P_1 B)_1 (R_0 + B^\\top P_1 B)^{-1} (B^\\top P_1 A)_1$。\n$$ (A^\\top P_1 B)_1 = (A^\\top P_1 B) \\text{ 的第一个元素} = \\begin{pmatrix}1  0\\\\ 0  \\tfrac{1}{2}\\end{pmatrix} \\begin{pmatrix}157/56\\\\ 67/112\\end{pmatrix} \\text{ 的第一个元素} = \\frac{157}{56} $$\n$$ (B^\\top P_1 A)_1 = (B^\\top P_1 A) \\text{ 的第一个元素} = \\begin{pmatrix}1  \\tfrac{1}{2}\\end{pmatrix} \\begin{pmatrix}43/14  \\dots \\\\ -15/56  \\dots\\end{pmatrix} \\text{ 的第一个元素} = \\frac{43}{14} - \\frac{15}{112} = \\frac{344-15}{112} = \\frac{329}{112} $$\n更新项的 $(1,1)$ 元素为：\n$$ \\frac{157}{56} \\left(\\frac{919}{224}\\right)^{-1} \\frac{329}{112} = \\frac{157}{56} \\cdot \\frac{224}{919} \\cdot \\frac{329}{112} = \\frac{157 \\cdot 4}{919} \\cdot \\frac{329}{112} = \\frac{157}{919} \\cdot \\frac{329}{28} = \\frac{51653}{25732} $$\n最后，计算 $(P_0)_{11}$：\n$$ (P_0)_{11} = (Q_0)_{11} + (A^\\top P_1 A)_{11} - (\\text{更新项})_{11} = 1 + \\frac{43}{14} - \\frac{51653}{25732} = \\frac{57}{14} - \\frac{51653}{25732} $$\n$$ (P_0)_{11} = \\frac{57 \\cdot 1838}{25732} - \\frac{51653}{25732} = \\frac{104766 - 51653}{25732} = \\frac{53113}{25732} $$", "answer": "$$\\boxed{\\frac{53113}{25732}}$$", "id": "3100095"}]}