{"hands_on_practices": [{"introduction": "我们对最优化一阶必要条件的探索始于最简单的情形：无约束优化。在这里，找到最优解候选点的核心思想是微积分中的一个基本概念：在函数的极值点，其导数必须为零。这个练习 [@problem_id:2173061] 将我们置于一个熟悉的场景中——从一组测量数据中寻找最佳估计值。通过最小化误差平方和，你将亲手推导出算术平均值这一我们熟知的统计量，从而深刻理解优化原理与数据分析之间的内在联系。", "problem": "一位实验物理学家为了测量一个基本物理常数，进行了 $n$ 次实验。获得的测量数据集为 $\\{y_1, y_2, \\ldots, y_n\\}$。为了根据这些测量值确定该常数的单个最佳估计值 $c$，该物理学家决定使用最小二乘法原理。该原理指出，最佳估计值是使估计值与每个测量值之间偏差的平方和最小化的 $c$ 值。\n\n偏差平方和由以下函数给出：\n$$ S(c) = \\sum_{i=1}^n (y_i - c)^2 $$\n\n使用一阶必要条件求最小值，确定使 $S(c)$ 最小的 $c$ 值。请用测量值 $y_i$ 和测量总次数 $n$ 的符号表达式来表示你的答案。", "solution": "我们寻求使 $S(c) = \\sum_{i=1}^{n} (y_{i} - c)^{2}$ 最小化的 $c$。使用一阶必要条件，对 $S(c)$ 关于 $c$ 求导：\n$$\n\\frac{dS}{dc} = \\sum_{i=1}^{n} \\frac{d}{dc}(y_{i} - c)^{2} = \\sum_{i=1}^{n} 2(y_{i} - c)(-1) = 2 \\sum_{i=1}^{n} (c - y_{i}) = 2\\left(nc - \\sum_{i=1}^{n} y_{i}\\right).\n$$\n令导数为零：\n$$\n2\\left(nc - \\sum_{i=1}^{n} y_{i}\\right) = 0 \\quad \\Longrightarrow \\quad nc - \\sum_{i=1}^{n} y_{i} = 0 \\quad \\Longrightarrow \\quad c = \\frac{1}{n} \\sum_{i=1}^{n} y_{i}.\n$$\n为完整起见，二阶导数为\n$$\n\\frac{d^{2}S}{dc^{2}} = \\sum_{i=1}^{n} 2 = 2n  0,\n$$\n这证实了该临界点是一个最小值点。因此，使 $S(c)$ 最小的 $c$ 是测量值的算术平均值。", "answer": "$$\\boxed{\\frac{1}{n}\\sum_{i=1}^{n} y_{i}}$$", "id": "2173061"}, {"introduction": "现实世界中的大多数优化问题都受到各种限制，例如预算、材料强度或物理定律。为了解决这些受约束的问题，我们需要一个更强大的工具：卡鲁什-库恩-塔克 (KKT) 条件。这个练习 [@problem_id:3129910] 不仅仅是一个寻找桁架结构最优设计尺寸的工程计算题，它更是一个关于拉格朗日乘数经济学含义的生动实践。通过求解，你将理解这些乘数如何充当“影子价格”，量化地揭示了放宽某个约束（例如提高材料的许用应力）能为我们带来多大的收益（例如减轻结构重量），从而将抽象的数学理论与具体的设计决策联系起来。", "problem": "考虑一个两杆平面桁架，其杆件被设计为仅承受轴向力。每个杆件 $i \\in \\{1,2\\}$ 的长度为 $L_i$，横截面积为 $A_i$，由质量密度为 $\\rho$ 的材料制成。在给定的载荷工况下，杆件 $i$ 中的轴向力是一个已知的正常数 $N_i$。桁架的重量建模为 $w(A_1,A_2) = \\rho g (L_1 A_1 + L_2 A_2)$，其中 $g$ 是重力加速度。许用轴向应力受到每个杆件的材料约束 $\\sigma_i(A_i) = N_i/A_i \\le \\sigma_{\\max}$ 的限制，且 $A_i \\ge 0$。要求您使用一阶最优性必要条件，将与应力约束相关的拉格朗日乘子解释为应力极限的影子价格。\n\n给定 $\\rho = 7850\\,\\mathrm{kg/m^3}$，$g = 9.81\\,\\mathrm{m/s^2}$，$L_1 = 3\\,\\mathrm{m}$，$L_2 = 4\\,\\mathrm{m}$，$N_1 = 50{,}000\\,\\mathrm{N}$，$N_2 = 100{,}000\\,\\mathrm{N}$ 以及 $\\sigma_{\\max} = 250 \\times 10^6\\,\\mathrm{Pa}$。在这些数据下，考虑在应力约束条件下对 $w(A_1,A_2)$ 进行约束最小化。仅使用拉格朗日函数的基本定义和针对不等式约束的卡鲁什-库恩-塔克 (KKT) 一阶必要条件，推断在最优设计中哪些约束是激活的，推导最优面积 $A_1^\\star$ 和 $A_2^\\star$，计算相关的拉格朗日乘子 $\\lambda_1^\\star$ 和 $\\lambda_2^\\star$，并解释它们相对于应力极限中参数 $\\sigma_{\\max}$ 的影子价格含义。\n\n以下哪个陈述正确地描述了此问题的 KKT 乘子及其影子价格解释？\n\nA. 在 KKT 最优点，两个应力约束都是激活的，因此 $A_1^\\star = N_1/\\sigma_{\\max}$ 且 $A_2^\\star = N_2/\\sigma_{\\max}$；拉格朗日乘子为正，且等于 $\\lambda_i^\\star = \\rho g L_i N_i / \\sigma_{\\max}^2$，数值上 $\\lambda_1^\\star \\approx 1.85 \\times 10^{-7}\\,\\mathrm{N/Pa}$ 且 $\\lambda_2^\\star \\approx 4.93 \\times 10^{-7}\\,\\mathrm{N/Pa}$。影子价格的解释是 $\\frac{\\partial w^\\star}{\\partial \\sigma_{\\max}} = -(\\lambda_1^\\star + \\lambda_2^\\star) \\approx -6.78 \\times 10^{-7}\\,\\mathrm{N/Pa}$；增加许用应力会以该速率降低最优重量。\n\nB. 乘子为负，并衡量当 $\\sigma_{\\max}$ 增加时最优重量增加的程度；具体来说 $\\frac{\\partial w^\\star}{\\partial \\sigma_{\\max}} = +(\\lambda_1^\\star + \\lambda_2^\\star) \\approx +6.78 \\times 10^{-7}\\,\\mathrm{N/Pa}$。\n\nC. 只有一个应力约束是激活的（承受较高载荷的杆件），因此 $\\lambda_2^\\star  0$ 且 $\\lambda_1^\\star = 0$，并且 $\\frac{\\partial w^\\star}{\\partial \\sigma_{\\max}} = -\\lambda_2^\\star \\approx -4.93 \\times 10^{-7}\\,\\mathrm{N/Pa}$。\n\nD. 乘子等于最优面积，$\\lambda_i^\\star = A_i^\\star$，且影子价格为 $\\frac{\\partial w^\\star}{\\partial \\sigma_{\\max}} = -(A_1^\\star + A_2^\\star) \\approx -6.0 \\times 10^{-4}\\,\\mathrm{m^2/Pa}$。", "solution": "为了解决这个问题，我们首先建立优化模型，然后应用卡鲁什-库恩-塔克 (KKT) 条件来求解最优解和拉格朗日乘子，并最终解释其作为影子价格的含义。\n\n**1. 优化问题表述**\n\n目标是最小化桁架的重量 $w(A_1, A_2)$，该函数是线性的：\n$$\n\\min_{A_1, A_2} \\quad w(A_1, A_2) = \\rho g (L_1 A_1 + L_2 A_2)\n$$\n约束条件需要写成标准形式 $g_i(\\mathbf{x}) \\le 0$。应力约束为 $\\frac{N_i}{A_i} \\le \\sigma_{\\max}$，可以重写为：\n$$\nc_1(A_1) = \\frac{N_1}{A_1} - \\sigma_{\\max} \\le 0\n$$\n$$\nc_2(A_2) = \\frac{N_2}{A_2} - \\sigma_{\\max} \\le 0\n$$\n由于 $N_i > 0$ 和 $\\sigma_{\\max} > 0$，这些约束隐含了 $A_i \\ge N_i/\\sigma_{\\max} > 0$，因此非负约束 $A_i \\ge 0$ 是冗余的。这是一个凸优化问题，因为目标函数是线性的，约束函数是凸的。\n\n**2. KKT 条件的应用**\n\n拉格朗日函数为：\n$$\n\\mathcal{L}(A_1, A_2, \\lambda_1, \\lambda_2) = \\rho g (L_1 A_1 + L_2 A_2) + \\lambda_1 \\left( \\frac{N_1}{A_1} - \\sigma_{\\max} \\right) + \\lambda_2 \\left( \\frac{N_2}{A_2} - \\sigma_{\\max} \\right)\n$$\nKKT 条件包括：\n- **平稳性**: $\\nabla_{\\mathbf{A}} \\mathcal{L} = 0$\n  $$ \\frac{\\partial \\mathcal{L}}{\\partial A_1} = \\rho g L_1 - \\frac{\\lambda_1 N_1}{A_1^2} = 0 $$\n  $$ \\frac{\\partial \\mathcal{L}}{\\partial A_2} = \\rho g L_2 - \\frac{\\lambda_2 N_2}{A_2^2} = 0 $$\n- **原始可行性**: $c_i(\\mathbf{A}) \\le 0$\n- **对偶可行性**: $\\lambda_1, \\lambda_2 \\ge 0$\n- **互补松弛性**: $\\lambda_i c_i(\\mathbf{A}) = 0$\n\n**3. 求解最优点**\n\n目标函数是 $A_1$ 和 $A_2$ 的正系数线性组合。为了最小化重量，我们必须使 $A_1$ 和 $A_2$ 尽可能小。可行域由 $A_1 \\ge N_1/\\sigma_{\\max}$ 和 $A_2 \\ge N_2/\\sigma_{\\max}$ 定义。因此，最优解必须在两个约束的边界上取得，即两个约束都**激活**：\n$$ A_1^\\star = \\frac{N_1}{\\sigma_{\\max}} \\quad \\text{和} \\quad A_2^\\star = \\frac{N_2}{\\sigma_{\\max}} $$\n因为约束是激活的 ($c_i(A_i^\\star)=0$)，互补松弛性条件得到满足。\n从平稳性条件可知，由于 $\\rho, g, L_i$ 均为正，$\\lambda_i$ 必须为正，这满足了对偶可行性。\n\n**4. 计算拉格朗日乘子**\n\n将最优面积代入平稳性方程，解出 $\\lambda_i^\\star$：\n$$ \\lambda_1^\\star = \\frac{\\rho g L_1 (A_1^\\star)^2}{N_1} = \\frac{\\rho g L_1}{N_1} \\left( \\frac{N_1}{\\sigma_{\\max}} \\right)^2 = \\frac{\\rho g L_1 N_1}{\\sigma_{\\max}^2} $$\n$$ \\lambda_2^\\star = \\frac{\\rho g L_2 (A_2^\\star)^2}{N_2} = \\frac{\\rho g L_2}{N_2} \\left( \\frac{N_2}{\\sigma_{\\max}} \\right)^2 = \\frac{\\rho g L_2 N_2}{\\sigma_{\\max}^2} $$\n使用给定数值：\n- $\\rho g = 7850 \\times 9.81 \\approx 77008.5\\,\\mathrm{N/m^3}$\n- $\\sigma_{\\max} = 250 \\times 10^6\\,\\mathrm{Pa}$\n- $\\sigma_{\\max}^2 = 6.25 \\times 10^{16}\\,\\mathrm{Pa}^2$\n$$ \\lambda_1^\\star = \\frac{(77008.5) \\times (3) \\times (50000)}{6.25 \\times 10^{16}} \\approx 1.848 \\times 10^{-7} $$\n$$ \\lambda_2^\\star = \\frac{(77008.5) \\times (4) \\times (100000)}{6.25 \\times 10^{16}} \\approx 4.929 \\times 10^{-7} $$\n单位分析：$\\lambda_i$ 的单位为 $\\frac{(\\mathrm{N/m^3}) \\cdot \\mathrm{m} \\cdot \\mathrm{N}}{(\\mathrm{Pa})^2} = \\frac{\\mathrm{N^2/m^2}}{(\\mathrm{N/m^2})^2} = \\mathrm{m}^2$。由于 $\\mathrm{N/Pa} = \\mathrm{N}/(\\mathrm{N/m^2}) = \\mathrm{m}^2$，单位 $\\mathrm{N/Pa}$ 等价于 $\\mathrm{m}^2$。因此，$\\lambda_1^\\star \\approx 1.85 \\times 10^{-7}\\,\\mathrm{N/Pa}$ 且 $\\lambda_2^\\star \\approx 4.93 \\times 10^{-7}\\,\\mathrm{N/Pa}$。\n\n**5. 影子价格解释**\n\n根据包络定理，最优目标值 $w^\\star$ 对约束参数 $\\sigma_{\\max}$ 的敏感度（即影子价格）为：\n$$ \\frac{dw^\\star}{d\\sigma_{\\max}} = \\frac{\\partial \\mathcal{L}}{\\partial \\sigma_{\\max}}\\bigg|_{\\text{opt}} = \\frac{\\partial}{\\partial \\sigma_{\\max}} \\left[ \\dots - \\lambda_1 \\sigma_{\\max} - \\lambda_2 \\sigma_{\\max} \\right] = -(\\lambda_1^\\star + \\lambda_2^\\star) $$\n这个负号表示，如果许用应力 $\\sigma_{\\max}$ 增加，结构可以被设计得更轻，最优重量 $w^\\star$ 会减少。减少的速率由拉格朗日乘子之和给出。\n$$ \\frac{dw^\\star}{d\\sigma_{\\max}} \\approx -(1.85 \\times 10^{-7} + 4.93 \\times 10^{-7}) = -6.78 \\times 10^{-7}\\,\\mathrm{N/Pa} $$\n\n**6. 评估选项**\n\n- **A**: 声明两个约束都激活，给出了正确的 $A_i^\\star$ 和 $\\lambda_i^\\star$ 的公式和数值，以及正确的影子价格公式、数值和物理解释。此选项完全正确。\n- **B**: 声明乘子为负，且影子价格为正，与KKT理论和物理直觉相悖。错误。\n- **C**: 声明只有一个约束激活，这与目标函数的形式相矛盾。为了最小化重量，两个面积都必须尽可能小，因此两个约束都必须激活。错误。\n- **D**: 声明乘子等于面积，数值上不符。影子价格的公式和数值也错误。错误。\n\n因此，选项 A 是唯一正确的陈述。", "answer": "$$\\boxed{A}$$", "id": "3129910"}, {"introduction": "然而，并非所有函数都是光滑可导的。当我们的目标函数存在“扭结”或尖点，导致其在某些点上导数未定义时，我们该如何寻找其最小值呢？这个练习 [@problem_id:3129939] 将引导你进入非光滑凸优化的世界，并介绍次微分（subdifferential）这一概念，它是梯度在不可导函数上的推广。通过寻找次微分包含零点的$x^{\\star}$，你将学会如何处理和优化在机器学习（例如，使用ReLU激活函数的神经网络）等领域中常见的复杂分段函数。", "problem": "设函数 $f : \\mathbb{R} \\to \\mathbb{R}$ 定义为\n$$\nf(x) = \\max\\left\\{\\,3x - 4,\\,-x + 1,\\,\\frac{1}{2}x\\,\\right\\}.\n$$\n函数 $f$ 是分段线性和凸的，在两个或多个定义它的线性部分重合并达到最大值的点上存在不可导的尖点（kink）。使用凸优化中的一阶最优性必要条件，确定所有点 $x^{\\star} \\in \\mathbb{R}$，使得 $0 \\in \\partial f(x^{\\star})$，其中 $\\partial f(x^{\\star})$ 表示 $f$ 在 $x^{\\star}$ 处的次微分。通过凸性和次梯度的定义来证明你的答案。如果答案唯一，请将其表示为单个实数；如果不唯一，请将其表示为单个闭式解析表达式。无需四舍五入。", "solution": "问题要求找出所有满足函数 $f(x) = \\max\\left\\{\\,3x - 4,\\,-x + 1,\\,\\frac{1}{2}x\\,\\right\\}$ 一阶最优性必要条件的点 $x^{\\star} \\in \\mathbb{R}$。该条件为 $0 \\in \\partial f(x^{\\star})$，其中 $\\partial f(x^{\\star})$ 是 $f$ 在 $x^{\\star}$ 处的次微分。\n\n设三个线性函数分别为 $f_1(x) = 3x - 4$，$f_2(x) = -x + 1$ 和 $f_3(x) = \\frac{1}{2}x$。函数 $f(x)$ 定义为 $f(x) = \\max\\{f_1(x), f_2(x), f_3(x)\\}$。每个函数 $f_i(x)$ 都是仿射函数，因此是凸函数。一组凸函数的最大值也是凸函数。因此，$f(x)$ 是一个凸函数。\n\n对于一个凸函数 $f$，一个点 $x^{\\star}$ 是全局最小值点当且仅当 $0 \\in \\partial f(x^{\\star})$。\n对于定义为多个可微凸函数最大值的函数 $f(x) = \\max_{i} f_i(x)$，其在点 $x$ 处的次微分由该点“有效”函数的梯度的凸包给出。有效索引集是 $I(x) = \\{i \\mid f_i(x) = f(x)\\}$。那么次微分就是 $\\partial f(x) = \\text{conv}\\{\\nabla f_i(x) \\mid i \\in I(x)\\}$。\n\n在我们的例子中，函数的导数（梯度）是常数：\n$\\nabla f_1(x) = 3$\n$\\nabla f_2(x) = -1$\n$\\nabla f_3(x) = \\frac{1}{2}$\n\n为了确定次微分，我们首先找到函数 $f(x)$ 的“尖点”，即不同线性部分相交并成为最大值的点。\n1.  $f_1(x) = f_2(x) \\implies 3x - 4 = -x + 1 \\implies x = \\frac{5}{4}$。在此点，$f_3(\\frac{5}{4}) = \\frac{5}{8}$，而 $f_1(\\frac{5}{4}) = f_2(\\frac{5}{4}) = -\\frac{1}{4}$。由于 $f_3$ 更大，这一点不是 $f(x)$ 的尖点。\n2.  $f_2(x) = f_3(x) \\implies -x + 1 = \\frac{1}{2}x \\implies x = \\frac{2}{3}$。在此点，$f_2(\\frac{2}{3}) = f_3(\\frac{2}{3}) = \\frac{1}{3}$，而 $f_1(\\frac{2}{3}) = -2$。因此 $x = \\frac{2}{3}$ 是 $f(x)$ 的一个尖点。\n3.  $f_1(x) = f_3(x) \\implies 3x - 4 = \\frac{1}{2}x \\implies x = \\frac{8}{5}$。在此点，$f_1(\\frac{8}{5}) = f_3(\\frac{8}{5}) = \\frac{4}{5}$，而 $f_2(\\frac{8}{5}) = -\\frac{3}{5}$。因此 $x = \\frac{8}{5}$ 是 $f(x)$ 的一个尖点。\n\n现在我们分析由这些尖点定义的区域中的次微分：\n\n- **情况1：$x  \\frac{2}{3}$**\n  在此区域，$f_2(x)$ 是最大值。$I(x) = \\{2\\}$。\n  $\\partial f(x) = \\{\\nabla f_2(x)\\} = \\{-1\\}$。$0 \\notin \\{-1\\}$。\n\n- **情况2：$x = \\frac{2}{3}$**\n  在此尖点，$f_2(x)$ 和 $f_3(x)$ 都是有效的。$I(\\frac{2}{3}) = \\{2, 3\\}$。\n  次微分是梯度的凸包：\n  $\\partial f(\\frac{2}{3}) = \\text{conv}\\{\\nabla f_2(x), \\nabla f_3(x)\\} = \\text{conv}\\{-1, \\frac{1}{2}\\} = [-1, \\frac{1}{2}]$。\n  由于 $0 \\in [-1, \\frac{1}{2}]$，因此 $x^{\\star} = \\frac{2}{3}$ 是一个满足最优性条件的点。\n\n- **情况3：$\\frac{2}{3}  x  \\frac{8}{5}$**\n  在此区域，$f_3(x)$ 是最大值。$I(x) = \\{3\\}$。\n  $\\partial f(x) = \\{\\nabla f_3(x)\\} = \\{\\frac{1}{2}\\}$。$0 \\notin \\{\\frac{1}{2}\\}$。\n\n- **情况4：$x = \\frac{8}{5}$**\n  在此尖点，$f_1(x)$ 和 $f_3(x)$ 是有效的。$I(\\frac{8}{5}) = \\{1, 3\\}$。\n  次微分是梯度的凸包：\n  $\\partial f(\\frac{8}{5}) = \\text{conv}\\{\\nabla f_1(x), \\nabla f_3(x)\\} = \\text{conv}\\{3, \\frac{1}{2}\\} = [\\frac{1}{2}, 3]$。\n  $0 \\notin [\\frac{1}{2}, 3]$。\n\n- **情况5：$x > \\frac{8}{5}$**\n  在此区域，$f_1(x)$ 是最大值。$I(x) = \\{1\\}$。\n  $\\partial f(x) = \\{\\nabla f_1(x)\\} = \\{3\\}$。$0 \\notin \\{3\\}$。\n\n综上所述，一阶最优性必要条件 $0 \\in \\partial f(x^{\\star})$ 仅在单一点 $x^{\\star} = \\frac{2}{3}$ 处成立。由于 $f(x)$ 是凸函数，该点是函数的唯一全局最小值点。", "answer": "$$\n\\boxed{\\frac{2}{3}}\n$$", "id": "3129939"}]}