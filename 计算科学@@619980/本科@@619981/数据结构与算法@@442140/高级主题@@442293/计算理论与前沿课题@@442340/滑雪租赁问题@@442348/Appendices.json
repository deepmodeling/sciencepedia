{"hands_on_practices": [{"introduction": "标准的竞争性分析通常假设我们面对的是一个最坏情况下的、无所不能的“对手”。这个练习引入了一个更贴近现实的“懒惰对手”模型，该对手对未来的预知能力有限。通过这个练习，我们将学习如何量化部分未来信息（即“前瞻能力”）的价值，并理解它如何能提升我们决策策略的性能保证。[@problem_id:3272187]", "problem": "一位在线滑雪者每天早上决定是租用滑雪板还是购买滑雪板。租用成本为每天 $1$，购买成本为一次性费用 $b$，其中 $b \\in \\mathbb{Z}_{\\ge 1}$。滑雪总天数 $n \\in \\mathbb{Z}_{\\ge 1}$ 事先对滑雪者未知，由一个对手选择。考虑以下由整数 $T \\in \\mathbb{Z}_{\\ge 0}$ 参数化的确定性阈值算法族：在前 $T$ 天租用滑雪板；如果雪季持续到第 $T+1$ 天，则在第 $T+1$ 天开始时购买，之后不再产生每日费用。\n\n我们研究一个被称为“懒惰对手”的受约束的自适应输入生成器，它只能预见未来 $L$ 天的情况，其中 $L \\in \\mathbb{Z}_{\\ge 0}$ 是已知的。为了以科学上有意义且可操作的方式对此限制进行建模，我们对对手施加以下约束：一旦算法购买（在第 $T+1$ 天开始时），对手不能在第 $T+L$ 天之前结束雪季；也就是说，如果算法购买，则总雪季长度 $n$ 必须满足 $n \\ge T+L$。如果算法从未购买，对手可以在任何一天结束雪季。\n\n仅使用在线算法和竞争性分析的核心定义，以及在给定 $n$ 时最小化总成本的显而易见的离线最优行为，推导最小可能的最坏情况竞争比（即，算法成本与离线最优成本之比，在所有与懒惰对手约束一致的 $n$ 上取上确界，再在所有 $T$ 的选择上取下确界），并将其表示为关于 $b$ 和 $L$ 的封闭形式表达式。将你的最终答案表示为关于 $b$ 和 $L$ 的单个解析表达式。不需要进行数值近似或四舍五入。", "solution": "我们从在线算法中竞争性分析的基本定义开始。对于一个在线算法 $\\mathcal{A}$ 和一个由总雪季长度 $n \\in \\mathbb{Z}_{\\ge 1}$ 表征的输入，其在 $n$ 上的竞争比（CR）是算法 $\\mathcal{A}$ 的成本与事先知道 $n$ 的最优离线算法的成本之比。算法 $\\mathcal{A}$ 的最坏情况竞争比是该比率在所有允许的 $n$ 上的上确界，而最优（最小）最坏情况竞争比是该上确界在算法所有设计选择上的下确界。\n\n我们将成本形式化。设 $b \\in \\mathbb{Z}_{\\ge 1}$ 为购买成本，$1$ 为每日租用成本，$T \\in \\mathbb{Z}_{\\ge 0}$ 为确定性阈值算法 $\\mathcal{A}_{T}$ 的阈值参数，该算法定义为：在前 $T$ 天租用；如果雪季持续到第 $T+1$ 天，则在第 $T+1$ 天开始时购买。\n\n对于一个已实现的雪季长度 $n \\in \\mathbb{Z}_{\\ge 1}$，离线最优成本（记为 $\\operatorname{OPT}(n)$）是通过在“每天租用”和“一开始就购买”之间选择较便宜的方案来获得的：\n$$\n\\operatorname{OPT}(n) = \\min\\{n,\\, b\\}.\n$$\n\n对于一个已实现的 $n$，算法 $\\mathcal{A}_{T}$ 的成本为\n$$\n\\operatorname{ALG}_{T}(n) = \n\\begin{cases}\nn,   \\text{如果 } n \\le T \\quad (\\text{算法只租用}),\\\\\nT + b,   \\text{如果 } n \\ge T+1 \\quad (\\text{算法租用 } T \\text{ 天后购买}).\n\\end{cases}\n$$\n\n我们现在将懒惰对手的 $L$ 天前瞻约束编码进去。如果 $\\mathcal{A}_{T}$ 从未购买（这恰好在 $n \\le T$ 时发生），那么对手可以选择任何 $n \\in \\{1,2,\\dots,T\\}$。如果 $\\mathcal{A}_{T}$ 在第 $T+1$ 天开始时购买（这恰好在 $n \\ge T+1$ 时发生），则对手被约束为选择 $n \\ge T+L$。因此，对于一个固定的 $T$，允许的 $n$ 为\n$$\nn \\in \\{1,2,\\dots,T\\} \\cup \\{T+L, T+L+1, T+L+2, \\dots\\}.\n$$\n\n对于一个固定的 $T$，最坏情况竞争比是\n$$\nR(T) \\equiv \\sup_{n \\text{ admissible}} \\frac{\\operatorname{ALG}_{T}(n)}{\\operatorname{OPT}(n)} = \\max\\left\\{ \\max_{1 \\le n \\le T} \\frac{\\operatorname{ALG}_{T}(n)}{\\operatorname{OPT}(n)}, \\sup_{n \\ge T+L} \\frac{\\operatorname{ALG}_{T}(n)}{\\operatorname{OPT}(n)} \\right\\}.\n$$\n\n我们的目标是选择一个阈值 $T \\in \\mathbb{Z}_{\\ge 0}$ 来最小化 $R(T)$。最优的策略在于平衡“租得太久”的风险（由第一项代表，即在算法只租用时，对手选择一个较大的 $n$）和“买得太早”的风险（由第二项代表，即算法购买后，对手选择一个尽可能小的 $n$）。\n\n考虑一个关键的阈值选择 $T = b - L$（假设 $0 \\le L \\le b$）。\n1.  **租用情况分析** ($1 \\le n \\le T$): 此时算法成本为 $n$。由于 $T = b - L \\le b$，对于所有 $n \\le T$，我们有 $n  b$。因此，$\\operatorname{OPT}(n) = \\min\\{n, b\\} = n$。该情况下的比率为 $\\frac{n}{n} = 1$。\n2.  **购买情况分析** ($n \\ge T+L$): 算法在第 $T+1$ 天购买，成本为 $T+b = (b-L)+b = 2b-L$。懒惰对手的约束意味着 $n \\ge T+L = (b-L)+L = b$。因此，对于所有允许的 $n$，$\\operatorname{OPT}(n) = \\min\\{n,b\\} = b$。该情况下的比率为 $\\frac{2b-L}{b} = 2 - \\frac{L}{b}$。\n\n综合这两种情况，对于 $T=b-L$，竞争比为 $R(b-L) = \\max\\left\\{1, 2 - \\frac{L}{b}\\right\\}$。\n\n如果 $L > b$，我们可以选择 $T=0$。算法在第一天就购买，成本为 $b$。对手必须选择 $n \\ge L > b$，因此 $\\operatorname{OPT}(n) = b$。竞争比为 $\\frac{b}{b} = 1$。这种情况也符合 $\\max\\left\\{1, 2 - \\frac{L}{b}\\right\\}$ 的表达式，因为当 $L > b$ 时， $2 - L/b  1$。\n\n可以证明 $T=b-L$（或当 $L>b$ 时的 $T=0$）是最优选择，它产生了最小可能的最坏情况竞争比。因此，最优竞争比为关于 $b$ 和 $L$ 的函数：\n$$ \\max\\left\\{1, 2 - \\frac{L}{b}\\right\\} $$", "answer": "$$\\boxed{\\max\\left\\{1,\\ 2 - \\frac{L}{b}\\right\\}}$$", "id": "3272187"}, {"introduction": "在从最坏情况分析转向平均情况优化后，我们来探讨当掌握未来的某些概率信息时如何决策。本问题假设我们知道滑雪季可能持续天数的概率分布。你的任务是运用动态规划这一强大的优化工具，设计一个策略来最小化期望成本，而不是仅仅防范绝对的最坏情况。[@problem_id:3272330]", "problem": "一位滑雪者面临经典的雪具租赁决策：在每一天，她可以租用雪具，也可以直接购买雪具。设 $r  0$ 为每日的租金，设 $b  0$ 为一次性购买成本，该成本涵盖所有剩余天数，无需再支付租金。设随机变量 $K$ 表示雪季的总滑雪天数，其支撑集为 $\\{1, 2, \\dots, N\\}$，且具有已知的概率质量函数 $P(k)$，满足 $\\sum_{k=1}^{N} P(k) = 1$。决策在每一天 $t \\in \\{1, 2, \\dots, N\\}$ 的开始时做出，条件是雪季尚未结束（即，条件为 $K \\ge t$）。目标是最小化预期总成本。\n\n仅使用期望值的基本定义、动态规划（DP）的最优性原理以及关于离散分布条件概率的标准事实，将此决策过程构建为一个有限期界DP模型。在第 $t$ 天开始时，为最小预期剩余成本 $V(t)$ 推导一个带有适当边界条件的递推关系，并推断出最优策略的结构。然后，用 $P(k)$、$r$、$b$ 和 $N$ 将从雪季开始的最小预期总成本表示为单个封闭形式的解析表达式。\n\n你的最终答案必须是这个单一表达式。不需要数值近似。", "solution": "该问题要求使用动态规划来构建和解决随机雪具租赁问题，以找到最小预期总成本。\n\n这个问题是有效的，因为它是一个在优化和概率论中定义明确、自成一体的问题，是在线和随机算法领域的经典问题。所有参数和目标都已明确说明。\n\n设 $t \\in \\{1, 2, \\dots, N\\}$ 为滑雪季的当前天。我们已知雪季尚未结束，即总滑雪天数 $K$ 至少为 $t$（$K \\ge t$）。我们必须决定是为当天租用雪具（成本为 $r$），还是一次性购买（成本为 $b$）。我们假设尚未购买雪具。\n\n设 $V(t)$ 为在第 $t$ 天开始且尚未购买雪具的情况下的最小预期未来成本。这是我们动态规划模型的值函数。状态由天数 $t$ 定义。期界是有限的，止于 $N$。我们使用从第 $N$ 天到第 $1$ 天的后向归纳法来解决这个问题。\n\n在第 $t$ 天开始时，我们有两种行动：\n1.  **购买**：成本为 $b$。此成本立即产生，并且在本雪季剩余时间内不再有其他成本，无论雪季还会持续多少天。总未来成本为 $b$。\n2.  **租赁**：今天的成本是 $r$。雪季可能在今天结束，也可能持续到第 $t+1$ 天。我们需要考虑未来决策的预期成本。如果我们今天租赁，总预期未来成本是今天的租金 $r$ 加上从第 $t+1$ 天开始的预期成本之和，条件是雪季继续。\n\n设 $S(t) = P(K \\ge t) = \\sum_{k=t}^{N} P(k)$ 为生存函数，即雪季持续至少 $t$ 天的概率。注意 $S(1) = \\sum_{k=1}^{N} P(k) = 1$。\n第 $t$ 天的决策是在 $K \\ge t$ 的条件下做出的。在雪季已持续到第 $t$ 天的条件下，雪季继续到第 $t+1$ 天的概率为：\n$$ P(K \\ge t+1 | K \\ge t) = \\frac{P(K \\ge t+1 \\text{ and } K \\ge t)}{P(K \\ge t)} = \\frac{P(K \\ge t+1)}{P(K \\ge t)} = \\frac{S(t+1)}{S(t)} $$\n如果雪季继续到第 $t+1$ 天，我们将再次面临同样的问题，根据最优性原理，我们将以最优方式进行，产生最小预期未来成本 $V(t+1)$。\n\n因此，在第 $t$ 天租赁的预期成本为 $r + V(t+1) \\cdot P(K \\ge t+1 | K \\ge t) = r + V(t+1) \\frac{S(t+1)}{S(t)}$。\n值函数 $V(t)$ 是两种行动成本的最小值：\n$$ V(t) = \\min \\left( b, r + \\frac{S(t+1)}{S(t)} V(t+1) \\right) $$\n这个递推关系对 $t=1, 2, \\dots, N$ 成立。我们需要一个边界条件。我们定义 $V(N+1)=0$，因为没有更多可能的滑雪天，因此未来成本为零。\n对于 $t=N$，给定 $K \\ge N$，我们必有 $K=N$。所以雪季恰好还会持续一天。继续到第 $N+1$ 天的概率是 $P(K \\ge N+1 | K \\ge N) = S(N+1)/S(N) = 0$。\n在 $t=N$ 时的递推关系变为：\n$$ V(N) = \\min \\left( b, r + \\frac{S(N+1)}{S(N)} V(N+1) \\right) = \\min(b, r + 0) = \\min(b, r) $$\n这是合乎逻辑的：在最后一个可能的日子里，人们应该简单地比较单日租金和购买价格。\n\n最优策略的结构可以从这个递推关系中推断出来。最优策略是一个停止规则，它指定何时停止租赁并购买雪具。一旦购买了雪具，过程就终止了。我们假设最优策略具有阈值结构：在第 $t=1, \\dots, \\tau-1$ 天租赁，如果雪季在第 $\\tau$ 天仍在继续，则购买雪具。这里 $\\tau \\in \\{1, 2, \\dots, N+1\\}$ 是购买的阈值日。$\\tau=1$ 表示在第 1 天购买。$\\tau=N+1$ 表示永不购买（总是租赁）。\n\n让我们验证这个结构与 DP 递推关系的一致性。如果策略是在第 $\\tau$ 天购买，那么对于任何 $t \\ge \\tau$，如果我们到达第 $t$ 天，我们就会购买。这意味着对于所有 $t \\ge \\tau$，$V(t) = b$。\n对于 $t  \\tau$，策略是租赁。所以 $V(t) = r + \\frac{S(t+1)}{S(t)}V(t+1)$。\n在第 $\\tau$ 天，决策必须是购买。这意味着：\n$$ b \\le r + \\frac{S(\\tau+1)}{S(\\tau)} V(\\tau+1) $$\n由于 $\\tau+1$ 也在“购买”区域，所以 $V(\\tau+1) = b$。该条件变为：\n$$ b \\le r + \\frac{S(\\tau+1)}{S(\\tau)} b \\implies b \\left(1 - \\frac{S(\\tau+1)}{S(\\tau)}\\right) \\le r \\implies b \\frac{S(\\tau)-S(\\tau+1)}{S(\\tau)} \\le r $$\n由于 $S(\\tau) - S(\\tau+1) = \\sum_{k=\\tau}^N P(k) - \\sum_{k=\\tau+1}^N P(k) = P(\\tau)$，这可以简化为：\n$$ b \\frac{P(\\tau)}{S(\\tau)} \\le r \\quad \\text{或} \\quad b P(\\tau) \\le r S(\\tau) $$\n在第 $\\tau-1$ 天，决策必须是租赁。这意味着：\n$$ b  r + \\frac{S(\\tau)}{S(\\tau-1)} V(\\tau) $$\n由于第 $\\tau$ 天是“购买”日，所以 $V(\\tau) = b$。该条件变为：\n$$ b  r + \\frac{S(\\tau)}{S(\\tau-1)} b \\implies b \\left(1 - \\frac{S(\\tau)}{S(\\tau-1)}\\right)  r \\implies b \\frac{S(\\tau-1)-S(\\tau)}{S(\\tau-1)}  r $$\n这可以简化为：\n$$ b \\frac{P(\\tau-1)}{S(\\tau-1)}  r \\quad \\text{或} \\quad b P(\\tau-1)  r S(\\tau-1) $$\n结合这些结果，最优阈值 $\\tau_{opt}$ 是满足“购买”条件 $b P(t) \\le r S(t)$ 的第一天 $t$。如果对于 $t \\in \\{1, \\dots, N\\}$ 这个条件从未满足，那么我们总是租赁，这对应于 $\\tau_{opt} = N+1$。\n因此，最优购买日是 $\\tau_{opt} = \\min(\\{t \\in \\{1, \\dots, N\\} \\mid b P(t) \\le r S(t)\\} \\cup \\{N+1\\})$。最优策略的结构确实是一个简单的阈值策略。\n\n现在我们可以为最小预期总成本 $V(1)$ 推导一个封闭形式的表达式。\n在具有阈值 $\\tau_{opt}$ 的最优策略下，成本由实际的滑雪天数 $k$ 决定。\n- 如果 $K=k  \\tau_{opt}$：我们租赁 $k$ 天。成本是 $k \\cdot r$。\n- 如果 $K=k \\ge \\tau_{opt}$：我们租赁 $\\tau_{opt}-1$ 天，然后在第 $\\tau_{opt}$ 天购买。成本是 $(\\tau_{opt}-1)r + b$。\n\n预期总成本是这些成本乘以概率 $P(k)$ 的总和：\n$$ V(1) = \\sum_{k=1}^{\\tau_{opt}-1} (k \\cdot r) P(k) + \\sum_{k=\\tau_{opt}}^{N} ((\\tau_{opt}-1)r + b) P(k) $$\n$$ V(1) = r \\sum_{k=1}^{\\tau_{opt}-1} k P(k) + ((\\tau_{opt}-1)r + b) \\sum_{k=\\tau_{opt}}^{N} P(k) $$\n$$ V(1) = r \\sum_{k=1}^{\\tau_{opt}-1} k P(k) + ((\\tau_{opt}-1)r + b) S(\\tau_{opt}) $$\n这个表达式可以简化。让我们使用我们为阈值策略的总成本找到的递推关系。对于 $t  \\tau_{opt}$，我们有 $V(t) = r + \\frac{S(t+1)}{S(t)}V(t+1)$。这可以重写为 $S(t)V(t) = rS(t) + S(t+1)V(t+1)$。\n这给出了一个类似伸缩级数的关系。对于 $t = \\tau_{opt}-1$：\n$S(\\tau_{opt}-1)V(\\tau_{opt}-1) = rS(\\tau_{opt}-1) + S(\\tau_{opt})V(\\tau_{opt}) = rS(\\tau_{opt}-1) + b S(\\tau_{opt})$ 因为 $V(\\tau_{opt})=b$。\n对于 $t = \\tau_{opt}-2$：\n$S(\\tau_{opt}-2)V(\\tau_{opt}-2) = rS(\\tau_{opt}-2) + S(\\tau_{opt}-1)V(\\tau_{opt}-1) = rS(\\tau_{opt}-2) + rS(\\tau_{opt}-1) + bS(\\tau_{opt})$。\n通过归纳，对于任何 $t  \\tau_{opt}$：\n$$ S(t)V(t) = r \\sum_{j=t}^{\\tau_{opt}-1} S(j) + b S(\\tau_{opt}) $$\n从雪季开始的最小总成本是 $V(1)$。由于 $S(1)=1$：\n$$ V(1) = r \\sum_{j=1}^{\\tau_{opt}-1} S(j) + b S(\\tau_{opt}) $$\n虽然这个表达式依赖于 $\\tau_{opt}$，而 $\\tau_{opt}$ 本身必须被计算出来，但表达最小成本的另一种方式是将其表述为所有可能的阈值策略下的最小值。设 $\\tau$ 为一个可能的购买日。预期成本 $C(\\tau)$ 是：\n$$ C(\\tau) = r \\sum_{t=1}^{\\tau-1} S(t) + b S(\\tau) $$\n最小预期成本是这些值在所有可能的阈值 $\\tau \\in \\{1, 2, \\dots, N+1\\}$ 上的最小值。\n如果 $\\tau=1$，则和 $\\sum_{t=1}^{\\tau-1}$ 定义为 $0$。如果 $\\tau=N+1$，则项 $S(\\tau)$ 定义为 $0$。\n代入 $S(t)$ 的定义即可得到最终表达式。\n\n最小预期成本 $= \\min_{\\tau \\in \\{1, 2, \\dots, N+1\\}} C(\\tau) $，其中 $C(\\tau)$ 是在第 $\\tau$ 天购买的预期成本。\n$$ C(\\tau) = r \\sum_{t=1}^{\\tau-1} \\left( \\sum_{k=t}^{N} P(k) \\right) + b \\sum_{k=\\tau}^{N} P(k) $$\n这是用给定参数表示的最小预期总成本的单个封闭形式表达式。\n对于 $\\tau=1$，第一项为 $0$，成本为 $b \\sum_{k=1}^N P(k) = b$。\n对于 $\\tau=N+1$，第二项为 $0$（对空集求和），成本为 $r \\sum_{t=1}^{N} S(t) = r \\sum_{t=1}^N \\sum_{k=t}^N P(k) = r \\sum_{k=1}^N k P(k) = r E[K]$。\n该表达式正确地表示了在第 1 天购买与始终租赁的对比。最优策略的成本是所有可能购买天数中成本的最小值。", "answer": "$$ \\boxed{\\min_{\\tau \\in \\{1, 2, \\dots, N+1\\}} \\left( r \\sum_{t=1}^{\\tau-1} \\sum_{k=t}^{N} P(k) + b \\sum_{k=\\tau}^{N} P(k) \\right)} $$", "id": "3272330"}, {"introduction": "最后，我们来解决一个计算机科学中的常见挑战：如何在有限资源的硬件上实现算法。这个实践练习要求你将“延迟购买”策略应用于一个只能使用定长整型计数器的系统，这会引入缩放、量化误差等概念。它突显了在算法的数学精确性与计算的物理限制之间进行权衡的重要性。[@problem_id:3272293]", "problem": "给定纯数学术语描述的在线滑雪租赁决策问题。每天，租赁成本为正整数 $r$（以任意货币单位计量），购买成本为正整数 $B$（以相同单位计量）。代理人可以先租用若干天，然后购买一次。经典的懒惰购买策略是持续租用，直到累计租金至少等于购买成本时再购买；在精确算术中，这得出购买日为 $d^\\star = \\lceil B / r \\rceil$。然而，假设代理人受限于只能使用 $N$ 位的固定大小无符号计数器来实现此决策。由于可能发生溢出，存储未缩放的 $B$ 或无界的每日累加可能不安全。您必须使用通过2的幂次缩放因子进行的整数除法，来实现一个溢出安全的、缩放的懒惰购买算法，并分析缩放对精度和响应时间的影响。\n\n算法要求：\n- 令 $C_{\\max} = 2^N - 1$ 表示单个 $N$ 位无符号计数器可表示的最大值。\n- 选择一个缩放因子 $s = 2^k$（其中 $k \\ge 0$ 为整数），使得缩放后的阈值 $T = \\left\\lfloor B / s \\right\\rfloor$ 和缩放后的累加器永不超过 $C_{\\max}$，并且该阈值不是退化的。为避免因 $T=0$ 导致的无意义的立即购买，要求 $T \\ge 1$。为平衡精度和溢出安全性，选择 $s$ 以使 $T$ 在可能的情况下位于计数器范围的上半部分：具体来说，尝试确保 $T \\ge \\left\\lceil C_{\\max} / 8 \\right\\rceil$。如果对于给定的 $B$ 和 $N$ 这是不可能的，则选择能产生 $T \\ge 1$ 的最大可能的 $s$（仍为2的幂）。\n- 使用缩放累加法，通过跟踪余数确保在 $d$ 天后累加值精确等于 $\\left\\lfloor d \\cdot r / s \\right\\rfloor$：每天将 $r$ 添加到一个余数寄存器中，并将计数器增加 $\\left\\lfloor \\text{remainder} / s \\right\\rfloor$，然后从余数中减去该商乘以 $s$ 的值。这利用整数算术实现了随时间推移的、精确的定点除以 $s$ 的运算，避免了每日的舍入损失，并通过构造防止了主计数器的溢出。\n- 在缩放累加器 $\\left\\lfloor d \\cdot r / s \\right\\rfloor$ 首次达到或超过阈值 $T = \\left\\lfloor B / s \\right\\rfloor$ 的那一天 $d$ 购买。等效地，通过闭式公式 $d_s = \\left\\lceil T \\cdot s / r \\right\\rceil$ 计算购买日，该公式是满足 $\\left\\lfloor d \\cdot r / s \\right\\rfloor \\ge T$ 的最小 $d$。\n\n您的任务：\n1. 实现上述带有溢出安全缩放和基于余数累加的缩放懒惰购买算法。程序必须为每个测试用例自动选择如上所述的缩放因子 $s$。\n2. 对每个测试用例，计算两个整数：\n   - 缩放购买日 $d_s = \\left\\lceil T \\cdot s / r \\right\\rceil$。\n   - 精确的未缩放购买日 $d^\\star = \\left\\lceil B / r \\right\\rceil$。\n   同时计算非负整数偏差 $\\Delta = d^\\star - d_s$，它衡量了缩放实现相对于精确懒惰策略提前了多少天购买。\n3. 在注释和解决方案中讨论精度和响应时间之间作为缩放因子 $s$ 和计数器位宽 $N$ 的函数的权衡关系，以及为什么所选的缩放能确保计数器溢出安全。\n\n重要约束和科学真实性：\n- 所有量 $N$、$r$ 和 $B$ 均为正整数。\n- 缩放阈值 $T$ 必须满足 $1 \\le T \\le C_{\\max}$。\n- 余数寄存器必须能在相同的 $N$ 位宽内表示，这通过选择 $s \\le C_{\\max}$ 来保证。\n\n测试套件：\n使用以下五个测试用例，涵盖典型行为、边界和边缘条件：\n- 用例 1：$N = 8$，$r = 9$，$B = 200$。\n- 用例 2：$N = 16$，$r = 1$，$B = 50000$。\n- 用例 3：$N = 8$，$r = 200$，$B = 201$。\n- 用例 4：$N = 8$，$r = 9$，$B = 19$。\n- 用例 5：$N = 12$，$r = 300$，$B = 4000$。\n\n要求的最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例贡献一个包含三个整数的子列表，顺序为 $[d_s, d^\\star, \\Delta]$。例如，输出应类似于 $[[d_{s1},d^\\star_1,\\Delta_1],[d_{s2},d^\\star_2,\\Delta_2],\\dots]$，逗号或括号之间不加空格。", "solution": "该问题要求实现和分析滑雪租赁问题中懒惰购买策略的一个缩放的、使用定点算术的版本，该版本针对使用固定大小 N 位无符号计数器的系统进行了优化。\n\n首先，我们形式化无约束的、精确的懒惰购买策略。一个代理人面临每日租金 $r$ 和一次性购买成本 $B$。代理人需要该服务的天数是事先未知的。懒惰购买策略规定，只要累计租金 $d \\cdot r$ 小于购买成本 $B$，代理人就应该每天租用。当此条件首次被违反时，代理人即行购买。因此，购买日（表示为 $d^\\star$）是满足 $d \\cdot r \\ge B$ 的最小正整数 $d$。这可以用上取整函数在数学上表示为：\n$$d^\\star = \\left\\lceil \\frac{B}{r} \\right\\rceil$$\n\n接下来，我们引入 N 位无符号计数器的硬件约束。这样的计数器可以表示从 $0$ 到 $C_{\\max} = 2^N - 1$ 的整数。直接累加成本 $d \\cdot r$ 是不安全的，因为它可能超过 $C_{\\max}$ 并导致溢出，从而引致错误的决策。为缓解此问题，我们采用一种缩放技术。所有货币值都按一个因子 $s$ 进行缩减，该因子被选为2的幂，即 $s = 2^k$（其中 $k \\ge 0$ 为整数），以便使用位移操作而非通用除法来实现高效计算。\n\n缩放后的问题可表述如下：\n- 购买成本 $B$ 被转换为缩放阈值 $T = \\left\\lfloor B / s \\right\\rfloor$。\n- 累计租金 $d \\cdot r$ 被转换为缩放累加器 $A_d = \\left\\lfloor d \\cdot r / s \\right\\rfloor$。\n新的购买条件是，在缩放累加器 $A_d$ 首次达到或超过缩放阈值 $T$ 的那一天 $d$ 进行购买。缩放购买日 $d_s$ 是满足 $A_d \\ge T$ 的最小整数 $d$。\n\n我们可以为 $d_s$ 推导出一个闭式表达式。条件是 $\\lfloor d \\cdot r / s \\rfloor \\ge T$。由于 $T$ 是整数，此不等式等价于 $d \\cdot r / s \\ge T$。对 $d$ 进行移项，我们得到 $d \\ge (T \\cdot s) / r$。由于 $d$ 必须是整数，满足此条件的最小 $d$ 值为：\n$$d_s = \\left\\lceil \\frac{T \\cdot s}{r} \\right\\rceil$$\n\n缩放因子 $s$ 的选择至关重要，必须在两个相互竞争的目标之间取得平衡：精度和溢出安全性。\n- 较小的 $s$（例如 $s=1$）能产生更高的精度，因为有效购买阈值 $\\lfloor B/s \\rfloor \\cdot s$ 更接近真实值 $B$。然而，这会导致一个较大的缩放阈值 $T$，增加了溢出的风险。\n- 较大的 $s$ 通过减小 $T$ 的量级，提供了更大的防溢出安全边际。然而，它通过增加量化误差 $B - (\\lfloor B/s \\rfloor \\cdot s)$ 来降低精度。这可能导致与精确策略的显著偏差。\n\n问题为选择 $s=2^k$ 指定了一个确定性过程：\n1.  缩放阈值 $T$ 必须是非退化的，即 $T \\ge 1$。这意味着 $\\lfloor B / s \\rfloor \\ge 1$，即要求 $s \\le B$。\n2.  缩放阈值 $T$ 和累加器不能溢出 N 位计数器，即 $T \\le C_{\\max}$。\n3.  为保持合理的精度，选择逻辑优先将 $T$ 保持在计数器范围的上半部分。具体而言，我们尝试找到最大的缩放因子 $s=2^k$，使得产生的阈值 $T$ 满足 $T \\ge \\left\\lceil (2^N - 1) / 8 \\right\\rceil$。\n4.  如果无法满足步骤3中的条件（当 $B$ 本身太小时会发生这种情况），我们回退到选择仍能确保非退化阈值（$T \\ge 1$）的最大可能缩放因子 $s=2^k$。这相当于选择小于或等于 $B$ 的最大2的幂。\n\n缩放策略与精确策略之间的偏差为 $\\Delta = d^\\star - d_s$。我们可以证明 $\\Delta \\ge 0$。在缩放版本中，有效购买阈值为 $B_{eff} = \\lfloor B/s \\rfloor \\cdot s$。由于 $\\lfloor B/s \\rfloor \\le B/s$，我们有 $B_{eff} \\le B$。缩放算法基于这个较低或相等的有效阈值触发购买，因此它永远不会比精确算法更晚购买。因此，$d_s \\le d^\\star$，偏差 $\\Delta$ 总是非负的。$\\Delta$ 的大小与量化误差 $B - B_{eff} = B \\pmod s$ 相关。一个较大的 $s$ 可能导致较大的误差，从而可能引起较大的 $\\Delta$ 和一次更早、次优的购买。\n\n缩放累加器 $A_d = \\lfloor d \\cdot r / s \\rfloor$ 的实现可以通过使用余数跟踪方法来完成，而无需浮点运算。一个余数寄存器 `rem` 初始化为 $0$。每天，日租金 $r$ 被加到这个寄存器中。主累加器的增量是新余数与缩放因子的整数商，即 `inc = rem // s`。主累加器增加 `inc`，而余数通过减去已“存入”的部分来更新：`rem = rem - inc * s`。这确保了在 $d$ 天内，添加到累加器的总值恰好是 $\\lfloor d \\cdot r / s \\rfloor$。\n\n为了使这种基于余数的累加在 N 位寄存器内是溢出安全的，中间和 `rem + r` 必须不超过 $C_{\\max}$。由于余数 `rem` 始终保持在 $[0, s-1]$ 范围内，中间和的最大值为 $(s-1) + r$。因此，余数寄存器安全的一个充分条件是 $s + r - 1 \\le C_{\\max}$。问题的给定条件和约束遵守了这一点，确保整个算法是溢出安全的。主累加器也是安全的，因为它只会达到一个接近 $T$ 的值，而 $s$ 的选择逻辑确保了 $T$ 远在计数器的容量范围内。\n\n现在，我们将这个完整的方法论应用于提供的测试用例。对于每个用例 $(N, r, B)$，我们计算 $C_{\\max}$，根据指定的逻辑确定适当的缩放因子 $s$，然后计算缩放购买日 $d_s$、精确购买日 $d^\\star$ 以及产生的偏差 $\\Delta = d^\\star - d_s$。", "answer": "[[23,23,0],[50000,50000,0],[1,2,1],[2,3,1],[14,14,0]]", "id": "3272293"}]}