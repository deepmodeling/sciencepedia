{"hands_on_practices": [{"introduction": "在深入研究SABR模型的全部复杂性之前，通过一个简化情境来检视其行为是很有启发性的。这项练习揭示了像SABR这样的随机波动率模型与更简单的局部波动率模型之间的根本联系，展示了前者在特定条件下如何退化为后者。通过这个思想实验 [@problem_id:2428074]，您将为模型结构建立更深刻的直觉，并理解波动率之波动率参数 $\\nu$ 的关键作用。", "problem": "考虑风险中性测度下零利率的随机Alpha Beta Rho (SABR) 模型。资产价格过程 $S_{t}$ 及其随机波动率因子 $\\alpha_{t}$ 满足以下耦合随机微分方程\n$$\n\\mathrm{d}S_{t} \\;=\\; \\alpha_{t}\\, S_{t}^{\\beta}\\, \\mathrm{d}W^{(1)}_{t}, \n\\qquad \n\\mathrm{d}\\alpha_{t} \\;=\\; \\nu\\, \\alpha_{t}\\, \\mathrm{d}W^{(2)}_{t},\n\\qquad \n\\mathrm{d}\\langle W^{(1)}, W^{(2)} \\rangle_{t} \\;=\\; \\rho\\, \\mathrm{d}t,\n$$\n其中给定常数 $\\alpha_{0} = \\alpha > 0$，$\\beta \\in (0,1]$，$\\rho \\in [-1,1]$，$\\nu \\ge 0$，以及初始价格 $S_{0} > 0$。设 $W^{(1)}$ 和 $W^{(2)}$ 为具有所述瞬时相关性的标准布朗运动。\n\n局部波动率模型是 $S_{t}$ 的一种单因子扩散过程，其形式为\n$$\n\\mathrm{d}S_{t} \\;=\\; \\sigma_{LV}(S_{t}, t)\\, \\mathrm{d}W_{t},\n$$\n其中 $W_{t}$ 是一个标准布朗运动。假设对于每个 $t \\ge 0$，$S_{t}$ 在 SABR 模型下的一维边际分布与在局部波动率模型下的一维边际分布相一致。\n\n考虑 $\\nu = 0$ 的特殊情况，同时保持其他 SABR 参数 $\\alpha$、$\\beta$ 和 $\\rho$ 给定。推导对于所有 $S>0$ 和 $t \\ge 0$ 的等价局部波动率函数 $\\sigma_{LV}(S,t)$ 的显式表达式。请以单个闭式解析表达式的形式给出答案。", "solution": "该问题要求在波动率的波动率参数 $\\nu$ 为零的特殊情况下，推导随机Alpha Beta Rho (SABR) 模型的等价局部波动率函数 $\\sigma_{LV}(S,t)$ 的显式表达式。\n\n资产价格 $S_t$ 及其随机波动率 $\\alpha_t$ 的 SABR 模型由以下随机微分方程组给出：\n$$\n\\mathrm{d}S_{t} = \\alpha_{t} S_{t}^{\\beta} \\mathrm{d}W^{(1)}_{t}\n$$\n$$\n\\mathrm{d}\\alpha_{t} = \\nu \\alpha_{t} \\mathrm{d}W^{(2)}_{t}\n$$\n其中 $W^{(1)}_t$ 和 $W^{(2)}_t$ 是瞬时相关性为 $\\rho$ 的标准布朗运动，使得 $\\mathrm{d}\\langle W^{(1)}, W^{(2)} \\rangle_{t} = \\rho \\mathrm{d}t$。参数包括初始波动率 $\\alpha_0 = \\alpha > 0$，弹性参数 $\\beta \\in (0,1]$，相关系数 $\\rho \\in [-1,1]$，以及波动率的波动率 $\\nu \\ge 0$。初始资产价格为 $S_0 > 0$。我们在零利率的风险中性测度下进行操作，因此资产价格动态中没有漂移项。\n\n局部波动率模型由以下形式的单个随机微分方程定义：\n$$\n\\mathrm{d}S_{t} = \\sigma_{LV}(S_{t}, t) \\mathrm{d}W_{t}\n$$\n对于某个函数 $\\sigma_{LV}(S,t)$ 和一个标准布朗运动 $W_t$。\n\n问题陈述，对于每个时间 $t \\ge 0$，$S_t$ 在SABR模型下的的一维边际概率分布必须与在局部波动率模型下的分布相一致。这种等价性使我们能够确定 $\\sigma_{LV}(S,t)$。一个通常归功于 Gyöngy 引理的一般性结果指出，局部波动率的平方 $\\sigma_{LV}^2(S,t)$ 等于原始过程瞬时方差的条件期望，其条件是过程在时间 $t$ 处于状态 $S$。\n\n对于 SABR 模型，$S_t$ 过程的瞬时方差是 $(\\alpha_t S_t^{\\beta})^2$。应用 Gyöngy 引理，我们得到：\n$$\n\\sigma_{LV}^2(S,t) = E\\left[ (\\alpha_t S_t^{\\beta})^2 \\mid S_t=S \\right]\n$$\n由于在条件中 $S_t$ 的值固定为 $S$，我们可以将涉及 $S_t$ 的项从期望中提出来：\n$$\n\\sigma_{LV}^2(S,t) = S^{2\\beta} E\\left[ \\alpha_t^2 \\mid S_t=S \\right]\n$$\n该表达式对一般的 SABR 模型均有效。\n\n现在，问题要求我们考虑 $\\nu = 0$ 的特殊情况。我们在此条件下分析 $\\alpha_t$ 的随机微分方程：\n$$\n\\mathrm{d}\\alpha_{t} = (0) \\cdot \\alpha_{t} \\mathrm{d}W^{(2)}_{t} = 0\n$$\n一个扩散系数为零的随机微分方程意味着过程 $\\alpha_t$ 的二次变分为零，因此它不随时间变化而保持恒定。对于所有 $t \\ge 0$，它都保持其初始值：\n$$\n\\alpha_t = \\alpha_0 = \\alpha\n$$\n在这个特殊情况下，“随机”波动率因子实际上是一个确定性常数。\n\n我们将这个确定性的 $\\alpha_t$ 值代回局部波动率平方的公式中：\n$$\n\\sigma_{LV}^2(S,t) = S^{2\\beta} E\\left[ \\alpha^2 \\mid S_t=S \\right]\n$$\n由于 $\\alpha$ 是一个常数，其期望就是 $\\alpha^2$，而与任何条件无关。对 $S_t=S$ 的条件限制对一个常数的期望没有影响。\n$$\nE\\left[ \\alpha^2 \\mid S_t=S \\right] = \\alpha^2\n$$\n因此，局部波动率平方的表达式简化为：\n$$\n\\sigma_{LV}^2(S,t) = S^{2\\beta} \\alpha^2 = (\\alpha S^{\\beta})^2\n$$\n为了求得 $\\sigma_{LV}(S,t)$，我们取其正平方根，因为波动率必须是一个非负量：\n$$\n\\sigma_{LV}(S,t) = \\sqrt{(\\alpha S^{\\beta})^2} = |\\alpha S^{\\beta}|\n$$\n鉴于问题的约束条件 $\\alpha > 0$ 且资产价格 $S$ 代表一种金融工具，因此 $S > 0$，乘积 $\\alpha S^{\\beta}$ 总是正的。因此，绝对值是多余的。\n$$\n\\sigma_{LV}(S,t) = \\alpha S^{\\beta}\n$$\n这一结果表明，当 $\\nu=0$ 时，SABR 模型退化为一个时间齐次的局部波动率模型，特别是恒定方差弹性 (CEV) 模型。所得到的局部波动率函数 $\\sigma_{LV}(S,t)$ 与时间 $t$ 和相关参数 $\\rho$ 均无关。参数 $\\rho$ 变得无关紧要，因为波动率过程 $\\alpha_t$ 是恒定的，这意味着布朗运动 $W^{(2)}_t$ 不再影响系统的动态。", "answer": "$$\n\\boxed{\\alpha S^{\\beta}}\n$$", "id": "2428074"}, {"introduction": "SABR模型的一个核心优势在于它能够精确捕捉市场中观察到的“波动率微笑”现象。这项练习 [@problem_id:2428115] 专注于量化波动率微笑最显著的特征——平价（at-the-money）斜率。通过推导和计算平价斜率，您将亲身体验相关性 $\\rho$ 和到期时间 $T$ 等参数如何控制波动率曲面的形态，从而获得对模型行为的实践性理解。", "problem": "给定风险中性测度下的随机Alpha Beta Rho (SABR) 模型，用于描述远期价格过程。对于到期时间 $T > 0$，远期价格过程 $F_t$ 及其波动率过程 $\\alpha_t$ 满足：\n$$\n\\mathrm{d}F_t = \\alpha_t F_t^{\\beta} \\,\\mathrm{d}W_t^{(1)}, \\qquad \\mathrm{d}\\alpha_t = \\nu \\alpha_t \\,\\mathrm{d}W_t^{(2)}, \\qquad \\mathrm{d}\\langle W^{(1)},W^{(2)}\\rangle_t = \\rho\\,\\mathrm{d}t,\n$$\n其中包含常数 $0 \\le \\beta \\le 1$、$\\nu \\ge 0$、相关性 $-1 &lt; \\rho &lt; 1$，以及初始条件 $F_0$ 和 $\\alpha_0 = \\alpha$。考虑 Black 隐含波动率函数 $\\sigma_{\\mathrm{imp}}(K,T)$，根据定义，它与时间 $0$ 的远期价格 $F_0$ 相关联：它是唯一的非负 $\\sigma$，使得使用波动率 $\\sigma$ 和行权价 $K$ 的 Black 公式计算出的价值与 SABR 模型下看涨期权的 $0$ 时刻价值相匹配。在本问题中，您将使用关于到期时间标准的、定义如下的一阶渐近近似来对 $\\sigma_{\\mathrm{imp}}(K,T)$进行建模。对于给定的参数 $(F_0,K,T,\\alpha,\\beta,\\rho,\\nu)$，定义\n$$\nz = \\frac{\\nu}{\\alpha}\\,(F_0 K)^{\\frac{1-\\beta}{2}} \\ln\\!\\left(\\frac{F_0}{K}\\right), \\qquad \n\\chi(z) = \\ln\\!\\left(\\frac{\\sqrt{1 - 2\\rho z + z^2} + z - \\rho}{1 - \\rho}\\right),\n$$\n以及\n$$\n\\sigma_{\\mathrm{imp}}(K,T) = \\frac{\\alpha}{(F_0 K)^{\\frac{1-\\beta}{2}}}\\,\\frac{z}{\\chi(z)}\\left[1 + T\\left(\\frac{(1-\\beta)^2 \\alpha^2}{24\\,(F_0 K)^{1-\\beta}} + \\frac{\\rho\\,\\beta\\,\\nu\\,\\alpha}{4\\,(F_0 K)^{\\frac{1-\\beta}{2}}} + \\frac{(2-3\\rho^2)\\nu^2}{24}\\right)\\right],\n$$\n并约定当 $z = 0$ 时，根据连续性，比率 $z/\\chi(z)$ 取值为 $1$。平价偏斜定义为隐含波动率相对于对数货币性 $k = \\ln(K/F_0)$ 在平价点 $k=0$ 处的导数：\n$$\nS(T;\\rho) = \\left.\\frac{\\partial \\sigma_{\\mathrm{imp}}(K,T)}{\\partial k}\\right|_{k=0}, \\quad \\text{其中 } k=\\ln\\!\\left(\\frac{K}{F_0}\\right).\n$$\n您的任务是使用上述 $\\sigma_{\\mathrm{imp}}(K,T)$ 的定义来计算 $S(T;\\rho)$，并分析其在不同到期情况下对相关性参数 $\\rho$ 的依赖性。\n\n使用以下基本参数值：远期价格 $F_0 = 100$，初始波动率水平 $\\alpha = 0.2$，弹性 $\\beta = 0.5$，波动率的波动率 $\\nu = 0.6$。将波动率及其导数视为无量纲量；所有数值输出必须以小数形式表示（而非百分比）。本问题不涉及角度。到期时间 $T$ 以年为单位。\n\n测试套件：\n- 考虑由 $\\rho \\in \\{-0.9, 0.0, 0.9\\}$ 和 $T \\in \\{0.25, 1.0, 5.0\\}$ 的笛卡尔积形成的九个测试用例，按以下顺序进行评估：\n$$\n(\\rho,T) \\in \\{(-0.9,0.25),\\,(-0.9,1.0),\\,(-0.9,5.0),\\,(0.0,0.25),\\,(0.0,1.0),\\,(0.0,5.0),\\,(0.9,0.25),\\,(0.9,1.0),\\,(0.9,5.0)\\}.\n$$\n\n要求输出：\n- 对于每个测试用例，计算平价偏斜 $S(T;\\rho)$，结果为实数。您的程序应生成单行输出，其中包含九个结果，以逗号分隔并用方括号括起，顺序与上文完全一致。每个数字必须四舍五入到六位小数。例如，输出必须如下所示：\n$$\n[\\text{value}_1,\\text{value}_2,\\ldots,\\text{value}_9],\n$$\n该行中任何位置都不得有空格。\n\n不提供外部输入；所有参数均如上所述。您的实现必须是通用的，并且仅基于此处给出的数学定义和模型近似。测试套件的最终数值答案必须是四舍五入到六位小数的浮点数。", "solution": "问题陈述已经过验证，被认定为有效。这是一个在计算金融学中定义明确的问题，基于成熟的数学模型，并为获得唯一解提供了所有必要信息。我们将继续进行推导和计算。\n\n任务是计算隐含波动率的平价 (ATM) 偏斜，其定义为隐含波动率 $\\sigma_{\\mathrm{imp}}(K,T)$ 相对于对数货币性 $k = \\ln(K/F_0)$ 在 ATM 点 $k=0$ (对应于 $K=F_0$) 处的导数。该隐含波动率由一阶渐近近似给出：\n$$\n\\sigma_{\\mathrm{imp}}(K,T) = \\frac{\\alpha}{(F_0 K)^{\\frac{1-\\beta}{2}}}\\,\\frac{z}{\\chi(z)}\\left[1 + T\\left(\\frac{(1-\\beta)^2 \\alpha^2}{24\\,(F_0 K)^{1-\\beta}} + \\frac{\\rho\\,\\beta\\,\\nu\\,\\alpha}{4\\,(F_0 K)^{\\frac{1-\\beta}{2}}} + \\frac{(2-3\\rho^2)\\nu^2}{24}\\right)\\right]\n$$\n其中 $z = \\frac{\\nu}{\\alpha}(F_0 K)^{\\frac{1-\\beta}{2}} \\ln(F_0/K)$ 且 $\\chi(z) = \\ln\\left(\\frac{\\sqrt{1 - 2\\rho z + z^2} + z - \\rho}{1 - \\rho}\\right)$。\n\n我们必须计算 $S(T;\\rho) = \\left.\\frac{\\partial \\sigma_{\\mathrm{imp}}(K,T)}{\\partial k}\\right|_{k=0}$。首先，我们将所有量表示为对数货币性 $k = \\ln(K/F_0)$ 的函数。这意味着 $K = F_0 e^k$。\n\n变量 $z$ 可以用 $k$ 来表示：\n$$\n\\ln\\left(\\frac{F_0}{K}\\right) = \\ln\\left(\\frac{F_0}{F_0 e^k}\\right) = -k\n$$\n$$\n(F_0 K)^{\\frac{1-\\beta}{2}} = (F_0^2 e^k)^{\\frac{1-\\beta}{2}} = F_0^{1-\\beta} e^{k\\frac{1-\\beta}{2}}\n$$\n因此，\n$$\nz(k) = \\frac{\\nu}{\\alpha} F_0^{1-\\beta} e^{k\\frac{1-\\beta}{2}} (-k) = -k \\frac{\\nu}{\\alpha} F_0^{1-\\beta} e^{k\\frac{1-\\beta}{2}}\n$$\n当 $k \\to 0$ 时，$z \\to 0$。\n\n隐含波动率公式 $\\sigma_{\\mathrm{imp}}$ 可视为三个关于 $k$ 的函数之积：$\\sigma_{\\mathrm{imp}}(k) = A(k)B(k)C(k)$，其中：\n$$\nA(k) = \\frac{\\alpha}{(F_0 K)^{\\frac{1-\\beta}{2}}} = \\frac{\\alpha}{F_0^{1-\\beta} e^{k\\frac{1-\\beta}{2}}} = \\alpha F_0^{-(1-\\beta)} e^{-k\\frac{1-\\beta}{2}}\n$$\n$$\nB(k) = \\frac{z(k)}{\\chi(z(k))}\n$$\n$$\nC(k) = 1 + T\\left(\\frac{(1-\\beta)^2 \\alpha^2}{24\\,(F_0 K)^{1-\\beta}} + \\frac{\\rho\\,\\beta\\,\\nu\\,\\alpha}{4\\,(F_0 K)^{\\frac{1-\\beta}{2}}} + \\frac{(2-3\\rho^2)\\nu^2}{24}\\right)\n$$\n代入 $K = F_0 e^k$：\n$$\nC(k) = 1 + T\\left(\\frac{(1-\\beta)^2 \\alpha^2}{24\\,F_0^{2(1-\\beta)}e^{k(1-\\beta)}} + \\frac{\\rho\\,\\beta\\,\\nu\\,\\alpha}{4\\,F_0^{1-\\beta}e^{k\\frac{1-\\beta}{2}}} + \\frac{(2-3\\rho^2)\\nu^2}{24}\\right)\n$$\nATM 偏斜是该乘积在 $k=0$ 处的导数：\n$$\nS(T;\\rho) = \\left.\\frac{d\\sigma_{\\mathrm{imp}}}{dk}\\right|_{k=0} = A'(0)B(0)C(0) + A(0)B'(0)C(0) + A(0)B(0)C'(0)\n$$\n我们在 $k=0$ 处计算每一项及其导数。\n\n1.  **项 $A(k)$ 及其导数：**\n    $$\n    A(0) = \\alpha F_0^{-(1-\\beta)} = \\frac{\\alpha}{F_0^{1-\\beta}}\n    $$\n    $$\n    A'(k) = \\alpha F_0^{-(1-\\beta)} \\left(-\\frac{1-\\beta}{2}\\right) e^{-k\\frac{1-\\beta}{2}} \\implies A'(0) = -\\frac{\\alpha(1-\\beta)}{2F_0^{1-\\beta}}\n    $$\n\n2.  **项 $B(k)$ 及其导数：**\n    对于极限 $z \\to 0$，我们展开 $\\chi(z)$：\n    $$\n    \\sqrt{1-2\\rho z+z^2} = 1 - \\rho z + \\frac{1-\\rho^2}{2} z^2 + O(z^3)\n    $$\n    $$\n    \\chi(z) = \\ln\\left(\\frac{1 - \\rho z + z - \\rho + O(z^2)}{1-\\rho}\\right) = \\ln\\left(\\frac{(1-\\rho) + (1-\\rho)z + O(z^2)}{1-\\rho}\\right) = \\ln(1 + z + O(z^2))\n    $$\n    使用 $\\ln(1+x)=x - x^2/2 + \\dots$，我们为 $\\chi(z)$ 找到一个更精确的展开式：\n    $$\n    \\chi(z) = z + \\frac{\\rho}{2} z^2 + O(z^3)\n    $$\n    因此，对于 $z \\to 0$：\n    $$\n    \\frac{z}{\\chi(z)} = \\frac{z}{z + \\frac{\\rho}{2} z^2 + O(z^3)} = \\frac{1}{1 + \\frac{\\rho}{2} z + O(z^2)} = 1 - \\frac{\\rho}{2} z + O(z^2)\n    $$\n    由此，我们得出 $B(0) = \\lim_{z\\to 0} \\frac{z}{\\chi(z)} = 1$，这与问题陈述中的约定一致。\n    导数 $B'(0)$ 使用链式法则计算：$B'(k) = \\frac{d B}{dz} \\frac{dz}{dk}$。\n    $$\n    \\left.\\frac{dB}{dz}\\right|_{z=0} = \\left.\\frac{d}{dz}\\left(1 - \\frac{\\rho}{2} z + O(z^2)\\right)\\right|_{z=0} = -\\frac{\\rho}{2}\n    $$\n    $$\n    \\frac{dz}{dk} = -\\frac{\\nu}{\\alpha}F_0^{1-\\beta} \\frac{d}{dk}\\left(k e^{k\\frac{1-\\beta}{2}}\\right) = -\\frac{\\nu}{\\alpha}F_0^{1-\\beta} \\left(e^{k\\frac{1-\\beta}{2}} + k \\frac{1-\\beta}{2} e^{k\\frac{1-\\beta}{2}}\\right)\n    $$\n    $$\n    \\left.\\frac{dz}{dk}\\right|_{k=0} = -\\frac{\\nu}{\\alpha} F_0^{1-\\beta}\n    $$\n    将这些结合起来得到：\n    $$\n    B'(0) = \\left.\\frac{dB}{dz}\\right|_{z=0} \\left.\\frac{dz}{dk}\\right|_{k=0} = \\left(-\\frac{\\rho}{2}\\right) \\left(-\\frac{\\nu}{\\alpha} F_0^{1-\\beta}\\right) = \\frac{\\rho \\nu F_0^{1-\\beta}}{2\\alpha}\n    $$\n\n3.  **项 $C(k)$ 及其导数：**\n    $$\n    C(0) = 1 + T\\left(\\frac{(1-\\beta)^2 \\alpha^2}{24\\,F_0^{2(1-\\beta)}} + \\frac{\\rho\\,\\beta\\,\\nu\\,\\alpha}{4\\,F_0^{1-\\beta}} + \\frac{(2-3\\rho^2)\\nu^2}{24}\\right)\n    $$\n    导数 $C'(k)$ 为：\n    $$\n    C'(k) = T \\left( \\frac{(1-\\beta)^2 \\alpha^2}{24 F_0^{2(1-\\beta)}} (-(1-\\beta))e^{-k(1-\\beta)} + \\frac{\\rho \\beta \\nu \\alpha}{4 F_0^{1-\\beta}} \\left(-\\frac{1-\\beta}{2}\\right)e^{-k\\frac{1-\\beta}{2}} \\right)\n    $$\n    在 $k=0$ 处：\n    $$\n    C'(0) = T \\left( -\\frac{(1-\\beta)^3 \\alpha^2}{24 F_0^{2(1-\\beta)}} - \\frac{\\rho \\beta \\nu \\alpha(1-\\beta)}{8 F_0^{1-\\beta}} \\right)\n    $$\n\n最后，我们组合导数 $S(T;\\rho) = A'(0)B(0)C(0) + A(0)B'(0)C(0) + A(0)B(0)C'(0)$：\n$$\nS(T;\\rho) = [A'(0) + A(0)B'(0)]C(0) + A(0)C'(0)\n$$\n第一项是 ATM 主干偏斜：\n$$\nS_0 = A'(0) + A(0)B'(0) = -\\frac{\\alpha(1-\\beta)}{2F_0^{1-\\beta}} + \\left(\\frac{\\alpha}{F_0^{1-\\beta}}\\right)\\left(\\frac{\\rho \\nu F_0^{1-\\beta}}{2\\alpha}\\right) = -\\frac{\\alpha(1-\\beta)}{2F_0^{1-\\beta}} + \\frac{\\rho \\nu}{2}\n$$\n那么，偏斜的完整表达式是：\n$S(T;\\rho) = S_0 C(0) + A(0) C'(0)$。代入 $S_0, C(0), A(0), C'(0)$ 的表达式：\n$$\nS(T;\\rho) = \\left(-\\frac{\\alpha(1-\\beta)}{2F_0^{1-\\beta}} + \\frac{\\rho \\nu}{2}\\right)\\left[1 + T\\left(\\frac{(1-\\beta)^2 \\alpha^2}{24\\,F_0^{2(1-\\beta)}} + \\frac{\\rho\\,\\beta\\,\\nu\\,\\alpha}{4\\,F_0^{1-\\beta}} + \\frac{(2-3\\rho^2)\\nu^2}{24}\\right)\\right] + \\frac{\\alpha}{F_0^{1-\\beta}} T \\left(-\\frac{(1-\\beta)^3 \\alpha^2}{24 F_0^{2(1-\\beta)}} - \\frac{\\rho \\beta \\nu \\alpha (1-\\beta)}{8 F_0^{1-\\beta}}\\right)\n$$\n这就是 ATM 偏斜的解析公式。我们将实现此公式来计算指定测试套件所需的值。\n基本参数为 $F_0 = 100$, $\\alpha = 0.2$, $\\beta = 0.5$, $\\nu = 0.6$。测试用例是 $\\rho \\in \\{-0.9, 0.0, 0.9\\}$ 和 $T \\in \\{0.25, 1.0, 5.0\\}$ 的笛卡尔积。\n计算过程通过将这些参数直接代入 $S(T;\\rho)$ 的最终公式来进行。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the at-the-money (ATM) skew for the SABR model based on a\n    first-order asymptotic approximation for the implied volatility.\n    \"\"\"\n\n    # Base parameter values\n    F0 = 100.0\n    alpha = 0.2\n    beta = 0.5\n    nu = 0.6\n\n    # Test suite from the problem statement\n    test_cases = [\n        (-0.9, 0.25), (-0.9, 1.0), (-0.9, 5.0),\n        (0.0, 0.25), (0.0, 1.0), (0.0, 5.0),\n        (0.9, 0.25), (0.9, 1.0), (0.9, 5.0)\n    ]\n\n    results = []\n    \n    # Pre-compute constants based on base parameters\n    one_minus_beta = 1.0 - beta\n    F0_pow_1_minus_beta = F0**one_minus_beta\n    F0_pow_2_1_minus_beta = F0**(2.0 * one_minus_beta)\n    \n    # Term A(0) from derivation\n    A_0 = alpha / F0_pow_1_minus_beta\n    \n    for case in test_cases:\n        rho, T = case\n\n        # --- Calculation based on the derived formula for S(T; rho) ---\n        \n        # S_0 = -alpha(1-beta)/(2*F0^(1-beta)) + rho*nu/2\n        # This is the ATM skew of the backbone volatility.\n        S_0 = -alpha * one_minus_beta / (2.0 * F0_pow_1_minus_beta) + rho * nu / 2.0\n\n        # Term C(0) from derivation\n        # C(0) = 1 + T * (term1 + term2 + term3)\n        c0_term1 = (one_minus_beta**2 * alpha**2) / (24.0 * F0_pow_2_1_minus_beta)\n        c0_term2 = (rho * beta * nu * alpha) / (4.0 * F0_pow_1_minus_beta)\n        c0_term3 = (2.0 - 3.0 * rho**2) * nu**2 / 24.0\n        C_0 = 1.0 + T * (c0_term1 + c0_term2 + c0_term3)\n        \n        # Term C'(0) from derivation\n        # C'(0) = T * (term1 + term2)\n        c_prime_0_term1 = -(one_minus_beta**3 * alpha**2) / (24.0 * F0_pow_2_1_minus_beta)\n        c_prime_0_term2 = -(rho * beta * nu * alpha * one_minus_beta) / (8.0 * F0_pow_1_minus_beta)\n        C_prime_0 = T * (c_prime_0_term1 + c_prime_0_term2)\n\n        # Final ATM skew S(T; rho) = S_0 * C(0) + A(0) * C'(0)\n        skew = S_0 * C_0 + A_0 * C_prime_0\n        \n        results.append(skew)\n\n    # Format the output as specified: comma-separated list in brackets,\n    # with each value rounded to six decimal places. No spaces.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2428115"}, {"introduction": "“局部”建模哲学是一种强大而通用的思想，它要求模型与市场数据在某些关键维度上保持一致。这项练习 [@problem_id:2428056] 挑战您将这一思想从单一资产的局部波动率世界扩展到多资产情境。您将设计一个“局部相关性”模型，为理解多种资产之间的动态关系提供一个有原则的框架，这展示了核心金融工程概念的普适性和可扩展性。", "problem": "考虑一个关于资产价格的双资产风险中性模型，其中对于每个资产指数 $i \\in \\{1,2\\}$，其价格过程 $S_i(t)$ 服从\n$$\n\\mathrm{d}S_i(t) = r \\, S_i(t) \\, \\mathrm{d}t + \\sigma_i\\!\\left(S_i(t),t\\right) \\, S_i(t) \\, \\mathrm{d}W_i(t),\n$$\n瞬时相关性为\n$$\n\\mathrm{d}W_1(t)\\,\\mathrm{d}W_2(t) = \\rho\\!\\left(S_1(t),S_2(t),t\\right)\\,\\mathrm{d}t.\n$$\n定义一篮子过程 $I(t) = w_1 S_1(t) + w_2 S_2(t)$，其中权重 $w_1$ 和 $w_2$ 为严格为正且满足 $w_1 + w_2 = 1$。假设该篮子存在一个由局部波动率 $\\sigma_I\\!\\left(I(t),t\\right)$ 所刻画的瞬时局部方差，其形式如下\n$$\n\\mathbb{V}\\mathrm{ar}\\!\\left[\\mathrm{d}I(t)\\right] = \\sigma_I\\!\\left(I(t),t\\right)^2 \\, I(t)^2 \\, \\mathrm{d}t.\n$$\n“局部相关性”模型通过将 $\\rho\\!\\left(S_1,S_2,t\\right)$ 定义为区间 $[-1,1]$ 内的唯一数值来构建，该数值使瞬时篮子方差与各成分资产的瞬时方差保持一致，即\n$$\n\\sigma_I(I,t)^2 \\, I^2 = \\left(w_1 S_1 \\sigma_1(S_1,t)\\right)^2 + \\left(w_2 S_2 \\sigma_2(S_2,t)\\right)^2 + 2 \\, \\rho(S_1,S_2,t) \\, \\left(w_1 S_1 \\sigma_1(S_1,t)\\right)\\left(w_2 S_2 \\sigma_2(S_2,t)\\right).\n$$\n如果由此方程蕴含的 $\\rho(S_1,S_2,t)$ 值落在区间 $[-1,1]$ 之外，则将其定义为最近的边界点，即如果小于-1，则投影至-1；如果大于1，则投影至1。此定义的内在逻辑与局部波动率模型确保瞬时方差和所观测到的欧式期权价格保持一致的方法相类似，并且旨在用于诸如随机Alpha, Beta, Rho (SABR)和局部波动率等模型的情境中。\n\n任务：编写一个完整的程序，根据上述模型定义，为以下每一个测试参数集计算在给定状态 $(S_1,S_2)$ 和时间 $t$ 下对应的局部相关性值 $\\rho$。所有输入均为严格为正的实数，且不涉及角度。最终结果必须四舍五入到恰好六位小数。\n\n测试套件（每个元组为 $(S_1,S_2,w_1,w_2,\\sigma_1,\\sigma_2,\\sigma_I)$）：\n1. $(6.0,\\,8.0,\\,0.5,\\,0.5,\\,1.0,\\,1.0,\\,0.8571428571428571)$\n2. $(6.0,\\,8.0,\\,0.5,\\,0.5,\\,1.0,\\,1.0,\\,1.0)$\n3. $(6.0,\\,8.0,\\,0.5,\\,0.5,\\,1.0,\\,1.0,\\,0.14285714285714285)$\n4. $(6.0,\\,8.0,\\,0.5,\\,0.5,\\,1.0,\\,1.0,\\,0.13)$\n5. $(6.0,\\,8.0,\\,0.5,\\,0.5,\\,1.0,\\,1.0,\\,1.05)$\n\n你的程序应生成单行输出，其中包含一个以逗号分隔的列表，用方括号括起，结果顺序与测试套件相同。每个条目都必须是四舍五入到六位小数的浮点数。例如，一个包含三个结果的输出应形如 $[0.123456,0.000000,-1.000000]$。", "solution": "该模型规定，篮子 $I(t) = w_1 S_1(t) + w_2 S_2(t)$ 的瞬时方差必须与各成分资产的瞬时方差及其瞬时相关性的组合相匹配。从风险中性测度下的定义出发，该篮子的伊东（Itô）微分为\n$$\n\\mathrm{d}I(t) = w_1 \\, \\mathrm{d}S_1(t) + w_2 \\, \\mathrm{d}S_2(t).\n$$\n$\\mathrm{d}I(t)$ 的瞬时方差可根据伊东（Itô）过程方差的双线性以及给定的瞬时相关性得到：\n$$\n\\mathbb{V}\\mathrm{ar}\\!\\left[\\mathrm{d}I(t)\\right]\n= \\left(w_1 S_1 \\sigma_1\\right)^2 \\mathrm{d}t + \\left(w_2 S_2 \\sigma_2\\right)^2 \\mathrm{d}t + 2 \\rho \\left(w_1 S_1 \\sigma_1\\right)\\left(w_2 S_2 \\sigma_2\\right) \\mathrm{d}t,\n$$\n为简洁起见，此处 $S_i = S_i(t)$，$\\sigma_i = \\sigma_i(S_i(t),t)$，且 $\\rho = \\rho(S_1(t),S_2(t),t)$。篮子的局部波动率 $\\sigma_I(I(t),t)$ 定义为\n$$\n\\mathbb{V}\\mathrm{ar}\\!\\left[\\mathrm{d}I(t)\\right] = \\sigma_I(I(t),t)^2 \\, I(t)^2 \\, \\mathrm{d}t.\n$$\n令这两个表达式相等，并求解局部相关性 $\\rho$，可得\n$$\n\\rho = \\frac{\\sigma_I(I,t)^2 \\, I^2 \\;-\\; \\left(w_1 S_1 \\sigma_1\\right)^2 \\;-\\; \\left(w_2 S_2 \\sigma_2\\right)^2}{2 \\left(w_1 S_1 \\sigma_1\\right)\\left(w_2 S_2 \\sigma_2\\right)}.\n$$\n因为二维空间中一个有效的协方差矩阵要求相关性必须位于 $[-1,1]$ 内，该模型规定要投影到此区间上：\n$$\n\\rho_{\\text{local}} = \\min\\!\\left\\{1,\\max\\!\\left\\{-1,\\rho\\right\\}\\right\\}.\n$$\n对每个测试用例，计算 $I = w_1 S_1 + w_2 S_2$，$A = w_1 S_1 \\sigma_1$，$B = w_2 S_2 \\sigma_2$，然后\n$$\n\\rho = \\frac{\\sigma_I^2 I^2 - A^2 - B^2}{2AB}, \\quad \\rho_{\\text{local}} = \\min\\{1,\\max\\{-1,\\rho\\}\\}.\n$$\n将 $\\rho_{\\text{local}}$ 四舍五入至六位小数。\n\n评估所提供的测试套件：\n\n五个案例中的共同量：$S_1 = 6.0$，$S_2 = 8.0$，$w_1 = 0.5$，$w_2 = 0.5$，$\\sigma_1 = 1.0$，$\\sigma_2 = 1.0$。因此 $I = w_1 S_1 + w_2 S_2 = 0.5 \\cdot 6.0 + 0.5 \\cdot 8.0 = 7.0$，并且 $A = w_1 S_1 \\sigma_1 = 3.0$，$B = w_2 S_2 \\sigma_2 = 4.0$。所以 $A^2 + B^2 = 9.0 + 16.0 = 25.0$，$2AB = 24.0$。\n\n1. 当 $\\sigma_I = 0.8571428571428571$ 时，我们有 $\\sigma_I^2 I^2 = \\left(0.8571428571428571\\right)^2 \\cdot 49 \\approx 36.0$。那么\n$$\n\\rho = \\frac{36.0 - 25.0}{24.0} = \\frac{11.0}{24.0} \\approx 0.458333\\ldots,\n$$\n结果已在 $[-1,1]$ 区间内，因此四舍五入到六位小数后 $\\rho_{\\text{local}} \\approx 0.458333$。\n\n2. 当 $\\sigma_I = 1.0$ 时，我们有 $\\sigma_I^2 I^2 = 1.0 \\cdot 49 = 49.0$。那么\n$$\n\\rho = \\frac{49.0 - 25.0}{24.0} = 1.0,\n$$\n因此 $\\rho_{\\text{local}} = 1.000000$。\n\n3. 当 $\\sigma_I = 0.14285714285714285$ 时，我们有 $\\sigma_I^2 I^2 = \\left(0.14285714285714285\\right)^2 \\cdot 49 \\approx 1.0$。那么\n$$\n\\rho = \\frac{1.0 - 25.0}{24.0} = -1.0,\n$$\n因此 $\\rho_{\\text{local}} = -1.000000$。\n\n4. 当 $\\sigma_I = 0.13$ 时，我们有 $\\sigma_I^2 I^2 = 0.0169 \\cdot 49 = 0.8281$。那么\n$$\n\\rho = \\frac{0.8281 - 25.0}{24.0} \\approx -1.0071625,\n$$\n因此投影后得到 $\\rho_{\\text{local}} = -1.000000$。\n\n5. 当 $\\sigma_I = 1.05$ 时，我们有 $\\sigma_I^2 I^2 = 1.1025 \\cdot 49 = 54.0225$。那么\n$$\n\\rho = \\frac{54.0225 - 25.0}{24.0} \\approx 1.209270833\\ldots,\n$$\n因此投影后得到 $\\rho_{\\text{local}} = 1.000000$。\n\n因此，将每个结果四舍五入到六位小数后，按顺序输出为 $[0.458333, 1.000000, -1.000000, -1.000000, 1.000000]$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef local_correlation(S1, S2, w1, w2, sigma1, sigma2, sigmaI):\n    # Compute basket level and constituent scaled vols\n    I = w1 * S1 + w2 * S2\n    A = w1 * S1 * sigma1\n    B = w2 * S2 * sigma2\n    # Compute raw implied correlation from the variance identity\n    numerator = (sigmaI ** 2) * (I ** 2) - (A ** 2) - (B ** 2)\n    denominator = 2.0 * A * B\n    rho_raw = numerator / denominator\n    # Project to [-1, 1]\n    rho_local = max(-1.0, min(1.0, rho_raw))\n    return rho_local\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple: (S1, S2, w1, w2, sigma1, sigma2, sigmaI)\n    test_cases = [\n        (6.0, 8.0, 0.5, 0.5, 1.0, 1.0, 0.8571428571428571),\n        (6.0, 8.0, 0.5, 0.5, 1.0, 1.0, 1.0),\n        (6.0, 8.0, 0.5, 0.5, 1.0, 1.0, 0.14285714285714285),\n        (6.0, 8.0, 0.5, 0.5, 1.0, 1.0, 0.13),\n        (6.0, 8.0, 0.5, 0.5, 1.0, 1.0, 1.05),\n    ]\n\n    results = []\n    for case in test_cases:\n        S1, S2, w1, w2, sigma1, sigma2, sigmaI = case\n        rho = local_correlation(S1, S2, w1, w2, sigma1, sigma2, sigmaI)\n        results.append(rho)\n\n    # Final print statement in the exact required format with six decimals.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "2428056"}]}