{"hands_on_practices": [{"introduction": "信任区域方法基于一个简单而强大的原理：在一个局部的“信任区域”内，用一个更简单的模型来近似一个复杂的问题。第一个练习将这个核心概念在一维场景中生动地展现出来。你将通过直接比较二次模型的无约束最小点和信任区域边界，来决定最优步长，从而清晰地理解信任区域约束如何决定步长的选择过程 [@problem_id:2224504]。", "problem": "在无约束优化的背景下，信任区域方法在当前点附近使用一个更简单的模型函数 $m(p)$ 来迭代地近似一个复杂函数。然后，通过求解信任区域子问题来确定下一步的步长 $p$，该子问题涉及在一个半径为 $\\Delta > 0$ 的“信任区域”内最小化此模型，在该区域内，模型被认为是原函数的一个可靠近似。该子问题形式化地表述为：\n$$\n\\min_{p} m(p) \\quad \\text{subject to} \\quad \\|p\\| \\le \\Delta\n$$\n考虑一个一维优化场景，其中步长为 $p \\in \\mathbb{R}$ 的模型函数是一个由下式给出的二次函数：\n$$\nm(p) = g p + \\frac{1}{2} H p^2 + c\n$$\n其中梯度项 $g = 2$，海森项 $H = 6$，以及一个任意常数 $c$。步长受信赖域半径 $\\Delta = 0.1$ 的约束。\n\n确定能求解此一维信任区域子问题的最优步长 $p$。请以精确小数形式提供您的答案。", "solution": "我们必须在信任区域约束 $|p| \\le \\Delta$ 下最小化二次模型 $m(p) = g p + \\frac{1}{2} H p^{2} + c$，其中给定值为 $g=2$，$H=6$ 和 $\\Delta=0.1$。常数 $c$ 不影响最小化子，可以被忽略。\n\n首先，我们考虑模型的无约束最小点。通过令导数等于零来找到它：\n$$\n\\frac{dm}{dp} = g + H p = 0 \\implies p_{u} = -\\frac{g}{H} = -\\frac{2}{6} = -\\frac{1}{3}\n$$\n接下来，我们检查这个无约束解 $p_u$ 是否在信任区域内：\n$$\n|p_u| = \\left|-\\frac{1}{3}\\right| \\approx 0.333\n$$\n由于 $|p_u| > \\Delta = 0.1$，无约束解位于信任区域之外。这意味着约束是有效的，最优解将位于信任区域的边界上，即 $|p| = \\Delta$。\n\n由于我们的模型是凸的（因为 $H=6>0$），从原点到无约束最小点 $p_u$ 的方向就是下降最快的方向。因此，最优步长 $p^\\star$ 将是在信任区域边界上，与 $p_u$ 方向相同的点。由于 $p_u$ 是负的，我们选择负边界点：\n$$\np^{\\star} = -\\Delta = -0.1\n$$\n我们也可以通过检查 KKT 条件来验证这一点。对于 $p = -0.1$，平稳性条件 $g + (H+2\\lambda)p=0$ 变为 $2 + (6+2\\lambda)(-0.1) = 0$，解得 $2\\lambda = \\frac{2}{0.1} - 6 = 14$，所以 $\\lambda = 7$。由于 $\\lambda \\ge 0$，KKT 条件得到满足。\n\n因此，最优信任区域步长为：\n$$\np^{\\star} = -0.1.\n$$", "answer": "$$\\boxed{-0.1}$$", "id": "2224504"}, {"introduction": "虽然信任区域子问题的原理很清晰，但在多维空间中精确求解可能计算成本高昂。“狗腿法”（Dogleg Method）提供了一种优雅而高效的近似策略，它构建了一条连接谨慎的柯西点（最速下降方向）和理想化的牛顿步之间的路径。本练习要求你将狗腿法应用于一个经典的双资产投资组合优化问题，让你亲身体验这一流行算法如何在解空间中进行导航 [@problem_id:2444773]。", "problem": "考虑一个在计算金融中使用的双资产均值-方差目标函数。设权重 $w \\in \\mathbb{R}^{2}$ 的无约束目标函数为\n$$\nf(w) = \\frac{\\gamma}{2}\\, w^{\\top} \\Sigma \\, w - \\mu^{\\top} w,\n$$\n其中，风险规避参数 $\\gamma = 2$，预期超额收益 $\\mu = \\begin{pmatrix}0.5 \\\\ 0.2\\end{pmatrix}$，以及一个对称正定矩阵\n$$\n\\Sigma = \\begin{pmatrix} 2  1 \\\\[4pt] 1  3 \\end{pmatrix}.\n$$\n在当前迭代点 $w^{0} = \\begin{pmatrix}0 \\\\ 0\\end{pmatrix}$，考虑二阶模型\n$$\nm(s) = f(w^{0}) + \\nabla f(w^{0})^{\\top} s + \\frac{1}{2}\\, s^{\\top} \\nabla^{2} f(w^{0}) \\, s,\n$$\n以及一个半径为 $\\Delta = 0.11$ 的欧几里得信任区域 $\\{\\, s \\in \\mathbb{R}^{2} : \\|s\\|_{2} \\le \\Delta \\,\\}$。使用应用于 $m(s)$ 的狗腿信任区域策略，确定唯一的标量 $\\tau \\in [0,1]$，使得当 Cauchy 点严格位于信任区域内部且完整 Newton 步严格位于其外部时，狗腿步恰好位于信任区域边界上。\n\n将 $\\tau$ 的最终值以四位有效数字的十进制数形式给出。", "solution": "狗腿法构造了一条路径来近似二次模型 $m(s)$ 的最小化子。这需要目标函数 $f(w)$ 在当前迭代点 $w^0$ 的梯度和 Hessian 矩阵。\n\n目标函数为 $f(w) = \\frac{\\gamma}{2} w^{\\top} \\Sigma w - \\mu^{\\top} w$。其梯度为 $\\nabla f(w) = \\gamma \\Sigma w - \\mu$，Hessian 矩阵为 $\\nabla^2 f(w) = \\gamma \\Sigma$。\n\n在迭代点 $w^0 = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$，模型梯度 $g$ 和 Hessian 矩阵 $B$ 分别为：\n$$\ng = \\nabla f(w^0) = -\\mu = \\begin{pmatrix} -0.5 \\\\ -0.2 \\end{pmatrix}\n$$\n$$\nB = \\nabla^2 f(w^0) = \\gamma \\Sigma = 2 \\begin{pmatrix} 2  1 \\\\ 1  3 \\end{pmatrix} = \\begin{pmatrix} 4  2 \\\\ 2  6 \\end{pmatrix}\n$$\n由于 $f(w^0) = 0$，二次模型为 $m(s) = g^{\\top}s + \\frac{1}{2}s^{\\top}B s$。\n\n狗腿路径由 Cauchy 点 $s_C$ 和 Newton 步 $s_N$ 构造。\n\n首先，计算无约束 Cauchy 步 $s_{UC}$，它在最速下降方向 $-g$ 上最小化 $m(s)$：\n$$\ns_{UC} = -\\alpha g, \\quad \\text{其中} \\quad \\alpha = \\frac{g^{\\top}g}{g^{\\top}Bg}\n$$\n我们计算：\n$g^{\\top}g = (-0.5)^2 + (-0.2)^2 = 0.29$\n$g^{\\top}Bg = \\begin{pmatrix} -0.5  -0.2 \\end{pmatrix} \\begin{pmatrix} 4  2 \\\\ 2  6 \\end{pmatrix} \\begin{pmatrix} -0.5 \\\\ -0.2 \\end{pmatrix} = 1.64$\n所以，$\\alpha = \\frac{0.29}{1.64} = \\frac{29}{164}$。无约束 Cauchy 步为 $s_{UC} = \\frac{29}{164} \\begin{pmatrix} 0.5 \\\\ 0.2 \\end{pmatrix}$。\n其范数 $\\|s_{UC}\\|_2 = \\alpha \\|g\\|_2 = \\frac{29}{164} \\sqrt{0.29} \\approx 0.095226$。由于 $\\|s_{UC}\\|_2  \\Delta = 0.11$，Cauchy 点严格位于信任区域内部，因此 $s_C = s_{UC}$。\n\n接下来，计算 Newton 步 $s_N = -B^{-1}g$：\n$$\nB^{-1} = \\frac{1}{20} \\begin{pmatrix} 6  -2 \\\\ -2  4 \\end{pmatrix} \\implies s_N = -\\frac{1}{20} \\begin{pmatrix} 6  -2 \\\\ -2  4 \\end{pmatrix} \\begin{pmatrix} -0.5 \\\\ -0.2 \\end{pmatrix} = \\begin{pmatrix} 0.13 \\\\ -0.01 \\end{pmatrix}\n$$\n其范数 $\\|s_N\\|_2 = \\sqrt{0.13^2 + (-0.01)^2} = \\sqrt{0.017} \\approx 0.13038$。由于 $\\|s_N\\|_2 > \\Delta = 0.11$，Newton 步严格位于信任区域外部。\n\n根据条件，狗腿步 $s_D$ 位于连接 $s_C$ 和 $s_N$ 的线段上，并满足 $\\|s_D\\|_2 = \\Delta$。此线段上的点可参数化为 $s(\\tau) = s_C + \\tau(s_N - s_C)$，其中 $\\tau \\in [0,1]$。我们需要求解方程 $\\|s_C + \\tau(s_N - s_C)\\|_2^2 = \\Delta^2$，这是一个关于 $\\tau$ 的二次方程：\n$$\n\\|s_N - s_C\\|_2^2 \\tau^2 + 2 s_C^{\\top}(s_N - s_C) \\tau + (\\|s_C\\|_2^2 - \\Delta^2) = 0\n$$\n计算各项系数：\n$\\|s_C\\|_2^2 = \\alpha^2 (g^{\\top}g) = (\\frac{29}{164})^2 (0.29) \\approx 0.0090679655$\n$s_C^{\\top}s_N = \\left(\\frac{29}{164}(-g)\\right)^{\\top}s_N = -\\frac{29}{164} g^{\\top}s_N = -\\frac{29}{164} \\begin{pmatrix} -0.5  -0.2 \\end{pmatrix} \\begin{pmatrix} 0.13 \\\\ -0.01 \\end{pmatrix} = -\\frac{29}{164}(-0.063) = \\frac{1.827}{164} \\approx 0.0111402439$\n$\\|s_N\\|_2^2 = 0.017$\n$\\Delta^2 = 0.11^2 = 0.0121$\n\n二次方程 $a\\tau^2+b\\tau+c=0$ 的系数为：\n$a = \\|s_N - s_C\\|_2^2 = \\|s_N\\|_2^2 - 2 s_C^{\\top}s_N + \\|s_C\\|_2^2 \\approx 0.017 - 2(0.0111402439) + 0.0090679655 \\approx 0.0037874777$\n$b = 2 s_C^{\\top}(s_N - s_C) = 2(s_C^{\\top}s_N - \\|s_C\\|_2^2) \\approx 2(0.0111402439 - 0.0090679655) \\approx 0.0041445568$\n$c = \\|s_C\\|_2^2 - \\Delta^2 \\approx 0.0090679655 - 0.0121 = -0.0030320345$\n\n使用二次公式 $\\tau = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 求解。由于要求 $\\tau \\in [0,1]$，我们取正根：\n$b^2 - 4ac \\approx (0.0041445568)^2 - 4(0.0037874777)(-0.0030320345) \\approx 6.311455 \\times 10^{-5}$\n$$\n\\tau = \\frac{-0.0041445568 + \\sqrt{6.311455 \\times 10^{-5}}}{2(0.0037874777)} \\approx \\frac{-0.0041445568 + 0.007944467}{0.0075749554} \\approx 0.501641\n$$\n四舍五入到四位有效数字，得到 $\\tau \\approx 0.5016$。", "answer": "$$\n\\boxed{0.5016}\n$$", "id": "2444773"}, {"introduction": "信任区域方法相较于许多其他优化技术的一个关键优势在于其在非凸问题上的稳健表现。本练习将展示其“超能力”之一：逃离鞍点。通过分析一个梯度为零但模型呈现负曲率的场景，你将看到该方法如何智能地利用曲率信息找到通往更优解的路径，而简单的梯度方法在这种情况下会停滞不前 [@problem_id:2444737]。", "problem": "考虑双变量二次目标函数的无约束最小化问题，\n$$f(x) = -x_{1}^{2} + x_{2}^{2}, \\quad x = \\begin{pmatrix} x_{1} \\\\ x_{2} \\end{pmatrix} \\in \\mathbb{R}^{2}.$$\n在当前迭代点\n$$x_{k} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix},$$\n一个使用欧几里得范数和信任区域半径 $\\Delta  0$ 的信任区域方法构造了二次模型\n$$m_{k}(s) = f(x_{k}) + \\nabla f(x_{k})^{\\top} s + \\tfrac{1}{2}\\, s^{\\top} \\nabla^{2} f(x_{k})\\, s,$$\n并通过求解下式来计算精确的信任区域步长\n$$\\min_{s \\in \\mathbb{R}^{2}} \\; m_{k}(s) \\quad \\text{subject to} \\quad \\|s\\|_{2} \\le \\Delta.$$\n在所有全局最小化子中，约定所选步长的第一个分量为非负。\n\n请确定精确的信任区域步长 $s_{k}$，将其表示为 $\\Delta$ 的函数。请以一个 $1 \\times 2$ 行向量的形式给出您的答案。无需进行数值舍入。", "solution": "我们从二次目标函数的梯度和海森矩阵的定义开始。目标函数为\n$$f(x) = -x_{1}^{2} + x_{2}^{2},$$\n因此，对于任意 $x \\in \\mathbb{R}^{2}$，其梯度和海森矩阵为\n$$\\nabla f(x) = \\begin{pmatrix} -2 x_{1} \\\\ 2 x_{2} \\end{pmatrix}, \\qquad \\nabla^{2} f(x) = \\begin{pmatrix} -2  0 \\\\ 0  2 \\end{pmatrix}.$$\n在信任区域中心 $x_{k} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$ 处，梯度为\n$$\\nabla f(x_{k}) = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}.$$\n因此，在 $x_{k}$ 处的二次模型为\n$$m_{k}(s) = f(x_{k}) + \\nabla f(x_{k})^{\\top} s + \\tfrac{1}{2}\\, s^{\\top} \\nabla^{2} f(x_{k})\\, s = f(0) + \\tfrac{1}{2}\\, s^{\\top} H s,$$\n其中我们记 $H \\coloneqq \\nabla^{2} f(x_{k}) = \\begin{pmatrix} -2  0 \\\\ 0  2 \\end{pmatrix}$。常数项 $f(0)$ 与 $m_{k}$ 的最小化子无关，因此信任区域子问题简化为\n$$\\min_{\\|s\\|_{2} \\le \\Delta} \\; \\tfrac{1}{2}\\, s^{\\top} H s.$$\n该问题等价于在信任区域内最小化 $m_k(s) = -s_1^2 + s_2^2$。为了最小化该函数，我们应最大化 $s_1^2$ 并最小化 $s_2^2$。在约束 $\\|s\\|_2^2 = s_1^2 + s_2^2 \\le \\Delta^2$ 下，这意味着我们应选择 $s_2=0$，并将所有“预算”用于 $s_1$，即 $s_1^2 = \\Delta^2$。因此，解为 $s_1 = \\pm\\Delta$ 且 $s_2=0$。\n\n我们也可以通过分析 $H$ 的特征结构来得出结论。$H$ 的特征对为：\n$$(\\lambda_{1}, v_{1}) = (-2, \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}), \\qquad (\\lambda_{2}, v_{2}) = (2, \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}).$$\n为了最小化瑞利商 $s^{\\top} H s$，我们应该将步长 $s$ 与对应最小特征值 $\\lambda_{\\min}=-2$ 的特征向量 $v_1$ 对齐。由于目标函数值会随着步长在负曲率方向上远离原点而减小，解必须位于信任区域的边界上。\n因此，最优步长为 $s_k = \\pm \\Delta v_1 = \\pm \\Delta \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$。\n根据 $s_k$ 第一个分量为非负的选择约定，我们选择正号。因此，精确的信任区域步长为\n$$s_{k} = \\Delta \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}.$$\n该步长与模型的负曲率方向一致，这展示了信任区域方法如何沿着负曲率方向逃离鞍点。\n\n表示为 $1 \\times 2$ 行向量，该步长为\n$$\\begin{pmatrix} \\Delta  0 \\end{pmatrix}.$$", "answer": "$$\\boxed{\\begin{pmatrix}\\Delta  0\\end{pmatrix}}$$", "id": "2444737"}]}