{"hands_on_practices": [{"introduction": "吉布斯抽样的基石是从全条件分布中抽取样本的能力。在我们运行采样器之前，我们必须首先从联合概率密度函数中推导出这些分布。这个练习 [@problem_id:1920315] 为这关键的第一步提供了基础性实践，展示了如何通过代数变换（特别是“配方法”）分离出相关项，并识别出最终条件分布的形式。", "problem": "在一个统计模型中，已知两个连续随机变量 $X$ 和 $Y$ 的联合概率密度函数 (PDF) 与一个关于 $x$ 和 $y$ 的函数成正比。该联合概率密度函数 $f_{X,Y}(x,y)$ 对所有实数 $x$ 和 $y$ 都有定义，由以下关系式给出：\n$$\nf_{X,Y}(x,y) \\propto \\exp(-(x^2 - 2xy + 4y^2))\n$$\n从此类联合分布中生成样本的一个常用方法是Gibbs抽样，该方法需要从全条件分布中进行抽样。你的任务是确定在随机变量 $Y$ 取特定值 $y$ 的条件下，随机变量 $X$ 的全条件分布。\n\n以下哪项正确描述了在给定 $Y=y$ 的条件下 $X$ 的分布？\n\nA. 均值为 $y$、方差为 $1/2$ 的正态分布。\n\nB. 均值为 $y$、方差为 $1$ 的正态分布。\n\nC. 均值为 $2y$、方差为 $1/4$ 的正态分布。\n\nD. 均值为 $-y$、方差为 $1/2$ 的正态分布。\n\nE. 率参数为 $1/y$ 的指数分布。", "solution": "我们已知联合密度正比于\n$$\nf_{X,Y}(x,y)\\propto \\exp\\big(-(x^{2}-2xy+4y^{2})\\big).\n$$\n对于给定 $Y=y$ 时 $X$ 的全条件分布，我们将 $y$ 视为一个固定值，并考虑关于 $x$ 的核：\n$$\nf_{X|Y}(x|y)\\propto f_{X,Y}(x,y)\\propto \\exp\\big(-(x^{2}-2xy+4y^{2})\\big).\n$$\n忽略掉不依赖于 $x$ 的因子，我们得到\n$$\nf_{X|Y}(x|y)\\propto \\exp\\big(-(x^{2}-2xy)\\big).\n$$\n对 $x$ 进行配方：\n$$\nx^{2}-2xy=(x-y)^{2}-y^{2},\n$$\n所以\n$$\n\\exp\\big(-(x^{2}-2xy)\\big)=\\exp\\big(-((x-y)^{2}-y^{2})\\big)=\\exp(y^{2})\\,\\exp\\big(-(x-y)^{2}\\big).\n$$\n因子 $\\exp(y^{2})$ 是一个关于 $x$ 的常数，因此可以被吸收到归一化常数中。因此，\n$$\nf_{X|Y}(x|y)\\propto \\exp\\big(-(x-y)^{2}\\big).\n$$\n将其与高斯核 $\\exp\\big(-\\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\big)$ 进行比较，我们可以确定\n$$\n\\mu=y,\\quad \\frac{1}{2\\sigma^{2}}=1\\;\\Rightarrow\\;\\sigma^{2}=\\frac{1}{2}.\n$$\n因此，$X|Y=y$ 服从均值为 $y$、方差为 $\\frac{1}{2}$ 的正态分布，这对应于选项A。", "answer": "$$\\boxed{A}$$", "id": "1920315"}, {"introduction": "在掌握了全条件分布之后，下一步就是实现迭代抽样过程。这个动手实践问题 [@problem_id:1920320] 将引导你完成吉布斯采样器的一次完整更新。它演示了为每个变量（以其他变量的当前值为条件）抽取新值的核心机制，并使用了诸如逆变换采样等实用技术来处理不同的分布类型。", "problem": "考虑一个二维随机向量$(X, Y)$，其联合概率分布由以下全条件分布定义：\n- $X$在给定$Y=y$时的条件分布是率参数为$y$的指数分布。其概率密度函数为$p(x|y) = y \\exp(-yx)$，其中 $x > 0$。\n- $Y$在给定$X=x$时的条件分布是均值参数为$x$的泊松分布。其概率质量函数为$p(y=k|x) = \\frac{x^k \\exp(-x)}{k!}$，其中 $k \\in \\{0, 1, 2, \\dots\\}$。\n\n您的任务是执行一次吉布斯采样器的完整迭代。从初始状态$(x^{(0)}, y^{(0)}) = (2, 3)$开始，您将生成一个新状态$(x^{(1)}, y^{(1)})$。该次迭代的步骤如下：首先，从分布$p(x|y^{(0)})$中为$x^{(1)}$抽取一个样本，然后，使用这个新值$x^{(1)}$，从分布$p(y|x^{(1)})$中为$y^{(1)}$抽取一个样本。\n\n为生成所需的随机变量，您必须使用逆变换采样法。请使用以下从均匀(0,1)分布中抽取的随机数：\n- 为生成$x^{(1)}$，使用均匀随机数$u_x = 0.600$。\n- 为生成$y^{(1)}$，使用均匀随机数$u_y = 0.750$。\n\n新状态$(x^{(1)}, y^{(1)})$的数值是多少？$x^{(1)}$的值必须四舍五入到四位有效数字。", "solution": "我们使用逆变换采样法执行一次吉布斯更新。\n\n1) 从$p(x \\mid y^{(0)}=3)$中采样$x^{(1)}$。\n对于率参数为$y$的指数分布，其条件累积分布函数(CDF)为\n$$\nF(x \\mid y)=1-\\exp(-yx), \\quad x>0.\n$$\n逆变换采样使用$u_{x}=F(x \\mid y)$，因此\n$$\nx^{(1)}=F^{-1}(u_{x})=-\\frac{1}{y^{(0)}}\\ln\\!\\bigl(1-u_{x}\\bigr).\n$$\n代入$y^{(0)}=3$和$u_{x}=0.600$，\n$$\nx^{(1)}=-\\frac{1}{3}\\ln(1-0.600)=-\\frac{1}{3}\\ln(0.4)=\\frac{1}{3}\\ln(2.5)\\approx 0.3054302439.\n$$\n四舍五入到四位有效数字：$x^{(1)}=0.3054$。\n\n2) 使用$u_{y}=0.750$从$p(y \\mid x^{(1)})$中采样$y^{(1)}$。\n对于均值为$x$的泊松分布，其概率质量函数(pmf)为\n$$\np(y=k \\mid x)=\\frac{x^{k}\\exp(-x)}{k!}, \\quad k\\in\\{0,1,2,\\dots\\}.\n$$\n对于离散分布，逆变换采样选择满足$F(k \\mid x)=\\sum_{j=0}^{k}p(j \\mid x)\\ge u_{y}$的最小的$k$。\n\n代入$x=x^{(1)}=\\frac{1}{3}\\ln(2.5)$，计算\n$$\np(0 \\mid x)=\\exp(-x)=\\exp\\!\\Bigl(-\\tfrac{1}{3}\\ln(2.5)\\Bigr)=2.5^{-1/3}\\approx 0.7368.\n$$\n由于$p(0 \\mid x)=0.7368<0.750$，继续计算$k=1$时的情况：\n$$\np(1 \\mid x)=x\\exp(-x)=x\\,2.5^{-1/3}\\approx 0.30543\\times 0.7368\\approx 0.2250.\n$$\n于是\n$$\nF(1 \\mid x)=p(0 \\mid x)+p(1 \\mid x)\\approx 0.7368+0.2250=0.9618>0.750,\n$$\n所以满足$F(k \\mid x)\\ge 0.750$的最小$k$是$k=1$。因此$y^{(1)}=1$。\n\n因此，新状态为$(x^{(1)},y^{(1)})=(0.3054,1)$，其中$x^{(1)}$已四舍五入到四位有效数字。", "answer": "$$\\boxed{\\begin{pmatrix}0.3054 & 1\\end{pmatrix}}$$", "id": "1920320"}, {"introduction": "虽然吉布斯采样是一个功能强大的算法，但它并非一个“魔法黑箱”，其有效性依赖于某些理论基础。这个问题 [@problem_id:2398193] 提出了一个关键的情形，其中吉布斯采样器在算法上可以执行，但其结果却无法收敛到一个有意义的分布。通过探讨非正常后验分布的概念，这个练习强调了在依赖模型的计算输出之前，验证其理论稳健性的重要性。", "problem": "考虑一个在计算经济学和金融学中常用的简单资产回报模型。设单一资产的每日对数回报 $\\{y_i\\}_{i=1}^n$ 被建模为来自一个未知均值为 $\\mu$、未知方差为 $\\sigma^2$ 的正态分布的独立同分布抽样：\n$$\ny_i \\mid \\mu,\\sigma^2 \\sim \\mathcal{N}(\\mu,\\sigma^2), \\quad i=1,\\dots,n.\n$$\n假设我们观测到 $n=3$ 个不完全相同的回报（因此样本方差严格为正）。考虑以下非正常先验设定：\n$$\np(\\mu) \\propto 1, \\quad p(\\sigma^2) \\propto 1, \\quad \\sigma^2 > 0,\n$$\n以及标准的双模块吉布斯采样器（two-block Gibbs sampler），它从完全条件分布 $p(\\mu \\mid \\sigma^2,\\mathbf{y})$ 和 $p(\\sigma^2 \\mid \\mu,\\mathbf{y})$ 交替抽样，其中 $\\mathbf{y} = (y_1,y_2,y_3)$。下列哪个陈述最为准确？\n\nA. 对于任何样本量 $n \\ge 1$，后验分布 $p(\\mu,\\sigma^2 \\mid \\mathbf{y})$ 都是正常的（proper），因此吉布斯采样器收敛到等于该后验分布的唯一平稳分布。\n\nB. 对于 $n=3$，每个完全条件分布都是正常的，因此吉布斯采样器可以被实现，但联合后验分布 $p(\\mu,\\sigma^2 \\mid \\mathbf{y})$ 是非正常的（improper）；因此，即使马尔可夫链蒙特卡洛（MCMC）链看起来混合得很好，它也缺乏一个有效的平稳分布。\n\nC. 对于任何 $n \\le 3$，条件密度 $p(\\sigma^2 \\mid \\mu,\\mathbf{y})$ 都是非正常的，因此吉布斯采样器甚至无法实现；失败源于未定义的完全条件分布。\n\nD. 用尺度不变先验 $p(\\log \\sigma^2) \\propto 1$ 替换 $p(\\sigma^2) \\propto 1$ 不会改变其正常性状态，因此无法解决 $n=3$ 时后验分布缺乏正常性的问题。", "solution": "该问题要求在特定的非正常先验设定和小样本量 $n=3$ 的条件下，分析用于未知均值 $\\mu$ 和方差 $\\sigma^2$ 的正态模型的吉布斯采样器的有效性。我们必须首先确定联合后验分布和完全条件分布的正常性（propriety）。\n\n该模型的设定如下：\n- 似然函数：对于 $i=1, \\dots, n$，$y_i \\mid \\mu, \\sigma^2 \\sim \\mathcal{N}(\\mu, \\sigma^2)$。似然函数为 $L(\\mu, \\sigma^2; \\mathbf{y}) = \\prod_{i=1}^n (2\\pi\\sigma^2)^{-1/2} \\exp\\left(-\\frac{(y_i-\\mu)^2}{2\\sigma^2}\\right) = (2\\pi)^{-n/2} (\\sigma^2)^{-n/2} \\exp\\left(-\\frac{1}{2\\sigma^2}\\sum_{i=1}^n (y_i-\\mu)^2\\right)$。\n- 样本量：$n=3$。\n- 数据属性：并非所有 $y_i$ 都相同，这确保了样本方差 $s^2 = \\frac{1}{n-1}\\sum_{i=1}^n (y_i - \\bar{y})^2$ 严格为正。\n- 先验分布：一个非正常先验 $p(\\mu, \\sigma^2) = p(\\mu)p(\\sigma^2) \\propto 1 \\cdot 1 = 1$，其中 $\\sigma^2 > 0$ 且 $-\\infty  \\mu  \\infty$。\n\n首先，我们使用贝叶斯定理推导联合后验分布 $p(\\mu, \\sigma^2 \\mid \\mathbf{y})$：\n$$\np(\\mu, \\sigma^2 \\mid \\mathbf{y}) \\propto L(\\mu, \\sigma^2; \\mathbf{y}) \\cdot p(\\mu, \\sigma^2)\n$$\n$$\np(\\mu, \\sigma^2 \\mid \\mathbf{y}) \\propto (\\sigma^2)^{-n/2} \\exp\\left(-\\frac{1}{2\\sigma^2}\\sum_{i=1}^n (y_i-\\mu)^2\\right)\n$$\n我们可以将平方和重写为 $\\sum_{i=1}^n (y_i-\\mu)^2 = \\sum_{i=1}^n (y_i - \\bar{y} + \\bar{y} - \\mu)^2 = \\sum_{i=1}^n (y_i-\\bar{y})^2 + n(\\mu - \\bar{y})^2 = (n-1)s^2 + n(\\mu-\\bar{y})^2$。令 $S = (n-1)s^2$。由于 $s^2 > 0$ 且 $n=3$，所以 $S > 0$。\n那么后验分布为：\n$$\np(\\mu, \\sigma^2 \\mid \\mathbf{y}) \\propto (\\sigma^2)^{-n/2} \\exp\\left(-\\frac{(n-1)s^2 + n(\\mu-\\bar{y})^2}{2\\sigma^2}\\right)\n$$\n\n为了检查此后验分布是否正常，我们必须验证其在参数空间上的积分是否有限：\n$$\n\\int_0^\\infty \\int_{-\\infty}^\\infty p(\\mu, \\sigma^2 \\mid \\mathbf{y}) d\\mu d\\sigma^2  \\infty\n$$\n让我们首先对 $\\mu$ 进行积分：\n$$\n\\int_{-\\infty}^\\infty \\exp\\left(-\\frac{n(\\mu-\\bar{y})^2}{2\\sigma^2}\\right) d\\mu\n$$\n这是 $\\mu$ 的一个正态分布的核，其均值为 $\\bar{y}$，方差为 $\\sigma^2/n$。该积分等于 $\\sqrt{2\\pi\\sigma^2/n}$。\n将其代回，$\\sigma^2$ 的边际后验分布为：\n$$\np(\\sigma^2 \\mid \\mathbf{y}) \\propto \\int_0^\\infty (\\sigma^2)^{-n/2} \\exp\\left(-\\frac{(n-1)s^2}{2\\sigma^2}\\right) \\cdot \\sqrt{2\\pi\\sigma^2/n} \\, d\\sigma^2\n$$\n$$\np(\\sigma^2 \\mid \\mathbf{y}) \\propto (\\sigma^2)^{-n/2 + 1/2} \\exp\\left(-\\frac{(n-1)s^2}{2\\sigma^2}\\right) = (\\sigma^2)^{-(n-1)/2} \\exp\\left(-\\frac{(n-1)s^2}{2\\sigma^2}\\right)\n$$\n该表达式是 $\\sigma^2$ 的逆伽玛分布（Inverse-Gamma distribution）的核。一个形状参数为 $\\alpha$、尺度参数为 $\\beta$ 的逆伽玛分布，记作 $\\text{IG}(\\alpha, \\beta)$，其密度正比于 $x^{-(\\alpha+1)}e^{-\\beta/x}$。对于我们的分布，形状参数 $\\alpha$ 必须满足 $\\alpha+1 = (n-1)/2$，这得到 $\\alpha = (n-1)/2 - 1 = (n-3)/2$。\n为使该分布正常，形状参数必须为正：$\\alpha > 0$。\n$$\n\\frac{n-3}{2} > 0 \\implies n > 3.\n$$\n对于给定的问题 $n=3$，形状参数为 $\\alpha = (3-3)/2 = 0$。$p(\\sigma^2 \\mid \\mathbf{y})$ 的积分呈对数发散。因此，对于 $n=3$，联合后验分布 $p(\\mu, \\sigma^2 \\mid \\mathbf{y})$ 是**非正常的**（improper）。\n\n接下来，我们考察吉布斯采样器所需的完全条件分布。\n1.  **$\\mu$ 的完全条件分布**：$p(\\mu \\mid \\sigma^2, \\mathbf{y})$\n    $$\n    p(\\mu \\mid \\sigma^2, \\mathbf{y}) \\propto p(\\mu, \\sigma^2 \\mid \\mathbf{y}) \\propto \\exp\\left(-\\frac{n(\\mu-\\bar{y})^2}{2\\sigma^2}\\right)\n    $$\n    这是正态分布 $\\mathcal{N}(\\bar{y}, \\sigma^2/n)$ 的核。对于任何 $n \\ge 1$ 和任何给定的 $\\sigma^2 > 0$，这是一个正常的分布。\n\n2.  **$\\sigma^2$ 的完全条件分布**：$p(\\sigma^2 \\mid \\mu, \\mathbf{y})$\n    $$\n    p(\\sigma^2 \\mid \\mu, \\mathbf{y}) \\propto p(\\mu, \\sigma^2 \\mid \\mathbf{y}) \\propto (\\sigma^2)^{-n/2} \\exp\\left(-\\frac{1}{2\\sigma^2}\\sum_{i=1}^n(y_i-\\mu)^2\\right)\n    $$\n    这是 $\\sigma^2$ 的逆伽玛分布的核。令平方和为 $Q = \\sum_{i=1}^n(y_i-\\mu)^2 > 0$。该密度正比于 $(\\sigma^2)^{-n/2} \\exp(-Q/(2\\sigma^2))$。将其与 $\\text{IG}(\\alpha, \\beta)$ 的核 $(\\sigma^2)^{-(\\alpha+1)}e^{-\\beta/\\sigma^2}$ 比较，我们有 $\\alpha+1 = n/2$，因此形状参数为 $\\alpha = n/2-1$。为使该条件分布正常，我们需要 $\\alpha > 0$，即 $n/2 - 1 > 0 \\implies n > 2$。\n    对于给定的 $n=3$，形状参数为 $\\alpha = 3/2 - 1 = 1/2 > 0$。因此，完全条件分布 $p(\\sigma^2 \\mid \\mu, \\mathbf{y})$ 是一个正常的逆伽玛分布。\n\n对于 $n=3$ 的总结：\n- 联合后验分布 $p(\\mu, \\sigma^2 \\mid \\mathbf{y})$ 是**非正常的**。\n- 完全条件分布 $p(\\mu \\mid \\sigma^2, \\mathbf{y})$ 是**正常的**（正态分布）。\n- 完全条件分布 $p(\\sigma^2 \\mid \\mu, \\mathbf{y})$ 是**正常的**（逆伽玛分布）。\n\n现在我们评估每个陈述。\n\nA. 对于任何样本量 $n \\ge 1$，后验分布 $p(\\mu,\\sigma^2 \\mid \\mathbf{y})$ 都是正常的，因此吉布斯采样器收敛到等于该后验分布的唯一平稳分布。\n这个陈述是错误的。如前所述，联合后验分布仅在 $n > 3$ 时才正常。对于 $n=3$，它是非正常的。**不正确**。\n\nB. 对于 $n=3$，每个完全条件分布都是正常的，因此吉布斯采样器可以被实现，但联合后验分布 $p(\\mu,\\sigma^2 \\mid \\mathbf{y})$ 是非正常的；因此，即使马尔可夫链蒙特卡洛（MCMC）链看起来混合得很好，它也缺乏一个有效的平稳分布。\n这个陈述精确地总结了我们的发现。对于 $n=3$，两个完全条件分布确实都是正常的，这意味着可以在算法上从它们中抽样并运行采样器。然而，由于联合后验分布是非正常的，所产生的马尔可夫链不会收敛到一个正常的概率分布。这样的链不是正常返的（positive recurrent），也没有有效的平稳分布。这种条件分布正常但联合分布不正常的现象，是 MCMC 中一个已知的病态问题。**正确**。\n\nC. 对于任何 $n \\le 3$，条件密度 $p(\\sigma^2 \\mid \\mu,\\mathbf{y})$ 都是非正常的，因此吉布斯采样器甚至无法实现；失败源于未定义的完全条件分布。\n这是错误的。我们证明了对于 $n>2$，$p(\\sigma^2 \\mid \\mu, \\mathbf{y})$ 是正常的。特别地，对于 $n=3$，它是一个正常的逆伽玛分布。吉布斯采样器*可以*实现。失败在于目标分布的性质，而不是实现步骤。**不正确**。\n\nD. 用尺度不变先验 $p(\\log \\sigma^2) \\propto 1$ 替换 $p(\\sigma^2) \\propto 1$ 不会改变其正常性状态，因此无法解决 $n=3$ 时后验分布缺乏正常性的问题。\n先验 $p(\\log \\sigma^2) \\propto 1$ 与 $p(\\sigma) \\propto 1/\\sigma$ 相同，或者通过变量替换，与 $p(\\sigma^2) \\propto 1/\\sigma^2$ 相同。这是（在 $\\mu$ 未知时）$\\sigma^2$ 的标准 Jeffreys 先验。让我们用这个新先验重新审视后验分布的正常性。\n$$\np(\\mu, \\sigma^2 \\mid \\mathbf{y}) \\propto L(\\mu, \\sigma^2; \\mathbf{y}) \\cdot p(\\mu) \\cdot p(\\sigma^2) \\propto (\\sigma^2)^{-n/2} \\exp\\left(-\\frac{1}{2\\sigma^2}\\sum(y_i-\\mu)^2\\right) \\cdot 1 \\cdot (\\sigma^2)^{-1}\n$$\n$$\np(\\mu, \\sigma^2 \\mid \\mathbf{y}) \\propto (\\sigma^2)^{-(n/2+1)} \\exp\\left(-\\frac{1}{2\\sigma^2}\\sum(y_i-\\mu)^2\\right)\n$$\n遵循与之前相同的积分步骤，$\\sigma^2$ 的边际后验分布变为：\n$$\np(\\sigma^2 \\mid \\mathbf{y}) \\propto (\\sigma^2)^{-(n/2+1)+1/2} \\exp\\left(-\\frac{(n-1)s^2}{2\\sigma^2}\\right) = (\\sigma^2)^{-(n+1)/2} \\exp\\left(-\\frac{(n-1)s^2}{2\\sigma^2}\\right)\n$$\n这是一个逆伽玛核，其形状参数 $\\alpha$ 满足 $\\alpha+1 = (n+1)/2$，得到 $\\alpha = (n-1)/2$。为保证正常性，我们需要 $\\alpha > 0$，即 $(n-1)/2 > 0 \\implies n > 1$。\n有了这个新先验，后验分布对于 $n=3$ 是正常的（因为 $3>1$）。因此，改变先验*确实*解决了缺乏正常性的问题。该陈述声称正常性状态“不变”，且问题“无法”解决，这两点都明显是错误的。**不正确**。", "answer": "$$\\boxed{B}$$", "id": "2398193"}]}