{"hands_on_practices": [{"introduction": "本练习旨在奠定一项核心技能：在一个交易者拥有不同信念和风险厌恶程度的市场中，如何求解资产的市场出清价格。通过这个基于恒定绝对风险厌恶（$CARA$）效用的静态模型，你将学习如何从微观个体的特征出发，汇总需求并推导出风险溢价这一宏观市场指标。[@problem_id:2445904]", "problem": "考虑一个单期市场，其中包含一种无风险资产和一种风险资产。市场中有 $N$ 个代理人，索引为 $i \\in \\{1,\\dots,N\\}$。每个代理人对期末财富的效用函数为恒定绝对风险规避（CARA）形式，由 $U_i(w) = -\\exp(-\\gamma_i w)$ 给出，其中风险规避参数 $\\gamma_i > 0$。风险资产在期末支付一笔随机收益 $D$。代理人 $i$ 持有主观信念，认为 $D$ 服从均值为 $\\mu_i$、方差为 $\\sigma_i^2$ 的正态分布，记为 $D \\sim \\mathcal{N}(\\mu_i,\\sigma_i^2)$。无风险资产的总回报率为 $R_f > 0$。风险资产的外生总净供给为 $s \\in \\mathbb{R}$（以风险资产的单位计量）。令 $P$ 表示风险资产在日期 $0$ 的价格。\n\n每个代理人在日期 $0$选择持有风险资产的头寸 $x_i$，以最大化其期末财富的期望效用，并将价格 $P$ 视为给定。市场出清要求 $\\sum_{i=1}^N x_i = s$。假设所有给定参数能够确保竞争均衡价格 $P$ 的存在且唯一。\n\n将给定实例的风险溢价定义为代理人期望收益的简单平均值与价格 $P$ 下所需总收益之差，即：\n$$\\text{RP} \\equiv \\bar{\\mu} - P R_f, \\quad \\text{where} \\quad \\bar{\\mu} \\equiv \\frac{1}{N}\\sum_{i=1}^N \\mu_i.$$\n请以与 $D$ 相同单位（例如，美元）的实数形式报告风险溢价。答案请以小数形式表示（不带百分号）。\n\n您的任务是编写一个程序，为下面的每个测试用例计算出能够使市场出清的唯一竞争均衡价格 $P$，然后输出上面定义的相应风险溢价 $\\text{RP}$。请将每个风险溢价四舍五入到 $6$ 位小数。\n\n测试套件（每个测试用例指定 $(N, R_f, s, \\{\\gamma_i\\}_{i=1}^N, \\{\\mu_i\\}_{i=1}^N, \\{\\sigma_i^2\\}_{i=1}^N)$）：\n- 测试用例 A:\n  - $N = 3$, $R_f = 1.02$, $s = 1.0$,\n  - $\\{\\gamma_i\\} = [2.0, 3.0, 1.0]$,\n  - $\\{\\mu_i\\} = [1.0, 1.2, 0.8]$,\n  - $\\{\\sigma_i^2\\} = [0.25, 0.25, 0.25]$。\n- 测试用例 B:\n  - $N = 3$, $R_f = 1.01$, $s = 1000.0$,\n  - $\\{\\gamma_i\\} = [1.0, 2.0, 3.0]$,\n  - $\\{\\mu_i\\} = [1.0, 1.0, 1.0]$,\n  - $\\{\\sigma_i^2\\} = [10^{-6}, 10^{-6}, 10^{-6}]$。\n- 测试用例 C:\n  - $N = 3$, $R_f = 1.00$, $s = 50.0$,\n  - $\\{\\gamma_i\\} = [10^{-6}, 2.0, 3.0]$,\n  - $\\{\\mu_i\\} = [1.1, 1.1, 1.1]$,\n  - $\\{\\sigma_i^2\\} = [9.0, 9.0, 9.0]$。\n- 测试用例 D:\n  - $N = 3$, $R_f = 1.05$, $s = 0.0$,\n  - $\\{\\gamma_i\\} = [2.0, 1.0, 4.0]$,\n  - $\\{\\mu_i\\} = [0.9, 1.4, 1.1]$,\n  - $\\{\\sigma_i^2\\} = [0.16, 0.36, 0.25]$。\n\n最终输出格式：您的程序应生成单行输出，其中包含四个测试用例的风险溢价，每个值都四舍五入到 $6$ 位小数，并以逗号分隔列表的形式包含在方括号内，例如 $[r_A,r_B,r_C,r_D]$，其中 $r_A$ 对应于测试用例 A，依此类推。不应打印任何额外文本。", "solution": "所提问题是一个包含异质代理人的标准资产定价模型，该模型具有科学依据、良定且客观。因此，可以对其进行全面的分析。我们从第一性原理出发推导解决方案。\n\n该模型包括 $N$ 个代理人、一个总回报率为 $R_f > 0$ 的无风险资产，以及一个在日期 $0$ 价格为 $P$、在日期 $1$ 随机收益为 $D$ 的风险资产。代理人 $i \\in \\{1, \\dots, N\\}$ 具有恒定绝对风险规避（CARA）效用函数 $U_i(w) = -\\exp(-\\gamma_i w)$，其中 $\\gamma_i > 0$ 是绝对风险规避系数。每个代理人 $i$ 都持有主观信念，认为收益 $D$ 服从正态分布，$D \\sim \\mathcal{N}(\\mu_i, \\sigma_i^2)$。\n\n代理人 $i$ 选择持有数量为 $x_i$ 的风险资产。其初始财富 $w_{i,0}$ 的剩余部分投资于无风险资产。因此，代理人 $i$ 在日期 $1$ 的财富由下式给出：\n$$w_i = (w_{i,0} - x_i P)R_f + x_i D = w_{i,0}R_f + x_i(D - PR_f)$$\n代理人的目标是根据其主观信念最大化期末财富的期望效用：\n$$\\max_{x_i} \\mathbb{E}_i[U_i(w_i)] = \\max_{x_i} \\mathbb{E}_i[-\\exp(-\\gamma_i w_i)]$$\n代入 $w_i$ 的表达式：\n$$\\max_{x_i} \\mathbb{E}_i[-\\exp(-\\gamma_i (w_{i,0}R_f + x_i(D - PR_f)))]$$\n由于 $w_{i,0}$ 和 $R_f$ 是常数，且最大化 $-f(x)$ 等价于最小化 $f(x)$，因此该问题等价于：\n$$\\min_{x_i} \\exp(-\\gamma_i w_{i,0}R_f) \\mathbb{E}_i[\\exp(-\\gamma_i x_i(D - PR_f))]$$\n项 $\\exp(-\\gamma_i w_{i,0}R_f)$ 是一个关于选择变量 $x_i$ 的正常数，可以忽略。因此，优化问题等价于最小化期望项。令随机变量为 $Z_i = -\\gamma_i x_i(D - PR_f)$。从代理人 $i$ 的角度来看，由于 $D \\sim \\mathcal{N}(\\mu_i, \\sigma_i^2)$，项 $(D - PR_f)$ 也服从均值为 $\\mu_i - PR_f$、方差为 $\\sigma_i^2$ 的正态分布。因此，$Z_i$ 是一个正态分布的随机变量，其均值为 $\\mathbb{E}_i[Z_i] = -\\gamma_i x_i(\\mu_i - PR_f)$，方差为 $\\text{Var}_i(Z_i) = (-\\gamma_i x_i)^2 \\sigma_i^2 = \\gamma_i^2 x_i^2 \\sigma_i^2$。\n\n期望 $\\mathbb{E}_i[\\exp(Z_i)]$ 是正态变量 $Z_i$ 在 $t=1$ 处取值的矩生成函数。对于一个一般的正态变量 $X \\sim \\mathcal{N}(\\mu_X, \\sigma_X^2)$，其矩生成函数为 $M_X(t) = \\exp(\\mu_X t + \\frac{1}{2}\\sigma_X^2 t^2)$。将此应用于 $Z_i$：\n$$\\mathbb{E}_i[\\exp(Z_i)] = \\exp(\\mathbb{E}_i[Z_i] \\cdot 1 + \\frac{1}{2}\\text{Var}_i(Z_i) \\cdot 1^2) = \\exp(-\\gamma_i x_i(\\mu_i - PR_f) + \\frac{1}{2}\\gamma_i^2 x_i^2 \\sigma_i^2)$$\n代理人的问题简化为选择 $x_i$ 来最小化此表达式，这等价于最小化其指数部分（确定性等价收益率）：\n$$\\min_{x_i} \\left\\{ -\\gamma_i x_i(\\mu_i - PR_f) + \\frac{1}{2}\\gamma_i^2 x_i^2 \\sigma_i^2 \\right\\}$$\n这是一个关于 $x_i$ 的凸二次函数。通过对 $x_i$ 求导并令结果为零，可以找到最小化的一阶条件：\n$$\\frac{\\partial}{\\partial x_i} \\left[ -\\gamma_i x_i(\\mu_i - PR_f) + \\frac{1}{2}\\gamma_i^2 x_i^2 \\sigma_i^2 \\right] = -\\gamma_i(\\mu_i - PR_f) + \\gamma_i^2 x_i \\sigma_i^2 = 0$$\n由于 $\\gamma_i > 0$，我们可以除以 $\\gamma_i$ 并求解 $x_i$，得到个人对风险资产的需求：\n$$x_i(P) = \\frac{\\mu_i - PR_f}{\\gamma_i \\sigma_i^2}$$\n该表达式表明，需求由风险资产单位感知期望超额回报驱动，并根据代理人的风险容忍度进行缩放，风险容忍度是风险规避和感知方差乘积的倒数。\n\n均衡价格 $P$ 由市场出清条件决定，该条件使得总需求等于外生总供给 $s$：\n$$\\sum_{i=1}^N x_i = s$$\n代入个人需求函数：\n$$\\sum_{i=1}^N \\frac{\\mu_i - PR_f}{\\gamma_i \\sigma_i^2} = s$$\n我们可以求解这个关于 $P$ 的线性方程。让我们分离各项：\n$$\\sum_{i=1}^N \\frac{\\mu_i}{\\gamma_i \\sigma_i^2} - \\sum_{i=1}^N \\frac{PR_f}{\\gamma_i \\sigma_i^2} = s$$\n$$PR_f \\left( \\sum_{i=1}^N \\frac{1}{\\gamma_i \\sigma_i^2} \\right) = \\left( \\sum_{i=1}^N \\frac{\\mu_i}{\\gamma_i \\sigma_i^2} \\right) - s$$\n求解所需总收益 $PR_f$：\n$$PR_f = \\frac{\\left( \\sum_{i=1}^N \\frac{\\mu_i}{\\gamma_i \\sigma_i^2} \\right) - s}{\\sum_{i=1}^N \\frac{1}{\\gamma_i \\sigma_i^2}}$$\n问题将风险溢价定义为 $\\text{RP} \\equiv \\bar{\\mu} - PR_f$，其中 $\\bar{\\mu} = \\frac{1}{N}\\sum_{i=1}^N \\mu_i$。代入推导出的 $PR_f$ 表达式，得到风险溢价的最终公式：\n$$\\text{RP} = \\left(\\frac{1}{N}\\sum_{i=1}^N \\mu_i\\right) - \\frac{\\left( \\sum_{i=1}^N \\frac{\\mu_i}{\\gamma_i \\sigma_i^2} \\right) - s}{\\sum_{i=1}^N \\frac{1}{\\gamma_i \\sigma_i^2}}$$\n将实现此解析表达式来计算每个测试用例的风险溢价。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the competitive equilibrium price and risk premium for a set of test cases\n    in a CARA-Normal asset pricing model with heterogeneous beliefs.\n    \"\"\"\n\n    def calculate_risk_premium(N, Rf, s, gammas, mus, sigmas_sq):\n        \"\"\"\n        Calculates the risk premium for a single market instance.\n\n        Args:\n            N (int): Number of agents.\n            Rf (float): Gross risk-free return.\n            s (float): Aggregate net supply of the risky asset.\n            gammas (np.ndarray): Array of risk aversion parameters.\n            mus (np.ndarray): Array of subjective expected payoffs.\n            sigmas_sq (np.ndarray): Array of subjective payoff variances.\n\n        Returns:\n            float: The calculated risk premium.\n        \"\"\"\n        # Average of agents' expected payoffs\n        mu_bar = np.mean(mus)\n\n        # Risk tolerances tau_i = 1 / (gamma_i * sigma_i^2)\n        taus = 1.0 / (gammas * sigmas_sq)\n\n        # Numerator of the PR_f expression: sum(mu_i * tau_i) - s\n        numerator_pr_f = np.sum(mus * taus) - s\n\n        # Denominator of the PR_f expression: sum(tau_i)\n        denominator_pr_f = np.sum(taus)\n\n        # Required gross payoff at equilibrium price P\n        pr_f = numerator_pr_f / denominator_pr_f\n\n        # Risk premium RP = mu_bar - P * R_f\n        risk_premium = mu_bar - pr_f\n        \n        return risk_premium\n\n    # Test Suite\n    test_cases = [\n        # Test case A: (N, Rf, s, {gamma_i}, {mu_i}, {sigma_i^2})\n        (3, 1.02, 1.0, np.array([2.0, 3.0, 1.0]), np.array([1.0, 1.2, 0.8]), np.array([0.25, 0.25, 0.25])),\n        # Test case B:\n        (3, 1.01, 1000.0, np.array([1.0, 2.0, 3.0]), np.array([1.0, 1.0, 1.0]), np.array([1e-6, 1e-6, 1e-6])),\n        # Test case C:\n        (3, 1.00, 50.0, np.array([1e-6, 2.0, 3.0]), np.array([1.1, 1.1, 1.1]), np.array([9.0, 9.0, 9.0])),\n        # Test case D:\n        (3, 1.05, 0.0, np.array([2.0, 1.0, 4.0]), np.array([0.9, 1.4, 1.1]), np.array([0.16, 0.36, 0.25])),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, Rf, s, gammas, mus, sigmas_sq = case\n        rp = calculate_risk_premium(N, Rf, s, gammas, mus, sigmas_sq)\n        results.append(rp)\n    \n    # Format the output as a comma-separated list of values rounded to 6 decimal places.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```", "id": "2445904"}, {"introduction": "本练习引入了动态视角，通过构建一个包含“知情者”与“启发式交易者”的市场来探索价格的演化。你将推导出一个明确的价格递推关系，它揭示了当市场同时存在理性预期和适应性预期时，价格如何偏离其基本价值并表现出持续性，这是理解由异质性驱动的市场动态的关键一步。[@problem_id:2399044]", "problem": "考虑一种在 $T$ 个离散时期（由 $t \\in \\{0,1,\\dots,T-1\\}$ 索引）内交易的单一风险资产。在每个时期，有 $N$ 位风险规避的代理人与该资产的外生净供给 $Q$ 进行交易。该资产在时期 $t$ 结束时产生一个确定性的基本面回报 $F_t$。比例为 $\\phi$ 的代理人能完美预测基本面回报（即在每个时期 $t$，他们都确切知道 $F_t$），这些代理人代表配备了人工智能（AI）的群体。剩余比例为 $1-\\phi$ 的代理人是启发式预测者，他们使用一个简单的规则来形成预期。\n\n每个代理人 $i$ 都具有均值-方差偏好，他们拥有相同的恒定绝对风险规避系数 $a$ 和对每期资产回报的共同感知方差 $s^2$。在时期 $t$，给定价格 $P_t$ 和代理人 $i$ 对时期 $t$ 回报的特定预期 $E_i[F_t]$，代理人 $i$ 的需求为\n$$\nD_{i,t} \\;=\\; \\frac{E_i[F_t] - P_t}{a\\,s^2}.\n$$\n每个时期的市场出清要求\n$$\n\\sum_{i=1}^{N} D_{i,t} \\;=\\; Q.\n$$\n预期是异质的，具体如下：\n- 对于AI信息型代理人，$E_i[F_t] = F_t$。\n- 对于启发式代理人，其预期是上一时期的价格，即：\n$$\nE_i[F_t] \\;=\\; H_t \\;=\\; P_{t-1}.\n$$\n初始条件为 $P_{-1} = F_0$，以确保第一个交易时期的启发式预期有明确定义。\n\n所有测试用例的基本面回报路径均相同，并由以下公式确定性地定义：\n$$\nF_t \\;=\\; 100 \\;+\\; 5 \\,\\sin\\!\\left( \\frac{2\\pi t}{10} \\right) \\;+\\; 0.5\\,t\n$$\n适用于所有 $t \\in \\{0,1,\\dots,T-1\\}$，其中正弦函数的参数以弧度为单位。\n\n您的任务是，对于给定的参数 $\\left(T,N,\\phi,a,s^2,Q\\right)$，使用市场出清条件和指定的预期，计算上述市场所隐含的价格序列 $\\{P_t\\}_{t=0}^{T-1}$。对每组参数，计算价格与基本面之间的平均绝对偏差\n$$\n\\mathrm{MAD} \\;=\\; \\frac{1}{T}\\sum_{t=0}^{T-1} \\left| P_t - F_t \\right|,\n$$\n结果为一个实数。\n\n在所有测试用例中，使用以下固定的模型要素：\n- 时期数 $T=20$。\n- 代理人数 $N=100$。\n\n待评估的参数集测试套件：\n- 案例 1：$\\phi=0.4$, $a=2.0$, $s^2=1.0$, $Q=10.0$。\n- 案例 2：$\\phi=1.0$, $a=3.0$, $s^2=2.0$, $Q=0.0$。\n- 案例 3：$\\phi=0.0$, $a=2.0$, $s^2=1.0$, $Q=5.0$。\n- 案例 4：$\\phi=0.5$, $a=10^6$, $s^2=1.0$, $Q=0.0$。\n- 案例 5：$\\phi=0.6$, $a=2.0$, $s^2=1.0$, $Q=100.0$。\n\n你的程序必须按以上列出的顺序计算每个案例的 $\\mathrm{MAD}$，并生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表，每个值四舍五入到 $6$ 位小数（例如，$\\left[\\text{result}_1,\\text{result}_2,\\dots\\right]$）。不应打印任何其他文本。", "solution": "问题陈述已经过严格验证，并被证实是有效的。它在科学上合理、适定且客观。该问题提出了一个计算经济学中的标准异质代理人模型，并提供了推导唯一可计算解所需的所有参数和初始条件。我们将着手解决此问题。\n\n该模型包含 $N$ 位交易一种风险资产的代理人。其中，比例为 $\\phi$ 的代理人是“AI信息型”代理人，他们能完美预见基本面回报 $F_t$，其预期为 $E_{\\text{AI}}[F_t] = F_t$。剩余比例为 $1-\\phi$ 的代理人是“启发式”代理人，他们基于上一时期的价格形成预期：$E_{\\text{Heuristic}}[F_t] = P_{t-1}$。所有代理人拥有相同的恒定绝对风险规避系数 $a$ 和感知到的回报方差 $s^2$。代理人 $i$ 在时期 $t$ 的需求由以下公式给出：\n$$\nD_{i,t} = \\frac{E_i[F_t] - P_t}{a s^2}\n$$\n市场出清要求总需求等于净供给 $Q$：\n$$\n\\sum_{i=1}^{N} D_{i,t} = Q\n$$\n我们可以通过加总每种类型代理人的需求来表示总需求。AI信息型代理人的人数为 $N\\phi$，启发式代理人的人数为 $N(1-\\phi)$。因此，市场出清条件变为：\n$$\n(N\\phi) \\left( \\frac{F_t - P_t}{a s^2} \\right) + N(1-\\phi) \\left( \\frac{P_{t-1} - P_t}{a s^2} \\right) = Q\n$$\n为了求得均衡价格 $P_t$，我们必须解这个关于 $P_t$ 的方程。首先，我们将等式两边同乘以 $\\frac{a s^2}{N}$：\n$$\n\\phi(F_t - P_t) + (1-\\phi)(P_{t-1} - P_t) = \\frac{a s^2 Q}{N}\n$$\n接下来，我们展开并合并包含 $P_t$ 的项：\n$$\n\\phi F_t - \\phi P_t + (1-\\phi) P_{t-1} - (1-\\phi) P_t = \\frac{a s^2 Q}{N}\n$$\n$$\n\\phi F_t + (1-\\phi) P_{t-1} - (\\phi + 1 - \\phi) P_t = \\frac{a s^2 Q}{N}\n$$\n$$\n\\phi F_t + (1-\\phi) P_{t-1} - P_t = \\frac{a s^2 Q}{N}\n$$\n分离出 $P_t$ 可得到价格路径的一阶线性递推关系：\n$$\nP_t = \\phi F_t + (1-\\phi) P_{t-1} - \\frac{a s^2 Q}{N}\n$$\n该方程表明，当前价格是基本面价值 $F_t$ 和上一期价格 $P_{t-1}$ 的加权平均，并根据与净供给 $Q$ 相关的风险溢价项进行了调整。权重由AI信息型代理人的比例 $\\phi$ 决定。\n\n问题给出了基本面价值 $F_t$ 在 $T=20$ 个时期内的确定性路径：\n$$\nF_t = 100 + 5 \\sin\\left(\\frac{2\\pi t}{10}\\right) + 0.5t \\quad \\text{for } t \\in \\{0, 1, \\dots, T-1\\}\n$$\n启动递推需要一个初始条件，该条件为 $P_{-1} = F_0$。有了它，我们就可以通过迭代计算出整个价格序列 $\\{P_t\\}_{t=0}^{T-1}$。\n\n每个测试用例的算法如下：\n1.  设置参数 $(T, N, \\phi, a, s^2, Q)$。\n2.  根据其定义生成基本面价值序列 $\\{F_t\\}_{t=0}^{T-1}$。\n3.  用 $P_{-1} = F_0$ 来初始化价格递推。\n4.  对 $t$ 从 0 到 $T-1$ 进行迭代，应用推导出的递推关系来计算每个 $P_t$。\n5.  一旦价格序列 $\\{P_t\\}_{t=0}^{T-1}$ 计算完毕，就计算其与基本面价值的平均绝对偏差 (MAD)：\n    $$\n    \\mathrm{MAD} = \\frac{1}{T} \\sum_{t=0}^{T-1} |P_t - F_t|\n    $$\n将此流程应用于五个指定的参数集，以获得所需的结果。具体实现将利用数值库来确保计算精度。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the price path and Mean Absolute Deviation (MAD) for a\n    heterogeneous agent model based on the problem specification.\n    \"\"\"\n    \n    # Fixed model parameters\n    T = 20\n    N = 100\n\n    # Test suite of parameter sets (phi, a, s^2, Q)\n    test_cases = [\n        (0.4, 2.0, 1.0, 10.0),  # Case 1\n        (1.0, 3.0, 2.0, 0.0),   # Case 2\n        (0.0, 2.0, 1.0, 5.0),   # Case 3\n        (0.5, 1e6, 1.0, 0.0),   # Case 4\n        (0.6, 2.0, 1.0, 100.0)  # Case 5\n    ]\n\n    results = []\n\n    # Generate the fundamental payoff path\n    t_vals = np.arange(T)\n    F = 100.0 + 5.0 * np.sin(2.0 * np.pi * t_vals / 10.0) + 0.5 * t_vals\n\n    for case in test_cases:\n        phi, a, s2, Q = case\n        \n        # Initialize the price array\n        P = np.zeros(T)\n        \n        # Set the initial condition P_{-1} = F_0\n        P_prev = F[0]\n        \n        # Define the constant term from the recurrence relation\n        const_term = (a * s2 * Q) / N\n        \n        # Iterate through time to compute the price path\n        for t in range(T):\n            # Price recurrence relation: P_t = phi*F_t + (1-phi)*P_{t-1} - (a*s^2*Q)/N\n            P[t] = phi * F[t] + (1 - phi) * P_prev - const_term\n            P_prev = P[t]\n            \n        # Calculate the Mean Absolute Deviation (MAD)\n        mad = np.mean(np.abs(P - F))\n        \n        # Append formatted result\n        results.append(f\"{mad:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2399044"}, {"introduction": "在之前概念的基础上，这项综合性练习将引导你从零开始构建一个功能完备的异质主体仿真模型。你将模拟一个更加真实的“人造市场”：其中的交易者不仅风险偏好各异，还会根据历史收益自适应地学习和调整其投资组合，而他们的财富也将随之演化，从而动态地改变他们在市场中的影响力。[@problem_id:2399122]", "problem": "考虑一个由大量代理人组成的群体，他们在一项安全资产和一项风险资产之间进行投资组合选择。时间是离散的，由 $t \\in \\{0,1,2,\\dots,T-1\\}$ 索引。每个代理人 $i \\in \\{1,\\dots,N\\}$ 在时期 $t$ 开始时，选择一个投资组合份额 $x_{i,t} \\in [0,1]$ 投资于风险资产，剩余的份额 $1-x_{i,t}$ 投资于安全资产。安全资产具有恒定的总回报率 $R_f > 0$。风险资产的净回报率 $r_t$ 随时间独立同分布 (i.i.d.)，其均值 $\\mu^\\star$ 未知，方差 $\\sigma^2$ 已知。回报率以小数形式表示；例如，百分之五的回报率为 $0.05$，每期百分之一的总无风险回报率为 $R_f = 1.01$。\n\n代理人在两个维度上是异质的：\n- 每个代理人 $i$ 拥有一个风险厌恶系数 $\\gamma_i > 0$。\n- 每个代理人 $i$ 拥有一个学习率 $\\alpha_i \\in (0,1]$，用于自适应地更新其对风险资产预期净回报率的估计。\n\n在时间 $t$，观察到 $r_t$ 之前，每个代理人对风险资产的预期净回报率持有一个信念 $\\mu_{i,t}$。信念根据自适应学习进行演化：\n$$\n\\mu_{i,t+1} \\;=\\; \\mu_{i,t} + \\alpha_i \\left(r_t - \\mu_{i,t}\\right).\n$$\n假设所有代理人都知道方差 $\\sigma^2$ 和安全总回报率 $R_f$，但不知道 $\\mu^\\star$。存在无卖空、无杠杆约束：对于所有 $i, t$， $x_{i,t} \\in [0,1]$。\n\n财富根据标准总回报率聚合进行演化：\n$$\nW_{i,t+1} \\;=\\; W_{i,t} \\left[ R_f \\left(1-x_{i,t}\\right) + \\left(1+r_t\\right) x_{i,t} \\right],\n$$\n所有代理人的初始财富为 $W_{i,0} = 1$。\n\n代理人选择 $x_{i,t}$ 以最大化一个基于 Markowitz 框架的均值-方差目标，该目标在正态回报下可以通过指数效用函数来合理解释。从线性投资组合的期望和方差的定义以及 $r_t$ 的正态性假设出发，从第一性原理推导单期最优风险份额 $x_{i,t}$，它是在约束 $x_{i,t} \\in [0,1]$ 下，关于代理人信念 $\\mu_{i,t}$、安全回报率 $R_f$、风险厌恶参数 $\\gamma_i$ 和回报率方差 $\\sigma^2$ 的函数。最终的选择规则必须从一阶条件获得，然后投影到可行集 $[0,1]$ 上。\n\n将时间 $t$ 的财富加权总风险份额定义为\n$$\n\\bar{x}_t \\;=\\; \\frac{\\sum_{i=1}^{N} W_{i,t} \\, x_{i,t}}{\\sum_{i=1}^{N} W_{i,t}}.\n$$\n\n您的任务是实现这个异质代理人经济体的模拟，并为下面测试套件中的每个参数集计算财富加权风险份额在最后 $L$ 个时期内的时间平均值：\n$$\n\\bar{x}_{\\text{avg}} \\;=\\; \\frac{1}{L} \\sum_{t=T-L}^{T-1} \\bar{x}_t.\n$$\n\n所有代理人的初始信念被设定为安全净回报率：\n$$\n\\mu_{i,0} \\;=\\; R_f - 1.\n$$\n\n异质性是使用基于索引的周期确定性地分配的。设给定 $\\gamma_{\\text{base}} > 0$ 和 $\\alpha_{\\text{base}} \\in (0,1]$。对于代理人索引 $i = 1,\\dots,N$ 定义\n$$\n\\gamma_i \\;=\\; \\gamma_{\\text{base}} \\times m_{(i \\bmod 4)},\n\\quad \\text{其中 } m_{0}=0.5,\\; m_{1}=1.0,\\; m_{2}=1.5,\\; m_{3}=2.0,\n$$\n和\n$$\n\\alpha_i \\;=\\; \\min\\left(0.9,\\; \\alpha_{\\text{base}} \\times a_{(i \\bmod 4)}\\right),\n\\quad \\text{其中 } a_{0}=0.5,\\; a_{1}=1.0,\\; a_{2}=2.0,\\; a_{3}=4.0.\n$$\n\n模拟协议：\n- 使用 $N$ 个代理人和 $T$ 个时期。\n- 风险净回报率 $r_t$ 从 $r_t \\sim \\mathcal{N}(\\mu^\\star,\\sigma^2)$ 中抽取，且在时间 $t$ 上独立。\n- 为了可复现性，使用一个固定的伪随机数生成器种子：基础种子为 $12345$，由从零开始的测试用例索引 $k \\in \\{0,1,2,3\\}$ 进行偏移，因此用例 $k$ 的种子是 $12345 + k$。\n- 计算如上定义的 $\\bar{x}_{\\text{avg}}$。\n\n测试套件（每项都是一个参数元组 $(\\mu^\\star,\\sigma,R_f,\\gamma_{\\text{base}},\\alpha_{\\text{base}},N,T,L)$；所有回报率均为小数）：\n1. 用例 1: $(0.06,\\,0.15,\\,1.01,\\,3.0,\\,0.20,\\,200,\\,2000,\\,500)$。\n2. 用例 2: $(0.01,\\,0.15,\\,1.01,\\,3.0,\\,0.20,\\,200,\\,2000,\\,500)$。\n3. 用例 3: $(0.06,\\,0.20,\\,1.01,\\,3.0,\\,0.20,\\,200,\\,2000,\\,500)$。\n4. 用例 4: $(0.06,\\,0.15,\\,1.01,\\,6.0,\\,0.05,\\,200,\\,2000,\\,500)$。\n\n您的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，顺序与上述用例相同，例如\n$[r_1,r_2,r_3,r_4]$,\n其中每个 $r_k$ 是用例 $k$ 的 $\\bar{x}_{\\text{avg}}$ 的浮点数值，以小数（而非百分比）表示。您可以根据需要进行四舍五入或格式化，但请确保使用标准浮点格式，以便每个 $r_k$ 都可以被解析为浮点数。", "solution": "问题陈述经过严格验证，被认定为有效。这是一个计算经济学领域的良定问题，基于成熟的经济学理论，并为模拟提供了所有必要的参数和函数形式。该模型将一个标准的 Markowitz 式投资组合选择问题与一个自适应学习动态相结合，这是金融学中异质代理人模型的常见结构。不存在会妨碍获得唯一且有意义的解的科学上的不一致、矛盾或关键性的模糊之处。关于代理人索引 `i mod 4` 的次要模糊之处，通过采用标准的计算约定得以解决，即使用从基于一的代理人索引派生出的基于零的索引，也就是 `(i-1) mod 4`，这与提供的乘数索引 $\\{0,1,2,3\\}$ 相符。\n\n解决方案分两部分进行：首先，从第一性原理推导代理人的最优决策规则；其次，描述基于此规则构建的模拟算法。\n\n**第一部分：最优风险资产份额的推导**\n\n每个代理人 $i$ 选择其财富份额 $x_{i,t} \\in [0,1]$ 投资于风险资产，以最大化单期均值-方差目标。代理人投资组合的总回报率 $R_{p,i,t}$ 是安全资产总回报率 $R_f$ 和风险资产总回报率 $1+r_t$ 的加权平均值：\n$$\nR_{p,i,t} \\;=\\; (1-x_{i,t})R_f + x_{i,t}(1+r_t)\n$$\n这可以改写为风险资产相对于安全资产的超额回报率的形式：\n$$\nR_{p,i,t} \\;=\\; R_f + x_{i,t}(1+r_t - R_f) \\;=\\; R_f + x_{i,t}(r_t - (R_f-1))\n$$\n令 $r_f = R_f-1$ 为无风险净利率。\n$$\nR_{p,i,t} \\;=\\; R_f + x_{i,t}(r_t - r_f)\n$$\n代理人的决策是在时间 $t$、在 $r_t$ 未知的情况下做出的。因此，代理人使用基于其信念 $\\mu_{i,t}$ 和已知方差 $\\sigma^2$ 的主观期望 $E_t[\\cdot]$。预期的投资组合回报率为：\n$$\nE_t[R_{p,i,t}] \\;=\\; E_t[R_f + x_{i,t}(r_t - r_f)] \\;=\\; R_f + x_{i,t}(E_t[r_t] - r_f) \\;=\\; R_f + x_{i,t}(\\mu_{i,t} - r_f)\n$$\n投资组合回报率的方差为：\n$$\nVar_t(R_{p,i,t}) \\;=\\; Var_t(R_f + x_{i,t}(r_t - r_f)) \\;=\\; Var_t(x_{i,t}r_t) \\;=\\; x_{i,t}^2 Var_t(r_t) \\;=\\; x_{i,t}^2 \\sigma^2\n$$\n代理人 $i$ 的均值-方差目标函数是最大化：\n$$\nU(x_{i,t}) \\;=\\; E_t[R_{p,i,t}] - \\frac{\\gamma_i}{2} Var_t(R_{p,i,t})\n$$\n代入期望值和方差的表达式：\n$$\nU(x_{i,t}) \\;=\\; \\left( R_f + x_{i,t}(\\mu_{i,t} - r_f) \\right) - \\frac{\\gamma_i}{2} x_{i,t}^2 \\sigma^2\n$$\n这是关于 $x_{i,t}$ 的一个凹二次函数。为了找到最优的无约束份额 $x_{i,t}^*$，我们对 $x_{i,t}$ 求一阶导数并令其为零（最大化的一阶条件）：\n$$\n\\frac{\\mathrm{d}U}{\\mathrm{d}x_{i,t}} \\;=\\; (\\mu_{i,t} - r_f) - \\gamma_i \\sigma^2 x_{i,t} \\;=\\; 0\n$$\n求解 $x_{i,t}$：\n$$\nx_{i,t}^* \\;=\\; \\frac{\\mu_{i,t} - r_f}{\\gamma_i \\sigma^2} \\;=\\; \\frac{\\mu_{i,t} - (R_f - 1)}{\\gamma_i \\sigma^2}\n$$\n这是经典的默顿份额。分子代表感知到的风险资产的超额净回报率，分母是风险厌恶度与回报率方差的乘积。\n\n问题指定了无卖空和无杠杆约束，意味着 $x_{i,t}$ 必须位于区间 $[0,1]$ 内。最终的最优选择是无约束解 $x_{i,t}^*$ 在该可行集上的投影：\n$$\nx_{i,t} \\;=\\; \\max\\left(0, \\min\\left(1, x_{i,t}^*\\right)\\right)\n$$\n\n**第二部分：模拟算法**\n\n该模拟对一个由 $N$ 个异质代理人组成的群体在 $T$ 个离散时间周期内的经济行为进行建模。算法按以下步骤进行：\n\n1.  **初始化 (在 $t=0$):**\n    *   根据测试用例设置全局参数 $(\\mu^\\star, \\sigma, R_f, N, T, L)$ 和异质性基础参数 $(\\gamma_{\\text{base}}, \\alpha_{\\text{base}})$。\n    *   使用指定的种子初始化伪随机数生成器。\n    *   创建 $N$ 个代理人的群体。对每个代理人 $i \\in \\{1, \\dots, N\\}$，根据确定性周期分配异质性参数 $\\gamma_i$ 和 $\\alpha_i$。令 $j = (i-1) \\pmod 4$。然后：\n        $$\n        \\gamma_i \\;=\\; \\gamma_{\\text{base}} \\times m_j, \\quad \\text{其中 } m \\in \\{0.5, 1.0, 1.5, 2.0\\}\n        $$\n        $$\n        \\alpha_i \\;=\\; \\min(0.9, \\alpha_{\\text{base}} \\times a_j), \\quad \\text{其中 } a \\in \\{0.5, 1.0, 2.0, 4.0\\}\n        $$\n    *   为每个代理人 $i$ 设置初始状态变量：\n        *   初始财富：$W_{i,0} = 1$。\n        *   初始信念：$\\mu_{i,0} = R_f - 1$。\n\n2.  **时间循环 (对于 $t=0, 1, \\dots, T-1$):**\n    在每个时期 $t$ 执行以下步骤：\n    *   **a. 投资组合选择：** 每个代理人 $i$ 使用其当前信念 $\\mu_{i,t}$ 和从第一部分推导出的公式计算其最优风险资产配置 $x_{i,t}$。\n    *   **b. 聚合：** 计算经济体的财富加权总风险份额 $\\bar{x}_t$：\n        $$\n        \\bar{x}_t \\;=\\; \\frac{\\sum_{i=1}^{N} W_{i,t} \\, x_{i,t}}{\\sum_{i=1}^{N} W_{i,t}}\n        $$\n        如果当前时期 $t$ 处于最终平均窗口内，即 $t \\ge T-L$，则存储 $\\bar{x}_t$ 的值。\n    *   **c. 市场实现：** 从均值为 $\\mu^\\star$、方差为 $\\sigma^2$ 的正态分布中抽取风险资产的随机净回报率 $r_t$：$r_t \\sim \\mathcal{N}(\\mu^\\star, \\sigma^2)$。\n    *   **d. 状态更新：** 更新所有代理人的状态以反映时期 $t$ 的结果，为时期 $t+1$ 做准备：\n        *   财富演化：$W_{i,t+1} = W_{i,t} [ R_f (1-x_{i,t}) + (1+r_t) x_{i,t} ]$。\n        *   信念演化：$\\mu_{i,t+1} = \\mu_{i,t} + \\alpha_i (r_t - \\mu_{i,t})$。\n\n3.  **最终计算：**\n    模拟循环完成后，通过计算最后 $L$ 个时期存储的 $\\bar{x}_t$ 值的算术平均值，来计算最终输出 $\\bar{x}_{\\text{avg}}$：\n    $$\n    \\bar{x}_{\\text{avg}} \\;=\\; \\frac{1}{L} \\sum_{t=T-L}^{T-1} \\bar{x}_t\n    $$\n\n该算法使用 `numpy` 库的向量化操作实现，以确保计算效率。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(mu_star, sigma, R_f, gamma_base, alpha_base, N, T, L, seed):\n    \"\"\"\n    Runs a single simulation of the heterogeneous agent model.\n\n    Args:\n        mu_star (float): True mean of the risky asset net return.\n        sigma (float): True standard deviation of the risky asset net return.\n        R_f (float): Gross risk-free return.\n        gamma_base (float): Base risk-aversion coefficient.\n        alpha_base (float): Base learning rate.\n        N (int): Number of agents.\n        T (int): Number of time periods.\n        L (int): Number of last periods to average over.\n        seed (int): Seed for the pseudo-random number generator.\n\n    Returns:\n        float: The time average of the wealth-weighted risky share over the last L periods.\n    \"\"\"\n    # Initialize the pseudo-random number generator for reproducibility.\n    rng = np.random.default_rng(seed)\n\n    # Define heterogeneity multipliers\n    m_multipliers = np.array([0.5, 1.0, 1.5, 2.0])\n    a_multipliers = np.array([0.5, 1.0, 2.0, 4.0])\n\n    # Assign heterogeneous parameters to agents based on index-based cycles.\n    agent_indices_mod_4 = np.arange(N) % 4\n    gamma_i = gamma_base * m_multipliers[agent_indices_mod_4]\n    alpha_i = np.minimum(0.9, alpha_base * a_multipliers[agent_indices_mod_4])\n\n    # Initial state variables\n    r_f_net = R_f - 1.0\n    mu_i_t = np.full(N, r_f_net)\n    W_i_t = np.ones(N)\n    \n    # Pre-calculate constant variance\n    sigma2 = sigma**2\n\n    # Storage for results in the final averaging window\n    x_bar_history = []\n\n    # Simulation loop over T periods\n    for t in range(T):\n        # 1. Agents make portfolio choices\n        # Calculate unconstrained optimal share\n        x_i_t_star = (mu_i_t - r_f_net) / (gamma_i * sigma2)\n        # Apply no-short, no-leverage constraint [0, 1]\n        x_i_t = np.clip(x_i_t_star, 0.0, 1.0)\n        \n        # 2. Compute and store aggregate risky share if in the final L periods\n        if t >= T - L:\n            total_W_t = np.sum(W_i_t)\n            # Avoid division by zero, though unlikely with these parameters\n            if total_W_t > 0:\n                x_bar_t = np.sum(W_i_t * x_i_t) / total_W_t\n                x_bar_history.append(x_bar_t)\n            else:\n                 x_bar_history.append(0.0)\n\n        # 3. Realize the risky asset's net return for the period\n        r_t = rng.normal(loc=mu_star, scale=sigma)\n        \n        # 4. Update agent states for the next period\n        # Update wealth\n        portfolio_gross_return = R_f * (1.0 - x_i_t) + (1.0 + r_t) * x_i_t\n        W_i_t = W_i_t * portfolio_gross_return\n        # Update beliefs\n        mu_i_t = mu_i_t + alpha_i * (r_t - mu_i_t)\n\n    # 5. Final calculation: average of the stored aggregate shares\n    x_bar_avg = np.mean(x_bar_history) if x_bar_history else 0.0\n    \n    return x_bar_avg\n\ndef solve():\n    \"\"\"\n    Main function to run simulations for all test cases and print the results.\n    \"\"\"\n    _ = np.set_printoptions # Scipy and numpy are permitted; not used here.\n\n    # Test suite: (mu_star, sigma, R_f, gamma_base, alpha_base, N, T, L)\n    test_cases = [\n        (0.06, 0.15, 1.01, 3.0, 0.20, 200, 2000, 500),\n        (0.01, 0.15, 1.01, 3.0, 0.20, 200, 2000, 500),\n        (0.06, 0.20, 1.01, 3.0, 0.20, 200, 2000, 500),\n        (0.06, 0.15, 1.01, 6.0, 0.05, 200, 2000, 500),\n    ]\n\n    results = []\n    base_seed = 12345\n    for i, case in enumerate(test_cases):\n        mu_star, sigma, R_f, gamma_base, alpha_base, N, T, L = case\n        # Set seed based on test case index\n        seed = base_seed + i\n        result = run_simulation(mu_star, sigma, R_f, gamma_base, alpha_base, N, T, L, seed)\n        results.append(result)\n\n    # Format the output as a comma-separated list in brackets, with standard float precision.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "2399122"}]}