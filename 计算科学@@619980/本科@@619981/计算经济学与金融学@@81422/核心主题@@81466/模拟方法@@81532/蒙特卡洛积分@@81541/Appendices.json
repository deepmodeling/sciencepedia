{"hands_on_practices": [{"introduction": "蒙特卡洛积分的核心思想是用随机样本的平均值来近似复杂积分。这个练习将带你入门，通过一个材料科学中的具体场景，直接应用蒙特卡洛积分的基本公式来估算一个三维空间中的物质总量[@problem_id:1376816]。这有助于你直观地理解如何将抽象的积分问题转化为一个简单的平均值计算问题。", "problem": "一位材料科学家正在研究一种在边长为1米的立方体模具中制成的新合金。坐标系与该模具对齐，因此模具占据由 $0 \\le x \\le 1$、$0 \\le y \\le 1$ 和 $0 \\le z \\le 1$ 定义的区域。一种特殊硬化剂的浓度 $C$ 被发现仅在由不等式 $0 \\le z \\le y \\le x \\le 1$ 定义的模具特定子区域内非零。在该子区域内，点 $(x,y,z)$ 处的浓度由函数 $C(x,y,z) = k x y z$ 描述，其中 $k$ 是一个常数。在此区域之外，浓度为零。模具中该硬化剂的总质量由浓度函数在整个1立方米模具体积上的积分给出。\n\n为了估计这个总质量，一个自动化测量系统在一组 $N=5$ 个采样点上探测浓度，这些点被假定为单位立方体内均匀随机抽样的代表。这五个点的坐标是：\n$P_1 = (0.8, 0.7, 0.2)$\n$P_2 = (0.9, 0.5, 0.6)$\n$P_3 = (0.6, 0.8, 0.3)$\n$P_4 = (0.5, 0.4, 0.3)$\n$P_5 = (0.7, 0.9, 0.8)$\n\n给定浓度常数 $k = 4.8 \\text{ kg/m}^6$，请根据这五个采样点，计算模具中硬化剂总质量的数值估计值。请以千克 (kg) 为单位表示您的答案，并四舍五入到三位有效数字。", "solution": "总质量是浓度在单位立方体上的体积分：\n$$\nM=\\iiint_{[0,1]^{3}} C(x,y,z)\\,dV.\n$$\n在体积为 $V=1$ 的域上进行均匀随机抽样，使用 $N$ 个样本 $\\{P_{i}\\}_{i=1}^{N}$ 的蒙特卡洛估计量为\n$$\n\\widehat{M}=\\frac{V}{N}\\sum_{i=1}^{N} C(P_{i})=\\frac{1}{N}\\sum_{i=1}^{N} C(P_{i}).\n$$\n此处，如果 $0 \\le z \\le y \\le x \\le 1$，则 $C(x,y,z)=k\\,x y z$，否则 $C=0$。对每个样本评估条件 $0 \\le z \\le y \\le x \\le 1$：\n- $P_{1}=(0.8,0.7,0.2)$：$0.2 \\le 0.7 \\le 0.8 \\le 1$ 成立，因此贡献为 $k\\cdot 0.8\\cdot 0.7\\cdot 0.2=0.112\\,k$。\n- $P_{2}=(0.9,0.5,0.6)$：$0.6 \\le 0.5$ 不成立，贡献为 $0$。\n- $P_{3}=(0.6,0.8,0.3)$：$0.8 \\le 0.6$ 不成立，贡献为 $0$。\n- $P_{4}=(0.5,0.4,0.3)$：$0.3 \\le 0.4 \\le 0.5 \\le 1$ 成立，因此贡献为 $k\\cdot 0.5\\cdot 0.4\\cdot 0.3=0.06\\,k$。\n- $P_{5}=(0.7,0.9,0.8)$：$0.9 \\le 0.7$ 不成立，贡献为 $0$。\n因此\n$$\n\\sum_{i=1}^{5} C(P_{i})=(0.112+0.06)\\,k=0.172\\,k,\n$$\n并且\n$$\n\\widehat{M}=\\frac{1}{5}\\cdot 0.172\\,k=0.0344\\,k.\n$$\n代入 $k=4.8$ 可得\n$$\n\\widehat{M}=0.0344\\times 4.8=0.16512,\n$$\n四舍五入到三位有效数字后为 $0.165$ 千克。", "answer": "$$\\boxed{0.165}$$", "id": "1376816"}, {"introduction": "蒙特卡洛方法的应用远不止于计算传统积分，它在估算概率方面也同样强大，因为概率本身就可以看作是对某个事件指示函数的积分。这个经典的“断棍问题”练习[@problem_id:1376854]，将引导你通过模拟随机事件来估算一个几何概率。通过这个实践，你将体会到如何将一个概率问题转化为蒙特卡洛模拟，并理解样本数量如何影响估计的精度。", "problem": "一位材料科学家正在研究一种新型聚合物纤维的断裂力学的统计特性。作为一个简化模型，他们考虑一根单位长度的纤维，其在受到应力作用后会在两个不同的点上断裂。这两个断裂点的位置，记为 $X_1$ 和 $X_2$，被建模为服从区间 $[0, 1]$ 上均匀分布的独立随机变量。\n\n这两次断裂将纤维分成了三个更小的片段。该科学家旨在确定这三个片段能够组成一个三角形的概率 $P$。为此，他们采用蒙特卡洛模拟。该模拟生成了大量的随机断裂点对 $(X_1, X_2)$，并对每一对点计算出所产生的三个片段的长度。然后，它会检查这些长度是否满足三角形不等式，即三角形任意两边之和必须大于第三边。\n\n该模拟总共运行了 $N = 2,500,000$ 次试验。实验日志中记录的、片段能构成有效三角形的试验次数为 $N_{\\text{success}} = 624,875$。\n\n根据这次特定的蒙特卡洛模拟结果，计算估计概率 $P$。将你的答案以小数形式报告，并四舍五入到四位有效数字。", "solution": "概率的蒙特卡洛估计值是成功试验次数与总试验次数之比。将估计量定义为\n$$\n\\hat{P}=\\frac{N_{\\text{success}}}{N}.\n$$\n代入给定的计数值，\n$$\n\\hat{P}=\\frac{624875}{2500000}.\n$$\n将分子和分母同除以 $125$ 来约简分数：\n$$\n\\frac{624875}{2500000}=\\frac{125\\cdot 4999}{125\\cdot 20000}=\\frac{4999}{20000}=0.24995.\n$$\n将 $0.24995$ 四舍五入到四位有效数字，得到 $0.2500$。", "answer": "$$\\boxed{0.2500}$$", "id": "1376854"}, {"introduction": "虽然基本的蒙特卡洛积分简单直观，但其收敛速度可能较慢。为了提高计算效率，研究者们发展了重要性采样等方差缩减技术。这个练习[@problem_id:2414609]将深入探讨重要性采样的核心原理及其潜在的陷阱，通过分析不同采样分布对估计结果方差的影响，你会发现一个精心选择的采样分布可以极大提高效率，而一个糟糕的选择甚至可能比基本方法更差。这是从“会用”到“用好”蒙特卡洛方法的关键一步。", "problem": "考虑一个非负被积函数在有限区间上的积分。设目标积分为\n$$\nI = \\int_{0}^{1} f(x)\\,dx,\n$$\n其中 $f(x) = x^{m}$，对于一个满足 $m > -1$ 的固定指数 $m$。定义原始蒙特卡洛估计量为随机变量 $Y_{\\mathrm{c}} = f(U)$，其中 $U \\sim \\mathrm{Uniform}(0,1)$；并定义使用概率密度函数 $p(x)$（在 $[0,1]$ 上）的重要性抽样估计量为 $Y_{\\mathrm{is}} = f(X)/p(X)$，其中 $X \\sim p$。根据定义，这些无偏估计量的方差为\n$$\n\\mathrm{Var}(Y_{\\mathrm{c}}) = \\mathbb{E}[Y_{\\mathrm{c}}^{2}] - I^{2}, \\qquad \\mathrm{Var}(Y_{\\mathrm{is}}) = \\mathbb{E}[Y_{\\mathrm{is}}^{2}] - I^{2}.\n$$\n对于重要性抽样密度，考虑在 $[0,1]$ 上参数为 $\\alpha > 0$ 和 $\\beta > 0$ 的贝塔分布，\n$$\np(x) = \\frac{x^{\\alpha - 1}(1 - x)^{\\beta - 1}}{B(\\alpha,\\beta)},\n$$\n其中 $B(\\alpha,\\beta)$ 是贝塔函数。假设参数的选择使所有量均为有限值；特别是，假设 $\\beta < 2$ 和 $\\alpha < 2m + 2$ 以确保 $\\mathbb{E}[Y_{\\mathrm{is}}^{2}]$ 存在。\n\n对于以下测试套件中的每个参数集 $(m,\\alpha,\\beta)$，计算比率\n$$\nr = \\frac{\\mathrm{Var}(Y_{\\mathrm{is}})}{\\mathrm{Var}(Y_{\\mathrm{c}})},\n$$\n并按指定格式生成结果。\n\n测试套件（每个三元组为 $(m,\\alpha,\\beta)$）：\n\n- 情况 $1$：$(2,\\tfrac{1}{2},\\tfrac{3}{2})$。\n- 情况 $2$：$(2,1,1)$。\n- 情况 $3$：$(2,\\tfrac{5}{2},1)$。\n- 情况 $4$：$(2,3,1)$。\n\n最终输出格式：您的程序应生成单行输出，其中包含按上述顺序列出的各个情况的结果，形式为方括号括起来的逗号分隔列表（例如，$[r_{1},r_{2}]$）。每个数字必须四舍五入到 $6$ 位小数。不应打印任何额外文本。", "solution": "该问题要求计算比率 $r = \\mathrm{Var}(Y_{\\mathrm{is}})/\\mathrm{Var}(Y_{\\mathrm{c}})$，其中 $\\mathrm{Var}(Y_{\\mathrm{c}})$ 是原始蒙特卡洛估计量的方差，$\\mathrm{Var}(Y_{\\mathrm{is}})$ 是针对积分 $I = \\int_{0}^{1} f(x)\\,dx$（其中 $f(x) = x^{m}$）的重要性抽样估计量的方差。分析过程首先为每个方差推导解析表达式。\n\n首先，我们计算积分 $I$ 的精确值。对于 $m > -1$：\n$$\nI = \\int_{0}^{1} x^{m} \\, dx = \\left[ \\frac{x^{m+1}}{m+1} \\right]_{0}^{1} = \\frac{1}{m+1}\n$$\n\n接下来，我们推导原始蒙特卡洛估计量 $Y_{\\mathrm{c}} = f(U) = U^m$ 的方差，其中 $U \\sim \\mathrm{Uniform}(0,1)$。方差定义为 $\\mathrm{Var}(Y_{\\mathrm{c}}) = \\mathbb{E}[Y_{\\mathrm{c}}^{2}] - I^{2}$。其二阶矩 $\\mathbb{E}[Y_{\\mathrm{c}}^{2}]$为：\n$$\n\\mathbb{E}[Y_{\\mathrm{c}}^{2}] = \\mathbb{E}[(U^m)^2] = \\mathbb{E}[U^{2m}] = \\int_{0}^{1} u^{2m} \\cdot 1 \\, du = \\frac{1}{2m+1}\n$$\n这要求 $2m+1 > 0$，即 $m > -1/2$。给定的条件 $m > -1$ 和测试用例 $m=2$ 满足此要求。因此，方差为：\n$$\n\\mathrm{Var}(Y_{\\mathrm{c}}) = \\frac{1}{2m+1} - \\left(\\frac{1}{m+1}\\right)^2 = \\frac{(m+1)^2 - (2m+1)}{(2m+1)(m+1)^2} = \\frac{m^2 + 2m + 1 - 2m - 1}{(2m+1)(m+1)^2} = \\frac{m^2}{(2m+1)(m+1)^2}\n$$\n\n现在，我们推导重要性抽样估计量 $Y_{\\mathrm{is}} = f(X)/p(X)$ 的方差，其中 $X$ 从密度为 $p(x) = x^{\\alpha - 1}(1 - x)^{\\beta - 1} / B(\\alpha, \\beta)$ 的贝塔分布中抽取。方差为 $\\mathrm{Var}(Y_{\\mathrm{is}}) = \\mathbb{E}[Y_{\\mathrm{is}}^{2}] - I^{2}$。其二阶矩 $\\mathbb{E}[Y_{\\mathrm{is}}^{2}]$ 计算如下：\n$$\n\\mathbb{E}[Y_{\\mathrm{is}}^{2}] = \\int_{0}^{1} \\left(\\frac{f(x)}{p(x)}\\right)^2 p(x) \\, dx = \\int_{0}^{1} \\frac{f(x)^2}{p(x)} \\, dx\n$$\n代入 $f(x) = x^m$ 和密度 $p(x)$：\n$$\n\\mathbb{E}[Y_{\\mathrm{is}}^{2}] = \\int_{0}^{1} \\frac{(x^m)^2}{\\frac{x^{\\alpha - 1}(1 - x)^{\\beta - 1}}{B(\\alpha, \\beta)}} \\, dx = B(\\alpha, \\beta) \\int_{0}^{1} x^{2m - \\alpha + 1} (1 - x)^{1 - \\beta} \\, dx\n$$\n该积分为一个贝塔函数积分，$B(a,b) = \\int_0^1 t^{a-1}(1-t)^{b-1}dt$。我们相应地重写被积函数的指数：\n$$\n\\mathbb{E}[Y_{\\mathrm{is}}^{2}] = B(\\alpha, \\beta) \\int_{0}^{1} x^{(2m - \\alpha + 2) - 1} (1 - x)^{(2 - \\beta) - 1} \\, dx\n$$\n该积分等于 $B(2m - \\alpha + 2, 2 - \\beta)$。问题约束条件 $\\alpha < 2m + 2$ 和 $\\beta < 2$ 保证了该积分的存在性。因此，二阶矩为：\n$$\n\\mathbb{E}[Y_{\\mathrm{is}}^{2}] = B(\\alpha, \\beta) B(2m - \\alpha + 2, 2 - \\beta)\n$$\n重要性抽样估计量的方差为：\n$$\n\\mathrm{Var}(Y_{\\mathrm{is}}) = B(\\alpha, \\beta) B(2m - \\alpha + 2, 2 - \\beta) - \\frac{1}{(m+1)^2}\n$$\n\n最后，比率 $r$ 由通用公式给出：\n$$\nr = \\frac{\\mathrm{Var}(Y_{\\mathrm{is}})}{\\mathrm{Var}(Y_{\\mathrm{c}})} = \\frac{B(\\alpha, \\beta) B(2m - \\alpha + 2, 2 - \\beta) - \\frac{1}{(m+1)^2}}{\\frac{m^2}{(2m+1)(m+1)^2}}\n$$\n\n对于所有测试用例，指数均为 $m=2$。我们可以将公式具体化：\n$I = \\frac{1}{2+1} = \\frac{1}{3}$。\n$\\mathrm{Var}(Y_{\\mathrm{c}}) = \\frac{2^2}{(2(2)+1)(2+1)^2} = \\frac{4}{5 \\cdot 9} = \\frac{4}{45}$。\n对于 $m=2$，比率 $r$ 变为：\n$$\nr = \\frac{B(\\alpha, \\beta) B(6 - \\alpha, 2 - \\beta) - \\frac{1}{9}}{\\frac{4}{45}} = \\frac{45}{4} \\left( B(\\alpha, \\beta) B(6 - \\alpha, 2 - \\beta) - \\frac{1}{9} \\right)\n$$\n\n现在我们为每个测试用例计算该比率。\n\n情况 1：$(m,\\alpha,\\beta) = (2, \\frac{1}{2}, \\frac{3}{2})$。\n我们有 $\\alpha = 0.5$ 和 $\\beta = 1.5$。\n$r = \\frac{45}{4} \\left( B(0.5, 1.5) B(5.5, 0.5) - \\frac{1}{9} \\right)$。\n使用关系式 $B(x,y) = \\frac{\\Gamma(x)\\Gamma(y)}{\\Gamma(x+y)}$：\n$B(0.5, 1.5) = B(\\frac{1}{2}, \\frac{3}{2}) = \\frac{\\Gamma(1/2)\\Gamma(3/2)}{\\Gamma(2)} = \\frac{\\sqrt{\\pi} \\cdot (1/2)\\sqrt{\\pi}}{1!} = \\frac{\\pi}{2}$。\n$B(5.5, 0.5) = B(\\frac{11}{2}, \\frac{1}{2}) = \\frac{\\Gamma(11/2)\\Gamma(1/2)}{\\Gamma(6)} = \\frac{(945/32)\\sqrt{\\pi} \\cdot \\sqrt{\\pi}}{5!} = \\frac{945\\pi}{32 \\cdot 120} = \\frac{63\\pi}{256}$。\n$r = \\frac{45}{4} \\left( \\frac{\\pi}{2} \\cdot \\frac{63\\pi}{256} - \\frac{1}{9} \\right) = \\frac{45}{4} \\frac{63\\pi^2}{512} - \\frac{45}{36} = \\frac{2835\\pi^2}{2048} - \\frac{5}{4} = \\frac{2835\\pi^2 - 2560}{2048}$。\n其数值约为 $12.408172$。\n\n情况 2：$(m,\\alpha,\\beta) = (2, 1, 1)$。\n此处，$\\alpha=1, \\beta=1$，因此 $p(x) = \\frac{x^0(1-x)^0}{B(1,1)} = 1$，即均匀分布。重要性抽样方案与原始蒙特卡洛方案相同。因此，$\\mathrm{Var}(Y_{\\mathrm{is}}) = \\mathrm{Var}(Y_{\\mathrm{c}})$，比率 $r$ 必须为 $1$。\n用公式验证：\n$r = \\frac{45}{4} \\left( B(1, 1) B(5, 1) - \\frac{1}{9} \\right) = \\frac{45}{4} \\left( 1 \\cdot \\frac{1}{5} - \\frac{1}{9} \\right) = \\frac{45}{4} \\left( \\frac{1}{5} - \\frac{1}{9} \\right) = \\frac{45}{4} \\left( \\frac{9-5}{45} \\right) = \\frac{45}{4} \\frac{4}{45} = 1$。\n\n情况 3：$(m,\\alpha,\\beta) = (2, \\frac{5}{2}, 1)$。\n我们有 $\\alpha = 2.5$ 和 $\\beta = 1$。$B(a,1)$ 的公式是 $1/a$。\n$r = \\frac{45}{4} \\left( B(2.5, 1) B(3.5, 1) - \\frac{1}{9} \\right) = \\frac{45}{4} \\left( \\frac{1}{2.5} \\cdot \\frac{1}{3.5} - \\frac{1}{9} \\right) = \\frac{45}{4} \\left( \\frac{2}{5} \\cdot \\frac{2}{7} - \\frac{1}{9} \\right)$。\n$r = \\frac{45}{4} \\left( \\frac{4}{35} - \\frac{1}{9} \\right) = \\frac{45}{4} \\left( \\frac{36 - 35}{315} \\right) = \\frac{45}{4 \\cdot 315} = \\frac{1}{4 \\cdot 7} = \\frac{1}{28}$。\n其数值约为 $0.035714$。\n\n情况 4：$(m,\\alpha,\\beta) = (2, 3, 1)$。\n此处，$\\alpha = 3$ 且 $\\beta = 1$。抽样密度为 $p(x) = \\frac{x^{3-1}}{B(3,1)} = \\frac{x^2}{1/3} = 3x^2$。被积函数为 $f(x)=x^2$。由于 $p(x) \\propto f(x)$，估计量 $Y_{\\mathrm{is}} = \\frac{f(X)}{p(X)} = \\frac{X^2}{3X^2} = \\frac{1}{3}$ 是一个常数。常数的方差为零。因此，$r=0$。\n用公式验证：\n$r = \\frac{45}{4} \\left( B(3, 1) B(3, 1) - \\frac{1}{9} \\right) = \\frac{45}{4} \\left( \\frac{1}{3} \\cdot \\frac{1}{3} - \\frac{1}{9} \\right) = \\frac{45}{4} \\left( \\frac{1}{9} - \\frac{1}{9} \\right) = 0$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import beta\n\ndef solve():\n    \"\"\"\n    Computes the ratio of variances for importance sampling vs. crude Monte Carlo\n    for the integral of f(x) = x^m from 0 to 1.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (2, 0.5, 1.5),  # Case 1\n        (2, 1, 1),      # Case 2\n        (2, 2.5, 1),    # Case 3\n        (2, 3, 1)       # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        m, alpha, beta_p = case\n\n        # General formula for the variance of the crude Monte Carlo estimator.\n        # Var(Y_c) = E[f(U)^2] - I^2 = integral(x^(2m))dx - (integral(x^m)dx)^2\n        #          = 1/(2m+1) - 1/((m+1)^2)\n        #          = m^2 / ((2m+1)*(m+1)^2)\n        var_c = m**2 / ((2 * m + 1) * (m + 1)**2)\n\n        # General formula for the variance of the importance sampling estimator.\n        # Var(Y_is) = E[(f(X)/p(X))^2] - I^2 = integral(f(x)^2/p(x))dx - I^2\n        #           = B(alpha, beta) * B(2m - alpha + 2, 2 - beta) - 1/((m+1)^2)\n        # The conditions m > -1, alpha > 0, beta > 0, alpha < 2m+2, beta < 2 are met.\n        term1 = beta(alpha, beta_p)\n        term2 = beta(2 * m - alpha + 2, 2 - beta_p)\n        var_is = term1 * term2 - 1 / ((m + 1)**2)\n        \n        # The ratio r = Var(Y_is) / Var(Y_c).\n        # var_c is non-zero since m=2 is used in all test cases.\n        ratio = var_is / var_c\n        \n        results.append(ratio)\n\n    # Format the results to 6 decimal places as required.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2414609"}]}