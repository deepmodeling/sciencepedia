{"hands_on_practices": [{"introduction": "分层抽样是一种强大的“分而治之”策略，用于提高蒙特卡洛积分的效率。其核心思想是将积分区间划分为若干个互不重叠的子区间（即“层”），并从每个层中独立抽取样本。通过确保样本在整个定义域内更均匀地分布，该方法可以显著降低估计的方差，特别是当被积函数在不同区域表现出不同行为时。本练习将通过一个具体数值计算，引导你完成分层抽样的完整流程。[@problem_id:1348949]", "problem": "一位计算科学家受命使用蒙特卡洛模拟来估计定积分 $I = \\int_0^\\pi x \\sin(x) dx$ 的值。为减小估计值相对于简单蒙特卡洛方法的方差，他选择了分层抽样的方法。积分域 $[0, \\pi]$ 被划分为两个等宽的层：$S_1 = [0, \\pi/2]$ 和 $S_2 = [\\pi/2, \\pi]$。\n\n将从每个层中抽取两个样本，总共四个样本。从一个标准均匀随机数 $r \\in [0, 1]$ 在层 $[a, b]$ 内生成样本 $u$ 的变换由 $u = a + (b-a)r$ 给出。\n\n假设为这项任务生成的四个标准均匀随机数序列是 $0.20$、$0.70$、$0.40$ 和 $0.90$。前两个随机数用于从层 $S_1$ 生成样本，后两个用于层 $S_2$。\n\n计算积分 $I$ 的分层抽样估计值。所有涉及角度的计算都必须以弧度为单位进行。报告你的最终答案，并四舍五入到四位有效数字。", "solution": "我们通过分层抽样来估计 $I=\\int_{0}^{\\pi}x\\sin(x)\\,dx$，其中有两个层 $S_{1}=[0,\\pi/2]$ 和 $S_{2}=[\\pi/2,\\pi]$，每层的宽度为 $L_{1}=L_{2}=\\pi/2$。每层有 $n_{1}=n_{2}=2$ 个样本，分层估计量为\n$$\n\\hat{I}=\\sum_{h=1}^{2}L_{h}\\,\\frac{1}{n_{h}}\\sum_{i=1}^{n_{h}}f(u_{hi})\n=\\frac{\\pi}{2}\\cdot\\frac{1}{2}\\left(\\sum_{i=1}^{2}f(u_{1i})+\\sum_{i=1}^{2}f(u_{2i})\\right)\n=\\frac{\\pi}{4}\\sum_{k=1}^{4}x_{k}\\sin(x_{k}),\n$$\n其中 $f(x)=x\\sin(x)$，$x_{k}$ 是抽样点。\n\n在 $[a,b]$ 内的抽样变换是 $u=a+(b-a)r$。使用给定的 $r$ 值，我们得到：\n$$\n\\begin{aligned}\n&\\text{在 }S_{1}=[0,\\tfrac{\\pi}{2}]\\text{ 中:} &&x_{1}=0+\\tfrac{\\pi}{2}\\cdot 0.20=\\tfrac{\\pi}{10},\\quad x_{2}=0+\\tfrac{\\pi}{2}\\cdot 0.70=\\tfrac{7\\pi}{20},\\\\\n&\\text{在 }S_{2}=[\\tfrac{\\pi}{2},\\pi]\\text{ 中:} &&x_{3}=\\tfrac{\\pi}{2}+\\tfrac{\\pi}{2}\\cdot 0.40=\\tfrac{7\\pi}{10},\\quad x_{4}=\\tfrac{\\pi}{2}+\\tfrac{\\pi}{2}\\cdot 0.90=\\tfrac{19\\pi}{20}.\n\\end{aligned}\n$$\n因此\n$$\n\\hat{I}=\\frac{\\pi}{4}\\left[\\tfrac{\\pi}{10}\\sin\\!\\left(\\tfrac{\\pi}{10}\\right)+\\tfrac{7\\pi}{20}\\sin\\!\\left(\\tfrac{7\\pi}{20}\\right)+\\tfrac{7\\pi}{10}\\sin\\!\\left(\\tfrac{7\\pi}{10}\\right)+\\tfrac{19\\pi}{20}\\sin\\!\\left(\\tfrac{19\\pi}{20}\\right)\\right].\n$$\n在可能的情况下使用精确的三角函数值，\n$$\n\\sin\\!\\left(\\tfrac{\\pi}{10}\\right)=\\frac{\\sqrt{5}-1}{4},\\qquad \\sin\\!\\left(\\tfrac{7\\pi}{10}\\right)=\\sin\\!\\left(\\tfrac{3\\pi}{10}\\right)=\\frac{\\sqrt{5}+1}{4},\n$$\n并对其他值进行数值评估（以弧度为单位），\n$$\n\\sin\\!\\left(\\tfrac{7\\pi}{20}\\right)\\approx 0.8910065241883679,\\qquad \\sin\\!\\left(\\tfrac{19\\pi}{20}\\right)\\approx 0.1564344650402309.\n$$\n计算函数值：\n$$\n\\begin{aligned}\nf(x_{1})&=\\tfrac{\\pi}{10}\\cdot\\frac{\\sqrt{5}-1}{4}\\approx 0.0970805519362733,\\\\\nf(x_{2})&=\\tfrac{7\\pi}{20}\\cdot 0.8910065241883679\\approx 0.9797128427417635,\\\\\nf(x_{3})&=\\tfrac{7\\pi}{10}\\cdot\\frac{\\sqrt{5}+1}{4}\\approx 1.7791212923103408,\\\\\nf(x_{4})&=\\tfrac{19\\pi}{20}\\cdot 0.1564344650402309\\approx 0.4668824448524499.\n\\end{aligned}\n$$\n将这些值相加得到\n$$\n\\sum_{k=1}^{4}f(x_{k})\\approx 3.3227971318408276,\n$$\n因此\n$$\n\\hat{I}=\\frac{\\pi}{4}\\cdot 3.3227971318408276\\approx 2.609718764690095.\n$$\n四舍五入到四位有效数字得到 $2.610$。（作为参考，精确的积分值为 $I=\\pi$，因此分层估计是合理的。）", "answer": "$$\\boxed{2.610}$$", "id": "1348949"}, {"introduction": "控制变量法利用一个与我们目标估计量相关且期望已知的随机变量来降低方差。这种方法的巧妙之处在于，它通过从原始估计量中减去这个“控制变量”的已知偏差的某个倍数，来修正样本的随机波动。本练习不仅是简单应用，而是要求你推导出理论上最优的混合系数 $b^*$，从而揭示该方法背后的数学原理，并加深对协方差与方差在优化估计中作用的理解。[@problem_id:1348947]", "problem": "在蒙特卡洛方法中，一项常见的任务是估计积分 $I = \\int_a^b g(x) dx$ 的值。这通常通过将积分重新表述为一个期望值 $E[f(X)]$ 来实现，其中 $X$ 是一个随机变量，$f$ 是一个相关函数。一个标准的“原始”蒙特卡洛估计量随后使用 $f(X_i)$ 的 $N$ 次独立抽样的样本均值。\n\n为了在给定样本数量的情况下提高估计的精度，可以采用方差缩减技术。其中一种技术是控制变量法。该方法涉及寻找一个与 $f(X)$ 相关且具有已知期望 $\\mu_C = E[C]$ 的随机变量 $C$。然后构造一个新的、改进的估计量 $Z(b) = f(X) - b(C - \\mu_C)$，其中 $b$ 是一个常系数。选择 $b$ 的值以最小化 $Z(b)$ 的方差。这个最优系数记为 $b^*$，由以下公式给出：\n$$b^* = \\frac{\\text{Cov}(f(X), C)}{\\text{Var}(C)}$$\n\n考虑估计积分 $I = \\int_0^1 \\cos\\left(\\frac{\\pi x}{2}\\right) dx$ 的问题。这等价于求 $Y = \\cos\\left(\\frac{\\pi X}{2}\\right)$ 的期望值，其中 $X$ 是在区间 $[0, 1]$ 上均匀分布的随机变量。我们将使用随机变量 $C = X$ 作为控制变量，因为它与 $Y$ 相关，并且其性质很容易确定。\n\n你的任务是计算此控制变量的最优系数 $b^*$ 的精确理论值。将你的答案表示为关于 $\\pi$ 的单一闭式解析表达式。", "solution": "我们有 $X \\sim \\text{Unif}[0,1]$，$Y=\\cos\\left(\\frac{\\pi X}{2}\\right)$，以及 $C=X$。最优控制变量系数为\n$$\nb^{*}=\\frac{\\text{Cov}(Y,C)}{\\text{Var}(C)}.\n$$\n首先计算 $\\text{Var}(C)$。使用 $E[X]=\\int_{0}^{1}x\\,dx=\\frac{1}{2}$ 和 $E[X^{2}]=\\int_{0}^{1}x^{2}\\,dx=\\frac{1}{3}$，我们得到\n$$\n\\text{Var}(C)=E[X^{2}]-\\left(E[X]\\right)^{2}=\\frac{1}{3}-\\frac{1}{4}=\\frac{1}{12}.\n$$\n接下来计算 $E[Y]$：\n$$\nE[Y]=\\int_{0}^{1}\\cos\\left(\\frac{\\pi x}{2}\\right)\\,dx=\\left.\\frac{2}{\\pi}\\sin\\left(\\frac{\\pi x}{2}\\right)\\right|_{0}^{1}=\\frac{2}{\\pi}.\n$$\n现在计算 $E[CY]=E\\!\\left[X\\cos\\left(\\frac{\\pi X}{2}\\right)\\right]$。令 $a=\\frac{\\pi}{2}$。则\n$$\nE[CY]=\\int_{0}^{1}x\\cos(ax)\\,dx.\n$$\n使用分部积分法，令 $u=x$，$dv=\\cos(ax)\\,dx$，则 $du=dx$ 且 $v=\\frac{1}{a}\\sin(ax)$，我们得到\n$$\n\\int x\\cos(ax)\\,dx=\\frac{x\\sin(ax)}{a}+\\frac{\\cos(ax)}{a^{2}}.\n$$\n从 $0$ 到 $1$ 求值，\n$$\n\\int_{0}^{1}x\\cos(ax)\\,dx=\\frac{\\sin(a)}{a}+\\frac{\\cos(a)-1}{a^{2}}.\n$$\n当 $a=\\frac{\\pi}{2}$ 时，我们有 $\\sin(a)=1$ 和 $\\cos(a)=0$，因此\n$$\nE[CY]=\\frac{1}{a}-\\frac{1}{a^{2}}=\\frac{2}{\\pi}-\\frac{4}{\\pi^{2}}.\n$$\n因此，\n$$\n\\text{Cov}(Y,C)=E[CY]-E[Y]E[C]=\\left(\\frac{2}{\\pi}-\\frac{4}{\\pi^{2}}\\right)-\\left(\\frac{2}{\\pi}\\right)\\left(\\frac{1}{2}\\right)=\\frac{1}{\\pi}-\\frac{4}{\\pi^{2}}=\\frac{\\pi-4}{\\pi^{2}}.\n$$\n最后，\n$$\nb^{*}=\\frac{\\text{Cov}(Y,C)}{\\text{Var}(C)}=\\frac{\\frac{\\pi-4}{\\pi^{2}}}{\\frac{1}{12}}=\\frac{12(\\pi-4)}{\\pi^{2}}.\n$$", "answer": "$$\\boxed{\\frac{12(\\pi - 4)}{\\pi^{2}}}$$", "id": "1348947"}, {"introduction": "重要性抽样是一种极为强大的技术，尤其在处理涉及罕见事件或函数在某些“重要”区域贡献了大部分值的复杂问题时。它通过改变原始的抽样分布，将样本有偏地集中在这些关键区域，然后用一个权重来修正这个偏差。此高级练习将挑战你寻找一个“完美”的提议分布，该分布在理论上能将估计量的方差降至零，这不仅是一个有趣的数学推导，更展示了重要性抽样方法的终极潜力。[@problem_id:2446710]", "problem": "考虑一个在计算经济学和金融学相关的蒙特卡洛设置下，计算一个正态分布随机变量的指数的期望的任务。设 $X \\sim \\mathcal{N}(0, 100)$，并定义 $h(x) = \\exp(x)$。你将使用一个由 $Y \\sim \\mathcal{N}(\\mu, 100)$ 给出的建议分布 $Q$（其中 $\\mu \\in \\mathbb{R}$ 是一个未知的位移参数），通过重要性采样来估计量 $\\mathbb{E}[\\exp(X)]$。令 $p(x)$ 和 $q_{\\mu}(x)$ 分别表示 $\\mathcal{N}(0, 100)$ 和 $\\mathcal{N}(\\mu, 100)$ 的概率密度函数。基于从 $q_{\\mu}$ 中抽取的 $n$ 个独立同分布样本 $\\{Y_i\\}_{i=1}^{n}$，其重要性采样估计量为\n$$\nI_n(\\mu) \\;=\\; \\frac{1}{n}\\sum_{i=1}^{n} h(Y_i)\\, w_{\\mu}(Y_i), \\quad \\text{其中 } w_{\\mu}(y) \\;=\\; \\frac{p(y)}{q_{\\mu}(y)}.\n$$\n从第一性原理出发，不援引任何特定的方差缩减公式，完成以下操作：\n1. 推导 $\\mathbb{E}[\\exp(X)]$ 的闭式表达式。\n2. 推导 $\\operatorname{Var}_{q_{\\mu}}(h(Y)\\,w_{\\mu}(Y))$ 作为 $\\mu$ 的函数，并找出在 $\\mu \\in \\mathbb{R}$ 上使该方差最小化的值 $\\mu^{\\star}$。\n\n将你的最终答案以一个有序对的形式给出，该有序对由 $\\mathbb{E}[\\exp(X)]$ 的精确值和最优位移 $\\mu^{\\star}$ 组成。无需进行数值四舍五入，你的答案应为精确值且不带单位。", "solution": "我们首先回顾一下定义。目标分布为 $X \\sim \\mathcal{N}(0, 100)$，其密度函数为\n$$\np(x) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\, \\sigma}\\,\\exp\\!\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right), \\quad \\sigma^{2} = 100,\n$$\n建议分布为 $Y \\sim \\mathcal{N}(\\mu, 100)$，其密度函数为\n$$\nq_{\\mu}(x) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\, \\sigma}\\,\\exp\\!\\left(-\\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right), \\quad \\sigma^{2} = 100.\n$$\n重要性权重为 $w_{\\mu}(x) = p(x)/q_{\\mu}(x)$。\n\n步骤 1：以闭式形式计算 $\\mathbb{E}[\\exp(X)]$。根据定义，\n$$\n\\mathbb{E}[\\exp(X)] \\;=\\; \\int_{-\\infty}^{\\infty} \\exp(x)\\, p(x)\\, dx \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\, \\sigma} \\int_{-\\infty}^{\\infty} \\exp\\!\\left(x - \\frac{x^{2}}{2\\sigma^{2}}\\right) dx.\n$$\n对指数部分进行配方。写出\n$$\nx - \\frac{x^{2}}{2\\sigma^{2}} \\;=\\; -\\frac{1}{2\\sigma^{2}}\\left(x^{2} - 2\\sigma^{2} x \\right) \\;=\\; -\\frac{1}{2\\sigma^{2}}\\left[(x - \\sigma^{2})^{2} - \\sigma^{4}\\right] \\;=\\; -\\frac{(x - \\sigma^{2})^{2}}{2\\sigma^{2}} + \\frac{\\sigma^{2}}{2}.\n$$\n因此，\n$$\n\\mathbb{E}[\\exp(X)] \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\, \\sigma} \\exp\\!\\left(\\frac{\\sigma^{2}}{2}\\right) \\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{(x - \\sigma^{2})^{2}}{2\\sigma^{2}}\\right) dx \\;=\\; \\exp\\!\\left(\\frac{\\sigma^{2}}{2}\\right),\n$$\n因为该积分等于 $\\sqrt{2\\pi}\\, \\sigma$。当 $\\sigma^{2} = 100$ 时，我们得到\n$$\n\\mathbb{E}[\\exp(X)] \\;=\\; \\exp(50).\n$$\n\n步骤 2：推导 $\\operatorname{Var}_{q_{\\mu}}(h(Y)\\, w_{\\mu}(Y))$ 并在 $\\mu$ 上对其进行最小化。注意到\n$$\n\\operatorname{Var}_{q_{\\mu}}(h(Y)\\, w_{\\mu}(Y)) \\;=\\; \\mathbb{E}_{q_{\\mu}}\\!\\left[h(Y)^{2}\\, w_{\\mu}(Y)^{2}\\right] \\;-\\; \\left(\\mathbb{E}[\\exp(X)]\\right)^{2}.\n$$\n第二项不依赖于 $\\mu$，因此在 $\\mu$ 上最小化方差等价于最小化二阶矩\n$$\nM(\\mu) \\;=\\; \\mathbb{E}_{q_{\\mu}}\\!\\left[h(Y)^{2}\\, w_{\\mu}(Y)^{2}\\right] \\;=\\; \\int_{-\\infty}^{\\infty} \\exp(2x)\\, \\frac{p(x)^{2}}{q_{\\mu}(x)}\\, dx.\n$$\n使用 $p$ 和 $q_{\\mu}$ 的显式形式以及共同的方差 $\\sigma^{2}$，\n$$\n\\frac{p(x)^{2}}{q_{\\mu}(x)} \\;=\\; \\frac{\\left(\\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\exp\\!\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right)\\right)^{2}}{\\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\exp\\!\\left(-\\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right)} \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left(-\\frac{x^{2}}{\\sigma^{2}} + \\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right).\n$$\n因此，\n$$\nM(\\mu) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\int_{-\\infty}^{\\infty} \\exp\\!\\left(2x - \\frac{x^{2}}{\\sigma^{2}} + \\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right) dx.\n$$\n合并指数项：\n$$\n2x - \\frac{x^{2}}{\\sigma^{2}} + \\frac{(x-\\mu)^{2}}{2\\sigma^{2}} \\;=\\; -\\frac{x^{2}}{2\\sigma^{2}} + \\left(2 - \\frac{\\mu}{\\sigma^{2}}\\right) x + \\frac{\\mu^{2}}{2\\sigma^{2}}.\n$$\n通过定义以下变量来完成配方\n$$\nm \\;=\\; 2\\sigma^{2} - \\mu,\n$$\n使得\n$$\n-\\frac{x^{2}}{2\\sigma^{2}} + \\left(2 - \\frac{\\mu}{\\sigma^{2}}\\right) x \\;=\\; -\\frac{(x - m)^{2}}{2\\sigma^{2}} + \\frac{m^{2}}{2\\sigma^{2}}.\n$$\n因此，\n$$\nM(\\mu) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\!\\left(\\frac{m^{2}}{2\\sigma^{2}} + \\frac{\\mu^{2}}{2\\sigma^{2}}\\right) \\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{(x - m)^{2}}{2\\sigma^{2}}\\right) dx \\;=\\; \\exp\\!\\left(\\frac{m^{2} + \\mu^{2}}{2\\sigma^{2}}\\right).\n$$\n代入 $m = 2\\sigma^{2} - \\mu$，\n$$\nm^{2} + \\mu^{2} \\;=\\; (2\\sigma^{2} - \\mu)^{2} + \\mu^{2} \\;=\\; 4\\sigma^{4} - 4\\mu \\sigma^{2} + 2\\mu^{2},\n$$\n因此\n$$\nM(\\mu) \\;=\\; \\exp\\!\\left(\\frac{4\\sigma^{4} - 4\\mu \\sigma^{2} + 2\\mu^{2}}{2\\sigma^{2}}\\right) \\;=\\; \\exp\\!\\left(2\\sigma^{2} - 2\\mu + \\frac{\\mu^{2}}{\\sigma^{2}}\\right).\n$$\n作为 $\\mu$ 的函数，最小化 $M(\\mu)$ 等价于最小化其指数\n$$\ng(\\mu) \\;=\\; \\frac{\\mu^{2}}{\\sigma^{2}} - 2\\mu + 2\\sigma^{2}.\n$$\n这是一个关于 $\\mu$ 的凸二次函数，其导数为\n$$\ng'(\\mu) \\;=\\; \\frac{2\\mu}{\\sigma^{2}} - 2,\n$$\n该导数在以下点处为零\n$$\n\\mu^{\\star} \\;=\\; \\sigma^{2}.\n$$\n由于 $g''(\\mu) = 2/\\sigma^{2} > 0$，该临界点是唯一的极小值点。当 $\\sigma^{2} = 100$ 时，最优位移为\n$$\n\\mu^{\\star} \\;=\\; 100.\n$$\n在 $\\mu^{\\star} = \\sigma^{2}$ 时，建议密度 $q_{\\mu^{\\star}}$ 与 $h(x)\\, p(x)$ 成正比，这将产生一个零方差的重要性采样估计量，这与以下结果一致\n$$\n\\operatorname{Var}_{q_{\\mu^{\\star}}}(h(Y)\\,w_{\\mu^{\\star}}(Y)) \\;=\\; M(\\mu^{\\star}) - \\left(\\mathbb{E}[\\exp(X)]\\right)^{2} \\;=\\; \\exp(\\sigma^{2}) - \\exp(\\sigma^{2}) \\;=\\; 0.\n$$\n综合结果，精确期望值为 $\\exp(50)$，最优位移为 $\\mu^{\\star} = 100$。", "answer": "$$\\boxed{\\begin{pmatrix}\\exp(50) & 100\\end{pmatrix}}$$", "id": "2446710"}]}