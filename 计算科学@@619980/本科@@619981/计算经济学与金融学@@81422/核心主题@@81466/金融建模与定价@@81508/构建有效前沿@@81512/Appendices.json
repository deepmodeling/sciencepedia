{"hands_on_practices": [{"introduction": "理论的美妙之处在于其应用价值。有效前沿不仅是一个理论构想，它也是寻找与投资者风险偏好相匹配的最优投资组合的实用工具。这个练习将引导你运用默顿的投资组合理论，为一位具有恒定相对风险规避 (CRRA) 偏好的投资者，计算出最优的风险资产配置权重，从而将抽象的效用最大化问题转化为具体的数值解。[@problem_id:2383572]", "problem": "一位具有恒定相对风险厌恶（CRRA）偏好的投资者，其关于期末财富的效用由 $U(W) = \\frac{W^{1-\\gamma}}{1-\\gamma}$ 给出，风险厌恶系数为 $\\gamma = 3$。该投资者在长度为 $T = 1$ 的投资期内进行连续时间投资，其初始财富为 $W_{0} > 0$，可投资于两种风险资产和一种无风险资产。无风险资产以连续复利率 $r = 0.02$ 增长。风险资产遵循相关的几何布朗运动（GBM）动态过程：\n$$\n\\frac{dS_{i}(t)}{S_{i}(t)} = \\mu_{i}\\,dt + \\sigma_{i}\\,dB_{i}(t), \\quad i \\in \\{1,2\\},\n$$\n其中 $B_{1}(t)$ 和 $B_{2}(t)$ 为标准布朗运动，瞬时相关性为 $\\rho = 0.25$。参数如下：\n- 预期收益率 $\\mu_{1} = 0.06$ 和 $\\mu_{2} = 0.09$，\n- 波动率 $\\sigma_{1} = 0.2$ 和 $\\sigma_{2} = 0.3$，\n- 相关性 $\\rho = 0.25$，\n- 无风险利率 $r = 0.02$，\n- 风险厌恶 $\\gamma = 3$。\n\n投资者在 $[0,1]$ 期间选择风险资产的恒定投资组合权重 $w = (w_{1}, w_{2})$，并将其余部分 $1 - w_{1} - w_{2}$ 投资于无风险资产。假设没有卖空或借贷限制。\n\n确定能最大化 $\\mathbb{E}[U(W_{1})]$ 的最优风险资产权重向量 $w^{\\star} = (w_{1}^{\\star}, w_{2}^{\\star})$。请将最终答案表示为精确值，无需四舍五入。", "solution": "此问题已经过验证，是量化金融领域一个适定（well-posed）且有科学依据的问题。它是Merton投资组合理论的一个标准应用。我将进行求解。\n\n投资者的目标是最大化期末财富的期望效用 $\\mathbb{E}[U(W_{T})]$，其效用函数为幂效用函数（CRRA）形式 $U(W) = \\frac{W^{1-\\gamma}}{1-\\gamma}$，其中 $\\gamma$ 是相对风险厌恶系数。投资机会集假设为恒定。在此连续时间框架下，对风险资产的最优配置（由向量 $w^{\\star}$ 表示）是恒定的，并由Merton投资组合法则给出：\n$$ w^{\\star} = \\frac{1}{\\gamma} \\Sigma^{-1} (\\mu - r \\mathbf{1}) $$\n此处，$w^{\\star}$ 是风险资产的最优权重列向量，$\\gamma$ 是风险厌恶系数，$\\Sigma$ 是风险资产收益的协方差矩阵，$\\mu$ 是风险资产的预期收益向量，$r$ 是无风险利率，$\\mathbf{1}$ 是一个维数合适的全1列向量。\n\n问题中给出的参数如下：\n- 风险厌恶系数：$\\gamma = 3$\n- 无风险利率：$r = 0.02$\n- 预期收益向量：$\\mu = \\begin{pmatrix} \\mu_{1} \\\\ \\mu_{2} \\end{pmatrix} = \\begin{pmatrix} 0.06 \\\\ 0.09 \\end{pmatrix}$\n- 波动率：$\\sigma_{1} = 0.2$，$\\sigma_{2} = 0.3$\n- 相关性：$\\rho = 0.25$\n\n首先，我们计算超额收益（风险溢价）向量 $\\mu - r \\mathbf{1}$：\n$$ \\mu - r \\mathbf{1} = \\begin{pmatrix} 0.06 - 0.02 \\\\ 0.09 - 0.02 \\end{pmatrix} = \\begin{pmatrix} 0.04 \\\\ 0.07 \\end{pmatrix} $$\n\n接下来，我们构建风险资产收益的协方差矩阵 $\\Sigma$。$\\Sigma$ 的元素为 $\\Sigma_{ij} = \\sigma_i \\sigma_j \\rho_{ij}$，其中 $\\rho_{11} = \\rho_{22} = 1$ 且 $\\rho_{12} = \\rho_{21} = \\rho = 0.25$。\n对角元素为方差：\n$$ \\Sigma_{11} = \\sigma_{1}^{2} = (0.2)^{2} = 0.04 $$\n$$ \\Sigma_{22} = \\sigma_{2}^{2} = (0.3)^{2} = 0.09 $$\n非对角元素为协方差：\n$$ \\Sigma_{12} = \\Sigma_{21} = \\sigma_{1} \\sigma_{2} \\rho = (0.2)(0.3)(0.25) = (0.06)(0.25) = 0.015 $$\n因此，协方差矩阵为：\n$$ \\Sigma = \\begin{pmatrix} 0.04 & 0.015 \\\\ 0.015 & 0.09 \\end{pmatrix} $$\n\n为应用该公式，我们需要 $\\Sigma$ 的逆矩阵。对于一个 $2 \\times 2$ 矩阵 $\\begin{pmatrix} a & b \\\\ c & d \\end{pmatrix}$，其逆矩阵由 $\\frac{1}{ad-bc} \\begin{pmatrix} d & -b \\\\ -c & a \\end{pmatrix}$ 给出。\n首先，我们计算 $\\Sigma$ 的行列式：\n$$ \\det(\\Sigma) = (0.04)(0.09) - (0.015)(0.015) = 0.0036 - 0.000225 = 0.003375 $$\n那么逆矩阵 $\\Sigma^{-1}$ 为：\n$$ \\Sigma^{-1} = \\frac{1}{0.003375} \\begin{pmatrix} 0.09 & -0.015 \\\\ -0.015 & 0.04 \\end{pmatrix} $$\n\n现在，我们将所有部分代入Merton公式，以求最优权重向量 $w^{\\star} = \\begin{pmatrix} w_{1}^{\\star} \\\\ w_{2}^{\\star} \\end{pmatrix}$：\n$$ w^{\\star} = \\frac{1}{3} \\left( \\frac{1}{0.003375} \\begin{pmatrix} 0.09 & -0.015 \\\\ -0.015 & 0.04 \\end{pmatrix} \\right) \\begin{pmatrix} 0.04 \\\\ 0.07 \\end{pmatrix} $$\n我们先计算乘积 $\\Sigma^{-1} (\\mu - r \\mathbf{1})$：\n$$ \\Sigma^{-1} (\\mu - r \\mathbf{1}) = \\frac{1}{0.003375} \\begin{pmatrix} (0.09)(0.04) - (0.015)(0.07) \\\\ -(0.015)(0.04) + (0.04)(0.07) \\end{pmatrix} $$\n$$ \\Sigma^{-1} (\\mu - r \\mathbf{1}) = \\frac{1}{0.003375} \\begin{pmatrix} 0.0036 - 0.00105 \\\\ -0.0006 + 0.0028 \\end{pmatrix} = \\frac{1}{0.003375} \\begin{pmatrix} 0.00255 \\\\ 0.0022 \\end{pmatrix} $$\n现在我们引入风险厌恶项 $\\frac{1}{\\gamma} = \\frac{1}{3}$：\n$$ w^{\\star} = \\frac{1}{3} \\begin{pmatrix} \\frac{0.00255}{0.003375} \\\\ \\frac{0.0022}{0.003375} \\end{pmatrix} = \\begin{pmatrix} \\frac{0.00255}{0.010125} \\\\ \\frac{0.0022}{0.010125} \\end{pmatrix} $$\n为了得到精确值，我们将它们转换为分数：\n$$ w_{1}^{\\star} = \\frac{0.00255}{0.010125} = \\frac{2550}{10125} $$\n为化简该分数，我们求分子和分母的最大公约数。\n$$ \\frac{2550}{10125} = \\frac{2 \\times 3 \\times 5^{2} \\times 17}{3^{4} \\times 5^{3}} = \\frac{2 \\times 17}{3^{3} \\times 5} = \\frac{34}{27 \\times 5} = \\frac{34}{135} $$\n对于第二个权重：\n$$ w_{2}^{\\star} = \\frac{0.0022}{0.010125} = \\frac{2200}{10125} $$\n化简该分数为：\n$$ \\frac{2200}{10125} = \\frac{2^{3} \\times 5^{2} \\times 11}{3^{4} \\times 5^{3}} = \\frac{2^{3} \\times 11}{3^{4} \\times 5} = \\frac{8 \\times 11}{81 \\times 5} = \\frac{88}{405} $$\n所以，最优权重向量为 $w^{\\star} = \\begin{pmatrix} \\frac{34}{135} \\\\ \\frac{88}{405} \\end{pmatrix}$。这对应于在资产1中投资约 $25.2\\%$，在资产2中投资约 $21.7\\%$。剩余部分 $1 - \\frac{34}{135} - \\frac{88}{405} = 1 - \\frac{102}{405} - \\frac{88}{405} = 1 - \\frac{190}{405} = \\frac{215}{405} = \\frac{43}{81} \\approx 53.1\\%$ 投资于无风险资产。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{34}{135} \\\\\n\\frac{88}{405}\n\\end{pmatrix}\n}\n$$", "id": "2383572"}, {"introduction": "构建有效前沿后，一个自然的问题是：当投资范围扩大时，它会如何变化？这个思想实验探讨了在投资组合中加入一个高风险、高预期回报的“彩票式”资产所带来的影响。通过分析这种极端情况，你将深化对多元化如何塑造风险-回报权衡的直观理解，并学会定性地推理资产特征对整个有效前沿形态的影响。[@problem_id:2409817]", "problem": "考虑一个由 $N$ 种风险资产组成的投资域，其预期超额收益向量为 $\\boldsymbol{\\mu} \\in \\mathbb{R}^N$，协方差矩阵为正定的 $\\boldsymbol{\\Sigma} \\in \\mathbb{R}^{N \\times N}$。投资组合为完全投资，并可采取空头头寸，即投资组合权重 $\\boldsymbol{w} \\in \\mathbb{R}^N$ 满足 $\\mathbf{1}^\\top \\boldsymbol{w} = 1$，其中 $\\mathbf{1}$ 是所有元素均为1的 $N$ 维向量。均值-方差有效前沿是满足以下条件的投资组合的轨迹：对于每个目标预期超额收益 $\\mu^\\star \\in \\mathbb{R}$，在约束条件 $\\boldsymbol{\\mu}^\\top \\boldsymbol{w} = \\mu^\\star$ 和 $\\mathbf{1}^\\top \\boldsymbol{w} = 1$ 下，最小化投资组合方差 $\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}$。\n\n现在，通过增加一种新的风险资产 $L$ 来扩展该投资域。该资产的预期超额收益为 $\\mu_L \\in \\mathbb{R}$，方差为 $\\sigma_L^2 \\in \\mathbb{R}_{++}$，与原有的 $N$ 种资产的协方差向量为 $\\boldsymbol{c} \\in \\mathbb{R}^N$。假设：\n- $\\mu_L$ 的绝对值严格大于 $\\boldsymbol{\\mu}$ 的任何分量。\n- $\\sigma_L^2$ 严格大于 $\\boldsymbol{\\Sigma}$ 的最大特征值。\n- $L$ 与原有资产之间的两两相关性一致地小，即存在 $\\bar{\\rho} \\in (0,1)$ 且 $\\bar{\\rho} \\leq 0.2$，使得对于每个 $i \\in \\{1,\\dots,N\\}$ 都有 $\\lvert c_i \\rvert \\leq \\bar{\\rho} \\,\\sigma_L \\,\\sigma_i$，其中 $\\sigma_i^2$ 表示资产 $i$ 的方差。\n\n在这些假设下，比较添加资产 $L$ 前后的有效前沿。以下哪个陈述最能描述“彩票型”资产 $L$ 对有效前沿形状和规模的影响？\n\nA. 新的有效前沿在每一个目标预期收益下都严格优于旧的有效前沿，即对于所有的 $\\mu^\\star$，最小可实现方差都严格低于之前。\n\nB. 新的有效前沿弱势优于旧的有效前沿；它永远不会位于旧前沿的上方，并在最小方差端附近与旧前沿重合，但在足够高的目标预期收益处明显向外扩张。在两个投资域中，均值-标准差平面上的有效前沿都是一条凸双曲线。\n\nC. 由于资产 $L$ 的方差非常高，新的有效前沿会变为非凸的，带有一个拐点，并且对于给定的目标预期收益可能出现多个局部方差最小值。\n\nD. 扩展后投资域中的最小方差投资组合必然会为资产 $L$ 分配一个大的正权重，以利用其高预期收益，同时通过分散化降低方差，从而使整个前沿大幅向下移动。", "solution": "用户提供了一个来自均值-方差投资组合优化领域的问题。我将首先验证问题陈述，然后进行详细的解答。\n\n### 步骤 1：提取已知条件\n- **原始投资域**：$N$ 种风险资产，预期超额收益向量为 $\\boldsymbol{\\mu} \\in \\mathbb{R}^N$，正定协方差矩阵为 $\\boldsymbol{\\Sigma} \\in \\mathbb{R}^{N \\times N}$。\n- **投资组合约束**：投资组合为完全投资，权重 $\\boldsymbol{w} \\in \\mathbb{R}^N$ 满足 $\\mathbf{1}^\\top \\boldsymbol{w} = 1$。允许卖空。\n- **有效前沿定义**：对于给定的目标预期超额收益 $\\mu^\\star = \\boldsymbol{\\mu}^\\top \\boldsymbol{w}$，最小化方差 $\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}$ 的投资组合的轨迹。\n- **扩展投资域**：增加一种风险资产 $L$。\n- **资产 $L$ 的属性**：\n    - 预期超额收益：$\\mu_L \\in \\mathbb{R}$，且对于所有 $i \\in \\{1,\\dots,N\\}$ 都有 $|\\mu_L| > |\\mu_i|$。\n    - 方差：$\\sigma_L^2 \\in \\mathbb{R}_{++}$（严格为正），且 $\\sigma_L^2 > \\lambda_{\\text{max}}(\\boldsymbol{\\Sigma})$，其中 $\\lambda_{\\text{max}}(\\boldsymbol{\\Sigma})$ 是 $\\boldsymbol{\\Sigma}$ 的最大特征值。\n    - 与原始资产的协方差：$\\boldsymbol{c} \\in \\mathbb{R}^N$。\n    - 相关性属性：存在 $\\bar{\\rho} \\in (0,1)$ 且 $\\bar{\\rho} \\leq 0.2$，使得对于每个 $i \\in \\{1,\\dots,N\\}$ 都有 $|c_i| \\leq \\bar{\\rho} \\, \\sigma_L \\, \\sigma_i$，其中 $\\sigma_i^2 = \\boldsymbol{\\Sigma}_{ii}$。\n- **问题**：描述增加资产 $L$ 对有效前沿的影响。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题在标准的Markowitz均值-方差优化框架内是定义明确的。\n- **科学依据**：所使用的概念——预期收益、协方差、投资组合权重和有效前沿——都是现代投资组合理论的基础。该优化问题是一个标准的二次规划问题。此问题是科学合理的。\n- **适定性**：原始问题涉及在线性约束下最小化一个严格凸的二次型（$\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}$，因为 $\\boldsymbol{\\Sigma}$ 是正定的）。这保证了对于每个可实现的目标收益 $\\mu^\\star$ 都有唯一的解。对于扩展后的投资域，新的协方差矩阵为 $\\boldsymbol{\\Sigma}_{\\text{aug}} = \\begin{pmatrix} \\boldsymbol{\\Sigma} & \\boldsymbol{c} \\\\ \\boldsymbol{c}^\\top & \\sigma_L^2 \\end{pmatrix}$。为使问题保持适定性，$\\boldsymbol{\\Sigma}_{\\text{aug}}$ 必须是正定的。$\\sigma_L^2$ 很大且协方差 $\\boldsymbol{c}$ 很小的条件使得舒尔补 $\\sigma_L^2 - \\boldsymbol{c}^\\top \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{c}$ 很可能为正，这确保了 $\\boldsymbol{\\Sigma}_{\\text{aug}}$ 是正定的。该问题是适定的。\n- **客观性和清晰度**：该问题使用了标准的数学术语。描述性术语“彩票型”通过高预期收益绝对值和高方差的数学特性得到了即时而客观的定义。该问题是客观且陈述清晰的。\n- **完整性和一致性**：该问题为定性分析提供了所有必要信息。所提供的数据或假设中没有明显的矛盾。\n\n### 步骤 3：结论和行动\n问题陈述有效。我现在将进行推导和选项评估。\n\n### 推导与选项分析\n\n有效前沿是对于给定的预期收益水平，提供最小可能方差的投资组合集合。原始投资域包含 $N$ 种资产，扩展后的投资域包含 $N+1$ 种资产。\n\n**1. 扩展的一般原则**\n由 $N+1$ 种资产构成的投资组合集合是原始 $N$ 种资产所能构成的投资组合集合的超集。任何来自原始投资域的投资组合 $\\boldsymbol{w}$ 可以在扩展投资域中表示为 $\\boldsymbol{w}_{\\text{aug}} = (\\boldsymbol{w}^\\top, 0)^\\top$。这意味着对于原始投资域中任何可实现的目标预期收益 $\\mu^\\star$，相同的投资组合（以及因此相同的方差）在扩展投资域中也是可实现的。扩展投资域中的优化过程将找到一个方差小于或等于该值的投资组合。\n因此，对于任何 $\\mu^\\star$，新的最小方差 $\\sigma_{\\text{new}}^2(\\mu^\\star)$ 必须小于或等于旧的最小方差 $\\sigma_{\\text{old}}^2(\\mu^\\star)$。\n$$\n\\sigma_{\\text{new}}^2(\\mu^\\star) \\leq \\sigma_{\\text{old}}^2(\\mu^\\star)\n$$\n这种关系被称为弱势占优。在标准的均值-标准差平面上，新的有效前沿位于旧的有效前沿的左侧或与其重合。\n\n**2. 有效前沿的形状**\n在一个资产投资域中，如果投资组合是在仅受完全投资约束（$\\mathbf{1}^\\top \\boldsymbol{w} = 1$）的条件下，通过最小化给定均值收益下的方差而形成的，那么得到的有效前沿在均值-方差（$\\mu^\\star, \\sigma^2$）平面上是一条抛物线。其方程形式为 $\\sigma^2 = a(\\mu^\\star)^2 + b\\mu^\\star + c$，其中常数 $a, b, c$ 由资产参数确定，且 $a > 0$。在均值-标准差（$\\mu^\\star, \\sigma$）平面上，这个点的轨迹构成了双曲线的上半部分，是一条凸曲线。这是一个标准结论，并且适用于原始投资域和扩展投资域，因为问题的底层数学结构没有改变。\n\n**3. 资产 $L$ 特定属性的影响**\n资产 $L$ 被描述为“彩票型”资产，具有大的预期收益绝对值 $|\\mu_L|$ 和大的方差 $\\sigma_L^2$，但与其他资产的相关性较低。\n\n- **对最小方差投资组合（MVP）的影响**：全局最小方差投资组合是有效前沿上具有最低可能方差的投资组合。其构建仅依赖于协方差矩阵和全1向量，与预期收益无关。目标是纯粹的方差最小化。像资产 $L$ 这样具有极高方差的资产，对于MVP通常没有吸引力。虽然其低相关性提供了分散化收益，但非常大的 $\\sigma_L^2$ 项是一个显著的不利因素。因此，在新MVP中资产 $L$ 的最优权重 $w_{L, \\text{MVP}}$ 将会很小。新资产的权重小，导致MVP的方差和预期收益只有微小变化。因此，新双曲线的顶点将非常接近旧双曲线的顶点。\n\n- **对高收益投资组合的影响**：要实现一个大幅度的目标预期收益 $\\mu^\\star$（接近 $\\mu_L$），投资组合必须在具有高预期收益的资产上持有显著头寸。在扩展投资域中，这个资产就是 $L$。随着 $|\\mu^\\star|$ 的增加，分配给资产 $L$ 的权重也必须增加。资产 $L$ 与原始 $N$ 种资产的低相关性提供了可观的分散化收益，随着资产 $L$ 权重的增加，这种收益变得更加显著。这意味着，对于高目标收益，包含资产 $L$ 所带来的方差降低将是显著的。在这些高收益水平上，新的前沿将显著位于旧前沿的左侧（即方差更低）。\n\n**4. 严格占优 vs. 弱势占优**\n除非资产 $L$ 是冗余的或恰好完美地位于原始有效前沿上，否则新的前沿将严格优于旧的（$\\sigma_{\\text{new}}^2(\\mu^\\star) < \\sigma_{\\text{old}}^2(\\mu^\\star)$）。如果扩展后的协方差矩阵 $\\boldsymbol{\\Sigma}_{\\text{aug}}$ 是正定的，那么资产就是非冗余的，这一点被隐式地假设了。当且仅当在扩展投资域中，针对特定目标收益 $\\mu^\\star$ 的最优投资组合在资产 $L$ 上的权重为零时，新的前沿和旧的前沿将在该 $\\mu^\\star$ 处重合。这种情况仅在资产 $L$ 满足由原始前沿上的投资组合所决定的特定线性定价关系时才会发生。这种情况最多只对一个 $\\mu^\\star$ 值成立（除非资产 L 是冗余的）。因此，声称在*每个*目标收益上都严格占优的说法过于强烈，因为可能存在一个切点。\n\n### 选项评估\n\n**A. 新的有效前沿在每一个目标预期收益下都严格优于旧的有效前沿，即对于所有的 $\\mu^\\star$，最小可实现方差都严格低于之前。**\n**不正确**。如上所述，虽然新的前沿几乎处处都更优，但旧前沿和新前沿之间在数学上可能存在一个切点。因此，不能声称在*每个*点都严格占优。这个陈述过于绝对。\n\n**B. 新的有效前沿弱势优于旧的有效前沿；它永远不会位于旧前沿的上方，并在最小方差端附近与旧前沿重合，但在足够高的目标预期收益处明显向外扩张。在两个投资域中，均值-标准差平面上的有效前沿都是一条凸双曲线。**\n**正确**。该陈述准确地概括了分析的所有关键方面：\n- “弱势优于旧的；它永远不会位于上方”：正确，这是扩展的一般原则。\n- “在最小方差端附近与它重合”：这是一个定性描述。如前所论，资产 $L$ 在MVP中的权重很小，所以两个前沿在它们的顶点附近会非常接近。“重合”可能被宽泛地用来表示“相切或非常接近”，这抓住了资产 $L$ 对低风险投资组合影响很小的特点。\n- “在足够高的目标预期收益处明显向外扩张”：正确，高收益、低相关性的资产 $L$ 的好处在寻求高收益时最为明显。\n- “有效前沿...是一条凸双曲线”：正确，这是在允许卖空的情况下有效前沿的标准形状。\n\n**C. 由于资产 $L$ 的方差非常高，新的有效前沿会变为非凸的，带有一个拐点，并且对于给定的目标预期收益可能出现多个局部方差最小值。**\n**不正确**。该问题是一个带有正定协方差矩阵的约束二次最小化问题。这类问题对每个目标收益都会产生唯一的全局最小值和一个凸前沿。拐点和非凸性源于不同类型的约束（如无卖空约束）或不同的目标函数，这些在此处都不存在。\n\n**D. 扩展后投资域中的最小方差投资组合必然会为资产 $L$ 分配一个大的正权重，以利用其高预期收益，同时通过分散化降低方差，从而使整个前沿大幅向下移动。**\n**不正确**。这个陈述包含两个根本性错误。首先，最小方差投资组合是为了最小化方差而构建的，与预期收益无关；它不会“利用高预期收益”。其次，因为资产 $L$ 的方差非常高，它在MVP中的权重将会很小，而不是很大。大的权重会增加方差，与MVP的目标背道而驰。因此，前沿在其顶点附近的移动将是微小的，而不是巨大的。", "answer": "$$\\boxed{B}$$", "id": "2409817"}, {"introduction": "在现实世界的投资组合管理中，约束条件远不止资金投入总额为1。投资者常常需要满足其他目标，例如将投资组合的系统性风险（以贝塔系数 $\\beta$ 衡量）控制在特定水平。这个实践练习要求你编写程序，求解在满足全投资和目标贝塔双重约束下的最小方差投资组合，这不仅能锻炼你的数学建模能力，还能让你掌握处理更复杂、更现实约束条件的优化技巧。[@problem_id:2383619]", "problem": "编写一个完整、可运行的程序，为每个指定的测试用例计算在两个等式约束下的最小方差投资组合：投资组合相对于市场的贝塔系数（beta）等于 $1$，以及完全投资的预算约束成立（权重之和为 $1$）。请使用以下基础定义和事实作为您推理和算法设计的起点。\n\n- 对于 $N$ 种风险资产，其收益向量为 $R \\in \\mathbb{R}^N$，协方差矩阵为 $\\Sigma \\in \\mathbb{R}^{N \\times N}$（对称正定），市场收益为 $R_m$，则权重向量为 $w \\in \\mathbb{R}^N$ 的投资组合的方差为 $w^{\\top} \\Sigma w$。\n- 对于每项资产 $i$，其相对于市场的贝塔系数为 $\\beta_i = \\frac{\\operatorname{Cov}(R_i, R_m)}{\\operatorname{Var}(R_m)}$。给定向量 $c \\in \\mathbb{R}^N$（其元素为 $c_i = \\operatorname{Cov}(R_i, R_m)$）和市场方差 $\\sigma_m^2 = \\operatorname{Var}(R_m)$，资产贝塔向量为 $\\beta = c / \\sigma_m^2$（按元素相除）。\n- 投资组合的贝塔系数为 $\\beta_p = \\beta^{\\top} w$。\n\n您的任务是为每个测试实例计算：\n- 一个投资组合权重向量 $w \\in \\mathbb{R}^N$，它在 $1^{\\top} w = 1$ 和 $\\beta^{\\top} w = 1$ 的约束下，最小化 $w^{\\top} \\Sigma w$。其中 $1$ 表示 $N$ 维的全1向量。\n- 由此产生的投资组合方差 $w^{\\top} \\Sigma w$。\n- 达成的投资组合贝塔系数 $\\beta^{\\top} w$。\n- 权重之和 $1^{\\top} w$。\n\n可行性、退化要求和边界情况：\n- 如果两个约束线性无关（即，两个列向量 $1$ 和 $\\beta$ 线性无关），则求解该双约束最小方差问题。\n- 如果两个约束线性相关，则存在两种子情况：\n    - 如果对于某个标量 $k$，有 $\\beta = k \\cdot 1$ 且 $k = 1$，那么贝塔约束与预算约束相同。在这种情况下，仅在 $1^{\\top} w = 1$ 的约束下计算最小方差投资组合。\n    - 如果对于某个标量 $k$，有 $\\beta = k \\cdot 1$ 且 $k \\neq 1$，那么方程组 $1^{\\top} w = 1$ 和 $\\beta^{\\top} w = 1$ 是不可行的。在这种情况下，为该测试用例返回一个空列表。\n\n数值细节：\n- 对于每个测试用例，返回一个列表，其中包含资产权重 $w_1, \\dots, w_N$，后跟投资组合方差 $w^{\\top} \\Sigma w$、达成的投资组合贝塔系数 $\\beta^{\\top} w$ 以及权重之和 $1^{\\top} w$。将报告的每个数字四舍五入到 $6$ 位小数。\n- 如果一个测试用例不可行（如上文定义），则为该测试用例返回一个空列表。\n- 不涉及角度。没有物理单位。所有数值量都应视为纯数字。\n- 使用 $10^{-10}$ 的数值容差来评估线性相关性和可行性一致性。\n\n程序内部实现的测试套件（每个测试用例提供 $\\Sigma$、$c$ 和 $\\sigma_m^2$；在内部计算 $\\beta = c / \\sigma_m^2$）：\n1. 正常路径，$N=3$：\n   - $\\Sigma = \\begin{bmatrix} 0.04 & 0.006 & 0.004 \\\\ 0.006 & 0.09 & 0.018 \\\\ 0.004 & 0.018 & 0.16 \\end{bmatrix}$，\n   - $c = \\begin{bmatrix} 0.02 \\\\ 0.03 \\\\ 0.04 \\end{bmatrix}$，\n   - $\\sigma_m^2 = 0.05$。\n2. 退化但可行（约束线性相关且一致），$N=3$：\n   - $\\Sigma = \\begin{bmatrix} 0.01 & 0.002 & 0.0015 \\\\ 0.002 & 0.02 & 0.003 \\\\ 0.0015 & 0.003 & 0.03 \\end{bmatrix}$，\n   - $c = \\begin{bmatrix} 0.02 \\\\ 0.02 \\\\ 0.02 \\end{bmatrix}$，\n   - $\\sigma_m^2 = 0.02$。\n3. 退化且不可行（约束线性相关但不一致），$N=3$：\n   - $\\Sigma = \\begin{bmatrix} 0.06 & 0.01 & 0.008 \\\\ 0.01 & 0.08 & 0.012 \\\\ 0.008 & 0.012 & 0.1 \\end{bmatrix}$，\n   - $c = \\begin{bmatrix} 0.03 \\\\ 0.03 \\\\ 0.03 \\end{bmatrix}$，\n   - $\\sigma_m^2 = 0.025$。\n4. 通用情况，$N=4$：\n   - $\\Sigma = \\begin{bmatrix} 0.05 & 0.01 & 0.005 & 0.004 \\\\ 0.01 & 0.07 & 0.011 & 0.006 \\\\ 0.005 & 0.011 & 0.09 & 0.012 \\\\ 0.004 & 0.006 & 0.012 & 0.11 \\end{bmatrix}$，\n   - $c = \\begin{bmatrix} 0.03 \\\\ 0.025 \\\\ 0.02 \\\\ 0.015 \\end{bmatrix}$，\n   - $\\sigma_m^2 = 0.06$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含所有测试用例的结果，形式为一个用方括号括起来的逗号分隔列表，其中每个元素是以下两者之一：\n    - 一个包含 $N+3$ 个浮点数的列表：$[w_1,\\dots,w_N,\\, w^{\\top}\\Sigma w,\\, \\beta^{\\top}w,\\, 1^{\\top}w]$，四舍五入到 $6$ 位小数，或\n    - 如果不可行，则为一个空列表。\n- 例如，一个包含两个可行案例的有效整体输出结构可能如下所示：[[0.2,0.3,0.5,0.012345,1.0,1.0],[...]]。", "solution": "所提出的问题是一个带约束的二次优化任务，这是计算金融学中的一个基本问题。其目标是找到投资组合权重向量 $w \\in \\mathbb{R}^N$，以最小化由二次型 $w^{\\top} \\Sigma w$ 给出的投资组合方差，同时满足两个线性等式约束。协方差矩阵 $\\Sigma \\in \\mathbb{R}^{N \\times N}$ 被指定为对称正定矩阵，这确保了目标函数是严格凸的，因此拥有唯一的最小值。\n\n该优化问题可以正式表述为：\n$$\n\\begin{aligned}\n& \\underset{w}{\\text{minimize}}\n& & w^{\\top} \\Sigma w \\\\\n& \\text{subject to}\n& & \\mathbf{1}^{\\top} w = 1 \\\\\n& & & \\beta^{\\top} w = 1\n\\end{aligned}\n$$\n其中 $\\mathbf{1}$ 是 $N$ 维的全1向量，而 $\\beta$ 是资产贝塔系数向量。\n\n解决此类问题的标准且严谨的方法是拉格朗日乘数法。我们构造拉格朗日函数 $L(w, \\lambda_1, \\lambda_2)$：\n$$\nL(w, \\lambda_1, \\lambda_2) = w^{\\top} \\Sigma w - \\lambda_1 (\\mathbf{1}^{\\top} w - 1) - \\lambda_2 (\\beta^{\\top} w - 1)\n$$\n在这里，$\\lambda_1$ 和 $\\lambda_2$ 分别是与完全投资约束和目标贝塔约束相关联的拉格朗日乘数。为了找到最优的 $w$，我们通过将 $L$ 对 $w$、$\\lambda_1$ 和 $\\lambda_2$ 的偏导数设为零，来推导一阶必要条件。\n\n对向量 $w$ 的偏导数为：\n$$\n\\frac{\\partial L}{\\partial w} = 2 \\Sigma w - \\lambda_1 \\mathbf{1} - \\lambda_2 \\beta = 0\n$$\n由于 $\\Sigma$ 是正定的，它是可逆的。因此我们可以解出 $w$：\n$$\nw = \\frac{1}{2} \\Sigma^{-1} (\\lambda_1 \\mathbf{1} + \\lambda_2 \\beta)\n$$\n剩下的一阶条件只是恢复了原始约束：\n$$\n\\frac{\\partial L}{\\partial \\lambda_1} = -(\\mathbf{1}^{\\top} w - 1) = 0 \\implies \\mathbf{1}^{\\top} w = 1\n$$\n$$\n\\frac{\\partial L}{\\partial \\lambda_2} = -(\\beta^{\\top} w - 1) = 0 \\implies \\beta^{\\top} w = 1\n$$\n我们将 $w$ 的表达式代入这两个约束中，以构成一个关于 $\\lambda_1$ 和 $\\lambda_2$ 的线性方程组。\n\n代入第一个约束：\n$$\n\\mathbf{1}^{\\top} \\left( \\frac{1}{2} \\Sigma^{-1} (\\lambda_1 \\mathbf{1} + \\lambda_2 \\beta) \\right) = 1 \\implies \\lambda_1 (\\mathbf{1}^{\\top} \\Sigma^{-1} \\mathbf{1}) + \\lambda_2 (\\mathbf{1}^{\\top} \\Sigma^{-1} \\beta) = 2\n$$\n代入第二个约束：\n$$\n\\beta^{\\top} \\left( \\frac{1}{2} \\Sigma^{-1} (\\lambda_1 \\mathbf{1} + \\lambda_2 \\beta) \\right) = 1 \\implies \\lambda_1 (\\beta^{\\top} \\Sigma^{-1} \\mathbf{1}) + \\lambda_2 (\\beta^{\\top} \\Sigma^{-1} \\beta) = 2\n$$\n为简化表示，我们定义标量 $A$、$B$ 和 $C$：\n$$\nA = \\mathbf{1}^{\\top} \\Sigma^{-1} \\mathbf{1} \\quad ; \\quad B = \\mathbf{1}^{\\top} \\Sigma^{-1} \\beta \\quad ; \\quad C = \\beta^{\\top} \\Sigma^{-1} \\beta\n$$\n注意，由于 $\\Sigma^{-1}$ 是对称的，我们有 $B = \\beta^{\\top} \\Sigma^{-1} \\mathbf{1}$。关于乘数的方程组变为：\n$$\n\\begin{pmatrix} A & B \\\\ B & C \\end{pmatrix} \\begin{pmatrix} \\lambda_1 \\\\ \\lambda_2 \\end{pmatrix} = \\begin{pmatrix} 2 \\\\ 2 \\end{pmatrix}\n$$\n该系数矩阵的行列式为 $D = AC - B^2$。根据由 $\\Sigma^{-1}$ 定义的内积的柯西-施瓦茨不等式，此行列式为零当且仅当约束向量 $\\mathbf{1}$ 和 $\\beta$ 线性相关。\n\n情况1：线性无关约束（$D \\neq 0$）。\n该方程组对 $(\\lambda_1, \\lambda_2)$ 有唯一解，可以使用克莱姆法则或矩阵求逆法求得：\n$$\n\\lambda_1 = \\frac{2(C - B)}{AC - B^2} \\quad ; \\quad \\lambda_2 = \\frac{2(A - B)}{AC - B^2}\n$$\n有了这些值，最优权重向量 $w$ 就被唯一确定了。\n\n情况2：线性相关约束（$D \\approx 0$）。\n这种情况发生当且仅当对于某个标量 $k$ 有 $\\beta = k \\cdot \\mathbf{1}$。约束变为：\n$$\n\\mathbf{1}^{\\top} w = 1\n$$\n$$\n(k \\cdot \\mathbf{1})^{\\top} w = 1 \\implies k (\\mathbf{1}^{\\top} w) = 1\n$$\n将第一个约束代入第二个约束得到 $k(1) = 1$，这意味着 $k=1$。\n- 子情况 2a：可行（$k = 1$）。如果每项资产的贝塔系数都为 $1$，则两个约束是相同的。问题退化为在仅有约束 $\\mathbf{1}^{\\top} w = 1$ 的情况下最小化 $w^{\\top} \\Sigma w$。拉格朗日函数为 $L(w, \\lambda) = w^{\\top} \\Sigma w - \\lambda(\\mathbf{1}^{\\top} w - 1)$。一阶条件 $\\frac{\\partial L}{\\partial w} = 2 \\Sigma w - \\lambda \\mathbf{1} = 0$ 给出 $w = \\frac{\\lambda}{2} \\Sigma^{-1} \\mathbf{1}$。代入约束得 $\\frac{\\lambda}{2} (\\mathbf{1}^{\\top} \\Sigma^{-1} \\mathbf{1}) = 1$，所以 $\\frac{\\lambda}{2} = \\frac{1}{\\mathbf{1}^{\\top} \\Sigma^{-1} \\mathbf{1}}$。最优权重为：\n  $$\n  w = \\frac{\\Sigma^{-1} \\mathbf{1}}{\\mathbf{1}^{\\top} \\Sigma^{-1} \\mathbf{1}}\n  $$\n- 子情况 2b：不可行（$k \\neq 1$）。约束是相互矛盾的。不存在解。该问题是不可行的。\n\n计算算法直接遵循此分析框架：\n1. 对于每个测试用例，计算贝塔向量 $\\beta = c / \\sigma_m^2$。\n2. 检查 $\\mathbf{1}$ 和 $\\beta$ 的线性相关性。这可以通过测试 $\\beta$ 的所有元素是否在指定的数值容差 $10^{-10}$ 内等于一个常数 $k$ 来完成。\n3. 如果它们线性相关：\n    a. 检查 $k$ 是否与约束一致，即 $|k - 1| < 10^{-10}$。\n    b. 如果一致，使用推导出的公式解决单约束问题。\n    c. 如果不一致，则问题不可行。\n4. 如果它们线性无关，则求解关于 $\\lambda_1, \\lambda_2$ 的 $2 \\times 2$ 方程组并计算权重 $w$。\n5. 对于任何可行解，计算投资组合方差 $w^{\\top} \\Sigma w$、达成的贝塔系数 $\\beta^{\\top} w$ 和权重之和 $\\mathbf{1}^{\\top} w$。后两者可用于验证约束是否满足。\n6. 按要求将所有数值结果格式化为 $6$ 位小数。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the minimum-variance portfolio under beta and budget constraints.\n    \"\"\"\n    \n    # Numerical tolerance for floating point comparisons.\n    TOL = 1e-10\n\n    test_cases = [\n        {\n            # Happy path, N=3\n            \"Sigma\": np.array([\n                [0.04, 0.006, 0.004],\n                [0.006, 0.09, 0.018],\n                [0.004, 0.018, 0.16]\n            ]),\n            \"c\": np.array([0.02, 0.03, 0.04]),\n            \"sigma_m_sq\": 0.05\n        },\n        {\n            # Degenerate but feasible, N=3\n            \"Sigma\": np.array([\n                [0.01, 0.002, 0.0015],\n                [0.002, 0.02, 0.003],\n                [0.0015, 0.003, 0.03]\n            ]),\n            \"c\": np.array([0.02, 0.02, 0.02]),\n            \"sigma_m_sq\": 0.02\n        },\n        {\n            # Degenerate and infeasible, N=3\n            \"Sigma\": np.array([\n                [0.06, 0.01, 0.008],\n                [0.01, 0.08, 0.012],\n                [0.008, 0.012, 0.1]\n            ]),\n            \"c\": np.array([0.03, 0.03, 0.03]),\n            \"sigma_m_sq\": 0.025\n        },\n        {\n            # General N=4\n            \"Sigma\": np.array([\n                [0.05, 0.01, 0.005, 0.004],\n                [0.01, 0.07, 0.011, 0.006],\n                [0.005, 0.011, 0.09, 0.012],\n                [0.004, 0.006, 0.012, 0.11]\n            ]),\n            \"c\": np.array([0.03, 0.025, 0.02, 0.015]),\n            \"sigma_m_sq\": 0.06\n        }\n    ]\n\n    results_for_print = []\n\n    for case in test_cases:\n        Sigma = case[\"Sigma\"]\n        c = case[\"c\"]\n        sigma_m_sq = case[\"sigma_m_sq\"]\n        N = Sigma.shape[0]\n\n        beta = c / sigma_m_sq\n        ones = np.ones(N)\n\n        # Check for linear dependence: beta = k * 1\n        # This is true if all elements of beta are the same.\n        is_dependent = np.allclose(beta, beta[0], atol=TOL, rtol=TOL)\n\n        w = None\n        if is_dependent:\n            k = beta[0]\n            # Check for feasibility: k must equal 1\n            if np.isclose(k, 1.0, atol=TOL):\n                # Constraints are redundant and feasible. Solve single-constraint problem.\n                # min w'Sw s.t. 1'w = 1\n                Sigma_inv = np.linalg.inv(Sigma)\n                numerator = Sigma_inv @ ones\n                denominator = ones.T @ numerator\n                w = numerator / denominator\n            else:\n                # Constraints are contradictory. Infeasible.\n                results_for_print.append(\"[]\")\n                continue\n        else:\n            # Constraints are linearly independent. Solve two-constraint problem.\n            Sigma_inv = np.linalg.inv(Sigma)\n            \n            # Define scalars for the 2x2 system\n            A = ones.T @ Sigma_inv @ ones\n            B = ones.T @ Sigma_inv @ beta\n            C = beta.T @ Sigma_inv @ beta\n\n            # Solve for Lagrange multipliers lambda1, lambda2\n            matrix_D = A * C - B * B\n            if abs(matrix_D) < TOL:\n                # This should not be reached due to the initial check but is a safeguard.\n                results_for_print.append(\"[]\")\n                continue\n\n            # System is [A, B; B, C][l1; l2] = [2; 2]\n            lambda1 = 2 * (C - B) / matrix_D\n            lambda2 = 2 * (A - B) / matrix_D\n\n            # Compute weights\n            w = 0.5 * (Sigma_inv @ (lambda1 * ones + lambda2 * beta))\n\n        if w is not None:\n            # Calculate final portfolio characteristics\n            portfolio_variance = w.T @ Sigma @ w\n            portfolio_beta = beta.T @ w\n            portfolio_weight_sum = np.sum(w)\n            \n            # Prepare result list and round all numbers\n            final_list = list(w) + [portfolio_variance, portfolio_beta, portfolio_weight_sum]\n            rounded_list = [f\"{x:.6f}\" for x in final_list]\n            results_for_print.append(f\"[{','.join(rounded_list)}]\")\n\n    # Print the final result string in the required format\n    print(f\"[{','.join(results_for_print)}]\")\n\nsolve()\n```", "id": "2383619"}]}