{"hands_on_practices": [{"introduction": "本章的第一个练习是一个基础的构建模块。我们将应用投资组合方差的核心公式，来精确计算为达到特定投资组合风险水平 $\\sigma_p^2$ 所需的资产配置。这项练习旨在巩固你对单个资产的波动性（如 $\\sigma_1$, $\\sigma_2$）及其相关性 $\\rho$ 如何共同决定投资组合整体风险的理解。[@problem_id:2438015]", "problem": "考虑一个计算金融中的投资组合，它由两种风险资产组成，其回报率分别为 $r_{1}$ 和 $r_{2}$。设回报率的标准差为 $\\sigma_{1} = 0.4$ 和 $\\sigma_{2} = 0.2$，相关系数为 $\\rho = 0.95$。投资组合中资产1的权重为 $w$，资产2的权重为 $1 - w$，且不允许卖空，因此 $w \\in [0,1]$。假设二阶矩存在，并使用定义 $\\operatorname{Cov}(r_{1}, r_{2}) = \\rho \\sigma_{1} \\sigma_{2}$。确定 $w \\in [0,1]$ 的值，使得投资组合的方差等于目标水平 $0.085$。将您的答案四舍五入到 $6$ 位有效数字。", "solution": "本问题需要经过验证。\n\n**步骤1：提取已知条件**\n-   资产数量：$2$。\n-   回报率：$r_{1}$，$r_{2}$。\n-   资产1的标准差：$\\sigma_{1} = 0.4$。\n-   资产2的标准差：$\\sigma_{2} = 0.2$。\n-   回报率的相关系数：$\\rho = 0.95$。\n-   资产1的权重：$w$。\n-   资产2的权重：$1 - w$。\n-   权重约束：$w \\in [0,1]$。\n-   协方差定义：$\\operatorname{Cov}(r_{1}, r_{2}) = \\rho \\sigma_{1} \\sigma_{2}$。\n-   目标投资组合方差：$\\sigma_{p}^2 = 0.085$。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题基于 Markowitz 投资组合理论，这是现代金融学的一个基本概念。投资组合方差的公式是标准公式。所有提供的常数在数值上都是合理的。该问题具有科学依据。\n-   **适定性**：该问题要求找到一个特定的值 $w$，以产生目标方差。这需要解一个关于 $w$ 的方程。该设置导出一个二次方程，这是一个适定的数学问题。\n-   **客观性**：该问题使用了金融学和数学中精确、客观和标准的术语进行陈述。\n-   **完整性**：所有构建和解决问题所需的数据（$\\sigma_1, \\sigma_2, \\rho$, 目标方差）和约束（$w \\in [0,1]$）均已提供。\n-   **一致性**：数据和条件内部一致。不存在矛盾。\n\n**步骤3：结论与行动**\n该问题有效。将提供解答。\n\n一个包含两个资产，权重分别为 $w_{1}$ 和 $w_{2}$ 的投资组合的方差由以下公式给出：\n$$\n\\sigma_{p}^2 = w_{1}^2 \\sigma_{1}^2 + w_{2}^2 \\sigma_{2}^2 + 2 w_{1} w_{2} \\operatorname{Cov}(r_{1}, r_{2})\n$$\n协方差定义为 $\\operatorname{Cov}(r_{1}, r_{2}) = \\rho \\sigma_{1} \\sigma_{2}$。将其代入方差公式，得到：\n$$\n\\sigma_{p}^2 = w_{1}^2 \\sigma_{1}^2 + w_{2}^2 \\sigma_{2}^2 + 2 w_{1} w_{2} \\rho \\sigma_{1} \\sigma_{2}\n$$\n在这个问题中，权重为 $w_{1} = w$ 和 $w_{2} = 1 - w$。我们已知以下数值：$\\sigma_{1} = 0.4$，$\\sigma_{2} = 0.2$ 和 $\\rho = 0.95$。\n让我们将这些值代入方差方程：\n$$\n\\sigma_{p}^2(w) = w^2 \\sigma_{1}^2 + (1-w)^2 \\sigma_{2}^2 + 2w(1-w)\\rho\\sigma_{1}\\sigma_{2}\n$$\n首先，我们计算所需的各项：\n-   资产1的方差：$\\sigma_{1}^2 = (0.4)^2 = 0.16$。\n-   资产2的方差：$\\sigma_{2}^2 = (0.2)^2 = 0.04$。\n-   协方差项：$\\rho \\sigma_{1} \\sigma_{2} = (0.95)(0.4)(0.2) = 0.076$。\n\n现在，我们将这些数值代入 $\\sigma_{p}^2(w)$ 的表达式中：\n$$\n\\sigma_{p}^2(w) = w^2(0.16) + (1-w)^2(0.04) + 2w(1-w)(0.076)\n$$\n为了求出 $w$ 的值，我们展开并简化这个表达式：\n$$\n\\sigma_{p}^2(w) = 0.16w^2 + (1 - 2w + w^2)(0.04) + (2w - 2w^2)(0.076)\n$$\n$$\n\\sigma_{p}^2(w) = 0.16w^2 + 0.04 - 0.08w + 0.04w^2 + 0.152w - 0.152w^2\n$$\n按 $w$ 的幂次对各项进行分组：\n$$\n\\sigma_{p}^2(w) = (0.16 + 0.04 - 0.152)w^2 + (-0.08 + 0.152)w + 0.04\n$$\n$$\n\\sigma_{p}^2(w) = 0.048w^2 + 0.072w + 0.04\n$$\n问题要求投资组合的方差等于目标水平 $0.085$。我们将 $\\sigma_{p}^2(w)$ 的表达式设为这个值：\n$$\n0.048w^2 + 0.072w + 0.04 = 0.085\n$$\n这就形成了一个二次方程。为了解出 $w$，我们将方程重排为标准形式 $Aw^2 + Bw + C = 0$：\n$$\n0.048w^2 + 0.072w + (0.04 - 0.085) = 0\n$$\n$$\n0.048w^2 + 0.072w - 0.045 = 0\n$$\n为了简化系数，我们可以将整个方程乘以 $1000$：\n$$\n48w^2 + 72w - 45 = 0\n$$\n这个方程可以通过将所有项除以它们的最大公约数 $3$ 来进一步简化：\n$$\n16w^2 + 24w - 15 = 0\n$$\n这个问题已经简化为求解一个二次方程的根。虽然像二分法这样的数值算法可以近似求解根，但解析解是精确的，因此更优。我们应用二次公式 $w = \\frac{-B \\pm \\sqrt{B^2-4AC}}{2A}$，其中 $A=16$，$B=24$，$C=-15$。\n\n首先，计算判别式 $\\Delta = B^2 - 4AC$：\n$$\n\\Delta = (24)^2 - 4(16)(-15) = 576 + 960 = 1536\n$$\n现在，求解 $w$ 的根：\n$$\nw = \\frac{-24 \\pm \\sqrt{1536}}{2(16)} = \\frac{-24 \\pm \\sqrt{256 \\times 6}}{32} = \\frac{-24 \\pm 16\\sqrt{6}}{32}\n$$\n简化 $w$ 的表达式：\n$$\nw = \\frac{-3 \\pm 2\\sqrt{6}}{4}\n$$\n这给出了 $w$ 的两个可能的解：\n$$\nw_{1} = \\frac{-3 + 2\\sqrt{6}}{4} \\quad \\text{和} \\quad w_{2} = \\frac{-3 - 2\\sqrt{6}}{4}\n$$\n问题规定不允许卖空，这施加了约束 $w \\in [0,1]$。我们必须检查哪个解落在这个区间内。\n使用近似值 $\\sqrt{6} \\approx 2.449$：\n$$\nw_{1} \\approx \\frac{-3 + 2(2.449)}{4} = \\frac{-3 + 4.898}{4} = \\frac{1.898}{4} \\approx 0.4745\n$$\n这个解 $w_1$ 在区间 $[0,1]$ 内。\n$$\nw_{2} \\approx \\frac{-3 - 2(2.449)}{4} = \\frac{-3 - 4.898}{4} = \\frac{-7.898}{4} \\approx -1.9745\n$$\n这个解 $w_2$ 是负数，因此在允许的区间 $[0,1]$ 之外。它对应于资产1的空头头寸，这是被禁止的。\n\n因此，唯一有效的权重是 $w = \\frac{-3 + 2\\sqrt{6}}{4}$。\n问题要求一个四舍五入到 $6$ 位有效数字的数值答案。\n$$\nw = \\frac{-3 + 2\\sqrt{6}}{4} \\approx 0.474744871...\n$$\n将此值四舍五入到 $6$ 位有效数字，得到 $0.474745$。", "answer": "$$\n\\boxed{0.474745}\n$$", "id": "2438015"}, {"introduction": "在掌握了基本计算之后，这个思想实验将挑战我们的直觉。我们将分析一个预期收益率 $\\mathbb{E}[R_i]$ 恰好等于无风险利率 $R_f$ 的风险资产，是否应该被纳入最优投资组合中。这项练习揭示了资产间的协方差在多元化投资中扮演的强大且时而反直觉的角色，强调了不能仅凭单个资产的特性来评判其在投资组合中的价值。[@problem_id:2442560]", "problem": "考虑一个标准的均值-方差框架，其中存在 $N \\ge 2$ 种风险资产，其超额收益向量为 $R - R_f \\mathbf{1}$，其中预期收益为 $\\boldsymbol{\\mu} = \\mathbb{E}[\\mathbf{R}]$，无风险利率为 $R_f$，$\\mathbf{1}$ 是一个 $N \\times 1$ 的全1向量，风险收益的协方差矩阵为 $\\boldsymbol{\\Sigma}$，且该矩阵是对称正定的。假设投资者可以按无风险利率 $R_f$ 无限借贷，并且允许卖空风险资产。支撑资本配置线（CAL）的最优风险资产组合是唯一的切点投资组合。\n\n假设某一种特定的风险资产 $i$ 满足 $\\mathbb{E}[R_i] = R_f$ 且 $\\operatorname{Var}(R_i) > 0$。\n\n关于切点投资组合的构成，以下哪项陈述是正确的？\n\nA. 由于资产 $i$ 的独立夏普比率为零，其在切点投资组合中的权重必须为零。\n\nB. 尽管 $\\mathbb{E}[R_i] = R_f$，但由于资产 $i$ 与其他资产的协方差关系，它在切点投资组合中仍可能获得非零权重。\n\nC. 如果禁止卖空，为了改善分散化效果，资产 $i$ 必须以严格为正的权重进入切点投资组合。\n\nD. 如果资产 $i$ 与所有其他风险资产不相关，则其在切点投资组合中的权重为零。\n\nE. 相对于不包含资产 $i$ 的可投资域，将资产 $i$ 加入该域中不会改变资本配置线（CAL）的斜率。", "solution": "对问题陈述进行验证。\n\n**步骤1：提取已知条件**\n- 我们处于一个标准的均值-方差框架中。\n- 存在 $N \\ge 2$ 种风险资产。\n- 超额收益向量为 $\\mathbf{R} - R_f \\mathbf{1}$。\n- 预期收益向量为 $\\boldsymbol{\\mu} = \\mathbb{E}[\\mathbf{R}]$。\n- 无风险利率为 $R_f$。\n- $\\mathbf{1}$ 是一个 $N \\times 1$ 的全1向量。\n- 风险收益的协方差矩阵为 $\\boldsymbol{\\Sigma}$，且该矩阵是对称正定的。\n- 投资者可以按无风险利率 $R_f$ 无限借贷。\n- 允许对风险资产进行卖空。\n- 最优风险资产组合是支撑资本配置线（CAL）的唯一切点投资组合。\n- 对于一种特定的风险资产 $i$，给定条件为 $\\mathbb{E}[R_i] = R_f$ 且 $\\operatorname{Var}(R_i) > 0$。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据，植根于成熟的 Markowitz 投资组合理论。均值-方差优化、切点投资组合和资本配置线等概念是金融经济学中的标准内容。语言严谨客观。定义该问题所需的所有要素均已提供：一组具有已知预期收益 $\\boldsymbol{\\mu}$ 和正定协方差矩阵 $\\boldsymbol{\\Sigma}$ 的风险资产，以及一种无风险资产。关于资产 $i$ 的条件，即 $\\mathbb{E}[R_i] = R_f$ 且 $\\operatorname{Var}(R_i) > 0$，是在此框架下的一个具体且明确定义的情景。一个隐含的假设（对此类问题而言是标准的）是，并非所有风险资产的预期收益都等于无风险利率，即 $\\boldsymbol{\\mu} \\ne R_f \\mathbf{1}$，这确保了存在一个非平凡的切点投资组合。该问题提法恰当且内部一致。\n\n**步骤3：结论与行动**\n问题陈述有效。将推导解答。\n\n切点投资组合是使夏普比率最大化的风险资产组合。其权重向量 $\\mathbf{w}_{TP}$ 与能带来最高夏普比率的无约束优化问题的解成比例。未归一化的权重，记为 $\\mathbf{w}^*$，由以下公式给出：\n$$ \\mathbf{w}^* = k \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_e $$\n其中 $k$ 为某个正的比例常数。这里，$\\boldsymbol{\\mu}_e$ 是相对于无风险利率的预期超额收益向量：\n$$ \\boldsymbol{\\mu}_e = \\boldsymbol{\\mu} - R_f \\mathbf{1} $$\n资产 $j$ 的单个未归一化权重 $w_j^*$ 由该向量乘积的第 $j$ 个分量给出：\n$$ w_j^* = k \\sum_{l=1}^N (\\boldsymbol{\\Sigma}^{-1})_{jl} (\\mu_l - R_f) $$\n我们关心的是资产 $i$ 的权重，对于该资产我们有特定条件 $\\mu_i = \\mathbb{E}[R_i] = R_f$。这意味着预期超额收益向量的第 $i$ 个分量为零：$(\\boldsymbol{\\mu}_e)_i = \\mu_i - R_f = 0$。\n\n我们写出资产 $i$ 的未归一化权重 $w_i^*$ 的表达式：\n$$ w_i^* = k \\sum_{l=1}^N (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f) $$\n我们可以将 $l=i$ 的项从求和中分离出来：\n$$ w_i^* = k \\left( (\\boldsymbol{\\Sigma}^{-1})_{ii} (\\mu_i - R_f) + \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f) \\right) $$\n代入给定条件 $\\mu_i - R_f = 0$：\n$$ w_i^* = k \\left( (\\boldsymbol{\\Sigma}^{-1})_{ii} \\cdot 0 + \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f) \\right) = k \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f) $$\n归一化权重 $w_{i,TP}$ 为 $w_i^* / (\\mathbf{1}^T \\mathbf{w}^*)$。如果 $w_i^* = 0$，则 $w_{i,TP} = 0$。如果 $w_i^* \\ne 0$，则 $w_{i,TP} \\ne 0$，前提是切点投资组合本身是良定的（即 $\\mathbf{1}^T \\mathbf{w}^* \\ne 0$）。\n\n我们现在评估每个陈述。\n\n**A. 由于资产 $i$ 的独立夏普比率为零，其在切点投资组合中的权重必须为零。**\n资产 $i$ 的独立夏普比率确实是 $(\\mu_i - R_f) / \\sigma_i = 0$，因为 $\\mu_i=R_f$ 且 $\\sigma_i = \\sqrt{\\operatorname{Var}(R_i)} > 0$。然而，其权重*必须*为零的结论是不正确的。我们推导出的 $w_i^*$ 公式为 $k \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f)$。这个和通常不等于零。当 $l \\neq i$ 时，项 $(\\boldsymbol{\\Sigma}^{-1})_{il}$ 是逆协方差矩阵的非对角元素，如果资产 $i$ 与其他资产相关，这些元素通常不为零。如果至少存在另一个资产 $l$，其超额收益 $\\mu_l - R_f \\neq 0$，且对应的逆协方差项 $(\\boldsymbol{\\Sigma}^{-1})_{il}$ 也非零，那么权重 $w_i^*$ 就可能非零。这种非零权重的产生源于资产 $i$ 在投资组合中提供的分散化益处（或对冲作用），而这是其独立特征所无法体现的。\n**结论：不正确。**\n\n**B. 尽管 $\\mathbb{E}[R_i] = R_f$，但由于资产 $i$ 与其他资产的协方差关系，它在切点投资组合中仍可能获得非零权重。**\n该陈述声称 $w_i^*$ 可能为非零。正如通用公式 $w_i^* = k \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f)$ 所示，非零权重确实是可能的。矩阵 $\\boldsymbol{\\Sigma}^{-1}$（精度矩阵）反映了资产的整体协方差结构。除非其他资产超额收益的加权和（权重为精度矩阵第 $i$ 行的元素）恰好为零，否则资产 $i$ 将获得非零权重。但这并非普遍情况。因此，资产 $i$ 与其他资产的协方差可以，并且通常会导致，其权重非零。\n**结论：正确。**\n\n**C. 如果禁止卖空，为了改善分散化效果，资产 $i$ 必须以严格为正的权重进入切点投资组合。**\n在所有 $j$ 都满足 $w_j \\ge 0$ 的约束下，解可以通过 Kuhn-Tucker 条件找到。一个权重 $w_j=0$ 的资产 $j$ 只有在它对投资组合夏普比率的边际贡献为正时，才能以正权重进入组合。投资组合 $P$ 的夏普比率 $S_P$ 相对于微量增加资产 $i$ 的边际变化由 $\\frac{\\partial S_P}{\\partial w_i}$ 给出。由于 $\\mu_i - R_f = 0$，当 $w_i = 0$ 时，该导数简化为与 $-\\operatorname{Cov}(R_i, R_P)$ 成正比，其中 $R_P$ 是由其他资产构成的最优投资组合的收益。要使资产 $i$ 以严格为正的权重进入组合，该导数必须为正。这要求 $\\operatorname{Cov}(R_i, R_P) < 0$。也就是说，资产 $i$ 必须与由其他可用资产构成的切点投资组合呈负相关。这个条件并非总能满足。如果协方差为非负，资产 $i$ 的最优权重将为零。因此，它*必须*进入组合的说法是错误的。\n**结论：不正确。**\n\n**D. 如果资产 $i$ 与所有其他风险资产不相关，则其在切点投资组合中的权重为零。**\n资产 $i$ 与所有其他风险资产不相关的条件意味着对所有 $l \\neq i$ 都有 $\\Sigma_{il} = \\operatorname{Cov}(R_i, R_l) = 0$。这意味着协方差矩阵 $\\boldsymbol{\\Sigma}$ 的第 $i$ 行和第 $i$ 列除了对角元素 $\\Sigma_{ii} = \\sigma_i^2$ 外，所有条目都为零。对于其逆矩阵 $\\boldsymbol{\\Sigma}^{-1}$，这种结构意味着其第 $i$ 行和第 $i$ 列也除了对角元素外都为零。具体来说，对所有 $l \\neq i$ 都有 $(\\boldsymbol{\\Sigma}^{-1})_{il} = 0$，且 $(\\boldsymbol{\\Sigma}^{-1})_{ii} = 1/\\Sigma_{ii} = 1/\\sigma_i^2$。\n将此代入我们的 $w_i^*$ 公式中：\n$$ w_i^* = k \\left( (\\boldsymbol{\\Sigma}^{-1})_{ii} (\\mu_i - R_f) + \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f) \\right) $$\n$$ w_i^* = k \\left( \\frac{1}{\\sigma_i^2} \\cdot 0 + \\sum_{l \\neq i} 0 \\cdot (\\mu_l - R_f) \\right) = 0 $$\n由于未归一化的权重 $w_i^*$ 为零，归一化的权重 $w_{i,TP}$ 也必须为零。一个超额收益为零且与所有其他资产不相关的资产，既不提供收益溢价，也无分散化益处，因此从逻辑上讲，它被排除在最优风险资产组合之外。\n**结论：正确。**\n\n**E. 相对于不包含资产 $i$ 的可投资域，将资产 $i$ 加入该域中不会改变资本配置线（CAL）的斜率。**\n资本配置线（CAL）的斜率是切点投资组合的夏普比率 $S_{TP}$。向一个可投资域中添加新资产永远不会降低可实现的最大夏普比率；它要么保持不变，要么增加。问题是斜率是否可能增加。设 $S_A$ 是不含资产 $i$ 的可投资域的最大夏普比率，而 $S_B$ 是包含资产 $i$ 的可投资域的最大夏普比率。可以证明，两个平方夏普比率之间的关系是：\n$$ S_B^2 = S_A^2 + \\frac{(\\mu_i - R_f - \\operatorname{Cov}(R_i, R_{TP_A})\\frac{\\mu_{TP_A}-R_f}{\\sigma_{TP_A}^2})^2}{\\sigma_i^2(1-\\rho_{i,TP_A}^2)} \\ge S_A^2 $$\n由于 $\\mu_i - R_f = 0$, 该公式简化为：\n$$ S_B^2 = S_A^2 + \\frac{(-\\operatorname{Cov}(R_i, R_{TP_A})\\frac{S_A}{\\sigma_{TP_A}})^2}{\\sigma_i^2(1-\\rho_{i,TP_A}^2)} = S_A^2 + \\frac{\\operatorname{Cov}(R_i, R_{TP_A})^2 S_A^2}{\\sigma_{TP_A}^2 \\sigma_i^2(1-\\rho_{i,TP_A}^2)} $$\n其中 $R_{TP_A}$ 是原始可投资域的切点投资组合收益。只要资产 $i$ 与原始切点组合相关（即 $\\operatorname{Cov}(R_i, R_{TP_A}) \\ne 0$），夏普比率就会严格增加（$S_B > S_A$）。在一般情况下，此协方差不为零。因此，增加资产 $i$ 通常会改变（增加）资本配置线的斜率。声称它“不会改变”是错误的。\n**结论：不正确。**", "answer": "$$\\boxed{BD}$$", "id": "2442560"}, {"introduction": "在现实世界中，投资者常常面临如禁止卖空等限制（即权重 $\\boldsymbol{w} \\succeq \\boldsymbol{0}$）。最后的这项练习将理论与计算实践相结合，要求你量化此类限制带来的影响。你将对比在理想化的无限制世界和更现实的受限环境中，可达到的最大夏普比率 $S_{\\text{unconstrained}}^\\star$ 和 $S_{\\text{constrained}}^\\star$，并以可量化的“成本”来衡量该限制所导致的潜在表现损失。[@problem_id:2442592]", "problem": "您将处理一系列独立的 Markowitz 均值-方差投资组合选择环境实例。在每个实例中，存在有限数量的风险资产，其期望收益向量为 $\\boldsymbol{\\mu} \\in \\mathbb{R}^n$（以每期小数表示），协方差矩阵为对称正定的 $\\boldsymbol{\\Sigma} \\in \\mathbb{R}^{n \\times n}$（每期方差）。此外，存在一个无风险资产，其收益率为 $r_f$（以每期小数表示）。一个投资组合由风险资产的权重向量 $\\boldsymbol{w} \\in \\mathbb{R}^n$ 表示，该向量满足预算约束 $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$，其中 $\\boldsymbol{1}$ 是全一向量。投资组合 $\\boldsymbol{w}$ 的期望收益为 $\\mathbb{E}[R_p] = \\boldsymbol{\\mu}^\\top \\boldsymbol{w}$，其方差为 $\\operatorname{Var}(R_p) = \\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}$。投资组合 $\\boldsymbol{w}$ 相对于无风险利率 $r_f$ 的夏普比率定义为\n$$\nS(\\boldsymbol{w}) = \\frac{\\boldsymbol{\\mu}^\\top \\boldsymbol{w} - r_f}{\\sqrt{\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}}}.\n$$\n切点投资组合是满足 $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$ 且最大化 $S(\\boldsymbol{w})$ 的任何投资组合 $\\boldsymbol{w}$。考虑切点投资组合问题的两个版本：\n- 无约束：$\\boldsymbol{w}$ 可以有负分量（允许卖空）。\n- 无卖空约束：$\\boldsymbol{w} \\succeq \\boldsymbol{0}$ 逐分量成立（禁止卖空）。\n\n将无卖空约束的成本定义为无约束和有约束的切点投资组合的夏普比率之间的非负差值：\n$$\n\\text{cost} = S_{\\text{unconstrained}}^\\star - S_{\\text{constrained}}^\\star,\n$$\n该成本以小数形式表示（无百分号）。\n\n从上述基本定义出发，实现一个程序，对下文的每个测试实例，计算无约束切点投资组合的夏普比率、无卖空约束切点投资组合的夏普比率，并返回成本。成本应为一个浮点数，四舍五入到小数点后六位。程序不得假设任何超出所述金融解释的资产单位，且所有输出必须是小数形式，无百分号。\n\n测试套件（每个案例为 $(\\boldsymbol{\\mu}, \\boldsymbol{\\Sigma}, r_f)$）：\n\n- 案例 $1$：\n  - $\\boldsymbol{\\mu} = [\\,0.12,\\,0.10,\\,0.07\\,]$\n  - $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n  0.040 & 0.006 & 0.004\\\\\n  0.006 & 0.0225 & 0.0025\\\\\n  0.004 & 0.0025 & 0.010\n  \\end{bmatrix}$\n  - $r_f = 0.03$\n\n- 案例 $2$：\n  - $\\boldsymbol{\\mu} = [\\,0.14,\\,0.08,\\,0.06\\,]$\n  - $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n  0.050 & 0.010 & 0.008\\\\\n  0.010 & 0.040 & 0.012\\\\\n  0.008 & 0.012 & 0.030\n  \\end{bmatrix}$\n  - $r_f = 0.03$\n\n- 案例 $3$：\n  - $\\boldsymbol{\\mu} = [\\,0.11,\\,0.13,\\,0.09,\\,0.07\\,]$\n  - $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n  0.030 & 0.012 & 0.006 & -0.003\\\\\n  0.012 & 0.050 & 0.009 & 0.000\\\\\n  0.006 & 0.009 & 0.020 & 0.004\\\\\n  -0.003 & 0.000 & 0.004 & 0.015\n  \\end{bmatrix}$\n  - $r_f = 0.02$\n\n- 案例 $4$：\n  - $\\boldsymbol{\\mu} = [\\,0.09,\\,0.07\\,]$\n  - $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n  0.015 & 0.006\\\\\n  0.006 & 0.025\n  \\end{bmatrix}$\n  - $r_f = 0.03$\n\n您的程序应产生单行输出，其中包含所有案例的结果，形式为由方括号括起来的逗号分隔列表，例如 $[\\,x_1, x_2, x_3, x_4\\,]$，其中每个 $x_i$ 是计算出的成本，四舍五入到小数点后六位。必须只打印这一行。", "solution": "所述问题是有效的。它以已确立的 Markowitz 均值-方差优化框架为科学基础，在数学上是适定的，并且所有必要的数据和约束都已提供。我们可以进行形式化的求解。\n\n该问题要求计算在 Markowitz 切点投资组合上施加无卖空约束所带来的成本。该成本定义为无约束和有约束优化问题中可实现的最大夏普比率之差。我们将依次分析每个优化问题以构建解决方案。\n\n设 $\\boldsymbol{\\mu} \\in \\mathbb{R}^n$ 为期望收益向量，$r_f$ 为无风险利率，$\\boldsymbol{\\Sigma} \\in \\mathbb{R}^{n \\times n}$ 为 $n$ 种风险资产的对称正定协方差矩阵。超出无风险利率的超额收益向量表示为 $\\boldsymbol{\\mu}_e = \\boldsymbol{\\mu} - r_f\\boldsymbol{1}$，其中 $\\boldsymbol{1}$ 是全一向量。对于权重为 $\\boldsymbol{w} \\in \\mathbb{R}^n$ 的投资组合，其夏普比率由下式给出：\n$$\nS(\\boldsymbol{w}) = \\frac{\\boldsymbol{\\mu}^\\top \\boldsymbol{w} - r_f}{\\sqrt{\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}}} = \\frac{\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w}}{\\sqrt{\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}}}.\n$$\n问题在于找到在不同约束集下能最大化 $S(\\boldsymbol{w})$ 的投资组合权重 $\\boldsymbol{w}$。\n\n首先，我们处理无约束切点投资组合问题。该优化问题是在预算约束 $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$ 下最大化 $S(\\boldsymbol{w})$。夏普比率的一个关键性质是其对权重 $\\boldsymbol{w}$ 正向缩放的不变性。这使得我们可以对问题进行重构，从而更易于求解。最大化 $S(\\boldsymbol{w})$ 等价于在固定投资组合超额收益水平（例如 $\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w} = 1$）的约束下，最小化投资组合方差 $\\frac{1}{2}\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}$。要找到最大夏普比率本身，并不需要预算约束 $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$，但该约束用于确定切点投资组合的具体权重，这可以通过对简化问题的解进行缩放得到。该简化问题的拉格朗日函数为 $\\mathcal{L}(\\boldsymbol{w}, \\lambda) = \\frac{1}{2}\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w} - \\lambda(\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w} - 1)$。一阶条件 $\\nabla_{\\boldsymbol{w}}\\mathcal{L} = \\boldsymbol{\\Sigma}\\boldsymbol{w} - \\lambda\\boldsymbol{\\mu}_e = \\boldsymbol{0}$ 意味着 $\\boldsymbol{w} = \\lambda \\boldsymbol{\\Sigma}^{-1}\\boldsymbol{\\mu}_e$。将此代入约束 $\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w} = 1$ 中，得到 $\\lambda = (\\boldsymbol{\\mu}_e^\\top \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_e)^{-1}$。解决该子问题的投资组合方差为 $\\tilde{\\boldsymbol{w}}^\\top \\boldsymbol{\\Sigma} \\tilde{\\boldsymbol{w}} = (\\boldsymbol{\\mu}_e^\\top \\boldsymbol{\\Sigma}^{-1}\\boldsymbol{\\mu}_e)^{-1}$。其夏普比率 $S = (\\boldsymbol{\\mu}_e^\\top \\tilde{\\boldsymbol{w}}) / \\sqrt{\\tilde{\\boldsymbol{w}}^\\top \\boldsymbol{\\Sigma} \\tilde{\\boldsymbol{w}}} = 1 / \\sqrt{(\\boldsymbol{\\mu}_e^\\top \\boldsymbol{\\Sigma}^{-1}\\boldsymbol{\\mu}_e)^{-1}}$。因此，无约束情况下的最大夏普比率由以下解析公式给出：\n$$\nS_{\\text{unconstrained}}^\\star = \\sqrt{\\boldsymbol{\\mu}_e^\\top \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_e} = \\sqrt{(\\boldsymbol{\\mu} - r_f\\boldsymbol{1})^\\top \\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\mu} - r_f\\boldsymbol{1})}.\n$$\n\n接着，我们处理无卖空约束的切点投资组合问题。该优化问题增加了约束 $\\boldsymbol{w} \\succeq \\boldsymbol{0}$（逐分量非负）。问题是在满足 $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$ 和 $\\boldsymbol{w} \\succeq \\boldsymbol{0}$ 的条件下最大化 $S(\\boldsymbol{w})$。利用同样的尺度不变性原理，该问题可以转化为一个二次规划 (QP) 问题。我们在遵守非负约束的同时，针对固定的超额收益水平最小化方差。该二次规划问题可表述如下：\n$$\n\\begin{aligned}\n& \\underset{\\boldsymbol{w} \\in \\mathbb{R}^n}{\\text{minimize}}\n& & \\frac{1}{2} \\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w} \\\\\n& \\text{subject to}\n& & \\boldsymbol{\\mu}_e^\\top \\boldsymbol{w} = 1 \\\\\n& & & \\boldsymbol{w} \\succeq \\boldsymbol{0}.\n\\end{aligned}\n$$\n这是一个凸优化问题，因为目标函数是凸的（由于 $\\boldsymbol{\\Sigma}$ 是正定的），且约束是线性的。该问题没有通用的解析解，必须进行数值求解。设 $\\boldsymbol{w}_c^\\star$ 为解此二次规划问题的最优权重向量。在这些约束下实现的最小方差为 $(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star$。相应的最大夏普比率从目标值中推导得出：$S = (\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w}_c^\\star) / \\sqrt{(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star} = 1 / \\sqrt{(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star}$。因此，有约束情况下的最大夏普比率为：\n$$\nS_{\\text{constrained}}^\\star = \\frac{1}{\\sqrt{(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star}}.\n$$\n\n最后，无卖空约束的成本计算为两个最大夏普比率之间的非负差值：\n$$\n\\text{cost} = S_{\\text{unconstrained}}^\\star - S_{\\text{constrained}}^\\star.\n$$\n对每个测试实例的计算算法如下：\n$1$. 构建超额收益向量 $\\boldsymbol{\\mu}_e = \\boldsymbol{\\mu} - r_f\\boldsymbol{1}$。\n$2$. 计算协方差矩阵的逆 $\\boldsymbol{\\Sigma}^{-1}$。\n$3$. 使用上文推导的解析公式计算 $S_{\\text{unconstrained}}^\\star$。\n$4$. 数值求解二次规划问题，找到有约束问题的最优权重 $\\boldsymbol{w}_c^\\star$。\n$5$. 根据解 $\\boldsymbol{w}_c^\\star$，计算相应的投资组合方差 $(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star$，并随后求得 $S_{\\text{constrained}}^\\star$。\n$6$. 计算成本并将结果四舍五入到指定的小数点后六位精度。\n将对每个给定的测试实例实施此过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Computes the cost of the no-short-selling constraint for a series of\n    Markowitz portfolio optimization problems.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: mu, Sigma, rf\n        (np.array([0.12, 0.10, 0.07]),\n         np.array([[0.040, 0.006, 0.004],\n                   [0.006, 0.0225, 0.0025],\n                   [0.004, 0.0025, 0.010]]),\n         0.03),\n        # Case 2: mu, Sigma, rf\n        (np.array([0.14, 0.08, 0.06]),\n         np.array([[0.050, 0.010, 0.008],\n                   [0.010, 0.040, 0.012],\n                   [0.008, 0.012, 0.030]]),\n         0.03),\n        # Case 3: mu, Sigma, rf\n        (np.array([0.11, 0.13, 0.09, 0.07]),\n         np.array([[0.030, 0.012, 0.006, -0.003],\n                   [0.012, 0.050, 0.009, 0.000],\n                   [0.006, 0.009, 0.020, 0.004],\n                   [-0.003, 0.000, 0.004, 0.015]]),\n         0.02),\n        # Case 4: mu, Sigma, rf\n        (np.array([0.09, 0.07]),\n         np.array([[0.015, 0.006],\n                   [0.006, 0.025]]),\n         0.03)\n    ]\n\n    results = []\n    for mu, Sigma, rf in test_cases:\n        n = len(mu)\n        mu_e = mu - rf\n\n        # 1. Unconstrained Tangency Portfolio Sharpe Ratio\n        Sigma_inv = np.linalg.inv(Sigma)\n        # S_unconstrained^2 = mu_e.T * Sigma_inv * mu_e\n        s_unconstrained_sq = mu_e.T @ Sigma_inv @ mu_e\n        s_unconstrained = np.sqrt(s_unconstrained_sq)\n\n        # 2. Constrained (No-Short-Selling) Tangency Portfolio Sharpe Ratio\n        # We solve the QP: min 0.5 * w.T * Sigma * w, s.t. mu_e.T * w = 1 and w >= 0\n        \n        # Objective function to minimize\n        def objective_func(w, S):\n            return 0.5 * w.T @ S @ w\n\n        # Equality constraint: mu_e.T * w - 1 = 0\n        cons = ({'type': 'eq',\n                 'fun': lambda w, me: me.T @ w - 1,\n                 'args': (mu_e,)})\n        \n        # Bounds for weights: w_i >= 0 for all i\n        bnds = tuple((0, None) for _ in range(n))\n        \n        # Initial guess: a feasible point satisfying constraints.\n        # An equal weight portfolio is scaled to meet the equality constraint.\n        w0_init = np.ones(n) / n\n        w0 = w0_init / (mu_e.T @ w0_init)\n\n        # Solve the Quadratic Program using SLSQP\n        qp_result = minimize(objective_func, w0, args=(Sigma,), method='SLSQP',\n                             bounds=bnds, constraints=cons)\n        \n        # w_c_star is the solution to the QP\n        w_c_star = qp_result.x\n        \n        # The minimized variance is w_c_star.T * Sigma * w_c_star = 2 * qp_result.fun\n        # S_constrained = 1 / sqrt(variance)\n        variance_constrained = w_c_star.T @ Sigma @ w_c_star\n        s_constrained = 1 / np.sqrt(variance_constrained)\n        \n        # 3. Cost of the no-short-selling constraint\n        cost = s_unconstrained - s_constrained\n        results.append(cost)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "2442592"}]}