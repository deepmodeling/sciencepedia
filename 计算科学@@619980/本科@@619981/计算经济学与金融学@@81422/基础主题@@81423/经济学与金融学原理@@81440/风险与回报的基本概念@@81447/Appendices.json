{"hands_on_practices": [{"introduction": "理论学习之后，最重要的是将其付诸实践。本练习将风险和收益的抽象概念置于一个具体的计算场景中：评估一种其收益依赖于标的资产已实现方差的金融衍生品。通过在一个离散的状态空间模型中逐步操作，您将掌握计算任何投资的预期收益、方差和夏普比率（Sharpe Ratio）的核心技能 [@problem_id:2374893]。这是一个巩固基本功、为更复杂的风险评估任务打下坚实基础的关键练习。", "problem": "一位投资者正在考虑一份欧式衍生品，该衍生品以某标的资产在连续两个交易日内的连续复利回报率的已实现方差为标的。第1天的连续复利回报率为 $r_{1}$，第2天的连续复利回报率为 $r_{2}$。这两天期内的已实现方差定义为\n$$\n\\sigma_{\\text{realized}}^{2} \\equiv \\frac{r_{1}^{2} + r_{2}^{2}}{2}.\n$$\n该衍生品在第2天结束时支付的金额为\n$$\n\\max\\{0, \\ \\sigma_{\\text{realized}}^{2} - K\\},\n$$\n其中行权价 $K = 0.0005$。该衍生品在时间0的初始成本为 $C_{0} = 0.00004$。\n\n假设每日连续复利回报率服从以下物理（客观）概率，且两天之间相互独立：\n- 在第1天，$r_{1} = 0.02$ 的概率为 $0.6$，$r_{1} = -0.03$ 的概率为 $0.4$。\n- 在第2天，$r_{2} = 0.015$ 的概率为 $0.7$，$r_{2} = -0.025$ 的概率为 $0.3$。\n\n投资者使用两天期内的简单净持有期回报率来评估该头寸，\n$$\nR \\equiv \\frac{\\text{Payoff} - C_{0}}{C_{0}},\n$$\n且同一时期内的无风险简单净回报率为 $r_{f} = 0.001$。\n\n在给定的物理概率下，计算该衍生品的两天持有期回报率相对于无风险简单回报率的夏普比率，其定义为\n$$\n\\frac{\\mathbb{E}[R] - r_{f}}{\\sqrt{\\operatorname{Var}(R)}},\n$$\n请提供一个四舍五入到四位有效数字的单一数值。", "solution": "该问题陈述已经过核实，是一个定义明确且具有科学依据的量化金融问题。我们开始解答。\n\n该问题要求计算一个衍生品头寸的夏普比率。夏普比率定义为：\n$$\n\\text{Sharpe Ratio} = \\frac{\\mathbb{E}[R] - r_{f}}{\\sqrt{\\operatorname{Var}(R)}}\n$$\n其中 $R$ 是衍生品的简单净持有期回报率，$r_f$ 是无风险简单净回报率。为了计算该比率，我们必须首先确定 $R$ 的概率分布。回报率 $R$ 取决于衍生品的支付额，而支付额又取决于已实现方差 $\\sigma_{\\text{realized}}^{2}$。\n\n第1天的连续复利回报率 $r_1$ 和第2天的 $r_2$ 是独立的随机变量。对于数组 $(r_1, r_2)$，存在四种可能的世界状态。我们将逐一分析每种状态。\n\n设 $r_1$ 的可能值为 $r_{1,u} = 0.02$ 和 $r_{1,d} = -0.03$，其概率分别为 $P(r_{1,u}) = 0.6$ 和 $P(r_{1,d}) = 0.4$。\n设 $r_2$ 的可能值为 $r_{2,u} = 0.015$ 和 $r_{2,d} = -0.025$，其概率分别为 $P(r_{2,u}) = 0.7$ 和 $P(r_{2,d}) = 0.3$。\n\n四种可能的状态及其（因为独立性）联合概率为：\n1.  状态1：$(r_1, r_2) = (0.02, 0.015)$。概率 $P_1 = 0.6 \\times 0.7 = 0.42$。\n2.  状态2：$(r_1, r_2) = (0.02, -0.025)$。概率 $P_2 = 0.6 \\times 0.3 = 0.18$。\n3.  状态3：$(r_1, r_2) = (-0.03, 0.015)$。概率 $P_3 = 0.4 \\times 0.7 = 0.28$。\n4.  状态4：$(r_1, r_2) = (-0.03, -0.025)$。概率 $P_4 = 0.4 \\times 0.3 = 0.12$。\n\n对于每种状态，我们计算已实现方差 $\\sigma_{\\text{realized}}^{2} = \\frac{r_{1}^{2} + r_{2}^{2}}{2}$。\n1.  状态1：$\\sigma_{1, \\text{realized}}^{2} = \\frac{(0.02)^{2} + (0.015)^{2}}{2} = \\frac{0.0004 + 0.000225}{2} = 0.0003125$。\n2.  状态2：$\\sigma_{2, \\text{realized}}^{2} = \\frac{(0.02)^{2} + (-0.025)^{2}}{2} = \\frac{0.0004 + 0.000625}{2} = 0.0005125$。\n3.  状态3：$\\sigma_{3, \\text{realized}}^{2} = \\frac{(-0.03)^{2} + (0.015)^{2}}{2} = \\frac{0.0009 + 0.000225}{2} = 0.0005625$。\n4.  状态4：$\\sigma_{4, \\text{realized}}^{2} = \\frac{(-0.03)^{2} + (-0.025)^{2}}{2} = \\frac{0.0009 + 0.000625}{2} = 0.0007625$。\n\n接下来，我们计算衍生品的支付额，$\\text{Payoff} = \\max\\{0, \\sigma_{\\text{realized}}^{2} - K\\}$，其中行权价 $K = 0.0005$。\n1.  状态1：$\\text{Payoff}_1 = \\max\\{0, 0.0003125 - 0.0005\\} = 0$。\n2.  状态2：$\\text{Payoff}_2 = \\max\\{0, 0.0005125 - 0.0005\\} = 0.0000125$。\n3.  状态3：$\\text{Payoff}_3 = \\max\\{0, 0.0005625 - 0.0005\\} = 0.0000625$。\n4.  状态4：$\\text{Payoff}_4 = \\max\\{0, 0.0007625 - 0.0005\\} = 0.0002625$。\n\n现在，我们计算简单净持有期回报率 $R = \\frac{\\text{Payoff} - C_{0}}{C_{0}}$，其中初始成本 $C_0 = 0.00004$。\n1.  状态1：$R_1 = \\frac{0 - 0.00004}{0.00004} = -1$。\n2.  状态2：$R_2 = \\frac{0.0000125 - 0.00004}{0.00004} = 0.3125 - 1 = -0.6875$。\n3.  状态3：$R_3 = \\frac{0.0000625 - 0.00004}{0.00004} = 1.5625 - 1 = 0.5625$。\n4.  状态4：$R_4 = \\frac{0.0002625 - 0.00004}{0.00004} = 6.5625 - 1 = 5.5625$。\n\n我们得到了随机变量 $R$ 的概率分布：\n- $R_1 = -1$，概率为 $P_1 = 0.42$。\n- $R_2 = -0.6875$，概率为 $P_2 = 0.18$。\n- $R_3 = 0.5625$，概率为 $P_3 = 0.28$。\n- $R_4 = 5.5625$，概率为 $P_4 = 0.12$。\n\n期望回报率 $\\mathbb{E}[R]$ 为：\n$$\n\\mathbb{E}[R] = \\sum_{i=1}^{4} R_i P_i = (-1)(0.42) + (-0.6875)(0.18) + (0.5625)(0.28) + (5.5625)(0.12)\n$$\n$$\n\\mathbb{E}[R] = -0.42 - 0.12375 + 0.1575 + 0.6675 = 0.28125\n$$\n为了求方差，我们首先计算二阶矩 $\\mathbb{E}[R^2]$：\n$$\n\\mathbb{E}[R^2] = \\sum_{i=1}^{4} R_i^2 P_i = (-1)^2(0.42) + (-0.6875)^2(0.18) + (0.5625)^2(0.28) + (5.5625)^2(0.12)\n$$\n$$\n\\mathbb{E}[R^2] = (1)(0.42) + (0.47265625)(0.18) + (0.31640625)(0.28) + (30.94140625)(0.12)\n$$\n$$\n\\mathbb{E}[R^2] = 0.42 + 0.085078125 + 0.08859375 + 3.71296875 = 4.306640625\n$$\n$R$ 的方差为 $\\operatorname{Var}(R) = \\mathbb{E}[R^2] - (\\mathbb{E}[R])^2$：\n$$\n\\operatorname{Var}(R) = 4.306640625 - (0.28125)^2 = 4.306640625 - 0.0791015625 = 4.2275390625\n$$\n$R$ 的标准差为 $\\sigma_R = \\sqrt{\\operatorname{Var}(R)}$：\n$$\n\\sigma_R = \\sqrt{4.2275390625} \\approx 2.056098018\n$$\n最后，我们计算夏普比率。给定的无风险回报率为 $r_f = 0.001$。\n$$\n\\text{Sharpe Ratio} = \\frac{\\mathbb{E}[R] - r_{f}}{\\sigma_R} = \\frac{0.28125 - 0.001}{2.056098018} = \\frac{0.28025}{2.056098018} \\approx 0.136301\n$$\n将结果四舍五入到四位有效数字，得到 $0.1363$。", "answer": "$$\n\\boxed{0.1363}\n$$", "id": "2374893"}, {"introduction": "超越简单的均值-方差分析，成熟的投资者会主动管理其投资组合回报的“形态”。本练习引入了投资组合的凸性（Convexity，在衍生品领域也称为“Gamma”），它衡量了投资组合对市场变化的敏感度是如何变化的。您将通过约束优化来构建一个“德尔塔中性”($\\Delta$-neutral)的投资组合，这个组合能够从市场的大幅波动中获利，而非依赖于市场方向 [@problem_id:2374842]。这项实践让您深入了解高级对冲策略以及如何创造针对市场波动率本身的投资工具，这是现代风险管理和衍生品定价的核心思想。", "problem": "考虑一个单期经济，其中市场因子的期间总回报由随机变量 $R_{m}$ 表示。假设 $R_{m}$ 服从均值为 $0$、方差为 $\\sigma_{m}^{2}$ 的正态分布，即 $R_{m} \\sim \\mathcal{N}(0,\\sigma_{m}^{2})$，其中 $\\sigma_{m} > 0$。您可以构建一个静态因子模拟投资组合，其实际回报是 $R_{m}$ 的一个确定性函数，形式如下：\n$$\nr_{p}(R_{m}) \\;=\\; w_{1}\\,R_{m} \\;+\\; w_{2}\\,\\big(R_{m}^{2} - \\sigma_{m}^{2}\\big),\n$$\n其中 $w_{1}$ 和 $w_{2}$ 分别是线性和二次因子上的实值投资组合权重。将投资组合相对于市场回报的局部凸性定义为 $r_{p}(R_{m})$ 对 $R_{m}$ 的二阶导数在 $R_{m}=0$ 处的值。\n\n构建一个投资组合，使其回报相对于市场回报具有最大凸性，并满足以下归一化和中性要求：\n- 在 $R_{m}=0$ 处的一阶敏感度为零（即 $r_{p}(R_{m})$ 对 $R_{m}$ 的一阶导数在 $R_{m}=0$ 处等于 $0$）。\n- 投资组合回报的方差为单位方差，$\\mathrm{Var}\\big[r_{p}(R_{m})\\big] = 1$。\n\n将您的最终答案表示为最优 $w_{2}$ 关于 $\\sigma_{m}$ 的闭式解析表达式。无需四舍五入。此外，在您的书面解答中，基于风险与回报的基本原理，解释所得投资组合对于小型市场冲击的对冲属性。", "solution": "该问题要求构建一个具有特定回报结构的投资组合，以在满足其敏感度和方差的两个约束条件下，最大化其局部凸性。这是一个金融工程背景下的约束优化问题。\n\n已知条件如下：\n市场因子的总回报是一个随机变量 $R_{m} \\sim \\mathcal{N}(0,\\sigma_{m}^{2})$，其中 $\\sigma_{m} > 0$。\n投资组合的回报 $r_{p}(R_{m})$ 是 $R_{m}$ 的一个确定性函数：\n$$r_{p}(R_{m}) = w_{1}R_{m} + w_{2}(R_{m}^{2} - \\sigma_{m}^{2})$$\n其中 $w_{1}$ 和 $w_{2}$ 是实值权重。\n局部凸性定义为 $C = \\frac{d^{2}r_{p}(R_{m})}{dR_{m}^{2}}|_{R_{m}=0}$。\n目标是最大化 $C$。\n\n约束条件是：\n1.  在 $R_{m}=0$ 处的一阶敏感度为零：$\\frac{dr_{p}(R_{m})}{dR_{m}}|_{R_{m}=0} = 0$。\n2.  投资组合回报的方差为单位方差：$\\mathrm{Var}[r_{p}(R_{m})] = 1$。\n\n该问题具有科学依据，设定良好且客观。所有术语都有数学定义，且前提是量化金融中的标准设定。因此，该问题是有效的，我们着手求解。\n\n首先，我们将目标函数形式化。凸性 $C$ 是通过将投资组合回报函数对 $R_{m}$ 求二阶导数得到的。\n一阶导数为：\n$$\\frac{dr_{p}}{dR_{m}} = \\frac{d}{dR_{m}} \\left( w_{1}R_{m} + w_{2}(R_{m}^{2} - \\sigma_{m}^{2}) \\right) = w_{1} + 2w_{2}R_{m}$$\n二阶导数为：\n$$\\frac{d^{2}r_{p}}{dR_{m}^{2}} = \\frac{d}{dR_{m}} (w_{1} + 2w_{2}R_{m}) = 2w_{2}$$\n局部凸性是此二阶导数在 $R_{m}=0$ 处的值。由于二阶导数是一个常数，局部凸性即为 $C = 2w_{2}$。\n因此，最大化局部凸性等价于最大化权重 $w_{2}$。\n\n接下来，我们应用约束条件来找到 $w_{1}$ 和 $w_{2}$ 的允许值。\n\n约束条件1：在 $R_{m}=0$ 处的一阶敏感度为零。\n我们计算在 $R_{m}=0$ 处的一阶导数：\n$$\\frac{dr_{p}}{dR_{m}}|_{R_{m}=0} = w_{1} + 2w_{2}(0) = w_{1}$$\n约束要求该值为零，因此我们有：\n$$w_{1} = 0$$\n这个结果意义重大。它意味着，为了使投资组合对 $R_{m}=0$ 附近的市场变动具有零一阶敏感度（在期权术语中称为Delta中性），它必须对线性市场因子 $R_{m}$ 没有敞口。投资组合的回报函数简化为：\n$$r_{p}(R_{m}) = w_{2}(R_{m}^{2} - \\sigma_{m}^{2})$$\n\n约束条件2：投资组合回报的方差为单位方差。\n我们必须计算简化后的投资组合回报的方差：\n$$\\mathrm{Var}[r_{p}(R_{m})] = \\mathrm{Var}[w_{2}(R_{m}^{2} - \\sigma_{m}^{2})]$$\n使用方差性质 $\\mathrm{Var}[aX] = a^{2}\\mathrm{Var}[X]$（其中 $a$ 是常数），我们得到：\n$$\\mathrm{Var}[r_{p}(R_{m})] = w_{2}^{2} \\mathrm{Var}[R_{m}^{2} - \\sigma_{m}^{2}]$$\n由于 $\\sigma_{m}^{2}$ 是一个常数，它不影响方差，所以 $\\mathrm{Var}[R_{m}^{2} - \\sigma_{m}^{2}] = \\mathrm{Var}[R_{m}^{2}]$。方差约束变为：\n$$w_{2}^{2} \\mathrm{Var}[R_{m}^{2}] = 1$$\n为了继续，我们必须计算 $\\mathrm{Var}[R_{m}^{2}]$。根据定义，$\\mathrm{Var}[R_{m}^{2}] = E[(R_{m}^{2})^{2}] - (E[R_{m}^{2}])^{2} = E[R_{m}^{4}] - (E[R_{m}^{2}])^{2}$。\n我们需要随机变量 $R_{m} \\sim \\mathcal{N}(0, \\sigma_{m}^{2})$ 的二阶矩和四阶矩。对于一个中心化的正态分布（$X \\sim \\mathcal{N}(0, \\sigma^{2})$），偶数阶矩的通用公式是 $E[X^{2n}] = (2n-1)!! \\sigma^{2n}$。\n对于 $n=1$，我们求二阶矩：\n$$E[R_{m}^{2}] = (2(1)-1)!! \\sigma_{m}^{2(1)} = 1!! \\sigma_{m}^{2} = \\sigma_{m}^{2}$$\n这与零均值变量的方差定义一致，$\\mathrm{Var}[R_{m}] = E[R_{m}^{2}] - (E[R_{m}])^{2} = \\sigma_{m}^{2} - 0^{2} = \\sigma_{m}^{2}$。\n对于 $n=2$，我们求四阶矩：\n$$E[R_{m}^{4}] = (2(2)-1)!! \\sigma_{m}^{2(2)} = 3!! \\sigma_{m}^{4} = (3 \\cdot 1) \\sigma_{m}^{4} = 3\\sigma_{m}^{4}$$\n现在我们可以计算 $R_{m}^{2}$ 的方差：\n$$\\mathrm{Var}[R_{m}^{2}] = E[R_{m}^{4}] - (E[R_{m}^{2}])^{2} = 3\\sigma_{m}^{4} - (\\sigma_{m}^{2})^{2} = 3\\sigma_{m}^{4} - \\sigma_{m}^{4} = 2\\sigma_{m}^{4}$$\n将此结果代回方差约束方程：\n$$w_{2}^{2} (2\\sigma_{m}^{4}) = 1$$\n解出 $w_{2}^{2}$：\n$$w_{2}^{2} = \\frac{1}{2\\sigma_{m}^{4}}$$\n这给出了 $w_{2}$ 的两个可能解：\n$$w_{2} = \\pm \\sqrt{\\frac{1}{2\\sigma_{m}^{4}}} = \\pm \\frac{1}{\\sqrt{2}\\sigma_{m}^{2}}$$\n我们的目标是最大化 $w_{2}$。比较这两个可能的值，我们必须选择正根。因此，最优权重 $w_{2}$ 是：\n$$w_{2} = \\frac{1}{\\sqrt{2}\\sigma_{m}^{2}}$$\n\n最优投资组合的对冲属性：\n最终得到的最优投资组合的回报函数为 $r_{p}^{*}(R_{m}) = w_{2}^{*}(R_{m}^{2} - \\sigma_{m}^{2})$，其中 $w_{2}^{*} = (\\sqrt{2}\\sigma_{m}^{2})^{-1} > 0$。\n该投资组合的特性可以通过其对市场因子的敏感度来理解，这些敏感度在衍生品定价中被称为“希腊字母”。\n1.  一阶敏感度，或称“Delta”，是 $\\frac{dr_{p}^{*}}{dR_{m}} = 2w_{2}^{*}R_{m}$。在 $R_{m}=0$ 处，Delta为零，这是由约束条件所施加的。这意味着该投资组合对其中心点附近的无穷小市场变动不敏感。它不是对市场的方向性押注。\n2.  二阶敏感度，或称“Gamma”，是 $\\frac{d^{2}r_{p}^{*}}{dR_{m}^{2}} = 2w_{2}^{*}$。由于 $w_{2}^{*} > 0$，该投资组合具有正常数Gamma。这就是我们最大化的凸性。\n一个Delta中性且具有正Gamma的投资组合，无论市场走向如何，都能从市场变动中获利。回报函数 $r_{p}^{*}(R_{m})$ 是一条开口向上、顶点在 $R_{m}=0$ 的抛物线。对于任何非零的市场回报 $R_{m}$，项 $R_{m}^{2}$ 为正，且随着 $|R_{m}|$ 的增加，投资组合的回报也会增加。这种收益结构是多头波动率头寸的特征，例如多头期权跨式组合。\n因此，该投资组合可作为对冲市场稳定性的工具。持有该投资组合的投资者会从大的市场冲击（高已实现波动率）中获利，而如果市场保持静止，则会遭受损失（在期望上，市场确实如此，因为 $E[r_{p}^{*}(R_{m})] = w_{2}^{*}(E[R_{m}^{2}] - \\sigma_{m}^{2}) = w_{2}^{*}(\\sigma_{m}^{2} - \\sigma_{m}^{2}) = 0$）。这是一种旨在当市场经历比其内含定价更大的波动时提供回报的工具。反之，它可用于对冲一个“空头波动率”头寸——即在市场大幅波动时会亏损的头寸。", "answer": "$$\\boxed{\\frac{1}{\\sqrt{2}\\sigma_{m}^{2}}}$$", "id": "2374842"}, {"introduction": "在现实世界中，投资决策总是在信息不完全和充满噪音的环境下做出的。本练习旨在模拟一个理性投资者如何根据一个不完美的信号来更新自己对资产未来收益的预期，并据此决定最优的杠杆水平。这个问题融合了贝叶斯推断（Bayesian inference）、效用最大化理论和正态分布的统计特性 [@problem_id:2374866]。通过这个动手编程练习，您将体验到量化金融的精髓：为不确定性下的决策过程建立数学模型，并通过计算方法得出具体、可执行的投资策略。", "problem": "考虑一个单期模型，其中包含单一风险资产，其随机超额收益为 $\\tilde{R}$。$\\tilde{R}$ 服从正态分布，均值为 $\\mu$，方差为 $\\sigma^{2}$。投资者在选择应用于风险资产的杠杆 $\\ell \\in \\mathbb{R}$ 之前，会观测到一个关于 $\\tilde{R}$ 的信号 $s$。该信号由下式给出：\n$$\ns \\;=\\; \\mu \\;+\\; \\alpha\\left(\\tilde{R} - \\mu\\right) \\;+\\; \\nu,\n$$\n其中 $\\nu$ 与 $\\tilde{R}$ 独立，服从均值为 $0$、方差为 $\\omega^{2}$ 的正态分布，而 $\\alpha \\ge 0$ 是一个给定的技能参数，描述了信号在收益的真实创新上的负载强度。投资者具有恒定绝对风险规避（CARA）偏好，其系数为 $\\gamma > 0$。期末财富为\n$$\nW_{1} \\;=\\; 1 \\;+\\; \\ell \\,\\tilde{R},\n$$\n且超额无风险利率为 $0$。所有收益和杠杆决策都必须表示为小数（例如，$0.05$ 表示百分之五）。投资者在观测到 $s$ 后选择 $\\ell$，以最大化条件期望效用 $\\mathbb{E}\\left[-\\exp\\!\\left(-\\gamma W_{1}\\right)\\,\\middle|\\, s\\right]$。\n\n对于下面测试套件中指定的每组参数，计算在上述模型下使条件期望效用最大化的最优杠杆 $\\ell^{\\star}(s)$，并将其作为实数报告。将每个答案表示为小数，并精确到小数点后六位。\n\n使用以下参数值测试套件，每个案例指定为 $(\\mu,\\sigma,\\alpha,\\omega,\\gamma,s)$:\n- 案例 1：$(0.05,\\,0.2,\\,0.5,\\,0.1,\\,3,\\,0.08)$。\n- 案例 2：$(0.05,\\,0.2,\\,0,\\,0.1,\\,3,\\,0.2)$。\n- 案例 3：$(0.02,\\,0.15,\\,3,\\,0.05,\\,4,\\,0.3)$。\n- 案例 4：$(0,\\,0.25,\\,1,\\,0.25,\\,2,\\,0)$。\n- 案例 5：$(0.01,\\,0.18,\\,1.2,\\,0.2,\\,5,\\,-0.1)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[x_{1},x_{2},x_{3},x_{4},x_{5}]$），其中每个 $x_{i}$ 是案例 $i$ 的 $\\ell^{\\star}(s)$ 的十进制值，四舍五入到小数点后六位。", "solution": "该问题旨在为具有恒定绝对风险规避（CARA）效用的投资者，在给定关于风险资产超额收益 $\\tilde{R}$ 的信号 $s$ 的情况下，确定最优杠杆 $\\ell^{\\star}(s)$。\n\n首先，我们验证问题陈述的有效性。\n提取并验证所有给定条件。\n1.  **给定条件**：\n    - 超额收益：$\\tilde{R} \\sim \\mathcal{N}(\\mu, \\sigma^2)$。\n    - 信号：$s = \\mu + \\alpha(\\tilde{R} - \\mu) + \\nu$。\n    - 信号噪声：$\\nu \\sim \\mathcal{N}(0, \\omega^2)$，与 $\\tilde{R}$ 独立。\n    - 技能参数：$\\alpha \\ge 0$。\n    - 效用函数 (CARA)：$U(W) = -\\exp(-\\gamma W)$，其中 $\\gamma > 0$。\n    - 期末财富：$W_1 = 1 + \\ell \\tilde{R}$。\n    - 目标：最大化条件期望效用 $\\mathbb{E}[-\\exp(-\\gamma W_1) | s]$。\n    - 为多个测试案例提供了参数 $(\\mu, \\sigma, \\alpha, \\omega, \\gamma, s)$。\n\n2.  **验证**：\n    - 该问题具有**科学依据**。CARA-正态框架是金融经济学中用于处理不确定性下投资组合选择的标准基础模型。\n    - 该问题是**适定的**。目标函数对于选择变量 $\\ell$ 是严格凹函数，且选择空间 $\\ell \\in \\mathbb{R}$ 是凸集，这保证了唯一解的存在。\n    - 该问题是**客观且完整的**。所有变量和参数都进行了数学定义，测试套件中提供了所有必要的值。约束条件（测试案例中 $\\gamma > 0$, $\\sigma > 0$, $\\omega > 0$）确保模型是非退化的。\n\n结论是该问题**有效**。我们现在开始求解。\n\n投资者的目标是选择杠杆 $\\ell$ 以最大化：\n$$ \\mathbb{E}[U(W_1) | s] = \\mathbb{E}[-\\exp(-\\gamma W_1) | s] = \\mathbb{E}[-\\exp(-\\gamma (1 + \\ell \\tilde{R})) | s] $$\n最大化此表达式等价于最大化 $-\\exp(-\\gamma)\\mathbb{E}[\\exp(-\\gamma \\ell \\tilde{R}) | s]$。由于 $-\\exp(-\\gamma)$ 是一个负常数，这又等价于最小化 $\\mathbb{E}[\\exp(-\\gamma \\ell \\tilde{R}) | s]$。\n\n该问题需要给定观测值 $s$ 下 $\\tilde{R}$ 的条件分布。由于 $\\tilde{R}$ 和 $\\nu$ 均服从正态分布，且 $s$ 是它们的线性组合，因此向量 $(\\tilde{R}, s)$ 服从二元正态分布。我们首先确定此联合分布的参数。\n$\\tilde{R}$ 的均值为 $\\mathbb{E}[\\tilde{R}] = \\mu$。\n$\\tilde{R}$ 的方差为 $\\text{Var}(\\tilde{R}) = \\sigma^2$。\n信号 $s$ 的均值为：\n$$ \\mathbb{E}[s] = \\mathbb{E}[\\mu + \\alpha(\\tilde{R} - \\mu) + \\nu] = \\mu + \\alpha(\\mathbb{E}[\\tilde{R}] - \\mu) + \\mathbb{E}[\\nu] = \\mu + \\alpha(\\mu - \\mu) + 0 = \\mu $$\n信号 $s$ 的方差为，利用 $\\tilde{R}$ 和 $\\nu$ 的独立性：\n$$ \\text{Var}(s) = \\text{Var}(\\mu + \\alpha\\tilde{R} - \\alpha\\mu + \\nu) = \\text{Var}(\\alpha\\tilde{R} + \\nu) = \\alpha^2 \\text{Var}(\\tilde{R}) + \\text{Var}(\\nu) = \\alpha^2 \\sigma^2 + \\omega^2 $$\n收益 $\\tilde{R}$ 和信号 $s$ 之间的协方差为：\n$$ \\text{Cov}(\\tilde{R}, s) = \\text{Cov}(\\tilde{R}, \\mu + \\alpha(\\tilde{R} - \\mu) + \\nu) = \\text{Cov}(\\tilde{R}, \\alpha\\tilde{R} + \\nu) = \\alpha \\text{Cov}(\\tilde{R}, \\tilde{R}) + \\text{Cov}(\\tilde{R}, \\nu) = \\alpha \\text{Var}(\\tilde{R}) + 0 = \\alpha \\sigma^2 $$\n因此，联合分布为：\n$$ \\begin{pmatrix} \\tilde{R} \\\\ s \\end{pmatrix} \\sim \\mathcal{N} \\left( \\begin{pmatrix} \\mu \\\\ \\mu \\end{pmatrix}, \\begin{pmatrix} \\sigma^2 & \\alpha \\sigma^2 \\\\ \\alpha \\sigma^2 & \\alpha^2 \\sigma^2 + \\omega^2 \\end{pmatrix} \\right) $$\n根据二元正态分布的性质，给定 $s$ 时 $\\tilde{R}$ 的条件分布也服从正态分布，即 $\\tilde{R}|s \\sim \\mathcal{N}(\\mu_{R|s}, \\sigma^2_{R|s})$，其条件均值和条件方差由下式给出：\n$$ \\mu_{R|s} = \\mathbb{E}[\\tilde{R} | s] = \\mathbb{E}[\\tilde{R}] + \\frac{\\text{Cov}(\\tilde{R}, s)}{\\text{Var}(s)}(s - \\mathbb{E}[s]) = \\mu + \\frac{\\alpha \\sigma^2}{\\alpha^2 \\sigma^2 + \\omega^2}(s - \\mu) $$\n$$ \\sigma^2_{R|s} = \\text{Var}(\\tilde{R} | s) = \\text{Var}(\\tilde{R}) - \\frac{(\\text{Cov}(\\tilde{R}, s))^2}{\\text{Var}(s)} = \\sigma^2 - \\frac{(\\alpha \\sigma^2)^2}{\\alpha^2 \\sigma^2 + \\omega^2} = \\sigma^2\\left(1 - \\frac{\\alpha^2\\sigma^2}{\\alpha^2\\sigma^2 + \\omega^2}\\right) = \\frac{\\sigma^2 \\omega^2}{\\alpha^2 \\sigma^2 + \\omega^2} $$\n需要最小化的量是 $\\tilde{R}$ 的条件矩生成函数在 $t = -\\gamma \\ell$ 处的取值。对于一个正态变量 $X \\sim \\mathcal{N}(\\mu_X, \\sigma_X^2)$，有 $\\mathbb{E}[\\exp(tX)] = \\exp(t\\mu_X + \\frac{1}{2} t^2 \\sigma_X^2)$。将此应用于 $\\tilde{R}|s$：\n$$ \\mathbb{E}[\\exp(-\\gamma \\ell \\tilde{R}) | s] = \\exp\\left(-\\gamma \\ell \\mu_{R|s} + \\frac{1}{2}(-\\gamma \\ell)^2 \\sigma^2_{R|s}\\right) = \\exp\\left(-\\gamma \\ell \\mu_{R|s} + \\frac{1}{2}\\gamma^2 \\ell^2 \\sigma^2_{R|s}\\right) $$\n最小化该指数函数等价于最小化其指数部分，这是一个关于 $\\ell$ 的二次函数：\n$$ f(\\ell) = -\\gamma \\ell \\mu_{R|s} + \\frac{1}{2}\\gamma^2 \\ell^2 \\sigma^2_{R|s} $$\n为求最小值，我们对 $\\ell$ 取一阶条件并令其为零：\n$$ \\frac{\\partial f}{\\partial \\ell} = -\\gamma \\mu_{R|s} + \\gamma^2 \\ell \\sigma^2_{R|s} = 0 $$\n解出最优杠杆 $\\ell^{\\star}(s)$:\n$$ \\ell^{\\star}(s) = \\frac{\\gamma \\mu_{R|s}}{\\gamma^2 \\sigma^2_{R|s}} = \\frac{\\mu_{R|s}}{\\gamma \\sigma^2_{R|s}} $$\n这是经典的投资组合法则：风险资产的配置等于预期超额收益（“回报”）除以风险规避系数与感知方差（“风险”）的乘积。\n\n代入条件均值和方差的表达式：\n$$ \\ell^{\\star}(s) = \\frac{\\mu + \\frac{\\alpha \\sigma^2}{\\alpha^2 \\sigma^2 + \\omega^2}(s - \\mu)}{\\gamma \\left( \\frac{\\sigma^2 \\omega^2}{\\alpha^2 \\sigma^2 + \\omega^2} \\right)} $$\n为了得到一个计算上更稳定的形式，我们将分子和分母同乘以 $(\\alpha^2 \\sigma^2 + \\omega^2)$：\n$$ \\ell^{\\star}(s) = \\frac{\\mu(\\alpha^2 \\sigma^2 + \\omega^2) + \\alpha \\sigma^2(s - \\mu)}{\\gamma \\sigma^2 \\omega^2} $$\n这个最终表达式将用于计算每个测试案例的解。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the optimal leverage in a one-period CARA-Normal model with a signal.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (mu, sigma, alpha, omega, gamma, s)\n    test_cases = [\n        (0.05, 0.2, 0.5, 0.1, 3, 0.08),   # Case 1\n        (0.05, 0.2, 0, 0.1, 3, 0.2),      # Case 2\n        (0.02, 0.15, 3, 0.05, 4, 0.3),    # Case 3\n        (0, 0.25, 1, 0.25, 2, 0),         # Case 4\n        (0.01, 0.18, 1.2, 0.2, 5, -0.1),  # Case 5\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        mu, sigma, alpha, omega, gamma, s = case\n\n        # Use np.power for consistency with specified libraries, though ** is equivalent.\n        sigma_sq = np.power(sigma, 2)\n        omega_sq = np.power(omega, 2)\n        alpha_sq = np.power(alpha, 2)\n\n        # The optimal leverage l_star is given by the formula:\n        # l_star = (mu_R_s) / (gamma * sigma_sq_R_s)\n        # where mu_R_s is the conditional mean of R given s, and\n        # sigma_sq_R_s is the conditional variance of R given s.\n        #\n        # A simplified single expression is derived in the solution:\n        # l_star = (mu * (alpha^2 * sigma^2 + omega^2) + alpha * sigma^2 * (s - mu)) / (gamma * sigma^2 * omega^2)\n        \n        # Numerator of the expression\n        numerator = mu * (alpha_sq * sigma_sq + omega_sq) + alpha * sigma_sq * (s - mu)\n        \n        # Denominator of the expression\n        denominator = gamma * sigma_sq * omega_sq\n        \n        # The problem constraints (sigma > 0, omega > 0, gamma > 0) ensure the denominator is non-zero.\n        optimal_leverage = numerator / denominator\n        \n        results.append(optimal_leverage)\n\n    # Format the results as a comma-separated list of strings,\n    # with each value rounded to exactly six decimal places.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2374866"}]}