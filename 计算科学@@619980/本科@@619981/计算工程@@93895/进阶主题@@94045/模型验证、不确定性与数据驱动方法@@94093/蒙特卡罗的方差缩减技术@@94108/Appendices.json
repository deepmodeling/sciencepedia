{"hands_on_practices": [{"introduction": "控制变量法是一种强大的方差缩减技术，但其有效性取决于我们选择的控制变量以及它与我们目标估计量的相关性有多强。在盲目实施之前，通过解析分析来量化潜在的收益是至关重要的。这个练习将引导你推导一个具体的例子中，使用控制变量能带来多大的方差缩减，让你亲手验证该方法的理论基础和威力。[@problem_id:2449189]", "problem": "设 $X$ 是一个正态分布随机变量，其均值为 $\\,\\mu\\,$，方差为 $\\,\\sigma^{2}\\,$，其中 $\\,\\mu \\neq 0\\,$ 且 $\\,\\sigma^{2} > 0\\,$。目标是使用 $\\,n\\,$ 个独立同分布 (i.i.d.) 样本 $\\,X_{1},\\dots,X_{n}\\,$，通过蒙特卡洛方法估计 $\\,\\theta = \\mathbb{E}[X^{2}]\\,$。\n\n考虑以下关于 $\\,\\theta\\,$ 的无偏估计量：\n- 直接估计量 $\\,\\hat{\\theta}_{\\mathrm{dir}} = \\frac{1}{n}\\sum_{i=1}^{n} X_{i}^{2}\\,$。\n- 控制变量 (CV) 估计量 $\\,\\hat{\\theta}_{\\mathrm{cv}} = \\frac{1}{n}\\sum_{i=1}^{n} \\left(X_{i}^{2} - \\beta\\,(X_{i}-\\mu)\\right)\\,$，其中均值 $\\,\\mu = \\mathbb{E}[X]\\,$ 已知，且选择系数 $\\,\\beta\\,$ 以使估计量的方差最小化。\n\n推导精确比率 $\\,\\frac{\\operatorname{Var}(\\hat{\\theta}_{\\mathrm{cv}})}{\\operatorname{Var}(\\hat{\\theta}_{\\mathrm{dir}})}\\,$ 的闭式解，将其表示为一个仅含 $\\,\\mu\\,$ 和 $\\,\\sigma^{2}\\,$ 的简化表达式（该表达式不得依赖于 $\\,n\\,$）。请以单个解析表达式的形式给出最终答案。不要进行近似计算。", "solution": "对问题陈述进行验证。\n\n**步骤1：提取已知条件**\n- 随机变量 $X$ 服从正态分布，均值为 $\\mu$，方差为 $\\sigma^{2}$。\n- 约束条件：$\\mu \\neq 0$ 且 $\\sigma^{2} > 0$。\n- 待估参数为 $\\theta = \\mathbb{E}[X^{2}]$。\n- 估计使用 $n$ 个独立同分布 (i.i.d.) 样本 $X_{1}, \\dots, X_{n}$ 进行。\n- 直接估计量为 $\\hat{\\theta}_{\\mathrm{dir}} = \\frac{1}{n}\\sum_{i=1}^{n} X_{i}^{2}$。\n- 控制变量 (CV) 估计量为 $\\hat{\\theta}_{\\mathrm{cv}} = \\frac{1}{n}\\sum_{i=1}^{n} \\left(X_{i}^{2} - \\beta\\,(X_{i}-\\mu)\\right)$。\n- 均值 $\\mu = \\mathbb{E}[X]$ 已知。\n- 选择系数 $\\beta$ 以最小化 $\\operatorname{Var}(\\hat{\\theta}_{\\mathrm{cv}})$。\n- 目标是推导精确比率 $\\frac{\\operatorname{Var}(\\hat{\\theta}_{\\mathrm{cv}})}{\\operatorname{Var}(\\hat{\\theta}_{\\mathrm{dir}})}$，并将其表示为仅含 $\\mu$ 和 $\\sigma^{2}$ 的简化表达式。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题是计算统计学中的一个标准练习，涉及使用控制变量对蒙特卡洛估计量进行方差缩减。所有概念——正态分布、期望、方差和估计量——在基础上都是合理的。\n- **适定性：** 该问题是适定的。它提供了确定最优控制变量系数 $\\beta$ 并随后计算所需方差比率的所有必要信息。解的存在性和唯一性由线性回归和方差最小化原理保证。\n- **客观性：** 该问题以精确、客观的数学语言陈述。\n\n**步骤3：结论与行动**\n该问题是有效的。它是计算工程和统计学中一个标准的、定义明确的问题。我将继续进行推导。\n\n目标是计算 $\\theta = \\mathbb{E}[X^2]$ 的两个估计量的方差之比。\n直接估计量为 $\\hat{\\theta}_{\\mathrm{dir}} = \\frac{1}{n}\\sum_{i=1}^{n} X_{i}^{2}$。由于样本 $X_i$ 是独立同分布的，其方差为：\n$$\n\\operatorname{Var}(\\hat{\\theta}_{\\mathrm{dir}}) = \\operatorname{Var}\\left(\\frac{1}{n}\\sum_{i=1}^{n} X_{i}^{2}\\right) = \\frac{1}{n^{2}}\\sum_{i=1}^{n} \\operatorname{Var}(X_{i}^{2}) = \\frac{1}{n}\\operatorname{Var}(X^{2})\n$$\n控制变量估计量为 $\\hat{\\theta}_{\\mathrm{cv}} = \\frac{1}{n}\\sum_{i=1}^{n} Y_{i}$，其中 $Y_{i} = X_{i}^{2} - \\beta(X_{i}-\\mu)$。其方差为：\n$$\n\\operatorname{Var}(\\hat{\\theta}_{\\mathrm{cv}}) = \\frac{1}{n}\\operatorname{Var}(Y_1) = \\frac{1}{n}\\operatorname{Var}(X^{2} - \\beta(X-\\mu))\n$$\n因此，待计算的比率为：\n$$\n\\frac{\\operatorname{Var}(\\hat{\\theta}_{\\mathrm{cv}})}{\\operatorname{Var}(\\hat{\\theta}_{\\mathrm{dir}})} = \\frac{\\frac{1}{n}\\operatorname{Var}(X^{2} - \\beta(X-\\mu))}{\\frac{1}{n}\\operatorname{Var}(X^{2})} = \\frac{\\operatorname{Var}(X^{2} - \\beta(X-\\mu))}{\\operatorname{Var}(X^{2})}\n$$\n必须选择系数 $\\beta$ 以最小化 $\\operatorname{Var}(\\hat{\\theta}_{\\mathrm{cv}})$。最优系数记为 $\\beta^{*}$，由以下著名公式给出：\n$$\n\\beta^{*} = \\frac{\\operatorname{Cov}(X^{2}, X-\\mu)}{\\operatorname{Var}(X-\\mu)}\n$$\n我们必须计算此表达式的各组成部分。分母就是 $\\operatorname{Var}(X-\\mu) = \\operatorname{Var}(X) = \\sigma^{2}$。\n对于分子，我们计算协方差：\n$$\n\\operatorname{Cov}(X^{2}, X-\\mu) = \\mathbb{E}[X^{2}(X-\\mu)] - \\mathbb{E}[X^{2}]\\mathbb{E}[X-\\mu]\n$$\n由于 $\\mathbb{E}[X-\\mu] = \\mathbb{E}[X] - \\mu = \\mu - \\mu = 0$，第二项消失。\n$$\n\\operatorname{Cov}(X^{2}, X-\\mu) = \\mathbb{E}[X^{3} - \\mu X^{2}] = \\mathbb{E}[X^{3}] - \\mu \\mathbb{E}[X^{2}]\n$$\n为了计算这些矩，我们定义一个标准正态变量 $Z = \\frac{X-\\mu}{\\sigma}$，因此 $X = \\mu + \\sigma Z$。$Z$ 的各阶矩为 $\\mathbb{E}[Z]=0$，$\\mathbb{E}[Z^2]=1$，$\\mathbb{E}[Z^3]=0$ 和 $\\mathbb{E}[Z^4]=3$。\n$X$ 的二阶矩是 $\\mathbb{E}[X^{2}] = \\operatorname{Var}(X) + (\\mathbb{E}[X])^{2} = \\sigma^{2} + \\mu^{2}$。\n$X$ 的三阶矩是：\n$$\n\\mathbb{E}[X^{3}] = \\mathbb{E}[(\\mu + \\sigma Z)^{3}] = \\mathbb{E}[\\mu^{3} + 3\\mu^{2}\\sigma Z + 3\\mu\\sigma^{2}Z^{2} + \\sigma^{3}Z^{3}]\n$$\n利用期望的线性性质和 $Z$ 的各阶矩：\n$$\n\\mathbb{E}[X^{3}] = \\mu^{3} + 3\\mu^{2}\\sigma\\mathbb{E}[Z] + 3\\mu\\sigma^{2}\\mathbb{E}[Z^{2}] + \\sigma^{3}\\mathbb{E}[Z^{3}] = \\mu^{3} + 0 + 3\\mu\\sigma^{2}(1) + 0 = \\mu^{3} + 3\\mu\\sigma^{2}\n$$\n现在，将这些矩代回协方差表达式中：\n$$\n\\operatorname{Cov}(X^{2}, X-\\mu) = (\\mu^{3} + 3\\mu\\sigma^{2}) - \\mu(\\sigma^{2} + \\mu^{2}) = \\mu^{3} + 3\\mu\\sigma^{2} - \\mu\\sigma^{2} - \\mu^{3} = 2\\mu\\sigma^{2}\n$$\n因此，最优系数为：\n$$\n\\beta^{*} = \\frac{2\\mu\\sigma^{2}}{\\sigma^{2}} = 2\\mu\n$$\n当系数为最优值 $\\beta^{*}$ 时，控制变量项的方差由下式给出：\n$$\n\\operatorname{Var}(X^{2} - \\beta^{*}(X-\\mu)) = \\operatorname{Var}(X^{2}) - \\frac{(\\operatorname{Cov}(X^{2}, X-\\mu))^{2}}{\\operatorname{Var}(X-\\mu)}\n$$\n我们需要计算 $\\operatorname{Var}(X^{2})$。\n$$\n\\operatorname{Var}(X^{2}) = \\mathbb{E}[X^{4}] - (\\mathbb{E}[X^{2}])^{2}\n$$\n首先，计算 $X$ 的四阶矩：\n$$\n\\mathbb{E}[X^{4}] = \\mathbb{E}[(\\mu + \\sigma Z)^{4}] = \\mathbb{E}[\\mu^{4} + 4\\mu^{3}\\sigma Z + 6\\mu^{2}\\sigma^{2}Z^{2} + 4\\mu\\sigma^{3}Z^{3} + \\sigma^{4}Z^{4}]\n$$\n$$\n\\mathbb{E}[X^{4}] = \\mu^{4} + 4\\mu^{3}\\sigma\\mathbb{E}[Z] + 6\\mu^{2}\\sigma^{2}\\mathbb{E}[Z^{2}] + 4\\mu\\sigma^{3}\\mathbb{E}[Z^{3}] + \\sigma^{4}\\mathbb{E}[Z^{4}]\n$$\n$$\n\\mathbb{E}[X^{4}] = \\mu^{4} + 0 + 6\\mu^{2}\\sigma^{2}(1) + 0 + \\sigma^{4}(3) = \\mu^{4} + 6\\mu^{2}\\sigma^{2} + 3\\sigma^{4}\n$$\n现在我们可以计算 $\\operatorname{Var}(X^{2})$：\n$$\n\\operatorname{Var}(X^{2}) = (\\mu^{4} + 6\\mu^{2}\\sigma^{2} + 3\\sigma^{4}) - (\\sigma^{2} + \\mu^{2})^{2}\n$$\n$$\n\\operatorname{Var}(X^{2}) = (\\mu^{4} + 6\\mu^{2}\\sigma^{2} + 3\\sigma^{4}) - (\\sigma^{4} + 2\\mu^{2}\\sigma^{2} + \\mu^{4}) = 4\\mu^{2}\\sigma^{2} + 2\\sigma^{4}\n$$\n利用此结果，我们求得控制变量项的最小化方差：\n$$\n\\operatorname{Var}(X^{2} - \\beta^{*}(X-\\mu)) = (4\\mu^{2}\\sigma^{2} + 2\\sigma^{4}) - \\frac{(2\\mu\\sigma^{2})^{2}}{\\sigma^{2}}\n$$\n$$\n= (4\\mu^{2}\\sigma^{2} + 2\\sigma^{4}) - \\frac{4\\mu^{2}\\sigma^{4}}{\\sigma^{2}} = 4\\mu^{2}\\sigma^{2} + 2\\sigma^{4} - 4\\mu^{2}\\sigma^{2} = 2\\sigma^{4}\n$$\n最后，我们整合方差的比率：\n$$\n\\frac{\\operatorname{Var}(\\hat{\\theta}_{\\mathrm{cv}})}{\\operatorname{Var}(\\hat{\\theta}_{\\mathrm{dir}})} = \\frac{\\operatorname{Var}(X^{2} - \\beta^{*}(X-\\mu))}{\\operatorname{Var}(X^{2})} = \\frac{2\\sigma^{4}}{4\\mu^{2}\\sigma^{2} + 2\\sigma^{4}}\n$$\n由于 $\\sigma^{2} > 0$，我们可以通过将分子和分母同除以 $2\\sigma^{2}$ 来简化该表达式：\n$$\n\\frac{2\\sigma^{4}}{2\\sigma^{2}(2\\mu^{2} + \\sigma^{2})} = \\frac{\\sigma^{2}}{2\\mu^{2} + \\sigma^{2}}\n$$\n这就是方差比率的最终简化表达式。它仅依赖于 $\\mu$ 和 $\\sigma^{2}$，符合题意。", "answer": "$$\n\\boxed{\\frac{\\sigma^{2}}{2\\mu^{2} + \\sigma^{2}}}\n$$", "id": "2449189"}, {"introduction": "从理论转向实践，我们将探索通用随机数 (Common Random Numbers, CRN) 技术，尤其是在比较两个或多个相似系统时的应用。这个练习将你置于计算金融工程师的角色，任务是评估不同利率下金融衍生品价格的差异。通过编写代码并使用相同的随机数序列驱动两个模拟场景，你将亲眼见证 CRN 如何通过引入正相关性来显著降低估计量方差。[@problem_id:3005265]", "problem": "设风险中性概率测度下的几何布朗运动 (GBM) 由随机微分方程 $dS_t = r S_t \\, dt + \\sigma S_t \\, dW_t$ 定义，其中 $S_t$ 是时刻 $t$ 的资产价格，$r$ 是连续复利率，$\\sigma$ 是波动率，$W_t$ 是标准布朗运动。考虑一个执行价格为 $K$、到期日为 $T$ 的欧式看涨期权，在给定利率 $r$ 下，其在时刻 $T$ 的贴现收益为 $e^{-rT} \\max(S_T - K, 0)$。\n\n您的任务是构建一个比较蒙特卡洛估计量，使用被称为公共随机数的方差缩减技术，来估计在两个不同利率下，配对路径的贴现看涨期权收益差的方差。具体来说，对于固定的样本量 $N$ 和指定的整数种子 $s$，生成一组 $N$ 个标准正态随机变量，并用它来分别驱动利率为 $r_1$ 和 $r_2$ 时 GBM 的两个终端值 $S_T^{(r_1)}$ 和 $S_T^{(r_2)}$。对于每个结果，计算贴现看涨期权收益 $C^{(r_1)}$ 和 $C^{(r_2)}$，构成配对差值 $D = C^{(r_1)} - C^{(r_2)}$，并计算 $D$ 的经验无偏样本方差。此外，为了进行比较，请使用独立抽样方法估计每个利率下均值差估计量的方差：对于 $r_1$ 使用种子 $s+1$ 抽取 $N$ 个独立标准正态变量，对于 $r_2$ 使用种子 $s+2$ 抽取 $N$ 个独立标准正态变量，计算相应的贴现看涨期权收益，并通过两个样本方差之和除以 $N$ 来估计 $\\operatorname{Var}(\\bar{C}^{(r_1)} - \\bar{C}^{(r_2)})$。总而言之，对于每个测试案例，您必须输出以下四个量：\n- 配对差值 $D$ 的无偏经验样本方差 $s_D^2$ (使用公共随机数)，\n- 公共随机数下均值差估计量的估计方差 $s_D^2/N$，\n- 独立抽样下均值差估计量的估计方差 $s_{C^{(r_1)}}^2/N + s_{C^{(r_2)}}^2/N$，\n- 独立抽样估计量方差与公共随机数估计量方差之比。如果公共随机数估计量方差在数值上为零，则输出比率为浮点数无穷大。\n\n您的构建应基于 GBM 的核心定义、风险中性定价原理和蒙特卡洛模拟。不要在问题陈述中使用简便公式；在您的解决方案中从这些基础推导出任何必要的关系。所有量都必须表示为无量纲的实数。\n\n使用以下参数值的测试套件，其中每个元组代表 $(S_0, K, \\sigma, T, r_1, r_2, N, s)$:\n- 案例 A (一般比较): $(100.0, 100.0, 0.2, 1.0, 0.01, 0.05, 200000, 271828)$,\n- 案例 B (利率相同的边界情况): $(100.0, 100.0, 0.2, 1.0, 0.03, 0.03, 100000, 314159)$,\n- 案例 C (短到期日，大利率差): $(100.0, 100.0, 0.2, 0.01, 0.0, 0.10, 300000, 161803)$,\n- 案例 D (深度虚值): $(50.0, 100.0, 0.4, 2.0, 0.02, 0.08, 250000, 141421)$。\n\n您的程序必须生成单行输出，其中包含所有结果，按以下顺序排列在一个用方括号括起来的逗号分隔列表中：\n$[s_{D,A}^2, v_{\\text{CRN},A}, v_{\\text{IND},A}, \\rho_A, s_{D,B}^2, v_{\\text{CRN},B}, v_{\\text{IND},B}, \\rho_B, s_{D,C}^2, v_{\\text{CRN},C}, v_{\\text{IND},C}, \\rho_C, s_{D,D}^2, v_{\\text{CRN},D}, v_{\\text{IND},D}, \\rho_D]$,\n其中 $s_{D,\\cdot}^2$ 表示指定案例的配对差值的无偏样本方差，$v_{\\text{CRN},\\cdot} = s_{D,\\cdot}^2/N$ 表示公共随机数估计量方差，$v_{\\text{IND},\\cdot}$ 表示独立抽样估计量方差，$\\rho_{\\cdot} = v_{\\text{IND},\\cdot} / v_{\\text{CRN},\\cdot}$ 表示指定案例的方差比。", "solution": "该问题要求比较两个欧式看涨期权价格之差的估计量的方差，这两个价格仅因无风险利率 $r$ 而不同。比较是在两种蒙特卡洛模拟方案之间进行的：一种是为每个期权价格估计使用独立的随机数流，另一种是使用公共随机数 (CRN) 这一方差缩减技术。\n\n首先，我们必须建立终端资产价格 $S_T$ 的模拟公式。规定资产价格在风险中性测度下遵循几何布朗运动 (GBM)，由以下随机微分方程 (SDE) 描述：\n$$\ndS_t = r S_t \\, dt + \\sigma S_t \\, dW_t\n$$\n其中 $S_t$ 是时刻 $t$ 的资产价格，$r$ 是无风险利率，$\\sigma$ 是波动率，$W_t$ 是标准维纳过程（布朗运动）。\n\n为了求得 $S_T$ 的解，我们对函数 $f(S_t) = \\ln(S_t)$ 应用 Itô 引理。其导数为 $f'(S_t) = 1/S_t$ 和 $f''(S_t) = -1/S_t^2$。根据 Itô 引理，微分 $d(\\ln S_t)$ 为：\n$$\nd(\\ln S_t) = f'(S_t) dS_t + \\frac{1}{2} f''(S_t) (dS_t)^2\n$$\n二次变分项 $(dS_t)^2$ 可以通过对 SDE 平方得到，根据 Itô 积分法则只保留 $dt$ 的最低阶项（$dt^2 \\to 0$, $dt dW_t \\to 0$, $(dW_t)^2 \\to dt$）：\n$$\n(dS_t)^2 = (r S_t \\, dt + \\sigma S_t \\, dW_t)^2 = \\sigma^2 S_t^2 (dW_t)^2 = \\sigma^2 S_t^2 dt\n$$\n将 $dS_t$ 和 $(dS_t)^2$ 代入引理中，得到：\n$$\nd(\\ln S_t) = \\frac{1}{S_t}(r S_t \\, dt + \\sigma S_t \\, dW_t) + \\frac{1}{2} \\left(-\\frac{1}{S_t^2}\\right)(\\sigma^2 S_t^2 dt)\n$$\n$$\nd(\\ln S_t) = (r \\, dt + \\sigma \\, dW_t) - \\frac{1}{2} \\sigma^2 dt = \\left(r - \\frac{1}{2}\\sigma^2\\right)dt + \\sigma dW_t\n$$\n对两边从 $t=0$ 到 $t=T$ 进行积分：\n$$\n\\int_0^T d(\\ln S_t) = \\int_0^T \\left(r - \\frac{1}{2}\\sigma^2\\right)dt + \\int_0^T \\sigma dW_t\n$$\n$$\n\\ln(S_T) - \\ln(S_0) = \\left(r - \\frac{1}{2}\\sigma^2\\right)T + \\sigma (W_T - W_0)\n$$\n鉴于 $W_0=0$ 并且随机变量 $W_T$ 服从均值为 $0$、方差为 $T$ 的正态分布，我们可以写出 $W_T = \\sqrt{T}Z$，其中 $Z$ 是一个标准正态随机变量，$Z \\sim N(0, 1)$。对两边取指数，得到终端资产价格的解：\n$$\nS_T = S_0 \\exp\\left( \\left(r - \\frac{1}{2}\\sigma^2\\right)T + \\sigma\\sqrt{T}Z \\right)\n$$\n该公式是蒙特卡洛模拟终端资产价格的基础。\n\n欧式看涨期权的价格是其在风险中性测度下贴现收益的期望值：\n$$\nC(r) = E\\left[ e^{-rT} \\max(S_T - K, 0) \\right]\n$$\n该价格的蒙特卡洛估计是在 $N$ 条模拟路径上的样本均值：\n$$\n\\bar{C}(r) = \\frac{1}{N} \\sum_{i=1}^N C_i(r) = \\frac{1}{N} \\sum_{i=1}^N e^{-rT} \\max(S_{T,i} - K, 0)\n$$\n其中每个 $S_{T,i}$ 都是通过从 $N(0,1)$ 中独立抽取 $Z_i$ 生成的。\n\n我们的目标是估计在两个利率 $r_1$ 和 $r_2$ 下的期权价格之差，即 $\\Delta = C(r_1) - C(r_2)$。自然估计量是 $\\hat{\\Delta} = \\bar{C}(r_1) - \\bar{C}(r_2)$。我们关心的是这个估计量的方差 $\\operatorname{Var}(\\hat{\\Delta})$。\n\n首先，考虑**独立抽样**的情况。我们生成两组独立的 $N$ 个标准正态变量 $\\{Z_i^{(1)}\\}_{i=1}^N$ 和 $\\{Z_i^{(2)}\\}_{i=1}^N$，来分别计算 $\\bar{C}(r_1)$ 和 $\\bar{C}(r_2)$。因为估计量是独立的，它们差的方差是它们方差的和：\n$$\n\\operatorname{Var}(\\hat{\\Delta})_{\\text{IND}} = \\operatorname{Var}(\\bar{C}(r_1) - \\bar{C}(r_2)) = \\operatorname{Var}(\\bar{C}(r_1)) + \\operatorname{Var}(\\bar{C}(r_2))\n$$\n样本均值的方差是总体方差除以样本量，即 $\\operatorname{Var}(\\bar{C}(r)) = \\operatorname{Var}(C(r))/N$。我们使用无偏样本方差 $s_{C(r)}^2 = \\frac{1}{N-1}\\sum_{i=1}^N(C_i(r) - \\bar{C}(r))^2$ 来估计它。因此，均值差估计量的估计方差为：\n$$\nv_{\\text{IND}} = \\frac{s_{C(r_1)}^2}{N} + \\frac{s_{C(r_2)}^2}{N}\n$$\n\n接下来，考虑**公共随机数 (CRN)** 技术。我们使用同一组 $N$ 个标准正态变量 $\\{Z_i\\}_{i=1}^N$ 来生成两个收益序列 $\\{C_i(r_1)\\}_{i=1}^N$ 和 $\\{C_i(r_2)\\}_{i=1}^N$。然后，我们通过计算配对差值的均值 $\\bar{D} = \\frac{1}{N} \\sum_{i=1}^N D_i$ 来估计 $\\Delta$，其中 $D_i = C_i(r_1) - C_i(r_2)$。该估计量的方差为：\n$$\n\\operatorname{Var}(\\bar{D}) = \\frac{1}{N} \\operatorname{Var}(D) = \\frac{1}{N} \\operatorname{Var}(C(r_1) - C(r_2))\n$$\n$$\nv_{\\text{CRN}} = \\frac{1}{N} \\operatorname{Var}(C(r_1) - C(r_2)) = \\frac{1}{N} \\left( \\operatorname{Var}(C(r_1)) + \\operatorname{Var}(C(r_2)) - 2\\operatorname{Cov}(C(r_1), C(r_2)) \\right)\n$$\n我们用差值的样本方差 $s_D^2 = \\frac{1}{N-1}\\sum_{i=1}^N(D_i - \\bar{D})^2$ 来估计它。那么，该估计量的估计方差为 $v_{\\text{CRN}} = s_D^2 / N$。注意 $s_D^2$ 是要求的输出之一。\n\nCRN 的有效性取决于协方差项。对于一个固定的扰动 $Z$，终端价格 $S_T(r) = S_0 \\exp\\left( (r - \\frac{1}{2}\\sigma^2)T + \\sigma\\sqrt{T}Z \\right)$ 是 $r$ 的单调递增函数。看涨期权收益 $\\max(S_T - K, 0)$ 在 $S_T$ 上是单调的。贴现因子 $e^{-rT}$ 是 $r$ 的单调递减函数。组合函数 $C(r, Z) = e^{-rT} \\max(S_T(r,Z) - K, 0)$ 在其定义域的很大一部分上通常也对 $r$ 是单调的。这在收益序列 $C_i(r_1)$ 和 $C_i(r_2)$ 之间引入了强正相关性。因此，$\\operatorname{Cov}(C(r_1), C(r_2))$ 为正且较大，与 $v_{\\text{IND}}$ 相比，这显著减小了方差 $v_{\\text{CRN}}$。比率 $\\rho = v_{\\text{IND}} / v_{\\text{CRN}}$ 量化了这种方差缩减，并且预期会大于 1。\n\n对于 $r_1=r_2$ 的特殊情况（案例B），对于任何给定的扰动 $Z_i$，我们将有 $S_{T,i}^{(r_1)} = S_{T,i}^{(r_2)}$，因此 $C_i^{(r_1)} = C_i^{(r_2)}$。这意味着每个配对差值 $D_i = C_i^{(r_1)} - C_i^{(r_2)}$ 都将恰好为 $0$。因此，差值的样本方差 $s_D^2$ 将为 $0$。CRN 估计量的方差 $v_{\\text{CRN}} = s_D^2/N$ 也为 $0$。在这种情况下，比率 $\\rho = v_{\\text{IND}} / v_{\\text{CRN}}$ 变为无穷大，表示完全的方差缩减，这与预期相符。\n\n对于每个测试案例 $(S_0, K, \\sigma, T, r_1, r_2, N, s)$ 的计算步骤如下：\n1.  **公共随机数：**\n    a. 使用种子 $s$ 初始化一个随机数生成器。生成 $N$ 个标准正态变量 $Z_i$。\n    b. 对于每个 $Z_i$，计算 $S_{T,i}^{(r_1)}$、$S_{T,i}^{(r_2)}$，然后计算贴现收益 $C_i^{(r_1)}$、$C_i^{(r_2)}$。\n    c. 形成差值 $D_i = C_i^{(r_1)} - C_i^{(r_2)}$。\n    d. 计算无偏样本方差 $s_D^2 = \\operatorname{Var}(D_1, \\dots, D_N)$（分母为 $N-1$）。\n    e. 计算估计量方差 $v_{\\text{CRN}} = s_D^2 / N$。\n2.  **独立抽样：**\n    a. 使用种子 $s+1$ 初始化一个生成器。生成 $N$ 个变量 $Z_i^{(1)}$ 并计算相应的收益 $C_i^{(r_1)}$。计算它们的样本方差 $s_{C(r_1)}^2$。\n    b. 使用种子 $s+2$ 初始化一个生成器。生成 $N$ 个变量 $Z_i^{(2)}$ 并计算相应的收益 $C_i^{(r_2)}$。计算它们的样本方差 $s_{C(r_2)}^2$。\n    c. 计算估计量方差 $v_{\\text{IND}} = s_{C(r_1)}^2/N + s_{C(r_2)}^2/N$。\n3.  **比率：** 计算 $\\rho = v_{\\text{IND}} / v_{\\text{CRN}}$。如果 $v_{\\text{CRN}} = 0$，则比率为正无穷大。\n\n对每个测试案例实施这些步骤，以产生所需的输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by calculating and comparing variances for Monte Carlo\n    estimators using both common random numbers and independent sampling.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (S0, K, sigma, T, r1, r2, N, s)\n        (100.0, 100.0, 0.2, 1.0, 0.01, 0.05, 200000, 271828), # Case A\n        (100.0, 100.0, 0.2, 1.0, 0.03, 0.03, 100000, 314159), # Case B\n        (100.0, 100.0, 0.2, 0.01, 0.0, 0.10, 300000, 161803), # Case C\n        (50.0, 100.0, 0.4, 2.0, 0.02, 0.08, 250000, 141421),  # Case D\n    ]\n\n    results = []\n    \n    for S0, K, sigma, T, r1, r2, N, s in test_cases:\n        \n        # --- 1. Common Random Numbers (CRN) Calculation ---\n        rng_crn = np.random.default_rng(s)\n        Z = rng_crn.standard_normal(N)\n\n        # Calculate terminal prices for both rates using the same random numbers\n        drift1 = (r1 - 0.5 * sigma**2) * T\n        drift2 = (r2 - 0.5 * sigma**2) * T\n        diffusion = sigma * np.sqrt(T) * Z\n        \n        ST1_crn = S0 * np.exp(drift1 + diffusion)\n        ST2_crn = S0 * np.exp(drift2 + diffusion)\n        \n        # Calculate discounted call payoffs\n        C1_crn = np.exp(-r1 * T) * np.maximum(ST1_crn - K, 0)\n        C2_crn = np.exp(-r2 * T) * np.maximum(ST2_crn - K, 0)\n        \n        # Calculate paired differences\n        D = C1_crn - C2_crn\n        \n        # Unbiased empirical sample variance of the paired differences\n        s_D_sq = np.var(D, ddof=1)\n        \n        # Estimated variance of the difference-of-means estimator under CRN\n        v_crn = s_D_sq / N\n        \n        # --- 2. Independent Sampling Calculation ---\n        # Rate 1\n        rng_ind1 = np.random.default_rng(s + 1)\n        Z1_ind = rng_ind1.standard_normal(N)\n        ST1_ind = S0 * np.exp(drift1 + sigma * np.sqrt(T) * Z1_ind)\n        C1_ind = np.exp(-r1 * T) * np.maximum(ST1_ind - K, 0)\n        s_C1_sq = np.var(C1_ind, ddof=1)\n\n        # Rate 2\n        rng_ind2 = np.random.default_rng(s + 2)\n        Z2_ind = rng_ind2.standard_normal(N)\n        ST2_ind = S0 * np.exp(drift2 + sigma * np.sqrt(T) * Z2_ind)\n        C2_ind = np.exp(-r2 * T) * np.maximum(ST2_ind - K, 0)\n        s_C2_sq = np.var(C2_ind, ddof=1)\n        \n        # Estimated variance of the difference-of-means estimator under independent sampling\n        v_ind = (s_C1_sq / N) + (s_C2_sq / N)\n        \n        # --- 3. Ratio Calculation ---\n        if v_crn == 0:\n            rho = float('inf')\n        else:\n            rho = v_ind / v_crn\n            \n        results.extend([s_D_sq, v_crn, v_ind, rho])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3005265"}, {"introduction": "重要性采样也许是蒙特卡洛方法中最强大但也最需要技巧的工具之一，其成功的关键在于选择一个合适的“提议分布”。这个练习强调了批判性思维在其中的重要性，要求你分析几个不同的提议分布，并判断哪一个实际上会使结果比简单的均匀采样更差。通过这个过程，你将深刻理解选择不当的提议分布不仅无法缩减方差，甚至可能导致方差无限大，从而使估计完全失效。[@problem_id:2402925]", "problem": "要求您使用重要性抽样来估计函数 $f(x)=x^2$ 在区间 $[0,1]$ 上的积分。令 $g(x)$ 表示在 $[0,1]$ 上的一个归一化提议概率密度函数。对于本问题，我们将“比均匀抽样更差”定义为：使用 $g(x)$ 的重要性抽样估计量的方差严格大于（或不为有限值）在 $[0,1]$ 上对 $x$ 进行均匀抽样的标准蒙特卡洛估计量的方差。对于估计 $\\int_{0}^{1} x^2\\,dx$，下列关于 $g(x)$ 的哪个选项使得重要性抽样可以被证明比均匀抽样更差？\n\nA. $g(x)=1$，对于 $x\\in[0,1]$。\n\nB. $g(x)=\\dfrac{3}{2}\\,(1-x)^{1/2}$，对于 $x\\in[0,1]$。\n\nC. $g(x)=3x^2$，对于 $x\\in[0,1]$。\n\nD. $g(x)=2(1-x)$，对于 $x\\in[0,1]$。\n\n选择所有适用项。您的论证应基于重要性抽样的第一性原理进行方差比较，而非基于启发式直觉。", "solution": "在尝试求解之前，必须首先验证问题陈述的科学性和逻辑完整性。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n- 需要估计的积分是 $I = \\int_{0}^{1} f(x)\\,dx$，其中被积函数是 $f(x) = x^2$。\n- 积分区间是 $[0,1]$。\n- 在 $[0,1]$ 上的一个归一化提议概率密度函数（PDF）记为 $g(x)$。\n- 均匀抽样使用在 $x \\in [0,1]$ 上的PDF $p(x) = 1$。\n- “比均匀抽样更差”的定义是：使用 $g(x)$ 的重要性抽样估计量的方差严格大于标准蒙特卡洛估计量（均匀抽样）的方差，或其方差不为有限值。\n- 任务是确定所提供的函数 $g(x)$ 中，哪一个会导致重要性抽样估计量比均匀抽样估计量更差。\n\n**步骤2：使用已知条件进行验证**\n- **科学依据：**该问题是蒙特卡洛积分理论和方差缩减技术（具体而言是重要性抽样）的一个标准应用。这些概念是计算物理和统计学的基础。该问题在科学上是合理的。\n- **适定性：**问题表述清晰。待比较的量——估计量的方差——有明确的定义。所提供的函数 $g(x)$ 都是在区间 $[0,1]$ 上有效的、非负的、归一化的概率密度函数。\n    - A: $\\int_0^1 1 \\,dx = 1$。\n    - B: $\\int_0^1 \\frac{3}{2}(1-x)^{1/2} \\,dx = \\frac{3}{2} [-\\frac{2}{3}(1-x)^{3/2}]_0^1 = 1$。\n    - C: $\\int_0^1 3x^2 \\,dx = [x^3]_0^1 = 1$。\n    - D: $\\int_0^1 2(1-x) \\,dx = 2[x - \\frac{x^2}{2}]_0^1 = 1$。\n- **客观性：**“更差”的标准是方差的严格不等式，这是一个客观的数学条件，没有歧义。\n\n**步骤3：结论与行动**\n问题陈述是有效的。这是一个适定的、自洽的、有科学依据的问题。现在推导解答。\n\n### 解答推导\n\n所讨论的积分是 $I = \\int_0^1 x^2 \\,dx = \\left[\\frac{x^3}{3}\\right]_0^1 = \\frac{1}{3}$。\n\n**1. 标准（均匀）蒙特卡洛估计量的方差**\n\n对于均匀抽样，样本 $x_i$ 从 $[0,1]$ 上的PDF $p(x)=1$ 中抽取。积分的估计量是 $\\hat{I}_{unif} = \\frac{1}{N} \\sum_{i=1}^N f(x_i)$。单样本方差为 $\\sigma^2_{unif} = \\operatorname{Var}_{p}(f(x))$。\n该方差由下式给出：\n$$\n\\sigma^2_{unif} = E_p[f(x)^2] - (E_p[f(x)])^2\n$$\n$f(x)$ 的期望就是积分本身：\n$$\nE_p[f(x)] = \\int_0^1 f(x) p(x) \\,dx = \\int_0^1 x^2 \\cdot 1 \\,dx = I = \\frac{1}{3}\n$$\n$f(x)^2$ 的期望是：\n$$\nE_p[f(x)^2] = \\int_0^1 (f(x))^2 p(x) \\,dx = \\int_0^1 (x^2)^2 \\cdot 1 \\,dx = \\int_0^1 x^4 \\,dx = \\left[\\frac{x^5}{5}\\right]_0^1 = \\frac{1}{5}\n$$\n因此，均匀抽样的方差是：\n$$\n\\sigma^2_{unif} = \\frac{1}{5} - \\left(\\frac{1}{3}\\right)^2 = \\frac{1}{5} - \\frac{1}{9} = \\frac{9 - 5}{45} = \\frac{4}{45}\n$$\n\n**2. 重要性抽样估计量的方差**\n\n对于重要性抽样，样本 $x_i$ 从提议PDF $g(x)$ 中抽取。积分表示为 $I = \\int_0^1 \\frac{f(x)}{g(x)} g(x) \\,dx = E_g\\left[\\frac{f(x)}{g(x)}\\right]$。单样本方差为 $\\sigma^2_g = \\operatorname{Var}_g\\left(\\frac{f(x)}{g(x)}\\right)$。\n该方差由下式给出：\n$$\n\\sigma^2_g = E_g\\left[\\left(\\frac{f(x)}{g(x)}\\right)^2\\right] - \\left(E_g\\left[\\frac{f(x)}{g(x)}\\right]\\right)^2\n$$\n第二项是 $(I)^2 = (1/3)^2 = 1/9$，因为估计量必须是无偏的。第一项是：\n$$\nE_g\\left[\\left(\\frac{f(x)}{g(x)}\\right)^2\\right] = \\int_0^1 \\left(\\frac{f(x)}{g(x)}\\right)^2 g(x) \\,dx = \\int_0^1 \\frac{f(x)^2}{g(x)} \\,dx = \\int_0^1 \\frac{x^4}{g(x)} \\,dx\n$$\n所以，重要性抽样估计量的方差是：\n$$\n\\sigma^2_g = \\int_0^1 \\frac{x^4}{g(x)} \\,dx - \\frac{1}{9}\n$$\n\n**3. “比均匀抽样更差”的条件**\n\n根据问题定义，如果 $\\sigma^2_g > \\sigma^2_{unif}$ 或者 $\\sigma^2_g$ 是无穷大，则重要性抽样更差。\n$$\n\\int_0^1 \\frac{x^4}{g(x)} \\,dx - \\frac{1}{9} > \\frac{4}{45}\n$$\n$$\n\\int_0^1 \\frac{x^4}{g(x)} \\,dx > \\frac{4}{45} + \\frac{1}{9} = \\frac{4+5}{45} = \\frac{9}{45} = \\frac{1}{5}\n$$\n所以，如果 $\\int_0^1 \\frac{x^4}{g(x)} \\,dx > \\frac{1}{5}$ 或者该积分发散，那么 $g(x)$ 的选择就是更差的。\n\n### 逐项分析\n\n**A. $g(x)=1$，对于 $x\\in[0,1]$。**\n这就是均匀抽样。我们检验条件：\n$$\n\\int_0^1 \\frac{x^4}{1} \\,dx = \\int_0^1 x^4 \\,dx = \\frac{1}{5}\n$$\n条件是 $\\frac{1}{5} > \\frac{1}{5}$，这是错误的。方差与均匀抽样的方差相等，并非严格更大。\n**结论：错误。**\n\n**B. $g(x)=\\dfrac{3}{2}\\,(1-x)^{1/2}$，对于 $x\\in[0,1]$。**\n我们计算该积分：\n$$\n\\int_0^1 \\frac{x^4}{g(x)} \\,dx = \\int_0^1 \\frac{x^4}{\\frac{3}{2}(1-x)^{1/2}} \\,dx = \\frac{2}{3} \\int_0^1 x^4 (1-x)^{-1/2} \\,dx\n$$\n这与贝塔函数（Beta function）有关，$B(z_1, z_2) = \\int_0^1 t^{z_1-1} (1-t)^{z_2-1} \\,dt$。此处，$z_1-1=4$ 且 $z_2-1=-1/2$，所以 $z_1=5$ 且 $z_2=1/2$。\n$$\n\\int_0^1 x^4 (1-x)^{-1/2} \\,dx = B(5, 1/2) = \\frac{\\Gamma(5)\\Gamma(1/2)}{\\Gamma(5+1/2)} = \\frac{4! \\sqrt{\\pi}}{\\frac{9}{2} \\cdot \\frac{7}{2} \\cdot \\frac{5}{2} \\cdot \\frac{3}{2} \\cdot \\frac{1}{2}\\sqrt{\\pi}} = \\frac{24}{\\frac{945}{32}} = \\frac{24 \\cdot 32}{945} = \\frac{768}{945} = \\frac{256}{315}\n$$\n所以，完整的项是：\n$$\n\\frac{2}{3} \\cdot \\frac{256}{315} = \\frac{512}{945}\n$$\n现在我们检验条件 $\\frac{512}{945} > \\frac{1}{5}$。\n$$\n\\frac{1}{5} = \\frac{189}{945}\n$$\n因为 $512 > 189$，不等式 $\\frac{512}{945} > \\frac{189}{945}$ 成立。方差严格更大。\n**结论：正确。**\n\n**C. $g(x)=3x^2$，对于 $x\\in[0,1]$。**\n该提议PDF与被积函数 $f(x)=x^2$ 成正比。这是重要性抽样的理想选择，应该产生最小方差，而不是最大方差。\n$$\n\\int_0^1 \\frac{x^4}{g(x)} \\,dx = \\int_0^1 \\frac{x^4}{3x^2} \\,dx = \\frac{1}{3} \\int_0^1 x^2 \\,dx = \\frac{1}{3} \\left[\\frac{x^3}{3}\\right]_0^1 = \\frac{1}{9}\n$$\n我们检验条件 $\\frac{1}{9} > \\frac{1}{5}$。这是错误的。\n实际上，方差为 $\\sigma^2_g = \\frac{1}{9} - \\frac{1}{9} = 0$，是可能的最小方差。这比均匀抽样好得多，而不是更差。\n**结论：错误。**\n\n**D. $g(x)=2(1-x)$，对于 $x\\in[0,1]$。**\n我们计算用于方差计算的积分：\n$$\n\\int_0^1 \\frac{x^4}{g(x)} \\,dx = \\int_0^1 \\frac{x^4}{2(1-x)} \\,dx = \\frac{1}{2} \\int_0^1 \\frac{x^4}{1-x} \\,dx\n$$\n我们必须分析该积分的收敛性。当 $x \\to 1^-$ 时，令 $u = 1-x$。被积函数的行为类似于 $\\frac{(1-u)^4}{u} \\approx \\frac{1}{u}$。积分 $\\int \\frac{1}{u} \\,du$ 在 $u=0$ 处对数发散。\n因此，积分 $\\int_0^1 \\frac{x^4}{1-x} \\,dx$ 是发散的。这意味着方差 $\\sigma^2_g$ 是无穷大。根据问题的定义，无穷大的方差即为“比均匀抽样更差”。\n出现这种灾难性失效是因为提议分布 $g(x)$ 在 $x=1$ 处趋于零，而函数 $f(x)^2=x^4$ 在该点非零。\n**结论：正确。**", "answer": "$$\\boxed{BD}$$", "id": "2402925"}]}