{"hands_on_practices": [{"introduction": "张量分解是将复杂的多维数据分解为其基本组成部分的核心技术，类似于从一道菜中找出其基本配料。这个练习将逆转这一过程，通过实际操作学习如何从给定的因子矩阵（即“配料”）出发，重建原始张量中的一个元素。这有助于你具体地理解 CANDECOMP/PARAFAC (CP) 分解的内在工作原理及其作为数据压缩和建模工具的意义 [@problem_id:1527694]。", "problem": "在多维数据科学中，标准多元分解（Canonical Polyadic Decomposition, CPD），也称为CANDECOMP/PARAFAC，是张量分解的一种基本工具。它将一个张量分解为若干个秩一张量之和。该方法广泛应用于化学计量学、信号处理和社交网络分析等领域。\n\n考虑一个大小为 $2 \\times 3 \\times 2$ 的三阶张量 $\\mathcal{X}$。对该张量进行秩为 $R=2$ 的CPD分解，得到三个因子矩阵：$\\mathbf{A} \\in \\mathbb{R}^{2 \\times 2}$、$\\mathbf{B} \\in \\mathbb{R}^{3 \\times 2}$ 和 $\\mathbf{C} \\in \\mathbb{R}^{2 \\times 2}$。这些矩阵的列，记为 $\\mathbf{a}_r, \\mathbf{b}_r, \\mathbf{c}_r$（其中 $r=1, \\dots, R$），代表了分解的分量。\n\n给定的因子矩阵如下：\n$$\n\\mathbf{A} = \\begin{pmatrix} 1 & -2 \\\\ 3 & 4 \\end{pmatrix}, \\quad \\mathbf{B} = \\begin{pmatrix} 1 & 0 \\\\ 2 & -1 \\\\ 5 & 2 \\end{pmatrix}, \\quad \\mathbf{C} = \\begin{pmatrix} 1 & 2 \\\\ 3 & 1 \\end{pmatrix}\n$$\n基于此分解，计算重构张量在位置 $(1, 2, 1)$ 处的元素值。该元素记为 $\\mathcal{X}_{121}$。", "solution": "在一个秩为 $R$ 的三阶张量的标准多元分解中，重构张量在位置 $(i,j,k)$ 处的元素由各分量的总和给出：\n$$\n\\mathcal{X}_{i j k}=\\sum_{r=1}^{R} a_{i r}\\, b_{j r}\\, c_{k r}.\n$$\n在此问题中，$R=2$ 且我们需要计算 $\\mathcal{X}_{121}$，因此\n$$\n\\mathcal{X}_{121}=\\sum_{r=1}^{2} a_{1 r}\\, b_{2 r}\\, c_{1 r}.\n$$\n从给定的因子矩阵中，\n$$\n\\mathbf{A}=\\begin{pmatrix}1 & -2 \\\\ 3 & 4\\end{pmatrix},\\quad\n\\mathbf{B}=\\begin{pmatrix}1 & 0 \\\\ 2 & -1 \\\\ 5 & 2\\end{pmatrix},\\quad\n\\mathbf{C}=\\begin{pmatrix}1 & 2 \\\\ 3 & 1\\end{pmatrix},\n$$\n我们可以读出：\n$$\na_{11}=1,\\quad a_{12}=-2;\\quad b_{21}=2,\\quad b_{22}=-1;\\quad c_{11}=1,\\quad c_{12}=2.\n$$\n计算每一项：\n$$\n\\text{当 } r=1 \\text{ 时}:\\quad a_{11} b_{21} c_{11} = 1 \\cdot 2 \\cdot 1 = 2,\n$$\n$$\n\\text{当 } r=2 \\text{ 时}:\\quad a_{12} b_{22} c_{12} = (-2) \\cdot (-1) \\cdot 2 = 4.\n$$\n将它们相加得到\n$$\n\\mathcal{X}_{121} = 2 + 4 = 6.\n$$", "answer": "$$\\boxed{6}$$", "id": "1527694"}, {"introduction": "正如矩阵的特征值可以揭示数据的主要方向一样，张量的特征值（如 Z-特征值）是其高阶推广，常用于识别数据中的关键特征或主方向。与矩阵不同，求解张量特征值通常需要依赖迭代数值方法。本练习将引导你手动执行张量幂次迭代法，这是一个寻找张量主特征值和特征向量的基础且重要的算法 [@problem_id:1527712]。", "problem": "在多元数据分析中，偏度的概念可以通过一个三阶矩张量来扩展，这个张量通常被称为偏度张量。对于一个零均值的$n$维随机向量$X = (X_1, \\dots, X_n)$，其偏度张量$S$是一个三阶张量，其分量为$S_{ijk} = \\mathbb{E}[X_i X_j X_k]$。数据中最大偏度的方向对应于该张量的Z-特征向量。\n\n一个维度为$n$的对称三阶张量$S$的Z-特征对$(\\lambda, v)$是以下多项式方程组的解：\n$$ \\sum_{j,k=1}^{n} S_{ijk} v_j v_k = \\lambda v_i \\quad \\text{for } i = 1, \\dots, n $$\n服从归一化约束 $\\|v\\|_2 = 1$。\n\n主Z-特征值（即模最大的特征值）及其对应的特征向量可以使用张量幂迭代法来近似。该算法过程如下：\n1. 从一个归一化的特征向量初始猜测值$v^{(0)}$开始。\n2. 对于 $t = 0, 1, 2, \\dots$，计算未归一化的向量$u^{(t+1)}$，其分量为$u_i^{(t+1)} = \\sum_{j,k=1}^{n} S_{ijk} v_j^{(t)} v_k^{(t)}$。\n3. 将此向量归一化以获得特征向量的下一个近似值：$v^{(t+1)} = \\frac{u^{(t+1)}}{\\|u^{(t+1)}\\|_2}$。\n4. 然后使用新向量$v^{(t+1)}$来近似特征值：$\\lambda^{(t+1)} = \\sum_{i,j,k=1}^{n} S_{ijk} v_i^{(t+1)} v_j^{(t+1)} v_k^{(t+1)}$。\n\n考虑一个2维（$n=2$）的对称偏度张量$S$，其非零唯一分量如下（索引从1开始）：\n- $S_{111} = 1$\n- $S_{222} = -1$\n- $S_{112} = 2$ (及其置换，例如，$S_{121}$, $S_{211}$)\n- $S_{122} = 1$ (及其置换，例如，$S_{212}$, $S_{221}$)\n\n从初始向量$v^{(0)} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$开始，执行两次完整的张量幂迭代法，以求出近似值$\\lambda^{(2)}$。\n\n计算$\\lambda^{(2)}$的数值，并将你的最终答案四舍五入到四位有效数字。", "solution": "给定一个在$\\mathbb{R}^{2}$上的对称三阶张量$S$，其非零分量为$S_{111}=1$，$S_{222}=-1$，$S_{112}=S_{121}=S_{211}=2$以及$S_{122}=S_{212}=S_{221}=1$。对于任意$v=(a,b)$，张量缩并$u=S(\\cdot,v,v)$的分量为\n$$\nu_{1}=\\sum_{j,k=1}^{2}S_{1jk}v_{j}v_{k}=S_{111}a^{2}+S_{112}ab+S_{121}ba+S_{122}b^{2}=a^{2}+4ab+b^{2},\n$$\n$$\nu_{2}=\\sum_{j,k=1}^{2}S_{2jk}v_{j}v_{k}=S_{211}a^{2}+S_{212}ab+S_{221}ba+S_{222}b^{2}=2a^{2}+2ab-b^{2}.\n$$\n\n从$v^{(0)}=\\frac{1}{\\sqrt{2}}(1,1)$开始进行第1次迭代：当$a=b=\\frac{1}{\\sqrt{2}}$时，我们有$a^{2}=b^{2}=\\frac{1}{2}$且$ab=\\frac{1}{2}$，所以\n$$\nu^{(1)}=\\bigl(a^{2}+4ab+b^{2},\\,2a^{2}+2ab-b^{2}\\bigr)=(3,\\,\\tfrac{3}{2}).\n$$\n其范数为 $\\|u^{(1)}\\|_{2}=\\sqrt{3^{2}+\\left(\\tfrac{3}{2}\\right)^{2}}=\\tfrac{3}{2}\\sqrt{5}$，因此\n$$\nv^{(1)}=\\frac{u^{(1)}}{\\|u^{(1)}\\|_{2}}=\\left(\\frac{3}{\\tfrac{3}{2}\\sqrt{5}},\\,\\frac{\\tfrac{3}{2}}{\\tfrac{3}{2}\\sqrt{5}}\\right)=\\left(\\frac{2}{\\sqrt{5}},\\,\\frac{1}{\\sqrt{5}}\\right).\n$$\n\n使用$v^{(1)}=\\left(\\frac{2}{\\sqrt{5}},\\frac{1}{\\sqrt{5}}\\right)$进行第2次迭代：令$a=\\frac{2}{\\sqrt{5}}$，$b=\\frac{1}{\\sqrt{5}}$，所以$a^{2}=\\frac{4}{5}$，$b^{2}=\\frac{1}{5}$，$ab=\\frac{2}{5}$。那么\n$$\nu^{(2)}=\\bigl(a^{2}+4ab+b^{2},\\,2a^{2}+2ab-b^{2}\\bigr)=\\left(\\frac{4}{5}+4\\cdot\\frac{2}{5}+\\frac{1}{5},\\,2\\cdot\\frac{4}{5}+2\\cdot\\frac{2}{5}-\\frac{1}{5}\\right)=\\left(\\frac{13}{5},\\,\\frac{11}{5}\\right).\n$$\n它的范数是\n$$\n\\|u^{(2)}\\|_{2}=\\sqrt{\\left(\\frac{13}{5}\\right)^{2}+\\left(\\frac{11}{5}\\right)^{2}}=\\frac{1}{5}\\sqrt{13^{2}+11^{2}}=\\frac{1}{5}\\sqrt{290},\n$$\n所以\n$$\nv^{(2)}=\\frac{u^{(2)}}{\\|u^{(2)}\\|_{2}}=\\left(\\frac{13/5}{(1/5)\\sqrt{290}},\\,\\frac{11/5}{(1/5)\\sqrt{290}}\\right)=\\left(\\frac{13}{\\sqrt{290}},\\,\\frac{11}{\\sqrt{290}}\\right).\n$$\n\n特征值近似值为\n$$\n\\lambda^{(2)}=\\sum_{i,j,k=1}^{2}S_{ijk}v^{(2)}_{i}v^{(2)}_{j}v^{(2)}_{k}=\\sum_{i=1}^{2}v^{(2)}_{i}\\left(\\sum_{j,k=1}^{2}S_{ijk}v^{(2)}_{j}v^{(2)}_{k}\\right)=\\bigl(v^{(2)}\\bigr)^{\\top}u^{(v^{(2)})},\n$$\n其中 $u^{(v^{(2)})}$ 是 $u$ 在 $v^{(2)}=(x,y)=(\\frac{13}{\\sqrt{290}},\\frac{11}{\\sqrt{290}})$ 处的值。使用 $x^{2}=\\frac{169}{290}$，$y^{2}=\\frac{121}{290}$，$xy=\\frac{143}{290}$，我们有\n$$\nu_{1}^{(v^{(2)})}=x^{2}+4xy+y^{2}=\\frac{169+4\\cdot 143+121}{290}=\\frac{862}{290},\\quad\nu_{2}^{(v^{(2)})}=2x^{2}+2xy-y^{2}=\\frac{338+286-121}{290}=\\frac{503}{290}.\n$$\n因此，\n$$\n\\lambda^{(2)}=x\\,u_{1}^{(v^{(2)})}+y\\,u_{2}^{(v^{(2)})}=\\frac{13}{\\sqrt{290}}\\cdot\\frac{862}{290}+\\frac{11}{\\sqrt{290}}\\cdot\\frac{503}{290}=\\frac{16739}{290^{3/2}}.\n$$\n数值上，$\\lambda^{(2)}\\approx \\frac{16739}{290\\sqrt{290}}\\approx 3.389476$，四舍五入到四位有效数字为 $3.389$。", "answer": "$$\\boxed{3.389}$$", "id": "1527712"}, {"introduction": "在物理学和机器学习等实际应用中，张量通常以复杂网络的形式相互连接，最终计算结果需要通过一系列的张量缩并来完成。这个练习将揭示一个至关重要的概念：不同的缩并顺序会导致计算成本（即浮点运算次数）产生天壤之别。通过亲手比较不同计算路径的成本，你将体会到优化张量网络计算对于处理大规模问题的极端重要性 [@problem_id:1527713]。", "problem": "考虑一个由四个互连张量（记为 $T_1, T_2, T_3, T_4$）组成的网络。该网络的结构由共享的指标定义，最终的计算涉及对所有指标求和以产生一个标量值。该标量的表达式为：\n$$ S = \\sum_{a,b,c,d,e} T_1(a,b) T_2(b,c,d) T_3(c,e) T_4(d,e,a) $$\n指标的维度给定如下：$\\dim(a) = 2$，$\\dim(b) = 3$，$\\dim(c) = 4$，$\\dim(d) = 5$，以及 $\\dim(e) = 6$。\n\n标量 $S$ 的计算是通过一系列成对的张量缩并来执行的。缩并两个张量的计算成本以浮点运算次数（FLOPs）衡量，定义为被缩并的两个张量中所有唯一指标维度的乘积。总成本是该序列中每次成对缩并成本的总和。\n\n不同的缩并顺序会导致不同的总成本。您的任务是找到最高效的缩并顺序。\n\n计算计算标量 $S$ 所需的最小可能总 FLOPs 数。", "solution": "设指标维度为 $d(a)=2$，$d(b)=3$，$d(c)=4$，$d(d)=5$，$d(e)=6$。缩并两个指标集为 $I$ 和 $J$ 的张量的 FLOP 成本是 $\\prod_{i\\in I\\cup J} d(i)$。得到的张量带有的指标为 $(I\\cup J)\\setminus(I\\cap J)$。我们枚举所有可能的第一次缩并，并为每种情况选择最佳的后续缩并。\n\n1) 首先将 $T_{1}(a,b)$ 与 $T_{2}(b,c,d)$ 对指标 $b$ 进行缩并：\n- 成本 $= d(a)d(b)d(c)d(d)=2\\cdot 3\\cdot 4\\cdot 5=120$。结果为 $X_{12}(a,c,d)$。\n  a) 然后将 $X_{12}(a,c,d)$ 与 $T_{3}(c,e)$ 对指标 $c$ 进行缩并：\n  - 成本 $= d(a)d(c)d(d)d(e)=2\\cdot 4\\cdot 5\\cdot 6=240$。结果为 $X_{123}(a,d,e)$。\n  - 最后将 $X_{123}(a,d,e)$ 与 $T_{4}(d,e,a)$ 对指标 $a,d,e$ 进行缩并：\n  - 成本 $= d(a)d(d)d(e)=2\\cdot 5\\cdot 6=60$。\n  - 总成本 $=120+240+60=420$。\n  b) 然后将 $X_{12}(a,c,d)$ 与 $T_{4}(d,e,a)$ 对指标 $a,d$ 进行缩并：\n  - 成本 $= d(a)d(c)d(d)d(e)=2\\cdot 4\\cdot 5\\cdot 6=240$。结果为 $X_{124}(c,e)$。\n  - 最后将 $X_{124}(c,e)$ 与 $T_{3}(c,e)$ 对指标 $c,e$ 进行缩并：\n  - 成本 $= d(c)d(e)=4\\cdot 6=24$。\n  - 总成本 $=120+240+24=384$。\n  c) 或者将 $T_{3}(c,e)$ 与 $T_{4}(d,e,a)$ 对指标 $e$ 进行缩并：\n  - 成本 $= d(a)d(c)d(d)d(e)=2\\cdot 4\\cdot 5\\cdot 6=240$。结果为 $X_{34}(a,c,d)$。\n  - 最后将 $X_{12}(a,c,d)$ 与 $X_{34}(a,c,d)$ 对指标 $a,c,d$ 进行缩并：\n  - 成本 $= d(a)d(c)d(d)=2\\cdot 4\\cdot 5=40$。\n  - 总成本 $=120+240+40=400$。\n- 从此开始的最佳成本：$384$。\n\n2) 首先将 $T_{3}(c,e)$ 与 $T_{4}(d,e,a)$ 对指标 $e$ 进行缩并：\n- 成本 $= d(a)d(c)d(d)d(e)=2\\cdot 4\\cdot 5\\cdot 6=240$。结果为 $X_{34}(a,c,d)$。\n  a) 然后将 $T_{1}(a,b)$ 与 $T_{2}(b,c,d)$ 对指标 $b$ 进行缩并：\n  - 成本 $= d(a)d(b)d(c)d(d)=2\\cdot 3\\cdot 4\\cdot 5=120$。结果为 $X_{12}(a,c,d)$。\n  - 最后将 $X_{12}(a,c,d)$ 与 $X_{34}(a,c,d)$ 对指标 $a,c,d$ 进行缩并：\n  - 成本 $= d(a)d(c)d(d)=2\\cdot 4\\cdot 5=40$。\n  - 总成本 $=240+120+40=400$。\n  b) 然后将 $T_{1}(a,b)$ 与 $X_{34}(a,c,d)$ 对指标 $a$ 进行缩并：\n  - 成本 $= d(a)d(b)d(c)d(d)=2\\cdot 3\\cdot 4\\cdot 5=120$。结果为 $(b,c,d)$。\n  - 最后与 $T_{2}(b,c,d)$ 对指标 $b,c,d$ 进行缩并：\n  - 成本 $= d(b)d(c)d(d)=3\\cdot 4\\cdot 5=60$。\n  - 总成本 $=240+120+60=420$。\n  c) 然后将 $T_{2}(b,c,d)$ 与 $X_{34}(a,c,d)$ 对指标 $c,d$ 进行缩并：\n  - 成本 $= d(a)d(b)d(c)d(d)=2\\cdot 3\\cdot 4\\cdot 5=120$。结果为 $(a,b)$。\n  - 最后与 $T_{1}(a,b)$ 对指标 $a,b$ 进行缩并：\n  - 成本 $= d(a)d(b)=2\\cdot 3=6$。\n  - 总成本 $=240+120+6=366$。\n- 从此开始的最佳成本：$366$。\n\n3) 首先将 $T_{1}(a,b)$ 与 $T_{4}(d,e,a)$ 对指标 $a$ 进行缩并：\n- 成本 $= d(a)d(b)d(d)d(e)=2\\cdot 3\\cdot 5\\cdot 6=180$。结果为 $X_{14}(b,d,e)$。\n  a) 然后将 $X_{14}(b,d,e)$ 与 $T_{2}(b,c,d)$ 对指标 $b,d$ 进行缩并：\n  - 成本 $= d(b)d(c)d(d)d(e)=3\\cdot 4\\cdot 5\\cdot 6=360$。结果为 $(c,e)$。\n  - 最后与 $T_{3}(c,e)$ 对指标 $c,e$ 进行缩并：\n  - 成本 $= d(c)d(e)=4\\cdot 6=24$。\n  - 总成本 $=180+360+24=564$。\n  b) 然后将 $X_{14}(b,d,e)$ 与 $T_{3}(c,e)$ 对指标 $e$ 进行缩并：\n  - 成本 $= d(b)d(c)d(d)d(e)=3\\cdot 4\\cdot 5\\cdot 6=360$。结果为 $(b,c,d)$。\n  - 最后与 $T_{2}(b,c,d)$ 对指标 $b,c,d$ 进行缩并：\n  - 成本 $= d(b)d(c)d(d)=3\\cdot 4\\cdot 5=60$。\n  - 总成本 $=180+360+60=600$。\n  c) 或者将 $T_{2}(b,c,d)$ 与 $T_{3}(c,e)$ 对指标 $c$ 进行缩并：\n  - 成本 $= d(b)d(c)d(d)d(e)=3\\cdot 4\\cdot 5\\cdot 6=360$。结果为 $(b,d,e)$。\n  - 最后与 $X_{14}(b,d,e)$ 对指标 $b,d,e$ 进行缩并：\n  - 成本 $= d(b)d(d)d(e)=3\\cdot 5\\cdot 6=90$。\n  - 总成本 $=180+360+90=630$。\n- 从此开始的最佳成本：$564$。\n\n4) 首先将 $T_{2}(b,c,d)$ 与 $T_{3}(c,e)$ 对指标 $c$ 进行缩并：\n- 成本 $= d(b)d(c)d(d)d(e)=3\\cdot 4\\cdot 5\\cdot 6=360$。结果为 $X_{23}(b,d,e)$。\n  a) 然后将 $X_{23}(b,d,e)$ 与 $T_{1}(a,b)$ 对指标 $b$ 进行缩并：\n  - 成本 $= d(a)d(b)d(d)d(e)=2\\cdot 3\\cdot 5\\cdot 6=180$。结果为 $(a,d,e)$。\n  - 最后与 $T_{4}(d,e,a)$ 对指标 $a,d,e$ 进行缩并：\n  - 成本 $= d(a)d(d)d(e)=2\\cdot 5\\cdot 6=60$。\n  - 总成本 $=360+180+60=600$。\n  b) 然后将 $X_{23}(b,d,e)$ 与 $T_{4}(d,e,a)$ 对指标 $d,e$ 进行缩并：\n  - 成本 $= d(a)d(b)d(d)d(e)=2\\cdot 3\\cdot 5\\cdot 6=180$。结果为 $(a,b)$。\n  - 最后与 $T_{1}(a,b)$ 对指标 $a,b$ 进行缩并：\n  - 成本 $= d(a)d(b)=2\\cdot 3=6$。\n  - 总成本 $=360+180+6=546$。\n  c) 或者将 $T_{1}(a,b)$ 与 $T_{4}(d,e,a)$ 对指标 $a$ 进行缩并：\n  - 成本 $= d(a)d(b)d(d)d(e)=2\\cdot 3\\cdot 5\\cdot 6=180$。结果为 $(b,d,e)$。\n  - 最后与 $X_{23}(b,d,e)$ 对指标 $b,d,e$ 进行缩并：\n  - 成本 $= d(b)d(d)d(e)=3\\cdot 5\\cdot 6=90$。\n  - 总成本 $=360+180+90=630$。\n- 从此开始的最佳成本：$546$。\n\n5) 首先将 $T_{2}(b,c,d)$ 与 $T_{4}(d,e,a)$ 对指标 $d$ 进行缩并：\n- 成本 $= d(a)d(b)d(c)d(d)d(e)=2\\cdot 3\\cdot 4\\cdot 5\\cdot 6=720$。最佳的后续步骤产生的总成本至少为 $720+144+6=870$（例如，将结果与 $T_{3}$ 对指标 $c,e$ 进行缩并得到 $(a,b)$，然后再与 $T_{1}$ 缩并）。\n- 从此开始的最佳成本：$870$。\n\n6) 首先将 $T_{1}(a,b)$ 与 $T_{3}(c,e)$ 缩并（外积，无共享指标）：\n- 成本 $= d(a)d(b)d(c)d(e)=2\\cdot 3\\cdot 4\\cdot 6=144$。最佳的后续步骤（例如，与 $T_{2}$ 对指标 $b,c$进行缩并得到 $(a,d,e)$，然后再与 $T_{4}$ 缩并）的总成本为 $144+720+60=924$。\n- 从此开始的最佳成本：$924$。\n\n在所有顺序中，最小总 FLOPs 通过以下方式获得：\n- 首先：将 $T_{3}(c,e)$ 与 $T_{4}(d,e,a)$ 对指标 $e$ 进行缩并（成本 $240$），结果为 $X_{34}(a,c,d)$。\n- 其次：将 $T_{2}(b,c,d)$ 与 $X_{34}(a,c,d)$ 对指标 $c,d$ 进行缩并（成本 $120$），结果为 $(a,b)$。\n- 第三：将 $(a,b)$ 与 $T_{1}(a,b)$ 对指标 $a,b$ 进行缩并（成本 $6$）。\n\n因此，最小总 FLOPs 数为 $240+120+6=366$。", "answer": "$$\\boxed{366}$$", "id": "1527713"}]}