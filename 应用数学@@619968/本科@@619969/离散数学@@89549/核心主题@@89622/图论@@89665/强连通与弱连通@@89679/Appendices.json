{"hands_on_practices": [{"introduction": "理论知识的价值在于其能够指导实践。我们首先从一个看似简单却至关重要的问题开始：如何将两个独立的、本身运行良好的系统整合成一个单一的、同样稳固的系统？这个练习模拟了合并两个独立的强连通网络（例如两个公司的内部服务器网络）的情景，要求我们找出保证整个新网络强连通所需的最少连接数。通过解决这个问题，你将掌握在组件层面思考连通性的基本原则，并体会到图论中一个优雅而深刻的结论。[@problem_id:1402298]", "problem": "两个独立的、安全的服务器网络，网络A和网络B，正在被合并。每个网络都可以被建模为一个有向图（digraph），其中服务器是顶点，单向数据链路是有向边。网络A中的服务器集合是 $V_A$，网络B中的服务器集合是 $V_B$；这两个集合是不相交的。在每个独立的网络内部，可以通过一系列链接从任何服务器向任何其他服务器发送数据。用图论的术语来说，这意味着网络A的有向图 $G_A = (V_A, E_A)$ 和网络B的有向图 $G_B = (V_B, E_B)$ 都是强连通的。假设 $|V_A| \\ge 1$ 和 $|V_B| \\ge 1$。\n\n一位网络工程师需要在这两个网络之间添加新的单向数据链路（有向边），以形成一个单一的、统一的网络 $G_{total}$，并且这个网络也必须是强连通的。无论原始网络的规模或内部结构如何，为了保证合并后的网络是强连通的，必须添加的新链路的绝对最小数量是多少？\n\nA) 1\n\nB) 2\n\nC) 4\n\nD) 无法用一个固定的数量来保证；数量取决于 $|V_A|$ 和 $|V_B|$。\n\nE) 无法用一个固定的数量来保证；数量取决于 $G_A$ 和 $G_B$ 的具体边结构。", "solution": "设 $G_A=(V_A,E_A)$ 和 $G_B=(V_B,E_B)$ 为强连通有向图，且 $V_A \\cap V_B=\\varnothing$。设 $G_{total}$ 是通过添加 $k$ 条其端点分别位于不同集合中的有向边而得到的。\n\n至少需要两条网络间边的必要性：假设 $k=1$。不失一般性，设添加的唯一一条边是 $(u,v)$，其中 $u \\in V_A$ 且 $v \\in V_B$。那么，就不存在从 $V_B$ 到 $V_A$ 的有向边。任何从 $V_B$ 中的顶点到 $V_A$ 中的顶点的有向路径都至少需要从 $V_B$ 跨越到 $V_A$ 一次，但由于不存在该方向的边，这是不可能的。因此，$G_{total}$ 不可能是强连通的。如果这条唯一的边是从 $V_B$ 指向 $V_A$，结论同样成立。因此，$k \\ge 2$ 是必要的。\n\n两条网络间边的充分性：任意选择顶点 $a_0,a_1 \\in V_A$ 和 $b_0,b_1 \\in V_B$。添加两条边 $(a_0,b_0)$ 和 $(b_1,a_1)$。为了证明 $G_{total}$ 是强连通的，考虑任意顶点 $x,y$：\n- 如果 $x,y \\in V_A$ 或 $x,y \\in V_B$，由于 $G_A$ 或 $G_B$ 本身是强连通的，它们之间已存在有向路径。\n- 如果 $x \\in V_A$ 且 $y \\in V_B$，由于 $G_A$ 是强连通的，存在一条有向路径 $x \\to a_0$，然后通过添加的边 $(a_0,b_0)$，再接着在 $G_B$ 中走一条有向路径 $b_0 \\to y$。\n- 如果 $x \\in V_B$ 且 $y \\in V_A$，由于 $G_B$ 是强连通的，存在一条有向路径 $x \\to b_1$，然后通过添加的边 $(b_1,a_1)$，再接着在 $G_A$ 中走一条有向路径 $a_1 \\to y$。\n\n因此，两条边，在两个顶点集之间每个方向各一条，就能保证 $G_{total}$ 是强连通的。综合必要性和充分性，绝对最小数量是 $2$，并且这个数量与 $|V_A|$、$|V_B|$ 以及 $G_A$ 和 $G_B$ 的内部边结构无关。", "answer": "$$\\boxed{B}$$", "id": "1402298"}, {"introduction": "在掌握了连接两个组件的基本原理后，我们来挑战一个更普遍、更具现实意义的场景。现代软件架构，如微服务系统，通常始于一个无环的依赖结构（即有向无环图或 $DAG$），以避免无限循环的请求。这个练习要求你扮演系统架构师的角色，任务是向一个初始为 $DAG$ 的系统添加最少的通信信道，使其变为一个完全弹性的强连通网络。你将学习并应用一个强大的定理，该定理将图中“源”与“汇”的抽象概念与解决具体优化问题直接联系起来。[@problem_id:1402286]", "problem": "在现代云计算架构中，系统通常被设计为一组相互通信的独立微服务。这些服务之间的依赖关系可以建模为一个有向图，其中从服务`A`到服务`B`的一条边表示`A`可以向`B`发送请求。为了稳定性和防止请求链中出现无限循环，新系统的初始依赖图被配置为有向无环图（DAG）。\n\n该系统由十个微服务组成，由顶点集合 $V = \\{v_1, v_2, v_3, v_4, v_5, v_6, v_7, v_8, v_9, v_{10}\\}$ 表示。初始通信通道集合由有向边集合 $E = \\{(v_1, v_4), (v_2, v_4), (v_3, v_5), (v_4, v_6), (v_5, v_6), (v_6, v_7), (v_8, v_9)\\}$ 表示。\n\n一项新的运营要求规定，整个系统必须实现“完全弹性”，这在数学上意味着其依赖图必须变为强连通图。一个有向图是强连通的，如果对于每一对有序顶点 $(u, v)$，都存在一条从 $u$ 到 $v$ 的有向边路径。为了满足这一要求，系统架构师必须向图中添加新的通信通道（即有向边）。\n\n要使图 $G = (V, E)$ 变为强连通，至少需要添加多少条新边？", "solution": "我们将微服务通信结构建模为有向图 $G=(V,E)$，其中 $V=\\{v_{1},v_{2},\\ldots,v_{10}\\}$ 且 $E=\\{(v_{1},v_{4}),(v_{2},v_{4}),(v_{3},v_{5}),(v_{4},v_{6}),(v_{5},v_{6}),(v_{6},v_{7}),(v_{8},v_{9})\\}$。给定的图 $G$ 是一个有向无环图，因此每个顶点自身构成一个强连通分量 (SCC)。因此，其收缩图就是 $G$ 本身，包含 $10$ 个SCC。\n\n对于每个顶点，计算其在收缩DAG中的入度和出度：\n- $v_{1}$：入度为 $0$，出度为 $1$（到 $v_{4}$ 的边）。\n- $v_{2}$：入度为 $0$，出度为 $1$（到 $v_{4}$ 的边）。\n- $v_{3}$：入度为 $0$，出度为 $1$（到 $v_{5}$ 的边）。\n- $v_{4}$：入度为 $2$（来自 $v_{1},v_{2}$），出度为 $1$（到 $v_{6}$）。\n- $v_{5}$：入度为 $1$（来自 $v_{3}$），出度为 $1$（到 $v_{6}$）。\n- $v_{6}$：入度为 $2$（来自 $v_{4},v_{5}$），出度为 $1$（到 $v_{7}$）。\n- $v_{7}$：入度为 $1$（来自 $v_{6}$），出度为 $0$。\n- $v_{8}$：入度为 $0$，出度为 $1$（到 $v_{9}$）。\n- $v_{9}$：入度为 $1$（来自 $v_{8}$），出度为 $0$。\n- $v_{10}$：入度为 $0$，出度为 $0$。\n\n因此，入度为 $0$ 的SCC（源点）的数量为\n$$p=|\\{v_{1},v_{2},v_{3},v_{8},v_{10}\\}|=5,$$\n出度为 $0$ 的SCC（汇点）的数量为\n$$q=|\\{v_{7},v_{9},v_{10}\\}|=3.$$\n\n有向图的一个标准结论是：如果其收缩DAG含有多个SCC，则使该图成为强连通图所需添加的最小边数 $r$ 为\n$$r=\\max(p,q)。$$\n证明：至少需要 $p$ 条边来确保每个源SCC都获得一条入边，并且至少需要 $q$ 条边来确保每个汇SCC都获得一条出边，因此 $r \\geq \\max(p,q)$。反之，通过适当地将汇点连接到源点（如有必要，可重用某些汇点或源点），总可以添加 $\\max(p,q)$ 条边，将所有SCC连接成一个大的有向环，因此 $r \\leq \\max(p,q)$。\n\n将此结论应用于当前图，其中 $p=5$ 且 $q=3$，可得\n$$r=\\max(5,3)=5。$$\n\n为完整起见，一个能实现强连通的包含 $5$ 条新边的具体集合是$(v_{7},v_{8}), (v_{9},v_{2}), (v_{6},v_{1}), (v_{8},v_{10}), (v_{10},v_{3})$，添加这些边后，任意顶点都可以通过有向路径到达其他任何顶点。\n\n因此，所需添加的新边的最小数量是 $5$。", "answer": "$$\\boxed{5}$$", "id": "1402286"}, {"introduction": "最后，让我们通过一个挑战直觉的思辨性问题来深化理解。一个网络设计规范要求，网络中每个节点的入度和出度必须相等且不为零（$indegree(v) = outdegree(v) \\ge 1$），同时整个网络是弱连通的，但又必须存在缺陷（非强连通）。这个练习要求你评估这样一种设计是否可能存在。通过分析此问题，你将被引导运用强连通分量和图的“凝聚图”等更深层的理论工具，来证明某些看似合理的设计规范在逻辑上是自相矛盾的，从而领会理论在工程设计中的强大否证能力。[@problem_id:1402252]", "problem": "一位网络架构师正在设计一个新的服务器分布式系统。该架构被建模为一个有向图，其中服务器是顶点，单向通信链路是有向边。设计必须遵循一套严格的弹性和平衡协议。\n\n设计规范如下：\n1.  **平衡协议**：对于网络中的每个服务器，传入通信链路的数量必须恰好等于传出通信链路的数量。此外，每个服务器都必须有至少一条传入链路和一条传出链路。\n2.  **内聚协议**：网络必须是弱连通的。这意味着，如果忽略链路的单向性（即，将所有有向边视为无向边），整个服务器网络将形成一个单一的连通分量。\n3.  **已识别缺陷**：一项系统审计要求，为了测试目的，所提议的设计必须表现出一种特定类型的漏洞。网络必须*不是*强连通的。这意味着必须存在至少一对服务器，服务器A和服务器B，使得无法沿着有向通信链路从A向B发送消息。\n\n一位审查该规范的分析师声称，不可能设计出一个同时满足所有三个条件的网络。你的任务是评估这一说法。以下哪个陈述是正确的？\n\nA. 分析师错了；一个有3个服务器的网络可以满足所有条件。\nB. 分析师错了；一个有4个服务器的网络可以满足所有条件。\nC. 分析师错了；所需的最少服务器数量是6个。\nD. 分析师是正确的；不可能构建一个满足所有条件的网络。", "solution": "设 $G=(V,E)$ 是一个满足以下条件的有限有向图（无需对其简单性做出假设）：\n- 平衡：对于每个 $v\\in V$，$\\deg^{+}(v)=\\deg^{-}(v)$ 且两者均至少为1。\n- 内聚性：$G$ 的底层无向图是连通的。\n- 已识别缺陷：$G$ 不是强连通的。\n\n将 $G$ 分解为其强连通分量（SCCs），并通过将每个SCC收缩为单个顶点并保留分量之间的所有诱导有向边，来形成缩点有向图 $H$。一个标准结论是，$H$ 是一个有向无环图（DAG）。\n\n固定任意一个SCC $C\\subseteq V$。对 $C$ 中所有顶点的度数差求和：\n$$\n\\sum_{v\\in C}\\bigl(\\deg^{+}(v)-\\deg^{-}(v)\\bigr)=\\sum_{v\\in C}0=0.\n$$\n将每个度数分解为相对于 $C$ 的内部贡献和外部贡献。每条 $C$ 内部的有向边在求和中对 $\\deg^{+}$ 和 $\\deg^{-}$ 各贡献 $+1$，因此相互抵消。唯一不被抵消的贡献来自于跨越 $C$ 和 $V\\setminus C$ 之间的边。设 $d^{+}(C)$ 是从 $C$ 到 $V\\setminus C$ 的边的数量，而 $d^{-}(C)$ 是从 $V\\setminus C$ 到 $C$ 的边的数量。那么\n$$\n\\sum_{v\\in C}\\bigl(\\deg^{+}(v)-\\deg^{-}(v)\\bigr)=d^{+}(C)-d^{-}(C).\n$$\n因此 $d^{+}(C)-d^{-}(C)=0$，即，\n$$\nd^{+}(C)=d^{-}(C)\\quad\\text{for every SCC }C.\n$$\n\n现在考虑缩点DAG $H$。如果 $G$ 不是强连通的，那么 $H$ 至少有两个顶点，并且每个有限DAG都有一个源点。设 $C_{s}$ 是 $H$ 中的一个源分量，因此它没有来自其他分量的入边，即 $d^{-}(C_{s})=0$。根据上面的等式，有 $d^{+}(C_{s})=d^{-}(C_{s})=0$，所以 $C_{s}$ 也没有到其他分量的出边。因此，在 $G$ 中，$C_{s}$ 和 $V\\setminus C_{s}$ 之间双向都没有边。这意味着，即使忽略边的方向，也没有边连接 $C_{s}$ 和 $V\\setminus C_{s}$，因此底层无向图是不连通的，除非 $C_{s}=V$。\n\n因此，为了满足内聚协议（底层无向图的连通性），缩点图 $H$ 不能有多于一个顶点；因此 $G$ 必须是强连通的。这与已识别缺陷的要求相矛盾。因此，对于任何数量的服务器，都不存在这样的网络。\n\n因此，分析师是正确的：不可能构建一个满足所有三个条件的网络。", "answer": "$$\\boxed{D}$$", "id": "1402252"}]}