{"hands_on_practices": [{"introduction": "为了真正掌握 Itô-Stratonovich 转换，第一步是能够熟练地计算其核心——转换漂移项。本练习将引导你为一类在金融和物理学中广泛应用的扩散系数 $\\sigma(x) = \\alpha x^p$ 推导这个修正项。通过这个基础计算，你将能够清晰地看到 Itô 漂移和 Stratonovich 漂移之间的精确数学关系。[@problem_id:3062252]", "problem": "考虑一个由标准布朗运动 $W_{t}$ 驱动的标量伊藤随机微分方程 (SDE)，\n$$\ndX_{t} = b(X_{t})\\,dt + \\sigma(X_{t})\\,dW_{t},\n$$\n其中 $b$ 和 $\\sigma$ 是充分光滑的函数，且 $X_{t}$ 的取值范围为 $(0,\\infty)$。假设 $\\sigma(x) = \\alpha x^{p}$，其中 $\\alpha \\in \\mathbb{R}$ 和 $p \\in \\mathbb{R}$ 是常数。斯特拉托诺维奇随机积分由中点黎曼和定义，并遵循经典链式法则；而伊藤随机积分由左点黎曼和定义，并遵循伊藤引理，其中包含一个源于二次变分的二阶项。\n\n从这些基本定义和事实出发，推导联系该 SDE 的伊藤和斯特拉托诺维奇形式的漂移修正项，然后，针对特定的扩散系数 $\\sigma(x) = \\alpha x^{p}$，计算转换项，并将斯特拉托诺维奇漂移 $a(x)$ 完全用 $b(x)$、$\\alpha$ 和 $p$ 表示。\n\n以精确的符号表达式给出您的最终结果。不要进行近似或四舍五入。您的最终答案必须按顺序将转换项和斯特拉托诺维奇漂移作为一个单行向量列出。", "solution": "该问题要求推导伊藤随机微分方程 (SDE) 与其对应的斯特拉托诺维奇形式之间的关系，并计算给定扩散系数下的特定转换项。\n\n设伊藤 SDE 为：\n$$\ndX_{t} = b(X_{t})\\,dt + \\sigma(X_{t})\\,dW_{t}\n$$\n在此， $b(X_t)$ 是伊藤漂移，$\\sigma(X_t)$ 是扩散系数，$dW_t$ 代表标准维纳过程（布朗运动）的微分。\n\n相应的斯特拉托诺维奇 SDE 写为：\n$$\ndX_{t} = a(X_{t})\\,dt + \\sigma(X_{t})\\circ dW_{t}\n$$\n在此形式中，$a(X_t)$ 是斯特拉托诺维奇漂移，圆圈符号 $\\circ$ 表示斯特拉托诺维奇微分。\n\n对于过程 $\\sigma(X_t)$，伊藤随机积分与斯特拉托诺维奇随机积分之间的基本关系是随机分析中的一个基础性结果。这种关系源于定义这些积分的黎曼和中对求值点所使用的不同约定。伊藤积分使用左端点，而斯特拉托诺维奇积分使用中点。这一差异导致了一个与过程的二次协变分相关的修正项。\n\n微分形式的转换公式为：\n$$\n\\sigma(X_t) \\circ dW_t = \\sigma(X_t) \\, dW_t + \\frac{1}{2} [d\\sigma(X_t), dW_t]\n$$\n其中 $[d\\sigma(X_t), dW_t]$ 是二次协变分微分 $d\\langle \\sigma(X), W \\rangle_t$ 的简写。为计算此项，我们首先对应用于过程 $X_t$ 的函数 $\\sigma(x)$ 使用伊藤引理，求出微分 $d\\sigma(X_t)$：\n$$\nd\\sigma(X_t) = \\sigma'(X_t) dX_t + \\frac{1}{2} \\sigma''(X_t) (dX_t)^2\n$$\n代入 $dX_t = b(X_t)\\,dt + \\sigma(X_t)\\,dW_t$ 并使用乘法规则 $(dt)^2=0$、$dt \\cdot dW_t=0$ 和 $(dW_t)^2=dt$，我们得到：\n$$\nd\\sigma(X_t) = \\sigma'(X_t) (b(X_t)\\,dt + \\sigma(X_t)\\,dW_t) + \\frac{1}{2} \\sigma''(X_t) (\\sigma(X_t))^2 dt\n$$\n二次协变分 $[d\\sigma(X_t), dW_t]$ 是通过将各自微分中的 $dW_t$ 部分相乘并将 $(dW_t)^2$ 替换为 $dt$ 得到的：\n$$\n[d\\sigma(X_t), dW_t] = (\\sigma'(X_t) \\sigma(X_t) dW_t) \\cdot dW_t = \\sigma'(X_t) \\sigma(X_t) dt\n$$\n将此代回转换公式，得到：\n$$\n\\sigma(X_t) \\circ dW_t = \\sigma(X_t) \\, dW_t + \\frac{1}{2} \\sigma'(X_t) \\sigma(X_t) dt\n$$\n这就是伊藤微分与斯特拉托诺维奇微分之间的精确关系。\n\n现在，我们可以用伊藤微分来表示斯特拉托诺维奇 SDE：\n$$\ndX_t = a(X_t) dt + \\left( \\sigma(X_t) dW_t + \\frac{1}{2} \\sigma'(X_t) \\sigma(X_t) dt \\right)\n$$\n合并 $dt$ 项，我们得到：\n$$\ndX_t = \\left( a(X_t) + \\frac{1}{2} \\sigma'(X_t) \\sigma(X_t) \\right) dt + \\sigma(X_t) dW_t\n$$\n这是一个伊藤 SDE。为使其与给定的伊藤 SDE $dX_{t} = b(X_{t})\\,dt + \\sigma(X_{t})\\,dW_{t}$ 相同，漂移项必须相等：\n$$\nb(X_t) = a(X_t) + \\frac{1}{2} \\sigma'(X_t) \\sigma(X_t)\n$$\n项 $\\frac{1}{2} \\sigma'(X_t) \\sigma(X_t)$ 是漂移修正项，或称转换项，它被加到斯特拉托诺维奇漂移上以得到伊藤漂移。\n\n问题要求在 $\\sigma(x) = \\alpha x^p$ 的特定情况下，求出这个转换项和斯特拉托诺维奇漂移 $a(x)$。我们首先计算 $\\sigma(x)$ 的导数：\n$$\n\\sigma'(x) = \\frac{d}{dx}(\\alpha x^p) = \\alpha p x^{p-1}\n$$\n对于 $x \\in (0, \\infty)$（即 $X_t$ 的定义域），该导数的存在性和连续性是有保证的。\n\n接下来，我们使用这个导数来计算转换项：\n$$\n\\frac{1}{2} \\sigma'(x) \\sigma(x) = \\frac{1}{2} (\\alpha p x^{p-1}) (\\alpha x^p) = \\frac{1}{2} \\alpha^2 p x^{p-1+p} = \\frac{1}{2} \\alpha^2 p x^{2p-1}\n$$\n这是第一个所求的结果。\n\n为了求出斯特拉托诺维奇漂移 $a(x)$，我们重新整理漂移项之间的关系：\n$$\na(x) = b(x) - \\frac{1}{2} \\sigma'(x) \\sigma(x)\n$$\n代入计算出的转换项，我们得到 $a(x)$ 的表达式：\n$$\na(x) = b(x) - \\frac{1}{2} \\alpha^2 p x^{2p-1}\n$$\n这是第二个所求的结果。\n\n问题要求最终答案是一个行向量，按顺序包含转换项和斯特拉托诺维奇漂移 $a(x)$。\n\n转换项是：$\\frac{1}{2} \\alpha^2 p x^{2p-1}$。\n斯特拉托诺维奇漂移是：$a(x) = b(x) - \\frac{1}{2} \\alpha^2 p x^{2p-1}$。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{2} \\alpha^2 p x^{2p-1} & b(x) - \\frac{1}{2} \\alpha^2 p x^{2p-1} \\end{pmatrix}}\n$$", "id": "3062252"}, {"introduction": "Itô 和 Stratonovich 积分之间的理论差异在随机微分方程的数值模拟中表现得尤为具体。本练习将理论向前推进了一步，通过分析两种常用的数值格式——Euler–Maruyama (Itô) 和 Heun (Stratonovich)——来揭示这种差异。你将通过计算发现，这两种方法在单步期望上的系统性偏差，恰好等于我们在理论上推导出的 Itô-Stratonovich 修正漂移。[@problem_id:3062235]", "problem": "考虑伊藤（Itô）意义下的随机微分方程，\n$$\n\\mathrm{d}X_{t} = \\mu(X_{t})\\,\\mathrm{d}t + \\sigma(X_{t})\\,\\mathrm{d}W_{t},\n$$\n其中 $W_{t}$ 是一个标准维纳过程，且 $\\sigma(x) = \\alpha x$，$\\alpha \\in \\mathbb{R}$。设从时间 $t$ 的当前状态 $x$ 开始，取大小为 $\\Delta t>0$ 的单个时间步，并令 $\\Delta W$ 表示相应的维纳增量，满足 $\\Delta W \\sim \\mathcal{N}(0,\\Delta t)$。\n\n定义欧拉-丸山（Euler–Maruyama）更新\n$$\nX^{\\mathrm{EM}} = x + \\mu(x)\\,\\Delta t + \\sigma(x)\\,\\Delta W,\n$$\n和随机休恩（Heun）预测-校正更新\n$$\nY = x + \\mu(x)\\,\\Delta t + \\sigma(x)\\,\\Delta W,\\quad\nX^{\\mathrm{Heun}} = x + \\frac{1}{2}\\big(\\mu(x) + \\mu(Y)\\big)\\,\\Delta t + \\frac{1}{2}\\big(\\sigma(x) + \\sigma(Y)\\big)\\,\\Delta W.\n$$\n\n从上述定义以及维纳增量的性质 $E[\\Delta W]=0$ 和 $E[(\\Delta W)^{2}] = \\Delta t$ 出发，推导条件期望\n$$\nE\\big[X^{\\mathrm{Heun}} - X^{\\mathrm{EM}} \\,\\big|\\, X_{t}=x\\big]\n$$\n关于 $\\Delta t$ 的主阶表达式，该表达式是 $x$、$\\alpha$ 和 $\\Delta t$ 的解析函数。将您的最终答案表示为单个闭式表达式。然后，根据在伊藤（Itô）形式和斯特拉托诺维奇（Stratonovich）形式之间转换时产生的漂移项来解释这个主阶差异。无需进行数值计算，也无需四舍五入。您的最终答案必须是单个解析表达式。", "solution": "问题要求推导条件期望 $E\\big[X^{\\mathrm{Heun}} - X^{\\mathrm{EM}} \\,\\big|\\, X_{t}=x\\big]$ 关于 $\\Delta t$ 的主阶表达式。我们已知欧拉-丸山（Euler–Maruyama）更新 $X^{\\mathrm{EM}}$ 和随机休恩（Heun）预测-校正更新 $X^{\\mathrm{Heun}}$ 的定义。\n\n首先，我们表示这两个更新之间的差值。\n欧拉-丸山（Euler–Maruyama）更新由下式给出：\n$$\nX^{\\mathrm{EM}} = x + \\mu(x)\\,\\Delta t + \\sigma(x)\\,\\Delta W\n$$\n随机休恩（Heun）更新由下式给出：\n$$\nX^{\\mathrm{Heun}} = x + \\frac{1}{2}\\big(\\mu(x) + \\mu(Y)\\big)\\,\\Delta t + \\frac{1}{2}\\big(\\sigma(x) + \\sigma(Y)\\big)\\,\\Delta W\n$$\n其中预测子 $Y$ 定义为：\n$$\nY = x + \\mu(x)\\,\\Delta t + \\sigma(x)\\,\\Delta W\n$$\n差值 $X^{\\mathrm{Heun}} - X^{\\mathrm{EM}}$ 为：\n$$\nX^{\\mathrm{Heun}} - X^{\\mathrm{EM}} = \\left( x + \\frac{1}{2}\\mu(x)\\Delta t + \\frac{1}{2}\\mu(Y)\\Delta t + \\frac{1}{2}\\sigma(x)\\Delta W + \\frac{1}{2}\\sigma(Y)\\Delta W \\right) - \\left( x + \\mu(x)\\Delta t + \\sigma(x)\\Delta W \\right)\n$$\n简化此表达式，我们得到：\n$$\nX^{\\mathrm{Heun}} - X^{\\mathrm{EM}} = \\frac{1}{2}\\left( \\mu(Y) - \\mu(x) \\right)\\Delta t + \\frac{1}{2}\\left( \\sigma(Y) - \\sigma(x) \\right)\\Delta W\n$$\n接下来，我们计算这个差值的条件期望，记作 $E[\\cdot]$ 代表 $E[\\cdot \\,|\\, X_{t}=x]$。利用期望的线性性质：\n$$\nE\\left[X^{\\mathrm{Heun}} - X^{\\mathrm{EM}}\\right] = \\frac{1}{2} E\\left[\\mu(Y) - \\mu(x)\\right]\\Delta t + \\frac{1}{2} E\\left[\\left( \\sigma(Y) - \\sigma(x) \\right)\\Delta W\\right]\n$$\n为了计算期望，我们对函数 $\\mu(Y)$ 和 $\\sigma(Y)$ 在点 $x$ 附近进行泰勒级数展开。我们定义增量 $\\delta Y = Y - x = \\mu(x)\\Delta t + \\sigma(x)\\Delta W$。假设函数 $\\mu$ 和 $\\sigma$ 足够光滑。\n\n$\\sigma(Y)$ 在 $x$ 附近的泰勒展开式为：\n$$\n\\sigma(Y) = \\sigma(x + \\delta Y) = \\sigma(x) + \\sigma'(x)\\delta Y + \\frac{1}{2}\\sigma''(x)(\\delta Y)^2 + O\\left((\\delta Y)^3\\right)\n$$\n其中 $\\sigma'(x)$ 和 $\\sigma''(x)$ 表示 $\\sigma$ 关于其变量在 $x$ 点的一阶和二阶导数。\n\n我们来分析期望表达式的第二项 $E\\left[\\left( \\sigma(Y) - \\sigma(x) \\right)\\Delta W\\right]$：\n$$\nE\\left[\\left( \\sigma(Y) - \\sigma(x) \\right)\\Delta W\\right] = E\\left[\\left(\\sigma'(x)\\delta Y + \\frac{1}{2}\\sigma''(x)(\\delta Y)^2 + \\dots\\right)\\Delta W\\right]\n$$\n代入 $\\delta Y = \\mu(x)\\Delta t + \\sigma(x)\\Delta W$：\n$$\nE\\left[\\left(\\sigma'(x)(\\mu(x)\\Delta t + \\sigma(x)\\Delta W) + \\frac{1}{2}\\sigma''(x)(\\mu(x)\\Delta t + \\sigma(x)\\Delta W)^2 + \\dots\\right)\\Delta W\\right]\n$$\n我们展开此式并对每一项取期望。维纳增量 $\\Delta W$ 的性质为 $E[\\Delta W]=0$、$E[(\\Delta W)^2]=\\Delta t$ 和 $E[(\\Delta W)^3]=0$。\n展开式第一部分的期望为：\n$$\nE\\left[\\sigma'(x)(\\mu(x)\\Delta t + \\sigma(x)\\Delta W)\\Delta W\\right] = E\\left[\\sigma'(x)\\mu(x)\\Delta t \\Delta W + \\sigma'(x)\\sigma(x)(\\Delta W)^2\\right]\n$$\n$$\n= \\sigma'(x)\\mu(x)\\Delta t E[\\Delta W] + \\sigma'(x)\\sigma(x)E[(\\Delta W)^2] = 0 + \\sigma'(x)\\sigma(x)\\Delta t = \\sigma(x)\\sigma'(x)\\Delta t\n$$\n此项的阶为 $O(\\Delta t)$。现在考虑展开式中的下一项：\n$$\nE\\left[\\frac{1}{2}\\sigma''(x)(\\mu(x)\\Delta t + \\sigma(x)\\Delta W)^2\\Delta W\\right] = \\frac{1}{2}\\sigma''(x)E\\left[\\left((\\mu(x))^2 (\\Delta t)^2 + 2\\mu(x)\\sigma(x)\\Delta t\\Delta W + (\\sigma(x))^2 (\\Delta W)^2\\right)\\Delta W\\right]\n$$\n$$\n= \\frac{1}{2}\\sigma''(x)\\left((\\mu(x))^2 (\\Delta t)^2 E[\\Delta W] + 2\\mu(x)\\sigma(x)\\Delta t E[(\\Delta W)^2] + (\\sigma(x))^2 E[(\\Delta W)^3]\\right)\n$$\n$$\n= \\frac{1}{2}\\sigma''(x)\\left(0 + 2\\mu(x)\\sigma(x)\\Delta t (\\Delta t) + 0\\right) = \\mu(x)\\sigma(x)\\sigma''(x)(\\Delta t)^2\n$$\n此项的阶为 $O((\\Delta t)^2)$。展开式中所有更高阶的项对 $\\Delta t$ 的贡献次数也将大于或等于2。\n因此，对 $E\\left[(\\sigma(Y) - \\sigma(x))\\Delta W\\right]$ 的主阶贡献是 $\\sigma(x)\\sigma'(x)\\Delta t$。\n\n现在，我们分析主期望表达式的第一项，$\\frac{1}{2} E\\left[\\mu(Y) - \\mu(x)\\right]\\Delta t$。\n$$\nE[\\mu(Y)-\\mu(x)] = E\\left[\\mu'(x)\\delta Y + \\frac{1}{2}\\mu''(x)(\\delta Y)^2 + \\dots\\right]\n$$\n$$\n= \\mu'(x)E[\\delta Y] + \\frac{1}{2}\\mu''(x)E[(\\delta Y)^2] + \\dots\n$$\n我们计算 $\\delta Y$ 和 $(\\delta Y)^2$ 的期望：\n$$\nE[\\delta Y] = E[\\mu(x)\\Delta t + \\sigma(x)\\Delta W] = \\mu(x)\\Delta t\n$$\n$$\nE[(\\delta Y)^2] = E[(\\mu(x)\\Delta t + \\sigma(x)\\Delta W)^2] = E[(\\mu(x))^2(\\Delta t)^2 + 2\\mu(x)\\sigma(x)\\Delta t\\Delta W + (\\sigma(x))^2(\\Delta W)^2]\n$$\n$$\n= (\\mu(x))^2(\\Delta t)^2 + 0 + (\\sigma(x))^2\\Delta t = (\\sigma(x))^2\\Delta t + O((\\Delta t)^2)\n$$\n将这些结果代回，$E[\\mu(Y)-\\mu(x)]$ 中的主阶项的阶为 $O(\\Delta t)$。\n因此，项 $\\frac{1}{2} E\\left[\\mu(Y) - \\mu(x)\\right]\\Delta t$ 的阶为 $O((\\Delta t)^2)$。\n\n综合对两项的分析，对 $E\\left[X^{\\mathrm{Heun}} - X^{\\mathrm{EM}}\\right]$ 的主阶贡献来自 $\\frac{1}{2}E\\left[(\\sigma(Y) - \\sigma(x))\\Delta W\\right]$。\n$$\nE\\left[X^{\\mathrm{Heun}} - X^{\\mathrm{EM}}\\right] = \\frac{1}{2} \\left(\\sigma(x)\\sigma'(x)\\Delta t\\right) + O((\\Delta t)^2)\n$$\n主阶表达式为 $\\frac{1}{2}\\sigma(x)\\sigma'(x)\\Delta t$。\n\n题目指定 $\\sigma(x) = \\alpha x$。其导数为 $\\sigma'(x) = \\alpha$。将这些代入主阶表达式，得到：\n$$\n\\frac{1}{2}(\\alpha x)(\\alpha)\\Delta t = \\frac{1}{2}\\alpha^2 x \\Delta t\n$$\n这就是所要求的解析表达式。\n\n至于解释，我们将此结果与伊藤（Itô）和斯特拉托诺维奇（Stratonovich）随机微分方程之间的转换联系起来。一个伊藤（Itô）随机微分方程\n$$\n\\mathrm{d}X_{t} = \\mu(X_{t})\\,\\mathrm{d}t + \\sigma(X_{t})\\,\\mathrm{d}W_{t}\n$$\n等价于一个斯特拉托诺维奇（Stratonovich）随机微分方程\n$$\n\\mathrm{d}X_{t} = \\left(\\mu(X_{t}) - \\frac{1}{2}\\sigma(X_{t})\\sigma'(X_{t})\\right)\\mathrm{d}t + \\sigma(X_{t}) \\circ \\mathrm{d}W_{t}\n$$\n项 $\\frac{1}{2}\\sigma(X_t)\\sigma'(X_t)$ 是伊藤-斯特拉托诺维奇（Itô-Stratonovich）修正漂移项。\n欧拉-丸山（Euler-Maruyama）格式是伊藤（Itô）随机微分方程的一种数值方法。其期望的单步漂移是 $E[X^{\\mathrm{EM}}-x]=\\mu(x)\\Delta t$。\n随机休恩（Heun）格式是已知的求解斯特拉托诺维奇（Stratonovich）随机微分方程的数值方法。如果随机微分方程以伊藤（Itô）形式给出（如此处所示），休恩（Heun）方法实际上求解的是等价的斯特拉托诺维奇（Stratonovich）方程。这意味着它隐式地包含了修正漂移项。从伊藤（Itô）的角度来看，休恩（Heun）格式的期望单步漂移是 $E[X^{\\mathrm{Heun}}-x] = (\\mu(x) + \\frac{1}{2}\\sigma(x)\\sigma'(x))\\Delta t + O((\\Delta t)^2)$。\n因此，条件期望的差值为：\n$$\nE[X^{\\mathrm{Heun}} - X^{\\mathrm{EM}}] = E[X^{\\mathrm{Heun}}-x] - E[X^{\\mathrm{EM}}-x] + O((\\Delta t)^2) = \\frac{1}{2}\\sigma(x)\\sigma'(x)\\Delta t + O((\\Delta t)^2)\n$$\n这证实了我们计算出的主阶差 $\\frac{1}{2}\\alpha^2 x\\Delta t$ 正是伊藤-斯特拉托诺维奇（Itô-Stratonovich）修正漂移项 $\\frac{1}{2}\\sigma(x)\\sigma'(x) = \\frac{1}{2}(\\alpha x)(\\alpha) = \\frac{1}{2}\\alpha^2 x$ 乘以时间步长 $\\Delta t$。", "answer": "$$\n\\boxed{\\frac{1}{2}\\alpha^{2}x\\Delta t}\n$$", "id": "3062235"}, {"introduction": "理论分析和数值分析为我们揭示了修正漂移的存在，而仿真实践则能让我们“亲眼看到”这一效应。本练习是一个动手编码任务，你需要实现前一个练习中讨论的两种数值格式，并运行蒙特卡洛模拟。通过对比两种方法产生的路径的平均行为，你将从经验数据中量化出 Itô-Stratonovich 修正漂移，从而将抽象的数学公式与可测量的结果联系起来。[@problem_id:3062203]", "problem": "考虑一个由标准布朗运动驱动、具有标量扩散系数的一维随机微分方程。令 $W_t$ 表示标准布朗运动，令 $\\sigma(x)$ 为一个光滑的标量函数。文献中使用了两种关于 $W_t$ 的随机积分的经典解释：Itô 解释和 Stratonovich 解释。Itô 积分定义为左点黎曼和的 $L^2$ 极限，而 Stratonovich 积分定义为对称黎曼和（例如，中点求值）的极限。在使用独立高斯增量 $\\Delta W_n \\sim \\mathcal{N}(0,\\Delta t)$ 的时间网格 $t_n = n \\Delta t$ 上进行离散时间近似时，这些解释对应于不同的更新规则。\n\n从定义出发：\n- Itô 积分 $\\int_0^T \\sigma(X_t)\\,\\mathrm{d}W_t$ 是左点和的均方极限，即形如 $\\sum_n \\sigma(X_{t_n}) \\Delta W_n$ 的和。\n- Stratonovich 积分 $\\int_0^T \\sigma(X_t) \\circ \\mathrm{d}W_t$ 是对称和的均方极限，例如中点近似 $\\sum_n \\sigma\\!\\left(\\frac{X_{t_n} + X_{t_{n+1}}}{2}\\right) \\Delta W_n$。\n\n您的任务是通过模拟来经验性地验证标量 Itô–Stratonovich 转换，而不使用任何预先给定的转换公式。具体来说，对于无漂移的随机微分方程\n$$\n\\mathrm{d}X_t = \\sigma(X_t)\\,\\mathrm{d}W_t,\n$$\n执行以下步骤：\n- 在网格 $t_n$ 上实现 Itô Euler–Maruyama 更新：\n$$\nX_{n+1}^{\\mathrm{Ito}} = X_n^{\\mathrm{Ito}} + \\sigma\\!\\left(X_n^{\\mathrm{Ito}}\\right)\\,\\Delta W_n.\n$$\n- 在同一网格上实现一个与 Stratonovich 一致的中点 (Heun) 更新：\n$$\nX_{n+1}^{\\mathrm{Strat}} = X_n^{\\mathrm{Strat}} + \\frac{1}{2}\\left[\\sigma\\!\\left(X_n^{\\mathrm{Strat}}\\right) + \\sigma\\!\\left(X_n^{\\mathrm{Strat}} + \\sigma\\!\\left(X_n^{\\mathrm{Strat}}\\right)\\,\\Delta W_n\\right)\\right]\\Delta W_n.\n$$\n- 对每种格式，将经验性单位时间步漂移定义为在所有路径和所有步长上平均增量除以 $\\Delta t$：\n$$\n\\hat{\\mu}_{\\mathrm{Ito}} = \\frac{1}{N_{\\text{paths}}\\,N_{\\text{steps}}\\,\\Delta t}\\sum_{p=1}^{N_{\\text{paths}}}\\sum_{n=0}^{N_{\\text{steps}}-1}\\left(X_{n+1}^{\\mathrm{Ito},(p)} - X_n^{\\mathrm{Ito},(p)}\\right),\n$$\n$$\n\\hat{\\mu}_{\\mathrm{Strat}} = \\frac{1}{N_{\\text{paths}}\\,N_{\\text{steps}}\\,\\Delta t}\\sum_{p=1}^{N_{\\text{paths}}}\\sum_{n=0}^{N_{\\text{steps}}-1}\\left(X_{n+1}^{\\mathrm{Strat},(p)} - X_n^{\\mathrm{Strat},(p)}\\right).\n$$\n- 估计经验性漂移差\n$$\nD_{\\mathrm{emp}} = \\hat{\\mu}_{\\mathrm{Strat}} - \\hat{\\mu}_{\\mathrm{Ito}}.\n$$\n\n为了减少方差，对每条路径的两种格式使用相同的布朗增量 $\\Delta W_n$。将漂移 $a(x)$ 设置为恒等于零，以便任何非零的经验性漂移都仅源于对随机积分的解释。为了可复现性，使用固定的随机数生成器种子。\n\n在可能的情况下，以向量化的方式实现模拟。对于下面的每个测试用例，模拟 $N_{\\text{paths}}$ 条独立路径，每条路径演化 $N_{\\text{steps}}$ 个时间步，其中 $\\Delta W_n \\sim \\mathcal{N}(0,\\Delta t)$。\n\n测试套件：\n- 情况 1 (理想情况，线性扩散)：\n    - $\\sigma(x) = \\lambda x$，其中 $\\lambda = 0.7$。\n    - 初始状态 $X_0 = 1.0$。\n    - 总时间 $T = 1.0$。\n    - 时间步长 $\\Delta t = 0.001$。\n    - 路径数量 $N_{\\text{paths}} = 4096$。\n    - 种子 $= 12346$。\n\n- 情况 2 (边界情况，常数扩散)：\n    - $\\sigma(x) = c$，其中 $c = 1.5$。\n    - 初始状态 $X_0 = 0.5$。\n    - 总时间 $T = 1.0$。\n    - 时间步长 $\\Delta t = 0.001$。\n    - 路径数量 $N_{\\text{paths}} = 4096$。\n    - 种子 $= 12347$。\n\n- 情况 3 (非线性扩散)：\n    - $\\sigma(x) = \\gamma + \\beta \\sin(x)$，其中 $\\gamma = 0.5$，$\\beta = 0.6$。\n    - 初始状态 $X_0 = 0.3$。\n    - 总时间 $T = 1.0$。\n    - 时间步长 $\\Delta t = 0.001$。\n    - 路径数量 $N_{\\text{paths}} = 4096$。\n    - 种子 $= 12348$。\n\n程序要求：\n- 精确实现上述两种离散格式。\n- 使用指定的随机数生成器种子。\n- 在每个路径和时间步内，为 Itô 和 Stratonovich 更新使用相同的增量 $\\Delta W_n$。\n- 对每个测试用例，计算 $D_{\\mathrm{emp}}$ 并将其四舍五入到 $6$ 位小数。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。对于三个测试用例，输出\n$$\n\\left[D_{\\mathrm{emp}}^{(1)},D_{\\mathrm{emp}}^{(2)},D_{\\mathrm{emp}}^{(3)}\\right],\n$$\n四舍五入到 $6$ 位小数，例如 $\\left[0.123456,0.000000,0.012345\\right]$。", "solution": "该问题要求对一个标量随机微分方程（SDE）的 Itô–Stratonovich 转换公式进行经验性验证。这涉及到使用两种不同的数值格式来模拟同一个 SDE，一种与 Itô 积分一致，另一种与 Stratonovich 积分一致，然后比较所得路径的平均行为。\n\n一个一般的一维 Itô SDE 写为：\n$$\n\\mathrm{d}X_t = a(X_t)\\,\\mathrm{d}t + \\sigma(X_t)\\,\\mathrm{d}W_t\n$$\n其中 $a(X_t)$ 是漂移系数，$\\sigma(X_t)$ 是扩散系数，$\\mathrm{d}W_t$ 表示标准维纳过程的增量。随机积分 $\\int \\sigma(X_t)\\,\\mathrm{d}W_t$ 在 Itô 意义下解释。\n\n同一个物理过程可以使用 Stratonovich 解释来描述，用符号 $\\circ$ 表示：\n$$\n\\mathrm{d}X_t = \\alpha(X_t)\\,\\mathrm{d}t + \\sigma(X_t) \\circ \\mathrm{d}W_t\n$$\nStratonovich 积分的行为更像标准的 Riemann–Stieltjes 积分，并遵循普通的微积分法则（例如，链式法则没有额外的项）。然而，对于具有相同扩散系数 $\\sigma(X_t)$ 的过程，除非它们具有不同的漂移项，否则 Itô 和 Stratonovich SDE 是不等价的。它们之间的关系由 Itô–Stratonovich 转换公式给出。一个具有扩散 $\\sigma(X_t)$ 的 Stratonovich SDE 等价于一个带有附加漂移项的 Itô SDE，该附加项通常被称为修正漂移或伪漂移：\n$$\n\\sigma(X_t) \\circ \\mathrm{d}W_t = \\frac{1}{2}\\sigma(X_t)\\sigma'(X_t)\\,\\mathrm{d}t + \\sigma(X_t)\\,\\mathrm{d}W_t\n$$\n其中 $\\sigma'(x) = \\frac{\\mathrm{d}\\sigma}{\\mathrm{d}x}$。\n\n在本问题中，我们从一个无漂移的 Itô SDE 开始：\n$$\n\\mathrm{d}X_t = \\sigma(X_t)\\,\\mathrm{d}W_t\n$$\nEuler–Maruyama 格式是 Itô SDE 最直接的数值离散化：\n$$\nX_{n+1}^{\\mathrm{Ito}} = X_n^{\\mathrm{Ito}} + \\sigma(X_n^{\\mathrm{Ito}})\\,\\Delta W_n\n$$\n作为一个真正的 Itô 积分器，在当前状态的条件下，其增量的期望漂移为零：$\\mathbb{E}[X_{n+1}^{\\mathrm{Ito}} - X_n^{\\mathrm{Ito}} | X_n^{\\mathrm{Ito}}] = \\mathbb{E}[\\sigma(X_n^{\\mathrm{Ito}})\\,\\Delta W_n] = \\sigma(X_n^{\\mathrm{Ito}})\\mathbb{E}[\\Delta W_n] = 0$。因此，我们期望经验性漂移 $\\hat{\\mu}_{\\mathrm{Ito}}$ 接近于 $0$。\n\n问题提供了一个用于 Stratonovich 解释的类中点格式：\n$$\nX_{n+1}^{\\mathrm{Strat}} = X_n^{\\mathrm{Strat}} + \\frac{1}{2}\\left[\\sigma(X_n^{\\mathrm{Strat}}) + \\sigma\\left(X_n^{\\mathrm{Strat}} + \\sigma(X_n^{\\mathrm{Strat}})\\,\\Delta W_n\\right)\\right]\\Delta W_n\n$$\n该格式被设计为与 Stratonovich SDE $\\mathrm{d}X_t = \\sigma(X_t) \\circ \\mathrm{d}W_t$ 一致。因此，其动力学等价于 Itô SDE $\\mathrm{d}X_t = \\frac{1}{2}\\sigma(X_t)\\sigma'(X_t)\\,\\mathrm{d}t + \\sigma(X_t)\\,\\mathrm{d}W_t$。其增量的条件期望正确地捕捉了修正漂移：$\\mathbb{E}[X_{n+1}^{\\mathrm{Strat}} - X_n^{\\mathrm{Strat}} | X_n^{\\mathrm{Strat}}] \\approx \\frac{1}{2}\\sigma(X_n^{\\mathrm{Strat}})\\sigma'(X_n^{\\mathrm{Strat}})\\,\\Delta t$。因此，其经验性漂移 $\\hat{\\mu}_{\\mathrm{Strat}}$ 应该能提供对模拟路径上该修正漂移平均值的估计。\n\n任务是计算经验性漂移差 $D_{\\mathrm{emp}} = \\hat{\\mu}_{\\mathrm{Strat}} - \\hat{\\mu}_{\\mathrm{Ito}}$。根据上述推理，该量可作为平均修正漂移的数值估计：\n$$\nD_{\\mathrm{emp}} \\approx \\mathbb{E}\\left[\\frac{1}{2}\\sigma(X_t)\\sigma'(X_t)\\right]\n$$\n给定格式的经验性漂移 $\\hat{\\mu}$ 定义为：\n$$\n\\hat{\\mu} = \\frac{1}{N_{\\text{paths}}\\,N_{\\text{steps}}\\,\\Delta t}\\sum_{p=1}^{N_{\\text{paths}}}\\sum_{n=0}^{N_{\\text{steps}}-1}\\left(X_{n+1}^{(p)} - X_n^{(p)}\\right)\n$$\n内部的和是一个伸缩级数，$\\sum_{n=0}^{N_{\\text{steps}}-1}(X_{n+1}^{(p)} - X_n^{(p)}) = X_{N_{\\text{steps}}}^{(p)} - X_0^{(p)}$。由于总时间 $T = N_{\\text{steps}}\\,\\Delta t$，该公式简化为：\n$$\n\\hat{\\mu} = \\frac{1}{N_{\\text{paths}}\\,T}\\sum_{p=1}^{N_{\\text{paths}}}\\left(X_T^{(p)} - X_0\\right)\n$$\n然后可以从模拟的最终状态高效地计算出差值 $D_{\\mathrm{emp}}$：\n$$\nD_{\\mathrm{emp}} = \\hat{\\mu}_{\\mathrm{Strat}} - \\hat{\\mu}_{\\mathrm{Ito}} = \\frac{1}{N_{\\text{paths}}\\,T}\\sum_{p=1}^{N_{\\text{paths}}}\\left(X_T^{\\mathrm{Strat},(p)} - X_T^{\\mathrm{Ito},(p)}\\right) = \\frac{1}{T}\\mathbb{E}_{\\text{paths}}[X_T^{\\mathrm{Strat}} - X_T^{\\mathrm{Ito}}]\n$$\n求解算法如下：\n1.  对每个测试用例，定义参数（$X_0, T, \\Delta t, N_{\\text{paths}}$，种子）和扩散函数 $\\sigma(x)$。\n2.  为保证可复现性，设置随机数生成器种子。\n3.  以向量化方式为所有路径和时间步预先生成所有必要的维纳增量 $\\Delta W_n \\sim \\mathcal{N}(0,\\Delta t)$。该数组的形状将是 $(N_{\\text{paths}}, N_{\\text{steps}})$，其中 $N_{\\text{steps}} = T/\\Delta t$。\n4.  初始化两个状态向量，$X^{\\mathrm{Ito}}$ 和 $X^{\\mathrm{Strat}}$，大小均为 $N_{\\text{paths}}$，初始值为 $X_0$。\n5.  从 $n=0$ 到 $N_{\\text{steps}}-1$ 遍历时间步。在每一步中：\n    a. 对所有路径和两种更新格式使用相同的维纳增量 $\\Delta W_n$。\n    b. 根据 Euler–Maruyama 规则更新 $X^{\\mathrm{Ito}}$ 向量。\n    c. 根据 Stratonovich 中点规则更新 $X^{\\mathrm{Strat}}$ 向量。\n6.  循环结束后，计算两种格式最终状态之间的平均差：$\\mathbb{E}_{\\text{paths}}[X_T^{\\mathrm{Strat}} - X_T^{\\mathrm{Ito}}]$。\n7.  将此平均差除以总时间 $T$ 以获得 $D_{\\mathrm{emp}}$。\n8.  按要求将结果四舍五入到 6 位小数。\n\n将此过程应用于指定的三个测试用例中的每一个。对于情况 2，其中 $\\sigma(x)=c$ 是一个常数，$\\sigma'(x)=0$。修正漂移为零，Itô 和 Stratonovich 积分器变得相同。因此，我们期望 $D_{\\mathrm{emp}}$ 精确为 $0$。对于其他情况，预计会得到一个非零值。", "answer": "```python\nimport numpy as np\n\ndef _run_simulation(x0, T, dt, N_paths, seed, sigma_func):\n    \"\"\"\n    Runs a parallel simulation for Itô and Stratonovich schemes.\n\n    Args:\n        x0 (float): Initial state.\n        T (float): Total simulation time.\n        dt (float): Time step.\n        N_paths (int): Number of parallel paths to simulate.\n        seed (int): Seed for the random number generator.\n        sigma_func (callable): The diffusion function sigma(x).\n\n    Returns:\n        float: The empirical drift difference D_emp.\n    \"\"\"\n    N_steps = int(T / dt)\n    rng = np.random.default_rng(seed)\n\n    # Generate all Brownian increments at once for vectorization\n    # Shape: (N_paths, N_steps)\n    dW = rng.normal(loc=0.0, scale=np.sqrt(dt), size=(N_paths, N_steps))\n\n    # Initialize state vectors for both schemes\n    x_ito = np.full(N_paths, x0, dtype=float)\n    x_strat = np.full(N_paths, x0, dtype=float)\n\n    # Main time-stepping loop, vectorized over all paths\n    for n in range(N_steps):\n        dw_n = dW[:, n]\n\n        # Itô Euler–Maruyama update\n        sigma_val_ito = sigma_func(x_ito)\n        x_ito += sigma_val_ito * dw_n\n\n        # Stratonovich midpoint (Heun) update\n        sigma_val_strat = sigma_func(x_strat)\n        x_predictor = x_strat + sigma_val_strat * dw_n\n        sigma_val_predictor = sigma_func(x_predictor)\n        x_strat += 0.5 * (sigma_val_strat + sigma_val_predictor) * dw_n\n    \n    # Calculate D_emp using the simplified formula derived from the definition.\n    # D_emp = E[X_T_strat - X_T_ito] / T\n    d_emp = np.mean(x_strat - x_ito) / T\n    \n    return d_emp\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1 (linear diffusion)\n        {\n            \"sigma\": lambda p: (lambda x: p[\"lambda_\"] * x),\n            \"params\": {\"lambda_\": 0.7},\n            \"config\": {\"x0\": 1.0, \"T\": 1.0, \"dt\": 0.001, \"N_paths\": 4096, \"seed\": 12346}\n        },\n        # Case 2 (constant diffusion)\n        {\n            \"sigma\": lambda p: (lambda x: np.full_like(x, p[\"c\"])),\n            \"params\": {\"c\": 1.5},\n            \"config\": {\"x0\": 0.5, \"T\": 1.0, \"dt\": 0.001, \"N_paths\": 4096, \"seed\": 12347}\n        },\n        # Case 3 (nonlinear diffusion)\n        {\n            \"sigma\": lambda p: (lambda x: p[\"gamma\"] + p[\"beta\"] * np.sin(x)),\n            \"params\": {\"gamma\": 0.5, \"beta\": 0.6},\n            \"config\": {\"x0\": 0.3, \"T\": 1.0, \"dt\": 0.001, \"N_paths\": 4096, \"seed\": 12348}\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        config = case[\"config\"]\n        params = case[\"params\"]\n        \n        # Create the sigma function with its parameters bound\n        sigma_func = case[\"sigma\"](params)\n        \n        d_emp = _run_simulation(\n            x0=config[\"x0\"],\n            T=config[\"T\"],\n            dt=config[\"dt\"],\n            N_paths=config[\"N_paths\"],\n            seed=config[\"seed\"],\n            sigma_func=sigma_func\n        )\n        \n        results.append(round(d_emp, 6))\n\n    # Format the final output as a comma-separated list in brackets.\n    # The format specifier ensures that the rounding is preserved in the output string.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "3062203"}]}