{"hands_on_practices": [{"introduction": "伊藤引理（Itô's lemma）是随机微积分的基石，尤其在处理金融模型中的随机微分方程（SDE）时不可或缺。在实践中，我们常常更关心资产对数价格的动态，因为它通常具有更理想的统计特性。本练习将引导你应用伊藤引理，从 Heston 模型给出的资产价格 $S_t$ 的 SDE 出发，推导出其对数价格 $\\ln S_t$ 的动态过程。通过这个练习 [@problem_id:3078426]，你不仅能熟练掌握伊藤引理这一核心工具，还能深刻理解随机微积分中独特的修正项 $-\\frac{1}{2}v_t dt$ 是如何产生的，这正是它与经典微积分的关键区别。", "problem": "考虑 Heston 随机波动率模型中的一个资产价格过程。设资产价格 $S_t$ 严格为正，并满足随机微分方程 (SDE)\n$$dS_t = \\mu S_t \\, dt + \\sqrt{v_t} \\, S_t \\, dW^{(1)}_t,$$\n其中 $\\mu$ 是一个常数漂移项，$v_t$ 是一个适应的非负瞬时方差过程，$W^{(1)}_t$ 是一个标准布朗运动（维纳过程）。从一维伊藤过程的二次连续可微函数的伊藤引理定义出发，推导随机微分 $d(\\ln S_t)$ 并化简表达式。将您的最终答案表示为单个闭式解析表达式。无需进行数值舍入，也不涉及物理单位。", "solution": "该问题要求推导过程 $\\ln S_t$ 的随机微分，其中资产价格过程 $S_t$ 服从随机微分方程 (SDE)\n$$dS_t = \\mu S_t \\, dt + \\sqrt{v_t} \\, S_t \\, dW^{(1)}_t$$\n推导过程必须使用针对一维伊藤过程的二次连续可微函数的伊藤引理。\n\n设 $X_t$ 为满足 SDE 的一般一维伊藤过程：\n$$dX_t = a(t, X_t) \\, dt + b(t, X_t) \\, dW_t$$\n其中 $a(t, X_t)$ 是漂移项，$b(t, X_t)$ 是扩散项，$W_t$ 是一个标准维纳过程。\n\n伊藤引理指出，对于一个关于其自变量二次连续可微的函数 $f(X_t)$（即 $f \\in C^2$），其微分 $d(f(X_t))$ 由下式给出：\n$$df(X_t) = \\frac{\\partial f}{\\partial X_t} dX_t + \\frac{1}{2} \\frac{\\partial^2 f}{\\partial X_t^2} (dX_t)^2$$\n项 $(dX_t)^2$ 表示过程 $X_t$ 的二次变差。使用伊藤乘法规则，$(dt)^2 = 0$，$dt \\, dW_t = 0$ 以及 $(dW_t)^2 = dt$，二次变差计算如下：\n$$(dX_t)^2 = (a(t, X_t) \\, dt + b(t, X_t) \\, dW_t)^2 = b(t, X_t)^2 (dW_t)^2 = b(t, X_t)^2 \\, dt$$\n将此代入伊藤引理的公式，得到更明确的形式：\n$$df(X_t) = \\left( a(t, X_t) \\frac{\\partial f}{\\partial X_t} + \\frac{1}{2} b(t, X_t)^2 \\frac{\\partial^2 f}{\\partial X_t^2} \\right) dt + b(t, X_t) \\frac{\\partial f}{\\partial X_t} dW_t$$\n\n在这个问题中，伊藤过程是资产价格 $S_t$，因此我们设 $X_t = S_t$。根据给定的 $S_t$ 的 SDE：\n$$dS_t = \\mu S_t \\, dt + \\sqrt{v_t} \\, S_t \\, dW^{(1)}_t$$\n我们可以确定漂移和扩散系数：\n$$a(t, S_t) = \\mu S_t$$\n$$b(t, S_t) = \\sqrt{v_t} S_t$$\n\n我们应用引理的函数是 $f(S_t) = \\ln S_t$。由于问题陈述 $S_t$ 严格为正，该函数是良定义的。我们需要它关于 $S_t$ 的一阶和二阶偏导数。设 $f(s) = \\ln s$。\n一阶导数是：\n$$\\frac{\\partial f}{\\partial s} = \\frac{1}{s}$$\n在 $s=S_t$ 处求值，得到 $\\frac{1}{S_t}$。\n\n二阶导数是：\n$$\\frac{\\partial^2 f}{\\partial s^2} = -\\frac{1}{s^2}$$\n在 $s=S_t$ 处求值，得到 $-\\frac{1}{S_t^2}$。\n\n现在，我们将这些分量代入伊藤引理关于 $d(\\ln S_t) = df(S_t)$ 的完整形式中：\n$$d(\\ln S_t) = \\left( (\\mu S_t) \\left(\\frac{1}{S_t}\\right) + \\frac{1}{2} (\\sqrt{v_t} S_t)^2 \\left(-\\frac{1}{S_t^2}\\right) \\right) dt + (\\sqrt{v_t} S_t) \\left(\\frac{1}{S_t}\\right) dW^{(1)}_t$$\n\n我们化简 $dt$ 分量（即 $\\ln S_t$ 的漂移项）括号内的各项：\n$$(\\mu S_t) \\left(\\frac{1}{S_t}\\right) = \\mu$$\n$$\\frac{1}{2} (\\sqrt{v_t} S_t)^2 \\left(-\\frac{1}{S_t^2}\\right) = \\frac{1}{2} (v_t S_t^2) \\left(-\\frac{1}{S_t^2}\\right) = -\\frac{1}{2} v_t$$\n因此，$d(\\ln S_t)$ 的漂移项是 $\\mu - \\frac{1}{2} v_t$。\n\n接下来，我们化简乘以 $dW^{(1)}_t$ 的项（即 $\\ln S_t$ 的扩散项）：\n$$(\\sqrt{v_t} S_t) \\left(\\frac{1}{S_t}\\right) = \\sqrt{v_t}$$\n\n结合这些化简后的项，我们得到 $\\ln S_t$ 的随机微分：\n$$d(\\ln S_t) = \\left(\\mu - \\frac{1}{2} v_t\\right) dt + \\sqrt{v_t} \\, dW^{(1)}_t$$\n这个表达式就是资产价格对数的随机微分的最终简化闭式解析结果。", "answer": "$$\\boxed{\\left(\\mu - \\frac{1}{2} v_t\\right) dt + \\sqrt{v_t} \\, dW^{(1)}_t}$$", "id": "3078426"}, {"introduction": "理解复杂模型的一个有效方法是探究它与我们熟知的简单模型之间的联系。Heston 模型可以看作是对经典的 Black-Scholes 模型的重要推广，它引入了随机波动的概念。本练习要求你首先利用费曼-卡茨（Feynman-Kac）定理推导出 Heston 模型的通用定价偏微分方程（PDE），然后通过设置特定简化条件——即波动率恒定且与资产价格不相关（$\\rho=0$）——来证明这个复杂的 PDE 将退化为我们所熟悉的 Black-Scholes PDE [@problem_id:3078353]。这个过程能极大地帮助你建立直观认识，让你明白 Black-Scholes 模型实际上是 Heston 模型框架下的一个特例。", "problem": "考虑风险中性测度下一个股票价格过程的 Heston 随机波动率模型。该模型指定了如下随机微分方程 (SDE)：\n$$\n\\mathrm{d}S_{t} = r\\,S_{t}\\,\\mathrm{d}t + \\sqrt{v_{t}}\\,S_{t}\\,\\mathrm{d}W^{(1)}_{t}, \\qquad\n\\mathrm{d}v_{t} = \\kappa\\left(\\theta - v_{t}\\right)\\mathrm{d}t + \\eta \\sqrt{v_{t}}\\,\\mathrm{d}W^{(2)}_{t},\n$$\n其中 $S_{t}$ 是资产价格，$v_{t}$ 是瞬时方差，$r$ 是恒定的无风险利率，$\\kappa  0$ 是均值回归速度，$\\theta  0$ 是长期方差水平，$\\eta  0$ 是波动率的波动率，而 $\\left(W^{(1)}_{t}, W^{(2)}_{t}\\right)$ 是瞬时相关系数为 $\\rho$ 的相关维纳过程，即 $\\mathrm{d}\\langle W^{(1)},W^{(2)}\\rangle_{t} = \\rho\\,\\mathrm{d}t$。\n\n令 $C(S,v,t)$ 表示一个到期日为 $T$、期末收益为 $\\Phi(S_{T})$ 的欧式或有债权在时间 $t$ 的价格，其中 $\\Phi$ 足够光滑且至多为多项式增长。利用马尔可夫过程 $\\left(S_{t},v_{t}\\right)$ 的无穷小生成元和 Feynman–Kac 定理，推导在风险中性测度下 $C(S,v,t)$ 必须满足的偏微分方程 (PDE)。然后，施加条件 $\\rho = 0$ 且 $v_{t} \\equiv v$ 为一个正常数（即，$v$ 不再随机演化）。从第一性原理出发，证明所得的 PDE 与不付红利资产的 Black–Scholes PDE 一致。\n\n作答要求：\n- 您的推导必须从给定的 SDE 和无穷小生成元的定义开始，不能假定任何已知的定价 PDE。\n- 通过适当的系数比较，将简化后的 PDE 明确地标识为 Black–Scholes PDE。\n- 对于您的最终答案，请给出有效 Black–Scholes 波动率参数 $\\sigma_{\\mathrm{eff}}$ 关于 $v$ 的单个符号表达式。无需进行数值计算。", "solution": "我们从风险中性测度下的 Heston 模型 SDE 开始：\n$$\n\\mathrm{d}S_{t} = r\\,S_{t}\\,\\mathrm{d}t + \\sqrt{v_{t}}\\,S_{t}\\,\\mathrm{d}W^{(1)}_{t}, \\qquad\n\\mathrm{d}v_{t} = \\kappa\\left(\\theta - v_{t}\\right)\\mathrm{d}t + \\eta \\sqrt{v_{t}}\\,\\mathrm{d}W^{(2)}_{t},\n$$\n其中 $\\mathrm{d}\\langle W^{(1)},W^{(2)}\\rangle_{t} = \\rho\\,\\mathrm{d}t$。\n\n状态向量为 $\\left(S_{t},v_{t}\\right)$。令 $f(S,v,t)$ 为一个足够光滑的检验函数。$\\left(S_{t},v_{t}\\right)$ 的无穷小生成元 $\\mathcal{L}$ 作用于 $f$ 的形式为\n$$\n\\mathcal{L} f = b_{S}\\,\\frac{\\partial f}{\\partial S} + b_{v}\\,\\frac{\\partial f}{\\partial v} + \\frac{1}{2}a_{SS}\\,\\frac{\\partial^{2} f}{\\partial S^{2}} + a_{Sv}\\,\\frac{\\partial^{2} f}{\\partial S\\,\\partial v} + \\frac{1}{2}a_{vv}\\,\\frac{\\partial^{2} f}{\\partial v^{2}},\n$$\n其中 $b_{S}$ 和 $b_{v}$ 是漂移分量，$a_{SS}$，$a_{Sv}$，$a_{vv}$ 是与 SDE 相关的扩散协方差矩阵的元素。根据给定的 SDE，\n- 漂移项为\n$$\nb_{S} = r\\,S, \\qquad b_{v} = \\kappa\\left(\\theta - v\\right).\n$$\n- 扩散系数（维纳过程的乘数）为\n$$\n\\text{对于 } S: \\quad \\sqrt{v}\\,S, \\qquad \\text{对于 } v: \\quad \\eta \\sqrt{v},\n$$\n瞬时相关系数为 $\\rho$。因此，协方差矩阵的元素为\n$$\na_{SS} = \\left(\\sqrt{v}\\,S\\right)^{2} = v\\,S^{2}, \\qquad\na_{vv} = \\left(\\eta \\sqrt{v}\\right)^{2} = \\eta^{2}\\,v, \\qquad\na_{Sv} = \\rho \\left(\\sqrt{v}\\,S\\right)\\left(\\eta \\sqrt{v}\\right) = \\rho\\,\\eta\\,v\\,S.\n$$\n\nFeynman–Kac 定理指出，具有期末收益 $\\Phi(S_{T})$ 的欧式或有债权的无套利价格 $C(S,v,t)$ 满足以下定价 PDE\n$$\n\\frac{\\partial C}{\\partial t} + \\mathcal{L} C - r\\,C = 0,\n$$\n并满足期末条件 $C(S,v,T) = \\Phi(S)$ 和适当的增长/边界条件。将 $b_{S}$、$b_{v}$、$a_{SS}$、$a_{Sv}$ 和 $a_{vv}$ 的表达式代入 $\\mathcal{L}$，我们得到 Heston 定价 PDE：\n$$\n\\frac{\\partial C}{\\partial t}\n+ r\\,S\\,\\frac{\\partial C}{\\partial S}\n+ \\kappa\\left(\\theta - v\\right)\\frac{\\partial C}{\\partial v}\n+ \\frac{1}{2}v\\,S^{2}\\,\\frac{\\partial^{2} C}{\\partial S^{2}}\n+ \\rho\\,\\eta\\,v\\,S\\,\\frac{\\partial^{2} C}{\\partial S\\,\\partial v}\n+ \\frac{1}{2}\\eta^{2}\\,v\\,\\frac{\\partial^{2} C}{\\partial v^{2}}\n- r\\,C\n= 0.\n$$\n\n现在施加条件 $\\rho = 0$ 且 $v_{t} \\equiv v$ 是一个正常数。设 $\\rho = 0$ 消除了混合二阶导数项：\n$$\n\\rho\\,\\eta\\,v\\,S\\,\\frac{\\partial^{2} C}{\\partial S\\,\\partial v} = 0.\n$$\n当 $v$ 是常数时（即，不随机演化），期权价格 $C$ 仅参数化地依赖于 $v$ 而非动态地依赖，因此关于 $v$ 的导数消失：\n$$\n\\frac{\\partial C}{\\partial v} = 0, \\qquad \\frac{\\partial^{2} C}{\\partial v^{2}} = 0.\n$$\n经过这些简化，定价 PDE 简化为\n$$\n\\frac{\\partial C}{\\partial t}\n+ r\\,S\\,\\frac{\\partial C}{\\partial S}\n+ \\frac{1}{2}v\\,S^{2}\\,\\frac{\\partial^{2} C}{\\partial S^{2}}\n- r\\,C\n= 0.\n$$\n\n这正是针对不付红利资产的 Black–Scholes 偏微分方程 (PDE)，其中常数波动率 $\\sigma_{\\mathrm{eff}}$ 满足\n$$\n\\frac{1}{2}\\sigma_{\\mathrm{eff}}^{2}\\,S^{2} = \\frac{1}{2}v\\,S^{2}.\n$$\n因此，\n$$\n\\sigma_{\\mathrm{eff}}^{2} = v \\quad \\Longrightarrow \\quad \\sigma_{\\mathrm{eff}} = \\sqrt{v}.\n$$\n\n所要求的最终答案是有效 Black–Scholes 波动率参数关于 $v$ 的表达式。", "answer": "$$\\boxed{\\sqrt{v}}$$", "id": "3078353"}, {"introduction": "理论是基础，但将模型付诸实践是量化金融的核心。由于像 Heston 模型这样的复杂随机模型很少有解析解，数值模拟成为了不可或缺的工具。Heston 模型的关键特征之一是资产价格与其波动率之间的相关性，由参数 $\\rho$ 控制。本练习将带你从理论走向实践，通过编程实现一种标准方法——Cholesky 分解，来生成模拟所需的、具有指定相关性的布朗运动增量 [@problem_id:3078440]。掌握这项技术是构建完整的 Heston 模型模拟器、进行衍生品定价和风险管理的关键一步。", "problem": "您的任务是使用目标协方差矩阵的 Cholesky 分解，来模拟 Heston 随机波动率模型所需的相关布朗运动增量。在 Heston 模型中，资产价格和方差动态由两个具有瞬时相关性的布朗运动驱动。您的目标是仅利用关于布朗运动和多元正态分布的基本事实，实现一个保持预定相关性的模拟。\n\n起始点（基本依据）：\n- 设 $B_t^{(1)}$ 和 $B_t^{(2)}$ 是瞬时相关性为 $\\rho \\in (-1,1)$ 的布朗运动。在一个长度为 $\\Delta t  0$ 的时间步长内，增量 $\\Delta W^{(1)} = B_{t+\\Delta t}^{(1)} - B_t^{(1)}$ 和 $\\Delta W^{(2)} = B_{t+\\Delta t}^{(2)} - B_t^{(2)}$ 满足：\n  - $\\mathbb{E}[\\Delta W^{(1)}] = 0$，$\\mathbb{E}[\\Delta W^{(2)}] = 0$，\n  - $\\operatorname{Var}(\\Delta W^{(1)}) = \\Delta t$，$\\operatorname{Var}(\\Delta W^{(2)}) = \\Delta t$，\n  - $\\operatorname{Cov}(\\Delta W^{(1)}, \\Delta W^{(2)}) = \\rho \\, \\Delta t$。\n- 因此，向量 $\\Delta W = (\\Delta W^{(1)}, \\Delta W^{(2)})^\\top$ 的目标协方差矩阵为\n  $$\\Sigma = \\Delta t \\begin{pmatrix} 1  \\rho \\\\ \\rho  1 \\end{pmatrix}.$$\n- 如果 $Z = (Z_1,Z_2)^\\top$ 具有独立同分布 (i.i.d.) 的标准正态分量，且 $L$ 是一个满足 $L L^\\top = \\Sigma$ 的下三角矩阵（一个 Cholesky 因子），那么 $\\Delta W = L Z$ 的均值为零，协方差为 $\\Sigma$。\n\n任务：\n- 实现一个程序，对于每个测试用例，使用 Cholesky 分解方法，在长度为 $\\Delta t$ 的单个时间步长上，生成 $N$ 个具有期望相关性 $\\rho$ 的相关布朗增量 $(\\Delta W^{(1)}, \\Delta W^{(2)})$ 样本。\n- 为保证此层级的数值稳定性和清晰度，请推导并使用 $2\\times 2$ 矩阵 $\\Sigma$ 的显式下三角 Cholesky 因子，然后通过变换独立同分布的标准正态随机变量来生成样本。您的实现必须仅使用所述的基本性质，不得调用任何黑盒多元采样器。\n- 计算模拟出的 $\\Delta W^{(1)}$ 和 $\\Delta W^{(2)}$ 样本之间的经验皮尔逊相关系数。令 $\\widehat{\\rho}$ 表示此经验相关性。\n\n需要计算的内容：\n- 对于每个测试用例，输出一个布尔值，指示绝对误差 $|\\widehat{\\rho} - \\rho|$ 是否小于或等于给定的容差 $\\varepsilon$。在计算经验相关性时，请使用零均值中心化。\n\n测试套件：\n使用以下测试用例，其中每个元组为 $(\\rho, \\Delta t, N, \\varepsilon, \\text{seed})$：\n- $(0.0, 0.05, 200000, 0.01, 1)$\n- $(0.5, 0.01, 200000, 0.01, 2)$\n- $(-0.7, 0.02, 250000, 0.01, 3)$\n- $(0.99, 0.01, 300000, 0.02, 4)$\n\n定义和约束：\n- 您必须将 $(\\Delta W^{(1)}, \\Delta W^{(2)})$ 视为一个单步相关高斯增量向量，该向量是通过一个满足 $L L^\\top = \\Sigma$ 的 Cholesky 因子 $L$ 从独立同分布的标准正态变量构建的。\n- 对于每个测试用例，模拟必须能够使用提供的伪随机数生成器种子进行复现。\n- 不涉及角度。除了时间步长 $\\Delta t$（在此处为无量纲标量）外，不需要其他物理单位。\n- 给定种子后，程序必须是自包含且确定性的。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表，例如 $[\\text{True},\\text{False},\\text{True},\\text{True}]$。\n\n交付成果：\n- 一个完整、可运行的程序，该程序：\n  - 对于每个测试用例，使用 Cholesky 因子生成相关的布朗增量，\n  - 计算经验相关性 $\\widehat{\\rho}$，\n  - 将 $|\\widehat{\\rho} - \\rho|$与容差 $\\varepsilon$ 进行比较，\n  - 输出一行布尔值列表，按上面给出的确切顺序指示每个测试用例的通过或失败。", "solution": "问题陈述有效。它以随机微积分和多元统计学原理为科学基础，问题提法适定，目标明确，所有必要参数均已提供，且语言和要求客观。陈述中没有矛盾、歧义或事实错误。该任务是计算金融领域一个标准且定义明确的练习：使用 Cholesky 分解模拟相关随机过程。\n\n问题的核心是生成一个二维随机向量 $\\Delta W = (\\Delta W^{(1)}, \\Delta W^{(2)})^\\top$ 的样本，该向量遵循均值为零、协方差矩阵为指定矩阵 $\\Sigma$ 的多元正態分布。给定的性质如下：\n- $\\mathbb{E}[\\Delta W^{(1)}] = \\mathbb{E}[\\Delta W^{(2)}] = 0$\n- $\\operatorname{Var}(\\Delta W^{(1)}) = \\operatorname{Var}(\\Delta W^{(2)}) = \\Delta t$\n- $\\operatorname{Cov}(\\Delta W^{(1)}, \\Delta W^{(2)}) = \\rho \\Delta t$\n\n这些性质定义了向量 $\\Delta W$ 的协方差矩阵 $\\Sigma$：\n$$\n\\Sigma = \\mathbb{E}[\\Delta W \\Delta W^\\top] = \\begin{pmatrix} \\mathbb{E}[(\\Delta W^{(1)})^2]  \\mathbb{E}[\\Delta W^{(1)} \\Delta W^{(2)}] \\\\ \\mathbb{E}[\\Delta W^{(2)} \\Delta W^{(1)}]  \\mathbb{E}[(\\Delta W^{(2)})^2] \\end{pmatrix} = \\begin{pmatrix} \\operatorname{Var}(\\Delta W^{(1)})  \\operatorname{Cov}(\\Delta W^{(1)}, \\Delta W^{(2)}) \\\\ \\operatorname{Cov}(\\Delta W^{(1)}, \\Delta W^{(2)})  \\operatorname{Var}(\\Delta W^{(2)}) \\end{pmatrix}\n$$\n代入给定值，我们得到：\n$$\n\\Sigma = \\begin{pmatrix} \\Delta t  \\rho \\Delta t \\\\ \\rho \\Delta t  \\Delta t \\end{pmatrix} = \\Delta t \\begin{pmatrix} 1  \\rho \\\\ \\rho  1 \\end{pmatrix}\n$$\n指定的方法是使用 $\\Sigma$ 的 Cholesky 分解。这需要找到一个下三角矩阵 $L$，使得 $L L^\\top = \\Sigma$。然后可以通过线性变换 $\\Delta W = L Z$ 来生成期望的相关变量 $\\Delta W$，其中 $Z = (Z_1, Z_2)^\\top$ 是独立标准正态变量（即 $Z_1, Z_2 \\sim \\mathcal{N}(0,1)$ 且独立同分布）的向量。这种方法之所以有效，是因为变换后向量的协方差为 $\\mathbb{E}[(L Z)(L Z)^\\top] = L \\, \\mathbb{E}[Z Z^\\top] \\, L^\\top = L I L^\\top = L L^\\top = \\Sigma$，其中 $I$ 是单位矩阵。\n\n首先，我们推导 Cholesky 因子 $L$ 的显式形式。令 $L$ 为一个通用的 $2 \\times 2$ 下三角矩阵：\n$$\nL = \\begin{pmatrix} l_{11}  0 \\\\ l_{21}  l_{22} \\end{pmatrix}\n$$\n条件 $L L^\\top = \\Sigma$ 变为：\n$$\n\\begin{pmatrix} l_{11}  0 \\\\ l_{21}  l_{22} \\end{pmatrix} \\begin{pmatrix} l_{11}  l_{21} \\\\ 0  l_{22} \\end{pmatrix} = \\begin{pmatrix} l_{11}^2  l_{11} l_{21} \\\\ l_{11} l_{21}  l_{21}^2 + l_{22}^2 \\end{pmatrix} = \\begin{pmatrix} \\Delta t  \\rho \\Delta t \\\\ \\rho \\Delta t  \\Delta t \\end{pmatrix}\n$$\n通过令矩阵元素相等，我们可以解出 $l_{11}$、$l_{21}$ 和 $l_{22}$：\n1.  根据 $(1,1)$ 元素：$l_{11}^2 = \\Delta t$。按照惯例，我们取正根，因此 $l_{11} = \\sqrt{\\Delta t}$。\n2.  根据 $(2,1)$ 元素：$l_{11} l_{21} = \\rho \\Delta t$。代入 $l_{11}$，我们得到 $\\sqrt{\\Delta t} \\, l_{21} = \\rho \\Delta t$，解得 $l_{21} = \\rho \\sqrt{\\Delta t}$。\n3.  根据 $(2,2)$ 元素：$l_{21}^2 + l_{22}^2 = \\Delta t$。代入 $l_{21}$，我们得到 $(\\rho \\sqrt{\\Delta t})^2 + l_{22}^2 = \\Delta t$，化简为 $\\rho^2 \\Delta t + l_{22}^2 = \\Delta t$。解出 $l_{22}^2$ 得 $l_{22}^2 = \\Delta t (1 - \\rho^2)$。取正根，得到 $l_{22} = \\sqrt{\\Delta t(1 - \\rho^2)}$。\n\n因此，Cholesky 因子为：\n$$\nL = \\begin{pmatrix} \\sqrt{\\Delta t}  0 \\\\ \\rho \\sqrt{\\Delta t}  \\sqrt{\\Delta t(1 - \\rho^2)} \\end{pmatrix} = \\sqrt{\\Delta t} \\begin{pmatrix} 1  0 \\\\ \\rho  \\sqrt{1 - \\rho^2} \\end{pmatrix}\n$$\n对于问题中指定的 $\\rho \\in (-1, 1)$，该矩阵是良定的。\n\n每个测试用例 $(\\rho, \\Delta t, N, \\varepsilon, \\text{seed})$ 的模拟过程如下：\n1.  使用给定的 `seed` 初始化伪随机数生成器，以确保可复现性。\n2.  生成两个独立标准正态变量的 $N$ 个样本，$Z_1 = (Z_{1,1}, \\dots, Z_{1,N})^\\top$ 和 $Z_2 = (Z_{2,1}, \\dots, Z_{2,N})^\\top$。\n3.  对每对样本 $(Z_{1,i}, Z_{2,i})$ 应用变换 $\\Delta W = L Z$，以生成相关增量 $(\\Delta W_i^{(1)}, \\Delta W_i^{(2)})$：\n    $$\n    \\Delta W_i^{(1)} = \\sqrt{\\Delta t} \\, Z_{1,i}\n    $$\n    $$\n    \\Delta W_i^{(2)} = \\rho \\sqrt{\\Delta t} \\, Z_{1,i} + \\sqrt{\\Delta t(1 - \\rho^2)} \\, Z_{2,i}\n    $$\n4.  生成 $N$ 个 $(\\Delta W^{(1)}, \\Delta W^{(2)})$ 样本后，计算经验皮尔逊相关系数 $\\widehat{\\rho}$。对于两个大小为 $N$ 的样本集 $X = \\{x_i\\}$ 和 $Y = \\{y_i\\}$，$\\widehat{\\rho}$ 的计算公式为：\n    $$\n    \\widehat{\\rho} = \\frac{\\sum_{i=1}^N (x_i - \\bar{x})(y_i - \\bar{y})}{\\sqrt{\\sum_{i=1}^N (x_i - \\bar{x})^2} \\sqrt{\\sum_{i=1}^N (y_i - \\bar{y})^2}}\n    $$\n    其中 $\\bar{x}$ 和 $\\bar{y}$ 是样本均值。这与要求中提到的使用“零均值中心化”相符。\n5.  最后，判断经验相关性与目标相关性之间的绝对误差是否在指定容差范围内：$|\\widehat{\\rho} - \\rho| \\leq \\varepsilon$。结果是一个布尔值（`True` 或 `False`）。\n\n对所有测试用例重复此过程，并将布尔结果收集到一个列表中作为最终输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates correlated Brownian motion increments using Cholesky decomposition\n    and validates the empirical correlation against a tolerance.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (rho, dt, N, eps, seed)\n        (0.0, 0.05, 200000, 0.01, 1),\n        (0.5, 0.01, 200000, 0.01, 2),\n        (-0.7, 0.02, 250000, 0.01, 3),\n        (0.99, 0.01, 300000, 0.02, 4),\n    ]\n\n    results = []\n    for case in test_cases:\n        rho, dt, N, eps, seed = case\n\n        # Set the seed for the pseudorandom number generator for reproducibility.\n        rng = np.random.default_rng(seed)\n\n        # Generate N samples of two independent standard normal random variables.\n        # Z is a (2, N) array where Z[0,:] are the Z_1 samples and Z[1,:] are the Z_2 samples.\n        Z = rng.standard_normal(size=(2, N))\n        Z1 = Z[0]\n        Z2 = Z[1]\n\n        #\n        # Construct the correlated Brownian increments dW1 and dW2.\n        # The transformation is based on the Cholesky factor L of the covariance matrix:\n        # L = sqrt(dt) * [[1, 0], [rho, sqrt(1-rho^2)]]\n        # dW = L @ Z\n        # dW1 = sqrt(dt) * Z1\n        # dW2 = sqrt(dt) * (rho * Z1 + sqrt(1 - rho^2) * Z2)\n        #\n\n        sqrt_dt = np.sqrt(dt)\n        sqrt_1_minus_rho_sq = np.sqrt(1 - rho**2)\n\n        # Generate the N samples of correlated increments.\n        dW1 = sqrt_dt * Z1\n        dW2 = sqrt_dt * (rho * Z1 + sqrt_1_minus_rho_sq * Z2)\n\n        # Compute the empirical Pearson correlation coefficient between dW1 and dW2.\n        # np.corrcoef calculates the correlation matrix. We need the off-diagonal element.\n        # The standard formula for Pearson correlation involves centering the data by\n        # subtracting the sample mean, as specified by \"zero-mean centering\".\n        # np.corrcoef handles this correctly.\n        corr_matrix = np.corrcoef(dW1, dW2)\n        rho_hat = corr_matrix[0, 1]\n\n        # Check if the absolute error is within the given tolerance.\n        is_passed = np.abs(rho_hat - rho) = eps\n        results.append(is_passed)\n\n    # Format the final output string as a comma-separated list of booleans\n    # enclosed in square brackets. Python's str() on a boolean gives \"True\" or \"False\".\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```", "id": "3078440"}]}