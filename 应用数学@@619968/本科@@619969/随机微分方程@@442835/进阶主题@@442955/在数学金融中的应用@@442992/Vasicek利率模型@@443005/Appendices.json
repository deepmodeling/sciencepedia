{"hands_on_practices": [{"introduction": "让我们从一个最基本的问题开始：在平均意义上，利率会走向何方？这个练习将引导你求解Vasicek随机微分方程，以找出未来利率的期望路径 $E[r_t]$。这项实践对于从解析层面理解“均值回归”这一核心概念至关重要 [@problem_id:3082515]。", "problem": "考虑 Vasicek 模型中的短期利率过程，它由瞬时利率的线性随机微分方程 (SDE) 定义：\n$$\n\\mathrm{d}r_{t}=\\kappa\\left(\\theta-r_{t}\\right)\\mathrm{d}t+\\sigma\\,\\mathrm{d}W_{t},\n$$\n其中 $W_{t}$ 是一个标准布朗运动（维纳过程），$\\kappa > 0$、$\\theta \\in \\mathbb{R}$ 和 $\\sigma > 0$ 是常数。初始条件为 $r_{0}\\in\\mathbb{R}$。从这个 SDE 出发，并仅使用随机微积分的核心定义（例如伊藤积分的性质），推导期望 $E\\!\\left[r_{t}\\right]$ 作为 $t$、$\\kappa$、$\\theta$ 和 $r_{0}$ 的函数的显式表达式。然后，根据您得到的表达式，简要解释“期望上的均值回归”在该模型中意味着什么。您最终报告的答案必须是 $E\\!\\left[r_{t}\\right]$ 的一个单一闭式解析表达式；无需四舍五入。", "solution": "问题陈述经过严格验证，被认为是有效的。它具有科学依据、是适定的且客观的。它为随机微积分和量化金融中的一个标准问题，即推导 Vasicek 模型中定义的 Ornstein-Uhlenbeck 过程的期望值，提供了一个完整且一致的设定。所有必要的参数和条件都已提供，不存在矛盾或含糊之处。\n\n任务是推导由 Vasicek 模型随机微分方程 (SDE) 控制的短期利率过程 $r_t$ 的期望 $E[r_t]$：\n$$\n\\mathrm{d}r_{t}=\\kappa(\\theta-r_{t})\\mathrm{d}t+\\sigma\\,\\mathrm{d}W_{t}\n$$\n初始条件为 $r_0 \\in \\mathbb{R}$，常数 $\\kappa > 0$、$\\theta \\in \\mathbb{R}$ 和 $\\sigma > 0$。\n\n首先，我们求解 SDE 以得到 $r_t$。该 SDE 可以改写为：\n$$\n\\mathrm{d}r_{t} + \\kappa r_t \\mathrm{d}t = \\kappa\\theta \\mathrm{d}t+\\sigma\\,\\mathrm{d}W_{t}\n$$\n这是一个线性 SDE。我们可以使用积分因子来求解它，这与求解线性常微分方程的方法类似。令积分因子为 $I_t = \\exp(\\kappa t)$。考虑过程 $Y_t = r_t \\exp(\\kappa t)$。我们使用伊藤乘积法则来求其微分 $\\mathrm{d}Y_t$。对于一个函数 $f(t, x) = x \\exp(\\kappa t)$，其中 $x$ 是过程 $r_t$，其法则是：\n$$\n\\mathrm{d}f(t, r_t) = \\frac{\\partial f}{\\partial t}\\mathrm{d}t + \\frac{\\partial f}{\\partial r_t}\\mathrm{d}r_t + \\frac{1}{2}\\frac{\\partial^2 f}{\\partial r_t^2}(\\mathrm{d}r_t)^2\n$$\n偏导数是：\n$$\n\\frac{\\partial f}{\\partial t} = \\kappa r_t \\exp(\\kappa t)\n$$\n$$\n\\frac{\\partial f}{\\partial r_t} = \\exp(\\kappa t)\n$$\n$$\n\\frac{\\partial^2 f}{\\partial r_t^2} = 0\n$$\n二次变分 $(\\mathrm{d}r_t)^2$ 是根据 $r_t$ 的 SDE 计算的。只有扩散项有贡献：$(\\mathrm{d}r_t)^2 = (\\sigma \\mathrm{d}W_t)^2 = \\sigma^2 (\\mathrm{d}W_t)^2 = \\sigma^2 \\mathrm{d}t$。然而，由于关于 $r_t$ 的二阶偏导数为零，该项消失。\n将非零的偏导数代入伊藤法则，得到：\n$$\n\\mathrm{d}(r_t \\exp(\\kappa t)) = \\kappa r_t \\exp(\\kappa t) \\mathrm{d}t + \\exp(\\kappa t) \\mathrm{d}r_t\n$$\n现在，我们将原始 SDE 中 $\\mathrm{d}r_t$ 的表达式代入：\n$$\n\\mathrm{d}(r_t \\exp(\\kappa t)) = \\kappa r_t \\exp(\\kappa t) \\mathrm{d}t + \\exp(\\kappa t) \\left( \\kappa(\\theta-r_{t})\\mathrm{d}t+\\sigma\\,\\mathrm{d}W_{t} \\right)\n$$\n$$\n\\mathrm{d}(r_t \\exp(\\kappa t)) = \\kappa r_t \\exp(\\kappa t) \\mathrm{d}t + \\kappa\\theta\\exp(\\kappa t) \\mathrm{d}t - \\kappa r_t \\exp(\\kappa t) \\mathrm{d}t + \\sigma\\exp(\\kappa t)\\,\\mathrm{d}W_{t}\n$$\n包含 $r_t$ 的项相互抵消：\n$$\n\\mathrm{d}(r_t \\exp(\\kappa t)) = \\kappa\\theta\\exp(\\kappa t) \\mathrm{d}t + \\sigma\\exp(\\kappa t)\\,\\mathrm{d}W_{t}\n$$\n接下来，我们将这个表达式从时间 $s=0$ 积分到 $s=t$：\n$$\n\\int_0^t \\mathrm{d}(r_s \\exp(\\kappa s)) = \\int_0^t \\kappa\\theta\\exp(\\kappa s) \\mathrm{d}s + \\int_0^t \\sigma\\exp(\\kappa s)\\,\\mathrm{d}W_{s}\n$$\n左边计算结果为 $r_t \\exp(\\kappa t) - r_0 \\exp(\\kappa \\cdot 0)$。\n$$\nr_t \\exp(\\kappa t) - r_0 = \\kappa\\theta \\left[ \\frac{1}{\\kappa}\\exp(\\kappa s) \\right]_0^t + \\sigma \\int_0^t \\exp(\\kappa s)\\,\\mathrm{d}W_{s}\n$$\n$$\nr_t \\exp(\\kappa t) - r_0 = \\theta (\\exp(\\kappa t) - 1) + \\sigma \\int_0^t \\exp(\\kappa s)\\,\\mathrm{d}W_{s}\n$$\n现在，我们通过乘以 $\\exp(-\\kappa t)$ 来求解 $r_t$：\n$$\nr_t = r_0 \\exp(-\\kappa t) + \\theta (1 - \\exp(-\\kappa t)) + \\sigma \\exp(-\\kappa t) \\int_0^t \\exp(\\kappa s)\\,\\mathrm{d}W_{s}\n$$\n随机积分项可以改写成更标准的形式：\n$$\n\\sigma \\exp(-\\kappa t) \\int_0^t \\exp(\\kappa s)\\,\\mathrm{d}W_{s} = \\sigma \\int_0^t \\exp(-\\kappa(t-s))\\,\\mathrm{d}W_{s}\n$$\n所以，$r_t$ 的显式解是：\n$$\nr_t = r_0 \\exp(-\\kappa t) + \\theta (1 - \\exp(-\\kappa t)) + \\sigma \\int_0^t \\exp(-\\kappa(t-s))\\,\\mathrm{d}W_{s}\n$$\n现在，我们取 $E[r_t]$ 的期望。我们将期望算子应用于 $r_t$ 的解，并利用期望的线性性质：\n$$\nE[r_t] = E\\left[ r_0 \\exp(-\\kappa t) + \\theta (1 - \\exp(-\\kappa t)) + \\sigma \\int_0^t \\exp(-\\kappa(t-s))\\,\\mathrm{d}W_{s} \\right]\n$$\n$$\nE[r_t] = E[r_0 \\exp(-\\kappa t)] + E[\\theta (1 - \\exp(-\\kappa t))] + E\\left[\\sigma \\int_0^t \\exp(-\\kappa(t-s))\\,\\mathrm{d}W_{s} \\right]\n$$\n我们逐项计算：\n1. 初始条件 $r_0$ 是确定性的（或者，如果是随机的，它与 $W_t$ 的未来增量无关）。$\\exp(-\\kappa t)$ 项也是确定性的。因此，$E[r_0 \\exp(-\\kappa t)] = r_0 \\exp(-\\kappa t)$。\n2. 参数 $\\theta$ 和 $\\kappa$ 是常数，所以 $\\theta (1 - \\exp(-\\kappa t))$ 项是确定性的。因此，$E[\\theta (1 - \\exp(-\\kappa t))] = \\theta (1 - \\exp(-\\kappa t))$。\n3. 第三项是伊藤积分的期望。对于具有确定性被积函数 $f(s)$（例如 $f(s) = \\exp(-\\kappa(t-s))$）的伊藤积分，其一个基本性质是期望为零：\n$$\nE\\left[ \\int_0^t f(s)\\,\\mathrm{d}W_{s} \\right] = 0\n$$\n因此，\n$$\nE\\left[\\sigma \\int_0^t \\exp(-\\kappa(t-s))\\,\\mathrm{d}W_{s} \\right] = \\sigma \\cdot 0 = 0\n$$\n综合这些结果，我们得到 $r_t$ 期望的表达式：\n$$\nE[r_t] = r_0 \\exp(-\\kappa t) + \\theta (1 - \\exp(-\\kappa t))\n$$\n这个表达式可以重新整理以便更好地解释：\n$$\nE[r_t] = r_0 \\exp(-\\kappa t) + \\theta - \\theta \\exp(-\\kappa t) = \\theta + (r_0 - \\theta)\\exp(-\\kappa t)\n$$\n这就是 $E[r_t]$ 的最终闭式表达式。\n\n“期望上的均值回归”的解释源于这个结果。随着时间 $t$ 趋向于无穷大（$t \\to \\infty$），由于参数 $\\kappa$ 严格为正（$\\kappa > 0$），指数项 $\\exp(-\\kappa t)$ 趋向于 0。\n$$\n\\lim_{t \\to \\infty} E[r_t] = \\lim_{t \\to \\infty} \\left( \\theta + (r_0 - \\theta)\\exp(-\\kappa t) \\right) = \\theta + (r_0 - \\theta) \\cdot 0 = \\theta\n$$\n这表明短期利率的期望值 $E[r_t]$ 会从其初始值 $r_0$ 指数级地衰减或增长，趋向于长期均值水平 $\\theta$。如果 $r_0 > \\theta$，期望利率将随时间推移向 $\\theta$ 下降。如果 $r_0  \\theta$，它将向 $\\theta$ 上升。参数 $\\kappa$ 决定了这种回归的速度。过程的期望未来路径被拉向一个恒定水平的这种趋势，就是期望上的均值回归的含义。", "answer": "$$\\boxed{\\theta + (r_{0} - \\theta)\\exp(-\\kappa t)}$$", "id": "3082515"}, {"introduction": "仅仅知道平均路径是不够的，我们还需要理解其周围的不确定性。这个练习将指导你计算利率的方差 $\\mathrm{Var}(r_t)$，并在此过程中引入强大的伊藤等距定理。掌握这项技能将使你能够量化在Vasicek模型下与利率波动相关的风险 [@problem_id:3082422]。", "problem": "考虑 Vasicek 短期利率模型，其中瞬时利率 $r_{t}$ 根据以下线性随机微分方程 (SDE) 演化\n$$\n\\mathrm{d}r_{t} = \\kappa\\left(\\theta - r_{t}\\right)\\,\\mathrm{d}t + \\sigma\\,\\mathrm{d}W_{t}, \\quad r_{0} \\in \\mathbb{R} \\text{ 给定},\n$$\n其中 $\\kappa > 0$, $\\theta \\in \\mathbb{R}$ 和 $\\sigma > 0$ 是常数，$\\left(W_{t}\\right)_{t \\geq 0}$ 是在满足通常条件的有滤概率空间上的标准维纳过程（布朗运动）。\n\n仅从线性 SDE 的定义和伊藤乘积法则出发，推导 $r_{t}$ 关于 $r_{0}$ 和一个随机积分的显式表达式。然后，从伊藤积分的基本原理出发，证明随机积分\n$$\nI_{t} \\equiv \\int_{0}^{t} \\exp\\!\\big(-\\kappa\\,(t-s)\\big)\\,\\mathrm{d}W_{s}\n$$\n是均值为 $0$、方差为 $\\frac{1 - \\exp(-2\\kappa t)}{2\\kappa}$ 的高斯分布。利用此结果计算 $r_{t}$ 在给定 $r_{0}$ 条件下的方差，并将其表示为关于 $\\kappa$、$\\sigma$ 和 $t$ 的单个闭式解析表达式。\n\n你的最终答案应该是 $\\mathrm{Var}(r_{t}\\,|\\,r_{0})$ 的单个解析表达式。不需要数值近似。", "solution": "用户提供了一个关于 Vasicek 短期利率模型的问题。\n\n### 第一步：提取已知条件\n- 瞬时利率 $r_{t}$ 的随机微分方程 (SDE) 为 $\\mathrm{d}r_{t} = \\kappa\\left(\\theta - r_{t}\\right)\\,\\mathrm{d}t + \\sigma\\,\\mathrm{d}W_{t}$。\n- 初始条件为 $r_{0} \\in \\mathbb{R}$，给定。\n- 参数为常数：$\\kappa > 0$, $\\theta \\in \\mathbb{R}$ 和 $\\sigma > 0$。\n- $\\left(W_{t}\\right)_{t \\geq 0}$ 是一个标准维纳过程。\n- 需要分析的随机积分是 $I_{t} \\equiv \\int_{0}^{t} \\exp\\!\\big(-\\kappa\\,(t-s)\\big)\\,\\mathrm{d}W_{s}$。\n- 任务是：\n    1. 推导 $r_{t}$ 的显式表达式。\n    2. 证明随机积分 $I_{t}$（使用 SDE 中的参数）是均值为 $0$、方差为 $\\frac{1 - \\exp(-2\\kappa t)}{2\\kappa}$ 的高斯分布。\n    3. 计算 $\\mathrm{Var}(r_{t}\\,|\\,r_{0})$ 并表示为单个闭式解析表达式。\n\n### 第二步：使用提取的已知条件进行验证\n该问题具有科学依据，是随机微分方程理论应用于数学金融的一个标准且基础的练习。Vasicek 模型是 Ornstein-Uhlenbeck 过程的一个典型例子。该问题是适定的、客观的且自洽的，为解决问题提供了所有必要的信息。存在一个微小的记号不一致，即 SDE 使用参数 $\\kappa$，而积分 $I_t$ 的定义使用 $k$。然而，问题的结构要求推导 $r_t$ 的显式解，这本身会产生一个随机积分项。该推导项的形式决定了为使问题内部一致，$k$ 必须与 $\\kappa$ 等同。这一澄清不构成对模糊陈述的重新解释，而是解决了微不足道的印刷错误，因此不会使问题无效。因此，该问题是有效的。\n\n### 第三步：结论与行动\n问题有效。将提供一个完整的、有理有据的解答。\n\n### 推导\nVasicek 模型的 SDE 由下式给出：\n$$\n\\mathrm{d}r_{t} = \\kappa\\left(\\theta - r_{t}\\right)\\,\\mathrm{d}t + \\sigma\\,\\mathrm{d}W_{t}\n$$\n这是一个线性 SDE。我们可以将包含 $r_{t}$ 的项移到一边：\n$$\n\\mathrm{d}r_{t} + \\kappa r_{t}\\,\\mathrm{d}t = \\kappa\\theta\\,\\mathrm{d}t + \\sigma\\,\\mathrm{d}W_{t}\n$$\n为了解这个方程，我们使用积分因子法，这是解线性常微分方程的常用技巧，也可以推广到线性 SDE。我们定义一个确定性函数 $f(t) = \\exp(\\kappa t)$。我们考虑过程 $Y_{t} = f(t)r_{t} = \\exp(\\kappa t)r_{t}$。\n\n我们应用伊藤乘积法则来求微分 $\\mathrm{d}Y_{t}$：\n$$\n\\mathrm{d}Y_{t} = \\mathrm{d}(\\exp(\\kappa t)r_{t}) = r_{t}\\,\\mathrm{d}(\\exp(\\kappa t)) + \\exp(\\kappa t)\\,\\mathrm{d}r_{t} + \\mathrm{d}\\langle \\exp(\\kappa t), r_t \\rangle_t\n$$\n由于 $\\exp(\\kappa t)$ 是一个时间的确定性函数，其微分为 $\\mathrm{d}(\\exp(\\kappa t)) = \\kappa\\exp(\\kappa t)\\,\\mathrm{d}t$，且二次协变项 $\\mathrm{d}\\langle \\exp(\\kappa t), r_t \\rangle_t$ 为零，因为 $\\mathrm{d}(\\exp(\\kappa t))$ 没有 $\\mathrm{d}W_t$ 分量。\n因此，乘积法则简化为：\n$$\n\\mathrm{d}Y_{t} = r_{t}(\\kappa\\exp(\\kappa t)\\,\\mathrm{d}t) + \\exp(\\kappa t)\\,\\mathrm{d}r_{t} = \\exp(\\kappa t)(\\kappa r_{t}\\,\\mathrm{d}t + \\mathrm{d}r_{t})\n$$\n将表达式 $\\mathrm{d}r_{t} + \\kappa r_{t}\\,\\mathrm{d}t = \\kappa\\theta\\,\\mathrm{d}t + \\sigma\\,\\mathrm{d}W_{t}$ 代入 $\\mathrm{d}Y_{t}$ 的方程中：\n$$\n\\mathrm{d}(\\exp(\\kappa t)r_{t}) = \\exp(\\kappa t)(\\kappa\\theta\\,\\mathrm{d}t + \\sigma\\,\\mathrm{d}W_{t}) = \\kappa\\theta\\exp(\\kappa t)\\,\\mathrm{d}t + \\sigma\\exp(\\kappa t)\\,\\mathrm{d}W_{t}\n$$\n现在，我们对两边从时间 $s=0$ 到 $s=t$ 进行积分：\n$$\n\\int_{0}^{t} \\mathrm{d}(\\exp(\\kappa s)r_{s}) = \\int_{0}^{t} \\kappa\\theta\\exp(\\kappa s)\\,\\mathrm{d}s + \\int_{0}^{t} \\sigma\\exp(\\kappa s)\\,\\mathrm{d}W_{s}\n$$\n左边计算结果为 $\\exp(\\kappa t)r_{t} - \\exp(\\kappa \\cdot 0)r_{0}$。右边包含一个标准黎曼积分和一个伊藤随机积分。\n$$\n\\exp(\\kappa t)r_{t} - r_{0} = \\kappa\\theta \\left[\\frac{\\exp(\\kappa s)}{\\kappa}\\right]_{0}^{t} + \\sigma\\int_{0}^{t}\\exp(\\kappa s)\\,\\mathrm{d}W_{s}\n$$\n$$\n\\exp(\\kappa t)r_{t} - r_{0} = \\theta(\\exp(\\kappa t) - 1) + \\sigma\\int_{0}^{t}\\exp(\\kappa s)\\,\\mathrm{d}W_{s}\n$$\n为了得到 $r_{t}$ 的显式表达式，我们将整个方程乘以 $\\exp(-\\kappa t)$：\n$$\nr_{t} = r_{0}\\exp(-\\kappa t) + \\theta(1 - \\exp(-\\kappa t)) + \\sigma\\exp(-\\kappa t)\\int_{0}^{t}\\exp(\\kappa s)\\,\\mathrm{d}W_{s}\n$$\n随机积分项可以写作：\n$$\n\\sigma\\int_{0}^{t}\\exp(-\\kappa t)\\exp(\\kappa s)\\,\\mathrm{d}W_{s} = \\sigma\\int_{0}^{t}\\exp(-\\kappa(t-s))\\,\\mathrm{d}W_{s}\n$$\n这导出了 $r_{t}$ 的最终显式表达式：\n$$\nr_{t} = r_{0}\\exp(-\\kappa t) + \\theta(1 - \\exp(-\\kappa t)) + \\sigma\\int_{0}^{t}\\exp(-\\kappa(t-s))\\,\\mathrm{d}W_{s}\n$$\n问题定义了 $I_{t} \\equiv \\int_{0}^{t} \\exp(-k(t-s))\\,\\mathrm{d}W_{s}$。正如验证阶段所确定的，我们将 $k$ 等同于 $\\kappa$。所以，$r_{t} = r_{0}\\exp(-\\kappa t) + \\theta(1 - \\exp(-\\kappa t)) + \\sigma I_{t}$。\n\n接下来，我们分析随机积分 $I_{t} = \\int_{0}^{t}\\exp(-\\kappa(t-s))\\,\\mathrm{d}W_{s}$ 的性质。被积函数 $g(s;t) = \\exp(-\\kappa(t-s))$ 对于固定的 $t$ 是一个确定性函数。一个确定性函数关于维纳过程的伊藤积分被称为维纳积分。维纳积分的一个关键性质是它们是高斯随机变量。\n\n$I_{t}$ 的均值由该积分的期望给出：\n$$\n\\mathbb{E}[I_{t}] = \\mathbb{E}\\left[\\int_{0}^{t}\\exp(-\\kappa(t-s))\\,\\mathrm{d}W_{s}\\right]\n$$\n伊藤积分的一个基本性质是其期望为零：\n$$\n\\mathbb{E}[I_{t}] = 0\n$$\n$I_{t}$ 的方差是 $\\mathrm{Var}(I_{t}) = \\mathbb{E}[(I_{t} - \\mathbb{E}[I_{t}])^2] = \\mathbb{E}[I_{t}^2]$。我们使用伊藤等距性质，该性质指出对于一个确定性的平方可积函数 $g(s)$：\n$$\n\\mathbb{E}\\left[\\left(\\int_{0}^{t}g(s)\\,\\mathrm{d}W_{s}\\right)^2\\right] = \\mathbb{E}\\left[\\int_{0}^{t}g(s)^2\\,\\mathrm{d}s\\right] = \\int_{0}^{t}g(s)^2\\,\\mathrm{d}s\n$$\n将此应用于 $I_t$，其中 $g(s;t) = \\exp(-\\kappa(t-s))$：\n$$\n\\mathrm{Var}(I_{t}) = \\int_{0}^{t} \\left(\\exp(-\\kappa(t-s))\\right)^2\\,\\mathrm{d}s = \\int_{0}^{t} \\exp(-2\\kappa(t-s))\\,\\mathrm{d}s\n$$\n我们可以计算这个积分：\n$$\n\\mathrm{Var}(I_{t}) = \\exp(-2\\kappa t) \\int_{0}^{t} \\exp(2\\kappa s)\\,\\mathrm{d}s = \\exp(-2\\kappa t) \\left[\\frac{\\exp(2\\kappa s)}{2\\kappa}\\right]_{0}^{t}\n$$\n$$\n\\mathrm{Var}(I_{t}) = \\exp(-2\\kappa t) \\left(\\frac{\\exp(2\\kappa t) - \\exp(0)}{2\\kappa}\\right) = \\exp(-2\\kappa t) \\left(\\frac{\\exp(2\\kappa t) - 1}{2\\kappa}\\right)\n$$\n$$\n\\mathrm{Var}(I_{t}) = \\frac{1 - \\exp(-2\\kappa t)}{2\\kappa}\n$$\n这证实了 $I_t$ 是一个均值为 $0$、方差为 $\\frac{1 - \\exp(-2\\kappa t)}{2\\kappa}$ 的高斯随机变量，符合要求。\n\n最后，我们计算 $r_{t}$ 在给定 $r_{0}$ 条件下的方差，记作 $\\mathrm{Var}(r_{t}\\,|\\,r_{0})$。在这种情况下，$r_0$ 被视为一个给定的常数。$r_{t}$ 的表达式为：\n$$\nr_{t} = r_{0}\\exp(-\\kappa t) + \\theta(1 - \\exp(-\\kappa t)) + \\sigma I_{t}\n$$\n前两项 $r_{0}\\exp(-\\kappa t)$ 和 $\\theta(1 - \\exp(-\\kappa t))$，从时刻 $t$ 的随机性（给定时刻 $0$ 的信息）来看是确定性常数。唯一的随机性来源是随机项 $\\sigma I_{t}$。\n对于任意随机变量 $X$ 和常数 $c$，有 $\\mathrm{Var}(X+c) = \\mathrm{Var}(X)$。因此：\n$$\n\\mathrm{Var}(r_{t}\\,|\\,r_{0}) = \\mathrm{Var}\\left(r_{0}\\exp(-\\kappa t) + \\theta(1 - \\exp(-\\kappa t)) + \\sigma I_{t} \\right) = \\mathrm{Var}(\\sigma I_{t})\n$$\n使用性质 $\\mathrm{Var}(aX) = a^2\\mathrm{Var}(X)$（其中 $a$ 为常数）：\n$$\n\\mathrm{Var}(\\sigma I_{t}) = \\sigma^2 \\mathrm{Var}(I_{t})\n$$\n代入之前推导出的 $I_{t}$ 的方差：\n$$\n\\mathrm{Var}(r_{t}\\,|\\,r_{0}) = \\sigma^2 \\left(\\frac{1 - \\exp(-2\\kappa t)}{2\\kappa}\\right)\n$$\n这就是 $r_t$ 条件方差的最终闭式解析表达式。", "answer": "$$\\boxed{\\frac{\\sigma^2}{2\\kappa}\\left(1 - \\exp(-2\\kappa t)\\right)}$$", "id": "3082422"}, {"introduction": "现在，让我们从理论走向实践，进入Vasicek模型的主要应用领域：债券定价。本练习涉及用数值方法求解一个关键的微分方程，该方程决定了债券对利率的敏感度。通过实现一个标准的数值方法并将其与精确解进行比较，你将获得计算金融方面的动手经验 [@problem_id:3082370]。", "problem": "考虑由以下随机微分方程（SDE）在风险中性测度下给出的 Vasicek 短期利率模型：\n$$\ndr_t = \\kappa(\\theta - r_t)\\,dt + \\sigma\\,dW_t,\n$$\n其中 $\\kappa \\geq 0$、$\\theta$ 和 $\\sigma$ 是常数，而 $W_t$ 是一个标准维纳过程。在此模型中，到期日为 $T$ 的零息债券在时间 $t$ 的价格具有仿射形式\n$$\nP(t,T) = \\exp(A(t,T) - B(t,T)r_t),\n$$\n其中 $A(t,T)$ 和 $B(t,T)$ 仅依赖于 $t$ 和 $T$。定义距离到期时间 $\\tau := T - t$。当将该仿射形式代入债券定价偏微分方程（PDE）并比较系数时，函数 $B(t,T)$ 被刻画为关于 $\\tau$ 的一个线性初值问题的解：\n$$\n\\frac{dB}{d\\tau}(\\tau) = 1 - \\kappa\\,B(\\tau), \\quad B(0) = 0.\n$$\n\n任务：\n- 编写一个程序，对于给定的 $(\\kappa,\\tau)$ 对，使用四阶 Runge–Kutta 方法求解上述常微分方程（ODE），从而数值近似 $B(\\tau)$。\n- 对于每个测试用例，同时计算此 ODE 的精确解析解，并报告数值解与精确值之间的绝对误差。您必须通过对精确解取适当的极限来正确处理 $\\kappa = 0$ 的情况。\n- 您的实现必须是确定性的，并使用双精度浮点运算。\n\n测试用例：\n使用以下参数值（每对为 $(\\kappa,\\tau)$，其中 $\\tau = T - t$）：\n- $(0.3,\\,2.0)$\n- $(0.0,\\,1.0)$\n- $(10.0,\\,3.0)$\n- $(1.2,\\,1.0)$\n- $(10^{-6},\\,5.0)$\n- $(0.7,\\,0.0)$\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含测试用例的绝对误差，顺序与列表一致，形式为方括号括起来的逗号分隔列表，例如 $[e_1,e_2,\\dots,e_6]$，其中每个 $e_i$ 是一个浮点数。", "solution": "我们从风险中性的 Vasicek 模型开始，其中短期利率 $r_t$ 服从以下随机微分方程（SDE）：\n$$\ndr_t = \\kappa(\\theta - r_t)\\,dt + \\sigma\\,dW_t.\n$$\n到期日为 $T$ 的零息债券在时间 $t$ 的价格为 $P(t,T) = \\mathbb{E}^{\\mathbb{Q}}\\!\\left[\\exp\\!\\left(-\\int_t^T r_s\\,ds\\right)\\middle|\\,\\mathcal{F}_t\\right]$，在 Vasicek 模型下，可以假设一个仿射形式 $P(t,T) = \\exp(A(t,T) - B(t,T) r_t)$。将此形式代入债券定价偏微分方程（PDE），并令 $r_t$ 的系数相等，当用距离到期时间 $\\tau := T-t$ 表示时，可以得到关于 $B(t,T)$ 的常微分方程（ODE）：\n$$\n\\frac{dB}{d\\tau}(\\tau) = 1 - \\kappa\\,B(\\tau), \\quad B(0) = 0.\n$$\n这是一个一阶线性 ODE。其通解可以通过积分因子法求得。定义积分因子 $I(\\tau) = e^{\\kappa \\tau}$。两边同乘以 $I(\\tau)$ 可得\n$$\ne^{\\kappa \\tau}\\frac{dB}{d\\tau}(\\tau) + \\kappa e^{\\kappa \\tau} B(\\tau) = e^{\\kappa \\tau}.\n$$\n左边是 $e^{\\kappa \\tau} B(\\tau)$ 的导数：\n$$\n\\frac{d}{d\\tau}\\left(e^{\\kappa \\tau} B(\\tau)\\right) = e^{\\kappa \\tau}.\n$$\n从 $0$ 积分到 $\\tau$ 并利用 $B(0)=0$ 可得\n$$\ne^{\\kappa \\tau} B(\\tau) - e^{\\kappa \\cdot 0} B(0) = \\int_0^\\tau e^{\\kappa s}\\,ds = \\frac{e^{\\kappa \\tau} - 1}{\\kappa} \\quad \\text{对于 } \\kappa \\ne 0.\n$$\n因此，对于 $\\kappa \\ne 0$，\n$$\nB(\\tau) = \\frac{1 - e^{-\\kappa \\tau}}{\\kappa}.\n$$\n对于边界情况 $\\kappa = 0$，该 ODE 简化为 $\\frac{dB}{d\\tau}(\\tau) = 1$，且 $B(0)=0$，得出\n$$\nB(\\tau) = \\tau.\n$$\n\n为了验证数值方法，我们使用四阶 Runge–Kutta 方法（也称为四阶龙格－库塔法）计算数值近似解 $B_{\\text{num}}(\\tau)$。对于 ODE\n$$\n\\frac{dB}{d\\tau} = f(B) = 1 - \\kappa B,\n$$\n在初值条件 $B(0)=0$ 下，选择步长 $h$ 和步数 $N = \\lceil \\tau / h \\rceil$ （如果 $\\tau=0$，则 $N=0$）。从 $B_n$ 到 $B_{n+1}$ 的单步 Runge–Kutta 更新公式为\n$$\n\\begin{aligned}\nk_1 = f(B_n), \\\\\nk_2 = f\\!\\left(B_n + \\frac{h}{2} k_1\\right), \\\\\nk_3 = f\\!\\left(B_n + \\frac{h}{2} k_2\\right), \\\\\nk_4 = f\\!\\left(B_n + h\\,k_3\\right), \\\\\nB_{n+1} = B_n + \\frac{h}{6}\\left(k_1 + 2k_2 + 2k_3 + k_4\\right).\n\\end{aligned}\n$$\n初始化 $B_0 = 0$，如果 $\\tau > 0$，则以步长 $h = \\tau / N$ 迭代 $N$ 步；否则直接返回 $B(0)=0$。该方法的局部截断误差为 $O(h^5)$ 阶，全局误差为 $O(h^4)$ 阶，因此选择足够小的 $h$ 可以得到高精度的近似值。\n\n为了在计算精确解时保证数值稳定性，特别是当 $\\kappa \\tau$ 很小以至于 $1 - e^{-\\kappa \\tau}$ 遭受相消误差时，按如下方式计算精确值：\n$$\nB_{\\text{exact}}(\\kappa,\\tau) =\n\\begin{cases}\n\\tau,  \\text{如果 } |\\kappa| \\text{ 数值上为零},\\\\\n\\dfrac{1 - e^{-\\kappa \\tau}}{\\kappa},  \\text{其他情况},\n\\end{cases}\n$$\n并通过函数 $\\operatorname{expm1}$ 实现分子，以精确计算 $e^{x} - 1$：\n$$\n\\frac{1 - e^{-\\kappa \\tau}}{\\kappa} = \\frac{-\\operatorname{expm1}(-\\kappa \\tau)}{\\kappa}.\n$$\n\n对于每个测试用例 $(\\kappa,\\tau)$，计算绝对误差\n$$\ne = \\left| B_{\\text{num}}(\\tau) - B_{\\text{exact}}(\\kappa,\\tau) \\right|,\n$$\n并按顺序输出六个指定测试用例的列表 $[e_1,e_2,\\dots]$。当步长足够小（例如，$h = 10^{-4}$，使得 $N \\approx \\tau / 10^{-4}$），绝对误差将非常小，对于这个线性 ODE（包括边界情况 $\\kappa = 0$ 和 $\\tau = 0$），通常会接近机器精度。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef rk4_vasicek_B(kappa: float, tau: float, h_max: float = 1e-4) -> float:\n    \"\"\"\n    Numerically solve dB/dtau = 1 - kappa * B, B(0) = 0, up to tau using RK4.\n    Handles tau=0. The number of steps N is chosen such that the step size h=tau/N is at most h_max.\n    \"\"\"\n    if tau == 0.0:\n        return 0.0\n    # Determine number of steps to keep h = h_max, at least 1 step if tau > 0\n    N = max(1, int(np.ceil(tau / h_max)))\n    h = tau / N\n    B = 0.0\n\n    def f(Bval: float) - float:\n        return 1.0 - kappa * Bval\n\n    for _ in range(N):\n        k1 = f(B)\n        k2 = f(B + 0.5 * h * k1)\n        k3 = f(B + 0.5 * h * k2)\n        k4 = f(B + h * k3)\n        B += (h / 6.0) * (k1 + 2.0 * k2 + 2.0 * k3 + k4)\n    return B\n\ndef exact_B(kappa: float, tau: float) - float:\n    \"\"\"\n    Exact solution for B given kappa and tau, with a stable evaluation.\n    \"\"\"\n    if tau == 0.0:\n        return 0.0\n    if abs(kappa)  1e-14:\n        # Limit kappa -> 0 gives B = tau\n        return float(tau)\n    # Use expm1 for numerical stability\n    return float(-np.expm1(-kappa * tau) / kappa)\n\ndef solve():\n    # Define the test cases from the problem statement: (kappa, tau)\n    test_cases = [\n        (0.3, 2.0),\n        (0.0, 1.0),\n        (10.0, 3.0),\n        (1.2, 1.0),\n        (1e-6, 5.0),\n        (0.7, 0.0),\n    ]\n\n    results = []\n    for kappa, tau in test_cases:\n        B_num = rk4_vasicek_B(kappa, tau, h_max=1e-4)\n        B_ex = exact_B(kappa, tau)\n        err = abs(B_num - B_ex)\n        results.append(err)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3082370"}]}