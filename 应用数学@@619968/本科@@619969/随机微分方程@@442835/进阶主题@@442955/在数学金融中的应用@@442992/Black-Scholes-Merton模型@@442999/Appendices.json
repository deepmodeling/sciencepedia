{"hands_on_practices": [{"introduction": "现代金融学的核心是无套利原则，即在有效市场中不应存在无风险的利润。看涨-看跌期权平价关系是这一原则的完美体现，它将欧式看涨期权和看跌期权的价格联系在一起。本练习 [@problem_id:3079682] 让你扮演一名交易员：当市场价格违反这一基本平价关系时，你将设计一个静态投资组合来锁定一个有保证的无风险利润，从而加深你对套利机制的理解。", "problem": "考虑一支不支付股息的股票，其当前价格为 $S_{0} = 105$。在 Black-Scholes-Merton (BSM) 模型的标准假设下——无摩擦市场、连续交易、无套利、能够卖空以及恒定的连续复利无风险利率——假设无风险利率为每年 $r = 0.03$，到期时间为 $T = 1$ 年。对于相同的执行价格 $K = 100$ 和到期时间 $T$，您在时间 $0$ 观察到以下欧式期权价格：看涨期权价格为 $C_{0} = 12.50$，看跌期权价格为 $P_{0} = 3.00$。\n\n从无套利和复制的第一性原理出发，构建一个静态、自融资的套利策略，该策略使用股票、看涨期权、看跌期权和无风险银行账户，利用这些工具之间基本复制关系的任何违规行为。明确指出时间 $0$ 的交易。假设在时间 $0$ 收到的任何净现金都投资于无风险银行账户直到时间 $T$，而在时间 $0$ 支付的任何净现金都通过从无风险银行账户借款来融资直到时间 $T$。\n\n计算您的策略在时间 $T$ 实现的保证利润，并以美元表示您的最终答案。将您的答案四舍五入到四位有效数字。", "solution": "该问题要求基于看跌-看涨期权平价关系可能存在的违规，构建一个静态套利策略，并计算到期时的保证利润。分析从无套利和复制的第一性原理出发。\n\n对于不支付股息股票的欧式期权，基本的看跌-看涨期权平价关系是通过构建两个在到期日 $T$ 具有相同收益的投资组合来推导的。在无套利假设下，这些投资组合在时间 $t=0$ 必须具有相同的价格。该关系由下式给出：\n$$C_{0} + K e^{-rT} = P_{0} + S_{0}$$\n其中 $C_0$ 是时间 $0$ 的看涨期权价格，$P_0$ 是时间 $0$ 的看跌期权价格，$S_0$ 是时间 $0$ 的股票价格，$K$ 是执行价格，$r$ 是连续复利无风险利率，$T$ 是到期时间。\n\n左侧，$C_{0} + K e^{-rT}$，代表一个投资组合的成本，该组合包括一份看涨期权多头和一笔等于 $K e^{-rT}$ 的现金，该现金按无风险利率投资（即，一份面值为 $K$ 的零息债券多头）。右侧，$P_{0} + S_{0}$，代表一个投资组合的成本，该组合包括一份看跌期权多头和一股股票多头。在到期日 $T$，两个投资组合都有一个保证收益 $\\max(S_T, K)$，其中 $S_T$ 是时间 $T$ 的股票价格。\n\n首先，我们必须验证给定的市场价格是否违反了此平价关系。给定的数据是：\n- 股票价格：$S_{0} = 105$\n- 执行价格：$K = 100$\n- 无风险利率：$r = 0.03$\n- 到期时间：$T = 1$\n- 看涨期权价格：$C_{0} = 12.50$\n- 看跌期权价格：$P_{0} = 3.00$\n\n让我们计算平价方程两侧的值。\n左侧 (LHS) 的值：\n$$LHS = C_{0} + K e^{-rT} = 12.50 + 100 \\times \\exp(-0.03 \\times 1)$$\n$$LHS = 12.50 + 100 \\times \\exp(-0.03) \\approx 12.50 + 100 \\times 0.97044553 = 12.50 + 97.044553 = 109.544553$$\n\n右侧 (RHS) 的值：\n$$RHS = P_{0} + S_{0} = 3.00 + 105 = 108.00$$\n\n比较两侧，我们发现 $109.544553 > 108.00$。因此，看跌-看涨期权平价关系被违反：\n$$C_{0} + K e^{-rT}  P_{0} + S_{0}$$\n这个不等式意味着存在套利机会。由看涨期权和无风险债券组成的投资组合相对于由看跌期权和股票组成的投资组合被高估了。\n\n套利策略是卖出被高估的投资组合并买入被低估的投资组合。然而，一个更清晰的构建方法是创建一个合成的无风险资产。考虑在时间 $t=0$ 构建一个投资组合，包括一份看跌期权多头、一股股票多头和一份看涨期权空头。\n在时间 $t=0$ 建立此投资组合的成本是：\n$$\\text{Cost}_{0} = P_{0} + S_{0} - C_{0} = 3.00 + 105.00 - 12.50 = 95.50$$\n此投资组合在到期日 $T$ 的收益是：\n$$\\text{Payoff}_{T} = (\\text{来自看跌期权的收益}) + (\\text{来自股票的收益}) - (\\text{来自看涨期权的收益})$$\n$$\\text{Payoff}_{T} = \\max(K - S_{T}, 0) + S_{T} - \\max(S_{T} - K, 0)$$\n我们分析此收益在到期时的两种可能情况：\n1. 如果 $S_{T}  K$：收益$_{T} = 0 + S_{T} - (S_{T} - K) = K = 100$。\n2. 如果 $S_{T} \\leq K$：收益$_{T} = (K - S_{T}) + S_{T} - 0 = K = 100$。\n该投资组合在时间 $T$ 有一个确定的、无风险的收益 $K = 100$。它是一个面值为 $K$ 的合成零息债券。\n\n这样一张债券在时间 $t=0$ 的公允价格应为其贴现后的未来价值，即 $K e^{-rT} = 100 \\times \\exp(-0.03) \\approx 97.044553$。\n创建此合成债券的市场价格为 $\\text{Cost}_{0} = 95.50$。由于市场价格 ($95.50$) 低于公允价值 ($\\approx 97.05$)，该合成债券被低估了。\n\n套利策略是买入被低估的合成债券，并通过卖出（做空）其公允定价的等价物来融资，即按无风险利率借款。\n\n在时间 $t=0$ 的明确交易如下：\n1.  **买入一份欧式看跌期权**：现金流出 $P_{0} = 3.00$。\n2.  **买入一股股票**：现金流出 $S_{0} = 105.00$。\n3.  **卖出（开立）一份欧式看涨期权**：现金流入 $C_{0} = 12.50$。\n这组交易需要净现金支付 $3.00 + 105.00 - 12.50 = 95.50$。\n4.  **通过借款为此支付融资**：从无风险银行账户借入金额 $95.50$。这是一笔 $95.50$ 的现金流入。\n\n在时间 $t=0$ 的总净现金流为 $0$，因此该策略是自融资的。\n\n在到期日 $T=1$，头寸被平仓：\n1.  该投资组合（看跌期权多头、股票多头、看涨期权空头）产生保证的现金流入 $K = 100.00$。\n2.  借入的金额 $95.50$ 必须连本带息偿还。偿还金额为 $95.50 \\times e^{rT} = 95.50 \\times \\exp(0.03 \\times 1)$。\n\n在时间 $T$ 的保证套利利润是资产组合的现金流入与贷款偿还的现金流出之间的差额。\n$$\\text{利润}_{T} = K - (P_{0} + S_{0} - C_{0}) e^{rT}$$\n$$\\text{利润}_{T} = 100 - (95.50) \\times \\exp(0.03)$$\n使用计算器计算数值：\n$$\\exp(0.03) \\approx 1.03045453$$\n$$\\text{贷款偿还额} \\approx 95.50 \\times 1.03045453 \\approx 98.408408$$\n$$\\text{利润}_{T} \\approx 100 - 98.408408 = 1.591592$$\n\n问题要求将最终答案四舍五入到四位有效数字。\n$$\\text{利润}_{T} \\approx 1.592$$\n该数值代表了通过利用期权市场的错误定价在到期时保证获得的无风险利润。", "answer": "$$\\boxed{1.592}$$", "id": "3079682"}, {"introduction": "从理论到应用，检验理解程度的真正标准通常是动手实现。在量化金融领域，理论模型通过能够实时分析市场数据的代码得以应用。本练习 [@problem_id:2438216] 在前一个练习的基础上，要求你编写一个程序，自动检测违反看涨-看跌期权平价关系的情况，并明确指出相应的套利策略。这不仅能巩固你对无套利概念的掌握，还能让你获得计算金融的实践经验。", "problem": "考虑一个无摩擦市场，其中有一只不支付股息的标的股票。假设市场上有一个价格为 $C$ 的欧式看涨期权和一个价格为 $P$ 的欧式看跌期权，两者都针对同一股票，具有相同的行权价 $K$ 和到期日 $T$。当前时间为 $t$，连续复利无风险利率为 $r$，当前股价为 $S$。在 Black-Scholes-Merton (BSM) 模型的无套利假设下，看跌-看涨期权平价关系成立：\n$$\nC - P = S - K e^{-r (T - t)}.\n$$\n每当此等式被违反时，就存在一个静态套利机会，该套利仅涉及看涨期权、看跌期权、标的股票的头寸，以及以无风险利率进行的借贷。\n\n编写一个完整的、可运行的程序，对每个提供的测试用例，判断看跌-看涨期权平价关系是否在指定的容差范围内被违反，如果是，则对套利机会进行编码。请使用以下精确定义和输出要求。\n\n定义：\n- 令 $\\tau = T - t$。\n- 令 $\\text{PV}(K) = K e^{-r \\tau}$ 表示行权价的现值。\n- 令 $\\delta = (C - P) - (S - \\text{PV}(K))$。\n- 如果 $|\\delta|  \\varepsilon$，则发生违反，其中容差为 $\\varepsilon = 10^{-6}$。\n\n对于每个测试用例，你的程序必须生成一个三元组 $[\\text{arb\\_exists}, \\text{arb\\_cash\\_inflow}, \\text{strategy\\_code}]$，其含义如下：\n- $\\text{arb\\_exists}$ 是一个布尔值，如果 $|\\delta|  \\varepsilon$ 则为 $\\text{True}$，否则为 $\\text{False}$。\n- $\\text{arb\\_cash\\_inflow}$ 是一个非负浮点数，如果 $|\\delta|  \\varepsilon$ 则等于 $|\\delta|$，否则等于 $0$。此数量代表利用该违规行为的套利在初始时产生的净现金流入（按单位名义金额的单个期权合约计算），以与 $S$、$C$、$P$ 和 $K$ 相同的货币单位表示。将此值四舍五入到恰好 $6$ 位小数。\n- $\\text{strategy\\_code}$ 是一个在 $\\{-1, 0, +1\\}$ 范围内的整数，定义如下：\n  - $\\text{strategy\\_code} = +1$，如果 $\\delta  \\varepsilon$。在这种情况下，可以做空一个合成远期（做空看涨期权，做多看跌期权）并做多标的-远期复制组合（做多股票，借入行权价的现值）。\n  - $\\text{strategy\\_code} = -1$，如果 $\\delta  -\\varepsilon$。在这种情况下，可以做多一个合成远期（做多看涨期权，做空看跌期权）并做空标的-远期复制组合（做空股票，贷出行权价的现值）。\n  - $\\text{strategy\\_code} = 0$，如果 $|\\delta| \\le \\varepsilon$（在容差范围内无套利）。\n\n测试套件：\n为以下五个参数集提供结果，每个参数集以 $(S, K, r, t, T, C, P)$ 的形式给出，其中 $r$ 以小数形式提供，时间单位为年：\n- 案例 $1$（基准，接近平价）：$(S, K, r, t, T, C, P) = (100.0, 100.0, 0.05, 0.0, 0.5, 10.5, 8.030991202833262)$。\n- 案例 $2$（左侧偏高，$\\delta  0$ 的明显违规）：$(S, K, r, t, T, C, P) = (100.0, 100.0, 0.05, 0.0, 0.5, 11.0, 8.030991202833262)$。\n- 案例 $3$（左侧偏低，$\\delta  0$ 的明显违规）：$(S, K, r, t, T, C, P) = (100.0, 100.0, 0.05, 0.0, 0.5, 10.2, 8.030991202833262)$。\n- 案例 $4$（零利率，完全平价）：$(S, K, r, t, T, C, P) = (50.0, 50.0, 0.0, 0.0, 1.0, 5.0, 5.0)$。\n- 案例 $5$（负利率，$\\delta  0$ 的违规）：$(S, K, r, t, T, C, P) = (100.0, 95.0, -0.01, 0.0, 0.5, 7.4, 3.0)$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含结果，格式为一个逗号分隔的列表，并用方括号括起来，每个测试用例一个条目，顺序与上文相同。每个条目本身必须是 $[\\text{arb\\_exists}, \\text{arb\\_cash\\_inflow}, \\text{strategy\\_code}]$ 顺序的三元素列表，其中浮点数打印时保留恰好 $6$ 位小数。例如，一个包含两个假设条目的有效输出将如下所示：\n$[[\\text{True}, 0.123456, 1],[\\text{False}, 0.000000, 0]]$。", "solution": "所提出的问题是 Black-Scholes-Merton 框架背景下无套利原则的一个直接应用。其核心概念是看跌-看涨期权平价关系，这是期权定价理论的基石。该问题定义明确、科学合理且可通过计算验证。我将着手解决它。\n\n**理论基础：看跌-看涨期权平价关系**\n\n看跌-看涨期权平价定理建立了具有相同标的资产、行权价和到期日的欧式看涨期权和看跌期权价格之间的关系。该关系是在无摩擦市场且无套利机会的假设下推导出来的。\n\n让我们在当前时间 $t$ 定义两个投资组合，投资组合 A 和投资组合 B。\n\n1.  **投资组合 A**：做多一份价格为 $C$ 的欧式看涨期权，并做空一份价格为 $P$ 的欧式看跌期权。该投资组合在时间 $t$ 的价值为 $V_A(t) = C - P$。\n2.  **投资组合 B**：做多一份价格为 $S$ 的标的股票，并借入一笔等于行权价现值 $\\text{PV}(K)$ 的现金。该现值是使用连续复利无风险利率 $r$ 在到期时间 $\\tau = T - t$ 内计算的。因此，借入的金额为 $K e^{-r \\tau}$。该投资组合在时间 $t$ 的价值为 $V_B(t) = S - K e^{-r \\tau}$。\n\n为了推导平价关系，我们考察这两个投资组合在到期日 $T$ 的价值。设到期时的股价为 $S_T$。\n\n-   投资组合 A 在到期日 $T$ 的价值 $V_A(T)$ 取决于 $S_T$。做多看涨期权的收益为 $\\max(S_T - K, 0)$。做空看跌期权的收益为 $-\\max(K - S_T, 0)$。\n    -   如果 $S_T  K$，看涨期权的收益是 $S_T - K$，看跌期权的收益是 $0$。因此，$V_A(T) = (S_T - K) - 0 = S_T - K$。\n    -   如果 $S_T \\le K$，看涨期权的收益是 $0$，看跌期权的收益是 $-(K - S_T) = S_T - K$。因此，$V_A(T) = 0 - (K - S_T) = S_T - K$。\n    在时间 $T$ 的所有世界状态下，投资组合 A 的价值都恰好是 $S_T - K$。\n\n-   投资组合 B 在到期日 $T$ 的价值 $V_B(T)$ 是股票价值 $S_T$ 减去贷款的应付金额。初始贷款 $K e^{-r \\tau}$ 以利率 $r$ 在时间 $\\tau$ 内计息，因此在时间 $T$ 需要偿还的金额是 $(K e^{-r \\tau})e^{r \\tau} = K$。\n    因此，投资组合 B 在到期日的价值是 $V_B(T) = S_T - K$。\n\n由于无论股价 $S_T$ 如何，两个投资组合在到期日都具有完全相同的价值 $S_T - K$，根据无套利原则，它们在任何时间 $t \\le T$ 都必须具有相同的价值。因此，我们必须有 $V_A(t) = V_B(t)$，这就导出了看跌-看涨期权平价方程：\n$$\nC - P = S - K e^{-r \\tau}\n$$\n\n**套利策略与检测**\n\n如果该平价关系被违反，则存在套利机会。我们将偏差 $\\delta$ 定义为左侧投资组合的市场价格与右侧投资组合的市场价格之间的差值：\n$$\n\\delta = (C - P) - (S - K e^{-r \\tau})\n$$\n在真实市场中，由于交易成本、买卖价差或舍入误差，可能会出现微小偏差。我们使用一个小的容差 $\\varepsilon = 10^{-6}$ 来区分可忽略的噪音和真实可利用的套利机会。\n\n存在三种可能的情形：\n\n1.  **无套利 ($|\\delta| \\le \\varepsilon$):** 市场价格在给定容差范围内与平价关系一致。无法获得无风险利润。输出必须为 $[\\text{False}, 0.0, 0]$。\n\n2.  **套利情形 1 ($\\delta  \\varepsilon$):** 这意味着 $C - P  S - K e^{-r \\tau}$。由期权（做多看涨期权，做空看跌期权）创建的合成远期相对于其复制组合（做多股票，做空债券）定价过高。套利者可以通过卖出昂贵的投资组合并买入廉价的投资组合来利用这一点。\n    -   **策略：** 在时间 $t$，卖出看涨期权 ($+C$)，买入看跌期权 ($-P$)，做空股票 ($+S$)，并贷出行权价的现值 ($-K e^{-r\\tau}$)。*根据问题陈述逻辑的修正*：问题陈述将 $\\delta  \\varepsilon$ 的策略定义为“做空一个合成远期（做空看涨期权，做多看跌期权）并做多标的-远期复制组合（做多股票，借入行权价的现值）”。这才是正确的策略。\n    -   **在 $t$ 时的现金流：** 做空看涨期权 ($+C$)，做多看跌期权 ($-P$)，做多股票 ($-S$)，借入 $\\text{PV}(K)$ ($+K e^{-r\\tau}$)。\n    -   **在 $t$ 时的净流入：** $C - P - S + K e^{-r \\tau} = (C - P) - (S - K e^{-r \\tau}) = \\delta$。由于 $\\delta  0$，这是一个正的现金流入。\n    -   **在 $T$ 时的头寸：** 组合投资组合的收益为 $(S_T - K) - (S_T - K) = 0$。套利者将初始利润 $\\delta$ 收入囊中，没有未来风险。\n    -   输出必须为 $[\\text{True}, |\\delta|, +1]$。\n\n3.  **套利情形 2 ($\\delta  -\\varepsilon$):** 这意味着 $C - P  S - K e^{-r \\tau}$。合成远期相对于其复制组合定价过低。套利策略与前一情形相反。\n    -   **策略：** 在时间 $t$，买入看涨期权 ($-C$)，卖出看跌期权 ($+P$)，做空股票 ($+S$)，并贷出行权价的现值 ($-K e^{-r\\tau}$)。\n    -   **在 $t$ 时的现金流：** $-C + P + S - K e^{-r \\tau} = (S - K e^{-r \\tau}) - (C - P) = -\\delta$。由于 $\\delta  0$，$-\\delta$ 为正，代表一笔无风险的现金流入。\n    -   **在 $T$ 时的头寸：** 组合投资组合的收益同样为零。套利者将初始利润 $-\\delta$ 收入囊中。\n    -   输出必须为 $[\\text{True}, |\\delta|, -1]$。\n\n**算法实现**\n\n程序将系统地将此逻辑应用于每个测试用例。对于一组给定的参数 $(S, K, r, t, T, C, P)$：\n1.  计算到期时间：$\\tau = T - t$。\n2.  计算行权价的现值：$\\text{PV}(K) = K e^{-r \\tau}$。\n3.  计算偏差：$\\delta = (C - P) - (S - \\text{PV}(K))$。\n4.  应用条件逻辑：\n    -   如果 $\\delta  \\varepsilon$，设置 $\\text{arb\\_exists} = \\text{True}$，$\\text{arb\\_cash\\_inflow} = \\delta$，$\\text{strategy\\_code} = +1$。\n    -   如果 $\\delta  -\\varepsilon$，设置 $\\text{arb\\_exists} = \\text{True}$，$\\text{arb\\_cash\\_inflow} = -\\delta$，$\\text{strategy\\_code} = -1$。\n    -   否则 ($|\\delta| \\le \\varepsilon$)，设置 $\\text{arb\\_exists} = \\text{False}$，$\\text{arb\\_cash\\_inflow} = 0.0$，$\\text{strategy\\_code} = 0$。\n5.  将 `arb_cash_inflow` 格式化为 $6$ 位小数，并将结果组合成最终输出所需的列表格式。`numpy` 库适用于指数计算。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes put-call parity violations for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (S, K, r, t, T, C, P)\n    test_cases = [\n        (100.0, 100.0, 0.05, 0.0, 0.5, 10.5, 8.030991202833262),\n        (100.0, 100.0, 0.05, 0.0, 0.5, 11.0, 8.030991202833262),\n        (100.0, 100.0, 0.05, 0.0, 0.5, 10.2, 8.030991202833262),\n        (50.0, 50.0, 0.0, 0.0, 1.0, 5.0, 5.0),\n        (100.0, 95.0, -0.01, 0.0, 0.5, 7.4, 3.0),\n    ]\n\n    tolerance = 1e-6\n    results = []\n\n    for S, K, r, t, T, C, P in test_cases:\n        # Step 1: Calculate time to maturity, tau\n        tau = T - t\n\n        # Step 2: Calculate the present value of the strike price\n        pv_K = K * np.exp(-r * tau)\n\n        # Step 3: Calculate the parity discrepancy, delta\n        # delta = (C - P) - (S - PV(K))\n        delta = (C - P) - (S - pv_K)\n\n        # Step 4: Determine if an arbitrage opportunity exists and classify it\n        arb_exists = False\n        arb_cash_inflow = 0.0\n        strategy_code = 0\n\n        if delta > tolerance:\n            # Case: delta > epsilon. Synthetic forward is overpriced.\n            # Strategy: Sell synthetic forward, buy replicating portfolio.\n            arb_exists = True\n            arb_cash_inflow = delta\n            strategy_code = 1\n        elif delta  -tolerance:\n            # Case: delta  -epsilon. Synthetic forward is underpriced.\n            # Strategy: Buy synthetic forward, sell replicating portfolio.\n            arb_exists = True\n            arb_cash_inflow = -delta  # Inflow is the positive magnitude |delta|\n            strategy_code = -1\n        else:\n            # Case: |delta| = epsilon. No arbitrage opportunity within tolerance.\n            arb_exists = False\n            arb_cash_inflow = 0.0\n            strategy_code = 0\n\n        # Format the result as a list [bool, float, int]\n        # The float must be rounded to exactly 6 decimal places.\n        result_tuple = [arb_exists, arb_cash_inflow, strategy_code]\n        results.append(result_tuple)\n\n    # Final print statement in the exact required format.\n    # Building the string representation manually to match the exact format.\n    output_items = []\n    for item in results:\n        # item[0] is bool, item[1] is float, item[2] is int\n        output_items.append(f\"[{str(item[0])}, {item[1]:.6f}, {item[2]}]\")\n    print(\"[\" + \",\".join(output_items) + \"]\")\n\nsolve()\n\n```", "id": "2438216"}, {"introduction": "虽然静态套利的概念非常强大，但Black-Scholes-Merton模型的实际应用更在于动态对冲。为了管理期权投资组合的风险，必须理解其价值如何随标的资产价格的变动而变化。本练习 [@problem_id:3079690] 将带你深入BSM模型的核心，要求你从第一性原理出发，推导看涨期权的Delta ($ \\Delta $) 和 Gamma ($ \\Gamma $) 。这些“希腊字母”是任何量化风险管理者必备的基本工具。", "problem": "考虑一个满足 Black–Scholes–Merton (BSM) 假设的无摩擦市场。标的资产价格过程 $S_u$ 在风险中性测度 $\\mathbb{Q}$ 下遵循具有恒定参数的几何布朗运动，因此对于 $u \\in [t,T]$，\n$$\n\\mathrm{d}S_u = r\\,S_u\\,\\mathrm{d}u + \\sigma\\,S_u\\,\\mathrm{d}W_u,\n$$\n其中 $r$ 是恒定的连续复利无风险利率，$\\sigma0$ 是恒定的波动率，$(W_u)_{u \\ge 0}$ 是在满足通常条件的带域概率空间上的标准布朗运动。没有股息。设 $K0$ 为固定执行价格，$Tt$ 为固定到期日。$t$ 时刻，一个收益为 $(S_T - K)^{+}$ 的欧式看涨期权的价格，根据无套利和风险中性定价法，为\n$$\nC(S,t) \\;=\\; \\mathbb{E}^{\\mathbb{Q}}\\!\\left[ \\exp\\!\\big(-r\\,(T-t)\\big)\\,\\big(S_T - K\\big)^{+} \\,\\middle|\\, S_t = S \\right].\n$$\n仅使用此估值公式、$S_u$ 的随机微分方程以及正态分布的标准性质，推导看涨期权 delta $\\Delta_C(S,t) := \\frac{\\partial C}{\\partial S}(S,t)$ 和看涨期权 gamma $\\Gamma_C(S,t) := \\frac{\\partial^{2} C}{\\partial S^{2}}(S,t)$ 作为 $S$、$K$、$r$、$\\sigma$、$t$ 和 $T$ 的函数的封闭式表达式。在正则性证明其合理性的情况下，您可以使用积分符号下的微分。不要假设任何已有的期权价格敏感度公式。\n\n用标准正态累积分布函数 $N(\\cdot)$ 和标准正态概率密度函数 $\\phi(\\cdot)$ 表示您的最终答案，并将其呈现为单行向量 $[\\Delta_C,\\,\\Gamma_C]$。无需进行数值计算，也无需四舍五入。", "solution": "问题是从风险中性估值公式出发，推导 Black-Scholes-Merton (BSM) 看涨期权的 delta $\\Delta_C(S,t)$ 和 gamma $\\Gamma_C(S,t)$。该问题定义明确，有科学依据，并为严格推导提供了所有必要组成部分。\n\n首先，我们建立框架。$t$ 时刻欧式看涨期权的价格由下式给出\n$$ C(S,t) = \\mathbb{E}^{\\mathbb{Q}}\\!\\left[ \\exp\\!\\big(-r\\,(T-t)\\big)\\,\\big(S_T - K\\big)^{+} \\,\\middle|\\, S_t = S \\right] $$\n标的资产价格 $S_u$ 在风险中性测度 $\\mathbb{Q}$ 下遵循几何布朗运动：\n$$ \\mathrm{d}S_u = r\\,S_u\\,\\mathrm{d}u + \\sigma\\,S_u\\,\\mathrm{d}W_u $$\n在给定 $S_t=S$ 的情况下，此随机微分方程对 $S_T$ 的解为\n$$ S_T = S \\exp\\left(\\left(r - \\frac{1}{2}\\sigma^2\\right)(T-t) + \\sigma (W_T - W_t)\\right) $$\n项 $W_T - W_t$ 是一个均值为 $0$、方差为 $T-t$ 的正态分布随机变量。我们可以写成 $W_T - W_t = \\sqrt{T-t} Z$，其中 $Z$ 是一个标准正态随机变量，$Z \\sim N(0,1)$。设 $\\tau = T-t$。$S_T$ 的表达式变为\n$$ S_T = S \\exp\\left(\\left(r - \\frac{1}{2}\\sigma^2\\right)\\tau + \\sigma\\sqrt{\\tau}Z\\right) $$\n我们定义一个随机变量 $X = \\exp\\left(\\left(r - \\frac{1}{2}\\sigma^2\\right)\\tau + \\sigma\\sqrt{\\tau}Z\\right)$。注意 $X$ 的分布不依赖于初始股价 $S$。因此，$S_T = SX$。我们可以将看涨期权价格重写为\n$$ C(S,t) = e^{-r\\tau} \\mathbb{E}^{\\mathbb{Q}}\\left[(SX - K)^+\\right] $$\n其中期望是针对随机变量 $Z$ 计算的。\n\n为了求出看涨期权 delta，$\\Delta_C(S,t) = \\frac{\\partial C}{\\partial S}$，我们将 $C(S,t)$ 的表达式对 $S$ 求导。被积函数（收益函数是全局利普希茨且几乎处处可微）的正则性允许我们交换微分和期望的顺序（即，应用莱布尼茨积分法则进行积分符号下的微分）。\n$$ \\Delta_C(S,t) = \\frac{\\partial}{\\partial S} \\left( e^{-r\\tau} \\mathbb{E}^{\\mathbb{Q}}\\left[(SX - K)^+\\right] \\right) = e^{-r\\tau} \\mathbb{E}^{\\mathbb{Q}}\\left[\\frac{\\partial}{\\partial S}(SX - K)^+\\right] $$\n函数 $f(y) = (y-K)^+$ 相对于 $y$ 的导数是指示函数 $\\mathbf{1}_{yK}$。使用链式法则，我们得到 $\\frac{\\partial}{\\partial S}(SX-K)^+ = X \\cdot \\mathbf{1}_{SXK}$。\n将此代入 $\\Delta_C(S,t)$ 的表达式中：\n$$ \\Delta_C(S,t) = e^{-r\\tau} \\mathbb{E}^{\\mathbb{Q}}\\left[X \\cdot \\mathbf{1}_{SXK}\\right] $$\n由于 $S_T = SX$，这可以写成：\n$$ \\Delta_C(S,t) = e^{-r\\tau} \\mathbb{E}^{\\mathbb{Q}}\\left[\\frac{S_T}{S} \\cdot \\mathbf{1}_{S_TK}\\right] = \\frac{e^{-r\\tau}}{S} \\mathbb{E}^{\\mathbb{Q}}\\left[S_T \\cdot \\mathbf{1}_{S_TK}\\right] $$\n我们现在必须计算期望 $\\mathbb{E}^{\\mathbb{Q}}\\left[S_T \\cdot \\mathbf{1}_{S_TK}\\right]$。这是一个关于标准正态变量 $Z$ 的密度的积分。设 $\\phi(z) = \\frac{1}{\\sqrt{2\\pi}} \\exp(-z^2/2)$ 是 $Z$ 的概率密度函数 (PDF)。\n$$ \\mathbb{E}^{\\mathbb{Q}}\\left[S_T \\cdot \\mathbf{1}_{S_TK}\\right] = \\int_{-\\infty}^{\\infty} S \\exp\\left(\\left(r - \\frac{1}{2}\\sigma^2\\right)\\tau + \\sigma\\sqrt{\\tau}z\\right) \\cdot \\mathbf{1}_{S \\exp((r-\\frac{1}{2}\\sigma^2)\\tau + \\sigma\\sqrt{\\tau}z)  K} \\, \\phi(z) \\, \\mathrm{d}z $$\n指示函数中的条件 $S_T  K$ 等价于：\n$$ \\ln(S/K) + \\left(r - \\frac{1}{2}\\sigma^2\\right)\\tau + \\sigma\\sqrt{\\tau}Z  0 \\implies Z  -\\frac{\\ln(S/K) + (r - \\frac{1}{2}\\sigma^2)\\tau}{\\sigma\\sqrt{\\tau}} $$\n我们定义标准的 BSM 项 $d_2$：\n$$ d_2 = \\frac{\\ln(S/K) + (r - \\frac{1}{2}\\sigma^2)\\tau}{\\sigma\\sqrt{\\tau}} $$\n条件变为 $Z  -d_2$。因此积分为\n$$ \\mathbb{E}^{\\mathbb{Q}}\\left[S_T \\cdot \\mathbf{1}_{S_TK}\\right] = S \\int_{-d_2}^{\\infty} \\exp\\left(\\left(r - \\frac{1}{2}\\sigma^2\\right)\\tau + \\sigma\\sqrt{\\tau}z\\right) \\frac{e^{-z^2/2}}{\\sqrt{2\\pi}} \\, \\mathrm{d}z $$\n$$ = S e^{(r-\\frac{1}{2}\\sigma^2)\\tau} \\int_{-d_2}^{\\infty} \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(\\sigma\\sqrt{\\tau}z - \\frac{z^2}{2}\\right) \\, \\mathrm{d}z $$\n我们在指数上配方：$\\sigma\\sqrt{\\tau}z - \\frac{z^2}{2} = -\\frac{1}{2}(z^2 - 2\\sigma\\sqrt{\\tau}z) = -\\frac{1}{2}(z - \\sigma\\sqrt{\\tau})^2 + \\frac{1}{2}\\sigma^2\\tau$。\n$$ \\mathbb{E}^{\\mathbb{Q}}\\left[S_T \\cdot \\mathbf{1}_{S_TK}\\right] = S e^{(r-\\frac{1}{2}\\sigma^2)\\tau} e^{\\frac{1}{2}\\sigma^2\\tau} \\int_{-d_2}^{\\infty} \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{1}{2}(z - \\sigma\\sqrt{\\tau})^2\\right) \\, \\mathrm{d}z $$\n$$ = S e^{r\\tau} \\int_{-d_2}^{\\infty} \\phi(z - \\sigma\\sqrt{\\tau}) \\, \\mathrm{d}z $$\n设 $y = z - \\sigma\\sqrt{\\tau}$。积分下限变为 $-d_2 - \\sigma\\sqrt{\\tau}$。\n新下限的参数为\n$$ -d_2 - \\sigma\\sqrt{\\tau} = -\\frac{\\ln(S/K) + (r - \\frac{1}{2}\\sigma^2)\\tau}{\\sigma\\sqrt{\\tau}} - \\sigma\\sqrt{\\tau} = -\\frac{\\ln(S/K) + r\\tau - \\frac{1}{2}\\sigma^2\\tau + \\sigma^2\\tau}{\\sigma\\sqrt{\\tau}} = -\\frac{\\ln(S/K) + (r + \\frac{1}{2}\\sigma^2)\\tau}{\\sigma\\sqrt{\\tau}} $$\n这是 $-d_1$，其中 $d_1 = \\frac{\\ln(S/K) + (r + \\frac{1}{2}\\sigma^2)\\tau}{\\sigma\\sqrt{\\tau}} = d_2 + \\sigma\\sqrt{\\tau}$。\n积分为 $\\int_{-d_1}^{\\infty} \\phi(y) \\, \\mathrm{d}y = P(Y  -d_1)$，其中 $Y \\sim N(0,1)$。根据正态分布的对称性，这等于 $P(Y  d_1)$，即标准正态累积分布函数 (CDF) $N(d_1)$。\n所以，$\\mathbb{E}^{\\mathbb{Q}}\\left[S_T \\cdot \\mathbf{1}_{S_TK}\\right] = S e^{r\\tau} N(d_1)$。\n将此代入我们对 $\\Delta_C(S,t)$ 的表达式中：\n$$ \\Delta_C(S,t) = \\frac{e^{-r\\tau}}{S} \\left(S e^{r\\tau} N(d_1)\\right) = N(d_1) $$\n这就是看涨期权 delta 的封闭式表达式。\n\n接下来，我们推导看涨期权 gamma，$\\Gamma_C(S,t) = \\frac{\\partial^2 C}{\\partial S^2} = \\frac{\\partial \\Delta_C}{\\partial S}$。我们将 $\\Delta_C(S,t)$ 的表达式对 $S$ 求导：\n$$ \\Gamma_C(S,t) = \\frac{\\partial}{\\partial S} N(d_1) $$\n使用链式法则，$\\frac{\\mathrm{d}N(x)}{\\mathrm{d}x} = \\phi(x)$，我们得到\n$$ \\Gamma_C(S,t) = N'(d_1) \\frac{\\partial d_1}{\\partial S} = \\phi(d_1) \\frac{\\partial d_1}{\\partial S} $$\n我们现在计算 $d_1$ 对 $S$ 的偏导数：\n$$ d_1 = \\frac{\\ln(S) - \\ln(K) + (r + \\frac{1}{2}\\sigma^2)\\tau}{\\sigma\\sqrt{\\tau}} $$\n$$ \\frac{\\partial d_1}{\\partial S} = \\frac{\\partial}{\\partial S}\\left( \\frac{\\ln(S)}{\\sigma\\sqrt{\\tau}} \\right) = \\frac{1}{S\\sigma\\sqrt{\\tau}} $$\n将此代回 gamma 的表达式中：\n$$ \\Gamma_C(S,t) = \\phi(d_1) \\frac{1}{S\\sigma\\sqrt{\\tau}} = \\frac{\\phi(d_1)}{S\\sigma\\sqrt{T-t}} $$\n这就是看涨期权 gamma 的封闭式表达式。\n\n总而言之，推导出的敏感度为：\n$$ \\Delta_C(S,t) = N\\left( \\frac{\\ln(S/K) + (r + \\frac{1}{2}\\sigma^2)(T-t)}{\\sigma\\sqrt{T-t}} \\right) $$\n$$ \\Gamma_C(S,t) = \\frac{\\phi\\left( \\frac{\\ln(S/K) + (r + \\frac{1}{2}\\sigma^2)(T-t)}{\\sigma\\sqrt{T-t}} \\right)}{S\\sigma\\sqrt{T-t}} $$\n其中 $N(\\cdot)$ 是标准正态 CDF，$\\phi(\\cdot)$ 是标准正态 PDF。\n最终答案以行向量 $[\\Delta_C, \\Gamma_C]$ 的形式呈现。", "answer": "$$ \\boxed{\\begin{pmatrix} N\\left(\\frac{\\ln(S/K) + \\left(r + \\frac{1}{2}\\sigma^{2}\\right)(T-t)}{\\sigma\\sqrt{T-t}}\\right)  \\frac{\\phi\\left(\\frac{\\ln(S/K) + \\left(r + \\frac{1}{2}\\sigma^{2}\\right)(T-t)}{\\sigma\\sqrt{T-t}}\\right)}{S\\sigma\\sqrt{T-t}} \\end{pmatrix}} $$", "id": "3079690"}]}