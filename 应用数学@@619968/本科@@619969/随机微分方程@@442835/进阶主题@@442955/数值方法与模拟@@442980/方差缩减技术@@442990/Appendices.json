{"hands_on_practices": [{"introduction": "控制变量法是一种通过利用我们感兴趣的量与另一个期望已知的变量之间的相关性来改进蒙特卡洛估计的有效技术。本练习将带你亲手计算最优的控制系数 $\\beta^*$，该系数能最大化方差缩减的效果，从而让你对该方法的数学原理有更深入的理解。[@problem_id:1348947]", "problem": "在蒙特卡洛方法中，一个常见的任务是估计积分 $I = \\int_a^b g(x) dx$ 的值。这通常通过将积分重构为一个期望值 $E[f(X)]$ 来实现，其中 $X$ 是一个随机变量，$f$ 是一个相关函数。然后，一个标准的“原始”蒙特卡洛估计量使用 $f(X_i)$ 的 $N$ 次独立抽样的样本均值。\n\n为了在给定样本数量的情况下提高估计的精度，会采用方差缩减技术。其中一种技术是控制变量法。这涉及到寻找一个与 $f(X)$ 相关且具有已知期望 $\\mu_C = E[C]$ 的随机变量 $C$。然后构造一个新的、改进的估计量 $Z(b) = f(X) - b(C - \\mu_C)$，其中 $b$ 是一个常数系数。选择 $b$ 的值以最小化 $Z(b)$ 的方差。这个最优系数，记为 $b^*$，由以下公式给出：\n$$b^* = \\frac{\\text{Cov}(f(X), C)}{\\text{Var}(C)}$$\n\n考虑估计积分 $I = \\int_0^1 \\cos\\left(\\frac{\\pi x}{2}\\right) dx$ 的问题。这等价于求 $Y = \\cos\\left(\\frac{\\pi X}{2}\\right)$ 的期望值，其中 $X$ 是在区间 $[0, 1]$ 上均匀分布的随机变量。我们将使用随机变量 $C = X$ 作为控制变量，因为它与 $Y$ 相关且其性质易于确定。\n\n您的任务是计算此控制变量的最优系数 $b^*$ 的精确理论值。请用一个包含 $\\pi$ 的封闭形式解析表达式来表示您的答案。", "solution": "我们有 $X \\sim \\text{Unif}[0,1]$，$Y=\\cos\\left(\\frac{\\pi X}{2}\\right)$，以及 $C=X$。最优控制变量系数为\n$$\nb^{*}=\\frac{\\text{Cov}(Y,C)}{\\text{Var}(C)}.\n$$\n首先计算 $\\text{Var}(C)$。使用 $E[X]=\\int_{0}^{1}x\\,dx=\\frac{1}{2}$ 和 $E[X^{2}]=\\int_{0}^{1}x^{2}\\,dx=\\frac{1}{3}$，我们得到\n$$\n\\text{Var}(C)=E[X^{2}]-\\left(E[X]\\right)^{2}=\\frac{1}{3}-\\frac{1}{4}=\\frac{1}{12}.\n$$\n接下来计算 $E[Y]$：\n$$\nE[Y]=\\int_{0}^{1}\\cos\\left(\\frac{\\pi x}{2}\\right)\\,dx=\\left.\\frac{2}{\\pi}\\sin\\left(\\frac{\\pi x}{2}\\right)\\right|_{0}^{1}=\\frac{2}{\\pi}.\n$$\n现在计算 $E[CY]=E\\!\\left[X\\cos\\left(\\frac{\\pi X}{2}\\right)\\right]$。令 $a=\\frac{\\pi}{2}$。则\n$$\nE[CY]=\\int_{0}^{1}x\\cos(ax)\\,dx.\n$$\n使用分部积分法，令 $u=x$，$dv=\\cos(ax)\\,dx$，因此 $du=dx$ 且 $v=\\frac{1}{a}\\sin(ax)$，我们得到\n$$\n\\int x\\cos(ax)\\,dx=\\frac{x\\sin(ax)}{a}+\\frac{\\cos(ax)}{a^{2}}.\n$$\n从 $0$ 到 $1$ 计算定积分，\n$$\n\\int_{0}^{1}x\\cos(ax)\\,dx=\\frac{\\sin(a)}{a}+\\frac{\\cos(a)-1}{a^{2}}.\n$$\n当 $a=\\frac{\\pi}{2}$ 时，我们有 $\\sin(a)=1$ 和 $\\cos(a)=0$，因此\n$$\nE[CY]=\\frac{1}{a}-\\frac{1}{a^{2}}=\\frac{2}{\\pi}-\\frac{4}{\\pi^{2}}.\n$$\n因此，\n$$\n\\text{Cov}(Y,C)=E[CY]-E[Y]E[C]=\\left(\\frac{2}{\\pi}-\\frac{4}{\\pi^{2}}\\right)-\\left(\\frac{2}{\\pi}\\right)\\left(\\frac{1}{2}\\right)=\\frac{1}{\\pi}-\\frac{4}{\\pi^{2}}=\\frac{\\pi-4}{\\pi^{2}}.\n$$\n最后，\n$$\nb^{*}=\\frac{\\text{Cov}(Y,C)}{\\text{Var}(C)}=\\frac{\\frac{\\pi-4}{\\pi^{2}}}{\\frac{1}{12}}=\\frac{12(\\pi-4)}{\\pi^{2}}.\n$$", "answer": "$$\\boxed{\\frac{12(\\pi - 4)}{\\pi^{2}}}$$", "id": "1348947"}, {"introduction": "条件蒙特卡洛是另一种强大的方差缩减方法，其核心思想是，对一部分随机性进行解析计算，而不是完全依赖模拟。这个练习将向你展示如何通过对其中一个随机变量取条件期望来构造一个新的、方差更小的估计量。通过这个过程，你将体会到如何用解析方法“消除”一部分随机性，从而显著提高估计效率。[@problem_id:1348948]", "problem": "在一个简化的数字通信系统模型中，一位比特的检测取决于信号幅度 $X$ 与一个噪声相关的阈值之间的关系。信号幅度 $X$ 和噪声相关变量 $Y$ 都被建模为在区间 $[0, 1]$ 上均匀分布的独立随机变量。如果 $X > Y^2$，则检测成功。\n\n我们希望使用蒙特卡洛方法估计成功检测的概率 $\\theta = P(X > Y^2)$。一种标准方法是定义一个指示随机变量 $I = \\mathbf{1}_{X > Y^2}$ 并估计其期望。为了对此进行改进，我们将使用条件蒙特卡洛技术。\n\n设 $Z$ 是通过计算 $I$ 相对于随机变量 $Y$ 的条件期望而获得的新估计量。也就是说，$Z = E[I | Y]$。你的任务是：\n1.  确定随机变量 $Z$ 作为 $Y$ 的函数的解析表达式。\n2.  计算这个新估计量 $\\text{Var}(Z)$ 的精确方差。\n\n请以一对值的形式给出你的答案：$Z$ 的表达式和 $\\text{Var}(Z)$ 的数值。", "solution": "设 $X$ 和 $Y$ 是独立的，并在 $[0,1]$ 上均匀分布。定义 $I=\\mathbf{1}_{X>Y^{2}}$。条件蒙特卡洛估计量为 $Z=E[I\\mid Y]$。\n\n1) 对于一个固定的 $Y=y\\in[0,1]$，根据独立性可得\n$$\nZ(y)=E[I\\mid Y=y]=P(X>y^{2}\\mid Y=y)=P(X>y^{2})=\\int_{0}^{1}\\mathbf{1}_{x>y^{2}}\\,f_{X}(x)\\,dx.\n$$\n由于在 $[0,1]$ 上 $f_{X}(x)=1$，这变为\n$$\nZ(y)=\\int_{y^{2}}^{1}1\\,dx=1-y^{2}.\n$$\n因此，作为一个随机变量，\n$$\nZ=1-Y^{2}.\n$$\n\n2) $Z$ 的方差为\n$$\n\\operatorname{Var}(Z)=\\operatorname{Var}(1-Y^{2})=\\operatorname{Var}(Y^{2})=E[Y^{4}]-\\left(E[Y^{2}]\\right)^{2}.\n$$\n对于 $Y\\sim\\text{Uniform}(0,1)$，当整数 $k\\geq 0$ 时，有 $E[Y^{k}]=\\frac{1}{k+1}$，因此 $E[Y^{2}]=\\frac{1}{3}$ 且 $E[Y^{4}]=\\frac{1}{5}$。所以，\n$$\n\\operatorname{Var}(Z)=\\frac{1}{5}-\\left(\\frac{1}{3}\\right)^{2}=\\frac{1}{5}-\\frac{1}{9}=\\frac{9-5}{45}=\\frac{4}{45}.\n$$\n等价地，我们可以通过计算 $E[Z]=E[1-Y^{2}]=1-\\frac{1}{3}=\\frac{2}{3}$ 和 $E[Z^{2}]=E[(1-Y^{2})^{2}]=1-2E[Y^{2}]+E[Y^{4}]=1-\\frac{2}{3}+\\frac{1}{5}=\\frac{8}{15}$ 来进行验证，从而得出 $\\operatorname{Var}(Z)=\\frac{8}{15}-\\left(\\frac{2}{3}\\right)^{2}=\\frac{4}{45}$。\n\n因此，$Z=1-Y^{2}$ 且 $\\operatorname{Var}(Z)=\\frac{4}{45}$。", "answer": "$$\\boxed{\\begin{pmatrix} 1 - Y^{2} & \\frac{4}{45} \\end{pmatrix}}$$", "id": "1348948"}, {"introduction": "对偶变量法通常被认为是一种简单有效的方差缩减技巧，尤其适用于单调函数。然而，它是否总是有效？本练习将通过构造一个特殊的支付函数，引导你探索对偶变量法的边界条件，并揭示在某些情况下（例如函数具有对称性而非单调性时），该方法可能反而会增加估计量的方差。[@problem_id:2446675]", "problem": "在用于计算金融定价的蒙特卡洛（MC）模拟中，考虑估计预期收益 $\\mu = \\mathbb{E}[g(X)]$，其中 $X \\sim U(0,1)$ 且 $g:[0,1]\\to\\mathbb{R}$ 是一个二元收益函数。通过取两个边界区间的对称并集来构建收益：对于参数 $a \\in (0,\\tfrac{1}{2})$，定义\n$$\ng(x) = \\mathbf{1}\\{x \\in [0,a] \\cup [1-a,1]\\}.\n$$\n设 $\\widehat{\\mu}_{c}$ 是基于 2 个独立样本 $X_{1},X_{2} \\sim U(0,1)$ 的原始蒙特卡洛估计量：\n$$\n\\widehat{\\mu}_{c} = \\frac{g(X_{1}) + g(X_{2})}{2},\n$$\n并设 $\\widehat{\\mu}_{a}$ 是基于一个对偶对 $(X,1-X)$（其中 $X \\sim U(0,1)$）的对偶变量估计量：\n$$\n\\widehat{\\mu}_{a} = \\frac{g(X) + g(1-X)}{2}.\n$$\n计算精确的方差比\n$$\nR \\equiv \\frac{\\operatorname{Var}(\\widehat{\\mu}_{a})}{\\operatorname{Var}(\\widehat{\\mu}_{c})}.\n$$\n答案以单个实数形式给出；无需四舍五入。", "solution": "问题要求计算方差比 $R \\equiv \\frac{\\operatorname{Var}(\\widehat{\\mu}_{a})}{\\operatorname{Var}(\\widehat{\\mu}_{c})}$，其中 $\\widehat{\\mu}_{c}$ 是原始蒙特卡洛估计量，$\\widehat{\\mu}_{a}$ 是用于估计期望值 $\\mu = \\mathbb{E}[g(X)]$ 的对偶变量估计量。\n\n首先，我们定义随机变量 $Y = g(X)$，其中 $X \\sim U(0,1)$，收益函数为 $g(x) = \\mathbf{1}\\{x \\in [0,a] \\cup [1-a,1]\\}$，参数 $a \\in (0, \\frac{1}{2})$。随机变量 $Y$ 是一个伯努利变量，因为它只能取 0 或 1。\n\n成功概率 $p$ 是 $Y$ 的期望值：\n$$\np = \\mathbb{E}[Y] = \\mathbb{E}[g(X)] = \\int_{0}^{1} g(x) dx = \\int_{0}^{a} 1 \\,dx + \\int_{1-a}^{1} 1 \\,dx = a + (1 - (1-a)) = 2a.\n$$\n由于 $Y$ 是参数为 $p=2a$ 的伯努利随机变量，其方差由下式给出：\n$$\n\\operatorname{Var}(Y) = p(1-p) = 2a(1-2a).\n$$\n这也可以直接计算：\n$$\n\\mathbb{E}[Y^{2}] = \\mathbb{E}[g(X)^2] = \\mathbb{E}[g(X)] = 2a,\n$$\n因为对于指示函数，$g(x)^2 = g(x)$。\n因此，\n$$\n\\operatorname{Var}(Y) = \\mathbb{E}[Y^2] - (\\mathbb{E}[Y])^2 = 2a - (2a)^2 = 2a(1-2a).\n$$\n由于 $a \\in (0, \\frac{1}{2})$，我们有 $a > 0$ 和 $1-2a > 0$，这确保了 $\\operatorname{Var}(Y) > 0$。\n\n接下来，我们计算原始蒙特卡洛估计量 $\\widehat{\\mu}_{c}$ 的方差。\n该估计量定义为 $\\widehat{\\mu}_{c} = \\frac{g(X_{1}) + g(X_{2})}{2}$，其中 $X_{1}, X_{2}$ 是来自 $U(0,1)$ 的独立同分布（i.i.d.）样本。设 $Y_1 = g(X_1)$ 且 $Y_2 = g(X_2)$。$Y_1$ 和 $Y_2$ 是独立同分布的随机变量，其方差为 $\\operatorname{Var}(Y_1) = \\operatorname{Var}(Y_2) = \\operatorname{Var}(Y) = 2a(1-2a)$。\n由于 $Y_1$ 和 $Y_2$ 的独立性，它们和的方差等于它们方差的和。\n$$\n\\operatorname{Var}(\\widehat{\\mu}_{c}) = \\operatorname{Var}\\left(\\frac{Y_{1} + Y_{2}}{2}\\right) = \\frac{1}{4}\\operatorname{Var}(Y_1 + Y_2) = \\frac{1}{4}(\\operatorname{Var}(Y_{1}) + \\operatorname{Var}(Y_{2})).\n$$\n代入 $Y$ 的方差：\n$$\n\\operatorname{Var}(\\widehat{\\mu}_{c}) = \\frac{1}{4}(2a(1-2a) + 2a(1-2a)) = \\frac{1}{4}(4a(1-2a)) = a(1-2a).\n$$\n现在，我们计算对偶变量估计量 $\\widehat{\\mu}_{a}$ 的方差。\n该估计量定义为 $\\widehat{\\mu}_{a} = \\frac{g(X) + g(1-X)}{2}$。我们必须分析 $g(X)$ 和 $g(1-X)$ 之间的关系。\n函数 $g(x)$ 关于 $x=\\frac{1}{2}$ 对称。我们来验证 $g(1-x)$ 的这个性质：\n$$\ng(1-x) = \\mathbf{1}\\{1-x \\in [0,a] \\cup [1-a,1]\\}.\n$$\n条件 $1-x \\in [0,a]$ 等价于 $1-a \\le x \\le 1$。\n条件 $1-x \\in [1-a,1]$ 等价于 $0 \\le x \\le a$。\n因此，$g(1-x) = 1$ 当且仅当 $x \\in [0,a] \\cup [1-a,1]$。这与 $g(x)=1$ 的条件相同。对于所有其他 $x \\in (0,1)$，$g(x)$ 和 $g(1-x)$ 均为 0。\n因此，对于所有 $x \\in [0,1]$，都有 $g(x) = g(1-x)$。\n\n这意味着随机变量 $g(X)$ 和 $g(1-X)$ 是相同的。对偶估计量简化为：\n$$\n\\widehat{\\mu}_{a} = \\frac{g(X) + g(X)}{2} = g(X) = Y.\n$$\n因此，对偶估计量的方差就是 $Y$ 的方差：\n$$\n\\operatorname{Var}(\\widehat{\\mu}_{a}) = \\operatorname{Var}(g(X)) = 2a(1-2a).\n$$\n最后，我们计算所求的比率 $R$：\n$$\nR = \\frac{\\operatorname{Var}(\\widehat{\\mu}_{a})}{\\operatorname{Var}(\\widehat{\\mu}_{c})} = \\frac{2a(1-2a)}{a(1-2a)}.\n$$\n由于 $a \\in (0, \\frac{1}{2})$，项 $a(1-2a)$ 严格为正，可以从分子和分母中约去。\n$$\nR = 2.\n$$\n该比率是一个常数，与参数 $a$ 无关。这展示了一个案例，其中对偶抽样技术应用于对称函数时，在函数求值次数相同的情况下，与原始蒙特卡洛方法相比，方差反而增加了。具体来说，它使抽样方差增加了一倍。", "answer": "$$\n\\boxed{2}\n$$", "id": "2446675"}]}