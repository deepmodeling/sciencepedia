{"hands_on_practices": [{"introduction": "马尔可夫链蒙特卡洛方法的基础是模拟马尔可夫链的路径。在我们应用更复杂的算法之前，首先必须理解如何根据给定的转移概率生成一个状态序列。这个练习将带你亲手操作这个基本过程，通过使用随机数和转移矩阵，一步步地构建一个马尔可夫链的样本路径，从而揭示模拟的本质。[@problem_id:1319941]", "problem": "一个用于创建字符序列的简单生成模型使用离散时间马尔可夫链。考虑一个具有三个可能状态的系统：{A, B, C}。该链的行为由以下一步转移概率矩阵 $P$ 控制，其中元素 $P_{ij}$ 表示从状态 $i$ 转移到状态 $j$ 的概率。状态按字母顺序排列（A、B、C）。\n\n$$\nP = \\begin{pmatrix} 0.1  0.6  0.3 \\\\ 0.5  0.0  0.5 \\\\ 0.2  0.2  0.6 \\end{pmatrix}\n$$\n\n你的任务是执行一次蒙特卡洛模拟，以生成一个长度为5的字符序列。模拟从状态 A 开始。对于每个后续步骤，一个在 $[0, 1)$ 上均匀分布的随机数决定了下一个状态。为执行此模拟，请使用以下由四个随机数组成的有序序列：$0.73, 0.41, 0.89, 0.15$。\n\n确定下一个状态的约定如下：如果当前状态是 $i$，转移到状态 A、B 和 C 的概率分别为 $p_{iA}$、$p_{iB}$ 和 $p_{iC}$，那么下一个状态由随机数 $u$ 根据以下规则确定：\n- 如果 $0 \\le u  p_{iA}$，则为状态 A\n- 如果 $p_{iA} \\le u  p_{iA} + p_{iB}$，则为状态 B\n- 如果 $p_{iA} + p_{iB} \\le u  1$，则为状态 C\n\n本次模拟生成了下列哪个序列？\n\nA. ABACA\n\nB. ACCCA\n\nC. ACBAC\n\nD. AAAAA\n\nE. ABCCB", "solution": "我们从状态 A 开始，并对每个当前状态使用累积转移区间来应用给定规则。对于概率为 $(p_{iA},p_{iB},p_{iC})$ 的行，随机数 $u$ 的区间为：A 是 $[0,p_{iA})$，B 是 $[p_{iA},p_{iA}+p_{iB})$，C 是 $[p_{iA}+p_{iB},1)$。\n\n从 A 出发，$(p_{AA},p_{AB},p_{AC})=(0.1,0.6,0.3)$，所以区间为：A 是 $[0,0.1)$，B 是 $[0.1,0.7)$，C 是 $[0.7,1)$。\n从 B 出发，$(p_{BA},p_{BB},p_{BC})=(0.5,0.0,0.5)$，所以区间为：A 是 $[0,0.5)$，B 是 $[0.5,0.5)$，C 是 $[0.5,1)$。\n从 C 出发，$(p_{CA},p_{CB},p_{CC})=(0.2,0.2,0.6)$，所以区间为：A 是 $[0,0.2)$，B 是 $[0.2,0.4)$，C 是 $[0.4,1)$。\n\n步骤 1：从 A 开始，使用 $u_{1}=0.73$。由于对于 A 所在的行，$0.73\\in[0.7,1)$，因此下一个状态是 C。\n步骤 2：当前状态为 C，使用 $u_{2}=0.41$。由于对于 C 所在的行，$0.41\\in[0.4,1)$，因此下一个状态是 C。\n步骤 3：当前状态为 C，使用 $u_{3}=0.89$。由于对于 C 所在的行，$0.89\\in[0.4,1)$，因此下一个状态是 C。\n步骤 4：当前状态为 C，使用 $u_{4}=0.15$。由于对于 C 所在的行，$0.15\\in[0,0.2)$，因此下一个状态是 A。\n\n因此，这个长度为5的字符序列是 A, C, C, C, A，这对应于选项 B。", "answer": "$$\\boxed{B}$$", "id": "1319941"}, {"introduction": "当我们无法直接从目标分布 $\\pi$ 中采样时，Metropolis-Hastings 算法提供了一个强大的解决方案。该算法的核心在于其“接受-拒绝”机制，它巧妙地修正了一个简单的提议分布，以确保最终生成的马尔可夫链能收敛到我们期望的目标分布。这个练习将让你计算一个关键步骤——接受概率，这有助于你深入理解算法如何做出决策，从而保证其正确性。[@problem_id:1319963]", "problem": "一位工程师正在使用一个计算模型来研究一个系统，该系统可以存在于三个离散状态之一：$S_1$、$S_2$ 和 $S_3$。其目标是根据一个目标平稳概率分布 $\\pi$ 来模拟系统的行为。由于系统的复杂性，直接从 $\\pi$ 中采样是不可行的。因此，该工程师采用 Metropolis-Hastings 算法（一种马尔可夫链蒙特卡洛方法）来生成一个状态序列，该序列最终将服从分布 $\\pi$。\n\n目标分布 $\\pi$ 除一个归一化常数外是已知的，其各状态的未归一化权重如下：\n$\\tilde{\\pi}(S_1) = 5$，$\\tilde{\\pi}(S_2) = 2$，以及 $\\tilde{\\pi}(S_3) = 8$。\n\nMetropolis-Hastings 算法使用一个由转移矩阵 $Q$ 定义的提议分布来建议状态之间的转移。对于该系统，提议矩阵为：\n$$\nQ = \\begin{pmatrix}\n0.1  0.5  0.4 \\\\\n0.6  0.2  0.2 \\\\\n0.3  0.3  0.4\n\\end{pmatrix}\n$$\n其中，元素 $Q_{ij}$ 表示在当前状态为 $S_i$ 的情况下，提议转移到状态 $S_j$ 的概率。\n\n假设模拟当前处于状态 $S_3$，算法提议转移到状态 $S_1$。计算此提议转移的接受概率。将你的答案以小数形式给出，并四舍五入到三位有效数字。", "solution": "在带有提议核 $Q$ 的 Metropolis-Hastings 算法中，从状态 $i$ 转移到状态 $j$ 的提议的接受概率为\n$$\n\\alpha(i \\to j) = \\min\\left(1, \\frac{\\pi(j)\\,Q_{j,i}}{\\pi(i)\\,Q_{i,j}}\\right).\n$$\n当 $\\pi$ 除一个归一化常数外已知时，归一化的概率会消去，因此我们可以使用未归一化的权重 $\\tilde{\\pi}$：\n$$\n\\alpha(i \\to j) = \\min\\left(1, \\frac{\\tilde{\\pi}(j)\\,Q_{j,i}}{\\tilde{\\pi}(i)\\,Q_{i,j}}\\right).\n$$\n这里 $i=3$ 且 $j=1$。使用 $\\tilde{\\pi}(S_{1})=5$，$\\tilde{\\pi}(S_{3})=8$，$Q_{1,3}=0.4$ 和 $Q_{3,1}=0.3$，我们计算\n$$\n\\frac{\\tilde{\\pi}(S_{1})\\,Q_{1,3}}{\\tilde{\\pi}(S_{3})\\,Q_{3,1}}=\\frac{5 \\cdot 0.4}{8 \\cdot 0.3}=\\frac{2}{2.4}=\\frac{5}{6}.\n$$\n因此，\n$$\n\\alpha(3 \\to 1)=\\min\\left(1, \\frac{5}{6}\\right)=\\frac{5}{6}\\approx 0.833333\\ldots\n$$\n四舍五入到三位有效数字，接受概率为 $0.833$。", "answer": "$$\\boxed{0.833}$$", "id": "1319963"}, {"introduction": "在实践中，仅仅实现一个 MCMC 算法是不够的，我们还必须确保它能有效地探索整个概率空间。当目标分布具有多个分离的模式时（即多峰分布），一个常见的陷阱是采样器可能被困在其中一个模式中，无法“看到”全局分布。这个练习模拟了一个典型的失败案例，要求你分析一个步长 $\\sigma_{step}$ 设置不当的采样器的行为，这对于培养 MCMC 实践中的诊断和调试能力至关重要。[@problem_id:1932795]", "problem": "一位数据科学家正在使用马尔可夫链蒙特卡洛（MCMC）方法，从一个复杂的一维目标概率密度函数 $\\pi(x)$ 中抽取样本。已知目标分布是一个对称的双峰分布，具体来说是两个高斯分布的等权重混合。其密度正比于两个高斯概率密度函数之和：\n$$ \\pi(x) \\propto \\exp\\left(-\\frac{(x - \\mu_A)^2}{2\\sigma_{mode}^2}\\right) + \\exp\\left(-\\frac{(x - \\mu_B)^2}{2\\sigma_{mode}^2}\\right) $$\n参数给定为 $\\mu_A = -10$，$\\mu_B = 10$ 和 $\\sigma_{mode} = 1$。这种结构导致在 $x=-10$ 和 $x=10$ 处有两个狭窄且分离良好的概率峰，它们之间是一个概率密度极低的区域。\n\n该科学家使用随机游走 Metropolis 算法。在每一步，从以当前状态 $x_t$ 为中心的高斯分布中提议一个新状态 $x'$，即 $x' \\sim N(x_t, \\sigma_{step}^2)$。为了获得高接受率，该科学家选择了一个非常小的步长方差，设定 $\\sigma_{step} = 0.1$。MCMC 链在其中一个峰的峰值处初始化，即 $x_0 = -10$，并运行 $N=10^6$ 次迭代。\n\n下列哪个陈述最准确地描述了该 MCMC 采样器的行为以及所得样本集 $\\{x_1, x_2, \\dots, x_N\\}$ 的统计特性？\n\nA. 样本将分布在目标分布的真实均值（即 $x=0$）周围。样本均值将接近 0，但样本方差会很大（大于 100），从而准确反映两个峰之间的显著分离。\n\nB. 提议移动的接受率将非常低（接近 0），因为步长没有根据目标分布的整体尺度进行良好调整。马尔可夫链将停留在其初始位置 $x_0 = -10$ 或其附近。\n\nC. 提议移动的接受率将非常高（接近 1）。生成的样本将充分探索对应于 $x=-10$ 处峰的区域，但马尔可夫链将无法转换到位于 $x=10$ 的另一个峰。样本均值将约为 -10。\n\nD. 采样器将有效地探索整个状态空间。马尔可夫链将在两个峰之间频繁来回跳跃，样本的直方图将正确地形成以 $x=-10$ 和 $x=10$ 为中心的两个不同峰。\n\nE. 采样器的行为将像一个简单的随机游走，导致样本从起始点扩散开去。最终的样本集合将大致均匀地分布在以 $x=-10$ 为中心的宽区间内。", "solution": "我们将目标建模为两个高斯密度的等权重混合，它们具有共同的标准差 $\\sigma_{mode}$ 和均值 $\\mu_{A}$、$\\mu_{B}$。在不考虑比例常数的情况下，\n$$\n\\pi(x) \\propto \\exp\\!\\left(-\\frac{(x-\\mu_{A})^{2}}{2\\sigma_{mode}^{2}}\\right) + \\exp\\!\\left(-\\frac{(x-\\mu_{B})^{2}}{2\\sigma_{mode}^{2}}\\right).\n$$\n对于使用对称高斯提议 $q(x' \\mid x)=\\mathcal{N}(x,\\sigma_{step}^{2})$ 的随机游走 Metropolis 采样器，在状态 $x_{t}$ 对提议 $x'$ 的 Metropolis–Hastings 接受概率为\n$$\n\\alpha(x_{t},x')=\\min\\!\\left(1,\\frac{\\pi(x')}{\\pi(x_{t})}\\right).\n$$\n\n在 $x_{0}=\\mu_{A}$ 处初始化。由于两个峰是良好分离的，当 $x$ 接近 $\\mu_{A}$ 时，$\\pi(x)$ 中来自 $\\mu_{B}$ 分量的贡献相对于来自 $\\mu_{A}$ 分量的贡献可以忽略不计。对于一个小的提议增量 $\\epsilon:=x'-x$ 且满足 $|\\epsilon| \\ll \\sigma_{mode}$，主导比率近似给出\n$$\n\\frac{\\pi(x')}{\\pi(x)} \\approx \\frac{\\exp\\!\\left(-\\frac{(x'-\\mu_{A})^{2}}{2\\sigma_{mode}^{2}}\\right)}{\\exp\\!\\left(-\\frac{(x-\\mu_{A})^{2}}{2\\sigma_{mode}^{2}}\\right)}=\\exp\\!\\left(-\\frac{(x'-\\mu_{A})^{2}-(x-\\mu_{A})^{2}}{2\\sigma_{mode}^{2}}\\right).\n$$\n在 $x\\approx\\mu_{A}$ 处，对于小的 $\\epsilon$，这可以简化为\n$$\n\\frac{\\pi(x')}{\\pi(x)} \\approx \\exp\\!\\left(-\\frac{\\epsilon^{2}}{2\\sigma_{mode}^{2}}\\right),\n$$\n因此，当 $\\sigma_{step} \\ll \\sigma_{mode}$ 时，接受概率接近 $1$，因为典型的 $|\\epsilon|$ 与 $\\sigma_{step}$ 是同个量级。因此，当马尔可夫链探索起始峰附近区域时，接受率非常高。\n\n在一次提议中从 $\\mu_{A}$ 的邻域直接跳到 $\\mu_{B}$ 的邻域，需要一个量级为 $|\\mu_{B}-\\mu_{A}|$ 的位移。在一个方差为 $\\sigma_{step}^{2}$ 的高斯提议下，这种跳跃的概率量级为\n$$\n\\exp\\!\\left(-\\frac{(\\mu_{B}-\\mu_{A})^{2}}{2\\sigma_{step}^{2}}\\right),\n$$\n当 $|\\mu_{B}-\\mu_{A}| \\gg \\sigma_{step}$ 时，这个概率是可以忽略的。\n\n在有限的运行次数内，通过许多小的被接受的步长来穿过低密度区域的可能性也极低，因为在谷底的平稳密度比在峰值处呈指数级小。在中点 $x^{\\star}=(\\mu_{A}+\\mu_{B})/2$ 处，目标密度为\n$$\n\\pi(x^{\\star}) \\propto 2\\exp\\!\\left(-\\frac{(\\mu_{B}-\\mu_{A})^{2}}{8\\sigma_{mode}^{2}}\\right),\n$$\n而在 $x=\\mu_{A}$ 附近，密度为 $\\pi(\\mu_{A}) \\propto 1$（那里的另一个分量可以忽略不计）。因此，比率为\n$$\n\\frac{\\pi(x^{\\star})}{\\pi(\\mu_{A})} \\approx 2\\exp\\!\\left(-\\frac{(\\mu_{B}-\\mu_{A})^{2}}{8\\sigma_{mode}^{2}}\\right)\n$$\n当 $|\\mu_{B}-\\mu_{A}| \\gg \\sigma_{mode}$ 时，该比率是指数级小的。这意味着到达谷底或另一个峰的期望时间是指数级大的，量级为该比率的倒数，当分离很大且提议非常局部时，这远远超过了给定的 $N$。\n\n因此，当选择的 $\\sigma_{step}$ 相对于 $\\sigma_{mode}$ 非常小，并且峰是良好分离的，马尔可夫链具有非常高的接受率，会充分探索起始峰 $x=\\mu_{A}$ 周围的局部盆地，在运行期间基本上永远不会转换到另一个峰，并且得到的样本均值约等于 $\\mu_{A}$。在这些选项中，这对应于陈述 C。", "answer": "$$\\boxed{C}$$", "id": "1932795"}]}