{"hands_on_practices": [{"introduction": "控制变量法是方差缩减的基石，它利用一个具有已知均值的相关变量来提高估计的精度。第一个实践练习将带你深入该技术的核心机制，要求你为一个给定的控制变量计算理论上的最优系数 $b^*$。通过完成这一推导，你将具体理解如何从数学上利用相关性来提升模拟效率 [@problem_id:1348947]。", "problem": "在蒙特卡洛方法中，一个常见的任务是估计积分 $I = \\int_a^b g(x) dx$ 的值。这通常通过将积分重新表述为一个期望值 $E[f(X)]$ 来实现，其中 $X$ 是一个随机变量，$f$ 是一个相关函数。然后，一个标准的“粗略”蒙特卡洛估计量使用 $f(X_i)$ 的 $N$ 次独立抽样的样本均值。\n\n为了在给定样本数量的情况下提高估计的精度，可以采用方差缩减技术。其中一种技术是控制变量法。这涉及找到一个与 $f(X)$ 相关且期望 $\\mu_C = E[C]$ 已知的随机变量 $C$。然后构造一个新的、改进的估计量 $Z(b) = f(X) - b(C - \\mu_C)$，其中 $b$ 是一个常数系数。选择 $b$ 的值以最小化 $Z(b)$ 的方差。这个最优系数，记为 $b^*$，由以下公式给出：\n$$b^* = \\frac{\\text{Cov}(f(X), C)}{\\text{Var}(C)}$$\n\n考虑估计积分 $I = \\int_0^1 \\cos\\left(\\frac{\\pi x}{2}\\right) dx$ 的问题。这等价于求 $Y = \\cos\\left(\\frac{\\pi X}{2}\\right)$ 的期望值，其中 $X$ 是在区间 $[0, 1]$ 上均匀分布的随机变量。我们将使用随机变量 $C = X$ 作为控制变量，因为它与 $Y$ 相关，并且其性质很容易确定。\n\n你的任务是计算该控制变量的最优系数 $b^*$ 的精确理论值。请将答案表示为关于 $\\pi$ 的单个闭式解析表达式。", "solution": "我们有 $X \\sim \\text{Unif}[0,1]$，$Y=\\cos\\left(\\frac{\\pi X}{2}\\right)$，以及 $C=X$。最优控制变量系数为\n$$\nb^{*}=\\frac{\\text{Cov}(Y,C)}{\\text{Var}(C)}.\n$$\n首先计算 $\\text{Var}(C)$。使用 $E[X]=\\int_{0}^{1}x\\,dx=\\frac{1}{2}$ 和 $E[X^{2}]=\\int_{0}^{1}x^{2}\\,dx=\\frac{1}{3}$，我们得到\n$$\n\\text{Var}(C)=E[X^{2}]-\\left(E[X]\\right)^{2}=\\frac{1}{3}-\\frac{1}{4}=\\frac{1}{12}.\n$$\n接下来计算 $E[Y]$：\n$$\nE[Y]=\\int_{0}^{1}\\cos\\left(\\frac{\\pi x}{2}\\right)\\,dx=\\left.\\frac{2}{\\pi}\\sin\\left(\\frac{\\pi x}{2}\\right)\\right|_{0}^{1}=\\frac{2}{\\pi}.\n$$\n现在计算 $E[CY]=E\\!\\left[X\\cos\\left(\\frac{\\pi X}{2}\\right)\\right]$。令 $a=\\frac{\\pi}{2}$。那么\n$$\nE[CY]=\\int_{0}^{1}x\\cos(ax)\\,dx.\n$$\n使用分部积分法，令 $u=x$，$dv=\\cos(ax)\\,dx$，则 $du=dx$ 且 $v=\\frac{1}{a}\\sin(ax)$，我们得到\n$$\n\\int x\\cos(ax)\\,dx=\\frac{x\\sin(ax)}{a}+\\frac{\\cos(ax)}{a^{2}}.\n$$\n从 $0$ 到 $1$ 进行定积分，\n$$\n\\int_{0}^{1}x\\cos(ax)\\,dx=\\frac{\\sin(a)}{a}+\\frac{\\cos(a)-1}{a^{2}}.\n$$\n当 $a=\\frac{\\pi}{2}$ 时，我们有 $\\sin(a)=1$ 且 $\\cos(a)=0$，因此\n$$\nE[CY]=\\frac{1}{a}-\\frac{1}{a^{2}}=\\frac{2}{\\pi}-\\frac{4}{\\pi^{2}}.\n$$\n因此，\n$$\n\\text{Cov}(Y,C)=E[CY]-E[Y]E[C]=\\left(\\frac{2}{\\pi}-\\frac{4}{\\pi^{2}}\\right)-\\left(\\frac{2}{\\pi}\\right)\\left(\\frac{1}{2}\\right)=\\frac{1}{\\pi}-\\frac{4}{\\pi^{2}}=\\frac{\\pi-4}{\\pi^{2}}.\n$$\n最后，\n$$\nb^{*}=\\frac{\\text{Cov}(Y,C)}{\\text{Var}(C)}=\\frac{\\frac{\\pi-4}{\\pi^{2}}}{\\frac{1}{12}}=\\frac{12(\\pi-4)}{\\pi^{2}}.\n$$", "answer": "$$\\boxed{\\frac{12(\\pi - 4)}{\\pi^{2}}}$$", "id": "1348947"}, {"introduction": "对于标准的蒙特卡洛方法而言，估计稀有事件的概率是一个巨大的挑战。重要性抽样通过改变底层的概率分布，使稀有事件更频繁地发生，从而提供了一个强大的解决方案。本练习将重点从计算转向策略设计，要求你选择最合适的“加权”分布，以高效地估计一个罕见结果的概率，这在风险分析和可靠性工程中是一项至关重要的技能 [@problem_id:1348967]。", "problem": "在一个蒙特卡罗模拟练习中，我们旨在估计一个概率 $p$。该概率是指一个标准的六面公平骰子独立投掷20次后，其结果之和超过100的概率。令 $X_i$（其中 $i=1, \\dots, 20$）为第 $i$ 次投掷的结果，因此 $X_i$ 是一个在集合 $\\{1, 2, 3, 4, 5, 6\\}$上均匀分布的随机变量。我们关心的是 $p = P(\\sum_{i=1}^{20} X_i > 100)$。\n\n由于这是一个稀有事件，朴素的蒙特卡罗模拟效率低下。为了提高效率，我们可以使用重要性采样，这是一种方差缩减技术。这涉及到从一个不同的、“加权的”概率质量函数（PMF）（我们称之为 $q(k)$）中对每次骰子投掷进行采样，而不是从原始的均匀PMF $p(k) = 1/6$ 中采样。\n\n对于单次骰子投掷（其中 $k \\in \\{1, 2, 3, 4, 5, 6\\}$），以下哪个加权PMF $q(k)$ 的选择是实施重要性采样以低方差估计 $p$ 的最合适的选择？\n\nA. $q(k) = \\frac{1}{6}$ 对于 $k \\in \\{1, 2, 3, 4, 5, 6\\}$\n\nB. $q(k) = \\frac{7-k}{21}$ 对于 $k \\in \\{1, 2, 3, 4, 5, 6\\}$\n\nC. $q(k) = \\frac{1}{3}$ 对于 $k \\in \\{4, 5, 6\\}$ 及 $q(k) = 0$ 对于 $k \\in \\{1, 2, 3\\}$\n\nD. $q(k) = \\frac{k}{21}$ 对于 $k \\in \\{1, 2, 3, 4, 5, 6\\}$", "solution": "令 $X_{1},\\dots,X_{20}$ 在 $\\{1,2,3,4,5,6\\}$ 上独立同分布（i.i.d.），其名义PMF为 $p(k)=\\frac{1}{6}$，并令 $S=\\sum_{i=1}^{20}X_{i}$。我们想求 $p^{\\star}=P(S>100)$。重要性采样通过从一个定义在 $\\{1,\\dots,6\\}$ 上的提议PMF $q$ 中抽取独立同分布的样本 $Y_{1},\\dots,Y_{20}$，并使用无偏估计量来估计 $p^{\\star}$\n$$\n\\widehat{p}=\\mathbf{1}\\{Y_{1}+\\cdots+Y_{20}>100\\}\\prod_{i=1}^{20}\\frac{p(Y_{i})}{q(Y_{i})}.\n$$\n无偏性要求限制在稀有事件集上的 $p$ 相对于 $q$ 是绝对连续的，在这里这等同于对于任何可能出现在构成 $S>100$ 的序列中的 $k\\in\\{1,\\dots,6\\}$，都有 $q(k)>0$。由于在 $\\{S>100\\}$ 中存在包含 $1,2,3,4,5,6$ 中任意值的序列，我们需要对所有 $k\\in\\{1,\\dots,6\\}$ 都有 $q(k)>0$。\n\n对于稀有事件 $S>100$ 的方差缩减，需要提议的分布能使大的结果更容易出现，从而增加 $P_{q}(S>100)$，同时保持似然比稳定。对于单次投掷，似然比为 $L(k)=\\frac{p(k)}{q(k)}$。对于由大的 $k$ 主导的稀有事件，$L(k)$ 随 $k$ 减小是有利的，这样事件的典型样本会获得较小的权重，从而减小方差。从启发式角度看，最优的提议分布是一个指数倾斜分布 $q_{\\theta}(k)\\propto p(k)\\exp(\\theta k)$，其中 $\\theta>0$，它将更多的概率质量放在较大的 $k$ 上，并且具有完全支撑集。\n\n评估每个选项：\n\nA. $q(k)=\\frac{1}{6}$。这是名义PMF。它不提供任何方差缩减，因此对于稀有事件而言不是最合适的。\n\nB. $q(k)=\\frac{7-k}{21}$。这个提议分布偏好小的 $k$（因为 $q(1)>\\cdots>q(6)$），这将概率质量从稀有事件区域移开。其单次投掷的似然比是\n$$\nL_{B}(k)=\\frac{\\frac{1}{6}}{\\frac{7-k}{21}}=\\frac{7}{2(7-k)},\n$$\n它随着 $k$ 的增加而增加，给予在 $S>100$ 条件下典型的大结果以大的权重，从而增大了方差。这是不合适的。\n\nC. $q(k)=\\frac{1}{3}$ 对于 $k\\in\\{4,5,6\\}$ 且 $q(k)=0$ 对于 $k\\in\\{1,2,3\\}$。虽然这极大地偏好大的点数，但它违反了绝对连续性要求，因为存在 $S>100$ 的序列，其中包含 $\\{1,2,3\\}$ 中的值，这些序列在 $p$ 下具有正概率，但在 $q$ 下概率为零。因此，$\\prod_{i}p(Y_{i})/q(Y_{i})$ 在整个稀有事件集上没有良好定义，无法用这个 $q$ 构建一个对 $P(S>100)$ 的无偏重要性采样（IS）估计量。\n\nD. $q(k)=\\frac{k}{21}$。这个提议分布偏好大的 $k$，同时保持了完全支撑集。其单次投掷的似然比是\n$$\nL_{D}(k)=\\frac{\\frac{1}{6}}{\\frac{k}{21}}=\\frac{7}{2k},\n$$\n它随着 $k$ 的增加而减小，因此事件的典型样本会获得较小的权重，从而稳定了估计量并减小了方差。此外，每个PMF下的期望值证实了倾斜的方向：\n$$\n\\mathbb{E}_{p}[X]=\\frac{1+2+3+4+5+6}{6}=\\frac{7}{2},\\quad\n\\mathbb{E}_{B}[X]=\\frac{7\\sum_{k=1}^{6}k-\\sum_{k=1}^{6}k^{2}}{21}=\\frac{56}{21}=\\frac{8}{3}<\\frac{7}{2},\n$$\n$$\n\\mathbb{E}_{C}[X]=\\frac{4+5+6}{3}=5\\quad\\text{（但 $q$ 有零值，对于无偏IS无效）},\n$$\n$$\n\\mathbb{E}_{D}[X]=\\frac{\\sum_{k=1}^{6}k^{2}}{21}=\\frac{91}{21}=\\frac{13}{3}>\\frac{7}{2}.\n$$\n因此，D向正确的方向倾斜，保留了完全支撑集，并且对于大的 $k$ 产生了更小的似然比，所有这些都有助于在估计 $P(S>100)$ 时获得更低的方差。\n\n因此，在给定的选项中，D是用于低方差重要性采样的最合适的选择。", "answer": "$$\\boxed{D}$$", "id": "1348967"}, {"introduction": "对偶变量技术通常被认为是一种简单而有效的方差缩减方法，尤其适用于单调函数。然而，在高维情况下，其有效性可能会出人意料地微妙。这个进阶问题展示了一个精心构建的场景，其中对偶变量的简单应用未能减少方差，而更有针对性的“部分”应用却取得了显著成功，这揭示了采样方案与收益函数几何结构之间相互作用的深刻见解 [@problem_id:2446736]。", "problem": "考虑独立随机变量 $U_{1}$ 和 $U_{2}$，两者均在 $[0,1]$ 上均匀分布。定义二维收益函数 $\\pi(U_{1},U_{2}) = (U_{1} - \\tfrac{1}{2})(U_{2} - \\tfrac{1}{2})$，以及目标量 $\\mu = \\mathbb{E}[\\pi(U_{1},U_{2})]$。按如下方式构造 $\\mu$ 的两个配对样本估计量，每个估计量使用单一样本对生成一个观测值：\n- 方案 F (完全对偶配对)：对两个评估值 $\\pi(U_{1},U_{2})$ 和 $\\pi(1-U_{1},1-U_{2})$ 求平均。\n- 方案 P (部分对偶配对)：对两个评估值 $\\pi(U_{1},U_{2})$ 和 $\\pi(U_{1},1-U_{2})$ 求平均。\n设 $\\mathrm{Var}_{F}$ 为方案 F 下单一样本对估计量的方差，$\\mathrm{Var}_{P}$ 为方案 P 下单一样本对估计量的方差，两者均是关于 $(U_{1},U_{2})$ 的联合分布计算的。\n\n计算差值 $\\Delta = \\mathrm{Var}_{F} - \\mathrm{Var}_{P}$。请以精确值的形式给出答案，无需四舍五入。", "solution": "首先，我们分析随机变量和收益函数的基本性质。然后，我们推导估计量 $Y_{F}$ 和 $Y_{P}$ 的显式形式，并计算它们各自的方差 $\\mathrm{Var}_{F}$ 和 $\\mathrm{Var}_{P}$。最后，我们计算它们的差值 $\\Delta$。\n\n设 $U$ 是一个在 $[0,1]$ 上均匀分布的随机变量。其期望值为 $\\mathbb{E}[U] = \\frac{1}{2}$，其方差为 $\\mathrm{Var}(U) = \\frac{(1-0)^{2}}{12} = \\frac{1}{12}$。\n目标量是 $\\mu = \\mathbb{E}[\\pi(U_{1},U_{2})]$。我们首先计算这个量。\n$$ \\mu = \\mathbb{E}\\left[\\left(U_{1} - \\frac{1}{2}\\right)\\left(U_{2} - \\frac{1}{2}\\right)\\right] $$\n由于 $U_{1}$ 和 $U_{2}$ 是独立的，因此积的期望等于期望的积：\n$$ \\mu = \\mathbb{E}\\left[U_{1} - \\frac{1}{2}\\right] \\mathbb{E}\\left[U_{2} - \\frac{1}{2}\\right] $$\n对于每个 $i \\in \\{1,2\\}$，我们有 $\\mathbb{E}\\left[U_{i} - \\frac{1}{2}\\right] = \\mathbb{E}[U_{i}] - \\frac{1}{2} = \\frac{1}{2} - \\frac{1}{2} = 0$。\n因此，$\\mu = 0 \\times 0 = 0$。这些估计量期望得到的值是 0。\n\n接下来，我们分析方案 F（完全对偶配对）的估计量：\n$$ Y_{F} = \\frac{1}{2}[\\pi(U_{1},U_{2}) + \\pi(1-U_{1},1-U_{2})] $$\n我们计算和中的第二项。一个 $\\mathcal{U}[0,1]$ 变量 $U$ 的对偶变换是 $1-U$，它也服从 $\\mathcal{U}[0,1]$ 分布。\n$$ \\pi(1-U_{1},1-U_{2}) = \\left((1-U_{1}) - \\frac{1}{2}\\right)\\left((1-U_{2}) - \\frac{1}{2}\\right) = \\left(\\frac{1}{2}-U_{1}\\right)\\left(\\frac{1}{2}-U_{2}\\right) $$\n$$ = \\left(-\\left(U_{1}-\\frac{1}{2}\\right)\\right)\\left(-\\left(U_{2}-\\frac{1}{2}\\right)\\right) = \\left(U_{1}-\\frac{1}{2}\\right)\\left(U_{2}-\\frac{1}{2}\\right) = \\pi(U_{1},U_{2}) $$\n将此代回 $Y_{F}$ 的表达式中：\n$$ Y_{F} = \\frac{1}{2}[\\pi(U_{1},U_{2}) + \\pi(U_{1},U_{2})] = \\pi(U_{1},U_{2}) $$\n因此，对于这个特定的收益函数，完全对偶估计量与原始随机变量相同。\n因此方差为：\n$$ \\mathrm{Var}_{F} = \\mathrm{Var}(Y_{F}) = \\mathrm{Var}(\\pi(U_{1},U_{2})) $$\n由于 $\\mathbb{E}[\\pi(U_{1},U_{2})] = \\mu = 0$，方差是其平方的期望：\n$$ \\mathrm{Var}(\\pi(U_{1},U_{2})) = \\mathbb{E}[(\\pi(U_{1},U_{2}))^{2}] = \\mathbb{E}\\left[\\left(\\left(U_{1} - \\frac{1}{2}\\right)\\left(U_{2} - \\frac{1}{2}\\right)\\right)^{2}\\right] = \\mathbb{E}\\left[\\left(U_{1} - \\frac{1}{2}\\right)^{2}\\left(U_{2} - \\frac{1}{2}\\right)^{2}\\right] $$\n由于 $U_{1}$ 和 $U_{2}$ 的独立性，我们可以将期望分开：\n$$ \\mathrm{Var}_{F} = \\mathbb{E}\\left[\\left(U_{1} - \\frac{1}{2}\\right)^{2}\\right] \\mathbb{E}\\left[\\left(U_{2} - \\frac{1}{2}\\right)^{2}\\right] $$\n项 $\\mathbb{E}\\left[\\left(U_{i} - \\frac{1}{2}\\right)^{2}\\right]$ 是 $U_{i}$ 的方差，因为 $\\mathbb{E}[U_{i}] = \\frac{1}{2}$。\n$$ \\mathbb{E}\\left[\\left(U_{i} - \\frac{1}{2}\\right)^{2}\\right] = \\mathrm{Var}(U_{i}) = \\frac{1}{12} $$\n因此，方案 F 的方差为：\n$$ \\mathrm{Var}_{F} = \\left(\\frac{1}{12}\\right)\\left(\\frac{1}{12}\\right) = \\frac{1}{144} $$\n\n现在，我们分析方案 P（部分对偶配对）的估计量：\n$$ Y_{P} = \\frac{1}{2}[\\pi(U_{1},U_{2}) + \\pi(U_{1},1-U_{2})] $$\n我们计算和中的第二项：\n$$ \\pi(U_{1},1-U_{2}) = \\left(U_{1} - \\frac{1}{2}\\right)\\left((1-U_{2}) - \\frac{1}{2}\\right) = \\left(U_{1} - \\frac{1}{2}\\right)\\left(\\frac{1}{2}-U_{2}\\right) $$\n$$ = -\\left(U_{1} - \\frac{1}{2}\\right)\\left(U_{2} - \\frac{1}{2}\\right) = -\\pi(U_{1},U_{2}) $$\n将此代回 $Y_{P}$ 的表达式中：\n$$ Y_{P} = \\frac{1}{2}[\\pi(U_{1},U_{2}) - \\pi(U_{1},U_{2})] = 0 $$\n方案 P 的估计量是一个常数 0。常数的方差恒为 0。\n$$ \\mathrm{Var}_{P} = \\mathrm{Var}(Y_{P}) = \\mathrm{Var}(0) = 0 $$\n这表明，对于这个特定的收益函数，部分对偶配对产生一个方差为零的完美估计量。\n\n最后，我们计算差值 $\\Delta$：\n$$ \\Delta = \\mathrm{Var}_{F} - \\mathrm{Var}_{P} = \\frac{1}{144} - 0 = \\frac{1}{144} $$\n方差的差值为 $\\frac{1}{144}$。", "answer": "$$\\boxed{\\frac{1}{144}}$$", "id": "2446736"}]}