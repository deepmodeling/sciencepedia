{"hands_on_practices": [{"introduction": "掌握 Metropolis-Hastings 算法的第一步是熟练计算其核心——接受概率。本练习使用离散的泊松分布（Poisson distribution），提供了一个清晰、简单的场景来实践这一基本计算。通过这个练习，你将直接应用接受概率公式，这是算法中决定是接受还是拒绝新状态的关键步骤。[@problem_id:1962612]", "problem": "一位统计学家正在实现一个马尔可夫链蒙特卡洛 (MCMC) 模拟，用以从一个目标概率分布中生成样本。所选的目标分布是泊松分布，该分布用于模拟在固定时间或空间间隔内发生的事件数 $k$。泊松分布的概率质量函数由下式给出：\n$$ P(k; \\lambda) = \\frac{\\lambda^k e^{-\\lambda}}{k!} $$\n其中 $\\lambda$ 是事件的平均发生率。对于本次特定的模拟，参数设定为 $\\lambda = 5$。\n\n该模拟使用带有对称提议分布的 Metropolis-Hastings 算法，这意味着从状态 $k_1$ 提议转移到状态 $k_2$ 的概率与从 $k_2$ 提议转移到 $k_1$ 的概率相同。\n\n假设链的当前状态是 $k=5$。算法接着提议转移到一个新状态 $k'=6$。\n\n计算从 $k=5$ 到 $k'=6$ 这一提议转移的接受概率。将答案表示为小数，并四舍五入到三位有效数字。", "solution": "在采用对称提议分布的 Metropolis-Hastings 算法中，从状态 $k$ 提议转移到状态 $k'$ 的接受概率 $\\alpha$ 为\n$$\n\\alpha = \\min\\left(1, \\frac{\\pi(k')}{\\pi(k)}\\right),\n$$\n其中 $\\pi(\\cdot)$ 是目标概率质量函数。对于参数为 $\\lambda$ 的泊松分布，其概率质量函数（PMF）为\n$$\n\\pi(k) = \\frac{\\lambda^{k} \\exp(-\\lambda)}{k!}.\n$$\n因此，该比率可简化为\n$$\n\\frac{\\pi(k')}{\\pi(k)} = \\frac{\\lambda^{k'} \\exp(-\\lambda) / k'!}{\\lambda^{k} \\exp(-\\lambda) / k!} = \\lambda^{k'-k} \\frac{k!}{k'!}.\n$$\n当 $k=5$，$k'=6$ 且 $\\lambda=5$ 时，我们有 $k'-k=1$ 且 $6! = 6 \\cdot 5!$，所以\n$$\n\\frac{\\pi(6)}{\\pi(5)} = \\lambda \\cdot \\frac{5!}{6!} = \\lambda \\cdot \\frac{1}{6} = \\frac{5}{6}.\n$$\n因此，接受概率为\n$$\n\\alpha = \\min\\left(1, \\frac{5}{6}\\right) = \\frac{5}{6}.\n$$\n表示为小数并四舍五入到三位有效数字，结果是 $0.833$。", "answer": "$$\\boxed{0.833}$$", "id": "1962612"}, {"introduction": "在掌握了基本计算之后，理解算法的微妙之处至关重要。本练习是一个思想实验，旨在揭示一个常见的陷阱：当提议分布不对称时，错误地使用简化的 Metropolis 接受准则会发生什么。通过计算由此产生的（不正确的）平稳分布，你将更深刻地理解为什么完整的 Metropolis-Hastings 校正项对于确保算法收敛到正确的目标分布是必不可少的。[@problem_id:1343405]", "problem": "一位分析师正在实现一个马尔可夫链蒙特卡洛 (MCMC) 算法，用于从一个定义在三个状态 $S_1$、$S_2$ 和 $S_3$ 上的离散目标概率分布 $\\pi$ 中抽样。目标分布由下式给出：\n$$\n\\pi(S_1) = \\frac{1}{2}, \\quad \\pi(S_2) = \\frac{1}{3}, \\quad \\pi(S_3) = \\frac{1}{6}\n$$\n该分析师设计了一个确定性的循环提议机制，由提议分布 $Q(x,y)$ 描述。从状态 $S_i$ 出发，它总是提议循环 $S_1 \\to S_2 \\to S_3 \\to S_1$ 中的下一个状态。具体来说，非零的提议概率为 $Q(S_1, S_2) = 1$，$Q(S_2, S_3) = 1$ 和 $Q(S_3, S_1) = 1$。\n\n然而，在设置接受概率 $\\alpha(x,y)$ 时，该分析师错误地使用了简化的 Metropolis 接受准则：\n$$\n\\alpha(x,y) = \\min\\left(1, \\frac{\\pi(y)}{\\pi(x)}\\right)\n$$\n该准则通常仅在提议分布 $Q(x,y)$ 是对称的情况下才有效。\n\n由此产生的马尔可夫链收敛到一个平稳分布，我们称之为 $\\pi'$，它与预期的目标分布 $\\pi$ 不同。计算该链处于状态 $S_2$ 的长期概率。将您的答案表示为最简分数。", "solution": "我们根据确定性提议和错误的 Metropolis 接受准则构建马尔可夫链。对于状态 $S_{1}, S_{2}, S_{3}$，提议为 $S_{1}\\to S_{2}\\to S_{3}\\to S_{1}$，且使用的接受概率为\n$$\n\\alpha(x,y)=\\min\\left(1,\\frac{\\pi(y)}{\\pi(x)}\\right).\n$$\n已知 $\\pi(S_{1})=\\frac{1}{2}$，$\\pi(S_{2})=\\frac{1}{3}$ 和 $\\pi(S_{3})=\\frac{1}{6}$，对于提议的移动，其接受概率为：\n$$\n\\alpha(S_{1},S_{2})=\\min\\left(1,\\frac{\\pi(S_{2})}{\\pi(S_{1})}\\right)=\\min\\left(1,\\frac{\\frac{1}{3}}{\\frac{1}{2}}\\right)=\\frac{2}{3},\n$$\n$$\n\\alpha(S_{2},S_{3})=\\min\\left(1,\\frac{\\pi(S_{3})}{\\pi(S_{2})}\\right)=\\min\\left(1,\\frac{\\frac{1}{6}}{\\frac{1}{3}}\\right)=\\frac{1}{2},\n$$\n$$\n\\alpha(S_{3},S_{1})=\\min\\left(1,\\frac{\\pi(S_{1})}{\\pi(S_{3})}\\right)=\\min\\left(1,\\frac{\\frac{1}{2}}{\\frac{1}{6}}\\right)=1.\n$$\n因此，转移概率（接受提议或停留在原状态）为：\n- 从 $S_{1}$ 出发：$P(S_{1}\\to S_{2})=\\frac{2}{3}$，$P(S_{1}\\to S_{1})=\\frac{1}{3}$。\n- 从 $S_{2}$ 出发：$P(S_{2}\\to S_{3})=\\frac{1}{2}$，$P(S_{2}\\to S_{2})=\\frac{1}{2}$。\n- 从 $S_{3}$ 出发：$P(S_{3}\\to S_{1})=1$。\n\n因此，按 $(S_{1},S_{2},S_{3})$ 顺序排列的转移矩阵 $P$ 为\n$$\nP=\\begin{pmatrix}\n\\frac{1}{3} & \\frac{2}{3} & 0 \\\\\n0 & \\frac{1}{2} & \\frac{1}{2} \\\\\n1 & 0 & 0\n\\end{pmatrix}.\n$$\n设平稳分布为 $\\pi'=(a,b,c)$，满足 $a+b+c=1$ 且 $\\pi'=\\pi'P$。平稳性方程组为：\n$$\na=a\\cdot\\frac{1}{3}+b\\cdot 0+c\\cdot 1,\\quad\nb=a\\cdot\\frac{2}{3}+b\\cdot\\frac{1}{2}+c\\cdot 0,\\quad\nc=a\\cdot 0+b\\cdot\\frac{1}{2}+c\\cdot 0.\n$$\n由第三个方程可得 $c=\\frac{b}{2}$。由第一个方程可得 $a=\\frac{a}{3}+c$，因此 $c=a-\\frac{a}{3}=\\frac{2a}{3}$。令两个关于 $c$ 的表达式相等，可得 $\\frac{b}{2}=\\frac{2a}{3}$，所以 $b=\\frac{4a}{3}$。将 $b$ 和 $c$ 用 $a$ 的表达式代入 $a+b+c=1$ 可得\n$$\na+\\frac{4a}{3}+\\frac{2a}{3}=a+2a=3a=1\\quad\\Rightarrow\\quad a=\\frac{1}{3},\n$$\n因此\n$$\nb=\\frac{4}{9},\\qquad c=\\frac{2}{9}.\n$$\n因此，处于状态 $S_{2}$ 的长期概率为 $b=\\frac{4}{9}$。", "answer": "$$\\boxed{\\frac{4}{9}}$$", "id": "1343405"}, {"introduction": "仅仅保证算法的正确性是不够的，我们还追求其效率。本练习将带你进入一个更高级也更具实践性的挑战：如何设计一个能有效探索相关目标分布的提议分布。通过比较两种不同的提议策略，你将亲眼见证，根据目标分布的几何特性“量身定制”提议分布，能够如何显著地提升采样器的性能。[@problem_id:1962663]", "problem": "一位统计学家正在使用 Metropolis-Hastings 算法从 $\\mathbb{R}^2$ 上的一个二元目标分布中进行抽样，该分布的概率密度函数 (PDF) $\\pi(x, y)$ 正比于\n$$\n\\pi(x, y) \\propto \\exp\\left(-\\frac{x^2 - 2\\rho xy + y^2}{2(1-\\rho^2)}\\right)\n$$\n其中 $\\rho$ 是一个常数相关参数，满足 $0 < \\rho < 1$。\n\n马尔可夫链的当前状态为 $(X_t, Y_t) = (c, c)$，其中 $c$ 是一个正常数。考虑使用两种不同的对称随机游走提议方案来生成一个候选状态 $(X', Y')$。\n\n**方案 1：** 生成一个提议状态 $(X'_1, Y'_1)$，使得移动的步长为 $(X'_1 - X_t, Y'_1 - Y_t) = (\\epsilon, -\\epsilon)$，其中 $\\epsilon$ 是某个小的正常数。因此，提议状态为 $(X'_1, Y'_1) = (c+\\epsilon, c-\\epsilon)$。\n\n**方案 2：** 生成一个提议状态 $(X'_2, Y'_2)$，使得移动的步长为 $(X'_2 - X_t, Y'_2 - Y_t) = (\\epsilon, \\epsilon)$，使用相同的常数 $\\epsilon$。因此，提议状态为 $(X'_2, Y'_2) = (c+\\epsilon, c+\\epsilon)$。\n\n令 $\\alpha_1$ 为方案 1 下提议的 Metropolis-Hastings 接受概率，$\\alpha_2$ 为方案 2 下提议的接受概率。确定比率 $R = \\frac{\\alpha_2}{\\alpha_1}$。请用一个关于 $c$、$\\epsilon$ 和 $\\rho$ 的闭式解析表达式来表示您的答案。", "solution": "对于对称随机游走 Metropolis-Hastings 提议，接受概率为 $\\alpha=\\min\\{1, \\pi(x',y')/\\pi(x,y)\\}$。由于两种方案中的提议都是对称的，因此 Hastings 比率抵消，并且\n$$\n\\frac{\\pi(x',y')}{\\pi(c,c)}=\\exp\\left(E(x',y')-E(c,c)\\right),\n$$\n其中对数密度为\n$$\nE(x,y)=-\\frac{x^{2}-2\\rho xy+y^{2}}{2(1-\\rho^{2})},\n$$\n我们定义\n$$\nQ(x,y)=x^{2}-2\\rho xy+y^{2},\\quad E(x,y)=-\\frac{Q(x,y)}{2(1-\\rho^{2})}.\n$$\n因此\n$$\n\\ln\\left(\\frac{\\pi(x',y')}{\\pi(c,c)}\\right)=-\\frac{Q(x',y')-Q(c,c)}{2(1-\\rho^{2})}.\n$$\n\n在当前状态 $(c,c)$下，\n$$\nQ(c,c)=c^{2}-2\\rho c^{2}+c^{2}=2c^{2}(1-\\rho).\n$$\n\n方案 1：$(x',y')=(c+\\epsilon,c-\\epsilon)$。计算\n$$\nx'^{2}=c^{2}+2c\\epsilon+\\epsilon^{2},\\quad y'^{2}=c^{2}-2c\\epsilon+\\epsilon^{2},\\quad x'y'=c^{2}-\\epsilon^{2}.\n$$\n因此\n$$\nQ_{1}=x'^{2}-2\\rho x'y'+y'^{2}=(2c^{2}+2\\epsilon^{2})-2\\rho(c^{2}-\\epsilon^{2})=2c^{2}(1-\\rho)+2\\epsilon^{2}(1+\\rho).\n$$\n所以\n$$\nQ_{1}-Q(c,c)=2\\epsilon^{2}(1+\\rho),\n$$\n并且\n$$\n\\ln\\left(\\frac{\\pi(x'_{1},y'_{1})}{\\pi(c,c)}\\right)=-\\frac{2\\epsilon^{2}(1+\\rho)}{2(1-\\rho^{2})}=-\\frac{\\epsilon^{2}}{1-\\rho}.\n$$\n由于当 $0<\\rho<1$ 时，该值为负，所以接受概率为\n$$\n\\alpha_{1}=\\exp\\left(-\\frac{\\epsilon^{2}}{1-\\rho}\\right).\n$$\n\n方案 2：$(x',y')=(c+\\epsilon,c+\\epsilon)$。计算\n$$\nx'^{2}=c^{2}+2c\\epsilon+\\epsilon^{2},\\quad y'^{2}=c^{2}+2c\\epsilon+\\epsilon^{2},\\quad x'y'=c^{2}+2c\\epsilon+\\epsilon^{2}.\n$$\n因此\n$$\nQ_{2}=x'^{2}-2\\rho x'y'+y'^{2}=2(1-\\rho)(c^{2}+2c\\epsilon+\\epsilon^{2}),\n$$\n所以\n$$\nQ_{2}-Q(c,c)=2(1-\\rho)(2c\\epsilon+\\epsilon^{2}),\n$$\n并且\n$$\n\\ln\\left(\\frac{\\pi(x'_{2},y'_{2})}{\\pi(c,c)}\\right)=-\\frac{2(1-\\rho)(2c\\epsilon+\\epsilon^{2})}{2(1-\\rho^{2})}=-\\frac{2c\\epsilon+\\epsilon^{2}}{1+\\rho}.\n$$\n当 $c>0$、$\\epsilon>0$、$0<\\rho<1$ 时，该值也为负，所以\n$$\n\\alpha_{2}=\\exp\\left(-\\frac{2c\\epsilon+\\epsilon^{2}}{1+\\rho}\\right).\n$$\n\n因此，比率 $R=\\alpha_{2}/\\alpha_{1}$ 是\n$$\nR=\\exp\\left(-\\frac{2c\\epsilon+\\epsilon^{2}}{1+\\rho}+\\frac{\\epsilon^{2}}{1-\\rho}\\right)\n=\\exp\\left(-\\frac{2c\\epsilon}{1+\\rho}+\\epsilon^{2}\\left[\\frac{1}{1-\\rho}-\\frac{1}{1+\\rho}\\right]\\right)\n=\\exp\\left(-\\frac{2c\\epsilon}{1+\\rho}+\\frac{2\\rho\\,\\epsilon^{2}}{1-\\rho^{2}}\\right).\n$$", "answer": "$$\\boxed{\\exp\\left(\\frac{2\\rho\\,\\epsilon^{2}}{1-\\rho^{2}}-\\frac{2c\\,\\epsilon}{1+\\rho}\\right)}$$", "id": "1962663"}]}