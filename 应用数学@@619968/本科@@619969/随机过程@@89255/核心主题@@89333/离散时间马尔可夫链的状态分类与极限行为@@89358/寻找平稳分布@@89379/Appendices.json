{"hands_on_practices": [{"introduction": "第一个练习将引导你初步掌握计算平稳分布的核心方法。我们将一个简单的双人游戏建模为一个双状态马尔可夫链。这个问题 [@problem_id:1302643] 是一个理想的起点，因为它能让你专注于基本步骤：定义状态，构建转移矩阵 $P$ ，并求解基本的平衡方程 $\\pi P = \\pi$，而不会被复杂的代数问题分散注意力。", "problem": "在一个回合制数字游戏中，两名玩家 Alice 和 Bob 争夺一个特殊令牌的控制权。在一回合开始时拥有该令牌的玩家被指定为该回合的“活跃玩家”。令牌的控制权根据以下概率规则演变：\n\n- 如果 Alice 是活跃玩家，她有 $p_A$ 的概率在下一回合保持对令牌的控制权。如果她未能保持控制权，则令牌将传给 Bob。\n- 如果 Bob 是活跃玩家，他有 $p_B$ 的概率在下一回合保持对令牌的控制权。如果他未能保持控制权，则令牌将传给 Alice。\n\n这些事件的结果在各回合之间是相互独立的。假设游戏已经进行了极大量的回合，并且概率满足 $0 < p_A < 1$ 和 $0 < p_B < 1$。\n\n确定 Alice 作为活跃玩家的回合在长期所占的比例。你的答案应该是一个仅含 $p_A$ 和 $p_B$ 的单一边闭式解析表达式。", "solution": "令系统的状态由持有令牌的玩家决定。我们可以定义两个状态：状态 A，Alice 持有令牌；状态 B，Bob 持有令牌。在此游戏的马尔可夫链模型中，Alice 作为活跃玩家的回合在长期所占的比例对应于处于状态 A 的稳态概率。\n\n令 $\\pi = (\\pi_A, \\pi_B)$ 为稳态分布向量，其中 $\\pi_A$ 是处于状态 A 的长期概率，$\\pi_B$ 是处于状态 B 的长期概率。根据定义，这些概率之和必须为 1：\n$$ \\pi_A + \\pi_B = 1 $$\n\n接下来，我们构建这个两状态系统的转移矩阵 $P$。元素 $P_{ij}$ 表示在一回合内从状态 $i$ 转移到状态 $j$ 的概率。\n\n从状态 A（Alice 持有令牌）的转移如下：\n- 停留在状态 A（Alice 到 Alice）的概率是 Alice 保持控制权的概率，所以 $P_{AA} = p_A$。\n- 转移到状态 B（Alice 到 Bob）的概率是 Alice 未能保持控制权的概率，所以 $P_{AB} = 1 - p_A$。\n\n从状态 B（Bob 持有令牌）的转移如下：\n- 转移到状态 A（Bob 到 Alice）的概率是 Bob 未能保持控制权的概率，所以 $P_{BA} = 1 - p_B$。\n- 停留在状态 B（Bob 到 Bob）的概率是 Bob 保持控制权的概率，所以 $P_{BB} = p_B$。\n\n因此，单步转移矩阵 $P$ 为：\n$$ P = \\begin{pmatrix} P_{AA} & P_{AB} \\\\ P_{BA} & P_{BB} \\end{pmatrix} = \\begin{pmatrix} p_A & 1 - p_A \\\\ 1 - p_B & p_B \\end{pmatrix} $$\n\n稳态分布 $\\pi$ 必须满足方程 $\\pi P = \\pi$。\n$$ (\\pi_A, \\pi_B) \\begin{pmatrix} p_A & 1 - p_A \\\\ 1 - p_B & p_B \\end{pmatrix} = (\\pi_A, \\pi_B) $$\n\n这个矩阵方程产生了一个包含两个线性方程的方程组：\n1. $\\pi_A p_A + \\pi_B (1 - p_B) = \\pi_A$\n2. $\\pi_A (1 - p_A) + \\pi_B p_B = \\pi_B$\n\n这两个方程是线性相关的。我们可以使用其中任意一个方程，结合归一化条件 $\\pi_A + \\pi_B = 1$，来求解 $\\pi_A$ 和 $\\pi_B$。我们使用第一个方程。\n\n从 $\\pi_A p_A + \\pi_B (1 - p_B) = \\pi_A$ 出发，我们可以重新整理各项：\n$$ \\pi_B (1 - p_B) = \\pi_A - \\pi_A p_A $$\n$$ \\pi_B (1 - p_B) = \\pi_A (1 - p_A) $$\n\n现在，将 $\\pi_B = 1 - \\pi_A$ 代入此方程：\n$$ (1 - \\pi_A)(1 - p_B) = \\pi_A (1 - p_A) $$\n\n我们展开两边以求解 $\\pi_A$：\n$$ 1 - p_B - \\pi_A + \\pi_A p_B = \\pi_A - \\pi_A p_A $$\n\n将所有含 $\\pi_A$ 的项移到一边，常数项移到另一边：\n$$ 1 - p_B = \\pi_A - \\pi_A p_A + \\pi_A - \\pi_A p_B $$\n$$ 1 - p_B = \\pi_A (1 - p_A + 1 - p_B) $$\n$$ 1 - p_B = \\pi_A (2 - p_A - p_B) $$\n\n最后，我们分离出 $\\pi_A$：\n$$ \\pi_A = \\frac{1 - p_B}{2 - p_A - p_B} $$\n此表达式给出了 Alice 作为活跃玩家的回合在长期所占的比例。分母 $2-p_A-p_B = (1-p_A) + (1-p_B)$ 是非对角线元素之和，由于 $0 < p_A < 1$ 且 $0 < p_B < 1$，保证其不为零。", "answer": "$$\\boxed{\\frac{1 - p_B}{2 - p_A - p_B}}$$", "id": "1302643"}, {"introduction": "在双状态系统的基础上，这个练习将探索一个具有循环结构的模型。通过分析一个在圆形棋盘上移动的棋子，你将看到一个问题的内在对称性如何导出一个优雅甚至出人意料的平稳分布。这个实践 [@problem_id:1302614] 不仅能巩固你处理稍大尺寸系统的矩阵方法，还能揭示马尔可夫链的结构与其长期行为之间的深刻联系。", "problem": "一个棋子在一个有四个格子的圆形棋盘上移动，这四个格子按顺时针顺序标记为1、2、3和4。系统的状态是棋子当前所在的格子。在每一轮中，无论从哪个格子出发，棋子都有两种可能的移动方式：以概率 $p = 1/3$ 顺时针移动一个格子，或者以概率 $1-p = 2/3$ 顺时针移动两个格子。例如，如果棋子在格子1上，它将以概率 $1/3$ 移动到格子2，或者以概率 $2/3$ 移动到格子3。这个过程定义了一个离散时间马尔可夫链。\n\n假设该过程已经运行了很长时间并达到了稳态，棋子位于奇数号格子（即格子1或格子3）上的概率是多少？\n\n将你的答案表示为最简精确分数。", "solution": "设马尔可夫链的状态空间为 $S = \\{1, 2, 3, 4\\}$，对应于棋盘上的四个格子。题目描述了转移概率。我们可以用一个转移矩阵 $P$ 来表示这些转移，其中元素 $P_{ij}$ 是从状态 $i$ 移动到状态 $j$ 的概率。\n\n移动规则如下：\n- 从状态1：以概率 $p$ 移动到2，或以概率 $1-p$ 移动到3。\n- 从状态2：以概率 $p$ 移动到3，或以概率 $1-p$ 移动到4。\n- 从状态3：以概率 $p$ 移动到4，或以概率 $1-p$ 移动到1（环绕）。\n- 从状态4：以概率 $p$ 移动到1，或以概率 $1-p$ 移动到2。\n\n因此，转移矩阵 $P$ 为：\n$$\nP = \\begin{pmatrix}\n0 & p & 1-p & 0 \\\\\n0 & 0 & p & 1-p \\\\\n1-p & 0 & 0 & p \\\\\np & 1-p & 0 & 0\n\\end{pmatrix}\n$$\n\n“经过很长一段时间后”这句话意味着我们正在寻找该马尔可夫链的平稳分布。平稳分布是一个概率向量 $\\pi = (\\pi_1, \\pi_2, \\pi_3, \\pi_4)$，它满足方程 $\\pi P = \\pi$，并且其分量之和为一：$\\pi_1 + \\pi_2 + \\pi_3 + \\pi_4 = 1$。分量 $\\pi_i$ 表示长期处于状态 $i$ 的概率。\n\n方程 $\\pi P = \\pi$ 给出以下线性方程组：\n1. $\\pi_1 = (1-p) \\pi_3 + p \\pi_4$\n2. $\\pi_2 = p \\pi_1 + (1-p) \\pi_4$\n3. $\\pi_3 = (1-p) \\pi_1 + p \\pi_2$\n4. $\\pi_4 = (1-p) \\pi_2 + p \\pi_3$\n5. $\\pi_1 + \\pi_2 + \\pi_3 + \\pi_4 = 1$\n\n这是一个包含五个方程和四个未知数的方程组。前四个方程中有一个是冗余的。让我们来解这个方程组。我们可以使用代数代入法。\n\n根据方程（3），我们有 $\\pi_3 = (1-p)\\pi_1 + p\\pi_2$。\n将此代入方程（4）：\n$\\pi_4 = (1-p)\\pi_2 + p((1-p)\\pi_1 + p\\pi_2) = p(1-p)\\pi_1 + (1-p+p^2)\\pi_2$。\n\n现在将 $\\pi_3$ 和 $\\pi_4$ 的表达式代入方程（1）：\n$\\pi_1 = (1-p)((1-p)\\pi_1 + p\\pi_2) + p(p(1-p)\\pi_1 + (1-p+p^2)\\pi_2)$\n$\\pi_1 = (1-p)^2 \\pi_1 + p(1-p)\\pi_2 + p^2(1-p)\\pi_1 + p(1-p+p^2)\\pi_2$\n将含有 $\\pi_1$ 和 $\\pi_2$ 的项分组：\n$\\pi_1 (1 - (1-p)^2 - p^2(1-p)) = \\pi_2 (p(1-p) + p(1-p+p^2))$\n$\\pi_1 (1 - (1-2p+p^2) - p^2+p^3) = \\pi_2 (p-p^2 + p-p^2+p^3)$\n$\\pi_1 (2p - 2p^2 + p^3) = \\pi_2 (2p - 2p^2 + p^3)$\n$\\pi_1 p(2 - 2p + p^2) = \\pi_2 p(2 - 2p + p^2)$\n\n对于 $p \\in (0,1)$，项 $p(2-2p+p^2)$ 是非零的（因为 $p^2-2p+2 = (p-1)^2+1 > 0$），所以我们可以两边同除以它，得到 $\\pi_1 = \\pi_2$。\n\n既然我们知道了 $\\pi_1 = \\pi_2$，让我们重新审视原始方程。\n从方程（3）：$\\pi_3 = (1-p)\\pi_1 + p\\pi_2 = (1-p)\\pi_1 + p\\pi_1 = \\pi_1$。\n所以，$\\pi_3 = \\pi_1$。\n从方程（4）：$\\pi_4 = (1-p)\\pi_2 + p\\pi_3 = (1-p)\\pi_1 + p\\pi_1 = \\pi_1$。\n所以，$\\pi_4 = \\pi_1$。\n\n这意味着平稳分布的所有分量都相等：$\\pi_1 = \\pi_2 = \\pi_3 = \\pi_4$。\n使用归一化条件（5）：\n$\\pi_1 + \\pi_1 + \\pi_1 + \\pi_1 = 1$\n$4\\pi_1 = 1$\n$\\pi_1 = 1/4$。\n\n因此，平稳分布为 $\\pi = (1/4, 1/4, 1/4, 1/4)$。\n这个结果与 $p$ 的值无关（只要 $0 < p < 1$，对于 $p=1/3$ 是成立的）。\n\n题目要求的是棋子位于奇数号格子的概率，也即位于格子1或格子3的概率之和。\n$P(\\text{odd space}) = \\pi_1 + \\pi_3$\n$P(\\text{odd space}) = 1/4 + 1/4 = 2/4 = 1/2$。\n具体的 $p=1/3$ 这个值对于求得最终答案并非必需。", "answer": "$$\\boxed{\\frac{1}{2}}$$", "id": "1302614"}, {"introduction": "最后一个实践带领我们跃入一个由超立方体顶点建模的高维状态空间。对于这类复杂系统，直接求解完整的平衡方程组是不切实际的。在这里，我们将引入一个更强大、更优雅的工具：细致平衡原理。这个问题 [@problem_id:1302650] 将展示如何通过验证一个简单的局部平衡条件，来高效地获得复杂系统的平稳分布，并揭示其解所具有的优美的乘积形式结构。", "problem": "考虑一个由 $n$ 个互连节点组成的动态网络模型。整个网络的状态由一个长度为 $n$ 的二进制字符串 $(s_1, s_2, \\dots, s_n)$ 描述，其中 $s_i \\in \\{0, 1\\}$，这可以被看作是 $n$ 维超立方体上的一个顶点。该网络根据以下随机规则在离散时间步上演化：在每个时间步，从 $n$ 个节点中均匀随机地选择一个。如果被选中的节点处于状态 0，它以概率 $p$ 转移到状态 1。如果被选中的节点处于状态 1，它以概率 $q$ 转移到状态 0。如果转移没有发生（例如，一个处于状态 0 的节点被选中但翻转没有发生），该节点的状态在该步骤中保持不变。\n\n假设系统有 $n=8$ 个节点，转移概率为 $p = 2/3$ 和 $q = 1/2$。经过很长一段时间后，系统会趋近于一个在 $2^8$ 个可能状态上的平衡概率分布。确定由二进制字符串 $v = (1, 1, 0, 0, 1, 1, 0, 0)$ 描述的特定网络状态的平衡概率。\n\n将你的答案表示为一个由整数构成的最简分数。", "solution": "设 $n$ 为节点数，并令 $s=(s_{1},\\dots,s_{n})\\in\\{0,1\\}^{n}$ 表示一个网络状态。对于 $i\\in\\{1,\\dots,n\\}$，令 $s^{(i)}$ 为仅翻转 $s$ 的第 $i$ 个比特得到的组态。组态上的马尔可夫链通过均匀随机选择一个坐标并可能翻转它来更新：如果 $s_{i}=0$，则 $P(s\\to s^{(i)})=\\frac{1}{n}p$；如果 $s_{i}=1$，则 $P(s\\to s^{(i)})=\\frac{1}{n}q$。否则状态保持不变。\n\n我们寻找一个在超立方体的每条边上都满足细致平衡条件的平稳分布 $\\mu$。考虑拟设\n$$\n\\mu(s)=\\frac{1}{Z}\\,r^{k(s)},\\quad r=\\frac{p}{q},\\quad k(s)=\\sum_{i=1}^{n}s_{i},\n$$\n其中 $Z$ 是归一化常数。如果 $s_{i}=0$，那么 $k(s^{(i)})=k(s)+1$，因此\n$$\n\\frac{\\mu(s^{(i)})}{\\mu(s)}=\\frac{p}{q}.\n$$\n对 $(s,s^{(i)})$ 这对状态的细致平衡条件要求\n$$\n\\mu(s)P(s\\to s^{(i)})=\\mu(s^{(i)})P(s^{(i)}\\to s).\n$$\n使用 $P(s\\to s^{(i)})=\\frac{1}{n}p$ 和 $P(s^{(i)}\\to s)=\\frac{1}{n}q$（因为此时 $s^{(i)}_{i}=1$），我们得到\n$$\n\\mu(s)\\frac{1}{n}p=\\mu(s^{(i)})\\frac{1}{n}q,\n$$\n该式恰好成立，因为 $\\mu(s^{(i)})/\\mu(s)=p/q$。$s_{i}=1$ 的情况是对称的。因此 $\\mu$ 满足细致平衡条件，并且是平稳的。\n\n为了进行归一化，注意到\n$$\nZ=\\sum_{s\\in\\{0,1\\}^{n}}r^{k(s)}=\\sum_{k=0}^{n}\\binom{n}{k}r^{k}=(1+r)^{n}=\\left(1+\\frac{p}{q}\\right)^{n}=\\left(\\frac{p+q}{q}\\right)^{n}.\n$$\n因此，\n$$\n\\mu(s)=\\frac{\\left(\\frac{p}{q}\\right)^{k(s)}}{\\left(1+\\frac{p}{q}\\right)^{n}}=\\left(\\frac{p}{p+q}\\right)^{k(s)}\\left(\\frac{q}{p+q}\\right)^{n-k(s)}.\n$$\n从而，平衡分布是独立伯努利变量的乘积，其中 $\\Pr\\{s_{i}=1\\}=\\frac{p}{p+q}$。\n\n对于给定的数据，$n=8$，$p=\\frac{2}{3}$，$q=\\frac{1}{2}$，特定状态 $v=(1,1,0,0,1,1,0,0)$ 有 $k(v)=4$ 个 1。计算\n$$\n\\frac{p}{p+q}=\\frac{\\frac{2}{3}}{\\frac{2}{3}+\\frac{1}{2}}=\\frac{\\frac{2}{3}}{\\frac{7}{6}}=\\frac{4}{7},\\qquad \\frac{q}{p+q}=\\frac{\\frac{1}{2}}{\\frac{7}{6}}=\\frac{3}{7}.\n$$\n因此\n$$\n\\mu(v)=\\left(\\frac{4}{7}\\right)^{4}\\left(\\frac{3}{7}\\right)^{4}=\\frac{4^{4}\\cdot 3^{4}}{7^{8}}=\\frac{20736}{5764801}.\n$$\n这个分数已经是其最简形式。", "answer": "$$\\boxed{\\frac{20736}{5764801}}$$", "id": "1302650"}]}