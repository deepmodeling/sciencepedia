{"hands_on_practices": [{"introduction": "理论学习之后，最好的巩固方式就是亲手实践。我们从一个基础练习开始，这个练习将带你走过计算平稳分布的每一步：定义状态、构建转移矩阵 $P$，并求解线性方程组 $\\pi P = \\pi$ 和 $\\sum \\pi_i = 1$。通过这个直观的电梯运行模型 [@problem_id:1293460]，你将掌握求解小型马尔可夫链长期行为的核心方法。", "problem": "一部电梯在一座有三层楼的小型办公楼里运行：底层（第1层）、第一层（第2层）和第二层（第3层）。电梯在各停靠层之间的移动模式可以由一组简单的概率规则来描述。设电梯的当前位置为其完成一次停靠后的位置。\n\n- 如果电梯当前在底层（第1层），其下一次停靠必定是第一层（第2层）。\n- 如果电梯当前在第二层（第3层），其下一次停靠也必定是第一层（第2层）。\n- 如果电梯当前在第一层（第2层），则其下一次停靠在底层的概率为 $\\frac{1}{2}$，停留在第一层的概率为 $\\frac{1}{4}$，停靠在第二层的概率为 $\\frac{1}{4}$。\n\n假设这种移动模式无限持续下去，从长远来看，电梯在底层停靠的次数占总停靠次数的比例是多少？请用一个分数表示你的答案。", "solution": "设电梯的状态为其当前所在的楼层，因此状态空间为 $S = \\{1, 2, 3\\}$。该问题描述了一个离散时间马尔可夫链。我们可以将给定的概率规则总结为一个转移矩阵 $P$，其中元素 $P_{ij}$ 是从第 $i$ 层移动到第 $j$ 层的概率。\n\n该转移矩阵的各行如下：\n- 从第1层（底层）：电梯总是去往第2层。因此，$P_{11}=0$, $P_{12}=1$, $P_{13}=0$。\n- 从第2层（第一层）：去往第1层的概率为 $\\frac{1}{2}$，停留在第2层的概率为 $\\frac{1}{4}$，去往第3层的概率为 $\\frac{1}{4}$。因此，$P_{21}=\\frac{1}{2}$, $P_{22}=\\frac{1}{4}$, $P_{23}=\\frac{1}{4}$。\n- 从第3层（第二层）：电梯总是去往第2层。因此，$P_{31}=0$, $P_{32}=1$, $P_{33}=0$。\n\n完整的转移矩阵 $P$ 为：\n$$\nP = \\begin{pmatrix}\n0 & 1 & 0 \\\\\n\\frac{1}{2} & \\frac{1}{4} & \\frac{1}{4} \\\\\n0 & 1 & 0\n\\end{pmatrix}\n$$\n电梯在每个楼层停留时间的长期比例由平稳分布向量 $\\pi = (\\pi_1, \\pi_2, \\pi_3)$ 给出。该向量是线性方程组 $\\pi P = \\pi$ 在约束条件 $\\pi_1 + \\pi_2 + \\pi_3 = 1$（即概率总和为一）下的唯一解。\n\n矩阵方程 $\\pi P = \\pi$ 可以写作：\n$$\n(\\pi_1, \\pi_2, \\pi_3)\n\\begin{pmatrix}\n0 & 1 & 0 \\\\\n\\frac{1}{2} & \\frac{1}{4} & \\frac{1}{4} \\\\\n0 & 1 & 0\n\\end{pmatrix}\n= (\\pi_1, \\pi_2, \\pi_3)\n$$\n这给了我们一个由三个线性方程组成的方程组：\n1.  对于第一个分量（第1列）：$\\pi_1(0) + \\pi_2\\left(\\frac{1}{2}\\right) + \\pi_3(0) = \\pi_1 \\implies \\frac{1}{2}\\pi_2 = \\pi_1$\n2.  对于第二个分量（第2列）：$\\pi_1(1) + \\pi_2\\left(\\frac{1}{4}\\right) + \\pi_3(1) = \\pi_2 \\implies \\pi_1 + \\pi_3 = \\frac{3}{4}\\pi_2$\n3.  对于第三个分量（第3列）：$\\pi_1(0) + \\pi_2\\left(\\frac{1}{4}\\right) + \\pi_3(0) = \\pi_3 \\implies \\frac{1}{4}\\pi_2 = \\pi_3$\n\n现在我们得到了用 $\\pi_2$ 表示 $\\pi_1$ 和 $\\pi_3$ 的表达式：\n- $\\pi_1 = \\frac{1}{2}\\pi_2$\n- $\\pi_3 = \\frac{1}{4}\\pi_2$\n\n（注意：将这些表达式代入第二个方程，得到 $\\frac{1}{2}\\pi_2 + \\frac{1}{4}\\pi_2 = \\frac{3}{4}\\pi_2$，这验证了方程组的一致性，但无助于求解具体数值，因为该方程组中总有一个方程是冗余的。）\n\n我们使用归一化条件 $\\pi_1 + \\pi_2 + \\pi_3 = 1$ 来求解唯一解。代入 $\\pi_1$ 和 $\\pi_3$ 的表达式：\n$$\n\\left(\\frac{1}{2}\\pi_2\\right) + \\pi_2 + \\left(\\frac{1}{4}\\pi_2\\right) = 1\n$$\n为了解出 $\\pi_2$，我们先通分：\n$$\n\\left(\\frac{2}{4}\\pi_2\\right) + \\left(\\frac{4}{4}\\pi_2\\right) + \\left(\\frac{1}{4}\\pi_2\\right) = 1\n$$\n$$\n\\frac{7}{4}\\pi_2 = 1\n$$\n$$\n\\pi_2 = \\frac{4}{7}\n$$\n现在我们可以求出 $\\pi_1$ 和 $\\pi_3$ 的值：\n$$\n\\pi_1 = \\frac{1}{2}\\pi_2 = \\frac{1}{2} \\left(\\frac{4}{7}\\right) = \\frac{2}{7}\n$$\n$$\n\\pi_3 = \\frac{1}{4}\\pi_2 = \\frac{1}{4} \\left(\\frac{4}{7}\\right) = \\frac{1}{7}\n$$\n平稳分布为 $\\pi = \\left(\\frac{2}{7}, \\frac{4}{7}, \\frac{1}{7}\\right)$。\n问题要求的是电梯在底层停靠的长期比例，这对应于分量 $\\pi_1$。\n\n因此，电梯在底层停靠的长期比例是 $\\frac{2}{7}$。", "answer": "$$\\boxed{\\frac{2}{7}}$$", "id": "1293460"}, {"introduction": "掌握了基本计算方法后，让我们进入一个更贴近现实建模的场景。在许多应用中，我们处理的不是固定的数值概率，而是可变的参数。这个练习 [@problem_id:1293445] 模拟了一个计算机系统的循环与崩溃过程，你需要用符号参数 $p_A$、$p_B$ 和 $r$ 来推导系统处于崩溃状态的长期概率。这不仅能锻炼你的代数推导能力，更是构建通用模型、进行参数分析的关键一步。", "problem": "一个老旧的计算机系统在一个连续循环中运行一个关键进程。该进程包含严格交替执行两个函数 `FUNC_A` 和 `FUNC_B`。系统的行为可以用离散时间步长来建模，其中每一步对应于一次函数调用的完成。\n\n操作顺序如下：\n- 成功完成 `FUNC_A` 后，系统立即尝试执行 `FUNC_B`。\n- 成功完成 `FUNC_B` 后，系统立即尝试执行 `FUNC_A`。\n\n然而，由于硬件不稳定，系统容易崩溃。\n- 每次执行 `FUNC_A` 后，系统有 $p_A$ 的固定概率会崩溃，而不是继续执行 `FUNC_B`。\n- 同样，每次执行 `FUNC_B` 后，系统有 $p_B$ 的固定概率会崩溃，而不是继续执行 `FUNC_A`。\n\n有一个自动监控服务用于处理崩溃。在每个时间步，如果系统处于崩溃状态，该服务会尝试重启。重启成功的概率为 $r$，在这种情况下，系统立即通过执行 `FUNC_A` 再次开始其进程循环。如果重启尝试失败（概率为 $1-r$），则系统在该时间步内保持崩溃状态。\n\n假设系统已经运行了很长时间并已达到稳态。求系统处于崩溃状态的长期概率的表达式。你的答案应该是一个用 $p_A$、$p_B$ 和 $r$ 表示的符号表达式。", "solution": "将系统建模为一个具有三个状态的离散时间马尔可夫链，这些状态表示在下一个时间步发生的情况：\n- $A$：系统执行 `FUNC_A`，\n- $B$：系统执行 `FUNC_B`，\n- $C$：系统崩溃（发生重启尝试）。\n\n根据描述，一步转移概率为：\n- 从 $A$：以概率 $p_{A}$ 转移到 $C$（在 $A$ 后崩溃），以概率 $1 - p_{A}$ 转移到 $B$。\n- 从 $B$：以概率 $p_{B}$ 转移到 $C$（在 $B$ 后崩溃），以概率 $1 - p_{B}$ 转移到 $A$。\n- 从 $C$：以概率 $r$ 转移到 $A$（成功重启），以概率 $1 - r$ 转移到 $C$（重启失败）。\n\n设状态 $A$、$B$ 和 $C$ 的平稳概率分别为 $\\pi_{A}$、$\\pi_{B}$ 和 $\\pi_{C}$。在稳态下，它们满足平衡方程和归一化条件：\n$$\n\\pi_{A} = \\pi_{B} (1 - p_{B}) + \\pi_{C} r,\n$$\n$$\n\\pi_{B} = \\pi_{A} (1 - p_{A}),\n$$\n$$\n\\pi_{C} = \\pi_{A} p_{A} + \\pi_{B} p_{B} + \\pi_{C} (1 - r),\n$$\n$$\n\\pi_{A} + \\pi_{B} + \\pi_{C} = 1.\n$$\n将 $\\pi_{B} = \\pi_{A} (1 - p_{A})$ 代入 $\\pi_{C}$ 的平衡方程中：\n$$\n\\pi_{C} r = \\pi_{A} p_{A} + \\pi_{B} p_{B} = \\pi_{A} p_{A} + \\pi_{A} (1 - p_{A}) p_{B} = \\pi_{A} \\left(p_{A} + p_{B} - p_{A} p_{B}\\right).\n$$\n因此\n$$\n\\pi_{A} = \\frac{\\pi_{C} r}{p_{A} + p_{B} - p_{A} p_{B}},\n\\quad\n\\pi_{B} = (1 - p_{A}) \\pi_{A} = (1 - p_{A}) \\frac{\\pi_{C} r}{p_{A} + p_{B} - p_{A} p_{B}}.\n$$\n使用归一化条件求解 $\\pi_{C}$：\n$$\n1 = \\pi_{A} + \\pi_{B} + \\pi_{C}\n= \\frac{\\pi_{C} r}{p_{A} + p_{B} - p_{A} p_{B}} \\left[1 + (1 - p_{A})\\right] + \\pi_{C}\n= \\frac{\\pi_{C} r (2 - p_{A})}{p_{A} + p_{B} - p_{A} p_{B}} + \\pi_{C}.\n$$\n因此，\n$$\n\\pi_{C} \\left[1 + \\frac{r (2 - p_{A})}{p_{A} + p_{B} - p_{A} p_{B}}\\right] = 1,\n$$\n可得\n$$\n\\pi_{C} = \\frac{p_{A} + p_{B} - p_{A} p_{B}}{p_{A} + p_{B} - p_{A} p_{B} + r (2 - p_{A})}.\n$$\n此 $\\pi_{C}$ 即为系统处于崩溃状态的长期概率。", "answer": "$$\\boxed{\\frac{p_{A} + p_{B} - p_{A} p_{B}}{p_{A} + p_{B} - p_{A} p_{B} + r (2 - p_{A})}}$$", "id": "1293445"}, {"introduction": "现在，让我们挑战一个更高级的问题，它将为你展示一种处理具有大量结构化状态的马尔可夫链的强大技术。当状态空间很大时，直接求解大型矩阵方程组变得不切实际。这个问题 [@problem_id:1293455] 围绕一个资本管理的简化模型展开，它引入了反射和重置等特殊的边界条件，你将学习如何利用平衡方程和差分方程来求解平稳分布，这在量化金融等领域是一种至关重要的分析工具。", "problem": "一家量化交易公司使用一个随机过程来为其每日资本建模。该公司的资本在第 $t$ 天记为 $X_t$，可用一个整数表示。每天，资本以固定的数量变化：以概率 $p$ 增加 1 单位，或以概率 $q=1-p$ 减少 1 单位，其中 $p \\neq q$。\n\n该公司有两项严格的风险管理协议：\n1.  资本上限设为 $M$。如果资本为 $M$ 且发生盈利本应使其增加，则超额部分将被扣除，资本仍保持在 $M$。\n2.  资本下限阈值设为 $L$。如果在任何一天结束时，发现资本达到或低于 $L$，公司的资助者将立即注入资金，使资本在下一天开始时重置到预定水平 $S$。参数满足 $0 < L < S < M$。\n\n系统状态在每一天开始时，在任何可能的重置操作之后被观察。因此，可能的资本水平构成整数集合 $\\{L+1, L+2, \\dots, M\\}$。经过很长一段时间后，系统达到稳态分布，其中 $\\pi_k$ 是资本为 $k$ 的概率。\n\n求该公司资本处于重置水平 $S$ 时的稳态概率 $\\pi_S$。请用 $L, S, M$ 以及比率 $\\rho = p/q$ 将答案表示为一个闭式解析表达式。", "solution": "设状态为整数 $k \\in \\{L+1,L+2,\\dots,M\\}$。一步转移概率为：\n- 对于 $L+1<k<M$：$P_{k,k+1}=p$ 且 $P_{k,k-1}=q$。\n- 对于 $k=M$：$P_{M,M}=p$ 且 $P_{M,M-1}=q$（在 $M$ 处为反射壁）。\n- 对于 $k=L+1$：$P_{L+1,L+2}=p$ 且 $P_{L+1,S}=q$（当向下移动时重置到 $S$）。\n设 $\\rho=p/q$ 且 $p \\neq q$。\n\n在稳态下，对于任意 $k \\notin \\{L+1,S,M\\}$，平衡方程为\n$$\n\\pi_{k}=p\\pi_{k-1}+q\\pi_{k+1}.\n$$\n齐次递推关系 $q\\pi_{k+1}-\\pi_{k}+p\\pi_{k-1}=0$ 的通解，在任何没有非齐次项出现的连续区间上，其形式为 $\\pi_{k}=A+B\\rho^{k}$。\n\n在 $S$ 处将状态空间分割：\n- 上段 $k \\in \\{S+1,\\dots,M\\}$：写作 $\\pi_{k}=A_{u}+B_{u}\\rho^{k}$。在 $M$ 处的稳态平衡方程为 $\\pi_M = p\\pi_{M-1} + p\\pi_M$，可整理为 $p\\pi_{M-1}=q\\pi_M$。这一条件迫使净概率流为零，因此 $A_{u}=0$。于是\n$$\n\\pi_{k}=C\\,\\rho^{k},\\quad k=S+1,\\dots,M,\n$$\n对某个常数 $C$。\n- 下段 $k \\in \\{L+1,\\dots,S-1\\}$：写作 $\\pi_{k}=A_{\\ell}+B_{\\ell}\\rho^{k}$。在 $L+1$ 处的边界平衡条件为 $\\pi_{L+1}=q\\pi_{L+2}$。代入可得\n$$\nA_{\\ell}+B_{\\ell}\\rho^{L+1}=q\\bigl(A_{\\ell}+B_{\\ell}\\rho^{L+2}\\bigr)\\;\\Rightarrow\\;pA_{\\ell}+qB_{\\ell}\\rho^{L+1}=0,\n$$\n所以 $A_{\\ell}=-(q/p)B_{\\ell}\\rho^{L+1}=-B_{\\ell}\\rho^{L}$。因此，对于 $L+1 \\le k \\le S-1$，\n$$\n\\pi_{k}=B_{\\ell}\\bigl(\\rho^{k}-\\rho^{L}\\bigr).\n$$\n\n在特殊状态 $S$ 处，稳态方程包含了重置流入项：\n$$\n\\pi_{S}=p\\pi_{S-1}+q\\pi_{S+1}+q\\pi_{L+1}.\n$$\n利用 $\\pi_{S-1}=B_{\\ell}(\\rho^{S-1}-\\rho^{L})$、$\\pi_{S+1}=C\\rho^{S+1}$、$\\pi_{L+1}=B_{\\ell}(\\rho^{L+1}-\\rho^{L})$ 以及 $q\\rho=p$，该式可简化为\n$$\n\\pi_{S}=q\\Bigl[B_{\\ell}\\bigl(\\rho^{S}-\\rho^{L}\\bigr)+C\\rho^{S+1}\\Bigr].\n$$\n\n接下来，利用在 $S+1$ 处的稳态条件：\n$$\n\\pi_{S+1}=p\\pi_{S}+q\\pi_{S+2}.\n$$\n利用 $\\pi_{S+1}=C\\rho^{S+1}$ 和 $\\pi_{S+2}=C\\rho^{S+2}$，可得\n$$\nC\\rho^{S+1}=p\\pi_{S}+qC\\rho^{S+2}=p\\pi_{S}+pC\\rho^{S+1},\n$$\n因此 $C\\rho^{S+1}=\\rho\\,\\pi_{S}$，从而 $C=\\pi_{S}\\rho^{-S}$。因此，对于 $k \\ge S+1$，\n$$\n\\pi_{k}=\\pi_{S}\\rho^{k-S}.\n$$\n\n将 $C\\rho^{S+1}=\\rho\\pi_{S}$ 代回到 $S$ 的方程中得到\n$$\n\\pi_{S}=q\\Bigl[B_{\\ell}\\bigl(\\rho^{S}-\\rho^{L}\\bigr)+\\rho\\,\\pi_{S}\\Bigr]\\;\\Rightarrow\\;q\\pi_{S}=qB_{\\ell}\\bigl(\\rho^{S}-\\rho^{L}\\bigr),\n$$\n所以\n$$\nB_{\\ell}=\\frac{\\pi_{S}}{\\rho^{S}-\\rho^{L}}.\n$$\n于是，对于 $L+1 \\le k \\le S-1$，\n$$\n\\pi_{k}=\\pi_{S}\\,\\frac{\\rho^{k}-\\rho^{L}}{\\rho^{S}-\\rho^{L}}.\n$$\n\n现在使用归一化条件：\n$$\n\\sum_{k=L+1}^{M}\\pi_{k}=1=\\sum_{k=L+1}^{S-1}\\pi_{k}+\\pi_{S}+\\sum_{k=S+1}^{M}\\pi_{k}.\n$$\n计算求和：\n$$\n\\sum_{k=S+1}^{M}\\pi_{k}=\\pi_{S}\\sum_{j=1}^{M-S}\\rho^{j}=\\pi_{S}\\,\\rho\\,\\frac{1-\\rho^{M-S}}{1-\\rho},\n$$\n以及\n$$\n\\sum_{k=L+1}^{S-1}\\pi_{k}=\\pi_{S}\\,\\frac{1}{\\rho^{S}-\\rho^{L}}\\sum_{k=L+1}^{S-1}\\bigl(\\rho^{k}-\\rho^{L}\\bigr)\n=\\pi_{S}\\,\\frac{\\rho\\bigl(1-\\rho^{S-L-1}\\bigr)/(1-\\rho)-(S-L-1)}{\\rho^{S-L}-1}.\n$$\n设 $a=S-L$ 和 $b=M-S$。则\n$$\n1=\\pi_{S}\\left[1+\\frac{\\rho\\bigl(1-\\rho^{b}\\bigr)}{1-\\rho}+\\frac{\\rho\\bigl(1-\\rho^{a-1}\\bigr)/(1-\\rho)-(a-1)}{\\rho^{a}-1}\\right].\n$$\n解出 $\\pi_{S}$ 并对括号内的表达式进行代数化简，可得\n$$\n\\pi_{S}=\\frac{(1-\\rho)\\bigl(\\rho^{a}-1\\bigr)}{a(\\rho-1)+\\rho^{b+1}-\\rho^{a+b+1}}.\n$$\n等价地，\n$$\n\\pi_{S}=\\frac{(\\rho-1)\\bigl(\\rho^{a}-1\\bigr)}{\\rho^{b+1}\\bigl(\\rho^{a}-1\\bigr)-(\\rho-1)a}.\n$$\n将 $a=S-L$ 和 $b=M-S$ 代回，便得到所求的闭式表达式：\n$$\n\\pi_{S}=\\frac{(\\rho-1)\\bigl(\\rho^{\\,S-L}-1\\bigr)}{\\rho^{\\,M-S+1}\\bigl(\\rho^{\\,S-L}-1\\bigr)-(\\rho-1)(S-L)}.\n$$\n此式在题目要求的 $\\rho \\neq 1$（即 $p \\neq q$）条件下成立。", "answer": "$$\\boxed{\\frac{(\\rho-1)\\bigl(\\rho^{\\,S-L}-1\\bigr)}{\\rho^{\\,M-S+1}\\bigl(\\rho^{\\,S-L}-1\\bigr)-(\\rho-1)(S-L)}}$$", "id": "1293455"}]}