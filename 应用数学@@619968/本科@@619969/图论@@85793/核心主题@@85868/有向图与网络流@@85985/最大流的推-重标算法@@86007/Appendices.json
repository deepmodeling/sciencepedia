{"hands_on_practices": [{"introduction": "要真正掌握推流-重贴标签算法，理解其原子操作——`推流`（push）和`重贴标签`（relabel）——至关重要。本练习提供了一个算法执行过程中的“快照”，要求你接手并执行接下来的两步操作。通过仔细应用`推流`和`重贴标签`的规则，你将亲身体验算法如何系统地在网络中移动流量并调整节点的高度函数 $h$。[@problem_id:1529547]", "problem": "考虑一个流网络，其包含一个源节点 $s$、一个汇节点 $t$ 和两个中间节点 $a$ 和 $b$。其有向边及其整数容量 $c(u, v)$ 如下所示：$c(s, a) = 15$，$c(s, b) = 7$，$c(a, b) = 4$，$c(a, t) = 9$，以及 $c(b, t) = 12$。所有其他节点对的容量均为零。\n\n在执行用于寻找最大流的推送-重标签算法期间，该网络处于一个中间状态。一个预流 $f$ 已经建立，导致每个节点具有以下的高度函数 $h$ 和超额流函数 $e$：\n- 高度：$h(s) = 4$，$h(a) = 0$，$h(b) = 0$，$h(t) = 0$。\n- 超额流：$e(s) = -22$，$e(a) = 15$，$e(b) = 7$，$e(t) = 0$。\n当前的非零流为 $f(s, a) = 15$ 和 $f(s, b) = 7$。所有其他流 $f(u, v)$ 均为零。\n\n推送-重标签算法在活动节点上进行操作，活动节点定义为任何具有正超额流 $e(u) > 0$ 的节点 $u$（$s$ 或 $t$ 除外）。该算法对一个活动节点 $u$ 使用两种主要操作：\n1.  **推送 (Push)**：如果 $e(u) > 0$，残留容量 $c_f(u, v) > 0$，并且满足高度条件 $h(u) = h(v) + 1$，则可以从节点 $u$ 向相邻节点 $v$ 进行一次推送。推送的流量为 $\\min(e(u), c_f(u, v))$。残留容量定义为 $c_f(u,v) = c(u,v) - f(u,v)$。\n2.  **重标签 (Relabel)**：如果 $e(u) > 0$ 且无法从 $u$ 进行任何推送操作，则可以对节点 $u$ 进行重标签操作。$u$ 的高度被更新为 $h(u) = 1 + \\min\\{h(v) | c_f(u, v) > 0\\}$。\n\n从活动节点 $a$ 开始，确定在执行完恰好两次有效操作后网络的状态。该算法遵循以下特定规则：\n- 对选定的活动节点执行一次操作。如果该节点仍然是活动的，则为下一次操作再次选择它。\n- 为一个节点选择操作时，如果 `push` 操作适用，则总是执行 `push` 操作。只有在没有 `push` 操作可执行时，才执行 `relabel` 操作。\n- 如果可以向多个邻居节点进行 `push` 操作，则选择按字母顺序排在最前面的邻居作为目的地。\n\n在执行这两次操作之后，以下哪个选项正确描述了节点 $a$ 和 $b$ 的高度和超额流？\n\nA. $h(a) = 1$，$e(a) = 11$，以及 $h(b) = 0$，$e(b) = 11$。\n\nB. $h(a) = 1$，$e(a) = 6$，以及 $h(b) = 0$，$e(b) = 7$。\n\nC. $h(a) = 1$，$e(a) = 15$，以及 $h(b) = 0$，$e(b) = 7$。\n\nD. $h(a) = 0$，$e(a) = 11$，以及 $h(b) = 0$，$e(b) = 11$。\n\nE. $h(a) = 1$，$e(a) = 11$，以及 $h(b) = 1$，$e(b) = 11$。", "solution": "有向边及其容量为 $c(s,a)=15$，$c(s,b)=7$，$c(a,b)=4$，$c(a,t)=9$，$c(b,t)=12$，所有其他容量为零。当前的非零流为 $f(s,a)=15$ 和 $f(s,b)=7$，高度为 $h(s)=4$，$h(a)=0$，$h(b)=0$，$h(t)=0$，超额流为 $e(s)=-22$，$e(a)=15$，$e(b)=7$，$e(t)=0$。\n\n从节点 $a$ 出发的残留容量计算方式为：对于正向边，$c_{f}(u,v)=c(u,v)-f(u,v)$；对于当前流的反向边，$c_{f}(v,u)=f(u,v)$。因此，\n$$\nc_{f}(a,b)=c(a,b)-f(a,b)=4-0=4,\\quad c_{f}(a,t)=c(a,t)-f(a,t)=9-0=9,\\quad c_{f}(a,s)=f(s,a)=15.\n$$\n从 $a$ 推送到邻居 $v$ 要求 $e(a)>0$，$c_{f}(a,v)>0$ 且 $h(a)=h(v)+1$。由于 $h(a)=0$ 且 $h(b)=h(t)=0$，$h(s)=4$，条件 $0=h(b)+1$，$0=h(t)+1$，$0=h(s)+1$ 都不满足。因此，无法从 $a$ 进行推送，可以进行重标签操作。根据重标签规则，\n$$\nh(a)\\leftarrow 1+\\min\\{h(v)\\mid c_{f}(a,v)>0\\}=1+\\min\\{h(s),h(b),h(t)\\}=1+\\min\\{4,0,0\\}=1.\n$$\n这完成了第一次操作；$e(a)=15$ 仍然为正，所以 $a$ 被再次选中。\n\n当 $h(a)=1$ 时，推送许可条件 $h(a)=h(v)+1$ 对 $v=b$ 和 $v=t$ 成立，因为 $h(b)=h(t)=0$，但对 $v=s$ 不成立，因为 $h(s)=4$。根据决胜规则（字母顺序），选择从 $a$ 推送到 $b$。推送量为\n$$\n\\Delta=\\min\\{e(a),c_{f}(a,b)\\}=\\min\\{15,4\\}=4.\n$$\n更新流和超额流，\n$$\nf(a,b)\\leftarrow f(a,b)+4=4,\\quad e(a)\\leftarrow e(a)-4=11,\\quad e(b)\\leftarrow e(b)+4=11,\n$$\n高度保持 $h(a)=1$，$h(b)=0$ 不变。\n\n因此，在恰好两次操作之后，我们得到 $h(a)=1$，$e(a)=11$，$h(b)=0$，$e(b)=11$，这对应于选项 A。", "answer": "$$\\boxed{A}$$", "id": "1529547"}, {"introduction": "除了简单地执行算法，更深层次的理解来自于对其状态的推理和“反向工程”。本练习提出了一个逆向挑战：给定一个特定的事件序列（一次`推流`操作后紧跟着一次强制的`重贴标签`操作），你必须找出导致这一结果的初始条件。这个练习将考验你对`许可边`（admissible edge）以及算法决策所依赖的精确条件的掌握程度，例如高度关系 $h(x) = h(y) + 1$ 和残余容量 $c_f(x,y) > 0$。[@problem_id:1529542]", "problem": "考虑在一个流网络上执行一个通用的预流推送算法。该网络是一个有向图 $G=(V, E)$，有一个源点 $s$、一个汇点 $t$，以及每条边 $(x,y) \\in E$ 的容量函数 $c(x,y)$。该算法的状态由预流函数 $f$ 和高度函数 $h$ 定义。\n\n使用以下定义：\n- 节点 $x$ 处的**超额流**为 $e(x) = \\sum_{w \\in V} f(w,x) - \\sum_{y \\in V} f(x,y)$。\n- 如果 $e(x) > 0$，则节点 $x \\in V \\setminus \\{s,t\\}$ 是**活动的**。\n- 边 $(x,y)$ 的**残留容量**为 $c_f(x,y) = c(x,y) - f(x,y)$。由流产生的反向边的残留容量为 $c_f(y,x) = f(x,y)$。\n- 如果 $c_f(x,y) > 0$ 且 $h(x) = h(y) + 1$，则边 $(x,y)$ 是**可允许的**。\n- 如果存在一条可允许的边 $(x,y)$，则**推送**操作适用于活动节点 $x$。该算法将 $\\delta = \\min(e(x), c_f(x,y))$ 单位的流量从 $x$ 推送到 $y$。\n- 如果活动节点 $x$ 没有可允许的出边，则**重贴标签**操作适用于该节点。高度 $h(x)$ 更新为 $1 + \\min\\{h(y) | (x,y) \\in E \\text{ and } c_f(x,y)>0\\}$。\n\n设图由顶点集 $V = \\{s, u, v, w, t\\}$ 和带容量的边集定义：\n$c(s,u)=20$, $c(u,v)=10$, $c(v,w)=15$, $c(w,t)=10$。\n\n假设算法处于一个状态，其中节点 $u$ 是活动的，节点 $v$ 不是活动的（即 $e(v)=0$），且从 $u$ 出发的唯一可允许的边是 $(u,v)$。然后对边 $(u,v)$ 执行一次推送操作。\n\n下列哪个由预流 $f$ 和高度函数 $h$ 指定的初始状态，会导致一个新状态，其中节点 $v$ 变为活动的并且没有可允许的边（因此必须重贴标签）？\n\n预流 $f$ 由非零流值给出；所有其他边的流均为零。高度函数 $h$ 以 $(h(s), h(u), h(v), h(w), h(t))$ 的值列表形式给出。\n\nA. $f(s,u)=13, f(u,v)=8, f(v,w)=8, f(w,t)=8$; $h=(5, 3, 2, 2, 0)$\n\nB. $f(s,u)=13, f(u,v)=8, f(v,w)=8, f(w,t)=8$; $h=(5, 3, 2, 1, 0)$\n\nC. $f(s,u)=8, f(u,v)=8, f(v,w)=8, f(w,t)=8$; $h=(5, 3, 2, 2, 0)$\n\nD. $f(s,u)=13, f(u,v)=9, f(v,w)=8, f(w,t)=8$; $h=(5, 3, 2, 2, 0)$", "solution": "问题要求确定哪个初始状态，在从节点 $u$ 到节点 $v$ 进行一次推送后，会得到一个 $v$ 是活动的但没有可允许的边的新状态。让我们根据前置条件和后置条件来分析每个选项。\n\n**前置条件：**\n1.  节点 $u$ 是活动的：$e(u) > 0$。\n2.  节点 $v$ 不是活动的：$e(v) = 0$。\n3.  边 $(u,v)$ 是可允许的：$c_f(u,v) > 0$ 且 $h(u) = h(v) + 1$。\n4.  $(u,v)$ 是从 $u$ 出发的唯一可允许的边。\n\n**后置条件（在对 $(u,v)$ 推送之后）：**\n1.  节点 $v$ 变为活动的：新的 $e(v) > 0$。\n2.  节点 $v$ 没有可允许的边。\n\n让我们检查每个选项。\n\n**选项 A 分析：**\n状态：$f(s,u)=13, f(u,v)=8, f(v,w)=8, f(w,t)=8$；$h=(5, 3, 2, 2, 0)$。\n\n1.  **检查前置条件：**\n    - $u$ 处的超额流：$e(u) = f(s,u) - f(u,v) = 13 - 8 = 5$。因为 $e(u)>0$，所以 $u$ 是活动的。（条件1满足）\n    - $v$ 处的超额流：$e(v) = f(u,v) - f(v,w) = 8 - 8 = 0$。因为 $e(v)=0$，所以 $v$ 不是活动的。（条件2满足）\n    - $(u,v)$ 的可允许性：\n        - 残留容量：$c_f(u,v) = c(u,v) - f(u,v) = 10 - 8 = 2$。因为 $c_f(u,v) > 0$。\n        - 高度条件：$h(u)=3$, $h(v)=2$。$h(u) = h(v) + 1$ 成立。\n        - 因此，$(u,v)$是一条可允许的边。（条件3满足）\n    - 从 $u$ 出发的可允许边的唯一性：$u$ 只有一条出边 $(u,v)$，所以它自然是唯一的可允许边。（条件4满足）\n    \n    所有前置条件都已满足。现在，对 $(u,v)$ 执行推送操作。\n    - 推送量：$\\delta = \\min(e(u), c_f(u,v)) = \\min(5, 2) = 2$。\n\n2.  **分析新状态：**\n    - $(u,v)$ 上的新流量：$f'(u,v) = f(u,v) + \\delta = 8 + 2 = 10$。\n    - $u$ 处的新超额流：$e'(u) = e(u) - \\delta = 5 - 2 = 3$。\n    - $v$ 处的新超额流：$e'(v) = e(v) + \\delta = 0 + 2 = 2$。\n    - 因为 $e'(v) = 2 > 0$，节点 $v$ 现在是活动的。（后置条件1满足）\n\n3.  **检查新状态下从 $v$ 出发的可允许边：**\n    - 从 $v$ 出发的唯一出边是 $(v,w)$。\n    - 检查 $(v,w)$ 是否是可允许的：\n        - 残留容量：$c_f(v,w) = c(v,w) - f(v,w) = 15 - 8 = 7 > 0$。\n        - 高度条件：$h(v)=2$, $h(w)=2$。条件 $h(v) = h(w) + 1$ 不成立（$2 \\neq 2+1$）。\n    - 由于高度条件不满足，$(v,w)$ 不是可允许的。因为这是唯一具有正残留容量的出边，所以节点 $v$ 没有可允许的边。（后置条件2满足）\n\n结论：选项 A 满足所有条件。\n\n**选项 B 分析：**\n状态：$f(s,u)=13, f(u,v)=8, f(v,w)=8, f(w,t)=8$；$h=(5, 3, 2, 1, 0)$。\n流量与选项 A 相同，因此关于超额流和残留容量的前置条件得以满足。我们来检查高度。\n1.  **检查前置条件：**\n    - $e(u)=5 > 0$（活动的），$e(v)=0$（不活动的）。\n    - $(u,v)$ 的可允许性：$h(u)=3$, $h(v)=2 \\implies h(u)=h(v)+1$。$c_f(u,v)=2>0$。边是可允许的。\n    - 所有前置条件都已满足。执行推送操作。\n    - 推送量：$\\delta = \\min(e(u), c_f(u,v)) = \\min(5, 2) = 2$。\n\n2.  **分析新状态：**\n    - $v$ 处的新超额流：$e'(v) = 0 + 2 = 2$。$v$ 是活动的。（后置条件1满足）\n\n3.  **检查新状态下从 $v$ 出发的可允许边：**\n    - 出边是 $(v,w)$。\n    - 检查 $(v,w)$ 是否是可允许的：\n        - 残留容量：$c_f(v,w) = 15 - 8 = 7 > 0$。\n        - 高度条件：$h(v)=2$, $h(w)=1$。条件 $h(v) = h(w) + 1$ 成立（$2 = 1+1$）。\n    - 由于两个条件都满足，$(v,w)$ 是一条可允许的边。节点 $v$ 有一条可允许的边，不需要重贴标签。它可以向 $w$ 执行一次推送。\n\n结论：选项 B 未能满足第二个后置条件。\n\n**选项 C 分析：**\n状态：$f(s,u)=8, f(u,v)=8, f(v,w)=8, f(w,t)=8$；$h=(5, 3, 2, 2, 0)$。\n1.  **检查前置条件：**\n    - $u$ 处的超额流：$e(u) = f(s,u) - f(u,v) = 8 - 8 = 0$。\n    - 因为 $e(u)=0$，节点 $u$ 不是活动的。这违反了前置条件1。不能从 $u$ 发起推送操作。\n\n结论：选项 C 未能满足问题的前置条件。\n\n**选项 D 分析：**\n状态：$f(s,u)=13, f(u,v)=9, f(v,w)=8, f(w,t)=8$; $h=(5, 3, 2, 2, 0)$。\n1.  **检查前置条件：**\n    - $u$ 处的超额流：$e(u) = f(s,u) - f(u,v) = 13 - 9 = 4 > 0$。$u$ 是活动的。\n    - $v$ 处的超额流：$e(v) = f(u,v) - f(v,w) = 9 - 8 = 1$。\n    - 因为 $e(v)=1 > 0$，节点 $v$ 已经是活动的。这违反了前置条件2，该条件规定节点 $v$ 不是活动的。\n\n结论：选项 D 未能满足问题的前置条件。\n\n根据详细分析，只有选项 A 正确描述了导致指定结果的初始状态。", "answer": "$$\\boxed{A}$$", "id": "1529542"}, {"introduction": "推流-重贴标签算法的主循环在中间节点没有多余流量可以推出时终止，此时得到的是一个`预流`（preflow）。要得到最终的最大流，这个预流必须被转换成一个有效的`可行流`（feasible flow）。本练习聚焦于这个关键的后处理步骤，你需要在`残留图`（residual graph）中找到路径，将仍有正`余流` $e(v) > 0$ 的节点的流量送回源点 $s$。[@problem_id:1529529]", "problem": "考虑一个由有向图 $G=(V, E)$、一个源顶点 $s \\in V$ 和一个汇顶点 $t \\in V$ 定义的流网络。每条边 $(u,v) \\in E$ 都有一个非负整数容量 $c(u,v)$。顶点集为 $V = \\{s, t, a, b, c, d\\}$。边及其容量如下所示：\n$c(s, a) = 10$, $c(s, b) = 8$, $c(a, c) = 9$, $c(a, d) = 6$, $c(b, a) = 4$, $c(b, d) = 5$, $c(c, t) = 7$, $c(d, t) = 9$, $c(c, d) = 3$。所有其他容量均为零。\n\n已为此网络计算出一个预流 $f$。预流是一个作用于顶点对上的函数，满足容量约束（对于所有 $u, v \\in V$，$f(u, v) \\leq c(u, v)$）和斜对称约束（对于所有 $u, v \\in V$，$f(u, v) = -f(v, u)$）。顶点 $v$ 处的超额流定义为 $e(v) = \\sum_{u \\in V} f(u, v)$。对于给定的预流 $f$，每条边一个方向上的非零流值如下：\n$f(s, a) = 10$, $f(s, b) = 5$, $f(a, c) = 8$, $f(b, a) = 1$, $f(b, d) = 4$, $f(c, t) = 6$, $f(c, d) = 2$, $f(d, t) = 5$。\n\n该预流必须被转换为一个有效的流，其中除 $s$ 和 $t$ 之外的每个顶点的超额流都为零。这是通过一个后处理过程来完成的。该过程识别所有具有正超额流 $e(v) > 0$ 的顶点 $v$。对于每个这样的顶点，其全部超额流将被返回到源点 $s$。这个返回操作是通过在残差图 $G_f$ 中，沿着一条从 $v$ 到 $s$ 的路径增广流量来完成的，增广量等于 $e(v)$。在此过程中，您必须始终选择边数最少的路径。这个增广过程会更新预流。对所有初始具有正超额流的顶点重复该过程，最终得到一个有效的流 $f'$。处理具有超额流的顶点的顺序不影响最终的流 $f'$。\n\n应用此后处理过程以获得最终的有效流 $f'$。确定从顶点 $b$ 到顶点 $d$ 的有向边上的流值 $f'(b, d)$。以单个数值的形式提供答案。", "solution": "给定一个带有容量 $c(u,v)$ 的有向网络和一个满足容量及斜对称约束的预流 $f$。顶点 $v$ 处的超额流为 $e(v)=\\sum_{u\\in V} f(u,v)$。我们首先使用给定的 $f$ 值和斜对称性 $f(v,u)=-f(u,v)$ 来计算超额流。\n\n使用列出的非零流 $f(s,a)=10$, $f(s,b)=5$, $f(a,c)=8$, $f(b,a)=1$, $f(b,d)=4$, $f(c,t)=6$, $f(c,d)=2$, $f(d,t)=5$，我们得到：\n$$\n\\begin{aligned}\ne(s)&=f(a,s)+f(b,s)=-10-5=-15,\\\\\ne(a)&=f(s,a)+f(b,a)+f(c,a)+f(d,a)=10+1-8+0=3,\\\\\ne(b)&=f(s,b)+f(a,b)+f(d,b)=5-1-4=0,\\\\\ne(c)&=f(a,c)+f(d,c)+f(t,c)=8-2-6=0,\\\\\ne(d)&=f(a,d)+f(b,d)+f(c,d)+f(t,d)=0+4+2-5=1,\\\\\ne(t)&=f(c,t)+f(d,t)=6+5=11.\n\\end{aligned}\n$$\n因此，除 $t$ 外具有正超额流的顶点是 $a$（其 $e(a)=3$）和 $d$（其 $e(d)=1$）。\n\n每条边 $(u,v)$ 的残差容量定义为 $r_{f}(u,v)=c(u,v)-f(u,v)$，其反向边 $(v,u)$ 的残差容量定义为 $r_{f}(v,u)=f(u,v)$。根据给定数据：\n$$\n\\begin{aligned}\n&r_{f}(s,a)=10-10=0,\\quad r_{f}(a,s)=10,\\\\\n&r_{f}(s,b)=8-5=3,\\quad r_{f}(b,s)=5,\\\\\n&r_{f}(a,c)=9-8=1,\\quad r_{f}(c,a)=8,\\\\\n&r_{f}(a,d)=6-0=6,\\quad r_{f}(d,a)=0,\\\\\n&r_{f}(b,a)=4-1=3,\\quad r_{f}(a,b)=1,\\\\\n&r_{f}(b,d)=5-4=1,\\quad r_{f}(d,b)=4,\\\\\n&r_{f}(c,t)=7-6=1,\\quad r_{f}(t,c)=6,\\\\\n&r_{f}(d,t)=9-5=4,\\quad r_{f}(t,d)=5,\\\\\n&r_{f}(c,d)=3-2=1,\\quad r_{f}(d,c)=2.\n\\end{aligned}\n$$\n\n根据该过程，对于每个具有正超额流的顶点，我们通过在 $G_{f}$ 中沿一条从该顶点到 $s$ 的、边数最少的路径进行增广，将其全部超额流返回给 $s$。\n\n对于 $a$：存在一条直接的残差边 $a\\to s$，其 $r_{f}(a,s)=10$。该路径长度为1，是最小的。我们沿 $a\\to s$ 增广 $e(a)=3$，这将使 $(s,a)$ 上的原始流减少3：\n$f(s,a)\\leftarrow 10-3=7$。\n\n只更新 $(s,a)$ 的相关残差值：$r_{f}(s,a)=10-7=3$，$r_{f}(a,s)=7$。\n\n对于 $d$：我们现在在（更新后的）残差图中寻找一条从 $d$ 到 $s$ 的最短路径。从 $d$ 出发的可用残差边有 $d\\to b$（容量为4）、$d\\to t$（容量为4）和 $d\\to c$（容量为2）。存在一条路径 $d\\to b\\to s$，其长度为2，残差容量为 $r_{f}(d,b)=4$ 和 $r_{f}(b,s)=5$。这比任何其他备选路径（例如，$d\\to c\\to a\\to s$ 长度为3）都短。因此我们沿 $d\\to b\\to s$ 路径增广 $e(d)=1$，这将使边 $(b,d)$ 和 $(s,b)$ 上的原始流各减少1：\n$f(b,d)\\leftarrow 4-1=3$， $f(s,b)\\leftarrow 5-1=4$。\n\n在这些增广之后，原始非零流边上的新流值为：\n$f(s,a)=7$, $f(s,b)=4$, $f(a,c)=8$, $f(b,a)=1$, $f(b,d)=3$, $f(c,t)=6$, $f(c,d)=2$, $f(d,t)=5$。\n快速检查超额流可知 $e(a)=e(b)=e(c)=e(d)=0$，而 $e(s)=-11$ 且 $e(t)=11$，因此这是一个有效的流。因此，边 $(b,d)$ 上的最终值为 $f'(b,d)=3$。", "answer": "$$\\boxed{3}$$", "id": "1529529"}]}