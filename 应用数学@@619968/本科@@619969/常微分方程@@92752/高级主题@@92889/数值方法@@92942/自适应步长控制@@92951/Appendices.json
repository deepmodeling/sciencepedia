{"hands_on_practices": [{"introduction": "自适应步长控制方法的核心在于根据每一步的局部误差来动态调整步长 $h$。这个练习将揭示这一过程的内部机制，带你手动完成一个基本的自适应步骤。通过比较单步和双步（减半步长）的前向欧拉法结果来估计误差，并利用标准公式计算新的建议步长，你将亲身体验求解器是如何在精度和效率之间取得平衡的 [@problem_id:2158593]。", "problem": "在常微分方程（ODE）的数值解法中，自适应步长控制是平衡精度和计算效率的一项关键技术。其核心思想是在每一步调整步长 $h$，以将局部截断误差保持在期望的容差范围内。\n\n考虑由常微分方程 $y'(t) = y(t)$ 和初始条件 $y(0) = 1$ 给出的初值问题。我们将尝试使用前向欧拉法 $y_{n+1} = y_n + h f(t_n, y_n)$ 从 $t_0=0$ 向前走一步。\n\n为了估计局部误差，我们采用一种常用策略：我们用两种不同的方法计算在 $t_0+h_0$ 处的解。首先，我们使用大小为 $h_0$ 的单步计算，我们称其为 $y_1$。其次，我们使用两个大小为 $h_0/2$ 的连续步骤进行计算，我们称其为 $y_1^*$。绝对差 $E = |y_1 - y_1^*|$ 可作为步长为 $h_0$ 时的局部误差的估计值。\n\n然后，可以使用一阶方法的公式来确定新的“最优”步长 $h_{\\text{new}}$：\n$$h_{\\text{new}} = \\rho h_0 \\left( \\frac{\\text{TOL}}{E} \\right)^{1/2}$$\n其中 $\\rho$ 是一个安全因子，$\\text{TOL}$ 是期望的绝对误差容差。\n\n给定以下参数：\n- 初始试验步长：$h_0 = 0.2$\n- 期望的绝对误差容差：$\\text{TOL} = 0.005$\n- 安全因子：$\\rho = 0.9$\n\n计算此过程建议的新步长 $h_{\\text{new}}$。将你的最终答案四舍五入到三位有效数字。", "solution": "我们有常微分方程 $y'(t)=y(t)$ 和初始条件 $y(0)=1$，并使用前向欧拉法 $y_{n+1}=y_{n}+h f(t_{n},y_{n})$。\n\n从 $t_{0}=0$ 开始，使用大小为 $h_{0}=0.2$ 的单步：\n$$\ny_{1}=y_{0}+h_{0} f(t_{0},y_{0})=1+0.2\\cdot 1=1.2.\n$$\n\n使用两个大小为 $h_{0}/2=0.1$ 的连续步骤：\n第一个半步：\n$$\ny_{1/2}=y_{0}+\\frac{h_{0}}{2} f(t_{0},y_{0})=1+0.1\\cdot 1=1.1.\n$$\n第二个半步：\n$$\ny_{1}^{*}=y_{1/2}+\\frac{h_{0}}{2} f\\left(t_{0}+\\frac{h_{0}}{2},y_{1/2}\\right)=1.1+0.1\\cdot 1.1=1.21.\n$$\n\n误差估计为\n$$\nE=|y_{1}-y_{1}^{*}|=|1.2-1.21|=0.01.\n$$\n\n对于一阶方法，新步长为\n$$\nh_{\\text{new}}=\\rho h_{0}\\left(\\frac{\\text{TOL}}{E}\\right)^{1/2}\n=0.9\\cdot 0.2\\left(\\frac{0.005}{0.01}\\right)^{1/2}\n=0.18\\left(0.5\\right)^{1/2}\n=\\frac{0.18}{\\sqrt{2}}\n\\approx 0.127.\n$$\n\n四舍五入到三位有效数字，建议的新步长为 $0.127$。", "answer": "$$\\boxed{0.127}$$", "id": "2158593"}, {"introduction": "在理解了单步的调整机制后，我们来探讨一个更宏观的问题：我们对精度的要求如何影响总计算量？本练习要求你从理论上分析，当我们将容忍度 $\\epsilon$ 大幅减小时，一个四阶自适应求解器所需的总步数会如何变化。这有助于你深入理解局部截断误差、步长和总计算成本之间的幂律关系，这对于在实际应用中高效地使用数值求解器至关重要 [@problem_id:2158591]。", "problem": "一位计算科学家负责在一个固定的积分区间内数值求解一个良态的常微分方程（ODE）。为此，他们采用了一个四阶自适应步长求解器。该求解器的核心特性是能够在积分的每一点上调整步长 $h$，以将估计的局部截断误差 $E_{local}$ 维持在接近用户定义的容差 $\\epsilon$ 的水平。对于这种特定的四阶方法，其一个基本性质是局部截断误差与步长的五次方成正比，可以表示为 $E_{local} \\propto h^{5}$。\n\n最初，这位科学家运行模拟，并使用容差值 $\\epsilon_{initial}$ 获得了一个满意的解。为了在验证研究中显著提高结果的精度，他们决定以一个更严格的容差重新运行整个模拟，将新容差设置为 $\\epsilon_{final} = \\epsilon_{initial} / 1000$。\n\n假设在整个积分过程中，局部误差和步长之间的比例常数大致保持不变，计算求解该常微分方程在相同区间上所需的总步数预计会增加的理论乘法因子。将您的答案表示为一个数值，并四舍五入到三位有效数字。", "solution": "设局部截断误差为 $E_{local}$，步长为 $h$。问题陈述，对于四阶求解器，局部误差与步长的五次方成正比。我们可以将此关系写为：\n$$E_{local} = C h^{5}$$\n其中 $C$ 是一个比例常数，其值取决于所求解的具体常微分方程及其解的导数。\n\n自适应步长算法会调整 $h$，使得局部误差 $E_{local}$ 约等于用户定义的容差 $\\epsilon$。因此，我们可以设定 $E_{local} \\approx \\epsilon$：\n$$\\epsilon \\approx C h^{5}$$\n\n根据这个关系，我们可以将步长 $h$ 表示为容差 $\\epsilon$ 的函数：\n$$h^{5} \\approx \\frac{\\epsilon}{C} \\implies h \\approx \\left(\\frac{\\epsilon}{C}\\right)^{1/5}$$\n这表明步长 $h$ 与容差的五分之一次方成正比，即 $h \\propto \\epsilon^{1/5}$。\n\n在长度为 $L$ 的固定区间上积分所需的总步数 $N$ 由 $N = L / h_{avg}$ 给出，其中 $h_{avg}$ 是平均步长。假设 $h$ 代表了平均步长，则步数与步长成反比：\n$$N \\propto \\frac{1}{h}$$\n\n现在我们可以将步数 $N$ 直接与容差 $\\epsilon$ 关联起来。因为 $N \\propto 1/h$ 且 $h \\propto \\epsilon^{1/5}$，我们有：\n$$N \\propto \\frac{1}{\\epsilon^{1/5}} \\quad \\text{或} \\quad N \\propto \\epsilon^{-1/5}$$\n\n题目要求我们计算总步数增加的乘法因子，即最终步数 $N_{final}$ 与初始步数 $N_{initial}$ 的比值。使用我们刚刚推导出的比例关系：\n$$\\frac{N_{final}}{N_{initial}} = \\frac{k \\cdot (\\epsilon_{final})^{-1/5}}{k \\cdot (\\epsilon_{initial})^{-1/5}} = \\left(\\frac{\\epsilon_{final}}{\\epsilon_{initial}}\\right)^{-1/5}$$\n其中 $k$ 是比例常数。\n\n问题陈述容差减小了1000倍，所以 $\\epsilon_{final} = \\epsilon_{initial} / 1000$。这意味着比值 $\\frac{\\epsilon_{final}}{\\epsilon_{initial}} = \\frac{1}{1000}$。将此代入我们的步数比值方程中：\n$$\\frac{N_{final}}{N_{initial}} = \\left(\\frac{1}{1000}\\right)^{-1/5} = (1000)^{1/5}$$\n\n现在我们来计算其数值：\n$$(1000)^{1/5} = (10^3)^{1/5} = 10^{3/5} = 10^{0.6}$$\n使用计算器来评估这个表达式：\n$$10^{0.6} \\approx 3.9810717...$$\n\n问题要求答案四舍五入到三位有效数字。前三位有效数字是3、9和8。第四位有效数字是1，小于5，所以我们向下舍入。\n该乘法因子约为3.98。", "answer": "$$\\boxed{3.98}$$", "id": "2158591"}, {"introduction": "自适应方法虽然强大，但并非万无一失，特别是在处理具有不同时间尺度的“刚性”问题时。这个练习设计了一个特殊的线性系统，其中包含一个快速衰减的稳定模式和一个缓慢增长的不稳定模式。通过分析该系统，你将发现为何基于某些范数（如无穷范数 $\\| \\cdot \\|_\\infty$）的误差控制策略可能会被稳定模式“误导”，从而忽略了不稳定模式中不断累积的全局误差，这揭示了理解问题内在结构对于选择合适数值策略的重要性 [@problem_id:2158607]。", "problem": "考虑一个由 $\\vec{y}'(t) = A \\vec{y}(t)$ 描述的二维线性常微分方程(ODE)组，其中 $\\vec{y}(t) = \\begin{pmatrix} y_1(t) \\\\ y_2(t) \\end{pmatrix}$。常数矩阵 $A$ 由下式给出\n$$\nA = \\frac{1}{2} \\begin{pmatrix} -L+\\epsilon & -L-\\epsilon \\\\ -L-\\epsilon & -L+\\epsilon \\end{pmatrix},\n$$\n其中 $L$ 和 $\\epsilon$ 是满足 $L \\gg \\epsilon$ 的正实常数。该系统从初始状态 $\\vec{y}(0) = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$ 开始演化。\n\n该系统具有一个指数衰减的稳定模式和一个指数增长的不稳定模式。其精确解可以分解为 $\\vec{y}(t) = \\vec{y}_s(t) + \\vec{y}_u(t)$，其中 $\\vec{y}_s(t)$ 代表解的稳定部分（即，当 $t \\to \\infty$ 时，$\\vec{y}_s(t) \\to \\vec{0}$），而 $\\vec{y}_u(t)$ 代表不稳定部分。\n\n当使用自适应步长方法对此类系统进行数值求解时，算法会在每一步估计局部误差。对于许多方法，此局部误差估计与解的二阶导数 $\\vec{y}''(t)$ 成正比。一种常见的步长控制策略旨在将此误差向量的量值（以无穷范数 $\\|\\vec{y}''(t)\\|_\\infty$ 衡量）保持在某个容差以下。如果不稳定模式对此范数的贡献可以忽略不计，那么该策略可能会出现问题，因为算法可能无法控制该模式下全局误差的增长。\n\n令误差估计向量的不稳定部分定义为 $\\vec{\\delta}_{unstable}(t) = \\vec{y}_u''(t)$。我们希望找到不稳定模式对误差估计的贡献变得显著的时间。确定时间 $t^*$，在该时间点，不稳定贡献的无穷范数恰好是总误差估计向量的无穷范数的一半。即，求 $t^*$ 使得\n$$\n\\|\\vec{\\delta}_{unstable}(t^*)\\|_\\infty = \\frac{1}{2} \\|\\vec{y}''(t^*)\\|_\\infty.\n$$\n请用 $L$ 和 $\\epsilon$ 表示您的答案，形式为一个闭式解析表达式。", "solution": "我们分析线性系统 $\\vec{y}'(t)=A\\vec{y}(t)$，其中\n$$\nA=\\frac{1}{2}\\begin{pmatrix}-L+\\epsilon & -L-\\epsilon\\\\ -L-\\epsilon & -L+\\epsilon\\end{pmatrix}.\n$$\n引入对称矩阵 $J=\\begin{pmatrix}1 & 1\\\\ 1 & 1\\end{pmatrix}$ 和 $K=\\begin{pmatrix}1 & -1\\\\ -1 & 1\\end{pmatrix}$，从而 $A=-\\frac{L}{2}J+\\frac{\\epsilon}{2}K$。向量 $v_{s}=\\begin{pmatrix}1\\\\ 1\\end{pmatrix}$ 和 $v_{u}=\\begin{pmatrix}1\\\\ -1\\end{pmatrix}$ 是特征向量，因为 $Jv_{s}=2v_{s}$，$Kv_{s}=0$，$Jv_{u}=0$，$Kv_{u}=2v_{u}$。因此\n$$\nA v_{s}=-L v_{s},\\qquad A v_{u}=\\epsilon v_{u},\n$$\n所以特征值为 $\\lambda_{s}=-L$（稳定）和 $\\lambda_{u}=\\epsilon$（不稳定）。\n\n将初始条件 $\\vec{y}(0)=\\begin{pmatrix}1\\\\ 0\\end{pmatrix}$ 分解为 $\\vec{y}(0)=c_{s}v_{s}+c_{u}v_{u}$。求解 $\\begin{pmatrix}1\\\\ 0\\end{pmatrix}=c_{s}\\begin{pmatrix}1\\\\ 1\\end{pmatrix}+c_{u}\\begin{pmatrix}1\\\\ -1\\end{pmatrix}$ 得到 $c_{s}+c_{u}=1$ 和 $c_{s}-c_{u}=0$，因此 $c_{s}=c_{u}=\\frac{1}{2}$。精确解为\n$$\n\\vec{y}(t)=\\frac{1}{2}\\exp(-Lt)\\,v_{s}+\\frac{1}{2}\\exp(\\epsilon t)\\,v_{u}.\n$$\n对于常系数线性齐次系统，$\\vec{y}''(t)=A^{2}\\vec{y}(t)$，并且对于每个模式，求导相当于乘以其特征值。因此\n$$\n\\vec{y}''(t)=\\frac{1}{2}L^{2}\\exp(-Lt)\\,v_{s}+\\frac{1}{2}\\epsilon^{2}\\exp(\\epsilon t)\\,v_{u}.\n$$\n误差估计的不稳定部分为 $\\vec{\\delta}_{unstable}(t)=\\vec{y}_{u}''(t)=\\frac{1}{2}\\epsilon^{2}\\exp(\\epsilon t)\\,v_{u}$。由于 $\\|v_{u}\\|_{\\infty}=1$，我们有\n$$\n\\|\\vec{\\delta}_{unstable}(t)\\|_{\\infty}=\\frac{1}{2}\\epsilon^{2}\\exp(\\epsilon t).\n$$\n总误差估计向量的分量为\n$$\n\\vec{y}''(t)=\\frac{1}{2}\\begin{pmatrix}L^{2}\\exp(-Lt)+\\epsilon^{2}\\exp(\\epsilon t)\\\\ L^{2}\\exp(-Lt)-\\epsilon^{2}\\exp(\\epsilon t)\\end{pmatrix}.\n$$\n定义 $X=L^{2}\\exp(-Lt)$ 和 $Y=\\epsilon^{2}\\exp(\\epsilon t)$。那么分量为 $\\frac{1}{2}(X+Y)$ 和 $\\frac{1}{2}(X-Y)$，因此\n$$\n\\|\\vec{y}''(t)\\|_{\\infty}=\\max\\!\\left(\\frac{1}{2}(X+Y),\\,\\frac{1}{2}|X-Y|\\right).\n$$\n对于 $X\\ge 0$ 和 $Y\\ge 0$，不等式 $X+Y\\ge |X-Y|$ 意味着\n$$\n\\|\\vec{y}''(t)\\|_{\\infty}=\\frac{1}{2}(X+Y)=\\frac{1}{2}\\left(L^{2}\\exp(-Lt)+\\epsilon^{2}\\exp(\\epsilon t)\\right).\n$$\n我们要求 $t^{*}$ 满足\n$$\n\\|\\vec{\\delta}_{unstable}(t^{*})\\|_{\\infty}=\\frac{1}{2}\\|\\vec{y}''(t^{*})\\|_{\\infty}.\n$$\n代入表达式可得\n$$\n\\frac{1}{2}\\epsilon^{2}\\exp(\\epsilon t^{*})=\\frac{1}{2}\\cdot\\frac{1}{2}\\left(L^{2}\\exp(-Lt^{*})+\\epsilon^{2}\\exp(\\epsilon t^{*})\\right),\n$$\n化简为\n$$\n2\\,\\epsilon^{2}\\exp(\\epsilon t^{*})=L^{2}\\exp(-Lt^{*})+\\epsilon^{2}\\exp(\\epsilon t^{*})\\quad\\Longrightarrow\\quad \\epsilon^{2}\\exp(\\epsilon t^{*})=L^{2}\\exp(-Lt^{*}).\n$$\n两边取自然对数可得\n$$\n2\\ln\\epsilon+\\epsilon t^{*}=2\\ln L - L t^{*}\\quad\\Longrightarrow\\quad (L+\\epsilon)t^{*}=2\\ln\\!\\left(\\frac{L}{\\epsilon}\\right).\n$$\n因此，\n$$\nt^{*}=\\frac{2\\,\\ln\\!\\left(\\frac{L}{\\epsilon}\\right)}{L+\\epsilon}.\n$$\n这是一个用 $L$ 和 $\\epsilon$ 表示的闭式解析表达式。", "answer": "$$\\boxed{\\frac{2\\,\\ln\\!\\left(\\frac{L}{\\epsilon}\\right)}{L+\\epsilon}}$$", "id": "2158607"}]}