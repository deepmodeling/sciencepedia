{"hands_on_practices": [{"introduction": "我们的动手实践始于随机积分中最基础的例子。这个练习要求你计算布朗运动对自身的斯特拉托诺维奇积分 $\\int_0^t B_s \\circ dB_s$。这个实践将直接展示斯特拉托诺维奇积分的关键特性：它遵循经典微积分中的链式法则。通过解决这个问题 [@problem_id:3004197]，你将巩固对这一性质的理解，并看清它与伊腾积分结果的根本差异。", "problem": "设 $ (B_s)_{s \\in [0,t]} $ 为一个标准布朗运动，且 $ B_0 = 0 $。考虑 Stratonovich 积分 $ \\int_{0}^{t} B_s \\circ dB_s $，该积分通过对称黎曼和定义，其特征在于它与适用于光滑变换的经典链式法则相符。从随机分析的基本性质出发，包括布朗运动的二次变差 $ [B]_t = t $ 和连续半鞅的 Itô 公式，推导 $ \\int_{0}^{t} B_s \\circ dB_s $ 的一个闭式表达式，该表达式仅用 $ B_t $ 表示。然后，运用同样的基本原理，计算 $ \\int_{0}^{t} B_s \\, dB_s $，并通过 $ [B]_t $ 将 Stratonovich 积分与 Itô 积分联系起来，以证明对于此被积过程，两者是一致的。最终答案必须是 $ \\int_{0}^{t} B_s \\circ dB_s $ 的闭式表达式，且仅用 $ B_t $ 表示。", "solution": "问题陈述经过验证，确认为有效。在随机分析已建立的数学框架内，这是一个适定问题，所有必要的条件和定义均已提供。不存在科学或逻辑上的矛盾，且语言表述清晰明确。\n\n根据题目要求，我们需要推导 Stratonovich 积分 $\\int_{0}^{t} B_s \\circ dB_s$ 的闭式表达式，并使用随机分析的基本原理证明其与相应 Itô 积分的一致性。\n\n问题指出，Stratonovich 积分的特征在于它与经典链式法则相符。我们可以利用这一性质进行直接计算。我们考虑函数 $f(x) = \\frac{1}{2}x^{2}$。该函数的微分是 $df(x) = f'(x)dx = x\\,dx$。在 Stratonovich 微积分的背景下，对过程 $f(B_t)$ 应用链式法则，可得：\n$$\nd(f(B_t)) = f'(B_t) \\circ dB_t\n$$\n代入 $f(B_t) = \\frac{1}{2}B_t^{2}$ 和 $f'(B_t) = B_t$，我们得到：\n$$\nd\\left(\\frac{1}{2}B_t^{2}\\right) = B_t \\circ dB_t\n$$\n将此微分表达式从 $s=0$ 到 $s=t$ 进行积分，得到：\n$$\n\\int_{0}^{t} d\\left(\\frac{1}{2}B_s^{2}\\right) = \\int_{0}^{t} B_s \\circ dB_s\n$$\n左边的积分是函数 $\\frac{1}{2}B_s^{2}$ 从 $s=0$ 到 $s=t$ 的变化量，即 $\\frac{1}{2}B_t^{2} - \\frac{1}{2}B_0^{2}$。根据初始条件 $B_0 = 0$，该式简化为 $\\frac{1}{2}B_t^{2}$。因此，我们得到了 Stratonovich 积分的闭式表达式：\n$$\n\\int_{0}^{t} B_s \\circ dB_s = \\frac{1}{2}B_t^{2}\n$$\n接下来，按照题目要求，我们计算相应的 Itô 积分 $\\int_{0}^{t} B_s \\, dB_s$ 并证明一致性。为计算 Itô 积分，我们将 Itô 公式应用于同一函数 $f(B_t) = \\frac{1}{2}B_t^{2}$。对于一个 Itô 过程（在此情况下为标准布朗运动 $B_t$）的函数，其 Itô 公式为：\n$$\ndf(B_t) = f'(B_t)dB_t + \\frac{1}{2}f''(B_t)d[B]_t\n$$\n函数 $f(x) = \\frac{1}{2}x^{2}$ 的导数为 $f'(x) = x$ 和 $f''(x) = 1$。标准布朗运动的二次变差为 $[B]_t = t$，因此其微分形式为 $d[B]_t = dt$。将这些代入 Itô 公式，我们得到：\n$$\nd\\left(\\frac{1}{2}B_t^{2}\\right) = B_t \\, dB_t + \\frac{1}{2}(1)dt\n$$\n从 $s=0$ 积分到 $s=t$：\n$$\n\\int_{0}^{t} d\\left(\\frac{1}{2}B_s^{2}\\right) = \\int_{0}^{t} B_s \\, dB_s + \\int_{0}^{t} \\frac{1}{2}ds\n$$\n计算各项，左边为 $\\frac{1}{2}B_t^{2} - \\frac{1}{2}B_0^{2}$，即 $\\frac{1}{2}B_t^{2}$；右边第二项积分为 $\\frac{1}{2}t$。由此得到方程：\n$$\n\\frac{1}{2}B_t^{2} = \\int_{0}^{t} B_s \\, dB_s + \\frac{1}{2}t\n$$\n求解 Itô 积分，我们发现：\n$$\n\\int_{0}^{t} B_s \\, dB_s = \\frac{1}{2}B_t^{2} - \\frac{1}{2}t\n$$\n最后，我们使用一般转换公式来证明 Itô 积分和 Stratonovich 积分之间的一致性。该公式对于一个被积过程 $X_s$ 和一个积分过程 $Y_s$ 将两者关联起来：\n$$\n\\int_{0}^{t} X_s \\circ dY_s = \\int_{0}^{t} X_s \\, dY_s + \\frac{1}{2}[X, Y]_t\n$$\n在我们的特定情况下，$X_s = B_s$ 且 $Y_s = B_s$。二次协变差 $[B, B]_t$ 与二次变差 $[B]_t$ 相同。因此公式变为：\n$$\n\\int_{0}^{t} B_s \\circ dB_s = \\int_{0}^{t} B_s \\, dB_s + \\frac{1}{2}[B]_t\n$$\n利用已知条件 $[B]_t = t$，我们有：\n$$\n\\int_{0}^{t} B_s \\circ dB_s = \\int_{0}^{t} B_s \\, dB_s + \\frac{1}{2}t\n$$\n现在，我们可以用我们推导出的表达式来验证这一关系。将我们得到的 Stratonovich 积分结果代入左侧，并将 Itô 积分结果代入右侧：\n$$\n\\frac{1}{2}B_t^{2} = \\left(\\frac{1}{2}B_t^{2} - \\frac{1}{2}t\\right) + \\frac{1}{2}t\n$$\n$$\n\\frac{1}{2}B_t^{2} = \\frac{1}{2}B_t^{2}\n$$\n等式成立，这证实了我们的结果与连接 Itô 和 Stratonovich 积分的既定理论相符。所求的最终答案是 Stratonovich 积分 $\\int_{0}^{t} B_s \\circ dB_s$ 的闭式表达式。", "answer": "$$\n\\boxed{\\frac{1}{2}B_t^{2}}\n$$", "id": "3004197"}, {"introduction": "在看到了伊腾积分和斯特拉托诺维奇积分的区别之后，理解它们何时会相等也同样重要。这个练习 [@problem_id:3004185] 探讨了一个关键的特例，即被积函数是一个确定性的、非随机的函数。通过证明一个确定性函数与布朗运动之间的二次协变差为零，你将揭示为何伊腾-斯特拉托诺维奇转换的修正项会消失，从而使得两种积分得到相同的结果。", "problem": "设 $(\\Omega,\\mathcal{F},(\\mathcal{F}_t)_{t\\in[0,T]},\\mathbb{P})$ 是一个支撑标准布朗运动的过滤概率空间。标准布朗运动是一个连续随机过程 $W=(W_t)_{t\\in[0,T]}$，满足 $W_0=0$，具有独立增量，且对于 $0\\leq s<t\\leq T$，增量 $W_t-W_s$ 服从均值为 $0$、方差为 $t-s$ 的正态分布。设 $h:[0,T]\\to\\mathbb{R}$ 是一个 $C^1([0,T])$ 类的确定性函数。\n\n对于 $t\\in(0,T]$，将 Itô 积分 $\\int_0^t h(s)\\,dW_s$ 定义为在分割 $\\pi=\\{0=t_0<t_1<\\dots<t_n=t\\}$ 的网格尺寸 $|\\pi|:=\\max_i(t_i-t_{i-1})\\to 0$ 时，左端点黎曼和依概率收敛的极限：\n$$\n\\sum_{i=1}^n h(t_{i-1})\\big(W_{t_i}-W_{t_{i-1}}\\big),\n$$\n并将 Stratonovich 积分 $\\int_0^t h(s)\\circ dW_s$ 定义为中点黎曼和依概率收敛的极限：\n$$\n\\sum_{i=1}^n h\\!\\left(\\frac{t_{i-1}+t_i}{2}\\right)\\big(W_{t_i}-W_{t_{i-1}}\\big).\n$$\n两个连续过程 $X=(X_t)_{t\\in[0,T]}$ 和 $Y=(Y_t)_{t\\in[0,T]}$ 的二次协变差定义为\n$$\n[X,Y]_t:=\\lim_{|\\pi|\\to 0}\\sum_{i=1}^n \\big(X_{t_i}-X_{t_{i-1}}\\big)\\big(Y_{t_i}-Y_{t_{i-1}}\\big),\n$$\n前提是该极限依概率存在。\n\n仅从这些定义以及布朗运动和可微确定性函数的基本性质出发，通过将量\n$$\nD_t:=\\int_0^t h(s)\\circ dW_s-\\int_0^t h(s)\\,dW_s\n$$\n与 $[h,W]_t$ 联系起来，并对确定性 $C^1$ 函数 $h$ 求出 $[h,W]_t$ 的值，来计算 $D_t$。请以单个解析表达式的形式给出最终答案。无需四舍五入。", "solution": "用户希望基于所提供的定义，计算确定性 $C^1$ 被积函数的 Stratonovich 积分与 Itô 积分之差。令 $D_t = \\int_0^t h(s)\\circ dW_s - \\int_0^t h(s)\\,dW_s$。\n\n问题验证如下：\n- **已知条件**：一个过滤概率空间 $(\\Omega,\\mathcal{F},(\\mathcal{F}_t)_{t\\in[0,T]},\\mathbb{P})$，一个标准布朗运动 $W=(W_t)_{t\\in[0,T]}$，一个确定性 $C^1$ 函数 $h:[0,T]\\to\\mathbb{R}$，以及 Itô 积分、Stratonovich 积分（中点法则）和二次协变差 $[X,Y]_t$ 的定义。\n- **验证**：所有已知条件都是随机微积分中的标准概念。该问题有科学依据、是适定的且客观。它要求从第一性原理推导一个基本结果。该问题被认定为**有效**。\n\n我们被要求通过将 $D_t$ 与二次协变差 $[h, W]_t$ 联系起来，然后求出 $[h, W]_t$ 的值，来计算 $D_t$。\n\n首先，我们建立 $D_t$ 和 $[h, W]_t$ 之间的关系。\nStratonovich 积分使用中点法则定义：\n$$\n\\int_0^t h(s)\\circ dW_s = \\lim_{|\\pi|\\to 0} \\sum_{i=1}^n h\\left(\\frac{t_{i-1}+t_i}{2}\\right)\\big(W_{t_i}-W_{t_{i-1}}\\big)\n$$\n其中极限是在分割 $\\pi=\\{0=t_0<t_1<\\dots<t_n=t\\}$ 的网格尺寸 $|\\pi|\\to 0$ 时的依概率极限。\n\nItô 积分使用左端点法则定义：\n$$\n\\int_0^t h(s)\\,dW_s = \\lim_{|\\pi|\\to 0} \\sum_{i=1}^n h(t_{i-1})\\big(W_{t_i}-W_{t_{i-1}}\\big)\n$$\n\n因此，差值 $D_t$ 是相应黎曼和之差的极限：\n$$\nD_t = \\lim_{|\\pi|\\to 0} \\sum_{i=1}^n \\left[ h\\left(\\frac{t_{i-1}+t_i}{2}\\right) - h(t_{i-1}) \\right] \\big(W_{t_i}-W_{t_{i-1}}\\big)\n$$\n一种常见的处理方法是将中点 $h(\\frac{t_{i-1}+t_i}{2})$ 与对称平均 $\\frac{1}{2}(h(t_{i-1})+h(t_i))$ 联系起来。由于 $h$ 是 $C^1$ 类函数，我们可以使用 Taylor 定理。设 $\\bar{t}_i = \\frac{t_{i-1}+t_i}{2}$ 且 $\\Delta t_i = t_i-t_{i-1}$。\n我们可以写出：\n$$\nh(t_{i-1}) = h(\\bar{t}_i - \\frac{\\Delta t_i}{2}) = h(\\bar{t}_i) - h'(\\bar{t}_i)\\frac{\\Delta t_i}{2} + R_{i,1}\n$$\n$$\nh(t_{i}) = h(\\bar{t}_i + \\frac{\\Delta t_i}{2}) = h(\\bar{t}_i) + h'(\\bar{t}_i)\\frac{\\Delta t_i}{2} + R_{i,2}\n$$\n其中余项 $R_{i,1}$ 和 $R_{i,2}$ 都是 $o(\\Delta t_i)$。将这两个表达式相加可得：\n$$\nh(t_{i-1}) + h(t_i) = 2h(\\bar{t}_i) + o(\\Delta t_i)\n$$\n我们合并了余项。整理可得：\n$$\nh\\left(\\frac{t_{i-1}+t_i}{2}\\right) = \\frac{h(t_{i-1})+h(t_i)}{2} + o(\\Delta t_i)\n$$\n因此，Stratonovich 和可以写为：\n$$\n\\sum_{i=1}^n h\\left(\\frac{t_{i-1}+t_i}{2}\\right)\\Delta W_i = \\sum_{i=1}^n \\left(\\frac{h(t_{i-1})+h(t_i)}{2} + o(\\Delta t_i)\\right) \\Delta W_i\n$$\n其中 $\\Delta W_i = W_{t_i}-W_{t_{i-1}}$。当 $|\\pi|\\to 0$ 时，余项的和 $\\sum o(\\Delta t_i) \\Delta W_i$ 依概率收敛于 $0$。要证明这一点，注意到其期望为 $0$，方差为 $\\sum_{i=1}^n (o(\\Delta t_i))^2 \\mathbb{E}[(\\Delta W_i)^2] = \\sum_{i=1}^n (o(\\Delta t_i))^2 \\Delta t_i$，当 $|\\pi|\\to 0$ 时，该方差趋于 $0$。\n因此，Stratonovich 和的极限等价于对称和的极限：\n$$\n\\int_0^t h(s)\\circ dW_s = \\lim_{|\\pi|\\to 0} \\sum_{i=1}^n \\frac{h(t_{i-1})+h(t_i)}{2} \\Delta W_i\n$$\n现在我们可以计算 $D_t$：\n$$\nD_t = \\lim_{|\\pi|\\to 0} \\sum_{i=1}^n \\left( \\frac{h(t_{i-1})+h(t_i)}{2} - h(t_{i-1}) \\right) \\Delta W_i\n$$\n$$\nD_t = \\lim_{|\\pi|\\to 0} \\sum_{i=1}^n \\frac{h(t_i)-h(t_{i-1})}{2} \\Delta W_i\n$$\n$$\nD_t = \\frac{1}{2} \\lim_{|\\pi|\\to 0} \\sum_{i=1}^n \\big(h(t_i)-h(t_{i-1})\\big) \\big(W_{t_i}-W_{t_{i-1}}\\big)\n$$\n右侧的极限恰好是二次协变差 $[h, W]_t$ 的定义。因此，我们建立了如下关系：\n$$\nD_t = \\frac{1}{2} [h, W]_t\n$$\n下一步是计算 $[h, W]_t$。设和为 $Q_n(\\pi) = \\sum_{i=1}^n \\big(h(t_i)-h(t_{i-1})\\big)\\big(W_{t_i}-W_{t_{i-1}}\\big)$。我们需要求当 $|\\pi|\\to 0$ 时 $Q_n(\\pi)$ 的极限。我们将通过证明其 $L^2$ 收敛来表明该极限为 $0$，而 $L^2$ 收敛意味着依概率收敛。\n\n首先，我们计算 $Q_n(\\pi)$ 的期望。布朗运动的增量 $\\Delta W_i$ 独立于过去且均值为零。由于 $h(t_i)$ 和 $h(t_{i-1})$ 是确定性值，我们有：\n$$\n\\mathbb{E}[Q_n(\\pi)] = \\mathbb{E}\\left[\\sum_{i=1}^n \\big(h(t_i)-h(t_{i-1})\\big)\\Delta W_i\\right] = \\sum_{i=1}^n \\big(h(t_i)-h(t_{i-1})\\big)\\mathbb{E}[\\Delta W_i] = \\sum_{i=1}^n \\big(h(t_i)-h(t_{i-1})\\big) \\cdot 0 = 0\n$$\n接下来，我们计算 $Q_n(\\pi)$ 的方差。由于增量 $\\Delta W_i$ 是独立的，和的方差等于方差的和：\n$$\n\\text{Var}(Q_n(\\pi)) = \\text{Var}\\left(\\sum_{i=1}^n \\big(h(t_i)-h(t_{i-1})\\big)\\Delta W_i\\right) = \\sum_{i=1}^n \\text{Var}\\left(\\big(h(t_i)-h(t_{i-1})\\big)\\Delta W_i\\right)\n$$\n对常数 $c$ 和随机变量 $Z$ 使用 $\\text{Var}(cZ)=c^2\\text{Var}(Z)$，且 $\\mathbb{E}[\\Delta W_i]=0$：\n$$\n\\text{Var}(Q_n(\\pi)) = \\sum_{i=1}^n \\big(h(t_i)-h(t_{i-1})\\big)^2 \\text{Var}(\\Delta W_i) = \\sum_{i=1}^n \\big(h(t_i)-h(t_{i-1})\\big)^2 \\mathbb{E}[(\\Delta W_i)^2]\n$$\n我们知道 $\\mathbb{E}[(\\Delta W_i)^2] = \\text{Var}(\\Delta W_i) = t_i - t_{i-1} = \\Delta t_i$。\n$$\n\\text{Var}(Q_n(\\pi)) = \\sum_{i=1}^n \\big(h(t_i)-h(t_{i-1})\\big)^2 \\Delta t_i\n$$\n由于 $h$ 是 $C^1([0,T])$ 类函数，根据中值定理，对每个区间 $[t_{i-1}, t_i]$，存在一个 $\\tau_i \\in (t_{i-1}, t_i)$ 使得 $h(t_i)-h(t_{i-1}) = h'(\\tau_i)(t_i-t_{i-1}) = h'(\\tau_i)\\Delta t_i$。\n将此代入方差表达式：\n$$\n\\text{Var}(Q_n(\\pi)) = \\sum_{i=1}^n \\big(h'(\\tau_i)\\Delta t_i\\big)^2 \\Delta t_i = \\sum_{i=1}^n \\big(h'(\\tau_i)\\big)^2 (\\Delta t_i)^3\n$$\n函数 $h'$ 在紧区间 $[0,T]$ 上是连续的，因此是有界的。设 $M = \\sup_{s\\in[0,T]} |h'(s)| < \\infty$。因此，方差可以被约束为：\n$$\n\\text{Var}(Q_n(\\pi)) \\le M^2 \\sum_{i=1}^n (\\Delta t_i)^3\n$$\n由于 $\\sum_{i=1}^n (\\Delta t_i)^3 \\le \\max_i(\\Delta t_i)^2 \\sum_{i=1}^n \\Delta t_i = |\\pi|^2 t$，我们得到：\n$$\n\\text{Var}(Q_n(\\pi)) \\le M^2 |\\pi|^2 t\n$$\n当网格尺寸 $|\\pi| \\to 0$ 时，方差 $\\text{Var}(Q_n(\\pi)) \\to 0$。\n由于 $\\mathbb{E}[Q_n(\\pi)]=0$ 且 $\\text{Var}(Q_n(\\pi))\\to 0$，$Q_n(\\pi)$ 在 $L^2$ 中收敛于 $0$，因此依概率收敛。\n我们得出结论：\n$$\n[h, W]_t = \\lim_{|\\pi|\\to 0} Q_n(\\pi) = 0\n$$\n这个结果是符合预期的：任何确定性 $C^1$ 函数的二次变差（和协变差）均为零，因为其样本路径具有有限的一阶变差。\n\n最后，我们将此结果代回 $D_t$ 的表达式中：\n$$\nD_t = \\frac{1}{2} [h, W]_t = \\frac{1}{2} \\cdot 0 = 0\n$$\n因此，对于确定性 $C^1$ 函数，关于布朗运动的 Itô 积分和 Stratonovich 积分是相同的。", "answer": "$$\n\\boxed{0}\n$$", "id": "3004185"}, {"introduction": "理论知识在应用时才真正显示出其力量。最后的这个实践 [@problem_id:3003906] 将引导你模拟一个斯特拉托诺维奇随机微分方程（SDE），从而在抽象公式和计算现实之间架起一座桥梁。你将实现两种不同但等价的方法——直接中点格式和修正漂移项的伊腾格式——来亲身体验转换规则如何运作，并验证斯特拉托诺维奇积分在离散环境下确实保留了经典的链式法则。", "problem": "考虑一个标量 Stratonovich 随机微分方程 (SDE)，其形式为 $dx_t = a(x_t,t)\\,dt + b(x_t,t)\\circ dW_t$，其中 $W_t$ 是一个标准维纳过程，$a(\\cdot,\\cdot)$ 是漂移函数，$b(\\cdot,\\cdot)$ 是扩散函数。Stratonovich 积分被定义为对称黎曼和的极限，在离散时间下对应于中点取值。从维纳过程的定义、Stratonovich 积分的对称黎曼和特征、Itô 积分以及二次变差的概念这些基本定义出发，为该 Stratonovich SDE 实现两种模拟策略：\n- 一种通过半步校正与 Stratonovich 解释一致的中点预测-校正 (Heun 型) 格式。\n- 通过调整漂移项将 Stratonovich SDE 转换为等价的 Itô SDE，然后通过显式 Euler 格式进行模拟。\n\n此外，对一个光滑函数 $f$ 数值验证 Stratonovich 链式法则：当动力学在 Stratonovich 意义下解释时，一个基于中点黎曼和的离散化应该用 $\\sum_k f'(x_{t_{k+\\frac{1}{2}}})(x_{t_{k+1}}-x_{t_k})$ 来近似 $f(x_T) - f(x_0)$，其中 $x_{t_{k+\\frac{1}{2}}}$ 表示中点状态。为两种模拟策略使用相同的布朗增量，以便进行直接比较。\n\n您的程序必须：\n1. 实现基于预测-校正步骤的 Stratonovich 中点 (Heun) 格式，该格式近似了对称积分。\n2. 实现对漂移调整后的 SDE 的 Itô 模拟，该 SDE 是通过将 Stratonovich SDE 转换为 Itô 形式得到的。转换推导必须仅从基本定义和性质（如适当的极限和二次变差）出发，不得使用文献中的现成公式；您需要在您的解决方案中推导出所需的关系。\n3. 对每个测试用例，计算两个定量诊断指标：\n   - 平均绝对链式法则误差，定义为在所有模拟路径上的 $\\mathbb{E}\\left[\\left|f(x_T) - f(x_0) - \\sum_{k=0}^{N-1} f'\\!\\left(\\frac{x_{t_{k+1}} + x_{t_k}}{2}\\right)\\left(x_{t_{k+1}} - x_{t_k}\\right)\\right|\\right]$。\n   - Stratonovich 中点格式与漂移调整后的 Itô Euler 格式之间的平均绝对终态差异，定义为 $\\mathbb{E}\\left[\\left|x_T^{\\text{Strat}} - x_T^{\\text{It\\hat{o}}}\\right|\\right]$。\n4. 每个测试用例使用固定的随机种子，以使结果可复现。\n\n测试套件：\n提供以下四个测试用例，涵盖一般情况、非线性乘性情况、仅含漂移项的边界情况和粗时间步长情况。\n\n- 测试用例 1 (一般乘性噪声):\n  - $a(x) = \\alpha x$，其中 $\\alpha = 0.2$。\n  - $b(x) = \\beta x$，其中 $\\beta = 0.5$。\n  - $b'(x) = \\beta$。\n  - $f(x) = x^2$, $f'(x) = 2x$。\n  - 初始条件 $x_0 = 1.0$。\n  - 时间范围 $T = 1.0$。\n  - 步数 $N = 2000$。\n  - 路径数 $M = 200$。\n  - 固定种子 $s = 12345$。\n\n- 测试用例 2 (非线性乘性噪声):\n  - $a(x) = -0.1 x^3$。\n  - $b(x) = 0.6 x^2$。\n  - $b'(x) = 1.2 x$。\n  - $f(x) = x^3$, $f'(x) = 3x^2$。\n  - 初始条件 $x_0 = 0.4$。\n  - 时间范围 $T = 0.4$。\n  - 步数 $N = 3000$。\n  - 路径数 $M = 150$。\n  - 固定种子 $s = 67890$。\n\n- 测试用例 3 (仅含漂移项的边界情况):\n  - $a(x) = \\sin(x)$。\n  - $b(x) = 0$。\n  - $b'(x) = 0$。\n  - $f(x) = \\cos(x)$, $f'(x) = -\\sin(x)$。\n  - 初始条件 $x_0 = 0.7$。\n  - 时间范围 $T = 1.0$。\n  - 步数 $N = 2000$。\n  - 路径数 $M = 200$。\n  - 固定种子 $s = 13579$。\n\n- 测试用例 4 (测试用例 1 的粗时间步长变体):\n  - $a(x) = \\alpha x$，其中 $\\alpha = 0.2$。\n  - $b(x) = \\beta x$，其中 $\\beta = 0.5$。\n  - $b'(x) = \\beta$。\n  - $f(x) = x^2$, $f'(x) = 2x$。\n  - 初始条件 $x_0 = 1.0$。\n  - 时间范围 $T = 1.0$。\n  - 步数 $N = 200$。\n  - 路径数 $M = 200$。\n  - 固定种子 $s = 24680$。\n\n输出规范：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例对应一对浮点数 $[\\text{mean\\_chain\\_error},\\text{mean\\_method\\_diff}]$，格式化为小数点后六位的科学记数法。\n- 具体来说，最终输出必须是 $[[e_1,d_1],[e_2,d_2],[e_3,d_3],[e_4,d_4]]$ 的形式，不含任何空格。\n\n此问题不涉及物理单位、角度单位或百分比。所有返回的数值结果必须是浮点数。", "solution": "用户提供的问题陈述已经过分析和验证。该问题被认定为具有科学依据、良定且客观。它提出了一个计算随机分析中标准但非平凡的练习，要求从基本原理出发推导 Itô 积分和 Stratonovich 积分之间的关系，并实现两种不同的数值格式来求解随机微分方程 (SDE)。该问题是有效的，将提供解决方案。\n\n问题的核心在于对随机积分的不同解释。给定一个 Stratonovich SDE：\n$$dx_t = a(x_t,t)\\,dt + b(x_t,t)\\circ dW_t$$\n其中 $\\circ dW_t$ 表示 Stratonovich 意义下的积分。任务是使用两种方法模拟此 SDE：一种直接近似 Stratonovich 积分，另一种首先将 SDE 转换为其等价的 Itô 形式。\n\n**1. Itô-Stratonovich 转换公式的推导**\n\n问题要求从基本原理推导转换公式。Stratonovich 积分被定义为对称黎曼和的极限。对于一个小的时间区间 $[t_k, t_{k+1}]$，该积分近似为：\n$$\\int_{t_k}^{t_{k+1}} b(x_t) \\circ dW_t \\approx b\\left(\\frac{x_{t_k} + x_{t_{k+1}}}{2}\\right) (W_{t_{k+1}} - W_{t_k})$$\n相比之下，Itô 积分使用左点取值定义：\n$$\\int_{t_k}^{t_{k+1}} b(x_t) dW_t \\approx b(x_{t_k}) (W_{t_{k+1}} - W_{t_k})$$\n为了找到它们之间的关系，我们在 Stratonovich 和中展开项 $b\\left(\\frac{x_{t_k} + x_{t_{k+1}}}{2}\\right)$。为简洁起见，令 $\\Delta W_k = W_{t_{k+1}} - W_{t_k}$ 且 $\\Delta x_k = x_{t_{k+1}} - x_{t_k}$。我们还假设函数 $a$ 和 $b$ 足够光滑，并且根据测试用例仅依赖于 $x$。$b(x)$ 在 $x_{t_k}$ 附近的泰勒展开为：\n$$b\\left(\\frac{x_{t_k} + x_{t_k} + \\Delta x_k}{2}\\right) = b\\left(x_{t_k} + \\frac{1}{2}\\Delta x_k\\right) \\approx b(x_{t_k}) + \\frac{1}{2}b'(x_{t_k})\\Delta x_k + O((\\Delta x_k)^2)$$\n增量 $\\Delta x_k$ 由 SDE 本身给出。对于小的时间步长 $\\Delta t = t_{k+1} - t_k$，到一阶精度，主导项是随机项：\n$$\\Delta x_k = a(x_{t_k})\\Delta t + b(x_{t_k})\\Delta W_k \\approx b(x_{t_k})\\Delta W_k$$\n将 $\\Delta x_k$ 的这个近似代入泰勒展开式中：\n$$b\\left(\\frac{x_{t_k} + x_{t_{k+1}}}{2}\\right) \\approx b(x_{t_k}) + \\frac{1}{2}b'(x_{t_k})b(x_{t_k})\\Delta W_k$$\n现在，将此结果代回到 Stratonovich 积分的近似式中：\n$$b\\left(\\frac{x_{t_k} + x_{t_{k+1}}}{2}\\right) \\Delta W_k \\approx \\left( b(x_{t_k}) + \\frac{1}{2}b'(x_{t_k})b(x_{t_k})\\Delta W_k \\right) \\Delta W_k$$\n$$= b(x_{t_k})\\Delta W_k + \\frac{1}{2}b'(x_{t_k})b(x_{t_k})(\\Delta W_k)^2$$\n对所有区间求和并取极限 $\\Delta t \\to 0$，第一项 $\\sum b(x_{t_k})\\Delta W_k$ 收敛于 Itô 积分 $\\int b(x_t) dW_t$。第二项涉及维纳过程的二次变差。Itô 微积分的一个基本性质是，在极限情况下，$(\\Delta W_k)^2$ 的行为类似于 $\\Delta t$。用微分形式表示，即 $(dW_t)^2 = dt$。因此，和 $\\sum \\frac{1}{2}b'(x_{t_k})b(x_{t_k})(\\Delta W_k)^2$ 收敛于普通黎曼积分 $\\int \\frac{1}{2}b'(x_t)b(x_t)dt$。\n\n这就得到了微分形式的转换规则：\n$$b(x_t)\\circ dW_t = b(x_t)dW_t + \\frac{1}{2}b(x_t)b'(x_t)dt$$\n将此代入原始的 Stratonovich SDE，得到等价的 Itô SDE：\n$$dx_t = a(x_t)dt + \\left(b(x_t)dW_t + \\frac{1}{2}b(x_t)b'(x_t)dt\\right)$$\n$$dx_t = \\left(a(x_t) + \\frac{1}{2}b(x_t)b'(x_t)\\right)dt + b(x_t)dW_t$$\n新的漂移项为 $\\tilde{a}(x_t) = a(x_t) + \\frac{1}{2}b(x_t)b'(x_t)$。这个推导出的形式将用于第二种模拟策略。\n\n**2. 模拟策略 1：Stratonovich 中点 (Heun) 格式**\n\n此方法直接近似 Stratonovich 积分的对称性。它是一种预测-校正格式。给定在时间 $t_k$ 的状态 $x_k$：\n1.  **预测步骤**：使用显式 Euler 步计算在时间 $t_{k+1}$ 状态的一阶近似，记为 $\\bar{x}_{k+1}$。\n    $$\\bar{x}_{k+1} = x_k + a(x_k)\\Delta t + b(x_k)\\Delta W_k$$\n2.  **校正步骤**：使用预测值 $\\bar{x}_{k+1}$ 来构造区间开始和（预测的）结束处的漂移系数和扩散系数的平均值。这近似了中点处的取值。\n    $$x_{k+1} = x_k + \\frac{1}{2}\\left(a(x_k) + a(\\bar{x}_{k+1})\\right)\\Delta t + \\frac{1}{2}\\left(b(x_k) + b(\\bar{x}_{k+1})\\right)\\Delta W_k$$\n对于具有可交换噪声的 Stratonovich SDE（标量情况即属此类），此格式的强收敛阶为 $1.0$。\n\n**3. 模拟策略 2：对转换后的 Itô SDE 使用 Euler-Maruyama 格式**\n\n该策略使用上面推导出的漂移调整后的 Itô SDE：\n$$dx_t = \\tilde{a}(x_t)dt + b(x_t)dW_t$$\n其中 $\\tilde{a}(x_t) = a(x_t) + \\frac{1}{2}b(x_t)b'(x_t)$。我们现在可以应用标准的 Euler-Maruyama 格式，这是求解 Itô SDE 最简单的数值方法：\n$$x_{k+1} = x_k + \\tilde{a}(x_k)\\Delta t + b(x_k)\\Delta W_k$$\n此格式通常具有 $0.5$ 的强收敛阶。然而，通过引入校正项，转换和 Euler-Maruyama 的组合可以有效地模拟 Stratonovich 过程，其精度阶与 Heun 格式相当。预计两种格式会产生相似的结果，它们之间的差异是要计算的诊断指标之一。\n\n**4. Stratonovich 链式法则的数值验证**\n\n对于一个足够光滑的函数 $f(x)$，由 Stratonovich SDE 控制的过程 $x_t$ 的链式法则与普通微积分中的相同：\n$$df(x_t) = f'(x_t) \\circ dx_t$$\n将此式从 $t=0$ 积分到 $t=T$ 得到：\n$$f(x_T) - f(x_0) = \\int_0^T f'(x_t) \\circ dx_t$$\n问题要求通过用对称黎曼和近似该积分来数值验证此法则。使用 Stratonovich-Heun 格式模拟的路径 $\\{x_{t_k}\\}_{k=0}^N$，该积分近似为：\n$$\\int_0^T f'(x_t) \\circ dx_t \\approx \\sum_{k=0}^{N-1} f'\\left(\\frac{x_{t_k} + x_{t_{k+1}}}{2}\\right)(x_{t_{k+1}} - x_{t_k})$$\n对于单条路径，此近似的误差为：\n$$\\text{error} = \\left| f(x_T) - f(x_0) - \\sum_{k=0}^{N-1} f'\\left(\\frac{x_{t_k}} + x_{t_{k+1}}}{2}\\right)(x_{t_{k+1}} - x_{t_k}) \\right|$$\n实现将计算所有模拟路径上该误差的均值。预计该误差会很小，这反映了 Stratonovich 积分的定义与经典链式法则之间的一致性。\n\n实现过程将首先为所有路径和步骤生成一组维纳增量。这些相同的增量将用于 Heun 格式和漂移调整后的 Euler-Maruyama 格式，以确保公平比较。然后，将从模拟的轨迹中计算所需的两个诊断指标——平均绝对链式法则误差和平均绝对终态差异。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the stochastic differential equation problem by implementing and\n    comparing two simulation schemes (Stratonovich-Heun and Itô-Euler-Maruyama)\n    and verifying the Stratonovich chain rule.\n    \"\"\"\n    test_cases = [\n        {\n            \"a\": lambda x, alpha=0.2: alpha * x,\n            \"b\": lambda x, beta=0.5: beta * x,\n            \"b_prime\": lambda x, beta=0.5: beta * np.ones_like(x), # Note b'(x) is constant\n            \"f\": lambda x: x**2,\n            \"f_prime\": lambda x: 2 * x,\n            \"x0\": 1.0,\n            \"T\": 1.0,\n            \"N\": 2000,\n            \"M\": 200,\n            \"seed\": 12345,\n        },\n        {\n            \"a\": lambda x: -0.1 * x**3,\n            \"b\": lambda x: 0.6 * x**2,\n            \"b_prime\": lambda x: 1.2 * x,\n            \"f\": lambda x: x**3,\n            \"f_prime\": lambda x: 3 * x**2,\n            \"x0\": 0.4,\n            \"T\": 0.4,\n            \"N\": 3000,\n            \"M\": 150,\n            \"seed\": 67890,\n        },\n        {\n            \"a\": lambda x: np.sin(x),\n            \"b\": lambda x: np.zeros_like(x),\n            \"b_prime\": lambda x: np.zeros_like(x),\n            \"f\": lambda x: np.cos(x),\n            \"f_prime\": lambda x: -np.sin(x),\n            \"x0\": 0.7,\n            \"T\": 1.0,\n            \"N\": 2000,\n            \"M\": 200,\n            \"seed\": 13579,\n        },\n        {\n            \"a\": lambda x, alpha=0.2: alpha * x,\n            \"b\": lambda x, beta=0.5: beta * x,\n            \"b_prime\": lambda x, beta=0.5: beta * np.ones_like(x),\n            \"f\": lambda x: x**2,\n            \"f_prime\": lambda x: 2 * x,\n            \"x0\": 1.0,\n            \"T\": 1.0,\n            \"N\": 200,\n            \"M\": 200,\n            \"seed\": 24680,\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # Extract parameters for the current test case\n        a_func = case[\"a\"]\n        b_func = case[\"b\"]\n        b_prime_func = case[\"b_prime\"]\n        f_func = case[\"f\"]\n        f_prime_func = case[\"f_prime\"]\n        x0 = case[\"x0\"]\n        T = case[\"T\"]\n        N = case[\"N\"]\n        M = case[\"M\"]\n        seed = case[\"seed\"]\n\n        dt = T / N\n        rng = np.random.default_rng(seed)\n        dW = rng.normal(0, np.sqrt(dt), size=(M, N))\n\n        # --- Scheme 1: Stratonovich Midpoint (Heun) Scheme ---\n        x_strat_traj = np.zeros((M, N + 1))\n        x_strat_traj[:, 0] = x0\n        \n        for k in range(N):\n            x_k = x_strat_traj[:, k]\n            dW_k = dW[:, k]\n            \n            # Predictor step\n            x_pred = x_k + a_func(x_k) * dt + b_func(x_k) * dW_k\n            \n            # Corrector step\n            a_avg = 0.5 * (a_func(x_k) + a_func(x_pred))\n            b_avg = 0.5 * (b_func(x_k) + b_func(x_pred))\n            x_kp1 = x_k + a_avg * dt + b_avg * dW_k\n            \n            x_strat_traj[:, k + 1] = x_kp1\n        \n        x_T_strat = x_strat_traj[:, -1]\n\n        # --- Diagnostic 1: Mean Absolute Chain-Rule Error ---\n        x_k_traj = x_strat_traj[:, :-1]\n        x_kp1_traj = x_strat_traj[:, 1:]\n        \n        increments = x_kp1_traj - x_k_traj\n        midpoints = 0.5 * (x_k_traj + x_kp1_traj)\n        \n        f_prime_midpoints = f_prime_func(midpoints)\n        integral_sum = np.sum(f_prime_midpoints * increments, axis=1)\n        \n        chain_rule_lhs = f_func(x_T_strat) - f_func(x_strat_traj[:, 0])\n        chain_errors = np.abs(chain_rule_lhs - integral_sum)\n        mean_chain_error = np.mean(chain_errors)\n\n        # --- Scheme 2: Euler-Maruyama on Drift-Adjusted Itô SDE ---\n        def a_tilde_func(x):\n            return a_func(x) + 0.5 * b_func(x) * b_prime_func(x)\n\n        x_ito = np.full(M, x0)\n\n        for k in range(N):\n            dW_k = dW[:, k]\n            x_ito = x_ito + a_tilde_func(x_ito) * dt + b_func(x_ito) * dW_k\n            \n        x_T_ito = x_ito\n\n        # --- Diagnostic 2: Mean Absolute End-State Difference ---\n        method_diffs = np.abs(x_T_strat - x_T_ito)\n        mean_method_diff = np.mean(method_diffs)\n        \n        results.append([mean_chain_error, mean_method_diff])\n\n    # Format the final output string exactly as specified\n    formatted_pairs = [f\"[{e:.6e},{d:.6e}]\" for e, d in results]\n    final_output = f\"[{','.join(formatted_pairs)}]\"\n\n    print(final_output)\n\nsolve()\n```", "id": "3003906"}]}