{"hands_on_practices": [{"introduction": "理解一个扩散过程的有效方法是找出该过程的哪些函数表现为鞅。本练习将引导你找出作为局部鞅的贝塞尔过程的所有幂律函数。关键在于应用无穷小生成元并求解由此产生的代数条件，从而揭示该过程结构的一个基本特征 [@problem_id:2969792]。", "problem": "设 $\\{R_{t}\\}_{t \\ge 0}$ 是一个维度为 $\\delta > 0$ 的贝塞尔过程，从 $R_{0}=r>0$ 出发，定义为在 $(0,\\infty)$ 上随机微分方程\n$$\n\\mathrm{d}R_{t} = \\mathrm{d}W_{t} + \\frac{\\delta - 1}{2 R_{t}} \\,\\mathrm{d}t,\n$$\n的唯一强解，其中 $\\{W_{t}\\}_{t \\ge 0}$ 是一个标准的一维布朗运动，并令 $\\tau_{0} := \\inf\\{ t \\ge 0 : R_{t} = 0\\}$ 为首次到达零的时刻。对于 $f \\in C^{2}((0,\\infty))$，$R$ 的无穷小生成元 $L$ 的作用为\n$$\nL f(x) = \\frac{1}{2} f''(x) + \\frac{\\delta - 1}{2 x} f'(x), \\quad x>0.\n$$\n使用伊藤公式以及生成元的特征——即 $f(R_{t \\wedge \\tau_{0}})$ 是一个局部鞅当且仅当在 $(0,\\infty)$ 上有 $L f \\equiv 0$——来确定所有使得 $R_{t \\wedge \\tau_{0}}^{\\alpha}$ 是局部鞅的实数指数 $\\alpha \\in \\mathbb{R}$。具体来说，求解关于 $\\alpha$ 的常微分方程 $L x^{\\alpha} = 0$，并简要讨论两个解 $\\alpha = 2 - \\delta$ 和 $\\alpha = 0$ 的作用，包括 $\\delta = 2$ 的特殊情况。\n\n你的最终答案必须是关于 $\\delta$ 的所有此类 $\\alpha$ 的完整集合，表示为单个行向量。无需进行数值四舍五入。", "solution": "问题要求我们确定所有实数指数 $\\alpha \\in \\mathbb{R}$，使得过程 $\\{R_{t \\wedge \\tau_{0}}^{\\alpha}\\}_{t \\ge 0}$ 是一个局部鞅，其中 $\\{R_t\\}_{t \\ge 0}$ 是一个维度为 $\\delta > 0$ 的贝塞尔过程。过程 $R_t$ 定义在 $(0, \\infty)$上，从 $R_0 = r > 0$ 开始，并在时刻 $\\tau_0 = \\inf\\{ t \\ge 0 : R_t = 0 \\}$ 停止。\n\n问题提供了一个关键特征：对于函数 $f \\in C^2((0,\\infty))$，过程 $f(R_{t \\wedge \\tau_{0}})$ 是一个局部鞅，当且仅当其无穷小生成元 $L$ 在其定义域上使函数 $f$ 为零，即对于所有 $x \\in (0, \\infty)$ 都有 $L f(x) = 0$。\n\n我们关心的是形式为 $f(x) = x^{\\alpha}$ 的函数，其中 $\\alpha$ 是某个实指数。对于 $x > 0$，这个函数对任何 $\\alpha \\in \\mathbb{R}$ 都在 $C^2((0,\\infty))$ 中。因此，我们必须求解以 $f(x) = x^{\\alpha}$ 为对象的常微分方程 $L f(x) = 0$。\n\n维度为 $\\delta$ 的贝塞尔过程的无穷小生成元 $L$ 给出如下：\n$$\nL f(x) = \\frac{1}{2} f''(x) + \\frac{\\delta - 1}{2 x} f'(x)\n$$\n\n让我们计算 $f(x) = x^{\\alpha}$ 的一阶和二阶导数：\n$$\nf'(x) = \\frac{\\mathrm{d}}{\\mathrm{d}x} (x^{\\alpha}) = \\alpha x^{\\alpha-1}\n$$\n$$\nf''(x) = \\frac{\\mathrm{d}^2}{\\mathrm{d}x^2} (x^{\\alpha}) = \\alpha (\\alpha - 1) x^{\\alpha-2}\n$$\n\n现在，我们将这些导数代入 $L f(x)$ 的表达式中，并令其等于零：\n$$\nL x^{\\alpha} = \\frac{1}{2} \\left( \\alpha (\\alpha - 1) x^{\\alpha-2} \\right) + \\frac{\\delta - 1}{2 x} \\left( \\alpha x^{\\alpha-1} \\right) = 0\n$$\n\n我们可以简化第二项：\n$$\n\\frac{\\delta - 1}{2 x} \\left( \\alpha x^{\\alpha-1} \\right) = \\frac{\\alpha (\\delta - 1)}{2} x^{\\alpha-2}\n$$\n\n于是方程变为：\n$$\n\\frac{1}{2} \\alpha (\\alpha - 1) x^{\\alpha-2} + \\frac{1}{2} \\alpha (\\delta - 1) x^{\\alpha-2} = 0\n$$\n\n由于该方程必须对所有 $x > 0$ 成立，我们可以提出非零项 $\\frac{1}{2} x^{\\alpha-2}$，并将余下的关于 $\\alpha$ 的多项式置为零：\n$$\n\\alpha (\\alpha - 1) + \\alpha (\\delta - 1) = 0\n$$\n\n提出因子 $\\alpha$：\n$$\n\\alpha \\left( (\\alpha - 1) + (\\delta - 1) \\right) = 0\n$$\n$$\n\\alpha (\\alpha + \\delta - 2) = 0\n$$\n\n这是一个关于 $\\alpha$ 的二次方程，它有两个解：\n1. $\\alpha = 0$\n2. $\\alpha + \\delta - 2 = 0 \\implies \\alpha = 2 - \\delta$\n\n这就是使得 $f(x)=x^{\\alpha}$ 满足 $L f(x) = 0$ 的仅有的两个可能的指数 $\\alpha$ 值。让我们按要求讨论这两个解。\n\n第一个解是 $\\alpha = 0$。这对应于函数 $f(x) = x^0 = 1$。该过程是 $f(R_{t \\wedge \\tau_{0}}) = 1$。常数过程总是一个鞅，因此也是一个局部鞅。这是一个对任何伊藤扩散都存在的平凡解。\n\n第二个解是 $\\alpha = 2 - \\delta$。这对应于函数 $f(x) = x^{2-\\delta}$。对于 $\\delta \\neq 2$，这是一个非平凡解。过程 $M_t = R_{t \\wedge \\tau_{0}}^{2-\\delta}$ 是一个非平凡的局部鞅。这个函数是贝塞尔过程在 $(0,\\infty)$ 上的生成元的一个特定调和函数。这类函数的存在是该过程的一个关键特征。\n\n让我们考虑 $\\delta = 2$ 的特殊情况。在这种情况下，第二个解变为 $\\alpha = 2 - 2 = 0$，与第一个解相同。特征方程 $\\alpha(\\alpha + \\delta - 2) = 0$ 变为 $\\alpha^2 = 0$，它在 $\\alpha=0$ 处有一个重根。这意味着对于 $\\delta=2$，幂形式 $f(x) = x^\\alpha$ 的解只有一个，即平凡解 $f(x)=1$。根据二阶线性常微分方程的理论，当指标方程有重根时，第二个线性无关解不具有相同的形式。对于 $\\delta=2$，常微分方程 $Lf=0$ 是 $\\frac{1}{2}f''(x) + \\frac{1}{2x}f'(x)=0$，即 $xf''(x)+f'(x)=0$。这可以写成 $(xf'(x))' = 0$。积分一次得到 $xf'(x) = c_1$，这意味着 $f'(x) = c_1/x$。再次积分得到 $f(x) = c_1 \\ln(x) + c_2$。两个基本解是 $1$ 和 $\\ln(x)$。因此，对于 $\\delta=2$，过程 $\\ln(R_{t \\wedge \\tau_{0}})$ 是一个局部鞅。然而，$\\ln(x)$ 不能写成任何实数 $\\alpha$ 的 $x^{\\alpha}$ 形式。因此，当问题被限制为寻找指数 $\\alpha$ 时，对于 $\\delta=2$，唯一的解是 $\\alpha=0$。\n\n问题要求找出求解方程 $L x^\\alpha = 0$ 的所有指数 $\\alpha$ 的完整集合（用 $\\delta$ 表示）。这对应于指标多项式 $\\alpha (\\alpha + \\delta - 2) = 0$ 的根。这些根的集合是 $\\{0, 2-\\delta\\}$。\n\n通过求解 $L x^{\\alpha} = 0$ 得出的，使得 $R_{t \\wedge \\tau_{0}}^{\\alpha}$ 成为局部鞅的所有实指数 $\\alpha$ 的完整集合，由特征方程的两个根给出。", "answer": "$$\n\\boxed{\\begin{pmatrix} 0 & 2-\\delta \\end{pmatrix}}\n$$", "id": "2969792"}, {"introduction": "基于前一个练习中的调和函数概念，我们现在来解决一个经典问题：计算一个过程通过特定边界离开一个区间的概率。你将通过求解相关的边值问题来确定贝塞尔过程在到达 0 之前先到达水平 $a$ 的概率。这个实践巩固了随机过程与微分方程之间的联系 [@problem_id:2969808]。", "problem": "考虑一个维数为 $\\delta \\in (0,2)$ 的贝塞尔过程 $(R_t)_{t \\geq 0}$，它从 $R_0 = r \\in (0,a)$ 开始，其中 $a>0$。该贝塞尔过程被定义为以下随机微分方程的唯一强解\n$$\n\\mathrm{d}R_t = \\mathrm{d}W_t + \\frac{\\delta - 1}{2 R_t} \\,\\mathrm{d}t,\n$$\n其中 $(W_t)_{t \\geq 0}$ 是一个标准一维布朗运动。令 $\\tau_0 := \\inf\\{t \\geq 0 : R_t = 0\\}$ 和 $\\tau_a := \\inf\\{t \\geq 0 : R_t = a\\}$ 分别表示首次触碰 $0$ 和 $a$ 的时间。对函数 $f \\in C^2((0,\\infty))$，将 $(R_t)_{t \\geq 0}$ 的无穷小生成元 $L$ 定义为\n$$\nL f(r) := \\frac{1}{2} f''(r) + \\frac{\\delta - 1}{2 r} f'(r).\n$$\n利用无穷小生成元 $L$ 的调和函数可刻画一维扩散过程的触碰概率这一原理，通过求解在 $(0,a)$ 上的边值问题 $L f = 0$（边界条件为 $f(0) = 0$ 和 $f(a) = 1$），确定\n$$\n\\mathbb{P}_r\\big(\\tau_a < \\tau_0\\big)\n$$\n的闭式表达式。你的最终答案必须是关于 $r$、$a$ 和 $\\delta$ 的单个解析表达式。不要对你的答案进行四舍五入。", "solution": "该问题要求计算维数为 $\\delta \\in (0,2)$、从 $R_0 = r \\in (0,a)$ 开始的贝塞尔过程 $(R_t)_{t \\geq 0}$ 的概率 $\\mathbb{P}_r\\big(\\tau_a < \\tau_0\\big)$。这个量可以通过求解一个特定的边值问题来找到。\n\n令 $f(r) = \\mathbb{P}_r\\big(\\tau_a < \\tau_0\\big)$ 为过程从 $r$ 开始，在触碰原点 $0$ 之前触碰到水平 $a$ 的概率。对于一维扩散过程，该概率函数 $f(r)$ 在区间 $(0,a)$ 上关于过程的无穷小生成元 $L$ 是调和的。这意味着对于 $r \\in (0,a)$，$f(r)$ 必须满足常微分方程 (ODE) $L f(r) = 0$。\n\n无穷小生成元给出为\n$$\nL f(r) = \\frac{1}{2} f''(r) + \\frac{\\delta - 1}{2 r} f'(r).\n$$\n设 $L f(r) = 0$，我们得到以下二阶线性齐次常微分方程：\n$$\n\\frac{1}{2} f''(r) + \\frac{\\delta - 1}{2 r} f'(r) = 0.\n$$\n两边乘以 $2$ 将方程简化为：\n$$\nf''(r) + \\frac{\\delta - 1}{r} f'(r) = 0.\n$$\n为了求解此常微分方程，我们引入一个辅助函数 $g(r) = f'(r)$。该方程随后变为关于 $g(r)$ 的一阶线性常微分方程：\n$$\ng'(r) + \\frac{\\delta - 1}{r} g(r) = 0.\n$$\n这是一个可分离方程，我们可以将其写为：\n$$\n\\frac{g'(r)}{g(r)} = - \\frac{\\delta - 1}{r}.\n$$\n对两边关于 $r$ 积分：\n$$\n\\int \\frac{g'(r)}{g(r)} \\mathrm{d}r = \\int -\\frac{\\delta - 1}{r} \\mathrm{d}r.\n$$\n这得到：\n$$\n\\ln|g(r)| = -(\\delta - 1)\\ln|r| + C_1,\n$$\n其中 $C_1$ 是一个积分常数。由于过程是为 $r>0$ 定义的，我们可以去掉绝对值符号：\n$$\n\\ln(g(r)) = (1 - \\delta)\\ln(r) + C_1 = \\ln(r^{1-\\delta}) + C_1.\n$$\n对两边取指数，我们得到：\n$$\ng(r) = \\exp(\\ln(r^{1-\\delta}) + C_1) = \\exp(C_1) r^{1-\\delta}.\n$$\n令 $C_2 = \\exp(C_1)$，我们有 $g(r) = C_2 r^{1-\\delta}$。回想起 $g(r) = f'(r)$，我们有：\n$$\nf'(r) = C_2 r^{1-\\delta}.\n$$\n为了求得 $f(r)$，我们将 $f'(r)$ 对 $r$ 积分：\n$$\nf(r) = \\int C_2 r^{1-\\delta} \\mathrm{d}r.\n$$\n问题指定了 $\\delta \\in (0,2)$，这意味着指数 $1-\\delta \\neq -1$。因此，积分是直接的：\n$$\nf(r) = C_2 \\frac{r^{1-\\delta+1}}{1-\\delta+1} + C_3 = C_2 \\frac{r^{2-\\delta}}{2-\\delta} + C_3.\n$$\n将常数 $C_2 / (2-\\delta)$ 重新定义为新常数 $A$，并将 $C_3$ 定义为 $B$，则 $f(r)$ 的通解为：\n$$\nf(r) = A r^{2-\\delta} + B.\n$$\n现在，我们必须应用问题陈述中提供的边界条件，这些条件是从 $f(r)$ 作为触碰概率的解释中得出的。\n边界条件是 $f(0)=0$ 和 $f(a)=1$。\n1.  条件 $f(0)=0$ 意味着如果过程从原点（或无限接近原点）开始，在返回到 $0$ 之前触碰到 $a$ 的概率是 $0$。这反映了如果 $R_0 = 0$，则 $\\tau_0=0$ 这一事实。\n    我们计算当 $r \\to 0^+$ 时 $f(r)$ 的极限：\n    $$\n    \\lim_{r\\to 0^+} f(r) = \\lim_{r\\to 0^+} (A r^{2-\\delta} + B) = 0.\n    $$\n    因为 $\\delta \\in (0,2)$，指数 $2-\\delta$ 严格为正。因此，$\\lim_{r\\to 0^+} r^{2-\\delta} = 0$。方程变为：\n    $$\n    A \\cdot 0 + B = 0 \\implies B = 0.\n    $$\n    解简化为 $f(r) = A r^{2-\\delta}$。\n\n2.  条件 $f(a)=1$ 意味着如果过程从边界 $a$ 开始，它已经触碰到了 $a$，所以在触碰 $0$ 之前触碰到 $a$ 的概率是 $1$。\n    应用此条件：\n    $$\n    f(a) = A a^{2-\\delta} = 1.\n    $$\n    我们现在可以解出常数 $A$：\n    $$\n    A = \\frac{1}{a^{2-\\delta}} = a^{-(2-\\delta)} = a^{\\delta-2}.\n    $$\n将 $A$ 的这个值代回到 $f(r)$ 的表达式中，我们得到触碰概率的最终解：\n$$\nf(r) = (a^{\\delta-2}) r^{2-\\delta} = \\frac{r^{2-\\delta}}{a^{2-\\delta}}.\n$$\n这可以更简洁地写作：\n$$\n\\mathbb{P}_r\\big(\\tau_a < \\tau_0\\big) = \\left(\\frac{r}{a}\\right)^{2-\\delta}.\n$$\n此表达式是所需概率关于初始位置 $r$、边界 $a$ 和维数 $\\delta$ 的闭式解。", "answer": "$$\\boxed{\\left(\\frac{r}{a}\\right)^{2-\\delta}}$$", "id": "2969808"}, {"introduction": "从解析理论转向计算实践，本练习要求你为平方贝塞尔过程实现一个精确的模拟器。你将不使用欧拉-丸山 (Euler-Maruyama) 等近似方案，而是利用 $\\mathrm{BESQ}^\\delta$ 过程与非中心卡方分布之间的深刻联系。这使得我们能够精确地抽样过程的未来状态，并为验证理论结果提供了一种稳健的方法 [@problem_id:2969795]。", "problem": "令 $\\left(X_t\\right)_{t \\geq 0}$ 为维度为 $\\delta$ 的平方贝塞尔过程，记作 $\\mathrm{BESQ}^{\\delta}$，它被定义为以下随机微分方程的唯一强解\n$$\ndX_t = \\delta\\, dt + 2 \\sqrt{X_t}\\, dW_t,\\quad X_0 = x_0 \\geq 0,\n$$\n其中 $\\left(W_t\\right)_{t \\geq 0}$ 是一个标准的一维布朗运动。$\\mathrm{BESQ}^{\\delta}$ 的马尔可夫半群具有一个转移密度，该密度可以用第一类修正贝塞尔函数表示。一个经典的事实是，在一个时间增量上的转移定律与非中心卡方分布密切相关。\n\n请设计并实现一个关于 $\\mathrm{BESQ}^{\\delta}$ 在单个时间增量 $\\Delta t > 0$ 上的精确模拟器，该模拟器通过将转移定律简化为从非中心卡方分布中抽样来对给定 $X_t = x$ 的 $X_{t+\\Delta t}$ 进行采样（不使用任何近似方案，如欧拉-丸山法）。您的模拟器必须从马尔可夫转移中在指定的未来时间产生精确的边缘样本。然后，通过将经验矩与通过 Itô 积分获得的理论矩进行比较，来验证其正确性。\n\n从以下基本原理出发：\n- 平方贝塞尔过程 $\\mathrm{BESQ}^{\\delta}$ 满足随机微分方程\n$$\ndX_t = \\delta\\, dt + 2 \\sqrt{X_t}\\, dW_t.\n$$\n- 对于一个生成元为\n$$\n\\mathcal{L} f(y) = \\delta f'(y) + 2 y f''(y),\n$$\n的马尔可夫扩散，其转移密度 $p(t,x,y)$ 的 Kolmogorov 前向方程，以及 Itô 公式对 $X_t$ 的多项式函数的应用，可以得到前两阶矩的闭式表达式：\n$$\n\\mathbb{E}[X_t] = x_0 + \\delta t,\\qquad \\mathrm{Var}(X_t) = 2 \\delta t^2 + 4 x_0 t.\n$$\n- 具有自由度 $k > 0$ 和非中心化参数 $\\lambda \\geq 0$ 的非中心卡方分布的概率密度函数为\n$$\nf(z; k, \\lambda) = \\frac{1}{2} \\exp\\!\\left(-\\frac{z+\\lambda}{2}\\right) \\left(\\frac{z}{\\lambda}\\right)^{\\nu/2} I_{\\nu}\\!\\left(\\sqrt{\\lambda z}\\right),\\quad z>0,\\ \\nu=\\frac{k}{2}-1,\n$$\n其中 $I_{\\nu}$ 是第一类修正贝塞尔函数。\n\n您的程序必须：\n1.  基于非中心卡方抽样，为任意当前状态 $x \\geq 0$、维度参数 $\\delta > 0$ 和时间增量 $\\Delta t > 0$ 实现一个精确的单步 $\\mathrm{BESQ}^{\\delta}$ 转移采样器。\n2.  使用此采样器，在一个固定时间终点 $T$ 直接生成 $X_T$ 的独立样本（一步），以及在另一种情况下通过两个大小为 $T/2$ 的连续精确步骤生成（两步）。\n3.  对于每个指定的测试用例，从蒙特卡洛样本中计算经验均值和方差，并与上述公式给出的理论均值和方差进行比较。报告经验均值和方差是否都在预定义容差范围内与理论值相符。\n\n测试套件：\n- 用例 1（通用正常路径）：$\\delta = 3.0$, $x_0 = 1.5$, $T = 2.0$，单步采样，相对误差容差为 $\\varepsilon_{\\mathrm{mean}} = 0.01$ 和 $\\varepsilon_{\\mathrm{var}} = 0.03$。\n- 用例 2（零状态边界）：$\\delta = 0.5$, $x_0 = 0.0$, $T = 1.0$，单步采样，相对误差容差为 $\\varepsilon_{\\mathrm{mean}} = 0.015$ 和 $\\varepsilon_{\\mathrm{var}} = 0.05$。\n- 用例 3（中等维度）：$\\delta = 1.0$, $x_0 = 4.0$, $T = 0.75$，单步采样，相对误差容差为 $\\varepsilon_{\\mathrm{mean}} = 0.01$ 和 $\\varepsilon_{\\mathrm{var}} = 0.03$。\n- 用例 4（小时间增量和大的非中心化参数）：$\\delta = 10.0$, $x_0 = 0.5$, $T = 0.001$，单步采样，相对误差容差为 $\\varepsilon_{\\mathrm{mean}} = 0.02$ 和 $\\varepsilon_{\\mathrm{var}} = 0.08$。\n- 用例 5（通过两个精确步骤检验半群一致性）：$\\delta = 2.0$, $x_0 = 3.0$, $T = 1.0$，使用 $\\Delta t = 0.5$ 的两步采样，相对误差容差为 $\\varepsilon_{\\mathrm{mean}} = 0.01$ 和 $\\varepsilon_{\\mathrm{var}} = 0.03$。\n\n对于所有测试用例，每次验证抽取 $N = 100000$ 个独立样本。使用固定的随机种子以确保可复现性。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果（例如，“[true,true,false,true,true]”）。每个条目对应于所呈现顺序的测试用例，并且是一个布尔值，指示经验均值和方差是否都在指定容差内与理论值匹配。\n- 不涉及任何物理单位或角度。所有结果均为无量纲实数。", "solution": "### 问题验证\n\n#### 第 1 步：提取已知条件\n- **过程定义**：维度为 $\\delta$ 的平方贝塞尔过程 $\\mathrm{BESQ}^{\\delta}$ 由以下随机微分方程（SDE）定义：\n$$\ndX_t = \\delta\\, dt + 2 \\sqrt{X_t}\\, dW_t,\\quad X_0 = x_0 \\geq 0\n$$\n其中 $(W_t)_{t \\geq 0}$ 是一个标准的一维布朗运动。\n- **理论矩**：$X_t$ 的前两阶矩由下式给出：\n$$\n\\mathbb{E}[X_t] = x_0 + \\delta t\n$$\n$$\n\\mathrm{Var}(X_t) = 2 \\delta t^2 + 4 x_0 t\n$$\n- **非中心卡方分布的概率密度函数**：具有自由度 $k > 0$ 和非中心化参数 $\\lambda \\geq 0$ 的非中心卡方分布的概率密度函数（PDF）为：\n$$\nf(z; k, \\lambda) = \\frac{1}{2} \\exp\\!\\left(-\\frac{z+\\lambda}{2}\\right) \\left(\\frac{z}{\\lambda}\\right)^{\\nu/2} I_{\\nu}\\!\\left(\\sqrt{\\lambda z}\\right),\\quad z>0,\\ \\nu=\\frac{k}{2}-1\n$$\n其中 $I_{\\nu}$ 是第一类修正贝塞尔函数。\n- **任务要求**：\n    1.  实现一个精确的单步采样器，用于在时间 $\\Delta t$ 内从状态 $x$ 进行 $\\mathrm{BESQ}^{\\delta}$ 转移，该采样器使用非中心卡方分布。\n    2.  使用该采样器为各种测试用例生成 $N=100000$ 个独立样本。\n    3.  通过将经验均值和方差与理论值进行比较来验证正确性，检查相对误差是否在指定的容差范围内。\n    4.  为保证可复现性，使用固定的随机种子。\n- **测试套件**：\n    - **用例 1**：$\\delta = 3.0$, $x_0 = 1.5$, $T = 2.0$，单步，$\\varepsilon_{\\mathrm{mean}} = 0.01$, $\\varepsilon_{\\mathrm{var}} = 0.03$。\n    - **用例 2**：$\\delta = 0.5$, $x_0 = 0.0$, $T = 1.0$，单步，$\\varepsilon_{\\mathrm{mean}} = 0.015$, $\\varepsilon_{\\mathrm{var}} = 0.05$。\n    - **用例 3**：$\\delta = 1.0$, $x_0 = 4.0$, $T = 0.75$，单步，$\\varepsilon_{\\mathrm{mean}} = 0.01$, $\\varepsilon_{\\mathrm{var}} = 0.03$。\n    - **用例 4**：$\\delta = 10.0$, $x_0 = 0.5$, $T = 0.001$，单步，$\\varepsilon_{\\mathrm{mean}} = 0.02$, $\\varepsilon_{\\mathrm{var}} = 0.08$。\n    - **用例 5**：$\\delta = 2.0$, $x_0 = 3.0$, $T = 1.0$，使用 $\\Delta t = 0.5$ 的两步，$\\varepsilon_{\\mathrm{mean}} = 0.01$, $\\varepsilon_{\\mathrm{var}} = 0.03$。\n\n#### 第 2 步：使用提取的已知条件进行验证\n1.  **科学依据**：该问题在随机微分方程和随机过程理论中有充分的根据。$\\mathrm{BESQ}^{\\delta}$ 过程是一个基础研究对象。SDE、矩公式以及与非中心卡方分布的联系都是标准的、经过数学证明的结果。\n2.  **适定性**：该问题是适定的。它要求实现并验证一个已知的精确模拟算法。每个测试用例的所有参数和条件都已明确提供，包括样本数量和误差容差。存在唯一且有意义的解（实现及其验证）。\n3.  **客观性**：该问题以精确、客观的数学语言陈述。验证标准（矩的比较）是定量的、无歧义的。\n\n#### 第 3 步：结论与行动\n该问题科学上可靠、适定、客观且自洽。它不包含任何矛盾、歧义或不成立的前提。验证成功。我将继续进行解答。\n\n### 解答\n\n这个问题的核心是为平方贝塞尔过程（$\\mathrm{BESQ}^{\\delta}$）的转移设计一个精确的模拟算法，并验证其正确性。所指定的方法依赖于 $\\mathrm{BESQ}^{\\delta}$ 过程的转移定律与非中心卡方分布之间已建立的联系。\n\n**1. 精确模拟原理：与非中心卡方分布的联系**\n\n令 $(X_t)_{t \\geq 0}$ 为一个初始状态为 $X_t = x$ 的 $\\mathrm{BESQ}^{\\delta}$ 过程。我们的目标是采样该过程在未来时间 $t+\\Delta t$ 的值。在时间间隔 $\\Delta t$ 内从 $x$ 转移到 $y$ 的转移概率密度 $p(\\Delta t, x, y)$ 由下式给出：\n$$\np(\\Delta t, x, y) = \\frac{1}{2\\Delta t} \\left(\\frac{y}{x}\\right)^{(\\delta-2)/4} \\exp\\left(-\\frac{x+y}{2\\Delta t}\\right) I_{(\\delta-2)/2}\\left(\\frac{\\sqrt{xy}}{\\Delta t}\\right)\n$$\n其中 $I_{\\nu}$ 是阶数为 $\\nu = (\\delta-2)/2$ 的第一类修正贝塞尔函数。\n\n问题陈述指出，该分布与具有 $k$ 个自由度和非中心化参数 $\\lambda$ 的非中心卡方分布 $\\chi'^2_k(\\lambda)$ 有关。令 $Z \\sim \\chi'^2_k(\\lambda)$。其概率密度函数在问题描述中给出，我们可以写成：\n$$\nf_Z(z; k, \\lambda) = \\frac{1}{2} \\exp\\left(-\\frac{z+\\lambda}{2}\\right) \\left(\\frac{z}{\\lambda}\\right)^{(k-2)/4} I_{(k-2)/2}(\\sqrt{\\lambda z})\n$$\n我们寻找一个缩放的随机变量 $Y=cZ$，使其分布与 $X_{t+\\Delta t}$ 的分布相匹配。通过变量替换可以找到 $Y$ 的概率密度函数：$f_Y(y) = \\frac{1}{c} f_Z(y/c)$。\n$$\nf_Y(y) = \\frac{1}{c} \\left[ \\frac{1}{2} \\exp\\left(-\\frac{y/c+\\lambda}{2}\\right) \\left(\\frac{y/c}{\\lambda}\\right)^{(k-2)/4} I_{(k-2)/2}(\\sqrt{\\lambda y/c}) \\right]\n$$\n将 $f_Y(y)$ 与 $p(\\Delta t, x, y)$ 进行匹配，我们比较各项：\n- **指数项**：$f_Y(y)$ 中指数的参数是 $-\\frac{y}{2c} - \\frac{\\lambda}{2}$。$p(\\Delta t, x, y)$ 中指数的参数是 $-\\frac{y}{2\\Delta t} - \\frac{x}{2\\Delta t}$。令它们相等得到 $c=\\Delta t$ 和 $\\lambda = x/\\Delta t$。\n- **贝塞尔函数项**：$f_Y(y)$ 中 $I_{\\nu}$ 的参数变为 $\\sqrt{(x/\\Delta t) \\cdot y / \\Delta t} = \\frac{\\sqrt{xy}}{\\Delta t}$，这与 $p(\\Delta t, x, y)$ 中的参数相匹配。\n- **幂次项和阶数**：$f_Y(y)$ 中的幂次项变为 $\\left( \\frac{y/\\Delta t}{x/\\Delta t} \\right)^{(k-2)/4} = \\left(\\frac{y}{x}\\right)^{(k-2)/4}$。为了与 $p(\\Delta t, x, y)$ 中的幂次 $(\\delta-2)/4$ 相匹配，必须有 $k=\\delta$。这也意味着贝塞尔函数的阶数 $(\\delta-2)/2$ 是一致的。\n- **前置因子**：$f_Y(y)$ 中的前置因子是 $\\frac{1}{2c} = \\frac{1}{2\\Delta t}$，完全匹配。\n\n这证实了以下关系：如果 $X_t=x$，则 $X_{t+\\Delta t}$ 的定律与随机变量 $\\Delta t \\cdot Z$ 的定律相同，其中 $Z$ 是一个非中心卡方随机变量，其参数为：\n- 自由度：$k = \\delta$\n- 非中心化参数：$\\lambda = x/\\Delta t$\n\n这提供了一个直接、精确的采样算法：\n1.  给定 $x$、$delta$ 和 $\\Delta t$。\n2.  计算 $k = \\delta$ 和 $\\lambda = x/\\Delta t$。\n3.  从 $\\chi'^2_k(\\lambda)$ 中采样一个值 $z$。\n4.  $X_{t+\\Delta t}$ 的样本是 $y = \\Delta t \\cdot z$。\n\n当 $x=0$ 时出现一个特殊情况，导致 $\\lambda=0$。非中心化参数为零的非中心卡方分布就是中心卡方分布 $\\chi^2_k$。这与从 0 开始的 $\\mathrm{BESQ}^{\\delta}$ 是 $\\delta$ 个独立标准布朗运动的平方和这一事实是一致的。\n\n**2. 蒙特卡洛验证程序**\n\n为了验证此采样器的正确性，我们使用蒙特卡洛方法。对于每个测试用例，我们生成大量的（$N=100000$）$X_T$ 的独立样本，并将这些样本的经验均值和方差与其理论对应值进行比较。\n\n从 $x_0$ 出发，在时间 $T$ 的理论矩为：\n$$\n\\mathbb{E}[X_T] = x_0 + \\delta T\n$$\n$$\n\\mathrm{Var}(X_T) = 2 \\delta T^2 + 4 x_0 T\n$$\n\n对于一组生成的样本 $\\{y_1, y_2, \\dots, y_N\\}$，经验矩为：\n$$\n\\text{Mean}_{\\text{emp}} = \\frac{1}{N}\\sum_{i=1}^{N} y_i, \\qquad \\text{Var}_{\\text{emp}} = \\frac{1}{N}\\sum_{i=1}^{N} (y_i - \\text{Mean}_{\\text{emp}})^2\n$$\n\n验证过程检查相对误差是否在指定的容差 $\\varepsilon_{\\mathrm{mean}}$ 和 $\\varepsilon_{\\mathrm{var}}$ 之内：\n$$\n\\left| \\frac{\\text{Mean}_{\\text{emp}} - \\mathbb{E}[X_T]}{\\mathbb{E}[X_T]} \\right| \\leq \\varepsilon_{\\mathrm{mean}} \\quad \\text{和} \\quad \\left| \\frac{\\text{Var}_{\\text{emp}} - \\mathrm{Var}(X_T)}{\\mathrm{Var}(X_T)} \\right| \\leq \\varepsilon_{\\mathrm{var}}\n$$\n由于所有参数（$\\delta, T, x_0$）都是非负的且不全为零，理论矩为正，因此无需担心除以零的问题。\n\n**3. 测试用例的实现**\n\n- **单步采样（用例 1-4）**：$X_T$ 的样本通过一步（$\\Delta t = T$）从当前状态 $x = x_0$ 生成。\n- **两步采样（用例 5）**：该用例验证马尔可夫过程的 Chapman-Kolmogorov 属性。我们用大小为 $\\Delta t = T/2$ 的两步来模拟从 $t=0$ 到 $t=T$ 的过程。\n    1.  **第 1 步 (t=0 到 t=T/2)**：给定 $X_0 = x_0$，生成 $N$ 个 $X_{T/2}$ 的样本。非中心化参数为 $\\lambda_1 = x_0 / (T/2)$。这将产生一个中间状态数组 $\\{x^{(i)}_{T/2}\\}_{i=1}^N$。\n    2.  **第 2 步 (t=T/2 到 t=T)**：对于每个中间状态 $x^{(i)}_{T/2}$，我们采样一个最终状态 $X_T^{(i)}$。关键在于，第二步的非中心化参数 $\\lambda_2^{(i)} = x^{(i)}_{T/2} / (T/2)$ 现在对于 $N$ 次并行模拟中的每一次都不同。像 SciPy 这样的科学计算库允许 `ncx2` 分布的非中心化参数是一个数组，这非常适合此任务。\n然后使用最终的样本集 $\\{X_T^{(i)}\\}_{i=1}^N$ 计算经验矩，并与时间 $T$ 的理论矩进行比较。\n\n使用固定的随机种子来确保蒙特卡洛模拟是可复现的。实现将使用 `numpy` 进行数值运算，并使用 `scipy.stats.ncx2` 从非中心卡方分布中采样。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import ncx2\n\ndef solve():\n    \"\"\"\n    Implements and verifies an exact simulator for the squared Bessel process (BESQ)\n    by reducing its transition law to sampling from a noncentral chi-square distribution.\n    \"\"\"\n    \n    # A fixed random seed ensures reproducibility of the Monte Carlo simulation.\n    RANDOM_SEED = 42\n    \n    # Number of independent samples for Monte Carlo verification.\n    NUM_SAMPLES = 100000\n\n    test_cases = [\n        # Case 1: General happy path\n        {'delta': 3.0, 'x0': 1.5, 'T': 2.0, 'steps': 1, 'tol_mean': 0.01, 'tol_var': 0.03},\n        # Case 2: Boundary at zero state\n        {'delta': 0.5, 'x0': 0.0, 'T': 1.0, 'steps': 1, 'tol_mean': 0.015, 'tol_var': 0.05},\n        # Case 3: Moderate dimension\n        {'delta': 1.0, 'x0': 4.0, 'T': 0.75, 'steps': 1, 'tol_mean': 0.01, 'tol_var': 0.03},\n        # Case 4: Small time increment and large noncentrality\n        {'delta': 10.0, 'x0': 0.5, 'T': 0.001, 'steps': 1, 'tol_mean': 0.02, 'tol_var': 0.08},\n        # Case 5: Semigroup consistency via two exact steps\n        {'delta': 2.0, 'x0': 3.0, 'T': 1.0, 'steps': 2, 'tol_mean': 0.01, 'tol_var': 0.03},\n    ]\n\n    results = []\n\n    # Seeding the global random number generator for reproducibility.\n    # The scipy.stats functions will use this global state.\n    np.random.seed(RANDOM_SEED)\n\n    for case in test_cases:\n        delta = case['delta']\n        x0 = case['x0']\n        T = case['T']\n        steps = case['steps']\n        tol_mean = case['tol_mean']\n        tol_var = case['tol_var']\n\n        # --- Theoretical Moments Calculation ---\n        # E[X_T] = x0 + delta * T\n        # Var(X_T) = 2 * delta * T^2 + 4 * x0 * T\n        theoretical_mean = x0 + delta * T\n        theoretical_var = 2 * delta * T**2 + 4 * x0 * T\n\n        # --- Monte Carlo Simulation ---\n        dt = T / steps\n        current_x_samples = np.full(NUM_SAMPLES, x0)\n\n        for _ in range(steps):\n            # Degrees of freedom for the noncentral chi-square distribution is delta.\n            k = delta\n            # Noncentrality parameter is current state / time increment.\n            # This can be a scalar (for step 1) or an array (for subsequent steps).\n            noncentrality = current_x_samples / dt\n            \n            # Sample from the underlying chi-square distribution.\n            # The ncx2.rvs function can handle an array of noncentrality parameters.\n            chi2_samples = ncx2.rvs(df=k, nc=noncentrality, size=NUM_SAMPLES)\n            \n            # Scale the samples to get the BESQ process values.\n            current_x_samples = dt * chi2_samples\n\n        final_samples = current_x_samples\n\n        # --- Verification ---\n        empirical_mean = np.mean(final_samples)\n        # Using ddof=0 for population variance estimate, which is standard in MC.\n        empirical_var = np.var(final_samples, ddof=0)\n        \n        # Calculate relative errors.\n        # Theoretical moments are always positive given the problem constraints (delta>0, T>0, x0>=0).\n        rel_err_mean = np.abs(empirical_mean - theoretical_mean) / theoretical_mean\n        rel_err_var = np.abs(empirical_var - theoretical_var) / theoretical_var\n\n        # Check if both mean and variance are within tolerance.\n        is_valid = (rel_err_mean <= tol_mean) and (rel_err_var <= tol_var)\n        results.append(str(is_valid).lower())\n\n    # --- Final Output ---\n    # The output string must be in the format \"[true,false,...]\"\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2969795"}]}