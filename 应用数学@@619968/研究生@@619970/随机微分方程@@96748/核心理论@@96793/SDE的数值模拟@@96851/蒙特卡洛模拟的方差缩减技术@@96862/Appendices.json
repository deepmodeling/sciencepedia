{"hands_on_practices": [{"introduction": "控制变量法是一种直观而强大的技术，它利用另一个与目标量相关且期望已知的随机变量来降低估计量的方差。本练习旨在通过剖析控制变量估计量的关键性质——如无偏性、最优系数的选择以及实现零方差的理想条件——来巩固您对该方法基本原理的理解。掌握这些核心概念对于在实践中正确并有效地应用此技术至关重要。[@problem_id:3005280]", "problem": "考虑一个一维几何布朗运动 (GBM) $X_t$，它满足随机微分方程 (SDE)\n$$\n\\mathrm{d}X_t = \\mu X_t\\,\\mathrm{d}t + \\sigma X_t\\,\\mathrm{d}W_t,\\quad X_0>0,\n$$\n其中 $\\mu\\in\\mathbb{R}$ 和 $\\sigma>0$ 是常数， $W_t$ 是一个标准布朗运动。您希望使用蒙特卡洛 (MC) 方法，在一个固定时间 $T>0$ 估计某个收益 $Y:=g(X_T)$ 的期望，其中 $g:\\mathbb{R}_+\\to\\mathbb{R}$ 在 GBM 的分布下是可测且可积的。您考虑使用控制变量 $C:=X_T$，并计划使用基于 $n\\in\\mathbb{N}$ 个独立同分布 (i.i.d.) 样本的控制变量估计量：\n$$\n\\widehat{\\theta}_{n,\\beta,m} \\;:=\\; \\frac{1}{n}\\sum_{i=1}^n \\Big( g\\!\\big(X_T^{(i)}\\big) - \\beta\\big(X_T^{(i)} - m\\big)\\Big),\n$$\n其中 $m$ 是您作为 $X_T$ 均值代入的数值，$\\beta\\in\\mathbb{R}$ 是您选择的系数。\n\n选择所有正确的陈述。\n\nA. 从该 SDE 的结构可以推导出，对于任何 $\\sigma>0$，都有 $\\mathbb{E}[X_T] = X_0\\,\\mathrm{e}^{\\mu T}$。\n\nB. 对于任何固定的确定性 $\\beta\\in\\mathbb{R}$，如果 $m=\\mathbb{E}[X_T]$ 是正确的，则 $\\widehat{\\theta}_{n,\\beta,m}$ 是 $\\mathbb{E}[Y]$ 的一个无偏估计量。如果您用 $m+\\delta$（其中 $\\delta\\in\\mathbb{R}$）代替真实均值 $m$，则该估计量的偏差等于 $\\beta\\,\\delta$。\n\nC. 在所有固定的确定性 $\\beta$ 选择中，$\\widehat{\\theta}_{n,\\beta,m}$ 的方差在以下值处达到最小：\n$$\n\\beta^\\star \\;=\\; \\frac{\\operatorname{Cov}\\!\\big(g(X_T),X_T\\big)}{\\operatorname{Var}(X_T)}.\n$$\n\nD. 如果 $m$ 指定错误，通过对 $g(X_T)$ 关于 $X_T$ 进行最小二乘回归，并使用相同的 $n$ 个样本来估计 $\\beta$，由于正交性条件，这仍然能保证 $\\widehat{\\theta}_{n,\\widehat{\\beta},m}$ 的无偏性。\n\nE. 如果 $g$ 是仿射函数，即 $g(x)=a x + b$ 且 $a\\neq 0$，并且使用 $m=\\mathbb{E}[X_T]$，则选择 $\\beta=a$ 会对任意 $n\\ge 1$ 都产生一个 $\\mathbb{E}[Y]$ 的零方差估计量。", "solution": "用户希望对一个关于几何布朗运动相关的蒙特卡洛估计中控制变量技术的问题进行批判性分析。\n\n### 问题验证\n\n首先，我将验证问题陈述。\n\n**步骤 1：提取已知条件**\n-   随机过程是一个一维几何布朗运动 (GBM) $X_t$，满足随机微分方程 (SDE)：\n    $$\n    \\mathrm{d}X_t = \\mu X_t\\,\\mathrm{d}t + \\sigma X_t\\,\\mathrm{d}W_t\n    $$\n-   初始条件为 $X_0 > 0$。\n-   参数是常数：$\\mu \\in \\mathbb{R}$ 和 $\\sigma > 0$。\n-   $W_t$ 是一个标准布朗运动。\n-   要估计的量是在一个固定时间 $T > 0$ 的收益 $Y := g(X_T)$ 的期望。\n-   函数 $g: \\mathbb{R}_+ \\to \\mathbb{R}$ 在 GBM 的分布下是可测且可积的。\n-   使用了一种控制变量技术，控制变量为 $C := X_T$。\n-   基于 $n \\in \\mathbb{N}$ 个独立同分布样本的控制变量估计量为：\n    $$\n    \\widehat{\\theta}_{n,\\beta,m} \\;:=\\; \\frac{1}{n}\\sum_{i=1}^n \\Big( g\\!\\big(X_T^{(i)}\\big) - \\beta\\big(X_T^{(i)} - m\\big)\\Big)\n    $$\n-   估计量的参数是一个选择的系数 $\\beta \\in \\mathbb{R}$ 和一个用作 $X_T$ 均值代理的数值 $m$。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学上可靠：**该问题牢固地植根于随机微积分（特别是几何布朗运动）和数值统计（蒙特卡洛方法和方差缩减技术）的既有理论。所有概念都是标准的，并且在数学上是严谨的。\n-   **适定性：**GBM 的 SDE 是适定的，并有唯一的强解。分析给定控制变量估计量的统计性质（偏差、方差）是一个定义明确的数学任务。\n-   **客观性：**该问题使用精确、客观的数学语言陈述，没有歧义或主观性。\n\n**缺陷清单：**\n1.  **科学或事实上的不健全性：**无。模型和方法都是标准的。\n2.  **无法形式化或不相关：**无。问题是形式化的，并且与主题直接相关。\n3.  **不完整或矛盾的设置：**无。所有必要的定义都已提供。\n4.  **不切实际或不可行：**无。GBM 是一个广泛使用的模型。\n5.  **不适定或结构不良：**无。关于估计量性质的问题有唯一答案。\n6.  **伪深刻、琐碎或同义反复：**无。这些问题测试了基础且不平凡的概念。\n7.  **超出科学可验证性：**无。所有陈述都可以通过数学方法证明或证伪。\n\n**步骤 3：结论和行动**\n问题陈述是有效的。我将继续分析每个选项。\n\n### 解题推导\n\n令 $Y = g(X_T)$ 且 $C=X_T$。我们关注的量是 $\\theta = \\mathbb{E}[Y]$。单个样本的控制变量估计量为 $Y'_i = Y_i - \\beta(C_i - m)$，其中 $Y_i = g(X_T^{(i)})$ 且 $C_i = X_T^{(i)}$。总估计量是这些调整后值的样本均值，即 $\\widehat{\\theta}_{n,\\beta,m} = \\frac{1}{n}\\sum_{i=1}^n Y'_i$。\n\nGBM SDE 的显式解为 $X_t = X_0 \\exp\\left((\\mu - \\frac{1}{2}\\sigma^2)t + \\sigma W_t\\right)$。由于 $W_T \\sim \\mathcal{N}(0, T)$，随机变量 $\\ln(X_T)$ 服从正态分布：$\\ln(X_T) \\sim \\mathcal{N}\\left(\\ln(X_0) + (\\mu - \\frac{1}{2}\\sigma^2)T, \\sigma^2 T\\right)$。这意味着 $X_T$ 服从对数正态分布。\n\n**选项 A 分析：**\n该陈述关于 $X_T$ 的期望。我们可以直接从 SDE 计算它。令 $m(t)=\\mathbb{E}[X_t]$。对 SDE 从 $0$ 到 $T$ 积分并取期望，得到：\n$$\n\\mathbb{E}[X_T] = \\mathbb{E}[X_0] + \\mathbb{E}\\left[\\int_0^T \\mu X_s \\mathrm{d}s\\right] + \\mathbb{E}\\left[\\int_0^T \\sigma X_s \\mathrm{d}W_s\\right]\n$$\n给定 $X_0$ 是一个正常数，$\\mathbb{E}[X_0]=X_0$。使用 Fubini 定理对勒贝格-斯蒂尔切斯积分，我们可以交换期望和时间积分。伊藤积分的期望为零，只要被积函数满足特定的平方可积条件，而 $X_t$ 满足这些条件。\n$$\n\\mathbb{E}[X_T] = X_0 + \\mu \\int_0^T \\mathbb{E}[X_s] \\mathrm{d}s\n$$\n这给出了均值 $m(t) = \\mathbb{E}[X_t]$ 的常微分方程：\n$m'(t) = \\mu m(t)$，初始条件为 $m(0) = X_0$。唯一解是 $m(t) = X_0 e^{\\mu t}$。\n因此，$\\mathbb{E}[X_T] = X_0 e^{\\mu T}$。此结果对任何 $\\sigma>0$ 都成立。推导是可靠的。\n或者，使用显式解：\n$$\n\\mathbb{E}[X_T] = X_0 \\exp\\left( (\\mu - \\frac{1}{2}\\sigma^2)T \\right) \\mathbb{E}\\left[\\exp(\\sigma W_T)\\right]\n$$\n$\\sigma W_T$ 项是一个均值为 $0$、方差为 $\\sigma^2 T$ 的正态随机变量。一个正态变量 $Z \\sim \\mathcal{N}(m_z, s_z^2)$ 的矩生成函数为 $\\mathbb{E}[e^Z] = e^{m_z + s_z^2/2}$。对于 $\\sigma W_T$，此值为 $e^{0 + (\\sigma^2 T)/2} = e^{\\frac{1}{2}\\sigma^2 T}$。\n$$\n\\mathbb{E}[X_T] = X_0 \\exp\\left( (\\mu - \\frac{1}{2}\\sigma^2)T \\right) e^{\\frac{1}{2}\\sigma^2 T} = X_0 e^{\\mu T}\n$$\n此陈述是 **正确的**。\n\n**选项 B 分析：**\n该陈述与估计量的偏差有关。估计量为 $\\widehat{\\theta}_{n,\\beta,m_{used}} = \\frac{1}{n}\\sum_i (g(X_T^{(i)}) - \\beta(X_T^{(i)} - m_{used}))$。\n令真实均值为 $m_{true} = \\mathbb{E}[X_T]$。该陈述考虑使用 $m_{used} = m_{true} + \\delta$。\n估计量的期望是：\n$$\n\\mathbb{E}[\\widehat{\\theta}_{n,\\beta,m_{true}+\\delta}] = \\mathbb{E}\\left[ \\frac{1}{n}\\sum_{i=1}^n \\left( g(X_T^{(i)}) - \\beta(X_T^{(i)} - (m_{true}+\\delta))\\right) \\right]\n$$\n因为样本是独立同分布的，这可以简化为单个调整后样本的期望：\n$$\n\\mathbb{E}[\\widehat{\\theta}_{n,\\beta,m_{true}+\\delta}] = \\mathbb{E}\\left[ g(X_T) - \\beta(X_T - m_{true} - \\delta) \\right]\n$$\n利用期望的线性性质：\n$$\n\\mathbb{E}[\\widehat{\\theta}_{n,\\beta,m_{true}+\\delta}] = \\mathbb{E}[g(X_T)] - \\beta\\mathbb{E}[X_T - m_{true} - \\delta]\n$$\n$$\n= \\mathbb{E}[g(X_T)] - \\beta(\\mathbb{E}[X_T] - m_{true} - \\delta)\n$$\n由于 $\\mathbb{E}[X_T] = m_{true}$，这变成：\n$$\n= \\mathbb{E}[g(X_T)] - \\beta(m_{true} - m_{true} - \\delta) = \\mathbb{E}[g(X_T)] + \\beta\\delta\n$$\n要估计的真实量是 $\\theta = \\mathbb{E}[g(X_T)]$。偏差定义为 $\\text{Bias} = \\mathbb{E}[\\widehat{\\theta}] - \\theta$。\n在这种情况下，$\\text{Bias} = (\\mathbb{E}[g(X_T)] + \\beta\\delta) - \\mathbb{E}[g(X_T)] = \\beta\\delta$。\n如果正确使用 $m = \\mathbb{E}[X_T]$，则 $\\delta=0$，偏差为 $0$。该估计量是无偏的。\n如果使用 $m+\\delta$，偏差为 $\\beta\\delta$。\n该陈述提出了这两个论点。\n此陈述是 **正确的**。\n\n**选项 C 分析：**\n该陈述是关于最小化方差。估计量的方差是：\n$$\n\\operatorname{Var}(\\widehat{\\theta}_{n,\\beta,m}) = \\operatorname{Var}\\left(\\frac{1}{n}\\sum_{i=1}^n \\left( g(X_T^{(i)}) - \\beta(X_T^{(i)} - m)\\right) \\right)\n$$\n因为样本是独立同分布的，其方差是单个调整后样本方差的 $\\frac{1}{n}$ 倍：\n$$\n\\operatorname{Var}(\\widehat{\\theta}_{n,\\beta,m}) = \\frac{1}{n} \\operatorname{Var}\\left( g(X_T) - \\beta(X_T - m) \\right)\n$$\n常数项 $m$ 不影响方差，所以我们最小化 $\\operatorname{Var}(g(X_T) - \\beta X_T)$。令 $Y=g(X_T)$ 且 $C=X_T$。\n$$\nf(\\beta) := \\operatorname{Var}(Y - \\beta C) = \\operatorname{Var}(Y) + \\operatorname{Var}(-\\beta C) + 2\\operatorname{Cov}(Y, -\\beta C)\n$$\n$$\nf(\\beta) = \\operatorname{Var}(Y) + \\beta^2\\operatorname{Var}(C) - 2\\beta\\operatorname{Cov}(Y,C)\n$$\n这是一个关于 $\\beta$ 的二次函数。为了找到最小值，我们将其对 $\\beta$ 的导数设为零：\n$$\n\\frac{\\mathrm{d}f}{\\mathrm{d}\\beta} = 2\\beta\\operatorname{Var}(C) - 2\\operatorname{Cov}(Y,C) = 0\n$$\n$$\n\\implies \\beta = \\frac{\\operatorname{Cov}(Y,C)}{\\operatorname{Var}(C)}\n$$\n二阶导数是 $2\\operatorname{Var}(C) = 2\\operatorname{Var}(X_T)$。由于 $\\sigma > 0$，$X_T$ 不是常数，所以其方差为正。这确认了我们找到了一个最小值。将原始变量代回：\n$$\n\\beta^\\star = \\frac{\\operatorname{Cov}(g(X_T),X_T)}{\\operatorname{Var}(X_T)}\n$$\n这与陈述中的公式相匹配。\n此陈述是 **正确的**。\n\n**选项 D 分析：**\n该陈述声称，如果 $\\beta$ 是从相同的样本中估计的，即使 $m$ 指定错误，估计量仍然是无偏的。令 $\\widehat{\\beta}$ 为 $g(X_T^{(i)})$ 对 $X_T^{(i)}$ 进行回归得到的斜率的普通最小二乘 (OLS) 估计量。\n该估计量变为 $\\widehat{\\theta}_{n,\\widehat{\\beta},m} = \\frac{1}{n}\\sum_i (g(X_T^{(i)}) - \\widehat{\\beta}(X_T^{(i)} - m))$。\n令 $\\bar{g} = \\frac{1}{n}\\sum g(X_T^{(i)})$ 且 $\\bar{X} = \\frac{1}{n}\\sum X_T^{(i)}$。该估计量可以写为 $\\widehat{\\theta}_{n,\\widehat{\\beta},m} = \\bar{g} - \\widehat{\\beta}(\\bar{X} - m)$。\nOLS 估计量 $\\widehat{\\beta}$ 是 $\\widehat{\\beta} = \\frac{\\sum_i (X_T^{(i)}-\\bar{X})(g(X_T^{(i)})-\\bar{g})}{\\sum_i (X_T^{(i)}-\\bar{X})^2}$。\n$\\widehat{\\beta}$ 是一个依赖于所有样本 $\\{X_T^{(i)}\\}_{i=1}^n$ 的随机变量。$\\bar{X}$ 项也依赖于所有样本。因此，$\\widehat{\\beta}$ 和 $\\bar{X}$ 不是独立的。\n我们来分析期望：\n$$\n\\mathbb{E}[\\widehat{\\theta}_{n,\\widehat{\\beta},m}] = \\mathbb{E}[\\bar{g} - \\widehat{\\beta}(\\bar{X} - m)] = \\mathbb{E}[\\bar{g}] - \\mathbb{E}[\\widehat{\\beta}(\\bar{X} - m)]\n$$\n$\\mathbb{E}[\\bar{g}] = \\mathbb{E}[g(X_T)]$。要满足无偏性，我们需要 $\\mathbb{E}[\\widehat{\\beta}(\\bar{X} - m)] = 0$。\n通常，$\\mathbb{E}[\\widehat{\\beta}(\\bar{X} - m)] = \\mathbb{E}[\\widehat{\\beta}](\\mathbb{E}[\\bar{X}]-m) + \\operatorname{Cov}(\\widehat{\\beta}, \\bar{X})$。\n即使 $m = \\mathbb{E}[X_T]$，$\\operatorname{Cov}(\\widehat{\\beta}, \\bar{X})$ 项通常也不为零。$\\widehat{\\beta}$ 和 $\\bar{X}$ 是来自相同底层样本的相关函数。这会引入一个偏差，这是控制变量方法中一个众所周知的问题，即当最优系数从同一样本中估计时。该偏差通常是 $1/n$ 阶的，并在渐近情况下消失，但对于任何有限的 $n$ 都存在。因此，“保证无偏性”的说法是错误的。OLS 的“正交性条件”指的是样本内的性质（例如，残差和为零，回归量与残差的样本协方差为零），而不是关于重复实验的期望。\n此陈述是 **不正确的**。\n\n**选项 E 分析：**\n这里，$g(x) = ax+b$，其中 $a\\neq 0, b$ 是常数。我们使用 $m=\\mathbb{E}[X_T]$ 并选择 $\\beta=a$。\n我们来考察单个样本 $i$ 的调整后值：\n$$\nY'_i = g(X_T^{(i)}) - \\beta(X_T^{(i)} - m) = (a X_T^{(i)} + b) - a(X_T^{(i)} - \\mathbb{E}[X_T])\n$$\n$$\n= a X_T^{(i)} + b - a X_T^{(i)} + a \\mathbb{E}[X_T] = b + a \\mathbb{E}[X_T]\n$$\n这个值 $Y'_i$ 是一个常数，因为它不依赖于具体的样本结果 $X_T^{(i)}$。\n估计量是这些相同常数值的平均值：\n$$\n\\widehat{\\theta}_{n,a,m} = \\frac{1}{n} \\sum_{i=1}^n (b + a \\mathbb{E}[X_T]) = b + a \\mathbb{E}[X_T]\n$$\n由于对于任何样本大小 $n \\ge 1$，估计量本身都是一个常数，其方差为零：$\\operatorname{Var}(\\widehat{\\theta}_{n,a,m}) = 0$。\n此外，估计量的值是 $b + a \\mathbb{E}[X_T]$。我们希望估计的真实量是 $\\mathbb{E}[Y] = \\mathbb{E}[g(X_T)] = \\mathbb{E}[aX_T + b] = a\\mathbb{E}[X_T] + b$。\n该估计量以零方差给出了确切的真实值。这就是完美控制变量的原理。条件均已满足。\n此陈述是 **正确的**。\n\n### 正确陈述总结\n- A：正确。\n- B：正确。\n- C：正确。\n- D：不正确。\n- E：正确。\n\n所以正确的选项是 A、B、C 和 E。", "answer": "$$\n\\boxed{ABCE}\n$$", "id": "3005280"}, {"introduction": "当我们可以利用多个相关变量作为控制时，如何将控制变量法的威力最大化？此练习将指导您从单变量设置自然地过渡到多维情况，通过最小二乘法推导出最优的系数向量。更重要的是，它引入了一个在实际应用中至关重要的问题：当控制变量之间高度相关（导致协方差矩阵病态）时，如何确保解的稳定性，并借此向您介绍吉洪诺夫正则化（Tikhonov regularization）这一关键的数值稳定化技术。[@problem_id:3005312]", "problem": "考虑一个状态过程 $\\{S_t\\}_{t \\in [0,T]}$ 的伊藤随机微分方程 (SDE)，该过程定义在一个支持标准布朗运动的概率空间上，其系数确保强解的存在唯一性及有限二阶矩。令 $X = \\varphi(S_T)$ 为一个平方可积的收益，满足 $\\mathbb{E}[|X|^2] < \\infty$。假设您有兴趣使用蒙特卡罗方法估计 $\\mu = \\mathbb{E}[X]$。您可以使用一个 $m$ 维的平方可积控制变量向量 $Y = (Y_1,\\dots,Y_m)^{\\top}$，该向量满足 $\\mathbb{E}[Y] = 0$，其协方差矩阵为 $\\Sigma = \\operatorname{Cov}(Y)$，与 $X$ 的互协方差向量为 $c = \\operatorname{Cov}(Y,X)$。假设 $\\Sigma$ 是对称且半正定的。\n\n您考虑基于单条路径的一族无偏控制估计量，\n$$\nZ(\\beta) = X - \\beta^{\\top} Y,\n$$\n以及基于 $n$ 个独立同分布样本的相应蒙特卡罗估计量，\n$$\n\\hat{\\mu}_n(\\beta) = \\frac{1}{n}\\sum_{k=1}^{n} \\bigl(X^{(k)} - \\beta^{\\top} Y^{(k)}\\bigr).\n$$\n将 $\\beta \\in \\mathbb{R}^m$ 视为一个在采样前选择的确定性系数向量，其目的是最小化 $Z(\\beta)$ 的方差。假设所有需要的二阶矩都存在。\n\n任务：\n1) 从方差和协方差的定义出发，并将问题视为在 $L^2$ 空间中的一个最小二乘投影，推导出在 $\\Sigma$ 是正定的假设下，$\\operatorname{Var}(X - \\beta^{\\top} Y)$ 的唯一最小化子 $\\beta^{\\star}$。\n\n2) 在 $\\Sigma$ 是病态的场景中，考虑 Tikhonov 正则化目标\n$$\nJ_{\\lambda}(\\beta) = \\operatorname{Var}(X - \\beta^{\\top} Y) + \\lambda \\|\\beta\\|_2^2,\\quad \\lambda > 0.\n$$\n推导出相应的正则化最小化子 $\\beta_{\\lambda}$ 的闭式解，并解释当 $\\Sigma$ 的条件数很大时，$\\Sigma$ 的特征结构如何影响 $\\beta_{\\lambda}$。您的推导必须是显式的，且仅依赖于线性代数和二阶矩恒等式。\n\n作为最终答案，请提供 $\\beta^{\\star}$ 和 $\\beta_{\\lambda}$ 的闭式表达式。不要提供任何数值计算。最终答案必须是单一的、不带单位的解析表达式。", "solution": "这个问题要求推导控制变量估计量的最优系数向量 $\\beta$，包括在标准情况下和 Tikhonov 正则化设定下。问题的核心是最小化一个方差，该方差是系数的二次函数。我们将使用线性代数和多元微积分的标准方法。\n\n首先，我们确定目标函数的形式，即控制估计量 $Z(\\beta) = X - \\beta^{\\top} Y$ 的方差。向量 $\\beta \\in \\mathbb{R}^m$ 是确定性的。随机变量是 $X$，随机向量是 $Y$。控制估计量的期望为\n$$\n\\mathbb{E}[Z(\\beta)] = \\mathbb{E}[X - \\beta^{\\top} Y] = \\mathbb{E}[X] - \\beta^{\\top} \\mathbb{E}[Y].\n$$\n鉴于 $\\mathbb{E}[Y] = 0$，我们有 $\\mathbb{E}[Z(\\beta)] = \\mathbb{E}[X] = \\mu$。这证实了对于任意选择的 $\\beta$，$Z(\\beta)$ 都是 $\\mu$ 的一个无偏估计量。我们的目标是选择 $\\beta$ 以最小化该估计量的方差。\n\n$Z(\\beta)$ 的方差由下式给出\n$$\n\\operatorname{Var}(Z(\\beta)) = \\operatorname{Var}(X - \\beta^{\\top} Y).\n$$\n利用协方差的性质，特别是其双线性，我们可以展开此表达式。令 $V(\\beta) = \\operatorname{Var}(X - \\beta^{\\top} Y)$。\n$$\nV(\\beta) = \\operatorname{Cov}(X - \\beta^{\\top} Y, X - \\beta^{\\top} Y)\n$$\n$$\nV(\\beta) = \\operatorname{Cov}(X, X) - \\operatorname{Cov}(X, \\beta^{\\top} Y) - \\operatorname{Cov}(\\beta^{\\top} Y, X) + \\operatorname{Cov}(\\beta^{\\top} Y, \\beta^{\\top} Y).\n$$\n认识到 $\\operatorname{Cov}(A, B) = \\operatorname{Cov}(B, A)^{\\top}$ 并且方差是协方差的一种特殊情况，即 $\\operatorname{Var}(A) = \\operatorname{Cov}(A, A)$，我们有：\n$$\nV(\\beta) = \\operatorname{Var}(X) - 2 \\operatorname{Cov}(\\beta^{\\top} Y, X) + \\operatorname{Var}(\\beta^{\\top} Y).\n$$\n现在我们使用给定的定义来表示协方差和方差项。\n项 $\\operatorname{Cov}(\\beta^{\\top} Y, X)$ 是一个标量。使用协方差关于矩阵-向量积的性质：\n$$\n\\operatorname{Cov}(\\beta^{\\top} Y, X) = \\beta^{\\top} \\operatorname{Cov}(Y, X) = \\beta^{\\top} c.\n$$\n方差项 $\\operatorname{Var}(\\beta^{\\top} Y)$ 也是一个标量：\n$$\n\\operatorname{Var}(\\beta^{\\top} Y) = \\beta^{\\top} \\operatorname{Cov}(Y, Y) \\beta = \\beta^{\\top} \\Sigma \\beta.\n$$\n将这些代回 $V(\\beta)$ 的表达式，我们得到关于 $\\beta$ 的二次型目标函数：\n$$\nV(\\beta) = \\operatorname{Var}(X) - 2 \\beta^{\\top} c + \\beta^{\\top} \\Sigma \\beta.\n$$\n项 $\\operatorname{Var}(X)$ 相对于 $\\beta$ 是一个常数。\n\n在希尔伯特空间 $L^2$ 中的几何解释是，我们正在寻找中心化随机变量 $X-\\mu$ 在由 $Y = (Y_1, \\dots, Y_m)^{\\top}$ 的分量所张成的线性子空间中的最佳逼近。最小化方差 $V(\\beta) = \\operatorname{Var}(X - \\beta^{\\top} Y) = \\mathbb{E}[( (X - \\beta^{\\top} Y) - \\mu )^2] = \\mathbb{E}[((X - \\mu) - \\beta^{\\top} Y)^2]$ 等价于求 $X-\\mu$到 $\\{Y_1, \\dots, Y_m\\}$ 的张成空间上的正交投影。该最小二乘问题的正规方程会得出相同的解。\n\n### 任务1：最优最小化子 $\\beta^{\\star}$ 的推导\n\n为了找到最小化 $V(\\beta)$ 的向量 $\\beta$，我们计算 $V(\\beta)$ 关于 $\\beta$ 的梯度，并令其为零。使用标准的矩阵微积分恒等式，对于对称矩阵 $A$，有 $\\nabla_{\\beta} (\\beta^{\\top} a) = a$ 和 $\\nabla_{\\beta} (\\beta^{\\top} A \\beta) = 2A\\beta$：\n$$\n\\nabla_{\\beta} V(\\beta) = \\nabla_{\\beta} (\\operatorname{Var}(X) - 2 \\beta^{\\top} c + \\beta^{\\top} \\Sigma \\beta).\n$$\n$$\n\\nabla_{\\beta} V(\\beta) = 0 - 2c + 2\\Sigma\\beta.\n$$\n将梯度设为零，得到最小化的一阶条件：\n$$\n-2c + 2\\Sigma\\beta = 0 \\implies \\Sigma\\beta = c.\n$$\n问题陈述中指出，对于此任务，协方差矩阵 $\\Sigma$ 是正定的。根据定义，正定矩阵是可逆的。因此，我们可以通过左乘 $\\Sigma$ 的逆矩阵来解出 $\\beta$：\n$$\n\\beta^{\\star} = \\Sigma^{-1} c.\n$$\n为了确证这是一个最小值点，我们通过计算 $V(\\beta)$ 的海森矩阵来检验二阶条件：\n$$\n\\nabla^2_{\\beta} V(\\beta) = \\nabla_{\\beta} (-2c + 2\\Sigma\\beta) = 2\\Sigma.\n$$\n由于 $\\Sigma$ 是正定的，海森矩阵 $2\\Sigma$ 也是正定的。这证实了 $V(\\beta)$ 是一个严格凸函数，且 $\\beta^{\\star}$ 是其唯一的全局最小化子。\n\n### 任务2：正则化最小化子 $\\beta_{\\lambda}$ 的推导\n\n现在我们考虑当 $\\lambda > 0$ 时的 Tikhonov 正则化目标函数：\n$$\nJ_{\\lambda}(\\beta) = \\operatorname{Var}(X - \\beta^{\\top} Y) + \\lambda \\|\\beta\\|_2^2.\n$$\n代入方差项的表达式，并注意到 $\\|\\beta\\|_2^2 = \\beta^{\\top}\\beta = \\beta^{\\top}I\\beta$，其中 $I$ 是 $m \\times m$ 的单位矩阵，可得：\n$$\nJ_{\\lambda}(\\beta) = (\\operatorname{Var}(X) - 2 \\beta^{\\top} c + \\beta^{\\top} \\Sigma \\beta) + \\lambda \\beta^{\\top} I \\beta.\n$$\n合并关于 $\\beta$ 的二次项：\n$$\nJ_{\\lambda}(\\beta) = \\operatorname{Var}(X) - 2 \\beta^{\\top} c + \\beta^{\\top} (\\Sigma + \\lambda I) \\beta.\n$$\n这同样是 $\\beta$ 的一个二次函数。我们通过将其梯度设为零来找到最小化子：\n$$\n\\nabla_{\\beta} J_{\\lambda}(\\beta) = \\nabla_{\\beta} (\\operatorname{Var(X)} - 2 \\beta^{\\top} c + \\beta^{\\top} (\\Sigma + \\lambda I) \\beta).\n$$\n由于 $\\Sigma$ 是对称的，矩阵 $\\Sigma + \\lambda I$ 也是对称的。因此，我们可以应用相同的梯度法则：\n$$\n\\nabla_{\\beta} J_{\\lambda}(\\beta) = -2c + 2(\\Sigma + \\lambda I) \\beta.\n$$\n将梯度设为零，得到一阶条件：\n$$\n-2c + 2(\\Sigma + \\lambda I) \\beta = 0 \\implies (\\Sigma + \\lambda I) \\beta = c.\n$$\n为了解出 $\\beta$，我们必须对矩阵 $(\\Sigma + \\lambda I)$ 求逆。$\\Sigma$ 是一个协方差矩阵，因此它是对称且半正定的。设 $\\Sigma$ 的特征值为 $\\sigma_i \\ge 0$，$i=1, \\dots, m$。矩阵 $\\lambda I$ 的所有特征值都等于 $\\lambda$。和矩阵 $\\Sigma + \\lambda I$ 的特征值为 $\\sigma_i + \\lambda$。由于 $\\lambda > 0$，所有的特征值 $\\sigma_i + \\lambda$ 都严格为正。一个具有严格正特征值的对称矩阵是正定的，因此也是可逆的。因此，我们可以唯一地解出正则化最小化子 $\\beta_{\\lambda}$：\n$$\n\\beta_{\\lambda} = (\\Sigma + \\lambda I)^{-1} c.\n$$\n$J_{\\lambda}(\\beta)$ 的海森矩阵是 $2(\\Sigma + \\lambda I)$，它是正定的，这证实了 $\\beta_{\\lambda}$ 是唯一的全局最小化子。\n\n### 关于特征结构影响的解释\n\n令 $\\Sigma = U D U^{\\top}$ 为 $\\Sigma$ 的谱分解，其中 $U$ 是一个正交矩阵，其列是 $\\Sigma$ 的特征向量，$D$ 是由相应的非负特征值 $\\sigma_1 \\ge \\sigma_2 \\ge \\dots \\ge \\sigma_m \\ge 0$ 构成的对角矩阵。\n\n如果 $\\Sigma$ 可逆（所有的 $\\sigma_i > 0$），非正则化解为 $\\beta^{\\star} = (UDU^{\\top})^{-1}c = UD^{-1}U^{\\top}c$。\n正则化解为 $\\beta_{\\lambda} = (UDU^{\\top} + \\lambda I)^{-1}c = (U(D+\\lambda I)U^{\\top})^{-1}c = U(D+\\lambda I)^{-1}U^{\\top}c$。\n\n让我们在 $\\Sigma$ 的特征向量基中分析这些解。令 $c' = U^{\\top}c$ 为协方差向量 $c$ 在该基下的表示。\n在该基下的非正则化解为 $U^{\\top}\\beta^{\\star} = D^{-1}c'$。其第 $i$ 个分量为 $(U^{\\top}\\beta^{\\star})_i = c'_i / \\sigma_i$。\n在该基下的正则化解为 $U^{\\top}\\beta_{\\lambda} = (D+\\lambda I)^{-1}c'$。其第 $i$ 个分量为 $(U^{\\top}\\beta_{\\lambda})_i = c'_i / (\\sigma_i + \\lambda)$。\n\n当 $\\Sigma$ 是病态的，其条件数 $\\kappa(\\Sigma) = \\sigma_1/\\sigma_m$ 非常大，意味着至少有一个特征值 $\\sigma_m$ 接近于零。\n对于非正则化解 $\\beta^{\\star}$，与小特征值 $\\sigma_i$ 对应的分量会被一个大因子 $1/\\sigma_i$ 缩放。这可能导致解向量 $\\beta^{\\star}$ 具有极大的欧几里德范数，使得估计量对 $c$ 中的噪声或估计误差（$c$ 通常由引导样本估计）高度敏感。\n\nTikhonov 正则化解决了这个问题。正则化解 $\\beta_{\\lambda}$ 的缩放因子是 $1/(\\sigma_i + \\lambda)$。由于 $\\lambda > 0$，该分母的下界为 $\\lambda$。对于与小特征值（$\\sigma_i \\approx 0$）相关联的特征向量，缩放因子约为 $1/\\lambda$，这是一个由 $\\lambda$ 的选择所控制的有限值。对于与大特征值（$\\sigma_i \\gg \\lambda$）相关联的特征向量，缩放因子为 $1/(\\sigma_i + \\lambda) \\approx 1/\\sigma_i$，这与非正则化的情况相近。\n本质上，正则化“衰减”了解沿控制变量方差较小方向（即小特征值对应的特征向量方向）的分量，防止解的“爆炸”。这为 $\\beta$ 的估计量引入了偏差，但显著降低了其方差，这是一个经典的偏差-方差权衡。它在面对病态条件时稳定了解。", "answer": "$$ \\boxed{ \\begin{pmatrix} \\Sigma^{-1} c & (\\Sigma + \\lambda I)^{-1} c \\end{pmatrix} } $$", "id": "3005312"}, {"introduction": "多层蒙特卡洛（MLMC）方法是一种更为先进的方差缩减框架，它通过巧妙地结合多个不同离散化精度的模拟结果来优化计算效率。MLMC成功的关键在于如何在不同层级间明智地分配计算资源。本练习将引导您深入MLMC效率理论的核心，通过使用拉格朗日乘子法解决“在固定方差预算下最小化总计算成本”这一经典优化问题。掌握如何确定各层级的最优样本数，是高效实施MLMC方法的基石。[@problem_id:3005294]", "problem": "考虑一个用于求解随机微分方程（SDE）解$X_{t}$的泛函$\\varphi(X_{T})$的多层蒙特卡洛（MLMC）估计量，该SDE由标准布朗运动驱动，估计量通过跨离散化层级$l \\in \\{0,1,\\dots,L\\}$的伸缩求和构建。在每个层级$l$，令层级差分随机变量表示为$Y_{l}$，其独立同分布样本为$\\{Y_{l}^{(i)}\\}_{i=1}^{N_{l}}$。并假设对于每个$l$，存在严格正常数$V_{l}$和$C_{l}$，使得单样本方差为$\\operatorname{Var}(Y_{l}^{(1)}) = V_{l}$，单样本预期计算功为$C_{l}$。假设各层级间的样本是独立的，总预期计算功为$\\sum_{l=0}^{L} N_{l} C_{l}$，总估计量方差为$\\sum_{l=0}^{L} V_{l} / N_{l}$。\n\n给定一个严格的方差预算$\\mathcal{V} > 0$，该预算必须精确满足，即分配$\\{N_{l}\\}_{l=0}^{L}$必须满足$\\sum_{l=0}^{L} V_{l} / N_{l} = \\mathcal{V}$。\n\n从独立样本均值的方差定义和预期计算功的可加性出发，建立并进行拉格朗日乘数法优化，以确定在方差预算$\\mathcal{V}$约束下最小化总预期计算功的最优抽样分配$\\{N_{l}\\}_{l=0}^{L}$。从此优化中，分离并显式求解出与层级相关因子相乘得到最优$N_{l}$的比例常数。\n\n请以关于$\\{V_{l}\\}_{l=0}^{L}$、$\\{C_{l}\\}_{l=0}^{L}$和$\\mathcal{V}$的单个闭式解析表达式的形式提供您的最终答案。无需进行数值评估。您的最终答案必须仅为一个表达式，不附带任何说明性文本。", "solution": "首先根据指定标准对问题进行验证。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n-   问题考虑的是一个泛函$\\varphi(X_T)$的多层蒙特卡洛（MLMC）估计量。\n-   离散化层级由$l \\in \\{0, 1, \\dots, L\\}$索引。\n-   在每个层级$l$，层级差分随机变量为$Y_l$。\n-   在层级$l$的独立同分布样本数量为$N_l$，记为$\\{Y_l^{(i)}\\}_{i=1}^{N_l}$。\n-   单样本方差为$\\operatorname{Var}(Y_{l}^{(1)}) = V_{l}$，其中$V_l$是一个严格正常数。\n-   单样本预期计算功为$C_{l}$，其中$C_l$是一个严格正常数。\n-   待最小化的总预期计算功是目标函数：$\\sum_{l=0}^{L} N_{l} C_{l}$。\n-   总估计量方差由$\\sum_{l=0}^{L} V_{l} / N_{l}$给出。\n-   一个严格的方差预算$\\mathcal{V} > 0$作为等式约束被施加：$\\sum_{l=0}^{L} V_{l} / N_{l} = \\mathcal{V}$。\n-   任务是找到在方差约束下最小化总功的最优抽样分配$\\{N_{l}\\}_{l=0}^{L}$，并求解最优$N_l$表达式中产生的比例常数。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学基础**：该问题设定在随机微分方程的MLMC方法背景下，这是数值分析和计算金融领域一个标准且成熟的课题。总方差和总计算成本的表达式对于跨层级独立抽样的MLMC估计量是经典的。该问题是MLMC方法的一个标准复杂度分析。\n-   **适定性**：该问题是一个经典的约束优化问题。目标函数（总功$\\sum N_l C_l$）和约束函数（与总方差$\\sum V_l/N_l$相关）都有明确的定义。变量$N_l$的定义域是正实数集。这种设置适用于拉格朗日乘数法，并预期会产生一个唯一、稳定且有意义的解。\n-   **客观性**：问题使用精确且无歧义的数学语言陈述，不含任何主观或基于意见的元素。\n-   **完整性与一致性**：问题是自洽的。它提供了要最小化的目标函数、要满足的约束以及所有必要的常数和变量。没有矛盾之处。\n-   该问题不存在验证标准中列出的任何缺陷。\n\n**步骤3：结论与行动**\n问题有效。将推导解答。\n\n### 解答推导\n\n问题是要确定最优样本数$\\{N_l\\}_{l=0}^L$，以在固定的总方差$\\mathcal{V}$约束下，最小化总预期计算功$W$。\n\n要最小化的目标函数是总功：\n$$W(\\{N_l\\}_{l=0}^L) = \\sum_{l=0}^{L} N_l C_l$$\n\n约束条件是总方差必须等于预算$\\mathcal{V}$：\n$$g(\\{N_l\\}_{l=0}^L) = \\sum_{l=0}^{L} \\frac{V_l}{N_l} - \\mathcal{V} = 0$$\n\n我们使用拉格朗日乘数法来解决这个约束优化问题。我们构造拉格朗日函数$\\mathcal{L}$如下：\n$$\\mathcal{L}(\\{N_l\\}_{l=0}^L, \\lambda) = W - \\lambda g = \\sum_{l=0}^{L} N_l C_l - \\lambda \\left( \\sum_{l=0}^{L} \\frac{V_l}{N_l} - \\mathcal{V} \\right)$$\n其中$\\lambda$是拉格朗日乘数。对于最优分配，拉格朗日函数相对于变量$\\{N_l\\}$的梯度必须为零。我们对任意层级$k \\in \\{0, 1, \\dots, L\\}$，求$\\mathcal{L}$关于$N_k$的偏导数并令其为零：\n$$\\frac{\\partial \\mathcal{L}}{\\partial N_k} = \\frac{\\partial}{\\partial N_k} \\left( N_k C_k \\right) - \\lambda \\frac{\\partial}{\\partial N_k} \\left( \\frac{V_k}{N_k} \\right) = 0$$\n$$\\frac{\\partial \\mathcal{L}}{\\partial N_k} = C_k - \\lambda \\left( -\\frac{V_k}{N_k^2} \\right) = C_k + \\frac{\\lambda V_k}{N_k^2} = 0$$\n\n求解$N_k^2$：\n$$C_k N_k^2 = -\\lambda V_k$$\n$$N_k^2 = -\\lambda \\frac{V_k}{C_k}$$\n由于$N_k$、$V_k$和$C_k$都是严格正常数，因此必须有$\\lambda < 0$。我们定义一个正常数$K^2 = -\\lambda$。于是方程变为：\n$$N_k^2 = K^2 \\frac{V_k}{C_k}$$\n由于$N_k$必须为正，我们取正平方根：\n$$N_k = K \\sqrt{\\frac{V_k}{C_k}}$$\n这个方程表明，最优样本数$N_k$与因子$\\sqrt{V_k/C_k}$成正比，该因子取决于层级$k$。比例常数是$K$。问题要求给出该常数的显式表达式。\n\n为了求出$K$，我们将$N_k$的表达式代入方差约束方程中：\n$$\\sum_{k=0}^{L} \\frac{V_k}{N_k} = \\mathcal{V}$$\n$$\\sum_{k=0}^{L} \\frac{V_k}{K \\sqrt{\\frac{V_k}{C_k}}} = \\mathcal{V}$$\n我们可以简化求和内的项：\n$$\\frac{V_k}{\\sqrt{\\frac{V_k}{C_k}}} = \\frac{V_k \\sqrt{C_k}}{\\sqrt{V_k}} = \\sqrt{V_k} \\sqrt{C_k} = \\sqrt{V_k C_k}$$\n将此代回求和式中：\n$$\\sum_{k=0}^{L} \\frac{\\sqrt{V_k C_k}}{K} = \\mathcal{V}$$\n常数$K$可以从求和中提取出来：\n$$\\frac{1}{K} \\sum_{k=0}^{L} \\sqrt{V_k C_k} = \\mathcal{V}$$\n最后，我们求解比例常数$K$：\n$$K = \\frac{1}{\\mathcal{V}} \\sum_{l=0}^{L} \\sqrt{V_l C_l}$$\n注意，为不失一般性，求和中的索引可以写作$l$。这就是比例常数的闭式解析表达式。", "answer": "$$\\boxed{\\frac{1}{\\mathcal{V}} \\sum_{l=0}^{L} \\sqrt{V_{l} C_{l}}}$$", "id": "3005294"}]}