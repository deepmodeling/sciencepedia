{
    "hands_on_practices": [
        {
            "introduction": "计划对比最强大的用途之一，是带着一定的置信水平来估计组间均值特定差异的大小。这项练习将指导你在一个临床试验场景中，为一个对比计算置信区间，这是解读实验结果的一项基本技能 。通过这个过程，你将学习如何将抽象的统计量转化为对科学问题有意义的结论。",
            "id": "4937539",
            "problem": "一项单因素设计被用于比较四种膳食钠干预对8周后收缩压（单位：毫米汞柱, $\\mathrm{mm\\,Hg}$）变化的影响。设四个组分别标记为 $A$、$B$、$C$ 和 $D$。假设采用标准的单因素方差分析（ANOVA）模型，其中各组的结果是独立且服从正态分布的，各组间的误差方差相同，并且各组的样本量相等。具体来说，假设每组有 $n_i = 16$ 名参与者，变化量的样本均值分别为 $\\bar{Y}_A = -5$、$\\bar{Y}_B = -3$、$\\bar{Y}_C = -9$ 和 $\\bar{Y}_D = -10$（负值表示降低），并且ANOVA分析得出的残差均方（均方误差）为 $\\mathrm{MSE} = 36$。\n\n一个预先设定的计划比较旨在比较两个低钠组（$C$ 和 $D$）的平均值与两个中等钠组（$A$ 和 $B$）的平均值。定义对比\n$$\nL \\;=\\; \\frac{1}{2}\\mu_C + \\frac{1}{2}\\mu_D \\;-\\; \\frac{1}{2}\\mu_A \\;-\\; \\frac{1}{2}\\mu_B,\n$$\n及其对应的估计量\n$$\n\\hat{L} \\;=\\; \\frac{1}{2}\\bar{Y}_C + \\frac{1}{2}\\bar{Y}_D \\;-\\; \\frac{1}{2}\\bar{Y}_A \\;-\\; \\frac{1}{2}\\bar{Y}_B.\n$$\n\n假设在95%置信水平下，自由度为 $\\mathrm{df} = 60$ 的t临界值为 $t_{0.975,60} = 2.000$。\n\n利用ANOVA的假设和上述计划对比，构建 $L$ 的95%置信区间，并结合计划比较的背景简要解释该区间。然后，报告误差范围（置信区间的半宽度），四舍五入到四位有效数字。区间的端点和误差范围以 $\\mathrm{mm\\,Hg}$ 为单位表示。",
            "solution": "计算计划对比 $L$ 的95%置信区间的通用形式为：\n$$ \\hat{L} \\pm t_{1-\\alpha/2, N-k} \\times \\mathrm{SE}(\\hat{L}) $$\n其中 $\\hat{L}$ 是对比的点估计，$t_{1-\\alpha/2, N-k}$ 是t分布的临界值，$\\mathrm{SE}(\\hat{L})$ 是估计的标准误。\n\n首先，我们计算点估计 $\\hat{L}$。对比的系数为 $c_A = -1/2$、$c_B = -1/2$、$c_C = 1/2$ 和 $c_D = 1/2$。\n$$ \\hat{L} = c_A \\bar{Y}_A + c_B \\bar{Y}_B + c_C \\bar{Y}_C + c_D \\bar{Y}_D $$\n代入给定的样本均值：\n$$ \\hat{L} = \\left(-\\frac{1}{2}\\right)(-5) + \\left(-\\frac{1}{2}\\right)(-3) + \\left(\\frac{1}{2}\\right)(-9) + \\left(\\frac{1}{2}\\right)(-10) $$\n$$ \\hat{L} = 2.5 + 1.5 - 4.5 - 5.0 $$\n$$ \\hat{L} = 4.0 - 9.5 = -5.5 $$\n\n接下来，我们计算估计量 $\\hat{L}$ 的标准误，即 $\\mathrm{SE}(\\hat{L})$。标准误的公式是：\n$$ \\mathrm{SE}(\\hat{L}) = \\sqrt{\\mathrm{MSE} \\sum_{i=1}^{k} \\frac{c_i^2}{n_i}} $$\n各组的样本量相等，$n_i = 16$。我们首先计算系数的平方除以其各自样本量后的总和：\n$$ \\sum_{i=1}^{k} \\frac{c_i^2}{n_i} = \\frac{(-1/2)^2}{16} + \\frac{(-1/2)^2}{16} + \\frac{(1/2)^2}{16} + \\frac{(1/2)^2}{16} $$\n$$ \\sum_{i=1}^{k} \\frac{c_i^2}{n_i} = 4 \\times \\frac{1/4}{16} = \\frac{1}{16} $$\n现在我们可以使用给定的 $\\mathrm{MSE} = 36$ 来计算标准误：\n$$ \\mathrm{SE}(\\hat{L}) = \\sqrt{36 \\times \\frac{1}{16}} = \\sqrt{\\frac{36}{16}} = \\frac{\\sqrt{36}}{\\sqrt{16}} = \\frac{6}{4} = 1.5 $$\n\n误差范围（ME）是置信区间的半宽度。它由t临界值与标准误的乘积计算得出。\n$$ \\mathrm{ME} = t_{0.975,60} \\times \\mathrm{SE}(\\hat{L}) $$\n使用给定的临界值 $t_{0.975,60} = 2.000$：\n$$ \\mathrm{ME} = 2.000 \\times 1.5 = 3.0 $$\n题目要求将此值四舍五入到四位有效数字，即 $3.000$。\n\n现在我们构建 $L$ 的95%置信区间：\n$$ \\text{CI for } L = \\hat{L} \\pm \\mathrm{ME} $$\n$$ \\text{CI for } L = -5.5 \\pm 3.0 $$\n区间的下限是 $-5.5 - 3.0 = -8.5$。\n区间的上限是 $-5.5 + 3.0 = -2.5$。\n因此，$L$ 的95%置信区间为 $[-8.5, -2.5] \\, \\mathrm{mm\\,Hg}$。\n\n**区间解释**：对比 $L = \\frac{1}{2}(\\mu_C + \\mu_D) - \\frac{1}{2}(\\mu_A + \\mu_B)$ 代表了低钠组（$C$ 和 $D$）的平均血压降低值与中等钠组（$A$ 和 $B$）的平均降低值之间的真实差异。该差异的95%置信区间为 $[-8.5, -2.5] \\, \\mathrm{mm\\,Hg}$。由于整个区间为负且不包含0，我们有95%的置信度认为，低钠组的平均血压降低值显著大于中等钠组的平均降低值。具体来说，我们有95%的置信度认为，与中等钠组相比，低钠组的收缩压额外平均降低值在 $2.5 \\, \\mathrm{mm\\,Hg}$ 到 $8.5 \\, \\mathrm{mm\\,Hg}$ 之间。\n问题要求报告误差范围，并四舍五入到四位有效数字。计算出的误差范围是 $3.0$，表示为四位有效数字即为 $3.000$。",
            "answer": "$$\\boxed{3.000}$$"
        },
        {
            "introduction": "真实世界的研究常常会遇到各组别参与者数量不等的情况，即非均衡设计。这项练习探讨了这种不均衡性带来的关键影响，它迫使研究者在不同的科学问题（例如，是关心“组平均”效应还是“受试者平均”效应）之间做出选择 。通过分析其中的偏差、效率和正交性权衡，本练习将提升你对一个对比真正估计的是什么的批判性思考能力。",
            "id": "4937599",
            "problem": "一项生物统计学研究使用单因素方差分析 (ANOVA) 来比较 $g=4$ 个处理组，这些处理组具有独立的观测值和共同的组内方差 $\\sigma^2$。设各组均值为 $\\mu_1,\\mu_2,\\mu_3,\\mu_4$，样本量分别为 $n_1=20$，$n_2=40$，$n_3=25$，$n_4=15$。研究者计划在复合的“低剂量”处理（第 $1$ 组和第 $2$ 组）和复合的“高剂量”处理（第 $3$ 组和第 $4$ 组）之间进行比较。他们考虑了两种科学上合理的待估量及其对应的计划对比：\n\n- 组平均待估量，定义为\n$$\\psi_G=\\frac{1}{2}\\left(\\mu_1+\\mu_2\\right)-\\frac{1}{2}\\left(\\mu_3+\\mu_4\\right),$$\n其对应的等权重对比估计量为\n$$\\hat{\\psi}_G=\\frac{1}{2}\\left(\\bar{Y}_1+\\bar{Y}_2\\right)-\\frac{1}{2}\\left(\\bar{Y}_3+\\bar{Y}_4\\right),$$\n其中 $\\bar{Y}_i$ 是第 $i$ 组的样本均值。\n\n- 患者平均待估量，定义为\n$$\\psi_P=\\frac{n_1}{n_1+n_2}\\mu_1+\\frac{n_2}{n_1+n_2}\\mu_2-\\frac{n_3}{n_3+n_4}\\mu_3-\\frac{n_4}{n_3+n_4}\\mu_4,$$\n其对应的样本量加权对比估计量为\n$$\\hat{\\psi}_P=\\frac{n_1}{n_1+n_2}\\bar{Y}_1+\\frac{n_2}{n_1+n_2}\\bar{Y}_2-\\frac{n_3}{n_3+n_4}\\bar{Y}_3-\\frac{n_4}{n_3+n_4}\\bar{Y}_4.$$\n\n研究者还希望在低剂量组内进行第二次计划比较，由对比系数 $d=(1,-1,0,0)$ 定义，即：\n$$\\hat{\\phi}=\\bar{Y}_1-\\bar{Y}_2.$$\n他们想知道，在给定的非均衡样本量下，这第二次比较是否与低剂量对高剂量的比较正交。\n\n使用线性对比、无偏性、独立性与共同方差下的方差以及非均衡设计中对比的正交性的基本定义，检验在这种非均衡设计中使用等权重对比时的偏倚和效率权衡。然后，从以下选项中选择最佳陈述，以说明何时这种等权重简化是可接受的。\n\nA. 等权重对比估计量 $\\hat{\\psi}_G$ 对于组平均待估量 $\\psi_G$ 是无偏的，但当 $n_1\\neq n_2$ 或 $n_3\\neq n_4$ 时，对于患者平均待估量 $\\psi_P$ 通常是有偏的。在给定的 $n_i$ 下，其方差超过样本量加权估计量 $\\hat{\\psi}_P$ 的方差，并且在这种非均衡设计中，低剂量对高剂量的等权重对比与 $d=(1,-1,0,0)$ 不正交。当科学目标是 $\\psi_G$（组平均）并且承认轻微的效率损失和非正交性时，等权重简化是可接受的。\n\nB. $\\hat{\\psi}_G$ 和 $\\hat{\\psi}_P$ 对于 $\\psi_G$ 和 $\\psi_P$ 都是无偏的，在任何非均衡设计中，等权重对比都比样本量加权的对比更有效，并且计划对比的正交性不受不等的 $n_i$ 影响。\n\nC. 每当设计非均衡时，等权重对比估计量 $\\hat{\\psi}_G$ 对 $\\psi_G$ 就会产生偏倚，而 $\\hat{\\psi}_P$ 对 $\\psi_G$ 和 $\\psi_P$ 均保持无偏。在非均衡设计中，等权重是绝不可接受的。\n\nD. 等权重对比估计量 $\\hat{\\psi}_G$ 对患者平均待估量 $\\psi_P$ 是无偏的，而样本量加权估计量 $\\hat{\\psi}_P$ 对组平均待估量 $\\psi_G$ 是无偏的。无论 $n_i$ 如何，等权重对比总是与组内差异（如 $d=(1,-1,0,0)$）正交。\n\nE. 等权重对比仅在方差不等的情况下才可接受，因为效率和正交性问题完全由异方差性引起，而非样本量不等。",
            "solution": "### 分析\n\n线性对比估计量是各组样本均值的线性组合，$\\hat{\\psi} = \\sum_{i=1}^{g} c_i \\bar{Y}_i$，其中系数之和为零，$\\sum c_i = 0$。它所估计的总体量是 $\\psi = \\sum_{i=1}^{g} c_i \\mu_i$。\n\n**1. 偏倚分析**\n对比估计量的期望值为 $E[\\hat{\\psi}] = E\\left[\\sum c_i \\bar{Y}_i\\right] = \\sum c_i E[\\bar{Y}_i] = \\sum c_i \\mu_i$。如果 $E[\\hat{\\psi}] = \\psi^*$，则估计量 $\\hat{\\psi}$ 对于待估量 $\\psi^*$ 是无偏的。\n\n- **对 $\\hat{\\psi}_G$ 的分析**：\n  $\\hat{\\psi}_G$ 的系数是 $c_G = (\\frac{1}{2}, \\frac{1}{2}, -\\frac{1}{2}, -\\frac{1}{2})$。\n  其期望值为 $E[\\hat{\\psi}_G] = \\frac{1}{2}\\mu_1 + \\frac{1}{2}\\mu_2 - \\frac{1}{2}\\mu_3 - \\frac{1}{2}\\mu_4 = \\psi_G$。\n  因此，$\\hat{\\psi}_G$ 是组平均待估量 $\\psi_G$ 的一个**无偏**估计量。\n  然而，因为 $n_1 \\neq n_2$ 和 $n_3 \\neq n_4$，所以 $\\psi_G \\neq \\psi_P$。因此，$\\hat{\\psi}_G$ 是患者平均待估量 $\\psi_P$ 的一个**有偏**估计量。\n\n- **对 $\\hat{\\psi}_P$ 的分析**：\n  $\\hat{\\psi}_P$ 的系数是 $c_P = (\\frac{n_1}{n_1+n_2}, \\frac{n_2}{n_1+n_2}, -\\frac{n_3}{n_3+n_4}, -\\frac{n_4}{n_3+n_4})$。\n  其期望值为 $E[\\hat{\\psi}_P] = \\frac{n_1}{n_1+n_2}\\mu_1 + \\frac{n_2}{n_1+n_2}\\mu_2 - \\frac{n_3}{n_3+n_4}\\mu_3 - \\frac{n_4}{n_3+n_4}\\mu_4 = \\psi_P$。\n  因此，$\\hat{\\psi}_P$ 是患者平均待估量 $\\psi_P$ 的一个**无偏**估计量。由于 $\\psi_P \\neq \\psi_G$，$\\hat{\\psi}_P$ 是组平均待估量 $\\psi_G$ 的一个**有偏**估计量。\n\n**2. 效率（方差）分析**\n对比估计量 $\\hat{\\psi} = \\sum c_i \\bar{Y}_i$ 的方差由 $\\text{Var}(\\hat{\\psi}) = \\sigma^2 \\sum_{i=1}^{g} \\frac{c_i^2}{n_i}$ 给出。\n- **$\\hat{\\psi}_G$ 的方差**：$\\text{Var}(\\hat{\\psi}_G) = \\frac{\\sigma^2}{4} \\left( \\frac{1}{20} + \\frac{1}{40} + \\frac{1}{25} + \\frac{1}{15} \\right) \\approx 0.0454 \\sigma^2$。\n- **$\\hat{\\psi}_P$ 的方差**：系数为 $c_P = (\\frac{1}{3}, \\frac{2}{3}, -\\frac{5}{8}, -\\frac{3}{8})$。\n$\\text{Var}(\\hat{\\psi}_P) = \\sigma^2 \\left[ \\frac{(1/3)^2}{20} + \\frac{(2/3)^2}{40} + \\frac{(-5/8)^2}{25} + \\frac{(-3/8)^2}{15} \\right] = \\sigma^2 \\left( \\frac{1}{60} + \\frac{1}{40} \\right) = \\frac{\\sigma^2}{24} \\approx 0.0417 \\sigma^2$。\n数值上，$\\text{Var}(\\hat{\\psi}_G) > \\text{Var}(\\hat{\\psi}_P)$。\n\n**3. 正交性分析**\n在非均衡设计中，两个系数向量为 $c$ 和 $d$ 的对比是正交的，当且仅当 $\\sum_{i=1}^{g} \\frac{c_i d_i}{n_i} = 0$。\n我们检验等权重对比 $c_G = (\\frac{1}{2}, \\frac{1}{2}, -\\frac{1}{2}, -\\frac{1}{2})$ 和组内对比 $d = (1, -1, 0, 0)$ 的正交性。\n$\\sum_{i=1}^{4} \\frac{c_{G,i} d_i}{n_i} = \\frac{(\\frac{1}{2})(1)}{20} + \\frac{(\\frac{1}{2})(-1)}{40} + 0 + 0 = \\frac{1}{40} - \\frac{1}{80} = \\frac{1}{80}$。\n由于结果不为零，对比 $\\hat{\\psi}_G$ 与对比 $\\hat{\\phi}$ **不正交**。\n\n### 选项分析\n\n**A. 等权重对比估计量 $\\hat{\\psi}_G$ 对于组平均待估量 $\\psi_G$ 是无偏的，但当 $n_1\\neq n_2$ 或 $n_3\\neq n_4$ 时，对于患者平均待估量 $\\psi_P$ 通常是有偏的。在给定的 $n_i$ 下，其方差超过样本量加权估计量 $\\hat{\\psi}_P$ 的方差，并且在这种非均衡设计中，低剂量对高剂量的等权重对比与 $d=(1,-1,0,0)$ 不正交。当科学目标是 $\\psi_G$（组平均）并且承认轻微的效率损失和非正交性时，等权重简化是可接受的。**\n- **结论：正确。** 该陈述准确地总结了上述分析的所有发现：偏倚关系正确，方差比较正确，非正交性正确，且理由合理。\n\n**B. $\\hat{\\psi}_G$ 和 $\\hat{\\psi}_P$ 对于 $\\psi_G$ 和 $\\psi_P$ 都是无偏的，在任何非均衡设计中，等权重对比都比样本量加权的对比更有效，并且计划对比的正交性不受不等的 $n_i$ 影响。**\n- **结论：不正确。** 该陈述的每个部分都是错误的。\n\n**C. 每当设计非均衡时，等权重对比估计量 $\\hat{\\psi}_G$ 对 $\\psi_G$ 就会产生偏倚，而 $\\hat{\\psi}_P$ 对 $\\psi_G$ 和 $\\psi_P$ 均保持无偏。在非均衡设计中，等权重是绝不可接受的。**\n- **结论：不正确。** $\\hat{\\psi}_G$ 对 $\\psi_G$ 始终是无偏的。“绝不可接受”的说法过于绝对。\n\n**D. 等权重对比估计量 $\\hat{\\psi}_G$ 对患者平均待估量 $\\psi_P$ 是无偏的，而样本量加权估计量 $\\hat{\\psi}_P$ 对组平均待估量 $\\psi_G$ 是无偏的。无论 $n_i$ 如何，等权重对比总是与组内差异（如 $d=(1,-1,0,0)$）正交。**\n- **结论：不正确。** 该陈述颠倒了偏倚关系，并且关于正交性的说法是错误的。\n\n**E. 等权重对比仅在方差不等的情况下才可接受，因为效率和正交性问题完全由异方差性引起，而非样本量不等。**\n- **结论：不正确。** 问题中的所有效应都是由样本量不等引起的，而非方差不等。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "经典的对比检验（如基于合并方差的$t$检验）依赖于各组方差相等的假设，即方差同质性。当这个假设被违背时会发生什么？这项练习引入了一种强大的计算方法——蒙特卡洛模拟——来研究这一问题 。通过亲手模拟数据，你将能直接观察不同检验方法（如合并方差$t$检验与Welch $t$检验）在方差异质性下的表现，从而理解稳健方法的重要性。",
            "id": "4937595",
            "problem": "给定一个包含$g$个处理组的单向分组设计。令$Y_{ij}$表示第$i$组中第$j$个受试者的观测响应，其中$i \\in \\{1,\\dots,g\\}$，$j \\in \\{1,\\dots,n_i\\}$。考虑线性模型$Y_{ij} = \\mu_i + \\varepsilon_{ij}$，其中$\\mu_i$是特定于组的均值，$\\varepsilon_{ij}$是满足$E[\\varepsilon_{ij}] = 0$的独立误差。在经典方差分析中，方差齐性假设规定，对于所有的$i,j$，$\\operatorname{Var}(\\varepsilon_{ij}) = \\sigma^2$。在实践中，该假设可能被违反，此时方差异质性被建模为$\\operatorname{Var}(\\varepsilon_{ij}) = \\sigma_i^2$，该方差可能因组而异。\n\n一个计划对比由一个系数向量$\\mathbf{c} = (c_1,\\dots,c_g)$定义，该向量满足$\\sum_{i=1}^g c_i = 0$。计划对比的原假设为$H_0: \\sum_{i=1}^g c_i \\mu_i = 0$。当设计是平衡的时，两个对比$\\mathbf{c}$和$\\mathbf{d}$的正交性定义为$\\sum_{i=1}^g c_i d_i = 0$；当设计是非平衡的时，定义为$\\sum_{i=1}^g \\frac{c_i d_i}{n_i} = 0$。\n\n第一类错误是拒绝一个真实的原假设的概率。在方差异质性的条件下，一个假设方差齐性的检验其第一类错误可能会膨胀或紧缩。您的任务是通过两种方法评估计划对比对模型方差设定错误的敏感性：\n- 在原假设下进行蒙特卡洛模拟，使用两种检验程序来估计每个对比的经验第一类错误率：一种是假设方差齐性的合并方差对比t检验，另一种是考虑了异方差性的Welch型对比t检验。\n- 使用方差膨胀因子和切比雪夫不等式，为合并方差对比检验的第一类错误计算解析上界。\n\n您必须实现一个程序，对下面测试套件中的每个测试用例执行以下操作：\n1. 通过为每个组$i$和受试者$j$生成$Y_{ij} \\sim \\mathcal{N}(0,\\sigma_i^2)$，在$H_0$下模拟$S$次独立重复，其中$S$在测试用例中指定。为保证可复现性，请使用给定的随机种子。\n2. 对于每次重复，计算每个组$i$内的样本均值$\\bar{Y}_i$和样本方差$s_i^2$。\n3. 对于每个计划对比$\\mathbf{c}$：\n   - 计算合并方差对比t统计量$T_{\\text{pooled}} = L / \\widehat{\\operatorname{SE}}_{\\text{pooled}}$，其中$L = \\sum_{i=1}^g c_i \\bar{Y}_i$且$\\widehat{\\operatorname{SE}}_{\\text{pooled}} = \\sqrt{s_p^2 \\sum_{i=1}^g c_i^2 / n_i}$，而$s_p^2$是在该次重复中跨所有组计算的组内合并方差。使用自由度$N - g$，其中$N = \\sum_{i=1}^g n_i$，并从学生t分布中获得双侧$p$值。记录在显著性水平$\\alpha$下是否$p  \\alpha$。\n   - 计算Welch型异方差对比t统计量$T_{\\text{Welch}} = L / \\sqrt{\\sum_{i=1}^g c_i^2 s_i^2 / n_i}$，并使用Satterthwaite方法通过匹配各组间的二阶矩来近似其自由度。使用这些近似自由度，从学生t分布中获得双侧$p$值。记录是否$p  \\alpha$。\n   - 在$S$次重复之后，将两种方法的经验第一类错误率估计为在$H_0$下$p  \\alpha$的重复次数所占的比例。\n   - 使用切比雪夫不等式和方差膨胀因子$R$计算合并方差方法的第一类错误的解析上界。$R$定义为在异方差下$L$的真实方差与在合并方差齐性假设下基于模型的方差（使用期望的合并方差作为代理）之比。使用学生t分布在水平$\\alpha/2$和$N-g$自由度下的双侧临界值，形成上界$P(|T_{\\text{pooled}}| \\ge t_{\\text{crit}}) \\le \\min\\{1, R / t_{\\text{crit}}^2\\}$。\n\n使用以下测试套件。每个测试用例指定$(g, \\mathbf{n}, \\boldsymbol{\\sigma}, \\mathcal{C}, \\alpha, S, \\text{seed})$，其中$g$是组数，$\\mathbf{n}$是各组样本大小的列表，$\\boldsymbol{\\sigma}$是各组标准差的列表，$\\mathcal{C}$是计划对比的列表，$\\alpha$是显著性水平，$S$是模拟重复次数，$\\text{seed}$是随机种子。对于所有列表，请确保其维度等于$g$。\n\n- 用例1（平衡设计，方差齐性，正交对比）：$g = 4$, $\\mathbf{n} = [\\,20,\\,20,\\,20,\\,20\\,]$, $\\boldsymbol{\\sigma} = [\\,1,\\,1,\\,1,\\,1\\,]$, $\\mathcal{C} = \\left\\{\\,[\\,1,\\,-1,\\,0,\\,0\\,],\\;[\\,0,\\,0,\\,1,\\,-1\\,],\\;[\\,\\tfrac{1}{2},\\,\\tfrac{1}{2},\\,-\\tfrac{1}{2},\\,-\\tfrac{1}{2}\\,]\\,\\right\\}$, $\\alpha = 0.05$, $S = 20000$, $\\text{seed} = 12345$。\n- 用例2（平衡设计，轻度异方差性）：$g = 4$, $\\mathbf{n} = [\\,20,\\,20,\\,20,\\,20\\,]$, $\\boldsymbol{\\sigma} = [\\,1,\\,1.5,\\,1,\\,2\\,]$, $\\mathcal{C} = \\left\\{\\,[\\,1,\\,-1,\\,0,\\,0\\,],\\;[\\,0,\\,0,\\,1,\\,-1\\,],\\;[\\,\\tfrac{1}{2},\\,\\tfrac{1}{2},\\,-\\tfrac{1}{2},\\,-\\tfrac{1}{2}\\,]\\,\\right\\}$, $\\alpha = 0.05$, $S = 20000$, $\\text{seed} = 12345$。\n- 用例3（非平衡设计，中度异方差性）：$g = 4$, $\\mathbf{n} = [\\,10,\\,30,\\,10,\\,30\\,]$, $\\boldsymbol{\\sigma} = [\\,1,\\,2,\\,1,\\,2\\,]$, $\\mathcal{C} = \\left\\{\\,[\\,1,\\,-1,\\,0,\\,0\\,],\\;[\\,0,\\,0,\\,1,\\,-1\\,],\\;[\\,\\tfrac{1}{2},\\,\\tfrac{1}{2},\\,-\\tfrac{1}{2},\\,-\\tfrac{1}{2}\\,]\\,\\right\\}$, $\\alpha = 0.05$, $S = 20000$, $\\text{seed} = 12345$。\n- 用例4（非平衡设计，极端异方差性）：$g = 4$, $\\mathbf{n} = [\\,5,\\,50,\\,5,\\,50\\,]$, $\\boldsymbol{\\sigma} = [\\,0.5,\\,3,\\,0.5,\\,3\\,]$, $\\mathcal{C} = \\left\\{\\,[\\,1,\\,-1,\\,0,\\,0\\,],\\;[\\,0,\\,0,\\,1,\\,-1\\,],\\;[\\,\\tfrac{1}{2},\\,\\tfrac{1}{2},\\,-\\tfrac{1}{2},\\,-\\tfrac{1}{2}\\,]\\,\\right\\}$, $\\alpha = 0.05$, $S = 20000$, $\\text{seed} = 12345$。\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。每个项目对应一个测试用例，其本身是每个对比的三元组$[\\,\\text{pooled},\\,\\text{Welch},\\,\\text{bound}\\,]$的逗号分隔列表，顺序与$\\mathcal{C}$中的顺序相同。例如，输出格式为 $[\\,[\\,[x_{11},x_{12},x_{13}],\\,[x_{21},x_{22},x_{23}],\\,[x_{31},x_{32},x_{33}]\\,],\\,[\\,[\\dots],\\,[\\dots],\\,[\\dots]\\,],\\,[\\dots],\\,[\\dots]\\,]$, 其中每个$x_{ab}$是打印为小数的实数。本任务不涉及单位。请确保最终打印的行不包含任何空格。",
            "solution": "所提供的问题是生物统计学中一个有效且定义明确的练习，具体涉及在单向方差分析（ANOVA）设计中，当方差齐性假设被违反时，计划对比的性能。所有提供的定义、公式和参数在科学上都是合理的、一致的，并且是该领域的标准。任务是通过蒙特卡洛模拟评估经典合并方差t检验和对异方差性稳健的Welch型t检验在计划对比中的第一类错误率，并使用切比雪夫不等式计算合并检验第一类错误的解析上界。\n\n该解决方案将通过创建一个Python程序来实现，该程序会遍历每个指定的测试用例。对于每个用例，程序将执行以下步骤：\n\n1.  **参数设置**：提取每个测试用例的参数——组数$g$、各组样本量$\\mathbf{n} = (n_1, \\dots, n_g)$、各组标准差$\\boldsymbol{\\sigma} = (\\sigma_1, \\dots, \\sigma_g)$、计划对比$\\mathcal{C}$、显著性水平$\\alpha$、模拟次数$S$和随机种子。组方差计算为$\\sigma_i^2$。\n\n2.  **蒙特卡洛模拟**：为估计经验第一类错误率，我们在原假设$H_0: \\sum_{i=1}^g c_i \\mu_i = 0$下模拟$S$个数据集。确保$H_0$对任何对比都成立的最简单方法是设置所有组均值$\\mu_i=0$。\n    - 为保证可复现性，使用一个现代的随机数生成器并设定种子。\n    - 对于$S$次重复中的每一次，我们通过从正态分布$\\mathcal{N}(0, \\sigma_i^2)$中抽取$n_i$个样本来为每个组$i$生成数据。通过同时为所有重复和组生成一个随机样本矩阵，该过程被向量化以提高计算效率。\n    - 从模拟数据中，我们计算$S$次重复中每次重复内每个组的样本均值$\\bar{Y}_i$和样本方差$s_i^2$。\n\n3.  **统计检验**：对于每次重复和每个计划对比向量$\\mathbf{c} = (c_1, \\dots, c_g)$，我们执行两种类型的t检验。\n    - 样本均值的线性组合计算为$L = \\sum_{i=1}^g c_i \\bar{Y}_i$。\n\n    - **合并方差t检验**：此检验假设方差齐性（$\\sigma_1^2 = \\dots = \\sigma_g^2 = \\sigma^2$）。\n        - 合并方差$s_p^2$用于估计共同方差$\\sigma^2$，为每次重复计算：\n          $$s_p^2 = \\frac{\\sum_{i=1}^g (n_i - 1) s_i^2}{\\sum_{i=1}^g (n_i - 1)} = \\frac{\\sum_{i=1}^g (n_i - 1) s_i^2}{N - g}$$\n          其中$N = \\sum_{i=1}^g n_i$是总样本量。\n        - $L$的标准误估计为$\\widehat{\\operatorname{SE}}_{\\text{pooled}} = \\sqrt{s_p^2 \\sum_{i=1}^g \\frac{c_i^2}{n_i}}$。\n        - 检验统计量为$T_{\\text{pooled}} = L / \\widehat{\\operatorname{SE}}_{\\text{pooled}}$。\n        - 双侧$p$值从具有$N - g$自由度的学生t分布中获得。\n\n    - **Welch型t检验**：此检验不假设方差齐性。\n        - $L$的标准误估计为$\\widehat{\\operatorname{SE}}_{\\text{Welch}} = \\sqrt{\\sum_{i=1}^g \\frac{c_i^2 s_i^2}{n_i}}$。\n        - 检验统计量为$T_{\\text{Welch}} = L / \\widehat{\\operatorname{SE}}_{\\text{Welch}}$。\n        - 自由度使用Satterthwaite公式对样本均值的线性组合进行近似：\n          $$ \\text{df}_{\\text{Welch}} = \\frac{\\left(\\sum_{i=1}^g \\frac{c_i^2 s_i^2}{n_i}\\right)^2}{\\sum_{i=1}^g \\frac{\\left(\\frac{c_i^2 s_i^2}{n_i}\\right)^2}{n_i - 1}} $$\n        - 双侧$p$值从具有$\\text{df}_{\\text{Welch}}$自由度的学生t分布中获得。通过处理潜在的除零情况来确保数值稳健性，尽管使用给定数据时这不太可能发生。\n\n4.  **经验第一类错误**：对于每个对比和每种检验方法，经验第一类错误率计算为在指定的显著性水平$\\alpha = 0.05$下，计算出的$p$值小于$\\alpha$的重复次数所占的比例。\n\n5.  **解析上界**：为每个对比计算合并方差检验的第一类错误的解析上界。\n    - 首先，我们从学生t分布中确定临界值$t_{\\text{crit}}$，使得对于一个具有$N-g$自由度的t变量$T$，$P(|T| > t_{\\text{crit}}) = \\alpha$。这对应于$1 - \\alpha/2$分位数。\n    - 接下来，我们计算方差膨胀因子$R$。这是在异方差下$L$的真实方差与其在错误设定的方差齐性模型下估计方差的期望值之比。\n      - $L$的真实方差是$\\operatorname{Var}_{\\text{true}}(L) = \\operatorname{Var}\\left(\\sum_{i=1}^g c_i \\bar{Y}_i\\right) = \\sum_{i=1}^g c_i^2 \\frac{\\sigma_i^2}{n_i}$。\n      - 合并方差估计量的期望值是$E[s_p^2] = \\frac{\\sum_{i=1}^g (n_i - 1) \\sigma_i^2}{N - g}$。\n      - $L$的基于模型的期望方差是$E[\\widehat{\\operatorname{Var}}_{\\text{model}}(L)] = E[s_p^2] \\sum_{i=1}^g \\frac{c_i^2}{n_i}$。\n      - 因此，方差膨胀因子为$R = \\operatorname{Var}_{\\text{true}}(L) / E[\\widehat{\\operatorname{Var}}_{\\text{model}}(L)]$。\n    - 于是，上界由切比雪夫不等式给出，近似为$P(|T_{\\text{pooled}}| \\ge t_{\\text{crit}}) \\le \\min(1, R / t_{\\text{crit}}^2)$。\n\n6.  **输出格式化**：每个测试用例的结果——包含每个对比的三元组（经验合并第一类错误、经验Welch第一类错误、解析上界）的列表——被收集起来。然后，根据问题规范，将它们格式化为不含空格的单个连续嵌套列表字符串，最后打印出来。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import t\nimport json\n\ndef solve():\n    \"\"\"\n    Solves the biostatistics problem by performing Monte Carlo simulations and\n    analytical calculations for planned contrasts under different variance structures.\n    \"\"\"\n    test_cases = [\n        (4, [20, 20, 20, 20], [1.0, 1.0, 1.0, 1.0], [[1, -1, 0, 0], [0, 0, 1, -1], [0.5, 0.5, -0.5, -0.5]], 0.05, 20000, 12345),\n        (4, [20, 20, 20, 20], [1.0, 1.5, 1.0, 2.0], [[1, -1, 0, 0], [0, 0, 1, -1], [0.5, 0.5, -0.5, -0.5]], 0.05, 20000, 12345),\n        (4, [10, 30, 10, 30], [1.0, 2.0, 1.0, 2.0], [[1, -1, 0, 0], [0, 0, 1, -1], [0.5, 0.5, -0.5, -0.5]], 0.05, 20000, 12345),\n        (4, [5, 50, 5, 50], [0.5, 3.0, 0.5, 3.0], [[1, -1, 0, 0], [0, 0, 1, -1], [0.5, 0.5, -0.5, -0.5]], 0.05, 20000, 12345),\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        g, n_list, sigma_list, C_list, alpha, S, seed = case\n        \n        n = np.array(n_list, dtype=float)\n        sigmas = np.array(sigma_list, dtype=float)\n        contrasts = np.array(C_list, dtype=float)\n        true_variances = sigmas**2\n        \n        N = np.sum(n)\n        df_pooled = N - g\n\n        # --- Monte Carlo Simulation ---\n        rng = np.random.default_rng(seed)\n\n        group_means = np.zeros((S, g))\n        group_vars = np.zeros((S, g))\n\n        for i in range(g):\n            data = rng.normal(loc=0, scale=sigmas[i], size=(S, int(n[i])))\n            group_means[:, i] = np.mean(data, axis=1)\n            group_vars[:, i] = np.var(data, axis=1, ddof=1)\n        \n        sum_of_ss_weighted = np.sum((n - 1) * group_vars, axis=1)\n        s_p_squared = sum_of_ss_weighted / df_pooled\n\n        case_results = []\n        for c_vec in contrasts:\n            # L = sum(c_i * Y_bar_i) for each simulation\n            L = np.sum(c_vec * group_means, axis=1)\n            \n            # --- Pooled t-test ---\n            c_n_term_pooled_sum = np.sum(c_vec**2 / n)\n            se_pooled = np.sqrt(s_p_squared * c_n_term_pooled_sum)\n            t_pooled = np.divide(L, se_pooled, out=np.zeros_like(L), where=se_pooled>1e-12)\n            p_pooled = 2 * t.sf(np.abs(t_pooled), df=df_pooled)\n            type1_pooled = np.sum(p_pooled  alpha) / S\n            \n            # --- Welch-type t-test ---\n            var_welch_terms = (c_vec**2 / n) * group_vars\n            var_welch = np.sum(var_welch_terms, axis=1)\n            se_welch = np.sqrt(var_welch)\n            t_welch = np.divide(L, se_welch, out=np.zeros_like(L), where=se_welch>1e-12)\n\n            # Satterthwaite degrees of freedom\n            num_df_welch = var_welch**2\n            den_df_welch = np.sum(var_welch_terms**2 / (n - 1), axis=1)\n            \n            df_welch = np.ones_like(L)\n            valid_df_idx = den_df_welch > 1e-12\n            df_welch[valid_df_idx] = num_df_welch[valid_df_idx] / den_df_welch[valid_df_idx]\n\n            # Use vectorized p-value calculation\n            p_welch = 2 * t.sf(np.abs(t_welch), df=df_welch)\n            type1_welch = np.sum(p_welch  alpha) / S\n\n            # --- Analytical Upper Bound ---\n            t_crit = t.ppf(1 - alpha / 2, df=df_pooled)\n            \n            # Variance inflation factor R\n            var_true_L = np.sum(c_vec**2 * true_variances / n)\n            expected_sp_sq = np.sum((n - 1) * true_variances) / df_pooled\n            expected_var_L_model = expected_sp_sq * np.sum(c_vec**2 / n)\n            \n            R = np.divide(var_true_L, expected_var_L_model, out=np.zeros_like(var_true_L), where=expected_var_L_model > 1e-12)\n            \n            bound = min(1.0, R / t_crit**2)\n            \n            case_results.append([type1_pooled, type1_welch, bound])\n            \n        all_results.append(case_results)\n\n    # Format the final output string to have no spaces\n    print(json.dumps(all_results, separators=(',', ':')))\n\nsolve()\n```"
        }
    ]
}