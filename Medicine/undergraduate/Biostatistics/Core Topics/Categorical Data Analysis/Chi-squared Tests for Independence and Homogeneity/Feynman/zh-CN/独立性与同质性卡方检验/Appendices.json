{
    "hands_on_practices": [
        {
            "introduction": "皮尔逊卡方检验依赖于大样本下的近似，但当我们的样本量很小时该怎么办？本练习将介绍Fisher精确检验，这是一种无需大样本近似即可提供精确$p$值的方法。通过从组合原理推导该检验 ，您将更深入地理解列联表假设检验的逻辑，并学会何时使用这种强大的替代方法。",
            "id": "4899807",
            "problem": "一项随机生物统计学研究旨在调查抗病毒疗法与血清转换的发生是否独立。该研究将 $n_{T}=10$ 名参与者分配到治疗组，将 $n_{C}=6$ 名参与者分配到安慰剂组，总共有 $N=16$ 名参与者。观测到的 $2 \\times 2$ 表显示，治疗组有 $a_{\\text{obs}}=5$ 例血清转换，安慰剂组有 $b_{\\text{obs}}=2$ 例血清转换，因此观测到的血清转换总数为 $K=a_{\\text{obs}}+b_{\\text{obs}}=7$，未发生血清转换的总数为 $N-K=9$。假设独立性（同质性）的原假设成立，即两个组的血清转换概率 $p$ 相同。\n\n从基本定义出发，以固定的行总计 $n_{T}$ 和 $n_{C}$ 以及固定的列总计 $K$ 和 $N-K$ 为条件。推导在给定边缘总计的情况下，治疗组血清转换数 $A$ 的条件分布，并为所有可行的 $a \\in \\{\\max(0, K-n_{C}), \\ldots, \\min(n_{T}, K)\\}$ 枚举其概率值。利用此枚举，计算双边 Fisher 精确检验（Fisher’s Exact Test, FET）的 $p$ 值，其定义为所有条件概率小于或等于观测表格的条件概率的表格的概率之和，即 $\\sum_{a: \\mathbb{P}(A=a \\mid \\text{margins}) \\le \\mathbb{P}(A=a_{\\text{obs}} \\mid \\text{margins})} \\mathbb{P}(A=a \\mid \\text{margins})$。将最终的 $p$ 值表示为小数，并四舍五入到四位有效数字。",
            "solution": "该问题要求推导治疗组中血清转换数的条件分布，对其进行枚举，并计算双边 $p$ 值。\n\n设 $A$ 为代表治疗组中血清转换数的随机变量，$B$ 为代表安慰剂组中血清转换数的随机变量。各自的样本量为 $n_{T}=10$ 和 $n_{C}=6$，总参与者人数为 $N = n_{T} + n_{C} = 16$。\n\n在同质性原假设 ($H_0$) 下，血清转换的概率（记为 $p$）被假定在两个组中是相同的。因此，每个组的血清转换数服从二项分布，因为每个参与者的结果都是独立的试验。\n$$ A \\sim \\text{Binomial}(n_{T}, p) \\implies \\mathbb{P}(A=a) = \\binom{n_{T}}{a} p^{a} (1-p)^{n_{T}-a} $$\n$$ B \\sim \\text{Binomial}(n_{C}, p) \\implies \\mathbb{P}(B=b) = \\binom{n_{C}}{b} p^{b} (1-p)^{n_{C}-b} $$\n两组是独立的，所以在治疗组观测到 $a$ 个事件和在安慰剂组观测到 $b$ 个事件的联合概率是 $\\mathbb{P}(A=a, B=b) = \\mathbb{P}(A=a)\\mathbb{P}(B=b)$。\n\nFisher 精确检验 (FET) 基于列联表的固定边缘总计条件下 $A$ 的分布。行总计 ($n_{T}=10, n_{C}=6$) 由研究设计固定。对于 FET，我们还需以列总计为条件。观测数据为治疗组有 $a_{\\text{obs}}=5$ 例血清转换，安慰剂组有 $b_{\\text{obs}}=2$ 例，总共有 $K = a_{\\text{obs}} + b_{\\text{obs}} = 5+2=7$ 例血清转换和 $N-K = 16-7=9$ 例未血清转换。\n\n我们推导条件概率 $\\mathbb{P}(A=a \\mid A+B=K)$。根据条件概率的定义：\n$$ \\mathbb{P}(A=a \\mid A+B=K) = \\frac{\\mathbb{P}(A=a \\text{ and } A+B=K)}{\\mathbb{P}(A+B=K)} $$\n分子中的事件等价于 $\\{A=a \\text{ and } B=K-a\\}$。由于独立性，其概率为：\n$$ \\mathbb{P}(A=a, B=K-a) = \\mathbb{P}(A=a)\\mathbb{P}(B=K-a) = \\left[ \\binom{n_{T}}{a}p^{a}(1-p)^{n_{T}-a} \\right] \\left[ \\binom{n_{C}}{K-a}p^{K-a}(1-p)^{n_{C}-(K-a)} \\right] $$\n$$ = \\binom{n_{T}}{a}\\binom{n_{C}}{K-a} p^{a+K-a} (1-p)^{n_{T}-a+n_{C}-K+a} = \\binom{n_{T}}{a}\\binom{n_{C}}{K-a} p^{K} (1-p)^{N-K} $$\n代表成功总数的随机变量 $A+B$ 服从二项分布 $\\text{Binomial}(N, p)$，所以条件事件的概率是：\n$$ \\mathbb{P}(A+B=K) = \\binom{N}{K} p^{K} (1-p)^{N-K} $$\n将这些代入条件概率公式，得到：\n$$ \\mathbb{P}(A=a \\mid A+B=K) = \\frac{\\binom{n_{T}}{a}\\binom{n_{C}}{K-a} p^{K} (1-p)^{N-K}}{\\binom{N}{K} p^{K} (1-p)^{N-K}} = \\frac{\\binom{n_{T}}{a}\\binom{n_{C}}{K-a}}{\\binom{N}{K}} $$\n这是超几何分布的概率质量函数。未知参数 $p$ 已被消去，这是允许进行“精确”检验的关键特性。\n\n接下来，我们使用给定数据 $n_{T}=10$, $n_{C}=6$, $N=16$ 和 $K=7$ 来枚举所有可行的 $a$ 值的概率。$a$ 的可能值由二项式系数的约束条件决定，这些约束要求所有参数都为非负数：\n$a \\ge 0$, $n_{T}-a \\ge 0 \\implies a \\le n_{T}=10$。\n$K-a \\ge 0 \\implies a \\le K=7$。\n$n_{C}-(K-a) \\ge 0 \\implies a \\ge K-n_{C} = 7-6=1$。\n因此，$a$ 的支撑集为 $\\{1, 2, 3, 4, 5, 6, 7\\}$，这与指定的范围 $[\\max(0, K-n_C), \\min(n_T, K)]$ 相符。\n\n概率质量函数的分母是从 $N=16$ 名参与者中选择 $K=7$ 名血清转换者的总方式数：\n$$ \\binom{N}{K} = \\binom{16}{7} = \\frac{16!}{7!9!} = 11440 $$\n我们现在计算每个可行 $a$ 值的概率：\n$$ \\mathbb{P}(A=a) = \\frac{\\binom{10}{a}\\binom{6}{7-a}}{11440} $$\n对于 $a=1$：$\\mathbb{P}(A=1) = \\frac{\\binom{10}{1}\\binom{6}{6}}{11440} = \\frac{10 \\times 1}{11440} = \\frac{10}{11440}$\n对于 $a=2$：$\\mathbb{P}(A=2) = \\frac{\\binom{10}{2}\\binom{6}{5}}{11440} = \\frac{45 \\times 6}{11440} = \\frac{270}{11440}$\n对于 $a=3$：$\\mathbb{P}(A=3) = \\frac{\\binom{10}{3}\\binom{6}{4}}{11440} = \\frac{120 \\times 15}{11440} = \\frac{1800}{11440}$\n对于 $a=4$：$\\mathbb{P}(A=4) = \\frac{\\binom{10}{4}\\binom{6}{3}}{11440} = \\frac{210 \\times 20}{11440} = \\frac{4200}{11440}$\n对于 $a=5$：$\\mathbb{P}(A=5) = \\frac{\\binom{10}{5}\\binom{6}{2}}{11440} = \\frac{252 \\times 15}{11440} = \\frac{3780}{11440}$\n对于 $a=6$：$\\mathbb{P}(A=6) = \\frac{\\binom{10}{6}\\binom{6}{1}}{11440} = \\frac{210 \\times 6}{11440} = \\frac{1260}{11440}$\n对于 $a=7$：$\\mathbb{P}(A=7) = \\frac{\\binom{10}{7}\\binom{6}{0}}{11440} = \\frac{120 \\times 1}{11440} = \\frac{120}{11440}$\n\n最后，我们计算双边 FET 的 $p$ 值。观测值为 $a_{\\text{obs}}=5$。此观测值的概率为 $\\mathbb{P}(A=5) = \\frac{3780}{11440}$。$p$ 值定义为所有条件概率小于或等于观测表格的条件概率的表格的概率之和。\n$$ p\\text{-value} = \\sum_{a: \\mathbb{P}(A=a) \\le \\mathbb{P}(A=a_{\\text{obs}})} \\mathbb{P}(A=a) $$\n我们将每个概率与 $\\mathbb{P}(A=5) = \\frac{3780}{11440}$ 进行比较。\n$\\mathbb{P}(A=1) = \\frac{10}{11440} \\le \\frac{3780}{11440}$ (真)\n$\\mathbb{P}(A=2) = \\frac{270}{11440} \\le \\frac{3780}{11440}$ (真)\n$\\mathbb{P}(A=3) = \\frac{1800}{11440} \\le \\frac{3780}{11440}$ (真)\n$\\mathbb{P}(A=4) = \\frac{4200}{11440} > \\frac{3780}{11440}$ (假)\n$\\mathbb{P}(A=5) = \\frac{3780}{11440} \\le \\frac{3780}{11440}$ (真)\n$\\mathbb{P}(A=6) = \\frac{1260}{11440} \\le \\frac{3780}{11440}$ (真)\n$\\mathbb{P}(A=7) = \\frac{120}{11440} \\le \\frac{3780}{11440}$ (真)\n$p$ 值是 $a \\in \\{1, 2, 3, 5, 6, 7\\}$ 的概率之和：\n$$ p\\text{-value} = \\mathbb{P}(A=1) + \\mathbb{P}(A=2) + \\mathbb{P}(A=3) + \\mathbb{P}(A=5) + \\mathbb{P}(A=6) + \\mathbb{P}(A=7) $$\n$$ p\\text{-value} = \\frac{10+270+1800+3780+1260+120}{11440} = \\frac{7240}{11440} $$\n将此分数转换为小数：\n$$ p\\text{-value} = \\frac{7240}{11440} \\approx 0.63286713... $$\n四舍五入到四位有效数字，我们得到 $0.6329$。",
            "answer": "$$\n\\boxed{0.6329}\n$$"
        },
        {
            "introduction": "在列联表中，某些类别的组合有时在研究设计上就是不可能的，这导致了“结构性零点”。在这种情况下，标准的独立性检验不再适用。本实践将探讨准独立性（quasi-independence）的概念，该概念仅在可能的单元格中检验关联性 。您将学习使用迭代比例拟合（Iterative Proportional Fitting, IPF）来处理结构性零点，这是分析流行病学和生物统计学中复杂、真实世界研究设计的关键技能。",
            "id": "4899809",
            "problem": "一项生物统计学研究在一个设计的观察性方案中检验疾病状态与暴露类别之间的关联，该方案禁止将已患病个体纳入最高暴露类别。这种设计导致列联表中对应于患病和最高暴露的单元格出现一个结构性零。研究人员记录了以下观察计数表、行总计和列总计：疾病状态行 $i \\in \\{1,2\\}$ 分别为患病 ($i=1$) 和未患病 ($i=2$)，暴露列 $j \\in \\{1,2,3\\}$ 分别为低 ($j=1$)、中 ($j=2$) 和高 ($j=3$)，且在单元格 $(i,j)=(1,3)$ 处有一个结构性零：\n$$\nO=\\begin{pmatrix}\n12  18  0 \\\\\n28  22  20\n\\end{pmatrix},\\quad\n\\text{row totals } R=\\begin{pmatrix}30 \\\\ 70\\end{pmatrix},\\quad\n\\text{column totals } C=\\begin{pmatrix}40 \\\\ 40 \\\\ 20\\end{pmatrix},\\quad\nN=100.\n$$\n假设在容许支持（除结构性零单元格外的所有单元格）上采用拟独立模型，并将计数视为在固定边际的多项抽样方案下产生。从第一性原理出发，使用独立对数线性结构和最大似然来论证用于二维表的迭代比例拟合 (IPF) 程序，并解释如何纳入结构性零约束，以使单元格 $(1,3)$ 在每次更新中都保持为零。以所有容许单元格的初始期望计数 $m_{ij}^{(0)}=1$ 和结构性零的 $m_{13}^{(0)}=0$ 开始 IPF，然后执行一个完整的行尺度缩放步骤，接着执行一个完整的列尺度缩放步骤，明确展示结构性约束是如何被保持的。接下来，通过求解受固定边际和结构性零约束的容许单元格的乘法系统，推导 IPF 迭代的解析极限，并给出所有单元格的拟合期望计数。最后，计算拟独立的皮尔逊卡方统计量，\n$$\nX^{2}=\\sum_{\\text{admissible }(i,j)}\\frac{\\left(O_{ij}-E_{ij}\\right)^{2}}{E_{ij}},\n$$\n其中 $E_{ij}$ 是您获得的拟合期望计数，求和不包括结构性零单元格。将您的最终数值答案四舍五入到四位有效数字。",
            "solution": "**迭代比例拟合 (IPF) 程序的论证**\n\n设 $m_{ij}$ 为单元格 $(i,j)$ 中的期望计数。拟独立模型指出，对于容许单元格集合 $S$（除单元格 $(1,3)$ 处的结构性零外的所有单元格），期望计数遵循独立模型的结构。这可以以乘法形式表示为 $m_{ij} = \\alpha_i \\beta_j$（对于 $(i,j) \\in S$），或等价的对数线性形式：\n$$ \\log(m_{ij}) = \\lambda + \\lambda_i^R + \\lambda_j^C \\quad \\text{for } (i,j) \\in S $$\n其中 $\\lambda$ 是总体效应，$\\lambda_i^R$ 是行 $i$ 的效应，$\\lambda_j^C$ 是列 $j$ 的效应。对于结构性零，我们有约束 $m_{13}=0$。\n\n在多项抽样假设下，观察计数 $O_{ij}$ 的对数似然函数（忽略常数）为：\n$$ \\ell(\\{m_{ij}\\}) = \\sum_{(i,j) \\in S} O_{ij} \\log(m_{ij}) $$\n在对数线性模型结构和固定边际（它们是模型参数的充分统计量）施加的约束下，最大化此对数似然函数会得到一组似然方程。这些方程表明，期望的边际总计必须等于观察到的边际总计：\n$$ \\sum_{j} \\hat{m}_{ij} = \\sum_{j} O_{ij} = R_i \\quad \\text{for } i=1,2 $$\n$$ \\sum_{i} \\hat{m}_{ij} = \\sum_{i} O_{ij} = C_j \\quad \\text{for } j=1,2,3 $$\n其中 $\\hat{m}_{ij}$ 是期望计数的最大似然估计 (MLEs)，并且我们强制 $\\hat{m}_{13}=0$。\n\nIPF 程序是用于找到这些 MLEs $\\hat{m}_{ij}$ 的一种算法。它不直接求解 $\\lambda$ 参数，而是找到满足模型的乘法形式和边际约束的单元格计数。从一组符合模型的初始估计 $m_{ij}^{(0)}$（例如，对于容许单元格 $m_{ij}^{(0)}=1$）开始，IPF 迭代地调整计数以匹配行和列的边际。一次完整的迭代包括一个行尺度缩放步骤和一个列尺度缩放步骤：\n$$ m_{ij}^{(k+1/2)} = m_{ij}^{(k)} \\frac{R_i}{\\sum_{l} m_{il}^{(k)}} $$\n$$ m_{ij}^{(k+1)} = m_{ij}^{(k+1/2)} \\frac{C_j}{\\sum_{k} m_{kj}^{(k+1/2)}} $$\n这个过程保证收敛到唯一的 MLEs $\\hat{m}_{ij}$。\n\n**纳入结构性零约束**\n\n结构性零约束 $m_{13}=0$ 在整个 IPF 過程中通过将其初始值设为零（即 $m_{13}^{(0)}=0$）来保持。更新步骤是乘法性的。\n在对行 $i=1$ 的行尺度缩放步骤中：\n$$ m_{13}^{(k+1/2)} = m_{13}^{(k)} \\frac{R_1}{\\sum_{l} m_{1l}^{(k)}} = 0 \\times (\\text{缩放因子}) = 0 $$\n在对列 $j=3$ 的列尺度缩放步骤中：\n$$ m_{13}^{(k+1)} = m_{13}^{(k+1/2)} \\frac{C_3}{\\sum_{k} m_{k3}^{(k+1/2)}} = 0 \\times (\\text{缩放因子}) = 0 $$\n因此，一旦一个单元格的计数被设为零，它在所有后续迭代中都保持为零。分母中的求和是对给定行或列中的所有单元格进行的，但值为零的单元格对求和没有贡献。\n\n**一次完整的 IPF 迭代**\n\n初始计数为对于所有 $(i,j) \\in S$ 有 $m_{ij}^{(0)}=1$，以及 $m_{13}^{(0)}=0$。\n初始计数矩阵是 $M^{(0)} = \\begin{pmatrix} 1  1  0 \\\\ 1  1  1 \\end{pmatrix}$。\n观察到的边际是 $R=\\begin{pmatrix} 30 \\\\ 70 \\end{pmatrix}$ 和 $C=\\begin{pmatrix} 40 \\\\ 40 \\\\ 20 \\end{pmatrix}$。\n\n**1. 行尺度缩放步骤：**\n初始行总计为 $R_1^{(0)} = 1+1+0=2$ 和 $R_2^{(0)}=1+1+1=3$。\n缩放因子为 $\\frac{R_1}{R_1^{(0)}} = \\frac{30}{2} = 15$ 和 $\\frac{R_2}{R_2^{(0)}} = \\frac{70}{3}$。\n将这些因子应用于 $M^{(0)}$ 的行：\n$m_{11}^{(0.5)} = 1 \\times 15 = 15$, $m_{12}^{(0.5)} = 1 \\times 15 = 15$, $m_{13}^{(0.5)} = 0 \\times 15 = 0$。\n$m_{21}^{(0.5)} = 1 \\times \\frac{70}{3} = \\frac{70}{3}$, $m_{22}^{(0.5)} = 1 \\times \\frac{70}{3} = \\frac{70}{3}$, $m_{23}^{(0.5)} = 1 \\times \\frac{70}{3} = \\frac{70}{3}$。\n行尺度缩放后的矩阵是 $M^{(0.5)} = \\begin{pmatrix} 15  15  0 \\\\ \\frac{70}{3}  \\frac{70}{3}  \\frac{70}{3} \\end{pmatrix}$。\n\n**2. 列尺度缩放步骤：**\n$M^{(0.5)}$ 的列总计为：\n$C_1^{(0.5)} = 15 + \\frac{70}{3} = \\frac{45+70}{3} = \\frac{115}{3}$。\n$C_2^{(0.5)} = 15 + \\frac{70}{3} = \\frac{115}{3}$。\n$C_3^{(0.5)} = 0 + \\frac{70}{3} = \\frac{70}{3}$。\n缩放因子为 $\\frac{C_1}{C_1^{(0.5)}} = \\frac{40}{115/3} = \\frac{120}{115} = \\frac{24}{23}$，$\\frac{C_2}{C_2^{(0.5)}} = \\frac{40}{115/3} = \\frac{24}{23}$，以及 $\\frac{C_3}{C_3^{(0.5)}} = \\frac{20}{70/3} = \\frac{60}{70} = \\frac{6}{7}$。\n将这些因子应用于 $M^{(0.5)}$ 的列：\n$m_{11}^{(1)} = 15 \\times \\frac{24}{23} = \\frac{360}{23}$。\n$m_{21}^{(1)} = \\frac{70}{3} \\times \\frac{24}{23} = 70 \\times \\frac{8}{23} = \\frac{560}{23}$。\n$m_{12}^{(1)} = 15 \\times \\frac{24}{23} = \\frac{360}{23}$。\n$m_{22}^{(1)} = \\frac{70}{3} \\times \\frac{24}{23} = \\frac{560}{23}$。\n$m_{13}^{(1)} = 0 \\times \\frac{6}{7} = 0$。\n$m_{23}^{(1)} = \\frac{70}{3} \\times \\frac{6}{7} = \\frac{10 \\times 6}{3} = 20$。\n一次完整迭代后的矩阵是 $M^{(1)} = \\begin{pmatrix} \\frac{360}{23}  \\frac{360}{23}  0 \\\\ \\frac{560}{23}  \\frac{560}{23}  20 \\end{pmatrix}$。\n\n**IPF 的解析极限（拟合期望计数）**\n\n设 $E_{ij}$ 为拟合期望计数（IPF 过程的极限）。它们必须满足边际约束和拟独立条件。\n边际约束为：\n1.  $E_{11} + E_{12} + E_{13} = 30$。由于 $E_{13}=0$，这变为 $E_{11} + E_{12} = 30$。\n2.  $E_{21} + E_{22} + E_{23} = 70$。\n3.  $E_{11} + E_{21} = 40$。\n4.  $E_{12} + E_{22} = 40$。\n5.  $E_{13} + E_{23} = 20$。由于 $E_{13}=0$，这得出 $E_{23}=20$。\n\n拟独立条件适用于任何由容许单元格组成的 $2 \\times 2$ 子表。唯一这样的子表是由行 $1,2$ 和列 $1,2$ 形成的。这意味着优势比为 1：\n$$ \\frac{E_{11} E_{22}}{E_{12} E_{21}} = 1 \\implies E_{11} E_{22} = E_{12} E_{21} $$\n我们现在解这个方程组。\n从(5)式，我们有 $E_{23}=20$。代入(2)式得到 $E_{21} + E_{22} = 50$。\n让我们用 $E_{11}$ 来表示 $E_{12}$、$E_{21}$ 和 $E_{22}$：\n从(1)式：$E_{12} = 30 - E_{11}$。\n从(3)式：$E_{21} = 40 - E_{11}$。\n从 $E_{21} + E_{22} = 50$：$E_{22} = 50 - E_{21} = 50 - (40 - E_{11}) = 10 + E_{11}$。\n现在将这些代入拟独立方程：\n$$ E_{11} (10 + E_{11}) = (30 - E_{11})(40 - E_{11}) $$\n$$ 10 E_{11} + E_{11}^2 = 1200 - 40 E_{11} - 30 E_{11} + E_{11}^2 $$\n$$ 10 E_{11} = 1200 - 70 E_{11} $$\n$$ 80 E_{11} = 1200 $$\n$$ E_{11} = \\frac{1200}{80} = 15 $$\n现在我们求出其余的值：\n$E_{12} = 30 - 15 = 15$。\n$E_{21} = 40 - 15 = 25$。\n$E_{22} = 10 + 15 = 25$。\n拟合的期望计数为：\n$$ E = \\begin{pmatrix} 15  15  0 \\\\ 25  25  20 \\end{pmatrix} $$\n\n**拟独立的皮尔逊卡方统计量**\n\n该统计量是通过对所有容许单元格，将观察计数与期望计数之差的平方除以期望计数，然后求和计算得出。\n$$ X^{2}=\\sum_{(i,j) \\in S}\\frac{\\left(O_{ij}-E_{ij}\\right)^{2}}{E_{ij}} $$\n观察计数为 $O=\\begin{pmatrix} 12  18  0 \\\\ 28  22  20 \\end{pmatrix}$。\n容许单元格为 $(1,1), (1,2), (2,1), (2,2), (2,3)$。\n$$ X^2 = \\frac{(O_{11}-E_{11})^2}{E_{11}} + \\frac{(O_{12}-E_{12})^2}{E_{12}} + \\frac{(O_{21}-E_{21})^2}{E_{21}} + \\frac{(O_{22}-E_{22})^2}{E_{22}} + \\frac{(O_{23}-E_{23})^2}{E_{23}} $$\n$$ X^2 = \\frac{(12-15)^2}{15} + \\frac{(18-15)^2}{15} + \\frac{(28-25)^2}{25} + \\frac{(22-25)^2}{25} + \\frac{(20-20)^2}{20} $$\n$$ X^2 = \\frac{(-3)^2}{15} + \\frac{3^2}{15} + \\frac{3^2}{25} + \\frac{(-3)^2}{25} + \\frac{0^2}{20} $$\n$$ X^2 = \\frac{9}{15} + \\frac{9}{15} + \\frac{9}{25} + \\frac{9}{25} + 0 $$\n$$ X^2 = \\frac{18}{15} + \\frac{18}{25} $$\n$$ X^2 = \\frac{6}{5} + \\frac{18}{25} = 1.2 + 0.72 = 1.92 $$\n四舍五入到四位有效数字，值为 $1.920$。",
            "answer": "$$\\boxed{1.920}$$"
        },
        {
            "introduction": "设计一项成功研究的关键是确保有足够大的样本量来检测出有意义的效应，这需要估算研究的统计功效（statistical power）。本练习将指导您通过蒙特卡洛模拟，在特定的备择假设下估算卡方检验的功效 。通过实施此模拟，您将获得功效分析的实践经验，这是任何参与研究设计和基金申请的生物统计学家都应具备的基本技能。",
            "id": "4899810",
            "problem": "一个生物统计学实验室正计划进行一项研究，使用基于 Pearson 卡方统计量的标准独立性检验来检测两个分类变量之间的关联。研究人员将通过模拟来估计在特定备择假设下的统计功效，从而规划样本量。您必须设计一个程序，使用多项式抽样在给定的备择假设下模拟功效，并总结蒙特卡洛误差。\n\n使用的基本事实：\n- 对于一个 $r \\times c$ 列联表，在独立性原假设下，根据观测单元格计数和最大似然期望计数计算出的 Pearson 卡方统计量，在正则性条件和大样本量下，近似服从自由度为 $(r-1)(c-1)$ 的卡方分布。当计算出的 $p$ 值小于显著性水平 $\\alpha$ 时，检验将拒绝原假设。\n- 在一个固定的备择分布下，其单元格概率 $p_{ij}$ 不能分解为行边缘概率和列边缘概率的乘积。大小为 $N$ 的独立同分布样本会生成一个随机的 $r \\times c$ 计数表，该表服从参数为 $N$ 和单元格概率为 $\\{p_{ij}\\}$ 的多项式分布。\n- 功效的蒙特卡洛估计量 $\\hat{\\pi}$ 是来自 $R$ 次独立模拟重复的拒绝指示变量的经验均值。根据独立伯努利随机变量的基本性质和中心极限定理，$\\mathbb{E}[\\hat{\\pi}] = \\pi$ 且 $\\mathrm{Var}(\\hat{\\pi}) = \\pi(1-\\pi)/R$。因此，蒙特卡洛标准误差的一个保守估计是 $\\sqrt{\\hat{\\pi}(1-\\hat{\\pi})/R}$，一个近似的双边 $95\\%$ 置信区间的半宽度是 $z_{0.975}\\sqrt{\\hat{\\pi}(1-\\hat{\\pi})/R}$，其中 $z_{0.975}$ 是标准正态分位数。\n\n您的任务：\n- 对于下面的每个测试用例，从一个多项式分布中模拟 $R$ 个大小为 $N$ 的独立列联表，该分布使用指定的 $r \\times c$ 备择单元格概率矩阵 $\\{p_{ij}\\}$。\n- 对于每个模拟的表，使用自由度为 $(r-1)(c-1)$ 的渐近卡方分布计算 $p$ 值，以进行标准的 Pearson 独立性检验（原假设为独立）。\n- 将功效估计为 $\\hat{\\pi}$，即 $p$ 值小于 $\\alpha$ 的模拟所占的比例。\n- 计算蒙特卡洛标准误差 $\\sqrt{\\hat{\\pi}(1-\\hat{\\pi})/R}$ 和近似的 $95\\%$ 置信区间半宽度 $1.96 \\times \\sqrt{\\hat{\\pi}(1-\\hat{\\pi})/R}$。\n- 为了可复现性，使用固定的随机数生成器种子 $123456789$。如果每个用例需要单独的种子，您可以使用此种子的确定性偏移量（例如，加上用例索引）。\n- 在计算过程中稳健地处理任何零期望计数，使得期望计数为零的项对卡方统计量的贡献为 $0$。\n- 将报告的每个数值结果四舍五入到 $6$ 位小数。\n\n测试套件：\n- 用例 $1$ (正常路径)：$r=3$，$c=3$，$\\alpha=0.05$，$N=400$，$R=20000$，以及\n  \n$$\n  \\{p_{ij}\\}=\n  \\begin{bmatrix}\n  0.18  0.07  0.05\\\\\n  0.06  0.20  0.04\\\\\n  0.05  0.05  0.30\n  \\end{bmatrix}.\n  $$\n\n- 用例 $2$ (小样本边界)：$r=2$，$c=3$，$\\alpha=0.05$，$N=50$，$R=15000$，以及\n  \n$$\n  \\{p_{ij}\\}=\n  \\begin{bmatrix}\n  0.10  0.05  0.15\\\\\n  0.20  0.10  0.40\n  \\end{bmatrix}.\n  $$\n\n- 用例 $3$ (边缘情况，边际不平衡)：$r=4$，$c=2$，$\\alpha=0.05$，$N=300$，$R=20000$，以及\n  \n$$\n  \\{p_{ij}\\}=\n  \\begin{bmatrix}\n  0.08  0.02\\\\\n  0.03  0.17\\\\\n  0.15  0.05\\\\\n  0.40  0.10\n  \\end{bmatrix}.\n  $$\n\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按顺序包含用例 1、用例 2、用例 3 的结果：估计功效 $\\hat{\\pi}$、蒙特卡洛标准误差和 $95\\%$ 置信区间半宽度。因此，输出将包含 9 个浮点数，四舍五入到 6 位小数，顺序为 $[\\hat{\\pi}_1,\\mathrm{se}_1,\\mathrm{hw}_1,\\hat{\\pi}_2,\\mathrm{se}_2,\\mathrm{hw}_2,\\hat{\\pi}_3,\\mathrm{se}_3,\\mathrm{hw}_3]$。",
            "solution": "在此，将详细介绍解决该问题的方法论。\n\n### 基于原理的解决方案设计\n\n目标是通过蒙特卡洛模拟，为特定的备择假设估计 Pearson 独立性卡方检验的统计功效。功效是在特定备择假设为真时，正确拒绝原假设的概率。\n\n#### 1. 理论框架：Pearson 卡方检验\n\nPearson 卡方检验用于评估两个分类变量之间是否存在统计上显著的关联。数据被汇总在一个 $r \\times c$ 的列联表中，其中 $r$ 是行变量的类别数， $c$ 是列变量的类别数。\n\n- **假设**：原假设 $H_0$ 表明两个变量是独立的。这意味着一个观测值落入单元格 $(i, j)$ 的联合概率 $p_{ij}$ 是边际概率的乘积：$p_{ij} = p_{i \\cdot} \\times p_{\\cdot j}$，其中 $p_{i \\cdot} = \\sum_j p_{ij}$ 且 $p_{\\cdot j} = \\sum_i p_{ij}$。备择假设 $H_1$ 是变量不独立。\n\n- **检验统计量**：检验统计量是根据观测计数 $O_{ij}$ 和原假设下的期望计数 $E_{ij}$ 计算得出的。该统计量由以下公式给出：\n$$\n\\chi^2 = \\sum_{i=1}^{r} \\sum_{j=1}^{c} \\frac{(O_{ij} - E_{ij})^2}{E_{ij}}\n$$\n期望计数 $E_{ij}$ 是通过将行和列的边际总数相乘，然后除以总样本量 $N$ 从数据中估计出来的：\n$$\nE_{ij} = \\frac{(\\sum_{k=1}^{c} O_{ik}) (\\sum_{l=1}^{r} O_{lj})}{N}\n$$\n如果期望计数 $E_{ij}$ 为零，则其在总和中的对应项为 $0$。\n\n- **零分布和决策规则**：在 $H_0$ 下，对于足够大的样本量 $N$，$\\chi^2$ 统计量近似服从自由度为 $(r-1)(c-1)$ 的卡方分布。$p$ 值被计算为在假设 $H_0$ 为真的情况下，观测到等于或比已计算出的检验统计量更极端的检验统计量的概率。如果 $p$ 值小于显著性水平 $\\alpha$，则拒绝原假设。\n\n#### 2. 用于功效估计的蒙特卡洛模拟\n\n由于在特定备择分布 $\\{p_{ij}\\}$ 下功效的解析计算很复杂，我们使用蒙特卡洛模拟。功效 $\\pi$ 定义为 $\\pi = P(\\text{拒绝 } H_0 | H_1 \\text{ 为真})$。\n\n模拟过程分三个阶段展开：\n\n**阶段 1：数据生成**\n我们给定一个特定的备择假设，由一个单元格概率矩阵 $\\{p_{ij}\\}$ 定义，其中 $\\sum_{i,j} p_{ij} = 1$。我们模拟大量的（$R$ 次）独立实验。在每次实验中，我们通过从参数为 $N$ 和扁平化的概率向量 $\\{p_{ij}\\}$ 的多项式分布中抽样，生成一个大小为 $N$ 的随机列联表。\n\n**阶段 2：假设检验**\n每个模拟的列联表都被视为一个观测数据集。对于 $R$ 个表中的每一个，我们都如上所述执行 Pearson 独立性卡方检验。这包括基于渐近 $\\chi^2_{(r-1)(c-1)}$ 分布计算检验统计量及其对应的 $p$ 值。\n\n**阶段 3：功效估计**\n统计功效被估计为原假设被拒绝的模拟重复所占的比例。设 $I_k$ 是一个指示变量，如果第 $k$ 个模拟表的 $p$ 值小于 $\\alpha$，则为 $1$，否则为 $0$。功效的蒙特卡洛估计量 $\\hat{\\pi}$ 是这些指示变量的均值：\n$$\n\\hat{\\pi} = \\frac{1}{R} \\sum_{k=1}^{R} I_k\n$$\n\n#### 3. 量化蒙特卡洛误差\n\n估计量 $\\hat{\\pi}$ 本身是一个随机量，其精度取决于重复次数 $R$。每次重复都是一次成功概率为 $\\pi$ 的伯努利试验。在 $R$ 次试验中的总拒绝次数服从二项分布 $\\text{Bin}(R, \\pi)$。\n\n- **标准误差**：功效估计量的方差是 $\\mathrm{Var}(\\hat{\\pi}) = \\frac{\\pi(1-\\pi)}{R}$。蒙特卡洛标准误差 (MCSE) 是该估计量的标准差，我们通过用 $\\hat{\\pi}$ 替代 $\\pi$ 来估计它：\n$$\n\\text{MCSE}(\\hat{\\pi}) = \\sqrt{\\frac{\\hat{\\pi}(1-\\hat{\\pi})}{R}}\n$$\n这个量度量了我们蒙特卡洛估计的典型误差。\n\n- **置信区间**：根据中心极限定理，对于大的 $R$，$\\hat{\\pi}$ 的分布近似为正态分布。真实功效 $\\pi$ 的一个近似双边 $95\\%$ 置信区间由以下公式给出：\n$$\n\\hat{\\pi} \\pm z_{0.975} \\times \\text{MCSE}(\\hat{\\pi})\n$$\n其中 $z_{0.975} \\approx 1.96$ 是标准正态分布的 $0.975$ 分位数。该区间的半宽度，$1.96 \\times \\text{MCSE}(\\hat{\\pi})$，为我们功效估计的不确定性提供了一个度量。\n\n#### 4. 实现细节\n\n模拟将使用 Python 实现，其中 `numpy` 用于数值运算，`scipy.stats` 用于卡方检验。\n\n- **可复现性**：使用一个固定的基础随机数生成器种子 $123456789$。对于每个测试用例，通过将用例索引添加到基础种子来创建一个唯一的、确定性的种子，以确保独立且可复现的模拟流。\n- **模拟循环**：对于每个测试用例，创建一个 `numpy.random.default_rng` 实例。所有 $R$ 个列联表都是通过对 `rng.multinomial(n=N, pvals=p_flat, size=R)` 的单次向量化调用生成的。\n- **卡方检验**：我们遍历 $R$ 个模拟表。对于每个表，调用 `scipy.stats.chi2_contingency` 并设置 `correction=False` 以获取 $p$ 值。该函数按要求正确处理行或列总和为零的情况。\n- **汇总与输出**：计算拒绝的次数（即 $p$ 值  $\\alpha$ 的情况）。使用上述公式计算估计的功效 $\\hat{\\pi}$、MCSE 和 $95\\%$ CI 半宽度。最终结果四舍五入到 6 位小数并按指定格式进行格式化。\n\n这种结构化的方法确保了模拟在科学上是合理的、在计算上是高效的，并能产生具有明确精度度量的可复现结果。",
            "answer": "$$\n\\boxed{[1.0,0.0,0.0,0.301533,0.003716,0.007283,1.0,0.0,0.0]}\n$$"
        }
    ]
}