## 引言
在科学研究中，进行公平的比较是探寻真相的核心，但混杂因素的存在常常使我们对数据的解读偏离[轨道](@entry_id:137151)，甚至得出与事实完全相反的结论。曼特尔-汉斯泽尔（Mantel-Haenszel）[分层](@entry_id:907025)分析正是为应对这一挑战而生的强大统计思想。它不仅是一套计算公式，更是一种“[分而治之](@entry_id:273215)”的智慧，教我们如何在充满干扰的[真实世界数据](@entry_id:902212)中，剥离[虚假关联](@entry_id:910909)，逼[近因](@entry_id:149158)果关系的本质。

本文旨在系统地介绍曼特尔-汉斯泽尔[分层](@entry_id:907025)分析。我们将从其基本原理出发，逐步深入到其在不同学科领域的广泛应用，最终通过实践练习巩固所学知识。
- 在 **“原理与机制”** 一章中，您将理解混杂的本质，学习如何通过[分层](@entry_id:907025)克服[辛普森悖论](@entry_id:136589)，并掌握Mantel-Haenszel[优势比](@entry_id:173151)估计量背后的巧妙加权思想及其深刻的统计学理论基础。
- 接着，在 **“应用与跨学科连接”** 一章，我们将探索该方法如何从经典的[流行病学](@entry_id:141409)研究，延伸至现代[基因组学](@entry_id:138123)和因果推断的前沿，并揭示它与配对分析、Meta分析等其他统计方法的内在联系。
- 最后，在 **“动手实践”** 部分，您将通过具体的计算练习，亲手应用所学知识，解决从计算合并[优势比](@entry_id:173151)到检验效应[同质性](@entry_id:636502)的实际问题。

通过本次学习，您将掌握一个在[生物统计学](@entry_id:266136)和[流行病学](@entry_id:141409)等领域不可或缺的分析工具，学会更严谨、更审慎地从数据中提取可靠的结论。

## 原理与机制

在科学探索的旅程中，我们最常做的事情之一就是比较。这种新药比旧药更有效吗？这种生活方式是否与某种疾病相关？然而，进行一次“公平”的比较，远比听上去要复杂得多。大自然并非一个受控的实验室，各种因素盘根错节，如同一个狡猾的魔术师，总能用障眼法迷惑我们。Mantel-Haenszel [分层](@entry_id:907025)分析，就是一套揭示真相、对抗这种迷惑的强大思想工具。它不仅是一套计算方法，更体现了统计学中“控制变量”这一核心思想的精髓。

### 比较的艺术：混杂的挑战

想象一下，你想比较两种肥料对苹果树产量的影响。你将 A 肥料用于山坡南面的果园，将 B 肥料用于北面的果园。几个月后，你发现南面果园的苹果又大又甜，而北面的则相形见绌。你能得出结论说 A 肥料更优越吗？

恐怕不能。因为南面的果园阳光充足，而北面的则较为阴凉。阳光，这个你未加控制的第三方因素，同时影响着“肥料的选择”（你恰好这么分配了）和“苹果的产量”。它就像一个幽灵，悄悄地混入了你的比较之中，让结果变得不再纯粹。这个“幽灵”在统计学中被称为**混杂因素 (confounder)**。

直接比较所有用 A 肥料和 B 肥料的苹果，我们得到的是一个“粗糙”的、被混杂了的结果。要进行公平的比较，智慧的方法是**[分层](@entry_id:907025) (stratification)**。我们将果园分成两个“层”：阳光充足的层和阳光不足的层。然后，我们在“阳光充足”这一层内，比较使用 A 肥料和 B 肥料的苹果；同样，在“阳光不足”的层内，再进行一次独立的比较。这样一来，在每一层内部，阳光的影响就被固定住了，肥料的效果得以清晰地显现。

这正是 Mantel-Haenszel 分析的出发点：将复杂的人群根据混杂因素（如年龄、性别、地域）分成若干个同质的亚组（即“层”），在每个亚组内进行干净的比较，最后再将这些来自不同层的信息巧妙地“汇总”起来，得出一个调整了混杂因素后的、更为可信的结论 。

### 破解关联之谜：从粗略关联到[辛普森悖论](@entry_id:136589)

在[生物统计学](@entry_id:266136)和[流行病学](@entry_id:141409)中，我们最常用的工具是 $2 \times 2$ [列联表](@entry_id:162738)。它简洁地展示了暴露（如吸烟）与结局（如患病）之间的关系。

| | 患病 (D=1) | 未患病 (D=0) |
| :--- | :---: | :---: |
| **暴露 (E=1)** | $a$ | $b$ |
| **未暴露 (E=0)**| $c$ | $d$ |

要衡量两者之间的[关联强度](@entry_id:924074)，一个非常有用的指标是**[优势比](@entry_id:173151) (Odds Ratio, OR)**。所谓“优势 (odds)”，指的是某事件发生的概率与不发生的概率之比。例如，暴露组的患病优势是 $\frac{a}{b}$。而[优势比](@entry_id:173151)，就是暴露组的患病优势与非暴露组的患病优势之比。经过简单的代数变换，我们发现它恰好等于两个对角线乘积之比：

$$ OR = \frac{a/b}{c/d} = \frac{ad}{bc} $$

这个简洁的“[交叉](@entry_id:147634)乘积比”是衡量[关联强度](@entry_id:924074)的有力工具。$OR \gt 1$ 意味着暴露与患病呈正相关（风险增加），$OR \lt 1$ 意味着负相关（风险降低），而 $OR = 1$ 则意味着两者没有关联。

然而，如果我们不经[分层](@entry_id:907025)，直接将所有数据汇总在一个大的 $2 \times 2$ 表中计算出的“粗略[优势比](@entry_id:173151) (crude odds ratio)”，就可能掉入混杂的陷阱。一个极端的例子是**[辛普森悖论](@entry_id:136589) (Simpson's Paradox)**。

让我们来看一个经典教学案例中的数据 。假设我们研究某种暴露 $E$ 与疾病 $D$ 的关系，并按一个二[分类变量](@entry_id:637195) $Z$（比如，年轻人和老年人）[分层](@entry_id:907025)。

-   在 $Z=0$ 层（比如年轻人组），我们观察到 $OR_0 = \frac{6 \times 20}{3 \times 20} = 2$。
-   在 $Z=1$ 层（比如老年人组），我们观察到 $OR_1 = \frac{20 \times 95}{190 \times 5} = 2$。

在两个亚组中，暴露都使得患病优势翻倍，关联的方向和强度是完全一致的！然而，如果我们无视[分层](@entry_id:907025)，将数据合并：

| | 患病 | 未患病 |
| :--- | :---: | :---: |
| **暴露** | $6+20=26$ | $3+190=193$ |
| **未暴露**| $20+5=25$ | $20+95=115$ |

计算出的粗略[优势比](@entry_id:173151)是 $OR_{crude} = \frac{26 \times 115}{193 \times 25} \approx 0.62$。

这是一个惊人的结果！在每个亚组内部，暴露都显示出明确的风险（$OR = 2$），但总体上，暴露反而呈现出“保护性”效应（$OR \approx 0.62 \lt 1$）。这就是[辛普森悖论](@entry_id:136589)的魔力，它生动地展示了混杂（这里是变量 $Z$）如何彻底扭曲我们对真相的认知 。这个悖论警示我们：在分析数据时，简单地合并异质性群体是极其危险的。[分层](@entry_id:907025)分析，势在必行。

### Mantel-Haenszel 的智慧：一种巧妙的加权合并

既然我们不能简单地合并原始数据，那么我们该如何合并从每一层中得到的信息呢？我们已经在每一层内都得到了一个[优势比](@entry_id:173151)（例如，上面例子中的两个 $OR=2$）。一个自然的想法是：能不能把这些层内的[优势比](@entry_id:173151)“平均”一下？

这个想法虽然直观，但并不完美。首先，如果各层的[优势比](@entry_id:173151)不完全相同怎么办？其次，每一层的数据量和[信息量](@entry_id:272315)可能天差地别。一个只有 50 个样本的层和一个有 5000 个样本的层，它们给出的估计的可靠性显然不同。简单地取平均值，会忽略这些重要的信息。

1959年，Nathan Mantel 和 William Haenszel 提出了一种优雅的解决方案。他们没有直接去平均那些算出来的[优势比](@entry_id:173151)，而是回到了 $2 \times 2$ 表的内部，从源头进行合并。**Mantel-Haenszel (MH) [优势比](@entry_id:173151)估计量** 的形式如下：

$$ \hat{OR}_{MH} = \frac{\sum_{i=1}^{K} \frac{a_i d_i}{n_i}}{\sum_{i=1}^{K} \frac{b_i c_i}{n_i}} $$

这里，$i$ 代表第 $i$ 层，$K$ 是总层数，$n_i = a_i+b_i+c_i+d_i$ 是第 $i$ 层的总人数。

这个公式看起来有些复杂，但它的内在逻辑却非常美妙 。我们可以这样理解它：
-   分子 $\sum \frac{a_i d_i}{n_i}$ 是对所有层中“支持关联”的证据（即 $a_i d_i$ [交叉](@entry_id:147634)乘积）的加权求和。
-   分母 $\sum \frac{b_i c_i}{n_i}$ 是对所有层中“反对关联”的证据（即 $b_i c_i$ 交叉乘积）的加权求和。

而这个权重 $w_i = \frac{1}{n_i}$ 尤其巧妙。它意味着，总人数较少的层，其[交叉](@entry_id:147634)乘积对最终结果的“贡献”反而更大。这似乎有悖常理，但这种权重方案赋予了 MH 估计量极佳的统计学性质，尤其是在处理包含许多小[样本量](@entry_id:910360)的“[稀疏数据](@entry_id:636194)”时表现得非常稳健。

更有趣的是，通过简单的代数变换，我们可以证明 MH 估计量实际上是**层别[优势比](@entry_id:173151)的一种加权平均** 。只不过，它的权重并不是我们最初想象的[样本量](@entry_id:910360) $n_i$，而是 $W_i = \frac{b_i c_i}{n_i}$。这个权重的大小与层内的“[信息量](@entry_id:272315)”有关。一个 $b_i$ 或 $c_i$ 接近于零的层，其 $OR_i$ 的估计会非常不稳定，而此时它的权重 $W_i$ 也会很小，从而降低了它对最终汇总结果的影响。这种设计，再次体现了统计学的精妙与智慧。

### 深入核心：固定边际下的超几何世界

Mantel-Haenszel 方法的美，不仅在于其巧妙的加权方案，更在于其深刻的理论根基。这套理论的核心是一个非常反直觉却又异常强大的思想：**条件性推断 (conditional inference)**。

让我们再次回到第 $i$ 层的 $2 \times 2$ 表。想象一下，我们把这一层的行汇总（暴露人数 $n_{1i}$ 和未暴露人数 $n_{0i}$）与列汇总（病例数 $m_{1i}$ 和非病例数 $m_{0i}$）都看作是**固定的**。这就好比我们事先就知道，在这个实验里，将会有 $m_{1i}$ 个人最终成为病例，$n_{1i}$ 个人接受暴露，等等。我们唯一不知道的，是这 $n_{1i}$ 个暴露者中，究竟有几个人会成为那 $m_{1i}$ 个病例中的一员 。

这个思想实验把一个复杂的问题，变成了一个经典的组合数学问题，就像从罐子里抽球一样 。想象一个罐子里有 $n_i$ 个球，其中 $m_{1i}$ 个是红球（代表病例），剩下的是白球。现在，我们不放回地从中抽取 $n_{1i}$ 个球（代表暴露组）。那么，抽出的这 $n_{1i}$ 个球里，恰好有 $a_i$ 个红球的概率是多少？

这个问题的答案，由**[超几何分布](@entry_id:193745) (Hypergeometric distribution)** 给出。在“暴露与疾病无关”（即 $OR=1$）的[原假设](@entry_id:265441)下，这个 $a_i$ 的[期望值](@entry_id:153208)（平均数）和[方差](@entry_id:200758)都可以被精确地计算出来：
$$ E[a_i] = \frac{n_{1i} m_{1i}}{n_i} $$
$$ \operatorname{Var}(a_i) = \frac{n_{1i} n_{0i} m_{1i} m_{0i}}{n_i^2 (n_i - 1)} $$
请注意，这两个公式里的所有量，都只跟我们“固定”的边际总数有关，而与层内未知的真实概率无关。这正是“条件化”的威力所在：它帮助我们摆脱了讨厌的“未知参数”，让问题变得纯粹而可解。

基于这个模型，**Cochran-Mantel-Haenszel (CMH) 检验** 应运而生 。它的逻辑非常直白：
1.  把所有层观察到的暴露病例数加起来：$O = \sum a_i$。
2.  把所有层在[原假设](@entry_id:265441)下期望的暴露病例数加起来：$E = \sum E[a_i]$。
3.  如果暴露真的与疾病无关，那么 $O$ 和 $E$ 应该非常接近。它们的差距越大，我们就越有理由怀疑[原假设](@entry_id:265441)。
4.  CMH [检验统计量](@entry_id:897871)正是构建于这种“观测与期望之差”之上，它综合了所有层的信息，并用[超几何分布](@entry_id:193745)的[方差](@entry_id:200758)进行了标准化。最终得到的统计量近似服从自由度为 1 的[卡方分布](@entry_id:263145) ($\chi^2_1$)，使我们能量化地判断关联是否显著。

$$ T_{CMH} = \frac{\left( \sum_{i=1}^{K} (a_i - E[a_i]) \right)^2}{\sum_{i=1}^{K} \operatorname{Var}(a_i)} \sim \chi^2_1 $$

从一个简单的[分层](@entry_id:907025)想法，到巧妙的加权估计，再到背后优美的[超几何概率](@entry_id:263667)模型，Mantel-Haenszel 为我们展示了一条清晰而严谨的逻辑链条，揭示了[统计推断](@entry_id:172747)的内在和谐与统一。

### 统一的框架：超越[优势比](@entry_id:173151)

Mantel-Haenszel 思想的普适性在于，它不仅仅适用于[优势比](@entry_id:173151)。对于其他常用的关联度量，如**[风险比](@entry_id:173429) (Risk Ratio, RR)** 和**[风险差](@entry_id:910459) (Risk Difference, RD)**，我们同样可以构建类似的合并估计量。

-   **对于[风险比](@entry_id:173429) (RR)**，MH 估计量可以看作是层别风险的加权比值，其权重 $w_i$ 巧妙地设定为 $\frac{n_{1i} n_{0i}}{n_i}$，使得汇总公式恰好为 $\hat{RR}_{MH} = \frac{\sum a_i n_{0i}/n_i}{\sum c_i n_{1i}/n_i}$ 。

-   **对于[风险差](@entry_id:910459) (RD)**，MH 估计量是一个对层别[风险差](@entry_id:910459) $(a_i/n_{1i} - c_i/n_{0i})$ 的加权平均，其权重 $w_i = \frac{n_{1i} n_{0i}}{n_{1i}+n_{0i}}$ 恰好是层别[风险差](@entry_id:910459)[估计量方差](@entry_id:263211)的倒数的一部分（忽略了与未知概率相关的项），这是一种稳健的近似“[反方差加权](@entry_id:898285)”策略 。

虽然不同度量的具体权重形式有所不同，但其核心思想一脉相承：通过一种非平凡的加权方式，汇集来自各个同质层的信息，以得到一个调整了混杂因素的、稳健的汇总估计。这再次彰显了 Mantel-Haenszel 框架的统一之美。

### 科学的边界：[效应修饰](@entry_id:899121)与非可折叠性

如同任何强大的工具，我们必须了解 Mantel-Haenszel 方法的适用边界。它的核心假设是，在不同层之间，存在一个**共同的 (common)** 关联度量（如共同的[优势比](@entry_id:173151)）。但如果这个假设不成立呢？

#### [效应修饰](@entry_id:899121)：当关联不再“共同”

想象一下，某种药物对年轻人的疗效很好（$OR=5$），但对老年人几乎无效（$OR=1.1$）。在这种情况下，年龄不仅仅是一个需要“控制”的混杂因素，它更是一个**[效应修饰](@entry_id:899121)因素 (effect modifier)**，因为它改变了药物效果的本身。这时，强行计算一个合并的[优势比](@entry_id:173151)（比如得到的 MH 估计量是 $2.5$），就会掩盖掉这个重要的[异质性](@entry_id:275678)信息。这个 $2.5$ 对年轻人来说太低，对老年人来说又太高，对谁都不能准确描述真相 。

因此，在进行 Mantel-Haenszel 分析前，一个至关重要的步骤是评估**[同质性](@entry_id:636502) (homogeneity)**，即判断各层的[优势比](@entry_id:173151)是否真的“共同”。**Breslow-Day 检验** 就是为这个目的设计的 。它通过比较在“共同[优势比](@entry_id:173151)”假设下每个单元格的[期望频数](@entry_id:904805)与实际观测频数，来构建一个[检验统计量](@entry_id:897871)。如果该检验结果显著，就意味着各层 OR 有显著差异，存在[效应修饰](@entry_id:899121)，此时我们应该分别报告各层的 OR，而不是强行合并。

#### 非可折叠性：[优势比](@entry_id:173151)的奇特性质

最后，让我们来欣赏一个关于[优势比](@entry_id:173151)的、足以让初学者感到困惑的奇特性质——**非可折叠性 (non-collapsibility)**。

我们已经看到，当存在混杂时，粗略[优势比](@entry_id:173151)会不等于调整后的 MH [优势比](@entry_id:173151)。但令人惊讶的是，即使在**没有混杂**的情况下，这种不相等也可能发生！

考虑一个教学案例 ，其中[分层](@entry_id:907025)变量 $Z$ 与暴露 $E$ 完全无关（因此 $Z$ 不是混杂因素），并且每一层的真实[优势比](@entry_id:173151)都是 $2$。经过计算，我们发现 MH [汇总优势比](@entry_id:907572)确实是 $2$，但粗略[优势比](@entry_id:173151)却是 $1.926$。

$$ OR_{crude} \approx 1.926 \neq OR_{MH} = 2.0 $$

为什么在没有混杂的情况下，[合并操作](@entry_id:636132)（从[分层](@entry_id:907025)到粗略）仍然改变了[优势比](@entry_id:173151)的值？这并非错误，而是[优势比](@entry_id:173151)这个数学度量自身的内在属性。只要各层的基线风险（即未暴露人群的患病风险）不同，且共同[优势比](@entry_id:173151)不等于 $1$，那么粗略[优势比](@entry_id:173151)就天然地会“偏向”于 $1$。相比之下，[风险比](@entry_id:173429) (RR) 和[风险差](@entry_id:910459) (RD) 则是“可折叠的”，在没有混杂时，粗略值就是层别值的加权平均。

这个“非可折叠性”提醒我们，[优势比](@entry_id:173151)是一个微妙的度量。当我们比较一个粗略 OR 和一个调整后 OR 时，它们之间的差异可能部分来自混杂，部分则来自这种纯数学上的非可折叠效应。理解这一点，是真正掌握[分层](@entry_id:907025)分析精髓的标志，也是欣赏统计学严谨与奇妙之美的又一扇窗口。