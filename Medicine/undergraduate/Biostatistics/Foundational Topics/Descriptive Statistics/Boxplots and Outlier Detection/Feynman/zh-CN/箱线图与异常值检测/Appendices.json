{
    "hands_on_practices": [
        {
            "introduction": "箱线图通过 $1.5 \\times \\mathrm{IQR}$ 规则为我们提供了一个标准化的离群点检测方法，但这并非唯一的方法。在处理真实世界的数据时，我们必须考虑一个重要概念：“稳健性”（robustness），即统计量对极端值的敏感程度。本练习将引导你亲手比较经典的 IQR 规则与一个基于中位数绝对偏差（Median Absolute Deviation, MAD）的更稳健的规则 。通过观察一个极端误差值对两种方法判断边界的不同影响，你将深刻理解为何在数据分析中稳健的统计方法至关重要。",
            "id": "4798471",
            "problem": "一个心脏病科评估高敏心肌肌钙蛋白I（hs-cTnI）的数值，以通过图形摘要识别异常值。在单个值班期间获得的hs-cTnI值的直方图呈现单峰形态，并带有在急症护理场景中典型的右偏分布。其箱形图使用Tukey铰链法计算四分位数，而重复抽样的散点图识别出一个归因于实验室仪器故障的明显极端错误测量值。为形式化地说明图形化规则如何响应这一单个极端误差，请考虑以下内容。\n\n从核心定义开始：四分位距（IQR）定义为 $Q_{3}-Q_{1}$，其中 $Q_{1}$ 和 $Q_{3}$ 是通过Tukey铰链法计算的第一和第三四分位数（将排序后的样本在中位数处分割；对于奇数大小的样本，从下半部分计算 $Q_{1}$，从上半部分计算 $Q_{3}$；对于偶数大小的样本，$Q_{1}$ 是下半部分的中位数，$Q_{3}$ 是上半部分的中位数）。经典的箱形图上限为 $Q_{3}+1.5\\times \\mathrm{IQR}$。中位数绝对偏差（MAD）定义为 $\\{|x_{i}-m|\\}$ 的中位数，其中 $m$ 是样本中位数。一个稳健的、经过分布校准的、用于识别高位异常值的MAD规则由 $m+c\\times \\mathrm{MAD}$ 给出，其中常数 $c$ 的选择是为了在正态参考模型下与 $1.5\\times \\mathrm{IQR}$ 规则的上限相匹配。\n\n给定一个以 $\\mathrm{ng/L}$ 为单位的基线有序hs-cTnI值样本：\n$5,\\ 8,\\ 10,\\ 12,\\ 15,\\ 18,\\ 22,\\ 30,\\ 45$。\n在一次实验室错误后，一个极端错误值 $50{,}000$ 被附加到样本中，产生有序样本：\n$5,\\ 8,\\ 10,\\ 12,\\ 15,\\ 18,\\ 22,\\ 30,\\ 45,\\ 50{,}000$。\n\n仅使用上述定义以及在正态参考模型下 $1.5\\times \\mathrm{IQR}$ 上限与基于MAD的临界值之间的等价关系，按以下步骤操作：\n\n- 推导常数 $c$，使得对于一个标准差为 $\\sigma$ 的正态分布，其上限 $m+c\\times \\mathrm{MAD}$ 与 $Q_{3}+1.5\\times \\mathrm{IQR}$ 对齐。\n- 对于基线样本和包含单个极端误差的样本，分别计算在 $1.5\\times \\mathrm{IQR}$ 规则下和使用您推导的 $c$ 的MAD规则下的上限。\n- 通过计算每种规则下，从基线到出现误差后上限的增量，来量化每种规则对单个极端误差的响应。\n- 最后，计算这些增量的比率（$1.5\\times \\mathrm{IQR}$ 规则下的增量除以MAD规则下的增量）。\n\n将最终比率表示为不带单位的小数，并四舍五入至四位有效数字。",
            "solution": "该问题要求通过分析两种异常值检测规则（一种基于四分位距IQR，另一种基于中位数绝对偏差MAD）对单个极端异常值的响应来验证它们。该过程包括四个主要步骤：推导基于MAD规则的校准常数 $c$，计算基线样本和含误差样本的异常值临界值，确定这些临界值因误差而产生的增量，最后计算这些增量的比率。\n\n### 步骤1：校准常数 $c$ 的推导\n\n常数 $c$ 是通过将 $1.5 \\times \\mathrm{IQR}$ 规则的异常值上限与基于MAD的规则 $m + c \\times \\mathrm{MAD}$ 对于一般正态分布 $X \\sim N(\\mu, \\sigma^2)$ 相等来确定的。\n\n对于正态分布，中位数 $m$ 等于均值 $\\mu$。令 $\\Phi(z)$ 为标准正态分布 $Z \\sim N(0, 1)$ 的累积分布函数（CDF）。\n\n第一四分位数（$Q_1$）和第三四分位数（$Q_3$）分别对应于第25和第75百分位数。\n对于正态分布 $N(\\mu, \\sigma^2)$：\n$Q_1 = \\mu + \\sigma \\Phi^{-1}(0.25)$\n$Q_3 = \\mu + \\sigma \\Phi^{-1}(0.75)$\n由于正态分布的对称性，$\\Phi^{-1}(0.25) = -\\Phi^{-1}(0.75)$。\n四分位距（IQR）为：\n$\\mathrm{IQR} = Q_3 - Q_1 = (\\mu + \\sigma \\Phi^{-1}(0.75)) - (\\mu - \\sigma \\Phi^{-1}(0.75)) = 2 \\sigma \\Phi^{-1}(0.75)$。\n\n经典的箱形图上限定义为 $Q_3 + 1.5 \\times \\mathrm{IQR}$。代入 $Q_3$ 和 $\\mathrm{IQR}$ 的表达式：\n上限 $= (\\mu + \\sigma \\Phi^{-1}(0.75)) + 1.5 \\times (2 \\sigma \\Phi^{-1}(0.75))$\n上限 $= \\mu + \\sigma \\Phi^{-1}(0.75) + 3 \\sigma \\Phi^{-1}(0.75) = \\mu + 4 \\sigma \\Phi^{-1}(0.75)$。\n\n现在，我们分析基于MAD的规则。MAD是样本与样本中位数之间绝对偏差的中位数。对于正态分布，这对应于随机变量 $|X - m| = |X - \\mu|$ 的中位数。\n$\\mathrm{MAD} = \\text{median}(|X - \\mu|)$。\n令 $k = \\mathrm{MAD}$。我们必须找到 $k$ 使得 $P(|X - \\mu| \\le k) = 0.5$。\n这等价于 $P(-k \\le X - \\mu \\le k) = 0.5$，或 $P(-k/\\sigma \\le Z \\le k/\\sigma) = 0.5$。\n使用标准正态CDF，这变成 $\\Phi(k/\\sigma) - \\Phi(-k/\\sigma) = 0.5$。\n根据对称性，$2\\Phi(k/\\sigma) - 1 = 0.5$，这意味着 $\\Phi(k/\\sigma) = 0.75$。\n因此，$k/\\sigma = \\Phi^{-1}(0.75)$，得出 $\\mathrm{MAD} = k = \\sigma \\Phi^{-1}(0.75)$。\n\n基于MAD的上限为 $m + c \\times \\mathrm{MAD}$。对于正态分布，这是：\nMAD上限 $= \\mu + c \\times (\\sigma \\Phi^{-1}(0.75))$。\n\n为了找到 $c$，我们令两个上限相等：\n$\\mu + 4 \\sigma \\Phi^{-1}(0.75) = \\mu + c \\sigma \\Phi^{-1}(0.75)$\n$4 \\sigma \\Phi^{-1}(0.75) = c \\sigma \\Phi^{-1}(0.75)$\n由此得出 $c = 4$。\n\n### 步骤2：样本临界值的计算\n\n我们将使用推导出的常数 $c=4$ 来计算基于MAD的规则。\n\n**A. 基线样本**\n有序样本为 $S_1 = \\{5, 8, 10, 12, 15, 18, 22, 30, 45\\}$。样本大小为 $n_1 = 9$。\n- **中位数 ($m_1$):** 中位数是第 $((9+1)/2) = 5$ 个值。所以，$m_1 = 15$。\n- **四分位数 ($Q_{1,1}, Q_{3,1}$):** 对于奇数大小的样本，我们排除中位数。\n  - 下半部分：$L_1 = \\{5, 8, 10, 12\\}$。$L_1$ 的中位数是 $Q_{1,1} = \\frac{8+10}{2} = 9$。\n  - 上半部分：$U_1 = \\{18, 22, 30, 45\\}$。$U_1$ 的中位数是 $Q_{3,1} = \\frac{22+30}{2} = 26$。\n- **IQR规则上限 ($F_1$):**\n  - $\\mathrm{IQR}_1 = Q_{3,1} - Q_{1,1} = 26 - 9 = 17$。\n  - 上限 $F_1 = Q_{3,1} + 1.5 \\times \\mathrm{IQR}_1 = 26 + 1.5 \\times 17 = 26 + 25.5 = 51.5$。\n- **MAD规则上限 ($M_1$):**\n  - 与中位数 $m_1=15$ 的绝对偏差：$\\{|5-15|, |8-15|, |10-15|, ..., |45-15|\\} = \\{10, 7, 5, 3, 0, 3, 7, 15, 30\\}$。\n  - 排序后的偏差：$\\{0, 3, 3, 5, 7, 7, 10, 15, 30\\}$。\n  - MAD是这些偏差的中位数：$\\mathrm{MAD}_1 = 7$。\n  - MAD上限 $M_1 = m_1 + c \\times \\mathrm{MAD}_1 = 15 + 4 \\times 7 = 15 + 28 = 43$。\n\n**B. 含极端误差的样本**\n有序样本为 $S_2 = \\{5, 8, 10, 12, 15, 18, 22, 30, 45, 50000\\}$。样本大小为 $n_2 = 10$。\n- **中位数 ($m_2$):** 中位数是第 $(10/2) = 5$ 个和第 $6$ 个值的平均值。所以，$m_2 = \\frac{15+18}{2} = 16.5$。\n- **四分位数 ($Q_{1,2}, Q_{3,2}$):** 对于偶数大小的样本，我们将数据分成相等的两半。\n  - 下半部分：$L_2 = \\{5, 8, 10, 12, 15\\}$。$L_2$ 的中位数是 $Q_{1,2} = 10$。\n  - 上半部分：$U_2 = \\{18, 22, 30, 45, 50000\\}$。$U_2$ 的中位数是 $Q_{3,2} = 30$。\n- **IQR规则上限 ($F_2$):**\n  - $\\mathrm{IQR}_2 = Q_{3,2} - Q_{1,2} = 30 - 10 = 20$。\n  - 上限 $F_2 = Q_{3,2} + 1.5 \\times \\mathrm{IQR}_2 = 30 + 1.5 \\times 20 = 30 + 30 = 60$。\n- **MAD规则上限 ($M_2$):**\n  - 与中位数 $m_2=16.5$ 的绝对偏差：$\\{|5-16.5|, ..., |50000-16.5|\\} = \\{11.5, 8.5, 6.5, 4.5, 1.5, 1.5, 5.5, 13.5, 28.5, 49983.5\\}$。\n  - 排序后的偏差：$\\{1.5, 1.5, 4.5, 5.5, 6.5, 8.5, 11.5, 13.5, 28.5, 49983.5\\}$。\n  - MAD是这些偏差的中位数：$\\mathrm{MAD}_2 = \\frac{6.5+8.5}{2} = 7.5$。\n  - MAD上限 $M_2 = m_2 + c \\times \\mathrm{MAD}_2 = 16.5 + 4 \\times 7.5 = 16.5 + 30 = 46.5$。\n\n### 步骤3：量化临界值的增量\n\n我们计算从基线样本到含误差样本中，每个临界值的变化量。\n- 基于IQR的上限增量：$\\Delta F = F_2 - F_1 = 60 - 51.5 = 8.5$。\n- 基于MAD的上限增量：$\\Delta M = M_2 - M_1 = 46.5 - 43 = 3.5$。\n\n### 步骤4：计算最终比率\n\n最后一步是计算 $1.5 \\times \\mathrm{IQR}$ 规则下的增量与基于MAD规则下的增量之比。\n比率 $= \\frac{\\Delta F}{\\Delta M} = \\frac{8.5}{3.5} = \\frac{17/2}{7/2} = \\frac{17}{7}$。\n\n将分数转换为小数约为 $2.4285714...$。四舍五入到四位有效数字，我们得到 $2.429$。\n这个结果表明，基于MAD的临界值比基于IQR的临界值要稳健得多（受单个极端异常值的影响小得多）。作为对同一个错误数据点的响应，基于IQR的临界值的增量大约是基于MAD的临界值增量的 $2.43$ 倍。",
            "answer": "$$\n\\boxed{2.429}\n$$"
        },
        {
            "introduction": "在掌握了离群点检测的基础后，我们来解决一个生物统计学中的常见挑战：计数数据（count data）的分析。对于细菌菌落计数这类数据，其变异程度（方差）往往会随着均值的增加而增加，这可能会破坏简单箱线图分析的潜在假设。本练习将展示一个有效的解决方案：在进行离群点检测之前，应用方差稳定变换（variance-stabilizing transformation）。你将通过推导并应用适合泊松分布数据的平方根变换，学习到一项在数据分析中不可或缺的预处理技能。",
            "id": "4898851",
            "problem": "一个实验室在相同的生长条件下，对一个细菌菌株的重复培养物进行平板菌落形成单位的量化。观测到的计数（每皿）为：$0$, $1$, $2$, $3$, $4$, $5$, $6$, $9$, $12$, $16$, $20$, $27$, $40$, $100$。在探索性生物统计分析中，箱形图通常用于异常值检测，但对于计数数据，其离散程度通常随均值的增加而增加。请仅使用可以被泊松模型很好地近似的计数数据的基础性质，首先推导一个适用于大计数的、合适的方差稳定单调变换 $g(y)$。然后，将此变换应用于给定数据，在变换后的尺度上构建一个箱形图，使用以下定义：第一四分位数 $Q_{1}$ 和第三四分位数 $Q_{3}$ 分别是排序后变换样本的下半部分和上半部分的中位数；对于偶数样本量 $n$，下半部分由前 $n/2$ 个观测值组成，上半部分由后 $n/2$ 个观测值组成，样本中位数是第 $n/2$ 个和第 $(n/2+1)$ 个观测值的平均值。将四分位距 (IQR) 定义为 $Q_{3}-Q_{1}$，并将上异常值界限定为 $Q_{3}+1.5 \\times \\mathrm{IQR}$。将此上界线反变换回原始计数尺度，并报告有多少原始观测值超过了这个反变换后的阈值。最终答案以单个整数形式给出，不带单位；不需要四舍五入。",
            "solution": "问题是使用基于方差稳定尺度的箱形图分析，在给定的细菌菌落计数数据集中识别异常值。该过程包括三个主要步骤：推导适当的变换，将其应用于数据，在变换后的尺度上计算异常值界限，然后将此界限反变换以识别原始数据中的异常值。\n\n### 步骤1：方差稳定变换的推导\n\n对于一个服从均值为 $\\lambda$ 的泊松分布的随机变量 $Y$，一个基本性质是其均值等于其方差：\n$$E[Y] = \\lambda$$\n$$\\mathrm{Var}(Y) = \\lambda$$\n目标是找到一个变换 $g(Y)$，使其方差近似为常数，而与均值 $\\lambda$ 无关。我们使用一阶泰勒级数展开（Delta方法）来近似 $g(Y)$ 的方差：\n$$\\mathrm{Var}(g(Y)) \\approx [g'(E[Y])]^2 \\mathrm{Var}(Y)$$\n代入泊松分布的性质（$E[Y]=\\lambda$ 和 $\\mathrm{Var}(Y)=\\lambda$）：\n$$\\mathrm{Var}(g(Y)) \\approx [g'(\\lambda)]^2 \\lambda$$\n为了稳定方差，我们要求右侧为一个常数，设为 $c^2$：\n$$[g'(\\lambda)]^2 \\lambda = c^2$$\n求解 $g'(\\lambda)$：\n$$g'(\\lambda) = \\frac{c}{\\sqrt{\\lambda}} = c\\lambda^{-1/2}$$\n为了找到函数 $g(\\lambda)$，我们对 $g'(\\lambda)$ 关于 $\\lambda$ 进行积分：\n$$g(\\lambda) = \\int c\\lambda^{-1/2} d\\lambda = c \\frac{\\lambda^{1/2}}{1/2} + K = 2c\\sqrt{\\lambda} + K$$\n其中 $K$ 是积分常数。方差稳定性质与常数 $c$ 和 $K$ 无关。为简单起见，我们可以选择 $2c=1$ 和 $K=0$。这给出了变换：\n$$g(y) = \\sqrt{y}$$\n这就是平方根变换，是泊松分布数据的标准方差稳定变换。\n\n### 步骤2：应用于数据和箱形图构建\n\n原始数据为：$y = \\{0, 1, 2, 3, 4, 5, 6, 9, 12, 16, 20, 27, 40, 100\\}$。\n样本量为 $n=14$，是偶数。\n我们将变换 $g(y) = \\sqrt{y}$ 应用于每个数据点。变换后排序的数据为：\n$$x = \\{\\sqrt{0}, \\sqrt{1}, \\sqrt{2}, \\sqrt{3}, \\sqrt{4}, \\sqrt{5}, \\sqrt{6}, \\sqrt{9}, \\sqrt{12}, \\sqrt{16}, \\sqrt{20}, \\sqrt{27}, \\sqrt{40}, \\sqrt{100}\\}$$\n$$x = \\{0, 1, \\sqrt{2}, \\sqrt{3}, 2, \\sqrt{5}, \\sqrt{6}, 3, \\sqrt{12}, 4, \\sqrt{20}, \\sqrt{27}, \\sqrt{40}, 10\\}$$\n根据问题对偶数样本量 $n=14$ 的定义，下半部分由前 $n/2 = 7$ 个观测值组成，上半部分由后 $n/2 = 7$ 个观测值组成。\n\n下半部分：$\\{0, 1, \\sqrt{2}, \\sqrt{3}, 2, \\sqrt{5}, \\sqrt{6}\\}$\n上半部分：$\\{3, \\sqrt{12}, 4, \\sqrt{20}, \\sqrt{27}, \\sqrt{40}, 10\\}$\n\n第一四分位数 $Q_1$ 是下半部分的中位数。由于下半部分有 $7$ 个（奇数）观测值，其中位数是中间值，即第 $4$ 个观测值。\n$$Q_1 = \\sqrt{3}$$\n第三四分位数 $Q_3$ 是上半部分的中位数。上半部分也有 $7$ 个观测值，所以其中位数是中间值，即该子集的第 $4$ 个观测值。\n$$Q_3 = \\sqrt{20}$$\n我们可以简化 $\\sqrt{20} = \\sqrt{4 \\times 5} = 2\\sqrt{5}$。\n所以，$Q_3 = 2\\sqrt{5}$。\n\n### 步骤3：异常值检测\n\n首先，我们在变换后的尺度上计算四分位距 (IQR)：\n$$\\mathrm{IQR} = Q_3 - Q_1 = 2\\sqrt{5} - \\sqrt{3}$$\n接下来，我们在变换后的尺度上计算上异常值界限。公式为 $Q_3 + 1.5 \\times \\mathrm{IQR}$。\n$$\\text{Upper Fence}_{\\text{transf}} = Q_3 + 1.5 \\times \\mathrm{IQR} = 2\\sqrt{5} + 1.5(2\\sqrt{5} - \\sqrt{3})$$\n$$\\text{Upper Fence}_{\\text{transf}} = 2\\sqrt{5} + 3\\sqrt{5} - 1.5\\sqrt{3} = 5\\sqrt{5} - 1.5\\sqrt{3}$$\n为了将此界限与原始数据进行比较，我们必须将其反变换回原始计数尺度。反变换为 $y = (g(y))^2$。\n$$\\text{Upper Fence}_{\\text{orig}} = (\\text{Upper Fence}_{\\text{transf}})^2 = (5\\sqrt{5} - 1.5\\sqrt{3})^2$$\n展开此表达式：\n$$\\text{Upper Fence}_{\\text{orig}} = (5\\sqrt{5})^2 - 2(5\\sqrt{5})(1.5\\sqrt{3}) + (1.5\\sqrt{3})^2$$\n$$\\text{Upper Fence}_{\\text{orig}} = (25 \\times 5) - (15\\sqrt{15}) + (2.25 \\times 3)$$\n$$\\text{Upper Fence}_{\\text{orig}} = 125 - 15\\sqrt{15} + 6.75$$\n$$\\text{Upper Fence}_{\\text{orig}} = 131.75 - 15\\sqrt{15}$$\n为了进行比较，我们近似其值。我们知道 $3.8^2 = 14.44$ 和 $3.9^2 = 15.21$，所以 $\\sqrt{15}$ 约等于 $3.87$。\n$$\\text{Upper Fence}_{\\text{orig}} \\approx 131.75 - 15(3.873) = 131.75 - 58.095 = 73.655$$\n最后一步是计算有多少原始观测值超过了这个反变换后的阈值。原始数据为：\n$$y = \\{0, 1, 2, 3, 4, 5, 6, 9, 12, 16, 20, 27, 40, 100\\}$$\n我们将每个值与大约 $73.655$ 的阈值进行比较。\n- 倒数第二个最大值是 $40$，小于 $73.655$。\n- 最后一个值是 $100$，大于 $73.655$。\n\n只有一个观测值 $100$ 超过了上异常值界限。因此，根据此方法，有 $1$ 个异常值。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "现在，让我们从描述单个数据集的特征，迈向比较两组数据，这是统计推断的核心任务之一。本练习将引入“缺口箱线图”（notched boxplot），其中位数周围的“缺口”提供了一个近似的置信区间，让我们可以进行直观的视觉推断。通过编程实现计算这些缺口并检查其是否重叠的逻辑，你将把一个描述性工具转变为一个用于比较中位数的推断性工具 。这个综合性练习将巩固你对箱线图所有组成部分的理解，并展示其在实际研究中的强大应用。",
            "id": "4898861",
            "problem": "您的任务是实现一个程序，该程序在一个基于稳健描述性统计的、连贯的算法框架内，使用带凹槽箱形图逻辑和 Tukey 离群点检测来比较两个独立的分组。目标是构建一个程序，对于每对分组，该程序能够构建基于四分位距的箱形图组件，检测离群点，基于大样本理论围绕样本中位数构建凹槽，并通过评估凹槽是否重叠来判断各组的中位数是否存在显著差异。所有计算都必须源自基本定义和经过充分检验的渐近结果，除了基本的数值运算外，不得依赖任何预封装的高级例程。\n\n使用的基础理论如下：\n- 样本是实数观测值的独立同分布集合 $\\{x_i\\}_{i=1}^n$。\n- 样本中位数 $\\tilde{x}$ 是 $p = 0.5$ 的分位数。第一四分位数 $Q_1$ 和第三四分位数 $Q_3$ 分别是 $p = 0.25$ 和 $p = 0.75$ 的分位数。\n- 分位数必须通过顺序统计量之间的线性插值来计算（这是一种广泛使用、经过充分检验的定义）。具体来说，对于一个大小为 $n$ 的样本，设排序后的顺序统计量为 $x_{(1)} \\le \\cdots \\le x_{(n)}$。对于概率 $p \\in [0,1]$，定义 $h = (n-1)p + 1$，$k = \\lfloor h \\rfloor$，以及 $\\gamma = h - k$。然后设置\n$$\nQ(p) =\n\\begin{cases}\nx_{(k)},  \\text{if } \\gamma = 0, \\\\\n(1 - \\gamma)\\, x_{(k)} + \\gamma\\, x_{(k+1)},  \\text{if } \\gamma \\in (0,1).\n\\end{cases}\n$$\n使用此定义计算 $p \\in \\{0.25, 0.5, 0.75\\}$ 时的 $Q_1$、$\\tilde{x}$ 和 $Q_3$。\n- 四分位距 (IQR) 是 $\\mathrm{IQR} = Q_3 - Q_1$。\n- Tukey 的 $1.5$ 倍四分位距离群点规则使用下界和上界 $L = Q_1 - 1.5\\,\\mathrm{IQR}$ 和 $U = Q_3 + 1.5\\,\\mathrm{IQR}$。满足 $x_i  L$ 或 $x_i > U$ 的观测值 $x_i$ 是离群点。箱须被定义为大于等于 $L$ 的最小观测值和小于等于 $U$ 的最大观测值。\n- 对于大样本，样本中位数 $\\tilde{x}$ 渐近服从正态分布，其方差为 $\\mathrm{Var}(\\tilde{x}) \\approx \\frac{1}{4n f(m)^2}$，其中 $m$ 是总体中位数，$f(m)$ 是连续密度在 $m$ 处的值。这导致围绕 $\\tilde{x}$ 的置信区间的半宽度与 $\\frac{1}{\\sqrt{n} f(m)}$ 成正比。为了在箱形图中操作化凹槽，请使用四分位距 (IQR) 作为稳健的尺度代理，并推导一个显式常数，该常数在表现良好的分布下将凹槽半宽度校准为中位数的一个实用区间。您必须基于 $\\tilde{x}$ 的渐近正态性，并在正态校准下使用 $\\mathrm{IQR}$ 进行稳健替代，以确定形式为 $c \\cdot \\mathrm{IQR}/\\sqrt{n}$ 的凹槽半宽度，其中 $c$ 是 Tukey 带凹槽箱形图中常规使用的常数。您的程序必须在推导后实现这个常规常数。\n\n对于每对分组 $(A,B)$，程序必须：\n- 使用上述分位数定义为每个分组计算 $Q_1$、$\\tilde{x}$、$Q_3$ 和 $\\mathrm{IQR}$。\n- 计算界限 $L$ 和 $U$，根据 Tukey 规则识别离群点，并将箱须端点确定为最极端的非离群值。\n- 为每个分组计算凹槽，形式为 $[\\tilde{x} - c \\cdot \\mathrm{IQR}/\\sqrt{n},\\ \\tilde{x} + c \\cdot \\mathrm{IQR}/\\sqrt{n}]$，使用您从上述第一性原理和惯例中推导出的常数 $c$。\n- 判断两个凹槽是否重叠。定义一个布尔输出 $\\mathrm{DiffMed}$，如果凹槽不重叠，则为 $\\mathrm{True}$（在带凹槽箱形图启发式方法中解释为中位数存在差异的证据），否则为 $\\mathrm{False}$。\n\n您的程序必须处理以下分组对的测试套件。每个分组都以实数列表的形式明确给出：\n\n- 测试用例 1：\n  - $A_1 = [$ $118$, $121$, $119$, $122$, $120$, $123$, $117$, $124$, $119$, $121$, $120$, $122$, $118$, $125$, $119$, $121$, $120$, $123$, $118$, $122$ $]$\n  - $B_1 = [$ $98$, $100$, $101$, $99$, $102$, $97$, $103$, $100$, $99$, $98$, $101$, $97$, $104$, $100$, $98$, $102$, $99$, $101$, $100$, $98$ $]$\n\n- 测试用例 2：\n  - $A_2 = [$ $10$, $12$, $11$, $15$, $14$, $13$, $16$, $17$, $12$, $14$, $15$, $13$, $12$, $14$, $13$, $50$ $]$\n  - $B_2 = [$ $12$, $14$, $13$, $16$, $15$, $14$, $17$, $18$, $13$, $15$, $16$, $14$, $13$, $15$, $-5$, $14$ $]$\n\n- 测试用例 3：\n  - $A_3 = [$ $1$, $2$, $3$, $4$, $5$ $]$\n  - $B_3 = [$ $6$, $7$, $8$, $9$, $10$ $]$\n\n- 测试用例 4：\n  - $A_4 = [$ $0.1$, $0.2$, $0.3$, $0.5$, $0.8$, $1.0$, $0.4$, $0.6$, $0.7$, $5.0$, $6.0$ $]$\n  - $B_4 = [$ $0.2$, $0.3$, $0.4$, $0.5$, $1.5$, $1.6$, $1.7$, $2.0$, $2.2$, $2.5$ $]$\n\n- 测试用例 5（一个分组的 $\\mathrm{IQR} = 0$ 的边界情况）：\n  - $A_5 = [$ $5$, $5$, $5$, $5$, $5$, $5$ $]$\n  - $B_5 = [$ $5$, $5$, $5$, $5$, $10$, $5$ $]$\n\n对于每个测试用例 $t \\in \\{1,2,3,4,5\\}$，您的程序必须输出一个列表\n$[\\mathrm{DiffMed}_t,\\ \\mathrm{OutA}_t,\\ \\mathrm{OutB}_t,\\ [W^{A}_{L,t}, W^{A}_{U,t}],\\ [W^{B}_{L,t}, W^{B}_{U,t}]]$\n其中：\n- $\\mathrm{DiffMed}_t$ 是一个布尔值，如果凹槽不重叠则为 $\\mathrm{True}$，否则为 $\\mathrm{False}$，\n- $\\mathrm{OutA}_t$ 和 $\\mathrm{OutB}_t$ 是根据 Tukey 的 $1.5$ 倍规则在分组 $A_t$ 和 $B_t$ 中离群点的整数计数，\n- $W^{A}_{L,t}$ 和 $W^{A}_{U,t}$ 是 $A_t$ 的下箱须和上箱须端点，\n- $W^{B}_{L,t}$ 和 $W^{B}_{U,t}$ 是 $B_t$ 的下箱须和上箱须端点。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含所有五个测试用例的结果，格式为一个以逗号分隔的顶级列表，每个元素是每个用例的列表，形式完全如下\n$[[\\mathrm{DiffMed}_1,\\ \\mathrm{OutA}_1,\\ \\mathrm{OutB}_1,\\ [W^{A}_{L,1}, W^{A}_{U,1}],\\ [W^{B}_{L,1}, W^{B}_{U,1}]],\\ \\ldots,\\ [\\mathrm{DiffMed}_5,\\ \\mathrm{OutA}_5,\\ \\mathrm{OutB}_5,\\ [W^{A}_{L,5}, W^{A}_{U,5}],\\ [W^{B}_{L,5}, W^{B}_{U,5}]]]$\n不含任何额外文本。\n\n此问题不涉及任何物理单位、角度单位或百分比。所有输出必须是指定的原始数字和布尔值。",
            "solution": "所述问题是有效的。它在科学上基于描述性统计和假设检验的原理，问题陈述清晰，有明确的算法路径可通向唯一解，并且客观地表达，提供了所有必要的数据和定义。我们将着手提供一个解决方案。\n\n任务是实现一个统计程序，使用带凹槽箱形图的逻辑来比较两个独立的分组 $A$ 和 $B$。这涉及对每个分组进行几个计算步骤：计算四分位数，通过 Tukey 方法识别离群点，确定箱须长度，以及计算围绕中位数的置信区间（凹槽）。最终判断分组中位数是否不同的依据是这些凹槽是否重叠。\n\n### 第一部分：箱形图组件和离群点检测\n\n箱形图的基础在于样本的四分位数。给定一个包含 $n$ 个观测值的样本 $\\{x_i\\}_{i=1}^n$，我们首先得到顺序统计量 $x_{(1)} \\le x_{(2)} \\le \\cdots \\le x_{(n)}$。问题指定了一种通过线性插值计算第 $p$ 个分位数 $Q(p)$ 的精确方法。对于概率 $p \\in [0,1]$，我们定义一个索引 $h = (n-1)p + 1$。令 $k = \\lfloor h \\rfloor$ 为 $h$ 的整数部分，$\\gamma = h - k$ 为其小数部分。分位数 $Q(p)$ 则由下式给出：\n$$\nQ(p) = (1 - \\gamma) x_{(k)} + \\gamma x_{(k+1)}\n$$\n将此公式应用于 $p \\in \\{0.25, 0.5, 0.75\\}$，以分别求得第一四分位数（$Q_1$）、样本中位数（$\\tilde{x}$）和第三四分位数（$Q_3$）。\n\n根据这些四分位数，我们定义四分位距（$\\mathrm{IQR}$）作为统计离散度的稳健度量：\n$$\n\\mathrm{IQR} = Q_3 - Q_1\n$$\n然后，根据 Tukey 的 $1.5 \\times \\mathrm{IQR}$ 规则，使用 $\\mathrm{IQR}$ 来定义用于离群点检测的界限。下界 $L$ 和上界 $U$ 分别是：\n$$\nL = Q_1 - 1.5 \\cdot \\mathrm{IQR}\n$$\n$$\nU = Q_3 + 1.5 \\cdot \\mathrm{IQR}\n$$\n任何满足 $x_i  L$ 或 $x_i > U$ 的观测值 $x_i$ 都被归类为离群点。\n\n箱形图的“箱须”延伸到非离群点的最极端数据点。下箱须端点 $W_L$ 是样本中大于或等于 $L$ 的最小观测值。上箱须端点 $W_U$ 是小于或等于 $U$ 的最大观测值。\n$$\nW_L = \\min\\{x_i \\mid x_i \\ge L\\}\n$$\n$$\nW_U = \\max\\{x_i \\mid x_i \\le U\\}\n$$\n\n### 第二部分：凹槽区间的推导与实现\n\n箱形图中的凹槽为总体中位数提供了一个近似的置信区间，这有助于对不同分组进行视觉比较。该凹槽的半宽度被指定为 $c \\cdot \\mathrm{IQR}/\\sqrt{n}$ 的形式，其中 $c$ 是一个常数。我们的任务是推导这个常数背后的原理。\n\n推导始于样本中位数 $\\tilde{x}$ 的渐近分布。对于从具有概率密度函数 $f(x)$ 和总体中位数 $m$ 的连续分布中抽取的大样本，样本中位数近似服从正态分布：\n$$\n\\tilde{x} \\sim \\mathcal{N}\\left(m, \\frac{1}{4n [f(m)]^2}\\right)\n$$\n因此，中位数的标准误为 $\\mathrm{SE}(\\tilde{x}) \\approx \\frac{1}{2\\sqrt{n}f(m)}$。\n\n为了使这个公式具有实用性，我们需要从样本中估计 $f(m)$。问题指导我们采用“正态校准”方法，即我们使用正态分布 $N(\\mu, \\sigma^2)$ 中 $f(m)$ 和 $\\mathrm{IQR}$ 之间的关系作为参考。\n对于正态分布，中位数 $m$ 等于均值 $\\mu$，而中位数处的密度为 $f(m) = f(\\mu) = \\frac{1}{\\sigma\\sqrt{2\\pi}}$。理论上的四分位数通过 $Q_1 = \\mu - z_{0.25}\\sigma$ 和 $Q_3 = \\mu + z_{0.25}\\sigma$ 与标准差 $\\sigma$ 相关，其中 $z_{0.25} = \\Phi^{-1}(0.75) \\approx 0.6745$。理论上的四分位距为 $\\mathrm{IQR}_{\\text{normal}} = Q_3 - Q_1 = 2 z_{0.25}\\sigma \\approx 1.349\\sigma$。\n由此，我们可以用 $\\mathrm{IQR}$ 来表示 $\\sigma$ 以及随后的 $f(m)$：\n$$\n\\sigma \\approx \\frac{\\mathrm{IQR}_{\\text{normal}}}{1.349} \\quad \\implies \\quad f(m) \\approx \\frac{1}{(\\mathrm{IQR}_{\\text{normal}}/1.349)\\sqrt{2\\pi}} = \\frac{1.349}{\\mathrm{IQR}_{\\text{normal}}\\sqrt{2\\pi}}\n$$\n将此代入标准误公式，并用样本 $\\mathrm{IQR}$ 替换理论上的 $\\mathrm{IQR}_{\\text{normal}}$：\n$$\n\\mathrm{SE}(\\tilde{x}) \\approx \\frac{1}{2\\sqrt{n}} \\left( \\frac{\\mathrm{IQR}\\sqrt{2\\pi}}{1.349} \\right) = \\left( \\frac{\\sqrt{2\\pi}}{2 \\cdot 1.349} \\right) \\frac{\\mathrm{IQR}}{\\sqrt{n}} \\approx 0.925 \\frac{\\mathrm{IQR}}{\\sqrt{n}}\n$$\n凹槽半宽度 $H$ 定义为 $H = c \\cdot \\mathrm{IQR}/\\sqrt{n}$。比较两个分组 $A$ 和 $B$ 的启发式规则是，如果它们的凹槽不重叠，即 $|\\tilde{x}_A - \\tilde{x}_B| > H_A + H_B$，则认为它们的中位数不同。这种视觉检验旨在近似一个关于中位数差异的正式假设检验，在该检验中，如果 $|\\tilde{x}_A - \\tilde{x}_B| > z_{\\alpha/2} \\mathrm{SE}(\\tilde{x}_A - \\tilde{x}_B)$，则会拒绝中位数相等的原假设。\n\n在 $n_A \\approx n_B$ 和 $\\mathrm{IQR}_A \\approx \\mathrm{IQR}_B$ 的简化假设下，将这两个标准等同起来可以得到 $c$ 的值。然而，问题承认在实践中会使用一个特定的常规常数。这个常数 $c \\approx 1.57$ 源于 McGill、Tukey 和 Larsen (1978) 的基础性工作及后续的改进。它旨在为比较各种分布形状和样本大小下的中位数提供一个稳健的视觉检验。此推导展示了统计基础，但简单的推理路线无法完全复现这个精确值，因为它考虑了简单正态校准之外的因素。按照指示，我们将使用常规常数 $c = 1.57$。\n\n因此，给定分组的凹槽计算为以下区间：\n$$\n\\left[ \\tilde{x} - 1.57 \\frac{\\mathrm{IQR}}{\\sqrt{n}}, \\quad \\tilde{x} + 1.57 \\frac{\\mathrm{IQR}}{\\sqrt{n}} \\right]\n$$\n当 $\\mathrm{IQR}=0$ 时会出现一种特殊情况。在这种情况下，凹槽半宽度为 $0$，凹槽收缩为中位数上的一个单点。\n\n### 第三部分：算法流程\n\n对于每对分组 ($A_t, B_t$)，算法如下：\n1.  对于每个分组，从输入列表中创建一个数值数组并对其进行排序。设其大小为 $n$。\n2.  使用指定的分位数插值公式计算 $Q_1$、$\\tilde{x}$ 和 $Q_3$。这可以通过使用 `numpy.quantile` 并设置 `interpolation='linear'` 来实现。\n3.  计算 $\\mathrm{IQR} = Q_3 - Q_1$。\n4.  处理 $\\mathrm{IQR}=0$ 的情况：\n    - 下界和上界为 $L=U=\\tilde{x}$。\n    - 离群点是任何不等于 $\\tilde{x}$ 的点。\n    - 箱须端点均等于 $\\tilde{x}$。\n    - 凹槽是区间 $[\\tilde{x}, \\tilde{x}]$。\n5.  如果 $\\mathrm{IQR}>0$：\n    - 计算界限 $L = Q_1 - 1.5 \\cdot \\mathrm{IQR}$ 和 $U = Q_3 + 1.5 \\cdot \\mathrm{IQR}$。\n    - 统计满足 $x_i  L$ 或 $x_i > U$ 的数据点数量。\n    - 通过取非离群数据点的最小值和最大值来找到箱须端点。\n    - 计算凹槽半宽度 $H = 1.57 \\cdot \\mathrm{IQR} / \\sqrt{n}$ 并形成凹槽区间 $[\\tilde{x} - H, \\tilde{x} + H]$。\n6.  比较分组 $A$ 和 $B$ 的凹槽区间，即 $[\\text{lower}_A, \\text{upper}_A]$ 和 $[\\text{lower}_B, \\text{upper}_B]$。布尔变量 $\\mathrm{DiffMed}$ 在凹槽不重叠时为 $\\mathrm{True}$，即当 $\\text{upper}_A  \\text{lower}_B$ 或 $\\text{upper}_B  \\text{lower}_A$ 时。否则，$\\mathrm{DiffMed}$ 为 $\\mathrm{False}$。\n7.  将测试用例 $t$ 的结果收集到指定的列表格式中：$[\\mathrm{DiffMed}_t,\\ \\mathrm{OutA}_t,\\ \\mathrm{OutB}_t,\\ [W^{A}_{L,t}, W^{A}_{U,t}],\\ [W^{B}_{L,t}, W^{B}_{U,t}]]$。\n8.  对所有测试用例重复此过程，并以列表的列表形式呈现最终输出。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_boxplot_stats(data_list):\n    \"\"\"\n    Computes all necessary statistics for a notched boxplot for a single data group.\n\n    Args:\n        data_list: A list of numerical data.\n\n    Returns:\n        A dictionary containing outlier count, whisker endpoints, and the notch interval.\n    \"\"\"\n    if not data_list:\n        return {\n            \"outliers_count\": 0,\n            \"whiskers\": [np.nan, np.nan],\n            \"notch\": [np.nan, np.nan],\n        }\n\n    data = np.array(data_list, dtype=float)\n    n = len(data)\n\n    # Step 1: Calculate Quantiles using linear interpolation\n    q1, median, q3 = np.quantile(data, [0.25, 0.5, 0.75], interpolation='linear')\n    \n    # Step 2: Calculate IQR and handle the IQR = 0 case\n    iqr = q3 - q1\n\n    if iqr == 0:\n        # Fences are at the quartiles themselves\n        lower_fence = q1\n        upper_fence = q3\n        \n        # Outliers are points not equal to the median (since Q1=Q3=median)\n        outliers_count = np.sum(data != median)\n        \n        # Whiskers collapse to the median\n        # If there are non-outlying points, whiskers are min/max of them.\n        # If all points are outliers (not possible if n > 0 and iqr=0), this would be tricky.\n        # But here, non-outlying points exist (those equal to the median).\n        non_outliers = data[data == median]\n        if non_outliers.size > 0:\n            whiskers = [np.min(non_outliers), np.max(non_outliers)]\n        else: # Should not happen with IQR=0 unless data is empty\n            whiskers = [np.nan, np.nan]\n\n        # Notch width is zero\n        notch = [median, median]\n    else:\n        # Step 3: Define Fences for outlier detection\n        lower_fence = q1 - 1.5 * iqr\n        upper_fence = q3 + 1.5 * iqr\n\n        # Step 4: Identify and count outliers\n        outliers_mask = (data  lower_fence) | (data > upper_fence)\n        outliers_count = int(np.sum(outliers_mask))\n\n        # Step 5: Determine Whisker endpoints\n        non_outliers = data[~outliers_mask]\n        if non_outliers.size > 0:\n            whiskers = [np.min(non_outliers), np.max(non_outliers)]\n        else: # This can happen if all points are outliers\n            whiskers = [np.nan, np.nan]\n\n\n        # Step 6: Compute Notch interval\n        notch_constant = 1.57\n        notch_half_width = notch_constant * iqr / np.sqrt(n)\n        notch = [median - notch_half_width, median + notch_half_width]\n\n    return {\n        \"outliers_count\": outliers_count,\n        \"whiskers\": list(whiskers),\n        \"notch\": notch,\n    }\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases and print the final result.\n    \"\"\"\n    test_cases = [\n        {\n            \"A\": [118, 121, 119, 122, 120, 123, 117, 124, 119, 121, 120, 122, 118, 125, 119, 121, 120, 123, 118, 122],\n            \"B\": [98, 100, 101, 99, 102, 97, 103, 100, 99, 98, 101, 97, 104, 100, 98, 102, 99, 101, 100, 98],\n        },\n        {\n            \"A\": [10, 12, 11, 15, 14, 13, 16, 17, 12, 14, 15, 13, 12, 14, 13, 50],\n            \"B\": [12, 14, 13, 16, 15, 14, 17, 18, 13, 15, 16, 14, 13, 15, -5, 14],\n        },\n        {\n            \"A\": [1, 2, 3, 4, 5],\n            \"B\": [6, 7, 8, 9, 10],\n        },\n        {\n            \"A\": [0.1, 0.2, 0.3, 0.5, 0.8, 1.0, 0.4, 0.6, 0.7, 5.0, 6.0],\n            \"B\": [0.2, 0.3, 0.4, 0.5, 1.5, 1.6, 1.7, 2.0, 2.2, 2.5],\n        },\n        {\n            \"A\": [5, 5, 5, 5, 5, 5],\n            \"B\": [5, 5, 5, 5, 10, 5],\n        },\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        stats_A = calculate_boxplot_stats(case[\"A\"])\n        stats_B = calculate_boxplot_stats(case[\"B\"])\n        \n        # Determine if notches overlap\n        # Notches are [lower_A, upper_A] and [lower_B, upper_B]\n        # No overlap if upper_A  lower_B or upper_B  lower_A\n        notch_A = stats_A[\"notch\"]\n        notch_B = stats_B[\"notch\"]\n        \n        diff_med = (notch_A[1]  notch_B[0]) or (notch_B[1]  notch_A[0])\n        \n        result = [\n            diff_med,\n            stats_A[\"outliers_count\"],\n            stats_B[\"outliers_count\"],\n            stats_A[\"whiskers\"],\n            stats_B[\"whiskers\"],\n        ]\n        all_results.append(result)\n        \n    # Format the final output string\n    # Using a direct string conversion to match the required format precisely\n    output_str = \"[\" + \", \".join(str(r) for r in all_results) + \"]\"\n    \n    print(output_str)\n\nsolve()\n```"
        }
    ]
}