{
    "hands_on_practices": [
        {
            "introduction": "全表型组关联研究 (PheWAS) 的基石是利用电子健康记录 (EHR) 数据准确定义表型，这通常通过称为 PheCodes 的算法实现。在检验遗传关联之前，必须对这些算法进行验证，以确保它们能准确识别患者 。本练习着重于验证的一个核心环节：计算图表审查所需的样本量，以便在给定的置信水平下估算阳性预测值 (PPV)。",
            "id": "5071597",
            "problem": "一个正在进行表型组关联研究（Phenome-Wide Association Study, PheWAS）的研究团队，计划验证从电子健康记录（Electronic Health Record, EHR）中提取的特定PheCode的阳性预测值（positive predictive value, PPV）。表型组关联研究（PheWAS）是指扫描多种表型以寻找与某一遗传变异的关联。该PheCode将个体标记为感兴趣表型的潜在病例。在一项使用病历审查的验证性研究中，每位被标记个体的病历都将被审查，以确认该表型是否真实存在。设真实的PPV为概率 $p=\\Pr(\\text{true phenotype} \\mid \\text{PheCode flagged})$。假设病历是通过简单随机抽样从被标记的个体集合中抽取的，病历审查是独立的，并且每次审查产生一个二元结果 $\\{0,1\\}$，分别表示假阳性或真实病例，这被建模为成功概率为 $p$ 的独立同分布伯努利试验。\n\n您需要设计验证部分，并计算估算 $p$ 所需的最小病历审查数量，要求其双侧 $95\\%$ 置信区间的半宽为 $\\pm 0.05$。在您的设计中，请使用基于中心极限定理的样本比例渐近正态近似法，并将预期的PPV $0.8$ 作为规划值。将置信区间视为围绕估计量对称，并基于规划值而非未知的 $p$ 来确定精度。\n\n在这些假设下，请从第一性原理推导样本量要求，然后计算所需的最小整数病历审查数量，以使置信区间半宽至多为 $0.05$。将最终数值答案报告为满足该标准的最小整数。不需要单位，除了选择最小整数外，也不需要对有效数字进行四舍五入。",
            "solution": "该问题要求计算验证性研究所需的最小样本量。首先对问题陈述进行严格的验证过程。\n\n### 步骤1：提取已知条件\n- **目标**：验证一个PheCode的阳性预测值（PPV）。\n- **PPV的定义**：$p=\\Pr(\\text{true phenotype} \\mid \\text{PheCode flagged})$。\n- **抽样模型**：从被标记的个体中进行病历的简单随机抽样。\n- **统计模型**：病历审查是独立同分布的伯努利试验。\n- **试验结果**：一个二元结果 $\\{0,1\\}$，分别表示假阳性或真实病例。\n- **感兴趣的参数**：伯努利试验的成功概率 $p$。\n- **估计目标**：计算估计 $p$ 所需的最小病历审查数量 $n$。\n- **置信区间**：一个针对 $p$ 的双侧 $95\\%$ 置信区间。\n- **所需精度**：置信区间的半宽必须至多为 $0.05$。\n- **方法论**：对样本比例使用渐近正态近似法。\n- **规划值**：预期的PPV取为 $p_{plan} = 0.8$。\n- **计算约束**：精度基于规划值 $p_{plan}$，而非未知的真实 $p$。\n- **最终答案要求**：满足标准的最小整数病历审查数量。\n\n### 步骤2：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n- **科学依据**：该问题在标准生物统计学理论中有充分的依据。它描述了医学信息学和临床研究中的一个常见场景：为以指定精度估计一个比例（特别是阳性预测值）而进行的样本量计算。使用正态近似二项分布是中心极限定理证明的一种标准技术。\n- **适定性**：该问题是适定的。它明确定义了待估参数（$p$）、期望的置信水平（$95\\%$）、最大可接受的半宽（$0.05$）、统计模型（伯努利试验）、近似方法（正态近似）以及参数的规划值（$0.8$）。这些要素足以确定一个唯一的最小整数样本量。\n- **客观性**：该问题以客观、定量的术语陈述，没有歧义或主观内容。\n\n该问题没有任何无效性缺陷。它是科学合理的、可形式化的、完整的、现实的且适定的。\n\n### 步骤3：结论与行动\n问题被判定为**有效**。将按要求从第一性原理推导解决方案。\n\n### 求解推导\n设 $n$ 为将要进行的病历审查次数。每次审查被建模为一个伯努利试验。设 $X_i$ 为表示第 $i$ 次审查结果的随机变量，其中 $i = 1, 2, \\ldots, n$。如果病历代表一个真实病例（成功），则 $X_i = 1$；如果是一个假阳性（失败），则 $X_i = 0$。这些试验是独立同分布的，其概率为 $\\Pr(X_i = 1) = p$，其中 $p$ 是真实的PPV。\n\n$p$ 的估计量是样本比例 $\\hat{p}$，定义为：\n$$ \\hat{p} = \\frac{1}{n} \\sum_{i=1}^{n} X_i $$\n\n根据中心极限定理，对于足够大的样本量 $n$，$\\hat{p}$ 的抽样分布近似为正态分布：\n$$ \\hat{p} \\approx \\mathcal{N}\\left(\\mu_{\\hat{p}}, \\sigma_{\\hat{p}}^2\\right) $$\n其中均值为 $\\mu_{\\hat{p}} = E[\\hat{p}] = p$，方差为 $\\sigma_{\\hat{p}}^2 = \\text{Var}(\\hat{p}) = \\frac{p(1-p)}{n}$。\n\n基于正态近似的 $p$ 的一个双侧 $100(1-\\alpha)\\%$ 置信区间由下式给出：\n$$ \\hat{p} \\pm z_{1-\\alpha/2} \\sqrt{\\frac{\\hat{p}(1-\\hat{p})}{n}} $$\n其中 $z_{1-\\alpha/2}$ 是标准正态分布的分位数，其左侧面积为 $1-\\alpha/2$。\n\n该置信区间的半宽为 $W = z_{1-\\alpha/2} \\sqrt{\\frac{\\hat{p}(1-\\hat{p})}{n}}$。为了规划（即在收集数据之前计算所需的样本量 $n$），样本比例 $\\hat{p}$ 是未知的。问题指定我们应该使用规划值 $p_{plan} = 0.8$ 来代替它。因此，所需半宽的公式变为：\n$$ W = z_{1-\\alpha/2} \\sqrt{\\frac{p_{plan}(1-p_{plan})}{n}} $$\n\n我们有以下给定要求：\n- 置信水平为 $95\\%$，所以 $1-\\alpha = 0.95$，这意味着 $\\alpha = 0.05$。\n- 临界值为 $z_{1-\\alpha/2} = z_{1-0.025} = z_{0.975}$。$z_{0.975}$ 的标准值约为 $1.96$。\n- 最大可接受半宽为 $W = 0.05$。\n- 比例的规划值为 $p_{plan} = 0.8$。\n\n我们需要找到满足不等式 $W \\le 0.05$ 的最小整数 $n$：\n$$ z_{1-\\alpha/2} \\sqrt{\\frac{p_{plan}(1-p_{plan})}{n}} \\le 0.05 $$\n\n代入已知值：\n$$ 1.96 \\sqrt{\\frac{0.8(1-0.8)}{n}} \\le 0.05 $$\n$$ 1.96 \\sqrt{\\frac{0.8(0.2)}{n}} \\le 0.05 $$\n$$ 1.96 \\sqrt{\\frac{0.16}{n}} \\le 0.05 $$\n\n为了解出 $n$，我们整理不等式：\n$$ \\sqrt{\\frac{0.16}{n}} \\le \\frac{0.05}{1.96} $$\n对不等式两边平方：\n$$ \\frac{0.16}{n} \\le \\left(\\frac{0.05}{1.96}\\right)^2 $$\n现在，我们求解 $n$：\n$$ n \\ge 0.16 \\left(\\frac{1.96}{0.05}\\right)^2 $$\n首先，计算括号中的项：\n$$ \\frac{1.96}{0.05} = 39.2 $$\n然后，对该值进行平方：\n$$ (39.2)^2 = 1536.64 $$\n最后，乘以 $0.16$：\n$$ n \\ge 0.16 \\times 1536.64 $$\n$$ n \\ge 245.8624 $$\n由于病历审查次数 $n$ 必须是整数，我们必须取大于或等于 $245.8624$ 的最小整数。这通过对计算值取上整得到：\n$$ n_{min} = \\lceil 245.8624 \\rceil = 246 $$\n因此，为达到所需精度，至少需要进行 $246$ 次病历审查。",
            "answer": "$$\n\\boxed{246}\n$$"
        },
        {
            "introduction": "PheWAS 经常检验与罕见遗传变异的关联，而这些变异仅由少数个体携带。这种稀有性可能会导致统计问题，例如“完全分离”，此时标准回归模型会失效 。本练习通过首先计算罕见纯合子的期望数量来探讨这个问题，然后讨论为什么像 Firth 校正这样的专门方法对于稳健的分析是必要的。",
            "id": "5071604",
            "problem": "全表型组关联研究（PheWAS）系统性地检验大量临床表型与遗传变异的关联，以描述遗传效应的表型谱。考虑一个二倍体群体中的双等位基因座，在一个包含 $N=200{,}000$ 个来自单一祖源群体的无亲缘关系个体的样本中，其次要等位基因频率为 $p=0.01$。假设随机交配且满足哈迪-温伯格平衡（HWE）条件，并且个体是从群体中独立抽样的。仅使用群体遗传学的核心定义（等位基因频率和配子随机结合形成基因型）以及期望计数等于样本量乘以相应群体频率这一事实，推导在完整样本中次要等位基因纯合子的期望数量，并根据给定的 $p$ 和 $N$ 计算其值。然后，使用记为 $\\pi$ 的病例患病率，对于在 PheWAS 中检验的任意二元表型，解释在表型分层中次要等位基因纯合子的稀缺性如何导致逻辑斯蒂回归模型中出现准分离或完全分离，并说明为何在许多表型中通常需要使用减少偏差的惩罚似然（Firth 校正）。报告完整样本中次要等位基因纯合子的期望数量作为你的最终数值答案。无需四舍五入，并以精确整数形式表示最终答案。",
            "solution": "所述问题是有效的。它在科学上基于群体遗传学和统计遗传学的既定原则，问题陈述清晰，提供了所有必要信息，并以客观、正式的语言表达。我们可以继续进行解答。\n\n该问题要求三部分内容：首先，推导次要等位基因纯合子的期望数量；其次，根据给定参数计算该值；第三，解释全表型组关联研究（PheWAS）中的一个相关统计问题。\n\n首先，我们进行推导。问题指定了一个二倍体群体中的双等位基因座。设两个等位基因为 $A_1$（主要等位基因）和 $A_2$（次要等位基因）。次要等位基因 $A_2$ 的频率给定为 $p$。主要等位基因 $A_1$ 的频率可以记为 $q$。由于该基因座只有两个等位基因，它们的频率之和必须为 $1$。\n$$p + q = 1$$\n问题说明要假设随机交配和哈迪-温伯格平衡（HWE）条件。在 HWE 条件下，群体中三种可能基因型（$A_1A_1$、$A_1A_2$ 和 $A_2A_2$）的频率由等位基因频率根据二项式展开 $(p+q)^2 = p^2 + 2pq + q^2 = 1$ 决定。每种基因型的频率源于群体基因库中配子的随机结合。\n主要等位基因纯合子（$A_1A_1$）的频率为 $f(A_1A_1) = q^2 = (1-p)^2$。\n杂合子（$A_1A_2$）的频率为 $f(A_1A_2) = 2pq = 2p(1-p)$。\n次要等位基因纯合子（$A_2A_2$）的频率为 $f(A_2A_2) = p^2$。\n\n问题要求推导在一个大小为 $N$ 的样本中次要等位基因纯合子的期望数量。样本中任何基因型的期望计数是样本量与该基因型群体频率的乘积。设 $E[n_{A_2A_2}]$ 表示次要等位基因纯合子的期望数量。\n$$E[n_{A_2A_2}] = N \\times f(A_2A_2)$$\n代入次要等位基因纯合子的 HWE 频率，我们得到推导出的公式：\n$$E[n_{A_2A_2}] = N p^2$$\n\n其次，我们使用提供的数据计算数值：样本量为 $N=200,000$，次要等位基因频率为 $p=0.01$。\n$$E[n_{A_2A_2}] = 200,000 \\times (0.01)^2$$\n我们计算各项：\n$$(0.01)^2 = (1 \\times 10^{-2})^2 = 1 \\times 10^{-4}$$\n$$E[n_{A_2A_2}] = (2 \\times 10^5) \\times (1 \\times 10^{-4}) = 2 \\times 10^{5-4} = 2 \\times 10^1 = 20$$\n因此，整个样本中次要等位基因纯合子的期望数量是 $20$。\n\n第三，我们解释其对 PheWAS 的统计学意义。在 PheWAS 中，会检验许多表型中每一个与遗传变异的关联。对于二元表型（例如，疾病的有/无），这通常通过逻辑斯蒂回归来完成。一个常见的模型是：\n$$\\text{logit}(P(\\text{phenotype})) = \\beta_0 + \\beta_1 \\cdot G + \\text{covariates}$$\n其中 $G$ 是一个代表基因型的变量，通常编码为次要等位基因的数量（$A_1A_1$ 为 $0$， $A_1A_2$ 为 $1$，$A_2A_2$ 为 $2$）。\n\n总样本量为 $N$ 的样本被分为病例（具有该表型的个体）和对照（不具有该表型的个体）。设表型患病率为 $\\pi$。病例数约为 $N\\pi$，对照数约为 $N(1-\\pi)$。\n我们计算出的次要等位基因纯合子（$A_2A_2$）的期望数量仅为 $20$。这 $20$ 个个体分布在病例组和对照组之间。病例中 $A_2A_2$ 个体的期望数量为 $E[n_{A_2A_2, \\text{case}}] = (Np^2)\\pi = 20\\pi$，对照中为 $E[n_{A_2A_2, \\text{control}}] = (Np^2)(1-\\pi) = 20(1-\\pi)$。\n\n对于在 PheWAS 中检验的许多表型，其患病率 $\\pi$ 很低。例如，如果一种疾病的患病率为 $\\pi=0.05$（$5\\%$），那么 $A_2A_2$ 病例的期望数量是 $20 \\times 0.05 = 1$。在如此低的期望计数下，一个随机样本中的观测计数很可能为零。\n\n这导致了逻辑斯蒂回归中的**准分离或完全分离**问题。当一个预测变量（此处为基因型 $G=2$）能完美预测结果时，就会发生完全分离。例如，如果偶然情况下所有观测到的 $A_2A_2$ 基因型个体都是对照，那么 $A_2A_2$ 病例的单元格计数就为零。在这种情况下，相应回归系数（对数优势比）的最大似然估计会发散到 $-\\infty$，因为模型试图预测该基因型成为病例的概率为零。类似地，如果所有 $A_2A_2$ 个体都是病例，估计值会发散到 $+\\infty$。准完全分离是一个相关问题，其中存在零单元格计数，同样导致有限的最大似然估计不存在。\n\n鉴于次要等位基因纯合子的总数非常少（$20$），并且这个小数目又按表型状态进行分层，在基因型-表型状态的列联表中观察到零单元格的概率非常高，特别是对于患病率低的表型。由于 PheWAS 涉及检验数千种表型，其中许多是罕见的，这种数据稀疏性及其导致的分离问题不是一个异常现象，而是一个系统性的、普遍存在的问题。\n\n**Firth 惩罚似然**（通常称为 Firth 校正）是解决此问题的标准方法。它通过添加一个源自 Jeffreys 先验的惩罚项来修改最大似然估计中使用的得分函数。该惩罚项有效地将系数估计向零收缩，防止其发散到无穷大。这确保了即使在存在完全分离的情况下，也能获得有限、稳定的优势比估计。所得的估计在小样本中偏差也更小。因此，在 PheWAS 中将其应用于许多或所有表型是合理的，以确保在面对稀有变异和/或罕见表型不可避免的数据稀疏性时，能获得稳健可靠的结果。\n\n所要求的最终数值答案是完整样本中次要等位基因纯合子的期望数量。",
            "answer": "$$\\boxed{20}$$"
        },
        {
            "introduction": "PheWAS 的一个决定性特征是同时检验大量假设，这大大增加了出现假阳性结果的机会。本练习演示了一种强大的非参数方法——置换检验——来控制这种多重检验负担，尤其是在表型相关的情况下 。您将学习此过程的工作原理，并计算一个经验校正的 $p$ 值，该 $p$ 值考虑了族系误差率。",
            "id": "5071614",
            "problem": "一位研究人员对从一个包含 $N = 1000$ 名无亲缘关系个体的样本中测量的三个二元临床表型，进行了一项关于单一遗传变异的全表型关联研究（PheWAS；Phenome-Wide Association Study）。该遗传变异以加性方式编码为 $G \\in \\{0,1,2\\}$，其次要等位基因频率约为 $0.30$。对于 $j \\in \\{1,2,3\\}$ 的每个表型 $Y_{j}$，使用逻辑回归模型进行建模，其形式为 $\\ln\\left(\\frac{\\Pr(Y_{j}=1 \\mid G)}{\\Pr(Y_{j}=0 \\mid G)}\\right) = \\alpha_{j} + \\beta_{j} G$，其中 $\\beta_{j}$ 在零假设 $H_{0,j}: \\beta_{j} = 0$ 下进行检验。联合表型相关矩阵（根据观测样本估计）为\n$$\n\\Sigma_{Y} = \\begin{pmatrix}\n1  & 0.45 & 0.10 \\\\\n0.45 & 1  & 0.20 \\\\\n0.10 & 0.20 & 1\n\\end{pmatrix},\n$$\n这反映了表型之间非平凡的相关性。\n\n从原始（未置换）数据中，研究人员获得了基因型系数的Wald $z$-统计量：$Z_{1} = 2.50$，$Z_{2} = 1.20$ 和 $Z_{3} = -0.50$。为了构建一个尊重所观察到的表型相关性结构的经验零分布，研究人员对 $N$ 个个体的基因型标签进行了 $B = 5000$ 次随机置换，同时保持表型数据矩阵不变。对于每次置换 $b \\in \\{1,\\dots,B\\}$，她重新拟合三个逻辑模型以获得 $Z_{1}^{(b)}$、$Z_{2}^{(b)}$、$Z_{3}^{(b)}$，并记录最大绝对统计量 $M^{(b)} = \\max\\left(|Z_{1}^{(b)}|, |Z_{2}^{(b)}|, |Z_{3}^{(b)}|\\right)$。在得到的置换样本中，观察到在 $B = 5000$ 次置换中有 $k = 62$ 次的最大绝对统计量满足 $M^{(b)} \\ge |Z_{1}| = 2.50$。\n\n利用零假设作为基因型-表型独立的基石定义，以及经验$p$-值作为零假设下的尾部概率的定义，解释为什么在保持表型完整的同时置换基因型标签，能够为最大统计量产生一个保留了 $\\Sigma_{Y}$ 的有效经验零分布。然后，基于置换最大值计算表型1的表型层面校正$p$-值，使用加一校正以确保有效的尾部概率，并将最终数值答案四舍五入到四位有效数字。将最终值表示为无单位的纯数字。",
            "solution": "该问题被认为是有效的，因为它描述了统计遗传学中一个标准且科学上合理的过程——使用基于置换的方法进行多重检验校正的全表型关联研究（PheWAS）。该问题是自洽的、适定的、客观的，并依赖于已建立的统计学原理。\n\n解答包含两部分：首先，解释置换程序的有效性；其次，计算校正后的$p$-值。\n\n### 第1部分：置换程序的有效性\n\n在这种遗传关联背景下，基本零假设（$H_0$）是基因型 $G$ 与任何表型 $\\{Y_1, Y_2, Y_3\\}$ 都没有关联。从统计学上讲，这意味着基因型和表型向量是独立的。在这个独立性假设下，观察到的基因型标签向量 $(G_1, G_2, \\dots, G_N)$ 与表型数据矩阵的配对，仅仅是 $N!$ 种等可能性配对中的一种。\n\n所描述的置换程序直接模拟了这一零假设。对于每次置换 $b$，基因型标签的向量被随机打乱，这些置换后的基因型与原始的、未打乱的表型数据配对。这个过程明确地打破了数据中可能存在的任何真实的基因型-表型关联。因此，从每个置换数据集计算出的检验统计量（$Z_{1}^{(b)}, Z_{2}^{(b)}, Z_{3}^{(b)}$）根据其构造，是从不存在关联的零分布中抽取的。\n\n此程序的一个关键特征是每个个体的表型数据保持完整。也就是说，对于每个个体 $i$，他们的测量值集合 $(Y_{i1}, Y_{i2}, Y_{i3})$ 被视为一个固定的单元。因此，整个 $N \\times 3$ 的表型数据矩阵在所有置换中保持恒定。由于每个表型 $Y_j$ 的观测向量没有改变，因此表型*之间*的任何关系都被保留下来。这包括它们的两两相关性。样本相关矩阵 $\\Sigma_Y$ 是对真实总体相关性结构的估计，并且仅是表型数据自身的属性。通过不对表型进行置换，这种结构在置换检验的每次迭代中都得到完美保持。\n\n为多重检验校正选择的检验统计量是最大绝对Wald统计量，$M = \\max(|Z_1|, |Z_2|, |Z_3|)$。为了评估观察到的最大值 $M_{obs}$ 的显著性，我们需要它在全局零假设下的分布。这个零分布取决于单个检验统计量 $(Z_1, Z_2, Z_3)$ 的联合分布，而该联合分布又受到表型间相关性 $\\Sigma_Y$ 的影响。该联合分布的解析推导可能很复杂，特别是对于逻辑回归模型。\n\n置换程序提供了一种优雅的非参数解决方案。通过在一个同时保留了表型相关结构 $\\Sigma_Y$ 的模拟零假设下重复生成最大统计量 $M^{(b)}$，我们为 $M$ 构建了一个经验零分布。这个经验分布正确地解释了由相关表型引起的检验统计量之间的依赖性。将我们观察到的最大统计量与这个经验生成的零分布进行比较，可以得出一个经过族系误差率（FWER）校正的$p$-值，这个$p$-值是有效的，并且通常比可能对相关结构做出过于保守假设的标准解析校正（例如，Bonferroni）更具效力。\n\n### 第2部分：校正$p$-值的计算\n\n问题要求计算表型1的表型层面校正$p$-值，该值由最大统计量的分布推导得出。这个校正后的$p$-值，记为 $p_{adj,1}$，是观察到最大零统计量至少与表型1的观察统计量 $|Z_1|$ 一样极端的估计概率。该值代表了在对所有三个表型进行多重检验校正后，表型1的显著性。\n\n提供的数据如下：\n-   置换次数：$B = 5000$。\n-   表型1的观察Wald统计量：$Z_1 = 2.50$。\n-   在置换中，最大绝对统计量 $M^{(b)} = \\max(|Z_1^{(b)}|, |Z_2^{(b)}|, |Z_3^{(b)}|)$ 大于或等于表型1的观察绝对统计量 $|Z_1| = |2.50| = 2.50$ 的次数。该计数为 $k = 62$。\n\n经验$p$-值是至少与观察统计量一样极端的零统计量的比例。为了在 $k=0$ 时避免$p$-值为$0$并提供更稳定的估计，使用了“加一”校正。使用此校正的校正$p$-值的公式是：\n$$p_{adj,1} = \\frac{k+1}{B+1}$$\n将给定值代入此公式：\n$$p_{adj,1} = \\frac{62+1}{5000+1} = \\frac{63}{5001}$$\n现在，我们进行除法运算并将结果四舍五入到四位有效数字：\n$$p_{adj,1} = \\frac{63}{5001} \\approx 0.0125974805...$$\n将此值四舍五入到四位有效数字，我们检查第五位有效数字。前四位有效数字是 $1, 2, 5, 9$。第五位数字是 $7$。由于 $7 \\ge 5$，我们将第四位有效数字向上取整。将 $9$ 向上取整得到 $0$，并向前一位进 $1$。\n$$p_{adj,1} \\approx 0.01260$$\n尾部的零是有效数字，保留它以表示指定的精度。",
            "answer": "$$\\boxed{0.01260}$$"
        }
    ]
}