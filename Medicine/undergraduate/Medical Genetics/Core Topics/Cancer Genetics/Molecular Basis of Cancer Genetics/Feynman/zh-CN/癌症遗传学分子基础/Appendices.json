{
    "hands_on_practices": [
        {
            "introduction": "临床上获取的肿瘤样本并非“纯净”的癌细胞集合，而是癌细胞与各种正常细胞（如免疫细胞和基质细胞）的混合体。因此，从这种“批量”测序数据中准确推断癌细胞自身的遗传特征，是癌症基因组学的一项核心挑战。本练习将向你展示如何利用可直接观测的测序数据——例如变异等位基因频率（VAF）——结合肿瘤纯度等信息，计算出癌症细胞分数（CCF），这是一个揭示肿瘤内部异质性与克隆演化历史的关键参数。",
            "id": "5061416",
            "problem": "一项对实体瘤的批量测序实验报告，一个体细胞单核苷酸变异的观测变异等位基因频率 (VAF) 为 $v = 0.18$。独立的病理学和计算估计表明，肿瘤纯度 $p = 0.60$，这意味着样本中 $60\\%$ 的有核细胞是癌细胞。拷贝数分析显示，在该位点的肿瘤细胞中，等位基因总数为 $C = 3$。单倍型感知分析表明突变多重性为 $m = 2$，这意味着在携带该突变的肿瘤细胞中，该位点上的 $C$ 个拷贝中恰好有 $2$ 个携带突变等位基因。假设正常（非癌）细胞在该位点是二倍体，拥有 $2$ 个等位基因。\n\n利用第一性原理——即变异等位基因频率是混合物中所有采样等位基因里突变等位基因的比例，肿瘤纯度是混合物中癌细胞的比例，拷贝数是每种细胞类型的位点拷贝数，而突变多重性是每个突变肿瘤细胞中的突变拷贝数——推导癌细胞分数 (CCF) $\\phi$（定义为携带该突变的肿瘤细胞所占的比例），并用 $v$、$p$、$C$、$m$ 以及正常的二倍体拷贝数 $2$ 来表示。然后，根据给定的数值计算 $\\phi$，并依据 $\\phi$ 是否等于 $1$ 或小于 $1$ 来判断该突变是克隆性的（存在于所有癌细胞中）还是亚克隆性的（存在于一个严格子集中）。\n\n将你计算出的 $\\phi$ 的最终数值答案四舍五入到三位有效数字，并以不带单位的小数形式表示。克隆性的解释应在你的推导过程中给出理由，但不必包含在方框内的最终答案中。",
            "solution": "该问题要求从第一性原理出发，推导癌细胞分数 $\\phi$，并进行后续计算。推导将基于变异等位基因频率 (VAF)、肿瘤纯度 ($p$)、肿瘤细胞拷贝数 ($C$) 和突变多重性 ($m$) 的定义。\n\n设 $v$ 为变异等位基因频率，$p$ 为肿瘤纯度，$C$ 为目标位点上一个肿瘤细胞中的等位基因总数，$m$ 为一个突变肿瘤细胞中的突变多重性。癌细胞分数 $\\phi$ 是携带该突变的肿瘤细胞所占的比例。假设正常细胞在该位点是二倍体，即其拷贝数为 $2$。\n\n变异等位基因频率 $v$ 定义为样本中突变等位基因的总数除以所有等位基因（突变型和野生型）的总数。让我们为分子和分母构建表达式。\n\n设 $N$ 为样本中有核细胞的总数。\n样本中癌细胞的数量为 $p \\cdot N$。\n正常（非癌）细胞的数量为 $(1-p) \\cdot N$。\n\n样本中突变等位基因的总数完全来源于突变的癌细胞。假设正常细胞不含体细胞突变。\n携带该突变的癌细胞数量为 $\\phi \\cdot (p \\cdot N)$。\n每个突变的癌细胞含有 $m$ 个突变等位基因拷贝。\n因此，突变等位基因的总数为：\n$$ \\text{Total mutant alleles} = (\\phi \\cdot p \\cdot N) \\cdot m = \\phi p m N $$\n\n样本中所有等位基因的总数是正常细胞群体和癌细胞群体中等位基因数之和。\n来自正常细胞群体的等位基因数量是正常细胞数乘以其拷贝数 ($2$)：\n$$ \\text{Alleles from normal cells} = (1-p) \\cdot N \\cdot 2 = 2N(1-p) $$\n来自癌细胞群体的等位基因数量是癌细胞数乘以其拷贝数 ($C$)：\n$$ \\text{Alleles from cancer cells} = p \\cdot N \\cdot C = pCN $$\n因此，样本中所有等位基因的总数为：\n$$ \\text{Total alleles} = 2N(1-p) + pCN = N(2(1-p) + pC) $$\n\n变异等位基因频率 $v$ 是这两个量的比值：\n$$ v = \\frac{\\text{Total mutant alleles}}{\\text{Total alleles}} = \\frac{\\phi p m N}{N(2(1-p) + pC)} $$\n如预期一样，细胞总数 $N$ 从表达式中被消去，因为 $v$ 是混合物的一个内含性质。\n$$ v = \\frac{\\phi p m}{2(1-p) + pC} $$\n这个方程将观测到的 VAF $v$ 与潜在的生物学参数 $p, C, m$ 以及我们感兴趣的参数 $\\phi$ 联系起来。\n\n为了求出癌细胞分数 $\\phi$，我们必须对这个方程进行代数重排：\n$$ v \\cdot (2(1-p) + pC) = \\phi p m $$\n$$ \\phi = \\frac{v(2(1-p) + pC)}{pm} $$\n这就是用 $v, p, C, m$ 以及正常的二倍体拷贝数 $2$ 表示 $\\phi$ 的所求表达式。\n\n现在，我们将给定值代入此公式，以计算 $\\phi$ 的具体值。\n给定值为：\n- $v = 0.18$\n- $p = 0.60$\n- $C = 3$\n- $m = 2$\n\n首先，计算公式的各个组成部分：\n- 分母是 $pm = 0.60 \\cdot 2 = 1.2$。\n- 分子中括号内的项是 $2(1-p) + pC = 2(1-0.60) + (0.60 \\cdot 3) = 2(0.40) + 1.8 = 0.8 + 1.8 = 2.6$。\n\n现在将这些值代回 $\\phi$ 的表达式中：\n$$ \\phi = \\frac{0.18 \\cdot (2.6)}{1.2} $$\n$$ \\phi = \\frac{0.468}{1.2} $$\n$$ \\phi = 0.39 $$\n\n问题要求将结果四舍五入到三位有效数字。计算出的值为 $0.39$，有两位有效数字。为了用三位有效数字表示，我们写作 $0.390$。\n\n最后，我们必须判断该突变是克隆性的还是亚克隆性的。如果一个突变存在于所有癌细胞中，即 $\\phi = 1$，则该突变是克隆性的。如果它存在于癌细胞的一个严格子集中，即 $\\phi  1$，则它是亚克隆性的。\n在本例中，我们得到 $\\phi = 0.390$。由于 $\\phi  1$，该突变是亚克隆性的，存在于大约 $39\\%$ 的癌细胞中。",
            "answer": "$$ \\boxed{0.390} $$"
        },
        {
            "introduction": "一个基因突变的真正意义在于其功能性后果。本练习将我们从数据分析转向系统生物学建模，展示如何通过构建一个简洁的数学模型，来定量预测一种常见癌症遗传事件的生化影响——即抑癌基因 $PTEN$ 单拷贝缺失。你将看到，基于基本的化学动力学原理，我们能够将基因型（$PTEN$ 单倍剂量不足）与促癌表型（$PIP3$ 信号增强）精确地联系起来，并得出一个惊人而简洁的预测。",
            "id": "5061458",
            "problem": "一个像磷酸酶和张力蛋白同源物（PTEN）这样的肿瘤抑制基因，通过将磷脂酰肌醇3-激酶（PI3K）产生的脂质第二信使去磷酸化来拮抗信号传导。在一个简化的膜信号模型中，设 $x(t)$ 表示磷脂酰肌醇（3,4,5）-三磷酸（PIP3）的浓度。PIP3由磷脂酰肌醇（4,5）-二磷酸（PIP2）在磷脂酰肌醇3-激酶（PI3K）的催化下生成，假定其遵循质量作用动力学，速率常数为 $k_{p}$，且与 $[\\mathrm{PI}3\\mathrm{K}]$ 和 $[\\mathrm{PIP}2]$ 的乘积成正比。PIP3去磷酸化变回PIP2的过程由磷酸酶和张力蛋白同源物（PTEN）催化，假定其同样遵循质量作用动力学，速率常数为 $k_{d}$，且与 $[\\mathrm{PTEN}]$ 和 $x(t)$ 的乘积成正比。假设在所关心的时间尺度内，$[\\mathrm{PI}3\\mathrm{K}]$ 和 $[\\mathrm{PIP}2]$ 不随时间变化（底物供应和酶丰度恒定），并且系统达到稳态，此时 $x(t)$ 变得不随时间变化。\n\nPTEN的单倍剂量不足使其功能性PTEN浓度减少一半，即 $[\\mathrm{PTEN}]$ 变为 $[\\mathrm{PTEN}]/2$，而所有其他量和速率常数保持不变。使用质量作用动力学和从第一性原理推导出的稳态条件，计算由PTEN单倍剂量不足引起的稳态PIP3浓度 $x^{\\ast}$ 的倍数效应（倍数变化），定义为比率 $x^{\\ast}_{\\mathrm{haplo}}/x^{\\ast}_{\\mathrm{WT}}$，其中 $x^{\\ast}_{\\mathrm{WT}}$ 是野生型稳态浓度，$x^{\\ast}_{\\mathrm{haplo}}$ 是单倍剂量不足稳态浓度。将您的答案表示为一个无量纲的实数。无需四舍五入。",
            "solution": "问题要求计算当肿瘤抑制因子PTEN的浓度因单倍剂量不足而减半时，磷脂酰肌醇 ($3$,$4$,$5$)-三磷酸 (PIP$3$) 稳态浓度的倍数变化。设 $x(t)$ 代表PIP$3$的浓度。我们将首先根据质量作用动力学原理建立一个动力学模型来描述 $x(t)$ 的动态变化。\n\nPIP$3$浓度的变化率 $\\frac{dx(t)}{dt}$ 是其生成速率与降解速率之差。\n$$\n\\frac{dx(t)}{dt} = V_{p} - V_{d}\n$$\n其中 $V_p$ 是PIP$3$的生成速率，$V_d$ 是其去磷酸化（降解）速率。\n\n根据问题描述，PIP$3$的生成是由PI$3$K催化PIP$2$产生的。其速率由质量作用动力学描述，并与PI$3$K和PIP$2$的浓度乘积成正比。问题指明 $[\\mathrm{PI}3\\mathrm{K}]$ 和 $[\\mathrm{PIP}2]$ 在所关心的时间尺度内是恒定的。因此，生成速率 $V_p$ 是一个常数。我们将其表示为恒定的生成速率 $R_p$。\n$$\nV_p = R_p = \\text{constant}\n$$\n\nPIP$3$去磷酸化变回PIP$2$的过程由PTEN催化。问题指出，此过程也遵循质量作用动力学。在一个酶（PTEN）作用于底物（PIP$3$）的反应中，速率与酶和底物浓度的乘积成正比。因此，去磷酸化速率 $V_d$ 可以写成：\n$$\nV_d = k_{d} [\\mathrm{PTEN}] x(t)\n$$\n其中 $k_d$ 是由PTEN催化的反应的二级速率常数，$[\\mathrm{PTEN}]$ 是PTEN酶的浓度。\n\n结合这些项，我们得到控制PIP$3$浓度的常微分方程：\n$$\n\\frac{dx(t)}{dt} = R_p - k_{d} [\\mathrm{PTEN}] x(t)\n$$\n\n系统会达到一个稳态，此时PIP$3$的浓度不随时间变化。我们将此稳态浓度表示为 $x^{\\ast}$。在稳态下，其变化率为零：\n$$\n\\frac{dx(t)}{dt} = 0\n$$\n将此条件代入我们的微分方程，得到：\n$$\n0 = R_p - k_{d} [\\mathrm{PTEN}] x^{\\ast}\n$$\n我们可以解出稳态浓度 $x^{\\ast}$：\n$$\nk_{d} [\\mathrm{PTEN}] x^{\\ast} = R_p \\implies x^{\\ast} = \\frac{R_p}{k_d [\\mathrm{PTEN}]}\n$$\n该方程表明，PIP$3$的稳态浓度与PTEN酶的浓度成反比。\n\n现在，我们将这个一般性结果应用于问题中描述的两种特定情况：野生型（WT）和PTEN单倍剂量不足型（haplo）。\n\n对于野生型情况，设PTEN浓度为 $[\\mathrm{PTEN}]_{\\mathrm{WT}}$。相应的稳态PIP$3$浓度 $x^{\\ast}_{\\mathrm{WT}}$ 为：\n$$\nx^{\\ast}_{\\mathrm{WT}} = \\frac{R_p}{k_d [\\mathrm{PTEN}]_{\\mathrm{WT}}}\n$$\n\n对于单倍剂量不足情况，功能性PTEN浓度减少了一半。设此浓度为 $[\\mathrm{PTEN}]_{\\mathrm{haplo}}$：\n$$\n[\\mathrm{PTEN}]_{\\mathrm{haplo}} = \\frac{1}{2} [\\mathrm{PTEN}]_{\\mathrm{WT}}\n$$\n问题指出，所有其他量和速率常数，即 $R_p$ 和 $k_d$，保持不变。因此，新的稳态浓度 $x^{\\ast}_{\\mathrm{haplo}}$ 为：\n$$\nx^{\\ast}_{\\mathrm{haplo}} = \\frac{R_p}{k_d [\\mathrm{PTEN}]_{\\mathrm{haplo}}}\n$$\n代入 $[\\mathrm{PTEN}]_{\\mathrm{haplo}}$ 的表达式：\n$$\nx^{\\ast}_{\\mathrm{haplo}} = \\frac{R_p}{k_d \\left(\\frac{1}{2} [\\mathrm{PTEN}]_{\\mathrm{WT}}\\right)} = \\frac{2 R_p}{k_d [\\mathrm{PTEN}]_{\\mathrm{WT}}}\n$$\n\n问题要求计算倍数效应（倍数变化），即比率 $\\frac{x^{\\ast}_{\\mathrm{haplo}}}{x^{\\ast}_{\\mathrm{WT}}}$。我们使用上面推导出的表达式计算这个比率：\n$$\n\\frac{x^{\\ast}_{\\mathrm{haplo}}}{x^{\\ast}_{\\mathrm{WT}}} = \\frac{\\frac{2 R_p}{k_d [\\mathrm{PTEN}]_{\\mathrm{WT}}}}{\\frac{R_p}{k_d [\\mathrm{PTEN}]_{\\mathrm{WT}}}}\n$$\n分子和分母中的项 $R_p$、$k_d$ 和 $[\\mathrm{PTEN}]_{\\mathrm{WT}}$ 会消去：\n$$\n\\frac{x^{\\ast}_{\\mathrm{haplo}}}{x^{\\ast}_{\\mathrm{WT}}} = 2\n$$\n因此，将PTEN酶的浓度减半会导致其底物PIP$3$的稳态浓度加倍。这个倍数变化是一个无量纲的实数。",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "许多癌症研究的最终目标是发现驱动疾病发展的核心基因。然而，这是一项艰巨的统计挑战：我们如何在一片“随机”突变的背景噪声中，识别出那些真正受到正向选择、突变频率异常高的“驱动基因”？这项综合性练习要求你设计并实现一种计算方法，它模拟了前沿研究中使用的策略，即建立一个考虑多种协变量的背景突变模型，并利用它从大规模队列数据中筛选出具有统计显著性的驱动基因候选项。",
            "id": "5061408",
            "problem": "要求您设计并实现一个基因层面的统计决策程序，通过将观测到的突变计数与一个调整后的背景期望（该期望考虑了复制时间和染色质状态导致的异质性）进行比较，来识别推定的癌症驱动基因。目标是使用 Benjamini–Hochberg (BH) 程序来控制伪发现率。对于每个测试用例，您的程序必须返回一个布尔决策列表，指明在指定的伪发现率水平下，每个基因是否被判定为显著。\n\n您的推导和实现应基于核心原理和定义，而非预先指定的目标公式。具体而言，请从分子生物学中心法则以及“脱氧核糖核酸 (DNA) 复制和修复过程主导突变事件，且许多独立位点上的突变发生可被建模为罕见的随机事件”这一经过充分检验的理解出发。该模型必须在科学上是现实的，并满足以下约束条件：\n\n- 在一个队列中，某个基因所有可调用碱基上的突变总数源于许多独立的罕见事件，并且可以通过一个与独立试验的点过程一致的离散分布来恰当近似。\n- 基因的期望突变数必须为非负，并且必须与队列中发生突变的机会数量成比例，而这个机会数量取决于基因的可调用长度和所分析的基因组数量。\n- 背景突变率在基因间的异质性应由代表复制时间和染色质状态的协变量来捕获。从协变量到期望突变率的映射应保持非负性，并允许协变量产生乘性效应。\n- 一个基因的统计显著性通过一个尾部概率来评估，该概率表示无效模型为该基因生成至少与观测到的突变数一样多的突变的概率。\n- 在一个测试用例中，跨基因的多重检验必须使用 Benjamini–Hochberg 程序来控制伪发现率 (FDR)，指定的 FDR 水平以小数形式给出（而非百分比）。\n\n提供给您用于计算的变量和量必须严格按照规定使用：\n- $N$：队列中肿瘤基因组（样本）的数量，为一个正整数。\n- $r_0$：基线上的每个碱基每个样本的突变率，单位为“突变/碱基/样本”（使用提供的数值；单位在计算中是隐含的）。\n- $L_g$：基因 $g$ 的可调用长度，单位为碱基对，为一个正整数。\n- $\\mathrm{RT}_g$：基因 $g$ 的复制时间值，编码为一个介于 $0$（最早复制）和 $1$（最晚复制）之间的标量。\n- $\\mathrm{CS}_g$：基因 $g$ 的染色质状态指示符，编码为 $0$ 代表开放的常染色质，$1$ 代表闭合的异染色质。\n- $K_g$：在队列中观测到的基因 $g$ 的整数突变计数。\n- $c_{\\mathrm{RT}}$：一个非负标量，量化在您构建的统计模型中复制时间对背景率影响的强度。\n- $c_{\\mathrm{CS}}$：一个非负标量，量化在您构建的统计模型中染色质状态对背景率影响的强度。\n- $q$：伪发现率水平，以小数形式提供。\n\n您的程序必须为每个测试用例实现以下步骤：\n- 根据第一性原理及上述约束条件，构建一个统计上有效的基因层面无效模型来描述 $K_g$。该模型需包含 $N$、$r_0$、$L_g$、$\\mathrm{RT}_g$ 和 $\\mathrm{CS}_g$，并使用 $c_{\\mathrm{RT}}$ 和 $c_{\\mathrm{CS}}$ 来参数化协变量的影响，同时确保期望率的非负性和协变量的乘性效应。\n- 对每个基因 $g$，计算在无效模型下观测到至少与 $K_g$ 一样大的计数的尾部概率。\n- 对该测试用例中的这些尾部概率，在水平 $q$ 上应用 Benjamini–Hochberg 程序，为每个基因生成一个布尔决策：如果被拒绝（判定为显著），则为 `True`，否则为 `False`。\n\n测试套件：\n将以下测试用例准确无误地提供给您的程序。所有数值必须按给定值使用。\n\n- 测试用例 1：\n  - $N = 200$\n  - $r_0 = 2 \\times 10^{-8}$\n  - $c_{\\mathrm{RT}} = 0.693$\n  - $c_{\\mathrm{CS}} = 0.405$\n  - $q = 0.1$\n  - 基因（每个为元组 $(L_g,\\mathrm{RT}_g,\\mathrm{CS}_g,K_g)$）：\n    - $(2500, 0.2, 0, 3)$\n    - $(3000, 0.8, 1, 7)$\n    - $(1800, 0.5, 0, 0)$\n    - $(10000, 0.9, 1, 10)$\n    - $(500, 0.1, 0, 1)$\n    - $(7000, 0.3, 0, 2)$\n\n- 测试用例 2：\n  - $N = 100$\n  - $r_0 = 1.5 \\times 10^{-7}$\n  - $c_{\\mathrm{RT}} = 0.693$\n  - $c_{\\mathrm{CS}} = 0.405$\n  - $q = 0.2$\n  - 基因 $(L_g,\\mathrm{RT}_g,\\mathrm{CS}_g,K_g)$:\n    - $(12000, 0.9, 1, 0)$\n    - $(8000, 0.7, 1, 0)$\n    - $(5000, 0.6, 0, 0)$\n    - $(3000, 0.4, 0, 0)$\n\n- 测试用例 3：\n  - $N = 300$\n  - $r_0 = 5 \\times 10^{-8}$\n  - $c_{\\mathrm{RT}} = 0.693$\n  - $c_{\\mathrm{CS}} = 0.405$\n  - $q = 0.05$\n  - 基因 $(L_g,\\mathrm{RT}_g,\\mathrm{CS}_g,K_g)$:\n    - $(4000, 0.7, 1, 2)$\n    - $(4000, 0.7, 1, 2)$\n    - $(2500, 0.5, 0, 1)$\n    - $(15000, 1.0, 1, 20)$\n    - $(1000, 0.2, 0, 0)$\n    - $(10000, 0.1, 0, 8)$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。列表中的每个元素对应一个测试用例，其本身是一个布尔值列表（Python 字面量格式），表示按基因提供顺序排列的 Benjamini–Hochberg 决策。例如，一个包含两个测试用例的输出行看起来像这样：`[[True,False],[False,False]]`。您的程序不得打印任何额外文本。",
            "solution": "该问题要求设计并实现一个统计程序，用于从体细胞突变数据中识别癌症驱动基因。该过程涉及构建背景突变率的无效模型，计算每个基因观测突变计数的统计显著性，以及在多重检验中控制伪发现率。\n\n### 步骤1：背景突变的无效模型构建\n\n核心任务是定义一个无效假设 $H_0$，即一个基因的观测突变计数是背景突变过程的结果，而非正向选择的结果。这需要一个对背景过程的量化模型。\n\n**1.1. 突变计数的概率模型**\n体细胞突变源于DNA复制过程中的错误和修复失败。在一个庞大的基因组和一个包含许多个体的队列中，任何单个碱基对的突变都是罕见的，可以被视为独立事件。基因 $g$ 中的总突变数 $K_g$ 是大量独立试验结果的总和，每次试验对应于单个个体基因组中的一个碱基对。对于基因 $g$，整个队列中的总试验次数是其可调用长度 $L_g$ 与样本数 $N$ 的乘积。由于每次试验的突变概率极低，总计数 $K_g$ 可以用泊松分布很好地近似，这是罕见事件计数的标准模型。\n在无效假设下，我们将观测到的突变计数 $K_g$ 建模为一个从泊松分布中抽取的随机变量：\n$$K_g \\sim \\mathrm{Poisson}(\\lambda_g)$$\n其中 $\\lambda_g$ 是在背景过程下基因 $g$ 在队列中的期望突变计数。\n\n**1.2. 期望突变率（$\\lambda_g$）的建模**\n期望计数 $\\lambda_g$ 必须考虑几个因素。\n首先，它与突变机会的数量成正比。这是样本数 $N$、基因的可调用长度 $L_g$（以碱基对为单位）以及基线上的每个碱基每个样本的突变率 $r_0$ 的乘积。\n$$\\lambda_{\\text{base}, g} = N \\times L_g \\times r_0$$\n其次，问题指出背景突变率是异质的，受到复制时间（$\\mathrm{RT}_g$）和染色质状态（$\\mathrm{CS}_g$）等协变量的影响。模型必须以乘性效应的方式整合这些协变量，同时保持率 $\\lambda_g$ 的非负性。在广义线性模型中，一种实现此目的的标准方法是将率的对数建模为协变量的线性函数。\n设基因特异性的每个碱基每个样本的突变率为 $\\mu_g$。我们将其建模为：\n$$\\mu_g = r_0 \\times f(\\mathrm{RT}_g, \\mathrm{CS}_g)$$\n为实现协变量的乘性效应，我们使用指数函数：\n$$\\log(\\mu_g) = \\log(r_0) + c_{\\mathrm{RT}} \\cdot \\mathrm{RT}_g + c_{\\mathrm{CS}} \\cdot \\mathrm{CS}_g$$\n对两边取指数，得到率 $\\mu_g$：\n$$\\mu_g = r_0 \\cdot \\exp(c_{\\mathrm{RT}} \\cdot \\mathrm{RT}_g + c_{\\mathrm{CS}} \\cdot \\mathrm{CS}_g)$$\n这里，$c_{\\mathrm{RT}}$ 和 $c_{\\mathrm{CS}}$ 是给定的系数，分别量化复制时间和染色质状态的影响。此公式确保了 $\\mu_g > 0$。\n\n基因 $g$ 在整个队列中的总期望计数 $\\lambda_g$ 则是基因特异性率 $\\mu_g$、基因长度 $L_g$ 和队列大小 $N$ 的乘积：\n$$\\lambda_g = N \\cdot L_g \\cdot \\mu_g = N \\cdot L_g \\cdot r_0 \\cdot \\exp(c_{\\mathrm{RT}} \\cdot \\mathrm{RT}_g + c_{\\mathrm{CS}} \\cdot \\mathrm{CS}_g)$$\n这个 $\\lambda_g$ 模型满足了问题的所有约束条件。\n\n### 步骤2：P值计算\n\n对于每个基因 $g$，我们检验无效假设 $H_0$，即其观测突变计数 $K_g$ 来自 $\\mathrm{Poisson}(\\lambda_g)$ 分布。我们寻找的是过量的突变，这可能暗示存在正向选择。这是一个单侧右尾检验。p值 $p_g$ 是在无效模型下观测到至少与 $K_g$ 一样大的计数的概率。\n$$p_g = P(X \\ge K_g \\mid X \\sim \\mathrm{Poisson}(\\lambda_g))$$\n该概率使用泊松分布的生存函数（或互补累积分布函数，CCDF）计算：\n$$p_g = \\sum_{j=K_g}^{\\infty} \\frac{e^{-\\lambda_g} \\lambda_g^j}{j!} = 1 - \\sum_{j=0}^{K_g-1} \\frac{e^{-\\lambda_g} \\lambda_g^j}{j!}$$\n一个小的p值表示，在背景模型下，观测到的计数高得令人意外，从而提供了反对无效假设的证据。\n\n### 步骤3：使用Benjamini–Hochberg (BH) 程序进行多重检验校正\n\n当同时检验许多基因（即“全基因组”扫描）时，仅凭偶然机会就获得小p值的概率很高，这会导致伪发现。为了解决这个问题，我们必须控制伪发现率 (FDR)，即在所有被拒绝的无效假设中，假阳性的期望比例。Benjamini–Hochberg (BH) 程序是在指定水平 $q$ 上控制 FDR 的一种标准方法。\n\n设 $m$ 为待检验的基因总数。在水平 $q$ 上的 BH 程序如下：\n1.  为 $m$ 个基因中的每一个计算p值 $p_g$。\n2.  将这些p值按升序排序：$p_{(1)} \\le p_{(2)} \\le \\ldots \\le p_{(m)}$。\n3.  找到最大的秩 $k$，使得其对应的排序p值 $p_{(k)}$ 满足条件：\n    $$p_{(k)} \\le \\frac{k}{m} \\cdot q$$\n4.  如果存在这样的 $k$，则拒绝与p值 $p_{(1)}, p_{(2)}, \\ldots, p_{(k)}$ 相对应的所有无效假设。\n5.  如果不存在这样的 $k$（即 $p_{(1)} > \\frac{1}{m} \\cdot q$），则不拒绝任何无效假设。\n\n此程序确保，平均而言，在所有被判定为“驱动”基因的基因中，被错误判定的比例不超过 $q$。对于每个基因，最终输出是一个布尔决策：如果其无效假设被拒绝（即被视为推定的驱动基因），则为 `True`，否则为 `False`。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import poisson\n\ndef solve():\n    \"\"\"\n    Solves the cancer driver gene identification problem for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"params\": (200, 2e-8, 0.693, 0.405, 0.1),\n            \"genes\": [\n                (2500, 0.2, 0, 3),\n                (3000, 0.8, 1, 7),\n                (1800, 0.5, 0, 0),\n                (10000, 0.9, 1, 10),\n                (500, 0.1, 0, 1),\n                (7000, 0.3, 0, 2),\n            ],\n        },\n        {\n            \"params\": (100, 1.5e-7, 0.693, 0.405, 0.2),\n            \"genes\": [\n                (12000, 0.9, 1, 0),\n                (8000, 0.7, 1, 0),\n                (5000, 0.6, 0, 0),\n                (3000, 0.4, 0, 0),\n            ],\n        },\n        {\n            \"params\": (300, 5e-8, 0.693, 0.405, 0.05),\n            \"genes\": [\n                (4000, 0.7, 1, 2),\n                (4000, 0.7, 1, 2),\n                (2500, 0.5, 0, 1),\n                (15000, 1.0, 1, 20),\n                (1000, 0.2, 0, 0),\n                (10000, 0.1, 0, 8),\n            ],\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        N, r0, c_RT, c_CS, q = case[\"params\"]\n        genes = case[\"genes\"]\n        num_genes = len(genes)\n        \n        p_values = []\n        for L_g, RT_g, CS_g, K_g in genes:\n            # Step 1: Calculate the expected mutation rate lambda_g under the null model.\n            # lambda_g = N * L_g * r0 * exp(c_RT * RT_g + c_CS * CS_g)\n            rate_modifier = np.exp(c_RT * RT_g + c_CS * CS_g)\n            lambda_g = N * L_g * r0 * rate_modifier\n            \n            # Step 2: Calculate the p-value for the observed mutation count K_g.\n            # The p-value is the probability of observing a count >= K_g, which is\n            # calculated using the survival function (sf) of the Poisson distribution.\n            # P(X >= K_g) is equivalent to P(X > K_g - 1).\n            p_val = poisson.sf(K_g - 1, lambda_g)\n            p_values.append(p_val)\n\n        # Step 3: Apply the Benjamini-Hochberg procedure to control the FDR.\n        \n        # Keep track of original indices while sorting p-values\n        indexed_p_values = sorted(enumerate(p_values), key=lambda x: x[1])\n\n        # Find the largest k for which p_(k) = (k/m) * q\n        significant_k = 0\n        for i in range(num_genes - 1, -1, -1):\n            rank = i + 1\n            p_val_k = indexed_p_values[i][1]\n            bh_threshold = (rank / num_genes) * q\n            if p_val_k = bh_threshold:\n                significant_k = rank\n                break\n        \n        # Identify the original indices of hypotheses to be rejected\n        rejected_indices = set()\n        if significant_k > 0:\n            for i in range(significant_k):\n                original_index = indexed_p_values[i][0]\n                rejected_indices.add(original_index)\n                \n        # Create the final boolean list in the original gene order\n        case_results = [i in rejected_indices for i in range(num_genes)]\n        all_results.append(case_results)\n\n    # Print the final results in the specified format\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}