{
    "hands_on_practices": [
        {
            "introduction": "病理学家的一项核心任务是根据肿瘤的恶性潜能对其进行分类。卵巢黏液性肿瘤构成了一个从良性、交界性到恶性的疾病谱，其区分关键在于上皮增生的程度和是否存在破坏性间质浸润。本练习 () 提供了一个真实的场景，让您练习应用这些关键的诊断标准，包括一个量化规则，来对一个黏液性肿瘤进行准确分类。",
            "id": "4454319",
            "problem": "对一单侧卵巢囊性病变进行了广泛取样。组织学检查显示，囊壁衬里由肠型黏液性上皮构成，伴有上皮复层和簇状增生区域。定量图谱分析显示，上皮复层（定义为超过单层的黏液性上皮形成假复层或多层结构）占囊肿总内壁面积的$30\\%$。黏液性上皮上可见局灶性短乳头状赘生物，但无破坏性间质浸润，无间质反应；间质无特殊改变，无促纤维组织增生或炎性反应。该机构采用预定阈值，即$10\\%$的囊壁衬里显示上皮复层，以满足黏液性交界性肿瘤的结构标准。基于基本分类原则——即无破坏性间质浸润的上皮增生是区分交界性肿瘤与良性囊腺瘤的依据，而癌的诊断需要破坏性间质浸润——请确定以下哪个结论得到了最佳支持。\n\nA. 符合黏液性交界性肿瘤的标准；在无浸润的情况下，分类为黏液性交界性肿瘤（肠型）。\n\nB. 不符合标准；病变为良性黏液性囊腺瘤，因为无论复层百分比如何，乳头状结构都是交界性分类的强制性要求。\n\nC. 不符合标准；任何间质反应的缺失都排除了交界性状态，因此病变必须是良性的。\n\nD. 符合标准，但肿瘤应分类为浆液性交界性肿瘤，因为乳头状结构表明浆液性分化。\n\nE. 符合黏液性癌的标准，因为即使未发现破坏性间质浸润，乳头和上皮复层也意味着浸润。",
            "solution": "用户提供了一个病理学领域的问题以供验证和解答。\n\n### 步骤1：提取已知信息\n\n问题提供了以下信息和原则：\n- **病变描述**：单侧卵巢囊性病变。\n- **取样**：广泛取样。\n- **组织学**：囊壁衬里由肠型黏液性上皮构成。\n- **结构特征**：囊壁衬里显示上皮复层和簇状增生区域。也存在局灶性短乳头状赘生物。\n- **定量数据**：上皮复层占囊肿总内壁面积的$30\\%$。\n- **提供的定义**：上皮复层定义为“超过单层的黏液性上皮形成假复层或多层结构”。\n- **浸润状态**：无破坏性间质浸润。\n- **间质特征**：间质无特殊改变，无间质反应、促纤维组织增生或炎性反应。\n- **机构标准**：预定阈值为$10\\%$的囊壁衬里显示上皮复层，以满足黏液性交界性肿瘤的结构标准。\n- **基本原则1**：无破坏性间质浸润的上皮增生是区分交界性肿瘤与良性囊腺瘤的依据。\n- **基本原则2**：癌的诊断需要破坏性间质浸润。\n\n### 步骤2：使用提取的已知信息进行验证\n\n根据既定标准对问题陈述进行验证。\n\n- **科学依据**：该问题在妇科病理学原理方面有充分的依据。对病变的描述、组织学特征（肠型黏液性上皮、复层、簇状增生、乳头状赘生物）、破坏性间质浸润的概念以及分类方案（良性、交界性、癌）都是标准的，并与世界卫生组织（WHO）女性生殖系统肿瘤分类一致。使用定量阈值来评估结构复杂性（例如，复层范围）是诊断黏液性交界性肿瘤中一个公认的方面，尽管有时存在争议。该场景在病理学上是现实的。\n- **问题明确**：该问题提法明确。它提供了一套清晰的组织学发现、明确的分类原则和一个需要应用的具体标准（$10\\%$规则）。问题要求得出支持度最高的结论，可以从给定信息中推导出一个唯一答案。\n- **客观性**：语言是客观的，并使用标准的病理学术语。诸如“肠型黏液性上皮”、“无破坏性间质浸润”以及“$30\\%$复层”的定量测量等描述是精确的，没有主观偏见。\n\n问题陈述没有科学不健全、内部矛盾或含糊不清之处。它提出了一个基于既定医学科学原则的逻辑难题。\n\n### 步骤3：判断与行动\n\n问题有效。现在开始解题过程。\n\n### 正确结论的推导\n\n该问题要求根据所提供的原则和标准，结合组织学发现，作出诊断。\n\n1.  **评估是否为癌**：基本原则2指出“癌的诊断需要破坏性间质浸润”。问题明确指出“无破坏性间质浸润”。因此，排除了癌的诊断。\n\n2.  **评估良性与交界性**：基本原则1指出“无破坏性间质浸润的上皮增生是区分交界性肿瘤与良性囊腺瘤的依据”。良性囊腺瘤的特征是简单的单层上皮衬里，增生极少或无。然而，该病变表现出显著的上皮增生，被描述为“上皮复层和簇状增生”以及“局灶性短乳头状赘生物”。这种增生程度排除了良性诊断，而指向交界性肿瘤。\n\n3.  **应用机构标准**：该机构对黏液性肿瘤分类为交界性有一个具体的定量规则：“$10\\%$的囊壁衬里显示上皮复层”。问题指出，定量图谱分析显示复层占“囊肿总内壁面积的$30\\%$”。由于$30\\% > 10\\%$，该病变满足了黏液性交界性肿瘤的这一结构标准。\n\n4.  **确定肿瘤类型**：组织学明确描述为“肠型黏液性上皮”。这明确了肿瘤的谱系。\n\n5.  **综合结论**：该病变为肠型黏液性肿瘤。它表现出显著的上皮增生，其复层范围（$30\\%$）超过了该机构对交界性肿瘤的阈值（$10\\%$）。它缺乏癌的决定性特征（破坏性间质浸润）。因此，正确的分类是黏液性交界性肿瘤，肠型。\n\n### 选项评估\n\n**A. 符合黏液性交界性肿瘤的标准；在无浸润的情况下，分类为黏液性交界性肿瘤（肠型）。**\n这个结论完全被推导过程所支持。复层的定量标准（$30\\% > 10\\%$）已满足，证实了其交界性性质。无破坏性浸润排除了癌。组织学证实其为肠型黏液性肿瘤。\n**结论：正确。**\n\n**B. 不符合标准；病变为良性黏液性囊腺瘤，因为无论复层百分比如何，乳头状结构都是交界性分类的强制性要求。**\n这个陈述有两个错误。首先，它错误地声称乳头状结构是强制性的。问题提供了一个基于复层（$10\\%$）的标准，而这个标准已经明确满足。在病理学中，仅显著的复层就足以在黏液性肿瘤中作出交界性诊断。其次，鉴于广泛的上皮增生（$30\\%$复层），将病变归类为良性黏液性囊腺瘤违反了基本原则1。\n**结论：错误。**\n\n**C. 不符合标准；任何间质反应的缺失都排除了交界性状态，因此病变必须是良性的。**\n这个陈述引入了一个错误的标准。间质反应（促纤维组织增生）是对浸润的反应，是浸润性癌的特征，而不是交界性肿瘤的要求。交界性肿瘤的定义是基于上皮增生*而无*破坏性间质浸润。没有间质反应与非浸润性（交界性）过程是一致的。\n**结论：错误。**\n\n**D. 符合标准，但肿瘤应分类为浆液性交界性肿瘤，因为乳头状结构表明浆液性分化。**\n这个选项错误地对肿瘤进行了重新分类。问题明确指出囊壁衬里是“肠型黏液性上皮”。这定义了肿瘤是黏液性的。虽然乳头状结构在浆液性肿瘤中非常常见，但并非其独有，也可以在黏液性肿瘤中发现。忽略明确的细胞类型（黏液性）是一个根本性错误。\n**结论：错误。**\n\n**E. 符合黏液性癌的标准，因为即使未发现破坏性间质浸润，乳头和上皮复层也意味着浸润。**\n这个选项直接与基本原则2相矛盾，该原则要求“破坏性间质浸润”才能诊断为癌。问题明确指出该特征不存在。在*没有*破坏性浸润的情况下存在上皮增生（复层、乳头）是交界性肿瘤的定义，而不是癌。\n**结论：错误。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "一旦肿瘤被分类，下一步就是理解其预后以及其播散方式如何影响患者。本练习将介绍与浆液性交界性肿瘤相关的独特“种植”概念，以及非浸润性与浸润性种植之间的关键区别。这项实践 () 旨在挑战您推理非浸润性种植如何在不改变肿瘤基本分类的情况下，影响其预后和分期，这是妇科病理学中的一个核心知识点。",
            "id": "4454342",
            "problem": "一位外科医生为一名卵巢肿块诊断为浆液性交界性肿瘤（也称非典型增生性浆液性肿瘤）的患者请求病理会诊。从大网膜和盆腔腹膜活检了多个小的腹膜病变。组织学上，这些病变显示出具有层级分支和丛状结构的细胞增生，与浆液性交界性形态一致，但没有破坏性间质浸润。病理医生必须就这些发现对预后和分类/分期的预期影响提供建议。使用以下基本原则进行推理以得出答案：\n\n- 浸润的定义：癌要求肿瘤性上皮细胞穿过基底膜进行破坏性间质浸润；没有浸润的播散代表非破坏性种植，而非转移癌。\n- 分期和分类原则：国际妇产科联盟（FIGO）对卵巢肿瘤采用反映疾病分布的分期描述符；然而，诊断类别（交界性肿瘤与癌）取决于是否存在浸润。\n- 自然病程观察：浆液性交界性肿瘤和低级别浆液性癌代表一个生物学连续体的两端。浸润性种植与进展为低级别浆液性癌和疾病特异性生存率降低相关，而非浸润性种植缺乏破坏性间质浸润，主要与复发风险增加相关。\n\n假设，对于没有种植的浆液性交界性肿瘤，其 $10$ 年疾病特异性生存率为 $S_0 = 0.98$， $10$ 年复发概率为 $R_0 = 0.10$。在有非浸润性腹膜种植的队列中，研究报告与没有种植的患者相比，复发的相对风险为 $RR_R = 2.3$，而疾病特异性生存率仍然很高（接近 $S_0$）。根据上述基本原则，推导非浸润性种植应如何改变预后和分类：具体说明，非浸润性种植的存在是否将肿瘤重新分类为浸润癌类别，以及在复发和疾病特异性生存率方面预期的质变。\n\n哪个选项最能反映正确的推导结论？\n\nA. 非浸润性种植，因缺乏破坏性间质浸润，不会将诊断转变为癌；它们被记录为伴有卵巢外病变的浆液性交界性肿瘤，复发风险增加（例如，$R_1 \\approx RR_R \\times R_0$），但疾病特异性生存率仍维持在接近 $S_0$ 的高水平。\n\nB. 任何腹膜种植，无论是否浸润，都代表转移癌，会将肿瘤升级为低级别浆液性癌，并急剧降低疾病特异性生存率。\n\nC. 非浸润性种植是偶然发现，对复发或生存没有影响；它们使 $R_0$ 和 $S_0$ 均保持不变，并且不影响分期或分类。\n\nD. 非浸润性种植要求重新分类为癌，并进行铂类药物辅助化疗，因为它们显著增加了疾病特异性死亡的风险。\n\nE. 非浸润性种植的存在自动意味着微乳头状变异，因此根据定义构成浸润性种植，将肿瘤转变为癌。",
            "solution": "用户希望我首先验证问题陈述，如果有效，则推导出解决方案并评估给出的选项。\n\n### 问题验证\n\n**步骤1：提取已知信息**\n\n问题陈述提供了以下信息：\n-   **临床情景：** 一名患有卵巢浆液性交界性肿瘤（SBT）的患者被发现有多个小的腹膜病变。\n-   **组织学：** 原发性卵巢肿块为浆液性交界性肿瘤。腹膜病变显示出与SBT一致的形态，关键是**没有破坏性间质浸润**。\n-   **推理的基本原则：**\n    1.  **浸润的定义：** 癌的定义是破坏性间质浸润。没有这种浸润的播散是非破坏性种植，而不是转移癌。\n    2.  **分期和分类：** FIGO分期反映了疾病的分布。诊断（交界性肿瘤 vs. 癌）取决于是否存在浸润。\n    3.  **自然病程：** 浆液性交界性肿瘤和低级别浆液性癌是相关的。浸润性种植与进展为癌和生存率降低相关。非浸润性种植与复发风险增加相关，但生存率没有显著降低。\n-   **定量数据：**\n    -   对于无种植的SBT：$10$年疾病特异性生存率为 $S_0 = 0.98$。\n    -   对于无种植的SBT：$10$年复发概率为 $R_0 = 0.10$。\n    -   对于有非浸润性种植的SBT：复发的相对风险为 $RR_R = 2.3$。\n    -   对于有非浸润性种植的SBT：疾病特异性生存率据称保持“高水平（接近 $S_0$）”。\n-   **问题：** 确定非浸润性种植如何改变预后和分类，具体来说：（1）它们是否将肿瘤重新分类为癌，以及（2）复发率和生存率的质变。\n\n**步骤2：使用提取的已知信息进行验证**\n\n问题根据验证标准进行评估：\n-   **科学依据：** 是。该问题基于妇科病理学的基本和现行原则，特别是世界卫生组织（WHO）的卵巢肿瘤分类。浸润性与非浸润性种植之间的区别是一个关键且成熟的概念，它决定了诊断、预后和治疗。所提供的生存和复发统计数据对于这些实体是现实的。\n-   **问题明确：** 是。该问题提供了一个清晰的临床病理情景和一套明确的原则（“基本原则”），必须从中逻辑地推导出结论。问题具体，可以使用所提供的信息来回答。\n-   **客观性：** 是。语言是临床的、精确的，并且没有主观或带有偏见的陈述。\n\n问题没有表现出任何列举的缺陷（例如，科学上不健全、不完整、模棱两可）。它呈现了一个病理学中的标准推理任务。\n\n**步骤3：结论和行动**\n\n问题是**有效的**。现在将进行解答过程。\n\n### 解决方案的推导\n\n通过系统地将提供的“基本原则”应用于具体案例细节来推导解决方案。\n\n1.  **分类分析：**\n    -   “浸润的定义”原则指出，癌的诊断需要*破坏性间质浸润*。\n    -   问题明确指出，腹膜病变显示“无破坏性间质浸润”。\n    -   “分期和分类原则”指出，诊断类别（交界性肿瘤 vs. 癌）“取决于是否存在浸润”。\n    -   **关于分类的结论：** 由于腹膜病变中不存在破坏性浸润，它们被分类为*非浸润性种植*。因此，总体诊断**不**转变为癌。肿瘤仍然是浆液性交界性肿瘤。然而，卵巢外病变（种植体）的存在会改变FIGO分期以反映播散超出了卵巢（例如，II期或III期），但不会改变基本的肿瘤类型。\n\n2.  **预后分析（复发和生存）：**\n    -   “自然病程观察”原则区分了浸润性与非浸润性种植的预后意义。\n    -   对于**非浸润性种植**，该原则指出它们“主要与复发风险增加相关”。\n    -   定量数据支持这一点：复发的相对风险给出为 $RR_R = 2.3$。基线 $10$ 年复发概率为 $R_0 = 0.10$。我们可以估计新的复发概率 $R_1$ 为 $R_1 \\approx RR_R \\times R_0 = 2.3 \\times 0.10 = 0.23$。这是风险的显著增加（从 $10\\%$ 到 $23\\%$）。\n    -   对于**非浸润性种植**，该原则还指出“疾病特异性生存率仍然很高”。提供的数据证实了这一点，指出生存率保持在“接近 $S_0$”，其中 $S_0 = 0.98$。\n    -   **关于预后的结论：** 非浸润性种植的存在显著增加了疾病复发的概率，但对疾病特异性生存率的影响极小，生存率仍然很好。\n\n**推导结论摘要：**\n在卵巢浆液性交界性肿瘤的背景下，存在无破坏性间质浸润的腹膜病变，导致诊断为*伴有非浸润性种植的浆液性交界性肿瘤*。这一发现不会将诊断改变为癌。在预后方面，它与复发风险显著增加相关，但疾病特异性生存率仍然很高。\n\n### 逐项选项分析\n\n**A. 非浸润性种植，因缺乏破坏性间质浸润，不会将诊断转变为癌；它们被记录为伴有卵巢外病变的浆液性交界性肿瘤，复发风险增加（例如，$R_1 \\approx RR_R \\times R_0$），但疾病特异性生存率仍维持在接近 $S_0$ 的高水平。**\n-   **分析：** 此选项与推导出的结论完全一致。它正确地指出，由于缺乏浸润，诊断不是癌。它准确地描述了预后影响：复发风险增加（甚至根据提供的相对风险显示了正确的计算）和接近 $S_0=0.98$ 的高生存率。\n-   **结论：** **正确**。\n\n**B. 任何腹膜种植，无论是否浸润，都代表转移癌，会将肿瘤升级为低级别浆液性癌，并急剧降低疾病特异性生存率。**\n-   **分析：** 这一陈述直接与所提供的基本原则相矛盾。问题是围绕浸润性与非浸润性种植之间的关键区别构建的，而此选项错误地忽略了这一点。问题指出病变是非浸润性的，根据定义，它们不是癌。它也与生存率保持高水平的信息相矛盾。\n-   **结论：** **不正确**。\n\n**C. 非浸润性种植是偶然发现，对复发或生存没有影响；它们使 $R_0$ 和 $S_0$ 均保持不变，并且不影响分期或分类。**\n-   **分析：** 这是不正确的。基本原则和定量数据明确指出，非浸润性种植会增加复发风险（$RR_R = 2.3$）。虽然生存率基本不变，但复发率并非如此。此外，卵巢外病变（种植）的存在会影响FIGO分期。\n-   **结论：** **不正确**。\n\n**D. 非浸润性种植要求重新分类为癌，并进行铂类药物辅助化疗，因为它们显著增加了疾病特异性死亡的风险。**\n-   **分析：** 这是不正确的。如上所述，重新分类为癌是错误的。它们“显著增加疾病特异性死亡的风险”的前提也是错误的；问题指出生存率保持高水平，接近 $S_0 = 0.98$。因此，关于强制性化疗的后续结论是基于有缺陷的前提。\n-   **结论：** **不正确**。\n\n**E. 非浸潤性種植的存在自動意味著微乳頭狀變異，因此根據定義構成浸潤性種植，將腫瘤轉變為癌。**\n-   **分析：** 这一陈述包含多个事实和逻辑错误。首先，非浸润性种植并不自动意味着微乳头状变异。其次，更关键的是，微乳头状模式根据定义并不构成浸润性种植。一个种植是浸润性还是非浸润性，完全由种植部位是否存在破坏性间质浸润决定，而问题明确指出该特征不存在。\n-   **结论：** **不正确**。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "病理诊断不仅仅是观察细胞形态，它更像是一个利用多条线索解决诊断难题的过程。在卵巢病理学中，一个常见且至关重要的挑战是区分原发性卵巢肿瘤和转移癌，特别是来自胃肠道的转移癌。这项动手实践 () 将演示病理学家如何利用一组免疫组织化学（IHC）标记物，并应用概率推理（如朴素贝叶斯模型），系统地整合证据，从而得出最有可能的诊断。",
            "id": "4454383",
            "problem": "给定一个针对卵巢肿瘤的二元免疫组化组合，包含 CK7、CK20、CDX2、SATB2 和 PAX8。您必须实现一个贝叶斯分类器，使用贝叶斯定理和各标记物间的朴素条件独立性假设，来计算该肿瘤是原发性卵巢表面上皮性肿瘤与胃肠道 (GI) 原发性转移瘤的后验概率。\n\n基本原理：\n- 对于两个类别，贝叶斯定理指出，对于任意观测向量 $x$ 和类别 $C \\in \\{\\mathrm{O}, \\mathrm{G}\\}$，\n$$\nP(\\mathrm{O}\\mid x) \\;=\\; \\frac{P(\\mathrm{O}) \\, P(x \\mid \\mathrm{O})}{P(\\mathrm{O}) \\, P(x \\mid \\mathrm{O}) \\;+\\; P(\\mathrm{G}) \\, P(x \\mid \\mathrm{G})} \\,,\n$$\n在只考虑两个类别的情况下，有 $P(\\mathrm{G}) = 1 - P(\\mathrm{O})$。\n- 在朴素独立性假设下，\n$$\nP(x \\mid C) \\;=\\; \\prod_{i=1}^{5} P(m_i \\mid C)\\,,\n$$\n其中 $m_i$ 是单个标记物的结果。\n\n定义两个类别：\n- $\\mathrm{O}$：原发性卵巢表面上皮性肿瘤（聚合了浆液性和黏液性谱系）。\n- $\\mathrm{G}$：转移至卵巢的胃肠道原发性癌（例如，结直肠或阑尾来源）。\n\n使用以下经过充分检验、具有生物学合理性的、给定类别下标记物阳性的条件概率：\n- 对于 $\\mathrm{O}$：\n  - $P(\\mathrm{CK7}^+ \\mid \\mathrm{O}) = 0.85$\n  - $P(\\mathrm{CK20}^+ \\mid \\mathrm{O}) = 0.35$\n  - $P(\\mathrm{CDX2}^+ \\mid \\mathrm{O}) = 0.15$\n  - $P(\\mathrm{SATB2}^+ \\mid \\mathrm{O}) = 0.05$\n  - $P(\\mathrm{PAX8}^+ \\mid \\mathrm{O}) = 0.80$\n- 对于 $\\mathrm{G}$：\n  - $P(\\mathrm{CK7}^+ \\mid \\mathrm{G}) = 0.10$\n  - $P(\\mathrm{CK20}^+ \\mid \\mathrm{G}) = 0.85$\n  - $P(\\mathrm{CDX2}^+ \\mid \\mathrm{G}) = 0.90$\n  - $P(\\mathrm{SATB2}^+ \\mid \\mathrm{G}) = 0.70$\n  - $P(\\mathrm{PAX8}^+ \\mid \\mathrm{G}) = 0.02$\n\n对于阴性标记物，使用 $P(\\mathrm{marker}^- \\mid C) = 1 - P(\\mathrm{marker}^+ \\mid C)$。\n\n每个案例的输入表示：\n- 一个参数元组 $(p_{\\mathrm{O}}, p_{\\mathrm{G}}, \\mathrm{CK7}, \\mathrm{CK20}, \\mathrm{CDX2}, \\mathrm{SATB2}, \\mathrm{PAX8})$，其中：\n  - $p_{\\mathrm{O}} = P(\\mathrm{O})$ 且 $p_{\\mathrm{G}} = P(\\mathrm{G})$，满足 $p_{\\mathrm{O}} + p_{\\mathrm{G}} = 1$。\n  - 每个标记物的值是二元的：$\\mathrm{marker} = 1$ 代表阳性，$\\mathrm{marker} = 0$ 代表阴性。\n\n任务：\n- 对于每个测试用例，使用上述指定的贝叶斯定理和朴素独立性假设计算 $P(\\mathrm{O} \\mid \\mathrm{markers})$。\n- 将每个结果表示为精确到四位小数的小数（不带百分号）。\n- 不涉及物理单位。\n\n测试套件（按此顺序处理）：\n1. $(0.5, 0.5, 1, 0, 0, 0, 1)$\n2. $(0.5, 0.5, 0, 1, 1, 1, 0)$\n3. $(0.5, 0.5, 1, 1, 1, 0, 0)$\n4. $(0.3, 0.7, 1, 0, 0, 0, 1)$\n5. $(0.7, 0.3, 0, 1, 1, 1, 0)$\n6. $(0.5, 0.5, 0, 0, 0, 0, 0)$\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表，顺序与测试套件相同，例如：\n\"[r1,r2,r3,r4,r5,r6]\"\n其中每个 $r_i$ 是案例 $i$ 的后验概率 $P(\\mathrm{O} \\mid \\mathrm{markers})$，四舍五入到四位小数。",
            "solution": "用户提供了一个定义明确且有科学依据的问题。任务是实现一个朴素贝叶斯分类器，以根据免疫组化组合确定一个肿瘤是原发性卵巢来源还是胃肠道转移瘤的后验概率。\n\n### 步骤1：问题验证\n\n根据所需标准对问题陈述进行验证。\n\n**提取的已知条件：**\n1.  **针对两个类别 $\\mathrm{O}$ (卵巢) 和 $\\mathrm{G}$ (胃肠道) 的贝叶斯定理：**\n    $$\n    P(\\mathrm{O}\\mid x) \\;=\\; \\frac{P(\\mathrm{O}) \\, P(x \\mid \\mathrm{O})}{P(\\mathrm{O}) \\, P(x \\mid \\mathrm{O}) \\;+\\; P(\\mathrm{G}) \\, P(x \\mid \\mathrm{G})}\n    $$\n    其中 $P(\\mathrm{G}) = 1 - P(\\mathrm{O})$。\n2.  **朴素独立性假设：**观测向量 $x$（由标记物结果 $m_i$ 组成）的似然是单个标记物概率的乘积：\n    $$\n    P(x \\mid C) \\;=\\; \\prod_{i=1}^{5} P(m_i \\mid C)\n    $$\n3.  **类别：**$\\mathrm{O}$ = 原发性卵巢表面上皮性肿瘤，$\\mathrm{G}$ = 胃肠道原发性癌转移。\n4.  **标记物阳性的条件概率 ($P(\\mathrm{marker}^+ \\mid C)$)：**\n    -   对于类别 $\\mathrm{O}$：$P(\\mathrm{CK7}^+ \\mid \\mathrm{O}) = 0.85$, $P(\\mathrm{CK20}^+ \\mid \\mathrm{O}) = 0.35$, $P(\\mathrm{CDX2}^+ \\mid \\mathrm{O}) = 0.15$, $P(\\mathrm{SATB2}^+ \\mid \\mathrm{O}) = 0.05$, $P(\\mathrm{PAX8}^+ \\mid \\mathrm{O}) = 0.80$。\n    -   对于类别 $\\mathrm{G}$：$P(\\mathrm{CK7}^+ \\mid \\mathrm{G}) = 0.10$, $P(\\mathrm{CK20}^+ \\mid \\mathrm{G}) = 0.85$, $P(\\mathrm{CDX2}^+ \\mid \\mathrm{G}) = 0.90$, $P(\\mathrm{SATB2}^+ \\mid \\mathrm{G}) = 0.70$, $P(\\mathrm{PAX8}^+ \\mid \\mathrm{G}) = 0.02$。\n5.  **标记物阴性的条件概率：**$P(\\mathrm{marker}^- \\mid C) = 1 - P(\\mathrm{marker}^+ \\mid C)$。\n6.  **输入格式：**一个元组 $(p_{\\mathrm{O}}, p_{\\mathrm{G}}, \\mathrm{CK7}, \\mathrm{CK20}, \\mathrm{CDX2}, \\mathrm{SATB2}, \\mathrm{PAX8})$，其中 $p_{\\mathrm{O}} = P(\\mathrm{O})$, $p_{\\mathrm{G}} = P(\\mathrm{G})$，标记物值为 $1$ 代表阳性，$0$ 代表阴性。\n7.  **任务：**计算 $P(\\mathrm{O} \\mid \\mathrm{markers})$ 并四舍五入到四位小数。\n8.  **测试套件：**\n    1.  $(0.5, 0.5, 1, 0, 0, 0, 1)$\n    2.  $(0.5, 0.5, 0, 1, 1, 1, 0)$\n    3.  $(0.5, 0.5, 1, 1, 1, 0, 0)$\n    4.  $(0.3, 0.7, 1, 0, 0, 0, 1)$\n    5.  $(0.7, 0.3, 0, 1, 1, 1, 0)$\n    6.  $(0.5, 0.5, 0, 0, 0, 0, 0)$\n\n**验证结论：**\n该问题是 **有效的**。\n-   它具有 **科学依据**：它使用了概率论的基本原理——贝叶斯定理，并将其应用于外科病理学中一个现实的分类问题。所用的免疫组化标记物及其一般表达模式对于指定的肿瘤类型具有生物学上的合理性。\n-   它 **定义明确**：所有必要的信息都已提供，包括先验概率（针对每个测试用例）、条件概率（似然）和一个明确的目标函数。公式是明确的，确保每个案例都有唯一的解。\n-   它是 **客观的**：该问题用精确的量化数据和数学指令定义，没有歧义或主观因素。\n-   它不违反任何无效性标准。整个设置是完整的、一致的并且可以形式化。\n\n### 步骤2：求解推导\n\n目标是为给定的一组标记物观测值 $x$ 计算后验概率 $P(\\mathrm{O} \\mid x)$。这5个标记物的观测向量 $x$ 可以表示为 $x = (x_1, x_2, x_3, x_4, x_5)$，其中 $x_i \\in \\{0, 1\\}$ 对应于第 $i$ 个标记物（按顺序为 CK7, CK20, CDX2, SATB2, PAX8）的结果。\n\n计算的核心是贝叶斯定理：\n$$\nP(\\mathrm{O} \\mid x) = \\frac{P(\\mathrm{O}) P(x \\mid \\mathrm{O})}{P(x)}\n$$\n项 $P(x)$ 是观测到 $x$ 的边际概率，也称为证据 (evidence)。使用全概率公式，可以将其在两个类别上展开：\n$$\nP(x) = P(x \\mid \\mathrm{O}) P(\\mathrm{O}) + P(x \\mid \\mathrm{G}) P(\\mathrm{G})\n$$\n将此代入贝叶斯定理，得到问题陈述中提供的完整形式：\n$$\nP(\\mathrm{O} \\mid x) = \\frac{P(\\mathrm{O}) P(x \\mid \\mathrm{O})}{P(\\mathrm{O}) P(x \\mid \\mathrm{O}) + P(\\mathrm{G}) P(x \\mid \\mathrm{G})}\n$$\n项 $P(\\mathrm{O})$ 和 $P(\\mathrm{G})$ 是先验概率，在每个测试用例中给出。需要计算的关键组成部分是类条件似然，$P(x \\mid \\mathrm{O})$ 和 $P(x \\mid \\mathrm{G})$。\n\n在朴素独立性假设下，似然是给定类别下每个单独标记物观测概率的乘积：\n$$\nP(x \\mid C) = \\prod_{i=1}^{5} P(x_i \\mid C)\n$$\n其中 $C \\in \\{\\mathrm{O}, \\mathrm{G}\\}$。单个标记物观测 $x_i$ 的概率由其状态决定：\n-   如果标记物 $i$ 是阳性 ($x_i=1$)，我们使用 $P(x_i=1 \\mid C) = P(\\text{marker}_i^+ \\mid C)$。\n-   如果标记物 $i$ 是阴性 ($x_i=0$)，我们使用 $P(x_i=0 \\mid C) = P(\\text{marker}_i^- \\mid C) = 1 - P(\\text{marker}_i^+ \\mid C)$。\n\n让我们将类别 $C$ 中标记物 $i$ 阳性的条件概率定义为 $\\theta_{i,C} = P(\\text{marker}_i^+ \\mid C)$。那么观测到 $x_i$ 的概率是：\n$$\nP(x_i \\mid C) = (\\theta_{i,C})^{x_i} (1 - \\theta_{i,C})^{1-x_i}\n$$\n因此，类别 $C$ 的完整似然是：\n$$\nP(x \\mid C) = \\prod_{i=1}^{5} \\left[ (\\theta_{i,C})^{x_i} (1 - \\theta_{i,C})^{1-x_i} \\right]\n$$\n\n让我们以测试用例1为例进行演示：$(0.5, 0.5, 1, 0, 0, 0, 1)$。\n-   先验概率：$P(\\mathrm{O}) = 0.5$, $P(\\mathrm{G}) = 0.5$。\n-   观测向量 $x = (1, 0, 0, 0, 1)$，对应于 CK7$^+$、CK20$^-_、$、CDX2$^-、$、SATB2$^-、$、PAX8$^+$。\n\n首先，计算似然 $P(x \\mid \\mathrm{O})$：\n$P(x \\mid \\mathrm{O}) = P(\\mathrm{CK7}=1 \\mid \\mathrm{O}) \\times P(\\mathrm{CK20}=0 \\mid \\mathrm{O}) \\times P(\\mathrm{CDX2}=0 \\mid \\mathrm{O}) \\times P(\\mathrm{SATB2}=0 \\mid \\mathrm{O}) \\times P(\\mathrm{PAX8}=1 \\mid \\mathrm{O})$\n$P(x \\mid \\mathrm{O}) = P(\\mathrm{CK7}^+ \\mid \\mathrm{O}) \\times (1 - P(\\mathrm{CK20}^+ \\mid \\mathrm{O})) \\times (1 - P(\\mathrm{CDX2}^+ \\mid \\mathrm{O})) \\times (1 - P(\\mathrm{SATB2}^+ \\mid \\mathrm{O})) \\times P(\\mathrm{PAX8}^+ \\mid \\mathrm{O})$\n$P(x \\mid \\mathrm{O}) = 0.85 \\times (1 - 0.35) \\times (1 - 0.15) \\times (1 - 0.05) \\times 0.80$\n$P(x \\mid \\mathrm{O}) = 0.85 \\times 0.65 \\times 0.85 \\times 0.95 \\times 0.80 = 0.356405$\n\n接下来，计算似然 $P(x \\mid \\mathrm{G})$：\n$P(x \\mid \\mathrm{G}) = P(\\mathrm{CK7}=1 \\mid \\mathrm{G}) \\times P(\\mathrm{CK20}=0 \\mid \\mathrm{G}) \\times P(\\mathrm{CDX2}=0 \\mid \\mathrm{G}) \\times P(\\mathrm{SATB2}=0 \\mid \\mathrm{G}) \\times P(\\mathrm{PAX8}=1 \\mid \\mathrm{G})$\n$P(x \\mid \\mathrm{G}) = P(\\mathrm{CK7}^+ \\mid \\mathrm{G}) \\times (1 - P(\\mathrm{CK20}^+ \\mid \\mathrm{G})) \\times (1 - P(\\mathrm{CDX2}^+ \\mid \\mathrm{G})) \\times (1 - P(\\mathrm{SATB2}^+ \\mid \\mathrm{G})) \\times P(\\mathrm{PAX8}^+ \\mid \\mathrm{G})$\n$P(x \\mid \\mathrm{G}) = 0.10 \\times (1 - 0.85) \\times (1 - 0.90) \\times (1 - 0.70) \\times 0.02$\n$P(x \\mid \\mathrm{G}) = 0.10 \\times 0.15 \\times 0.10 \\times 0.30 \\times 0.02 = 0.000009$\n\n现在，将这些值代入后验概率公式：\n设 $N_\\mathrm{O} = P(\\mathrm{O}) P(x \\mid \\mathrm{O}) = 0.5 \\times 0.356405 = 0.1782025$。\n设 $N_\\mathrm{G} = P(\\mathrm{G}) P(x \\mid \\mathrm{G}) = 0.5 \\times 0.000009 = 0.0000045$。\n$$\nP(\\mathrm{O} \\mid x) = \\frac{N_\\mathrm{O}}{N_\\mathrm{O} + N_\\mathrm{G}} = \\frac{0.1782025}{0.1782025 + 0.0000045} = \\frac{0.1782025}{0.178207} \\approx 0.99997475...\n$$\n四舍五入到四位小数，结果是 $1.0000$。\n\n将此精确步骤系统地应用于问题陈述中提供的每个测试用例。实现将存储条件概率，并遍历每个测试用例，计算似然和最终的后验概率，然后按指定格式化结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a naive Bayes classifier to determine the posterior probability\n    of a tumor being a primary ovarian surface epithelial tumor versus a \n    gastrointestinal metastasis based on an immunohistochemistry panel.\n    \"\"\"\n\n    # Conditional probabilities P(marker_positive | Class)\n    # These are the well-tested, biologically plausible values given.\n    cond_probs = {\n        'O': { # Primary Ovarian Surface Epithelial Tumor\n            'CK7': 0.85, 'CK20': 0.35, 'CDX2': 0.15, 'SATB2': 0.05, 'PAX8': 0.80\n        },\n        'G': { # Gastrointestinal Primary Carcinoma Metastasis\n            'CK7': 0.10, 'CK20': 0.85, 'CDX2': 0.90, 'SATB2': 0.70, 'PAX8': 0.02\n        }\n    }\n    \n    # The order of markers in the test cases must match this list.\n    marker_names = ['CK7', 'CK20', 'CDX2', 'SATB2', 'PAX8']\n\n    # Test suite provided in the problem statement.\n    # Format: (prior_O, prior_G, CK7, CK20, CDX2, SATB2, PAX8)\n    test_cases = [\n        (0.5, 0.5, 1, 0, 0, 0, 1),\n        (0.5, 0.5, 0, 1, 1, 1, 0),\n        (0.5, 0.5, 1, 1, 1, 0, 0),\n        (0.3, 0.7, 1, 0, 0, 0, 1),\n        (0.7, 0.3, 0, 1, 1, 1, 0),\n        (0.5, 0.5, 0, 0, 0, 0, 0),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        prior_o, prior_g, *observations = case\n        \n        # Calculate likelihood P(x | C) for each class C in {O, G}\n        # P(x | C) = product[ P(marker_i | C) for i=1 to 5 ]\n        \n        # Likelihood for class O (Ovarian)\n        likelihood_terms_o = []\n        for i, status in enumerate(observations):\n            marker = marker_names[i]\n            prob_pos = cond_probs['O'][marker]\n            if status == 1: # Marker is positive\n                likelihood_terms_o.append(prob_pos)\n            else: # Marker is negative (status == 0)\n                likelihood_terms_o.append(1.0 - prob_pos)\n        likelihood_o = np.prod(likelihood_terms_o)\n\n        # Likelihood for class G (Gastrointestinal)\n        likelihood_terms_g = []\n        for i, status in enumerate(observations):\n            marker = marker_names[i]\n            prob_pos = cond_probs['G'][marker]\n            if status == 1: # Marker is positive\n                likelihood_terms_g.append(prob_pos)\n            else: # Marker is negative (status == 0)\n                likelihood_terms_g.append(1.0 - prob_pos)\n        likelihood_g = np.prod(likelihood_terms_g)\n\n        # Calculate the posterior probability P(O | x) using Bayes' theorem\n        # P(O | x) = (P(O) * P(x | O)) / (P(O) * P(x | O) + P(G) * P(x | G))\n        numerator = prior_o * likelihood_o\n        evidence = (prior_o * likelihood_o) + (prior_g * likelihood_g)\n        \n        # Guard against division by zero, though not expected with these probabilities.\n        if evidence == 0.0:\n            # If evidence is zero, the observation is impossible under the model.\n            # The posterior is ill-defined. We can default to the prior or 0.5.\n            # Given the problem's probabilities are all > 0 and  1, this won't happen.\n            posterior_o = prior_o\n        else:\n            posterior_o = numerator / evidence\n\n        # Format the result to exactly four decimal places and append.\n        results.append(f\"{posterior_o:.4f}\")\n\n    # Print the final output in the specified format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}