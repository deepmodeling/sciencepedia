{
    "hands_on_practices": [
        {
            "introduction": "The molecular clock is the engine of genomic epidemiology, allowing us to translate genetic differences into the currency of time. By modeling mutations as a Poisson process, we can forge a direct, quantitative link between a pathogen's substitution rate and the expected genetic distance between two related infections. This foundational practice walks you through the derivation of this crucial relationship, providing the essential formula for estimating how much genetic divergence to expect over a given period of an outbreak .",
            "id": "4527622",
            "problem": "In a clonal bacterial outbreak, two patients are infected from a common source at the same calendar time and then their infections evolve independently without recombination. Both patients are sampled at the same investigation time after an elapsed duration of $\\Delta t$ since their divergence from the common source. Assume a strict molecular clock with a per-site substitution rate $\\mu$ (substitutions per site per year), a core genome length of $L$ callable sites, and that mutations occur as independent events over sites according to a Poisson process. Starting from the definition of a Poisson process and the linearity of expectation, derive an expression for the expected number of single nucleotide polymorphism (SNP) differences between the two genomes at sampling in terms of $\\mu$, $L$, and $\\Delta t$. State the minimal modeling assumptions that make your expression a valid approximation in the context of genomic epidemiology for outbreak control. Then, using $\\mu = 1.0 \\times 10^{-6}$ substitutions per site per year, $L = 4.0 \\times 10^{6}$ sites, and $\\Delta t = 0.25$ years, compute the expected SNP difference. Round your final numerical answer to three significant figures. Express your final answer as a pure number (dimensionless count).",
            "solution": "The problem statement has been validated and is deemed sound. It is scientifically grounded, well-posed, and objective. All necessary parameters and definitions are provided, and it represents a formalizable problem in genomic epidemiology.\n\nThe problem asks for the derivation of the expected number of single nucleotide polymorphism (SNP) differences between two bacterial genomes that diverged from a common source.\n\nLet us define the parameters provided:\n- The per-site substitution rate is $\\mu$, with units of substitutions per site per year.\n- The core genome length is $L$ callable sites.\n- The elapsed time since divergence from the common source is $\\Delta t$ years.\n\nThe evolutionary scenario involves two lineages (in patient 1 and patient 2) that diverge from a common ancestor. Both lineages evolve independently for a duration of $\\Delta t$. The total evolutionary time separating the two sampled genomes is the sum of the lengths of the two branches back to their most recent common ancestor. Therefore, the total time for mutations to accumulate that distinguish the two genomes is $T = \\Delta t + \\Delta t = 2\\Delta t$.\n\nThe problem states that mutations occur as independent events over sites according to a Poisson process. We will first consider a single site, site $i$, where $i$ is an integer from $1$ to $L$.\n\nThe rate of substitution at this single site is $\\mu$. For a Poisson process, the rate parameter $\\lambda$ for a given interval is the product of the rate and the length of the interval. In this case, the interval is the total evolutionary time $T = 2\\Delta t$. Thus, the rate parameter for the number of substitutions at a single site $i$ is $\\lambda_{\\text{site}} = \\mu \\times T = 2\\mu\\Delta t$.\n\nLet $K_i$ be the random variable representing the number of substitutions that occur at site $i$ over the total evolutionary time $T$. According to the problem definition, $K_i$ follows a Poisson distribution with parameter $\\lambda_{\\text{site}}$.\n$$ K_i \\sim \\text{Poisson}(2\\mu\\Delta t) $$\nThe expected value of a Poisson-distributed random variable is equal to its rate parameter. Therefore, the expected number of substitutions at site $i$ is:\n$$ E[K_i] = 2\\mu\\Delta t $$\nNow, we consider the entire genome of length $L$. Let $K_{\\text{total}}$ be the total number of substitutions across all $L$ sites. Since mutations at different sites are assumed to be independent events, $K_{\\text{total}}$ is the sum of the substitutions at each site:\n$$ K_{\\text{total}} = \\sum_{i=1}^{L} K_i $$\nThe problem requires us to use the linearity of expectation. Applying this principle, the expected total number of substitutions is the sum of the individual expectations:\n$$ E[K_{\\text{total}}] = E\\left[\\sum_{i=1}^{L} K_i\\right] = \\sum_{i=1}^{L} E[K_i] $$\nSince the substitution rate $\\mu$ is assumed to be uniform across all $L$ sites, the expectation $E[K_i]$ is the same for every site $i$.\n$$ E[K_{\\text{total}}] = \\sum_{i=1}^{L} (2\\mu\\Delta t) = L(2\\mu\\Delta t) = 2\\mu L\\Delta t $$\nThe question asks for the expected number of SNP differences, which we denote as $E[N_{\\text{SNP}}]$. A SNP difference at a site corresponds to one or more substitution events having occurred at that site. The total number of substitutions, $K_{\\text{total}}$, is not strictly identical to the number of SNP differences, $N_{\\text{SNP}}$, because multiple substitutions can occur at the same site (an event known as a \"multiple hit\"). If a site experiences two or more substitutions, it still counts as only one SNP difference.\n\nHowever, in the context of short-term outbreaks in genomic epidemiology, the total evolutionary time $T = 2\\Delta t$ is typically very short, and the mutation rate $\\mu$ is low. Consequently, the rate parameter for a single site, $2\\mu\\Delta t$, is much less than $1$. For a Poisson process with a very small rate parameter $\\lambda$, the probability of observing two or more events, $P(k \\ge 2)$, is negligible compared to the probability of observing one event, $P(k=1)$.\n$P(k=0) = \\exp(-\\lambda) \\approx 1 - \\lambda$\n$P(k=1) = \\lambda \\exp(-\\lambda) \\approx \\lambda$\n$P(k=2) = \\frac{\\lambda^2}{2} \\exp(-\\lambda) \\approx \\frac{\\lambda^2}{2}$\nSince $\\lambda \\ll 1$, we have $\\lambda^2 \\ll \\lambda$. Therefore, the probability of multiple hits at a single site is negligible.\n\nUnder this valid approximation, the number of sites with at least one substitution ($N_{\\text{SNP}}$) is approximately equal to the total number of substitutions ($K_{\\text{total}}$). Thus, their expectations are also approximately equal:\n$$ E[N_{\\text{SNP}}] \\approx E[K_{\\text{total}}] $$\nSo, the derived expression for the expected number of SNP differences is:\n$$ E[N_{\\text{SNP}}] = 2\\mu L\\Delta t $$\nThe minimal modeling assumptions that make this expression a valid approximation are:\n1.  **Strict Molecular Clock**: The substitution rate $\\mu$ is constant over time and across all lineages.\n2.  **Uniform Rate Across Sites**: The substitution rate $\\mu$ is the same for all $L$ genomic sites.\n3.  **Independence of Sites**: Substitutions at different sites are independent events.\n4.  **Poisson Process**: The occurrence of substitutions over time follows a Poisson distribution.\n5.  **Clonal Evolution**: The genomes evolve without recombination.\n6.  **Rare Mutations Approximation**: The probability of multiple substitutions occurring at the same site over the time period is negligible ($2\\mu\\Delta t \\ll 1$), which allows the expected number of SNPs to be approximated by the expected number of substitutions.\n\nFinally, we compute the numerical value using the provided data:\n- $\\mu = 1.0 \\times 10^{-6}$ substitutions per site per year\n- $L = 4.0 \\times 10^{6}$ sites\n- $\\Delta t = 0.25$ years\n\nSubstituting these values into our derived expression:\n$$ E[N_{\\text{SNP}}] = 2 \\times (1.0 \\times 10^{-6}) \\times (4.0 \\times 10^{6}) \\times (0.25) $$\n$$ E[N_{\\text{SNP}}] = 2 \\times 1.0 \\times 4.0 \\times 0.25 \\times 10^{-6} \\times 10^{6} $$\n$$ E[N_{\\text{SNP}}] = (2 \\times 0.25) \\times 4.0 $$\n$$ E[N_{\\text{SNP}}] = 0.5 \\times 4.0 $$\n$$ E[N_{\\text{SNP}}] = 2.0 $$\nThe problem requires the answer to be rounded to three significant figures. Therefore, the result is $2.00$. The result is a dimensionless count, as the units cancel: $(\\text{site}^{-1} \\text{year}^{-1}) \\times (\\text{sites}) \\times (\\text{years})$.",
            "answer": "$$\n\\boxed{2.00}\n$$"
        },
        {
            "introduction": "Moving from estimation to action, a central task in outbreak control is deciding whether two cases are part of the same transmission chain. This requires setting a clear threshold on genetic distance, but where should we draw the line? This exercise demonstrates how to answer this question not by arbitrary choice, but through a principled statistical framework. You will model two competing scenarios—direct transmission versus unrelated community acquisition—and use their probabilistic properties to derive an optimal single-nucleotide polymorphism (SNP) threshold for defining a cluster .",
            "id": "4527583",
            "problem": "In genomic epidemiology for outbreak control within preventive medicine, a core decision problem is to determine whether two cases are linked by recent direct transmission or are unrelated community cases. Consider a pathogen with an approximately constant molecular clock, modeled by a Poisson mutation process: mutations along each lineage occur independently at a constant rate per unit time. Assume the following scientifically grounded facts as the derivation base: mutations accumulate approximately linearly in time under a molecular clock, and the number of accumulated single nucleotide polymorphisms (SNPs) along independent lineages is described by a Poisson process whose mean is proportional to elapsed time. Let the per-genome substitution rate be $\\mu$ substitutions per genome per year. For a pair of samples, let the total branch length in time (sum of times from the most recent common ancestor to each sample) be $L$, so the expected SNP count is $\\lambda = \\mu \\times L$, with the observed pairwise SNP count $D$ modeled as a Poisson random variable with mean $\\lambda$.\n\nYou are given the following outbreak context with parameters chosen to be realistic for a rapidly evolving respiratory virus:\n\n- Per-genome substitution rate $\\mu = 25$ substitutions per genome per year.\n- Two cases are sampled $t_{A} = 9$ days and $t_{B} = 14$ days after a transmission event in the direct-transmission scenario. Assume that, under direct transmission, the most recent common ancestor (MRCA) coincides with the transmission event, so the total branch length is $L_{\\mathrm{direct}} = t_{A} + t_{B}$ measured in days.\n- In the unrelated community scenario, the two cases’ lineages coalesce on average $T_{c} = 0.7$ years in the past, reflecting the background diversity in the circulating community. Under this scenario, approximate the total branch length by $L_{\\mathrm{unrelated}} = 2 T_{c} + \\frac{t_{A} + t_{B}}{365}$ measured in years (that is, the sum of times from the MRCA to each sample, including small within-host sampling delays).\n\nAssume equal prior probabilities and equal misclassification costs for the hypotheses “direct transmission” and “unrelated community” when deciding cluster membership based on the observed SNP distance $D$. Using the Poisson mutation model and these assumptions, compute the optimal integer SNP threshold $d^{*}$ at which a decision boundary should be placed, such that for $D \\leq d^{*}$ the pair is classified as a transmission-linked cluster and for $D > d^{*}$ it is classified as unrelated. Express your final answer as an integer number of single nucleotide polymorphisms (SNPs). No rounding instruction is necessary beyond taking the appropriate integer implied by the decision rule. Do not include units in your boxed final answer.",
            "solution": "The problem asks for an optimal integer threshold for classifying a pair of pathogen genomes as either linked by direct transmission or as unrelated community cases, based on the number of single nucleotide polymorphisms (SNPs) separating them. This is a classic binary hypothesis testing problem in statistical decision theory.\n\nFirst, we formalize the two competing hypotheses based on the provided information. Let $D$ be the observed number of SNPs, which is a random variable.\n-   Hypothesis $H_0$: The two cases are linked by direct transmission. Under this hypothesis, the SNP count $D$ follows a Poisson distribution with mean $\\lambda_0$, i.e., $D \\sim \\mathrm{Poisson}(\\lambda_0)$.\n-   Hypothesis $H_1$: The two cases are from the unrelated community. Under this hypothesis, the SNP count $D$ follows a Poisson distribution with mean $\\lambda_1$, i.e., $D \\sim \\mathrm{Poisson}(\\lambda_1)$.\n\nThe mean of the Poisson distribution, $\\lambda$, is given by the product of the per-genome substitution rate, $\\mu$, and the total branch length in time, $L$. Thus, $\\lambda = \\mu L$. We must calculate $\\lambda_0$ and $\\lambda_1$ using the given parameters, ensuring consistent units. The substitution rate is $\\mu = 25$ substitutions per genome per year. We will convert all time intervals to years. The number of days in a year is taken as $365$.\n\nThe sampling times for the two cases are $t_{A} = 9$ days and $t_{B} = 14$ days.\n\nUnder hypothesis $H_0$ (direct transmission), the total branch length is $L_{\\mathrm{direct}} = t_{A} + t_{B}$.\n$$L_{\\mathrm{direct}} = (9 + 14) \\text{ days} = 23 \\text{ days}$$\nConverting this to years:\n$$L_{\\mathrm{direct}} = \\frac{23}{365} \\text{ years}$$\nThe mean of the Poisson distribution under $H_0$ is:\n$$\\lambda_0 = \\mu \\times L_{\\mathrm{direct}} = 25 \\times \\frac{23}{365} = \\frac{575}{365} = \\frac{115}{73}$$\n\nUnder hypothesis $H_1$ (unrelated community), the total branch length is given by the formula $L_{\\mathrm{unrelated}} = 2 T_{c} + \\frac{t_{A} + t_{B}}{365}$, where the average coalescence time is $T_c = 0.7$ years.\n$$L_{\\mathrm{unrelated}} = 2 \\times 0.7 + \\frac{9+14}{365} = 1.4 + \\frac{23}{365} \\text{ years}$$\nThe mean of the Poisson distribution under $H_1$ is:\n$$\\lambda_1 = \\mu \\times L_{\\mathrm{unrelated}} = 25 \\times \\left(1.4 + \\frac{23}{365}\\right) = 25 \\times 1.4 + 25 \\times \\frac{23}{365}$$\n$$\\lambda_1 = 35 + \\lambda_0 = 35 + \\frac{115}{73} = \\frac{35 \\times 73 + 115}{73} = \\frac{2555 + 115}{73} = \\frac{2670}{73}$$\n\nThe problem states that we have equal prior probabilities for the hypotheses ($P(H_0) = P(H_1) = 0.5$) and equal misclassification costs. In this situation, the Bayes-optimal decision rule is to choose the hypothesis with the higher posterior probability, which simplifies to choosing the hypothesis with the higher likelihood. We should classify the observation $D$ as belonging to the \"direct transmission\" cluster ($H_0$) if the probability of observing $D$ under $H_0$ is greater than or equal to the probability of observing $D$ under $H_1$. The decision rule is to choose $H_0$ if $P(D|H_0) \\ge P(D|H_1)$.\n\nThe probability mass function for a Poisson random variable with mean $\\lambda$ is $P(D=k) = \\frac{\\exp(-\\lambda) \\lambda^k}{k!}$. So, our decision rule is:\n$$\\frac{\\exp(-\\lambda_0) \\lambda_0^D}{D!} \\ge \\frac{\\exp(-\\lambda_1) \\lambda_1^D}{D!}$$\nSince $D!$ is positive, we can cancel it.\n$$\\exp(-\\lambda_0) \\lambda_0^D \\ge \\exp(-\\lambda_1) \\lambda_1^D$$\nTaking the natural logarithm of both sides:\n$$-\\lambda_0 + D \\ln(\\lambda_0) \\ge -\\lambda_1 + D \\ln(\\lambda_1)$$\nRearranging the terms to solve for $D$:\n$$\\lambda_1 - \\lambda_0 \\ge D \\ln(\\lambda_1) - D \\ln(\\lambda_0)$$\n$$\\lambda_1 - \\lambda_0 \\ge D (\\ln(\\lambda_1) - \\ln(\\lambda_0))$$\nSince $L_{\\mathrm{unrelated}} > L_{\\mathrm{direct}}$, it follows that $\\lambda_1 > \\lambda_0$, and thus $\\ln(\\lambda_1) - \\ln(\\lambda_0) > 0$. We can divide by this term without changing the direction of the inequality:\n$$D \\le \\frac{\\lambda_1 - \\lambda_0}{\\ln(\\lambda_1) - \\ln(\\lambda_0)}$$\nLet's define the critical value $D_c = \\frac{\\lambda_1 - \\lambda_0}{\\ln(\\lambda_1) - \\ln(\\lambda_0)}$. The rule is to classify as $H_0$ if $D \\le D_c$.\n\nThe problem asks for an integer threshold $d^*$ such that a pair is classified as a transmission-linked cluster for $D \\le d^*$. The set of integer values of $D$ for which we classify as $H_0$ is $\\{0, 1, \\dots, d^*\\}$. This implies that $d^*$ must be the largest integer satisfying the condition $d^* \\le D_c$. Therefore, the optimal integer threshold is $d^* = \\lfloor D_c \\rfloor$.\n\nNow we substitute the numerical values for $\\lambda_0$ and $\\lambda_1$:\n$$\\lambda_0 = \\frac{115}{73} \\approx 1.5753$$\n$$\\lambda_1 = \\frac{2670}{73} \\approx 36.5753$$\nThe difference is $\\lambda_1 - \\lambda_0 = 35$.\nThe ratio is $\\frac{\\lambda_1}{\\lambda_0} = \\frac{2670/73}{115/73} = \\frac{2670}{115} = \\frac{534}{23}$.\n\nWe compute $D_c$:\n$$D_c = \\frac{\\lambda_1 - \\lambda_0}{\\ln(\\lambda_1/\\lambda_0)} = \\frac{35}{\\ln(534/23)}$$\nUsing numerical values:\n$$D_c \\approx \\frac{35}{\\ln(23.21739...)} \\approx \\frac{35}{3.14490...} \\approx 11.1291$$\nThe optimal integer threshold $d^*$ is the floor of this value:\n$$d^* = \\lfloor D_c \\rfloor = \\lfloor 11.1291 \\rfloor = 11$$\n\nThus, the optimal decision boundary is at $11$ SNPs. If the observed SNP count $D$ is less than or equal to $11$, the pair is classified as a direct transmission. If $D$ is greater than $11$, it is classified as unrelated.",
            "answer": "$$\\boxed{11}$$"
        },
        {
            "introduction": "Effective outbreak response hinges on integrating all available evidence. In practice, genomic data is most powerful when combined with traditional epidemiological information from contact tracing. This final exercise challenges you to implement an algorithm that does just that, mirroring the logic used in public health informatics. You will build and evaluate a clustering rule that uses both a strict genetic threshold and a more lenient threshold for cases with a known epidemiologic link, providing a hands-on look at how these data streams are synthesized to achieve more accurate and robust outbreak investigation .",
            "id": "4527634",
            "problem": "A public health team is investigating potential transmission clusters in a pathogen outbreak using genome sequence data and contact-tracing data. Each case is represented by a vertex in a graph. You are given, for each test case, a symmetric matrix of pairwise Single Nucleotide Variant (SNV) distances, a symmetric binary epidemiologic linkage matrix, and a ground-truth partition of cases into transmission clusters (for evaluation only). Your task is to derive, implement, and evaluate an algorithm that integrates sequence similarity and epidemiologic linkage to infer clusters and quantify the rate at which unrelated cases are incorrectly grouped together.\n\nBase definitions and constraints:\n- A Single Nucleotide Variant (SNV) distance between two cases is the count of nucleotide differences across a comparable genomic region; denote the distance matrix by $D \\in \\mathbb{N}^{n \\times n}$, where $D_{ii} = 0$ and $D_{ij} = D_{ji}$ for all $i \\neq j$.\n- Epidemiologic linkage is represented by a symmetric binary matrix $L \\in \\{0,1\\}^{n \\times n}$ with $L_{ii} = 0$ and $L_{ij} = L_{ji}$. A value of $L_{ij} = 1$ indicates that there is documented linkage consistent with potential transmission between cases $i$ and $j$.\n- Let $t_s \\in \\mathbb{N}$ be a strict SNV threshold and $t_e \\in \\mathbb{N}$ be an epidemiologically lenient SNV threshold with $t_s \\leq t_e$.\n\nPrinciple to use:\n- In genomic epidemiology, closely related genomes (small SNV distance) and corroborating epidemiologic linkages both support recent transmission. Model this by constructing an undirected graph $G$ on $n$ vertices with an edge between vertices $i$ and $j$ if and only if either:\n  1. $D_{ij} \\leq t_s$, or\n  2. $L_{ij} = 1$ and $D_{ij} \\leq t_e$.\n- Infer clusters as the connected components of $G$.\n\nEvaluation metric to compute:\n- Let the ground truth be given as a partition of $\\{0,1,\\dots,n-1\\}$ into sets, which induces a symmetric matrix $T \\in \\{0,1\\}^{n \\times n}$ with $T_{ij} = 1$ if and only if $i$ and $j$ are in the same true cluster and $i \\neq j$, and $T_{ii} = 0$.\n- Let $\\widehat{C}$ be the inferred clustering. Define the set of inferred-positive pairs $\\mathcal{P} = \\{(i,j) : 0 \\leq i < j \\leq n-1, \\text{ and } i,j \\text{ are in the same connected component of } G\\}$.\n- Define the number of true positives as $\\mathrm{TP} = \\sum_{(i,j) \\in \\mathcal{P}} \\mathbf{1}\\{T_{ij} = 1\\}$ and the number of false positives as $\\mathrm{FP} = \\sum_{(i,j) \\in \\mathcal{P}} \\mathbf{1}\\{T_{ij} = 0\\}$, where $\\mathbf{1}\\{\\cdot\\}$ is the indicator function.\n- Define the false clustering rate (as a decimal) by\n$$\n\\mathrm{FCR} =\n\\begin{cases}\n\\dfrac{\\mathrm{FP}}{\\mathrm{TP} + \\mathrm{FP}}, & \\text{if } \\mathrm{TP} + \\mathrm{FP} > 0, \\\\\n0, & \\text{if } \\mathrm{TP} + \\mathrm{FP} = 0.\n\\end{cases}\n$$\n\nImplement a program that, for each test case below, constructs $G$ using the decision rule above with the given thresholds and returns the false clustering rate. All outputs must be decimals rounded to $3$ decimal places.\n\nTest suite:\n- Use $t_s = 2$ and $t_e = 5$ for all test cases.\n\n- Test case $1$ ($n=6$):\n  - SNV distances\n    $$\n    D =\n    \\begin{bmatrix}\n    0 & 2 & 4 & 8 & 7 & 6 \\\\\n    2 & 0 & 3 & 9 & 8 & 7 \\\\\n    4 & 3 & 0 & 10 & 9 & 8 \\\\\n    8 & 9 & 10 & 0 & 1 & 12 \\\\\n    7 & 8 & 9 & 1 & 0 & 11 \\\\\n    6 & 7 & 8 & 12 & 11 & 0\n    \\end{bmatrix}\n    $$\n  - Epidemiologic linkage\n    $$\n    L =\n    \\begin{bmatrix}\n    0 & 1 & 0 & 0 & 0 & 0 \\\\\n    1 & 0 & 1 & 0 & 0 & 0 \\\\\n    0 & 1 & 0 & 0 & 0 & 0 \\\\\n    0 & 0 & 0 & 0 & 1 & 0 \\\\\n    0 & 0 & 0 & 1 & 0 & 0 \\\\\n    0 & 0 & 0 & 0 & 0 & 0\n    \\end{bmatrix}\n    $$\n  - Ground truth clusters: $\\{\\{0,1,2\\}, \\{3,4\\}, \\{5\\}\\}$.\n\n- Test case $2$ ($n=3$):\n  - SNV distances\n    $$\n    D =\n    \\begin{bmatrix}\n    0 & 9 & 9 \\\\\n    9 & 0 & 9 \\\\\n    9 & 9 & 0\n    \\end{bmatrix}\n    $$\n  - Epidemiologic linkage\n    $$\n    L =\n    \\begin{bmatrix}\n    0 & 0 & 0 \\\\\n    0 & 0 & 0 \\\\\n    0 & 0 & 0\n    \\end{bmatrix}\n    $$\n  - Ground truth clusters: $\\{\\{0\\}, \\{1\\}, \\{2\\}\\}$.\n\n- Test case $3$ ($n=5$):\n  - SNV distances\n    $$\n    D =\n    \\begin{bmatrix}\n    0 & 2 & 4 & 9 & 10 \\\\\n    2 & 0 & 2 & 8 & 9 \\\\\n    4 & 2 & 0 & 5 & 9 \\\\\n    9 & 8 & 5 & 0 & 2 \\\\\n    10 & 9 & 9 & 2 & 0\n    \\end{bmatrix}\n    $$\n  - Epidemiologic linkage\n    $$\n    L =\n    \\begin{bmatrix}\n    0 & 0 & 0 & 0 & 0 \\\\\n    0 & 0 & 0 & 0 & 0 \\\\\n    0 & 0 & 0 & 1 & 0 \\\\\n    0 & 0 & 1 & 0 & 0 \\\\\n    0 & 0 & 0 & 0 & 0\n    \\end{bmatrix}\n    $$\n  - Ground truth clusters: $\\{\\{0,1,2\\}, \\{3,4\\}\\}$.\n\n- Test case $4$ ($n=4$):\n  - SNV distances\n    $$\n    D =\n    \\begin{bmatrix}\n    0 & 2 & 5 & 6 \\\\\n    2 & 0 & 6 & 5 \\\\\n    5 & 6 & 0 & 5 \\\\\n    6 & 5 & 5 & 0\n    \\end{bmatrix}\n    $$\n  - Epidemiologic linkage\n    $$\n    L =\n    \\begin{bmatrix}\n    0 & 0 & 0 & 0 \\\\\n    0 & 0 & 0 & 0 \\\\\n    0 & 0 & 0 & 1 \\\\\n    0 & 0 & 1 & 0\n    \\end{bmatrix}\n    $$\n  - Ground truth clusters: $\\{\\{0,1\\}, \\{2,3\\}\\}$.\n\nFinal output format:\n- Your program should produce a single line of output containing the false clustering rates for the $4$ test cases, ordered from test case $1$ to test case $4$, as a comma-separated list enclosed in square brackets, with each value rounded to $3$ decimal places (e.g., $[0.123,0.000,0.700,0.250]$).",
            "solution": "The problem requires the implementation and evaluation of an algorithm for inferring pathogen transmission clusters by integrating genomic and epidemiologic data. The evaluation is performed by calculating the False Clustering Rate (FCR) against a provided ground truth. The procedure is deterministic and can be broken down into three main stages: graph construction, cluster identification, and metric computation.\n\nLet $n$ be the number of cases under investigation. The inputs for each test case are a symmetric Single Nucleotide Variant (SNV) distance matrix $D \\in \\mathbb{N}^{n \\times n}$, a symmetric binary epidemiologic linkage matrix $L \\in \\{0,1\\}^{n \\times n}$, a strict SNV threshold $t_s$, and a lenient SNV threshold $t_e$. For this problem, the thresholds are fixed at $t_s = 2$ and $t_e = 5$.\n\nFirst, we construct a weighted adjacency matrix $A \\in \\{0,1\\}^{n \\times n}$ for an undirected graph $G=(V, E)$, where $V = \\{0, 1, \\dots, n-1\\}$ represents the cases. An edge $(i, j)$ exists between two distinct cases $i$ and $j$ if they are deemed related by the specified criteria. The matrix entry $A_{ij}$ is defined as:\n$$\nA_{ij} = \\begin{cases}\n1 & \\text{if } (D_{ij} \\leq t_s) \\lor (L_{ij} = 1 \\land D_{ij} \\leq t_e) \\\\\n0 & \\text{otherwise}\n\\end{cases}\n$$\nfor all $i \\neq j$. The diagonal entries are $A_{ii} = 0$. The condition $D_{ij} \\leq t_s$ links cases based on high genetic similarity alone, suggesting very recent transmission. The second condition, $L_{ij} = 1 \\land D_{ij} \\leq t_e$, integrates epidemiologic evidence ($L_{ij} = 1$) with a more relaxed genetic distance threshold ($D_{ij} \\leq t_e$), allowing for slightly more divergent genomes to be linked if there is a known contact.\n\nSecond, the inferred transmission clusters are defined as the connected components of the graph $G$. A connected component is a subgraph in which any two vertices are connected to each other by a path, and which is connected to no additional vertices in the supergraph. Standard algorithms such as Breadth-First Search (BFS) or Depth-First Search (DFS) can be employed to find these components from the adjacency matrix $A$. The result is a partition of the set of vertices $V$ into disjoint subsets, where each subset constitutes an inferred cluster. Let this inferred clustering be denoted by $\\widehat{C}$.\n\nThird, we evaluate the inferred clustering $\\widehat{C}$ against the ground-truth clustering. The evaluation is based on pairwise relationships. We first define the set of inferred-positive pairs, $\\mathcal{P}$, as all unique pairs of cases $(i, j)$ with $i < j$ that are grouped into the same inferred cluster.\n$$\n\\mathcal{P} = \\{(i,j) : 0 \\leq i < j \\leq n-1, \\text{ and } i,j \\text{ are in the same connected component of } G\\}\n$$\nThe ground truth is given as a partition of the cases, which defines a corresponding truth matrix $T \\in \\{0,1\\}^{n \\times n}$, where $T_{ij} = 1$ if and only if cases $i$ and $j$ belong to the same true cluster ($i \\neq j$). For each pair $(i, j) \\in \\mathcal{P}$, we classify it as a True Positive (TP) if they are also in the same true cluster ($T_{ij} = 1$), or a False Positive (FP) if they are not ($T_{ij} = 0$). The total counts are:\n$$\n\\mathrm{TP} = \\sum_{(i,j) \\in \\mathcal{P}} \\mathbf{1}\\{T_{ij} = 1\\}\n$$\n$$\n\\mathrm{FP} = \\sum_{(i,j) \\in \\mathcal{P}} \\mathbf{1}\\{T_{ij} = 0\\}\n$$\nwhere $\\mathbf{1}\\{\\cdot\\}$ is the indicator function.\n\nFinally, the False Clustering Rate (FCR) is calculated. This metric represents the proportion of incorrectly clustered pairs among all pairs that were clustered together by the algorithm. The formula is:\n$$\n\\mathrm{FCR} =\n\\begin{cases}\n\\dfrac{\\mathrm{FP}}{\\mathrm{TP} + \\mathrm{FP}}, & \\text{if } \\mathrm{TP} + \\mathrm{FP} > 0 \\\\\n0, & \\text{if } \\mathrm{TP} + \\mathrm{FP} = 0\n\\end{cases}\n$$\nIf no pairs are clustered together by the algorithm, $\\mathrm{TP} + \\mathrm{FP} = 0$ and the FCR is $0$.\n\nThis entire procedure is applied to each test case to compute the corresponding FCR, which is then rounded to $3$ decimal places as required. The `scipy.sparse.csgraph.connected_components` function is a suitable tool for identifying the clusters from the adjacency matrix $A$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse.csgraph import connected_components\n\ndef solve():\n    \"\"\"\n    Solves the genomic epidemiology clustering problem for the given test cases.\n    \"\"\"\n    \n    # Define the global thresholds from the problem statement.\n    t_s = 2\n    t_e = 5\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"D\": np.array([\n                [0, 2, 4, 8, 7, 6],\n                [2, 0, 3, 9, 8, 7],\n                [4, 3, 0, 10, 9, 8],\n                [8, 9, 10, 0, 1, 12],\n                [7, 8, 9, 1, 0, 11],\n                [6, 7, 8, 12, 11, 0]\n            ]),\n            \"L\": np.array([\n                [0, 1, 0, 0, 0, 0],\n                [1, 0, 1, 0, 0, 0],\n                [0, 1, 0, 0, 0, 0],\n                [0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 1, 0, 0],\n                [0, 0, 0, 0, 0, 0]\n            ]),\n            \"true_clusters\": [{0, 1, 2}, {3, 4}, {5}]\n        },\n        {\n            \"D\": np.array([\n                [0, 9, 9],\n                [9, 0, 9],\n                [9, 9, 0]\n            ]),\n            \"L\": np.array([\n                [0, 0, 0],\n                [0, 0, 0],\n                [0, 0, 0]\n            ]),\n            \"true_clusters\": [{0}, {1}, {2}]\n        },\n        {\n            \"D\": np.array([\n                [0, 2, 4, 9, 10],\n                [2, 0, 2, 8, 9],\n                [4, 2, 0, 5, 9],\n                [9, 8, 5, 0, 2],\n                [10, 9, 9, 2, 0]\n            ]),\n            \"L\": np.array([\n                [0, 0, 0, 0, 0],\n                [0, 0, 0, 0, 0],\n                [0, 0, 0, 1, 0],\n                [0, 0, 1, 0, 0],\n                [0, 0, 0, 0, 0]\n            ]),\n            \"true_clusters\": [{0, 1, 2}, {3, 4}]\n        },\n        {\n            \"D\": np.array([\n                [0, 2, 5, 6],\n                [2, 0, 6, 5],\n                [5, 6, 0, 5],\n                [6, 5, 5, 0]\n            ]),\n            \"L\": np.array([\n                [0, 0, 0, 0],\n                [0, 0, 0, 0],\n                [0, 0, 0, 1],\n                [0, 0, 1, 0]\n            ]),\n            \"true_clusters\": [{0, 1}, {2, 3}]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        D = case[\"D\"]\n        L = case[\"L\"]\n        true_clusters = case[\"true_clusters\"]\n        n = D.shape[0]\n\n        # 1. Construct the adjacency matrix A for graph G.\n        A = np.zeros((n, n), dtype=int)\n        for i in range(n):\n            for j in range(i + 1, n):\n                if (D[i, j] <= t_s) or (L[i, j] == 1 and D[i, j] <= t_e):\n                    A[i, j] = 1\n                    A[j, i] = 1\n\n        # 2. Infer clusters as connected components of G.\n        n_components, labels = connected_components(csgraph=A, directed=False, return_labels=True)\n\n        # 3. Create a look-up for ground truth pairs.\n        true_pairs = set()\n        for cluster in true_clusters:\n            cluster_nodes = sorted(list(cluster))\n            for i in range(len(cluster_nodes)):\n                for j in range(i + 1, len(cluster_nodes)):\n                    true_pairs.add((cluster_nodes[i], cluster_nodes[j]))\n\n        # 4. Calculate TP and FP based on inferred clusters.\n        tp = 0\n        fp = 0\n        \n        # Iterate through all unique pairs (i, j) with i < j.\n        for i in range(n):\n            for j in range(i + 1, n):\n                # Check if the pair is in the same inferred cluster.\n                if labels[i] == labels[j]:\n                    pair = (i, j)\n                    if pair in true_pairs:\n                        tp += 1\n                    else:\n                        fp += 1\n        \n        # 5. Calculate the False Clustering Rate (FCR).\n        denominator = tp + fp\n        if denominator == 0:\n            fcr = 0.0\n        else:\n            fcr = fp / denominator\n        \n        results.append(fcr)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"{r:.3f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}