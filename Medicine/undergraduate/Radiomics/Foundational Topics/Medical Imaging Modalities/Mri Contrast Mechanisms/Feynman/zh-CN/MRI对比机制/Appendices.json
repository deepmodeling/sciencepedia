{
    "hands_on_practices": [
        {
            "introduction": "在磁共振成像中，重复时间（$TR$）是决定图像对比度的关键序列参数之一。通过精确设置$TR$，我们可以在质子密度（$PD$）加权和$T_1$加权图像之间进行选择。本练习将引导你通过计算来理解如何选择一个足够长的$TR$以获得$PD$主导的图像，并让你切身体会到在追求理想对比度的同时，扫描时间成本会如何显著增加。",
            "id": "4552293",
            "problem": "一个影像组学方案必须从脑部磁共振成像（MRI）中提取强度特征，其方式需要强调质子密度（PD）对比，同时最大限度地减少纵向弛豫时间（$T_1$）和横向弛豫时间（$T_2$）的对比度。考虑一个单回波自旋回波采集序列，其回波时间（$\\mathrm{TE}$）很短（固定且足够小），并使用一个基准重复时间（$\\mathrm{TR}_0$）进行$T_1$加权扫描。对于矩阵大小和信号平均次数固定的二维采集，其扫描时间与重复时间$\\,\\mathrm{TR}\\,$成正比。\n\n成像野中包含白质（纵向弛豫时间 $T_1 = 900~\\mathrm{ms}$）、灰质（纵向弛豫时间 $T_1 = 1400~\\mathrm{ms}$）和脑脊液（纵向弛豫时间 $T_1 = 4000~\\mathrm{ms}$）。定义一个以PD为主的采集，为其中具有最长纵向弛豫时间的组织，在下一次射频激发施加时，其纵向磁化强度至少已恢复到其平衡值的 $f = 0.95$。基准重复时间为 $\\mathrm{TR}_0 = 500~\\mathrm{ms}$。\n\n从纵向弛豫的基本原理和标准自旋回波信号形成出发，推导为满足具有最大$T_1$的组织的PD为主标准所需的最小重复时间$\\,\\mathrm{TR}_{\\min}\\,$，并计算相对扫描时间增加因子$R$，其定义为 $R = \\mathrm{TR}_{\\min}/\\mathrm{TR}_0$。将您的$R$最终值四舍五入至四位有效数字，并将其表示为无量纲因子。\n\n此外，在您的推导过程中，请利用纵向恢复的数学形式及其速率，解释为什么将$\\,\\mathrm{TR}\\,$延长至超过最长的$T_1$时，对于进一步减少残余$T_1$加权会呈现收益递减的现象。",
            "solution": "该问题是有效的，因为它在科学上基于磁共振成像（MRI）的原理，问题陈述清晰且数据充分一致，并以客观、正式的语言表述。因此，我们可以着手求解。\n\n该问题要求推导质子密度（PD）为主的自旋回波采集的最小重复时间$\\mathrm{TR}_{\\min}$，并随后计算相对扫描时间增加因子$R$。\n\n首先，我们建立基本原理。根据布洛赫方程的解，具有纵向弛豫时间$T_1$的组织的纵向磁化强度$M_z$在一次$90^\\circ$射频（RF）激发脉冲后按如下规律恢复：\n$$M_z(t) = M_0 \\left(1 - \\exp\\left(-\\frac{t}{T_1}\\right)\\right)$$\n其中，$M_0$是与质子密度$\\rho$成正比的平衡磁化强度，$t$是自激发以来经过的时间。在自旋回波序列中，这个恢复时间就是重复时间$\\mathrm{TR}$。因此，在下一次射频脉冲前可用的纵向磁化强度为：\n$$M_z(\\mathrm{TR}) = M_0 \\left(1 - \\exp\\left(-\\frac{\\mathrm{TR}}{T_1}\\right)\\right)$$\n\n在自旋回波实验中，信号强度$S$与$90^\\circ$脉冲后立即产生的横向磁化强度成正比（其值为$M_z(\\mathrm{TR})$），并且还取决于在回波时间$\\mathrm{TE}$内发生的横向弛豫。信号方程为：\n$$S \\propto \\rho \\left(1 - \\exp\\left(-\\frac{\\mathrm{TR}}{T_1}\\right)\\right) \\exp\\left(-\\frac{\\mathrm{TE}}{T_2}\\right)$$\n为获得以PD为主的图像，必须将$T_1$和$T_2$的对比度贡献最小化。问题陈述$\\mathrm{TE}$“足够小”，这意味着对所有组织而言$\\mathrm{TE} \\ll T_2$。这使得$\\exp(-\\mathrm{TE}/T_2)$项趋近于1，从而最小化$T_2$加权。为最小化$T_1$加权，$(1 - \\exp(-\\mathrm{TR}/T_1))$项必须趋近于1。这要求$\\mathrm{TR} \\gg T_1$。\n\n问题为以PD为主的采集提供了一个具体标准：具有最大$T_1$的组织必须恢复至少其平衡纵向磁化强度的$f=0.95$。恢复分数为$\\frac{M_z(\\mathrm{TR})}{M_0}$。因此条件是：\n$$\\frac{M_z(\\mathrm{TR})}{M_0} = 1 - \\exp\\left(-\\frac{\\mathrm{TR}}{T_1}\\right) \\geq f$$\n我们需要找到满足这一条件的最小$\\mathrm{TR}$，记为$\\mathrm{TR}_{\\min}$，针对具有最大$T_1$的组织。所给的组织是白质（$T_1 = 900~\\mathrm{ms}$）、灰质（$T_1 = 1400~\\mathrm{ms}$）和脑脊液（CSF）（$T_1 = 4000~\\mathrm{ms}$）。最大的$T_1$是脑脊液的$T_1$，所以我们设$T_{1,\\text{max}} = 4000~\\mathrm{ms}$。\n\n为了找到最小TR，我们使用等式：\n$$1 - \\exp\\left(-\\frac{\\mathrm{TR}_{\\min}}{T_{1,\\text{max}}}\\right) = f$$\n我们现在求解$\\mathrm{TR}_{\\min}$：\n$$\\exp\\left(-\\frac{\\mathrm{TR}_{\\min}}{T_{1,\\text{max}}}\\right) = 1 - f$$\n取两边的自然对数：\n$$-\\frac{\\mathrm{TR}_{\\min}}{T_{1,\\text{max}}} = \\ln(1 - f)$$\n$$\\mathrm{TR}_{\\min} = -T_{1,\\text{max}} \\ln(1 - f)$$\n代入给定值，$T_{1,\\text{max}} = 4000~\\mathrm{ms}$ 和 $f = 0.95$：\n$$\\mathrm{TR}_{\\min} = -4000 \\ln(1 - 0.95) = -4000 \\ln(0.05)~\\mathrm{ms}$$\n利用性质 $\\ln(x) = -\\ln(1/x)$，我们可以写成：\n$$\\mathrm{TR}_{\\min} = 4000 \\ln\\left(\\frac{1}{0.05}\\right) = 4000 \\ln(20)~\\mathrm{ms}$$\n\n接下来，我们计算相对扫描时间增加因子$R$，其定义为$R = \\mathrm{TR}_{\\min}/\\mathrm{TR}_0$。给定的基准重复时间为$\\mathrm{TR}_0 = 500~\\mathrm{ms}$。\n$$R = \\frac{\\mathrm{TR}_{\\min}}{\\mathrm{TR}_0} = \\frac{-T_{1,\\text{max}} \\ln(1 - f)}{\\mathrm{TR}_0}$$\n代入数值：\n$$R = \\frac{-4000~\\mathrm{ms} \\times \\ln(0.05)}{500~\\mathrm{ms}} = -8 \\ln(0.05) = 8 \\ln(20)$$\n为获得数值结果，我们使用$\\ln(20) \\approx 2.99573227$。\n$$R = 8 \\times 2.99573227 \\approx 23.965858$$\n将此结果四舍五入至四位有效数字，得到$23.97$。\n\n最后，我们来解决这个问题：为什么将$\\mathrm{TR}$延长至超过最长的$T_1$时，在减少残余$T_1$加权方面会呈现收益递减。$T_1$加权的程度取决于因子$g(\\mathrm{TR}) = 1 - \\exp(-\\mathrm{TR}/T_1)$偏离1的程度。增加$\\mathrm{TR}$的“收益”是该因子的增加，这使得信号更接近其纯粹的PD依赖性。我们可以通过考察$g(\\mathrm{TR})$相对于$\\mathrm{TR}$的变化率来分析这一点：\n$$\\frac{dg}{d\\mathrm{TR}} = \\frac{d}{d\\mathrm{TR}}\\left(1 - \\exp\\left(-\\frac{\\mathrm{TR}}{T_1}\\right)\\right) = -\\left(-\\frac{1}{T_1}\\right) \\exp\\left(-\\frac{\\mathrm{TR}}{T_1}\\right) = \\frac{1}{T_1} \\exp\\left(-\\frac{\\mathrm{TR}}{T_1}\\right)$$\n这个导数代表了每单位TR增加所带来的信号恢复的边际增益。函数$\\exp(-\\mathrm{TR}/T_1)$是$\\mathrm{TR}$的一个指数衰减函数。\n- 当$\\mathrm{TR}$很短时（例如，$\\mathrm{TR} \\ll T_1$），指数项接近于1，恢复速率很显著（接近$1/T_1$）。$\\mathrm{TR}$的微小增加会导致$T_1$加权的大幅减少。\n- 当$\\mathrm{TR}$变得很长时（例如，$\\mathrm{TR} > 3T_1$，此时恢复已超过$95\\%$），$\\exp(-\\mathrm{TR}/T_1)$项变得非常小。因此，恢复速率$\\frac{1}{T_1} \\exp(-\\mathrm{TR}/T_1)$趋近于零。\n这意味着对于非常长的$\\mathrm{TR}$值，每增加一毫秒的TR所产生的纵向磁化强度恢复的增量会越来越小。由于扫描时间与$\\mathrm{TR}$成正比，这转化为一个不划算的权衡：大幅增加扫描时间只能对已经很小的残余$T_1$加权产生微不足道的减少。这就是收益递减原理。例如，将TR从$3T_1$增加到$4T_1$，恢复率从$95.02\\%$增加到$98.17\\%$，增益约为$3.15\\%$。将TR从$4T_1$增加到$5T_1$，恢复率从$98.17\\%$增加到$99.33\\%$，增益仅为约$1.16\\%$。为获得每一点百分比的增益所付出的扫描时间成本变得越来越高昂。",
            "answer": "$$\\boxed{23.97}$$"
        },
        {
            "introduction": "横向弛豫是MRI对比度的另一大支柱，但理解真实$T_2$与表观$T_2^*$之间的区别至关重要。$T_2^*$弛豫包含了由主磁场不均匀性引起的可逆信号衰减，而$T_2$弛豫仅反映不可逆的自旋-自旋相互作用。本练习将通过一个假设的错误操作，让你量化使用梯度回波序列替代自旋回波序列进行$T_2$测量时所产生的系统偏差，从而深刻理解这两种弛豫机制的物理内涵及其对定量分析的影响。",
            "id": "4552356",
            "problem": "一个放射组学流程旨在通过多回波采集，为在静态磁场强度为 $B_0$ 下进行的脑部研究生成横向弛豫图谱。由于一个实现上的疏忽，该流程对来自多回波梯度回波采集的幅度数据进行单指数衰减拟合，以估计横向弛豫时间，并将所得参数标记为 $T_2$。目标感兴趣组织体素可以很好地建模为具有恒定质子密度的单室模型，并在完全弛豫条件下（即 $TR \\gg T_1$）进行成像，射频翻转角和重聚焦脉冲不引入额外的加权。忽略扩散和流动效应。\n\n仅使用以下基本依据：\n- 在完全弛豫条件下，自旋回波信号作为回波时间 $TE$ 的函数，其衰减形式为 $S_{\\mathrm{SE}}(TE) = S_0 \\rho \\exp(-TE/T_2)$，其中 $S_0$ 是一个系统常数，$\\rho$ 是质子密度。\n- 在完全弛豫条件下，梯度回波信号同时经历由 $T_2$ 表征的不可逆自旋-自旋失相，以及由静态磁场不均匀性引起的、由时间常数 $T_2'$ 表征的可逆失相。将这两个退相干过程视为随时间相乘的独立指数衰减。\n\n将该流程的 $T_2$ 估计值的偏差定义为 $B \\equiv \\hat{T}_2^{(\\mathrm{GRE})} - T_2$，其中 $\\hat{T}_2^{(\\mathrm{GRE})}$ 是通过对梯度回波信号与 $TE$ 进行单指数拟合得到的参数，而 $T_2$ 是组织的真实不可逆横向弛豫时间，如同通过理想的自旋回波序列测量得到的一样。假设数据无噪声且单指数拟合是完美的。\n\n1. 从给定的信号模型和梯度回波信号中两个指数衰减的独立性出发，推导 $B$ 关于 $T_2$ 和 $T_2'$ 的解析表达式。\n2. 对于一个真实 $T_2 = 65$ 毫秒、可逆失相时间 $T_2' = 35$ 毫秒的组织，计算 $B$ 的值。将最终数值答案四舍五入到四位有效数字。以毫秒为单位表示最终偏差。",
            "solution": "问题陈述经评估有效。其科学依据根植于磁共振成像（MRI）的原理，特别是自旋回波和梯度回波信号衰减之间的区别。该问题定义明确，提供了推导唯一解所需的所有定义、模型和数据。语言客观而精确。\n\n第一步是推导偏差 $B$ 的解析表达式。我们已知基本的信号模型和退相干过程的构成。\n\n自旋回波（SE）信号只考虑不可逆的自旋-自旋弛豫，其表达式为：\n$$S_{\\mathrm{SE}}(TE) = S_0 \\rho \\exp\\left(-\\frac{TE}{T_2}\\right)$$\n此处，$TE$ 是回波时间，$T_2$ 是真实的横向弛豫时间，$S_0$ 是一个比例常数，$\\rho$ 是质子密度。\n\n梯度回波（GRE）信号同时受到由 $T_2$ 表征的不可逆失相和由静态磁场不均匀性引起的、由时间常数 $T_2'$ 表征的额外可逆失相的影响。问题陈述指出，这两个过程是相乘的独立指数衰减。因此，GRE信号 $S_{\\mathrm{GRE}}(TE)$ 可以表示为：\n$$S_{\\mathrm{GRE}}(TE) = \\left(S_0 \\rho \\exp\\left(-\\frac{TE}{T_2}\\right)\\right) \\times \\exp\\left(-\\frac{TE}{T_2'}\\right)$$\n合并指数项，我们得到：\n$$S_{\\mathrm{GRE}}(TE) = S_0 \\rho \\exp\\left(-\\frac{TE}{T_2} - \\frac{TE}{T_2'}\\right)$$\n从指数中提出因子 $-TE$ 可得：\n$$S_{\\mathrm{GRE}}(TE) = S_0 \\rho \\exp\\left(-TE \\left(\\frac{1}{T_2} + \\frac{1}{T_2'}\\right)\\right)$$\n该方程具有单指数衰减的形式 $S(TE) = A \\exp(-TE/\\tau)$，其中 $A=S_0 \\rho$，有效衰减时间常数 $\\tau$ 由以下关系式给出：\n$$\\frac{1}{\\tau} = \\frac{1}{T_2} + \\frac{1}{T_2'}$$\n问题陈述指出，放射组学流程对GRE信号进行单指数拟合，并将所得的时间常数称为 $\\hat{T}_2^{(\\mathrm{GRE})}$。根据拟合的定义，这个估计参数必须等于有效时间常数 $\\tau$。在标准的MRI术语中，GRE序列的这个有效横向弛豫时间被记为 $T_2^*$。因此：\n$$\\hat{T}_2^{(\\mathrm{GRE})} = T_2^* = \\tau$$\n我们现在可以用 $T_2$ 和 $T_2'$ 来表示 $\\hat{T}_2^{(\\mathrm{GRE})}$。根据速率相加公式：\n$$\\frac{1}{\\hat{T}_2^{(\\mathrm{GRE})}} = \\frac{1}{T_2} + \\frac{1}{T_2'} = \\frac{T_2' + T_2}{T_2 T_2'}$$\n对此表达式求逆，得到估计的弛豫时间：\n$$\\hat{T}_2^{(\\mathrm{GRE})} = \\frac{T_2 T_2'}{T_2 + T_2'}$$\n问题将偏差 $B$ 定义为该估计值与真实 $T_2$ 值之差：\n$$B \\equiv \\hat{T}_2^{(\\mathrm{GRE})} - T_2$$\n将我们推导的 $\\hat{T}_2^{(\\mathrm{GRE})}$ 表达式代入偏差的定义中：\n$$B = \\frac{T_2 T_2'}{T_2 + T_2'} - T_2$$\n为简化计算，我们通分：\n$$B = \\frac{T_2 T_2'}{T_2 + T_2'} - \\frac{T_2 (T_2 + T_2')}{T_2 + T_2'}$$\n$$B = \\frac{T_2 T_2' - T_2^2 - T_2 T_2'}{T_2 + T_2'}$$\n分子中的 $T_2 T_2'$ 项相消，得到偏差的最终解析表达式：\n$$B = \\frac{-T_2^2}{T_2 + T_2'}$$\n这就完成了问题的第一部分。该结果表明，从GRE信号得到的估计值 $\\hat{T}_2^{(\\mathrm{GRE})}$ 总是低于真实的 $T_2$（因为 $T_2$ 和 $T_2'$ 均为正量），从而导致一个负偏差。\n\n对于第二部分，我们必须根据给定的组织参数计算 $B$ 的值：\n真实横向弛豫时间，$T_2 = 65$ ms。\n可逆失相时间，$T_2' = 35$ ms。\n\n将这些数值代入我们推导出的 $B$ 的表达式中：\n$$B = \\frac{-(65)^2}{65 + 35}$$\n所有数值的单位都是毫秒，所以最终的偏差单位也将是毫秒。\n首先，计算分母：\n$$65 + 35 = 100$$\n接着，计算分子：\n$$-(65)^2 = -4225$$\n现在，计算偏差：\n$$B = \\frac{-4225}{100} = -42.25$$\n问题要求答案四舍五入到四位有效数字。计算出的值 $-42.25$ 已经有四位有效数字。因此，偏差 $B$ 为 $-42.25$ ms。",
            "answer": "$$\\boxed{-42.25}$$"
        },
        {
            "introduction": "现代医学影像分析正迈向“放射组学”时代，即从医学图像中提取大量的定量特征以辅助诊断和预测。然而，这些高级特征的稳定性和可重复性直接受到成像物理过程的制约。本练习将通过一个编程实践，让你亲手模拟并验证回波时间（$TE$）的变化如何通过影响$T_2$对比度，进而改变基于高斯-拉普拉斯（LoG）滤波器的放射组学特征值，从而揭示了标准化成像方案在定量研究中的极端重要性。",
            "id": "4552340",
            "problem": "给定一个合成的二维图像模型，要求您分析基于高斯-拉普拉斯（LoG）滤波器的影像组学特征在磁共振成像（MRI）中对不同回波时间设置的稳定性。影像组学（定量图像特征提取）旨在捕获图像模式的稳健描述符。在此模型中，图像对比度由横向弛豫（由参数 $T_2$ 描述）控制，而回波时间 $TE$ 决定了采集时刻的信号幅度。请使用以下科学公认的基础：在自旋回波采集序列和回波时间 $TE$下，横向磁化强度随时间常数 $T_2$呈指数衰减，因此当其他参数固定时，信号幅度按 $e^{-TE/T_2}$ 比例缩放。\n\n构建一个 $128 \\times 128$ 的仿体图像 $\\mathcal{I}_0$，其包含一个边长为 $64$ 像素的中心正方形（质子密度 $PD = 1$）和一个均匀背景（质子密度 $PD = 0$）。将在回波时间 $TE$ 和弛豫时间 $T_2$ 下观测到的图像定义为\n$$\n\\mathcal{I}(TE, T_2) = \\mathcal{I}_0 \\cdot e^{-TE/T_2},\n$$\n其中 $TE$ 和 $T_2$ 的单位均为毫秒，且指数的参数使用相同单位，因此比率 $TE/T_2$ 是无量纲的。\n\n定义高斯-拉普拉斯（LoG）滤波器 $L_\\sigma[\\cdot]$，其尺度参数 $\\sigma$ 以像素为单位。对于任意图像 $\\mathcal{I}$，定义从 LoG 响应中计算出的两个影像组学特征：\n1. 绝对响应总和（一种 $L^1$ 型特征）：\n$$\nF_1(\\mathcal{I}; \\sigma) = \\sum_{x,y} \\left| L_\\sigma[\\mathcal{I}](x,y) \\right|.\n$$\n2. 响应的能量（一种 $L^2$ 型特征）：\n$$\nF_2(\\mathcal{I}; \\sigma) = \\sum_{x,y} \\left( L_\\sigma[\\mathcal{I}](x,y) \\right)^2.\n$$\n\n您必须基于第一性原理，推导指数对比度幅度缩放和 LoG 算子的线性性质如何决定当 $TE$ 变化时 $F_1$ 和 $F_2$ 的预期缩放行为。基于该推导，为 $TE_0 = 0 \\ \\mathrm{ms}$ 的基线定义，\n$$\nR_i(TE, T_2; \\sigma) = \\frac{F_i\\big(\\mathcal{I}(TE, T_2); \\sigma\\big)}{F_i\\big(\\mathcal{I}(TE_0, T_2); \\sigma\\big)} \\quad \\text{for } i \\in \\{1,2\\},\n$$\n并计算经验测量比率 $R_i(TE, T_2; \\sigma)$ 与您推导出的理论预测比率之间的偏差（误差）。将此偏差报告为一个非负实数（浮点数），即测量比率与预测比率之间的绝对差值。\n\n物理单位：$TE$ 和 $T_2$ 必须以毫秒为单位处理，最终的偏差值为无量纲。不涉及角度。所有最终答案都应表示为浮点数（十进制数）。\n\n实现一个高斯尺度为 $\\sigma$（单位：像素）的 LoG 算子。在求和时使用整个图像域。假设 $T_2$ 在整个图像上是均匀的，并且 $PD$ 与定义完全一致的理想化条件。\n\n您的程序应评估以下参数集测试套件，每个参数集以元组 $(TE, T_2, \\sigma, i)$ 的形式给出，其中 $i$ 是特征索引（$1$ 代表 $F_1$，$2$ 代表 $F_2$）：\n\n- 案例 A（基线检查，理想路径）：$(0 \\ \\mathrm{ms}, 80 \\ \\mathrm{ms}, 1.5, 1)$\n- 案例 B（中度衰减，特征 $F_1$）：$(60 \\ \\mathrm{ms}, 80 \\ \\mathrm{ms}, 1.5, 1)$\n- 案例 C（强度衰减，特征 $F_2$）：$(120 \\ \\mathrm{ms}, 60 \\ \\mathrm{ms}, 2.0, 2)$\n- 案例 D（强度衰减，小 $\\sigma$，特征 $F_1$）：$(200 \\ \\mathrm{ms}, 100 \\ \\mathrm{ms}, 0.8, 1)$\n- 案例 E（弱度衰减，大 $\\sigma$，特征 $F_2$）：$(20 \\ \\mathrm{ms}, 300 \\ \\mathrm{ms}, 3.0, 2)$\n\n对于每个案例，计算测量比率与理论预测比率之间的绝对偏差。您的程序应生成单行输出，其中包含一个逗号分隔的偏差列表，并用方括号括起来（例如，“[dA,dB,dC,dD,dE]”），顺序与上面列出的案例一致。最终的数值输出必须是无量纲的浮点数。",
            "solution": "该问题要求分析源自高斯-拉普拉斯（LoG）滤波器响应的两个影像组学特征，关于磁共振成像回波时间（$TE$）变化的稳定性。我们必须首先推导这些特征的理论缩放行为，然后将此理论与来自合成仿体图像的经验测量结果进行比较，量化任何偏差。\n\n根据指数衰减模型 $e^{-TE/T_2}$，图像信号强度随回波时间 $TE$ 和横向弛豫时间 $T_2$ 缩放。问题基于质子密度仿体 $\\mathcal{I}_0$ 将观测图像 $\\mathcal{I}(TE, T_2)$ 定义为：\n$$\n\\mathcal{I}(TE, T_2) = \\mathcal{I}_0 \\cdot e^{-TE/T_2}\n$$\n此处，$\\mathcal{I}_0$ 是一个 $128 \\times 128$ 的图像，包含一个值为 $1$ 的居中 $64 \\times 64$ 正方形和一个值为 $0$ 的背景。项 $e^{-TE/T_2}$ 是一个标量乘数，它统一缩放整个图像的强度。\n\n两个影像组学特征 $F_1$ 和 $F_2$ 是通过将 LoG 滤波器 $L_\\sigma[\\cdot]$ 应用于图像 $\\mathcal{I}$ 后，根据其响应计算得出的：\n$$\nF_1(\\mathcal{I}; \\sigma) = \\sum_{x,y} \\left| L_\\sigma[\\mathcal{I}](x,y) \\right|\n$$\n$$\nF_2(\\mathcal{I}; \\sigma) = \\sum_{x,y} \\left( L_\\sigma[\\mathcal{I}](x,y) \\right)^2\n$$\n\n我们理论推导的核心原理是高斯-拉普拉斯算子的线性性质。LoG 滤波器是两个线性运算的复合：与高斯核的卷积以及拉普拉斯微分算子（$\\nabla^2$）的应用。线性算子的复合本身也是线性的。因此，对于任意图像 $\\mathcal{I}$ 和任意标量常数 $c$，以下属性成立：\n$$\nL_\\sigma[c \\cdot \\mathcal{I}] = c \\cdot L_\\sigma[\\mathcal{I}]\n$$\n\n我们将此属性应用于我们的图像模型。设标量常数 $c = e^{-TE/T_2}$。那么，在给定回波时间 $TE$ 下，图像的 LoG 响应为：\n$$\nL_\\sigma[\\mathcal{I}(TE, T_2)] = L_\\sigma[\\mathcal{I}_0 \\cdot e^{-TE/T_2}] = e^{-TE/T_2} \\cdot L_\\sigma[\\mathcal{I}_0]\n$$\n基线图像定义在 $TE_0 = 0 \\ \\mathrm{ms}$。在此回波时间，标量乘数为 $e^{-0/T_2} = 1$。因此，基线图像为 $\\mathcal{I}(TE_0, T_2) = \\mathcal{I}_0$，其 LoG 响应为 $L_\\sigma[\\mathcal{I}_0]$。\n\n基于此关系，我们可以推导出每个特征的理论缩放行为。\n\n对于特征 $F_1$：\n$$\nF_1(\\mathcal{I}(TE, T_2); \\sigma) = \\sum_{x,y} \\left| L_\\sigma[\\mathcal{I}(TE, T_2)](x,y) \\right| = \\sum_{x,y} \\left| e^{-TE/T_2} \\cdot L_\\sigma[\\mathcal{I}_0](x,y) \\right|\n$$\n由于 $TE \\ge 0$ 且 $T_2 > 0$，指数项 $e^{-TE/T_2}$ 始终为非负。我们可以将其从绝对值和求和中提取出来：\n$$\nF_1(\\mathcal{I}(TE, T_2); \\sigma) = e^{-TE/T_2} \\sum_{x,y} \\left| L_\\sigma[\\mathcal{I}_0](x,y) \\right|\n$$\n求和项就是在基线图像上计算的特征 $F_1$，即 $F_1(\\mathcal{I}(TE_0, T_2); \\sigma)$。因此：\n$$\nF_1(\\mathcal{I}(TE, T_2); \\sigma) = e^{-TE/T_2} \\cdot F_1(\\mathcal{I}(TE_0, T_2); \\sigma)\n$$\n理论预测的比率 $R_{1, \\text{theory}}$ 为：\n$$\nR_{1, \\text{theory}}(TE, T_2; \\sigma) = \\frac{F_1(\\mathcal{I}(TE, T_2); \\sigma)}{F_1(\\mathcal{I}(TE_0, T_2); \\sigma)} = e^{-TE/T_2}\n$$\n\n对于特征 $F_2$：\n$$\nF_2(\\mathcal{I}(TE, T_2); \\sigma) = \\sum_{x,y} \\left( L_\\sigma[\\mathcal{I}(TE, T_2)](x,y) \\right)^2 = \\sum_{x,y} \\left( e^{-TE/T_2} \\cdot L_\\sigma[\\mathcal{I}_0](x,y) \\right)^2\n$$\n我们可以分离平方项并将恒定的指数因子提取出来：\n$$\nF_2(\\mathcal{I}(TE, T_2); \\sigma) = \\left(e^{-TE/T_2}\\right)^2 \\sum_{x,y} \\left( L_\\sigma[\\mathcal{I}_0](x,y) \\right)^2 = e^{-2 \\cdot TE/T_2} \\sum_{x,y} \\left( L_\\sigma[\\mathcal{I}_0](x,y) \\right)^2\n$$\n求和项是在基线图像上计算的特征 $F_2$，即 $F_2(\\mathcal{I}(TE_0, T_2); \\sigma)$。所以：\n$$\nF_2(\\mathcal{I}(TE, T_2); \\sigma) = e^{-2 \\cdot TE/T_2} \\cdot F_2(\\mathcal{I}(TE_0, T_2); \\sigma)\n$$\n理论预测的比率 $R_{2, \\text{theory}}$ 为：\n$$\nR_{2, \\text{theory}}(TE, T_2; \\sigma) = \\frac{F_2(\\mathcal{I}(TE, T_2); \\sigma)}{F_2(\\mathcal{I}(TE_0, T_2); \\sigma)} = e^{-2 \\cdot TE/T_2}\n$$\n\n问题的计算部分是为每个测试案例计算这些完美理论比率与经验测量比率之间的偏差。步骤如下：\n1.  对于每个测试案例 $(TE, T_2, \\sigma, i)$，使用上面推导的公式确定相应的理论比率 $R_{i, \\text{theory}}$。\n2.  生成基础仿体图像 $\\mathcal{I}_0$。\n3.  基线图像为 $\\mathcal{I}_{\\text{baseline}} = \\mathcal{I}(TE_0, T_2) = \\mathcal{I}_0$。\n4.  生成测试图像 $\\mathcal{I}_{\\text{test}} = \\mathcal{I}(TE, T_2) = \\mathcalI_0 \\cdot e^{-TE/T_2}$。\n5.  将尺度为 $\\sigma$ 的 LoG 滤波器应用于 $\\mathcal{I}_{\\text{baseline}}$ 和 $\\mathcal{I}_{\\text{test}}$，以获得它们各自的 LoG 响应。这一步使用 `scipy.ndimage.gaussian_laplace` 进行数值计算。\n6.  根据 $F_1$ 和 $F_2$ 的定义，通过对 LoG 响应图像的像素求和来计算特征值 $F_i(\\mathcal{I}_{\\text{baseline}}; \\sigma)$ 和 $F_i(\\mathcal{I}_{\\text{test}}; \\sigma)$。\n7.  计算测量比率 $R_{i, \\text{measured}} = F_i(\\mathcal{I}_{\\text{test}}; \\sigma) / F_i(\\mathcal{I}_{\\text{baseline}}; \\sigma)$。由于 LoG 应用于非恒定图像会产生非零结果，因此分母不为零。\n8.  最终偏差是绝对差值：$\\Delta_i = |R_{i, \\text{measured}} - R_{i, \\text{theory}}|$。\n\n这个偏差理论上为零，但在实践中会是一个小的非负数，这是由于浮点运算精度和离散卷积算法中固有的数值近似所致。程序将为所有指定的测试案例实现此完整过程。对于案例 A，其中 $TE=0$，测量比率和理论比率都恰好是 $1$，因此它们的偏差也恰好是 $0$。",
            "answer": "```\n[0.0,1.1102230246251565e-16,0.0,0.0,0.0]\n```"
        }
    ]
}