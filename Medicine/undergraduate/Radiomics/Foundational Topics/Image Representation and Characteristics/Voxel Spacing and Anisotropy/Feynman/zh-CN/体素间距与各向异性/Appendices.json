{
    "hands_on_practices": [
        {
            "introduction": "本练习是您将理论付诸实践的第一步。它旨在建立数字图像的离散体素网格与患者身体的连续物理空间之间的基本转换关系。理解这种从索引坐标到物理坐标的映射，对于正确解释图像数据及其衍生的放射组学特征至关重要。",
            "id": "4569168",
            "problem": "用于放射组学分析的三维（3D）医学图像在具有轴对齐间距的直角体素网格上进行采样。沿笛卡尔坐标轴的体素间距为 $s_x=0.8$ 毫米，$s_y=0.8$ 毫米，$s_z=3.0$ 毫米。图像原点是索引为 $(0,0,0)$ 的体素中心的物理坐标，给定为 $(o_x,o_y,o_z)=(10,20,30)$ 毫米。考虑一个整数索引为 $(i,j,k)=(100,50,12)$ 的体素。仅使用以下基本定义：(i) 体素间距是沿各轴相邻体素中心之间的物理距离，以及 (ii) 原点是索引为 $(0,0,0)$ 的体素中心的物理坐标，推导从索引 $(i,j,k)$ 到其物理坐标 $(x,y,z)$（以毫米为单位）的映射关系，为给定值计算此坐标，然后计算从原点到该体素中心的欧几里得距离（以毫米为单位）。将最终距离四舍五入到四位有效数字，并以毫米表示。最后，解释给定的间距如何意味着各向异性采样，并讨论这对基于纹理的放射组学特征的一个影响。",
            "solution": "该问题经核实具有科学依据、提法明确且客观。所有必要信息均已提供，且所涉及的概念是医学图像分析和放射组学的基础。\n\n解答按问题要求分三部分进行：\n1. 推导和计算物理坐标及欧几里得距离。\n2. 解释采样各向异性。\n3. 讨论其对基于纹理的放射组学特征的影响。\n\n首先，我们推导从体素索引 $(i,j,k)$ 到其物理坐标 $(x,y,z)$ 的通用映射关系。问题指出图像是在一个直角网格上采样的。图像原点 $(o_x, o_y, o_z)$ 是索引为 $(0,0,0)$ 的体素中心的物理坐标。体素间距 $s_x$、$s_y$ 和 $s_z$ 分别代表沿各自轴向上相邻体素中心之间的物理距离。\n\n索引为 $(i,j,k)$ 的体素中心位置相对于原点体素 $(0,0,0)$ 在 x 轴上偏移了 $i$ 步，在 y 轴上偏移了 $j$ 步，在 z 轴上偏移了 $k$ 步。沿每个轴的总物理位移是步数乘以该轴的间距。因此，索引为 $(i,j,k)$ 的体素中心的物理坐标 $(x,y,z)$ 由以下公式给出：\n$$x = o_x + i \\cdot s_x$$\n$$y = o_y + j \\cdot s_y$$\n$$z = o_z + k \\cdot s_z$$\n这构成了从体素索引到物理坐标的通用映射关系。\n\n接下来，我们为给定的体素索引计算具体的物理坐标。给定的值为：\n- 体素索引：$(i,j,k) = (100, 50, 12)$\n- 体素间距（单位：毫米）：$s_x = 0.8$, $s_y = 0.8$, $s_z = 3.0$\n- 图像原点（单位：毫米）：$(o_x, o_y, o_z) = (10, 20, 30)$\n\n将这些值代入推导出的映射公式：\n$$x = 10 + 100 \\times 0.8 = 10 + 80 = 90 \\text{ mm}$$\n$$y = 20 + 50 \\times 0.8 = 20 + 40 = 60 \\text{ mm}$$\n$$z = 30 + 12 \\times 3.0 = 30 + 36 = 66 \\text{ mm}$$\n索引为 $(100,50,12)$ 的体素中心的物理坐标是 $(90, 60, 66)$ 毫米。\n\n现在，我们计算从图像原点 $P_0 = (o_x, o_y, o_z) = (10, 20, 30)$ 到该体素中心 $P_v = (x, y, z) = (90, 60, 66)$ 的欧几里得距离 $d$。三维空间中的欧几里得距离公式为：\n$$d = \\sqrt{(x - o_x)^2 + (y - o_y)^2 + (z - o_z)^2}$$\n使用推导出的关系式 $x - o_x = i \\cdot s_x$，$y - o_y = j \\cdot s_y$ 和 $z - o_z = k \\cdot s_z$，我们也可以将距离写为：\n$$d = \\sqrt{(i \\cdot s_x)^2 + (j \\cdot s_y)^2 + (k \\cdot s_z)^2}$$\n让我们计算位移分量：\n$$\\Delta x = x - o_x = 90 - 10 = 80 \\text{ mm}$$\n$$\\Delta y = y - o_y = 60 - 20 = 40 \\text{ mm}$$\n$$\\Delta z = z - o_z = 66 - 30 = 36 \\text{ mm}$$\n将这些位移代入距离公式：\n$$d = \\sqrt{80^2 + 40^2 + 36^2}$$\n$$d = \\sqrt{6400 + 1600 + 1296}$$\n$$d = \\sqrt{9296}$$\n距离的数值为：\n$$d \\approx 96.415766 \\text{ mm}$$\n问题要求将最终距离四舍五入到四位有效数字。前四位有效数字是 $9$、$6$、$4$ 和 $1$。第五位数字是 $5$，所以我们将第四位数字向上取整。\n$$d \\approx 96.42 \\text{ mm}$$\n\n第二，我们解释为什么给定的间距意味着各向异性采样。在网格的背景下，各向异性意味着物理属性是方向依赖的。各向同性采样发生在采样点之间的距离在所有方向上都相同时。对于直角体素网格，这意味着间距必须相等：$s_x = s_y = s_z$。在这种情况下，体素是完美的立方体。\n在本问题中，给定的间距为 $s_x = 0.8$ 毫米，$s_y = 0.8$ 毫米，$s_z = 3.0$ 毫米。由于 $s_x = s_y \\neq s_z$，体素的尺寸不相等。$xy$ 平面（层面内）的分辨率高于 $z$ 轴（层面间）的分辨率。最终的体素不是立方体，而是尺寸为 $0.8 \\times 0.8 \\times 3.0 \\, \\text{mm}^3$ 的长方体。这种不均匀的间距就是各向异性采样的定义。\n\n第三，我们讨论这种各向异性对基于纹理的放射组学特征的一个影响。纹理特征是放射组学的基石，旨在捕捉体素强度值的空间分布和异质性。许多计算这些特征的算法（例如，灰度共生矩阵 (GLCM)，灰度游程矩阵 (GLRLM)）分析一个体素与其邻居之间的关系。“邻居”的定义基于其在离散体素网格中的位置，通常由像 $(1,0,0)$ 或 $(0,0,1)$ 这样的整数偏移量定义。\n各向异性采样的关键影响是**纹理特征旋转不变性和鲁棒性的丧失**。在各向异性网格上，与固定整数偏移量相对应的物理距离不是恒定的。例如，偏移量 $(1,0,0)$ 对应的物理距离为 $s_x = 0.8$ 毫米，而偏移量 $(0,0,1)$ 对应的物理距离为 $s_z = 3.0$ 毫米。如果通过考虑网格中的最近邻来计算纹理特征，它会无意中混合来自不同物理尺度的信息。沿 $z$ 轴计算的特征探测的体素关系距离（$3.0$ 毫米）远大于在 $xy$ 平面内计算的特征（$0.8$ 毫米）。这意味着特征值将强烈依赖于对象相对于扫描仪坐标轴的方向，而不仅仅是底层的生物组织模式。对同一肿瘤进行两次不同方向的扫描，可能会产生显著不同的纹理特征值，从而损害该特征用于临床预测的可靠性。为了解决这个问题，放射组学中的一个标准预处理步骤是使用插值法将各向异性图像重采样到各向同性网格上（例如，重采样到 $1 \\times 1 \\times 1 \\, \\text{mm}^3$ 的体素），这确保了纹理分析在一个邻域关系对应于均匀物理距离的空间中进行。",
            "answer": "$$\\boxed{96.42}$$"
        },
        {
            "introduction": "现在我们了解了坐标系统，接下来将探讨各向异性的一个关键后果。这个思想实验使用一个简单的合成图像来演示，如果忽略体素间距，空间梯度的计算会如何被严重扭曲。这突显了为什么精确处理间距对于构建稳健的放射组学模型是不可或缺的，因为许多纹理特征都基于梯度信息。",
            "id": "4569059",
            "problem": "用于放射组学的三维标量图像由合成斜坡函数 $I(x,y,z) = \\alpha z$ 在连续空间坐标上定义，其中 $\\alpha$ 是一个常数，单位为强度/毫米。该图像在具有各向异性体素间距 $(s_x,s_y,s_z) = (1.0,1.0,5.0)$ mm 的直角网格上进行采样。考虑一个索引为 $(i_0,j_0,k_0)$ 的内部体素，使其在每个轴向上的直接相邻体素都存在。\n\n仅使用空间梯度的定义以及有限差分必须与各轴向物理间距一致的原则，计算在以下两种情况下 $(i_0,j_0,k_0)$ 处的梯度大小：\n- 考虑了给定间距 $(s_x,s_y,s_z)$ 的正确计算，以及\n- 忽略了间距，将差异视为间距为 $(s_x,s_y,s_z) = (1.0,1.0,1.0)$ mm 的不正确计算。\n\n令 $|\\nabla I|_{\\text{correct}}$ 表示正确计算的梯度大小，$|\\nabla I|_{\\text{ignore}}$ 表示忽略间距时的梯度大小。报告比率 $r = \\dfrac{|\\nabla I|_{\\text{ignore}}}{|\\nabla I|_{\\text{correct}}}$。将最终比率 $r$ 表示为一个无量纲的纯数。无需四舍五入。",
            "solution": "该问题被认为是有效的，因为它有科学依据、适定、客观、自洽，并且是理解从采样图像数据中进行梯度数值计算的一个合适练习。\n\n连续标量图像由函数 $I(x,y,z) = \\alpha z$ 给出，其中 $\\alpha$ 是一个常数。该连续函数的空间梯度 $\\nabla I$ 定义为：\n$$ \\nabla I = \\left( \\frac{\\partial I}{\\partial x}, \\frac{\\partial I}{\\partial y}, \\frac{\\partial I}{\\partial z} \\right) $$\n对于给定函数，其偏导数为 $\\frac{\\partial I}{\\partial x} = 0$，$\\frac{\\partial I}{\\partial y} = 0$ 和 $\\frac{\\partial I}{\\partial z} = \\alpha$。因此，真实的解析梯度是常数向量 $(0, 0, \\alpha)$。\n\n图像在直角网格上进行采样。整数索引为 $(i,j,k)$ 的体素的物理位置 $(x_i, y_j, z_k)$ 与体素间距 $(s_x, s_y, s_z)$ 的关系为 $x_i = i s_x$，$y_j = j s_y$ 和 $z_k = k s_z$（相对于某个原点）。因此，在索引 $(i,j,k)$ 处采样图像的值为：\n$$ I(i,j,k) = I(x_i, y_j, z_k) = \\alpha z_k = \\alpha (k s_z) $$\n注意，图像强度仅取决于 $k$ 索引和物理间距 $s_z$。\n\n在内部体素 $(i_0, j_0, k_0)$ 处采样图像的空间梯度使用中心有限差分法进行近似。其各分量的一般形式为：\n$$ (\\nabla I)_x \\approx \\frac{I(i_0+1, j_0, k_0) - I(i_0-1, j_0, k_0)}{2 s_x} $$\n$$ (\\nabla I)_y \\approx \\frac{I(i_0, j_0+1, k_0) - I(i_0, j_0-1, k_0)}{2 s_y} $$\n$$ (\\nabla I)_z \\approx \\frac{I(i_0, j_0, k_0+1) - I(i_0, j_0, k_0-1)}{2 s_z} $$\n每个表达式中的分母代表计算差值所跨越的物理距离。\n\n首先，我们正确地计算梯度，即考虑给定的各向异性体素间距 $(s_x, s_y, s_z) = (1.0, 1.0, 5.0)$ mm。\n\n梯度的x分量为：\n$$ (\\nabla I_{\\text{correct}})_x = \\frac{\\alpha (k_0 s_z) - \\alpha (k_0 s_z)}{2 s_x} = 0 $$\n梯度的y分量为：\n$$ (\\nabla I_{\\text{correct}})_y = \\frac{\\alpha (k_0 s_z) - \\alpha (k_0 s_z)}{2 s_y} = 0 $$\n梯度的z分量为：\n$$ (\\nabla I_{\\text{correct}})_z = \\frac{I(i_0, j_0, k_0+1) - I(i_0, j_0, k_0-1)}{2 s_z} = \\frac{\\alpha((k_0+1)s_z) - \\alpha((k_0-1)s_z)}{2 s_z} $$\n$$ (\\nabla I_{\\text{correct}})_z = \\frac{\\alpha s_z (k_0+1 - (k_0-1))}{2 s_z} = \\frac{\\alpha s_z (2)}{2 s_z} = \\alpha $$\n正确计算出的梯度向量为 $\\nabla I_{\\text{correct}} = (0, 0, \\alpha)$。其大小为：\n$$ |\\nabla I|_{\\text{correct}} = \\sqrt{0^2 + 0^2 + \\alpha^2} = |\\alpha| $$\n假设 $\\alpha$ 代表一个正的物理量，则 $|\\nabla I|_{\\text{correct}} = \\alpha$。\n\n接下来，我们不正确地计算梯度，忽略真实的间距，并将其视作间距为 $(s'_x, s'_y, s'_z) = (1.0, 1.0, 1.0)$ mm 的各向同性情况。错误在于在有限差分公式的分母中使用了这些不正确的间距值。而分子，即采样图像强度的差值，保持不变。\n\nx和y分量再次为 $0$，因为分子为 $0$：\n$$ (\\nabla I_{\\text{ignore}})_x = 0 $$\n$$ (\\nabla I_{\\text{ignore}})_y = 0 $$\nz分量使用分母中不正确的间距 $s'_z = 1.0$ mm进行计算：\n$$ (\\nabla I_{\\text{ignore}})_z = \\frac{I(i_0, j_0, k_0+1) - I(i_0, j_0, k_0-1)}{2 s'_z} = \\frac{\\alpha s_z (2)}{2 s'_z} = \\alpha \\frac{s_z}{s'_z} $$\n不正确计算出的梯度向量为 $\\nabla I_{\\text{ignore}} = (0, 0, \\alpha \\frac{s_z}{s'_z})$。其大小为：\n$$ |\\nabla I|_{\\text{ignore}} = \\sqrt{0^2 + 0^2 + \\left(\\alpha \\frac{s_z}{s'_z}\\right)^2} = \\left|\\alpha \\frac{s_z}{s'_z}\\right| $$\n再次假设 $\\alpha > 0$，并且已知 $s_z$ 和 $s'_z$ 为正，则 $|\\nabla I|_{\\text{ignore}} = \\alpha \\frac{s_z}{s'_z}$。\n\n最后，我们计算比率 $r = \\dfrac{|\\nabla I|_{\\text{ignore}}}{|\\nabla I|_{\\text{correct}}}$。\n$$ r = \\frac{\\alpha \\frac{s_z}{s'_z}}{\\alpha} = \\frac{s_z}{s'_z} $$\n问题给出了真实间距 $s_z = 5.0$ mm 和错误假设的间距 $s'_z = 1.0$ mm。\n$$ r = \\frac{5.0 \\text{ mm}}{1.0 \\text{ mm}} = 5 $$\n该比率是一个无量纲的纯数，表示在忽略z方向的各向异性时，梯度大小被高估的倍数。",
            "answer": "$$\\boxed{5}$$"
        },
        {
            "introduction": "在认识到各向异性带来的问题后，我们现在转向标准的解决方案：图像重采样。这个实践练习将指导您计算各向同性网格的新图像尺寸，并且更重要的是，批判性地思考如何为不同类型的图像数据（例如强度图像与分割掩模）选择正确的插值方法。这是任何稳健的放射组学预处理流程的基石。",
            "id": "4569066",
            "problem": "一个三维计算机断层扫描 (CT) 图像的体素维度为 $(N_x, N_y, N_z) = (256, 256, 80)$，体素间距为 $(s_x, s_y, s_z) = (0.9, 0.9, 5.0)$ 毫米。在放射组学中，特征对体素的各向异性很敏感，当 $s_x \\neq s_y \\neq s_z$ 时，就会出现各向异性。为了减少偏差并提高可重复性，需要将该体积重采样至所有轴上均为 $t = 1.0$ 毫米的各向同性目标间距。仅从以下定义出发：沿各轴的物理范围为 $L_i = N_i s_i$（对于 $i \\in \\{x,y,z\\}$），且以间距 $t$ 进行的各向同性重采样在改变体素网格的同时保持物理范围不变，推导出以体素为单位的新尺寸 $(N'_x, N'_y, N'_z)$ 的表达式。计算该图像的数值。不要四舍五入；报告精确的实值体素计数。将最终答案表示为单行矩阵，并且最终答案中不包含单位。此外，基于采样考虑和放射组学特征稳定性，论证一种合适的插值方法，用于将强度图像从给定的各向异性间距重采样到 $t = 1.0$ 毫米，并指出适用于离散分割掩模的任何不同选择。",
            "solution": "在尝试解答之前，需对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n-   原始体素维度：$(N_x, N_y, N_z) = (256, 256, 80)$\n-   原始体素间距：$(s_x, s_y, s_z) = (0.9, 0.9, 5.0)$ 毫米。\n-   目标各向同性间距：$t = 1.0$ 毫米。\n-   物理范围的定义：$L_i = N_i s_i$，其中 $i \\in \\{x,y,z\\}$。\n-   重采样约束：物理范围 $L_i$ 保持不变。\n-   目标 1：推导新体素维度 $(N'_x, N'_y, N'_z)$ 的表达式。\n-   目标 2：计算 $(N'_x, N'_y, N'_z)$ 的数值。\n-   目标 3：论证适用于强度图像的插值方法。\n-   目标 4：指出适用于离散分割掩模的不同选择。\n\n### 步骤 2：使用提取的已知条件进行验证\n评估问题的有效性。\n-   **科学性**：该问题是医学图像处理和放射组学的核心内容。体素维度、间距、各向异性以及重采样到各向同性网格等概念是基本且标准的操作流程。给定的数值对于临床 CT 扫描是现实的。前提在事实上和科学上都是合理的。\n-   **适定性**：问题陈述清晰，提供了推导新体素维度的唯一数学解所需的所有必要定义、常数和约束。关于插值方法的定性问题在该领域内有明确的定义。\n-   **客观性**：语言精确、量化，没有主观或模糊的术语。\n\n该问题没有表现出任何诸如科学性不合理、不完整、矛盾或不可行之类的缺陷。\n\n### 步骤 3：结论与行动\n该问题是**有效的**。将提供解答。\n\n### 解答推导\n\n根据要求，解答分为三部分：推导新体素维度的一般公式，计算具体的数值，以及论证插值方法。\n\n#### 第 1 部分：新体素网格维度的推导\n图像体积沿各轴 $i \\in \\{x, y, z\\}$ 的物理范围 $L_i$ 定义为体素数量 $N_i$ 与这些体素的间距 $s_i$ 的乘积。\n$$L_i = N_i s_i$$\n重采样过程会创建一个具有新体素维度 $(N'_x, N'_y, N'_z)$ 和新的各向同性间距 $t$ 的新图像。这个新的、重采样后的体积沿各轴的物理范围 $L'_i$ 由下式给出：\n$$L'_i = N'_i t$$\n重采样过程的一个核心约束是保持物理体积的范围不变。因此，对于每个轴 $i$，必须有 $L'_i = L_i$。\n$$N'_i t = N_i s_i$$\n为了找到沿各轴的新体素数量 $N'_i$ 的表达式，我们重新整理方程：\n$$N'_i = \\frac{N_i s_i}{t}$$\n这就是沿轴 $i$ 的新体素计数的一般表达式。\n\n#### 第 2 部分：数值计算\n我们使用提供的数值应用推导出的公式。\n原始维度为 $(N_x, N_y, N_z) = (256, 256, 80)$。\n原始间距为 $(s_x, s_y, s_z) = (0.9, 0.9, 5.0)$ 毫米。\n目标各向同性间距为 $t = 1.0$ 毫米。\n\n对于 x 轴：\n$$N'_x = \\frac{N_x s_x}{t} = \\frac{256 \\times 0.9}{1.0} = 230.4$$\n\n对于 y 轴：\n$$N'_y = \\frac{N_y s_y}{t} = \\frac{256 \\times 0.9}{1.0} = 230.4$$\n\n对于 z 轴：\n$$N'_z = \\frac{N_z s_z}{t} = \\frac{80 \\times 5.0}{1.0} = 400.0$$\n\n问题要求精确的实值体素计数，这代表了原始数据将被插值到的目标网格的维度。因此，新尺寸为 $(N'_x, N'_y, N'_z) = (230.4, 230.4, 400.0)$。\n\n#### 第 3 部分：插值方法的论证\n插值方法的选择对放射组学特征的有效性和可重复性至关重要。该方法取决于数据性质（连续强度 vs. 离散标签）和重采样操作（上采样 vs. 下采样）。\n\n在这个问题中，重采样涉及 $x$ 和 $y$ 维度的下采样（间距从 $0.9$ 毫米到 $1.0$ 毫米）和 $z$ 维度的显著上采样（从 $5.0$ 毫米到 $1.0$ 毫米）。\n\n**对于强度图像：**\n强度图像表示一个连续变化的物理属性（放射密度）。插值方法应旨在精确估计新网格位置上这个潜在的连续信号。\n-   **最近邻插值**是不合适的。它将最近的原始体素的值赋给新的体素位置，导致输出呈块状、不连续，严重降低了基于纹理和高阶的放射组学特征的质量。\n-   **线性插值**是一种改进，因为它能确保 $C^0$ 连续性（函数是连续的，但其导数不连续）。然而，梯度的不连续性仍然会对基于梯度和纹理的特征产生不利影响。\n-   **高阶插值方法**，例如**三次B样条插值**，是放射组学中的首选。样条插值生成一个 $C^2$ 连续信号（函数、一阶和二阶导数均连续），从而为潜在的组织密度提供更平滑、更符合物理实际的表示。这种平滑性对于放射组学特征的稳定性和可重复性至关重要，特别是那些对局部强度变化和梯度敏感的纹理特征。对于下采样（在 $x,y$ 维度），三次插值还具有低通滤波效果，有助于减轻混叠伪影。对于上采样（在 $z$ 维度），它能生成平滑且逼真的中间切片。因此，**三次样条插值**是强度图像最合适的方法。\n\n**对于离散分割掩模：**\n分割掩模是一个标签图，其中每个体素被赋予一个对应于特定类别（例如，背景为 $0$，肿瘤为 $1$）的离散整数值。重采样的目标是生成一个新的掩模，其中每个体素都保留了原始集合中的一个有效的、离散的标签。\n-   应用如线性或三次样条等连续插值方法是根本错误的。这些方法会对整数标签进行平均，从而在两个区域的边界处产生非整数值（例如 $0.7$）。这种现象被称为“标签渗色”，它会使掩模变得毫无意义，因为一个体素不能部分属于某个类别。\n-   正确的方法是**最近邻插值**。对于新网格中的每个位置，该方法会分配来自原始网格中最近体素的标签。这个过程保证了重采样后的掩模中所有体素都具有原始有效的整数标签之一。它保留了分割区域之间清晰的边界，这是分割掩模的首要要求。虽然它可能会引入“阶梯状”伪影，但它正确地保持了数据的离散和分类性质。\n\n总而言之，强度图像应使用三次样条插值以保持放射组学分析所需的信号完整性，而分割掩模则必须使用最近邻插值以保留分割标签。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 230.4  230.4  400 \\end{pmatrix}}\n$$"
        }
    ]
}