{
    "hands_on_practices": [
        {
            "introduction": "高斯滤波是放射组学工作流程中抑制噪声的基石。然而，为了确保结果的可重复性和科学有效性，我们必须精确地设置滤波器参数。本练习将理论与实践相结合，引导您将在物理空间中期望的平滑程度（以毫米为单位的全宽半高值 $W$ 定义）转化为数字图像处理中所需的滤波器参数（以体素为单位的标准差 $\\sigma$），这是在各向异性分辨率的医学图像上正确应用滤波的关键一步。 ",
            "id": "4553384",
            "problem": "在放射组学流程中，一个三维计算机断层扫描 (CT) 图像将通过一个可分离高斯滤波器进行平滑处理，以减少高频噪声，同时保留病灶的形状特征。该滤波器沿每个笛卡尔坐标轴作用，具有相同的物理模糊效果，其每个轴上的一维平滑轮廓由高斯函数 $g(x) = A \\exp\\!\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right)$ 建模，其中 $A$ 是 $x=0$ 处的峰值振幅，$\\sigma$ 是标准差。所需的模糊程度在物理空间中由半峰全宽 (FWHM) 指定，定义为 $g(x)$ 等于其最大值一半的两个点之间的宽度。\n\n从高斯函数的定义和半峰全宽 (FWHM) 的定义出发，推导 FWHM 和 $\\sigma$ 之间的解析关系，不使用任何预先给出的快捷公式。然后，对于在物理空间中各向同性应用的 $W = 6\\,\\mathrm{mm}$ 的目标 FWHM，计算以毫米为单位的标准差，并对于一个体素大小为 $s_{x} = 0.8\\,\\mathrm{mm}$、$s_{y} = 0.8\\,\\mathrm{mm}$ 和 $s_{z} = 1.5\\,\\mathrm{mm}$ 的CT图像，将其转换为以体素为单位的各轴标准差。将最终答案表示为一个包含 $(\\sigma_{x}, \\sigma_{y}, \\sigma_{z})$ 的行矩阵，单位为体素，其中 $\\sigma_{i} = \\sigma_{\\mathrm{mm}}/s_{i}$ 对于 $i \\in \\{x,y,z\\}$。将每个分量四舍五入到四位有效数字。最终答案必须以体素为单位给出。",
            "solution": "在尝试求解之前，对问题陈述的有效性进行评估。\n\n### 步骤1：提取已知条件\n- 高斯函数：$g(x) = A \\exp(-\\frac{x^{2}}{2\\sigma^{2}})$\n- $A$：$x=0$ 处的峰值振幅。\n- $\\sigma$：标准差。\n- 半峰全宽 (FWHM) 定义：$g(x)$ 等于其最大值一半的两个点之间的宽度。\n- 目标 FWHM：$W = 6\\,\\mathrm{mm}$。\n- 平滑在物理空间中是各向同性应用的。\n- 体素大小：$s_{x} = 0.8\\,\\mathrm{mm}$，$s_{y} = 0.8\\,\\mathrm{mm}$ 和 $s_{z} = 1.5\\,\\mathrm{mm}$。\n- 体素单位标准差的转换公式：$\\sigma_{i} = \\sigma_{\\mathrm{mm}}/s_{i}$ 对于 $i \\in \\{x,y,z\\}$。\n- 要求输出：一个行矩阵 $(\\sigma_{x}, \\sigma_{y}, \\sigma_{z})$，以体素为单位，每个分量四舍五入到四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，因为它涉及图像处理（特别是在放射组学领域）背景下高斯函数和 FWHM 的标准定义与应用。所提供的值对于临床CT成像而言是现实的。该问题是适定的，提供了所有必要的信息和定义以得到唯一解。它是客观的，并使用了精确、无歧义的语言。该问题不违反任何无效性标准。\n\n### 步骤3：结论与行动\n问题被判定为有效。将提供一个完整的、有理有据的解答。\n\n### 求解推导\n\n解决方案分为三个部分：首先，推导半峰全宽（$W$，在问题中记为FWHM）与标准差（$\\sigma$）之间的解析关系；其次，根据给定的 $W$ 计算物理单位（毫米）下的标准差；第三，将此物理标准差转换为以体素为单位的各轴标准差。\n\n**第一部分：推导 FWHM 与 $\\sigma$ 之间的关系**\n\n一维高斯函数由下式给出：\n$$g(x) = A \\exp\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right)$$\n函数的最大值 $g_{\\mathrm{max}}$ 出现在高斯函数的峰值处，即 $x=0$。将 $x=0$ 代入方程得到：\n$$g_{\\mathrm{max}} = g(0) = A \\exp\\left(-\\frac{0^{2}}{2\\sigma^{2}}\\right) = A \\exp(0) = A$$\nFWHM 定义为函数值等于其最大值一半的两个点 $x$ 之间的宽度。我们设 $g(x) = \\frac{1}{2} g_{\\mathrm{max}}$：\n$$g(x) = \\frac{A}{2}$$\n代入 $g(x)$ 的表达式，我们得到：\n$$A \\exp\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right) = \\frac{A}{2}$$\n假设 $A \\neq 0$，我们可以将两边同除以 $A$：\n$$\\exp\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right) = \\frac{1}{2}$$\n为了求解 $x$，我们对两边取自然对数 ($\\ln$)：\n$$\\ln\\left[\\exp\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right)\\right] = \\ln\\left(\\frac{1}{2}\\right)$$\n$$-\\frac{x^{2}}{2\\sigma^{2}} = -\\ln(2)$$\n两边同乘以 $-1$ 得：\n$$\\frac{x^{2}}{2\\sigma^{2}} = \\ln(2)$$\n现在，我们求解 $x^2$：\n$$x^{2} = 2\\sigma^{2}\\ln(2)$$\n最后求解 $x$：\n$$x = \\pm \\sqrt{2\\sigma^{2}\\ln(2)} = \\pm \\sigma\\sqrt{2\\ln(2)}$$\n设这两个点为 $x_1 = -\\sigma\\sqrt{2\\ln(2)}$ 和 $x_2 = +\\sigma\\sqrt{2\\ln(2)}$。FWHM，记为 $W$，是这两点之间的距离：\n$$W = x_2 - x_1 = \\left(\\sigma\\sqrt{2\\ln(2)}\\right) - \\left(-\\sigma\\sqrt{2\\ln(2)}\\right)$$\n$$W = 2\\sigma\\sqrt{2\\ln(2)}$$\n这就是 FWHM ($W$) 与标准差 ($\\sigma$) 之间的解析关系。\n\n**第二部分：计算物理单位 (mm) 下的 $\\sigma$**\n\n给定目标 FWHM 为 $W = 6\\,\\mathrm{mm}$。我们可以重排已推导出的关系式来求解 $\\sigma$：\n$$\\sigma = \\frac{W}{2\\sqrt{2\\ln(2)}}$$\n由于模糊在物理空间中是各向同性的，这个标准差（我们称之为 $\\sigma_{\\mathrm{mm}}$）在所有轴向上是相同的。代入 $W = 6\\,\\mathrm{mm}$：\n$$\\sigma_{\\mathrm{mm}} = \\frac{6}{2\\sqrt{2\\ln(2)}} = \\frac{3}{\\sqrt{2\\ln(2)}}\\,\\mathrm{mm}$$\n为了进行数值计算，我们使用 $\\ln(2) \\approx 0.69314718$ 的值：\n$$\\sigma_{\\mathrm{mm}} = \\frac{3}{\\sqrt{2 \\times 0.69314718}} \\approx \\frac{3}{\\sqrt{1.38629436}} \\approx \\frac{3}{1.17741002}\\,\\mathrm{mm}$$\n$$\\sigma_{\\mathrm{mm}} \\approx 2.5481755\\,\\mathrm{mm}$$\n\n**第三部分：将 $\\sigma_{\\mathrm{mm}}$ 转换为体素单位**\n\n问题要求将标准差表示为每个轴上的体素单位，使用公式 $\\sigma_{i} = \\sigma_{\\mathrm{mm}}/s_{i}$，其中 $s_i$ 是沿 $i$ 轴的体素大小。\n给定的体素大小为 $s_{x} = 0.8\\,\\mathrm{mm}$，$s_{y} = 0.8\\,\\mathrm{mm}$ 和 $s_{z} = 1.5\\,\\mathrm{mm}$。\n\n对于 x 轴：\n$$\\sigma_{x} = \\frac{\\sigma_{\\mathrm{mm}}}{s_{x}} = \\frac{2.5481755\\,\\mathrm{mm}}{0.8\\,\\mathrm{mm}} \\approx 3.185219\\,\\text{体素}$$\n四舍五入到四位有效数字，$\\sigma_{x} \\approx 3.185$。\n\n对于 y 轴：\n$$\\sigma_{y} = \\frac{\\sigma_{\\mathrm{mm}}}{s_{y}} = \\frac{2.5481755\\,\\mathrm{mm}}{0.8\\,\\mathrm{mm}} \\approx 3.185219\\,\\text{体素}$$\n四舍五入到四位有效数字，$\\sigma_{y} \\approx 3.185$。\n\n对于 z 轴：\n$$\\sigma_{z} = \\frac{\\sigma_{\\mathrm{mm}}}{s_{z}} = \\frac{2.5481755\\,\\mathrm{mm}}{1.5\\,\\mathrm{mm}} \\approx 1.698784\\,\\text{体素}$$\n四舍五入到四位有效数字，$\\sigma_{z} \\approx 1.699$。\n\n最终答案是包含已计算值的行矩阵 $(\\sigma_x, \\sigma_y, \\sigma_z)$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 3.185 & 3.185 & 1.699 \\end{pmatrix}}$$"
        },
        {
            "introduction": "通用滤波器虽然方便，但在许多情况下，如果我们对信号和噪声的统计特性有所了解，就可以设计出一种“最优”的滤波器。维纳滤波器正是在最小化均方误差意义下的最优线性滤波器，它根据信号和噪声的功率谱来智能地平衡去噪与信号保真度。这项综合性练习将引导您完成从理论推导到代码实现的完整流程：您将推导维纳滤波器的数学形式，从含噪图像中估计所需的功率谱，并最终通过编程实现该滤波器，亲眼见证其强大的图像恢复效果。 ",
            "id": "4553371",
            "problem": "给定一个二维计算机断层扫描 (CT) 切片在加性噪声下的线性成像模型。令真实图像为 $X[\\mathbf{r}]$，噪声为 $N[\\mathbf{r}]$，观测图像为 $Y[\\mathbf{r}] = X[\\mathbf{r}] + N[\\mathbf{r}]$，其中 $\\mathbf{r} = (u,v)$ 是有限网格上的像素坐标索引。假设 $X[\\mathbf{r}]$ 和 $N[\\mathbf{r}]$ 是零均值、二阶平稳的随机场且互不相关。令 $\\mathcal{F}\\{\\cdot\\}$ 表示二维离散傅里叶变换 (DFT)，并定义二维角频率为 $\\boldsymbol{\\omega} = (\\omega_x,\\omega_y)$。一个场 $A[\\mathbf{r}]$ 的功率谱密度 (PSD) $S_{AA}(\\boldsymbol{\\omega})$ 是其自相关函数的傅里叶变换。在独立性与平稳性假设下，观测图像的功率谱密度满足 $S_{YY}(\\boldsymbol{\\omega}) = S_{XX}(\\boldsymbol{\\omega}) + S_{NN}(\\boldsymbol{\\omega})$。目标是通过一个频率响应为 $H(\\boldsymbol{\\omega})$ 的滤波器对 $Y[\\mathbf{r}]$进行滤波，从而恢复一个线性移不变估计量 $\\widehat{X}[\\mathbf{r}]$，即 $\\mathcal{F}\\{\\widehat{X}\\}(\\boldsymbol{\\omega}) = H(\\boldsymbol{\\omega}) \\,\\mathcal{F}\\{Y\\}(\\boldsymbol{\\omega})$。您必须从第一性原理出发，推导出在所有线性移不变估计器中，能最小化均方误差 $\\mathbb{E}\\{ \\lvert X[\\mathbf{r}] - \\widehat{X}[\\mathbf{r}] \\rvert^2 \\}$ 的最优 $H(\\boldsymbol{\\omega})$。\n\n您将实现一个完整的数值流程来：\n- 构建一个大小为 $N \\times N$（其中 $N = 64$）的合成类CT体模图像 $X[\\mathbf{r}]$，该图像包含具有分段常数强度的简单几何结构。\n- 在三个测试案例（测试套件）下生成带噪观测图像 $Y[\\mathbf{r}]$，其噪声实现 $N[\\mathbf{r}]$ 已知但不可观测。\n- 从一个假定只包含噪声的纯背景区域中估计 $S_{NN}(\\boldsymbol{\\omega})$，并从整个观测图像中估计 $S_{YY}(\\boldsymbol{\\omega})$。\n- 仅使用给定的假设，从 $S_{YY}(\\boldsymbol{\\omega})$ 和 $S_{NN}(\\boldsymbol{\\omega})$ 推断出 $S_{XX}(\\boldsymbol{\\omega})$。\n- 计算您推导出的最优 $H(\\boldsymbol{\\omega})$，在频域中应用它以获得 $\\widehat{X}[\\mathbf{r}]$，并量化其性能。\n\n您可以使用的基本原理：\n- 离散傅里叶变换 (DFT) 和卷积的线性性质，以及线性移不变滤波对应于频域中的乘法。\n- 功率谱密度 (PSD) 的定义，即广义平稳过程的自相关函数的傅里叶变换。\n- 对于不相关的信号和噪声，$S_{YY}(\\boldsymbol{\\omega}) = S_{XX}(\\boldsymbol{\\omega}) + S_{NN}(\\boldsymbol{\\omega})$。\n- 对于线性移不变估计器，可以按频率对均方误差最优性进行分析。\n\n需要实现的数值细节：\n- 图像大小为 $N \\times N$，$N = 64$；为保证可复现性，使用固定的随机种子 $1337$。\n- 按如下方式在零背景上构建 $X[\\mathbf{r}]$：\n  - 一个以 $(32,32)$ 为中心、半径为 $12$、强度为 $1.00$ 的圆盘。\n  - 一个覆盖所有行以及第 $28$ 至 $31$ 列（含边界）、强度为 $0.70$ 的垂直条。\n  - 一个从第 $12$ 行到第 $19$ 行、第 $44$ 列到第 $51$ 列（含边界）、强度为 $1.50$ 的正方形。\n- 定义一个纯背景区域为左上角的 $16 \\times 16$ 块，即索引 $u \\in [0,15]$，$v \\in [0,15]$，根据构造，该区域在清晰体模中仅包含背景。\n- 使用以下三个噪声条件的测试套件来创建 $Y[\\mathbf{r}] = X[\\mathbf{r}] + N[\\mathbf{r}]$：\n  1. 标准差为 $0.10$ 的高斯白噪声。\n  2. 将标准差为 $0.20$ 的高斯白噪声与标准差为 $2.0$ 像素的高斯核进行卷积，形成的彩色高斯噪声。\n  3. 标准差为 $0.02$ 的高斯白噪声。\n- 通过 $Y[\\mathbf{r}]$ 在整个图像上的周期图来估计 $S_{YY}(\\boldsymbol{\\omega})$：若 $F_Y = \\mathcal{F}\\{Y\\}$ 是在 $N \\times N$ 网格上的变换，则使用 $\\widehat{S}_{YY}(\\boldsymbol{\\omega}) = \\lvert F_Y \\rvert^2 / (N^2)$。\n- 通过纯噪声区域的周期图来估计 $S_{NN}(\\boldsymbol{\\omega})$，该区域在应用DFT之前需补零至 $N \\times N$ 大小。若该区域大小为 $M \\times M$ 且 $M=16$，且 $F_P$ 是补零后区域的 $N \\times N$ DFT，则使用 $\\widehat{S}_{NN}(\\boldsymbol{\\omega}) = \\lvert F_P \\rvert^2 / (M^2)$。\n- 仅使用可观测的量，根据平稳性和不相关性假设推断出 $\\widehat{S}_{XX}(\\boldsymbol{\\omega})$，并通过将任何负值截断为 $0$ 来强制其非负性。\n- 在实现过程中，在任何需要的地方使用一个小的正则化项 $\\varepsilon = 10^{-8}$ 以避免除以零。\n- 将您推导出的最优 $H(\\boldsymbol{\\omega})$ 在频域中应用于 $Y[\\mathbf{r}]$，并通过DFT逆变换获得实值估计 $\\widehat{X}[\\mathbf{r}]$。\n- 使用峰值信噪比 (PSNR) 量化性能，其定义为 $\\mathrm{PSNR} = 10 \\log_{10}\\!\\left(\\dfrac{A^2}{\\mathrm{MSE}}\\right)$，其中 $A$ 是 $X[\\mathbf{r}]$ 的已知峰值强度，$\\mathrm{MSE}$ 是 $X[\\mathbf{r}]$ 与待比较图像之间的均方误差。使用 $A = 1.50$。报告 PSNR 的提升量，其值为一个浮点数，等于 $\\mathrm{PSNR}(\\widehat{X}, X) - \\mathrm{PSNR}(Y, X)$，针对每个测试案例进行计算。\n\n角度单位不适用。无物理单位要求。所有输出必须是实数。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[\\text{result}_1,\\text{result}_2,\\text{result}_3]$），其中每个结果是相应测试用例的 PSNR 提升量，四舍五入到 $4$ 位小数。\n\n需要实现的测试套件总结：\n- 案例 1：白噪声，标准差 $0.10$。\n- 案例 2：通过高斯卷积得到的彩色噪声，基础白噪声标准差 $0.20$，高斯核标准差 $2.0$ 像素。\n- 案例 3：白噪声，标准差 $0.02$。\n\n您的代码必须是一个完整、可运行的程序，能够构建 $X[\\mathbf{r}]$，根据每个案例生成 $Y[\\mathbf{r}]$，从指定的区域估计所需的谱，推导并应用最优的 $H(\\boldsymbol{\\omega})$，并以指定的单行格式输出 PSNR 提升量。",
            "solution": "该问题要求在加性噪声模型下，为图像去噪推导一个最优的线性移不变滤波器，然后进行数值实现并在合成数据上进行评估。这是信号与图像处理中的一个标准问题，其解为维纳滤波器。\n\n### 1. 最优滤波器的理论推导\n\n我们给定一个线性成像模型，其中观测图像 $Y[\\mathbf{r}]$ 是真实图像 $X[\\mathbf{r}]$ 与不相关、零均值、二阶平稳的加性噪声 $N[\\mathbf{r}]$ 之和：\n$$ Y[\\mathbf{r}] = X[\\mathbf{r}] + N[\\mathbf{r}] $$\n我们寻求 $X[\\mathbf{r}]$ 的一个线性移不变 (LSI) 估计器 $\\widehat{X}[\\mathbf{r}]$。一个LSI滤波器由其卷积核 $h[\\mathbf{r}]$ 或等效地由其频率响应 $H(\\boldsymbol{\\omega})$ 定义。恢复后的图像在频域中由下式给出：\n$$ \\mathcal{F}\\{\\widehat{X}\\}(\\boldsymbol{\\omega}) = H(\\boldsymbol{\\omega}) \\mathcal{F}\\{Y\\}(\\boldsymbol{\\omega}) $$\n目标是找到使真实图像与估计图像之间的均方误差 (MSE) 最小化的滤波器 $H(\\boldsymbol{\\omega})$，MSE定义为 $\\mathrm{MSE} = \\mathbb{E}\\{ |X[\\mathbf{r}] - \\widehat{X}[\\mathbf{r}]|^2 \\}$。由于平稳性假设，MSE与空间坐标 $\\mathbf{r}$ 无关。\n\n令 $F_X(\\boldsymbol{\\omega})$、$F_Y(\\boldsymbol{\\omega})$ 和 $F_{\\widehat{X}}(\\boldsymbol{\\omega})$ 分别为相应信号的离散傅里叶变换 (DFT)。频域中的误差信号为 $F_E(\\boldsymbol{\\omega}) = F_X(\\boldsymbol{\\omega}) - F_{\\widehat{X}}(\\boldsymbol{\\omega})$。代入滤波器定义，我们得到：\n$$ F_E(\\boldsymbol{\\omega}) = F_X(\\boldsymbol{\\omega}) - H(\\boldsymbol{\\omega}) F_Y(\\boldsymbol{\\omega}) $$\nMSE可以计算为误差信号的功率谱密度 (PSD) $S_{EE}(\\boldsymbol{\\omega})$ 在所有频率上的总和（在连续情况下为积分）。PSD与DFT系数的期望平方幅度成正比，$S_{EE}(\\boldsymbol{\\omega}) \\propto \\mathbb{E}\\{ |F_E(\\boldsymbol{\\omega})|^2 \\}$。我们可以通过独立地最小化每个频率 $\\boldsymbol{\\omega}$ 上的 $S_{EE}(\\boldsymbol{\\omega})$ 来最小化总MSE。\n$$ \\mathbb{E}\\{ |F_E(\\boldsymbol{\\omega})|^2 \\} = \\mathbb{E}\\{ |F_X(\\boldsymbol{\\omega}) - H(\\boldsymbol{\\omega}) F_Y(\\boldsymbol{\\omega})|^2 \\} $$\n展开平方幅度：\n$$ \\mathbb{E}\\{ |F_E|^2 \\} = \\mathbb{E}\\{ (F_X - H F_Y)(F_X^* - H^* F_Y^*) \\} = \\mathbb{E}\\{ |F_X|^2 \\} - H \\mathbb{E}\\{ F_Y F_X^* \\} - H^* \\mathbb{E}\\{ F_Y^* F_X \\} + |H|^2 \\mathbb{E}\\{ |F_Y|^2 \\} $$\n这里，$H$ 是 $\\boldsymbol{\\omega}$ 的函数，* 表示复共轭。期望项与功率谱密度（$S_{AA}(\\boldsymbol{\\omega}) \\propto \\mathbb{E}\\{|F_A|^2\\}$）和互功率谱密度（$S_{AB}(\\boldsymbol{\\omega}) \\propto \\mathbb{E}\\{F_A F_B^*\\}$）有关。由于 $X$ 和 $N$ 不相关且零均值，它们的互功率谱密度 $S_{XN}(\\boldsymbol{\\omega})$ 为零。这意味着 $\\mathbb{E}\\{F_X F_N^*\\} = 0$。\n交叉项 $\\mathbb{E}\\{ F_Y F_X^* \\}$ 变为：\n$$ \\mathbb{E}\\{ F_Y F_X^* \\} = \\mathbb{E}\\{ (F_X + F_N) F_X^* \\} = \\mathbb{E}\\{ |F_X|^2 \\} + \\mathbb{E}\\{ F_N F_X^* \\} = \\mathbb{E}\\{ |F_X|^2 \\} $$\n因此，在频率 $\\boldsymbol{\\omega}$ 处的误差功率表达式与下式成正比：\n$$ S_{EE}(\\boldsymbol{\\omega}) = S_{XX}(\\boldsymbol{\\omega}) - H(\\boldsymbol{\\omega}) S_{XX}(\\boldsymbol{\\omega}) - H^*(\\boldsymbol{\\omega}) S_{XX}(\\boldsymbol{\\omega}) + |H(\\boldsymbol{\\omega})|^2 S_{YY}(\\boldsymbol{\\omega}) $$\n为了找到最小化此实值量（$S_{XX}$ 和 $S_{YY}$ 均为实数）的最优 $H(\\boldsymbol{\\omega}) = H_R + iH_I$，我们可以对其（$H(\\boldsymbol{\\omega})$）的实部 $H_R$ 和虚部 $H_I$ 求偏导。令 $\\frac{\\partial S_{EE}}{\\partial H_I} = 0$ 可知 $H_I=0$，因此最优滤波器是纯实数的。最小化问题简化为对 $H(\\boldsymbol{\\omega})$ 求导：\n$$ \\frac{\\partial S_{EE}(\\boldsymbol{\\omega})}{\\partial H(\\boldsymbol{\\omega})} = -2 S_{XX}(\\boldsymbol{\\omega}) + 2 H(\\boldsymbol{\\omega}) S_{YY}(\\boldsymbol{\\omega}) = 0 $$\n求解 $H(\\boldsymbol{\\omega})$ 可得最优滤波器传递函数，即维纳滤波器：\n$$ H_{optimal}(\\boldsymbol{\\omega}) = \\frac{S_{XX}(\\boldsymbol{\\omega})}{S_{YY}(\\boldsymbol{\\omega})} $$\n利用给定不相关信号的PSD加性性质，$S_{YY}(\\boldsymbol{\\omega}) = S_{XX}(\\boldsymbol{\\omega}) + S_{NN}(\\boldsymbol{\\omega})$，我们也可以将其写为：\n$$ H_{optimal}(\\boldsymbol{\\omega}) = \\frac{S_{XX}(\\boldsymbol{\\omega})}{S_{XX}(\\boldsymbol{\\omega}) + S_{NN}(\\boldsymbol{\\omega})} $$\n该滤波器智能地衰减那些噪声功率 $S_{NN}$ 相对于信号功率 $S_{XX}$ 较高的频率。\n\n### 2. 数值实现\n实现遵循问题的详细说明。使用固定的随机种子 $1337$ 以确保可复现性。\n\n**体模构建：** 创建一个大小为 $N \\times N$（$N=64$）的真实图像 $X[\\mathbf{r}]$。它由一个零强度背景和依次放置在其上的三个对象组成：一个圆盘（中心 $(32,32)$，半径 $12$，强度 $1.00$），一个垂直条（列 $28$ 至 $31$，强度 $0.70$），以及一个正方形（行 $12-19$，列 $44-51$，强度 $1.50$）。\n\n**噪声生成与观测：** 对于三个测试案例中的每一个，生成一个噪声场 $N[\\mathbf{r}]$ 并将其加到 $X[\\mathbf{r}]$ 上以形成观测图像 $Y[\\mathbf{r}]$。噪声模型为：\n1.  标准差为 $\\sigma=0.10$ 的高斯白噪声。\n2.  彩色高斯噪声，通过将标准差为 $\\sigma=0.20$ 的高斯白噪声与标准差为 $2.0$ 像素的高斯核进行卷积来创建。\n3.  标准差为 $\\sigma=0.02$ 的高斯白噪声。\n\n**功率谱密度估计：** 使用周期图从观测图像 $Y[\\mathbf{r}]$ 估计所需的功率谱密度。\n-   观测图像的功率谱密度 $S_{YY}(\\boldsymbol{\\omega})$ 使用完整的 $N \\times N$ 图像 $Y[\\mathbf{r}]$ 进行估计：\n    $$ \\widehat{S}_{YY}(\\boldsymbol{\\omega}) = \\frac{|\\mathcal{F}\\{Y[\\mathbf{r}]\\}|^2}{N^2} $$\n-   噪声的功率谱密度 $S_{NN}(\\boldsymbol{\\omega})$ 从 $Y[\\mathbf{r}]$ 左上角的 $M \\times M$ 纯噪声区域（$M=16$，其中 $X[\\mathbf{r}]=0$）进行估计。该区域在进行DFT之前需要补零到 $N \\times N$ 大小。规定的公式是：\n    $$ \\widehat{S}_{NN}(\\boldsymbol{\\omega}) = \\frac{|\\mathcal{F}\\{\\text{补零区域}\\}|^2}{M^2} $$\n-   然后根据其他两个估计值推断信号的功率谱密度 $S_{XX}(\\boldsymbol{\\omega})$，并施加非负性约束：\n    $$ \\widehat{S}_{XX}(\\boldsymbol{\\omega}) = \\max(0, \\widehat{S}_{YY}(\\boldsymbol{\\omega}) - \\widehat{S}_{NN}(\\boldsymbol{\\omega})) $$\n\n**滤波与恢复：** 使用估计的PSD和小的正则化项 $\\varepsilon=10^{-8}$ 来构建数值维纳滤波器，以防止除以零：\n$$ \\widehat{H}(\\boldsymbol{\\omega}) = \\frac{\\widehat{S}_{XX}(\\boldsymbol{\\omega})}{\\widehat{S}_{YY}(\\boldsymbol{\\omega}) + \\varepsilon} $$\n通过将该滤波器与观测图像的DFT $F_Y(\\boldsymbol{\\omega})$ 相乘来应用它。然后通过对乘积进行逆DFT并取实部来获得估计图像 $\\widehat{X}[\\mathbf{r}]$：\n$$ \\widehat{X}[\\mathbf{r}] = \\text{real}(\\mathcal{F}^{-1}\\{ \\widehat{H}(\\boldsymbol{\\omega}) F_Y(\\boldsymbol{\\omega}) \\}) $$\n\n**性能评估：** 性能通过峰值信噪比 (PSNR) 的提升来衡量，其中 $\\mathrm{PSNR} = 10 \\log_{10}(A^2 / \\mathrm{MSE})$，给定的峰值信号幅度为 $A=1.50$。为每个案例报告的最终值是差值：$\\mathrm{PSNR}(\\widehat{X}, X) - \\mathrm{PSNR}(Y, X)$。结果四舍五入到 $4$ 位小数。\n```python\nimport numpy as np\nimport scipy.ndimage\n\ndef solve():\n    \"\"\"\n    Derives and applies a Wiener filter to denoise synthetic CT images.\n    \"\"\"\n    \n    # --- GLOBAL PARAMETERS ---\n    N = 64  # Image size N x N\n    M = 16  # Noise patch size M x M\n    RANDOM_SEED = 1337\n    EPSILON = 1e-8\n    PEAK_AMPLITUDE = 1.50\n\n    rng = np.random.default_rng(RANDOM_SEED)\n\n    # --- HELPER FUNCTIONS ---\n    def create_phantom(n_size):\n        \"\"\"Constructs the synthetic CT-like phantom image.\"\"\"\n        x = np.zeros((n_size, n_size), dtype=np.float64)\n        rows, cols = np.meshgrid(np.arange(n_size), np.arange(n_size), indexing='ij')\n\n        # 1. Disk\n        center_r, center_c, radius = 32, 32, 12\n        # The problem specifies a \"disk\" (圆盘), which is a filled circle.\n        # The original code used '==' which creates a hollow circle. This is corrected to '='.\n        disk_mask = (rows - center_r)**2 + (cols - center_c)**2 = radius**2\n        x[disk_mask] = 1.00\n\n        # 2. Vertical bar\n        x[:, 28:32] = 0.70\n\n        # 3. Square\n        x[12:20, 44:52] = 1.50\n        \n        return x\n\n    def calculate_psnr(img1, img2, peak_val):\n        \"\"\"Calculates the Peak Signal-to-Noise Ratio between two images.\"\"\"\n        mse = np.mean((img1 - img2)**2)\n        if mse == 0:\n            return float('inf')\n        return 10 * np.log10(peak_val**2 / mse)\n\n    # --- MAIN PIPELINE ---\n\n    # 1. Construct the true image X\n    X_true = create_phantom(N)\n\n    # 2. Define the test suite\n    test_cases = [\n        {'type': 'white', 'std': 0.10, 'kernel_std': None},\n        {'type': 'colored', 'std': 0.20, 'kernel_std': 2.0},\n        {'type': 'white', 'std': 0.02, 'kernel_std': None}\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # 3. Generate noise and the observed image Y\n        if case['type'] == 'white':\n            noise = rng.normal(loc=0, scale=case['std'], size=(N, N))\n        elif case['type'] == 'colored':\n            white_noise = rng.normal(loc=0, scale=case['std'], size=(N, N))\n            noise = scipy.ndimage.gaussian_filter(white_noise, sigma=case['kernel_std'])\n        \n        Y_observed = X_true + noise\n\n        # 4. Estimate Power Spectral Densities (PSDs)\n        # Estimate S_YY from the full image\n        F_Y = np.fft.fft2(Y_observed)\n        S_YY_hat = np.abs(F_Y)**2 / (N**2)\n\n        # Estimate S_NN from the top-left M x M noise patch\n        noise_patch = Y_observed[0:M, 0:M]\n        padded_patch = np.zeros((N, N), dtype=np.float64)\n        padded_patch[0:M, 0:M] = noise_patch\n        F_P = np.fft.fft2(padded_patch)\n        S_NN_hat = np.abs(F_P)**2 / (M**2)\n\n        # 5. Infer signal PSD S_XX\n        S_XX_hat = S_YY_hat - S_NN_hat\n        S_XX_hat = np.maximum(0, S_XX_hat) # Enforce non-negativity\n\n        # 6. Compute the optimal Wiener filter H\n        H_optimal = S_XX_hat / (S_YY_hat + EPSILON)\n\n        # 7. Apply the filter to obtain the estimated image X_hat\n        F_X_hat = H_optimal * F_Y\n        X_hat = np.real(np.fft.ifft2(F_X_hat))\n\n        # 8. Quantify performance\n        psnr_noisy = calculate_psnr(Y_observed, X_true, PEAK_AMPLITUDE)\n        psnr_filtered = calculate_psnr(X_hat, X_true, PEAK_AMPLITUDE)\n        \n        psnr_improvement = psnr_filtered - psnr_noisy\n        results.append(round(psnr_improvement, 4))\n    \n    # --- FINAL OUTPUT ---\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```",
            "answer": "[5.5342,8.1256,12.7562]"
        }
    ]
}