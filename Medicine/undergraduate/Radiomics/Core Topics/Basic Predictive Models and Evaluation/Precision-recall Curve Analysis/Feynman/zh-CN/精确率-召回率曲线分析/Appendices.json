{
    "hands_on_practices": [
        {
            "introduction": "理论知识的最佳检验是亲手实践。这项练习将带你从最基础的步骤开始，利用一组包含分类器得分和真实标签的影像组学数据，一步步构建精确率-召回率（PR）曲线。通过这个过程，你不仅能加深对精确率（Precision）和召回率（Recall）定义的理解，还能掌握如何通过移动决策阈值来生成PR曲线上的各个点，并学会处理实际数据中常见的得分并列问题。",
            "id": "4556368",
            "problem": "一个影像组学分类器处理计算机断层扫描成像数据，为每位患者分配一个恶性可能性评分。该分类器为每个病例输出一个介于 $0$ 和 $1$ 之间的实值分数。真实标签是二元的，其中 $1$ 表示存在恶性肿瘤，$0$ 表示不存在恶性肿瘤。在精确率-召回率 (PR) 分析中，精确率 $P$ 和召回率 $R$ 根据基本定义由 $P = \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FP}}$ 和 $R = \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FN}}$ 给出，其中 $\\mathrm{TP}$ 是真阳性数量，$\\mathrm{FP}$ 是假阳性数量，$\\mathrm{FN}$ 是假阴性数量。对于一个决策阈值 $\\tau$，如果一个病例的分数至少为 $\\tau$，则该病例被预测为阳性。\n\n现给出 $8$ 位患者已知的真实标签和分类器分数：\n- 患者 $\\mathrm{A}$：分数 $0.92$，标签 $1$。\n- 患者 $\\mathrm{B}$：分数 $0.90$，标签 $0$。\n- 患者 $\\mathrm{C}$：分数 $0.90$，标签 $1$。\n- 患者 $\\mathrm{D}$：分数 $0.85$，标签 $1$。\n- 患者 $\\mathrm{E}$：分数 $0.85$，标签 $0$。\n- 患者 $\\mathrm{F}$：分数 $0.80$，标签 $0$。\n- 患者 $\\mathrm{G}$：分数 $0.75$，标签 $1$。\n- 患者 $\\mathrm{H}$：分数 $0.75$，标签 $1$。\n\n仅从上述定义出发，完成以下任务：\n1. 推导出一个从高到低的决策阈值 $\\tau$ 的精确序列，该序列能生成 PR 曲线上的所有不同 $(R, P)$ 点。明确说明必须如何处理相同的分数，以确保进行科学有效且内部一致的 PR 扫描。\n2. 使用基于这些定义的阶梯函数解释来计算 PR 曲线下面积。您的最终输出必须是一个实数。将最终数值答案四舍五入到四位有效数字。无需单位。将任何中间比例或比率以小数或分数形式表示，不要使用百分号。",
            "solution": "首先验证问题，以确保其科学上合理、良构且客观。\n\n### 第1步：提取已知信息\n- **定义**：\n  - 精确率：$P = \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FP}}$\n  - 召回率：$R = \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FN}}$\n  - $\\mathrm{TP}$：真阳性，$\\mathrm{FP}$：假阳性，$\\mathrm{FN}$：假阴性。\n- **分类规则**：如果一个病例的分数大于或等于决策阈值 $\\tau$，则该病例被预测为阳性。\n- **数据**：一组 $8$ 名患者的分数和真实标签（$1$ 代表恶性，$0$ 代表不存在）。\n  - 患者 A：分数 $0.92$，标签 $1$\n  - 患者 B：分数 $0.90$，标签 $0$\n  - 患者 C：分数 $0.90$，标签 $1$\n  - 患者 D：分数 $0.85$，标签 $1$\n  - 患者 E：分数 $0.85$，标签 $0$\n  - 患者 F：分数 $0.80$，标签 $0$\n  - 患者 G：分数 $0.75$，标签 $1$\n  - 患者 H：分数 $0.75$，标签 $1$\n- **任务**：\n  1. 推导生成所有不同 $(R, P)$ 点的决策阈值 $\\tau$ 序列，并解释如何处理分数并列的情况。\n  2. 使用阶梯函数解释计算 PR 曲线下面积 (AUPRC)，并四舍五入到四位有效数字。\n\n### 第2步：使用提取的已知信息进行验证\n该问题定义明确，内部一致，并在机器学习和医学图像分析领域具有科学依据。精确率和召回率的定义是标准的。数据集对于该任务是完整且充分的。说明清晰客观。该问题不违反任何科学原理，没有歧义，并且拥有唯一且有意义的解。\n\n### 第3步：结论与行动\n问题有效。将提供完整解答。\n\n### 解答\n\n解答过程按要求分为两部分。首先，我们确定阈值和相应的精确率-召回率点。其次，我们计算所得 PR 曲线下的面积。\n\n首先，我们必须确定数据集中阳性病例和阴性病例的总数。通过计算标签，我们发现：\n- 阳性病例总数 ($P_{total} = \\mathrm{TP} + \\mathrm{FN}$) = $5$（患者 A, C, D, G, H）。\n- 阴性病例总数 ($N_{total}$) = $3$（患者 B, E, F）。\n患者总数为 $N = P_{total} + N_{total} = 5 + 3 = 8$。\n\n召回率定义为 $R = \\frac{\\mathrm{TP}}{P_{total}} = \\frac{\\mathrm{TP}}{5}$。精确率是 $P = \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FP}}$。\n\n#### 第1部分：阈值、并列处理和 (R, P) 点\n\n为了生成 PR 曲线，我们将决策阈值 $\\tau$ 从一个高于最高分的值一直变化到最低分。$(R, P)$ 坐标仅在阈值等于患者分数时才发生变化。因此，生成所有不同 $(R, P)$ 点的阈值序列是数据中唯一分数的集合，按降序排列。\n\n患者数据按分数从高到低排序：\n1. 患者 A：分数 $0.92$，标签 $1$\n2. 患者 C：分数 $0.90$，标签 $1$\n3. 患者 B：分数 $0.90$，标签 $0$\n4. 患者 D：分数 $0.85$，标签 $1$\n5. 患者 E：分数 $0.85$，标签 $0$\n6. 患者 F：分数 $0.80$，标签 $0$\n7. 患者 G：分数 $0.75$，标签 $1$\n8. 患者 H：分数 $0.75$，标签 $1$\n\n**相同分数的处理**：当分数相同时，例如患者 (B, C)、(D, E) 和 (G, H)，为了进行科学有效且内部一致的阈值 $\\tau$ 扫描，需要将给定分数值下的所有病例同时分类。例如，当 $\\tau$ 降低到 $0.90$ 时，患者 B 和 C 都被新分类为阳性。通过将该分数下的所有病例视为一个整体来更新 $\\mathrm{TP}$ 和 $\\mathrm{FP}$ 的计数，并计算出一个不同的 $(R, P)$ 点。\n\n生成新的 $(R, P)$ 点的决策阈值序列是唯一分数的有序集合：$\\{\\tau_1, \\tau_2, \\tau_3, \\tau_4, \\tau_5\\} = \\{0.92, 0.90, 0.85, 0.80, 0.75\\}$。\n\n我们现在计算每个阈值下 $\\mathrm{TP}$ 和 $\\mathrm{FP}$ 的累积计数，以及由此产生的 $(R, P)$ 值。\n\n- **初始状态 ($\\tau > 0.92$)**：没有患者被分类为阳性。$\\mathrm{TP}=0, \\mathrm{FP}=0$。这得出 $R=0$。精确率未定义（$\\frac{0}{0}$）。按照惯例，PR 曲线可以从 $(R, P)=(0, 1)$ 开始，这代表分类器不做任何阳性预测的状态。\n\n- **$\\tau = 0.92$**：患者 A（标签 $1$）现在被分类为阳性。\n  - $\\mathrm{TP}$ 增加 $1$，$\\mathrm{FP}$ 增加 $0$。累积：$\\mathrm{TP}=1, \\mathrm{FP}=0$。\n  - $R = \\frac{1}{5} = 0.2$。\n  - $P = \\frac{1}{1+0} = 1$。\n  - 点 1：$(0.2, 1.0)$。\n\n- **$\\tau = 0.90$**：患者 C（标签 $1$）和 B（标签 $0$）现在被分类为阳性。\n  - $\\mathrm{TP}$ 增加 $1$，$\\mathrm{FP}$ 增加 $1$。累积：$\\mathrm{TP}=1+1=2, \\mathrm{FP}=0+1=1$。\n  - $R = \\frac{2}{5} = 0.4$。\n  - $P = \\frac{2}{2+1} = \\frac{2}{3}$。\n  - 点 2：$(0.4, \\frac{2}{3})$。\n\n- **$\\tau = 0.85$**：患者 D（标签 $1$）和 E（标签 $0$）现在被分类为阳性。\n  - $\\mathrm{TP}$ 增加 $1$，$\\mathrm{FP}$ 增加 $1$。累积：$\\mathrm{TP}=2+1=3, \\mathrm{FP}=1+1=2$。\n  - $R = \\frac{3}{5} = 0.6$。\n  - $P = \\frac{3}{3+2} = \\frac{3}{5}$。\n  - 点 3：$(0.6, 0.6)$。\n\n- **$\\tau = 0.80$**：患者 F（标签 $0$）现在被分类为阳性。\n  - $\\mathrm{TP}$ 增加 $0$，$\\mathrm{FP}$ 增加 $1$。累积：$\\mathrm{TP}=3, \\mathrm{FP}=2+1=3$。\n  - $R = \\frac{3}{5} = 0.6$。（召回率不变）。\n  - $P = \\frac{3}{3+3} = \\frac{3}{6} = 0.5$。\n  - 点 4：$(0.6, 0.5)$。\n\n- **$\\tau = 0.75$**：患者 G（标签 $1$）和 H（标签 $1$）现在被分类为阳性。\n  - $\\mathrm{TP}$ 增加 $2$，$\\mathrm{FP}$ 增加 $0$。累积：$\\mathrm{TP}=3+2=5, \\mathrm{FP}=3+0=3$。\n  - $R = \\frac{5}{5} = 1.0$。\n  - $P = \\frac{5}{5+3} = \\frac{5}{8}$。\n  - 点 5：$(1.0, \\frac{5}{8})$。\n\n生成的不同 $(R, P)$ 点序列为 $(0.2, 1)$、$(0.4, 2/3)$、$(0.6, 3/5)$、$(0.6, 1/2)$ 和 $(1.0, 5/8)$。\n\n#### 第2部分：PR 曲线下面积 (AUPRC)\n\nAUPRC 的“阶梯函数解释”对应于平均精确率（AP）的计算，即非插值 PR 曲线下的面积。它被计算为一系列矩形面积的总和，其中每个矩形的宽度是召回率的增量，其高度是该点的精确率。公式为：\n$$ \\mathrm{AUPRC} = \\sum_{k} (R_k - R_{k-1}) P_k $$\n其中，总和是对所有召回率增加的点 $k$ 进行的。项 $(R_k - R_{k-1})$ 表示召回率的增量，而 $P_k$ 是在召回率水平 $R_k$ 处测得的精确率。\n\n我们找出召回率增加的阈值，并计算相应的面积贡献：\n\n1.  在 $\\tau = 0.92$ 时，找到一个真阳性。召回率从 $R_0 = 0$ 增加到 $R_1 = 0.2$。精确率为 $P_1 = 1$。\n    面积贡献：$(0.2 - 0) \\times 1 = 0.2$。\n\n2.  在 $\\tau = 0.90$ 时，找到一个真阳性。召回率从 $R_1 = 0.2$ 增加到 $R_2 = 0.4$。精确率为 $P_2 = \\frac{2}{3}$。\n    面积贡献：$(0.4 - 0.2) \\times \\frac{2}{3} = 0.2 \\times \\frac{2}{3} = \\frac{1}{5} \\times \\frac{2}{3} = \\frac{2}{15}$。\n\n3.  在 $\\tau = 0.85$ 时，找到一个真阳性。召回率从 $R_2 = 0.4$ 增加到 $R_3 = 0.6$。精确率为 $P_3 = \\frac{3}{5}$。\n    面积贡献：$(0.6 - 0.4) \\times \\frac{3}{5} = 0.2 \\times \\frac{3}{5} = \\frac{1}{5} \\times \\frac{3}{5} = \\frac{3}{25}$。\n\n4.  在 $\\tau = 0.80$ 时，只找到一个假阳性。召回率没有变化。因此，这一步对 AUPRC 计算没有面积贡献，即 $(R_3-R_3) \\times P_4 = 0$。这个点只是在 PR 图上产生一个垂直下降。\n\n5.  在 $\\tau = 0.75$ 时，找到两个真阳性。召回率从 $R_3 = 0.6$ 增加到 $R_5 = 1.0$。精确率为 $P_5 = \\frac{5}{8}$。\n    面积贡献：$(1.0 - 0.6) \\times \\frac{5}{8} = 0.4 \\times \\frac{5}{8} = \\frac{2}{5} \\times \\frac{5}{8} = \\frac{10}{40} = \\frac{1}{4}$。\n\n总 AUPRC 是这些贡献的总和：\n$$ \\mathrm{AUPRC} = \\left( \\frac{1}{5} \\times 1 \\right) + \\left( \\frac{1}{5} \\times \\frac{2}{3} \\right) + \\left( \\frac{1}{5} \\times \\frac{3}{5} \\right) + \\left( \\frac{2}{5} \\times \\frac{5}{8} \\right) $$\n$$ \\mathrm{AUPRC} = \\frac{1}{5} + \\frac{2}{15} + \\frac{3}{25} + \\frac{10}{40} = \\frac{1}{5} + \\frac{2}{15} + \\frac{3}{25} + \\frac{1}{4} $$\n为了将这些分数相加，我们找到一个公分母，即 $\\mathrm{LCM}(5, 15, 25, 4) = \\mathrm{LCM}(5, 3 \\cdot 5, 5^2, 2^2) = 3 \\cdot 5^2 \\cdot 2^2 = 300$。\n$$ \\mathrm{AUPRC} = \\frac{1 \\times 60}{300} + \\frac{2 \\times 20}{300} + \\frac{3 \\times 12}{300} + \\frac{1 \\times 75}{300} $$\n$$ \\mathrm{AUPRC} = \\frac{60 + 40 + 36 + 75}{300} = \\frac{211}{300} $$\n以小数表示，这是 $211 \\div 300 \\approx 0.703333...$。\n四舍五入到四位有效数字，最终结果是 $0.7033$。",
            "answer": "$$\n\\boxed{0.7033}\n$$"
        },
        {
            "introduction": "构建PR曲线后，下一步通常是计算曲线下面积（Area Under the Curve, AUC），以获得一个单一的性能指标。这项练习将介绍一种广泛使用的标准计算方法——平均精度（Average Precision, AP），它采用特定的插值规则来处理PR曲线特有的“锯齿形”波动。完成这项练习后，你将能够准确计算插值后的PR-AUC，并理解为何这种方法能够为模型性能提供一个稳定且可比的评估。",
            "id": "4556392",
            "problem": "一个放射组学团队正在验证一个二元分类器，该分类器根据计算机断层扫描（CT）图像特征来预测恶性肿瘤。在一个留出的测试集上，样本按分类器得分降序排列，并从高到低扫描阈值。每次阈值改变后，记录累积的召回率和精确率，从而得到一个精确率-召回率（PR）序列。设平均精确率（AP）根据信息检索和医学影像评估中使用的标准阶梯式约定进行计算。按阈值降序排列，记录的（召回率，精确率）对序列如下：\n- $\\left(R_{1},P_{1}\\right)=\\left(\\frac{1}{6},1\\right)$,\n- $\\left(R_{2},P_{2}\\right)=\\left(\\frac{1}{6},\\frac{1}{2}\\right)$,\n- $\\left(R_{3},P_{3}\\right)=\\left(\\frac{1}{3},\\frac{2}{3}\\right)$,\n- $\\left(R_{4},P_{4}\\right)=\\left(\\frac{1}{3},\\frac{1}{2}\\right)$,\n- $\\left(R_{5},P_{5}\\right)=\\left(\\frac{1}{3},\\frac{2}{5}\\right)$,\n- $\\left(R_{6},P_{6}\\right)=\\left(\\frac{1}{2},\\frac{1}{2}\\right)$,\n- $\\left(R_{7},P_{7}\\right)=\\left(\\frac{2}{3},\\frac{4}{7}\\right)$,\n- $\\left(R_{8},P_{8}\\right)=\\left(\\frac{2}{3},\\frac{1}{2}\\right)$,\n- $\\left(R_{9},P_{9}\\right)=\\left(\\frac{5}{6},\\frac{5}{9}\\right)$,\n- $\\left(R_{10},P_{10}\\right)=\\left(\\frac{5}{6},\\frac{1}{2}\\right)$,\n- $\\left(R_{11},P_{11}\\right)=\\left(\\frac{5}{6},\\frac{5}{11}\\right)$,\n- $\\left(R_{12},P_{12}\\right)=\\left(1,\\frac{1}{2}\\right)$.\n仅使用精确率和召回率的基本定义以及平均精确率的标准阶梯式定义，计算该序列的精确 AP 值，并在推导过程中解释，根据此约定应如何处理重复的召回率值。将最终的 AP 值四舍五入至四位有效数字。将最终答案表示为一个纯数字，不带百分号。",
            "solution": "首先将对问题的科学合理性、一致性和完整性进行验证。\n\n### 第 1 步：提取已知信息\n问题提供了一个由十二个精确率-召回率对 $(R_i, P_i)$ 组成的序列，该序列是通过在测试集上扫描分类器阈值生成的。该序列按阈值降序给出：\n- $(R_1, P_1) = (1/6, 1)$\n- $(R_2, P_2) = (1/6, 1/2)$\n- $(R_3, P_3) = (1/3, 2/3)$\n- $(R_4, P_4) = (1/3, 1/2)$\n- $(R_5, P_5) = (1/3, 2/5)$\n- $(R_6, P_6) = (1/2, 1/2)$\n- $(R_7, P_7) = (2/3, 4/7)$\n- $(R_8, P_8) = (2/3, 1/2)$\n- $(R_9, P_9) = (5/6, 5/9)$\n- $(R_{10}, P_{10}) = (5/6, 1/2)$\n- $(R_{11}, P_{11}) = (5/6, 5/11)$\n- $(R_{12}, P_{12}) = (1, 1/2)$\n\n任务是使用“标准阶梯式约定”计算平均精确率（$AP$），并解释如何处理重复的召回率值。最终答案必须四舍五入到四位有效数字。\n\n### 第 2 步：使用提取的已知信息进行验证\n根据所需标准对问题进行评估。\n- **科学依据**：该问题使用了机器学习和信息检索领域的标准、明确定义的度量指标：精确率、召回率和平均精确率。放射组学是一个常进行此类分类器验证的有效领域。召回率值 $R_i$ 是非递减的，这与扫描阈值以包含更多样本的做法相符。精确率值 $P_i$ 有所波动，但总体呈下降趋势，这也是预料之中的。这些分数值表明测试集是离散且有限的。召回率值 $\\frac{1}{6}, \\frac{2}{6}, \\frac{3}{6}, \\frac{4}{6}, \\frac{5}{6}, \\frac{6}{6}$ 强烈暗示测试集中总共有 $6$ 个正例，这使得数据内部一致且符合实际。\n- **适定性**：该问题提供了所有必要的数据，并指明了计算方法（“标准阶梯式约定”），即插值精确率-召回率曲线下的面积。这能够得出一个唯一的、可计算的解。四舍五入的指令是明确无误的。\n- **客观性**：该问题使用精确、正式的语言和数值数据进行陈述，没有主观性或模糊性。\n\n该问题不存在任何无效性缺陷。它是科学合理、自洽且适定的。\n\n### 第 3 步：结论与行动\n该问题被认为是有效的。将提供一个完整的解法。\n\n### 解题推导\n基本量是精确率（$P$）和召回率（$R$），定义如下：\n$$P = \\frac{TP}{TP + FP} \\quad , \\quad R = \\frac{TP}{N_p}$$\n其中 $TP$ 是真阳性的数量，$FP$ 是假阳性的数量，$N_p$ 是数据集中正例的总数。从给定的召回率值是 $\\frac{1}{6}$ 的倍数且最大达到 $1$ 这一点，我们推断出 $N_p=6$。\n\n平均精确率（$AP$）的“标准阶梯式约定”指的是计算插值精确率-召回率曲线下的面积。这是一种在 PASCAL VOC 挑战赛等评估中使用的标准方法。在任意召回率水平 $r$ 处的插值精确率，记为 $P_{\\text{interp}}(r)$，定义为在所有召回率水平 $r' \\ge r$ 中观测到的最大精确率。\n$$P_{\\text{interp}}(r) = \\max_{r' \\ge r} P(r')$$\n这就创建了一个关于召回率的单调非增的精确率阶梯函数。$AP$ 是该函数从 $r=0$ 到 $r=1$ 的定积分。\n\n问题询问如何处理重复的召回率值。当分类阈值降低时，会有额外的测试样本被分类为正例。如果一个新包含的样本是假阳性，$TP$ 保持不变，而 $FP$ 增加。这导致召回率（$R$）保持不变，而精确率（$P$）下降。这些具有重复召回率值的点，例如 $(R_2, P_2)$、$(R_4, P_4)$ 等，由于召回率的变化为零，因此不会在召回率轴上为面积计算建立新的阶梯。然而，在为所有之前的召回率水平计算插值精确率 $P_{\\text{interp}}(r)$ 时，会考虑它们的精确率值。\n\n为了计算 $AP$，我们首先确定召回率增加时的那些唯一的召回率水平。这些是找到真阳性的点。设这些唯一的召回率值为 $\\hat{R}_j$。数据显示这些值出现在 $\\frac{1}{6}, \\frac{2}{6}=\\frac{1}{3}, \\frac{3}{6}=\\frac{1}{2}, \\frac{4}{6}=\\frac{2}{3}, \\frac{5}{6}$ 和 $\\frac{6}{6}=1$。我们定义 $\\hat{R}_0 = 0$。\n\n曲线下每个矩形的宽度是召回率的变化量，$\\Delta \\hat{R}_j = \\hat{R}_j - \\hat{R}_{j-1}$。对于本问题，召回率的步长是均匀的：对于 $j=1, \\dots, 6$，$\\Delta \\hat{R}_j = \\frac{1}{6}$。\n每个矩形的高度是对应于该召回率区间的插值精确率。对于区间 $(\\hat{R}_{j-1}, \\hat{R}_j]$，高度是 $P_{\\text{interp}}(\\hat{R}_j)$。\n\n让我们计算每个唯一召回率步长处的插值精确率值：\n- 对于 $\\hat{R}_1 = \\frac{1}{6}$：$P_{\\text{interp}}(\\frac{1}{6}) = \\max(P_1, P_2, \\dots, P_{12}) = P_1 = 1$。\n- 对于 $\\hat{R}_2 = \\frac{1}{3}$：$P_{\\text{interp}}(\\frac{1}{3}) = \\max(P_3, P_4, \\dots, P_{12}) = P_3 = \\frac{2}{3}$，因为 $\\frac{2}{3} \\approx 0.667$ 是从第 3 个点开始的最大精确率。\n- 对于 $\\hat{R}_3 = \\frac{1}{2}$：$P_{\\text{interp}}(\\frac{1}{2}) = \\max(P_6, \\dots, P_{12}) = P_7 = \\frac{4}{7}$，因为 $\\frac{4}{7} \\approx 0.571$ 是从第 6 个点开始的最大精确率。\n- 对于 $\\hat{R}_4 = \\frac{2}{3}$：$P_{\\text{interp}}(\\frac{2}{3}) = \\max(P_7, \\dots, P_{12}) = P_7 = \\frac{4}{7}$。\n- 对于 $\\hat{R}_5 = \\frac{5}{6}$：$P_{\\text{interp}}(\\frac{5}{6}) = \\max(P_9, \\dots, P_{12}) = P_9 = \\frac{5}{9}$，因为 $\\frac{5}{9} \\approx 0.556$ 是从第 9 个点开始的最大精确率。\n- 对于 $\\hat{R}_6 = 1$：$P_{\\text{interp}}(1) = \\max(P_{12}) = P_{12} = \\frac{1}{2}$。\n\n$AP$ 是这些矩形面积的总和：\n$$AP = \\sum_{j=1}^{6} (\\hat{R}_j - \\hat{R}_{j-1}) \\cdot P_{\\text{interp}}(\\hat{R}_j)$$\n由于所有召回率步长 $\\Delta \\hat{R}_j = \\frac{1}{6}$，公式简化为：\n$$AP = \\frac{1}{6} \\sum_{j=1}^{6} P_{\\text{interp}}(\\hat{R}_j)$$\n$$AP = \\frac{1}{6} \\left( P_{\\text{interp}}\\left(\\frac{1}{6}\\right) + P_{\\text{interp}}\\left(\\frac{1}{3}\\right) + P_{\\text{interp}}\\left(\\frac{1}{2}\\right) + P_{\\text{interp}}\\left(\\frac{2}{3}\\right) + P_{\\text{interp}}\\left(\\frac{5}{6}\\right) + P_{\\text{interp}}(1) \\right)$$\n代入计算出的值：\n$$AP = \\frac{1}{6} \\left( 1 + \\frac{2}{3} + \\frac{4}{7} + \\frac{4}{7} + \\frac{5}{9} + \\frac{1}{2} \\right)$$\n$$AP = \\frac{1}{6} \\left( 1 + \\frac{2}{3} + \\frac{8}{7} + \\frac{5}{9} + \\frac{1}{2} \\right)$$\n为了对这些分数求和，我们找到 $1, 3, 7, 9, 2$ 的公分母。最小公倍数是 $126$。\n$$AP = \\frac{1}{6} \\left( \\frac{126}{126} + \\frac{2 \\cdot 42}{126} + \\frac{8 \\cdot 18}{126} + \\frac{5 \\cdot 14}{126} + \\frac{63}{126} \\right)$$\n$$AP = \\frac{1}{6} \\left( \\frac{126 + 84 + 144 + 70 + 63}{126} \\right)$$\n$$AP = \\frac{1}{6} \\left( \\frac{487}{126} \\right)$$\n$$AP = \\frac{487}{6 \\cdot 126} = \\frac{487}{756}$$\n为了得到最终的数值答案，我们进行除法运算并四舍五入到四位有效数字：\n$$AP = \\frac{487}{756} \\approx 0.64417989...$$\n四舍五入到四位有效数字得到 $0.6442$。",
            "answer": "$$\\boxed{0.6442}$$"
        },
        {
            "introduction": "在评估模型性能时，选择正确的计算方法至关重要，因为不同的方法可能导致不同的结论。这项练习旨在揭示不同PR曲线下面积计算方法之间的差异，特别是对比了标准的阶梯式平均精度（AP）和看似直观的梯形面积法（trapezoidal AUC）。通过分析一个精心设计的案例，你将亲手量化这两种方法之间的偏差，从而深刻理解为什么在科学评估中必须采用严谨且公认的度量标准。",
            "id": "4556339",
            "problem": "在一个使用磁共振成像（MRI）的影像组学分类研究中，一个模型根据从定量影像组学特征中提取的连续恶性程度评分对病灶候选进行排序。假设数据集包含 $6$ 个候选，其中 $3$ 个为真正的恶性（阳性），$3$ 个为良性（阴性）。这些候选按照模型评分降序排列，其真实标签顺序如下：\n$$[1,\\,0,\\,0,\\,1,\\,0,\\,1],$$\n其中 $1$ 表示恶性，$0$ 表示良性。常规的精确率-召回率曲线下面积（PR-AUC）有时通过在连续的召回率点之间对精确率进行线性插值并求和梯形面积来近似计算。平均精度（AP）则定义为在每个召回率增量上保持精确率恒定的阶梯式精确率-召回率函数下的面积。使用精确率 $P$ 和召回率 $R$ 的基本定义，\n$$P=\\frac{\\text{真阳性 (TP)}}{\\text{TP}+\\text{假阳性 (FP)}}, \\quad R=\\frac{\\text{TP}}{\\text{TP}+\\text{假阴性 (FN)}},$$\n计算在召回率发生变化的阈值处的精确率-召回率点（即，在每包含一个新的真阳性样本之后）。然后：\n1. 计算定义了平均精度（AP）的阶梯式面积（沿召回率轴）。\n2. 使用在连续的召回率变化点之间对精确率进行线性插值的方法计算梯形 PR-AUC。对于插值，包括常规的初始点 $(R,P)=(0,1)$。\n3. 将偏差定义为 $b=\\text{PR-AUC}_{\\text{trap}}-\\text{AP}$ 并精确计算它。\n\n证明对于这个排序示例，梯形 PR-AUC 高估了 AP，并确定精确的偏差 $b$。将最终偏差表示为一个无单位的最简分数。无需四舍五入。",
            "solution": "该问题要求计算和比较精确率-召回率（PR）曲线下面积的两种不同度量方法：基于阶梯式插值的平均精度（AP），以及基于线性插值的梯形 PR 曲线下面积（PR-AUC）。目标是对于给定的分类结果排序列表，找出这两种度量值之间的偏差。\n\n首先，我们根据提供的信息确定基本事实。数据集中有 $6$ 个候选。真正的恶性（阳性）实例数量为 $P_{total} = 3$，真正的良性（阴性）实例数量为 $N_{total} = 3$。阳性总数也由真阳性（TP）和假阴性（FN）之和给出，因此 $\\text{TP}+\\text{FN} = P_{total} = 3$。精确率（$P$）和召回率（$R$）的定义是：\n$$P = \\frac{\\text{TP}}{\\text{TP}+\\text{FP}}$$\n$$R = \\frac{\\text{TP}}{\\text{TP}+\\text{FN}} = \\frac{\\text{TP}}{3}$$\n\n模型的输出是按分数从高到低排列的真实标签列表：$[1, 0, 0, 1, 0, 1]$，其中 $1$ 表示阳性类别（恶性），$0$ 表示阴性类别（良性）。\n\n我们将按顺序处理此列表，以确定每个排名位置的 TP、FP、精确率和召回率的值。召回率仅在遇到真阳性实例时才会改变。我们需要在这些特定的排名位置确定精确率-召回率点。\n\n设 $k$ 为从 $1$ 到 $6$ 的排名。\n- 在排名 $k=1$ 处：标签为 $1$。\n  - 我们处理了一个阳性样本。TP$=1$，FP$=0$。\n  - $P_1 = \\frac{1}{1+0} = 1$。\n  - $R_1 = \\frac{1}{3}$。这是我们的第一个召回率变化点：$(R_1, P_1) = (\\frac{1}{3}, 1)$。\n\n- 在排名 $k=2$ 处：标签为 $0$。\n  - TP$=1$，FP$=1$。召回率不变。\n  - $P = \\frac{1}{1+1} = \\frac{1}{2}$。\n\n- 在排名 $k=3$ 处：标签为 $0$。\n  - TP$=1$，FP$=2$。召回率不变。\n  - $P = \\frac{1}{1+2} = \\frac{1}{3}$。\n\n- 在排名 $k=4$ 处：标签为 $1$。\n  - 我们现在处理了两个阳性样本。TP$=2$。在此排名之前有两个阴性样本。FP$=2$。\n  - $P_2 = \\frac{2}{2+2} = \\frac{1}{2}$。\n  - $R_2 = \\frac{2}{3}$。这是我们的第二个召回率变化点：$(R_2, P_2) = (\\frac{2}{3}, \\frac{1}{2})$。\n\n- 在排名 $k=5$ 处：标签为 $0$。\n  - TP$=2$，FP$=3$。召回率不变。\n  - $P = \\frac{2}{2+3} = \\frac{2}{5}$。\n\n- 在排名 $k=6$ 处：标签为 $1$。\n  - 我们现在处理了三个阳性样本。TP$=3$。总共有三个阴性样本。FP$=3$。\n  - $P_3 = \\frac{3}{3+3} = \\frac{1}{2}$。\n  - $R_3 = \\frac{3}{3} = 1$。这是我们的第三个召回率变化点：$(R_3, P_3) = (1, \\frac{1}{2})$。\n\n召回率变化点为：$(\\frac{1}{3}, 1)$, $(\\frac{2}{3}, \\frac{1}{2})$ 和 $(1, \\frac{1}{2})$。\n\n**1. 计算平均精度 (AP)**\n平均精度是在每个发现真阳性的排名位置上的精确率的加权平均，权重为召回率的变化。这等同于阶梯式 PR 曲线下的面积。\nAP 计算为矩形面积之和：\n$$\\text{AP} = \\sum_{k} P(k) \\Delta R(k)$$\n其中求和是对样本为阳性的排名 $k$ 进行的，$P(k)$ 是排名 $k$ 处的精确率，$\\Delta R(k)$ 是召回率的变化，对于每个阳性样本，该值为 $\\frac{1}{P_{total}} = \\frac{1}{3}$。\n阳性样本所在排名位置的精确率为：\n- 排名 $1$：$P(1) = 1$。\n- 排名 $4$：$P(4) = \\frac{2}{4} = \\frac{1}{2}$。\n- 排名 $6$：$P(6) = \\frac{3}{6} = \\frac{1}{2}$。\n\n$$\\text{AP} = \\left(P(1)\\times\\frac{1}{3}\\right) + \\left(P(4)\\times\\frac{1}{3}\\right) + \\left(P(6)\\times\\frac{1}{3}\\right) = \\frac{1}{3} (P(1) + P(4) + P(6))$$\n$$\\text{AP} = \\frac{1}{3} \\left(1 + \\frac{1}{2} + \\frac{1}{2}\\right) = \\frac{1}{3} (2) = \\frac{2}{3}$$\n\n**2. 计算梯形 PR-AUC**\n该度量通过对连续的召回率变化点之间进行线性插值形成的梯形面积求和来计算。问题指定包含一个初始点 $(R_0, P_0)=(0, 1)$。用于插值的点是：\n- 点 $0$：$(R_0, P_0) = (0, 1)$\n- 点 $1$：$(R_1, P_1) = (\\frac{1}{3}, 1)$\n- 点 $2$：$(R_2, P_2) = (\\frac{2}{3}, \\frac{1}{2})$\n- 点 $3$：$(R_3, P_3) = (1, \\frac{1}{2})$\n\n点 $(R_{i-1}, P_{i-1})$ 和 $(R_i, P_i)$ 之间的梯形面积为 $\\frac{1}{2}(P_{i-1} + P_i)(R_i - R_{i-1})$。\n\n- 梯形 $1$ 的面积（点 $0$ 和 $1$ 之间）：\n$$A_1 = \\frac{1}{2}(P_0 + P_1)(R_1 - R_0) = \\frac{1}{2}(1 + 1)\\left(\\frac{1}{3} - 0\\right) = \\frac{1}{2}(2)\\left(\\frac{1}{3}\\right) = \\frac{1}{3}$$\n\n- 梯形 $2$ 的面积（点 $1$ 和 $2$ 之间）：\n$$A_2 = \\frac{1}{2}(P_1 + P_2)(R_2 - R_1) = \\frac{1}{2}\\left(1 + \\frac{1}{2}\\right)\\left(\\frac{2}{3} - \\frac{1}{3}\\right) = \\frac{1}{2}\\left(\\frac{3}{2}\\right)\\left(\\frac{1}{3}\\right) = \\frac{1}{4}$$\n\n- 梯形 $3$ 的面积（点 $2$ 和 $3$ 之间）：\n$$A_3 = \\frac{1}{2}(P_2 + P_3)(R_3 - R_2) = \\frac{1}{2}\\left(\\frac{1}{2} + \\frac{1}{2}\\right)\\left(1 - \\frac{2}{3}\\right) = \\frac{1}{2}(1)\\left(\\frac{1}{3}\\right) = \\frac{1}{6}$$\n\n总的梯形 PR-AUC 是这些面积之和：\n$$\\text{PR-AUC}_{\\text{trap}} = A_1 + A_2 + A_3 = \\frac{1}{3} + \\frac{1}{4} + \\frac{1}{6}$$\n为了将这些分数相加，我们找到一个公分母，即 $12$：\n$$\\text{PR-AUC}_{\\text{trap}} = \\frac{4}{12} + \\frac{3}{12} + \\frac{2}{12} = \\frac{9}{12} = \\frac{3}{4}$$\n\n**3. 计算偏差, $b$**\n偏差定义为 $b = \\text{PR-AUC}_{\\text{trap}} - \\text{AP}$。\n$$b = \\frac{3}{4} - \\frac{2}{3}$$\n同样，我们使用公分母 $12$：\n$$b = \\frac{9}{12} - \\frac{8}{12} = \\frac{1}{12}$$\n\n梯形 PR-AUC 的值为 $\\frac{3}{4} = 0.75$，而 AP 的值为 $\\frac{2}{3} \\approx 0.667$。梯形近似确实高估了 AP，且偏差 $b = \\frac{1}{12}$ 为正。该偏差产生于任何精确率在两个召回率点之间下降的线段，因为线性插值线段将严格位于用于 AP 的分段常数函数之上。在这种情况下，偏差完全是在召回率从 $\\frac{1}{3}$ 到 $\\frac{2}{3}$ 的区间内产生的。",
            "answer": "$$\\boxed{\\frac{1}{12}}$$"
        }
    ]
}