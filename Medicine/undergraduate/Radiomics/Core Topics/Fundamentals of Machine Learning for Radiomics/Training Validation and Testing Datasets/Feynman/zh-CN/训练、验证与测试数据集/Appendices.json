{
    "hands_on_practices": [
        {
            "introduction": "在放射组学中，来自同一患者的多个数据点（例如，多个病灶或图像切片）并非真正独立。本练习探讨了患者内相关性的概念，并揭示了为什么在错误的数据层级（例如，病灶层级）上拆分数据会导致模型性能评估过于乐观且不可靠。理解并避免这种医学数据分析中的常见陷阱至关重要 。",
            "id": "4568185",
            "problem": "在影像组学研究中，每位患者都贡献了多个病灶，这些病灶以高维图像衍生特征为表征。考虑一个监督学习算法，该算法经过训练，可根据病灶级别的影像组学特征来预测一个二元临床终点。目标是估计对于未见过的新患者的泛化误差。设真实总体风险定义为 $R := \\mathbb{E}\\big[\\ell\\big(f_{\\mathcal{D}_{\\mathrm{train}}}(X^{*}), Y^{*}\\big)\\big]$，其中 $\\ell$ 是一个损失函数（例如，$0$-$1$ 损失），$f_{\\mathcal{D}_{\\mathrm{train}}}$ 是在训练数据集 $\\mathcal{D}_{\\mathrm{train}}$ 上学习到的预测器，而 $(X^{*}, Y^{*})$ 是从属于一个不在 $\\mathcal{D}_{\\mathrm{train}}$ 中的新患者的病灶的联合分布中进行的独立同分布 (i.i.d.) 抽样。\n\n假设患者 $i$ 有一个潜在的患者级别因子 $Z_{i}$，它会影响该患者的所有病灶。一个简单且广泛使用的随机效应描述是\n$$\nX_{ij} = g(Z_{i}) + \\varepsilon_{ij}, \\quad Y_{ij} = h(Z_{i}) + \\eta_{ij},\n$$\n其中 $j$ 是患者 $i$ 的病灶索引，$g$ 和 $h$ 是确定性函数，$\\varepsilon_{ij}$ 和 $\\eta_{ij}$ 是均值为零的残差，并且在给定 $Z_{i}$ 的条件下，在不同病灶间是独立的。患者内相关系数定义为 $\\rho := \\frac{\\mathrm{Var}(g(Z_{i}))}{\\mathrm{Var}(g(Z_{i})) + \\mathrm{Var}(\\varepsilon_{ij})}$，因此 $\\rho > 0$ 量化了来自同一患者的病灶之间的正相关性。\n\n考虑使用两种划分策略来构建训练、验证和测试数据集：\n- 病灶级别划分：随机划分病灶，因此训练、验证和测试集可能包含来自同一患者的不同病灶。\n- 患者级别划分：划分患者，确保来自特定患者的病灶只出现在训练、验证和测试集中的一个里面。\n\n仅使用泛化误差的基本定义和上述随机效应结构，定性地推断当在病灶级别进行划分时，$\\rho > 0$ 如何影响期望测试集误差（与对新患者的期望误差 $R$ 相比）。哪个选项最佳地解释了偏差的方向及其理由？\n\nA. 当 $\\rho > 0$ 时，病灶共享患者级别的信号 $Z_{i}$；病灶级别的划分会将 $Z_{i}$ 泄露到训练集和测试集中。在 $Z_{i}$ 已在 $\\mathcal{D}_{\\mathrm{train}}$ 中被表征的条件下，来自同一患者的测试病灶更容易预测，因此估计的测试误差相对于针对新患者的误差 $R$ 存在向下偏差。\n\nB. 当 $\\rho > 0$ 时，相关性仅增大了误差估计的方差；期望误差保持不变，因此病灶级别划分对于 $R$ 是无偏的。\n\nC. 当 $\\rho > 0$ 时，模型对训练病灶过拟合，使得测试病灶更难预测；因此，病灶级别划分导致估计的误差相对于 $R$ 存在向上偏差。\n\nD. 偏差方向无法从 $\\rho$ 确定；相关性影响依赖关系，但不影响误差的条件分布，因此在病灶级别划分下，估计的误差可能存在向上或向下偏差，这与 $\\rho$ 无关。\n\nE. 任何由 $\\rho > 0$ 引起的偏差在交叉验证下都会消失，因为随机折会平均掉相关性，从而使得病灶级别划分对于 $R$ 是无偏的。",
            "solution": "本问题要求我们推断，使用病灶级别划分所估计的测试误差，与针对新患者的真实泛化误差 $R$ 相比，其偏差如何。关键在于随机效应结构以及大于零的患者内相关性 $\\rho > 0$。\n\n1.  **真实泛化误差 ($R$) 的定义**：误差 $R$ 是针对一个新患者定义的。这意味着抽取一个不在 $\\mathcal{D}_{\\mathrm{train}}$ 中的患者，也就意味着抽取一个*新*的患者级别因子 $Z_{new}$，然后基于该新患者抽取一个病灶 $(X^*, Y^*)$。因此，有 $X^* = g(Z_{new}) + \\varepsilon$ 且 $Y^* = h(Z_{new}) + \\eta$。模型 $f_{\\mathcal{D}_{\\mathrm{train}}}$ 从未见过任何与 $Z_{new}$ 相关的数据。\n\n2.  **病灶级别划分**：在此策略中，我们将所有患者的所有病灶汇集起来，然后随机地将它们混洗分配到训练集、验证集和测试集中。对于一个拥有多个病灶的患者 $i$，其部分病灶（例如 $(X_{i1}, Y_{i1})$）极有可能最终进入训练集 $\\mathcal{D}_{\\mathrm{train}}$，而其他病灶（例如 $(X_{i2}, Y_{i2})$）则进入测试集。\n\n3.  **$\\rho > 0$ 的影响（信息泄露）**：条件 $\\rho > 0$ 意味着 $\\mathrm{Var}(g(Z_{i})) > 0$。这意味着患者级别因子 $Z_i$ 是一个变异来源；它是患者 $i$ 的所有病灶共享的信号。当来自患者 $i$ 的一个病灶在训练集中时，模型 $f_{\\mathcal{D}_{\\mathrm{train}}}$ 就能学到一些关于共享信号 $g(Z_i)$ 和 $h(Z_i)$ 的信息。例如，如果模型足够强大，它可能会隐式地学到识别与由 $Z_i$ 所代表的患者 $i$ 的特定生物学特征相关的特征。\n\n4.  **比较测试误差（病灶划分）与真实误差 ($R$)**：\n    *   **测试误差（病灶划分）**：测试集包含来自训练集中*已出现过*的患者的病灶，例如 $(X_{i,test}, Y_{i,test})$。模型对 $X_{i,test}$ 进行预测 $f_{\\mathcal{D}_{\\mathrm{train}}}(X_{i,test})$。因为模型已经在来自患者 $i$ 的其他病灶上进行过训练，所以它已经接触过信号 $Z_i$。因此，预测来自*同一患者*的另一个病灶的结果，比预测来自一个全新患者的病灶要“容易”一些。测试误差是在并非真正独立于训练数据的样本上计算的。共享因子 $Z_i$ 造成了依赖性。\n    *   **真实误差 ($R$)**：该误差是为来自一个*新*患者的病灶 $(X^*, Y^*)$ 计算的。模型从未见过这个新患者的信号 $Z_{new}$。这是一个更难的任务。\n\n5.  **关于偏差的结论**：因为在病灶级别划分下的测试任务比真实的泛化任务更容易，所以估计的测试误差平均而言会低于真实的泛化误差 $R$。这是一种乐观的或**向下的偏差**。模型在测试集上的表现会看起来比它在真实的新患者上的表现要好。\n\n6.  **评估选项**\n    *   **A：当 $\\rho > 0$ 时，病灶共享患者级别的信号 $Z_{i}$；病灶级别的划分会将 $Z_{i}$ 泄露到训练集和测试集中。在 $Z_{i}$ 已在 $\\mathcal{D}_{\\mathrm{train}}$ 中被表征的条件下，来自同一患者的测试病灶更容易预测，因此估计的测试误差相对于针对新患者的误差 $R$ 存在向下偏差。**\n        *   这个选项完美地概括了我推导出的逻辑。它正确地指出了共享信号 $Z_i$、病灶级别划分导致的信息泄露、其后果（测试病灶更容易预测）以及最终结果（向下偏差）。这是**正确的**。\n    *   **B：当 $\\rho > 0$ 时，相关性仅增大了误差估计的方差；期望误差保持不变，因此病灶级别划分对于 $R$ 是无偏的。**\n        *   这是不正确的。相关性引入了系统性偏差，而不仅仅是增加了方差。测试样本并非从与目标泛化样本（新患者）相同的分布中抽取的。测试误差的期望不等于 $R$。这是**不正确的**。\n    *   **C：当 $\\rho > 0$ 时，模型对训练病灶过拟合，使得测试病灶更难预测；因此，病灶级别划分导致估计的误差相对于 $R$ 存在向上偏差。**\n        *   这个选项弄错了偏差的方向。虽然过拟合是一个普遍问题，但在信息泄露这个特定背景下，模型不只是对噪声过拟合；它正在学习一个真实的、共享的信号（$Z_i$）。这使得预测具有*相同*信号的其他样本变得*更容易*，而不是更难。误差是向下偏的，而不是向上偏。这是**不正确的**。\n    *   **D：偏差方向无法从 $\\rho$ 确定；相关性影响依赖关系，但不影响误差的条件分布，因此在病灶级别划分下，估计的误差可能存在向上或向下偏差，这与 $\\rho$ 无关。**\n        *   这是不正确的。偏差的方向是可以确定的。依赖结构（共享的 $Z_i$）系统性地使测试集比一个真正独立的新患者测试集“更容易”。信息泄露导致了过于乐观（向下偏）的性能估计。偏差方向不是任意的。这是**不正确的**。\n    *   **E：任何由 $\\rho > 0$ 引起的偏差在交叉验证下都会消失，因为随机折会平均掉相关性，从而使得病灶级别划分对于 $R$ 是无偏的。**\n        *   这是一个常见的误解。如果使用病灶级别划分进行交叉验证（即，通过划分病灶来创建折），那么在每一个折中都会出现相同的信息泄露问题。对所有折的结果求平均只是对向下偏的估计值求平均；它并不能消除偏差。要纠正偏差，必须使用分组/患者级别的交叉验证。这是**不正确的**。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在理解了正确划分数据单元的重要性之后，下一步是确保每次划分都是整个数据集的缩影，尤其是在处理类别不平衡的数据时。本练习通过一个清晰的定量示例，带您演练分层k折交叉验证的整个过程。通过计算，您将掌握创建均衡训练集和验证集的基本机制，这对于构建和评估稳健的模型至关重要 。",
            "id": "4568156",
            "problem": "一项二元放射组学研究旨在根据工程化的图像特征来预测病灶是否具有临床显著性。设数据集包含 $N = 1500$ 名患者，阳性类别占比为 $p = 0.10$（即 $10\\%$ 的患者为阳性，$90\\%$ 为阴性）。您将使用分层 $k$ 折交叉验证 (CV) 来评估一个分类器，其中 $k = 5$。在分层 $k$ 折交叉验证中，每一折都是一个不相交的子集，包含恰好 $N/k$ 名患者，并且在期望上保持了整个数据集的类别占比，没有患者会出现在多于一折中。\n\n根据基本原理，并且除了类别占比和分层抽样的核心定义外不使用任何快捷公式，请在这些约束下设计逐折划分，并计算每个验证折中阳性和阴性患者的期望数量。请以精确整数形式提供计数；无需四舍五入。您的最终答案必须是一个有序对，表示单个验证折中的计数，形式为 $\\big(\\text{阳性数}, \\text{阴性数}\\big)$。",
            "solution": "问题陈述已经过验证，被确定为内容自洽、科学上合理且定义明确。任务是确定在分层 $k$ 折交叉验证设置中，每个验证折的构成。我们将从基本原理出发进行推导。\n\n设 $N$ 为数据集中的患者总数，$p$ 为阳性类别的占比，$k$ 为交叉验证的折数。给定值为：\n- 患者总数：$N = 1500$\n- 阳性类别占比：$p = 0.10$\n- 折数：$k = 5$\n\n首先，我们确定整个数据集中阳性类别和阴性类别的患者总数。\n阳性患者的数量，记为 $N_{pos}$，是患者总数与类别占比的乘积：\n$$N_{pos} = N \\times p$$\n代入给定值：\n$$N_{pos} = 1500 \\times 0.10 = 150$$\n\n阴性患者的数量，记为 $N_{neg}$，是数据集中剩余的患者：\n$$N_{neg} = N - N_{pos} = N \\times (1 - p)$$\n代入给定值：\n$$N_{neg} = 1500 \\times (1 - 0.10) = 1500 \\times 0.90 = 1350$$\n作为验证，两个类别的患者总和为 $N_{pos} + N_{neg} = 150 + 1350 = 1500$，这等于患者总数 $N$。\n\n接下来，我们考虑 $k$ 折交叉验证的结构。数据集被划分为 $k$ 个大小相等的不相交的折。每一折的大小，$N_{fold}$，为：\n$$N_{fold} = \\frac{N}{k}$$\n代入给定值：\n$$N_{fold} = \\frac{1500}{5} = 300$$\n\n问题指定了*分层* $k$ 折交叉验证。分层的原则是确保每一折内的类别分布反映整个数据集的类别分布。这是通过将阳性患者集和阴性患者集分别划分为 $k$ 个大小相等的子集来实现的。然后，通过组合一个阳性患者子集和一个阴性患者子集来构建每个最终的验证折。\n\n因此，每折中阳性患者的期望数量，记为 $E[N_{pos, fold}]$，是阳性患者总数在 $k$ 折中均匀分布的结果：\n$$E[N_{pos, fold}] = \\frac{N_{pos}}{k}$$\n代入计算出的 $N_{pos}$ 值：\n$$E[N_{pos, fold}] = \\frac{150}{5} = 30$$\n\n同样，每折中阴性患者的期望数量，记为 $E[N_{neg, fold}]$，是阴性患者总数在 $k$ 折中均匀分布的结果：\n$$E[N_{neg, fold}] = \\frac{N_{neg}}{k}$$\n代入计算出的 $N_{neg}$ 值：\n$$E[N_{neg, fold}] = \\frac{1350}{5} = 270$$\n\n由于 $N_{pos}$ 和 $N_{neg}$ 都是 $k$ 的整数倍，分层可以完美执行而没有任何余数。在这种情况下，每折中每个类别的期望患者数是一个精确的整数，并且每一折都将精确地包含这个数量的阳性和阴性患者。\n\n我们可以验证每一折的构成。一折中的患者总数是其阳性和阴性组成部分的总和：\n$$N_{pos, fold} + N_{neg, fold} = 30 + 270 = 300$$\n这与计算出的折大小 $N_{fold}$ 相匹配。\n\n此外，每一折内的占比为：\n$$p_{fold} = \\frac{N_{pos, fold}}{N_{fold}} = \\frac{30}{300} = 0.10$$\n这证实了类别占比 $p$ 在每一折中都得到了保持，与分层抽样的定义一致。\n\n问题要求以有序对 $(\\text{阳性数}, \\text{阴性数})$ 的形式给出计数。因此，每个验证折的计数结果为 $(30, 270)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n30  270\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "真实的放射组学数据集通常同时需要基于患者的分组（以防止数据泄露）和基于结果的分层（以处理类别不平衡）。本练习将分组和分层这两个概念融合到一个统一且实用的工作流程中。通过为一个真实的多病灶研究设计验证方案，您将获得在放射组学中进行稳健模型评估的黄金标准方法的实践经验 。",
            "id": "4568097",
            "problem": "一项放射组学研究旨在探究从计算机断层扫描（CT）图像的癌症病灶中提取的纹理特征，是否能在患者层面预测一个表示为 $y \\in \\{0,1\\}$ 的二元临床结果。对于每位患者，从 $5$ 个病灶中提取特征，并且来自同一位患者的所有病灶必须保持在一起，以避免信息泄露。总共有 $200$ 名患者，其中 $80$ 名患者的结果为 $y=1$，$120$ 名患者的结果为 $y=0$。模型开发计划使用 $k$ 折交叉验证 (CV)，其中交叉验证 (CV) 是指将数据集划分为 $k$ 个不相交的子集（折）；在每次 CV 迭代中，一个子集作为验证集，剩下的 $k-1$ 个子集构成训练集。CV 必须按患者进行分组（以便任何单个患者的所有病灶级特征向量都被分配到同一折中）并按结果进行分层（以便在能够整除的情况下，每一折都包含相同数量的 $y=1$ 和 $y=0$ 患者）。\n\n仅从分组划分、按类别标签分层和 $k$ 折交叉验证的核心定义出发，设计一个分组分层的 $5$ 折 CV 方案，该方案在患者层面保持患者分组和结果平衡。然后，为每次 CV 迭代计算以下各项的确切大小：\n- 验证集中的患者数和病灶数，\n- 训练集中的患者数和病灶数，\n- 验证集和训练集中 $y=1$ 的患者数，\n- 验证集和训练集中 $y=0$ 的患者数。\n\n按以下顺序将您的最终数值答案报告为一个单行矩阵：\n$$\\text{(验证集患者数)} \\;\\\\; \\text{(训练集患者数)} \\;\\\\; \\text{(验证集 } y=1\\text{)} \\;\\\\; \\text{(验证集 } y=0\\text{)} \\;\\\\; \\text{(训练集 } y=1\\text{)} \\;\\\\; \\text{(训练集 } y=0\\text{)} \\;\\\\; \\text{(验证集病灶数)} \\;\\\\; \\text{(训练集病灶数)}。$$\n无需四舍五入。答案以不带单位的形式表示。",
            "solution": "该问题要求针对给定的数据集设计并量化一个分组分层的 $k$ 折交叉验证 (CV) 方案。我将首先验证问题陈述。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- 患者总数，$N_{total}$：$200$。\n- 结果为 $y=1$ 的患者数，$N_{y=1}$：$80$。\n- 结果为 $y=0$ 的患者数，$N_{y=0}$：$120$。\n- 每位患者的病灶数，$L$：$5$。\n- CV 的折数，$k$：$5$。\n- CV 约束：CV 必须按患者分组并按结果 $y$ 分层。\n- 分层目标：每一折应尽可能包含相同数量的 $y=1$ 和 $y=0$ 患者。\n- 分组约束：来自单个患者的所有病灶必须位于同一折中。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，采用了机器学习和医学数据分析（放射组学、分组 CV、分层 CV）中的标准方法。该问题提法得当，提供了确定唯一解所需的所有必要信息。提供的数据是一致的：$N_{y=1} + N_{y=0} = 80 + 120 = 200 = N_{total}$。由于 $N_{y=1}$ 和 $N_{y=0}$ 均能被 $k=5$ 整除，因此分层是完全可以实现的。该问题是客观的，没有歧义。它没有违反任何无效标准。\n\n**步骤 3：结论与行动**\n该问题有效。将提供完整的解决方案。\n\n### 求解过程\n\n分析基于一个包含 $N_{total} = 200$ 名患者的数据集。患者群体根据二元结果 $y \\in \\{0, 1\\}$ 分为两类。类别 $y=1$ 中有 $N_{y=1} = 80$ 名患者，类别 $y=0$ 中有 $N_{y=0} = 120$ 名患者。每位患者都有来自 $L=5$ 个不同病灶的数据。模型开发计划要求使用 $k=5$ 的 $k$ 折交叉验证。数据划分必须遵守两个原则：分组和分层。\n\n1.  **分组**：划分为折必须在患者层面进行。这意味着来自任何给定患者的所有 $5$ 个病灶都必须属于同一折，从而防止在同一次 CV 迭代中单个患者的信息同时出现在训练集和验证集中。这是避免数据泄露并获得模型性能无偏估计的关键步骤。\n\n2.  **分层**：划分必须按患者结果 $y$ 进行分层。这确保了每个类别（$y=1$ 和 $y=0$）的患者比例在所有折中保持一致，使每一折都成为整个数据集的一个有代表性的缩影。\n\n首先，我们确定 $k=5$ 的每一折的构成。由于划分是在患者层面进行的，我们计算每折的患者数量。\n每折的总患者数 $N_{fold}$ 为：\n$$N_{fold} = \\frac{N_{total}}{k} = \\frac{200}{5} = 40 \\text{ 名患者}$$\n\n为满足分层要求，我们将每个类别的患者均匀分配到 $5$ 个折中。\n每折中结果为 $y=1$ 的患者数 $N_{fold, y=1}$ 为：\n$$N_{fold, y=1} = \\frac{N_{y=1}}{k} = \\frac{80}{5} = 16 \\text{ 名患者}$$\n\n每折中结果为 $y=0$ 的患者数 $N_{fold, y=0}$ 为：\n$$N_{fold, y=0} = \\frac{N_{y=0}}{k} = \\frac{120}{5} = 24 \\text{ 名患者}$$\n\n作为检验，每折的总患者数为 $N_{fold, y=1} + N_{fold, y=0} = 16 + 24 = 40$，这与我们对 $N_{fold}$ 的计算结果一致。由于所有除法运算都得到整数，因此分层是完美的。$5$ 个折中的每一折都将精确包含 $16$ 名 $y=1$ 的患者和 $24$ 名 $y=0$ 的患者。\n\n接下来，我们分析 $5$ 折交叉验证过程中的单次迭代。在任何给定的迭代中，5 个折中的一个作为**验证集**，其余的 $k-1 = 4$ 个折组合起来形成**训练集**。由于所有折在大小和构成上都是相同的，因此计算出的大小对于每次 CV 迭代都将是相同的。\n\n**验证集大小：**\n验证集由单个折组成。\n- 验证集中的患者数：$N_{val\\_patients} = N_{fold} = 40$。\n- 验证集中 $y=1$ 的患者数：$N_{val, y=1} = N_{fold, y=1} = 16$。\n- 验证集中 $y=0$ 的患者数：$N_{val, y=0} = N_{fold, y=0} = 24$。\n- 验证集中的总病灶数：$N_{val\\_lesions} = N_{val\\_patients} \\times L = 40 \\times 5 = 200$。\n\n**训练集大小：**\n训练集由 $k-1 = 4$ 个组合的折组成。\n- 训练集中的患者数：$N_{train\\_patients} = (k-1) \\times N_{fold} = 4 \\times 40 = 160$。这也可以计算为 $N_{total} - N_{val\\_patients} = 200 - 40 = 160$。\n- 训练集中 $y=1$ 的患者数：$N_{train, y=1} = (k-1) \\times N_{fold, y=1} = 4 \\times 16 = 64$。这也等于 $N_{y=1} - N_{val, y=1} = 80 - 16 = 64$。\n- 训练集中 $y=0$ 的患者数：$N_{train, y=0} = (k-1) \\times N_{fold, y=0} = 4 \\times 24 = 96$。这也等于 $N_{y=0} - N_{val, y=0} = 120 - 24 = 96$。\n- 训练集中的总病灶数：$N_{train\\_lesions} = N_{train\\_patients} \\times L = 160 \\times 5 = 800$。\n\n问题要求提供这 $8$ 个值。最终答案指定的顺序是：（验证集患者数）、（训练集患者数）、（验证集 $y=1$ 数）、（验证集 $y=0$ 数）、（训练集 $y=1$ 数）、（训练集 $y=0$ 数）、（验证集病灶数）、（训练集病灶数）。\n\n计算出的值为：\n- 验证集患者数：$40$\n- 训练集患者数：$160$\n- 验证集 $y=1$ 数：$16$\n- 验证集 $y=0$ 数：$24$\n- 训练集 $y=1$ 数：$64$\n- 训练集 $y=0$ 数：$96$\n- 验证集病灶数：$200$\n- 训练集病灶数：$800$\n\n这些值将在最终答案中以单行矩阵的形式呈现。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n40  160  16  24  64  96  200  800\n\\end{pmatrix}\n}\n$$"
        }
    ]
}