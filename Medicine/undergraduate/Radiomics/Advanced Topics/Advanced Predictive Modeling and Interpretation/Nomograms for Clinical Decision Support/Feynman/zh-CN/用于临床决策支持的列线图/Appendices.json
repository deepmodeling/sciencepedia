{
    "hands_on_practices": [
        {
            "introduction": "在构建任何预测模型之前，稳健的研究设计至关重要。本练习探讨研究规划的一个基本方面：确定所需的样本量。通过应用“每变量事件数”（Events-Per-Variable, EPV）规则，您将学习如何确保您的研究有足够的能力来创建一个可靠且稳定的列线图，从而避免模型过拟合的陷阱。",
            "id": "4553768",
            "problem": "您正在计划构建一个基于影像组学的逻辑回归诺莫图，以支持针对二元结局（例如，治疗有效与无效）的临床决策，其预期发生率为 $\\pi = 0.3$。该诺莫图将由 $k = 15$ 个候选影像组学特征构建，并且您将在初始模型中拟合所有 $k$ 个参数，以代表最坏情况下的要求。目标是确保模型开发有足够的样本量，以使估计的回归系数能够产生稳定的校准度和较低的过拟合。\n\n请仅使用基本定义和广泛接受的指南来推导样本量约束条件。从以下基础出发：\n\n- 在针对二元结局的逻辑回归中，大小为 $N$ 的样本中结局事件的期望数量为 $E = \\pi N$。\n- 每变量事件数（EPV）启发式方法要求每个参数至少有 $10$ 个事件（首次使用时定义每变量事件数 (EPV)）。\n- 近期基于模拟的预测建模指南，为了使校准斜率接近 $1$ 并限制过拟合，建议在中等信噪比条件下每个参数至少有 $20$ 个事件。\n\n基于这些基础，推导出一个连接总样本量 $N$、参数数量 $k$、发生率 $\\pi$ 和 EPV 目标值 $c$ 的代数关系。使用该关系式计算当 $\\pi = 0.3$ 和 $k = 15$ 时，同时满足两个约束条件（$c = 10$ 和 $c = 20$）的最小 $N$ 值。提供满足两个要求的最小整数 $N$ 作为最终答案。无需舍入说明，$N$ 也没有物理单位。",
            "solution": "用户提供了一个问题陈述，在尝试解决之前需要对其进行验证。\n\n### 第 1 步：提取已知条件\n-   模型类型：用于临床决策支持的逻辑回归诺莫图。\n-   结局：二元（例如，治疗有效与无效）。\n-   预期发生率：$\\pi = 0.3$。\n-   候选参数数量：$k = 15$。\n-   要求基础 1：大小为 $N$ 的样本中结局事件的期望数量为 $E = \\pi N$。\n-   要求基础 2：每变量事件数（EPV）启发式方法，定义为事件数与参数数量之比，要求每个参数至少有 $c=10$ 个事件。\n-   要求基础 3：近期基于模拟的指南建议每个参数至少有 $c=20$ 个事件，以确保良好的模型校准度并限制过拟合。\n-   目标：为样本量 $N$ 推导一个代数关系，并计算在给定的 $k$ 和 $\\pi$ 下，同时满足两个 EPV 约束条件（$c=10$ 和 $c=20$）的最小整数 $N$。\n\n### 第 2 步：使用提取的已知条件进行验证\n问题陈述根据验证标准进行评估。\n\n-   **科学性**：该问题设定在生物统计学和预测建模的标准框架内。逻辑回归、样本量计算、每变量事件数（EPV）启发式方法，以及对模型校准度和过拟合的关注，都是该领域基本且成熟的概念。指定的发生率（$\\pi=0.3$）和参数数量（$k=15$）对于影像组学研究是切合实际的。\n-   **适定性**：该问题清晰、内部一致且自洽。它提供了所有必要的数据和定义，以推导关系并计算出具体的数值答案。目标是找到满足一组明确定义的约束条件的最小整数样本量，这会导出一个唯一的解。\n-   **客观性**：语言精确、技术性强，没有任何主观或模糊的术语。\n\n该问题没有表现出任何诸如科学性不健全、不完整、矛盾或不可行之类的缺陷。它是临床研究统计规划中的一个标准的、可形式化的问题。\n\n### 第 3 步：结论与行动\n该问题被判定为**有效**。将提供解答。\n\n### 解答推导\n该问题要求首先根据每变量事件数（EPV）标准推导出最小样本量 $N$ 的一般关系式，然后应用此关系式求出给定参数所需的 $N$。\n\n首先，我们根据问题描述将 EPV 概念形式化。每变量事件数（EPV）是事件数（在二元分类设置中频率较低的结局）与模型中包含的参数（或变量）数量之比。设 $E$ 为事件数，$k$ 为参数数量，$c$ 为每个参数的目标最小事件数。该约束表示为：\n$$ \\frac{E}{k} \\ge c $$\n\n问题指出，对于总样本量 $N$ 和结局发生率 $\\pi$，期望事件数为 $E = \\pi N$。为使此关系成立，$\\pi$ 必须代表目标事件的发生率，通常选择频率较低的结局以确保保守的样本量估计。给定 $\\pi = 0.3$，另一结局的发生率为 $1-\\pi = 0.7$。由于 $0.3  0.7$，因此 $\\pi=0.3$ 正确地代表了限制性（频率较低）事件类别的发生率。\n\n我们将 $E$ 的表达式代入 EPV 不等式：\n$$ \\frac{\\pi N}{k} \\ge c $$\n这就是连接总样本量 $N$、发生率 $\\pi$、参数数量 $k$ 和 EPV 目标值 $c$ 的代数关系。\n\n为了求得所需的最小样本量 $N$，我们对该不等式求解 $N$：\n$$ \\pi N \\ge c k $$\n$$ N \\ge \\frac{c k}{\\pi} $$\n该不等式提供了满足特定 EPV 目标值 $c$ 所需样本量的下限。\n\n问题规定了必须同时满足的两个约束条件：\n1.  传统的启发式方法：$c_1 = 10$。\n2.  更严格的现代指南：$c_2 = 20$。\n\n我们使用给定的值 $k=15$ 和 $\\pi=0.3$ 计算每个约束条件所需的最小样本量。\n\n对于第一个约束条件 ($c_1 = 10$)：\n设 $N_1$ 为此情况下的最小样本量。\n$$ N_1 \\ge \\frac{c_1 k}{\\pi} $$\n$$ N_1 \\ge \\frac{10 \\times 15}{0.3} = \\frac{150}{0.3} $$\n$$ N_1 \\ge 500 $$\n因此，需要最小样本量为 $500$ 才能满足 EPV $\\ge 10$ 的规则。\n\n对于第二个更严格的约束条件 ($c_2 = 20$)：\n设 $N_2$ 为此情况下的最小样本量。\n$$ N_2 \\ge \\frac{c_2 k}{\\pi} $$\n$$ N_2 \\ge \\frac{20 \\times 15}{0.3} = \\frac{300}{0.3} $$\n$$ N_2 \\ge 1000 $$\n因此，需要最小样本量为 $1000$ 才能满足 EPV $\\ge 20$ 的规则，该规则旨在提供更好的模型稳定性和校准度。\n\n问题要求的是**同时满足两个约束条件**的最小样本量 $N$。这意味着 $N$ 必须同时满足 $N \\ge 500$ 和 $N \\ge 1000$。为满足这两个不等式，$N$ 必须大于或等于两个所需最小值的最大值：\n$$ N \\ge \\max(N_1, N_2) $$\n$$ N \\ge \\max(500, 1000) $$\n$$ N \\ge 1000 $$\n满足此条件的最小整数 $N$ 值为 $1000$。因此，为了在满足传统启发式方法的同时，也遵循现代预测模型开发的指南，所需的最小样本量为 $1000$。",
            "answer": "$$\n\\boxed{1000}\n$$"
        },
        {
            "introduction": "列线图是统计模型的可视化表示，但其内部工作原理是怎样的？本练习通过将特定特征值转换为列线图量表上的点数来揭开这一过程的神秘面纱。您将看到这些点数如何改变预测概率，从而在原始数据、回归模型和最终临床风险评估之间建立清晰的定量联系。",
            "id": "4553775",
            "problem": "一个基于影像组学的临床决策支持工具使用了一个由列线图汇总的逻辑回归风险模型。预测变量被标准化为零均值和单位方差。在此框架中，线性预测子（对数优势比）在预测变量的贡献上是可加的，并且列线图将预测变量的贡献映射到线性刻度上的点。假设以下条件成立：单个标准化影像组学特征 $x_{1}$ 的值为 $x_{1}=1.5$，回归系数为 $\\beta_{1}=0.6$，并且列线图经过校准，使得一个点对应于线性预测子中 $\\Delta \\eta=0.05$ 的增量。同时，假设所关注的临床事件的基线优势比为 $1:1$。\n\n仅使用优势比、对数优势比和逻辑斯蒂连接函数作为基本定义，确定：\n- 在给定的点数刻度下，由特征值 $x_{1}=1.5$ 贡献的点数，以及\n- 当加入此特征贡献时，相较于基线的预测概率的隐含变化。\n\n将最终结果表示为一个行向量中的两个量：首先是总点数，然后是预测概率的变化。对于预测概率的变化，提供一个以 $\\exp(\\cdot)$ 表示的精确解析表达式；不要四舍五入或近似计算。不需要单位，也不应使用百分号。",
            "solution": "该问题是有效的，因为它具有科学依据、提法明确且客观。它提供了一套自洽且一致的已知条件，这些条件根植于标准统计方法（逻辑回归）及其在临床决策支持（列线图）中的应用。所有提供的值在物理上和统计上都是合理的，并且所提出的问题有唯一的、可验证的答案。\n\n按要求，解答过程遵循第一性原理。问题的核心是将逻辑回归模型中一个特征的值与其对线性预测子（对数优势比）的影响联系起来，并进而关联到预测概率的变化。\n\n设 $P$ 为所关注的临床事件的概率。事件的优势比定义为 $O = \\frac{P}{1-P}$。\n逻辑回归模型使用优势比的自然对数，即对数优势比或线性预测子 $\\eta$，作为响应变量：\n$$ \\eta = \\ln(O) = \\ln\\left(\\frac{P}{1-P}\\right) $$\n线性预测子 $\\eta$ 被建模为预测变量 $x_i$ 与其系数 $\\beta_i$ 的线性组合，再加上一个截距 $\\beta_0$：\n$$ \\eta = \\beta_0 + \\sum_{i} \\beta_i x_i $$\n单个预测变量 $x_1$ 对线性预测子的贡献是 $\\Delta\\eta_1 = \\beta_1 x_1$ 这一项。\n\n问题提供了以下值：\n- 标准化特征值：$x_1 = 1.5$\n- 回归系数：$\\beta_1 = 0.6$\n\n该特征对线性预测子的贡献计算如下：\n$$ \\Delta\\eta_1 = \\beta_1 x_1 = (0.6)(1.5) = 0.9 $$\n\n要找的第一个量是这个贡献在列线图上代表的点数。问题指出，列线图经过校准，使得一个点对应于线性预测子中 $\\Delta\\eta = 0.05$ 的增量。因此，对于贡献 $\\Delta\\eta_1$，总点数 $N_p$ 为：\n$$ N_p = \\frac{\\Delta\\eta_1}{0.05} = \\frac{0.9}{0.05} = \\frac{90}{5} = 18 $$\n因此，特征值 $x_1=1.5$ 对列线图得分贡献了 $18$ 分。\n\n要找的第二个量是相较于基线的预测概率的隐含变化。为此，我们必须首先确定基线概率，然后在包含特征贡献后确定新的概率。\n通过重新整理对数优势比方程，概率 $P$ 可以表示为线性预测子 $\\eta$ 的函数。这就得到了逻辑斯蒂函数：\n$$ P(\\eta) = \\frac{\\exp(\\eta)}{1+\\exp(\\eta)} $$\n问题指定了基线优势比为 $1:1$，这意味着 $O_{base} = 1$。相应的基线线性预测子 $\\eta_{base}$ 是：\n$$ \\eta_{base} = \\ln(O_{base}) = \\ln(1) = 0 $$\n因此，基线概率 $P_{base}$ 为：\n$$ P_{base} = P(\\eta_{base}) = P(0) = \\frac{\\exp(0)}{1+\\exp(0)} = \\frac{1}{1+1} = \\frac{1}{2} $$\n新的线性预测子 $\\eta_{new}$ 是基线预测子与特征 $x_1$ 贡献的总和：\n$$ \\eta_{new} = \\eta_{base} + \\Delta\\eta_1 = 0 + 0.9 = 0.9 $$\n与此更新后的线性预测子相对应的新概率 $P_{new}$ 为：\n$$ P_{new} = P(\\eta_{new}) = P(0.9) = \\frac{\\exp(0.9)}{1+\\exp(0.9)} $$\n预测概率的变化 $\\Delta P$ 是新概率与基线概率之差：\n$$ \\Delta P = P_{new} - P_{base} = \\frac{\\exp(0.9)}{1+\\exp(0.9)} - \\frac{1}{2} $$\n为了得到一个单一的分数表达式，我们找到一个共同的分母：\n$$ \\Delta P = \\frac{2\\exp(0.9)}{2(1+\\exp(0.9))} - \\frac{1+\\exp(0.9)}{2(1+\\exp(0.9))} = \\frac{2\\exp(0.9) - (1+\\exp(0.9))}{2(1+\\exp(0.9))} $$\n简化分子可得到概率变化的最终精确解析表达式：\n$$ \\Delta P = \\frac{\\exp(0.9) - 1}{2(1+\\exp(0.9))} $$\n所需的两个量是点数 $18$ 和概率变化 $\\frac{\\exp(0.9) - 1}{2(1+\\exp(0.9))}$。这些量需要以单个行向量的形式呈现。",
            "answer": "$$ \\boxed{\\begin{pmatrix} 18  \\frac{\\exp(0.9) - 1}{2(1 + \\exp(0.9))} \\end{pmatrix}} $$"
        },
        {
            "introduction": "一个强大的预测模型在应用于新的患者群体时，可能会因校准漂移而失去其准确性。本练习通过介绍模型重新校准来应对这一现实挑战，这是任何临床决策支持工具生命周期中的关键一步。您将推导并应用相应方法来调整列线图的预测，以确保其在不同临床环境中的持续有效性和实用性。",
            "id": "4553785",
            "problem": "一个用于二元结局预测的基于影像组学的临床列线图，最初是使用逻辑斯蒂回归模型推导出来的。根据列线图总分标尺的构造，该模型的线性预测器是总分 $T$ 的一个仿射函数，因此对于总分为 $T$ 的患者，其原始预测概率为\n$$\np_{\\text{orig}}(T) \\;=\\; \\operatorname{logit}^{-1}\\!\\big(a + b\\,T\\big) \\;=\\; \\frac{1}{1 + \\exp\\!\\big(-\\big(a + b\\,T\\big)\\big)} ,\n$$\n其中，$a$ 是模型在线性预测器尺度上的截距，$b$ 是在同一尺度上每分的斜率。\n\n一个外部验证队列显示出校准漂移。在进行标准的整体校准和斜率评估后，您拟合了以下校准模型\n$$\n\\operatorname{logit}\\!\\big(p_{\\text{true}}\\big) \\;=\\; \\alpha \\;+\\; \\gamma \\,\\operatorname{logit}\\!\\big(p_{\\text{orig}}(T)\\big),\n$$\n该模型为外部环境得出了估计值 $\\alpha$ 和 $\\gamma$。这为列线图的再校准提供了两种选项：\n- 仅截距再校准（调整截距 $\\,\\beta_{0}\\,$）：设置 $\\gamma = 1$ 并通过 $\\alpha$ 调整截距。\n- 截距和斜率再校准（同时调整 $\\,\\beta_{0}\\,$ 和全局斜率）：使用估计的 $\\alpha$ 和 $\\gamma$。\n\n从逻辑斯蒂连接函数 $\\operatorname{logit}(p) = \\ln\\!\\big(\\frac{p}{1-p}\\big)$ 及其反函数 $\\operatorname{logit}^{-1}(x) = \\frac{1}{1+\\exp(-x)}$ 的定义，以及列线图分数与原始线性预测器之间的线性映射出发，推导仅截距再校准和截距与斜率再校准两种情况下的再校准概率函数 $p_{\\text{recal}}(T)$，用 $a$、$b$、$\\alpha$、$\\gamma$ 和 $T$ 表示。然后，使用截距和斜率再校准方法，计算当 $a = -3.0$、$b = 0.02$、$\\alpha = -0.3$ 和 $\\gamma = 0.9$ 时，总分为 $T = 120$ 的患者的再校准预测概率。将最终数值答案四舍五入至四位有效数字，并以小数形式表示（不带百分号）。",
            "solution": "该问题要求基于一个逻辑斯蒂回归模型和随后的一个校准模型，推导再校准概率函数，然后对一个特定案例进行数值计算。\n\n首先，我们验证问题陈述。所有给定条件均已提取和分析。该问题在科学上基于临床预测模型的标准统计方法（逻辑斯蒂回归、列线图校准），是良定的，提供了所有必要信息且无矛盾，并以客观、正式的语言表述。因此，该问题被认为是有效的。\n\n我们开始推导。原始预测概率 $p_{\\text{orig}}(T)$ 是通过其线性预测器 $\\eta_{\\text{orig}} = a + bT$ 定义的，如下所示：\n$$\np_{\\text{orig}}(T) = \\operatorname{logit}^{-1}(\\eta_{\\text{orig}}) = \\operatorname{logit}^{-1}(a + bT)\n$$\n通过对该定义的两边应用 logit 函数（即 $\\operatorname{logit}^{-1}$ 函数的反函数），我们得到了原始概率的 logit 的直接表达式：\n$$\n\\operatorname{logit}\\big(p_{\\text{orig}}(T)\\big) = \\operatorname{logit}\\big(\\operatorname{logit}^{-1}(a + bT)\\big) = a + bT\n$$\n这个关系是将原始模型与校准模型联系起来的关键。\n\n校准模型将新人群中的“真实”概率（我们将其表示为再校准概率 $p_{\\text{recal}}(T)$）与原始预测概率 $p_{\\text{orig}}(T)$ 相关联：\n$$\n\\operatorname{logit}\\big(p_{\\text{recal}}(T)\\big) = \\alpha + \\gamma \\operatorname{logit}\\big(p_{\\text{orig}}(T)\\big)\n$$\n在这里，$\\alpha$ 是校准截距（与整体校准相关），$\\gamma$ 是校准斜率。该方程的左侧是再校准的线性预测器 $\\eta_{\\text{recal}}$。\n\n将 $\\operatorname{logit}\\big(p_{\\text{orig}}(T)\\big)$ 的表达式代入校准模型，我们得到用原始模型参数和校准参数表示的再校准线性预测器：\n$$\n\\eta_{\\text{recal}} = \\operatorname{logit}\\big(p_{\\text{recal}}(T)\\big) = \\alpha + \\gamma (a + bT)\n$$\n我们可以将其重新整理成一个新的线性预测器的形式：\n$$\n\\operatorname{logit}\\big(p_{\\text{recal}}(T)\\big) = (\\alpha + \\gamma a) + (\\gamma b)T\n$$\n为了求得再校准概率 $p_{\\text{recal}}(T)$，我们对这个再校准的线性预测器应用反 logit 函数：\n$$\np_{\\text{recal}}(T) = \\operatorname{logit}^{-1}\\big((\\alpha + \\gamma a) + (\\gamma b)T\\big)\n$$\n使用定义 $\\operatorname{logit}^{-1}(x) = \\frac{1}{1 + \\exp(-x)}$，上式变为：\n$$\np_{\\text{recal}}(T) = \\frac{1}{1 + \\exp\\big(-((\\alpha + \\gamma a) + (\\gamma b)T)\\big)}\n$$\n这就是 **截距和斜率再校准** 的通用公式。\n\n对于 **仅截距再校准** 的特殊情况，我们设置校准斜率 $\\gamma = 1$。将 $\\gamma=1$ 代入通用公式可得：\n$$\np_{\\text{recal}}(T) = \\frac{1}{1 + \\exp\\big(-((\\alpha + 1 \\cdot a) + (1 \\cdot b)T)\\big)} = \\frac{1}{1 + \\exp\\big(-((\\alpha+a) + bT)\\big)}\n$$\n这对应于用校准截距 $\\alpha$ 调整原始模型的截距 $a$，同时保持斜率 $b$ 不变。\n\n接下来，我们按照要求，使用截距和斜率再校准公式进行数值计算。给定值为：\n-   总分 $T = 120$\n-   原始截距 $a = -3.0$\n-   原始每分斜率 $b = 0.02$\n-   校准截距 $\\alpha = -0.3$\n-   校准斜率 $\\gamma = 0.9$\n\n我们首先计算再校准的线性预测器 $\\eta_{\\text{recal}}$：\n$$\n\\eta_{\\text{recal}} = (\\alpha + \\gamma a) + (\\gamma b)T\n$$\n代入数值：\n$$\n\\eta_{\\text{recal}} = (-0.3 + (0.9)(-3.0)) + ((0.9)(0.02))(120)\n$$\n$$\n\\eta_{\\text{recal}} = (-0.3 - 2.7) + (0.018)(120)\n$$\n$$\n\\eta_{\\text{recal}} = -3.0 + 2.16\n$$\n$$\n\\eta_{\\text{recal}} = -0.84\n$$\n现在，我们通过应用反 logit 函数来计算再校准概率 $p_{\\text{recal}}(T=120)$：\n$$\np_{\\text{recal}}(120) = \\frac{1}{1 + \\exp(-\\eta_{\\text{recal}})} = \\frac{1}{1 + \\exp(-(-0.84))} = \\frac{1}{1 + \\exp(0.84)}\n$$\n计算该值：\n$$\n\\exp(0.84) \\approx 2.3163668\n$$\n$$\np_{\\text{recal}}(120) \\approx \\frac{1}{1 + 2.3163668} = \\frac{1}{3.3163668} \\approx 0.301535\n$$\n问题要求将最终答案四舍五入到四位有效数字。前四位有效数字是 $3$、$0$、$1$ 和 $5$。后一位数字是 $3$，所以我们向下舍入。\n$$\np_{\\text{recal}}(120) \\approx 0.3015\n$$",
            "answer": "$$\\boxed{0.3015}$$"
        }
    ]
}