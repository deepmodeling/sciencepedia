{
    "hands_on_practices": [
        {
            "introduction": "在整合行为健康模式中，系统性筛查是识别潜在患者的第一步。然而，筛查工具并非完美，其结果需要谨慎解读。本练习将通过一个基于患者健康问卷-9 ($PHQ-9$) 的假设场景，帮助你掌握如何计算阳性预测值 ($PPV$) 和阴性预测值 ($NPV$)，并理解这些指标对于临床资源分配和患者管理的重要意义 。",
            "id": "4721951",
            "problem": "一家实施整合行为健康（IBH）的初级保健诊所使用患者健康问卷-9（PHQ-9）来筛查重度抑郁症，以得分 $\\ge 10$ 作为定义筛查阳性的临界值。在其成年人群中，当前重度抑郁症的患病率为 $0.12$。PHQ-9 在此临界值下于初级保健中的经验证实特性显示，其敏感性为 $0.88$，特异性为 $0.85$。\n\n从敏感性、特异性的核心定义，以及结合贝叶斯定理用于条件概率的全概率定律出发，计算该人群中 PHQ-9 的阳性预测值（PPV）和阴性预测值（NPV）。然后，基于这些值以及假阳性和假阴性的定义，简要解释在初级保健的整合行为健康工作流程中，假阳性和假阴性筛查的临床后果。\n\n将PPV和NPV均表示为小数，并将您的数值答案四舍五入到四位有效数字。",
            "solution": "此问题是有效的，因为它在流行病学原理上有科学依据，所给数据完备，且表述客观。我们可以继续进行解答。\n\n设 $D$ 为患者患有当前重度抑郁症的事件， $D^c$ 为患者未患此病的事件。设 $T^+$ 为 PHQ-9 筛查结果为阳性（得分 $\\ge 10$）的事件， $T^-$ 为筛查结果为阴性（得分 $ 10$）的事件。\n\n问题陈述中给出的已知条件是：\n该病的患病率：$P(D) = 0.12$。\n该检测的敏感性：$P(T^+|D) = 0.88$。\n该检测的特异性：$P(T^-|D^c) = 0.85$。\n\n由此，我们可以推导出以下概率：\n不患此病的概率：$P(D^c) = 1 - P(D) = 1 - 0.12 = 0.88$。\n患病情况下检测为阴性的概率（假阴性率）：$P(T^-|D) = 1 - P(T^+|D) = 1 - 0.88 = 0.12$。\n未患病情况下检测为阳性的概率（假阳性率）：$P(T^+|D^c) = 1 - P(T^-|D^c) = 1 - 0.85 = 0.15$。\n\n目标是计算阳性预测值（PPV），定义为 $P(D|T^+)$，和阴性预测值（NPV），定义为 $P(D^c|T^-)$。我们将使用贝叶斯定理。\n\nPPV 的公式为：\n$$PPV = P(D|T^+) = \\frac{P(T^+|D)P(D)}{P(T^+)}$$\n为了求得分母 $P(T^+)$，我们使用全概率定律：\n$$P(T^+) = P(T^+|D)P(D) + P(T^+|D^c)P(D^c)$$\n代入已知值：\n$$P(T^+) = (0.88)(0.12) + (0.15)(0.88)$$\n$$P(T^+) = 0.1056 + 0.1320 = 0.2376$$\n现在我们可以计算 PPV：\n$$PPV = \\frac{0.1056}{0.2376} \\approx 0.444444...$$\n四舍五入到四位有效数字， $PPV = 0.4444$。\n\nNPV 的公式为：\n$$NPV = P(D^c|T^-) = \\frac{P(T^-|D^c)P(D^c)}{P(T^-)}$$\n为了求得分母 $P(T^-)$，我们可以再次使用全概率定律：\n$$P(T^-) = P(T^-|D)P(D) + P(T^-|D^c)P(D^c)$$\n或者，由于检测结果要么是阳性要么是阴性，$P(T^-) = 1 - P(T^+)$。\n$$P(T^-) = 1 - 0.2376 = 0.7624$$\n让我们用全概率定律来验证这个结果：\n$$P(T^-) = (0.12)(0.12) + (0.85)(0.88) = 0.0144 + 0.7480 = 0.7624$$\n结果一致。现在我们可以计算 NPV：\n$$NPV = \\frac{(0.85)(0.88)}{0.7624} = \\frac{0.7480}{0.7624} \\approx 0.981112...$$\n四舍五入到四位有效数字， $NPV = 0.9811$。\n\n临床后果的解释：\n\n给定阳性检测结果的疾病后验概率，即 PPV，为 $0.4444$。这意味着对于筛查结果为阳性的患者，他们实际患有重度抑郁症的几率只有 $44.44\\%$。因此，$1 - PPV = 1 - 0.4444 = 0.5556$，即 $55.56\\%$ 的阳性筛查是假阳性。\n假阳性的临床后果：筛查结果为假阳性的患者将被转介给行为健康临床医生进行更彻底的诊断评估。这会消耗宝贵的临床资源（时间、人员）在那些并未患有目标疾病的个体身上。它也可能给患者带来不必要的焦虑或耻辱感。然而，在整合医疗模式中，这类抑郁症的“假阳性”可能仍然能识别出那些有其他亚临床心理健康问题或社会心理压力源的个体，他们可能从短暂干预中受益，从而在一定程度上减轻了假阳性的“成本”。\n\n给定阴性检测结果的无病后验概率，即 NPV，为 $0.9811$。这表明如果患者筛查结果为阴性，他们确实没有患重度抑郁症的概率为 $98.11\\%$。在筛查结果为阴性的人群中，假阴性率为 $1 - NPV = 1 - 0.9811 = 0.0189$，即 $1.89\\%$。人群中假阴性的总比例是 $P(T^-|D)P(D)=(0.12)(0.12)=0.0144$。\n假阴性的临床后果：筛查结果为假阴性的患者，实际上患有重度抑郁症，却被筛查过程漏掉。这对该个体来说是一次重大的失误，因为他们将不会被提供进一步的评估或治疗，可能导致病情恶化、长期痛苦、功能受损以及不良后果的风险增加。高 NPV 提供了信心，即阴性筛查在为大多数筛查为阴性的人群排除该疾病方面非常有效，但那一小部分被漏掉的病例代表了对这些个体的护理出现了严重疏漏。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.4444  0.9811 \\end{pmatrix}}$$"
        },
        {
            "introduction": "治疗的成功不仅在于统计数据的变化，更在于患者是否感受到有意义的改善。本练习引入了“最小临床重要差异” ($MCID$) 的概念，这是一个将患者主观感受与客观评分相结合的关键指标。通过一个综合了“锚定法”和“分布法”的案例，你将学会如何量化何种程度的症状变化对患者而言是真正有价值的 。",
            "id": "4721915",
            "problem": "在一个嵌入初级保健诊所的综合行为健康项目中，患有抑郁症状的成年人由行为健康临床医生和初级保健提供者共同管理。在基线时以及 $8$ 周后随访时，会使用患者健康问卷-9 (PHQ-9) 来评估抑郁症状的变化。最小临床重要差异 (MCID) 的概念被定义为：在量表上测量的、患者认为有益且需要改变患者管理方案的最小结局变化。估算 MCID 通常使用两大类方法：使用患者总体评分作为感知变化外部标准的锚定法，以及使用量表分数分布统计特征的分布法。\n\n一个包含 $N = 180$ 名患者的队列提供了基线和随访的 PHQ-9 分数。基线 PHQ-9 分数的平均值为 $14.8$，标准差为 $5.2$。变化分数定义为随访分数减去基线分数，因此负值表示改善。在随访时，每位患者还完成了一项单项总体变化评级 (GRC)，其选项分为“好很多”、“好一点”、“差不多”、“差一点”或“差很多”。每个 GRC 类别中的患者人数及其 PHQ-9 平均变化分数为：\n- “好很多”：$n = 40$，平均变化 $= -7.9$，\n- “好一点”：$n = 55$，平均变化 $= -3.1$，\n- “差不多”：$n = 50$，平均变化 $= -0.6$，\n- “差一点”：$n = 20$，平均变化 $= +1.8$，\n- “差很多”：$n = 15$，平均变化 $= +5.0$。\n\n假设为了进行锚定法估算，基于锚定的 MCID 操作化定义为报告“好一点”的患者 PHQ-9 平均变化分数的绝对值。对于分布法估算，使用基线标准差的一半。为了将这两种估算值调和成一个单一的 MCID 用于在此综合初级保健环境中进行临床决策，该诊所预先指定了一条证据加权合成规则，其中锚定法估算值获得的权重为 $w = |r|^{2}$，这里 $|r|$ 是 PHQ-9 变化分数与 GRC（编码为一个序数等级，其中数值越高表示感知到的改善越大）之间的皮尔逊相关系数的绝对值。对于该队列，该相关系数的绝对值为 $|r| = 0.55$。\n\n仅使用这些定义和数据，计算调和后的 MCID，作为一个在 PHQ-9 量表上的单一值。用 PHQ-9 分数表示您最终的 MCID，并将您的答案四舍五入到三位有效数字。",
            "solution": "该问题要求根据两种不同的估算值（锚定法估算值和分布法估算值）计算调和后的最小临床重要差异 (MCID)。这一过程包括单独计算每个估算值，然后使用指定的证据加权合成规则将它们组合起来。所有计算都将严格依据所提供的数据和定义进行。\n\n首先，我将计算基于锚定的 MCID，记为 $MCID_{anchor}$。问题将其定义为“报告‘好一点’的患者 PHQ-9 平均变化分数的绝对值”。为报告“好一点”的患者组 ($n=55$) 提供的数据显示，其 PHQ-9 平均变化分数为 $-3.1$。\n因此，基于锚定的 MCID 是该变化分数的绝对值：\n$$MCID_{anchor} = |-3.1| = 3.1$$\n\n其次，我将计算基于分布的 MCID，记为 $MCID_{dist}$。问题将其定义为“基线标准差的一半”。PHQ-9 分数的基线标准差给定为 $5.2$。\n因此，基于分布的 MCID 计算如下：\n$$MCID_{dist} = \\frac{1}{2} \\times 5.2 = 2.6$$\n\n第三，我将确定证据加权合成的权重。问题指定了一条合成规则，其中锚定法估算值获得的权重 $w$ 计算为 $w = |r|^{2}$。此处， $|r|$ 是 PHQ-9 变化分数与总体变化评级 (GRC) 之间的皮尔逊相关系数的绝对值，给定为 $|r| = 0.55$。该合成为加权平均，因此总权重必须为 $1$。因此，分布法估算值获得的权重为 $1-w$。\n锚定法估算值的权重为：\n$$w = (0.55)^{2} = 0.3025$$\n因此，分布法估算值的权重为：\n$$1 - w = 1 - 0.3025 = 0.6975$$\n\n第四，我将计算调和后的 MCID，记为 $MCID_{rec}$。这是两个独立 MCID 估算值的加权平均值：\n$$MCID_{rec} = (w \\times MCID_{anchor}) + ((1-w) \\times MCID_{dist})$$\n代入先前计算的估算值及其各自的权重：\n$$MCID_{rec} = (0.3025 \\times 3.1) + (0.6975 \\times 2.6)$$\n我现在进行乘法运算：\n$$0.3025 \\times 3.1 = 0.93775$$\n$$0.6975 \\times 2.6 = 1.8135$$\n将这些乘积相加得到调和后的 MCID：\n$$MCID_{rec} = 0.93775 + 1.8135 = 2.75125$$\n\n最后，题目要求将最终答案四舍五入到三位有效数字。计算出的值为 $2.75125$。前三位有效数字是 $2$、$7$ 和 $5$。第四位数字是 $1$，小于 $5$，因此该值向下取整为 $2.75$。\n调和后的 MCID 为 $2.75$ PHQ-9 分。",
            "answer": "$$\\boxed{2.75}$$"
        },
        {
            "introduction": "现代整合医疗强调对整个患者群体进行主动管理，而不仅仅是被动响应。这个练习将带你设计一个基于患者登记表的智能外展算法，这是一个将临床优先级（如症状严重程度和失联风险）转化为具体行动策略的实践。通过模拟资源分配，你将探索如何利用有限的临床资源，最大化患者的触及率和治疗效益 。",
            "id": "4721919",
            "problem": "您的任务是为初级保健中的综合行为健康设计并实现一个基于登记表的随访安排算法。该算法优先处理高严重度抑郁症和有失联记录的患者，并计算在 $8$ 周内，与非优先基线相比，患者触及率的预期改善。背景涉及患者健康问卷-9 (PHQ-9)，这是一种标准化的抑郁症状严重程度测量工具，分数越高表示症状越严重。登记表包含 $N$ 名患者，每位患者 $i \\in \\{1,\\dots,N\\}$ 具有以下属性：PHQ-9 分数 $s_i$、先前失联次数 $m_i$、以及每次尝试的独立触及概率 $p_i \\in (0,1)$。诊所每周的外展能力为 $C$ 次尝试。所有尝试均为独立的伯努利试验，对患者 $i$ 的成功概率为 $p_i$。\n\n根据概率论的基本原理和公平性风险加权的基本原理，定义每周调度和预期触及动态如下：\n- 设优先级权重 $W_i$ 由严重度和失联次数决定：\n  - 如果 $s_i \\ge 15$ 且 $m_i \\ge 1$，则 $W_i = 3$。\n  - 否则，如果 $s_i \\ge 15$ 且 $m_i = 0$，或 $s_i  15$ 且 $m_i \\ge 1$，则 $W_i = 2$。\n  - 否则 $W_i = 1$。\n- 设 $q_i(w)$ 表示患者 $i$ 在第 $w$ 周开始时仍未被触及的概率，所有 $i$ 的初始值 $q_i(1) = 1$。\n- 在第 $w$ 周，根据风险加权的预期需求按比例分配外展尝试次数：\n  $$c_i(w) = C \\cdot \\frac{W_i \\, q_i(w)}{\\sum_{j=1}^{N} W_j \\, q_j(w)}.$$\n- 在独立的伯努利尝试下，患者 $i$ 在第 $w$ 周经过 $c_i(w)$ 次尝试后仍未被触及的概率是 $(1-p_i)^{c_i(w)}$，因此更新规则为\n  $$q_i(w+1) = q_i(w) \\cdot (1 - p_i)^{c_i(w)}.$$\n- 对于给定的算法，到第 $8$ 周结束时预期触及的患者数量为\n  $$E = \\sum_{i=1}^{N} \\left(1 - q_i(9)\\right).$$\n\n定义一个非优先的基线算法，该算法对所有 $i$ 使用相等的权重 $W_i = 1$，并具有相同的每周容量 $C$ 和相同的 $q_i(w)$ 更新规则。将改善指标 $R$ 定义为十进制数：\n$$R = \\frac{E_{\\text{prio}} - E_{\\text{base}}}{E_{\\text{base}}},$$\n其中 $E_{\\text{prio}}$ 是在优先算法下预期触及的人数，$E_{\\text{base}}$ 是在基线算法下预期触及的人数。如果 $E_{\\text{base}} = 0$，则定义 $R = 0$。\n\n实现一个程序，对下面的每个测试用例，使用上述模型计算 $8$ 周内的 $E_{\\text{prio}}$、$E_{\\text{base}}$ 和 $R$。程序必须输出单行，内容是包含在方括号内的逗号分隔列表，其中按顺序包含每个测试用例的三元组，并展平为一个列表：$[E_{\\text{prio}}^{(1)}, E_{\\text{base}}^{(1)}, R^{(1)}, E_{\\text{prio}}^{(2)}, E_{\\text{base}}^{(2)}, R^{(2)}, \\dots]$。所有数值输出均表示为十进制数。\n\n测试套件：\n- 测试用例 $1$ (正常路径，混合严重度和失联次数)：\n  - $N=6$, $C=10$,\n  - $\\mathbf{s}^{(1)} = [4,16,18,11,7,21]$,\n  - $\\mathbf{m}^{(1)} = [0,2,0,1,0,3]$,\n  - $\\mathbf{p}^{(1)} = [0.25,0.35,0.2,0.3,0.1,0.4]$.\n- 测试用例 $2$ (边界情况：无高 PHQ-9 分数，无失联；优先策略等同于基线策略)：\n  - $N=4$, $C=8$,\n  - $\\mathbf{s}^{(2)} = [5,9,12,14]$,\n  - $\\mathbf{m}^{(2)} = [0,0,0,0]$,\n  - $\\mathbf{p}^{(2)} = [0.3,0.25,0.15,0.2]$.\n- 测试用例 $3$ (边缘情况：极低的容量和极低的触及概率)：\n  - $N=5$, $C=1$,\n  - $\\mathbf{s}^{(3)} = [15,16,10,5,20]$,\n  - $\\mathbf{m}^{(3)} = [1,0,2,0,1]$,\n  - $\\mathbf{p}^{(3)} = [0.05,0.05,0.05,0.05,0.05]$.\n- 测试用例 $4$ (边缘情况：所有患者均为高严重度且有失联；优先策略等同于基线策略)：\n  - $N=3$, $C=3$,\n  - $\\mathbf{s}^{(4)} = [15,17,19]$,\n  - $\\mathbf{m}^{(4)} = [1,1,2]$,\n  - $\\mathbf{p}^{(4)} = [0.3,0.2,0.25]$.\n- 测试用例 $5$ (边界情况：相对于登记表规模而言，容量非常高)：\n  - $N=5$, $C=100$,\n  - $\\mathbf{s}^{(5)} = [8,16,22,13,15]$,\n  - $\\mathbf{m}^{(5)} = [0,1,0,0,1]$,\n  - $\\mathbf{p}^{(5)} = [0.4,0.2,0.3,0.25,0.35]$.\n\n您的程序应生成单行输出，其中包含一个方括号括起来的逗号分隔列表（例如，对于三个结果为 $[r_1,r_2,r_3]$），此处的扁平化列表按顺序包含每个测试用例的三个数字：$E_{\\text{prio}}$、$E_{\\text{base}}$ 和 $R$。",
            "solution": "用户提供的问题已经过评估且有效。它在概率论方面具有科学依据，问题定义明确，目标清晰，数据充分，并且没有矛盾或含糊之处。该模型虽然是对真实世界临床流程的简化，但在数学上是一致的，并为算法解决方案提供了严谨的框架。\n\n该问题要求为综合行为健康设计和分析一个基于登记表的外展调度算法。核心任务是模拟在两种不同的资源分配策略（一种是优先策略，一种是非优先基线策略）下，为期 $8$ 周的患者外展过程，并量化患者触及率的相对改善。\n\n该解决方案首先通过形式化动态模型的各个组成部分，然后构建一个迭代算法来模拟系统的每周演化。\n\n**1. 模型构建**\n\n该模型由患者属性、诊所资源以及控制它们随时间相互作用的规则定义。\n\n**患者与诊所参数：**\n- 系统由登记表中的 $N$ 名患者组成。\n- 每位患者 $i$ 的特征包括 PHQ-9 分数 $s_i$、先前失联次数 $m_i$ 以及一个恒定的、每次尝试成功触及的概率 $p_i$。\n- 诊所每周的总外展容量为 $C$ 次尝试。\n\n**优先级加权 ($W_i$)：**\n一个关键组成部分是患者的风险分层。根据每位患者 $i$ 的临床严重度 ($s_i$) 和联系史 ($m_i$) 为其分配一个优先级权重 $W_i$。规则如下：\n- 对于高严重度 ($s_i \\ge 15$) 且有失联史 ($m_i \\ge 1$) 的患者，$W_i = 3$。这个群体代表最高的风险和需求。\n- 对于高严重度 ($s_i \\ge 15$) 但无失联 ($m_i = 0$)，或低严重度 ($s_i  15$) 但有失联史 ($m_i \\ge 1$) 的患者，$W_i = 2$。这是一个中等风险组。\n- 对于所有其他患者（低严重度且无失联），$W_i = 1$，代表基线优先级。\n\n**动态状态演化：**\n系统的状态通过变量 $q_i(w)$ 每周进行跟踪，该变量表示患者 $i$ 在第 $w$ 周开始时仍未被触及的概率。\n- **初始状态：** 在模拟开始时 ($w=1$)，尚未进行任何外展，因此可以肯定每位患者都未被触及。这通过初始条件 $q_i(1) = 1$ 对所有 $i \\in \\{1, \\dots, N\\}$ 进行形式化。\n- **每周尝试分配 ($c_i(w)$)：** 每周总容量 $C$ 在未触及的患者中进行分配。分配与每位患者的“风险加权需求”成正比，该需求定义为他们的优先级权重 $W_i$ 与其当前未被触及概率 $q_i(w)$ 的乘积。在第 $w$ 周分配给患者 $i$ 的尝试次数为：\n$$c_i(w) = C \\cdot \\frac{W_i \\, q_i(w)}{\\sum_{j=1}^{N} W_j \\, q_j(w)}$$\n$c_i(w)$ 是一个连续变量，代表分配给患者 $i$ 的预期尝试次数或总工作量的分数。分母作为归一化因子，确保 $\\sum_{i=1}^{N} c_i(w) = C$。随着时间推移，当一名患者被成功触及，其 $q_i(w)$ 值会下降，算法会自然地将资源从他们身上重新分配给仍未被触及的患者。\n- **状态更新：** 对每位患者的外展尝试被建模为独立的伯努利试验。单次尝试未能触及患者 $i$ 的概率是 $(1 - p_i)$。在第 $w$ 周进行 $c_i(w)$ 次独立尝试后，该周未能触及他们的概率是 $(1 - p_i)^{c_i(w)}$。在下一周开始时仍未被触及的概率 $q_i(w+1)$，是在第 $w$ 周开始时未被触及的概率乘以在第 $w$ 周期间未被触及的概率。这得出了递推关系：\n$$q_i(w+1) = q_i(w) \\cdot (1 - p_i)^{c_i(w)}$$\n\n**2. 算法实现**\n\n一个迭代算法模拟此过程，共持续 $8$ 周（即 $w$ 从 $1$ 到 $8$）。\n\n- **初始化：** 对于给定的一组患者数据 ($s_i, m_i, p_i$)，根据优先规则计算权重向量 $\\mathbf{W}$。状态向量 $\\mathbf{q}$ 初始化为全1向量，代表 $\\mathbf{q}(1)$。\n- **迭代：** 一个循环运行 $w=1, 2, \\dots, 8$：\n    1.  计算归一化因子 $S(w) = \\sum_{j=1}^{N} W_j q_j(w)$。\n    2.  计算所有患者的尝试分配向量 $\\mathbf{c}(w)$：$\\mathbf{c}(w) = C \\cdot (\\mathbf{W} \\odot \\mathbf{q}(w)) / S(w)$，其中 $\\odot$ 表示逐元素乘法。\n    3.  为下一周更新状态向量：$\\mathbf{q}(w+1) = \\mathbf{q}(w) \\odot (\\mathbf{1}-\\mathbf{p})^{\\mathbf{c}(w)}$，其中运算是逐元素的。\n- **最终计算：** 经过 $8$ 次迭代后，最终状态为 $\\mathbf{q}(9)$。到第 $8$ 周结束时已触及患者 $i$ 的概率是 $(1 - q_i(9))$。预期触及的患者总数是所有患者的总和：\n$$E = \\sum_{i=1}^{N} \\left(1 - q_i(9)\\right)$$\n\n对于每个测试用例，整个模拟过程执行两次：\n1.  **优先策略 ($E_{\\text{prio}}$)**：使用定义的权重 $W_i \\in \\{1, 2, 3\\}$。\n2.  **基线策略 ($E_{\\text{base}}$)**：对所有患者使用统一的权重 $W_i = 1$。\n\n最后，相对改善 $R$ 按公式 $R = (E_{\\text{prio}} - E_{\\text{base}}) / E_{\\text{base}}$ 计算，特殊情况是如果 $E_{\\text{base}} = 0$，则 $R = 0$。\n\n这种基于原则的方法可以直接比较两种策略，量化基于风险的优先级排序对患者外展总体有效性的影响。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the patient outreach scheduling problem for all test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"N\": 6, \"C\": 10,\n            \"s\": np.array([4, 16, 18, 11, 7, 21]),\n            \"m\": np.array([0, 2, 0, 1, 0, 3]),\n            \"p\": np.array([0.25, 0.35, 0.2, 0.3, 0.1, 0.4])\n        },\n        {\n            \"N\": 4, \"C\": 8,\n            \"s\": np.array([5, 9, 12, 14]),\n            \"m\": np.array([0, 0, 0, 0]),\n            \"p\": np.array([0.3, 0.25, 0.15, 0.2])\n        },\n        {\n            \"N\": 5, \"C\": 1,\n            \"s\": np.array([15, 16, 10, 5, 20]),\n            \"m\": np.array([1, 0, 2, 0, 1]),\n            \"p\": np.array([0.05, 0.05, 0.05, 0.05, 0.05])\n        },\n        {\n            \"N\": 3, \"C\": 3,\n            \"s\": np.array([15, 17, 19]),\n            \"m\": np.array([1, 1, 2]),\n            \"p\": np.array([0.3, 0.2, 0.25])\n        },\n        {\n            \"N\": 5, \"C\": 100,\n            \"s\": np.array([8, 16, 22, 13, 15]),\n            \"m\": np.array([0, 1, 0, 0, 1]),\n            \"p\": np.array([0.4, 0.2, 0.3, 0.25, 0.35])\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N = case[\"N\"]\n        C = case[\"C\"]\n        s = case[\"s\"]\n        m = case[\"m\"]\n        p = case[\"p\"]\n\n        # Run prioritized simulation\n        E_prio = run_simulation(N, C, s, m, p, use_priority_weights=True)\n        \n        # Run baseline simulation\n        E_base = run_simulation(N, C, s, m, p, use_priority_weights=False)\n\n        # Calculate improvement metric R\n        if E_base == 0:\n            R = 0.0\n        else:\n            R = (E_prio - E_base) / E_base\n        \n        results.extend([E_prio, E_base, R])\n\n    # Format the final output string\n    output_str = \"[\" + \",\".join(f\"{val:.10f}\".rstrip('0').rstrip('.') for val in results) + \"]\"\n    print(output_str)\n\n\ndef get_weights(s, m, use_priority_weights):\n    \"\"\"\n    Calculates priority weights for each patient.\n    \"\"\"\n    if not use_priority_weights:\n        return np.ones_like(s)\n\n    N = len(s)\n    W = np.ones(N)\n    for i in range(N):\n        if s[i] = 15 and m[i] = 1:\n            W[i] = 3\n        elif (s[i] = 15 and m[i] == 0) or (s[i]  15 and m[i] = 1):\n            W[i] = 2\n    return W\n\ndef run_simulation(N, C, s, m, p, use_priority_weights):\n    \"\"\"\n    Runs the 8-week outreach simulation for a given strategy.\n\n    Args:\n        N (int): Number of patients.\n        C (int): Weekly outreach capacity.\n        s (np.ndarray): Array of PHQ-9 scores.\n        m (np.ndarray): Array of missed contact counts.\n        p (np.ndarray): Array of per-attempt reach probabilities.\n        use_priority_weights (bool): If True, use prioritized weights. If False, use baseline weights.\n\n    Returns:\n        float: The expected number of patients reached after 8 weeks.\n    \"\"\"\n    W = get_weights(s, m, use_priority_weights)\n    \n    # q_i(w): probability patient i remains unreached at start of week w\n    # Initialize q(1) = 1 for all patients\n    q = np.ones(N, dtype=float)\n    \n    num_weeks = 8\n    \n    for _ in range(num_weeks):\n        # Denominator for allocation: sum of risk-weighted need\n        norm_factor = np.sum(W * q)\n        \n        c = np.zeros(N, dtype=float)\n        # Avoid division by zero if all patients are reached (norm_factor becomes 0)\n        if norm_factor  1e-12: # Using a small epsilon for float comparison\n            # c_i(w): attempts allocated to patient i in week w\n            c = C * (W * q) / norm_factor\n        \n        # q_i(w+1) = q_i(w) * (1 - p_i)^(c_i(w))\n        # Update probability of remaining unreached\n        q = q * ((1 - p) ** c)\n        \n    # After 8 weeks, q represents q(9)\n    # Expected number reached E = sum(1 - q_i(9))\n    expected_reached = np.sum(1 - q)\n    \n    return expected_reached\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}