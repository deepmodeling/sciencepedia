{
    "hands_on_practices": [
        {
            "introduction": "在流行病学研究中，一个最先遇到的实际问题是：为了得到有意义的结果，我们需要多大的样本量？本练习将指导你推导估算患病率所需的样本量公式。通过这个过程，你将学会如何将研究的精确度（误差范围）和置信度要求，与研究设计的核心参数——样本量，直接联系起来。",
            "id": "4623486",
            "problem": "一个公共卫生团队计划从一个非常大的总体中进行简单随机抽样，以估计在特定日历日期的某个二元状况的时点患病率。令真实时点患病率表示为 $p \\in [0,1]$。研究人员将计算样本比例 $\\hat{p}$ 作为 $p$ 的估计量，并且他们将报告一个围绕 $\\hat{p}$ 的名义水平为 $1-\\alpha$ 的双侧置信区间。他们要求绝对误差界（定义为在患病率（概率）尺度上区间宽度的一半）不超过预先设定的值 $E \\in (0,1)$。\n\n仅从以下框架出发：每个抽样个体贡献一个参数为 $p$ 的独立伯努利随机变量、适用于独立同分布变量样本均值的中心极限定理（CLT），以及使用标准正态分布分位数 $z_{\\alpha/2}$ 的双侧 $1-\\alpha$ 置信区间的定义，完成以下任务：\n\n1. 推导所需样本量 $n$ 的近似表达式，该表达式是关于 $p$、$E$ 和 $z_{\\alpha/2}$ 的函数，并确保在名义置信水平 $1-\\alpha$ 下，所要求的绝对误差界不大于 $E$。\n\n2. 在设计阶段，$p$ 是未知的。仅利用 $p(1-p)$ 在 $p \\in [0,1]$ 上的数学性质，通过选择使所需 $n$ 最大化的 $p$ 值，推导出一个从样本量公式中消除 $p$ 的保守规划法则。提供最终仅用 $E$ 和 $z_{\\alpha/2}$ 表示的 $n$ 的闭式表达式。\n\n你的最终答案应该是第2部分得到的 $n$ 的保守闭式表达式。不要为 $E$ 或 $z_{\\alpha/2}$ 代入任何数值。不需要四舍五入，因为答案应该是一个解析表达式，而不是一个数字。",
            "solution": "该问题被评估为有效。这是一个统计样本量计算中的标准、适定问题，基于统计推断的基本原理（伯努利试验、中心极限定理）。它自成体系、客观且内部一致。\n\n任务是推导估算总体患病率 $p$ 所需的样本量 $n$ 的公式，要求具有指定的绝对误差界 $E$ 和置信水平 $1-\\alpha$。推导过程按要求分两部分进行。\n\n第1部分：推导作为 $p$、$E$ 和 $z_{\\alpha/2}$ 函数的样本量公式。\n\n令个体中的二元状况由随机变量 $X_i$ 表示，如果个体具有该状况，则 $X_i=1$，否则 $X_i=0$。对于从一个非常大的总体中进行的简单随机抽样，变量 $X_1, X_2, \\dots, X_n$ 可以被建模为参数为 $p$（真实患病率）的独立同分布（i.i.d.）伯努利随机变量。\n$$ X_i \\sim \\text{Bernoulli}(p) \\quad \\text{for } i = 1, \\dots, n $$\n参数 $p$ 是成功的概率，$P(X_i=1)=p$。每个 $X_i$ 的均值和方差分别为 $E[X_i] = p$ 和 $\\text{Var}(X_i) = p(1-p)$。\n\n患病率 $p$ 的点估计量是样本比例 $\\hat{p}$，定义为样本均值：\n$$ \\hat{p} = \\frac{1}{n} \\sum_{i=1}^{n} X_i $$\n该估计量的期望值为 $E[\\hat{p}] = E[\\frac{1}{n} \\sum_{i=1}^{n} X_i] = \\frac{1}{n} \\sum_{i=1}^{n} E[X_i] = \\frac{1}{n} (np) = p$。因此，$\\hat{p}$ 是 $p$ 的无偏估计量。\n\n由于 $X_i$ 的独立性，该估计量的方差为：\n$$ \\text{Var}(\\hat{p}) = \\text{Var}\\left(\\frac{1}{n} \\sum_{i=1}^{n} X_i\\right) = \\frac{1}{n^2} \\sum_{i=1}^{n} \\text{Var}(X_i) = \\frac{1}{n^2} (n \\cdot p(1-p)) = \\frac{p(1-p)}{n} $$\n$\\hat{p}$ 的标准误是其方差的平方根：\n$$ \\text{SE}(\\hat{p}) = \\sqrt{\\frac{p(1-p)}{n}} $$\n根据中心极限定理（CLT），对于足够大的样本量 $n$，$\\hat{p}$ 的抽样分布近似为正态分布。具体来说，标准化统计量\n$$ Z = \\frac{\\hat{p} - p}{\\text{SE}(\\hat{p})} = \\frac{\\hat{p} - p}{\\sqrt{p(1-p)/n}} $$\n近似服从标准正态随机变量分布，$Z \\sim N(0,1)$。\n\n基于此近似，构建了 $p$ 的置信水平为 $1-\\alpha$ 的双侧置信区间。该区间以估计值 $\\hat{p}$ 为中心，其宽度由标准误和标准正态分布的适当分位数决定。令 $z_{\\alpha/2}$ 为满足 $P(Z > z_{\\alpha/2}) = \\alpha/2$ 的值。该区间由以下不等式定义：\n$$ -z_{\\alpha/2} \\le \\frac{\\hat{p} - p}{\\text{SE}(\\hat{p})} \\le z_{\\alpha/2} $$\n绝对误差界 $E$ 定义为置信区间宽度的一半。在设计阶段，我们使用真实的标准误（而非其样本估计值）来定义此误差界。\n$$ E = z_{\\alpha/2} \\cdot \\text{SE}(\\hat{p}) = z_{\\alpha/2} \\sqrt{\\frac{p(1-p)}{n}} $$\n问题要求这个误差界不超过一个预先设定的值，我们也将其表示为 $E$。为了求得所需的样本量 $n$，我们对此方程求解 $n$：\n$$ E^2 = \\left(z_{\\alpha/2} \\sqrt{\\frac{p(1-p)}{n}}\\right)^2 = z_{\\alpha/2}^2 \\cdot \\frac{p(1-p)}{n} $$\n整理各项以求解 $n$，我们得到：\n$$ nE^2 = z_{\\alpha/2}^2 p(1-p) $$\n$$ n = \\frac{z_{\\alpha/2}^2 p(1-p)}{E^2} $$\n该表达式给出了所需样本量 $n$ 作为未知患病率 $p$、期望误差界 $E$ 以及与置信水平 $1-\\alpha$ 对应的临界值 $z_{\\alpha/2}$ 的函数。这完成了推导的第一部分。\n\n第2部分：推导保守规划法则。\n\n上面推导出的 $n$ 的公式依赖于真实患病率 $p$，而 $p$ 在设计阶段是未知的。为了确保无论 $p$ 的真实值是多少，样本量都足够大，我们采取一种保守的方法，即选择使所需样本量 $n$ 最大化的 $p$ 值。\n样本量 $n$ 与项 $p(1-p)$ 成正比，因为在规划阶段 $z_{\\alpha/2}$ 和 $E$ 是固定常数。因此，我们必须找到函数 $f(p) = p(1-p)$ 在 $p \\in [0,1]$ 上的最大值。\n\n函数 $f(p) = p - p^2$ 是一个开口向下的抛物线，其根在 $p=0$ 和 $p=1$。抛物线的顶点，即函数的最大值所在处，位于对称轴 $p = \\frac{0+1}{2} = \\frac{1}{2}$上。\n\n或者，我们可以使用微积分来求最大值。我们求 $f(p)$ 对 $p$ 的一阶导数，并令其为零：\n$$ \\frac{df}{dp} = \\frac{d}{dp}(p-p^2) = 1 - 2p $$\n令 $\\frac{df}{dp} = 0$ 得出 $1-2p = 0$，从而得到临界点 $p = \\frac{1}{2}$。\n为确认这是一个最大值，我们检查二阶导数：\n$$ \\frac{d^2f}{dp^2} = -2 $$\n由于二阶导数为负，函数 $f(p)$ 在 $p = \\frac{1}{2}$ 处有一个局部最大值。由于这是区间 $(0,1)$ 内唯一的临界点，且在端点处的函数值为 $f(0)=0$ 和 $f(1)=0$，因此这是在区间 $[0,1]$ 上的全局最大值。\n\n方差项 $p(1-p)$ 的最大值为：\n$$ f\\left(\\frac{1}{2}\\right) = \\frac{1}{2}\\left(1 - \\frac{1}{2}\\right) = \\frac{1}{2} \\cdot \\frac{1}{2} = \\frac{1}{4} $$\n通过将此最大值代入样本量公式，我们得到保守的样本量 $n$，它保证对于任何可能的 $p \\in [0,1]$ 值，误差界都不会超过 $E$：\n$$ n = \\frac{z_{\\alpha/2}^2 \\left(\\frac{1}{4}\\right)}{E^2} = \\frac{z_{\\alpha/2}^2}{4E^2} $$\n这就是保守样本量的最终闭式表达式，仅依赖于期望的误差界 $E$ 和置信水平 $1-\\alpha$（通过 $z_{\\alpha/2}$）。",
            "answer": "$$\n\\boxed{\\frac{z_{\\alpha/2}^{2}}{4E^{2}}}\n$$"
        },
        {
            "introduction": "准确定义测量指标是流行病学分析的基石，错误的定义将导致错误的结论。本练习聚焦于一个核心且常见的混淆点：患病率（prevalence）与发病率（incidence rate）的分母选择。通过辨析，你将巩固对患病率作为“时点或时期占有率”的理解，并阐明为何其分母必须是人数，而不是人时。",
            "id": "4623467",
            "problem": "一个市级卫生部门在一个日历年内监测一个封闭城镇的某种慢性病。在年中某个单一普查时刻，登记人口为 $N_{\\text{mid}} = 1000$ 人，其中有 $n_{\\text{cases}}(t_{\\text{mid}}) = 80$ 人在该时刻处于患病状态。在整个年度内，观察到有 $n_{\\text{period}} = 120$ 个不同的人在该期间内至少有一次处于患病状态。出于操作原因，现场工作人员还统计了观察到的总人时 $PT_{\\text{total}} = 950\\,\\text{人年}$ 以及所有人在患病状态下所花费的总时间 $PT_{\\text{diseased}} = 100\\,\\text{人年}$。\n\n两位分析师提出了不同的分母策略来衡量疾病频率。分析师P认为，时点患病率和期间患病率的恰当分母必须是与人群中患病状态占用相关的人数计数。分析师T认为，人时分母更合适，因为它们考虑了可变的随访时间，并且是率计算中的标准分母。\n\n从核心定义出发——患病率是某个时间点（时点患病率）或某个时期内（期间患病率）人群中患病状态的占有比例，而发病率是风险人群所贡献的单位人时内新发病例事件的频率——考虑将分子和分母配对的概念性后果。具体来说，请注意，时点患病率的分子是某个瞬间处于患病状态的人数，期间患病率的分子是在该期间内曾经处于患病状态的不同人数，而发病率的分子是发病事件的计数。\n\n下列哪个陈述最好地解释了为什么人时分母不适用于患病率，并正确地将患病率的占有解释与使用人时的发病率定义进行对比？选择所有适用项。\n\nA. 患病率是基于人数的占有比例：其分子计算的是处于某种状态的人数，因此其分母必须是人数计数，以得到一个无量纲的比例；将人数分子与人时分母配对会产生一个单位为 $1/\\text{time}$ 的量，回答的是与患病率不同的问题，而发病率则明确定义为单位人时的事件数。\n\nB. 期间患病率需要使用人时分母，因为它们可以校正可变的随访时间；若不使用人时，当某些个体在期间结束前被删失时，期间患病率将无法定义。\n\nC. 如果将 $PT_{\\text{diseased}}$ 除以 $PT_{\\text{total}}$，结果是一个无量纲的时间平均占有分数（人群时间中处于患病状态的时间比例）。尽管这是可解释的，但它不是标准的基于人数的期间患病率，后者计算的是在该期间内曾经处于该状态的不同人数；因此，使用人时分母将估计量（estimand）从患病率改变了。\n\nD. 年中时点患病率定义为中点时刻的病例数除以人时，因为它反映了通过患病状态的瞬时流量；因此，人时是时点患病率和期间患病率的恰当分母。\n\nE. 在疾病罕见时，使用人时分母计算患病率与使用人数分母得到的值相同，因此对于低患病率的疾病，分母的选择在实践中无关紧要。",
            "solution": "题目要求评估几个关于患病率测量指标的恰当分母的陈述，并将它们与用于发病率的分母进行对比。问题的核心在于这些流行病学测量指标的基本定义。\n\n首先，让我们根据题目中提供的原则和标准的流行病学实践来确定定义。\n\n**患病率 (Prevalence)** 是衡量在特定时间点或特定时期内，人群中处于某种特定状态（例如，患有某种疾病）的比例。它本质上是一个**比例**，是一个无量纲的量。\n-   **时点患病率 ($P$)**: 衡量在单个时间点上人群中患有该疾病的个体比例。其计算公式为：\n    $$ P = \\frac{\\text{在特定时间 } t \\text{ 患有该疾病的人数}}{\\text{在时间 } t \\text{ 的总人口数}} $$\n    分子是人数，分母也是人数。结果是一个无量纲的比例，通常表示为百分比或每 $1,000$ 人中的人数。根据提供的数据，年中的时点患病率为：\n    $$ P_{\\text{mid}} = \\frac{n_{\\text{cases}}(t_{\\text{mid}})}{N_{\\text{mid}}} = \\frac{80}{1000} = 0.08 $$\n-   **期间患病率 ($PP$)**: 衡量在指定时期内，人群中曾经患有该疾病的个体比例。其计算公式为：\n    $$ PP = \\frac{\\text{在指定时期内任何时间曾患有该疾病的不同人数}}{\\text{该时期内的总人口数（通常是期中人口）}} $$\n    分子是不同的人数，分母也是人数。结果是一个无量纲的比例。根据提供的数据：\n    $$ PP_{\\text{year}} = \\frac{n_{\\text{period}}}{N_{\\text{mid}}} = \\frac{120}{1000} = 0.12 $$\n\n**发病率 (Incidence Rate) (或发病密度)** 衡量在一段时间内，风险人群中新病例（事件）发生的速率。它是一个真正的**率**，衡量事件发生的快慢。\n-   **发病率 ($IR$)**: 其计算公式为：\n    $$ IR = \\frac{\\text{某时期内新发事件的数量}}{\\text{该时期内风险人群的总人时}} $$\n    分子是事件的计数（不是人数，因为在某些情况下，一个人可能发生多次事件，尽管对于慢性病，发病通常只有一次）。分母是每个个体处于疾病风险状态的时间总和，以人年等单位衡量。所得的量单位为 $1/\\text{time}$（例如，病例数/人年）。它不是一个比例。题目未提供新发病例数，因此我们无法计算 $IR$。\n\n有了这些定义，我们可以分析不同分母的概念作用。分析师P主张患病率使用人数分母，这符合标准定义。分析师T主张使用人时分母，这是将患病率与发病率或其他类型的测量指标混淆了。\n\n现在，我们来评估每个选项。\n\n**A. 患病率是基于人数的占有比例：其分子计算的是处于某种状态的人数，因此其分母必须是人数计数，以得到一个无量纲的比例；将人数分子与人时分母配对会产生一个单位为 $1/\\text{time}$ 的量，回答的是与患病率不同的问题，而发病率则明确定义为单位人时的事件数。**\n\n-   **分析**: 该陈述正确地将患病率识别为基于人数的比例。比例要求分子和分母具有相同的单位（此处为人数），从而使结果无量纲。该陈述对（人数/人时）这个无效的构造进行了量纲分析，正确地指出其单位为 $1/\\text{time}$。例如，$\\frac{n_{\\text{period}}}{PT_{\\text{total}}} = \\frac{120 \\text{ 人}}{950 \\text{ 人年}}$ 的单位是 `(人)` / `(人 * 时间)`，简化为 `1/时间`。这在量纲上是一个率，而不是比例。该陈述正确地将其与发病率的定义进行对比，后者也是一个率（事件/人时），但衡量的是新发病例的发生。该陈述完全符合流行病学原理。\n-   **结论**: **正确**。\n\n**B. 期间患病率需要使用人时分母，因为它们可以校正可变的随访时间；若不使用人时，当某些个体在期间结束前被删失时，期间患病率将无法定义。**\n\n-   **分析**: 该陈述不正确。它将发病率的要求与期间患病率的定义混为一谈。人时分母正是发病率的标志，因为它恰恰考虑了动态队列中可变的随访时间。然而，期间患病率是基于人数计数的比例。虽然删失或失访给确定恰当的分母带来了挑战（例如，应该使用初始、最终还是平均人口？），但这并不会使这个概念“无法定义”。流行病学家会选择一个合适的人数分母来最好地代表参考人群。声称人时是*必需的*，这从根本上是错误的。\n-   **结论**: **不正确**。\n\n**C. 如果将 $PT_{\\text{diseased}}$ 除以 $PT_{\\text{total}}$，结果是一个无量纲的时间平均占有分数（人群时间中处于患病状态的时间比例）。尽管这是可解释的，但它不是标准的基于人数的期间患病率，后者计算的是在该期间内曾经处于该状态的不同人数；因此，使用人时分母将估计量（estimand）从患病率改变了。**\n\n-   **分析**: 该陈述准确地描述了一个有效但不同的流行病学测量指标。比率 $\\frac{PT_{\\text{diseased}}}{PT_{\\text{total}}}$ 是两个具有相同单位（人时）的量的比值，结果是一个无量纲的比例。其解释被正确地表述为“人群时间中处于患病状态的时间比例”，有时被称为时间患病率或时间平均患病率。对于给定的数据，这个值是 $\\frac{100 \\text{ 人年}}{950 \\text{ 人年}} \\approx 0.105$。该陈述正确地将其与标准的（基于人数的）期间患病率进行对比，后者计算的是曾经患病的*人数*比例（$120/1000 = 0.12$）。关键在于，虽然可以使用人时同时作为分子和分母来构建一个有意义的无量纲量，但这个量（估计量）与标准定义的期间患病率是不同的。\n-   **结论**: **正确**。\n\n**D. 年中时点患病率定义为中点时刻的病例数除以人时，因为它反映了通过患病状态的瞬时流量；因此，人时是时点患病率和期间患病率的恰当分母。**\n\n-   **分析**: 该陈述在多个方面都是不正确的。时点患病率是在一个时间瞬间测量的；在瞬时背景下，“人时”分母是无意义的，因为没有时间流逝。分母是那个瞬间的简单人数计数。此外，患病率衡量的是一种“状态”或“占有”，而不是“流量”。流量是与发病率（新病例的流入）相关的概念。因此，人时是时点和期间患病率的恰当分母的结论，直接违背了它们的定义。\n-   **结论**: **不正确**。\n\n**E. 在疾病罕见时，使用人时分母计算患病率与使用人数分母得到的值相同，因此对于低患病率的疾病，分母的选择在实践中无关紧要。**\n\n-   **分析**: 该陈述是错误的。它错误地应用或虚构了与“罕见病假设”相关的属性。标准的罕见病假设将患病率 ($P$) 与发病率 ($IR$) 和平均病程 ($D$) 通过公式 $P \\approx IR \\times D$ 联系起来（对于稳定人群）。它并没有说人数分母（例如 $N = 1000$ 人）约等于人时分母（例如 $PT = 950$ 人年）。这两个量单位不同，不可互换，无论患病率高低。分母的选择对于测量指标的定义和解释至关重要，绝非无关紧要。\n-   **结论**: **不正确**。\n\n总之，陈述A和C正确地阐明了为什么人时分母不适用于标准患病率测量指标的概念和数学原因，并将患病率与其他相关量区分开来。",
            "answer": "$$\\boxed{AC}$$"
        },
        {
            "introduction": "当今的流行病学研究越来越依赖于处理个体层面的纵向数据。本练习要求你将时期患病率的理论定义转化为一个具体的计算算法。你将学习如何从原始数据（包括每个个体的进入、退出、发病和康复时间）中，精确地计算出时期内的病例总数和平均人口数，最终得出时期患病率。",
            "id": "4623538",
            "problem": "给定来自一个封闭队列在有限时间区间内观察到的个体层面纵向数据。每个个体 $i$ 由四个以天为单位测量的时间点描述：人群进入时间 $E_i$、人群退出时间 $X_i$、疾病发作时间 $T_i^{on}$ 和疾病消退时间 $T_i^{off}$。如果个体在观察期结束后仍处于患病状态，则其 $T_i^{off}$ 视为 $+\\infty$。所有时间点均为实数值，并在同一个公共时间轴上测量。\n\n从基本定义出发：\n- 对每个个体 $i$，定义成员资格指示符 $M_i(t)$，如果 $E_i \\le t \\le X_i$ 则等于 $1$，否则等于 $0$；并定义时间 $t$ 的人群规模为 $N(t) = \\sum_i M_i(t)$。\n- 对每个个体 $i$，定义疾病指示符 $D_i(t)$，如果 $T_i^{on}  t  T_i^{off}$ 则等于 $1$，否则等于 $0$，疾病采用开区间以强制执行在 $t = T_i^{on}$ 和 $t = T_i^{off}$ 处的严格边界条件。\n- 在一个时期 $\\left[t_0, t_1\\right]$（其中 $t_0  t_1$）内，如果个体 $i$ 的疾病指示符 $D_i(t)$ 在 $\\left[t_0, t_1\\right]$ 内至少有一个时间点 $t$ 等于 $1$，则该个体被计为在该时期内患过病。该时期内的平均人群规模定义为 $N(t)$ 在 $\\left[t_0, t_1\\right]$ 上的时间平均值。\n\n根据这些定义推导出一个算法，该算法在给定 $\\left[t_0, t_1\\right]$ 和个体层面的元组 $\\left(E_i, X_i, T_i^{on}, T_i^{off}\\right)$ 的情况下，计算 $\\left[t_0, t_1\\right]$ 期间的时期患病率，结果为一个浮点数。您的算法必须：\n- 在时期边界处使用开区间疾病准则，因此恰好在 $t_1$ 发病的情况不计入，恰好在 $t_0$ 消退的情况也不计入。\n- 通过对 $\\left[t_0, t_1\\right]$ 上的 $N(t)$ 进行时间平均来计算平均人群规模，仅使用成员资格区间 $\\left[E_i, X_i\\right]$ 与时期 $\\left[t_0, t_1\\right]$ 的重叠长度。\n\n实现该算法，并在以下测试套件上进行评估。对每个案例，计算时期患病率并输出一个四舍五入到 $6$ 位小数的浮点数。最终输出表示为包含在方括号内的、以逗号分隔的单个列表。\n\n测试套件（每个案例指定 $\\left[t_0, t_1\\right]$ 和以 $\\left(E, X, T^{on}, T^{off}\\right)$ 形式给出的个体列表）：\n\n- 案例 $1$（正常路径）：\n  - 时期：$t_0 = 0$, $t_1 = 30$。\n  - 个体：\n    - $\\left(0, 30, 10, 20\\right)$，\n    - $\\left(0, 30, 0, 5\\right)$，\n    - $\\left(0, 30, 40, 60\\right)$，\n    - $\\left(10, 30, 28, 40\\right)$，\n    - $\\left(0, 10, 8, 12\\right)$。\n\n- 案例 $2$（在 $t_0$ 和 $t_1$ 处的边界条件）：\n  - 时期：$t_0 = 0$, $t_1 = 10$。\n  - 个体：\n    - $\\left(0, 10, 10, 20\\right)$，\n    - $\\left(0, 10, -5, 0\\right)$，\n    - $\\left(0, 10, -5, 5\\right)$。\n\n- 案例 $3$（持续性疾病及成员资格在时期开始时结束）：\n  - 时期：$t_0 = 5$, $t_1 = 15$。\n  - 个体：\n    - $\\left(0, 20, 12, +\\infty\\right)$，\n    - $\\left(6, 10, 1, 6\\right)$，\n    - $\\left(7, 14, 2, 4\\right)$，\n    - $\\left(0, 5, 4, 5\\right)$。\n\n- 案例 $4$（时期内无疾病）：\n  - 时期：$t_0 = 0$, $t_1 = 10$。\n  - 个体：\n    - $\\left(0, 10, 20, 30\\right)$，\n    - $\\left(0, 10, 11, 12\\right)$。\n\n- 案例 $5$（时期长度较短）：\n  - 时期：$t_0 = 100$, $t_1 = 101$。\n  - 个体：\n    - $\\left(0, 200, 50, 150\\right)$，\n    - $\\left(100, 100.5, 95, 96\\right)$，\n    - $\\left(100.2, 100.8, 100.3, 100.4\\right)$。\n\n输出规范：\n- 您的程序应生成单行输出，其中包含一个方括号内的、以逗号分隔的列表（例如，$\\left[\\text{result}_1,\\text{result}_2,\\dots\\right]$）。\n- 结果必须是四舍五入到 $6$ 位小数的浮点数，以小数形式表示，不带百分号。",
            "solution": "问题陈述已经过严格审查，并被认为是有效的。它具有自洽性，科学上基于流行病学原理，并且在数学上是适定的。所提供的关于人群成员资格、疾病状态和平均人群规模的定义清晰、精确且内部一致。因此，该问题可以按陈述求解。\n\n目标是计算一个时间区间 $[t_0, t_1]$ 内的时期患病率 $P_{\\text{period}}$。根据定义，时期患病率是在指定时期内任何时间点患病的总人数与同一时期内平均人群规模的比值。\n\n$$ P_{\\text{period}} = \\frac{\\text{在 } [t_0, t_1] \\text{ 期间患病的个体数}}{\\text{在 } [t_0, t_1] \\text{ 期间的平均人群规模}} $$\n\n我们用 $C_{[t_0, t_1]}$ 表示分子，用 $N_{\\text{avg}}$ 表示分母。每个部分都将从提供的基本定义中推导出来。\n\n**1. 分子（病例数）的推导**\n\n如果个体 $i$ 的疾病指示符 $D_i(t) = 1$ 在至少一个时间点 $t \\in [t_0, t_1]$ 成立，则该个体被计为一个病例。疾病指示符定义为 $D_i(t) = 1$ 当且仅当 $t$ 落在开区间 $(T_i^{on}, T_i^{off})$ 内，其中 $T_i^{on}$ 是疾病发作时间，$T_i^{off}$ 是疾病消退时间。\n\n因此，如果疾病区间 $(T_i^{on}, T_i^{off})$ 与观察时期 $[t_0, t_1]$ 的交集非空，则个体 $i$ 是一个病例。两个区间 $(a, b)$ 和 $[c, d]$ 的交集非空，当且仅当它们不相交。它们相交的条件是 $b > c$ 且 $a  d$。\n\n将此应用于我们的特定变量，其中 $a = T_i^{on}$，$b = T_i^{off}$，$c = t_0$，$d = t_1$，个体 $i$ 是一个病例当且仅当：\n$$ T_i^{on}  t_1 \\quad \\text{且} \\quad T_i^{off} > t_0 $$\n此条件正确地强制执行了指定的严格边界条件。例如，如果一个个体的疾病发作时间恰好在 $t_1$，则 $T_i^{on} = t_1$，条件 $T_i^{on}  t_1$ 为假，该个体不被计数。类似地，如果疾病消退恰好发生在 $t_0$，即 $T_i^{off} = t_0$，条件 $T_i^{off} > t_0$ 为假。\n\n总病例数 $C_{[t_0, t_1]}$ 是满足此条件的所有个体的指示函数的总和：\n$$ C_{[t_0, t_1]} = \\sum_{i} \\mathbf{1}_{\\{T_i^{on}  t_1 \\land T_i^{off} > t_0\\}} $$\n其中 $\\mathbf{1}_{\\{\\cdot\\}}$ 是指示函数，当条件为真时等于 $1$，否则等于 $0$。\n\n**2. 分母（平均人群规模）的推导**\n\n时期 $[t_0, t_1]$ 内的平均人群规模 $N_{\\text{avg}}$ 定义为人群规模函数 $N(t)$ 的时间平均值：\n$$ N_{\\text{avg}} = \\frac{1}{t_1 - t_0} \\int_{t_0}^{t_1} N(t) \\,dt $$\n时间 $t$ 的人群规模为 $N(t) = \\sum_i M_i(t)$，其中 $M_i(t)$ 是个体 $i$ 的成员资格指示符。根据积分的线性性质，我们可以写出：\n$$ N_{\\text{avg}} = \\frac{1}{t_1 - t_0} \\sum_{i} \\int_{t_0}^{t_1} M_i(t) \\,dt $$\n成员资格指示符 $M_i(t)$ 定义为：如果 $t \\in [E_i, X_i]$（个体的成员资格区间），则为 $1$，否则为 $0$。因此，积分 $\\int_{t_0}^{t_1} M_i(t) \\,dt$ 表示个体成员资格区间 $[E_i, X_i]$ 与观察时期 $[t_0, t_1]$ 的交集长度。\n\n设 $L_i$ 为此重叠长度。两个闭区间 $[a, b]$ 和 $[c, d]$ 的交集是另一个区间 $[\\max(a, c), \\min(b, d)]$。此交集的长度是 $\\max(0, \\min(b, d) - \\max(a, c))$。\n对于个体 $i$，其成员资格区间为 $[E_i, X_i]$，观察时期为 $[t_0, t_1]$，其贡献的人时为：\n$$ L_i = \\max(0, \\min(X_i, t_1) - \\max(E_i, t_0)) $$\n将所有个体的这些长度相加，得到该时期内的总风险人时，记为 $\\text{PT}$：\n$$ \\text{PT}_{[t_0, t_1]} = \\sum_i L_i = \\sum_i \\max(0, \\min(X_i, t_1) - \\max(E_i, t_0)) $$\n将此代入 $N_{\\text{avg}}$ 的表达式中：\n$$ N_{\\text{avg}} = \\frac{\\text{PT}_{[t_0, t_1]}}{t_1 - t_0} $$\n\n**3. 时期患病率的最终算法**\n\n结合分子和分母的表达式，我们得到时期患病率的最终公式：\n$$ P_{\\text{period}} = \\frac{C_{[t_0, t_1]}}{N_{\\text{avg}}} = \\frac{C_{[t_0, t_1]}}{\\frac{\\text{PT}_{[t_0, t_1]}}{t_1 - t_0}} = \\frac{C_{[t_0, t_1]} \\cdot (t_1 - t_0)}{\\text{PT}_{[t_0, t_1]}} $$\n这个最终形式在计算上是稳健的。处理 $\\text{PT}_{[t_0, t_1]} = 0$ 的情况很重要。如果总人时为零，则平均人群为零，患病率在形式上是未定义的。如果病例数也为零，则患病率可视为 $0$。如果存在病例但人时为零，这表示逻辑矛盾（疾病发生在不存在的人群中），但问题的测试案例并未出现此种病态情况。在实现中，如果 $\\text{PT}_{[t_0, t_1]} = 0$，则将患病率设为 $0.0$。\n算法如下：\n1. 对于给定的时期 $[t_0, t_1]$ 和一组个体，将病例数 $C_{[t_0, t_1]}$ 初始化为 $0$，总人时 $\\text{PT}_{[t_0, t_1]}$ 初始化为 $0$。\n2. 对每个数据为 $(E_i, X_i, T_i^{on}, T_i^{off})$ 的个体 $i$：\n    a. 评估病例条件：如果 $T_i^{on}  t_1$ 且 $T_i^{off} > t_0$，则递增 $C_{[t_0, t_1]}$。\n    b. 计算人时贡献：$L_i = \\max(0, \\min(X_i, t_1) - \\max(E_i, t_0))$。将 $L_i$ 加到 $\\text{PT}_{[t_0, t_1]}$ 中。\n3. 遍历所有个体后，计算时期长度 $\\Delta t = t_1 - t_0$。\n4. 如果 $\\text{PT}_{[t_0, t_1]} > 0$，则计算患病率 $P_{\\text{period}} = (C_{[t_0, t_1]} \\cdot \\Delta t) / \\text{PT}_{[t_0, t_1]}$。否则，设 $P_{\\text{period}} = 0.0$。\n5. 将结果四舍五入到所需精度。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    基于个体层面纵向数据，为一系列测试案例计算时期患病率。\n    \"\"\"\n    \n    test_cases = [\n        {\n            \"period\": (0, 30),\n            \"individuals\": [\n                (0, 30, 10, 20),\n                (0, 30, 0, 5),\n                (0, 30, 40, 60),\n                (10, 30, 28, 40),\n                (0, 10, 8, 12),\n            ],\n        },\n        {\n            \"period\": (0, 10),\n            \"individuals\": [\n                (0, 10, 10, 20),\n                (0, 10, -5, 0),\n                (0, 10, -5, 5),\n            ],\n        },\n        {\n            \"period\": (5, 15),\n            \"individuals\": [\n                (0, 20, 12, np.inf),\n                (6, 10, 1, 6),\n                (7, 14, 2, 4),\n                (0, 5, 4, 5),\n            ],\n        },\n        {\n            \"period\": (0, 10),\n            \"individuals\": [\n                (0, 10, 20, 30),\n                (0, 10, 11, 12),\n            ],\n        },\n        {\n            \"period\": (100, 101),\n            \"individuals\": [\n                (0, 200, 50, 150),\n                (100, 100.5, 95, 96),\n                (100.2, 100.8, 100.3, 100.4),\n            ],\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        t0, t1 = case[\"period\"]\n        individuals = case[\"individuals\"]\n        \n        num_cases = 0\n        total_person_time = 0.0\n        \n        # Period duration\n        period_duration = t1 - t0\n\n        for E, X, T_on, T_off in individuals:\n            # Numerator: Count individuals who had the disease during the period.\n            # The disease interval (T_on, T_off) must overlap with the period [t0, t1].\n            # This is true if T_on  t1 and T_off > t0.\n            if T_on  t1 and T_off > t0:\n                num_cases += 1\n            \n            # Denominator: Calculate total person-time at risk.\n            # This is the sum of the lengths of the overlap between each individual's\n            # membership interval [E, X] and the observation period [t0, t1].\n            overlap_start = max(E, t0)\n            overlap_end = min(X, t1)\n            person_time_contribution = max(0, overlap_end - overlap_start)\n            total_person_time += person_time_contribution\n            \n        # Calculate period prevalence\n        # P_period = (Number of cases) / (Average population)\n        # Average population = (Total person-time) / (Period duration)\n        # So, P_period = (Number of cases * Period duration) / (Total person-time)\n\n        if total_person_time == 0:\n            # If total person-time is zero, average population is zero.\n            # If num_cases is also 0, prevalence is 0. If num_cases > 0,\n            # prevalence is undefined. The problem cases avoid this ambiguity.\n            # We assign 0 in this case.\n            prevalence = 0.0\n        else:\n            prevalence = (num_cases * period_duration) / total_person_time\n            \n        results.append(round(prevalence, 6))\n\n    # Format the final output as a comma-separated list in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}