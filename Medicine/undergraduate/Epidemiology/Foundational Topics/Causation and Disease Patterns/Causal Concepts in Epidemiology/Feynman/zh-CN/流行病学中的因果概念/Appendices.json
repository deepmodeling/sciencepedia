{
    "hands_on_practices": [
        {
            "introduction": "在因果分析中，确定需要调整哪些变量是至关重要的一步。虽然控制暴露和结果的共同原因是标准做法，但调整其他变量有时反而会*引入*偏倚。这个练习  使用有向无环图（DAG）来说明M-偏倚，这是一种对撞机分层偏倚，能帮助您理解何时*不应*调整某个变量。",
            "id": "4575698",
            "problem": "考虑一个包含变量 $A$（暴露）、$Y$（结局）、$L_1$ 和 $L_2$（暴露前的共同原因）以及 $C$（一个受 $L_1$ 和 $L_2$ 影响的变量）的有向无环图 (DAG)，其箭头关系为 $L_1 \\rightarrow A$，$L_1 \\rightarrow C$，$L_2 \\rightarrow C$ 和 $L_2 \\rightarrow Y$，并且没有箭头 $A \\rightarrow Y$。节点 $C$ 是结构 $L_1 \\rightarrow C \\leftarrow L_2$ 上的一个对撞节点。$A$ 对 $Y$ 的因果效应是对比 $E[Y \\mid do(A=a)] - E[Y \\mid do(A=a')]$，其中 $do(\\cdot)$ 表示因果图理论中的干预算子。使用基本原理，即 DAG 中的 d-分离定义、识别因果效应的后门准则以及对撞节点性质（对对撞节点进行条件化会打开路径），分析在估计 $A$ 对 $Y$ 的因果效应时，对 $C$ 进行调整与不对 $C$ 进行调整的影响。\n\n选择正确描述“与不对 $C$ 进行调整相比，何时对 $C$ 进行调整会增加偏倚”的选项：\n\nA. 如果 $L_1$ 和 $L_2$ 相互独立，且 $A$ 和 $Y$ 之间没有其他开放的后门路径，那么 $C$ 默认情况下会阻断非因果路径 $A \\leftarrow L_1 \\rightarrow C \\leftarrow L_2 \\rightarrow Y$；对 $C$ 进行条件化会打开这条路径，并在 $A$ 和 $Y$ 之间引入虚假关联，从而相对于未调整的分析增加了偏倚。\n\nB. 如果 $L_1$ 和 $L_2$ 共享一个同样影响 $Y$ 的未测量共同原因 $U$，则不对 $C$ 进行调整会通过路径 $A \\leftarrow L_1 \\leftarrow U \\rightarrow L_2 \\rightarrow Y$ 产生偏倚，而对 $C$ 进行调整会阻断该偏倚路径，因此对 $C$ 的调整会减少偏倚。\n\nC. 对 $C$ 进行调整永远不会增加偏倚，因为 $C$ 不是 $A$ 或 $Y$ 的原因，并且控制非因果变量不能引入虚假关联。\n\nD. 在存在 $A$ 的测量误差的线性模型中，对 $C$ 进行条件化总是会减少偏倚，因为 $C$ 与 $A$ 和 $Y$ 都相关联，因此可以作为 $A$ 未测量部分的代理变量。",
            "solution": "问题陈述构成了使用有向无环图 (DAG)进行因果推断的一个有效练习。所提供的因果结构定义明确，并且问题是客观的，可以使用已建立的基本原理来回答。\n\n因果结构由以下关系集给出，可以表示为一个 DAG：\n-   $L_1 \\rightarrow A$ ($L_1$ 是 $A$ 的原因)\n-   $L_1 \\rightarrow C$ ($L_1$ 是 $C$ 的原因)\n-   $L_2 \\rightarrow C$ ($L_2$ 是 $C$ 的原因)\n-   $L_2 \\rightarrow Y$ ($L_2$ 是 $Y$ 的原因)\n-   没有箭头 $A \\rightarrow Y$，意味着 $A$ 对 $Y$ 没有直接或间接的因果效应。\n\n该 DAG 如下：\n$$ A \\leftarrow L_1 \\rightarrow C \\leftarrow L_2 \\rightarrow Y $$\n\n目标是估计 $A$ 对 $Y$ 的因果效应，定义为 $E[Y \\mid do(A=a)] - E[Y \\mid do(A=a')]$。$do(\\cdot)$ 算子表示一个干预，它设定 $A$ 的值，同时移除所有指向 $A$ 的传入箭头。由于图中没有从 $A$ 到 $Y$ 的有向路径（即，没有完全由从 $A$ 指向 $Y$ 的前向箭头组成的路径），$A$ 对 $Y$ 的真实因果效应为零。\n$$ E[Y \\mid do(A=a)] - E[Y \\mid do(A=a')] = 0 $$\n因此，在分析中发现的 $A$ 和 $Y$ 之间的任何统计关联都代表偏倚。偏倚的大小是估计出的非零关联的大小。\n\n为了确定一项分析是否会产生有偏估计，我们必须检查 $A$ 和 $Y$ 之间是否存在开放的非因果路径。非因果路径是指任何不是从 $A$ 到 $Y$ 的有向路径的路径。在这个 DAG 中，$A$ 和 $Y$ 之间唯一的路径是非因果路径 $A \\leftarrow L_1 \\rightarrow C \\leftarrow L_2 \\rightarrow Y$。\n\nd-分离的规则决定了路径是开放的还是被阻断的。如果一条路径包含一个未被条件化（或其任何后代未被条件化）的对撞节点，则该路径被阻断。对撞节点是路径上一个有两条箭头指向它的变量。\n\n**分析1：未对 $C$ 进行调整**\n\n我们检查路径 $A \\leftarrow L_1 \\rightarrow C \\leftarrow L_2 \\rightarrow Y$。在这条路径上，变量 $C$ 有两条箭头指向它（$L_1 \\rightarrow C$ 和 $L_2 \\rightarrow C$）。因此，$C$ 是这条路径上的一个对撞节点。\n\n在未调整的分析中，我们不对任何变量进行条件化。根据 d-分离的规则，如果一条路径包含一个对撞节点，而我们没有对该对撞节点或其任何后代进行条件化，那么该路径就是被阻断的。由于 $C$ 是 $A$ 和 $Y$ 之间唯一路径上的对撞节点，并且我们没有对 $C$ 进行条件化，所以这条路径被阻断。\n\n因为 $A$ 和 $Y$ 之间的所有路径都被阻断，所以 $A$ 和 $Y$ 是 d-分离的。这意味着 $A$ 和 $Y$ 在给定空集的情况下是条件独立的。\n$$ A \\perp\\!\\!\\!\\perp Y $$\n$A$ 和 $Y$ 之间估计的关联将为零。由于真实的因果效应是 $0$，未调整估计的偏倚是 $0 - 0 = 0$。未调整的分析是无偏的。\n\n**分析2：对 $C$ 进行调整**\n\n在这个分析中，我们对变量 $C$ 进行条件化。对一个对撞节点进行条件化会打开它先前阻断的路径。通过对 $C$ 进行调整，我们打开了路径 $A \\leftarrow L_1 \\rightarrow C \\leftarrow L_2 \\rightarrow Y$。\n\n暴露和结局之间的一条开放的非因果路径会引入虚假的统计关联。一种直观的理解方式是，对两个独立原因 $L_1$ 和 $L_2$ 的共同效应 $C$ 进行条件化，会使得 $L_1$ 和 $L_2$ 在 $C$ 的分层内变得相关。$L_1$ 和 $L_2$ 之间的这种新关联创建了一个从 $A$ 到 $Y$ 的信息流（因为 $A$ 是由 $L_1$ 引起的，而 $Y$ 是由 $L_2$ 引起的）。\n\n因为对 $C$ 进行条件化打开了一条非因果路径，所以 $A$ 和 $Y$ 之间估计的关联将非零。由于真实的因果效应是 $0$，调整后估计的偏倚是非零的。这种现象被称为对撞分层偏倚或 M-偏倚。\n\n**结论**\n\n比较这两种分析：\n- 未调整分析的偏倚 = $0$。\n- 调整后分析的偏倚 > $0$。\n\n因此，相对于不对 $C$ 进行调整，对 $C$ 进行调整会增加偏倚。它将偏倚引入了一个原本无偏的估计中。\n\n现在，我们来评估每个选项：\n\n**A. 如果 $L_1$ 和 $L_2$ 相互独立，且 $A$ 和 $Y$ 之间没有其他开放的后门路径，那么 $C$ 默认情况下会阻断非因果路径 $A \\leftarrow L_1 \\rightarrow C \\leftarrow L_2 \\rightarrow Y$；对 $C$ 进行条件化会打开这条路径，并在 $A$ 和 $Y$ 之间引入虚假关联，从而相对于未调整的分析增加了偏倚。**\n该陈述准确地总结了应用于给定 DAG 的 d-分离和对撞分层偏倚的原理。在基础图结构中（没有共同原因），假定了 $L_1$ 和 $L_2$ 的独立性。变量 $C$ 是 $A$ 和 $Y$ 之间唯一路径上的对撞节点，因此它默认情况下（在未调整的分析中）阻断了这条路径。对 $C$ 进行条件化会打开该路径，产生虚假关联，从而在原本没有偏倚的情况下引入了偏倚。这将偏倚从 $0$ 增加到一个非零值。\n**结论：正确。**\n\n**B. 如果 $L_1$ 和 $L_2$ 共享一个同样影响 $Y$ 的未测量共同原因 $U$，则不对 $C$ 进行调整会通过路径 $A \\leftarrow L_1 \\leftarrow U \\rightarrow L_2 \\rightarrow Y$ 产生偏倚，而对 $C$ 进行调整会阻断该偏倚路径，因此对 $C$ 的调整会减少偏倚。**\n这个选项引入了一个新的 DAG 结构，其中有一个未测量的混杂因素 $U$，满足 $U \\rightarrow L_1$、$U \\rightarrow L_2$ 和 $U \\rightarrow Y$。路径 $A \\leftarrow L_1 \\leftarrow U \\rightarrow Y$ 将是一条开放的后门路径，在未调整的分析中导致偏倚。然而，“对 $C$ 进行调整会阻断该偏倚路径”的说法是不正确的。$C$ 不是路径 $A \\leftarrow L_1 \\leftarrow U \\rightarrow Y$ 上的节点。因此，对 $C$ 进行条件化不能阻断这条路径。此外，对 $C$ 进行条件化仍然会打开对撞路径 $A \\leftarrow L_1 \\rightarrow C \\leftarrow L_2 \\rightarrow Y$，从而引入 *额外的* 偏倚。因此，在这种新情景下，对 $C$ 进行调整可能会增加总偏倚，而不是减少它。\n**结论：不正确。**\n\n**C. 对 $C$ 进行调整永远不会增加偏倚，因为 $C$ 不是 $A$ 或 $Y$ 的原因，并且控制非因果变量不能引入虚假关联。**\n该陈述包含了对因果推断的一个基本误解。虽然 $C$ 不是 $A$ 或 $Y$ 的原因，但“控制非因果变量不能引入虚假关联”的说法是错误的。这个错误的主要例子正是对撞分层偏倚，即对两个其他变量的共同效应（一个对撞节点）进行条件化，会在它们之间引入关联。在我们的问题中，$C$ 正是这样一个变量，对它进行条件化会引入偏倚。\n**结论：不正确。**\n\n**D. 在存在 $A$ 的测量误差的线性模型中，对 $C$ 进行条件化总是会减少偏倚，因为 $C$ 与 $A$ 和 $Y$ 都相关联，因此可以作为 $A$ 未测量部分的代理变量。**\n该选项引入了几个新条件（线性模型、测量误差），但其推理存在缺陷。对撞偏倚的根本问题是 DAG 的一个结构属性，不会因为改变模型类型或引入测量误差而消除。对 $C$ 进行条件化会打开非因果路径 $A \\leftarrow L_1 \\rightarrow C \\leftarrow L_2 \\rightarrow Y$，从而引入偏倚。虽然 $A$ 中的非差异性测量误差通常会使估计偏向于零，但这并不能抵消因对对撞节点进行条件化而产生的独立偏倚。在我们的案例中，真实效应为 $0$，测量误差偏倚也为 $0$，但对 $C$ 进行条件化会引入一个非零偏倚。因此，它增加了偏倚。“总是”减少偏倚的说法过于强烈且在此情景下是不正确的。将 $C$ 作为“代理变量”的理由是对该概念的误用；其作为对撞节点的结构性作用是这里的主导因素。\n**结论：不正确。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "正确识别混杂因素后，我们需要一种方法来调整它们的影响。G-公式，又称标准化方法，是一种直观而强大的技术。它回答了这样一个问题：“如果在整个人群中，每个个体都接受了某种处理，同时保持与原始人群相同的混杂因素分布，那么平均结局会是怎样？”这个练习  将引导您完成应用G-公式从分层数据中估计平均处理效应的数值计算步骤。",
            "id": "4575757",
            "problem": "您正在一个包含 $n=1000$ 名个体的观察性队列研究中，研究二元暴露 $A$ 对二元结局 $Y$ 的因果效应。您将使用基于单个测量的基线协变量 $L$ 的分层方法，通过代入式 $g$-公式来估计平均处理效应 (ATE)。假设以下识别条件成立：一致性、给定 $L$ 的条件下可交换性以及正性。协变量 $L$ 有三个水平，$L \\in \\{0,1,2\\}$。观察到的 $(L,A,Y)$ 的单元格计数如下：\n- 对于 $L=0$：$A=1$ 组中，$Y=1$ 有 $66$ 例，$Y=0$ 有 $154$ 例；$A=0$ 组中，$Y=1$ 有 $54$ 例，$Y=0$ 有 $126$ 例。\n- 对于 $L=1$：$A=1$ 组中，$Y=1$ 有 $56$ 例，$Y=0$ 有 $84$ 例；$A=0$ 组中，$Y=1$ 有 $84$ 例，$Y=0$ 有 $126$ 例。\n- 对于 $L=2$：$A=1$ 组中，$Y=1$ 有 $20$ 例，$Y=0$ 有 $30$ 例；$A=0$ 组中，$Y=1$ 有 $60$ 例，$Y=0$ 有 $140$ 例。\n\n从平均处理效应的潜在结局定义出发，利用识别条件来证明一个基于全期望定律的估计量的合理性。然后，仅使用所提供的计数，概述估计 $A=1$ 和 $A=0$ 下各层特定风险的数值步骤，获得 $L$ 的经验分布，并计算平均处理效应（风险差）的代入式 $g$-公式估计值。请用小数表示您的最终答案，并四舍五入至四位有效数字。",
            "solution": "### 因果框架与识别\n平均处理效应 (ATE) 是在潜在结局框架内定义的。令 $Y^a$ 表示一个个体在暴露水平被设定为 $a$ 时（可能与事实相反）本应观察到的潜在结局。对于二元结局，ATE 是风险差 (RD)：\n$$ATE_{RD} = E[Y^{a=1}] - E[Y^{a=0}] = P(Y^{a=1}=1) - P(Y^{a=0}=1)$$\n这个因果量是不能直接观察到的。我们必须使用给定的识别假设，用可观察数据的概率来表示 ATE。\n\n关键步骤是根据协变量 $L$ 进行标准化。根据全期望定律，我们可以将边际潜在结局概率写成各分层特定潜在结局概率的加权平均值：\n$$P(Y^a=1) = \\sum_{l=0}^{2} P(Y^a=1 | L=l) P(L=l)$$\n现在，我们应用识别假设：\n1.  **条件可交换性**：在给定协变量 $L$ 的条件下，暴露分配 $A$ 与潜在结局 $Y^a$ 独立。形式上，$Y^a \\perp A | L$ 对于 $a \\in \\{0, 1\\}$ 成立。这个假设允许我们写出：\n    $$P(Y^a=1 | L=l) = P(Y^a=1 | A=a, L=l)$$\n2.  **一致性**：对于一个接受了暴露 $A=a$ 的个体，其观察到的结局 $Y$ 等于其潜在结局 $Y^a$。形式上，如果 $A=a$，则 $Y=Y^a$。这使我们能够将潜在结局与观察到的结局联系起来：\n    $$P(Y^a=1 | A=a, L=l) = P(Y=1 | A=a, L=l)$$\n结合这些步骤，我们可以用可观察的量来表示潜在结局概率：\n$$P(Y^a=1) = \\sum_{l=0}^{2} P(Y=1 | A=a, L=l) P(L=l)$$\n这被称为 $g$-公式或标准化公式。因此，ATE 可以被识别为：\n$$ATE_{RD} = \\sum_{l=0}^{2} P(Y=1 | A=1, L=l) P(L=l) - \\sum_{l=0}^{2} P(Y=1 | A=0, L=l) P(L=l)$$\n$$ATE_{RD} = \\sum_{l=0}^{2} \\left[ P(Y=1 | A=1, L=l) - P(Y=1 | A=0, L=l) \\right] P(L=l)$$\n\n3. **正性**：对于所有的 $a,l$，$P(A=a|L=l) > 0$ 确保了条件概率 $P(Y=1|A=a,L=l)$ 是良定的，并且可以从数据中估计。\n\n### 代入估计\n我们通过代入 $g$-公式中每个组成部分的经验估计值来估计 ATE。\n\n**步骤 1：估计协变量的边际分布，$\\hat{P}(L=l)$**\n首先，我们计算 $L$ 的每个分层中的个体数量。设 $N_l$ 为 $L=l$ 的个体数量。\n- $N_0 = 66 + 154 + 54 + 126 = 400$\n- $N_1 = 56 + 84 + 84 + 126 = 350$\n- $N_2 = 20 + 30 + 60 + 140 = 250$\n总样本量为 $n = N_0 + N_1 + N_2 = 400 + 350 + 250 = 1000$。\n经验概率为：\n- $\\hat{P}(L=0) = \\frac{N_0}{n} = \\frac{400}{1000} = 0.4$\n- $\\hat{P}(L=1) = \\frac{N_1}{n} = \\frac{350}{1000} = 0.35$\n- $\\hat{P}(L=2) = \\frac{N_2}{n} = \\frac{250}{1000} = 0.25$\n\n**步骤 2：估计各层特定的风险，$\\hat{P}(Y=1 | A=a, L=l)$**\n我们计算在由 $(L, A)$ 定义的每个分层中，结局为 ($Y=1$) 的个体比例。\n- 对于 $L=0$：\n  - $\\hat{P}(Y=1 | A=1, L=0) = \\frac{N(L=0, A=1, Y=1)}{N(L=0, A=1)} = \\frac{66}{66+154} = \\frac{66}{220} = 0.3$\n  - $\\hat{P}(Y=1 | A=0, L=0) = \\frac{N(L=0, A=0, Y=1)}{N(L=0, A=0)} = \\frac{54}{54+126} = \\frac{54}{180} = 0.3$\n- 对于 $L=1$：\n  - $\\hat{P}(Y=1 | A=1, L=1) = \\frac{N(L=1, A=1, Y=1)}{N(L=1, A=1)} = \\frac{56}{56+84} = \\frac{56}{140} = 0.4$\n  - $\\hat{P}(Y=1 | A=0, L=1) = \\frac{N(L=1, A=0, Y=1)}{N(L=1, A=0)} = \\frac{84}{84+126} = \\frac{84}{210} = 0.4$\n- 对于 $L=2$：\n  - $\\hat{P}(Y=1 | A=1, L=2) = \\frac{N(L=2, A=1, Y=1)}{N(L=2, A=1)} = \\frac{20}{20+30} = \\frac{20}{50} = 0.4$\n  - $\\hat{P}(Y=1 | A=0, L=2) = \\frac{N(L=2, A=0, Y=1)}{N(L=2, A=0)} = \\frac{60}{60+140} = \\frac{60}{200} = 0.3$\n\n**步骤 3：计算标准化风险和 ATE 估计值**\n首先，我们计算如果所有人都暴露 ($A=1$) 时的标准化风险：\n$$\\hat{P}(Y^{a=1}=1) = \\sum_{l=0}^{2} \\hat{P}(Y=1 | A=1, L=l) \\hat{P}(L=l)$$\n$$\\hat{P}(Y^{a=1}=1) = (0.3)(0.4) + (0.4)(0.35) + (0.4)(0.25)$$\n$$\\hat{P}(Y^{a=1}=1) = 0.12 + 0.14 + 0.10 = 0.36$$\n接下来，我们计算如果所有人都没有暴露 ($A=0$) 时的标准化风险：\n$$\\hat{P}(Y^{a=0}=1) = \\sum_{l=0}^{2} \\hat{P}(Y=1 | A=0, L=l) \\hat{P}(L=l)$$\n$$\\hat{P}(Y^{a=0}=1) = (0.3)(0.4) + (0.4)(0.35) + (0.3)(0.25)$$\n$$\\hat{P}(Y^{a=0}=1) = 0.12 + 0.14 + 0.075 = 0.335$$\n最后，ATE（风险差）的代入估计值是这些标准化风险之间的差值：\n$$\\widehat{ATE}_{RD} = \\hat{P}(Y^{a=1}=1) - \\hat{P}(Y^{a=0}=1)$$\n$$\\widehat{ATE}_{RD} = 0.36 - 0.335 = 0.025$$\n题目要求答案四舍五入到四位有效数字。为了用四位有效数字表示这个结果，我们在后面添加零。\n$$\\widehat{ATE}_{RD} = 0.02500$$",
            "answer": "$$\\boxed{0.02500}$$"
        },
        {
            "introduction": "逆概率加权（IPW）是除标准化方法外，另一种用于混杂因素调整的方法。该方法通过对个体进行加权，创建一个“伪人群”，在这个伪人群中，混杂因素与暴露之间的关联被打破，从而模拟了随机对照试验的效果。这个练习  提供了计算倾向得分、推导相应权重并使用它们来估计平均处理效应的实践机会。",
            "id": "4575753",
            "problem": "一项观察性队列研究评估了单剂量流感疫苗接种对一个月后测量的C反应蛋白（用 $Y$ 表示，单位为毫克/升）的因果效应。处理是一个指示变量 $A \\in \\{0,1\\}$，其中 $A=1$ 表示已接种疫苗，否则 $A=0$。一个单一基线协变量 $L \\in \\{0,1\\}$ 对年龄组进行编码，其中 $L=1$ 表示年龄 $\\geq 50$ 岁， $L=0$ 表示年龄 $ 50$ 岁。样本包含 $8$ 个个体，其观测数据 $(L_i, A_i, Y_i)$ 如下：\n\n- 个体 1: $(0, 1, 2.1)$\n- 个体 2: $(0, 1, 1.8)$\n- 个体 3: $(0, 1, 2.5)$\n- 个体 4: $(0, 0, 3.0)$\n- 个体 5: $(0, 0, 2.7)$\n- 个体 6: $(1, 1, 1.9)$\n- 个体 7: $(1, 0, 3.3)$\n- 个体 8: $(1, 0, 3.5)$\n\n假设以下数据生成条件成立：一致性、正值性和给定 $L$ 的条件可交换性。使用逻辑斯谛回归将处理分配 $\\logit\\{\\Pr(A=1 \\mid L)\\}$ 建模为 $L$ 的线性函数。\n\n任务：\n- 使用样本拟合 $A$ 对 $L$ 的逻辑斯谛回归，并获得 $L=0$ 和 $L=1$ 的拟合倾向得分 $e(L)=\\Pr(A=1 \\mid L)$。\n- 对每个个体，计算处理组个体（$A=1$）的逆概率权重 $1/e(L)$ 和对照组个体（$A=0$）的逆概率权重 $1/\\{1-e(L)\\}$。\n- 使用这些权重，计算平均处理效应 (ATE) 的逆概率加权估计值。ATE定义为处理下的平均潜在结果与对照下的平均潜在结果之差，单位为毫克/升。\n\n将您的最终ATE估计值表示为以毫克/升为单位的精确分数（不要四舍五入）。",
            "solution": "我们从因果定义和假设开始。平均处理效应 (ATE) 定义为 $E[Y(1) - Y(0)]$，其中 $Y(1)$ 和 $Y(0)$ 分别是处理和对照下的潜在结果。在一致性、正值性和给定 $L$ 的条件可交换性假设下，我们可以从观测数据中识别ATE。一种常见的方法是逆概率加权 (IPW)，即我们通过接受所观察到的处理的概率的倒数来对观察结果进行加权。倾向得分是 $e(L) = \\Pr(A=1 \\mid L)$。ATE的 Horvitz–Thompson IPW 估计量是\n$$\n\\widehat{\\text{ATE}} \\;=\\; \\frac{1}{n} \\sum_{i=1}^{n} \\left( \\frac{A_i Y_i}{e(L_i)} - \\frac{(1-A_i) Y_i}{1 - e(L_i)} \\right),\n$$\n在我们的样本中，$n=8$。\n\n为了获得 $e(L)$，我们使用以下模型拟合 $A$ 对 $L$ 的逻辑斯谛回归：\n$$\n\\logit\\{\\Pr(A=1 \\mid L)\\} \\;=\\; \\beta_0 + \\beta_1 L,\n$$\n其中 $\\logit(p) = \\ln\\left(\\frac{p}{1-p}\\right)$ 且 $L \\in \\{0,1\\}$。因为 $L$ 是二元变量，逻辑斯谛回归导出两个不同的线性预测变量：$L=0$ 时为 $\\eta_0 = \\beta_0$， $L=1$ 时为 $\\eta_1 = \\beta_0 + \\beta_1$，因此有两个概率 $p_0 = \\expit(\\eta_0)$ 和 $p_1 = \\expit(\\eta_1)$，其中 $\\expit(x) = \\frac{1}{1+\\exp(-x)}$。\n\n每个层 $L=\\ell$ 的分组伯努利对数似然是\n$$\n\\ell(p_{\\ell}) \\;=\\; \\sum_{i:L_i=\\ell} \\left\\{ A_i \\ln(p_{\\ell}) + (1-A_i)\\ln(1 - p_{\\ell}) \\right\\},\n$$\n因此得分方程 $\\frac{\\partial \\ell(p_{\\ell})}{\\partial p_{\\ell}} = 0$ 得到\n$$\np_{\\ell} \\;=\\; \\frac{\\sum_{i:L_i=\\ell} A_i}{\\sum_{i:L_i=\\ell} 1},\n$$\n也就是说，层特异性概率的最大似然估计 (MLE) 等于该层中观察到的处理比例。因此，MLE 满足\n$$\n\\hat{p}_0 \\;=\\; \\Pr(A=1 \\mid L=0) \\;=\\; \\frac{\\text{层 }L=0 \\text{ 中的处理组数量}}{\\text{层 }L=0 \\text{ 中的总数}}, \\quad\n\\hat{p}_1 \\;=\\; \\Pr(A=1 \\mid L=1) \\;=\\; \\frac{\\text{层 }L=1 \\text{ 中的处理组数量}}{\\text{层 }L=1 \\text{ 中的总数}},\n$$\n以及\n$$\n\\hat{\\beta}_0 \\;=\\; \\logit(\\hat{p}_0), \\qquad \\hat{\\beta}_1 \\;=\\; \\logit(\\hat{p}_1) - \\logit(\\hat{p}_0).\n$$\n\n计算各层的计数：\n- 对于 $L=0$：有 $5$ 个个体（索引 $1$ 到 $5$），其中 $3$ 个接受了处理（个体 $1, 2, 3$ 的 $A=1$），所以\n$$\n\\hat{p}_0 \\;=\\; \\frac{3}{5} \\;=\\; 0.6.\n$$\n- 对于 $L=1$：有 $3$ 个个体（索引 $6$ 到 $8$），其中 $1$ 个接受了处理（个体 $6$ 的 $A=1$），所以\n$$\n\\hat{p}_1 \\;=\\; \\frac{1}{3} \\;=\\; 0.\\overline{3}.\n$$\n\n因此，拟合的倾向得分是\n$$\ne(0) \\;=\\; \\hat{p}_0 \\;=\\; \\frac{3}{5}, \\qquad e(1) \\;=\\; \\hat{p}_1 \\;=\\; \\frac{1}{3}.\n$$\n\n接下来，计算逆概率权重。对于处理组观测（$A=1$），权重是 $1/e(L)$；对于对照组观测（$A=0$），权重是 $1/\\{1-e(L)\\}$：\n- 对于 $L=0$：处理组权重为 $1/e(0) = \\frac{1}{3/5} = \\frac{5}{3}$；对照组权重为 $1/\\{1-e(0)\\} = \\frac{1}{1-3/5} = \\frac{1}{2/5} = \\frac{5}{2}$。\n- 对于 $L=1$：处理组权重为 $1/e(1) = \\frac{1}{1/3} = 3$；对照组权重为 $1/\\{1-e(1)\\} = \\frac{1}{1-1/3} = \\frac{1}{2/3} = \\frac{3}{2}$。\n\n现在计算 Horvitz–Thompson 估计量的各组成部分。令\n$$\nS_{\\text{treat}} \\;=\\; \\sum_{i=1}^{n} \\frac{A_i Y_i}{e(L_i)}, \\qquad\nS_{\\text{control}} \\;=\\; \\sum_{i=1}^{n} \\frac{(1-A_i) Y_i}{1 - e(L_i)}.\n$$\n那么\n$$\n\\widehat{\\text{ATE}} \\;=\\; \\frac{1}{n} \\left( S_{\\text{treat}} - S_{\\text{control}} \\right).\n$$\n\n通过对处理组个体求和来计算 $S_{\\text{treat}}$：\n- 个体 $1$：$L=0$, $A=1$, $Y=2.1$，贡献 $= 2.1 \\times \\frac{5}{3} = \\frac{21}{10} \\times \\frac{5}{3} = \\frac{105}{30} = 3.5$。\n- 个体 $2$：$L=0$, $A=1$, $Y=1.8$，贡献 $= 1.8 \\times \\frac{5}{3} = \\frac{9}{5} \\times \\frac{5}{3} = \\frac{45}{15} = 3.0$。\n- 个体 $3$：$L=0$, $A=1$, $Y=2.5$，贡献 $= 2.5 \\times \\frac{5}{3} = \\frac{5}{2} \\times \\frac{5}{3} = \\frac{25}{6}$。\n- 个体 $6$：$L=1$, $A=1$, $Y=1.9$，贡献 $= 1.9 \\times 3 = \\frac{19}{10} \\times 3 = \\frac{57}{10}$。\n\n因此，\n$$\nS_{\\text{treat}} \\;=\\; 3.5 + 3.0 + \\frac{25}{6} + \\frac{57}{10} \\;=\\; 6.5 + \\frac{125}{30} + \\frac{171}{30} \\;=\\; \\frac{195}{30} + \\frac{296}{30} \\;=\\; \\frac{491}{30}.\n$$\n\n通过对对照组个体求和来计算 $S_{\\text{control}}$：\n- 个体 $4$：$L=0$, $A=0$, $Y=3.0$，贡献 $= 3.0 \\times \\frac{5}{2} = \\frac{3}{1} \\times \\frac{5}{2} = \\frac{15}{2}$。\n- 个体 $5$：$L=0$, $A=0$, $Y=2.7$，贡献 $= 2.7 \\times \\frac{5}{2} = \\frac{27}{10} \\times \\frac{5}{2} = \\frac{135}{20}$。\n- 个体 $7$：$L=1$, $A=0$, $Y=3.3$，贡献 $= 3.3 \\times \\frac{3}{2} = \\frac{33}{10} \\times \\frac{3}{2} = \\frac{99}{20}$。\n- 个体 $8$：$L=1$, $A=0$, $Y=3.5$，贡献 $= 3.5 \\times \\frac{3}{2} = \\frac{35}{10} \\times \\frac{3}{2} = \\frac{105}{20}$。\n\n因此，\n$$\nS_{\\text{control}} \\;=\\; \\frac{15}{2} + \\frac{135}{20} + \\frac{99}{20} + \\frac{105}{20}\n\\;=\\; \\frac{150}{20} + \\frac{135}{20} + \\frac{99}{20} + \\frac{105}{20} \\;=\\; \\frac{489}{20}.\n$$\n\n最后，当 $n=8$ 时，IPW ATE 估计值为\n$$\n\\widehat{\\text{ATE}} \\;=\\; \\frac{1}{8} \\left( \\frac{491}{30} - \\frac{489}{20} \\right)\n\\;=\\; \\frac{1}{8} \\left( \\frac{982}{60} - \\frac{1467}{60} \\right)\n\\;=\\; \\frac{1}{8} \\left( -\\frac{485}{60} \\right)\n\\;=\\; \\frac{1}{8} \\left( -\\frac{97}{12} \\right)\n\\;=\\; -\\frac{97}{96}.\n$$\n这是一个以毫克/升为单位的精确分数。负号表示，在为调整 $L$ 的混杂效应进行重新加权后，在该样本中，疫苗接种与C反应蛋白平均水平降低 $\\frac{97}{96}$ 毫克/升相关。",
            "answer": "$$\\boxed{-\\frac{97}{96}}$$"
        }
    ]
}