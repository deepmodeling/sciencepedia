{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握伯克森偏倚，我们必须超越概念图，用数学的语言精确地描述其机制。第一个练习将挑战你从第一性原理出发，推导出因对撞因子进行条件限制而产生的虚假关联。通过推导条件协方差的公式，你将证明两个独立的变量为何会在一个被选择的子群体中呈现出负相关性 。",
            "id": "4573105",
            "problem": "考虑一个源总体，其中两个二元健康指标 $X$ 和 $Y$ 分别代表是否存在两种不同的疾病。假设在源总体中，$X$ 和 $Y$ 相互独立，其概率分别为 $P(X=1)=p$ 和 $P(Y=1)=q$，其中 $0  p  1$ 且 $0  q  1$。一个选择变量 $S$ 被定义为 $S=1$ 当且仅当个体至少患有其中一种疾病（即 $X=1$ 或 $Y=1$）。您的任务是推导出在选定子群体（$S=1$）中，$X$ 和 $Y$ 之间的条件协方差 $\\mathrm{Cov}(X,Y \\mid S=1)$ 的表达式。",
            "solution": "为了推导条件协方差 $\\mathrm{Cov}(X,Y \\mid S=1)$，我们使用定义：\n$$ \\mathrm{Cov}(X,Y \\mid S=1) = \\mathbb{E}[XY \\mid S=1] - \\mathbb{E}[X \\mid S=1]\\,\\mathbb{E}[Y \\mid S=1] $$\n\n首先，计算选择事件 $S=1$ 的概率。$S=1$ 当且仅当 $X=1$ 或 $Y=1$。其补集 $S=0$ 发生当且仅当 $X=0$ 且 $Y=0$。\n$$ P(S=1) = 1 - P(S=0) = 1 - P(X=0, Y=0) $$\n由于 $X$ 和 $Y$ 独立，\n$$ P(S=1) = 1 - P(X=0)P(Y=0) = 1 - (1-p)(1-q) = p+q-pq $$\n我们用 $P_S$ 表示这个概率。\n\n接下来，计算条件期望：\n1.  $\\mathbb{E}[X \\mid S=1] = P(X=1 \\mid S=1) = \\frac{P(X=1 \\cap \\{S=1\\})}{P(S=1)}$\n    事件 $\\{X=1 \\cap \\{S=1\\}\\}$ 等价于 $\\{X=1\\}$，因为如果 $X=1$，$S=1$ 的条件自动满足。\n    因此，$\\mathbb{E}[X \\mid S=1] = \\frac{P(X=1)}{P_S} = \\frac{p}{p+q-pq}$。\n    根据对称性，$\\mathbb{E}[Y \\mid S=1] = \\frac{q}{p+q-pq}$。\n\n2.  $\\mathbb{E}[XY \\mid S=1] = P(X=1, Y=1 \\mid S=1) = \\frac{P(\\{X=1, Y=1\\} \\cap \\{S=1\\})}{P(S=1)}$\n    事件 $\\{\\{X=1, Y=1\\} \\cap \\{S=1\\}\\}$ 等价于 $\\{X=1, Y=1\\}$。\n    因此，$\\mathbb{E}[XY \\mid S=1] = \\frac{P(X=1, Y=1)}{P_S} = \\frac{pq}{p+q-pq}$。\n\n最后，将这些项代入协方差公式：\n$$ \\mathrm{Cov}(X,Y \\mid S=1) = \\frac{pq}{P_S} - \\left(\\frac{p}{P_S}\\right) \\left(\\frac{q}{P_S}\\right) = \\frac{pqP_S - pq}{P_S^2} = \\frac{pq(P_S-1)}{P_S^2} $$\n代入 $P_S-1 = (p+q-pq) - 1 = -(1-p-q+pq) = -(1-p)(1-q)$。\n最终得到：\n$$ \\mathrm{Cov}(X,Y \\mid S=1) = \\frac{-pq(1-p)(1-q)}{(p+q-pq)^2} $$",
            "answer": "$$\\boxed{\\frac{-pq(1-p)(1-q)}{(p+q-pq)^2}}$$"
        },
        {
            "introduction": "在推导出通用公式后，将其应用于具体的数值情景中，可以帮助我们直观地观察其效应。在本练习中，你将使用两个独立风险因素的特定患病率来量化伯克森偏倚的程度。通过计算和比较相关的条件概率，你将直接观察到在被选择的群体中，了解一个因素的状态如何改变另一个因素的概率，从而证实它们之间产生了诱导性依赖 。",
            "id": "4573130",
            "problem": "考虑人群中的两个二元风险因子 $X \\in \\{0,1\\}$ 和 $Y \\in \\{0,1\\}$，其人群流行率分别为 $P(X=1)=0.2$ 和 $P(Y=1)=0.3$。假设在人群中，$X$ 和 $Y$ 是边际独立的，意即 $P(X=1, Y=1)=P(X=1)P(Y=1)$。假设进入临床登记库的选择由一个二元指示变量 $S \\in \\{0,1\\}$ 编码，遵循确定性规则：当且仅当 $X=1$ 或 $Y=1$ 时，$S=1$；否则 $S=0$。这种设置模拟了对撞因子条件化，当分析仅限于选定的子集 $S=1$ 时，可能导致 Berkson 偏倚。\n\n仅使用条件概率的定义和给定信息，计算 $P(X=1 \\mid Y=1, S=1)$ 和 $P(X=1 \\mid S=1)$，并解释条件独立性 $X \\perp Y \\mid S=1$ 是否成立。作为您最终报告的数值，请计算差值\n$$\\Delta = P(X=1 \\mid S=1) - P(X=1 \\mid Y=1, S=1),$$\n并将您的答案表示为精确分数。无需四舍五入，也不涉及单位。",
            "solution": "问题陈述已经过验证，内容自洽，其科学基础根植于概率论和流行病学，且问题提法明确。所有必需信息均已给出，目标清晰。因此，我们可以着手进行正式解答。\n\n问题要求我们计算与二元风险因子 $X$ 和 $Y$ 以及选择变量 $S$ 相关的两个条件概率之间的差值。我们已知以下流行率和条件：\n- 风险因子 $X$ 的流行率为 $P(X=1) = 0.2 = \\frac{1}{5}$。因此，$P(X=0) = 1 - \\frac{1}{5} = \\frac{4}{5}$。\n- 风险因子 $Y$ 的流行率为 $P(Y=1) = 0.3 = \\frac{3}{10}$。因此，$P(Y=0) = 1 - \\frac{3}{10} = \\frac{7}{10}$。\n- 风险因子 $X$ 和 $Y$ 在人群中是边际独立的，这意味着对于任何 $i, j \\in \\{0,1\\}$，都有 $P(X=i, Y=j) = P(X=i)P(Y=j)$。\n- 计入登记库（用 $S=1$ 表示）的条件是当且仅当 $X=1$ 或 $Y=1$。这是一个逻辑“或”运算，可以写成事件 $S=1$ 等价于事件 $\\{X=1\\} \\cup \\{Y=1\\}$。因此，事件 $S=0$ 等价于 $\\{X=0\\} \\cap \\{Y=0\\}$。\n\n首先，我们利用独立性假设，建立人群中 $X$ 和 $Y$ 的联合概率分布。\n- $P(X=1, Y=1) = P(X=1)P(Y=1) = \\frac{1}{5} \\times \\frac{3}{10} = \\frac{3}{50}$。\n- $P(X=1, Y=0) = P(X=1)P(Y=0) = \\frac{1}{5} \\times \\frac{7}{10} = \\frac{7}{50}$。\n- $P(X=0, Y=1) = P(X=0)P(Y=1) = \\frac{4}{5} \\times \\frac{3}{10} = \\frac{12}{50} = \\frac{6}{25}$。\n- $P(X=0, Y=0) = P(X=0)P(Y=0) = \\frac{4}{5} \\times \\frac{7}{10} = \\frac{28}{50} = \\frac{14}{25}$。\n这些概率之和为 $\\frac{3}{50} + \\frac{7}{50} + \\frac{12}{50} + \\frac{28}{50} = \\frac{50}{50} = 1$，符合预期。\n\n接下来，我们确定被选入登记库的概率 $P(S=1)$。事件 $S=1$ 是事件 $S=0$ 的补集，而事件 $S=0$ 仅在 $X=0$ 且 $Y=0$ 时发生。\n$$P(S=1) = 1 - P(S=0) = 1 - P(X=0, Y=0) = 1 - \\frac{14}{25} = \\frac{11}{25}$$\n\n现在我们可以计算所需的两个条件概率。\n\n1.  计算 $P(X=1 \\mid Y=1, S=1)$。\n根据条件概率的定义：\n$$P(X=1 \\mid Y=1, S=1) = \\frac{P(X=1, Y=1, S=1)}{P(Y=1, S=1)}$$\n我们来分析表达式中的事件。选择规则是 $S=1 \\iff (X=1 \\text{ 或 } Y=1)$。如果给定 $Y=1$，则 $S=1$ 的条件自动满足。因此，事件 $\\{Y=1, S=1\\}$ 与事件 $\\{Y=1\\}$ 相同。类似地，事件 $\\{X=1, Y=1, S=1\\}$ 与 $\\{X=1, Y=1\\}$ 相同。表达式简化为：\n$$P(X=1 \\mid Y=1, S=1) = \\frac{P(X=1, Y=1)}{P(Y=1)} = P(X=1 \\mid Y=1)$$\n由于在总人口中 $X$ 和 $Y$ 是独立的，所以 $P(X=1 \\mid Y=1) = P(X=1)$。\n因此，\n$$P(X=1 \\mid Y=1, S=1) = P(X=1) = \\frac{1}{5}$$\n\n2.  计算 $P(X=1 \\mid S=1)$。\n根据条件概率的定义：\n$$P(X=1 \\mid S=1) = \\frac{P(X=1, S=1)}{P(S=1)}$$\n事件 $\\{X=1, S=1\\}$ 意味着 $X=1$ 且发生了选择。如果给定 $X=1$，选择的条件（$X=1$ 或 $Y=1$）自动满足。因此，事件 $\\{X=1, S=1\\}$ 与事件 $\\{X=1\\}$ 相同。\n表达式简化为：\n$$P(X=1 \\mid S=1) = \\frac{P(X=1)}{P(S=1)}$$\n代入已知值：\n$$P(X=1 \\mid S=1) = \\frac{1/5}{11/25} = \\frac{1}{5} \\times \\frac{25}{11} = \\frac{5}{11}$$\n\n问题还问到条件独立性 $X \\perp Y \\mid S=1$ 是否成立。该条件成立当且仅当 $P(X=1 \\mid Y=1, S=1) = P(X=1 \\mid S=1)$。我们已经发现 $P(X=1 \\mid Y=1, S=1) = \\frac{1}{5}$ 且 $P(X=1 \\mid S=1) = \\frac{5}{11}$。由于 $\\frac{1}{5} \\neq \\frac{5}{11}$ （即 $0.2 \\neq 0.\\overline{45}$），变量 $X$ 和 $Y$ 在给定 $S=1$ 的条件下不是条件独立的。事实上，它们变成了负相关（$P(X=1 \\mid Y=1, S=1)  P(X=1 \\mid S=1)$）。这种由对共同效应（一个“对撞因子”）进行条件化而引起的伪关联是 Berkson 偏倚的一个典型例子。\n\n最后，我们计算所要求的差值 $\\Delta$。\n$$\\Delta = P(X=1 \\mid S=1) - P(X=1 \\mid Y=1, S=1)$$\n$$\\Delta = \\frac{5}{11} - \\frac{1}{5}$$\n为作减法，我们找到一个公分母，即 $11 \\times 5 = 55$。\n$$\\Delta = \\frac{5 \\times 5}{11 \\times 5} - \\frac{1 \\times 11}{5 \\times 11} = \\frac{25}{55} - \\frac{11}{55} = \\frac{25 - 11}{55} = \\frac{14}{55}$$\n差值 $\\Delta$ 是 $\\frac{14}{55}$。",
            "answer": "$$\\boxed{\\frac{14}{55}}$$"
        },
        {
            "introduction": "理论推导为我们提供了基础，而计算模拟则为建立直觉和验证我们的发现提供了一种强有力的方法。本练习将指导你创建一个虚拟总体，应用经典的伯克森偏倚选择规则，并根据经验测量由此产生的关联。通过将你的模拟结果与之前推导的理论公式进行比较，你将在抽象方程与可触摸的数据之间架起一座桥梁，这是现代流行病学中一项至关重要的技能 。",
            "id": "4573152",
            "problem": "您需要实现一个程序，使用二元选择机制来经验性地展示 Berkson 偏倚，并验证在对撞因子上取条件时产生的负条件协方差。考虑两个独立的二元变量 $X$ 和 $Y$，其中 $X \\sim \\mathrm{Bernoulli}(p_X)$ 且 $Y \\sim \\mathrm{Bernoulli}(p_Y)$。定义一个选择指示变量 $S \\in \\{0,1\\}$，其规则为：$S=1$ 当且仅当 $X=1$ 或 $Y=1$。您的任务如下，且仅能基于基本的概率定义。\n\n1. 使用独立性、条件概率和协方差的定义，推导出条件协方差 $\\mathrm{Cov}(X,Y \\mid S=1)$ 关于 $p_X$ 和 $p_Y$ 的闭式表达式。唯一允许的出发点是：\n   - 独立性：对于所有 $x \\in \\{0,1\\}$ 和 $y \\in \\{0,1\\}$，$P(X=x, Y=y) = P(X=x)\\,P(Y=y)$。\n   - 条件概率：当 $P(B) \\neq 0$ 时，$P(A \\mid B) = \\dfrac{P(A \\cap B)}{P(B)}$。\n   - 二元变量的期望和协方差：$\\mathbb{E}[X \\mid S=1] = P(X=1 \\mid S=1)$，$\\mathbb{E}[XY \\mid S=1] = P(X=1,Y=1 \\mid S=1)$，以及 $\\mathrm{Cov}(X,Y \\mid S=1) = \\mathbb{E}[XY \\mid S=1] - \\mathbb{E}[X \\mid S=1]\\,\\mathbb{E}[Y \\mid S=1]$。\n\n2. 实现一个模拟程序。对于给定的 $(p_X, p_Y)$，该程序生成 $N$ 个独立的样本对 $(X_i,Y_i)$，其中 $X_i \\sim \\mathrm{Bernoulli}(p_X)$ 且 $Y_i \\sim \\mathrm{Bernoulli}(p_Y)$，然后应用选择规则 $S_i=1$ 当且仅当 $X_i=1$ 或 $Y_i=1$，并计算经验条件协方差\n   $$\\widehat{\\mathrm{Cov}}(X,Y \\mid S=1) = \\widehat{\\mathbb{E}}[XY \\mid S=1] - \\widehat{\\mathbb{E}}[X \\mid S=1]\\;\\widehat{\\mathbb{E}}[Y \\mid S=1],$$\n   其中帽子符号表示在 $S=1$ 的子集上计算的样本均值。\n\n3. 对于下面的每个测试用例，计算经验估计值与理论值之间的绝对差：\n   $$\\left|\\widehat{\\mathrm{Cov}}(X,Y \\mid S=1) - \\mathrm{Cov}(X,Y \\mid S=1)\\right|.$$\n\n实现要求：\n- 每个测试用例使用 $N=2{,}000{,}000$ 个模拟对。\n- 使用固定的伪随机种子 $20231111$ 以确保结果可复现。\n- 如果 $P(S=1)=0$，条件协方差未定义，程序应能优雅地处理这种情况；然而，所提供的测试套件中不包含此类情况。\n\n测试套件（每个项目指定 $(p_X, p_Y)$）：\n- $(p_X, p_Y) = (0.5, 0.5)$\n- $(p_X, p_Y) = (0.1, 0.1)$\n- $(p_X, p_Y) = (0.9, 0.9)$\n- $(p_X, p_Y) = (0.0, 0.2)$\n- $(p_X, p_Y) = (1.0, 0.3)$\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个由5个浮点数组成的列表，每个浮点数对应一个测试用例的上述绝对差，顺序与列表顺序相同。每个浮点数应四舍五入到6位小数。输出必须是单行，格式严格为方括号括起来的逗号分隔列表，例如：$[0.123456,0.000001,0.010000,0.000000,0.500000]$。",
            "solution": "用户提供的问题经评估是有效的。该问题具有坚实的概率论科学基础，提法得当，提供了所有必要信息，且表述客观。任务是通过理论推导和数值模拟来展示 Berkson 偏倚。\n\n### 第 1 部分：条件协方差的理论推导\n\n该问题要求推导条件协方差 $\\mathrm{Cov}(X,Y \\mid S=1)$ 的闭式表达式，其中 $X \\sim \\mathrm{Bernoulli}(p_X)$ 和 $Y \\sim \\mathrm{Bernoulli}(p_Y)$ 是独立的二元随机变量，选择事件为 $S=1$ 当且仅当 $X=1$ 或 $Y=1$。\n\n题目中提供的条件协方差定义为：\n$$\n\\mathrm{Cov}(X,Y \\mid S=1) = \\mathbb{E}[XY \\mid S=1] - \\mathbb{E}[X \\mid S=1]\\,\\mathbb{E}[Y \\mid S=1]\n$$\n我们将计算右侧的每一项。对于二元变量，期望等于该变量为1的概率。\n\n**1. 条件事件的概率**\n\n条件事件是 $S=1$，它对应于逻辑析取 $(X=1) \\lor (Y=1)$。其概率 $P(S=1)$ 使用补集法则计算。\n事件 $S=0$ 发生当且仅当 $X=0$ 且 $Y=0$。\n$$\nP(S=0) = P(X=0, Y=0)\n$$\n由于 $X$ 和 $Y$ 的独立性，我们有：\n$$\nP(X=0, Y=0) = P(X=0)P(Y=0) = (1-p_X)(1-p_Y)\n$$\n因此，事件 $S=1$ 的概率是：\n$$\nP(S=1) = 1 - P(S=0) = 1 - (1-p_X)(1-p_Y) = 1 - (1 - p_X - p_Y + p_X p_Y) = p_X + p_Y - p_X p_Y\n$$\n为使条件概率有良好定义，我们必须有 $P(S=1) \\neq 0$。对于所有提供的测试用例，这一点都成立，因为只有当 $p_X=0$ 且 $p_Y=0$ 时，该概率才为 $0$。\n\n**2. $X$ 和 $Y$ 的条件期望**\n\n在 $S=1$ 的条件下 $X$ 的条件期望是 $\\mathbb{E}[X \\mid S=1] = P(X=1 \\mid S=1)$。使用条件概率的定义 $P(A \\mid B) = P(A \\cap B) / P(B)$：\n$$\n\\mathbb{E}[X \\mid S=1] = P(X=1 \\mid S=1) = \\frac{P(X=1 \\text{ and } S=1)}{P(S=1)}\n$$\n事件“$X=1$ 且 $S=1$”等价于“$X=1$ 且（$X=1$ 或 $Y=1$）”，这可以简化为“$X=1$”。因此：\n$$\nP(X=1 \\text{ and } S=1) = P(X=1) = p_X\n$$\n将此结果和 $P(S=1)$ 的表达式代入可得：\n$$\n\\mathbb{E}[X \\mid S=1] = \\frac{p_X}{p_X + p_Y - p_X p_Y}\n$$\n根据对称性，$Y$ 的条件期望为：\n$$\n\\mathbb{E}[Y \\mid S=1] = \\frac{p_Y}{p_X + p_Y - p_X p_Y}\n$$\n\n**3. 乘积 $XY$ 的条件期望**\n\n在 $S=1$ 的条件下，乘积 $XY$ 的条件期望是 $\\mathbb{E}[XY \\mid S=1] = P(X=1, Y=1 \\mid S=1)$。\n$$\n\\mathbb{E}[XY \\mid S=1] = P(X=1, Y=1 \\mid S=1) = \\frac{P(X=1, Y=1 \\text{ and } S=1)}{P(S=1)}\n$$\n事件“$X=1, Y=1$ 且 $S=1$”等价于“$X=1, Y=1$ 且（$X=1$ 或 $Y=1$）”，这可以简化为“$X=1, Y=1$”。由于独立性，$P(X=1, Y=1) = P(X=1)P(Y=1) = p_X p_Y$。因此：\n$$\n\\mathbb{E}[XY \\mid S=1] = \\frac{p_X p_Y}{p_X + p_Y - p_X p_Y}\n$$\n\n**4. 条件协方差的最终表达式**\n\n现在我们组合这些项。令 $P_S = p_X + p_Y - p_X p_Y$。\n$$\n\\mathrm{Cov}(X,Y \\mid S=1) = \\mathbb{E}[XY \\mid S=1] - \\mathbb{E}[X \\mid S=1]\\mathbb{E}[Y \\mid S=1]\n$$\n$$\n\\mathrm{Cov}(X,Y \\mid S=1) = \\frac{p_X p_Y}{P_S} - \\left(\\frac{p_X}{P_S}\\right) \\left(\\frac{p_Y}{P_S}\\right) = \\frac{p_X p_Y P_S - p_X p_Y}{P_S^2}\n$$\n$$\n\\mathrm{Cov}(X,Y \\mid S=1) = \\frac{p_X p_Y (P_S - 1)}{P_S^2}\n$$\n代入 $P_S - 1 = (p_X + p_Y - p_X p_Y) - 1 = -(1 - p_X - p_Y + p_X p_Y) = -(1-p_X)(1-p_Y)$。\n这就得到了最终的闭式表达式：\n$$\n\\mathrm{Cov}(X,Y \\mid S=1) = \\frac{-p_X p_Y (1-p_X)(1-p_Y)}{(p_X + p_Y - p_X p_Y)^2}\n$$\n该表达式表明，如果 $p_X, p_Y \\in (0,1)$，条件协方差严格为负。这种在初始独立的变量之间诱导出的负相关性是 Berkson 偏倚的一种体现，它是一种选择偏倚或对撞因子分层偏倚。如果 $p_X$ 或 $p_Y$ 为 $0$ 或 $1$，协方差为 $0$，因为其中一个变量是常数，或者条件化变得平凡。\n\n### 第 2 部分：模拟设计\n\n该模拟通过计算条件协方差的经验估计值来验证理论结果。对于每个测试用例 $(p_X, p_Y)$，其步骤如下：\n\n1.  **设置随机数生成器**：使用固定的种子 $20231111$ 初始化一个伪随机数生成器，以确保结果的可复现性。\n2.  **生成样本**：生成 $N=2,000,000$ 个独立的样本对 $(X_i, Y_i)$，其中 $X_i \\sim \\mathrm{Bernoulli}(p_X)$ 且 $Y_i \\sim \\mathrm{Bernoulli}(p_Y)$。这是通过生成 $[0,1)$ 范围内的均匀分布随机数并将其与 $p_X$ 和 $p_Y$ 进行比较来实现的。\n3.  **应用选择**：对于每对 $(X_i, Y_i)$，确定选择指示变量 $S_i$。如果 $X_i=1$ 或 $Y_i=1$，则 $S_i=1$，否则 $S_i=0$。创建一个布尔掩码来识别所有 $S_i=1$ 的样本。\n4.  **筛选数据**：通过仅选择那些 $S_i=1$ 的样本对 $(X_i, Y_i)$ 来形成一个新的、更小的数据集。\n5.  **计算经验估计值**：在这个选定的子集上计算样本均值，以估计条件期望：\n    -   $\\widehat{\\mathbb{E}}[X \\mid S=1] = \\text{已选 } X_i \\text{ 的均值}$。\n    -   $\\widehat{\\mathbb{E}}[Y \\mid S=1] = \\text{已选 } Y_i \\text{ 的均值}$。\n    -   $\\widehat{\\mathbb{E}}[XY \\mid S=1] = \\text{已选 } X_i Y_i \\text{ 的均值}$。\n6.  **计算经验协方差**：使用这些估计值计算经验条件协方差：\n    $$\n    \\widehat{\\mathrm{Cov}}(X,Y \\mid S=1) = \\widehat{\\mathbb{E}}[XY \\mid S=1] - \\widehat{\\mathbb{E}}[X \\mid S=1]\\;\\widehat{\\mathbb{E}}[Y \\mid S=1]\n    $$\n7.  **计算绝对差**：计算经验估计值 $\\widehat{\\mathrm{Cov}}(X,Y \\mid S=1)$ 与第 1 部分中推导出的理论值 $\\mathrm{Cov}(X,Y \\mid S=1)$ 之间的绝对差。然后将此差值格式化为6位小数。\n\n对每个测试用例重复此过程，并将得到的绝对差收集起来，以指定的格式打印。",
            "answer": "[0.000021,0.000078,0.000001,0.000000,0.000000]"
        }
    ]
}