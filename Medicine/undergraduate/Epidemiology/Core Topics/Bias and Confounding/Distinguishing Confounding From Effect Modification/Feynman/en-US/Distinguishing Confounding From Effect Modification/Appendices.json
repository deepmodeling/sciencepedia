{
    "hands_on_practices": [
        {
            "introduction": "Theory comes to life when applied to data. This first exercise provides a hands-on encounter with one of the most critical challenges in observational research: confounding. You will analyze a dataset where the crude, unadjusted association is completely reversed after stratifying by a key third variable—a classic demonstration of Simpson's paradox . By calculating and comparing crude, stratum-specific, and pooled estimates, you will practice the fundamental techniques used to identify and control for confounding.",
            "id": "4588683",
            "problem": "An observational cohort study investigates whether a prophylactic exposure $E$ (administered at baseline) reduces the risk of an acute infection outcome $Y$ within $30$ days. A binary baseline risk factor $Z$ (high baseline risk $Z=1$ versus low baseline risk $Z=0$) is measured prior to exposure. The cohort is stratified by $Z$, and the following $2 \\times 2$ tables (counts of cases and non-cases) are observed:\n\nFor $Z=0$ (low baseline risk):\n- Exposed: $a_{0} = 5$ cases, $b_{0} = 95$ non-cases, total $N_{E0} = 100$.\n- Unexposed: $c_{0} = 90$ cases, $d_{0} = 810$ non-cases, total $N_{U0} = 900$.\n- Stratum total: $N_{0} = 1000$.\n\nFor $Z=1$ (high baseline risk):\n- Exposed: $a_{1} = 180$ cases, $b_{1} = 720$ non-cases, total $N_{E1} = 900$.\n- Unexposed: $c_{1} = 40$ cases, $d_{1} = 60$ non-cases, total $N_{U1} = 100$.\n- Stratum total: $N_{1} = 1000$.\n\nUsing only fundamental definitions of risk and of the risk ratio, and the standard epidemiologic definition of confounding and effect modification, do the following:\n- Verify the stratum-specific effect of $E$ on $Y$ within each level of $Z$.\n- Compute the crude (unstratified) risk ratio of $E$ versus no $E$.\n- Compute the Mantel–Haenszel (MH) pooled risk ratio across the two strata defined by $Z$.\n- Based on formal definitions, state whether $Z$ acts as a confounder, an effect modifier, both, or neither in this study, and explain why the crude and pooled estimates differ, noting any manifestation of Simpson’s paradox.\n\nProvide your single final numeric answer as the Mantel–Haenszel pooled risk ratio for the effect of $E$ on $Y$. Express this as a decimal number with no units. If rounding is not required, report the exact value.",
            "solution": "The problem requires an analysis of confounding and effect modification in an observational cohort study. We are given count data for an exposure $E$, an outcome $Y$, and a potential confounding/modifying variable $Z$. The analysis will proceed by calculating stratum-specific, crude, and pooled measures of association.\n\nFirst, we define the fundamental quantities. The risk of the outcome $Y$ in a given group is the proportion of individuals in that group who experience the outcome. The risk ratio ($RR$) is the ratio of the risk in the exposed group to the risk in the unexposed group.\n\n$R = \\frac{\\text{number of cases}}{\\text{total number of individuals}}$\n$RR = \\frac{\\text{Risk in Exposed}}{\\text{Risk in Unexposed}}$\n\nLet us denote the risk in the exposed group within stratum $i$ as $R_{Ei}$ and in the unexposed group as $R_{Ui}$. The stratum-specific risk ratio is $RR_i = R_{Ei} / R_{Ui}$. The variable $i$ will take values $0$ for the low-risk stratum ($Z=0$) and $1$ for the high-risk stratum ($Z=1$).\n\n1.  **Stratum-Specific Analysis**\n\nFor the stratum $Z=0$ (low baseline risk):\nThe number of cases in the exposed group is $a_0=5$, and the total number of exposed individuals is $N_{E0}=100$. The risk in the exposed is:\n$$R_{E0} = \\frac{a_0}{N_{E0}} = \\frac{5}{100} = 0.05$$\nThe number of cases in the unexposed group is $c_0=90$, and the total number of unexposed individuals is $N_{U0}=900$. The risk in the unexposed is:\n$$R_{U0} = \\frac{c_0}{N_{U0}} = \\frac{90}{900} = 0.10$$\nThe stratum-specific risk ratio for $Z=0$ is:\n$$RR_0 = \\frac{R_{E0}}{R_{U0}} = \\frac{0.05}{0.10} = 0.5$$\n\nFor the stratum $Z=1$ (high baseline risk):\nThe number of cases in the exposed group is $a_1=180$, and the total number of exposed individuals is $N_{E1}=900$. The risk in the exposed is:\n$$R_{E1} = \\frac{a_1}{N_{E1}} = \\frac{180}{900} = 0.20$$\nThe number of cases in the unexposed group is $c_1=40$, and the total number of unexposed individuals is $N_{U1}=100$. The risk in the unexposed is:\n$$R_{U1} = \\frac{c_1}{N_{U1}} = \\frac{40}{100} = 0.40$$\nThe stratum-specific risk ratio for $Z=1$ is:\n$$RR_1 = \\frac{R_{E1}}{R_{U1}} = \\frac{0.20}{0.40} = 0.5$$\n\n2.  **Assessment of Effect Modification**\n\nEffect modification (or interaction) is present if the measure of association between exposure and outcome differs across strata of a third variable. Here, the measure of association is the risk ratio. We compare the stratum-specific risk ratios:\n$$RR_0 = 0.5 \\quad \\text{and} \\quad RR_1 = 0.5$$\nSince $RR_0 = RR_1$, the effect of exposure $E$ on outcome $Y$ is homogeneous across the strata of $Z$. Therefore, $Z$ is **not an effect modifier**. The exposure is consistently protective, reducing the risk of the outcome by $50\\%$ in both low-risk and high-risk individuals.\n\n3.  **Crude (Unstratified) Analysis**\n\nTo compute the crude risk ratio, we first collapse the two strata into a single $2 \\times 2$ table.\n- Total exposed cases: $a_{crude} = a_0 + a_1 = 5 + 180 = 185$\n- Total exposed non-cases: $b_{crude} = b_0 + b_1 = 95 + 720 = 815$\n- Total exposed: $N_{E, crude} = a_{crude} + b_{crude} = 185 + 815 = 1000$\n\n- Total unexposed cases: $c_{crude} = c_0 + c_1 = 90 + 40 = 130$\n- Total unexposed non-cases: $d_{crude} = d_0 + d_1 = 810 + 60 = 870$\n- Total unexposed: $N_{U, crude} = c_{crude} + d_{crude} = 130 + 870 = 1000$\n\nThe crude risk in the exposed group is:\n$$R_{E, crude} = \\frac{a_{crude}}{N_{E, crude}} = \\frac{185}{1000} = 0.185$$\nThe crude risk in the unexposed group is:\n$$R_{U, crude} = \\frac{c_{crude}}{N_{U, crude}} = \\frac{130}{1000} = 0.130$$\nThe crude risk ratio is:\n$$RR_{crude} = \\frac{R_{E, crude}}{R_{U, crude}} = \\frac{0.185}{0.130} \\approx 1.423$$\n\n4.  **Assessment of Confounding**\n\nA variable $Z$ is a confounder if it is associated with both the exposure $E$ and the outcome $Y$ (independent of $E$), and it is not on the causal pathway. A key sign of confounding is when the crude measure of association differs from the adjusted (stratum-specific) measure of association.\n- Crude risk ratio: $RR_{crude} \\approx 1.423$\n- Stratum-specific risk ratios: $RR_0 = RR_1 = 0.5$\nSince $1.423 \\neq 0.5$, confounding is present. The variable $Z$ is a **confounder**.\n\nThe confounding arises because:\n- $Z$ is associated with the outcome $Y$: The baseline risk of $Y$ is much higher in the $Z=1$ stratum ($R_{U1}=0.40$) than in the $Z=0$ stratum ($R_{U0}=0.10$).\n- $Z$ is associated with the exposure $E$: The high-risk group ($Z=1$) was much more likely to be exposed ($P(E|Z=1) = 900/1000 = 0.9$) than the low-risk group ($P(E|Z=0) = 100/1000 = 0.1$). This is a case of \"confounding by indication,\" where the prophylactic exposure is preferentially given to those at higher perceived risk.\n\nThe crude analysis incorrectly suggests that the exposure is harmful ($RR > 1$), while the stratified analysis reveals the exposure is protective ($RR  1$). This reversal of the direction of association upon stratification is a classic example of **Simpson's paradox**. The crude estimate is biased because it disproportionately compares a high-risk exposed group to a low-risk unexposed group.\n\n5.  **Mantel–Haenszel (MH) Pooled Risk Ratio**\n\nSince there is no effect modification, it is appropriate to compute a single summary measure of association that adjusts for the confounding by $Z$. The Mantel–Haenszel pooled risk ratio ($RR_{MH}$) is a weighted average of the stratum-specific risk ratios. The formula is:\n$$RR_{MH} = \\frac{\\sum_{i=0}^{1} \\frac{a_i (c_i+d_i)}{N_i}}{\\sum_{i=0}^{1} \\frac{c_i (a_i+b_i)}{N_i}} = \\frac{\\sum_{i=0}^{1} \\frac{a_i N_{Ui}}{N_i}}{\\sum_{i=0}^{1} \\frac{c_i N_{Ei}}{N_i}}$$\nwhere $N_i$ is the total size of stratum $i$.\n\nNumerator calculation:\n$$ \\text{Numerator} = \\frac{a_0 N_{U0}}{N_0} + \\frac{a_1 N_{U1}}{N_1} = \\frac{5 \\times 900}{1000} + \\frac{180 \\times 100}{1000} = 4.5 + 18 = 22.5 $$\n\nDenominator calculation:\n$$ \\text{Denominator} = \\frac{c_0 N_{E0}}{N_0} + \\frac{c_1 N_{E1}}{N_1} = \\frac{90 \\times 100}{1000} + \\frac{40 \\times 900}{1000} = 9 + 36 = 45 $$\n\nThe Mantel–Haenszel pooled risk ratio is:\n$$ RR_{MH} = \\frac{22.5}{45} = 0.5 $$\nAs expected, because the stratum-specific risk ratios are identical, the pooled estimate is equal to their common value. This adjusted estimate represents the true, unconfounded effect of exposure $E$ on outcome $Y$.\n\nFinal conclusion: $Z$ acts as a confounder but not an effect modifier. The crude risk ratio of approximately $1.423$ is spurious and an artifact of confounding, manifesting as Simpson's paradox. The adjusted risk ratio, correctly estimated by the Mantel-Haenszel procedure as $0.5$, shows a strong protective effect of the exposure.\nThe final numeric answer requested is the Mantel–Haenszel pooled risk ratio.",
            "answer": "$$\\boxed{0.5}$$"
        },
        {
            "introduction": "Having tackled confounding, we now turn to a deeper exploration of effect modification. This practice illuminates a crucial, often overlooked, concept: effect modification is scale-dependent. Using data from a hypothetical randomized trial where confounding is not a concern, you will discover how an exposure's effect can appear uniform on one scale (the risk ratio) but heterogeneous on another (the risk difference) . This exercise underscores the importance of being precise about the measure of effect when discussing interaction.",
            "id": "4588676",
            "problem": "Consider a large, individually Randomized Controlled Trial (RCT) evaluating a binary exposure $E \\in \\{0,1\\}$ (where $E=1$ denotes exposed and $E=0$ denotes unexposed) on a binary outcome $Y \\in \\{0,1\\}$, stratified by a binary characteristic $Z \\in \\{0,1\\}$ that is measured at baseline and unaffected by $E$. Randomization ensures $E$ is independent of $Z$, so there is no confounding by $Z$. Let $p_{ez}$ denote the risk $\\mathbb{P}(Y=1 \\mid E=e, Z=z)$. The observed risks are:\n- For $Z=0$, $p_{00} = 0.12$ and $p_{10} = 0.06$.\n- For $Z=1$, $p_{01} = 0.04$ and $p_{11} = 0.02$.\n\nUsing only core epidemiologic definitions of risk, risk difference, and risk ratio, derive the magnitude of effect modification by $Z$ on the additive scale, defined as the difference in stratum-specific risk differences between $Z=1$ and $Z=0$. Express your final answer as a decimal (do not use a percentage sign). No rounding is necessary.",
            "solution": "The goal is to compute the magnitude of effect modification by a binary characteristic $Z \\in \\{0, 1\\}$ on the relationship between a binary exposure $E \\in \\{0, 1\\}$ and a binary outcome $Y \\in \\{0, 1\\}$. The measure of effect is the risk difference, and the scale for assessing modification is additive.\n\nLet $p_{ez}$ represent the risk of the outcome, defined as the conditional probability $\\mathbb{P}(Y=1 \\mid E=e, Z=z)$. The problem provides the following stratum-specific risks:\nFor stratum $Z=0$:\n-   Risk for the unexposed ($E=0$): $p_{00} = 0.12$\n-   Risk for the exposed ($E=1$): $p_{10} = 0.06$\n\nFor stratum $Z=1$:\n-   Risk for the unexposed ($E=0$): $p_{01} = 0.04$\n-   Risk for the exposed ($E=1$): $p_{11} = 0.02$\n\nThe measure of association on the additive scale is the risk difference ($RD$). The stratum-specific risk difference, $RD_z$, is the difference in risk between the exposed and unexposed groups within a specific stratum $z$. It is calculated as:\n$$RD_z = p_{1z} - p_{0z}$$\n\nWe calculate the risk difference for each stratum of $Z$.\n\nFor stratum $Z=0$:\n$$RD_0 = p_{10} - p_{00} = 0.06 - 0.12 = -0.06$$\nThis indicates a protective effect of the exposure in the $Z=0$ stratum, with the risk being $0.06$ lower among the exposed compared to the unexposed.\n\nFor stratum $Z=1$:\n$$RD_1 = p_{11} - p_{01} = 0.02 - 0.04 = -0.02$$\nThis also indicates a protective effect of the exposure in the $Z=1$ stratum, with the risk being $0.02$ lower among the exposed compared to the unexposed.\n\nEffect modification on the additive scale is present if the risk difference varies across strata of the third variable $Z$, i.e., if $RD_0 \\neq RD_1$. The problem explicitly defines the quantity to be derived as \"the difference in stratum-specific risk differences between $Z=1$ and $Z=0$\". Let us denote this quantity as $EM_{add}$.\n$$EM_{add} = RD_1 - RD_0$$\n\nSubstituting the calculated stratum-specific risk differences into this formula:\n$$EM_{add} = (-0.02) - (-0.06)$$\n$$EM_{add} = -0.02 + 0.06$$\n$$EM_{add} = 0.04$$\n\nThe magnitude of effect modification by $Z$ on the additive scale is $0.04$. The fact that this value is non-zero ($0.04 \\neq 0$) confirms the presence of effect modification. The positive sign indicates that the risk difference is less negative (i.e., the protective effect is smaller) in the $Z=1$ stratum compared to the $Z=0$ stratum. The problem states that due to randomization, there is no confounding by $Z$, so this observed heterogeneity in the risk difference is attributable to effect modification alone.",
            "answer": "$$\\boxed{0.04}$$"
        },
        {
            "introduction": "The ultimate test of understanding is the ability to build. In this capstone exercise, you will move from analyzing data to creating the data-generating process itself . By constructing a simulation program from first principles, you will define the conditions that give rise to confounding and effect modification. This practice provides a powerful, structural view of how associations are formed and biased, cementing the theoretical distinctions in a tangible, computational framework.",
            "id": "4588709",
            "problem": "Construct a program that operationalizes the distinction between confounding and effect modification on the risk ratio scale using a binary exposure, a binary stratifier, and a binary outcome. The program must decide, for each provided parameter set, whether confounding is present and whether effect modification is present, by building only from core definitions and laws of probability combined with a standard stratified estimator.\n\nUse the following fundamental base:\n- Let $E \\in \\{0,1\\}$ denote exposure, $Z \\in \\{0,1\\}$ denote a stratifying covariate, and $Y \\in \\{0,1\\}$ denote outcome.\n- Use the law of total probability, Bayes’s rule, and the definition of a risk ratio.\n- Use the Mantel–Haenszel estimator for the risk ratio constructed from $2\\times 2$ stratified expected counts, as a well-tested formula to summarize a common effect under homogeneity.\n\nInput parameterization for each test case:\n- Prevalence of the stratifier: $P(Z=1)=\\pi_{z}$, so $P(Z=0)=1-\\pi_{z}$.\n- Exposure prevalence within $Z$ strata: $P(E=1\\mid Z=1)=\\pi_{e\\mid 1}$ and $P(E=1\\mid Z=0)=\\pi_{e\\mid 0}$. Hence, $P(E=0\\mid Z=z)=1-\\pi_{e\\mid z}$ for $z\\in\\{0,1\\}$.\n- Baseline risks in the unexposed: $P(Y=1\\mid E=0,Z=0)=p_{00}$ and $P(Y=1\\mid E=0,Z=1)=p_{01}$.\n- Stratum-specific risk ratios for exposure: $RR_{0}$ and $RR_{1}$, defining $P(Y=1\\mid E=1,Z=z)=\\min(1,RR_{z}\\cdot p_{0z})$ for $z\\in\\{0,1\\}$.\n\nRequired computations per test case:\n1) Compute $P(E=1)=\\pi_{z}\\pi_{e\\mid 1}+(1-\\pi_{z})\\pi_{e\\mid 0}$ and $P(E=0)=1-P(E=1)$.\n2) Compute $P(Z=1\\mid E=1)=\\dfrac{\\pi_{z}\\pi_{e\\mid 1}}{P(E=1)}$ and $P(Z=1\\mid E=0)=\\dfrac{\\pi_{z}(1-\\pi_{e\\mid 1})}{P(E=0)}$, then $P(Z=0\\mid E=e)=1-P(Z=1\\mid E=e)$ for $e\\in\\{0,1\\}$.\n3) Using the law of total probability, compute the marginal risks\n$$\nr_{1}=P(Y=1\\mid E=1)=\\sum_{z\\in\\{0,1\\}}P(Y=1\\mid E=1,Z=z)\\,P(Z=z\\mid E=1),\n$$\n$$\nr_{0}=P(Y=1\\mid E=0)=\\sum_{z\\in\\{0,1\\}}P(Y=1\\mid E=0,Z=z)\\,P(Z=z\\mid E=0).\n$$\nThen compute the crude risk ratio\n$$\nRR_{\\text{crude}}=\\frac{r_{1}}{r_{0}}.\n$$\n4) Form expected stratum-specific $2\\times 2$ counts using an arbitrary positive scale $N$ (you may take $N=1$ because the Mantel–Haenszel ratio is scale-invariant). For each stratum $z\\in\\{0,1\\}$, define\n- $n_{1z}=P(E=1,Z=z)\\cdot N$ and $n_{0z}=P(E=0,Z=z)\\cdot N$,\n- $a_{z}=n_{1z}\\cdot P(Y=1\\mid E=1,Z=z)$ and $c_{z}=n_{0z}\\cdot P(Y=1\\mid E=0,Z=z)$,\n- $N_{z}=n_{1z}+n_{0z}$.\nCompute the Mantel–Haenszel risk ratio\n$$\nRR_{\\text{MH}}=\\frac{\\sum_{z} a_{z}\\,n_{0z}/N_{z}}{\\sum_{z} c_{z}\\,n_{1z}/N_{z}}.\n$$\n5) Decide effect modification on the risk ratio scale as present if and only if $|RR_{0}-RR_{1}|\\varepsilon$ for a small tolerance $\\varepsilon$. Use $\\varepsilon=10^{-9}$.\n6) Decide confounding as present if and only if there is no effect modification on the risk ratio scale (that is, $|RR_{0}-RR_{1}|\\le \\varepsilon$) and $|RR_{\\text{crude}}-RR_{\\text{MH}}|\\varepsilon$.\n\nImportant conventions:\n- Treat all probabilities and risk ratios as real numbers in $[0,1]$ for probabilities and $(0,\\infty)$ for ratios, expressed as decimals or fractions. Do not use a percentage sign.\n- If $RR_{z}\\cdot p_{0z}1$, truncate $P(Y=1\\mid E=1,Z=z)$ to $1$.\n- Use the above decision rule: in the presence of effect modification, do not label confounding; set the confounding indicator to false when effect modification is present.\n\nTest suite (provide answers for each in the given order):\n- Case $1$ (neither confounding nor effect modification):\n  - $P(Z=1)=0.5$, $P(E=1\\mid Z=1)=0.4$, $P(E=1\\mid Z=0)=0.4$,\n  - $P(Y=1\\mid E=0,Z=0)=0.1$, $P(Y=1\\mid E=0,Z=1)=0.3$,\n  - $RR_{0}=2.0$, $RR_{1}=2.0$.\n- Case $2$ (confounding only):\n  - $P(Z=1)=0.5$, $P(E=1\\mid Z=1)=0.8$, $P(E=1\\mid Z=0)=0.2$,\n  - $P(Y=1\\mid E=0,Z=0)=0.1$, $P(Y=1\\mid E=0,Z=1)=0.3$,\n  - $RR_{0}=1.5$, $RR_{1}=1.5$.\n- Case $3$ (effect modification only, no $E$–$Z$ association):\n  - $P(Z=1)=0.5$, $P(E=1\\mid Z=1)=0.5$, $P(E=1\\mid Z=0)=0.5$,\n  - $P(Y=1\\mid E=0,Z=0)=0.05$, $P(Y=1\\mid E=0,Z=1)=0.2$,\n  - $RR_{0}=2.0$, $RR_{1}=1.0$.\n- Case $4$ (effect modification with $E$–$Z$ association):\n  - $P(Z=1)=0.7$, $P(E=1\\mid Z=1)=0.7$, $P(E=1\\mid Z=0)=0.3$,\n  - $P(Y=1\\mid E=0,Z=0)=0.05$, $P(Y=1\\mid E=0,Z=1)=0.2$,\n  - $RR_{0}=1.0$, $RR_{1}=2.0$.\n- Case $5$ (pure confounding with null within-stratum effect):\n  - $P(Z=1)=0.5$, $P(E=1\\mid Z=1)=0.9$, $P(E=1\\mid Z=0)=0.1$,\n  - $P(Y=1\\mid E=0,Z=0)=0.05$, $P(Y=1\\mid E=0,Z=1)=0.2$,\n  - $RR_{0}=1.0$, $RR_{1}=1.0$.\n- Case $6$ (no confounding despite $E$–$Z$ association because $Z$ does not affect $Y$):\n  - $P(Z=1)=0.3$, $P(E=1\\mid Z=1)=0.9$, $P(E=1\\mid Z=0)=0.1$,\n  - $P(Y=1\\mid E=0,Z=0)=0.1$, $P(Y=1\\mid E=0,Z=1)=0.1$,\n  - $RR_{0}=1.8$, $RR_{1}=1.8$.\n\nDecision outputs for each case:\n- For each case, produce a two-element list $[c,e]$ where $c$ is a boolean indicating confounding as defined above, and $e$ is a boolean indicating effect modification as defined above.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with no spaces, where each element is the two-boolean list for a case in the same order as listed. For example, a valid output structure looks like $[[\\text{True},\\text{False}],[\\text{False},\\text{True}],\\dots]$.",
            "solution": "The core of the problem lies in comparing a crude (marginal) measure of association with a stratum-adjusted measure. A discrepancy between these two, in the absence of effect modification, indicates confounding. Effect modification is present if the measure of association itself varies across the strata of the third variable $Z$.\n\nLet the given parameters for a case be:\n- $P(Z=1) = \\pi_z$\n- $P(E=1 \\mid Z=1) = \\pi_{e \\mid 1}$\n- $P(E=1 \\mid Z=0) = \\pi_{e \\mid 0}$\n- Baseline risk in stratum $Z=0$: $P(Y=1 \\mid E=0, Z=0) = p_{00}$\n- Baseline risk in stratum $Z=1$: $P(Y=1 \\mid E=0, Z=1) = p_{01}$\n- Stratum-specific risk ratios: $RR_0$ and $RR_1$\n\nWe define the following conditional probabilities of the outcome, including the specified truncation to ensure probabilities do not exceed $1$:\n- Risk in exposed, stratum $Z=0$: $p_{10} = P(Y=1 \\mid E=1, Z=0) = \\min(1, RR_0 \\cdot p_{00})$\n- Risk in exposed, stratum $Z=1$: $p_{11} = P(Y=1 \\mid E=1, Z=1) = \\min(1, RR_1 \\cdot p_{01})$\n\nThe process to determine the presence of confounding and effect modification involves the following steps:\n\n**1. Preliminary Probability Calculations**\nFirst, we compute marginal probabilities for the exposure $E$ using the law of total probability, summing over the strata of $Z$.\nThe marginal probability of exposure is:\n$$P(E=1) = P(E=1 \\mid Z=1)P(Z=1) + P(E=1 \\mid Z=0)P(Z=0)$$\n$$P(E=1) = \\pi_{e \\mid 1}\\pi_z + \\pi_{e \\mid 0}(1-\\pi_z)$$\nThe probability of being unexposed is simply $P(E=0) = 1 - P(E=1)$.\n\nNext, using Bayes's rule, we find the distribution of the stratifier $Z$ conditional on exposure status $E$. These probabilities are crucial for calculating the marginal risks.\n$$P(Z=z \\mid E=e) = \\frac{P(E=e \\mid Z=z)P(Z=z)}{P(E=e)}$$\nSpecifically:\n$$P(Z=1 \\mid E=1) = \\frac{\\pi_{e \\mid 1}\\pi_z}{P(E=1)}$$\n$$P(Z=1 \\mid E=0) = \\frac{P(E=0 \\mid Z=1)P(Z=1)}{P(E=0)} = \\frac{(1 - \\pi_{e \\mid 1})\\pi_z}{P(E=0)}$$\nThe complementary probabilities are $P(Z=0 \\mid E=e) = 1 - P(Z=1 \\mid E=e)$.\n\n**2. Crude Risk Ratio ($RR_{\\text{crude}}$) Calculation**\nThe crude risk ratio compares the marginal risk of the outcome in the exposed group to that in the unexposed group. We calculate these marginal risks, $r_1$ and $r_0$, by applying the law of total probability, averaging over the strata of $Z$.\n$$r_1 = P(Y=1 \\mid E=1) = \\sum_{z \\in \\{0,1\\}} P(Y=1 \\mid E=1, Z=z) P(Z=z \\mid E=1)$$\n$$r_1 = p_{11} P(Z=1 \\mid E=1) + p_{10} P(Z=0 \\mid E=1)$$\nSimilarly for the unexposed group:\n$$r_0 = P(Y=1 \\mid E=0) = \\sum_{z \\in \\{0,1\\}} P(Y=1 \\mid E=0, Z=z) P(Z=z \\mid E=0)$$\n$$r_0 = p_{01} P(Z=1 \\mid E=0) + p_{00} P(Z=0 \\mid E=0)$$\nThe crude risk ratio is the ratio of these marginal risks:\n$$RR_{\\text{crude}} = \\frac{r_1}{r_0}$$\n\n**3. Mantel-Haenszel Adjusted Risk Ratio ($RR_{\\text{MH}}$) Calculation**\nThe Mantel-Haenszel estimator provides a pooled risk ratio, adjusted for the stratifying variable $Z$. It is a weighted average of the stratum-specific risk ratios. The formula is constructed from expected counts in $2 \\times 2$ tables for each stratum, assuming a large population of size $N$. As the estimator is scale-invariant, we can set $N=1$.\n\nFor each stratum $z \\in \\{0,1\\}$, the expected cell counts are derived from joint probabilities:\n- Number of exposed: $n_{1z} = P(E=1, Z=z) = P(E=1 \\mid Z=z)P(Z=z)$\n- Number of unexposed: $n_{0z} = P(E=0, Z=z) = P(E=0 \\mid Z=z)P(Z=z)$\n- Total in stratum: $N_z = n_{1z} + n_{0z} = P(Z=z)$\n- Cases among exposed: $a_z = n_{1z} \\cdot p_{1z}$\n- Cases among unexposed: $c_z = n_{0z} \\cdot p_{0z}$\n\nThe Mantel-Haenszel risk ratio is given by:\n$$RR_{\\text{MH}} = \\frac{\\sum_{z=0,1} a_z n_{0z} / N_z}{\\sum_{z=0,1} c_z n_{1z} / N_z}$$\nSubstituting the probability expressions and simplifying, the terms in the summation for each stratum $z$ become:\n- Numerator term: $a_z n_{0z} / N_z = p_{1z} \\cdot [P(E=1 \\mid Z=z)P(Z=z)] \\cdot [P(E=0 \\mid Z=z)]$\n- Denominator term: $c_z n_{1z} / N_z = p_{0z} \\cdot [P(E=0 \\mid Z=z)P(Z=z)] \\cdot [P(E=1 \\mid Z=z)]$\nLet's define the Mantel-Haenszel weights $w_z = P(E=1 \\mid Z=z) P(E=0 \\mid Z=z) P(Z=z)$.\n- For $z=0$: $w_0 = \\pi_{e \\mid 0}(1-\\pi_{e \\mid 0})(1-\\pi_z)$\n- For $z=1$: $w_1 = \\pi_{e \\mid 1}(1-\\pi_{e \\mid 1})\\pi_z$\nThe formula simplifies to a weighted sum:\n$$RR_{\\text{MH}} = \\frac{p_{10} w_0 + p_{11} w_1}{p_{00} w_0 + p_{01} w_1}$$\nIf the risk ratio is constant across strata ($RR_0 = RR_1 = RR$) and no truncation occurs, then $p_{1z} = RR \\cdot p_{0z}$, and $RR_{\\text{MH}}$ correctly simplifies to $RR$.\n\n**4. Decision Logic**\nWith the crude and adjusted risk ratios computed, we apply the decision rules. A small tolerance, $\\varepsilon = 10^{-9}$, is used for floating-point comparisons.\n\n- **Effect Modification:** Presence is determined by comparing the stratum-specific risk ratios. If they are different, the effect of exposure $E$ on outcome $Y$ depends on the level of $Z$.\n  $$\\text{Effect Modification is present if } |RR_0 - RR_1| > \\varepsilon$$\n\n- **Confounding:** Confounding is assessed only when there is no effect modification. It is defined as a discrepancy between the crude and a common adjusted effect measure.\n  $$\\text{Confounding is present if } (\\text{no Effect Modification}) \\land (|RR_{\\text{crude}} - RR_{\\text{MH}}| > \\varepsilon)$$\nThe problem specifies the convention that confounding is not reported if effect modification is present. This is because the concept of a single summary \"confounded\" or \"unconfounded\" measure is ill-defined when the true effect varies.\n\nThis completes the logical framework. The following program implements these calculations for each test case.\n```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to process test cases and print results.\n    \"\"\"\n    \n    test_cases = [\n        # Case 1 (neither confounding nor effect modification)\n        {'pi_z': 0.5, 'pi_e1': 0.4, 'pi_e0': 0.4, 'p00': 0.1, 'p01': 0.3, 'rr0': 2.0, 'rr1': 2.0},\n        # Case 2 (confounding only)\n        {'pi_z': 0.5, 'pi_e1': 0.8, 'pi_e0': 0.2, 'p00': 0.1, 'p01': 0.3, 'rr0': 1.5, 'rr1': 1.5},\n        # Case 3 (effect modification only, no E–Z association)\n        {'pi_z': 0.5, 'pi_e1': 0.5, 'pi_e0': 0.5, 'p00': 0.05, 'p01': 0.2, 'rr0': 2.0, 'rr1': 1.0},\n        # Case 4 (effect modification with E–Z association)\n        {'pi_z': 0.7, 'pi_e1': 0.7, 'pi_e0': 0.3, 'p00': 0.05, 'p01': 0.2, 'rr0': 1.0, 'rr1': 2.0},\n        # Case 5 (pure confounding with null within-stratum effect)\n        {'pi_z': 0.5, 'pi_e1': 0.9, 'pi_e0': 0.1, 'p00': 0.05, 'p01': 0.2, 'rr0': 1.0, 'rr1': 1.0},\n        # Case 6 (no confounding despite E–Z association because Z does not affect Y)\n        {'pi_z': 0.3, 'pi_e1': 0.9, 'pi_e0': 0.1, 'p00': 0.1, 'p01': 0.1, 'rr0': 1.8, 'rr1': 1.8},\n    ]\n\n    results = []\n    for params in test_cases:\n        result = compute_decision(params)\n        results.append(result)\n\n    # Format the output string as specified: [[Bool,Bool],[Bool,Bool],...]\n    str_results = [str(r).replace(' ', '') for r in results]\n    return f\"[{','.join(str_results)}]\"\n\ndef compute_decision(params):\n    \"\"\"\n    Computes confounding and effect modification status for a single parameter set.\n    \"\"\"\n    pi_z = params['pi_z']    # P(Z=1)\n    pi_e1 = params['pi_e1']  # P(E=1|Z=1)\n    pi_e0 = params['pi_e0']  # P(E=1|Z=0)\n    p00 = params['p00']      # P(Y=1|E=0,Z=0)\n    p01 = params['p01']      # P(Y=1|E=0,Z=1)\n    rr0 = params['rr0']      # RR_0\n    rr1 = params['rr1']      # RR_1\n    eps = 1e-9\n\n    # Risk in exposed, by stratum\n    # P(Y=1|E=1,Z=0)\n    p10 = min(1.0, rr0 * p00)\n    # P(Y=1|E=1,Z=1)\n    p11 = min(1.0, rr1 * p01)\n\n    # 1. Marginal exposure probabilities\n    # P(E=1)\n    p_e1 = pi_e1 * pi_z + pi_e0 * (1 - pi_z)\n    # P(E=0)\n    p_e0 = 1 - p_e1\n\n    # 2. Conditional stratifier probabilities (given exposure)\n    if p_e1 == 0:\n        p_z1_e1 = 0\n    else:    \n        # P(Z=1|E=1)\n        p_z1_e1 = (pi_e1 * pi_z) / p_e1\n    \n    p_z0_e1 = 1 - p_z1_e1\n\n    if p_e0 == 0:\n        p_z1_e0 = 0\n    else:\n        # P(Z=1|E=0)\n        p_z1_e0 = ((1 - pi_e1) * pi_z) / p_e0\n    \n    p_z0_e0 = 1 - p_z1_e0\n\n    # 3. Crude risk ratio\n    # Marginal risk in exposed, r1 = P(Y=1|E=1)\n    r1 = p11 * p_z1_e1 + p10 * p_z0_e1\n    # Marginal risk in unexposed, r0 = P(Y=1|E=0)\n    r0 = p01 * p_z1_e0 + p00 * p_z0_e0\n\n    if r0 == 0:\n        # Undefined or infinite crude RR, treat as a large number if r1 > 0\n        rr_crude = float('inf') if r1 > 0 else 1.0\n    else:\n        rr_crude = r1 / r0\n\n    # 4. Mantel-Haenszel adjusted risk ratio\n    # Weights for MH formula\n    # w0 = P(E=1|Z=0) * P(E=0|Z=0) * P(Z=0)\n    w0 = pi_e0 * (1 - pi_e0) * (1 - pi_z)\n    # w1 = P(E=1|Z=1) * P(E=0|Z=1) * P(Z=1)\n    w1 = pi_e1 * (1 - pi_e1) * pi_z\n\n    mh_num = p10 * w0 + p11 * w1\n    mh_den = p00 * w0 + p01 * w1\n    \n    if mh_den == 0:\n        rr_mh = float('inf') if mh_num > 0 else 1.0\n    else:\n        rr_mh = mh_num / mh_den\n\n    # 5. Decide on effect modification\n    is_em = abs(rr0 - rr1) > eps\n\n    # 6. Decide on confounding (only if no effect modification)\n    is_c = (not is_em) and (abs(rr_crude - rr_mh) > eps)\n\n    return [is_c, is_em]\n\n# The following is just to generate the answer string for the XML.\n# It is not part of the solution code itself.\n# print(solve())\n```",
            "answer": "[[False,False],[True,False],[False,True],[False,True],[True,False],[False,False]]"
        }
    ]
}