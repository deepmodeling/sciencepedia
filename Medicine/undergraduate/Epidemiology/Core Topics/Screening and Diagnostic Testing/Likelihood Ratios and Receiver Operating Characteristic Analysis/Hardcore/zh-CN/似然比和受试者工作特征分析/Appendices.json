{
    "hands_on_practices": [
        {
            "introduction": "诊断测试的灵敏度（$\\text{Se}$）和特异性（$\\text{Sp}$）是其固有属性，但在临床实践中，我们更关心一个阳性或阴性结果的真正意义。这个实践练习将引导你运用贝叶斯定理，亲手计算并理解疾病的患病率（先验概率）如何深刻地影响测试的阳性预测值（$\\text{PPV}$）和阴性预测值（$\\text{NPV}$）。通过这个过程，你将揭示为何同一个测试在不同人群中的应用价值会存在显著差异 。",
            "id": "4607798",
            "problem": "一名研究者使用一个固定的决策阈值来评估一种疾病的二元诊断测试，该阈值对应于受试者工作特征（ROC）曲线上的单个工作点。在此阈值下，该测试的灵敏度 $ \\text{Se} = 0.80 $，特异度 $ \\text{Sp} = 0.95 $。考虑两个患病率分别为 $ p = 0.05 $ 和 $ p = 0.50 $ 的人群。仅从灵敏度、特异度、患病率、似然比（LR）以及比值形式的贝叶斯定理的定义出发，推导在每种患病率下阳性预测值（PPV）和阴性预测值（NPV）的表达式。计算当 $ p = 0.05 $ 和 $ p = 0.50 $ 时的 $ \\text{PPV} $ 和 $ \\text{NPV} $。为总结患病率对阳性结果的检验后概率的影响，报告比率 $ r = \\dfrac{\\text{PPV at } p = 0.50}{\\text{PPV at } p = 0.05} $。将您最终报告的 $ r $ 值四舍五入至四位有效数字。请以单个无量纲数的形式提供您的最终答案。",
            "solution": "该问题要求基于基本定义和贝叶斯定理，在两种不同的疾病患病率下，推导并计算一个诊断测试的阳性预测值（PPV）和阴性预测值（NPV）。最终目标是计算两种PPV的比值。\n\n首先，让我们正式定义所涉及的事件和概率。\n设 $D$ 为个体患有该疾病的事件。\n设 $D^c$ 为个体未患该疾病的事件。\n设 $T^+$ 为测试结果为阳性的事件。\n设 $T^-$ 为测试结果为阴性的事件。\n\n给定的量为：\n- 灵敏度（$\\text{Se}$）：在患有疾病的情况下，测试结果为阳性的概率。\n$$ \\text{Se} = P(T^+ | D) = 0.80 $$\n- 特异度（$\\text{Sp}$）：在未患疾病的情况下，测试结果为阴性的概率。\n$$ \\text{Sp} = P(T^- | D^c) = 0.95 $$\n- 患病率（$p$）：患有该疾病的先验概率。\n$$ p = P(D) $$\n我们被给予两种患病率：$p_1 = 0.05$ 和 $p_2 = 0.50$。\n\n需要推导的量为：\n- 阳性预测值（$\\text{PPV}$）：在测试结果为阳性的情况下，患有该疾病的检验后概率。\n$$ \\text{PPV} = P(D | T^+) $$\n- 阴性预测值（$\\text{NPV}$）：在测试结果为阴性的情况下，未患该疾病的检验后概率。\n$$ \\text{NPV} = P(D^c | T^-) $$\n\n问题引导我们使用比值形式的贝叶斯定理，该定理指出后验比值等于先验比值乘以似然比。\n$$ \\text{Posterior Odds} = \\text{Likelihood Ratio} \\times \\text{Prior Odds} $$\n\n**PPV的推导**\n\n对于阳性测试结果（$T^+$），我们关心的是疾病的后验概率 $P(D|T^+)$。疾病的先验比值是患病概率与不患病概率之比：\n$$ \\text{Odds}_{\\text{pre}} = \\frac{P(D)}{P(D^c)} = \\frac{p}{1-p} $$\n阳性测试后的疾病后验比值为：\n$$ \\text{Odds}_{\\text{post}}(T^+) = \\frac{P(D | T^+)}{P(D^c | T^+)} $$\n相关的似然比是阳性似然比（$\\text{LR}^+$），定义为患病组中测试结果为阳性的概率与非患病组中测试结果为阳性的概率之比：\n$$ \\text{LR}^+ = \\frac{P(T^+ | D)}{P(T^+ | D^c)} $$\n我们知道 $P(T^+ | D) = \\text{Se}$。分母是 $P(T^+ | D^c) = 1 - P(T^- | D^c) = 1 - \\text{Sp}$。\n因此，\n$$ \\text{LR}^+ = \\frac{\\text{Se}}{1 - \\text{Sp}} $$\n应用比值形式的贝叶斯定理：\n$$ \\text{Odds}_{\\text{post}}(T^+) = \\text{LR}^+ \\times \\text{Odds}_{\\text{pre}} = \\left( \\frac{\\text{Se}}{1 - \\text{Sp}} \\right) \\left( \\frac{p}{1 - p} \\right) $$\n为了求得PPV，我们将后验比值转换回概率。对于任何事件 $A$，若其比值为 $\\text{Odds}(A) = P(A) / (1-P(A))$，则其概率为 $P(A) = \\text{Odds}(A) / (1 + \\text{Odds}(A))$。\n$$ \\text{PPV} = \\frac{\\text{Odds}_{\\text{post}}(T^+)}{1 + \\text{Odds}_{\\text{post}}(T^+)} $$\n\n**NPV的推导**\n\n对于阴性测试结果（$T^-$），我们关心的是不患病的后验概率 $P(D^c|T^-)$。我们可以使用*不*患病的比值来构建这个问题。不患病的先验比值为：\n$$ \\text{Odds}_{\\text{pre}}(D^c) = \\frac{P(D^c)}{P(D)} = \\frac{1-p}{p} $$\n阴性测试后不患病的后验比值为：\n$$ \\text{Odds}_{\\text{post}}(D^c | T^-) = \\frac{P(D^c | T^-)}{P(D | T^-)} $$\n相关的似然比描述了阴性测试为疾病不存在所提供的证据。这个比值为 $\\frac{P(T^-|D^c)}{P(T^-|D)}$。\n我们知道 $P(T^-|D^c) = \\text{Sp}$。分母是 $P(T^-|D) = 1 - P(T^+|D) = 1 - \\text{Se}$。\n在阴性测试条件下，无病的似然比为：$\\frac{\\text{Sp}}{1 - \\text{Se}}$。注意，这是阴性似然比 $\\text{LR}^- = \\frac{1-\\text{Se}}{\\text{Sp}}$ 的倒数。\n应用贝叶斯定理计算无病的比值：\n$$ \\text{Odds}_{\\text{post}}(D^c | T^-) = \\left( \\frac{\\text{Sp}}{1 - \\text{Se}} \\right) \\left( \\frac{1-p}{p} \\right) $$\n将这些后验比值转换为概率NPV：\n$$ \\text{NPV} = \\frac{\\text{Odds}_{\\text{post}}(D^c | T^-)}{1 + \\text{Odds}_{\\text{post}}(D^c | T^-)} $$\n\n**计算**\n\n首先，使用给定的值 $\\text{Se} = 0.80$ 和 $\\text{Sp} = 0.95$ 计算似然比。\n$$ \\text{LR}^+ = \\frac{0.80}{1 - 0.95} = \\frac{0.80}{0.05} = 16 $$\n用于推导NPV的似然比是：\n$$ \\frac{\\text{Sp}}{1 - \\text{Se}} = \\frac{0.95}{1 - 0.80} = \\frac{0.95}{0.20} = 4.75 = \\frac{19}{4} $$\n\n**情况1：患病率 $p = 0.05$**\n\n疾病的先验比值：\n$$ \\text{Odds}_{\\text{pre},1} = \\frac{0.05}{1 - 0.05} = \\frac{0.05}{0.95} = \\frac{5}{95} = \\frac{1}{19} $$\n阳性测试后疾病的后验比值：\n$$ \\text{Odds}_{\\text{post},1}(T^+) = \\text{LR}^+ \\times \\text{Odds}_{\\text{pre},1} = 16 \\times \\frac{1}{19} = \\frac{16}{19} $$\n$p=0.05$ 时的 PPV：\n$$ \\text{PPV}_1 = \\frac{16/19}{1 + 16/19} = \\frac{16/19}{35/19} = \\frac{16}{35} $$\n无病的先验比值：\n$$ \\text{Odds}_{\\text{pre},1}(D^c) = \\frac{1-0.05}{0.05} = \\frac{0.95}{0.05} = 19 $$\n阴性测试后无病的后验比值：\n$$ \\text{Odds}_{\\text{post},1}(D^c | T^-) = \\left( \\frac{\\text{Sp}}{1 - \\text{Se}} \\right) \\times \\text{Odds}_{\\text{pre},1}(D^c) = \\frac{19}{4} \\times 19 = \\frac{361}{4} $$\n$p=0.05$ 时的 NPV：\n$$ \\text{NPV}_1 = \\frac{361/4}{1 + 361/4} = \\frac{361/4}{365/4} = \\frac{361}{365} $$\n\n**情况2：患病率 $p = 0.50$**\n\n疾病的先验比值：\n$$ \\text{Odds}_{\\text{pre},2} = \\frac{0.50}{1 - 0.50} = \\frac{0.50}{0.50} = 1 $$\n阳性测试后疾病的后验比值：\n$$ \\text{Odds}_{\\text{post},2}(T^+) = \\text{LR}^+ \\times \\text{Odds}_{\\text{pre},2} = 16 \\times 1 = 16 $$\n$p=0.50$ 时的 PPV：\n$$ \\text{PPV}_2 = \\frac{16}{1 + 16} = \\frac{16}{17} $$\n无病的先验比值：\n$$ \\text{Odds}_{\\text{pre},2}(D^c) = \\frac{1-0.50}{0.50} = 1 $$\n阴性测试后无病的后验比值：\n$$ \\text{Odds}_{\\text{post},2}(D^c | T^-) = \\left( \\frac{\\text{Sp}}{1 - \\text{Se}} \\right) \\times \\text{Odds}_{\\text{pre},2}(D^c) = \\frac{19}{4} \\times 1 = \\frac{19}{4} $$\n$p=0.50$ 时的 NPV：\n$$ \\text{NPV}_2 = \\frac{19/4}{1 + 19/4} = \\frac{19/4}{23/4} = \\frac{19}{23} $$\n\n**预测值总结：**\n当 $p=0.05$ 时：$\\text{PPV}_1 = \\frac{16}{35} \\approx 0.4571$，$\\text{NPV}_1 = \\frac{361}{365} \\approx 0.9890$\n当 $p=0.50$ 时：$\\text{PPV}_2 = \\frac{16}{17} \\approx 0.9412$，$\\text{NPV}_2 = \\frac{19}{23} \\approx 0.8261$\n\n**最终计算：比率 $r$**\n\n问题要求计算比率 $ r = \\dfrac{\\text{PPV at } p = 0.50}{\\text{PPV at } p = 0.05} $。\n$$ r = \\frac{\\text{PPV}_2}{\\text{PPV}_1} = \\frac{16/17}{16/35} = \\frac{16}{17} \\times \\frac{35}{16} = \\frac{35}{17} $$\n现在，我们计算其数值并四舍五入至四位有效数字。\n$$ r = \\frac{35}{17} \\approx 2.0588235... $$\n四舍五入至四位有效数字得到 $2.059$。",
            "answer": "$$\\boxed{2.059}$$"
        },
        {
            "introduction": "当我们评价一个诊断测试时，通常不满足于单一决策阈值下的表现，而是希望有一个能概括其在所有可能阈值下整体区分能力的综合指标。ROC曲线下面积（Area Under the Curve, AUC）正是这样一个强大的工具，它不仅是一个几何面积，更代表着一个病例的测试得分高于一个非病例的概率。通过这个编程练习 ，你将从这一概率解释出发，亲手实现一个非参数的AUC估计算法，从而深刻理解AUC的本质。",
            "id": "4607911",
            "problem": "给定两组独立群体的经验性诊断标志物测量值：患病病例组和非患病对照组。基本原理如下。对于一个阈值 $t$，灵敏度（真阳性率）定义为 $\\mathrm{TPR}(t) = \\mathbb{P}(X_1 \\ge t)$，特异性定义为 $\\mathrm{TNR}(t) = \\mathbb{P}(X_0  t)$，其中 $X_1$ 表示病例组中的标志物，$X_0$ 表示对照组中的标志物。受试者工作特征（ROC）曲线是映射 $t \\mapsto (\\mathrm{FPR}(t), \\mathrm{TPR}(t))$，其中 $\\mathrm{FPR}(t) = 1 - \\mathrm{TNR}(t) = \\mathbb{P}(X_0 \\ge t)$。曲线下面积（AUC）概括了所有阈值下的 ROC 曲线，是衡量病例与对照组之间区分能力的指标。\n\n仅从这些定义出发，推导一个算法，仅使用病例组和对照组的经验性标志物值来计算 AUC 的非参数估计，而不假设 $X_1$ 或 $X_0$ 的任何参数分布。你的算法还必须提供一个版本，用于在病例和对照组之间出现相等标志物值时，对数据中的结（tie）进行校正。\n\n你的程序必须从第一性原理出发实现以下两种方法：\n- 一种朴素的非参数 AUC 估计，它将标志物值相等的病例-对照对视为对区分能力贡献为零。\n- 一种经过结校正的非参数 AUC 估计，它为标志物值相等的对子分配 0.5 的区分贡献。\n\n使用以下测试套件，每个测试用例包含 $n_1 = 50$ 个病例值和 $n_0 = 60$ 个对照值：\n\n- 测试用例 1（有重叠无结）：\n  - 对照组：$C_i = i$，对于 $i \\in \\{0,1,2,\\dots,59\\}$。\n  - 病例组：$D_j = j + 0.5$，对于 $j \\in \\{20,21,\\dots,69\\}$。\n  这会产生病例值在 $\\{20.5,21.5,\\dots,69.5\\}$ 范围内，对照值在 $\\{0,1,\\dots,59\\}$ 范围内，因此存在重叠，但任何病例和对照值之间没有完全相等的情况。\n\n- 测试用例 2（有重叠有结）：\n  - 对照组：$C_i = i$，对于 $i \\in \\{0,1,2,\\dots,59\\}$。\n  - 病例组：$D_j = j$，对于 $j \\in \\{20,21,\\dots,69\\}$。\n  这会产生病例值在 $\\{20,21,\\dots,69\\}$ 范围内，对照值在 $\\{0,1,\\dots,59\\}$ 范围内，因此在 20 到 59 的所有整数上都存在结。\n\n- 测试用例 3（完全结的边缘情况）：\n  - 对照组：$C_i = 50$，对于 $i \\in \\{1,2,\\dots,60\\}$。\n  - 病例组：$D_j = 50$，对于 $j \\in \\{1,2,\\dots,50\\}$。\n  所有病例和对照组的值都相等。\n\n对于每个测试用例，你的输出必须是一个包含两个小数的列表：$\\left[\\text{AUC}_{\\text{naive}}, \\text{AUC}_{\\text{tie-corrected}}\\right]$，其中两项都是上述定义的非参数估计。将所有值表示为小数（而非百分比），并四舍五入到六位小数。\n\n最终输出格式：你的程序应生成单行输出，包含三个测试用例的结果，格式为方括号括起来的、以逗号分隔的列表的列表，例如 $\\left[[a_1,b_1],[a_2,b_2],[a_3,b_3]\\right]$，其中 $a_k$ 和 $b_k$ 是测试用例 $k$ 的两个 AUC 估计值。不应打印任何其他文本。",
            "solution": "问题要求推导并实现一个非参数算法，用于计算受试者工作特征曲线下面积（AUC），包括处理结值的版本。\n\n### 从第一性原理推导\n\n曲线下面积（AUC）是衡量诊断测试整体性能的一个指标。从几何上看，它是受试者工作特征（ROC）曲线下的面积，该曲线绘制了在所有可能的阈值 $t$ 下，真阳性率（TPR）相对于假阳性率（FPR）的图形。给定的定义是：\n- 真阳性率（灵敏度）：$\\mathrm{TPR}(t) = \\mathbb{P}(X_1 \\ge t)$，其中 $X_1$ 是患病病例的标志物值。\n- 假阳性率：$\\mathrm{FPR}(t) = \\mathbb{P}(X_0 \\ge t)$，其中 $X_0$ 是非患病对照的标志物值。\n\nAUC 是 ROC 曲线 $y(x)$ 从 $0$ 到 $1$ 对 $x$ 的积分：\n$$ \\mathrm{AUC} = \\int_0^1 \\mathrm{TPR} \\, d(\\mathrm{FPR}) $$\n$\\mathrm{TPR}$ 和 $\\mathrm{FPR}$ 都是阈值 $t$ 的函数。为了推导，我们假设 $X_1$ 和 $X_0$ 是连续随机变量，其概率密度函数（PDF）分别为 $f_1(t)$ 和 $f_0(t)$。然而，最终的算法将不依赖于此假设。\n\n在连续性假设下，$\\mathrm{FPR}(t) = \\int_t^\\infty f_0(u) \\, du$。其微分为 $d(\\mathrm{FPR}) = \\frac{d}{dt} \\left( \\int_t^\\infty f_0(u) \\, du \\right) dt = -f_0(t) \\, dt$。\n当阈值 $t$ 从 $-\\infty$ 扫描到 $+\\infty$ 时，$\\mathrm{FPR}(t)$ 从 $1$ 扫描到 $0$。我们将积分变量从 $\\mathrm{FPR}$ 更改为 $t$：\n$$ \\mathrm{AUC} = \\int_{t=+\\infty}^{t=-\\infty} \\mathrm{TPR}(t) (-f_0(t)) \\, dt = \\int_{-\\infty}^{+\\infty} \\mathrm{TPR}(t) f_0(t) \\, dt $$\n代入定义 $\\mathrm{TPR}(t) = \\mathbb{P}(X_1 \\ge t) = \\int_t^\\infty f_1(u) \\, du$：\n$$ \\mathrm{AUC} = \\int_{-\\infty}^{+\\infty} \\left( \\int_t^\\infty f_1(u) \\, du \\right) f_0(t) \\, dt $$\n这是一个在 $-\\infty   t  \\infty$ 和 $t \\le u  \\infty$ 定义的区域上的二重积分。我们可以将其重写为：\n$$ \\mathrm{AUC} = \\iint_{u \\ge t} f_1(u) f_0(t) \\, du \\, dt $$\n由于 $X_1$ 和 $X_0$ 是独立的，它们的联合概率密度函数是 $f_1(u)f_0(t)$。该积分表示从 $X_1$ 中随机抽取的值（记为 $u$）大于或等于从 $X_0$ 中随机抽取的值（记为 $t$）的概率。对于连续变量，$\\mathbb{P}(X_1=X_0)=0$，因此这可以简化。于是，我们得出了 AUC 的深刻概率解释：\n$$ \\mathrm{AUC} = \\mathbb{P}(X_1 > X_0) $$\n这个结果表明，AUC 是指随机选择一个病例的标志物值高于随机选择一个对照的标志物值的概率。这个解释是构建非参数估计量的关键。\n\n### 非参数估计\n\n给定 $n_1$ 个病例值的经验样本 $\\{d_1, d_2, \\dots, d_{n_1}\\}$ 和 $n_0$ 个对照值的经验样本 $\\{c_1, c_2, \\dots, c_{n_0}\\}$，我们可以直接估计这个概率。我们构建所有 $n_1 \\times n_0$ 个可能的病例-对照对 $(d_j, c_i)$，并计算满足期望条件的对的比例。\n\n**1. 朴素非参数 AUC 估计**\n\n问题要求一种估计方法，其中结对区分能力的贡献为零。这直接对应于估计 $\\mathbb{P}(X_1 > X_0)$。我们计算病例值严格大于对照值的对的数量。令 $\\mathbf{1}_{d_j > c_i}$ 为一个指示函数，如果 $d_j > c_i$，则其值为 $1$，否则为 $0$。该估计为：\n$$ \\widehat{\\mathrm{AUC}}_{\\text{naive}} = \\frac{1}{n_1 n_0} \\sum_{j=1}^{n_1} \\sum_{i=1}^{n_0} \\mathbf{1}_{d_j > c_i} $$\n\n**2. 结校正的非参数 AUC 估计**\n\n当标志物值是离散的或以有限精度测量时，可能会出现结（$d_j = c_i$）。问题指定，对于结校正的估计，结对获得“一半的贡献”。此方法估计了一致性概率更一般的形式，$\\mathbb{P}(X_1 > X_0) + 0.5 \\cdot \\mathbb{P}(X_1 = X_0)$。\n\n我们定义一个评分函数 $S(d_j, c_i)$：\n$$ S(d_j, c_i) = \\begin{cases} 1  \\text{若 } d_j > c_i \\\\ 0.5  \\text{若 } d_j = c_i \\\\ 0  \\text{若 } d_j  c_i \\end{cases} $$\n结校正的 AUC 估计是所有对的平均分：\n$$ \\widehat{\\mathrm{AUC}}_{\\text{tie-corrected}} = \\frac{1}{n_1 n_0} \\sum_{j=1}^{n_1} \\sum_{i=1}^{n_0} S(d_j, c_i) $$\n这是 AUC 的标准非参数定义，等同于 Mann-Whitney U 统计量除以总对数。\n\n### 算法实现\n\n该算法直接源于这些估计公式。对于给定的病例和对照值数组：\n1. 初始化两个计数器 `numerator_naive` 和 `numerator_tie_corrected` 为 $0$。\n2. 遍历病例数据中的每个病例值 $d_j$。\n3. 对于每个 $d_j$，遍历对照数据中的每个对照值 $c_i$。\n4.  比较 $d_j$ 和 $c_i$：\n    - 如果 $d_j > c_i$，将 `numerator_naive` 增加 $1$，并将 `numerator_tie_corrected` 增加 $1$。\n    - 如果 $d_j = c_i$，将 `numerator_tie_corrected` 增加 $0.5$。\n    - 如果 $d_j  c_i$，不进行任何操作。\n5. 循环完成后，计算总对数 $N_{pairs} = n_1 \\times n_0$。\n6. 计算最终估计值：\n   - $\\widehat{\\mathrm{AUC}}_{\\text{naive}} = \\text{numerator\\_naive} / N_{pairs}$\n   - $\\widehat{\\mathrm{AUC}}_{\\text{tie-corrected}} = \\text{numerator\\_tie\\_corrected} / N_{pairs}$\n7. 将结果四舍五入到所需的六位小数。\n\n该算法是非参数的，因为它只使用数据的秩，而不使用其具体值或任何假定的底层分布。它具有鲁棒性，并直接实现了推导出的原理。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_auc(cases, controls):\n    \"\"\"\n    Computes nonparametric AUC estimates based on pairwise comparisons.\n\n    Args:\n        cases (array-like): A list or numpy array of marker values for the case group.\n        controls (array-like): A list or numpy array of marker values for the control group.\n\n    Returns:\n        A list containing two floats:\n        - The naive AUC estimate (ties count as 0).\n        - The tie-corrected AUC estimate (ties count as 0.5).\n    \"\"\"\n    n1 = len(cases)\n    n0 = len(controls)\n\n    if n1 == 0 or n0 == 0:\n        return [0.0, 0.0]\n\n    numerator_naive = 0\n    numerator_tie_corrected = 0.0\n\n    # Iterate through all case-control pairs\n    for d_val in cases:\n        for c_val in controls:\n            if d_val > c_val:\n                numerator_naive += 1\n                numerator_tie_corrected += 1.0\n            elif d_val == c_val:\n                numerator_tie_corrected += 0.5\n    \n    denominator = n1 * n0\n    \n    auc_naive = numerator_naive / denominator\n    auc_tie_corrected = numerator_tie_corrected / denominator\n    \n    return [auc_naive, auc_tie_corrected]\n\ndef solve():\n    \"\"\"\n    Defines the test cases, computes AUC for each, and prints the formatted result.\n    \"\"\"\n    # Test case 1: Overlap without ties\n    # n1 = 50, n0 = 60\n    controls1 = np.arange(60, dtype=float)  # C_i = i for i in {0, ..., 59}\n    cases1 = np.arange(20, 70, dtype=float) + 0.5  # D_j = j + 0.5 for j in {20, ..., 69}\n\n    # Test case 2: Overlap with ties\n    # n1 = 50, n0 = 60\n    controls2 = np.arange(60, dtype=float)  # C_i = i for i in {0, ..., 59}\n    cases2 = np.arange(20, 70, dtype=float)  # D_j = j for j in {20, ..., 69}\n\n    # Test case 3: Complete tie edge case\n    # n1 = 50, n0 = 60\n    controls3 = np.full(60, 50.0)\n    cases3 = np.full(50, 50.0)\n\n    test_cases = [\n        (cases1, controls1),\n        (cases2, controls2),\n        (cases3, controls3)\n    ]\n\n    results = []\n    for case in test_cases:\n        cases, controls = case\n        result = calculate_auc(cases, controls)\n        results.append(result)\n\n    # Format the output string as per the problem specification.\n    # e.g., [[a1,b1],[a2,b2],[a3,b3]] with 6 decimal places.\n    outer_list_str = []\n    for res_pair in results:\n        # Format each float to 6 decimal places.\n        inner_list_str = f\"[{res_pair[0]:.6f},{res_pair[1]:.6f}]\"\n        outer_list_str.append(inner_list_str)\n    \n    final_output = f\"[{','.join(outer_list_str)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "一个高的AUC值是否就等同于一个在临床上更有用的模型？这个问题将我们引向区分度（discrimination）和校准度（calibration）这两个核心概念的辨析。对于临床决策而言，一个预测模型的实际效用至关重要，而这并不仅仅由其区分能力决定。这个练习  构建了一个精巧的场景，让你通过计算净获益（Net Benefit），来比较两个具有相同AUC但临床效用不同的模型，从而体会到超越AUC、进行更全面模型评估的重要性。",
            "id": "4607812",
            "problem": "一项流行病学研究考虑了两个二元结局预测模型，这两个模型在一个由 $i=1,\\dots,20$ 索引的 $N=20$ 名个体组成的队列上进行了评估。对于模型 $A$，给出的预测概率 $p_{A,i}$ 和观测结局 $Y_i \\in \\{0,1\\}$ 如下：\n- $i=1$: $p_{A,1}=0.85$, $Y_1=1$\n- $i=2$: $p_{A,2}=0.80$, $Y_2=1$\n- $i=3$: $p_{A,3}=0.75$, $Y_3=1$\n- $i=4$: $p_{A,4}=0.70$, $Y_4=1$\n- $i=5$: $p_{A,5}=0.60$, $Y_5=1$\n- $i=6$: $p_{A,6}=0.55$, $Y_6=1$\n- $i=7$: $p_{A,7}=0.50$, $Y_7=1$\n- $i=8$: $p_{A,8}=0.45$, $Y_8=0$\n- $i=9$: $p_{A,9}=0.40$, $Y_9=1$\n- $i=10$: $p_{A,10}=0.35$, $Y_{10}=0$\n- $i=11$: $p_{A,11}=0.30$, $Y_{11}=0$\n- $i=12$: $p_{A,12}=0.25$, $Y_{12}=0$\n- $i=13$: $p_{A,13}=0.22$, $Y_{13}=1$\n- $i=14$: $p_{A,14}=0.18$, $Y_{14}=0$\n- $i=15$: $p_{A,15}=0.15$, $Y_{15}=0$\n- $i=16$: $p_{A,16}=0.12$, $Y_{16}=0$\n- $i=17$: $p_{A,17}=0.10$, $Y_{17}=0$\n- $i=18$: $p_{A,18}=0.08$, $Y_{18}=0$\n- $i=19$: $p_{A,19}=0.06$, $Y_{19}=0$\n- $i=20$: $p_{A,20}=0.04$, $Y_{20}=0$\n\n模型 $B$ 通过对模型 $A$ 输出的单调变换 $p_{B,i}=(p_{A,i})^2$ 定义，因此两个模型按风险对个体进行的排序是相同的，但数值校准不同。考虑通过单一阈值概率 $p_t=0.20$ 进行分类：如果模型的预测概率至少为 $p_t$，则将个体分类为检测阳性，否则分类为检测阴性。假设基于此分类的决策旨在最大化阈值 $p_t$ 下的决策分析净获益。\n\n仅使用敏感性、特异性、受试者工作特征（ROC）排序、ROC曲线下面积（AUC）、似然比和基于阈值的决策分析的基本定义，确定哪个选项正确说明了哪个模型在阈值 $p_t=0.20$ 下产生更大的决策分析净获益，并解释原因。请注意，模型 $A$ 对这些数据校准良好，而模型 $B$ 由于其变换而校准不良。\n\n选择一项：\n- A. 模型 $A$ 在 $p_t=0.20$ 时产生更高的净获益，因为尽管受试者工作特征曲线下面积（AUC）相同，其校准将更多的真病例置于阈值之上，并且在给定 $p_t$ 权衡的情况下，假阳性的增加是可接受的。\n- B. 模型 $B$ 在 $p_t=0.20$ 时产生更高的净获益，因为其更高的特异性和更大的阳性似然比总是意味着在任何阈值下都有更高的净获益。\n- C. 两个模型在 $p_t=0.20$ 时产生相等的净获益，因为相等的AUC意味着在任何阈值下性能都相等。\n- D. 模型 $B$ 在 $p_t=0.20$ 时产生更高的净获益，因为当AUC相等时，降低概率的校准不良会减少过度治疗，从而提高净获益。",
            "solution": "问题要求确定在指定的概率阈值 $p_t = 0.20$ 下，两个预测模型（模型 $A$ 或模型 $B$）中哪一个产生更高的决策分析净获益。分析将首先验证问题，然后根据基本定义推导每个模型的净获益，最后评估每个选项。\n\n首先，我们从问题陈述中汇编必要信息。该队列由 $N=20$ 名个体组成。我们必须确定有结局的个体（病例，$Y=1$）和无结局的个体（非病例，$Y=0$）的数量。\n- 病例 ($D$)：$Y_i=1$ 的个体是 $i \\in \\{1, 2, 3, 4, 5, 6, 7, 9, 13\\}$。病例总数为 $D = 9$。\n- 非病例 ($H$)：$Y_i=0$ 的个体是 $i \\in \\{8, 10, 11, 12, 14, 15, 16, 17, 18, 19, 20\\}$。非病例总数为 $H=11$。\n受试者总数为 $N = D+H = 9+11=20$，这与问题陈述一致。\n\n决策阈值给定为 $p_t = 0.20$。如果个体的预测概率大于或等于 $p_t$，则分类为检测阳性，否则分类为检测阴性。\n\n在阈值 $p_t$ 下的决策分析净获益（NB）定义为：\n$$NB(p_t) = \\frac{TP}{N} - \\frac{FP}{N} \\cdot \\frac{p_t}{1-p_t}$$\n其中 $TP$ 是真阳性数量，$FP$ 是假阳性数量，$N$ 是个体总数。项 $\\frac{p_t}{1-p_t}$ 代表在阈值下结局的比值，它定义了假阳性与真阳性的相对成本。对于 $p_t=0.20$，这种权衡是 $\\frac{0.20}{1-0.20} = \\frac{0.20}{0.80} = \\frac{1}{4}$。\n\n**模型A的分析**\n对于模型 $A$，如果 $p_{A,i} \\ge 0.20$，个体被分类为检测阳性。我们检查所提供的数据，找出哪些个体满足此标准，并确定他们是真阳性还是假阳性。\n- $p_{A,i} \\ge 0.20$ 的个体：这些是 $i = 1, \\dots, 13$ 的个体。\n- 模型A的真阳性 ($TP_A$)：这些是 $p_{A,i} \\ge 0.20$ 的病例 ($Y_i=1$)。\n  - 个体 $1, 2, 3, 4, 5, 6, 7, 9, 13$ 是病例。他们的 $p_{A,i}$ 都 $\\ge 0.22 > 0.20$。\n  - 因此，$TP_A = 9$。\n- 模型A的假阳性 ($FP_A$)：这些是 $p_{A,i} \\ge 0.20$ 的非病例 ($Y_i=0$)。\n  - 个体 $8, 10, 11, 12$ 是非病例。他们的概率分别是 $0.45, 0.35, 0.30, 0.25$，所有这些都 $\\ge 0.20$。\n  - 因此，$FP_A = 4$。\n\n现在，我们计算模型A在 $p_t=0.20$ 时的净获益：\n$$NB_A(0.20) = \\frac{TP_A}{N} - \\frac{FP_A}{N} \\cdot \\frac{0.20}{1-0.20} = \\frac{9}{20} - \\frac{4}{20} \\cdot \\frac{1}{4}$$\n$$NB_A(0.20) = \\frac{9}{20} - \\frac{1}{20} = \\frac{8}{20} = 0.40$$\n\n**模型B的分析**\n对于模型B，预测概率为 $p_{B,i} = (p_{A,i})^2$。如果 $p_{B,i} \\ge 0.20$，则个体被分类为检测阳性。此条件等价于 $(p_{A,i})^2 \\ge 0.20$，可简化为 $p_{A,i} \\ge \\sqrt{0.20}$。\n$\\sqrt{0.20} = \\sqrt{1/5} = 1/\\sqrt{5} \\approx 0.4472$。\n因此，对于模型B，分类规则等同于基于模型A的概率，使用一个更高的有效阈值，约为 $0.4472$。\n\n我们找到满足标准 $p_{A,i} \\ge 0.4472$ 的个体：\n- $p_{A,i} \\ge 0.4472$ 的个体：这些是 $i = 1, \\dots, 8$ 的个体。\n- 模型B的真阳性 ($TP_B$)：这些是 $p_{A,i} \\ge 0.4472$ 的病例 ($Y_i=1$)。\n  - 个体 $1, 2, 3, 4, 5, 6, 7$ 是病例，其概率 $\\ge 0.50$。\n  - 因此，$TP_B = 7$。\n- 模型B的假阳性 ($FP_B$)：这些是 $p_{A,i} \\ge 0.4472$ 的非病例 ($Y_i=0$)。\n  - 个体 $8$ 是一个非病例，其 $p_{A,8} = 0.45 \\ge 0.4472$。\n  - 因此，$FP_B = 1$。\n\n现在，我们计算模型B的净获益。至关重要的是，在净获益公式中使用决策阈值 $p_t=0.20$，因为这个值反映了决策者的偏好，而不是模型的内部概率标度。\n$$NB_B(0.20) = \\frac{TP_B}{N} - \\frac{FP_B}{N} \\cdot \\frac{0.20}{1-0.20} = \\frac{7}{20} - \\frac{1}{20} \\cdot \\frac{1}{4}$$\n$$NB_B(0.20) = \\frac{7}{20} - \\frac{1}{80} = \\frac{28}{80} - \\frac{1}{80} = \\frac{27}{80} = 0.3375$$\n\n**净获益的比较**\n比较这两个模型，我们发现 $NB_A(0.20) = 0.40$ 和 $NB_B(0.20) = 0.3375$。\n显然，$NB_A(0.20) > NB_B(0.20)$。在决策阈值 $p_t=0.20$ 下，模型A提供了更大的净获益。\n\n**选项评估**\n\n- **A. 模型 $A$ 在 $p_t=0.20$ 时产生更高的净获益，因为尽管受试者工作特征曲线下面积（AUC）相同，其校准将更多的真病例置于阈值之上，并且在给定 $p_t$ 权衡的情况下，假阳性的增加是可接受的。**\n  - 结论“模型 $A$ 在 $p_t=0.20$ 时产生更高的净获益”与我们的计算（$0.40 > 0.3375$）一致。\n  - “受试者工作特征曲线下面积（AUC）相同”的说法是正确的。由于 $p_{B,i}=(p_{A,i})^2$ 是一个严格单调的变换，两个模型按预测概率对个体进行的排序是相同的。由于ROC曲线是基于这个排序构建的，所以ROC曲线——以及AUC——是相同的。\n  - 模型A“将更多的真病例置于阈值之上”的说法是正确的（$TP_A=9$ vs $TP_B=7$）。\n  - “假阳性增加是可接受的”说法也是正确的。模型A有 $FP_A=4$ 个假阳性，而模型B有 $FP_B=1$ 个，增加了 $3$ 个。这种权衡（为增加 $3$ 个假阳性而获得 $2$ 个真阳性）导致了更高的净获益，使其在 $p_t=0.20$ 决策阈值的背景下是“可接受的”。模型A的优越校准使其原始概率输出在给定的阈值 $p_t$ 下成为更好的行动指南。该选项与分析完全一致。\n  - 结论：**正确**。\n\n- **B. 模型 $B$ 在 $p_t=0.20$ 时产生更高的净获益，因为其更高的特异性和更大的阳性似然比总是意味着在任何阈值下都有更高的净获益。**\n  - 前提“模型 $B$ 产生更高的净获益”是错误的。\n  - 让我们检查一下由阈值 $p_t=0.20$ 定义的工作点的附带声明。模型A的敏感性和特异性分别为 $TPR_A = TP_A/D = 9/9 = 1.0$ 和 $Spec_A = (H-FP_A)/H = (11-4)/11 = 7/11$。假阳性率为 $FPR_A = 1 - Spec_A = 4/11$。对于模型B，$TPR_B = 7/9$，$Spec_B = (11-1)/11=10/11$。所以，$Spec_B > Spec_A$。阳性似然比为 $LR+_A = TPR_A/FPR_A = 1.0 / (4/11) = 2.75$ 和 $LR+_B = TPR_B/FPR_B = (7/9)/(1/11) = 77/9 \\approx 8.56$。所以 $LR+_B > LR+_A$。虽然这两个声明对于特定的分类点是正确的，但“这总是意味着在任何阈值下都有更高的净获益”的一般性断言是不正确的。净获益取决于TPR和FPR之间的具体权衡，而这种权衡由 $p_t$ 决定。\n  - 结论：**错误**。\n\n- **C. 两个模型在 $p_t=0.20$ 时产生相等的净获益，因为相等的AUC意味着在任何阈值下性能都相等。**\n  - 前提“两个模型产生相等的净获益”是错误的。\n  - 理由“相等的AUC意味着在任何阈值下性能都相等”是对这些指标的基本误解。AUC衡量的是在所有阈值下的整体区分能力（排序能力），而不是在单个特定阈值下的性能。影响特定阈值下性能的校准度，并未被AUC所捕获。\n  - 结论：**错误**。\n\n- **D. 模型 $B$ 在 $p_t=0.20$ 时产生更高的净获益，因为当AUC相等时，降低概率的校准不良会减少过度治疗，从而提高净获益。**\n  - 前提“模型 $B$ 产生更高的净获益”是错误的。\n  - 这个理由是有缺陷的。虽然模型B的校准不良确实导致了更少的假阳性（$FP_B=1$ vs $FP_A=4$）——减少了可以称之为“过度治疗”的情况——但这是以漏掉真阳性为代价的（$TP_B=7$ vs $TP_A=9$）。在这种情况下，以净获益衡量的对效用的净效应是负的。减少假阳性并不会自动提高净获益；与真阳性的平衡才是关键。\n  - 结论：**错误**。\n\n总之，模型A产生更高的净获益，因为它校准得更好。将决策阈值 $p_t=0.20$ 应用于模型A校准良好的概率，与将相同阈值应用于模型B校准不良的概率相比，会得到更优的分类决策。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}