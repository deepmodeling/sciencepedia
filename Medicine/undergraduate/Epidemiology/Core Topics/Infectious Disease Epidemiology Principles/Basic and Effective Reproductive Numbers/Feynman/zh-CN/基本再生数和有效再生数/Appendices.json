{
    "hands_on_practices": [
        {
            "introduction": "要深刻理解一个概念，追本溯源是最好的方法。本练习将带你回到基本再生数 $R_0$ 的数学源头，让你从经典的 SIR 房室模型中亲手推导出它 。通过这个推导过程，你将巩固对传播率（$\\beta$）、恢复率（$\\gamma$）和人口动态率（$\\mu$）如何共同决定疾病能否在人群中成功入侵的理解。",
            "id": "4572539",
            "problem": "一种直接传播的传染病在一个大小恒定为 $N$ 的均匀混合宿主种群中传播，该种群通过每天人均出生率和死亡率为 $\\mu$ 来维持恒定。该疾病由以下具有标准发病率的易感-感染-移除（SIR）常微分方程（ODE）系统描述：\n$$\n\\frac{dS}{dt}=\\mu N-\\frac{\\beta S I}{N}-\\mu S,\\quad\n\\frac{dI}{dt}=\\frac{\\beta S I}{N}-(\\gamma+\\mu) I,\\quad\n\\frac{dR}{dt}=\\gamma I-\\mu R,\n$$\n其中 $\\beta$ 是每天的有效传播率，$\\gamma$ 是每天的恢复率，$\\mu$ 是每天的自然更替（出生和死亡）率。从基本再生数（基本再生数 (BRN) 是指在一个完全易感的种群中，由单个典型感染者引入所引起的预期继发感染数）的定义出发，通过在无病平衡点附近进行线性化，推导出基本再生数 $R_0$ 关于 $\\beta$、$\\gamma$ 和 $\\mu$ 的符号表达式，然后计算当 $\\beta=0.25$/天、$\\gamma=0.1$/天和 $\\mu=0.02$/天时的值。将您的数值结果四舍五入至四位有效数字，并以无量纲数的形式报告。最后，根据第一性原理，简要解释在该模型结构下当 $R_01$ 时预期的流行病地方性结果，不要使用任何预先记忆的快捷公式。",
            "solution": "问题陈述经验证在科学上是合理的、适定的和客观的。它提出了一个带有生命动力学的标准 SIR 模型，并要求推导和解释基本再生数，这是数理流行病学中的一项基本任务。所提供的方程和定义是标准的且自洽的。因此，该问题是有效的。\n\n基本再生数 $R_0$ 的推导是通过分析流行病的初始阶段来进行的，在该阶段，少量感染者被引入到一个几乎完全易感的种群中。这对应于在无病平衡点（DFE）附近对系统进行线性化。\n\n首先，我们确定无病平衡点。这是一个稳态 $(\\frac{dS}{dt}=\\frac{dI}{dt}=\\frac{dR}{dt}=0)$，其中没有感染，即 $I=0$。\n将 $I=0$ 代入方程组可得：\n$$\n\\frac{dS}{dt} = \\mu N - \\mu S = 0 \\implies S = N\n$$\n$$\n\\frac{dR}{dt} = -\\mu R = 0 \\implies R = 0\n$$\n因此，无病平衡点为 $(S_0, I_0, R_0) = (N, 0, 0)$。在此平衡点，整个种群都是易感的，出生与死亡完全平衡。\n\n接下来，我们分析引入此无病平衡点状态的少量感染者（$I \\ll N$）的演变。在此情况下，易感种群近似恒定于 $S \\approx N$。感染类的动力学由以下方程决定：\n$$\n\\frac{dI}{dt} = \\frac{\\beta S I}{N} - (\\gamma + \\mu) I\n$$\n通过代入 $S=N$ 在无病平衡点附近进行线性化，我们得到关于 $I$ 初始增长的线性常微分方程：\n$$\n\\frac{dI}{dt} \\approx \\frac{\\beta N I}{N} - (\\gamma + \\mu) I = (\\beta - (\\gamma + \\mu)) I\n$$\n如果右侧的系数为正，即 $\\beta - (\\gamma + \\mu)  0$，感染人数将呈指数增长。这个条件标志着流行病的开始。\n\n为了从其定义推导 $R_0$，我们考虑单个感染者。个体通过康复（速率为 $\\gamma$）或死亡（速率为 $\\mu$）离开感染类。因此，离开感染类的总速率是 $\\gamma + \\mu$。平均感染期是该速率的倒数，即 $\\frac{1}{\\gamma + \\mu}$。\n在此期间，该个体处于一个几乎完全易感的种群中 ($S \\approx N$)，因此该个体产生新感染的速率为 $\\frac{\\beta S}{N} \\approx \\frac{\\beta N}{N} = \\beta$。\n$R_0$ 是产生的继发感染总数，它是新感染产生速率与平均感染期的乘积：\n$$\nR_0 = (\\text{新感染产生速率}) \\times (\\text{平均感染期})\n$$\n$$\nR_0 = \\beta \\times \\frac{1}{\\gamma + \\mu} = \\frac{\\beta}{\\gamma + \\mu}\n$$\n该表达式是无量纲的，因为 $\\beta$、$\\gamma$ 和 $\\mu$ 的单位都是时间的倒数（例如，天$^{-1}$）。流行病发生的条件 $\\beta  \\gamma + \\mu$ 等价于 $R_0  1$。\n\n现在，我们使用给定的参数值来计算该表达式：$\\beta=0.25$ 天$^{-1}$，$\\gamma=0.1$ 天$^{-1}$，以及 $\\mu=0.02$ 天$^{-1}$。\n$$\nR_0 = \\frac{0.25}{0.1 + 0.02} = \\frac{0.25}{0.12} = \\frac{25}{12} \\approx 2.08333...\n$$\n四舍五入到四位有效数字，数值为 $2.083$。\n\n最后，我们从第一性原理出发，解释当 $R_0  1$ 时的流行病地方性结果。\n地方性结果是指疾病在种群中持续存在的稳态，即一个平衡点 $(S^*, I^*, R^*)$ 且 $I^*  0$。当 $R_0  1$ 时，每个初始感染病例平均产生超过一个继发病例，导致流行病初期的指数增长。随着流行病的传播，易感个体数 $S$ 从其初始值 $N$ 开始减少。\n流行病的增长取决于有效再生数 $R_e$，即在给定时间 $t$ 每个感染者平均产生的继发病例数。它由 $R_e(t) = R_0 \\frac{S(t)}{N}$ 给出。\n最初，$S(t) \\approx N$，所以 $R_e \\approx R_0  1$，流行病增长。随着 $S(t)$ 减少，$R_e(t)$ 也随之减少。只要 $R_e(t)  1$，感染人数就会继续增加。当新感染的速率与感染者移除的速率完全平衡时，系统将接近一个稳定的地方性平衡。这种平衡恰好发生在有效再生数为 1 时，即 $R_e = 1$。\n在此地方性平衡点，我们有：\n$$\nR_0 \\frac{S^*}{N} = 1 \\implies S^* = \\frac{N}{R_0}\n$$\n由于 $R_0  1$，平衡时的易感种群是总种群的一部分，即 $S^*  N$。正是易感者从 $N$ 减少到 $N/R_0$ 的过程，将传播减慢到了一个自我维持的点。\n由于出生（速率为 $\\mu N$）而不断有新的易感者补充到种群中，这可以防止易感者库完全耗尽，否则将导致流行病消亡。相反，系统会达到一个动态平衡，其中因感染而损失的易感者与因出生而增加的易感者相平衡，从而使病原体能够无限期地持续存在。这种以 $I^*  0$ 为特征的持续存在状态就是地方病状态。从代数上讲，将导数设为零并求解 $I^*$（$I^* \\ne 0$），得到 $I^* = \\frac{\\mu N}{\\gamma+\\mu}(1 - \\frac{1}{R_0})$，该式为正当且仅当 $R_0  1$。这证实了只有当基本再生数超过 1 时，地方性平衡才可能存在。",
            "answer": "$$\n\\boxed{2.083}\n$$"
        },
        {
            "introduction": "现实世界中的人群并非同质化的，年龄等因素会显著改变疾病的传播模式。本练习将超越简单的平均化模型，探讨人口异质性如何影响群体免疫。你将运用下一代矩阵方法 ，比较均一化疫苗接种与针对性策略的差异，从而揭示理解人口结构如何帮助我们制定更高效的公共卫生干预措施。",
            "id": "4572669",
            "problem": "考虑一个在完全易感的宿主群体中直接传播的传染病模型，该群体分为两个年龄组：青年（$Y$）和成年人（$A$）。基本再生数 $R_{0}$ 定义为在完全易感人群中引入一个典型感染者所引起的继发病例的期望数，它等于下一代矩阵的主特征值（谱半径）。在部分免疫的人群中，有效再生数 $R_{\\text{eff}}$ 是经免疫修正后的下一代矩阵的主特征值。\n\n假设存在以下科学上合理的结构。\n\n- 宿主群体由 $\\frac{7}{20}$ 的青年（$w_{Y} = \\frac{7}{20}$）和 $\\frac{13}{20}$ 的成年人（$w_{A} = \\frac{13}{20}$）组成。\n- 未缩放的下一代矩阵的秩为1，可以写成 $K = \\alpha \\, u \\, v^{\\top}$，其中 $u = \\begin{pmatrix}1.0 \\\\ 0.6\\end{pmatrix}$ 编码了 $Y$ 和 $A$ 组中接收接触如何转化为感染，而 $v = \\begin{pmatrix}1.2 \\\\ 0.8\\end{pmatrix}$ 编码了 $Y$ 和 $A$ 组中的感染者如何产生新感染。标量 $\\alpha  0$ 用于缩放传播强度。\n- 基本再生数为 $R_{0} = 2.2$，该值通过 $K$ 的主特征值确定了 $\\alpha$。\n- 免疫是消除性的，并以乘法方式降低易感性。如果 $i \\in \\{Y, A\\}$ 组中有比例为 $p_{i}$ 的个体免疫，则 $i$ 组的易感性乘以 $(1 - p_{i})$。令 $S = \\operatorname{diag}(1 - p_{Y}, \\, 1 - p_{A})$ 表示易感性降低。\n\n任务：\n\n1. 在同质混合免疫情景中，对两个年龄组应用统一的覆盖率 $p$（即 $p_{Y} = p_{A} = p$）。仅使用核心定义（下一代算子的主特征值和群体免疫条件 $R_{\\text{eff}} \\leq 1$），确定将 $R_{\\text{eff}}$ 降至最多为 1 所需的群体免疫阈值 $p_{\\text{hom}}$。将最终答案表示为精确分数。\n\n2. 在年龄结构化免疫情景中，可以按组选择不同的覆盖率 $p_{Y}$ 和 $p_{A}$。仅使用核心定义和相同的群体免疫条件 $R_{\\text{eff}} \\leq 1$，确定实现 $R_{\\text{eff}} \\leq 1$ 所需的最小总免疫比例\n$$\np_{\\text{str}} = w_{Y} \\, p_{Y} + w_{A} \\, p_{A}\n$$\n。您可以通过优化各年龄组的分配来最小化 $p_{\\text{str}}$。将最终答案表示为精确分数。\n\n请将两个答案都以精确分数形式给出（不带百分号）。最终响应应按顺序 $(p_{\\text{hom}}, \\, p_{\\text{str}})$ 列出这两个阈值。",
            "solution": "该问题被评估为有效，因为它基于已建立的流行病学模型原理，具有科学依据，问题设定良好、客观且自洽。\n\n下一代矩阵方法用于确定再生数。基本再生数 $R_{0}$ 是在完全易感人群中下一代矩阵 $K$ 的谱半径（主特征值）。有效再生数 $R_{\\text{eff}}$ 是根据群体免疫调整后的下一代矩阵 $K_{\\text{eff}}$ 的谱半径。\n\n未缩放的下一代矩阵为 $K = \\alpha u v^{\\top}$，这是一个秩为1的矩阵。向量为 $u = \\begin{pmatrix} 1.0 \\\\ 0.6 \\end{pmatrix}$ 和 $v = \\begin{pmatrix} 1.2 \\\\ 0.8 \\end{pmatrix}$。对于形如 $u v^{\\top}$ 的秩一矩阵，其唯一的非零特征值为 $v^{\\top} u$。因此，$K$ 的主特征值为 $\\alpha v^{\\top} u$。\n\n首先，我们必须使用给定的基本再生数 $R_{0} = 2.2$ 来确定缩放常数 $\\alpha$。\n$$\nR_{0} = \\rho(K) = \\alpha v^{\\top} u\n$$\n我们来计算标量积 $v^{\\top} u$：\n$$\nv^{\\top} u = \\begin{pmatrix} 1.2  0.8 \\end{pmatrix} \\begin{pmatrix} 1.0 \\\\ 0.6 \\end{pmatrix} = (1.2)(1.0) + (0.8)(0.6) = 1.2 + 0.48 = 1.68\n$$\n使用给定值 $R_{0} = 2.2$，我们可以解出 $\\alpha$：\n$$\n2.2 = \\alpha (1.68) \\implies \\alpha = \\frac{2.2}{1.68} = \\frac{220}{168} = \\frac{55}{42}\n$$\n\n**1. 同质免疫 ($p_{\\text{hom}}$)**\n\n在同质免疫情景中，每个年龄组中有相同比例 $p$ 的个体免疫，因此 $p_{Y} = p_{A} = p$。每个组的易感性降低了因子 $(1-p)$。这由易感性矩阵 $S$ 表示：\n$$\nS = \\operatorname{diag}(1-p, 1-p) = (1-p)I\n$$\n其中 $I$ 是 $2 \\times 2$ 单位矩阵。\n\n有效下一代矩阵 $K_{\\text{eff}}$ 由 $K_{\\text{eff}} = S K$ 给出。\n$$\nK_{\\text{eff}} = (1-p)I K = (1-p)K\n$$\n$K_{\\text{eff}}$ 的特征值是 $K$ 的特征值的 $(1-p)$ 倍。因此，有效再生数 $R_{\\text{eff}}$ 为：\n$$\nR_{\\text{eff}} = \\rho(K_{\\text{eff}}) = (1-p)\\rho(K) = (1-p)R_{0}\n$$\n群体免疫阈值是确保 $R_{\\text{eff}} \\leq 1$ 的最小疫苗接种覆盖率 $p$。我们通过求解 $R_{\\text{eff}} = 1$ 来找到这个阈值。\n$$\n(1 - p_{\\text{hom}})R_{0} = 1 \\implies 1 - p_{\\text{hom}} = \\frac{1}{R_{0}}\n$$\n$$\np_{\\text{hom}} = 1 - \\frac{1}{R_{0}}\n$$\n代入 $R_{0} = 2.2 = \\frac{11}{5}$：\n$$\np_{\\text{hom}} = 1 - \\frac{1}{11/5} = 1 - \\frac{5}{11} = \\frac{6}{11}\n$$\n\n**2. 年龄结构化免疫 ($p_{\\text{str}}$)**\n\n在年龄结构化免疫情景中，疫苗接种覆盖率 $p_{Y}$ 和 $p_{A}$ 可以不同。易感性矩阵为：\n$$\nS = \\operatorname{diag}(1-p_{Y}, 1-p_{A})\n$$\n有效下一代矩阵是 $K_{\\text{eff}} = S K = S (\\alpha u v^{\\top}) = \\alpha (S u) v^{\\top}$。这是另一个秩一矩阵。其主特征值为：\n$$\nR_{\\text{eff}} = \\rho(K_{\\text{eff}}) = \\alpha v^{\\top} (S u)\n$$\n我们来计算 $v^{\\top} S u$：\n$$\nv^{\\top} S u = \\begin{pmatrix} v_Y  v_A \\end{pmatrix} \\begin{pmatrix} 1-p_Y  0 \\\\ 0  1-p_A \\end{pmatrix} \\begin{pmatrix} u_Y \\\\ u_A \\end{pmatrix} = v_Y u_Y (1-p_Y) + v_A u_A (1-p_A)\n$$\n群体免疫条件 $R_{\\text{eff}} \\leq 1$ 变为：\n$$\n\\alpha \\left( v_Y u_Y (1-p_Y) + v_A u_A (1-p_A) \\right) \\leq 1\n$$\n在阈值处（$R_{\\text{eff}} = 1$），我们有：\n$$\nv_Y u_Y (1-p_Y) + v_A u_A (1-p_A) = \\frac{1}{\\alpha} = \\frac{42}{55}\n$$\n代入乘积值 $v_Y u_Y = 1.2$ 和 $v_A u_A = 0.48$：\n$$\n1.2(1-p_Y) + 0.48(1-p_A) = \\frac{42}{55}\n$$\n$$\n1.2 - 1.2 p_Y + 0.48 - 0.48 p_A = \\frac{42}{55}\n$$\n$$\n1.68 - (1.2 p_Y + 0.48 p_A) = \\frac{42}{55}\n$$\n$$\n1.2 p_Y + 0.48 p_A = 1.68 - \\frac{42}{55} = \\frac{168}{100} - \\frac{42}{55} = \\frac{42}{25} - \\frac{42}{55} = 42\\left(\\frac{11-5}{275}\\right) = 42\\left(\\frac{6}{275}\\right) = \\frac{252}{275}\n$$\n为了简化这个关于 $p_Y$ 和 $p_A$ 的线性约束，我们转换为分数：$1.2 = \\frac{6}{5}$ 和 $0.48 = \\frac{12}{25}$。\n$$\n\\frac{6}{5}p_Y + \\frac{12}{25}p_A = \\frac{252}{275}\n$$\n乘以 $275$（$5, 25, 275$ 的最小公倍数）：\n$$\n275\\left(\\frac{6}{5}\\right)p_Y + 275\\left(\\frac{12}{25}\\right)p_A = 252 \\implies 55(6)p_Y + 11(12)p_A = 252\n$$\n$$\n330 p_Y + 132 p_A = 252\n$$\n除以 $6$：\n$$\n55 p_Y + 22 p_A = 42\n$$\n我们希望在满足此约束以及物理约束 $0 \\leq p_Y \\leq 1$ 和 $0 \\leq p_A \\leq 1$ 的条件下，最小化总免疫比例 $p_{\\text{str}} = w_{Y} p_{Y} + w_{A} p_{A}$。\n目标函数为 $p_{\\text{str}} = \\frac{7}{20} p_Y + \\frac{13}{20} p_A$。这是一个线性规划问题。线性函数在线段（可行域）上的最小值必然出现在其端点之一。端点是直线 $55 p_Y + 22 p_A = 42$ 与单位正方形 $[0,1] \\times [0,1]$ 边界的交点。\n\n一个更直接的解决方法是考虑为每个群体接种的“效率”。我们希望优先为每个接种个体能最大程度减少传播的群体接种。为 $i$ 组中的一个人接种的“成本”是他们的人口比例 $w_i$，而“效益”是他们对群体免疫约束的贡献，即 $p_i$ 的系数。\n对于 $Y$ 组：效益为 $55$，成本为 $w_Y = \\frac{7}{20}$。效率 $\\propto \\frac{55}{7/20} = \\frac{1100}{7} \\approx 157$。\n对于 $A$ 组：效益为 $22$，成本为 $w_A = \\frac{13}{20}$。效率 $\\propto \\frac{22}{13/20} = \\frac{440}{13} \\approx 34$。\n由于为青年接种的效率远高于成年人，最优策略是只为青年接种，直到达到群体免疫或所有青年都已接种（$p_Y=1$）。\n我们在约束中设置 $p_A = 0$：\n$$\n55 p_Y + 22(0) = 42 \\implies p_Y = \\frac{42}{55}\n$$\n因为 $0 \\leq \\frac{42}{55} \\leq 1$，这是一个有效且最优的策略。最优分配为 $(p_Y^*, p_A^*) = (\\frac{42}{55}, 0)$。\n\n那么，最小的总免疫比例 $p_{\\text{str}}$ 为：\n$$\np_{\\text{str}} = w_Y p_Y^* + w_A p_A^* = \\left(\\frac{7}{20}\\right)\\left(\\frac{42}{55}\\right) + \\left(\\frac{13}{20}\\right)(0)\n$$\n$$\np_{\\text{str}} = \\frac{7 \\times 42}{20 \\times 55} = \\frac{294}{1100} = \\frac{147}{550}\n$$\n所需的两个群体免疫阈值是 $p_{\\text{hom}} = \\frac{6}{11}$ 和 $p_{\\text{str}} = \\frac{147}{550}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{6}{11}  \\frac{147}{550} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "$R_0$ 描述了疫情爆发的初始潜力，而公共卫生官员则需要通过有效再生数 $R_t$ 来追踪传播随时间的变化。这个动手编程练习让你扮演流行病学家的角色，使用真实的病例发病数据来估计 $R_t$ 。你将实现一个被广泛应用的贝叶斯统计模型，在获得计算流行病学实践技能的同时，学习先验知识和数据如何结合，以加深我们对流行病动态的理解。",
            "id": "4572586",
            "problem": "给定发病时间序列和离散的代际时间分布，您需要使用基于更新过程的伽马-泊松框架来估计有效再生数 $R_t$。目标是从传染病传播的核心定义出发，在共轭先验下推导 $R_t$ 在滑动窗口上的后验分布，并实现一个程序来计算多个测试用例的点估计和可信区间。\n\n从以下基础开始：\n- 更新方程指出，时间 $t$ 的预期新增病例数与先前病例产生的总传染力成正比。设离散的代际时间分布为 $w(\\tau)$，其中整数滞后 $\\tau \\in \\{1,2,\\dots\\}$，满足 $w(\\tau) \\ge 0$ 且 $\\sum_{\\tau} w(\\tau) = 1$。定义时间 $t$ 的总传染力为\n$$\n\\Lambda_t = \\sum_{\\tau=1}^{T_w} I_{t-\\tau} \\, w(\\tau),\n$$\n其中 $I_t$ 是在时间 $t$ 观测到的发病数，$T_w$ 是 $w(\\tau)$ 的支撑集长度。求和中不包括 $t-\\tau  0$ 的项。\n- 假设在一个窗口内采用泊松观测模型，其中 $R_t$ 被视为常数：在长度为 $k$ 的窗口 $\\mathcal{W}_t = \\{t-k+1, t-k+2, \\dots, t\\}$ 中，时间 $s$ 的发病数 $I_s$ 被建模为 $I_s \\sim \\text{Poisson}(R_t \\Lambda_s)$，并且在 $s \\in \\mathcal{W}_t$ 上独立。\n- 对 $R_t$ 设置伽马先验，$R_t \\sim \\text{Gamma}(\\alpha, \\beta)$，其中形状参数 $\\alpha  0$，率参数 $\\beta  0$。\n\n任务1：仅使用上述假设和共轭先验的标准性质，推导 $R_t$ 在窗口 $\\mathcal{W}_t$ 上的后验分布，并提供以下表达式（用观测发病数和传染力的窗口总和表示）：\n- $R_t$ 的后验形状和率参数。\n- $R_t$ 的后验均值。\n- $R_t$ 的双边 $0.95$ 可信区间的下界和上界。\n\n任务2：实现一个完整、可运行的程序，该程序：\n- 使用提供的离散 $w(\\tau)$ 计算所有需要的 $s$ 的 $\\Lambda_s$。\n- 对于每个测试用例和从 $t = k-1$ 到 $t = T-1$（其中 $T$ 是发病序列的长度）的每个窗口结束时间 $t$，构建窗口 $\\mathcal{W}_t$，聚合所需的充分统计量，并计算 $R_t$ 的后验均值以及 $0.025$ 和 $0.975$ 分位数。\n- 跳过窗口内聚合传染力不为严格正值的任何窗口，即 $\\sum_{s \\in \\mathcal{W}_t} \\Lambda_s \\le 0$ 的情况，因为在这种窗口中，似然函数对 $R_t$ 不具信息性。\n- 将每个数值输出四舍五入到 $4$ 位小数。\n- 在解决方案中，讨论先验参数 $(\\alpha, \\beta)$ 如何影响 $R_t$ 随时间的平滑，包括先验均值和先验强度的作用。\n\n测试套件。使用以下参数集。在所有情况下，$w(\\tau)$ 都是离散、非负且总和为一。$R_t$ 的单位是无量纲的。\n\n- 测试用例1（一般情况）：\n    - 发病序列 $I_t$：$[5, 6, 7, 9, 12, 15, 14, 13, 12, 10]$。\n    - 代际时间分布 $w(\\tau)$，其中 $\\tau = 1,\\dots,6$：$[0.06, 0.18, 0.30, 0.27, 0.14, 0.05]$。\n    - 先验参数 $(\\alpha, \\beta) = (2.0, 2.0)$。\n    - 窗口长度 $k = 7$。\n\n- 测试用例2（低计数和零值）：\n    - 发病序列 $I_t$：$[0, 0, 1, 0, 2, 0, 3, 0, 0, 1]$。\n    - 代际时间分布 $w(\\tau)$，其中 $\\tau = 1,\\dots,6$：$[0.06, 0.18, 0.30, 0.27, 0.14, 0.05]$。\n    - 先验参数 $(\\alpha, \\beta) = (0.1, 0.1)$。\n    - 窗口长度 $k = 3$。\n\n- 测试用例3（在与测试用例1相同的序列上使用强先验平滑）：\n    - 发病序列 $I_t$：$[5, 6, 7, 9, 12, 15, 14, 13, 12, 10]$。\n    - 代际时间分布 $w(\\tau)$，其中 $\\tau = 1,\\dots,6$：$[0.06, 0.18, 0.30, 0.27, 0.14, 0.05]$。\n    - 先验参数 $(\\alpha, \\beta) = (20.0, 10.0)$。\n    - 窗口长度 $k = 7$。\n\n- 测试用例4（使用最小窗口进行每日估计）：\n    - 发病序列 $I_t$：$[2, 3, 0, 1, 4]$。\n    - 代际时间分布 $w(\\tau)$，其中 $\\tau = 1,\\dots,6$：$[0.06, 0.18, 0.30, 0.27, 0.14, 0.05]$。\n    - 先验参数 $(\\alpha, \\beta) = (2.0, 2.0)$。\n    - 窗口长度 $k = 1$。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例的结果必须是一个列表的列表，其中每个内部列表对应一个已处理的窗口结束时间 $t$，并包含三个浮点数 $[m_t, \\ell_t, u_t]$，分别代表该窗口 $R_t$ 的后验均值、较低的 $0.025$ 分位数和较高的 $0.975$ 分位数。例如，对于四个测试用例，外部结构应如下所示：$[[[m,\\ell,u],\\dots], [[m,\\ell,u],\\dots], [[m,\\ell,u],\\dots], [[m,\\ell,u],\\dots]]$，所有数值均四舍五入到 $4$ 位小数。",
            "solution": "首先对问题陈述进行严格的验证过程。\n\n### 步骤1：提取给定信息\n以下数据和定义按原文提供：\n- **更新方程基础**：时间 $t$ 的预期新增病例数与先前病例产生的总传染力成正比。\n- **总传染力 $\\Lambda_t$**：\n$$\n\\Lambda_t = \\sum_{\\tau=1}^{T_w} I_{t-\\tau} \\, w(\\tau)\n$$\n其中 $I_t$ 是在时间 $t$ 观测到的发病数，$w(\\tau)$ 是整数滞后 $\\tau \\in \\{1,2,\\dots\\}$ 的离散代际时间分布，$T_w$ 是 $w(\\tau)$ 的支撑集长度。不包括 $t-\\tau  0$ 的项。\n- **观测模型**：在一个长度为 $k$ 的窗口 $\\mathcal{W}_t = \\{t-k+1, t-k+2, \\dots, t\\}$ 内，时间 $s \\in \\mathcal{W}_t$ 的发病数 $I_s$ 被建模为 $I_s \\sim \\text{Poisson}(R_t \\Lambda_s)$，并且独立，其中 $R_t$ 在窗口内为常数。\n- **先验分布**：$R_t \\sim \\text{Gamma}(\\alpha, \\beta)$，其中形状参数 $\\alpha  0$，率参数 $\\beta  0$。\n- **任务**：\n  1. 推导 $R_t$ 的后验分布、其参数、均值以及 $0.95$ 可信区间的表达式。\n  2. 实现一个程序来为指定的测试用例计算这些量。\n  3. 讨论先验参数的影响。\n- **处理规则**：跳过聚合传染力 $\\sum_{s \\in \\mathcal{W}_t} \\Lambda_s \\le 0$ 的任何窗口。\n- **测试用例1**：\n    - 发病序列 $I_t$：$[5, 6, 7, 9, 12, 15, 14, 13, 12, 10]$。\n    - 代际时间分布 $w(\\tau)$，其中 $\\tau = 1,\\dots,6$：$[0.06, 0.18, 0.30, 0.27, 0.14, 0.05]$。\n    - 先验参数 $(\\alpha, \\beta) = (2.0, 2.0)$。\n    - 窗口长度 $k = 7$。\n- **测试用例2**：\n    - 发病序列 $I_t$：$[0, 0, 1, 0, 2, 0, 3, 0, 0, 1]$。\n    - 代际时间分布 $w(\\tau)$，其中 $\\tau = 1,\\dots,6$：$[0.06, 0.18, 0.30, 0.27, 0.14, 0.05]$。\n    - 先验参数 $(\\alpha, \\beta) = (0.1, 0.1)$。\n    - 窗口长度 $k = 3$。\n- **测试用例3**：\n    - 发病序列 $I_t$：$[5, 6, 7, 9, 12, 15, 14, 13, 12, 10]$。\n    - 代际时间分布 $w(\\tau)$，其中 $\\tau = 1,\\dots,6$：$[0.06, 0.18, 0.30, 0.27, 0.14, 0.05]$。\n    - 先验参数 $(\\alpha, \\beta) = (20.0, 10.0)$。\n    - 窗口长度 $k = 7$。\n- **测试用例4**：\n    - 发病序列 $I_t$：$[2, 3, 0, 1, 4]$。\n    - 代际时间分布 $w(\\tau)$，其中 $\\tau = 1,\\dots,6$：$[0.06, 0.18, 0.30, 0.27, 0.14, 0.05]$。\n    - 先验参数 $(\\alpha, \\beta) = (2.0, 2.0)$。\n    - 窗口长度 $k = 1$。\n- **输出**：数值结果四舍五入到 $4$ 位小数，格式化为特定的列表的列表结构。\n\n### 步骤2：使用提取的给定信息进行验证\n根据验证标准对问题进行评估：\n- **科学依据**：该问题在传染病流行病学理论中有充分的依据。使用更新方程、泊松过程处理新感染以及伽马-泊松共轭先验框架是估计有效再生数 $R_t$ 的标准、成熟方法。该模型是一种简化，但没有违反基本原则。\n- **适定性**：该问题在数学上是适定的。它涉及一个标准的贝叶斯推断任务：从指定的似然和共轭先验中推导后验分布。为测试用例提供了所有必要的数据和参数。跳过总传染力非正的窗口的条件正确处理了似然函数不提供关于 $R_t$ 的信息的情况（因为泊松分布的率参数将为 $0$），从而确保了有意义的解。\n- **客观性**：该问题使用精确、客观的数学和统计语言陈述。没有主观或基于意见的陈述。\n- **完整性和一致性**：该问题是自洽的。所有变量（$I_t, w(\\tau), \\alpha, \\beta, k$）、模型（泊松似然、伽马先验）和程序（窗口化、聚合）都已明确定义。设置中没有矛盾。\n- **现实性和可行性**：发病数据和参数对于流行病学情景是合理的。所需的计算是标准的并且在计算上是可行的。\n- **其他缺陷**：该问题不是隐喻性的、琐碎的、结构不良的或不可验证的。它提出了一个在计算统计学和流行病学中实质性的标准任务。\n\n### 步骤3：结论与行动\n问题陈述是 **有效的**。将提供完整的解决方案。\n\n### 任务1：后验分布的推导\n\n目标是为给定的时间窗口 $\\mathcal{W}_t = \\{t-k+1, \\dots, t\\}$ 求出有效再生数 $R_t$ 的后验分布。贝叶斯框架要求将先验分布与观测数据的似然函数相结合。\n\n**1. 先验分布**\n关于 $R_t$ 的先验信念由一个形状参数为 $\\alpha$、率参数为 $\\beta$ 的伽马分布建模：\n$$ R_t \\sim \\text{Gamma}(\\alpha, \\beta) $$\n其概率密度函数（PDF）为：\n$$ p(R_t) = \\frac{\\beta^\\alpha}{\\Gamma(\\alpha)} R_t^{\\alpha-1} e^{-\\beta R_t} \\propto R_t^{\\alpha-1} e^{-\\beta R_t} $$\n其中 $\\Gamma(\\cdot)$ 是伽马函数。我们关注分布的核，即依赖于变量 $R_t$ 的部分。\n\n**2. 似然函数**\n数据由窗口 $\\mathcal{W}_t$ 中每个时间步 $s$ 的观测发病数 $I_s$ 组成。模型规定，每个 $I_s$ 独立地从泊松分布中抽取：\n$$ I_s \\sim \\text{Poisson}(R_t \\Lambda_s) $$\n观测到单个发病数 $I_s$ 的似然由泊松概率质量函数给出：\n$$ P(I_s | R_t) = \\frac{(R_t \\Lambda_s)^{I_s} e^{-R_t \\Lambda_s}}{I_s!} $$\n由于在 $s \\in \\mathcal{W}_t$ 上的观测是独立的，联合似然函数 $L(R_t | \\{I_s\\}_{s \\in \\mathcal{W}_t})$ 是各个似然的乘积：\n$$ L(R_t) = \\prod_{s \\in \\mathcal{W}_t} P(I_s | R_t) = \\prod_{s \\in \\mathcal{W}_t} \\frac{(R_t \\Lambda_s)^{I_s} e^{-R_t \\Lambda_s}}{I_s!} $$\n为了找到作为 $R_t$ 函数的似然函数的核，我们收集所有涉及 $R_t$ 的项：\n$$ L(R_t) \\propto \\prod_{s \\in \\mathcal{W}_t} (R_t \\Lambda_s)^{I_s} e^{-R_t \\Lambda_s} = \\left( \\prod_{s \\in \\mathcal{W}_t} \\Lambda_s^{I_s} \\right) \\left( \\prod_{s \\in \\mathcal{W}_t} R_t^{I_s} \\right) \\left( \\prod_{s \\in \\mathcal{W}_t} e^{-R_t \\Lambda_s} \\right) $$\n合并各项：\n$$ L(R_t) \\propto R_t^{\\sum_{s \\in \\mathcal{W}_t} I_s} \\exp\\left(-R_t \\sum_{s \\in \\mathcal{W}_t} \\Lambda_s\\right) $$\n\n**3. 后验分布**\n根据贝叶斯定理，后验分布正比于先验和似然的乘积：\n$$ p(R_t | \\{I_s\\}_{s \\in \\mathcal{W}_t}) \\propto p(R_t) \\times L(R_t) $$\n代入先验和似然的核：\n$$ p(R_t | \\text{data}) \\propto \\left( R_t^{\\alpha-1} e^{-\\beta R_t} \\right) \\times \\left( R_t^{\\sum_{s \\in \\mathcal{W}_t} I_s} \\exp\\left(-R_t \\sum_{s \\in \\mathcal{W}_t} \\Lambda_s\\right) \\right) $$\n合并 $R_t$ 的幂和指数中的项：\n$$ p(R_t | \\text{data}) \\propto R_t^{(\\alpha + \\sum_{s \\in \\mathcal{W}_t} I_s) - 1} \\exp\\left(-\\left(\\beta + \\sum_{s \\in \\mathcal{W}_t} \\Lambda_s\\right) R_t\\right) $$\n该表达式是伽马分布的核。因此，$R_t$ 的后验分布也是一个伽马分布，这证明了伽马先验对于泊松似然是共轭的。\n\n后验分布为 $R_t | \\text{data} \\sim \\text{Gamma}(\\alpha', \\beta')$，其中：\n- **后验形状参数**：$\\alpha' = \\alpha + \\sum_{s \\in \\mathcal{W}_t} I_s$\n- **后验率参数**：$\\beta' = \\beta + \\sum_{s \\in \\mathcal{W}_t} \\Lambda_s$\n\n数量 $\\sum_{s \\in \\mathcal{W}_t} I_s$（窗口内总病例数）和 $\\sum_{s \\in \\mathcal{W}_t} \\Lambda_s$（窗口内总传染力）是数据的充分统计量。\n\n**4. 后验均值和可信区间**\n根据伽马分布的性质，我们可以推导出所需的估计值。\n- **后验均值**：$\\text{Gamma}(\\alpha', \\beta')$ 分布的均值是 $\\frac{\\alpha'}{\\beta'}$。\n$$ E[R_t | \\text{data}] = \\frac{\\alpha'}{\\beta'} = \\frac{\\alpha + \\sum_{s \\in \\mathcal{W}_t} I_s}{\\beta + \\sum_{s \\in \\mathcal{W}_t} \\Lambda_s} $$\n\n- **可信区间**：$R_t$ 的 $95\\%$ 可信区间由后验伽马分布的 $0.025$ 和 $0.975$ 分位数定义。设 $F_{\\alpha', \\beta'}^{-1}(p)$ 表示 $\\text{Gamma}(\\alpha', \\beta')$ 分布在概率 $p$ 处的逆累积分布函数（分位数函数）。\n  - **下界**：$\\ell_t = F_{\\alpha', \\beta'}^{-1}(0.025)$\n  - **上界**：$u_t = F_{\\alpha', \\beta'}^{-1}(0.975)$\n这些值通常通过数值方法计算。\n\n### 先验参数的影响\n\n先验参数 $(\\alpha, \\beta)$ 编码了我们在观测数据之前关于 $R_t$ 的知识。它们的选择显著影响后验估计，尤其是在数据稀少时。\n\n- **先验均值**：先验分布的均值是 $\\mu_{prior} = \\alpha / \\beta$。这代表了我们对 $R_t$ 值的先验期望。例如，$\\text{Gamma}(2, 2)$ 的先验意味着先验均值为 $1.0$，表明我们相信疫情是稳定的。$\\text{Gamma}(20, 10)$ 的先验意味着先验均值为 $2.0$，表明我们相信疫情正在增长。\n\n- **先验强度（或有效样本量）**：参数 $\\alpha$ 和 $\\beta$ 可以解释为伪观测值。后验形状为 $\\alpha' = \\alpha + \\sum I_s$，后验率为 $\\beta' = \\beta + \\sum \\Lambda_s$。在这里，$\\alpha$ 充当“先验病例数”，$\\beta$ 充当“先验总传染力”。$\\alpha$ 和 $\\beta$ 的大小决定了先验的“强度”或“信息量”。\n\n  - **强先验**（大的 $\\alpha$ 和 $\\beta$）具有较小的方差（$\\sigma^2_{prior} = \\alpha/\\beta^2$）。它对后验分布产生强大的拉力。后验均值将是先验均值（$\\alpha/\\beta$）和数据驱动的最大似然估计（$\\sum I_s / \\sum \\Lambda_s$）的加权平均，其中先验占有很重的权重。这导致 $R_t$ 的估计值随时间“平滑”，对发病率的短期波动不那么敏感，并偏向先验均值。测试用例3中的 $(\\alpha, \\beta)=(20.0, 10.0)$ 就是强先验的一个例子。\n\n  - **弱先验或无信息先验**（小的 $\\alpha$ 和 $\\beta$，例如接近 $0$）具有较大的方差。它允许数据主导后验。后验均值将非常接近最大似然估计。这导致 $R_t$ 估计对发病数据的变化反应更强烈，从而产生更不稳定的 $R_t$ 时间序列。测试用例2中的 $(\\alpha, \\beta)=(0.1, 0.1)$ 使用了相对较弱的先验。\n\n总而言之，先验的选择是在稳定性（平滑）和响应性之间进行权衡。当数据嘈杂或稀疏时，强先验有助于正则化估计，但如果先验信念不正确，则存在引入偏差的风险。\n\n### 实现方法\n\n实现将直接遵循推导出的公式。\n1.  对于每个测试用例，我们首先预计算从时间步 $s=0$ 到 $T-1$ 的总传染力序列 $\\Lambda_s$，其中 $T$ 是发病序列的长度。这是通过应用离散卷积 $\\Lambda_s = \\sum_{\\tau=1}^{T_w} I_{s-\\tau} w(\\tau)$ 来完成的。\n2.  然后，我们遍历每个可能的分析窗口，按其结束时间 $t$ 索引，从 $t=k-1$ 到 $T-1$。\n3.  对于每个窗口 $\\mathcal{W}_t$，我们计算充分统计量：发病数总和 $\\sum_{s \\in \\mathcal{W}_t} I_s$ 和传染力总和 $\\sum_{s \\in \\mathcal{W}_t} \\Lambda_s$。\n4.  如果传染力总和为正，我们计算后验伽马参数 $\\alpha' = \\alpha + \\sum I_s$ 和 $\\beta' = \\beta + \\sum \\Lambda_s$。\n5.  后验均值计算为 $\\alpha' / \\beta'$。可信区间的 $0.025$ 和 $0.975$ 分位数使用 `scipy.stats.gamma` 的 `ppf`（百分点函数）找到，需要注意的是，SciPy 的 `gamma` 分布由形状和尺度参数化，其中 `scale` $= 1 / \\text{rate}$。\n6.  收集每个窗口的结果，并按指定格式进行格式化。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import gamma\n\ndef solve():\n    \"\"\"\n    Computes the posterior mean and 95% credible interval for the effective\n    reproductive number R_t using a renewal-based Gamma-Poisson framework.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"I\": np.array([5, 6, 7, 9, 12, 15, 14, 13, 12, 10]),\n            \"w\": np.array([0.06, 0.18, 0.30, 0.27, 0.14, 0.05]),\n            \"prior_alpha\": 2.0,\n            \"prior_beta\": 2.0,\n            \"k\": 7,\n        },\n        {\n            \"I\": np.array([0, 0, 1, 0, 2, 0, 3, 0, 0, 1]),\n            \"w\": np.array([0.06, 0.18, 0.30, 0.27, 0.14, 0.05]),\n            \"prior_alpha\": 0.1,\n            \"prior_beta\": 0.1,\n            \"k\": 3,\n        },\n        {\n            \"I\": np.array([5, 6, 7, 9, 12, 15, 14, 13, 12, 10]),\n            \"w\": np.array([0.06, 0.18, 0.30, 0.27, 0.14, 0.05]),\n            \"prior_alpha\": 20.0,\n            \"prior_beta\": 10.0,\n            \"k\": 7,\n        },\n        {\n            \"I\": np.array([2, 3, 0, 1, 4]),\n            \"w\": np.array([0.06, 0.18, 0.30, 0.27, 0.14, 0.05]),\n            \"prior_alpha\": 2.0,\n            \"prior_beta\": 2.0,\n            \"k\": 1,\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        I = case[\"I\"]\n        w = case[\"w\"]\n        prior_alpha = case[\"prior_alpha\"]\n        prior_beta = case[\"prior_beta\"]\n        k = case[\"k\"]\n\n        T = len(I)\n        Tw = len(w)\n\n        # 1. Compute total infectiousness Lambda_s for all s\n        Lambda = np.zeros(T)\n        for s in range(T):\n            # Sum I_{s-tau} * w(tau) for tau from 1 to Tw\n            # w is 1-indexed in formula, so w[tau-1] in code\n            current_lambda = 0.0\n            for tau in range(1, Tw + 1):\n                if s - tau >= 0:\n                    current_lambda += I[s - tau] * w[tau - 1]\n            Lambda[s] = current_lambda\n\n        case_results = []\n        # 2. Iterate through windows ending at time t\n        # Window end time t ranges from k-1 to T-1\n        for t in range(k - 1, T):\n            window_start = t - k + 1\n            window_end = t + 1  # For Python slicing\n\n            # 3. Aggregate sufficient statistics over the window\n            I_window = I[window_start:window_end]\n            Lambda_window = Lambda[window_start:window_end]\n\n            I_sum = np.sum(I_window)\n            Lambda_sum = np.sum(Lambda_window)\n\n            # 4. Skip window if total infectiousness is not strictly positive\n            if Lambda_sum = 0:\n                continue\n\n            # 5. Calculate posterior parameters\n            posterior_alpha = prior_alpha + I_sum\n            posterior_beta = prior_beta + Lambda_sum\n\n            # 6. Compute posterior mean and credible interval\n            # Scipy's gamma function uses shape (a) and scale (theta = 1/rate)\n            posterior_mean = posterior_alpha / posterior_beta\n            \n            lower_bound = gamma.ppf(0.025, a=posterior_alpha, scale=1 / posterior_beta)\n            upper_bound = gamma.ppf(0.975, a=posterior_alpha, scale=1 / posterior_beta)\n\n            # 7. Store rounded results\n            case_results.append([\n                round(posterior_mean, 4),\n                round(lower_bound, 4),\n                round(upper_bound, 4)\n            ])\n        \n        all_results.append(case_results)\n\n    # Final print statement in the exact required format.\n    # The format is a list of lists of lists, represented as a string.\n    # e.g., [[[m,l,u],[m,l,u]],[[m,l,u]]]\n    \n    output_parts = []\n    for case_res in all_results:\n        # case_res is a list of [m, l, u] lists\n        # e.g., [[1.2, 1.0, 1.4], [1.3, 1.1, 1.5]]\n        \n        # Format each [m, l, u] sublist\n        sublist_strs = [f\"[{m},{l},{u}]\" for m, l, u in case_res]\n        \n        # Join the sublists for one test case into a string like \"[[m,l,u],[m,l,u]]\"\n        case_str = f\"[{','.join(sublist_strs)}]\"\n        output_parts.append(case_str)\n        \n    final_output = f\"[{','.join(output_parts)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}