{
    "hands_on_practices": [
        {
            "introduction": "流行病学研究的基石在于确保暴露组与非暴露组具有可比性。然而，研究设计本身有时会无意中破坏这种可比性，尤其是在存在未测量混杂因素的情况下。本练习  将通过一个关于不同转诊网络来源的病例对照研究的生动案例，向您揭示一种被称为“对撞偏倚 (collider bias)”的隐蔽偏倚是如何产生的，即使在校正了已知的混杂因素 $Z$ 之后，暴露 $X$ 和潜在结果 $Y^x$ 之间的可交换性假设为何依然不成立。",
            "id": "4635157",
            "problem": "一位研究者希望使用观察性数据来估计一项新的基于临床的暴露 $X$ 对二元结局 $Y$ 的因果效应。令 $Y^x$ 表示在暴露水平 $x \\in \\{0,1\\}$ 下的潜在结局。目标可交换性条件是 $Y^x \\perp X \\mid Z$，其中 $Z$ 是一个已测量的协变量。研究者从一个转诊网络中收集暴露组，并从另一个不同的转诊网络中收集非暴露组。考虑以下明确的数据生成过程，这对于基于临床的暴露在科学上是合理的：\n\n- 令 $Z \\in \\{0,1\\}$ 表示年龄组，其中 $P(Z=1)=0.5$。为简单起见，假设 $Z$ 与下文的其他基线变量无关。\n- 令 $U \\in \\{0,1\\}$ 表示一种未测量的就医倾向，它既增加了被转诊到特定网络的几率，也增加了结局的风险。令 $P(U=1)=0.5$ 且 $U \\perp Z$。\n- 令 $R \\in \\{0,1\\}$ 表示转诊网络，其中 $R=1$ 是一个大型三级网络，$R=0$ 是一个社区网络。就医倾向 $U$ 强烈影响转诊：$P(R=1 \\mid U=1)=0.9$ 和 $P(R=1 \\mid U=0)=0.1$。\n- 临床暴露 $X$ 仅在三级网络中提供：$P(X=1 \\mid R=1)=0.5$ 和 $P(X=1 \\mid R=0)=0$。因此，在给定 $R=1$ 的情况下 $X \\perp (U,Z)$，但当 $R=0$ 时，$X=0$ 几乎必然成立。\n- 结局 $Y \\in \\{0,1\\}$ 的潜在结局风险由 $U$ 和暴露获益驱动：$P(Y^1=1 \\mid U=1)=0.3$，$P(Y^1=1 \\mid U=0)=0.1$，$P(Y^0=1 \\mid U=1)=0.4$，以及 $P(Y^0=1 \\mid U=0)=0.2$。因此，对于任何固定的 $U$，暴露都会降低风险。\n- 组建的研究样本仅包含选择指示符 $S=1$ 的个体，其设计为：暴露者取自三级网络，非暴露者取自社区网络。形式上，$S=1$ 当且仅当 $(X=1 \\wedge R=1)$ 或 $(X=0 \\wedge R=0)$；否则 $S=0$。这捕捉了“来自网络 $R=1$ 的暴露者”和“来自网络 $R=0$ 的非暴露者”。\n\n在 $S=1$ 的组建样本中进行分析：\n\n- 通过上述定义进行推理，说明 $Y^x \\perp X \\mid Z$ 是否成立。\n- 简要论证成功或失败的因果机制，并参照关联 $U, R, X, S, Z$ 和 $Y^x$ 的结构。\n\n哪个选项最能描述在该组建样本中 $Y^x \\perp X \\mid Z$ 是否成立及其机制？\n\nA. 不成立。从不同的转诊网络中选择非暴露者，通过 $X \\rightarrow S \\leftarrow R \\leftarrow U$ 的路径，在 $S=1$ 内部诱导了 $X$ 和未测量的 $U$ 之间的关联，即使在调整了 $Z$ 之后也违反了 $Y^x \\perp X \\mid Z$。此外，在 $S=1$ 内部，存在关于 $R$ 的正性假设违背（$P(X=1 \\mid R=0,S=1)=0$ 和 $P(X=0 \\mid R=1,S=1)=0$），因此调整 $R$ 无法恢复可交换性。\n\nB. 成立。因为在 $R=1$ 内部暴露分配是随机的，并且来自 $R=0$ 的对照组在 $Z$ 的各层内代表了相同的源人群，所以我们有 $Y^x \\perp X \\mid Z$。\n\nC. 不成立。可交换性不成立，但可以通过调整转诊网络 $R$ 来恢复，这会阻断所有后门路径，因此 $Y^x \\perp X \\mid (Z,R)$ 成立且效应是可识别的。\n\nD. 成立。年龄组 $Z$ 完全捕捉了与 $R$ 和 $Y$ 相关的就医倾向差异，因此即使网络不同，对 $Z$ 进行条件化也足以满足 $Y^x \\perp X \\mid Z$。",
            "solution": "用户希望我验证并解决一个关于流行病学中因果推断和选择偏倚的问题。\n\n### 步骤1：提取已知条件\n\n问题陈述提供了以下信息：\n-   **目标**：估计二元暴露 $X \\in \\{0,1\\}$ 对二元结局 $Y \\in \\{0,1\\}$ 的因果效应。\n-   **潜在结局**：$Y^x$，其中 $x \\in \\{0,1\\}$。\n-   **目标条件**：可交换性，$Y^x \\perp X \\mid Z$。\n-   **已测量协变量**：$Z \\in \\{0,1\\}$（年龄组），$P(Z=1)=0.5$。$Z$ 与其他基线变量无关。\n-   **未测量协变量**：$U \\in \\{0,1\\}$（就医倾向），$P(U=1)=0.5$。\n-   **独立性**：$U \\perp Z$。\n-   **转诊网络**：$R \\in \\{0,1\\}$，其中 $R=1$ 为三级网络，$R=0$ 为社区网络。\n-   **$U$ 和 $R$ 之间的关系**：$P(R=1 \\mid U=1)=0.9$ 和 $P(R=1 \\mid U=0)=0.1$。\n-   **$R$ 和 $X$ 之间的关系**：暴露 $X$ 仅在网络 $R=1$ 中可用。形式上，$P(X=1 \\mid R=1)=0.5$ 和 $P(X=1 \\mid R=0)=0$。\n-   **条件独立性**：给定 $R=1$ 时，$X \\perp (U,Z)$。\n-   **$U$ 和 $Y^x$ 之间的关系**：\n    -   $P(Y^1=1 \\mid U=1)=0.3$\n    -   $P(Y^1=1 \\mid U=0)=0.1$\n    -   $P(Y^0=1 \\mid U=1)=0.4$\n    -   $P(Y^0=1 \\mid U=0)=0.2$\n-   **研究选择**：分析仅限于选择指示符 $S=1$ 的样本。选择规则是：$S=1$ 当且仅当 $(X=1 \\wedge R=1)$ 或 $(X=0 \\wedge R=0)$。\n\n### 步骤2：使用提取的已知条件进行验证\n\n该问题是一个明确定义的因果推断练习，具体是检验选择偏倚对可交换性的影响。\n\n-   **科学依据**：该问题使用了现代流行病学中的标准潜在结局符号和概念，如可交换性、混杂和选择偏倚。从不同临床人群中抽取暴露组和非暴露组的情景是观察性研究中一个现实且常见的挑战。其概率模型是内部一致的。\n-   **良态问题**：该问题提供了一个完整的量化数据生成过程，并提出了一个精确的数学问题：确定条件独立性陈述 $Y^x \\perp X \\mid Z$ 在由 $S=1$ 定义的子人群中是否成立。可以从给定的概率中推导出确切的答案。\n-   **客观性**：该问题以客观、正式的语言陈述。所有术语都通过概率进行定义。\n\n该问题不违反任何无效性标准。这是一个科学上合理、良态且客观的问题，是流行病学领域的核心问题之一。\n\n### 步骤3：结论与行动\n\n该问题是**有效的**。我将继续进行解答。\n\n### 推导过程\n\n主要任务是确定可交换性条件 $Y^x \\perp X \\mid Z$ 在组建的样本（即 $S=1$ 的层）中是否成立。\n\n如果 $Y^x \\perp X \\mid Z$ 条件成立，则在 $Z$ 的各层内，暴露组（$X=1$）和非暴露组（$X=0$）的潜在结局 $Y^x$ 的分布是相同的。在这个问题中，潜在结局 $Y^x$ 直接由未测量的变量 $U$ 引起。因此，可交换性成立当且仅当在以 $Z$ 为条件时，暴露组和非暴露组的 $U$ 分布相同。也就是说，我们必须检查 $U \\perp X \\mid Z, S=1$ 是否成立。\n\n问题陈述 $Z$ 与所有其他基线变量（包括 $U$）无关。此外，根据指定的概率，$Z$ 不影响 $R$、$X$ 或 $Y^x$。因此，以 $Z$ 为条件并不改变 $U$ 和 $X$ 之间的关系。该条件简化为检验 $U \\perp X \\mid S=1$ 是否成立。为了检验这一点，我们将计算并比较 $P(U=1 \\mid X=1, S=1)$ 和 $P(U=1 \\mid X=0, S=1)$。\n\n1.  **分析样本构成：**\n    -   样本由 $S=1$ 定义，这意味着 $(X=1 \\wedge R=1)$ 或 $(X=0 \\wedge R=0)$。\n    -   这意味着在样本中，一个个体是暴露的（$X=1$）当且仅当他们来自三级网络（$R=1$）。\n    -   同样，一个个体是非暴露的（$X=0$）当且仅当他们来自社区网络（$R=0$）。\n    -   因此，在 $S=1$ 层内，事件 $\\{X=1\\}$ 和 $\\{R=1\\}$ 是相同的，事件 $\\{X=0\\}$ 和 $\\{R=0\\}$ 也是相同的。\n\n2.  **计算暴露组（$X=1, S=1$）中 $U$ 的分布：**\n    我们需要求 $P(U=1 \\mid X=1, S=1)$。根据样本定义，这等价于 $P(U=1 \\mid R=1)$。\n    我们使用贝叶斯定理：\n    $$ P(U=1 \\mid R=1) = \\frac{P(R=1 \\mid U=1)P(U=1)}{P(R=1)} $$\n    首先，我们求边缘概率 $P(R=1)$：\n    $$ P(R=1) = P(R=1 \\mid U=1)P(U=1) + P(R=1 \\mid U=0)P(U=0) $$\n    $$ P(R=1) = (0.9)(0.5) + (0.1)(0.5) = 0.45 + 0.05 = 0.5 $$\n    现在，将其代回：\n    $$ P(U=1 \\mid R=1) = \\frac{(0.9)(0.5)}{0.5} = 0.9 $$\n    所以，在暴露组中，90%的个体具有高就医倾向（$U=1$）。\n\n3.  **计算非暴露组（$X=0, S=1$）中 $U$ 的分布：**\n    我们需要求 $P(U=1 \\mid X=0, S=1)$。这等价于 $P(U=1 \\mid R=0)$。\n    我们再次使用贝叶斯定理：\n    $$ P(U=1 \\mid R=0) = \\frac{P(R=0 \\mid U=1)P(U=1)}{P(R=0)} $$\n    我们知道 $P(R=0) = 1 - P(R=1) = 1 - 0.5 = 0.5$。\n    且 $P(R=0 \\mid U=1) = 1 - P(R=1 \\mid U=1) = 1 - 0.9 = 0.1$。\n    $$ P(U=1 \\mid R=0) = \\frac{(0.1)(0.5)}{0.5} = 0.1 $$\n    所以，在非暴露组中，只有10%的个体具有高就医倾向（$U=1$）。\n\n4.  **关于可交换性的结论：**\n    我们发现 $P(U=1 \\mid X=1, S=1, Z) = 0.9$ 而 $P(U=1 \\mid X=0, S=1, Z) = 0.1$。由于这些概率不相等，混杂因素 $U$ 的分布在研究样本中的暴露组和非暴露组之间存在巨大差异。因为 $U$ 是潜在结局 $Y^x$ 的直接原因，这种 $U$ 的不平衡转化为结局基线风险的不平衡。\n    因此，在 $S=1$ 的样本中，$Y^x \\not\\perp X \\mid Z$。可交换性条件不成立。\n\n5.  **因果机制：**\n    可交换性的失效是一种选择偏倚。该研究设计通过从一个网络（$R=1$）中选择暴露者，并从另一个网络（$R=0$）中选择非暴露者，在暴露 $X$ 和未测量的混杂因素 $U$ 之间制造了一种虚假关联。这种因果结构可以用有向无环图（DAG）表示，其中我们有路径 $U \\rightarrow R \\rightarrow X$ 和 $U \\rightarrow Y^x$。变量 $S$ 是一个对撞节点，由 $X$ 和 $R$ 共同决定。以 $S=1$ 为条件（即选择研究样本）会诱导 $X$ 和 $U$ 之间的关联。通过对对撞节点 $S$ 进行条件化，路径 $X \\rightarrow S \\leftarrow R \\leftarrow U$ 被打开，从而在 $X$ 和 $U$ 之间产生了非因果关联。由于 $U$ 是 $Y^x$ 的一个原因，这导致了混杂。暴露组和非暴露组是不可比的，因为暴露组中有更高比例的个体具有高风险因素 $U=1$。\n\n### 逐项分析\n\nA. 这个选项正确地指出可交换性（$Y^x \\perp X \\mid Z$）不成立。它正确地识别了机制：选择过程在暴露 $X$ 和未测量的混杂因素 $U$ 之间诱导了关联。对路径 $X \\rightarrow S \\leftarrow R \\leftarrow U$ 的描述准确地描绘了对撞分层偏倚机制。它还正确地识别了一个关键的次要问题：正性假设违背。在样本（$S=1$）中，如果我们知道一个人来自网络 $R=0$，他们必须有 $X=0$。因此，$P(X=1 \\mid R=0, S=1)=0$。反之，如果他们来自网络 $R=1$，他们必须有 $X=1$，因此 $P(X=0 \\mid R=1, S=1)=0$。这种正性缺失意味着不可能通过调整转诊网络 $R$ 来试图修正偏倚，因为在 $R=0$ 层中没有暴露对象，在 $R=1$ 层中也没有非暴露对象。 **结论：正确。**\n\nB. 这个选项错误地声称可交换性成立。其推理的关键缺陷在于断言来自 $R=0$ 的对照组与来自 $R=1$ 的病例“代表了相同的源人群”。正如我们的计算所证明的，未测量的预后因素 $U$ 的分布在暴露组（$R=1$）中为90%，而在非暴露组（$R=0$）中为10%。这两个是根本不同的人群。 **结论：错误。**\n\nC. 这个选项正确地指出可交换性不成立。然而，它错误地声称可以通过调整 $R$ 来解决问题。如对选项A的分析所示，研究设计在所选样本中造成了 $X$ 和 $R$ 之间的完美相关性（当 $S=1$ 时，$X=R$）。这导致了完全缺乏正性，使得对 $R$ 进行调整成为不可能。我们无法在 $R$ 的同一层内比较暴露和非暴露的对象。 **结论：错误。**\n\nD. 这个选项错误地声称可交换性成立。根据问题陈述，其推理在事实上是错误的。问题明确指出 $U$ 是就医倾向，并且 $U \\perp Z$。因此，测量的变量 $Z$ *完全没有*捕捉到就医倾向 $U$ 的任何差异。 **结论：错误。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在理解了选择偏倚的成因之后，下一步是学习如何量化其影响。一个在纵向研究中常见的错误，是利用未来的暴露信息来定义当前的非暴露组，例如，将研究期间“从未暴露”的个体作为对照。本练习  提供了一个具体的数据生成场景，让您亲手计算这种不当分组所导致的偏倚大小，从而将抽象的偏倚概念转化为一个可以感知的精确数值。",
            "id": "4635169",
            "problem": "考虑一个具有两个时间点 $t \\in \\{1,2\\}$ 的纵向队列。设 $L \\in \\{0,1\\}$ 是在 $t=1$ 之前测量的基线协变量，$A_1 \\in \\{0,1\\}$ 是在 $t=1$ 时的暴露，$A_2 \\in \\{0,1\\}$ 是在 $t=2$ 时的后续暴露，$Y \\in \\{0,1\\}$ 是在 $t=2$ 时测量的最终结局。定义潜在结局 $Y^a$ 为：如果 $t=1$ 时的暴露被设定为 $a \\in \\{0,1\\}$，而所有后续事件在该干预下按其自然方式演变时，在 $t=2$ 将会观测到的结局。目标估计量是平均处理效应 (ATE)，即 $E[Y^1] - E[Y^0]$。\n\n假设存在以下科学上合理的数据生成机制：\n- 基线协变量：$P(L=1) = 0.5$。\n- $t=1$ 时的暴露：$P(A_1=1 \\mid L=1) = 0.8$ 和 $P(A_1=1 \\mid L=0) = 0.2$。\n- 在 $t=1$ 时未暴露者中，$t=2$ 时的后续暴露：$P(A_2=1 \\mid A_1=0, L=1) = 0.7$ 和 $P(A_2=1 \\mid A_1=0, L=0) = 0.1$。在 $t=1$ 时暴露的个体在 $t=2$ 时仍然保持暴露，即如果 $A_1=1$，则 $A_2=1$ 是确定性的。\n- 在一致性假设下的结局模型：对于 $A_1=a$ 的个体，给定 $L$ 的条件下，其条件均值等于相应的潜在结局均值，即 $E(Y \\mid L, A_1=a) = E(Y^a \\mid L)$。具体来说：\n  - $E(Y^1 \\mid L=1) = 0.6$，$E(Y^1 \\mid L=0) = 0.2$，\n  - $E(Y^0 \\mid L=1) = 0.3$，$E(Y^0 \\mid L=0) = 0.1$。\n\n一位研究者错误地定义了 $t=1$ 时的未暴露比较组，将其限定为在 $t=1$ 和 $t=2$ 均未暴露的个体（即所谓的截至 $t=2$ 的“从未暴露者”），然后计算观测均值的朴素差异 $E(Y \\mid A_1=1) - E(Y \\mid A_1=0, A_2=0)$ 来估计 $E[Y^1] - E[Y^0]$。\n\n计算这个错误估计量相对于真实 $E[Y^1] - E[Y^0]$ 的偏差。请用精确分数表示最终答案。无需四舍五入，不涉及单位。",
            "solution": "用户希望我验证并解决一个流行病学领域的问题，重点是因果推断。\n\n### 第一步：提取已知条件\n-   **研究设计**：一个具有两个时间点 $t \\in \\{1,2\\}$ 的纵向队列。\n-   **变量**：\n    -   $L \\in \\{0,1\\}$：一个基线协变量。\n    -   $A_1 \\in \\{0,1\\}$：在 $t=1$ 时的暴露。\n    -   $A_2 \\in \\{0,1\\}$：在 $t=2$ 时的暴露。\n    -   $Y \\in \\{0,1\\}$：在 $t=2$ 时的结局。\n-   **潜在结局**：$Y^a$ 是在干预 $A_1=a$ 下的结局，其中 $a \\in \\{0,1\\}$。\n-   **目标估计量**：平均处理效应 (ATE)，定义为 $E[Y^1] - E[Y^0]$。\n-   **数据生成机制**：\n    -   $P(L=1) = 0.5$。\n    -   $P(A_1=1 \\mid L=1) = 0.8$。\n    -   $P(A_1=1 \\mid L=0) = 0.2$。\n    -   $P(A_2=1 \\mid A_1=0, L=1) = 0.7$。\n    -   $P(A_2=1 \\mid A_1=0, L=0) = 0.1$。\n    -   如果 $A_1=1$，则 $A_2=1$ 是确定性的。\n-   **结局模型**：一致性和条件可交换性假设被合并为关系式 $E(Y \\mid L, A_1=a) = E(Y^a \\mid L)$。\n    -   $E(Y^1 \\mid L=1) = 0.6$。\n    -   $E(Y^1 \\mid L=0) = 0.2$。\n    -   $E(Y^0 \\mid L=1) = 0.3$。\n    -   $E(Y^0 \\mid L=0) = 0.1$。\n-   **错误估计量**：均值的朴素差异，$E(Y \\mid A_1=1) - E(Y \\mid A_1=0, A_2=0)$。\n-   **目标**：计算错误估计量的偏差，定义为 $(E(Y \\mid A_1=1) - E(Y \\mid A_1=0, A_2=0)) - (E[Y^1] - E[Y^0])$。答案必须是精确分数。\n\n### 第二步：使用提取的已知条件进行验证\n-   **科学基础**：该问题是一个关于因果推断的、结构良好的练习题，因果推断是流行病学和生物统计学的核心领域。它使用了潜在结局、混杂和选择偏倚等标准概念。该设定是一个纵向研究的简化但概念上合理的模型。所有假设，如一致性和给定的概率，都是此类教学性问题的标准设定。\n-   **适定性**：所有必要的数值和概率关系都已提供，足以计算真实的ATE和错误估计量的值。目标陈述清晰。假设 $E(Y \\mid L, A_1=a) = E(Y^a \\mid L)$ 意味着在给定 $L$ 和 $A_1$ 的条件下，结局期望不依赖于 $A_2$，这使得问题完全确定。\n-   **客观性**：问题以精确、正式的语言陈述，没有歧义或主观元素。\n\n### 第三步：结论与行动\n该问题是有效的。它在科学上是合理的，是适定的、客观的，并包含了唯一解所需的所有信息。我将继续进行计算。\n\n### 解题过程\n\n目标是计算研究者估计量的偏差。偏差是估计量的期望值与我们感兴趣的真实参数之间的差异。\n$$\n\\text{偏差} = \\left( E(Y \\mid A_1=1) - E(Y \\mid A_1=0, A_2=0) \\right) - \\left( E[Y^1] - E[Y^0] \\right)\n$$\n我们将分别计算这四个期望项。为保证精度，我们将所有给定的十进制概率转换为分数：$0.1 = \\frac{1}{10}$，$0.2 = \\frac{1}{5}$，$0.3 = \\frac{3}{10}$，$0.5 = \\frac{1}{2}$，$0.6 = \\frac{3}{5}$，$0.7 = \\frac{7}{10}$，$0.8 = \\frac{4}{5}$。\n\n**1. 计算真实的平均处理效应 (ATE)，$E[Y^1] - E[Y^0]$**\n\n我们使用全期望定律，对协变量 $L$ 进行边缘化。\n$$\nE[Y^a] = E[E[Y^a \\mid L]] = E[Y^a \\mid L=1]P(L=1) + E[Y^a \\mid L=0]P(L=0)\n$$\n给定 $P(L=1) = \\frac{1}{2}$，则 $P(L=0) = 1 - \\frac{1}{2} = \\frac{1}{2}$。\n\n-   对于暴露下的潜在结局 ($a=1$):\n    $$\n    E[Y^1] = \\left(\\frac{3}{5}\\right)\\left(\\frac{1}{2}\\right) + \\left(\\frac{1}{5}\\right)\\left(\\frac{1}{2}\\right) = \\frac{3}{10} + \\frac{1}{10} = \\frac{4}{10} = \\frac{2}{5}\n    $$\n-   对于未暴露下的潜在结局 ($a=0$):\n    $$\n    E[Y^0] = \\left(\\frac{3}{10}\\right)\\left(\\frac{1}{2}\\right) + \\left(\\frac{1}{10}\\right)\\left(\\frac{1}{2}\\right) = \\frac{3}{20} + \\frac{1}{20} = \\frac{4}{20} = \\frac{1}{5}\n    $$\n-   真实的ATE为：\n    $$\n    E[Y^1] - E[Y^0] = \\frac{2}{5} - \\frac{1}{5} = \\frac{1}{5}\n    $$\n\n**2. 计算错误的估计量，$E(Y \\mid A_1=1) - E(Y \\mid A_1=0, A_2=0)$**\n\n这需要从观测数据分布中计算两个条件期望。\n\n**a. 计算 $E(Y \\mid A_1=1)$**\n\n我们使用全期望定律，以 $L$ 为条件：\n$$\nE(Y \\mid A_1=1) = E(Y \\mid A_1=1, L=1)P(L=1 \\mid A_1=1) + E(Y \\mid A_1=1, L=0)P(L=0 \\mid A_1=1)\n$$\n根据问题的结局模型，$E(Y \\mid L, A_1=a) = E(Y^a \\mid L)$。\n因此，$E(Y \\mid A_1=1, L=1) = E(Y^1 \\mid L=1) = \\frac{3}{5}$ 且 $E(Y \\mid A_1=1, L=0) = E(Y^1 \\mid L=0) = \\frac{1}{5}$。\n\n我们使用贝叶斯定理来求条件概率 $P(L=l \\mid A_1=1)$，这需要先求边缘概率 $P(A_1=1)$：\n$$\nP(A_1=1) = P(A_1=1 \\mid L=1)P(L=1) + P(A_1=1 \\mid L=0)P(L=0) = \\left(\\frac{4}{5}\\right)\\left(\\frac{1}{2}\\right) + \\left(\\frac{1}{5}\\right)\\left(\\frac{1}{2}\\right) = \\frac{4}{10} + \\frac{1}{10} = \\frac{5}{10} = \\frac{1}{2}\n$$\n现在，应用贝叶斯定理：\n$$\nP(L=1 \\mid A_1=1) = \\frac{P(A_1=1 \\mid L=1)P(L=1)}{P(A_1=1)} = \\frac{(\\frac{4}{5})(\\frac{1}{2})}{\\frac{1}{2}} = \\frac{4}{5}\n$$\n并且 $P(L=0 \\mid A_1=1) = 1 - P(L=1 \\mid A_1=1) = 1 - \\frac{4}{5} = \\frac{1}{5}$。\n\n将这些代入 $E(Y \\mid A_1=1)$ 的表达式中：\n$$\nE(Y \\mid A_1=1) = \\left(\\frac{3}{5}\\right)\\left(\\frac{4}{5}\\right) + \\left(\\frac{1}{5}\\right)\\left(\\frac{1}{5}\\right) = \\frac{12}{25} + \\frac{1}{25} = \\frac{13}{25}\n$$\n\n**b. 计算 $E(Y \\mid A_1=0, A_2=0)$**\n\n我们以 $L$ 为条件：\n$$\nE(Y \\mid A_1=0, A_2=0) = E(Y \\mid A_1=0, A_2=0, L=1)P(L=1|A_1=0, A_2=0) + E(Y \\mid A_1=0, A_2=0, L=0)P(L=0|A_1=0, A_2=0)\n$$\n问题的结局模型 $E(Y \\mid L, A_1=a) = E(Y^a \\mid L)$ 意味着在以 $A_1$ 和 $L$ 为条件后，$Y$ 的期望不依赖于 $A_2$。因此，$E(Y \\mid A_1=0, A_2=0, L=l) = E(Y \\mid A_1=0, L=l) = E(Y^0 \\mid L=l)$。\n所以，$E(Y \\mid A_1=0, A_2=0, L=1) = \\frac{3}{10}$ 且 $E(Y \\mid A_1=0, A_2=0, L=0) = \\frac{1}{10}$。\n\n我们使用贝叶斯定理来求权重 $P(L=l \\mid A_1=0, A_2=0)$。首先，我们计算联合概率 $P(A_1=0, A_2=0 \\mid L=l)$：\n- 对于 $L=1$：$P(A_1=0 \\mid L=1) = 1 - \\frac{4}{5} = \\frac{1}{5}$。$P(A_2=0 \\mid A_1=0, L=1) = 1 - \\frac{7}{10} = \\frac{3}{10}$。\n  $$\n  P(A_1=0, A_2=0 \\mid L=1) = P(A_2=0 \\mid A_1=0, L=1) P(A_1=0 \\mid L=1) = \\left(\\frac{3}{10}\\right)\\left(\\frac{1}{5}\\right) = \\frac{3}{50}\n  $$\n- 对于 $L=0$：$P(A_1=0 \\mid L=0) = 1 - \\frac{1}{5} = \\frac{4}{5}$。$P(A_2=0 \\mid A_1=0, L=0) = 1 - \\frac{1}{10} = \\frac{9}{10}$。\n  $$\n  P(A_1=0, A_2=0 \\mid L=0) = P(A_2=0 \\mid A_1=0, L=0) P(A_1=0 \\mid L=0) = \\left(\\frac{9}{10}\\right)\\left(\\frac{4}{5}\\right) = \\frac{36}{50} = \\frac{18}{25}\n  $$\n边缘概率 $P(A_1=0, A_2=0)$ 为：\n$$\nP(A_1=0, A_2=0) = P(A_1=0, A_2=0 \\mid L=1)P(L=1) + P(A_1=0, A_2=0 \\mid L=0)P(L=0) = \\left(\\frac{3}{50}\\right)\\left(\\frac{1}{2}\\right) + \\left(\\frac{36}{50}\\right)\\left(\\frac{1}{2}\\right) = \\frac{3}{100} + \\frac{36}{100} = \\frac{39}{100}\n$$\n现在，通过贝叶斯定理：\n$$\nP(L=1 \\mid A_1=0,A_2=0) = \\frac{P(A_1=0,A_2=0 \\mid L=1)P(L=1)}{P(A_1=0,A_2=0)} = \\frac{\\frac{3}{100}}{\\frac{39}{100}} = \\frac{3}{39} = \\frac{1}{13}\n$$\n所以，$P(L=0 \\mid A_1=0,A_2=0) = 1 - \\frac{1}{13} = \\frac{12}{13}$。\n\n代入这些值：\n$$\nE(Y \\mid A_1=0, A_2=0) = \\left(\\frac{3}{10}\\right)\\left(\\frac{1}{13}\\right) + \\left(\\frac{1}{10}\\right)\\left(\\frac{12}{13}\\right) = \\frac{3}{130} + \\frac{12}{130} = \\frac{15}{130} = \\frac{3}{26}\n$$\n\n**3. 计算偏差**\n\n错误估计量的值为：\n$$\nE(Y \\mid A_1=1) - E(Y \\mid A_1=0, A_2=0) = \\frac{13}{25} - \\frac{3}{26} = \\frac{13 \\times 26 - 3 \\times 25}{25 \\times 26} = \\frac{338 - 75}{650} = \\frac{263}{650}\n$$\n偏差是该值与真实ATE之间的差值：\n$$\n\\text{偏差} = \\frac{263}{650} - \\text{ATE} = \\frac{263}{650} - \\frac{1}{5}\n$$\n为了进行减法，我们找到一个公分母：$\\frac{1}{5} = \\frac{1 \\times 130}{5 \\times 130} = \\frac{130}{650}$。\n$$\n\\text{偏差} = \\frac{263}{650} - \\frac{130}{650} = \\frac{133}{650}\n$$\n分数 $\\frac{133}{650}$ 是最简形式，因为133的质因数是7和19，而650的质因数 $650=2 \\times 5^2 \\times 13$ 不包含7或19。",
            "answer": "$$\n\\boxed{\\frac{133}{650}}\n$$"
        },
        {
            "introduction": "从理论转向实践，当我们拿到观测数据后，必须评估暴露组和非暴露组在关键协变量上是否具有可比性，这一原则被称为“正性”或“重叠性”。本练习  模拟了在真实世界研究中，如何利用倾向性评分 $e(X)$ 来诊断两组人群之间是否存在足够的重叠区域。通过这个过程，您将理解为何我们有时必须“修剪”数据并重新定义我们的研究目标人群，以确保因果推断的有效性。",
            "id": "4635182",
            "problem": "一项队列研究评估了一项二元干预 $A$（暴露与非暴露）对一个二元结局 $Y$ 的因果效应，其中混杂通过倾向性得分 $e(X) = P(A=1 \\mid X)$ 来控制，而 $X$ 表示测量的基线协变量。在施加任何限制之前，我们感兴趣的因果估计量是平均处理效应 (ATE)，定义为 $E[Y^{1} - Y^{0}]$，其中 $Y^{1}$ 和 $Y^{0}$ 分别是暴露和不暴露下的潜在结局。使用基于倾向性得分的方法来识别 ATE 需要满足正定性（重叠）假设：对于所有具有正密度的协变量值 $x$，$0  P(A=1 \\mid X=x)  1$（等价于 $0  e(x)  1$）。\n\n您对 $A$ 和 $X$ 拟合了一个逻辑斯谛回归模型来估计 $e(X)$，然后按暴露状态检查 $e(X)$ 的经验支撑域。得到以下摘要：\n\n- 在暴露组 ($A=1$) 中：观测到的 $e(X)$ 值范围从 $0.22$ 到 $0.96$，其中 $15\\%$ 的暴露者 $e(X)  0.30$，$70\\%$ 在 $0.30$ 和 $0.80$ 之间，以及 $15\\%$ 高于 $0.80$。\n- 在非暴露组 ($A=0$) 中：观测到的 $e(X)$ 值范围从 $0.03$ 到 $0.62$，其中 $40\\%$ 的非暴露者 $e(X)  0.20$，$55\\%$ 在 $0.20$ 和 $0.60$ 之间，以及 $5\\%$ 高于 $0.60$。\n\n假设样本量很大且 $e(X)$ 的模型设定正确。您希望通过检查倾向性得分的支撑域来诊断实际正定性违背，并提出一个有原则的修剪规则以确保因果估计有足够的重叠。您还必须陈述在实施您提出的修剪后所剩下的因果估计量。\n\n哪个选项最好地诊断了重叠情况，提出了适当的修剪规则，并正确地陈述了剩下的估计量？\n\nA. 对于低于 $0.22$ 和高于 $0.62$ 的 $e(X)$ 值，实际正定性被违背，因为其中一个暴露组在那里基本上没有支撑域。修剪至支撑域的交集，即 $e(X) \\in [0.22, 0.62]$。剩下的估计量是 $E[Y^{1} - Y^{0} \\mid e(X) \\in [0.22, 0.62]]$，即修剪后总体（共同支撑域）中的 ATE。\n\nB. 在低和高的 $e(X)$ 值处，实际正定性均被违背，但修剪是不必要的；相反，保留所有 $e(X) \\in [0.03, 0.96]$（支撑域的并集）的观测值，并使用逆概率加权来估计原始的 ATE。剩下的估计量是整个总体的 $E[Y^{1} - Y^{0}]$。\n\nC. 不存在实际的正定性问题，因为暴露组之间存在一些重叠。不要修剪；使用非稳定的逆概率权重。剩下的估计量是 $E[Y^{1} - Y^{0}]$。\n\nD. 在高密度区域之外，重叠情况不佳；为了提高精度，积极地修剪至 $e(X) \\in [0.30, 0.60]$。剩下的估计量是处理组平均处理效应 (ATT)，即 $E[Y^{1} - Y^{0} \\mid A=1]$。\n\nE. 在极端的 $e(X)$ 值处，重叠不充分；修剪至 $e(X) \\in [0.22, 0.60]$，因为高于 $0.60$ 的非暴露单元很罕见。剩下的估计量是 $E[Y^{1} - Y^{0} \\mid e(X) \\in [0.22, 0.60]]$，即修剪后总体中的 ATE。",
            "solution": "用户需要对一个关于因果推断中正定性假设的问题进行批判性评估。\n\n### 第一步：提取已知信息\n\n- **因果模型：** 一项队列研究，包含一个二元干预 $A$（1为暴露，0为非暴露）、一个二元结局 $Y$ 和一组测量的基线协变量 $X$。\n- **倾向性得分 (PS)：** 在给定协变量的情况下暴露的概率，$e(X) = P(A=1 \\mid X)$。\n- **初始估计量：** 平均处理效应 (ATE)，$E[Y^{1} - Y^{0}]$。\n- **识别假设（正定性）：** 对于所有具有正概率密度的协变量配置 $x$，$0  e(x)  1$。\n- **经验数据（估计的PS）：** 使用逻辑斯谛回归模型来估计 $e(X)$。假设研究样本量大且 $e(X)$ 的模型设定正确。\n- **暴露组 ($A=1$) 的 $\\hat{e}(X)$ 支撑域：**\n    - 范围：$[0.22, 0.96]$。\n    - 分布：$15\\%$ 的暴露者 $\\hat{e}(X)  0.30$，$70\\%$ 的暴露者 $\\hat{e}(X) \\in [0.30, 0.80]$，以及 $15\\%$ 的暴露者 $\\hat{e}(X) > 0.80$。\n- **非暴露组 ($A=0$) 的 $\\hat{e}(X)$ 支撑域：**\n    - 范围：$[0.03, 0.62]$。\n    - 分布：$40\\%$ 的非暴露者 $\\hat{e}(X)  0.20$，$55\\%$ 的非暴露者 $\\hat{e}(X) \\in [0.20, 0.60]$，以及 $5\\%$ 的非暴露者 $\\hat{e}(X) > 0.60$。\n- **目标：** 诊断实际正定性违背，提出一个有原则的修剪规则，并陈述由此产生的因果估计量。\n\n### 第二步：使用提取的已知信息进行验证\n\n该问题陈述科学合理、定义明确且客观。它描述了在应用因果推断中使用倾向性得分的一个经典而现实的场景。\n\n1.  **科学合理性：** 所呈现的概念——ATE、潜在结局、倾向性得分、正定性假设和修剪——是流行病学及相关领域现代因果推断方法论的基础。逻辑是合理的。\n2.  **良定性：** 该问题提供了关于估计倾向性得分经验分布的充分定量信息，从而可以清晰地诊断重叠问题。问题要求提供一组可从所提供数据中推导出的特定交付成果（诊断、规则、估计量）。\n3.  **客观性：** 该问题以精确、定量的术语陈述，没有主观性语言。关于倾向性得分分布的数据清晰明确。\n4.  **一致性：** 所提供的倾向性得分分布的范围和百分比在内部是一致的，不包含矛盾。\n5.  **相关性：** 该问题直接涉及基于协变量分布选择暴露组和非暴露组，这是流行病学的核心课题。\n\n### 第三步：结论与行动\n\n该问题是**有效的**。将根据因果推断的原则，通过分析所提供的数据来推导出解决方案。\n\n### 求解过程\n\n正定性假设，也称为重叠或共同支撑域条件，要求对于倾向性得分 $e(X)$ 的任何给定值，观察到暴露 ($A=1$) 和非暴露 ($A=0$) 个体的概率都非零。在实践中，这意味着我们必须在用于估计的倾向性得分范围内拥有来自两个暴露组的受试者。\n\n1.  **诊断正定性违背：**\n    我们已知每个暴露组的估计倾向性得分 $\\hat{e}(X)$ 的经验支撑域（范围）：\n    - 暴露组 ($A=1$) 的支撑域：$S_1 = [0.22, 0.96]$\n    - 非暴露组 ($A=0$) 的支撑域：$S_0 = [0.03, 0.62]$\n\n    为了在由 $\\hat{e}(X) = e$ 定义的给定子群体中可识别因果效应，我们必须在该子群体中拥有来自两组的受试者。这个条件成立的区域是*共同支撑域*，即各个支撑域的交集：\n    $$ S_{\\text{common}} = S_1 \\cap S_0 $$\n    $$ S_{\\text{common}} = [0.22, 0.96] \\cap [0.03, 0.62] $$\n    两个闭区间的交集是 $[\\max(a, c), \\min(b, d)]$。\n    $$ S_{\\text{common}} = [\\max(0.22, 0.03), \\min(0.96, 0.62)] = [0.22, 0.62] $$\n    在此区间之外，正定性假设在经验上被违背：\n    - 在范围 $\\hat{e}(X) \\in [0.03, 0.22)$ 内，有非暴露受试者但没有暴露受试者。\n    - 在范围 $\\hat{e}(X) \\in (0.62, 0.96]$ 内，有暴露受试者但没有非暴露受试者。\n    在这些非重叠区域，不可能估计因果效应，因为没有反事实组可供比较。例如，一个 $\\hat{e}(X) = 0.80$ 的暴露受试者没有具有相似倾向性得分的非暴露对应者。像逆概率加权 (IPW) 这样的方法在这些区域会变得不稳定和无效，因为当分母接近于零时，权重 $1/\\hat{e}(X)$ 或 $1/(1-\\hat{e}(X))$ 会变得极大。\n\n2.  **提出一个有原则的修剪规则：**\n    处理这种缺乏重叠的一个有原则且标准的方法是将分析限制在共同支撑域内的群体。这被称为*修剪*。基于非重叠诊断的最直接的修剪规则是丢弃所有倾向性得分在共同支撑域之外的个体。\n    - 提出的修剪规则：将分析限制在 $\\hat{e}(X) \\in [0.22, 0.62]$ 的个体。\n\n3.  **陈述剩下的估计量：**\n    最初的目标是估计整个总体的 ATE，$E[Y^{1} - Y^{0}]$。通过修剪样本，我们明确地改变了推断的目标群体。我们不再对整个原始群体做出陈述，而只对那些其特征（由 $X$ 概括）与暴露和非暴露都相容的子群体做出陈述。这个新的、修剪后总体的估计量是条件于属于该总体的 ATE。\n    - 剩下的估计量：$E[Y^{1} - Y^{0} \\mid \\hat{e}(X) \\in [0.22, 0.62]]$。这是“修剪后总体中的 ATE”或“共同支撑域中的 ATE”。\n\n### 逐项分析\n\n**A. 对于低于 $0.22$ 和高于 $0.62$ 的 $e(X)$ 值，实际正定性被违背，因为其中一个暴露组在那里基本上没有支撑域。修剪至支撑域的交集，即 $e(X) \\in [0.22, 0.62]$。剩下的估计量是 $E[Y^{1} - Y^{0} \\mid e(X) \\in [0.22, 0.62]]$，即修剪后总体（共同支撑域）中的 ATE。**\n- 该选项正确地识别了非重叠区域（$0.22$ 和 $>0.62$）。它基于经验支撑域的交集提出了正确且有原则的修剪规则。它也正确地识别了由此产生的估计量是修剪规则所定义的修剪后子群体中的 ATE。\n- **结论：正确。**\n\n**B. 在低和高的 $e(X)$ 值处，实际正定性均被违背，但修剪是不必要的；相反，保留所有 $e(X) \\in [0.03, 0.96]$（支撑域的并集）的观测值，并使用逆概率加权来估计原始的 ATE。剩下的估计量是整个总体的 $E[Y^{1} - Y^{0}]$。**\n- 该选项正确地指出了违背情况，但提出了一个不正确的解决方案。试图在支撑域的*并集*（$[0.03, 0.96]$）上估计 ATE 正是正定性违背导致像 IPW 这样的估计器因极端权重和缺乏反事实而失效的地方。在这些条件下，无法可靠地估计原始 ATE。\n- **结论：错误。**\n\n**C. 不存在实际的正定性问题，因为暴露组之间存在一些重叠。不要修剪；使用非稳定的逆概率权重。剩下的估计量是 $E[Y^{1} - Y^{0}]$。**\n- 该选项错误地声称不存在实际的正定性问题。完全非重叠区域（$[0.03, 0.22)$ 和 $(0.62, 0.96]$）的存在正是实际正定性违背的定义。忽视这一点而不进行修剪在方法上是不合理的。\n- **结论：错误。**\n\n**D. 在高密度区域之外，重叠情况不佳；为了提高精度，积极地修剪至 $e(X) \\in [0.30, 0.60]$。剩下的估计量是处理组平均处理效应 (ATT)，即 $E[Y^{1} - Y^{0} \\mid A=1]$。**\n- 虽然为了减少方差，积极地修剪至高密度区域是一种可能的策略，但该选项在识别剩下的估计量时犯了一个关键错误。基于倾向性得分 $e(X)$ 进行修剪定义了一个基于协变量 $X$ 的子群体，而不是基于处理状态 $A$。由此产生的估计量是该协变量定义的子群体的 ATE，而不是处理组平均处理效应 (ATT)，后者是 $E[Y^{1} - Y^{0} \\mid A=1]$。ATT 有一个不同的目标群体（所有接受了处理的个体）。\n- **结论：错误。**\n\n**E. 在极端的 $e(X)$ 值处，重叠不充分；修剪至 $e(X) \\in [0.22, 0.60]$，因为高于 $0.60$ 的非暴露单元很罕见。剩下的估计量是 $E[Y^{1} - Y^{0} \\mid e(X) \\in [0.22, 0.60]]$，即修剪后总体中的 ATE。**\n- 该选项提出了一个 $[0.22, 0.60]$ 的修剪规则。这是共同支撑域 $[0.22, 0.62]$ 的一个子集。其理由（在 $0.60$ 和 $0.62$ 之间的非暴露单元很罕见）是提高估计器精度的一个可能的启发式方法。然而，为*确保重叠*而采取的最有原则和最直接的规则是修剪到完整的共同支撑域。选项 A 的规则 $[0.22, 0.62]$ 是对非重叠问题的直接和完整的答案。选项 E 的规则比 A 的规则略显武断且不够根本。因此，A 是更优选择，因为它根据给定的信息精确定义了共同支撑域的边界。\n- **结论：错误。**",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}