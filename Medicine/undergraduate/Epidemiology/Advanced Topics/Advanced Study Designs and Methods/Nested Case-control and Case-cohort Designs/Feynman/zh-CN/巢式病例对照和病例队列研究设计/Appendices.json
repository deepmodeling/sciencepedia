{
    "hands_on_practices": [
        {
            "introduction": "嵌套病例对照研究的有效性取决于其巧妙的抽样策略。第一个练习将分解单个事件发生时间点的抽样过程，要求您推导任何符合条件的个体被选为对照的基本概率。这是理解整个设计及其统计特性的基石。",
            "id": "4614280",
            "problem": "在失败时间 $t_i$ 的巢式病例对照研究中，从风险集 $R(t_i)$ 中确定了一个新发病例。风险集 $R(t_i)$ 的大小为 $Y(t_i)$，定义为在 $t_i$ 之前瞬间处于风险中的个体数量（包括在 $t_i$ 时刻失败的病例）。从定义为 $R(t_i) \\setminus \\{\\text{在 } t_i \\text{ 时的病例}\\}$ 的合格对照中，通过不放回简单随机抽样（SRS）选出固定数量 $m$ 的对照。考虑一个个体 $j$，满足 $j \\in R(t_i)$ 且 $j$ 不是在 $t_i$ 时的病例。仅使用不放回简单随机抽样和基本组合计数的定义，推导在时间 $t_i$ 时，个体 $j$ 被选为 $m$ 个对照之一的概率。将您的最终答案表示为关于 $m$ 和 $Y(t_i)$ 的单个简化解析表达式。无需四舍五入，也不应包含任何单位。",
            "solution": "首先将对问题陈述的科学合理性、清晰度和完整性进行验证。\n\n### 步骤 1：提取已知条件\n- 研究设计：巢式病例对照。\n- 事件时间：$t_i$。\n- 病例确定：在 $t_i$ 时刻确定一个新发病例。\n- 风险集：$R(t_i)$ 是在 $t_i$ 之前瞬间处于风险中的个体集合。\n- 风险集大小：$Y(t_i) = |R(t_i)|$。\n- 合格对照：$R(t_i)$ 中除病例外所有个体的集合，即 $R(t_i) \\setminus \\{\\text{在 } t_i \\text{ 时的病例}\\}$。\n- 对照选择：从合格对照中选出固定数量 $m$ 的对照。\n- 抽样方法：不放回简单随机抽样（SRS）。\n- 目标个体：一个个体 $j$，满足 $j \\in R(t_i)$ 且 $j$ 不是在 $t_i$ 时的病例。\n- 目标：推导在时间 $t_i$ 时，个体 $j$ 被选为 $m$ 个对照之一的概率。\n- 方法限制：仅使用不放回简单随机抽样和基本组合计数的定义。\n- 最终表达式：结果必须是关于 $m$ 和 $Y(t_i)$ 的单个简化解析表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n这是一个关于研究设计和抽样理论的标准理论问题，在流行病学和生物统计学中具有科学依据。风险集、病例对照抽样和不放回简单随机抽样的概念都有明确的定义。问题表述清晰，目标明确，并提供了足够的信息来推导出唯一解。语言客观而精确。已知条件是自洽的，该设置是分析巢式病例对照研究特性的标准设置。验证标准中列出的缺陷均不存在。\n\n### 步骤 3：结论与行动\n问题有效。将提供一个合理的解答。\n\n### 解题推导\n目标是求出某个特定个体 $j$（一个合格对照）被选入 $m$ 个对照样本中的概率。我们将按规定使用组合原理。\n\n设时间 $t_i$ 的合格对照集为 $C_{elig}$。风险集 $R(t_i)$ 中的个体总数为 $Y(t_i)$。该集合包括在 $t_i$ 时刻失败的那个病例。合格对照集由风险集中除此病例外所有个体组成。\n因此，合格对照的总数为：\n$$ |C_{elig}| = Y(t_i) - 1 $$\n\n我们正在从这 $Y(t_i) - 1$ 个合格对照中，通过不放回简单随机抽样（SRS）选出一个大小为 $m$ 的对照样本。\n\n从 $Y(t_i) - 1$ 个合格对照的总体中，可以抽取的不同的大小为 $m$ 的样本总数由二项式系数“N 选 k”给出，其中 $N = Y(t_i) - 1$ 且 $k = m$。\n$$ \\text{可能样本的总数} = \\binom{Y(t_i) - 1}{m} $$\n这表示样本空间的大小，其中每个结果都是由 $m$ 个个体组成的等可能组合。\n\n接下来，我们必须确定包含我们感兴趣的特定个体 $j$ 的样本数量。如果要将个体 $j$ 包含在样本中，那么我们已经占用了样本中 $m$ 个位置中的一个。然后我们必须从剩余的合格对照池中选择剩下的 $m-1$ 个对照。\n\n在确定选定 $j$ 之后，剩余合格对照池的大小是原始合格对照数减去个体 $j$。\n$$ \\text{剩余合格对照数} = (Y(t_i) - 1) - 1 = Y(t_i) - 2 $$\n\n从这 $Y(t_i) - 2$ 个个体的池中选择剩下的 $m-1$ 个对照的方法数是：\n$$ \\text{包含 } j \\text{ 的样本数} = \\binom{Y(t_i) - 2}{m-1} $$\n这表示有利结果的数量。\n\n一个事件的概率是有利结果数与可能结果总数之比。因此，个体 $j$ 被选中的概率是：\n$$ P(j \\text{ 被选中}) = \\frac{\\text{包含 } j \\text{ 的样本数}}{\\text{可能样本的总数}} = \\frac{\\binom{Y(t_i) - 2}{m-1}}{\\binom{Y(t_i) - 1}{m}} $$\n\n为简化此表达式，我们使用其定义 $\\binom{n}{k} = \\frac{n!}{k!(n-k)!}$ 展开二项式系数。\n$$ \\binom{Y(t_i) - 2}{m-1} = \\frac{(Y(t_i) - 2)!}{(m-1)!(Y(t_i) - m - 1)!} $$\n$$ \\binom{Y(t_i) - 1}{m} = \\frac{(Y(t_i) - 1)!}{m!(Y(t_i) - m - 1)!} $$\n\n现在，我们计算比率：\n$$ P(j \\text{ 被选中}) = \\frac{\\frac{(Y(t_i) - 2)!}{(m-1)!(Y(t_i) - m - 1)!}}{\\frac{(Y(t_i) - 1)!}{m!(Y(t_i) - m - 1)!}} $$\n我们可以从分子和分母的分数中消去公因式 $(Y(t_i) - m - 1)!$。\n$$ P(j \\text{ 被选中}) = \\frac{(Y(t_i) - 2)!}{(m-1)!} \\times \\frac{m!}{(Y(t_i) - 1)!} $$\n现在，我们展开阶乘项 $m! = m \\times (m-1)!$ 和 $(Y(t_i) - 1)! = (Y(t_i) - 1) \\times (Y(t_i) - 2)!$。\n$$ P(j \\text{ 被选中}) = \\frac{(Y(t_i) - 2)!}{(m-1)!} \\times \\frac{m \\cdot (m-1)!}{(Y(t_i) - 1) \\cdot (Y(t_i) - 2)!} $$\n消去项 $(m-1)!$ 和 $(Y(t_i) - 2)!$ 后，我们得到简化表达式。\n$$ P(j \\text{ 被选中}) = \\frac{m}{Y(t_i) - 1} $$\n这是在时间 $t_i$ 时，任何给定的合格对照 $j$ 被选入 $m$ 个对照的匹配集中的概率。这个结果取决于一个实际约束，即要抽样的对照数量 $m$ 不超过可用的合格对照数量，即 $m \\leq Y(t_i) - 1$。",
            "answer": "$$\\boxed{\\frac{m}{Y(t_i) - 1}}$$"
        },
        {
            "introduction": "在理解了抽样机制之后，下一步便是分析。本练习使用一个假设的数据集，向您展示如何通过对匹配集进行条件logistic回归来正确估计风险比（hazard ratio），即使在结局事件常见的队列中也是如此。这项实践突显了嵌套病例对照设计的一个关键优势，并巩固了风险集抽样与Cox模型之间的联系。",
            "id": "4614275",
            "problem": "一个大小为 $N = 10$ 的封闭队列从基线开始被随访，直到一个固定的管理性随访终点。暴露 $X \\in \\{0,1\\}$ 在基线时是固定的，并且不随时间变化。事件发生时间是不同的。假设数据生成机制遵循 Cox 比例风险 (CPH) 模型，其风险函数为 $\\lambda(t \\mid X) = \\lambda_{0}(t)\\exp(\\beta X)$，其中 $\\lambda_{0}(t)$ 是未知的基线风险，$\\beta$ 是一个恒定的对数风险比。真实参数为 $\\exp(\\beta^{\\star}) = 3$。在随访期间，10 个个体中有 6 个经历了事件，因此在该队列中结局是常见的，累积发病率为 $6/10 = 0.6$。使用发病密度抽样进行了一项巢式病例对照研究：在 6 个不同的事件时间点上，每个时间点都从该事件发生前的风险集中随机均匀抽取一个对照，形成 6 个匹配对（病例和抽取的对照）。\n\n得到的巢式病例对照样本包含以下暴露状态的匹配对 $(X_{\\text{case}}, X_{\\text{control}})$，按 6 个事件时间的先后顺序排列：\n- 对 1：$(1,0)$\n- 对 2：$(1,1)$\n- 对 3：$(0,1)$\n- 对 4：$(1,0)$\n- 对 5：$(0,0)$\n- 对 6：$(1,0)$\n\n仅从 CPH 模型假设 $\\lambda(t \\mid X) = \\lambda_{0}(t)\\exp(\\beta X)$ 和巢式病例对照设计中对风险集进行发病密度抽样的定义出发，推导每个病例匹配一个对照的匹配对的条件似然，并说明它如何简化为不一致对的数量和病例暴露的不一致对数量的函数。然后，根据上述 6 个匹配对，计算风险比 $\\exp(\\beta)$ 的条件逻辑回归估计量。最后，将此估计值与真实风险比 $\\exp(\\beta^{\\star}) = 3$ 进行比较，以证明即使在基础队列中结局是常见的，巢式病例对照的条件逻辑回归对风险比的估计仍然是无偏的。\n\n将估计的风险比 $\\exp(\\hat{\\beta})$ 报告为四舍五入到四位有效数字的单个数值。不需要单位。",
            "solution": "我们从 Cox 比例风险 (CPH) 模型 $\\lambda(t \\mid X) = \\lambda_{0}(t)\\exp(\\beta X)$ 和通过发病密度抽样构建巢式病例对照研究开始，在该研究中，对照是在每次失败事件发生前从风险集中均匀抽样的。对于由 $i$ 索引的每个失败时间，令 $\\mathcal{R}_{i}$ 表示该事件时间点之前的风险集，并假设从 $\\mathcal{R}_{i} \\setminus \\{\\text{病例}\\}$ 中随机均匀抽取一个对照。在时间 $t_{i}$ 得到的匹配集包含该病例和一个抽取的对照。\n\n在 CPH 模型下，完整队列的偏似然可以写成对所有失败时间 $i$ 的乘积\n$$\n\\frac{\\exp(\\beta X_{i,\\text{case}})}{\\sum_{j \\in \\mathcal{R}_{i}} \\exp(\\beta X_{ij})}\n$$\n每个病例匹配一个对照的发病密度抽样将分母替换为一个与匹配集（病例和抽取的对照）上的总和成比例的项，因为该抽样方案产生的条件似然，在给定抽样集的情况下，仅通过集合内的相对风险依赖于 $\\beta$。具体来说，在时间 $t_{i}$，给定一个大小为 2 的匹配集，其暴露为 $(X_{i,\\text{case}}, X_{i,\\text{control}})$，病例具有暴露 $X_{i,\\text{case}}$ 而不是 $X_{i,\\text{control}}$ 的条件概率为\n$$\n\\Pr\\{\\text{case has } X_{i,\\text{case}} \\mid X_{i,\\text{case}}, X_{i,\\text{control}}\\}\n= \\frac{\\exp(\\beta X_{i,\\text{case}})}{\\exp(\\beta X_{i,\\text{case}}) + \\exp(\\beta X_{i,\\text{control}})}\n$$\n这源于 CPH 模型，因为在一个风险集内，在 $t_i$ 时刻成为病例的瞬时风险与 $\\exp(\\beta X)$ 成正比，并且对匹配集进行条件化消除了 $\\lambda_{0}(t_{i})$ 和完整风险集的大小。因此，所有 $m$ 个匹配对（这里 $m = 6$）的条件似然是\n$$\nL(\\beta) = \\prod_{i=1}^{m} \\frac{\\exp(\\beta X_{i,\\text{case}})}{\\exp(\\beta X_{i,\\text{case}}) + \\exp(\\beta X_{i,\\text{control}})}\n$$\n\n按匹配对类型考虑其贡献：\n- 如果一对是一致的，即 $X_{i,\\text{case}} = X_{i,\\text{control}}$，那么其贡献为\n$$\n\\frac{\\exp(\\beta X)}{\\exp(\\beta X) + \\exp(\\beta X)} = \\frac{1}{2}\n$$\n这不依赖于 $\\beta$，因此不携带用于估计 $\\beta$ 的信息。\n- 如果一对是不一致的，比如 $(X_{i,\\text{case}}, X_{i,\\text{control}}) = (1,0)$，那么其贡献为\n$$\n\\frac{\\exp(\\beta)}{\\exp(\\beta) + 1} = \\frac{\\exp(\\beta)}{1 + \\exp(\\beta)}\n$$\n如果该对是不一致的，且 $(X_{i,\\text{case}}, X_{i,\\text{control}}) = (0,1)$，那么其贡献为\n$$\n\\frac{1}{1 + \\exp(\\beta)}\n$$\n\n令 $D$ 表示不一致对的总数，令 $Y$ 表示病例暴露的不一致对的数量，即类型为 $(1,0)$ 的对的数量。条件似然在忽略一个乘法常数（即丢弃一致对的常数贡献）的情况下为\n$$\nL(\\beta) \\propto \\left(\\frac{\\exp(\\beta)}{1 + \\exp(\\beta)}\\right)^{Y} \\left(\\frac{1}{1 + \\exp(\\beta)}\\right)^{D - Y}\n$$\n对数似然为\n$$\n\\ell(\\beta) = Y \\beta - D \\ln\\!\\left(1 + \\exp(\\beta)\\right) + \\text{constant}\n$$\n对 $\\beta$ 求导并将导数设为零，得到得分方程\n$$\n\\frac{d\\ell(\\beta)}{d\\beta} = Y - D \\cdot \\frac{\\exp(\\beta)}{1 + \\exp(\\beta)} = 0\n$$\n求解 $\\exp(\\beta)$，\n$$\nY = D \\cdot \\frac{\\exp(\\beta)}{1 + \\exp(\\beta)}\n\\;\\;\\Longrightarrow\\;\\;\nY\\left(1 + \\exp(\\beta)\\right) = D \\exp(\\beta)\n\\;\\;\\Longrightarrow\\;\\;\nY = \\exp(\\beta)\\left(D - Y\\right)\n\\;\\;\\Longrightarrow\\;\\;\n\\exp(\\hat{\\beta}) = \\frac{Y}{D - Y}\n$$\n\n我们现在根据观察到的匹配对计算 $Y$ 和 $D$。这 6 对是：\n- 对 1：$(1,0)$ 不一致，病例暴露\n- 对 2：$(1,1)$ 一致\n- 对 3：$(0,1)$ 不一致，病例未暴露\n- 对 4：$(1,0)$ 不一致，病例暴露\n- 对 5：$(0,0)$ 一致\n- 对 6：$(1,0)$ 不一致，病例暴露\n\n因此，不一致对的数量是 $D = 4$（对 1、3、4、6），其中病例暴露的数量是 $Y = 3$（对 1、4、6）。所以，\n$$\n\\exp(\\hat{\\beta}) = \\frac{Y}{D - Y} = \\frac{3}{4 - 3} = 3\n$$\n\n风险比的这个条件逻辑回归（即对应于匹配集的条件似然）估计量等于 $3$，这与通过构造得出的真实风险比 $\\exp(\\beta^{\\star}) = 3$ 相匹配。关键的是，这种相等关系源于风险集抽样和 CPH 模型结构，而非任何罕见病假设。在该队列中，结局是常见的，累积发病率为 $6/10 = 0.6$，但该估计量仍能正确地恢复风险比，这证明了即使在结局常见的情况下，巢式病例对照的条件逻辑回归对于风险比的估计也是无偏的。\n\n将估计的风险比四舍五入到四位有效数字，得到 $3.000$。",
            "answer": "$$\\boxed{3.000}$$"
        },
        {
            "introduction": "现在我们将焦点转向病例队列研究，这是嵌套病例对照研究的一种高效替代方案。规划此类研究的一个关键步骤是估算所需资源。本练习将指导您计算需要进行昂贵生物标志物测量的预期样本数量，这是评估研究可行性和制定预算时的关键指标。",
            "id": "4614262",
            "problem": "一项基于人群的队列研究从基线开始追踪一个规模为 $N$ 的固定队列，直至预先设定的随访终点。在随访期间，队列中总共出现了 $D$ 例该疾病的新发病例。研究人员计划进行一项病例队列研究，在第二阶段数据收集中测量一种昂贵的生物标志物。根据病例队列设计，在基线时通过无放回简单随机抽样（SRS）选择一个子队列，子队列抽样分数为 $f$（因此子队列规模为 $fN$）。该设计规定，仅对以下人员在第二阶段测量这种昂贵的生物标志物：（i）子队列的所有成员，以及（ii）所有不属于子队列的新发病例。如果一个病例恰好在子队列中，则作为子队列成员被测量一次；不会发生重复。假设子队列的选择相对于病例状态是无信息的，即子队列的成员资格独立于疾病发生过程，并且 $D$ 个病例的出现是均匀的，即任何队列成员成为病例的可能性均等。\n\n仅使用 SRS 的基本定义和概率论中的期望，推导该病例队列设计所需的第二阶段生物标志物测量的期望数量，并将其表示为关于 $N$、$f$ 和 $D$ 的闭式解析表达式。将最终答案表示为简化表达式。无需进行数值计算，也无需四舍五入。",
            "solution": "该问题陈述是生物统计学和流行病学领域的一个适定问题，其基础是概率论和抽样理论的原理。该问题是自洽的，科学上合理的，且没有矛盾或歧义。因此，可以推导出解决方案。\n\n目标是确定在病例队列研究中将接受生物标志物测量的独立个体的期望数量。该设计明确规定，测量对象为随机选择的子队列的所有成员，以及任何落在该子队列之外的额外病例。\n\n设 $N$ 为固定队列中的个体总数。\n设 $D$ 为队列中发生的新发病例总数。\n设 $f$ 为子队列的抽样分数，子队列是在基线时通过无放回简单随机抽样（SRS）选出的。\n因此，子队列的规模为 $n_{sc} = fN$。\n\n设 $S$ 表示子队列中的个体集合，因此 $|S| = fN$。\n设 $C$ 表示成为病例的个体集合，因此 $|C| = D$。\n接受生物标志物测量的个体集合（我们将其表示为 $M_{set}$）是子队列成员集合与病例集合的并集。这是因为，如果一个个体在子队列中，或者是一个病例，他就会被测量。集合并集的定义自然地处理了“不发生重复”这一条件。\n$$ M_{set} = S \\cup C $$\n所需测量总数是该集合的大小 $|M_{set}|$。我们需要求这个量的期望值 $E[|M_{set}|]$。\n\n使用两个集合并集基数的容斥原理，我们可以写出：\n$$ |M_{set}| = |S \\cup C| = |S| + |C| - |S \\cap C| $$\n此处，$|S \\cap C|$ 是既是病例又是子队列成员的个体数量。\n\n现在我们可以对该表达式取期望。根据期望的线性性质：\n$$ E[|M_{set}|] = E[|S| + |C| - |S \\cap C|] = E[|S|] + E[|C|] - E[|S \\cap C|] $$\n问题陈述指出，队列规模 $N$、病例数 $D$ 和抽样分数 $f$ 都是固定量。因此，子队列的规模 $|S| = fN$ 和病例数 $|C| = D$ 是常量，而不是随机变量。它们的期望就是它们本身的值。\n$$ E[|S|] = fN $$\n$$ E[|C|] = D $$\n项 $|S \\cap C|$ 是一个随机变量，因为它代表了恰好被选入随机选择的子队列中的病例数量。我们的任务简化为求这个随机变量的期望 $E[|S \\cap C|]$。\n\n设 $X = |S \\cap C|$。为了从基本原理出发求得 $E[X]$，我们可以使用示性变量法。设 $D$ 个病例的索引为 $j=1$ 到 $D$。对于每个病例 $j$，我们定义一个示性随机变量 $I_j$：\n$$ I_j = \\begin{cases} 1  \\text{如果病例 } j \\text{ 在子队列 } S \\text{ 中} \\\\ 0  \\text{如果病例 } j \\text{ 不在子队列 } S \\text{ 中} \\end{cases} $$\n子队列中的病例总数是这些示性变量的和：\n$$ X = \\sum_{j=1}^{D} I_j $$\n根据期望的线性性质：\n$$ E[X] = E\\left[\\sum_{j=1}^{D} I_j\\right] = \\sum_{j=1}^{D} E[I_j] $$\n示性变量的期望是它所指示的事件的概率：\n$$ E[I_j] = 1 \\cdot P(I_j = 1) + 0 \\cdot P(I_j = 0) = P(I_j = 1) $$\n$P(I_j = 1)$ 是某个特定个体（在此为病例 $j$）被包含在子队列中的概率。子队列是通过从包含 $N$ 个个体的总队列中进行无放回简单随机抽样（SRS）形成的，样本大小为 $fN$。\n\n从一个规模为 $N$ 的队列中抽取规模为 $fN$ 的子队列，可能的子队列总数为二项式系数 $\\binom{N}{fN}$。\n为了使某个特定个体被包含在子队列中，我们必须选择该个体，然后从队列中剩余的 $N-1$ 个个体中选择子队列的其余 $fN-1$ 个成员。这样做的组合数为 $\\binom{1}{1}\\binom{N-1}{fN-1} = \\binom{N-1}{fN-1}$。\n\n因此，任何给定个体的入选概率为：\n$$ P(I_j = 1) = \\frac{\\text{包含个体 } j \\text{ 的子队列数量}}{\\text{所有可能的子队列总数}} = \\frac{\\binom{N-1}{fN-1}}{\\binom{N}{fN}} $$\n让我们简化这个表达式：\n$$ \\frac{\\binom{N-1}{fN-1}}{\\binom{N}{fN}} = \\frac{\\frac{(N-1)!}{(fN-1)!(N-1 - (fN-1))!}}{\\frac{N!}{(fN)!(N-fN)!}} = \\frac{(N-1)!}{(fN-1)!(N-fN)!} \\cdot \\frac{(fN)!(N-fN)!}{N!} $$\n我们可以消去 $(N-fN)!$ 项，并展开其他阶乘：\n$$ \\frac{(N-1)!}{N!} \\cdot \\frac{(fN)!}{(fN-1)!} = \\frac{(N-1)!}{N \\cdot (N-1)!} \\cdot \\frac{fN \\cdot (fN-1)!}{(fN-1)!} = \\frac{1}{N} \\cdot fN = f $$\n因此，任何个体被选入子队列的概率就是抽样分数 $f$。这是 SRS 的一个基本性质。问题陈述指出，子队列的选择相对于病例状态是无信息的，所以这个概率同样适用于病例和非病例。\n因此，对于所有的 $j=1, \\ldots, D$，$E[I_j] = f$。\n\n现在我们可以计算 $E[X]$：\n$$ E[X] = \\sum_{j=1}^{D} E[I_j] = \\sum_{j=1}^{D} f = Df $$\n所以，子队列中病例的期望数量是 $Df$。这个结果也可以直接表述为超几何分布的均值，其总体大小为 $N$，成功事件数为 $D$，样本大小为 $fN$，即 $(fN) \\cdot (D/N) = fD$。\n\n最后，我们将此结果代回到测量总数期望值的表达式中：\n$$ E[|M_{set}|] = |S| + |C| - E[|S \\cap C|] $$\n$$ E[|M_{set}|] = fN + D - Df $$\n这个表达式可以通过提取公因子 $D$ 来简化：\n$$ E[|M_{set}|] = fN + D(1 - f) $$\n这就是第二阶段生物标志物测量期望数量的闭式解析表达式。",
            "answer": "$$\\boxed{fN + D(1 - f)}$$"
        }
    ]
}