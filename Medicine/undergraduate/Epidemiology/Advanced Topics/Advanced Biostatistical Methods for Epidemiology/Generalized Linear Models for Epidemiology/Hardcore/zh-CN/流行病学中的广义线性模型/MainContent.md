## 引言
在现代流行病学研究中，数据形式多样，远不止于传统[线性模型](@entry_id:178302)所假设的正态分布。从疾病状态的[二元结果](@entry_id:173636)（是/否），到特定区域的病例计数，研究人员需要一个更强大、更灵活的工具来分析这些复杂的数据。广义线性模型（Generalized Linear Models, GLM）应运而生，它极大地扩展了[回归分析](@entry_id:165476)的边界，已成为流行病学家分析工具箱中不可或缺的基石。传统线性模型在处理非正态、有界或离散的结局变量时面临根本性困难，这限制了我们从流行病学数据中提取准确推断的能力。GLM通过其巧妙的架构，完美地解决了这一问题，为不同类型的数据提供了一个统一的建模框架。

本文将系统地引导您深入理解GLM的世界。在第一章“原理与机制”中，我们将剖析构成GLM的三大核心组件，并探讨[参数估计](@entry_id:139349)、混杂控制等基本理论。第二章“应用与跨学科联系”将展示GLM如何在真实的流行病学场景中大放异彩，从建模核心效应度量到处理聚类数据和高维数据等高级应用。最后，在“动手实践”部分，您将通过具体的练习，将理论知识转化为解决实际问题的能力。通过这三个循序渐进的章节，您将不仅掌握GLM的“是什么”和“为什么”，更能学会“如何用”，从而自信地将其应用于您未来的研究工作中。现在，让我们从GLM的核心原理开始探索。

## 原理与机制

### 广义线性模型的架构

[广义线性模型](@entry_id:171019) (Generalized Linear Models, GLM) 为分析不同类型的数据提供了一个统一而强大的框架，极大地扩展了传统线性模型的能力。与假定结果变量服从正态分布的普通[线性模型](@entry_id:178302)不同，GLM 允许结果变量服从更广泛的概率分布，这使其特别适用于流行病学研究中常见的二进制（如患病/未患病）、计数（如病例数）或偏态连续数据。GLM 的核心结构由三个基本部分组成：**随机成分** (random component)、**系统成分** (systematic component) 和**连接函数** (link function)。

#### 随机成分：[指数分布族](@entry_id:263444)

GLM 的第一个核心假设是，在给定协变量的情况下，每个独立的观测值 $Y_i$ 的概率分布都属于**[指数分布族](@entry_id:263444)** (exponential family)。这个分布族涵盖了许多在流行病学中至关重要的分布，包括正态分布、二项分布、泊松分布和伽玛分布。

一个分布若属于[指数分布族](@entry_id:263444)，其[概率密度函数](@entry_id:140610)（对于连续变量）或[概率质量函数](@entry_id:265484)（对于[离散变量](@entry_id:263628)）可以写成如下的**典范形式** (canonical form)：
$$
f(y_i \mid \theta_i, \phi) = \exp\left\{ \frac{y_i \theta_i - b(\theta_i)}{a(\phi)} + c(y_i, \phi) \right\}
$$
 。在这个表达式中：
- $y_i$ 是第 $i$ 个观测值。
- $\theta_i$ 是**典范参数** (canonical parameter) 或自然参数，它与协变量相关，因此因观测值而异。
- $\phi$ 是**离散参数** (dispersion parameter) 或[尺度参数](@entry_id:268705)，通常假定对所有观测值是常数。
- $a(\cdot)$, $b(\cdot)$ 和 $c(\cdot, \cdot)$ 是确定具体分布类型的已知函数。例如，对于泊松分布，$b(\theta_i) = \exp(\theta_i)$ 且 $a(\phi)=1$；对于正态分布，$b(\theta_i) = \theta_i^2 / 2$ 且 $a(\phi) = \phi = \sigma^2$。

[指数分布族](@entry_id:263444)的一个关键特性是，结果变量的均值 $\mu_i = \mathbb{E}[Y_i]$ 和方差 $\operatorname{Var}(Y_i)$ 与函数 $b(\theta_i)$ 直接相关。通过对概率密度函数的[归一化条件](@entry_id:156486) $\int f(y; \theta, \phi) dy = 1$ 进行[微分](@entry_id:158422)，可以从第一性原理推导出以下重要关系 ：
- **均值**: $\mu_i = \mathbb{E}[Y_i] = b'(\theta_i)$，即均值是函数 $b(\cdot)$ 对典范参数 $\theta_i$ 的[一阶导数](@entry_id:749425)。
- **方差**: $\operatorname{Var}(Y_i) = b''(\theta_i) a(\phi)$，即方差是 $b(\cdot)$ 的二阶导数与离散参数函数 $a(\phi)$ 的乘积。

函数 $V(\mu_i) = b''(\theta_i)$ 被称为**方差函数** (variance function)，因为它描述了方差如何依赖于均值。这是 GLM 与普通线性模型的一个根本区别，后者假定方差恒定（即 $\operatorname{Var}(Y_i) = \sigma^2$）。在 GLM 框架下，例如泊松分布，其均值和方差都等于 $\mu_i$；对于[二项分布](@entry_id:141181)，其均值为 $n_i p_i$，方差为 $n_i p_i (1-p_i)$，方差是均值的函数。这种固有的均值-方差关系是 GLM 能够灵活处理非正态数据的关键。

#### 系统成分：线性预测子

系统成分定义了模型的预测结构，它通过协变量的[线性组合](@entry_id:155091)来构建一个**线性预测子** (linear predictor)，记为 $\eta_i$：
$$
\eta_i = \mathbf{x}_i^\top \boldsymbol{\beta} = \beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \dots + \beta_p x_{ip}
$$
其中，$\mathbf{x}_i$ 是第 $i$ 个观测值的协变量向量，$\boldsymbol{\beta}$ 是待估计的未知回归系数向量。这部分与传统线性模型完全相同，确保了模型参数的[可解释性](@entry_id:637759)。

#### [连接函数](@entry_id:636388)

**[连接函数](@entry_id:636388)** $g(\cdot)$ 是连接随机成分（通过其均值 $\mu_i$）和系统成分（线性预测子 $\eta_i$）的桥梁。它是一个单调可微的函数，其关系定义为：
$$
g(\mu_i) = \eta_i
$$
将这三个成分结合起来，我们就得到了 GLM 的核心方程：
$$
g(\mathbb{E}[Y_i]) = \mathbf{x}_i^\top \boldsymbol{\beta}
$$
连接函数的选择至关重要，因为它决定了协变量与结果均值之间的关系尺度。例如，它允许我们将一个受限于 $(0,1)$ 区间的概率（均值）与一个可以在 $(-\infty, +\infty)$ 范围内取值的线性预测子联系起来。

作为对比，**普通线性模型 (Ordinary Linear Model, OLM)** 是 GLM 的一个特例 ：
- **随机成分**: 结果变量 $Y_i$ 服从正态分布 $\mathcal{N}(\mu_i, \sigma^2)$，这是[指数分布族](@entry_id:263444)的一员。
- **系统成分**: [线性预测](@entry_id:180569)子 $\eta_i = \mathbf{x}_i^\top \boldsymbol{\beta}$。
- **[连接函数](@entry_id:636388)**: **恒等连接** (identity link)，即 $g(\mu_i) = \mu_i$。因此，模型直接假设 $\mu_i = \mathbf{x}_i^\top \boldsymbol{\beta}$，并且方差 $\operatorname{Var}(Y_i) = \sigma^2$ 是一个与均值无关的常数。

GLM 的威力在于通过改变随机成分和连接函数，可以构建出适用于不同数据类型的模型，同时保持[线性预测](@entry_id:180569)[子带](@entry_id:154462)来的解释便利性。

### 连接模型与流行病学效应度量

在流行病学中，我们通常关心暴露与疾病结局之间的关联强度，这些关联强度通过**效应度量** (effect measures) 来量化。对于二进制结局（如患病/未患病），常见的效应度量包括风险差 (Risk Difference, RD)、风险比 (Risk Ratio, RR) 和比值比 (Odds Ratio, OR)。GLM 框架通过选择不同的[连接函数](@entry_id:636388)，可以直接对这些效应度量进行建模 。

假设我们有一个二进制结局 $Y \in \{0, 1\}$ 和一个二进制暴露 $X \in \{0, 1\}$。模型的均值 $\mu(X) = \mathbb{E}[Y \mid X] = p(X)$ 代表在暴露水平为 $X$ 时发生结局的风险（概率）。

- **恒等连接 (Identity Link): $g(p) = p$**
  该模型为 $p(X) = \alpha + \beta X$。在这种情况下，暴露组 ($X=1$) 和非暴露组 ($X=0$) 的风险分别为 $p(1) = \alpha + \beta$ 和 $p(0) = \alpha$。因此，回归系数 $\beta$ 直接等于**风险差**：
  $$
  \beta = p(1) - p(0) = \text{RD}
  $$
  这个模型，也称为线性概率模型，直接模拟风险的绝对差异。但它的一个实际问题是，预测的概率 $p(X)$ 可能会超出 $[0, 1]$ 的合理范围。

- **对数连接 (Log Link): $g(p) = \ln(p)$**
  该模型为 $\ln(p(X)) = \alpha + \beta X$，即 $p(X) = \exp(\alpha + \beta X)$。此时，暴露组和非暴露组的风险分别为 $p(1) = \exp(\alpha)\exp(\beta)$ 和 $p(0) = \exp(\alpha)$。两者的比值，即**风险比**，由 $\exp(\beta)$ 给出：
  $$
  \frac{p(1)}{p(0)} = \frac{\exp(\alpha)\exp(\beta)}{\exp(\alpha)} = \exp(\beta) = \text{RR}
  $$
  这种模型（通常称为对数[二项模型](@entry_id:275034)）直接[估计风险](@entry_id:139340)的[乘性](@entry_id:187940)效应，即风险比。

- **Logit 连接 (Logit Link): $g(p) = \ln\left(\frac{p}{1-p}\right)$**
  这是最常用的逻辑[回归模型](@entry_id:163386)。连接函数将概率 $p$ 转换为对数比值 (log-odds)。模型为 $\text{logit}(p(X)) = \alpha + \beta X$。暴露组和非暴露组的对数比值分别为 $\ln(\text{odds}(1)) = \alpha + \beta$ 和 $\ln(\text{odds}(0)) = \alpha$。两者之差为 $\beta$，即对数比值比。因此，$\exp(\beta)$ 等于**比值比**：
  $$
  \exp(\beta) = \exp(\ln(\text{odds}(1)) - \ln(\text{odds}(0))) = \frac{\text{odds}(1)}{\text{odds}(0)} = \text{OR}
  $$
  逻辑回归模型在流行病学中应用极为广泛，它估计的是比值的[乘性](@entry_id:187940)效应，即比值比。

通过恰当地选择[连接函数](@entry_id:636388)，流行病学家可以将[统计模型](@entry_id:755400)中的回归系数直接与他们所关心的、具有明确公共卫生意义的效应度量联系起来。

### [模型拟合](@entry_id:265652)与参数估计

确定了 GLM 的结构后，下一步是利用观测数据估计[回归系数](@entry_id:634860) $\boldsymbol{\beta}$。最常用的方法是**[最大似然估计](@entry_id:142509)** (Maximum Likelihood Estimation, MLE)。MLE 的核心思想是找到一组参数值 $\hat{\boldsymbol{\beta}}$，使得在该参数下观测到当前数据集的概率（即似然函数）最大。

从数学上讲，这等价于求解**得分方程** (score equations)，即[对数似然函数](@entry_id:168593) $\ell(\boldsymbol{\beta})$ 对每个参数 $\beta_j$ 的偏导数等于零的方程组：
$$
\frac{\partial \ell(\boldsymbol{\beta})}{\partial \boldsymbol{\beta}} = \mathbf{0}
$$

对于 GLM，得分方程的一般形式相当复杂。然而，当选择一个特殊的连接函数——**典范连接** (canonical link)——时，得分方程会得到显著简化 。典范连接被定义为使线性预测子 $\eta_i$ 直接等于典范参数 $\theta_i$ 的[连接函数](@entry_id:636388)，即 $g(\mu_i) = \theta_i$。例如，对于泊松分布，典范连接是对数连接；对于二项分布，典范连接是 logit 连接。

在典范连接下，得分方程简化为一种直观的形式：
$$
\sum_{i=1}^n \mathbf{x}_i (y_i - \mu_i) = \mathbf{0}
$$
这个方程表明，在最大似然估计下，残差 $(y_i - \mu_i)$ 与每个协变量 $\mathbf{x}_i$ 的加权和为零。这种简化不仅具有理论上的优雅性，也为[参数估计](@entry_id:139349)的算法带来了便利。

对于大多数 GLM（除了使用恒等连接的正态模型），得分方程是关于 $\boldsymbol{\beta}$ 的非线性方程，没有解析解。因此，必须使用[迭代算法](@entry_id:160288)来求解。最常用的算法是**[迭代重加权最小二乘法](@entry_id:175255)** (Iteratively Reweighted Least Squares, IRLS)，它是 Fisher 评分法的一种实现方式 。

IRLS 算法的直观思想是，在每一步迭代中，它都通过求解一个加权的[最小二乘问题](@entry_id:164198)来更新 $\boldsymbol{\beta}$ 的估计值。具体来说，在每次迭代中，算法会构造一个**工作响应变量** (working response) $z_i$ 和一组**权重** (weights) $w_i$：
- **工作响应变量**: $z_i = \eta_i + (y_i - \mu_i) g'(\mu_i)$
- **权重**: $w_i = \frac{1}{[g'(\mu_i)]^2 V(\mu_i)}$

其中，所有量（如 $\eta_i, \mu_i$）都在当前对 $\boldsymbol{\beta}$ 的估计下计算。工作响应变量 $z_i$ 可以看作是对[线性预测](@entry_id:180569)子 $\eta_i$ 的一个线性化近似。权重 $w_i$ 则反比于观测值的方差，这意味着方差较小、信息量较大的观测值在拟合过程中被赋予更大的权重。然后，算法通过对工作响应变量 $z_i$ 进行加权[最小二乘回归](@entry_id:262382)来更新 $\boldsymbol{\beta}$，并重复此过程直至收敛。

### 混杂、效应修饰与可折叠性

在流行病学中，正确解释[回归系数](@entry_id:634860)的意义与估计系数本身同样重要。三个关键概念——混杂 (confounding)、效应修饰 (effect modification) 和可折叠性 (collapsibility)——对于从 GLM 中得出有效因果推断至关重要。

#### 混杂与效应修饰

**混杂**是指暴露-结局关联被一个第三方变量（混杂因素）所扭曲的现象。一个变量成为混杂因素，必须同时与暴露和结局相关，且不位于暴露到结局的因果路径上。在 GLM 中，混杂表现为：当将混杂因素纳入模型后，暴露变量的系数 $\beta_X$ 发生实质性改变。忽略一个混杂因素会导致对暴露效应的有偏估计 。

**效应修饰**则指暴露-结局关联的强度或方向在第三方变量（效应修饰物）的不同水平上有所不同。例如，某药物可能对年轻人有效，但对老年人无效。在 GLM 中，效应修饰通过在模型中加入暴露与效应修饰物的**交互项** (interaction term) 来表示。例如，对于暴露 $X$ 和协变量 $Z$，模型可以写成：
$$
g(\mu) = \beta_0 + \beta_X X + \beta_Z Z + \beta_{XZ} (X \times Z)
$$
如果交互项系数 $\beta_{XZ}$ 显著不为零，则表明 $Z$ 对 $X$ 的效应存在修饰作用（在连接函数的尺度上）。例如，在一个没有交互项的逻辑[回归模型](@entry_id:163386)中，我们假设了在对数比值比尺度上不存在效应修饰 。

#### 可折叠性与比值比

**可折叠性**是一个与效应度量自身数学性质相关的概念。一个效应度量如果被称为**可折叠的** (collapsible)，意味着在不存在混杂的情况下，粗略的（未分层的）效应度量值等于共同的（分层特异的）效应度量值。风险比 (RR) 就是一个可折叠的度量。

然而，比值比 (OR) 是一个**不可折叠的** (non-collapsible) 度量 。这意味着，即使在没有混杂（即分层变量与暴露独立）的情况下，粗略的 OR 也可能不等于分层特异的 OR。这种现象源于 OR 的非线性数学结构。

考虑一个场景，其中协变量 $Z$ 是结局的强风险因素，但与暴露 $E$ 无关（因此不是混杂因素）。如果我们计算分层 OR（在 $Z=0$ 和 $Z=1$ 内部分别计算）和粗略 OR（忽略 $Z$），我们可能会发现粗略 OR 的值比任何一个分层 OR 都更偏离 1。例如，在一个研究中，分层的 RR 可能都是 2.0，而粗略的 RR 也是 2.0，表现出可折叠性。但在同样的数据下，分层的 OR 可能是 2.25 和 3.5，而粗略的 OR 却是 2.67，这与任何一个分层值都不同 。

这一性质具有重要的实践意义：在逻辑回归中，比较调整前后的 OR 值时，即使观察到 OR 发生了变化，也不能草率地断定这种变化完全是由混杂引起的。一部分变化可能仅仅是由于 OR 的不可折叠性所致 。然而，这并不意味着调整后的 OR 没有因果意义。在满足因果推断的条件下（如无未测混杂），调整后的 OR 估计的是一个**条件性因果效应**，即在特定协变量水平下暴露的效应，这本身就是一个有效的推断目标 。

### 处理模型设定偏误：过度离散与稳健推断

GLM 的一个核心假设是为随机成分选择了正确的分布，尤其是正确的均值-方差关系。当这一假设被违反时，虽然[系数估计](@entry_id:175952)可能仍然是一致的，但其[标准误](@entry_id:635378)和相关的统计检验可能会严重错误。

#### [过度离散](@entry_id:263748)及其诊断

在对计数[数据建模](@entry_id:141456)时，一个常见的问题是**[过度离散](@entry_id:263748)** (overdispersion)。标准的泊松[回归模型](@entry_id:163386)假定方差等于均值 ($\operatorname{Var}(Y) = \mu$)。然而，在实际的流行病学数据中，由于未测量的异质性或数据聚集，观测到的方差往往远大于均值 。

诊断[过度离散](@entry_id:263748)的一个常用方法是检查模型的拟合优度统计量。**皮尔逊卡方统计量** (Pearson chi-square statistic) 定义为：
$$
X_P^2 = \sum_{i=1}^n \frac{(y_i - \hat{\mu}_i)^2}{\hat{\mu}_i}
$$
其中 $\hat{\mu}_i$ 是[模型拟合](@entry_id:265652)的均值。如果泊松模型假设成立，那么 $X_P^2$ 的值应该近似等于其自由度 $df = n - p$（$n$ 为样本量，$p$ 为模型参数个数）。因此，比值 $\hat{\phi} = X_P^2 / df$ 可以作为离散参数的估计。如果这个比值显著大于 1，则表明存在过度离散。例如，若 $X_P^2=110$ 且 $df=40$，则 $\hat{\phi}=2.75$，这清楚地表明观测到的方差大约是泊松模型所预期的 2.75 倍 。

#### 应对[过度离散](@entry_id:263748)的模型

当诊断出[过度离散](@entry_id:263748)时，研究者需要采用能容纳额外变异的模型。两种常见的选择是**拟泊松模型** (Quasi-Poisson) 和**负[二项模型](@entry_id:275034)** (Negative Binomial) 。

- **拟泊松模型**: 该方法不指定一个完整的概率分布，而是直接假设方差是均值的常数倍，即 $\operatorname{Var}(Y) = \phi \mu$。它使用与泊松模型相同的过程估计回归系数 $\boldsymbol{\beta}$，然后用估计出的离散参数 $\hat{\phi}$ 来调整[标准误](@entry_id:635378)（乘以 $\sqrt{\hat{\phi}}$）。这种方法的优点是简单，但它不是一个完全的似然模型，因此不能使用 AIC 等基于似然的工具进行[模型比较](@entry_id:266577)。它适用于方差-均值比大致恒定的情况。

- **负[二项模型](@entry_id:275034)**: 这是一个基于完全指定概率分布的参数模型，它假设的方差结构为 $\operatorname{Var}(Y) = \mu + \alpha\mu^2$。这里的 $\alpha$ 是一个离散参数，它允许方差随均值的平方增长。这种二次方关系通常能更好地拟合那些变异性随均值增加而急剧增大的生物学计数数据。作为一个完全的似然模型，负[二项模型](@entry_id:275034)允许使用[似然比检验](@entry_id:268070) (LRT) 和 AIC 等工具进行严谨的模型选择。

模型选择应基于对数据均值-方差关系的诊断。例如，如果经验数据显示方差随均值二次增长（例如，均值为 1, 5, 10 时，方差分别约为 2, 28, 105），那么负[二项模型](@entry_id:275034)显然比假设方差与均值成正比的拟泊松模型更合适 。

#### 稳健推断与三明治[方差估计](@entry_id:268607)

过度离散是更广泛问题——模型设定偏误——的一个特例。在流行病学中，数据还可能存在其他违反标准 GLM 假设的情况，例如观测值之间存在相关性（如对同一个体或诊所的重复测量）。在这种情况下，即使均值模型 $\mathbb{E}[Y \mid \mathbf{x}]$ 是正确的，基于错误方差/相关性假设的标准误也会失效。

为了在均值模型正确但方差/相关性模型可能错误的情况下获得有效的统计推断，我们可以使用**稳健方差估计** (robust variance estimator)，通常称为**三明治方差估计** (sandwich variance estimator) 。

其一般形式为：
$$
\widehat{\operatorname{Var}}(\hat{\boldsymbol{\beta}}) = (X^\top W X)^{-1} \widehat{S} (X^\top W X)^{-1}
$$
这个公式形象地展示了其“三明治”结构：
- **面包 (Bread)**: $(X^\top W X)^{-1}$ 是基于模型假设的（“天真的”）方差估计的逆。
- **肉 (Meat)**: 中间的矩阵 $\widehat{S}$ 是对[得分函数](@entry_id:164520)贡献的经验方差的估计，它直接从数据中捕捉了真实的变异性，而无需依赖于模型的方差假设。对于聚[类数](@entry_id:156164)据，$\widehat{S}$ 通常通过对每个聚类内的得分贡献求和再计算其样本方差得到。

只要均值模型被正确设定，无论真实的方差结构或相关性模式如何，三明治方差估计量都能为 $\hat{\boldsymbol{\beta}}$ 提供一个一致的[方差估计](@entry_id:268607)。这种方法是**广义估计方程** (Generalized Estimating Equations, GEE) 的核心，GEE 是[分析流行病学](@entry_id:178115)中纵向数据和聚类数据的标准工具。它允许研究者专注于正确地为均值建模，同时对真实的方差-协方差结构保持稳健。