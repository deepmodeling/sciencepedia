{
    "hands_on_practices": [
        {
            "introduction": "This first practice will guide you through the manual calculation of the Kaplan-Meier survival curve, the cornerstone of non-parametric survival analysis. By constructing the risk sets and survival probabilities step-by-step from raw data, you will gain a foundational understanding of how we estimate survival over time in the presence of right-censoring. This exercise also introduces Greenwood's formula, providing a tangible way to quantify the uncertainty around our survival estimates. ",
            "id": "4640253",
            "problem": "An investigator is studying time to a clinical event in an infectious disease cohort under right censoring. The survival time $T$ is defined as the time from study entry to the first observed event. The survival function is $S(t) = \\Pr(T > t)$. Assume non-informative right censoring and independent survival times across participants. The product-limit estimator, also known as the Kaplan–Meier (KM) estimator, is used to estimate $S(t)$ from event and censoring times. When events and censorings are recorded at the same time, treat events as occurring before censorings at that time.\n\nA small dataset of $12$ participants is observed, each with a single time (in months) and an indicator for whether that time is an event ($\\delta = 1$) or a right censoring ($\\delta = 0$):\n- Participant $1$: time $2$, $\\delta = 1$\n- Participant $2$: time $3$, $\\delta = 0$\n- Participant $3$: time $4$, $\\delta = 1$\n- Participant $4$: time $5$, $\\delta = 1$\n- Participant $5$: time $6$, $\\delta = 0$\n- Participant $6$: time $7$, $\\delta = 1$\n- Participant $7$: time $8$, $\\delta = 1$\n- Participant $8$: time $9$, $\\delta = 0$\n- Participant $9$: time $10$, $\\delta = 1$\n- Participant $10$: time $12$, $\\delta = 1$\n- Participant $11$: time $12$, $\\delta = 0$\n- Participant $12$: time $15$, $\\delta = 0$\n\nUsing the Kaplan–Meier estimator, compute $\\widehat{S}(t)$ at the selected times $t \\in \\{3, 6, 9, 12\\}$ months. Then, using Greenwood’s formula for the variance of the Kaplan–Meier estimator, compute the standard error of $\\widehat{S}(12)$.\n\nRound your final answer to four significant figures. Express the final answer as a decimal with no units.",
            "solution": "The survival function is $S(t) = \\Pr(T > t)$, defined for nonnegative time $t$. Under independent survival times and non-informative right censoring, the Kaplan–Meier estimator $\\widehat{S}(t)$ is obtained from the product of estimated conditional survival probabilities at each distinct event time, based on risk sets. Let the distinct event times be $\\{t_{(1)}, t_{(2)}, \\dots\\}$, and at each event time $t_{(j)}$ let $n_j$ be the number at risk immediately before $t_{(j)}$ and $d_j$ the number of events at $t_{(j)}$; then the product-limit estimate is\n$$\n\\widehat{S}(t) \\;=\\; \\prod_{j: t_{(j)} \\le t} \\left(1 - \\frac{d_j}{n_j}\\right) \\;=\\; \\prod_{j: t_{(j)} \\le t} \\frac{n_j - d_j}{n_j}.\n$$\nUnder right censoring, individuals who are censored at time $c$ contribute to the risk set up to time $c$, but not beyond; if events and censorings occur at the same time, events are processed before censorings for risk set accounting.\n\nWe first sort the observed times and identify distinct event times and risk sets. The event times are $2, 4, 5, 7, 8, 10, 12$, with one event at each of these times ($d_j=1$). The initial number of participants at risk is $12$.\n\nWe compute the number at risk, $n_j$, at each event time:\n- At time $2$: $n_1 = 12$.\n- At time $4$: One censoring occurred at time 3. $n_2 = 12 - 1 - 1 = 10$.\n- At time $5$: $n_3 = 10 - 1 = 9$.\n- At time $7$: One censoring occurred at time 6. $n_4 = 9 - 1 - 1 = 7$.\n- At time $8$: $n_5 = 7 - 1 = 6$.\n- At time $10$: One censoring occurred at time 9. $n_6 = 6 - 1 - 1 = 4$.\n- At time $12$: $n_7 = 4 - 1 = 3$.\n\nThus, the pairs $(n_j, d_j)$ at the successive event times are\n$$\n(12,1),\\; (10,1),\\; (9,1),\\; (7,1),\\; (6,1),\\; (4,1),\\; (3,1).\n$$\n\nCompute $\\widehat{S}(t)$ at the selected times $t \\in \\{3,6,9,12\\}$ months by multiplying the corresponding terms up to time $t$:\n- For $t = 3$: only time $2$ contributes,\n$$\n\\widehat{S}(3) \\;=\\; \\frac{12 - 1}{12} \\;=\\; \\frac{11}{12}.\n$$\n- For $t = 6$: times $2,4,5$ contribute,\n$$\n\\widehat{S}(6) \\;=\\; \\frac{11}{12} \\cdot \\frac{10 - 1}{10} \\cdot \\frac{9 - 1}{9}\n\\;=\\; \\frac{11}{12} \\cdot \\frac{9}{10} \\cdot \\frac{8}{9}\n\\;=\\; \\frac{11}{15}.\n$$\n- For $t = 9$: times $2,4,5,7,8$ contribute,\n$$\n\\widehat{S}(9) \\;=\\; \\widehat{S}(6) \\cdot \\frac{7 - 1}{7} \\cdot \\frac{6 - 1}{6}\n\\;=\\; \\frac{11}{15} \\cdot \\frac{6}{7} \\cdot \\frac{5}{6}\n\\;=\\; \\frac{11}{21}.\n$$\n- For $t = 12$: times $2,4,5,7,8,10,12$ contribute,\n$$\n\\widehat{S}(12) \\;=\\; \\widehat{S}(9) \\cdot \\frac{4 - 1}{4} \\cdot \\frac{3 - 1}{3}\n\\;=\\; \\frac{11}{21} \\cdot \\frac{3}{4} \\cdot \\frac{2}{3}\n\\;=\\; \\frac{11}{42}.\n$$\n\nTo compute the standard error at $t = 12$ using Greenwood’s formula, we use the variance estimator:\n$$\n\\widehat{\\mathrm{Var}}\\!\\left(\\widehat{S}(t)\\right) \\;=\\; \\widehat{S}(t)^{2} \\sum_{j: t_{(j)} \\le t} \\frac{d_j}{n_j \\left(n_j - d_j\\right)}.\n$$\nHere, $d_j = 1$ at each event time, so for $t = 12$ the sum is\n$$\n\\sum_{j=1}^7 \\frac{1}{n_j \\left(n_j - 1\\right)} \\;=\\; \\frac{1}{12 \\cdot 11} \\;+\\; \\frac{1}{10 \\cdot 9} \\;+\\; \\frac{1}{9 \\cdot 8} \\;+\\; \\frac{1}{7 \\cdot 6} \\;+\\; \\frac{1}{6 \\cdot 5} \\;+\\; \\frac{1}{4 \\cdot 3} \\;+\\; \\frac{1}{3 \\cdot 2}.\n$$\nEvaluating this sum gives $\\frac{3139}{9240}$.\nThus,\n$$\n\\widehat{\\mathrm{Var}}\\!\\left(\\widehat{S}(12)\\right)\n\\;=\\; \\left(\\frac{11}{42}\\right)^{2} \\cdot \\frac{3139}{9240}\n\\; \\approx \\; (0.06859) \\cdot (0.33972) \\approx 0.02330168.\n$$\nThe Greenwood standard error is the square root of the variance:\n$$\n\\widehat{\\mathrm{SE}}\\!\\left(\\widehat{S}(12)\\right)\n\\;=\\; \\sqrt{0.02330168} \\approx 0.15265.\n$$\nRounded to four significant figures, the standard error is $0.1527$.",
            "answer": "$$\\boxed{0.1527}$$"
        },
        {
            "introduction": "Real-world cohort studies often involve participants who enter the study at different times, a phenomenon known as left truncation or delayed entry. This exercise demonstrates how to correctly adjust the Kaplan-Meier estimator to account for this complexity by dynamically updating the risk set. By comparing the correct, left-truncated estimate to a naive one that ignores entry times, you will see firsthand the potential for significant bias and appreciate the importance of properly defining who is at risk at each point in time. ",
            "id": "4640230",
            "problem": "An epidemiologic cohort study of patients diagnosed with a chronic condition aims to estimate the survival function since diagnosis in months, allowing for delayed entry due to staggered enrollment. Individuals are observed only after they enroll; hence survival times are subject to left truncation (delayed entry). Under independent right censoring and independent delayed entry, the survival function $S(t)$ is defined as the probability that the event time $T$ exceeds $t$, and the Kaplan–Meier (KM) estimator is the nonparametric maximum likelihood estimator constructed from conditional survival across distinct event times using the appropriate risk sets.\n\nYou are given a small dataset with $8$ individuals. For each individual $i$, the entry time since diagnosis is $L_i$ (months), the observed time is $O_i$ (months), and the event indicator is $\\delta_i$ ($\\delta_i = 1$ for death at time $O_i$; $\\delta_i = 0$ for right censoring at time $O_i$). The data are:\n\n- Individual $1$: $L_1 = 0$, $O_1 = 5$, $\\delta_1 = 1$.\n- Individual $2$: $L_2 = 3$, $O_2 = 10$, $\\delta_2 = 0$.\n- Individual $3$: $L_3 = 2$, $O_3 = 8$, $\\delta_3 = 1$.\n- Individual $4$: $L_4 = 6$, $O_4 = 12$, $\\delta_4 = 1$.\n- Individual $5$: $L_5 = 0$, $O_5 = 7$, $\\delta_5 = 0$.\n- Individual $6$: $L_6 = 9$, $O_6 = 15$, $\\delta_6 = 1$.\n- Individual $7$: $L_7 = 4$, $O_7 = 11$, $\\delta_7 = 1$.\n- Individual $8$: $L_8 = 1$, $O_8 = 14$, $\\delta_8 = 0$.\n\nCompute the KM estimate of the survival function at $t = 12$ months in two ways:\n\n$1.$ The correctly left-truncated KM, in which the risk set at each event time includes only those individuals who have entered the study strictly before that event time and have not previously experienced the event or censoring.\n\n$2.$ A naive KM that ignores left truncation, in which all individuals are treated as if they were under observation from time $0$ regardless of their actual entry times, and the risk set at each event time includes all individuals with observed time at least that event time who have not previously experienced the event or censoring.\n\nUsing these two constructions, compute the difference $\\hat{S}_{\\text{LT}}(12) - \\hat{S}_{\\text{naive}}(12)$ as a single exact value. Express your final answer as a single number or a single closed-form analytic expression without units. No rounding is required.",
            "solution": "The Kaplan-Meier (KM) product-limit estimator for the survival function $S(t)$ is given by:\n$$ \\hat{S}(t) = \\prod_{j: t_j \\leq t} \\left(1 - \\frac{d_j}{n_j}\\right) $$\nwhere $t_j$ are the distinct event times, $d_j$ is the number of events at time $t_j$, and $n_j$ is the number of individuals in the risk set just before time $t_j$. The event times up to $t=12$ are at months 5, 8, 11, and 12. At each of these times, one event occurred ($d_j=1$).\n\n**1. Left-Truncated KM Estimate, $\\hat{S}_{\\text{LT}}(12)$**\nFor the left-truncated estimate, the risk set $R(t_j)$ at an event time $t_j$ includes individuals $i$ who have entered the study ($L_i  t_j$) and are still under observation ($O_i \\geq t_j$). We calculate the size of the risk set, $n_j$, at each event time:\n- At $t_1 = 5$: $n_1 = |\\{1, 2, 3, 5, 7, 8\\}| = 6$.\n- At $t_2 = 8$: $n_2 = |\\{2, 3, 4, 7, 8\\}| = 5$.\n- At $t_3 = 11$: $n_3 = |\\{4, 6, 7, 8\\}| = 4$.\n- At $t_4 = 12$: $n_4 = |\\{4, 6, 8\\}| = 3$.\n\nThe estimate at $t=12$ is the product of the conditional survival probabilities:\n$$ \\hat{S}_{\\text{LT}}(12) = \\left(1-\\frac{1}{6}\\right) \\left(1-\\frac{1}{5}\\right) \\left(1-\\frac{1}{4}\\right) \\left(1-\\frac{1}{3}\\right) = \\frac{5}{6} \\times \\frac{4}{5} \\times \\frac{3}{4} \\times \\frac{2}{3} = \\frac{2}{6} = \\frac{1}{3} $$\n\n**2. Naive KM Estimate, $\\hat{S}_{\\text{naive}}(12)$**\nFor the naive estimate, the risk set $R(t_j)$ at an event time $t_j$ ignores the entry times and includes all individuals $i$ still under observation ($O_i \\geq t_j$).\n- At $t_1 = 5$: All 8 individuals are at risk, so $n_1 = 8$.\n- At $t_2 = 8$: 6 individuals remain at risk, so $n_2 = 6$.\n- At $t_3 = 11$: 4 individuals remain at risk, so $n_3 = 4$.\n- At $t_4 = 12$: 3 individuals remain at risk, so $n_4 = 3$.\n\nThe naive estimate at $t=12$ is:\n$$ \\hat{S}_{\\text{naive}}(12) = \\left(1-\\frac{1}{8}\\right) \\left(1-\\frac{1}{6}\\right) \\left(1-\\frac{1}{4}\\right) \\left(1-\\frac{1}{3}\\right) = \\frac{7}{8} \\times \\frac{5}{6} \\times \\frac{3}{4} \\times \\frac{2}{3} = \\frac{210}{576} = \\frac{35}{96} $$\n\n**3. Difference**\nThe difference is:\n$$ \\hat{S}_{\\text{LT}}(12) - \\hat{S}_{\\text{naive}}(12) = \\frac{1}{3} - \\frac{35}{96} = \\frac{32}{96} - \\frac{35}{96} = -\\frac{3}{96} = -\\frac{1}{32} $$",
            "answer": "$$\\boxed{-\\frac{1}{32}}$$"
        },
        {
            "introduction": "While the Kaplan-Meier estimator describes survival in a single group, the Cox proportional hazards model allows us to assess how covariates influence survival time. The validity of this powerful model hinges on the proportional hazards assumption—that the effect of a covariate is constant over time. This final practice introduces Schoenfeld residuals, a key diagnostic tool used to test this assumption, and asks you to interpret the results, bridging the gap from theoretical modeling to critical, applied data analysis. ",
            "id": "4640222",
            "problem": "An investigator fits a Cox proportional hazards model in an epidemiologic cohort with a single covariate, where the hazard for subject $i$ at time $t$ is $h(t \\mid x_i) = h_0(t) \\exp(\\beta x_i)$. Consider the following toy dataset with $5$ subjects, each with a follow-up time in months, an event indicator $\\delta_i$ ($1$ for event, $0$ for right-censored), and a single covariate $x_i$:\n- Subject $1$: $(t_1, \\delta_1, x_1) = (1, 1, 0)$\n- Subject $2$: $(t_2, \\delta_2, x_2) = (2, 1, 1)$\n- Subject $3$: $(t_3, \\delta_3, x_3) = (3, 1, 2)$\n- Subject $4$: $(t_4, \\delta_4, x_4) = (4, 0, 1)$\n- Subject $5$: $(t_5, \\delta_5, x_5) = (5, 1, 0)$\n\nA Cox model fit to these data yields an estimated log hazard ratio $\\hat{\\beta} = \\ln(2)$ and an estimated variance $\\widehat{\\mathrm{Var}}(\\hat{\\beta}) = \\frac{1}{2}$.\n\nUsing only the definitions of the Cox partial likelihood and Schoenfeld residuals, do the following:\n1) For each event time $t_i$ with $\\delta_i = 1$, compute the Schoenfeld residual $r_i = x_i - \\bar{x}(\\hat{\\beta}, t_i)$, where $\\bar{x}(\\hat{\\beta}, t_i)$ is the risk-set weighted average of $x$ at time $t_i$ under the fitted model. Then compute the scaled Schoenfeld residual $s_i = \\widehat{\\mathrm{Var}}(\\hat{\\beta}) \\, r_i$.\n2) Regress the scaled Schoenfeld residuals $s_i$ on the corresponding event times $t_i$ using ordinary least squares (no weights), that is, fit $s_i = a + b \\, t_i + \\varepsilon_i$ across the event times. Compute the slope $b$.\n3) Finally, state, in words, what a statistically significant positive slope $b$ would imply about the proportional hazards assumption and the time trend of the covariate effect.\n\nReport only the numerical value of the slope $b$ as your final answer, rounded to four significant figures. Express the slope in residual-units per month (do not include units in the final boxed answer).",
            "solution": "We begin from the definitions of the Cox model and Schoenfeld residuals. The Cox model specifies $h(t \\mid x) = h_0(t) \\exp(\\beta x)$. The Cox partial likelihood is built from risk sets. For an observed event at time $t_i$, the Schoenfeld residual for covariate $x$ at the fitted parameter $\\hat{\\beta}$ is\n$$\nr_i = x_i - \\bar{x}(\\hat{\\beta}, t_i),\n$$\nwhere\n$$\n\\bar{x}(\\hat{\\beta}, t_i) = \\frac{\\sum_{j \\in \\mathcal{R}(t_i)} x_j \\exp(\\hat{\\beta} x_j)}{\\sum_{j \\in \\mathcal{R}(t_i)} \\exp(\\hat{\\beta} x_j)},\n$$\nand $\\mathcal{R}(t_i)$ is the risk set just prior to $t_i$. As defined in the problem, the scaled Schoenfeld residuals are\n$$\ns_i = \\widehat{\\mathrm{Var}}(\\hat{\\beta}) \\, r_i.\n$$\n\nGiven $\\hat{\\beta} = \\ln(2)$, we have $\\exp(\\hat{\\beta}) = 2$ and $\\exp(2 \\hat{\\beta}) = 4$. We enumerate the event times ($\\delta_i = 1$) and compute the residuals.\n\nEvent at $t_1 = 1$ (subject $1$, $x_1 = 0$):\n- Risk set $\\mathcal{R}(t_1) = \\{1,2,3,4,5\\}$.\n- Weighted mean $\\bar{x}(\\hat{\\beta}, t_1) = \\frac{0 \\cdot e^{0} + 1 \\cdot e^{\\ln 2} + 2 \\cdot e^{2\\ln 2} + 1 \\cdot e^{\\ln 2} + 0 \\cdot e^{0}}{e^{0} + e^{\\ln 2} + e^{2\\ln 2} + e^{\\ln 2} + e^{0}} = \\frac{0 + 2 + 8 + 2 + 0}{1 + 2 + 4 + 2 + 1} = \\frac{12}{10} = 1.2$.\n- Schoenfeld residual $r_1 = x_1 - \\bar{x}(\\hat{\\beta}, t_1) = 0 - 1.2 = -1.2$.\n- Scaled residual $s_1 = \\frac{1}{2} \\cdot (-1.2) = -0.6$.\n\nEvent at $t_2 = 2$ (subject $2$, $x_2 = 1$):\n- Risk set $\\mathcal{R}(t_2) = \\{2,3,4,5\\}$.\n- Weighted mean $\\bar{x}(\\hat{\\beta}, t_2) = \\frac{1 \\cdot 2 + 2 \\cdot 4 + 1 \\cdot 2 + 0 \\cdot 1}{2 + 4 + 2 + 1} = \\frac{12}{9} = \\frac{4}{3}$.\n- Schoenfeld residual $r_2 = 1 - \\frac{4}{3} = -\\frac{1}{3}$.\n- Scaled residual $s_2 = \\frac{1}{2} \\cdot \\left(-\\frac{1}{3}\\right) = -\\frac{1}{6}$.\n\nEvent at $t_3 = 3$ (subject $3$, $x_3 = 2$):\n- Risk set $\\mathcal{R}(t_3) = \\{3,4,5\\}$.\n- Weighted mean $\\bar{x}(\\hat{\\beta}, t_3) = \\frac{2 \\cdot 4 + 1 \\cdot 2 + 0 \\cdot 1}{4 + 2 + 1} = \\frac{10}{7}$.\n- Schoenfeld residual $r_3 = 2 - \\frac{10}{7} = \\frac{4}{7}$.\n- Scaled residual $s_3 = \\frac{1}{2} \\cdot \\frac{4}{7} = \\frac{2}{7}$.\n\nEvent at $t_5 = 5$ (subject $5$, $x_5 = 0$; subject $4$ is censored at $t_4 = 4$):\n- Risk set $\\mathcal{R}(t_5) = \\{5\\}$.\n- Weighted mean $\\bar{x}(\\hat{\\beta}, t_5) = \\frac{0 \\cdot 1}{1} = 0$.\n- Schoenfeld residual $r_5 = 0 - 0 = 0$.\n- Scaled residual $s_5 = \\frac{1}{2} \\cdot 0 = 0$.\n\nWe have the pairs $(t_i, s_i)$ for regression: $(1, -0.6)$, $(2, -1/6)$, $(3, 2/7)$, and $(5, 0)$.\n\nNext, regress $s_i$ on $t_i$ using ordinary least squares: $s_i = a + b \\, t_i + \\varepsilon_i$. The slope $b$ is\n$$\nb = \\frac{\\sum_{i} (t_i - \\bar{t})(s_i - \\bar{s})}{\\sum_{i} (t_i - \\bar{t})^2}.\n$$\nThe means are:\n$$\n\\bar{t} = \\frac{1 + 2 + 3 + 5}{4} = \\frac{11}{4} = 2.75, \\quad \\bar{s} = \\frac{-0.6 - 1/6 + 2/7 + 0}{4} = \\frac{-101}{840}.\n$$\nThe numerator of the slope is:\n$$\n\\sum_{i} (t_i - \\bar{t})(s_i - \\bar{s}) = \\frac{4188}{3360} = \\frac{349}{280}.\n$$\nThe denominator of the slope is:\n$$\n\\sum_{i} (t_i - \\bar{t})^2 = \\left(1 - 2.75\\right)^2 + \\left(2 - 2.75\\right)^2 + \\left(3 - 2.75\\right)^2 + \\left(5 - 2.75\\right)^2 = \\frac{140}{16} = \\frac{35}{4}.\n$$\nTherefore,\n$$\nb = \\frac{349/280}{35/4} = \\frac{349}{280} \\cdot \\frac{4}{35} = \\frac{349}{2450} \\approx 0.1424489796.\n$$\nRounding to four significant figures gives $b \\approx 0.1424$.\n\nInterpretation: A statistically significant positive slope $b$ when regressing scaled Schoenfeld residuals on time indicates that the effect of the covariate on the log hazard is increasing over time. This is a violation of the proportional hazards assumption, which states that the hazard ratio (and thus the log hazard ratio) is constant over time. The effect of the covariate appears to become stronger as time passes.",
            "answer": "$$\\boxed{0.1424}$$"
        }
    ]
}