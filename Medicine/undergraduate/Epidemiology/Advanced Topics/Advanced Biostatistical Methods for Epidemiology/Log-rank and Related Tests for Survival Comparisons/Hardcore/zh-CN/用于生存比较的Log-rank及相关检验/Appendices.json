{
    "hands_on_practices": [
        {
            "introduction": "在比较不同组间的生存曲线之前，我们必须首先掌握如何从原始数据中估算单组的生存曲线。这个练习  提供了构建Kaplan-Meier生存曲线的基础实践，这是非参数生存分析的基石。你将学习如何处理删失数据，并使用Greenwood公式计算生存概率及其标准误，这对于量化不确定性至关重要。",
            "id": "4608378",
            "problem": "考虑一个由$12$名患者组成的队列，他们参加了一项关于疾病复发时间的流行病学生存研究，时间单位为月。每位患者提供一个观测对 $(t_i,\\delta_i)$，其中 $t_i$ 是观测到的随访时间，$\\delta_i$ 是事件指示符（如果在时间 $t_i$ 观测到复发，则 $\\delta_i = 1$；如果观测在时间 $t_i$ 被右删失，则 $\\delta_i = 0$）。假设为非信息性右删失，无竞争风险，并且在同一记录时间发生的事件被视为同时发生。\n\n按时间升序排列的观测对 $(t_i,\\delta_i)$ 如下：\n$(3,1)$, $(4,0)$, $(5,1)$, $(8,1)$, $(10,0)$, $(12,1)$, $(12,1)$, $(15,0)$, $(18,1)$, $(20,0)$, $(22,1)$, $(24,1)$.\n\n从第一性原理出发，使用生存函数 $S(t) = \\Pr(T > t)$ 的定义、针对右删失数据的乘积极限（Kaplan–Meier）构造法，以及针对独立乘法因子乘积的大样本方差推断，来推导如何使用 Greenwood 方差公式计算任意时间 $t$ 的 Kaplan-Meier 估计量 $\\hat{S}(t)$ 及其标准误。然后，针对给定的数据集，计算在 $t = 8$ 月和 $t = 20$ 月时的 $\\hat{S}(t)$ 及其标准误。\n\n将 $\\hat{S}(8)$、$\\operatorname{SE}(\\hat{S}(8))$、$\\hat{S}(20)$ 和 $\\operatorname{SE}(\\hat{S}(20))$ 的最终数值以小数形式表示。将答案四舍五入至四位有效数字。请勿使用百分号。",
            "solution": "该问题是有效的，因为它在科学上基于标准的生存分析方法，数据充分，提法明确，且表述客观。我们将进行推导和计算。\n\n首先，我们基于 Greenwood 公式推导 Kaplan-Meier 估计量 $\\hat{S}(t)$ 及其标准误。\n\n**Kaplan-Meier 估计量的推导**\n\n生存函数 $S(t)$ 是指个体事件发生时间 $T$ 大于某个特定时间 $t$ 的概率。\n$$S(t) = \\Pr(T > t)$$\n设在队列中观测到的不同事件时间为 $t_{(1)}  t_{(2)}  \\dots  t_{(k)}$。生存函数可以表示为条件概率的乘积。对于任何满足 $t_{(j)} \\le t  t_{(j+1)}$ 的时间 $t$，生存概率 $S(t)$ 等价于 $S(t_{(j)})$，即生存过所有截至并包括 $t_{(j)}$ 的事件时间的概率。这可以写作：\n$$S(t) = \\Pr(T > t_{(1)}) \\times \\Pr(T > t_{(2)}|T > t_{(1)}) \\times \\dots \\times \\Pr(T > t_{(j)}|T > t_{(j-1)})$$\n令 $p_i = \\Pr(T > t_{(i)}|T > t_{(i-1)})$ 为在生存到时间 $t_{(i)}$ 之前的情况下，生存过事件时间 $t_{(i)}$ 的条件概率。那么，对于 $t_{(j)} \\le t  t_{(j+1)}$：\n$$S(t) = \\prod_{i=1}^{j} p_i$$\n在有右删失的研究中，我们根据在时间 $t_{(i)}$ 可用的数据来估计每个条件概率 $p_i$。令 $n_i$ 为在时间 $t_{(i)}$ 之前处于风险中的个体数量（即那些尚未发生事件或被删失的个体）。令 $d_i$ 为在时间 $t_{(i)}$ 发生事件的个体数量。在处于风险中的个体中，生存过 $t_{(i)}$ 的数量是 $n_i - d_i$。$p_i$ 的一个自然估计量是处于风险中的个体生存过 $t_{(i)}$ 的观测比例：\n$$\\hat{p}_i = \\frac{n_i - d_i}{n_i} = 1 - \\frac{d_i}{n_i}$$\n将此估计量代入乘积形式，得到 $S(t)$ 的 Kaplan-Meier（或乘积极限）估计量：\n$$\\hat{S}(t) = \\prod_{i: t_{(i)} \\le t} \\left(1 - \\frac{d_i}{n_i}\\right)$$\n这个估计量是一个阶梯函数，其值仅在事件发生的时间点发生变化。\n\n**Greenwood 标准误公式的推导**\n\n为了推导 $\\hat{S}(t)$ 的方差，我们使用大样本方差推断。首先求出 $\\ln(\\hat{S}(t))$ 的方差会比较方便。\n$$\\ln(\\hat{S}(t)) = \\ln\\left(\\prod_{i: t_{(i)} \\le t} \\hat{p}_i\\right) = \\sum_{i: t_{(i)} \\le t} \\ln(\\hat{p}_i)$$\n假设对于大样本，不同事件时间的估计值 $\\hat{p}_i$ 近似独立，则和的方差是方差的和：\n$$\\operatorname{Var}(\\ln(\\hat{S}(t))) \\approx \\sum_{i: t_{(i)} \\le t} \\operatorname{Var}(\\ln(\\hat{p}_i))$$\n我们使用 Delta 方法来近似 $\\operatorname{Var}(\\ln(\\hat{p}_i))$。对于函数 $g(X)$，$\\operatorname{Var}(g(X)) \\approx [g'(E[X])]^2 \\operatorname{Var}(X)$。这里，$g(p) = \\ln(p)$，所以 $g'(p) = 1/p$。随机变量是事件计数 $d_i$，可以建模为二项随机变量 $d_i \\sim \\operatorname{Bin}(n_i, q_i)$，其中 $q_i = 1-p_i$ 是事件的条件概率。估计量是 $\\hat{p}_i = (n_i-d_i)/n_i$，其方差为 $\\operatorname{Var}(\\hat{p}_i) = \\frac{\\operatorname{Var}(d_i)}{n_i^2} = \\frac{n_i p_i q_i}{n_i^2} = \\frac{p_i(1-p_i)}{n_i}$。\n应用 Delta 方法：\n$$\\operatorname{Var}(\\ln(\\hat{p}_i)) \\approx \\left(\\frac{1}{p_i}\\right)^2 \\operatorname{Var}(\\hat{p}_i) = \\frac{1}{p_i^2} \\frac{p_i(1-p_i)}{n_i} = \\frac{1-p_i}{n_i p_i}$$\n我们通过代入估计值 $\\hat{p}_i = (n_i-d_i)/n_i$ 来估计此方差：\n$$\\widehat{\\operatorname{Var}}(\\ln(\\hat{p}_i)) = \\frac{1 - \\frac{n_i-d_i}{n_i}}{n_i \\left(\\frac{n_i-d_i}{n_i}\\right)} = \\frac{\\frac{d_i}{n_i}}{n_i-d_i} = \\frac{d_i}{n_i(n_i-d_i)}$$\n对相关事件时间求和，得到 $\\ln(\\hat{S}(t))$ 方差的估计值：\n$$\\widehat{\\operatorname{Var}}(\\ln(\\hat{S}(t))) = \\sum_{i: t_{(i)} \\le t} \\frac{d_i}{n_i(n_i-d_i)}$$\n为了找到 $\\hat{S}(t)$ 的方差，我们再次应用 Delta 方法。令 $h(x) = \\exp(x)$，则 $\\hat{S}(t) = \\exp(\\ln(\\hat{S}(t)))$。其导数为 $h'(x) = \\exp(x)$。\n$$\\operatorname{Var}(\\hat{S}(t)) \\approx [h'(\\ln S(t))]^2 \\operatorname{Var}(\\ln(\\hat{S}(t))) = [\\exp(\\ln S(t))]^2 \\operatorname{Var}(\\ln(\\hat{S}(t))) = [S(t)]^2 \\operatorname{Var}(\\ln(\\hat{S}(t)))$$\n代入估计量，得到 Greenwood 的估计方差公式：\n$$\\widehat{\\operatorname{Var}}(\\hat{S}(t)) = [\\hat{S}(t)]^2 \\sum_{i: t_{(i)} \\le t} \\frac{d_i}{n_i(n_i-d_i)}$$\n标准误是此方差的平方根：\n$$\\operatorname{SE}(\\hat{S}(t)) = \\sqrt{\\widehat{\\operatorname{Var}}(\\hat{S}(t))} = |\\hat{S}(t)| \\sqrt{\\sum_{i: t_{(i)} \\le t} \\frac{d_i}{n_i(n_i-d_i)}}$$\n由于 $\\hat{S}(t) \\ge 0$，这简化为 $\\operatorname{SE}(\\hat{S}(t)) = \\hat{S}(t) \\sqrt{\\sum_{i: t_{(i)} \\le t} \\frac{d_i}{n_i(n_i-d_i)}}$。\n\n**在数据集上的应用**\n\n首先，我们根据给定的数据整理生命表：$(3,1), (4,0), (5,1), (8,1), (10,0), (12,1), (12,1), (15,0), (18,1), (20,0), (22,1), (24,1)$。不同的事件时间为 $t=3, 5, 8, 12, 18, 22, 24$。\n令 $t_{(j)}$ 为第 $j$ 个不同事件时间，$n_j$ 为 $t_{(j)}$ 之前处于风险中的数量，$d_j$ 为在 $t_{(j)}$ 发生的事件数量。\n\n- 时间 $t=0$: 整个队列 $12$ 人均处于风险中。$\\hat{S}(0)=1$。\n- 时间 $t=3$ (事件): $n_1=12$, $d_1=1$。在 $t=4$ 的删失发生在此之后。\n- 时间 $t=5$ (事件): 在 $t=3$ 发生 1 次事件和在 $t=4$ 发生 1 次删失后，$n_2 = 12-1-1 = 10$。$d_2=1$。\n- 时间 $t=8$ (事件): 在 $t=5$ 发生 1 次事件后，$n_3 = 10-1 = 9$。$d_3=1$。在 $t=10$ 的删失发生在此之后。\n- 时间 $t=12$ (并列事件): 在 $t=8$ 发生 1 次事件和在 $t=10$ 发生 1 次删失后，$n_4 = 9-1-1 = 7$。$d_4=2$。在 $t=15$ 的删失发生在此之后。\n- 时间 $t=18$ (事件): 在 $t=12$ 发生 2 次事件和在 $t=15$ 发生 1 次删失后，$n_5 = 7-2-1 = 4$。$d_5=1$。在 $t=20$ 的删失发生在此之后。\n- 时间 $t=22$ (事件): 在 $t=18$ 发生 1 次事件和在 $t=20$ 发生 1 次删失后，$n_6 = 4-1-1 = 2$。$d_6=1$。\n- 时间 $t=24$ (事件): 在 $t=22$ 发生 1 次事件后，$n_7 = 2-1 = 1$。$d_7=1$。\n\n**计算 $t = 8$ 月的情况**\n小于或等于 $t=8$ 的事件时间是 $3, 5, 8$。\n$$\\hat{S}(8) = \\prod_{i: t_{(i)} \\le 8} \\left(1 - \\frac{d_i}{n_i}\\right) = \\left(1 - \\frac{1}{12}\\right) \\times \\left(1 - \\frac{1}{10}\\right) \\times \\left(1 - \\frac{1}{9}\\right)$$\n$$\\hat{S}(8) = \\left(\\frac{11}{12}\\right) \\times \\left(\\frac{9}{10}\\right) \\times \\left(\\frac{8}{9}\\right) = \\frac{11 \\times 8}{12 \\times 10} = \\frac{11}{15} \\approx 0.733333...$$\n四舍五入至四位有效数字，$\\hat{S}(8) = 0.7333$。\n\n对于标准误，我们首先计算求和项：\n$$\\sum_{i: t_{(i)} \\le 8} \\frac{d_i}{n_i(n_i-d_i)} = \\frac{1}{12(11)} + \\frac{1}{10(9)} + \\frac{1}{9(8)} = \\frac{1}{132} + \\frac{1}{90} + \\frac{1}{72}$$\n$$\\text{Sum} \\approx 0.00757576 + 0.01111111 + 0.01388889 \\approx 0.03257576$$\n现在，我们计算标准误：\n$$\\operatorname{SE}(\\hat{S}(8)) = \\hat{S}(8) \\sqrt{\\sum_{i: t_{(i)} \\le 8} \\frac{d_i}{n_i(n_i-d_i)}} \\approx 0.733333 \\times \\sqrt{0.03257576}$$\n$$\\operatorname{SE}(\\hat{S}(8)) \\approx 0.733333 \\times 0.1804876 \\approx 0.132361...$$\n四舍五入至四位有效数字，$\\operatorname{SE}(\\hat{S}(8)) = 0.1324$。\n\n**计算 $t = 20$ 月的情况**\nKaplan-Meier 估计是一个阶梯函数，在事件之间是常数。在 $t=20$ 或之前发生的最后一个事件时间是 $t=18$。因此，$\\hat{S}(20) = \\hat{S}(18)$。事件时间为 $3, 5, 8, 12, 18$。\n$$\\hat{S}(20) = \\hat{S}(18) = \\left(1 - \\frac{1}{12}\\right)\\left(1 - \\frac{1}{10}\\right)\\left(1 - \\frac{1}{9}\\right)\\left(1 - \\frac{2}{7}\\right)\\left(1 - \\frac{1}{4}\\right)$$\n$$\\hat{S}(20) = \\left(\\frac{11}{15}\\right) \\times \\left(\\frac{5}{7}\\right) \\times \\left(\\frac{3}{4}\\right) = \\frac{11 \\times 5 \\times 3}{15 \\times 7 \\times 4} = \\frac{11}{28} \\approx 0.392857...$$\n四舍五入至四位有效数字，$\\hat{S}(20) = 0.3929$。\n\n对于标准误，我们将 $t=12$ 和 $t=18$ 事件的项加到之前的总和中。\n$$\\sum_{i: t_{(i)} \\le 20} \\frac{d_i}{n_i(n_i-d_i)} = \\left(\\frac{1}{132} + \\frac{1}{90} + \\frac{1}{72}\\right) + \\frac{2}{7(5)} + \\frac{1}{4(3)}$$\n$$\\text{Sum} \\approx 0.03257576 + \\frac{2}{35} + \\frac{1}{12} \\approx 0.03257576 + 0.05714286 + 0.08333333 \\approx 0.17305195$$\n现在，我们计算 $\\hat{S}(20)$ 的标准误：\n$$\\operatorname{SE}(\\hat{S}(20)) = \\hat{S}(20) \\sqrt{\\sum_{i: t_{(i)} \\le 20} \\frac{d_i}{n_i(n_i-d_i)}} \\approx 0.392857 \\times \\sqrt{0.17305195}$$\n$$\\operatorname{SE}(\\hat{S}(20)) \\approx 0.392857 \\times 0.4159951 \\approx 0.163423...$$\n四舍五入至四位有效数字，$\\operatorname{SE}(\\hat{S}(20)) = 0.1634$。\n\n最终值，四舍五入至四位有效数字，为：\n$\\hat{S}(8) = 0.7333$\n$\\operatorname{SE}(\\hat{S}(8)) = 0.1324$\n$\\hat{S}(20) = 0.3929$\n$\\operatorname{SE}(\\hat{S}(20)) = 0.1634$",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.7333  0.1324  0.3929  0.1634 \\end{pmatrix}}$$"
        },
        {
            "introduction": "一旦我们能够估算生存曲线，下一步就是正式检验它们之间是否存在差异。这个实践问题  聚焦于时序检验（log-rank test）的核心机制，这是比较生存分布最常用的方法。通过专注于计算得分统计量（$U$）及其方差（$V$），你将深刻理解该检验如何量化反对“风险无差异”这一零假设的证据。",
            "id": "4608348",
            "problem": "一项流行病学研究追踪两个独立的队列，A组和B组，以使用生存分析比较事件发生时间结果。假设在任何一个不同的事件时间点，在给定该时间点之前的风险集构成的条件下，观察到的事件在各组间的分配，遵循在等风险函数的零假设下从合并的风险集中进行无放回抽样。这对应于Cox比例风险（CPH）模型中的得分检验，并得出经典的对数秩检验。\n\n有三个不同的事件时间点，每个时间点各组的风险集大小和观察到的事件数如下：\n- 在时间 $t_1$：A组有 $10$ 人处于风险中，B组有 $10$ 人处于风险中；观察到的事件为A组 $1$ 例，B组 $0$ 例。\n- 在时间 $t_2$：A组有 $8$ 人处于风险中，B组有 $9$ 人处于风险中；观察到的事件为A组 $1$ 例，B组 $2$ 例。\n- 在时间 $t_3$：A组有 $6$ 人处于风险中，B组有 $7$ 人处于风险中；观察到的事件为A组 $0$ 例，B组 $3$ 例。\n\n在事件时间点之间，一些个体可能会被删失；给定的风险集大小已经考虑了先前的事件和删失。\n\n使用基于等风险零假设的对数秩框架，计算A组的对数秩得分 $U$、其方差 $V$ 以及标准化统计量 $Z = U / \\sqrt{V}$。从第一性原理出发，论证在每个事件时间点使用的期望值和方差。将最终的标准化统计量 $Z$ 四舍五入到四位有效数字。不需要单位。简要解释 $Z$ 值的含义，说明是否有证据表明两组之间的风险存在差异，但最终答案只提供 $Z$ 的值。",
            "solution": "对数秩检验的基本依据是各组间风险函数相等的零假设。在此零假设下，在任何一个不同的事件时间点 $t_j$，以 $t_j$ 之前的合并风险集为条件，在 $t_j$ 时观察到的 $d_j$ 个事件在两组间的分配，就如同从处于风险中的 $n_j$ 个个体中进行无放回抽样一样。这意味着在时间点 $t_j$ 来自A组的事件数（记为 $O_{A,j}$）服从超几何分布模型，其参数为：\n- 总体大小 $n_j = n_{A,j} + n_{B,j}$，\n- “成功”次数（A组处于风险中的人数）$n_{A,j}$，\n- 样本大小 $d_j$（在 $t_j$ 时的事件数）。\n\n对于一个超几何随机变量，\n$$\n\\mathbb{E}[O_{A,j}] = d_j \\frac{n_{A,j}}{n_j},\n\\quad\n\\mathrm{Var}(O_{A,j}) = d_j \\frac{n_{A,j}}{n_j} \\left(1 - \\frac{n_{A,j}}{n_j}\\right) \\frac{n_j - d_j}{n_j - 1}.\n$$\n等价地，\n$$\n\\mathrm{Var}(O_{A,j}) = \\frac{d_j (n_j - d_j) n_{A,j} n_{B,j}}{n_j^2 (n_j - 1)}.\n$$\n\nA组的对数秩得分 $U$ 是所有事件时间点上观察到的事件数减去期望事件数的总和：\n$$\nU = \\sum_{j=1}^{3} \\left(O_{A,j} - \\mathbb{E}[O_{A,j}]\\right),\n$$\n其方差为\n$$\nV = \\sum_{j=1}^{3} \\mathrm{Var}(O_{A,j}).\n$$\n标准化统计量是 $Z = U / \\sqrt{V}$，根据大样本理论（应用于Cox比例风险（CPH）模型中得分检验的中心极限定理（CLT）），该统计量近似服从标准正态分布。\n\n我们现在计算每个时间点的这些量。\n\n时间 $t_1$：\n- 风险集：$n_{A,1} = 10$，$n_{B,1} = 10$，$n_1 = 20$。\n- 事件：$d_1 = 1$，其中 $O_{A,1} = 1$。\n- 期望：\n$$\n\\mathbb{E}[O_{A,1}] = d_1 \\frac{n_{A,1}}{n_1} = 1 \\cdot \\frac{10}{20} = \\frac{1}{2}.\n$$\n- 方差：\n$$\n\\mathrm{Var}(O_{A,1}) = \\frac{d_1 (n_1 - d_1) n_{A,1} n_{B,1}}{n_1^2 (n_1 - 1)} = \\frac{1 \\cdot 19 \\cdot 10 \\cdot 10}{20^2 \\cdot 19} = \\frac{1}{4}.\n$$\n- 对 $U$ 的贡献：$O_{A,1} - \\mathbb{E}[O_{A,1}] = 1 - \\frac{1}{2} = \\frac{1}{2}$。\n\n时间 $t_2$：\n- 风险集：$n_{A,2} = 8$，$n_{B,2} = 9$，$n_2 = 17$。\n- 事件：$d_2 = 3$，其中 $O_{A,2} = 1$。\n- 期望：\n$$\n\\mathbb{E}[O_{A,2}] = d_2 \\frac{n_{A,2}}{n_2} = 3 \\cdot \\frac{8}{17} = \\frac{24}{17}.\n$$\n- 方差：\n$$\n\\mathrm{Var}(O_{A,2}) = \\frac{d_2 (n_2 - d_2) n_{A,2} n_{B,2}}{n_2^2 (n_2 - 1)} = \\frac{3 \\cdot 14 \\cdot 8 \\cdot 9}{17^2 \\cdot 16} = \\frac{3024}{4624} = \\frac{189}{289}.\n$$\n- 对 $U$ 的贡献：$O_{A,2} - \\mathbb{E}[O_{A,2}] = 1 - \\frac{24}{17} = -\\frac{7}{17}$。\n\n时间 $t_3$：\n- 风险集：$n_{A,3} = 6$，$n_{B,3} = 7$，$n_3 = 13$。\n- 事件：$d_3 = 3$，其中 $O_{A,3} = 0$。\n- 期望：\n$$\n\\mathbb{E}[O_{A,3}] = d_3 \\frac{n_{A,3}}{n_3} = 3 \\cdot \\frac{6}{13} = \\frac{18}{13}.\n$$\n- 方差：\n$$\n\\mathrm{Var}(O_{A,3}) = \\frac{d_3 (n_3 - d_3) n_{A,3} n_{B,3}}{n_3^2 (n_3 - 1)} = \\frac{3 \\cdot 10 \\cdot 6 \\cdot 7}{13^2 \\cdot 12} = \\frac{1260}{2028} = \\frac{105}{169}.\n$$\n- 对 $U$ 的贡献：$O_{A,3} - \\mathbb{E}[O_{A,3}] = 0 - \\frac{18}{13} = -\\frac{18}{13}$。\n\n对所有时间点求和，\n$$\nU = \\left( \\frac{1}{2} \\right) + \\left( -\\frac{7}{17} \\right) + \\left( -\\frac{18}{13} \\right)\n= \\frac{1}{2} - \\frac{7}{17} - \\frac{18}{13}\n= \\frac{221 - 182 - 612}{442}\n= -\\frac{573}{442}.\n$$\n数值上，$U \\approx -1.2963800905$。\n\n类似地，\n$$\nV = \\left( \\frac{1}{4} \\right) + \\left( \\frac{189}{289} \\right) + \\left( \\frac{105}{169} \\right).\n$$\n数值上，\n$$\n\\frac{1}{4} = 0.25,\\quad \\frac{189}{289} \\approx 0.6539792388,\\quad \\frac{105}{169} \\approx 0.6213017751,\n$$\n所以\n$$\nV \\approx 0.25 + 0.6539792388 + 0.6213017751 = 1.5252810139.\n$$\n因此，\n$$\nZ = \\frac{U}{\\sqrt{V}} \\approx \\frac{-1.2963800905}{\\sqrt{1.5252810139}} \\approx \\frac{-1.2963800905}{1.235022672} \\approx -1.049681.\n$$\n四舍五入到四位有效数字，$Z \\approx -1.050$。\n\n解释：标准化的对数秩统计量的绝对值约为 $-1.05$，在标准正态近似下，这对应于接近 $0.29$ 的双侧尾部概率。基于这个小数据集，没有强有力的证据反对A组和B组之间风险相等的零假设。\n\n最终答案只需要按规定四舍五入的 $Z$ 值。",
            "answer": "$$\\boxed{-1.050}$$"
        },
        {
            "introduction": "现实世界中的流行病学研究很少像教科书中的例子那样干净利落，它们常常涉及复杂的因素，例如参差不齐的研究进入时间，即左截断。这个高级实践  将挑战你将时序检验应用于此类情景。它强调了在每个事件时间点正确定义风险集（risk set）的至关重要性，这项技能对于有效分析观察性队列数据至关重要。",
            "id": "4608372",
            "problem": "一项观察性队列研究评估了两个暴露组在延迟入组（左截断）和失访（右删失）情况下的结核病复发时间。对于每位受试者，令 $L_i$ 表示左截断时间（入组时间），$T_i$ 表示观测时间（事件时间或右删失时间），$\\delta_i$ 表示事件指示符（$\\delta_i = 1$ 表示事件，$\\delta_i = 0$ 表示删失），$G_i \\in \\{A,B\\}$ 表示暴露组。采用右连续风险集惯例，即受试者在时间 $t$ 处于风险中，当且仅当 $L_i  t \\le T_i$。\n\n合成数据集包含8名受试者：\n- A组：\n  - 受试者 $A_1$：$L=0.5$， $T=3.0$， $\\delta=1$。\n  - 受试者 $A_2$：$L=1.0$， $T=4.0$， $\\delta=0$。\n  - 受试者 $A_3$：$L=1.8$， $T=5.0$， $\\delta=1$。\n  - 受试者 $A_4$：$L=1.5$， $T=6.0$， $\\delta=1$。\n- B组：\n  - 受试者 $B_1$：$L=0.0$， $T=2.0$， $\\delta=1$。\n  - 受试者 $B_2$：$L=1.0$， $T=3.5$， $\\delta=0$。\n  - 受试者 $B_3$：$L=2.5$， $T=5.5$， $\\delta=1$。\n  - 受试者 $B_4$：$L=0.5$， $T=5.8$， $\\delta=0$。\n\n任务：\n- 确定两组中所有不同的事件时间，并写出每个事件时间点的风险集，该风险集是满足 $L_i  t \\le T_i$ 的受试者集合。\n- 使用风险集，在风险函数相等的原假设下，计算比较A组与B组的标准对数秩检验统计量，其中每个事件时间的权重恒为 $w(t)=1$。报告该检验统计量的卡方值。\n\n请将最终数值答案表示为精确分数。不要四舍五入。无需单位。",
            "solution": "该问题提供了一个来自观察性队列研究的数据集，该数据集包含A组和B组的左截断和右删失数据，并要求计算对数秩检验统计量。\n\n### 问题验证\n**步骤1：提取已知信息**\n- 8名受试者的数据，包括左截断时间 $L_i$，观测时间 $T_i$，事件指示符 $\\delta_i$ 和分组 $G_i \\in \\{A, B\\}$。\n- A组：\n  - 受试者 $A_1$：$L=0.5$， $T=3.0$， $\\delta=1$。\n  - 受试者 $A_2$：$L=1.0$， $T=4.0$， $\\delta=0$。\n  - 受试者 $A_3$：$L=1.8$， $T=5.0$， $\\delta=1$。\n  - 受试者 $A_4$：$L=1.5$， $T=6.0$， $\\delta=1$。\n- B组：\n  - 受试者 $B_1$：$L=0.0$， $T=2.0$， $\\delta=1$。\n  - 受试者 $B_2$：$L=1.0$， $T=3.5$， $\\delta=0$。\n  - 受试者 $B_3$：$L=2.5$， $T=5.5$， $\\delta=1$。\n  - 受试者 $B_4$：$L=0.5$， $T=5.8$， $\\delta=0$。\n- 风险集定义：受试者 $i$ 在时间 $t$ 处于风险中，当且仅当 $L_i  t \\le T_i$。\n- 任务：确定不同的事件时间，写出每个事件时间的风险集，并计算标准对数秩检验统计量的卡方值，其中权重恒为 $w(t)=1$。\n\n**步骤2：使用提取的已知信息进行验证**\n该问题具有科学依据，因为它涉及生物统计学中一种标准统计方法（对数秩检验）的应用。该问题提法明确，提供了所有必要的数据和清晰的风险集定义。术语精确客观。数据集是自洽的，没有矛盾。任务是基于所提供的数据和定义进行的直接、可形式化的计算。\n\n**步骤3：结论与行动**\n该问题有效。将提供完整的解答。\n\n### 解答\n解答按要求分为两部分：首先确定事件时间和风险集，然后计算对数秩检验统计量。\n\n**第一部分：不同事件时间与风险集**\n\n如果事件指示符 $\\delta_i=1$，则发生事件。发生事件的受试者是 $A_1$（时间3.0），$A_3$（时间5.0），$A_4$（时间6.0），$B_1$（时间2.0）和 $B_3$（时间5.5）。不同的、排序后的事件时间，记为 $t_j$，是：\n$t_1 = 2.0$, $t_2 = 3.0$, $t_3 = 5.0$, $t_4 = 5.5$, and $t_5 = 6.0$.\n\n对于每个事件时间 $t_j$，我们根据规则“如果 $L_i  t_j \\le T_i$，则受试者 $i$ 在风险集中”来构建风险集 $R(t_j)$。\n\n- **事件时间 $t_1 = 2.0$：**\n  风险集 $R(2.0)$ 由所有满足 $L_i  2.0 \\le T_i$ 的受试者 $i$ 组成。\n  - A组：$A_1(0.52.0\\le3.0)$、$A_2(1.02.0\\le4.0)$、$A_3(1.82.0\\le5.0)$、$A_4(1.52.0\\le6.0)$。所有4名均处于风险中。\n  - B组：$B_1(0.02.0\\le2.0)$、$B_2(1.02.0\\le3.5)$、$B_4(0.52.0\\le5.8)$。受试者 $B_3$ 不处于风险中，因为 $L_{B_3}=2.5 \\not 2.0$。所以有3名处于风险中。\n  - $R(2.0) = \\{A_1, A_2, A_3, A_4, B_1, B_2, B_4\\}$。\n\n- **事件时间 $t_2 = 3.0$：**\n  风险集 $R(3.0)$ 由满足 $L_i  3.0 \\le T_i$ 的受试者 $i$ 组成。\n  - 受试者 $B_1$ 不再处于风险中，因为 $T_{B_1}=2.0  3.0$。\n  - 受试者 $B_3$ 现在处于风险中，因为 $L_{B_3}=2.5  3.0 \\le 5.5=T_{B_3}$。\n  - $R(3.0) = \\{A_1, A_2, A_3, A_4, B_2, B_3, B_4\\}$。\n\n- **事件时间 $t_3 = 5.0$：**\n  风险集 $R(5.0)$ 由满足 $L_i  5.0 \\le T_i$ 的受试者 $i$ 组成。\n  - 受试者 $A_1(T=3.0)$、$A_2(T=4.0)$ 和 $B_2(T=3.5)$ 不再处于风险中。\n  - $R(5.0) = \\{A_3, A_4, B_3, B_4\\}$。\n\n- **事件时间 $t_4 = 5.5$：**\n  风险集 $R(5.5)$ 由满足 $L_i  5.5 \\le T_i$ 的受试者 $i$ 组成。\n  - 受试者 $A_3(T=5.0)$ 不再处于风险中。\n  - $R(5.5) = \\{A_4, B_3, B_4\\}$。\n\n- **事件时间 $t_5 = 6.0$：**\n  风险集 $R(6.0)$ 由满足 $L_i  6.0 \\le T_i$ 的受试者 $i$ 组成。\n  - 受试者 $B_3(T=5.5)$ 和 $B_4(T=5.8)$ 不再处于风险中。\n  - $R(6.0) = \\{A_4\\}$。\n\n**第二部分：对数秩检验统计量计算**\n\n对数秩统计量将一组中观察到的事件数与原假设（组间风险率无差异）下的期望事件数进行比较。我们将计算A组的统计量。设 $d_j$ 为时间 $t_j$ 的总事件数，$n_j$ 为风险集中的总受试者数，$d_{jA}$ 为A组的事件数，$n_{jA}$ 为A组中处于风险的受试者数。\n\n在时间 $t_j$ A组的期望事件数为 $e_{jA} = d_j \\frac{n_{jA}}{n_j}$。\n对数秩得分统计量为 $U = \\sum_{j=1}^{k} w(t_j) (d_{jA} - e_{jA})$。当权重 $w(t_j)=1$ 时，该式为 $U = \\sum_{j=1}^{k} (d_{jA} - e_{jA})$。\n得分的方差为 $V = \\sum_{j=1}^{k} w(t_j)^2 \\text{Var}(d_{jA})$，其中 $\\text{Var}(d_{jA}) = \\frac{n_{jA} n_{jB} d_j (n_j-d_j)}{n_j^2(n_j-1)}$。当 $n_j=1$ 时，方差项为0。\n卡方统计量为 $\\chi^2 = \\frac{U^2}{V}$。\n\n计算过程总结在下表中：\n\n| $j$ | $t_j$ | 事件所在组 | $d_j$ | $n_j$ | $n_{jA}$ | $d_{jA}$ | $e_{jA} = d_j \\frac{n_{jA}}{n_j}$ | $d_{jA} - e_{jA}$ |\n|---|---|---|---|---|---|---|---|---|\n| $1$ | $2.0$ | $B$ | $1$ | $7$ | $4$ | $0$ | $1 \\cdot \\frac{4}{7} = \\frac{4}{7}$ | $-\\frac{4}{7}$ |\n| $2$ | $3.0$ | $A$ | $1$ | $7$ | $4$ | $1$ | $1 \\cdot \\frac{4}{7} = \\frac{4}{7}$ | $1 - \\frac{4}{7} = \\frac{3}{7}$ |\n| $3$ | $5.0$ | $A$ | $1$ | $4$ | $2$ | $1$ | $1 \\cdot \\frac{2}{4} = \\frac{1}{2}$ | $1 - \\frac{1}{2} = \\frac{1}{2}$ |\n| $4$ | $5.5$ | $B$ | $1$ | $3$ | $1$ | $0$ | $1 \\cdot \\frac{1}{3} = \\frac{1}{3}$ | $-\\frac{1}{3}$ |\n| $5$ | $6.0$ | $A$ | $1$ | $1$ | $1$ | $1$ | $1 \\cdot \\frac{1}{1} = 1$ | $1-1=0$ |\n\n得分统计量 $U$ 是最后一列的总和：\n$$U = -\\frac{4}{7} + \\frac{3}{7} + \\frac{1}{2} - \\frac{1}{3} + 0 = -\\frac{1}{7} + \\frac{1}{2} - \\frac{1}{3}$$\n$$U = \\frac{-6 + 21 - 14}{42} = \\frac{1}{42}$$\n\n接下来，我们计算方差 $V$。设 $n_{jB} = n_j - n_{jA}$。\n对于 $j=1$：$V_1 = \\frac{n_{1A} n_{1B} d_1 (n_1-d_1)}{n_1^2(n_1-1)} = \\frac{4 \\cdot 3 \\cdot 1 \\cdot (7-1)}{7^2 (7-1)} = \\frac{12}{49}$。\n对于 $j=2$：$V_2 = \\frac{n_{2A} n_{2B} d_2 (n_2-d_2)}{n_2^2(n_2-1)} = \\frac{4 \\cdot 3 \\cdot 1 \\cdot (7-1)}{7^2 (7-1)} = \\frac{12}{49}$。\n对于 $j=3$：$V_3 = \\frac{n_{3A} n_{3B} d_3 (n_3-d_3)}{n_3^2(n_3-1)} = \\frac{2 \\cdot 2 \\cdot 1 \\cdot (4-1)}{4^2 (4-1)} = \\frac{4}{16} = \\frac{1}{4}$。\n对于 $j=4$：$V_4 = \\frac{n_{4A} n_{4B} d_4 (n_4-d_4)}{n_4^2(n_4-1)} = \\frac{1 \\cdot 2 \\cdot 1 \\cdot (3-1)}{3^2 (3-1)} = \\frac{2}{9}$。\n对于 $j=5$：$n_5=1$，因此分母 $(n_5-1)$ 为零，使得方差贡献 $V_5=0$。这是因为当只有一个个体处于风险中时，分组分配没有不确定性。\n\n总方差 $V$ 是各个方差项的总和：\n$$V = V_1 + V_2 + V_3 + V_4 + V_5 = \\frac{12}{49} + \\frac{12}{49} + \\frac{1}{4} + \\frac{2}{9} + 0 = \\frac{24}{49} + \\frac{1}{4} + \\frac{2}{9}$$\n公分母是 $49 \\times 4 \\times 9 = 1764$。\n$$V = \\frac{24 \\cdot 36}{1764} + \\frac{1 \\cdot 441}{1764} + \\frac{2 \\cdot 196}{1764} = \\frac{864 + 441 + 392}{1764} = \\frac{1697}{1764}$$\n\n最后，计算卡方检验统计量：\n$$\\chi^2 = \\frac{U^2}{V} = \\frac{(\\frac{1}{42})^2}{\\frac{1697}{1764}} = \\frac{\\frac{1}{1764}}{\\frac{1697}{1764}} = \\frac{1}{1697}$$\n最终的数值答案是精确分数 $\\frac{1}{1697}$。",
            "answer": "$$\\boxed{\\frac{1}{1697}}$$"
        }
    ]
}