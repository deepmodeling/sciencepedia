{
    "hands_on_practices": [
        {
            "introduction": "在基因-环境相互作用（GxE）分析中，一个核心任务是检验相互作用项的统计显著性。逻辑回归模型中的交互项系数，如 $\\beta_{GE}$，量化了这种效应。本练习  将带你实践三种用于假设检验的经典方法：瓦尔德（Wald）检验、得分（score）检验和似然比（likelihood ratio）检验，让你亲手计算并比较它们的检验统计量，从而加深对这些基本推断工具在GxE研究中应用的理解。",
            "id": "4594333",
            "problem": "一项关于某种复杂疾病的病例对照研究旨在探究一种二元遗传变异和一种二元环境暴露的联合效应是否在对数优势比尺度上偏离了相加性。设 $Y \\in \\{0,1\\}$ 表示疾病状态，$G \\in \\{0,1\\}$ 表示风险等位基因的存在，而 $E \\in \\{0,1\\}$ 表示暴露。拟合了一个包含主效应和基因-环境交互作用项的逻辑斯蒂回归模型：\n$$\n\\ln\\left(\\frac{\\Pr(Y=1 \\mid G,E)}{1 - \\Pr(Y=1 \\mid G,E)}\\right) = \\beta_{0} + \\beta_{G} G + \\beta_{E} E + \\beta_{GE} (G E).\n$$\n零假设为 $H_{0}: \\beta_{GE} = 0$。\n\n从对 $n=1{,}600$ 个个体（病例和对照组人数均衡）进行的模型拟合中，得到以下量：\n- 交互作用系数的最大似然估计量 (MLE) 为 $\\hat{\\beta}_{GE} = 0.357771$，从全模型中得到的估计方差为 $\\widehat{\\mathrm{Var}}(\\hat{\\beta}_{GE}) = 0.04$。\n- 在全模型（$\\beta_{GE}$ 为自由参数）下的最大化对数似然为 $\\ell_{1} = -120.4$，而在受 $H_{0}$ 约束的简化模型下的最大化对数似然为 $\\ell_{0} = -122.0$。\n- 在简化模型中，于 $H_{0}$ 处计算的 $\\beta_{GE}$ 的得分为 $U_{0} = 8.944272$，相应的在 $H_{0}$ 处的期望Fisher信息为 $I_{0} = 25.0$。\n\n使用这些量以及广义线性模型中基于似然推断的第一性原理，计算用于检验 $H_{0}: \\beta_{GE} = 0$ 的Wald检验、得分检验和似然比检验的标量检验统计量。请以 (Wald, 得分, 似然比) 的顺序将答案表示为一个行向量，并将每个条目四舍五入到四位有效数字。无需单位。",
            "solution": "逻辑斯蒂回归模型将结果的对数优势比 (logit) 指定为协变量的线性函数。在参数模型的最大似然推断中，用于检验零假设 $H_{0}: \\beta = \\beta_{0}$ 下的标量参数 $\\beta$ 的三个经典检验基于：\n- 最大似然估计量 (MLE) $\\hat{\\beta}$ 及其估计方差 $\\widehat{\\mathrm{Var}}(\\hat{\\beta})$ (Wald检验)。\n- 在零假设下计算的得分函数（对数似然的梯度）$U_{0} = \\left.\\frac{\\partial \\ell(\\beta)}{\\partial \\beta}\\right|_{\\beta=\\beta_{0}}$，以及在零假设下的Fisher信息 $I_{0}$ (得分检验)。\n- 全模型和简化模型下最大化对数似然之差，$\\ell_{1}$ 和 $\\ell_{0}$ (似然比检验)。\n\n在标准的正则性条件下以及大样本情况下，这些检验产生的统计量是渐近等价的，并且对于单参数检验，它们会与一个自由度为1的卡方分布进行比较。我们使用所提供的量来计算每个统计量。\n\n让我们定义 $\\beta \\equiv \\beta_{GE}$ 和 $\\beta_{0} \\equiv 0$。\n\n1. Wald检验统计量。用于检验 $H_{0}:\\beta=\\beta_{0}$ 的Wald统计量是根据最大似然估计量与零假设值之间的标准化距离构建的。将估计的标准误表示为 $\\widehat{\\mathrm{SE}}(\\hat{\\beta}) = \\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta})}$。在这里，\n$$\n\\widehat{\\mathrm{SE}}(\\hat{\\beta}) = \\sqrt{0.04} = 0.2.\n$$\n那么Wald统计量是\n$$\nW = \\left(\\frac{\\hat{\\beta} - \\beta_{0}}{\\widehat{\\mathrm{SE}}(\\hat{\\beta})}\\right)^{2} = \\left(\\frac{0.357771 - 0}{0.2}\\right)^{2} = (1.788855)^{2}.\n$$\n计算平方：\n$$\nW \\approx 3.200.\n$$\n四舍五入到四位有效数字，$W = 3.200$。\n\n2. 得分检验统计量。得分检验使用在零假设下计算的得分 $U_{0}$ 和Fisher信息 $I_{0}$。得分统计量是\n$$\nS = \\frac{U_{0}^{2}}{I_{0}} = \\frac{(8.944272)^{2}}{25.0}.\n$$\n因为 $8.944272$ 是 $80$ 的平方根，我们有\n$$\nS = \\frac{80}{25} = 3.2.\n$$\n四舍五入到四位有效数字，$S = 3.200$。\n\n3. 似然比检验统计量。似然比统计量基于全模型和简化模型之间最大化对数似然的差异：\n$$\nL = 2\\left(\\ell_{1} - \\ell_{0}\\right) = 2\\left(-120.4 - (-122.0)\\right) = 2\\left(1.6\\right) = 3.2.\n$$\n四舍五入到四位有效数字，$L = 3.200$。\n\n因此，所有三个检验统计量都约等于 $3.200$，这对于信息是良态的单参数检验，在大样本条件下是符合预期的。\n\n按 (Wald, 得分, 似然比) 顺序排列，每个条目四舍五入到四位有效数字的所求行向量是\n$$\n\\begin{pmatrix}\n3.200  3.200  3.200\n\\end{pmatrix}.\n$$",
            "answer": "$$\\boxed{\\begin{pmatrix}3.200  3.200  3.200\\end{pmatrix}}$$"
        },
        {
            "introduction": "真实的生物学过程往往比简单的二元模型更为复杂。例如，基因型数据可能以连续的“剂量”（dosage）形式存在，而等位基因的效应也可能不是严格累加的。本练习  引入了一个更精细的逻辑回归模型，该模型同时包含了一个连续基因剂量变量、一个基因-环境交互项以及一个用于捕捉非加性等位基因效应的二次项。通过推导和计算依赖于基因剂量的“单位等位基因优势比”，你将学会如何解读更复杂模型中的参数，并量化模型中不同效应对风险的贡献。",
            "id": "4594344",
            "problem": "一项病例-对照研究调查了一种复杂疾病和一个候选单核苷酸多态性 (SNP)。基因型经过插补，SNP剂量 $G$ 被定义为风险等位基因的期望数量，其取值在 $[0,2]$ 范围内。环境暴露 $E$ 是一个在连续尺度上测量的变量，并已进行均值中心化。为了评估基因-环境相互作用以及等位基因效应中可能存在的对加性模型的偏离，研究人员针对疾病状态 $Y \\in \\{0,1\\}$ 拟合了以下形式的逻辑回归模型：\n$$\n\\ln\\left(\\frac{\\Pr(Y=1 \\mid G,E)}{1-\\Pr(Y=1 \\mid G,E)}\\right) \\;=\\; \\beta_{0} \\;+\\; \\beta_{G} G \\;+\\; \\beta_{E} E \\;+\\; \\beta_{GE} G E \\;+\\; \\beta_{Q} G^{2}.\n$$\n这种设定允许环境暴露 $E$ 通过乘积项 $G E$ 来调节线性（加性）的等位基因效应，并通过曲率项 $G^{2}$ 允许等位基因效应偏离严格的加性模型。假设拟合的系数为：\n$$\n\\beta_{0} = -3.2,\\quad \\beta_{G} = 0.6,\\quad \\beta_{E} = 0.3,\\quad \\beta_{GE} = 0.05,\\quad \\beta_{Q} = -0.1.\n$$\n仅使用优势（odds）、优势比（odds ratio）和逻辑斯谛模型的基本定义，完成以下任务：\n1. 对于固定的暴露水平 $E=e$，将在剂量 $G=g$ 处，剂量增加一个单位的单位等位基因优势比定义为 $\\mathrm{OR}(g \\to g+1 \\mid e) = \\dfrac{\\text{odds}(Y=1 \\mid G=g+1, E=e)}{\\text{odds}(Y=1 \\mid G=g, E=e)}$。推导 $\\mathrm{OR}(g \\to g+1 \\mid e)$ 关于 $g$、$e$ 和回归系数的闭式表达式，然后在 $g=0.8$ 和 $e=1.5$ 处计算其值。\n2. 将在 $(g,e)$ 处的加性偏离因子定义为\n$$\nR(g,e) \\;=\\; \\frac{\\mathrm{OR}(g \\to g+1 \\mid e)}{\\mathrm{OR}_{\\text{add}}(e)},\n$$\n其中 $\\mathrm{OR}_{\\text{add}}(e)$ 是在等位基因加性约束 $\\beta_{Q}=0$ 下，同时保持 $\\beta_{0}$、$\\beta_{G}$、$\\beta_{E}$ 和 $\\beta_{GE}$ 不变时计算出的单位等位基因优势比。推导 $R(g,e)$ 的闭式表达式，然后在 $g=0.8$ 和 $e=1.5$ 处计算其值。\n\n将所有数值四舍五入到 $4$ 位有效数字。按顺序报告所求的两个数值：$\\mathrm{OR}(0.8 \\to 1.8 \\mid 1.5)$，$R(0.8,1.5)$。优势比是无单位的。",
            "solution": "该问题是有效的，因为它在科学上基于标准的流行病学建模，其提法得当，定义和数据完整且一致，并且表述客观。我们可以开始解答。\n\n逻辑回归模型给出了患病（$Y=1$）的对数优势（log-odds）作为SNP剂量 $G$ 和环境暴露 $E$ 的函数：\n$$\n\\text{logit}(P(Y=1 \\mid G,E)) = \\ln\\left(\\frac{P(Y=1 \\mid G,E)}{1-P(Y=1 \\mid G,E)}\\right) = \\ln(\\text{odds}(Y=1 \\mid G,E))\n$$\n指定的模型为：\n$$\n\\ln(\\text{odds}(Y=1 \\mid G,E)) = \\beta_{0} + \\beta_{G} G + \\beta_{E} E + \\beta_{GE} G E + \\beta_{Q} G^{2}\n$$\n\n**1. 单位等位基因优势比, $\\mathrm{OR}(g \\to g+1 \\mid e)$**\n\n在固定暴露水平 $E=e$ 下，剂量从 $G=g$ 增加一个单位到 $G=g+1$ 的单位等位基因优势比定义为：\n$$\n\\mathrm{OR}(g \\to g+1 \\mid e) = \\frac{\\text{odds}(Y=1 \\mid G=g+1, E=e)}{\\text{odds}(Y=1 \\mid G=g, E=e)}\n$$\n为了推导闭式表达式，我们使用优势比的自然对数，也就是两个剂量水平下对数优势的差值：\n$$\n\\ln(\\mathrm{OR}(g \\to g+1 \\mid e)) = \\ln(\\text{odds}(Y=1 \\mid G=g+1, E=e)) - \\ln(\\text{odds}(Y=1 \\mid G=g, E=e))\n$$\n我们将模型表达式代入每个对数优势项：\n$$\n\\ln(\\text{odds}(Y=1 \\mid G=g+1, E=e)) = \\beta_{0} + \\beta_{G}(g+1) + \\beta_{E}e + \\beta_{GE}(g+1)e + \\beta_{Q}(g+1)^{2}\n$$\n$$\n\\ln(\\text{odds}(Y=1 \\mid G=g, E=e)) = \\beta_{0} + \\beta_{G}g + \\beta_{E}e + \\beta_{GE}ge + \\beta_{Q}g^{2}\n$$\n用第一个方程减去第二个方程，得到：\n$$\n\\ln(\\mathrm{OR}(g \\to g+1 \\mid e)) = \\left( \\beta_{0} + \\beta_{G}(g+1) + \\beta_{E}e + \\beta_{GE}(g+1)e + \\beta_{Q}(g+1)^{2} \\right) - \\left( \\beta_{0} + \\beta_{G}g + \\beta_{E}e + \\beta_{GE}ge + \\beta_{Q}g^{2} \\right)\n$$\n项 $\\beta_{0}$ 和 $\\beta_{E}e$ 消掉了。按系数对剩余的项进行分组：\n$$\n\\ln(\\mathrm{OR}(g \\to g+1 \\mid e)) = \\beta_{G}((g+1)-g) + \\beta_{GE}e((g+1)-g) + \\beta_{Q}((g+1)^{2}-g^{2})\n$$\n简化括号中的表达式：\n$$\n(g+1)-g = 1\n$$\n$$\n(g+1)^{2}-g^{2} = (g^{2}+2g+1) - g^{2} = 2g+1\n$$\n将这些代回，得到对数优势比的表达式：\n$$\n\\ln(\\mathrm{OR}(g \\to g+1 \\mid e)) = \\beta_{G} + \\beta_{GE}e + \\beta_{Q}(2g+1)\n$$\n对两边取指数，得到优势比的闭式表达式：\n$$\n\\mathrm{OR}(g \\to g+1 \\mid e) = \\exp\\left( \\beta_{G} + \\beta_{GE}e + \\beta_{Q}(2g+1) \\right)\n$$\n我们被要求使用给定的系数 $\\beta_{G} = 0.6$、$\\beta_{GE} = 0.05$ 和 $\\beta_{Q} = -0.1$，在 $g=0.8$ 和 $e=1.5$ 处计算该表达式的值。\n$$\n\\mathrm{OR}(0.8 \\to 1.8 \\mid 1.5) = \\exp\\left( 0.6 + (0.05)(1.5) + (-0.1)(2(0.8)+1) \\right)\n$$\n$$\n= \\exp\\left( 0.6 + 0.075 - 0.1(1.6+1) \\right)\n$$\n$$\n= \\exp\\left( 0.675 - 0.1(2.6) \\right)\n$$\n$$\n= \\exp\\left( 0.675 - 0.26 \\right)\n$$\n$$\n= \\exp(0.415) \\approx 1.514419\n$$\n四舍五入到 $4$ 位有效数字，我们得到 $1.514$。\n\n**2. 加性偏离因子, $R(g,e)$**\n\n加性偏离因子定义为：\n$$\nR(g,e) = \\frac{\\mathrm{OR}(g \\to g+1 \\mid e)}{\\mathrm{OR}_{\\text{add}}(e)}\n$$\n首先，我们必须找到 $\\mathrm{OR}_{\\text{add}}(e)$ 的表达式。这是在等位基因加性约束 $\\beta_{Q}=0$ 下的单位等位基因优势比。加性模型是：\n$$\n\\ln(\\text{odds}_{\\text{add}}(Y=1 \\mid G,E)) = \\beta_{0} + \\beta_{G} G + \\beta_{E} E + \\beta_{GE} G E\n$$\n遵循与第1部分相同的推导过程，但设 $\\beta_{Q}=0$，对数优势比变为：\n$$\n\\ln(\\mathrm{OR}_{\\text{add}}(e)) = \\beta_{G} + \\beta_{GE}e + 0 \\cdot (2g+1) = \\beta_{G} + \\beta_{GE}e\n$$\n因此，加性模型下的优势比是：\n$$\n\\mathrm{OR}_{\\text{add}}(e) = \\exp\\left( \\beta_{G} + \\beta_{GE}e \\right)\n$$\n注意，这个量与剂量水平 $g$ 无关，这是模型（对于固定的 $E$）在 $G$ 上呈对数线性的一个决定性特征。\n现在我们可以通过代入两个优势比的表达式来推导 $R(g,e)$ 的闭式表达式：\n$$\nR(g,e) = \\frac{\\exp\\left( \\beta_{G} + \\beta_{GE}e + \\beta_{Q}(2g+1) \\right)}{\\exp\\left( \\beta_{G} + \\beta_{GE}e \\right)}\n$$\n使用属性 $\\frac{\\exp(a)}{\\exp(b)} = \\exp(a-b)$：\n$$\nR(g,e) = \\exp\\left( (\\beta_{G} + \\beta_{GE}e + \\beta_{Q}(2g+1)) - (\\beta_{G} + \\beta_{GE}e) \\right)\n$$\n$$\nR(g,e) = \\exp\\left( \\beta_{Q}(2g+1) \\right)\n$$\n这个表达式分离出了非加性（二次）项对单位等位基因优势比的贡献。\n我们在 $g=0.8$ 和 $e=1.5$ 处计算它的值。注意，在这个模型中 $R(g,e)$ 与 $e$ 无关。\n$$\nR(0.8, 1.5) = \\exp\\left( (-0.1)(2(0.8)+1) \\right)\n$$\n$$\n= \\exp\\left( -0.1(1.6+1) \\right)\n$$\n$$\n= \\exp\\left( -0.1(2.6) \\right)\n$$\n$$\n= \\exp(-0.26) \\approx 0.771051\n$$\n四舍五入到 $4$ 位有效数字，我们得到 $0.7711$。\n\n所求的两个数值是 $\\mathrm{OR}(0.8 \\to 1.8 \\mid 1.5) \\approx 1.514$ 和 $R(0.8, 1.5) \\approx 0.7711$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 1.514  0.7711 \\end{pmatrix}}$$"
        },
        {
            "introduction": "统计学家 George Box 有一句名言：“所有模型都是错的，但有些是有用的。” 在构建GxE模型时，我们必须警惕模型设定错误可能带来的风险，例如忽略了环境中某个重要因素的非线性效应。本练习  通过一个计算任务，让你探索当真实数据生成过程包含环境因素的二次效应（$E^2$）而我们拟合的分析模型却忽略了它时，会对我们最关心的GxE交互项（$\\beta_{GE}$）的估计产生怎样的偏倚。这个实践将揭示模型设定的重要性，并让你对模型误设的后果有更深刻的认识。",
            "id": "4594313",
            "problem": "给定一个基于流行病学和遗传流行病学的二元疾病结局模型。令 $Y \\in \\{0,1\\}$ 表示疾病指标，$G \\in \\{0,1\\}$ 表示存在风险等位基因的基因型指标，$E \\in \\mathbb{R}$ 表示一个连续的环境暴露变量。假设 $G$ 和 $E$ 是独立的。真实的数据生成机制遵循一个带有非线性环境效应的逻辑斯蒂回归模型：\n$$\n\\operatorname{logit}\\left(\\Pr(Y=1 \\mid G, E)\\right) \\equiv \\log\\left(\\frac{\\Pr(Y=1 \\mid G, E)}{1-\\Pr(Y=1 \\mid G, E)}\\right) = \\beta_0 + \\beta_G G + \\beta_{E1} E + \\beta_{E2} E^2 + \\beta_{GE} G E,\n$$\n其中 $E \\sim \\mathcal{N}(\\mu, \\sigma^2)$ 且 $G \\sim \\operatorname{Bernoulli}(p)$。交互作用项 $G E$ 代表基因-环境交互作用。考虑拟合一个省略了非线性环境项 $E^2$ 的工作模型，即：\n$$\n\\operatorname{logit}\\left(\\Pr(Y=1 \\mid G, E)\\right) = \\alpha_0 + \\alpha_G G + \\alpha_E E + \\alpha_{GE} G E.\n$$\n\n根据最大似然估计原理和错配模型理论，在标准正则性条件下，来自错配工作模型的估计量会收敛到使总体得分（population score）为零的参数向量（即伪真参数）。也就是说，极限参数 $\\alpha^\\star = (\\alpha_0^\\star, \\alpha_G^\\star, \\alpha_E^\\star, \\alpha_{GE}^\\star)$ 满足以下方程组：\n$$\n\\mathbb{E}\\left[ X \\left\\{Y - \\mu_\\alpha(G,E)\\right\\} \\right] = \\mathbf{0},\n$$\n其中 $X = (1, G, E, G E)^\\top$，$\\mu_\\alpha(G,E) = \\operatorname{expit}\\left(\\alpha_0 + \\alpha_G G + \\alpha_E E + \\alpha_{GE} G E\\right)$，且 $\\operatorname{expit}(x) = \\frac{1}{1 + e^{-x}}$。期望 $\\mathbb{E}[\\cdot]$ 是对 $(G, E)$ 的联合分布求得的，而 $Y$ 是根据真实数据生成机制生成的，其 $\\Pr(Y=1 \\mid G, E) = \\operatorname{expit}\\left(\\beta_0 + \\beta_G G + \\beta_{E1} E + \\beta_{E2} E^2 + \\beta_{GE} G E\\right)$。\n\n你的任务是，对于几个指定的参数集，计算错配工作模型的伪真参数 $\\alpha^\\star$，然后报告基因-环境交互作用估计中的偏差，该偏差定义为 $\\alpha_{GE}^\\star - \\beta_{GE}$。这量化了由模型错配和 $E$ 中的非线性引入的偏差。\n\n最终程序必须：\n- 使用数值方法，在给定参数 $(\\beta_0, \\beta_G, \\beta_{E1}, \\beta_{E2}, \\beta_{GE}, p, \\mu, \\sigma)$ 的情况下，求解方程组 $\\mathbb{E}\\left[ X \\left\\{Y - \\mu_\\alpha(G,E)\\right\\} \\right] = \\mathbf{0}$ 以得到 $\\alpha^\\star$。\n- 将 $G$ 和 $E$ 视为独立的，其中 $G \\sim \\operatorname{Bernoulli}(p)$ 且 $E \\sim \\mathcal{N}(\\mu, \\sigma^2)$。\n- 通过对 $E$ 的分布进行积分并对 $G \\in \\{0,1\\}$ 进行求和来计算期望值。\n- 对于每个测试用例，返回一个等于偏差 $\\alpha_{GE}^\\star - \\beta_{GE}$ 的实数，四舍五入到 $6$ 位小数。\n\n使用的基本原理：\n- 逻辑斯蒂连接函数定义 $\\operatorname{logit}(p) = \\log\\left(\\frac{p}{1-p}\\right)$ 及其反函数 $\\operatorname{expit}(x) = \\frac{1}{1 + e^{-x}}$。\n- $G$ 和 $E$ 的独立性以及独立性下期望的性质。\n- 在模型错配下，最大似然估计收敛于使总体得分（population score）为零的参数这一原理。\n\n测试套件：\n使用以下参数集，每个参数集指定为 $(\\beta_0, \\beta_G, \\beta_{E1}, \\beta_{E2}, \\beta_{GE}, p, \\mu, \\sigma)$：\n- 情况 $1$ (理想路径，明显非线性): $(\\beta_0=-2.0, \\beta_G=0.6, \\beta_{E1}=0.8, \\beta_{E2}=0.5, \\beta_{GE}=0.4, p=0.3, \\mu=0.0, \\sigma=1.0)$。\n- 情况 $2$ (边界情况：无非线性): $(\\beta_0=-2.0, \\beta_G=0.6, \\beta_{E1}=0.8, \\beta_{E2}=0.0, \\beta_{GE}=0.4, p=0.3, \\mu=0.0, \\sigma=1.0)$。\n- 情况 $3$ (边缘情况：暴露均值偏移和更稀有的等位基因): $(\\beta_0=-3.0, \\beta_G=1.0, \\beta_{E1}=0.6, \\beta_{E2}=0.7, \\beta_{GE}=0.5, p=0.1, \\mu=1.0, \\sigma=1.0)$。\n- 情况 $4$ (边缘情况：更大的暴露方差): $(\\beta_0=-1.5, \\beta_G=0.5, \\beta_{E1}=0.5, \\beta_{E2}=0.8, \\beta_{GE}=0.2, p=0.5, \\mu=0.0, \\sigma=2.0)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个条目对应于相应测试用例的偏差 $\\alpha_{GE}^\\star - \\beta_{GE}$，四舍五入到 $6$ 位小数（例如，$[0.000123,-0.001456,0.000000,0.023459]$）。不应打印任何其他文本。",
            "solution": "问题要求计算当一个逻辑斯蒂回归模型因省略了一个连续环境暴露变量的二次项而发生错配时，基因-环境交互作用系数产生的偏差。这涉及到求解错配模型的伪真参数。\n\n### **1. 理论框架**\n\n假设真实的数据生成过程是一个关于二元结局 $Y$ 的逻辑斯蒂模型，给定二元基因型 $G$ 和连续暴露 $E$：\n$$\n\\operatorname{logit}\\left(\\Pr(Y=1 \\mid G, E)\\right) = \\eta_\\beta(G, E) = \\beta_0 + \\beta_G G + \\beta_{E1} E + \\beta_{E2} E^2 + \\beta_{GE} G E\n$$\n令 $\\mu_\\beta(G, E) = \\Pr(Y=1 \\mid G, E) = \\operatorname{expit}(\\eta_\\beta(G,E))$，其中 $\\operatorname{expit}(x) = (1+e^{-x})^{-1}$。协变量独立分布，即 $G \\sim \\operatorname{Bernoulli}(p)$ 和 $E \\sim \\mathcal{N}(\\mu, \\sigma^2)$。\n\n拟合一个省略了 $E^2$ 项的错配工作模型：\n$$\n\\operatorname{logit}\\left(\\Pr(Y=1 \\mid G, E)\\right) = \\eta_\\alpha(G, E) = \\alpha_0 + \\alpha_G G + \\alpha_E E + \\alpha_{GE} G E\n$$\n令 $\\mu_\\alpha(G, E) = \\operatorname{expit}(\\eta_\\alpha(G,E))$。\n\n根据错配最大似然模型理论，估计的参数向量 $\\hat{\\alpha}$ 在概率上收敛到一个伪真参数向量 $\\alpha^\\star = (\\alpha_0^\\star, \\alpha_G^\\star, \\alpha_E^\\star, \\alpha_{GE}^\\star)$。该向量 $\\alpha^\\star$ 是使真实模型与工作模型之间的库尔贝克-莱布勒（Kullback-Leibler）散度最小化的 $\\alpha$ 值。等价地，$\\alpha^\\star$ 是使总体得分方程等于零的唯一解：\n$$\n\\mathbb{E}\\left[ X \\left\\{ Y - \\mu_{\\alpha^\\star}(G,E) \\right\\} \\right] = \\mathbf{0}\n$$\n其中 $X = (1, G, E, GE)^\\top$ 是工作模型中的预测变量向量。\n\n使用全期望定律，$\\mathbb{E}[Y \\mid G, E] = \\mu_\\beta(G, E)$，该方程组可以重写为：\n$$\n\\mathbb{E}_{G,E}\\left[ X \\left\\{ \\mu_\\beta(G,E) - \\mu_{\\alpha^\\star}(G,E) \\right\\} \\right] = \\mathbf{0}\n$$\n这代表了一个关于 $\\alpha^\\star$ 四个未知分量的四元非线性积分方程组。\n\n### **2. 方程组的推导**\n\n令 $\\phi(e; \\mu, \\sigma^2)$ 为正态分布 $\\mathcal{N}(\\mu, \\sigma^2)$ 的概率密度函数。期望 $\\mathbb{E}_{G,E}[\\cdot]$ 涉及对 $G \\in \\{0, 1\\}$ 的两个值求和，并对 $E$ 的分布进行积分。\n\n令 $\\Delta(g, e; \\alpha) = \\mu_\\beta(g,e) - \\mu_\\alpha(g,e; \\alpha)$。这四个方程是：\n\n1.  对于 $X_1 = 1$：\n    $$\n    \\mathbb{E}[\\Delta(G, E; \\alpha^\\star)] = \\int_{-\\infty}^{\\infty} \\left[ (1-p)\\Delta(0, e; \\alpha^\\star) + p\\Delta(1, e; \\alpha^\\star) \\right] \\phi(e; \\mu, \\sigma^2) de = 0\n    $$\n2.  对于 $X_2 = G$：\n    $$\n    \\mathbb{E}[G \\cdot \\Delta(G, E; \\alpha^\\star)] = \\int_{-\\infty}^{\\infty} \\left[ p \\cdot 1 \\cdot \\Delta(1, e; \\alpha^\\star) \\right] \\phi(e; \\mu, \\sigma^2) de = 0\n    $$\n3.  对于 $X_3 = E$：\n    $$\n    \\mathbb{E}[E \\cdot \\Delta(G, E; \\alpha^\\star)] = \\int_{-\\infty}^{\\infty} e \\left[ (1-p)\\Delta(0, e; \\alpha^\\star) + p\\Delta(1, e; \\alpha^\\star) \\right] \\phi(e; \\mu, \\sigma^2) de = 0\n    $$\n4.  对于 $X_4 = GE$：\n    $$\n    \\mathbb{E}[GE \\cdot \\Delta(G, E; \\alpha^\\star)] = \\int_{-\\infty}^{\\infty} e \\left[ p \\cdot 1 \\cdot \\Delta(1, e; \\alpha^\\star) \\right] \\phi(e; \\mu, \\sigma^2) de = 0\n    $$\n\n这些积分没有解析闭式解，必须通过数值方法计算。\n\n### **3. 数值求解策略**\n\n对于每个参数集 $(\\beta_0, \\beta_G, \\beta_{E1}, \\beta_{E2}, \\beta_{GE}, p, \\mu, \\sigma)$，我们必须求解方程组 $F(\\alpha) = \\mathbf{0}$，其中 $F: \\mathbb{R}^4 \\to \\mathbb{R}^4$ 是由上述四个积分表达式组成的向量。\n\n算法如下：\n1.  定义一个向量函数 `system_equations(alpha, ...)`，它接受一个候选向量 $\\alpha$ 和固定的模型参数，并返回由数值计算的积分组成的4元素向量。\n2.  使用数值积分（具体为 `scipy.integrate.quad`）在定义域 $(-\\infty, \\infty)$ 上计算这些积分。\n3.  使用非线性求根算法 `scipy.optimize.root` 来找到向量 $\\alpha^\\star$，该向量满足 `system_equations(alpha_star, ...) = 0`。\n4.  迭代求解器需要一个合适的 $\\alpha$ 初始猜测值。一个合乎逻辑的选择是 $\\alpha_{\\text{initial}} = (\\beta_0, \\beta_G, \\beta_{E1}, \\beta_{GE})$，因为当模型錯配效应（由 $\\beta_{E2}$ 控制）很小时，$\\alpha^\\star$ 应该接近真实参数。\n5.  一旦找到 $\\alpha^\\star = (\\alpha_0^\\star, \\alpha_G^\\star, \\alpha_E^\\star, \\alpha_{GE}^\\star)$，就可以计算基因-环境交互作用项的偏差为 $\\text{Bias} = \\alpha_{GE}^\\star - \\beta_{GE}$。\n\n对提供的四个测试用例中的每一个都执行此过程。对于情况2，其中 $\\beta_{E2}=0$，工作模型是正确设定的。在这种情况下，理论预测伪真参数就是真实参数，即 $\\alpha^\\star = (\\beta_0, \\beta_G, \\beta_{E1}, \\beta_{GE})$。因此，偏差 $\\alpha_{GE}^\\star - \\beta_{GE}$ 必须为 $0$，这为实现提供了一个验证性检查。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\nfrom scipy.optimize import root\n\ndef solve():\n    \"\"\"\n    Computes the bias in the gene-environment interaction coefficient\n    due to model misspecification for several parameter sets.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (happy path, clear nonlinearity)\n        (-2.0, 0.6, 0.8, 0.5, 0.4, 0.3, 0.0, 1.0),\n        # Case 2 (boundary: no nonlinearity)\n        (-2.0, 0.6, 0.8, 0.0, 0.4, 0.3, 0.0, 1.0),\n        # Case 3 (edge: shifted exposure mean and rarer allele)\n        (-3.0, 1.0, 0.6, 0.7, 0.5, 0.1, 1.0, 1.0),\n        # Case 4 (edge: larger exposure variance)\n        (-1.5, 0.5, 0.5, 0.8, 0.2, 0.5, 0.0, 2.0),\n    ]\n\n    results = []\n    \n    # Helper functions\n    expit = lambda x: 1 / (1 + np.exp(-x))\n    norm_pdf = lambda x, m, s: (1 / (s * np.sqrt(2 * np.pi))) * np.exp(-0.5 * ((x - m) / s)**2)\n\n    for case in test_cases:\n        b0, bG, bE1, bE2, bGE, p, mu, sigma = case\n        \n        # Bundle beta parameters for convenience\n        beta_params = (b0, bG, bE1, bE2, bGE)\n\n        def system_equations(alpha, beta_p, p_val, mu_val, sigma_val):\n            \"\"\"\n            Defines the system of four nonlinear integral equations to be solved for alpha.\n            The function F(alpha) that should be zeroed.\n            \"\"\"\n            b0_p, bG_p, bE1_p, bE2_p, bGE_p = beta_p\n            a0, aG, aE, aGE = alpha\n\n            def delta(g, e):\n                \"\"\"Calculates a difference in probabilities: mu_beta(g,e) - mu_alpha(g,e).\"\"\"\n                logit_true = b0_p + bG_p * g + bE1_p * e + bE2_p * e**2 + bGE_p * g * e\n                logit_misspec = a0 + aG * g + aE * e + aGE * g * e\n                return expit(logit_true) - expit(logit_misspec)\n\n            # Define the four integrands for the system of equations.\n            # The normal PDF is multiplied within the integrand for use with scipy.integrate.quad.\n            integrand1 = lambda e: ((1 - p_val) * delta(0, e) + p_val * delta(1, e)) * norm_pdf(e, mu_val, sigma_val)\n            integrand2 = lambda e: (p_val * delta(1, e)) * norm_pdf(e, mu_val, sigma_val)\n            integrand3 = lambda e: e * ((1 - p_val) * delta(0, e) + p_val * delta(1, e)) * norm_pdf(e, mu_val, sigma_val)\n            integrand4 = lambda e: e * (p_val * delta(1, e)) * norm_pdf(e, mu_val, sigma_val)\n            \n            # Compute the four definite integrals from -inf to inf.\n            f1, _ = quad(integrand1, -np.inf, np.inf)\n            f2, _ = quad(integrand2, -np.inf, np.inf)\n            f3, _ = quad(integrand3, -np.inf, np.inf)\n            f4, _ = quad(integrand4, -np.inf, np.inf)\n\n            return [f1, f2, f3, f4]\n\n        # Initial guess for the root-finding algorithm.\n        # A good guess is the vector of true parameters from the parts of the model that match.\n        alpha_initial = np.array([b0, bG, bE1, bGE])\n\n        # Solve the system F(alpha) = 0 for alpha.\n        solution = root(\n            system_equations, \n            alpha_initial, \n            args=(beta_params, p, mu, sigma), \n            method='hybr'\n        )\n        \n        if not solution.success:\n            # In a real-world scenario, this would require careful handling.\n            # For this problem, we assume the solver converges.\n            raise RuntimeError(f\"Solver failed for case {case}: {solution.message}\")\n        \n        alpha_star = solution.x\n        alpha_GE_star = alpha_star[3]\n\n        # Calculate the bias and round to 6 decimal places.\n        bias = alpha_GE_star - bGE\n        results.append(round(bias, 6))\n\n    # Print the final results in the specified format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}