## 引言
在任何依赖经验数据的科学领域，尤其是流行病学中，一项研究结论的可信度取决于两个基本支柱：**内部效度**与**外部效度**。它们共同回答了两个关键问题：研究的发现是否真实？研究的发现是否具有普遍性？然而，在实践中，区分统计关联与真实因果关系，并判断其能否应用于更广泛的人群，是一项充满挑战的任务。许多研究者难以系统性地识别和应对混杂、选择偏倚等威胁，导致研究结论的价值大打折扣。

本文旨在为读者构建一个关于内部与外部效度的完整知识框架。我们将分三步深入探讨：首先，在“**原理与机制**”一章中，我们将运用因果推断的语言，精确定义内部与外部效度，并剖析威胁其有效性的核心机制。接着，在“**应用与跨学科联系**”一章中，我们将展示如何在研究设计与分析中积极保障和评估效度，并探讨这些概念在临床医学、生态学等多个学科中的实践价值。最后，“**动手实践**”部分将通过具体案例，巩固您对这些关键概念的理解与应用能力。

现在，让我们从这两个效度概念最核心的原理与机制开始。

## 原理与机制

在上一章介绍性讨论的基础上，本章深入探讨支撑流行病学研究可信度的两个核心概念：**内部效度（Internal Validity）**与**外部效度（External Validity）**。我们将运用因果推断的形式化语言，特别是潜结果框架（potential outcomes framework），来系统地阐述这些概念的原理，并剖析威胁其有效性的各种机制。本章的目标是为读者提供一个严谨的理论基础，用以批判性地评估已有的研究证据，[并指](@entry_id:276731)导未来的研究设计。

### 核心区分：内部效度与外部效度

在评估一项研究时，我们首先要问两个基本问题：第一，该研究在其研究的特定人群中得出的因果结论是否正确？第二，这个结论是否能推广到研究之外的其他人群？这两个问题分别对应着内部效度和外部效度。

**内部效度**指的是研究结果在多大程度上能够准确地反映研究样本（source population）中暴露与结局之间的真实因果关系。一个具有高内部效度的研究，其观察到的关联能够被可信地解释为因果效应，因为它成功地排除了或控制了其他可能的解释，如混杂、选择偏倚和测量误差。

**外部效度**，或称**泛化性（generalizability）**，指的是研究结果在多大程度上可以被推广到研究样本之外的目标人群（target population）。即使一项研究具有完美的内部效度，其结论也未必适用于其他人群，因为不同人群在年龄、性别、遗传背景、生活方式或医疗条件等方面可能存在系统性差异。

为了更精确地定义这两个概念，我们引入潜结果框架。对于每个个体，我们定义在接受处理（$A=1$）和未接受处理（$A=0$）两种情况下的潜在一个结局，分别表示为 $Y^1$ 和 $Y^0$。个体因果效应是 $Y^1 - Y^0$。在群体层面，我们通常关心的是**平均[处理效应](@entry_id:636010)（Average Treatment Effect, ATE）**，即 $E[Y^1 - Y^0]$。

使用一个选择[指示变量](@entry_id:266428) $S$ 来区分研究参与者（$S=1$）和非参与者（$S=0$），我们可以将内部效度和外部效度的目标[参数形式](@entry_id:176887)化：
- **内部效度**的目标是识别研究人群中的平均因果效应：$E[Y^1 - Y^0 \mid S=1]$。
- **外部效度**的目标是将此效应推广到某个目标人群，例如，从中抽取样本的源人群（$E[Y^1 - Y^0]$）或一个完全不同的人群（$E[Y^1 - Y^0 \mid S=0]$）。

### 内部效度：因果推断的基石

内部效度是因果推断的先决条件。如果一项研究在其自身样本中都无法得出正确的结论，那么讨论其结论能否推广到别处便毫无意义。

#### 效度的目标：识别研究人群中的因果效应

从根本上说，内部效度是一个关于**可识别性（identifiability）**的问题：我们能否仅从可观测数据的概率分布中，唯一地确定我们感兴趣的因果参数（即 $E[Y^1 - Y^0 \mid S=1]$）？。这强调了内部效度是研究设计和数据生成过程的一种理论属性，而非某个特定有限样本[统计估计量](@entry_id:170698)的属性。

这一点常常与统计**精度（precision）**相混淆。精度反映的是随机误差（random error）的大小，通常由[置信区间](@entry_id:138194)的宽度来衡量。[随机误差](@entry_id:144890)源于我们只观察了一个有限的样本而非整个人群。根据大数定律，增加样本量（$n$）可以减小[随机误差](@entry_id:144890)，从而提高估计的精度。然而，这并不能消除**系统误差（systematic error）**，即**偏倚（bias）**。系统误差是由研究设计或实施中的缺陷导致的，它使得估计量的[期望值](@entry_id:150961)持续偏离真实的因果参数。

例如，假设一项队列研究使用一个校准错误的仪器来测量工人的溶剂暴露水平，该仪器系统性地低估了真实的暴露浓度。即使研究者将样本量从 $600$ 人增加到 $6000$ 人，他们可能会观察到风险比（RR）的点估计值保持不变，但其95%[置信区间](@entry_id:138194)显著变窄。这种精度的提高给人一种结果更“确定”的错觉，但如果系统性测量误差导致RR估计值本身就是有偏的，那么[置信区间](@entry_id:138194)只是更紧密地围绕着一个错误的数值。因此，增加样本量提高了精度，但并未改善因果估计的内部效度 。内部效度的核心在于消除偏倚，而非减小[随机误差](@entry_id:144890)。

#### [观察性研究](@entry_id:174507)中识别因果效应的三大支柱

在理想的随机对照试验（RCT）中，随机分配处理确保了处理组和[对照组](@entry_id:188599)在所有（无论测量与否的）基线特征上是可比的，从而保证了高内部效度。但在观察性研究中，处理分配并非由研究者控制，我们需要依赖三个核心假设来识别因果效应，这三个假设共同构成了内部效度的理论基石 。

1.  **一致性（Consistency）**: 该假设连接了潜结果与观测数据。它指出，一个个体如果实际接受了处理 $A=a$，那么其观测结局 $Y$ 就等于其在该处理下的潜结果 $Y^a$。即，若 $A=a$，则 $Y=Y^a$。这要求处理的定义必须明确，不存在多种版本的处理被模糊地归为一类。

2.  **条件[可交换性](@entry_id:263314)（Conditional Exchangeability）**: 该假设又被称为“无未测量混杂（no unmeasured confounding）”。它要求在给定的协变量 $L$ 的条件下，潜结果与实际接受的处理是独立的。形式化表达为，对于所有处理水平 $a$，都有 $Y^a \perp A \mid L$。这意味着，在具有相同协变量特征（$L$）的人群亚组中，接受处理的个体与未接受处理的个体是可比的，仿佛处理是“随机分配”的。这是通过统计方法（如分层、匹配或回归调整）控制混杂的基础。

3.  **正值性（Positivity）**: 也称为重叠性（overlap）。该假设要求在研究人群中，对于任何具有特定协变量组合 $L=l$ 的个体，他们接受每种处理水平的概率都大于零。即，对于所有在人群中有代表的 $l$，都有 $P(A=a \mid L=l) > 0$。如果某个亚组中的所有人全都接受了同一种处理，那么我们就无从知晓另一种处理在该亚组中的效果，也就无法进行有效的比较。

当这三个假设同时满足时，我们就可以从观测数据中识别出因果效应。例如，通过对协变量 $L$ 进行标化（standardization），可以得到：
$$ E[Y^a] = E_L[E[Y \mid A=a, L]] = \sum_l E[Y \mid A=a, L=l] P(L=l) $$
这个公式表明，因果参数 $E[Y^a]$ 可以通过观测数据计算得出，从而保证了研究的内部效度。

#### 威胁内部效度的常见机制

任何破坏上述三大支柱之一的因素都会威胁到内部效度。以下是几种最主要的偏倚来源。

##### 混杂（Confounding）

当一个变量既与暴露有关，又独立于暴露影响结局时，它就成为一个**混杂因素（confounder）**。混杂的存在违反了（无条件的）[可交换性](@entry_id:263314)。使用**有向无环图（Directed Acyclic Graphs, DAGs）**可以清晰地描述这种关系。在DAG中，混杂因素 $C$ 是暴露 $A$ 和结局 $Y$ 的一个[共同原因](@entry_id:266381)，即存在路径 $A \leftarrow C \rightarrow Y$。这条路径被称为“后门路径（backdoor path）”，因为它在 $A$ 和 $Y$ 之间建立了一个非因果的关联 。

在潜结果框架下，混杂意味着 $Y^a \not\perp A$。为了恢复内部效度，我们需要识别并测量所有重要的混杂因素 $C$，然后通过在分析中对 $C$ 进行**调整（adjustment）**来阻断这条后门路径。调整后，我们希望达到条件[可交换性](@entry_id:263314)，即 $Y^a \perp A \mid C$。

重要的是，并非所有与暴露和结局相关的变量都应被调整。例如：
- **中介者（Mediator）**: 如果一个变量 $C$ 位于暴露到结局的因果链上（$A \rightarrow C \rightarrow Y$），那么它是一个中介者。调整中介者会阻断因果路径，导致我们估计的是直接效应，而非总效应，这通常不是我们想要的。
- **对撞者（Collider）**：如果一个变量 $C$ 同时受到暴露和结局（或它们各自的原因）的影响（例如，$A \rightarrow C \leftarrow Y$），那么它是一个对撞者。在不进行调整时， $A$ 和 $Y$ 之间的这条路径是封闭的。然而，一旦我们对对撞者进行调整（如分层分析或在[回归模型](@entry_id:163386)中包含它），就会打开这条非因果路径，人为地引入偏倚。这种现象称为**对撞分层偏倚（collider-stratification bias）**。

##### 选择偏倚（Selection Bias）

**选择偏倚**源于研究对象的选择过程或持续参与过程，导致分析样本不能代表我们想要研究的目标人群（即使这个目标人群只是整个研究队列）。选择偏倚常常是对撞分层偏倚的一种表现形式 。

考虑一个选择指示变量 $S$，当 $S=1$ 时个体被纳入最终分析。如果选择本身受到暴露 $E$ 和结局 $Y$ 的共同影响，即 $E \rightarrow S \leftarrow Y$，那么 $S$ 就是一个对撞者。将分析局限于 $S=1$ 的人群，就等同于对对撞者进行了调整，从而在 $E$ 和 $Y$ 之间引入虚假的关联，破坏了内部效度。同样地，如果选择 $S$ 是由暴露的一个原因 $W$ 和结局的一个原因 $Z$ 共同决定的（$W \rightarrow E$, $Z \rightarrow Y$, $W \rightarrow S \leftarrow Z$），对 $S$ 进行调整同样会打开 $E \leftarrow W \dots Z \rightarrow Y$ 这条非因果路径，导致偏倚 。

临床研究中常见的**失访（loss to follow-up）**是选择偏倚的一个重要来源。如果失访的概率同时与处理分配和结局有关（例如，接受副作用较大疗法的重症患者更容易失访），那么完成研究的样本（一个被选择的子集）将不再具有可比性，从而威胁内部效度 。

##### 测量误差（Measurement Error）

当暴露、结局或协变量的测量不准确时，就会发生测量误差，也称信息偏倚（information bias）。一个常见的类型是**非差异性暴露错分（nondifferential misclassification of exposure）**。非差异性意味着测量误差的发生概率不依赖于真实的结局状态。形式上，给定真实暴露 $E$ 和真实结局 $Y$，观测暴露 $E^*$ 的概率只依赖于 $E$，即 $P(E^* \mid E, Y) = P(E^* \mid E)$ 。

这种误差的特征可以通过**敏感性（Sensitivity, Se）** $Se = P(E^*=1 \mid E=1)$ 和**特异性（Specificity, Sp）** $Sp = P(E^*=0 \mid E=0)$ 来量化。当测量工具比随机猜测更有效时（即 $Se + Sp > 1$），对于二分类暴露，非差异性错分通常会导致效应估计值被**拉向无效值（bias toward the null）**。也就是说，真实的风险比（RR）会被低估（趋向于1），真实的风险差（RD）的绝对值也会被低估（趋向于0）。这种系统性的低估是一种偏倚，它扭曲了研究人群中真实的因果关联强度，因此是对内部效度的一种威胁。

##### 稳定单位处理价值假设（SUTVA）的违背

**SUTVA（Stable Unit Treatment Value Assumption）**是潜结果框架的一个基础假设，它包含两个子假设：
1.  **无干预（No Interference）**: 任何一个个体的潜结果只取决于其自身接受的处理，而不受其他个体接受何种处理的影响。
2.  **一致性（Consistency）**: 如前所述，它保证了处理定义明确，没有隐藏的不同版本。

在许多公共卫生和[传染病](@entry_id:182324)研究中，“无干预”假设很容易被违背。例如，在一项评估戴口罩对预防呼吸道感染效果的试验中，一个社区内部分人戴口罩（处理）可能会通过减少病毒传播，间接保护了那些没有戴口罩的人（对照）。这种**溢出效应（spillover effect）**意味着个体的结局不仅取决于自己的处理状态 $Z_i$，还取决于其邻里接受处理的比例 $S_i$。此时，潜结果应写为 $Y_i(Z_i, S_i)$ 。

在这种情况下，传统的因果估算量 $E[Y^1 - Y^0]$ 变得定义不清，因为没有指定邻里处理比例的背景。简单的处理组和[对照组](@entry_id:188599)均数之差也不再能无偏地估计任何一个明确定义的因果效应。因此，干预现象从根本上挑战了研究的内部效度。要恢复效度，研究者必须明确地定义和估计包含直接效应和间接（溢出）效应在内的新因果参数。

### 外部效度：推广研究发现

一项研究即便达到了完美的内部效度，其结论也未必能安全地“走出”实验室或特定的研究队列。外部效度关注的正是这种推广和应用过程中的有效性。

#### 从研究样本到目标人群的挑战

**内部效度是外部效度的必要条件**。一个本身就存在偏倚的结论，推广到任何人群都只会传播错误的信息 。然而，内部效度并非外部效度的充分条件。其核心障碍在于，研究人群和目标人群之间可能存在系统性差异，特别是当这种差异与处理效应的大小有关时。

#### 效应异质性：外部效度的核心障碍

**效应异质性（Effect Heterogeneity）**或**效应修饰（Effect Modification）**指的是处理的因果效应在不同人群亚组中大小不同。如果一个基线变量 $Z$ 能够修饰处理 $A$ 对结局 $Y$ 的效应，那么 $Z$ 就是一个**效应修饰因子（effect modifier）**。

当效应修饰因子在研究样本和目标人群中的分布不同时，即使层特异性因果效应（stratum-specific causal effects）在两个人群中完全相同，总体的平均因果效应也会不同。这构成了对外部效度的直接威胁 。

让我们通过一个具体的例子来说明。假设一项随机试验（内部效度有保证）在一个研究样本（$S=1$）中进行，我们想将其结果推广到一个目标人群（$S=0$）。效应修饰因子 $Z$（如年龄段）的分布在两个人群中不同：
- 研究样本中：$P(Z=1 \mid S=1) = 0.20$
- 目标人群中：$P(Z=1 \mid S=0) = 0.60$

假设层特异性的真实因果效应（风险差）是：
- 在 $Z=0$ 的亚组中：$E[Y^1 - Y^0 \mid Z=0] = 0.10$
- 在 $Z=1$ 的亚组中：$E[Y^1 - Y^0 \mid Z=1] = 0.40$

那么，在研究样本中观察到的平均因果效应是：
$ATE_{S=1} = (0.10 \times P(Z=0 \mid S=1)) + (0.40 \times P(Z=1 \mid S=1)) = (0.10 \times 0.80) + (0.40 \times 0.20) = 0.08 + 0.08 = 0.16$

而在目标人群中，真实的平均因果效应应该是：
$ATE_{S=0} = (0.10 \times P(Z=0 \mid S=0)) + (0.40 \times P(Z=1 \mid S=0)) = (0.10 \times 0.40) + (0.40 \times 0.60) = 0.04 + 0.24 = 0.28$

显然，$0.16 \neq 0.28$。研究得到的内部有效的结果（$ATE=0.16$）并不能直接代表目标人群的真实情况。这种差异并非源于研究内部的偏倚，而是源于效应异质性与人群构成差异的共同作用 。

#### 泛化性与可移植性的形式化条件

为了将在研究中获得的知识应用于目标人群，我们需要额外的假设。这引出了**泛化性（generalizability）**（将结果推广回从中抽样的更广泛的源人群）和**可移植性（transportability）**（将结果推广到一个新的、不同的人群）的正式条件 。

假设我们已经在一项具有内部效度的研究中，得到了所有协变量亚组 $L=l$ 内的层特异性因果效应（例如，通过对混杂进行调整后）。为了将这些效应“移植”到目标人群，我们需要两个关键假设：

1.  **选择可交换性（Transportability / Selection Exchangeability）**: 该假设要求在给定协变量 $L$ 的条件下，潜结果与个体是否属于研究样本（$S=1$）是独立的，即 $Y^a \perp S \mid L$。这实质上是说，在具有相同协变量特征 $L$ 的个体中，因果机制是相同的，无论他们是在研究内还是研究外。

2.  **正值性/重叠性（Positivity / Overlap）**: 该假设要求目标人群中出现的任何协变量组合 $l$ 在研究人群中也必须出现。换句话说，我们不能将结论推广到我们在研究中从未观察过的人群类型。

如果这些条件成立，我们就可以通过将在研究中估计的层特异性效应，按照它们在**目标人群**中的分布进行加权平均（即标化），来计算目标人群的平均因果效应  。这个过程被称为**效应的移植（transporting the effect）**。

总之，内部效度确保我们有一个可靠的“零件”（层特异性效应），而外部效度则关注我们能否以及如何将这些零件“组装”成适用于不同场景的“成品”。这一过程需要对研究人群与目标人群之间的差异有深刻的理解和审慎的假设。