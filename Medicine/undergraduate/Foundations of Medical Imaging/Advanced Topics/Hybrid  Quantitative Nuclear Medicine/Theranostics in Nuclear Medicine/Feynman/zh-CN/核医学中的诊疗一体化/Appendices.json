{
    "hands_on_practices": [
        {
            "introduction": "在诊疗一体化的工作流程中，一个核心任务是将诊断图像的定性信息转化为用于指导治疗的精确数字。PET扫描中常用的标准化摄取值（SUV）虽然直观，但其本身是一个半定量的指标。本练习将引导你掌握如何将SUV转化为绝对放射性活度，这是进行精确内照射剂量计算不可或缺的第一步，并在此过程中深化对放射性衰变、单位制和定量准确性的理解。",
            "id": "4936181",
            "problem": "一名正在接受诊疗一体化评估的神经内分泌肿瘤患者，使用 $^{68}\\mathrm{Ga}$-DOTATATE 通过正电子发射断层扫描 (PET) 成像。为了进行剂量学计算，您希望将报告的病灶中标准化摄取值 (SUV) 转换为扫描时刻均匀感兴趣体积 (VOI) 内的绝对活度。假设已知量如下：注射时刻的注射活度 $A_{\\mathrm{inj},0} = 150\\,\\mathrm{MBq}$，从注射到扫描开始的时间 $t = 60\\,\\mathrm{min}$，患者体重 $m = 75\\,\\mathrm{kg}$，在扫描时刻测得的病灶平均 $\\mathrm{SUV}_{\\mathrm{mean}}(t) = 12.0$，VOI 体积 $V = 10.0\\,\\mathrm{mL}$，以及 $^{68}\\mathrm{Ga}$ 的物理半衰期为 $T_{1/2} = 67.71\\,\\mathrm{min}$。假设组织密度 $\\rho \\approx 1.00\\,\\mathrm{g}/\\mathrm{mL}$ 且 VOI 内的活度浓度均匀。\n\n使用以下基本公式：放射性衰变定律 $A(t) = A(0)\\,e^{-\\lambda t}$，其中 $\\lambda = (\\ln 2)/T_{1/2}$；以及按体重归一化的标准化摄取值 (SUV) 的定义：$\\mathrm{SUV}(t) = \\dfrac{C_{\\mathrm{tissue}}(t)}{A_{\\mathrm{inj}}(t)/m}$，其中 $C_{\\mathrm{tissue}}(t)$ 是以 $\\mathrm{kBq}/\\mathrm{mL}$ 为单位的活度浓度，$A_{\\mathrm{inj}}(t)$ 是衰变至扫描时刻的注射活度，$m$ 是以克为单位表示的体重，因此，在 $\\rho \\approx 1\\,\\mathrm{g}/\\mathrm{mL}$ 的情况下，$\\mathrm{g}/\\mathrm{mL}$ 单位可以抵消，从而得到一个无量纲的 SUV。\n\n哪个选项正确地构建了工作流程，能将 $^{68}\\mathrm{Ga}$-DOTATATE PET 的平均 SUV 值 $\\mathrm{SUV}_{\\mathrm{mean}}$ 转换为扫描时刻 VOI 内的绝对活度，并且具有一致的衰变校正、单位和体重处理方式，同时得出正确的 $A_{\\mathrm{VOI}}(t)$ 数值？\n\nA. 工作流程：使用 $A_{\\mathrm{inj}}(t) = A_{\\mathrm{inj},0}\\,e^{-(\\ln 2)t/T_{1/2}}$ 将注射活度进行衰变校正至扫描时间；将 $A_{\\mathrm{inj}}(t)$ 转换为 $\\mathrm{kBq}$；将 $m$ 转换为 $\\mathrm{g}$；计算 $C_{\\mathrm{tissue}}(t) = \\mathrm{SUV}(t)\\,\\big(A_{\\mathrm{inj}}(t)/m\\big)$，单位为 $\\mathrm{kBq}/\\mathrm{mL}$；计算 $A_{\\mathrm{VOI}}(t) = C_{\\mathrm{tissue}}(t)\\,V$。数值结果：$A_{\\mathrm{VOI}}(t) \\approx 130\\,\\mathrm{kBq}$。\n\nB. 工作流程：使用未经衰变校正的注射活度 $A_{\\mathrm{inj}}(t) = A_{\\mathrm{inj},0}$；将 $A_{\\mathrm{inj},0}$ 转换为 $\\mathrm{kBq}$；将 $m$ 转换为 $\\mathrm{g}$；计算 $C_{\\mathrm{tissue}}(t) = \\mathrm{SUV}(t)\\,\\big(A_{\\mathrm{inj},0}/m\\big)$；计算 $A_{\\mathrm{VOI}}(t) = C_{\\mathrm{tissue}}(t)\\,V$。数值结果：$A_{\\mathrm{VOI}}(t) \\approx 240\\,\\mathrm{kBq}$。\n\nC. 工作流程：如选项 A 中所示，将 $A_{\\mathrm{inj},0}$ 衰变校正为 $A_{\\mathrm{inj}}(t)$；保持 $m$ 的单位为 $\\mathrm{kg}$；计算 $C_{\\mathrm{tissue}}(t) = \\mathrm{SUV}(t)\\,\\big(A_{\\mathrm{inj}}(t)/m\\big)$，其中 $m$ 以 $\\mathrm{kg}$ 为单位；计算 $A_{\\mathrm{VOI}}(t) = C_{\\mathrm{tissue}}(t)\\,V$。数值结果：$A_{\\mathrm{VOI}}(t) \\approx 1.30\\times 10^{5}\\,\\mathrm{kBq}$。\n\nD. 工作流程：通过使用 $A_{\\mathrm{inj}}(t) = A_{\\mathrm{inj},0}\\,e^{+(\\ln 2)t/T_{1/2}}$ 对注射活度进行“反向衰变校正”；将 $A_{\\mathrm{inj}}(t)$ 转换为 $\\mathrm{kBq}$；将 $m$ 转换为 $\\mathrm{g}$；计算 $C_{\\mathrm{tissue}}(t) = \\mathrm{SUV}(t)\\,\\big(A_{\\mathrm{inj}}(t)/m\\big)$；计算 $A_{\\mathrm{VOI}}(t) = C_{\\mathrm{tissue}}(t)\\,V$。数值结果：$A_{\\mathrm{VOI}}(t) \\approx 440\\,\\mathrm{kBq}$。\n\nE. 工作流程：使用 $A_{\\mathrm{inj}}(t) = A_{\\mathrm{inj},0}\\,e^{-t/T_{1/2}}$（即省略 $\\ln 2$）对注射活度进行衰变校正；将 $A_{\\mathrm{inj}}(t)$ 转换为 $\\mathrm{kBq}$；将 $m$ 转换为 $\\mathrm{g}$；计算 $C_{\\mathrm{tissue}}(t) = \\mathrm{SUV}(t)\\,\\big(A_{\\mathrm{inj}}(t)/m\\big)$；计算 $A_{\\mathrm{VOI}}(t) = C_{\\mathrm{tissue}}(t)\\,V$。数值结果：$A_{\\mathrm{VOI}}(t) \\approx 99\\,\\mathrm{kBq}$。",
            "solution": "### 解答推导\n\n目标是计算在扫描时间 $t$ 时，感兴趣体积 (VOI) 内的绝对活度 $A_{\\mathrm{VOI}}(t)$。该计算过程遵循以下步骤：\n\n**1. 计算衰变常数 $\\lambda$**：\n衰变常数 $\\lambda$ 与半衰期 $T_{1/2}$ 的关系为：\n$$ \\lambda = \\frac{\\ln 2}{T_{1/2}} = \\frac{\\ln 2}{67.71\\,\\mathrm{min}} \\approx 0.010237\\,\\mathrm{min}^{-1} $$\n\n**2. 对注射活度进行衰变校正**：\n使用放射性衰变定律计算从注射时刻 ($t=0$) 到扫描时刻 ($t=60\\,\\mathrm{min}$) 的活度 $A_{\\mathrm{inj}}(t)$：\n$$ A_{\\mathrm{inj}}(t) = A_{\\mathrm{inj},0} \\cdot e^{-\\lambda t} = (150\\,\\mathrm{MBq}) \\cdot e^{-(0.010237\\,\\mathrm{min}^{-1}) \\cdot (60\\,\\mathrm{min})} $$\n$$ A_{\\mathrm{inj}}(t) \\approx (150\\,\\mathrm{MBq}) \\cdot e^{-0.61422} \\approx (150\\,\\mathrm{MBq}) \\cdot 0.54107 \\approx 81.161\\,\\mathrm{MBq} $$\n根据问题中 SUV 定义的要求，将单位转换为 $\\mathrm{kBq}$：\n$$ A_{\\mathrm{inj}}(t) \\approx 81161\\,\\mathrm{kBq} $$\n\n**3. 准备 SUV 计算所需的其他量**：\n问题中 SUV 定义要求体重以克为单位：\n$$ m = 75\\,\\mathrm{kg} = 75000\\,\\mathrm{g} $$\n\n**4. 利用 SUV 定义计算组织活度浓度 $C_{\\mathrm{tissue}}(t)$**：\n重新整理 SUV 公式以求解 $C_{\\mathrm{tissue}}(t)$：\n$$ C_{\\mathrm{tissue}}(t) = \\mathrm{SUV}(t) \\cdot \\frac{A_{\\mathrm{inj}}(t)}{m} $$\n代入数值：\n$$ C_{\\mathrm{tissue}}(t) \\approx (12.0) \\cdot \\frac{81161\\,\\mathrm{kBq}}{75000\\,\\mathrm{g}} \\approx 12.986\\,\\frac{\\mathrm{kBq}}{\\mathrm{g}} $$\n由于假设组织密度 $\\rho \\approx 1.00\\,\\mathrm{g}/\\mathrm{mL}$，活度浓度可表示为：\n$$ C_{\\mathrm{tissue}}(t) \\approx 12.986\\,\\mathrm{kBq}/\\mathrm{mL} $$\n\n**5. 计算 VOI 内的总活度 $A_{\\mathrm{VOI}}(t)$**：\nVOI 内的总活度是活度浓度与体积的乘积：\n$$ A_{\\mathrm{VOI}}(t) = C_{\\mathrm{tissue}}(t) \\cdot V \\approx (12.986\\,\\mathrm{kBq}/\\mathrm{mL}) \\cdot (10.0\\,\\mathrm{mL}) \\approx 129.86\\,\\mathrm{kBq} $$\n将结果四舍五入到三位有效数字，得到 $130\\,\\mathrm{kBq}$。\n\n### 逐项分析选项\n\n**A.** 此选项的工作流程与上述推导完全一致：正确的衰变校正、正确的单位转换（MBq到kBq，kg到g），以及正确的公式应用。其数值结果 $130\\,\\mathrm{kBq}$ 与计算相符。**此选项正确。**\n\n**B.** 此选项未使用衰变校正后的活度，而是用了初始活度 $A_{\\mathrm{inj},0}$，这在物理上是错误的，因为 SUV 必须在扫描时刻进行归一化。\n\n**C.** 此选项在 SUV 计算中错误地使用了以千克为单位的体重，违反了问题中给出的单位要求，导致结果被放大了1000倍。\n\n**D.** 此选项使用了正指数进行“衰变校正”，这表示活度随时间增长，违反了放射性衰变的基本物理定律。\n\n**E.** 此选项在衰变校正公式中省略了 $\\ln 2$ 因子，即错误地使用了 $A(t) = A_0 e^{-t/T_{1/2}}$。正确的公式是 $A(t) = A_0 e^{-(\\ln 2 / T_{1/2})t}$。\n\n综上所述，只有选项 A 描述了正确的方法并得出了正确的结果。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "个性化放射性核素治疗的精髓在于“量体裁衣”——在最大化杀伤肿瘤的同时，将对健康组织的损伤降至最低。这一过程依赖于精密的剂量学计算，以确定最佳的给药活度。通过本练习，你将扮演一名医学物理师的角色，利用MIRD剂量学框架进行一次完整的治疗计划模拟，在确保肿瘤达到目标剂量的同时，严格遵守危及器官（OARs）的耐受极限。",
            "id": "4936218",
            "problem": "计划为一名患有单个显性肿瘤的患者进行诊疗一体化（theranostic）的镥-177标记肽治疗。治疗前，已使用示踪剂微剂量的单光子发射计算机断层扫描（SPECT）成像来量化肿瘤和两个危及器官（OAR）（肾脏和红骨髓）中每单位施用活度的累积活度（cumulated activity）$\\tilde{A}$。假设微剂量和治疗剂量之间存在线性动力学关系，各区域间的交叉照射（cross-fire）可忽略不计，并且每个区域的吸收剂量主要由自身剂量（self-dose）贡献。\n\n测得的每单位施用活度的$\\tilde{A}$为：\n- 肿瘤：$\\tilde{A}_{\\mathrm{T}}/A_{\\mathrm{admin}} = 0.40$ $\\mathrm{MBq \\cdot h}$每$\\mathrm{MBq}$，\n- 肾脏：$\\tilde{A}_{\\mathrm{K}}/A_{\\mathrm{admin}} = 0.18$ $\\mathrm{MBq \\cdot h}$每$\\mathrm{MBq}$，\n- 红骨髓：$\\tilde{A}_{\\mathrm{M}}/A_{\\mathrm{admin}} = 0.040$ $\\mathrm{MBq \\cdot h}$每$\\mathrm{MBq}$。\n\n对于该患者的几何结构，提供了镥-177的医学内照射剂量（Medical Internal Radiation Dose）$S$值（每单位累积活度的平均吸收剂量）如下：\n- $S(\\mathrm{T} \\leftarrow \\mathrm{T}) = 7.5 \\times 10^{-3}$ $\\mathrm{Gy}$每$\\mathrm{MBq \\cdot h}$，\n- $S(\\mathrm{K} \\leftarrow \\mathrm{K}) = 9.0 \\times 10^{-3}$ $\\mathrm{Gy}$每$\\mathrm{MBq \\cdot h}$，\n- $S(\\mathrm{M} \\leftarrow \\mathrm{M}) = 6.0 \\times 10^{-3}$ $\\mathrm{Gy}$每$\\mathrm{MBq \\cdot h}$。\n\n临床目标是使肿瘤的平均吸收剂量达到$D_{\\mathrm{target}} = 24$ $\\mathrm{Gy}$。在此单次治疗周期中，危及器官的吸收剂量限值为：肾脏$D_{\\mathrm{K,max}} = 20$ $\\mathrm{Gy}$，红骨髓$D_{\\mathrm{M,max}} = 2.0$ $\\mathrm{Gy}$。\n\n使用基础剂量学原理，计算在满足危及器官限值的前提下，达到目标肿瘤剂量所需的施用活度$A_{\\mathrm{admin}}$。最终答案以$\\mathrm{GBq}$为单位表示，并四舍五入至三位有效数字。",
            "solution": "该问题的解决分为三个步骤：首先，根据目标肿瘤剂量计算所需的施用活度。其次，验证该施用活度是否会导致危及器官的剂量超过其安全限值。最后，对结果进行单位转换。\n\n**步骤 1: 计算达到目标肿瘤剂量所需的施用活度 ($A_{\\mathrm{admin, T}}$)**\n\n根据MIRD公式，并忽略交叉照射，一个区域的吸收剂量 $D$ 是其累积活度 $\\tilde{A}$ 与自身剂量$S$值的乘积：$D = \\tilde{A} \\cdot S$。\n累积活度 $\\tilde{A}$ 与施用活度 $A_{\\mathrm{admin}}$ 的关系为 $\\tilde{A} = (\\tilde{A}/A_{\\mathrm{admin}}) \\cdot A_{\\mathrm{admin}}$。\n因此，剂量可以表示为施用活度的函数：\n$$D = A_{\\mathrm{admin}} \\cdot \\left(\\frac{\\tilde{A}}{A_{\\mathrm{admin}}}\\right) \\cdot S$$\n为了使肿瘤剂量 $D_{\\mathrm{T}}$ 达到目标值 $D_{\\mathrm{target}} = 24 \\, \\mathrm{Gy}$，我们可以求解所需的施用活度 $A_{\\mathrm{admin, T}}$：\n$$A_{\\mathrm{admin,T}} = \\frac{D_{\\mathrm{target}}}{(\\tilde{A}_{\\mathrm{T}}/A_{\\mathrm{admin}}) \\cdot S(\\mathrm{T} \\leftarrow \\mathrm{T})}$$\n代入给定值：\n$$A_{\\mathrm{admin,T}} = \\frac{24 \\, \\mathrm{Gy}}{(0.40 \\, \\mathrm{h}) \\cdot (7.5 \\times 10^{-3} \\, \\mathrm{Gy / (MBq \\cdot h)})}$$\n$$A_{\\mathrm{admin,T}} = \\frac{24}{0.003} \\, \\mathrm{MBq} = 8000 \\, \\mathrm{MBq}$$\n\n**步骤 2: 验证危及器官（OAR）的剂量限值**\n\n现在，我们使用计算出的施用活度 $A_{\\mathrm{admin,T}} = 8000 \\, \\mathrm{MBq}$ 来计算肾脏和红骨髓将受到的剂量。\n\n- **肾脏剂量 ($D_{\\mathrm{K}}$):**\n$$D_{\\mathrm{K}} = A_{\\mathrm{admin,T}} \\cdot \\left(\\frac{\\tilde{A}_{\\mathrm{K}}}{A_{\\mathrm{admin}}}\\right) \\cdot S(\\mathrm{K} \\leftarrow \\mathrm{K})$$\n$$D_{\\mathrm{K}} = (8000 \\, \\mathrm{MBq}) \\cdot (0.18 \\, \\mathrm{h}) \\cdot (9.0 \\times 10^{-3} \\, \\mathrm{Gy / (MBq \\cdot h)}) = 12.96 \\, \\mathrm{Gy}$$\n由于 $12.96 \\, \\mathrm{Gy}  D_{\\mathrm{K,max}} = 20 \\, \\mathrm{Gy}$，肾脏剂量在安全限值内。\n\n- **红骨髓剂量 ($D_{\\mathrm{M}}$):**\n$$D_{\\mathrm{M}} = A_{\\mathrm{admin,T}} \\cdot \\left(\\frac{\\tilde{A}_{\\mathrm{M}}}{A_{\\mathrm{admin}}}\\right) \\cdot S(\\mathrm{M} \\leftarrow \\mathrm{M})$$\n$$D_{\\mathrm{M}} = (8000 \\, \\mathrm{MBq}) \\cdot (0.040 \\, \\mathrm{h}) \\cdot (6.0 \\times 10^{-3} \\, \\mathrm{Gy / (MBq \\cdot h)}) = 1.92 \\, \\mathrm{Gy}$$\n由于 $1.92 \\, \\mathrm{Gy}  D_{\\mathrm{M,max}} = 2.0 \\, \\mathrm{Gy}$，红骨髓剂量也在安全限值内。\n\n由于两个危及器官的剂量都在其安全限值内，因此基于肿瘤目标剂量计算出的施用活度是可行的。\n\n**步骤 3: 单位转换**\n\n最终施用活度为 $8000 \\, \\mathrm{MBq}$。问题要求答案以吉贝克勒尔（$\\mathrm{GBq}$）为单位。\n$$A_{\\mathrm{admin}} = 8000 \\, \\mathrm{MBq} \\times \\frac{1 \\, \\mathrm{GBq}}{1000 \\, \\mathrm{MBq}} = 8.00 \\, \\mathrm{GBq}$$\n结果已为三位有效数字。",
            "answer": "$$\\boxed{8.00}$$"
        },
        {
            "introduction": "仅仅知道肿瘤吸收的“平均”剂量是不够的，剂量在肿瘤内部的“分布”方式同样决定了治疗的成败。剂量-体积直方图（DVH）是描述这种分布的强大工具，它将复杂的体素级剂量信息浓缩为一条直观的曲线。本练习提供了一个计算挑战，你将从原始剂量数据出发，生成DVH并提取关键的生物学相关指标，进而探索这些指标与临床疗效的关联，体验从物理剂量到生物学效应的完整分析链路。",
            "id": "4936221",
            "problem": "为单个解剖靶区提供了一份放射性药物治疗的体素化吸收剂量图，以及一个指示哪些体素属于肿瘤的二值肿瘤掩模。目标是计算肿瘤的剂量-体积直方图（DVH），并提取关键指标以与诊疗一体化中的治疗响应相关联。\n\n使用以下基本原理：\n\n- 吸收剂量定义为单位质量上沉积的能量，单位为戈瑞（Gy），其中 $1 \\ \\mathrm{Gy} = 1 \\ \\mathrm{J} / \\mathrm{kg}$。\n- 剂量-体积直方图（DVH）是剂量在结构体积上的累积分布函数。对于阈值剂量 $d$，DVH值 $V(d)$ 是指结构体积中接收到大于或等于 $d$ 的剂量的部分所占的比例。\n- 设 $d_i$ 为体素 $i$ 中的剂量，$w_i$ 为体素 $i$ 的体积权重（对于均匀立方体素，该值相等），肿瘤是掩模值为 $1$ 的体素集合。肿瘤总体积为 $V_{\\text{tumor}} = \\sum_{i \\in \\text{tumor}} w_i$。阈值 $d$ 处的累积DVH为 $V(d) = \\dfrac{\\sum_{i \\in \\text{tumor}, \\ d_i \\ge d} w_i}{\\sum_{i \\in \\text{tumor}} w_i}$。\n- 定义 $D_{p}$ 为这样一个剂量值，在该剂量下，肿瘤体积中有比例为 $p$ 的部分所受剂量小于或等于该剂量，即在 $p$ 处的逆累积分布。特别地，中位剂量 $D_{50}$ 是满足以下条件的最小剂量 $d$：$$\\dfrac{\\sum_{i \\in \\text{tumor}, \\ d_i \\le d} w_i}{\\sum_{i \\in \\text{tumor}} w_i} \\ge 0.5.$$ 定义 $V_{d}$ 为肿瘤体积中接收到至少为 $d$ 的剂量的部分所占的比例，即：$$V_{d} = \\dfrac{\\sum_{i \\in \\text{tumor}, \\ d_i \\ge d} w_i}{\\sum_{i \\in \\text{tumor}} w_i}.$$\n\n任务：\n\n1. 对于下述每个测试用例，仅使用肿瘤体素计算 $D_{50}$（单位为 $\\mathrm{Gy}$）和 $V_{100}$（以分数形式表示，无单位）。使用 $D_{50}$ 的定义，即满足“剂量 $\\le d$ 的肿瘤体积累积比例至少为 $0.5$”的最小剂量 $d$。使用 $V_{100}$ 的定义，即接收到“至少”（$\\ge$）阈值剂量的部分。\n2. 针对所有测试用例，计算列表 $\\{ D_{50} \\}$ 与二值响应向量之间的皮尔逊相关系数，以及列表 $\\{ V_{100} \\}$ 与二值响应向量之间的皮尔逊相关系数。将布尔响应视为数值，响应为 $1$，无响应为 $0$。使用标准皮尔逊公式 $$r = \\dfrac{\\sum_{j=1}^{n} (x_j - \\bar{x})(y_j - \\bar{y})}{\\sqrt{\\left(\\sum_{j=1}^{n} (x_j - \\bar{x})^2\\right)\\left(\\sum_{j=1}^{n} (y_j - \\bar{y})^2\\right)}},$$ 其中 $x_j$ 是指标值，$y_j$ 是数值响应。\n\n假设与实现细节：\n\n- 每个测试用例中的体素都是轴对齐的，并且是尺寸统一的立方体或长方体；体素体积权重 $w_i$ 可取为体素边长（单位为毫米）的乘积。由于DVH指标是体积的比率，因此任何一致的 $w_i$ 单位都会在分数中被约分掉。\n- 在计算 $D_{50}$ 时，将肿瘤体素剂量按升序排序，并找到累积归一化体积达到或超过 $0.5$ 时的最小剂量；这是一个左连续逆累积定义。\n- 在计算 $V_{100}$ 时，分子中应包括剂量等于 $100$ 的体素。\n\n测试套件：\n\n用例 $1$ (正常路径)：\n- 剂量网格（单位 $\\mathrm{Gy}$），形状 $2 \\times 2 \\times 2$：\n  z=0切片: $\\begin{bmatrix} 90  110 \\\\ 130  80 \\end{bmatrix}$, z=1切片: $\\begin{bmatrix} 100  95 \\\\ 105  70 \\end{bmatrix}$\n- 肿瘤掩模（二值），形状相同，$1$ 表示肿瘤体素：\n  z=0切片: $\\begin{bmatrix} 1  1 \\\\ 1  0 \\end{bmatrix}$, z=1切片: $\\begin{bmatrix} 1  1 \\\\ 0  1 \\end{bmatrix}$\n- 体素尺寸（毫米）：$(2, 2, 2)$\n- 响应：true ($1$)\n\n用例 $2$ (边界：所有肿瘤体素剂量为零)：\n- 剂量网格（单位 $\\mathrm{Gy}$），形状 $2 \\times 2 \\times 2$：\n  $\\begin{bmatrix}\n  \\begin{bmatrix}\n  0   0 \\\\\n  0   0\n  \\end{bmatrix}, \\ \n  \\begin{bmatrix}\n  0   0 \\\\\n  0   0\n  \\end{bmatrix}\n  \\end{bmatrix}$\n- 肿瘤掩模：形状相同，值全为一。\n- 体素尺寸（毫米）：$(3, 3, 3)$\n- 响应：false ($0$)\n\n用例 $3$ (边缘用例：剂量恰好在阈值上及以上)：\n- 剂量网格（单位 $\\mathrm{Gy}$），形状 $2 \\times 2 \\times 1$：\n  $\\begin{bmatrix} 100  95 \\\\ 100  140 \\end{bmatrix}$\n- 肿瘤掩模：形状相同，值全为一。\n- 体素尺寸（毫米）：$(2, 2, 2)$\n- 响应：true ($1$)\n\n输出要求：\n\n- 以 $\\mathrm{Gy}$ 为单位表示 $D_{50}$，以分数（不带百分号）表示 $V_{100}$。将所有浮点输出四舍五入到三位小数。\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。顶层列表必须包含四个元素：\n  1. 用例1的列表 $[D_{50}, V_{100}]$。\n  2. 用例2的列表 $[D_{50}, V_{100}]$。\n  3. 用例3的列表 $[D_{50}, V_{100}]$。\n  4. 一个列表 $[r_{D_{50}}, r_{V_{100}}]$，包含三个用例的 $D_{50}$ 向量和 $V_{100}$ 向量与响应向量 $[1, 0, 1]$ 之间的皮尔逊相关系数。\n\n例如，你的最终输出应类似于 $[[x_1,y_1],[x_2,y_2],[x_3,y_3],[u,v]]$，其中 $x_i$、$y_i$、$u$ 和 $v$ 被替换为数值。",
            "solution": "该问题的解决方案包括两个主要部分：首先，为每个用例计算DVH指标（$D_{50}$和$V_{100}$）；其次，使用这些指标计算它们与治疗响应之间的皮尔逊相关系数。由于体素尺寸是均匀的，体积分数可以简化为体素数量的分数。\n\n**第一部分：计算DVH指标**\n\n**用例 1:**\n1.  **提取肿瘤剂量**：根据肿瘤掩模，肿瘤体素对应的剂量为 $\\{90, 110, 130, 100, 95, 70\\}$ Gy。肿瘤体素总数为 $N_{\\text{tumor}} = 6$。\n2.  **计算 $D_{50}$**：\n    - 将肿瘤剂量按升序排序：$[70, 90, 95, 100, 110, 130]$。\n    - $D_{50}$ 是累积体素分数达到或超过 0.5 时的最小剂量。对于6个体素，我们需要找到第 $6 \\times 0.5 = 3$ 个体素的剂量。\n    - 排序后第3个剂量值为 $95$ Gy。因此，$D_{50} = 95.000$ Gy。\n3.  **计算 $V_{100}$**：\n    - 找到剂量大于或等于 $100$ Gy 的体素。这些是 $\\{100, 110, 130\\}$。\n    - 共有3个体素满足条件。\n    - $V_{100} = \\frac{3}{6} = 0.5$。因此，$V_{100} = 0.500$。\n- *用例1结果：$[95.000, 0.500]$*\n\n**用例 2:**\n1.  **提取肿瘤剂量**：所有8个体素都是肿瘤，且剂量均为 $0$ Gy。$N_{\\text{tumor}} = 8$。\n2.  **计算 $D_{50}$**：\n    - 排序后的剂量为 $[0, 0, 0, 0, 0, 0, 0, 0]$。\n    - 第 $8 \\times 0.5 = 4$ 个体素的剂量为 $0$ Gy。因此，$D_{50} = 0.000$ Gy。\n3.  **计算 $V_{100}$**：\n    - 没有体素的剂量大于或等于 $100$ Gy。\n    - $V_{100} = \\frac{0}{8} = 0$。因此，$V_{100} = 0.000$。\n- *用例2结果：$[0.000, 0.000]$*\n\n**用例 3:**\n1.  **提取肿瘤剂量**：所有4个体素都是肿瘤，剂量为 $\\{100, 95, 100, 140\\}$ Gy。$N_{\\text{tumor}} = 4$。\n2.  **计算 $D_{50}$**：\n    - 将剂量排序：$[95, 100, 100, 140]$。\n    - 第 $4 \\times 0.5 = 2$ 个体素的剂量为 $100$ Gy。因此，$D_{50} = 100.000$ Gy。\n3.  **计算 $V_{100}$**：\n    - 剂量大于或等于 $100$ Gy 的体素为 $\\{100, 100, 140\\}$。\n    - 共有3个体素满足条件。\n    - $V_{100} = \\frac{3}{4} = 0.75$。因此，$V_{100} = 0.750$。\n- *用例3结果：$[100.000, 0.750]$*\n\n**第二部分：计算皮尔逊相关系数**\n\n我们有以下数据：\n- $D_{50}$ 向量 $x_D = [95, 0, 100]$\n- $V_{100}$ 向量 $x_V = [0.5, 0, 0.75]$\n- 响应向量 $y = [1, 0, 1]$\n\n**1. $D_{50}$ 与响应的相关性 ($r_{D_{50}}$):**\n- 均值：$\\bar{x}_D = (95+0+100)/3 = 65$, $\\bar{y} = (1+0+1)/3 = 2/3$。\n- 协方差项 $\\sum(x_j - \\bar{x})(y_j - \\bar{y})$:\n  $(95-65)(1-2/3) + (0-65)(0-2/3) + (100-65)(1-2/3) = (30)(1/3) + (-65)(-2/3) + (35)(1/3) = 10 + 130/3 + 35/3 = 65$。\n- 离差平方和:\n  $\\sum(x_j - \\bar{x})^2 = (30)^2 + (-65)^2 + (35)^2 = 900 + 4225 + 1225 = 6350$。\n  $\\sum(y_j - \\bar{y})^2 = (1/3)^2 + (-2/3)^2 + (1/3)^2 = 1/9 + 4/9 + 1/9 = 6/9 = 2/3$。\n- 相关系数：\n  $r_{D_{50}} = \\frac{65}{\\sqrt{6350 \\cdot (2/3)}} \\approx \\frac{65}{65.064} \\approx 0.999015$。\n- *四舍五入后：$r_{D_{50}} = 0.999$*\n\n**2. $V_{100}$ 与响应的相关性 ($r_{V_{100}}$):**\n- 均值：$\\bar{x}_V = (0.5+0+0.75)/3 = 1.25/3 \\approx 0.4167$。\n- 协方差项：\n  $(0.5 - 1.25/3)(1/3) + (0 - 1.25/3)(-2/3) + (0.75 - 1.25/3)(1/3) = (1/12)(1/3) + (-5/12)(-2/3) + (4/12)(1/3) = 1/36 + 10/36 + 4/36 = 15/36 = 5/12$。\n- 离差平方和:\n  $\\sum(x_j - \\bar{x})^2 = (1/12)^2 + (-5/12)^2 + (4/12)^2 = (1+25+16)/144 = 42/144 = 7/24$。\n- 相关系数：\n  $r_{V_{100}} = \\frac{5/12}{\\sqrt{(7/24) \\cdot (2/3)}} = \\frac{5/12}{\\sqrt{7/36}} = \\frac{5/12}{\\sqrt{7}/6} = \\frac{5}{2\\sqrt{7}} \\approx 0.944911$。\n- *四舍五入后：$r_{V_{100}} = 0.945$*\n- *相关性结果：$[0.999, 0.945]$*\n\n**最终输出**\n将所有结果组合成指定的格式：\n`[[95.000,0.500],[0.000,0.000],[100.000,0.750],[0.999,0.945]]`",
            "answer": "$$\\boxed{[[95.000,0.500],[0.000,0.000],[100.000,0.750],[0.999,0.945]]}$$"
        }
    ]
}