{
    "hands_on_practices": [
        {
            "introduction": "区域生长是一种直观的分割方法，它从一个或多个“种子”像素开始，逐步将满足特定相似性准则的邻近像素合并到该区域中。为了清晰地揭示该算法的核心机制，本练习  将复杂的医学图像简化为一个理想化的线性强度模型。通过这个受控的虚拟场景，你可以精确计算在给定的强度差异阈值下，区域将如何扩展，从而深刻理解区域生长算法的基本工作原理和参数选择的直接影响。",
            "id": "4893705",
            "problem": "一个三维磁共振成像 (MRI) 体数据在笛卡尔网格上进行采样，该网格由边长 $s = 1$ 毫米的各向同性体素构成，形成一个大小为 $N_{x} \\times N_{y} \\times N_{z} = 201 \\times 100 \\times 80$ 的网格。在一个覆盖整个体数据的邻域内，图像强度场可以很好地用一个沿 $x$ 轴方向的空间线性斜坡来近似，其表达式为 $I(x,y,z) = I_{0} + k x$，其中 $I_{0}$ 在整个体数据上是常数，而 $k = 0.5$ 强度单位/毫米 也是常数。体素中心的物理坐标为 $(x,y,z) = (is, js, ks)$，其中 $i \\in \\{0, 1, \\dots, N_{x}-1\\}$，$j \\in \\{0, 1, \\dots, N_{y}-1\\}$ 和 $k \\in \\{0, 1, \\dots, N_{z}-1\\}$ 是整数索引。\n\n一个种子区域生长算法在种子体素 $(i_{0}, j_{0}, k_{0}) = (100, 50, 40)$ 处初始化，并使用以下包含规则：当且仅当一个体素的强度与种子体素的强度之绝对差不超过阈值 $\\Delta I = 15$（单位与 $I$ 的强度单位相同）时，该体素才被接纳到区域中。该算法使用 $26$-连通性，并探索由该包含规则定义的整个连通集。假设线性斜坡模型在体数据中处处成立，梯度方向与 $x$ 轴完全对齐，并且没有其他停止条件。\n\n仅使用网格采样的基本定义和基于强度差异的种子区域生长包含规则，计算在终止前将被并入生长区域的体素总数。请提供一个整数作为您的最终答案。",
            "solution": "我们首先确定被包含体素的范围。\n该算法的包含规则是，一个体素 $(i, j, k)$ 被包含在生长区域内，当且仅当其强度 $I(i,j,k)$ 与种子体素 $(i_0, j_0, k_0) = (100, 50, 40)$ 的强度 $I(i_0, j_0, k_0)$ 之差的绝对值不超过阈值 $\\Delta I = 15$。\n$$|I(i,j,k) - I(100,50,40)| \\le 15$$\n\n首先，我们计算种子点的强度。根据强度模型 $I(x,y,z) = I_0 + kx$，并注意到体素坐标与物理坐标的关系为 $(x,y,z) = (is, js, ks)$，其中 $s=1$ mm/voxel。\n种子点的物理坐标为 $x_0 = i_0 s = 100 \\times 1 = 100$ mm。\n因此，种子点的强度为：\n$$I_{\\text{seed}} = I(100,50,40) = I_0 + k \\cdot x_0 = I_0 + (0.5) \\cdot (100) = I_0 + 50$$\n\n接下来，我们计算任意体素 $(i,j,k)$ 的强度。其物理 $x$ 坐标为 $x = i \\cdot s = i$。\n$$I(i,j,k) = I_0 + k \\cdot x = I_0 + 0.5i$$\n注意，强度仅与 $x$ 坐标（即索引 $i$）有关。\n\n现在，我们将这些表达式代入包含规则中：\n$$ |(I_0 + 0.5i) - (I_0 + 50)| \\le 15 $$\n$$ |0.5i - 50| \\le 15 $$\n这个不等式等价于：\n$$ -15 \\le 0.5i - 50 \\le 15 $$\n我们将不等式的每一部分都加上 50：\n$$ 50 - 15 \\le 0.5i \\le 50 + 15 $$\n$$ 35 \\le 0.5i \\le 65 $$\n现在，我们将不等式的每一部分都乘以 2：\n$$ 70 \\le i \\le 130 $$\n\n这个结果表明，所有索引 $i$ 在 $[70, 130]$ 范围内的体素都满足强度准则。由于强度不依赖于 $j$ 和 $k$，这意味着对于每一个满足条件的 $i$ 值，所有 $j$ 和 $k$ 坐标的体素都将被包含。\n算法使用 26-连通性，并且强度梯度只沿 $x$ 轴方向。这意味着在任何给定的 $y-z$ 平面（即 $i$ 恒定），所有体素强度相同。因此，如果一个体素被包含，其在该平面上的所有邻居也将被包含（因为它们的强度相同）。由于26-连通性，整个 $y-z$ 平面将被视为一个大的连通分量。因此，对于每个满足条件的 $i$ 值，所有可能的 $j$ 和 $k$ 值的体素都将被包含。\n\n我们需要计算满足条件的整数索引的数量：\n-   对于索引 $i$：$i$ 的范围是从 $70$ 到 $130$（包含两端）。$i$ 的可能值的数量为 $130 - 70 + 1 = 61$。\n-   对于索引 $j$：$j$ 的范围是从 $0$ 到 $N_y-1 = 100-1=99$。$j$ 的可能值的数量为 $100$。\n-   对于索引 $k$：$k$ 的范围是从 $0$ 到 $N_z-1 = 80-1=79$。$k$ 的可能值的数量为 $80$。\n\n生长区域中的体素总数是所有满足条件的 $i, j, k$ 组合的数量。\n$$ \\text{总数} = (\\text{i的数量}) \\times (\\text{j的数量}) \\times (\\text{k的数量}) $$\n$$ \\text{总数} = 61 \\times 100 \\times 80 = 488000 $$\n\n因此，总共有 488,000 个体素将被并入生长区域。",
            "answer": "$$\n\\boxed{488000}\n$$"
        },
        {
            "introduction": "通过阈值化或区域生长得到的初始分割结果往往并不完美，可能包含内部空洞或外部噪点。数学形态学操作，如开运算和闭运算，是清理这些瑕疵、优化分割结果的关键工具。本练习  模拟了一个真实的后处理挑战：你需要选择一个最优的结构元尺寸，既要能填充病灶内部的孔洞，又要避免错误地连接到邻近组织，同时还不能破坏病灶自身的纤细结构。这个实践将帮助你掌握在形态学处理中平衡各种对立需求、做出明智决策的实用技能。",
            "id": "4893668",
            "problem": "通过强度阈值法和随后的种子区域生长，从T2加权磁共振成像 (MRI) 切片中获得一个二值病变掩膜。计划使用半径为 $r$ 的圆盘结构元素进行阈值后清理，首先应用形态学闭运算（先膨胀后腐蚀）来填充小孔并抑制病变内部的空洞，然后应用形态学开运算（先腐蚀后膨胀）来移除小的伪前景斑点，同时保留薄的解剖结构。考虑在感兴趣区域中测得的以下科学上合理的几何描述符：病变内部最大孔洞直径为 $h = 1.0\\,\\mathrm{mm}$，将病变边界与相邻亮结构分开的最小暗间隙为 $g = 2.2\\,\\mathrm{mm}$，病变内最薄的连接峡部厚度为 $t = 1.6\\,\\mathrm{mm}$。假设图像以 $0.5\\,\\mathrm{mm}$ 的分辨率进行各向同性采样，并且病变边界和间隙可以局部地用平面集很好地近似，因此经典的二值形态学适用。\n\n从集合 $X \\subset \\mathbb{R}^2$ 上使用圆盘结构元素 $B_r = \\{ y \\in \\mathbb{R}^2 : \\|y\\| \\le r \\}$ 的二值膨胀和腐蚀的核心定义出发，即\n$$\nX \\oplus B_r = \\{ x \\in \\mathbb{R}^2 : (B_r)_x \\cap X \\neq \\emptyset \\}, \\quad\nX \\ominus B_r = \\{ x \\in \\mathbb{R}^2 : (B_r)_x \\subseteq X \\},\n$$\n以及由此导出的闭运算 $X \\bullet B_r = (X \\oplus B_r) \\ominus B_r$ 和开运算 $X \\circ B_r = (X \\ominus B_r) \\oplus B_r$，分析膨胀引起的泄漏（跨越间隙 $g$ 的桥接）和腐蚀引起的损失（厚度为 $t$ 的峡部断裂）之间的权衡，同时确保直径最大为 $h$ 的孔洞被填充。在这些假设下，哪种 $r$ 的选择能在避免泄漏和保留峡部的同时最大化清理效果？\n\nA. $r = 0.5\\,\\mathrm{mm}$\n\nB. $r = 0.8\\,\\mathrm{mm}$\n\nC. $r = 1.0\\,\\mathrm{mm}$\n\nD. $r = 1.2\\,\\mathrm{mm}$",
            "solution": "## 解题推导\n\n目标是确定用于一系列形态学闭运算和开运算的圆盘结构元素 $B_r$ 的最优半径 $r$。最优的 $r$ 是满足所有指定约束的最大值，因为更大的结构元素能提供更强的清理效果（填充更大的孔洞，移除更大的斑点）。我们必须将三个条件中的每一个都表述为包含 $r$ 的不等式。\n\n1.  **约束1：填充孔洞**\n    第一个操作是形态学闭运算, $X \\bullet B_r$，其设计目的是填充对象 $X$ 中的小孔洞。一个半径为 $r$ 的圆盘结构元素可以填充任何直径小于 $2r$ 的孔洞。为了确保所有直径最大为 $h = 1.0\\,\\mathrm{mm}$ 的孔洞都被填充，结构元素的直径 $2r$ 必须至少为 $h$。\n    $$ 2r \\ge h $$\n    代入给定值 $h = 1.0\\,\\mathrm{mm}$：\n    $$ 2r \\ge 1.0\\,\\mathrm{mm} \\implies r \\ge 0.5\\,\\mathrm{mm} $$\n\n2.  **约束2：保留峡部**\n    第二个操作是形态学开运算, $X' \\circ B_r$。开运算的主要风险是在其腐蚀阶段切断薄的连接（峡部）。如果圆盘 $B_r$ 的直径 $2r$ 大于峡部的厚度 $t$，那么腐蚀操作将导致峡部断裂。为防止峡部被完全腐蚀掉，结构元素的直径 $2r$ 必须小于或等于峡部的厚度 $t$。\n    $$ 2r \\le t $$\n    代入给定值 $t = 1.6\\,\\mathrm{mm}$：\n    $$ 2r \\le 1.6\\,\\mathrm{mm} \\implies r \\le 0.8\\,\\mathrm{mm} $$\n\n3.  **约束3：避免泄漏（桥接间隙）**\n    闭运算中的膨胀步骤 $X \\oplus B_r$ 会使对象的边界向外扩展距离 $r$。如果病变掩膜与相邻的亮结构被一个宽度为 $g$ 的间隙分开，当两个结构都向间隙内扩展 $r$ 时，它们之间的距离会减少 $2r$。为了避免它们接触并合并（桥接间隙），这个总扩展量必须小于间隙宽度 $g$。\n    $$ 2r  g $$\n    代入给定值 $g = 2.2\\,\\mathrm{mm}$：\n    $$ 2r  2.2\\,\\mathrm{mm} \\implies r  1.1\\,\\mathrm{mm} $$\n\n**结合约束并优化**\n\n我们已经推导出了半径 $r$ 必须同时满足的三个不等式系统：\n1.  $r \\ge 0.5\\,\\mathrm{mm}$\n2.  $r \\le 0.8\\,\\mathrm{mm}$\n3.  $r  1.1\\,\\mathrm{mm}$\n\n这三个条件的交集定义了 $r$ 的可行范围。结合 $r \\le 0.8\\,\\mathrm{mm}$ 和 $r  1.1\\,\\mathrm{mm}$，更严格的条件是 $r \\le 0.8\\,\\mathrm{mm}$。因此，合并后的可行范围是：\n$$ 0.5\\,\\mathrm{mm} \\le r \\le 0.8\\,\\mathrm{mm} $$\n问题要求选择能最大化清理效果的 $r$。这对应于可行范围内的最大可能值。区间 $[0.5, 0.8]$ 中的最大值是 $0.8$。\n因此，半径的最优选择是 $r = 0.8\\,\\mathrm{mm}$。\n\n## 逐项分析\n\n-   **A. $r = 0.5\\,\\mathrm{mm}$**：\n    -   填充孔洞：$2r = 1.0\\,\\mathrm{mm} \\ge h = 1.0\\,\\mathrm{mm}$。（满足）\n    -   保留峡部：$2r = 1.0\\,\\mathrm{mm} \\le t = 1.6\\,\\mathrm{mm}$。（满足）\n    -   避免泄漏：$2r = 1.0\\,\\mathrm{mm}  g = 2.2\\,\\mathrm{mm}$。（满足）\n    这个 $r$ 的选择是有效的，但它不是可行范围 $[0.5, 0.8]$ 内的最大值，因此没有最大化清理效果。\n\n-   **B. $r = 0.8\\,\\mathrm{mm}$**：\n    -   填充孔洞：$2r = 1.6\\,\\mathrm{mm} \\ge h = 1.0\\,\\mathrm{mm}$。（满足）\n    -   保留峡部：$2r = 1.6\\,\\mathrm{mm} \\le t = 1.6\\,\\mathrm{mm}$。（满足）\n    -   避免泄漏：$2r = 1.6\\,\\mathrm{mm}  g = 2.2\\,\\mathrm{mm}$。（满足）\n    这个 $r$ 的选择满足所有约束，并且是可行范围 $[0.5, 0.8]$ 内的最大值。因此，它在遵守所有条件的同时最大化了清理效果。\n\n-   **C. $r = 1.0\\,\\mathrm{mm}$**：\n    -   保留峡部：$2r = 2.0\\,\\mathrm{mm} > t = 1.6\\,\\mathrm{mm}$。（违反）\n    这个 $r$ 的选择将导致开运算破坏峡部。\n\n-   **D. $r = 1.2\\,\\mathrm{mm}$**：\n    -   避免泄漏：$2r = 2.4\\,\\mathrm{mm} > g = 2.2\\,\\mathrm{mm}$。（违反）\n    -   保留峡部：$2r = 2.4\\,\\mathrm{mm} > t = 1.6\\,\\mathrm{mm}$。（违反）\n    这个 $r$ 的选择既会破坏峡部，又会导致跨间隙的泄漏。\n\n最终结论是选项B是唯一满足所有条件并最大化清理效果的选项。",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "在完成图像分割后，我们如何客观地评价其好坏？一个关键步骤是将算法生成的分割结果与专家手工勾画的“金标准”（ground truth）进行比较。本练习  将引导你推导两个在医学图像分割领域最常用的评估指标——戴斯系数（Dice coefficient）和杰卡德指数（Jaccard index）——之间的数学关系。通过这个推导，你不仅会学会如何计算它们，更能深入理解这两个指标如何量化分割区域的重叠度，以及它们在评估分割性能时的细微差别。",
            "id": "4893701",
            "problem": "一个二维磁共振成像 (MRI) 切片被标注了两个二值分割掩码：一个是算法预测结果，另一个是经人工验证的真实标签。令 $A$ 和 $B$ 分别表示在算法掩码和真实标签掩码中被标记为前景（例如，病灶）的像素索引集合。假设 $A$ 和 $B$ 是有限集，并满足 $|A \\cap B| > 0$。使用针对二值掩码的标准集合基数框架，完成以下任务：\n\n- 将 $A$ 和 $B$ 的 Dice 相似系数 ($D$) 定义为其基数的数学函数。\n- 将 $A$ 和 $B$ 的 Jaccard 指数（也称为交并比，$J$）定义为其基数的数学函数。\n- 仅从这些定义和集合基数的基本性质出发，推导出一个以 Dice 相似系数 $D$ 表示 Jaccard 指数 $J$ 的闭式解析表达式。\n\n将最终表达式 $J(D)$ 以单个闭式解析表达式的形式给出。此量无需数值取整，也不带单位。",
            "solution": "我们首先介绍核心定义。对于代表两个二值掩码前景像素的两个有限集 $A$ 和 $B$：\n\n1. Dice 相似系数 (DSC)，记为 $D$，定义为\n$$\nD \\equiv \\frac{2\\,|A \\cap B|}{|A| + |B|}\n$$\n\n2. Jaccard 指数，记为 $J$，定义为\n$$\nJ \\equiv \\frac{|A \\cap B|}{|A \\cup B|}\n$$\n\n有限集的集合基数的一个基本性质是包含-排除原则：\n$$\n|A \\cup B| = |A| + |B| - |A \\cap B|\n$$\n\n我们的目标是用 $D$ 来表示 $J$。我们可以通过一个中间变量来建立它们之间的关系，即交集与并集的比率。让我们操纵 $D$ 和 $J$ 的定义。\n\n从 $J$ 的定义开始：\n$$ J = \\frac{|A \\cap B|}{|A| + |B| - |A \\cap B|} $$\n将分子和分母同除以 $|A \\cap B|$ (由于题目假设 $|A \\cap B| > 0$，这是允许的)：\n$$ J = \\frac{1}{\\frac{|A| + |B|}{|A \\cap B|} - 1} $$\n\n现在看 $D$ 的定义：\n$$ D = \\frac{2|A \\cap B|}{|A| + |B|} $$\n我们可以解出 $\\frac{|A| + |B|}{|A \\cap B|}$：\n$$ \\frac{|A| + |B|}{|A \\cap B|} = \\frac{2}{D} $$\n\n将这个表达式代入我们为 $J$ 推导的方程中：\n$$ J = \\frac{1}{\\frac{2}{D} - 1} $$\n为了得到一个更简洁的闭式表达式，我们将分母化简：\n$$ J = \\frac{1}{\\frac{2 - D}{D}} $$\n$$ J = \\frac{D}{2 - D} $$\n\n因为 $|A \\cap B| > 0$ 意味着 $D > 0$，并且对于有限集的二值掩码，我们有 $D \\leq 1$，所以分母 $2 - D$ 严格为正，确保该表达式有明确定义。因此，用 Dice 相似系数表示的 Jaccard 指数为：\n$$ J(D) = \\frac{D}{2 - D} $$",
            "answer": "$$\\boxed{\\frac{D}{2 - D}}$$"
        }
    ]
}