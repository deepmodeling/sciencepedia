{
    "hands_on_practices": [
        {
            "introduction": "Understanding the relationship between Hounsfield Units (HU) and the final displayed grayscale value is the cornerstone of CT image interpretation. This first exercise provides a direct way to master the windowing formula by reversing the typical workflow. Instead of calculating the grayscale output, you will determine the precise window level ($WL$) needed to map a specific tissue's HU value to a desired grayscale intensity, a fundamental skill for customizing image display .",
            "id": "4873173",
            "problem": "A Computed Tomography (CT) display pipeline maps Hounsfield units (HU) within a selected window to grayscale values. The window is parameterized by a window level $WL$ (the window center in HU) and a window width $WW$ (the full HU span of the window). The lower and upper window bounds are defined by $L = WL - WW/2$ and $U = WL + WW/2$. Within the window, a tissue value $h$ is linearly mapped so that $L$ corresponds to grayscale $0$ and $U$ corresponds to grayscale $255$. After this linear mapping, the grayscale is rounded to the nearest integer using the rule $\\mathrm{round}(n + 0.5) = n + 1$ for any integer $n$.\n\nAn imaging protocol sets the window width to $WW = 512$ $\\mathrm{HU}$ and seeks to choose the window level $WL$ such that a target tissue with HU $h = 40$ maps, before rounding, exactly to a desired grayscale $y = 153$. Determine the required $WL$ that achieves this pre-rounding condition.\n\nExpress your final numeric value for $WL$ in $\\mathrm{HU}$, and round your answer to four significant figures.",
            "solution": "We begin from the standard definitions of windowing in Computed Tomography (CT). Let $WL$ be the window level and $WW$ be the window width. The lower and upper bounds of the window are\n$$\nL = WL - \\frac{WW}{2}, \\qquad U = WL + \\frac{WW}{2}.\n$$\nWithin the window $[L, U]$, one maps Hounsfield units $h$ linearly to grayscale values in $[0, 255]$ such that $h = L$ maps to $0$ and $h = U$ maps to $255$. The unique linear mapping that satisfies these endpoint conditions has the form\n$$\ng(h) = \\alpha \\,(h - L),\n$$\nwith $g(L) = 0$ and $g(U) = 255$. Imposing $g(U) = 255$ gives\n$$\n255 = \\alpha \\,(U - L) \\quad \\Rightarrow \\quad \\alpha = \\frac{255}{U - L}.\n$$\nTherefore the pre-rounding grayscale for any $h \\in [L, U]$ is\n$$\ng(h) = \\frac{255\\,(h - L)}{U - L}.\n$$\nSubstituting the expressions for $L$ and $U$ in terms of $WL$ and $WW$ yields $U - L = WW$ and $h - L = h - \\left(WL - \\frac{WW}{2}\\right) = h - WL + \\frac{WW}{2}$. Hence,\n$$\ng(h) = \\frac{255\\left(h - WL + \\frac{WW}{2}\\right)}{WW} = 127.5 + \\frac{255\\,(h - WL)}{WW}.\n$$\nThe protocol requires that, before rounding, the grayscale equal the desired target $y$. Thus we enforce\n$$\ng(h) = y,\n$$\nwhich gives\n$$\n127.5 + \\frac{255\\,(h - WL)}{WW} = y.\n$$\nSolving for $WL$,\n$$\n\\frac{255\\,(h - WL)}{WW} = y - 127.5\n\\quad \\Rightarrow \\quad\nh - WL = \\frac{WW\\,(y - 127.5)}{255}\n\\quad \\Rightarrow \\quad\nWL = h - \\frac{WW\\,(y - 127.5)}{255}.\n$$\nNow substitute the given numerical values $h = 40$, $WW = 512$, and $y = 153$:\n$$\nWL = 40 - \\frac{512\\,(153 - 127.5)}{255}.\n$$\nCompute the difference in the parentheses:\n$$\n153 - 127.5 = 25.5,\n$$\nso\n$$\nWL = 40 - \\frac{512 \\times 25.5}{255}.\n$$\nEvaluate the fraction:\n$$\n512 \\times 25.5 = 13056, \\qquad \\frac{13056}{255} = 51.2,\n$$\nhence\n$$\nWL = 40 - 51.2 = -11.2.\n$$\nExpressing the window level in $\\mathrm{HU}$ and rounding to four significant figures, we obtain $-11.20$ $\\mathrm{HU}$.",
            "answer": "$$\\boxed{-11.20}$$"
        },
        {
            "introduction": "Moving from calculation to a more general analysis, this practice explores a critical pitfall in quantitative medical imaging. It challenges you to derive an expression that translates a segmentation threshold set on the displayed grayscale image back into its true equivalent in Hounsfield Units. This derivation highlights why performing quantitative analysis on windowed images can lead to biased results, as the effective HU threshold becomes dependent on the chosen window width ($WW$) and level ($WL$) .",
            "id": "4873151",
            "problem": "A Computed Tomography (CT) image is stored in Hounsfield Units (HU), denoted by $h \\in \\mathbb{R}$. For display, the system uses a window level $WL$ and window width $WW$ to map HU values to $8$-bit grayscale values $g \\in [0,255]$. The lower and upper cutoffs of the display window are defined by $L = WL - \\frac{WW}{2}$ and $U = WL + \\frac{WW}{2}$. All HU values $h \\leq L$ are displayed as $g = 0$, all HU values $h \\geq U$ are displayed as $g = 255$, and values $h \\in (L, U)$ are displayed using a linear ramp between $0$ and $255$. A Region of Interest (ROI) segmentation algorithm thresholds on the displayed grayscale values: a voxel is classified as belonging to the ROI if and only if $g \\geq t_{g}$, where $t_{g} \\in [0,255]$ is a user-chosen threshold in the display domain.\n\nStarting from these definitions, and without assuming any additional display nonlinearity or quantization effects beyond the $8$-bit discretization, derive an analytic expression for the HU-domain threshold $t_{h}$ such that $h \\geq t_{h}$ is exactly equivalent to $g \\geq t_{g}$ under the given windowing transformation, assuming $t_{g} \\in [0,255]$ and $h \\in [L,U]$ (i.e., in the linear ramp region). Your derivation should make clear how thresholding on displayed values introduces a dependence on $WW$ in the equivalent HU threshold.\n\nExpress your final answer for $t_{h}$ in Hounsfield Units (HU). No rounding is required; provide a closed-form expression in terms of $WL$, $WW$, and $t_{g}$.",
            "solution": "We want to find the HU-domain threshold, $t_h$, that is equivalent to a given grayscale threshold, $t_g$.\n\nFirst, we establish the linear mapping from Hounsfield Units ($h$) to grayscale values ($g$) for $h$ within the window $[L, U]$. The mapping is linear and passes through the points $(L, 0)$ and $(U, 255)$. The equation for this line is:\n$$g(h) = \\frac{255 - 0}{U - L}(h - L)$$\nSince the window width $WW = U - L$, this simplifies to:\n$$g(h) = \\frac{255}{WW}(h - L)$$\nThe segmentation condition is $g \\geq t_g$. We can substitute the expression for $g(h)$:\n$$\\frac{255}{WW}(h - L) \\geq t_g$$\nSolving for $h$ (and noting that $WW>0$):\n$$h - L \\geq t_g \\cdot \\frac{WW}{255}$$\n$$h \\geq L + t_g \\frac{WW}{255}$$\nThis inequality is in the form $h \\geq t_h$, which allows us to identify $t_h$:\n$$t_h = L + t_g \\frac{WW}{255}$$\nFinally, we substitute $L = WL - \\frac{WW}{2}$ to express $t_h$ in terms of the given parameters:\n$$t_h = \\left(WL - \\frac{WW}{2}\\right) + t_g \\frac{WW}{255}$$\nRearranging the terms gives the final expression:\n$$t_h = WL + WW \\left( \\frac{t_g}{255} - \\frac{1}{2} \\right)$$\nThis result shows that the effective HU threshold $t_h$ depends on both the window level $WL$ and the window width $WW$.",
            "answer": "$$\\boxed{WL + WW \\left( \\frac{t_g}{255} - \\frac{1}{2} \\right)}$$"
        },
        {
            "introduction": "This final practice applies your understanding of windowing to a practical scenario: visualizing the boundary between different tissues. Using a simplified model of a soft tissue-to-bone interface, you will quantify how adjusting the window width ($WW$) alters the \"visible transition width\" of the boundary. This exercise demonstrates the trade-off between contrast and dynamic range, showing how a narrow window can enhance contrast but also cause saturation, affecting the perceived sharpness of anatomical structures .",
            "id": "4873184",
            "problem": "A computed tomography (CT) line profile across a high-contrast interface between soft tissue and cortical bone is modeled as a one-dimensional edge spread function with partial volume averaging. The true Hounsfield unit (HU) values are $h_{s} = 40$ for soft tissue and $h_{b} = 1400$ for bone. Due to finite spatial resolution, the edge is broadened into a linear ramp over a width of $L = 2$ pixels, so that the HU as a function of position $x$ (in pixels) across the edge is\n$$\nh(x) =\n\\begin{cases}\nh_{s}, & x \\leq 0, \\\\\nh_{s} + \\dfrac{h_{b} - h_{s}}{L}\\,x, & 0 < x < L, \\\\\nh_{b}, & x \\geq L.\n\\end{cases}\n$$\nDisplayed grayscale intensity is obtained from HU by the standard linear windowing transformation with window level (WL) and window width (WW): intensities are clamped to black for $h \\leq WL - WW/2$, clamped to white for $h \\geq WL + WW/2$, and mapped linearly between these bounds.\n\nDefine the “visible transition width” $W_{\\text{vis}}$ (in pixels) as the length in $x$ over which the displayed intensity is neither clamped to black nor clamped to white, that is, the set of $x$ values such that $WL - WW/2 < h(x) < WL + WW/2$.\n\nFor a fixed window level of $WL = 200$, compare two window widths: a narrow window $WW_{1} = 300$ and a wide window $WW_{2} = 1200$. Compute the ratio\n$$\nR = \\dfrac{W_{\\text{vis}}(WW_{1})}{W_{\\text{vis}}(WW_{2})},\n$$\nwhere $W_{\\text{vis}}(WW)$ is the visible transition width (in pixels) under window width $WW$. Round your final answer for $R$ to three significant figures. Express the answer as a unitless decimal number.",
            "solution": "The goal is to compute the ratio of the \"visible transition widths\" for two different window settings. The visible transition width $W_{\\text{vis}}$ is the spatial extent of the HU ramp that is not saturated (clamped to black or white) by the display window. We focus on the linear ramp region where $x \\in (0, L)$.\n\nFirst, we define the linear ramp portion of the HU profile. The slope $m$ of the ramp is:\n$$m = \\dfrac{h_{b} - h_{s}}{L} = \\dfrac{1400 - 40}{2} = \\dfrac{1360}{2} = 680 \\text{ HU/pixel}$$\nSo, for $x \\in (0, 2)$, we have $h(x) = 40 + 680x$. The range of HU values on this ramp is from $h(x \\to 0^+) = 40$ to $h(x \\to 2^-) = 1400$.\n\nThe set of visible $x$ values is where the HU value $h(x)$ is within the window's non-saturated range, $(h_{lower}, h_{upper})$. The visible HU interval is the intersection of the ramp's HU range $(40, 1400)$ and the display window's range. The spatial width is then $W_{\\text{vis}} = (\\text{visible HU range}) / m$.\n\nLet's compute $W_{\\text{vis}}$ for each case with $WL = 200$.\n\n**Case 1: Narrow window, $WW_{1} = 300$**\nThe HU window bounds are:\n$h_{lower,1} = WL - WW_{1}/2 = 200 - 300/2 = 50$.\n$h_{upper,1} = WL + WW_{1}/2 = 200 + 300/2 = 350$.\nThe display window for HU is $(50, 350)$.\nThe intersection with the ramp's HU range $(40, 1400)$ is $(\\max(40, 50), \\min(1400, 350)) = (50, 350)$.\nThe visible transition width is:\n$$W_{\\text{vis}}(WW_{1}) = \\dfrac{350 - 50}{m} = \\dfrac{300}{680} = \\dfrac{15}{34} \\text{ pixels}$$\n\n**Case 2: Wide window, $WW_{2} = 1200$**\nThe HU window bounds are:\n$h_{lower,2} = WL - WW_{2}/2 = 200 - 1200/2 = -400$.\n$h_{upper,2} = WL + WW_{2}/2 = 200 + 1200/2 = 800$.\nThe display window for HU is $(-400, 800)$.\nThe intersection with the ramp's HU range $(40, 1400)$ is $(\\max(40, -400), \\min(1400, 800)) = (40, 800)$.\nThe visible transition width is:\n$$W_{\\text{vis}}(WW_{2}) = \\dfrac{800 - 40}{m} = \\dfrac{760}{680} = \\dfrac{19}{17} \\text{ pixels}$$\n\nFinally, we compute the required ratio $R$.\n$$R = \\dfrac{W_{\\text{vis}}(WW_{1})}{W_{\\text{vis}}(WW_{2})} = \\dfrac{15/34}{19/17}$$\n$$R = \\dfrac{15}{34} \\times \\dfrac{17}{19} = \\dfrac{15}{2 \\times 17} \\times \\dfrac{17}{19} = \\dfrac{15}{2 \\times 19} = \\dfrac{15}{38}$$\nTo provide the answer as a decimal rounded to three significant figures:\n$$R = \\dfrac{15}{38} \\approx 0.3947368...$$\nRounding to three significant figures gives $0.395$.",
            "answer": "$$\\boxed{0.395}$$"
        }
    ]
}