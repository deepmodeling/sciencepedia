{
    "hands_on_practices": [
        {
            "introduction": "The first step in CT-based attenuation correction is converting the anatomical information from a CT scan into a functional map for PET. This practice guides you through the foundational technique of creating a linear attenuation coefficient ($\\mu_{511}$) map from CT Hounsfield Units (HU). By establishing a simple linear relationship based on reference tissues like water and bone, you will learn the basic principle behind how PET/CT scanners generate the data needed to correct for photon attenuation. ",
            "id": "4556028",
            "problem": "A hybrid imaging system combining Positron Emission Tomography (PET) and Computed Tomography (CT) performs attenuation correction by converting CT Hounsfield Unit (HU) values, measured at diagnostic x-ray energies, into linear attenuation coefficients at $511$ kiloelectronvolts (keV), denoted $\\mu_{511}$. In radiomics, attenuation correction must be scientifically grounded in first principles.\n\nStarting from the Beer–Lambert law for photon transport, where transmitted intensity satisfies $I = I_{0}\\exp\\!\\left(-\\int \\mu(s)\\,ds\\right)$ and $\\mu$ is the linear attenuation coefficient, and the definition of the Hounsfield Unit, $\\mathrm{HU} = 1000 \\times \\dfrac{\\mu_{\\mathrm{CT}} - \\mu_{\\mathrm{water,CT}}}{\\mu_{\\mathrm{water,CT}}}$ at CT energies, we adopt the empirically validated assumption that at $511$ keV, Compton scattering dominates and $\\mu_{511}$ scales approximately linearly with electron density. To bridge the energy mismatch between CT and PET, many clinical systems implement a bilinear scaling from HU to $\\mu_{511}$ anchored at reference materials. For non-negative HU (soft tissue through bone), the mapping is taken as a two-point linear interpolation between water at $\\mathrm{HU}=0$ and cortical bone at $\\mathrm{HU}=1000$.\n\nAssume the system calibration uses the following reference linear attenuation coefficients at $511$ keV:\n- Water (at $\\mathrm{HU}=0$): $\\mu_{511}^{\\mathrm{water}} = 0.096$ $\\mathrm{cm}^{-1}$,\n- Cortical bone (at $\\mathrm{HU}=1000$): $\\mu_{511}^{\\mathrm{bone}} = 0.172$ $\\mathrm{cm}^{-1}$.\n\nUsing these anchors, define the bilinear HU-to-$\\mu_{511}$ scaling for $\\mathrm{HU} \\ge 0$ based on first principles and two-point interpolation, and then compute the values of $\\mu_{511}$ (in $\\mathrm{cm}^{-1}$) for a voxel with $\\mathrm{HU} = 1000$ and another voxel with $\\mathrm{HU} = 0$. Express the final attenuation coefficients in $\\mathrm{cm}^{-1}$. No rounding is necessary.",
            "solution": "The problem requires us to establish a linear relationship for the $511$ keV linear attenuation coefficient, $\\mu_{511}$, as a function of the Hounsfield Unit, $\\mathrm{HU}$, for non-negative $\\mathrm{HU}$ values. This relationship is to be determined by a two-point linear interpolation between specified anchor points for water and cortical bone.\n\nLet the linear function be of the form:\n$$ \\mu_{511}(\\mathrm{HU}) = m \\cdot \\mathrm{HU} + c $$\nwhere $m$ is the slope and $c$ is the intercept.\n\nThe problem provides two reference points $(\\mathrm{HU}, \\mu_{511})$:\n$1.$ For water: $(\\mathrm{HU}_1, \\mu_{1}) = (0, 0.096 \\ \\mathrm{cm}^{-1})$.\n$2.$ For cortical bone: $(\\mathrm{HU}_2, \\mu_{2}) = (1000, 0.172 \\ \\mathrm{cm}^{-1})$.\n\nThe intercept, $c$, is the value of $\\mu_{511}$ when $\\mathrm{HU} = 0$. From the first reference point, we can directly identify the intercept:\n$$ c = \\mu_{511}(\\mathrm{HU}=0) = \\mu_{1} = 0.096 \\ \\mathrm{cm}^{-1} $$\n\nThe slope, $m$, is defined as the change in $\\mu_{511}$ divided by the change in $\\mathrm{HU}$:\n$$ m = \\frac{\\Delta\\mu_{511}}{\\Delta\\mathrm{HU}} = \\frac{\\mu_2 - \\mu_1}{\\mathrm{HU}_2 - \\mathrm{HU}_1} $$\nSubstituting the given values:\n$$ m = \\frac{0.172 \\ \\mathrm{cm}^{-1} - 0.096 \\ \\mathrm{cm}^{-1}}{1000 - 0} = \\frac{0.076}{1000} \\ \\mathrm{cm}^{-1} = 0.000076 \\ \\mathrm{cm}^{-1} $$\n\nThus, the explicit linear scaling function for $\\mathrm{HU} \\ge 0$ is:\n$$ \\mu_{511}(\\mathrm{HU}) = (0.000076) \\cdot \\mathrm{HU} + 0.096 \\quad [\\text{in units of } \\mathrm{cm}^{-1}] $$\n\nThe problem then asks for the computation of $\\mu_{511}$ for two specific $\\mathrm{HU}$ values.\n\nFirst, for a voxel with $\\mathrm{HU} = 1000$:\n$$ \\mu_{511}(1000) = (0.000076) \\cdot 1000 + 0.096 $$\n$$ \\mu_{511}(1000) = 0.076 + 0.096 = 0.172 \\ \\mathrm{cm}^{-1} $$\nThis result is, by the definition of our linear interpolation, identical to the given linear attenuation coefficient for cortical bone.\n\nSecond, for a voxel with $\\mathrm{HU} = 0$:\n$$ \\mu_{511}(0) = (0.000076) \\cdot 0 + 0.096 $$\n$$ \\mu_{511}(0) = 0.096 \\ \\mathrm{cm}^{-1} $$\nThis result is, by definition, identical to the given linear attenuation coefficient for water.\n\nThe problem asks for the values of $\\mu_{511}$ for a voxel with $\\mathrm{HU} = 1000$ and another voxel with $\\mathrm{HU} = 0$. These values are the anchor points themselves.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.172 & 0.096 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Accuracy in the attenuation map is not just an academic concern; it directly impacts clinical measurements. This exercise demonstrates how a seemingly small, uniform error in the estimated attenuation coefficient propagates through the reconstruction process to create a significant error in the final Standardized Uptake Value (SUV). Working through this scenario will build an intuition for the sensitivity of quantitative PET and the importance of precise attenuation correction. ",
            "id": "4875063",
            "problem": "A Positron Emission Tomography (PET) brain study uses Computed Tomography (CT)-based attenuation correction by scaling a $511\\,\\mathrm{keV}$ attenuation map. Let the true linear attenuation coefficient at $511\\,\\mathrm{keV}$ be $\\mu_{\\text{true}}=0.096\\,\\mathrm{cm}^{-1}$ for cranial soft tissue. Assume a representative line of response traverses a chord length of $L=16\\,\\mathrm{cm}$ through the head. Due to an error in CT-to-$511\\,\\mathrm{keV}$ scaling, the estimated attenuation coefficient is uniformly biased low by $5\\%$, so that $\\mu_{\\text{est}}=0.95\\,\\mu_{\\text{true}}$ everywhere.\n\nStarting from the Beer–Lambert law for photon transmission, which states that the transmission factor along a uniform path of length $L$ with linear attenuation coefficient $\\mu$ is $T=\\exp(-\\mu L)$, and using the standard PET attenuation correction procedure that multiplies measured counts by the inverse of the estimated transmission along each line of response, derive the fractional error in the reconstructed Standardized Uptake Value (SUV) for this line of response. Express the final fractional error (for example, $0.12$ for twelve percent) as a unitless decimal. Round your answer to four significant figures.",
            "solution": "The problem asks for the fractional error in the Standardized Uptake Value (SUV) resulting from a systematic error in the estimated attenuation coefficient. The solution proceeds by first establishing the relationship between the measured counts, the corrected counts, and the SUV.\n\nLet $A_{\\text{true}}$ be the true radioactivity concentration along the line of response (LOR). The number of detected photon pairs, or measured counts ($C_{\\text{meas}}$), is proportional to the true activity that survives attenuation. According to the Beer-Lambert law, the fraction of photons that are transmitted without interaction is given by the transmission factor $T$. Therefore, the measured counts are related to the true activity by:\n$$C_{\\text{meas}} \\propto A_{\\text{true}} \\cdot T_{\\text{true}}$$\nwhere $T_{\\text{true}}$ is the true transmission factor, calculated using the true linear attenuation coefficient $\\mu_{\\text{true}}$.\n$$T_{\\text{true}} = \\exp(-\\mu_{\\text{true}} L)$$\n\nThe purpose of attenuation correction is to estimate the true activity by compensating for photon loss. This is done by dividing the measured counts by an *estimated* transmission factor, $T_{\\text{est}}$, to obtain the attenuation-corrected counts, $C_{\\text{corr}}$.\n$$C_{\\text{corr}} = \\frac{C_{\\text{meas}}}{T_{\\text{est}}}$$\nThe estimated transmission factor is calculated using the biased attenuation coefficient, $\\mu_{\\text{est}}$:\n$$T_{\\text{est}} = \\exp(-\\mu_{\\text{est}} L)$$\nThe Standardized Uptake Value (SUV) is a quantitative measure derived from the reconstructed PET image. The image intensity in a voxel is directly proportional to the estimated activity concentration in that voxel, which in turn is directly proportional to the attenuation-corrected counts for the LORs passing through it. Thus, we have the relationship:\n$$SUV \\propto C_{\\text{corr}}$$\nLet's denote the estimated SUV as $SUV_{\\text{est}}$. It is proportional to the calculated corrected counts:\n$$SUV_{\\text{est}} \\propto C_{\\text{corr}} = \\frac{C_{\\text{meas}}}{T_{\\text{est}}}$$\nAn ideal, or true, SUV ($SUV_{\\text{true}}$) would be obtained if the attenuation correction were perfect, i.e., if $T_{\\text{est}} = T_{\\text{true}}$.\n$$SUV_{\\text{true}} \\propto \\frac{C_{\\text{meas}}}{T_{\\text{true}}}$$\nThe fractional error in the SUV is defined as $\\frac{SUV_{\\text{est}} - SUV_{\\text{true}}}{SUV_{\\text{true}}}$. Using the proportionalities above, the constant of proportionality cancels out:\n$$\\text{Fractional Error} = \\frac{\\frac{C_{\\text{meas}}}{T_{\\text{est}}} - \\frac{C_{\\text{meas}}}{T_{\\text{true}}}}{\\frac{C_{\\text{meas}}}{T_{\\text{true}}}} = \\frac{\\frac{1}{T_{\\text{est}}} - \\frac{1}{T_{\\text{true}}}}{\\frac{1}{T_{\\text{true}}}} = \\frac{T_{\\text{true}}}{T_{\\text{est}}} - 1$$\nNow, we substitute the exponential forms of the transmission factors into this expression:\n$$\\text{Fractional Error} = \\frac{\\exp(-\\mu_{\\text{true}} L)}{\\exp(-\\mu_{\\text{est}} L)} - 1 = \\exp(-\\mu_{\\text{true}} L - (-\\mu_{\\text{est}} L)) - 1 = \\exp((\\mu_{\\text{est}} - \\mu_{\\text{true}}) L) - 1$$\nThe problem states that the estimated attenuation coefficient is uniformly biased low by $5\\%$, so $\\mu_{\\text{est}} = 0.95\\,\\mu_{\\text{true}}$. Substituting this into the error expression gives:\n$$\\text{Fractional Error} = \\exp((0.95\\,\\mu_{\\text{true}} - \\mu_{\\text{true}}) L) - 1 = \\exp(-0.05\\,\\mu_{\\text{true}} L) - 1$$\nWe are given the values $\\mu_{\\text{true}} = 0.096\\,\\mathrm{cm}^{-1}$ and $L = 16\\,\\mathrm{cm}$. We can now calculate the numerical value of the fractional error. First, we compute the exponent:\n$$\\text{Exponent} = -0.05 \\times 0.096\\,\\mathrm{cm}^{-1} \\times 16\\,\\mathrm{cm} = -0.0768$$\nThe fractional error is therefore:\n$$\\text{Fractional Error} = \\exp(-0.0768) - 1$$\nCalculating the value:\n$$\\exp(-0.0768) \\approx 0.92606500$$\n$$\\text{Fractional Error} \\approx 0.92606500 - 1 = -0.07393499$$\nThe problem requires the answer to be rounded to four significant figures.\n$$\\text{Fractional Error} \\approx -0.07393$$\nThe negative sign indicates that the underestimation of the attenuation coefficient leads to an underestimation of the reconstructed SUV.",
            "answer": "$$\\boxed{-0.07393}$$"
        },
        {
            "introduction": "The simple conversion methods used for attenuation correction can fail when unexpected materials are present. This practice explores a critical real-world challenge: the presence of iodinated contrast media from a contrast-enhanced CT scan. You will investigate the underlying physics to understand why these agents cause an overestimation of attenuation at PET energies, leading to significant artifacts and quantitative errors if not properly addressed. ",
            "id": "4875100",
            "problem": "A positron emission tomography (PET) system uses a computed tomography (CT)-derived attenuation map for attenuation correction. Consider a contrast-filled vessel whose CT voxel value is elevated due to iodinated contrast. You will quantify the resulting attenuation correction bias by first estimating the overestimation of the $511\\,\\mathrm{keV}$ linear attenuation coefficient $\\mu_{511}$ and then computing the multiplicative inflation of the attenuation correction factor for a line of response.\n\nAssume the following scientifically standard basis and facts:\n- At $511\\,\\mathrm{keV}$, photon attenuation in biological materials and solutions is dominated by Compton scattering, so the linear attenuation coefficient is proportional to the electron density, $\\mu_{511} \\propto \\rho_{e}$, where $\\rho_{e} = N_{A}\\,\\rho\\,(Z/A)$, $\\rho$ is the mass density, $Z/A$ is the mean atomic number-to-mass ratio, and $N_{A}$ is Avogadro’s number.\n- The Beer–Lambert law applies to PET photons: for a line of response (LOR), the attenuation correction factor (ACF) is $ACF = \\exp\\!\\left(\\int \\mu_{511}(s)\\,ds\\right)$.\n- Hounsfield Units (HU) are defined at diagnostic CT energies by $HU = 1000\\left(\\frac{\\mu_{\\mathrm{CT}} - \\mu_{\\mathrm{CT,w}}}{\\mu_{\\mathrm{CT,w}}}\\right)$, and clinical CT-based attenuation correction methods often assume a linear mapping from measured HU to relative electron density (referenced to water), and then to $\\mu_{511}$ (referenced to water).\n\nData for this scenario:\n- The vessel voxel measured on CT has $HU = 800$.\n- The contrast solution in the vessel has mass density $\\rho_{s} = 1.35\\,\\mathrm{g/cm^{3}}$ and mean ratio $(Z/A)_{s} = 0.50$.\n- Water has $\\rho_{w} = 1.00\\,\\mathrm{g/cm^{3}}$ and $(Z/A)_{w} = \\frac{10}{18}$.\n- The linear attenuation coefficient of water at $511\\,\\mathrm{keV}$ is $\\mu_{w,511} = 0.096\\,\\mathrm{cm^{-1}}$.\n- Consider an LOR that intersects the vessel over a chord of length $L = 2.0\\,\\mathrm{cm}$. Outside the vessel segment, materials along the LOR are identical in the true and CT-estimated maps.\n\nTasks:\n1. Using the electron density proportionality at $511\\,\\mathrm{keV}$, compute the true $\\mu_{511}$ of the contrast solution, $\\mu_{511}^{\\mathrm{true}}$, by forming the electron density ratio relative to water and applying it to $\\mu_{w,511}$.\n2. Using a linear HU-to-electron-density mapping referenced to water, and then to $\\mu_{511}$ referenced to water, compute the CT-estimated $\\mu_{511}$, denoted $\\mu_{511}^{\\mathrm{est}}$.\n3. Compute the overestimation $\\Delta \\mu_{511} = \\mu_{511}^{\\mathrm{est}} - \\mu_{511}^{\\mathrm{true}}$ in $\\mathrm{cm^{-1}}$.\n4. Using the Beer–Lambert law, compute the multiplicative inflation of the attenuation correction factor for the given LOR segment, $ACF^{\\mathrm{est}}/ACF^{\\mathrm{true}}$.\n\nProvide the final two numbers in a single row matrix in the order $\\Delta \\mu_{511}$, $ACF^{\\mathrm{est}}/ACF^{\\mathrm{true}}$. Round both numbers to four significant figures. Express $\\Delta \\mu_{511}$ in $\\mathrm{cm^{-1}}$, and express the $ACF$ inflation as a unitless ratio.",
            "solution": "The problem requires a four-part calculation to quantify the bias in PET attenuation correction arising from iodinated contrast agents measured on CT.\n\n**1. Computation of the True Linear Attenuation Coefficient ($\\mu_{511}^{\\mathrm{true}}$)**\n\nAt $511\\,\\mathrm{keV}$, the linear attenuation coefficient $\\mu_{511}$ is proportional to the electron density $\\rho_{e}$. The electron density is given by $\\rho_{e} = N_{A}\\,\\rho\\,(Z/A)$. Since Avogadro's number $N_A$ is a constant, we can state the proportionality as $\\mu_{511} \\propto \\rho\\,(Z/A)$.\n\nThis allows us to find the true attenuation coefficient of the contrast solution, $\\mu_{511}^{\\mathrm{true}}$, by setting up a ratio with the known properties of water:\n$$ \\frac{\\mu_{511}^{\\mathrm{true}}}{\\mu_{w,511}} = \\frac{\\rho_{s} (Z/A)_{s}}{\\rho_{w} (Z/A)_{w}} $$\nSolving for $\\mu_{511}^{\\mathrm{true}}$:\n$$ \\mu_{511}^{\\mathrm{true}} = \\mu_{w,511} \\times \\frac{\\rho_{s} (Z/A)_{s}}{\\rho_{w} (Z/A)_{w}} $$\nSubstituting the given values:\n$$ \\mu_{511}^{\\mathrm{true}} = 0.096\\,\\mathrm{cm^{-1}} \\times \\frac{(1.35\\,\\mathrm{g/cm^{3}}) \\times (0.50)}{(1.00\\,\\mathrm{g/cm^{3}}) \\times (\\frac{10}{18})} $$\n$$ \\mu_{511}^{\\mathrm{true}} = 0.096 \\times \\frac{0.675}{5/9} = 0.096 \\times \\frac{0.675 \\times 18}{10} = 0.096 \\times 1.215 $$\n$$ \\mu_{511}^{\\mathrm{true}} = 0.11664\\,\\mathrm{cm^{-1}} $$\n\n**2. Computation of the CT-Estimated Linear Attenuation Coefficient ($\\mu_{511}^{\\mathrm{est}}$)**\n\nThe clinical method assumes a linear mapping from Hounsfield Units ($HU$) to the relative electron density (with respect to water), $\\rho_{e, \\mathrm{rel}} = \\rho_e / \\rho_{e,w}$. The anchor points for this linear map are typically air ($HU = -1000$, $\\rho_{e, \\mathrm{rel}} \\approx 0$) and water ($HU = 0$, $\\rho_{e, \\mathrm{rel}} = 1$). The resulting linear relationship is:\n$$ \\rho_{e, \\mathrm{rel}} = 1 + \\frac{HU}{1000} $$\nFor the voxel in question with $HU = 800$, the estimated relative electron density is:\n$$ \\rho_{e, \\mathrm{rel}}^{\\mathrm{est}} = 1 + \\frac{800}{1000} = 1 + 0.8 = 1.8 $$\nThis method then maps the estimated relative electron density to the attenuation coefficient at $511\\,\\mathrm{keV}$. Since $\\mu_{511} \\propto \\rho_e$, it follows that $\\mu_{511} / \\mu_{w,511} = \\rho_e / \\rho_{e,w} = \\rho_{e, \\mathrm{rel}}$. Therefore, the estimated attenuation coefficient is:\n$$ \\mu_{511}^{\\mathrm{est}} = \\mu_{w,511} \\times \\rho_{e, \\mathrm{rel}}^{\\mathrm{est}} $$\nSubstituting the values:\n$$ \\mu_{511}^{\\mathrm{est}} = 0.096\\,\\mathrm{cm^{-1}} \\times 1.8 = 0.1728\\,\\mathrm{cm^{-1}} $$\nThis overestimation occurs because the high HU value is driven by the high atomic number of iodine causing strong photoelectric absorption at CT energies, which the linear model incorrectly interprets as a very high electron density.\n\n**3. Computation of the Overestimation ($\\Delta \\mu_{511}$)**\n\nThe overestimation is the difference between the estimated and true values:\n$$ \\Delta \\mu_{511} = \\mu_{511}^{\\mathrm{est}} - \\mu_{511}^{\\mathrm{true}} $$\n$$ \\Delta \\mu_{511} = 0.1728\\,\\mathrm{cm^{-1}} - 0.11664\\,\\mathrm{cm^{-1}} = 0.05616\\,\\mathrm{cm^{-1}} $$\nRounding to four significant figures, $\\Delta \\mu_{511} = 0.05616\\,\\mathrm{cm^{-1}}$.\n\n**4. Computation of the ACF Inflation Ratio**\n\nThe attenuation correction factor for a line of response is $ACF = \\exp\\left(\\int_{LOR} \\mu_{511}(s)\\,ds\\right)$. Let the LOR path be separated into the segment of length $L$ that passes through the vessel and the path outside the vessel.\n$$ \\int_{LOR} \\mu_{511}(s)\\,ds = \\int_{\\text{vessel}} \\mu_{511}(s)\\,ds + \\int_{\\text{outside}} \\mu_{511}(s)\\,ds $$\nAssuming the attenuation coefficient is constant within the vessel segment, this becomes:\n$$ \\int_{LOR} \\mu_{511}(s)\\,ds = \\mu_{511,\\text{vessel}} \\cdot L + \\int_{\\text{outside}} \\mu_{511}(s)\\,ds $$\nLet $I_{\\text{out}} = \\int_{\\text{outside}} \\mu_{511}(s)\\,ds$. The problem states that the materials outside the vessel are identical for the true and estimated maps, so $I_{\\text{out}}$ is the same for both calculations.\nThe true ACF is:\n$$ ACF^{\\mathrm{true}} = \\exp\\left(\\mu_{511}^{\\mathrm{true}} \\cdot L + I_{\\text{out}}\\right) $$\nThe estimated ACF is:\n$$ ACF^{\\mathrm{est}} = \\exp\\left(\\mu_{511}^{\\mathrm{est}} \\cdot L + I_{\\text{out}}\\right) $$\nThe multiplicative inflation is the ratio of these two factors:\n$$ \\frac{ACF^{\\mathrm{est}}}{ACF^{\\mathrm{true}}} = \\frac{\\exp\\left(\\mu_{511}^{\\mathrm{est}} \\cdot L + I_{\\text{out}}\\right)}{\\exp\\left(\\mu_{511}^{\\mathrm{true}} \\cdot L + I_{\\text{out}}\\right)} = \\frac{\\exp\\left(\\mu_{511}^{\\mathrm{est}} \\cdot L\\right) \\exp\\left(I_{\\text{out}}\\right)}{\\exp\\left(\\mu_{511}^{\\mathrm{true}} \\cdot L\\right) \\exp\\left(I_{\\text{out}}\\right)} $$\n$$ \\frac{ACF^{\\mathrm{est}}}{ACF^{\\mathrm{true}}} = \\exp\\left(\\left(\\mu_{511}^{\\mathrm{est}} - \\mu_{511}^{\\mathrm{true}}\\right) \\cdot L\\right) = \\exp\\left(\\Delta \\mu_{511} \\cdot L\\right) $$\nSubstituting the values for $\\Delta \\mu_{511}$ and $L$:\n$$ \\frac{ACF^{\\mathrm{est}}}{ACF^{\\mathrm{true}}} = \\exp\\left( (0.05616\\,\\mathrm{cm^{-1}}) \\times (2.0\\,\\mathrm{cm}) \\right) = \\exp(0.11232) $$\n$$ \\frac{ACF^{\\mathrm{est}}}{ACF^{\\mathrm{true}}} \\approx 1.118873 $$\nRounding to four significant figures, the ratio is $1.119$.\n\nThe final results are the overestimation of the linear attenuation coefficient, $\\Delta \\mu_{511} = 0.05616\\,\\mathrm{cm^{-1}}$, and the multiplicative inflation of the attenuation correction factor, $1.119$.",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.05616 & 1.119 \\end{pmatrix}}$$"
        }
    ]
}