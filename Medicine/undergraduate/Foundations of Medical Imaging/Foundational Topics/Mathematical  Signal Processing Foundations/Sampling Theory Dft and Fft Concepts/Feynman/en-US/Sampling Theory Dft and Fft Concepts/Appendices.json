{
    "hands_on_practices": [
        {
            "introduction": "In medical imaging, signals are often acquired at high radio frequencies but must be converted to a lower \"baseband\" frequency for digital processing. This practice explores In-phase/Quadrature (I/Q) demodulation, a cornerstone technique for this conversion. By comparing real and complex demodulation both theoretically and through code , you will understand how to prevent image band ambiguity and faithfully preserve the signal's crucial frequency information.",
            "id": "4920811",
            "problem": "Consider a real-valued, bandlimited radio-frequency signal used in Magnetic Resonance Imaging (MRI) receive chains modeled as a sum of narrowband sinusoids around a carrier (local oscillator) frequency. Let the continuous-time signal be $x(t)$, and let the local oscillator frequency be $f_{\\mathrm{LO}}$ in hertz. You will analyze the effect of multiplying $x(t)$ by a real sinusoid versus a complex exponential, and then implement the corresponding discrete-time In-phase/Quadrature (I/Q) demodulation model.\n\nFundamental base:\n- Use the definition of the Fourier transform $X(f)$ of $x(t)$, where $f$ is in hertz.\n- Use the modulation property stating that multiplication in time corresponds to a frequency shift in the Fourier domain.\n- Use the properties of real signals having conjugate-symmetric spectra and the relationship between complex exponentials and sinusoids.\n\nTasks:\n1. Starting from the Fourier transform definition and the modulation property, derive how multiplying $x(t)$ by a real sinusoid $\\cos(2\\pi f_{\\mathrm{LO}} t)$ produces baseband components from both $X(f_{\\mathrm{LO}}+\\Delta f)$ and $X(f_{\\mathrm{LO}}-\\Delta f)$, thereby causing image band ambiguity. Then, derive how multiplying $x(t)$ by the complex exponential $\\mathrm{e}^{-j 2\\pi f_{\\mathrm{LO}} t}$ produces a single, sign-preserving shift that maps $X(f_{\\mathrm{LO}}+\\Delta f)$ to $X(\\Delta f)$ and $X(f_{\\mathrm{LO}}-\\Delta f)$ to $X(-\\Delta f)$ without merging them.\n2. Formulate the discrete-time I/Q demodulation model sampled at rate $f_s$ hertz. Let $x[n] = x(n/f_s)$ for integer $n$, $0 \\le n \\le N-1$. Define the discrete-time I/Q components\n   - $I[n] = 2\\,x[n]\\cos\\!\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right)$,\n   - $Q[n] = -2\\,x[n]\\sin\\!\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right)$,\n   and the complex baseband $y[n] = I[n] + j\\,Q[n]$. Explain how ideal low-pass filtering of $y[n]$ in the frequency domain with a symmetric passband of width greater than the expected baseband offsets implements a baseband-preserving, image-eliminating demodulator. The filter must pass all $|\\Delta f|$ of interest and reject components near $2 f_{\\mathrm{LO}}$.\n3. Implement a program that:\n   - Generates discrete-time test signals as sums of cosines at specified radio-frequency tones.\n   - Performs both real demodulation (multiplication by $2\\cos(2\\pi f_{\\mathrm{LO}} n/f_s)$) and complex I/Q demodulation (forming $y[n]$ as above).\n   - Applies an ideal symmetric low-pass filter in the Discrete Fourier Transform (DFT) domain by zeroing out bins outside a specified cutoff frequency (in hertz).\n   - Computes the Fast Fourier Transform (FFT) of the demodulated-and-filtered signals and measures the magnitudes at $\\pm \\Delta f$ to form simple, quantitative tests of sign preservation and image-band elimination.\n\nAngle units and physical units:\n- All frequencies $f$, $f_{\\mathrm{LO}}$, $f_s$, and $\\Delta f$ are specified in hertz.\n- All time samples $n$ are unitless indices that implicitly correspond to seconds via $n/f_s$.\n- Angles in sinusoids are in radians.\n\nTest suite:\n- Use the following three cases. In each case, $f_s$ and $N$ define the sampling setup, $f_{\\mathrm{LO}}$ defines the carrier, and $x[n]$ is constructed as a sum of one or more cosines. Frequencies are exact DFT bin centers so there is no spectral leakage in ideal arithmetic.\n  1. Case $1$ (upper sideband tone):\n     - $f_s = 4096$,\n     - $N = 4096$,\n     - $f_{\\mathrm{LO}} = 1024$,\n     - single tone at $f = f_{\\mathrm{LO}} + \\Delta f$ with $\\Delta f = 128$ (i.e., $f = 1152$ hertz).\n  2. Case $2$ (lower sideband tone):\n     - $f_s = 4096$,\n     - $N = 4096$,\n     - $f_{\\mathrm{LO}} = 1024$,\n     - single tone at $f = f_{\\mathrm{LO}} - \\Delta f$ with $\\Delta f = 128$ (i.e., $f = 896$ hertz).\n  3. Case $3$ (near-Nyquist upper sideband tone):\n     - $f_s = 4096$,\n     - $N = 4096$,\n     - $f_{\\mathrm{LO}} = 1984$,\n     - single tone at $f = f_{\\mathrm{LO}} + \\Delta f$ with $\\Delta f = 32$ (i.e., $f = 2016$ hertz).\n\nCutoff selection rule:\n- For each case, set the ideal low-pass cutoff to $f_c = \\max(\\Delta f) + 10$ hertz, expressed explicitly in hertz.\n\nPer-case evaluation metrics:\n- For complex I/Q demodulation, define the sign-preservation ratio\n  - $R_{\\mathrm{c}}^{(+)} = \\dfrac{|Y(\\Delta f)|}{|Y(-\\Delta f)|}$ when the input tone is at $f_{\\mathrm{LO}}+\\Delta f$,\n  - $R_{\\mathrm{c}}^{(-)} = \\dfrac{|Y(-\\Delta f)|}{|Y(\\Delta f)|}$ when the input tone is at $f_{\\mathrm{LO}}-\\Delta f$,\n  where $Y(\\cdot)$ denotes the magnitude at the indicated baseband frequency bin after complex demodulation and low-pass filtering.\n- For real demodulation, define the symmetry ratio\n  - $R_{\\mathrm{r}} = \\dfrac{|Z(\\Delta f)|}{|Z(-\\Delta f)|}$,\n  where $Z(\\cdot)$ denotes the magnitude at the indicated baseband frequency bin after real demodulation and low-pass filtering.\n\nDecision rules:\n- Declare “sign preserved” for complex demodulation if the relevant $R_{\\mathrm{c}}^{(+)}$ or $R_{\\mathrm{c}}^{(-)}$ exceeds $100$.\n- Declare “image eliminated versus real mixing” if the complex-demodulation ratio exceeds $100$ while the real-demodulation symmetry ratio satisfies $0.9 \\le R_{\\mathrm{r}} \\le 1.1$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a Python list of three per-case lists, each per-case list containing two booleans in the order $[\\text{sign\\_preserved}, \\text{image\\_eliminated}]$. For example, the output should look like\n  - $[[\\text{True},\\text{True}],[\\text{True},\\text{True}],[\\text{True},\\text{True}]]$.",
            "solution": "## Problem Validation\n\n### Step 1: Extract Givens\n- **Signal Model**: A real-valued, bandlimited radio-frequency signal $x(t)$ modeled as a sum of narrowband sinusoids around a carrier frequency $f_{\\mathrm{LO}}$.\n- **Fourier Transform**: $X(f)$ is the Fourier transform of $x(t)$.\n- **Modulation Property**: Multiplication in time corresponds to convolution in frequency.\n- **Signal Property**: Real signals have conjugate-symmetric spectra.\n- **Task 1 (Theory)**:\n  - Derive how multiplying $x(t)$ by $\\cos(2\\pi f_{\\mathrm{LO}} t)$ leads to image band ambiguity.\n  - Derive how multiplying $x(t)$ by $\\mathrm{e}^{-j 2\\pi f_{\\mathrm{LO}} t}$ preserves the sign of frequency offsets and avoids ambiguity.\n- **Task 2 (Discrete Model)**:\n  - Sampled signal: $x[n] = x(n/f_s)$ for $0 \\le n \\le N-1$.\n  - I/Q components: $I[n] = 2\\,x[n]\\cos(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n)$, $Q[n] = -2\\,x[n]\\sin(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n)$.\n  - Complex baseband: $y[n] = I[n] + j\\,Q[n]$.\n  - Explain how ideal low-pass filtering of $y[n]$ in the frequency domain achieves image rejection.\n- **Task 3 (Implementation)**:\n  - Implement a program to test real and complex demodulation with specified test signals.\n  - Apply an ideal symmetric low-pass filter in the DFT domain by zeroing out bins.\n  - Compute FFTs and measure magnitudes to test sign preservation and image elimination.\n- **Units**: Frequencies in hertz (Hz), time samples $n$ are unitless indices, angles in radians.\n- **Test Suite**:\n  - Case 1: $f_s = 4096$, $N = 4096$, $f_{\\mathrm{LO}} = 1024$, tone at $f = f_{\\mathrm{LO}} + \\Delta f = 1152$ Hz (so $\\Delta f = 128$ Hz).\n  - Case 2: $f_s = 4096$, $N = 4096$, $f_{\\mathrm{LO}} = 1024$, tone at $f = f_{\\mathrm{LO}} - \\Delta f = 896$ Hz (so $\\Delta f = 128$ Hz).\n  - Case 3: $f_s = 4096$, $N = 4096$, $f_{\\mathrm{LO}} = 1984$, tone at $f = f_{\\mathrm{LO}} + \\Delta f = 2016$ Hz (so $\\Delta f = 32$ Hz).\n- **Filter Rule**: Low-pass cutoff $f_c = \\max(\\Delta f) + 10$ hertz.\n- **Evaluation Metrics**:\n  - Complex demodulation sign-preservation ratios: $R_{\\mathrm{c}}^{(+)} = \\frac{|Y(\\Delta f)|}{|Y(-\\Delta f)|}$ for upper sideband, $R_{\\mathrm{c}}^{(-)} = \\frac{|Y(-\\Delta f)|}{|Y(\\Delta f)|}$ for lower sideband.\n  - Real demodulation symmetry ratio: $R_{\\mathrm{r}} = \\frac{|Z(\\Delta f)|}{|Z(-\\Delta f)|}$.\n- **Decision Rules**:\n  - Sign preserved if $R_{\\mathrm{c}} > 100$.\n  - Image eliminated if $R_{\\mathrm{c}} > 100$ and $0.9 \\le R_{\\mathrm{r}} \\le 1.1$.\n- **Output Format**: A Python list of lists of booleans, e.g., `[[True,True],[True,True],[True,True]]`.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the fundamental principles of signal processing, specifically Fourier analysis and digital demodulation techniques, which are core to MRI and many other fields. It is well-posed, with all necessary parameters ($f_s, N, f_{\\mathrm{LO}}$, signal definitions) and evaluation criteria provided, ensuring a unique and verifiable solution. The language is objective and precise. The tasks progress logically from theory to implementation. The provided test cases are physically plausible and computationally tractable. The problem is a standard, well-formulated exercise in DSP, free of any of the invalidity flaws listed in the instructions.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. Proceeding to the solution.\n\n## Theoretical Foundation and Implementation Strategy\n\nThe process of demodulation is central to radio-frequency (RF) systems like MRI, where it is used to shift a high-frequency signal to a lower-frequency baseband for digitization and analysis. This solution first derives the theoretical differences between real and complex demodulation and then outlines the implementation of a numerical experiment to verify these principles.\n\n### Part 1: Analysis of Demodulation Schemes in the Continuous-Time Domain\n\nWe begin by analyzing the effect of mixing the input signal $x(t)$ with a local oscillator (LO) signal in the frequency domain. The core mathematical tool is the modulation property of the Fourier Transform, which states that multiplication in the time domain is equivalent to convolution in the frequency domain: $\\mathcal{F}\\{s_1(t) s_2(t)\\} = S_1(f) * S_2(f)$, where $S_1(f)$ and $S_2(f)$ are the Fourier transforms of $s_1(t)$ and $s_2(t)$, respectively, and `$*$` denotes convolution.\n\nLet the real-valued input signal $x(t)$ have a Fourier transform $X(f)$. Since $x(t)$ is real, its spectrum exhibits conjugate symmetry: $X(-f) = X^*(f)$. Let us consider an input signal that is a single tone at a frequency $f_{in}$ offset from the LO frequency $f_{\\mathrm{LO}}$ by $\\Delta f$, such that $f_{in} = f_{\\mathrm{LO}} + \\Delta f$. The signal is $x(t) = A\\cos(2\\pi f_{in} t)$. Its Fourier transform is $X(f) = \\frac{A}{2} [ \\delta(f - f_{in}) + \\delta(f + f_{in}) ]$.\n\n**1. Real Demodulation (Mixing with a Cosine)**\n\nIn real demodulation, a single mixer multiplies the input signal $x(t)$ by a real sinusoid from the LO, $s_{LO}(t) = \\cos(2\\pi f_{\\mathrm{LO}} t)$. The Fourier transform of the LO signal is $\\mathcal{F}\\{s_{LO}(t)\\} = \\frac{1}{2} [ \\delta(f - f_{\\mathrm{LO}}) + \\delta(f + f_{\\mathrm{LO}}) ]$.\n\nThe demodulated signal is $z(t) = x(t) \\cos(2\\pi f_{\\mathrm{LO}} t)$. Its spectrum $Z(f)$ is:\n$$Z(f) = X(f) * \\left( \\frac{1}{2} [ \\delta(f - f_{\\mathrm{LO}}) + \\delta(f + f_{\\mathrm{LO}}) ] \\right)$$\n$$Z(f) = \\frac{1}{2} [ X(f - f_{\\mathrm{LO}}) + X(f + f_{\\mathrm{LO}}) ]$$\nThis operation shifts the spectrum of $x(t)$ by $\\pm f_{\\mathrm{LO}}$ and halves its amplitude. Let's analyze the effect on two different input tones:\n- **Upper Sideband (USB) Tone**: $f_{in} = f_{\\mathrm{LO}} + \\Delta f$, with $\\Delta f > 0$. The input spectrum $X(f)$ has peaks at $\\pm(f_{\\mathrm{LO}} + \\Delta f)$. The spectrum $Z(f)$ will have peaks resulting from shifting these two delta functions:\n  $$Z(f) \\propto [ \\delta(f - (f_{\\mathrm{LO}}+\\Delta f) - f_{\\mathrm{LO}}) + \\delta(f + (f_{\\mathrm{LO}}+\\Delta f) - f_{\\mathrm{LO}}) ] + [ \\delta(f - (f_{\\mathrm{LO}}+\\Delta f) + f_{\\mathrm{LO}}) + \\delta(f + (f_{\\mathrm{LO}}+\\Delta f) + f_{\\mathrm{LO}}) ]$$\n  $$Z(f) \\propto \\delta(f - (2f_{\\mathrm{LO}}+\\Delta f)) + \\delta(f + \\Delta f) + \\delta(f - \\Delta f) + \\delta(f + (2f_{\\mathrm{LO}}+\\Delta f))$$\n  After applying an ideal low-pass filter (LPF) that passes frequencies $|f| < f_c$ where $|\\Delta f| < f_c \\ll 2f_{\\mathrm{LO}}$, only the components at $\\pm\\Delta f$ remain.\n- **Lower Sideband (LSB) Tone**: $f_{in} = f_{\\mathrm{LO}} - \\Delta f$, with $\\Delta f > 0$. The input spectrum $X(f)$ has peaks at $\\pm(f_{\\mathrm{LO}} - \\Delta f)$. The spectrum $Z(f)$ will have peaks at:\n  $$Z(f) \\propto [ \\delta(f - (f_{\\mathrm{LO}}-\\Delta f) - f_{\\mathrm{LO}}) + \\delta(f + (f_{\\mathrm{LO}}-\\Delta f) - f_{\\mathrm{LO}}) ] + [ \\delta(f - (f_{\\mathrm{LO}}-\\Delta f) + f_{\\mathrm{LO}}) + \\delta(f + (f_{\\mathrm{LO}}-\\Delta f) + f_{\\mathrm{LO}}) ]$$\n  $$Z(f) \\propto \\delta(f - (2f_{\\mathrm{LO}}-\\Delta f)) + \\delta(f + (-\\Delta f)) + \\delta(f - (-\\Delta f)) + \\delta(f + (2f_{\\mathrm{LO}}-\\Delta f))$$\n  After the same LPF, components at $\\pm\\Delta f$ remain.\n\nIn both cases, the post-LPF spectrum has identical peaks at $\\pm\\Delta f$. It is impossible to distinguish whether the original RF tone was at $f_{\\mathrm{LO}} + \\Delta f$ or $f_{\\mathrm{LO}} - \\Delta f$. This is the **image band ambiguity**.\n\n**2. Complex Demodulation (Mixing with a Complex Exponential)**\n\n In-phase/Quadrature (I/Q) demodulation is equivalent to mixing with a complex exponential. Let the LO signal be $s_{LO,c}(t) = \\mathrm{e}^{-j 2\\pi f_{\\mathrm{LO}} t}$. Its Fourier transform is $\\mathcal{F}\\{s_{LO,c}(t)\\} = \\delta(f + f_{\\mathrm{LO}})$.\n\nThe complex demodulated signal is $y(t) = x(t) \\mathrm{e}^{-j 2\\pi f_{\\mathrm{LO}} t}$. Its spectrum $Y(f)$ is:\n$$Y(f) = X(f) * \\delta(f + f_{\\mathrm{LO}}) = X(f + f_{\\mathrm{LO}})$$\nThis is a pure frequency shift of the entire spectrum of $x(t)$ to the left by $f_{\\mathrm{LO}}$.\n- **Upper Sideband (USB) Tone**: $f_{in} = f_{\\mathrm{LO}} + \\Delta f$. $X(f)$ has peaks at $\\pm(f_{\\mathrm{LO}} + \\Delta f)$. The shifted spectrum $Y(f)$ has peaks at:\n  - $(f_{\\mathrm{LO}} + \\Delta f) - f_{\\mathrm{LO}} = +\\Delta f$\n  - $-(f_{\\mathrm{LO}} + \\Delta f) - f_{\\mathrm{LO}} = -2f_{\\mathrm{LO}} - \\Delta f$\n  An LPF passes the $+\\Delta f$ component and rejects the high-frequency component at $-2f_{\\mathrm{LO}} - \\Delta f$. The resulting baseband spectrum is single-sided (at positive frequencies).\n- **Lower Sideband (LSB) Tone**: $f_{in} = f_{\\mathrm{LO}} - \\Delta f$. $X(f)$ has peaks at $\\pm(f_{\\mathrm{LO}} - \\Delta f)$. The shifted spectrum $Y(f)$ has peaks at:\n  - $(f_{\\mathrm{LO}} - \\Delta f) - f_{\\mathrm{LO}} = -\\Delta f$\n  - $-(f_{\\mathrm{LO}} - \\Delta f) - f_{\\mathrm{LO}} = -2f_{\\mathrm{LO}} + \\Delta f$\n  An LPF passes the $-\\Delta f$ component and rejects the high-frequency component at $-2f_{\\mathrm{LO}} + \\Delta f$. The resulting baseband spectrum is single-sided (at negative frequencies).\n\nComplex demodulation maps the upper sideband to positive baseband frequencies and the lower sideband to negative baseband frequencies, thereby **preserving the sign** of the offset $\\Delta f$ and **eliminating the image band ambiguity**.\n\n### Part 2: Discrete-Time I/Q Demodulation Model\n\nThe principles translate directly to discrete-time signals. The signal $x(t)$ is sampled at a rate $f_s$ to produce $x[n] = x(n/f_s)$. The demodulation is performed digitally. The I/Q components are defined as:\n$$I[n] = 2\\,x[n]\\cos\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right)$$\n$$Q[n] = -2\\,x[n]\\sin\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right)$$\nThese are combined to form a complex baseband signal $y[n]$:\n$$y[n] = I[n] + j\\,Q[n] = 2\\,x[n] \\left( \\cos\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right) - j\\sin\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right) \\right)$$\nUsing Euler's formula, this simplifies to:\n$$y[n] = 2\\,x[n]\\,\\mathrm{e}^{-j 2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n}$$\nThis is the discrete-time equivalent of multiplying by $2\\,\\mathrm{e}^{-j 2 \\pi f_{\\mathrm{LO}} t}$. The factor of $2$ is a convention to restore the original amplitude of the tone after demodulation and filtering.\n\nIn the Discrete Fourier Transform (DFT) domain, this multiplication results in a circular shift of the spectrum of $x[n]$. The spectral component at a digital frequency corresponding to $f_{\\mathrm{LO}}$ is shifted to $0$ Hz (DC), and the component at $-f_{\\mathrm{LO}}$ is shifted to $-2f_{\\mathrm{LO}}$. An ideal digital low-pass filter is implemented by taking the DFT of $y[n]$, creating a mask that is $1$ for frequency bins $|f| \\le f_c$ and $0$ otherwise, and multiplying the DFT of $y[n]$ by this mask. This selectively zeroes out the high-frequency image components (now centered around $-2f_{\\mathrm{LO}}$), leaving only the desired baseband signal.\n\n### Part 3: Implementation Strategy for Verification\n\nThe provided Python code will implement a numerical verification of these principles.\n1.  **Signal Generation**: For each test case, a time vector `n` is created. A single-tone RF signal `x[n]` is synthesized as a cosine at the specified frequency $f_{in} = f_{\\mathrm{LO}} \\pm \\Delta f$.\n2.  **Demodulation**:\n    - **Real**: `x[n]` is multiplied by $2\\cos(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n)$ to produce `z[n]`.\n    - **Complex**: `x[n]` is multiplied by $2\\mathrm{e}^{-j 2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n}$ to produce `y[n]`.\n3.  **Frequency Analysis and Filtering**:\n    - The Fast Fourier Transform (`FFT`) is used to compute the DFTs of `z[n]` and `y[n]`, yielding `Z[k]` and `Y[k]`.\n    - A frequency axis is generated. An ideal LPF mask is created by identifying all frequency bins within the cutoff $f_c = \\max(\\Delta f) + 10$.\n    - The mask is applied to `Z[k]` and `Y[k]` to produce the filtered spectra.\n4.  **Metric Calculation**:\n    - The magnitudes of the filtered spectra are measured at the frequency bins corresponding to $+\\Delta f$ and $-\\Delta f$.\n    - The ratios $R_{\\mathrm{r}}$, $R_{\\mathrm{c}}^{(+)}$, and $R_{\\mathrm{c}}^{(-)}$ are calculated. A small epsilon is added to denominators to prevent division by zero in the ideal case.\n5.  **Decision Logic**: The calculated ratios are compared against the thresholds ($100$ and $[0.9, 1.1]$) to generate boolean flags for \"sign preserved\" and \"image eliminated,\" which are then formatted and printed.\nThis process will quantitatively demonstrate the image ambiguity of real demodulation ($R_{\\mathrm{r}} \\approx 1$) and the image rejection of complex demodulation ($R_c \\gg 1$).",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Performs I/Q demodulation analysis for three test cases, verifying\n    sign preservation and image elimination.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (upper sideband tone)\n        {\n            \"fs\": 4096, \"N\": 4096, \"f_lo\": 1024,\n            \"f_tone\": 1152, \"delta_f\": 128, \"type\": \"upper\"\n        },\n        # Case 2 (lower sideband tone)\n        {\n            \"fs\": 4096, \"N\": 4096, \"f_lo\": 1024,\n            \"f_tone\": 896, \"delta_f\": 128, \"type\": \"lower\"\n        },\n        # Case 3 (near-Nyquist upper sideband tone)\n        {\n            \"fs\": 4096, \"N\": 4096, \"f_lo\": 1984,\n            \"f_tone\": 2016, \"delta_f\": 32, \"type\": \"upper\"\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        fs = case[\"fs\"]\n        N = case[\"N\"]\n        f_lo = case[\"f_lo\"]\n        f_tone = case[\"f_tone\"]\n        delta_f = case[\"delta_f\"]\n        sideband_type = case[\"type\"]\n\n        # 1. Generate discrete-time test signal\n        n = np.arange(N)\n        # Using n/fs for time to be explicit\n        t = n / fs\n        x_n = np.cos(2 * np.pi * f_tone * t)\n\n        # 2. Perform real and complex I/Q demodulation\n        \n        # Real demodulation\n        lo_real = 2 * np.cos(2 * np.pi * f_lo * t)\n        z_n = x_n * lo_real\n\n        # Complex I/Q demodulation\n        # y[n] = I[n] + jQ[n] = 2*x[n]*cos(...) - j*2*x[n]*sin(...) = 2*x[n]*exp(-j...)\n        lo_complex = 2 * np.exp(-1j * 2 * np.pi * f_lo * t)\n        y_n = x_n * lo_complex\n\n        # 3. Apply ideal symmetric low-pass filter in the DFT domain\n        \n        # Compute FFTs\n        Zk = np.fft.fft(z_n)\n        Yk = np.fft.fft(y_n)\n        \n        # Define frequency axis for the DFT\n        freqs = np.fft.fftfreq(N, 1/fs)\n\n        # Cutoff selection rule\n        f_c = delta_f + 10\n\n        # Create ideal LPF mask\n        lpf_mask = np.abs(freqs) <= f_c\n\n        # Apply filter by zeroing out bins\n        Zk_filt = Zk * lpf_mask\n        Yk_filt = Yk * lpf_mask\n        \n        # 4. Compute metrics\n        \n        # Find indices for +/- delta_f\n        # Since frequencies are exact bin centers, we can cast to int.\n        k_df = int(delta_f * N / fs)\n        k_neg_df = int(-delta_f * N / fs) # Python handles negative indices correctly\n        \n        # Get magnitudes at +/- delta_f\n        mag_Z_df = np.abs(Zk_filt[k_df])\n        mag_Z_neg_df = np.abs(Zk_filt[k_neg_df])\n        \n        mag_Y_df = np.abs(Yk_filt[k_df])\n        mag_Y_neg_df = np.abs(Yk_filt[k_neg_df])\n\n        # Add a small epsilon to denominator to prevent division by zero\n        epsilon = 1e-15\n\n        # Calculate ratios\n        if sideband_type == \"upper\":\n            # For USB tone, expect signal at +delta_f\n            Rc = mag_Y_df / (mag_Y_neg_df + epsilon)\n        else: # \"lower\"\n            # For LSB tone, expect signal at -delta_f\n            Rc = mag_Y_neg_df / (mag_Y_df + epsilon)\n            \n        Rr = mag_Z_df / (mag_Z_neg_df + epsilon)\n        \n        # 5. Apply decision rules\n        sign_preserved = Rc > 100.0\n        \n        # Real demodulation should be symmetric\n        real_is_symmetric = 0.9 <= Rr <= 1.1\n        \n        # Image is eliminated if complex is highly asymmetric and real is symmetric\n        image_eliminated = sign_preserved and real_is_symmetric\n        \n        results.append([sign_preserved, image_eliminated])\n        \n    # Final print statement in the exact required format\n    # Using str() on a list converts it to a string representation, e.g., '[True, True]'\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The Fast Fourier Transform (FFT) is a workhorse of medical image analysis, but its results can be misleading if not interpreted carefully. This exercise delves into the \"picket-fence effect\" and spectral leakage, which occur when a signal's frequency does not align perfectly with the DFT's frequency bins. By deriving a closed-form expression for the resulting spectrum , you will gain a crucial understanding of how finite sampling windows can cause a signal's energy to \"leak\" into adjacent frequency bins, a critical skill for accurately interpreting spectral data.",
            "id": "4920820",
            "problem": "In magnetic resonance imaging, a one-dimensional readout along the frequency-encoding direction produces a complex-valued time sequence that is subsequently analyzed using the Discrete Fourier Transform (DFT), typically computed via the Fast Fourier Transform (FFT). Consider a single complex exponential component in the readout that does not align exactly with a DFT frequency bin, a situation that leads to the picket-fence effect and spectral leakage due to the implicit rectangular window from finite-length sampling.\n\nLet the sampled signal be\n$$\nx[n] = A\\,\\exp\\!\\left(j\\,2\\pi\\,\\frac{k_{0}+\\delta}{N}\\,n\\right), \\quad n = 0,1,\\dots,N-1,\n$$\nwhere $A \\in \\mathbb{C}$ is a constant amplitude, $N \\in \\mathbb{N}$ is the DFT length, $k_{0} \\in \\mathbb{Z}$ is an integer identifying the nearest DFT bin to the tone, and $\\delta \\in (0,\\,\\tfrac{1}{2})$ is a fractional offset indicating that the tone’s frequency is between bins. The DFT is defined by\n$$\nX[k] = \\sum_{n=0}^{N-1} x[n]\\,\\exp\\!\\left(-j\\,2\\pi\\,\\frac{k}{N}\\,n\\right), \\quad k = 0,1,\\dots,N-1.\n$$\n\nStarting from the DFT definition and fundamental properties of geometric series and complex exponentials, derive a closed-form expression for $X[k]$ in terms of $A$, $N$, $k$, $k_{0}$, and $\\delta$. Then, use your result to quantify spectral leakage into the adjacent bin by deriving the power ratio\n$$\nR(\\delta, N) = \\frac{|X[k_{0}+1]|^{2}}{|X[k_{0}]|^{2}}.\n$$\n\nExpress your final answer as a single closed-form analytic expression in terms of $\\delta$ and $N$. No numerical evaluation or rounding is required. The answer must be a single expression, not an inequality or equation to be solved.",
            "solution": "The signal is\n$$\nx[n] = A\\,\\exp\\!\\left(j\\,2\\pi\\,\\frac{k_{0}+\\delta}{N}\\,n\\right),\n$$\nand the Discrete Fourier Transform (DFT) is\n$$\nX[k] = \\sum_{n=0}^{N-1} x[n]\\,\\exp\\!\\left(-j\\,2\\pi\\,\\frac{k}{N}\\,n\\right).\n$$\nSubstituting $x[n]$ into the DFT definition gives\n$$\nX[k] = A \\sum_{n=0}^{N-1} \\exp\\!\\left(j\\,2\\pi\\,\\frac{k_{0}+\\delta - k}{N}\\,n\\right).\n$$\nDefine\n$$\n\\alpha \\triangleq k_{0} + \\delta - k,\n$$\nso that\n$$\nX[k] = A \\sum_{n=0}^{N-1} \\left(\\exp\\!\\left(j\\,2\\pi\\,\\frac{\\alpha}{N}\\right)\\right)^{n}.\n$$\nThis is a finite geometric series with ratio $r = \\exp\\!\\left(j\\,2\\pi\\,\\frac{\\alpha}{N}\\right)$, hence\n$$\n\\sum_{n=0}^{N-1} r^{n} = \\frac{1 - r^{N}}{1 - r} = \\frac{1 - \\exp\\!\\left(j\\,2\\pi\\,\\alpha\\right)}{1 - \\exp\\!\\left(j\\,2\\pi\\,\\frac{\\alpha}{N}\\right)}.\n$$\nTo obtain a form that reveals the magnitude behavior, use the identity\n$$\n1 - \\exp(j\\theta) = \\exp\\!\\left(j\\frac{\\theta}{2}\\right)\\left(\\exp\\!\\left(-j\\frac{\\theta}{2}\\right) - \\exp\\!\\left(j\\frac{\\theta}{2}\\right)\\right) = -2j\\,\\exp\\!\\left(j\\frac{\\theta}{2}\\right)\\sin\\!\\left(\\frac{\\theta}{2}\\right).\n$$\nApplying this to numerator and denominator with $\\theta = 2\\pi\\alpha$ and $\\theta = 2\\pi\\frac{\\alpha}{N}$ yields\n$$\n\\frac{1 - \\exp\\!\\left(j\\,2\\pi\\,\\alpha\\right)}{1 - \\exp\\!\\left(j\\,2\\pi\\,\\frac{\\alpha}{N}\\right)}\n= \\frac{-2j\\,\\exp\\!\\left(j\\,\\pi\\,\\alpha\\right)\\,\\sin\\!\\left(\\pi\\alpha\\right)}{-2j\\,\\exp\\!\\left(j\\,\\pi\\,\\frac{\\alpha}{N}\\right)\\,\\sin\\!\\left(\\frac{\\pi\\alpha}{N}\\right)}\n= \\exp\\!\\left(j\\,\\pi\\,\\alpha\\left(1 - \\frac{1}{N}\\right)\\right)\\,\\frac{\\sin\\!\\left(\\pi\\alpha\\right)}{\\sin\\!\\left(\\frac{\\pi\\alpha}{N}\\right)}.\n$$\nTherefore,\n$$\nX[k] = A\\,\\exp\\!\\left(j\\,\\pi\\,\\alpha\\,\\frac{N-1}{N}\\right)\\,\\frac{\\sin\\!\\left(\\pi\\alpha\\right)}{\\sin\\!\\left(\\frac{\\pi\\alpha}{N}\\right)}.\n$$\nThe magnitude of $X[k]$ is\n$$\n|X[k]| = |A|\\,\\left|\\frac{\\sin\\!\\left(\\pi\\alpha\\right)}{\\sin\\!\\left(\\frac{\\pi\\alpha}{N}\\right)}\\right|.\n$$\nWe now evaluate $|X[k]|$ at the main bin $k = k_{0}$ and the adjacent higher bin $k = k_{0}+1$.\n\nFor $k = k_{0}$, we have $\\alpha = k_{0} + \\delta - k_{0} = \\delta$, hence\n$$\n|X[k_{0}]| = |A|\\,\\left|\\frac{\\sin\\!\\left(\\pi\\delta\\right)}{\\sin\\!\\left(\\frac{\\pi\\delta}{N}\\right)}\\right|.\n$$\nFor $k = k_{0}+1$, we have $\\alpha = k_{0} + \\delta - (k_{0}+1) = \\delta - 1$, hence\n$$\n|X[k_{0}+1]|\n= |A|\\,\\left|\\frac{\\sin\\!\\left(\\pi(\\delta - 1)\\right)}{\\sin\\!\\left(\\frac{\\pi(\\delta - 1)}{N}\\right)}\\right|.\n$$\nUsing $\\sin(\\pi(\\delta - 1)) = -\\sin(\\pi(1 - \\delta)) = -\\sin(\\pi\\delta)$ and $\\sin\\!\\left(\\frac{\\pi(\\delta - 1)}{N}\\right) = -\\sin\\!\\left(\\frac{\\pi(1 - \\delta)}{N}\\right)$, we obtain\n$$\n|X[k_{0}+1]| = |A|\\,\\frac{|\\sin(\\pi\\delta)|}{\\left|\\sin\\!\\left(\\frac{\\pi(1 - \\delta)}{N}\\right)\\right|}.\n$$\nThe desired power leakage ratio into the adjacent bin is\n$$\nR(\\delta, N) = \\frac{|X[k_{0}+1]|^{2}}{|X[k_{0}]|^{2}}\n= \\frac{|A|^{2}\\,\\dfrac{|\\sin(\\pi\\delta)|^{2}}{\\left|\\sin\\!\\left(\\dfrac{\\pi(1 - \\delta)}{N}\\right)\\right|^{2}}}{|A|^{2}\\,\\dfrac{|\\sin(\\pi\\delta)|^{2}}{\\left|\\sin\\!\\left(\\dfrac{\\pi\\delta}{N}\\right)\\right|^{2}}}\n= \\frac{\\left|\\sin\\!\\left(\\dfrac{\\pi\\delta}{N}\\right)\\right|^{2}}{\\left|\\sin\\!\\left(\\dfrac{\\pi(1 - \\delta)}{N}\\right)\\right|^{2}}.\n$$\nBecause $\\delta \\in (0, \\tfrac{1}{2})$ and $N \\in \\mathbb{N}$, the arguments of the sine functions are in $(0, \\tfrac{\\pi}{2})$, so the absolute values can be dropped without changing the result:\n$$\nR(\\delta, N) = \\left(\\frac{\\sin\\!\\left(\\dfrac{\\pi\\delta}{N}\\right)}{\\sin\\!\\left(\\dfrac{\\pi(1 - \\delta)}{N}\\right)}\\right)^{2}.\n$$\nThis closed-form expression quantifies the spectral leakage into the adjacent bin due to the picket-fence effect in terms of the fractional offset $\\delta$ and transform length $N$.",
            "answer": "$$\\boxed{\\left(\\frac{\\sin\\!\\left(\\dfrac{\\pi\\delta}{N}\\right)}{\\sin\\!\\left(\\dfrac{\\pi(1-\\delta)}{N}\\right)}\\right)^{2}}$$"
        },
        {
            "introduction": "Convolution is a fundamental operation for filtering and modeling system responses, but its direct computation can be slow. The FFT offers a powerful shortcut via the convolution theorem, but with a catch: the DFT naturally implements circular convolution, not the linear convolution typically required. This practice challenges you to derive the precise zero-padding condition  needed to use the FFT to calculate linear convolution, a core technique for building efficient and fast signal processing pipelines.",
            "id": "4920806",
            "problem": "A one-dimensional digital imaging system in a medical imaging pipeline applies a known discrete impulse response to a discrete reflectivity profile. Let $x[n]$ denote the discrete object reflectivity with finite support $x[n]=0$ for $n \\notin \\{0,\\dots,N_{x}-1\\}$, and let $h[n]$ denote the discrete impulse response with finite support $h[n]=0$ for $n \\notin \\{0,\\dots,N_{h}-1\\}$. The desired output is the linear convolution $y[n] = \\sum_{m=-\\infty}^{\\infty} x[m]\\,h[n-m]$. For computational efficiency, the output is computed by zero-padding both sequences to a common length $L$ and then using the Discrete Fourier Transform (DFT) and its efficient implementation via the Fast Fourier Transform (FFT). Specifically, the algorithm computes the pointwise product of the $L$-point DFTs of the zero-padded sequences and then applies the inverse $L$-point DFT, which yields the $L$-point circular convolution of the zero-padded sequences.\n\nStarting from the definitions of linear convolution, circular convolution modulo $L$, and the convolution theorem for the DFT, derive the condition on $L$ such that this $L$-point circular convolution exactly equals the linear convolution $y[n]$ for all indices where $y[n]$ may be nonzero. Then provide the minimal such $L$ as a closed-form expression in terms of $N_{x}$ and $N_{h}$. Express your final answer as a single analytic expression for this minimal $L$ in terms of $N_{x}$ and $N_{h}$.",
            "solution": "The problem requires the derivation of the condition on the length $L$ of the Discrete Fourier Transform (DFT) such that the circular convolution of two zero-padded sequences equals the linear convolution of the original sequences. We are given two discrete sequences, the object reflectivity $x[n]$ and the impulse response $h[n]$.\n\nFirst, we analyze the properties of the linear convolution, denoted by $y[n]$. The definition of linear convolution is given by:\n$$y[n] = (x * h)[n] = \\sum_{m=-\\infty}^{\\infty} x[m]\\,h[n-m]$$\nThe sequence $x[n]$ has finite support for $n \\in \\{0, 1, \\dots, N_x-1\\}$, meaning it has a length of $N_x$. The sequence $h[n]$ has finite support for $n \\in \\{0, 1, \\dots, N_h-1\\}$, meaning it has a length of $N_h$. Due to the finite support of both sequences, the summation can be restricted to the indices where $x[m]$ is non-zero:\n$$y[n] = \\sum_{m=0}^{N_x-1} x[m]\\,h[n-m]$$\nFor the product $x[m]h[n-m]$ to be non-zero, the argument of $h$, which is $n-m$, must also fall within its support, i.e., $0 \\le n-m \\le N_h-1$.\nThe resulting sequence $y[n]$ will also have finite support. The first non-zero sample of $y[n]$ occurs at the smallest value of $n$ for which the supports of $x[m]$ and $h[n-m]$ overlap. This happens when $m=0$ and $n-m=0$, which implies $n=0$. So, the support of $y[n]$ starts at $n=0$.\nThe last non-zero sample of $y[n]$ occurs at the largest value of $n$ for which the supports overlap. This corresponds to the largest index of $x[m]$, which is $m=N_x-1$, and the largest index for the argument of $h$, which is $n-m=N_h-1$. Substituting $m=N_x-1$ into the second equation gives $n-(N_x-1) = N_h-1$, which solves to $n = N_x + N_h - 2$.\nTherefore, the support of the linear convolution $y[n]$ is for indices $n \\in \\{0, 1, \\dots, N_x + N_h - 2\\}$. The length of the sequence $y[n]$, denoted $N_y$, is the number of points in this support, which is $(N_x + N_h - 2) - 0 + 1 = N_x + N_h - 1$.\n\nThe computational procedure described involves zero-padding $x[n]$ and $h[n]$ to a common length $L$. Let these padded sequences be $x_p[n]$ and $h_p[n]$.\n$$x_p[n] = \\begin{cases} x[n] & 0 \\le n \\le N_x-1 \\\\ 0 & N_x \\le n \\le L-1 \\end{cases}$$\n$$h_p[n] = \\begin{cases} h[n] & 0 \\le n \\le N_h-1 \\\\ 0 & N_h \\le n \\le L-1 \\end{cases}$$\nThe algorithm then computes the $L$-point DFTs $X_p[k]$ and $H_p[k]$, their product $Y_p[k] = X_p[k]H_p[k]$, and the inverse $L$-point DFT of the product. According to the convolution theorem for the DFT, this result is the $L$-point circular convolution of $x_p[n]$ and $h_p[n]$, which we denote as $y_c[n]$.\n$$y_c[n] = \\sum_{m=0}^{L-1} x_p[m]\\,h_p[(n-m) \\pmod L]$$\nThe relationship between the linear convolution $y[n]$ and the circular convolution $y_c[n]$ (of the padded sequences) is given by:\n$$y_c[n] = \\sum_{k=-\\infty}^{\\infty} y[n+kL] \\quad \\text{for } n \\in \\{0, 1, \\dots, L-1\\}$$\nThis equation shows that the circular convolution is a time-aliased version of the linear convolution, where the linear convolution result is wrapped around and summed with period $L$.\n\nFor the circular convolution $y_c[n]$ to be identical to the linear convolution $y[n]$ over the interval where $y[n]$ may be non-zero (i.e., for $n \\in \\{0, \\dots, N_x+N_h-2\\}$), we must ensure that no wrap-around (aliasing) occurs. This means that for each $n$ in the interval $\\{0, \\dots, L-1\\}$, the sum $\\sum_{k=-\\infty}^{\\infty} y[n+kL]$ must contain only one non-zero term, which is $y[n]$ for $k=0$. This requires that $y[n+kL]=0$ for all integers $k \\neq 0$.\n\nLet's analyze this condition:\n1.  For $k \\ge 1$: We need $y[n+kL]=0$ for all $n \\in \\{0, \\dots, L-1\\}$. The smallest index is $n+kL = 0+1\\cdot L = L$. Thus, we require that the linear convolution $y[j]$ be zero for all indices $j \\ge L$. Since the support of $y[n]$ ends at $n=N_x+N_h-2$, this condition is satisfied if $L > N_x+N_h-2$.\n\n2.  For $k \\le -1$: We need $y[n+kL]=0$ for all $n \\in \\{0, \\dots, L-1\\}$. Let's consider $k=-1$. The largest index is $n-L = (L-1)-L = -1$. We require that $y[j]$ be zero for all indices $j \\le -1$. The support of $y[n]$ begins at $n=0$, so this condition is always met. The conditions for $k \\le -2$ are even less restrictive.\n\nCombining these observations, the sole condition to prevent time-domain aliasing is that the length $L$ must be large enough to contain the entire linear convolution result without wrap-around. The length of the linear convolution result $y[n]$ is $N_y = N_x+N_h-1$. Therefore, the circular convolution buffer must be at least this long.\nThe condition is $L \\ge N_y$, which translates to:\n$$L \\ge N_x + N_h - 1$$\nThis inequality is the derived condition on $L$.\n\nThe problem asks for the minimal such $L$. Given that $L$ must be an integer that satisfies $L \\ge N_x + N_h - 1$, the minimum possible value for $L$ is the smallest integer that meets this condition. This minimum value is precisely $N_x + N_h - 1$.\nThus, the minimal length $L$ for which the $L$-point circular convolution equals the linear convolution is:\n$$L_{\\text{min}} = N_x + N_h - 1$$",
            "answer": "$$\\boxed{N_{x} + N_{h} - 1}$$"
        }
    ]
}