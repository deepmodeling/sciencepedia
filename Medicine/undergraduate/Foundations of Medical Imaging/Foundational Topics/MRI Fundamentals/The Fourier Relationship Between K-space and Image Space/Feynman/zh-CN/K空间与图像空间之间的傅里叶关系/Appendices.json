{
    "hands_on_practices": [
        {
            "introduction": "为了真正掌握磁共振成像中的傅里叶变换关系，没有什么比直接进行一次从k空间到图像空间的转换更有效了。这个练习提供了一个理想化的、数学上明确的k空间信号。通过推导其逆傅里叶变换，你将直接应用核心数学原理，并加深对高斯函数傅里叶对偶性等重要性质的理解，为后续更复杂的分析奠定坚实基础。",
            "id": "4933058",
            "problem": "在磁共振成像（MRI）中，复数图像域磁化强度 $m(\\mathbf{r})$ 和 $k$ 空间信号 $M(\\mathbf{k})$ 通过空间傅里叶变换对相关联\n$$\nM(\\mathbf{k}) = \\int_{\\mathbb{R}^{2}} m(\\mathbf{r}) \\,\\exp\\!\\big(-i\\,2\\pi\\,\\mathbf{k}\\cdot \\mathbf{r}\\big)\\, d^{2}\\mathbf{r}, \\qquad\nm(\\mathbf{r}) = \\int_{\\mathbb{R}^{2}} M(\\mathbf{k}) \\,\\exp\\!\\big(i\\,2\\pi\\,\\mathbf{k}\\cdot \\mathbf{r}\\big)\\, d^{2}\\mathbf{k},\n$$\n其中 $\\mathbf{r}=(x,y)$ 表示位置（单位为米），$\\mathbf{k}=(k_{x},k_{y})$ 表示空间频率（单位为周/米）。\n\n考虑解析指定的 $k$ 空间函数\n$$\nM(\\mathbf{k}) = M_{0}\\,\\exp\\!\\Big(-\\pi\\big[\\sigma_{x}^{2}\\big(k_{x}-k_{0x}\\big)^{2} + \\sigma_{y}^{2}\\big(k_{y}-k_{0y}\\big)^{2}\\big]\\Big)\\,\\exp\\!\\big(i\\,2\\pi\\big[k_{x}\\,\\Delta_{x} + k_{y}\\,\\Delta_{y}\\big]\\big),\n$$\n其中 $M_{0}>0$ 是一个常数振幅，$\\sigma_{x}>0$ 和 $\\sigma_{y}>0$ 是特征长度尺度（单位为米），$\\mathbf{k}_{0}=(k_{0x},k_{0y})$ 是 $k$ 空间偏移（单位为周/米），$\\boldsymbol{\\Delta}=(\\Delta_{x},\\Delta_{y})$ 是空间偏移（单位为米）。\n\n仅从给定的傅里叶变换定义和标准的、经过充分检验的积分事实出发，计算逆傅里叶变换 $m(\\mathbf{r})$，并给出 $m(\\mathbf{r})$ 的完全简化、包含所有常数的显式表达式。不需要进行数值计算；请以单一的闭式解析表达式给出您的答案。最终表达式应以 $M_{0}$、$\\sigma_{x}$、$\\sigma_{y}$、$k_{0x}$、$k_{0y}$、$\\Delta_{x}$、$\\Delta_{y}$、$x$ 和 $y$ 来表示。",
            "solution": "该问题要求在给定的傅里叶变换约定下，计算指定 $k$ 空间函数的逆傅里叶变换。我们从定义开始\n$$\nm(\\mathbf{r}) = \\int_{\\mathbb{R}^{2}} M(\\mathbf{k})\\,\\exp\\!\\big(i\\,2\\pi\\,\\mathbf{k}\\cdot\\mathbf{r}\\big)\\,d^{2}\\mathbf{k},\n$$\n其中 $\\mathbf{r}=(x,y)$ 且 $\\mathbf{k}=(k_{x},k_{y})$。代入给定的 $M(\\mathbf{k})$，\n$$\nm(\\mathbf{r}) = \\int_{\\mathbb{R}^{2}} M_{0}\\,\\exp\\!\\Big(-\\pi\\big[\\sigma_{x}^{2}\\big(k_{x}-k_{0x}\\big)^{2} + \\sigma_{y}^{2}\\big(k_{y}-k_{0y}\\big)^{2}\\big]\\Big)\\,\\exp\\!\\big(i\\,2\\pi\\big[k_{x}\\,\\Delta_{x} + k_{y}\\,\\Delta_{y}\\big]\\big)\\,\\exp\\!\\big(i\\,2\\pi\\big[k_{x}\\,x + k_{y}\\,y\\big]\\big)\\,dk_{x}\\,dk_{y}.\n$$\n合并最后两个因子中的指数项：\n$$\n\\exp\\!\\big(i\\,2\\pi\\big[k_{x}\\,\\Delta_{x} + k_{y}\\,\\Delta_{y}\\big]\\big)\\,\\exp\\!\\big(i\\,2\\pi\\big[k_{x}\\,x + k_{y}\\,y\\big]\\big) = \\exp\\!\\big(i\\,2\\pi\\big[k_{x}\\,(x+\\Delta_{x}) + k_{y}\\,(y+\\Delta_{y})\\big]\\big).\n$$\n接下来进行变量替换以使高斯函数中心化：定义 $u_{x} = k_{x}-k_{0x}$ 和 $u_{y} = k_{y}-k_{0y}$，因此 $dk_{x}\\,dk_{y} = du_{x}\\,du_{y}$ 且 $k_{x} = u_{x}+k_{0x}$，$k_{y} = u_{y}+k_{0y}$。然后\n\\begin{align*}\nm(\\mathbf{r})\n= \\int_{\\mathbb{R}^{2}} M_{0}\\,\\exp\\!\\Big(-\\pi\\big[\\sigma_{x}^{2}\\,u_{x}^{2} + \\sigma_{y}^{2}\\,u_{y}^{2}\\big]\\Big)\\,\\exp\\!\\big(i\\,2\\pi\\big[(u_{x}+k_{0x})(x+\\Delta_{x}) + (u_{y}+k_{0y})(y+\\Delta_{y})\\big]\\big)\\,du_{x}\\,du_{y}\\\\\n= M_{0}\\,\\exp\\!\\big(i\\,2\\pi\\big[k_{0x}(x+\\Delta_{x}) + k_{0y}(y+\\Delta_{y})\\big]\\big)\\,\\int_{\\mathbb{R}^{2}} \\exp\\!\\Big(-\\pi\\big[\\sigma_{x}^{2}\\,u_{x}^{2} + \\sigma_{y}^{2}\\,u_{y}^{2}\\big]\\Big)\\,\\exp\\!\\big(i\\,2\\pi\\big[u_{x}(x+\\Delta_{x}) + u_{y}(y+\\Delta_{y})\\big]\\big)\\,du_{x}\\,du_{y}.\n\\end{align*}\n该积分在 $u_{x}$ 和 $u_{y}$ 上是可分的：\n\\begin{align*}\nI = \\left(\\int_{-\\infty}^{\\infty} \\exp\\!\\big(-\\pi\\,\\sigma_{x}^{2}\\,u_{x}^{2}\\big)\\,\\exp\\!\\big(i\\,2\\pi\\,u_{x}\\,(x+\\Delta_{x})\\big)\\,du_{x}\\right)\\,\\left(\\int_{-\\infty}^{\\infty} \\exp\\!\\big(-\\pi\\,\\sigma_{y}^{2}\\,u_{y}^{2}\\big)\\,\\exp\\!\\big(i\\,2\\pi\\,u_{y}\\,(y+\\Delta_{y})\\big)\\,du_{y}\\right).\n\\end{align*}\n我们计算标准的傅里叶型高斯积分。使用广为接受的高斯积分事实（可通过配方法推导），\n$$\n\\int_{-\\infty}^{\\infty} \\exp\\!\\big(-\\pi\\,a\\,u^{2}\\big)\\,\\exp\\!\\big(i\\,2\\pi\\,b\\,u\\big)\\,du = \\frac{1}{\\sqrt{a}}\\,\\exp\\!\\big(-\\pi\\,b^{2}/a\\big), \\quad \\text{for } a>0,\n$$\n我们在 $u_{x}$ 积分中认定 $a=\\sigma_{x}^{2}$，$b=x+\\Delta_{x}$，在 $u_{y}$ 积分中认定 $a=\\sigma_{y}^{2}$，$b=y+\\Delta_{y}$。因此，\n\\begin{align*}\n\\int_{-\\infty}^{\\infty} \\exp\\!\\big(-\\pi\\,\\sigma_{x}^{2}\\,u_{x}^{2}\\big)\\,\\exp\\!\\big(i\\,2\\pi\\,u_{x}\\,(x+\\Delta_{x})\\big)\\,du_{x} = \\frac{1}{\\sigma_{x}}\\,\\exp\\!\\left(-\\pi\\,\\frac{(x+\\Delta_{x})^{2}}{\\sigma_{x}^{2}}\\right),\\\\\n\\int_{-\\infty}^{\\infty} \\exp\\!\\big(-\\pi\\,\\sigma_{y}^{2}\\,u_{y}^{2}\\big)\\,\\exp\\!\\big(i\\,2\\pi\\,u_{y}\\,(y+\\Delta_{y})\\big)\\,du_{y} = \\frac{1}{\\sigma_{y}}\\,\\exp\\!\\left(-\\pi\\,\\frac{(y+\\Delta_{y})^{2}}{\\sigma_{y}^{2}}\\right).\n\\end{align*}\n因此，\n$$\nI = \\frac{1}{\\sigma_{x}\\,\\sigma_{y}}\\,\\exp\\!\\left(-\\pi\\left[\\frac{(x+\\Delta_{x})^{2}}{\\sigma_{x}^{2}} + \\frac{(y+\\Delta_{y})^{2}}{\\sigma_{y}^{2}}\\right]\\right).\n$$\n将此结果代回 $m(\\mathbf{r})$ 的表达式中，得到\n\\begin{align*}\nm(\\mathbf{r})\n= M_{0}\\,\\exp\\!\\big(i\\,2\\pi\\big[k_{0x}(x+\\Delta_{x}) + k_{0y}(y+\\Delta_{y})\\big]\\big)\\,\\frac{1}{\\sigma_{x}\\,\\sigma_{y}}\\,\\exp\\!\\left(-\\pi\\left[\\frac{(x+\\Delta_{x})^{2}}{\\sigma_{x}^{2}} + \\frac{(y+\\Delta_{y})^{2}}{\\sigma_{y}^{2}}\\right]\\right)\\\\\n= \\frac{M_{0}}{\\sigma_{x}\\,\\sigma_{y}}\\,\\exp\\!\\left(-\\pi\\left[\\frac{(x+\\Delta_{x})^{2}}{\\sigma_{x}^{2}} + \\frac{(y+\\Delta_{y})^{2}}{\\sigma_{y}^{2}}\\right]\\right)\\,\\exp\\!\\big(i\\,2\\pi\\big[k_{0x}\\,x + k_{0y}\\,y + k_{0x}\\,\\Delta_{x} + k_{0y}\\,\\Delta_{y}\\big]\\big).\n\\end{align*}\n这就是包含所有常数的完全指定的图像域函数。它表明，$k$ 空间中的一个各向异性的、有位移的高斯函数，在图像空间中会产生一个各向异性的高斯函数，其宽度与 $\\sigma_{x}$ 和 $\\sigma_{y}$ 成反比，位移为 $\\boldsymbol{\\Delta}$，并由空间频率为 $\\mathbf{k}_{0}$ 的复指数载波调制，同时带有一个全局相位因子 $\\exp\\!\\big(i\\,2\\pi\\big[\\mathbf{k}_{0}\\cdot\\boldsymbol{\\Delta}\\big]\\big)$。",
            "answer": "$$\\boxed{\\frac{M_{0}}{\\sigma_{x}\\,\\sigma_{y}}\\,\\exp\\!\\left(-\\pi\\left[\\frac{(x+\\Delta_{x})^{2}}{\\sigma_{x}^{2}} + \\frac{(y+\\Delta_{y})^{2}}{\\sigma_{y}^{2}}\\right]\\right)\\,\\exp\\!\\left(i\\,2\\pi\\left(k_{0x}\\,x + k_{0y}\\,y + k_{0x}\\,\\Delta_{x} + k_{0y}\\,\\Delta_{y}\\right)\\right)}$$"
        },
        {
            "introduction": "理论与实践之间需要一座桥梁，在傅里叶成像中，这座桥梁就是点扩散函数（PSF）。这个练习将引导你从理论走向计算，通过编写代码来模拟不同k空间采样轨迹对图像质量的直接影响。通过计算并分析PSF，你将直观地看到采样策略如何决定图像的分辨率和伪影水平，从而将抽象的数学算子与具体的图像特征联系起来。",
            "id": "4933044",
            "problem": "您需要实现、分析和测试用于一维非均匀频域采样的非均匀快速傅里叶变换（NUFFT）算子的伴随算子，并使用它在医学成像中 k 空间和图像空间之间的傅里叶关系的背景下，计算复合伴随-正向算子的点扩散函数。请完全在离散时间图像空间和非均匀采样的离散频率空间中工作。复指数中的角度以弧度为单位。\n\n起点和定义，基于 k 空间和图像空间之间的傅里叶关系：一个物体与其测量的频域信号之间的连续空间映射由傅里叶变换建模。在与磁共振成像（MRI）相关的离散设置中，k 空间的非均匀离散采样由一个线性算子建模，该算子将均匀网格上的离散图像映射到非均匀频率坐标处的样本向量。设图像域为一个长度为 $N$ 的向量 $x \\in \\mathbb{C}^{N}$，由 $n \\in \\{0,1,\\dots,N-1\\}$ 索引，设非均匀 k 空间坐标为 $\\{k_m\\}_{m=0}^{M-1}$（实数值），有 $M$ 个样本。正向非均匀离散傅里叶算子 $\\mathcal{A}: \\mathbb{C}^{N} \\to \\mathbb{C}^{M}$ 定义为\n$$\n(\\mathcal{A}x)_m \\triangleq \\sum_{n=0}^{N-1} x[n] \\, e^{-i 2\\pi \\frac{k_m n}{N}}, \\quad m=0,1,\\dots,M-1.\n$$\n伴随算子 $\\mathcal{A}^{\\ast}: \\mathbb{C}^{M} \\to \\mathbb{C}^{N}$ 在标准复内积下由条件 $\\langle \\mathcal{A}x, y \\rangle = \\langle x, \\mathcal{A}^{\\ast}y \\rangle$（对于所有 $x \\in \\mathbb{C}^{N}, y \\in \\mathbb{C}^{M}$）定义，可导出\n$$\n(\\mathcal{A}^{\\ast} y)[n] \\triangleq \\sum_{m=0}^{M-1} y[m] \\, e^{+i 2\\pi \\frac{k_m n}{N}}, \\quad n=0,1,\\dots,N-1.\n$$\n复合伴随-正向算子 $\\mathcal{A}^{\\ast}\\mathcal{A}: \\mathbb{C}^{N} \\to \\mathbb{C}^{N}$ 在离散循环群上是线性和移不变的（当 $k_m$ 是整数间距时），更一般地，它会产生一个离散点扩散函数，该函数捕捉了图像空间中的一个脉冲如何被测量和重建对所扩散。将 $\\mathcal{A}^{\\ast}\\mathcal{A}$ 的点扩散函数 $g \\in \\mathbb{C}^{N}$ 定义为 $\\mathcal{A}^{\\ast}\\mathcal{A}$ 对位于原点索引 $0$ 的离散 delta 图像 $\\delta$ 的响应：\n$$\ng[n] \\triangleq (\\mathcal{A}^{\\ast}\\mathcal{A}\\,\\delta)[n], \\quad \\delta[n] = \n\\begin{cases}\n1,  n=0,\\\\\n0,  \\text{otherwise}.\n\\end{cases}\n$$\n\n任务：\n1. 使用直接求和实现上面定义的正向算子 $\\mathcal{A}$ 和伴随算子 $\\mathcal{A}^{\\ast}$。您可以将此实现视为未经加速的伴随 NUFFT，这对于本任务中的小问题规模是可以接受的。\n2. 为下面的每个测试用例计算点扩散函数 $g = \\mathcal{A}^{\\ast}\\mathcal{A}\\,\\delta$。\n3. 根据 $g$，计算以下三个标量指标：\n   - 原点的峰值幅度，$p \\triangleq |g[0]|$.\n   - 以像素为单位的半峰全宽（FWHM），在离散循环网格上定义为 $n=0$ 周围（考虑环绕邻接）满足 $|g[n]| \\geq \\tfrac{1}{2} p$ 的连续索引的数量。这是一个离散宽度；请以等于此计数的实数形式报告它。\n   - 旁瓣比 $r \\triangleq \\frac{\\sum_{n \\neq 0} |g[n]|}{|g[0]|}$。\n4. 对于每个测试用例，报告三个指标 $[p, \\text{FWHM}, r]$，四舍五入到六位小数，并按指定的最终输出格式汇总。\n\n参数值测试套件：\n- 所有用例均使用图像长度 $N = 64$。对于下面的每个用例，都指定了非均匀 k 空间样本坐标 $\\{k_m\\}$。\n  1. 用例 A（均匀笛卡尔采样，理想情况）：$M=N$, $k_m = m$ 对于 $m \\in \\{0,1,\\dots,N-1\\}$。\n  2. 用例 B（平滑抖动采样）：$M=N$, $k_m = m + 0.25 \\,\\sin\\!\\big(2\\pi m/7\\big)$ 对于 $m \\in \\{0,1,\\dots,N-1\\}$。\n  3. 用例 C（粗糙非均匀采样，易产生混叠）：$M=20$, $k_m = \\big(\\tfrac{N}{M}\\big) m + 0.33 \\,\\cos\\!\\big(2\\pi m/5\\big)$ 对于 $m \\in \\{0,1,\\dots,M-1\\}$，然后通过 $k_m \\leftarrow k_m \\bmod N$ 将其环绕到主区间。\n  4. 用例 D（极端边界：单样本采集）：$M=1$, $k_0 = 10.3$。\n\n算法和数值要求：\n- 角度以弧度为单位。按上面所示实现指数，因子为 $e^{\\pm i 2\\pi \\frac{k_m n}{N}}$。\n- 所有计算都可以在双精度复数算术中完成。\n- 除了索引域外，不涉及任何物理单位；以像素单位报告 FWHM 为整数计数，但在输出中将其编码为浮点数。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含按顺序排列的用例 A–D 的结果列表。每个用例贡献一个列表 $[p,\\text{FWHM},r]$，其中每个条目都四舍五入到六位小数。最终输出必须是以下形式的单行\n\"[ [p_A,FWHM_A,r_A], [p_B,FWHM_B,r_B], [p_C,FWHM_C,r_C], [p_D,FWHM_D,r_D] ]\"\n除了此处显示的空格外，不需要额外的空格；任何一致的、逗号分隔的方括号列表都是可以接受的。例如： \"[[1.000000,1.000000,0.000000],[...],[...],[...]]\"。",
            "solution": "问题陈述经评估有效。它在科学上基于应用于医学成像的傅里叶信号处理原理，特别是关于 k 空间采样与图像域点扩散函数之间的关系。定义在数学上是精确和自洽的，任务是适定的，从而可以得到唯一且可验证的解。\n\n问题的核心是分析由复合正向-伴随算子对产生的点扩散函数（PSF），该算子对模拟了磁共振成像（MRI）中简化的测量和重建过程。PSF，用 $g$ 表示，表征了成像系统的空间分辨率和伪影水平。它被定义为系统对理想化点源（即位于原点的离散 delta 函数 $\\delta$）的响应。\n\n正向算子 $\\mathcal{A}: \\mathbb{C}^{N} \\to \\mathbb{C}^{M}$ 将一个长度为 $N$ 的图像向量 $x \\in \\mathbb{C}^{N}$ 映射到非均匀频率坐标 $\\{k_m\\}_{m=0}^{M-1}$ 处的 $M$ 个 k 空间样本。它由以下公式给出：\n$$\n(\\mathcal{A}x)_m = \\sum_{n=0}^{N-1} x[n] \\, e^{-i 2\\pi \\frac{k_m n}{N}}\n$$\n伴随算子 $\\mathcal{A}^{\\ast}: \\mathbb{C}^{M} \\to \\mathbb{C}^{N}$，在此模型中用于图像重建，将 k 空间数据 $y \\in \\mathbb{C}^{M}$ 映射回图像域：\n$$\n(\\mathcal{A}^{\\ast} y)[n] = \\sum_{m=0}^{M-1} y[m] \\, e^{+i 2\\pi \\frac{k_m n}{N}}\n$$\n我们要求解 PSF $g = (\\mathcal{A}^{\\ast}\\mathcal{A}\\,\\delta)$。计算分两步进行。首先，我们将正向算子 $\\mathcal{A}$ 应用于离散 delta 函数 $\\delta$，其中 $\\delta[n]=1$ 当 $n=0$ 且 $\\delta[n]=0$ 当 $n \\neq 0$。令结果为 k 空间向量 $y_{\\delta} = \\mathcal{A}\\delta$。\n$$\n(y_{\\delta})_m = (\\mathcal{A}\\delta)_m = \\sum_{n=0}^{N-1} \\delta[n] \\, e^{-i 2\\pi \\frac{k_m n}{N}} = \\delta[0] \\cdot e^{-i 2\\pi \\frac{k_m \\cdot 0}{N}} = 1 \\cdot e^0 = 1\n$$\n这表明，无论采样坐标 $\\{k_m\\}$ 如何，原点处 delta 函数的 k 空间表示都是一个全为 1 的向量。\n\n其次，我们将伴随算子 $\\mathcal{A}^{\\ast}$ 应用于此结果 $y_{\\delta}$，以获得 PSF $g$。\n$$\ng[n] = (\\mathcal{A}^{\\ast} y_{\\delta})[n] = \\sum_{m=0}^{M-1} (y_{\\delta})_m \\, e^{+i 2\\pi \\frac{k_m n}{N}} = \\sum_{m=0}^{M-1} 1 \\cdot e^{+i 2\\pi \\frac{k_m n}{N}}\n$$\n因此，PSF 的最终表达式为：\n$$\ng[n] = \\sum_{m=0}^{M-1} e^{i 2\\pi \\frac{k_m n}{N}}\n$$\n这个基本结果揭示了 PSF 是由复正弦波的总和决定的，这些正弦波的频率由 k 空间采样位置 $\\{k_m\\}$ 决定。\n\n每个测试用例的算法如下：\n1.  定义图像大小 $N=64$ 以及给定用例的 k 空间坐标 $\\{k_m\\}$ 的参数。生成包含 $M$ 个坐标的数组。\n2.  使用导出的公式计算 PSF 向量 $g \\in \\mathbb{C}^{N}$。这是通过创建一个 $M \\times N$ 的复指数矩阵并对 $M$ 维度求和来实现的。\n3.  从计算出的 PSF $g$ 中计算三个表征指标：\n    a.  **峰值幅度，p**：这是 PSF 在原点的幅度，$p = |g[0]|$。根据我们的公式，$g[0] = \\sum_{m=0}^{M-1} e^{0} = \\sum_{m=0}^{M-1} 1 = M$。因此，我们预期 $p=M$。\n    b.  **旁瓣比，r**：该指标量化了相对于峰值扩散到旁瓣中的能量。其计算公式为 $r = \\frac{\\sum_{n=1}^{N-1} |g[n]|}{|g[0]|}$。\n    c.  **半峰全宽（FWHM）**：这测量了 PSF 中心峰的宽度。我们首先找到半峰阈值 $\\tfrac{1}{2}p$。FWHM 是 $n=0$ 周围（带环绕）满足 $|g[n]| \\ge \\tfrac{1}{2}p$ 的连续索引的计数。该算法识别包含原点的此类索引的连续块并报告其大小。\n\n将此过程应用于四个测试用例中的每一个，这些用例代表不同的 k 空间采样策略，以展示采样选择如何影响由 PSF 指标量化的图像质量。\n- **用例 A** 代表理想的、完全采样的笛卡尔采集。我们预计会得到一个完美的 PSF（一个缩放的 delta 函数），结果为 $p=N$, FWHM$=1$ 和 $r=0$。\n- **用例 B** 对采样网格引入了一个小的、平滑的扰动，预计会稍微加宽主瓣并引入低水平的旁瓣。\n- **用例 C** 模拟了一个激进的欠采样场景，理论预测这将导致显著的混叠伪影，表现为强的、结构化的旁瓣和高的旁瓣比。\n- **用例 D** 是一个只有一个 k 空间样本的极端情况，它不提供任何空间定位。产生的 PSF 应具有恒定的幅度，从而产生 $N$ 的最大 FWHM 和大的旁瓣比。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and evaluates the adjoint NUFFT operator to compute\n    the Point Spread Function (PSF) for various k-space sampling patterns.\n    \"\"\"\n\n    N = 64  # Image size in one dimension\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        {\n            \"name\": \"A\",\n            \"M\": N,\n            \"k_coords_func\": lambda M, N: np.arange(M),\n        },\n        {\n            \"name\": \"B\",\n            \"M\": N,\n            \"k_coords_func\": lambda M, N: np.arange(M) + 0.25 * np.sin(2 * np.pi * np.arange(M) / 7),\n        },\n        {\n            \"name\": \"C\",\n            \"M\": 20,\n            \"k_coords_func\": lambda M, N: np.mod( (N / M) * np.arange(M) + 0.33 * np.cos(2 * np.pi * np.arange(M) / 5), N),\n        },\n        {\n            \"name\": \"D\",\n            \"M\": 1,\n            \"k_coords_func\": lambda M, N: np.array([10.3]),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        M = case[\"M\"]\n        k_coords = case[\"k_coords_func\"](M, N)\n\n        # The PSF g is the adjoint of an all-ones vector of length M.\n        # g[n] = sum_{m=0}^{M-1} exp(j * 2 * pi * k_m * n / N)\n        n_indices = np.arange(N)\n        \n        # Vectorized computation of the PSF\n        # outer product of k_coords and n_indices forms the phase terms\n        # k_coords: (M, 1), n_indices: (1, N) -> phase_matrix: (M, N)\n        phase_matrix = (2j * np.pi / N) * k_coords.reshape(-1, 1) * n_indices.reshape(1, -1)\n        exp_matrix = np.exp(phase_matrix)\n        g = np.sum(exp_matrix, axis=0) # Sum over the m-dimension\n\n        # --- Compute Metrics ---\n\n        # 1. Peak magnitude at the origin\n        p = np.abs(g[0])\n\n        # 2. Sidelobe ratio\n        # Sum of magnitudes of all non-origin points divided by peak magnitude\n        if p > 1e-9:\n             r = (np.sum(np.abs(g)) - np.abs(g[0])) / p\n        else:\n             r = np.inf if np.sum(np.abs(g)) > 1e-9 else 0.0\n\n        # 3. Full-width at half-maximum (FWHM)\n        half_max_val = 0.5 * p\n        above_half_max = np.abs(g) >= half_max_val\n        \n        fwhm = 0.0\n        if above_half_max[0]:\n            fwhm = 1.0\n            \n            # Search forward from n=1\n            pos_extent = 0\n            for i in range(1, N):\n                if above_half_max[i]:\n                    pos_extent += 1\n                else:\n                    break\n            \n            # Search backward from n=N-1 (handles wrap-around)\n            neg_extent = 0\n            for i in range(1, N):\n                if above_half_max[N - i]:\n                    neg_extent += 1\n                else:\n                    break\n            \n            # Total FWHM is the size of the contiguous block around 0\n            # Ensure we don't count the whole array twice if it's all True\n            if pos_extent + neg_extent >= N - 1:\n                fwhm = float(N)\n            else:\n                fwhm = 1.0 + pos_extent + neg_extent\n\n\n        results.append([round(p, 6), round(fwhm, 6), round(r, 6)])\n\n    # Format the final output string as specified a list of lists.\n    formatted_case_results = []\n    for res_list in results:\n        formatted_case_results.append(f\"[{res_list[0]:.6f},{res_list[1]:.6f},{res_list[2]:.6f}]\")\n\n    print(f\"[{','.join(formatted_case_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在实际的MRI图像重建中，我们常常会遇到一些看似能“提升”图像质量的处理技术，例如k空间零填充（zero-filling）。然而，这种技术可能会产生误导。本练习旨在挑战你对图像分辨率的深刻理解，通过分析零填充的影响，学会区分由数据采集物理过程决定的“真实分辨率”和由数字插值产生的“像素大小”。",
            "id": "4550074",
            "problem": "进行了一次二维笛卡尔坐标系的磁共振成像（MRI）采集，其视场（FOV）为正方形，每个维度的边长为 $F$，采集的笛卡尔k空间矩阵为 $192\\times 192$ 个样本。在进行逆快速傅里叶变换（IFFT）之前，通过将k空间零填充至 $256\\times 256$ 的网格来重建图像。考虑以下原理：在笛卡尔坐标系MRI中，k空间采样间隔为 $\\Delta k = 1/F$，沿每个轴采样的最大空间频率幅值为 $k_{\\max} = (N_{\\text{acq}}/2)\\,\\Delta k = N_{\\text{acq}}/(2F)$，其中 $N_{\\text{acq}}$ 是沿该轴采集的样本数。对于矩形k空间窗，点扩散函数（PSF）与 $\\sin(2\\pi k_{\\max} x)/(\\pi x)$ 成正比，由于在 $k_{\\max}$ 处的截断，会在锐利边缘附近产生吉布斯振铃效应。仅使用这些基本原理，预测预期的伪影是什么，并量化从 $192\\times 192$ 零填充到 $256\\times 256$ 会如何改变 (i) 显示的像素尺寸，(ii) 由 $k_{\\max}$ 决定的真实空间分辨率极限，以及 (iii) 吉布斯振铃在空间周期和振幅方面的表现。\n\n哪个选项与这些原理最一致？\n\nA. 零填充将真实分辨率从 $F/192$ 提高到 $F/256$，并通过平滑作用将吉布斯振铃振幅降低了 $25\\%$；振铃的空间周期（单位为毫米）也相应减小。\n\nB. 零填充使由 $k_{\\max}$ 决定的真实分辨率（PSF宽度）保持在 $F/192$ 不变，将显示的像素尺寸从 $F/192$ 减小到 $F/256$（减少了 $25\\%$），使吉布斯振铃振幅保持不变，并且由于物理空间中振铃的零点间距仍为 $F/192$，每个振铃周期内的像素数量增加了 $256/192 = 4/3$ 倍。\n\nC. 零填充因为缺失高频数据而引入混叠；像素尺寸和真实分辨率都保持为 $F/192$，吉布斯振铃在像素上的表现不变。\n\nD. 零填充在k空间中起到变迹（apodization）的作用，在模糊边缘的同时减小了吉布斯振铃的振幅；有效分辨率降至 $F/128$，振铃周期（单位为毫米）增加。\n\nE. 零填充提高了真实分辨率并增强了吉布斯振铃，将其振幅从边缘阶跃的大约 $9\\%$ 增加到约 $12\\%$，而振铃周期（以像素为单位）保持不变。",
            "solution": "我将首先确认问题格式，然后根据已验证的第一性原理逐步解决问题。\n\n1.  **问题格式**：此问题是单选多选题格式。它提供了一个基于物理原理的场景，并要求从五个选项中选择最准确的描述。我的回答将包括两个部分：\n    -   验证：一个严格的、分步的过程。\n        -   第1步：逐字提取给定条件。\n        -   第2步：对照清单（科学合理性、适定性、客观性等）进行验证。\n        -   第3步：做出裁决并采取相应行动。如果无效，则解释并终止。如果有效，则继续。\n    -   解答结构：基于原理的推导，然后是逐项分析选项。\n    -   最终答案：使用 `$$\\boxed{...}$$` 格式，并对正确选项进行特定格式化。\n\n2.  **问题验证**：我现在将对所提供的问题应用验证步骤。\n\n    **第1步：提取给定条件**\n    -   采集类型：二维笛卡尔坐标系磁共振成像（MRI）。\n    -   视场（FOV）：正方形，每个维度边长为 $F$。\n    -   采集的k空间矩阵大小：$192 \\times 192$ 个样本。\n    -   重建方法：在进行逆快速傅里叶变换（IFFT）之前，将k空间用零填充至 $256 \\times 256$ 网格。\n    -   原理1：k空间采样间隔为 $\\Delta k = 1/F$。\n    -   原理2：沿每个轴的最大采样空间频率幅值为 $k_{\\max} = (N_{\\text{acq}}/2)\\,\\Delta k = N_{\\text{acq}}/(2F)$，其中 $N_{\\text{acq}}$ 是沿该轴采集的样本数。\n    -   原理3：矩形k空间窗的点扩散函数（PSF）与 $\\sin(2\\pi k_{\\max} x)/(\\pi x)$ 成正比。\n    -   原理4：在 $k_{\\max}$ 处的截断会在锐利边缘附近产生吉布斯振铃。\n    -   问题：预测预期的伪影，并量化从 $192 \\times 192$ 零填充到 $256 \\times 256$ 会如何改变 (i) 显示的像素尺寸，(ii) 真实空间分辨率极限，以及 (iii) 吉布斯振铃的表现（空间周期和振幅）。\n\n    **第2步：使用提取的给定条件进行验证**\n    -   **科学上是否合理？** 是。该问题描述了应用于MRI重建的标准信号处理原理。k空间采样、FOV、分辨率、傅里叶变换、零填充（zero-padding）以及吉布斯振铃之间的关系都是该领域的基本概念。给出的PSF是一个sinc函数，这是k空间中矩形窗（rect函数）的正确傅里叶变换。\n    -   **问题是否适定？** 是。问题提供了足够的信息来确定零填充对最终图像的影响。可以从给定的原理中推导出一个唯一且稳定的解。\n    -   **是否客观？** 是。语言精确且技术性强。它要求基于陈述的物理和数学原理进行预测，而不是基于主观看法。\n    -   **缺陷清单：**\n        1.  **科学/事實不準確？** 否。所述原理是正确的。\n        2.  **無法形式化/不相關？** 否。这是一个MRI物理/工程领域的标准问题。\n        3.  **不完整/矛盾？** 否。设置是完整的。$N_{\\text{acq}} = 192$，最终网格尺寸为 $256$，FOV为 $F$。原理陈述清晰。\n        4.  **不切實際/不可行？** 否。这些参数（$192 \\times 192$ 采集，$256 \\times 256$ 重建）在临床和研究MRI中非常常见。\n        5.  **不適定/結構不良？** 否。问题清晰，并要求评估特定的量。\n        6.  **偽深刻/琐碎？** 否。这是一个经典的概念性问题，测试对像素尺寸与真实分辨率之间区别的理解，以及零填充对离散傅里叶变换的影响。对学生来说，这是一个不平凡的概念。\n        7.  **超出科學可驗證範圍？** 否。这些效应可以通过数学推导和实验验证。\n\n    **第3步：结论与行动**\n    -   该问题是**有效**的。我将继续进行解答阶段。\n\n3.  **求解推导**：现在我将基于已验证的原理构建解答。\n\n    -   **核心概念**：\n        -   图像空间和k空间之间的关系是傅里叶变换。\n        -   FOV决定了k空间的采样间隔：$\\Delta k = 1/F$。\n        -   采集的样本数（$N_{\\text{acq}}$）和FOV（$F$）决定了*真实*空间分辨率。分辨率受限于捕获的最大空间频率 $k_{\\max}$。分辨率的瑞利判据通常近似为PSF主瓣的宽度，该宽度与 $k_{\\max}$ 成反比。\n        -   重建网格中的点数（$N_{\\text{recon}}$）和FOV（$F$）决定了重建图像中显示的像素尺寸：$\\text{像素尺寸} = F / N_{\\text{recon}}$。\n        -   k空间中的零填充（zero-filling或zero-padding）是指在IFFT之前用零扩展k空间矩阵。这会增加 $N_{\\text{recon}}$ 而不改变采集的数据或 $k_{\\max}$。\n        -   吉布斯振铃是由k空间数据的急剧截断引起的伪影。PSF是k空间*窗函数*的傅里叶变换。对于笛卡尔采集，窗函数是矩形函数（rect）。rect函数的FT是sinc函数。\n        -   sinc函数 $\\text{sinc}(x) = \\sin(\\pi x)/(\\pi x)$ 具有特征性的振荡。第一个过冲（吉布斯现象）的振幅固定为阶跃高度的约 $9\\%$，与截止频率无关，只要截止是急剧的。振铃的*空间周期*由截止频率 $k_{\\max}$ 决定。PSF $\\sin(2\\pi k_{\\max} x)/(\\pi x)$ 的零点（不包括 $x=0$）出现在 $2\\pi k_{\\max} x = m\\pi$ 处，其中 $m$ 为非零整数。第一个零点位于 $x = 1/(2k_{\\max})$。\n\n    -   **将概念应用于问题**：\n        -   采集矩阵大小：$N_{\\text{acq}} = 192$。\n        -   重建矩阵大小：$N_{\\text{recon}} = 256$。\n        -   FOV：$F$。\n\n    -   **对(i)显示像素尺寸的分析**：\n        -   像素尺寸由FOV和IFFT后最终图像矩阵的大小决定。\n        -   像素尺寸 = $F / N_{\\text{recon}}$。\n        -   最初（如果我们以 $192 \\times 192$ 重建），像素尺寸将是 $F/192$。\n        -   零填充到 $256 \\times 256$ 后，新的像素尺寸是 $F/256$。\n        -   这是像素尺寸的减小。比率为 $(F/256) / (F/192) = 192/256 = 3/4$。所以减小量是 $1 - 3/4 = 1/4 = 25\\%$。\n        -   (i)的结论：显示的像素尺寸从 $F/192$ 减小到 $F/256$。\n\n    -   **对(ii)真实空间分辨率的分析**：\n        -   真实空间分辨率由采集的k空间数据范围决定，即由 $k_{\\max}$ 定义。\n        -   根据问题陈述，$k_{\\max} = N_{\\text{acq}} / (2F)$。\n        -   这里，$N_{\\text{acq}} = 192$。所以，$k_{\\max} = 192 / (2F) = 96/F$。\n        -   零填充是用零来填充k空间矩阵。它*不*增加任何新的高频信息。非零k空间数据的范围，因此 $k_{\\max}$，保持不变。\n        -   由于 $k_{\\max}$ 不变，真实空间分辨率保持不变。\n        -   分辨率极限，通常定义为两个刚好可分辨的点之间的距离，与PSF主瓣的宽度有关。PSF $\\text{sinc}(2\\pi k_{\\max} x)$ 的第一个零点在 $x = 1/(2k_{\\max})$。\n        -   所以，分辨率极限与 $1/k_{\\max} = 2F/N_{\\text{acq}} = 2F/192 = F/96$ 成正比。一个常见（更简单）的名义分辨率定义是 $F/N_{\\text{acq}} = F/192$。我们将遵循这个惯例，因为它经常被使用并出现在选项中。\n        -   (ii)的结论：由 $k_{\\max}$ 决定的真实空间分辨率保持不变，实际上是 $F/192$。零填充*不*提高真实分辨率。\n\n    -   **对(iii)吉布斯振铃表现的分析**：\n        -   **振幅**：吉布斯振铃振幅是截断傅里叶级数的直接后果，这正是在采集有限k空间区域时发生的情况。k空间数据乘以一个矩形窗函数。该乘积的IFFT是真实图像与一个sinc函数（PSF）的卷积。对于一个急剧的阶跃边缘，过冲（吉布斯现象）振幅是一个固定的百分比（约占阶跃高度的 $9\\%$），仅取决于不连续性，而不取决于截止频率 $k_{\\max}$。零填充不改变k空间窗函数（它仍然是相同大小的rect函数）；它只改变了该函数在图像域中的采样方式。因此，振铃伪影的振幅不改变。\n        -   **空间周期**：振铃的空间周期由PSF的振荡决定，即sinc函数。PSF的零点（不包括 $x=0$）位于 $x_m = m/(2k_{\\max})$，其中整数 $m \\neq 0$。连续零点之间的距离（“周期”）是 $1/(2k_{\\max})$。\n        -   使用 $k_{\\max} = N_{\\text{acq}} / (2F) = 192 / (2F) = 96/F$。\n        -   振铃的空间周期数量级为 $1/(2k_{\\max}) = F/192$。因此，振铃伪影在物理单位（例如毫米）中的特征间距由 $k_{\\max}$ 决定，即 $F/192$。\n        -   由于零填充不改变 $k_{\\max}$，振铃振荡的物理间距保持不变。\n        -   *确实*改变的是这种振铃在像素网格上的表示方式。\n        -   原始像素尺寸（假设）：$F/192$。振铃周期为一个像素。\n        -   新像素尺寸：$F/256$。\n        -   物理空间中的振铃周期仍然是 $F/192$。这个周期内能容纳多少个新像素？\n        -   每个振铃周期的像素数 = (振铃周期，单位mm) / (像素尺寸，单位mm) = $(F/192) / (F/256) = 256/192 = 4/3$。\n        -   这意味着具有固定物理波长的振铃现在被更小的像素更精细地采样。它在外观上被“拉伸”到更多的像素上。它的周期不再是1个旧像素，而是 $4/3$ 个新像素。\n        -   (iii)的结论：振铃振幅不变。振铃的物理周期不变（与 $F/192$ 相关）。每个振铃周期的像素数增加了 $256/192 = 4/3$ 倍。\n\n    -   **预测总结**：\n        -   (i) 显示的像素尺寸：从 $F/192$ 减小到 $F/256$。\n        -   (ii) 真实空间分辨率：不变，由 $N_{\\text{acq}}=192$ 决定。名义分辨率为 $F/192$。\n        -   (iii) 吉布斯振铃：振幅不变。物理周期不变。在像素中的外观被“拉伸”，每个振铃振荡覆盖更多像素。\n\n4.  **逐项分析选项**：\n\n    -   **A. 零填充将真实分辨率从 $F/192$ 提高到 $F/256$，并通过平滑作用将吉布斯振铃振幅降低了 $25\\%$；振铃的空间周期（单位为毫米）也相应减小。**\n        -   “将真实分辨率从 $F/192$ 提高到 $F/256$”：**不正确**。这是一个典型的误解。零填充增加了矩阵大小，提供了更小的像素（数字插值），但它没有增加新的高频信息，所以真实分辨率（区分精细细节的能力）不变。\n        -   “通过平滑作用将吉布斯振铃振幅降低了 $25\\%$”：**不正确**。零填充不是平滑或变迹滤波器。它是用零填充。k空间中的急剧截断得以保留，所以振铃振幅不变。\n        -   “振铃的空间周期（单位为毫米）也相应减小”：**不正确**。空间周期与 $k_{\\max}$ 成反比，$k_{\\max}$ 保持不变。\n        -   结论：**不正确**。\n\n    -   **B. 零填充使由 $k_{\\max}$ 决定的真实分辨率（PSF宽度）保持在 $F/192$ 不变，将显示的像素尺寸从 $F/192$ 减小到 $F/256$（减少了 $25\\%$），使吉布斯振铃振幅保持不变，并且由于物理空间中振铃的零点间距仍为 $F/192$，每个振铃周期内的像素数量增加了 $256/192 = 4/3$ 倍。**\n        -   “使由 $k_{\\max}$ 决定的真实分辨率（PSF宽度）保持在 $F/192$ 不变”：**正确**。分辨率由采集的k空间范围（$N_{\\text{acq}}=192$）决定，而不是重建网格的大小。$F/192$ 是名义分辨率。\n        -   “将显示的像素尺寸从 $F/192$ 减小到 $F/256$（减少了 $25\\%$）”：**正确**。像素尺寸是 $F/N_{\\text{recon}}$。从 $F/192$ 变为 $F/256$。减少量为 $(F/192 - F/256)/(F/192) = 1 - 192/256 = 1 - 3/4 = 1/4 = 25\\%$。\n        -   “使吉布斯振铃振幅保持不变”：**正确**。振幅由在 $k_{\\max}$ 处的急剧截断决定，零填充不改变这一点。\n        -   “每个振铃周期内的像素数量增加了 $256/192 = 4/3$ 倍，因为物理空间中振铃的零点间距仍为 $F/192$”：**正确**。振铃的物理周期由 $k_{\\max}$ 固定（间距约为 $F/192$）。随着像素尺寸减小到 $F/256$，需要更多的像素来覆盖这个固定距离。比率是 $(F/192) / (F/256) = 256/192 = 4/3$。\n        -   结论：**正确**。所有陈述都与傅里叶成像原理一致。\n\n    -   **C. 零填充因为缺失高频数据而引入混叠；像素尺寸和真实分辨率都保持为 $F/192$，吉布斯振铃在像素上的表现不变。**\n        -   “因为缺失高频数据而引入混叠”：**不正确**。混叠（或卷褶伪影）是由k空间*欠采样*引起的，意味着k空间采样间隔 $\\Delta k$ 太大，这对应于FOV（$F=1/\\Delta k$）太小。这是另一种不同的伪影。缺失高频数据会导致模糊和吉布斯振铃，而不是混叠。\n        -   “像素尺寸和真实分辨率都保持为 $F/192$”：**不正确**。像素尺寸变为 $F/256$。\n        -   “吉布斯振铃在像素上的表现不变”：**不正确**。振铃现在被更多的像素采样，所以它的外观发生了变化；它看起来被拉伸了。\n        -   结论：**不正确**。\n\n    -   **D. 零填充在k空间中起到变迹（apodization）的作用，在模糊边缘的同时减小了吉布斯振铃的振幅；有效分辨率降至 $F/128$，振铃周期（单位为毫米）增加。**\n        -   “在k空间中起到变迹的作用，减小了吉布斯振铃的振幅”：**不正确**。变迹涉及将k空间数据乘以一个平滑的窗函数（例如汉明窗或汉宁窗）以使边缘变尖，从而以牺牲分辨率为代价来减少振铃。零填充是填充，而不是加窗。它不减小振铃振幅。\n        -   “有效分辨率降至 $F/128$”：**不正确**。分辨率没有降低。它保持在 $F/192$ 不变。数字 $128$ 似乎是任意的。\n        -   “振铃周期（单位为毫米）增加”：**不正确**。物理周期是恒定的，因为 $k_{\\max}$ 是恒定的。\n        -   结论：**不正确**。\n\n    -   **E. 零填充提高了真实分辨率并增强了吉布斯振铃，将其振幅从边缘阶跃的大约 $9\\%$ 增加到约 $12\\%$，而振铃周期（以像素为单位）保持不变。**\n        -   “提高了真实分辨率”：**不正确**。如已确定，真实分辨率不变。\n        -   “增强了吉布斯振铃，增加了其振幅”：**不正确**。对于急剧截断，过冲的振幅是吉布斯现象的一个恒定属性，不会改变。\n        -   “振铃周期（以像素为单位）保持不变”：**不正确**。物理周期不变，但由于像素尺寸减小，*以像素为单位*的周期必须增加。\n        -   结论：**不正确**。\n\n5.  **最终确认**：\n    我的详细分析表明，选项B是唯一根据所提供原理正确描述了零填充所有影响的选项。\n    -   真实分辨率：不变，受限于来自 $N_{\\text{acq}}=192$ 的 $k_{\\max}$。\n    -   像素尺寸：减小，由 $N_{\\text{recon}}=256$ 决定。\n    -   吉布斯振铃振幅：不变，因为k空间的急剧截断被保留。\n    -   吉布斯振铃外观：振荡具有固定的空间周期，因此用更小的像素观察时，振铃显得“更清晰”或“拉伸”到更多像素上。\n\n    选项B中的陈述与这种理解完全一致。零填充过程本质上是在空间域中使用sinc插值来插值图像数据的一种方式（因为在频域中乘以rect函数相当于在时/空域中与sinc函数进行卷积）。这提供了一个更佳可视化的图像，其中底层连续信号（受原始采集限制）在一个更精细的网格上采样。它更清晰地揭示了PSF和吉布斯振铃的结构，但并未从根本上改变它们。\n\n    问题是有效的。解是从第一性原理推导出来的。对选项的分析是完整的。最终答案是B。我准备好写出输出了。我将注意为所有数学实体使用LaTeX。",
            "answer": "$$\\boxed{B}$$"
        }
    ]
}