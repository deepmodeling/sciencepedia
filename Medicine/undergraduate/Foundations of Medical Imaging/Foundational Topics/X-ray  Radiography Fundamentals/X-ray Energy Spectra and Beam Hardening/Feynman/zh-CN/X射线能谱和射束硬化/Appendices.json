{
    "hands_on_practices": [
        {
            "introduction": "现实世界中的X射线源产生的是包含多种能量光子的多能谱线束，而非理想的单能线束。为了描述这种复杂线束的穿透能力，我们引入“有效能量” ($E_{\\mathrm{eff}}$) 这一实用概念。本练习将指导你如何从模拟的透射数据中计算有效能量，从而直接、定量地观察到线束在穿过组织时是如何“硬化”的（即其有效能量如何增加），为理解线束硬化现象建立起直观基础 。",
            "id": "4942542",
            "problem": "给定一个峰值管电压为 $120$ 千伏峰值 (kVp) 的 X 射线束穿过水后的测量透射曲线。水的密度为 $\\rho = 1.0$ $\\text{g}/\\text{cm}^3$。透射率定义为 $T(x) = I(x)/I_0$，其中 $I_0$ 是入射空气比释动能强度，$I(x)$ 是穿过厚度为 $x$ (单位为 $\\text{cm}$) 的水后的强度。假设如下：\n\n- 能量为 $E$ 的单能 X 射线束遵循比尔-朗伯定律 $T(x) = \\exp\\left(-\\mu(E)\\,\\rho\\,x\\right)$，其中 $\\mu(E)$ 是水在能量 $E$ 下的质量衰减系数 (单位为 $\\text{cm}^2/\\text{g}$)。\n- 多色谱 $S(E)$ 产生的透射率为 $T(x) = \\dfrac{\\int S(E)\\,\\exp\\left(-\\mu(E)\\,\\rho\\,x\\right)\\,dE}{\\int S(E)\\,dE}$。\n- 对于给定的 $x$，将有效能量 $E_{\\mathrm{eff}}(x)$ 定义为能使单能射线束产生相同测量透射率的唯一能量，即满足 $\\exp\\left(-\\mu\\!\\left(E_{\\mathrm{eff}}(x)\\right)\\,\\rho\\,x\\right) = T(x)$。\n- 将半值层 (HVL) 定义为能使 $T(h) = 1/2$ 的水层厚度 $h$。对于单能射线束，这意味着 $h = \\ln(2)/\\left(\\mu(E)\\,\\rho\\right)$。\n\n提供了液态水的质量衰减系数随光子能量变化的离散查找表，用于插值计算。能量 $E$ 的单位是 $\\text{keV}$，$\\mu/\\rho$ 的单位是 $\\text{cm}^2/\\text{g}$：\n\n- 能量 $E$ (单位 $\\text{keV}$): $[20,\\;30,\\;40,\\;50,\\;60,\\;70,\\;80,\\;90,\\;100,\\;110,\\;120]$\n- $\\mu/\\rho$ (单位 $\\text{cm}^2/\\text{g}$): $[0.685,\\;0.332,\\;0.245,\\;0.208,\\;0.190,\\;0.181,\\;0.175,\\;0.171,\\;0.168,\\;0.166,\\;0.164]$\n\n还为您提供了选定水层厚度 $x$ 下的测量透射率 $T(x)$ (即“测试套件”)。请仅使用这些提供的数据来计算 $E_{\\mathrm{eff}}(x)$ 和对应的水层 HVL。能量必须以 $\\text{keV}$ 为单位报告，HVL 必须以 $\\text{cm}$ 为单位报告。测试套件如下：\n\n- $x = 0.5$ $\\text{cm}$, $T(x) = 0.900$\n- $x = 5$ $\\text{cm}$, $T(x) = 0.377$\n- $x = 10$ $\\text{cm}$, $T(x) = 0.157$\n- $x = 20$ $\\text{cm}$, $T(x) = 0.0302$\n- $x = 30$ $\\text{cm}$, $T(x) = 0.0061$\n\n任务：\n\n1. 从以上定义出发，推导一个用测量透射率 $T(x)$ 和厚度 $x$ 表示 $\\mu\\!\\left(E_{\\mathrm{eff}}(x)\\right)$ 的表达式，并解释如何通过反转所提供的 $\\mu/\\rho$ 表来计算 $E_{\\mathrm{eff}}(x)$。您的算法必须对所提供测试套件中的任何 $x$ 都有效，并且必须在表上使用单调插值来估计与计算出的衰减相匹配的能量。\n2. 使用 $E_{\\mathrm{eff}}(x)$，计算测试套件中每个 $x$ 对应的水中半值层 $h(x)$。解释随着 $x$ 的增加，束流硬化如何改变 $E_{\\mathrm{eff}}(x)$ 和 $h(x)$。\n\n数值输出要求：\n\n- 报告 $E_{\\mathrm{eff}}(x)$ (单位 $\\text{keV}$) 和 $h(x)$ (单位 $\\text{cm}$)，均四舍五入到三位小数。\n- 您的程序必须生成单行输出，其中包含所有测试用例的结果，格式为一个用方括号括起来的逗号分隔列表，数值交替出现，如 $[E_{\\mathrm{eff}}(0.5),h(0.5),E_{\\mathrm{eff}}(5),h(5),\\dots]$。例如，格式必须类似于 $[e_1,h_1,e_2,h_2,e_3,h_3,e_4,h_4,e_5,h_5]$，其中每个 $e_i$ 的单位是 $\\text{keV}$，每个 $h_i$ 的单位是 $\\text{cm}$，均四舍五入到三位小数。",
            "solution": "该问题具有科学依据，提法明确，并包含推导唯一且有意义的解决方案所需的所有信息。提供的物理常数和数据是现实且内部一致的。\n\n按照问题陈述的要求，解决方案分两部分进行。\n\n**第一部分：有效能量 $E_{\\mathrm{eff}}(x)$ 的推导与计算**\n\n在水层厚度为 $x$ 时的有效能量 $E_{\\mathrm{eff}}(x)$ 被定义为一个假想的单能 X 射线束的能量，该射线束表现出与实际多色射线束相同的透射率 $T(x)$。单能射线束的透射率遵循比尔-朗伯定律：\n$$T(x) = \\exp\\left(-\\mu(E)\\,\\rho\\,x\\right)$$\n其中 $\\mu(E)$ 是材料（水）在能量 $E$ 下的质量衰减系数，$\\rho$ 是材料的密度。\n\n根据定义，对于有效能量 $E_{\\mathrm{eff}}(x)$，此关系成立：\n$$T(x) = \\exp\\left(-\\mu(E_{\\mathrm{eff}}(x))\\,\\rho\\,x\\right)$$\n为了找到与有效能量对应的质量衰减系数的表达式，我们将其表示为 $\\mu_{\\mathrm{eff-mass}}(x) \\equiv \\mu(E_{\\mathrm{eff}}(x))$，并对该方程进行重新排列。首先，我们对两边取自然对数：\n$$\\ln(T(x)) = -\\mu(E_{\\mathrm{eff}}(x))\\,\\rho\\,x$$\n接下来，我们求解 $\\mu(E_{\\mathrm{eff}}(x))$：\n$$\\mu(E_{\\mathrm{eff}}(x)) = -\\frac{\\ln(T(x))}{\\rho\\,x}$$\n问题提供了一个质量衰减系数的查找表，$\\mu/\\rho$。我们用 $\\mu_{\\text{mass}}(E) = \\mu(E)/\\rho$ 表示质量衰减系数。那么有效质量衰减系数的表达式为：\n$$\\mu_{\\text{mass}}(E_{\\mathrm{eff}}(x)) = -\\frac{\\ln(T(x))}{x}$$\n我们使用给定的值 $\\rho = 1.0 \\text{ g}/\\text{cm}^3$，但该公式是通用的。\n\n计算每个给定 ($x$, $T(x)$) 对的 $E_{\\mathrm{eff}}(x)$ 的算法如下：\n1.  对于给定的测量值 $(x, T(x))$，计算有效质量衰减系数的值，$\\mu_{\\text{mass,eff}} = -\\ln(T(x))/x$。\n2.  提供的查找表列出了对应能量 $E$ 的 $\\mu_{\\text{mass}}(E)$ 的离散值。可以观察到，在给定范围内，随着能量 $E$ 的增加，$\\mu_{\\text{mass}}(E)$ 的值单调递减。\n3.  这种单调关系使我们能够通过反转函数，即找到 $E(\\mu_{\\text{mass}})$，来唯一确定与计算出的 $\\mu_{\\text{mass,eff}}$ 相对应的能量 $E_{\\mathrm{eff}}(x)$。\n4.  由于 $\\mu_{\\text{mass,eff}}$ 通常会落在两个列表格点之间，我们必须使用插值法。根据要求，我们采用单调插值方案。线性插值是其中最简单的方法。我们在表中找到两个连续的点 $(E_i, \\mu_{\\text{mass},i})$ 和 $(E_{i+1}, \\mu_{\\text{mass},i+1})$，它们将我们计算出的值括在其中，使得 $\\mu_{\\text{mass},i} \\ge \\mu_{\\text{mass,eff}} \\ge \\mu_{\\text{mass},i+1}$。\n5.  然后通过在这两点之间进行线性插值来估计有效能量 $E_{\\mathrm{eff}}(x)$：\n$$E_{\\mathrm{eff}}(x) = E_i + (E_{i+1} - E_i) \\frac{\\mu_{\\text{mass,eff}} - \\mu_{\\text{mass},i}}{\\mu_{\\text{mass},i+1} - \\mu_{\\text{mass},i}}$$\n对五个测试用例中的每一个都应用此过程。\n\n**第二部分：半值层 $h(x)$ 的计算与束流硬化现象的解释**\n\n半值层 (HVL) 定义为将射线束强度降低到其入射值一半所需材料的厚度。对于具有有效质量衰减系数 $\\mu_{\\text{mass}}(E_{\\mathrm{eff}}(x))$ 的单能射线束，其半值层 $h(x)$ 可通过将透射率设为 $1/2$ 来找到：\n$$\\frac{1}{2} = \\exp\\left(-\\mu_{\\text{mass}}(E_{\\mathrm{eff}}(x))\\,\\rho\\,h(x)\\right)$$\n求解 $h(x)$ 可得：\n$$h(x) = \\frac{\\ln(2)}{\\mu_{\\text{mass}}(E_{\\mathrm{eff}}(x))\\,\\rho}$$\n使用第一部分推导出的 $\\mu_{\\text{mass}}(E_{\\mathrm{eff}}(x))$ 表达式以及 $\\rho = 1.0 \\text{ g}/\\text{cm}^3$，我们可以直接计算每个测试用例的 $h(x)$：\n$$h(x) = \\frac{\\ln(2)}{-\\frac{\\ln(T(x))}{x}} = -\\frac{x \\ln(2)}{\\ln(T(x))}$$\n该公式提供了在穿过厚度 $x$ 后，与多色射线束具有相同穿透能力的单能射线束的 HVL。\n\n束流硬化是指多色 X 射线束穿过衰减体时其平均能量增加的现象。发生这种情况是因为低能光子比高能光子衰减得更强（即，在诊断能量范围内，对于较低的 $E$，$\\mu_{\\text{mass}}(E)$ 通常更高）。随着射线束更深地穿透材料（$x$ 增加），更大部分的低能光子被滤除，从而使能谱向更高能量移动。\n\n这一物理过程对我们计算的量有直接影响：\n-   **有效能量 $E_{\\mathrm{eff}}(x)$**：由于 $E_{\\mathrm{eff}}(x)$ 代表等效单能射线束的能量，它可作为衡量射线束平均穿透能力的指标。随着射线束随厚度 $x$ 增加而硬化，其穿透能力也随之增强。因此，我们预期 $E_{\\mathrm{eff}}(x)$ 是 $x$ 的单调递增函数。\n-   **半值层 $h(x)$**：HVL 是衡量射线束穿透性的另一个指标；穿透性更强（更硬）的射线束具有更大的 HVL。由于射线束随着 $x$ 的增加而变得更具穿透性，我们预期相应的 HVL $h(x)$ 也会随 $x$ 增加而增大。\n\n测试套件的计算结果将证实这一趋势。当 $x = 0.5 \\text{ cm}$ 时，射线束相对未衰减，有效能量较低。当 $x = 30 \\text{ cm}$ 时，射线束已被显著过滤，导致射线束变得更硬，具有更高的有效能量和更大的 HVL。计算结果证实了这一物理原理。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for effective energy and Half-Value Layer (HVL) for a polychromatic\n    X-ray beam based on measured transmission data through water.\n    \"\"\"\n    # Define physical constants and problem givens.\n    rho_water = 1.0  # g/cm^3\n\n    # Lookup table for mass attenuation coefficient of water.\n    # Energies (E) in keV, mass attenuation coefficients (mu/rho) in cm^2/g.\n    energy_keV = np.array([20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120])\n    mu_rho_water = np.array([0.685, 0.332, 0.245, 0.208, 0.190, 0.181, 0.175, 0.171, 0.168, 0.166, 0.164])\n\n    # The np.interp function requires the x-coordinates to be monotonically increasing.\n    # Our mu/rho values are decreasing, so we reverse both arrays for interpolation.\n    mu_rho_water_increasing = mu_rho_water[::-1]\n    energy_keV_for_interp = energy_keV[::-1]\n\n    # Test suite: (thickness x in cm, measured transmission T(x))\n    test_cases = [\n        (0.5, 0.900),\n        (5, 0.377),\n        (10, 0.157),\n        (20, 0.0302),\n        (30, 0.0061)\n    ]\n\n    results = []\n    \n    for x, T_x in test_cases:\n        # Task 1: Calculate effective energy E_eff(x)\n        \n        # From T(x) = exp(-mu_eff * rho * x), we derive the effective linear attenuation\n        # coefficient mu_eff = -ln(T(x)) / (rho * x).\n        # The effective mass attenuation coefficient is mu_eff_mass = mu_eff / rho.\n        # With rho = 1.0 g/cm^3, mu_eff_mass = -ln(T(x)) / x.\n        \n        if T_x = 0 or T_x > 1:\n            # Transmission must be in (0, 1] range. Handle invalid input.\n            # This case is not expected from the problem statement but is good practice.\n            continue\n            \n        mu_eff_mass = -np.log(T_x) / x\n\n        # Interpolate to find the energy E_eff corresponding to the calculated mu_eff_mass.\n        # We find E as a function of mu/rho, so mu/rho is the 'x' and E is the 'y' for np.interp.\n        E_eff = np.interp(mu_eff_mass, mu_rho_water_increasing, energy_keV_for_interp)\n\n        # Task 2: Calculate the corresponding Half-Value Layer h(x)\n        \n        # The HVL is defined by 1/2 = exp(-mu_eff * rho * h), which gives h = ln(2) / (mu_eff * rho).\n        # Using the effective mass attenuation coefficient: h = ln(2) / (mu_eff_mass * rho).\n        h_x = np.log(2) / (mu_eff_mass * rho_water)\n        \n        # Append rounded results to the list\n        results.append(round(E_eff, 3))\n        results.append(round(h_x, 3))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了线束质量会发生变化之后，我们需要一个标准化的方法来对其进行量化。半值层 (Half-Value Layer, HVL) 就是临床上用于表征X射线束穿透能力的黄金标准。与单能谱不同，计算多能谱线束的HVL需要求解一个综合了所有能量成分衰减的方程。本实践将要求你编写一个数值求解器，以计算不同X射线能谱的HVL，从而巩固对能谱形状（例如“硬”谱与“软”谱）如何直接影响其穿透能力的理解 。",
            "id": "4942513",
            "problem": "一束由钨阳极产生并经铝过滤的诊断X射线束，在窄束几何条件（忽略散射）下入射到均匀的软组织平板上。请从第一性原理出发，构建当多能谱穿过具有已知质量衰减系数的材料时，半值层（HVL）和十分之一值层（TVL）的定义和计算方法。从单能光束的指数衰减定律开始，并将其推广到由离散能量区间表示的多能谱。然后，实现一个数值算法，求解使透射注量降低至入射注量某一指定比例所需的材料厚度。\n\n使用以下基本原理：\n- 单能光束的指数衰减（比尔-朗伯定律）：如果一束能量为 $E$ 的光子束穿过厚度为 $t$、密度为 $\\rho$ 的均匀材料，其透射注量将衰减一个因子 $\\exp\\!\\left(-\\mu(E)\\,t\\right)$，其中 $\\mu(E)=\\rho\\,(\\mu/\\rho)(E)$ 且 $(\\mu/\\rho)(E)$ 是质量衰减系数。\n- 对于在离散能量 $E_i$ 处具有谱权重 $w_i$ 的多能光束，总透射注量是各能量成分的加权和。\n\n将半值层（HVL）定义为使透射注量降低至其入射值 $1/2$ 所需的厚度 $t_{1/2}$，将十分之一值层（TVL）定义为使透射注量降低至其入射值 $1/10$ 所需的厚度 $t_{1/10}$。\n\n您的程序必须：\n- 使用下面以表格形式提供的能量、谱权重和质量衰减系数。\n- 为每个能量区间 $i$ 计算 $\\mu_i=\\rho\\,(\\mu/\\rho)_i$。\n- 对于给定的目标分数 $f$（HVL为 $f=1/2$，TVL为 $f=1/10$），求解满足上述基本原理所蕴含的多能谱透射条件的厚度 $t$。\n- 使用软组织密度 $\\rho=1.00\\,\\mathrm{g/cm^3}$。能量单位必须为 $\\mathrm{keV}$，$(\\mu/\\rho)$ 单位必须为 $\\mathrm{cm^2/g}$，厚度必须以 $\\mathrm{cm}$ 为单位计算和报告。\n- 所有最终结果以 $\\mathrm{cm}$ 为单位表示，并四舍五入到3位小数。\n\n测试套件（所有数组均按索引 $i$ 对齐）：\n- 能量（单位 $\\mathrm{keV}$）：$[20,30,40,50,60,70,80,90,100]$。\n- 软组织的质量衰减系数 $(\\mu/\\rho)_i$（单位 $\\mathrm{cm^2/g}$）：$[0.50,0.30,0.22,0.18,0.155,0.140,0.130,0.120,0.110]$。\n- 谱A（经铝过滤的钨谱，中等程度过滤），权重 $w^{(A)}_i$（无量纲，相对值）：$[0.03,0.10,0.18,0.20,0.18,0.12,0.09,0.06,0.04]$。\n- 谱B（一种经过额外过滤的更硬的变种谱），权重 $w^{(B)}_i$（无量纲，相对值）：$[0.01,0.05,0.10,0.16,0.20,0.18,0.14,0.10,0.06]$。\n- 谱C（使用相同能量网格的近似 $100\\,\\mathrm{keV}$ 单能谱），权重 $w^{(C)}_i$（无量纲，相对值）：$[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0]$。\n\n要求的计算：\n- 测试 1：谱A在软组织中的HVL，即使用 $(\\mu/\\rho)_i$ 和 $w^{(A)}_i$ 计算 $f=1/2$ 时的厚度 $t$。\n- 测试 2：谱B在软组织中的HVL，即使用 $(\\mu/\\rho)_i$ 和 $w^{(B)}_i$ 计算 $f=1/2$ 时的厚度 $t$。\n- 测试 3：谱A在软组织中的TVL，即使用 $(\\mu/\\rho)_i$ 和 $w^{(A)}_i$ 计算 $f=1/10$ 时的厚度 $t$。\n- 测试 4：谱C在软组织中的HVL，即使用 $(\\mu/\\rho)_i$ 和 $w^{(C)}_i$ 计算 $f=1/2$ 时的厚度 $t$。\n- 测试 5：谱C在软组织中的TVL，即使用 $(\\mu/\\rho)_i$ 和 $w^{(C)}_i$ 计算 $f=1/10$ 时的厚度 $t$。\n\n数值要求：\n- 通过对一个关于 $t$ 的单调函数使用区间法求根来求解 $t$，该方法需要一个足以包含解的初始上界（例如，通过不断扩大上界直到残差的符号发生改变）。对 $t$ 使用的收敛容差不应大于 $10^{-6}\\,\\mathrm{cm}$。\n- 使用离散能量的加权和来表示谱；不要假设任何连续的解析谱形式。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为 $[\\text{测试 }1, \\text{测试 }2, \\text{测试 }3, \\text{测试 }4, \\text{测试 }5]$，每个值都以 $\\mathrm{cm}$ 为单位并四舍五入到3位小数，例如 $[3.681,4.245,12.447,6.300,20.958]$。",
            "solution": "我们从单能光束的比尔-朗伯定律开始。对于能量为 $E$ 的光子穿过厚度为 $t$、密度为 $\\rho$ 的材料板，透射注量 $\\Phi(E,t)$ 相对于入射注量 $\\Phi_0(E)$ 为\n$$\n\\frac{\\Phi(E,t)}{\\Phi_0(E)}=\\exp\\!\\left(-\\mu(E)\\,t\\right),\n\\quad \\text{其中} \\quad\n\\mu(E)=\\rho\\,(\\mu/\\rho)(E).\n$$\n此处，$(\\mu/\\rho)(E)$ 是能量 $E$ 处的质量衰减系数，单位为 $\\mathrm{cm^2/g}$，$\\rho$ 是质量密度，单位为 $\\mathrm{g/cm^3}$，因此 $\\mu(E)$ 的单位按要求为 $\\mathrm{cm^{-1}}$。\n\n对于一个由能量区间（索引为 $i$）离散表示的多能谱，其能量为 $E_i$，非负权重为 $w_i$（与每个能量区间的入射谱注量成正比），总入射注量与 $\\sum_i w_i$ 成正比，穿过厚度 $t$ 后的透射注量与 $\\sum_i w_i \\exp(-\\mu_i t)$ 成正比，其中 $\\mu_i=\\rho\\,(\\mu/\\rho)_i$。通过 $\\sum_i w_i$ 进行的归一化消除了谱中任何未知的绝对尺度。因此，透射分数 $T(t)$ 为\n$$\nT(t)=\\frac{\\sum_{i} w_i \\,\\exp(-\\mu_i t)}{\\sum_{i} w_i},\n\\quad \\text{其中} \\quad \\mu_i=\\rho\\,(\\mu/\\rho)_i.\n$$\n\n定义：\n- 半值层（HVL）是使 $T(t_{1/2})=1/2$ 成立的厚度 $t_{1/2}$。\n- 十分之一值层（TVL）是使 $T(t_{1/10})=1/10$ 成立的厚度 $t_{1/10}$。\n\n对于能量为 $E$ 的单能光束，这些可简化为\n$$\n\\exp(-\\mu(E)\\,t_{f})=f \\;\\Rightarrow\\; t_f = -\\frac{\\ln f}{\\mu(E)},\n$$\n其中 $f\\in\\{1/2,1/10\\}$。然而，对于多能光束，$T(t)$ 是指数函数的加权和，由于每一项 $\\exp(-\\mu_i t)$ 都是严格单调递减的，且权重 $w_i$ 是非负的（并至少有一项为严格正值），所以 $T(t)$ 关于 $t$ 也是严格单调递减且连续的。因此，对于任何 $f\\in(0,1)$，方程 $T(t_f)=f$ 都存在唯一的解 $t_f$。\n\n算法设计：\n1. 输入：数组 $\\{E_i\\}_{i=1}^N$、$\\{w_i\\}_{i=1}^N$、$\\{(\\mu/\\rho)_i\\}_{i=1}^N$，密度 $\\rho$ 以及目标分数 $f\\in(0,1)$。\n2. 对所有 $i$ 计算 $\\mu_i=\\rho\\,(\\mu/\\rho)_i$。\n3. 定义残差函数\n$$\nR(t)=\\frac{\\sum_{i=1}^N w_i \\exp(-\\mu_i t)}{\\sum_{i=1}^N w_i} - f.\n$$\n注意到 $R(0)=1-f0$ 且 $\\lim_{t\\to\\infty}R(t)=-f0$，因此根据介值定理和单调性，存在唯一的根。\n4. 使用一种区间求根方法，如二分法：\n   - 初始化 $t_{\\mathrm{low}}=0$ 和一个上界 $t_{\\mathrm{high}}$。如果 $R(t_{\\mathrm{high}})0$，则迭代地将 $t_{\\mathrm{high}}$ 加倍，直到 $R(t_{\\mathrm{high}})\\le 0$。\n   - 在 $[t_{\\mathrm{low}},t_{\\mathrm{high}}]$ 上应用二分法，直到区间宽度小于容差 $\\varepsilon$（选择 $\\varepsilon \\le 10^{-6}\\,\\mathrm{cm}$），返回中点作为解。\n5. 将最终结果四舍五入到3位小数。\n\n射束硬化解释：\n- 对于多能光束，随着 $t$ 的增加，具有较大 $\\mu_i$ 的低能成分被优先衰减，从而增加了透射射束的有效能量。因此，在更大深度处计算的HVL通常随深度增加而增加。在本问题中，我们计算的是相对于 $t=0$ 处入射谱的第一HVL和TVL，这已经捕捉到了谱的初始硬化行为。\n\n数据和单位：\n- 能量（单位 $\\mathrm{keV}$）：$[20,30,40,50,60,70,80,90,100]$。\n- 软组织的 $(\\mu/\\rho)_i$（单位 $\\mathrm{cm^2/g}$）：$[0.50,0.30,0.22,0.18,0.155,0.140,0.130,0.120,0.110]$。\n- 密度 $\\rho=1.00\\,\\mathrm{g/cm^3}$。\n- 谱A权重 $w^{(A)}_i$：$[0.03,0.10,0.18,0.20,0.18,0.12,0.09,0.06,0.04]$。\n- 谱B权重 $w^{(B)}_i$：$[0.01,0.05,0.10,0.16,0.20,0.18,0.14,0.10,0.06]$。\n- 谱C权重 $w^{(C)}_i$：$[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0]$。\n\n要求的计算：\n- 测试 1：谱A的HVL, $f=1/2$。\n- 测试 2：谱B的HVL, $f=1/2$。\n- 测试 3：谱A的TVL, $f=1/10$。\n- 测试 4：谱C的HVL, $f=1/2$。\n- 测试 5：谱C的TVL, $f=1/10$。\n\n预期的定性关系：\n- 谱B的HVL应大于谱A的HVL，因为谱B更硬（在较高能量处有更大权重）。\n- 对于近似 $100\\,\\mathrm{keV}$ 单能的谱C，其HVL应近似为 $t_{1/2}\\approx (\\ln 2)/(\\rho(\\mu/\\rho)_{100\\ \\mathrm{keV}})$，其TVL应近似为 $t_{1/10}\\approx (\\ln 10)/(\\rho(\\mu/\\rho)_{100\\ \\mathrm{keV}})$。\n\n最终输出：\n- 一行：一个用方括号括起来的逗号分隔列表 $[\\text{测试 }1, \\text{测试 }2, \\text{测试 }3, \\text{测试 }4, \\text{测试 }5]$，单位为 $\\mathrm{cm}$，每个值都四舍五入到3位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef normalized_transmission(t, mu_over_rho, rho, weights):\n    \"\"\"\n    Compute the normalized polyenergetic transmission T(t) for thickness t:\n    T(t) = sum_i w_i * exp(-mu_i * t) / sum_i w_i, where mu_i = rho * (mu_over_rho)_i.\n    \"\"\"\n    mu = rho * mu_over_rho  # 1/cm\n    w = weights\n    # Avoid numerical underflow by clipping t range if needed (not necessary here, but safe)\n    trans_terms = w * np.exp(-mu * t)\n    return trans_terms.sum() / w.sum()\n\ndef find_thickness_for_fraction(mu_over_rho, rho, weights, target_fraction, tol=1e-6, t_high_init=1.0, max_expand=100):\n    \"\"\"\n    Solve for t such that normalized_transmission(t) = target_fraction using bisection.\n    \"\"\"\n    # Define residual function\n    def residual(t):\n        return normalized_transmission(t, mu_over_rho, rho, weights) - target_fraction\n\n    t_low = 0.0\n    r_low = residual(t_low)  # should be 1 - f > 0\n    if r_low = 0:\n        # Degenerate case: already below target at zero thickness (should not occur)\n        return 0.0\n\n    # Expand upper bound until residual = 0\n    t_high = float(t_high_init)\n    r_high = residual(t_high)\n    expand_count = 0\n    while r_high > 0 and expand_count  max_expand:\n        t_high *= 2.0\n        r_high = residual(t_high)\n        expand_count += 1\n    if r_high > 0:\n        # If failed to bracket, raise error; but to remain self-contained, return current t_high\n        # In realistic settings, we'd increase max_expand or inspect inputs.\n        return t_high\n\n    # Bisection\n    while (t_high - t_low) > tol:\n        t_mid = 0.5 * (t_low + t_high)\n        r_mid = residual(t_mid)\n        if r_mid > 0:\n            t_low = t_mid\n        else:\n            t_high = t_mid\n    return 0.5 * (t_low + t_high)\n\ndef solve():\n    # Define the test cases from the problem statement.\n\n    # Energies (keV) - not directly used in computation since mu_over_rho and weights are aligned\n    energies_keV = np.array([20,30,40,50,60,70,80,90,100], dtype=float)\n\n    # Mass attenuation coefficients (cm^2/g) for soft tissue\n    mu_over_rho = np.array([0.50,0.30,0.22,0.18,0.155,0.140,0.130,0.120,0.110], dtype=float)\n\n    # Density (g/cm^3)\n    rho = 1.00\n\n    # Spectral weights for the three spectra (dimensionless, relative)\n    w_A = np.array([0.03,0.10,0.18,0.20,0.18,0.12,0.09,0.06,0.04], dtype=float)  # Spectrum A\n    w_B = np.array([0.01,0.05,0.10,0.16,0.20,0.18,0.14,0.10,0.06], dtype=float)  # Spectrum B (harder)\n    w_C = np.array([0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0], dtype=float)           # Spectrum C (mono-like at 100 keV)\n\n    # Define the test suite: (weights, target_fraction)\n    test_cases = [\n        (w_A, 0.5),   # Test 1: HVL for Spectrum A\n        (w_B, 0.5),   # Test 2: HVL for Spectrum B\n        (w_A, 0.1),   # Test 3: TVL for Spectrum A\n        (w_C, 0.5),   # Test 4: HVL for Spectrum C (100 keV)\n        (w_C, 0.1),   # Test 5: TVL for Spectrum C (100 keV)\n    ]\n\n    results = []\n    for weights, frac in test_cases:\n        t = find_thickness_for_fraction(mu_over_rho, rho, weights, frac, tol=1e-9, t_high_init=1.0, max_expand=200)\n        # Round to 3 decimals for output formatting\n        results.append(t)\n\n    # Final print statement in the exact required format.\n    # Round each result to 3 decimals in the output string.\n    print(f\"[{','.join(f'{x:.3f}' for x in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "线束硬化并不仅仅是一个物理学上的奇特现象，它会在医学影像中，尤其是在计算机断层扫描 (CT) 中，引起显著的伪影。CT图像使用亨氏单位 (Hounsfield Unit, HU) 来表示物质的衰减特性，而线束硬化会导致重建的HU值出现偏差，形成所谓的“杯状伪影”。本练习通过模拟从能谱到探测器响应的整个信号链来量化这种HU偏差，并通过比较传统的能量积分探测器和现代的光子计数探测器，让你探索探测器技术如何影响甚至减轻这些伪影 。",
            "id": "4942569",
            "problem": "要求您推导、实现并计算在计算机断层扫描（CT）中，均匀水模体的重建亨斯菲尔德单位（HU）偏差，比较能量积分探测器（EID）模型与具有理想平坦响应的光子计数探测器（PCD）模型，并基于第一性原理解释能量加权如何加剧或减轻射线束硬化。请从比尔-朗伯定律和基本的探测器响应定义开始。然后，将得到的量化实现为一个程序，该程序评估指定的测试用例，并以指定格式在单行中输出其结果。\n\n假设以下科学上合理的模型组件和单位：\n- 能量 $E$ 的单位为 $\\mathrm{keV}$，路径长度 $L$ 的单位为 $\\mathrm{cm}$，衰减系数的单位为 $\\mathrm{cm}^{-1}$。\n- 比尔-朗伯定律：能量为 $E$ 的射线穿过厚度为 $L$ 的水后的透射注量为 $\\Phi(E,L) = \\Phi_0(E)\\,\\exp(-\\mu_{\\mathrm{w}}(E)\\,L)$，其中 $\\Phi_0(E)$ 是入射谱，$\\mu_{\\mathrm{w}}(E)$ 是水的线性衰减系数。\n- 一个X射线管源谱模型，其峰值电压为 $kVp$，谱形为经过滤的类轫致辐射形状。设 $kVp = 120~\\mathrm{kVp}$，并在能量网格 $E \\in \\{15,16,\\dots,120\\}~\\mathrm{keV}$ 上定义一个离散的入射谱\n$$\nS(E) = E\\,(kVp - E)\\,\\exp\\!\\left(-\\frac{c}{E^3}\\right),\n$$\n其中过滤参数 $c = 2\\times 10^5$（无量纲），并且在该离散网格之外 $S(E) = 0$。\n- 一个水衰减模型，它通过一个两项表达式来捕捉康普顿散射和光电吸收\n$$\n\\mu_{\\mathrm{w}}(E) = a + \\frac{b}{E^3},\n$$\n其中 $a = 0.17~\\mathrm{cm}^{-1}$ 且 $b = 5130~\\mathrm{cm}^{-1}\\cdot\\mathrm{keV}^3$。这产生的值与诊断能量范围内的已知行为相当。\n- 探测器响应模型：\n    - 对于具有平坦响应的理想光子计数探测器（PCD），在整个网格上 $R_{\\mathrm{PCD}}(E) = 1$。\n    - 对于能量积分探测器（EID），其响应与能量成正比，$R_{\\mathrm{EID}}(E) = E$。\n- 探测到的信号是透射谱经探测器响应加权后的能量积分。使用离散能量，通过在 $1~\\mathrm{keV}$ 区间上的黎曼和来近似积分：\n    - 入射（空气）信号：\n    $$\n    I_{0,\\mathrm{PCD}} = \\sum_E S(E), \\quad I_{0,\\mathrm{EID}} = \\sum_E E\\,S(E).\n    $$\n    - 穿过厚度为 $L$ 的水后的透射信号：\n    $$\n    I_{\\mathrm{PCD}}(L) = \\sum_E S(E)\\,\\exp(-\\mu_{\\mathrm{w}}(E)\\,L), \\quad\n    I_{\\mathrm{EID}}(L) = \\sum_E E\\,S(E)\\,\\exp(-\\mu_{\\mathrm{w}}(E)\\,L).\n    $$\n- CT重建中用于长度为 $L$ 的均匀路径的线积分由透射率的对数计算得出。对于 $L0$，定义\n$$\n\\mu_{\\mathrm{recon},\\mathrm{PCD}}(L) = -\\frac{1}{L}\\,\\ln\\!\\left(\\frac{I_{\\mathrm{PCD}}(L)}{I_{0,\\mathrm{PCD}}}\\right), \\quad\n\\mu_{\\mathrm{recon},\\mathrm{EID}}(L) = -\\frac{1}{L}\\,\\ln\\!\\left(\\frac{I_{\\mathrm{EID}}(L)}{I_{0,\\mathrm{EID}}}\\right).\n$$\n对于边界情况 $L = 0$，使用比尔-朗伯定律的一阶极限以避免除以零，\n$$\n\\mu_{\\mathrm{recon},\\mathrm{PCD}}(0) = \\frac{\\sum_E S(E)\\,\\mu_{\\mathrm{w}}(E)}{\\sum_E S(E)}, \\quad\n\\mu_{\\mathrm{recon},\\mathrm{EID}}(0) = \\frac{\\sum_E E\\,S(E)\\,\\mu_{\\mathrm{w}}(E)}{\\sum_E E\\,S(E)}.\n$$\n- 定义水在 $E_{\\mathrm{mono}} = 70~\\mathrm{keV}$ 处的单能参考衰减，\n$$\n\\mu_{\\mathrm{ref}} = \\mu_{\\mathrm{w}}(70~\\mathrm{keV}).\n$$\n- 将水的亨斯菲尔德单位（HU）偏差定义为\n$$\n\\mathrm{HU}_{\\mathrm{bias}}(L;\\mathrm{model}) = 1000\\,\\frac{\\mu_{\\mathrm{recon},\\mathrm{model}}(L) - \\mu_{\\mathrm{ref}}}{\\mu_{\\mathrm{ref}}},\n$$\n在一个校准到水的完美单能系统中，该值应为 $0$，但由于射线束硬化和探测器能量加权，它会发生偏离。\n\n您的程序必须：\n- 使用单位区间宽度的离散能量网格 $E \\in \\{15,16,\\dots,120\\}~\\mathrm{keV}$ 来近似上述总和。\n- 为每个测试用例计算两种模型（EID 和 PCD）的 $\\mathrm{HU}_{\\mathrm{bias}}$。\n- 将所有最终数值输出以亨斯菲尔德单位（HU）表示，并四舍五入到三位小数的浮点数。\n\n测试套件：\n- 使用以下水厚度 $L$（单位为 $\\mathrm{cm}$）：$L \\in \\{0, 1, 10, 30\\}$。\n- 对于所有情况，使用 $kVp = 120~\\mathrm{kVp}$，$c = 2\\times 10^5$，$a = 0.17~\\mathrm{cm}^{-1}$，$b = 5130~\\mathrm{cm}^{-1}\\cdot\\mathrm{keV}^3$ 以及 $E_{\\mathrm{mono}} = 70~\\mathrm{keV}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个以逗号分隔的Python风格列表的列表。每个内部列表包含两个浮点数（单位为HU，四舍五入到三位小数），顺序为 $[\\mathrm{HU}_{\\mathrm{bias},\\mathrm{EID}}, \\mathrm{HU}_{\\mathrm{bias},\\mathrm{PCD}}]$，对应于相应的测试用例，顺序与上述测试套件相同。例如，输出形式为\n$$\n[[x_0,y_0],[x_1,y_1],[x_2,y_2],[x_3,y_3]]\n$$\n其中每个 $x_i$ 和 $y_i$ 都是单位为 HU 的浮点数，四舍五入到三位小数。",
            "solution": "该问题是有效的，因为它在科学上基于X射线物理学和计算机断层扫描的原理，在数学上是适定的，提供了所有必要的常数和方程，并使用客观、精确的语言进行陈述。X射线谱、材料衰减和探测器响应的模型是医学影像教育和研究中使用的标准简化表示。该任务是直接应用这些原理来量化一个已知的物理现象，即射线束硬化。\n\n目标是推导并计算均匀水模体在两种不同探测器模型——理想能量积分探测器（EID）和理想光子计数探测器（PCD）——下的亨斯菲尔德单位（HU）偏差，并从第一性原理解释探测器能量加权如何影响射线束硬化的效应。\n\n分析始于比尔-朗伯定律，该定律描述了单能X射线束的衰减。对于能量为 $E$、穿过厚度为 $L$、线性衰减系数为 $\\mu(E)$ 的均匀材料的光子束，透射光子注量 $\\Phi(E,L)$ 与入射注量 $\\Phi_0(E)$ 的关系为：\n$$\n\\Phi(E,L) = \\Phi_0(E)\\,\\exp(-\\mu(E)\\,L)\n$$\n在此问题中，入射注量由一个多能X射线谱 $S(E)$ 表示，该谱定义在一个离散的能量网格 $E \\in \\{15, 16, \\dots, 120\\}~\\mathrm{keV}$ 上。衰减介质是水，其线性衰减系数 $\\mu_{\\mathrm{w}}(E)$ 依赖于能量。所提供的 $\\mu_{\\mathrm{w}}(E) = a + b/E^3$ 模型捕捉了基本的物理原理：由于光电效应（$b/E^3$ 项），在较低能量下衰减更强；在较高能量下，康普顿散射占主导地位（$a$ 项），衰减趋于一个更恒定的值。\n\n衰减的这种能量依赖性是射线束硬化现象的根源。当多能X射线束穿过水时，低能光子比高能光子衰减得更强烈。因此，透射束的能谱分布向更高能量偏移；其平均能量增加。射线束变得“更硬”。\n\nCT探测器测量的信号是透射光子谱经探测器能量响应函数 $R(E)$ 加权后的积分。我们考虑两种理想模型：\n1.  理想光子计数探测器（PCD）对每个光子的计数权重相同，无论其能量如何。其响应函数是平坦的：$R_{\\mathrm{PCD}}(E) = 1$。测得的信号与透射光子的总数（光子注量）成正比。\n2.  理想能量积分探测器（EID）产生的信号与光子沉积的总能量成正比。高能光子对信号的贡献大于低能光子。因此，其响应函数与能量成正比：$R_{\\mathrm{EID}}(E) = E$。测得的信号与总透射能量（能量注量）成正比。\n\n入射（空气扫描）和透射信号通过在离散能量网格上求和来计算。对于在水中的路径长度 $L$：\n- 入射信号：$I_{0,\\mathrm{PCD}} = \\sum_E S(E)$ 和 $I_{0,\\mathrm{EID}} = \\sum_E E\\,S(E)$。\n- 透射信号：$I_{\\mathrm{PCD}}(L) = \\sum_E S(E)\\,\\exp(-\\mu_{\\mathrm{w}}(E)\\,L)$ 和 $I_{\\mathrm{EID}}(L) = \\sum_E E\\,S(E)\\,\\exp(-\\mu_{\\mathrm{w}}(E)\\,L)$。\n\n在CT重建中，衰减系数的线积分是通过入射信号与透射信号之比的对数来估计的。对于长度为 $L$ 的均匀路径，这会产生一个重建的有效衰减系数 $\\mu_{\\mathrm{recon}}$：\n$$\n\\mu_{\\mathrm{recon}}(L) = -\\frac{1}{L}\\,\\ln\\left(\\frac{I(L)}{I_0}\\right)\n$$\n由于射线束硬化，能谱随 $L$ 变化，因此 $\\mu_{\\mathrm{recon}}(L)$ 不是一个常数，而是路径长度的函数。随着 $L$ 增加，射线束变得更硬，平均衰减减小，因此 $\\mu_{\\mathrm{recon}}(L)$ 随 $L$ 的增加而减小。这是射线束硬化伪影的数学表现。\n\n现在可以分析探测器能量加权的影响。EID的响应函数 $R_{\\mathrm{EID}}(E) = E$ 给予较高能量的光子更大的权重。这些光子恰恰是优先穿过衰减体的光子。这种双重效应——高能光子的优先透射和对这些相同光子增加的探测器权重——意味着与PCD信号相比，EID信号更严重地偏向能谱的高能端。因此，EID系统测得的总体衰减低于PCD系统，并且 $\\mu_{\\mathrm{recon,EID}}(L)$ 的值将比 $\\mu_{\\mathrm{recon,PCD}}(L)$ 随 $L$ 下降得更快。因此，EID的能量加权加剧了射线束硬化伪影。\n\n亨斯菲尔德单位（HU）标度是衰减的归一化表示，相对于参考材料（水）在参考能量下定义。此处，参考衰减为 $\\mu_{\\mathrm{ref}} = \\mu_{\\mathrm{w}}(70~\\mathrm{keV})$。水的HU偏差由下式给出：\n$$\n\\mathrm{HU}_{\\mathrm{bias}}(L) = 1000\\,\\frac{\\mu_{\\mathrm{recon}}(L) - \\mu_{\\mathrm{ref}}}{\\mu_{\\mathrm{ref}}}\n$$\n一个以此参考校准的完美系统，对于任何厚度的水都应产生 $\\mathrm{HU}_{\\mathrm{bias}} = 0$。由于射线束硬化，我们预计 $\\mu_{\\mathrm{recon}}(L)$ 会与 $\\mu_{\\mathrm{ref}}$ 不同。对于 $L=0$，重建的衰减是 $\\mu_{\\mathrm{w}}(E)$ 的能谱加权平均值，通常不等于 $\\mu_{\\mathrm{ref}}$，从而导致初始偏差。随着 $L$ 的增加，$\\mu_{\\mathrm{recon}}(L)$ 减小，导致HU偏差变得越来越负。由于EID的射线束硬化效应更强，我们预计对于任何 $L  0$，负偏差 $\\mathrm{HU}_{\\mathrm{bias},\\mathrm{EID}}(L)$ 的绝对值将大于 $\\mathrm{HU}_{\\mathrm{bias},\\mathrm{PCD}}(L)$。\n\n计算过程如下：\n1.  定义常数 $kVp=120$, $c=2\\times10^5$, $a=0.17$, $b=5130$, 和 $E_{\\mathrm{mono}}=70$。\n2.  建立离散能量网格，为一个从 15 到 120 的整数数组 $E$。\n3.  对网格中的每个能量 $E$，计算X射线谱 $S(E) = E(kVp - E)\\exp(-c/E^3)$。\n4.  对每个能量 $E$，计算水的衰减系数 $\\mu_{\\mathrm{w}}(E) = a + b/E^3$。\n5.  计算参考衰减 $\\mu_{\\mathrm{ref}} = \\mu_{\\mathrm{w}}(70)$。\n6.  计算总入射信号 $I_{0,\\mathrm{PCD}} = \\sum_E S(E)$ 和 $I_{0,\\mathrm{EID}} = \\sum_E E\\,S(E)$。\n7.  对于测试套件 $\\{0, 1, 10, 30\\}$ 中的每个路径长度 $L$：\n    a. 如果 $L=0$，计算能谱平均衰减系数：\n       $\\mu_{\\mathrm{recon},\\mathrm{PCD}}(0) = \\frac{\\sum_E S(E)\\,\\mu_{\\mathrm{w}}(E)}{\\sum_E S(E)}$ 和 $\\mu_{\\mathrm{recon},\\mathrm{EID}}(0) = \\frac{\\sum_E E\\,S(E)\\,\\mu_{\\mathrm{w}}(E)}{\\sum_E E\\,S(E)}$。\n    b. 如果 $L  0$，计算透射信号：\n       $I_{\\mathrm{PCD}}(L) = \\sum_E S(E)\\,\\exp(-\\mu_{\\mathrm{w}}(E)\\,L)$ 和 $I_{\\mathrm{EID}}(L) = \\sum_E E\\,S(E)\\,\\exp(-\\mu_{\\mathrm{w}}(E)\\,L)$。然后计算重建的衰减系数：\n       $\\mu_{\\mathrm{recon},\\mathrm{PCD}}(L) = -\\frac{1}{L}\\ln(I_{\\mathrm{PCD}}(L)/I_{0,\\mathrm{PCD}})$ 和 $\\mu_{\\mathrm{recon},\\mathrm{EID}}(L) = -\\frac{1}{L}\\ln(I_{\\mathrm{EID}}(L)/I_{0,\\mathrm{EID}})$。\n    c. 对于每个探测器模型，使用公式 $\\mathrm{HU}_{\\mathrm{bias}} = 1000 \\times (\\mu_{\\mathrm{recon}}(L) - \\mu_{\\mathrm{ref}})/\\mu_{\\mathrm{ref}}$ 计算HU偏差。\n8.  收集并按规定格式化结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives, implements, and computes the reconstructed Hounsfield Unit (HU) bias\n    for a uniform water phantom, comparing Energy-Integrating Detector (EID)\n    and Photon-Counting Detector (PCD) models.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases_L = [0.0, 1.0, 10.0, 30.0]\n\n    # Define physical constants and model parameters\n    kvp = 120.0  # Peak voltage in kVp\n    c = 2.0e5    # Spectral filtration parameter (dimensionless)\n    a = 0.17     # Water attenuation constant (cm^-1)\n    b = 5130.0   # Water attenuation constant (cm^-1 * keV^3)\n    e_mono = 70.0  # Monoenergetic reference energy in keV\n\n    # Set up the discrete energy grid\n    # E is in keV, from 15 to 120 inclusive.\n    E = np.arange(15.0, 121.0, 1.0)\n\n    # 1. Calculate the incident X-ray spectrum S(E)\n    # The term (kvp - E) ensures the spectrum goes to zero at E = kvp.\n    # The exp(-c/E^3) term models inherent and added filtration.\n    S_E = E * (kvp - E) * np.exp(-c / E**3)\n\n    # 2. Calculate the energy-dependent linear attenuation coefficient of water mu_w(E)\n    mu_w_E = a + b / E**3\n\n    # 3. Calculate the monoenergetic reference attenuation mu_ref\n    mu_ref = a + b / e_mono**3\n\n    # 4. Calculate the incident (air) signals for PCD and EID\n    # I0_PCD is the sum of all photon counts (fluence)\n    I0_PCD = np.sum(S_E)\n    # I0_EID is the sum of all photon energies (energy fluence)\n    I0_EID = np.sum(E * S_E)\n\n    results = []\n    for L in test_cases_L:\n        # Case L = 0 (infinitesimal thickness)\n        if L == 0.0:\n            # Use the spectrally-averaged limit formulas provided\n            mu_recon_PCD = np.sum(S_E * mu_w_E) / I0_PCD\n            mu_recon_EID = np.sum(E * S_E * mu_w_E) / I0_EID\n        # Case L > 0\n        else:\n            # Calculate the exponential attenuation term for each energy\n            exp_term = np.exp(-mu_w_E * L)\n\n            # Calculate transmitted signals\n            I_PCD = np.sum(S_E * exp_term)\n            I_EID = np.sum(E * S_E * exp_term)\n\n            # Calculate reconstructed linear attenuation coefficients\n            # Guard against division by zero if a signal is zero, though unlikely here\n            if I_PCD == 0 or I_EID == 0:\n                # This case should not be reached with the given parameters\n                mu_recon_PCD = np.nan\n                mu_recon_EID = np.nan\n            else:\n                mu_recon_PCD = (-1.0 / L) * np.log(I_PCD / I0_PCD)\n                mu_recon_EID = (-1.0 / L) * np.log(I_EID / I0_EID)\n\n        # Calculate HU bias for both models\n        # HU_bias = 1000 * (mu_recon - mu_ref) / mu_ref\n        hu_bias_PCD = 1000.0 * (mu_recon_PCD - mu_ref) / mu_ref\n        hu_bias_EID = 1000.0 * (mu_recon_EID - mu_ref) / mu_ref\n        \n        # Round to three decimal places and append to results\n        # The required order is [EID, PCD]\n        results.append([round(hu_bias_EID, 3), round(hu_bias_PCD, 3)])\n\n    # Format the final output string as a Python-style list of lists\n    # Each sublist is converted to a string, then they are joined by commas,\n    # and finally enclosed in the outer list brackets.\n    output_str = f\"[{','.join(map(str, results))}]\"\n\n    # The final print statement must produce only the single-line specified format\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}