{
    "hands_on_practices": [
        {
            "introduction": "Before we can calculate specific equilibrium potentials, it's essential to understand the fundamental energy scale that governs them. This first practice takes you back to first principles, showing how the term $RT/F$, or the 'thermal voltage', arises from the balance between thermal energy ($k_B T$) and electrical work ($eV$). By deriving this crucial factor from fundamental constants, you will gain a deeper appreciation for why temperature is a key variable in all bioelectric phenomena and see how microscopic, single-particle physics scales up to the macroscopic, per-mole quantities we use in electrophysiology .",
            "id": "5028022",
            "problem": "A monovalent ion crossing a neuronal membrane at electrochemical equilibrium is governed by the balance between thermal energy and electrical work. Starting only from the definitions of the Boltzmann constant ($k_B$), elementary charge ($e$), Avogadro constant ($N_A$), the gas constant ($R$), and the Faraday constant ($F$), show how the characteristic voltage scale that appears in equilibrium relations emerges. In particular:\n- Begin from the statement that the electrical work to move a charge $q$ through a potential difference $V$ is $qV$, and that the characteristic thermal energy per particle is $k_B T$ at absolute temperature $T$.\n- Use the definitions $R = N_A k_B$ and $F = N_A e$ to convert per-particle quantities to per-mole quantities and derive an expression for $RT/F$ in terms of fundamental constants.\n- Explain why this ratio sets the energy-per-charge scale (sometimes called the thermal voltage) relevant for equilibrium potentials of monovalent ions.\n\nThen, using the exact constant values $k_B = 1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$, $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$, $N_A = 6.02214076 \\times 10^{23}\\,\\mathrm{mol^{-1}}$, compute $RT/F$ at $T = 298\\,\\mathrm{K}$ and $T = 310\\,\\mathrm{K}$. Express both results in millivolts. Finally, report as your single final answer the ratio $\\left(\\frac{RT}{F}\\right)_{310} \\big/ \\left(\\frac{RT}{F}\\right)_{298}$ rounded to four significant figures. The ratio is dimensionless, but the intermediate voltages must be expressed in $\\mathrm{mV}$ to demonstrate and justify the commonly used approximations $25.7\\,\\mathrm{mV}$ at $T=298\\,\\mathrm{K}$ and $26.7\\,\\mathrm{mV}$ at $T=310\\,\\mathrm{K}$.",
            "solution": "The problem is validated as scientifically grounded, well-posed, objective, and complete. It is based on fundamental principles of statistical mechanics and electromagnetism applied to neurobiology. All required constants and conditions are provided, and the tasks are logically structured and solvable.\n\nThe problem asks for a derivation of the characteristic voltage scale, an explanation of its significance, a calculation of its value at two temperatures, and a final calculation of the ratio of these values.\n\nThe core principle of electrochemical equilibrium for an ion across a membrane is the balance between the work done by the electrical field and the effective \"work\" done by thermal agitation that drives diffusion. We are instructed to start from the single-particle perspective.\n\nThe electrical work $W_{elec}$ required to move a single particle with charge $q$ across an electric potential difference $V$ is given by:\n$$\nW_{elec} = qV\n$$\nFor a monovalent ion, the charge $q$ is equal to the elementary charge, $e$. Thus, for a single monovalent ion, the electrical work is $eV$.\n\nThe characteristic thermal energy $E_{th}$ of a single particle at an absolute temperature $T$ is given by:\n$$\nE_{th} = k_B T\n$$\nwhere $k_B$ is the Boltzmann constant.\n\nAt electrochemical equilibrium, the electrical energy difference across the membrane is balanced by the entropic contribution related to the concentration difference. The Nernst potential is the specific voltage at which this balance occurs. The relationship between the concentration gradient and the electrical potential is mediated by the thermal energy. The ratio of concentrations is given by the Boltzmann factor, which relates the probability of states with different energies. The energy difference for a monovalent ion moving across the potential $V$ is $eV$. Thus, the equilibrium is described by an equation where the potential $V$ is proportional to the thermal energy per unit charge, $k_B T / e$. This ratio, $k_B T / e$, emerges as the natural voltage scale that determines the magnitude of the equilibrium potential for a given concentration ratio. It has units of Joules per Coulomb, which is Volts.\n\nThe problem asks to show the equivalence of this per-particle scale to the per-mole scale using the gas constant $R$ and the Faraday constant $F$. We are given the definitions:\n$$\nR = N_A k_B\n$$\n$$\nF = N_A e\n$$\nwhere $N_A$ is the Avogadro constant.\n\nUsing these definitions, we can construct the ratio $RT/F$ and show its relationship to the fundamental constants $k_B$, $T$, and $e$.\n$$\n\\frac{RT}{F} = \\frac{(N_A k_B) T}{(N_A e)}\n$$\nThe Avogadro constant $N_A$ cancels from the numerator and the denominator, yielding:\n$$\n\\frac{RT}{F} = \\frac{k_B T}{e}\n$$\nThis derivation formally demonstrates that the quantity $RT/F$, which arises in the molar form of the Nernst equation, is identical to the quantity $k_B T/e$ that arises from single-particle considerations. This ratio is often termed the \"thermal voltage\", $V_T$. It represents the voltage required to perform an amount of electrical work on a unit charge ($e$ or $F$) equal to the characteristic thermal energy ($k_B T$ or $RT$). It is the fundamental energy-per-charge scale that connects the electrical and chemical (diffusive) driving forces at equilibrium.\n\nNext, we are tasked with computing the value of this thermal voltage at two specific temperatures using the provided exact values for the constants:\n$k_B = 1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$\n$e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$\n\nCase 1: $T_1 = 298\\,\\mathrm{K}$ (approximately $25^\\circ\\mathrm{C}$)\nThe thermal voltage, which we denote $V_{T,1}$, is:\n$$\nV_{T,1} = \\frac{k_B T_1}{e} = \\frac{(1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}) \\times (298\\,\\mathrm{K})}{1.602176634 \\times 10^{-19}\\,\\mathrm{C}}\n$$\n$$\nV_{T,1} \\approx \\frac{4.114334 \\times 10^{-21}\\,\\mathrm{J}}{1.602176634 \\times 10^{-19}\\,\\mathrm{C}} \\approx 0.0256795\\,\\mathrm{V}\n$$\nExpressed in millivolts, this is $25.6795\\,\\mathrm{mV}$. This confirms the commonly used approximation of $25.7\\,\\mathrm{mV}$ at this temperature.\n\nCase 2: $T_2 = 310\\,\\mathrm{K}$ (physiological temperature, approximately $37^\\circ\\mathrm{C}$)\nThe thermal voltage, $V_{T,2}$, is:\n$$\nV_{T,2} = \\frac{k_B T_2}{e} = \\frac{(1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}) \\times (310\\,\\mathrm{K})}{1.602176634 \\times 10^{-19}\\,\\mathrm{C}}\n$$\n$$\nV_{T,2} \\approx \\frac{4.2799919 \\times 10^{-21}\\,\\mathrm{J}}{1.602176634 \\times 10^{-19}\\,\\mathrm{C}} \\approx 0.0267139\\,\\mathrm{V}\n$$\nExpressed in millivolts, this is $26.7139\\,\\mathrm{mV}$. This confirms the commonly used approximation of $26.7\\,\\mathrm{mV}$ at this temperature.\n\nFinally, we must compute the ratio of the thermal voltage at $T_2 = 310\\,\\mathrm{K}$ to that at $T_1 = 298\\,\\mathrm{K}$.\n$$\n\\text{Ratio} = \\frac{\\left(\\frac{RT}{F}\\right)_{310}}{\\left(\\frac{RT}{F}\\right)_{298}} = \\frac{V_{T,2}}{V_{T,1}}\n$$\nSince $V_T = k_B T / e$, the ratio can be simplified:\n$$\n\\text{Ratio} = \\frac{k_B T_2 / e}{k_B T_1 / e} = \\frac{T_2}{T_1}\n$$\nThe constants $k_B$, $R$, $e$, and $F$ cancel out, leaving a simple ratio of the absolute temperatures.\n$$\n\\text{Ratio} = \\frac{310\\,\\mathrm{K}}{298\\,\\mathrm{K}} \\approx 1.040268456...\n$$\nThe problem requires this result to be rounded to four significant figures.\n$$\n\\text{Ratio} \\approx 1.040\n$$",
            "answer": "$$\\boxed{1.040}$$"
        },
        {
            "introduction": "Real ion channels are rarely permeable to just one type of ion, and their collective behavior determines a neuron's response to synaptic input. This exercise moves from the single-ion Nernst potential to the more realistic scenario of an AMPA receptor, which allows both sodium and potassium ions to pass through. You will apply the Goldman-Hodgkin-Katz (GHK) equation to calculate the channel's reversal potential ($E_{\\text{rev}}$), a critical value that determines whether activating the channel will excite or inhibit the neuron under physiological conditions .",
            "id": "5028003",
            "problem": "An excitatory synapse expresses an AMPA receptor channel (alpha-amino-3-hydroxy-5-methyl-4-isoxazolepropionic acid) that is permeable to sodium and potassium ions but not to chloride or calcium. Consider a neuron whose intracellular concentrations are $[\\text{Na}^{+}]_{i} = 12\\,\\text{mM}$ and $[\\text{K}^{+}]_{i} = 140\\,\\text{mM}$, bathed in an extracellular solution with $[\\text{Na}^{+}]_{o} = 145\\,\\text{mM}$ and $[\\text{K}^{+}]_{o} = 4\\,\\text{mM}$. The channel’s relative permeabilities are $P_{\\text{Na}} = 1.2$ and $P_{\\text{K}} = 1.0$ for sodium and potassium, respectively. Assume both ions are monovalent cations with valence $z = +1$, the temperature is constant at $T = 310\\,\\text{K}$, and use the universal gas constant $R = 8.314\\,\\text{J}\\,\\text{mol}^{-1}\\,\\text{K}^{-1}$ and the Faraday constant $F = 96485\\,\\text{C}\\,\\text{mol}^{-1}$. \n\nStarting from the condition that the reversal potential is the membrane potential at which the net current through the channel is zero, and invoking the constant-field approximation together with independence of ion movement, determine the channel reversal potential $E_{\\text{rev}}$. Express your final answer in millivolts and round to three significant figures.",
            "solution": "The reversal potential, $E_{\\text{rev}}$, is defined as the membrane potential at which the net current of all permeable ions across the membrane is zero. The problem requires a derivation based on the constant-field approximation and the principle of ionic independence. These assumptions lead to the Goldman-Hodgkin-Katz (GHK) voltage equation.\n\nThe total current density, $J_{\\text{tot}}$, through the channel is the sum of the individual current densities for each permeable ion, in this case, sodium ($J_{\\text{Na}}$) and potassium ($J_{\\text{K}}$). The reversal potential is the membrane potential $E_m$ for which $J_{\\text{tot}} = J_{\\text{Na}} + J_{\\text{K}} = 0$.\n\nFor a set of monovalent cations, the general GHK voltage equation gives the membrane potential $E_m$ as:\n$$E_m = \\frac{RT}{F} \\ln \\left( \\frac{\\sum_{i} P_{C_i} [C_i]_{\\text{o}}}{\\sum_{i} P_{C_i} [C_i]_{\\text{i}}} \\right)$$\nwhere $R$ is the universal gas constant, $T$ is the absolute temperature, $F$ is the Faraday constant, $P_{C_i}$ is the permeability of the $i$-th cation $C_i$, and $[C_i]_{\\text{o}}$ and $[C_i]_{\\text{i}}$ are its extracellular and intracellular concentrations, respectively.\n\nFor the given AMPA receptor channel, which is permeable only to $\\text{Na}^{+}$ and $\\text{K}^{+}$ ions (both with valence $z=+1$), the reversal potential $E_{\\text{rev}}$ is given by:\n$$E_{\\text{rev}} = \\frac{RT}{F} \\ln \\left( \\frac{P_{\\text{Na}}[\\text{Na}^{+}]_{\\text{o}} + P_{\\text{K}}[\\text{K}^{+}]_{\\text{o}}}{P_{\\text{Na}}[\\text{Na}^{+}]_{\\text{i}} + P_{\\text{K}}[\\text{K}^{+}]_{\\text{i}}} \\right)$$\n\nWe are given the following values:\n- $R = 8.314\\,\\text{J}\\,\\text{mol}^{-1}\\,\\text{K}^{-1}$\n- $T = 310\\,\\text{K}$\n- $F = 96485\\,\\text{C}\\,\\text{mol}^{-1}$\n- $P_{\\text{Na}} = 1.2$\n- $P_{\\text{K}} = 1.0$\n- $[\\text{Na}^{+}]_{\\text{o}} = 145\\,\\text{mM}$\n- $[\\text{K}^{+}]_{\\text{o}} = 4\\,\\text{mM}$\n- $[\\text{Na}^{+}]_{\\text{i}} = 12\\,\\text{mM}$\n- $[\\text{K}^{+}]_{\\text{i}} = 140\\,\\text{mM}$\n\nFirst, we calculate the thermal voltage term, $\\frac{RT}{F}$:\n$$\\frac{RT}{F} = \\frac{(8.314\\,\\text{J}\\,\\text{mol}^{-1}\\,\\text{K}^{-1}) \\times (310\\,\\text{K})}{96485\\,\\text{C}\\,\\text{mol}^{-1}} \\approx 0.026712\\,\\text{V}$$\n\nNext, we calculate the numerator and denominator of the argument of the natural logarithm. The concentration units ($\\text{mM}$) cancel out, so we can use the numerical values directly.\n\nThe numerator is:\n$$P_{\\text{Na}}[\\text{Na}^{+}]_{\\text{o}} + P_{\\text{K}}[\\text{K}^{+}]_{\\text{o}} = (1.2 \\times 145) + (1.0 \\times 4) = 174 + 4 = 178$$\n\nThe denominator is:\n$$P_{\\text{Na}}[\\text{Na}^{+}]_{\\text{i}} + P_{\\text{K}}[\\text{K}^{+}]_{\\text{i}} = (1.2 \\times 12) + (1.0 \\times 140) = 14.4 + 140 = 154.4$$\n\nNow, substitute these into the GHK equation:\n$$E_{\\text{rev}} = \\left( \\frac{RT}{F} \\right) \\ln \\left( \\frac{178}{154.4} \\right)$$\n$$E_{\\text{rev}} \\approx (0.026712\\,\\text{V}) \\times \\ln(1.1528497...)$$\n$$E_{\\text{rev}} \\approx (0.026712\\,\\text{V}) \\times (0.142273...)$$\n$$E_{\\text{rev}} \\approx 0.0038002\\,\\text{V}$$\n\nThe problem requires the answer in millivolts ($\\text{mV}$). To convert from volts to millivolts, we multiply by $1000$:\n$$E_{\\text{rev}} \\approx 0.0038002 \\times 1000\\,\\text{mV} = 3.8002\\,\\text{mV}$$\n\nFinally, rounding to three significant figures, we get:\n$$E_{\\text{rev}} = 3.80\\,\\text{mV}$$",
            "answer": "$$\n\\boxed{3.80}\n$$"
        },
        {
            "introduction": "Equilibrium potentials are not static; they change as ions flow across the membrane, altering the underlying concentration gradients, especially in small compartments like dendritic spines. In this advanced practice, you will build a dynamic simulation to model how opening sodium channels affects the intracellular sodium concentration and, consequently, the sodium equilibrium potential ($E_{\\text{Na}}$) over time. This computational exercise  bridges the gap from static calculations to the dynamic nature of neuronal signaling, providing quantitative insight into how ion flux impacts the driving forces that shape electrical signals in the brain.",
            "id": "5028020",
            "problem": "You will write a complete, runnable program that models how a brief opening of a population of sodium-selective channels alters the intracellular sodium concentration and, consequently, the sodium equilibrium potential. The modeling must be grounded in first principles: electrical current is charge per time, monovalent ionic flux relates charge to moles through Faraday’s constant, and electrochemical equilibrium equates electrochemical potentials in ideal dilute solutions.\n\nAssumptions and definitions to be used:\n- Sodium is monovalent: valence $z=+1$.\n- Activity equals concentration for ideal dilute solutions.\n- Open channels behave as ideal ohmic conductors with a reversal at the ion’s equilibrium potential; the total conductance is the number of open channels times the single-channel conductance.\n- Positive electrical current corresponds to positive charge flowing out of the compartment; negative current corresponds to positive charge flowing into the compartment.\n- The intracellular compartment is well-mixed with volume $V$.\n- Constants: gas constant $R=8.314462618\\,\\mathrm{J\\cdot mol^{-1}\\cdot K^{-1}}$, Faraday constant $F=96485.33212\\,\\mathrm{C\\cdot mol^{-1}}$.\n\nYour program must, for each test case, do all of the following from first principles:\n1) From electrochemical equilibrium for a monovalent ion in an ideal dilute solution, derive an expression for the sodium equilibrium potential $E_{\\mathrm{Na}}$ that depends on temperature $T$ and the instantaneous intracellular and extracellular sodium concentrations. Then compute the instantaneous $E_{\\mathrm{Na}}(t)$ throughout the simulation.\n2) Use the definition of electrical current as charge per unit time and the relationship between charge and moles for monovalent ions to derive the time evolution of intracellular sodium concentration $[{\\mathrm{Na}}^+]_i(t)$ when a set of sodium channels is open for a finite duration. Assume the membrane potential $V_m$ is held constant (voltage-clamp).\n3) Integrate in time over the open interval using a fixed time step $\\Delta t$ to update $[{\\mathrm{Na}}^+]_i(t)$ and thus $E_{\\mathrm{Na}}(t)$, using an explicit method consistent with the first-principles relationships above.\n4) After the channels close, report the final sodium equilibrium potential $E_{\\mathrm{Na,final}}$ obtained from the final $[{\\mathrm{Na}}^+]_i$ and the given $[{\\mathrm{Na}}^+]_o$ and $T$.\n\nPhysical and numerical units:\n- Concentrations must be in $\\mathrm{mol\\cdot L^{-1}}$.\n- Volume must be in $\\mathrm{L}$.\n- Temperature must be in $\\mathrm{K}$.\n- Conductance must be in $\\mathrm{S}$.\n- Membrane potential and equilibrium potentials must be in $\\mathrm{V}$; however, the required output is in $\\mathrm{mV}$.\n- Time must be in $\\mathrm{s}$.\n\nSign conventions and modeling relations (to be implemented using first principles, not as provided formulas): Define the total sodium-channel current as the product of total conductance and the driving force, with the positive sign indicating outward flow of positive charge. Relate the rate of change of intracellular sodium moles to the electrical current using the charge-to-mole conversion for $z=+1$, and relate moles to concentration through the compartment volume.\n\nNumerical integration requirement:\n- Use a fixed time step $\\Delta t$ to advance the intracellular concentration over the open interval of duration $\\tau_{\\mathrm{open}}$. Choose the update so that more inward (negative) current increases $[{\\mathrm{Na}}^+]_i$ and outward (positive) current decreases it.\n- Ensure the intracellular concentration remains positive during the computation.\n\nTest suite:\nEach test case is a tuple with fields\n$\\left([{\\mathrm{Na}}^+]_{i0}, [{\\mathrm{Na}}^+]_o, T, V, N_{\\mathrm{open}}, g_{\\mathrm{single}}, V_m, \\tau_{\\mathrm{open}}, \\Delta t, \\mathrm{VmEqualsENa0}\\right)$\nordered as:\n- $[{\\mathrm{Na}}^+]_{i0}$ in $\\mathrm{mol\\cdot L^{-1}}$,\n- $[{\\mathrm{Na}}^+]_o$ in $\\mathrm{mol\\cdot L^{-1}}$,\n- $T$ in $\\mathrm{K}$,\n- $V$ in $\\mathrm{L}$,\n- $N_{\\mathrm{open}}$ (integer count),\n- $g_{\\mathrm{single}}$ in $\\mathrm{S}$,\n- $V_m$ in $\\mathrm{V}$,\n- $\\tau_{\\mathrm{open}}$ in $\\mathrm{s}$,\n- $\\Delta t$ in $\\mathrm{s}$,\n- $\\mathrm{VmEqualsENa0}$ is a boolean flag: if true, ignore the provided $V_m$ and instead set $V_m$ equal to the initial equilibrium potential implied by $[{\\mathrm{Na}}^+]_{i0}$, $[{\\mathrm{Na}}^+]_o$, and $T$.\n\nProvide exactly the following test cases:\n- Case $1$: $\\left(0.012,\\,0.145,\\,310.0,\\,1.0\\times 10^{-15},\\,10,\\,1.0\\times 10^{-11},\\,-0.065,\\,1.0\\times 10^{-3},\\,1.0\\times 10^{-6},\\,\\text{False}\\right)$.\n- Case $2$: $\\left(0.012,\\,0.145,\\,310.0,\\,1.0\\times 10^{-15},\\,0,\\,1.0\\times 10^{-11},\\,-0.065,\\,1.0\\times 10^{-3},\\,1.0\\times 10^{-6},\\,\\text{False}\\right)$.\n- Case $3$: $\\left(0.012,\\,0.145,\\,310.0,\\,1.0\\times 10^{-15},\\,50,\\,1.0\\times 10^{-11},\\,0.0,\\,1.0\\times 10^{-3},\\,1.0\\times 10^{-6},\\,\\text{True}\\right)$.\n- Case $4$: $\\left(0.012,\\,0.145,\\,310.0,\\,1.0\\times 10^{-18},\\,10,\\,1.0\\times 10^{-11},\\,-0.065,\\,1.0\\times 10^{-3},\\,1.0\\times 10^{-7},\\,\\text{False}\\right)$.\n- Case $5$: $\\left(0.012,\\,0.145,\\,310.0,\\,1.0\\times 10^{-15},\\,10,\\,1.0\\times 10^{-11},\\,0.10,\\,1.0\\times 10^{-3},\\,1.0\\times 10^{-6},\\,\\text{False}\\right)$.\n\nAnswer specification:\n- For each test case, your program must output the final sodium equilibrium potential $E_{\\mathrm{Na,final}}$ in $\\mathrm{mV}$, rounded to exactly six decimal places.\n- The final output must be a single line containing a comma-separated list enclosed in square brackets, for example, $\\left[\\text{result}_1,\\text{result}_2,\\ldots\\right]$, with no spaces.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5]$). Each $\\text{result}_k$ must be a float in $\\mathrm{mV}$ rounded to six decimal places.",
            "solution": "The problem requires the development of a numerical model to simulate the change in intracellular sodium concentration, $[{\\mathrm{Na}}^+]_i$, and the corresponding sodium equilibrium potential, $E_{\\mathrm{Na}}$, due to ionic current through sodium-selective channels. The solution is derived from first principles of electrochemistry and circuit theory as applied to neurobiology.\n\n**1. Derivation of the Sodium Equilibrium Potential ($E_{\\mathrm{Na}}$)**\n\nThe equilibrium potential for an ion is the membrane potential at which the net flow of that ion across the membrane is zero. This condition is met when the electrical work required to move an ion across the membrane is equal and opposite to the chemical work done by the concentration gradient. The electrochemical potential, $\\mu_j$, for an ionic species $j$ is given by:\n\n$$ \\mu_j = \\mu_j^0 + RT \\ln(a_j) + z_j F V $$\n\nwhere $\\mu_j^0$ is the standard chemical potential, $R$ is the universal gas constant ($8.314462618\\,\\mathrm{J\\cdot mol^{-1}\\cdot K^{-1}}$), $T$ is the absolute temperature in Kelvin, $a_j$ is the chemical activity of the ion, $z_j$ is its valence, $F$ is the Faraday constant ($96485.33212\\,\\mathrm{C\\cdot mol^{-1}}$), and $V$ is the electrical potential of the compartment.\n\nAt equilibrium, the electrochemical potential of sodium inside the cell, $\\mu_{\\mathrm{Na,i}}$, must equal that outside the cell, $\\mu_{\\mathrm{Na,o}}$:\n\n$$ \\mu_{\\mathrm{Na,i}} = \\mu_{\\mathrm{Na,o}} $$\n$$ \\mu_{\\mathrm{Na}}^0 + RT \\ln(a_{\\mathrm{Na,i}}) + z_{\\mathrm{Na}} F V_i = \\mu_{\\mathrm{Na}}^0 + RT \\ln(a_{\\mathrm{Na,o}}) + z_{\\mathrm{Na}} F V_o $$\n\nThe standard potential $\\mu_{\\mathrm{Na}}^0$ cancels. Rearranging the terms to solve for the potential difference across the membrane, $V_m = V_i - V_o$, which at equilibrium is the equilibrium potential $E_{\\mathrm{Na}}$:\n\n$$ z_{\\mathrm{Na}} F (V_i - V_o) = RT (\\ln(a_{\\mathrm{Na,o}}) - \\ln(a_{\\mathrm{Na,i}})) $$\n$$ z_{\\mathrm{Na}} F E_{\\mathrm{Na}} = RT \\ln\\left(\\frac{a_{\\mathrm{Na,o}}}{a_{\\mathrm{Na,i}}}\\right) $$\n\nThe problem states that for ideal dilute solutions, activity can be replaced by molar concentration ($a_j = [j]$) and that sodium is a monovalent cation ($z_{\\mathrm{Na}} = +1$). This yields the Nernst equation for sodium:\n\n$$ E_{\\mathrm{Na}}(t) = \\frac{RT}{F} \\ln\\left(\\frac{[{\\mathrm{Na}}^+]_o}{[{\\mathrm{Na}}^+]_i(t)}\\right) $$\n\nThis equation allows for the calculation of the instantaneous sodium equilibrium potential from the intracellular and extracellular sodium concentrations and the temperature.\n\n**2. Derivation of the Time Evolution of Intracellular Sodium Concentration**\n\nThe change in the intracellular sodium concentration over time is governed by the flux of sodium ions across the cell membrane. This flux is represented by the electrical current $I_{\\mathrm{Na}}$.\n\nFirst, the sodium current $I_{\\mathrm{Na}}$ is modeled using Ohm's law. The open channels provide a total conductance $G_{\\mathrm{Na}}$, and the net driving force is the difference between the membrane potential $V_m$ and the sodium equilibrium potential $E_{\\mathrm{Na}}$. The current is positive for outward flow of positive charge:\n\n$$ I_{\\mathrm{Na}}(t) = G_{\\mathrm{Na}} (V_m - E_{\\mathrm{Na}}(t)) $$\n\nThe total conductance $G_{\\mathrm{Na}}$ is the product of the number of open channels, $N_{\\mathrm{open}}$, and the single-channel conductance, $g_{\\mathrm{single}}$:\n\n$$ G_{\\mathrm{Na}} = N_{\\mathrm{open}} \\cdot g_{\\mathrm{single}} $$\n\nSecond, electrical current is defined as the rate of charge flow, $I = dQ/dt$. An outward current $I_{\\mathrm{Na}}$ corresponds to a rate of positive charge leaving the cell. The rate of charge entering the cell is therefore $-I_{\\mathrm{Na}}(t)$.\n\nThird, the Faraday constant $F$ links charge $Q$ to the number of moles $n$ for an ion with valence $z$ via $Q = n z F$. For sodium ($z=+1$), the number of moles of sodium entering the cell per unit time is related to the incoming charge flow:\n\n$$ \\frac{dn_{\\mathrm{Na,i}}}{dt} = \\frac{-I_{\\mathrm{Na}}(t)}{z_{\\mathrm{Na}} F} = \\frac{-I_{\\mathrm{Na}}(t)}{F} $$\n\nFourth, for a well-mixed intracellular compartment of constant volume $V$, the number of moles of sodium is $n_{\\mathrm{Na,i}}(t) = [{\\mathrm{Na}}^+]_i(t) \\cdot V$. Differentiating with respect to time gives:\n\n$$ \\frac{dn_{\\mathrm{Na,i}}}{dt} = V \\frac{d[{\\mathrm{Na}}^+]_i}{dt} $$\n\nBy equating the two expressions for $dn_{\\mathrm{Na,i}}/dt$, we obtain the ordinary differential equation (ODE) for the intracellular sodium concentration:\n\n$$ V \\frac{d[{\\mathrm{Na}}^+]_i}{dt} = \\frac{-I_{\\mathrm{Na}}(t)}{F} = -\\frac{G_{\\mathrm{Na}}}{F} (V_m - E_{\\mathrm{Na}}(t)) $$\n$$ \\frac{d[{\\mathrm{Na}}^+]_i}{dt} = -\\frac{N_{\\mathrm{open}} \\cdot g_{\\mathrm{single}}}{V \\cdot F} \\left(V_m - \\frac{RT}{F} \\ln\\left(\\frac{[{\\mathrm{Na}}^+]_o}{[{\\mathrm{Na}}^+]_i(t)}\\right)\\right) $$\n\nThis equation describes how $[{\\mathrm{Na}}^+]_i$ changes over time when the channels are open.\n\n**3. Numerical Integration Method**\n\nThe problem requires solving this ODE numerically over a finite time interval $\\tau_{\\mathrm{open}}$ using a fixed time step $\\Delta t$. We will use the explicit forward Euler method. Let $[{\\mathrm{Na}}^+]_i^k$ denote the intracellular sodium concentration at time step $k$. The concentration at the next time step, $k+1$, is approximated as:\n\n$$ [{\\mathrm{Na}}^+]_i^{k+1} = [{\\mathrm{Na}}^+]_i^k + \\Delta t \\cdot \\left(\\frac{d[{\\mathrm{Na}}^+]_i}{dt}\\right)\\bigg|_{t=k\\Delta t} $$\n\nSubstituting the expression for the derivative:\n\n$$ [{\\mathrm{Na}}^+]_i^{k+1} = [{\\mathrm{Na}}^+]_i^k - \\Delta t \\cdot \\frac{G_{\\mathrm{Na}}}{V \\cdot F} (V_m - E_{\\mathrm{Na}}^k) $$\n\nwhere $E_{\\mathrm{Na}}^k$ is the equilibrium potential calculated using $[{\\mathrm{Na}}^+]_i^k$:\n\n$$ E_{\\mathrm{Na}}^k = \\frac{RT}{F} \\ln\\left(\\frac{[{\\mathrm{Na}}^+]_o}{[{\\mathrm{Na}}^+]_i^k}\\right) $$\n\nThis update rule is applied iteratively.\n\n**4. Algorithm Summary**\n\nFor each test case, the following procedure is implemented:\n1.  Initialize the constants $R = 8.314462618\\,\\mathrm{J\\cdot mol^{-1}\\cdot K^{-1}}$ and $F = 96485.33212\\,\\mathrm{C\\cdot mol^{-1}}$.\n2.  Unpack the test case parameters: initial intracellular sodium concentration $[{\\mathrm{Na}}^+]_{i0}$, extracellular sodium concentration $[{\\mathrm{Na}}^+]_o$, temperature $T$, volume $V$, number of open channels $N_{\\mathrm{open}}$, single-channel conductance $g_{\\mathrm{single}}$, membrane potential $V_m$, channel open duration $\\tau_{\\mathrm{open}}$, and time step $\\Delta t$.\n3.  Handle the `VmEqualsENa0` flag: If `True`, calculate the initial equilibrium potential $E_{\\mathrm{Na,0}} = \\frac{RT}{F} \\ln([{\\mathrm{Na}}^+]_o / [{\\mathrm{Na}}^+]_{i0})$ and set $V_m = E_{\\mathrm{Na,0}}$.\n4.  Calculate the total number of integration steps, $N_{\\mathrm{steps}} = \\mathrm{round}(\\tau_{\\mathrm{open}} / \\Delta t)$.\n5.  Set the current intracellular sodium concentration, $[{\\mathrm{Na}}^+]_i$, to its initial value $[{\\mathrm{Na}}^+]_{i0}$.\n6.  Iterate $N_{\\mathrm{steps}}$ times:\n    a. Calculate the current equilibrium potential $E_{\\mathrm{Na}}$ using the current $[{\\mathrm{Na}}^+]_i$.\n    b. Calculate the total sodium current $I_{\\mathrm{Na}} = N_{\\mathrm{open}} \\cdot g_{\\mathrm{single}} \\cdot (V_m - E_{\\mathrm{Na}})$.\n    c. Calculate the change in molar sodium concentration over the time step $\\Delta t$: $\\Delta[{\\mathrm{Na}}^+]_i = -I_{\\mathrm{Na}} \\cdot \\Delta t / (V \\cdot F)$.\n    d. Update the concentration: $[{\\mathrm{Na}}^+]_i = [{\\mathrm{Na}}^+]_i + \\Delta[{\\mathrm{Na}}^+]_i$.\n7.  After the loop, the final concentration is $[{\\mathrm{Na}}^+]_{i, \\mathrm{final}}$.\n8.  Calculate the final equilibrium potential $E_{\\mathrm{Na,final}} = \\frac{RT}{F} \\ln([{\\mathrm{Na}}^+]_o / [{\\mathrm{Na}}^+]_{i, \\mathrm{final}})$.\n9.  Convert $E_{\\mathrm{Na,final}}$ from Volts to millivolts by multiplying by $1000$ and format the result.\n\nThis procedure is applied to each test case to generate the final reported values.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the final sodium equilibrium potential based on a simulation of\n    ion channel activity, derived from first principles.\n    \"\"\"\n    # Define physical constants as specified\n    R = 8.314462618  # Universal gas constant in J·mol⁻¹·K⁻¹\n    F = 96485.33212  # Faraday constant in C·mol⁻¹\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        # ([Na+]_i0, [Na+]_o, T, V, N_open, g_single, V_m, tau_open, dt, VmEqualsENa0)\n        # Case 1: Standard influx\n        (0.012, 0.145, 310.0, 1.0e-15, 10, 1.0e-11, -0.065, 1.0e-3, 1.0e-6, False),\n        # Case 2: Control with no open channels\n        (0.012, 0.145, 310.0, 1.0e-15, 0, 1.0e-11, -0.065, 1.0e-3, 1.0e-6, False),\n        # Case 3: Control with Vm set to initial E_Na\n        (0.012, 0.145, 310.0, 1.0e-15, 50, 1.0e-11, 0.0, 1.0e-3, 1.0e-6, True),\n        # Case 4: Larger concentration change due to small volume\n        (0.012, 0.145, 310.0, 1.0e-18, 10, 1.0e-11, -0.065, 1.0e-3, 1.0e-7, False),\n        # Case 5: Outward current (efflux)\n        (0.012, 0.145, 310.0, 1.0e-15, 10, 1.0e-11, 0.10, 1.0e-3, 1.0e-6, False),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        Na_i_0, Na_o, T, V, N_open, g_single, Vm, tau_open, dt, VmEqualsENa0 = case\n\n        # Initialize intracellular sodium concentration from the test case\n        Na_i = Na_i_0\n        \n        # Handle the VmEqualsENa0 flag: if True, Vm is set to the initial E_Na\n        if VmEqualsENa0:\n            if Na_i > 0:\n                E_Na_initial = (R * T / F) * np.log(Na_o / Na_i)\n                Vm = E_Na_initial\n\n        # Calculate total conductance\n        G_Na = N_open * g_single\n\n        # The number of steps is the total open time divided by the time step.\n        # Use round() to mitigate potential floating-point inaccuracies.\n        num_steps = int(round(tau_open / dt))\n\n        # Simulate over the open interval using the explicit forward Euler method\n        for _ in range(num_steps):\n            # Ensure intracellular concentration remains positive for the Nernst equation\n            if Na_i = 0:\n                break\n                \n            # 1. Calculate the instantaneous sodium equilibrium potential (Nernst equation)\n            E_Na = (R * T / F) * np.log(Na_o / Na_i)\n            \n            # 2. Calculate the total sodium current (Ohm's law)\n            # Positive current is outward flow of positive charge.\n            I_Na = G_Na * (Vm - E_Na)\n            \n            # 3. Calculate the change in intracellular sodium concentration\n            # d[Na_i]/dt = -I_Na / (V * F)\n            # Integrate over one time step: delta_[Na_i] = dt * d[Na_i]/dt\n            delta_Na_i = -I_Na * dt / (V * F)\n\n            # 4. Update the intracellular sodium concentration\n            Na_i += delta_Na_i\n\n        # After the simulation, calculate the final equilibrium potential\n        Na_i_final = Na_i\n        \n        E_Na_final = np.nan # Default to NaN if concentration becomes non-positive\n        if Na_i_final > 0:\n            E_Na_final = (R * T / F) * np.log(Na_o / Na_i_final)\n\n        # Convert the final potential from Volts to millivolts\n        E_Na_final_mV = E_Na_final * 1000.0\n        results.append(E_Na_final_mV)\n\n    # Format the results to exactly six decimal places as strings\n    results_str = [f\"{res:.6f}\" for res in results]\n    \n    # Print the final output in the specified single-line format\n    print(f\"[{','.join(results_str)}]\")\n\n# Execute the main solver function\nsolve()\n```"
        }
    ]
}