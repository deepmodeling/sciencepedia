{
    "hands_on_practices": [
        {
            "introduction": "Understanding the mechanism of a drug's action is central to pharmacology. This practice provides a quantitative tool for this by introducing the Proportion of Treatment Effect (PTE), a metric that estimates how much of a drug's clinical benefit is mediated by a specific biomarker . Calculating the PTE from trial data is a foundational skill for assessing a biomarker's potential role as a surrogate endpoint.",
            "id": "4929656",
            "problem": "A randomized controlled trial (RCT) evaluates a new antihypertensive drug. The primary clinical outcome is the change in systolic blood pressure, denoted by $Y$, measured at $12$ weeks. A mechanistic biomarker, plasma renin activity, denoted by $B$, is measured at week $4$ and is hypothesized to lie on the causal pathway between treatment and the clinical outcome. Because treatment is randomized, the total treatment effect on the clinical outcome can be defined as the difference in the expected clinical outcome $Y$ between treated and control arms. The residual treatment effect after conditioning on the biomarker $B$ is defined as the difference in the expected clinical outcome $Y$ between treated and control arms when holding the biomarker $B$ fixed or otherwise adjusting for $B$ in the statistical model.\n\nFrom a linear model that does not include $B$, the estimated treatment effect indicates that the drug reduces the outcome by $\\Delta_{Y} = 8.4$ units. From a linear model that includes $B$ (and the same baseline covariates), the residual treatment effect after conditioning on $B$ indicates a reduction of $\\Delta_{Y|B} = 3.1$ units.\n\nStarting strictly from the above definitions of the total treatment effect and the residual treatment effect after conditioning on the biomarker, derive an expression for the proportion of the treatment effect explained by the biomarker and then compute its numerical value using the reported reductions $\\Delta_{Y}$ and $\\Delta_{Y|B}$. Express your final answer as a unitless decimal rounded to four significant figures. Do not include a percent sign.",
            "solution": "The setting is a randomized controlled trial in which treatment assignment is independent of potential outcomes and biomarkers by design. Let $Y$ denote the clinical outcome and $B$ the biomarker that is hypothesized to mediate part of the treatment effect. The total treatment effect is the difference in expected outcomes between the treated and control arms and is summarized here by the magnitude $\\Delta_{Y}$, where a positive value denotes the magnitude of reduction in $Y$ due to treatment. The residual treatment effect after conditioning on $B$ is the difference in expected outcomes between the treated and control arms when the biomarker is held fixed or adjusted for; this is summarized by $\\Delta_{Y|B}$, a positive value denoting the remaining magnitude of reduction in $Y$ after accounting for $B$.\n\nBy definition, the portion of the treatment effect that is explained by the biomarker corresponds to the part of the total treatment effect that is removed when conditioning on $B$. The magnitude of the treatment effect attributable to the biomarker is therefore the difference between the total effect and the residual effect after conditioning:\n$$\n\\text{Explained effect} = \\Delta_{Y} - \\Delta_{Y|B}.\n$$\nTo form a proportion (a unitless quantity) that represents the fraction of the total effect explained by the biomarker, we divide the explained effect by the total effect:\n$$\n\\text{Proportion of treatment effect explained} = \\frac{\\Delta_{Y} - \\Delta_{Y|B}}{\\Delta_{Y}}.\n$$\nSubstituting the reported values $\\Delta_{Y} = 8.4$ and $\\Delta_{Y|B} = 3.1$,\n$$\n\\text{PTE} = \\frac{8.4 - 3.1}{8.4} = \\frac{5.3}{8.4}.\n$$\nCompute the ratio:\n$$\n\\frac{5.3}{8.4} \\approx 0.630952\\ldots\n$$\nRounding to four significant figures yields\n$$\n0.6310.\n$$\n\nInterpretation: A value of $0.6310$ indicates that, expressed as a decimal fraction, approximately $0.6310$ of the treatment’s total reduction in the clinical outcome is explained by the biomarker $B$ under the modeling assumptions. This suggests substantial but incomplete mediation by $B$. Values outside the interval $[0,1]$ can occur in practice due to sampling variability, measurement error, or model misspecification, but in this case the value lies within the expected range, supporting the biomarker’s partial surrogacy for the clinical outcome.",
            "answer": "$$\\boxed{0.6310}$$"
        },
        {
            "introduction": "While assessing a biomarker within a single trial is a good start, true validation of a surrogate endpoint requires synthesizing evidence across multiple studies. This exercise simulates a trial-level meta-regression, a key technique used to evaluate if a biomarker reliably predicts clinical outcomes across different contexts . By estimating the relationship between a surrogate (blood pressure reduction) and a clinical endpoint (stroke risk), you will calculate the Surrogate Threshold Effect (STE), which defines the minimum biomarker change needed to predict a tangible clinical benefit.",
            "id": "4929658",
            "problem": "A pharmacology research team evaluates whether change in systolic blood pressure (SBP) can serve as a trial-level surrogate endpoint for stroke risk in randomized controlled trials (RCTs). Let the surrogate be the mean between-group SBP reduction (treatment minus control, so positive values indicate SBP lowering by treatment) measured in millimetres of mercury (mmHg), denoted by $x_i$, and let the clinical endpoint be the natural logarithm of the stroke risk ratio (RR), denoted by $y_i = \\ln(\\text{RR}_i)$, for trial $i$. Smaller values of $y_i$ imply greater stroke risk reduction.\n\nAssume the following well-tested modeling framework for trial-level surrogacy: a linear meta-regression linking clinical and surrogate effects, $y_i = \\alpha + \\beta x_i + \\varepsilon_i$, where $\\alpha$ and $\\beta$ are unknown parameters and $\\varepsilon_i$ are mean-zero residuals. The parameter $\\beta$ is the trial-level surrogacy slope: its sign and magnitude quantify how changes in the surrogate relate to changes in the clinical outcome across trials. The Surrogate Threshold Effect (STE) for predicting any benefit is defined as the smallest surrogate effect $x$ such that the predicted clinical effect is non-positive, that is, the smallest $x$ for which $\\alpha + \\beta x \\le 0$.\n\nYou are given trial-level data from five independent RCTs:\n- Trial 1: $x_1 = 5$ mmHg, $y_1 = 0.06$\n- Trial 2: $x_2 = 10$ mmHg, $y_2 = 0.02$\n- Trial 3: $x_3 = 15$ mmHg, $y_3 = -0.02$\n- Trial 4: $x_4 = 20$ mmHg, $y_4 = -0.06$\n- Trial 5: $x_5 = 25$ mmHg, $y_5 = -0.10$\n\nStarting from the fundamental definitions above, and using ordinary least squares (OLS) to estimate $\\alpha$ and $\\beta$ from the given data, derive the expression for the STE in terms of the estimated regression parameters and compute its numerical value for these trials. Report only the Surrogate Threshold Effect (STE) as your final answer. Round your answer to four significant figures and express it in mmHg.",
            "solution": "The objective is to calculate the Surrogate Threshold Effect (STE) by first estimating the parameters $\\alpha$ and $\\beta$ of the linear meta-regression model $y_i = \\alpha + \\beta x_i + \\varepsilon_i$ using ordinary least squares (OLS) with the provided data.\n\nThe OLS estimators, $\\hat{\\alpha}$ and $\\hat{\\beta}$, are calculated using the standard formulas:\n$$ \\hat{\\beta} = \\frac{\\sum_{i=1}^{n} (x_i - \\bar{x})(y_i - \\bar{y})}{\\sum_{i=1}^{n} (x_i - \\bar{x})^2} \\quad \\text{and} \\quad \\hat{\\alpha} = \\bar{y} - \\hat{\\beta} \\bar{x} $$\nFirst, we compute the means of the data for $n=5$ trials:\n-   $x_i$ values are $5, 10, 15, 20, 25 \\implies \\bar{x} = \\frac{75}{5} = 15$.\n-   $y_i$ values are $0.06, 0.02, -0.02, -0.06, -0.10 \\implies \\bar{y} = \\frac{-0.10}{5} = -0.02$.\n\nNext, we compute the sum of squared deviations for $x$ ($S_{xx}$) and the sum of cross-products ($S_{xy}$):\n$$ S_{xx} = (5-15)^2 + (10-15)^2 + (15-15)^2 + (20-15)^2 + (25-15)^2 = 100 + 25 + 0 + 25 + 100 = 250 $$\n$$ S_{xy} = (-10)(0.08) + (-5)(0.04) + (0)(0) + (5)(-0.04) + (10)(-0.08) = -0.8 - 0.2 + 0 - 0.2 - 0.8 = -2.0 $$\nNow, we calculate the estimated parameters:\n$$ \\hat{\\beta} = \\frac{S_{xy}}{S_{xx}} = \\frac{-2.0}{250} = -0.008 $$\n$$ \\hat{\\alpha} = \\bar{y} - \\hat{\\beta} \\bar{x} = -0.02 - (-0.008)(15) = -0.02 + 0.12 = 0.10 $$\nThe estimated regression line is $\\hat{y} = 0.10 - 0.008x$.\n\nThe STE is defined as the smallest value of the surrogate $x$ for which the predicted clinical effect is non-positive ($\\hat{\\alpha} + \\hat{\\beta}x \\le 0$).\n$$ 0.10 - 0.008x \\le 0 $$\n$$ 0.10 \\le 0.008x $$\n$$ x \\ge \\frac{0.10}{0.008} $$\n$$ x \\ge 12.5 $$\nThe smallest value of $x$ satisfying this inequality is $12.5$. To meet the requirement of four significant figures, the result is expressed as $12.50$. The STE is $12.50$ mmHg.",
            "answer": "$$\n\\boxed{12.50}\n$$"
        },
        {
            "introduction": "The ultimate goal of quantitative pharmacology is to predict a drug's clinical impact from its fundamental properties. This capstone practice guides you through building an integrated simulation that connects pharmacokinetics (PK), pharmacodynamics (PD), and biomarker dynamics to forecast a change in a clinical risk score . By implementing this model, you will gain hands-on experience with the powerful simulation tools that drive model-informed drug development, allowing for the prediction of clinical outcomes from basic dose and drug parameters.",
            "id": "4929758",
            "problem": "You are tasked with writing a complete program to simulate a biomarker time course under a single-dose pharmacological intervention and to compute the predicted change in a dimensionless clinical risk score using a model grounded in pharmacokinetics (PK) and pharmacodynamics (PD). You must derive the algorithm from fundamental definitions and implement it numerically according to the specifications below, then apply it to a provided test suite of parameter sets and output the results in the required format.\n\nStart from the following foundational definitions.\n\n- Pharmacokinetics (PK): One-compartment, intravenous bolus dosing with first-order elimination. Let $A(t)$ be the drug amount in the body at time $t$, $C(t)$ the plasma concentration, $D$ the dose, $CL$ the clearance, and $V$ the volume of distribution. Mass balance gives $dA/dt = -CL \\cdot C(t)$ and $C(t) = A(t)/V$. With initial condition $A(0) = D$, the unique solution is\n$$\nC(t) = \\frac{D}{V}\\,\\exp\\!\\left(-\\frac{CL}{V}\\,t\\right).\n$$\nTime $t$ is measured in hours, $CL$ is in liters per hour, $V$ is in liters, $D$ is in milligrams, and $C(t)$ is in milligrams per liter.\n\n- Pharmacodynamics (PD): A direct inhibitory effect model using the maximum effect model (also known as the $E_{\\max}$ model): for concentration $C$, the fractional effect is\n$$\nE(C) = \\frac{E_{\\max}\\,C}{EC_{50} + C},\n$$\nwhere $E_{\\max} \\in [0,1]$ is the maximal fractional inhibition and $EC_{50}$ is the concentration at which half-maximal effect occurs (in milligrams per liter).\n\n- Biomarker turnover: Let $B(t)$ denote the biomarker level at time $t$, $k_{\\text{in}}$ the zero-order production rate, and $k_{\\text{out}}$ the first-order loss rate constant. The indirect response model with inhibitory drug effect on production is\n$$\n\\frac{dB}{dt} = k_{\\text{in}}\\left(1 - E(C(t))\\right) - k_{\\text{out}} B(t).\n$$\nAt baseline in the absence of drug effect, steady state implies $B(0) = B_0$ and $B_0 = k_{\\text{in}}/k_{\\text{out}}$, hence $k_{\\text{in}} = B_0\\,k_{\\text{out}}$. Biomarker levels $B(t)$ use arbitrary consistent units (e.g., picograms per milliliter), but the final risk score is dimensionless.\n\n- Clinical risk mapping: Let $R_0$ be the baseline risk score (dimensionless) and $\\beta$ a dimensionless sensitivity parameter. Define the predicted risk score as\n$$\nR_{\\text{pred}} = R_0 \\cdot \\exp\\!\\left(-\\beta\\,\\frac{\\overline{B} - B_0}{B_0}\\right),\n$$\nwhere the time-averaged biomarker on the interval $[0,T_{\\text{end}}]$ is\n$$\n\\overline{B} = \\frac{1}{T_{\\text{end}}} \\int_0^{T_{\\text{end}}} B(t)\\,dt.\n$$\nThe quantity of interest is the predicted change in risk score\n$$\n\\Delta R = R_{\\text{pred}} - R_0,\n$$\nto be reported as a real number (decimal).\n\nAlgorithmic requirements.\n\n- Use the one-compartment PK solution to compute $C(t)$ at any time $t$ for given $CL$, $V$, and $D$.\n- Use the maximum effect model to compute $E(C(t))$ at any time $t$ for given $E_{\\max}$ and $EC_{50}$.\n- Determine $k_{\\text{in}}$ from $B_0$ and $k_{\\text{out}}$ using $k_{\\text{in}} = B_0\\,k_{\\text{out}}$.\n- Numerically integrate the biomarker turnover differential equation to obtain $B(t)$ over $t \\in [0, T_{\\text{end}}]$ with the initial condition $B(0) = B_0$. Use a fixed-step, fourth-order Runge–Kutta method with step size $\\Delta t = 0.01$ hours on a uniform grid.\n- Compute $\\overline{B}$ using the trapezoidal rule on the same grid and then compute $\\Delta R$ as above.\n\nImplementation details.\n\n- All computations must use hours for time, liters for volumes, liters per hour for clearance, and milligrams per liter for concentration. The final risk change $\\Delta R$ is dimensionless and must be returned as a decimal number.\n- Round each $\\Delta R$ to six decimal places for output.\n\nTest suite.\n\nYour program must compute $\\Delta R$ for each of the following parameter sets. Each tuple is ordered as $(CL, V, D, E_{\\max}, EC_{50}, B_0, k_{\\text{out}}, R_0, \\beta, T_{\\text{end}})$, with units as described above.\n\n- Case A (typical effect): $(5, 50, 100, 0.8, 1, 100, 0.1, 1.2, 1.1, 48)$.\n- Case B (zero dose boundary): $(5, 50, 0, 0.8, 1, 100, 0.1, 1.2, 1.1, 48)$.\n- Case C (rapid elimination): $(20, 20, 200, 0.9, 2, 80, 0.2, 2, 0.8, 24)$.\n- Case D (negligible potency): $(3, 30, 150, 0.7, 1000, 120, 0.15, 1, 1, 24)$.\n- Case E (near-saturating effect with slow biomarker loss): $(1, 40, 400, 1, 0.5, 150, 0.05, 3, 0.5, 72)$.\n\nFinal output format.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as [Case A result, Case B result, Case C result, Case D result, Case E result]. Each result must be rounded to six decimal places. For example: \"[0.123456,0.000000,-0.012345,0.000001,-0.234567]\".",
            "solution": "The solution involves implementing a multi-step simulation based on the provided pharmacokinetic (PK), pharmacodynamic (PD), and biomarker models. For each parameter set, the algorithm proceeds as follows:\n1.  **Define Models**: The analytical functions for drug concentration $C(t)$ (one-compartment PK model) and fractional drug effect $E(C)$ ($E_{\\max}$ model) are defined. The biomarker production rate $k_{\\text{in}}$ is calculated from the baseline steady state, $k_{\\text{in}} = B_0 \\cdot k_{\\text{out}}$.\n2.  **Numerical Integration**: The ordinary differential equation (ODE) for the biomarker, $dB/dt = k_{\\text{in}}(1 - E(C(t))) - k_{\\text{out}}B(t)$, is solved numerically. This is done using a fourth-order Runge-Kutta (RK4) method on a uniform time grid from $t=0$ to $t=T_{\\text{end}}$ with a step size of $\\Delta t=0.01$ hours. The process starts with the initial condition $B(0) = B_0$ and iteratively computes the biomarker level $B(t)$ at each step.\n3.  **Time-Averaging**: The time-averaged biomarker level, $\\overline{B}$, is computed from the discrete time course of the biomarker. This is done by approximating the integral $\\int_0^{T_{\\text{end}}} B(t)\\,dt$ using the trapezoidal rule and dividing by the total time, $T_{\\text{end}}$.\n4.  **Calculate Risk Change**: The predicted risk score, $R_{\\text{pred}}$, is calculated using the exponential mapping formula with the computed $\\overline{B}$. The final quantity of interest, $\\Delta R = R_{\\text{pred}} - R_0$, is then determined.\nThis procedure is executed for each of the five test cases, and the resulting $\\Delta R$ values are rounded and formatted as required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_delta_R(params):\n    \"\"\"\n    Computes the change in clinical risk score based on a PK/PD biomarker model.\n\n    This function implements the full simulation pipeline described in the problem:\n    1. Defines PK, PD, and biomarker ODE models.\n    2. Solves the biomarker ODE using a 4th-order Runge-Kutta method.\n    3. Computes the time-averaged biomarker level using the trapezoidal rule.\n    4. Calculates the final predicted change in risk score.\n\n    Args:\n        params (tuple): A tuple containing the model parameters in the order:\n                        (CL, V, D, E_max, EC_50, B_0, k_out, R_0, beta, T_end).\n\n    Returns:\n        float: The calculated change in risk score, delta_R.\n    \"\"\"\n    # Unpack parameters from the input tuple\n    CL, V, D, E_max, EC_50, B_0, k_out, R_0, beta, T_end = params\n    \n    # Define the fixed step size for numerical integration\n    dt = 0.01\n\n    # Derive the zero-order production rate from the steady-state assumption\n    k_in = B_0 * k_out\n\n    # 1. Define the component models as functions\n    \n    # Pharmacokinetic model: Drug concentration over time C(t)\n    def C(t):\n        if V == 0:\n            return np.inf if D > 0 else 0.0\n        # Elimination rate constant\n        k_el = CL / V\n        return (D / V) * np.exp(-k_el * t)\n\n    # Pharmacodynamic model: Fractional drug effect E(C)\n    def E(c_val):\n        # C is always non-negative, so EC_50 + c_val is positive if EC_50 > 0\n        if EC_50 <= -c_val:\n            return np.inf  # Physically implausible case\n        return (E_max * c_val) / (EC_50 + c_val)\n\n    # Biomarker turnover ODE: dB/dt = f(t, B)\n    def dB_dt(t, B):\n        c_t = C(t)\n        e_ct = E(c_t)\n        return k_in * (1.0 - e_ct) - k_out * B\n\n    # 2. Solve the ODE using the 4th-order Runge-Kutta method\n\n    # Create the uniform time grid\n    # int(round(...)) is used for robustness against floating-point inaccuracies.\n    num_intervals = int(round(T_end / dt))\n    num_points = num_intervals + 1\n    t_grid = np.linspace(0.0, T_end, num_points)\n    \n    # Initialize array to store biomarker levels\n    B_t = np.zeros(num_points)\n    B_t[0] = B_0  # Set initial condition\n\n    # Iterate through the time grid to solve the ODE\n    for i in range(num_intervals):\n        t_i = t_grid[i]\n        B_i = B_t[i]\n        \n        # Calculate RK4 slopes\n        k1 = dB_dt(t_i, B_i)\n        k2 = dB_dt(t_i + 0.5 * dt, B_i + 0.5 * dt * k1)\n        k3 = dB_dt(t_i + 0.5 * dt, B_i + 0.5 * dt * k2)\n        k4 = dB_dt(t_i + dt, B_i + dt * k3)\n        \n        # Update biomarker level for the next time step\n        B_t[i + 1] = B_i + (dt / 6.0) * (k1 + 2.0*k2 + 2.0*k3 + k4)\n\n    # 3. Compute the time-averaged biomarker level\n\n    # Use the trapezoidal rule on the generated time course\n    if T_end > 0:\n        integral_B = np.trapz(B_t, t_grid)\n        B_bar = integral_B / T_end\n    else:  # Handle edge case where the time interval is zero\n        B_bar = B_0\n\n    # 4. Calculate the predicted change in risk score\n\n    # Calculate relative change in biomarker, handling potential division by zero\n    rel_change_B = 0.0\n    if B_0 != 0:\n        rel_change_B = (B_bar - B_0) / B_0\n    \n    R_pred = R_0 * np.exp(-beta * rel_change_B)\n    delta_R = R_pred - R_0\n    \n    return delta_R\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n    # Define the test cases as per the problem statement.\n    # Each tuple: (CL, V, D, E_max, EC_50, B_0, k_out, R_0, beta, T_end)\n    test_cases = [\n        (5, 50, 100, 0.8, 1, 100, 0.1, 1.2, 1.1, 48),    # Case A\n        (5, 50, 0, 0.8, 1, 100, 0.1, 1.2, 1.1, 48),      # Case B\n        (20, 20, 200, 0.9, 2, 80, 0.2, 2, 0.8, 24),      # Case C\n        (3, 30, 150, 0.7, 1000, 120, 0.15, 1, 1, 24),    # Case D\n        (1, 40, 400, 1, 0.5, 150, 0.05, 3, 0.5, 72)     # Case E\n    ]\n\n    results = []\n    # Process each test case\n    for case_params in test_cases:\n        delta_R = calculate_delta_R(case_params)\n        # Round the final result to six decimal places for output\n        results.append(f\"{delta_R:.6f}\")\n\n    # Format the results into a single string as required\n    print(f\"[{','.join(results)}]\")\n\n# Execute the main function\nsolve()\n```"
        }
    ]
}