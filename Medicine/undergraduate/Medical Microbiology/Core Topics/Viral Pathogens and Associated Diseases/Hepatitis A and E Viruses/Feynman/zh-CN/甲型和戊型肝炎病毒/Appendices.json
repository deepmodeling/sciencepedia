{
    "hands_on_practices": [
        {
            "introduction": "在临床实践中，解读实验室检测结果并不仅仅是看“阳性”或“阴性”那么简单。一个检测的真正价值取决于其内在性能（如灵敏度和特异性）以及疾病在特定人群中的流行程度。这项练习将指导您应用贝叶斯定理来计算阳性预测值（PPV），这是一个关键指标，它能帮助临床医生在得到阳性检测结果后，评估患者确实患病的真实概率，从而更好地进行临床决策 。",
            "id": "4637165",
            "problem": "一家社区诊所正在评估一种抗戊型肝炎病毒（HEV）免疫球蛋白M（IgM）检测方法在水源性肠胃炎季节期间用于诊断出现相符症状患者的急性戊型肝炎病毒感染的性能。该检测的灵敏度和特异性（在先前的验证研究中确定）分别为$92\\%$和$98\\%$。根据流行病学监测和临床分诊标准，临床医生评估有症状患者患有急性戊型肝炎病毒感染的检测前概率（先验概率）为$5\\%$。使用贝叶斯定理以及灵敏度和特异性的基本定义，从第一性原理推导出阳性预测值（PPV）的解析表达式（定义为在检测结果为阳性的情况下患病的后验概率），然后计算其在此情境下的值。请用小数表示您的最终答案，并四舍五入到四位有效数字。不要使用百分号。",
            "solution": "本题要求在给定抗戊型肝炎病毒（HEV）IgM检测的灵敏度、特异性和疾病的检测前概率的情况下，推导并计算其阳性预测值（PPV）。\n\n首先，对问题进行验证。\n\n**步骤1：提取已知条件**\n- 检测的灵敏度：$92\\%$\n- 检测的特异性：$98\\%$\n- 急性戊型肝炎病毒感染的检测前概率（先验概率）：$5\\%$\n- 任务是推导阳性预测值（PPV）的解析表达式并计算其值。\n- 最终答案必须是四舍五入到四位有效数字的小数。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于概率论的基本原理，特别是贝叶斯定理及其在医学诊断中的应用。灵敏度、特异性和预测值的概念是流行病学和循证医学中的标准概念。诊断HEV的背景在科学上是恰当的。\n- **适定性：** 该问题是适定的。它提供了唯一确定阳性预测值所需的所有必要参数（灵敏度、特异性和先验概率）。目标陈述清晰。\n- **客观性：** 该问题以精确、定量和客观的术语陈述，没有歧义或主观性陈述。\n\n**步骤3：结论与行动**\n该问题被认为是有效的，因为它具有科学依据、适定性和客观性。将提供解答。\n\n**推导与计算**\n\n我们定义以下事件：\n- $D$：患者患有急性戊型肝炎病毒感染的事件。\n- $D^c$：患者未患有急性戊型肝炎病毒感染的事件。\n- $T^+$：检测结果为阳性的事件。\n- $T^-$：检测结果为阴性的事件。\n\n已知条件可以用条件概率表示：\n- 检测前概率，即患病率，是疾病的先验概率：$P(D) = 0.05$。\n- 灵敏度是在患病条件下检测结果为阳性的概率：$P(T^+|D) = 0.92$。\n- 特异性是在未患病条件下检测结果为阴性的概率：$P(T^-|D^c) = 0.98$。\n\n由此，我们可以推导出互补概率：\n- 患者未患病的概率是 $P(D^c) = 1 - P(D) = 1 - 0.05 = 0.95$。\n- 在未患病条件下检测结果为阳性的概率（假阳性率）是 $P(T^+|D^c) = 1 - P(T^-|D^c) = 1 - 0.98 = 0.02$。\n\n阳性预测值（PPV）定义为在检测结果为阳性的条件下患者患病的后验概率，即 $P(D|T^+)$。\n\n我们使用贝叶斯定理从第一性原理推导PPV的表达式：\n$$ P(D|T^+) = \\frac{P(T^+|D) P(D)}{P(T^+)} $$\n分母 $P(T^+)$ 是检测结果为阳性的总概率。这可以使用全概率公式计算，对两种可能的疾病状态（患病或未患病）求和：\n$$ P(T^+) = P(T^+|D)P(D) + P(T^+|D^c)P(D^c) $$\n将 $P(T^+)$ 的这个展开式代入贝叶斯定理方程，得到PPV的完整解析表达式：\n$$ \\text{PPV} = P(D|T^+) = \\frac{P(T^+|D) P(D)}{P(T^+|D) P(D) + P(T^+|D^c) P(D^c)} $$\n这个公式用灵敏度、特异性和患病率来表示PPV。令灵敏度 $\\text{Se} = P(T^+|D)$，特异性 $\\text{Sp} = P(T^-|D^c)$，患病率 $p = P(D)$。公式变为：\n$$ \\text{PPV} = \\frac{\\text{Se} \\cdot p}{\\text{Se} \\cdot p + (1 - \\text{Sp}) \\cdot (1 - p)} $$\n这就是推导出的阳性预测值的解析表达式。\n\n现在，我们通过代入给定的概率来计算数值：\n- $\\text{Se} = 0.92$\n- $\\text{Sp} = 0.98$\n- $p = 0.05$\n\n$$ \\text{PPV} = \\frac{0.92 \\times 0.05}{0.92 \\times 0.05 + (1 - 0.98) \\times (1 - 0.05)} $$\n首先，计算分子和分母中的各项：\n- 分子：$0.92 \\times 0.05 = 0.046$\n- 分母第一项（真阳性）：$0.92 \\times 0.05 = 0.046$\n- 分母第二项（假阳性）：$(1 - 0.98) \\times (1 - 0.05) = 0.02 \\times 0.95 = 0.019$\n\n现在，将这些值代回表达式中：\n$$ \\text{PPV} = \\frac{0.046}{0.046 + 0.019} $$\n$$ \\text{PPV} = \\frac{0.046}{0.065} $$\n进行最后的除法运算：\n$$ \\text{PPV} \\approx 0.7076923... $$\n题目要求答案四舍五入到四位有效数字。\n$$ \\text{PPV} \\approx 0.7077 $$\n因此，对于在这种情况下出现症状的患者，阳性的检测结果将患有急性戊型肝炎的概率从$5\\%$的先验概率提高到约$70.77\\%$的后验概率。",
            "answer": "$$\n\\boxed{0.7077}\n$$"
        },
        {
            "introduction": "从对单个患者的诊断，我们现在将视野扩展到病毒在社区中的传播动态。基本再生数（$R_0$）是衡量病原体传播能力的核心指标，对于理解和控制疫情至关重要。本练习将引导您利用模拟的甲型肝炎暴发数据，通过计算续发侵袭率（SAR）来估算 $R_0$ 和群体免疫阈值，让您亲身体验流行病学家如何量化疫情风险并制定控制策略 。",
            "id": "4648350",
            "problem": "一家无家可归者收容所爆发了甲型肝炎病毒（HAV）的粪口传播疫情。您获得了在一个传播代间隔内前瞻性收集的接触者追踪数据，因此三代传播被设限不计。在每个原发病例的传染期间，已知以下量在科学上是有效的：每个原发病例识别出的密切接触者数量，有文件记载的免疫力（既往感染或接种两剂疫苗）的接触者数量，以及在其余易感接触者中发生的继发性HAV病例数量。假设收容所内为同质混合，接触者之间的传播事件相互独立，并且HAV在传染窗口期内对易感接触者的每次接触传播概率是恒定的。\n\n使用的定义：\n- 基本再生数（$R_0$）：在一个完全易感的人群中，一个典型的感染个体产生的预期继发感染数。\n- 续发率（SAR）：在一组特定的易感接触者中，一个传播代间隔内被感染的比例。\n-有效再生数（$R_e$）：在一个有部分免疫力的人群中，预期的继发感染数。\n- 群体免疫阈值：为使有效再生数低于1，人群中所需的最低免疫比例。\n\n疫情数据：\n- 有 $40$ 例原发HAV病例完成了完整的接触者随访。\n- 在这 $40$ 例原发病例中，在其传染期内共识别出 $320$ 名密切接触者。\n- 在这 $320$ 名接触者中，有 $112$ 人在基线时有文件记载的免疫力。\n- 在其余 $208$ 名易感接触者中，有 $62$ 人在一个传播代间隔内成为继发性HAV病例。\n\n仅使用上述定义和传染病流行病学第一性原理的标准推理，估计该收容所在完全易感情况下的基本再生数 $R_0$，然后计算群体免疫阈值，即确保有效再生数小于1所需的最低免疫比例。将 $R_0$ 和群体免疫阈值均报告为无量纲量。将两个结果均四舍五入至四位有效数字。将群体免疫阈值表示为不带百分号的小数。",
            "solution": "此问题经评估为有效。它科学地基于传染病流行病学的既定原则，问题陈述清晰，数据充分且一致，表述客观。它提供了一个根据疫情数据估算关键流行病学参数的标准情景。因此，我将给出完整的解题过程。\n\n问题要求估算两个量：基本再生数 $R_0$ 和群体免疫阈值。我们将使用给定的定义和数据，并从第一性原理出发进行计算。\n\n设 $N_p$ 为原发病例数，给定 $N_p = 40$。\n设 $C_{total}$ 为识别出的密切接触者总数，给定 $C_{total} = 320$。\n设 $C_{immune}$ 为有文件记载的免疫力的接触者数量，给定 $C_{immune} = 112$。\n设 $C_{susp}$ 为易感接触者数量。这可以计算得出 $C_{susp} = C_{total} - C_{immune} = 320 - 112 = 208$。这与问题陈述中提供的值一致。\n设 $I_s$ 为易感接触者中的继发病例数，给定 $I_s = 62$。\n\n首先，我们估算基本再生数 $R_0$。$R_0$ 的定义是在一个完全易感的人群中，一个典型的感染个体产生的预期继发感染数。它可以建模为每个原发病例的平均接触人数 $c$ 与在完全易感环境中每次接触的传播概率 $p$ 的乘积。\n$$R_0 = c \\times p$$\n\n我们可以根据接触者总数和原发病例数来估算每个原发病例的平均接触人数 $c$。\n$$c = \\frac{C_{total}}{N_p} = \\frac{320}{40} = 8$$\n因此，一个典型的原发病例在其传染期内有 $8$ 名接触者。\n\n接下来，我们估算每次接触的传播概率 $p$。问题假设此概率对于易感接触者是恒定的。续发率（SAR）为此概率提供了一个直接的估计值。SAR被定义为变为感染者的易感接触者的比例。\n$$\\text{SAR} = \\frac{\\text{继发病例数}}{\\text{易感接触者数}} = \\frac{I_s}{C_{susp}}$$\n使用给定的数据：\n$$p \\approx \\text{SAR} = \\frac{62}{208}$$\n这个分数代表了单个易感接触者被一个原发病例感染的概率。\n\n现在，我们可以使用我们对 $c$ 和 $p$ 的估计值来计算 $R_0$。\n$$R_0 = c \\times p = 8 \\times \\frac{62}{208} = \\frac{496}{208} \\approx 2.384615$$\n按照要求，将其四舍五入到四位有效数字，我们得到：\n$$R_0 \\approx 2.385$$\n\n其次，我们计算群体免疫阈值。这被定义为确保有效再生数 $R_e$ 小于1所需的人群最低免疫比例，我们将其表示为 $f_{immune, crit}$。\n\n有效再生数 $R_e$ 是在一个有部分免疫力的人群中预期的继发感染数。它与 $R_0$ 以及人群中易感者的比例 $S$ 相关，关系式如下：\n$$R_e = R_0 \\times S$$\n易感比例 $S$ 与免疫比例 $f_{immune}$ 互补：\n$$S = 1 - f_{immune}$$\n所以，我们可以将 $R_e$ 写成：\n$$R_e = R_0 \\times (1 - f_{immune})$$\n群体免疫阈值是使 $R_e$ 降至1以下的 $f_{immune}$ 的特定值。临界点可以通过设置 $R_e = 1$ 来找到。\n$$1 = R_0 \\times (1 - f_{immune, crit})$$\n我们现在可以解出群体免疫阈值 $f_{immune, crit}$：\n$$1 - f_{immune, crit} = \\frac{1}{R_0}$$\n$$f_{immune, crit} = 1 - \\frac{1}{R_0}$$\n为了更精确，我们使用未四舍五入的 $R_0$ 值：\n$$f_{immune, crit} = 1 - \\frac{1}{(496/208)} = 1 - \\frac{208}{496} = \\frac{496 - 208}{496} = \\frac{288}{496} \\approx 0.580645$$\n按照要求，将其四舍五入到四位有效数字，我们得到：\n$$f_{immune, crit} \\approx 0.5806$$\n\n因此，估算的基本再生数为 $2.385$，群体免疫阈值为 $0.5806$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 2.385  0.5806 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "最后，我们将探讨一个更宏观的层面：公共卫生政策的制定。像大规模疫苗接种这样的决策，不仅需要病毒学知识，还必须权衡其经济成本与健康效益。这项高级练习构建了一个健康经济学模型，通过计算增量成本效果比（ICER），来比较全民接种与高风险人群靶向接种两种策略的优劣。它展示了定量分析如何为制定基于证据的疾病预防政策提供支持，揭示了从微生物学到公共卫生决策的完整链条 。",
            "id": "4637172",
            "problem": "一个大都会区正从甲型肝炎病毒的高流行区向中等流行区过渡。您需要对两种疫苗接种策略在一个固定时间范围内的成本效益进行规范化和实现有原则的比较：对全体人口进行大规模接种，与仅对高风险人群进行靶向接种。此比较必须基于基本的流行病学和卫生经济学定义，并必须以程序的形式表达，该程序能为多个测试场景中的每一个输出明确、可量化的结果。\n\n请使用以下基础依据。\n\n- 流行病学发病率和易感性：在某一时间范围内，一个人口群体中的预期感染人数与该群体规模、基线发病率、易感人群比例以及感染力的乘积成正比。设总人口为 $N$，高风险群体规模为 $N_h$，普通群体规模为 $N_g = N - N_h$，时间范围为 $T$。对于群体 $i \\in \\{h,g\\}$，设基线发病率为 $\\lambda_i$（单位：感染数/人年），已有免疫力比例为 $m_i$（范围：$[0,1]$），疫苗覆盖率为 $v_i$（范围：$[0,1]$），疫苗效力为 $e$（范围：$[0,1]$）。接种后的易感比例为 $(1 - m_i)(1 - e v_i)$。为捕捉群体保护效应，设全人群覆盖率为 $\\bar{v} = (N_h v_h + N_g v_g)/N$，并让感染力通过一个群体因子 $s = (1 - e \\bar{v})^\\alpha$ 进行缩放，其中 $\\alpha \\in [0,1]$ 代表与混合相关的衰减；$s$ 被限制在 $[0,1]$ 范围内。群体 $i$ 中的预期感染数为\n$$\nI_i = N_i \\,\\lambda_i \\, s \\,(1 - m_i)(1 - e v_i)\\, T.\n$$\n\n- 每次感染的健康结局和成本：每次感染的预期资源使用和健康损失可按严重程度类别进行分解。设群体 $i$ 的住院概率为 $p_{h,i}$（范围：$[0,1]$），暴发性肝功能衰竭（重症病例的一个子集）的概率为 $p_{f,i}$（范围：$[0,1]$），死亡概率为 $p_{d,i}$（范围：$[0,1]$）。设直接成本为：门诊治疗成本 $C_{\\text{amb}}$，住院成本 $C_{\\text{hosp}}$，以及除住院外因暴发性肝功能衰竭引起的增量成本 $C_{\\text{fulm}}$。每次感染的预期成本为\n$$\nE[C \\mid \\text{infection}, i] = (1 - p_{h,i})\\, C_{\\text{amb}} + p_{h,i}\\, C_{\\text{hosp}} + p_{f,i}\\, C_{\\text{fulm}}.\n$$\n设健康损失以质量调整生命年（Quality-Adjusted Life Years, QALYs）量化，其定义为效用加权的生命年，首次提及后简称为QALY。设 $q_{\\text{mild}}$ 为非住院疾病的QALY损失，$q_{\\text{hosp}}$ 为住院疾病的QALY损失，$q_{\\text{death}}$ 为每次死亡所计的QALY损失。每次感染的预期QALY损失为\n$$\nE[Q \\mid \\text{infection}, i] = (1 - p_{h,i})\\, q_{\\text{mild}} + p_{h,i}\\, q_{\\text{hosp}} + p_{d,i}\\, q_{\\text{death}}.\n$$\n\n- 疫苗接种成本和不良事件：设每人需接种 $d$ 剂疫苗，每剂疫苗的采购成本为 $C_{\\text{vac}}$，管理成本为 $C_{\\text{adm}}$。假设每名接种者的预期不良事件成本为 $C_{\\text{AE}}$，预期QALY损失为 $q_{\\text{AE}}$。对于群体 $i$，疫苗接种成本为\n$$\nC_{\\text{vacc},i} = N_i v_i \\left(d (C_{\\text{vac}} + C_{\\text{adm}}) + C_{\\text{AE}}\\right),\n$$\n相应的QALY损失为\n$$\nQ_{\\text{vacc},i} = N_i v_i \\, q_{\\text{AE}}.\n$$\n\n- 策略总计与成本效益：将一个策略的总成本和总QALY损失定义为各群体感染相关和疫苗接种相关组成部分的总和：\n$$\nC_{\\text{tot}} = \\sum_{i \\in \\{h,g\\}} \\left[I_i \\, E[C \\mid \\text{infection}, i] + C_{\\text{vacc},i}\\right], \\quad\nQ_{\\text{tot}} = \\sum_{i \\in \\{h,g\\}} \\left[I_i \\, E[Q \\mid \\text{infection}, i] + Q_{\\text{vacc},i}\\right].\n$$\n设大规模接种策略的覆盖率为 $v_h = v_g = v_{\\text{mass}}$，靶向接种策略的覆盖率为 $v_h = v_{\\text{target}}$，$v_g = 0$。定义增量成本 $\\Delta C = C_{\\text{mass}} - C_{\\text{target}}$ 和避免的增量QALY损失 $\\Delta Q = Q_{\\text{target}} - Q_{\\text{mass}}$。增量成本效益比（Incremental Cost-Effectiveness Ratio, ICER）为\n$$\n\\text{ICER} = \\frac{\\Delta C}{\\Delta Q},\n$$\n仅在 $\\Delta Q > 0$ 时有良好定义。给定一个以每QALY货币单位计的支付意愿阈值 $\\tau$，当且仅当 $\\Delta Q > 0$ 且 $\\text{ICER} \\le \\tau$ 时，大规模接种策略相对于靶向策略具有成本效益。\n\n您的程序必须为以下每个测试案例计算ICER和成本效益决策，该决策为一个布尔值，定义为大规模接种策略在指定阈值下是否具有成本效益。如果 $\\Delta Q \\le 0$，则将ICER设置为无穷大浮点数，并将决策设置为假。\n\n所有比率和概率必须作为 $[0,1]$ 范围内的十进制数处理，不带百分号。发病率单位是每人年。成本以单一一致的货币单位表示；QALY是无量纲的。不涉及角度。时间范围 $T$ 的单位是年。除了标准的浮点数表示外，没有强制的舍入要求。程序的最终输出必须是单行，包含一个用方括号括起来的逗号分隔列表，其中每个测试案例编码为一个双元素列表 $[\\text{ICER}, \\text{decision}]$，例如 $\\left[[1.23,\\text{True}],[4.56,\\text{False}]\\right]$。\n\n请为以下测试套件实现计算，该套件旨在覆盖一般情况、低发病率高成本的边界条件以及高风险暴发的边缘案例。\n\n- 测试案例1（一般过渡性流行情况）：\n    - $N = 2000000$，$T = 1$，高风险人群比例 $f_h = 0.2$，因此 $N_h = f_h N$，$N_g = N - N_h$。\n    - 基线发病率：$\\lambda_g = 0.02$，$\\lambda_h = 0.06$。\n    - 已有免疫力：$m_g = 0.3$，$m_h = 0.2$。\n    - 疫苗效力：$e = 0.95$，群体指数：$\\alpha = 0.5$。\n    - 覆盖率：$v_{\\text{mass}} = 0.6$，$v_{\\text{target}} = 0.8$。\n    - 剂次：$d = 2$，$C_{\\text{vac}} = 20$，$C_{\\text{adm}} = 5$。\n    - 不良事件：$C_{\\text{AE}} = 0.5$，$q_{\\text{AE}} = 0.00001$。\n    - 感染成本：$C_{\\text{amb}} = 300$，$C_{\\text{hosp}} = 5000$，$C_{\\text{fulm}} = 20000$。\n    - 概率：$p_{h,g} = 0.1$，$p_{h,h} = 0.15$，$p_{f,g} = 0.0005$，$p_{f,h} = 0.001$，$p_{d,g} = 0.001$，$p_{d,h} = 0.002$。\n    - QALY损失：$q_{\\text{mild}} = 0.005$，$q_{\\text{hosp}} = 0.02$，$q_{\\text{death}} = 25$。\n    - 阈值：$\\tau = 50000$。\n\n- 测试案例2（低发病率，高疫苗成本）：\n    - $N = 2000000$，$T = 1$，$f_h = 0.15$，$N_h = f_h N$，$N_g = N - N_h$。\n    - $\\lambda_g = 0.005$，$\\lambda_h = 0.015$。\n    - $m_g = 0.5$，$m_h = 0.4$。\n    - $e = 0.9$，$\\alpha = 0.5$。\n    - $v_{\\text{mass}} = 0.7$，$v_{\\text{target}} = 0.9$。\n    - $d = 2$，$C_{\\text{vac}} = 50$，$C_{\\text{adm}} = 10$。\n    - $C_{\\text{AE}} = 1$，$q_{\\text{AE}} = 0.00002$。\n    - $C_{\\text{amb}} = 300$，$C_{\\text{hosp}} = 7000$，$C_{\\text{fulm}} = 30000$。\n    - $p_{h,g} = 0.08$，$p_{h,h} = 0.12$，$p_{f,g} = 0.0003$，$p_{f,h} = 0.0008$，$p_{d,g} = 0.0008$，$p_{d,h} = 0.0015$。\n    - $q_{\\text{mild}} = 0.005$，$q_{\\text{hosp}} = 0.02$，$q_{\\text{death}} = 25$。\n    - $\\tau = 50000$。\n\n- 测试案例3（高风险暴发边缘案例）：\n    - $N = 1000000$，$T = 1$，$f_h = 0.3$，$N_h = f_h N$，$N_g = N - N_h$。\n    - $\\lambda_g = 0.03$，$\\lambda_h = 0.1$。\n    - $m_g = 0.25$，$m_h = 0.15$。\n    - $e = 0.95$，$\\alpha = 0.6$。\n    - $v_{\\text{mass}} = 0.8$，$v_{\\text{target}} = 0.85$。\n    - $d = 2$，$C_{\\text{vac}} = 25$，$C_{\\text{adm}} = 5$。\n    - $C_{\\text{AE}} = 0.5$，$q_{\\text{AE}} = 0.00001$。\n    - $C_{\\text{amb}} = 350$，$C_{\\text{hosp}} = 6000$，$C_{\\text{fulm}} = 40000$。\n    - $p_{h,g} = 0.12$，$p_{h,h} = 0.2$，$p_{f,g} = 0.0007$，$p_{f,h} = 0.0015$，$p_{d,g} = 0.0012$，$p_{d,h} = 0.0025$。\n    - $q_{\\text{mild}} = 0.006$，$q_{\\text{hosp}} = 0.025$，$q_{\\text{death}} = 25$。\n    - $\\tau = 100000$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素是对应测试案例的双项列表 $[\\text{ICER}, \\text{decision}]$，例如 $\\left[[12345.6789,\\text{True}],[98765.4321,\\text{False}],[55555.0,\\text{True}]\\right]$。",
            "solution": "该问题要求对两种甲型肝炎疫苗接种策略进行成本效益分析：一种是大规模接种策略，另一种是针对高风险人群的靶向接种策略。分析将在一个固定的时间范围 $T$ 内进行，对象是一个由规模为 $N_h$ 的高风险人群和规模为 $N_g$ 的普通人群组成的总人口 $N$。大规模策略相对于靶向策略是否具有成本效益的决策，是基于增量成本效益比（ICER）和给定的支付意愿阈值 $\\tau$。\n\n解决方案的构建首先是开发一个通用计算模型，用于确定任意疫苗接种策略的总成本 $C_{\\text{tot}}$ 和总质量调整生命年（QALY）损失 $Q_{\\text{tot}}$。然后将此模型应用于两种具体的策略。\n\n首先，对于任何给定的策略，我们为高风险人群和普通人群定义一组疫苗接种覆盖率，分别表示为 $v_h$ 和 $v_g$。这些是范围在 $[0, 1]$ 内的分数。总体的全人群覆盖率 $\\bar{v}$ 是加权平均值：\n$$\n\\bar{v} = \\frac{N_h v_h + N_g v_g}{N}\n$$\n这个人群众覆盖率通过一个群体保护因子 $s$ 影响感染力，其公式为：\n$$\ns = (1 - e \\bar{v})^\\alpha\n$$\n其中 $e$ 是疫苗效力，$\\alpha$ 是一个调节群体保护效应的指数。\n\n对于每个人口群体 $i \\in \\{h, g\\}$，计算在时间范围 $T$ 内的预期感染人数 $I_i$。这是群体规模（$N_i$）、其基线发病率（$\\lambda_i$）、群体保护因子（$s$）、已有免疫力比例（$m_i$）、疫苗效力（$e$）以及该群体的疫苗接种覆盖率（$v_i$）的函数。其公式为：\n$$\nI_i = N_i \\lambda_i s (1 - m_i)(1 - e v_i) T\n$$\n\n在确定感染人数后，我们计算相关的成本和QALY损失。每次感染的预期成本 $E[C \\mid \\text{infection}, i]$ 和每次感染的预期QALY损失 $E[Q \\mid \\text{infection}, i]$，由不同临床结局（门诊、住院、暴发性、死亡）的概率及其各自的成本和QALY减量决定。对于群体 $i$：\n$$\nE[C \\mid \\text{infection}, i] = (1 - p_{h,i}) C_{\\text{amb}} + p_{h,i} C_{\\text{hosp}} + p_{f,i} C_{\\text{fulm}}\n$$\n$$\nE[Q \\mid \\text{infection}, i] = (1 - p_{h,i}) q_{\\text{mild}} + p_{h,i} q_{\\text{hosp}} + p_{d,i} q_{\\text{death}}\n$$\n与感染相关的总成本为 $\\sum_i I_i E[C \\mid \\text{infection}, i]$，与感染相关的总QALY损失为 $\\sum_i I_i E[Q \\mid \\text{infection}, i]$。\n\n接下来，计算与疫苗接种计划直接相关的成本和QALY损失。对于群体 $i$，其人口 $N_i$ 中的一部分比例 $v_i$ 接种疫苗。疫苗接种成本 $C_{\\text{vacc},i}$ 包括疫苗采购、管理以及不良事件的处理。QALY损失 $Q_{\\text{vacc},i}$ 则核算不良事件。\n$$\nC_{\\text{vacc},i} = N_i v_i \\left(d (C_{\\text{vac}} + C_{\\text{adm}}) + C_{\\text{AE}}\\right)\n$$\n$$\nQ_{\\text{vacc},i} = N_i v_i q_{\\text{AE}}\n$$\n\n该策略的总成本 $C_{\\text{tot}}$ 和总QALY损失 $Q_{\\text{tot}}$ 是两个人口群体的感染相关和疫苗接种相关组成部分的总和：\n$$\nC_{\\text{tot}} = \\sum_{i \\in \\{h,g\\}} \\left(I_i E[C \\mid \\text{infection}, i] + C_{\\text{vacc},i}\\right)\n$$\n$$\nQ_{\\text{tot}} = \\sum_{i \\in \\{h,g\\}} \\left(I_i E[Q \\mid \\text{infection}, i] + Q_{\\text{vacc},i}\\right)\n$$\n\n这个通用框架应用于以下两种策略：\n1.  **靶向策略**：此策略仅为高风险人群的一部分接种疫苗。覆盖率为 $v_h = v_{\\text{target}}$ 和 $v_g = 0$。将这些应用到通用框架中，得出总计 $C_{\\text{target}}$ 和 $Q_{\\text{target}}$。\n2.  **大规模策略**：此策略为全部人口的一部分接种疫苗。覆盖率为 $v_h = v_g = v_{\\text{mass}}$。将这些应用后得出总计 $C_{\\text{mass}}$ 和 $Q_{\\text{mass}}$。\n\n最后一步是增量分析。我们计算增量成本 $\\Delta C = C_{\\text{mass}} - C_{\\text{target}}$，以及以避免的QALY损失衡量的增量健康效益 $\\Delta Q = Q_{\\text{target}} - Q_{\\text{mass}}$。\n\n增量成本效益比（ICER）是这些增量的比率：\n$$\n\\text{ICER} = \\frac{\\Delta C}{\\Delta Q}\n$$\n只有当大规模策略比靶向策略更有效时，即当它导致更低的总QALY损失时（$\\Delta Q > 0$），这个比率才有意义。如果 $\\Delta Q \\le 0$，则大规模策略并非更有效，因此不具有成本效益。在这种情况下，ICER被视为无穷大。\n\n决策规则如下：当且仅当大规模策略更有效（$\\Delta Q > 0$）且每获得一个QALY的成本不超过支付意愿阈值（$\\text{ICER} \\le \\tau$）时，该策略才被认为相对于靶向策略具有成本效益。否则，它不具有成本效益。这将产生一个布尔决策。\n\n实现将包含一个主函数，该函数接收给定场景的所有模型参数，为‘靶向’和‘大规模’两种策略计算 $C_{\\text{tot}}$ 和 $Q_{\\text{tot}}$，然后根据上述规则计算ICER和最终的布尔决策。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n\n    test_cases = [\n        # Test case 1 (general transitional endemicity)\n        {\n            \"N\": 2000000, \"T\": 1, \"fh\": 0.2,\n            \"lambda_g\": 0.02, \"lambda_h\": 0.06,\n            \"m_g\": 0.3, \"m_h\": 0.2,\n            \"e\": 0.95, \"alpha\": 0.5,\n            \"v_mass\": 0.6, \"v_target\": 0.8,\n            \"d\": 2, \"C_vac\": 20, \"C_adm\": 5,\n            \"C_AE\": 0.5, \"q_AE\": 0.00001,\n            \"C_amb\": 300, \"C_hosp\": 5000, \"C_fulm\": 20000,\n            \"p_hg\": 0.1, \"p_hh\": 0.15, \"p_fg\": 0.0005, \"p_fh\": 0.001, \"p_dg\": 0.001, \"p_dh\": 0.002,\n            \"q_mild\": 0.005, \"q_hosp\": 0.02, \"q_death\": 25,\n            \"tau\": 50000\n        },\n        # Test case 2 (low incidence, high vaccine cost)\n        {\n            \"N\": 2000000, \"T\": 1, \"fh\": 0.15,\n            \"lambda_g\": 0.005, \"lambda_h\": 0.015,\n            \"m_g\": 0.5, \"m_h\": 0.4,\n            \"e\": 0.9, \"alpha\": 0.5,\n            \"v_mass\": 0.7, \"v_target\": 0.9,\n            \"d\": 2, \"C_vac\": 50, \"C_adm\": 10,\n            \"C_AE\": 1, \"q_AE\": 0.00002,\n            \"C_amb\": 300, \"C_hosp\": 7000, \"C_fulm\": 30000,\n            \"p_hg\": 0.08, \"p_hh\": 0.12, \"p_fg\": 0.0003, \"p_fh\": 0.0008, \"p_dg\": 0.0008, \"p_dh\": 0.0015,\n            \"q_mild\": 0.005, \"q_hosp\": 0.02, \"q_death\": 25,\n            \"tau\": 50000\n        },\n        # Test case 3 (high-risk outbreak edge case)\n        {\n            \"N\": 1000000, \"T\": 1, \"fh\": 0.3,\n            \"lambda_g\": 0.03, \"lambda_h\": 0.1,\n            \"m_g\": 0.25, \"m_h\": 0.15,\n            \"e\": 0.95, \"alpha\": 0.6,\n            \"v_mass\": 0.8, \"v_target\": 0.85,\n            \"d\": 2, \"C_vac\": 25, \"C_adm\": 5,\n            \"C_AE\": 0.5, \"q_AE\": 0.00001,\n            \"C_amb\": 350, \"C_hosp\": 6000, \"C_fulm\": 40000,\n            \"p_hg\": 0.12, \"p_hh\": 0.2, \"p_fg\": 0.0007, \"p_fh\": 0.0015, \"p_dg\": 0.0012, \"p_dh\": 0.0025,\n            \"q_mild\": 0.006, \"q_hosp\": 0.025, \"q_death\": 25,\n            \"tau\": 100000\n        },\n    ]\n\n    results = []\n    for params in test_cases:\n        result = analyze_scenario(params)\n        results.append(result)\n\n    # Format the output as a string representation of a list of lists, without spaces.\n    results_str =','.join(map(str, results))\n    print(f\"[{results_str}]\")\n\ndef calculate_outcomes(params, v_g, v_h):\n    \"\"\"\n    Calculates total cost and total QALY loss for a given strategy.\n    \"\"\"\n    # Unpack parameters\n    N, T, fh = params[\"N\"], params[\"T\"], params[\"fh\"]\n    lambda_g, lambda_h = params[\"lambda_g\"], params[\"lambda_h\"]\n    m_g, m_h = params[\"m_g\"], params[\"m_h\"]\n    e, alpha = params[\"e\"], params[\"alpha\"]\n    d, C_vac, C_adm = params[\"d\"], params[\"C_vac\"], params[\"C_adm\"]\n    C_AE, q_AE = params[\"C_AE\"], params[\"q_AE\"]\n    C_amb, C_hosp, C_fulm = params[\"C_amb\"], params[\"C_hosp\"], params[\"C_fulm\"]\n    p_hg, p_hh = params[\"p_hg\"], params[\"p_hh\"]\n    p_fg, p_fh = params[\"p_fg\"], params[\"p_fh\"]\n    p_dg, p_dh = params[\"p_dg\"], params[\"p_dh\"]\n    q_mild, q_hosp, q_death = params[\"q_mild\"], params[\"q_hosp\"], params[\"q_death\"]\n\n    # Population sizes\n    N_h = N * fh\n    N_g = N - N_h\n\n    # Population-wide coverage and herd factor\n    v_bar = (N_h * v_h + N_g * v_g) / N\n    s = (1 - e * v_bar)**alpha\n\n    # Expected infections\n    I_g = N_g * lambda_g * s * (1 - m_g) * (1 - e * v_g) * T\n    I_h = N_h * lambda_h * s * (1 - m_h) * (1 - e * v_h) * T\n\n    # Expected cost and QALY loss per infection\n    E_C_g = (1 - p_hg) * C_amb + p_hg * C_hosp + p_fg * C_fulm\n    E_C_h = (1 - p_hh) * C_amb + p_hh * C_hosp + p_fh * C_fulm\n    E_Q_g = (1 - p_hg) * q_mild + p_hg * q_hosp + p_dg * q_death\n    E_Q_h = (1 - p_hh) * q_mild + p_hh * q_hosp + p_dh * q_death\n    \n    # Total infection-related costs and QALYs\n    C_inf = I_g * E_C_g + I_h * E_C_h\n    Q_inf = I_g * E_Q_g + I_h * E_Q_h\n\n    # Vaccination-related costs and QALYs\n    cost_per_vacc_person = d * (C_vac + C_adm) + C_AE\n    C_vacc = (N_g * v_g + N_h * v_h) * cost_per_vacc_person\n    Q_vacc = (N_g * v_g + N_h * v_h) * q_AE\n\n    # Total cost and QALY loss\n    C_tot = C_inf + C_vacc\n    Q_tot = Q_inf + Q_vacc\n\n    return C_tot, Q_tot\n\n\ndef analyze_scenario(params):\n    \"\"\"\n    Performs the cost-effectiveness analysis for a single scenario.\n    \"\"\"\n    # Targeted strategy outcomes\n    v_g_target, v_h_target = 0, params[\"v_target\"]\n    C_target, Q_target = calculate_outcomes(params, v_g_target, v_h_target)\n\n    # Mass strategy outcomes\n    v_g_mass, v_h_mass = params[\"v_mass\"], params[\"v_mass\"]\n    C_mass, Q_mass = calculate_outcomes(params, v_g_mass, v_h_mass)\n\n    # Incremental analysis\n    delta_C = C_mass - C_target\n    delta_Q = Q_target - Q_mass\n\n    if delta_Q > 0:\n        icer = delta_C / delta_Q\n        decision = icer = params[\"tau\"]\n    else:\n        # np.inf is used for infinite float as requested.\n        icer = np.inf\n        decision = False\n        \n    return [icer, decision]\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}