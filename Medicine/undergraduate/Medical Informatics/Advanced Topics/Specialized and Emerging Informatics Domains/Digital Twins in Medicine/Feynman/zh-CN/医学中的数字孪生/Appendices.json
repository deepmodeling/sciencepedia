{
    "hands_on_practices": [
        {
            "introduction": "本练习将引导您从质量守恒等第一性原理出发，推导一个基础的药物动力学（PK）模型，为构建药理学数字孪生打下基础。您将建立描述药物浓度随时间变化的数学方程，这是在任何患者特异性情境中模拟药物行为的核心技能。",
            "id": "4836357",
            "problem": "一家医院部署了一个患者特异性计算数字孪生，以支持一种小分子疗法的剂量个体化。对于该患者，该数字孪生采用单室药代动力学（PK）模型，在时间 $t=0$ 时进行静脉（IV）快速推注，并遵循一级消除。该数字孪生将身体表示为一个瞬时且均匀混合的单房室，其分布容积为 $V$，体内药量为 $A(t)$，血浆浓度为 $C(t)$，它们之间的关系为 $C(t)=A(t)/V$。它使用清除率 $CL$ 的临床定义，即在充分混合条件下，清除率是消除速率与浓度之间的比例常数。\n\n仅从 (i) 房室内药物的质量守恒，以及 (ii) 清除率的定义（消除速率等于 $CL$ 乘以浓度）出发，推导在 $t=0$ 时给予静脉快速推注剂量 $D$ 后，当 $t \\ge 0$ 时 $C(t)$ 的解析表达式。\n\n然后，数字孪生估计该患者的 $V$ 和 $CL$ 分别为 $V=40$ L 和 $CL=3.0$ L/h。在 $t=0$ 时给予单次静脉快速推注剂量 $D=500$ mg。使用您推导的表达式，计算在 $t=2$ h 时模型预测的血浆浓度 $C(t)$。将您的答案四舍五入到三位有效数字。最终浓度以 mg/L 为单位表示。",
            "solution": "该问题是有效的，因为它基于标准的药代动力学原理，具有科学依据，其提法恰当，拥有一套完整且一致的定义和数据，并且陈述客观。\n\n求解过程需要两个步骤。首先，推导血浆浓度 $C(t)$ 的解析表达式。其次，使用推导出的表达式计算在指定时间的浓度数值。\n\n推导从单一、充分混合房室内的药物质量守恒原理开始。药物量 $A(t)$ 的变化率是给药速率减去消除速率：\n$$\n\\frac{dA(t)}{dt} = \\text{Rate In} - \\text{Rate Out}\n$$\n对于在时间 $t=0$ 给予的静脉（IV）快速推注剂量，对于任何随后的时间 $t>0$，给药速率为零。\n$$\n\\text{Rate In} = 0 \\quad (\\text{for } t>0)\n$$\n问题将消除速率定义为清除率 $CL$ 与血浆浓度 $C(t)$ 的乘积。\n$$\n\\text{Rate Out} = CL \\cdot C(t)\n$$\n结合这些，得到质量平衡方程：\n$$\n\\frac{dA(t)}{dt} = -CL \\cdot C(t)\n$$\n药量 $A(t)$、浓度 $C(t)$ 和分布容积 $V$ 之间的关系由 $C(t) = \\frac{A(t)}{V}$ 给出。将此关系代入质量平衡方程，我们可以将其完全用 $A(t)$ 表示：\n$$\n\\frac{dA(t)}{dt} = -CL \\cdot \\frac{A(t)}{V} = -\\left(\\frac{CL}{V}\\right)A(t)\n$$\n这是一个一阶线性齐次常微分方程。项 $\\left(\\frac{CL}{V}\\right)$ 代表一级消除速率常数，可以记为 $k_e$。因此，需要求解的方程是 $\\frac{dA(t)}{dt} = -k_e A(t)$。\n\n需要一个初始条件。在 $t=0$ 时，给予快速推注剂量 $D$，并瞬时分布在容积 $V$ 中。因此，体内的初始药量为 $A(0) = D$。这个初值问题的解可以通过分离变量法求得：\n$$\n\\int_{A(0)}^{A(t)} \\frac{dA}{A} = \\int_{0}^{t} -k_e d\\tau \\implies \\ln\\left(\\frac{A(t)}{A(0)}\\right) = -k_e t\n$$\n对两边取指数求解 $A(t)$，得到：\n$$\nA(t) = A(0) \\exp(-k_e t)\n$$\n代入 $A(0)=D$ 和 $k_e = \\frac{CL}{V}$，我们得到药物量随时间变化的表达式：\n$$\nA(t) = D \\exp\\left(-\\frac{CL}{V} t\\right)\n$$\n问题要求的是浓度-时间关系 $C(t)$。使用 $C(t) = \\frac{A(t)}{V}$，我们得到最终的解析表达式：\n$$\nC(t) = \\frac{D}{V} \\exp\\left(-\\frac{CL}{V} t\\right)\n$$\n这个方程描述了在任何时间 $t \\ge 0$ 的血浆浓度。\n\n对于问题的第二部分，我们使用给定的参数计算特定时间的浓度。参数为：剂量 $D=500$ mg，分布容积 $V=40$ L，以及清除率 $CL=3.0$ L/h。我们需要求出时间 $t=2$ h 时的浓度 $C(t)$。\n\n参数的单位是一致的。比率 $\\frac{D}{V}$ 的单位是 mg/L。指数项必须是无量纲的；消除速率常数 $k_e = \\frac{CL}{V}$ 的单位是 $\\frac{\\text{L/h}}{\\text{L}} = \\text{h}^{-1}$，当乘以以小时为单位的时间 $t$ 时，得到一个无量纲的量。最终浓度将以 mg/L 为单位。\n\n我们将数值代入推导出的表达式中：\n$$\nC(2) = \\frac{500}{40} \\exp\\left(-\\frac{3.0}{40} \\times 2\\right)\n$$\n首先，计算初始浓度 $C(0) = \\frac{D}{V}$：\n$$\nC(0) = \\frac{500}{40} = 12.5\n$$\n接下来，计算指数的值：\n$$\n-\\frac{CL}{V} t = -\\frac{3.0}{40} \\times 2 = -0.075 \\times 2 = -0.15\n$$\n现在，将这些计算出的部分代回主方程：\n$$\nC(2) = 12.5 \\times \\exp(-0.15)\n$$\n计算指数函数的值：\n$$\n\\exp(-0.15) \\approx 0.860707976\n$$\n最后，我们计算在 $t=2$ h 时的浓度：\n$$\nC(2) \\approx 12.5 \\times 0.860707976 \\approx 10.7588497\n$$\n问题要求答案应四舍五入到三位有效数字。将 $10.7588497$ 四舍五入到三位有效数字得到 $10.8$。",
            "answer": "$$\\boxed{10.8}$$"
        },
        {
            "introduction": "一个数学模型只有在反映现实时才有用。本练习要求您超越单纯的方程求解，批判性地思考一个简单心血管模型背后的假设。通过辨别哪些假设违反了生理学定律，您将培养一项至关重要的技能：确保模型建立在真实生理学基础之上，这是构建安全可靠的数字孪生时不可或缺的要求。",
            "id": "4836326",
            "problem": "一家医院部署了一个患者特异性的心血管系统数字孪生（DT），以支持闭环治疗。该DT必须根据近实时提供心率 $HR$ 和每搏输出量 $SV$ 的流式传感器来估计心输出量 $CO$。建模团队坚持DT应从一个基础的力学模型出发，以确保约束条件是透明且可强制执行的。使用以下基本定义和定律来构建连接 $CO$ 与 $HR$ 和 $SV$ 的最小力学模型，然后评估不同假设集的生理有效性。\n\n您可用于构建模型的基本依据如下：\n- 瞬时体积流量 $Q(t)$ 的定义为通过主动脉瓣的体积随时间的变化率，一分钟平均心输出量 $CO$ 的定义为 $CO = \\dfrac{1}{\\Delta t} \\displaystyle\\int_{0}^{\\Delta t} Q(t)\\,dt$，其中 $\\Delta t = 60$ 秒。\n- 心率 $HR$ 的定义为单位时间内的心跳次数，$HR = \\dfrac{N}{\\Delta t}$，其中 $N$ 是在时间间隔 $\\Delta t$ 内的心跳次数。\n- 单次心跳的每搏输出量 $SV$ 的定义为在该次心跳期间射出的净容积，$SV = \\displaystyle\\int_{\\text{one beat}} Q(t)\\,dt$。\n- 在稳态条件下，闭合循环回路中的质量守恒定律，要求流量相等：$CO = VR$，其中 $VR$ 是稳态下返回左心的静脉回心血量。\n\n仅从这些基础出发，构建将 $CO$ 表示为 $HR$ 和 $SV$ 的函数的最小力学模型。然后，考虑分析师可能在DT中对所构建模型施加的以下假设集。选择所有会导致模型违反生理约束的集合。\n\nA. 假设 $SV$ 为常数且独立于 $HR$，允许 $HR$ 取任何无上界正实数值，并允许 $SV$ 超过舒张末期容积 $V_{\\text{ED}}$。\n\nB. 施加约束 $SV \\le V_{\\text{ED}} - V_{\\text{ES}}$，其中 $V_{\\text{ES}}$ 为收缩末期容积，通过不应期限制 $HR \\le \\dfrac{1}{t_{\\text{ref}}}$（对于某个 $t_{\\text{ref}} > 0$）来约束心率，并强制在稳态下 $CO = VR$。\n\nC. 设对所有 $HR$，$SV(HR) = S_0 - k\\,HR$，其中 $S_0 > 0$ 且 $k > 0$，并且不对 $SV$ 施加任何非负约束。\n\nD. 通过假设比例为 $n$（$0 \\le n  1$）的心跳是非射血的来模拟心律失常，因此有效心率为 $HR_{\\text{eff}} = (1-n)\\,HR$，同时满足 $SV \\ge 0$，$HR \\le \\dfrac{1}{t_{\\text{ref}}}$，并且在稳态下 $CO = VR$。\n\nE. 在稳态下，允许 $CO$ 超过静脉回心血量一个固定的差值：$CO = VR + \\delta$，其中 $\\delta  0$。\n\n选择所有正确选项。",
            "solution": "该问题需要一个两步过程：首先，基于给定的基本定义推导出心输出量（$CO$）的最小力学模型；其次，评估几组假设的生理有效性。\n\n**第1部分：最小力学模型的推导**\n\n问题提供了以下定义和原理：\n1.  平均心输出量：$CO = \\dfrac{1}{\\Delta t} \\displaystyle\\int_{0}^{\\Delta t} Q(t)\\,dt$，其中 $\\Delta t = 60$ 秒。\n2.  心率：$HR = \\dfrac{N}{\\Delta t}$，其中 $N$ 是在时间间隔 $\\Delta t$ 内的心跳次数。\n3.  每搏输出量：$SV = \\displaystyle\\int_{\\text{one beat}} Q(t)\\,dt$。\n\n我们从时间间隔 $\\Delta t$ 内的平均心输出量定义开始。\n$$CO = \\dfrac{1}{\\Delta t} \\int_{0}^{\\Delta t} Q(t)\\,dt$$\n在时间间隔 $\\Delta t$ 内的总流量积分可以表示为在该时间间隔内发生的 $N$ 次单独心跳的流量积分之和。\n$$\\int_{0}^{\\Delta t} Q(t)\\,dt = \\sum_{i=1}^{N} \\left( \\int_{\\text{beat}_i} Q(t)\\,dt \\right)$$\n根据定义3，单次心跳的流量积分就是每搏输出量 $SV$。对于此推导，我们可以假设在时间间隔 $\\Delta t$ 内每次心跳的每搏输出量是恒定的，或者我们可以将 $SV$ 定义为该时间间隔内的*平均*每搏输出量。在任何一种情况下，总和都变为：\n$$\\sum_{i=1}^{N} \\left( \\int_{\\text{beat}_i} Q(t)\\,dt \\right) = N \\times SV$$\n将此结果代回 $CO$ 的方程中：\n$$CO = \\dfrac{1}{\\Delta t} (N \\times SV)$$\n这可以重新整理为：\n$$CO = \\left( \\dfrac{N}{\\Delta t} \\right) \\times SV$$\n从定义2可知，心率 $HR$ 由 $HR = \\dfrac{N}{\\Delta t}$ 给出。\n将此代入 $CO$ 的方程，得到最小力学模型：\n$$CO = HR \\times SV$$\n这个基本关系将心输出量与心率和每搏输出量联系起来。\n\n**第2部分：假设集的评估**\n\n任务是确定下列哪个假设集会导致模型违反生理约束。\n\n**选项A：**假设 $SV$ 为常数且独立于 $HR$，允许 $HR$ 取任何无上界正实数值，并允许 $SV$ 超过舒张末期容积 $V_{\\text{ED}}$。\n\n这个集合包含多处对生理学原理的违反。\n1.  **无界心率 ($HR$)**: 心率在生理上是有限的。心肌细胞的不应期和房室（AV）结的传导延迟对心脏跳动的速度施加了一个上限。一个年轻成年人的典型最大心率约为每分钟220次，并随年龄增长而下降。允许 $HR$ 无界（例如，$HR \\to \\infty$）在物理上是不可能的。\n2.  **每搏输出量 ($SV$) 超过舒张末期容积 ($V_{\\text{ED}}$)**: 每搏输出量是一次收缩期间从心室射出的血液容积。它被定义为舒张末期容积（$V_{\\text{ED}}$，心室在充盈结束时的血液容积）和收缩末期容积（$V_{\\text{ES}}$，射血后剩余的血液容积）之间的差值。即，$SV = V_{\\text{ED}} - V_{\\text{ES}}$。由于剩余容积 $V_{\\text{ES}}$ 必须是非负的（$V_{\\text{ES}} \\ge 0$），因此一个直接的推论是 $SV \\le V_{\\text{ED}}$。心室射出的血液比其最充盈时所含的血液还多，这在物理上是不可能的。\n因此，这个假设集引入了至少两个对生理约束的基本违反。\n\n对A的判决：**正确**。\n\n**选项B：**施加约束 $SV \\le V_{\\text{ED}} - V_{\\text{ES}}$，其中 $V_{\\text{ES}}$ 为收缩末期容积，通过不应期限制 $HR \\le \\dfrac{1}{t_{\\text{ref}}}$（对于某个 $t_{\\text{ref}}  0$）来约束心率，并强制在稳态下 $CO = VR$。\n\n这个集合描述的约束使模型在生理上*更*加真实。\n1.  **$SV \\le V_{\\text{ED}} - V_{\\text{ES}}$**: 严格的生理学定义是 $SV = V_{\\text{ED}} - V_{\\text{ES}}$。使用“$\\le$”虽然略有不精确，但并未引入违反；它正确地为每搏输出量设定了上界。更重要的是，这意味着 $SV \\le V_{\\text{ED}}$，这是一个有效的约束。\n2.  **$HR \\le \\dfrac{1}{t_{\\text{ref}}}$**: 这正确地基于心肌不应期 $t_{\\text{ref}}$ 对心率施加了一个生物物理学上的上限。\n3.  **稳态下 $CO = VR$**: 这是稳态下闭合循环系统的质量守恒定律的表述，是生理学的一个基本原理，也在问题陈述中给出。\n该集合中的所有约束在生理上都是有效的，并且对于一个现实的模型是必要的。它们不会导致违反。\n\n对B的判决：**不正确**。\n\n**选项C：**设对所有 $HR$，$SV(HR) = S_0 - k\\,HR$，其中 $S_0  0$ 且 $k  0$，并且不对 $SV$ 施加任何非负约束。\n\n这个集合提出了一个描述 $SV$ 与 $HR$ 关系的简化线性模型。虽然这种反比关系在定性上是正确的（在高心率时，充盈时间减少，从而导致 $SV$ 减少），但缺乏非负约束是一个致命的缺陷。\n1.  **负每搏输出量的可能性**: 每搏输出量是一个物理体积，不能为负。模型 $SV(HR) = S_0 - k\\,HR$ 将对任何心率 $HR  \\dfrac{S_0}{k}$ 预测出负的每搏输出量。由于假设声明该模型对“所有 $HR$”都成立，并且心率在生理上允许在很宽的范围内变化，因此将存在一个生理上可达到的心率，使得模型预测 $SV  0$。负的每搏输出量意味着在收缩期血液从主动脉倒流入心室，这在物理上和生理上都是不可能的。缺乏非负约束（$SV \\ge 0$）使该模型无效。\n\n对C的判决：**正确**。\n\n**选项D：**通过假设比例为 $n$（$0 \\le n  1$）的心跳是非射血的来模拟心律失常，因此有效心率为 $HR_{\\text{eff}} = (1-n)\\,HR$，同时满足 $SV \\ge 0$，$HR \\le \\dfrac{1}{t_{\\text{ref}}}$，并且在稳态下 $CO = VR$。\n\n这个集合描述了一个更高级但生理上合理的模型，用于模拟某些类型的心律失常，其中一些心脏的电激动不会导致有效的机械收缩（例如，一些室性早搏）。\n1.  **有效心率 ($HR_{\\text{eff}}$)**: 使用对心输出量有贡献的有效心率这一概念，是模拟此类现象的有效方法。由此产生的心输出量将是 $CO = HR_{\\text{eff}} \\times SV = (1-n) \\times HR \\times SV$。\n2.  **$SV \\ge 0$**: 这是一个有效且必要的生理约束。\n3.  **$HR \\le \\dfrac{1}{t_{\\text{ref}}}$**: 这是一个有效的生物物理学限制。\n4.  **$CO = VR$**: 这是正确的稳态条件。\n这组假设构建了一个生理上合理但简化的模型。它没有引入违反。\n\n对D的判决：**不正确**。\n\n**选项E：**在稳态下，允许 $CO$ 超过静脉回心血量一个固定的差值：$CO = VR + \\delta$，其中 $\\delta  0$。\n\n这个假设直接违反了处于稳态的闭合系统所遵循的物理学和生理学基本原理。\n1.  **违反质量守恒定律**: 循环系统是一个闭合回路。在稳态下，流出任何组件的速率必须等于流入它的速率。左心将血液泵出到身体（$CO$），这些血液最终作为静脉回心血量（$VR$）返回心脏。要使系统处于稳态，动脉和静脉室中的血容量必须随时间保持恒定。这要求流出心脏的流量等于流入心脏的流量，即 $CO = VR$。假设 $CO = VR + \\delta$ 且 $\\delta  0$ 意味着单位时间内离开心脏的血液多于返回的血液。这将导致静脉侧血液的持续耗尽和动脉侧的持续累积，这是一种灾难性的非稳态状况。这违反了质量守恒原理，而该原理已被明确作为有效依据提供。\n\n对E的判决：**正确**。\n\n总而言之，假设集A、C和E会导致模型违反基本的生理和物理约束。",
            "answer": "$$\\boxed{ACE}$$"
        },
        {
            "introduction": "最后的这项练习将建模与仿真融入一个实际的决策任务中，模拟了医疗数字孪生的最终目标。在这个编程挑战中，您将为几个虚拟患者实施一个简化的数字孪生，以模拟并优化他们的给药方案。这种动手实践经验展示了个性化模型如何用于权衡治疗效果与毒性，从而指导临床策略。",
            "id": "4836348",
            "problem": "您正在构建一个简化的患者特异性数字孪生，该模型耦合了药代动力学 (PK) 和药效动力学 (PD)，用于设计静脉推注给药方案。PK 模型被建模为具有一级消除的单室系统，而 PD 毒性替代指标是药物浓度超过毒性阈值的总时间。目标是为多个患者特异性数字孪生选择一种给药方案，该方案能在满足给药约束的前提下，实现目标暴露范围，同时最大限度地减少毒性。\n\n基本和核心定义：\n- 中央室中的药物量，以 $A(t)$ 表示（单位 $\\mathrm{mg}$），遵循以下质量平衡常微分方程 (ODE)：$$\\frac{dA}{dt} = -k \\, A(t),$$ 其中 $k = \\frac{\\mathrm{CL}}{V}$（单位 $\\mathrm{h}^{-1}$）是一级消除速率常数，$\\mathrm{CL}$ 是清除率（单位 $\\mathrm{L}/\\mathrm{h}$），$V$ 是分布容积（单位 $\\mathrm{L}$）。浓度为 $C(t) = \\frac{A(t)}{V}$（单位 $\\mathrm{mg}/\\mathrm{L}$）。\n- 在时间 $t = t_d$ 进行静脉推注给药，药物量瞬时增加 $D$（单位 $\\mathrm{mg}$），因此 $A(t_d^+) = A(t_d^-) + D$。等效地，$C(t_d^+) = C(t_d^-) + \\frac{D}{V}$。\n- 暴露量由浓度-时间曲线下面积量化：$$\\mathrm{AUC}_{[0,T]} = \\int_{0}^{T} C(t) \\, dt,$$ （单位 $\\mathrm{mg}\\cdot\\mathrm{h}/\\mathrm{L}$）。\n- 毒性替代指标是超出毒性阈值时间：$$\\mathrm{TAT}_{[0,T]} = \\int_{0}^{T} \\mathbb{1}\\!\\left(C(t)  C_{\\mathrm{tox}}\\right) \\, dt,$$ （单位 $\\mathrm{h}$），其中 $\\mathbb{1}(\\cdot)$ 是指示函数，$C_{\\mathrm{tox}}$ 是毒性阈值（单位 $\\mathrm{mg}/\\mathrm{L}$）。\n\n设计任务：\n- 考虑一个有限给药方案，该方案由单次给药剂量 $D$（单位 $\\mathrm{mg}$）、给药间隔 $\\tau$（单位 $\\mathrm{h}$）和给药次数 $N$（正整数）定义。给药时间点为 $t = 0, \\tau, 2\\tau, \\ldots, (N-1)\\tau$。\n- 模拟时程为 $$T_{\\mathrm{end}} = N \\tau + T_{\\mathrm{tail}},$$ 其中 $T_{\\mathrm{tail}}$（单位 $\\mathrm{h}$）是为每位患者指定的，用于捕捉最后一次给药后的消除尾端。\n- 主要目标是在满足暴露量 (AUC) 约束 $$\\mathrm{AUC}_{\\min} \\le \\mathrm{AUC}_{[0,T_{\\mathrm{end}}]} \\le \\mathrm{AUC}_{\\max}$$ 的条件下，最小化 $\\mathrm{TAT}_{[0,T_{\\mathrm{end}}]}$。如果多个方案在满足 AUC 约束的情况下具有相同的 $\\mathrm{TAT}$（在数值公差范围内），则选择总给药剂量 $D_{\\mathrm{tot}} = N D$ 最小的方案。如果仍然持平，则优先选择 $\\tau$ 最大的方案。\n- 如果没有方案满足 AUC 约束，则选择使与目标范围中心的绝对偏差最小化的方案，即 $$\\left| \\mathrm{AUC}_{[0,T_{\\mathrm{end}}]} - \\frac{\\mathrm{AUC}_{\\min} + \\mathrm{AUC}_{\\max}}{2} \\right|,$$ 并依次使用 $\\mathrm{TAT}$、然后 $D_{\\mathrm{tot}}$、然后 $\\tau$ 作为决胜规则。\n- 给药约束：最大日给药速率约束 $$D \\cdot \\frac{24}{\\tau} \\le D_{\\mathrm{daily, max}},$$ （单位 $\\mathrm{mg}/\\mathrm{day}$），以及下面给出的 $D$、$\\tau$ 和 $N$ 的显式可行集。\n\n数值模拟要求：\n- 使用固定步长前向模拟来近似 $[0, T_{\\mathrm{end}}]$ 上的 $C(t)$、$\\mathrm{AUC}$ 和 $\\mathrm{TAT}$。选择一个固定时间步长 $\\Delta t$（单位 $\\mathrm{h}$），并根据步长内的精确衰减进行更新：如果步长内没有给药，则 $C(t + \\Delta t) = C(t) \\exp(-k \\Delta t)$。当 $t$ 与计划的给药时间匹配时，在步长边界应用推注剂量。在每个步长上使用矩形法则对 $\\mathrm{AUC}$ 和 $\\mathrm{TAT}$ 进行数值积分。\n\n测试套件：\n实现您的程序，为以下四个患者特异性数字孪生解决该优化问题。对于每种情况，所有单位必须严格按照规定进行解释，并且您的程序必须计算并返回优化后的方案及相关指标。\n\n- 情况 1：\n  - $\\mathrm{CL} = 5 \\ \\mathrm{L}/\\mathrm{h}$，$V = 50 \\ \\mathrm{L}$，$C_{\\mathrm{tox}} = 8 \\ \\mathrm{mg}/\\mathrm{L}$。\n  - 允许的单次给药剂量 $D \\in \\{100, 200, 300, 400, 500\\}$（单位 $\\mathrm{mg}$）。\n  - 允许的给药间隔 $\\tau \\in \\{12, 24\\}$（单位 $\\mathrm{h}$）。\n  - 允许的给药次数 $N \\in \\{2, 3, 4\\}$。\n  - 日给药限制 $D_{\\mathrm{daily, max}} = 800$（单位 $\\mathrm{mg}/\\mathrm{day}$）。\n  - 暴露目标范围：$\\mathrm{AUC}_{\\min} = 60$，$\\mathrm{AUC}_{\\max} = 80$（单位 $\\mathrm{mg}\\cdot\\mathrm{h}/\\mathrm{L}$）。\n  - 尾端时间 $T_{\\mathrm{tail}} = 48$（单位 $\\mathrm{h}$）。\n- 情况 2：\n  - $\\mathrm{CL} = 12 \\ \\mathrm{L}/\\mathrm{h}$，$V = 40 \\ \\mathrm{L}$，$C_{\\mathrm{tox}} = 7 \\ \\mathrm{mg}/\\mathrm{L}$。\n  - 允许的单次给药剂量 $D \\in \\{100, 200, 300, 400, 500\\}$（单位 $\\mathrm{mg}$）。\n  - 允许的给药间隔 $\\tau \\in \\{8, 12\\}$（单位 $\\mathrm{h}$）。\n  - 允许的给药次数 $N \\in \\{3, 4\\}$。\n  - 日给药限制 $D_{\\mathrm{daily, max}} = 1000$（单位 $\\mathrm{mg}/\\mathrm{day}$）。\n  - 暴露目标范围：$\\mathrm{AUC}_{\\min} = 80$，$\\mathrm{AUC}_{\\max} = 100$（单位 $\\mathrm{mg}\\cdot\\mathrm{h}/\\mathrm{L}$）。\n  - 尾端时间 $T_{\\mathrm{tail}} = 48$（单位 $\\mathrm{h}$）。\n- 情况 3：\n  - $\\mathrm{CL} = 6 \\ \\mathrm{L}/\\mathrm{h}$，$V = 20 \\ \\mathrm{L}$，$C_{\\mathrm{tox}} = 9 \\ \\mathrm{mg}/\\mathrm{L}$。\n  - 允许的单次给药剂量 $D \\in \\{100, 200, 300, 400, 500\\}$（单位 $\\mathrm{mg}$）。\n  - 允许的给药间隔 $\\tau \\in \\{8, 12, 24\\}$（单位 $\\mathrm{h}$）。\n  - 允许的给药次数 $N \\in \\{2, 3, 4\\}$。\n  - 日给药限制 $D_{\\mathrm{daily, max}} = 800$（单位 $\\mathrm{mg}/\\mathrm{day}$）。\n  - 暴露目标范围：$\\mathrm{AUC}_{\\min} = 50$，$\\mathrm{AUC}_{\\max} = 60$（单位 $\\mathrm{mg}\\cdot\\mathrm{h}/\\mathrm{L}$）。\n  - 尾端时间 $T_{\\mathrm{tail}} = 48$（单位 $\\mathrm{h}$）。\n- 情况 4：\n  - $\\mathrm{CL} = 2 \\ \\mathrm{L}/\\mathrm{h}$，$V = 60 \\ \\mathrm{L}$，$C_{\\mathrm{tox}} = 6 \\ \\mathrm{mg}/\\mathrm{L}$。\n  - 允许的单次给药剂量 $D \\in \\{100, 200, 300, 400, 500\\}$（单位 $\\mathrm{mg}$）。\n  - 允许的给药间隔 $\\tau \\in \\{24\\}$（单位 $\\mathrm{h}$）。\n  - 允许的给药次数 $N \\in \\{1, 2\\}$。\n  - 日给药限制 $D_{\\mathrm{daily, max}} = 400$（单位 $\\mathrm{mg}/\\mathrm{day}$）。\n  - 暴露目标范围：$\\mathrm{AUC}_{\\min} = 50$，$\\mathrm{AUC}_{\\max} = 60$（单位 $\\mathrm{mg}\\cdot\\mathrm{h}/\\mathrm{L}$）。\n  - 尾端时间 $T_{\\mathrm{tail}} = 72$（单位 $\\mathrm{h}$）。\n\n实现细节：\n- 对所有情况使用固定的时间步长 $\\Delta t = 0.05$（单位 $\\mathrm{h}$）。\n- 对于每个满足日给药限制的候选方案 $(D, \\tau, N)$，在 $[0, T_{\\mathrm{end}}]$ 上模拟 $C(t)$，计算 $\\mathrm{AUC}$ 和 $\\mathrm{TAT}$，并根据所述目标和决胜规则选择最优方案。\n- 所有最终浓度以 $\\mathrm{mg}/\\mathrm{L}$ 表示，时间以 $\\mathrm{h}$ 表示，剂量以 $\\mathrm{mg}$ 表示。\n- 您的程序应生成单行输出，其中包含所有四种情况的结果，形式为方括号内以逗号分隔的列表，每种情况以 $[D, \\tau, N, \\mathrm{AUC}, \\mathrm{TAT}]$ 的列表形式报告。将 $\\mathrm{AUC}$ 和 $\\mathrm{TAT}$ 四舍五入到三位小数。例如，一个有效的输出行可能如下所示：$[[200,24,2,75.123,1.500],[\\ldots],\\ldots]$。",
            "solution": "用户提供的问题是临床药代动力学和药效动力学 (PK/PD) 领域中一个定义明确的优化任务。它在科学上基于成熟的单室 PK 模型原理，提出了一个清晰、客观且可解决的问题。所有必要的参数和约束都已提供，使得问题自成体系且没有歧义。任务是在一个有限的可能方案集合中进行搜索，通过最小化毒性指标同时满足暴露目标，来找到最优的静脉推注给药方案。\n\n解决方案的方法论涉及在由单次给药剂量 $D$、给药间隔 $\\tau$ 和给药次数 $N$ 定义的可能给药方案的离散参数空间上进行穷举搜索。对于每个患者特异性病例，我们遍历这三个参数的所有组合。\n\n首先，根据最大日给药速率约束对每个潜在方案 $(D, \\tau, N)$ 进行验证：\n$$D \\cdot \\frac{24}{\\tau} \\le D_{\\mathrm{daily, max}}$$\n违反此约束的方案将被舍弃。\n\n对于每个有效方案，执行数值模拟以确定其产生的药代动力学特征和相关指标。该模拟在时间范围 $[0, T_{\\mathrm{end}}]$ 内对单室中的药物浓度 $C(t)$ 进行建模，其中 $T_{\\mathrm{end}} = N \\tau + T_{\\mathrm{tail}}$。模拟以大小为 $\\Delta t = 0.05 \\ \\mathrm{h}$ 的离散时间步长进行。\n\n浓度动态遵循以下规则：\n1.  **一级消除**：在没有给药的情况下，浓度呈指数衰减。一个时间步长结束时的浓度 $C(t+\\Delta t)$ 与开始时的浓度 $C(t)$ 的关系如下：\n    $$C(t + \\Delta t) = C(t) \\exp(-k \\Delta t)$$\n    其中 $k = \\mathrm{CL}/V$ 是消除速率常数。\n2.  **推注给药**：在计划的给药时间点 $t_d = 0, \\tau, 2\\tau, \\ldots, (N-1)\\tau$，浓度瞬时增加：\n    $$C(t_d^+) = C(t_d^-) + \\frac{D}{V}$$\n    其中 $C(t_d^-)$ 是给药前的浓度，$C(t_d^+)$ 是给药后的浓度。\n\n在模拟过程中，使用左矩形法则对两个关键指标进行积分：\n1.  **曲线下面积（暴露量）**：\n    $$\\mathrm{AUC}_{[0,T_{\\mathrm{end}}]} = \\sum_{i} C(t_i) \\Delta t$$\n2.  **超出毒性阈值时间（毒性替代指标）**：\n    $$\\mathrm{TAT}_{[0,T_{\\mathrm{end}}]} = \\sum_{i} \\mathbb{1}(C(t_i)  C_{\\mathrm{tox}}) \\Delta t$$\n    其中 $\\mathbb{1}(\\cdot)$ 是指示函数。\n\n在为给定患者模拟所有有效方案后，收集结果。基于一个双层目标函数选择最优方案：\n\n1.  **主要目标**：如果存在计算出的 $\\mathrm{AUC}_{[0,T_{\\mathrm{end}}]}$ 落在目标范围 $[\\mathrm{AUC}_{\\min}, \\mathrm{AUC}_{\\max}]$ 内的方案，则从此子集中进行选择。目标是找到使 $\\mathrm{TAT}_{[0,T_{\\mathrm{end}}]}$ 最小化的方案。决胜规则是选择总给药剂量 $D_{\\mathrm{tot}} = N D$ 最小的方案，然后是给药间隔 $\\tau$ 最大的方案。这意味着按元组 $(\\mathrm{TAT}, D_{\\mathrm{tot}}, -\\tau)$ 对有效方案进行排序。\n\n2.  **次要目标**：如果没有方案满足 $\\mathrm{AUC}$ 目标，则从所有模拟过的方案中进行选择。目标是找到使其 $\\mathrm{AUC}$ 与目标范围中心的绝对偏差最小化的方案，即最小化 $|\\mathrm{AUC}_{[0,T_{\\mathrm{end}}]} - (\\mathrm{AUC}_{\\min} + \\mathrm{AUC}_{\\max})/2|$。决胜规则是依次最小化 $\\mathrm{TAT}$，然后最小化 $D_{\\mathrm{tot}}$，最后最大化 $\\tau$。这意味着按元组 $(\\text{deviation}, \\mathrm{TAT}, D_{\\mathrm{tot}}, -\\tau)$ 进行排序。\n\n整个过程独立应用于所提供的四个患者特异性病例中的每一个。最终输出是一个列表，其中包含每种情况的最优方案参数 $(D, \\tau, N)$ 和相应的计算指标 $(\\mathrm{AUC}, \\mathrm{TAT})$，指标四舍五入到三位小数。",
            "answer": "```python\nimport numpy as np\n\ndef run_simulation(D, tau, N, CL, V, C_tox, T_tail, dt):\n    \"\"\"\n    Simulates a one-compartment PK model for a given dosing regimen.\n\n    Args:\n        D (float): Dose amount (mg).\n        tau (float): Dosing interval (h).\n        N (int): Number of doses.\n        CL (float): Clearance (L/h).\n        V (float): Volume of distribution (L).\n        C_tox (float): Toxicity threshold (mg/L).\n        T_tail (float): Simulation tail time after last dose (h).\n        dt (float): Simulation time step (h).\n\n    Returns:\n        tuple[float, float]: Calculated AUC and TAT.\n    \"\"\"\n    k = CL / V\n    T_end = N * tau + T_tail\n    \n    num_steps = int(round(T_end / dt))\n    # Using a set for efficient lookup of dose time indices\n    dose_indices = {int(round(i * tau / dt)) for i in range(N)}\n    dose_concentration = D / V\n    \n    C_current = 0.0\n    total_auc = 0.0\n    total_tat = 0.0\n    decay_factor = np.exp(-k * dt)\n    \n    # Step-by-step simulation using the exact solution over the interval dt\n    for i in range(num_steps):\n        # Apply dose at the beginning of the step interval\n        if i in dose_indices:\n            C_current += dose_concentration\n        \n        # Accumulate metrics based on the concentration at the start of the interval (left-rectangle rule)\n        total_auc += C_current * dt\n        if C_current > C_tox:\n            total_tat += dt\n            \n        # Calculate concentration for the start of the next step\n        C_current *= decay_factor\n    \n    return total_auc, total_tat\n\ndef solve():\n    \"\"\"\n    Finds the optimal dosing regimen for multiple patient cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"CL\": 5.0, \"V\": 50.0, \"C_tox\": 8.0,\n            \"D_set\": [100, 200, 300, 400, 500],\n            \"tau_set\": [12, 24],\n            \"N_set\": [2, 3, 4],\n            \"D_daily_max\": 800.0,\n            \"AUC_min\": 60.0, \"AUC_max\": 80.0,\n            \"T_tail\": 48.0,\n        },\n        {\n            \"CL\": 12.0, \"V\": 40.0, \"C_tox\": 7.0,\n            \"D_set\": [100, 200, 300, 400, 500],\n            \"tau_set\": [8, 12],\n            \"N_set\": [3, 4],\n            \"D_daily_max\": 1000.0,\n            \"AUC_min\": 80.0, \"AUC_max\": 100.0,\n            \"T_tail\": 48.0,\n        },\n        {\n            \"CL\": 6.0, \"V\": 20.0, \"C_tox\": 9.0,\n            \"D_set\": [100, 200, 300, 400, 500],\n            \"tau_set\": [8, 12, 24],\n            \"N_set\": [2, 3, 4],\n            \"D_daily_max\": 800.0,\n            \"AUC_min\": 50.0, \"AUC_max\": 60.0,\n            \"T_tail\": 48.0,\n        },\n        {\n            \"CL\": 2.0, \"V\": 60.0, \"C_tox\": 6.0,\n            \"D_set\": [100, 200, 300, 400, 500],\n            \"tau_set\": [24],\n            \"N_set\": [1, 2],\n            \"D_daily_max\": 400.0,\n            \"AUC_min\": 50.0, \"AUC_max\": 60.0,\n            \"T_tail\": 72.0,\n        },\n    ]\n\n    dt = 0.05\n    all_final_results = []\n\n    for params in test_cases:\n        candidate_regimens = []\n        \n        # Iterate over the discrete search space for the regimen\n        for D in params[\"D_set\"]:\n            for tau in params[\"tau_set\"]:\n                for N in params[\"N_set\"]:\n                    # Check the daily dosing rate constraint\n                    if D * (24.0 / tau) > params[\"D_daily_max\"]:\n                        continue\n\n                    AUC, TAT = run_simulation(\n                        D=D, tau=tau, N=N,\n                        CL=params[\"CL\"], V=params[\"V\"], C_tox=params[\"C_tox\"],\n                        T_tail=params[\"T_tail\"], dt=dt\n                    )\n                    \n                    candidate_regimens.append({\n                        \"D\": D, \"tau\": tau, \"N\": N,\n                        \"AUC\": AUC, \"TAT\": TAT, \"D_tot\": D * N\n                    })\n        \n        in_target_regimens = []\n        out_of_target_regimens = []\n        \n        AUC_min, AUC_max = params[\"AUC_min\"], params[\"AUC_max\"]\n        AUC_center = (AUC_min + AUC_max) / 2.0\n\n        for reg in candidate_regimens:\n            if AUC_min = reg[\"AUC\"] = AUC_max:\n                in_target_regimens.append(reg)\n            else:\n                reg[\"dev\"] = abs(reg[\"AUC\"] - AUC_center)\n                out_of_target_regimens.append(reg)\n\n        if in_target_regimens:\n            # Primary Objective: in-target, minimize TAT, then D_tot, then maximize tau\n            in_target_regimens.sort(key=lambda r: (r[\"TAT\"], r[\"D_tot\"], -r[\"tau\"]))\n            best_regimen = in_target_regimens[0]\n        else:\n            # Secondary Objective: out-of-target, minimize deviation, then TAT, then D_tot, then maximize tau\n            out_of_target_regimens.sort(key=lambda r: (r[\"dev\"], r[\"TAT\"], r[\"D_tot\"], -r[\"tau\"]))\n            best_regimen = out_of_target_regimens[0]\n            \n        final_result_for_case = [\n            best_regimen[\"D\"],\n            best_regimen[\"tau\"],\n            best_regimen[\"N\"],\n            round(best_regimen[\"AUC\"], 3),\n            round(best_regimen[\"TAT\"], 3)\n        ]\n        all_final_results.append(final_result_for_case)\n\n    # Convert each inner list to its string representation\n    results_as_strings = [str(res) for res in all_final_results]\n    print(f\"[{','.join(results_as_strings)}]\")\n\nsolve()\n```"
        }
    ]
}