{
    "hands_on_practices": [
        {
            "introduction": "在医疗数据挖掘中，一项基本任务是“计算表型分析”，即从原始的电子健康记录（EHR）数据中识别和定义患者的临床状态。这个练习模拟了一个真实的表型分析任务：计算Charlson合并症指数，这是一个广泛应用的风险评分。通过这个练习，你将实践医疗信息学中的核心技能，例如定义回溯期和处理数据的不确定性，从而将零散的诊断代码转化为有临床意义的洞见。",
            "id": "4854005",
            "problem": "一个卫生系统试图为一名患者在一次指标性就诊中，使用记录在电子健康记录 (EHR) 中的国际疾病分类 (ICD) 诊断代码，计算其基线 Charlson 合并症指数 (CCI)。该基线计算必须遵循医学信息学和医疗数据挖掘中的标准队列对齐原则：合并症应在指标日期之前的一个固定回溯期内确定，而在指标日期之后记录的代码除非被明确建模以纠正潜在的误分类，否则应从基线中排除。\n\n使用以下基本依据：\n- Charlson 合并症指数 (CCI) 定义为各类别权重之和，其中每个合并症类别最多计算一次。与此患者相关的类别及其规范权重为：心肌梗死 ($1$)、充血性心力衰竭 ($1$)、外周血管疾病 ($1$)、慢性肺部疾病 ($1$)、无并发症的糖尿病 ($1$)、伴有终末器官损害的糖尿病 ($2$)、中度至重度肾病 ($2$)，以及获得性免疫缺陷综合征/人类免疫缺陷病毒 (AIDS/HIV) ($6$)。如果同时存在无并发症的糖尿病和伴有终末器官损害的糖尿病，则只计算伴有终末器官损害的糖尿病的更高权重 ($2$)。\n- 队列对齐：使用指标日期 $I$ 之前的 $365$ 天固定回溯窗口来定义基线合并症状态。严格在 $I$ 之后记录的代码不用于确定基线，但为了处理指标后记录的慢性病可能存在的误分类问题，假设一个不确定性模型，其中指标后代码贡献其权重乘以它反映的是一个已存在病症而非与指标事件相关的新发病症的概率。假设这些指标后误分类概率在不同类别之间是独立的。\n\n指标日期：\n- $I = 2024-07-01$\n\n患者的 ICD-10 代码及记录日期：\n- I25.2 (陈旧性心肌梗死) 于 $2023-08-15$\n- I50.9 (充血性心力衰竭) 于 $2024-06-10$\n- E11.9 ($2$ 型糖尿病，无并发症) 于 $2023-12-05$\n- E11.21 (伴有糖尿病肾病的 $2$ 型糖尿病) 于 $2024-06-20$\n- J44.9 (慢性阻塞性肺疾病) 于 $2024-03-10$\n- I73.9 (外周血管疾病) 于 $2024-05-21$\n- N18.5 (慢性肾脏病，$5$ 期) 于 $2024-07-10$，为指标后记录，其反映一个已存在病症的概率为 $p_{r} = 0.65$\n- B20 (人类免疫缺陷病毒病) 于 $2024-07-03$，为指标后记录，其反映一个已存在病症的概率为 $p_{h} = 0.25$\n- C18.9 (结肠恶性肿瘤) 于 $2023-01-20$\n- G81.9 (偏瘫，未特指) 于 $2022-12-31$\n\n基于数据挖掘原则的任务：\n- 确定严格在 $I$ 之前的 $365$ 天回溯窗口。\n- 识别哪些代码落入回溯窗口内，并根据上述类别规则将其映射到 CCI 类别，确保执行了类别内去重和糖尿病的严重性优先规则。回溯窗口之外的代码将被排除。对于在 $I$ 之后记录的代码，将它们从确定性基线状态中排除，但使用提供的误分类概率，以期望值的形式纳入其贡献。\n- 在指标后各类别误分类独立的假设下，计算在 $I$ 时的期望 CCI，即确定性的指标前基线权重之和加上经概率加权的指标后贡献之和。\n\n将最终答案表示为一个无单位的小数，并将您的答案四舍五入到四位有效数字。最终答案中不需要单位。仅提供单个数值作为最终答案。",
            "solution": "用户要求根据电子健康记录 (EHR) 中的诊断代码，为一名患者计算期望 Charlson 合并症指数 (CCI)。此过程需要验证问题陈述，应用医学信息学原理进行队列构建，并执行指定的计算。\n\n### 步骤 1：问题验证\n\n首先，逐字提取问题陈述中的已知条件。\n- **指标日期**：$I = 2024-07-01$。\n- **回溯窗口**：指标日期 $I$ 之前的 $365$ 天。\n- **CCI 类别及权重**：\n  - 心肌梗死：权重 $1$。\n  - 充血性心力衰竭：权重 $1$。\n  - 外周血管疾病：权重 $1$。\n  - 慢性肺部疾病：权重 $1$。\n  - 无并发症的糖尿病：权重 $1$。\n  - 伴有终末器官损害的糖尿病：权重 $2$。\n  - 中度至重度肾病：权重 $2$。\n  - 获得性免疫缺陷综合征/人类免疫缺陷病毒 (AIDS/HIV)：权重 $6$。\n- **CCI 计算规则**：\n  - 每个类别最多计算一次。\n  - 如果两种糖尿病类别都存在，只计算更高的权重 ($2$)。\n- **指标后不确定性模型**：\n  - 一个指标后代码贡献其权重乘以它反映的是一个已存在病症的概率。\n  - 假设这些概率是独立的。\n- **患者数据（ICD-10 代码和日期）**：\n  - `I25.2` (陈旧性心肌梗死) 于 $2023-08-15$\n  - `I50.9` (充血性心力衰竭) 于 $2024-06-10$\n  - `E11.9` ($2$ 型糖尿病，无并发症) 于 $2023-12-05$\n  - `E11.21` (伴有糖尿病肾病的 $2$ 型糖尿病) 于 $2024-06-20$\n  - `J44.9` (慢性阻塞性肺疾病) 于 $2024-03-10$\n  - `I73.9` (外周血管疾病) 于 $2024-05-21$\n  - `N18.5` (慢性肾脏病，$5$ 期) 于 $2024-07-10$，其为已存在病症的概率 $p_{r} = 0.65$。\n  - `B20` (人类免疫缺陷病毒病) 于 $2024-07-03$，其为已存在病症的概率 $p_{h} = 0.25$。\n  - `C18.9` (结肠恶性肿瘤) 于 $2023-01-20$\n  - `G81.9` (偏瘫，未特指) 于 $2022-12-31$\n- **任务**：计算期望 CCI，将最终答案四舍五入到四位有效数字。\n\n该问题具有科学依据，使用了医学信息学中的标准概念，如 CCI、ICD 代码和回溯窗口。问题提法得当，提供了计算唯一且有意义解所需的所有数据和规则。语言客观精确。问题不违反任何无效性标准。因此，该问题被判定为**有效**。\n\n### 步骤 2：求解过程\n\n求解过程分为四个阶段：(1) 确定回溯期，(2) 识别和映射相关的基线代码，(3) 计算 CCI 的确定性部分，以及 (4) 计算指标后代码的期望值以求得总期望 CCI。\n\n**1. 确定回溯窗口**\n指标日期为 $I = 2024-07-01$。回溯窗口涵盖此日期之前的 $365$ 天。$2024$ 年是闰年，包含 $2$ 月 $29$ 日。\n该期间从 $2023-07-02$ 开始，到 $2024-06-30$ 结束。任何在此包含性日期范围 $[2023-07-02, 2024-06-30]$ 内记录的诊断代码都将被考虑用于基线合并症评估。\n\n**2. 识别和映射基线代码**\n我们检查每个代码的记录日期以确定其是否被包含。\n- `I25.2` (心肌梗死) 于 $2023-08-15$：**在**窗口内。映射到心肌梗死。\n- `I50.9` (充血性心力衰竭) 于 $2024-06-10$：**在**窗口内。映射到充血性心力衰竭。\n- `E11.9` (无并发症的糖尿病) 于 $2023-12-05$：**在**窗口内。映射到无并发症的糖尿病。\n- `E11.21` (有并发症的糖尿病) 于 $2024-06-20$：**在**窗口内。映射到伴有终末器官损害的糖尿病。\n- `J44.9` (慢性肺部疾病) 于 $2024-03-10$：**在**窗口内。映射到慢性肺部疾病。\n- `I73.9` (外周血管疾病) 于 $2024-05-21$：**在**窗口内。映射到外周血管疾病。\n- `C18.9` (恶性肿瘤) 于 $2023-01-20$：**在**窗口外 (过早)。\n- `G81.9` (偏瘫) 于 $2022-12-31$：**在**窗口外 (过早)。\n\n代码 `N18.5` 和 `B20` 在指标日期之后记录，将单独处理。\n\n**3. 计算确定性基线 CCI ($C_{det}$)**\n根据回溯窗口内的代码，我们对相应唯一 CCI 类别的权重求和，并应用指定规则。\n- 心肌梗死：权重 $w_{mi} = 1$。\n- 充血性心力衰竭：权重 $w_{chf} = 1$。\n- 慢性肺部疾病：权重 $w_{cpd} = 1$。\n- 外周血管疾病：权重 $w_{pvd} = 1$。\n- 糖尿病：同时存在“无并发症的糖尿病”（权重 $1$）和“伴有终末器官损害的糖尿病”（权重 $2$）。根据规则，只计算更高的权重。因此，糖尿病的贡献为 $w_{dm} = 2$。\n\n确定性基线分数 $C_{det}$ 是这些权重之和：\n$$C_{det} = w_{mi} + w_{chf} + w_{cpd} + w_{pvd} + w_{dm}$$\n$$C_{det} = 1 + 1 + 1 + 1 + 2 = 6$$\n\n**4. 计算期望 CCI**\n总期望 CCI 是确定性基线分数与指标后代码的期望贡献之和。\n指标后代码的期望贡献是其权重乘以其反映一个已存在病症的概率。\n\n- 对于 `N18.5` (中度至重度肾病)：\n  - 权重：$w_{r} = 2$。\n  - 概率：$p_{r} = 0.65$。\n  - 期望贡献：$E_{r} = w_{r} \\times p_{r} = 2 \\times 0.65 = 1.3$。\n\n- 对于 `B20` (AIDS/HIV)：\n  - 权重：$w_{h} = 6$。\n  - 概率：$p_{h} = 0.25$。\n  - 期望贡献：$E_{h} = w_{h} \\times p_{h} = 6 \\times 0.25 = 1.5$。\n\n基于独立性假设，来自指标后代码的总期望贡献 $E_{post}$ 是各个期望贡献之和。\n$$E_{post} = E_{r} + E_{h} = 1.3 + 1.5 = 2.8$$\n\n总期望 CCI, $E[CCI]$, 为：\n$$E[CCI] = C_{det} + E_{post}$$\n$$E[CCI] = 6 + 2.8 = 8.8$$\n\n问题要求答案四舍五入到四位有效数字。值 $8.8$ 表示为 $8.800$ 以满足此要求。",
            "answer": "$$\\boxed{8.800}$$"
        },
        {
            "introduction": "从原始数据中提取特征后，我们通常会得到一个庞大的“患者-特征”矩阵，这在医疗保健领域尤其常见。这个练习探讨了数据存储中的一个关键权衡：密集表示与稀疏表示。理解这种权衡对于设计能够处理现代医疗保健数据集规模的高效算法至关重要，因为在数千个可能的特征中，大多数患者只拥有其中的一小部分，这使得数据具有高度稀疏性。",
            "id": "4854028",
            "problem": "考虑一个二进制的患者-特征矩阵 $X \\in \\{0,1\\}^{n \\times p}$，其中 $n$ 是患者数量，$p$ 是特征数量。设非零项的比例（稀疏度）为 $q \\in (0,1)$，因此非零项的数量为 $k = q \\, n \\, p$。医疗数据挖掘系统中使用了两种存储方案：一种是密集的位级表示，它使用 $1$ 个比特存储 $X$ 的每个元素；另一种是稀疏的仅索引表示，其中每个非零项通过其行和列索引进行存储。后者与压缩稀疏行（CSR）和坐标列表（COO）密切相关；为本题目的，假设每个非零项都将其行索引和列索引存储在固定宽度的二进制字段中，其比特长度足以寻址 $n$ 行和 $p$ 列，即行索引需要 $\\lceil \\log_{2} n \\rceil$ 比特，列索引需要 $\\lceil \\log_{2} p \\rceil$ 比特。由于 $X$ 是二进制的，稀疏方案不存储值字段。\n\n从信息表示（为 $n$ 和 $p$ 个不同位置建立索引所需的比特长度）和算法复杂度（关于问题规模的增长阶数）的核心定义出发，完成以下任务：\n\n(a) 推导上述密集表示和稀疏仅索引表示的总内存使用量（以比特为单位），即 $S_{\\text{dense}}(n,p,q)$ 和 $S_{\\text{sparse}}(n,p,q)$。\n\n(b) 求解临界稀疏度 $q_{\\star}$，在该稀疏度下两种表示使用相等的内存。请用一个仅含 $n$ 和 $p$ 的闭式解析表达式表示 $q_{\\star}$。解释 $q$ 相对于 $q_{\\star}$ 如何决定哪种表示更节省内存。\n\n(c) 使用算法复杂度的基本定义，推断在密集和稀疏方案下，计算矩阵-向量乘积 $X \\boldsymbol{\\beta}$（其中 $\\boldsymbol{\\beta} \\in \\mathbb{R}^{p}$）的运行时阶数，并将其表示为 $n$、$p$ 和 $q$ 的函数。解释对于具有许多特征但观测稀疏的大规模医疗保健数据集，增加稀疏度（即减小 $q$）如何影响算法复杂度。第 (c) 部分不需要数值答案。\n\n你的最终答案必须是 (b) 部分中 $q_{\\star}$ 的单一闭式表达式。不需要四舍五入。",
            "solution": "我们从信息论和算法的核心原理出发。密集存储的二进制矩阵每个条目需要 $1$ 比特。对 $n$ 个可能的行进行整数索引编码所需的最少比特数是 $\\lceil \\log_{2} n \\rceil$，同样，对 $p$ 个可能的列是 $\\lceil \\log_{2} p \\rceil$。这些结论源于为有限位置集合寻址的二进制编码长度的定义。\n\n第 (a) 部分。密集表示将 $X$ 的每个条目显式地存储在内存中，每个条目使用 $1$ 比特，因此\n$$\nS_{\\text{dense}}(n,p,q) = n \\, p.\n$$\n稀疏仅索引表示只存储非零项。非零项的数量是 $k = q \\, n \\, p$。对于每个非零项，该方案使用 $b_{r} = \\lceil \\log_{2} n \\rceil$ 比特存储其行索引，使用 $b_{c} = \\lceil \\log_{2} p \\rceil$ 比特存储其列索引。因为基础矩阵是二进制的，所以不需要存储值字段。因此，总内存（以比特为单位）为\n$$\nS_{\\text{sparse}}(n,p,q) = k \\, (b_{r} + b_{c}) = q \\, n \\, p \\, \\big( \\lceil \\log_{2} n \\rceil + \\lceil \\log_{2} p \\rceil \\big).\n$$\n\n第 (b) 部分。临界稀疏度 $q_{\\star}$ 是指两种内存使用量相等时的 $q$ 值。令 $S_{\\text{dense}}(n,p,q_{\\star}) = S_{\\text{sparse}}(n,p,q_{\\star})$ 可得\n$$\nn \\, p = q_{\\star} \\, n \\, p \\, \\big( \\lceil \\log_{2} n \\rceil + \\lceil \\log_{2} p \\rceil \\big).\n$$\n假设 $n \\geq 1$ 且 $p \\geq 1$，我们可以消去 $n \\, p$ 得到\n$$\nq_{\\star} = \\frac{1}{\\lceil \\log_{2} n \\rceil + \\lceil \\log_{2} p \\rceil}.\n$$\n解释：如果 $q  q_{\\star}$，则 $S_{\\text{sparse}}(n,p,q)  S_{\\text{dense}}(n,p,q)$，因此稀疏方案的内存效率更高；如果 $q > q_{\\star}$，则密集方案使用更少的内存。该阈值单调地取决于 $\\lceil \\log_{2} n \\rceil$ 和 $\\lceil \\log_{2} p \\rceil$，随着任一维度的增长而减小，这意味着对于大型矩阵，当只存储索引时，稀疏方案需要非常小的 $q$ 值才能在内存方面具有优势。\n\n第 (c) 部分。我们通过计算与存储元素数量成比例的算术运算次数来分析计算 $X \\boldsymbol{\\beta}$ 的运行时间。对于密集表示，每个条目都对计算有贡献。一个直接的矩阵-向量乘法执行 $n \\, p$ 次乘加运算（具体来说是 $n \\, p$ 次乘法和大约 $n (p - 1)$ 次加法），其规模可表示为\n$$\nO(n \\, p).\n$$\n对于稀疏仅索引表示，只有 $k = q \\, n \\, p$ 个非零项有贡献。每个非零项对应于将该特征的贡献加到相应患者的累加和中。如果矩阵是二进制的，乘法 $X_{ij} \\beta_{j}$ 简化为包含或跳过 $\\beta_{j}$，但运算次数仍与 $k$ 成正比。因此，运行时间的规模可表示为\n$$\nO(k) = O(q \\, n \\, p).\n$$\n随着 $q$ 减小（稀疏度增加），稀疏运行时间成比例减少，而密集运行时间则保持为 $O(n \\, p)$，与 $q$ 无关。在具有非常大的 $p$ 但每个患者阳性发现相对较少的医疗保健规模数据集中，采用稀疏计算可以在内存和运行时间上都获得显著的增益，使得线性模型、逻辑回归和迭代求解器等算法能够以与临床上存在的特征数量成正比的时间运行，而不是与整个特征空间成正比。\n\n在 (b) 部分推导出的临界稀疏度的闭式表达式是所要求的最终答案。",
            "answer": "$$\\boxed{\\frac{1}{\\lceil \\log_{2} n \\rceil + \\lceil \\log_{2} p \\rceil}}$$"
        },
        {
            "introduction": "预测模型的输出通常只是一个概率值；其真正的价值在于利用这个概率来做出更优的临床决策。这个练习深入探讨了如何通过权衡不同类型错误的成本（例如，假阴性和假阳性）来选择最佳决策阈值。这是将模型转化为临床实践，并将其抽象输出与具体临床后果联系起来的基础一步，体现了以患者为中心的决策过程。",
            "id": "4853996",
            "problem": "一家医院部署了一个校准的概率分类器，用于早期检测一种二元状况。校准意味着对于任何具有特征 $X=x$ 的患者，模型得分等于后验概率 $s(x)=\\mathbb{P}(Y=1\\mid X=x)$。基于该模型的临床操作是一个单阈值决策规则：如果 $s(x)\\ge \\tau$ 则预测为阳性，否则预测为阴性。假阴性的成本为 $C_{FN}0$，假阳性的成本为 $C_{FP}0$，疾病患病率为 $\\pi=\\mathbb{P}(Y=1)\\in(0,1)$。假设正确决策没有成本，并且需要最小化的量是每位患者的期望成本。\n\n仅使用期望成本、条件风险的核心定义，以及作为阈值 $\\tau$ 函数的真阳性率 $TPR(\\tau)$ 和假阳性率 $FPR(\\tau)$ 的定义，从基本原理推导：\n\n1. 在将阈值规则应用于校准得分 $s(x)$ 的情况下，使每位患者的期望成本最小化的最优阈值 $\\tau^{*}$。\n2. 受试者工作特征 (ROC) 曲线斜率的显式表达式，定义为在由 $\\tau^{*}$ 诱导的工作点处计算的 $d\\,TPR/d\\,FPR$，用 $C_{FN}$、$C_{FP}$ 和 $\\pi$ 表示。\n\n将您的最终答案以单行矩阵 $\\begin{pmatrix}\\tau^{*}  m^{*}\\end{pmatrix}$ 的形式报告，其中 $m^{*}$ 表示在对应于 $\\tau^{*}$ 的工作点上ROC曲线的斜率。不需要进行数值代入。如果您选择提供任何数值近似，请四舍五入到四位有效数字。答案是无量纲的，应不带任何单位表示。",
            "solution": "用户提供了一个问题陈述，在尝试解答之前需要对其进行验证。\n\n### 第1步：提取已知条件\n- 使用校准的概率分类器处理二元状况 ($Y \\in \\{0, 1\\}$)。\n- 分类器得分 $s(x)$ 等于后验概率：$s(x) = \\mathbb{P}(Y=1 \\mid X=x)$。\n- 应用单阈值决策规则：如果 $s(x) \\ge \\tau$ 则预测为阳性，否则为阴性。\n- 假阴性的成本为 $C_{FN}  0$。\n- 假阳性的成本为 $C_{FP}  0$。\n- 正确决策没有成本（成本为 $0$）。\n- 疾病患病率为 $\\pi = \\mathbb{P}(Y=1)$，其中 $\\pi \\in (0, 1)$。\n- 目标是最小化每位患者的期望成本。\n- 任务是推导：\n  1. 最小化期望成本的最优阈值 $\\tau^{*}$。\n  2. 对应于 $\\tau^{*}$ 的工作点处的受试者工作特征 (ROC) 曲线斜率 $m^{*} = d\\,TPR/d\\,FPR$。\n\n### 第2步：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n- **科学依据**：该问题是贝叶斯决策理论在分类器阈值设定中的一个标准应用，这是统计模式识别和医学信息学中的一个基本概念。它在科学上是合理的。\n- **适定性**：该问题是适定的。它提供了所有必要的组成部分（成本、概率、决策规则和一个明确的目标函数——期望成本），以推导出最优阈值和相应ROC斜率的唯一解。\n- **客观性**：问题使用精确、无歧义的数学和统计语言陈述。\n\n该问题没有表现出任何已定义的缺陷（例如，科学上不合理、不完整、有歧义）。它是一个基于既定原则的、形式化的、可解的问题。\n\n### 第3步：结论与行动\n问题被判定为**有效**。将按要求从基本原理推导解决方案。\n\n### 推导过程\n\n根据问题陈述的要求，解决方案分两部分推导。\n\n**第1部分：最优阈值 $\\tau^{*}$ 的推导**\n\n最优决策规则是对于任何给定患者，使其期望成本最小化的规则。我们为具有特征 $x$（其得分为 $s(x)$）的患者，针对两种可能的行动（预测为阳性 $\\hat{y}=1$ 或预测为阴性 $\\hat{y}=0$），构建条件风险（期望成本）。\n\n设 $s(x)$ 为给定患者的得分。由于分类器经过校准，我们有 $s(x) = \\mathbb{P}(Y=1 \\mid X=x)$。因此，该患者为阴性的概率是 $\\mathbb{P}(Y=0 \\mid X=x) = 1 - s(x)$。\n\n预测为阳性的条件风险 $R(\\hat{y}=1 \\mid x)$ 是所有可能结果的成本之和，按其条件概率加权：\n$$R(\\hat{y}=1 \\mid x) = (\\text{cost if } Y=1, \\hat{y}=1) \\cdot \\mathbb{P}(Y=1 \\mid X=x) + (\\text{cost if } Y=0, \\hat{y}=1) \\cdot \\mathbb{P}(Y=0 \\mid X=x)$$\n第一项是真阳性，成本为 $0$。第二项是假阳性，成本为 $C_{FP}$。\n$$R(\\hat{y}=1 \\mid x) = 0 \\cdot s(x) + C_{FP} \\cdot (1 - s(x)) = C_{FP}(1 - s(x))$$\n\n预测为阴性的条件风险 $R(\\hat{y}=0 \\mid x)$ 的定义类似：\n$$R(\\hat{y}=0 \\mid x) = (\\text{cost if } Y=1, \\hat{y}=0) \\cdot \\mathbb{P}(Y=1 \\mid X=x) + (\\text{cost if } Y=0, \\hat{y}=0) \\cdot \\mathbb{P}(Y=0 \\mid X=x)$$\n第一项是假阴性，成本为 $C_{FN}$。第二项是真阴性，成本为 $0$。\n$$R(\\hat{y}=0 \\mid x) = C_{FN} \\cdot s(x) + 0 \\cdot (1 - s(x)) = C_{FN}s(x)$$\n\n为了最小化期望成本，对于任何给定的 $s(x)$，我们应该选择条件风险较低的行动。最优决策是当且仅当 $R(\\hat{y}=1 \\mid x) \\le R(\\hat{y}=0 \\mid x)$ 时预测为阳性 ($\\hat{y}=1$)。按惯例，相等的情况被划分为阳性类别。\n$$C_{FP}(1 - s(x)) \\le C_{FN}s(x)$$\n我们求解 $s(x)$:\n$$C_{FP} - C_{FP}s(x) \\le C_{FN}s(x)$$\n$$C_{FP} \\le (C_{FN} + C_{FP})s(x)$$\n$$s(x) \\ge \\frac{C_{FP}}{C_{FN} + C_{FP}}$$\n\n问题陈述指出，决策规则是如果 $s(x) \\ge \\tau$ 则预测为阳性。将此与我们推导出的最优规则进行比较，我们确定最优阈值 $\\tau^{*}$ 是满足此条件的值。\n$$\\tau^{*} = \\frac{C_{FP}}{C_{FN} + C_{FP}}$$\n\n**第2部分：在 $\\tau^{*}$ 处的ROC斜率 $m^{*}$ 的推导**\n\n受试者工作特征 (ROC) 曲线绘制了在不同阈值 $\\tau$ 下的真阳性率 ($TPR$) 与假阳性率 ($FPR$) 的关系。ROC曲线上某一点的斜率由 $m = d\\,TPR / d\\,FPR$ 给出。\n\n设 $f_1(s)$ 为阳性类别 ($Y=1$) 得分 $s(x)$ 的概率密度函数 (PDF)，$f_0(s)$ 为阴性类别 ($Y=0$) 得分的PDF。作为阈值 $\\tau$ 的函数，$TPR$ 和 $FPR$ 分别为：\n$$TPR(\\tau) = \\mathbb{P}(s(X) \\ge \\tau \\mid Y=1) = \\int_{\\tau}^{1} f_1(s) \\,ds$$\n$$FPR(\\tau) = \\mathbb{P}(s(X) \\ge \\tau \\mid Y=0) = \\int_{\\tau}^{1} f_0(s) \\,ds$$\n\n使用链式法则，斜率 $m(\\tau)$ 为：\n$$m(\\tau) = \\frac{d\\,TPR}{d\\,FPR} = \\frac{d\\,TPR/d\\tau}{d\\,FPR/d\\tau}$$\n应用微积分基本定理：\n$$\\frac{d\\,TPR}{d\\tau} = \\frac{d}{d\\tau} \\int_{\\tau}^{1} f_1(s) \\,ds = -f_1(\\tau)$$\n$$\\frac{d\\,FPR}{d\\tau} = \\frac{d}{d\\tau} \\int_{\\tau}^{1} f_0(s) \\,ds = -f_0(\\tau)$$\n因此，对应于阈值 $\\tau$ 的点的斜率是该得分值处的概率密度之比：\n$$m(\\tau) = \\frac{-f_1(\\tau)}{-f_0(\\tau)} = \\frac{f_1(\\tau)}{f_0(\\tau)}$$\n\n我们现在使用分类器的校准属性 $s = \\mathbb{P}(Y=1 \\mid \\text{score}=s)$，将此比率与得分值 $\\tau$ 联系起来。将贝叶斯定理应用于后验概率：\n$$\\mathbb{P}(Y=1 \\mid \\text{score}=s) = \\frac{\\mathbb{P}(\\text{score}=s \\mid Y=1) \\mathbb{P}(Y=1)}{\\mathbb{P}(\\text{score}=s)}$$\n用PDF和患病率 $\\pi$ 表示：\n$$s = \\frac{f_1(s) \\pi}{f_1(s) \\pi + f_0(s) (1-\\pi)}$$\n我们重排这个方程来求解比率 $f_1(s)/f_0(s)$:\n$$s(f_1(s) \\pi + f_0(s) (1-\\pi)) = f_1(s) \\pi$$\n$$s f_0(s) (1-\\pi) = f_1(s) \\pi - s f_1(s) \\pi = f_1(s) \\pi (1-s)$$\n$$\\frac{f_1(s)}{f_0(s)} = \\frac{s(1-\\pi)}{\\pi(1-s)}$$\n因此，由阈值 $\\tau$ 定义的工作点处的ROC曲线斜率为：\n$$m(\\tau) = \\frac{\\tau(1-\\pi)}{\\pi(1-\\tau)}$$\n\n我们需要计算在最优阈值 $\\tau^{*}$ 处的斜率。设 $m^{*} = m(\\tau^{*})$:\n$$m^{*} = \\frac{\\tau^{*}(1-\\pi)}{\\pi(1-\\tau^{*})}$$\n我们代入第1部分中 $\\tau^{*}$ 的表达式：\n$$\\tau^{*} = \\frac{C_{FP}}{C_{FN} + C_{FP}}$$\n并且也代入 $1-\\tau^{*}$ 的表达式：\n$$1 - \\tau^{*} = 1 - \\frac{C_{FP}}{C_{FN} + C_{FP}} = \\frac{C_{FN} + C_{FP} - C_{FP}}{C_{FN} + C_{FP}} = \\frac{C_{FN}}{C_{FN} + C_{FP}}$$\n现在，将这些代入 $m^{*}$ 的方程中：\n$$m^{*} = \\frac{\\left( \\frac{C_{FP}}{C_{FN} + C_{FP}} \\right) (1-\\pi)}{\\pi \\left( \\frac{C_{FN}}{C_{FN} + C_{FP}} \\right)}$$\n分子和分母中的项 $(C_{FN} + C_{FP})$相互抵消，得到：\n$$m^{*} = \\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi}$$\n这就是在最优工作点处ROC曲线斜率的所需表达式。\n\n最终答案是数对 $(\\tau^{*}, m^{*})$。",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{C_{FP}}{C_{FN} + C_{FP}}  \\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi} \\end{pmatrix}}$$"
        }
    ]
}