{
    "hands_on_practices": [
        {
            "introduction": "为了让计算机模型能够理解和预测文本中的实体边界，我们需要一种系统性的方法来标记每个单词（或“词元”）。BILOU 方案是一种常用且精确的词元级别标注方法，它不仅能识别实体，还能明确实体在文本中的起始、内部、结束或独立位置。通过这个练习，你将亲手将一段带有实体标注的临床文本转换为 BILOU 标签序列，这是训练序列标注模型不可或缺的数据预处理步骤。",
            "id": "4849564",
            "problem": "在临床自然语言处理中，命名实体识别 (NER) 用于识别指代临床上有意义概念（如问题、检查和药物）的文本跨度。一种广泛用于跨度级别标注的方案是“开始”(Begin)、“内部”(Inside)、“最后”(Last)、“外部”(Outside)、“单元长度”(Unit-length) (BILOU) 方案。该方案根据每个词元在实体中的位置为其分配一个类别字母：B (Begin) 代表多词元实体的起始词元，I (Inside) 代表多词元实体的任意内部词元，L (Last) 代表多词元实体的末尾词元，O (Outside) 代表不属于任何实体的词元，U (Unit-length) 代表单次词元实体。在本问题中，您将对一个带有文本级别实体跨度标注的、已词元化的临床笔记片段应用 BILOU 方案，然后计算所得类别序列的数值函数摘要。\n \n使用以下基本规则：\n- 词元是通过按空白字符分割文本，并将句号等标点符号视为单独的词元来生成的。\n- 花括号内的标注是元标记，不属于词元流；它们用于界定实体跨度及其类型。花括号内的文本以实体类型名称开头，后跟一个空格，然后是确切的跨度词元。例如，“{Problem chest pain}” 标记了一个“Problem”类型的实体，该实体跨越了“chest pain”这两个词元。\n- BILOU 方案在词元级别上分配类别字母，这取决于每个跨度的确切词元边界。实体类型仅用于确定跨度归属并确保正确的 BILOU 位置标注；在下文的数值计算中，您将只使用类别字母，而忽略实体类型。\n\n考虑以下来自临床笔记的片段（带有标注）：\n`Pt reports {Problem chest pain}. Started {Medication aspirin} {Dose 81 mg} daily. {Test ECG} normal. {Test CT chest} negative for {Problem PE}. Discharged home.`\n\n片段中使用的缩写词包括心电图 (Electrocardiogram, ECG)、计算机断层扫描 (Computed Tomography, CT) 和肺栓塞 (Pulmonary Embolism, PE)。\n\n任务：\n1. 按照规定对片段进行词元化，并应用 BILOU 方案，生成每个词元的类别字母 $c_{1}, c_{2}, \\dots, c_{N} \\in \\{\\text{B}, \\text{I}, \\text{L}, \\text{O}, \\text{U}\\}$，其中 $N$ 是词元的数量。\n2. 定义类别字母的权重函数 $w$ 为 $w(\\text{B})=2$, $w(\\text{I})=3$, $w(\\text{L})=5$, $w(\\text{O})=0$，以及 $w(\\text{U})=7$。\n3. 计算标量\n$$\nS \\;=\\; \\sum_{i=1}^{N} i \\cdot w(c_{i}).\n$$\n\n将 $S$ 的值报告为一个不带单位的整数。无需四舍五入。在推导 $c_{1},\\dots,c_{N}$ 时，请清楚地展示单次词元实体在 BILOU 方案下是如何表示的。",
            "solution": "问题陈述经验证是合理且定义明确的。它在计算语言学和医学信息学领域内，特别是在命名实体识别（NER）方面，提出了一个清晰的、程序化的任务。所有术语都已定义，给定的数据是一致的，并且所需的计算是明确的。该问题具有科学依据，是可形式化和可验证的。\n\n解题过程分为三步：临床笔记的词元化、应用 BILOU 标注方案以及计算加权和 $S$。\n\n### 步骤 1：词元化\n\n输入片段为：\n`Pt reports {Problem chest pain}. Started {Medication aspirin} {Dose 81 mg} daily. {Test ECG} normal. {Test CT chest} negative for {Problem PE}. Discharged home.`\n\n排除标注的元标记后，文本内容为：\n`Pt reports chest pain. Started aspirin 81 mg daily. ECG normal. CT chest negative for PE. Discharged home.`\n\n根据指定规则，此文本通过按空白字符分割，并将标点符号（此处为句号）视为单独的词元来进行词元化。此过程产生一个包含 $N=23$ 个词元的序列。以 1 为起始索引的词元列表 $t_i$ 如下：\n\n- $t_1$: `Pt`\n- $t_2$: `reports`\n- $t_3$: `chest`\n- $t_4$: `pain`\n- $t_5$: `.`\n- $t_6$: `Started`\n- $t_7$: `aspirin`\n- $t_8$: `81`\n- $t_9$: `mg`\n- $t_{10}$: `daily`\n- $t_{11}$: `.`\n- $t_{12}$: `ECG`\n- $t_{13}$: `normal`\n- $t_{14}$: `.`\n- $t_{15}$: `CT`\n- $t_{16}$: `chest`\n- $t_{17}$: `negative`\n- $t_{18}$: `for`\n- $t_{19}$: `PE`\n- $t_{20}$: `.`\n- $t_{21}$: `Discharged`\n- $t_{22}$: `home`\n- $t_{23}$: `.`\n\n### 步骤 2：BILOU 标注\n\nBILOU 标注方案为每个词元 $t_i$ 分配一个类别字母 $c_i \\in \\{\\text{B}, \\text{I}, \\text{L}, \\text{O}, \\text{U}\\}$。该标签取决于词元在已标注实体跨度中的位置。\n- **B**：多词元实体的起始词元。\n- **I**：多词元实体的内部词元。\n- **L**：多词元实体的末尾词元。\n- **O**：不属于任何实体。\n- **U**：单元长度（单次词元）实体。\n\n已标注的实体跨度及其对应的词元索引为：\n- `{Problem chest pain}`：跨越词元 $t_3$ (`chest`) 和 $t_4$ (`pain`)。\n- `{Medication aspirin}`：跨越词元 $t_7$ (`aspirin`)。\n- `{Dose 81 mg}`：跨越词元 $t_8$ (`81`) 和 $t_9$ (`mg`)。\n- `{Test ECG}`：跨越词元 $t_{12}$ (`ECG`)。\n- `{Test CT chest}`：跨越词元 $t_{15}$ (`CT`) 和 $t_{16}$ (`chest`)。\n- `{Problem PE}`：跨越词元 $t_{19}$ (`PE`)。\n\n对此词元序列应用 BILOU 规则：\n- 对于 `{Problem chest pain}` ($t_3, t_4$)：$t_3$ 是起始词元，因此其类别为 $c_3 = \\text{B}$。$t_4$ 是末尾词元，因此其类别为 $c_4 = \\text{L}$。\n- 对于 `{Medication aspirin}` ($t_7$)：这是一个单次词元实体。按照规定，其类别为 $c_7 = \\text{U}$。\n- 对于 `{Dose 81 mg}` ($t_8, t_9$)：$t_8$ 是起始词元，所以 $c_8 = \\text{B}$。$t_9$ 是末尾词元，所以 $c_9 = \\text{L}$。\n- 对于 `{Test ECG}` ($t_{12}$)：这是一个单次词元实体，所以其类别为 $c_{12} = \\text{U}$。\n- 对于 `{Test CT chest}` ($t_{15}, t_{16}$)：$t_{15}$ 是起始词元，所以 $c_{15} = \\text{B}$。$t_{16}$ 是末尾词元，所以 $c_{16} = \\text{L}$。\n- 对于 `{Problem PE}` ($t_{19}$)：这是一个单次词元实体，所以其类别为 $c_{19} = \\text{U}$。\n- 所有其他词元均不属于任何已标注实体。因此，它们的类别为 $\\text{O}$。\n\n### 步骤 3：计算 S\n\n标量 $S$ 定义为 $S = \\sum_{i=1}^{N} i \\cdot w(c_i)$，其中权重由 $w(\\text{B})=2$, $w(\\text{I})=3$, $w(\\text{L})=5$, $w(\\text{O})=0$, 和 $w(\\text{U})=7$ 给出。由于 $w(\\text{O})=0$，类别为 $\\text{O}$ 的词元对总和没有贡献。我们只需对类别为 $\\text{B}$、$\\text{L}$ 或 $\\text{U}$ 的词元项求和。\n\n下表总结了对总和的非零贡献：\n| 索引 $i$ | 词元 $t_i$ | 类别 $c_i$ | 权重 $w(c_i)$ | 项 $i \\cdot w(c_i)$ |\n|:---:|:---|:---:|:---:|:---:|\n| $3$ | `chest` | $\\text{B}$ | $2$ | $3 \\times 2 = 6$ |\n| $4$ | `pain` | $\\text{L}$ | $5$ | $4 \\times 5 = 20$ |\n| $7$ | `aspirin` | $\\text{U}$ | $7$ | $7 \\times 7 = 49$ |\n| $8$ | `81` | $\\text{B}$ | $2$ | $8 \\times 2 = 16$ |\n| $9$ | `mg` | $\\text{L}$ | $5$ | $9 \\times 5 = 45$ |\n| $12$ | `ECG` | $\\text{U}$ | $7$ | $12 \\times 7 = 84$ |\n| $15$ | `CT` | $\\text{B}$ | $2$ | $15 \\times 2 = 30$ |\n| $16$ | `chest` | $\\text{L}$ | $5$ | $16 \\times 5 = 80$ |\n| $19$ | `PE` | $\\text{U}$ | $7$ | $19 \\times 7 = 133$ |\n\n总和 $S$ 是最后一列值的总和。\n$$\nS = (3 \\cdot w(\\text{B})) + (4 \\cdot w(\\text{L})) + (7 \\cdot w(\\text{U})) + (8 \\cdot w(\\text{B})) + (9 \\cdot w(\\text{L})) + (12 \\cdot w(\\text{U})) + (15 \\cdot w(\\text{B})) + (16 \\cdot w(\\text{L})) + (19 \\cdot w(\\text{U}))\n$$\n$$\nS = (3 \\cdot 2) + (4 \\cdot 5) + (7 \\cdot 7) + (8 \\cdot 2) + (9 \\cdot 5) + (12 \\cdot 7) + (15 \\cdot 2) + (16 \\cdot 5) + (19 \\cdot 7)\n$$\n$$\nS = 6 + 20 + 49 + 16 + 45 + 84 + 30 + 80 + 133\n$$\n将这些项相加：\n$$\nS = 26 + 49 + 16 + 45 + 84 + 30 + 80 + 133\n$$\n$$\nS = 75 + 16 + 45 + 84 + 30 + 80 + 133\n$$\n$$\nS = 91 + 45 + 84 + 30 + 80 + 133\n$$\n$$\nS = 136 + 84 + 30 + 80 + 133\n$$\n$$\nS = 220 + 30 + 80 + 133\n$$\n$$\nS = 250 + 80 + 133\n$$\n$$\nS = 330 + 133\n$$\n$$\nS = 463\n$$\n标量 $S$ 的值为 $463$。",
            "answer": "$$\n\\boxed{463}\n$$"
        },
        {
            "introduction": "在我们我们将文本转换为标签序列后，下一步就是使用模型来预测这些标签。条件随机场（Conditional Random Fields, CRF）是命名实体识别任务中一种强大且经典的序列模型。这个练习将带你深入 CRF 模型的核心，使用 Viterbi 算法，在一个简化的场景中，手动推导出最可能的标签序列。通过计算，你将直观地理解模型是如何结合词元自身特征（一元势）和标签之间的转换规则（转移势）来做出最优决策的。",
            "id": "4849527",
            "problem": "一个用于药物提取的临床命名实体识别（NER）模型被应用于临床记录中的句子：“Take metformin 500 mg”。标签集为 $\\{O, \\text{DRUG}, \\text{DOSE}\\}$，其中 $O$ 表示在任何实体之外，$DRUG$ 表示药物提及，$DOSE$ 表示剂量表述。考虑一个具有以下结构的线性链条件随机场（CRF）：一个指定的初始状态 $\\text{START}$，针对词元位置 $t$ 和标签 $y$ 的位置特定的一元对数势 $u_t(y)$，以及从标签 $y'$ 到标签 $y$ 的成对转移对数势 $a(y', y)$。该句子有 $T = 4$ 个词元，索引为 $t = 1,2,3,4$，分别对应 $x_1 = \\text{\"Take\"}$、$x_2 = \\text{\"metformin\"}$、$x_3 = \\text{\"500\"}$ 和 $x_4 = \\text{\"mg\"}$。\n\n初始转移对数势为：\n- $a(\\text{START}, O) = 1$，$a(\\text{START}, DRUG) = 0$，$a(\\text{START}, DOSE) = -2$。\n\n对于 $y', y \\in \\{O, \\text{DRUG}, \\text{DOSE}\\}$ 的转移对数势 $a(y', y)$ 为：\n- $a(O, O) = 1$，$a(O, DRUG) = 1$，$a(O, DOSE) = -1$。\n- $a(DRUG, O) = -1$，$a(DRUG, DRUG) = 1$，$a(DRUG, DOSE) = 2$。\n- $a(DOSE, O) = 0$，$a(DOSE, DRUG) = -2$，$a(DOSE, DOSE) = 2$。\n\n一元对数势 $u_t(y)$ 为：\n- 在 $t = 1$ ($x_1 = \\text{\"Take\"}$) 时：$u_1(O) = 2$，$u_1(DRUG) = -1$，$u_1(DOSE) = -3$。\n- 在 $t = 2$ ($x_2 = \\text{\"metformin\"}$) 时：$u_2(DRUG) = 3$，$u_2(O) = 0$，$u_2(DOSE) = -2$。\n- 在 $t = 3$ ($x_3 = \\text{\"500\"}$) 时：$u_3(DOSE) = 4$，$u_3(O) = -1$，$u_3(DRUG) = -2$。\n- 在 $t = 4$ ($x_4 = \\text{\"mg\"}$) 时：$u_4(DOSE) = 3$，$u_4(O) = 0$，$u_4(DRUG) = -2$。\n\n使用线性链模型的最优子结构原理和 Viterbi 算法，确定在给定对数势下此句子的最可能标签序列。然后，计算该最优序列的总对数线性分数 $S^{\\star}$，其定义为初始转移对数势、沿序列选择的成对转移对数势以及每个位置选择的一元对数势之和。以实数形式报告 $S^{\\star}$。无需四舍五入。最终答案不带单位表示。",
            "solution": "### 步骤 1：提取已知信息\n题目为线性链条件随机场（CRF）模型提供了以下信息：\n- **标签集**：$Y = \\{O, \\text{DRUG}, \\text{DOSE}\\}$\n- **句子词元**：$x_1 = \\text{\"Take\"}$，$x_2 = \\text{\"metformin\"}$，$x_3 = \\text{\"500\"}$，$x_4 = \\text{\"mg\"}$，长度 $T=4$。\n- **初始转移对数势** $a(\\text{START}, y)$:\n  - $a(\\text{START}, O) = 1$\n  - $a(\\text{START}, DRUG) = 0$\n  - $a(\\text{START}, DOSE) = -2$\n- **成对转移对数势** $a(y', y)$:\n  - $a(O, O) = 1$, $a(O, DRUG) = 1$, $a(O, DOSE) = -1$\n  - $a(DRUG, O) = -1$, $a(DRUG, DRUG) = 1$, $a(DRUG, DOSE) = 2$\n  - $a(DOSE, O) = 0$, $a(DOSE, DRUG) = -2$, $a(DOSE, DOSE) = 2$\n- **一元对数势** $u_t(y)$:\n  - $t = 1$：$u_1(O) = 2$, $u_1(DRUG) = -1$, $u_1(DOSE) = -3$\n  - $t = 2$：$u_2(O) = 0$, $u_2(DRUG) = 3$, $u_2(DOSE) = -2$\n  - $t = 3$：$u_3(O) = -1$, $u_3(DRUG) = -2$, $u_3(DOSE) = 4$\n  - $t = 4$：$u_4(O) = 0$, $u_4(DRUG) = -2$, $u_4(DOSE) = 3$\n- **任务**：使用 Viterbi 算法确定最可能的标签序列，并计算其总对数线性分数 $S^{\\star}$。\n\n### 步骤 2：使用提取的已知信息进行验证\n该问题具有科学依据，定义明确且客观。\n- **科学依据**：它描述了线性链条件随机场（CRF）的一个标准应用，CRF 是一种在自然语言处理中广泛用于序列标注的模型。Viterbi 算法是在此类模型中进行推断的正确动态规划方法。所提供的对数势和结构与 CRF 的原理一致。\n- **定义明确性**：所有必要的参数（对数势）和数据（句子）都已提供。任务被明确定义：找到使总对数线性分数最大化的标签序列。这种设置保证了唯一且可计算的解。\n- **客观性**：问题以精确的数值和形式化定义陈述，没有主观解释的余地。\n\n### 步骤 3：结论与行动\n问题有效。求解过程将通过应用 Viterbi 算法进行。\n\n### 求解推导\nViterbi 算法寻找由一系列观测事件产生的最可能的隐藏状态（标签）序列。对于线性链 CRF，标签序列 $y = (y_1, y_2, \\dots, y_T)$ 的分数定义为：\n$$ S(y) = a(\\text{START}, y_1) + \\sum_{t=1}^{T} u_t(y_t) + \\sum_{t=2}^{T} a(y_{t-1}, y_t) $$\n我们使用动态规划方法来找到使该分数最大化的序列 $y^\\star$。设 $v_t(y)$ 是在位置 $t$ 结束且标签为 $y$ 的序列的最大分数，设 $b_t(y)$ 是存储导致该最大分数的上一个标签的回溯指针。\n\n递推关系式为：\n1.  **初始化** (对于 $t=1$):\n    $$ v_1(y) = a(\\text{START}, y) + u_1(y) $$\n2.  **递推** (对于 $t=2, \\dots, T$):\n    $$ v_t(y) = \\max_{y' \\in Y} \\left( v_{t-1}(y') + a(y', y) \\right) + u_t(y) $$\n    $$ b_t(y) = \\arg\\max_{y' \\in Y} \\left( v_{t-1}(y') + a(y', y) \\right) $$\n\n让我们将这些步骤应用于给定的问题。\n\n**步骤 1：初始化 ($t = 1$, 词元 \"Take\")**\n我们为每个标签 $y \\in \\{O, \\text{DRUG}, \\text{DOSE}\\}$ 计算 $v_1(y)$。\n- $v_1(O) = a(\\text{START}, O) + u_1(O) = 1 + 2 = 3$\n- $v_1(DRUG) = a(\\text{START}, DRUG) + u_1(DRUG) = 0 + (-1) = -1$\n- $v_1(DOSE) = a(\\text{START}, DOSE) + u_1(DOSE) = -2 + (-3) = -5$\n\n在 $t=1$ 时的分数为：$v_1(O) = 3$, $v_1(DRUG) = -1$, $v_1(DOSE) = -5$。\n\n**步骤 2：递推 ($t = 2$, 词元 \"metformin\")**\n我们为每个标签 $y$ 计算 $v_2(y)$。\n- 对于 $y = O$:\n  - $v_1(O) + a(O, O) = 3 + 1 = 4$\n  - $v_1(DRUG) + a(DRUG, O) = -1 + (-1) = -2$\n  - $v_1(DOSE) + a(DOSE, O) = -5 + 0 = -5$\n  - $\\max = 4$ (来自 $y'=O$)。$b_2(O) = O$。\n  - $v_2(O) = 4 + u_2(O) = 4 + 0 = 4$。\n- 对于 $y = DRUG$:\n  - $v_1(O) + a(O, DRUG) = 3 + 1 = 4$\n  - $v_1(DRUG) + a(DRUG, DRUG) = -1 + 1 = 0$\n  - $v_1(DOSE) + a(DOSE, DRUG) = -5 + (-2) = -7$\n  - $\\max = 4$ (来自 $y'=O$)。$b_2(DRUG) = O$。\n  - $v_2(DRUG) = 4 + u_2(DRUG) = 4 + 3 = 7$。\n- 对于 $y = DOSE$:\n  - $v_1(O) + a(O, DOSE) = 3 + (-1) = 2$\n  - $v_1(DRUG) + a(DRUG, DOSE) = -1 + 2 = 1$\n  - $v_1(DOSE) + a(DOSE, DOSE) = -5 + 2 = -3$\n  - $\\max = 2$ (来自 $y'=O$)。$b_2(DOSE) = O$。\n  - $v_2(DOSE) = 2 + u_2(DOSE) = 2 + (-2) = 0$。\n\n在 $t=2$ 时的分数为：$v_2(O)=4$, $v_2(DRUG)=7$, $v_2(DOSE)=0$。\n在 $t=2$ 时的回溯指针为：$b_2(O)=O$, $b_2(DRUG)=O$, $b_2(DOSE)=O$。\n\n**步骤 3：递推 ($t = 3$, 词元 \"500\")**\n我们为每个标签 $y$ 计算 $v_3(y)$。\n- 对于 $y = O$:\n  - $v_2(O) + a(O, O) = 4 + 1 = 5$\n  - $v_2(DRUG) + a(DRUG, O) = 7 + (-1) = 6$\n  - $v_2(DOSE) + a(DOSE, O) = 0 + 0 = 0$\n  - $\\max = 6$ (来自 $y'=DRUG$)。$b_3(O) = DRUG$。\n  - $v_3(O) = 6 + u_3(O) = 6 + (-1) = 5$。\n- 对于 $y = DRUG$:\n  - $v_2(O) + a(O, DRUG) = 4 + 1 = 5$\n  - $v_2(DRUG) + a(DRUG, DRUG) = 7 + 1 = 8$\n  - $v_2(DOSE) + a(DOSE, DRUG) = 0 + (-2) = -2$\n  - $\\max = 8$ (来自 $y'=DRUG$)。$b_3(DRUG) = DRUG$。\n  - $v_3(DRUG) = 8 + u_3(DRUG) = 8 + (-2) = 6$。\n- 对于 $y = DOSE$:\n  - $v_2(O) + a(O, DOSE) = 4 + (-1) = 3$\n  - $v_2(DRUG) + a(DRUG, DOSE) = 7 + 2 = 9$\n  - $v_2(DOSE) + a(DOSE, DOSE) = 0 + 2 = 2$\n  - $\\max = 9$ (来自 $y'=DRUG$)。$b_3(DOSE) = DRUG$。\n  - $v_3(DOSE) = 9 + u_3(DOSE) = 9 + 4 = 13$。\n\n在 $t=3$ 时的分数为：$v_3(O)=5$, $v_3(DRUG)=6$, $v_3(DOSE)=13$。\n在 $t=3$ 时的回溯指针为：$b_3(O)=DRUG$, $b_3(DRUG)=DRUG$, $b_3(DOSE)=DRUG$。\n\n**步骤 4：递推 ($t = 4$, 词元 \"mg\")**\n我们为每个标签 $y$ 计算 $v_4(y)$。\n- 对于 $y = O$:\n  - $v_3(O) + a(O, O) = 5 + 1 = 6$\n  - $v_3(DRUG) + a(DRUG, O) = 6 + (-1) = 5$\n  - $v_3(DOSE) + a(DOSE, O) = 13 + 0 = 13$\n  - $\\max = 13$ (来自 $y'=DOSE$)。$b_4(O) = DOSE$。\n  - $v_4(O) = 13 + u_4(O) = 13 + 0 = 13$。\n- 对于 $y = DRUG$:\n  - $v_3(O) + a(O, DRUG) = 5 + 1 = 6$\n  - $v_3(DRUG) + a(DRUG, DRUG) = 6 + 1 = 7$\n  - $v_3(DOSE) + a(DOSE, DRUG) = 13 + (-2) = 11$\n  - $\\max = 11$ (来自 $y'=DOSE$)。$b_4(DRUG) = DOSE$。\n  - $v_4(DRUG) = 11 + u_4(DRUG) = 11 + (-2) = 9$。\n- 对于 $y = DOSE$:\n  - $v_3(O) + a(O, DOSE) = 5 + (-1) = 4$\n  - $v_3(DRUG) + a(DRUG, DOSE) = 6 + 2 = 8$\n  - $v_3(DOSE) + a(DOSE, DOSE) = 13 + 2 = 15$\n  - $\\max = 15$ (来自 $y'=DOSE$)。$b_4(DOSE) = DOSE$。\n  - $v_4(DOSE) = 15 + u_4(DOSE) = 15 + 3 = 18$。\n\n在 $t=4$ 时的分数为：$v_4(O)=13$, $v_4(DRUG)=9$, $v_4(DOSE)=18$。\n在 $t=4$ 时的回溯指针为：$b_4(O)=DOSE$, $b_4(DRUG)=DOSE$, $b_4(DOSE)=DOSE$。\n\n**步骤 5：终止与回溯**\n最优序列的总分数 $S^{\\star}$ 是 Viterbi 分数最后一列中的最大值：\n$$ S^{\\star} = \\max_{y \\in Y} v_4(y) = \\max(13, 9, 18) = 18 $$\n最优序列的最后一个标签是产生此最大分数的标签：\n$$ y_4^{\\star} = \\arg\\max_{y \\in Y} v_4(y) = \\text{DOSE} $$\n现在我们进行回溯以找到序列的其余部分：\n- $y_3^{\\star} = b_4(y_4^{\\star}) = b_4(\\text{DOSE}) = \\text{DOSE}$\n- $y_2^{\\star} = b_3(y_3^{\\star}) = b_3(\\text{DOSE}) = \\text{DRUG}$\n- $y_1^{\\star} = b_2(y_2^{\\star}) = b_2(\\text{DRUG}) = O$\n\n最可能的标签序列是 $y^{\\star} = (O, \\text{DRUG}, \\text{DOSE}, \\text{DOSE})$。\n\n**总分数验证**\n让我们手动计算序列 $y^{\\star} = (O, \\text{DRUG}, \\text{DOSE}, \\text{DOSE})$ 的分数以验证结果。\n$S^{\\star} = a(\\text{START}, y_1^\\star) + u_1(y_1^\\star) + a(y_1^\\star, y_2^\\star) + u_2(y_2^\\star) + a(y_2^\\star, y_3^\\star) + u_3(y_3^\\star) + a(y_3^\\star, y_4^\\star) + u_4(y_4^\\star)$\n$S^{\\star} = a(\\text{START}, O) + u_1(O) + a(O, \\text{DRUG}) + u_2(\\text{DRUG}) + a(\\text{DRUG}, \\text{DOSE}) + u_3(\\text{DOSE}) + a(\\text{DOSE}, \\text{DOSE}) + u_4(\\text{DOSE})$\n$S^{\\star} = 1 + 2 + 1 + 3 + 2 + 4 + 2 + 3$\n$S^{\\star} = 3 + 4 + 6 + 5 = 18$\n计算出的分数与通过 Viterbi 算法得到的分数相匹配。最优序列的总对数线性分数为 $18$。",
            "answer": "$$\\boxed{18}$$"
        },
        {
            "introduction": "模型做出预测后，我们如何客观地评价其表现优劣？在命名实体识别中，一个预测的实体边界与标准答案稍有偏差，应该算完全错误还是部分正确？这个练习将探讨两种核心的评估标准——严格匹配和宽松匹配，并要求你计算相应的 $F1$ 分数。通过对比这两种标准下的得分，你将深刻理解评估指标的选择如何影响我们对模型性能的判断，尤其是在处理边界检测这类细微但关键的任务时。",
            "id": "4849523",
            "problem": "一份临床记录已被分词为带索引的词符。提供了一组由人工标注的、包含类型和词符范围的实体作为金标准，以及一个模型预测的实体。考虑命名实体识别（NER）的两种评估机制：严格匹配和宽松匹配。使用以下基于科学的定义作为您推导的基础：真正例（TP）指的是在评估机制的匹配规则下，一个预测实体与一个金标准实体正确匹配；假正例（FP）指的是一个预测实体在该机制的规则下不与任何金标准实体匹配；假反例（FN）指的是一个金标准实体在该机制的规则下没有任何匹配的预测实体。精确率 $P$ 定义为 $P=\\frac{\\text{TP}}{\\text{TP}+\\text{FP}}$，召回率 $R$ 定义为 $R=\\frac{\\text{TP}}{\\text{TP}+\\text{FN}}$，而 $F1$ 分数定义为调和平均数 $F1=\\frac{2PR}{P+R}$。\n\n匹配定义如下。在严格匹配下，一个预测实体被认为是一个匹配，当且仅当其类型与金标准实体的类型完全相等，且其词符范围与金标准实体的范围完全相同。在宽松匹配下，一个预测实体被认为是一个匹配，当且仅当其类型与金标准实体的类型相等，且其词符范围与金标准实体的范围至少有一个词符的重叠；应用一对一约束，使得每个金标准实体最多只能与一个预测实体匹配，每个预测实体最多也只能与一个金标准实体匹配。当存在多个重叠的候选匹配时，假设评估会选择能够最大化真正例数量的匹配。\n\n金标准实体是：\n- $G_1$: 类型 $\\text{Problem}$，范围 $[5,7]$。\n- $G_2$: 类型 $\\text{Test}$，范围 $[10,11]$。\n- $G_3$: 类型 $\\text{Treatment}$，范围 $[15,15]$。\n- $G_4$: 类型 $\\text{Problem}$，范围 $[20,21]$。\n- $G_5$: 类型 $\\text{Test}$，范围 $[25,27]$。\n- $G_6$: 类型 $\\text{Treatment}$，范围 $[30,32]$。\n\n预测的实体是：\n- $P_1$: 类型 $\\text{Problem}$，范围 $[5,7]$。\n- $P_2$: 类型 $\\text{Test}$，范围 $[10,12]$。\n- $P_3$: 类型 $\\text{Treatment}$，范围 $[14,15]$。\n- $P_4$: 类型 $\\text{Problem}$，范围 $[20,22]$。\n- $P_5$: 类型 $\\text{Test}$，范围 $[25,26]$。\n- $P_6$: 类型 $\\text{Treatment}$，范围 $[31,32]$。\n- $P_7$: 类型 $\\text{Problem}$，范围 $[2,3]$。\n- $P_8$: 类型 $\\text{Test}$，范围 $[40,41]$。\n- $P_9$: 类型 $\\text{Problem}$，范围 $[25,27]$。\n\n使用所提供的定义和匹配规则，从基本原理出发，计算严格匹配的 $F1$ 分数和宽松匹配的 $F1$ 分数。然后计算差值 $\\Delta = F1_{\\text{relaxed}} - F1_{\\text{strict}}$。将您最终的 $\\Delta$ 答案表示为最简分数。无需四舍五入。此外，在您的解题过程中，请解释严格匹配和宽松匹配 $F1$ 分数之间出现差异的主要原因，并结合临床 NER 中的边界检测和类型一致性进行说明。",
            "solution": "所陈述的问题具有科学依据、提法明确且客观。它提供了一套完整且一致的定义、数据和约束条件，这些都是计算指定的命名实体识别（NER）指标所必需的。严格匹配和宽松匹配的规则定义清晰，包括宽松情况下的优化标准，确保可以确定唯一的解决方案。因此，该问题是有效的，我们可以继续进行求解。\n\n该问题要求在两种不同的评估机制下计算 $F1$ 分数：严格匹配和宽松匹配。我们已知有 $N_G = 6$ 个金标准实体和 $N_P = 9$ 个预测实体。我们将首先计算严格机制下的分数，然后计算宽松机制下的分数，最后计算它们的差值。\n\n基本量是真正例（$TP$）、假正例（$FP$）和假反例（$FN$）。根据这些，我们计算精确率（$P$）和召回率（$R$）：\n$$P = \\frac{TP}{TP+FP}$$\n$$R = \\frac{TP}{TP+FN}$$\n$F1$ 分数是精确率和召回率的调和平均数：\n$$F1 = \\frac{2PR}{P+R} = \\frac{2 \\cdot \\frac{TP}{TP+FP} \\cdot \\frac{TP}{TP+FN}}{\\frac{TP}{TP+FP} + \\frac{TP}{TP+FN}} = \\frac{2(TP)^2}{TP(TP+FN) + TP(TP+FP)} = \\frac{2TP}{2TP+FP+FN}$$\n\n首先，我们分析在**严格匹配**机制下的性能，该机制要求实体类型和词符范围完全相同才算匹配。\n\n我们将每个预测实体（$P_i$）与金标准实体集（$G_j$）进行比较：\n- $P_1$（类型 $\\text{Problem}$，范围 $[5,7]$）是 $G_1$（类型 $\\text{Problem}$，范围 $[5,7]$）的一个精确匹配。这是一个真正例。\n- $P_2$（类型 $\\text{Test}$，范围 $[10,12]$）的类型与 $G_2$（类型 $\\text{Test}$，范围 $[10,11]$）相同，但范围不同。不是严格匹配。\n- $P_3$（类型 $\\text{Treatment}$，范围 $[14,15]$）的类型与 $G_3$（类型 $\\text{Treatment}$，范围 $[15,15]$）相同，但范围不同。不是严格匹配。\n- $P_4$（类型 $\\text{Problem}$，范围 $[20,22]$）的类型与 $G_4$（类型 $\\text{Problem}$，范围 $[20,21]$）相同，但范围不同。不是严格匹配。\n- $P_5$（类型 $\\text{Test}$，范围 $[25,26]$）的类型与 $G_5$（类型 $\\text{Test}$，范围 $[25,27]$）相同，但范围不同。不是严格匹配。\n- $P_6$（类型 $\\text{Treatment}$，范围 $[31,32]$）的类型与 $G_6$（类型 $\\text{Treatment}$，范围 $[30,32]$）相同，但范围不同。不是严格匹配。\n- $P_7$（类型 $\\text{Problem}$，范围 $[2,3]$）不对应任何金标准实体。不是匹配。\n- $P_8$（类型 $\\text{Test}$，范围 $[40,41]$）不对应任何金标准实体。不是匹配。\n- $P_9$（类型 $\\text{Problem}$，范围 $[25,27]$）的范围与 $G_5$（类型 $\\text{Test}$，范围 $[25,27]$）相同，但类型不同（$\\text{Problem}$ vs. $\\text{Test}$）。不是严格匹配。\n\n基于此严格匹配分析：\n- 真正例的数量是 $TP_{\\text{strict}} = 1$（来自 $P_1$ 和 $G_1$ 之间的匹配）。\n- 预测的总数是 $N_P = 9$。假正例的数量是未成为真正例的预测实体的计数：$FP_{\\text{strict}} = N_P - TP_{\\text{strict}} = 9 - 1 = 8$。\n- 金标准实体的总数是 $N_G = 6$。假反例的数量是未被匹配的金标准实体的计数：$FN_{\\text{strict}} = N_G - TP_{\\text{strict}} = 6 - 1 = 5$。\n\n现在我们可以计算严格匹配的精确率、召回率和 $F1$ 分数：\n$P_{\\text{strict}} = \\frac{TP_{\\text{strict}}}{TP_{\\text{strict}} + FP_{\\text{strict}}} = \\frac{1}{1+8} = \\frac{1}{9}$\n$R_{\\text{strict}} = \\frac{TP_{\\text{strict}}}{TP_{\\text{strict}} + FN_{\\text{strict}}} = \\frac{1}{1+5} = \\frac{1}{6}$\n$F1_{\\text{strict}} = \\frac{2 P_{\\text{strict}} R_{\\text{strict}}}{P_{\\text{strict}} + R_{\\text{strict}}} = \\frac{2 \\cdot \\frac{1}{9} \\cdot \\frac{1}{6}}{\\frac{1}{9} + \\frac{1}{6}} = \\frac{\\frac{2}{54}}{\\frac{2+3}{18}} = \\frac{\\frac{1}{27}}{\\frac{5}{18}} = \\frac{1}{27} \\cdot \\frac{18}{5} = \\frac{2}{15}$\n\n接下来，我们分析在**宽松匹配**机制下的性能。如果实体类型相同且它们的范围至少有一个词符重叠，则发生匹配。匹配是一对一的，并选择最大化TP数量的方式进行。\n\n我们根据类型一致性和范围重叠来识别所有潜在的匹配。一个范围 $[a, b]$ 与 $[c, d]$ 重叠，如果 $\\max(a, c) \\le \\min(b, d)$。\n- $P_1$ (Problem, $[5,7]$) 和 $G_1$ (Problem, $[5,7]$)：类型匹配，范围重叠。潜在匹配 $(P_1, G_1)$。\n- $P_2$ (Test, $[10,12]$) 和 $G_2$ (Test, $[10,11]$)：类型匹配，范围重叠。潜在匹配 $(P_2, G_2)$。\n- $P_3$ (Treatment, $[14,15]$) 和 $G_3$ (Treatment, $[15,15]$)：类型匹配，范围重叠。潜在匹配 $(P_3, G_3)$。\n- $P_4$ (Problem, $[20,22]$) 和 $G_4$ (Problem, $[20,21]$)：类型匹配，范围重叠。潜在匹配 $(P_4, G_4)$。\n- $P_5$ (Test, $[25,26]$) 和 $G_5$ (Test, $[25,27]$)：类型匹配，范围重叠。潜在匹配 $(P_5, G_5)$。\n- $P_6$ (Treatment, $[31,32]$) 和 $G_6$ (Treatment, $[30,32]$)：类型匹配，范围重叠。潜在匹配 $(P_6, G_6)$。\n- $P_7$ (Problem, $[2,3]$)：没有重叠的金标准实体。无匹配。\n- $P_8$ (Test, $[40,41]$)：没有重叠的金标准实体。无匹配。\n- $P_9$ (Problem, $[25,27]$) 和 $G_5$ (Test, $[25,27]$)：范围重叠，但类型不同。无匹配。\n\n潜在的匹配是 $(P_1, G_1)$, $(P_2, G_2)$, $(P_3, G_3)$, $(P_4, G_4)$, $(P_5, G_5)$ 和 $(P_6, G_6)$。每个匹配都涉及一个唯一的预测实体和一个唯一的金标准实体，因此没有冲突。为了最大化TP的数量，我们接受所有这 $6$ 个匹配。\n\n基于此宽松匹配分析：\n- 真正例的数量是 $TP_{\\text{relaxed}} = 6$。\n- 假正例的数量是 $FP_{\\text{relaxed}} = N_P - TP_{\\text{relaxed}} = 9 - 6 = 3$。假正例是 $P_7$、$P_8$ 和 $P_9$。\n- 假反例的数量是 $FN_{\\text{relaxed}} = N_G - TP_{\\text{relaxed}} = 6 - 6 = 0$。\n\n现在我们计算宽松匹配的精确率、召回率和 $F1$ 分数：\n$P_{\\text{relaxed}} = \\frac{TP_{\\text{relaxed}}}{TP_{\\text{relaxed}} + FP_{\\text{relaxed}}} = \\frac{6}{6+3} = \\frac{6}{9} = \\frac{2}{3}$\n$R_{\\text{relaxed}} = \\frac{TP_{\\text{relaxed}}}{TP_{\\text{relaxed}} + FN_{\\text{relaxed}}} = \\frac{6}{6+0} = 1$\n$F1_{\\text{relaxed}} = \\frac{2 P_{\\text{relaxed}} R_{\\text{relaxed}}}{P_{\\text{relaxed}} + R_{\\text{relaxed}}} = \\frac{2 \\cdot \\frac{2}{3} \\cdot 1}{\\frac{2}{3} + 1} = \\frac{\\frac{4}{3}}{\\frac{5}{3}} = \\frac{4}{5}$\n\n最后，我们计算差值 $\\Delta = F1_{\\text{relaxed}} - F1_{\\text{strict}}$：\n$\\Delta = \\frac{4}{5} - \\frac{2}{15} = \\frac{12}{15} - \\frac{2}{15} = \\frac{10}{15}$\n将分数化简得到：\n$\\Delta = \\frac{2}{3}$\n\n严格和宽松 $F1$ 分数之间存在显著差异的主要原因在于它们评估边界检测与类型一致性的方式不同。严格匹配的分数 $F1_{\\text{strict}} = \\frac{2}{15}$ 非常低，因为它惩罚任何边界检测上的不精确。在这个问题中，6个类型正确的预测（$P_2, P_3, P_4, P_5, P_6$）中有5个存在微小的边界错误。严格度量标准将这些中的每一个都视为完全失败，既产生了一个假正例，也产生了一个假反例，从而将TP计数急剧减少到1。相比之下，宽松度量标准旨在容忍此类边界不精确性。只要实体类型正确且范围重叠，它就将该预测计为成功。这就是为什么宽松度量标准的TP计数，$TP_{\\text{relaxed}}$，上升到6，从而导致更高的召回率（$R_{\\text{relaxed}}=1$）和精确率（$P_{\\text{relaxed}}=\\frac{2}{3}$），并因此得到一个高的 $F1_{\\text{relaxed}}$ 分数 $\\frac{4}{5}$。因此，这种差异几乎完全归因于严格度量标准对不完美边界检测的不容忍，而在这个任务上，模型经常产生“差一点就对”的结果，宽松度量标准会正确地给予肯定。类型一致性是两种机制的必要条件，正如 $P_9$ 在两种情况下都是假正例所显示的那样。",
            "answer": "$$\\boxed{\\frac{2}{3}}$$"
        }
    ]
}