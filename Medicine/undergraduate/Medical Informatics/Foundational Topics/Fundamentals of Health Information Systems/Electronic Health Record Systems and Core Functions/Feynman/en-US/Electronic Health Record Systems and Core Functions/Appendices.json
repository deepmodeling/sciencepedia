{
    "hands_on_practices": [
        {
            "introduction": "Effective clinical analytics and decision support are built upon a foundation of clean, standardized data. In practice, Electronic Health Record (EHR) systems often ingest data from various sources with different units, requiring careful normalization to ensure consistency. This exercise  challenges you to derive a unit conversion from first principles, a fundamental skill for ensuring data interoperability and the accuracy of any downstream application.",
            "id": "4837180",
            "problem": "A hospital’s Electronic Health Record (EHR) system consolidates laboratory data from multiple sources following Health Level Seven International (HL7) interfaces. For downstream analytics, all glucose concentrations must be normalized to the same unit. You are given four plasma glucose observations from the EHR for a single patient, where three values are recorded in milligrams per deciliter and one value is recorded in millimoles per liter:\n$95 \\ \\mathrm{mg/dL}$, $110 \\ \\mathrm{mg/dL}$, $82 \\ \\mathrm{mg/dL}$, and $5.2 \\ \\mathrm{mmol/L}$.\nUsing the molecular weight of D-glucose $\\mathrm{C}_{6}\\mathrm{H}_{12}\\mathrm{O}_{6}$, $M_{\\mathrm{glucose}} = 180.1559 \\ \\mathrm{g/mol}$, derive from first principles the conversion from milligrams per deciliter to millimoles per liter and apply it to normalize all values to millimoles per liter. Then compute the mean of the normalized glucose concentrations. Start from the definitions of mass concentration (in $\\mathrm{g/L}$), molar concentration (in $\\mathrm{mol/L}$), and base unit relationships for milligrams to grams and deciliters to liters. As part of your derivation, justify why normalizing units by a constant linear scaling does not alter dimensionless dispersion metrics used in downstream analytics. Report only the numerical value of the normalized mean. Round your answer to four significant figures. Express the final mean in $\\mathrm{mmol/L}$.",
            "solution": "The goal is to convert all observations to millimoles per liter and then compute the mean. The conversion must be derived from definitions.\n\nFundamental definitions and unit relationships:\n1. Mass concentration in grams per liter is $c_{m} = \\frac{m}{V}$ with $m$ in $\\mathrm{g}$ and $V$ in $\\mathrm{L}$.\n2. Molar concentration in moles per liter is $c_{n} = \\frac{n}{V}$ with $n$ in $\\mathrm{mol}$, and relates to mass concentration via the molar mass $M$ (in $\\mathrm{g/mol}$) as $c_{n} = \\frac{c_{m}}{M}$ because $n = \\frac{m}{M}$.\n3. Base unit conversions: $1 \\ \\mathrm{mg} = 10^{-3} \\ \\mathrm{g}$ and $1 \\ \\mathrm{dL} = 10^{-1} \\ \\mathrm{L}$.\n\nDeriving the conversion from $\\mathrm{mg/dL}$ to $\\mathrm{mmol/L}$:\nLet a glucose measurement be $x \\ \\mathrm{mg/dL}$. Convert to grams per liter:\n$$\nx \\ \\mathrm{mg/dL} = x \\times \\frac{10^{-3} \\ \\mathrm{g}}{10^{-1} \\ \\mathrm{L}} = x \\times 10^{-2} \\ \\mathrm{g/L}.\n$$\nThen convert to moles per liter using molar mass $M_{\\mathrm{glucose}}$:\n$$\nc_{n} = \\frac{x \\times 10^{-2} \\ \\mathrm{g/L}}{M_{\\mathrm{glucose}} \\ \\mathrm{g/mol}} = \\frac{10^{-2} x}{M_{\\mathrm{glucose}}} \\ \\mathrm{mol/L}.\n$$\nFinally, convert to millimoles per liter by multiplying by $10^{3}$:\n$$\nc_{\\mathrm{mmol/L}} = \\left( \\frac{10^{-2} x}{M_{\\mathrm{glucose}}} \\right) \\times 10^{3} = \\frac{10 x}{M_{\\mathrm{glucose}}}.\n$$\nThus, the conversion factor from $\\mathrm{mg/dL}$ to $\\mathrm{mmol/L}$ for glucose is $\\frac{10}{M_{\\mathrm{glucose}}}$.\n\nApply the conversion to the three $\\mathrm{mg/dL}$ observations ($95$, $110$, $82$), keeping the $\\mathrm{mmol/L}$ observation ($5.2$) unchanged:\n$$\n95 \\ \\mathrm{mg/dL} \\mapsto \\frac{10 \\times 95}{M_{\\mathrm{glucose}}} \\ \\mathrm{mmol/L},\n$$\n$$\n110 \\ \\mathrm{mg/dL} \\mapsto \\frac{10 \\times 110}{M_{\\mathrm{glucose}}} \\ \\mathrm{mmol/L},\n$$\n$$\n82 \\ \\mathrm{mg/dL} \\mapsto \\frac{10 \\times 82}{M_{\\mathrm{glucose}}} \\ \\mathrm{mmol/L}.\n$$\nThe normalized mean in $\\mathrm{mmol/L}$ is\n$$\n\\bar{c} = \\frac{1}{4} \\left( \\frac{10 \\times 95}{M_{\\mathrm{glucose}}} + \\frac{10 \\times 110}{M_{\\mathrm{glucose}}} + \\frac{10 \\times 82}{M_{\\mathrm{glucose}}} + 5.2 \\right).\n$$\nCombine the symbolic terms:\n$$\n\\bar{c} = \\frac{1}{4} \\left( \\frac{10 \\times (95 + 110 + 82)}{M_{\\mathrm{glucose}}} + 5.2 \\right) = \\frac{1}{4} \\left( \\frac{10 \\times 287}{M_{\\mathrm{glucose}}} + 5.2 \\right).\n$$\nNow substitute $M_{\\mathrm{glucose}} = 180.1559 \\ \\mathrm{g/mol}$ and evaluate numerically:\n$$\n\\frac{10}{M_{\\mathrm{glucose}}} = \\frac{10}{180.1559} \\approx 0.0555075,\n$$\nso the three converted values are\n$$\n95 \\mapsto 95 \\times 0.0555075 \\approx 5.2732125,\n$$\n$$\n110 \\mapsto 110 \\times 0.0555075 \\approx 6.105825,\n$$\n$$\n82 \\mapsto 82 \\times 0.0555075 \\approx 4.551615.\n$$\nSum with the existing $5.2 \\ \\mathrm{mmol/L}$ value:\n$$\n5.2732125 + 6.105825 + 4.551615 + 5.2 = 21.1306525.\n$$\nCompute the mean:\n$$\n\\bar{c} = \\frac{21.1306525}{4} \\approx 5.282663125 \\ \\mathrm{mmol/L}.\n$$\nRound to four significant figures as requested:\n$$\n\\bar{c} \\approx 5.283 \\ \\mathrm{mmol/L}.\n$$\n\nJustification of unit normalization for downstream analytics:\nLet the original set of measurements (all in consistent units) be $\\{ x_{i} \\}$ with mean $\\mu$ and standard deviation $\\sigma$. A linear unit conversion applies the same positive scaling factor $a$ to all observations, yielding $\\{ y_{i} \\}$ where $y_{i} = a x_{i}$. Then the mean transforms as $\\mu_{y} = a \\mu$, and the standard deviation as $\\sigma_{y} = a \\sigma$. The coefficient of variation is $\\mathrm{CV} = \\frac{\\sigma}{\\mu}$, so under scaling,\n$$\n\\mathrm{CV}_{y} = \\frac{\\sigma_{y}}{\\mu_{y}} = \\frac{a \\sigma}{a \\mu} = \\frac{\\sigma}{\\mu} = \\mathrm{CV}.\n$$\nThus, dimensionless dispersion metrics such as the coefficient of variation remain invariant under linear unit conversions, validating that consistent unit normalization does not distort such downstream analytics.",
            "answer": "$$\\boxed{5.283}$$"
        },
        {
            "introduction": "Clinical Decision Support (CDS) is a core EHR function, but its effectiveness can be undermined by 'alert fatigue' if alerts are too frequent or irrelevant. To design better systems, we must be able to model and predict their impact on clinical workflow. This practice  uses probability theory to quantify alert burden and clinician response, providing a quantitative framework for assessing the risk of alert fatigue.",
            "id": "4837177",
            "problem": "An Electronic Health Record (EHR) system integrates Clinical Decision Support (CDS) alerts into the Computerized Provider Order Entry (CPOE) workflow for medication orders. Suppose each order independently triggers a CDS alert with probability $p$, and, conditional on an alert firing, a clinician accepts the alert (i.e., does not override) with probability $a$. Consider a shift during which $n$ medication orders are placed. For the purposes of estimating alert fatigue risk, define the alert count $X$ across the $n$ orders as the sum of $n$ independent Bernoulli trials, each with success probability $p$. Using the fundamental definition of expectation and variance for sums of independent Bernoulli trials, and the Central Limit Theorem for approximating the distribution of $X$, answer the following for the parameter values $p = 0.18$, $a = 0.12$, $n = 750$:\n1) Derive the expected number of alerts $E[A]$ across the $n$ orders.\n2) Derive the expected number of overrides $E[O]$ across the $n$ orders.\n3) Define an alert fatigue risk threshold $m^{\\ast}$ as the smallest integer such that the probability of observing at most $m^{\\ast}$ alerts is at least $1 - r$, where $r = 0.10$. Estimate $m^{\\ast}$ by approximating the binomial distribution of $X$ with a normal distribution and applying a continuity correction.\n\nRound the expected counts $E[A]$ and $E[O]$ to four significant figures. Report $m^{\\ast}$ as an integer. Express the final answer as three values in the order $E[A]$, $E[O]$, $m^{\\ast}$.",
            "solution": "1) **Expected number of alerts $E[A]$**:\nThe total number of alerts, let's call the random variable $X_A$, is defined as the sum of $n$ independent Bernoulli trials. Let $B_i$ be a random variable for the $i$-th order, where $B_i=1$ if an alert is triggered and $B_i=0$ otherwise. The probability of success for each trial is $p$.\n$B_i \\sim \\text{Bernoulli}(p)$\nThe expected value of a single Bernoulli trial is $E[B_i] = 1 \\cdot p + 0 \\cdot (1-p) = p$.\nThe total number of alerts is the sum $X_A = \\sum_{i=1}^{n} B_i$. By the linearity of expectation, the expected number of alerts is:\n$$E[A] = E[X_A] = E\\left[\\sum_{i=1}^{n} B_i\\right] = \\sum_{i=1}^{n} E[B_i] = \\sum_{i=1}^{n} p = np$$\nThis is the well-known formula for the expectation of a binomial distribution, $X_A \\sim \\text{Bin}(n,p)$.\nSubstituting the given values:\n$$E[A] = (750)(0.18) = 135$$\nRounding to four significant figures as requested, we get $135.0$.\n\n2) **Expected number of overrides $E[O]$**:\nAn override for a given order occurs if an alert is triggered (probability $p$) AND the clinician does not accept it. The probability of non-acceptance (override), given an alert has fired, is $1-a$.\nLet $O_i$ be a random variable for the $i$-th order, where $O_i=1$ if an override occurs and $O_i=0$ otherwise. The probability of an override for a single order is the product of the probabilities of these two events:\n$$P(O_i=1) = P(\\text{alert for order } i) \\times P(\\text{override | alert for order } i) = p(1-a)$$\nThe total number of overrides, $X_O$, is the sum of $n$ independent Bernoulli trials $O_i$, each with success probability $p(1-a)$.\n$$X_O = \\sum_{i=1}^{n} O_i$$\nBy linearity of expectation:\n$$E[O] = E[X_O] = E\\left[\\sum_{i=1}^{n} O_i\\right] = \\sum_{i=1}^{n} E[O_i] = \\sum_{i=1}^{n} p(1-a) = np(1-a)$$\nSubstituting the given values:\n$$E[O] = (750)(0.18)(1 - 0.12) = 135(0.88) = 118.8$$\nThis value is already given to four significant figures.\n\n3) **Alert fatigue risk threshold $m^{\\ast}$**:\nWe need to find the smallest integer $m^{\\ast}$ such that $P(X_A \\le m^{\\ast}) \\ge 1 - r = 1 - 0.10 = 0.90$.\nThe number of alerts $X_A$ follows a binomial distribution, $X_A \\sim \\text{Bin}(n=750, p=0.18)$. We will approximate this with a normal distribution, $N(\\mu, \\sigma^2)$. First, we check if the approximation is appropriate:\n$$np = (750)(0.18) = 135 \\ge 5$$\n$$n(1-p) = (750)(1-0.18) = 750(0.82) = 615 \\ge 5$$\nThe conditions are met. The parameters of the normal distribution are the mean and variance of the binomial distribution:\n$$\\mu = np = 135$$\n$$\\sigma^2 = np(1-p) = 135(0.82) = 110.7$$\nThe standard deviation is $\\sigma = \\sqrt{110.7}$.\nWe are looking for the smallest integer $m^{\\ast}$ satisfying $P(X_A \\le m^{\\ast}) \\ge 0.90$. Applying the continuity correction for the normal approximation of a binomial distribution, the discrete probability $P(X_A \\le m^{\\ast})$ is approximated by the area under the normal curve up to $m^{\\ast} + 0.5$.\n$$P(X_A \\le m^{\\ast}) \\approx P(N \\le m^{\\ast} + 0.5)$$\nWe need to solve $P(N \\le m^{\\ast} + 0.5) \\ge 0.90$. We standardize the normal variable to a standard normal variable $Z \\sim N(0,1)$:\n$$P\\left(\\frac{N - \\mu}{\\sigma} \\le \\frac{(m^{\\ast} + 0.5) - \\mu}{\\sigma}\\right) \\ge 0.90$$\n$$P\\left(Z \\le \\frac{m^{\\ast} + 0.5 - 135}{\\sqrt{110.7}}\\right) \\ge 0.90$$\nLet $\\Phi(z)$ be the cumulative distribution function of the standard normal distribution. We are looking for the critical value $z_{0.90}$ such that $\\Phi(z_{0.90}) = 0.90$. From standard statistical tables or computation, $z_{0.90} \\approx 1.28155$.\nThe inequality becomes:\n$$\\frac{m^{\\ast} - 134.5}{\\sqrt{110.7}} \\ge 1.28155$$\nSolving for $m^{\\ast}$:\n$$m^{\\ast} - 134.5 \\ge 1.28155 \\times \\sqrt{110.7}$$\n$$m^{\\ast} \\ge 134.5 + 1.28155 \\times \\sqrt{110.7}$$\n$$m^{\\ast} \\ge 134.5 + 1.28155 \\times 10.5214$$\n$$m^{\\ast} \\ge 134.5 + 13.4842$$\n$$m^{\\ast} \\ge 147.9842$$\nSince $m^{\\ast}$ must be an integer, the smallest integer satisfying this condition is $m^{\\ast} = 148$.\n\nThe three required values are $E[A] = 135.0$, $E[O] = 118.8$, and $m^{\\ast} = 148$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n135.0 & 118.8 & 148\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The pinnacle of EHR functionality is the implementation of intelligent, patient-specific guidance directly within the clinical workflow. This requires translating complex biomedical knowledge, such as pharmacokinetic principles, into precise, executable logic. In this capstone exercise , you will derive a renal dosing adjustment rule and formalize it using Clinical Quality Language (CQL), mirroring the real-world process of creating advanced CDS interventions.",
            "id": "4837222",
            "problem": "You are designing a clinical decision support computation for an Electronic Health Record (EHR) that determines dose adjustments for renally cleared medications. Use the following foundational pharmacokinetic principles and clinical informatics constraints as the starting point for your derivation and algorithmic design (do not assume any shortcut formulas beyond these foundations):\n\n- Clearance additivity: total clearance equals the sum of renal and nonrenal clearances, i.e., $CL_{\\text{total}} = CL_{\\text{r}} + CL_{\\text{nr}}$.\n- Linear pharmacokinetics within the therapeutic window: exposure, measured by the area under the concentration-time curve, is inversely proportional to clearance for a fixed dose, i.e., $AUC \\propto \\dfrac{\\text{Dose}}{CL_{\\text{total}}}$.\n- A fixed baseline reference for normal kidney function: a normal reference estimated glomerular filtration rate (eGFR) $e_{\\text{norm}}$ exists and is used for comparison.\n- Proportionality assumption for renal elimination: renal clearance scales linearly with the ratio of current estimated glomerular filtration rate to the normal reference, while nonrenal clearance is unaffected by kidney function.\n- Clinical decision support policy constraint: the EHR should never increase the ordered dose above the baseline dose based solely on higher than normal kidney function; only decreasing adjustments are allowed automatically.\n\nDefinitions and inputs:\n- Let $e$ be the current estimated glomerular filtration rate, measured in $\\text{mL}\\cdot\\text{min}^{-1}\\cdot (1.73\\ \\text{m}^2)^{-1}$. All $e$ inputs are given in these units.\n- Let $e_{\\text{norm}}$ be the normal reference estimated glomerular filtration rate in the same units.\n- Let $f_{\\text{r}}$ be the fraction of the drug’s baseline total clearance that is renal, expressed as a decimal in $[0,1]$.\n- Let $m_{\\text{floor}}$ be a clinical floor for the minimum safe dose multiplier, expressed as a decimal in $[0,1]$.\n- Let $e_{\\text{contra}}$ be a contraindication threshold on the estimated glomerular filtration rate such that if $e < e_{\\text{contra}}$ the medication should be considered contraindicated regardless of other factors, in the same units as $e$.\n\nYour tasks:\n1) From the above foundations and definitions, derive an expression for the multiplicative dose adjustment factor required to maintain equal exposure compared to the baseline dose when kidney function changes from $e_{\\text{norm}}$ to $e$. Enforce the clinical decision support policy constraint that the EHR should not suggest any dose increase above the baseline dose.\n2) Specify a boolean rule to mark a medication as contraindicated when either the estimated glomerular filtration rate is too low or the computed dose multiplier would fall below the minimum safe dose multiplier floor. Also specify a boolean indicating whether a dose adjustment is needed.\n3) Provide a formal representation of your decision logic in Clinical Quality Language (CQL) referencing Fast Healthcare Interoperability Resources (FHIR) artifacts, ensuring that your logic identifies the most recent relevant estimated glomerular filtration rate Observation and applies the above rules to an active MedicationRequest. This formal representation is part of the reasoning and should be presented in your solution write-up, not produced by the program.\n4) Implement a program that, for a given test suite of patient–drug scenarios, computes for each case:\n   - the final dose multiplier (rounded to four decimal places, unitless),\n   - a boolean indicating whether an adjustment is needed,\n   - a boolean indicating whether the drug is contraindicated.\n   The decision must be universal and independent of any specific programming language beyond arithmetic and logical operations implied by your derivation.\n\nUnits and rounding:\n- All estimated glomerular filtration rate values $e$ and $e_{\\text{norm}}$ are in $\\text{mL}\\cdot\\text{min}^{-1}\\cdot (1.73\\ \\text{m}^2)^{-1}$.\n- Fractions $f_{\\text{r}}$ and $m_{\\text{floor}}$ are decimals in $[0,1]$.\n- The final dose multiplier must be rounded to four decimal places.\n\nTest suite:\nEach test case is a tuple $\\left(e, e_{\\text{norm}}, f_{\\text{r}}, m_{\\text{floor}}, e_{\\text{contra}}\\right)$:\n- Case $1$: $\\left(60, 120, 0.5, 0.3, 10\\right)$\n- Case $2$: $\\left(15, 120, 0.0, 0.2, 10\\right)$\n- Case $3$: $\\left(30, 120, 1.0, 0.2, 10\\right)$\n- Case $4$: $\\left(5, 120, 0.8, 0.2, 10\\right)$\n- Case $5$: $\\left(140, 120, 0.6, 0.3, 10\\right)$\n- Case $6$: $\\left(12, 120, 0.95, 0.3, 10\\right)$\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case in order and is itself a three-element list of the form $\\left[\\text{dose\\_multiplier}, \\text{adjust\\_needed}, \\text{contraindicated}\\right]$.\n- For example, a line such as $[[0.7500,True,False],[1.0000,False,False],\\dots]$ where floats are rounded to four decimal places and booleans are capitalized as shown.",
            "solution": "The solution is developed in four parts: 1) derivation of the dose adjustment factor from first principles; 2) specification of the boolean logic for clinical flags; 3) formalization of the logic in Clinical Quality Language (CQL); and 4) development of the computational algorithm.\n\n**1. Derivation of the Dose Adjustment Multiplier**\n\nThe objective is to find a dose adjustment multiplier, $m$, that maintains a constant drug exposure (Area Under the Curve, $AUC$) when a patient's kidney function, represented by the estimated glomerular filtration rate ($e$), deviates from a normal reference value ($e_{\\text{norm}}$).\n\nFrom the principle of linear pharmacokinetics, exposure is given by:\n$$AUC = \\frac{\\text{Dose}}{CL_{\\text{total}}}$$\nTo maintain constant exposure ($AUC_{\\text{current}} = AUC_{\\text{norm}}$) between the patient's current state and the normal reference state, the following must hold:\n$$\\frac{D_{\\text{current}}}{CL_{\\text{total, current}}} = \\frac{D_{\\text{norm}}}{CL_{\\text{total, norm}}}$$\nThe dose adjustment multiplier, $m$, is the ratio of the adjusted dose to the normal dose, $m = \\frac{D_{\\text{current}}}{D_{\\text{norm}}}$. Rearranging the equation gives:\n$$m = \\frac{D_{\\text{current}}}{D_{\\text{norm}}} = \\frac{CL_{\\text{total, current}}}{CL_{\\text{total, norm}}}$$\nThe multiplier is therefore the ratio of the patient's current total clearance to the normal total clearance. We must now derive an expression for this ratio.\n\nTotal clearance is the sum of renal ($CL_{\\text{r}}$) and nonrenal ($CL_{\\text{nr}}$) clearance: $CL_{\\text{total}} = CL_{\\text{r}} + CL_{\\text{nr}}$.\nAt baseline (normal kidney function), we have $CL_{\\text{total, norm}} = CL_{\\text{r, norm}} + CL_{\\text{nr}}$.\nThe fraction of renal clearance, $f_{\\text{r}}$, is defined at baseline:\n$$f_{\\text{r}} = \\frac{CL_{\\text{r, norm}}}{CL_{\\text{total, norm}}}$$\nThis allows us to express the baseline clearance components in terms of total baseline clearance:\n$$CL_{\\text{r, norm}} = f_{\\text{r}} \\cdot CL_{\\text{total, norm}}$$\n$$CL_{\\text{nr}} = (1 - f_{\\text{r}}) \\cdot CL_{\\text{total, norm}}$$\nThe problem states that nonrenal clearance $CL_{\\text{nr}}$ is unaffected by kidney function. The proportionality assumption states that renal clearance scales linearly with the eGFR ratio:\n$$CL_{\\text{r, current}} = CL_{\\text{r, norm}} \\cdot \\left(\\frac{e}{e_{\\text{norm}}}\\right)$$\nSubstituting the expression for $CL_{\\text{r, norm}}$:\n$$CL_{\\text{r, current}} = \\left(f_{\\text{r}} \\cdot CL_{\\text{total, norm}}\\right) \\cdot \\left(\\frac{e}{e_{\\text{norm}}}\\right)$$\nThe patient's current total clearance is the sum of the current renal clearance and the constant nonrenal clearance:\n$$CL_{\\text{total, current}} = CL_{\\text{r, current}} + CL_{\\text{nr}}$$\n$$CL_{\\text{total, current}} = \\left(f_{\\text{r}} \\cdot CL_{\\text{total, norm}} \\cdot \\frac{e}{e_{\\text{norm}}}\\right) + \\left((1 - f_{\\text{r}}) \\cdot CL_{\\text{total, norm}}\\right)$$\nFactoring out $CL_{\\text{total, norm}}$ gives:\n$$CL_{\\text{total, current}} = CL_{\\text{total, norm}} \\left( f_{\\text{r}} \\frac{e}{e_{\\text{norm}}} + 1 - f_{\\text{r}} \\right)$$\nNow we can compute the multiplier $m$ by substituting this into the ratio $m = \\frac{CL_{\\text{total, current}}}{CL_{\\text{total, norm}}}$:\n$$m_{\\text{raw}} = 1 - f_{\\text{r}} + f_{\\text{r}} \\frac{e}{e_{\\text{norm}}}$$\nThis expression, $m_{\\text{raw}}$, represents the raw adjustment factor. The clinical policy constraint dictates that the dose should not be increased if kidney function is better than normal (i.e., if $e > e_{\\text{norm}}$). This means the multiplier must be capped at $1$.\nTherefore, the final calculated multiplier, $m_{\\text{calc}}$, is:\n$$m_{\\text{calc}} = \\min\\left(1, m_{\\text{raw}}\\right) = \\min\\left(1, 1 - f_{\\text{r}} + f_{\\text{r}} \\frac{e}{e_{\\text{norm}}}\\right)$$\n\n**2. Specification of Boolean Logic Rules**\n\nTwo boolean flags are required: one for contraindication and one to indicate if an adjustment is needed.\n\n**Contraindication Rule (`contraindicated`):** A medication is contraindicated if the patient's eGFR is below the contraindication threshold ($e_{\\text{contra}}$) OR if the calculated dose multiplier ($m_{\\text{calc}}$) falls below the specified minimum safe dose multiplier floor ($m_{\\text{floor}}$).\n$$\\text{contraindicated} = (e < e_{\\text{contra}}) \\lor (m_{\\text{calc}} < m_{\\text{floor}})$$\n\n**Adjustment Needed Rule (`adjust_needed`):** A dose adjustment is considered necessary if the final calculated dose multiplier differs from the default multiplier of $1$. Since our policy caps the multiplier at $1$, an adjustment is only needed for dose decreases.\n$$\\text{adjust\\_needed} = (m_{\\text{calc}} < 1.0)$$\n\n**3. Formal Representation in Clinical Quality Language (CQL)**\n\nThe derived logic can be formally represented in CQL for integration into a FHIR-based EHR system. The following CQL snippet defines the logic to be applied to a patient's record.\n\n```cql\nlibrary RenalDoseAdjustment version '1.0.0'\nusing FHIR version '4.0.1'\ninclude FHIRHelpers version '4.0.1'\n\ncontext Patient\n\n// Parameters for the specific drug and CDS rule\nparameter \"Normal eGFR\" Decimal default 120.0\nparameter \"Renal Clearance Fraction\" Decimal\nparameter \"Minimum Dose Multiplier Floor\" Decimal\nparameter \"eGFR Contraindication Threshold\" Decimal\n\n// LOINC code for eGFR/1.73 sq m based on serum creatinine\ndefine \"EGFR_LOINC\": Code { code: '33914-3', system: 'http://loinc.org' }\n\n// Retrieve the most recent eGFR observation for the patient\ndefine \"Most Recent eGFR Observation\":\n  First(\n    [Observation: \"EGFR_LOINC\"] O\n      where O.status in { 'final', 'amended', 'corrected' }\n      and O.value is not null\n      sort by effective.to-dateTime() desc\n  )\n\n// Extract the numerical value of the eGFR\ndefine \"Patient eGFR Value\":\n  (\"Most Recent eGFR Observation\".value as Quantity).value\n\n// 1. Derivation of the dose adjustment factor\ndefine \"Raw Dose Multiplier\":\n  (1.0 - \"Renal Clearance Fraction\") + \"Renal Clearance Fraction\" * (\"Patient eGFR Value\" / \"Normal eGFR\")\n\ndefine \"Calculated Dose Multiplier\":\n  if \"Raw Dose Multiplier\" > 1.0 then 1.0 else \"Raw Dose Multiplier\"\n\n// 2. Specification of boolean rules\ndefine \"Is Contraindicated\":\n  \"Patient eGFR Value\" < \"eGFR Contraindication Threshold\"\n    or \"Calculated Dose Multiplier\" < \"Minimum Dose Multiplier Floor\"\n\ndefine \"Is Adjustment Needed\":\n  \"Calculated Dose Multiplier\" < 1.0\n\n// Final output structure for the CDS logic\ndefine \"Dose Adjustment Recommendation\":\n  Tuple {\n    finalDoseMultiplier: \"Calculated Dose Multiplier\",\n    adjustmentNeeded: \"Is Adjustment Needed\",\n    contraindicated: \"Is Contraindicated\"\n  }\n```\n\n**4. Computational Algorithm Summary**\n\nFor each test case tuple $(e, e_{\\text{norm}}, f_{\\text{r}}, m_{\\text{floor}}, e_{\\text{contra}})$:\n1.  Calculate the raw dose multiplier: $m_{\\text{raw}} \\leftarrow 1 - f_{\\text{r}} + f_{\\text{r}} \\cdot (e / e_{\\text{norm}})$.\n2.  Apply the no-increase policy: $m_{\\text{calc}} \\leftarrow \\min(1.0, m_{\\text{raw}})$.\n3.  Evaluate the contraindication rule: $\\text{contraindicated} \\leftarrow (e < e_{\\text{contra}}) \\lor (m_{\\text{calc}} < m_{\\text{floor}})$.\n4.  Evaluate the adjustment rule: $\\text{adjust\\_needed} \\leftarrow (m_{\\text{calc}} < 1.0)$.\n5.  Round the final multiplier to four decimal places for reporting: $m_{\\text{final}} \\leftarrow \\text{round}(m_{\\text{calc}}, 4)$.\n6.  Assemble the final result tuple: $[m_{\\text{final}}, \\text{adjust\\_needed}, \\text{contraindicated}]$.\n\nThis algorithm is implemented in the Python program provided in the final answer.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes dose adjustment recommendations based on pharmacokinetic principles.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (e, e_norm, f_r, m_floor, e_contra)\n    test_cases = [\n        (60, 120, 0.5, 0.3, 10),\n        (15, 120, 0.0, 0.2, 10),\n        (30, 120, 1.0, 0.2, 10),\n        (5, 120, 0.8, 0.2, 10),\n        (140, 120, 0.6, 0.3, 10),\n        (12, 120, 0.95, 0.3, 10),\n    ]\n\n    results_for_print = []\n    \n    for case in test_cases:\n        e, e_norm, f_r, m_floor, e_contra = case\n\n        # 1. Calculate the raw dose multiplier\n        # m_raw = (1 - f_r) + f_r * (e / e_norm)\n        # This simplifies to the ratio of current total clearance to normal total clearance.\n        m_raw = 1 - f_r + f_r * (e / e_norm)\n\n        # 2. Apply the clinical decision support policy constraint: no dose increase\n        m_calc = min(1.0, m_raw)\n\n        # 3. Evaluate the boolean rule for contraindication\n        # Contraindicated if eGfr is too low OR the multiplier is below the safe floor.\n        is_contraindicated = (e < e_contra) or (m_calc < m_floor)\n\n        # 4. Evaluate the boolean rule for whether an adjustment is needed\n        # An adjustment is needed if the final multiplier is less than 1.0.\n        is_adjustment_needed = m_calc < 1.0\n\n        # Assemble the result for this case according to the required output types\n        # The dose multiplier must be rounded to four decimal places.\n        dose_multiplier_final = m_calc\n        \n        # Format the individual result list into the specified string format\n        # [dose_multiplier, adjust_needed, contraindicated]\n        # Using an f-string with .4f ensures the float has exactly four decimal places.\n        case_result_str = (\n            f\"[{dose_multiplier_final:.4f},\"\n            f\"{is_adjustment_needed},\"\n            f\"{is_contraindicated}]\"\n        )\n        results_for_print.append(case_result_str)\n\n    # Final print statement in the exact required format.\n    # The final output is a string representation of a list of lists.\n    # Example: [[0.7500,True,False],[1.0000,False,False],...]\n    print(f\"[{','.join(results_for_print)}]\")\n\nsolve()\n```"
        }
    ]
}