{
    "hands_on_practices": [
        {
            "introduction": "This first exercise brings the theoretical definition of the Quality-Adjusted Life Year (QALY) to life. By working through a hypothetical patient's journey with changing health states, you will apply the foundational principle that a QALY is the \"area under the curve\" of a utility-over-time graph. This practice solidifies the core skill of calculating total QALYs by weighting distinct periods of time by their associated quality of life value .",
            "id": "5053286",
            "problem": "In a translational medicine study of a novel heart failure therapy, a single patient’s health-related quality-of-life trajectory over a fixed follow-up is modeled by an instantaneous utility function $u(t)$, where $t$ is time in years and $u(t) \\in [0,1]$ reflects the health state value at time $t$. By definition, the total Quality-Adjusted Life Years (QALYs) accrued over a horizon $[0,T]$ is the time integral of the instantaneous utility, that is, the integral of $u(t)$ with respect to time over $[0,T]$. The patient experiences two clinically stable phases during the $T$-year horizon: a higher-utility phase from baseline to time $t_1$ and a lower-utility phase thereafter (due to a non-fatal adverse event). Assume that $u(t)$ is piecewise constant with $u(t)=u_1$ for $t \\in [0,t_1]$ and $u(t)=u_2$ for $t \\in (t_1,T]$. Take $u_1=0.82$, $u_2=0.68$, $t_1=9$ months, and $T=2$ years. Starting from the integral definition of total QALYs over $[0,T]$, derive the expression for total QALYs for this piecewise-constant trajectory, and then compute its numerical value. Interpret the result using the area-under-curve viewpoint in terms of time-weighted health states. Express the final result in QALYs and round your numerical answer to four significant figures.",
            "solution": "The problem statement is subjected to validation before a solution is attempted.\n\n**Step 1: Extract Givens**\n- Instantaneous utility function: $u(t)$, where $t$ is time in years and $u(t) \\in [0,1]$.\n- Definition of total Quality-Adjusted Life Years (QALYs) over $[0,T]$: The time integral of $u(t)$ from $0$ to $T$.\n- Model for $u(t)$: Piecewise constant.\n- Utility in first phase: $u(t)=u_1$ for $t \\in [0,t_1]$.\n- Utility in second phase: $u(t)=u_2$ for $t \\in (t_1,T]$.\n- Value for $u_1$: $0.82$.\n- Value for $u_2$: $0.68$.\n- Time of transition: $t_1 = 9$ months.\n- Total time horizon: $T=2$ years.\n- Required tasks: Derive the expression for total QALYs, compute its numerical value, interpret the result, and round the final answer to four significant figures.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem is scientifically grounded. The definition of QALYs as the integral of a time-dependent utility function is a cornerstone of health economics and outcomes research, fields essential to translational medicine. The use of a piecewise constant function is a standard and valid simplification for modeling changes in health states over time.\n- **Well-Posedness**: The problem is well-posed. It provides a clear definition, a specific functional form for $u(t)$, and all necessary parameters to compute a unique solution.\n- **Objectivity**: The problem is stated in precise, objective language, free of subjective claims.\n- **Completeness and Consistency**: The problem is self-contained. All required data ($u_1$, $u_2$, $t_1$, $T$) are provided. There are no contradictions. The different units for $t_1$ (months) and $T$ (years) require conversion, which is a standard part of solving physics and engineering problems, not an inconsistency.\n- **Realism**: The scenario and numerical values are realistic for a patient with a chronic condition experiencing an adverse event.\n- **Structure**: The problem is clearly structured and leads to a unique, meaningful solution.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid**. A full solution will be provided.\n\n**Solution Derivation**\n\nThe total Quality-Adjusted Life Years (QALYs), denoted as $Q$, are defined by the integral of the instantaneous utility function $u(t)$ over the specified time horizon $[0, T]$.\n$$ Q = \\int_{0}^{T} u(t) \\, dt $$\nThe utility function $u(t)$ is given as a piecewise constant function:\n$$\nu(t) =\n\\begin{cases}\nu_1 & \\text{for } 0 \\le t \\le t_1 \\\\\nu_2 & \\text{for } t_1 < t \\le T\n\\end{cases}\n$$\nwhere $u_1$ and $u_2$ are constants. To evaluate the integral, we must split it at the point of discontinuity, $t_1$:\n$$ Q = \\int_{0}^{t_1} u(t) \\, dt + \\int_{t_1}^{T} u(t) \\, dt $$\nSubstituting the constant values of $u(t)$ into the respective intervals yields:\n$$ Q = \\int_{0}^{t_1} u_1 \\, dt + \\int_{t_1}^{T} u_2 \\, dt $$\nSince $u_1$ and $u_2$ are constants with respect to the integration variable $t$, they can be factored out of the integrals:\n$$ Q = u_1 \\int_{0}^{t_1} dt + u_2 \\int_{t_1}^{T} dt $$\nPerforming the integrations gives:\n$$ Q = u_1 [t]_{0}^{t_1} + u_2 [t]_{t_1}^{T} $$\n$$ Q = u_1 (t_1 - 0) + u_2 (T - t_1) $$\nThis leads to the final derived expression for the total QALYs for this piecewise-constant trajectory:\n$$ Q = u_1 t_1 + u_2 (T - t_1) $$\n**Interpretation**\nThis expression has a clear geometric interpretation as the area under the curve of the utility function $u(t)$ from $t=0$ to $t=T$. It is the sum of the areas of two rectangles:\n1.  The first rectangle has a height of $u_1$ and a width of $t_1$. Its area is $u_1 t_1$, representing the QALYs accrued during the first, higher-utility phase.\n2.  The second rectangle has a height of $u_2$ and a width of $(T - t_1)$. Its area is $u_2(T - t_1)$, representing the QALYs accrued during the second, lower-utility phase.\nThus, the total QALYs are the sum of the utility values for each health state, each weighted by the duration of time spent in that state. This is the essence of valuing \"time-weighted health states\".\n\n**Numerical Calculation**\nThe given parameter values are:\n- $u_1 = 0.82$\n- $u_2 = 0.68$\n- $T = 2$ years\n- $t_1 = 9$ months\n\nFor consistency, all time variables must be in the same unit. We convert $t_1$ from months to years. Since there are $12$ months in a year:\n$$ t_1 = 9 \\, \\text{months} \\times \\frac{1 \\, \\text{year}}{12 \\, \\text{months}} = \\frac{9}{12} \\, \\text{years} = 0.75 \\, \\text{years} $$\nNow, we substitute these numerical values into the derived expression for $Q$:\n$$ Q = (0.82)(0.75) + (0.68)(2 - 0.75) $$\nFirst, calculate the duration of the second phase:\n$$ T - t_1 = 2 - 0.75 = 1.25 \\, \\text{years} $$\nSubstitute this back into the equation for $Q$:\n$$ Q = (0.82)(0.75) + (0.68)(1.25) $$\nNow, we compute the products:\n$$ (0.82)(0.75) = 0.615 $$\n$$ (0.68)(1.25) = 0.85 $$\nFinally, sum the two components to find the total QALYs:\n$$ Q = 0.615 + 0.85 = 1.465 $$\nThe problem requires the numerical answer to be rounded to four significant figures. The calculated value of $1.465$ already consists of four significant figures ($1$, $4$, $6$, $5$). Therefore, no further rounding is necessary.\n\nThe total QALYs accrued by the patient over the $2$-year horizon is $1.465$.",
            "answer": "$$\n\\boxed{1.465}\n$$"
        },
        {
            "introduction": "Moving beyond the basic calculation, this practice introduces two crucial concepts that enhance the realism of QALY models. You will learn to incorporate discounting, the economic principle that values present health more than future health, and explore the challenging but important concept of health states considered \"worse than death,\" which are assigned negative utility values. This exercise demonstrates how the QALY framework can be adapted to capture these important nuances in health valuation .",
            "id": "4587978",
            "problem": "A patient experiences a one-year episode divided into two constant health states: for the first 3 months the utility weight is $u_1=-0.2$ (a worse-than-death state), followed by 9 months with utility weight $u_2=0.6$. Assume continuous-time exponential discounting at a constant instantaneous annual rate $r=0.03$, with time $t$ measured in years from the start of the episode at $t=0$. Using the foundational definition that a Quality-Adjusted Life Year (QALY) is the time integral of health-related utility, with future health flows discounted consistently with the stated discounting convention, derive the present value of the QALYs accrued over this year. Express your final result in quality-adjusted life years (QALYs) and round to four significant figures.",
            "solution": "The problem statement is first subjected to a rigorous validation process.\n\n### Step 1: Extract Givens\nThe following data and definitions are extracted verbatim from the problem statement:\n- Total episode duration: one-year\n- First health state duration: 3 months\n- Utility weight for the first state: $u_1=-0.2$\n- Second health state duration: 9 months\n- Utility weight for the second state: $u_2=0.6$\n- Discounting method: continuous-time exponential discounting\n- Constant instantaneous annual discount rate: $r=0.03$\n- Time variable: $t$, measured in years\n- Start of the episode: $t=0$\n- Definition of QALY: the time integral of health-related utility, with future health flows discounted consistently\n- Task: derive the present value of the QALYs accrued over this year\n- Final result requirement: round to four significant figures\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated against the validation criteria:\n- **Scientifically Grounded**: The problem is based on the standard economic and epidemiological concepts of Quality-Adjusted Life Years (QALYs), health state utility weights (including negative values for states considered worse than death), and continuous exponential discounting. These are established and well-accepted methods in health technology assessment and public health.\n- **Well-Posed**: The problem provides all necessary parameters ($u_1, u_2, r$, and time intervals) and a clear definition for the quantity to be calculated. The structure allows for the existence of a unique, stable, and meaningful solution.\n- **Objective**: The problem is stated using precise, quantitative, and unbiased language.\n- **Complete and Consistent**: The time periods (3 months and 9 months) sum to one year, which is the total duration of the episode. The time variable $t$ is specified in years, and the discount rate $r$ is an annual rate, ensuring dimensional consistency once the time intervals are converted to years. The setup is self-contained and free of contradictions.\n\n### Step 3: Verdict and Action\nThe problem is **valid** as it is scientifically grounded, well-posed, objective, and consistent. A complete solution will be derived.\n\n### Solution Derivation\n\nThe present value of Quality-Adjusted Life Years ($PV_{QALY}$) is defined as the time integral of the discounted health utility function, $u(t)$. With continuous-time exponential discounting at a constant instantaneous annual rate $r$, the discount factor at time $t$ is $\\exp(-rt)$. The total $PV_{QALY}$ over the time interval $[T_a, T_b]$ is given by the integral:\n$$\nPV_{QALY} = \\int_{T_a}^{T_b} u(t) \\exp(-rt) \\,dt\n$$\nThe problem describes a one-year episode starting at $t=0$. The health utility, $u(t)$, is a piecewise function. First, the time intervals given in months must be converted to years. The first period of $3$ months is $T_1 = \\frac{3}{12} = 0.25$ years. The total episode duration is $1$ year, so the second period ends at $T_2 = 1$ year.\n\nThe utility function $u(t)$ is therefore:\n$$\nu(t) = \\begin{cases}\nu_1 = -0.2 & \\text{for } 0 \\le t \\le 0.25 \\\\\nu_2 = 0.6 & \\text{for } 0.25 < t \\le 1\n\\end{cases}\n$$\nThe total $PV_{QALY}$ is calculated by splitting the integral into two parts corresponding to the two health states:\n$$\nPV_{QALY} = \\int_{0}^{0.25} u_1 \\exp(-rt) \\,dt + \\int_{0.25}^{1} u_2 \\exp(-rt) \\,dt\n$$\nWe are given $u_1 = -0.2$, $u_2 = 0.6$, and $r = 0.03$.\n\nFirst, we evaluate the first integral, $I_1$:\n$$\nI_1 = \\int_{0}^{0.25} (-0.2) \\exp(-0.03t) \\,dt = -0.2 \\left[ \\frac{\\exp(-0.03t)}{-0.03} \\right]_{0}^{0.25}\n$$\n$$\nI_1 = \\frac{0.2}{0.03} \\left[ \\exp(-0.03t) \\right]_{0}^{0.25} = \\frac{20}{3} \\left( \\exp(-0.03 \\times 0.25) - \\exp(-0.03 \\times 0) \\right)\n$$\n$$\nI_1 = \\frac{20}{3} \\left( \\exp(-0.0075) - 1 \\right)\n$$\nNext, we evaluate the second integral, $I_2$:\n$$\nI_2 = \\int_{0.25}^{1} (0.6) \\exp(-0.03t) \\,dt = 0.6 \\left[ \\frac{\\exp(-0.03t)}{-0.03} \\right]_{0.25}^{1}\n$$\n$$\nI_2 = -\\frac{0.6}{0.03} \\left[ \\exp(-0.03t) \\right]_{0.25}^{1} = -20 \\left( \\exp(-0.03 \\times 1) - \\exp(-0.03 \\times 0.25) \\right)\n$$\n$$\nI_2 = 20 \\left( \\exp(-0.0075) - \\exp(-0.03) \\right)\n$$\nThe total present value of QALYs is the sum $I_1 + I_2$:\n$$\nPV_{QALY} = \\frac{20}{3} \\left( \\exp(-0.0075) - 1 \\right) + 20 \\left( \\exp(-0.0075) - \\exp(-0.03) \\right)\n$$\nThis expression can be rearranged for calculation:\n$$\nPV_{QALY} = \\frac{20}{3} \\exp(-0.0075) - \\frac{20}{3} + 20 \\exp(-0.0075) - 20 \\exp(-0.03)\n$$\n$$\nPV_{QALY} = \\left(\\frac{20}{3} + 20\\right) \\exp(-0.0075) - 20 \\exp(-0.03) - \\frac{20}{3}\n$$\n$$\nPV_{QALY} = \\frac{80}{3} \\exp(-0.0075) - 20 \\exp(-0.03) - \\frac{20}{3}\n$$\nNow, we substitute the numerical values for the exponential terms and constants:\n$\\exp(-0.0075) \\approx 0.99252805$\n$\\exp(-0.03) \\approx 0.97044553$\n$\\frac{80}{3} \\approx 26.66666667$\n$\\frac{20}{3} \\approx 6.66666667$\n$20$\n\n$$\nPV_{QALY} \\approx 26.666667 \\times 0.99252805 - 20 \\times 0.97044553 - 6.666667\n$$\n$$\nPV_{QALY} \\approx 26.46741467 - 19.4089106 - 6.66666667\n$$\n$$\nPV_{QALY} \\approx 0.39183747\n$$\nThe problem requires the result to be rounded to four significant figures. The first four significant figures are $3$, $9$, $1$, and $8$. The fifth significant figure is $3$, so we round down.\n$$\nPV_{QALY} \\approx 0.3918\n$$\nThe present value of the QALYs accrued over this year is approximately $0.3918$.",
            "answer": "$$\n\\boxed{0.3918}\n$$"
        },
        {
            "introduction": "This final practice transitions from calculating QALYs for a single, predetermined path to modeling the probabilistic journey of an entire patient cohort. You will implement a discrete-time Markov model, a cornerstone of modern health economic evaluation, to simulate how a group of individuals moves between different health states over many years. This exercise provides practical experience with the methods used to forecast the long-term QALY impacts of health interventions in real-world policy analysis .",
            "id": "4995247",
            "problem": "You are tasked with implementing a discrete-time cohort Markov model to compute discounted Quality-Adjusted Life Years (QALYs) in the context of global health decision analysis. Begin strictly from fundamental definitions: a Quality-Adjusted Life Year (QALY) is the time integral of a health-related quality of life weight across an individual's survival trajectory, and discounting in health economics applies a constant annual rate so that future health is valued less than present health. In a cohort Markov model, individuals occupy one of several mutually exclusive health states at any given time, and the probabilities of transitioning between states across equal-length cycles are time-homogeneous. Dead is an absorbing state. Use half-cycle correction to approximate continuous-time accumulation within each cycle.\n\nYour program must:\n- Represent the cohort as a probability distribution over states.\n- Propagate the distribution forward through cycles using the provided state transition matrix.\n- Compute QALY accrual in each cycle using half-cycle correction by averaging the health utility flow at the start and at the end of the cycle, multiplying by the cycle length in years, and discounting this accrual at the mid-cycle time. Sum across cycles to obtain the total discounted QALYs for the specified horizon.\n- Round each scenario’s result to 3 decimal places and report the answer in years.\n\nDefinitions to start from (do not use shortcut formulas not derived from these definitions):\n- A QALY is defined as the integral of health utility over time, where utility values lie in the interval $[0,1]$ and are multiplied by survival time, with $1$ corresponding to perfect health and $0$ corresponding to death.\n- Constant-rate discounting applies a factor that depends on the annual discount rate and the time at which the health effect occurs.\n- A time-homogeneous Markov chain evolves a state occupancy probability vector by multiplication with a fixed transition matrix per cycle.\n\nYour program must implement the algorithm in a universally applicable, purely mathematical way. All numerical values provided below must be used exactly as given. Express all final outputs in years. There are no angles in this task. Where rates are given, they are decimals (e.g., $0.03$ for three percent) and not percentages.\n\nTest Suite:\nFor each scenario below, compute the total discounted QALYs using half-cycle correction and output a single float in years, rounded to $3$ decimals.\n\nScenario A (happy path: three-state model, annual cycles):\n- States: Healthy $H$, Sick $S$, Dead $D$ (absorbing).\n- Transition matrix $T_A$:\n$$ T_A = \\begin{pmatrix} 0.88 & 0.08 & 0.04 \\\\ 0.10 & 0.80 & 0.10 \\\\ 0.00 & 0.00 & 1.00 \\end{pmatrix} $$\n- Utility weights $u_A$:\n$$ u_A = \\begin{pmatrix} 0.92 \\\\ 0.65 \\\\ 0.00 \\end{pmatrix} $$\n- Initial distribution $p_{0,A}$:\n$$ p_{0,A} = \\begin{pmatrix} 1.00 \\\\ 0.00 \\\\ 0.00 \\end{pmatrix} $$\n- Annual discount rate $r_A = 0.03$.\n- Cycle length $\\Delta_A = 1.0$ years.\n- Time horizon $Y_A = 10.0$ years.\n\nScenario B (boundary condition: zero discount):\n- Same states and transitions as Scenario A.\n- Utility weights $u_B = u_A$.\n- Initial distribution $p_{0,B} = p_{0,A}$.\n- Annual discount rate $r_B = 0.00$.\n- Cycle length $\\Delta_B = 1.0$ years.\n- Time horizon $Y_B = 10.0$ years.\n\nScenario C (edge case: half-year cycles, faster progression):\n- States: Stable $St$, Progressed $Pr$, Dead $D$ (absorbing).\n- Transition matrix $T_C$:\n$$ T_C = \\begin{pmatrix} 0.70 & 0.25 & 0.05 \\\\ 0.00 & 0.85 & 0.15 \\\\ 0.00 & 0.00 & 1.00 \\end{pmatrix} $$\n- Utility weights $u_C$:\n$$ u_C = \\begin{pmatrix} 0.80 \\\\ 0.50 \\\\ 0.00 \\end{pmatrix} $$\n- Initial distribution $p_{0,C}$:\n$$ p_{0,C} = \\begin{pmatrix} 1.00 \\\\ 0.00 \\\\ 0.00 \\end{pmatrix} $$\n- Annual discount rate $r_C = 0.03$.\n- Cycle length $\\Delta_C = 0.5$ years.\n- Time horizon $Y_C = 3.0$ years.\n\nScenario D (edge case: no mortality within horizon):\n- States: Well $W$, Dead $D$ (absorbing).\n- Transition matrix $T_D$:\n$$ T_D = \\begin{pmatrix} 1.00 & 0.00 \\\\ 0.00 & 1.00 \\end{pmatrix} $$\n- Utility weights $u_D$:\n$$ u_D = \\begin{pmatrix} 0.95 \\\\ 0.00 \\end{pmatrix} $$\n- Initial distribution $p_{0,D}$:\n$$ p_{0,D} = \\begin{pmatrix} 1.00 \\\\ 0.00 \\end{pmatrix} $$\n- Annual discount rate $r_D = 0.03$.\n- Cycle length $\\Delta_D = 1.0$ years.\n- Time horizon $Y_D = 10.0$ years.\n\nScenario E (edge case: high discount rate):\n- Same states and transitions as Scenario A.\n- Utility weights $u_E = u_A$.\n- Initial distribution $p_{0,E} = p_{0,A}$.\n- Annual discount rate $r_E = 0.10$.\n- Cycle length $\\Delta_E = 1.0$ years.\n- Time horizon $Y_E = 10.0$ years.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $A,B,C,D,E$. Each element is a float in years rounded to $3$ decimals. For example, a valid output format is `[x_A,x_B,x_C,x_D,x_E]` with each $x_\\cdot$ rounded to $3$ decimals and expressed in years.",
            "solution": "The problem requires the computation of total discounted Quality-Adjusted Life Years (QALYs) using a discrete-time cohort Markov model. The solution is derived from the fundamental principles of Markov processes, health utility, and economic discounting as specified.\n\nA cohort Markov model describes the progression of a group of individuals through a finite set of mutually exclusive health states over a series of discrete time intervals, or cycles.\n\nLet the set of states be $S = \\{s_1, s_2, \\dots, s_m\\}$, where $m$ is the number of states. The proportion of the cohort in each state at the beginning of cycle $k$ (where $k=0, 1, 2, \\dots$) is represented by a state probability row vector $\\boldsymbol{p}_k = [p_{k,1}, p_{k,2}, \\dots, p_{k,m}]$, where $\\sum_{i=1}^{m} p_{k,i} = 1$.\n\nThe model is time-homogeneous, meaning the probabilities of transitioning between states are constant for every cycle. These probabilities are contained in an $m \\times m$ transition matrix $T$, where the element $T_{ij}$ is the probability of moving from state $s_i$ to state $s_j$ in a single cycle. The state vector evolves according to the equation:\n$$\n\\boldsymbol{p}_{k+1} = \\boldsymbol{p}_k T\n$$\nThe state vector at cycle $k$ can be computed from the initial state vector $\\boldsymbol{p}_0$ by:\n$$\n\\boldsymbol{p}_k = \\boldsymbol{p}_0 T^k\n$$\nwhere $T^k$ is the $k$-th power of the matrix $T$.\n\nEach health state $s_i$ is associated with a health-related quality of life weight, or utility, $u_i$, where $u_i \\in [0, 1]$. These are collected in a column vector $\\boldsymbol{u} = [u_1, u_2, \\dots, u_m]^T$. The total expected utility of the cohort at the beginning of cycle $k$ is the dot product of the state vector and the utility vector:\n$$\nU_k = \\boldsymbol{p}_k \\cdot \\boldsymbol{u} = \\sum_{i=1}^{m} p_{k,i} u_i\n$$\nThe problem specifies the use of a half-cycle correction to approximate the continuous accrual of QALYs within a discrete cycle. The QALYs accrued during a cycle are based on the average utility at the start and end of that cycle. For cycle $k$, which spans from time $t_k = k\\Delta$ to $t_{k+1} = (k+1)\\Delta$ where $\\Delta$ is the cycle length in years, the expected utility at the start is $U_k$ and at the end is $U_{k+1} = \\boldsymbol{p}_{k+1} \\cdot \\boldsymbol{u}$.\n\nThe average utility during cycle $k$ is:\n$$\n\\bar{U}_k = \\frac{U_k + U_{k+1}}{2}\n$$\nThe undiscounted QALYs accrued in cycle $k$ is this average utility multiplied by the duration of the cycle:\n$$\nQ_{k, \\text{undiscounted}} = \\bar{U}_k \\Delta = \\left( \\frac{U_k + U_{k+1}}{2} \\right) \\Delta\n$$\nHealth outcomes in the future are valued less than those in the present. This is modeled using an annual discount rate $r$. A health benefit received at time $t$ is discounted by a factor of $(1+r)^{-t}$. The problem specifies that the QALYs accrued during a cycle should be discounted as if they occurred at the midpoint of the cycle. The midpoint of cycle $k$ is at time $t_{k, \\text{mid}} = k\\Delta + \\frac{\\Delta}{2} = (k+0.5)\\Delta$.\n\nThe discount factor for cycle $k$ is therefore:\n$$\nd_k = \\frac{1}{(1+r)^{t_{k, \\text{mid}}}} = (1+r)^{-(k+0.5)\\Delta}\n$$\nThe discounted QALYs for cycle $k$ is the product of the undiscounted QALYs and the discount factor:\n$$\nQ_{k, \\text{discounted}} = Q_{k, \\text{undiscounted}} \\times d_k = \\left( \\frac{(\\boldsymbol{p}_k \\cdot \\boldsymbol{u}) + (\\boldsymbol{p}_{k+1} \\cdot \\boldsymbol{u})}{2} \\right) \\Delta (1+r)^{-(k+0.5)\\Delta}\n$$\nThe total discounted QALYs over a time horizon of $Y$ years is the sum of the discounted QALYs from each cycle. The total number of cycles is $N = Y/\\Delta$. The summation is performed from cycle $k=0$ to $k=N-1$:\n$$\nQ_{\\text{total}} = \\sum_{k=0}^{N-1} Q_{k, \\text{discounted}}\n$$\nSubstituting the full expression, we get the final formula for the calculation:\n$$\nQ_{\\text{total}} = \\sum_{k=0}^{N-1} \\left[ \\left( \\frac{(\\boldsymbol{p}_k \\cdot \\boldsymbol{u}) + ((\\boldsymbol{p}_k T) \\cdot \\boldsymbol{u})}{2} \\right) \\Delta (1+r)^{-(k+0.5)\\Delta} \\right]\n$$\nThis formula is implemented by iterating through each cycle, updating the state probability vector, calculating the utility at the start and end of the cycle, applying the half-cycle correction and discounting, and accumulating the results. The final value for each scenario is rounded to $3$ decimal places.\n\nThe algorithm is as follows:\n1.  For a given scenario, identify the parameters: transition matrix $T$, utility vector $\\boldsymbol{u}$, initial state vector $\\boldsymbol{p}_0$, annual discount rate $r$, cycle length $\\Delta$, and time horizon $Y$.\n2.  Calculate the number of cycles $N = Y/\\Delta$.\n3.  Initialize total discounted QALYs, $Q_{\\text{total}} = 0$.\n4.  Initialize the current state vector $\\boldsymbol{p}_{\\text{current}} = \\boldsymbol{p}_0$.\n5.  Loop for $k$ from $0$ to $N-1$:\n    a. Calculate the state vector at the start of the next cycle: $\\boldsymbol{p}_{\\text{next}} = \\boldsymbol{p}_{\\text{current}} T$.\n    b. Calculate the utility at the start of the current cycle: $U_{\\text{current}} = \\boldsymbol{p}_{\\text{current}} \\cdot \\boldsymbol{u}$.\n    c. Calculate the utility at the end of the current cycle: $U_{\\text{next}} = \\boldsymbol{p}_{\\text{next}} \\cdot \\boldsymbol{u}$.\n    d. Calculate the average utility for the cycle: $\\bar{U} = (U_{\\text{current}} + U_{\\text{next}}) / 2$.\n    e. Calculate the mid-cycle time point: $t_{\\text{mid}} = (k + 0.5)\\Delta$.\n    f. Calculate the discount factor: $d = (1+r)^{-t_{\\text{mid}}}$.\n    g. Calculate the discounted QALYs for the cycle and add to the total: $Q_{\\text{total}} = Q_{\\text{total}} + \\bar{U} \\Delta d$.\n    h. Update the state vector for the next iteration: $\\boldsymbol{p}_{\\text{current}} = \\boldsymbol{p}_{\\text{next}}$.\n6.  After the loop finishes, round $Q_{\\text{total}}$ to $3$ decimal places.\nThis procedure is applied to all five scenarios provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_discounted_qalys(T, u, p0, r, delta, Y):\n    \"\"\"\n    Computes discounted Quality-Adjusted Life Years (QALYs) using a cohort Markov model.\n\n    Args:\n        T (np.ndarray): The state transition probability matrix.\n        u (np.ndarray): The utility vector for the states.\n        p0 (np.ndarray): The initial state probability distribution vector.\n        r (float): The annual discount rate.\n        delta (float): The length of each cycle in years.\n        Y (float): The total time horizon in years.\n\n    Returns:\n        float: The total discounted QALYs.\n    \"\"\"\n    # Ensure all inputs are numpy arrays for consistent matrix operations\n    T = np.asarray(T, dtype=float)\n    u = np.asarray(u, dtype=float)\n    p0 = np.asarray(p0, dtype=float)\n\n    # Calculate the number of cycles\n    num_cycles = int(round(Y / delta))\n\n    total_discounted_qaly = 0.0\n    p_current = p0\n\n    for k in range(num_cycles):\n        # State vector at the end of the cycle\n        p_next = p_current @ T\n\n        # Utility at the start and end of the cycle\n        utility_current = p_current @ u\n        utility_next = p_next @ u\n        \n        # Average utility over the cycle (half-cycle correction)\n        avg_utility = (utility_current + utility_next) / 2.0\n\n        # Undiscounted QALYs for the cycle\n        qaly_k_undiscounted = avg_utility * delta\n\n        # Time at the midpoint of the cycle for discounting\n        mid_cycle_time = (k + 0.5) * delta\n\n        # Discount factor for the cycle\n        discount_factor = 1.0 / ((1.0 + r) ** mid_cycle_time)\n        \n        # Discounted QALYs for the cycle\n        qaly_k_discounted = qaly_k_undiscounted * discount_factor\n        \n        # Add to the total\n        total_discounted_qaly += qaly_k_discounted\n\n        # Update the state vector for the next iteration\n        p_current = p_next\n        \n    return total_discounted_qaly\n\ndef solve():\n    \"\"\"\n    Defines test cases, computes QALYs for each, and prints the results.\n    \"\"\"\n    # Scenario A\n    T_A = [[0.88, 0.08, 0.04], [0.10, 0.80, 0.10], [0.00, 0.00, 1.00]]\n    u_A = [0.92, 0.65, 0.00]\n    p0_A = [1.00, 0.00, 0.00]\n    r_A = 0.03\n    delta_A = 1.0\n    Y_A = 10.0\n\n    # Scenario B\n    T_B = T_A\n    u_B = u_A\n    p0_B = p0_A\n    r_B = 0.00\n    delta_B = 1.0\n    Y_B = 10.0\n\n    # Scenario C\n    T_C = [[0.70, 0.25, 0.05], [0.00, 0.85, 0.15], [0.00, 0.00, 1.00]]\n    u_C = [0.80, 0.50, 0.00]\n    p0_C = [1.00, 0.00, 0.00]\n    r_C = 0.03\n    delta_C = 0.5\n    Y_C = 3.0\n\n    # Scenario D\n    T_D = [[1.00, 0.00], [0.00, 1.00]]\n    u_D = [0.95, 0.00]\n    p0_D = [1.00, 0.00]\n    r_D = 0.03\n    delta_D = 1.0\n    Y_D = 10.0\n\n    # Scenario E\n    T_E = T_A\n    u_E = u_A\n    p0_E = p0_A\n    r_E = 0.10\n    delta_E = 1.0\n    Y_E = 10.0\n\n    test_cases = [\n        (T_A, u_A, p0_A, r_A, delta_A, Y_A),\n        (T_B, u_B, p0_B, r_B, delta_B, Y_B),\n        (T_C, u_C, p0_C, r_C, delta_C, Y_C),\n        (T_D, u_D, p0_D, r_D, delta_D, Y_D),\n        (T_E, u_E, p0_E, r_E, delta_E, Y_E),\n    ]\n\n    results = []\n    for case in test_cases:\n        T, u, p0, r, delta, Y = case\n        result = compute_discounted_qalys(T, u, p0, r, delta, Y)\n        results.append(result)\n\n    # Format the final output string as a list of numbers rounded to 3 decimal places.\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}