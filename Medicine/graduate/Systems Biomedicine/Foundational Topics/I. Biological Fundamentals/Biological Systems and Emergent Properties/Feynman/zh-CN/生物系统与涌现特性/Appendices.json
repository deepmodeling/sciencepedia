{
    "hands_on_practices": [
        {
            "introduction": "双稳态是生物系统中的一个关键涌现特性，它赋予细胞在响应信号时做出“全或无”决策的能力。这个练习将指导你通过对一个经典的基因“拨动开关”模型进行严格的数学分析，从第一性原理出发，推导出产生双稳态所需的参数条件。通过这个过程，你将深入理解非线性动力学和协同相互作用是如何共同催生出这种重要的细胞行为的 。",
            "id": "4320312",
            "problem": "考虑一个对称的双基因触发开关，其中每个基因通过希尔型（Hill-type）结合来抑制另一个基因，其抑制函数为 $f(x) = \\frac{1}{1 + \\left(\\frac{x}{K}\\right)^{n}}$。令 $x(t)$ 和 $y(t)$ 表示两种基因产物的浓度。其动力学由以下常微分方程组（ODEs）建模\n$$\n\\frac{dx}{dt} = \\beta\\,f(y) - \\gamma\\,x,\\quad \\frac{dy}{dt} = \\beta\\,f(x) - \\gamma\\,y,\n$$\n其中 $\\beta > 0$ 是最大生产速率，$\\gamma > 0$ 是一阶降解速率。引入无量纲参数 $\\,\\alpha = \\frac{\\beta}{\\gamma}\\,$ 并通过 $\\tau = \\gamma t$ 对时间进行重新标度，得到无量纲系统\n$$\n\\frac{dx}{d\\tau} = \\alpha\\,f(y) - x,\\quad \\frac{dy}{d\\tau} = \\alpha\\,f(x) - y.\n$$\n从平衡和线性稳定性的定义出发，仅使用第一性原理（零斜线的存在性和基于雅可比矩阵的局部稳定性），推导在线 $x = y$ 上的对称平衡点失去稳定性且系统呈现两个不同稳定平衡点（双稳态）的条件。对于固定的 $\\alpha > 0$，确定分岔边界 $K_{\\mathrm{crit}}(n)$ 关于 $\\alpha$ 和 $n$ 的精确闭式解析表达式，该边界将对称触发开关的单稳态区域（一个稳定平衡点）与双稳态区域（两个稳定平衡点）分开。你的推导必须从平衡条件和对称平衡点处的雅可比特征值开始，且不得假设任何预先推导出的分岔公式。用与 $x$ 和 $y$ 相同的浓度单位表示你的最终边界 $K_{\\mathrm{crit}}(n)$。不需要进行数值近似或四舍五入。最终答案必须是单一的闭式表达式。",
            "solution": "用户提供的问题经过了严格验证，确认其科学基础扎实、问题设定良好且客观。没有发现任何可识别的缺陷。该问题是动力系统稳定性分析中的一个标准练习，应用于系统生物学中的一个典型模型。所有必要的定义和参数都已提供，任务是从第一性原理出发推导一个特定的解析结果。\n\n求解过程如下。\n\n系统的动力学由以下无量纲常微分方程组（ODEs）描述：\n$$\n\\frac{dx}{d\\tau} = \\alpha\\,f(y) - x\n$$\n$$\n\\frac{dy}{d\\tau} = \\alpha\\,f(x) - y\n$$\n其中 $f(z) = \\frac{1}{1 + \\left(\\frac{z}{K}\\right)^{n}}$。\n\n系统的平衡点或不动点 $(x^*, y^*)$ 是时间导数为零的点。这要求：\n$$\nx^* = \\alpha\\,f(y^*)\n$$\n$$\ny^* = \\alpha\\,f(x^*)\n$$\n问题要求分析位于直线 $x = y$ 上的对称平衡点。设该平衡点为 $(x_s^*, x_s^*)$，其中 $x_s^*$ 满足方程：\n$$\nx_s^* = \\alpha\\,f(x_s^*) = \\frac{\\alpha}{1 + \\left(\\frac{x_s^*}{K}\\right)^{n}}\n$$\n为了确定该平衡点的稳定性，我们进行线性稳定性分析。这涉及计算系统的雅可比矩阵 $J$，该矩阵是常微分方程右侧函数的偏导数矩阵。令 $F(x, y) = \\alpha\\,f(y) - x$ 和 $G(x, y) = \\alpha\\,f(x) - y$。雅可比矩阵为：\n$$\nJ(x, y) = \\begin{pmatrix} \\frac{\\partial F}{\\partial x}  \\frac{\\partial F}{\\partial y} \\\\ \\frac{\\partial G}{\\partial x}  \\frac{\\partial G}{\\partial y} \\end{pmatrix} = \\begin{pmatrix} -1  \\alpha\\,f'(y) \\\\ \\alpha\\,f'(x)  -1 \\end{pmatrix}\n$$\n我们需要希尔函数的导数 $f'(z)$：\n$$\nf'(z) = \\frac{d}{dz}\\left(1 + \\left(\\frac{z}{K}\\right)^{n}\\right)^{-1} = -\\left(1 + \\left(\\frac{z}{K}\\right)^{n}\\right)^{-2} \\cdot n\\left(\\frac{z}{K}\\right)^{n-1} \\cdot \\frac{1}{K} = -\\frac{n}{K} \\frac{\\left(\\frac{z}{K}\\right)^{n-1}}{\\left(1 + \\left(\\frac{z}{K}\\right)^{n}\\right)^2}\n$$\n注意，对于具有物理意义的参数（$z>0, K>0, n>0$），$f'(z)$ 总是负的。\n\n我们在对称平衡点 $(x_s^*, x_s^*)$ 处计算雅可比矩阵：\n$$\nJ(x_s^*, x_s^*) = \\begin{pmatrix} -1  \\alpha\\,f'(x_s^*) \\\\ \\alpha\\,f'(x_s^*)  -1 \\end{pmatrix}\n$$\n平衡点的稳定性由该矩阵的特征值 $\\lambda$ 决定。特征值是特征方程 $\\det(J - \\lambda I) = 0$ 的根：\n$$\n\\det\\begin{pmatrix} -1-\\lambda  \\alpha\\,f'(x_s^*) \\\\ \\alpha\\,f'(x_s^*)  -1-\\lambda \\end{pmatrix} = 0\n$$\n$$\n(-1-\\lambda)^2 - (\\alpha\\,f'(x_s^*))^2 = 0\n$$\n$$\n(1+\\lambda)^2 = (\\alpha\\,f'(x_s^*))^2\n$$\n$$\n1+\\lambda = \\pm \\alpha\\,f'(x_s^*)\n$$\n这给出了两个实数特征值：\n$$\n\\lambda_1 = -1 + \\alpha\\,f'(x_s^*)\n$$\n$$\n\\lambda_2 = -1 - \\alpha\\,f'(x_s^*)\n$$\n对称平衡点是稳定的，当且仅当两个特征值都为负。\n因为 $\\alpha > 0$ 且 $f'(x_s^*)  0$，第一个特征值 $\\lambda_1 = -1 + \\alpha f'(x_s^*)$ 总是负的。\n因此，稳定性完全由 $\\lambda_2$ 的符号决定。如果 $\\lambda_2  0$，则平衡点稳定；如果 $\\lambda_2 > 0$，则不稳定。\n稳定性的条件是：\n$\\lambda_2 = -1 - \\alpha\\,f'(x_s^*)  0 \\implies -1  \\alpha\\,f'(x_s^*)$\n系统通过一个叉式分岔（pitchfork bifurcation），从拥有一个稳定的对称平衡点（单稳态）过渡到拥有两个新的稳定非对称平衡点和一个不稳定的对称平衡点（双稳态）。这个分岔恰好发生在对称平衡点失去稳定性的时候，即当 $\\lambda_2=0$ 时。\n因此，分岔条件是：\n$$\n\\lambda_2 = -1 - \\alpha\\,f'(x_s^*) = 0 \\implies \\alpha\\,f'(x_s^*) = -1\n$$\n为了找到分岔边界 $K_{\\mathrm{crit}}(n)$，我们必须找到参数值，使得存在一个不动点 $x_s^*$ 同时满足平衡条件和分岔条件。这给出了一个关于两个未知数 $x_s^*$ 和 $K$ 的方程组：\n$$\n(1) \\quad x_s^* = \\frac{\\alpha}{1 + (x_s^*/K)^n}\n$$\n$$\n(2) \\quad \\alpha \\left( -\\frac{n}{K} \\frac{(x_s^*/K)^{n-1}}{(1 + (x_s^*/K)^n)^2} \\right) = -1 \\implies \\frac{\\alpha n}{K} \\frac{(x_s^*/K)^{n-1}}{(1 + (x_s^*/K)^n)^2} = 1\n$$\n我们可以解这个方程组。从方程（1），我们可以将方程（2）的分母用更简单的形式表示：\n$$\n1 + \\left(\\frac{x_s^*}{K}\\right)^n = \\frac{\\alpha}{x_s^*}\n$$\n将此代入方程（2）：\n$$\n\\frac{\\alpha n}{K} \\frac{(x_s^*/K)^{n-1}}{(\\alpha/x_s^*)^2} = 1\n$$\n$$\n\\frac{\\alpha n}{K} \\frac{x_s^{*(n-1)}}{K^{n-1}} \\frac{x_s^{*2}}{\\alpha^2} = 1\n$$\n$$\n\\frac{n x_s^{*(n-1+2)}}{\\alpha K^{1+n-1}} = 1 \\implies \\frac{n x_s^{*(n+1)}}{\\alpha K^n} = 1\n$$\n求解 $x_s^*$：\n$$\nx_s^{*(n+1)} = \\frac{\\alpha K^n}{n} \\implies x_s^* = \\left(\\frac{\\alpha K^n}{n}\\right)^{\\frac{1}{n+1}}\n$$\n该表达式给出了分岔发生时刻对称不动点处的浓度。现在，我们将其代回平衡条件，即方程（1），以找到边界上参数 $K$、$\\alpha$ 和 $n$ 之间的关系。重新整理方程（1）得到 $x_s^*(1 + (x_s^*/K)^n) = \\alpha$。代入我们关于 $x_s^*$ 的表达式：\n$$\n\\left(\\frac{\\alpha K^n}{n}\\right)^{\\frac{1}{n+1}} \\left( 1 + \\frac{1}{K^n} \\left[ \\left(\\frac{\\alpha K^n}{n}\\right)^{\\frac{1}{n+1}} \\right]^n \\right) = \\alpha\n$$\n$$\n\\left(\\frac{\\alpha K^n}{n}\\right)^{\\frac{1}{n+1}} \\left( 1 + \\frac{1}{K^n} \\left(\\frac{\\alpha K^n}{n}\\right)^{\\frac{n}{n+1}} \\right) = \\alpha\n$$\n让我们简化括号内的项：\n$$\n1 + \\frac{1}{K^n} \\frac{\\alpha^{\\frac{n}{n+1}} K^{\\frac{n^2}{n+1}}}{n^{\\frac{n}{n+1}}} = 1 + \\frac{\\alpha^{\\frac{n}{n+1}} K^{\\frac{n^2}{n+1}-n}}{n^{\\frac{n}{n+1}}} = 1 + \\frac{\\alpha^{\\frac{n}{n+1}} K^{-\\frac{n}{n+1}}}{n^{\\frac{n}{n+1}}}\n$$\n将此代回主方程：\n$$\n\\frac{\\alpha^{\\frac{1}{n+1}} K^{\\frac{n}{n+1}}}{n^{\\frac{1}{n+1}}} \\left( 1 + \\frac{\\alpha^{\\frac{n}{n+1}}}{n^{\\frac{n}{n+1}} K^{\\frac{n}{n+1}}} \\right) = \\alpha\n$$\n将左边的项展开：\n$$\n\\frac{\\alpha^{\\frac{1}{n+1}} K^{\\frac{n}{n+1}}}{n^{\\frac{1}{n+1}}} + \\frac{\\alpha^{\\frac{1}{n+1}} K^{\\frac{n}{n+1}}}{n^{\\frac{1}{n+1}}} \\cdot \\frac{\\alpha^{\\frac{n}{n+1}}}{n^{\\frac{n}{n+1}} K^{\\frac{n}{n+1}}} = \\alpha\n$$\n$$\n\\frac{\\alpha^{\\frac{1}{n+1}} K^{\\frac{n}{n+1}}}{n^{\\frac{1}{n+1}}} + \\frac{\\alpha^{\\frac{1}{n+1}+\\frac{n}{n+1}}}{n^{\\frac{1}{n+1}+\\frac{n}{n+1}}} = \\alpha\n$$\n$$\n\\frac{\\alpha^{\\frac{1}{n+1}} K^{\\frac{n}{n+1}}}{n^{\\frac{1}{n+1}}} + \\frac{\\alpha}{n} = \\alpha\n$$\n现在，我们分离出包含 $K$ 的项：\n$$\n\\frac{\\alpha^{\\frac{1}{n+1}} K^{\\frac{n}{n+1}}}{n^{\\frac{1}{n+1}}} = \\alpha - \\frac{\\alpha}{n} = \\alpha \\left(1 - \\frac{1}{n}\\right) = \\alpha \\frac{n-1}{n}\n$$\n为了解出 $K$，我们首先将其他因子移到右边：\n$$\nK^{\\frac{n}{n+1}} = \\frac{n-1}{n} \\cdot \\alpha \\cdot \\frac{n^{\\frac{1}{n+1}}}{\\alpha^{\\frac{1}{n+1}}} = \\frac{n-1}{n} \\cdot n^{\\frac{1}{n+1}} \\cdot \\alpha^{1-\\frac{1}{n+1}} = \\frac{n-1}{n} \\cdot n^{\\frac{1}{n+1}} \\cdot \\alpha^{\\frac{n}{n+1}}\n$$\n最后，我们将两边都取 $\\frac{n+1}{n}$ 次方来解出 $K$，即 $K_{\\mathrm{crit}}$：\n$$\nK_{\\mathrm{crit}}(n) = \\left( \\frac{n-1}{n} \\cdot n^{\\frac{1}{n+1}} \\cdot \\alpha^{\\frac{n}{n+1}} \\right)^{\\frac{n+1}{n}}\n$$\n$$\nK_{\\mathrm{crit}}(n) = \\left(\\frac{n-1}{n}\\right)^{\\frac{n+1}{n}} \\cdot (n^{\\frac{1}{n+1}})^{\\frac{n+1}{n}} \\cdot (\\alpha^{\\frac{n}{n+1}})^{\\frac{n+1}{n}}\n$$\n$$\nK_{\\mathrm{crit}}(n) = \\left(\\frac{n-1}{n}\\right)^{\\frac{n+1}{n}} \\cdot n^{\\frac{1}{n}} \\cdot \\alpha\n$$\n该表达式可以进一步简化：\n$$\nK_{\\mathrm{crit}}(n) = \\alpha \\cdot n^{\\frac{1}{n}} \\cdot (n-1)^{\\frac{n+1}{n}} \\cdot n^{-\\frac{n+1}{n}} = \\alpha \\cdot (n-1)^{\\frac{n+1}{n}} \\cdot n^{\\frac{1}{n} - \\frac{n+1}{n}}\n$$\n$$\nK_{\\mathrm{crit}}(n) = \\alpha \\cdot (n-1)^{\\frac{n+1}{n}} \\cdot n^{\\frac{1-n-1}{n}} = \\alpha \\cdot (n-1)^{\\frac{n+1}{n}} \\cdot n^{-1}\n$$\n这给出了分岔边界的最终闭式解析表达式：\n$$\nK_{\\mathrm{crit}}(n) = \\frac{\\alpha}{n} (n-1)^{\\frac{n+1}{n}}\n$$\n这个边界将单稳态和双稳态区域分开。注意，为使该表达式为正实数，我们必须有 $n1$，这是触发开关中双稳态的众所周知的条件（即需要一定程度的协同性）。",
            "answer": "$$\\boxed{\\frac{\\alpha}{n} (n-1)^{\\frac{n+1}{n}}}$$"
        },
        {
            "introduction": "理解了双稳态的理论基础后，一个自然的问题是它在动态变化的环境中如何表现。迟滞现象，即系统状态对其历史的依赖性，是双稳态的一个直接功能性后果，赋予了细胞“记忆”能力。这个计算练习将让你模拟一个具有正反馈的信号模块在缓慢变化的刺激下的响应，通过编程计算并可视化迟滞回环，从而将抽象的数学概念与可量化的系统行为联系起来 。",
            "id": "4320335",
            "problem": "考虑一个表现出正反馈和饱和非线性的最小、充分混合的信号模块，该模块被建模为单个动力学变量 $x(t)$，代表活化信号效应子的浓度。该模块接收一个随时间缓慢变化（扫描）的外部刺激 $S(t)$。$x(t)$ 的时间演化由以下常微分方程给出：\n$$\n\\frac{dx}{dt} \\;=\\; v_{\\mathrm{basal}} \\;+\\; v_{\\mathrm{act}}(S(t), x(t)) \\;-\\; v_{\\mathrm{deg}}(x(t)),\n$$\n其中 $v_{\\mathrm{basal}}$ 是一个恒定的基础生成速率，$v_{\\mathrm{act}}(S, x)$ 是一个激活项，其对 $S$ 具有饱和依赖性，并在 $x$ 中具有协同正反馈，$v_{\\mathrm{deg}}(x)$ 是一个饱和降解项。基于酶饱和和协同结合的原理，使用 Michaelis–Menten 和 Hill 型函数对这些项进行建模：\n$$\nv_{\\mathrm{act}}(S, x) \\;=\\; k_{\\mathrm{act}} \\cdot \\frac{S}{K_S + S} \\cdot \\frac{x^n}{K_{\\mathrm{fb}}^n + x^n}, \\quad\nv_{\\mathrm{deg}}(x) \\;=\\; k_{\\mathrm{deg}} \\cdot \\frac{x}{K_{\\mathrm{deg}} + x}.\n$$\n假设刺激 $S(t)$ 以一个小的正速率 $r$ 从 $S_{\\min}$ 线性扫描到 $S_{\\max}$（“上扫”），\n$$\nS_{\\uparrow}(t) \\;=\\; S_{\\min} + r\\,t, \\quad t \\in [0, T_{\\uparrow}], \\quad T_{\\uparrow} = \\frac{S_{\\max} - S_{\\min}}{r},\n$$\n然后以相同的速率大小从 $S_{\\max}$ 扫回到 $S_{\\min}$（“下扫”），\n$$\nS_{\\downarrow}(t) \\;=\\; S_{\\max} - r\\,t, \\quad t \\in [0, T_{\\downarrow}], \\quad T_{\\downarrow} = \\frac{S_{\\max} - S_{\\min}}{r}.\n$$\n为探究由饱和引起的非线性和正反馈所产生的迟滞现象，将“迟滞回线”定义为函数对 $x_{\\uparrow}(S)$ 和 $x_{\\downarrow}(S)$，它们分别通过在上扫和下扫期间积分上述动力学方程，并在扫描轨迹上对应相同的 $S$ 值时采样 $x(t)$ 获得。通过这两条曲线之间的面积来量化迟滞，\n$$\n\\mathcal{A} \\;=\\; \\int_{S_{\\min}}^{S_{\\max}} \\left| x_{\\uparrow}(S) - x_{\\downarrow}(S) \\right| \\, dS,\n$$\n该面积通过在指定的 $S$ 值网格上使用梯形法则进行数值计算。定义一个迟滞指示器为布尔值 $\\mathsf{H} = (\\mathcal{A} > \\varepsilon)$，其中 $\\varepsilon$ 是一个很小的阈值。\n\n实现一个程序，该程序：\n- 从初始条件 $x(0) = x_0$ 和 $S_{\\uparrow}(t)$ 开始积分上扫动力学，然后从上扫的最终状态和 $S_{\\downarrow}(t)$ 开始积分下扫动力学。\n- 在一个包含 $N$ 个点的均匀 $S$ 网格上采样 $x_{\\uparrow}(S)$ 和 $x_{\\downarrow}(S)$，通过梯形法则计算 $\\mathcal{A}$，并基于阈值 $\\varepsilon$ 设置 $\\mathsf{H}$。\n- 使用一个适用于慢扫描和潜在剧烈转变的刚性求解器和容差。\n\n除非另有说明，所有运行均使用以下固定的数值规格：\n- 初始条件: $x_0 = 0.01$。\n- 在 $[S_{\\min}, S_{\\max}]$ 范围内均匀分布的 $N = 201$ 个 $S$ 点。\n- 阈值: $\\varepsilon = 10^{-3}$。\n- 求解器绝对容差 $10^{-10}$，相对容差 $10^{-8}$。\n- 使用刚性求解器方法。\n\n测试套件：\n对于下面的每个参数集，运行模拟并报告迟滞面积 $\\mathcal{A}$（浮点数）和迟滞指示器 $\\mathsf{H}$（布尔值）。\n\n- 情况 1（预期的双稳态/迟滞）：\n  - $v_{\\mathrm{basal}} = 0.05$\n  - $k_{\\mathrm{act}} = 2.5$\n  - $K_S = 0.3$\n  - $K_{\\mathrm{fb}} = 0.4$\n  - $n = 4$\n  - $k_{\\mathrm{deg}} = 3.0$\n  - $K_{\\mathrm{deg}} = 0.2$\n  - $S_{\\min} = 0.0$\n  - $S_{\\max} = 2.0$\n  - $r = 5 \\times 10^{-3}$\n\n- 情况 2（接近阈值，弱迟滞）：\n  - $v_{\\mathrm{basal}} = 0.05$\n  - $k_{\\mathrm{act}} = 1.5$\n  - $K_S = 0.3$\n  - $K_{\\mathrm{fb}} = 0.7$\n  - $n = 3$\n  - $k_{\\mathrm{deg}} = 3.0$\n  - $K_{\\mathrm{deg}} = 0.25$\n  - $S_{\\min} = 0.0$\n  - $S_{\\max} = 2.0$\n  - $r = 5 \\times 10^{-3}$\n\n- 情况 3（单稳态，无迟滞）：\n  - $v_{\\mathrm{basal}} = 0.05$\n  - $k_{\\mathrm{act}} = 0.8$\n  - $K_S = 0.3$\n  - $K_{\\mathrm{fb}} = 3.0$\n  - $n = 1$\n  - $k_{\\mathrm{deg}} = 3.0$\n  - $K_{\\mathrm{deg}} = 0.4$\n  - $S_{\\min} = 0.0$\n  - $S_{\\max} = 2.0$\n  - $r = 5 \\times 10^{-3}$\n\n最终输出格式：\n你的程序应生成单行输出，其中包含三个情况的结果，格式为逗号分隔的 Python 风格列表，列表中包含成对的 $[\\mathcal{A}, \\mathsf{H}]$，顺序与上述情况指定的一致。例如，输出应如下所示：\n`[[A_1,H_1],[A_2,H_2],[A_3,H_3]]`\n其中每个 $A_i$ 是一个浮点数，每个 $H_i$ 是 `True` 或 `False`。由于这些量是通过构造而无量纲的，因此输出中不需要单位。",
            "solution": "该问题要求对一个由单个常微分方程（ODE）描述的极简生物信号模块中的迟滞现象进行分析。该分析涉及在缓慢变化的外部刺激下对系统动力学进行数值积分，然后量化所产生的迟滞回线面积。\n\n系统状态的时间演化由活化信号效应子浓度 $x(t)$ 表示，并由以下 ODE 控制：\n$$\n\\frac{dx}{dt} \\;=\\; f(t, x) \\;=\\; v_{\\mathrm{basal}} \\;+\\; v_{\\mathrm{act}}(S(t), x(t)) \\;-\\; v_{\\mathrm{deg}}(x(t))\n$$\n该方程平衡了 $x$ 的变化率与三个过程：\n1.  一个恒定的基础生成速率，$v_{\\mathrm{basal}}$。\n2.  一个激活速率，$v_{\\mathrm{act}}(S, x)$，它既依赖于外部刺激 $S$，也依赖于浓度 $x$ 本身。该项模拟了一个正反馈回路。\n3.  一个降解速率，$v_{\\mathrm{deg}}(x)$。\n\n激活和降解速率的具体函数形式由标准的生物化学动力学模型给出：\n$$\nv_{\\mathrm{act}}(S, x) \\;=\\; k_{\\mathrm{act}} \\cdot \\frac{S}{K_S + S} \\cdot \\frac{x^n}{K_{\\mathrm{fb}}^n + x^n}\n$$\n$$\nv_{\\mathrm{deg}}(x) \\;=\\; k_{\\mathrm{deg}} \\cdot \\frac{x}{K_{\\mathrm{deg}} + x}\n$$\n激活项包含了两种饱和现象：对刺激 $S$ 的依赖性遵循一种类 Michaelis–Menten 形式，而对 $x$ 的正反馈则由一个具有 Hill 系数 $n$ 的协同 Hill 函数描述。降解项也遵循一种类 Michaelis–Menten 饱和动力学。非线性正反馈和饱和的组合是在生物系统中产生双稳态的常见基序。\n\n双稳态，即系统在同一组外部条件下可以存在于两个不同稳定状态的能力，可以通过观察迟滞现象来揭示。迟滞是系统状态对其历史的依赖性。在此背景下，我们通过将刺激 $S$ 从低值 $S_{\\min}$ 缓慢扫描到高值 $S_{\\max}$，然后再扫回来，来探测迟滞现象。如果系统是双稳态的，那么 $x$ 在上扫过程中的轨迹 $x_{\\uparrow}(S)$ 将不同于其在下扫过程中的轨迹 $x_{\\downarrow}(S)$。\n\n量化此现象的数值步骤如下：\n1.  **离散化刺激域**：在区间 $[S_{\\min}, S_{\\max}]$ 上为刺激 $S$ 定义一个包含 $N$ 个点的均匀网格。\n2.  **上扫模拟**：在时间区间 $t \\in [0, T_{\\uparrow}]$ 上对控制 ODE 进行积分，其中 $T_{\\uparrow} = (S_{\\max} - S_{\\min})/r$。刺激定义为 $S_{\\uparrow}(t) = S_{\\min} + rt$。积分从初始条件 $x(0) = x_0$ 开始。使用一个能够处理刚性问题的数值求解器（例如后向差分公式 (BDF) 方法）来求解 ODE，该方法适用于可能包含快慢动态的系统，尤其是在分岔点附近。在与预定义的 $S$ 网格相对应的时间点上评估解 $x(t)$，从而得到轨迹 $x_{\\uparrow}(S)$。\n3.  **下扫模拟**：从上扫的最终状态 $x(T_{\\uparrow})$ 开始，再次在相同持续时间的时间区间 $t \\in [0, T_{\\downarrow}]$ 上对 ODE 进行积分。此时，刺激根据 $S_{\\downarrow}(t) = S_{\\max} - rt$ 向下扫描。同样，在与相同的 $S$ 网格相对应的时间点上评估解 $x(t)$，从而得到轨迹 $x_{\\downarrow}(S)$。\n4.  **迟滞面积计算**：由两条轨迹所包围的面积 $\\mathcal{A}$ 是迟滞的定量度量。通过在刺激范围内对上扫和下扫曲线之间的绝对差进行数值积分来计算：\n    $$\n    \\mathcal{A} \\;=\\; \\int_{S_{\\min}}^{S_{\\max}} \\left| x_{\\uparrow}(S) - x_{\\downarrow}(S) \\right| \\, dS\n    $$\n    该积分在离散化网格上使用梯形法则计算。\n5.  **迟滞指示器**：定义一个布尔指示器 $\\mathsf{H}$，用于根据计算出的面积 $\\mathcal{A}$ 是否超过一个小的预定义阈值 $\\varepsilon$ 来将系统分类为迟滞或非迟滞。$\\mathsf{H} = (\\mathcal{A}  \\varepsilon)$。\n\n这整个过程针对三个不同的参数集实施，这三个参数集分别设计用于展现强迟滞、弱迟滞和无迟滞，从而测试模型在不同动态区域下的行为。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to run simulations for all test cases and print results.\n    \"\"\"\n    # Fixed numerical specifications\n    x0 = 0.01\n    N = 201\n    epsilon = 1e-3\n    atol = 1e-10\n    rtol = 1e-8\n    solver_method = 'BDF'\n\n    # Test cases defined in the problem statement\n    test_cases = [\n        # Case 1 (expected bistability/hysteresis)\n        {\n            \"v_basal\": 0.05, \"k_act\": 2.5, \"K_S\": 0.3, \"K_fb\": 0.4, \"n\": 4,\n            \"k_deg\": 3.0, \"K_deg\": 0.2, \"S_min\": 0.0, \"S_max\": 2.0, \"r\": 5e-3\n        },\n        # Case 2 (near-threshold, weak hysteresis)\n        {\n            \"v_basal\": 0.05, \"k_act\": 1.5, \"K_S\": 0.3, \"K_fb\": 0.7, \"n\": 3,\n            \"k_deg\": 3.0, \"K_deg\": 0.25, \"S_min\": 0.0, \"S_max\": 2.0, \"r\": 5e-3\n        },\n        # Case 3 (monostable, no hysteresis)\n        {\n            \"v_basal\": 0.05, \"k_act\": 0.8, \"K_S\": 0.3, \"K_fb\": 3.0, \"n\": 1,\n            \"k_deg\": 3.0, \"K_deg\": 0.4, \"S_min\": 0.0, \"S_max\": 2.0, \"r\": 5e-3\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        result = run_simulation(params, x0, N, epsilon, atol, rtol, solver_method)\n        results.append(result)\n        \n    # Format the output as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef ode_system(t, x, params, sweep_direction):\n    \"\"\"\n    Defines the right-hand side of the ODE system.\n    dx/dt = f(t, x)\n    \"\"\"\n    x_val = x[0]\n    \n    # Unpack parameters\n    v_basal = params[\"v_basal\"]\n    k_act = params[\"k_act\"]\n    K_S = params[\"K_S\"]\n    K_fb = params[\"K_fb\"]\n    n = params[\"n\"]\n    k_deg = params[\"k_deg\"]\n    K_deg = params[\"K_deg\"]\n    S_min = params[\"S_min\"]\n    S_max = params[\"S_max\"]\n    r = params[\"r\"]\n\n    # Calculate stimulus S(t) based on sweep direction\n    if sweep_direction == 'up':\n        S = S_min + r * t\n    else:  # 'down'\n        S = S_max - r * t\n    \n    # Clamp S to its defined range to avoid floating point inaccuracies near boundaries\n    S = np.clip(S, S_min, S_max)\n    \n    # Calculate rate terms\n    v_act = k_act * (S / (K_S + S)) * (x_val**n / (K_fb**n + x_val**n))\n    v_deg = k_deg * (x_val / (K_deg + x_val))\n    \n    # Return the derivative\n    return [v_basal + v_act - v_deg]\n\ndef run_simulation(params, x0, N, epsilon, atol, rtol, method):\n    \"\"\"\n    Performs the up-sweep and down-sweep simulations for a given set of parameters.\n    \"\"\"\n    S_min = params[\"S_min\"]\n    S_max = params[\"S_max\"]\n    r = params[\"r\"]\n    \n    # Define stimulus grid and time intervals\n    S_grid = np.linspace(S_min, S_max, N)\n    T_sweep = (S_max - S_min) / r\n    t_span = (0, T_sweep)\n\n    # --- Up-sweep simulation ---\n    # `t_eval` points are chosen to correspond to the uniform `S_grid`\n    t_eval_up = (S_grid - S_min) / r\n    sol_up = solve_ivp(\n        ode_system, t_span, [x0],\n        method=method,\n        t_eval=t_eval_up,\n        rtol=rtol, atol=atol,\n        args=(params, 'up')\n    )\n    x_up = sol_up.y[0]\n    \n    # Initial condition for down-sweep is the final state of up-sweep\n    x0_down = x_up[-1]\n\n    # --- Down-sweep simulation ---\n    # `t_eval` must be sorted, so we evaluate at times corresponding to\n    # S from S_max down to S_min, which means t from 0 to T_sweep.\n    # We use a reversed S_grid to generate a sorted t_eval array.\n    S_grid_rev = S_grid[::-1]\n    t_eval_down = (S_max - S_grid_rev) / r\n    sol_down = solve_ivp(\n        ode_system, t_span, [x0_down],\n        method=method,\n        t_eval=t_eval_down,\n        rtol=rtol, atol=atol,\n        args=(params, 'down')\n    )\n    # The solution `sol_down.y` corresponds to `S_grid_rev` (S decreasing).\n    # We reverse it to align with `S_grid` (S increasing).\n    x_down = sol_down.y[0][::-1]\n\n    # --- Hysteresis analysis ---\n    # Calculate area using the trapezoidal rule\n    area = np.trapz(np.abs(x_up - x_down), x=S_grid)\n\n    # Determine hysteresis indicator\n    is_hysteretic = area > epsilon\n    \n    return [area, is_hysteretic]\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "涌现特性不仅源于动态相互作用，也可以来自于网络结构施加的化学计量约束。这个练习将介绍一种完全不同的建模范式——流平衡分析（FBA），它是系统生物学中用于研究代谢网络的强大工具。你将为一个简化的代谢网络建立一个线性规划模型，以计算在满足所有化学计量和容量约束的前提下的最大生长速率，亲身体验细胞层面的整体目标（如生长）是如何从局部反应规则中涌现的 。",
            "id": "4320281",
            "problem": "要求您实现一个流平衡分析（Flux Balance Analysis, FBA）的计算模型，用于一个粗粒度代谢网络，以在化学计量和容量约束下计算涌现的生长速率。从稳态质量守恒原理开始：内源代谢物池不累积，因此净生产速率等于净消耗速率。形式上，给定一个化学计量矩阵 $S$ 和一个通量向量 $v$，质量平衡约束由 $S v = 0$ 给出。由于环境和酶容量的限制，每个反应 $j$ 都有一个通量边界 $l_j \\le v_j \\le u_j$。涌现的生长速率由通过生物质合成反应的最优通量表示，该反应消耗前体和能量货币代谢物，并通过在 $S v = 0$ 和边界约束下最大化生物质通量来计算。该优化问题是一个线性规划问题。\n\n考虑以下粗粒度网络，其中包含内源代谢物 $G$（葡萄糖）、$P$（前体）和 $E$（能量货币），以及在化学计量矩阵 $S$ 中定义为列的 $5$ 个反应：\n- 反应 $1$ ($v_1$)：从环境摄取葡萄糖到细胞内，对 $G$ 的平衡贡献为 $+1$。\n- 反应 $2$ ($v_2$)：将葡萄糖转化为能量的分解代谢，对 $G$ 的贡献为 $-1$，对 $E$ 的贡献为 $+2$。\n- 反应 $3$ ($v_3$)：由葡萄糖合成前体，对 $G$ 的贡献为 $-1$，对 $P$ 的贡献为 $+1$。\n- 反应 $4$ ($v_4$)：消耗前体和能量形成生物质，对 $P$ 的贡献为 $-1$，对 $E$ 的贡献为 $-1$；该通量 $v_4$ 是待最大化的量，即以 $h^{-1}$ 为单位的涌现生长速率。\n- 反应 $5$ ($v_5$)：消耗能量的非生长相关维持，对 $E$ 的贡献为 $-1$。\n\n化学计量矩阵 $S \\in \\mathbb{R}^{3 \\times 5}$ 为\n$$\nS = \\begin{bmatrix}\n1  -1  -1  0  0 \\\\\n0  0  1  -1  0 \\\\\n0  2  0  -1  -1\n\\end{bmatrix}.\n$$\n稳态约束为 $S v = 0$，并且优化问题在通量边界 $l_j \\le v_j \\le u_j$ 的约束下最大化 $v_4$：\n- $v_1$：$0 \\le v_1 \\le U_g$（葡萄糖摄取容量）。\n- $v_2$：$0 \\le v_2 \\le C_{\\mathrm{cat}}$（分解代谢容量）。\n- $v_3$：$0 \\le v_3 \\le C_{\\mathrm{prec}}$（前体合成容量）。\n- $v_4$：$0 \\le v_4 \\le C_{\\mathrm{bio}}$（生物质合成容量，可能无界）。\n- $v_5$：$M \\le v_5 \\le \\infty$（维持能量需求的下界）。\n\n您的程序必须建立并求解线性规划问题，通过在这些约束下最小化 $-v_4$ 来为指定的参数集求解。涌现生长速率是 $v_4$ 的最优值，以 $h^{-1}$ 表示。\n\n测试套件：\n为以下 $5$ 个测试用例提供结果，每个用例以 $(U_g, C_{\\mathrm{cat}}, C_{\\mathrm{prec}}, M, C_{\\mathrm{bio}})$ 的形式给出，所有容量的单位在适用时为 $h^{-1}$：\n1. 用例 A：$(U_g, C_{\\mathrm{cat}}, C_{\\mathrm{prec}}, M, C_{\\mathrm{bio}}) = (9, 5, 5, 1, 10)$。\n2. 用例 B：$(U_g, C_{\\mathrm{cat}}, C_{\\mathrm{prec}}, M, C_{\\mathrm{bio}}) = (4, 10, 10, 1, \\infty)$。\n3. 用例 C：$(U_g, C_{\\mathrm{cat}}, C_{\\mathrm{prec}}, M, C_{\\mathrm{bio}}) = (100, 2, 100, 1, 100)$。\n4. 用例 D：$(U_g, C_{\\mathrm{cat}}, C_{\\mathrm{prec}}, M, C_{\\mathrm{bio}}) = (2, 1, 1, 2, 100)$。\n5. 用例 E：$(U_g, C_{\\mathrm{cat}}, C_{\\mathrm{prec}}, M, C_{\\mathrm{bio}}) = (100, 50, 50, 1, 2)$。\n\n要求：\n- 使用稳态约束 $S v = 0$ 和上述边界来定义线性规划问题。\n- 计算每个用例的最优 $v_4$，并以浮点数形式报告涌现生长速率（单位为 $h^{-1}$），四舍五入到 $6$ 位小数。\n- 最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[r_1,r_2,r_3,r_4,r_5]$），其中每个 $r_i$ 是用例 $i$ 的生长速率，单位为 $h^{-1}$。",
            "solution": "问题陈述已经过严格验证，并被认为是有效的。它在系统生物学领域提出了一个适定且有科学依据的问题。任务是将流平衡分析（FBA）这一标准而强大的基于约束的建模技术，应用于一个简化的代谢网络。该问题是自洽的，提供了所有必要的数据、定义和约束，并且没有科学上的不准确性、逻辑矛盾或歧义。目标是计算生物系统的涌现生长速率，这是FBA的一个典型应用。\n\n该问题被表述为一个线性规划（LP），这是一个数学上严谨且可解的框架。我们被要求在满足一系列线性等式和不等式约束的条件下，最大化一个目标函数——通过生物质生成反应的通量。\n\n核心原理是针对内源代谢物的稳态假设，该假设规定每种代谢物的产生和消耗必须平衡。这在数学上表示为：\n$$ S v = 0 $$\n其中 $S \\in \\mathbb{R}^{3 \\times 5}$ 是化学计量矩阵，$v \\in \\mathbb{R}^5$ 是反应通量向量。给定的化学计量矩阵是：\n$$\nS = \\begin{bmatrix}\n1  -1  -1  0  0 \\\\\n0  0  1  -1  0 \\\\\n0  2  0  -1  -1\n\\end{bmatrix}\n$$\n通量向量 $v = [v_1, v_2, v_3, v_4, v_5]^T$ 的分量代表网络中五个反应的速率。$S$ 的行分别对应于内源代谢物 $G$（葡萄糖）、$P$（前体）和 $E$（能量货币）的质量平衡方程。\n\n该系统进一步受到每个反应通量 $v_j$ 的热力学和容量限制，由下界和上界给出，$l_j \\le v_j \\le u_j$。对于给定的问题，这些边界是：\n- 葡萄糖摄取 ($v_1$): $0 \\le v_1 \\le U_g$\n- 分解代谢 ($v_2$): $0 \\le v_2 \\le C_{\\mathrm{cat}}$\n- 前体合成 ($v_3$): $0 \\le v_3 \\le C_{\\mathrm{prec}}$\n- 生物质形成 ($v_4$): $0 \\le v_4 \\le C_{\\mathrm{bio}}$\n- 维持 ($v_5$): $M \\le v_5 \\le \\infty$\n\n生物学目标是最大化生物质生产速率，它被用作生长速率的代理指标。这对应于最大化通量 $v_4$。因此，问题是：\n$$\n\\begin{align*}\n\\underset{v}{\\text{maximize}}  \\quad v_4 \\\\\n\\text{subject to}  \\quad S v = 0 \\\\\n \\quad 0 \\le v_1 \\le U_g \\\\\n \\quad 0 \\le v_2 \\le C_{\\mathrm{cat}} \\\\\n \\quad 0 \\le v_3 \\le C_{\\mathrm{prec}} \\\\\n \\quad 0 \\le v_4 \\le C_{\\mathrm{bio}} \\\\\n \\quad v_5 \\ge M\n\\end{align*}\n$$\n这是一个线性规划问题。标准的LP求解器是为最小化问题设计的。为了适应这个标准，我们可以等价地最小化目标函数的相反数，即 $-v_4$。因此，对于最小化问题 $\\min c^T v$，目标函数向量 $c$ 为 $c = [0, 0, 0, -1, 0]^T$。\n\n等式约束为 $A_{eq} v = b_{eq}$，其中 $A_{eq} = S$ 且 $b_{eq} = [0, 0, 0]^T$。每个通量 $v_j$ 的边界在每个测试用例中都被指定。\n\n计算方法涉及对每组参数使用数值LP求解器，例如 `scipy.optimize.linprog`。对于每个用例，我们根据给定的参数 $(U_g, C_{\\mathrm{cat}}, C_{\\mathrm{prec}}, M, C_{\\mathrm{bio}})$ 构建边界向量并求解LP。涌现生长速率是求解器找到的 $v_4$ 的最优值。如果求解器报告问题不可行（即，没有通量向量 $v$ 能同时满足所有约束），这意味着在给定的容量限制下，最小维持能量需求无法得到满足。在这种生物学相关的情景中，生长速率必须为 $0$。\n\n为了验证，我们可以推导出一个解析解。从 $S v = 0$ 可得：\n1. $v_1 = v_2 + v_3$\n2. $v_3 = v_4$\n3. $v_5 = 2v_2 - v_4$\n\n将这些代入通量边界，我们可以用 $v_2$ 和我们的目标 $v_4$ 来表示所有约束：\n- $0 \\le v_2 + v_4 \\le U_g \\implies v_2 \\le U_g - v_4$\n- $0 \\le v_2 \\le C_{\\mathrm{cat}}$\n- $0 \\le v_4 \\le C_{\\mathrm{prec}}$\n- $0 \\le v_4 \\le C_{\\mathrm{bio}}$\n- $2v_2 - v_4 \\ge M \\implies v_2 \\ge \\frac{M+v_4}{2}$\n\n对于一个给定的 $v_4 \\ge 0$，要存在可行解，就必须有一个满足其约束的 $v_2$ 值：\n$$ \\max\\left(0, \\frac{M+v_4}{2}\\right) \\le v_2 \\le \\min(C_{\\mathrm{cat}}, U_g - v_4) $$\n这要求 $v_2$ 的下界小于或等于其上界：\n$$ \\max\\left(0, \\frac{M+v_4}{2}\\right) \\le \\min(C_{\\mathrm{cat}}, U_g - v_4) $$\n为了最大化 $v_4$，我们找到满足这个不等式以及其自身直接边界 $0 \\le v_4 \\le \\min(C_{\\mathrm{prec}}, C_{\\mathrm{bio}})$ 的最大非负 $v_4$。这一分析揭示了 $v_4$ 受到四个潜在瓶颈的限制，从而得出了最优生长速率的简洁解析解：\n$$ v_{4, \\text{opt}} = \\max\\left(0, \\min\\left(C_{\\mathrm{prec}}, C_{\\mathrm{bio}}, 2C_{\\mathrm{cat}} - M, \\frac{2U_g - M}{3}\\right)\\right) $$\n这个公式展示了生长的涌现特性是如何由几个系统性约束中最具限制性的那个决定的。实现将按照要求，通过数值方法求解完整的LP问题来进行。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a Flux Balance Analysis (FBA) problem for a coarse-grained metabolic network.\n\n    The function computes the emergent growth rate by setting up and solving a\n    linear programming problem for five different parameter sets.\n    \"\"\"\n\n    # Stoichiometric matrix S for metabolites G, P, E and reactions v1-v5.\n    # Rows: G, P, E\n    # Columns: v1, v2, v3, v4, v5\n    S = np.array([\n        [1, -1, -1,  0,  0],  # Glucose balance\n        [0,  0,  1, -1,  0],  # Precursor balance\n        [0,  2,  0, -1, -1]   # Energy balance\n    ])\n\n    # Objective function: maximize v4, which is equivalent to minimizing -v4.\n    # The vector c represents the coefficients of the objective function.\n    c_obj = np.array([0, 0, 0, -1, 0])\n\n    # Equality constraints: Sv = 0.\n    # The vector b_eq represents the right-hand side of the equality constraints.\n    b_eq = np.zeros(S.shape[0])\n\n    # Test cases are given as tuples of parameters:\n    # (Ug, C_cat, C_prec, M, C_bio)\n    test_cases = [\n        (9, 5, 5, 1, 10),\n        (4, 10, 10, 1, np.inf),\n        (100, 2, 100, 1, 100),\n        (2, 1, 1, 2, 100),\n        (100, 50, 50, 1, 2),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        Ug, C_cat, C_prec, M, C_bio = case\n\n        # Define flux bounds (lower_bound, upper_bound) for each reaction v_j.\n        # A value of None or np.inf indicates no upper bound.\n        bounds = [\n            (0, Ug),      # v1: Glucose uptake\n            (0, C_cat),    # v2: Catabolism\n            (0, C_prec),   # v3: Precursor synthesis\n            (0, C_bio),    # v4: Biomass formation\n            (M, None),     # v5: Maintenance\n        ]\n\n        # Solve the linear program using the high-performance 'highs' solver.\n        res = linprog(c=c_obj, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n\n        # The emergent growth rate is the optimal flux through the biomass reaction, v4.\n        growth_rate = 0.0\n        if res.success:\n            # The optimal flux vector is in res.x. v4 is the 4th element (index 3).\n            # We take max(0, ...) to handle potential small negative values from numerical precision\n            # when the true optimum is 0.\n            growth_rate = max(0, res.x[3])\n        elif res.status == 2:\n            # Status 2 indicates the problem is infeasible.\n            # Biologically, this means constraints (e.g., maintenance) cannot be met.\n            # Therefore, the growth rate is 0.\n            growth_rate = 0.0\n        else:\n            # Handle other potential solver failures, though not expected for this problem.\n            # This could indicate an issue with the problem formulation itself.\n            # For this specific problem set, this branch should not be reached.\n            growth_rate = np.nan # Or raise an error.\n\n        results.append(growth_rate)\n\n    # Format the results to 6 decimal places as required.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    \n    # Print the final output in the specified single-line format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}