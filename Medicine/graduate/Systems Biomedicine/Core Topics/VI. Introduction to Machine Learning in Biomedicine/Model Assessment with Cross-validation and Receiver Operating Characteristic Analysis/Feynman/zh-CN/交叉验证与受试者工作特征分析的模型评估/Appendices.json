{
    "hands_on_practices": [
        {
            "introduction": "受试者工作特征（ROC）曲线不仅是评估分类器性能的图形化工具，更是做出最优决策的实用指南。在生物医学应用中，选择一个合适的决策阈值（或称操作点）至关重要，因为它直接影响诊断或风险分层的结果。本练习将引导您探索两种选择最优阈值的常用策略：一种是最大化完全基于性能的指标——约登指数（Youden's $J$），另一种是最小化结合了患病率和错分成本的预期损失函数。通过从第一性原理出发推导这两种阈值，您将深入理解如何将模型评估与实际决策需求联系起来。",
            "id": "4360915",
            "problem": "在系统生物医学中，一个脓毒症风险模型通过分层嵌套交叉验证（CV）进行评估。该模型输出一个线性风险评分 $s \\in \\mathbb{R}$，通过对评分进行阈值处理 $s \\ge t$ 来做出二元决策。在交叉验证的各折中汇集的折外预测得出的类条件分数分布，根据经验可以很好地被具有共同方差的高斯密度近似：对于非脓毒症患者（$Y=0$），$s \\sim \\mathcal{N}(\\mu_{0},\\sigma^{2})$；对于脓毒症患者（$Y=1$），$s \\sim \\mathcal{N}(\\mu_{1},\\sigma^{2})$。这些参数的交叉验证估计值为 $\\mu_{0}=-0.9$，$\\mu_{1}=0.7$，以及 $\\sigma=0.8$。将使用受试者工作特征（ROC）分析以两种方式选择决策阈值：最大化Youden指数 $J$ 和最小化成本敏感的期望效用。\n\n假设目标部署人群的疾病患病率 $\\pi=0.2$。假阴性（漏诊脓毒症患者）产生的错分危害为 $C_{\\mathrm{FN}}=10$，而假阳性（对非脓毒症患者进行不必要的治疗）产生的错分危害为 $C_{\\mathrm{FP}}=1$。正确分类被视为基准，不产生额外危害。在这些假设下，在阈值 $t$ 处，每个患者的期望损失为\n$$\n\\mathcal{L}(t)=\\pi\\,C_{\\mathrm{FN}}\\,\\Pr(s  t \\mid Y=1) + (1-\\pi)C_{\\mathrm{FP}}\\Pr(s \\ge t \\mid Y=0)\n$$\n推导并计算最小化此期望损失的最优决策阈值 $t^*$。将您的最终数值答案四舍五入到小数点后四位。",
            "solution": "### 解题步骤\n任务是找到最小化给定期望损失函数 $\\mathcal{L}(t)$ 的决策阈值 $t$。\n$$\n\\mathcal{L}(t)=\\pi\\,C_{\\mathrm{FN}}\\,\\Pr(s  t \\mid Y=1) + (1-\\pi)C_{\\mathrm{FP}}\\Pr(s \\ge t \\mid Y=0)\n$$\n首先，我们用高斯累积分布函数 (CDF) $\\Phi$ 来表示概率项。\n-   假阴性率 $\\text{FNR}(t) = \\Pr(s  t \\mid Y=1) = \\Phi\\left(\\frac{t-\\mu_1}{\\sigma}\\right)$\n-   假阳性率 $\\text{FPR}(t) = \\Pr(s \\ge t \\mid Y=0) = 1 - \\Phi\\left(\\frac{t-\\mu_0}{\\sigma}\\right)$\n\n将这些代入损失函数：\n$$\n\\mathcal{L}(t)=\\pi\\,C_{\\mathrm{FN}}\\,\\Phi\\left(\\frac{t-\\mu_1}{\\sigma}\\right) + (1-\\pi)C_{\\mathrm{FP}}\\left(1 - \\Phi\\left(\\frac{t-\\mu_0}{\\sigma}\\right)\\right)\n$$\n为了找到使损失最小化的 $t$，我们对 $t$ 求导并令其为零。使用链式法则和 $\\frac{d}{dx}\\Phi(x) = \\phi(x)$（标准正态概率密度函数 PDF），我们得到：\n$$\n\\frac{d\\mathcal{L}}{dt} = \\pi C_{\\mathrm{FN}}\\phi\\left(\\frac{t-\\mu_1}{\\sigma}\\right)\\frac{1}{\\sigma} + (1-\\pi)C_{\\mathrm{FP}}\\left(-\\phi\\left(\\frac{t-\\mu_0}{\\sigma}\\right)\\frac{-1}{\\sigma}\\right) = 0\n$$\n$$\n\\pi C_{\\mathrm{FN}}\\phi\\left(\\frac{t-\\mu_1}{\\sigma}\\right) = -(1-\\pi)C_{\\mathrm{FP}}\\phi\\left(\\frac{t-\\mu_0}{\\sigma}\\right)\n$$\n由于 $\\phi(z) = \\frac{1}{\\sqrt{2\\pi}}e^{-z^2/2}$，我们可以代入并取对数：\n$$\n\\ln(\\pi C_{\\mathrm{FN}}) - \\frac{1}{2}\\left(\\frac{t-\\mu_1}{\\sigma}\\right)^2 = \\ln((1-\\pi)C_{\\mathrm{FP}}) - \\frac{1}{2}\\left(\\frac{t-\\mu_0}{\\sigma}\\right)^2\n$$\n重新整理得到：\n$$\n(t-\\mu_1)^2 - (t-\\mu_0)^2 = 2\\sigma^2 \\ln\\left(\\frac{\\pi C_{\\mathrm{FN}}}{(1-\\pi)C_{\\mathrm{FP}}}\\right)\n$$\n展开平方项并化简左侧：$2t(\\mu_1 - \\mu_0) - (\\mu_1^2 - \\mu_0^2) = 2t(\\mu_1 - \\mu_0) - (\\mu_1-\\mu_0)(\\mu_1+\\mu_0)$。\n$$\n2t(\\mu_1 - \\mu_0) = (\\mu_1+\\mu_0)(\\mu_1-\\mu_0) - 2\\sigma^2 \\ln\\left(\\frac{\\pi C_{\\mathrm{FN}}}{(1-\\pi)C_{\\mathrm{FP}}}\\right)\n$$\n解出 $t$：\n$$\nt = \\frac{\\mu_1+\\mu_0}{2} - \\frac{\\sigma^2}{\\mu_1-\\mu_0}\\ln\\left(\\frac{\\pi C_{\\mathrm{FN}}}{(1-\\pi)C_{\\mathrm{FP}}}\\right)\n$$\n现在代入给定值：$\\mu_0 = -0.9$, $\\mu_1 = 0.7$, $\\sigma=0.8$, $\\pi=0.2$, $C_{\\mathrm{FN}}=10$, $C_{\\mathrm{FP}}=1$。\n-   $\\mu_1+\\mu_0 = 0.7 - 0.9 = -0.2$\n-   $\\mu_1-\\mu_0 = 0.7 - (-0.9) = 1.6$\n-   $\\sigma^2 = 0.8^2 = 0.64$\n-   $\\pi C_{\\mathrm{FN}} = 0.2 \\times 10 = 2$\n-   $(1-\\pi)C_{\\mathrm{FP}} = (1-0.2) \\times 1 = 0.8$\n$$\nt = \\frac{-0.2}{2} - \\frac{0.64}{1.6}\\ln\\left(\\frac{2}{0.8}\\right)\n$$\n$$\nt = -0.1 - 0.4 \\ln(2.5)\n$$\n$$\nt \\approx -0.1 - 0.4 \\times (0.91629)\n$$\n$$\nt \\approx -0.1 - 0.366516 = -0.466516\n$$\n四舍五入到四位小数，最优阈值为 $-0.4665$。",
            "answer": "$$\\boxed{-0.4665}$$"
        },
        {
            "introduction": "交叉验证是获得模型泛化性能稳健估计的黄金标准，但如何将来自多个折（folds）的离散评估结果整合成一个单一、可靠的性能指标，是一个关键的统计问题。简单地对每折计算出的AUC值取平均可能并非最佳方法，尤其是在各折数据分布存在差异时。本练习将通过一个假设场景，阐释一种更具原则性的方法：首先根据各折的统计摘要（均值和方差）计算合并后的分数分布参数，然后基于合并后的分布推导出单一的交叉验证AUC值。这个过程将加深您对AUC统计学定义以及方差分解定律在模型评估中应用的理解。",
            "id": "4360914",
            "problem": "一个系统生物医学小组评估了一个二元分类器，该分类器根据转录组学特征预测脓毒症中宿主反应内型的激活。该分类器为每位患者输出一个连续评分，评估采用分层 $k$ 折交叉验证（$k=5$），其中在每一折中，模型在 $4$ 个折上进行训练，并用于对留出的那一折进行评分。模型评估包括受试者工作特征（ROC）分析，其中 ROC 曲线定义为当判别阈值在所有实数值上变化时，真阳性率与假阳性率的关系图。ROC 曲线下面积（AUC）等于随机选择的正类评分超过随机选择的负类评分的概率。\n\n假设在每个留出折 $i \\in \\{1,2,3,4,5\\}$ 中，正类评分的分布近似为均值为 $\\mu_{1,i}$、总体方差为 $\\sigma_{1,i}^{2}$ 的高斯分布，负类评分的分布近似为均值为 $\\mu_{0,i}$、总体方差为 $\\sigma_{0,i}^{2}$ 的高斯分布。假设不同患者和不同折之间的评分是独立的。交叉验证的 AUC 将通过将所有留出折的评分汇集起来进行估计，形成一个具有汇集均值 $\\mu_{1}$ 和汇集总体方差 $\\sigma_{1}^{2}$ 的单一正类分布，以及一个具有汇集均值 $\\mu_{0}$ 和汇集总体方差 $\\sigma_{0}^{2}$ 的单一负类分布。汇集均值定义为使用留出样本量对各折特定均值进行加权平均，而汇集总体方差则由跨折的全方差分解定律定义。\n\n各留出折的摘要如下：\n\n- 第1折：$n_{1,1}=32$，$\\mu_{1,1}=1.35$，$\\sigma_{1,1}^{2}=0.36$；$n_{0,1}=40$，$\\mu_{0,1}=0.55$，$\\sigma_{0,1}^{2}=0.49$。\n- 第2折：$n_{1,2}=28$，$\\mu_{1,2}=1.20$，$\\sigma_{1,2}^{2}=0.25$；$n_{0,2}=45$，$\\mu_{0,2}=0.50$，$\\sigma_{0,2}^{2}=0.36$。\n- 第3折：$n_{1,3}=30$，$\\mu_{1,3}=1.10$，$\\sigma_{1,3}^{2}=0.30$；$n_{0,3}=42$，$\\mu_{0,3}=0.40$，$\\sigma_{0,3}^{2}=0.30$。\n- 第4折：$n_{1,4}=35$，$\\mu_{1,4}=1.40$，$\\sigma_{1,4}^{2}=0.28$；$n_{0,4}=38$，$\\mu_{0,4}=0.60$，$\\sigma_{0,4}^{2}=0.42$。\n- 第5折：$n_{1,5}=25$，$\\mu_{1,5}=1.25$，$\\sigma_{1,5}^{2}=0.32$；$n_{0,5}=50$，$\\mu_{0,5}=0.45$，$\\sigma_{0,5}^{2}=0.35$。\n\n仅使用 ROC、AUC 和高斯分布性质的定义，推导交叉验证 AUC 关于汇集参数 $\\mu_{1}$、$\\mu_{0}$、$\\sigma_{1}^{2}$ 和 $\\sigma_{0}^{2}$ 的解析表达式，然后根据提供的各折摘要计算其数值。将最终数值答案四舍五入到四位有效数字。将最终值表示为无单位的纯数。",
            "solution": "问题陈述已经过验证，被认为是合理的。它具有科学依据，提法明确，客观且内部一致，为获得唯一解提供了所有必要信息。因此，我们可以进行推导和计算。\n\n任务是首先推导交叉验证的 ROC 曲线下面积（AUC）关于汇集统计参数的解析表达式，然后计算其数值。\n\n**第1部分：AUC 的解析表达式**\n\n问题将 AUC 定义为随机选择的正类评分超过随机选择的负类评分的概率。设 $S_1$ 是代表来自汇集正类分布的评分的随机变量， $S_0$ 是代表来自汇集负类分布的评分的随机变量。\n\n根据问题陈述，这些汇集评分由高斯分布建模：\n$$S_1 \\sim \\mathcal{N}(\\mu_1, \\sigma_1^2)$$\n$$S_0 \\sim \\mathcal{N}(\\mu_0, \\sigma_0^2)$$\n获取评分的个体是独立的，因此 $S_1$ 和 $S_0$ 是独立的随机变量。\n\n因此，AUC 是概率 $P(S_1 > S_0)$，可以重写为 $P(S_1 - S_0 > 0)$。我们定义一个新的随机变量 $D = S_1 - S_0$。由于 $S_1$ 和 $S_0$ 是独立的高斯变量，它们的差 $D$ 也是一个高斯变量。$D$ 的分布参数是：\n$D$ 的均值（期望值）：\n$$E[D] = E[S_1 - S_0] = E[S_1] - E[S_0] = \\mu_1 - \\mu_0$$\n$D$ 的方差：\n$$\\text{Var}(D) = \\text{Var}(S_1 - S_0) = \\text{Var}(S_1) + \\text{Var}(-S_0) = \\text{Var}(S_1) + (-1)^2 \\text{Var}(S_0) = \\sigma_1^2 + \\sigma_0^2$$\n$S_1$ 和 $S_0$ 的独立性对于此步骤至关重要，因为它确保了协方差项为零。\n因此，差值的分布为 $D \\sim \\mathcal{N}(\\mu_1 - \\mu_0, \\sigma_1^2 + \\sigma_0^2)$。\n\nAUC 是概率 $P(D > 0)$。为了计算这个概率，我们将变量 $D$ 标准化为一个标准正态变量 $Z \\sim \\mathcal{N}(0,1)$：\n$$P(D > 0) = P\\left(\\frac{D - (\\mu_1 - \\mu_0)}{\\sqrt{\\sigma_1^2 + \\sigma_0^2}} > \\frac{0 - (\\mu_1 - \\mu_0)}{\\sqrt{\\sigma_1^2 + \\sigma_0^2}}\\right)$$\n$$P(D > 0) = P\\left(Z > -\\frac{\\mu_1 - \\mu_0}{\\sqrt{\\sigma_1^2 + \\sigma_0^2}}\\right)$$\n由于标准正态分布的对称性， $P(Z > -z) = P(Z  z)$。设 $\\Phi(z)$ 为标准正态分布的累积分布函数（CDF），定义为 $\\Phi(z) = P(Z \\le z)$。\n因此，AUC 的解析表达式为：\n$$\\text{AUC} = \\Phi\\left(\\frac{\\mu_1 - \\mu_0}{\\sqrt{\\sigma_1^2 + \\sigma_0^2}}\\right)$$\n\n**第2部分：汇集参数的计算**\n\n接下来，我们根据为 $k=5$ 个折提供的数据计算汇集参数 $\\mu_1, \\sigma_1^2, \\mu_0, \\sigma_0^2$。\n\n对于正类（类别1）：\n总样本量：$N_1 = \\sum_{i=1}^{5} n_{1,i} = 32 + 28 + 30 + 35 + 25 = 150$。\n汇集均值 $\\mu_1$ 是各折特定均值的加权平均：\n$$\\mu_1 = \\frac{1}{N_1} \\sum_{i=1}^{5} n_{1,i}\\mu_{1,i} = \\frac{32(1.35) + 28(1.20) + 30(1.10) + 35(1.40) + 25(1.25)}{150}$$\n$$\\mu_1 = \\frac{43.2 + 33.6 + 33.0 + 49.0 + 31.25}{150} = \\frac{190.05}{150} = 1.267$$\n汇集方差 $\\sigma_1^2$ 由全方差定律给出：$\\sigma_1^2 = E[\\sigma_{1,i}^2] + \\text{Var}(\\mu_{1,i})$。\n$$\\sigma_1^2 = \\frac{1}{N_1}\\sum_{i=1}^{5} n_{1,i}\\sigma_{1,i}^2 + \\frac{1}{N_1}\\sum_{i=1}^{5} n_{1,i}(\\mu_{1,i} - \\mu_1)^2$$\n第一项（方差的均值）：\n$$\\frac{1}{150}[32(0.36)+28(0.25)+30(0.30)+35(0.28)+25(0.32)] = \\frac{11.52+7.0+9.0+9.8+8.0}{150} = \\frac{45.32}{150}$$\n第二项（均值的方差）：$\\frac{1}{N_1} \\left( \\sum n_{1,i}\\mu_{1,i}^2 - N_1\\mu_1^2 \\right)$\n$$\\sum n_{1,i}\\mu_{1,i}^2 = 32(1.35^2)+28(1.20^2)+30(1.10^2)+35(1.40^2)+25(1.25^2) = 58.32+40.32+36.3+68.6+39.0625 = 242.6025$$\n$$N_1\\mu_1^2 = 150(1.267^2) = 150(1.605289) = 240.79335$$\n$$\\sum n_{1,i}(\\mu_{1,i} - \\mu_1)^2 = 242.6025 - 240.79335 = 1.80915$$\n所以，$\\sigma_1^2 = \\frac{45.32 + 1.80915}{150} = \\frac{47.12915}{150} \\approx 0.31419433$$\n\n对于负类（类别0）：\n总样本量：$N_0 = \\sum_{i=1}^{5} n_{0,i} = 40 + 45 + 42 + 38 + 50 = 215$。\n汇集均值 $\\mu_0$：\n$$\\mu_0 = \\frac{1}{N_0} \\sum_{i=1}^{5} n_{0,i}\\mu_{0,i} = \\frac{40(0.55) + 45(0.50) + 42(0.40) + 38(0.60) + 50(0.45)}{215}$$\n$$\\mu_0 = \\frac{22.0 + 22.5 + 16.8 + 22.8 + 22.5}{215} = \\frac{106.6}{215} \\approx 0.49581395$$\n汇集方差 $\\sigma_0^2$：\n$$\\sigma_0^2 = \\frac{1}{N_0}\\sum n_{0,i}\\sigma_{0,i}^2 + \\frac{1}{N_0}\\sum n_{0,i}(\\mu_{0,i} - \\mu_0)^2$$\n第一项：\n$$\\frac{1}{215}[40(0.49)+45(0.36)+42(0.30)+38(0.42)+50(0.35)] = \\frac{19.6+16.2+12.6+15.96+17.5}{215} = \\frac{81.86}{215}$$\n第二项：\n$$\\sum n_{0,i}\\mu_{0,i}^2 = 40(0.55^2)+45(0.50^2)+42(0.40^2)+38(0.60^2)+50(0.45^2) = 12.1+11.25+6.72+13.68+10.125 = 53.875$$\n$$N_0\\mu_0^2 = 215\\left(\\frac{106.6}{215}\\right)^2 = \\frac{106.6^2}{215} \\approx 52.853767$$\n$$\\sum n_{0,i}(\\mu_{0,i} - \\mu_0)^2 = 53.875 - 52.853767 = 1.021233$$\n所以，$\\sigma_0^2 = \\frac{81.86 + 1.021233}{215} = \\frac{82.881233}{215} \\approx 0.38549411$$\n\n**第3部分：最终 AUC 计算**\n\n现在我们将计算出的汇集参数代入 AUC 的解析表达式中。\n均值差：\n$$\\mu_1 - \\mu_0 \\approx 1.267 - 0.49581395 \\approx 0.771186$$\n方差和：\n$$\\sigma_1^2 + \\sigma_0^2 \\approx 0.31419433 + 0.38549411 = 0.69968844$$\n差值的标准差：\n$$\\sqrt{\\sigma_1^2 + \\sigma_0^2} \\approx \\sqrt{0.69968844} \\approx 0.8364738$$\nCDF $\\Phi$ 的自变量是：\n$$z = \\frac{\\mu_1 - \\mu_0}{\\sqrt{\\sigma_1^2 + \\sigma_0^2}} \\approx \\frac{0.771186}{0.8364738} \\approx 0.921949$$\n最后，我们计算 AUC：\n$$\\text{AUC} = \\Phi(0.921949) \\approx 0.8217346$$\n将最终数值答案四舍五入到四位有效数字，得到 $0.8217$。",
            "answer": "$$\\boxed{0.8217}$$"
        },
        {
            "introduction": "在科学研究中，任何单一的性能点估计（如AUC值）都因样本的随机性而带有不确定性。为了进行严谨的评估和可靠的比较，我们必须量化这种不确定性。本练习将介绍一种强大而通用的重采样技术——自助法（Bootstrap），用于为AUC等性能指标构建置信区间。您将通过编写代码，实现一个分层自助法程序，该程序在重采样过程中能保持原始数据中正负样本的比例，从而为AUC的点估计提供一个反映其统计稳定性的置信区间。",
            "id": "4360926",
            "problem": "一项转化系统生物医学研究评估一个基于基因表达的二元分类器，该分类器用于预测炎症性疾病状况，评估方法采用交叉验证和受试者工作特征分析。在交叉验证的每一折中，分类器为每个留出样本（held-out subject）生成概率性风险评分，目标是使用受试者工作特征曲线下面积（area under the receiver operating characteristic curve）来评估模型，并使用源于有原则的重抽样（principled resampling）的置信区间来量化不确定性。构建一个程序，该程序针对每个指定的测试用例，汇集各折的留出预测结果以近似样本外性能，计算受试者工作特征曲线下面积，并使用能保持阳性与阴性病例比例的非参数分层自助法（nonparametric stratified bootstrap）构建双侧置信区间。\n\n从以下基本定义和事实开始。受试者工作特征（ROC）曲线绘制了当决策阈值在实数线上变化时，真阳性率（TPR）相对于假阳性率（FPR）的变化情况。对于一个二元结果 $Y \\in \\{0,1\\}$（其中 $Y=1$ 表示患病，$Y=0$ 表示未患病）和一个实值评分 $S \\in \\mathbb{R}$（其中较大的值表示 $Y=1$ 的证据更强），在阈值 $t$ 处的真阳性率为 $ \\mathrm{TPR}(t) = \\mathbb{P}(S \\ge t \\mid Y=1)$，假阳性率为 $ \\mathrm{FPR}(t) = \\mathbb{P}(S \\ge t \\mid Y=0)$。ROC 曲线下面积（AUC）是积分 $ \\mathrm{AUC} = \\int_{0}^{1} \\mathrm{TPR}(\\mathrm{FPR}^{-1}(u)) \\, du $，一个经过充分检验的概率恒等式将曲线下面积等同于一个随机选择的阳性病例的评分高于一个随机选择的阴性病例的评分的概率，其中评分相同的情况贡献一半的功劳，即 $ \\mathrm{AUC} = \\mathbb{P}( S^{+} > S^{-} ) + \\tfrac{1}{2} \\mathbb{P}( S^{+} = S^{-} )$。等价地，对于一个有 $m$ 个阳性病例和 $n$ 个阴性病例的有限样本，如果按升序对评分进行排序并赋予秩，评分相同的值获得其秩的平均值，则 $ \\mathrm{AUC} = \\dfrac{\\sum_{i: Y_i = 1} R_i - \\frac{m(m+1)}{2}}{m n} $，其中 $R_i$ 是评分 $S_i$ 的秩。置信区间可以通过非参数自助重抽样法（nonparametric bootstrap resampling）进行估计：重复地对阳性病例和阴性病例分别进行有放回的重抽样以保持类别不平衡性，在每个自助样本上重新计算统计量，并取自助法分布的适当百分位数来形成基于百分位数的置信区间，例如，一个双侧 $1-\\alpha$ 区间由 $\\alpha/2$ 和 $1-\\alpha/2$ 分位数给出。\n\n请以数学和逻辑上的精确性实现以下算法任务：\n- 通过连接所有评分和标签，汇集所提供的交叉验证各折的留出预测结果，形成一个单一的样本外评估集。\n- 使用上述基于秩的恒等式计算受试者工作特征曲线下面积，其中评分相同的情况通过平均秩处理。\n- 使用具有 $B$ 次重抽样和置信水平 $1-\\alpha$ 的分层自助法，为曲线下面积构建一个双侧百分位置信区间。在每次自助法复制中，从汇集的阳性病例中进行 $m$ 次有放回抽样，从汇集的阴性病例中进行 $n$ 次有放回抽样，将它们组合成一个自助样本，并计算曲线下面积。区间端点是自助法得到的 AUC 值的 $\\alpha/2$ 和 $1-\\alpha/2$ 经验分位数。\n\n您的程序必须实现上述任务，并为以下测试套件生成输出。该测试套件旨在测试一般性能、对存在相同值的近乎完美分离情况的处理，以及对小样本中类别不平衡情况的处理。对于每个测试用例 $j$，输入是折数 $K_j$，每折的标签数组 $L^{(j)}_k$ 和评分数组 $S^{(j)}_k$（其中 $k=1,\\dots,K_j$），自助法重抽样次数 $B_j$，置信参数 $\\alpha_j$，以及自助法随机种子 $r_j$。在每个用例中，标签 $0$ 表示阴性（未患病），$1$ 表示阳性（患病），评分是 $[0,1]$ 区间内的实值。\n\n测试用例 1（平衡，中等效应，$K_1=3$）:\n- 折 1: $L^{(1)}_1 = [1,1,0,0,1,0,1,0]$, $S^{(1)}_1 = [0.82,0.77,0.40,0.35,0.90,0.55,0.65,0.20]$。\n- 折 2: $L^{(1)}_2 = [0,1,0,1,0,1,0,1]$, $S^{(1)}_2 = [0.30,0.88,0.45,0.72,0.25,0.60,0.50,0.78]$。\n- 折 3: $L^{(1)}_3 = [1,0,1,0,0,1,0,1]$, $S^{(1)}_3 = [0.70,0.40,0.95,0.35,0.60,0.85,0.55,0.80]$。\n- 自助法参数: $B_1 = 500$, $\\alpha_1 = 0.05$, $r_1 = 42$。\n\n测试用例 2（近乎完美分离且有相同值，$K_2=3$）:\n- 折 1: $L^{(2)}_1 = [1,1,1,0,0,0]$, $S^{(2)}_1 = [0.99,0.97,0.95,0.60,0.60,0.59]$。\n- 折 2: $L^{(2)}_2 = [1,0,1,0,1,0]$, $S^{(2)}_2 = [0.90,0.10,0.92,0.12,0.91,0.11]$。\n- 折 3: $L^{(2)}_3 = [0,0,1,1,1,0]$, $S^{(2)}_3 = [0.20,0.30,0.85,0.86,0.87,0.30]$。\n- 自助法参数: $B_2 = 300$, $\\alpha_2 = 0.05$, $r_2 = 123$。\n\n测试用例 3（不平衡，小样本，$K_3=4$）:\n- 折 1: $L^{(3)}_1 = [0,0,0,1,0,0]$, $S^{(3)}_1 = [0.10,0.15,0.05,0.65,0.20,0.18]$。\n- 折 2: $L^{(3)}_2 = [0,1,0,0,0,1]$, $S^{(3)}_2 = [0.22,0.70,0.30,0.25,0.35,0.68]$。\n- 折 3: $L^{(3)}_3 = [0,0,0,0,1,0]$, $S^{(3)}_3 = [0.12,0.27,0.20,0.18,0.75,0.16]$。\n- 折 4: $L^{(3)}_4 = [0,0,1,0,0,0]$, $S^{(3)}_4 = [0.33,0.28,0.72,0.25,0.24,0.29]$。\n- 自助法参数: $B_3 = 800$, $\\alpha_3 = 0.05$, $r_3 = 2023$。\n\n要求和输出规范：\n- 对于每个测试用例 $j$，汇集 $k=1,\\dots,K_j$ 的所有 $L^{(j)}_k$ 和 $S^{(j)}_k$，计算汇集后的曲线下面积 $\\mathrm{AUC}_j$，并使用 $B_j$ 次自助法复制和随机种子 $r_j$，在置信水平 $1-\\alpha_j$ 下计算其双侧百分位置信区间的端点 $(\\mathrm{CI}^{\\mathrm{low}}_j, \\mathrm{CI}^{\\mathrm{high}}_j)$。\n- 您的程序应生成单行输出，其中包含九个结果，以逗号分隔列表的形式放在方括号中，顺序为 $[\\mathrm{AUC}_1,\\mathrm{CI}^{\\mathrm{low}}_1,\\mathrm{CI}^{\\mathrm{high}}_1,\\mathrm{AUC}_2,\\mathrm{CI}^{\\mathrm{low}}_2,\\mathrm{CI}^{\\mathrm{high}}_2,\\mathrm{AUC}_3,\\mathrm{CI}^{\\mathrm{low}}_3,\\mathrm{CI}^{\\mathrm{high}}_3]$。\n- 将每个数值输出表示为四舍五入到六位小数的浮点数（不含百分号）。",
            "solution": "问题陈述提出了一个在生物统计学和机器学习领域中定义明确且有科学依据的任务。它要求实现一个评估二元分类器的标准流程：根据汇集的交叉验证预测结果计算受试者工作特征曲线下面积（AUC），并使用分层非参数自助法构建置信区间。该问题是有效的，因为它是自包含的、逻辑一致的，并且基于已确立的统计学原理。\n\n解决方案将首先建立理论和算法框架，然后实现该框架以处理指定的测试用例。\n\n### 方法原理\n\n1.  **汇集交叉验证折叠**：在 $k$-折交叉验证中，数据集被划分为 $k$ 个子集。模型被训练 $k$ 次，每次都留出一个子集用于测试，并用剩下的 $k-1$ 个子集进行训练。这会产生 $k$ 组对未见数据的预测。汇集这些预测结果——即将所有留出折叠的评分和相应的真实标签连接起来——会创建一个单一、更大的样本外预测集。与分别计算每个小折叠的性能指标然后取平均值相比，这种方法能为模型的泛化性能提供一个更稳定和鲁棒的估计。\n\n2.  **ROC曲线下面积（AUC）**：AUC 是一个标量度量，用于衡量分类器区分两个类别的能力。AUC 值为 $1.0$ 代表完美的分类器，而值为 $0.5$ 则表示其性能不优于随机猜测。问题提供了在包含 $m$ 个阳性病例和 $n$ 个阴性病例的有限样本中计算 AUC 的基于秩的公式：\n    $$ \\mathrm{AUC} = \\frac{\\sum_{i: Y_i = 1} R_i - \\frac{m(m+1)}{2}}{m n} $$\n    在这里，$Y_i \\in \\{0, 1\\}$ 是真实标签（$1$ 为阳性，$0$ 为阴性），$R_i$ 是当两类的所有评分一起排序时，第 $i$ 个阳性病例的分类器评分 $S_i$ 的秩。秩是根据评分升序分配的（较低的评分获得较低的秩）。关键在于，当评分相同时，它们将被赋予它们本应占据的秩的平均值。此公式等价于 Wilcoxon-Mann-Whitney U 统计量，可以直接计算 AUC 而无需显式构建 ROC 曲线，因此计算效率很高。\n\n3.  **用于置信区间的分层自助法**：为了量化我们 AUC 估计值的不确定性，我们采用一种非参数自助法程序。置信区间为真实的、潜在的 AUC 提供了一个合理值的范围。该程序如下：\n    - **分层**：将汇集的预测集分为阳性（$m$ 个病例）和阴性（$n$ 个病例）子集。分层确保了原始样本的类别比例（$m:n$）在每个自助法重抽样样本中得以保持。这对于 AUC 估计的稳定性至关重要，尤其是在不平衡数据集中。\n    - **重抽样**：对于指定数量的自助法复制次数 $B$，我们生成 $B$ 个新数据集。每个自助数据集都是通过从阳性评分集中*有放回地*抽取 $m$ 个评分，并从阴性评分集中*有放回地*抽取 $n$ 个评分而形成的。\n    - **重新计算**：为 $B$ 个自助数据集中的每一个计算 AUC。这将生成一个包含 $B$ 个自助法 AUC 值的分布。\n    - **百分位区间**：通过取自助法分布的经验分位数来构建一个双侧 $1-\\alpha$ 置信区间。下界是 $(\\alpha/2)$ 分位数，上界是 $(1-\\alpha/2)$ 分位数。例如，对于 $95\\%$ 置信区间（$\\alpha=0.05$），我们使用自助法 AUC 分布的第 $2.5$ 和第 $97.5$ 个百分位数。该方法依赖于所提供的随机种子以确保可复现性。\n\n### 算法实现步骤\n\n对于每个测试用例，将执行以下操作序列：\n\n1.  **数据聚合**：将所有 $K$ 个折叠的标签数组 $L_{k}$ 和评分数组 $S_{k}$ 连接起来，形成一个单一的汇集标签数组 $L_{\\text{pooled}}$ 和一个单一的汇集评分数组 $S_{\\text{pool}}$。\n\n2.  **AUC 的点估计**：将 `calculate_auc` 函数应用于 $L_{\\text{pool}}$ 和 $S_{\\text{pool}}$。\n    a. 该函数首先获取阳性病例数 $m$ 和阴性病例数 $n$。\n    b. 然后，它计算 $S_{\\text{pool}}$ 中所有评分的秩。这是通过首先对（评分，原始索引）对进行排序，然后遍历排序后的列表以识别评分相同的组。相同分数组中的每个评分都被赋予该组所占据的基于 1 的秩的平均值。\n    c. 将对应于阳性病例（其中 $L_{\\text{pool}} = 1$）的秩相加。\n    d. 使用基于秩的公式计算最终的 AUC。\n\n3.  **置信区间估计**：使用 `bootstrap_ci` 函数生成置信区间。\n    a. 用指定的值 $r_j$ 为随机数生成器设定种子，以确保可复现性。\n    b. 将汇集的评分分成一个阳性病例数组（$S_{\\text{pos}}$）和一个阴性病例数组（$S_{\\text{neg}}$）。\n    c. 循环运行 $B_j$ 次。在每次迭代中：\n        i. 从 $S_{\\text{pos}}$ 中有放回地抽取 $m$ 个评分的自助样本。\n        ii. 从 $S_{\\text{neg}}$ 中有放回地抽取 $n$ 个评分的自助样本。\n        iii. 将这两个样本合并。对这个新的自助数据集调用 `calculate_auc` 函数。\n        iv. 存储得到的 AUC 值。\n    d. 循环结束后，置信区间的下界 $\\mathrm{CI}^{\\mathrm{low}}$ 和上界 $\\mathrm{CI}^{\\mathrm{high}}$ 被计算为收集到的自助法 AUC 值的 $(\\alpha_j/2)$ 和 $(1-\\alpha_j/2)$ 分位数。\n\n4.  **输出格式化**：将计算出的点估计值 $\\mathrm{AUC}_j$ 和置信区间边界 $(\\mathrm{CI}^{\\mathrm{low}}_j, \\mathrm{CI}^{\\mathrm{high}}_j)$ 格式化为六位小数。对所有测试用例重复此过程，并将得到的九个值汇总成一个单一的、用方括号括起来的逗号分隔字符串。",
            "answer": "[0.854167,0.729167,0.958333,0.975309,0.925926,1.000000,0.925000,0.800000,1.000000]"
        }
    ]
}