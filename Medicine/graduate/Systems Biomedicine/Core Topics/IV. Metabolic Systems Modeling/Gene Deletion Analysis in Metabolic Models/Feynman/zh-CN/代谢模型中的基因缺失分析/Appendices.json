{
    "hands_on_practices": [
        {
            "introduction": "将基因型与代谢表型联系起来是系统生物学的核心目标之一。此练习将指导您完成模拟基因敲除对代谢网络影响的基本步骤。通过分析编码酶复合物（AND逻辑）和同工酶（OR逻辑）的基因-蛋白质-反应（GPR）规则 ，您将亲身体验不同的遗传冗余形式如何导致截然不同的代谢结果，从而为理解基因功能奠定基础。",
            "id": "4345172",
            "problem": "考虑一个具有基因-蛋白质-反应（GPR）规则和适用于流平衡分析（FBA）的稳态约束的最小代谢网络。内源代谢物为 $A$、$B$ 和 $C$。该网络包含以下反应及其通量变量和边界：\n- $R_1$: $\\emptyset \\to A$，通量为 $v_1$，边界为 $0 \\leq v_1 \\leq 12.0$。\n- $R_2$: $A \\to B$，通量为 $v_2$，边界为 $0 \\leq v_2 \\leq 7.8125$，GPR 规则为 $(g_A \\wedge g_B)$，表示需要基因 $g_A$ 和 $g_B$ 共同组成的蛋白质复合物。\n- $R_4$: $B \\to C$，通量为 $v_4$，边界为 $0 \\leq v_4 \\leq 10.0$，GPR 规则为 $(g_C \\vee g_D)$，表示存在两种同工酶，有基因 $g_C$ 或 $g_D$ 之一即可。\n- $R_5$: $C \\to \\text{Biomass}$，通量为 $v_5$，边界为 $0 \\leq v_5 \\leq 1000.0$（一个大数，用以近似一个有效的无界流出）。\n\n对内源代谢物使用标准的 FBA 稳态质量平衡 $S\\mathbf{v} = \\mathbf{0}$，并以最大化生物质生产通量 $v_5$ 作为线性目标。假设基因敲除会将相应基因的布尔值设置为 False，并且一个反应是活跃的当且仅当其 GPR 规则的求值结果为 True。如果一个反应的 GPR 求值结果为 False，其通量将固定为 $0$。\n\n您将分析两种单基因敲除情况：\n1. 敲除 $g_A$（$R_2$ 所需的多基因复合物的成员之一）。\n2. 敲除 $g_C$（$R_4$ 所需的同工酶集的成员之一）。\n\n任务：\n- 使用布尔逻辑对 GPR 规则进行求值，确定在每次敲除后，每个反应是否仍具有潜在的催化活性。\n- 在 $S \\mathbf{v} = \\mathbf{0}$ 和给定边界的条件下，使用 FBA 原理确定每种敲除情景下的最大可行生物质通量 $v_5^{\\star}$。将反应的失活（由于 GPR 为 False）处理为将其通量设置为 $0$，并遵守稳态质量平衡。\n- 已知在一个必需的多基因复合物中移除一个基因对其所支持的反应可能是致命的，而在一个同工酶集中移除一个基因，如果存在其他同工酶，则可能不是致命的。请通过您的布尔求值和 FBA 推理，在这个构建的网络中明确验证这些陈述。\n\n仅报告敲除 $g_C$ 后的 $v_5^{\\star}$ 值。最终通量以 $\\text{mmol} \\cdot \\text{gDW}^{-1} \\cdot \\text{h}^{-1}$ 为单位，并将您的答案四舍五入到三位小数。不要在最终的方框答案中包含单位。",
            "solution": "在尝试求解之前，对问题进行验证。\n\n### 步骤 1：提取已知信息\n- **内源代谢物：** $A$、$B$、$C$。\n- **反应、通量、边界和 GPR：**\n    - $R_1: \\emptyset \\to A$，通量 $v_1$，边界 $0 \\leq v_1 \\leq 12.0$。\n    - $R_2: A \\to B$，通量 $v_2$，边界 $0 \\leq v_2 \\leq 7.8125$，GPR 规则：$(g_A \\wedge g_B)$。\n    - $R_4: B \\to C$，通量 $v_4$，边界 $0 \\leq v_4 \\leq 10.0$，GPR 规则：$(g_C \\vee g_D)$。\n    - $R_5: C \\to \\text{Biomass}$，通量 $v_5$，边界 $0 \\leq v_5 \\leq 1000.0$。\n- **约束和目标：**\n    - 稳态质量平衡：$S \\mathbf{v} = \\mathbf{0}$。\n    - 目标：最大化 $v_5$。\n- **基因敲除逻辑：**\n    - 敲除一个基因会将其布尔值设置为 False。\n    - 一个反应是活跃的当且仅当其 GPR 规则的求值结果为 True。\n    - 如果一个反应的 GPR 为 False，其通量固定为 $0$。\n- **分析情景：**\n    1.  敲除基因 $g_A$。\n    2.  敲除基因 $g_C$。\n- **报告要求：** 报告敲除 $g_C$ 后的最大生物质通量 $v_5^{\\star}$，四舍五入到三位小数。\n\n### 步骤 2：使用提取的已知信息进行验证\n- **科学依据：** 该问题基于流平衡分析（FBA）和基因-蛋白质-反应（GPR）关联，这些是系统生物学和代谢工程中标准且成熟的方法。稳态质量平衡、线性优化和用于 GPR 规则的布尔逻辑等概念在根本上都是合理的。\n- **适定性：** 该问题是一个线性规划问题：在一组线性等式约束（$S \\mathbf{v} = \\mathbf{0}$）和不等式约束（通量边界）下，最大化一个线性目标函数（$v_5$）。此类问题是适定的，并具有唯一、稳定的解。\n- **客观性：** 问题使用了该领域精确、无歧义的术语进行陈述。\n- **完整性和一致性：** 提供了所有必要信息：化学计量网络、反应边界、GPR、目标函数以及基因敲除情景的条件。数据内部一致。\n- **其他缺陷：** 该问题不违反任何其他验证标准。这是一个受 GPR 约束的 FBA 问题的教科书式例子。\n\n### 步骤 3：结论与行动\n该问题是 **有效的**。将提供解答。\n\n### 解答\n分析首先为内源代谢物 $A$、$B$ 和 $C$ 构建化学计量矩阵 $S$。反应为 $R_1$、$R_2$、$R_4$ 和 $R_5$，对应的通量为 $v_1$、$v_2$、$v_4$ 和 $v_5$。通量向量为 $\\mathbf{v} = [v_1, v_2, v_4, v_5]^T$。\n\n$S$ 的行对应代谢物 $(A, B, C)$，列对应通量 $(v_1, v_2, v_4, v_5)$。\n- 代谢物 $A$：由 $R_1$ 产生 (+1)，由 $R_2$ 消耗 (-1)。\n- 代谢物 $B$：由 $R_2$ 产生 (+1)，由 $R_4$ 消耗 (-1)。\n- 代谢物 $C$：由 $R_4$ 产生 (+1)，由 $R_5$ 消耗 (-1)。\n\n化学计量矩阵 $S$ 为：\n$$S = \\begin{pmatrix} 1  -1  0  0 \\\\ 0  1  -1  0 \\\\ 0  0  1  -1 \\end{pmatrix}$$\n\n稳态质量平衡条件 $S \\mathbf{v} = \\mathbf{0}$ 产生以下线性方程组：\n$$\n\\begin{pmatrix} 1  -1  0  0 \\\\ 0  1  -1  0 \\\\ 0  0  1  -1 \\end{pmatrix}\n\\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_4 \\\\ v_5 \\end{pmatrix}\n=\n\\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n解得：\n1. $v_1 - v_2 = 0 \\implies v_1 = v_2$\n2. $v_2 - v_4 = 0 \\implies v_2 = v_4$\n3. $v_4 - v_5 = 0 \\implies v_4 = v_5$\n\n从这些方程可以清楚地看出，在这个线性通路中，所有通量在稳态时必须相等：$v_1 = v_2 = v_4 = v_5$。我们用 $v$ 表示这个共同的通量值。\n\n我们现在分析两种基因敲除情景。\n\n**情景 1：敲除基因 $g_A$**\n\n首先，我们对 GPR 规则进行求值。基因敲除会将其对应的布尔值设置为 False。我们假设未被敲除的基因是存在的，因此其值为 True。\n- 基因状态：$g_A = \\text{False}$，$g_B = \\text{True}$，$g_C = \\text{True}$，$g_D = \\text{True}$。\n- $R_2$ 的 GPR：$(g_A \\wedge g_B) = (\\text{False} \\wedge \\text{True}) = \\text{False}$。\n- $R_4$ 的 GPR：$(g_C \\vee g_D) = (\\text{True} \\vee \\text{True}) = \\text{True}$。\n\n由于 $R_2$ 的 GPR 求值结果为 False，该反应失活。根据问题陈述，其通量固定为零：$v_2 = 0$。\n考虑到稳态约束 $v_1 = v_2 = v_4 = v_5$，以及 $v_2=0$ 的事实，可以推断所有其他通量也必须为零：$v_1 = v_4 = v_5 = 0$。\n目标是最大化 $v_5$。唯一的可行值为 $v_5 = 0$。因此，最大生物质通量为 $v_5^{\\star} = 0$。\n这一结果明确验证了以下陈述：在一个必需的多基因复合物中（由 AND 规则表示）敲除一个基因可能是致命的，因为它会使反应失活，并且在本例中，完全关闭了生物质生产通路。\n\n**情景 2：敲除基因 $g_C$**\n\n我们再次对该情景下的 GPR 规则进行求值。\n- 基因状态：$g_A = \\text{True}$，$g_B = \\text{True}$，$g_C = \\text{False}$，$g_D = \\text{True}$。\n- $R_2$ 的 GPR：$(g_A \\wedge g_B) = (\\text{True} \\wedge \\text{True}) = \\text{True}$。\n- $R_4$ 的 GPR：$(g_C \\vee g_D) = (\\text{False} \\vee \\text{True}) = \\text{True}$。\n\n在这种情况下，两个 GPR 的求值结果都为 True。反应 $R_2$ 仍然活跃，因为基因 $g_B$ 存在。反应 $R_4$ 也仍然活跃，因为由基因 $g_D$ 编码的同工酶可以催化该反应。因此，两个反应都保持潜在的活性，并且它们原来的通量边界适用。\n\nFBA 问题是在通路活跃的条件下最大化 $v_5$。\n根据稳态条件，我们有共同通量 $v = v_1 = v_2 = v_4 = v_5$。\n这个共同通量 $v$ 的可行范围由所有单个反应通量边界的交集决定：\n- 来自 $R_1$：$0 \\leq v \\leq 12.0$\n- 来自 $R_2$：$0 \\leq v \\leq 7.8125$\n- 来自 $R_4$：$0 \\leq v \\leq 10.0$\n- 来自 $R_5$：$0 \\leq v \\leq 1000.0$\n\n为了同时满足所有约束，通量 $v$ 必须小于或等于所有上边界的最小值：\n$$v \\leq \\min(12.0, 7.8125, 10.0, 1000.0)$$\n$$v \\leq 7.8125$$\n目标是最大化 $v_5$，它等于 $v$。$v$ 的最大可行值为 $7.8125$。\n因此，最大生物质通量为 $v_5^{\\star} = 7.8125$。\n这一结果明确验证了以下陈述：从一个同工酶集（由 OR 规则表示）中敲除一个基因，如果集合中的另一个基因可以补偿，则可能不是致命的。在这里，生物质的生产完全不受 $g_C$ 敲除的影响。\n\n问题要求给出敲除 $g_C$ 后的 $v_5^{\\star}$ 值，并四舍五入到三位小数。计算值为 $7.8125$。将其四舍五入到三位小数得到 $7.813$。",
            "answer": "$$\\boxed{7.813}$$"
        },
        {
            "introduction": "虽然通量平衡分析（FBA）是一个强大的工具，但标准的FBA模型有时会产生生物学上不切实际的预测，例如由于热力学上不可行的无效循环而导致的“无中生有”式能量产生。这个练习旨在揭示标准FBA的这一常见陷阱，并介绍“无环路”（loopless）FBA作为一种重要的改进方法 。通过亲手实现和比较两种模式下的结果，您将学会如何识别并修正这些模型伪影，从而获得更可靠的基因必需性预测。",
            "id": "4345133",
            "problem": "您将获得一个微型代谢网络，用于通过流量平衡分析 (FBA) 及其禁止热力学上不可行内循环的无环变体来分析基因必需性。该网络有内部代谢物 $Glc$（内部葡萄糖）、$E$（三磷酸腺苷）、$D$（二磷酸腺苷）和 $P$（无机磷酸）。各反应及其对内部代谢物的化学计量贡献和默认边界如下所示：\n\n- $R_{\\mathrm{upt}}$：葡萄糖的外部摄取，内部表示为 $\\varnothing \\rightarrow Glc$，其下界为 $0$，上界参数 $U$ 由每个测试用例提供。\n- $R_{\\mathrm{cat}}$（由基因 $G_{\\mathrm{cat}}$ 催化）：葡萄糖分解代谢以产生能量，$Glc + D + P \\rightarrow E$，不可逆反应，下界为 $0$，上界为 $1000$。\n- $R_{\\mathrm{syn}}$：三磷酸腺苷合酶，$D + P \\leftrightarrow E$，可逆反应，下界为 $-100$，上界为 $100$（负流量表示反向反应）。\n- $R_{\\mathrm{atpase}}$：三磷酸腺苷水解，$E \\rightarrow D + P$，不可逆反应，下界为 $0$，上界为 $100$。\n\n对于按 $(Glc, E, D, P)$ 顺序排列的内部代谢物和按 $(R_{\\mathrm{upt}}, R_{\\mathrm{cat}}, R_{\\mathrm{syn}}, R_{\\mathrm{atpase}})$ 顺序排列的反应，其化学计量矩阵 $S \\in \\mathbb{R}^{4 \\times 4}$ 为：\n$$\nS =\n\\begin{bmatrix}\n+1  -1  0  0 \\\\\n0  +1  +1  -1 \\\\\n0  -1  -1  +1 \\\\\n0  -1  -1  +1 \\\\\n\\end{bmatrix}.\n$$\n\n建模基本原理：\n- 稳态质量平衡要求 $S \\, \\mathbf{v} = \\mathbf{0}$，其中 $\\mathbf{v} \\in \\mathbb{R}^{4}$ 是反应流量向量。\n- 标准流量平衡分析 (FBA) 选择 $\\mathbf{v}$ 以在 $S \\, \\mathbf{v} = \\mathbf{0}$ 和流量边界的约束下最大化一个生物学目标。\n- 基因敲除通过将其催化的反应的流量边界设置为 $[0, 0]$ 来建模。\n- 产能内循环是一个非零流量向量 $\\mathbf{v}_{\\mathrm{loop}}$，它满足 $S \\, \\mathbf{v}_{\\mathrm{loop}} = \\mathbf{0}$，且仅涉及内部反应，无净摄取或分泌。在标准FBA下，这种循环会人为地允许在没有底物消耗的情况下获得正的目标值。\n\n目标：\n- 目标是最大化通过 $R_{\\mathrm{atpase}}$ 的流量，记为 $v_{\\mathrm{atpase}}$。用线性规划的术语来说，就是最大化 $v_4$，其中 $v_4$ 是 $\\mathbf{v}$ 的第四个分量。\n\n必须实现两种优化模式：\n1. 标准FBA：在 $S \\, \\mathbf{v} = \\mathbf{0}$ 和默认边界（由测试用例输入修改）的约束下，最大化 $v_4$。\n2. 无环约束：通过禁止 $R_{\\mathrm{syn}}$ 的正向反应来增强标准 FBA，以消除内循环 $D + P \\rightarrow E \\rightarrow D + P$。具体来说，施加约束 $v_3 \\le 0$（即将 $R_{\\mathrm{syn}}$ 的上界设为 $0$），同时保留其下界 $-100$ 以允许反向反应。对于此网络而言，这是一个从热力学一致性推导出的充分的无环约束。\n\n基因-反应关联：\n- $G_{\\mathrm{cat}}$ 催化 $R_{\\mathrm{cat}}$。敲除 $G_{\\mathrm{cat}}$ 会将 $R_{\\mathrm{cat}}$ 的边界设置为 $[0, 0]$。\n\n为了可解释性，我们将“生存能力”定义为能够获得严格为正的最优目标值。但是，您的程序必须直接报告最优目标值。\n\n任务：\n- 实现一个程序，该程序为每个测试用例构建并求解相应的线性规划问题，在 $S \\, \\mathbf{v} = \\mathbf{0}$ 和指定的边界及模式约束下最大化 $v_4$，并返回最优目标值。\n\n测试套件：\n为以下六个测试用例提供结果，每个用例以三元组 $(\\text{mode}, U, \\text{knockouts})$ 的形式给出：\n1. $(\\text{\"standard\"}, \\, 0, \\, \\varnothing)$。\n2. $(\\text{\"loopless\"}, \\, 0, \\, \\varnothing)$。\n3. $(\\text{\"standard\"}, \\, 10, \\, \\{G_{\\mathrm{cat}}\\})$。\n4. $(\\text{\"loopless\"}, \\, 10, \\, \\{G_{\\mathrm{cat}}\\})$。\n5. $(\\text{\"loopless\"}, \\, 2, \\, \\varnothing)$。\n6. $(\\text{\"standard\"}, \\, 2, \\, \\varnothing)$。\n\n输入中的所有数值均为无单位、无量纲的流量。您的程序应为每个测试用例求解线性规划问题，并生成单行输出，其中包含六个最优目标值（最大化的 $v_4$），形式为用方括号括起来的逗号分隔列表，每个值都四舍五入到恰好三位小数，例如 $[x_1,x_2,x_3,x_4,x_5,x_6]$，其中每个 $x_i$ 是格式化为三位小数的浮点数。",
            "solution": "这个问题是有效的，因为它在系统生物学领域，特别是流量平衡分析 (FBA) 中，提出了一个适定且有科学依据的场景。所有必需的数据、约束和目标都已明确定义，构成了一系列标准的线性规划 (LP) 问题。\n\n任务的核心是在不同条件下，确定反应 $R_{\\mathrm{atpase}}$（由变量 $v_4$ 表示）的最大可能流量。这是一个经典的FBA问题，可以用线性规划来构建和求解。该优化问题是在一组线性等式和不等式约束下，最大化一个目标函数。\n\nFBA的基本方程是稳态假设 $S \\mathbf{v} = \\mathbf{0}$，其中 $S$ 是化学计量矩阵，$\\mathbf{v}$ 是反应流量向量。该方程对代谢网络施加了质量平衡约束，确保对于每个内部代谢物，其总生产速率等于总消耗速率。\n\n化学计量矩阵 $S \\in \\mathbb{R}^{4 \\times 4}$ 和流量向量 $\\mathbf{v} \\in \\mathbb{R}^{4}$ 分别是针对代谢物 $(Glc, E, D, P)$ 和反应 $(R_{\\mathrm{upt}}, R_{\\mathrm{cat}}, R_{\\mathrm{syn}}, R_{\\mathrm{atpase}})$ 给出的。流量向量为 $\\mathbf{v} = [v_1, v_2, v_3, v_4]^T$。\n等式约束由 $S \\mathbf{v} = \\mathbf{0}$ 给出：\n$$\n\\begin{bmatrix}\n+1  -1  0  0 \\\\\n0  +1  +1  -1 \\\\\n0  -1  -1  +1 \\\\\n0  -1  -1  +1 \\\\\n\\end{bmatrix}\n\\begin{bmatrix}\nv_1 \\\\ v_2 \\\\ v_3 \\\\ v_4\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n0 \\\\ 0 \\\\ 0 \\\\ 0\n\\end{bmatrix}\n$$\n这些矩阵方程对应于一个线性方程组：\n1. $v_1 - v_2 = 0$\n2. $v_2 + v_3 - v_4 = 0$\n3. $-v_2 - v_3 + v_4 = 0$\n4. $-v_2 - v_3 + v_4 = 0$\n\n请注意，$S$ 的最后两行是相同的，并且都是第二行的相反数。这意味着只有两个线性无关的约束：$v_1 = v_2$ 和 $v_4 = v_2 + v_3$。\n\n不等式约束是流量边界 $l_i \\le v_i \\le u_i$，它为每个反应 $i$ 定义了最小和最大允许流量。这些边界对每个测试用例都是特定的。\n\n目标是最大化流量 $v_4$。在通常执行最小化的LP求解器的标准形式中，这等价于最小化 $-v_4$。因此，要最小化的目标函数可以表示为 $\\mathbf{c}^T \\mathbf{v}$，其中成本向量为 $\\mathbf{c} = [0, 0, 0, -1]^T$。\n\n整个LP的构建如下：\n最小化 $\\mathbf{c}^T \\mathbf{v} = -v_4$\n约束条件：\n1. $S \\mathbf{v} = \\mathbf{0}$\n2. $\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}$\n\n解决方案将通过为六个测试用例中的每一个构建并使用 `scipy.optimize.linprog` 函数求解此LP来实现。对于每个用例，流量边界向量 $\\mathbf{u}$ 和 $\\mathbf{l}$ 将根据指定的模式（`\"standard\"` 或 `\"loopless\"`）、葡萄糖摄取上限 $U$ 和基因敲除进行调整。\n\n每个测试用例中每个反应 $v_i$ 的具体边界确定如下：\n- **默认边界**：$v_1 \\in [0, U]$, $v_2 \\in [0, 1000]$, $v_3 \\in [-100, 100]$, $v_4 \\in [0, 100]$。\n- **葡萄糖摄取**：$v_1$ 的上界由参数 $U$ 设定。\n- **基因敲除**：敲除 $G_{\\mathrm{cat}}$ 会将其关联的反应流量 $v_2$ 的边界设置为 $[0, 0]$。\n- **无环模式**：`\"loopless\"` 约束通过将 $R_{\\mathrm{syn}}$ ($v_3$) 的边界从 $[-100, 100]$ 修改为 $[-100, 0]$ 来实现。此修改禁止了 $R_{\\mathrm{syn}}$ 的正向流量，从而打破了热力学上不可行的无效循环，在这种循环中，$v_3  0$ 和 $v_4  0$ 可以在没有底物消耗（$v_1=v_2=0$）的情况下产生正的目标值。\n\n程序将遍历每个测试用例，组装适当的边界，并求解相应的LP。求解器返回的最优目标值 `res.fun` 是 $-v_4$ 的最小值。因此，$v_4$ 的最大值是 `-res.fun`。最终结果将按要求进行收集和格式化。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a series of Flux Balance Analysis (FBA) problems for a minimal metabolic network.\n\n    The function iterates through six test cases, each defined by an optimization mode,\n    a glucose uptake limit, and a set of gene knockouts. For each case, it formulates\n    and solves a linear programming problem to maximize the flux of an ATP hydrolysis reaction.\n    \"\"\"\n\n    # Stoichiometric matrix S for metabolites (Glc, E, D, P) and reactions\n    # (R_upt, R_cat, R_syn, R_atpase).\n    S_matrix = np.array([\n        [1., -1., 0., 0.],\n        [0., 1., 1., -1.],\n        [0., -1., -1., 1.],\n        [0., -1., -1., 1.]\n    ])\n\n    # The problem is to maximize v4, which is equivalent to minimizing -v4.\n    # The objective vector c for linprog is thus [0, 0, 0, -1].\n    c_objective = np.array([0., 0., 0., -1.])\n\n    # The steady-state condition Sv = 0 provides the equality constraints.\n    A_eq_constraints = S_matrix\n    b_eq_constraints = np.zeros(4)\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (mode, U, knockouts)\n    test_cases = [\n        (\"standard\", 0., set()),\n        (\"loopless\", 0., set()),\n        (\"standard\", 10., {\"G_cat\"}),\n        (\"loopless\", 10., {\"G_cat\"}),\n        (\"loopless\", 2., set()),\n        (\"standard\", 2., set()),\n    ]\n\n    results = []\n    for mode, U, knockouts in test_cases:\n        # Default bounds for fluxes (v1, v2, v3, v4)\n        # v1: R_upt, v2: R_cat, v3: R_syn, v4: R_atpase\n        bounds = [\n            (0., U),            # v1: R_upt, upper bound set by U\n            (0., 1000.),         # v2: R_cat\n            (-100., 100.),       # v3: R_syn\n            (0., 100.)           # v4: R_atpase\n        ]\n\n        # Apply gene knockout constraints\n        if \"G_cat\" in knockouts:\n            # G_cat knockout sets flux of R_cat (v2) to 0.\n            bounds[1] = (0., 0.)\n\n        # Apply mode-specific constraints\n        if mode == \"loopless\":\n            # Loopless constraint forbids the forward direction of R_syn (v3).\n            bounds[2] = (-100., 0.)\n\n        # Solve the linear programming problem\n        res = linprog(\n            c=c_objective,\n            A_eq=A_eq_constraints,\n            b_eq=b_eq_constraints,\n            bounds=bounds,\n            method='highs'  # Use a robust modern solver\n        )\n\n        # The result 'res.fun' is the minimum of -v4.\n        # The maximum v4 is -res.fun.\n        # Handle small negative value close to zero from solver tolerance\n        max_v4 = -res.fun if res.success else 0.\n        if abs(max_v4)  1e-9:\n             max_v4 = 0.0\n        \n        results.append(max_v4)\n\n    # Format the results to three decimal places and print in the specified format.\n    formatted_results = [f\"{r:.3f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在通量平衡分析中，实现最优目标（如最大生物量）的通量分布往往不是唯一的，这给结果的解读带来了挑战。一个基因的敲除看似不影响生长，但其关联的反应在所有最优解中都是必需的，还是仅在部分最优解中是可选的？本练习将介绍通量变异性分析（FVA）这一关键技术，以区分这两种情况 。通过在最优解空间内探索通量范围，您将能够更严谨地解释基因敲除的后果，避免对基因的必需性做出草率的结论。",
            "id": "4345180",
            "problem": "给定系统生物医学中标准通量平衡分析 (FBA) 框架下的稳态代谢网络模型，其中细胞内代谢物处于准稳态，通量满足质量平衡。令化学计量矩阵表示为 $S \\in \\mathbb{R}^{m \\times n}$，通量向量表示为 $\\mathbf{v} \\in \\mathbb{R}^{n}$，目标系数向量表示为 $\\mathbf{c} \\in \\mathbb{R}^{n}$。FBA 通过求解以下线性规划来计算最优目标值\n$$\n\\max_{\\mathbf{v} \\in \\mathbb{R}^{n}} \\; \\mathbf{c}^\\top \\mathbf{v} \\quad \\text{subject to} \\quad S \\mathbf{v} = \\mathbf{0}, \\; \\mathbf{\\ell} \\le \\mathbf{v} \\le \\mathbf{u},\n$$\n其中 $\\mathbf{\\ell} \\in \\mathbb{R}^{n}$ 和 $\\mathbf{u} \\in \\mathbb{R}^{n}$ 分别是下界和上界，等式 $S \\mathbf{v} = \\mathbf{0}$ 表示细胞内代谢物的稳态质量平衡。在基因敲除分析中，与被敲除基因相关的一组反应可能会被消除（通量设为零），而不会改变目标的最优值（例如，生物质生产通量 $v_{\\text{biomass}}$）。为了确定这些相关反应是在所有最优解中都被强制为零，还是仅在某些最优解中为零（即，在某些最优解中通量为零，但在其他最优解中通量非零），需要使用限制在最优解集合内的通量变异性分析 (FVA)。最优性条件下的通量变异性分析 (FVA) 将目标固定在其最优值上，并对每个反应 $i$ 计算在满足 $S \\mathbf{v} = \\mathbf{0}$，$\\mathbf{\\ell} \\le \\mathbf{v} \\le \\mathbf{u}$ 和 $\\mathbf{c}^\\top \\mathbf{v} = z^\\star$ 的约束下 $v_i$ 的最小和最大可行值，其中 $z^\\star$ 是通过 FBA 获得的最优目标值。如果最小值和最大值均等于 $0$（在指定的数值容差范围内），则 $v_i$ 在所有最优解中都被强制为零；否则，$v_i$ 可以在某些最优解中为零，但在其他解中为非零。\n\n基于细胞内稳态要求 $S \\mathbf{v} = \\mathbf{0}$ 以及线性规划是计算最优通量和范围的成熟数学工具这一基本前提，请实现以下步骤：\n1. 计算最优目标值 $z^\\star = \\max\\{\\mathbf{c}^\\top \\mathbf{v} \\mid S \\mathbf{v} = \\mathbf{0}, \\; \\mathbf{\\ell} \\le \\mathbf{v} \\le \\mathbf{u}\\}$。\n2. 对于给定的一组与基因敲除相关的反应中的每个反应索引 $i$，通过求解两个线性规划在最优性条件下执行 FVA，以获得\n$$\nv_i^{\\min} = \\min\\{v_i \\mid S \\mathbf{v} = \\mathbf{0}, \\; \\mathbf{\\ell} \\le \\mathbf{v} \\le \\mathbf{u}, \\; \\mathbf{c}^\\top \\mathbf{v} = z^\\star\\}\n$$\n和\n$$\nv_i^{\\max} = \\max\\{v_i \\mid S \\mathbf{v} = \\mathbf{0}, \\; \\mathbf{\\ell} \\le \\mathbf{v} \\le \\mathbf{u}, \\; \\mathbf{c}^\\top \\mathbf{v} = z^\\star\\}。\n$$\n3. 如果对于一个小的 $\\varepsilon  0$，有 $|v_i^{\\min}| \\le \\varepsilon$ 且 $|v_i^{\\max}| \\le \\varepsilon$，则将每个反应 $i$ 分类为“在所有最优解中都被强制为零”；否则，将其分类为“仅在某些最优解中为零”。以布尔值形式报告分类结果，其中 $\\,\\text{True}\\,$ 表示“在所有最优解中都被强制为零”，而 $\\,\\text{False}\\,$ 表示“仅在某些最优解中为零”。\n\n在此问题中，通量没有物理单位；将所有量视为无量纲实数。所有角度均不相关，也不使用百分比。分类时使用数值容差 $\\varepsilon = 10^{-9}$。\n\n测试套件：\n为三个测试用例实现上述过程，反应索引从零开始。对于每个用例，$S$、$\\ell$、$u$、$c$ 以及要分类的反应索引集指定如下。\n\n- 测试用例 1（一个存在无效循环从而允许多重最优解的网络）：\n  - 代谢物：$M_1$、$M_2$、$M_3$。\n  - 反应：$v_1$ (摄取)，$v_2$ (转化)，$v_3$ (生物质)，$v_4$ (循环正向)，$v_5$ (循环反向)，$v_6$ (废物)。\n  - 化学计量矩阵 $S^{(1)} \\in \\mathbb{R}^{3 \\times 6}$：\n    $$\n    S^{(1)} = \\begin{pmatrix}\n    1  -1  0  0  0  0 \\\\\n    0  1  -1  -1  1  -1 \\\\\n    0  0  0  1  -1  0\n    \\end{pmatrix}.\n    $$\n  - 下界 $\\ell^{(1)} = (0, 0, 0, 0, 0, 0)$。\n  - 上界 $u^{(1)} = (10, 1000, 1000, 1000, 1000, 1000)$。\n  - 目标系数 $c^{(1)} = (0, 0, 1, 0, 0, 0)$，因此生物质是 $v_3$。\n  - 要分类的反应索引集：$\\{3\\}$，在基于零的索引下对应于 $v_4$。\n  - 这次基因敲除不会改变 $\\max v_{\\text{biomass}}$，因为 $v_4$ 参与一个无效循环，该循环不改变向生物质的净转化。\n\n- 测试用例 2（一个在最优生物质条件下被抑制的竞争性废物消耗途径）：\n  - 与测试用例 1 中的 $S^{(1)}$、$\\ell^{(1)}$、$u^{(1)}$ 和 $c^{(1)}$ 相同。\n  - 要分类的反应索引集：$\\{5\\}$，在基于零的索引下对应于 $v_6$。\n  - 这次基因敲除不会改变 $\\max v_{\\text{biomass}}$，因为 $v_6$ 消耗生物质所需的前体，并且在所有最优解中均为 $0$。\n\n- 测试用例 3（一个被平凡阻塞的反应）：\n  - 代谢物：$M_1$、$M_2$。\n  - 反应：$v_1$ (摄取)，$v_2$ (生物质)，$v_3$ (从 $M_2$ 出发的被阻塞的废物)。\n  - 化学计量矩阵 $S^{(3)} \\in \\mathbb{R}^{2 \\times 3}$：\n    $$\n    S^{(3)} = \\begin{pmatrix}\n    1  -1  0 \\\\\n    0  0  -1\n    \\end{pmatrix}.\n    $$\n  - 下界 $\\ell^{(3)} = (0, 0, 0)$。\n  - 上界 $u^{(3)} = (5, 1000, 0)$。\n  - 目标系数 $c^{(3)} = (0, 1, 0)$，因此生物质是 $v_2$。\n  - 要分类的反应索引集：$\\{2\\}$，在基于零的索引下对应于 $v_3$。\n  - 这次基因敲除不会改变 $\\max v_{\\text{biomass}}$，因为 $v_3$ 在结构上被边界和质量平衡所阻塞。\n\n您的程序必须为这三个测试用例实现上述过程，并生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。列表中的每个元素对应一个测试用例，并且其本身是一个布尔值列表，顺序与该用例提供的反应索引集相同。例如，输出应如下所示：\n$$\n[[\\text{b}_{1,1}, \\dots],\\,[\\text{b}_{2,1}, \\dots],\\,[\\text{b}_{3,1}, \\dots]]\n$$\n其中 $b_{k,j} \\in \\{\\text{True}, \\text{False}\\}$ 表示测试用例 $k$ 的反应索引集中的第 $j$ 个反应是在所有最优解中被强制为零（$\\text{True}$）还是仅在某些最优解中为零（$\\text{False}$）。",
            "solution": "该问题要求在基因敲除情境下对代谢反应进行分类。具体来说，对于一个给定的反应，如果其敲除不改变最大目标值（例如生物质产量），我们必须确定其通量是在所有最优解中都被强制为零，还是可以在某些最优解中为非零，而在其他最优解中为零。此分析在通量平衡分析 (FBA) 和通量变异性分析 (FVA) 的既定数学框架内进行。\n\n该解决方案通过为每个测试用例遵循一个原则性的三步流程来实现，并利用线性规划作为核心计算工具。\n\n**第 1 步：使用 FBA 确定最优目标值**\n\n第一步是建立最优性基准。我们计算通过目标反应的最大可能稳态通量，记为 $z^\\star$。这是一个标准的 FBA 问题，其形式为一个线性规划 (LP)：\n$$\nz^\\star = \\max_{\\mathbf{v} \\in \\mathbb{R}^{n}} \\; \\mathbf{c}^\\top \\mathbf{v}\n$$\n约束条件如下：\n1.  **质量平衡**：$S \\mathbf{v} = \\mathbf{0}$。这组线性方程确保对于每种内部代谢物，其总生产速率等于总消耗速率，这与准稳态假设一致。\n2.  **通量边界**：$\\mathbf{\\ell} \\le \\mathbf{v} \\le \\mathbf{u}$。这些不等式将每个反应通量 $v_i$ 限制在热力学和生理学上可行的范围内。\n\n这个最大化问题使用数值 LP 求解器来解决。由于像 `scipy.optimize.linprog` 这样的标准求解器是为最小化问题设计的，我们求解等价的最小化负目标问题：$\\min_{\\mathbf{v}} \\; (-\\mathbf{c}^\\top \\mathbf{v})$。原始问题的最优值即为 $z^\\star = -(\\text{求解器得到的最小值})$。\n\n**第 2 步：在最优解空间内执行 FVA**\n\n一旦 $z^\\star$ 已知，我们就可以探索所有能够达到此最优目标值的可能通量分布 $\\mathbf{v}$ 的空间。这通过向原始约束集添加一个新约束 $\\mathbf{c}^\\top \\mathbf{v} = z^\\star$ 来实现。可行解空间现在被限制在与最优解对应的原始通量多胞体的面上。\n\n对于需要分类的每个反应索引 $i$，我们在这个受限空间内执行 FVA。这涉及求解两个额外的 LP，以找到通过反应 $i$ 的最小和最大可能通量：\n$$\nv_i^{\\min} = \\min\\{v_i \\mid S \\mathbf{v} = \\mathbf{0}, \\; \\mathbf{\\ell} \\le \\mathbf{v} \\le \\mathbf{u}, \\; \\mathbf{c}^\\top \\mathbf{v} = z^\\star\\}\n$$\n$$\nv_i^{\\max} = \\max\\{v_i \\mid S \\mathbf{v} = \\mathbf{0}, \\; \\mathbf{\\ell} \\le \\mathbf{v} \\le \\mathbf{u}, \\; \\mathbf{c}^\\top \\mathbf{v} = z^\\star\\}\n$$\n为了求解 $v_i^{\\min}$，LP 的目标是最小化 $v_i$。这可以通过将目标系数向量设置为 $e_i$ 来实现，其中 $e_i$ 是一个在索引 $i$ 处为 $1$、其他位置为 $0$ 的向量。为了求解 $v_i^{\\max}$，LP 的目标是最大化 $v_i$，这等价于最小化 $-v_i$。这可以通过将目标系数向量设置为 $-e_i$ 来实现。\n\n**第 3 步：对反应进行分类**\n\n数值对 $(v_i^{\\min}, v_i^{\\max})$ 定义了反应 $i$ 在所有可能的最优解中可以承载的完整通量范围。分类基于此范围进行：\n\n- 如果范围是零处的单个点（即 $v_i^{\\min} = 0$ 且 $v_i^{\\max} = 0$），这意味着通量 $v_i$ 在每个最优解中都必须为零。这样的反应被分类为“在所有最优解中都被强制为零”。\n\n- 如果范围非零（即 $v_i^{\\min}  0$ 或 $v_i^{\\max}  0$），则表明至少存在一个最优通量分布，其中 $v_i \\neq 0$。即使某个最优解中 $v_i=0$，但存在 $v_i \\neq 0$ 的其他最优解意味着该反应并非被严格强制为零。这种情况被分类为“仅在某些最优解中为零”。\n\n由于数值求解器中浮点运算的特性，与零直接比较是不可靠的。因此，分类时使用一个小的数值容差 $\\varepsilon = 10^{-9}$。当且仅当 $|v_i^{\\min}| \\le \\varepsilon$ 且 $|v_i^{\\max}| \\le \\varepsilon$ 时，反应 $i$ 被分类为“被强制为零”（对应布尔值 $\\text{True}$）。否则，它被分类为“仅在某些解中为零”（$\\text{False}$）。\n\n这整个 FBA-FVA 流程提供了一种严谨的、算法上定义明确的方法来回答问题，其基础是基于约束的建模的基本原则。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the gene deletion analysis problem for the given test cases using\n    Flux Balance Analysis (FBA) and Flux Variability Analysis (FVA).\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"S\": np.array([\n                [1, -1, 0, 0, 0, 0],\n                [0, 1, -1, -1, 1, -1],\n                [0, 0, 0, 1, -1, 0]\n            ]),\n            \"l\": np.array([0, 0, 0, 0, 0, 0]),\n            \"u\": np.array([10, 1000, 1000, 1000, 1000, 1000]),\n            \"c\": np.array([0, 0, 1, 0, 0, 0]),\n            \"indices_to_classify\": [3]\n        },\n        {\n            \"S\": np.array([\n                [1, -1, 0, 0, 0, 0],\n                [0, 1, -1, -1, 1, -1],\n                [0, 0, 0, 1, -1, 0]\n            ]),\n            \"l\": np.array([0, 0, 0, 0, 0, 0]),\n            \"u\": np.array([10, 1000, 1000, 1000, 1000, 1000]),\n            \"c\": np.array([0, 0, 1, 0, 0, 0]),\n            \"indices_to_classify\": [5]\n        },\n        {\n            \"S\": np.array([\n                [1, -1, 0],\n                [0, 0, -1]\n            ]),\n            \"l\": np.array([0, 0, 0]),\n            \"u\": np.array([5, 1000, 0]),\n            \"c\": np.array([0, 1, 0]),\n            \"indices_to_classify\": [2]\n        }\n    ]\n\n    results = []\n    tolerance = 1e-9\n\n    for case in test_cases:\n        S, l, u, c, indices = case[\"S\"], case[\"l\"], case[\"u\"], case[\"c\"], case[\"indices_to_classify\"]\n        m, n = S.shape\n\n        # Step 1: Compute optimal objective value z_star using FBA\n        # Objective is to maximize c'v, which is equivalent to minimizing -c'v\n        fba_res = linprog(c=-c, A_eq=S, b_eq=np.zeros(m), bounds=list(zip(l, u)), method='highs')\n\n        if not fba_res.success:\n            # Handle cases where the initial FBA is infeasible or unbounded\n            # For this problem's well-posed test cases, this path is not expected.\n            raise RuntimeError(\"Initial FBA problem failed to solve.\")\n        \n        z_star = -fba_res.fun\n\n        # Step 2  3: Perform FVA under optimality and classify\n        case_results = []\n        \n        # Prepare constraints for FVA: S*v = 0 and c'*v = z_star\n        A_eq_fva = np.vstack([S, c])\n        b_eq_fva = np.hstack([np.zeros(m), z_star])\n        bounds_fva = list(zip(l, u))\n\n        for i in indices:\n            # Find v_i^min\n            c_min = np.zeros(n)\n            c_min[i] = 1\n            fva_min_res = linprog(c=c_min, A_eq=A_eq_fva, b_eq=b_eq_fva, bounds=bounds_fva, method='highs')\n            \n            # Find v_i^max\n            c_max = np.zeros(n)\n            c_max[i] = -1 # to maximize, minimize the negative\n            fva_max_res = linprog(c=c_max, A_eq=A_eq_fva, b_eq=b_eq_fva, bounds=bounds_fva, method='highs')\n\n            if not (fva_min_res.success and fva_max_res.success):\n                raise RuntimeError(f\"FVA for reaction index {i} failed to solve.\")\n                \n            v_i_min = fva_min_res.fun\n            v_i_max = -fva_max_res.fun\n\n            # Classify based on tolerance\n            is_forced_zero = abs(v_i_min) = tolerance and abs(v_i_max) = tolerance\n            case_results.append(is_forced_zero)\n        \n        results.append(case_results)\n\n    # Final print statement in the exact required format.\n    # The template generates a compact, no-space JSON-like string, e.g., [[False],[True],[True]]\n    print(f\"[{','.join(str(r).replace(' ', '') for r in results)}]\")\n\nsolve()\n\n```"
        }
    ]
}