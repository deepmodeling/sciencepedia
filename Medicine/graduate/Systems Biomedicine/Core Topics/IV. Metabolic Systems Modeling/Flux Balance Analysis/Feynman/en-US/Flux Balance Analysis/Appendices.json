{
    "hands_on_practices": [
        {
            "introduction": "The foundation of any Flux Balance Analysis is the mathematical representation of a metabolic network. This exercise provides essential practice in constructing the stoichiometric matrix ($S$), which is the core of this representation, from a set of biochemical reactions. By applying the steady-state condition ($Sv=0$), you will explore the fundamental properties of the network and understand how its structure constrains its possible behaviors .",
            "id": "3913505",
            "problem": "Consider a small metabolic network to be analyzed using Flux Balance Analysis (FBA), where the metabolites are $A$, $B$, $C$, and $D$, and the reactions are given by $R_1: A + B \\to C$, $R_2: C \\to D$, and $R_3: D \\to A$. Treat all metabolites $A$, $B$, $C$, and $D$ as internal, and assume there are no exchange reactions present. Using only the fundamental definitions that (i) the stoichiometric matrix $S$ has one row per metabolite and one column per reaction, (ii) the entry $S_{ij}$ is the stoichiometric coefficient of metabolite $i$ in reaction $j$, and (iii) steady-state mass balance for internal metabolites imposes $S\\,\\mathbf{v} = \\mathbf{0}$ for the reaction flux vector $\\mathbf{v}$, perform the following:\n\n- Construct the stoichiometric matrix $S$ with rows ordered as $(A, B, C, D)$ and columns ordered as $(R_1, R_2, R_3)$. In your reasoning, specify the sign convention used for substrates and products.\n- Then, using the steady-state constraint $S\\,\\mathbf{v} = \\mathbf{0}$ and no exchange reactions, determine the dimension of the null space of $S$ (equivalently, the number of degrees of freedom in the steady-state flux vector $\\mathbf{v}$).\n\nProvide the final answer as a single integer with no units. No rounding is required. The answer must be a single real-valued number.",
            "solution": "The problem asks for two results derived from a small metabolic network: the construction of its stoichiometric matrix $S$ and the dimension of the null space of $S$. The analysis will be performed based on the principles of Flux Balance Analysis (FBA).\n\nFirst, we construct the stoichiometric matrix $S$. The problem specifies that the rows correspond to the metabolites in the order ($A$, $B$, $C$, $D$) and the columns correspond to the reactions in the order ($R_1$, $R_2$, $R_3$). The entry $S_{ij}$ represents the stoichiometric coefficient of metabolite $i$ in reaction $j$. We will use the standard convention where substrates (reactants) have negative coefficients and products have positive coefficients.\n\nThe reactions are given as:\n$R_1: A + B \\to C$\n$R_2: C \\to D$\n$R_3: D \\to A$\n\nLet's determine the columns of the $4 \\times 3$ matrix $S$:\n\nFor reaction $R_1$, metabolites $A$ and $B$ are consumed (substrates, coefficient $-1$), and metabolite $C$ is produced (product, coefficient $+1$). Metabolite $D$ is not involved (coefficient $0$). The first column of $S$ is therefore:\n$$\n\\begin{pmatrix} -1 \\\\ -1 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n\nFor reaction $R_2$, metabolite $C$ is consumed (substrate, coefficient $-1$), and metabolite $D$ is produced (product, coefficient $+1$). Metabolites $A$ and $B$ are not involved (coefficient $0$). The second column of $S$ is:\n$$\n\\begin{pmatrix} 0 \\\\ 0 \\\\ -1 \\\\ 1 \\end{pmatrix}\n$$\n\nFor reaction $R_3$, metabolite $D$ is consumed (substrate, coefficient $-1$), and metabolite $A$ is produced (product, coefficient $+1$). Metabolites $B$ and $C$ are not involved (coefficient $0$). The third column of $S$ is:\n$$\n\\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ -1 \\end{pmatrix}\n$$\n\nCombining these columns in the specified order gives the stoichiometric matrix $S$:\n$$\nS = \\begin{pmatrix}\n-1  0  1 \\\\\n-1  0  0 \\\\\n1  -1  0 \\\\\n0  1  -1\n\\end{pmatrix}\n$$\n\nNext, we must determine the dimension of the null space of $S$. The null space of $S$ is the set of all reaction flux vectors $\\mathbf{v} = \\begin{pmatrix} v_1  v_2  v_3 \\end{pmatrix}^T$ that satisfy the steady-state mass balance constraint $S\\,\\mathbf{v}=\\mathbf{0}$. The dimension of this vector space corresponds to the number of degrees of freedom in the system's steady-state fluxes.\n\nThe equation $S\\,\\mathbf{v}=\\mathbf{0}$ can be written as a system of linear homogeneous equations:\n$$\n\\begin{pmatrix}\n-1  0  1 \\\\\n-1  0  0 \\\\\n1  -1  0 \\\\\n0  1  -1\n\\end{pmatrix}\n\\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{pmatrix}\n= \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\nThis corresponds to the following four equations, representing the net change in concentration for each metabolite ($A, B, C, D$ respectively) at steady state:\n1.  $-v_1 + v_3 = 0$\n2.  $-v_1 = 0$\n3.  $v_1 - v_2 = 0$\n4.  $v_2 - v_3 = 0$\n\nWe solve this system for $v_1$, $v_2$, and $v_3$.\nFrom equation ($2$), we immediately find that $v_1 = 0$.\nSubstituting $v_1=0$ into equation ($1$), we get $-0 + v_3 = 0$, which implies $v_3 = 0$.\nSubstituting $v_1=0$ into equation ($3$), we get $0 - v_2 = 0$, which implies $v_2 = 0$.\nFinally, substituting $v_2=0$ and $v_3=0$ into equation ($4$) gives $0 - 0 = 0$, which is consistent with the other results.\n\nThe only solution to the system is $v_1=0$, $v_2=0$, and $v_3=0$. This means the flux vector must be the zero vector, $\\mathbf{v} = \\begin{pmatrix} 0  0  0 \\end{pmatrix}^T$.\nThe null space of $S$ therefore contains only a single element: the zero vector. A vector space that contains only the zero vector is defined to have a dimension of $0$.\n\nAlternatively, we can use the rank-nullity theorem, which states that for a matrix $S$ with $n$ columns, $\\text{rank}(S) + \\text{dim}(\\text{null}(S)) = n$. Here, $n=3$ (the number of reactions). To find the rank of $S$, we can check for the linear independence of its columns. The columns are linearly independent if the only solution to $k_1 c_1 + k_2 c_2 + k_3 c_3 = 0$ is $k_1=k_2=k_3=0$. This is precisely the system we solved for the fluxes $v_i$, and we found that the only solution is the trivial one. Therefore, the columns are linearly independent, and the rank of $S$ is equal to the number of columns, which is $3$.\nApplying the rank-nullity theorem:\n$$\n\\text{dim}(\\text{null}(S)) = n - \\text{rank}(S) = 3 - 3 = 0\n$$\nBoth methods yield the same result. The physical interpretation is that the network consumes metabolite $B$ but has no reaction producing it. Since there are no exchange reactions to supply $B$ from an external source, its concentration cannot be maintained at a steady state unless its consumption rate is zero. The only reaction consuming $B$ is $R_1$, so its flux $v_1$ must be $0$. This forces the other fluxes $v_2$ and $v_3$ to also be $0$ to maintain the balance of the other metabolites. Thus, the only possible steady state is one with no metabolic activity.\nThe dimension of the null space is $0$.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "Beyond describing a network, the true power of FBA lies in its predictive capabilities for optimizing biological processes. This practice problem transitions from foundational theory to a classic application in metabolic engineering: maximizing the production of a valuable compound. You will learn to incorporate biological constraints, such as minimum growth requirements, to calculate the maximum theoretical yield, a key metric for assessing the efficiency of an engineered organism .",
            "id": "1434421",
            "problem": "A bio-engineering team is optimizing a genetically modified microorganism to produce a high-value compound, Producene (P). The microorganism consumes a single substrate, SubstrateAlpha (S), from its environment. The simplified, relevant metabolic network operates at a steady state and consists of the following irreversible reactions, where A, B, and C are metabolic intermediates:\n\n1.  **Uptake reaction ($v_{uptake}$):** $\\text{S}_{\\text{external}} \\to S$\n2.  **Conversion 1 ($v_1$):** $S \\to A$\n3.  **Branch 1 ($v_2$):** $A \\to B$ (Pathway to Producene)\n4.  **Branch 2 ($v_3$):** $A \\to C$ (Pathway for cellular components)\n5.  **Product Formation ($v_4$):** $B \\to P$\n6.  **Biomass Synthesis ($v_{biomass}$):** $1B + 4C \\to \\text{Biomass}$\n7.  **Product Export ($v_{export}$):** $P \\to \\text{P}_{\\text{external}}$\n\nThe uptake rate of SubstrateAlpha is externally controlled and fixed at $v_{uptake} = 20$ mmol/gDW/hr. For the microorganism to remain viable and grow, the rate of biomass synthesis must be maintained at a minimum level, such that $v_{biomass} \\geq 2$ mmol/gDW/hr.\n\nYour task is to calculate the maximum theoretical yield of Producene. The yield is defined as the dimensionless ratio of the Producene export rate ($v_{export}$) to the SubstrateAlpha uptake rate ($v_{uptake}$). Express your answer as a single fraction in its simplest form.",
            "solution": "The goal is to find the maximum theoretical yield of Producene, $Y = v_{export} / v_{uptake}$, given a fixed substrate uptake rate and a minimum biomass production rate. We will use steady-state mass balances to solve for the yield.\n\n1.  **Set up the steady-state mass balance equations for each internal metabolite:**\n    -   Metabolite S: $v_{uptake} - v_1 = 0 \\implies v_1 = v_{uptake}$\n    -   Metabolite A: $v_1 - v_2 - v_3 = 0 \\implies v_2 + v_3 = v_1$\n    -   Metabolite B: $v_2 - v_4 - v_{biomass} = 0 \\implies v_4 = v_2 - v_{biomass}$\n    -   Metabolite C: $v_3 - 4v_{biomass} = 0 \\implies v_3 = 4v_{biomass}$\n    -   Metabolite P: $v_4 - v_{export} = 0 \\implies v_{export} = v_4$\n\n2.  **Express the product export flux ($v_{export}$) in terms of the substrate uptake ($v_{uptake}$) and biomass ($v_{biomass}$) fluxes:**\n    -   Substitute $v_3 = 4v_{biomass}$ into the balance for A: $v_2 + 4v_{biomass} = v_1$. Since $v_1 = v_{uptake}$, we have $v_2 = v_{uptake} - 4v_{biomass}$.\n    -   Substitute this expression for $v_2$ into the balance for B: $v_4 = (v_{uptake} - 4v_{biomass}) - v_{biomass} = v_{uptake} - 5v_{biomass}$.\n    -   Since $v_{export} = v_4$, we have the final relationship: $v_{export} = v_{uptake} - 5v_{biomass}$.\n\n3.  **Define the optimization problem:**\n    The yield is $Y = \\frac{v_{export}}{v_{uptake}} = \\frac{v_{uptake} - 5v_{biomass}}{v_{uptake}} = 1 - \\frac{5v_{biomass}}{v_{uptake}}$.\n    To maximize the yield $Y$ for a fixed $v_{uptake}$, we must minimize the biomass production rate, $v_{biomass}$.\n\n4.  **Determine the feasible range for $v_{biomass}$:**\n    -   The problem states a viability constraint: $v_{biomass} \\ge 2$ mmol/gDW/hr.\n    -   All reaction fluxes must be non-negative since they are irreversible. We must check fluxes that could become negative:\n        -   $v_2 = v_{uptake} - 4v_{biomass} \\ge 0 \\implies 20 \\ge 4v_{biomass} \\implies v_{biomass} \\le 5$.\n        -   $v_4 = v_{uptake} - 5v_{biomass} \\ge 0 \\implies 20 \\ge 5v_{biomass} \\implies v_{biomass} \\le 4$.\n    -   Combining all constraints, the feasible range for biomass production is $2 \\le v_{biomass} \\le 4$.\n\n5.  **Calculate the maximum yield:**\n    To maximize the yield, we select the minimum possible value for $v_{biomass}$ from its feasible range, which is $v_{biomass} = 2$.\n    Substitute $v_{uptake} = 20$ and $v_{biomass} = 2$ into the yield equation:\n    $$\n    Y_{max} = 1 - \\frac{5 \\times 2}{20} = 1 - \\frac{10}{20} = 1 - \\frac{1}{2} = \\frac{1}{2}\n    $$\nThe maximum theoretical yield of Producene is $\\frac{1}{2}$.",
            "answer": "$$\\boxed{\\frac{1}{2}}$$"
        },
        {
            "introduction": "Standard FBA can yield multiple solutions that achieve the same optimal objective, some of which may be biologically unrealistic due to unnecessarily high fluxes. This advanced problem introduces Parsimonious FBA (pFBA), a method that refines the solution by finding the most metabolically efficient flux distribution. This exercise will guide you through the formulation of pFBA as a bi-level optimization problem, demonstrating how to find a unique, resource-efficient solution that still achieves the maximal biological objective .",
            "id": "4342817",
            "problem": "Consider a metabolic network at steady state described by a stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$ and a flux vector $v \\in \\mathbb{R}^{n}$, with flux bounds $l \\leq v \\leq u$. The steady-state assumption imposes the mass-balance constraints $S v = 0$. Let the cellular growth rate be modeled by a linear objective $c^{\\top} v$, where $c \\in \\mathbb{R}^{n}$ selects the biomass reaction (one component of $v$). Parsimonious Flux Balance Analysis (pFBA) is a lexicographic optimization that first maximizes growth and then minimizes the total flux magnitude. Starting from the foundational steady-state and linear stoichiometric constraints, and without invoking any shortcut formulas, do the following:\n\n1. Formulate pFBA as a bi-level optimization problem that first maximizes growth $c^{\\top} v$ and then, among all optimal growth solutions, minimizes the total flux $\\sum_{i=1}^{n} |v_i|$.\n2. Present an equivalent single-level linear program by introducing appropriate auxiliary variables so that the absolute-value objective is replaced by a linear objective, while preserving the growth optimum $c^{\\top} v = z^{\\star}$ attained in the first level. Provide the final single-level linear program in symbolic form.\n3. Now consider the following concrete network, with internal metabolites $A$, $B$, and $C$, and reactions $R_1$ through $R_6$:\n\n- $R_1$: $A_{\\mathrm{ext}} \\to A$ with flux $v_1$ and bounds $0 \\leq v_1 \\leq 10$,\n- $R_2$: $A \\to B$ with flux $v_2$ and bounds $0 \\leq v_2 \\leq 1000$,\n- $R_3$: $A \\to C$ with flux $v_3$ and bounds $0 \\leq v_3 \\leq 1000$,\n- $R_4$: $B + C \\to \\text{Biomass}$ with flux $v_4$ and bounds $0 \\leq v_4 \\leq 1000$,\n- $R_5$: $C \\to C_{\\mathrm{ext}}$ with flux $v_5$ and bounds $0 \\leq v_5 \\leq 1000$,\n- $R_6$: $B \\to A$ with flux $v_6$ and bounds $0 \\leq v_6 \\leq 1000$.\n\nAssume internal steady-state mass balances for $A$, $B$, and $C$:\n$$\n\\begin{aligned}\nA: \\quad v_1 - v_2 - v_3 + v_6 = 0, \\\\\nB: \\quad v_2 - v_4 - v_6 = 0, \\\\\nC: \\quad v_3 - v_4 - v_5 = 0.\n\\end{aligned}\n$$\nLet the growth (biomass) objective be $c^{\\top} v = v_4$. Under the pFBA framework described above, compute the minimal possible total flux\n$$\n\\sum_{i=1}^{6} |v_i|\n$$\nachievable among all flux vectors $v$ that maximize $v_4$. Express your final numerical answer in $\\mathrm{mmol\\,gDW^{-1}\\,h^{-1}}$. Provide the exact value; do not round.",
            "solution": "This problem is solved in three parts as requested.\n\n### Part 1: Bi-level Optimization Formulation of pFBA\n\nParsimonious Flux Balance Analysis (pFBA) is a two-step optimization process. First, the maximal growth rate is found, and second, the total flux magnitude is minimized while holding the growth rate at its maximum.\n\n1.  **First Level (Maximize Growth):** Find the maximum growth rate, $z^{\\star}$, by solving a standard Flux Balance Analysis problem:\n    $$\n    z^{\\star} = \\max_{v} \\left( c^{\\top}v \\right)\n    $$\n    subject to:\n    $$\n    \\begin{aligned}\n    Sv = 0 \\\\\n    l \\le v \\le u\n    \\end{aligned}\n    $$\n2.  **Second Level (Minimize Flux):** Find the flux vector $v_{pFBA}$ that solves:\n    $$\n    \\min_{v} \\sum_{i=1}^{n} |v_i|\n    $$\n    subject to:\n    $$\n    \\begin{aligned}\n    Sv = 0 \\\\\n    l \\le v \\le u \\\\\n    c^{\\top}v = z^{\\star}\n    \\end{aligned}\n    $$\n\n### Part 2: Equivalent Single-Level Linear Program\n\nThe second level of pFBA involves minimizing a sum of absolute values, which is a non-linear objective. It can be converted into a linear program (LP). For each flux $v_i$, we can write $|v_i|$ as $v_i^{+} + v_i^{-}$ where $v_i = v_i^{+} - v_i^{-}$ and $v_i^{+}, v_i^{-} \\ge 0$. The minimization objective ensures that for any $i$, at least one of $v_i^{+}$ or $v_i^{-}$ is zero.\n\nThe single-level LP for the second step is:\n**Minimize:**\n$$\n\\sum_{i=1}^{n} (v_i^{+} + v_i^{-})\n$$\n**Subject to:**\n1. Steady-state: $S(v^{+} - v^{-}) = 0$\n2. Maximal growth: $c^{\\top}(v^{+} - v^{-}) = z^{\\star}$\n3. Flux bounds: $l \\le v^{+} - v^{-} \\le u$\n4. Non-negativity: $v_i^{+} \\ge 0$ and $v_i^{-} \\ge 0$ for all $i=1, \\dots, n$\n\n### Part 3: pFBA for the Concrete Network\n\nWe apply the pFBA procedure to the given metabolic network.\n\n**Step 1: Maximize growth ($v_4$)**\n\nWe use the steady-state equations to express fluxes in terms of the growth flux $v_4$ and other free fluxes.\nFrom $B: v_2 - v_4 - v_6 = 0 \\implies v_2 = v_4 + v_6$.\nFrom $C: v_3 - v_4 - v_5 = 0 \\implies v_3 = v_4 + v_5$.\nSubstitute these into the equation for $A$:\n$v_1 - (v_4 + v_6) - (v_4 + v_5) + v_6 = 0$\n$v_1 - 2v_4 - v_5 = 0 \\implies v_1 = 2v_4 + v_5$\n\nTo maximize $v_4$, we consider the constraints. All fluxes $v_i$ must be non-negative. The key constraint is on the uptake flux: $0 \\le v_1 \\le 10$.\nThis means $0 \\le 2v_4 + v_5 \\le 10$.\nTo maximize $v_4$, we must minimize $v_5$. Since $v_5 \\ge 0$, the minimum value is $v_5 = 0$.\nThe constraint becomes $2v_4 \\le 10$, which implies $v_4 \\le 5$.\nThus, the maximum growth rate is $z^{\\star} = v_{4, \\text{max}} = 5$.\n\n**Step 2: Minimize total flux magnitude**\n\nNow we fix the growth rate at its maximum, $v_4 = 5$, and minimize the total flux sum $\\sum_{i=1}^{6} |v_i|$. Since all fluxes are constrained to be non-negative ($v_i \\ge 0$), this simplifies to minimizing $\\sum_{i=1}^{6} v_i$.\n\nWith $v_4 = 5$, we have a set of solutions (an alternative optima space) that achieve this maximum. We need to find the one with the minimal total flux. The fluxes are:\n- $v_4 = 5$ (fixed)\n- From the maximization step, we know $v_5$ must be $0$ to achieve $v_4=5$.\n- $v_1 = 2v_4 + v_5 = 2(5) + 0 = 10$.\n- $v_3 = v_4 + v_5 = 5 + 0 = 5$.\n- $v_2 = v_4 + v_6 = 5 + v_6$.\n- $v_6$ is a free parameter. Its bounds are $0 \\le v_6 \\le 1000$. Also, $v_2 = 5+v_6$ must satisfy $0 \\le v_2 \\le 1000$, which implies $0 \\le 5+v_6 \\le 1000$, or $-5 \\le v_6 \\le 995$. The combined valid range for $v_6$ is $0 \\le v_6 \\le 995$.\n\nThe total flux sum, $J$, is:\n$J = v_1 + v_2 + v_3 + v_4 + v_5 + v_6$\n$J = 10 + (5 + v_6) + 5 + 5 + 0 + v_6 = 25 + 2v_6$\n\nTo minimize $J$, we must choose the minimum possible value for $v_6$ in its valid range, which is $v_6 = 0$.\nThe minimum total flux is $J_{min} = 25 + 2(0) = 25$.\n\nThe final pFBA flux distribution is $v = (10, 5, 5, 5, 0, 0)$. The minimal total flux is 25 $\\mathrm{mmol\\,gDW^{-1}\\,h^{-1}}$.",
            "answer": "$$\\boxed{25}$$"
        }
    ]
}