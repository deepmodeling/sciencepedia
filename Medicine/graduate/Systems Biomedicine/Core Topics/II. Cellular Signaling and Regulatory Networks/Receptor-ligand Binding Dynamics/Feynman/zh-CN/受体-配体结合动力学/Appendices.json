{
    "hands_on_practices": [
        {
            "introduction": "掌握受体-配体动力学的第一步是理解其最基本的平衡状态。这个练习将指导你推导出在平衡状态下，受体-配体复合物的饱和分数与游离配体浓度 $[L]$ 和解离常数 $K_D$ 之间的关系。这个关系式，通常被称为Langmuir吸附等温线，是定量药理学和生物化学中描述剂量-反应曲线的基石。",
            "id": "1462243",
            "problem": "在一个药物发现项目中，一组生物化学家正在研究细胞表面受体 $R$ 与其天然配体 $L$ 之间的相互作用。结合过程是可逆的，可用以下化学反应描述：\n$$R + L \\rightleftharpoons C$$\n其中 $C$ 代表受体-配体复合物。正向结合反应的速率与游离受体浓度 $[R]$ 和游离配体浓度 $[L]$ 成正比，其结合速率常数为 $k_{on}$。反向解离反应的速率与复合物浓度 $[C]$ 成正比，其解离速率常数为 $k_{off}$。\n\n该团队希望为此相互作用创建一个模型。该模型的一个关键参数是解离常数，定义为 $K_D = \\frac{k_{off}}{k_{on}}$。当系统达到稳态（即复合物的形成速率等于其解离速率）时，系统的生物学响应通常与结合了配体的受体占总受体的比例直接相关。\n\n你的任务是确定这个已结合受体比例的表达式。设游离配体浓度为 $[L]$，解离常数为 $K_D$。用 $[L]$ 和 $K_D$ 表示的已结合受体比例的表达式是什么？",
            "solution": "考虑可逆结合反应 $R + L \\rightleftharpoons C$，其结合速率为 $k_{on}[R][L]$，解离速率为 $k_{off}[C]$。在稳态（平衡）下，复合物形成的净速率为零，因此正向和反向速率相等：\n$$\nk_{on}[R][L] = k_{off}[C].\n$$\n整理并使用定义 $K_{D} = \\frac{k_{off}}{k_{on}}$，得到平衡关系式\n$$\n\\frac{[R][L]}{[C]} = K_{D}.\n$$\n由此求解用 $[C]$ 和 $[L]$ 表示的 $[R]$：\n$$\n[R] = \\frac{K_{D}[C]}{[L]}.\n$$\n\n设总受体浓度为 $[R]_{T} = [R] + [C]$。代入 $[R]$ 的表达式：\n$$\n[R]_{T} = \\frac{K_{D}[C]}{[L]} + [C] = [C]\\left(\\frac{K_{D}}{[L]} + 1\\right).\n$$\n求解复合物浓度分数 $[C]/[R]_{T}$：\n$$\n\\frac{[C]}{[R]_{T}} = \\frac{1}{\\frac{K_{D}}{[L]} + 1} = \\frac{[L]}{K_{D} + [L]}.\n$$\n因此，已结合受体占总受体的比例为 $\\frac{[L]}{K_{D} + [L]}$。",
            "answer": "$$\\boxed{\\frac{[L]}{K_{D} + [L]}}$$"
        },
        {
            "introduction": "基础模型往往依赖于一个重要假设：配体浓度远大于受体浓度，因此结合过程不会显著消耗游离配体。然而，在许多真实的生物场景中（例如，当受体表达水平很高或配体有限时），这个假设并不成立。这个练习将挑战你放弃这一简化假设，通过严格的质量守恒定律推导出一个更普适的结合模型，并求解描述平衡状态下复合物浓度的二次方程。",
            "id": "4382845",
            "problem": "考虑一个处于封闭、等温、充分混合隔室中的单一位点受体-配体系统，该系统发生基本可逆反应 $R + L \\rightleftharpoons RL$。设总受体浓度和总配体浓度分别为 $R_T$ 和 $L_T$。系统处于热力学平衡状态并遵循质量守恒，因此有 $R_T = [R] + [RL]$ 和 $L_T = [L] + [RL]$。假设为 $1{:}1$ 结合，且不存在配体过量的情况，这意味着 $R_T$ 和 $L_T$ 相对于彼此均不可忽略。在平衡状态下，质量作用比通过 $K_D = \\frac{[R][L]}{[RL]}$ 定义了平衡解离常数（$K_D$）。仅使用这些基本事实，推导平衡状态下复合物浓度 $[RL]$ 的控制多项式方程，并以闭合形式显式求解。根据非负性和守恒关系的约束，确定物理上允许的根。仅用 $R_T$、$L_T$ 和 $K_D$ 表示 $[RL]$ 的最终解析表达式。以摩尔浓度（M）为单位表示最终浓度。无需进行数值计算或四舍五入；请精确呈现最终结果。",
            "solution": "问题陈述经评估有效。它具有科学依据，论述严谨且客观，描述了热力学平衡下单一位点双分子结合的标准模型。该问题是自洽的，并提供了所有必要的定义和守恒定律，以推导出唯一且具有物理意义的解。任务是推导受体-配体复合物平衡浓度 $[RL]$ 的控制方程，并对其进行显式求解。\n\n系统由可逆反应 $R + L \\rightleftharpoons RL$ 定义。在平衡状态下，各物质的浓度通过平衡解离常数 $K_D$ 相关联：\n$$K_D = \\frac{[R][L]}{[RL]}$$\n系统是封闭的，因此受体总浓度 $R_T$ 和配体总浓度 $L_T$ 是守恒的。这由质量守恒关系表示：\n$$R_T = [R] + [RL]$$\n$$L_T = [L] + [RL]$$\n我们的目标是找到一个用常数 $R_T$、$L_T$ 和 $K_D$ 表示 $[RL]$ 的表达式。为此，我们必须从 $K_D$ 方程中消去游离浓度 $[R]$ 和 $[L]$。\n\n根据质量守恒方程，我们可以将游离浓度表示为：\n$$[R] = R_T - [RL]$$\n$$[L] = L_T - [RL]$$\n将这些表达式代入 $K_D$ 的定义中：\n$$K_D = \\frac{(R_T - [RL])(L_T - [RL])}{[RL]}$$\n这个方程将 $[RL]$ 与已知的总浓度和解离常数联系起来。为了解出 $[RL]$，我们将此方程重排成标准的多项式形式。为简化代数运算过程中的记法，令 $x = [RL]$。\n$$K_D x = (R_T - x)(L_T - x)$$\n展开右侧的乘积得：\n$$K_D x = R_T L_T - R_T x - L_T x + x^2$$\n现在我们可以将所有项移到一边，形成一个关于变量 $x$ 的二次方程：\n$$x^2 - R_T x - L_T x - K_D x + R_T L_T = 0$$\n合并 $x$ 的一次项，我们得到平衡复合物浓度的控制多项式方程：\n$$x^2 - (R_T + L_T + K_D)x + R_T L_T = 0$$\n这是一个形如 $ax^2 + bx + c = 0$ 的二次方程，其系数为：\n$a = 1$\n$b = -(R_T + L_T + K_D)$\n$c = R_T L_T$\n\n$x = [RL]$ 的解由二次方程求根公式给出：\n$$[RL] = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$$\n代入系数：\n$$[RL] = \\frac{(R_T + L_T + K_D) \\pm \\sqrt{(-(R_T + L_T + K_D))^2 - 4(1)(R_T L_T)}}{2(1)}$$\n$$[RL] = \\frac{(R_T + L_T + K_D) \\pm \\sqrt{(R_T + L_T + K_D)^2 - 4R_T L_T}}{2}$$\n这给出了 $[RL]$ 的两个可能的根。我们现在必须确定物理上允许的根。系统的物理约束是浓度必须为非负值。根据质量守恒定律，这意味着复合物的浓度 $[RL]$ 不能超过受体或配体的总浓度：\n$$[RL] \\ge 0$$\n$$[RL] \\le R_T$$\n$$[RL] \\le L_T$$\n\n让我们分析这两个根，记为 $[RL]_+$ 和 $[RL]_-$。\n\n考虑带正号的根：\n$$[RL]_+ = \\frac{(R_T + L_T + K_D) + \\sqrt{(R_T + L_T + K_D)^2 - 4R_T L_T}}{2}$$\n我们来检验这个根是否违反约束条件 $[RL] \\le R_T$。该不等式为：\n$$\\frac{(R_T + L_T + K_D) + \\sqrt{(R_T + L_T + K_D)^2 - 4R_T L_T}}{2} \\le R_T$$\n$$(L_T + K_D - R_T) + \\sqrt{(R_T + L_T + K_D)^2 - 4R_T L_T} \\le 0$$\n$$\\sqrt{(R_T + L_T + K_D)^2 - 4R_T L_T} \\le R_T - L_T - K_D$$\n左侧本身是非负的。为了使该不等式有可能成立，右侧也必须为非负，即 $R_T \\ge L_T + K_D$。假设此条件成立，我们可以对两边取平方：\n$$(R_T + L_T + K_D)^2 - 4R_T L_T \\le (R_T - L_T - K_D)^2$$\n展开两边：\n$$R_T^2+L_T^2+K_D^2+2R_TL_T+2R_TK_D+2L_TK_D - 4R_TL_T \\le R_T^2+L_T^2+K_D^2-2R_TL_T-2R_TK_D+2L_TK_D$$\n化简代数式：\n$$-2R_TL_T + 2R_TK_D + 2L_TK_D \\le -2R_TL_T - 2R_TK_D + 2L_TK_D$$\n$$2R_TK_D \\le -2R_TK_D$$\n$$4R_TK_D \\le 0$$\n由于 $R_T$ 是总浓度，$K_D$ 是物理常数，两者都是非负的（$R_T \\ge 0$，$K_D \\ge 0$）。因此，$4R_TK_D \\ge 0$。不等式 $4R_TK_D \\le 0$ 仅在 $R_T = 0$ 或 $K_D = 0$ 时成立。对于任何 $R_T  0$ 和 $K_D  0$ 的物理现实场景，该不等式都不成立。这意味着假设 $[RL]_+ \\le R_T$ 是错误的。因此，$[RL]_+  R_T$，这个根因违反质量守恒而物理上不可取。\n\n现在，考虑带负号的根：\n$$[RL]_- = \\frac{(R_T + L_T + K_D) - \\sqrt{(R_T + L_T + K_D)^2 - 4R_T L_T}}{2}$$\n这必须是物理上允许的解。我们来验证其性质。\n1. 非负性（$[RL]_- \\ge 0$）：\n这要求 $(R_T + L_T + K_D) \\ge \\sqrt{(R_T + L_T + K_D)^2 - 4R_T L_T}$。由于两边都是非负的，我们可以对它们取平方：\n$$(R_T + L_T + K_D)^2 \\ge (R_T + L_T + K_D)^2 - 4R_T L_T$$\n$$0 \\ge -4R_T L_T \\quad \\implies \\quad 4R_T L_T \\ge 0$$\n对于非负浓度 $R_T$ 和 $L_T$，这总是成立的。因此，$[RL]_-$ 总是非负的。\n2. 上限（$[RL]_- \\le R_T$ 和 $[RL]_- \\le L_T$）：\n从我们对 `+` 根的分析中，我们推导出严格不等式 $[RL]_+  R_T$（对于 $R_T  0, K_D  0$）。二次方程 $x^2+px+q=0$ 的根之和为 $x_1+x_2=-p$。在我们的情况下，$[RL]_+ + [RL]_- = R_T + L_T + K_D$。由于 $[RL]_+$ 可证明地大于 $R_T$，因此 $[RL]_-$ 必须更小。形式证明过程与 `+` 根的证明类似，但不等号反向，从而得出条件 $0 \\le 4R_TK_D$，该条件总是成立。对称逻辑证实了 $[RL]_- \\le L_T$。\n\n因此，受体-配体复合物平衡浓度的唯一物理允许解是带负号的根。按照要求，表达式以摩尔浓度（M）为单位给出，前提是输入参数 $R_T$、$L_T$ 和 $K_D$ 也使用这些单位。",
            "answer": "$$\\boxed{\\frac{(R_T + L_T + K_D) - \\sqrt{(R_T + L_T + K_D)^2 - 4R_T L_T}}{2}}$$"
        },
        {
            "introduction": "理论模型最终要与实验数据相结合。这项计算实践将引导你从理论走向实际应用，探索协同结合（cooperative binding）的希尔（Hill）模型。你不仅需要拟合模型以估计关键参数，如半饱和浓度 $K_{1/2}$ 和希尔系数 $n_H$，更重要的是，你需要评估在存在实验噪声的情况下，这些参数的可识别性（identifiability），这是系统生物医学研究中评估模型可靠性的核心技能。",
            "id": "4382780",
            "problem": "您将构建一个完整、可运行的程序，该程序在协同结合假说下模拟受体-配体滴定数据，从含噪声的模拟数据中估计表观半饱和浓度和希尔系数，并使用费雪信息矩阵（FIM）评估参数的可辨识性。请以纯数学术语和明确的算法步骤进行工作，并确保您的程序是确定性的。\n\n科学基础和假设如下：\n\n- 从质量作用定律出发：对于单个结合事件，受体-配体复合物的形成和解离速率由 $k_{\\text{on}}$ 和 $k_{\\text{off}}$ 控制，在平衡状态下，分数占据率可以表示为配体浓度 $[L]$ 和解离常数 $K_{\\mathrm{d}}$ 的函数。在表现出协同性的系统中，一种唯象的宏观描述将多个微观步骤聚合成占据率与 $[L]$ 之间的有效平衡关系。\n\n- 将表观半饱和浓度 $K_{1/2}$ 定义为归一化响应等于 $1/2$ 时的配体浓度。\n\n- 将希尔系数 $n_{\\mathrm{H}}$ 定义为半饱和时希尔图的斜率，即 $n_{\\mathrm{H}}$ 是 $\\log\\left(\\frac{y}{1-y}\\right)$ 关于 $\\log [L]$ 的导数在 $y=1/2$ 处的值，其中 $y$ 是分数占据率或归一化效应。\n\n- 测量噪声被建模为独立的、同分布的、零均值的高斯噪声，其已知标准差为 $\\sigma_{y}$（以与测量响应相同的单位表示）。\n\n您的程序必须：\n\n- 模拟滴定数据，方法是在一组指定的配体浓度 $[L]$ 上生成响应 $y([L])$，添加指定 $\\sigma_{y}$ 和固定随机种子的的高斯噪声，然后使用一个由三个正参数（最大响应 $B_{\\max}$、表观半饱和浓度 $K_{1/2}$ 和希尔系数 $n_{\\mathrm{H}}$）参数化的协同结合响应模型进行拟合。您必须通过带正性约束的非线性最小二乘法来估计 $B_{\\max}$、$K_{1/2}$ 和 $n_{\\mathrm{H}}$。\n\n- 计算残差相对于参数在最优点处的雅可比矩阵 $J$、近似费雪信息矩阵（FIM） $\\mathcal{I} \\approx J^{\\top}J/\\hat{\\sigma}^{2}$（其中 $\\hat{\\sigma}^{2}$ 是残差方差）、条件数 $\\kappa(\\mathcal{I})$ 以及近似参数协方差 $\\hat{\\Sigma} \\approx \\hat{\\sigma}^{2}(J^{\\top}J)^{-1}$。\n\n- 根据 $\\hat{\\Sigma}$，计算 $K_{1/2}$ 和 $n_{\\mathrm{H}}$ 的标准误以及在正态近似下的双侧 $95\\%$ 置信区间。使用这些来量化可辨识性。\n\n- 根据以下规则，将 $K_{1/2}$ 和 $n_{\\mathrm{H}}$ 的联合可辨识性声明为单个布尔值：拟合必须收敛且估计值必须严格为正；条件数 $\\kappa(\\mathcal{I})$ 必须小于 $10^{8}$；$K_{1/2}$ 和 $n_{\\mathrm{H}}$ 都必须具有有限的 $95\\%$ 置信区间，并且其相对半宽度小于 $0.5$（即，$1.96$ 乘以标准误再除以估计值的绝对值小于 $0.5$）。\n\n- 报告估计的 $K_{1/2}$（单位为纳摩尔，nM）和 $n_{\\mathrm{H}}$（无量纲值）。\n\n- 对于所有计算，使用标准双精度。除了将浓度值解释为纳摩尔外，不需要进行其他物理单位转换。\n\n测试套件：\n\n模拟以下定义的三个测试用例。在每个用例中，从具有真实参数 $(B_{\\max}^{\\mathrm{true}},K_{1/2}^{\\mathrm{true}},n_{\\mathrm{H}}^{\\mathrm{true}})$ 的协同结合响应生成滴定数据，然后添加标准差为 $\\sigma_{y}$ 的高斯噪声。\n\n- 用例 1（良好辨识，宽范围，低噪声）：\n  - 真实参数：$B_{\\max}^{\\mathrm{true}}=1.0$, $K_{1/2}^{\\mathrm{true}}=50.0\\,\\text{nM}$, $n_{\\mathrm{H}}^{\\mathrm{true}}=2.0$。\n  - 浓度：$[L]$ 在 $0.5\\,\\text{nM}$ 到 $5000\\,\\text{nM}$ 之间对数间隔的 30 个点。\n  - 噪声：$\\sigma_{y}=0.02$。随机种子：$12345$。\n\n- 用例 2（相同范围，更高噪声）：\n  - 真实参数：$B_{\\max}^{\\mathrm{true}}=1.0$, $K_{1/2}^{\\mathrm{true}}=50.0\\,\\text{nM}$, $n_{\\mathrm{H}}^{\\mathrm{true}}=2.0$。\n  - 浓度：$[L]$ 在 $0.5\\,\\text{nM}$ 到 $5000\\,\\text{nM}$ 之间对数间隔的 30 个点。\n  - 噪声：$\\sigma_{y}=0.15$。随机种子：$67890$。\n\n- 用例 3（饱和附近的有限范围，低噪声，曲率信息差）：\n  - 真实参数：$B_{\\max}^{\\mathrm{true}}=1.0$, $K_{1/2}^{\\mathrm{true}}=50.0\\,\\text{nM}$, $n_{\\mathrm{H}}^{\\mathrm{true}}=2.0$。\n  - 浓度：$[L]$ 在 $100\\,\\text{nM}$ 到 $5000\\,\\text{nM}$ 之间对数间隔的 15 个点。\n  - 噪声：$\\sigma_{y}=0.02$。随机种子：$24680$。\n\n程序要求：\n\n- 精确按照描述实现带正性约束的非线性最小二乘法，并计算所需的可辨识性指标，不使用任何外部数据。通过指定的种子使用确定性的伪随机数生成。\n\n- 将最终估计的 $K_{1/2}$ 以 $\\text{nM}$ 为单位表示，将 $n_{\\mathrm{H}}$ 表示为无量纲数。将 $K_{1/2}$ 和 $n_{\\mathrm{H}}$ 的输出值均四舍五入到三位有效数字。\n\n- 最终输出格式：您的程序应生成单行输出，其中包含三个用例的结果，格式为 Python 风格的列表的列表，每个内部列表按 $[K_{1/2}^{\\text{est}}\\ \\text{in nM},\\ n_{\\mathrm{H}}^{\\text{est}},\\ \\text{identifiable}]$ 的顺序列出。例如，打印的行必须具有 $[[x_{1},y_{1},b_{1}],[x_{2},y_{2},b_{2}],[x_{3},y_{3},b_{3}]]$ 的形式，其中 $x_{i}$ 和 $y_{i}$ 是浮点数，$b_{i}$ 是布尔值。不应打印任何其他文本。",
            "solution": "该问题要求开发一个计算工作流程，用于在协同结合假说下模拟和分析受体-配体滴定数据。此过程涉及三个主要阶段：首先，基于希尔模型并叠加高斯噪声生成合成数据；其次，通过非线性最小二乘法从这些含噪声数据中估计模型参数；第三，使用基于费雪信息矩阵（FIM）的方法对这些参数的实际可辨识性进行严格评估。\n\n**1. 协同结合模型：希尔方程**\n\n对于表现出协同性的系统，配体浓度 $[L]$ 与测量响应 $y$ 之间的关系可通过希尔方程进行唯象描述。该模型由一组三个正参数表征：最大响应 $B_{\\max}$、表观半饱和浓度 $K_{1/2}$ 和希尔系数 $n_{\\mathrm{H}}$。模型的函数形式为：\n$$ y([L]; B_{\\max}, K_{1/2}, n_{\\mathrm{H}}) = B_{\\max} \\frac{[L]^{n_{\\mathrm{H}}}}{K_{1/2}^{n_{\\mathrm{H}}} + [L]^{n_{\\mathrm{H}}}} $$\n在此方程中，$B_{\\max}$ 表示在饱和配体浓度下的渐近响应。$K_{1/2}$ 代表响应 $y$ 达到其最大值一半时的配体浓度，即 $y(K_{1/2}) = B_{\\max}/2$。希尔系数 $n_{\\mathrm{H}}$ 量化了协同性的程度：$n_{\\mathrm{H}}  1$ 意味着正协同性（变构增强结合），$n_{\\mathrm{H}}  1$ 暗示负协同性，而 $n_{\\mathrm{H}} = 1$ 则恢复为非协同性的 Michaelis-Menten 或 Langmuir 结合等温线。\n\n**2. 数据模拟**\n\n对于每个指定的测试用例，我们生成一组模拟观测值。设真实参数为 $\\theta^{\\mathrm{true}} = (B_{\\max}^{\\mathrm{true}}, K_{1/2}^{\\mathrm{true}}, n_{\\mathrm{H}}^{\\mathrm{true}})$。\n首先，生成一个包含 $N$ 个配体浓度的向量 $\\{[L]_i\\}_{i=1}^N$。对于每个浓度 $[L]_i$，计算其真实（无噪声）响应：\n$$ y_i^{\\mathrm{true}} = y([L]_i; \\theta^{\\mathrm{true}}) $$\n测量噪声被建模为独立的、同分布的（i.i.d.）随机变量 $\\epsilon_i$，这些变量从均值为零、标准差为指定值 $\\sigma_y$ 的正态分布中抽取，即 $\\epsilon_i \\sim \\mathcal{N}(0, \\sigma_y^2)$。模拟的观测值 $y_i^{\\mathrm{obs}}$ 则由下式给出：\n$$ y_i^{\\mathrm{obs}} = y_i^{\\mathrm{true}} + \\epsilon_i $$\n为了确保结果的确定性和可复现性，伪随机数生成器会为每个测试用例使用特定的种子进行初始化。\n\n**3. 通过非线性最小二乘法（NLLS）进行参数估计**\n\n目标是从模拟数据 $([L]_i, y_i^{\\mathrm{obs}})$ 中估计参数 $\\theta = (B_{\\max}, K_{1/2}, n_{\\mathrm{H}})$。这通过最小化残差平方和（SSR）来实现，SSR 是 NLLS 的目标函数：\n$$ \\hat{\\theta} = \\arg\\min_{\\theta} \\sum_{i=1}^{N} \\left( y_i^{\\mathrm{obs}} - y([L]_i; \\theta) \\right)^2 $$\n参数搜索受到正性约束 $B_{\\max}  0$、$K_{1/2}  0$ 和 $n_{\\mathrm{H}}  0$ 的限制。这个约束优化问题通过数值方法求解，其中信赖域反射（`trf`）算法是合适的选择。\n\n**4. 参数可辨识性分析**\n\n实际可辨识性关注的是模型参数是否能从给定的有限且含噪声的数据集中被唯一且精确地估计出来。我们使用从 NLLS 拟合中导出的几个指标来评估这一点。设 $\\hat{\\theta}$ 为最优参数向量。\n\n**雅可比矩阵：**分析始于模型残差向量 $r(\\theta)$ 在估计参数 $\\hat{\\theta}$ 处评估的雅可比矩阵 $J$。残差向量的分量为 $r_i(\\theta) = y_i^{\\mathrm{obs}} - y([L]_i; \\theta)$。雅可比矩阵是一个 $N \\times 3$ 矩阵，其元素为：\n$$ J_{ij}(\\hat{\\theta}) = \\frac{\\partial r_i}{\\partial \\theta_j} \\bigg|_{\\theta=\\hat{\\theta}} = - \\frac{\\partial y([L]_i; \\theta)}{\\partial \\theta_j} \\bigg|_{\\theta=\\hat{\\theta}} $$\n希尔函数关于其参数的偏导数是：\n- $\\frac{\\partial y}{\\partial B_{\\max}} = \\frac{[L]^{n_{\\mathrm{H}}}}{K_{1/2}^{n_{\\mathrm{H}}} + [L]^{n_{\\mathrm{H}}}}$\n- $\\frac{\\partial y}{\\partial K_{1/2}} = - B_{\\max} n_{\\mathrm{H}} K_{1/2}^{n_{\\mathrm{H}}-1} \\frac{[L]^{n_{\\mathrm{H}}}}{(K_{1/2}^{n_{\\mathrm{H}}} + [L]^{n_{\\mathrm{H}}})^2}$\n- $\\frac{\\partial y}{\\partial n_{\\mathrm{H}}} = B_{\\max} \\frac{[L]^{n_{\\mathrm{H}}} K_{1/2}^{n_{\\mathrm{H}}} \\ln([L]/K_{1/2})}{(K_{1/2}^{n_{\\mathrm{H}}} + [L]^{n_{\\mathrm{H}}})^2}$\n\n**费雪信息与协方差：**在 i.i.d. 高斯噪声的假设下，费雪信息矩阵（FIM）的一个近似由下式给出：\n$$ \\mathcal{I} \\approx \\frac{J^{\\top}J}{\\hat{\\sigma}^2} $$\n其中 $J$ 是在 $\\hat{\\theta}$ 处评估的雅可比矩阵，$\\hat{\\sigma}^2$ 是估计的残差方差。使用方差的无偏估计量：\n$$ \\hat{\\sigma}^2 = \\frac{\\text{SSR}(\\hat{\\theta})}{N - p} $$\n其中 $p=3$ 是参数的数量。\nFIM 的逆矩阵为任何无偏估计量的方差提供了克拉默-拉奥下界。因此，近似的参数协方差矩阵 $\\hat{\\Sigma}$ 为：\n$$ \\hat{\\Sigma} \\approx \\mathcal{I}^{-1} = \\hat{\\sigma}^2 (J^{\\top}J)^{-1} $$\n\n**可辨识性指标：**\n- **条件数：**FIM 的条件数 $\\kappa(\\mathcal{I})$ 衡量了参数估计对数据变化的敏感度。大的条件数表明 FIM 接近奇异，这意味着参数估计之间存在强相关性，因此可辨识性差。它计算为 $\\mathcal{I}$ 的最大特征值与最小特征值之比。问题指定了 $\\kappa(\\mathcal{I})  10^8$ 的阈值。\n- **标准误和置信区间：**参数估计 $\\hat{\\theta}_j$ 的标准误（SE）是协方差矩阵相应对角元素的平方根，即 $\\text{SE}(\\hat{\\theta}_j) = \\sqrt{\\hat{\\Sigma}_{jj}}$。使用正态分布近似计算 $95\\%$ 置信区间（CI）为 $\\hat{\\theta}_j \\pm 1.96 \\times \\text{SE}(\\hat{\\theta}_j)$。\n- **可辨识性规则：**$K_{1/2}$ 和 $n_{\\mathrm{H}}$ 的联合可辨识性由一个复合布尔规则确定：\n    1. NLLS 优化必须成功收敛，并且所有估计参数必须严格为正。\n    2. FIM 的条件数必须小于 $10^8$。\n    3. $K_{1/2}$ 和 $n_{\\mathrm{H}}$ 的 $95\\%$ 置信区间都必须是有限的。这要求 $(J^{\\top}J)$ 是可逆的。\n    4. $K_{1/2}$ 和 $n_{\\mathrm{H}}$ 的 $95\\%$ CI 的相对半宽度都必须小于 $0.5$。参数 $\\hat{\\theta}_j$ 的相对半宽度定义为 $\\frac{1.96 \\times \\text{SE}(\\hat{\\theta}_j)}{|\\hat{\\theta}_j|}$。\n\n这一全面的流程允许定量评估实验设计和数据质量是否足以可靠地确定模型参数。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import least_squares\n\ndef solve():\n    \"\"\"\n    Main function to simulate, fit, and analyze cooperative binding data for three test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"name\": \"Case 1: Well-identified, wide range, low noise\",\n            \"true_params\": (1.0, 50.0, 2.0),\n            \"L_config\": {\"start\": 0.5, \"stop\": 5000, \"num\": 30},\n            \"sigma_y\": 0.02,\n            \"seed\": 12345\n        },\n        {\n            \"name\": \"Case 2: Same range, higher noise\",\n            \"true_params\": (1.0, 50.0, 2.0),\n            \"L_config\": {\"start\": 0.5, \"stop\": 5000, \"num\": 30},\n            \"sigma_y\": 0.15,\n            \"seed\": 67890\n        },\n        {\n            \"name\": \"Case 3: Limited range near saturation, low noise\",\n            \"true_params\": (1.0, 50.0, 2.0),\n            \"L_config\": {\"start\": 100, \"stop\": 5000, \"num\": 15},\n            \"sigma_y\": 0.02,\n            \"seed\": 24680\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = analyze_binding_case(\n            case[\"true_params\"],\n            case[\"L_config\"],\n            case[\"sigma_y\"],\n            case[\"seed\"]\n        )\n        results.append(result)\n\n    # Format the final output as a Python-style list of lists.\n    # The boolean values True/False must be lowercase as per Python syntax.\n    output_str = \"[\" + \",\".join(\n        f\"[{k},{n},{str(b).lower()}]\" for k, n, b in results\n    ) + \"]\"\n    print(output_str)\n\n\ndef analyze_binding_case(true_params, L_config, sigma_y, seed):\n    \"\"\"\n    Performs the simulation, fitting, and identifiability analysis for a single case.\n    \n    Args:\n        true_params (tuple): (Bmax_true, K12_true, nH_true).\n        L_config (dict): Configuration for ligand concentrations.\n        sigma_y (float): Standard deviation of Gaussian noise.\n        seed (int): Seed for the random number generator.\n\n    Returns:\n        list: [k12_est_rounded, nH_est_rounded, is_identifiable].\n    \"\"\"\n    \n    Bmax_true, K12_true, nH_true = true_params\n    \n    # 1. Simulate titration data\n    L = np.logspace(np.log10(L_config[\"start\"]), np.log10(L_config[\"stop\"]), L_config[\"num\"])\n    y_true = hill_equation(true_params, L)\n    rng = np.random.default_rng(seed)\n    noise = rng.normal(0, sigma_y, size=L.shape)\n    y_obs = y_true + noise\n\n    # 2. Perform Nonlinear Least Squares (NLLS) fitting\n    p0 = [Bmax_true, K12_true, nH_true] # Initial guess\n    bounds = (0, np.inf)\n    \n    res = least_squares(\n        fun=residuals,\n        x0=p0,\n        args=(L, y_obs),\n        bounds=bounds,\n        method='trf'\n    )\n    \n    # Initialize default results for non-identifiable case\n    k_est_final, nH_est_final, is_identifiable = np.nan, np.nan, False\n\n    # 3. Assess identifiability\n    # Condition 1: Fit must converge and estimates must be positive\n    if res.success and np.all(res.x  0):\n        p_est = res.x\n        Bmax_est, K12_est, nH_est = p_est\n        \n        N = len(y_obs)  # Number of data points\n        p_num = len(p_est)  # Number of parameters\n\n        try:\n            # Jacobian J from the fit results\n            jac = res.jac\n\n            # Calculate J^T * J\n            jtj = jac.T @ jac\n            \n            # Check if J^T*J is invertible\n            if np.linalg.matrix_rank(jtj)  p_num:\n                raise np.linalg.LinAlgError(\"Singular matrix\")\n\n            # Residual variance estimate\n            ssr = np.sum(res.fun**2)\n            residual_variance = ssr / (N - p_num)\n\n            # Approximate Fisher Information Matrix (FIM)\n            fim = jtj / residual_variance \n            \n            # Condition 2: Condition number of FIM\n            kappa_fim = np.linalg.cond(fim)\n            cond_num_ok = kappa_fim  1e8\n\n            # Approximate Covariance Matrix\n            cov_matrix = residual_variance * np.linalg.inv(jtj)\n            \n            # Standard Errors\n            se = np.sqrt(np.diag(cov_matrix))\n            se_Bmax, se_K12, se_nH = se\n\n            # Condition 3: Finite confidence intervals (implied by finite SE)\n            finite_ci_ok = np.all(np.isfinite(se))\n\n            # Condition 4: Relative half-width of CIs for K1/2 and nH\n            # rel_half_width = 1.96 * SE / estimate\n            rel_hw_k12 = 1.96 * se_K12 / K12_est\n            rel_hw_nH = 1.96 * se_nH / nH_est\n            \n            rel_hw_ok = (abs(rel_hw_k12)  0.5) and (abs(rel_hw_nH)  0.5)\n\n            # Combine all identifiability conditions\n            if cond_num_ok and finite_ci_ok and rel_hw_ok:\n                is_identifiable = True\n                k_est_final = format_sig_figs(K12_est, 3)\n                nH_est_final = format_sig_figs(nH_est, 3)\n            else: # If any condition fails, but fit was successful\n                k_est_final = format_sig_figs(K12_est, 3)\n                nH_est_final = format_sig_figs(nH_est, 3)\n                is_identifiable = False\n\n        except np.linalg.LinAlgError:\n            # If J^T*J is singular, identifiability check fails\n            k_est_final = format_sig_figs(p_est[1], 3)\n            nH_est_final = format_sig_figs(p_est[2], 3)\n            is_identifiable = False\n    else: # If fit did not converge or gave non-positive parameters\n        is_identifiable = False\n        # Use NaN or initial guess, problem requires outputting estimates anyway.\n        # Try to provide last estimate if available, otherwise NaN\n        if res.x is not None:\n             k_est_final = format_sig_figs(res.x[1], 3) if res.x[1]0 else np.nan\n             nH_est_final = format_sig_figs(res.x[2], 3) if res.x[2]0 else np.nan\n        else:\n             k_est_final, nH_est_final = np.nan, np.nan\n\n    return [k_est_final, nH_est_final, is_identifiable]\n\ndef hill_equation(p, L):\n    \"\"\"\n    Calculates the response based on the Hill equation.\n    \n    Args:\n        p (tuple/list): Parameters (Bmax, K1/2, nH).\n        L (ndarray): Ligand concentrations.\n        \n    Returns:\n        ndarray: The calculated response y.\n    \"\"\"\n    Bmax, K12, nH = p\n    return Bmax * (L**nH) / (K12**nH + L**nH)\n\ndef residuals(p, L, y_obs):\n    \"\"\"\n    Calculates the residuals between observed data and the Hill model.\n    \"\"\"\n    return y_obs - hill_equation(p, L)\n\ndef format_sig_figs(num, sig_figs):\n    \"\"\"\n    Rounds a number to a specified number of significant figures.\n    \"\"\"\n    if not np.isfinite(num) or num == 0:\n        return num\n    return float(f'{num:.{sig_figs}g}')\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}