{
    "hands_on_practices": [
        {
            "introduction": "这第一个练习是代谢网络数学表示法的基础介绍。通过为一个简化的糖酵解途径构建化学计量矩阵（$S$）并计算其零空间基，我们将探索控制稳态行为的基本约束，并理解为何孤立的线性途径无法维持连续运作 。这为所有通量平衡分析奠定了基础。",
            "id": "4390646",
            "problem": "考虑一个用于代谢紊乱中代谢表型通量平衡分析（FBA, Flux Balance Analysis）的简化、闭合细胞、不可逆的胞质内糖酵解子系统。内部代谢物为 $\\mathrm{Glc}$ (葡萄糖)、$\\mathrm{G6P}$ (葡萄糖-$6$-磷酸)、$\\mathrm{F6P}$ (果糖-$6$-磷酸)、$\\mathrm{FBP}$ (果糖-$1,6$-二磷酸)、$\\mathrm{GAP}$ (甘油醛-$3$-磷酸) 和 $\\mathrm{Pyr}$ (丙酮酸)。反应向量为 $v = (v_{1}, v_{2}, v_{3}, v_{4}, v_{5})^{\\top}$，反应如下进行，具有整数化学计量且无交换反应：\n$$\n\\begin{aligned}\nR_{1}:\\ \\mathrm{Glc} \\rightarrow \\mathrm{G6P},\\\\\nR_{2}:\\ \\mathrm{G6P} \\rightarrow \\mathrm{F6P},\\\\\nR_{3}:\\ \\mathrm{F6P} \\rightarrow \\mathrm{FBP},\\\\\nR_{4}:\\ \\mathrm{FBP} \\rightarrow 2\\,\\mathrm{GAP},\\\\\nR_{5}:\\ \\mathrm{GAP} \\rightarrow \\mathrm{Pyr}.\n\\end{aligned}\n$$\n使用代谢网络的基本质量平衡模型，即代谢物浓度向量 $x$ 的时间导数满足 $\\frac{d x}{d t} = S v$，其中 $S$ 是根据反应化学计量组装的化学计量矩阵，$v$ 是通量向量。在稳态下，通量必须满足 $S v = 0$。\n\n任务：\n1. 针对代谢物排序 $(\\mathrm{Glc}, \\mathrm{G6P}, \\mathrm{F6P}, \\mathrm{FBP}, \\mathrm{GAP}, \\mathrm{Pyr})$ 和反应排序 $(R_{1}, R_{2}, R_{3}, R_{4}, R_{5})$ 组装化学计量矩阵 $S$。\n2. 计算 $\\mathrm{null}(S)$ 的一个基。\n3. 判断在这个没有交换反应的闭合网络中是否存在非平凡的稳态通量，并从第一性原理出发证明你的结论。\n\n报告最终数值答案，即维度 $\\dim(\\mathrm{null}(S))$。将最终答案表示为整数。无需四舍五入。",
            "solution": "首先对问题陈述进行验证。\n\n### 第 1 步：提取已知条件\n- **代谢物**：$\\mathrm{Glc}$、$\\mathrm{G6P}$、$\\mathrm{F6P}$、$\\mathrm{FBP}$、$\\mathrm{GAP}$、$\\mathrm{Pyr}$\n- **代谢物排序**：$(\\mathrm{Glc}, \\mathrm{G6P}, \\mathrm{F6P}, \\mathrm{FBP}, \\mathrm{GAP}, \\mathrm{Pyr})$\n- **反应向量**：$v = (v_{1}, v_{2}, v_{3}, v_{4}, v_{5})^{\\top}$\n- **反应排序**：$(R_{1}, R_{2}, R_{3}, R_{4}, R_{5})$\n- **反应**：\n  - $R_{1}: \\mathrm{Glc} \\rightarrow \\mathrm{G6P}$\n  - $R_{2}: \\mathrm{G6P} \\rightarrow \\mathrm{F6P}$\n  - $R_{3}: \\mathrm{F6P} \\rightarrow \\mathrm{FBP}$\n  - $R_{4}: \\mathrm{FBP} \\rightarrow 2\\,\\mathrm{GAP}$\n  - $R_{5}: \\mathrm{GAP} \\rightarrow \\mathrm{Pyr}$\n- **系统模型**：$\\frac{d x}{d t} = S v$，其中 $x$ 是代谢物浓度向量。\n- **稳态条件**：$S v = 0$。\n- **网络属性**：闭合细胞、不可逆、无交换反应。\n- **任务**：\n  1. 组装化学计量矩阵 $S$。\n  2. 计算 $\\mathrm{null}(S)$ 的一个基。\n  3. 判断是否存在非平凡的稳态通量。\n- **要求的最终答案**：$\\dim(\\mathrm{null}(S))$。\n\n### 第 2 步：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n- **科学依据**：该问题使用了糖酵解途径的简化但标准的表示方法。控制方程 $\\frac{d x}{d t} = S v$ 和稳态条件 $S v = 0$ 是通量平衡分析（FBA）和代谢网络建模的基本原理。该问题在化学和数学上是合理的。\n- **定义明确的**：所有必要信息都已提供。代谢物和反应的排序已明确定义，从而可以无歧义地构建化学计量矩阵 $S$。任务清晰，并能导出一个唯一的、有意义的数学解。\n- **客观性**：问题陈述使用精确、正式的语言，没有任何主观或模棱两可的术语。\n\n该问题不存在任何已定义的缺陷（例如，科学上不合理、不完整、矛盾、不真实）。这是系统生物学中一个标准的、定义明确的问题。\n\n### 第 3 步：结论与行动\n问题有效。将提供完整解答。\n\n### 解答\n\n解答过程通过处理问题陈述中指定的三个任务来进行。\n\n**任务 1：组装化学计量矩阵 $S$。**\n化学计量矩阵 $S$ 的构建方式是，每个元素 $S_{ij}$ 代表代谢物 $i$ 在反应 $j$ 中的化学计量系数。行对应于指定顺序的代谢物 $(\\mathrm{Glc}, \\mathrm{G6P}, \\mathrm{F6P}, \\mathrm{FBP}, \\mathrm{GAP}, \\mathrm{Pyr})$，列对应于反应 $(R_{1}, R_{2}, R_{3}, R_{4}, R_{5})$。按照惯例，反应物的系数为负，产物的系数为正。\n\n- **第 1 行 ($\\mathrm{Glc}$)**：在 $R_{1}$ 中被消耗 (系数为 $-1$)。行为 $(-1, 0, 0, 0, 0)$。\n- **第 2 行 ($\\mathrm{G6P}$)**：在 $R_{1}$ 中生成 (系数为 $+1$)，在 $R_{2}$ 中被消耗 (系数为 $-1$)。行为 $(1, -1, 0, 0, 0)$。\n- **第 3 行 ($\\mathrm{F6P}$)**：在 $R_{2}$ 中生成 (系数为 $+1$)，在 $R_{3}$ 中被消耗 (系数为 $-1$)。行为 $(0, 1, -1, 0, 0)$。\n- **第 4 行 ($\\mathrm{FBP}$)**：在 $R_{3}$ 中生成 (系数为 $+1$)，在 $R_{4}$ 中被消耗 (系数为 $-1$)。行为 $(0, 0, 1, -1, 0)$。\n- **第 5 行 ($\\mathrm{GAP}$)**：在 $R_{4}$ 中生成 (系数为 $+2$)，在 $R_{5}$ 中被消耗 (系数为 $-1$)。行为 $(0, 0, 0, 2, -1)$。\n- **第 6 行 ($\\mathrm{Pyr}$)**：在 $R_{5}$ 中生成 (系数为 $+1$)。行为 $(0, 0, 0, 0, 1)$。\n\n将这些行组合起来，得到 $6 \\times 5$ 的化学计量矩阵 $S$：\n$$\nS = \\begin{pmatrix}\n-1  0  0  0  0 \\\\\n1  -1  0  0  0 \\\\\n0  1  -1  0  0 \\\\\n0  0  1  -1  0 \\\\\n0  0  0  2  -1 \\\\\n0  0  0  0  1\n\\end{pmatrix}\n$$\n\n**任务 2：计算 $\\mathrm{null}(S)$ 的一个基。**\n$S$ 的零空间，记作 $\\mathrm{null}(S)$，是所有满足 $S v = 0$ 的向量 $v \\in \\mathbb{R}^5$ 的集合。这个条件可以转化为一个线性方程组：\n$$\n\\begin{pmatrix}\n-1  0  0  0  0 \\\\\n1  -1  0  0  0 \\\\\n0  1  -1  0  0 \\\\\n0  0  1  -1  0 \\\\\n0  0  0  2  -1 \\\\\n0  0  0  0  1\n\\end{pmatrix}\n\\begin{pmatrix} v_{1} \\\\ v_{2} \\\\ v_{3} \\\\ v_{4} \\\\ v_{5} \\end{pmatrix}\n=\n\\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n该方程组可以写为：\n1. $-v_{1} = 0$\n2. $v_{1} - v_{2} = 0$\n3. $v_{2} - v_{3} = 0$\n4. $v_{3} - v_{4} = 0$\n5. $2v_{4} - v_{5} = 0$\n6. $v_{5} = 0$\n\n我们可以通过代入法求解该方程组。\n- 根据方程 (6)，我们得到 $v_{5} = 0$。\n- 将 $v_{5} = 0$ 代入方程 (5) 得到 $2v_{4} - 0 = 0$，这意味着 $v_{4} = 0$。\n- 将 $v_{4} = 0$ 代入方程 (4) 得到 $v_{3} - 0 = 0$，这意味着 $v_{3} = 0$。\n- 将 $v_{3} = 0$ 代入方程 (3) 得到 $v_{2} - 0 = 0$，这意味着 $v_{2} = 0$。\n- 根据方程 (1)，我们得到 $v_{1} = 0$。\n- 方程 (2) 是一致的：$v_1 - v_2 = 0 - 0 = 0$。\n\n唯一的解是 $v_{1} = v_{2} = v_{3} = v_{4} = v_{5} = 0$。这意味着零空间只包含零向量：$\\mathrm{null}(S) = \\{0\\}$。这个平凡向量空间的基是空集 $\\emptyset$。零空间的维度 $\\dim(\\mathrm{null}(S))$ 是其基中向量的数量，即 $0$。\n\n或者，我们可以使用秩-零度定理，该定理指出 $\\mathrm{rank}(S) + \\dim(\\mathrm{null}(S)) = n$，其中 $n$ 是 $S$ 的列数。在这里，$n=5$。$S$ 的列是 $\\mathbb{R}^6$ 中的向量。通过观察，这五个列向量是线性无关的。因此，$S$ 的秩是 $5$。应用该定理：$5 + \\dim(\\mathrm{null}(S)) = 5$，得出 $\\dim(\\mathrm{null}(S)) = 0$。\n\n**任务 3：判断是否存在非平凡的稳态通量。**\n稳态通量向量 $v$ 是 $S v = 0$ 的一个解。非平凡稳态通量是一个非零解。正如在任务 2 中确定的，对于该系统，$S v = 0$ 的唯一解是平凡解 $v = 0$。因此，不存在非平凡的稳态通量。\n\n从第一性原理出发的证明如下。该系统被描述为“闭合细胞”，且“无交换反应”。这意味着没有通量允许代谢物进入或离开系统。然而，反应途径本身是开放式的。\n- 代谢物 $\\mathrm{Glc}$ 仅由 $R_1$ 消耗。为了将其浓度维持在稳态（$\\frac{d[\\mathrm{Glc}]}{dt} = -v_1 = 0$），通量 $v_1$ 必须为零。\n- 代谢物 $\\mathrm{Pyr}$ 仅由 $R_5$ 生成。为了将其浓度维持在稳态（$\\frac{d[\\mathrm{Pyr}]}{dt} = v_5 = 0$），通量 $v_5$ 必须为零。\n从途径的任一端开始，并要求边界代谢物处于稳态，会迫使整个通量分布为零。例如，如果 $v_5 = 0$，那么从 $2v_4 - v_5 = 0$ 我们得到 $v_4=0$。沿着途径向上追溯这个依赖关系链，我们发现所有通量都必须为零。因此，在这个闭合的线性途径中，不可能存在非零的稳态通量。\n\n最终要求的答案是零空间的维度 $\\dim(\\mathrm{null}(S))$。根据任务 2 中的分析，该值为 $0$。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "从结构分析转向功能预测，本实践将通量平衡分析（FBA）的核心原理应用于一个实际场景。你将通过编写代码实现一个线性规划问题来最大化 ATP 产量，并学习计算和解释代谢物的“影子价格”。这个练习展示了 FBA 不仅能预测最优通量分布，还能量化关键资源对于实现生物学目标的价值。",
            "id": "4390696",
            "problem": "考虑一个由化学计量质量守恒描述的稳态代谢网络。在稳态下，每种代谢物的净生成和消耗必须平衡，这由线性约束 $S v = b$ 表示，其中 $S \\in \\mathbb{R}^{m \\times n}$ 是化学计量矩阵，$v \\in \\mathbb{R}^n$ 是反应通量向量，$b \\in \\mathbb{R}^m$ 是表示任何代谢物净供给或需求的右端向量（对于一个封闭的细胞内网络，$b$ 是零向量）。通量平衡分析（FBA）选择与质量平衡和边界约束一致，并能优化一个线性目标 $c^\\top v$ 的通量，其中 $c \\in \\mathbb{R}^n$。\n\n您将为一个与代谢紊乱相关的简化糖酵解-乳酸网络，实现并求解一个 FBA 问题，其中代谢物行按 $\\{\\text{Glc}, \\text{Pyr}, \\text{Lac}, \\text{ATP}\\}$ 顺序排列，反应列按 $\\{v_1, v_2, v_3, v_4, v_5, v_6\\}$ 顺序排列。所有通量必须以 $\\text{mmol}\\ \\text{gDW}^{-1}\\ \\text{h}^{-1}$ 为单位表示。\n\n化学计量矩阵 $S$ 和目标向量 $c$ 如下：\n$$\nS = \n\\begin{bmatrix}\n+1  -1  0  0  0  0 \\\\\n0  +2  -1  -1  0  0 \\\\\n0  0  +1  0  -1  0 \\\\\n0  +2  0  0  0  -1\n\\end{bmatrix},\\quad\nc = \n\\begin{bmatrix}\n0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 1\n\\end{bmatrix}.\n$$\n这些反应代表：\n- $v_1$: 葡萄糖摄取（从外部到细胞内葡萄糖），\n- $v_2$: 糖酵解（葡萄糖生成丙酮酸和三磷酸腺苷），\n- $v_3$: 乳酸脱氢酶（丙酮酸生成乳酸），\n- $v_4$: 线粒体丙酮酸消耗（丙酮酸汇），\n- $v_5$: 乳酸输出（从细胞内乳酸到外部），\n- $v_6$: 三磷酸腺苷维持（三磷酸腺苷消耗）。\n\n约束条件为 $S v = b$（其中 $b = 0$，即长度为 4 的零向量）以及各反应的边界：\n- $0 \\le v_1 \\le G_{\\max}$，\n- $0 \\le v_2 \\le 1000$，\n- $0 \\le v_3 \\le 1000$，\n- $0 \\le v_4 \\le U_{\\text{mito}}$，\n- $0 \\le v_5 \\le L_{\\max}$，\n- $m_{\\min} \\le v_6 \\le 1000$。\n\n目标是最大化三磷酸腺苷维持通量，即最大化 $c^\\top v = v_6$。\n\n您的程序必须：\n1. 为每个测试用例构建线性规划问题，即在满足 $S v = b$ 和上述边界约束的条件下，最小化 $-c^\\top v$，求解最优通量向量 $v^\\star$，并计算等式约束的相应对偶变量。将这些对偶变量解释为代谢物的影子价格，其定义为最优目标值相对于 $b$ 边际变化的敏感性；对于 $-c^\\top v$ 的最小化问题，代谢物的影子价格向量为 $-\\lambda$，其中 $\\lambda$ 是求解器返回的等式约束对偶变量。\n2. 数值验证影子价格的解释：对于每个等式约束 $i \\in \\{1,2,3,4\\}$，将 $b_i$ 扰动一个微小的量 $\\delta$（单位与通量相同，为 $\\text{mmol}\\ \\text{gDW}^{-1}\\ \\text{h}^{-1}$），重新求解线性规划，并将最大化目标 $c^\\top v$ 的实测变化与影子价格给出的预测变化进行比较。使用 $\\delta = 10^{-6}$ 并报告绝对误差。\n\n测试套件：\n- 情况 A（正常路径，多个活动限制）：$G_{\\max} = 10$，$U_{\\text{mito}} = 6$，$L_{\\max} = 5$，$m_{\\min} = 0.1$。\n- 情况 B（边界条件，线粒体功能关闭）：$G_{\\max} = 10$，$U_{\\text{mito}} = 0$，$L_{\\max} = 8$，$m_{\\min} = 0.1$。\n- 情况 C（边界情况，摄取受限但处理能力充足）：$G_{\\max} = 3$，$U_{\\text{mito}} = 100$，$L_{\\max} = 100$，$m_{\\min} = 0.1$。\n\n输出规范：\n- 对于每个测试用例，输出一个包含三个元素的列表：\n    1. 最优通量向量 $v^\\star$，为一个包含六个浮点数的列表，单位为 $\\text{mmol}\\ \\text{gDW}^{-1}\\ \\text{h}^{-1}$。\n    2. 代谢物影子价格（一个包含四个浮点数的列表），定义为最大化目标 $c^\\top v$ 对 $b$ 每个分量单位增量的敏感性。\n    3. 绝对误差列表（四个浮点数），用于比较在 $\\delta$ 扰动下预测的目标变化与实测的目标变化。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果；具体来说，输出必须是一个列表，其中包含上述针对情况 A、B 和 C 的三个列表（按此顺序），例如，格式化为类似 \"[[...],[...],[...]]\" 的嵌套列表。\n\n所有计算必须科学上合理且可复现。不允许外部输入。所有输出必须是浮点数数值列表，通量的单位默认为 $\\text{mmol}\\ \\text{gDW}^{-1}\\ \\text{h}^{-1}$，影子价格解释的单位为每单位扰动的相同单位（作为通量变化与通量扰动之比，为无量纲）。",
            "solution": "用户提供了一个计算系统生物学领域的问题，具体要求将通量平衡分析（FBA）应用于一个简化的代谢网络。该问题在科学和数学上都定义明确，并提供了解决问题所需的所有必要数据和约束。这是一个有效的问题。\n\n该问题要求构建并求解一个线性规划（LP）问题，以确定一个简化的糖酵解及相关途径模型中的最优代谢通量。我们被要求在满足化学计量质量平衡约束和反应通量边界的条件下，最大化ATP维持反应的通量（$v_6$）。此外，我们必须计算代谢物的影子价格，并对其解释进行数值验证。\n\n该问题作为线性规划的数学表述如下：\n\n**目标函数：**\n最大化 $Z = c^\\top v$，其中目标向量为 $c = [0, 0, 0, 0, 0, 1]^\\top \\in \\mathbb{R}^6$，$v \\in \\mathbb{R}^6$ 是反应通量向量。这等同于最大化标量通量 $v_6$。标准的LP求解器通常为最小化问题设计。因此，我们将目标重新表述为最小化 $-Z = -c^\\top v$。用于最小化问题的目标向量是 $c_{\\min} = -c = [0, 0, 0, 0, 0, -1]^\\top$。\n\n**约束条件：**\n1.  **等式约束**：系统处于稳态，意味着每种内部代谢物的产生和消耗必须平衡。这由线性系统 $S v = b$ 表示，其中 $S \\in \\mathbb{R}^{4 \\times 6}$ 是化学计量矩阵，$b \\in \\mathbb{R}^4$ 是与环境进行净代谢物交换的向量。对于指定的封闭细胞内网络，$b$ 是零向量，$b = [0, 0, 0, 0]^\\top$。完整的等式约束是：\n    $$\n    S v =\n    \\begin{bmatrix}\n    +1  -1  0  0  0  0 \\\\\n    0  +2  -1  -1  0  0 \\\\\n    0  0  +1  0  -1  0 \\\\\n    0  +2  0  0  0  -1\n    \\end{bmatrix}\n    \\begin{bmatrix} v_1 \\\\ v_2 \\\\ v_3 \\\\ v_4 \\\\ v_5 \\\\ v_6 \\end{bmatrix}\n    =\n    \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{bmatrix}\n    $$\n    行对应于代谢物 $\\{\\text{Glc}, \\text{Pyr}, \\text{Lac}, \\text{ATP}\\}$。\n\n2.  **不等式（边界）约束**：每个反应通量 $v_i$ 被约束在一个给定范围内，$l_i \\le v_i \\le u_i$。下界向量 $l \\in \\mathbb{R}^6$ 和上界向量 $u \\in \\mathbb{R}^6$ 由每个测试用例的参数确定：\n    $$\n    l = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ m_{\\min} \\end{bmatrix}, \\quad\n    u = \\begin{bmatrix} G_{\\max} \\\\ 1000 \\\\ 1000 \\\\ U_{\\text{mito}} \\\\ L_{\\max} \\\\ 1000 \\end{bmatrix}\n    $$\n    其中 $G_{\\max}$、$U_{\\text{mito}}$、$L_{\\max}$ 和 $m_{\\min}$ 为每个测试用例提供。\n\n**影子价格和对偶变量：**\nLP的解不仅产生最优原始解 $v^\\star$，还产生最优对偶解 $\\lambda^\\star \\in \\mathbb{R}^4$，它对应于等式约束 $S v = b$ 的对偶变量（或拉格朗日乘子）。对于一个最小化问题，对偶变量 $\\lambda^\\star_i$ 表示最优目标值（$-c^\\top v^\\star$）对第 $i$ 个约束右侧 $b_i$ 微小变化的敏感性。\n$$\n\\lambda^\\star_i = \\frac{\\partial(-c^\\top v^\\star)}{\\partial b_i}\n$$\n问题将代谢物影子价格 $\\pi_i$ 定义为原始最大化目标 $c^\\top v^\\star$ 对 $b_i$ 变化的敏感性。因此，关系是：\n$$\n\\pi_i = \\frac{\\partial(c^\\top v^\\star)}{\\partial b_i} = -\\frac{\\partial(-c^\\top v^\\star)}{\\partial b_i} = -\\lambda_i^\\star\n$$\n影子价格向量为 $\\pi = -\\lambda^\\star$。\n\n**数值验证：**\n为验证此解释，我们进行敏感性分析。对于每个代谢物 $i$，我们用一个微小量 $\\delta = 10^{-6}$ 扰动相应的右侧元素 $b_i$，并重新求解LP。\n- 新的约束是 $S v = b^{\\text{pert}}$，其中如果 $j=i$，则 $b^{\\text{pert}}_j = \\delta$，否则 $b^{\\text{pert}}_j = 0$。\n- 令 $Z^\\star = c^\\top v^\\star$ 为原始最优目标值，$Z^\\star_{\\text{pert}}$ 为扰动下的新最优目标值。\n- 实测变化为 $\\Delta Z_{\\text{measured}} = Z^\\star_{\\text{pert}} - Z^\\star$。\n- 影子价格预测的变化为 $\\Delta Z_{\\text{predicted}} = \\pi_i \\times \\delta$。\n- 绝对误差 $|\\Delta Z_{\\text{measured}} - \\Delta Z_{\\text{predicted}}|$ 应接近于零，从而证实影子价格的有效性。\n\n**实现：**\n该解决方案在Python中实现，使用 `numpy` 库进行矩阵和向量运算，并使用 `scipy.optimize.linprog` 来求解线性规划问题。定义了一个函数来封装单个测试用例的逻辑。该函数：\n1.  从输入参数构建LP问题（目标向量、约束矩阵和边界）。\n2.  调用 `linprog` 找到最优通量向量 $v^\\star$ 和等式约束对偶 $\\lambda$。\n3.  计算影子价格 $\\pi = -\\lambda$。\n4.  迭代地扰动 $b$ 的每个分量，重新求解LP，并计算实测目标函数变化与影子价格预测变化之间的绝对误差。\n5.  返回最优通量向量、影子价格向量和验证误差向量。\n\n主脚本定义了三个测试用例的参数，为每个案例调用求解器函数，并将收集到的结果格式化为最终输出所需的嵌套列表结构。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef format_list(data):\n    \"\"\"\n    Recursively formats a list into a string without spaces,\n    to match the exact output specification.\n    \"\"\"\n    if isinstance(data, list):\n        return '[' + ','.join(format_list(item) for item in data) + ']'\n    else:\n        # Using str() for floats, which may use scientific notation for small numbers.\n        return str(data)\n\ndef solve_fba_case(G_max, U_mito, L_max, m_min):\n    \"\"\"\n    Solves the FBA problem for a given set of parameters.\n\n    Args:\n        G_max (float): Maximum glucose uptake flux.\n        U_mito (float): Maximum mitochondrial pyruvate consumption flux.\n        L_max (float): Maximum lactate export flux.\n        m_min (float): Minimum ATP maintenance flux.\n\n    Returns:\n        tuple: A tuple containing:\n            - v_star (list): The optimal flux vector.\n            - shadow_prices (list): The metabolite shadow prices.\n            - errors (list): The absolute errors from numerical validation.\n    \"\"\"\n    # Stoichiometric matrix S (m x n)\n    # m=4 metabolites: Glc, Pyr, Lac, ATP\n    # n=6 reactions: v1..v6\n    S = np.array([\n        [1., -1., 0., 0., 0., 0.],  # Glc balance\n        [0., 2., -1., -1., 0., 0.],  # Pyr balance\n        [0., 0., 1., 0., -1., 0.],  # Lac balance\n        [0., 2., 0., 0., 0., -1.]   # ATP balance\n    ])\n\n    # Right-hand side vector b for Sv = b\n    b_eq = np.zeros(S.shape[0])\n\n    # Objective function vector (minimize -v6)\n    c_obj = np.array([0., 0., 0., 0., 0., -1.])\n\n    # Flux bounds (lower, upper)\n    bounds = [\n        (0., G_max),       # v1: glucose uptake\n        (0., 1000.),      # v2: glycolysis\n        (0., 1000.),      # v3: lactate dehydrogenase\n        (0., U_mito),     # v4: mitochondrial pyruvate consumption\n        (0., L_max),      # v5: lactate export\n        (m_min, 1000.)    # v6: ATP maintenance\n    ]\n\n    # Solve the base linear programming problem\n    res = linprog(c=c_obj, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n\n    if not res.success:\n        # This should not happen for the given problem cases.\n        raise RuntimeError(f\"LP solver failed for case with G_max={G_max}, U_mito={U_mito}\")\n\n    v_star = res.x\n    # The objective value from the solver is min(-v6) = -max(v6).\n    # So, the maximized objective is -res.fun.\n    obj_star_maximized = -res.fun\n\n    # Dual variables (lambda) for equality constraints Sv = b\n    # These are the sensitivities of the minimized objective (-v6) to changes in b.\n    duals_lambda = res.eqlin.marginals\n\n    # Shadow prices (pi) are sensitivities of the maximized objective (+v6)\n    # pi = d(v6)/db = -d(-v6)/db = -lambda\n    shadow_prices = -duals_lambda\n\n    # --- Numerical Validation of Shadow Prices ---\n    delta = 1e-6\n    validation_errors = []\n    num_metabolites = S.shape[0]\n\n    for i in range(num_metabolites):\n        # Create a perturbed b vector\n        b_pert = np.zeros(num_metabolites)\n        b_pert[i] = delta\n\n        # Re-solve the LP with the perturbed b\n        res_pert = linprog(c=c_obj, A_eq=S, b_eq=b_pert, bounds=bounds, method='highs')\n        obj_pert_maximized = -res_pert.fun\n        \n        # Calculate measured vs. predicted change\n        measured_change = obj_pert_maximized - obj_star_maximized\n        predicted_change = shadow_prices[i] * delta\n        \n        # Calculate absolute error\n        error = abs(measured_change - predicted_change)\n        validation_errors.append(error)\n\n    return v_star.tolist(), shadow_prices.tolist(), validation_errors\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results in the required format.\n    \"\"\"\n    # Test cases parameters\n    test_cases = [\n        # Case A (happy path, multiple active limits)\n        {'G_max': 10., 'U_mito': 6., 'L_max': 5., 'm_min': 0.1},\n        # Case B (boundary condition, mitochondrial shutdown)\n        {'G_max': 10., 'U_mito': 0., 'L_max': 8., 'm_min': 0.1},\n        # Case C (edge case, uptake-limited)\n        {'G_max': 3., 'U_mito': 100., 'L_max': 100., 'm_min': 0.1}\n    ]\n\n    all_results = []\n    for params in test_cases:\n        v_star, sp, errors = solve_fba_case(**params)\n        all_results.append([v_star, sp, errors])\n\n    # Format the final output string as a nested list without spaces.\n    # e.g., [[v_list_A,p_list_A,e_list_A],[v_list_B,p_list_B,e_list_B],...]\n    print(format_list(all_results))\n\nsolve()\n```"
        },
        {
            "introduction": "真实的生物系统很少只为单一目标进行优化，而是在复杂的权衡中寻求平衡。最后的这个实践通过多目标优化（FBA 的一个强大扩展）来探索这一现实 。通过计算生物量生产和代谢效率之间的帕累托前沿，你将描绘出所有最优策略的蓝图，从而更深入地理解不同条件下可能出现的各种代谢表型。",
            "id": "4390630",
            "problem": "给定一个小型、抽象的代谢网络，旨在模拟稳态系统中生物质生产与总通量最小化之间的权衡。该网络受到内部代谢物化学计量平衡和底物摄取上限的约束。您的任务是使用一种基于原则的优化方法，计算最大化生物质生产和最小化总通量之间的帕累托前沿，并生成可直接测试的数值输出。所有通量必须以毫摩尔/克干重/小时 (mmol/gDW/h) 为单位表示。\n\n基本原理：\n- 稳态下的质量平衡要求每种内部代谢物的净生产速率为零。如果 $S$ 是化学计量矩阵，$v$ 是通量向量，则 $$S\\,v = 0.$$\n- 通量平衡分析 (FBA) 模型使用线性约束和目标函数。最大化生物质生产可以表述为最大化生物质通量 $v_{\\mathrm{bio}}$，而最小化总通量可以表述为最小化 $v$ 的 $L_1$ 范数，当所有通量都约束为非负时，它等于 $\\sum_i v_i$。\n- 交换反应和伪代谢物反应（如底物摄取和生物质形成）通常在建模时不对外部库或伪代谢物进行质量平衡；仅平衡内部代谢物。\n\n网络定义：\n- 内部代谢物：$S$ (底物)、$A$、$B$。\n- 反应（均为不可逆，$v_i \\ge 0$）：\n  1. 摄取：外部来源 $\\rightarrow S$，通量为 $v_1$，上限为 $v_1 \\le V_{\\max}$。\n  2. 转化 $S \\rightarrow A$：可能存在一条或两条由 $k$ 索引的平行途径，其通量为 $v_{2,k}$，底物化学计量成本为 $\\sigma_{A,k} \\in \\{1,2\\}$，表示在途径 $k$ 中每生产一单位 $A$ 所消耗的 $S$。\n  3. 转化 $S \\rightarrow B$，通量为 $v_3$。\n  4. 生物质形成：$a\\,A + b\\,B \\rightarrow \\text{生物质}$，通量为 $v_4$；生物质是一个伪流出（不进行质量平衡）。\n  5. 废物排出：$A \\rightarrow \\text{废物}$，通量为 $v_5$；$B \\rightarrow \\text{废物}$，通量为 $v_6$；$S \\rightarrow \\text{废物}$，通量为 $v_7$。\n\n内部代谢物的稳态质量平衡约束：\n- 底物：$$v_1 - \\sum_k \\sigma_{A,k}\\, v_{2,k} - v_3 - v_7 = 0.$$\n- 代谢物 $A$：$$\\sum_k v_{2,k} - a\\, v_4 - v_5 = 0.$$\n- 代谢物 $B$：$$v_3 - b\\, v_4 - v_6 = 0.$$\n\n优化框架：\n- 生物质生产由 $v_4$ 表示，需要被最大化。\n- 需要最小化的总通量是 $L_1$ 范数 $\\sum_i v_i$，因为所有通量都是非负的，这里它就是 $\\sum_i v_i$。\n- 为构建帕累托前沿，使用 $\\varepsilon$-约束方法：对于一组生物质目标 $B_t$，在满足 $v_4 \\ge B_t$ 以及质量平衡和边界约束的条件下，最小化总通量。得到的点集 $\\{(v_4^\\star, \\sum_i v_i^\\star)\\}$ 近似了生物质与最小总通量之间的帕累托前沿。\n\n您的程序必须：\n1. 为以下由 $(V_{\\max}, a, b, \\{\\sigma_{A,k}\\})$ 定义的四个测试用例实现上述模型。对于所有情况，通量的边界为 $v_i \\ge 0$，其中 $v_1 \\le V_{\\max}$，所有其他 $v_i$ 具有足够大的上限（例如，$10^6$）。\n   - 案例 1（正常路径）：$(V_{\\max} = 10, a = 1, b = 1, \\{\\sigma_{A,1} = 1\\})$；单条 $S \\rightarrow A$ 途径，单位底物成本；生物质需要 $1\\,A + 1\\,B$。\n   - 案例 2（化学计量改变）：$(V_{\\max} = 10, a = 2, b = 1, \\{\\sigma_{A,1} = 1\\})$；生物质需要 $2\\,A + 1\\,B$。\n   - 案例 3（平行的 A 途径）：$(V_{\\max} = 10, a = 1, b = 1, \\{\\sigma_{A,1} = 1, \\sigma_{A,2} = 2\\})$；两条 $S \\rightarrow A$ 途径，具有不同的底物成本。\n   - 案例 4（边界条件）：$(V_{\\max} = 0, a = 1, b = 1, \\{\\sigma_{A,1} = 1\\})$；无底物摄取。\n\n2. 对每个案例：\n   - 首先，通过在约束条件下最大化 $v_4$ 来计算最大生物质 $v_4^{\\max}$。通过最小化 $-v_4$ 将其实现为线性规划。\n   - 构建一个从 0 到 $v_4^{\\max}$（含）均匀间隔的 $K$ 个生物质目标值 $B_t$ 的集合。当 $v_4^{\\max} > 0$ 时使用 $K=6$，当 $v_4^{\\max} = 0$ 时使用 $K=1$。\n   - 对于每个 $B_t$，在满足 $v_4 \\ge B_t$ 和其他约束的条件下，最小化总通量 $\\sum_i v_i$，并记录点对 $(v_4^\\star, T^\\star)$，其中 $v_4^\\star$ 是最优生物质通量，$T^\\star$ 是最小总通量。所有通量值必须是浮点数，单位为 mmol/gDW/h。\n\n3. 输出格式：\n   - 您的程序应生成单行输出，其中包含四个案例结果的类JSON嵌套列表。每个案例的结果必须是一个有序对 $[b, t]$ 的列表，其中 $b$ 是生物质通量 $v_4^\\star$，$t$ 是最小总通量 $\\sum_i v_i^\\star$，两者均为浮点数，单位为 mmol/gDW/h。\n   - 例如，一个案例包含两个点的输出将类似于：$[[b_1,t_1],[b_2,t_2]]$。总输出必须按顺序将四个案例的结果聚合为 $[case_1,case_2,case_3,case_4]$，并打印在单行上，例如 $\"[[[b_{11},t_{11}],\\dots],[\\dots],[\\dots],[\\dots]]\"$，其中每个 $b_{ij}$ 和 $t_{ij}$ 都是浮点数。\n\n解决方案必须以纯数学和逻辑术语表达，并严格遵守上述单位和格式。不使用角度。不得使用百分比；任何小数部分应表示为小数或必要时的有理数。",
            "solution": "该问题是有效的。它涉及在一个代谢网络中计算一个双目标优化问题的帕累托前沿，这是系统生物学中的一项标准任务。该网络、约束和优化过程在科学上是合理的、适定的、客观且完整的。解决方案涉及应用通量平衡分析（FBA）和 $\\varepsilon$-约束方法，这些方法被表述为一系列线性规划（LP）。\n\n模型的核心是稳态质量平衡方程 $S v = 0$，其中 $S$ 是化学计量矩阵，$v$ 是反应通量向量。所有通量都是非负的，$v_i \\ge 0$，且底物摄取通量 $v_1$ 受限于 $v_1 \\le V_{\\max}$。\n\n通量向量 $v$ 和矩阵 $S$ 根据 $S \\rightarrow A$ 转化的途径数量而变化。\n\n对于单条途径（$k=1$），如案例1、2和4，通量向量为 $v = [v_1, v_2, v_3, v_4, v_5, v_6, v_7]^T$。质量平衡方程为：\n$$\n\\begin{cases}\nv_1 - \\sigma_{A,1} v_2 - v_3 - v_7 = 0  \\text{(对于代谢物 S)} \\\\\nv_2 - a v_4 - v_5 = 0  \\text{(对于代谢物 A)} \\\\\nv_3 - b v_4 - v_6 = 0  \\text{(对于代谢物 B)}\n\\end{cases}\n$$\n这些可以写成 $A_{eq} v = b_{eq}$，其中 $b_{eq} = [0, 0, 0]^T$ 且\n$$\nA_{eq} = \\begin{pmatrix}\n1  -\\sigma_{A,1}  -1  0  0  0  -1 \\\\\n0  1  0  -a  -1  0  0 \\\\\n0  0  1  -b  0  -1  0\n\\end{pmatrix}\n$$\n\n对于两条平行途径（$k=1, 2$），如案例3，通量向量为 $v = [v_1, v_{2,1}, v_{2,2}, v_3, v_4, v_5, v_6, v_7]^T$。质量平衡方程为：\n$$\n\\begin{cases}\nv_1 - \\sigma_{A,1} v_{2,1} - \\sigma_{A,2} v_{2,2} - v_3 - v_7 = 0  \\text{(对于 S)} \\\\\nv_{2,1} + v_{2,2} - a v_4 - v_5 = 0  \\text{(对于 A)} \\\\\nv_3 - b v_4 - v_6 = 0  \\text{(对于 B)}\n\\end{cases}\n$$\n等式约束对应的化学计量矩阵是：\n$$\nA_{eq} = \\begin{pmatrix}\n1  -\\sigma_{A,1}  -\\sigma_{A,2}  -1  0  0  0  -1 \\\\\n0  1  1  0  -a  -1  0  0 \\\\\n0  0  0  1  -b  0  -1  0\n\\end{pmatrix}\n$$\n\n每个案例的求解过程分两个阶段进行。\n\n**阶段1：确定最大生物质 ($v_4^{\\max}$)**\n这是一个LP问题：\n- 目标：最大化 $v_4$，或等效地，最小化 $c^T v$，其中 $c$ 是一个在 $v_4$ 位置为 $-1$、其他位置为 $0$ 的向量。\n- 约束：$A_{eq} v = b_{eq}$，$v_i \\ge 0$，以及 $v_1 \\le V_{\\max}$。\n\n**阶段2：计算帕累托前沿**\n生成一组从 0 到 $v_4^{\\max}$ 均匀间隔的 $K$ 个生物质目标 $B_t$。对于每个 $B_t$，求解第二个LP：\n- 目标：最小化总通量 $T = \\sum_i v_i$。目标向量 $c$ 是一个全为1的向量。\n- 约束：所有来自阶段1的约束，外加 $\\varepsilon$-约束 $v_4 \\ge B_t$。\n\n从分析上讲，为了最小化总通量，系统必须以最高效率运行。这意味着废物通量（$v_5, v_6, v_7$）应为零，并且应使用底物效率最高的途径。对于给定的生物质产量 $v_4 = B_t$，必要的通量由化学计量决定，由此可以计算出最小总通量。最优解将始终满足 $v_4^\\star = B_t$，因为任何超过目标的产量（$v_4 > B_t$）都需要更大的输入通量，从而增加总通量之和。\n\n**案例1：** $(V_{\\max} = 10, a = 1, b = 1, \\{\\sigma_{A,1} = 1\\})$\n- **最大生物质：** 生产1单位生物质，需要1单位的 $A$ 和1单位的 $B$。生产 $1A$ 消耗 $\\sigma_{A,1}=1$ 单位的 $S$。生产 $1B$ 消耗1单位的 $S$。每单位生物质的总底物成本是 $1+1=2$ 个单位的 $S$。在 $v_1 \\le 10$ 的条件下，最大生物质是 $v_4^{\\max} = 10 / 2 = 5$。\n- **帕累托前沿：** $K=6$ 个目标是 $B_t \\in \\{0, 1, 2, 3, 4, 5\\}$。对于一个目标 $B_t$，高效的通量为 $v_4=B_t$, $v_2=B_t$, $v_3=B_t$, $v_1=2B_t$。总通量为 $T^\\star = v_1+v_2+v_3+v_4 = 2B_t+B_t+B_t+B_t = 5B_t$。这些点是 $(0, 0), (1, 5), (2, 10), (3, 15), (4, 20), (5, 25)$。\n\n**案例2：** $(V_{\\max} = 10, a = 2, b = 1, \\{\\sigma_{A,1} = 1\\})$\n- **最大生物质：** 生产1单位生物质，需要 $2A$ 和 $1B$。底物成本是 $(2 \\times \\sigma_{A,1}) + 1 = (2 \\times 1) + 1 = 3$。在 $v_1 \\le 10$ 的条件下，$v_4^{\\max} = 10 / 3$。\n- **帕累托前沿：** $K=6$ 个目标是 $B_t = i \\cdot \\frac{10/3}{5} = i \\cdot \\frac{2}{3}$，其中 $i=0,...,5$。对于一个目标 $B_t$，通量为 $v_4=B_t$, $v_2=2B_t$, $v_3=B_t$, $v_1=3B_t$。总通量为 $T^\\star = 3B_t+2B_t+B_t+B_t = 7B_t$。\n\n**案例3：** $(V_{\\max} = 10, a = 1, b = 1, \\{\\sigma_{A,1} = 1, \\sigma_{A,2} = 2\\})$\n- **最大生物质：** 生产 $A$ 的两条途径成本分别为 $\\sigma_{A,1}=1$ 和 $\\sigma_{A,2}=2$。为最大化生物质，必须完全使用效率最高（成本最低）的途径（$v_{2,1} > 0, v_{2,2}=0$）。问题简化为案例1。$v_4^{\\max} = 5$。\n- **帕累托前沿：** 为最小化任何给定 $B_t$ 的总通量，也必须使用效率最高的途径。分析和结果与案例1相同。\n\n**案例4：** $(V_{\\max} = 0, a = 1, b = 1, \\{\\sigma_{A,1} = 1\\})$\n- **最大生物质：** $v_1 \\le 0$ 且 $v_1 \\ge 0$ 意味着 $v_1=0$。没有底物可以进入系统。根据质量平衡方程，如果所有通量都必须为非负，唯一可能的解是所有 $v_i=0$。因此，$v_4^{\\max} = 0$。\n- **帕累托前沿：** $K=1$ 个目标，$B_t=0$。唯一的解是所有通量都为零，所以 $T^\\star=0$。唯一的点是 $(0, 0)$。\n\n以下程序使用 `scipy.optimize.linprog` 实现此逻辑，以数值方式求解这些LP。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Main function to solve the metabolic modeling problem for all test cases.\n    \"\"\"\n    \n    test_cases = [\n        {'V_max': 10.0, 'a': 1.0, 'b': 1.0, 'sigmas': [1.0]},\n        {'V_max': 10.0, 'a': 2.0, 'b': 1.0, 'sigmas': [1.0]},\n        {'V_max': 10.0, 'a': 1.0, 'b': 1.0, 'sigmas': [1.0, 2.0]},\n        {'V_max': 0.0, 'a': 1.0, 'b': 1.0, 'sigmas': [1.0]},\n    ]\n\n    all_results = []\n    \n    for case_params in test_cases:\n        V_max = case_params['V_max']\n        a = case_params['a']\n        b = case_params['b']\n        sigmas = case_params['sigmas']\n        \n        num_s_to_a_pathways = len(sigmas)\n        # v = [v1, v2_1, ..., v2_k, v3, v4, v5, v6, v7]\n        # Total number of fluxes = 1(v1) + k(v2s) + 1(v3) + 1(v4) + 1(v5) + 1(v6) + 1(v7) = k + 6\n        num_fluxes = num_s_to_a_pathways + 6\n        v4_idx = num_s_to_a_pathways + 2\n\n        # A_eq * v = b_eq\n        A_eq = np.zeros((3, num_fluxes))\n        b_eq = np.zeros(3)\n\n        # Substrate balance: v1 - sum(sigma_k * v2_k) - v3 - v7 = 0\n        A_eq[0, 0] = 1.0\n        for i, sigma in enumerate(sigmas):\n            A_eq[0, 1 + i] = -sigma\n        A_eq[0, num_s_to_a_pathways + 1] = -1.0 # v3\n        A_eq[0, -1] = -1.0 # v7\n        \n        # Metabolite A balance: sum(v2_k) - a*v4 - v5 = 0\n        for i in range(num_s_to_a_pathways):\n            A_eq[1, 1 + i] = 1.0\n        A_eq[1, v4_idx] = -a # v4\n        A_eq[1, -3] = -1.0 # v5\n        \n        # Metabolite B balance: v3 - b*v4 - v6 = 0\n        A_eq[2, num_s_to_a_pathways + 1] = 1.0 # v3\n        A_eq[2, v4_idx] = -b # v4\n        A_eq[2, -2] = -1.0 # v6\n\n        # Bounds for fluxes\n        bounds = [(0, None)] * num_fluxes\n        bounds[0] = (0, V_max)\n\n        # Stage 1: Maximize biomass flux v4\n        c_max_bio = np.zeros(num_fluxes)\n        c_max_bio[v4_idx] = -1.0 # Minimize -v4 to maximize v4\n        \n        res_max_bio = linprog(c=c_max_bio, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n        \n        if not res_max_bio.success or res_max_bio.fun is None:\n             # Should not happen for valid problems, but as a safeguard\n            v4_max = 0.0\n        else:\n            v4_max = -res_max_bio.fun\n\n        # Generate biomass targets\n        if v4_max > 1e-9: # Use a tolerance for floating point\n            K = 6\n            biomass_targets = np.linspace(0, v4_max, K)\n        else:\n            K = 1\n            biomass_targets = np.array([0.0])\n\n        case_pareto_points = []\n        \n        # Stage 2: Minimize total flux for each biomass target\n        c_min_flux = np.ones(num_fluxes)\n        \n        for bt in biomass_targets:\n            # Add constraint v4 >= bt, which is -v4 = -bt\n            A_ub = np.zeros((1, num_fluxes))\n            A_ub[0, v4_idx] = -1.0\n            b_ub = np.array([-bt])\n            \n            res_min_flux = linprog(c=c_min_flux, A_eq=A_eq, b_eq=b_eq, A_ub=A_ub, b_ub=b_ub, bounds=bounds, method='highs')\n\n            if res_min_flux.success:\n                v4_star = res_min_flux.x[v4_idx]\n                total_flux_star = res_min_flux.fun\n                \n                # Clamp small negative values to 0 due to precision issues\n                v4_star = max(0.0, v4_star)\n                total_flux_star = max(0.0, total_flux_star)\n                \n                case_pareto_points.append([float(f\"{v4_star:.10f}\"), float(f\"{total_flux_star:.10f}\")])\n\n        all_results.append(case_pareto_points)\n\n    # Format the final output string\n    case_strings = []\n    for result_list in all_results:\n        case_strings.append(str(result_list).replace(\" \", \"\"))\n    \n    final_output_string = f\"[{','.join(case_strings)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}