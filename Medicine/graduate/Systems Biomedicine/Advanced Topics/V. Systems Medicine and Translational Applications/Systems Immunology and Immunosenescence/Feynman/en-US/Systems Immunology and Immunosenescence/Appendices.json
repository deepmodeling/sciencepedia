{
    "hands_on_practices": [
        {
            "introduction": "The ability of cytotoxic T lymphocytes (CTLs) to eliminate infected or malignant cells is a cornerstone of adaptive immunity. This exercise invites you to model this process quantitatively, viewing cell killing as a probabilistic event governed by the duration of contact and the rate of lethal hit delivery. By exploring a model where key signaling parameters decline with age, you will gain a hands-on understanding of how immunosenescence can be translated into a predictable reduction in the per-encounter killing probability .",
            "id": "4391431",
            "problem": "In a systems immunology model of cytotoxic T lymphocyte (CTL)-mediated killing during a single target encounter, assume that lethal hits occur as a time-homogeneous Poisson process with instantaneous hazard rate $k$. For a fixed contact duration $t$, the probability that at least one lethal hit occurs is $1 - \\exp(-k t)$. Contact durations are heterogeneous and modeled as exponentially distributed with mean $\\tau$, independently of $k$. In a simple coarse-grained description of immunosenescence, the hazard rate is modulated by licensing and activating receptor signaling, so that $k = k_0 \\cdot L \\cdot R$, where $k_0$ is a baseline rate constant, $L$ is the licensing factor, and $R$ is the activating receptor signaling factor; both $L$ and $R$ are dimensionless scaling factors. Assume that the young adult baseline is $L_{\\text{y}} = 1$ and $R_{\\text{y}} = 1$, while in older adults immunosenescence reduces these factors by $35$ percent and $30$ percent, respectively, so that $L_{\\text{o}} = 0.65$ and $R_{\\text{o}} = 0.70$. Let the baseline rate constant be $k_0 = 0.28 \\ \\mathrm{min}^{-1}$ and the mean contact duration be $\\tau = 6 \\ \\mathrm{min}$, independent of age.\n\nUsing only these assumptions and starting from the definitions of the Poisson process and the exponential distribution for contact durations, derive an expression for the expected per-encounter killing probability as a function of $k$ and $\\tau$, then compute the expected reduction in per-encounter killing probability due to aging, defined as $p_{\\text{y}} - p_{\\text{o}}$, where $p_{\\text{y}}$ is the young expected per-encounter killing probability and $p_{\\text{o}}$ is the older adult expected per-encounter killing probability. Express your final answer as a decimal and round your answer to four significant figures. Do not use a percentage sign in your final answer.",
            "solution": "The problem requires us to first derive a general expression for the expected per-encounter killing probability, and then use this expression to compute the reduction in this probability due to immunosenescence.\n\nFirst, let's derive the expression for the expected per-encounter killing probability, which we will denote as $p$. The problem states that for a fixed contact duration $t$, the probability of at least one lethal hit, $P(\\text{kill}|t)$, is given by a Poisson process model:\n$$P(\\text{kill}|t) = 1 - \\exp(-k t)$$\nwhere $k$ is the instantaneous hazard rate of a lethal hit.\n\nThe contact duration $t$ is not fixed but is a random variable. It is modeled as being exponentially distributed with a mean duration $\\tau$. The probability density function (PDF) for an exponentially distributed random variable $t$ with mean $\\tau$ is:\n$$f(t; \\tau) = \\frac{1}{\\tau} \\exp\\left(-\\frac{t}{\\tau}\\right) \\quad \\text{for } t \\ge 0$$\nTo find the expected, or average, per-encounter killing probability $p$, we must average the conditional probability $P(\\text{kill}|t)$ over all possible values of $t$, weighted by their respective probabilities as defined by the PDF $f(t; \\tau)$. This is the definition of the expected value of a function of a random variable:\n$$p = E[P(\\text{kill}|t)] = \\int_{0}^{\\infty} P(\\text{kill}|t) f(t; \\tau) dt$$\nSubstituting the given expressions for $P(\\text{kill}|t)$ and $f(t; \\tau)$:\n$$p(k, \\tau) = \\int_{0}^{\\infty} (1 - \\exp(-k t)) \\left(\\frac{1}{\\tau} \\exp\\left(-\\frac{t}{\\tau}\\right)\\right) dt$$\nWe can split the integral into two parts:\n$$p(k, \\tau) = \\frac{1}{\\tau} \\int_{0}^{\\infty} \\exp\\left(-\\frac{t}{\\tau}\\right) dt - \\frac{1}{\\tau} \\int_{0}^{\\infty} \\exp(-k t) \\exp\\left(-\\frac{t}{\\tau}\\right) dt$$\nThe second term can be simplified by combining the exponents:\n$$p(k, \\tau) = \\frac{1}{\\tau} \\int_{0}^{\\infty} \\exp\\left(-\\frac{t}{\\tau}\\right) dt - \\frac{1}{\\tau} \\int_{0}^{\\infty} \\exp\\left(-\\left(k + \\frac{1}{\\tau}\\right)t\\right) dt$$\nLet's evaluate these definite integrals:\nThe first integral is $\\int_{0}^{\\infty} \\exp(-t/\\tau) dt = \\left[-\\tau \\exp(-t/\\tau)\\right]_{0}^{\\infty} = (0) - (-\\tau \\exp(0)) = \\tau$.\nThe second integral is $\\int_{0}^{\\infty} \\exp\\left(-\\left(k + \\frac{1}{\\tau}\\right)t\\right) dt = \\left[\\frac{\\exp\\left(-\\left(k + \\frac{1}{\\tau}\\right)t\\right)}{-\\left(k + \\frac{1}{\\tau}\\right)}\\right]_{0}^{\\infty} = (0) - \\left(\\frac{1}{-\\left(k + \\frac{1}{\\tau}\\right)}\\right) = \\frac{1}{k + 1/\\tau}$.\n\nSubstituting these results back into the expression for $p(k, \\tau)$:\n$$p(k, \\tau) = \\frac{1}{\\tau}(\\tau) - \\frac{1}{\\tau}\\left(\\frac{1}{k + 1/\\tau}\\right) = 1 - \\frac{1}{k\\tau + 1}$$\nBy finding a common denominator, we can write this expression in a more compact form:\n$$p(k, \\tau) = \\frac{(k\\tau + 1) - 1}{k\\tau + 1} = \\frac{k\\tau}{k\\tau + 1}$$\nThis is the derived expression for the expected per-encounter killing probability as a function of $k$ and $\\tau$.\n\nNext, we compute the probabilities for young ($p_{\\text{y}}$) and older ($p_{\\text{o}}$) adults.\nThe hazard rate $k$ is given by $k = k_0 \\cdot L \\cdot R$. The given parameters are $k_0 = 0.28 \\ \\text{min}^{-1}$ and $\\tau = 6 \\ \\text{min}$.\n\nFor young adults (subscript 'y'):\n$L_{\\text{y}} = 1$ and $R_{\\text{y}} = 1$.\nThe hazard rate is $k_{\\text{y}} = k_0 \\cdot L_{\\text{y}} \\cdot R_{\\text{y}} = 0.28 \\cdot 1 \\cdot 1 = 0.28 \\ \\text{min}^{-1}$.\nThe dimensionless product needed for the probability calculation is $k_{\\text{y}}\\tau = (0.28)(6) = 1.68$.\nThe killing probability for young adults is:\n$$p_{\\text{y}} = \\frac{k_{\\text{y}}\\tau}{k_{\\text{y}}\\tau + 1} = \\frac{1.68}{1.68 + 1} = \\frac{1.68}{2.68}$$\n\nFor older adults (subscript 'o'):\n$L_{\\text{o}} = 0.65$ and $R_{\\text{o}} = 0.70$.\nThe hazard rate is $k_{\\text{o}} = k_0 \\cdot L_{\\text{o}} \\cdot R_{\\text{o}} = 0.28 \\cdot 0.65 \\cdot 0.70$.\nFirst, $L_{\\text{o}} \\cdot R_{\\text{o}} = 0.65 \\cdot 0.70 = 0.455$.\nSo, $k_{\\text{o}} = 0.28 \\cdot 0.455 = 0.1274 \\ \\text{min}^{-1}$.\nThe dimensionless product is $k_{\\text{o}}\\tau = (0.1274)(6) = 0.7644$.\nThe killing probability for older adults is:\n$$p_{\\text{o}} = \\frac{k_{\\text{o}}\\tau}{k_{\\text{o}}\\tau + 1} = \\frac{0.7644}{0.7644 + 1} = \\frac{0.7644}{1.7644}$$\n\nFinally, we calculate the reduction in killing probability, $p_{\\text{y}} - p_{\\text{o}}$.\nFirst, we evaluate the fractions:\n$$p_{\\text{y}} = \\frac{1.68}{2.68} \\approx 0.62686567$$\n$$p_{\\text{o}} = \\frac{0.7644}{1.7644} \\approx 0.43323509$$\nThe difference is:\n$$p_{\\text{y}} - p_{\\text{o}} \\approx 0.62686567 - 0.43323509 = 0.19363058$$\nThe problem asks for the result to be rounded to four significant figures.\nThe result $0.19363058$ rounded to four significant figures is $0.1936$.",
            "answer": "$$\\boxed{0.1936}$$"
        },
        {
            "introduction": "Beyond single-cell functions, immunosenescence profoundly impacts the homeostatic balance of entire immune cell populations. This practice delves into the systems-level competition between naive and memory T-cell compartments for a shared, limited resource—a growth-promoting cytokine. By constructing and analyzing a system of coupled differential equations, you will investigate how an age-related decline in cytokine production can disrupt this equilibrium, providing a powerful framework for understanding large-scale shifts in the T-cell pool during aging .",
            "id": "4391454",
            "problem": "Consider a reduced systems immunology model of homeostatic maintenance of naive and memory T cells under cytokine limitation. Let $N(t)$ denote the abundance of naive T cells, $M(t)$ the abundance of memory T cells, and $C(t)$ the concentration of a single limiting cytokine. Assume the following fundamental bases and definitions hold.\n\n- Mass-action balance for a well-mixed compartment: production minus consumption defines the time derivative for each species.\n- Cytokine-driven source production of cells follows a Michaelis–Menten-like saturating dependence on cytokine concentration, reflecting receptor occupancy, with half-saturation constants $K_N$ and $K_M$, maximal cytokine-driven source rates $\\alpha_N$ and $\\alpha_M$, and linear death (loss) with rates $\\delta_N$ and $\\delta_M$.\n- Cytokine is produced at a constant rate $\\pi$ and is consumed via mass-action interaction with cells, proportional to both cytokine and consuming cell abundances with proportionality constants $p_N$ and $p_M$.\n\nTask A (model construction): Starting strictly from the principles above, derive a coupled system of Ordinary Differential Equations (ODE) for $(N,M,C)$ in the form $\\mathrm{d}N/\\mathrm{d}t = \\ldots$, $\\mathrm{d}M/\\mathrm{d}t = \\ldots$, and $\\mathrm{d}C/\\mathrm{d}t = \\ldots$ that is consistent with these bases. Do not introduce additional processes beyond those specified.\n\nTask B (equilibrium analysis): For fixed parameters with $\\pi > 0$, show that an equilibrium $(N^\\ast, M^\\ast, C^\\ast)$ with $C^\\ast > 0$ exists. Express $N^\\ast$ and $M^\\ast$ as functions of $C^\\ast$ and reduce the steady-state condition for $C^\\ast$ to a single scalar equation $F(C^\\ast) = 0$ involving only $C^\\ast$ and parameters. Prove that $F(C)$ is strictly decreasing for $C > 0$ under the given assumptions and hence has a unique positive root. Deduce the qualitative effect of reducing $\\pi$ (to model age-related cytokine production decline) on $C^\\ast$, $N^\\ast$, and $M^\\ast$.\n\nTask C (computational experiment): Implement a program that, for each parameter set in the test suite below, computes the unique equilibrium $(N^\\ast, M^\\ast, C^\\ast)$ for a baseline cytokine production $\\pi_0$ and for an age-reduced production $\\pi_{\\text{aged}} = r \\,\\pi_0$ with $r \\in (0,1)$. Report, for each case, the fractional changes in equilibrium abundances defined by\n- $\\Delta_N = (N^\\ast_{\\text{aged}} - N^\\ast_{\\text{base}})/N^\\ast_{\\text{base}}$,\n- $\\Delta_M = (M^\\ast_{\\text{aged}} - M^\\ast_{\\text{base}})/M^\\ast_{\\text{base}}$,\n- $\\Delta_C = (C^\\ast_{\\text{aged}} - C^\\ast_{\\text{base}})/C^\\ast_{\\text{base}}$.\nNo physical units are required; treat all variables and parameters as non-dimensional. Angles are not involved. For numerical output, express each $\\Delta$ as a decimal number rounded to $6$ decimal places.\n\nTest suite parameterization: Each test case is a tuple $(\\alpha_N,\\alpha_M,\\delta_N,\\delta_M,K_N,K_M,p_N,p_M,\\pi_0,r)$ with the following four cases to ensure coverage of typical, memory-dominated consumption, low-production edge, and higher-loss regimes:\n\n- Case A (typical, balanced):\n  $(\\alpha_N,\\alpha_M,\\delta_N,\\delta_M,K_N,K_M,p_N,p_M,\\pi_0,r) = (0.6, 0.4, 0.03, 0.02, 1.0, 0.5, 0.05, 0.02, 1.2, 0.6)$.\n- Case B (memory-dominated consumption):\n  $(\\alpha_N,\\alpha_M,\\delta_N,\\delta_M,K_N,K_M,p_N,p_M,\\pi_0,r) = (0.6, 0.5, 0.03, 0.02, 1.0, 0.3, 0.02, 0.08, 1.5, 0.5)$.\n- Case C (low production, edge):\n  $(\\alpha_N,\\alpha_M,\\delta_N,\\delta_M,K_N,K_M,p_N,p_M,\\pi_0,r) = (0.6, 0.4, 0.03, 0.02, 1.0, 0.5, 0.05, 0.02, 0.3, 0.3)$.\n- Case D (higher loss rates):\n  $(\\alpha_N,\\alpha_M,\\delta_N,\\delta_M,K_N,K_M,p_N,p_M,\\pi_0,r) = (0.5, 0.5, 0.1, 0.08, 0.7, 0.7, 0.03, 0.03, 0.8, 0.7)$.\n\nImplementation and output specification:\n- Your program must, for each case, solve for $C^\\ast$ by finding the unique positive root of the scalar steady-state equation derived in Task B, then compute $N^\\ast$ and $M^\\ast$, both for $\\pi_0$ and for $r\\,\\pi_0$.\n- Use robust root bracketing on $C \\in (0,\\infty)$ and a monotone solver to guarantee the unique positive root is found.\n- The final program output should be a single line containing the results as a comma-separated list enclosed in square brackets, where each element is the list $[\\Delta_N,\\Delta_M,\\Delta_C]$ for one test case, in the same order as above. For example: \"[[x1,y1,z1],[x2,y2,z2],[x3,y3,z3],[x4,y4,z4]]\", with each value rounded to $6$ decimal places.",
            "solution": "This problem describes a simplified model of T-cell homeostasis and asks for its mathematical derivation, analytical investigation of its equilibrium properties, and numerical simulation under different conditions. The problem is scientifically grounded, well-posed, and internally consistent.\n\n### Task A: Model Construction\n\nWe are tasked with deriving a system of Ordinary Differential Equations (ODEs) for the naive T-cell abundance $N(t)$, memory T-cell abundance $M(t)$, and cytokine concentration $C(t)$. The derivation is based on the principle of mass-action balance, where the rate of change of each species is its total production rate minus its total consumption (or loss) rate.\n\n**1. Equation for Naive T cells, $N(t)$:**\nThe problem specifies two processes governing $N(t)$: a cytokine-dependent source production and a linear death process.\n- **Production:** The production is described as a \"cytokine-driven source\" with a Michaelis-Menten-like dependence on the cytokine concentration $C$. This implies a source term that is independent of the current population size $N$. The maximal rate is $\\alpha_N$ and the half-saturation constant is $K_N$. This term is mathematically formulated as $\\alpha_N \\frac{C}{K_N + C}$. This represents, for instance, differentiation from an unmodeled precursor population at a rate dependent on cytokine signaling.\n- **Consumption (Loss):** The loss is a linear death process with rate $\\delta_N$, meaning cells are lost at a rate proportional to their current abundance. This term is given by $\\delta_N N$.\n\nCombining production and loss, the ODE for $N(t)$ is:\n$$\n\\frac{\\mathrm{d}N}{\\mathrm{d}t} = \\alpha_N \\frac{C}{K_N + C} - \\delta_N N\n$$\n\n**2. Equation for Memory T cells, $M(t)$:**\nThe logic for $M(t)$ is identical to that for $N(t)$, but with its own set of parameters.\n- **Production:** A source term with maximal rate $\\alpha_M$ and half-saturation constant $K_M$, written as $\\alpha_M \\frac{C}{K_M + C}$.\n- **Consumption (Loss):** A linear death process with rate $\\delta_M$, written as $\\delta_M M$.\n\nCombining these gives the ODE for $M(t)$:\n$$\n\\frac{\\mathrm{d}M}{\\mathrm{d}t} = \\alpha_M \\frac{C}{K_M + C} - \\delta_M M\n$$\n\n**3. Equation for Cytokine, $C(t)$:**\nThe cytokine dynamics are determined by a constant production and consumption by both naive and memory T cells.\n- **Production:** A constant rate of production, denoted by the parameter $\\pi$.\n- **Consumption:** Consumption occurs via \"mass-action interaction\" proportional to both the cytokine concentration $C$ and the abundance of consuming cells, $N$ and $M$. The proportionality constants are $p_N$ for naive cells and $p_M$ for memory cells. This leads to two consumption terms: $p_N N C$ and $p_M M C$.\n\nCombining these terms yields the ODE for $C(t)$:\n$$\n\\frac{\\mathrm{d}C}{\\mathrm{d}t} = \\pi - p_N N C - p_M M C = \\pi - (p_N N + p_M M)C\n$$\n\n**Complete System of ODEs:**\nThe full model is the following system of coupled nonlinear ODEs:\n$$\n\\begin{cases}\n\\frac{\\mathrm{d}N}{\\mathrm{d}t} = \\alpha_N \\frac{C}{K_N + C} - \\delta_N N \\\\\n\\frac{\\mathrm{d}M}{\\mathrm{d}t} = \\alpha_M \\frac{C}{K_M + C} - \\delta_M M \\\\\n\\frac{\\mathrm{d}C}{\\mathrm{d}t} = \\pi - (p_N N + p_M M)C\n\\end{cases}\n$$\n\n### Task B: Equilibrium Analysis\n\nWe seek a non-trivial equilibrium $(N^\\ast, M^\\ast, C^\\ast)$ where all abundances are positive, which requires $C^\\ast > 0$. At equilibrium, all time derivatives are zero.\n\n**1. Expressing $N^\\ast$ and $M^\\ast$ in terms of $C^\\ast$:**\nFrom the first two ODEs at steady state ($\\mathrm{d}N/\\mathrm{d}t = 0$, $\\mathrm{d}M/\\mathrm{d}t = 0$):\n$$\n0 = \\alpha_N \\frac{C^\\ast}{K_N + C^\\ast} - \\delta_N N^\\ast \\implies N^\\ast = \\frac{\\alpha_N}{\\delta_N} \\frac{C^\\ast}{K_N + C^\\ast}\n$$\n$$\n0 = \\alpha_M \\frac{C^\\ast}{K_M + C^\\ast} - \\delta_M M^\\ast \\implies M^\\ast = \\frac{\\alpha_M}{\\delta_M} \\frac{C^\\ast}{K_M + C^\\ast}\n$$\nThese expressions give the equilibrium cell abundances as functions of the equilibrium cytokine concentration $C^\\ast$. Since all parameters $(\\alpha, \\delta, K)$ are positive, $N^\\ast$ and $M^\\ast$ are positive if and only if $C^\\ast > 0$.\n\n**2. Deriving the Scalar Equation for $C^\\ast$:**\nSubstitute the expressions for $N^\\ast$ and $M^\\ast$ into the third equilibrium equation, $\\mathrm{d}C/\\mathrm{d}t = 0$:\n$$\n0 = \\pi - (p_N N^\\ast + p_M M^\\ast)C^\\ast\n$$\n$$\n\\pi = \\left( p_N \\left(\\frac{\\alpha_N}{\\delta_N} \\frac{C^\\ast}{K_N + C^\\ast}\\right) + p_M \\left(\\frac{\\alpha_M}{\\delta_M} \\frac{C^\\ast}{K_M + C^\\ast}\\right) \\right) C^\\ast\n$$\nWe can define a function $G(C)$ representing the total cytokine consumption rate at a given concentration $C$:\n$$\nG(C) = C^2 \\left( \\frac{p_N \\alpha_N}{\\delta_N(K_N + C)} + \\frac{p_M \\alpha_M}{\\delta_M(K_M + C)} \\right)\n$$\nThe equilibrium condition is then $G(C^\\ast) = \\pi$.\nTo match the problem's request for an equation of the form $F(C^\\ast) = 0$ where $F(C)$ is strictly decreasing, we define:\n$$\nF(C) = \\pi - G(C) = \\pi - C^2 \\left( \\frac{p_N \\alpha_N}{\\delta_N(K_N + C)} + \\frac{p_M \\alpha_M}{\\delta_M(K_M + C)} \\right)\n$$\n\n**3. Proof of Unique Positive Root:**\nTo prove that $F(C)$ has a unique positive root, we show that it is continuous, strictly decreasing for $C>0$, and its limits at $0^+$ and $\\infty$ span zero.\nThe derivative of a generic term $H(C) = A \\frac{C^2}{K+C}$ with $A, K > 0$ is:\n$$\nH'(C) = A \\frac{d}{dC} \\left(\\frac{C^2}{K+C}\\right) = A \\frac{2C(K+C) - C^2(1)}{(K+C)^2} = A \\frac{2KC + C^2}{(K+C)^2} = A \\frac{C(2K+C)}{(K+C)^2}\n$$\nFor $C > 0$, we have $H'(C) > 0$. The function $G(C)$ is a sum of two such terms with positive coefficients, so $G'(C) > 0$ for all $C > 0$.\nThe derivative of $F(C)$ is $F'(C) = -G'(C)$. Since $G'(C) > 0$, we have $F'(C) < 0$ for all $C > 0$. Thus, $F(C)$ is a strictly decreasing function for $C > 0$.\n\nNext, we evaluate the limits of $F(C)$:\n- As $C \\to 0^+$, the term $\\frac{C}{K+C} \\to 0$, so $G(C) \\to 0$. Therefore, $\\lim_{C \\to 0^+} F(C) = \\pi - 0 = \\pi$. Since $\\pi > 0$, the function starts from a positive value.\n- As $C \\to \\infty$, the term $\\frac{C}{K+C} \\to 1$. The term inside the parenthesis of $G(C)$ becomes $C \\left( ... \\right)$, which tends to infinity, as it behaves like a linear function of $C$. Thus, $\\lim_{C \\to \\infty} G(C) = \\infty$. Therefore, $\\lim_{C \\to \\infty} F(C) = \\pi - \\infty = -\\infty$.\n\nSince $F(C)$ is a continuous and strictly decreasing function on $(0, \\infty)$ with $F(0^+) > 0$ and $F(\\infty) < 0$, by the Intermediate Value Theorem, there must exist exactly one value $C^\\ast \\in (0, \\infty)$ such that $F(C^\\ast)=0$.\n\n**4. Effect of Reducing $\\pi$:**\nThe equilibrium is defined by $G(C^\\ast) = \\pi$. We have shown that $G(C)$ is a strictly increasing function of $C$. Let $\\pi_{\\text{base}}$ be the baseline production rate with corresponding equilibrium $C^\\ast_{\\text{base}}$, and let $\\pi_{\\text{aged}} < \\pi_{\\text{base}}$ be the reduced rate with equilibrium $C^\\ast_{\\text{aged}}$.\nWe have $G(C^\\ast_{\\text{base}}) = \\pi_{\\text{base}}$ and $G(C^\\ast_{\\text{aged}}) = \\pi_{\\text{aged}}$.\nSince $\\pi_{\\text{aged}} < \\pi_{\\text{base}}$, it follows that $G(C^\\ast_{\\text{aged}}) < G(C^\\ast_{\\text{base}})$.\nBecause $G(C)$ is strictly increasing, this implies $C^\\ast_{\\text{aged}} < C^\\ast_{\\text{base}}$. Therefore, reducing cytokine production $\\pi$ decreases the equilibrium cytokine concentration $C^\\ast$.\n\nNow consider the effect on $N^\\ast$ and $M^\\ast$. The equilibrium abundance $N^\\ast$ is given by the function $N^\\ast(C) = \\frac{\\alpha_N}{\\delta_N} \\frac{C}{K_N+C}$. Let's examine its dependence on $C$. Its derivative is:\n$$\n\\frac{d N^\\ast}{dC} = \\frac{\\alpha_N}{\\delta_N} \\frac{1(K_N+C) - C(1)}{(K_N+C)^2} = \\frac{\\alpha_N K_N}{\\delta_N(K_N+C)^2}\n$$\nSince all parameters are positive, $\\frac{d N^\\ast}{dC} > 0$. So, $N^\\ast$ is a strictly increasing function of $C$. As a reduction in $\\pi$ causes $C^\\ast$ to decrease, it must also cause $N^\\ast$ to decrease.\nBy identical logic, $M^\\ast(C) = \\frac{\\alpha_M}{\\delta_M} \\frac{C}{K_M+C}$ is also a strictly increasing function of $C$, so a reduction in $\\pi$ also causes $M^\\ast$ to decrease.\nIn conclusion, a decline in the cytokine production rate $\\pi$ leads to a reduction in the equilibrium abundances of all three species: $N^\\ast$, $M^\\ast$, and $C^\\ast$.\n\n### Task C: Computational Experiment\n\nThe computational task is to solve for the equilibrium values for two different values of $\\pi$ ($\\pi_0$ and $\\pi_{\\text{aged}} = r \\pi_0$) for several parameter sets. The core of the computation is finding the unique positive root $C^\\ast$ of the equation $F(C) = 0$. As established in Task B, the function $F(C)$ is monotonic, guaranteeing that a robust root-finding algorithm like Brent's method, given a proper bracket $[a, b]$ where $F(a)$ and $F(b)$ have opposite signs, will efficiently and reliably find the unique root. We established that $F(C)$ is positive near $C=0$ and negative for large $C$, so a bracket such as $[10^{-12}, 10^4]$ is suitable for the given parameter ranges.\n\nOnce $C^\\ast_{\\text{base}}$ and $C^\\ast_{\\text{aged}}$ are found for each test case, the corresponding cell populations $(N^\\ast, M^\\ast)$ are calculated using the formulas derived in Task B. Finally, the fractional changes are computed as:\n- $\\Delta_N = (N^\\ast_{\\text{aged}} - N^\\ast_{\\text{base}})/N^\\ast_{\\text{base}}$\n- $\\Delta_M = (M^\\ast_{\\text{aged}} - M^\\ast_{\\text{base}})/M^\\ast_{\\text{base}}$\n- $\\Delta_C = (C^\\ast_{\\text{aged}} - C^\\ast_{\\text{base}})/C^\\ast_{\\text{base}}$\n\nThe implementation, as required, is provided in the final answer block.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves the systems immunology problem by finding equilibrium states\n    and calculating fractional changes due to reduced cytokine production.\n    \"\"\"\n\n    # Test cases defined in the problem statement.\n    # Each tuple is (alpha_N, alpha_M, delta_N, delta_M, K_N, K_M, p_N, p_M, pi_0, r)\n    test_cases = [\n        (0.6, 0.4, 0.03, 0.02, 1.0, 0.5, 0.05, 0.02, 1.2, 0.6), # Case A\n        (0.6, 0.5, 0.03, 0.02, 1.0, 0.3, 0.02, 0.08, 1.5, 0.5), # Case B\n        (0.6, 0.4, 0.03, 0.02, 1.0, 0.5, 0.05, 0.02, 0.3, 0.3), # Case C\n        (0.5, 0.5, 0.1, 0.08, 0.7, 0.7, 0.03, 0.03, 0.8, 0.7), # Case D\n    ]\n\n    def get_steady_state_function(pi, params):\n        \"\"\"\n        Returns the scalar function F(C) = pi - G(C) for root finding.\n        The root of this function is the equilibrium cytokine concentration C*.\n        \"\"\"\n        alpha_N, alpha_M, delta_N, delta_M, K_N, K_M, p_N, p_M = params\n\n        def F(C):\n            if C <= 0:\n                return pi\n            \n            # Cytokine consumption by naive T cells\n            consumption_N = p_N * (alpha_N / delta_N) * (C / (K_N + C))\n            \n            # Cytokine consumption by memory T cells\n            consumption_M = p_M * (alpha_M / delta_M) * (C / (K_M + C))\n            \n            # Total consumption rate, G(C)\n            total_consumption_rate = (consumption_N + consumption_M) * C\n            \n            return pi - total_consumption_rate\n\n        return F\n\n    def calculate_equilibrium(pi, params):\n        \"\"\"\n        Calculates the equilibrium (N*, M*, C*) for a given pi and parameter set.\n        \"\"\"\n        alpha_N, alpha_M, delta_N, delta_M, K_N, K_M, _, _ = params\n        \n        # Define the function whose root we need to find\n        F_C = get_steady_state_function(pi, params)\n        \n        # Find the unique positive root for C* using Brent's method.\n        # The bracket [a, b] is chosen based on the analytical result that\n        # F(C) > 0 for C -> 0+ and F(C) < 0 for C -> infinity.\n        # The specific values are a small positive number and a large number\n        # certain to be greater than the root for the given parameter scales.\n        try:\n            C_star = brentq(F_C, a=1e-12, b=1e5)\n        except ValueError:\n            # This should not happen if the analysis is correct and bracket is valid.\n            return (np.nan, np.nan, np.nan)\n        \n        # Calculate N* and M* from C*\n        N_star = (alpha_N / delta_N) * (C_star / (K_N + C_star))\n        M_star = (alpha_M / delta_M) * (C_star / (K_M + C_star))\n        \n        return N_star, M_star, C_star\n\n    results = []\n    for case in test_cases:\n        pi_0, r = case[-2], case[-1]\n        params = case[:-2]\n        \n        # Calculate equilibrium for baseline production pi_0\n        N_base, M_base, C_base = calculate_equilibrium(pi_0, params)\n        \n        # Calculate equilibrium for aged production pi_aged\n        pi_aged = r * pi_0\n        N_aged, M_aged, C_aged = calculate_equilibrium(pi_aged, params)\n        \n        # Calculate fractional changes\n        delta_N = (N_aged - N_base) / N_base if N_base != 0 else 0\n        delta_M = (M_aged - M_base) / M_base if M_base != 0 else 0\n        delta_C = (C_aged - C_base) / C_base if C_base != 0 else 0\n        \n        results.append([delta_N, delta_M, delta_C])\n\n    # Format the final output string exactly as specified.\n    inner_strings = []\n    for sublist in results:\n        num_strings = [f\"{x:.6f}\" for x in sublist]\n        inner_strings.append(f\"[{','.join(num_strings)}]\")\n    \n    final_output = f\"[{','.join(inner_strings)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "Modern systems immunology relies on interpreting complex, high-dimensional data from single cells to understand the heterogeneity of aging. This computational exercise guides you through building a probabilistic classifier to identify key cell states associated with immunosenescence, such as exhaustion ($E$) and senescence ($S$), from protein marker data. By applying Bayes' theorem, you will not only classify individual cells but also estimate the proportions of these states within a cohort and quantify the statistical uncertainty of your findings, bridging the gap between theoretical models and real-world single-cell analysis .",
            "id": "4391421",
            "problem": "You are given single-cell normalized expression measurements for four markers widely used to characterize T cell functional decline in aging: Programmed cell death protein 1 (PD-1), Thymocyte selection-associated high mobility group box protein (TOX), cluster of differentiation 57 (CD57), and killer cell lectin-like receptor subfamily G member 1 (KLRG1). You will construct a principled probabilistic classifier to assign each cell to one of three latent states consistent with systems immunology and immunosenescence: an exhaustion state $E$, a senescence state $S$, or an other/non-dysfunctional state $N$. You will then compute cohort-level state proportions and uncertainty for an older cohort.\n\nUse the following foundational base, assumptions, and definitions:\n- The Bayes theorem for latent state inference: for a cell with feature vector $x \\in \\mathbb{R}^4$, the posterior satisfies $p(z \\mid x) \\propto p(z) \\, p(x \\mid z)$, where $z \\in \\{E,S,N\\}$.\n- The naive independence assumption across markers conditional on the state: $p(x \\mid z) = \\prod_{m \\in \\{\\text{PD-1}, \\text{TOX}, \\text{CD57}, \\text{KLRG1}\\}} p(x_m \\mid z)$.\n- For each marker $m$ and state $z$, model $x_m \\mid z \\sim \\mathcal{N}(\\mu_{m,z}, \\sigma_{m,z}^2)$ with known parameters. The Gaussian probability density function is $f(x \\mid \\mu, \\sigma^2) = \\frac{1}{\\sqrt{2 \\pi \\sigma^2}} \\exp\\!\\left( -\\frac{(x - \\mu)^2}{2 \\sigma^2} \\right)$.\n- Prior state probabilities for an older cohort are $p(E) = 0.35$, $p(S) = 0.45$, and $p(N) = 0.20$.\n- Use the following scientifically plausible parameterization reflecting marker-level tendencies observed in exhaustion versus senescence:\n  - Exhaustion $E$: $\\mu_{\\text{PD-1},E} = 3.0$, $\\sigma_{\\text{PD-1},E} = 0.8$; $\\mu_{\\text{TOX},E} = 2.5$, $\\sigma_{\\text{TOX},E} = 0.7$; $\\mu_{\\text{CD57},E} = 0.8$, $\\sigma_{\\text{CD57},E} = 0.5$; $\\mu_{\\text{KLRG1},E} = 0.9$, $\\sigma_{\\text{KLRG1},E} = 0.5$.\n  - Senescence $S$: $\\mu_{\\text{PD-1},S} = 1.2$, $\\sigma_{\\text{PD-1},S} = 0.6$; $\\mu_{\\text{TOX},S} = 1.0$, $\\sigma_{\\text{TOX},S} = 0.6$; $\\mu_{\\text{CD57},S} = 3.2$, $\\sigma_{\\text{CD57},S} = 0.7$; $\\mu_{\\text{KLRG1},S} = 3.0$, $\\sigma_{\\text{KLRG1},S} = 0.8$.\n  - Other $N$: $\\mu_{\\text{PD-1},N} = 0.5$, $\\sigma_{\\text{PD-1},N} = 0.4$; $\\mu_{\\text{TOX},N} = 0.5$, $\\sigma_{\\text{TOX},N} = 0.4$; $\\mu_{\\text{CD57},N} = 0.5$, $\\sigma_{\\text{CD57},N} = 0.4$; $\\mu_{\\text{KLRG1},N} = 0.5$, $\\sigma_{\\text{KLRG1},N} = 0.4$.\n- For numerical stability, compute posteriors via log-probabilities and the log-sum-exp identity: for a vector $a \\in \\mathbb{R}^K$, $\\log\\!\\left(\\sum_{k=1}^K \\exp(a_k)\\right) = c + \\log\\!\\left(\\sum_{k=1}^K \\exp(a_k - c)\\right)$ with $c = \\max_k a_k$.\n- Let the cohort-level expected proportion of state $z$ be $\\hat{\\pi}_z = \\frac{1}{n} \\sum_{i=1}^n p(z \\mid x^{(i)})$, where $n$ is the number of cells and $x^{(i)}$ is the $i$-th cell’s marker vector.\n- Quantify uncertainty using a conjugate prior on the multinomial state proportions: a symmetric Dirichlet prior $\\mathrm{Dir}(\\alpha_0)$ with $\\alpha_0 = (1,1,1)$. The posterior parameters are $\\alpha = \\alpha_0 + \\sum_{i=1}^n \\big(p(E \\mid x^{(i)}), p(S \\mid x^{(i)}), p(N \\mid x^{(i)})\\big)$. The marginal for $\\pi_z$ is $\\mathrm{Beta}(\\alpha_z, \\sum_{k} \\alpha_k - \\alpha_z)$. Use the quantile function to report $0.95$ credible intervals: the lower bound is $q_{0.025}$ and the upper bound is $q_{0.975}$ of the corresponding Beta distribution.\n\nImplement the classifier and uncertainty computation described above. Do not use any external input; operate only on the test suites provided below.\n\nTest suite (each test case is a list of single cells; each cell is $x^{(i)} = (\\text{PD-1}, \\text{TOX}, \\text{CD57}, \\text{KLRG1})$):\n- Case A (mixed older cohort, general case, $n = 12$):\n  \n  $\\big(3.6, 2.9, 0.7, 0.8\\big), \\big(3.2, 2.4, 0.6, 1.1\\big), \\big(2.8, 2.6, 1.0, 0.9\\big), \\big(3.0, 2.7, 0.7, 0.6\\big),$\n  \n  $\\big(1.0, 0.9, 3.3, 3.2\\big), \\big(1.4, 1.3, 3.0, 2.7\\big), \\big(1.3, 1.1, 3.4, 3.5\\big), \\big(0.8, 0.7, 2.9, 3.0\\big),$\n  \n  $\\big(0.6, 0.5, 0.4, 0.5\\big), \\big(0.4, 0.6, 0.6, 0.4\\big), \\big(0.5, 0.5, 0.5, 0.6\\big), \\big(0.3, 0.4, 0.5, 0.5\\big).$\n  \n- Case B (ambiguous boundary case, $n = 5$):\n  \n  $\\big(1.5, 1.6, 1.4, 1.5\\big), \\big(1.7, 1.4, 1.6, 1.5\\big), \\big(1.6, 1.5, 1.5, 1.6\\big), \\big(1.4, 1.6, 1.4, 1.4\\big), \\big(1.5, 1.5, 1.5, 1.5\\big).$\n  \n- Case C (low-expression edge case, $n = 5$):\n  \n  $\\big(0.1, 0.2, 0.1, 0.2\\big), \\big(0.2, 0.1, 0.2, 0.1\\big), \\big(0.0, 0.0, 0.0, 0.0\\big), \\big(0.3, 0.3, 0.2, 0.2\\big), \\big(0.1, 0.1, 0.3, 0.3\\big).$\n  \n\nRequired outputs for each test case:\n- Produce a summary list of nine floats $[\\hat{\\pi}_E, \\hat{\\pi}_S, \\hat{\\pi}_N, L_E, U_E, L_S, U_S, L_N, U_N]$, where $L_z$ and $U_z$ are the lower and upper bounds of the $0.95$ credible interval for $\\pi_z$ from the Beta marginal induced by the Dirichlet posterior.\n- All floats must be rounded to $4$ decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is the summary list for one test case. For example, the final output format must look like $[\\,[\\dots],\\,[\\dots],\\,[\\dots]\\,]$ but with numeric values and commas only (no spaces).",
            "solution": "The problem is assessed to be valid. It is a well-posed, scientifically grounded, and objective problem in computational systems biology. It provides a complete set of assumptions, parameters, data, and a clear set of objectives, allowing for a unique and verifiable solution. The methodology prescribed—a Naive Bayes classifier with Gaussian likelihoods and Bayesian uncertainty quantification via a Dirichlet-Multinomial model—is a standard and appropriate technique for this type of cell-state classification task. All data and parameters are provided, and there are no internal contradictions or ambiguities.\n\nThe solution proceeds by implementing the specified probabilistic classifier. The core of the method is Bayes' theorem, which states that the posterior probability of a cell belonging to a latent state $z$ given its marker expression profile $x$ is proportional to the likelihood of observing $x$ given state $z$ multiplied by the prior probability of state $z$.\n$$\np(z \\mid x) = \\frac{p(x \\mid z) p(z)}{p(x)} \\propto p(x \\mid z) p(z)\n$$\nwhere $z \\in \\{E, S, N\\}$ represents the Exhaustion, Senescence, and Other/Non-dysfunctional states, respectively. The term $p(x) = \\sum_{z'} p(x \\mid z') p(z')$ is a normalization constant, ensuring the posterior probabilities sum to $1$.\n\nThe problem states to use the naive independence assumption, where the marker expression levels are conditionally independent given the cell's state. This simplifies the likelihood calculation:\n$$\np(x \\mid z) = \\prod_{m} p(x_m \\mid z)\n$$\nwhere $m$ indexes the four markers: PD-1, TOX, CD57, and KLRG1. Each conditional likelihood $p(x_m \\mid z)$ is modeled as a Gaussian (Normal) distribution, $x_m \\mid z \\sim \\mathcal{N}(\\mu_{m,z}, \\sigma_{m,z}^2)$, with given state-specific parameters for mean ($\\mu$) and standard deviation ($\\sigma$). The probability density function (PDF) is:\n$$\np(x_m \\mid \\mu_{m,z}, \\sigma^2_{m,z}) = \\frac{1}{\\sqrt{2 \\pi \\sigma^2_{m,z}}} \\exp\\left( -\\frac{(x_m - \\mu_{m,z})^2}{2 \\sigma^2_{m,z}} \\right)\n$$\nTo avoid numerical underflow from multiplying many small probabilities, all calculations are performed in log-space. The log-posterior is proportional to the sum of the log-prior and the log-likelihood:\n$$\n\\log p(z \\mid x) \\propto \\log p(z) + \\log p(x \\mid z) = \\log p(z) + \\sum_{m} \\log p(x_m \\mid z)\n$$\nThe log-PDF of the Gaussian distribution is:\n$$\n\\log p(x_m \\mid \\mu_{m,z}, \\sigma^2_{m,z}) = -\\frac{(x_m - \\mu_{m,z})^2}{2 \\sigma^2_{m,z}} - \\log(\\sigma_{m,z}) - \\frac{1}{2}\\log(2\\pi)\n$$\nLet $a_z = \\log p(z) + \\sum_{m} \\log p(x_m \\mid z)$ be the unnormalized log-posterior for state $z$. To obtain the normalized posterior probabilities $p(z \\mid x)$, we use the log-sum-exp trick for numerical stability. The log of the normalization constant (the evidence) is $\\log p(x) = \\log(\\sum_{z'} \\exp(a_{z'}))$. This is computed as:\n$$\n\\log p(x) = c + \\log\\left(\\sum_{z'} \\exp(a_{z'} - c)\\right), \\quad \\text{where } c = \\max_{z'} a_{z'}\n$$\nThe final log-posterior is $\\log p(z \\mid x) = a_z - \\log p(x)$, and the posterior probability is $p(z \\mid x) = \\exp(\\log p(z \\mid x))$. This procedure is applied to each cell $x^{(i)}$ in a given cohort.\n\nAfter computing the posterior probabilities $p(z \\mid x^{(i)})$ for all $n$ cells in a cohort, the expected cohort-level proportion of each state, $\\hat{\\pi}_z$, is calculated as the average of these posterior probabilities:\n$$\n\\hat{\\pi}_z = \\frac{1}{n} \\sum_{i=1}^n p(z \\mid x^{(i)})\n$$\nUncertainty in these proportions is quantified using a Bayesian approach. The problem specifies a symmetric Dirichlet prior on the state proportions $\\vec{\\pi} = (\\pi_E, \\pi_S, \\pi_N)$, with parameters $\\alpha_0 = (1, 1, 1)$. The posterior distribution over $\\vec{\\pi}$ is also a Dirichlet distribution with updated parameters $\\alpha = (\\alpha_E, \\alpha_S, \\alpha_N)$, calculated as:\n$$\n\\alpha_z = \\alpha_{0,z} + \\sum_{i=1}^{n} p(z \\mid x^{(i)})\n$$\nThe marginal distribution for a single proportion $\\pi_z$ from a Dirichlet posterior $\\mathrm{Dir}(\\alpha)$ is a Beta distribution:\n$$\n\\pi_z \\sim \\mathrm{Beta}\\left(\\alpha_z, \\sum_{k \\neq z} \\alpha_k\\right)\n$$\nThe $0.95$ credible interval for each $\\pi_z$ is obtained by finding the $0.025$ and $0.975$ quantiles of its corresponding marginal Beta distribution. This is achieved using the percent point function (PPF), i.e., the inverse of the cumulative distribution function (CDF).\n\nThe implementation will process each test case by applying this entire pipeline: calculating per-cell posteriors, averaging them to find cohort proportions, and then computing the credible intervals from the Beta marginals of the Dirichlet posterior. The final output for each case is a list of nine rounded floating-point numbers: $[\\hat{\\pi}_E, \\hat{\\pi}_S, \\hat{\\pi}_N, L_E, U_E, L_S, U_S, L_N, U_N]$, where $L_z$ and $U_z$ are the lower and upper bounds of the credible intervals.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm, beta\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the problem-solving process.\n    It defines parameters, test cases, and orchestrates the computation\n    and formatting of the final output.\n    \"\"\"\n    \n    # Define parameters for the Gaussian mixture model\n    # States are E (Exhaustion), S (Senescence), N (Other)\n    # Markers are PD-1, TOX, CD57, KLRG1\n    params = {\n        'E': {\n            'prior': 0.35,\n            'mu': np.array([3.0, 2.5, 0.8, 0.9]),\n            'sigma': np.array([0.8, 0.7, 0.5, 0.5])\n        },\n        'S': {\n            'prior': 0.45,\n            'mu': np.array([1.2, 1.0, 3.2, 3.0]),\n            'sigma': np.array([0.6, 0.6, 0.7, 0.8])\n        },\n        'N': {\n            'prior': 0.20,\n            'mu': np.array([0.5, 0.5, 0.5, 0.5]),\n            'sigma': np.array([0.4, 0.4, 0.4, 0.4])\n        }\n    }\n    states = ['E', 'S', 'N']\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: mixed older cohort, general case, n = 12\n        [\n            (3.6, 2.9, 0.7, 0.8), (3.2, 2.4, 0.6, 1.1), (2.8, 2.6, 1.0, 0.9), (3.0, 2.7, 0.7, 0.6),\n            (1.0, 0.9, 3.3, 3.2), (1.4, 1.3, 3.0, 2.7), (1.3, 1.1, 3.4, 3.5), (0.8, 0.7, 2.9, 3.0),\n            (0.6, 0.5, 0.4, 0.5), (0.4, 0.6, 0.6, 0.4), (0.5, 0.5, 0.5, 0.6), (0.3, 0.4, 0.5, 0.5)\n        ],\n        # Case B: ambiguous boundary case, n = 5\n        [\n            (1.5, 1.6, 1.4, 1.5), (1.7, 1.4, 1.6, 1.5), (1.6, 1.5, 1.5, 1.6), (1.4, 1.6, 1.4, 1.4), (1.5, 1.5, 1.5, 1.5)\n        ],\n        # Case C: low-expression edge case, n = 5\n        [\n            (0.1, 0.2, 0.1, 0.2), (0.2, 0.1, 0.2, 0.1), (0.0, 0.0, 0.0, 0.0), (0.3, 0.3, 0.2, 0.2), (0.1, 0.1, 0.3, 0.3)\n        ]\n    ]\n\n    all_results = []\n    for cohort_data in test_cases:\n        result = process_cohort(cohort_data, params, states)\n        all_results.append(result)\n\n    # Format the final output string as per requirements\n    case_strs = []\n    for res_list in all_results:\n        # Format each list of floats into \"[v1,v2,...,v9]\" with 4 decimal places\n        case_str = f\"[{','.join([f'{x:.4f}' for x in res_list])}]\"\n        case_strs.append(case_str)\n    \n    final_output = f\"[{','.join(case_strs)}]\"\n    print(final_output)\n\ndef process_cohort(cohort_data, params, states):\n    \"\"\"\n    Processes a single cohort of cells to compute state proportions and uncertainty.\n\n    Args:\n        cohort_data (list of tuples): A list where each tuple contains the 4 marker\n                                      expression values for a single cell.\n        params (dict): A dictionary containing priors, means (mu), and standard\n                       deviations (sigma) for each state.\n        states (list of str): A list of state keys (e.g., ['E', 'S', 'N']).\n\n    Returns:\n        list of floats: A 9-element list containing the estimated proportions\n                        and credible interval bounds for each state.\n    \"\"\"\n    n_cells = len(cohort_data)\n    n_states = len(states)\n    \n    # Store posterior probabilities for each cell\n    cohort_posteriors = np.zeros((n_cells, n_states))\n    \n    log_priors = np.array([np.log(params[s]['prior']) for s in states])\n\n    for i, cell_data in enumerate(cohort_data):\n        x = np.array(cell_data)\n        \n        # Calculate log-likelihood for each state\n        log_likelihoods = np.zeros(n_states)\n        for j, state in enumerate(states):\n            mu = params[state]['mu']\n            sigma = params[state]['sigma']\n            # Sum of log-pdfs for each marker under Naive Bayes assumption\n            log_likelihoods[j] = np.sum(norm.logpdf(x, loc=mu, scale=sigma))\n            \n        # Calculate unnormalized log-posteriors\n        unnormalized_log_posteriors = log_priors + log_likelihoods\n        \n        # Normalize using log-sum-exp trick for numerical stability\n        c = np.max(unnormalized_log_posteriors)\n        log_sum_exp = c + np.log(np.sum(np.exp(unnormalized_log_posteriors - c)))\n        log_posteriors = unnormalized_log_posteriors - log_sum_exp\n        \n        # Convert back to probabilities and store\n        cohort_posteriors[i, :] = np.exp(log_posteriors)\n\n    # 1. Compute cohort-level expected proportions (pi_hat)\n    pi_hats = np.mean(cohort_posteriors, axis=0)\n    \n    # 2. Compute uncertainty using Dirichlet-Multinomial model\n    # Sum of posterior probabilities across the cohort\n    sum_posteriors = np.sum(cohort_posteriors, axis=0)\n    \n    # Dirichlet prior parameter alpha_0\n    alpha_0 = np.ones(n_states)\n    \n    # Dirichlet posterior parameters alpha\n    alpha_posterior = alpha_0 + sum_posteriors\n    \n    # Sum of posterior alphas\n    alpha_sum = np.sum(alpha_posterior)\n    \n    # Calculate 95% credible intervals from marginal Beta distributions\n    credible_intervals = []\n    for j in range(n_states):\n        alpha_z = alpha_posterior[j]\n        # The second parameter of the Beta distribution is (sum of all alphas) - alpha_z\n        beta_z = alpha_sum - alpha_z\n        # Get lower (0.025) and upper (0.975) bounds\n        ci_bounds = beta.ppf([0.025, 0.975], alpha_z, beta_z)\n        credible_intervals.extend(ci_bounds)\n        \n    # Combine results: [pi_E, pi_S, pi_N, L_E, U_E, L_S, U_S, L_N, U_N]\n    final_results = np.concatenate((pi_hats, np.array(credible_intervals)))\n    \n    return final_results.tolist()\n\nsolve()\n```"
        }
    ]
}