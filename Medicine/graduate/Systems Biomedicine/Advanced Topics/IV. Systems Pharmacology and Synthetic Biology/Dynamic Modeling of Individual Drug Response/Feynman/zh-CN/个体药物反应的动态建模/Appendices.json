{
    "hands_on_practices": [
        {
            "introduction": "动态模型的构建始于基本物理原理，如质量守恒。本练习将指导您从基本定义出发，为一个经典的药代动力学/药效动力学（PK/PD）模型建立常微分方程（ODE）。在此基础上，我们将运用无量纲化这一强大技术，通过缩放变量来减少参数数量，从而揭示决定系统行为的核心参数组合，这对于理解模型的内在结构至关重要。",
            "id": "4336926",
            "problem": "考虑一个个体水平的单室药代动力学和药效动力学 (PK/PD) 模型，该模型由以下原理描述。药代动力学状态变量是中央室中的药物量，记为 $A_{c}(t)$。质量守恒给出了输入通量和消除通量之间的平衡。输入是可控的输注速率 $u(t)$，消除与中央室中的浓度成正比。浓度定义为中央室药物量除以表观分布容积 $V$。清除率 $CL$ 定义为单位时间内被完全清除药物的血浆虚拟体积。药效动力学输出 $y(t)$ 是一个测量的生物标志物，其瞬时水平是通过一个带基线的最大效应模型，随药代动力学浓度变化的递增饱和函数。所有模型变量和参数均为正值。自变量是时间 $t$。\n\n任务：\n1) 基于质量守恒以及清除率和浓度的定义，使用量纲分析为 $A_{c}$、$CL$、$V$、$u$ 和 $y$ 指定物理单位。单位表示中使用毫克 (mg) 表示质量，升 (L) 表示体积，小时 (h) 表示时间，生物标志物单位 (B) 表示测量输出。\n2) 从质量平衡原理“量的变化率等于流入减去流出”和清除率的定义“消除速率等于清除率乘以浓度”出发，写出 $A_{c}(t)$ 的常微分方程 (ODE)，并使用包含参数 $E_{0}$ (基线效应)、$E_{\\max}$ (药物引起的最大效应) 和 $EC_{50}$ (半数有效浓度) 的最大效应带基线公式，为 $y(t)$ 指定一个瞬时效应药效动力学映射。\n3) 构建一个无量纲化方案，以减少自由参数的数量，同时保留模型的预测结构，具体如下。从药代动力学中定义一个特征时间尺度，并选择等于半数有效浓度的浓度标度。通过适当地缩放 $A_{c}(t)$、$t$、$u(t)$ 和 $y(t)$ 来定义无量纲状态、时间、输入和输出。推导出完全无量纲化的ODE和输出映射。确定原始参数的哪些组合在这些选择后作为独立的无量纲群保留下来，以及还剩下多少个这样的群组。\n4) 考虑在 $t = 0$ 时开始的恒速输注 $u(t) = u_{0}$。在其稳态点附近对无量纲ODE进行线性化，并确定线性化动力学的唯一非零特征值。将此特征值作为你的最终答案。无需四舍五入，最终答案必须是一个无单位的精确数字。",
            "solution": "该问题经评估具有科学依据、提法明确且客观。它基于药代动力学和药效动力学建模的经典原理。所有必要的定义和条件都已提供，可以推导出唯一的解。开始求解。\n\n问题包括四个部分，将按顺序解决。\n\n1) **量纲分析**\n使用变量和参数的定义以及量纲齐次性原理来确定它们的物理单位。基本单位给定为：质量为毫克 ($mg$)，体积为升 ($L$)，时间为小时 ($h$)，输出为生物标志物单位 ($B$)。\n\n- $A_{c}(t)$：中央室中的药物量。这是一个质量。其单位是 $mg$。\n- $V$：表观分布容积。这是一个体积。其单位是 $L$。\n- 浓度 $C(t)$ 定义为 $A_{c}(t)/V$。因此其单位是 $\\frac{mg}{L}$。\n- $CL$：清除率定义为单位时间内被清除的血浆体积。其单位是 $\\frac{L}{h}$。\n- 消除速率由清除率和浓度的乘积给出，$CL \\times C(t)$。该速率的单位是 $(\\frac{L}{h}) \\times (\\frac{mg}{L}) = \\frac{mg}{h}$，这正确定地表示了质量通量（单位时间内的质量）。\n- $u(t)$：输注速率是一个输入的质量通量。其单位是 $\\frac{mg}{h}$。\n- $y(t)$：测量的生物标志物输出。其单位给定为 $B$。\n\n总结如下：\n- $A_{c}$ 的单位：$mg$\n- $CL$ 的单位：$\\frac{L}{h}$\n- $V$ 的单位：$L$\n- $u$ 的单位：$\\frac{mg}{h}$\n- $y$ 的单位：$B$\n\n2) **模型构建**\n$A_{c}(t)$ 的药代动力学 (PK) 模型源于质量平衡原理：“量的变化率等于流入减去流出”。\n\n- 量的变化率：$\\frac{dA_{c}(t)}{dt}$。\n- 流入速率：$u(t)$。\n- 流出速率 (消除)：$CL \\times C(t) = CL \\times \\frac{A_{c}(t)}{V}$。\n\n结合这些项，得到药代动力学状态的常微分方程 (ODE)：\n$$\n\\frac{dA_{c}(t)}{dt} = u(t) - \\frac{CL}{V} A_{c}(t)\n$$\n输出 $y(t)$ 的药效动力学 (PD) 模型是一个关于浓度 $C(t)$ 的瞬时饱和函数，由带基线的最大效应模型描述。参数为基线效应 $E_{0}$、药物引起的最大效应 $E_{\\max}$ 和半数有效浓度 $EC_{50}$。标准公式为：\n$$\ny(t) = E_{0} + \\frac{E_{\\max} \\cdot C(t)}{EC_{50} + C(t)}\n$$\n由于 $C(t) = \\frac{A_{c}(t)}{V}$，这也可以用药物量 $A_c(t)$ 表示：\n$$\ny(t) = E_{0} + \\frac{E_{\\max} \\cdot \\frac{A_{c}(t)}{V}}{EC_{50} + \\frac{A_{c}(t)}{V}} = E_{0} + \\frac{E_{\\max} \\cdot A_{c}(t)}{V \\cdot EC_{50} + A_{c}(t)}\n$$\n\n3) **无量纲化**\n接下来，我们构建模型的无量纲版本。\n\n- **特征时间尺度：** 在PK ODE中，项 $\\frac{CL}{V}$ 的单位是 $\\frac{1}{h}$。其倒数定义了特征时间尺度 $\\tau$。\n$$\n\\tau = \\frac{V}{CL}\n$$\n我们定义无量纲时间 $\\bar{t}$ 为：\n$$\n\\bar{t} = \\frac{t}{\\tau} = \\frac{t \\cdot CL}{V}\n$$\n- **特征浓度和量尺度：** 问题指定使用 $EC_{50}$ 作为浓度标度。\n$$\nC_{ref} = EC_{50}\n$$\n相应的特征量尺度 $A_{c,ref}$ 从 $A_c = C \\cdot V$ 推导得出：\n$$\nA_{c,ref} = C_{ref} \\cdot V = EC_{50} \\cdot V\n$$\n无量纲状态 (量) $\\bar{A}_{c}$ 定义为：\n$$\n\\bar{A}_{c}(\\bar{t}) = \\frac{A_{c}(t)}{A_{c,ref}} = \\frac{A_{c}(t)}{EC_{50} \\cdot V}\n$$\n注意 $\\bar{A}_{c} = \\frac{A_c/V}{EC_{50}} = \\frac{C}{EC_{50}}$，所以无量纲量等同于无量纲浓度。\n\n- **特征输入尺度：** 为确定输入尺度 $u_{ref}$，我们分析PK ODE中各项的特征量级。$\\frac{dA_{c}}{dt}$ 和 $\\frac{CL}{V}A_c$ 的特征量级都是 $\\frac{A_{c,ref}}{\\tau} = \\frac{EC_{50} \\cdot V}{V/CL} = EC_{50} \\cdot CL$。为保持平衡，我们选择 $u_{ref}$ 为此值。\n$$\nu_{ref} = EC_{50} \\cdot CL\n$$\n无量纲输入 $\\bar{u}$ 是：\n$$\n\\bar{u}(\\bar{t}) = \\frac{u(t)}{u_{ref}} = \\frac{u(t)}{EC_{50} \\cdot CL}\n$$\n- **无量纲ODE的推导：** 我们使用链式法则重写PK ODE的时间导数：$\\frac{dA_{c}}{dt} = \\frac{d(A_{c,ref} \\bar{A}_{c})}{d(\\tau \\bar{t})} = \\frac{A_{c,ref}}{\\tau}\\frac{d\\bar{A}_{c}}{d\\bar{t}}$。\n$$\n\\frac{A_{c,ref}}{\\tau}\\frac{d\\bar{A}_{c}}{d\\bar{t}} = u_{ref}\\bar{u} - \\frac{CL}{V} (A_{c,ref}\\bar{A}_{c})\n$$\n代入缩放因子：\n$$\n(EC_{50} \\cdot CL)\\frac{d\\bar{A}_{c}}{d\\bar{t}} = (EC_{50} \\cdot CL)\\bar{u} - \\frac{CL}{V} (EC_{50} \\cdot V)\\bar{A}_{c}\n$$\n将此方程的所有项除以公因子 $(EC_{50} \\cdot CL)$ 进行简化，得到无量纲ODE：\n$$\n\\frac{d\\bar{A}_{c}}{d\\bar{t}} = \\bar{u}(\\bar{t}) - \\bar{A}_{c}(\\bar{t})\n$$\n- **无量纲输出映射的推导：** PD映射为 $y(t) = E_{0} + \\frac{E_{\\max} \\cdot C(t)}{EC_{50} + C(t)}$。我们通过缩放药物引起的效应来定义无量纲输出 $\\bar{y}$：\n$$\n\\bar{y} = \\frac{y(t) - E_{0}}{E_{\\max}} = \\frac{C(t)}{EC_{50} + C(t)}\n$$\n分子和分母同除以 $EC_{50}$：\n$$\n\\bar{y} = \\frac{C(t)/EC_{50}}{1 + C(t)/EC_{50}}\n$$\n由于 $\\bar{A}_{c} = C/EC_{50}$，无量纲输出映射为：\n$$\n\\bar{y}(\\bar{t}) = \\frac{\\bar{A}_{c}(\\bar{t})}{1 + \\bar{A}_{c}(\\bar{t})}\n$$\n- **独立的无量纲群：** 原始模型有五个参数：$\\{V, CL, E_{0}, E_{\\max}, EC_{50}\\}$。推导出的 $\\bar{A}_{c}$ 的无量纲PK模型是无参数的。$\\bar{y}$ 的无量纲PD映射也是无参数的。然而，要从无量纲状态解 $\\bar{A}_{c}(\\bar{t})$ 恢复物理输出 $y(t)$，必须使用关系式 $y(t) = E_{0} + E_{\\max} \\cdot \\bar{y}(\\bar{t}) = E_{0} + E_{\\max} \\frac{\\bar{A}_{c}(\\bar{t})}{1 + \\bar{A}_{c}(\\bar{t})}$。这最后一步取决于两个原始参数，$E_{0}$ 和 $E_{\\max}$。因此，无量纲化后保留了两个独立的参数群。\n\n4) **线性化与特征值**\n考虑对于 $t \\ge 0$ 的恒速输注 $u(t) = u_{0}$。无量纲输入变为一个常数，$\\bar{u}(\\bar{t}) = \\bar{u}_{0} = \\frac{u_{0}}{EC_{50} \\cdot CL}$。无量纲ODE是：\n$$\n\\frac{d\\bar{A}_{c}}{d\\bar{t}} = \\bar{u}_{0} - \\bar{A}_{c}\n$$\n这是一个一阶线性时不变 (LTI) 系统。我们需要在其稳态点附近对其进行线性化。令 $f(\\bar{A}_{c}) = \\bar{u}_{0} - \\bar{A}_{c}$。稳态 $\\bar{A}_{c,ss}$ 通过将时间导数设为零来找到：\n$$\nf(\\bar{A}_{c,ss}) = 0 \\implies \\bar{u}_{0} - \\bar{A}_{c,ss} = 0 \\implies \\bar{A}_{c,ss} = \\bar{u}_{0}\n$$\n系统 $\\frac{d\\bar{A}_{c}}{d\\bar{t}} = f(\\bar{A}_{c})$ 在 $\\bar{A}_{c,ss}$ 附近的线性化由 $\\frac{d(\\delta\\bar{A}_{c})}{d\\bar{t}} = J \\cdot \\delta\\bar{A}_{c}$ 给出，其中 $\\delta\\bar{A}_{c} = \\bar{A}_{c} - \\bar{A}_{c,ss}$，$J$ 是在稳态点处求值的雅可比矩阵（在此一维情况下为标量）。\n$$\nJ = \\frac{df}{d\\bar{A}_{c}} \\bigg|_{\\bar{A}_{c} = \\bar{A}_{c,ss}}\n$$\n我们计算 $f$ 的导数：\n$$\n\\frac{df}{d\\bar{A}_{c}} = \\frac{d}{d\\bar{A}_{c}}(\\bar{u}_{0} - \\bar{A}_{c}) = -1\n$$\n雅可比矩阵是一个常数，$J = -1$。因此，线性化动力学为：\n$$\n\\frac{d(\\delta\\bar{A}_{c})}{d\\bar{t}} = -1 \\cdot \\delta\\bar{A}_{c}\n$$\n线性化动力学的特征值是状态偏差的系数，即雅可比矩阵的值。\n唯一的非零特征值为 $-1$。",
            "answer": "$$\n\\boxed{-1}\n$$"
        },
        {
            "introduction": "一个数学模型，无论多么精细，如果其参数无法通过实验数据唯一确定，那么它的实用价值将大打折扣。这个练习直面参数辨识度这一核心问题，尤其是在数据稀疏的实际情况下。您将通过前向敏感性分析，以编程方式探讨不同的采样方案如何影响我们辨识两室PK模型参数的能力，这项实践对于设计信息丰富的临床试验、确保模型校准的可靠性至关重要。",
            "id": "4336931",
            "problem": "考虑一个双室药代动力学（PK）模型，该模型采用静脉（IV）推注给药方式，在系统生物医学中用于研究个体对药物的动态响应。设 $A_1(t)$ 和 $A_2(t)$ 分别表示在时间 $t$ 中央室和外周室中的药物量。初始条件为向中央室静脉推注剂量 $D$，因此 $A_1(0)=D$ 且 $A_2(0)=0$。中央室的浓度为 $C(t)=A_1(t)/V_1$，其中 $V_1$ 是中央分布容积。模型参数包括室间转运速率 $k_{12}$（从中央到外周）、$k_{21}$（从外周到中央）以及从中央室的消除速率 $k_{10}$。\n\n基于质量守恒和线性一级动力学的质量平衡常微分方程（ODE）如下：\n$$\n\\frac{dA_1}{dt} = -\\left(k_{10}+k_{12}\\right)A_1 + k_{21}A_2, \\quad\n\\frac{dA_2}{dt} = k_{12}A_1 - k_{21}A_2.\n$$\n\n参数向量 $\\theta=\\left[k_{12},k_{21},k_{10}\\right]^T$ 在一组标称参数下的局部结构可辨识性，可以通过可观测量 $C(t)$ 关于 $\\theta$ 的灵敏度矩阵的秩来评估。设采样时间为 $t_1,\\dots,t_m$。定义灵敏度矩阵 $S \\in \\mathbb{R}^{m \\times 3}$，其元素为 $S_{i,j} = \\frac{\\partial C(t_i)}{\\partial \\theta_j}$。如果 $\\operatorname{rank}(S)=3$，则在这套采样设计下，这三个参数是局部结构可辨识的；否则，它们不是。\n\n你需要实现一个程序，使用前向灵敏度分析，为不同的采样方案构建灵敏度矩阵 $S$ 并报告其秩，以展示采样设计（例如，稀疏与密集的早期采样）如何影响可辨识性。\n\n对一个典型的成人小分子药物，使用以下科学上合理的标称值：\n- 剂量 $D = 100$ mg，\n- 中央容积 $V_1 = 10$ L，\n- 参数 $(k_{12}, k_{21}, k_{10}) = (0.7, 0.3, 0.2)$ $\\text{h}^{-1}$。\n\n所有时间单位均视为小时，药物量单位为毫克（mg），容积单位为升（L）。虽然中间变量可能带有单位，但最终输出是无单位的整数。\n\n通过常微分方程的标准线性化来实现前向灵敏度。对于每个参数 $\\theta_j$，灵敏度状态 $s^{(j)}(t) = \\left[\\frac{\\partial A_1}{\\partial \\theta_j}(t), \\frac{\\partial A_2}{\\partial \\theta_j}(t)\\right]^T$ 满足\n$$\n\\frac{d}{dt} s^{(j)}(t) = J_x(t)\\, s^{(j)}(t) + g^{(j)}(t),\n$$\n其中 $J_x(t)$ 是方程右侧对于状态 $(A_1, A_2)$ 的雅可比矩阵，\n$$\nJ_x(t) = \\begin{bmatrix}\n-\\left(k_{10}+k_{12}\\right)  k_{21} \\\\\nk_{12}  -k_{21}\n\\end{bmatrix},\n$$\n而 $g^{(j)}(t)$ 是方程右侧对于 $\\theta_j$ 的偏导数，\n$$\ng^{(k_{12})}(t) = \\begin{bmatrix} -A_1(t) \\\\ A_1(t) \\end{bmatrix}, \\quad\ng^{(k_{21})}(t) = \\begin{bmatrix} A_2(t) \\\\ -A_2(t) \\end{bmatrix}, \\quad\ng^{(k_{10})}(t) = \\begin{bmatrix} -A_1(t) \\\\ 0 \\end{bmatrix}.\n$$\n由于剂量与 $\\theta$ 无关，使用初始条件 $s^{(j)}(0) = \\left[0, 0\\right]^T$。\n\n从 $s^{(j)}(t)$ 可得浓度灵敏度为 $\\frac{\\partial C(t)}{\\partial \\theta_j} = \\frac{1}{V_1}\\frac{\\partial A_1(t)}{\\partial \\theta_j}$。\n\n通过在指定的采样时间点上评估这些灵敏度来构建灵敏度矩阵 $S$。使用奇异值分解准则和标准的数值容差来计算矩阵的秩。报告以下采样设计测试套件的秩：\n\n- 情况 A（早期密集且后期充足）：$t = [0.02, 0.05, 0.1, 0.2, 0.5, 1, 2, 4, 8, 12]$。\n- 情况 B（早期稀疏，主要集中在中后期）：$t = [0.5, 2, 8, 12]$。\n- 情况 C（仅后期）：$t = [8, 12, 24]$。\n- 情况 D（非常稀疏的两个点）：$t = [2, 12]$。\n\n你的程序应生成单行输出，其中包含情况 A 到 D 的秩，顺序排列，形式为逗号分隔的列表并用方括号括起（例如，$[3,2,1,2]$）。输出为整数。",
            "solution": "用户提供了一个来自系统生物医学领域的问题，具体聚焦于药代动力学（PK）建模。任务是使用前向灵敏度分析，评估一个双室 PK 模型在不同实验采样设计下的局部结构可辨识性。\n\n**问题陈述验证**\n\n首先，我将根据既定标准验证所提供的问题陈述。\n\n**步骤1：提取的已知条件**\n-   **模型：** 双室药代动力学模型，采用静脉（IV）推注给药。\n-   **状态变量：** $A_1(t)$ 和 $A_2(t)$ 分别是中央室和外周室中的药物量。\n-   **初始条件：** 在时间 $t=0$ 时，$A_1(0)=D$ 和 $A_2(0)=0$。\n-   **可观测量：** 中央室中的浓度，$C(t)=A_1(t)/V_1$。\n-   **参数向量：** $\\theta=\\left[k_{12},k_{21},k_{10}\\right]^T$，其中 $k_{12}$ 是从中央到外周的速率，$k_{21}$ 是从外周到中央的速率，$k_{10}$ 是从中央室的消除速率。\n-   **控制常微分方程：**\n    $$\n    \\frac{dA_1}{dt} = -\\left(k_{10}+k_{12}\\right)A_1 + k_{21}A_2 \\\\\n    \\frac{dA_2}{dt} = k_{12}A_1 - k_{21}A_2\n    $$\n-   **可辨识性方法：** 灵敏度矩阵 $S$ 的秩，其中 $S_{i,j} = \\frac{\\partial C(t_i)}{\\partial \\theta_j}$，在采样时间点 $t_i$ 进行评估。可辨识性要求 $\\operatorname{rank}(S)=3$。\n-   **灵敏度方程（前向方法）：** 状态的灵敏度，$s^{(j)}(t) = \\left[\\frac{\\partial A_1}{\\partial \\theta_j}(t), \\frac{\\partial A_2}{\\partial \\theta_j}(t)\\right]^T$，由以下方程控制：\n    $$ \\frac{d}{dt} s^{(j)}(t) = J_x(t)\\, s^{(j)}(t) + g^{(j)}(t) $$\n    -   **雅可比矩阵：** $J_x(t) = \\begin{bmatrix} -\\left(k_{10}+k_{12}\\right)  k_{21} \\\\ k_{12}  -k_{21} \\end{bmatrix}$。注意对于这个线性时不变系统，$J_x$ 是常数。\n    -   **强迫项：**\n        $g^{(k_{12})}(t) = \\begin{bmatrix} -A_1(t) \\\\ A_1(t) \\end{bmatrix}$,\n        $g^{(k_{21})}(t) = \\begin{bmatrix} A_2(t) \\\\ -A_2(t) \\end{bmatrix}$,\n        $g^{(k_{10})}(t) = \\begin{bmatrix} -A_1(t) \\\\ 0 \\end{bmatrix}$。\n    -   **灵敏度初始条件：** $s^{(j)}(0) = \\left[0, 0\\right]^T$。\n-   **可观测量灵敏度：** $\\frac{\\partial C(t)}{\\partial \\theta_j} = \\frac{1}{V_1}\\frac{\\partial A_1(t)}{\\partial \\theta_j}$。\n-   **标称值：** 剂量 $D = 100$ mg，中央容积 $V_1 = 10$ L，速率常数 $(k_{12}, k_{21}, k_{10}) = (0.7, 0.3, 0.2)$ $\\text{h}^{-1}$。\n-   **采样方案（测试用例）：**\n    -   情况 A: $t = [0.02, 0.05, 0.1, 0.2, 0.5, 1, 2, 4, 8, 12]$\n    -   情况 B: $t = [0.5, 2, 8, 12]$\n    -   情况 C: $t = [8, 12, 24]$\n    -   情况 D: $t = [2, 12]$\n\n**步骤2：已知条件验证**\n-   **科学依据：** 问题建立在标准的双室模型之上，这是药代动力学的一个基本概念。使用灵敏度分析进行可辨识性评估是系统建模中一种公认的、严谨的技术。灵敏度方程的推导是正确的。参数值对于真实世界的药物是合理的。该问题在科学上是合理的。\n-   **良定性与完整性：** 问题是完全指定的。它提供了完整的线性常微分方程系统、所有必要的初始条件、参数值，以及一个清晰、客观的任务（为指定情况计算矩阵的秩）。常微分方程系统解的存在性和唯一性得到保证。没有矛盾之处。\n-   **客观性：** 问题使用精确的数学形式主义陈述，没有任何主观语言。\n\n**步骤3：结论与行动**\n问题陈述是**有效**的。它科学合理、良定且客观。我将继续进行求解。\n\n**基于原理的解决方案**\n\n问题的核心是确定测量时间的选择如何影响我们从浓度数据 $C(t)$ 中唯一确定模型参数 $\\theta = [k_{12}, k_{21}, k_{10}]^T$ 的能力。局部结构可辨识性通过灵敏度矩阵 $S$ 的秩来评估，该矩阵的列是可观测量 $C(t)$ 相对于每个参数的灵敏度曲线。如果这些列线性无关，则秩将等于参数数量（3），参数即为局部可辨识的。由不佳的采样方案引起的线性相关性会导致秩亏（秩  3）和可辨识性的丧失。\n\n为了构建灵敏度矩阵，我们必须计算 $\\frac{\\partial C(t_i)}{\\partial \\theta_j}$ 的值。这不仅需要求解原始的关于状态 $A_1(t)$ 和 $A_2(t)$ 的常微分方程，还需要求解一组关于状态灵敏度 $\\frac{\\partial A_1}{\\partial \\theta_j}$ 和 $\\frac{\\partial A_2}{\\partial \\theta_j}$ 的常微分方程。\n\n解决方案涉及将原始状态常微分方程与灵敏度常微分方程耦合到一个单一、更大的系统中。这个增广系统描述了药物量及其对每个参数的灵敏度的时间演化。\n\n设增广状态向量为 $Y(t)$，一个 8 维向量：\n$$\nY(t) = \\left[ A_1, A_2, \\frac{\\partial A_1}{\\partial k_{12}}, \\frac{\\partial A_2}{\\partial k_{12}}, \\frac{\\partial A_1}{\\partial k_{21}}, \\frac{\\partial A_2}{\\partial k_{21}}, \\frac{\\partial A_1}{\\partial k_{10}}, \\frac{\\partial A_2}{\\partial k_{10}} \\right]^T\n$$\n该增广系统在 $t=0$ 时的初始条件为：\n$$\nY(0) = \\left[ D, 0, 0, 0, 0, 0, 0, 0 \\right]^T = \\left[ 100, 0, 0, 0, 0, 0, 0, 0 \\right]^T\n$$\n状态的初始条件是 $A_1(0)=D$ 和 $A_2(0)=0$。灵敏度的初始条件全为零，因为初始剂量 $D$ 是一个固定的常数，与参数 $\\theta$ 无关。\n\n这个包含 8 个耦合一阶常微分方程的系统 $\\frac{dY}{dt}$ 定义如下：\n1.  $\\frac{dA_1}{dt} = -(k_{10} + k_{12})A_1 + k_{21}A_2$\n2.  $\\frac{dA_2}{dt} = k_{12}A_1 - k_{21}A_2$\n3.  $\\frac{d}{dt}\\left(\\frac{\\partial A_1}{\\partial k_{12}}\\right) = -(k_{10} + k_{12})\\frac{\\partial A_1}{\\partial k_{12}} + k_{21}\\frac{\\partial A_2}{\\partial k_{12}} - A_1$\n4.  $\\frac{d}{dt}\\left(\\frac{\\partial A_2}{\\partial k_{12}}\\right) = k_{12}\\frac{\\partial A_1}{\\partial k_{12}} - k_{21}\\frac{\\partial A_2}{\\partial k_{12}} + A_1$\n5.  $\\frac{d}{dt}\\left(\\frac{\\partial A_1}{\\partial k_{21}}\\right) = -(k_{10} + k_{12})\\frac{\\partial A_1}{\\partial k_{21}} + k_{21}\\frac{\\partial A_2}{\\partial k_{21}} + A_2$\n6.  $\\frac{d}{dt}\\left(\\frac{\\partial A_2}{\\partial k_{21}}\\right) = k_{12}\\frac{\\partial A_1}{\\partial k_{21}} - k_{21}\\frac{\\partial A_2}{\\partial k_{21}} - A_2$\n7.  $\\frac{d}{dt}\\left(\\frac{\\partial A_1}{\\partial k_{10}}\\right) = -(k_{10} + k_{12})\\frac{\\partial A_1}{\\partial k_{10}} + k_{21}\\frac{\\partial A_2}{\\partial k_{10}} - A_1$\n8.  $\\frac{d}{dt}\\left(\\frac{\\partial A_2}{\\partial k_{10}}\\right) = k_{12}\\frac{\\partial A_1}{\\partial k_{10}} - k_{21}\\frac{\\partial A_2}{\\partial k_{10}}$\n\n使用标准的 ODE 求解器，从 $t=0$ 到所有测试用例所需的最大时间点（$t=24$ 小时），对该增广系统进行数值求解。为优化计算，我们对所有四个案例中指定的唯一时间点集合，一次性求解该系统。\n\n对于每种情况，我们在相关的时间点 $t_i$ 提取中央室灵敏度 $\\frac{\\partial A_1(t_i)}{\\partial \\theta_j}$ 的解。相应的浓度灵敏度则为 $\\frac{\\partial C(t_i)}{\\partial \\theta_j} = \\frac{1}{V_1} \\frac{\\partial A_1(t_i)}{\\partial \\theta_j}$。\n\n这些值被用来为该情况构建灵敏度矩阵 $S$。对于一个有 $m$ 个时间点的情况，$S$ 是一个 $m \\times 3$ 的矩阵：\n$$\nS = \\frac{1}{V_1}\n\\begin{bmatrix}\n\\frac{\\partial A_1(t_1)}{\\partial k_{12}}  \\frac{\\partial A_1(t_1)}{\\partial k_{21}}  \\frac{\\partial A_1(t_1)}{\\partial k_{10}} \\\\\n\\vdots  \\vdots  \\vdots \\\\\n\\frac{\\partial A_1(t_m)}{\\partial k_{12}}  \\frac{\\partial A_1(t_m)}{\\partial k_{21}}  \\frac{\\partial A_1(t_m)}{\\partial k_{10}}\n\\end{bmatrix}\n$$\n最后，使用奇异值分解（SVD）计算 $S$ 的秩，这是确定矩阵秩的数值稳健方法。非零（在容差范围内）奇异值的数量即为秩。对所有四种采样设计重复此过程。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef model_and_sensitivities_ode(t, y, k12, k21, k10):\n    \"\"\"\n    Defines the augmented system of ODEs for the two-compartment model\n    and its sensitivities.\n\n    Args:\n        t (float): Time.\n        y (np.ndarray): Augmented state vector of size 8.\n            y[0]: A1 (amount in central compartment)\n            y[1]: A2 (amount in peripheral compartment)\n            y[2]: sA1_k12 (sensitivity of A1 w.r.t. k12)\n            y[3]: sA2_k12 (sensitivity of A2 w.r.t. k12)\n            y[4]: sA1_k21 (sensitivity of A1 w.r.t. k21)\n            y[5]: sA2_k21 (sensitivity of A2 w.r.t. k21)\n            y[6]: sA1_k10 (sensitivity of A1 w.r.t. k10)\n            y[7]: sA2_k10 (sensitivity of A2 w.r.t. k10)\n        k12, k21, k10 (float): Model parameters.\n\n    Returns:\n        np.ndarray: The derivatives dy/dt for the augmented system.\n    \"\"\"\n    A1, A2, sA1_k12, sA2_k12, sA1_k21, sA2_k21, sA1_k10, sA2_k10 = y\n\n    # Original model ODEs\n    dA1_dt = -(k10 + k12) * A1 + k21 * A2\n    dA2_dt = k12 * A1 - k21 * A2\n\n    # Jacobian matrix components related terms\n    J00 = -(k10 + k12)\n    J01 = k21\n    J10 = k12\n    J11 = -k21\n    \n    # Sensitivity ODEs w.r.t. k12\n    # Forcing term g_k12 = [-A1, A1]\n    dsA1_k12_dt = J00 * sA1_k12 + J01 * sA2_k12 - A1\n    dsA2_k12_dt = J10 * sA1_k12 + J11 * sA2_k12 + A1\n\n    # Sensitivity ODEs w.r.t. k21\n    # Forcing term g_k21 = [A2, -A2]\n    dsA1_k21_dt = J00 * sA1_k21 + J01 * sA2_k21 + A2\n    dsA2_k21_dt = J10 * sA1_k21 + J11 * sA2_k21 - A2\n\n    # Sensitivity ODEs w.r.t. k10\n    # Forcing term g_k10 = [-A1, 0]\n    dsA1_k10_dt = J00 * sA1_k10 + J01 * sA2_k10 - A1\n    dsA2_k10_dt = J10 * sA1_k10 + J11 * sA2_k10\n    \n    return np.array([\n        dA1_dt, dA2_dt, \n        dsA1_k12_dt, dsA2_k12_dt, \n        dsA1_k21_dt, dsA2_k21_dt, \n        dsA1_k10_dt, dsA2_k10_dt\n    ])\n\ndef solve():\n    \"\"\"\n    Solves the problem of determining identifiability for different sampling designs.\n    \"\"\"\n    # Define nominal values from the problem statement\n    D = 100.0  # mg\n    V1 = 10.0  # L\n    k12 = 0.7  # h^-1\n    k21 = 0.3  # h^-1\n    k10 = 0.2  # h^-1\n    params = (k12, k21, k10)\n\n    # Define the sampling schedules for the test suite\n    test_cases = {\n        'A': [0.02, 0.05, 0.1, 0.2, 0.5, 1.0, 2.0, 4.0, 8.0, 12.0],\n        'B': [0.5, 2.0, 8.0, 12.0],\n        'C': [8.0, 12.0, 24.0],\n        'D': [2.0, 12.0]\n    }\n\n    # Collect all unique time points for a single, efficient ODE solve\n    all_times = sorted(list(set(t for case_times in test_cases.values() for t in case_times)))\n\n    # Initial conditions for the augmented system\n    # Y(0) = [A1, A2, sA1_k12, sA2_k12, sA1_k21, sA2_k21, sA1_k10, sA2_k10]\n    y0 = np.array([D, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0])\n\n    # Time span for integration\n    t_span = [0.0, max(all_times)]\n\n    # Solve the augmented ODE system\n    # LSODA is a robust choice suitable for potentially stiff systems.\n    sol = solve_ivp(\n        model_and_sensitivities_ode,\n        t_span,\n        y0,\n        args=params,\n        t_eval=all_times,\n        method='LSODA',\n        rtol=1e-6,\n        atol=1e-8\n    )\n\n    # Create a mapping from time to solution index for easy lookup\n    time_to_idx = {t: i for i, t in enumerate(all_times)}\n    \n    ranks = []\n    # Loop through the ordered cases A, B, C, D\n    for case_key in sorted(test_cases.keys()):\n        case_times = test_cases[case_key]\n        \n        # Get indices for the current case's time points\n        indices = [time_to_idx[t] for t in case_times]\n        \n        # Extract sensitivities for the central compartment (A1) at required times\n        # The solution `sol.y` has shape (8, num_all_times)\n        sA1_k12 = sol.y[2, indices]\n        sA1_k21 = sol.y[4, indices]\n        sA1_k10 = sol.y[6, indices]\n\n        # Construct the sensitivity matrix S for the observable C(t) = A1(t)/V1\n        # S_ij = dC(t_i)/d_theta_j = (1/V1) * sA1_theta_j(t_i)\n        S = np.column_stack([\n            sA1_k12,\n            sA1_k21,\n            sA1_k10\n        ]) / V1\n\n        # Calculate and store the rank of the sensitivity matrix\n        rank = np.linalg.matrix_rank(S)\n        ranks.append(rank)\n\n    # Format the final output as specified\n    print(f\"[{','.join(map(str, ranks))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        },
        {
            "introduction": "在临床实践中，个体对药物的反应是动态的，并且总是伴随着各种不确定性，包括模型误差和测量噪声。本练习介绍卡尔曼滤波器，这是一种强大的算法，用于实时追踪系统的真实状态（如药物浓度）。通过将动态模型的预测与带噪声的测量数据进行最优融合，卡尔曼滤波器能够提供关于系统状态的最佳实时估计，掌握这种方法是实现个体化给药等先进应用的关键一步。",
            "id": "4336914",
            "problem": "考虑一个正在接受静脉恒速输注药物的个体，该药物的行为可以通过一个线性单室药代动力学模型很好地描述。设室浓度表示为 $C(t)$，表观分布容积为 $V$，清除率为 $\\mathrm{CL}$。在恒定输注速率 $R_{\\mathrm{in}}$ 下，一个充分混合的单室系统的质量平衡由以下常微分方程（ODE）给出：$ \\frac{dC(t)}{dt} = -k\\,C(t) + u_{0} + w(t) $，其中 $k = \\frac{\\mathrm{CL}}{V}$ 是一级消除速率常数，$u_{0} = \\frac{R_{\\mathrm{in}}}{V}$ 是恒定浓度输入速率，$w(t)$ 是一个零均值高斯白噪声过程，代表模型不确定性和生理变异性，其谱密度为 $q$，单位为 $(\\mathrm{mg}/\\mathrm{L})^{2}/\\mathrm{h}$。在离散的采样时间 $t_{k}$ 测量浓度，测量模型为 $ y_{k} = C(t_{k}) + v_{k} $，其中 $v_{k}$ 是独立的零均值高斯测量噪声，其方差为 $R$，单位为 $(\\mathrm{mg}/\\mathrm{L})^{2}$。假设系统是线性时不变的，且测量是瞬时的。\n\n从 ODE 质量平衡、高斯白噪声和线性瞬时测量的定义出发，推导该标量系统的连续-离散卡尔曼滤波器（KF）的时间更新和测量更新方程。您的推导必须从具有恒定输入的线性 ODE 的精确解以及线性高斯状态空间模型的性质出发，而不能直接调用已有的 KF 公式。\n\n然后，对于一个具体个体，其参数为 $ \\mathrm{CL} = 3\\,\\mathrm{L}/\\mathrm{h} $，$ V = 30\\,\\mathrm{L} $，$ R_{\\mathrm{in}} = 30\\,\\mathrm{mg}/\\mathrm{h} $，测量间隔 $ \\Delta = 0.5\\,\\mathrm{h} $，过程噪声谱密度 $ q = 0.2\\,(\\mathrm{mg}/\\mathrm{L})^{2}/\\mathrm{h} $，测量噪声方差 $ R = 0.25\\,(\\mathrm{mg}/\\mathrm{L})^{2} $，先验均值 $ m_{0} = 0\\,\\mathrm{mg}/\\mathrm{L} $，先验方差 $ P_{0} = 4\\,(\\mathrm{mg}/\\mathrm{L})^{2} $，以及在时间 $ t_{1} = \\Delta $ 的第一次浓度测量值 $ y_{1} = 3.2\\,\\mathrm{mg}/\\mathrm{L} $，计算同化 $y_{1}$ 后 $C(t)$ 的一步后验均值和方差。\n\n将您的数值答案四舍五入到四位有效数字。浓度单位为 $\\mathrm{mg}/\\mathrm{L}$，方差单位为 $(\\mathrm{mg}/\\mathrm{L})^{2}$。按顺序报告您最终的两个值：更新后的浓度估计值及其方差。",
            "solution": "用户希望我解决以下问题：\n考虑一个正在接受静脉恒速输注药物的个体，该药物的行为可以通过一个线性单室药代动力学模型很好地描述。设室浓度表示为 $C(t)$，表观分布容积为 $V$，清除率为 $\\mathrm{CL}$。在恒定输注速率 $R_{\\mathrm{in}}$ 下，一个充分混合的单室系统的质量平衡由以下常微分方程（ODE）给出：$ \\frac{dC(t)}{dt} = -k\\,C(t) + u_{0} + w(t) $，其中 $k = \\frac{\\mathrm{CL}}{V}$ 是一级消除速率常数，$u_{0} = \\frac{R_{\\mathrm{in}}}{V}$ 是恒定浓度输入速率，$w(t)$ 是一个零均值高斯白噪声过程，代表模型不确定性和生理变异性，其谱密度为 $q$，单位为 $(\\mathrm{mg}/\\mathrm{L})^{2}/\\mathrm{h}$。在离散的采样时间 $t_{k}$ 测量浓度，测量模型为 $ y_{k} = C(t_{k}) + v_{k} $，其中 $v_{k}$ 是独立的零均值高斯测量噪声，其方差为 $R$，单位为 $(\\mathrm{mg}/\\mathrm{L})^{2}$。假设系统是线性时不变的，且测量是瞬时的。\n\n从 ODE 质量平衡、高斯白噪声和线性瞬时测量的定义出发，推导该标量系统的连续-离散卡尔曼滤波器（KF）的时间更新和测量更新方程。您的推导必须从具有恒定输入的线性 ODE 的精确解以及线性高斯状态空间模型的性质出发，而不能直接调用已有的 KF 公式。\n\n然后，对于一个具体个体，其参数为 $ \\mathrm{CL} = 3\\,\\mathrm{L}/\\mathrm{h} $，$ V = 30\\,\\mathrm{L} $，$ R_{\\mathrm{in}} = 30\\,\\mathrm{mg}/\\mathrm{h} $，测量间隔 $ \\Delta = 0.5\\,\\mathrm{h} $，过程噪声谱密度 $ q = 0.2\\,(\\mathrm{mg}/\\mathrm{L})^{2}/\\mathrm{h} $，测量噪声方差 $ R = 0.25\\,(\\mathrm{mg}/\\mathrm{L})^{2} $，先验均值 $ m_{0} = 0\\,\\mathrm{mg}/\\mathrm{L} $，先验方差 $ P_{0} = 4\\,(\\mathrm{mg}/\\mathrm{L})^{2} $，以及在时间 $ t_{1} = \\Delta $ 的第一次浓度测量值 $ y_{1} = 3.2\\,\\mathrm{mg}/\\mathrm{L} $，计算同化 $y_{1}$ 后 $C(t)$ 的一步后验均值和方差。\n\n将您的数值答案四舍五入到四位有效数字。浓度单位为 $\\mathrm{mg}/\\mathrm{L}$，方差单位为 $(\\mathrm{mg}/\\mathrm{L})^{2}$。按顺序报告您最终的两个值：更新后的浓度估计值及其方差。\n\n### 第 1 步：提取已知信息\n- 连续时间状态模型（SDE）：$ \\frac{dC(t)}{dt} = -k\\,C(t) + u_{0} + w(t) $\n- 状态变量：$C(t)$，药物浓度。\n- 消除速率常数：$k = \\frac{\\mathrm{CL}}{V}$\n- 恒定输入：$u_{0} = \\frac{R_{\\mathrm{in}}}{V}$\n- 过程噪声：$w(t)$，一个零均值高斯白噪声过程，谱密度为 $q$。\n- 离散时间测量模型：$ y_{k} = C(t_{k}) + v_{k} $\n- 测量噪声：$v_k$，独立的零均值高斯噪声，方差为 $R$。\n- 用于数值计算的参数：\n    - 清除率：$\\mathrm{CL} = 3\\,\\mathrm{L}/\\mathrm{h}$\n    - 分布容积：$V = 30\\,\\mathrm{L}$\n    - 输注速率：$R_{\\mathrm{in}} = 30\\,\\mathrm{mg}/\\mathrm{h}$\n    - 测量间隔：$\\Delta = 0.5\\,\\mathrm{h}$\n    - 过程噪声谱密度：$q = 0.2\\,(\\mathrm{mg}/\\mathrm{L})^{2}/\\mathrm{h}$\n    - 测量噪声方差：$R = 0.25\\,(\\mathrm{mg}/\\mathrm{L})^{2}$\n    - 初始状态均值（$t_0=0$ 时的先验）：$m_{0} = 0\\,\\mathrm{mg}/\\mathrm{L}$\n    - 初始状态方差（$t_0=0$ 时的先验）：$P_{0} = 4\\,(\\mathrm{mg}/\\mathrm{L})^{2}$\n    - 第一次测量（在 $t_1=\\Delta$）：$y_{1} = 3.2\\,\\mathrm{mg}/\\mathrm{L}$\n\n### 第 2 步：使用提取的已知信息进行验证\n该问题描述了状态估计理论在药代动力学模型中的一个标准应用。\n- **科学依据：** 具有恒定输注的单室模型是药代动力学中一个基本且广泛使用的构造。使用随机微分方程（SDE）对不确定性和变异性进行建模，并应用卡尔曼滤波进行状态估计是系统生物医学中的既定方法。该设置在科学和数学上都是合理的。\n- **适定性：** 问题提供了一套完整的参数、初始条件和一个明确的目标。线性高斯结构确保了状态估计问题存在唯一、稳定的解。\n- **目标：** 问题以精确的数学和科学语言陈述，没有任何主观性或歧义。\n- **完整性：** 提供了所有必要的数值和模型定义。没有信息缺失。\n- **可行性：** 参数值在药理学背景下是现实的。\n\n该问题不违反任何无效性标准。它是一个有效、适定且在工程和生物医学科学中标准的题目。\n\n### 第 3 步：结论与行动\n问题是有效的。我将继续进行解答。\n\n### 第 1 部分：连续-离散卡尔曼滤波器的推导\n\n药物浓度 $C(t)$ 的连续时间动态由以下线性随机微分方程（SDE）描述：\n$$ \\frac{dC(t)}{dt} = -k\\,C(t) + u_{0} + w(t) $$\n其中 $w(t)$ 是连续时间白噪声，满足 $E[w(t)] = 0$ 和 $E[w(t)w(t')] = q \\delta(t-t')$。\n\n第一步是求解这个 SDE 在时间间隔 $[t_{k-1}, t_k]$（时长为 $\\Delta = t_k - t_{k-1}$）上的精确解。令 $x(t) = C(t)$。使用积分因子 $\\exp(kt)$ 得到形式解：\n$$ \\frac{d}{dt}(x(t)e^{kt}) = (u_0 + w(t))e^{kt} $$\n从 $t_{k-1}$ 到 $t_k$ 积分：\n$$ x(t_k)e^{kt_k} - x(t_{k-1})e^{kt_{k-1}} = \\int_{t_{k-1}}^{t_k} u_0 e^{k\\tau} d\\tau + \\int_{t_{k-1}}^{t_k} e^{k\\tau} w(\\tau) d\\tau $$\n解出 $x(t_k)$：\n$$ x(t_k) = x(t_{k-1})e^{-k(t_k - t_{k-1})} + u_0 \\int_{t_{k-1}}^{t_k} e^{-k(t_k - \\tau)} d\\tau + \\int_{t_{k-1}}^{t_k} e^{-k(t_k - \\tau)} w(\\tau) d\\tau $$\n令 $x_k \\equiv x(t_k)$。确定性积分的计算结果为：\n$$ \\int_{t_{k-1}}^{t_k} e^{-k(t_k - \\tau)} d\\tau = \\left[ \\frac{1}{k}e^{-k(t_k - \\tau)} \\right]_{\\tau=t_{k-1}}^{\\tau=t_k} = \\frac{1}{k}(1 - e^{-k\\Delta}) $$\n随机积分项代表离散时间过程噪声，我们称之为 $w_{k-1}$：\n$$ w_{k-1} = \\int_{t_{k-1}}^{t_k} e^{-k(t_k - \\tau)} w(\\tau) d\\tau $$\n由于 $w(t)$ 是一个零均值过程，所以 $w_{k-1}$ 的期望为零。$w_{k-1}$ 的方差记为 $Q_d$，为：\n$$ Q_d = E[w_{k-1}^2] = E\\left[ \\left( \\int_{t_{k-1}}^{t_k} e^{-k(t_k - \\tau)} w(\\tau) d\\tau \\right) \\left( \\int_{t_{k-1}}^{t_k} e^{-k(t_k - \\sigma)} w(\\sigma) d\\sigma \\right) \\right] $$\n$$ Q_d = \\int_{t_{k-1}}^{t_k} \\int_{t_{k-1}}^{t_k} e^{-k(t_k - \\tau)} e^{-k(t_k - \\sigma)} E[w(\\tau)w(\\sigma)] d\\tau d\\sigma $$\n使用 $E[w(\\tau)w(\\sigma)] = q \\delta(\\tau - \\sigma)$:\n$$ Q_d = q \\int_{t_{k-1}}^{t_k} e^{-2k(t_k - \\tau)} d\\tau $$\n令 $s = t_k - \\tau$，则 $ds = -d\\tau$。积分限从 $\\tau=t_{k-1} \\to s=\\Delta$ 和 $\\tau=t_k \\to s=0$ 变化。\n$$ Q_d = q \\int_{\\Delta}^{0} e^{-2ks} (-ds) = q \\int_{0}^{\\Delta} e^{-2ks} ds = q \\left[ \\frac{e^{-2ks}}{-2k} \\right]_{0}^{\\Delta} = \\frac{q}{2k}(1 - e^{-2k\\Delta}) $$\n因此，我们推导出了离散时间状态空间模型：\n- 状态方程：$x_k = F x_{k-1} + B_d u_0 + w_{k-1}$，其中 $w_{k-1} \\sim \\mathcal{N}(0, Q_d)$\n- 测量方程：$y_k = H x_k + v_k$，其中 $v_k \\sim \\mathcal{N}(0, R)$\n\n离散时间模型参数为：\n- 转移矩阵：$F = e^{-k\\Delta}$\n- 输入矩阵：$B_d = \\frac{1-e^{-k\\Delta}}{k}$\n- 过程噪声方差：$Q_d = \\frac{q}{2k}(1 - e^{-2k\\Delta})$\n- 测量矩阵：$H = 1$\n\n现在，我们从这些线性高斯模型推导卡尔曼滤波器的更新方程。设在第 $k-1$ 步（后验）的状态估计值及其方差为 $m_{k-1}$ 和 $P_{k-1}$。其分布为 $p(x_{k-1}|y_{1:k-1}) = \\mathcal{N}(x_{k-1}; m_{k-1}, P_{k-1})$。\n\n**时间更新（预测）：**\n目标是找到给定截至 $y_{k-1}$ 的测量值时 $x_k$ 的分布，即 $p(x_k|y_{1:k-1})$。这是第 $k$ 步的先验分布。\n预测均值 $m_k^-$ 是 $x_k$ 在 $y_{1:k-1}$ 条件下的期望：\n$$ m_k^- = E[x_k | y_{1:k-1}] = E[F x_{k-1} + B_d u_0 + w_{k-1} | y_{1:k-1}] $$\n$$ m_k^- = F E[x_{k-1} | y_{1:k-1}] + B_d u_0 + E[w_{k-1} | y_{1:k-1}] $$\n由于 $w_{k-1}$ 独立于过去的测量值和状态，所以 $E[w_{k-1} | y_{1:k-1}] = E[w_{k-1}] = 0$。根据定义，$E[x_{k-1} | y_{1:k-1}] = m_{k-1}$。\n$$ m_k^- = F m_{k-1} + B_d u_0 $$\n预测方差 $P_k^-$ 是 $x_k$ 在 $y_{1:k-1}$ 条件下的方差：\n$$ P_k^- = \\text{Var}(x_k | y_{1:k-1}) = E[(x_k - m_k^-)^2 | y_{1:k-1}] $$\n$$ x_k - m_k^- = (F x_{k-1} + B_d u_0 + w_{k-1}) - (F m_{k-1} + B_d u_0) = F(x_{k-1} - m_{k-1}) + w_{k-1} $$\n$$ P_k^- = E[(F(x_{k-1} - m_{k-1}) + w_{k-1})^2 | y_{1:k-1}] $$\n$$ P_k^- = E[F^2(x_{k-1} - m_{k-1})^2 + 2F(x_{k-1} - m_{k-1})w_{k-1} + w_{k-1}^2 | y_{1:k-1}] $$\n由于独立性，交叉项为零。\n$$ P_k^- = F^2 E[(x_{k-1} - m_{k-1})^2 | y_{1:k-1}] + E[w_{k-1}^2 | y_{1:k-1}] = F^2 P_{k-1} + Q_d $$\n\n**测量更新（校正）：**\n目标是使用新的测量值 $y_k$ 来找到后验分布 $p(x_k|y_{1:k})$。根据贝叶斯法则：\n$$ p(x_k|y_{1:k}) \\propto p(y_k|x_k, y_{1:k-1}) p(x_k|y_{1:k-1}) $$\n先验是 $p(x_k|y_{1:k-1}) = \\mathcal{N}(x_k; m_k^-, P_k^-)$。似然是 $p(y_k|x_k) = \\mathcal{N}(y_k; Hx_k, R)$。后验也将是高斯分布，$p(x_k|y_{1:k}) = \\mathcal{N}(x_k; m_k, P_k)$。\n未归一化的对数后验是对数先验和对数似然之和（忽略常数）：\n$$ \\ln p(x_k|y_{1:k}) = -\\frac{1}{2} \\frac{(x_k - m_k^-)^2}{P_k^-} - \\frac{1}{2} \\frac{(y_k - Hx_k)^2}{R} + \\text{const.} $$\n为了找到后验均值和方差，我们对指数中的 $x_k$ 进行配方。$x_k$ 的二次项和一次项是：\n$$ -\\frac{1}{2} \\left[ x_k^2 \\left(\\frac{1}{P_k^-} + \\frac{H^2}{R}\\right) - 2x_k \\left(\\frac{m_k^-}{P_k^-} + \\frac{y_k H}{R}\\right) \\right] $$\n后验方差 $P_k$ 是 $x_k^2/(-2)$ 系数的倒数，所以：\n$$ \\frac{1}{P_k} = \\frac{1}{P_k^-} + \\frac{H^2}{R} = \\frac{R + P_k^- H^2}{P_k^- R} \\implies P_k = \\frac{P_k^- R}{R + P_k^- H^2} $$\n我们定义卡尔曼增益 $K_k = \\frac{P_k^- H}{H^2 P_k^- + R}$。以这种形式，$P_k = (1 - K_k H) P_k^-$。\n后验均值 $m_k$ 与一次项相关：\n$$ \\frac{m_k}{P_k} = \\frac{m_k^-}{P_k^-} + \\frac{y_k H}{R} $$\n$$ m_k = P_k \\left(\\frac{m_k^-}{P_k^-} + \\frac{y_k H}{R}\\right) = \\frac{P_k^- R}{R + P_k^- H^2} \\left(\\frac{m_k^-}{P_k^-} + \\frac{y_k H}{R}\\right) $$\n$$ m_k = \\frac{R}{R + P_k^- H^2}m_k^- + \\frac{P_k^- H}{R + P_k^- H^2} y_k $$\n$$ m_k = \\left(1 - \\frac{P_k^- H^2}{R + P_k^- H^2}\\right)m_k^- + K_k y_k = m_k^- - K_k H m_k^- + K_k y_k $$\n$$ m_k = m_k^- + K_k(y_k - H m_k^-) $$\n\n### 第 2 部分：数值计算\n要求的任务是，给定 $t_0=0$ 时的先验和测量值 $y_1$，计算在时间 $t_1 = \\Delta$ 时的后验均值 $m_1$ 和方差 $P_1$。\n\n**步骤 A：计算模型参数**\n- 消除速率常数：$k = \\frac{\\mathrm{CL}}{V} = \\frac{3\\,\\mathrm{L}/\\mathrm{h}}{30\\,\\mathrm{L}} = 0.1\\,\\mathrm{h}^{-1}$\n- 输入速率：$u_0 = \\frac{R_{\\mathrm{in}}}{V} = \\frac{30\\,\\mathrm{mg}/\\mathrm{h}}{30\\,\\mathrm{L}} = 1\\,\\mathrm{mg}/\\mathrm{L}/\\mathrm{h}$\n- 测量间隔：$\\Delta = 0.5\\,\\mathrm{h}$\n\n**步骤 B：计算离散时间参数**\n- 转移矩阵：$F = \\exp(-k\\Delta) = \\exp(-0.1 \\times 0.5) = \\exp(-0.05) \\approx 0.9512294$\n- 输入项：$B_d u_0 = \\frac{1-F}{k} u_0 = \\frac{1 - \\exp(-0.05)}{0.1} \\times 1 \\approx 0.4877057\\,\\mathrm{mg}/\\mathrm{L}$\n- 过程噪声方差：$Q_d = \\frac{q}{2k}(1 - \\exp(-2k\\Delta)) = \\frac{0.2}{2 \\times 0.1}(1 - \\exp(-0.1)) \\approx 0.0951626\\,(\\mathrm{mg}/\\mathrm{L})^2$\n- 测量矩阵：$H = 1$\n- 测量噪声方差：$R = 0.25\\,(\\mathrm{mg}/\\mathrm{L})^2$\n- $t_0$ 时的先验：$m_0 = 0\\,\\mathrm{mg}/\\mathrm{L}$，$P_0 = 4\\,(\\mathrm{mg}/\\mathrm{L})^2$\n\n**步骤 C：时间更新（对 $t_1$ 的预测）**\n- 预测 $t_1$ 时的均值：\n$$ m_1^- = F m_0 + B_d u_0 = (0.9512294 \\times 0) + 0.4877057 = 0.4877057\\,\\mathrm{mg}/\\mathrm{L} $$\n- 预测 $t_1$ 时的方差：\n$$ P_1^- = F^2 P_0 + Q_d = (\\exp(-0.05))^2 \\times 4 + (1 - \\exp(-0.1)) $$\n$$ P_1^- = \\exp(-0.1) \\times 4 + (1 - \\exp(-0.1)) \\approx 0.9048374 \\times 4 + 0.0951626 $$\n$$ P_1^- \\approx 3.6193496 + 0.0951626 = 3.7145122\\,(\\mathrm{mg}/\\mathrm{L})^2 $$\n\n**步骤 D：测量更新（在 $t_1$ 的校正）**\n- 测量值：$y_1 = 3.2\\,\\mathrm{mg}/\\mathrm{L}$\n- 计算卡尔曼增益 $K_1$：\n$$ K_1 = \\frac{P_1^- H}{H^2 P_1^- + R} = \\frac{P_1^-}{P_1^- + R} = \\frac{3.7145122}{3.7145122 + 0.25} = \\frac{3.7145122}{3.9645122} \\approx 0.9369408 $$\n- 更新均值以找到后验 $m_1$：\n$$ m_1 = m_1^- + K_1(y_1 - H m_1^-) = 0.4877057 + 0.9369408 \\times (3.2 - 1 \\times 0.4877057) $$\n$$ m_1 = 0.4877057 + 0.9369408 \\times 2.7122943 \\approx 0.4877057 + 2.5412495 = 3.0289552\\,\\mathrm{mg}/\\mathrm{L} $$\n- 更新方差以找到后验 $P_1$：\n$$ P_1 = (1 - K_1 H) P_1^- = (1 - 0.9369408 \\times 1) \\times 3.7145122 $$\n$$ P_1 = 0.0630592 \\times 3.7145122 \\approx 0.2342574\\,(\\mathrm{mg}/\\mathrm{L})^2 $$\n\n将最终结果四舍五入到四位有效数字：\n- 后验均值浓度：$m_1 \\approx 3.029\\,\\mathrm{mg}/\\mathrm{L}$\n- 后验方差：$P_1 \\approx 0.2343\\,(\\mathrm{mg}/\\mathrm{L})^2$",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 3.029  0.2343 \\end{pmatrix} } $$"
        }
    ]
}