{
    "hands_on_practices": [
        {
            "introduction": "定量系统药理学（Quantitative Systems Pharmacology, QSP）的基石在于对药物-靶点相互作用的精确数学描述。本练习将带您从最基本的质量作用定律出发，推导描述可逆结合反应的动力学方程，并最终得到经典的希尔-朗缪尔方程（Hill-Langmuir equation）。掌握这一基础推导过程，对于理解药物浓度如何转化为靶点占有率，并为后续更复杂的药效学（pharmacodynamic, PD）模型构建奠定坚实的理论基础至关重要。",
            "id": "4381694",
            "problem": "考虑受体和药物之间的单位点可逆结合反应，其化学计量关系为 $R + D \\rightleftharpoons RD$。令 $R(t)$、$D(t)$ 和 $RD(t)$ 分别表示在时间 $t$ 时游离受体、游离药物和受体-药物复合物的摩尔浓度。假设反应为基元反应，遵循质量作用定律，其结合速率常数为 $k_{\\text{on}}$，解离速率常数为 $k_{\\text{off}}$。平衡解离常数定义为 $K_D = k_{\\text{off}}/k_{\\text{on}}$。假设系统是一个封闭且混合均匀的系统，因此对于所有时间 $t$，$R(t) + RD(t) = R_{\\text{tot}}$ 和 $D(t) + RD(t) = D_{\\text{tot}}$ 均守恒，其中 $R_{\\text{tot}}$ 和 $D_{\\text{tot}}$ 是常数。\n\n仅从质量作用定律和守恒定律出发，完成以下任务：\n- 推导控制 $R(t)$、$D(t)$ 和 $RD(t)$ 变化的耦合常微分方程(ODEs)。\n- 求解平衡状态下 $RD$ 的表达式，用 $R_{\\text{tot}}$、平衡时的游离药物浓度 $D$ 和 $K_D$ 表示。清楚地说明推导过程中使用的任何假设。\n- 计算分数占有率 $f$（定义为 $f = RD/R_{\\text{tot}}$），将其表示为平衡时的游离药物浓度 $D$ 和平衡解离常数 $K_D$ 的闭式函数。\n\n将最终的分数占有率表示为一个无量纲的解析表达式。无需进行数值计算。最终答案必须是单一的闭式表达式。",
            "solution": "首先根据所需标准对问题陈述进行验证。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- **化学计量关系：** $R + D \\rightleftharpoons RD$\n- **变量：** $R(t)$ (游离受体摩尔浓度)，$D(t)$ (游离药物摩尔浓度)，$RD(t)$ (受体-药物复合物摩尔浓度)。\n- **动力学：** 遵循质量作用定律的基元反应。\n- **常数：** $k_{\\text{on}}$ (结合速率常数)，$k_{\\text{off}}$ (解离速率常数)。\n- **定义：** 平衡解离常数 $K_D = k_{\\text{off}}/k_{\\text{on}}$。\n- **系统性质：** 封闭且混合均匀的系统。\n- **守恒定律：** $R(t) + RD(t) = R_{\\text{tot}}$ 和 $D(t) + RD(t) = D_{\\text{tot}}$，其中 $R_{\\text{tot}}$ 和 $D_{\\text{tot}}$ 是常数。\n- **任务：**\n  1. 推导 $R(t)$、$D(t)$ 和 $RD(t)$ 的耦合常微分方程(ODEs)。\n  2. 求解平衡状态下 $RD$ 的表达式，用 $R_{\\text{tot}}$、平衡时的游离药物浓度 $D$ 和 $K_D$ 表示。\n  3. 计算分数占有率 $f = RD/R_{\\text{tot}}$，将其表示为 $D$ 和 $K_D$ 的闭式函数。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于质量作用定律和质量守恒原理，这些是化学和物理学的基本原理。单位点可逆结合模型是药理学和生物化学中经典受体理论的基石。\n- **良态问题：** 这是一个良态问题。它提供了所有必要的信息（化学计量关系、动力学定律、守恒原理和定义）来唯一地推导出所要求的表达式。\n- **客观性：** 该问题以精确、客观和定量的语言陈述，没有任何主观或基于观点的断言。\n- **其他缺陷：** 该问题是完整的、一致的、现实的（作为一个标准模型）、可形式化的且并非微不足道的。它展示了定量系统药理学中的一个标准基础推导。\n\n**步骤 3：结论与行动**\n该问题是**有效的**。现在开始求解过程。\n\n### 求解推导\n\n按照问题陈述的要求，分析过程分为三个部分。\n\n**1. 耦合 ODEs 的推导**\n\n可逆反应的化学计量关系为 $R + D \\rightleftharpoons RD$。正向反应（结合）是 $R+D \\rightarrow RD$，逆向反应（解离）是 $RD \\rightarrow R+D$。\n\n根据基元反应的质量作用定律，正向反应速率 $v_f$ 与反应物浓度的乘积成正比：\n$$v_f = k_{\\text{on}} R(t) D(t)$$\n逆向反应速率 $v_r$ 与其反应物浓度成正比：\n$$v_r = k_{\\text{off}} RD(t)$$\n\n每个物种的净变化速率是生成它的反应速率之和减去消耗它的反应速率之和。\n\n对于受体-药物复合物 $RD(t)$，它由正向反应生成，由逆向反应消耗。因此，其变化速率为：\n$$\\frac{d(RD)}{dt} = v_f - v_r = k_{\\text{on}} R(t) D(t) - k_{\\text{off}} RD(t)$$\n\n对于游离受体 $R(t)$，它由正向反应消耗，由逆向反应生成。其变化速率为：\n$$\\frac{dR}{dt} = v_r - v_f = k_{\\text{off}} RD(t) - k_{\\text{on}} R(t) D(t)$$\n\n同样，对于游离药物 $D(t)$，它也由正向反应消耗，由逆向反应生成。其变化速率为：\n$$\\frac{dD}{dt} = v_r - v_f = k_{\\text{off}} RD(t) - k_{\\text{on}} R(t) D(t)$$\n\n这三个 ODEs 描述了系统的动力学。请注意，$\\frac{d(RD)}{dt} = -\\frac{dR}{dt} = -\\frac{dD}{dt}$，这与反应的化学计量关系和给定的守恒定律是一致的。将 $R(t) + RD(t) = R_{\\text{tot}}$ 对时间 $t$ 求导，得到 $\\frac{dR}{dt} + \\frac{d(RD)}{dt} = 0$，我们推导出的 ODEs 满足此式。\n\n**2. 平衡解的确定**\n\n在化学平衡状态下，所有浓度的净变化速率均为零。我们用 $R$、$D$ 和 $RD$ 分别表示游离受体、游离药物和复合物的平衡浓度，省去对时间的显式依赖。问题陈述本身使用 $D$ 来表示平衡时的游离药物浓度。\n\n将时间导数设为零：\n$$\\frac{d(RD)}{dt} = 0$$\n这意味着：\n$$k_{\\text{on}} R D - k_{\\text{off}} RD = 0$$\n整理这些项，我们得到平衡时结合与解离之间的平衡关系：\n$$k_{\\text{on}} R D = k_{\\text{off}} RD$$\n\n问题将平衡解离常数定义为 $K_D = \\frac{k_{\\text{off}}}{k_{\\text{on}}}$。我们可以将平衡方程两边除以 $k_{\\text{on}}$ 来引入 $K_D$：\n$$R D = \\frac{k_{\\text{off}}}{k_{\\text{on}}} RD$$\n$$R D = K_D RD$$\n\n问题要求用总受体浓度 $R_{\\text{tot}}$、平衡时的游离药物浓度 $D$ 和 $K_D$ 来表示复合物的平衡浓度 $RD$。为实现此目的，我们使用受体的守恒定律，该定律在平衡时也成立：\n$$R + RD = R_{\\text{tot}}$$\n由此，我们用 $R_{\\text{tot}}$ 和 $RD$ 表示平衡时的游离受体浓度 $R$：\n$$R = R_{\\text{tot}} - RD$$\n\n现在，我们将 $R$ 的这个表达式代入我们的平衡条件 $R D = K_D RD$ 中：\n$$(R_{\\text{tot}} - RD) D = K_D RD$$\n一个重要的假设，正如问题框架所暗示的，是平衡时的游离药物浓度 $D$ 被视为一个已知的自变量。这在药理学实验中是一种常见情况，其中 $D$ 要么被直接测量，要么在 $D_{\\text{tot}} \\gg R_{\\text{tot}}$ 的条件下，被假定约等于总药物浓度 $D_{\\text{tot}}$。\n\n我们现在求解方程以得到 $RD$：\n$$R_{\\text{tot}} D - RD \\cdot D = K_D RD$$\n$$R_{\\text{tot}} D = RD \\cdot D + K_D RD$$\n在等式右侧提取公因式 $RD$：\n$$R_{\\text{tot}} D = RD (D + K_D)$$\n最后，分离出 $RD$ 得到所需的平衡解：\n$$RD = \\frac{R_{\\text{tot}} D}{D + K_D}$$\n\n**3. 分数占有率的计算**\n\n分数占有率 $f$ 定义为与药物结合的受体占总受体的比例。\n$$f = \\frac{RD}{R_{\\text{tot}}}$$\n使用上一步推导出的 $RD$ 平衡浓度表达式，我们将其代入 $f$ 的定义中：\n$$f = \\frac{1}{R_{\\text{tot}}} \\left( \\frac{R_{\\text{tot}} D}{D + K_D} \\right)$$\n分子和分母中的 $R_{\\text{tot}}$ 项相互抵消，得到分数占有率的最终表达式：\n$$f = \\frac{D}{D + K_D}$$\n这就是 Hill-Langmuir 方程。它是一个无量纲的量，因为 $D$ 和 $K_D$ 都具有浓度单位。该表达式给出了分数占有率作为游离药物浓度 $D$ 的双曲线函数。",
            "answer": "$$\n\\boxed{\\frac{D}{K_D + D}}\n$$"
        },
        {
            "introduction": "在真实的生物系统中，药物与其靶点的相互作用并非孤立发生，而是与配体的合成、清除等生理过程动态耦合。本练习将探讨一种在生物药开发中尤为重要的现象——靶点介导的药物处置（Target-Mediated Drug Disposition, TMDD）。通过构建和分析一个包含药物-配体结合及各自清除途径的系统模型，您将揭示为何治疗性抗体有时会反直觉地导致其目标配体总浓度升高，从而深刻理解QSP如何帮助我们预测和解释复杂的系统级行为。",
            "id": "1460998",
            "problem": "在一个简化的定量系统药理学（QSP）模型中，我们探讨“靶标介导的药物处置”现象，即治疗性抗体反常地增加了其靶标配体的总浓度。\n\n考虑一个可溶性配体 $L$，它以恒定的速率 $k_{syn}$ 合成，并以一级速率常数 $k_{el}$ 从血浆中清除。给予一种治疗性单克隆抗体 $A$，并使其在血浆中维持在恒定浓度 $A_0$。该抗体与配体 $L$ 结合，形成一个无活性的复合物 $C$，其结合速率常数为 $k_{on}$。该复合物可以解离回 $A$ 和 $L$，其解离速率常数为 $k_{off}$。该复合物 $C$ 也会从系统中被清除，但其一级速率常数不同，为 $k_{cplx}$。\n\n反应系统描述如下：\n1.  配体合成：$\\emptyset \\xrightarrow{k_{syn}} L$\n2.  配体清除：$L \\xrightarrow{k_{el}} \\emptyset$\n3.  复合物形成：$A + L \\xrightarrow{k_{on}} C$\n4.  复合物解离：$C \\xrightarrow{k_{off}} A + L$\n5.  复合物清除：$C \\xrightarrow{k_{cplx}} \\emptyset$\n\n假设系统达到稳态，推导比率 $R = \\frac{[L]_{total, ss}}{[L]_{ss,0}}$ 的表达式。此处，$[L]_{ss,0}$ 是在没有抗体时配体的稳态浓度，而 $[L]_{total, ss}$ 是在有抗体时配体的总稳态浓度（包括游离形式和复合物形式，即 $[L]_{ss} + [C]_{ss}$）。您的最终答案应该是一个用给定参数 $k_{el}$、$k_{on}$、$k_{off}$、$k_{cplx}$ 和 $A_0$ 表示的符号表达式。",
            "solution": "问题要求解在有抗体时总的稳态配体浓度与没有抗体时稳态配体浓度的比率。\n\n首先，我们确定在没有抗体的情况下的稳态配体浓度，记为 $[L]_{ss,0}$。在这种情况下，只发生配体的合成和清除。配体浓度 $[L]$ 的变化率由下式给出：\n$$\n\\frac{d[L]}{dt} = k_{syn} - k_{el}[L]\n$$\n在稳态时，$\\frac{d[L]}{dt} = 0$。因此：\n$$\nk_{syn} - k_{el}[L]_{ss,0} = 0\n$$\n解出 $[L]_{ss,0}$，我们得到：\n$$\n[L]_{ss,0} = \\frac{k_{syn}}{k_{el}}\n$$\n\n接下来，我们分析存在抗体时的系统。游离配体 $[L]$ 和复合物 $[C]$ 的浓度由以下基于质量作用动力学的微分方程控制。抗体浓度恒定为 $[A] = A_0$。\n$$\n\\frac{d[L]}{dt} = k_{syn} - k_{el}[L] - k_{on}[L][A] + k_{off}[C]\n$$\n$$\n\\frac{d[C]}{dt} = k_{on}[L][A] - k_{off}[C] - k_{cplx}[C]\n$$\n代入 $[A] = A_0$：\n$$\n\\frac{d[L]}{dt} = k_{syn} - k_{el}[L] - k_{on}[L]A_0 + k_{off}[C]\n$$\n$$\n\\frac{d[C]}{dt} = k_{on}[L]A_0 - (k_{off} + k_{cplx})[C]\n$$\n\n我们关心的是总配体浓度 $[L]_{total} = [L] + [C]$。让我们通过将两个微分方程相加来求出总配体浓度的变化率：\n$$\n\\frac{d[L]_{total}}{dt} = \\frac{d[L]}{dt} + \\frac{d[C]}{dt} = (k_{syn} - k_{el}[L] - k_{on}[L]A_0 + k_{off}[C]) + (k_{on}[L]A_0 - k_{off}[C] - k_{cplx}[C])\n$$\n涉及结合和解离动力学的项，$\\pm k_{on}[L]A_0$ 和 $\\pm k_{off}[C]$，相互抵消。\n$$\n\\frac{d[L]_{total}}{dt} = k_{syn} - k_{el}[L] - k_{cplx}[C]\n$$\n在稳态时，所有时间导数均为零。设 $[L]_{ss}$ 和 $[C]_{ss}$ 分别为游离配体和复合物的稳态浓度。根据稳态条件 $\\frac{d[L]_{total}}{dt} = 0$：\n$$\nk_{syn} - k_{el}[L]_{ss} - k_{cplx}[C]_{ss} = 0 \\quad (*_1)\n$$\n我们还使用复合物的稳态条件 $\\frac{d[C]}{dt} = 0$：\n$$\nk_{on}[L]_{ss}A_0 - (k_{off} + k_{cplx})[C]_{ss} = 0\n$$\n由此，我们可以用 $[L]_{ss}$ 表示 $[C]_{ss}$：\n$$\n[C]_{ss} = \\frac{k_{on}A_0}{k_{off} + k_{cplx}} [L]_{ss} \\quad (*_2)\n$$\n现在，将 $[C]_{ss}$ 的这个表达式代入方程 $(*_1)$：\n$$\nk_{syn} - k_{el}[L]_{ss} - k_{cplx} \\left( \\frac{k_{on}A_0}{k_{off} + k_{cplx}} \\right) [L]_{ss} = 0\n$$\n提出因子 $[L]_{ss}$：\n$$\nk_{syn} = [L]_{ss} \\left( k_{el} + \\frac{k_{cplx}k_{on}A_0}{k_{off} + k_{cplx}} \\right)\n$$\n解出 $[L]_{ss}$：\n$$\n[L]_{ss} = \\frac{k_{syn}}{k_{el} + \\frac{k_{cplx}k_{on}A_0}{k_{off} + k_{cplx}}}\n$$\n\n稳态时的总配体浓度为 $[L]_{total, ss} = [L]_{ss} + [C]_{ss}$。使用方程 $(*_2)$：\n$$\n[L]_{total, ss} = [L]_{ss} + \\left(\\frac{k_{on}A_0}{k_{off} + k_{cplx}}\\right)[L]_{ss} = [L]_{ss} \\left(1 + \\frac{k_{on}A_0}{k_{off} + k_{cplx}}\\right)\n$$\n代入 $[L]_{ss}$ 的表达式：\n$$\n[L]_{total, ss} = \\left( \\frac{k_{syn}}{k_{el} + \\frac{k_{cplx}k_{on}A_0}{k_{off} + k_{cplx}}} \\right) \\left( 1 + \\frac{k_{on}A_0}{k_{off} + k_{cplx}} \\right)\n$$\n让我们简化括号中的项。\n$$\n1 + \\frac{k_{on}A_0}{k_{off} + k_{cplx}} = \\frac{k_{off} + k_{cplx} + k_{on}A_0}{k_{off} + k_{cplx}}\n$$\n$$\nk_{el} + \\frac{k_{cplx}k_{on}A_0}{k_{off} + k_{cplx}} = \\frac{k_{el}(k_{off} + k_{cplx}) + k_{cplx}k_{on}A_0}{k_{off} + k_{cplx}}\n$$\n现在将这些代回到 $[L]_{total, ss}$ 的表达式中：\n$$\n[L]_{total, ss} = k_{syn} \\left( \\frac{k_{off} + k_{cplx}}{k_{el}(k_{off} + k_{cplx}) + k_{cplx}k_{on}A_0} \\right) \\left( \\frac{k_{off} + k_{cplx} + k_{on}A_0}{k_{off} + k_{cplx}} \\right)\n$$\n项 $(k_{off} + k_{cplx})$ 被消去：\n$$\n[L]_{total, ss} = k_{syn} \\frac{k_{off} + k_{cplx} + k_{on}A_0}{k_{el}(k_{off} + k_{cplx}) + k_{cplx}k_{on}A_0}\n$$\n问题要求比率 $R = \\frac{[L]_{total, ss}}{[L]_{ss,0}}$。代入 $[L]_{total, ss}$ 和 $[L]_{ss,0} = k_{syn}/k_{el}$ 的表达式：\n$$\nR = \\frac{k_{syn} \\frac{k_{off} + k_{cplx} + k_{on}A_0}{k_{el}(k_{off} + k_{cplx}) + k_{cplx}k_{on}A_0}}{\\frac{k_{syn}}{k_{el}}}\n$$\n$k_{syn}$ 项相互抵消，$k_{el}$ 移到分子上：\n$$\nR = k_{el} \\frac{k_{off} + k_{cplx} + k_{on}A_0}{k_{el}(k_{off} + k_{cplx}) + k_{cplx}k_{on}A_0}\n$$\n这就是该比率的最终表达式。",
            "answer": "$$\\boxed{k_{el} \\frac{k_{off} + k_{cplx} + k_{on}A_0}{k_{el}(k_{off} + k_{cplx}) + k_{cplx}k_{on}A_0}}$$"
        },
        {
            "introduction": "药物的临床疗效不仅取决于其与靶点的亲和力，更关键的是它能否有效穿透组织屏障，到达作用部位。本练习是一项综合性的计算任务，要求您构建一个耦合了血浆药代动力学（pharmacokinetics, PK）、组织间质扩散和靶点结合的多尺度模型，以模拟药物在肿瘤组织中的渗透过程。通过将偏微分方程（Partial Differential Equations, PDEs）转化为常微分方程组（Ordinary Differential Equations, ODEs）并进行数值求解，您将亲身体验QSP如何整合不同尺度的生物学知识，定量预测药物在空间上的分布，为优化给药方案提供关键洞见。",
            "id": "4381719",
            "problem": "要求您构建一个科学上真实的一维肿瘤渗透模型，该模型需将血浆药代动力学（PK）与组织间质扩散和可逆结合相结合，并计算渗透深度作为扩散系数 $D$、结合速率 $k_{\\text{on}}$ 和平衡解离常数 $K_D$ 的函数。任务是从菲克扩散定律和质量作用结合动力学出发，推导该模型，进行数值实现，并报告所提供测试集的渗透深度。\n\n建模假设和要求：\n- 考虑一个空间一维的肿瘤间质，占据 $x \\in [0,L]$（单位：毫米），其中 $L=5\\,\\text{mm}$。\n- 令间质中的游离药物浓度为 $C(x,t)$（单位：纳摩尔），受体结合药物浓度为 $B(x,t)$（单位：纳摩尔）。\n- 每单位间质体积的总受体浓度为 $R_{\\text{tot}}$（单位：纳摩尔），假设在空间上均匀且不随时间变化。\n- 从两个基本依据出发：\n  1. 菲克扩散定律：间质通量为 $J(x,t) = -D\\,\\partial C/\\partial x$，其中 $D$ 是扩散系数，单位为 $\\text{mm}^2/\\text{s}$。\n  2. 质量作用动力学，结合速率为 $k_{\\text{on}}$（单位：$\\text{nM}^{-1}\\,\\text{s}^{-1}$），解离速率为 $k_{\\text{off}}$（单位：$\\text{s}^{-1}$），其中 $K_D = k_{\\text{off}}/k_{\\text{on}}$（单位：纳摩尔）。结合的受体以 $k_{\\text{int}}$（单位：$\\text{s}^{-1}$）的速率被内化。\n- 通过单室血浆药代动力学模型将肿瘤边界 $x=0$ 与血浆耦合：令 $C_p(t)$（单位：纳摩尔）求解 $\\mathrm{d}C_p/\\mathrm{d}t = -k_{\\text{el}}\\,C_p(t)$，其中 $C_p(0)=C_{p,0}$，$k_{\\text{el}}$ 是消除速率，单位为 $\\text{s}^{-1}$。施加狄利克雷（Dirichlet）边界条件 $C(0,t)=\\phi\\,C_p(t)$，其中 $\\phi=1$（从血浆到间质的分配系数为1）。在 $x=L$ 处，施加零通量（诺伊曼，Neumann）边界条件 $\\partial C/\\partial x\\big|_{x=L}=0$。\n- 初始条件：对于所有 $x\\in(0,L]$，$C(x,0)=0$ 和 $B(x,0)=0$；以及 $C_p(0)=C_{p,0}$。\n- 使用线方法（Method of Lines, MOL），将空间域离散化为包含两个边界在内的 $N$ 个点的均匀网格，并将得到的偏微分方程（PDEs）转化为常微分方程（ODEs）。对内部点的二阶空间导数应用中心有限差分，在 $x=0$ 处应用由 $C_p(t)$ 驱动的狄利克雷条件，在 $x=L$ 处应用与零通量条件一致的单边有限差分。\n- 所有计算中，浓度单位使用纳摩尔，时间单位使用秒，长度单位使用毫米。\n- 在指定的最终时间 $T_{\\text{end}}$ 的渗透深度定义：令 $C_b = C(0,T_{\\text{end}})$ 为边界处的游离间质浓度。将渗透深度 $d_{\\text{pen}}$（单位：毫米）定义为满足 $C(x,T_{\\text{end}}) \\ge 0.1\\,C_b$ 的最大 $x\\in[0,L]$。如果 $C(x,T_{\\text{end}})$ 在所有 $x$ 处都高于阈值，则设 $d_{\\text{pen}}=L$。如果在第一个内部节点处立即低于阈值，则设 $d_{\\text{pen}}=0$。当阈值穿越位置落在节点之间时，使用网格点之间的线性插值来估计该位置。最终渗透深度以毫米表示。\n- 程序必须计算每个测试集参数在 $T_{\\text{end}}$ 时的 $d_{\\text{pen}}$，并将结果以逗号分隔的列表形式单行输出，并用方括号括起来。每个值必须四舍五入到三位小数，并以毫米表示。\n\n所有测试用例的固定常数：\n- $L=5\\,\\text{mm}$，$N=121$ 个空间网格点。\n- $R_{\\text{tot}}=100\\,\\text{nM}$。\n- $k_{\\text{int}}=1\\times 10^{-4}\\,\\text{s}^{-1}$。\n- $k_{\\text{el}}=1\\times 10^{-5}\\,\\text{s}^{-1}$。\n- $C_{p,0}=100\\,\\text{nM}$。\n- $\\phi=1$。\n- $T_{\\text{end}}=36{,}000\\,\\text{s}$。\n\n指定 $(D, k_{\\text{on}}, K_D)$ 的测试集，其中 $k_{\\text{off}}=k_{\\text{on}}\\,K_D$：\n1. 理想情况：$D=1\\times 10^{-3}\\,\\text{mm}^2/\\text{s}$，$k_{\\text{on}}=1\\times 10^{-4}\\,\\text{nM}^{-1}\\,\\text{s}^{-1}$，$K_D=10\\,\\text{nM}$。\n2. 强结合和较低扩散：$D=5\\times 10^{-4}\\,\\text{mm}^2/\\text{s}$，$k_{\\text{on}}=5\\times 10^{-4}\\,\\text{nM}^{-1}\\,\\text{s}^{-1}$，$K_D=1\\,\\text{nM}$。\n3. 弱结合和较高扩散：$D=2\\times 10^{-3}\\,\\text{mm}^2/\\text{s}$，$k_{\\text{on}}=1\\times 10^{-5}\\,\\text{nM}^{-1}\\,\\text{s}^{-1}$，$K_D=100\\,\\text{nM}$。\n4. 接近纯扩散的边缘情况：$D=2\\times 10^{-3}\\,\\text{mm}^2/\\text{s}$，$k_{\\text{on}}=1\\times 10^{-4}\\,\\text{nM}^{-1}\\,\\text{s}^{-1}$，$K_D=1\\times 10^{6}\\,\\text{nM}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如 $[d_1,d_2,d_3,d_4]$），其中每个 $d_i$ 是以毫米为单位的渗透深度，四舍五入到三位小数。",
            "solution": "用户要求构建并数值求解一个用于肿瘤药物渗透的一维反应扩散模型，该模型与血浆药代动力学耦合。该问题已经过验证，被认为是科学上合理、适定且完整的。\n\n### 1. 模型推导\n\n该模型描述了药物在肿瘤间质（占据域 $x \\in [0, L]$）内游离浓度 $C(x,t)$ 和受体结合浓度 $B(x,t)$ 的时空动态。\n\n**1.1. 控制偏微分方程（PDEs）**\n\n游离药物浓度 $\\partial C/\\partial t$ 的变化率由菲克扩散和可逆结合动力学控制。游离药物的质量守恒表示为：\n$$\n\\frac{\\partial C}{\\partial t} = -\\nabla \\cdot J + R_C\n$$\n其中 $J$ 是扩散通量，$R_C$ 代表由化学反应（结合和解离）引起的净变化率。\n\n- **扩散：** 根据菲克第一定律，通量与浓度梯度成正比：$J = -D \\frac{\\partial C}{\\partial x}$，其中 $D$ 是扩散系数。假设 $D$ 在空间上是常数，则通量的散度（在一维情况下）为 $\\nabla \\cdot J = \\frac{\\partial J}{\\partial x} = -D \\frac{\\partial^2 C}{\\partial x^2}$。\n\n- **反应动力学：** 结合反应为 $C + R_{\\text{free}} \\rightleftharpoons B$，其中 $R_{\\text{free}}$ 是游离受体的浓度。总受体浓度为 $R_{\\text{tot}}$，因此 $R_{\\text{free}} = R_{\\text{tot}} - B$。\n  - 结合速率（药物损失）：$k_{\\text{on}} C (R_{\\text{tot}} - B)$\n  - 解离速率（药物增加）：$k_{\\text{off}} B$\n  游离药物的净反应项为 $R_C = -k_{\\text{on}} C (R_{\\text{tot}} - B) + k_{\\text{off}} B$。\n\n结合这些项，得到第一个PDE：\n$$\n\\frac{\\partial C}{\\partial t} = D \\frac{\\partial^2 C}{\\partial x^2} - k_{\\text{on}} C(R_{\\text{tot}} - B) + k_{\\text{off}} B\n$$\n\n假定结合药物浓度 $B(x,t)$ 是不可移动的（受体固定在组织基质中），因此没有扩散项。其变化率由结合、解离以及一个速率为 $k_{\\text{int}}$ 的不可逆内化过程控制。\n$$\n\\frac{\\partial B}{\\partial t} = k_{\\text{on}} C(R_{\\text{tot}} - B) - k_{\\text{off}} B - k_{\\text{int}} B\n$$\n这可以简化为：\n$$\n\\frac{\\partial B}{\\partial t} = k_{\\text{on}} C(R_{\\text{tot}} - B) - (k_{\\text{off}} + k_{\\text{int}}) B\n$$\n\n**1.2. 边界和初始条件**\n\n- **血浆药代动力学：** 肿瘤边界 $x=0$ 处的浓度由血浆浓度 $C_p(t)$ 驱动。一个单室模型描述其衰减：\n$$\n\\frac{dC_p}{dt} = -k_{\\text{el}} C_p(t), \\quad C_p(0) = C_{p,0}\n$$\n解析解为 $C_p(t) = C_{p,0} e^{-k_{\\text{el}} t}$。\n\n- **边界条件（BCs）：**\n  - 在 $x=0$（肿瘤-血管界面）：狄利克雷条件将间质浓度与血浆浓度联系起来，$C(0,t) = \\phi C_p(t)$。此处 $\\phi=1$。\n  - 在 $x=L$（肿瘤深处）：施加零通量（诺伊曼）条件，$\\left. \\frac{\\partial C}{\\partial x} \\right|_{x=L} = 0$。\n\n- **初始条件（ICs）：**\n  - 在 $t=0$ 时，肿瘤间质中没有药物：对于 $x \\in (0,L]$，$C(x,0)=0$；对于所有 $x \\in [0,L]$，$B(x,0)=0$。\n  - 在 $t=0$ 时的边界浓度是 $C(0,0) = \\phi C_p(0) = \\phi C_{p,0}$。\n\n### 2. 数值实现：线方法（MOL）\n\n通过离散化空间域，将偏微分方程组（PDEs）转化为常微分方程组（ODEs）。\n\n**2.1. 空间离散化**\n\n将域 $[0,L]$ 划分为一个包含 $N$ 个点 $x_i = i \\cdot \\Delta x$ 的均匀网格，其中 $i=0, 1, \\dots, N-1$，网格间距为 $\\Delta x = L/(N-1)$。令 $C_i(t) = C(x_i, t)$ 和 $B_i(t) = B(x_i, t)$。\n\nODE系统的状态变量是内部节点和右边界节点的 $C$ 浓度以及所有节点的 $B$ 浓度：$\\{C_1, C_2, \\dots, C_{N-1}\\}$ 和 $\\{B_0, B_1, \\dots, B_{N-1}\\}$。浓度 $C_0(t)$ 不是一个状态变量，而是一个由边界条件决定的随时间变化的强迫函数。\n\n**2.2. 离散化方程**\n\n- **$B_i(t)$ 的ODE：** 对于每个节点 $i=0, \\dots, N-1$，局部反应动力学定义了其ODE：\n$$\n\\frac{dB_i}{dt} = k_{\\text{on}} C_i (R_{\\text{tot}} - B_i) - (k_{\\text{off}} + k_{\\text{int}}) B_i\n$$\n\n- **$C_i(t)$ 的ODE：**\n  - 对于内部节点（$i=1, \\dots, N-2$），二阶偏导数 $\\partial^2 C / \\partial x^2$ 由中心有限差分近似：\n  $$\n  \\left. \\frac{\\partial^2 C}{\\partial x^2} \\right|_{x_i} \\approx \\frac{C_{i+1} - 2C_i + C_{i-1}}{(\\Delta x)^2}\n  $$\n  $C_i$ 的ODE变为：\n  $$\n  \\frac{dC_i}{dt} = D \\frac{C_{i+1} - 2C_i + C_{i-1}}{(\\Delta x)^2} - k_{\\text{on}} C_i(R_{\\text{tot}} - B_i) + k_{\\text{off}} B_i\n  $$\n  - 对于右边界节点（$i=N-1$），零通量条件 $\\partial C/\\partial x = 0$ 通过使用一个虚点 $x_N$（使得 $C_N = C_{N-2}$）来实现。拉普拉斯算子变为：\n  $$\n  \\left. \\frac{\\partial^2 C}{\\partial x^2} \\right|_{x_{N-1}} \\approx \\frac{C_{N} - 2C_{N-1} + C_{N-2}}{(\\Delta x)^2} = \\frac{2(C_{N-2} - C_{N-1})}{(\\Delta x)^2}\n  $$\n  $C_{N-1}$ 的ODE为：\n  $$\n  \\frac{dC_{N-1}}{dt} = D \\frac{2(C_{N-2} - C_{N-1})}{(\\Delta x)^2} - k_{\\text{on}} C_{N-1}(R_{\\text{tot}} - B_{N-1}) + k_{\\text{off}} B_{N-1}\n  $$\n\n这就形成了一个包含 $2N-1$ 个耦合ODE的系统，由于反应动力学中可能存在时间尺度上的巨大差异，该系统使用隐式刚性求解器（`scipy.integrate.solve_ivp`中的`BDF`方法）从 $t=0$ 到 $t=T_{\\text{end}}$ 进行数值求解。\n\n### 3. 渗透深度计算\n\n在最终时间 $T_{\\text{end}}$，计算渗透深度 $d_{\\text{pen}}$。首先，确定边界浓度 $C_b = C(0, T_{\\text{end}})$ 和阈值浓度 $C_{\\text{thresh}} = 0.1 C_b$。\n\n分析离散浓度分布 $C_i(T_{\\text{end}})$：\n1. 如果 $C_{N-1} \\geq C_{\\text{thresh}}$，则药物已渗透整个区域，因此 $d_{\\text{pen}} = L$。\n2. 如果 $C_1 < C_{\\text{thresh}}$，则渗透极小，根据问题要求，$d_{\\text{pen}} = 0$。\n3. 否则，我们找到第一个满足 $C_i < C_{\\text{thresh}}$ 的网格索引 $i$。阈值穿越发生在 $x_{i-1}$ 和 $x_i$ 之间。使用线性插值来找到精确位置：\n$$\nd_{\\text{pen}} = x_{i-1} + (x_i - x_{i-1}) \\frac{C_{\\text{thresh}} - C_{i-1}}{C_i - C_{i-1}}\n$$\n将此过程应用于测试集中的每组参数，以生成最终结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Constructs and solves a 1D reaction-diffusion model for drug penetration in a tumor,\n    and calculates the penetration depth for several test cases.\n    \"\"\"\n    # Fixed model constants\n    L = 5.0          # mm, length of the spatial domain\n    N = 121          # number of spatial grid points\n    R_tot = 100.0    # nM, total receptor concentration\n    k_int = 1.0e-4   # s^-1, internalization rate\n    k_el = 1.0e-5    # s^-1, plasma elimination rate\n    C_p0 = 100.0     # nM, initial plasma concentration\n    phi = 1.0        # unit partition coefficient\n    T_end = 36000.0  # s, end time for the simulation\n\n    # Test suite: (D [mm^2/s], k_on [nM^-1 s^-1], K_D [nM])\n    test_cases = [\n        (1.0e-3, 1.0e-4, 10.0),   # 1. Happy path\n        (5.0e-4, 5.0e-4, 1.0),    # 2. Strong binding, lower diffusion\n        (2.0e-3, 1.0e-5, 100.0),  # 3. Weak binding, higher diffusion\n        (2.0e-3, 1.0e-4, 1.0e6),  # 4. Edge case: near pure diffusion\n    ]\n\n    def ode_system(t, y, params):\n        \"\"\"\n        Defines the system of ODEs resulting from the Method of Lines discretization.\n        The state vector y is arranged as [C_1, ..., C_{N-1}, B_0, ..., B_{N-1}].\n        \"\"\"\n        # Unpack parameters\n        D, k_on, k_off, k_int_p, k_el_p, R_tot_p, C_p0_p, phi_p, L_p, N_p = params\n        dx = L_p / (N_p - 1)\n\n        # Unpack state vector y\n        C_interior = y[0 : N_p - 1] # Concentrations C_1 to C_{N-1}\n        B_all = y[N_p - 1 :]        # Concentrations B_0 to B_{N-1}\n\n        # Boundary condition C(0,t) = phi * C_p(t)\n        C_p_t = C_p0_p * np.exp(-k_el_p * t)\n        C_0_t = phi_p * C_p_t\n        \n        # Reconstruct full concentration vector C for calculation\n        C_full = np.concatenate(([C_0_t], C_interior))\n\n        # Initialize derivative arrays\n        dCdt_interior = np.zeros(N_p - 1)\n        dBdt_all = np.zeros(N_p)\n\n        # --- Calculate d(B_i)/dt for all points i = 0 to N-1 ---\n        # dB/dt = k_on*C*(R_tot-B) - (k_off + k_int)*B\n        dBdt_all = k_on * C_full * (R_tot_p - B_all) - (k_off + k_int_p) * B_all\n\n        # --- Calculate d(C_i)/dt for points i = 1 to N-1 ---\n        # dC/dt = D * Lap(C) - k_on*C*(R_tot-B) + k_off*B\n        \n        # Laplacian term\n        laplacian = np.zeros(N_p - 1)\n        # For interior points i = 1 to N-2\n        laplacian[0:N_p-2] = (C_full[2:N_p] - 2 * C_full[1:N_p-1] + C_full[0:N_p-2]) / dx**2\n        # For right boundary i = N-1 (zero-flux)\n        laplacian[N_p-2] = 2 * (C_full[N_p-2] - C_full[N_p-1]) / dx**2\n        \n        # Reaction term (for C_1 to C_{N-1})\n        reaction = -k_on * C_full[1:] * (R_tot_p - B_all[1:]) + k_off * B_all[1:]\n        \n        dCdt_interior = D * laplacian + reaction\n\n        # Combine derivatives into a single vector\n        dydt = np.concatenate((dCdt_interior, dBdt_all))\n        return dydt\n\n    def calculate_penetration_depth(C_final, L_p, N_p):\n        \"\"\"Calculates penetration depth based on the final concentration profile.\"\"\"\n        x_grid = np.linspace(0, L_p, N_p)\n        C_b = C_final[0]\n\n        if C_b == 0:\n            return 0.0\n\n        C_thresh = 0.1 * C_b\n\n        # If concentration at the far end is above threshold, penetration is complete.\n        if C_final[-1] >= C_thresh:\n            return L_p\n\n        # If concentration at first interior node is below threshold, penetration is zero.\n        if C_final[1] < C_thresh:\n            return 0.0\n\n        # Find the first index where concentration drops below threshold\n        try:\n            fall_idx = np.where(C_final < C_thresh)[0][0]\n        except IndexError:\n            # Should be unreachable due to check on C_final[-1] but included for robustness\n            return L_p\n\n        # Linear interpolation to find the exact crossing point\n        x1, x2 = x_grid[fall_idx - 1], x_grid[fall_idx]\n        C1, C2 = C_final[fall_idx - 1], C_final[fall_idx]\n        \n        d_pen = x1 + (x2 - x1) * (C_thresh - C1) / (C2 - C1)\n        return d_pen\n\n    results = []\n    for case in test_cases:\n        D_case, k_on_case, K_D_case = case\n        k_off_case = k_on_case * K_D_case\n\n        # Pack parameters for the ODE solver\n        params = (D_case, k_on_case, k_off_case, k_int, k_el, R_tot, C_p0, phi, L, N)\n        \n        # Initial conditions: y0 = [C_1(0),...,C_{N-1}(0), B_0(0),...,B_{N-1}(0)]\n        # All are zero at t=0.\n        y0 = np.zeros(2 * N - 1)\n        \n        # Time span for the integration\n        t_span = [0, T_end]\n        \n        # Solve the ODE system. 'BDF' is suitable for potentially stiff systems.\n        sol = solve_ivp(ode_system, t_span, y0, args=(params,), method='BDF', dense_output=True)\n        \n        # Evaluate the solution at the final time\n        y_final = sol.sol(T_end)\n\n        # Reconstruct the final concentration profile C(x, T_end)\n        C_interior_final = y_final[0:N - 1]\n        C_p_final = C_p0 * np.exp(-k_el * T_end)\n        C_0_final = phi * C_p_final\n        C_final_profile = np.concatenate(([C_0_final], C_interior_final))\n        \n        # Calculate and store the penetration depth\n        d_pen = calculate_penetration_depth(C_final_profile, L, N)\n        results.append(f\"{d_pen:.3f}\")\n\n    # Print results in the required format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}