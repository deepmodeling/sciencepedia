{
    "hands_on_practices": [
        {
            "introduction": "临界状态的一个基本特征是其动态活动在时间上表现出无标度特性。这意味着神经活动的关联性会随着时间的推移以幂律形式缓慢衰减，而不是指数形式的快速衰减。这种时间上的长程关联在频域中表现为所谓的“$1/f$”噪声。本练习将引导你通过严格的数学推导，揭示自相关函数的时间衰减指数 $\\alpha_t$ 与功率谱密度的频率缩放指数 $\\beta$ 之间的基本关系，从而加深对临界动态时间特征的理解 。",
            "id": "4027960",
            "problem": "考虑一个由大型循环网络在连续相变点附近产生的平稳、零均值的标量神经活动信号 $x(t)$。设自相关函数定义为 $C(t) = \\langle x(0) x(t) \\rangle$，功率谱密度 (PSD) 通过 Wiener–Khinchin 定理定义为 $S(f) = 2 \\int_{0}^{\\infty} C(t) \\cos(2 \\pi f t) \\, dt$，其中 $f$ 是时间频率。\n\n存在两种相关的动力学机制：\n1. 在离临界机制中，相关性以有限的相关时间衰减，$C(t) \\approx A \\exp(-t/\\tau)$，其中 $\\tau  \\infty$ 且振幅 $A > 0$。\n2. 在临界状态下，相关时间发散，相关性在一个扩展的惯性范围（受微观和宏观截止点的限制）内变为无标度的，$C(t) \\approx A \\, t^{-\\alpha_{t}}$，其中 $t$ 位于区间 $[t_{0}, T]$ 内，且 $0  \\alpha_{t}  1$，$t_{0} \\ll T$，振幅 $A > 0$。\n\n严格地从上述给出的定义和傅里叶余弦变换的标准渐近性质出发，推导两种机制下 $S(f)$ 的低频形式（对于临界情况，你可以引入一个消失的指数调节子来证明极限交换的合理性）。然后，推断在临界机制中由 $S(f) \\sim f^{-\\beta}$ 定义的谱标度指数 $\\beta$，并用 $\\alpha_{t}$ 表示。\n\n你的最终答案必须是 $\\beta$ 关于 $\\alpha_{t}$ 的单一闭式解析表达式。",
            "solution": "首先验证问题陈述，以确保其具有科学依据、是良定的和客观的。\n\n### 步骤 1：提取已知条件\n-   **信号**：一个平稳、零均值的标量神经活动信号，$x(t)$。\n-   **自相关函数**：$C(t) = \\langle x(0) x(t) \\rangle$。\n-   **功率谱密度 (PSD)**：$S(f) = 2 \\int_{0}^{\\infty} C(t) \\cos(2 \\pi f t) \\, dt$，其中 $f$ 是时间频率。\n-   **离临界机制**：自相关函数的形式为 $C(t) \\approx A \\exp(-t/\\tau)$，具有有限的相关时间 $\\tau  \\infty$ 和振幅 $A > 0$。\n-   **临界机制**：自相关函数表现出幂律衰减，$C(t) \\approx A \\, t^{-\\alpha_{t}}$，其中 $t$ 位于区间 $[t_{0}, T]$ 内，且 $0  \\alpha_{t}  1$，$t_{0} \\ll T$，振幅 $A > 0$。\n-   **定义**：谱标度指数 $\\beta$ 在临界机制中由关系式 $S(f) \\sim f^{-\\beta}$ 定义。\n-   **目标**：推导两种机制下 $S(f)$ 的低频形式，并找到用 $\\alpha_{t}$ 表示 $\\beta$ 的表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n1.  **科学依据**：该问题基于临界性假说，这是计算神经科学和统计物理学中一个完善的框架。自相关函数、通过Wiener-Khinchin定理定义的功率谱密度、指数相关衰减（离临界）和幂律相关衰减（临界）的定义都是标准且正确的。\n2.  **良定性**：该问题是良定的。它提供了所有必要的定义和约束（例如，$0  \\alpha_t  1$），以推导 $\\alpha_t$ 和 $\\beta$ 之间唯一且有意义的关系。\n3.  **客观性**：该问题使用精确、正式的语言陈述，没有歧义或主观论断。\n\n### 步骤 3：结论与行动\n该问题是有效的。将提供完整的解答。\n\n### 推导\n\n分析通过计算两种指定机制下的功率谱密度 $S(f)$ 来进行。\n\n**1. 离临界机制**\n\n在此机制中，自相关函数由 $C(t) \\approx A \\exp(-t/\\tau)$ 给出。功率谱密度 $S(f)$ 是 $C(t)$ 的傅里叶余弦变换：\n$$S(f) = 2 \\int_{0}^{\\infty} A \\exp(-t/\\tau) \\cos(2 \\pi f t) \\, dt$$\n这是一个标准积分形式。识别出指数函数的傅里叶余弦变换公式 $\\int_{0}^{\\infty} \\exp(-at) \\cos(bt) \\, dt = \\frac{a}{a^2 + b^2}$，我们令 $a = 1/\\tau$ 且 $b = 2\\pi f$。\n$$S(f) = 2A \\left( \\frac{1/\\tau}{(1/\\tau)^2 + (2\\pi f)^2} \\right)$$\n$$S(f) = 2A \\left( \\frac{1/\\tau}{1/\\tau^2 + 4\\pi^2 f^2} \\right) = 2A \\frac{\\tau}{1 + (2\\pi f \\tau)^2}$$\n这种函数形式是洛伦兹函数。在低频极限下，当 $f \\to 0$ 时，分母趋近于 $1$。\n$$S(f \\to 0) \\approx 2A\\tau$$\n在低频处，谱是平坦的（白噪声），这是具有有限相关时间的系统的特征。在这种情况下，标度指数为 $\\beta=0$。\n\n**2. 临界机制**\n\n在临界状态下，自相关函数在一个扩展的时间尺度范围内由幂律近似，$C(t) \\approx A t^{-\\alpha_{t}}$。条件 $0  \\alpha_{t}  1$ 至关重要。PSD 由下式给出：\n$$S(f) \\approx 2 \\int_{0}^{\\infty} A t^{-\\alpha_{t}} \\cos(2 \\pi f t) \\, dt$$\n$S(f)$ 的低频行为由 $C(t)$ 的长时间行为决定。积分的收敛性是微妙的，因为对于 $0  \\alpha_t  1$，函数 $t^{-\\alpha_t}$ 不在 $L^1[0, \\infty)$ 中，因为 $\\int_0^\\infty t^{-\\alpha_t} dt$ 在上极限处发散。然而，傅里叶余弦变换是良定的。\n\n为了确定随频率 $f$ 的标度关系，我们进行变量替换。令 $u = 2\\pi f t$。这给出 $t = u / (2\\pi f)$ 和 $dt = du / (2\\pi f)$。将这些代入 $S(f)$ 的积分中：\n$$S(f) \\approx 2A \\int_{0}^{\\infty} \\left(\\frac{u}{2\\pi f}\\right)^{-\\alpha_{t}} \\cos(u) \\, \\frac{du}{2\\pi f}$$\n我们可以将包含 $f$ 的项提取出来：\n$$S(f) \\approx 2A (2\\pi f)^{\\alpha_{t}} \\frac{1}{2\\pi f} \\int_{0}^{\\infty} u^{-\\alpha_{t}} \\cos(u) \\, du$$\n$$S(f) \\approx \\frac{A}{\\pi} (2\\pi f)^{\\alpha_{t}-1} \\int_{0}^{\\infty} u^{-\\alpha_{t}} \\cos(u) \\, du$$\n化简与频率相关的项：\n$$S(f) \\approx \\frac{A (2\\pi)^{\\alpha_{t}-1}}{\\pi} f^{-(1-\\alpha_{t})} \\int_{0}^{\\infty} u^{-\\alpha_{t}} \\cos(u) \\, du$$\n积分 $\\int_{0}^{\\infty} u^{-\\alpha_{t}} \\cos(u) \\, du$ 是一个定积分，其值仅取决于参数 $\\alpha_{t}$。对于给定的范围 $0  \\alpha_{t}  1$，此积分收敛到一个有限的正数常量。该常量的精确值为 $\\Gamma(1-\\alpha_t) \\sin(\\pi \\alpha_t / 2)$，其中 $\\Gamma$ 是伽马函数。\n\n令 $K(\\alpha_t) = \\frac{A (2\\pi)^{\\alpha_{t}-1}}{\\pi} \\int_{0}^{\\infty} u^{-\\alpha_{t}} \\cos(u) \\, du$。由于 $K(\\alpha_t)$ 是一个关于频率 $f$ 的常数，我们得到标度关系：\n$$S(f) \\propto f^{-(1-\\alpha_{t})}$$\n问题将谱标度指数 $\\beta$ 定义为关系式 $S(f) \\sim f^{-\\beta}$。通过将此定义与我们推导的结果进行比较，我们可以直接确定 $\\beta$ 的表达式。\n$$f^{-\\beta} \\sim f^{-(1-\\alpha_{t})}$$\n因此，谱标度指数 $\\beta$ 与时间相关指数 $\\alpha_{t}$ 的关系为：\n$$\\beta = 1 - \\alpha_{t}$$\n这个结果是临界动力学的一个基本特征，即时间上指数为 $\\alpha_t$ 的幂律衰减会转化为频率上指数为 $\\beta = 1 - \\alpha_t$ 的幂律谱。条件 $0  \\alpha_t  1$ 确保了 $0  \\beta  1$，这是在许多处于或接近临界状态的复杂系统中观察到的所谓“$1/f$ 噪声”或“粉红噪声”的特征。",
            "answer": "$$\\boxed{1 - \\alpha_{t}}$$"
        },
        {
            "introduction": "统计物理学中的相变理论通常是在“热力学极限”（即系统规模无限大）的假设下建立的。然而，任何真实的或模拟的神经网络规模都是有限的。本练习旨在让你掌握一种连接理论与实践的关键工具——有限尺寸标度分析。通过这个练习，你将推导出在有限规模的系统中，像磁化率这样的关键可观测量是如何随系统大小 $N$ 变化的，这对于解释和预测在有限神经网络中观察到的临界现象至关重要 。",
            "id": "4027966",
            "problem": "考虑一个空间嵌入的、稀疏连接的神经网络，其活动传播参数 $p$ 处于连续相变点附近，其中 $p_{c}$ 表示临界值。设该网络有 $N$ 个神经元，排列成有效的 $d$ 维几何结构，其线性尺度 $L$ 满足 $L \\sim N^{1/d}$，并假设存在短程相互作用。序参量 $m$ 是处于活动状态的神经元的稳态比例。磁化率 $\\chi$ 定义为 $m$ 对微小均匀外部驱动 $h$ 的线性响应，即 $\\chi = \\left.\\frac{\\partial m}{\\partial h}\\right|_{h \\to 0}$，并且根据经验观察，在此类模型中，它在热力学极限下会根据 $\\chi \\sim |p - p_{c}|^{-\\gamma}$ 发散，而活动涨落的相关长度 $\\xi$ 则根据 $\\xi \\sim |p - p_{c}|^{-\\nu}$ 发散。\n\n仅利用这些基础知识以及当 $\\xi$ 与 $L$ 相当时由有限尺寸引起的截断效应（有限尺寸圆滑效应），推导当 $N \\to \\infty$ 且 $d$ 固定时，磁化率峰值的有限尺寸位置 $p_{\\max}$ 及其有限尺寸高度 $\\chi_{\\max}(N)$ 如何随 $N$ 标度。然后，对于一个属于二维Ising普适类（指数为 $\\gamma = \\frac{7}{4}$ 和 $\\nu = 1$）、嵌入到建模为 $d = 2$ 的皮层中的网络，当 $N = 10^{8}$ 时，计算无量纲量\n$$\nS(N) \\equiv \\frac{\\chi_{\\max}(N)}{|p_{\\max} - p_{c}|}\n$$\n在忽略非普适性乘法常数的主导幂律近似下。将最终答案表示为一个不带单位的单一数字。如果可以给出精确值，则无需四舍五入；否则，将答案四舍五入至四位有效数字。",
            "solution": "该场景描述了一个具有标准标度行为的连续相变。根据定义，在热力学极限下，磁化率的标度关系为 $\\chi \\sim |p - p_{c}|^{-\\gamma}$，相关长度的标度关系为 $\\xi \\sim |p - p_{c}|^{-\\nu}$。在一个嵌入 $d$ 维空间、包含 $N$ 个神经元的有限系统中，其线性尺寸为 $L \\sim N^{1/d}$。\n\n有限尺寸圆滑效应的发生是因为 $\\xi$ 的发散不能超过系统尺寸 $L$。当控制参数 $p$ 调整到足够接近 $p_{c}$，使得相关长度 $\\xi$ 在系统尺寸 $L$ 处饱和时，磁化率达到其峰值 $\\chi_{\\max}(N)$。峰值的条件是\n$$\n\\xi \\sim L \\quad \\Rightarrow \\quad |p_{\\max} - p_{c}| \\sim L^{-1/\\nu}.\n$$\n这给出了峰值位置偏移的标度关系，\n$$\n|p_{\\max} - p_{c}| \\sim L^{-1/\\nu}.\n$$\n代入关系式 $L \\sim N^{1/d}$，得到\n$$\n|p_{\\max} - p_{c}| \\sim N^{-1/(d \\nu)}.\n$$\n\n接下来，计算这个偏移位置处的磁化率。由于 $\\chi \\sim |p - p_{c}|^{-\\gamma}$，代入 $|p_{\\max} - p_{c}| \\sim L^{-1/\\nu}$ 可得\n$$\n\\chi_{\\max}(N) \\sim \\left(L^{-1/\\nu}\\right)^{-\\gamma} = L^{\\gamma/\\nu}.\n$$\n使用 $L \\sim N^{1/d}$，\n$$\n\\chi_{\\max}(N) \\sim N^{\\gamma/(d \\nu)}.\n$$\n\n我们需要计算的量是\n$$\nS(N) \\equiv \\frac{\\chi_{\\max}(N)}{|p_{\\max} - p_{c}|}.\n$$\n使用推导出的标度关系，\n$$\nS(N) \\sim \\frac{N^{\\gamma/(d \\nu)}}{N^{-1/(d \\nu)}} = N^{\\left(\\gamma + 1\\right)/(d \\nu)}.\n$$\n\n对于指定的普适类和几何结构，使用 $\\gamma = \\frac{7}{4}$，$\\nu = 1$ 和 $d = 2$。则\n$$\n\\frac{\\gamma + 1}{d \\nu} = \\frac{\\frac{7}{4} + 1}{2 \\cdot 1} = \\frac{\\frac{11}{4}}{2} = \\frac{11}{8}.\n$$\n因此，\n$$\nS(N) \\sim N^{11/8}.\n$$\n当 $N = 10^{8}$ 时，\n$$\nS(10^{8}) \\sim \\left(10^{8}\\right)^{11/8} = 10^{11}.\n$$\n这是在主导幂律近似（忽略了非普适性乘法常数）下的精确计算。无需四舍五入。",
            "answer": "$$\\boxed{1 \\times 10^{11}}$$"
        },
        {
            "introduction": "在实验数据中观测到幂律分布是支持临界假说的一个重要证据，但这引出了一个更深层次的问题：这种临界行为的产生机制是什么？一个关键的争论点在于，系统是通过精细调节参数（“调谐临界性”）达到临界点，还是由于系统内在的异质性（“格里菲斯相”）而自然地表现出临界样行为。本练习提供了一个计算实验，要求你设计并实施一个区分这两种情景的实证检验。通过模拟雪崩动力学并分析其统计特性的变异性，你将学习到一种前沿的研究方法，用于探索复杂系统中临界现象的起源 。",
            "id": "4027904",
            "problem": "考虑神经系统中的临界假说，其中当系统在临界点附近运行时，自发神经活动会表现出无标度雪崩。生成雪崩的一个最小数学框架是 Galton–Watson 分支过程，其中每个活跃单元（例如，神经元或局部种群）产生随机数量的后代。设每个活跃单元的预期后代数量用 $m$ 表示。在同质系统中，将 $m$ 调整到 $m=1$ 会产生临界性，而 $m1$ 是亚临界状态，$m>1$ 是超临界状态。在具有淬火无序的空间异质系统中，嵌入在整体亚临界介质中的稀有区域（$m_k>1$）可以产生一个扩展的表观类临界行为区间，称为 Griffiths 相。其特征在于非普适的幂律指数和跨子系统（例如，皮层区域或实验条件）的广泛变异性。\n\n你的任务是设计并实现一个计算实验，通过分析跨皮层区域的变异性来区分 Griffiths 相和调谐临界性。将每个皮层区域建模为由 $K$ 个微斑块组成，每个微斑块具有一个固定的（淬火的）繁殖平均值 $m_k$。雪崩在一个微斑块中开始，并作为该斑块内的 Galton–Watson 过程进行，其后代分布为平均值为 $m_k$ 的泊松分布，并受限于有限系统尺寸 $N$（即雪崩大小不能超过 $N$）。对于区域 $a$，模拟 $A$ 次雪崩并收集雪崩大小 $\\{s_i^{(a)}\\}_{i=1}^A$。对于区域水平的尾指数估计，请使用幂律尾的连续最大似然估计器：对于选定的下限截断值 $s_{\\min}$，指数 $\\tau^{(a)}$ 的估计公式如下：\n$$\n\\hat{\\tau}^{(a)} \\;=\\; 1 \\;+\\; \\frac{n_a}{\\sum_{i=1}^{n_a} \\ln\\!\\left(\\frac{s_i^{(a)}}{s_{\\min}}\\right)},\n$$\n其中求和是针对区域 $a$ 中满足 $s_i^{(a)} \\ge s_{\\min}$ 的 $n_a$ 个雪崩大小。\n\n为给定情景定义以下跨区域度量：\n- 跨区域平均尾指数 $\\overline{\\tau} = \\frac{1}{M}\\sum_{a=1}^{M} \\hat{\\tau}^{(a)}$，其中 $M$ 是区域的数量。\n- 跨区域变异性 $V_\\tau = \\sqrt{\\frac{1}{M}\\sum_{a=1}^{M} \\left(\\hat{\\tau}^{(a)} - \\overline{\\tau}\\right)^2}$。\n- 稀有区域饱和指标 $R$，定义为所有区域中达到上限 $N$（即 $s_i^{(a)} = N$）的雪崩所占的比例，该比例在所有区域上聚合计算。\n\n使用的科学依据：\n- 在同质分支中，$m=1$ 产生具有特征指数的无标度雪崩；$m1$ 产生指数截断，并且在有限 $N$ 下很少发生饱和。\n- 在由淬火无序引起的 Griffiths 相中，嵌入亚临界主体中的稀有超临界斑块（$m_k>1$）导致非普适的有效指数和跨区域变异性的增加，同时由于稀有斑块中的爆炸性增长，雪崩饱和 $N$ 的频率也增加。\n\n你的程序必须：\n1. 为每个区域实现上述模拟，其中雪崩是一个 Galton–Watson 过程，后代服从泊松($m_k$)分布，从单个微斑块中的一个活跃单元开始，当过程灭绝或累积大小达到 $N$ 时停止。\n2. 使用上述公式为每个区域估计 $\\hat{\\tau}^{(a)}$。从集合 $\\{5,2,1\\}$ 中自适应地选择 $s_{\\min}$：从 $s_{\\min}=5$ 开始，如果尾部样本量 $n_a100$，则降至 $s_{\\min}=2$，如果仍然 $n_a100$，则降至 $s_{\\min}=1$。\n3. 为该情景计算 $\\overline{\\tau}$、$V_\\tau$ 和 $R$。\n4. 使用以下决策规则对情景进行分类，该规则将经验性测试形式化：\n   - 如果 $V_\\tau > 0.08$ 且 $R > 0.02$，则输出整数 $2$ (类 Griffiths)。\n   - 否则，如果 $|\\overline{\\tau} - 1.5| \\le 0.15$、$V_\\tau \\le 0.05$ 且 $0.005 \\le R \\le 0.05$，则输出整数 $1$ (调谐临界)。\n   - 否则，输出整数 $0$ (非临界/偏离临界)。\n\n使用以下场景测试套件，每个场景提供 $(M, N\\text{-list}, K, A, \\text{异质性参数})$：\n- 场景 1 (类 Griffiths)：$M=8$，$N\\text{-list} = [220,260,300,340,380,420,460,500]$，$K=50$，$A=3000$，其中比例为 $p_{\\mathrm{rr}}=0.05$ 的稀有斑块具有 $m_k \\sim \\mathcal{N}(\\mu_{\\mathrm{super}}, \\sigma_{\\mathrm{super}})$，其中 $\\mu_{\\mathrm{super}}=1.05$，$\\sigma_{\\mathrm{super}}=0.01$，其余 $1-p_{\\mathrm{rr}}$ 的主体斑块具有 $m_k \\sim \\mathcal{N}(\\mu_{\\mathrm{sub}}, \\sigma_{\\mathrm{sub}})$，其中 $\\mu_{\\mathrm{sub}}=0.95$，$\\sigma_{\\mathrm{sub}}=0.02$。将 $m_k$ 截断到区间 $[0.2, 2.0]$。\n- 场景 2 (调谐临界)：$M=8$，$N\\text{-list} = [220,260,300,340,380,420,460,500]$，$K=50$，$A=3000$，其中所有斑块采样为 $m_k \\sim \\mathcal{N}(\\mu_{\\mathrm{crit}}, \\sigma_{\\mathrm{crit}})$，其中 $\\mu_{\\mathrm{crit}}=1.0$，$\\sigma_{\\mathrm{crit}}=0.005$，并截断到 $[0.2, 2.0]$。\n- 场景 3 (亚临界/偏离临界)：$M=8$，$N\\text{-list} = [220,260,300,340,380,420,460,500]$，$K=50$，$A=3000$，其中所有斑块采样为 $m_k \\sim \\mathcal{N}(\\mu_{\\mathrm{sub}}, \\sigma_{\\mathrm{sub}})$，其中 $\\mu_{\\mathrm{sub}}=0.90$，$\\sigma_{\\mathrm{sub}}=0.02$，并截断到 $[0.2, 2.0]$。\n\n对于每个情景，假设雪崩通过均匀选择相应区域的 $K$ 个斑块之一开始，然后完全在该斑块内演化（从而在斑块级别上遵循淬火无序）。所有随机抽样应通过固定单个全局伪随机种子来保证可复现性。\n\n你的程序应产生单行输出，其中包含一个方括号内的逗号分隔列表（例如，“[result1,result2,result3]”），每个结果是按上述顺序列出的相应情景的整数分类。不涉及任何物理单位或角度；仅按规定报告整数输出。",
            "solution": "该问题要求设计并实现一个计算实验，将神经活动模式分为三类：类 Griffiths、调谐临界和非临界/偏离临界。该分类基于使用 Galton-Watson 分支过程模型模拟跨越多个不同区域的神经雪崩，每个区域的特征在于其微斑块结构中的淬火无序。\n\n解决方案的步骤是首先构建模拟框架，然后定义用于分析的统计度量，最后实现所提供的分类规则。每一步都基于问题陈述中描述的计算神经科学和统计物理学的原理。\n\n### 1. 模型与模拟框架\n\n模拟的核心是 Galton-Watson 分支过程，这是雪崩动力学的一个标准模型。雪崩从单个活跃单元开始，并以离散的代际进行。在每一代中，每个活跃单元产生若干“后代”单元，这些后代单元成为下一代的活跃单元。当某一代产生零个后代（灭绝）时，过程终止。\n\n**单次雪崩的模拟：**\n雪崩在单个微斑块 $k$ 内进行模拟，该斑块的特征是繁殖平均值为 $m_k$。每个活跃单元的后代数量从平均值为 $m_k$ 的泊松分布中抽取。如果当前代有 $N_{\\text{active}}$ 个单元，则后代总数是 $N_{\\text{active}}$ 次从 $\\text{Poisson}(m_k)$ 分布中独立抽取的值的总和。根据泊松分布的性质，这个总和等价于从 $\\text{Poisson}(N_{\\text{active}} \\cdot m_k)$ 分布中进行单次抽取。为了提高计算效率，我们利用了这种数学等价性。\n\n模拟受到每个皮层区域特定的有限系统尺寸 $N$ 的限制。如果雪崩的累积大小（激活的总单元数）加上新生成的后代超过或等于 $N$，则认为雪崩已使系统饱和。其大小记录为 $N$，过程终止。否则，更新总大小和活跃单元计数，过程继续。雪崩的最终大小 $s$ 是其整个生命周期内激活的总单元数。\n\n**皮层区域和淬火无序的建模：**\n系统由 $M$ 个皮层区域组成。每个区域 $a$ 由 $K$ 个微斑块组成，并被分配一个特定的系统尺寸上限 $N_a$。“淬火无序”通过为 $K$ 个斑块中的每一个分配一个固定的、不随时间变化的繁殖平均值 $m_k$ 来表示。这些 $m_k$ 值在每个情景中为每个区域生成一次，并对该区域中模拟的所有 $A$ 次雪崩保持不变。\n\n对于一个区域中的 $A$ 次雪崩中的每一次，从 $K$ 个可用斑块中均匀随机选择一个斑块 $k$。然后整个雪崩根据该斑块特定的繁殖平均值 $m_k$ 所控制的分支过程动力学展开。\n\n为一个区域生成 $\\{m_k\\}_{k=1}^K$ 集合取决于具体情景：\n- **场景 1 (类 Griffiths)：** 一小部分比例为 $p_{\\mathrm{rr}}$ 的斑块被指定为“稀有区域”，具有超临界繁殖平均值，$m_k \\sim \\mathcal{N}(\\mu_{\\mathrm{super}}, \\sigma_{\\mathrm{super}})$，其中 $\\mu_{\\mathrm{super}} > 1$。大多数斑块是亚临界的，其 $m_k \\sim \\mathcal{N}(\\mu_{\\mathrm{sub}}, \\sigma_{\\mathrm{sub}})$，其中 $\\mu_{\\mathrm{sub}}  1$。这种异质性是 Griffiths 相模型的决定性特征。稀有斑块的数量确定为 $\\text{round}(p_{\\mathrm{rr}} \\cdot K)$。\n- **场景 2 和 3 (同质)：** 一个区域中的所有 $K$ 个斑块的 $m_k$ 值都从同一个正态分布中抽取：对于调谐临界情况，中心在 1 附近（$\\mu_{\\mathrm{crit}}=1.0$）；对于亚临界情况，显著小于 1（$\\mu_{\\mathrm{sub}}=0.90$）。微小的方差 $\\sigma$ 模拟了轻微的、同质的无序。\n\n在所有情况下，采样的 $m_k$ 值都被截断到指定的区间 $[0.2, 2.0]$。\n\n### 2. 统计分析与度量\n\n在为 $M$ 个区域中的每个区域模拟了 $A$ 次雪崩之后，我们分析得到的雪崩大小分布 $\\{s_i^{(a)}\\}_{i=1}^A$ 以计算三个关键度量。\n\n**尾指数估计 ($\\hat{\\tau}^{(a)}$)：**\n对于每个区域 $a$，估计其雪崩大小分布的尾指数。临界系统预期会表现出幂律分布，$P(s) \\sim s^{-\\tau}$。问题提供了在给定下限截断值 $s_{\\min}$ 的情况下，$\\tau$ 的连续最大似然估计器：\n$$ \\hat{\\tau}^{(a)} \\;=\\; 1 \\;+\\; \\frac{n_a}{\\sum_{i=1}^{n_a} \\ln\\!\\left(\\frac{s_i^{(a)}}{s_{\\min}}\\right)} $$\n此处，$n_a$ 是区域 $a$ 中大小 $s_i^{(a)} \\ge s_{\\min}$ 的雪崩数量。为确保估计的稳健性，$s_{\\min}$ 是自适应选择的。我们首先尝试 $s_{\\min}=5$。如果这为拟合提供的数据点少于 $n_a=100$ 个，我们将截断值放宽到 $s_{\\min}=2$。如果计数仍然低于 100，我们使用 $s_{\\min}=1$。此过程平衡了拟合分布尾部的需求与获得足够样本量的需求。\n\n**跨区域度量 ($\\overline{\\tau}$, $V_\\tau$, $R$):**\n将各个区域水平的估计值 $\\hat{\\tau}^{(a)}$ 在 $M$ 个区域上进行聚合，以计算两个全局度量：\n1.  平均尾指数，$\\overline{\\tau} = \\frac{1}{M}\\sum_{a=1}^{M} \\hat{\\tau}^{(a)}$。\n2.  尾指数的变异性（总体标准差），$V_\\tau = \\sqrt{\\frac{1}{M}\\sum_{a=1}^{M} \\left(\\hat{\\tau}^{(a)} - \\overline{\\tau}\\right)^2}$。\n\n第三个度量，稀有区域饱和指标 $R$，通过汇集所有区域的所有雪崩数据来计算。它被定义为达到各自区域尺寸上限 $N_a$ 的雪崩总比例：\n$$ R = \\frac{\\sum_{a=1}^{M} |\\{i \\mid s_i^{(a)} = N_a\\}|}{M \\cdot A} $$\n\n### 3. 分类逻辑\n\n这三个度量——$\\overline{\\tau}$、$V_\\tau$ 和 $R$——形成一个特征向量，捕捉了模拟系统的基本动力学。一个基于问题中提供的阈值的决策树对每个情景进行分类：\n- **类 Griffiths (输出 $2$)：** 特点是高变异性和频繁的大事件。如果 $V_\\tau > 0.08$ 且 $R > 0.02$，则识别为此类。高变异性源于不同区域中因稀有超临界斑块的随机分布而产生的多样化动力学，而高饱和率是这些斑块驱动爆炸性雪崩的直接后果。\n- **调谐临界 (输出 $1$)：** 特点是行为与临界性的理论预测一致。如果平均指数接近理论值 $1.5$（具体为 $|\\overline{\\tau} - 1.5| \\le 0.15$），变异性低（$V_\\tau \\le 0.05$），且饱和度适中（$0.005 \\le R \\le 0.05$），则识别为此类。\n- **非临界/偏离临界 (输出 $0$)：** 任何不满足上述标准的情景，这将包括产生很少大雪崩且统计数据与临界性不一致的亚临界系统。\n\n### 4. 实现策略\n\n实现是将上述原理直接转化为使用 `numpy` 库的 Python 脚本。在开始时为一个伪随机数生成器设定种子以确保可复现性。主逻辑遍历每个预定义的情景，执行以下步骤：\n1.  对于 $M$ 个区域中的每一个，根据情景参数生成并存储淬火的 $m_k$ 值集。\n2.  对于每个区域，模拟 $A$ 次雪崩，每次从随机选择的斑块开始。存储产生的雪崩大小。\n3.  计算该区域的饱和计数并估计其尾指数 $\\hat{\\tau}^{(a)}$。\n4.  处理完所有区域后，计算聚合度量 $\\overline{\\tau}$、$V_\\tau$ 和 $R$。\n5.  应用分类规则来确定该情景的整数输出。\n6.  收集所有情景的结果并以指定格式打印它们。使用 `np.nanmean` 和 `np.nanstd` 提供了对任何单个区域 $\\hat{\\tau}$ 估计中潜在失败的稳健性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# language: Python\n# version: 3.12\n# libraries:\n#   - name: numpy, version: 1.23.5\n#   - name: scipy, version: 1.11.4 (not used)\n\ndef generate_m_ks_for_area(params, K, rng):\n    \"\"\"\n    Generates the quenched list of m_k values for a single area based on scenario parameters.\n    \"\"\"\n    m_clip_min, m_clip_max = params[\"m_clip\"]\n    \n    if params[\"heterogeneous\"]:\n        p_rr = params[\"p_rr\"]\n        # Use int(x + 0.5) for standard rounding of positive numbers for reproducibility.\n        n_rare = int(p_rr * K + 0.5)\n        n_bulk = K - n_rare\n        \n        m_super_params = params[\"super\"]\n        m_sub_params = params[\"sub\"]\n        \n        m_rare = rng.normal(loc=m_super_params[\"mean\"], scale=m_super_params[\"std\"], size=n_rare)\n        m_bulk = rng.normal(loc=m_sub_params[\"mean\"], scale=m_sub_params[\"std\"], size=n_bulk)\n        \n        m_ks = np.concatenate((m_rare, m_bulk))\n    else:\n        m_dist_params = params[\"dist\"]\n        m_ks = rng.normal(loc=m_dist_params[\"mean\"], scale=m_dist_params[\"std\"], size=K)\n        \n    m_ks = np.clip(m_ks, m_clip_min, m_clip_max)\n    rng.shuffle(m_ks)\n    return m_ks\n\ndef run_avalanche(m_k, N, rng):\n    \"\"\"\n    Simulates a single Galton-Watson avalanche with a size cap N.\n    \"\"\"\n    active_units = 1\n    total_size = 1\n\n    if N == 1:\n        return 1\n\n    while active_units > 0:\n        # Sum of 'k' Poisson(lambda) variables is a Poisson(k*lambda) variable.\n        # This is a correct and efficient way to calculate total offspring.\n        num_offspring = rng.poisson(m_k * active_units)\n        \n        if total_size + num_offspring >= N:\n            return N\n        \n        total_size += num_offspring\n        active_units = num_offspring\n        \n    return total_size\n\ndef estimate_tau(avalanche_sizes):\n    \"\"\"\n    Estimates the tail exponent tau using the continuous MLE and adaptive s_min.\n    \"\"\"\n    sizes = np.asarray(avalanche_sizes)\n    s_min_choices = [5, 2, 1]\n    \n    s_min_final = -1\n    tail_sizes = np.array([])\n    \n    for s_min in s_min_choices:\n        tail = sizes[sizes >= s_min]\n        if len(tail) >= 100:\n            s_min_final = s_min\n            tail_sizes = tail\n            break\n            \n    if s_min_final == -1:\n        s_min_final = 1\n        tail_sizes = sizes[sizes >= s_min_final]\n\n    n_a = len(tail_sizes)\n    \n    if n_a == 0:\n        return np.nan\n\n    log_sum = np.sum(np.log(tail_sizes / s_min_final))\n    \n    if log_sum  1e-9: # Avoid division by zero or near-zero\n        return np.nan\n        \n    tau_hat = 1.0 + n_a / log_sum\n    return tau_hat\n\ndef classify_scenario(tau_bar, v_tau, R):\n    \"\"\"\n    Classifies the scenario based on the computed metrics.\n    \"\"\"\n    if v_tau > 0.08 and R > 0.02:\n        return 2\n    elif abs(tau_bar - 1.5) = 0.15 and v_tau = 0.05 and 0.005 = R = 0.05:\n        return 1\n    else:\n        return 0\n\ndef run_scenario(params, rng):\n    \"\"\"\n    Runs the full simulation for one scenario and returns its classification.\n    \"\"\"\n    M, N_list, K, A = params[\"M\"], params[\"N_list\"], params[\"K\"], params[\"A\"]\n    \n    all_area_taus = []\n    total_saturated_count = 0\n    \n    all_areas_m_ks = [generate_m_ks_for_area(params, K, rng) for _ in range(M)]\n    \n    for i in range(M):\n        N_area = N_list[i]\n        m_ks_area = all_areas_m_ks[i]\n        \n        area_avalanche_sizes = np.empty(A, dtype=int)\n        \n        patch_indices = rng.integers(0, K, size=A)\n        \n        for j in range(A):\n            m_k = m_ks_area[patch_indices[j]]\n            size = run_avalanche(m_k, N_area, rng)\n            area_avalanche_sizes[j] = size\n            \n        total_saturated_count += np.sum(area_avalanche_sizes == N_area)\n        \n        tau_a = estimate_tau(area_avalanche_sizes)\n        all_area_taus.append(tau_a)\n        \n    tau_bar = np.nanmean(all_area_taus)\n    v_tau = np.nanstd(all_area_taus) # Population standard deviation (ddof=0 default)\n    R = total_saturated_count / (M * A)\n    \n    if np.isnan(tau_bar) or np.isnan(v_tau):\n        return 0\n        \n    return classify_scenario(tau_bar, v_tau, R)\n\ndef solve():\n    \"\"\"\n    Main function to define scenarios, run simulations, and print results.\n    \"\"\"\n    RNG = np.random.default_rng(0)\n\n    test_cases = [\n        # Scenario 1 (Griffiths-like)\n        {\n            \"name\": \"Griffiths-like\",\n            \"M\": 8, \"N_list\": [220, 260, 300, 340, 380, 420, 460, 500],\n            \"K\": 50, \"A\": 3000,\n            \"heterogeneous\": True,\n            \"p_rr\": 0.05,\n            \"super\": {\"mean\": 1.05, \"std\": 0.01},\n            \"sub\": {\"mean\": 0.95, \"std\": 0.02},\n            \"m_clip\": [0.2, 2.0]\n        },\n        # Scenario 2 (Tuned critical)\n        {\n            \"name\": \"Tuned critical\",\n            \"M\": 8, \"N_list\": [220, 260, 300, 340, 380, 420, 460, 500],\n            \"K\": 50, \"A\": 3000,\n            \"heterogeneous\": False,\n            \"dist\": {\"mean\": 1.0, \"std\": 0.005},\n            \"m_clip\": [0.2, 2.0]\n        },\n        # Scenario 3 (Subcritical/off-critical)\n        {\n            \"name\": \"Subcritical/off-critical\",\n            \"M\": 8, \"N_list\": [220, 260, 300, 340, 380, 420, 460, 500],\n            \"K\": 50, \"A\": 3000,\n            \"heterogeneous\": False,\n            \"dist\": {\"mean\": 0.90, \"std\": 0.02},\n            \"m_clip\": [0.2, 2.0]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_scenario(case, RNG)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}