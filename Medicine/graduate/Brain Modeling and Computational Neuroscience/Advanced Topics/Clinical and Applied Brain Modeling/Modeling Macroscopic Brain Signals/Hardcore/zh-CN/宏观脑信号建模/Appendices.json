{
    "hands_on_practices": [
        {
            "introduction": "宏观脑信号（如局部场电位 $LFP$）的极性并非随意，而是直接反映了其产生源——神经元群体上同步发生的突触后活动的物理特性。该实践 () 旨在通过一个简化的锥体神经元模型，深入探讨兴奋性与抑制性突触输入在神经元不同位置（如顶端树突与胞体）如何形成特定的电流源汇偶极子，并最终决定记录电极上 $LFP$ 信号的偏转方向。掌握这一原理对于从复杂的脑电信号中正确解读潜在的神经计算过程至关重要。",
            "id": "3997806",
            "problem": "考虑一个新皮层的典型皮层，在麦克斯韦方程组的准静态近似下，该皮层被建模为一个电导率为 $\\sigma$ 的均匀、各向同性、有电阻的体导体。单个垂直朝向的皮层锥体神经元被理想化为两个膜片：一个位于位置 $\\mathbf{r}_{a} = (0,0,d)$ 的顶树突膜片和一个位于位置 $\\mathbf{r}_{s} = (0,0,0)$ 的胞体/近端基底膜片，其中 $d>0$ 表示沿皮层深度轴的顶-胞体间距。一个点状局部场电位 (LFP) 电极位于刚好在顶膜片表层的位置 $\\mathbf{r}_{e} = (0,0,d+\\epsilon)$，其中 $0  \\epsilon \\ll d$。假设细胞外电位满足线性叠加原理，并且除了跨膜电流外，介质中没有其他源。\n\n使用标准的体导体公式计算由跨膜电流产生的细胞外电位：对于一组位于位置 $\\{\\mathbf{r}_{k}\\}$、带符号强度为 $\\{I_{k}\\}$ 的局域化膜电流源/汇，在 $\\mathbf{r}$ 处的细胞外电位为\n$$\n\\phi(\\mathbf{r}) = \\frac{1}{4\\pi \\sigma} \\sum_{k} \\frac{I_{k}}{\\left\\lVert \\mathbf{r} - \\mathbf{r}_{k} \\right\\rVert}.\n$$\n采用以下符号约定：$I_{k}0$ 表示流入细胞外介质的净向外跨膜电流（源），而 $I_{k}0$ 表示从细胞外介质流入细胞的净向内跨膜电流（汇）。考虑足够快且局域化的突触电导变化，因此，就本问题而言，突触位点的主电流近似为集中在该位点，而返回电流则近似为集中在另一个膜片上，其大小相等、符号相反，从而确保了近似的局部电荷守恒。假设一个典型的成年神经元，其静息膜电位 $V_{m}$ 低于兴奋性反转电位 $E_{\\mathrm{exc}}$ 且接近抑制性反转电位 $E_{\\mathrm{inh}}$，因此兴奋性突触激活在突触位点产生向内跨膜电流（$I0$），而抑制性突触激活在突触位点产生向外跨膜电流（$I>0$）。\n\n在这些假设下，分析在表层电极处测得的 $\\phi(\\mathbf{r}_{e})$ 的极性。考虑以下四种情景，每种情景都涉及一个幅度为 $I_{0}0$ 的单个短暂突触事件：\n\n- 情景 $1$：一个位于 $\\mathbf{r}_{a}$ 的远端顶树突兴奋性突触被激活，建模为在 $\\mathbf{r}_{a}$ 处有 $I_{a} = -I_{0}$，在 $\\mathbf{r}_{s}$ 处有返回电流 $I_{s} = +I_{0}$。\n- 情景 $2$：一个位于 $\\mathbf{r}_{s}$ 的胞体周围抑制性突触被激活，建模为在 $\\mathbf{r}_{s}$ 处有 $I_{s} = +I_{0}$，在 $\\mathbf{r}_{a}$ 处有返回电流 $I_{a} = -I_{0}$。\n- 情景 $3$：一个位于 $\\mathbf{r}_{s}$ 的近端基底兴奋性突触被激活，建模为在 $\\mathbf{r}_{s}$ 处有 $I_{s} = -I_{0}$，在 $\\mathbf{r}_{a}$ 处有返回电流 $I_{a} = +I_{0}$。\n- 情景 $4$：一个位于 $\\mathbf{r}_{a}$ 的远端顶树突抑制性突触被激活，建模为在 $\\mathbf{r}_{a}$ 处有 $I_{a} = +I_{0}$，在 $\\mathbf{r}_{s}$ 处有返回电流 $I_{s} = -I_{0}$。\n\n关于在表层电极处测得的 $\\phi(\\mathbf{r}_{e})$ 的偏转符号（负向对正向），以下哪些陈述是正确的？\n\nA. 在情景 $1$ 中，$\\phi(\\mathbf{r}_{e})$ 表现出负向偏转。\n\nB. 在情景 $2$ 中，$\\phi(\\mathbf{r}_{e})$ 表现出正向偏转。\n\nC. 在情景 $3$ 中，$\\phi(\\mathbf{r}_{e})$ 表现出正向偏转。\n\nD. 在情景 $4$ 中，$\\phi(\\mathbf{r}_{e})$ 表现出负向偏转。\n\n选择所有正确的选项作答。",
            "solution": "## 问题验证\n\n### 步骤 1：提取已知条件\n\n问题陈述提供了以下信息：\n- **介质**：一个电导率为 $\\sigma$ 的均匀、各向同性、有电阻的体导体。\n- **近似**：假设使用麦克斯韦方程组的准静态近似。\n- **神经元模型**：单个垂直朝向的皮层锥体神经元被理想化为两个膜片：\n    - 顶膜片位置：$\\mathbf{r}_{a} = (0,0,d)$。\n    - 胞体膜片位置：$\\mathbf{r}_{s} = (0,0,0)$。\n    - 条件：$d  0$。\n- **电极位置**：一个点状 LFP 电极位于 $\\mathbf{r}_{e} = (0,0,d+\\epsilon)$。\n    - 条件：$0  \\epsilon \\ll d$。\n- **基本原理**：\n    - 假设细胞外电位满足线性叠加原理。\n    - 除了跨膜电流外，介质中没有其他源。\n    - 细胞外电位 $\\phi(\\mathbf{r})$ 的公式由 $\\phi(\\mathbf{r}) = \\frac{1}{4\\pi \\sigma} \\sum_{k} \\frac{I_{k}}{\\left\\lVert \\mathbf{r} - \\mathbf{r}_{k} \\right\\rVert}$ 给出。\n- **约定和假设**：\n    - 电流符号：$I_{k}0$ 表示向外电流（源），$I_{k}0$ 表示向内电流（汇）。\n    - 突触模型：突触位点处的主电流和另一个膜片处的返回电流，大小相等，符号相反。\n    - 生理状态：静息膜电位 $V_{m}$ 低于兴奋性反转电位 $E_{\\mathrm{exc}}$ 且接近抑制性反转电位 $E_{\\mathrm{inh}}$。\n    - 推论：兴奋性突触导致向内电流（$I0$），抑制性突触导致向外电流（$I>0$）。\n- **情景**：对于幅度为 $I_{0}0$ 的单个事件：\n    - **情景 1**：顶树突兴奋性突触。建模为在 $\\mathbf{r}_{a}$ 处有 $I_{a} = -I_{0}$，在 $\\mathbf{r}_{s}$ 处有 $I_{s} = +I_{0}$。\n    - **情景 2**：胞体周围抑制性突触。建模为在 $\\mathbf{r}_{s}$ 处有 $I_{s} = +I_{0}$，在 $\\mathbf{r}_{a}$ 处有 $I_{a} = -I_{0}$。\n    - **情景 3**：近端基底兴奋性突触。建模为在 $\\mathbf{r}_{s}$ 处有 $I_{s} = -I_{0}$，在 $\\mathbf{r}_{a}$ 处有 $I_{a} = +I_{0}$。\n    - **情景 4**：远端顶树突抑制性突触。建模为在 $\\mathbf{r}_{a}$ 处有 $I_{a} = +I_{0}$，在 $\\mathbf{r}_{s}$ 处有 $I_{s} = -I_{0}$。\n- **问题**：确定在每种情景下，表层电极处的电位 $\\phi(\\mathbf{r}_{e})$ 的符号（极性）。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n根据验证标准对问题进行分析：\n- **科学依据**：该问题基于用于模拟局部场电位 (LFP) 的标准体导体理论，这是计算神经科学的基石。准静态近似、电位的点源公式、神经元的偶极子模型以及关于突触电流的生理学假设都是该领域中标准且已确立的内容。\n- **良态的**：问题是良态的。它提供了一个清晰的数学公式以及计算指定点电位所需的所有必要参数和条件。条件 $0  \\epsilon \\ll d$ 是一个关键信息，它使得问题具有唯一解且在物理上有意义，代表一个非常靠近顶树突丛的测量电极。\n- **客观性**：问题以精确、客观的语言陈述，没有歧义或主观论断。各种情景都用精确的电流数学表达式来定义。\n\n该问题不存在任何无效性缺陷：\n1.  **科学上不健全**：所涉及的物理学和生理学是标准的教科书内容。\n2.  **不可形式化/不相关**：该问题是指定主题内一个直接且可形式化的模型。\n3.  **不完整/矛盾**：提供了所有必要的信息。虽然情景 1 和 2（以及情景 3 和 4）导致相同的电流分布，但这是简化模型的一个特征，并非矛盾。它突显了不同的突触事件可以产生相似的远场电位。\n4.  **不现实/不可行**：该设置是一种理想化，但在理论分析中是常见且科学上合理的。\n5.  **病态的**：每种情况下都可以确定电位的唯一符号。\n6.  **琐碎/同义反复**：该问题需要正确应用电位公式，并理解近处和远处源的相对贡献，这是一个关键概念。\n\n### 步骤 3：结论与行动\n\n问题陈述科学合理，内容自洽，且是良态的。可以进行分析。\n\n## 解题推导\n\n在电极位置 $\\mathbf{r}_{e}$ 处的细胞外电位 $\\phi$ 是由顶膜片 $\\mathbf{r}_{a}$ 处的电流源/汇 $I_{a}$ 和胞体膜片 $\\mathbf{r}_{s}$ 处的电流源/汇 $I_{s}$ 产生的电位的线性叠加。使用给定的公式：\n$$\n\\phi(\\mathbf{r}_{e}) = \\frac{1}{4\\pi \\sigma} \\left( \\frac{I_{a}}{\\left\\lVert \\mathbf{r}_{e} - \\mathbf{r}_{a} \\right\\rVert} + \\frac{I_{s}}{\\left\\lVert \\mathbf{r}_{e} - \\mathbf{r}_{s} \\right\\rVert} \\right)\n$$\n我们必须首先计算电极到两个电流膜片的距离。\n电极的位置是 $\\mathbf{r}_{e} = (0,0,d+\\epsilon)$。\n顶膜片的位置是 $\\mathbf{r}_{a} = (0,0,d)$。\n胞体膜片的位置是 $\\mathbf{r}_{s} = (0,0,0)$。\n\n到顶膜片的距离是：\n$$ \\left\\lVert \\mathbf{r}_{e} - \\mathbf{r}_{a} \\right\\rVert = \\left\\lVert (0,0,d+\\epsilon) - (0,0,d) \\right\\rVert = \\left\\lVert (0,0,\\epsilon) \\right\\rVert = \\epsilon $$\n到胞体膜片的距离是：\n$$ \\left\\lVert \\mathbf{r}_{e} - \\mathbf{r}_{s} \\right\\rVert = \\left\\lVert (0,0,d+\\epsilon) - (0,0,0) \\right\\rVert = \\left\\lVert (0,0,d+\\epsilon) \\right\\rVert = d+\\epsilon $$\n将这些距离代入电位方程，得到 $\\phi(\\mathbf{r}_{e})$ 的一般表达式：\n$$\n\\phi(\\mathbf{r}_{e}) = \\frac{1}{4\\pi \\sigma} \\left( \\frac{I_{a}}{\\epsilon} + \\frac{I_{s}}{d+\\epsilon} \\right)\n$$\n已知 $\\sigma  0$ 且 $I_{0}  0$。因此，$\\phi(\\mathbf{r}_{e})$ 的符号由括号中项的符号决定。我们现在分析每种情景。\n\n### 情景分析\n\n**情景 1：顶树突兴奋性突触**\n- 电流：$I_{a} = -I_{0}$（顶端为汇）和 $I_{s} = +I_{0}$（胞体为源）。\n- 代入一般表达式：\n$$ \\phi(\\mathbf{r}_{e}) = \\frac{1}{4\\pi \\sigma} \\left( \\frac{-I_{0}}{\\epsilon} + \\frac{I_{0}}{d+\\epsilon} \\right) = \\frac{I_{0}}{4\\pi \\sigma} \\left( \\frac{1}{d+\\epsilon} - \\frac{1}{\\epsilon} \\right) $$\n- 为了确定符号，我们比较各项的大小。因为 $d  0$ 且 $\\epsilon  0$，所以有 $d+\\epsilon  \\epsilon$。这意味着 $\\frac{1}{d+\\epsilon}  \\frac{1}{\\epsilon}$。\n- 因此，项 $\\left( \\frac{1}{d+\\epsilon} - \\frac{1}{\\epsilon} \\right)$ 是负的。\n- 由于 $I_{0}  0$ 且 $\\sigma  0$，电位 $\\phi(\\mathbf{r}_{e})$ 是**负的**。\n\n**情景 2：胞体周围抑制性突触**\n- 电流：$I_{s} = +I_{0}$（胞体为源）和 $I_{a} = -I_{0}$（顶端为汇）。\n- 此电流配置与情景 1 的配置相同。\n- 因此，计算过程完全相同：\n$$ \\phi(\\mathbf{r}_{e}) = \\frac{1}{4\\pi \\sigma} \\left( \\frac{-I_{0}}{\\epsilon} + \\frac{I_{0}}{d+\\epsilon} \\right) = \\frac{I_{0}}{4\\pi \\sigma} \\left( \\frac{1}{d+\\epsilon} - \\frac{1}{\\epsilon} \\right) $$\n- 电位 $\\phi(\\mathbf{r}_{e})$ 是**负的**。\n\n**情景 3：近端基底兴奋性突触**\n- 电流：$I_{s} = -I_{0}$（胞体为汇）和 $I_{a} = +I_{0}$（顶端为源）。\n- 代入一般表达式：\n$$ \\phi(\\mathbf{r}_{e}) = \\frac{1}{4\\pi \\sigma} \\left( \\frac{I_{0}}{\\epsilon} + \\frac{-I_{0}}{d+\\epsilon} \\right) = \\frac{I_{0}}{4\\pi \\sigma} \\left( \\frac{1}{\\epsilon} - \\frac{1}{d+\\epsilon} \\right) $$\n- 如前所述，$\\frac{1}{\\epsilon}  \\frac{1}{d+\\epsilon}$。\n- 因此，项 $\\left( \\frac{1}{\\epsilon} - \\frac{1}{d+\\epsilon} \\right)$ 是正的。\n- 由于 $I_{0}  0$ 且 $\\sigma  0$，电位 $\\phi(\\mathbf{r}_{e})$ 是**正的**。\n\n**情景 4：远端顶树突抑制性突触**\n- 电流：$I_{a} = +I_{0}$（顶端为源）和 $I_{s} = -I_{0}$（胞体为汇）。\n- 此电流配置与情景 3 的配置相同。\n- 因此，计算过程完全相同：\n$$ \\phi(\\mathbf{r}_{e}) = \\frac{1}{4\\pi \\sigma} \\left( \\frac{I_{0}}{\\epsilon} + \\frac{-I_{0}}{d+\\epsilon} \\right) = \\frac{I_{0}}{4\\pi \\sigma} \\left( \\frac{1}{\\epsilon} - \\frac{1}{d+\\epsilon} \\right) $$\n- 电位 $\\phi(\\mathbf{r}_{e})$ 是**正的**。\n\n关键的洞见在于，由于电极非常靠近顶膜片（$0  \\epsilon \\ll d$），其测量的电位主要由该膜片处的电流决定。项 $\\frac{I_{a}}{\\epsilon}$ 的绝对值远大于 $\\frac{I_{s}}{d+\\epsilon}$，因此 $\\phi(\\mathbf{r}_{e})$ 的符号与 $I_{a}$ 的符号一致。\n\n## 逐项分析\n\n**A. 在情景 $1$ 中，$\\phi(\\mathbf{r}_{e})$ 表现出负向偏转。**\n我们对情景 1 的分析表明 $\\phi(\\mathbf{r}_{e})$ 是负的。这对应于从零电位基线的负向偏转。\n**结论：正确。**\n\n**B. 在情景 $2$ 中，$\\phi(\\mathbf{r}_{e})$ 表现出正向偏转。**\n我们对情景 2 的分析表明 $\\phi(\\mathbf{r}_{e})$ 是负的。而该陈述声称是正向偏转。\n**结论：不正确。**\n\n**C. 在情景 $3$ 中，$\\phi(\\mathbf{r}_{e})$ 表现出正向偏转。**\n我们对情景 3 的分析表明 $\\phi(\\mathbf{r}_{e})$ 是正的。这对应于正向偏转。\n**结论：正确。**\n\n**D. 在情景 $4$ 中，$\\phi(\\mathbf{r}_{e})$ 表现出负向偏转。**\n我们对情景 4 的分析表明 $\\phi(\\mathbf{r}_{e})$ 是正的。而该陈述声称是负向偏转。\n**结论：不正确。**",
            "answer": "$$\\boxed{AC}$$"
        },
        {
            "introduction": "在脑电磁源定位中，将皮层活动区域简化为等效电流偶极子 (equivalent current dipole, $ECD$) 是一种基础且广泛应用的模型。然而，任何模型都是一种近似，理解其有效性边界是进行严谨科学研究的前提。通过本次编程实践 ()，你将量化计算一个有限尺寸电流源（双单极子模型）产生的精确电位与其点偶极子近似电位之间的误差，从而亲手验证偶极子近似在何种距离和角度条件下成立，以及何时会引入显著偏差。",
            "id": "3997785",
            "problem": "考虑一个标量电导率为 $\\sigma$ 的无限、均匀、各向同性的体导体，在麦克斯韦方程组的准静态近似下，其电势 $V(\\mathbf{r})$ 满足椭圆偏微分方程 $\\nabla \\cdot (\\sigma \\nabla V) = \\nabla \\cdot \\mathbf{J}_{\\mathrm{s}}$，其中 $\\mathbf{J}_{\\mathrm{s}}$ 表示外加电流密度。在此设置中，对于位于位置 $\\mathbf{r}_0$、强度为 $I$ 的点电流源，其格林函数解为 $V(\\mathbf{r}) = \\dfrac{I}{4 \\pi \\sigma} \\dfrac{1}{\\|\\mathbf{r}-\\mathbf{r}_0\\|}$，且多源情况满足叠加原理。一个典型的宏观神经源模型是一对大小相等、方向相反的电流单极子 $+I$ 和 $-I$，它们沿 $z$ 轴分布，相距为 $2a$，位置分别为 $\\mathbf{r}_{+} = (0,0,a)$ 和 $\\mathbf{r}_{-} = (0,0,-a)$。在大距离处，该模型常被近似为一个点电流偶极子，其偶极矩为 $\\mathbf{p} = I(\\mathbf{r}_{+}-\\mathbf{r}_{-}) = (0,0,2 I a)$。位于原点的点电流偶极子的电势由 $V_{\\mathrm{dip}}(\\mathbf{r}) = \\dfrac{1}{4 \\pi \\sigma} \\dfrac{\\mathbf{p} \\cdot \\mathbf{r}}{\\|\\mathbf{r}\\|^{3}}$ 给出。在观测点 $\\mathbf{r}$ 处，该有限尺寸源对的精确电势为 $V_{\\mathrm{exact}}(\\mathbf{r}) = \\dfrac{I}{4 \\pi \\sigma} \\left( \\dfrac{1}{\\|\\mathbf{r}-\\mathbf{r}_{+}\\|} - \\dfrac{1}{\\|\\mathbf{r}-\\mathbf{r}_{-}\\| \\right)$。定义一个能稳健地处理近零值的归一化绝对误差为\n$$\n\\varepsilon(\\mathbf{r}; \\sigma, I, a) = \\begin{cases}\n\\dfrac{\\left|V_{\\mathrm{exact}}(\\mathbf{r})-V_{\\mathrm{dip}}(\\mathbf{r})\\right|}{\\max\\left(\\left|V_{\\mathrm{exact}}(\\mathbf{r})\\right|,\\left|V_{\\mathrm{dip}}(\\mathbf{r})\\right|\\right)},  \\text{if } \\max\\left(\\left|V_{\\mathrm{exact}}(\\mathbf{r})\\right|,\\left|V_{\\mathrm{dip}}(\\mathbf{r})\\right|\\right)  0, \\\\\n0,  \\text{otherwise.}\n\\end{cases}\n$$\n你的任务是为一组观测点和参数值计算 $\\varepsilon$，以确定偶极子近似的有效范围。对观测点使用球坐标，其中半径为 $r$，极角 $\\theta$ 从 $z$ 轴开始测量（方位角固定为 $\\phi = 0$），因此 $\\mathbf{r} = (r \\sin \\theta, 0, r \\cos \\theta)$。体导体是无限且均匀的，两个单极子精确位于 $\\mathbf{r}_{+}=(0,0,a)$ 和 $\\mathbf{r}_{-}=(0,0,-a)$，点偶极子近似以原点为中心，其偶极矩为 $\\mathbf{p}=(0,0,2 I a)$。所有距离必须以米（meters）为单位，电导率以 $\\mathrm{S/m}$ 为单位，电流以 $\\mathrm{A}$ 为单位，电势以伏特（volts）为单位。角度必须以弧度（radians）为单位。对于每种情况，将归一化误差 $\\varepsilon$ 作为浮点数报告，并四舍五入到六位小数。\n\n基本假设和定义：\n1. 准静态体导体模型适用，其中 $\\nabla \\cdot (\\sigma \\nabla V) = \\nabla \\cdot \\mathbf{J}_{\\mathrm{s}}$ 且满足线性叠加原理。\n2. 在无限均匀介质中，单个点源在 $\\mathbf{r}_0$ 处的格林函数解为 $V(\\mathbf{r}) = \\dfrac{I}{4 \\pi \\sigma} \\dfrac{1}{\\|\\mathbf{r}-\\mathbf{r}_0\\|}$。\n3. 位于原点的偶极矩为 $\\mathbf{p}$ 的远场点偶极子电势为 $V_{\\mathrm{dip}}(\\mathbf{r}) = \\dfrac{1}{4 \\pi \\sigma} \\dfrac{\\mathbf{p} \\cdot \\mathbf{r}}{\\|\\mathbf{r}\\|^{3}}$。\n\n为以下参数集 $(\\sigma, I, a, r, \\theta)$ 的测试套件计算 $\\varepsilon$：\n- 情况 1 (正常路径，轴上远场): $(0.3, 1.0 \\times 10^{-7}, 1.0 \\times 10^{-3}, 5.0 \\times 10^{-2}, 0)$。\n- 情况 2 (边界条件，轴上近场): $(0.3, 1.0 \\times 10^{-7}, 1.0 \\times 10^{-2}, 2.0 \\times 10^{-2}, 0)$。\n- 情况 3 (中等角度，中等远场): $(0.3, 1.0 \\times 10^{-7}, 5.0 \\times 10^{-3}, 5.0 \\times 10^{-2}, \\pi/4)$。\n- 情况 4 (极远场，斜角): $(0.3, 1.0 \\times 10^{-7}, 1.0 \\times 10^{-3}, 1.0, \\pi/3)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[x_{1},x_{2},x_{3},x_{4}]$），其中每个 $x_{k}$ 是相应情况下的归一化误差 $\\varepsilon$，四舍五入到六位小数。",
            "solution": "问题陈述经评估是科学上合理、适定且客观的。它基于生物电磁学的基本原理，特别是体导电的准静态近似，这是脑电图（EEG）和脑磁图（MEG）源建模的基石。问题提供了获得唯一且可验证解所需的所有必要方程、边界条件（在无限介质中是隐含的）、参数值和定义。问题陈述中没有内部矛盾、歧义或事实不准确之处。因此，该问题是有效的，并将提供解答。\n\n目标是计算由有限尺寸电流源（一对相反的单极子）产生的电势与其点偶极子近似之间的归一化绝对误差 $\\varepsilon$。误差定义为：\n$$\n\\varepsilon(\\mathbf{r}; \\sigma, I, a) = \\begin{cases}\n\\dfrac{\\left|V_{\\mathrm{exact}}(\\mathbf{r})-V_{\\mathrm{dip}}(\\mathbf{r})\\right|}{\\max\\left(\\left|V_{\\mathrm{exact}}(\\mathbf{r})\\right|,\\left|V_{\\mathrm{dip}}(\\mathbf{r})\\right|\\right)},  \\text{if } \\max\\left(\\left|V_{\\mathrm{exact}}(\\mathbf{r})\\right|,\\left|V_{\\mathrm{dip}}(\\mathbf{r})\\right|\\right)  0, \\\\\n0,  \\text{otherwise.}\n\\end{cases}\n$$\n分析在电导率为 $\\sigma$ 的无限、均匀、各向同性的导电介质中进行。\n\n首先，我们必须用给定的观测点球坐标 $\\mathbf{r} = (r \\sin \\theta, 0, r \\cos \\theta)$ 来表示电势 $V_{\\mathrm{exact}}$ 和 $V_{\\mathrm{dip}}$，其中 $r$ 是半径，$\\theta$ 是与 $z$ 轴的极角。\n\n源位置给出为 $\\mathbf{r}_{+} = (0,0,a)$ 和 $\\mathbf{r}_{-} = (0,0,-a)$。偶极矩为 $\\mathbf{p} = (0,0,2Ia)$。\n\n我们需要计算从观测点 $\\mathbf{r}$ 到源位置 $\\mathbf{r}_{+}$ 和 $\\mathbf{r}_{-}$ 的欧几里得距离：\n$\\|\\mathbf{r}-\\mathbf{r}_{+}\\| = \\sqrt{(r \\sin \\theta - 0)^2 + (0 - 0)^2 + (r \\cos \\theta - a)^2} = \\sqrt{r^2 \\sin^2 \\theta + r^2 \\cos^2 \\theta - 2ar \\cos \\theta + a^2}$\n使用恒等式 $\\sin^2 \\theta + \\cos^2 \\theta = 1$，上式可化简为：\n$$\n\\|\\mathbf{r}-\\mathbf{r}_{+}\\| = \\sqrt{r^2 + a^2 - 2ar \\cos \\theta}\n$$\n类似地，到负单极子的距离为：\n$\\|\\mathbf{r}-\\mathbf{r}_{-}\\| = \\sqrt{(r \\sin \\theta - 0)^2 + (0 - 0)^2 + (r \\cos \\theta - (-a))^2} = \\sqrt{r^2 \\sin^2 \\theta + r^2 \\cos^2 \\theta + 2ar \\cos \\theta + a^2}$\n$$\n\\|\\mathbf{r}-\\mathbf{r}_{-}\\| = \\sqrt{r^2 + a^2 + 2ar \\cos \\theta}\n$$\n利用这些距离，精确电势 $V_{\\mathrm{exact}}$ 可以写为：\n$$\nV_{\\mathrm{exact}}(\\mathbf{r}) = \\frac{I}{4 \\pi \\sigma} \\left( \\frac{1}{\\sqrt{r^2 + a^2 - 2ar \\cos \\theta}} - \\frac{1}{\\sqrt{r^2 + a^2 + 2ar \\cos \\theta}} \\right)\n$$\n\n接下来，我们用球坐标表示点偶极子电势 $V_{\\mathrm{dip}}$。其公式为 $V_{\\mathrm{dip}}(\\mathbf{r}) = \\dfrac{1}{4 \\pi \\sigma} \\dfrac{\\mathbf{p} \\cdot \\mathbf{r}}{\\|\\mathbf{r}\\|^{3}}$。\n点积 $\\mathbf{p} \\cdot \\mathbf{r}$ 为：\n$$\n\\mathbf{p} \\cdot \\mathbf{r} = (0,0,2Ia) \\cdot (r \\sin \\theta, 0, r \\cos \\theta) = (0)(r \\sin \\theta) + (0)(0) + (2Ia)(r \\cos \\theta) = 2Ia r \\cos \\theta\n$$\n位置向量的范数就是 $\\|\\mathbf{r}\\| = r$。\n将这些代入偶极子电势公式，可得：\n$$\nV_{\\mathrm{dip}}(\\mathbf{r}) = \\frac{1}{4 \\pi \\sigma} \\frac{2Ia r \\cos \\theta}{r^3} = \\frac{I}{4 \\pi \\sigma} \\frac{2a \\cos \\theta}{r^2}\n$$\n值得注意的是，公共因子 $\\dfrac{I}{4\\pi\\sigma}$ 同时出现在 $V_{\\mathrm{exact}}$ 和 $V_{\\mathrm{dip}}$ 中。由于误差公式 $\\varepsilon$ 是这些电势的比值，该因子将被消去，这意味着误差与电导率 $\\sigma$ 和电流强度 $I$ 无关。这是符合预期的，因为误差是近似的几何属性。然而，为了完整性，计算将使用所有提供的参数进行。\n\n每个测试用例 $(\\sigma, I, a, r, \\theta)$ 的算法如下：\n1.  使用球坐标下的推导表达式，计算两个电势值 $V_{\\mathrm{exact}}$ 和 $V_{\\mathrm{dip}}$。\n    $$\n    V_{\\mathrm{exact}} = \\frac{I}{4 \\pi \\sigma} \\left( \\frac{1}{\\sqrt{r^2 + a^2 - 2ar \\cos \\theta}} - \\frac{1}{\\sqrt{r^2 + a^2 + 2ar \\cos \\theta}} \\right)\n    $$\n    $$\n    V_{\\mathrm{dip}} = \\frac{I}{4 \\pi \\sigma} \\frac{2a \\cos \\theta}{r^2}\n    $$\n2.  计算绝对值 $|V_{\\mathrm{exact}}|$ 和 $|V_{\\mathrm{dip}}|$。\n3.  找到误差公式的分母，$D = \\max(|V_{\\mathrm{exact}}|, |V_{\\mathrm{dip}}|)$。\n4.  计算分子，$N = |V_{\\mathrm{exact}} - V_{\\mathrm{dip}}|$。\n5.  如果 $D  0$，计算误差 $\\varepsilon = N/D$。\n6.  如果 $D = 0$（这意味着 $V_{\\mathrm{exact}} = 0$ 且 $V_{\\mathrm{dip}} = 0$，例如在 $\\theta=\\pi/2$ 的赤道平面上），根据定义，误差 $\\varepsilon$ 为 $0$。\n7.  每种情况的最终结果四舍五入到六位小数。\n此过程将为所提供的四个测试用例中的每一个实现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the normalized absolute error between the exact potential of a\n    monopole pair and its point dipole approximation.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (sigma, I, a, r, theta)\n    test_cases = [\n        # Case 1: (sigma, I, a, r, theta)\n        (0.3, 1.0e-7, 1.0e-3, 5.0e-2, 0.0),\n        # Case 2: (sigma, I, a, r, theta)\n        (0.3, 1.0e-7, 1.0e-2, 2.0e-2, 0.0),\n        # Case 3: (sigma, I, a, r, theta)\n        (0.3, 1.0e-7, 5.0e-3, 5.0e-2, np.pi/4),\n        # Case 4: (sigma, I, a, r, theta)\n        (0.3, 1.0e-7, 1.0e-3, 1.0, np.pi/3),\n    ]\n\n    results = []\n    for case in test_cases:\n        sigma, current_I, a, r, theta = case\n\n        # Common constant factor. Although it cancels out in the error calculation,\n        # we include it for a complete physical calculation.\n        const = current_I / (4.0 * np.pi * sigma)\n\n        # --- Calculate V_exact ---\n        # Distances to the two monopoles from the observation point\n        # d_plus = ||r - r_+|| and d_minus = ||r - r_-||\n        # Using the law of cosines, which is equivalent to the derived formula\n        # sqrt(r^2 + a^2 - 2*a*r*cos(theta))\n        d_plus_sq = r**2 + a**2 - 2.0 * a * r * np.cos(theta)\n        d_minus_sq = r**2 + a**2 + 2.0 * a * r * np.cos(theta)\n        \n        # Guard against taking the square root of a negative number due to\n        # floating point inaccuracies, though unlikely with these parameters.\n        d_plus = np.sqrt(max(0, d_plus_sq))\n        d_minus = np.sqrt(max(0, d_minus_sq))\n\n        # The potential is singular at the source locations. The problem's\n        # test cases avoid these points.\n        if d_plus == 0 or d_minus == 0:\n            # This case should not be reached with the given test data.\n            # It would imply that the observation point is at one of the poles.\n            # In a real scenario, this would result in an infinite potential.\n            # For this problem, we can skip if it occurs but it is better to be robust.\n            V_exact = np.inf \n        else:\n            V_exact = const * (1.0 / d_plus - 1.0 / d_minus)\n\n        # --- Calculate V_dipole ---\n        # The observation point is never at r=0 in the test cases.\n        if r == 0:\n            V_dipole = np.inf\n        else:\n            V_dipole = const * (2.0 * a * np.cos(theta)) / (r**2)\n            \n        # --- Calculate Normalized Error epsilon ---\n        abs_V_exact = np.abs(V_exact)\n        abs_V_dipole = np.abs(V_dipole)\n\n        denominator = max(abs_V_exact, abs_V_dipole)\n\n        if denominator > 0:\n            numerator = np.abs(V_exact - V_dipole)\n            epsilon = numerator / denominator\n        else:\n            # This handles the case where both potentials are zero, e.g., on the\n            # equatorial plane (theta = pi/2), as per the problem definition.\n            epsilon = 0.0\n\n        results.append(round(epsilon, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "求解脑电/磁信号的逆问题，即从头皮传感器数据反推大脑皮层活动源，本质上是一个病态问题 (ill-posed problem)，其解必然存在空间分辨率的限制。本次高级编程实践 () 将引导你超越简单地计算一个逆解，而是去评估其“质量”。你将推导并实现一种标准的逆解算子（Tikhonov 正则化的最小范数估计），并计算其分辨率矩阵 $R = W G$，进而量化点扩散函数 (point-spread function) 和源间泄漏 (leakage) 等关键性能指标，这些都是准确解读源定位结果的核心能力。",
            "id": "3997760",
            "problem": "您正在对通过脑电图 (EEG)、脑磁图 (MEG) 或局部场电位 (LFP) 记录的宏观脑信号进行建模。在线性正向模型中，测量的传感器信号通过一个确定性的导联场矩阵与皮层源活动相关联。逆问题的目标是根据传感器测量值估计皮层源。分辨率矩阵量化了给定的逆算子如何在皮层各位置上模糊和混合真实源，从而表征了点扩散和泄露。\n\n从基本原理开始：\n- 线性正向模型为 $y = G x + n$，其中 $y \\in \\mathbb{R}^{m}$ 是传感器测量值，$x \\in \\mathbb{R}^{n}$ 是皮层源振幅，$G \\in \\mathbb{R}^{m \\times n}$ 是导联场（或增益）矩阵，$n$ 是加性噪声。\n- 逆估计 $\\hat{x}$ 是通过最小化一个平衡数据保真度和二次源惩罚项的凸目标函数得到的：$J(x) = \\|y - G x\\|_{2}^{2} + \\lambda \\|x\\|_{2}^{2}$，其中标量正则化参数 $\\lambda  0$。\n- 定义逆算子 $W$ 为由上述最小化过程产生的线性映射 $\\hat{x} = W y$。\n- 分辨率矩阵是 $R = W G$，它在逆向过程中将真实源映射到估计源，即当 $n = 0$ 时，$\\hat{x} = R x$。\n\n您的任务：\n1. 推导并实现由最小化 $J(x)$ 所隐含的线性最小范数吉洪诺夫 (Tikhonov) 逆算子 $W$，并计算分辨率矩阵 $R = W G$。\n2. 对于 $R$ 的每一列 $j$，将其解释为在皮层位置 $j$ 处单位源的点扩散函数 (PSF)。定义并计算：\n   - 位置 $j$ 处的自增益，为 $R_{j j}$。\n   - 位置 $j$ 处的泄露分数，为 $\\displaystyle \\frac{\\sum_{i \\neq j} |R_{i j}|}{\\sum_{i} |R_{i j}|}$，约定当分母为 $0$ 时，此分数为 $0$。\n   - 一个峰值正确指示符，如果 $\\arg\\max_{i} |R_{i j}| = j$ 则为 $1$，否则为 $0$。\n3. 通过计算以下各项来聚合跨位置的度量：\n   - 平均自增益 $\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} R_{j j}$。\n   - 平均泄露分数 $\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} \\frac{\\sum_{i \\neq j} |R_{i j}|}{\\sum_{i} |R_{i j}|}$ (使用相同的 $0$ 约定)。\n   - 峰值正确分数 $\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} \\mathbf{1}\\{\\arg\\max_{i} |R_{i j}| = j\\}$，其中 $\\mathbf{1}\\{\\cdot\\}$ 是指示函数。\n4. 所有量都是无量纲的。将最终的数值输出表示为保留六位小数的浮点数。\n\n测试套件：\n使用以下导联场矩阵 $G$ (每个 $G$ 均为 $3 \\times 4$，因此有 $m = 3$ 个传感器和 $n = 4$ 个源) 和正则化参数 $\\lambda$：\n\n- 情况 A: \n  $$G_{1} = \\begin{bmatrix}\n  0.8  0.1  0.0  0.05 \\\\\n  0.0  0.9  0.1  0.0 \\\\\n  0.1  0.0  0.7  0.2\n  \\end{bmatrix}, \\quad \\lambda = 10^{-8}.$$\n- 情况 B: \n  $$G_{1} \\text{ 同上}, \\quad \\lambda = 0.5.$$\n- 情况 C:\n  $$G_{2} = \\begin{bmatrix}\n  0.6  0.58  0.0  0.1 \\\\\n  0.2  0.19  0.1  0.0 \\\\\n  0.1  0.09  0.7  0.2\n  \\end{bmatrix}, \\quad \\lambda = 10^{-3}.$$\n- 情况 D:\n  $$G_{2} \\text{ 同上}, \\quad \\lambda = 0.5.$$\n- 情况 E:\n  $$G_{3} = \\begin{bmatrix}\n  0.7  0.3  0.0  1.0 \\\\\n  0.2  0.1  0.1  0.3 \\\\\n  0.1  0.05  0.8  0.15\n  \\end{bmatrix}, \\quad \\lambda = 0.1.$$\n\n程序要求：\n- 实现推导过程，为每种情况计算 $W$ 和 $R = W G$。\n- 对每种情况，计算三个聚合度量：平均自增益、平均泄露分数和峰值正确分数。将每个度量四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例的结果本身应是一个包含三个四舍五入浮点数的列表。例如，格式必须如下：\n  $$\\texttt{[[m1,l1,p1],[m2,l2,p2],[m3,l3,p3],[m4,l4,p4],[m5,l5,p5]]}$$\n其中 $m_{k}$ 是情况 $k$ 的平均自增益，$l_{k}$ 是平均泄露分数，$p_{k}$ 是峰值正确分数。",
            "solution": "该问题要求推导和实现用于脑信号线性正向模型的吉洪诺夫（Tikhonov）正则化最小范数逆算子，计算相应的分辨率矩阵，并计算几个派生的分辨率度量。\n\n### 步骤1：问题验证\n\n**1.1. 提取已知条件**\n\n- **正向模型**：传感器测量值 `$y \\in \\mathbb{R}^{m}$`、皮层源振幅 `$x \\in \\mathbb{R}^{n}$`、导联场矩阵 `$G \\in \\mathbb{R}^{m \\times n}$` 和加性噪声 `$n$` 之间的关系由线性方程 `$y = G x + n$` 给出。\n- **目标函数**：源估计 `$\\hat{x}$` 是通过最小化目标函数 `$J(x) = \\|y - G x\\|_{2}^{2} + \\lambda \\|x\\|_{2}^{2}$` 来找到的，其中 `$\\lambda  0$` 是一个标量正则化参数。\n- **逆算子**：逆算子 `$W$` 是满足 `$\\hat{x} = W y$` 的线性映射。\n- **分辨率矩阵**：分辨率矩阵 `$R$` 定义为 `$R = W G$`。\n- **分辨率度量（针对 `$R$` 的每一列 `$j$`）**：\n    - 自增益：`$R_{j j}$`。\n    - 泄露分数：`$\\displaystyle \\frac{\\sum_{i \\neq j} |R_{i j}|}{\\sum_{i} |R_{i j}|}$`。如果分母为 `$0$`，则此分数为 `$0$`。\n    - 峰值正确指示符：如果 `$\\arg\\max_{i} |R_{i j}| = j$`，则为 `$1$`，否则为 `$0$`。\n- **聚合度量**：\n    - 平均自增益：`$\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} R_{j j}$`。\n    - 平均泄露分数：`$\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} \\frac{\\sum_{i \\neq j} |R_{i j}|}{\\sum_{i} |R_{i j}|}$`。\n    - 峰值正确分数：`$\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} \\mathbf{1}\\{\\arg\\max_{i} |R_{i j}| = j\\}$`，其中 `$\\mathbf{1}\\{\\cdot\\}$` 是指示函数。\n- **测试用例**：提供了五个导联场矩阵 `$G$`（`$m=3$`，`$n=4$`）和正则化参数 `$\\lambda$` 的组合。\n\n**1.2. 验证分析**\n\n- **科学依据**：该问题是电磁脑源成像的基石。线性正向模型、吉洪诺夫正则化（也称为最小范数估计或 MNE）以及分辨率矩阵的分析是计算神经科学和生物医学信号处理中标准的、成熟的概念。该问题在科学上是合理的。\n- **适定性**：目标函数 `$J(x)$` 是两个平方范数之和。对于 `$\\lambda  0$`，它是严格凸的，这保证了唯一最小值的存在。推导过程得出了逆算子的唯一解。因此，该问题是适定的。\n- **客观性**：所有术语都用数学精确定义。问题陈述没有歧义或主观性语言。\n- **完整性与一致性**：问题提供了计算所需度量的所有必要数据（`$G$`，`$\\lambda$`）和定义。没有矛盾之处。\n\n**1.3. 结论**\n\n该问题是有效的。它具有科学依据、适定、客观且自洽。\n\n### 步骤2：推导与求解计划\n\n**2.1. 逆算子 $W$ 的推导**\n\n目标是找到最小化目标函数 `$J(x)$` 的源向量 `$\\hat{x}$`。\n$$J(x) = \\|y - G x\\|_{2}^{2} + \\lambda \\|x\\|_{2}^{2}$$\n我们可以使用转置来重写欧几里得范数的平方：\n$$J(x) = (y - G x)^T (y - G x) + \\lambda x^T x$$\n展开第一项：\n$$J(x) = (y^T - x^T G^T) (y - G x) + \\lambda x^T x$$\n$$J(x) = y^T y - y^T G x - x^T G^T y + x^T G^T G x + \\lambda x^T x$$\n由于 `$y^T G x$` 是一个标量，它等于其转置，即 `$(y^T G x)^T = x^T G^T y$`。我们可以合并中间两项：\n$$J(x) = y^T y - 2 x^T G^T y + x^T (G^T G) x + \\lambda x^T I_n x$$\n$$J(x) = y^T y - 2 x^T G^T y + x^T (G^T G + \\lambda I_n) x$$\n其中 `$I_n$` 是 `$n \\times n$` 的单位矩阵。\n\n为了找到这个凸函数的最小值，我们计算它关于 `$x$` 的梯度并将其设为零。使用标准矩阵微积分法则（对于对称矩阵 `$A$`，`$\\nabla_v(b^T v) = b$` 和 `$\\nabla_v(v^T A v) = 2Av$`），我们得到：\n$$\\nabla_x J(x) = -2 G^T y + 2 (G^T G + \\lambda I_n) x$$\n将梯度设为零向量：\n$$0 = -2 G^T y + 2 (G^T G + \\lambda I_n) \\hat{x}$$\n$$(G^T G + \\lambda I_n) \\hat{x} = G^T y$$\n矩阵 `$G^T G$` 是半正定的。由于 `$\\lambda  0$`，矩阵 `$(G^T G + \\lambda I_n)$` 是正定的，因此是可逆的。我们可以解出最优源估计 `$\\hat{x}$`：\n$$\\hat{x} = (G^T G + \\lambda I_n)^{-1} G^T y$$\n根据定义，逆算子 `$W$` 是从 `$y$` 到 `$\\hat{x}$` 的线性映射，即 `$\\hat{x} = W y$`。通过比较 `$\\hat{x}$` 的两个表达式，我们可以确定 `$W$`：\n$$W = (G^T G + \\lambda I_n)^{-1} G^T$$\n\n**2.2. 分辨率矩阵 $R$ 的计算**\n\n分辨率矩阵 `$R$` 在没有噪声（`$n=0$`）的情况下，将真实源 `$x$` 映射到其估计值 `$\\hat{x}$`。它定义为 `$R = W G$`。代入 `$W$` 的推导表达式：\n$$R = \\left( (G^T G + \\lambda I_n)^{-1} G^T \\right) G$$\n$$R = (G^T G + \\lambda I_n)^{-1} (G^T G)$$\n这是一个 `$n \\times n$` 矩阵，描述了整个正向-逆向建模过程的模糊和串扰效应。理想的逆过程会得到 `$R = I_n$`，这意味着每个估计源都完美地恢复了相应的真实源，而没有来自其他源的泄露。\n\n**2.3. 指标计算算法**\n\n对于每个测试用例 `$(G, \\lambda)$`：\n1.  令 `$n$` 为 `$G$` 的列数（即源的数量，`$n=4$`）。\n2.  计算矩阵乘积 `$G^T G$`。\n3.  构造 `$n \\times n$` 的单位矩阵 `$I_n$`。\n4.  计算矩阵 `$M = G^T G + \\lambda I_n$`。\n5.  计算 `$M^{-1}$`。\n6.  计算分辨率矩阵 `$R = M^{-1} (G^T G)$`。\n7.  计算聚合度量：\n    a.  **平均自增益**：计算 `$R$` 对角线元素的平均值。\n        `$\\text{mean\\_sg} = \\frac{1}{n} \\text{trace}(R)$`。\n    b.  **平均泄露分数**：对于从 `$0$` 到 `$n-1$` 的每一列 `$j$`：\n        i.   计算整列绝对值之和：`$S_j = \\sum_{i=0}^{n-1} |R_{ij}|$`。\n        ii.  如果 `$S_j  0$`，列 `$j$` 的泄露分数为 `$\\ell_j = \\frac{S_j - |R_{jj}|}{S_j}$`。\n        iii. 如果 `$S_j = 0$`，`$\\ell_j = 0$`。\n        iv.  平均泄露分数为 `$\\text{mean\\_lf} = \\frac{1}{n} \\sum_{j=0}^{n-1} \\ell_j$`。\n    c.  **峰值正确分数**：对于从 `$0$` 到 `$n-1$` 的每一列 `$j$`：\n        i.   找到该列绝对值最大的行索引 `$i_{max}$`：`$i_{max} = \\arg\\max_i |R_{ij}|$`。\n        ii.  列 `$j$` 的峰值正确指示符为 `$p_j = 1$`（如果 `$i_{max} = j$`），否则为 `$p_j = 0$`。\n        iii. 峰值正确分数为 `$\\text{mean\\_pcf} = \\frac{1}{n} \\sum_{j=0}^{n-1} p_j$`。\n8.  将三个聚合度量各自四舍五入到六位小数并存储。\n\n此过程将应用于提供的五个测试用例中的每一个。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes resolution matrix metrics for several EEG/MEG inverse problem test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (np.array([\n            [0.8, 0.1, 0.0, 0.05],\n            [0.0, 0.9, 0.1, 0.0],\n            [0.1, 0.0, 0.7, 0.2]\n        ]), 1e-8),\n        (np.array([\n            [0.8, 0.1, 0.0, 0.05],\n            [0.0, 0.9, 0.1, 0.0],\n            [0.1, 0.0, 0.7, 0.2]\n        ]), 0.5),\n        (np.array([\n            [0.6, 0.58, 0.0, 0.1],\n            [0.2, 0.19, 0.1, 0.0],\n            [0.1, 0.09, 0.7, 0.2]\n        ]), 1e-3),\n        (np.array([\n            [0.6, 0.58, 0.0, 0.1],\n            [0.2, 0.19, 0.1, 0.0],\n            [0.1, 0.09, 0.7, 0.2]\n        ]), 0.5),\n        (np.array([\n            [0.7, 0.3, 0.0, 1.0],\n            [0.2, 0.1, 0.1, 0.3],\n            [0.1, 0.05, 0.8, 0.15]\n        ]), 0.1)\n    ]\n\n    all_results = []\n    for G, lambda_reg in test_cases:\n        m, n = G.shape\n\n        # Compute the resolution matrix R = (G^T G + lambda * I)^-1 * (G^T G)\n        GTG = G.T @ G\n        I_n = np.identity(n)\n        \n        # Matrix to be inverted\n        M = GTG + lambda_reg * I_n\n        \n        # Inverse of M\n        M_inv = np.linalg.inv(M)\n        \n        # Resolution matrix\n        R = M_inv @ GTG\n\n        # --- Calculate Aggregate Metrics ---\n\n        # 1. Mean Self-Gain\n        mean_self_gain = np.mean(np.diag(R))\n\n        # 2. Mean Leakage Fraction  3. Peak-Correct Fraction\n        leakage_fractions = []\n        peak_correct_indicators = []\n        \n        for j in range(n):\n            # Get the j-th column of the resolution matrix\n            psf_j = R[:, j]\n            abs_psf_j = np.abs(psf_j)\n            \n            # --- Leakage Fraction for column j ---\n            total_abs_sum = np.sum(abs_psf_j)\n            \n            leakage_frac_j = 0.0\n            if total_abs_sum > 0:\n                # Sum of absolute off-diagonal elements\n                off_diagonal_abs_sum = total_abs_sum - abs_psf_j[j]\n                leakage_frac_j = off_diagonal_abs_sum / total_abs_sum\n            \n            leakage_fractions.append(leakage_frac_j)\n\n            # --- Peak-Correct Indicator for column j ---\n            peak_location = np.argmax(abs_psf_j)\n            is_peak_correct = 1.0 if peak_location == j else 0.0\n            peak_correct_indicators.append(is_peak_correct)\n\n        mean_leakage_fraction = np.mean(leakage_fractions)\n        peak_correct_fraction = np.mean(peak_correct_indicators)\n\n        # Store the formatted results for this case\n        case_results = [\n            f\"{mean_self_gain:.6f}\",\n            f\"{mean_leakage_fraction:.6f}\",\n            f\"{peak_correct_fraction:.6f}\"\n        ]\n        all_results.append(case_results)\n\n    # Format the final output string as per the problem requirements.\n    # e.g., [[m1,l1,p1],[m2,l2,p2],...]\n    inner_strings = [f\"[{','.join(res)}]\" for res in all_results]\n    final_output = f\"[{','.join(inner_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}