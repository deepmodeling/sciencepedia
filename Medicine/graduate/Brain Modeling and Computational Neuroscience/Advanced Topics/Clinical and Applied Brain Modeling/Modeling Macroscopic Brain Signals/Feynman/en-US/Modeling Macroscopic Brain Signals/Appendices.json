{
    "hands_on_practices": [
        {
            "introduction": "Macroscopic brain signals like the Local Field Potential (LFP) are the collective voice of countless microscopic events. This exercise takes you to the fundamental level, exploring how synaptic activity on a single neuron generates an electric field. By modeling a pyramidal neuron as a simple current dipole, you will build critical intuition for how the location and type of synapse (excitatory vs. inhibitory) determine the polarity of the signal recorded by a nearby electrode .",
            "id": "3997806",
            "problem": "Consider a canonical layer of neocortex modeled as a homogeneous, isotropic, resistive volume conductor with conductivity $\\sigma$ under the quasi-static approximation of Maxwell’s equations. A single, vertically oriented cortical pyramidal neuron is idealized by two membrane patches: an apical dendritic patch at position $\\mathbf{r}_{a} = (0,0,d)$ and a somatic/proximal basal patch at position $\\mathbf{r}_{s} = (0,0,0)$, where $d>0$ represents the apical-somatic separation along the cortical depth axis. A pointlike Local Field Potential (LFP) electrode is located just superficial to the apical patch at $\\mathbf{r}_{e} = (0,0,d+\\epsilon)$ with $0<\\epsilon \\ll d$. Assume linear superposition of extracellular potentials and that the medium is source-free except for transmembrane currents.\n\nUse the standard volume conductor formulation for extracellular potential due to transmembrane currents: for a set of localized membrane current sources/sinks with signed strengths $\\{I_{k}\\}$ at positions $\\{\\mathbf{r}_{k}\\}$, the extracellular potential at $\\mathbf{r}$ is\n$$\n\\phi(\\mathbf{r}) = \\frac{1}{4\\pi \\sigma} \\sum_{k} \\frac{I_{k}}{\\left\\lVert \\mathbf{r} - \\mathbf{r}_{k} \\right\\rVert}.\n$$\nAdopt the sign convention that $I_{k}>0$ denotes a net outward transmembrane current into the extracellular medium (a source), and $I_{k}<0$ denotes a net inward transmembrane current from the extracellular medium into the cell (a sink). Consider synaptic conductance changes that are sufficiently fast and localized so that, for the purpose of this question, the primary current at the synaptic site is approximated as concentrated at that site and the return current is approximated as concentrated at the other patch with equal magnitude and opposite sign, ensuring approximate local charge conservation. Assume a typical adult neuron with resting membrane potential $V_{m}$ below the excitatory reversal potential $E_{\\mathrm{exc}}$ and near the inhibitory reversal potential $E_{\\mathrm{inh}}$, so that excitatory synaptic activation produces an inward transmembrane current at the synaptic site ($I<0$) and inhibitory synaptic activation produces an outward transmembrane current at the synaptic site ($I>0$).\n\nUnder these assumptions, analyze the polarity of $\\phi(\\mathbf{r}_{e})$ measured at the superficial electrode for the following four scenarios, each involving a single brief synaptic event of magnitude $I_{0}>0$:\n\n- Scenario $1$: A distal apical excitatory synapse is activated at $\\mathbf{r}_{a}$, modeled as $I_{a} = -I_{0}$ at $\\mathbf{r}_{a}$ and a return current $I_{s} = +I_{0}$ at $\\mathbf{r}_{s}$.\n- Scenario $2$: A perisomatic inhibitory synapse is activated at $\\mathbf{r}_{s}$, modeled as $I_{s} = +I_{0}$ at $\\mathbf{r}_{s}$ and a return current $I_{a} = -I_{0}$ at $\\mathbf{r}_{a}$.\n- Scenario $3$: A proximal basal excitatory synapse is activated at $\\mathbf{r}_{s}$, modeled as $I_{s} = -I_{0}$ at $\\mathbf{r}_{s}$ and a return current $I_{a} = +I_{0}$ at $\\mathbf{r}_{a}$.\n- Scenario $4$: A distal apical inhibitory synapse is activated at $\\mathbf{r}_{a}$, modeled as $I_{a} = +I_{0}$ at $\\mathbf{r}_{a}$ and a return current $I_{s} = -I_{0}$ at $\\mathbf{r}_{s}$.\n\nWhich of the following statements about the sign of the deflection of $\\phi(\\mathbf{r}_{e})$ (negative versus positive) at the superficial electrode are correct?\n\nA. In Scenario $1$, $\\phi(\\mathbf{r}_{e})$ exhibits a negative deflection.\n\nB. In Scenario $2$, $\\phi(\\mathbf{r}_{e})$ exhibits a positive deflection.\n\nC. In Scenario $3$, $\\phi(\\mathbf{r}_{e})$ exhibits a positive deflection.\n\nD. In Scenario $4$, $\\phi(\\mathbf{r}_{e})$ exhibits a negative deflection.\n\nAnswer by selecting all correct options.",
            "solution": "## Problem Validation\n\n### Step 1: Extract Givens\n\nThe problem statement provides the following information:\n- **Medium**: A homogeneous, isotropic, resistive volume conductor with conductivity $\\sigma$.\n- **Approximation**: The quasi-static approximation of Maxwell’s equations is assumed.\n- **Neuron Model**: A single, vertically oriented cortical pyramidal neuron is idealized by two membrane patches:\n    - Apical patch position: $\\mathbf{r}_{a} = (0,0,d)$.\n    - Somatic patch position: $\\mathbf{r}_{s} = (0,0,0)$.\n    - Condition: $d > 0$.\n- **Electrode Position**: A pointlike LFP electrode is at $\\mathbf{r}_{e} = (0,0,d+\\epsilon)$.\n    - Condition: $0 < \\epsilon \\ll d$.\n- **Fundamental Principles**:\n    - Linear superposition of extracellular potentials is assumed.\n    - The medium is source-free except for transmembrane currents.\n    - The formula for extracellular potential $\\phi(\\mathbf{r})$ is given by $\\phi(\\mathbf{r}) = \\frac{1}{4\\pi \\sigma} \\sum_{k} \\frac{I_{k}}{\\left\\lVert \\mathbf{r} - \\mathbf{r}_{k} \\right\\rVert}$.\n- **Conventions and Assumptions**:\n    - Current sign: $I_{k}>0$ for outward current (source), $I_{k}<0$ for inward current (sink).\n    - Synaptic model: A primary current at the synaptic site and a return current at the other patch with equal magnitude and opposite sign.\n    - Physiological state: Resting membrane potential $V_{m}$ is below the excitatory reversal potential $E_{\\mathrm{exc}}$ and near the inhibitory reversal potential $E_{\\mathrm{inh}}$.\n    - Consequence: Excitatory synapse causes inward current ($I<0$), inhibitory synapse causes outward current ($I>0$).\n- **Scenarios**: For a single event of magnitude $I_{0}>0$:\n    - **Scenario 1**: Apical excitatory synapse. Modeled as $I_{a} = -I_{0}$ at $\\mathbf{r}_{a}$ and $I_{s} = +I_{0}$ at $\\mathbf{r}_{s}$.\n    - **Scenario 2**: Perisomatic inhibitory synapse. Modeled as $I_{s} = +I_{0}$ at $\\mathbf{r}_{s}$ and $I_{a} = -I_{0}$ at $\\mathbf{r}_{a}$.\n    - **Scenario 3**: Proximal basal excitatory synapse. Modeled as $I_{s} = -I_{0}$ at $\\mathbf{r}_{s}$ and $I_{a} = +I_{0}$ at $\\mathbf{r}_{a}$.\n    - **Scenario 4**: Distal apical inhibitory synapse. Modeled as $I_{a} = +I_{0}$ at $\\mathbf{r}_{a}$ and $I_{s} = -I_{0}$ at $\\mathbf{r}_{s}$.\n- **Question**: Determine the sign (polarity) of the potential $\\phi(\\mathbf{r}_{e})$ at the superficial electrode for each scenario.\n\n### Step 2: Validate Using Extracted Givens\n\nThe problem is analyzed against the validation criteria:\n- **Scientifically Grounded**: The problem is based on the standard volume conductor theory used to model local field potentials (LFPs), a cornerstone of computational neuroscience. The quasi-static approximation, the point-source formula for potential, the dipole model of a neuron, and the physiological assumptions about synaptic currents are all standard and well-established in the field.\n- **Well-Posed**: The problem is well-posed. It provides a clear mathematical formula and all necessary parameters and conditions to calculate the potential at the specified point. The condition $0 < \\epsilon \\ll d$ is a key piece of information that makes the problem uniquely solvable and physically meaningful, representing a measurement electrode very close to the apical tuft.\n- **Objective**: The problem is stated in precise, objective language, free of ambiguity or subjective claims. The scenarios are defined with exact mathematical representations of the currents.\n\nThe problem does not exhibit any of the invalidity flaws:\n1.  **Scientific Unsoundness**: The physics and physiology are standard textbook material.\n2.  **Non-Formalizable/Irrelevant**: The problem is a direct and formalizable model within the specified topic.\n3.  **Incomplete/Contradictory**: All necessary information is provided. While Scenarios $1$ and $2$ (and Scenarios $3$ and $4$) lead to identical current distributions, this is a feature of the simplified model, not a contradiction. It highlights that different synaptic events can produce similar far-field potentials.\n4.  **Unrealistic/Infeasible**: The setup is an idealization but is a common and scientifically plausible one for theoretical analysis.\n5.  **Ill-Posed**: A unique sign for the potential can be determined for each case.\n6.  **Trivial/Tautological**: The problem requires a correct application of the potential formula and an understanding of the relative contributions of near and far sources, which is a key concept.\n\n### Step 3: Verdict and Action\n\nThe problem statement is scientifically sound, self-contained, and well-posed. The analysis may proceed.\n\n## Derivation of the Solution\n\nThe extracellular potential $\\phi$ at the electrode position $\\mathbf{r}_{e}$ is given by the linear superposition of the potentials generated by the two current sources/sinks, $I_{a}$ at the apical patch $\\mathbf{r}_{a}$ and $I_{s}$ at the somatic patch $\\mathbf{r}_{s}$. Using the provided formula:\n$$\n\\phi(\\mathbf{r}_{e}) = \\frac{1}{4\\pi \\sigma} \\left( \\frac{I_{a}}{\\left\\lVert \\mathbf{r}_{e} - \\mathbf{r}_{a} \\right\\rVert} + \\frac{I_{s}}{\\left\\lVert \\mathbf{r}_{e} - \\mathbf{r}_{s} \\right\\rVert} \\right)\n$$\nWe must first compute the distances from the electrode to the two current patches.\nThe location of the electrode is $\\mathbf{r}_{e} = (0,0,d+\\epsilon)$.\nThe location of the apical patch is $\\mathbf{r}_{a} = (0,0,d)$.\nThe location of the somatic patch is $\\mathbf{r}_{s} = (0,0,0)$.\n\nThe distance to the apical patch is:\n$$ \\left\\lVert \\mathbf{r}_{e} - \\mathbf{r}_{a} \\right\\rVert = \\left\\lVert (0,0,d+\\epsilon) - (0,0,d) \\right\\rVert = \\left\\lVert (0,0,\\epsilon) \\right\\rVert = \\epsilon $$\nThe distance to the somatic patch is:\n$$ \\left\\lVert \\mathbf{r}_{e} - \\mathbf{r}_{s} \\right\\rVert = \\left\\lVert (0,0,d+\\epsilon) - (0,0,0) \\right\\rVert = \\left\\lVert (0,0,d+\\epsilon) \\right\\rVert = d+\\epsilon $$\nSubstituting these distances into the potential equation gives the general expression for $\\phi(\\mathbf{r}_{e})$:\n$$\n\\phi(\\mathbf{r}_{e}) = \\frac{1}{4\\pi \\sigma} \\left( \\frac{I_{a}}{\\epsilon} + \\frac{I_{s}}{d+\\epsilon} \\right)\n$$\nWe are given that $\\sigma > 0$ and $I_{0} > 0$. The sign of $\\phi(\\mathbf{r}_{e})$ is therefore determined by the sign of the term in the parentheses. We now analyze each scenario.\n\n### Scenario Analysis\n\n**Scenario $1$: Apical excitatory synapse**\n- Currents: $I_{a} = -I_{0}$ (sink at apex) and $I_{s} = +I_{0}$ (source at soma).\n- Substituting into the general expression:\n$$ \\phi(\\mathbf{r}_{e}) = \\frac{1}{4\\pi \\sigma} \\left( \\frac{-I_{0}}{\\epsilon} + \\frac{I_{0}}{d+\\epsilon} \\right) = \\frac{I_{0}}{4\\pi \\sigma} \\left( \\frac{1}{d+\\epsilon} - \\frac{1}{\\epsilon} \\right) $$\n- To determine the sign, we compare the magnitudes of the terms. Since $d > 0$ and $\\epsilon > 0$, we have $d+\\epsilon > \\epsilon$. This implies that $\\frac{1}{d+\\epsilon} < \\frac{1}{\\epsilon}$.\n- Therefore, the term $\\left( \\frac{1}{d+\\epsilon} - \\frac{1}{\\epsilon} \\right)$ is negative.\n- As $I_{0} > 0$ and $\\sigma > 0$, the potential $\\phi(\\mathbf{r}_{e})$ is **negative**.\n\n**Scenario $2$: Perisomatic inhibitory synapse**\n- Currents: $I_{s} = +I_{0}$ (source at soma) and $I_{a} = -I_{0}$ (sink at apex).\n- This current configuration is identical to that of Scenario $1$.\n- The calculation is therefore identical:\n$$ \\phi(\\mathbf{r}_{e}) = \\frac{1}{4\\pi \\sigma} \\left( \\frac{-I_{0}}{\\epsilon} + \\frac{I_{0}}{d+\\epsilon} \\right) = \\frac{I_{0}}{4\\pi \\sigma} \\left( \\frac{1}{d+\\epsilon} - \\frac{1}{\\epsilon} \\right) $$\n- The potential $\\phi(\\mathbf{r}_{e})$ is **negative**.\n\n**Scenario $3$: Proximal basal excitatory synapse**\n- Currents: $I_{s} = -I_{0}$ (sink at soma) and $I_{a} = +I_{0}$ (source at apex).\n- Substituting into the general expression:\n$$ \\phi(\\mathbf{r}_{e}) = \\frac{1}{4\\pi \\sigma} \\left( \\frac{I_{0}}{\\epsilon} + \\frac{-I_{0}}{d+\\epsilon} \\right) = \\frac{I_{0}}{4\\pi \\sigma} \\left( \\frac{1}{\\epsilon} - \\frac{1}{d+\\epsilon} \\right) $$\n- As established before, $\\frac{1}{\\epsilon} > \\frac{1}{d+\\epsilon}$.\n- Therefore, the term $\\left( \\frac{1}{\\epsilon} - \\frac{1}{d+\\epsilon} \\right)$ is positive.\n- As $I_{0} > 0$ and $\\sigma > 0$, the potential $\\phi(\\mathbf{r}_{e})$ is **positive**.\n\n**Scenario $4$: Distal apical inhibitory synapse**\n- Currents: $I_{a} = +I_{0}$ (source at apex) and $I_{s} = -I_{0}$ (sink at soma).\n- This current configuration is identical to that of Scenario $3$.\n- The calculation is therefore identical:\n$$ \\phi(\\mathbf{r}_{e}) = \\frac{1}{4\\pi \\sigma} \\left( \\frac{I_{0}}{\\epsilon} + \\frac{-I_{0}}{d+\\epsilon} \\right) = \\frac{I_{0}}{4\\pi \\sigma} \\left( \\frac{1}{\\epsilon} - \\frac{1}{d+\\epsilon} \\right) $$\n- The potential $\\phi(\\mathbf{r}_{e})$ is **positive**.\n\nThe crucial insight is that because the electrode is very close to the apical patch ($0 < \\epsilon \\ll d$), the potential it measures is dominated by the current at that patch. The term $\\frac{I_{a}}{\\epsilon}$ has a much larger magnitude than $\\frac{I_{s}}{d+\\epsilon}$, so the sign of $\\phi(\\mathbf{r}_{e})$ follows the sign of $I_{a}$.\n\n## Option-by-Option Analysis\n\n**A. In Scenario $1$, $\\phi(\\mathbf{r}_{e})$ exhibits a negative deflection.**\nOur analysis of Scenario $1$ shows that $\\phi(\\mathbf{r}_{e})$ is negative. This corresponds to a negative deflection from a baseline of zero potential.\n**Verdict: Correct.**\n\n**B. In Scenario $2$, $\\phi(\\mathbf{r}_{e})$ exhibits a positive deflection.**\nOur analysis of Scenario $2$ shows that $\\phi(\\mathbf{r}_{e})$ is negative. The statement claims a positive deflection.\n**Verdict: Incorrect.**\n\n**C. In Scenario $3$, $\\phi(\\mathbf{r}_{e})$ exhibits a positive deflection.**\nOur analysis of Scenario $3$ shows that $\\phi(\\mathbf{r}_{e})$ is positive. This corresponds to a positive deflection.\n**Verdict: Correct.**\n\n**D. In Scenario $4$, $\\phi(\\mathbf{r}_{e})$ exhibits a negative deflection.**\nOur analysis of Scenario $4$ shows that $\\phi(\\mathbf{r}_{e})$ is positive. The statement claims a negative deflection.\n**Verdict: Incorrect.**",
            "answer": "$$\\boxed{AC}$$"
        },
        {
            "introduction": "To model the activity of millions of neurons, we must simplify our representation of the underlying sources. A cornerstone of EEG and MEG source modeling is the point dipole approximation, which treats a localized region of synchronized neural activity as a single point source. This coding practice allows you to quantify the validity of this approximation by comparing the exact potential from a separated source-sink pair to its dipole equivalent, exploring how distance and orientation impact the model's accuracy .",
            "id": "3997785",
            "problem": "Consider an infinite, homogeneous, isotropic volume conductor with scalar conductivity $\\sigma$ under the quasi-static approximation of Maxwell's equations, in which the electric potential $V(\\mathbf{r})$ satisfies the elliptic partial differential equation $\\nabla \\cdot (\\sigma \\nabla V) = \\nabla \\cdot \\mathbf{J}_{\\mathrm{s}}$, where $\\mathbf{J}_{\\mathrm{s}}$ denotes impressed current density. In this setting, the Green's function solution for a point current source of strength $I$ located at position $\\mathbf{r}_0$ is $V(\\mathbf{r}) = \\dfrac{I}{4 \\pi \\sigma} \\dfrac{1}{\\|\\mathbf{r}-\\mathbf{r}_0\\|}$, and superposition holds for multiple sources. A canonical macroscopic neural source model is a pair of equal and opposite current monopoles, $+I$ and $-I$, separated by distance $2a$ along the $z$-axis at positions $\\mathbf{r}_{+} = (0,0,a)$ and $\\mathbf{r}_{-} = (0,0,-a)$, which is frequently approximated at large distances by a point current dipole with moment $\\mathbf{p} = I(\\mathbf{r}_{+}-\\mathbf{r}_{-}) = (0,0,2 I a)$. The potential of a point current dipole located at the origin is given by $V_{\\mathrm{dip}}(\\mathbf{r}) = \\dfrac{1}{4 \\pi \\sigma} \\dfrac{\\mathbf{p} \\cdot \\mathbf{r}}{\\|\\mathbf{r}\\|^{3}}$. The exact potential of the finite-sized source pair at an observation point $\\mathbf{r}$ is $V_{\\mathrm{exact}}(\\mathbf{r}) = \\dfrac{I}{4 \\pi \\sigma} \\left( \\dfrac{1}{\\|\\mathbf{r}-\\mathbf{r}_{+}\\|} - \\dfrac{1}{\\|\\mathbf{r}-\\mathbf{r}_{-}\\|} \\right)$. Define a normalized absolute error that robustly handles near-zero values as\n$$\n\\varepsilon(\\mathbf{r}; \\sigma, I, a) = \\begin{cases}\n\\dfrac{\\left|V_{\\mathrm{exact}}(\\mathbf{r})-V_{\\mathrm{dip}}(\\mathbf{r})\\right|}{\\max\\left(\\left|V_{\\mathrm{exact}}(\\mathbf{r})\\right|,\\left|V_{\\mathrm{dip}}(\\mathbf{r})\\right|\\right)}, & \\text{if } \\max\\left(\\left|V_{\\mathrm{exact}}(\\mathbf{r})\\right|,\\left|V_{\\mathrm{dip}}(\\mathbf{r})\\right|\\right) > 0, \\\\\n0, & \\text{otherwise.}\n\\end{cases}\n$$\nYour task is to compute $\\varepsilon$ for a set of observation points and parameter values to establish the validity range of the dipole approximation. Use spherical coordinates for the observation point with radius $r$ and polar angle $\\theta$ measured from the $z$-axis (with azimuth fixed at $\\phi = 0$), so that $\\mathbf{r} = (r \\sin \\theta, 0, r \\cos \\theta)$. The volume conductor is infinite and homogeneous, the two monopoles are exactly at $\\mathbf{r}_{+}=(0,0,a)$ and $\\mathbf{r}_{-}=(0,0,-a)$, and the point dipole approximation is centered at the origin with $\\mathbf{p}=(0,0,2 I a)$. All distances must be expressed in meters, conductivity in $\\mathrm{S/m}$, current in $\\mathrm{A}$, and the potential in volts. Angles must be specified in radians. For each case, report the normalized error $\\varepsilon$ as a float rounded to six decimal places.\n\nFundamental base assumptions and definitions:\n1. The quasi-static volume conductor model applies, with $\\nabla \\cdot (\\sigma \\nabla V) = \\nabla \\cdot \\mathbf{J}_{\\mathrm{s}}$ and linear superposition.\n2. The Green's function in an infinite homogeneous medium yields $V(\\mathbf{r}) = \\dfrac{I}{4 \\pi \\sigma} \\dfrac{1}{\\|\\mathbf{r}-\\mathbf{r}_0\\|}$ for a single point source at $\\mathbf{r}_0$.\n3. The far-field point dipole potential is $V_{\\mathrm{dip}}(\\mathbf{r}) = \\dfrac{1}{4 \\pi \\sigma} \\dfrac{\\mathbf{p} \\cdot \\mathbf{r}}{\\|\\mathbf{r}\\|^{3}}$ for dipole moment $\\mathbf{p}$ at the origin.\n\nCompute $\\varepsilon$ for the following test suite of parameter sets $(\\sigma, I, a, r, \\theta)$:\n- Case $1$ (happy path, far field on axis): $(0.3, 1.0 \\times 10^{-7}, 1.0 \\times 10^{-3}, 5.0 \\times 10^{-2}, 0)$.\n- Case $2$ (boundary condition, closer field on axis): $(0.3, 1.0 \\times 10^{-7}, 1.0 \\times 10^{-2}, 2.0 \\times 10^{-2}, 0)$.\n- Case $3$ (intermediate angle, moderate far field): $(0.3, 1.0 \\times 10^{-7}, 5.0 \\times 10^{-3}, 5.0 \\times 10^{-2}, \\pi/4)$.\n- Case $4$ (very far field, oblique angle): $(0.3, 1.0 \\times 10^{-7}, 1.0 \\times 10^{-3}, 1.0, \\pi/3)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[x_{1},x_{2},x_{3},x_{4}]$), where each $x_{k}$ is the normalized error $\\varepsilon$ for the corresponding case, rounded to six decimal places.",
            "solution": "The problem statement is evaluated as scientifically sound, well-posed, and objective. It is based on fundamental principles of bioelectromagnetism, specifically the quasi-static approximation for volume conduction, which is a cornerstone of electroencephalography (EEG) and magnetoencephalography (MEG) source modeling. The problem provides all necessary equations, boundary conditions (implicit in the infinite medium), parameter values, and definitions required for a unique and verifiable solution. There are no internal contradictions, ambiguities, or factual inaccuracies. Therefore, the problem is valid and a solution will be provided.\n\nThe objective is to compute the normalized absolute error $\\varepsilon$ between the electric potential generated by a finite-sized current source (a pair of opposite monopoles) and its point dipole approximation. The error is defined as:\n$$\n\\varepsilon(\\mathbf{r}; \\sigma, I, a) = \\begin{cases}\n\\dfrac{\\left|V_{\\mathrm{exact}}(\\mathbf{r})-V_{\\mathrm{dip}}(\\mathbf{r})\\right|}{\\max\\left(\\left|V_{\\mathrm{exact}}(\\mathbf{r})\\right|,\\left|V_{\\mathrm{dip}}(\\mathbf{r})\\right|\\right)}, & \\text{if } \\max\\left(\\left|V_{\\mathrm{exact}}(\\mathbf{r})\\right|,\\left|V_{\\mathrm{dip}}(\\mathbf{r})\\right|\\right) > 0, \\\\\n0, & \\text{otherwise.}\n\\end{cases}\n$$\nThe analysis is performed in an infinite, homogeneous, and isotropic conductive medium with conductivity $\\sigma$.\n\nFirst, we must express the potentials $V_{\\mathrm{exact}}$ and $V_{\\mathrm{dip}}$ in terms of the given spherical coordinates for the observation point $\\mathbf{r} = (r \\sin \\theta, 0, r \\cos \\theta)$, where $r$ is the radius and $\\theta$ is the polar angle from the $z$-axis.\n\nThe source positions are given as $\\mathbf{r}_{+} = (0,0,a)$ and $\\mathbf{r}_{-} = (0,0,-a)$. The dipole moment is $\\mathbf{p} = (0,0,2Ia)$.\n\nWe need to compute the Euclidean distances from the observation point $\\mathbf{r}$ to the source locations $\\mathbf{r}_{+}$ and $\\mathbf{r}_{-}$:\n$\\|\\mathbf{r}-\\mathbf{r}_{+}\\| = \\sqrt{(r \\sin \\theta - 0)^2 + (0 - 0)^2 + (r \\cos \\theta - a)^2} = \\sqrt{r^2 \\sin^2 \\theta + r^2 \\cos^2 \\theta - 2ar \\cos \\theta + a^2}$\nUsing the identity $\\sin^2 \\theta + \\cos^2 \\theta = 1$, this simplifies to:\n$$\n\\|\\mathbf{r}-\\mathbf{r}_{+}\\| = \\sqrt{r^2 + a^2 - 2ar \\cos \\theta}\n$$\nSimilarly, the distance to the negative monopole is:\n$\\|\\mathbf{r}-\\mathbf{r}_{-}\\| = \\sqrt{(r \\sin \\theta - 0)^2 + (0 - 0)^2 + (r \\cos \\theta - (-a))^2} = \\sqrt{r^2 \\sin^2 \\theta + r^2 \\cos^2 \\theta + 2ar \\cos \\theta + a^2}$\n$$\n\\|\\mathbf{r}-\\mathbf{r}_{-}\\| = \\sqrt{r^2 + a^2 + 2ar \\cos \\theta}\n$$\nWith these distances, the exact potential $V_{\\mathrm{exact}}$ can be written as:\n$$\nV_{\\mathrm{exact}}(\\mathbf{r}) = \\frac{I}{4 \\pi \\sigma} \\left( \\frac{1}{\\sqrt{r^2 + a^2 - 2ar \\cos \\theta}} - \\frac{1}{\\sqrt{r^2 + a^2 + 2ar \\cos \\theta}} \\right)\n$$\n\nNext, we express the point dipole potential $V_{\\mathrm{dip}}$ in spherical coordinates. The formula is $V_{\\mathrm{dip}}(\\mathbf{r}) = \\dfrac{1}{4 \\pi \\sigma} \\dfrac{\\mathbf{p} \\cdot \\mathbf{r}}{\\|\\mathbf{r}\\|^{3}}$.\nThe dot product $\\mathbf{p} \\cdot \\mathbf{r}$ is:\n$$\n\\mathbf{p} \\cdot \\mathbf{r} = (0,0,2Ia) \\cdot (r \\sin \\theta, 0, r \\cos \\theta) = (0)(r \\sin \\theta) + (0)(0) + (2Ia)(r \\cos \\theta) = 2Ia r \\cos \\theta\n$$\nThe norm of the position vector is simply $\\|\\mathbf{r}\\| = r$.\nSubstituting these into the dipole potential formula gives:\n$$\nV_{\\mathrm{dip}}(\\mathbf{r}) = \\frac{1}{4 \\pi \\sigma} \\frac{2Ia r \\cos \\theta}{r^3} = \\frac{I}{4 \\pi \\sigma} \\frac{2a \\cos \\theta}{r^2}\n$$\nIt is noteworthy that the common factor $\\dfrac{I}{4\\pi\\sigma}$ appears in both $V_{\\mathrm{exact}}$ and $V_{\\mathrm{dip}}$. Since the error formula $\\varepsilon$ is a ratio of these potentials, this factor will cancel out, meaning the error is independent of the conductivity $\\sigma$ and current strength $I$. This is expected, as the error is a geometric property of the approximation. However, the calculation will proceed using all provided parameters for completeness.\n\nThe algorithm for each test case $(\\sigma, I, a, r, \\theta)$ is as follows:\n1.  Calculate the two potential values, $V_{\\mathrm{exact}}$ and $V_{\\mathrm{dip}}$, using the derived expressions in spherical coordinates.\n    $$\n    V_{\\mathrm{exact}} = \\frac{I}{4 \\pi \\sigma} \\left( \\frac{1}{\\sqrt{r^2 + a^2 - 2ar \\cos \\theta}} - \\frac{1}{\\sqrt{r^2 + a^2 + 2ar \\cos \\theta}} \\right)\n    $$\n    $$\n    V_{\\mathrm{dip}} = \\frac{I}{4 \\pi \\sigma} \\frac{2a \\cos \\theta}{r^2}\n    $$\n2.  Calculate the absolute values $|V_{\\mathrm{exact}}|$ and $|V_{\\mathrm{dip}}|$.\n3.  Find the denominator for the error formula, $D = \\max(|V_{\\mathrm{exact}}|, |V_{\\mathrm{dip}}|)$.\n4.  Calculate the numerator, $N = |V_{\\mathrm{exact}} - V_{\\mathrm{dip}}|$.\n5.  If $D > 0$, compute the error $\\varepsilon = N/D$.\n6.  If $D = 0$ (which implies $V_{\\mathrm{exact}} = 0$ and $V_{\\mathrm{dip}} = 0$, for instance on the equatorial plane where $\\theta=\\pi/2$), the error $\\varepsilon$ is $0$ by definition.\n7.  The final result for each case is rounded to six decimal places.\nThis procedure will be implemented for each of the four test cases provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the normalized absolute error between the exact potential of a\n    monopole pair and its point dipole approximation.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (sigma, I, a, r, theta)\n    test_cases = [\n        # Case 1: (sigma, I, a, r, theta)\n        (0.3, 1.0e-7, 1.0e-3, 5.0e-2, 0.0),\n        # Case 2: (sigma, I, a, r, theta)\n        (0.3, 1.0e-7, 1.0e-2, 2.0e-2, 0.0),\n        # Case 3: (sigma, I, a, r, theta)\n        (0.3, 1.0e-7, 5.0e-3, 5.0e-2, np.pi/4),\n        # Case 4: (sigma, I, a, r, theta)\n        (0.3, 1.0e-7, 1.0e-3, 1.0, np.pi/3),\n    ]\n\n    results = []\n    for case in test_cases:\n        sigma, current_I, a, r, theta = case\n\n        # Common constant factor. Although it cancels out in the error calculation,\n        # we include it for a complete physical calculation.\n        const = current_I / (4.0 * np.pi * sigma)\n\n        # --- Calculate V_exact ---\n        # Distances to the two monopoles from the observation point\n        # d_plus = ||r - r_+|| and d_minus = ||r - r_-||\n        # Using the law of cosines, which is equivalent to the derived formula\n        # sqrt(r^2 + a^2 - 2*a*r*cos(theta))\n        d_plus_sq = r**2 + a**2 - 2.0 * a * r * np.cos(theta)\n        d_minus_sq = r**2 + a**2 + 2.0 * a * r * np.cos(theta)\n        \n        # Guard against taking the square root of a negative number due to\n        # floating point inaccuracies, though unlikely with these parameters.\n        d_plus = np.sqrt(max(0, d_plus_sq))\n        d_minus = np.sqrt(max(0, d_minus_sq))\n\n        # The potential is singular at the source locations. The problem's\n        # test cases avoid these points.\n        if d_plus == 0 or d_minus == 0:\n            # This case should not be reached with the given test data.\n            # It would imply that the observation point is at one of the poles.\n            # In a real scenario, this would result in an infinite potential.\n            # For this problem, we can skip if it occurs but it is better to be robust.\n            V_exact = np.inf \n        else:\n            V_exact = const * (1.0 / d_plus - 1.0 / d_minus)\n\n        # --- Calculate V_dipole ---\n        # The observation point is never at r=0 in the test cases.\n        if r == 0:\n            V_dipole = np.inf\n        else:\n            V_dipole = const * (2.0 * a * np.cos(theta)) / (r**2)\n            \n        # --- Calculate Normalized Error epsilon ---\n        abs_V_exact = np.abs(V_exact)\n        abs_V_dipole = np.abs(V_dipole)\n\n        denominator = max(abs_V_exact, abs_V_dipole)\n\n        if denominator > 0:\n            numerator = np.abs(V_exact - V_dipole)\n            epsilon = numerator / denominator\n        else:\n            # This handles the case where both potentials are zero, e.g., on the\n            # equatorial plane (theta = pi/2), as per the problem definition.\n            epsilon = 0.0\n\n        results.append(round(epsilon, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "A key goal of many EEG/MEG experiments is to solve the inverse problem: estimating the location of neural activity from sensor recordings. This is a mathematically ill-posed challenge, and the quality of any solution must be carefully evaluated. In this practical exercise, you will implement a standard Tikhonov-regularized inverse solution and compute its resolution matrix, a powerful tool for understanding the inherent blurring and leakage that characterize any source estimate .",
            "id": "3997760",
            "problem": "You are modeling macroscopic brain signals recorded with Electroencephalography (EEG), Magnetoencephalography (MEG), or Local Field Potential (LFP). In a linear forward model, the measured sensor signals are related to cortical source activity through a deterministic lead-field matrix. The inverse problem aims to estimate cortical sources from sensor measurements. The resolution matrix quantifies how a given inverse operator blurs and mixes true sources across cortical locations and thus characterizes point-spread and leakage.\n\nStarting from the fundamental base:\n- The linear forward model is $y = G x + n$, where $y \\in \\mathbb{R}^{m}$ are sensor measurements, $x \\in \\mathbb{R}^{n}$ are cortical source amplitudes, $G \\in \\mathbb{R}^{m \\times n}$ is the lead-field (or gain) matrix, and $n$ is additive noise.\n- The inverse estimate $\\hat{x}$ arises from minimizing a convex objective that balances data fidelity and a quadratic source penalty: $J(x) = \\|y - G x\\|_{2}^{2} + \\lambda \\|x\\|_{2}^{2}$ with scalar regularization parameter $\\lambda > 0$.\n- Define the inverse operator $W$ as the linear mapping $\\hat{x} = W y$ that results from the above minimization.\n- The resolution matrix is $R = W G$ and it maps true sources to estimated sources under the inverse procedure, i.e., $\\hat{x} = R x$ when $n = 0$.\n\nYour task:\n1. Derive and implement the linear minimum-norm Tikhonov inverse operator $W$ implied by minimizing $J(x)$, and compute the resolution matrix $R = W G$.\n2. For each column $j$ of $R$, interpret it as the point-spread function (PSF) for a unit source at cortical location $j$. Define and compute:\n   - The self-gain at location $j$ as $R_{j j}$.\n   - The leakage fraction at location $j$ as $\\displaystyle \\frac{\\sum_{i \\neq j} |R_{i j}|}{\\sum_{i} |R_{i j}|}$, with the convention that this fraction is $0$ when the denominator is $0$.\n   - A peak-correct indicator that equals $1$ if $\\arg\\max_{i} |R_{i j}| = j$ and $0$ otherwise.\n3. Aggregate metrics across locations by computing:\n   - The mean self-gain $\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} R_{j j}$.\n   - The mean leakage fraction $\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} \\frac{\\sum_{i \\neq j} |R_{i j}|}{\\sum_{i} |R_{i j}|}$ (with the same $0$ convention).\n   - The peak-correct fraction $\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} \\mathbf{1}\\{\\arg\\max_{i} |R_{i j}| = j\\}$, where $\\mathbf{1}\\{\\cdot\\}$ is the indicator function.\n4. All quantities are dimensionless. Express the final numerical outputs as floats rounded to six decimal places.\n\nTest suite:\nUse the following lead-field matrices $G$ (each $G$ is $3 \\times 4$, so $m = 3$ sensors and $n = 4$ sources) and regularization parameters $\\lambda$:\n\n- Case A: \n  $$G_{1} = \\begin{bmatrix}\n  0.8 & 0.1 & 0.0 & 0.05 \\\\\n  0.0 & 0.9 & 0.1 & 0.0 \\\\\n  0.1 & 0.0 & 0.7 & 0.2\n  \\end{bmatrix}, \\quad \\lambda = 10^{-8}.$$\n- Case B: \n  $$G_{1} \\text{ as above}, \\quad \\lambda = 0.5.$$\n- Case C:\n  $$G_{2} = \\begin{bmatrix}\n  0.6 & 0.58 & 0.0 & 0.1 \\\\\n  0.2 & 0.19 & 0.1 & 0.0 \\\\\n  0.1 & 0.09 & 0.7 & 0.2\n  \\end{bmatrix}, \\quad \\lambda = 10^{-3}.$$\n- Case D:\n  $$G_{2} \\text{ as above}, \\quad \\lambda = 0.5.$$\n- Case E:\n  $$G_{3} = \\begin{bmatrix}\n  0.7 & 0.3 & 0.0 & 1.0 \\\\\n  0.2 & 0.1 & 0.1 & 0.3 \\\\\n  0.1 & 0.05 & 0.8 & 0.15\n  \\end{bmatrix}, \\quad \\lambda = 0.1.$$\n\nProgram requirements:\n- Implement the derivation to compute $W$ and then $R = W G$ for each case.\n- For each case, compute the three aggregate metrics: mean self-gain, mean leakage fraction, and peak-correct fraction. Round each to six decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case result should itself be a list of the three rounded floats. For example, the format must be like:\n  `[[m1,l1,p1],[m2,l2,p2],[m3,l3,p3],[m4,l4,p4],[m5,l5,p5]]`\nwhere $m_{k}$ is the mean self-gain, $l_{k}$ is the mean leakage fraction, and $p_{k}$ is the peak-correct fraction for case $k$.",
            "solution": "The problem requires the derivation and implementation of the Tikhonov-regularized minimum-norm inverse operator for a linear forward model of brain signals, the calculation of the corresponding resolution matrix, and the computation of several derived resolution metrics.\n\n### Step 1: Problem Validation\n\n**1.1. Extraction of Givens**\n\n- **Forward Model**: The relationship between sensor measurements `$y \\in \\mathbb{R}^{m}$`, cortical source amplitudes `$x \\in \\mathbb{R}^{n}$`, the lead-field matrix `$G \\in \\mathbb{R}^{m \\times n}$`, and additive noise `$n$` is given by the linear equation `$y = G x + n$`.\n- **Objective Function**: The source estimate `$\\hat{x}$` is found by minimizing the objective function `$J(x) = \\|y - G x\\|_{2}^{2} + \\lambda \\|x\\|_{2}^{2}$`, where `$\\lambda > 0$` is a scalar regularization parameter.\n- **Inverse Operator**: The inverse operator `$W$` is the linear map such that `$\\hat{x} = W y$`.\n- **Resolution Matrix**: The resolution matrix `$R$` is defined as `$R = W G$`.\n- **Resolution Metrics (per column `$j$` of `$R$`)**:\n    - Self-gain: `$R_{j j}$`.\n    - Leakage fraction: `$\\displaystyle \\frac{\\sum_{i \\neq j} |R_{i j}|}{\\sum_{i} |R_{i j}|}$`. This is `$0$` if the denominator is `$0$`.\n    - Peak-correct indicator: `$1$` if `$\\arg\\max_{i} |R_{i j}| = j$`, and `$0$` otherwise.\n- **Aggregate Metrics**:\n    - Mean self-gain: `$\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} R_{j j}$`.\n    - Mean leakage fraction: `$\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} \\frac{\\sum_{i \\neq j} |R_{i j}|}{\\sum_{i} |R_{i j}|}$`.\n    - Peak-correct fraction: `$\\displaystyle \\frac{1}{n} \\sum_{j=1}^{n} \\mathbf{1}\\{\\arg\\max_{i} |R_{i j}| = j\\}$`, where `$\\mathbf{1}\\{\\cdot\\}$` is the indicator function.\n- **Test Cases**: Five combinations of a lead-field matrix `$G$` (`$m=3$`, `$n=4$`) and a regularization parameter `$\\lambda$` are provided.\n\n**1.2. Validation Analysis**\n\n- **Scientifically Grounded**: The problem is a cornerstone of electromagnetic brain source imaging. The linear forward model, Tikhonov regularization (also known as Minimum Norm Estimate or MNE), and the analysis of the resolution matrix are standard, well-established concepts in computational neuroscience and biomedical signal processing. The problem is scientifically sound.\n- **Well-Posed**: The objective function `$J(x)$` is a sum of two squared norms. It is strictly convex for `$\\lambda > 0$`, which guarantees a unique minimum. The derivation leads to a unique solution for the inverse operator. The problem is therefore well-posed.\n- **Objective**: All terms are defined with mathematical precision. The problem statement is free of ambiguity or subjective language.\n- **Completeness and Consistency**: The problem provides all necessary data (`$G$`, `$\\lambda$`) and definitions to compute the required metrics. There are no contradictions.\n\n**1.3. Verdict**\n\nThe problem is valid. It is scientifically grounded, well-posed, objective, and self-contained.\n\n### Step 2: Derivation and Solution Plan\n\n**2.1. Derivation of the Inverse Operator $W$**\n\nThe goal is to find the source vector `$\\hat{x}$` that minimizes the objective function `$J(x)$`.\n$$J(x) = \\|y - G x\\|_{2}^{2} + \\lambda \\|x\\|_{2}^{2}$$\nWe can rewrite the squared Euclidean norms using transposes:\n$$J(x) = (y - G x)^T (y - G x) + \\lambda x^T x$$\nExpanding the first term:\n$$J(x) = (y^T - x^T G^T) (y - G x) + \\lambda x^T x$$\n$$J(x) = y^T y - y^T G x - x^T G^T y + x^T G^T G x + \\lambda x^T x$$\nSince the term `$y^T G x$` is a scalar, it is equal to its transpose, `$(y^T G x)^T = x^T G^T y$`. We can combine the two middle terms:\n$$J(x) = y^T y - 2 x^T G^T y + x^T (G^T G) x + \\lambda x^T I_n x$$\n$$J(x) = y^T y - 2 x^T G^T y + x^T (G^T G + \\lambda I_n) x$$\nwhere `$I_n$` is the `$n \\times n$` identity matrix.\n\nTo find the minimum of this convex function, we compute its gradient with respect to `$x$` and set it to zero. Using standard matrix calculus rules (`$\\nabla_v(b^T v) = b$` and `$\\nabla_v(v^T A v) = 2Av$` for symmetric `$A$`), we get:\n$$\\nabla_x J(x) = -2 G^T y + 2 (G^T G + \\lambda I_n) x$$\nSetting the gradient to the zero vector:\n$$0 = -2 G^T y + 2 (G^T G + \\lambda I_n) \\hat{x}$$\n$$(G^T G + \\lambda I_n) \\hat{x} = G^T y$$\nThe matrix `$G^T G$` is positive semi-definite. Since `$\\lambda > 0$`, the matrix `$(G^T G + \\lambda I_n)$` is positive definite and therefore invertible. We can solve for the optimal source estimate `$\\hat{x}$`:\n$$\\hat{x} = (G^T G + \\lambda I_n)^{-1} G^T y$$\nBy definition, the inverse operator `$W$` is the linear mapping from `$y$` to `$\\hat{x}$`, i.e., `$\\hat{x} = W y$`. By comparing the two expressions for `$\\hat{x}$`, we can identify `$W$`:\n$$W = (G^T G + \\lambda I_n)^{-1} G^T$$\n\n**2.2. Computation of the Resolution Matrix $R$**\n\nThe resolution matrix `$R$` maps true sources `$x$` to their estimates `$\\hat{x}$` in the absence of noise (`$n=0$`). It is defined as `$R = W G$`. Substituting the derived expression for `$W$`:\n$$R = \\left( (G^T G + \\lambda I_n)^{-1} G^T \\right) G$$\n$$R = (G^T G + \\lambda I_n)^{-1} (G^T G)$$\nThis is an `$n \\times n$` matrix that describes the blurring and crosstalk effects of the entire forward-inverse modeling process. An ideal inverse would yield `$R = I_n$`, meaning each estimated source perfectly recovers the corresponding true source with no leakage from others.\n\n**2.3. Algorithm for Metrics Calculation**\n\nFor each test case `$(G, \\lambda)$`:\n1.  Let `$n$` be the number of columns of `$G$` (i.e., the number of sources, `$n=4$`).\n2.  Compute the matrix product `$G^T G$`.\n3.  Construct the `$n \\times n$` identity matrix `$I_n$`.\n4.  Compute the matrix `$M = G^T G + \\lambda I_n$`.\n5.  Compute the inverse `$M^{-1}$`.\n6.  Compute the resolution matrix `$R = M^{-1} (G^T G)$`.\n7.  Calculate the aggregate metrics:\n    a.  **Mean Self-Gain**: Compute the mean of the diagonal elements of `$R$`.\n        `$\\text{mean\\_sg} = \\frac{1}{n} \\text{trace}(R)$`.\n    b.  **Mean Leakage Fraction**: For each column `$j$` from `$0$` to `$n-1$`:\n        i.   Calculate the sum of absolute values of the entire column: `$S_j = \\sum_{i=0}^{n-1} |R_{ij}|$`.\n        ii.  If `$S_j > 0$`, the leakage fraction for column `$j$` is `$\\ell_j = \\frac{S_j - |R_{jj}|}{S_j}$`.\n        iii. If `$S_j = 0$`, `$\\ell_j = 0$`.\n        iv.  The mean leakage fraction is `$\\text{mean\\_lf} = \\frac{1}{n} \\sum_{j=0}^{n-1} \\ell_j$`.\n    c.  **Peak-Correct Fraction**: For each column `$j$` from `$0$` to `$n-1$`:\n        i.   Find the row index `$i_{max}$` where the absolute value of the column is maximal: `$i_{max} = \\arg\\max_i |R_{ij}|$`.\n        ii.  The peak-correct indicator for column `$j$` is `$p_j = 1$` if `$i_{max} = j$`, and `$p_j = 0$` otherwise.\n        iii. The peak-correct fraction is `$\\text{mean\\_pcf} = \\frac{1}{n} \\sum_{j=0}^{n-1} p_j$`.\n8.  Round each of the three aggregate metrics to six decimal places and store them.\n\nThis procedure is applied to each of the five test cases provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes resolution matrix metrics for several EEG/MEG inverse problem test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (np.array([\n            [0.8, 0.1, 0.0, 0.05],\n            [0.0, 0.9, 0.1, 0.0],\n            [0.1, 0.0, 0.7, 0.2]\n        ]), 1e-8),\n        (np.array([\n            [0.8, 0.1, 0.0, 0.05],\n            [0.0, 0.9, 0.1, 0.0],\n            [0.1, 0.0, 0.7, 0.2]\n        ]), 0.5),\n        (np.array([\n            [0.6, 0.58, 0.0, 0.1],\n            [0.2, 0.19, 0.1, 0.0],\n            [0.1, 0.09, 0.7, 0.2]\n        ]), 1e-3),\n        (np.array([\n            [0.6, 0.58, 0.0, 0.1],\n            [0.2, 0.19, 0.1, 0.0],\n            [0.1, 0.09, 0.7, 0.2]\n        ]), 0.5),\n        (np.array([\n            [0.7, 0.3, 0.0, 1.0],\n            [0.2, 0.1, 0.1, 0.3],\n            [0.1, 0.05, 0.8, 0.15]\n        ]), 0.1)\n    ]\n\n    all_results = []\n    for G, lambda_reg in test_cases:\n        m, n = G.shape\n\n        # Compute the resolution matrix R = (G^T G + lambda * I)^-1 * (G^T G)\n        GTG = G.T @ G\n        I_n = np.identity(n)\n        \n        # Matrix to be inverted\n        M = GTG + lambda_reg * I_n\n        \n        # Inverse of M\n        M_inv = np.linalg.inv(M)\n        \n        # Resolution matrix\n        R = M_inv @ GTG\n\n        # --- Calculate Aggregate Metrics ---\n\n        # 1. Mean Self-Gain\n        mean_self_gain = np.mean(np.diag(R))\n\n        # 2. Mean Leakage Fraction & 3. Peak-Correct Fraction\n        leakage_fractions = []\n        peak_correct_indicators = []\n        \n        for j in range(n):\n            # Get the j-th column of the resolution matrix\n            psf_j = R[:, j]\n            abs_psf_j = np.abs(psf_j)\n            \n            # --- Leakage Fraction for column j ---\n            total_abs_sum = np.sum(abs_psf_j)\n            \n            leakage_frac_j = 0.0\n            if total_abs_sum > 0:\n                # Sum of absolute off-diagonal elements\n                off_diagonal_abs_sum = total_abs_sum - abs_psf_j[j]\n                leakage_frac_j = off_diagonal_abs_sum / total_abs_sum\n            \n            leakage_fractions.append(leakage_frac_j)\n\n            # --- Peak-Correct Indicator for column j ---\n            peak_location = np.argmax(abs_psf_j)\n            is_peak_correct = 1.0 if peak_location == j else 0.0\n            peak_correct_indicators.append(is_peak_correct)\n\n        mean_leakage_fraction = np.mean(leakage_fractions)\n        peak_correct_fraction = np.mean(peak_correct_indicators)\n\n        # Store the formatted results for this case\n        case_results = [\n            f\"{mean_self_gain:.6f}\",\n            f\"{mean_leakage_fraction:.6f}\",\n            f\"{peak_correct_fraction:.6f}\"\n        ]\n        all_results.append(case_results)\n\n    # Format the final output string as per the problem requirements.\n    # e.g., [[m1,l1,p1],[m2,l2,p2],...]\n    inner_strings = [f\"[{','.join(res)}]\" for res in all_results]\n    final_output = f\"[{','.join(inner_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}