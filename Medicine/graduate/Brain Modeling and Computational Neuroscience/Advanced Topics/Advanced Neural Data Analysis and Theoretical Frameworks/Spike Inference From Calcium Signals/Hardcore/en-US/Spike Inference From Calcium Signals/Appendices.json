{
    "hands_on_practices": [
        {
            "introduction": "Before delving into the complexities of inferring spikes, it is essential to build a solid intuition for the forward process: how a sequence of neural spikes generates an observable calcium signal. This exercise () provides fundamental practice with the most common generative model, a first-order autoregressive, or AR(1), process. By manually calculating the calcium concentration trace resulting from a few spikes, you will gain a concrete understanding of how individual spike responses summate and decay over time, forming the basis for the deconvolution problem.",
            "id": "4019639",
            "problem": "Consider a standard generative model for intracellular calcium concentration in a neuron under spiking activity, where the continuous-time calcium concentration $C(t)$ follows first-order linear kinetics with exponential decay and spike-driven increments. Specifically, between spikes the dynamics obey the linear ordinary differential equation (ODE) $dC(t)/dt = -C(t)/\\tau$, and each spike produces an instantaneous increment of amplitude $\\alpha$ in $C(t)$. When sampled at a fixed interval $\\Delta t$, this continuous-time model induces a discrete-time first-order auto-regressive (AR(1)) process for the sampled sequence $C_t = C(t\\Delta t)$ with the update $C_t$ determined by exponential decay between samples and additive contributions from spikes.\n\nAssume the following scientifically standard conditions:\n- The sampling interval is $\\Delta t = 1$ (arbitrary time units), making time indices $t \\in \\{0,1,2,\\dots\\}$.\n- The decay factor is $\\gamma = \\exp(-\\Delta t/\\tau)$ and is given numerically as $\\gamma = 0.95$.\n- The spike amplitude is $\\alpha = 1$ (dimensionless amplitude increment per spike).\n- The spike train $s_t$ is dimensionless and takes value $1$ at spike times and $0$ otherwise. There are exactly two spikes: one at $t=10$ and one at $t=20$, so $s_{10} = 1$, $s_{20} = 1$, and $s_t = 0$ for all other $t$.\n- The initial calcium concentration is $C_0 = 0$, and there is no activity prior to $t=10$.\n\nNeglect any observation noise, baseline fluorescence offset, or other measurement effects, and treat $C_t$ as dimensionless.\n\nUsing only these premises (exponential decay between samples and unit increments at spike times), compute the discrete-time calcium concentrations $C_t$ for $t=10,11,\\dots,25$ as exact analytical expressions in terms of powers of $0.95$. Express your final answer as a single row matrix listing $C_{10}, C_{11}, \\dots, C_{25}$, with no numerical rounding or approximation. No units are required in the final answer since $C_t$ is dimensionless. Do not include any percentages in your expressions.",
            "solution": "The problem asks for the computation of a discrete-time calcium concentration sequence $C_t$ based on a generative model.\n\nFirst, we must validate the problem statement.\nThe givens are:\n- A continuous-time calcium concentration model with dynamics $dC(t)/dt = -C(t)/\\tau$ between spikes and instantaneous increments of amplitude $\\alpha$ per spike.\n- A discrete-time representation $C_t = C(t\\Delta t)$ which is a first-order auto-regressive (AR(1)) process.\n- Sampling interval: $\\Delta t = 1$.\n- Decay factor: $\\gamma = \\exp(-\\Delta t/\\tau) = 0.95$.\n- Spike amplitude: $\\alpha = 1$.\n- Spike train: $s_t=1$ at $t=10$ and $t=20$, and $s_t=0$ for all other non-negative integer times $t$.\n- Initial condition: $C_0 = 0$.\n- The model is to be treated as exact, with no noise or other measurement artifacts.\n\nThe problem is scientifically grounded, as this AR(1) model is a standard and simplified representation of calcium dynamics used in computational neuroscience for spike inference. It is well-posed, with all necessary parameters, initial conditions, and inputs specified, ensuring a unique solution. The language is objective and precise. The problem is not incomplete, contradictory, unrealistic, or ill-posed. Therefore, the problem is deemed valid and a solution can be derived.\n\nThe discrete-time dynamics of the calcium concentration $C_t$ can be formulated from the problem description. The value at time step $t$ is the sum of the decayed value from the previous time step, $C_{t-1}$, and the contribution from any spike occurring at time $t$. The decay over one time step $\\Delta t$ is given by the factor $\\gamma$. The contribution from a spike is the amplitude $\\alpha$. Thus, the update rule for the AR(1) model is:\n$$C_t = \\gamma C_{t-1} + \\alpha s_t$$\n\nSubstituting the given values $\\gamma = 0.95$ and $\\alpha = 1$, the equation becomes:\n$$C_t = 0.95 C_{t-1} + s_t$$\n\nThe initial condition is $C_0=0$. The spike train $s_t$ is non-zero only at $t=10$ and $t=20$.\n\nWe can solve this linear recurrence relation by unrolling it, which reveals the general solution as a convolution of the spike train with the system's impulse response. The solution at time $t$ is the sum of the responses to all past spikes, decayed appropriately.\nFor a single spike at time $t_0$, the response for $t \\ge t_0$ is $C_t = \\alpha \\gamma^{t-t_0}$. Since the system is linear, the total response is the superposition of the responses to each individual spike.\nThe given spike train consists of two spikes, one at $t=10$ and one at $t=20$. The total calcium concentration $C_t$ is the sum of the responses from these two events:\n$$C_t = \\alpha \\sum_{\\text{spike times } t_i \\le t} \\gamma^{t-t_i}$$\nWith $\\alpha=1$ and spike times $\\{10, 20\\}$, this becomes:\n$$C_t = \\begin{cases} 0 & \\text{for } t < 10 \\\\ \\gamma^{t-10} & \\text{for } 10 \\le t < 20 \\\\ \\gamma^{t-10} + \\gamma^{t-20} & \\text{for } t \\ge 20 \\end{cases}$$\n\nUsing this general form with $\\gamma=0.95$, we can compute the required values for $t=10, 11, \\dots, 25$.\n\nFor $t \\in \\{10, 11, \\dots, 19\\}$:\n$C_t = (0.95)^{t-10}$.\n$C_{10} = (0.95)^{10-10} = (0.95)^0 = 1$.\n$C_{11} = (0.95)^{11-10} = (0.95)^1 = 0.95$.\n$C_{12} = (0.95)^{12-10} = (0.95)^2$.\n...\n$C_{19} = (0.95)^{19-10} = (0.95)^9$.\n\nFor $t \\in \\{20, 21, \\dots, 25\\}$:\n$C_t = (0.95)^{t-10} + (0.95)^{t-20}$.\n$C_{20} = (0.95)^{20-10} + (0.95)^{20-20} = (0.95)^{10} + (0.95)^0 = 1 + (0.95)^{10}$.\n$C_{21} = (0.95)^{21-10} + (0.95)^{21-20} = (0.95)^{11} + (0.95)^1 = 0.95 + (0.95)^{11}$.\n$C_{22} = (0.95)^{22-10} + (0.95)^{22-20} = (0.95)^{12} + (0.95)^2$.\n$C_{23} = (0.95)^{23-10} + (0.95)^{23-20} = (0.95)^{13} + (0.95)^3$.\n$C_{24} = (0.95)^{24-10} + (0.95)^{24-20} = (0.95)^{14} + (0.95)^4$.\n$C_{25} = (0.95)^{25-10} + (0.95)^{25-20} = (0.95)^{15} + (0.95)^5$.\n\nWe now list the $16$ required values in a sequence as requested for the final answer.\n$C_{10} = 1$\n$C_{11} = 0.95$\n$C_{12} = (0.95)^2$\n$C_{13} = (0.95)^3$\n$C_{14} = (0.95)^4$\n$C_{15} = (0.95)^5$\n$C_{16} = (0.95)^6$\n$C_{17} = (0.95)^7$\n$C_{18} = (0.95)^8$\n$C_{19} = (0.95)^9$\n$C_{20} = 1 + (0.95)^{10}$\n$C_{21} = 0.95 + (0.95)^{11}$\n$C_{22} = (0.95)^2 + (0.95)^{12}$\n$C_{23} = (0.95)^3 + (0.95)^{13}$\n$C_{24} = (0.95)^4 + (0.95)^{14}$\n$C_{25} = (0.95)^5 + (0.95)^{15}$",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 1 & 0.95 & (0.95)^{2} & (0.95)^{3} & (0.95)^{4} & (0.95)^{5} & (0.95)^{6} & (0.95)^{7} & (0.95)^{8} & (0.95)^{9} & 1+(0.95)^{10} & 0.95+(0.95)^{11} & (0.95)^{2}+(0.95)^{12} & (0.95)^{3}+(0.95)^{13} & (0.95)^{4}+(0.95)^{14} & (0.95)^{5}+(0.95)^{15} \\end{pmatrix} } $$"
        },
        {
            "introduction": "Having understood the forward model, we now turn to the inverse problem of spike inference. This task is typically framed as a convex optimization problem, where we seek a sparse spike train that best reconstructs the observed fluorescence trace. This exercise () demystifies the deconvolution process by guiding you through a single iteration of the proximal gradient algorithm, a workhorse method for solving such problems. Performing this step will reveal the two competing forces at play: the gradient step that pushes the solution towards data fidelity and the proximal step that enforces spike sparsity via the $\\ell_1$ norm.",
            "id": "4019632",
            "problem": "Consider a calcium imaging generative model in which the calcium impulse response is produced by an Autoregressive of order $1$ (AR($1$)) process with decay parameter $\\gamma \\in (0,1)$ and unit amplitude. In discrete time with bin width normalized to $1$, the impulse response is $g_{t} = \\gamma^{t}$ for $t \\geq 0$. Let the spike train be a vector $s \\in \\mathbb{R}^{T}$, and let the observed fluorescence be modeled (ignoring baseline and measurement noise for this step) as $y \\approx H s$, where $H \\in \\mathbb{R}^{T \\times T}$ is the lower-triangular Toeplitz convolution matrix built from the impulse response. In this problem, take $T = 2$, $\\gamma = \\frac{1}{2}$, and let the observation be $y = \\begin{pmatrix} 1 & 0 \\end{pmatrix}^{\\top}$. The corresponding Toeplitz matrix is\n$$\nH = \\begin{pmatrix}\n1 & 0 \\\\\n\\frac{1}{2} & 1\n\\end{pmatrix}.\n$$\nWe aim to infer the spike train by minimizing the convex objective\n$$\nf(s) = \\frac{1}{2} \\| y - H s \\|_{2}^{2} + \\lambda \\| s \\|_{1},\n$$\nwith the regularization parameter set to $\\lambda = 0.1$. Starting from the initial condition $s^{(0)} = \\begin{pmatrix} 0 & 0 \\end{pmatrix}^{\\top}$, perform one proximal gradient step with a fixed step size $\\eta = \\frac{1}{\\| H \\|^{2}}$, where $\\| H \\|$ denotes the spectral norm of $H$. Compute the updated iterate $s^{(1)}$ exactly. Express your final answer as a single row vector using the LaTeX $\\texttt{pmatrix}$ environment, and do not round; provide the exact closed-form expression.",
            "solution": "The calcium imaging model uses linear convolution to map spikes $s$ to fluorescence $y$ via the Toeplitz operator $H$ derived from the Autoregressive of order $1$ (AR($1$)) impulse response. The spike inference objective is\n$$\nf(s) = g(s) + h(s),\n$$\nwhere the smooth data-fit term is\n$$\ng(s) = \\frac{1}{2} \\| y - H s \\|_{2}^{2},\n$$\nand the nonsmooth regularization is\n$$\nh(s) = \\lambda \\| s \\|_{1}.\n$$\nThe proximal gradient method applies the iteration\n$$\ns^{(k+1)} = \\operatorname{prox}_{\\eta h}\\!\\left(s^{(k)} - \\eta \\nabla g(s^{(k)})\\right),\n$$\nwith $\\eta$ chosen so that it is no larger than the inverse of the Lipschitz constant of $\\nabla g$, which for a quadratic $g$ equals the squared spectral norm of $H$, i.e., $\\| H \\|^{2}$. Here it is specified that $\\eta = \\frac{1}{\\| H \\|^{2}}$.\n\nFirst, compute the gradient of the smooth part. Since\n$$\ng(s) = \\frac{1}{2} \\| y - H s \\|_{2}^{2},\n$$\nthe gradient is\n$$\n\\nabla g(s) = H^{\\top} (H s - y).\n$$\nWith $s^{(0)} = \\begin{pmatrix} 0 & 0 \\end{pmatrix}^{\\top}$, we have\n$$\n\\nabla g(s^{(0)}) = H^{\\top} (H s^{(0)} - y) = H^{\\top} (0 - y) = - H^{\\top} y.\n$$\nTherefore, the forward (gradient) step is\n$$\ns^{(0)} - \\eta \\nabla g(s^{(0)}) = 0 - \\eta (- H^{\\top} y) = \\eta H^{\\top} y.\n$$\n\nNext, compute $H^{\\top} y$ explicitly. Given\n$$\nH = \\begin{pmatrix}\n1 & 0 \\\\\n\\frac{1}{2} & 1\n\\end{pmatrix},\n\\quad\nH^{\\top} = \\begin{pmatrix}\n1 & \\frac{1}{2} \\\\\n0 & 1\n\\end{pmatrix},\n\\quad\ny = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix},\n$$\nwe obtain\n$$\nH^{\\top} y = \\begin{pmatrix}\n1 & \\frac{1}{2} \\\\\n0 & 1\n\\end{pmatrix}\n\\begin{pmatrix}\n1 \\\\ 0\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1 \\\\ 0\n\\end{pmatrix}.\n$$\nThus,\n$$\ns^{(0)} - \\eta \\nabla g(s^{(0)}) = \\eta \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}.\n$$\n\nNow compute the step size $\\eta = \\frac{1}{\\| H \\|^{2}}$. The squared spectral norm satisfies\n$$\n\\| H \\|^{2} = \\lambda_{\\max}\\!\\left(H^{\\top} H\\right),\n$$\nwhere $\\lambda_{\\max}(\\cdot)$ denotes the largest eigenvalue. Compute\n$$\nH^{\\top} H\n=\n\\begin{pmatrix}\n1 & \\frac{1}{2} \\\\\n0 & 1\n\\end{pmatrix}\n\\begin{pmatrix}\n1 & 0 \\\\\n\\frac{1}{2} & 1\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1 + \\left(\\frac{1}{2}\\right)^{2} & \\frac{1}{2} \\\\\n\\frac{1}{2} & 1\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\frac{5}{4} & \\frac{1}{2} \\\\\n\\frac{1}{2} & 1\n\\end{pmatrix}.\n$$\nThe characteristic polynomial of $H^{\\top} H$ is\n$$\n\\det\\!\\left(\n\\begin{pmatrix}\n\\frac{5}{4} & \\frac{1}{2} \\\\\n\\frac{1}{2} & 1\n\\end{pmatrix}\n-\n\\lambda\n\\begin{pmatrix}\n1 & 0 \\\\\n0 & 1\n\\end{pmatrix}\n\\right)\n=\n\\left(\\frac{5}{4} - \\lambda\\right)\\left(1 - \\lambda\\right) - \\left(\\frac{1}{2}\\right)^{2}\n=\n\\lambda^{2} - \\frac{9}{4} \\lambda + 1.\n$$\nSolving $\\lambda^{2} - \\frac{9}{4}\\lambda + 1 = 0$ gives\n$$\n\\lambda = \\frac{1}{8}\\left(9 \\pm \\sqrt{17}\\right),\n$$\nso\n$$\n\\lambda_{\\max}\\!\\left(H^{\\top} H\\right) = \\frac{1}{8}\\left(9 + \\sqrt{17}\\right),\n\\quad\n\\eta = \\frac{1}{\\| H \\|^{2}} = \\frac{1}{\\lambda_{\\max}(H^{\\top} H)} = \\frac{8}{9 + \\sqrt{17}}.\n$$\n\nThe proximal operator of the scaled $\\ell_{1}$ norm is separable and given by element-wise soft-thresholding. For a vector $v$ and threshold $\\tau > 0$,\n$$\n\\operatorname{prox}_{\\tau \\| \\cdot \\|_{1}}(v) = S_{\\tau}(v),\n$$\nwhere\n$$\n\\left[S_{\\tau}(v)\\right]_{i} = \\operatorname{sign}(v_{i}) \\max\\!\\left(|v_{i}| - \\tau, 0\\right).\n$$\nIn our case, the argument to the proximal operator is $v = \\eta H^{\\top} y = \\begin{pmatrix} \\eta \\\\ 0 \\end{pmatrix}$ and the threshold is $\\tau = \\eta \\lambda = \\frac{8}{9 + \\sqrt{17}} \\cdot 0.1 = \\frac{4}{5(9 + \\sqrt{17})}$. Therefore,\n$$\ns^{(1)} = S_{\\eta \\lambda}\\!\\left(\\eta H^{\\top} y\\right)\n=\n\\begin{pmatrix}\n\\max\\!\\left(\\eta - \\eta \\lambda, 0\\right) \\\\\n\\max\\!\\left(0 - \\eta \\lambda, 0\\right)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\eta (1 - \\lambda) \\\\\n0\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\frac{8}{9 + \\sqrt{17}} \\cdot \\frac{9}{10} \\\\\n0\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\frac{36}{5(9 + \\sqrt{17})} \\\\\n0\n\\end{pmatrix}.\n$$\n\nFinally, express $s^{(1)}$ as a single row vector:\n$$\ns^{(1)} = \\begin{pmatrix} \\frac{36}{5(9 + \\sqrt{17})} & 0 \\end{pmatrix}.\n$$",
            "answer": "$$\\boxed{\\begin{pmatrix}\\frac{36}{5\\left(9+\\sqrt{17}\\right)} & 0\\end{pmatrix}}$$"
        },
        {
            "introduction": "Our previous exercises were based on an idealized linear model, which, while powerful, does not capture all the complexities of real biological systems. A critical non-linearity in calcium imaging arises from the binding dynamics of the fluorescent indicator, which can saturate at high calcium concentrations. This computational practice () challenges you to explore the consequences of this model mismatch by applying a linear deconvolution algorithm to a signal generated with indicator saturation. By quantifying the resulting underestimation of spikes, you will see firsthand why understanding the biophysical realities of the measurement process is crucial for designing and applying robust inference algorithms.",
            "id": "4019651",
            "problem": "You are given a biophysical generative model for intracellular calcium concentration and indicator fluorescence. A burst of five action potentials (spikes) occurs at a frequency of $100$ hertz, meaning the interspike interval is $10$ milliseconds. The calcium concentration $C(t)$ (in nanomolar) follows linear time-invariant dynamics with exponential decay and instantaneous increments at spike times. The fluorescence is generated by a one-to-one binding model with a dissociation constant below the peak calcium concentration, which induces saturation.\n\nFundamental base:\n- Calcium dynamics are modeled as a first-order linear system under the assumption of instantaneous influx at spike times: $$\\frac{dC(t)}{dt} = -\\frac{1}{\\tau} C(t) + A \\sum_i \\delta(t - t_i),$$ where $\\tau$ (in seconds) is the calcium decay time constant, $A$ (in nanomolar) is the increment per spike, and $t_i$ are spike times.\n- Indicator fluorescence is modeled by mass-action binding at equilibrium with Hill coefficient $1$: $$F(t) = F_0 + F_{\\max} \\frac{C(t)}{K_d + C(t)},$$ where $F_0$ is baseline fluorescence, $F_{\\max}$ is the maximal fluorescence change, and $K_d$ (in nanomolar) is the dissociation constant.\n- A linear deconvolution method incorrectly assumes fluorescence is proportional to calcium concentration, i.e., $F(t) \\approx \\alpha C(t)$ for some constant $\\alpha$, and inverts the linear calcium dynamics to estimate spikes.\n\nTask:\n1. Simulate the calcium concentration $C(t)$ over a time window long enough to contain the burst and its aftermath, sampled at a fixed time step. Use $C(0) = 0$, decay time constant $\\tau = 0.3$ seconds, spike amplitude $A = 200$ nanomolar, and five spikes at $100$ hertz starting at $t = 0.2$ seconds (i.e., at $t \\in \\{0.2, 0.21, 0.22, 0.23, 0.24\\}$ seconds). Use a sampling interval of $\\Delta t = 0.001$ seconds (i.e., $1$ millisecond). There is no measurement noise. Use $F_0 = 0$ and $F_{\\max} = 1$ (unitless).\n2. Generate fluorescence $F(t)$ using the binding formula above.\n3. Implement a linear deconvolution estimator that first maps fluorescence to an estimated calcium $C_{\\text{hat}}(t)$ by small-signal linearization at $C \\approx 0$ and then inverts the linear calcium dynamics to estimate a spike train $s_{\\text{hat}}(t)$. The inversion should be derived from the difference equation form of the calcium dynamics under sampling interval $\\Delta t$.\n4. Count inferred spikes by detecting local maxima in $s_{\\text{hat}}(t)$ that exceed a detection threshold. Use a detection threshold of $0.75$ (dimensionless), and define a local maximum at time index $n$ as one where $s_{\\text{hat}}[n] \\ge s_{\\text{hat}}[n-1]$, $s_{\\text{hat}}[n] \\ge s_{\\text{hat}}[n+1]$, and $s_{\\text{hat}}[n] \\ge 0.75$. Use the “greater than or equal to” criterion for thresholding. The true spike count is $5$.\n5. Compute the underestimation bias in spike count defined as $$b = \\text{true\\_count} - \\text{inferred\\_count},$$ which is a nonnegative integer when spikes are missed.\n\nTest suite:\nRun your program for the following dissociation constants (in nanomolar), keeping all other parameters fixed:\n- Case 1: $K_d = 150$\n- Case 2: $K_d = 300$\n- Case 3: $K_d = 800$\n- Case 4: $K_d = 934$ (approximately equal to the dynamic peak calcium expected for this burst)\n- Case 5: $K_d = 5000$ (a high value approximating the near-linear regime)\n\nRequired final output format:\nYour program should produce a single line of output containing the underestimation bias values for the five test cases, in order, as a comma-separated list enclosed in square brackets (e.g., \"[b1,b2,b3,b4,b5]\"). Each $b_i$ must be an integer. No other text should be printed. All time is in seconds, calcium in nanomolar, fluorescence unitless.",
            "solution": "The problem requires an analysis of a common failure mode in spike inference from calcium imaging data. Specifically, it asks to quantify the underestimation bias introduced by a linear deconvolution algorithm when the underlying fluorescence signal is generated by a saturating, non-linear calcium indicator. We will proceed by first simulating the biophysical model forward to generate the calcium and fluorescence signals, then applying the specified inverse (deconvolution) algorithm to infer spikes, and finally calculating the resulting bias for different levels of indicator saturation.\n\n**1. Forward Model: Simulating Calcium and Fluorescence Dynamics**\n\nThe first step is to generate the true intracellular calcium concentration `$C(t)$` and the corresponding fluorescence signal `$F(t)$`.\n\n**1.1. Calcium Concentration Simulation**\nThe calcium concentration `$C(t)$` is modeled by the first-order linear differential equation:\n$$\n\\frac{dC(t)}{dt} = -\\frac{1}{\\tau} C(t) + A \\sum_i \\delta(t - t_i)\n$$\nwhere `$\\tau = 0.3$` seconds is the decay time constant, `$A = 200$` nanomolar (nM) is the calcium influx per spike, and `$\\delta(t - t_i)$` represents a Dirac delta function at each spike time `$t_i$`. The spike train consists of `$5$` action potentials at `$100$` Hz, occurring at times `$t \\in \\{0.2, 0.21, 0.22, 0.23, 0.24\\}$` seconds.\n\nFor numerical simulation, we discretize this equation over a time interval `$\\Delta t = 0.001$` seconds. The solution to the homogeneous equation `$\\frac{dC}{dt} = -C/\\tau$` over one time step is an exponential decay. The delta functions correspond to instantaneous additions. This leads to the discrete-time update rule:\n$$\nC[n] = C[n-1] \\cdot \\gamma + A \\cdot s[n]\n$$\nwhere `$C[n] = C(n\\Delta t)$` is the calcium concentration at time step `$n$`, `$\\gamma = e^{-\\Delta t/\\tau}$` is the decay factor per time step, and `$s[n]$` is a discrete representation of the spike train, with `$s[n]=1$` if a spike occurs in the time bin corresponding to `$n$` and `$s[n]=0$` otherwise. The simulation starts with the initial condition `$C[0] = 0$`.\n\n**1.2. Fluorescence Signal Generation**\nThe fluorescence signal `$F(t)$` is generated from the calcium concentration `$C(t)$` via a one-to-one binding model described by the Hill equation with a Hill coefficient of `$1$`:\n$$\nF(t) = F_0 + F_{\\max} \\frac{C(t)}{K_d + C(t)}\n$$\nGiven the parameters `$F_0 = 0$` and `$F_{\\max} = 1$`, this simplifies to:\n$$\nF(t) = \\frac{C(t)}{K_d + C(t)}\n$$\nHere, `$K_d$` is the dissociation constant of the calcium indicator. This equation introduces a critical non-linearity. When the calcium concentration `$C(t)$` is much smaller than `$K_d$`, the relationship is approximately linear: `$F(t) \\approx C(t)/K_d$`. However, as `$C(t)$` becomes comparable to or larger than `$K_d$`, the fluorescence signal begins to saturate, approaching its maximum value of `$1$`. This saturation is the primary source of error for the linear deconvolution method.\n\n**2. Inverse Problem: Linear Spike Deconvolution**\n\nThe task specifies a linear deconvolution method to estimate the spike train from the fluorescence signal. This method incorrectly assumes a linear relationship between fluorescence and calcium.\n\n**2.1. Calcium Concentration Estimation**\nThe method begins by estimating the calcium concentration from the fluorescence trace. It does so by using a small-signal linearization of the fluorescence model around `$C=0$`. The Taylor expansion of `$F(C)$` at `$C=0$` is `$F(C) \\approx F(0) + F'(0) \\cdot C$`.\nWith `$F(C) = C/(K_d + C)$`, we have `$F(0)=0$` and the derivative `$F'(C) = K_d/(K_d + C)^2$`, which gives `$F'(0) = 1/K_d$`.\nThe linear approximation is thus `$F(t) \\approx \\frac{1}{K_d} C(t)$`.\nTo estimate calcium from fluorescence, this relation is inverted:\n$$\nC_{\\text{hat}}(t) = K_d \\cdot F(t)\n$$\nSubstituting the expression for `$F(t)$` reveals the nature of the estimation:\n$$\nC_{\\text{hat}}(t) = K_d \\frac{C(t)}{K_d + C(t)}\n$$\nThis shows that `$C_{\\text{hat}}(t) \\approx C(t)$` only in the linear regime where `$C(t) \\ll K_d$`. In the saturated regime (`$C(t) \\gg K_d$`), `$C_{\\text{hat}}(t)` approaches a ceiling of `$K_d$`, severely underestimating the true calcium concentration.\n\n**2.2. Spike Train Estimation**\nNext, the algorithm inverts the discretized calcium dynamics to estimate the spike train. Starting from the discrete update rule `$C[n] = \\gamma C[n-1] + A s[n]$`, we can solve for `$s[n]$`:\n$$\ns[n] = \\frac{1}{A} (C[n] - \\gamma C[n-1])\n$$\nThis formula is applied to the estimated calcium trace `$C_{\\text{hat}}[n]$` to obtain the estimated spike train `$s_{\\text{hat}}[n]$`:\n$$\ns_{\\text{hat}}[n] = \\frac{1}{A} (C_{\\text{hat}}[n] - \\gamma C_{\\text{hat}}[n-1])\n$$\nwhere `$\\gamma = e^{-\\Delta t/\\tau}$` as before. Because `$C_{\\text{hat}}[n]$` underestimates the true calcium dynamics during high activity, the increments `$(C_{\\text{hat}}[n] - \\gamma C_{\\text{hat}}[n-1])$` will be smaller than the true increments, leading to `$s_{\\text{hat}}[n] < 1$` at spike times, especially for later spikes in a burst where saturation becomes more pronounced.\n\n**3. Spike Counting and Bias Calculation**\n\nFinally, we quantify the performance of the deconvolution algorithm.\n\n**3.1. Spike Detection**\nInferred spikes are identified by finding local maxima in the estimated spike train `$s_{\\text{hat}}[n]$` that exceed a given threshold. A spike is counted at time index `$n$` if all three of the following conditions are met:\n1. `$s_{\\text{hat}}[n] \\ge s_{\\text{hat}}[n-1]$`\n2. `$s_{\\text{hat}}[n] \\ge s_{\\text{hat}}[n+1]$`\n3. `$s_{\\text{hat}}[n] \\ge 0.75$` (detection threshold)\n\n**3.2. Underestimation Bias**\nThe underestimation bias, `$b$`, is the number of spikes missed by the algorithm:\n$$\nb = \\text{true\\_count} - \\text{inferred\\_count}\n$$\nThe true number of spikes is given as `$5$`. We will calculate `$b$` for five different values of the dissociation constant `$K_d$`, which systematically vary the degree of indicator saturation. We expect `$b$` to be high for low `$K_d$` (high saturation) and to decrease towards `$0$` for high `$K_d$` (near-linear regime).",
            "answer": "[4,3,1,1,0]"
        }
    ]
}