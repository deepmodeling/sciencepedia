{
    "hands_on_practices": [
        {
            "introduction": "The FitzHugh-Nagumo model is a classic simplification of the more complex Hodgkin-Huxley dynamics, yet its characteristic cubic nonlinearity can still pose analytical challenges. This exercise introduces a powerful technique: approximating this smooth nonlinearity with a simpler, piecewise-linear function to make analysis more tractable. By constructing this approximation and then quantifying the error it introduces near the crucial firing threshold, you will gain direct experience with the fundamental trade-off between mathematical simplicity and biophysical accuracy .",
            "id": "3965641",
            "problem": "Consider a reduced two-dimensional neuron model of FitzHugh–Nagumo (FHN) type in dimensionless form with membrane voltage $V$ and recovery variable $w$,\n$$\n\\frac{dV}{dt} = f(V) - w + I, \\quad \\frac{dw}{dt} = a \\left(V + b - c w\\right),\n$$\nwhere $f(V)$ represents the ionic current–voltage nonlinearity, $I$ is an external input, and $a$, $b$, $c$ are parameters with $c > 0$. The nullclines of this system are defined by the sets where the time derivatives vanish: the $V$-nullcline $w = f(V) + I$ and the $w$-nullcline $w = \\frac{V + b}{c}$. Assume the ionic current function is the cubic $f(V) = V - \\frac{V^{3}}{3}$, so that the $V$-nullcline exhibits a characteristic cubic shape with knees at $V = -1$ and $V = 1$.\n\nTo enable tractable analysis and reduction, construct a three-segment piecewise-linear approximation $p(V)$ of $f(V)$ that reproduces the cubic nullcline geometry by matching $f(V)$ at the anchor points $V = -1$, $V = 0$, $V = 1$, and by fixing the right branch slope using the additional anchor $V = 2$. Specifically, require $p(V)$ to satisfy $p(-1) = f(-1)$, $p(0) = f(0)$, $p(1) = f(1)$, and the right branch segment on $V \\geq 1$ to pass through $\\left(2, f(2)\\right)$. You may assume symmetry for the left branch.\n\nDefine the threshold current $I_{T}$ as the unique value of $I$ at which the nullclines intersect at the right knee, $V = 1$, that is, $f(1) + I_{T} = \\frac{1 + b}{c}$. Consider a small perturbation $\\delta I$ in input around threshold, $I = I_{T} + \\delta I$, and analyze how the intersection point in $V$ shifts away from $V = 1$. Let $\\delta V_{\\text{cubic}}$ denote the leading-order shift predicted by the exact cubic model and $\\delta V_{\\text{PWL}}$ denote the leading-order shift predicted by the piecewise-linear model. Using a first-order expansion about $V = 1$ and $I = I_{T}$, derive the closed-form analytic expression for the leading-order relative error\n$$\nE(c) = \\frac{\\delta V_{\\text{PWL}} - \\delta V_{\\text{cubic}}}{\\delta V_{\\text{cubic}}},\n$$\nas a function of $c$ only.\n\nProvide your final answer as a single closed-form expression. No numerical approximation or rounding is required.",
            "solution": "The user wants me to solve the following problem:\nConsider a reduced two-dimensional neuron model of FitzHugh–Nagumo (FHN) type in dimensionless form with membrane voltage $V$ and recovery variable $w$,\n$$\n\\frac{dV}{dt} = f(V) - w + I, \\quad \\frac{dw}{dt} = a \\left(V + b - c w\\right),\n$$\nwhere $f(V)$ represents the ionic current–voltage nonlinearity, $I$ is an external input, and $a$, $b$, $c$ are parameters with $c > 0$. The nullclines of this system are defined by the sets where the time derivatives vanish: the $V$-nullcline $w = f(V) + I$ and the $w$-nullcline $w = \\frac{V + b}{c}$. Assume the ionic current function is the cubic $f(V) = V - \\frac{V^{3}}{3}$, so that the $V$-nullcline exhibits a characteristic cubic shape with knees at $V = -1$ and $V = 1$.\n\nTo enable tractable analysis and reduction, construct a three-segment piecewise-linear approximation $p(V)$ of $f(V)$ that reproduces the cubic nullcline geometry by matching $f(V)$ at the anchor points $V = -1$, $V = 0$, $V = 1$, and by fixing the right branch slope using the additional anchor $V = 2$. Specifically, require $p(V)$ to satisfy $p(-1) = f(-1)$, $p(0) = f(0)$, $p(1) = f(1)$, and the right branch segment on $V \\geq 1$ to pass through $\\left(2, f(2)\\right)$. You may assume symmetry for the left branch.\n\nDefine the threshold current $I_{T}$ as the unique value of $I$ at which the nullclines intersect at the right knee, $V = 1$, that is, $f(1) + I_{T} = \\frac{1 + b}{c}$. Consider a small perturbation $\\delta I$ in input around threshold, $I = I_{T} + \\delta I$, and analyze how the intersection point in $V$ shifts away from $V = 1$. Let $\\delta V_{\\text{cubic}}$ denote the leading-order shift predicted by the exact cubic model and $\\delta V_{\\text{PWL}}$ denote the leading-order shift predicted by the piecewise-linear model. Using a first-order expansion about $V = 1$ and $I = I_{T}$, derive the closed-form analytic expression for the leading-order relative error\n$$\nE(c) = \\frac{\\delta V_{\\text{PWL}} - \\delta V_{\\text{cubic}}}{\\delta V_{\\text{cubic}}},\n$$\nas a function of $c$ only.\n\nProvide your final answer as a single closed-form expression. No numerical approximation or rounding is required.\n\n### Step 1: Extract Givens\n-   System equations: $\\frac{dV}{dt} = f(V) - w + I$, $\\frac{dw}{dt} = a(V + b - c w)$\n-   Cubic nonlinearity: $f(V) = V - \\frac{V^3}{3}$\n-   Parameters: $a, b, c$ with $c>0$\n-   $V$-nullcline: $w = f(V) + I$\n-   $w$-nullcline: $w = \\frac{V+b}{c}$\n-   Piecewise-linear approximation $p(V)$ constraints:\n    -   $p(-1) = f(-1)$\n    -   $p(0) = f(0)$\n    -   $p(1) = f(1)$\n    -   The segment for $V \\geq 1$ passes through $(2, f(2))$.\n    -   Symmetry for the left branch.\n-   Threshold current $I_T$: defined by $f(1) + I_T = \\frac{1+b}{c}$\n-   Perturbation: $I = I_T + \\delta I$\n-   Intersection shift for cubic model: $\\delta V_{\\text{cubic}}$\n-   Intersection shift for PWL model: $\\delta V_{\\text{PWL}}$\n-   Target expression: $E(c) = \\frac{\\delta V_{\\text{PWL}} - \\delta V_{\\text{cubic}}}{\\delta V_{\\text{cubic}}}$\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, rooted in the standard analysis of the FitzHugh-Nagumo neuron model, a cornerstone of computational neuroscience. The use of piecewise-linear approximation is a common model reduction technique. The problem is well-posed, providing a clear and unambiguous set of mathematical instructions to derive a specific quantity. All necessary definitions and constraints are provided, making the problem self-contained. The language is objective and formal. The problem structure is sound, asking for a derivation based on first-order perturbation analysis, a standard technique in applied mathematics and physics. There are no contradictions, unrealistic assumptions, or logical flaws. The problem is therefore deemed valid.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will proceed with the solution.\n\nThe intersection of the nullclines is determined by the equation $g(V) + I = \\frac{V+b}{c}$, where $g(V)$ is either the cubic function $f(V)$ or its piecewise-linear approximation $p(V)$. We can write this as an implicit function $H(V, I) = 0$, where $H(V, I) = g(V) + I - \\frac{V+b}{c}$.\n\nWe are interested in the shift of the intersection point $V$ from $V=1$ in response to a small change in current $\\delta I$ from $I=I_T$. This can be found by a first-order expansion of $H(V, I)$ around the point $(V,I) = (1, I_T)$.\n$$ H(1+\\delta V, I_T+\\delta I) \\approx H(1, I_T) + \\frac{\\partial H}{\\partial V}\\bigg|_{(1,I_T)} \\delta V + \\frac{\\partial H}{\\partial I}\\bigg|_{(1,I_T)} \\delta I = 0 $$\nBy definition, $H(1, I_T) = 0$. The partial derivatives are:\n$$ \\frac{\\partial H}{\\partial V} = g'(V) - \\frac{1}{c} \\quad \\text{and} \\quad \\frac{\\partial H}{\\partial I} = 1 $$\nEvaluating at $V=1$ and substituting into the expansion gives:\n$$ \\left(g'(1) - \\frac{1}{c}\\right) \\delta V + \\delta I \\approx 0 $$\nThis provides a general formula for the leading-order shift $\\delta V$:\n$$ \\delta V \\approx \\frac{-\\delta I}{g'(1) - \\frac{1}{c}} = \\frac{\\delta I}{\\frac{1}{c} - g'(1)} $$\nWe now apply this formula to both the cubic and the piecewise-linear models.\n\n**1. Shift for the Cubic Model ($\\delta V_{\\text{cubic}}$)**\nFor the cubic model, $g(V) = f(V) = V - \\frac{V^3}{3}$. The derivative is:\n$$ f'(V) = \\frac{d}{dV}\\left(V - \\frac{V^3}{3}\\right) = 1 - V^2 $$\nAt the right knee, $V=1$, the slope is:\n$$ f'(1) = 1 - 1^2 = 0 $$\nSubstituting $g'(1) = f'(1) = 0$ into the general formula for the shift:\n$$ \\delta V_{\\text{cubic}} \\approx \\frac{\\delta I}{\\frac{1}{c} - 0} = c \\, \\delta I $$\n\n**2. Shift for the Piecewise-Linear Model ($\\delta V_{\\text{PWL}}$)**\nFor the piecewise-linear model, we need the slope of $p(V)$ for $V > 1$. The problem specifies that the segment of $p(V)$ for $V \\geq 1$ is a line that passes through the point $(1, p(1))$ and $(2, f(2))$.\nFirst, we calculate the coordinates of these points. Since $p(V)$ must match $f(V)$ at the anchor points:\n$$ p(1) = f(1) = 1 - \\frac{1^3}{3} = \\frac{2}{3} $$\nThe second point is:\n$$ f(2) = 2 - \\frac{2^3}{3} = 2 - \\frac{8}{3} = -\\frac{2}{3} $$\nThe slope of the line segment for $V \\geq 1$ is the slope connecting the points $(1, 2/3)$ and $(2, -2/3)$. For a small perturbation causing $V>1$, the relevant slope is taken just to the right of $V=1$, which we denote as $p'(1_+)$.\n$$ p'(1_+) = \\frac{f(2) - p(1)}{2 - 1} = \\frac{-2/3 - 2/3}{1} = -\\frac{4}{3} $$\nNow we substitute $g'(1) = p'(1_+) = -4/3$ into the general formula for the shift:\n$$ \\delta V_{\\text{PWL}} \\approx \\frac{\\delta I}{\\frac{1}{c} - \\left(-\\frac{4}{3}\\right)} = \\frac{\\delta I}{\\frac{1}{c} + \\frac{4}{3}} $$\nSimplifying the denominator:\n$$ \\frac{1}{c} + \\frac{4}{3} = \\frac{3 + 4c}{3c} $$\nSo, the shift is:\n$$ \\delta V_{\\text{PWL}} \\approx \\frac{\\delta I}{\\frac{3 + 4c}{3c}} = \\frac{3c}{3 + 4c} \\delta I $$\n\n**3. Relative Error $E(c)$**\nThe relative error is defined as $E(c) = \\frac{\\delta V_{\\text{PWL}} - \\delta V_{\\text{cubic}}}{\\delta V_{\\text{cubic}}}$. This can be rewritten as:\n$$ E(c) = \\frac{\\delta V_{\\text{PWL}}}{\\delta V_{\\text{cubic}}} - 1 $$\nSubstituting the expressions for the leading-order shifts:\n$$ E(c) = \\frac{\\frac{3c}{3 + 4c} \\delta I}{c \\, \\delta I} - 1 $$\nThe terms $\\delta I$ and $c$ (for $c \\neq 0$) cancel out:\n$$ E(c) = \\frac{3}{3 + 4c} - 1 $$\nTo obtain a single fraction, we find a common denominator:\n$$ E(c) = \\frac{3 - (3 + 4c)}{3 + 4c} = \\frac{3 - 3 - 4c}{3 + 4c} = \\frac{-4c}{3 + 4c} $$\nThis is the final closed-form expression for the leading-order relative error as a function of $c$.",
            "answer": "$$\\boxed{\\frac{-4c}{3 + 4c}}$$"
        },
        {
            "introduction": "Neurons are spatially extended structures, and simulating the full spatiotemporal dynamics of a dendritic tree can be computationally prohibitive. This practice introduces Proper Orthogonal Decomposition (POD), a data-driven method for discovering the dominant spatial patterns, or \"modes,\" that govern the system's behavior. By projecting the full model's equations onto a small set of these essential modes—a process called Galerkin projection—we can create a vastly more efficient reduced-order model . This exercise will guide you through the entire pipeline, from generating simulation data to building the reduced model and evaluating its performance, providing a practical foundation in a technique essential for large-scale modeling.",
            "id": "3965680",
            "problem": "Consider a one-dimensional passive dendritic cable modeled as a linear time-invariant spatially discretized system with sealed-end boundaries. Starting from the linear passive cable equation and a standard finite-difference spatial discretization, the state vector $v(t) \\in \\mathbb{R}^n$ of compartment voltages satisfies the Ordinary Differential Equation (ODE) $dv/dt = A v(t) + B u(t)$, where $A \\in \\mathbb{R}^{n \\times n}$ is the system matrix derived from the leak and axial coupling, $B \\in \\mathbb{R}^{n \\times p}$ maps input currents at $p$ injection sites to compartments, and $u(t) \\in \\mathbb{R}^p$ is the time-varying input current vector. The sealed-end Laplacian with Neumann boundary conditions is defined by the tridiagonal matrix $L \\in \\mathbb{R}^{n \\times n}$ with entries $L_{0,0} = -1$, $L_{0,1} = 1$, $L_{i,i} = -2$, $L_{i,i-1} = 1$, $L_{i,i+1} = 1$ for $i \\in \\{1,\\dots,n-2\\}$, $L_{n-1,n-2} = 1$, $L_{n-1,n-1} = -1$. The system matrix is $A = -\\alpha I_n + \\beta L$, with $I_n$ the $n \\times n$ identity, leak parameter $\\alpha > 0$, and axial coupling parameter $\\beta > 0$. The input mapping $B$ has columns that are standard basis vectors corresponding to injection sites. The input library consists of $m$ time-localized Gaussian pulses at the $p$ injection channels. For library index $\\ell \\in \\{1,\\dots,m\\}$, channel index $j \\in \\{1,\\dots,p\\}$, time grid $t_k = k \\,\\Delta t$ for $k \\in \\{0,1,\\dots,K-1\\}$ with $K = \\lfloor T/\\Delta t \\rfloor$, pulse amplitude $a_{\\ell,j} = 0.3 + 0.7 \\,\\lvert \\sin(0.37 \\ell + 0.91 j) \\rvert$, center time $\\tau_{\\ell,j} = 0.1 T + 0.7 T \\, \\frac{\\ell}{m+1} + 0.05 T \\, \\frac{j}{p+1}$, and width $\\sigma > 0$, define the input as $u_j^{(\\ell)}(t_k) = a_{\\ell,j} \\exp\\!\\left(-\\frac{1}{2}\\left(\\frac{t_k - \\tau_{\\ell,j}}{\\sigma}\\right)^2\\right)$. Use the explicit Euler scheme for time stepping: $v_{k+1} = v_k + \\Delta t \\left( A v_k + B u^{(\\ell)}(t_k) \\right)$, with $v_0 = 0$.\n\nYou must construct the Proper Orthogonal Decomposition (POD) from the snapshot matrix of dendritic voltage responses to the entire input library and derive the Galerkin-reduced model. Specifically:\n\n- Form the snapshot matrix $S \\in \\mathbb{R}^{n \\times L}$ by concatenating all time states $v_k^{(\\ell)}$ for all library inputs $\\ell$ and times $k$, where $L = m K$.\n- Compute the Singular Value Decomposition (SVD), $S = U \\Sigma V^\\top$, with orthonormal $U \\in \\mathbb{R}^{n \\times r_{\\max}}$, singular values in $\\Sigma$, and orthonormal $V \\in \\mathbb{R}^{L \\times r_{\\max}}$, where $r_{\\max} = \\min(n,L)$.\n- Given an energy threshold $\\eta \\in (0,1)$, choose the smallest $r$ such that $\\sum_{i=1}^r \\sigma_i^2 / \\sum_{i=1}^{r_{\\max}} \\sigma_i^2 \\ge \\eta$, where $\\sigma_i$ are the singular values (the diagonal entries of $\\Sigma$).\n- Define the Reduced Order Model (ROM) subspace by the first $r$ left singular vectors $U_r \\in \\mathbb{R}^{n \\times r}$. Construct the Galerkin-projected matrices $A_r = U_r^\\top A U_r \\in \\mathbb{R}^{r \\times r}$ and $B_r = U_r^\\top B \\in \\mathbb{R}^{r \\times p}$.\n- Estimate the truncation error by two metrics: the neglected energy fraction $E_{\\text{loss}} = 1 - \\frac{\\sum_{i=1}^r \\sigma_i^2}{\\sum_{i=1}^{r_{\\max}} \\sigma_i^2}$ and the relative projection residual $\\varepsilon_{\\text{proj}} = \\frac{\\lVert S - U_r U_r^\\top S \\rVert_F}{\\lVert S \\rVert_F}$, where $\\lVert \\cdot \\rVert_F$ denotes the Frobenius norm.\n- Additionally, compute a dynamical reconstruction error by simulating the reduced dynamics $x_{k+1} = x_k + \\Delta t \\left( A_r x_k + B_r u^{(\\ell)}(t_k) \\right)$ with $x_0 = 0$ for each input in the library, reconstructing $\\hat{v}_k^{(\\ell)} = U_r x_k$, and forming $\\varepsilon_{\\text{rom}} = \\frac{\\sqrt{\\sum_{\\ell=1}^m \\sum_{k=0}^{K-1} \\lVert v_k^{(\\ell)} - \\hat{v}_k^{(\\ell)} \\rVert_2^2}}{\\sqrt{\\sum_{\\ell=1}^m \\sum_{k=0}^{K-1} \\lVert v_k^{(\\ell)} \\rVert_2^2}}$.\n\nAll quantities are dimensionless in this formulation; do not report any physical units. Angles inside trigonometric functions are in radians. The final outputs must be numerical values.\n\nYour program must implement the above pipeline and solve the following test suite. For each test, use the given parameters to construct $A$, $B$, generate the input library and snapshots, compute the POD, derive the Galerkin ROM, and evaluate $r$, $E_{\\text{loss}}$, $\\varepsilon_{\\text{proj}}$, and $\\varepsilon_{\\text{rom}}$.\n\nTest suite (each test case is a tuple specifying $(n, \\Delta t, T, \\alpha, \\beta, \\text{injection indices}, m, \\sigma, \\eta)$):\n\n- Test $1$: $(20, 0.0005, 0.12, 1.0, 12.0, [0, 19], 5, 0.01, 0.95)$.\n- Test $2$: $(30, 0.0010, 0.20, 0.5, 8.0, [0, 14, 29], 4, 0.015, 0.99)$.\n- Test $3$: $(15, 0.0005, 0.05, 2.0, 20.0, [7], 3, 0.005, 0.90)$.\n- Test $4$: $(25, 0.0020, 0.20, 0.2, 2.0, [7, 17], 6, 0.02, 0.50)$.\n\nYour program should produce a single line of output containing the results for all tests as a comma-separated list enclosed in square brackets, where each test result is an inner list $[r, E_{\\text{loss}}, \\varepsilon_{\\text{proj}}, \\varepsilon_{\\text{rom}}]$ in this exact order. For example, the output format must be of the form $[[r_1,E_{\\text{loss},1},\\varepsilon_{\\text{proj},1},\\varepsilon_{\\text{rom},1}],[r_2,E_{\\text{loss},2},\\varepsilon_{\\text{proj},2},\\varepsilon_{\\text{rom},2}],\\dots]$ with no additional text.",
            "solution": "The problem requires the implementation of a standard model reduction pipeline for a linear time-invariant (LTI) system, specifically a discretized model of a passive dendritic cable. The pipeline involves Proper Orthogonal Decomposition (POD) and Galerkin projection. The objective is to construct a reduced-order model (ROM) from simulation data and evaluate its accuracy using several defined metrics.\n\nThe validation process confirms that the problem is scientifically grounded, well-posed, and objective. It describes a standard application of model reduction in computational neuroscience, providing all necessary definitions, parameters, and evaluation criteria. There are no contradictions, ambiguities, or scientific flaws. Therefore, we proceed with the solution.\n\nThe solution is developed in five sequential steps:\n1.  **Full-Order Model (FOM) Formulation and Data Generation**: We first construct the FOM, which is a system of linear Ordinary Differential Equations (ODEs) describing the dynamics of compartment voltages.\n2.  **Proper Orthogonal Decomposition (POD)**: We use the simulation data to find an optimal low-dimensional basis for the system's dynamics.\n3.  **Reduced-Order Model (ROM) Construction**: We create the ROM by projecting the FOM onto the low-dimensional POD basis.\n4.  **ROM Simulation and State Reconstruction**: We simulate the computationally cheaper ROM.\n5.  **Error Evaluation**: We quantify the accuracy of the ROM by comparing it against the FOM.\n\n### 1. Full-Order Model (FOM) Formulation and Data Generation\nThe state of the system, representing the voltages in $n$ discrete compartments, is given by the vector $v(t) \\in \\mathbb{R}^n$. Its dynamics are governed by the LTI system:\n$$\n\\frac{dv}{dt} = A v(t) + B u(t)\n$$\nThe system matrix $A \\in \\mathbb{R}^{n \\times n}$ is defined as $A = -\\alpha I_n + \\beta L$, where $\\alpha > 0$ is the leak parameter, $\\beta > 0$ is the axial coupling parameter, $I_n$ is the $n \\times n$ identity matrix, and $L \\in \\mathbb{R}^{n \\times n}$ is the discrete Laplacian matrix for a one-dimensional cable with sealed-end (Neumann) boundary conditions. The matrix $L$ is a symmetric tridiagonal matrix with entries:\n-   $L_{i,i} = -2$ for $i \\in \\{1, \\dots, n-2\\}$, and $L_{0,0} = L_{n-1,n-1} = -1$.\n-   $L_{i, i+1} = L_{i+1, i} = 1$ for $i \\in \\{0, \\dots, n-2\\}$.\n-   All other entries are $0$.\n\nThe input matrix $B \\in \\mathbb{R}^{n \\times p}$ maps the $p$ external input currents to their respective injection compartments. Its columns are standard basis vectors, $(B)_{ij} = 1$ if the $j$-th input channel injects into the $i$-th compartment, and $0$ otherwise.\n\nThe input library consists of $m$ distinct stimuli. Each stimulus is a set of $p$ time-varying Gaussian current pulses. For the $\\ell$-th library input ($\\ell \\in \\{1,\\dots,m\\}$) and $j$-th channel ($j \\in \\{1,\\dots,p\\}$), the input current over a discrete time grid $t_k = k \\Delta t$ is:\n$$\nu_j^{(\\ell)}(t_k) = a_{\\ell,j} \\exp\\left(-\\frac{1}{2}\\left(\\frac{t_k - \\tau_{\\ell,j}}{\\sigma}\\right)^2\\right)\n$$\nwith amplitude $a_{\\ell,j} = 0.3 + 0.7 |\\sin(0.37 \\ell + 0.91 j)|$ and center time $\\tau_{\\ell,j} = 0.1 T + 0.7 T \\frac{\\ell}{m+1} + 0.05 T \\frac{j}{p+1}$.\n\nStarting from the initial condition $v(0) = 0$, we simulate the FOM for each of the $m$ library inputs using the explicit Euler method with a time step $\\Delta t$:\n$$\nv_{k+1}^{(\\ell)} = v_k^{(\\ell)} + \\Delta t \\left( A v_k^{(\\ell)} + B u^{(\\ell)}(t_k) \\right)\n$$\nfor $k = 0, 1, \\dots, K-1$, where $K = \\lfloor T/\\Delta t \\rfloor$. The resulting state vectors $v_1^{(\\ell)}, v_2^{(\\ell)}, \\dots, v_K^{(\\ell)}$ for all $\\ell \\in \\{1, \\dots, m\\}$ are collected. These vectors, called snapshots, are concatenated column-wise to form the snapshot matrix $S \\in \\mathbb{R}^{n \\times L}$, where $L = mK$.\n\n### 2. Proper Orthogonal Decomposition (POD)\nThe core of POD is to find an orthogonal basis that optimally represents the snapshots in $S$. This is achieved by computing the Singular Value Decomposition (SVD) of the snapshot matrix:\n$$\nS = U \\Sigma V^\\top\n$$\nwhere $U \\in \\mathbb{R}^{n \\times r_{\\max}}$ has orthonormal columns (the left singular vectors or POD modes), $\\Sigma \\in \\mathbb{R}^{r_{\\max} \\times r_{\\max}}$ is a diagonal matrix of non-negative singular values $\\sigma_i$ in descending order, $V \\in \\mathbb{R}^{L \\times r_{\\max}}$ has orthonormal columns, and $r_{\\max} = \\min(n, L)$. The columns of $U$ form the POD basis.\n\nThe \"energy\" of each mode is proportional to the square of its corresponding singular value, $\\sigma_i^2$. To create a low-dimensional approximation, we select the first $r$ modes that capture a specified fraction $\\eta$ of the total energy. The reduced order $r$ is the smallest integer such that:\n$$\n\\frac{\\sum_{i=1}^r \\sigma_i^2}{\\sum_{i=1}^{r_{\\max}} \\sigma_i^2} \\ge \\eta\n$$\n\n### 3. Reduced-Order Model (ROM) Construction\nThe FOM state $v(t)$ is approximated by a linear combination of the first $r$ POD modes: $v(t) \\approx U_r x(t)$, where $U_r \\in \\mathbb{R}^{n \\times r}$ contains the first $r$ columns of $U$, and $x(t) \\in \\mathbb{R}^r$ is the vector of reduced state coordinates.\n\nSubstituting this approximation into the FOM equation and applying Galerkin projection (projecting the equation onto the subspace spanned by $U_r$ by left-multiplying with $U_r^\\top$) yields the ROM:\n$$\n\\frac{dx}{dt} = (U_r^\\top A U_r) x(t) + (U_r^\\top B) u(t)\n$$\nThis gives the reduced system dynamics $dx/dt = A_r x(t) + B_r u(t)$, with the much smaller matrices $A_r = U_r^\\top A U_r \\in \\mathbb{R}^{r \\times r}$ and $B_r = U_r^\\top B \\in \\mathbb{R}^{r \\times p}$.\n\n### 4. ROM Simulation and State Reconstruction\nThe reduced dynamics are simulated using the same explicit Euler scheme, with initial condition $x_0 = U_r^\\top v_0 = 0$:\n$$\nx_{k+1} = x_k + \\Delta t (A_r x_k + B_r u^{(\\ell)}(t_k))\n$$\nFor each time step, the full-dimensional state can be approximated by reconstructing from the reduced state: $\\hat{v}_{k+1}^{(\\ell)} = U_r x_{k+1}$.\n\n### 5. Error Evaluation\nThe accuracy of the reduction is assessed using three metrics:\n1.  **Neglected Energy Fraction ($E_{\\text{loss}}$)**: This measures the fraction of energy (variance) from the original snapshots that is not captured by the $r$ selected modes.\n    $$\n    E_{\\text{loss}} = 1 - \\frac{\\sum_{i=1}^r \\sigma_i^2}{\\sum_{i=1}^{r_{\\max}} \\sigma_i^2}\n    $$\n2.  **Relative Projection Residual ($\\varepsilon_{\\text{proj}}$)**: This quantifies the error of projecting the original snapshots onto the POD subspace and then reconstructing them. It is defined as $\\varepsilon_{\\text{proj}} = \\frac{\\lVert S - U_r U_r^\\top S \\rVert_F}{\\lVert S \\rVert_F}$, where $\\lVert \\cdot \\rVert_F$ is the Frobenius norm. Using the properties of the SVD, this simplifies to:\n    $$\n    \\varepsilon_{\\text{proj}} = \\sqrt{\\frac{\\sum_{i=r+1}^{r_{\\max}} \\sigma_i^2}{\\sum_{i=1}^{r_{\\max}} \\sigma_i^2}} = \\sqrt{E_{\\text{loss}}}\n    $$\n3.  **Dynamical Reconstruction Error ($\\varepsilon_{\\text{rom}}$)**: This is the most comprehensive metric, measuring the normalized root-mean-square error between the true FOM trajectories and the trajectories generated by simulating the ROM. It is calculated over all library inputs and all time steps.\n    $$\n    \\varepsilon_{\\text{rom}} = \\frac{\\sqrt{\\sum_{\\ell=1}^m \\sum_{k=1}^{K} \\lVert v_k^{(\\ell)} - \\hat{v}_k^{(\\ell)} \\rVert_2^2}}{\\sqrt{\\sum_{\\ell=1}^m \\sum_{k=1}^{K} \\lVert v_k^{(\\ell)} \\rVert_2^2}}\n    $$\n    This metric directly evaluates how well the ROM's dynamics approximate the FOM's dynamics.\n\nThe implementation will now follow these steps for each test case provided.",
            "answer": "```python\nimport numpy as np\n\ndef run_case(n, dt, T, alpha, beta, inj_indices, m, sigma, eta):\n    \"\"\"\n    Runs a single test case for the POD-Galerkin model reduction.\n    \"\"\"\n    # 1. Setup and Model Construction\n    p = len(inj_indices)\n    K = int(T / dt)\n    time_grid = np.arange(K) * dt\n\n    # Construct Laplacian matrix L for sealed-end (Neumann) BCs\n    L = np.diag(np.ones(n - 1), 1) + np.diag(np.ones(n - 1), -1) - 2 * np.eye(n)\n    L[0, 0] = -1.0\n    L[n - 1, n - 1] = -1.0\n    \n    # Construct full-order system matrices A and B\n    A = -alpha * np.eye(n) + beta * L\n    B = np.zeros((n, p))\n    for j_idx, i_comp in enumerate(inj_indices):\n        B[i_comp, j_idx] = 1.0\n\n    # 2. Generate Input Library and Snapshots from FOM\n    fom_trajectories = []\n    snapshot_list = []\n\n    for l_idx in range(m):\n        ell = l_idx + 1\n        \n        # Generate input signal u(t) for this library entry\n        u_input = np.zeros((K, p))\n        for j_idx in range(p):\n            j = j_idx + 1\n            a_lj = 0.3 + 0.7 * np.abs(np.sin(0.37 * ell + 0.91 * j))\n            tau_lj = 0.1 * T + 0.7 * T * (ell / (m + 1)) + 0.05 * T * (j / (p + 1))\n            u_input[:, j_idx] = a_lj * np.exp(-0.5 * ((time_grid - tau_lj) / sigma)**2)\n\n        # Simulate FOM using Explicit Euler\n        v = np.zeros(n)\n        current_trajectory = []\n        for k in range(K):\n            u_k = u_input[k, :]\n            v = v + dt * (A @ v + B @ u_k)\n            snapshot_list.append(v)\n            current_trajectory.append(v)\n        fom_trajectories.append(np.array(current_trajectory))\n\n    S = np.array(snapshot_list).T\n    \n    # 3. Perform SVD and Determine Reduced Order r\n    U, s, Vh = np.linalg.svd(S, full_matrices=False)\n    s_sq = s**2\n    total_energy = np.sum(s_sq)\n    \n    r = 0\n    if total_energy > 0:\n        cum_energy_frac = np.cumsum(s_sq) / total_energy\n        # Find smallest r such that cumulative energy >= eta\n        r = np.searchsorted(cum_energy_frac, eta, side='left') + 1\n    else: # Handle zero snapshot matrix case\n        r = 1\n\n    # 4. Calculate Static Error Metrics\n    energy_at_r = np.sum(s_sq[:r])\n    E_loss = 1.0 - energy_at_r / total_energy if total_energy > 0 else 1.0\n    eps_proj = np.sqrt(E_loss)\n\n    # 5. Construct and Simulate ROM\n    Ur = U[:, :r]\n    Ar = Ur.T @ A @ Ur\n    Br = Ur.T @ B\n    \n    sum_sq_err = 0.0\n    sum_sq_norm_v = 0.0\n\n    for l_idx in range(m):\n        ell = l_idx + 1\n        v_fom_traj = fom_trajectories[l_idx]\n        \n        u_input = np.zeros((K, p))\n        for j_idx in range(p):\n            j = j_idx + 1\n            a_lj = 0.3 + 0.7 * np.abs(np.sin(0.37 * ell + 0.91 * j))\n            tau_lj = 0.1 * T + 0.7 * T * (ell / (m + 1)) + 0.05 * T * (j / (p + 1))\n            u_input[:, j_idx] = a_lj * np.exp(-0.5 * ((time_grid - tau_lj) / sigma)**2)\n            \n        x = np.zeros(r)\n        \n        for k in range(K):\n            # Simulate ROM for one step\n            u_k = u_input[k, :]\n            x = x + dt * (Ar @ x + Br @ u_k)\n            # Reconstruct full state from ROM state\n            v_hat = Ur @ x\n            \n            # Get corresponding FOM state\n            v_fom = v_fom_traj[k]\n            \n            # Accumulate errors\n            sum_sq_err += np.sum((v_fom - v_hat)**2)\n            sum_sq_norm_v += np.sum(v_fom**2)\n\n    # 6. Calculate Dynamical Reconstruction Error\n    eps_rom = np.sqrt(sum_sq_err / sum_sq_norm_v) if sum_sq_norm_v > 0 else 0.0\n    \n    return [int(r), E_loss, eps_proj, eps_rom]\n\ndef solve():\n    # Test suite from the problem statement\n    test_cases = [\n        (20, 0.0005, 0.12, 1.0, 12.0, [0, 19], 5, 0.01, 0.95),\n        (30, 0.0010, 0.20, 0.5, 8.0, [0, 14, 29], 4, 0.015, 0.99),\n        (15, 0.0005, 0.05, 2.0, 20.0, [7], 3, 0.005, 0.90),\n        (25, 0.0020, 0.20, 0.2, 2.0, [7, 17], 6, 0.02, 0.50),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_case(*case)\n        results.append(result)\n\n    # Format the output as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While highly simplified models like the Leaky Integrate-and-Fire (LIF) neuron are computationally efficient, their basic forms often lack key biophysical features such as spike-frequency adaptation. To make these models useful for realistic network simulations, we must carefully calibrate their parameters to reproduce specific, biologically relevant phenomena. This problem focuses on exactly this process of biophysical grounding . You will augment an LIF model with an adaptation current and then derive a precise calibration rule that forces the model to exhibit a desired absolute refractory period, learning how to systematically imbue simplified models with critical dynamical properties.",
            "id": "3965661",
            "problem": "You are given a biophysically grounded reduction of a membrane equation with spike-triggered adaptation for a single-compartment neuron. The base dynamics follow the capacitor law of a membrane with ohmic leak and an auxiliary adaptation current. The state variables are the membrane potential $V(t)$ and the adaptation current $w(t)$. The Leaky Integrate-and-Fire (LIF) model with spike-triggered adaptation is defined by the differential equations\n$$\nC \\frac{dV}{dt} = - g_L \\big(V(t) - E_L \\big) - w(t) + I(t),\n$$\n$$\n\\tau_w \\frac{dw}{dt} = - w(t), \\quad \\text{for subthreshold evolution,}\n$$\nand the spike/reset rule\n$$\n\\text{if } V(t^-) \\ge V_{\\mathrm{th}}, \\quad V(t^+) \\leftarrow V_r, \\quad w(t^+) \\leftarrow w(t^-) + b,\n$$\nwhere $C$ is the membrane capacitance, $g_L$ is the leak conductance, $E_L$ is the leak reversal potential, $I(t)$ is the input current, $\\tau_w$ is the adaptation time constant, $V_{\\mathrm{th}}$ is the threshold voltage, $V_r$ is the reset voltage, and $b$ is a spike-triggered jump in the adaptation current. The reset rule models the biophysical entry of spike-triggered potassium-like currents as a jump in an auxiliary variable.\n\nStarting from the capacitor law and the linear subthreshold dynamics, derive an explicit calibration for $b$ so that, under a constant input $I(t) = I_0$ and immediately after a spike/reset at time $t = 0$ with $V(0) = V_r$ and $w(0) = w_0^+$, the time to the next threshold crossing equals a prescribed absolute refractory period $T_{\\mathrm{ref}}$. Assume that between spikes the adaptation current follows the given exponential decay and that the only spike-triggered effect is the jump $b$, so $w_0^+ = b$ if the pre-spike residual adaptation is zero. Show how to compute $b$ from the requirement $V(T_{\\mathrm{ref}}) = V_{\\mathrm{th}}$, and handle the special case $\\tau_w = \\tau_m$ where $\\tau_m = C/g_L$ is the membrane time constant.\n\nYour program must implement the closed-form calibration rule derived from first principles and apply it to the following test suite. Use the specified physical units exactly:\n- Capacitance $C$ in $\\mathrm{F}$.\n- Conductance $g_L$ in $\\mathrm{S}$.\n- Voltages $E_L$, $V_{\\mathrm{th}}$, $V_r$ in $\\mathrm{V}$.\n- Currents $I_0$ and the spike-triggered jump $b$ in $\\mathrm{A}$.\n- Time constants $\\tau_w$, $\\tau_m$ and absolute refractory period $T_{\\mathrm{ref}}$ in $\\mathrm{s}$.\n\nIf the calibration formula yields a negative $b$, set $b$ to $0$ because a negative spike-triggered adaptation jump is biophysically implausible in this context. Angles are not involved in this problem. Express the final answers for $b$ as floats in amperes.\n\nDerivation base and constraints:\n- Begin from the capacitor law and linear leak current definition.\n- Treat $w(t)$ as an auxiliary current with spike-triggered jump and exponential decay.\n- Do not assume or use any target formulas beyond these fundamentals.\n\nFor a constant input $I(t) = I_0$, consider the post-reset subthreshold solution and compute the value of $b$ that makes $V(T_{\\mathrm{ref}}) = V_{\\mathrm{th}}$. Handle both the generic case $\\tau_w \\ne \\tau_m$ and the limiting case $\\tau_w = \\tau_m$.\n\nTest suite parameter sets (each bullet defines one case):\n- Case A (generic, positive calibration): $C = 2\\times 10^{-10}\\,\\mathrm{F}$, $g_L = 1\\times 10^{-8}\\,\\mathrm{S}$, $E_L = -7.0\\times 10^{-2}\\,\\mathrm{V}$, $V_{\\mathrm{th}} = -5.0\\times 10^{-2}\\,\\mathrm{V}$, $V_r = -6.5\\times 10^{-2}\\,\\mathrm{V}$, $I_0 = 1.0\\times 10^{-9}\\,\\mathrm{A}$, $\\tau_w = 5.0\\times 10^{-2}\\,\\mathrm{s}$, $T_{\\mathrm{ref}} = 5.0\\times 10^{-3}\\,\\mathrm{s}$.\n- Case B (boundary, equal time constants): $C = 2\\times 10^{-10}\\,\\mathrm{F}$, $g_L = 1\\times 10^{-8}\\,\\mathrm{S}$, $E_L = -7.0\\times 10^{-2}\\,\\mathrm{V}$, $V_{\\mathrm{th}} = -5.0\\times 10^{-2}\\,\\mathrm{V}$, $V_r = -6.5\\times 10^{-2}\\,\\mathrm{V}$, $I_0 = 1.2\\times 10^{-9}\\,\\mathrm{A}$, $\\tau_w = 2.0\\times 10^{-2}\\,\\mathrm{s}$, $T_{\\mathrm{ref}} = 5.0\\times 10^{-3}\\,\\mathrm{s}$.\n- Case C (edge, clamped to zero): $C = 2\\times 10^{-10}\\,\\mathrm{F}$, $g_L = 1\\times 10^{-8}\\,\\mathrm{S}$, $E_L = -7.0\\times 10^{-2}\\,\\mathrm{V}$, $V_{\\mathrm{th}} = -5.0\\times 10^{-2}\\,\\mathrm{V}$, $V_r = -6.5\\times 10^{-2}\\,\\mathrm{V}$, $I_0 = 4.0\\times 10^{-10}\\,\\mathrm{A}$, $\\tau_w = 5.0\\times 10^{-2}\\,\\mathrm{s}$, $T_{\\mathrm{ref}} = 5.0\\times 10^{-3}\\,\\mathrm{s}$.\n- Case D (generic, slow adaptation): $C = 2\\times 10^{-10}\\,\\mathrm{F}$, $g_L = 1\\times 10^{-8}\\,\\mathrm{S}$, $E_L = -7.0\\times 10^{-2}\\,\\mathrm{V}$, $V_{\\mathrm{th}} = -5.0\\times 10^{-2}\\,\\mathrm{V}$, $V_r = -6.5\\times 10^{-2}\\,\\mathrm{V}$, $I_0 = 9.0\\times 10^{-10}\\,\\mathrm{A}$, $\\tau_w = 5.0\\times 10^{-1}\\,\\mathrm{s}$, $T_{\\mathrm{ref}} = 5.0\\times 10^{-3}\\,\\mathrm{s}$.\n\nYour program should produce a single line of output containing the calibrated spike-triggered adaptation jumps $b$ for the four cases, in amperes, as a comma-separated list enclosed in square brackets (for example, [$b_A, b_B, b_C, b_D$]). The values must be floats in $\\mathrm{A}$, with no units shown in the output string.",
            "solution": "The problem is valid as it is scientifically grounded in established biophysical modeling principles, is well-posed with a complete and consistent set of parameters, and is expressed in objective, formalizable language. We will proceed to derive the closed-form calibration for the spike-triggered adaptation jump, $b$.\n\nThe objective is to find the value of the adaptation jump parameter $b$ such that the membrane potential $V(t)$ reaches the threshold $V_{\\mathrm{th}}$ at a specified time $T_{\\mathrm{ref}}$ after a spike. The neuron's state is described by two coupled ordinary differential equations for the membrane potential $V(t)$ and the adaptation current $w(t)$.\n\nFor the subthreshold dynamics, the governing equations are:\n$$\nC \\frac{dV}{dt} = - g_L \\big(V(t) - E_L \\big) - w(t) + I_0\n$$\n$$\n\\tau_w \\frac{dw}{dt} = - w(t)\n$$\nThe problem specifies that immediately following a spike at time $t=0$, the state is reset to $V(0) = V_r$ and $w(0) = w(0^-) + b$. We are to calibrate $b$ assuming the pre-spike residual adaptation is zero, i.e., $w(0^-) = 0$. Therefore, the initial condition for the adaptation current for the interspike interval is $w(0) = b$.\n\nFirst, we solve the differential equation for the adaptation current $w(t)$ with the initial condition $w(0)=b$. This is a first-order linear homogeneous ODE with a straightforward exponential decay solution:\n$$\nw(t) = b \\, e^{-t/\\tau_w}\n$$\nNext, we substitute this expression for $w(t)$ into the equation for the membrane potential $V(t)$:\n$$\nC \\frac{dV}{dt} = - g_L (V(t) - E_L) - b \\, e^{-t/\\tau_w} + I_0\n$$\nTo standardize this equation, we divide by the leak conductance $g_L$ and introduce the membrane time constant $\\tau_m = C/g_L$.\n$$\n\\frac{C}{g_L} \\frac{dV}{dt} = - (V(t) - E_L) - \\frac{b}{g_L} e^{-t/\\tau_w} + \\frac{I_0}{g_L}\n$$\n$$\n\\tau_m \\frac{dV}{dt} + V(t) = E_L + \\frac{I_0}{g_L} - \\frac{b}{g_L} e^{-t/\\tau_w}\n$$\nThis is a first-order linear non-homogeneous ODE for $V(t)$. The solution depends on whether the membrane time constant $\\tau_m$ is equal to the adaptation time constant $\\tau_w$. We must consider both cases. Let's define the steady-state voltage in the absence of adaptation as $V_\\infty = E_L + I_0/g_L$. The equation becomes:\n$$\n\\frac{dV}{dt} + \\frac{1}{\\tau_m}V(t) = \\frac{V_\\infty}{\\tau_m} - \\frac{b}{C} e^{-t/\\tau_w}\n$$\n\n**Case 1: Generic case ($\\tau_w \\ne \\tau_m$)**\nWe solve the ODE using an integrating factor $I(t) = e^{\\int (1/\\tau_m) dt} = e^{t/\\tau_m}$. The solution is:\n$$\nV(t)e^{t/\\tau_m} = \\int \\left( \\frac{V_\\infty}{\\tau_m} - \\frac{b}{C} e^{-t/\\tau_w} \\right) e^{t/\\tau_m} dt + K\n$$\n$$\nV(t)e^{t/\\tau_m} = \\frac{V_\\infty}{\\tau_m} \\int e^{t/\\tau_m} dt - \\frac{b}{C} \\int e^{t(1/\\tau_m - 1/\\tau_w)} dt + K\n$$\n$$\nV(t)e^{t/\\tau_m} = V_\\infty e^{t/\\tau_m} - \\frac{b}{C} \\frac{1}{1/\\tau_m - 1/\\tau_w} e^{t(1/\\tau_m - 1/\\tau_w)} + K\n$$\nMultiplying by $e^{-t/\\tau_m}$ gives the general solution for $V(t)$:\n$$\nV(t) = V_\\infty - \\frac{b}{C} \\frac{\\tau_m \\tau_w}{\\tau_w - \\tau_m} e^{-t/\\tau_w} + K e^{-t/\\tau_m}\n$$\nWe find the integration constant $K$ using the initial condition $V(0) = V_r$:\n$$\nV_r = V_\\infty - \\frac{b}{C} \\frac{\\tau_m \\tau_w}{\\tau_w - \\tau_m} + K \\implies K = V_r - V_\\infty + \\frac{b}{C} \\frac{\\tau_m \\tau_w}{\\tau_w - \\tau_m}\n$$\nSubstituting $K$ back and rearranging terms:\n$$\nV(t) = V_\\infty + (V_r - V_\\infty)e^{-t/\\tau_m} - \\frac{b}{C} \\frac{\\tau_m \\tau_w}{\\tau_w - \\tau_m} (e^{-t/\\tau_w} - e^{-t/\\tau_m})\n$$\nUsing $\\tau_m/C = (C/g_L)/C = 1/g_L$, this can be written as:\n$$\nV(t) = V_\\infty + (V_r - V_\\infty)e^{-t/\\tau_m} - \\frac{b \\tau_w}{g_L(\\tau_w - \\tau_m)} (e^{-t/\\tau_w} - e^{-t/\\tau_m})\n$$\nTo find $b$, we impose the condition $V(T_{\\mathrm{ref}}) = V_{\\mathrm{th}}$:\n$$\nV_{\\mathrm{th}} = V_\\infty + (V_r - V_\\infty)e^{-T_{\\mathrm{ref}}/\\tau_m} - \\frac{b \\tau_w}{g_L(\\tau_w - \\tau_m)} (e^{-T_{\\mathrm{ref}}/\\tau_w} - e^{-T_{\\mathrm{ref}}/\\tau_m})\n$$\nLet $V_{\\mathrm{no-adapt}}(t) = V_\\infty + (V_r - V_\\infty)e^{-t/\\tau_m}$ be the voltage trajectory without adaptation ($b=0$). Rearranging for $b$:\n$$\n\\frac{b \\tau_w}{g_L(\\tau_w - \\tau_m)} (e^{-T_{\\mathrm{ref}}/\\tau_w} - e^{-T_{\\mathrm{ref}}/\\tau_m}) = V_{\\mathrm{no-adapt}}(T_{\\mathrm{ref}}) - V_{\\mathrm{th}}\n$$\n$$\nb = \\frac{g_L(\\tau_w - \\tau_m)}{\\tau_w(e^{-T_{\\mathrm{ref}}/\\tau_w} - e^{-T_{\\mathrm{ref}}/\\tau_m})} \\Big[ V_\\infty(1 - e^{-T_{\\mathrm{ref}}/\\tau_m}) + V_r e^{-T_{\\mathrm{ref}}/\\tau_m} - V_{\\mathrm{th}} \\Big]\n$$\n\n**Case 2: Special case ($\\tau_w = \\tau_m = \\tau$)**\nWhen the time constants are equal, the ODE for $V(t)$ exhibits a resonance:\n$$\n\\frac{dV}{dt} + \\frac{1}{\\tau}V(t) = \\frac{V_\\infty}{\\tau} - \\frac{b}{C} e^{-t/\\tau}\n$$\nUsing the integrating factor $e^{t/\\tau}$:\n$$\nV(t)e^{t/\\tau} = \\int \\left( \\frac{V_\\infty}{\\tau} - \\frac{b}{C} e^{-t/\\tau} \\right) e^{t/\\tau} dt + K\n$$\n$$\nV(t)e^{t/\\tau} = \\int \\frac{V_\\infty}{\\tau} e^{t/\\tau} dt - \\int \\frac{b}{C} dt + K\n$$\n$$\nV(t)e^{t/\\tau} = V_\\infty e^{t/\\tau} - \\frac{b}{C}t + K\n$$\nThe general solution for $V(t)$ is:\n$$\nV(t) = V_\\infty - \\frac{b t}{C} e^{-t/\\tau} + K e^{-t/\\tau}\n$$\nUsing the initial condition $V(0) = V_r$:\n$$\nV_r = V_\\infty + K \\implies K = V_r - V_\\infty\n$$\nSubstituting $K$ back:\n$$\nV(t) = V_\\infty + (V_r - V_\\infty)e^{-t/\\tau} - \\frac{b t}{C}e^{-t/\\tau}\n$$\nWe impose the condition $V(T_{\\mathrm{ref}}) = V_{\\mathrm{th}}$:\n$$\nV_{\\mathrm{th}} = V_\\infty + (V_r - V_\\infty)e^{-T_{\\mathrm{ref}}/\\tau} - \\frac{b T_{\\mathrm{ref}}}{C}e^{-T_{\\mathrm{ref}}/\\tau}\n$$\nRearranging to solve for $b$:\n$$\n\\frac{b T_{\\mathrm{ref}}}{C}e^{-T_{\\mathrm{ref}}/\\tau} = V_\\infty + (V_r - V_\\infty)e^{-T_{\\mathrm{ref}}/\\tau} - V_{\\mathrm{th}}\n$$\n$$\nb = \\frac{C}{T_{\\mathrm{ref}}e^{-T_{\\mathrm{ref}}/\\tau}} \\Big[ V_\\infty(1 - e^{-T_{\\mathrm{ref}}/\\tau}) + V_r e^{-T_{\\mathrm{ref}}/\\tau} - V_{\\mathrm{th}} \\Big]\n$$\n\n**Final Calibration Rule**\nThe calibration procedure is as follows:\n1.  Calculate membrane time constant $\\tau_m = C/g_L$ and steady-state voltage $V_\\infty = E_L + I_0/g_L$.\n2.  Calculate the voltage at $T_{\\mathrm{ref}}$ in the absence of adaptation: $V_{\\mathrm{no-adapt}}(T_{\\mathrm{ref}}) = V_\\infty(1 - e^{-T_{\\mathrm{ref}}/\\tau_m}) + V_r e^{-T_{\\mathrm{ref}}/\\tau_m}$.\n3.  Calculate the required voltage suppression: $\\Delta V = V_{\\mathrm{no-adapt}}(T_{\\mathrm{ref}}) - V_{\\mathrm{th}}$. If $\\Delta V \\le 0$, no adaptation is needed, so $b = 0$.\n4.  If $\\Delta V > 0$, calculate $b$:\n    - If $\\tau_w \\ne \\tau_m$: \n      $$ b = \\frac{g_L(\\tau_w - \\tau_m)}{\\tau_w(e^{-T_{\\mathrm{ref}}/\\tau_w} - e^{-T_{\\mathrm{ref}}/\\tau_m})} \\Delta V $$\n    - If $\\tau_w = \\tau_m = \\tau$:\n      $$ b = \\frac{C}{T_{\\mathrm{ref}}e^{-T_{\\mathrm{ref}}/\\tau}} \\Delta V $$\n5.  In accordance with the problem statement, as a negative $b$ is biophysically implausible in this context, the final value of $b$ is clamped at zero: $b_{\\mathrm{final}} = \\max(0, b)$. This is consistent with step $3$, as the pre-factors in the expressions for $b$ are positive.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the spike-triggered adaptation jump 'b' for a set of test cases\n    based on a leaky integrate-and-fire model with adaptation.\n    \"\"\"\n\n    # Test suite parameter sets.\n    # (C, g_L, E_L, V_th, V_r, I_0, tau_w, T_ref)\n    # Units: F, S, V, V, V, A, s, s\n    test_cases = [\n        # Case A: Generic, positive calibration\n        (2e-10, 1e-8, -7.0e-2, -5.0e-2, -6.5e-2, 1.0e-9, 5.0e-2, 5.0e-3),\n        # Case B: Boundary, equal time constants\n        (2e-10, 1e-8, -7.0e-2, -5.0e-2, -6.5e-2, 1.2e-9, 2.0e-2, 5.0e-3),\n        # Case C: Edge, clamped to zero\n        (2e-10, 1e-8, -7.0e-2, -5.0e-2, -6.5e-2, 4.0e-10, 5.0e-2, 5.0e-3),\n        # Case D: Generic, slow adaptation\n        (2e-10, 1e-8, -7.0e-2, -5.0e-2, -6.5e-2, 9.0e-10, 5.0e-1, 5.0e-3),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        C, g_L, E_L, V_th, V_r, I_0, tau_w, T_ref = case\n\n        # Calculate membrane time constant and steady-state voltage\n        tau_m = C / g_L\n        V_inf = E_L + I_0 / g_L\n\n        # Calculate voltage at T_ref without adaptation (b=0)\n        V_no_adapt_T_ref = V_inf + (V_r - V_inf) * np.exp(-T_ref / tau_m)\n\n        # Calculate the required voltage suppression by the adaptation current\n        delta_V = V_no_adapt_T_ref - V_th\n\n        # If the unadapted voltage is already below threshold, no adaptation is needed.\n        if delta_V = 0:\n            b = 0.0\n        else:\n            # Check for the special case where time constants are equal\n            # using a small tolerance for floating-point comparison.\n            if abs(tau_w - tau_m)  1e-9:\n                # Case tau_w = tau_m = tau\n                tau = tau_m\n                prefactor_numerator = C\n                prefactor_denominator = T_ref * np.exp(-T_ref / tau)\n                b = (prefactor_numerator / prefactor_denominator) * delta_V\n            else:\n                # Generic case tau_w != tau_m\n                prefactor_numerator = g_L * (tau_w - tau_m)\n                exp_term_w = np.exp(-T_ref / tau_w)\n                exp_term_m = np.exp(-T_ref / tau_m)\n                prefactor_denominator = tau_w * (exp_term_w - exp_term_m)\n                \n                # Check for division by zero, although handled by the tau_w vs tau_m check\n                if abs(prefactor_denominator)  1e-15:\n                    # Fallback to the limit case logic, this shouldn't be hit with the tolerance.\n                    tau = tau_m\n                    b = (C / (T_ref * np.exp(-T_ref / tau))) * delta_V\n                else:\n                    b = (prefactor_numerator / prefactor_denominator) * delta_V\n        \n        # Clamp b at 0 as per problem specification for biophysical plausibility.\n        final_b = max(0.0, b)\n        results.append(final_b)\n\n    # Format the output as a comma-separated list in brackets.\n    output_str = f\"[{','.join(f'{r:.12e}' for r in results)}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}