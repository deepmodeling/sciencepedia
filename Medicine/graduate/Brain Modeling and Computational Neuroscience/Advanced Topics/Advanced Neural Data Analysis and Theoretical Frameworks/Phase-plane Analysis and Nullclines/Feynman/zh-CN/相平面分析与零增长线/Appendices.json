{
    "hands_on_practices": [
        {
            "introduction": "在处理像菲茨休-霍奇金（FitzHugh-Nagumo）模型这样的快慢动力系统时，一个核心技巧是利用时间尺度的分离来简化分析。本练习将指导你通过解析推导，掌握如何识别系统的“临界流行”（critical manifold）以及其上的“慢流”（slow flow）动力学。这个过程是理解这些系统如何产生复杂行为（如神经脉冲）的基础，它将一个二维问题在慢时间尺度上简化为更易于分析的一维问题。",
            "id": "4009577",
            "problem": "考虑一个无量纲形式的二维 FitzHugh–Nagumo 型快慢神经元模型，\n$$\n\\frac{dv}{dt} = f(v,w), \\qquad \\frac{dw}{dt} = \\epsilon\\, g(v,w),\n$$\n其中 $0  \\epsilon \\ll 1$ 表示快膜电位 $v$ 和慢恢复变量 $w$ 之间的时间尺度分离。令\n$$\nf(v,w) = v - \\frac{v^{3}}{3} - w + I_{0}, \\qquad g(v,w) = \\alpha\\, v - \\beta\\, w + \\gamma,\n$$\n其中参数 $I_{0}\\in \\mathbb{R}$ 且 $\\alpha,\\beta,\\gamma \\in \\mathbb{R}$。所有变量和参数均为无量纲。仅使用快慢系统的零斜线、临界流形和慢时间重标度的基本定义，执行以下操作：\n\n1. 在奇异极限 $\\epsilon \\to 0$下，为快子系统推导由 $f(v,w)=0$ 定义的临界流形，并将其明确表示为 $w$ 和 $v$ 之间的关系。\n\n2. 假设在远离临界流形折叠点处具有正常双曲性，通过将 $v$ 和 $w$ 约束在临界流形关系上，推导在慢时间 $\\tau = \\epsilon t$ 下临界流形上的降维慢流。将降维慢流表示为仅依赖于 $v$ 和参数的单个解析表达式。\n\n提供降维慢流 $dw/d\\tau$ 作为 $v$, $\\alpha$, $\\beta$, $\\gamma$ 和 $I_{0}$ 的函数的单个闭式解析表达式作为最终答案。不需要数值近似，也不涉及单位。只需写出最终表达式。",
            "solution": "该问题要求针对给定的 FitzHugh–Nagumo 型快慢系统推导其临界流形和降维慢流。该系统由以下常微分方程组描述：\n$$\n\\frac{dv}{dt} = v - \\frac{v^{3}}{3} - w + I_{0}\n$$\n$$\n\\frac{dw}{dt} = \\epsilon (\\alpha v - \\beta w + \\gamma)\n$$\n其中 $v$ 是快变量，$w$ 是慢变量，$0  \\epsilon \\ll 1$ 是分离时间尺度的参数。所有其他符号 $I_{0}$、$\\alpha$、$\\beta$ 和 $\\gamma$ 均为实参数。\n\n推导按要求分两步进行。\n\n首先，我们确定临界流形。临界流形是在奇异极限 $\\epsilon \\to 0$ 下定义的。在此极限下，系统变为：\n$$\n\\frac{dv}{dt} = v - \\frac{v^{3}}{3} - w + I_{0}\n$$\n$$\n\\frac{dw}{dt} = 0\n$$\n第二个方程 $\\frac{dw}{dt} = 0$ 意味着与 $v$ 相比，$w$ 的演化速度无限慢。在快变量 $v$ 的时间尺度上，$w$ 可被视为一个常数参数。$v$ 的快动力学将快速收敛到一个平衡态，前提是该平衡态是稳定的。快子系统的所有这些平衡点构成的集合就是临界流形，记为 $C_{0}$。为找到这些点，我们将快动力学设为零：\n$$\n\\frac{dv}{dt} = f(v,w) = 0\n$$\n代入给定的 $f(v,w)$ 表达式：\n$$\nv - \\frac{v^{3}}{3} - w + I_{0} = 0\n$$\n问题要求将此关系明确表示为 $w$ 关于 $v$ 的函数。重新整理该方程，我们得到临界流形的方程：\n$$\nw = v - \\frac{v^{3}}{3} + I_{0}\n$$\n$(v,w)$ 平面中的这条三次曲线就是临界流形 $C_{0}$。对于慢动力学，假设系统状态 $(v(t), w(t))$ 被约束在该流形上，这在 $C_{0}$ 的正常双曲部分是有效的。\n\n其次，我们推导该临界流形上的降维慢流。慢变量 $w$ 的动力学由 $\\frac{dw}{dt} = \\epsilon g(v,w)$ 给出。为了分析在慢时间尺度上的流，我们引入一个新的时间变量 $\\tau = \\epsilon t$。使用导数的链式法则：\n$$\n\\frac{dw}{d\\tau} = \\frac{dw}{dt} \\frac{dt}{d\\tau}\n$$\n根据定义 $\\tau = \\epsilon t$，我们有 $\\frac{d\\tau}{dt} = \\epsilon$，这意味着 $\\frac{dt}{d\\tau} = \\frac{1}{\\epsilon}$。将此代入链式法则表达式中：\n$$\n\\frac{dw}{d\\tau} = \\frac{1}{\\epsilon} \\frac{dw}{dt}\n$$\n现在，我们使用 $\\frac{dw}{dt}$ 的原始方程：\n$$\n\\frac{dw}{d\\tau} = \\frac{1}{\\epsilon} \\left[ \\epsilon (\\alpha v - \\beta w + \\gamma) \\right]\n$$\n$$\n\\frac{dw}{d\\tau} = \\alpha v - \\beta w + \\gamma\n$$\n这个方程描述了整个相空间中的慢流。降维慢流是约束在临界流形 $C_{0}$ 上的动力学。为了求得它，我们将临界流形方程中的 $w$ 的表达式 $w = v - \\frac{v^{3}}{3} + I_{0}$ 代入 $\\frac{dw}{d\\tau}$ 的方程中：\n$$\n\\frac{dw}{d\\tau} = \\alpha v - \\beta \\left( v - \\frac{v^{3}}{3} + I_{0} \\right) + \\gamma\n$$\n我们现在展开并简化此表达式，以获得仅作为 $v$ 和参数的函数的降维慢流：\n$$\n\\frac{dw}{d\\tau} = \\alpha v - \\beta v + \\frac{\\beta v^{3}}{3} - \\beta I_{0} + \\gamma\n$$\n按 $v$ 的幂次对各项进行分组：\n$$\n\\frac{dw}{d\\tau} = \\frac{\\beta}{3}v^{3} + (\\alpha - \\beta)v + (\\gamma - \\beta I_{0})\n$$\n问题要求给出降维慢流 $\\frac{dw}{d\\tau}$ 的单个解析表达式。此表达式是上面推导出的最终方程的右侧。它描述了在慢时间 $\\tau$ 下沿着临界流形的演化过程。",
            "answer": "$$\n\\boxed{\\frac{\\beta}{3}v^{3} + (\\alpha - \\beta)v + \\gamma - \\beta I_{0}}\n$$"
        },
        {
            "introduction": "相平面中的零斜线（nullclines）不仅能揭示流动的方向，还能预示系统行为的剧变——即分岔（bifurcation）。本练习将引导你应用一个关键的几何准则：当两条零斜线在不动点处相切时，系统可能发生鞍结分岔。通过精确计算不变圆上的鞍结（Saddle-Node on Invariant Circle, SNIC）分岔发生的参数值，你将亲身体验如何利用相平面分析来确定神经元从静息态到节律性放电的临界点。",
            "id": "4009575",
            "problem": "考虑计算神经科学中使用的无量纲 FitzHugh–Nagumo (FHN) 可兴奋性模型，由以下平面系统给出\n$$\n\\frac{dv}{dt} = f(v,w;I) = v - \\frac{v^{3}}{3} - w + I,\\qquad\n\\frac{dw}{dt} = g(v,w) = \\epsilon\\,(v + a - b\\,w),\n$$\n其中 $v$ 是快膜电位变量，$w$ 是慢恢复变量，$I$ 是恒定的外部驱动（无量纲电流），而 $\\epsilon$、$a$、$b$ 是正常数。$v$-零斜线是三次曲线 $f(v,w;I) = 0$，$w$-零斜线是直线 $g(v,w) = 0$。\n\n当两条零斜线在一个共同的平衡点处相切，且在该交点处 $f$ 和 $g$ 的梯度共线时，该模型在慢快分离（$\\epsilon \\ll 1$）的条件下会发生不变圆上的鞍节点 (Saddle-Node on Invariant Circle, SNIC) 分岔。利用零斜线的基本定义、平面系统的雅可比矩阵以及用梯度表示的通用鞍节点相切准则，确定对于参数集\n$$\n\\epsilon = 0.08,\\quad a = 0.7,\\quad b = 2,\n$$\n发生 SNIC 分岔的唯一驱动 $I$ 值，其中相切发生在三次 $v$-零斜线的左分支上（即，在 $v  0$ 且该三次曲线局部曲率为正的一点）。请将您的最终答案表示为 $I$ 的单个封闭形式解析表达式。无需四舍五入，且由于变量和参数均为无量纲，不应使用任何物理单位。",
            "solution": "该问题要求找出在给定参数集下，使 FitzHugh-Nagumo (FHN) 模型呈现不变圆上的鞍节点 (SNIC) 分岔的外部驱动 $I$ 的值。FHN 模型由以下微分方程组描述：\n$$\n\\frac{dv}{dt} = f(v,w;I) = v - \\frac{v^{3}}{3} - w + I\n$$\n$$\n\\frac{dw}{dt} = g(v,w) = \\epsilon\\,(v + a - b\\,w)\n$$\n给定参数为 $\\epsilon = 0.08$，$a = 0.7$ 和 $b = 2$。\n\nSNIC 分岔发生在一个平衡点上，在该点系统的零斜线相切。平衡点 $(v_*, w_*)$ 是导数均为零的点，即 $f(v_*, w_*; I) = 0$ 和 $g(v_*, w_*) = 0$。这两个条件分别定义了 $v$-零斜线和 $w$-零斜线。\n\n首先，我们通过将导数设为零来写出零斜线的方程。\n$v$-零斜线由 $f(v,w;I)=0$ 给出：\n$$\nv - \\frac{v^{3}}{3} - w + I = 0 \\implies w = v - \\frac{v^{3}}{3} + I\n$$\n这是 $v$-$w$ 相平面中的一条三次曲线。\n\n$w$-零斜线由 $g(v,w)=0$ 给出：\n$$\n\\epsilon\\,(v + a - b\\,w) = 0\n$$\n由于 $\\epsilon > 0$，这可以简化为：\n$$\nv + a - b\\,w = 0 \\implies w = \\frac{v+a}{b}\n$$\n这是 $v$-$w$ 相平面中的一条直线。\n\n当这两条零斜线在一个平衡点 $(v_*, w_*)$ 处相切时，发生 SNIC 分岔。在相切点，将两条零斜线曲线视为 $v$ 的函数，它们的斜率必须相等。\n\n$v$-零斜线的斜率通过对其方程关于 $v$ 求导得到：\n$$\n\\frac{dw}{dv} = \\frac{d}{dv} \\left( v - \\frac{v^{3}}{3} + I \\right) = 1 - v^{2}\n$$\n$w$-零斜线的斜率也用类似方法求得：\n$$\n\\frac{dw}{dv} = \\frac{d}{dv} \\left( \\frac{v+a}{b} \\right) = \\frac{1}{b}\n$$\n在相切点 $v=v_*$ 处，斜率必须相等：\n$$\n1 - v_*^{2} = \\frac{1}{b}\n$$\n我们可以解这个方程求出 $v_*$。整理后得到：\n$$\nv_*^{2} = 1 - \\frac{1}{b}\n$$\n$$\nv_* = \\pm \\sqrt{1 - \\frac{1}{b}}\n$$\n问题指明相切发生在三次 $v$-零斜线的左分支上，这对应于 $v  0$。因此，我们必须选择负根：\n$$\nv_* = - \\sqrt{1 - \\frac{1}{b}}\n$$\n代入给定参数 $b=2$：\n$$\nv_* = - \\sqrt{1 - \\frac{1}{2}} = - \\sqrt{\\frac{1}{2}} = -\\frac{1}{\\sqrt{2}}\n$$\n在平衡点 $(v_*, w_*)$ 处，两个零斜线方程必须同时满足：\n1. $w_* = v_* - \\frac{v_*^{3}}{3} + I$\n2. $w_* = \\frac{v_*+a}{b}$\n\n我们可以通过令这两个 $w_*$ 的表达式相等来求出所需的 $I$ 值：\n$$\n\\frac{v_*+a}{b} = v_* - \\frac{v_*^{3}}{3} + I\n$$\n解出 $I$：\n$$\nI = \\frac{v_*+a}{b} - v_* + \\frac{v_*^{3}}{3}\n$$\n这可以通过重组含 $v_*$ 的项来简化：\n$$\nI = v_* \\left(\\frac{1}{b} - 1\\right) + \\frac{v_*^{3}}{3} + \\frac{a}{b}\n$$\n根据我们的相切条件，我们知道 $\\frac{1}{b} - 1 = -v_*^2$。将此代入 $I$ 的表达式中：\n$$\nI = v_*(-v_*^2) + \\frac{v_*^{3}}{3} + \\frac{a}{b} = -v_*^{3} + \\frac{v_*^{3}}{3} + \\frac{a}{b}\n$$\n$$\nI = -\\frac{2}{3}v_*^{3} + \\frac{a}{b}\n$$\n这是在 SNIC 分岔点处，用电压 $v_*$ 和参数 $a$、$b$ 表示的电流 $I$ 的通用表达式。\n\n现在，我们代入具体数值。我们有 $a = 0.7$，$b = 2$，并且我们已求出 $v_* = -1/\\sqrt{2}$。首先，我们计算 $v_*^3$：\n$$\nv_*^{3} = \\left(-\\frac{1}{\\sqrt{2}}\\right)^{3} = -\\frac{1}{(\\sqrt{2})^3} = -\\frac{1}{2\\sqrt{2}} = -\\frac{\\sqrt{2}}{4}\n$$\n现在，将这些值代入 $I$ 的表达式中：\n$$\nI = -\\frac{2}{3}\\left(-\\frac{\\sqrt{2}}{4}\\right) + \\frac{0.7}{2}\n$$\n$$\nI = \\frac{2\\sqrt{2}}{12} + 0.35 = \\frac{\\sqrt{2}}{6} + \\frac{7}{20}\n$$\n为了将其表示为单个分数，我们找到一个公分母，即 $60$：\n$$\nI = \\frac{10\\sqrt{2}}{60} + \\frac{21}{60} = \\frac{21 + 10\\sqrt{2}}{60}\n$$\n这就是在指定条件下发生 SNIC 分岔时，驱动 $I$ 的唯一、封闭形式的解析表达式。请注意，$\\epsilon=0.08$ 的值与 SNIC 分岔所基于的慢快分离假设是一致的，但在计算相切点本身时并不需要用到它。",
            "answer": "$$\n\\boxed{\\frac{21 + 10\\sqrt{2}}{60}}\n$$"
        },
        {
            "introduction": "理论分析为我们提供了系统的局部信息，而计算实践则能揭示其全局动力学和功能意义。本练习将理论与计算相结合，要求你定位一个鞍点不动点（saddle fixed point），并追踪其不稳定流形（unstable manifold）。通过这个过程，你将直观地看到，这个抽象的数学结构在神经元模型中扮演着一个具体的生理角色——它构成了区分阈下响应与动作电位发放的“激发阈值”或分界线（separatrix）。",
            "id": "4009653",
            "problem": "给定一个二维确定性动力系统，该系统模拟了相平面中一个简化的可兴奋神经元，其灵感来源于 Hodgkin–Huxley 模型的 FitzHugh–Nagumo 简化。状态变量为膜电位 $v$ 和慢恢复变量 $w$，其动力学由以下方程定义：\n$$\n\\frac{dv}{dt} = f(v,w) = v - \\frac{v^3}{3} - w + I, \\quad \\frac{dw}{dt} = g(v,w) = \\varepsilon\\,(v + a - b\\,w),\n$$\n其中 $I$ 是外部电流，$\\varepsilon$ 是一个设定 $w$ 慢时间尺度的小正数常量，$a$ 是一个偏置参数，$b$ 是一个耦合参数。该系统的相平面分析涉及 $v$-零斜线 $f(v,w) = 0$ 和 $w$-零斜线 $g(v,w) = 0$。$v$-零斜线是 $(v,w)$ 平面中的一条三次曲线，其中央的“中间分支”对应于 $|v|  1$ 的部分。\n\n从以下基本定义和事实出发：\n- 根据定义，固定点 $(v^\\ast, w^\\ast)$ 满足 $f(v^\\ast,w^\\ast) = 0$ 和 $g(v^\\ast,w^\\ast) = 0$。\n- 系统在固定点处求值的雅可比矩阵为\n$$\nJ(v^\\ast,w^\\ast) = \n\\begin{bmatrix}\n\\frac{\\partial f}{\\partial v}(v^\\ast,w^\\ast)  \\frac{\\partial f}{\\partial w}(v^\\ast,w^\\ast) \\\\\n\\frac{\\partial g}{\\partial v}(v^\\ast,w^\\ast)  \\frac{\\partial g}{\\partial w}(v^\\ast,w^\\ast)\n\\end{bmatrix},\n$$\n其各项由给定的 $f$ 和 $g$ 计算得出。\n- 在二维空间中，一个固定点是鞍点的充要条件是 $\\det(J(v^\\ast,w^\\ast))  0$，这意味着存在一个实部为正的特征值和一个实部为负的特征值。\n- 鞍点的不稳定流形在 $(v^\\ast,w^\\ast)$ 处与 $J(v^\\ast,w^\\ast)$ 的特征向量相切，该特征向量与实部为正的特征值相关联。从沿此特征向量轻微偏离的初始条件出发，随时间正向积分流，即可生成不稳定流形的分支。\n\n您的任务是：\n1. 对于下方测试套件中的每个参数集，找到位于三次 $v$-零斜线中间分支上的固定点 $(v^\\ast, w^\\ast)$（选择使 $|v^\\ast|$ 最小化的实数解；如果多个实数解满足 $|v^\\ast|  1$，则选择 $|v^\\ast|$ 最小的那个）。\n2. 计算雅可比矩阵 $J(v^\\ast,w^\\ast)$，并通过评估 $\\det(J(v^\\ast,w^\\ast))$ 的符号来判断该固定点是否为鞍点。\n3. 如果固定点是鞍点，计算不稳定特征向量（与 $J$ 的具有最大实部的特征值相关联）及其角度 $\\theta$（以弧度为单位），该角度从正 $v$ 轴测量，计算公式为 $\\theta = \\operatorname{atan2}(e_w,e_v)$，其中 $(e_v,e_w)$ 是不稳定特征向量的分量。如果最大实部不为正，报告该特征向量对应的 $\\theta$，但在尖峰测试中表明不存在不稳定流形。\n4. 在不稳定流形分支上初始化两个邻近点，分别为 $(v^\\ast, w^\\ast) \\pm \\delta\\,\\mathbf{e}$，其中 $\\mathbf{e}$ 是归一化为单位长度的不稳定特征向量，$\\delta = 10^{-3}$。使用数值常微分方程求解器，将系统在无量纲时间内向前积分到 $T = 200$。通过阈值穿越 $v(t) \\geq v_{\\mathrm{spike}}$（其中 $v_{\\mathrm{spike}} = 1.2$）来定义尖峰检测标准。对于每个分支，记录 $v(t)$ 事件是否在 $v(t)$ 递增的情况下首次穿过 $v_{\\mathrm{spike}}$。\n5. 对于每个参数集，报告元组 $[v^\\ast, w^\\ast, \\theta, \\text{spike_plus}, \\text{spike_minus}, \\text{is_middle_branch}, \\text{is_saddle}]$，其中：\n   - $v^\\ast$ 和 $w^\\ast$ 是浮点数，\n   - $\\theta$ 是浮点数（角度，以弧度为单位），\n   - `spike_plus` 和 `spike_minus` 是布尔值，分别对应于 $+\\delta$ 和 $-\\delta$ 不稳定分支，\n   - `is_middle_branch` 是一个布尔值，指示是否 $|v^\\ast|  1$，\n   - `is_saddle` 是一个布尔值，指示是否 $\\det(J(v^\\ast,w^\\ast))  0$。\n\n仅使用无量纲量；不需要物理单位。角度必须以弧度报告。\n\n测试套件（每个条目为 $(\\varepsilon, a, b, I)$）：\n- 案例 1（典型的可兴奋/尖峰放电，鞍点位于中间分支上）：$(0.08, 0.7, 3.0, 0.5)$。\n- 案例 2（边界情况，非双曲固定点）：$(0.08, 0.0, 1.0, 0.0)$。\n- 案例 3（无鞍点，行列式为正）：$(0.08, 0.7, 0.2, 0.1)$。\n\n您的程序应生成单行输出，其中包含三个案例的结果，形式为一个用方括号括起来的逗号分隔列表。格式必须为\n$$\n[\\,[v^\\ast_1,w^\\ast_1,\\theta_1,spike\\_plus_1,spike\\_minus_1,is\\_middle\\_branch_1,is\\_saddle_1],\\,[v^\\ast_2,w^\\ast_2,\\theta_2,spike\\_plus_2,spike\\_minus_2,is\\_middle\\_branch_2,is\\_saddle_2],\\,[v^\\ast_3,w^\\ast_3,\\theta_3,spike\\_plus_3,spike\\_minus_3,is\\_middle\\_branch_3,is\\_saddle_3]\\,],\n$$\n其中布尔值呈现为 Python 字面量，数字为标准十进制形式。",
            "solution": "用户提供了一个计算神经科学领域的问题，要求对一个类似于 FitzHugh-Nagumo 系统的简化可兴奋神经元模型进行相平面分析。该问题定义明确，科学上合理，且所有必要的参数和步骤都已指定。任务包括寻找一个固定点，分析其稳定性，确定其不稳定流形的方向（如果存在），并模拟系统轨迹以检查尖峰放电行为。\n\n该动力学系统由以下常微分方程（ODE）给出：\n$$\n\\frac{dv}{dt} = f(v,w) = v - \\frac{v^3}{3} - w + I\n$$\n$$\n\\frac{dw}{dt} = g(v,w) = \\varepsilon (v + a - bw)\n$$\n\n将对测试套件中提供的每个参数集 $(\\varepsilon, a, b, I)$ 执行求解过程。\n\n**步骤 1：定位固定点**\n\n系统的固定点 $(v^\\ast, w^\\ast)$ 是一个动力学停止的状态，即 $\\frac{dv}{dt} = 0$ 和 $\\frac{dw}{dt} = 0$。这提供了一个由两个代数方程组成的方程组：\n1. 从 $v$-零斜线，$f(v^\\ast, w^\\ast) = 0$：$v^\\ast - \\frac{(v^\\ast)^3}{3} - w^\\ast + I = 0 \\implies w^\\ast = v^\\ast - \\frac{(v^\\ast)^3}{3} + I$。\n2. 从 $w$-零斜线，$g(v^\\ast, w^\\ast) = 0$：由于 $\\varepsilon > 0$，这简化为 $v^\\ast + a - bw^\\ast = 0$。\n\n将 $v$-零斜线得到的 $w^\\ast$ 表达式代入 $w$-零斜线方程，我们得到一个关于 $v^\\ast$ 的单一方程：\n$$\nv^\\ast + a - b\\left(v^\\ast - \\frac{(v^\\ast)^3}{3} + I\\right) = 0\n$$\n整理后得到一个关于 $v^\\ast$ 的三次多项式方程：\n$$\n\\frac{b}{3}(v^\\ast)^3 + (1-b)v^\\ast + (a-bI) = 0\n$$\n这个三次多项式的根决定了固定点的 $v$ 坐标。我们将数值求解此方程以找到其所有根（实根和复根）。然后，我们通过选择虚部绝对值小于一个小的容差（例如，$10^{-9}$）的根来筛选实根。根据问题陈述，我们必须从实根集合中选择绝对值最小的那个，记为 $v^\\ast$。\n\n找到 $v^\\ast$ 后，相应的 $w$ 坐标 $w^\\ast$ 可从线性 $w$-零斜线方程计算得出：$w^\\ast = \\frac{v^\\ast + a}{b}$（假设 $b \\neq 0$，这对所有测试用例都成立）。然后，布尔标志 `is_middle_branch` 由条件 $|v^\\ast|  1$ 确定。\n\n**步骤 2：通过雅可比矩阵进行稳定性分析**\n\n固定点 $(v^\\ast, w^\\ast)$ 的稳定性由在该点求值的雅可比矩阵 $J$ 的特征值决定。偏导数为：\n$$\n\\frac{\\partial f}{\\partial v} = 1 - v^2, \\quad \\frac{\\partial f}{\\partial w} = -1\n$$\n$$\n\\frac{\\partial g}{\\partial v} = \\varepsilon, \\quad \\frac{\\partial g}{\\partial w} = -\\varepsilon b\n$$\n因此，在 $(v^\\ast, w^\\ast)$ 处的雅可比矩阵是：\n$$\nJ(v^\\ast,w^\\ast) =\n\\begin{bmatrix}\n1 - (v^\\ast)^2  -1 \\\\\n\\varepsilon  -\\varepsilon b\n\\end{bmatrix}\n$$\n如果一个固定点的雅可比矩阵行列式小于零，即 $\\det(J)  0$，则该点为鞍点。这意味着特征值为实数且符号相反，一个为正（不稳定方向），一个为负（稳定方向）。我们将计算 $\\det(J) = (1-(v^\\ast)^2)(-\\varepsilon b) - (-1)(\\varepsilon) = \\varepsilon [1 - b(1-(v^\\ast)^2)]$ 并相应地设置布尔标志 `is_saddle`。\n\n**步骤 3：不稳定特征向量和角度**\n\n鞍点的不稳定流形与正特征值对应的特征向量相切。更一般地，问题要求的是与具有最大实部的特征值相关联的特征向量。我们数值计算 $J(v^\\ast, w^\\ast)$ 的特征值和特征向量。\n\n设 $(\\lambda_1, \\lambda_2)$ 为特征值，$(\\mathbf{e}_1, \\mathbf{e}_2)$ 为对应的特征向量。我们找出具有最大实部的特征值（设为 $\\lambda_k$）及其对应的特征向量 $\\mathbf{e}_k = (e_v, e_w)$。\n该特征向量相对于正 $v$ 轴的角度 $\\theta$ 计算为 $\\theta = \\operatorname{atan2}(e_w, e_v)$。\n\n对于特征值为复共轭对（例如，不稳定的螺旋点/焦点）的情况，需要澄清一点。在这种情况下，特征向量也是复数。问题要求一个角度 $\\theta$，这意味着需要一个实值向量。一个合理的解释（我们将在此处采用）是使用复特征向量的实部来定义分析方向。如果 $\\mathbf{e}_k = \\mathbf{e}_{\\text{real}} + i \\mathbf{e}_{\\text{imag}}$，我们将使用 $\\mathbf{e}_{\\text{real}}$ 的分量来计算 $\\theta$。\n\n**步骤 4：数值积分和尖峰检测**\n\n为确定从固定点附近开始的轨迹是否产生尖峰，我们对 ODE 系统进行数值积分。我们定义两个从固定点沿“不稳定”特征向量 $\\mathbf{e}$ 方向扰动的初始条件：\n$$\n\\mathbf{y}_{0, \\text{plus}} = (v^\\ast, w^\\ast) + \\delta \\hat{\\mathbf{e}}\n$$\n$$\n\\mathbf{y}_{0, \\text{minus}} = (v^\\ast, w^\\ast) - \\delta \\hat{\\mathbf{e}}\n$$\n其中 $\\hat{\\mathbf{e}}$ 是归一化的（单位长度）特征向量方向向量（如前所述，取其实部），$\\delta = 10^{-3}$ 是扰动幅度。\n\n我们将使用 `scipy.integrate` 库中的 `solve_ivp` 函数，对两个初始条件，将系统从 $t=0$ 积分到 $T=200$。尖峰检测是通过 `solve_ivp` 的事件处理功能实现的。尖峰被定义为轨迹以正速度（$dv/dt > 0$）穿过阈值 $v(t) = v_{\\text{spike}} = 1.2$ 的事件。事件函数是 $v(t) - 1.2$，我们寻找方向为递增的穿越。如果在 `plus` 分支上检测到该事件，则 `spike_plus` 为 `True`；否则为 `False`。同样的逻辑适用于 `minus` 分支的 `spike_minus`。\n\n**步骤 5：汇总最终报告**\n\n对于每个参数集，将计算出的值——$v^\\ast$、$w^\\ast$、$\\theta$、`spike_plus`、`spike_minus`、`is_middle_branch` 和 `is_saddle`——收集到一个列表中。最终输出是一个列表，其中包含所有测试用例的结果列表，并按指定格式进行格式化。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    It iterates through parameter sets, analyzes the system for each,\n    and prints the formatted results.\n    \"\"\"\n    # Test suite: each entry is a tuple (epsilon, a, b, I)\n    test_cases = [\n        (0.08, 0.7, 3.0, 0.5),  # Case 1: Saddle on middle branch\n        (0.08, 0.0, 1.0, 0.0),  # Case 2: Non-hyperbolic fixed point\n        (0.08, 0.7, 0.2, 0.1)   # Case 3: Unstable focus\n    ]\n\n    results = []\n    for params in test_cases:\n        epsilon, a, b, I = params\n        result = analyze_system(epsilon, a, b, I)\n        results.append(result)\n\n    # Format the final output string as a list of lists.\n    # The conversion to string handles boolean literals correctly.\n    formatted_results = f\"[{','.join(map(str, results))}]\"\n    print(formatted_results)\n\ndef analyze_system(epsilon, a, b, I):\n    \"\"\"\n    Analyzes the FitzHugh-Nagumo-like system for a given set of parameters.\n    \n    Returns:\n        A list containing [v_star, w_star, theta, spike_plus, spike_minus,\n        is_middle_branch, is_saddle].\n    \"\"\"\n    # 1. Find the fixed point (v*, w*)\n    # The v-coordinate of the fixed point is a root of a cubic polynomial:\n    # (b/3)*v^3 + (1-b)*v + (a-b*I) = 0\n    poly_coeffs = [b / 3.0, 0, 1 - b, a - b * I]\n    roots = np.roots(poly_coeffs)\n\n    # Filter for real roots (imaginary part is negligible)\n    real_roots = roots[np.abs(np.imag(roots))  1e-9]\n    real_roots = np.real(real_roots)\n\n    # Select the real root with the minimum absolute value\n    if len(real_roots) == 0:\n        # This should not happen for the given test cases\n        raise ValueError(\"No real roots found for the fixed point equation.\")\n    v_star = real_roots[np.argmin(np.abs(real_roots))]\n    \n    # Calculate w_star from the w-nullcline\n    if abs(b)  1e-9: # Handle b=0 case\n        w_star = np.nan\n    else:\n        w_star = (v_star + a) / b\n\n    is_middle_branch = abs(v_star)  1.0\n\n    # 2. Compute Jacobian matrix and stability\n    J = np.array([\n        [1 - v_star**2, -1],\n        [epsilon, -epsilon * b]\n    ])\n    det_J = np.linalg.det(J)\n    is_saddle = det_J  0\n\n    # 3. Compute eigenvalues and the \"unstable\" eigenvector\n    eigvals, eigvecs = np.linalg.eig(J)\n    \n    # Find eigenvector corresponding to eigenvalue with largest real part\n    idx_unstable = np.argmax(np.real(eigvals))\n    unstable_eigvec = eigvecs[:, idx_unstable]\n    \n    # Eigenvector can be complex. We use its real part to define a direction.\n    e_v, e_w = np.real(unstable_eigvec)\n    \n    # Calculate angle theta\n    theta = np.arctan2(e_w, e_v)\n\n    # 4. Numerical integration to check for spikes\n    delta = 1e-3\n    t_span = (0, 200)\n    v_spike_threshold = 1.2\n    \n    # Normalize the direction vector\n    eigvec_real_part = np.real(unstable_eigvec)\n    norm = np.linalg.norm(eigvec_real_part)\n    if norm > 1e-9:\n        unit_eigvec = eigvec_real_part / norm\n    else: # for robustness\n        unit_eigvec = np.array([1.0, 0.0])\n\n    # ODE system definition\n    def fhn_ode(t, y, epsilon, a, b, I):\n        v, w = y\n        dvdt = v - v**3 / 3 - w + I\n        dwdt = epsilon * (v + a - b * w)\n        return [dvdt, dwdt]\n\n    # Spike detection event function for solve_ivp\n    def spike_event(t, y, *args):\n        return y[0] - v_spike_threshold\n    spike_event.terminal = True  # Stop integration after first spike\n    spike_event.direction = 1    # Detect crossing from negative to positive\n\n    y_star = np.array([v_star, w_star])\n    \n    # Check +delta branch\n    y0_plus = y_star + delta * unit_eigvec\n    sol_plus = solve_ivp(fhn_ode, t_span, y0_plus, args=(epsilon, a, b, I),\n                         events=spike_event, dense_output=True)\n    spike_plus = len(sol_plus.t_events[0]) > 0\n\n    # Check -delta branch\n    y0_minus = y_star - delta * unit_eigvec\n    sol_minus = solve_ivp(fhn_ode, t_span, y0_minus, args=(epsilon, a, b, I),\n                          events=spike_event, dense_output=True)\n    spike_minus = len(sol_minus.t_events[0]) > 0\n    \n    # 5. Assemble results\n    return [\n        v_star,\n        w_star,\n        theta,\n        spike_plus,\n        spike_minus,\n        is_middle_branch,\n        is_saddle\n    ]\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}