{
    "hands_on_practices": [
        {
            "introduction": "掌握贝叶斯推断的核心在于理解如何将先验知识与新观测数据相结合。本练习将引导您推导一个基本但极为重要的共轭模型：高斯似然与高斯先验的组合 。通过这个推导，您将亲眼见证后验均值如何自然地呈现为先验均值和观测数据的“精确度加权平均”形式，这一优美的结果为理解更复杂的贝叶斯模型提供了坚实的直觉基础。",
            "id": "3964645",
            "problem": "在一个神经编码实验中，单次试验的感觉反应 $y$ 被建模为对一个未知的潜在刺激表示 $\\theta$ 的带噪声的观测。假设在测量阶段，由于突触和读出变异性，存在加性高斯噪声，并且潜在表示服从一个反映了先前学习到的环境统计特性的高斯先验。具体来说，假设似然和先验由 $p(y \\mid \\theta) = \\mathcal{N}(y; \\theta, \\sigma^{2})$ 和 $p(\\theta) = \\mathcal{N}(\\theta; \\mu_{0}, \\tau_{0}^{2})$ 指定，其中 $\\sigma^{2} > 0$ 是观测噪声方差，$\\mu_{0} \\in \\mathbb{R}$ 是先验均值，$\\tau_{0}^{2} > 0$ 是先验方差。使用贝叶斯定理的定义和高斯分布族的性质，从第一性原理推导后验分布 $p(\\theta \\mid y)$，以闭式形式计算其均值和方差，并将后验均值表示为精度加权形式，其中精度定义为方差的倒数。你的最终答案应该是后验均值和后验方差的两个闭式表达式。不需要进行数值近似。",
            "solution": "该问题是有效的。它描述了计算神经科学中的一个标准贝叶斯推断场景，涉及高斯似然和高斯先验。所有组成部分在科学上都是合理的、定义明确的，并且该问题在数学上是适定的，要求进行标准推导并得到唯一解。\n\n任务是在给定观测值 $y$ 的情况下，推导潜变量 $\\theta$ 的后验分布 $p(\\theta \\mid y)$。似然分布和先验分布如下：\n似然：$p(y \\mid \\theta) = \\mathcal{N}(y; \\theta, \\sigma^2) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(y - \\theta)^2}{2\\sigma^2}\\right)$\n先验：$p(\\theta) = \\mathcal{N}(\\theta; \\mu_0, \\tau_0^2) = \\frac{1}{\\sqrt{2\\pi\\tau_0^2}} \\exp\\left(-\\frac{(\\theta - \\mu_0)^2}{2\\tau_0^2}\\right)$\n\n根据贝叶斯定理，后验分布正比于似然和先验的乘积：\n$$ p(\\theta \\mid y) = \\frac{p(y \\mid \\theta) p(\\theta)}{p(y)} \\propto p(y \\mid \\theta) p(\\theta) $$\n项 $p(y)$ 是一个不依赖于 $\\theta$ 的归一化常数。我们可以通过分析似然和先验的乘积来找到后验的函数形式。\n\n代入高斯分布的表达式：\n$$ p(\\theta \\mid y) \\propto \\left[ \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(y - \\theta)^2}{2\\sigma^2}\\right) \\right] \\left[ \\frac{1}{\\sqrt{2\\pi\\tau_0^2}} \\exp\\left(-\\frac{(\\theta - \\mu_0)^2}{2\\tau_0^2}\\right) \\right] $$\n忽略常数乘法因子，我们关注指数项：\n$$ p(\\theta \\mid y) \\propto \\exp\\left(-\\frac{(y - \\theta)^2}{2\\sigma^2} - \\frac{(\\theta - \\mu_0)^2}{2\\tau_0^2}\\right) $$\n让我们分析指数部分，我们将其表示为 $E$：\n$$ E = -\\frac{1}{2} \\left( \\frac{(y - \\theta)^2}{\\sigma^2} + \\frac{(\\theta - \\mu_0)^2}{\\tau_0^2} \\right) $$\n我们展开括号内的平方项：\n$$ E = -\\frac{1}{2} \\left( \\frac{y^2 - 2y\\theta + \\theta^2}{\\sigma^2} + \\frac{\\theta^2 - 2\\mu_0\\theta + \\mu_0^2}{\\tau_0^2} \\right) $$\n为了确定一个新的关于 $\\theta$ 的高斯分布，我们根据 $\\theta$ 的幂次合并各项：\n$$ E = -\\frac{1}{2} \\left[ \\theta^2 \\left(\\frac{1}{\\sigma^2} + \\frac{1}{\\tau_0^2}\\right) - 2\\theta \\left(\\frac{y}{\\sigma^2} + \\frac{\\mu_0}{\\tau_0^2}\\right) + \\left(\\frac{y^2}{\\sigma^2} + \\frac{\\mu_0^2}{\\tau_0^2}\\right) \\right] $$\n$\\theta$ 的后验分布形式为 $p(\\theta \\mid y) = \\mathcal{N}(\\theta; \\mu_{\\text{post}}, \\sigma_{\\text{post}}^2)$，其指数形式为 $-\\frac{(\\theta - \\mu_{\\text{post}})^2}{2\\sigma_{\\text{post}}^2}$。将其展开得到：\n$$ -\\frac{(\\theta - \\mu_{\\text{post}})^2}{2\\sigma_{\\text{post}}^2} = -\\frac{1}{2\\sigma_{\\text{post}}^2} (\\theta^2 - 2\\theta\\mu_{\\text{post}} + \\mu_{\\text{post}}^2) = -\\frac{1}{2} \\left( \\frac{1}{\\sigma_{\\text{post}}^2}\\theta^2 - \\frac{2\\mu_{\\text{post}}}{\\sigma_{\\text{post}}^2}\\theta + \\frac{\\mu_{\\text{post}}^2}{\\sigma_{\\text{post}}^2} \\right) $$\n通过将我们推导出的指数 $E$ 中 $\\theta$ 各次幂的系数与这个通用形式进行比较，我们可以确定后验均值 $\\mu_{\\text{post}}$ 和后验方差 $\\sigma_{\\text{post}}^2$。\n\n首先，比较 $\\theta^2$ 项的系数：\n$$ \\frac{1}{\\sigma_{\\text{post}}^2} = \\frac{1}{\\sigma^2} + \\frac{1}{\\tau_0^2} $$\n这直接给出了我们的后验方差 $\\sigma_{\\text{post}}^2$：\n$$ \\sigma_{\\text{post}}^2 = \\left( \\frac{1}{\\sigma^2} + \\frac{1}{\\tau_0^2} \\right)^{-1} = \\left( \\frac{\\tau_0^2 + \\sigma^2}{\\sigma^2 \\tau_0^2} \\right)^{-1} = \\frac{\\sigma^2 \\tau_0^2}{\\sigma^2 + \\tau_0^2} $$\n接下来，我们比较 $\\theta$ 项的系数：\n$$ \\frac{2\\mu_{\\text{post}}}{\\sigma_{\\text{post}}^2} = 2 \\left( \\frac{y}{\\sigma^2} + \\frac{\\mu_0}{\\tau_0^2} \\right) $$\n$$ \\mu_{\\text{post}} = \\sigma_{\\text{post}}^2 \\left( \\frac{y}{\\sigma^2} + \\frac{\\mu_0}{\\tau_0^2} \\right) $$\n现在，代入我们找到的 $\\sigma_{\\text{post}}^2$ 的表达式：\n$$ \\mu_{\\text{post}} = \\left( \\frac{\\sigma^2 \\tau_0^2}{\\sigma^2 + \\tau_0^2} \\right) \\left( \\frac{y}{\\sigma^2} + \\frac{\\mu_0}{\\tau_0^2} \\right) $$\n$$ \\mu_{\\text{post}} = \\left( \\frac{\\sigma^2 \\tau_0^2}{\\sigma^2 + \\tau_0^2} \\right) \\left( \\frac{y\\tau_0^2 + \\mu_0\\sigma^2}{\\sigma^2 \\tau_0^2} \\right) $$\n$$ \\mu_{\\text{post}} = \\frac{y\\tau_0^2 + \\mu_0\\sigma^2}{\\sigma^2 + \\tau_0^2} $$\n因此，后验分布是一个高斯分布 $p(\\theta \\mid y) = \\mathcal{N}(\\theta; \\mu_{\\text{post}}, \\sigma_{\\text{post}}^2)$，其均值和方差已推导得出。\n\n问题还要求将后验均值表示为精度加权形式。精度定义为方差的倒数。令 $\\pi_y = 1/\\sigma^2$ 为似然的精度，$\\pi_0 = 1/\\tau_0^2$ 为先验的精度。令 $\\pi_{\\text{post}} = 1/\\sigma_{\\text{post}}^2$ 为后验的精度。\n根据我们对后验方差的推导：\n$$ \\frac{1}{\\sigma_{\\text{post}}^2} = \\frac{1}{\\sigma^2} + \\frac{1}{\\tau_0^2} \\implies \\pi_{\\text{post}} = \\pi_y + \\pi_0 $$\n这表明后验精度是似然精度和先验精度的和。\n现在来看后验均值。我们可以通过将分子和分母同时除以 $\\sigma^2 \\tau_0^2$ 来重写 $\\mu_{\\text{post}}$ 的表达式：\n$$ \\mu_{\\text{post}} = \\frac{y\\tau_0^2 + \\mu_0\\sigma^2}{\\sigma^2 + \\tau_0^2} = \\frac{y \\frac{1}{\\sigma^2} + \\mu_0 \\frac{1}{\\tau_0^2}}{\\frac{1}{\\tau_0^2} + \\frac{1}{\\sigma^2}} $$\n用精度来表示，这变为：\n$$ \\mu_{\\text{post}} = \\frac{y \\pi_y + \\mu_0 \\pi_0}{\\pi_y + \\pi_0} = \\frac{\\pi_y}{\\pi_y + \\pi_0} y + \\frac{\\pi_0}{\\pi_y + \\pi_0} \\mu_0 $$\n这种形式完美地说明了后验均值是观测值（测量值）$y$ 和先验均值 $\\mu_0$ 的加权平均，其权重由它们各自的精度决定。更精确（不确定性更小）的来源对最终估计的贡献更大。\n\n最终要求的答案是后验均值和后验方差的闭式表达式。\n后验均值：$\\mu_{\\text{post}} = \\frac{y\\tau_0^2 + \\mu_0\\sigma^2}{\\sigma^2 + \\tau_0^2}$\n后验方差：$\\sigma_{\\text{post}}^2 = \\frac{\\sigma^2 \\tau_0^2}{\\sigma^2 + \\tau_0^2}$",
            "answer": "$$\n\\boxed{\n\\begin{aligned}\n\\mu_{\\text{post}} = \\frac{y\\tau_0^2 + \\mu_0\\sigma^2}{\\sigma^2 + \\tau_0^2} \\\\\n\\sigma_{\\text{post}}^2 = \\frac{\\sigma^2 \\tau_0^2}{\\sigma^2 + \\tau_0^2}\n\\end{aligned}\n}\n$$"
        },
        {
            "introduction": "在神经科学中，神经元的发放计数通常使用泊松过程来建模。本练习将共轭先验的概念应用到对神经脉冲数据的分析中，要求您推导泊松似然与伽马先验结合后的后验分布，并计算对数边缘似然 。边缘似然，或称“证据”，是贝叶斯模型比较中的一个关键量，掌握其计算方法是评估和选择不同神经编码模型的必备技能。",
            "id": "3964667",
            "problem": "在一个平稳的刺激下，观察一个皮层神经元在 $n$ 个不重叠的时间窗口内的活动，这些窗口的持续时间已知，分别为 $t_1, t_2, \\dots, t_n$，且 $t_i  0$。设脉冲计数为 $y_1, y_2, \\dots, y_n$，其中每个 $y_i \\in \\{0,1,2,\\dots\\}$。假设在给定恒定发放率 $\\lambda$ 的条件下，脉冲计数服从泊松过程模型，因此对于不同的 $i$，$y_i \\mid \\lambda \\sim \\operatorname{Poisson}(\\lambda t_i)$ 相互独立。关于 $\\lambda$ 的先验信念由一个伽马分布编码，其形状参数为 $\\alpha  0$，速率参数为 $\\beta  0$，即对于 $\\lambda  0$，$p(\\lambda) = \\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)} \\lambda^{\\alpha - 1} \\exp(-\\beta \\lambda)$。\n\n从泊松似然、伽马先验和贝叶斯定理的定义出发，通过对 $\\lambda$ 进行积分来推导后验分布 $p(\\lambda \\mid y_1, \\dots, y_n)$ 和边际似然 $p(y_1, \\dots, y_n)$。然后，给出对数边际似然 $\\log p(y_1, \\dots, y_n)$ 作为 $\\alpha$、$\\beta$、$\\{y_i\\}_{i=1}^n$ 和 $\\{t_i\\}_{i=1}^n$ 的函数的闭式表达式。请以精确的解析形式给出 $\\log p(y_1, \\dots, y_n)$ 的最终答案，无需任何近似。",
            "solution": "问题要求对于一个神经脉冲发放的泊松模型，在发放率 $\\lambda$ 服从伽马先验分布的情况下，推导其后验分布 $p(\\lambda \\mid y_1, \\dots, y_n)$、边际似然 $p(y_1, \\dots, y_n)$ 和对数边际似然 $\\log p(y_1, \\dots, y_n)$。\n\n首先，我们验证问题的陈述。已知条件如下：\n-   来自持续时间为 $t_1, t_2, \\dots, t_n$ 的不重叠时间窗口的一组 $n$ 个脉冲计数 $y_1, y_2, \\dots, y_n$。\n-   似然模型是每个计数的泊松分布，$p(y_i \\mid \\lambda) = \\operatorname{Poisson}(y_i \\mid \\lambda t_i)$，其中观测值在给定 $\\lambda$ 的条件下是独立的。\n-   发放率 $\\lambda$ 的先验分布是伽马分布，$p(\\lambda) = \\operatorname{Gamma}(\\lambda \\mid \\alpha, \\beta)$，其形状参数 $\\alpha  0$，速率参数 $\\beta  0$。\n\n该问题具有科学依据，因为泊松过程是脉冲计数的典型模型，而伽马分布是其标准共轭先验，构成了计算神经科学中贝叶斯分析的基石。该问题是良定的、客观的和完整的，为得到唯一的解析解提供了所有必要信息。因此，该问题是有效的。\n\n我们开始推导。\n\n单个观测值 $y_i$ 的似然由泊松概率质量函数给出：\n$$p(y_i \\mid \\lambda) = \\frac{(\\lambda t_i)^{y_i} \\exp(-\\lambda t_i)}{y_i!}$$\n由于观测值在给定 $\\lambda$ 的条件下是独立的，因此数据集 $Y = (y_1, \\dots, y_n)$ 的总似然是各个似然的乘积：\n$$p(Y \\mid \\lambda) = \\prod_{i=1}^{n} p(y_i \\mid \\lambda) = \\prod_{i=1}^{n} \\frac{(\\lambda t_i)^{y_i} \\exp(-\\lambda t_i)}{y_i!}$$\n我们可以将依赖于 $\\lambda$ 的项组合在一起：\n$$p(Y \\mid \\lambda) = \\left( \\prod_{i=1}^{n} \\frac{t_i^{y_i}}{y_i!} \\right) \\left( \\prod_{i=1}^{n} \\lambda^{y_i} \\right) \\left( \\prod_{i=1}^{n} \\exp(-\\lambda t_i) \\right)$$\n$$p(Y \\mid \\lambda) = \\left( \\prod_{i=1}^{n} \\frac{t_i^{y_i}}{y_i!} \\right) \\lambda^{\\sum_{i=1}^{n} y_i} \\exp\\left(-\\lambda \\sum_{i=1}^{n} t_i\\right)$$\n\n$\\lambda$ 的先验分布是伽马分布：\n$$p(\\lambda) = \\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)} \\lambda^{\\alpha - 1} \\exp(-\\beta \\lambda)$$\n其中 $\\Gamma(\\alpha)$ 是伽马函数。\n\n根据贝叶斯定理，后验分布 $p(\\lambda \\mid Y)$ 与似然和先验的乘积成正比：\n$$p(\\lambda \\mid Y) \\propto p(Y \\mid \\lambda) p(\\lambda)$$\n代入似然和先验的表达式：\n$$p(\\lambda \\mid Y) \\propto \\left[ \\left( \\prod_{i=1}^{n} \\frac{t_i^{y_i}}{y_i!} \\right) \\lambda^{\\sum_{i=1}^{n} y_i} \\exp\\left(-\\lambda \\sum_{i=1}^{n} t_i\\right) \\right] \\left[ \\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)} \\lambda^{\\alpha - 1} \\exp(-\\beta \\lambda) \\right]$$\n我们将所有不依赖于 $\\lambda$ 的项归入比例常数：\n$$p(\\lambda \\mid Y) \\propto \\lambda^{\\sum_{i=1}^{n} y_i} \\exp\\left(-\\lambda \\sum_{i=1}^{n} t_i\\right) \\cdot \\lambda^{\\alpha - 1} \\exp(-\\beta \\lambda)$$\n合并 $\\lambda$ 的幂和指数函数的参数：\n$$p(\\lambda \\mid Y) \\propto \\lambda^{\\left(\\alpha + \\sum_{i=1}^{n} y_i\\right) - 1} \\exp\\left(-\\left(\\beta + \\sum_{i=1}^{n} t_i\\right)\\lambda\\right)$$\n这个表达式是伽马分布的核。我们可以确定后验分布的更新参数。设后验形状参数为 $\\alpha'$，后验速率参数为 $\\beta'$：\n$$\\alpha' = \\alpha + \\sum_{i=1}^{n} y_i$$\n$$\\beta' = \\beta + \\sum_{i=1}^{n} t_i$$\n因此，后验分布是一个伽马分布：\n$$p(\\lambda \\mid Y) = \\operatorname{Gamma}(\\lambda \\mid \\alpha', \\beta') = \\frac{(\\beta')^{\\alpha'}}{\\Gamma(\\alpha')} \\lambda^{\\alpha' - 1} \\exp(-\\beta' \\lambda)$$\n\n接下来，我们推导边际似然 $p(Y)$。这是通过将似然和先验的乘积对 $\\lambda$ 的所有可能值进行积分得到的：\n$$p(Y) = \\int_{0}^{\\infty} p(Y \\mid \\lambda) p(\\lambda) \\,d\\lambda$$\n$$p(Y) = \\int_{0}^{\\infty} \\left[ \\left( \\prod_{i=1}^{n} \\frac{t_i^{y_i}}{y_i!} \\right) \\lambda^{\\sum_{i=1}^{n} y_i} \\exp\\left(-\\lambda \\sum_{i=1}^{n} t_i\\right) \\right] \\left[ \\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)} \\lambda^{\\alpha - 1} \\exp(-\\beta \\lambda) \\right] \\,d\\lambda$$\n我们可以将不依赖于 $\\lambda$ 的项从积分中提出：\n$$p(Y) = \\left( \\prod_{i=1}^{n} \\frac{t_i^{y_i}}{y_i!} \\right) \\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)} \\int_{0}^{\\infty} \\lambda^{\\left(\\alpha + \\sum_{i=1}^{n} y_i\\right) - 1} \\exp\\left(-\\left(\\beta + \\sum_{i=1}^{n} t_i\\right)\\lambda\\right) \\,d\\lambda$$\n该积分对应于参数为 $\\alpha' = \\alpha + \\sum y_i$ 和 $\\beta' = \\beta + \\sum t_i$ 的未归一化伽马分布。已知该积分的值为 $\\frac{\\Gamma(\\alpha')}{(\\beta')^{\\alpha'}}$。代入此结果：\n$$p(Y) = \\left( \\prod_{i=1}^{n} \\frac{t_i^{y_i}}{y_i!} \\right) \\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)} \\frac{\\Gamma(\\alpha')}{(\\beta')^{\\alpha'}} = \\left( \\prod_{i=1}^{n} \\frac{t_i^{y_i}}{y_i!} \\right) \\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)} \\frac{\\Gamma\\left(\\alpha + \\sum_{i=1}^{n} y_i\\right)}{\\left(\\beta + \\sum_{i=1}^{n} t_i\\right)^{\\alpha + \\sum_{i=1}^{n} y_i}}$$\n\n最后，我们通过对 $p(Y)$ 的表达式取自然对数来计算对数边际似然 $\\log p(Y)$：\n$$\\log p(Y) = \\log\\left[ \\left( \\prod_{i=1}^{n} \\frac{t_i^{y_i}}{y_i!} \\right) \\frac{\\beta^{\\alpha} \\Gamma\\left(\\alpha + \\sum_{i=1}^{n} y_i\\right)}{\\Gamma(\\alpha) \\left(\\beta + \\sum_{i=1}^{n} t_i\\right)^{\\alpha + \\sum_{i=1}^{n} y_i}} \\right]$$\n利用对数的性质，我们可以展开这个表达式：\n$$\\log p(Y) = \\log\\left(\\prod_{i=1}^{n} \\frac{t_i^{y_i}}{y_i!}\\right) + \\log\\left(\\beta^{\\alpha}\\right) + \\log\\left(\\Gamma\\left(\\alpha + \\sum_{i=1}^{n} y_i\\right)\\right) - \\log(\\Gamma(\\alpha)) - \\log\\left(\\left(\\beta + \\sum_{i=1}^{n} t_i\\right)^{\\alpha + \\sum_{i=1}^{n} y_i}\\right)$$\n这可以简化为：\n$$\\log p(Y) = \\sum_{i=1}^{n} \\left( \\log(t_i^{y_i}) - \\log(y_i!) \\right) + \\alpha \\log(\\beta) + \\log\\left(\\Gamma\\left(\\alpha + \\sum_{i=1}^{n} y_i\\right)\\right) - \\log(\\Gamma(\\alpha)) - \\left(\\alpha + \\sum_{i=1}^{n} y_i\\right) \\log\\left(\\beta + \\sum_{i=1}^{n} t_i\\right)$$\n使用 $\\ln$ 表示自然对数并进一步简化各项：\n$$\\log p(Y) = \\sum_{i=1}^{n} \\left(y_i \\ln(t_i) - \\ln(y_i!)\\right) + \\alpha \\ln(\\beta) + \\ln\\left(\\Gamma\\left(\\alpha + \\sum_{i=1}^{n} y_i\\right)\\right) - \\ln(\\Gamma(\\alpha)) - \\left(\\alpha + \\sum_{i=1}^{n} y_i\\right) \\ln\\left(\\beta + \\sum_{i=1}^{n} t_i\\right)$$\n为了清晰起见，重新整理各项，得到对数边际似然的最终表达式：\n$$\\log p(Y) = \\ln\\left(\\Gamma\\left(\\alpha + \\sum_{i=1}^{n} y_i\\right)\\right) - \\ln(\\Gamma(\\alpha)) + \\alpha \\ln(\\beta) - \\left(\\alpha + \\sum_{i=1}^{n} y_i\\right)\\ln\\left(\\beta + \\sum_{i=1}^{n} t_i\\right) + \\sum_{i=1}^{n} \\left(y_i \\ln(t_i) - \\ln(y_i!)\\right)$$\n这就是所要求的闭式解析表达式。",
            "answer": "$$\n\\boxed{\\ln\\left(\\Gamma\\left(\\alpha + \\sum_{i=1}^{n} y_i\\right)\\right) - \\ln(\\Gamma(\\alpha)) + \\alpha \\ln(\\beta) - \\left(\\alpha + \\sum_{i=1}^{n} y_i\\right)\\ln\\left(\\beta + \\sum_{i=1}^{n} t_i\\right) + \\sum_{i=1}^{n} \\left(y_i \\ln(t_i) - \\ln(y_i!)\\right)}\n$$"
        },
        {
            "introduction": "一个成功的贝叶斯工作流不仅包括模型构建与参数推断，还必须包含严格的模型检验环节。本练习将理论付诸实践，要求您通过编写代码，为先前建立的泊松-伽马模型执行后验预测检验 。通过计算一个衡量数据离散程度的检验统计量，并将其与模型生成的模拟数据进行比较，您将学会如何诊断模型失配问题，这是确保从模型中得出的科学结论可靠性的关键一步。",
            "id": "3964656",
            "problem": "给定一个离散时间、等宽时间窗的脉冲序列模型，每个时间窗的持续时间为 $\\Delta$ 秒。设 $y = (y_1,\\dots,y_B)$ 是从单个神经元观测到的时间窗内的脉冲计数。假设在给定一个未知的恒定发放强度 $\\lambda$（单位：脉冲/秒）的条件下，观测结果是条件独立的泊松分布。因此，给定 $\\lambda$，对于 $i \\in \\{1,\\dots,B\\}$ 中的每一个，时间窗计数 $y_i \\mid \\lambda \\sim \\text{Poisson}(\\lambda \\Delta)$ 并且相互独立。$\\lambda$ 的先验分布为 $\\lambda \\sim \\text{Gamma}(\\alpha_0,\\beta_0)$，采用形状-速率参数化（即，其密度正比于 $\\lambda^{\\alpha_0 - 1} \\exp(-\\beta_0 \\lambda)$）。您将使用离散度统计量进行后验预测检验：\n$$\nT(y) \\equiv \\frac{1}{B} \\sum_{i=1}^B (y_i - \\bar{y})^2 - \\bar{y}, \\quad \\text{其中} \\quad \\bar{y} \\equiv \\frac{1}{B}\\sum_{i=1}^B y_i.\n$$\n对于后验预测检验，将后验预测 $p$-值定义为：\n$$\np \\equiv \\Pr\\big(T(\\tilde{y}) \\ge T(y) \\mid y\\big),\n$$\n其中 $\\tilde{y}$ 是从后验预测分布中抽取的重复数据集。通过蒙特卡洛后验预测模拟计算 $p$ 值，并将其报告为四舍五入到四位小数的小数。\n\n您可以使用的基本原理：\n- 条件概率、贝叶斯定理和全概率定律的定义。\n- 用于计数的泊松似然和伽马先验族群的定义。\n- 在给定 $\\lambda$ 的条件下，观测值是独立的这一性质。\n\n您的程序必须为每个测试用例实现以下步骤：\n1. 使用贝叶斯定理和给定的先验-似然配对，从第一性原理推导 $\\lambda \\mid y$ 的后验分布。\n2. 通过首先从后验分布中抽样 $\\lambda$，然后对于 $i \\in \\{1,\\dots,B\\}$，独立地抽样 $\\tilde{y}_i \\mid \\lambda \\sim \\text{Poisson}(\\lambda \\Delta)$ 来生成后验预测重复样本。\n3. 计算观测数据的 $T(y)$ 和每个重复样本的 $T(\\tilde{y})$。\n4. 将 $p$ 估计为满足 $T(\\tilde{y}) \\ge T(y)$ 的重复样本在蒙特卡洛模拟中所占的比例。\n\n为了可复现性，请使用以下固定的蒙特卡洛设置：\n- 每个测试用例使用恰好 $120000$ 个后验预测重复样本。\n- 使用固定的伪随机种子，其值为 $12345$。\n\n测试套件：\n- 案例 A（模型设定良好，近似泊松分布的计数）：\n  - 先验超参数：$\\alpha_0 = 10^{-3}$，$\\beta_0 = 10^{-3}$。\n  - 时间窗数量：$B = 30$。\n  - 时间窗宽度：$\\Delta = 0.01$ 秒。\n  - 观测计数 $y$（长度 30）：$[\\,0,1,1,0,1,1,1,0,2,0,0,1,0,1,0,1,1,0,1,0,2,1,0,1,0,0,1,1,0,0\\,]$。\n- 案例 B（过离散，爆发性计数）：\n  - 先验超参数：$\\alpha_0 = 10^{-3}$，$\\beta_0 = 10^{-3}$。\n  - 时间窗数量：$B = 30$。\n  - 时间窗宽度：$\\Delta = 0.01$ 秒。\n  - 观测计数 $y$（长度 30）：$[\\,0,2,0,0,1,3,0,0,0,2,1,0,0,1,0,4,0,0,2,0,1,0,0,3,0,0,1,0,2,0\\,]$。\n- 案例 C（欠离散，近二元计数）：\n  - 先验超参数：$\\alpha_0 = 10^{-3}$，$\\beta_0 = 10^{-3}$。\n  - 时间窗数量：$B = 30$。\n  - 时间窗宽度：$\\Delta = 0.01$ 秒。\n  - 观测计数 $y$（长度 30）：$[\\,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,0,1,0,0,1,0\\,]$。\n\n要求：\n- 您的程序应为每个测试用例计算一个后验预测 $p$-值，共计三个，并生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。例如，输出格式必须严格为 $[p_A,p_B,p_C]$ 的形式，每个值四舍五入到四位小数，并以小数表示（不含百分号）。\n- 不允许外部输入；所有数据均已在上方提供。最终输出必须是具有确切要求格式的单行文本。",
            "solution": "在尝试解决方案之前，需要对问题进行验证。\n\n### 步骤 1：提取已知条件\n所有原始数据、变量和条件的列表如下：\n- **模型**：离散时间脉冲序列模型。\n- **时间窗持续时间**：$\\Delta$（秒）。\n- **观测数据**：$y = (y_1,\\dots,y_B)$ 是从单个神经元观测到的时间窗计数。\n- **似然**：在给定一个未知的恒定发放强度 $\\lambda$（单位：脉冲/秒）的条件下，观测结果是条件独立的泊松分布。对于每个时间窗 $i$，有 $y_i \\mid \\lambda \\sim \\text{Poisson}(\\lambda \\Delta)$。\n- **先验**：$\\lambda \\sim \\text{Gamma}(\\alpha_0,\\beta_0)$，采用形状-速率参数化，其密度正比于 $\\lambda^{\\alpha_0 - 1} \\exp(-\\beta_0 \\lambda)$。\n- **任务**：使用离散度统计量 $T(y) \\equiv \\frac{1}{B} \\sum_{i=1}^B (y_i - \\bar{y})^2 - \\bar{y}$ 进行后验预测检验，其中 $\\bar{y} \\equiv \\frac{1}{B}\\sum_{i=1}^B y_i$。\n- **目标量**：后验预测 $p$-值，定义为 $p \\equiv \\Pr\\big(T(\\tilde{y}) \\ge T(y) \\mid y\\big)$，其中 $\\tilde{y}$ 是一个重复数据集。\n- **方法**：通过蒙特卡洛后验预测模拟计算 $p$。\n- **蒙特卡洛设置**：$120000$ 个后验预测重复样本；固定的伪随机种子为 $12345$。\n- **测试案例 A**：$\\alpha_0 = 10^{-3}$，$\\beta_0 = 10^{-3}$，$B = 30$，$\\Delta = 0.01$，$y = [\\,0,1,1,0,1,1,1,0,2,0,0,1,0,1,0,1,1,0,1,0,2,1,0,1,0,0,1,1,0,0\\,]$。\n- **测试案例 B**：$\\alpha_0 = 10^{-3}$，$\\beta_0 = 10^{-3}$，$B = 30$，$\\Delta = 0.01$，$y = [\\,0,2,0,0,1,3,0,0,0,2,1,0,0,1,0,4,0,0,2,0,1,0,0,3,0,0,1,0,2,0\\,]$。\n- **测试案例 C**：$\\alpha_0 = 10^{-3}$，$\\beta_0 = 10^{-3}$，$B = 30$，$\\Delta = 0.01$，$y = [\\,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,0,1,0,0,1,0\\,]$。\n- **输出格式**：单行输出 `[p_A,p_B,p_C]`，每个值四舍五入到四位小数。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n- **科学依据**：该问题基于应用于计算神经科学的标准贝叶斯统计方法。泊松-伽马模型是处理计数数据的经典共轭配对模型，其在神经脉冲序列上的应用是一项成熟的技术。离散度统计量是检验泊松假设（均值等于方差）的有效度量。整个过程在科学上是合理的。\n- **适定性**：该问题是适定的。后验分布的推导是标准的教科书练习。模拟算法被精确指定，包括重复样本数量和随机种子，从而确保了一个唯一且稳定的解（取决于伪随机数生成器的具体实现）。\n- **客观性**：问题以精确的数学语言陈述，没有任何主观或模棱两可的术语。\n- **完整性**：问题是自洽的。所有必要的信息，包括模型、先验超参数、三个不同案例的观测数据以及模拟参数，都已明确提供。\n- **一致性与真实性**：所提供的数据和参数是一致且合理的。这三个数据集代表了神经发放模式的经典例子：近似泊松分布、过离散（爆发性）和欠离散（规则性），这些在神经科学研究中很常见。\n\n### 步骤 3：结论与行动\n该问题在科学上合理、适定且完整。因此，它被判定为**有效**。将提供完整的解决方案。\n\n问题的核心是评估一个简单的神经元发放模型——一个假设发放率恒定的模型——与观测数据的拟合情况。这是通过后验预测检验（一种标准的贝叶斯模型检验技术）来实现的。该过程包括推导模型参数的后验分布，从模型中模拟重复数据，并比较观测数据和重复数据的选定检验统计量。\n\n首先，我们推导在给定观测脉冲计数 $y=(y_1, \\dots, y_B)$ 的情况下，发放率 $\\lambda$ 的后验分布。给定 $\\lambda$ 时，观测到数据 $y$ 的似然函数是每个独立计数的概率之积：\n$$\np(y \\mid \\lambda) = \\prod_{i=1}^B \\text{Poisson}(y_i \\mid \\lambda\\Delta) = \\prod_{i=1}^B \\frac{(\\lambda\\Delta)^{y_i} e^{-\\lambda\\Delta}}{y_i!}\n$$\n作为 $\\lambda$ 的函数，这正比于：\n$$\np(y \\mid \\lambda) \\propto \\left( \\prod_{i=1}^B (\\lambda\\Delta)^{y_i} \\right) \\left( \\prod_{i=1}^B e^{-\\lambda\\Delta} \\right) = (\\lambda\\Delta)^{\\sum y_i} e^{-B\\lambda\\Delta} \\propto \\lambda^{\\sum y_i} e^{-(B\\Delta)\\lambda}\n$$\n令 $S = \\sum_{i=1}^B y_i$ 为观测到的总脉冲数。则似然函数正比于 $\\lambda^S e^{-(B\\Delta)\\lambda}$。$\\lambda$ 的先验分布是形状参数为 $\\alpha_0$、速率参数为 $\\beta_0$ 的伽马分布：\n$$\np(\\lambda) \\propto \\lambda^{\\alpha_0 - 1} e^{-\\beta_0\\lambda}\n$$\n根据贝叶斯定理，后验分布 $p(\\lambda \\mid y)$ 正比于似然函数和先验分布的乘积：\n$$\np(\\lambda \\mid y) \\propto p(y \\mid \\lambda) p(\\lambda) \\propto (\\lambda^S e^{-(B\\Delta)\\lambda}) (\\lambda^{\\alpha_0 - 1} e^{-\\beta_0\\lambda})\n$$\n合并包含 $\\lambda$ 的项，得到：\n$$\np(\\lambda \\mid y) \\propto \\lambda^{S + \\alpha_0 - 1} e^{-(B\\Delta + \\beta_0)\\lambda}\n$$\n这个表达式是一个伽马分布的核。因此，后验分布也是一个伽马分布，这一性质被称为共轭性。$\\lambda$ 的后验分布是：\n$$\n\\lambda \\mid y \\sim \\text{Gamma}(\\alpha_N, \\beta_N)\n$$\n其中，后验超参数更新如下：\n- 后验形状：$\\alpha_N = \\alpha_0 + S = \\alpha_0 + \\sum_{i=1}^B y_i$\n- 后验速率：$\\beta_N = \\beta_0 + B\\Delta$\n\n接下来，我们执行后验预测检验。这包括将观测数据与模型预测的数据进行比较。我们从后验预测分布 $p(\\tilde{y} \\mid y) = \\int p(\\tilde{y} \\mid \\lambda) p(\\lambda \\mid y) d\\lambda$ 中模拟重复数据集 $\\tilde{y}$。模拟过程分两步：首先从其后验分布中抽取一个参数值，然后以该参数为条件抽取数据。\n\n用于蒙特卡洛估计后验预测 $p$-值 $p = \\Pr(T(\\tilde{y}) \\ge T(y) \\mid y)$ 的算法如下：\n1. 对于观测数据 $y$，计算检验统计量的观测值 $T(y)$。统计量 $T(y) = \\frac{1}{B} \\sum_{i=1}^B (y_i - \\bar{y})^2 - \\bar{y}$ 衡量计数的离散程度。对于泊松分布，方差等于均值，因此如果数据确实是以固定速率服从泊松分布，我们期望 $T(y)$ 接近于 0。\n2. 使用观测数据计算后验超参数 $\\alpha_N$ 和 $\\beta_N$。\n3. 生成大量（$N_{mc} = 120000$）的后验预测重复样本。对于每个重复样本 $j \\in \\{1, \\dots, N_{mc}\\}$：\n    a. 从其后验分布中抽取发放率样本：$\\lambda^{(j)} \\sim \\text{Gamma}(\\alpha_N, \\beta_N)$。\n    b. 通过从具有采样率的泊松分布中抽取每个计数来生成重复数据集 $\\tilde{y}^{(j)} = (\\tilde{y}_1^{(j)}, \\dots, \\tilde{y}_B^{(j)})$：对于 $i \\in \\{1, \\dots, B\\}$，有 $\\tilde{y}_i^{(j)} \\sim \\text{Poisson}(\\lambda^{(j)}\\Delta)$。\n    c. 计算该重复样本的检验统计量：$T(\\tilde{y}^{(j)})$。\n4. $p$-值被估计为检验统计量大于或等于观测检验统计量的重复样本所占的比例：\n$$\np \\approx \\frac{1}{N_{mc}} \\sum_{j=1}^{N_{mc}} \\mathbb{I}(T(\\tilde{y}^{(j)}) \\ge T(y))\n$$\n其中 $\\mathbb{I}(\\cdot)$ 是指示函数。\n\n接近 0 或 1 的 $p$-值表明，在模型的预测下，观测数据是不典型的，这表明模型存在失拟合。对于此离散度统计量，接近 0 的 $p$-值意味着观测数据的离散度比模型预期的要大（例如，爆发性发放）。接近 1 的 $p$-值意味着观测数据的离散度比模型预期的要小（更规则）。\n\n现在将对提供的三个测试案例实施此程序，使用指定的固定随机种子以保证可复现性。每个案例的最终结果将四舍五入到四位小数。",
            "answer": "[0.4194,0.0016,0.9996]"
        }
    ]
}