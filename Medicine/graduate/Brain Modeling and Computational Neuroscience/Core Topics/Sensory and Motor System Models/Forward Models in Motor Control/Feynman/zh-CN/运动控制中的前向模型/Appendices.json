{
    "hands_on_practices": [
        {
            "introduction": "前向模型的核心思想是利用当前的运动指令（即传出神经副本）和状态来预测未来的感觉结果。为了掌握这一基本原理，我们从一个简化的线性系统开始。这项练习将指导你为一个单关节系统构建一个最基础的前向模型，让你亲手推导出一步预测方程，从而深刻理解状态、运动指令和系统动力学模型是如何协同作用以产生预测的。",
            "id": "3982443",
            "problem": "单个人类肘关节可被理想化为一个单自由度旋转系统，其运动学遵循对连续时间关系进行的离散时间前向欧拉积分。考虑一个由中枢神经系统 (CNS) 部署的最小内部前向模型，该模型使用指令性力矩类信号的传出副本 (EC) 来预测提前一个采样步的动作即时感觉后果（关节角度）。该系统由一个包含关节角度和角速度的状态来建模，其离散时间动态由 $x_{t+1}=x_{t}+\\Delta t\\,\\omega_{t}$ 和 $\\omega_{t+1}=\\omega_{t}+\\Delta t\\,\\alpha\\,u_{t}$ 给出，其中 $x_{t}$ 是时间步 $t$ 的关节角度，$\\omega_{t}$ 是时间步 $t$ 的角速度，$\\Delta t$ 是采样间隔，$\\alpha$ 是一个已知的正增益，它将运动指令映射到角加速度，而 $u_{t}$ 是时间 $t$ 的运动指令。假设无噪声的感觉测量就是角度本身，因此时间 $t$ 的感觉后果是 $s_{t}=x_{t}$。构建一个最小前向模型，该模型使用当前状态 $(x_{t},\\omega_{t})$ 和运动指令 $u_{t}$ 的传出副本 (EC) 向前传播一步，以预测下一个时间步的角度测量值 $\\hat{s}_{t+1}$。根据第一性原理和运动控制中状态空间前向模型的核心定义，推导出一个用 $x_{t}$、$\\omega_{t}$、$\\Delta t$、$\\alpha$ 和 $u_{t}$ 表示的预测感觉角度 $\\hat{s}_{t+1}$ 的闭式解析表达式。将最终答案表示为单个解析表达式。无需四舍五入。",
            "solution": "问题陈述已经过严格验证，被认为是具有科学依据、适定、客观且内部一致的。它提出了一个标准的、尽管简化的单关节系统的状态空间模型，并要求基于明确定义的动态进行单步预测。所有必要的数据和定义都已提供。因此，该问题是有效的。\n\n核心任务是推导下一个时间步的预测感觉角度 $\\hat{s}_{t+1}$ 的表达式。在运动控制的背景下，前向模型是一种内部神经过程，它模拟运动系统（“受控体”）的动态，以预测运动指令的感觉后果。它将受控体的当前估计状态和运动指令的传出副本作为输入，并输出下一个感觉状态的预测。\n\n问题将系统在离散时间步 $t$ 的状态定义为关节角度 $x_t$ 和角速度 $\\omega_t$。运动指令为 $u_t$。时间 $t$ 的感觉测量是角度本身，因此 $s_t = x_t$。因此，时间 $t+1$ 的预测感觉角度（表示为 $\\hat{s}_{t+1}$）等同于时间 $t+1$ 的预测关节角度，我们将其表示为 $\\hat{x}_{t+1}$。\n\n问题明确提供了受控体的离散时间动态，这是使用前向欧拉积分方案建模的。这些动态构成了中枢神经系统 (CNS) 用于其预测的“内部模型”。这些方程是：\n$$x_{t+1} = x_{t} + \\Delta t\\,\\omega_{t}$$\n$$\\omega_{t+1} = \\omega_{t} + \\Delta t\\,\\alpha\\,u_{t}$$\n此处，$\\Delta t$ 是采样间隔，$\\alpha$ 是一个增益参数。\n\n前向模型的功能是基于时间 $t$ 的已知状态 $(x_t, \\omega_t)$ 和时间 $t$ 的已知运动指令 $u_t$，计算时间 $t+1$ 的预测状态 $(\\hat{x}_{t+1}, \\hat{\\omega}_{t+1})$。这是通过将系统的动态方程向前应用一个时间步来实现的。\n\n为了找到预测角度 $\\hat{x}_{t+1}$，我们必须应用第一个动态方程。这个方程定义了角度如何从一个时间步演变到下一个时间步：\n$$\\hat{x}_{t+1} = x_{t} + \\Delta t\\,\\omega_{t}$$\n下一个角度的预测值 $\\hat{x}_{t+1}$ 是使用当前角度 $x_t$ 和当前角速度 $\\omega_t$ 计算的。\n\n第二个动态方程描述了角速度的演变：\n$$\\hat{\\omega}_{t+1} = \\omega_{t} + \\Delta t\\,\\alpha\\,u_{t}$$\n模型的这一部分使用当前速度 $\\omega_t$ 和运动指令 $u_t$ 来预测下一个时间步的速度 $\\hat{\\omega}_{t+1}$。\n\n问题要求的是预测的感觉角度 $\\hat{s}_{t+1}$，即 $\\hat{x}_{t+1}$。根据提供的第一个动态方程，可以直接得到 $\\hat{x}_{t+1}$ 的表达式。\n$$\\hat{s}_{t+1} = \\hat{x}_{t+1} = x_{t} + \\Delta t\\,\\omega_{t}$$\n需要注意的是，根据提供的特定离散时间动态（显式前向欧拉），下一个时间步的角度预测值 $\\hat{x}_{t+1}$ 仅取决于当前状态变量 $x_t$ 和 $\\omega_t$。运动指令 $u_t$ 和增益 $\\alpha$ 影响下一个时间步的预测角*速度* $\\hat{\\omega}_{t+1}$，但它们不出现在下一个时间步的预测*角度*的表达式中。推导必须严格遵守指定的模型。虽然其他数值积分方案（例如，半隐式欧拉）会使得位置更新依赖于 $u_t$，但问题陈述在其动态定义上是明确无误的。提示中提供的变量列表（$x_{t}$、$\\omega_{t}$、$\\Delta t$、$\\alpha$ 和 $u_{t}$）代表了系统的完整可用参数集，并不要求所有参数都必须出现在这个特定预测的最终表达式中。\n\n因此，预测感觉角度 $\\hat{s}_{t+1}$ 的闭式解析表达式是直接从所提供的角度 $x$ 的状态更新方程推导出来的。",
            "answer": "$$\\boxed{x_{t} + \\Delta t \\, \\omega_{t}}$$"
        },
        {
            "introduction": "前向模型的预测本身并不是终点，其关键价值在于与真实的感觉反馈相结合。这项练习模拟了中枢神经系统如何融合来自前向模型的预测和来自本体感觉的嘈杂测量信号。你将运用最优估计理论，推导出一个能最小化状态估计误差的融合策略，从而体会到大脑是如何通过结合多个信息源来获得比任何单一信息源都更精确的身体状态感知的。",
            "id": "3982407",
            "problem": "在运动控制的背景下，中枢神经系统（CNS）将感觉后果的前向模型预测与实际的本体感觉测量相结合，以估计真实的关节角度。考虑在时间 $t$ 的单个关节角度，用标量随机变量 $x_t$ 表示，单位为弧度。本体感觉测量被建模为 $y_t = x_t + \\varepsilon_t$，其中 $\\varepsilon_t$ 是均值为零、方差为 $R$ 的高斯噪声，并且前向模型预测的感觉后果被建模为 $\\hat{y}_t = x_t + \\eta_t$，其中 $\\eta_t$ 是均值为零、方差为 $P$ 的高斯噪声。假设 $\\varepsilon_t$ 和 $\\eta_t$ 相互独立，并且独立于 $x_t$，且两个测量通道都是无偏的。\n\n仅使用加性独立高斯噪声下的无偏线性估计基本原理和均方误差的定义，推导通过融合 $y_t$ 和 $\\hat{y}_t$ 来估计 $x_t$ 时，能够最小化期望平方误差的估计器。然后，对于参数 $R = 0.01$ 和 $P = 0.005$，计算可达到的最小均方误差（其值等于最优情况下的估计误差方差）。\n\n将最终的最小均方误差以平方弧度（rad$^2$）表示，并将您的答案四舍五入到四位有效数字。角度单位为弧度。",
            "solution": "所述问题具有科学依据、提法恰当、客观且完整。它提出了最优估计理论中的一个经典问题，即融合单个潜在状态的两个带噪测量。所有必要组成部分——测量模型、噪声的统计特性、独立性假设以及目标函数（最小化均方误差）——均已提供且相互一致。因此，可以推导出有效的解。\n\n目标是通过线性组合本体感觉测量 $y_t$ 和前向模型预测 $\\hat{y}_t$ 来找到真实关节角度 $x_t$ 的最优估计。设融合后的估计值为 $\\hat{x}_t$。由于我们寻求的是线性估计器，它可以写成两个可用信号的加权和：\n$$\n\\hat{x}_t = w_1 y_t + w_2 \\hat{y}_t\n$$\n其中 $w_1$ 和 $w_2$ 是待确定的权重。\n\n问题要求估计器是无偏的。如果估计误差的期望为零，则估计器是无偏的，这意味着估计值的期望值等于被估计的真实量的期望值。\n$$\nE[\\hat{x}_t] = E[x_t]\n$$\n让我们计算线性估计器的期望：\n$$\nE[\\hat{x}_t] = E[w_1 y_t + w_2 \\hat{y}_t] = w_1 E[y_t] + w_2 E[\\hat{y}_t]\n$$\n问题陈述了 $y_t = x_t + \\varepsilon_t$ 和 $\\hat{y}_t = x_t + \\eta_t$。噪声项 $\\varepsilon_t$ 和 $\\eta_t$ 都是零均值的，即 $E[\\varepsilon_t] = 0$ 且 $E[\\eta_t] = 0$。因此，测量的期望是：\n$$\nE[y_t] = E[x_t + \\varepsilon_t] = E[x_t] + E[\\varepsilon_t] = E[x_t]\n$$\n$$\nE[\\hat{y}_t] = E[x_t + \\eta_t] = E[x_t] + E[\\eta_t] = E[x_t]\n$$\n将这些代入 $E[\\hat{x}_t]$ 的表达式中：\n$$\nE[\\hat{x}_t] = w_1 E[x_t] + w_2 E[x_t] = (w_1 + w_2) E[x_t]\n$$\n为了使无偏性条件 $E[\\hat{x}_t] = E[x_t]$ 对 $x_t$ 的任何可能分布都成立，权重之和必须为1：\n$$\nw_1 + w_2 = 1\n$$\n这个约束使我们能够用一个未知权重（设为 $w = w_1$，则 $w_2 = 1 - w$）来表示估计器：\n$$\n\\hat{x}_t = w y_t + (1 - w) \\hat{y}_t\n$$\n下一步是最小化均方误差（MSE），其定义为 $\\text{MSE} = E[(\\hat{x}_t - x_t)^2]$。我们首先用噪声源来表示估计误差 $e_t = \\hat{x}_t - x_t$：\n$$\ne_t = \\left(w y_t + (1 - w) \\hat{y}_t\\right) - x_t\n$$\n代入 $y_t = x_t + \\varepsilon_t$ 和 $\\hat{y}_t = x_t + \\eta_t$：\n$$\ne_t = w(x_t + \\varepsilon_t) + (1 - w)(x_t + \\eta_t) - x_t\n$$\n$$\ne_t = w x_t + w \\varepsilon_t + x_t - w x_t + \\eta_t - w \\eta_t - x_t\n$$\n$$\ne_t = w \\varepsilon_t + (1 - w) \\eta_t\n$$\n注意，误差的期望是 $E[e_t] = w E[\\varepsilon_t] + (1-w)E[\\eta_t] = w(0) + (1-w)(0) = 0$，这证实了估计器是无偏的。MSE是这个误差平方的期望，由于误差均值为零，这等价于误差的方差。\n$$\n\\text{MSE} = E[e_t^2] = E\\left[(w \\varepsilon_t + (1 - w) \\eta_t)^2\\right]\n$$\n$$\n\\text{MSE} = E\\left[w^2 \\varepsilon_t^2 + (1 - w)^2 \\eta_t^2 + 2w(1 - w)\\varepsilon_t \\eta_t\\right]\n$$\n根据期望的线性性质：\n$$\n\\text{MSE} = w^2 E[\\varepsilon_t^2] + (1 - w)^2 E[\\eta_t^2] + 2w(1 - w)E[\\varepsilon_t \\eta_t]\n$$\n问题指定噪声方差为 $\\text{Var}(\\varepsilon_t) = E[\\varepsilon_t^2] - (E[\\varepsilon_t])^2 = E[\\varepsilon_t^2] = R$ 和 $\\text{Var}(\\eta_t) = E[\\eta_t^2] - (E[\\eta_t])^2 = E[\\eta_t^2] = P$。它还指出 $\\varepsilon_t$ 和 $\\eta_t$ 是相互独立的。因此，它们乘积的期望等于它们各自期望的乘积：$E[\\varepsilon_t \\eta_t] = E[\\varepsilon_t] E[\\eta_t] = 0 \\cdot 0 = 0$。\n将这些代入MSE表达式，得到MSE作为权重 $w$ 的函数：\n$$\n\\text{MSE}(w) = w^2 R + (1 - w)^2 P\n$$\n为了找到最小化MSE的权重 $w$，我们将 $\\text{MSE}(w)$ 对 $w$ 求导，并令结果为零：\n$$\n\\frac{d}{dw}\\text{MSE}(w) = \\frac{d}{dw}\\left[w^2 R + (1 - w)^2 P\\right] = 2wR + 2(1 - w)(-1)P = 2wR - 2P + 2wP\n$$\n令导数为零：\n$$\n2wR - 2P + 2wP = 0\n$$\n$$\nw(R+P) = P\n$$\n因此，最优权重 $w^*$ 为：\n$$\nw^* = w_1^* = \\frac{P}{R+P}\n$$\n第二个测量的相应最优权重是 $w_2^* = 1 - w^* = 1 - \\frac{P}{R+P} = \\frac{R}{R+P}$。为了确认这是一个最小值，二阶导数 $\\frac{d^2}{dw^2}\\text{MSE}(w) = 2R + 2P$ 是正的，因为方差 $R$ 和 $P$ 都是正的。\n\n最后，我们将最优权重 $w^*$ 代回MSE公式，计算可达到的最小MSE，即 $\\text{MSE}_{\\min}$：\n$$\n\\text{MSE}_{\\min} = (w^*)^2 R + (1 - w^*)^2 P\n$$\n$$\n\\text{MSE}_{\\min} = \\left(\\frac{P}{R+P}\\right)^2 R + \\left(\\frac{R}{R+P}\\right)^2 P\n$$\n$$\n\\text{MSE}_{\\min} = \\frac{P^2 R}{(R+P)^2} + \\frac{R^2 P}{(R+P)^2} = \\frac{P^2 R + R^2 P}{(R+P)^2}\n$$\n从分子中提出公因式 $RP$：\n$$\n\\text{MSE}_{\\min} = \\frac{RP(P+R)}{(R+P)^2} = \\frac{RP}{R+P}\n$$\n这个简洁的结果表明，最小MSE的倒数（融合后的精度）等于各个方差的倒数（各自的精度）之和：$\\frac{1}{\\text{MSE}_{\\min}} = \\frac{1}{P} + \\frac{1}{R}$。\n\n现在，我们代入给定的数值，$R = 0.01 \\, \\text{rad}^2$ 和 $P = 0.005 \\, \\text{rad}^2$：\n$$\n\\text{MSE}_{\\min} = \\frac{(0.01)(0.005)}{0.01 + 0.005} = \\frac{0.00005}{0.015}\n$$\n$$\n\\text{MSE}_{\\min} = \\frac{5 \\times 10^{-5}}{1.5 \\times 10^{-2}} = \\frac{5}{1.5} \\times 10^{-3} = \\frac{10}{3} \\times 10^{-3} = \\frac{1}{300}\n$$\n作为小数，这是 $0.003333...$ $\\text{rad}^2$。问题要求四舍五入到四位有效数字。前四位有效数字是 $3$、$3$、$3$ 和 $3$。第五位数字是 $3$，小于 $5$，所以我们不向上取整。\n最小均方误差是 $0.003333 \\, \\text{rad}^2$。",
            "answer": "$$\\boxed{0.003333}$$"
        },
        {
            "introduction": "真实的生物力学系统，如我们的肢体，其动力学行为往往是高度非线性的。为了将前向模型的应用扩展到更现实的场景，我们必须掌握处理非线性系统的方法。本练习将引导你为一个非线性的肘关节模型构建一个扩展卡尔曼滤波器（EKF），这需要你推导描述系统局部线性行为的雅可比矩阵。这是机器人学和计算神经科学领域中进行状态估计的一项基本而强大的技术。",
            "id": "3982422",
            "problem": "考虑一个单自由度肘状肢体，其内部前向模型可预测状态演化和感觉后果。设状态为 $x_t = \\begin{pmatrix} q_t \\\\ \\omega_t \\end{pmatrix}$，其中 $q_t$ 是关节角度，$\\omega_t$ 是关节角速度。控制输入 $u_t$ 是一个神经指令，通过饱和非线性映射到肌肉扭矩。离散时间前向动力学由下式给出\n$$\nx_{t+1} = f(x_t,u_t) + w_t,\n$$\n其中\n$$\nf(x_t,u_t) \\equiv\n\\begin{pmatrix}\nq_t \\\\\n\\omega_t\n\\end{pmatrix}\n+\n\\Delta t\\,\n\\begin{pmatrix}\n\\omega_t \\\\\n\\frac{1}{I}\\big(\\beta\\,\\tanh(u_t) - b\\,\\omega_t - \\kappa\\,\\sin(q_t)\\big)\n\\end{pmatrix},\n$$\n式中 $I>0$ 是肢体惯量，$b>0$ 是粘性阻尼，$\\kappa>0$ 是与重力相关的刚度（例如，对于质量 $m$、重力加速度 $g$ 和杠杆臂 $L$，有 $\\kappa = m g L$），$\\beta>0$ 缩放控制到扭矩的映射，$\\Delta t>0$ 是采样间隔。过程噪声 $w_t$ 是均值为零、协方差为 $Q_t$ 的高斯噪声，记为 $w_t \\sim \\mathcal{N}(0,Q_t)$。感觉测量值为\n$$\ny_t = h(x_t) + v_t,\n$$\n其中\n$$\nh(x_t) \\equiv\n\\begin{pmatrix}\nq_t \\\\\n\\arctan(\\omega_t)\n\\end{pmatrix},\n$$\n以及测量噪声 $v_t \\sim \\mathcal{N}(0,R_t)$。\n\n从非线性状态空间贝叶斯滤波的定义和扩展卡尔曼滤波器 (EKF; Extended Kalman Filter) 所基于的线性化原理出发，使用 $f$ 和 $h$ 在当前工作点的一阶泰勒展开，推导用于状态均值和协方差的 EKF 预测和更新方程。然后，对于上述特定模型，显式计算在一般状态 $x_t = \\begin{pmatrix} q_t \\\\ \\omega_t \\end{pmatrix}$ 和输入 $u_t$ 下，预测和更新步骤所需的雅可比矩阵 $\\frac{\\partial f}{\\partial x}$、$\\frac{\\partial f}{\\partial u}$ 和 $\\frac{\\partial h}{\\partial x}$。\n\n答案规格：将你的最终答案以单块行拼接矩阵 $[A_t\\;\\;B_t\\;\\;H_t]$ 的形式给出，其中 $A_t \\in \\mathbb{R}^{2\\times 2}$，$B_t \\in \\mathbb{R}^{2\\times 1}$，$H_t \\in \\mathbb{R}^{2\\times 2}$。请以符号形式表示最终答案（不要进行数值代入），并且不要包含任何单位。无需四舍五入。",
            "solution": "首先对用户提供的问题进行验证过程。\n\n### 步骤1：提取已知条件\n- 状态向量：$x_t = \\begin{pmatrix} q_t \\\\ \\omega_t \\end{pmatrix}$，其中 $q_t$ 是关节角度，$\\omega_t$ 是关节角速度。\n- 控制输入：$u_t$。\n- 离散时间动力学模型：$x_{t+1} = f(x_t,u_t) + w_t$。\n- 动力学函数：$f(x_t,u_t) \\equiv \\begin{pmatrix} q_t \\\\ \\omega_t \\end{pmatrix} + \\Delta t\\, \\begin{pmatrix} \\omega_t \\\\ \\frac{1}{I}\\big(\\beta\\,\\tanh(u_t) - b\\,\\omega_t - \\kappa\\,\\sin(q_t)\\big) \\end{pmatrix}$。\n- 模型参数：$I>0$，$b>0$，$\\kappa>0$，$\\beta>0$，$\\Delta t>0$。\n- 过程噪声：$w_t \\sim \\mathcal{N}(0,Q_t)$。\n- 感觉测量模型：$y_t = h(x_t) + v_t$。\n- 测量函数：$h(x_t) \\equiv \\begin{pmatrix} q_t \\\\ \\arctan(\\omega_t) \\end{pmatrix}$。\n- 测量噪声：$v_t \\sim \\mathcal{N}(0,R_t)$。\n- 任务：推导通用的扩展卡尔曼滤波器 (EKF) 预测和更新方程。然后，为给定模型计算在一般状态 $x_t$ 和输入 $u_t$ 下的雅可比矩阵 $\\frac{\\partial f}{\\partial x}$、$\\frac{\\partial f}{\\partial u}$ 和 $\\frac{\\partial h}{\\partial x}$。\n- 最终答案规格：以块行矩阵 $[A_t \\;\\; B_t \\;\\; H_t]$ 的形式提供结果，其中 $A_t = \\frac{\\partial f}{\\partial x}$，$B_t = \\frac{\\partial f}{\\partial u}$，$H_t = \\frac{\\partial h}{\\partial x}$。\n\n### 步骤2：使用提取的已知条件进行验证\n根据验证标准评估问题。\n- **科学性**：该问题使用标准状态空间表示法描述了一个物理上合理的生物力学系统（在重力、粘性阻尼和受控扭矩作用下的单关节肢体）。非线性项（$\\sin$、$\\tanh$、$\\arctan$）在此类模型中是常见且有意义的。使用EKF对此系统进行状态估计是计算神经科学和控制工程中的一个经典问题。该表述是科学合理的。\n- **适定性**：问题定义清晰，提供了所有必要的方程和参数。它要求进行一组特定的推导（通用EKF方程）和计算（特定雅可比矩阵），这些推导和计算存在唯一且稳定的数学解。\n- **客观性**：问题以精确、客观的数学语言陈述，没有任何歧义或主观内容。\n\n未发现任何缺陷。该问题是自洽、一致且科学有效的。\n\n### 步骤3：结论与行动\n问题被判定为有效。将提供完整解答。\n\n### 解题推导\n\n扩展卡尔曼滤波器 (EKF) 是一种用于非线性动力学系统中状态估计的算法。它在每个时间步围绕当前状态估计将系统动力学和测量模型线性化，以传播状态概率分布的均值和协方差。设在给定截至时间 $t$ 的测量值的情况下，时间 $t$ 的状态估计及其协方差分别表示为 $\\hat{x}_{t|t}$ 和 $P_{t|t}$。EKF 的操作分为两个步骤：预测和更新。\n\n**1. 预测步骤**\n给定时间 $t$ 的估计值 $\\hat{x}_{t|t}$ 和协方差 $P_{t|t}$，目标是预测时间 $t+1$ 的状态和协方差。\n预测的状态均值 $\\hat{x}_{t+1|t}$ 是通过将先前的估计值通过非线性动力学函数 $f$ 传播得到的：\n$$\n\\hat{x}_{t+1|t} = f(\\hat{x}_{t|t}, u_t)\n$$\n预测的状态协方差 $P_{t+1|t}$ 是通过在 $\\hat{x}_{t|t}$ 和 $u_t$ 周围线性化动力学得到的。线性化后的动力学由雅可比矩阵 $A_t = \\frac{\\partial f}{\\partial x}\\big|_{\\hat{x}_{t|t}, u_t}$ 确定。然后协方差按如下方式传播，其中包括加上协方差为 $Q_t$ 的过程噪声：\n$$\nP_{t+1|t} = A_t P_{t|t} A_t^T + Q_t\n$$\n\n**2. 更新步骤**\n当时间 $t+1$ 获得新的测量值 $y_{t+1}$ 时，预测的状态 $\\hat{x}_{t+1|t}$ 和协方差 $P_{t+1|t}$ 将被更新。\n首先，在预测状态 $\\hat{x}_{t+1|t}$ 周围将测量模型线性化。相关的雅可比矩阵是 $H_{t+1} = \\frac{\\partial h}{\\partial x}\\big|_{\\hat{x}_{t+1|t}}$。\n新息或测量残差是实际测量值 $y_{t+1}$ 与预测测量值 $h(\\hat{x}_{t+1|t})$ 之间的差：\n$$\n\\tilde{y}_{t+1} = y_{t+1} - h(\\hat{x}_{t+1|t})\n$$\n新息协方差 $S_{t+1}$ 为：\n$$\nS_{t+1} = H_{t+1} P_{t+1|t} H_{t+1}^T + R_{t+1}\n$$\n然后计算最优卡尔曼增益 $K_{t+1}$：\n$$\nK_{t+1} = P_{t+1|t} H_{t+1}^T S_{t+1}^{-1}\n$$\n最后，计算更新后的状态均值 $\\hat{x}_{t+1|t+1}$ 和协方差 $P_{t+1|t+1}$：\n$$\n\\hat{x}_{t+1|t+1} = \\hat{x}_{t+1|t} + K_{t+1} \\tilde{y}_{t+1}\n$$\n$$\nP_{t+1|t+1} = (I - K_{t+1} H_{t+1}) P_{t+1|t}\n$$\n其中 $I$ 是单位矩阵。这样就完成了一个时间步的 EKF 循环。\n\n**雅可比矩阵计算**\n问题要求计算在一般状态 $x_t = \\begin{pmatrix} q_t \\\\ \\omega_t \\end{pmatrix}$ 和输入 $u_t$ 下的雅可比矩阵 $A_t = \\frac{\\partial f}{\\partial x}$，$B_t = \\frac{\\partial f}{\\partial u}$ 和 $H_t = \\frac{\\partial h}{\\partial x}$。\n\n状态向量为 $x_t = \\begin{pmatrix} q_t \\\\ \\omega_t \\end{pmatrix}$。动力学函数 $f(x_t, u_t)$ 的分量为：\n$$\nf_1(q_t, \\omega_t, u_t) = q_t + \\Delta t \\, \\omega_t\n$$\n$$\nf_2(q_t, \\omega_t, u_t) = \\omega_t + \\frac{\\Delta t}{I}\\big(\\beta\\,\\tanh(u_t) - b\\,\\omega_t - \\kappa\\,\\sin(q_t)\\big)\n$$\n\n**$A_t = \\frac{\\partial f}{\\partial x}$ 的计算：**\n$A_t$ 是一个 $2 \\times 2$ 矩阵，其元素为 $A_{ij} = \\frac{\\partial f_i}{\\partial x_j}$，其中 $x_1 = q_t$，$x_2 = \\omega_t$。\n$$\n\\frac{\\partial f_1}{\\partial q_t} = \\frac{\\partial}{\\partial q_t}(q_t + \\Delta t \\, \\omega_t) = 1\n$$\n$$\n\\frac{\\partial f_1}{\\partial \\omega_t} = \\frac{\\partial}{\\partial \\omega_t}(q_t + \\Delta t \\, \\omega_t) = \\Delta t\n$$\n$$\n\\frac{\\partial f_2}{\\partial q_t} = \\frac{\\partial}{\\partial q_t}\\left(\\omega_t + \\frac{\\Delta t}{I}\\big(\\beta\\,\\tanh(u_t) - b\\,\\omega_t - \\kappa\\,\\sin(q_t)\\big)\\right) = -\\frac{\\kappa \\Delta t}{I}\\cos(q_t)\n$$\n$$\n\\frac{\\partial f_2}{\\partial \\omega_t} = \\frac{\\partial}{\\partial \\omega_t}\\left(\\omega_t + \\frac{\\Delta t}{I}\\big(\\beta\\,\\tanh(u_t) - b\\,\\omega_t - \\kappa\\,\\sin(q_t)\\big)\\right) = 1 - \\frac{b \\Delta t}{I}\n$$\n因此，动力学函数对状态的雅可比矩阵为：\n$$\nA_t = \\frac{\\partial f}{\\partial x} = \\begin{pmatrix} 1 & \\Delta t \\\\ -\\frac{\\kappa \\Delta t}{I}\\cos(q_t) & 1 - \\frac{b \\Delta t}{I} \\end{pmatrix}\n$$\n\n**$B_t = \\frac{\\partial f}{\\partial u}$ 的计算：**\n$B_t$ 是一个 $2 \\times 1$ 矩阵，其元素为 $B_i = \\frac{\\partial f_i}{\\partial u_t}$。\n$$\n\\frac{\\partial f_1}{\\partial u_t} = \\frac{\\partial}{\\partial u_t}(q_t + \\Delta t \\, \\omega_t) = 0\n$$\n$$\n\\frac{\\partial f_2}{\\partial u_t} = \\frac{\\partial}{\\partial u_t}\\left(\\omega_t + \\frac{\\Delta t}{I}\\big(\\beta\\,\\tanh(u_t) - b\\,\\omega_t - \\kappa\\,\\sin(q_t)\\big)\\right) = \\frac{\\beta \\Delta t}{I}\\frac{d}{du_t}(\\tanh(u_t)) = \\frac{\\beta \\Delta t}{I}\\sech^2(u_t)\n$$\n因此，动力学函数对控制输入的雅可比矩阵为：\n$$\nB_t = \\frac{\\partial f}{\\partial u} = \\begin{pmatrix} 0 \\\\ \\frac{\\beta \\Delta t}{I}\\sech^2(u_t) \\end{pmatrix}\n$$\n\n**$H_t = \\frac{\\partial h}{\\partial x}$ 的计算：**\n测量函数 $h(x_t)$ 的分量为：\n$$\nh_1(q_t, \\omega_t) = q_t\n$$\n$$\nh_2(q_t, \\omega_t) = \\arctan(\\omega_t)\n$$\n$H_t$ 是一个 $2 \\times 2$ 矩阵，其元素为 $H_{ij} = \\frac{\\partial h_i}{\\partial x_j}$。\n$$\n\\frac{\\partial h_1}{\\partial q_t} = \\frac{\\partial}{\\partial q_t}(q_t) = 1\n$$\n$$\n\\frac{\\partial h_1}{\\partial \\omega_t} = \\frac{\\partial}{\\partial \\omega_t}(q_t) = 0\n$$\n$$\n\\frac{\\partial h_2}{\\partial q_t} = \\frac{\\partial}{\\partial q_t}(\\arctan(\\omega_t)) = 0\n$$\n$$\n\\frac{\\partial h_2}{\\partial \\omega_t} = \\frac{\\partial}{\\partial \\omega_t}(\\arctan(\\omega_t)) = \\frac{1}{1 + \\omega_t^2}\n$$\n因此，测量函数对状态的雅可比矩阵为：\n$$\nH_t = \\frac{\\partial h}{\\partial x} = \\begin{pmatrix} 1 & 0 \\\\ 0 & \\frac{1}{1 + \\omega_t^2} \\end{pmatrix}\n$$\n\n最终答案是块行拼接矩阵 $[A_t \\;\\; B_t \\;\\; H_t]$，它是一个 $2 \\times 5$ 的矩阵。\n$$\n[A_t \\;\\; B_t \\;\\; H_t] = \\begin{pmatrix} 1 & \\Delta t & 0 & 1 & 0 \\\\ -\\frac{\\kappa \\Delta t}{I}\\cos(q_t) & 1 - \\frac{b \\Delta t}{I} & \\frac{\\beta \\Delta t}{I}\\sech^2(u_t) & 0 & \\frac{1}{1 + \\omega_t^2} \\end{pmatrix}\n$$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 & \\Delta t & 0 & 1 & 0 \\\\\n-\\frac{\\kappa \\Delta t}{I}\\cos(q_t) & 1 - \\frac{b \\Delta t}{I} & \\frac{\\beta \\Delta t}{I}\\sech^2(u_t) & 0 & \\frac{1}{1 + \\omega_t^2}\n\\end{pmatrix}\n}\n$$"
        }
    ]
}