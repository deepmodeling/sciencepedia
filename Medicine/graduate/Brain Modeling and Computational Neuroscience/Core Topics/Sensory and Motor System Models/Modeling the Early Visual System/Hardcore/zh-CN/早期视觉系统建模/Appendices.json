{
    "hands_on_practices": [
        {
            "introduction": "视觉处理的第一步是将光信号转换为神经信号，这个过程由离散的光感受器阵列完成。这个练习将探讨一个核心问题：视网膜上光感受器高度优化的六边形排列方式如何决定了空间视觉的根本极限。通过在生物学背景下应用采样理论，你将推导出混叠（aliasing）发生的条件，并确定在这样一个高效的生物传感器阵列中的奈奎斯特频率（Nyquist frequency）。",
            "id": "3998494",
            "problem": "考虑将脊椎动物视网膜中的感光细胞镶嵌层建模为图像平面上的一个二维六边形（三角形）采样晶格，采样点之间的最近邻间距为 $a$。设相应的实空间原胞晶格矢量选为 $ \\mathbf{a}_{1} = a \\, (1, 0)$ 和 $ \\mathbf{a}_{2} = a \\, \\left(\\frac{1}{2}, \\frac{\\sqrt{3}}{2}\\right)$，它们生成一个角间距为 $60^{\\circ}$、最近邻距离为 $a$ 的三角形晶格。一个入射的视觉刺激具有空间频率矢量 $\\mathbf{f}$，单位为每单位长度的周期数（例如，视网膜上每度的周期数或每毫米的周期数）。利用采样理论的第一性原理，通过 $\\mathbf{a}_{i} \\cdot \\mathbf{b}_{j} = 2\\pi \\, \\delta_{ij}$ 定义倒易晶格，将第一布里渊区构造为倒易晶格的 Wigner–Seitz 原胞，并确定最大的各向同性无混叠截止（奈奎斯特）频率。具体来说，推导出一个标量截止频率 $f_{c}(a)$ 的闭式表达式（单位为每单位长度的周期数），使得任何满足 $\\|\\mathbf{f}\\| < f_{c}(a)$ 的输入在六边形采样下保证不会产生混叠。\n\n您的答案必须是 $f_{c}(a)$ 的单个解析表达式，单位为每单位长度的周期数。不要用不等式作为最终答案。无需四舍五入。",
            "solution": "用户希望找到六边形采样晶格的最大各向同性无混叠截止频率。\n\n### 步骤1：问题陈述的验证\n\n根据指定标准对问题陈述进行验证。\n\n**1. 提取的已知条件：**\n- 感光细胞镶嵌层被建模为二维六边形（三角形）采样晶格。\n- 最近邻间距为 `$a$`。\n- 实空间原胞晶格矢量为 `$\\mathbf{a}_{1} = a(1, 0)$` 和 `$\\mathbf{a}_{2} = a(\\frac{1}{2}, \\frac{\\sqrt{3}}{2})$`。\n- 输入刺激具有空间频率矢量 `$\\mathbf{f}$`，单位为每单位长度的周期数。\n- 倒易晶格由关系 `$\\mathbf{a}_{i} \\cdot \\mathbf{b}_{j} = 2\\pi \\delta_{ij}$` 定义。\n- 第一布里渊区是倒易晶格的 Wigner–Seitz 原胞。\n- 目标是找到最大各向同性无混叠截止频率 `$f_{c}(a)$` 的闭式表达式，定义为任何满足 `$\\|\\mathbf{f}\\| < f_{c}(a)$` 的输入都不会产生混叠。\n\n**2. 使用提取的已知条件进行验证：**\n- **科学依据：** 该问题具有科学合理性。将视网膜的感光细胞镶嵌层建模为六边形晶格是计算神经科学中一个标准且合理的简化。使用采样理论、倒易晶格和布里渊区来分析混叠现象，是固态物理和信号处理原理的基本且正确的应用。\n- **适定性：** 该问题是适定的。它提供了推导唯一解所需的全部定义和约束。晶格、倒易晶格和截止频率的定义都是精确且标准的。\n- **客观性：** 该问题以客观、正式的语言陈述，没有歧义或主观论断。\n\n**3. 结论与行动：**\n该问题被认为是**有效的**，因为它具有科学依据、适定且客观。将提供详细的解决方案。\n\n### 步骤2：求解推导\n\n求解过程首先构建倒易晶格，然后确定其第一布里渊区，最后确定可以内切于该区域的最大圆的半径。\n\n**1. 计算倒易晶格矢量**\n\n实空间原胞晶格矢量给定为：\n$$ \\mathbf{a}_{1} = a\\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}, \\quad \\mathbf{a}_{2} = a\\begin{pmatrix} \\frac{1}{2} \\\\ \\frac{\\sqrt{3}}{2} \\end{pmatrix} $$\n倒易晶格矢量 `$\\mathbf{b}_1$` 和 `$\\mathbf{b}_2$` 由条件 `$\\mathbf{a}_{i} \\cdot \\mathbf{b}_{j} = 2\\pi \\delta_{ij}$` 定义，其中 `$\\delta_{ij}$` 是 Kronecker delta。\n\n设 `$\\mathbf{b}_{j} = \\begin{pmatrix} b_{j1} \\\\ b_{j2} \\end{pmatrix}$`。我们可以求解以下方程组：\n对于 `$j=1$`：\n$$ \\mathbf{a}_{1} \\cdot \\mathbf{b}_{1} = a(1)b_{11} + a(0)b_{12} = ab_{11} = 2\\pi $$\n$$ \\mathbf{a}_{2} \\cdot \\mathbf{b}_{1} = a\\left(\\frac{1}{2}\\right)b_{11} + a\\left(\\frac{\\sqrt{3}}{2}\\right)b_{12} = 0 $$\n由第一个方程可得 `$b_{11} = \\frac{2\\pi}{a}$`。代入第二个方程：\n$$ a\\left(\\frac{1}{2}\\right)\\left(\\frac{2\\pi}{a}\\right) + a\\left(\\frac{\\sqrt{3}}{2}\\right)b_{12} = \\pi + \\frac{a\\sqrt{3}}{2}b_{12} = 0 \\implies b_{12} = -\\frac{2\\pi}{a\\sqrt{3}} $$\n因此，`$\\mathbf{b}_{1} = \\frac{2\\pi}{a}\\begin{pmatrix} 1 \\\\ -\\frac{1}{\\sqrt{3}} \\end{pmatrix}$`。\n\n对于 `$j=2$`：\n$$ \\mathbf{a}_{1} \\cdot \\mathbf{b}_{2} = a(1)b_{21} + a(0)b_{22} = ab_{21} = 0 \\implies b_{21} = 0 $$\n$$ \\mathbf{a}_{2} \\cdot \\mathbf{b}_{2} = a\\left(\\frac{1}{2}\\right)b_{21} + a\\left(\\frac{\\sqrt{3}}{2}\\right)b_{22} = 2\\pi $$\n代入 `$b_{21}=0$`：\n$$ a\\left(\\frac{\\sqrt{3}}{2}\\right)b_{22} = 2\\pi \\implies b_{22} = \\frac{4\\pi}{a\\sqrt{3}} $$\n因此，`$\\mathbf{b}_{2} = \\frac{2\\pi}{a}\\begin{pmatrix} 0 \\\\ \\frac{2}{\\sqrt{3}} \\end{pmatrix}$`。\n\n**2. 倒易晶格与第一布里渊区**\n\n倒易晶格是由原胞倒易矢量的整数组合给出的所有点 `$\\mathbf{G}$` 的集合：`$\\mathbf{G} = n_1\\mathbf{b}_1 + n_2\\mathbf{b}_2$`，其中 `$n_1, n_2 \\in \\mathbb{Z}$`。第一布里渊区是该晶格中以原点为中心的 Wigner-Seitz 原胞。其边界由从原点到最近的倒易晶格点的矢量的垂直平分线构成。因此，我们必须找到最短的非零倒易晶格矢量。\n\n我们来计算 `$\\mathbf{b}_1$`、`$\\mathbf{b}_2$` 及其简单组合的模长的平方：\n$$ \\|\\mathbf{b}_1\\|^2 = \\left(\\frac{2\\pi}{a}\\right)^2 \\left(1^2 + \\left(-\\frac{1}{\\sqrt{3}}\\right)^2\\right) = \\left(\\frac{2\\pi}{a}\\right)^2 \\left(1 + \\frac{1}{3}\\right) = \\frac{16\\pi^2}{3a^2} $$\n$$ \\|\\mathbf{b}_2\\|^2 = \\left(\\frac{2\\pi}{a}\\right)^2 \\left(0^2 + \\left(\\frac{2}{\\sqrt{3}}\\right)^2\\right) = \\left(\\frac{2\\pi}{a}\\right)^2 \\left(\\frac{4}{3}\\right) = \\frac{16\\pi^2}{3a^2} $$\n实空间晶格是三角形的，因此其倒易晶格也是三角形的（六边形）。一个三角形晶格有 `$6$` 个最近邻。我们来验证一下像 `$\\mathbf{b}_1 + \\mathbf{b}_2$` 这样的其他组合是否也具有这个最小长度。\n点积为 `$\\mathbf{b}_1 \\cdot \\mathbf{b}_2 = \\left(\\frac{2\\pi}{a}\\right)^2 \\left(1 \\cdot 0 + \\left(-\\frac{1}{\\sqrt{3}}\\right)\\left(\\frac{2}{\\sqrt{3}}\\right)\\right) = -\\frac{8\\pi^2}{3a^2}$`。\n$$ \\|\\mathbf{b}_1 + \\mathbf{b}_2\\|^2 = \\|\\mathbf{b}_1\\|^2 + \\|\\mathbf{b}_2\\|^2 + 2(\\mathbf{b}_1 \\cdot \\mathbf{b}_2) = \\frac{16\\pi^2}{3a^2} + \\frac{16\\pi^2}{3a^2} + 2\\left(-\\frac{8\\pi^2}{3a^2}\\right) = \\frac{16\\pi^2}{3a^2} $$\n矢量 `$\\pm \\mathbf{b}_1$`、`$\\pm \\mathbf{b}_2$` 和 `$\\pm(\\mathbf{b}_1 + \\mathbf{b}_2)$` 构成一个包含六个矢量的集合，它们的模长平方均为 `$\\frac{16\\pi^2}{3a^2}$`。这些是倒易晶格中离原点最近的六个邻居。这些最短倒易晶格矢量的模长为：\n$$ G_{\\min} = \\sqrt{\\frac{16\\pi^2}{3a^2}} = \\frac{4\\pi}{a\\sqrt{3}} $$\n第一布里渊区是一个正六边形，其边是这六个矢量的垂直平分线。\n\n**3. 各向同性无混叠截止频率**\n\n无混叠频率的区域是第一布里渊区。问题要求的是最大的*各向同性*无混叠截止频率 `$f_c$`。这对应于寻找一个以原点为中心、且完全包含在第一布里渊区内的最大圆形区域。对于正六边形，这个区域就是其内切圆。\n\n内切圆的半径是中心（原点）到边界的最短距离。这个距离恰好是最短倒易晶格矢量模长的一半：\n$$ F_c = \\frac{1}{2} G_{\\min} = \\frac{1}{2} \\left(\\frac{4\\pi}{a\\sqrt{3}}\\right) = \\frac{2\\pi}{a\\sqrt{3}} $$\n这个截止频率 `$F_c$` 是一个角频率，单位是弧度/单位长度。\n\n**4. 转换为“周期/单位长度”**\n\n问题要求频率 `$f_c(a)$` 的单位是“周期/单位长度”。角频率 `$F$`（单位：弧度/长度）和空间频率 `$f$`（单位：周期/长度）之间的关系是 `$F = 2\\pi f$`。因此，我们将 `$F_c$` 转换为 `$f_c(a)$`：\n$$ f_c(a) = \\frac{F_c}{2\\pi} = \\frac{1}{2\\pi} \\left(\\frac{2\\pi}{a\\sqrt{3}}\\right) = \\frac{1}{a\\sqrt{3}} $$\n这就是最近邻间距为 `$a$` 的六边形晶格的各向同性奈奎斯特频率的最终表达式。任何空间频率 `$\\|\\mathbf{f}\\|$` 小于 `$f_c(a)=\\frac{1}{a\\sqrt{3}}$` 的正弦刺激都保证不会引起混叠。\n这也可以写成：\n$$ f_c(a) = \\frac{\\sqrt{3}}{3a} $$\n然而，`$\\frac{1}{a\\sqrt{3}}$` 的形式更为直接。",
            "answer": "$$ \\boxed{\\frac{1}{a\\sqrt{3}}} $$"
        },
        {
            "introduction": "在光信号被采样后，神经回路便开始对其进行处理，其中一个关键特征是非线性计算。这使得神经元能够提取出原始刺激中不存在的新特征。本练习使用一个经典的子单元模型来演示一种基本的非线性——“整流”（rectification）——如何能够在神经元响应中产生高频谐波，这是视觉系统中特征提取的一个基本机制 。",
            "id": "3998468",
            "problem": "考虑一个早期视觉通路神经元的规范子单元模型，该模型具有 $N$ 个相同的、并行的、通过均匀求和汇集的线性-非线性子单元，其中 $N$ 为偶数。每个子单元接收一个时间上闪烁的空间棋盘格刺激。具体来说，呈现给子单元 $i$ 的刺激是 $s_{i}(t)=c_{i}\\,A \\cos(\\omega t)$，其中 $A>0$ 是对比度振幅，$\\omega>0$ 是角频率，$c_{i}\\in\\{+1,-1\\}$ 编码棋盘格的极性：恰好有 $N/2$ 个子单元的 $c_{i}=+1$（亮格），$N/2$ 个子单元的 $c_{i}=-1$（暗格）。每个子单元中的线性阶段具有单位增益，静态非线性是整流线性函数 $g(x)=\\max(0,x)$。汇集输出为\n$$\ny(t)=\\sum_{i=1}^{N} g\\!\\left(s_{i}(t)\\right).\n$$\n\n仅从 $g(x)$ 的定义、三角函数的周期性以及周期为 $T$ 的实函数 $f(t)$ 的傅里叶级数出发，\n$$\nf(t)=\\frac{a_{0}}{2}+\\sum_{n=1}^{\\infty} a_{n}\\cos\\!\\left(\\frac{2\\pi n}{T} t\\right) + \\sum_{n=1}^{\\infty} b_{n}\\sin\\!\\left(\\frac{2\\pi n}{T} t\\right),\n$$\n其系数为\n$$\na_{n}=\\frac{2}{T}\\int_{0}^{T} f(t)\\cos\\!\\left(\\frac{2\\pi n}{T} t\\right)\\,dt, \\quad b_{n}=\\frac{2}{T}\\int_{0}^{T} f(t)\\sin\\!\\left(\\frac{2\\pi n}{T} t\\right)\\,dt,\n$$\n推导出 $y(t)$ 在稳态下的谐波成分。\n\n将非线性度 $D$ 定义为角频率为 $2\\omega$ 的二次谐波分量的振幅与 $y(t)$ 的直流（平均）分量之比，该比值由以​​上余弦-正弦形式表示的 $y(t)$ 的傅里叶级数计算得出。以闭式形式计算 $D$，结果为一个实数。不需要数值近似，也不需要单位。将你的最终答案表示为单个数字。",
            "solution": "问题陈述按如下方式进行审慎验证。\n\n**步骤 1：提取已知条件**\n- 模型：一个早期视觉神经元的规范子单元模型。\n- 子单元数量：$N$，一个偶数。\n- 子单元处理：相同的、并行的线性-非线性子单元。\n- 汇集：子单元输出的均匀求和。\n- 子单元 $i$ 的刺激：$s_{i}(t) = c_{i} A \\cos(\\omega t)$，其中 $A > 0$ 且 $\\omega > 0$。\n- 棋盘格极性：$c_{i} \\in \\{+1, -1\\}$。\n- 极性分布：恰好有 $N/2$ 个子单元的 $c_i = +1$，$N/2$ 个子单元的 $c_i = -1$。\n- 线性阶段：单位增益。\n- 非线性：整流线性函数 $g(x) = \\max(0, x)$。\n- 总输出：$y(t) = \\sum_{i=1}^{N} g(s_{i}(t))$。\n- 周期为 $T$ 的函数 $f(t)$ 的傅里叶级数：\n  $f(t) = \\frac{a_{0}}{2} + \\sum_{n=1}^{\\infty} a_{n}\\cos(\\frac{2\\pi n}{T} t) + \\sum_{n=1}^{\\infty} b_{n}\\sin(\\frac{2\\pi n}{T} t)$。\n- 傅里叶系数：\n  $a_{n} = \\frac{2}{T}\\int_{0}^{T} f(t)\\cos(\\frac{2\\pi n}{T} t)\\,dt$\n  $b_{n} = \\frac{2}{T}\\int_{0}^{T} f(t)\\sin(\\frac{2\\pi n}{T} t)\\,dt$\n- 非线性度 $D$ 的定义：$y(t)$ 的二次谐波分量（角频率为 $2\\omega$）的振幅与直流（DC）分量之比。\n- 要求输出：$D$ 作为单个实数。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据、是适定的且客观的。它描述了计算神经科学中一个简化但标准的模型（LNP 模型）。所有变量、函数和常数都有清晰的定义，前提条件是自洽的。该任务是基于所提供的定义进行的形式化数学推导，特别是计算一个良定义的周期函数的傅里叶级数系数。问题的结构允许一个唯一、稳定且有意义的解。未检测到与无效性清单对应的缺陷。\n\n**步骤 3：结论与行动**\n问题有效。开始求解。\n\n神经元模型的总输出由 $N$ 个子单元的输出之和给出：\n$$\ny(t) = \\sum_{i=1}^{N} g(s_{i}(t))\n$$\n子单元 $i$ 的刺激是 $s_{i}(t) = c_{i} A \\cos(\\omega t)$。极性集合 $\\{c_i\\}$ 包含 $N/2$ 个 $+1$ 和 $N/2$ 个 $-1$。我们可以将总和分成两组：\n$$\ny(t) = \\sum_{i \\text{ with } c_i=+1} g(A \\cos(\\omega t)) + \\sum_{i \\text{ with } c_i=-1} g(-A \\cos(\\omega t))\n$$\n由于每组有 $N/2$ 个子单元，我们得到：\n$$\ny(t) = \\frac{N}{2} g(A \\cos(\\omega t)) + \\frac{N}{2} g(-A \\cos(\\omega t))\n$$\n使用整流线性非线性 $g(x) = \\max(0, x)$ 的定义：\n$$\ny(t) = \\frac{N}{2} \\max(0, A \\cos(\\omega t)) + \\frac{N}{2} \\max(0, -A \\cos(\\omega t))\n$$\n由于 $A > 0$，我们可以将其从 $\\max$ 函数中提取出来：\n$$\ny(t) = \\frac{NA}{2} \\left( \\max(0, \\cos(\\omega t)) + \\max(0, -\\cos(\\omega t)) \\right)\n$$\n表达式 $\\max(0, z) + \\max(0, -z)$ 等价于绝对值 $|z|$。因此，输出简化为全波整流余弦函数：\n$$\ny(t) = \\frac{NA}{2} |\\cos(\\omega t)|\n$$\n为了找到 $y(t)$ 的谐波成分，我们必须计算其傅里叶级数。函数 $\\cos(\\omega t)$ 的周期为 $T_{stim} = 2\\pi/\\omega$。然而，函数 $|\\cos(\\omega t)|$ 的周期性使其基本周期为 $T = \\pi/\\omega$。对应的基本角频率为 $\\omega_f = 2\\pi/T = 2\\pi/(\\pi/\\omega) = 2\\omega$。\n\n周期为 $T$ 的函数 $y(t)$ 的傅里叶级数由下式给出：\n$$\ny(t) = \\frac{a_{0}}{2} + \\sum_{n=1}^{\\infty} a_{n}\\cos\\left(\\frac{2\\pi n}{T} t\\right) + \\sum_{n=1}^{\\infty} b_{n}\\sin\\left(\\frac{2\\pi n}{T} t\\right)\n$$\n代入 $T = \\pi/\\omega$，级数变为：\n$$\ny(t) = \\frac{a_{0}}{2} + \\sum_{n=1}^{\\infty} a_{n}\\cos(2n\\omega t) + \\sum_{n=1}^{\\infty} b_{n}\\sin(2n\\omega t)\n$$\n函数 $y(t) = \\frac{NA}{2} |\\cos(\\omega t)|$ 是一个偶函数，因为 $y(-t) = \\frac{NA}{2} |\\cos(-\\omega t)| = \\frac{NA}{2} |\\cos(\\omega t)| = y(t)$。对于偶函数，所有正弦系数 $b_n$ 均为零。我们只需要计算余弦系数 $a_n$。\n\n$y(t)$ 的直流分量（平均值）是 $\\frac{a_0}{2}$。系数 $a_0$ 计算如下：\n$$\na_0 = \\frac{2}{T} \\int_{0}^{T} y(t) dt = \\frac{2}{\\pi/\\omega} \\int_{0}^{\\pi/\\omega} \\frac{NA}{2} |\\cos(\\omega t)| dt = \\frac{NA\\omega}{\\pi} \\int_{0}^{\\pi/\\omega} |\\cos(\\omega t)| dt\n$$\n令 $u = \\omega t$，则 $du = \\omega dt$。积分上下限变为 $0$ 到 $\\pi$。\n$$\na_0 = \\frac{NA}{\\pi} \\int_{0}^{\\pi} |\\cos(u)| du = \\frac{NA}{\\pi} \\left( \\int_{0}^{\\pi/2} \\cos(u)du + \\int_{\\pi/2}^{\\pi} [-\\cos(u)]du \\right)\n$$\n$$\na_0 = \\frac{NA}{\\pi} \\left( [\\sin(u)]_{0}^{\\pi/2} - [\\sin(u)]_{\\pi/2}^{\\pi} \\right) = \\frac{NA}{\\pi} \\left( (\\sin(\\pi/2) - \\sin(0)) - (\\sin(\\pi) - \\sin(\\pi/2)) \\right)\n$$\n$$\na_0 = \\frac{NA}{\\pi} \\left( (1 - 0) - (0 - 1) \\right) = \\frac{NA}{\\pi} (1 + 1) = \\frac{2NA}{\\pi}\n$$\n因此，$y(t)$ 的直流分量为：\n$$\n\\text{DC component} = \\frac{a_0}{2} = \\frac{NA}{\\pi}\n$$\n接下来，我们求二次谐波分量的振幅，它对应于角频率 $2\\omega$。在我们的傅里叶级数展开中，这是 $n=1$ 的项，即 $a_1 \\cos(2\\omega t)$。由于 $a_n$ 可能为负，振幅为 $|a_n|$。我们计算 $a_1$：\n$$\na_1 = \\frac{2}{T} \\int_{0}^{T} y(t) \\cos\\left(\\frac{2\\pi(1)}{T}t\\right) dt = \\frac{NA\\omega}{\\pi} \\int_{0}^{\\pi/\\omega} |\\cos(\\omega t)| \\cos(2\\omega t) dt\n$$\n使用相同的代换 $u = \\omega t$：\n$$\na_1 = \\frac{NA}{\\pi} \\int_{0}^{\\pi} |\\cos(u)| \\cos(2u) du = \\frac{NA}{\\pi} \\left( \\int_{0}^{\\pi/2} \\cos(u)\\cos(2u)du - \\int_{\\pi/2}^{\\pi} \\cos(u)\\cos(2u)du \\right)\n$$\n使用三角恒等式 $\\cos(A)\\cos(B) = \\frac{1}{2}[\\cos(A+B) + \\cos(A-B)]$：\n$$\n\\cos(u)\\cos(2u) = \\frac{1}{2}(\\cos(3u) + \\cos(u))\n$$\n积分变为：\n$$\n\\int \\cos(u)\\cos(2u)du = \\frac{1}{2} \\int (\\cos(3u) + \\cos(u))du = \\frac{1}{2} \\left( \\frac{1}{3}\\sin(3u) + \\sin(u) \\right)\n$$\n让我们计算定积分：\n$$\n\\int_{0}^{\\pi/2} \\cos(u)\\cos(2u)du = \\frac{1}{2}\\left[\\frac{1}{3}\\sin(3u) + \\sin(u)\\right]_{0}^{\\pi/2} = \\frac{1}{2}\\left(\\left(\\frac{1}{3}\\sin\\frac{3\\pi}{2} + \\sin\\frac{\\pi}{2}\\right) - 0\\right) = \\frac{1}{2}\\left(-\\frac{1}{3} + 1\\right) = \\frac{1}{3}\n$$\n$$\n\\int_{\\pi/2}^{\\pi} \\cos(u)\\cos(2u)du = \\frac{1}{2}\\left[\\frac{1}{3}\\sin(3u) + \\sin(u)\\right]_{\\pi/2}^{\\pi} = \\frac{1}{2}\\left(0 - \\left(\\frac{1}{3}\\sin\\frac{3\\pi}{2} + \\sin\\frac{\\pi}{2}\\right)\\right) = -\\frac{1}{2}\\left(-\\frac{1}{3}+1\\right) = -\\frac{1}{3}\n$$\n将这些结果代回 $a_1$ 的表达式中：\n$$\na_1 = \\frac{NA}{\\pi} \\left( \\frac{1}{3} - \\left(-\\frac{1}{3}\\right) \\right) = \\frac{NA}{\\pi} \\left(\\frac{2}{3}\\right) = \\frac{2NA}{3\\pi}\n$$\n由于 $N > 0$ 且 $A > 0$，$a_1$ 是正的，所以二次谐波的振幅是 $|a_1| = a_1 = \\frac{2NA}{3\\pi}$。\n\n非线性度 $D$ 定义为此振幅与直流分量之比：\n$$\nD = \\frac{\\text{二次谐波的振幅}}{\\text{直流分量}} = \\frac{a_1}{a_0/2}\n$$\n$$\nD = \\frac{\\frac{2NA}{3\\pi}}{\\frac{NA}{\\pi}} = \\frac{2NA}{3\\pi} \\cdot \\frac{\\pi}{NA} = \\frac{2}{3}\n$$\n结果是一个无量纲常数，与刺激参数 $A$ 和 $\\omega$ 以及子单元数量 $N$ 无关。",
            "answer": "$$\\boxed{\\frac{2}{3}}$$"
        },
        {
            "introduction": "视觉系统不仅仅是一系列独立处理单元的集合，它被认为是一个为高效处理自然场景而优化的整体。本高阶练习深入探讨了“高效编码假说”，以解释为何视网膜包含如此多样的神经节细胞类型。通过运用信息论与合作博弈论中的夏普利值（Shapley value），你将量化神经调谐的多样性如何帮助系统捕获更多关于视觉世界的信息，从而为理解神经回路的设计原理提供一个定量的视角 。",
            "id": "3998514",
            "problem": "考虑早期视觉系统在有效编码假说下的一个简化模型，其中多种视网膜神经节细胞类型在空间频率上实现不同的线性滤波器。设刺激表示在一个具有 $F$ 个区间的一维空间频率网格上，索引为 $j \\in \\{1,\\dots,F\\}$，每个频率 $k_j$ 在 $[0,1]$ 区间内。刺激向量为 $X \\in \\mathbb{R}^F$，并被建模为一个零均值多元高斯分布，其对角协方差矩阵捕捉了自然场景统计特性，即 $X \\sim \\mathcal{N}(0,\\Sigma_X)$，其中 $\\Sigma_X = \\mathrm{diag}(S(k_1),\\dots,S(k_F))$。假设 $S(k)$ 遵循随空间频率递减的规律，这与自然场景相符。\n\n存在 $C$ 种细胞类型。每种细胞类型 $i$ 被建模为一个作用于刺激各空间频率的线性滤波器，产生一个标量响应 $Y_i$。设跨频率的滤波器增益剖面由向量 $g_i \\in \\mathbb{R}^F$ 表示，并设细胞 $i$ 的加性噪声是独立的、零均值的高斯噪声，方差为 $\\sigma_i^2$。将所有细胞响应堆叠成 $Y \\in \\mathbb{R}^C$，并设线性映射为 $Y = A X + N$，其中 $A \\in \\mathbb{R}^{C \\times F}$ 的行是 $g_i^\\top$，且 $N \\sim \\mathcal{N}(0,\\Sigma_N)$，其中 $\\Sigma_N = \\mathrm{diag}(\\sigma_1^2,\\dots,\\sigma_C^2)$。假设 $X$ 和 $N$ 是独立的。\n\n您的任务是：\n\n1. 从互信息 (MI) $I(X;Y)$ 的定义和多元高斯分布的微分熵出发，推导在此线性高斯模型下 $I(X;Y)$ 的表达式（以比特为单位）。您的推导必须从核心定义 $I(X;Y) = H(Y) - H(Y|X)$ 和高斯分布的熵 $H(Z) = \\tfrac{1}{2}\\log((2\\pi e)^n \\det \\Sigma_Z)$（对于 $Z \\sim \\mathcal{N}(0,\\Sigma_Z)$）开始，并逻辑地推导出一个可计算的矩阵表达式，不得引用任何预先给出的简化公式。\n\n2. 使用合作博弈论中的 Shapley 值来定义每种细胞类型对总互信息的贡献。对于细胞类型的一个子集 $S \\subseteq \\{1,\\dots,C\\}$，令 $I_S$ 表示 $X$ 与限于 $S$ 的响应之间的互信息。当类型 $i$ 加入子集 $S$ 时，其边际贡献为 $I_{S \\cup \\{i\\}} - I_S$。Shapley 值贡献 $\\phi_i$ 定义为该边际贡献在 $C$ 种细胞类型的所有可能排列上的平均值。解释为什么 $\\sum_{i=1}^C \\phi_i$ 等于总互信息 $I(X;Y)$，以及为什么在此模型中每个 $\\phi_i$ 都是非负的。\n\n3. 实现一个完整的程序，为以下测试套件计算每种细胞类型的 Shapley 值贡献和总互信息（以比特为单位）。模型细节：\n   - 空间频率网格：$F = 64$ 个区间，$k_j$ 在 $[0,1]$ 内线性间隔。\n   - 自然场景功率谱：$S(k) = \\dfrac{1}{1 + (k/k_0)^\\alpha}$，其中 $\\alpha > 0$ 且 $k_0 > 0$。\n   - 每种细胞类型的滤波器在频率上是高斯函数：$g_i(k) = a_i \\exp\\left(-\\dfrac{(k - c_i)^2}{2 w_i^2}\\right)$，其中振幅 $a_i \\ge 0$，中心 $c_i \\in [0,1]$，宽度 $w_i > 0$。\n   - 噪声方差是独立的，给定为 $\\sigma_i^2$（对角矩阵 $\\Sigma_N$）。\n   - 互信息必须以比特报告。在中间步骤中使用自然对数，并通过除以 $\\log 2$ 转换为比特。\n   - 角度单位不适用。\n   - 您的程序必须通过对 $C$ 种细胞类型的所有排列的边际增益进行平均来计算 Shapley 值贡献。不要假设任何特殊的对称性；执行显式平均。\n\n测试套件参数集（每个定义一个案例；请精确使用这些值）：\n\n- 案例 1（多样化调谐，不同噪声）：\n  - $F = 64$，$\\alpha = 2.0$，$k_0 = 0.05$。\n  - 细胞类型 $C = 3$，参数为：\n    - 类型 1：$c_1 = 0.12$，$w_1 = 0.08$，$a_1 = 1.0$，$\\sigma_1^2 = 0.04$。\n    - 类型 2：$c_2 = 0.40$，$w_2 = 0.10$，$a_2 = 1.0$，$\\sigma_2^2 = 0.02$。\n    - 类型 3：$c_3 = 0.78$，$w_3 = 0.08$，$a_3 = 1.0$，$\\sigma_3^2 = 0.04$。\n\n- 案例 2（冗余通道：两个相同的滤波器）：\n  - $F = 64$，$\\alpha = 2.0$，$k_0 = 0.05$。\n  - 细胞类型 $C = 3$，参数为：\n    - 类型 1：$c_1 = 0.30$，$w_1 = 0.10$，$a_1 = 1.0$，$\\sigma_1^2 = 0.05$。\n    - 类型 2：$c_2 = 0.30$，$w_2 = 0.10$，$a_2 = 1.0$，$\\sigma_2^2 = 0.05$。\n    - 类型 3：$c_3 = 0.70$，$w_3 = 0.10$，$a_3 = 1.0$，$\\sigma_3^2 = 0.05$。\n\n- 案例 3（一个零增益通道）：\n  - $F = 64$，$\\alpha = 2.0$，$k_0 = 0.05$。\n  - 细胞类型 $C = 3$，参数为：\n    - 类型 1：$c_1 = 0.20$，$w_1 = 0.09$，$a_1 = 1.0$，$\\sigma_1^2 = 0.02$。\n    - 类型 2：$c_2 = 0.60$，$w_2 = 0.07$，$a_2 = 0.8$，$\\sigma_2^2 = 0.03$。\n    - 类型 3：$c_3 = 0.50$，$w_3 = 0.10$，$a_3 = 0.0$，$\\sigma_3^2 = 0.01$。\n\n程序输出规范：\n- 对于每个案例，计算每种细胞类型的 Shapley 值贡献和总互信息 $I(X;Y)$（以比特为单位）。\n- 将每个报告的浮点数四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个案例由一个形如 $[\\phi_1,\\phi_2,\\dots,\\phi_C,I_{\\text{total}}]$ 的子列表表示。因此，对于以上三个案例，最终输出必须是一个包含三个子列表的单一列表，例如： $[[\\phi_1^{(1)},\\phi_2^{(1)},\\phi_3^{(1)},I^{(1)}],[\\phi_1^{(2)},\\phi_2^{(2)},\\phi_3^{(2)},I^{(2)}],[\\phi_1^{(3)},\\phi_2^{(3)},\\phi_3^{(3)},I^{(3)}]]$，所有值均以比特为单位，四舍五入到六位小数。",
            "solution": "问题陈述已经过分析，并被认为是有效的。它在科学上基于计算神经科学的标准模型，问题定义清晰，提供了所有必要信息，并且在数学上是一致的。任务定义明确且可解决。\n\n### 第 1 部分：互信息 $I(X;Y)$ 的推导\n\n两个随机向量 $X$ 和 $Y$ 之间的互信息定义为 $I(X;Y) = H(Y) - H(Y|X)$，其中 $H(Y)$ 是 $Y$ 的熵，$H(Y|X)$ 是给定 $X$ 时 $Y$ 的条件熵。问题指定单位必须是比特。我们将首先以奈特（nats）为单位推导表达式，然后进行转换。\n\n一个服从分布 $\\mathcal{N}(\\mu, \\Sigma_Z)$ 的多元高斯随机向量 $Z \\in \\mathbb{R}^n$ 的熵由公式 $H(Z) = \\frac{1}{2}\\log_e((2\\pi e)^n \\det \\Sigma_Z)$ 给出。\n\n**第 1 步：计算响应向量的熵 $H(Y)$。**\n\n刺激 $X$ 和噪声 $N$ 被给定为独立的、零均值的多元高斯向量：\n$X \\sim \\mathcal{N}(0, \\Sigma_X)$，其中 $X \\in \\mathbb{R}^F$。\n$N \\sim \\mathcal{N}(0, \\Sigma_N)$，其中 $N \\in \\mathbb{R}^C$。\n\n响应向量 $Y \\in \\mathbb{R}^C$ 是刺激的线性变换加上加性噪声：$Y = AX + N$。\n由于 $Y$ 是独立高斯向量的线性组合，它本身也是一个高斯向量。其均值为 $\\mathbb{E}[Y] = \\mathbb{E}[AX + N] = A\\mathbb{E}[X] + \\mathbb{E}[N] = A \\cdot 0 + 0 = 0$。\n$Y$ 的协方差矩阵，记作 $\\Sigma_Y$，为：\n$$ \\Sigma_Y = \\mathbb{E}[YY^\\top] = \\mathbb{E}[(AX+N)(AX+N)^\\top] $$\n$$ \\Sigma_Y = \\mathbb{E}[AXX^\\top A^\\top + AXN^\\top + NX^\\top A^\\top + NN^\\top] $$\n利用期望的线性和 $X$ 与 $N$ 的独立性（$\\mathbb{E}[AXN^\\top] = A\\mathbb{E}[X]\\mathbb{E}[N^\\top] = 0$），上式简化为：\n$$ \\Sigma_Y = A\\mathbb{E}[XX^\\top]A^\\top + \\mathbb{E}[NN^\\top] = A\\Sigma_X A^\\top + \\Sigma_N $$\n因此，$Y$ 的分布是 $\\mathcal{N}(0, A\\Sigma_X A^\\top + \\Sigma_N)$。$Y$ 的维度是 $C$。因此 $Y$ 的熵为：\n$$ H(Y) = \\frac{1}{2}\\log_e\\left((2\\pi e)^C \\det(A\\Sigma_X A^\\top + \\Sigma_N)\\right) $$\n\n**第 2 步：计算条件熵 $H(Y|X)$。**\n\n条件熵 $H(Y|X)$ 是条件分布 $p(Y|X=x)$ 的熵在 $X$ 的所有可能值 $x$ 上的期望值：$H(Y|X) = \\mathbb{E}_{X}[H(Y|X=x)]$。\n给定一个特定的刺激实现 $X=x$，响应方程变为 $Y = Ax + N$。在这种情况下，$Y$ 是一个均值为 $Ax$、协方差为 $\\Sigma_N$ 的高斯随机向量，因为唯一剩下的随机分量是噪声 $N$。\n因此，$Y|X=x \\sim \\mathcal{N}(Ax, \\Sigma_N)$。该条件分布的熵为：\n$$ H(Y|X=x) = \\frac{1}{2}\\log_e\\left((2\\pi e)^C \\det(\\Sigma_N)\\right) $$\n关键的是，这个条件熵的表达式不依赖于 $x$ 的具体值。因此，对 $X$ 取期望的结果就是该值本身：\n$$ H(Y|X) = \\mathbb{E}_{X}\\left[\\frac{1}{2}\\log_e\\left((2\\pi e)^C \\det(\\Sigma_N)\\right)\\right] = \\frac{1}{2}\\log_e\\left((2\\pi e)^C \\det(\\Sigma_N)\\right) $$\n\n**第 3 步：结合 $H(Y)$ 和 $H(Y|X)$ 求 $I(X;Y)$。**\n\n$$ I(X;Y) = H(Y) - H(Y|X) $$\n$$ I(X;Y) = \\frac{1}{2}\\log_e\\left((2\\pi e)^C \\det(A\\Sigma_X A^\\top + \\Sigma_N)\\right) - \\frac{1}{2}\\log_e\\left((2\\pi e)^C \\det(\\Sigma_N)\\right) $$\n使用对数性质 $\\log(ab) = \\log a + \\log b$：\n$$ I(X;Y) = \\frac{1}{2}\\left[\\log_e((2\\pi e)^C) + \\log_e(\\det(A\\Sigma_X A^\\top + \\Sigma_N))\\right] - \\frac{1}{2}\\left[\\log_e((2\\pi e)^C) + \\log_e(\\det(\\Sigma_N))\\right] $$\n常数项 $\\frac{1}{2}\\log_e((2\\pi e)^C)$ 被消去：\n$$ I(X;Y) = \\frac{1}{2}\\left[\\log_e(\\det(A\\Sigma_X A^\\top + \\Sigma_N)) - \\log_e(\\det(\\Sigma_N))\\right] $$\n使用对数性质 $\\log a - \\log b = \\log(a/b)$：\n$$ I(X;Y) \\text{ (奈特)} = \\frac{1}{2}\\log_e\\left(\\frac{\\det(A\\Sigma_X A^\\top + \\Sigma_N)}{\\det(\\Sigma_N)}\\right) $$\n为了从奈特转换为比特，我们除以 $\\log_e(2)$，这等价于将对数的底变为 2：\n$$ I(X;Y) \\text{ (比特)} = \\frac{1}{2 \\log_e(2)}\\log_e\\left(\\frac{\\det(A\\Sigma_X A^\\top + \\Sigma_N)}{\\det(\\Sigma_N)}\\right) = \\frac{1}{2}\\log_2\\left(\\frac{\\det(A\\Sigma_X A^\\top + \\Sigma_N)}{\\det(\\Sigma_N)}\\right) $$\n这就是互信息最终的可计算矩阵表达式。\n\n### 第 2 部分：Shapley 值贡献\n\nShapley 值提供了一种在合作博弈的参与者之间公平分配总收益的方法。在这里，“参与者”是细胞类型 $\\{1, \\dots, C\\}$，而一个细胞“联盟”（子集）$S$ 的“收益”是该子集共同提供的关于刺激 $X$ 的互信息 $I_S = I(X; Y_S)$。总收益是 $I_C = I(X; Y)$。\n\n细胞类型 $i$ 的 Shapley 值 $\\phi_i$ 是其平均边际贡献，该平均值是在细胞形成完整联盟的所有可能排序上计算的。其公式为：\n$$ \\phi_i = \\sum_{S \\subseteq \\{1,\\dots,C\\} \\setminus \\{i\\}} \\frac{|S|! (C - |S| - 1)!}{C!} (I_{S \\cup \\{i\\}} - I_S) $$\n其中 $I_{S \\cup \\{i\\}} - I_S$ 是细胞 $i$ 加入联盟 $S$ 时的边际贡献。\n\n**为什么 $\\sum_{i=1}^C \\phi_i = I(X;Y)$：**\n这个性质被称为*效率性*（efficiency），是 Shapley 值的一个基本公理。我们可以通过考虑细胞类型的任意单个排列 $\\pi = (\\pi_1, \\pi_2, \\dots, \\pi_C)$ 来证明它。总信息 $I_C$ 可以写成沿此特定顺序的边际贡献的伸缩和：\n$$ I_C = I(X;Y) = (I_{\\{\\pi_1\\}} - I_{\\emptyset}) + (I_{\\{\\pi_1, \\pi_2\\}} - I_{\\{\\pi_1\\}}) + \\dots + (I_{\\{\\pi_1, \\dots, \\pi_C\\}} - I_{\\{\\pi_1, \\dots, \\pi_{C-1}\\}}) $$\n其中 $I_{\\emptyset} = 0$。对于一个固定的排列，这些边际贡献的总和恰好是 $I_C$。Shapley 值 $\\phi_i$ 是细胞 $i$ 的边际贡献在所有 $C!$ 个排列上的平均值。Shapley 值的总和是：\n$$ \\sum_{i=1}^C \\phi_i = \\sum_{i=1}^C \\left( \\frac{1}{C!} \\sum_{\\text{all permutations }\\pi} \\text{marginal contribution of } i \\text{ in } \\pi \\right) $$\n根据求和的线性性质，这等于：\n$$ \\frac{1}{C!} \\sum_{\\text{all permutations }\\pi} \\left( \\sum_{i=1}^C \\text{marginal contribution of } i \\text{ in } \\pi \\right) $$\n对于任何给定的 $\\pi$，内层求和是等于 $I_C$ 的伸缩和。因此：\n$$ \\sum_{i=1}^C \\phi_i = \\frac{1}{C!} \\sum_{\\text{all permutations }\\pi} I_C = \\frac{1}{C!} (C! \\cdot I_C) = I_C = I(X;Y) $$\n\n**为什么每个 $\\phi_i \\ge 0$：**\nShapley 值 $\\phi_i$ 是边际贡献 $I_{S \\cup \\{i\\}} - I_S$ 的加权平均。权重因子 $\\frac{|S|! (C - |S| - 1)!}{C!}$ 是非负的。要证明 $\\phi_i \\ge 0$，我们必须证明每个边际贡献都是非负的，即 $I_{S \\cup \\{i\\}} \\ge I_S$。\n\n令 $Y_S$ 为联盟 $S$ 中细胞的响应向量，$Y_i$ 为细胞 $i$ 的响应。组合集合的信息为 $I_{S \\cup \\{i\\}} = I(X; Y_S, Y_i)$。使用互信息的链式法则：\n$$ I(X; Y_S, Y_i) = I(X; Y_S) + I(X; Y_i | Y_S) $$\n在这里，$I(X; Y_S)$ 就是 $I_S$。项 $I(X; Y_i | Y_S)$ 是条件互信息，其定义为 $H(Y_i|Y_S) - H(Y_i|X,Y_S)$ 并且总是非负的。信息论的这一基本性质可以理解为“在试图从 $Y_i$ 预测 $X$ 时，知道更多信息（$Y_S$）平均而言不会有坏处” 。\n因此，$I_{S \\cup \\{i\\}} = I_S + I(X; Y_i | Y_S) \\ge I_S$。\n这意味着每个边际贡献 $I_{S \\cup \\{i\\}} - I_S$ 都是非负的。由于 $\\phi_i$ 是这些非负量的加权和，它也必须是非负的。\n\n### 第 3 部分：实现策略\n\n该实现将直接遵循定义来计算 Shapley 值：对细胞类型的所有排列的边际贡献进行平均。\n\n1.  **设置：** 对于每个测试案例，定义模型参数 $F$、$C$、$\\alpha$、$k_0$ 以及特定于细胞的参数 $a_i, c_i, w_i, \\sigma_i^2$。\n2.  **构造矩阵：**\n    -   创建空间频率网格 $k \\in \\mathbb{R}^F$。\n    -   为每个 $k_j$ 计算刺激功率谱 $S(k_j)$，并构成刺激协方差矩阵的对角线，$\\Sigma_X = \\mathrm{diag}(S(k_1),\\dots,S(k_F))$。\n    -   为每个细胞 $i$ 和频率区间 $j$ 计算滤波器增益剖面 $g_i(k_j)$，以形成滤波器矩阵 $A \\in \\mathbb{R}^{C \\times F}$。\n    -   形成对角噪声协方差矩阵 $\\Sigma_N = \\mathrm{diag}(\\sigma_1^2, \\dots, \\sigma_C^2)$。\n3.  **互信息辅助函数：** 一个函数 `calculate_mi(subset_indices, ...)` 将为给定的细胞子集 $S$ 计算 $I(X; Y_S)$。该函数将实现推导出的公式 $I_S = \\frac{1}{2}\\log_2\\left(\\frac{\\det(A_S \\Sigma_X A_S^\\top + \\Sigma_{N,S})}{\\det(\\Sigma_{N,S})}\\right)$，并使用行列式的对数（`numpy.linalg.slogdet`）来保证数值稳定性。\n4.  **Shapley 值计算：**\n    -   生成细胞索引 $\\{0, 1, \\dots, C-1\\}$ 的所有 $C!$ 个排列。\n    -   为每个细胞的累积边际贡献初始化一个数组。\n    -   遍历每个排列：\n        -   对于排列顺序中的每个细胞，计算其对前面细胞组成的联盟的边际贡献。\n        -   将此贡献加到该细胞的累积总和中。\n    -   遍历完所有排列后，将每个细胞的累积总和除以 $C!$ 得到最终的 Shapley 值。\n5.  **总信息：** 使用包含所有细胞索引的辅助函数计算总互信息 $I(X;Y)$。\n6.  **输出格式化：** 将每个案例的结果整理为 $[\\phi_1, \\dots, \\phi_C, I_{\\text{total}}]$，将所有值四舍五入到 6 位小数，并按规定格式化最终输出字符串。",
            "answer": "```python\nimport numpy as np\nimport itertools\n\ndef solve():\n    \"\"\"\n    Solves the problem by calculating Shapley values for mutual information contributions of retinal ganglion cell types.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"F\": 64, \"alpha\": 2.0, \"k0\": 0.05, \"C\": 3,\n            \"cells\": [\n                {\"c\": 0.12, \"w\": 0.08, \"a\": 1.0, \"sigma_sq\": 0.04},\n                {\"c\": 0.40, \"w\": 0.10, \"a\": 1.0, \"sigma_sq\": 0.02},\n                {\"c\": 0.78, \"w\": 0.08, \"a\": 1.0, \"sigma_sq\": 0.04},\n            ]\n        },\n        {\n            \"F\": 64, \"alpha\": 2.0, \"k0\": 0.05, \"C\": 3,\n            \"cells\": [\n                {\"c\": 0.30, \"w\": 0.10, \"a\": 1.0, \"sigma_sq\": 0.05},\n                {\"c\": 0.30, \"w\": 0.10, \"a\": 1.0, \"sigma_sq\": 0.05},\n                {\"c\": 0.70, \"w\": 0.10, \"a\": 1.0, \"sigma_sq\": 0.05},\n            ]\n        },\n        {\n            \"F\": 64, \"alpha\": 2.0, \"k0\": 0.05, \"C\": 3,\n            \"cells\": [\n                {\"c\": 0.20, \"w\": 0.09, \"a\": 1.0, \"sigma_sq\": 0.02},\n                {\"c\": 0.60, \"w\": 0.07, \"a\": 0.8, \"sigma_sq\": 0.03},\n                {\"c\": 0.50, \"w\": 0.10, \"a\": 0.0, \"sigma_sq\": 0.01},\n            ]\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        F = case[\"F\"]\n        alpha = case[\"alpha\"]\n        k0 = case[\"k0\"]\n        C = case[\"C\"]\n        cell_params = case[\"cells\"]\n\n        # Spatial frequency grid\n        k = np.linspace(0, 1, F)\n\n        # Stimulus power spectrum S(k) and covariance matrix Sigma_X\n        S_k = 1 / (1 + (k / k0)**alpha)\n        Sigma_X_diag = S_k\n\n        # Filter matrix A and noise covariance Sigma_N\n        A = np.zeros((C, F))\n        sigma_sq_vec = np.zeros(C)\n        for i in range(C):\n            params = cell_params[i]\n            c_i, w_i, a_i, sigma_sq_i = params[\"c\"], params[\"w\"], params[\"a\"], params[\"sigma_sq\"]\n            # Gaussian filter g_i(k)\n            A[i, :] = a_i * np.exp(-(k - c_i)**2 / (2 * w_i**2))\n            sigma_sq_vec[i] = sigma_sq_i\n        \n        Sigma_N_diag = sigma_sq_vec\n\n        memo = {}\n        def calculate_mi_bits(cell_indices):\n            \"\"\"\n            Calculates mutual information for a subset of cells.\n            Indices are sorted to make the memoization key canonical.\n            \"\"\"\n            key = tuple(sorted(cell_indices))\n            if not key:\n                return 0.0\n            if key in memo:\n                return memo[key]\n            \n            subset_size = len(key)\n            indices_arr = np.array(key)\n            \n            A_s = A[indices_arr, :]\n            Sigma_N_s = np.diag(Sigma_N_diag[indices_arr])\n            \n            # Calculate covariance of response Y_s\n            # Sigma_Y_s = A_s * Sigma_X * A_s^T + Sigma_N_s\n            # Since Sigma_X is diagonal, this is sum_j A_s[:,j] A_s[:,j]^T S_k[j]\n            A_s_Sigma_X_A_s_T = A_s @ np.diag(Sigma_X_diag) @ A_s.T\n            Sigma_Y_s = A_s_Sigma_X_A_s_T + Sigma_N_s\n            \n            # Use slogdet for numerical stability\n            sign_y, logdet_y = np.linalg.slogdet(Sigma_Y_s)\n            sign_n, logdet_n = np.linalg.slogdet(Sigma_N_s)\n            \n            # Covariance matrices must be positive definite, so sign must be 1.\n            if sign_y = 0 or sign_n = 0:\n                return 0.0\n                \n            # I(X;Y) = 0.5 * log(det(Sigma_Y_s) / det(Sigma_N_s))\n            mi_nats = 0.5 * (logdet_y - logdet_n)\n            mi_bits = mi_nats / np.log(2)\n            \n            memo[key] = mi_bits\n            return mi_bits\n\n        # Shapley value calculation\n        cell_indices = list(range(C))\n        permutations = list(itertools.permutations(cell_indices))\n        num_perms = len(permutations)\n        \n        shapley_values = np.zeros(C)\n        \n        for p in permutations:\n            I_prev = 0.0\n            coalition = []\n            for cell_idx in p:\n                coalition.append(cell_idx)\n                I_current = calculate_mi_bits(coalition)\n                marginal_contrib = I_current - I_prev\n                shapley_values[cell_idx] += marginal_contrib\n                I_prev = I_current\n                \n        shapley_values /= num_perms\n        \n        # Total mutual information\n        I_total = calculate_mi_bits(cell_indices)\n        \n        # Sanity check sum of shapley values\n        # assert np.isclose(np.sum(shapley_values), I_total)\n\n        # Format results for this case\n        case_results = [round(v, 6) for v in shapley_values]\n        case_results.append(round(I_total, 6))\n        all_results.append(case_results)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, all_results))}]\")\n\n\nsolve()\n```"
        }
    ]
}