{
    "hands_on_practices": [
        {
            "introduction": "Mastering single-cell methodologies begins with a firm grasp of the core technology and its inherent trade-offs. This first practice explores droplet-based sequencing, contrasting it with plate-based methods to build foundational knowledge. By modeling the stochastic cell encapsulation process using a Poisson distribution, you will derive the probability of forming \"doublets\"—droplets containing more than one cell—a critical artifact that must be understood and controlled to ensure data quality .",
            "id": "3321400",
            "problem": "Single-cell ribonucleic acid sequencing (scRNA-seq) measures messenger ribonucleic acid (mRNA) abundance at the resolution of individual cells. Define droplet-based single-cell ribonucleic acid sequencing (scRNA-seq) and contrast it to plate-based single-cell ribonucleic acid sequencing (scRNA-seq) methods in terms of capture modality, barcoding, throughput, and typical trade-offs relevant to computational systems biology analyses. Then, consider a microfluidic droplet encapsulation system in which a well-mixed cell suspension is partitioned into aqueous droplets in oil. Assume the following modeling base: cells are independently and randomly encapsulated into droplets, droplets form independently, and the number of cells per droplet follows a Poisson distribution with rate parameter $\\lambda$ equal to the expected number of cells per droplet. Using only these base assumptions and standard properties of the Poisson distribution, derive from first principles an analytic expression for the probability that a droplet contains at least two cells (a “doublet-or-higher”) as a function of $\\lambda$. Finally, evaluate this probability at $\\lambda = 0.1$ and $\\lambda = 0.2$, and report both probabilities as decimals. Round each value to $4$ significant figures. Do not use the percent sign; express probabilities as unitless decimals.",
            "solution": "The problem presents a valid request for both a conceptual comparison of two single-cell ribonucleic acid sequencing (scRNA-seq) methodologies and a mathematical derivation based on a standard model used in the field. The premises are scientifically sound, the problem is well-posed, and all necessary information for the derivation is provided.\n\nThe first part of the problem requires a definition of droplet-based scRNA-seq and a comparison with plate-based methods.\n\nDroplet-based scRNA-seq is a high-throughput technology used to profile the transcriptomes of thousands to hundreds of thousands of individual cells. The core principle involves the use of microfluidics to partition a cell suspension into picoliter- to nanoliter-volume aqueous droplets within an immiscible oil phase. Critically, each droplet is designed to co-encapsulate a single cell with a single bead or gel that is pre-loaded with barcoded primers. This process is stochastic. Once encapsulated, the cell is lysed, and its messenger ribonucleic acid (mRNA) molecules are captured by the primers on the co-encapsulated bead. All mRNA from a given cell are thus tagged with a unique barcode sequence specific to that droplet, enabling the pooling of all droplets for subsequent reverse transcription and sequencing. The barcodes are later used computationally to demultiplex the sequencing reads and assign them back to their cell of origin.\n\nWe contrast droplet-based and plate-based scRNA-seq methods on the specified criteria:\n\n1.  **Capture Modality**:\n    *   **Plate-based**: Cells are physically isolated into individual wells of a multi-well plate (e.g., $96$-well or $384$-well plates). This isolation is deterministic and can be achieved via methods like fluorescence-activated cell sorting (FACS), which allows for selection of specific cells, or limiting dilution, which is a less precise manual method. Each well serves as a distinct reaction vessel.\n    *   **Droplet-based**: Cells are captured stochastically. A dilute cell suspension is passed through a microfluidic chip, where droplets are formed at a high frequency. The encapsulation of cells into droplets follows a statistical distribution, typically modeled as a Poisson process. The goal is to load cells at a concentration low enough to minimize the probability of multiple cells being captured in the same droplet.\n\n2.  **Barcoding**:\n    *   **Plate-based**: Barcoding is performed on a per-well basis. Following cell lysis in each well, reverse transcription is carried out using primers that contain a barcode unique to that well. All transcripts from the single cell in a given well are tagged with the same barcode.\n    *   **Droplet-based**: Barcoding is performed on a per-droplet basis. Each droplet contains a bead carrying millions of copies of a unique barcode sequence. After cell lysis within the droplet, the released mRNAs are captured and tagged with this barcode. The collection of all barcodes across all beads is vast, allowing for the unique identification of tens of thousands of cells.\n\n3.  **Throughput**:\n    *   **Plate-based**: This approach has a relatively low throughput. The number of cells that can be processed is limited by the number of wells on the plate, typically ranging from a few dozen to a few thousand cells per experiment. The process is often more labor-intensive.\n    *   **Droplet-based**: This approach offers massive throughput. Microfluidic systems can generate thousands of droplets per second, enabling the simultaneous processing of tens of thousands to hundreds of thousands of cells in a single experiment with significantly less hands-on time per cell.\n\n4.  **Typical Trade-offs**:\n    *   **Plate-based** methods generally provide higher capture efficiency, meaning a larger fraction of the mRNA molecules from a single cell are captured and sequenced. This results in greater sequencing depth per cell and more sensitive detection of genes. It also allows for direct integration with cell imaging and easier targeting of rare cell populations via FACS. The primary trade-offs are significantly lower cell throughput, higher cost per cell, and greater manual labor.\n    *   **Droplet-based** methods prioritize cell throughput and lower cost per cell. The main trade-off is lower mRNA capture efficiency, leading to sparser data (fewer genes and unique molecules detected per cell). A critical challenge is the stochastic formation of \"doublets\" (droplets containing two or more cells), which can confound downstream analysis and must be controlled by limiting the cell concentration and computationally filtered.\n\nThe second part of the problem asks for a mathematical derivation.\nLet the random variable $X$ denote the number of cells encapsulated in a single droplet. According to the problem statement, $X$ follows a Poisson distribution with rate parameter $\\lambda$, where $\\lambda$ is the expected number of cells per droplet. The probability mass function (PMF) for $X$ is given by:\n$$P(X=k) = \\frac{\\lambda^k \\exp(-\\lambda)}{k!}, \\quad \\text{for } k \\in \\{0, 1, 2, \\dots\\}$$\nWe are asked to find the probability that a droplet contains at least two cells. This event is mathematically represented as $\\{X \\ge 2\\}$. The probability of this event is $P(X \\ge 2)$.\n\nIt is most straightforward to calculate this probability using the complement rule. The complement of the event $\\{X \\ge 2\\}$ is the event that a droplet contains fewer than two cells, i.e., $\\{X < 2\\}$. The event $\\{X < 2\\}$ can be partitioned into two disjoint events: $\\{X = 0\\}$ (the droplet is empty) and $\\{X = 1\\}$ (the droplet contains exactly one cell, a \"singlet\").\nTherefore, the probability of the complement is:\n$$P(X < 2) = P(X=0) + P(X=1)$$\nUsing the PMF of the Poisson distribution:\nThe probability of a droplet being empty ($k=0$) is:\n$$P(X=0) = \\frac{\\lambda^0 \\exp(-\\lambda)}{0!} = \\frac{1 \\cdot \\exp(-\\lambda)}{1} = \\exp(-\\lambda)$$\nThe probability of a droplet containing a singlet ($k=1$) is:\n$$P(X=1) = \\frac{\\lambda^1 \\exp(-\\lambda)}{1!} = \\frac{\\lambda \\exp(-\\lambda)}{1} = \\lambda \\exp(-\\lambda)$$\nSumming these probabilities gives the probability of the complement event:\n$$P(X < 2) = \\exp(-\\lambda) + \\lambda \\exp(-\\lambda) = (1+\\lambda)\\exp(-\\lambda)$$\nThe desired probability, $P(X \\ge 2)$, is $1$ minus the probability of the complement:\n$$P(X \\ge 2) = 1 - P(X < 2) = 1 - (1+\\lambda)\\exp(-\\lambda)$$\nThis is the analytic expression for the probability of a droplet containing a doublet-or-higher as a function of $\\lambda$.\n\nFinally, we evaluate this expression for the given values of $\\lambda$.\n\nCase 1: $\\lambda = 0.1$\nThe probability is:\n$$P(X \\ge 2 | \\lambda=0.1) = 1 - (1+0.1)\\exp(-0.1) = 1 - 1.1 \\exp(-0.1)$$\nCalculating the value:\n$$P(X \\ge 2 | \\lambda=0.1) \\approx 1 - 1.1 \\times 0.904837418... = 1 - 0.995321159... \\approx 0.00467884...$$\nRounding to $4$ significant figures, we get $0.004679$.\n\nCase 2: $\\lambda = 0.2$\nThe probability is:\n$$P(X \\ge 2 | \\lambda=0.2) = 1 - (1+0.2)\\exp(-0.2) = 1 - 1.2 \\exp(-0.2)$$\nCalculating the value:\n$$P(X \\ge 2 | \\lambda=0.2) \\approx 1 - 1.2 \\times 0.818730753... = 1 - 0.982476903... \\approx 0.01752309...$$\nRounding to $4$ significant figures, we get $0.01752$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.004679 & 0.01752\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "After generating data, the next critical step is quality control to ensure that downstream analyses are based on viable cells. This exercise moves beyond simple ad-hoc filtering by introducing a rigorous, model-based approach to identify and exclude damaged cells based on their mitochondrial RNA content. You will apply Bayesian decision theory to derive an optimal exclusion threshold, learning how to formally balance the risks of discarding healthy cells versus retaining compromised ones .",
            "id": "5162677",
            "problem": "In single-cell ribonucleic acid sequencing, the mitochondrial messenger ribonucleic acid fraction, denoted by $x \\in [0,1]$, is widely used as a quality indicator because elevated mitochondrial transcript fractions are empirically associated with compromised membrane integrity and damaged cells. Consider a cohort where cells arise from two latent classes: healthy cells (class $H$) and damaged cells (class $D$). You will model the quality indicator using a mixture model and derive a Bayes-optimal decision boundary for excluding cells.\n\nAssume the following foundational elements:\n- The probability of a cell being healthy or damaged is given by prior probabilities $\\pi_{H}$ and $\\pi_{D}$ with $\\pi_{H}+\\pi_{D}=1$.\n- Misclassification losses are asymmetric: $\\lambda_{DH}$ is the loss incurred by excluding a healthy cell (deciding $D$ when true class is $H$), and $\\lambda_{HD}$ is the loss incurred by retaining a damaged cell (deciding $H$ when true class is $D$).\n- To map the bounded fraction into an unbounded scale suitable for a Gaussian model, use the logistic transform $y=\\ln\\!\\left(\\frac{x}{1-x}\\right)$.\n- Conditional on class, the transformed variable is approximately Gaussian: $y \\mid H \\sim \\mathcal{N}(\\mu_{H},\\sigma^{2})$ and $y \\mid D \\sim \\mathcal{N}(\\mu_{D},\\sigma^{2})$ with a common variance $\\sigma^{2}$.\n\nStarting from Bayes decision theory and the above assumptions, derive the analytical expression for the Bayes-optimal exclusion threshold $t^{\\star}$ on the original fraction scale, that is, the smallest value $t^{\\star} \\in (0,1)$ such that the rule “exclude a cell as damaged if and only if $x \\ge t^{\\star}$” minimizes expected loss.\n\nThen, for the scientifically realistic parameterization\n- $\\mu_{H}=-2.4$, $\\mu_{D}=-0.9$,\n- $\\sigma=0.55$,\n- $\\pi_{H}=0.85$, $\\pi_{D}=0.15$,\n- $\\lambda_{DH}=1$, $\\lambda_{HD}=3$,\nevaluate your derived expression numerically to obtain $t^{\\star}$.\n\nRound your final answer for $t^{\\star}$ to four significant figures. Express the final answer as a unitless fraction in $(0,1)$.",
            "solution": "The user wants me to solve a problem related to single-cell RNA sequencing.\n\nHere's my plan:\n1.  **Validate the Problem**: I will meticulously check the problem statement against my validation criteria.\n    -   **Step 1: Extract Givens**: I will list all the given variables, definitions, and conditions.\n        -   Variable: mitochondrial mRNA fraction, $x \\in [0,1]$.\n        -   Latent classes: Healthy ($H$) and Damaged ($D$).\n        -   Prior probabilities: $\\pi_{H}$ and $\\pi_{D}$, with $\\pi_{H}+\\pi_{D}=1$.\n        -   Misclassification losses: $\\lambda_{DH}$ (loss for deciding $D$ when true is $H$) and $\\lambda_{HD}$ (loss for deciding $H$ when true is $D$).\n        -   Transformation: $y = \\ln\\left(\\frac{x}{1-x}\\right)$.\n        -   Conditional distributions: $y \\mid H \\sim \\mathcal{N}(\\mu_{H}, \\sigma^2)$ and $y \\mid D \\sim \\mathcal{N}(\\mu_{D}, \\sigma^2)$.\n        -   Goal: Derive the Bayes-optimal exclusion threshold $t^{\\star}$ on the original scale $x$. The rule is \"exclude if $x \\ge t^{\\star}$\".\n        -   Numerical parameters:\n            -   $\\mu_{H} = -2.4$\n            -   $\\mu_{D} = -0.9$\n            -   $\\sigma = 0.55$\n            -   $\\pi_{H} = 0.85$\n            -   $\\pi_{D} = 0.15$\n            -   $\\lambda_{DH} = 1$\n            -   $\\lambda_{HD} = 3$\n        -   Final task: Evaluate $t^{\\star}$ numerically and round to four significant figures.\n\n    -   **Step 2: Validate Using Extracted Givens**:\n        -   **Scientifically Grounded**: The problem is grounded in bioinformatics and statistical modeling, specifically single-cell RNA sequencing analysis. The use of mitochondrial fraction as a QC metric, modeling with a mixture model, and using a logit transform for a bounded variable are all standard and sound practices in the field. The setup is realistic.\n        -   **Well-Posed**: The problem asks for a specific derivation and calculation. The model is well-defined (Gaussian mixture on a transformed scale), and the objective function (minimizing expected loss) is standard in Bayesian decision theory. This should lead to a unique solution.\n        -   **Objective**: The language is precise and technical. No subjective claims are made.\n        -   **Flaw Checklist**:\n            1.  **Scientific Unsoundness**: No, the model is a standard statistical approach for this type of data.\n            2.  **Non-Formalizable/Irrelevant**: No, it is a formalizable statistical problem directly related to single-cell sequencing.\n            3.  **Incomplete/Contradictory**: All necessary parameters and definitions seem to be provided. $\\pi_H + \\pi_D = 0.85 + 0.15 = 1$, which is consistent. The assumption that higher mitochondrial fraction corresponds to damaged cells is empirically supported, and this is reflected in the model parameters where $\\mu_D > \\mu_H$ on the logit scale (since $y$ is monotonic in $x$, higher $x$ corresponds to higher $y$). Let's check: $y=\\ln(x/(1-x))$ is an increasing function of $x$. A higher mitochondrial fraction $x$ means the cell is more likely to be damaged. This corresponds to a higher value of the transformed variable $y$. The model has $\\mu_D > \\mu_H$, which is consistent with this scientific prior. Damaged cells have a higher mean on the $y$ scale. The exclusion rule is \"exclude if $x \\ge t^{\\star}$\", which translates to \"exclude if $y \\ge y^{\\star}$\" where $y^{\\star} = \\ln(t^{\\star}/(1-t^{\\star}))$. This all aligns.\n            4.  **Unrealistic/Infeasible**: The parameters are stated to be \"scientifically realistic,\" and they appear so. The means and standard deviation are reasonable for a logit-transformed proportion.\n            5.  **Ill-Posed**: The problem is well-posed. The goal is to find a decision boundary that minimizes expected loss, a standard problem in statistical decision theory.\n            6.  **Pseudo-Profound/Trivial**: The problem requires a non-trivial derivation involving Bayes' rule, decision theory, and properties of the Gaussian distribution, followed by a numerical calculation. It is not trivial.\n            7.  **Outside Verifiability**: The derivation and calculation are mathematically verifiable.\n\n    -   **Step 3: Verdict and Action**: The problem is **VALID**. I will proceed to solve it.\n\n2.  **Solve the Problem**:\n    -   **Part A: Derive the analytical expression for the threshold.**\n        -   **Framework**: Bayes decision theory. The goal is to find a decision rule that minimizes the expected loss (also known as Bayes risk).\n        -   **Loss Function**: Let's define the action space $\\mathcal{A} = \\{\\text{decide } H, \\text{decide } D\\}$ and the true state space $\\Theta = \\{H, D\\}$. The loss function $L(\\theta, a)$ is given by:\n            -   $L(H, \\text{decide } H) = 0$ (correctly retaining a healthy cell)\n            -   $L(D, \\text{decide } D) = 0$ (correctly excluding a damaged cell)\n            -   $L(H, \\text{decide } D) = \\lambda_{DH}$ (incorrectly excluding a healthy cell)\n            -   $L(D, \\text{decide } H) = \\lambda_{HD}$ (incorrectly retaining a damaged cell)\n        -   **Decision Rule**: We observe a data point $y$ (transformed from $x$) and must decide whether the cell is $H$ or $D$. The decision rule is a function $\\delta(y)$ that maps an observation $y$ to an action in $\\mathcal{A}$. We are looking for a rule of the form: decide $D$ if $y \\ge y^\\star$, and decide $H$ if $y < y^\\star$. This corresponds to excluding the cell if its transformed mitochondrial fraction is above some threshold $y^\\star$.\n        -   **Expected Loss**: The expected loss for a given decision rule $\\delta(y)$ is the Bayes risk $R(\\delta) = \\mathbb{E}[L(\\theta, \\delta(Y))]$. To minimize this, we can make the decision for each $y$ that minimizes the *posterior* expected loss.\n        -   **Posterior Expected Loss**: For a given observation $y$, the posterior expected loss of deciding $H$ (retaining the cell) is:\n            $$ \\mathbb{E}[L(\\theta, \\text{decide } H) \\mid y] = L(H, \\text{decide } H) P(H \\mid y) + L(D, \\text{decide } H) P(D \\mid y) $$\n            $$ = 0 \\cdot P(H \\mid y) + \\lambda_{HD} P(D \\mid y) = \\lambda_{HD} P(D \\mid y) $$\n            The posterior expected loss of deciding $D$ (excluding the cell) is:\n            $$ \\mathbb{E}[L(\\theta, \\text{decide } D) \\mid y] = L(H, \\text{decide } D) P(H \\mid y) + L(D, \\text{decide } D) P(D \\mid y) $$\n            $$ = \\lambda_{DH} P(H \\mid y) + 0 \\cdot P(D \\mid y) = \\lambda_{DH} P(H \\mid y) $$\n        -   **Optimal Decision**: The Bayes-optimal rule is to choose the action that minimizes the posterior expected loss. We decide $D$ (exclude the cell) if:\n            $$ \\mathbb{E}[L(\\theta, \\text{decide } D) \\mid y] < \\mathbb{E}[L(\\theta, \\text{decide } H) \\mid y] $$\n            $$ \\lambda_{DH} P(H \\mid y) < \\lambda_{HD} P(D \\mid y) $$\n            The decision boundary $y^{\\star}$ is the point where these two expected losses are equal.\n            $$ \\lambda_{DH} P(H \\mid y^{\\star}) = \\lambda_{HD} P(D \\mid y^{\\star}) $$\n        -   **Using Bayes' Rule**: We need to express the posterior probabilities $P(H \\mid y)$ and $P(D \\mid y)$ in terms of the likelihoods $p(y|\\cdot)$ and priors $\\pi$.\n            $$ P(H \\mid y) = \\frac{p(y \\mid H) \\pi_H}{p(y)} \\quad \\text{and} \\quad P(D \\mid y) = \\frac{p(y \\mid D) \\pi_D}{p(y)} $$\n            Substituting this into the decision boundary equation:\n            $$ \\lambda_{DH} \\frac{p(y^{\\star} \\mid H) \\pi_H}{p(y^{\\star})} = \\lambda_{HD} \\frac{p(y^{\\star} \\mid D) \\pi_D}{p(y^{\\star})} $$\n            The evidence term $p(y^{\\star})$ cancels out.\n            $$ \\lambda_{DH} p(y^{\\star} \\mid H) \\pi_H = \\lambda_{HD} p(y^{\\star} \\mid D) \\pi_D $$\n            This can be rearranged into a likelihood ratio test. The threshold $y^{\\star}$ is the value of $y$ where the likelihood ratio equals a constant determined by the priors and losses:\n            $$ \\frac{p(y^{\\star} \\mid D)}{p(y^{\\star} \\mid H)} = \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} $$\n        -   **Substituting Gaussian Likelihoods**: The problem states that the conditional distributions of the transformed variable $y$ are Gaussian: $p(y \\mid H) = \\mathcal{N}(y; \\mu_H, \\sigma^2)$ and $p(y \\mid D) = \\mathcal{N}(y; \\mu_D, \\sigma^2)$. The probability density functions are:\n            $$ p(y \\mid H) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(y - \\mu_H)^2}{2\\sigma^2}\\right) $$\n            $$ p(y \\mid D) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(y - \\mu_D)^2}{2\\sigma^2}\\right) $$\n            The ratio of these densities is:\n            $$ \\frac{p(y^{\\star} \\mid D)}{p(y^{\\star} \\mid H)} = \\frac{\\exp\\left(-\\frac{(y^{\\star} - \\mu_D)^2}{2\\sigma^2}\\right)}{\\exp\\left(-\\frac{(y^{\\star} - \\mu_H)^2}{2\\sigma^2}\\right)} = \\exp\\left( \\frac{(y^{\\star} - \\mu_H)^2 - (y^{\\star} - \\mu_D)^2}{2\\sigma^2} \\right) $$\n        -   **Solving for $y^{\\star}$**: We now set the likelihood ratio equal to the decision threshold and take the natural logarithm of both sides to solve for $y^{\\star}$:\n            $$ \\frac{(y^{\\star} - \\mu_H)^2 - (y^{\\star} - \\mu_D)^2}{2\\sigma^2} = \\ln\\left( \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} \\right) $$\n            Expanding the numerator of the left side:\n            $$ ( (y^{\\star})^2 - 2y^{\\star}\\mu_H + \\mu_H^2 ) - ( (y^{\\star})^2 - 2y^{\\star}\\mu_D + \\mu_D^2 ) = 2y^{\\star}(\\mu_D - \\mu_H) + \\mu_H^2 - \\mu_D^2 $$\n            Substituting this back into the equation:\n            $$ \\frac{2y^{\\star}(\\mu_D - \\mu_H) - (\\mu_D^2 - \\mu_H^2)}{2\\sigma^2} = \\ln\\left( \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} \\right) $$\n            We solve for $y^{\\star}$:\n            $$ 2y^{\\star}(\\mu_D - \\mu_H) = 2\\sigma^2 \\ln\\left( \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} \\right) + (\\mu_D^2 - \\mu_H^2) $$\n            Using the difference of squares factorization $\\mu_D^2 - \\mu_H^2 = (\\mu_D - \\mu_H)(\\mu_D + \\mu_H)$ and assuming $\\mu_D \\neq \\mu_H$:\n            $$ 2y^{\\star}(\\mu_D - \\mu_H) = 2\\sigma^2 \\ln\\left( \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} \\right) + (\\mu_D - \\mu_H)(\\mu_D + \\mu_H) $$\n            Dividing by $2(\\mu_D - \\mu_H)$ yields the analytical expression for the threshold on the transformed scale:\n            $$ y^{\\star} = \\frac{\\mu_D + \\mu_H}{2} + \\frac{\\sigma^2}{\\mu_D - \\mu_H} \\ln\\left( \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} \\right) $$\n        -   **Convert back to original scale**: The transformation is $y = \\ln(x/(1-x))$. The inverse transformation is $x = \\frac{\\exp(y)}{1+\\exp(y)} = \\frac{1}{1+\\exp(-y)}$. The threshold $t^{\\star}$ on the original mitochondrial fraction scale $x$ is thus:\n            $$ t^{\\star} = \\frac{1}{1 + \\exp(-y^{\\star})} $$\n            Substituting the expression for $y^{\\star}$ gives the complete analytical solution:\n            $$ t^{\\star} = \\frac{1}{1 + \\exp\\left( -\\left[ \\frac{\\mu_D + \\mu_H}{2} + \\frac{\\sigma^2}{\\mu_D - \\mu_H} \\ln\\left( \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} \\right) \\right] \\right)} $$\n            The problem specifies that the rule is \"exclude if $x \\ge t^{\\star}$\". Since $y(x)$ is a monotonically increasing function, this corresponds to \"exclude if $y \\ge y^{\\star}$\". The condition for excluding is $\\lambda_{DH} P(H \\mid y) < \\lambda_{HD} P(D \\mid y)$, or $\\frac{p(y \\mid D)}{p(y \\mid H)} > \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D}$. Since $\\mu_D > \\mu_H$, the likelihood ratio is an increasing function of $y$, so this inequality holds for $y > y^{\\star}$, which confirms the exclusion region is $[t^{\\star}, 1]$.\n\n    -   **Part B: Numerical Evaluation**\n        The provided parameters are:\n        -   $\\mu_{H}=-2.4$\n        -   $\\mu_{D}=-0.9$\n        -   $\\sigma=0.55$, so $\\sigma^2 = 0.55^2 = 0.3025$\n        -   $\\pi_{H}=0.85$\n        -   $\\pi_{D}=0.15$\n        -   $\\lambda_{DH}=1$\n        -   $\\lambda_{HD}=3$\n\n        First, we calculate the components of the expression for $y^{\\star}$:\n        -   The average of the means: $\\frac{\\mu_D + \\mu_H}{2} = \\frac{-0.9 + (-2.4)}{2} = \\frac{-3.3}{2} = -1.65$.\n        -   The difference of the means: $\\mu_D - \\mu_H = -0.9 - (-2.4) = 1.5$.\n        -   The term inside the logarithm: $\\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} = \\frac{1 \\times 0.85}{3 \\times 0.15} = \\frac{0.85}{0.45} = \\frac{17}{9}$.\n\n        Now, we compute $y^{\\star}$:\n        $$ y^{\\star} = -1.65 + \\frac{0.3025}{1.5} \\ln\\left( \\frac{17}{9} \\right) $$\n        $$ y^{\\star} \\approx -1.65 + (0.201666...) \\times \\ln(1.888...) $$\n        $$ y^{\\star} \\approx -1.65 + (0.201666...) \\times (0.635988...) $$\n        $$ y^{\\star} \\approx -1.65 + 0.128264... $$\n        $$ y^{\\star} \\approx -1.521736 $$\n        Finally, we compute the threshold $t^{\\star}$ on the original scale:\n        $$ t^{\\star} = \\frac{1}{1 + \\exp(-y^{\\star})} \\approx \\frac{1}{1 + \\exp(-(-1.521736))} $$\n        $$ t^{\\star} \\approx \\frac{1}{1 + \\exp(1.521736)} $$\n        $$ t^{\\star} \\approx \\frac{1}{1 + 4.58015} $$\n        $$ t^{\\star} \\approx \\frac{1}{5.58015} $$\n        $$ t^{\\star} \\approx 0.1792066 $$\n        Rounding to four significant figures, the Bayes-optimal exclusion threshold is $0.1792$.",
            "answer": "$$\n\\boxed{0.1792}\n$$"
        },
        {
            "introduction": "The ultimate goal of many single-cell experiments is to draw valid biological conclusions, which requires sound statistical analysis. This final practice addresses the pervasive and critical issue of pseudoreplication in studies with multiple donors, where incorrectly treating cells as independent replicates can grossly inflate statistical significance. By deriving and comparing the variance of an effect estimator under a naive model versus a correct mixed-effects model, you will quantify the impact of this error and understand the necessity of modeling hierarchical data structures appropriately .",
            "id": "5162658",
            "problem": "In a two-condition single-cell RNA sequencing (scRNA-seq) differential expression study in molecular and immunodiagnostics, cells are sampled from human donors, and gene expression is measured on a log-normalized scale. Let condition be encoded at the donor level by $x_{i} \\in \\{0,1\\}$ for donor $i$, with each donor contributing multiple cells. Consider a single gene whose cell-level expression for cell $j$ from donor $i$ is modeled additively by a donor-level offset and a cell-level residual, with all sources centered at zero. Assume the following facts as the fundamental base:\n- Linearity of expectation and the bilinearity of covariance.\n- For any finite collection of random variables, the variance of a sum equals the sum of variances plus twice the sum of pairwise covariances.\n- Donor-level offsets are independent across donors, residuals are independent across cells, and donor-level offsets are independent of residuals.\n\nYou are asked to analyze pseudoreplication when cells are treated as independent replicates and to derive the appropriate model and variance under donor-level random effects, then quantify the inflation of significance.\n\nSet up the following balanced design: there are $D_{0}$ donors in condition $x=0$ and $D_{1}$ donors in condition $x=1$, and each donor contributes exactly $m$ cells. Let the donor-level offsets $\\{b_{i}\\}$ be independent with mean $0$ and variance $\\sigma_{b}^{2}$, and let the cell-level residuals $\\{\\varepsilon_{ij}\\}$ be independent with mean $0$ and variance $\\sigma_{e}^{2}$, with $b_{i}$ independent of all $\\varepsilon_{ij}$. The observable cell-level expression is\n$$\ny_{ij}=\\mu+\\beta x_{i}+b_{i}+\\varepsilon_{ij}.\n$$\nThe naive cell-level analysis that ignores donor structure fits a fixed-effects regression of $y_{ij}$ on $x_{i}$ treating all cells as independent and identically distributed, whereas the correct analysis uses a mixed-effects model with a donor-level random intercept.\n\nTasks:\n1. Using only the variance-covariance properties stated above and the additive structure of $y_{ij}$, derive the variance of the group mean in each condition under the mixed-effects model and hence derive the variance of the estimator of the condition effect $\\beta$ as the difference of group means. Express your result symbolically in terms of $D_{0}$, $D_{1}$, $m$, $\\sigma_{b}^{2}$, and $\\sigma_{e}^{2}$.\n2. Under the naive cell-level analysis that treats all cells as independent with common variance, derive the corresponding variance of the same estimator of $\\beta$.\n3. Define the inflation factor for the $z$-statistic as $R_{z}=z_{\\text{naive}}/z_{\\text{mixed}}$, where $z_{\\text{naive}}$ uses the naive variance and $z_{\\text{mixed}}$ uses the mixed-effects variance. Derive a closed-form expression for $R_{z}$ in terms of $D_{0}$, $D_{1}$, $m$, $\\sigma_{b}^{2}$, and $\\sigma_{e}^{2}$.\n4. In a realistic scRNA-seq experiment with $D_{0}=6$, $D_{1}=6$, $m=100$, $\\sigma_{b}^{2}=0.5$, and $\\sigma_{e}^{2}=1$, evaluate $R_{z}$ exactly. Express the final ratio as an exact closed-form expression; do not round.",
            "solution": "The problem statement is a valid and well-posed statistical question concerning pseudoreplication in hierarchical experimental designs, a critical topic in bioinformatics. All necessary parameters, models, and assumptions are provided, allowing for a rigorous and unique solution.\n\nThe estimator for the condition effect $\\beta$ is the difference in the sample means between condition $x=1$ and condition $x=0$. Let $\\bar{y}_{1}$ and $\\bar{y}_{0}$ be the mean expression levels for all cells in condition $1$ and condition $0$, respectively. The estimator is thus $\\hat{\\beta} = \\bar{y}_{1} - \\bar{y}_{0}$.\n\nLet us denote the set of donor indices in condition $0$ as $I_{0}$ (with $|I_{0}| = D_{0}$) and in condition $1$ as $I_{1}$ (with $|I_{1}| = D_{1}$). The mean for condition $k \\in \\{0, 1\\}$ is given by:\n$$\n\\bar{y}_{k} = \\frac{1}{D_{k}m} \\sum_{i \\in I_{k}} \\sum_{j=1}^{m} y_{ij}\n$$\nSince the donors in condition $0$ are independent of the donors in condition $1$, the random variables $\\bar{y}_{0}$ and $\\bar{y}_{1}$ are independent. Therefore, the variance of their difference is the sum of their variances:\n$$\n\\text{Var}(\\hat{\\beta}) = \\text{Var}(\\bar{y}_{1} - \\bar{y}_{0}) = \\text{Var}(\\bar{y}_{1}) + \\text{Var}(\\bar{y}_{0})\n$$\n\n### Task 1: Variance of $\\hat{\\beta}$ under the Mixed-Effects Model\n\nThe correct analysis accounts for the two-level structure of the data (cells nested within donors). We first calculate the variance of the mean expression for a single condition, say condition $1$. The expression for cell $j$ from donor $i$ in condition $1$ is $y_{ij} = \\mu + \\beta + b_{i} + \\varepsilon_{ij}$.\n\nThe mean for condition $1$ can be expressed as the average of donor-level means:\n$$\n\\bar{y}_{1} = \\frac{1}{D_{1}} \\sum_{i \\in I_{1}} \\left( \\frac{1}{m} \\sum_{j=1}^{m} y_{ij} \\right) = \\frac{1}{D_{1}} \\sum_{i \\in I_{1}} \\bar{y}_{i}\n$$\nwhere $\\bar{y}_{i}$ is the mean expression for donor $i$. Let's find the structure of $\\bar{y}_{i}$:\n$$\n\\bar{y}_{i} = \\frac{1}{m} \\sum_{j=1}^{m} (\\mu + \\beta + b_{i} + \\varepsilon_{ij}) = \\mu + \\beta + b_{i} + \\frac{1}{m} \\sum_{j=1}^{m} \\varepsilon_{ij} = \\mu + \\beta + b_{i} + \\bar{\\varepsilon}_{i}\n$$\nwhere $\\bar{\\varepsilon}_{i}$ is the mean of the residuals for donor $i$. The variance of this donor-level mean is:\n$$\n\\text{Var}(\\bar{y}_{i}) = \\text{Var}(\\mu + \\beta + b_{i} + \\bar{\\varepsilon}_{i}) = \\text{Var}(b_{i} + \\bar{\\varepsilon}_{i})\n$$\nSince $b_{i}$ and all $\\varepsilon_{ij}$ are independent, $b_{i}$ is independent of $\\bar{\\varepsilon}_{i}$. Thus:\n$$\n\\text{Var}(\\bar{y}_{i}) = \\text{Var}(b_{i}) + \\text{Var}(\\bar{\\varepsilon}_{i})\n$$\nWe know $\\text{Var}(b_{i}) = \\sigma_{b}^{2}$. Since the $\\varepsilon_{ij}$ are independent with variance $\\sigma_{e}^{2}$, the variance of their mean is:\n$$\n\\text{Var}(\\bar{\\varepsilon}_{i}) = \\text{Var}\\left(\\frac{1}{m} \\sum_{j=1}^{m} \\varepsilon_{ij}\\right) = \\frac{1}{m^2} \\sum_{j=1}^{m} \\text{Var}(\\varepsilon_{ij}) = \\frac{1}{m^2} (m \\sigma_{e}^{2}) = \\frac{\\sigma_{e}^{2}}{m}\n$$\nSo, the variance of a single donor's mean expression is:\n$$\n\\text{Var}(\\bar{y}_{i}) = \\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}\n$$\nNow we can compute the variance of the group mean $\\bar{y}_{1}$. Since the donor-level effects $\\{b_{i}\\}$ are independent across donors (and so are the residuals), the donor means $\\{\\bar{y}_{i}\\}$ are independent.\n$$\n\\text{Var}_{\\text{mixed}}(\\bar{y}_{1}) = \\text{Var}\\left(\\frac{1}{D_{1}} \\sum_{i \\in I_{1}} \\bar{y}_{i}\\right) = \\frac{1}{D_{1}^{2}} \\sum_{i \\in I_{1}} \\text{Var}(\\bar{y}_{i}) = \\frac{1}{D_{1}^{2}} \\left(D_{1} \\left(\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}\\right)\\right) = \\frac{\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}}{D_{1}}\n$$\nBy identical logic for condition $0$ (where the model is $y_{ij} = \\mu + b_{i} + \\varepsilon_{ij}$), the variance of its mean is:\n$$\n\\text{Var}_{\\text{mixed}}(\\bar{y}_{0}) = \\frac{\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}}{D_{0}}\n$$\nFinally, the variance of the estimator $\\hat{\\beta}$ under the mixed-effects model is:\n$$\n\\text{Var}_{\\text{mixed}}(\\hat{\\beta}) = \\text{Var}_{\\text{mixed}}(\\bar{y}_{1}) + \\text{Var}_{\\text{mixed}}(\\bar{y}_{0}) = \\frac{\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}}{D_{1}} + \\frac{\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}}{D_{0}}\n$$\n$$\n\\text{Var}_{\\text{mixed}}(\\hat{\\beta}) = \\left(\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}\\right) \\left(\\frac{1}{D_{0}} + \\frac{1}{D_{1}}\\right)\n$$\n\n### Task 2: Variance of $\\hat{\\beta}$ under the Naive Model\n\nThe naive analysis incorrectly assumes all cells are independent replicates. Under this assumption, the variance of the sample mean is calculated by dividing the total variance of a single observation by the total number of observations. First, let's find the total variance of a single observation $y_{ij}$:\n$$\n\\text{Var}(y_{ij}) = \\text{Var}(\\mu + \\beta x_{i} + b_{i} + \\varepsilon_{ij}) = \\text{Var}(b_{i} + \\varepsilon_{ij}) = \\text{Var}(b_{i}) + \\text{Var}(\\varepsilon_{ij}) = \\sigma_{b}^{2} + \\sigma_{e}^{2}\n$$\nThe naive model assumes a common variance $\\sigma_{\\text{total}}^{2} = \\sigma_{b}^{2} + \\sigma_{e}^{2}$ for all cells and treats them as independent. The number of cells in condition $1$ is $N_{1} = D_{1}m$, and in condition $0$ is $N_{0} = D_{0}m$.\n\nThe variance of the mean for condition $1$, under this naive assumption, is:\n$$\n\\text{Var}_{\\text{naive}}(\\bar{y}_{1}) = \\frac{\\text{Var}(y_{ij})}{N_{1}} = \\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{D_{1}m}\n$$\nSimilarly, for condition $0$:\n$$\n\\text{Var}_{\\text{naive}}(\\bar{y}_{0}) = \\frac{\\text{Var}(y_{ij})}{N_{0}} = \\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{D_{0}m}\n$$\nThe variance of the estimator $\\hat{\\beta}$ under the naive model is the sum of these variances:\n$$\n\\text{Var}_{\\text{naive}}(\\hat{\\beta}) = \\text{Var}_{\\text{naive}}(\\bar{y}_{1}) + \\text{Var}_{\\text{naive}}(\\bar{y}_{0}) = \\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{D_{1}m} + \\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{D_{0}m}\n$$\n$$\n\\text{Var}_{\\text{naive}}(\\hat{\\beta}) = \\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{m} \\left(\\frac{1}{D_{0}} + \\frac{1}{D_{1}}\\right)\n$$\n\n### Task 3: Inflation Factor $R_{z}$\n\nThe z-statistic for testing $\\beta=0$ is given by $z = \\hat{\\beta} / \\text{SE}(\\hat{\\beta})$, where $\\text{SE}(\\hat{\\beta}) = \\sqrt{\\text{Var}(\\hat{\\beta})}$. The inflation factor is the ratio of the naive z-statistic to the correct mixed-effects z-statistic:\n$$\nR_{z} = \\frac{z_{\\text{naive}}}{z_{\\text{mixed}}} = \\frac{\\hat{\\beta} / \\sqrt{\\text{Var}_{\\text{naive}}(\\hat{\\beta})}}{\\hat{\\beta} / \\sqrt{\\text{Var}_{\\text{mixed}}(\\hat{\\beta})}} = \\sqrt{\\frac{\\text{Var}_{\\text{mixed}}(\\hat{\\beta})}{\\text{Var}_{\\text{naive}}(\\hat{\\beta})}}\n$$\nSubstituting the expressions derived in Tasks 1 and 2:\n$$\nR_{z} = \\sqrt{\\frac{\\left(\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}\\right) \\left(\\frac{1}{D_{0}} + \\frac{1}{D_{1}}\\right)}{\\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{m} \\left(\\frac{1}{D_{0}} + \\frac{1}{D_{1}}\\right)}}\n$$\nThe term $\\left(\\frac{1}{D_{0}} + \\frac{1}{D_{1}}\\right)$ cancels out, provided $D_{0}, D_{1} > 0$:\n$$\nR_{z} = \\sqrt{\\frac{\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}}{\\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{m}}} = \\sqrt{\\frac{m(\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m})}{m(\\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{m})}} = \\sqrt{\\frac{m \\sigma_{b}^{2} + \\sigma_{e}^{2}}{\\sigma_{b}^{2} + \\sigma_{e}^{2}}}\n$$\n\n### Task 4: Numerical Evaluation\n\nWe are given the values: $D_{0}=6$, $D_{1}=6$, $m=100$, $\\sigma_{b}^{2}=0.5$, and $\\sigma_{e}^{2}=1$.\nWe substitute these values into the expression for $R_{z}$. Note that $D_{0}$ and $D_{1}$ are not needed for this calculation.\n$$\nR_{z} = \\sqrt{\\frac{(100)(0.5) + 1}{0.5 + 1}}\n$$\n$$\nR_{z} = \\sqrt{\\frac{50 + 1}{1.5}} = \\sqrt{\\frac{51}{1.5}}\n$$\nTo maintain exactness, we express $1.5$ as a fraction, $3/2$:\n$$\nR_{z} = \\sqrt{\\frac{51}{3/2}} = \\sqrt{51 \\times \\frac{2}{3}}\n$$\nSince $51 = 3 \\times 17$, we can simplify the expression:\n$$\nR_{z} = \\sqrt{\\frac{(3 \\times 17) \\times 2}{3}} = \\sqrt{17 \\times 2} = \\sqrt{34}\n$$\nThis represents the factor by which the statistical significance (z-score) is inflated due to pseudoreplication.",
            "answer": "$$\n\\boxed{\\sqrt{34}}\n$$"
        }
    ]
}