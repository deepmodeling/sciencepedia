{
    "hands_on_practices": [
        {
            "introduction": "在许多基于阵列的空间转录组学技术中，我们测量的是包含多个细胞混合信号的“捕获点”。理解每个捕获点预期捕获的细胞数量（即细胞多样性）对于数据解释和质量控制至关重要。本练习利用随机几何学原理，建立一个数学模型，将实验的物理参数（如捕获点直径和细胞大小分布）与预期的细胞多样性联系起来，为我们解读空间数据提供坚实的理论基础 。",
            "id": "5163993",
            "problem": "在空间分辨基因表达分析（例如空间转录组学，ST）中，将组织切片放置在由直径为 $d_{s}$ 的圆形捕获点组成的阵列上，这些捕获点会收集任何与点发生几何相交的细胞体的信使核糖核酸 (mRNA)。考虑一个二维组织层，其中细胞被建模为具有随机直径 $D$ 的不重叠圆形圆盘。假设：\n- 细胞中心在二维空间中遵循一个强度为 $n$（单位面积内的细胞数）的均匀泊松点过程 (PPP)。\n- 细胞体直径 $D$ 是一个独立的随机变量，其概率分布具有有限的一阶矩和二阶矩。\n- 组织的细胞面积分数（面堆积分数）为 $\\phi \\in (0,1)$，定义为被细胞占据的面积比例。\n- 一个细胞对一个点的多重性有贡献，当且仅当其圆盘与该点的圆盘相交。\n\n仅使用均匀 PPP 的基本定义、期望的线性性以及关于 Minkowski 膨胀面积的标准结果（Steiner 凸集公式），完成以下任务：\n\n1. 推导每个点的期望细胞多重性 $\\mathbb{E}[M]$ 的解析表达式，该表达式是 $d_{s}$、$\\phi$ 以及 $D$ 的一阶和二阶矩的函数。您的推导应从以下几点开始：\n   - PPP 的定义，即一个区域内的期望计数等于强度乘以面积。\n   - 在非重叠近似下，强度 $n$ 与堆积分数 $\\phi$ 之间的关系。\n   - 一个圆盘被另一个圆盘膨胀的面积，通过线性性推广到随机细胞半径的情况。\n   将您的最终符号结果表示为 $d_{s}$、$\\phi$、$\\mathbb{E}[D]$ 和 $\\mathbb{E}[D^{2}]$ 的函数。\n\n2. 将您的表达式特例化到 $D$ 服从均值为 $\\bar{d}$、变异系数为 $c_{v}$ 的 Gamma 分布的情况。将 $\\mathbb{E}[M]$ 完全用 $d_{s}$、$\\phi$、$\\bar{d}$ 和 $c_{v}$ 表示。\n\n3. 对于堆积分数 $\\phi = 0.7$、捕获点直径 $d_{s} = 55$ 微米、细胞直径服从均值为 $\\bar{d} = 12$ 微米且变异系数为 $c_{v} = 0.25$ 的 Gamma 分布的组织，数值计算期望多重性。将最终结果表示为无量纲的期望计数（每个点的细胞数），并将答案四舍五入到四位有效数字。",
            "solution": "该问题被评估为有效，因为它在科学上基于随机几何和概率论的原理，提法明确、目标清晰，并提供了一套完整且一致的参数，这些参数在空间转录组学领域是典型的。\n\n解答按要求分为三个部分推导。\n\n第 1 部分：推导每个点的期望细胞多重性 $\\mathbb{E}[M]$。\n\n令 $M$ 为表示多重性（即被单个点捕获的细胞数量）的随机变量。问题将细胞中心建模为 $\\mathbb{R}^2$ 中强度为 $n$ 的均匀泊松点过程 (PPP)。细胞本身是具有随机直径 $D$ 的圆形圆盘，而捕获点是具有固定直径 $d_s$ 的圆形圆盘。\n\n一个中心位于 $\\mathbf{x}_c \\in \\mathbb{R}^2$、半径为 $R = D/2$ 的细胞，与一个以原点为中心、半径为 $r_s = d_s/2$ 的点相交，当且仅当它们中心之间的距离小于或等于它们的半径之和。这个条件表示为 $\\|\\mathbf{x}_c\\| \\le R + r_s$。\n\n对于一个给定半径为 $R$ 的特定细胞，其中心 $\\mathbf{x}_c$ 必须落在以原点为中心、半径为 $R + r_s$ 的圆盘内，才能被计数。这个“捕获区域”的面积是捕获点圆盘和细胞圆盘的 Minkowski 和的面积，由 $A(D) = \\pi (r_s + R)^2 = \\pi (d_s/2 + D/2)^2$ 给出。\n\n根据均匀 PPP 的性质，落入给定区域的点的期望数量是强度 $n$ 乘以该区域的面积。由于我们的捕获区域的面积取决于随机变量 $D$，我们必须对 $D$ 的分布取期望。使用全期望定律（或用于标记点过程的 Campbell 定理），期望多重性 $\\mathbb{E}[M]$ 是强度 $n$ 与捕获区域的期望面积的乘积：\n$$\n\\mathbb{E}[M] = n \\cdot \\mathbb{E}[A(D)]\n$$\n我们首先使用期望的线性性计算期望面积 $\\mathbb{E}[A(D)]$：\n$$\n\\mathbb{E}[A(D)] = \\mathbb{E}\\left[\\pi \\left(\\frac{d_s}{2} + \\frac{D}{2}\\right)^2\\right] = \\frac{\\pi}{4} \\mathbb{E}[(d_s + D)^2] = \\frac{\\pi}{4} \\mathbb{E}[d_s^2 + 2d_s D + D^2]\n$$\n$$\n\\mathbb{E}[A(D)] = \\frac{\\pi}{4} (d_s^2 + 2d_s \\mathbb{E}[D] + \\mathbb{E}[D^2])\n$$\n接下来，我们将强度 $n$ 与细胞面积分数 $\\phi$ 联系起来。面积分数 $\\phi$ 定义为单位面积内被细胞占据的总面积。对于 PPP，这是单位面积内的期望细胞数 $n$ 与单个细胞的期望面积的乘积。直径为 $D$ 的细胞的面积是 $\\pi (D/2)^2 = \\frac{\\pi}{4}D^2$。其期望面积是 $\\mathbb{E}[\\frac{\\pi}{4}D^2] = \\frac{\\pi}{4}\\mathbb{E}[D^2]$。\n因此，面积分数为：\n$$\n\\phi = n \\cdot \\frac{\\pi}{4}\\mathbb{E}[D^2]\n$$\n这使我们能够用 $\\phi$ 和细胞直径的二阶矩来表示强度 $n$：\n$$\nn = \\frac{4\\phi}{\\pi \\mathbb{E}[D^2]}\n$$\n现在，我们将这个 $n$ 的表达式代入 $\\mathbb{E}[M]$ 的方程中：\n$$\n\\mathbb{E}[M] = \\left(\\frac{4\\phi}{\\pi \\mathbb{E}[D^2]}\\right) \\cdot \\left(\\frac{\\pi}{4} (d_s^2 + 2d_s \\mathbb{E}[D] + \\mathbb{E}[D^2])\\right)\n$$\n$\\pi/4$ 因子被消去，得到：\n$$\n\\mathbb{E}[M] = \\phi \\cdot \\frac{d_s^2 + 2d_s \\mathbb{E}[D] + \\mathbb{E}[D^2]}{\\mathbb{E}[D^2]}\n$$\n这个表达式可以写成：\n$$\n\\mathbb{E}[M] = \\phi \\left(1 + \\frac{2d_s \\mathbb{E}[D]}{\\mathbb{E}[D^2]} + \\frac{d_s^2}{\\mathbb{E}[D^2]}\\right)\n$$\n这就是所要求的期望多重性作为 $d_s$、$\\phi$ 以及 $D$ 的一阶矩 $\\mathbb{E}[D]$ 和二阶矩 $\\mathbb{E}[D^2]$ 的函数的解析表达式。\n\n第 2 部分：对 Gamma 分布直径的特例化。\n\n问题指明细胞直径 $D$ 服从均值为 $\\mathbb{E}[D] = \\bar{d}$、变异系数为 $c_v$ 的 Gamma 分布。变异系数定义为 $c_v = \\frac{\\sqrt{\\text{Var}(D)}}{\\mathbb{E}[D]}$。\n\n我们需要用 $\\bar{d}$ 和 $c_v$ 来表示 $D$ 的一阶矩和二阶矩。\n一阶矩直接给出：\n$$\n\\mathbb{E}[D] = \\bar{d}\n$$\n二阶矩 $\\mathbb{E}[D^2]$ 通过恒等式 $\\text{Var}(D) = \\mathbb{E}[D^2] - (\\mathbb{E}[D])^2$ 与方差和均值相关。\n根据 $c_v$ 的定义，方差为 $\\text{Var}(D) = (c_v \\cdot \\mathbb{E}[D])^2 = c_v^2 \\bar{d}^2$。\n因此，我们可以解出二阶矩：\n$$\n\\mathbb{E}[D^2] = \\text{Var}(D) + (\\mathbb{E}[D])^2 = c_v^2 \\bar{d}^2 + \\bar{d}^2 = \\bar{d}^2(1 + c_v^2)\n$$\n将 $\\mathbb{E}[D]$ 和 $\\mathbb{E}[D^2]$ 的这些表达式代入第 1 部分的结果中：\n$$\n\\mathbb{E}[M] = \\phi \\left(1 + \\frac{2d_s \\bar{d}}{\\bar{d}^2(1 + c_v^2)} + \\frac{d_s^2}{\\bar{d}^2(1 + c_v^2)}\\right)\n$$\n简化此表达式得到：\n$$\n\\mathbb{E}[M] = \\phi \\left(1 + \\frac{2d_s/\\bar{d} + (d_s/\\bar{d})^2}{1 + c_v^2}\\right)\n$$\n这就是用 $d_s$、$\\phi$、$\\bar{d}$ 和 $c_v$ 表示的 $\\mathbb{E}[M]$ 的特例化表达式。\n\n第 3 部分：数值计算。\n\n我们得到以下参数值：\n- 堆积分数：$\\phi = 0.7$\n- 捕获点直径：$d_s = 55$ 微米\n- 平均细胞直径：$\\bar{d} = 12$ 微米\n- 细胞直径的变异系数：$c_v = 0.25$\n\n首先，我们计算矩的值：\n$$\n\\mathbb{E}[D] = \\bar{d} = 12\n$$\n$$\n\\mathbb{E}[D^2] = \\bar{d}^2(1 + c_v^2) = 12^2(1 + 0.25^2) = 144(1 + 0.0625) = 144(1.0625) = 153\n$$\n现在，我们将这些矩和给定的参数代入第 1 部分的通用表达式中：\n$$\n\\mathbb{E}[M] = \\phi \\left(1 + \\frac{2d_s \\mathbb{E}[D]}{\\mathbb{E}[D^2]} + \\frac{d_s^2}{\\mathbb{E}[D^2]}\\right)\n$$\n$$\n\\mathbb{E}[M] = 0.7 \\left(1 + \\frac{2(55)(12)}{153} + \\frac{55^2}{153}\\right)\n$$\n$$\n\\mathbb{E}[M] = 0.7 \\left(1 + \\frac{1320}{153} + \\frac{3025}{153}\\right)\n$$\n将括号内的项合并到公分母 $153$ 上：\n$$\n\\mathbb{E}[M] = 0.7 \\left(\\frac{153 + 1320 + 3025}{153}\\right) = 0.7 \\left(\\frac{4498}{153}\\right)\n$$\n进行除法和乘法运算：\n$$\n\\mathbb{E}[M] \\approx 0.7 \\times 29.39869...\n$$\n$$\n\\mathbb{E}[M] \\approx 20.57908...\n$$\n问题要求将结果四舍五入到四位有效数字。\n$$\n\\mathbb{E}[M] \\approx 20.58\n$$\n期望多重性约为每个点 $20.58$ 个细胞。",
            "answer": "$$\\boxed{20.58}$$"
        },
        {
            "introduction": "与基于阵列的方法不同，基于成像的空间转录组学技术通过显微成像直接在原位对分子进行定位，这需要周密的实验规划以平衡分辨率、组织覆盖范围和时间成本。本练习模拟了一个真实的实验设计场景，指导你如何应用奈奎斯特采样定理来确定所需的光学分辨率，并精确计算完成大面积组织成像所需的总时间 。通过这个实践，你将学会如何在保证数据质量的同时，量化和优化高分辨率空间组学实验的效率。",
            "id": "5164024",
            "problem": "在面积为 $A$ 的方形组织切片上进行空间分辨转录组学（SRT）分析，使用宽场荧光成像技术以亚细胞精度定位信使核糖核酸（mRNA）转录本。为确保可靠检测最小的目标特征（例如，杂交斑点），采样必须遵循奈奎斯特采样定理：一个最小特征尺寸为 $f$ 的特征仅在样本平面像素尺寸 $p$ 满足 $p \\leq f/2$ 时才可被检测到。该成像系统由一个具有 $N_x \\times N_y$ 像素的科学级互补金属氧化物半导体（sCMOS）相机和一个物镜组成，使得样本平面像素尺寸为 $p$。视场（FOV）是一个宽度为 $W = N_x p$、高度为 $H = N_y p$ 的矩形。为确保可靠的图像拼接配准和照明平场校正，要求沿两个轴向的相邻区块之间有 $\\beta$ 的分数重叠率，因此水平拼接步进为 $p_x = (1 - \\beta) W$，垂直拼接步进为 $p_y = (1 - \\beta) H$。载物台执行蛇形扫描：在每行 $n_x$ 个区块中，载物台移动 $(n_x - 1)$ 个水平步进步长；在行与行之间，它执行一个垂直步进步长。载物台总行程长度是所有水平和垂直步进移动的总和。载物台以速度 $v$ 移动。每个区块的采集包括 $c$ 个顺序荧光通道，每个通道有曝光时间 $t_{\\exp}$ 和每通道读出时间 $t_{\\mathrm{read}}$，外加单个每区块对焦锁定更新时间 $t_{\\mathrm{focus}}$ 和每区块稳定时间 $t_{\\mathrm{stab}}$。每次换行会产生额外的换行开销 $t_{\\mathrm{rev}}$。总成像时间是所有区块的采集时间、载物台移动时间以及换行开销的总和。\n\n使用以下参数，计算总区块数和总成像时间：\n- 期望的最小可检测特征尺寸 $f = 2\\,\\mu\\mathrm{m}$。\n- 组织面积 $A = 100\\,\\mathrm{mm}^2$，且组织为方形，边长为 $\\sqrt{A}$。\n- 相机像素数 $N_x = N_y = 2048$。\n- 样本平面像素尺寸 $p = 0.325\\,\\mu\\mathrm{m}$。\n- 区块重叠率 $\\beta = 0.10$（沿两个轴向）。\n- 载物台速度 $v = 40\\,\\mathrm{mm}\\,\\mathrm{s}^{-1}$。\n- 每区块荧光通道数 $c = 4$。\n- 每通道曝光时间 $t_{\\exp} = 0.200\\,\\mathrm{s}$ 和每通道读出时间 $t_{\\mathrm{read}} = 0.020\\,\\mathrm{s}$。\n- 每区块对焦锁定更新时间 $t_{\\mathrm{focus}} = 0.015\\,\\mathrm{s}$ 和每区块稳定时间 $t_{\\mathrm{stab}} = 0.005\\,\\mathrm{s}$。\n- 每行换行开销 $t_{\\mathrm{rev}} = 0.010\\,\\mathrm{s}$。\n\n从上述采样要求开始，验证所提供的 $p$ 对于 $f$ 是足够的，然后推导出每行的区块数 $n_x$ 和每列的区块数 $n_y$、总区块数 $N$、蛇形路径的总行程长度以及以小时为单位的总成像时间。对于成像时间，请以小时表示最终答案并四舍五入到四位有效数字。将区块数报告为精确整数。最终答案必须只包含两个值：总区块数和以小时为单位的总成像时间。",
            "solution": "对问题陈述进行评估后，认定其有效。它在科学上基于荧光显微镜和自动化成像的原理，问题设定良好，参数完整且一致，并以客观、正式的方式呈现。通过系统地应用所提供的定义和公式，可以推导出唯一的解。\n\n求解过程分为几个步骤：验证采样标准，计算成像视场（FOV）和拼接参数，确定覆盖组织区域所需的区块数量，最后通过对采集时间、移动时间和开销时间分量求和来计算总成像时间。\n\n首先，我们验证奈奎斯特采样标准是否得到满足。最小可检测特征尺寸给定为 $f = 2\\,\\mu\\mathrm{m}$。该定理要求样本平面像素尺寸 $p$ 满足条件 $p \\leq f/2$。\n给定 $p = 0.325\\,\\mu\\mathrm{m}$，我们计算所需的最大像素尺寸：\n$$ \\frac{f}{2} = \\frac{2\\,\\mu\\mathrm{m}}{2} = 1\\,\\mu\\mathrm{m} $$\n条件为 $0.325\\,\\mu\\mathrm{m} \\leq 1\\,\\mu\\mathrm{m}$，该条件得到满足。因此，指定的像素尺寸足以满足期望的特征分辨率。\n\n接下来，我们计算FOV的尺寸。相机传感器有 $N_x = 2048$ 像素和 $N_y = 2048$ 像素。\nFOV宽度为 $W = N_x p$，高度为 $H = N_y p$。\n$$ W = H = 2048 \\times 0.325\\,\\mu\\mathrm{m} = 665.6\\,\\mu\\mathrm{m} $$\n为与其他以毫米为单位的参数保持一致，我们将其转换为 $W = H = 0.6656\\,\\mathrm{mm}$。\n拼接图是基于 $\\beta = 0.10$ 的分数重叠率构建的。相邻区块中心之间的距离，即拼接步进，为：\n$$ p_x = (1 - \\beta) W = (1 - 0.10) \\times 0.6656\\,\\mathrm{mm} = 0.59904\\,\\mathrm{mm} $$\n$$ p_y = (1 - \\beta) H = (1 - 0.10) \\times 0.6656\\,\\mathrm{mm} = 0.59904\\,\\mathrm{mm} $$\n\n接着我们确定覆盖面积为 $A = 100\\,\\mathrm{mm}^2$ 的方形组织切片所需的区块数。组织的边长是 $L_{\\text{tissue}} = \\sqrt{A} = \\sqrt{100\\,\\mathrm{mm}^2} = 10\\,\\mathrm{mm}$。\n在水平方向上由 $n_x$ 个区块覆盖的总范围是 $W + (n_x - 1)p_x$。这必须大于或等于 $L_{\\text{tissue}}$。\n$$ W + (n_x - 1)p_x \\geq L_{\\text{tissue}} $$\n解出 $n_x$：\n$$ n_x \\geq 1 + \\frac{L_{\\text{tissue}} - W}{p_x} $$\n由于 $n_x$ 必须是整数，我们对表达式取上取整：\n$$ n_x = \\left\\lceil 1 + \\frac{10\\,\\mathrm{mm} - 0.6656\\,\\mathrm{mm}}{0.59904\\,\\mathrm{mm}} \\right\\rceil = \\left\\lceil 1 + \\frac{9.3344}{0.59904} \\right\\rceil = \\lceil 1 + 15.5823... \\rceil = \\lceil 16.5823... \\rceil = 17 $$\n由于组织、FOV和重叠是对称的，垂直方向的区块数也是 $n_y = 17$。总区块数 $N$ 为：\n$$ N = n_x \\times n_y = 17 \\times 17 = 289 $$\n\n最后，我们计算总成像时间 $T_{\\text{total}}$，它是总采集时间 ($T_{\\text{capture}}$)、载物台总移动时间 ($T_{\\text{travel}}$) 和总换行开销 ($T_{\\text{rev}}$) 的总和。\n$$ T_{\\text{total}} = T_{\\text{capture}} + T_{\\text{travel}} + T_{\\text{rev}} $$\n\n采集单个区块所需的时间 $t_{\\text{tile}}$ 为：\n$$ t_{\\text{tile}} = c(t_{\\exp} + t_{\\mathrm{read}}) + t_{\\mathrm{focus}} + t_{\\mathrm{stab}} $$\n$$ t_{\\text{tile}} = 4(0.200\\,\\mathrm{s} + 0.020\\,\\mathrm{s}) + 0.015\\,\\mathrm{s} + 0.005\\,\\mathrm{s} = 4(0.220\\,\\mathrm{s}) + 0.020\\,\\mathrm{s} = 0.880\\,\\mathrm{s} + 0.020\\,\\mathrm{s} = 0.900\\,\\mathrm{s} $$\n所有 $N$ 个区块的总采集时间为：\n$$ T_{\\text{capture}} = N \\times t_{\\text{tile}} = 289 \\times 0.900\\,\\mathrm{s} = 260.1\\,\\mathrm{s} $$\n\n对于蛇形扫描路径，载物台总行程长度 $L_{\\text{travel}}$ 是所有水平和垂直移动的总和：\n$$ L_{\\text{travel}} = n_y(n_x - 1)p_x + (n_y - 1)p_y $$\n$$ L_{\\text{travel}} = 17(17 - 1)(0.59904\\,\\mathrm{mm}) + (17-1)(0.59904\\,\\mathrm{mm}) = (17 \\times 16 + 16) \\times 0.59904\\,\\mathrm{mm} $$\n$$ L_{\\text{travel}} = 288 \\times 0.59904\\,\\mathrm{mm} = 172.52352\\,\\mathrm{mm} $$\n在载物台速度 $v = 40\\,\\mathrm{mm}\\,\\mathrm{s}^{-1}$ 的情况下，总移动时间为：\n$$ T_{\\text{travel}} = \\frac{L_{\\text{travel}}}{v} = \\frac{172.52352\\,\\mathrm{mm}}{40\\,\\mathrm{mm}\\,\\mathrm{s}^{-1}} = 4.313088\\,\\mathrm{s} $$\n\n总换行开销涉及 $(n_y - 1)$ 次换行，每次产生的时间损失为 $t_{\\mathrm{rev}} = 0.010\\,\\mathrm{s}$：\n$$ T_{\\text{rev}} = (n_y - 1)t_{\\mathrm{rev}} = (17 - 1) \\times 0.010\\,\\mathrm{s} = 16 \\times 0.010\\,\\mathrm{s} = 0.16\\,\\mathrm{s} $$\n\n以秒为单位的总成像时间为：\n$$ T_{\\text{total}} = 260.1\\,\\mathrm{s} + 4.313088\\,\\mathrm{s} + 0.16\\,\\mathrm{s} = 264.573088\\,\\mathrm{s} $$\n\n问题要求最终答案以小时为单位，并四舍五入到四位有效数字。\n$$ T_{\\text{total, hours}} = \\frac{264.573088\\,\\mathrm{s}}{3600\\,\\mathrm{s}/\\text{hour}} \\approx 0.07349252...\\,\\text{hours} $$\n四舍五入到四位有效数字得到 $0.07349$ 小时。\n\n最终的两个量是总区块数 $N=289$ 和以小时为单位的总成像时间 $0.07349$。",
            "answer": "$$ \\boxed{\\begin{pmatrix} 289  0.07349 \\end{pmatrix}} $$"
        },
        {
            "introduction": "从空间转录组学数据中提取生物学意义的核心挑战之一是“反卷积”——即从每个捕获点的混合信号中推断出不同细胞类型的相对丰度。本练习将引导你从数学最优化的角度来构建此问题，将其表述为一个非负最小二乘问题，并推导其最优解所必须满足的KKT条件。更进一步，我们引入空间正则化项，利用图拉普拉斯算子来确保相邻捕获点的细胞组分预测是平滑且符合生物学直觉的 。",
            "id": "5163986",
            "problem": "在空间转录组学解卷积的背景下，一个点水平的观测基因表达向量 $y_{s} \\in \\mathbb{R}^{m}$ 被建模为 $k$ 个参考表达特征（收集在矩阵 $G \\in \\mathbb{R}^{m \\times k}$ 中）与非负细胞类型比例 $p_{s} \\in \\mathbb{R}^{k}$ 的线性组合，因此有 $y_{s} \\approx G p_{s}$。忽略测量噪声相关性并假设最小二乘保真度，每个点的标准估计量通过求解一个非负最小二乘问题得到。空间背景表明，相邻点的细胞类型组成应该相似；这可以通过由点邻接图的未归一化图拉普拉斯算子引入的二次惩罚项来捕捉。\n\n从最小二乘目标函数是其参数的凸二次函数，以及 Karush–Kuhn–Tucker (KKT) 条件刻画了带不等式约束的凸问题的最优性这两个基本事实出发，按以下步骤进行。\n\n- 首先，对于单个点 $s$，构建非负最小二乘问题\n$$\n\\min_{p_{s} \\in \\mathbb{R}^{k}} \\ \\frac{1}{2} \\| y_{s} - G p_{s} \\|_{2}^{2} \\quad \\text{subject to} \\quad p_{s} \\succeq 0,\n$$\n的拉格朗日函数，并根据与非负约束相关的主变量 $p_{s}$ 和对偶变量 $\\mu_{s} \\in \\mathbb{R}^{k}$ 推导 KKT 条件。\n\n- 接下来，考虑由 $s \\in \\{1,\\dots,n\\}$ 索引的 $n$ 个点，其无向加权邻接图的权重为 $w_{st}=w_{ts} \\ge 0$，未归一化的图拉普拉斯算子 $L \\in \\mathbb{R}^{n \\times n}$ 定义为 $L_{ss} = \\sum_{t \\ne s} w_{st}$ 以及当 $s \\ne t$ 时 $L_{st} = -w_{st}$。论证当目标函数增加空间平滑正则化项\n$$\n\\frac{\\lambda}{2} \\sum_{(s,t)} w_{st} \\| p_{s} - p_{t} \\|_{2}^{2},\n$$\n（其中 $\\lambda \\ge 0$）时，平稳性条件是如何被修改的。你可以使用图拉普拉斯算子来表示耦合的平稳性条件。\n\n- 最后，特化为一个双点、双细胞类型的玩具模型，该模型既能捕捉空间平滑性，又保持了解析上的可处理性。令 $k=2, n=2$，令 $G = I_{2}$（$2 \\times 2$ 单位矩阵），令点 $A$ 和 $B$ 之间唯一的非零边权重为 $w_{AB}=1$，并施加每个点的单纯形约束 $1^{\\top} p_{s} = 1$ 和 $p_{s} \\succeq 0$，使得 $p_{s}$ 是一个细胞类型分数的向量。取 $y_{A} = \\begin{pmatrix} a \\\\ 1-a \\end{pmatrix}$ 和 $y_{B} = \\begin{pmatrix} b \\\\ 1-b \\end{pmatrix}$，其中 $a \\in (0,1)$ 和 $b \\in (0,1)$。在非负约束在所有 $\\lambda \\ge 0$ 的最优点处都不活跃的假设下（当 $a \\in (0,1)$ 和 $b \\in (0,1)$ 时该假设成立），将问题简化为两个标量变量 $x = p_{A,1}$ 和 $z = p_{B,1}$，并最小化由此产生的二次目标函数。推导最优 $x^{\\star}$ 作为 $a, b, \\lambda$ 的函数的精确闭式解析表达式。将此表达式作为你的最终答案。不要四舍五入；提供一个闭式表达式。",
            "solution": "该问题是有效的，因为它在计算生物学和优化理论方面有科学依据，数学上是适定的、客观的且自洽的。所提供的数据和假设是一致且充分的，足以推导出一个唯一的、有意义的解。\n\n该解答按问题陈述的要求分为三部分。\n\n**第 1 部分：单点非负最小二乘的 KKT 条件**\n\n对于单个点 $s$ 的问题是一个非负最小二乘 (NNLS) 问题，这是一个凸优化问题。目标函数是 $\\mathcal{J}(p_s) = \\frac{1}{2} \\| y_s - G p_s \\|_2^2$，约束条件是 $p_s \\succeq 0$。这对应于 $j=1, \\dots, k$ 的 $k$ 个独立约束 $p_{s,j} \\ge 0$。我们可以将这些约束写成标准形式 $g_j(p_s) \\le 0$，即 $-p_{s,j} \\le 0$。\n\n拉格朗日函数 $\\mathcal{L}$ 是通过将约束条件乘以拉格朗日乘子（也称为对偶变量）后加到目标函数上而构成的。设 $\\mu_s \\in \\mathbb{R}^k$ 是对应于 $p_s$ 非负约束的拉格朗日乘子向量。拉格朗日函数为：\n$$\n\\mathcal{L}(p_s, \\mu_s) = \\mathcal{J}(p_s) + \\sum_{j=1}^{k} \\mu_{s,j} (-p_{s,j}) = \\frac{1}{2} \\| y_s - G p_s \\|_2^2 - \\mu_s^\\top p_s\n$$\n对于带不等式约束的凸问题，Karush-Kuhn-Tucker (KKT) 条件为最优性提供了充要条件。它们是：\n\n1.  **平稳性**：拉格朗日函数相对于主变量 $p_s$ 的梯度必须为零。\n    首先，我们计算目标函数 $\\mathcal{J}(p_s)$ 的梯度：\n    $$\n    \\mathcal{J}(p_s) = \\frac{1}{2} (y_s - G p_s)^\\top (y_s - G p_s) = \\frac{1}{2} (y_s^\\top y_s - 2 y_s^\\top G p_s + p_s^\\top G^\\top G p_s)\n    $$\n    相对于 $p_s$ 的梯度是：\n    $$\n    \\nabla_{p_s} \\mathcal{J}(p_s) = \\frac{1}{2} (-2 G^\\top y_s + 2 G^\\top G p_s) = G^\\top G p_s - G^\\top y_s\n    $$\n    完整拉格朗日函数的梯度是：\n    $$\n    \\nabla_{p_s} \\mathcal{L}(p_s, \\mu_s) = (G^\\top G p_s - G^\\top y_s) - \\mu_s\n    $$\n    将其设为零，得到平稳性条件：\n    $$\n    G^\\top G p_s - G^\\top y_s - \\mu_s = 0\n    $$\n\n2.  **主可行性**：主变量必须满足原始约束。\n    $$\n    p_s \\succeq 0\n    $$\n\n3.  **对偶可行性**：对于形如 $g(x) \\le 0$ 的不等式约束，其拉格朗日乘子必须为非负。\n    $$\n    \\mu_s \\succeq 0\n    $$\n\n4.  **互补松弛性**：每个拉格朗日乘子与其对应约束的乘积必须为零。\n    $$\n    \\mu_{s,j} p_{s,j} = 0 \\quad \\text{for all} \\quad j = 1, \\dots, k\n    $$\n    用向量形式，这可以使用逐元素（哈达玛）积写为 $\\mu_s \\odot p_s = 0$。\n\n总结来说，单点 NNLS 问题的 KKT 条件是：\n-   $G^\\top G p_s - G^\\top y_s - \\mu_s = 0$\n-   $p_s \\succeq 0$\n-   $\\mu_s \\succeq 0$\n-   $\\mu_s \\odot p_s = 0$\n\n**第 2 部分：带空间正则化的修正平稳性条件**\n\n对于一个包含 $n$ 个点的系统，目标函数通过一个空间正则化项进行增广。总目标函数为：\n$$\nJ(p_1, \\dots, p_n) = \\sum_{s=1}^n \\frac{1}{2} \\| y_s - G p_s \\|_2^2 + \\frac{\\lambda}{2} \\sum_{(s,t)} w_{st} \\| p_s - p_t \\|_2^2\n$$\n第一部分是各个最小二乘误差之和。第二部分是空间正则化项，它惩罚相邻点 $s$ 和 $t$ 之间细胞类型比例 $p_s$ 和 $p_t$ 的差异，并由 $w_{st}$ 加权。\n\n为了找到修正的平稳性条件，我们需要计算总目标函数相对于单个比例向量 $p_s$ 的梯度。完整问题的拉格朗日函数是 $\\mathcal{L} = J(p_1, \\dots, p_n) - \\sum_{s=1}^n \\mu_s^\\top p_s$。每个点 $s$ 的平稳性条件是 $\\nabla_{p_s} \\mathcal{L} = 0$。\n\n数据拟合项 $\\sum_{i=1}^n \\frac{1}{2} \\| y_i - G p_i \\|_2^2$ 相对于 $p_s$ 的梯度就是 $G^\\top G p_s - G^\\top y_s$，这已在第 1 部分推导过。\n\n现在，考虑正则化项 $R = \\frac{\\lambda}{2} \\sum_{(u,v)} w_{uv} \\| p_u - p_v \\|_2^2$。求和是针对唯一的无向边 $(u,v)$。这可以重写为对所有点对 $(u,v)$ 的求和，并带有一个因子 $1/2$：$R = \\frac{\\lambda}{4} \\sum_{u=1}^n \\sum_{v=1}^n w_{uv} \\| p_u - p_v \\|_2^2$，其中我们定义 $w_{uu}=0$。相对于 $p_s$ 的梯度是：\n$$\n\\nabla_{p_s} R = \\frac{\\lambda}{4} \\left( \\sum_{v \\ne s} w_{sv} \\nabla_{p_s} \\| p_s - p_v \\|_2^2 + \\sum_{u \\ne s} w_{us} \\nabla_{p_s} \\| p_u - p_s \\|_2^2 \\right)\n$$\n使用 $\\nabla_x \\|x-c\\|_2^2 = 2(x-c)$ 以及对称性 $w_{us}=w_{su}$，我们得到：\n$$\n\\nabla_{p_s} R = \\frac{\\lambda}{4} \\left( \\sum_{t \\ne s} w_{st} 2(p_s - p_t) + \\sum_{t \\ne s} w_{st} 2(p_s - p_t) \\right) = \\lambda \\sum_{t \\ne s} w_{st} (p_s - p_t)\n$$\n这个表达式可以与图拉普拉斯算子 $L$ 联系起来。\n$$\n\\nabla_{p_s} R = \\lambda \\left( \\left(\\sum_{t \\ne s} w_{st}\\right) p_s - \\sum_{t \\ne s} w_{st} p_t \\right)\n$$\n使用未归一化的图拉普拉斯算子的定义，$L_{ss} = \\sum_{t \\ne s} w_{st}$ 以及当 $s \\ne t$ 时 $L_{st} = -w_{st}$：\n$$\n\\nabla_{p_s} R = \\lambda \\left( L_{ss} p_s + \\sum_{t \\ne s} L_{st} p_t \\right) = \\lambda \\sum_{t=1}^n L_{st} p_t\n$$\n这是由一个包含 $L$ 的块矩阵与所有 $p_t$ 的堆叠向量相乘得到的乘积的第 $s$ 个块行。\n\n通过设置 $\\nabla_{p_s} \\mathcal{L} = 0$ 可以得到每个点 $s$ 的平稳性条件：\n$$\nG^\\top G p_s - G^\\top y_s + \\lambda \\sum_{t=1}^n L_{st} p_t - \\mu_s = 0\n$$\n与单点情况相比，点 $s$ 的平稳性条件通过增加项 $\\lambda \\sum_{t=1}^n L_{st} p_t$ 被修正。该项将 $p_s$ 的解与其在图中的邻居的解耦合起来，从而强制实现空间平滑性。整个系统由 $n$ 个这样的向量方程组成，必须同时求解。\n\n**第 3 部分：双点、双细胞类型玩具模型**\n\n我们给定一个包含 $n=2$ 个点 ($A, B$) 和 $k=2$ 种细胞类型的简化模型。\n-   $G = I_2$，$2 \\times 2$ 单位矩阵。\n-   $y_A = \\begin{pmatrix} a \\\\ 1-a \\end{pmatrix}$，$y_B = \\begin{pmatrix} b \\\\ 1-b \\end{pmatrix}$，其中 $a,b \\in (0,1)$。\n-   $w_{AB}=1$，所以图拉普拉斯算子是 $L = \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$。\n-   约束条件：对于 $s \\in \\{A, B\\}$ 有 $p_s \\succeq 0$ 和 $1^\\top p_s = 1$。\n-   假设：非负约束 $p_s \\succeq 0$ 是不活跃的。\n\n和为一约束意味着我们可以对比例向量进行参数化。设 $x = p_{A,1}$ 和 $z = p_{B,1}$。那么 $p_{A,2} = 1-x$ 和 $p_{B,2} = 1-z$。所以，$p_A = \\begin{pmatrix} x \\\\ 1-x \\end{pmatrix}$ 和 $p_B = \\begin{pmatrix} z \\\\ 1-z \\end{pmatrix}$。非负约束不活跃的假设意味着我们可以在优化中忽略这些约束（并在事后验证解满足它们）。单纯形约束变为箱式约束 $x \\in [0,1]$ 和 $z \\in [0,1]$。\n\n总目标函数是 $J(p_A, p_B) = \\frac{1}{2} \\| y_A - p_A \\|_2^2 + \\frac{1}{2} \\| y_B - p_B \\|_2^2 + \\frac{\\lambda}{2} \\| p_A - p_B \\|_2^2$，因为 $G=I_2$ 且 $w_{AB}=1$。\n\n让我们用 $x$ 和 $z$ 来表示 $J$ 中的各项：\n-   $\\| y_A - p_A \\|_2^2 = \\left\\| \\begin{pmatrix} a-x \\\\ (1-a)-(1-x) \\end{pmatrix} \\right\\|_2^2 = (a-x)^2 + (x-a)^2 = 2(a-x)^2$。\n-   $\\| y_B - p_B \\|_2^2 = \\left\\| \\begin{pmatrix} b-z \\\\ (1-b)-(1-z) \\end{pmatrix} \\right\\|_2^2 = (b-z)^2 + (z-b)^2 = 2(b-z)^2$。\n-   $\\| p_A - p_B \\|_2^2 = \\left\\| \\begin{pmatrix} x-z \\\\ (1-x)-(1-z) \\end{pmatrix} \\right\\|_2^2 = (x-z)^2 + (z-x)^2 = 2(x-z)^2$。\n\n将这些代入目标函数：\n$$\nJ(x, z) = \\frac{1}{2} \\left[ 2(a-x)^2 + 2(b-z)^2 + \\lambda \\cdot 2(x-z)^2 \\right] = (a-x)^2 + (b-z)^2 + \\lambda(x-z)^2\n$$\n为了找到最优的 $(x^\\star, z^\\star)$，我们通过将其关于 $x$ 和 $z$ 的偏导数设为零来最小化这个无约束二次函数。\n$$\n\\frac{\\partial J}{\\partial x} = -2(a-x) + 2\\lambda(x-z) = 0 \\implies -a+x+\\lambda x - \\lambda z = 0 \\implies (1+\\lambda)x - \\lambda z = a\n$$\n$$\n\\frac{\\partial J}{\\partial z} = -2(b-z) - 2\\lambda(x-z) = 0 \\implies -b+z-\\lambda x + \\lambda z = 0 \\implies -\\lambda x + (1+\\lambda)z = b\n$$\n这给出了一个关于 $x$ 和 $z$ 的二元线性方程组：\n$$\n\\begin{pmatrix} 1+\\lambda  -\\lambda \\\\ -\\lambda  1+\\lambda \\end{pmatrix} \\begin{pmatrix} x \\\\ z \\end{pmatrix} = \\begin{pmatrix} a \\\\ b \\end{pmatrix}\n$$\n我们需要解出 $x$。我们可以使用克莱姆法则。系数矩阵的行列式是：\n$$\n\\Delta = (1+\\lambda)^2 - (-\\lambda)^2 = 1 + 2\\lambda + \\lambda^2 - \\lambda^2 = 1+2\\lambda\n$$\n$x$ 的分子的行列式是：\n$$\n\\Delta_x = \\det \\begin{pmatrix} a  -\\lambda \\\\ b  1+\\lambda \\end{pmatrix} = a(1+\\lambda) - b(-\\lambda) = a + a\\lambda + b\\lambda = a + (a+b)\\lambda\n$$\n$x^{\\star}$ 的解是：\n$$\nx^{\\star} = \\frac{\\Delta_x}{\\Delta} = \\frac{a + (a+b)\\lambda}{1+2\\lambda}\n$$\n作为检验，由于 $a,b \\in (0,1)$ 且 $\\lambda \\ge 0$，我们有 $x^\\star > 0$。此外，$x^\\star  1$ 因为 $a + (a+b)\\lambda  1+2\\lambda \\iff a-1 + (a+b-2)\\lambda  0$，这是成立的，因为 $a-1  0$ 且 $a+b-2  0$。因此，解位于 $(0,1)$ 区间内，非负约束确实是不活跃的。",
            "answer": "$$\\boxed{\\frac{a + (a+b)\\lambda}{1+2\\lambda}}$$"
        }
    ]
}