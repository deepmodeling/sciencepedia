{
    "hands_on_practices": [
        {
            "introduction": "在分析任何全基因组亚硫酸氢盐测序（WGBS）数据时，首要步骤是严格的质量控制。本练习将指导您计算三个关键的质量指标：亚硫酸氢盐转化效率、重复率和覆盖均一度。这些指标共同构成了对实验技术成功与否的全面评估，是确保下游生物学结论可靠性的基石。 ",
            "id": "5172321",
            "problem": "全基因组亚硫酸氢盐测序 (WGBS) 通过亚硫酸氢钠处理，将未甲基化的胞嘧啶转化为尿嘧啶，而尿嘧啶在聚合酶链式反应 (PCR) 后被读取为胸腺嘧啶，从而推断胞嘧啶的甲基化状态。在用于分子和免疫诊断的高质量WGBS数据集中，评估三个核心质量指标：亚硫酸氢盐转化效率、重复率和覆盖度均一性。请从第一性原理出发——即未甲基化的胞嘧啶预计会以高概率转化为胸腺嘧啶，PCR会引入重复分子从而导致深度偏倚，以及均一的覆盖度能确保各基因座上稳定的统计功效——推导每个指标，然后根据以下数据集计算它们。利用这些结果，结合具有科学依据的质量阈值，构建一个无量纲的综合质量指数。\n\n您对一个人类样本进行了测序，其中掺入（spike-in）了一个已知的未甲基化对照基因组（例如，lambda噬菌体）。为了计算转化效率，您汇总了内参中非胞嘧啶-磷酸-鸟嘌呤 (non-CpG) 位点上胞嘧啶的观测数据，在这些位点上甲基化极为罕见，处理后任何观测到的胞嘧啶都归因于不完全转化。在内参中观测到的计数如下：\n- 符合条件的总胞嘧啶观测数：$N_{\\text{eligible}} = 3{,}200{,}000$，\n- 观测为胸腺嘧啶的碱基数：$N_{T} = 3{,}190{,}400$，\n- 观测为胞嘧啶的碱基数：$N_{C} = 9{,}600$。\n\n为了计算重复率，您将 $R_{\\text{total}} = 75{,}000{,}000$ 个双端读长（read pairs）比对到人类参考基因组，并根据相同的起始和终止坐标将 $R_{\\text{dup}} = 9{,}000{,}000$ 个双端读长标记为PCR重复（假设未使用独特分子标识符 (UMIs)）。\n\n为了计算覆盖度均一性，您将可比对的常染色体基因组划分为 $N = 1000$ 个大小相等的非重叠区间，并计算每个区间的覆盖深度 $\\{d_{i}\\}_{i=1}^{N}$ （单位为 $X$，即覆盖倍数）。样本均值为 $\\bar{d} = 25$，离均差平方和为\n$$\n\\text{SSE} = \\sum_{i=1}^{N} (d_{i} - \\bar{d})^{2} = 15{,}984.\n$$\n\n首先，从第一性原理出发，推导您将用来计算以下指标的表达式：\n- 亚硫酸氢盐转化效率 $E$，\n- 重复率 $D$，\n- 由变异系数 $\\mathrm{CV}$ 量化的覆盖度均一性。\n\n然后，为上述数据集计算它们的值。使用以下针对高质量WGBS数据集的具有科学依据的阈值，\n- 亚硫酸氢盐转化效率阈值 $T_{E} = 0.995$，\n- 重复率阈值 $T_{D} = 0.20$，\n- 覆盖度均一性阈值 $T_{U} = 0.30$，\n简要解释在分子和免疫诊断的背景下，为什么每个阈值都是合理的。最后，定义无量纲的综合质量指数\n$$\nQ \\equiv \\left( \\min\\!\\left(1, \\frac{E}{T_{E}}\\right) \\cdot \\max\\!\\left(0, 1 - \\frac{D}{T_{D}}\\right) \\cdot \\max\\!\\left(0, 1 - \\frac{\\mathrm{CV}}{T_{U}}\\right) \\right)^{\\frac{1}{3}},\n$$\n并为该数据集计算 $Q$。将您最终的 $Q$ 值四舍五入到四位有效数字。将最终答案表示为一个无单位的无量纲数。",
            "solution": "问题陈述已经过验证，被认为是科学上合理、定义明确且客观的。它呈现了一个基于全基因组亚硫酸氢盐测序 (WGBS) 实验真实数据的标准生物信息学质量控制任务。我们将继续提供完整解答。\n\n根据要求，解答分为四个部分：\n1.  从第一性原理推导质量指标。\n2.  使用所提供的数据集计算这些指标。\n3.  对指定质量阈值的合理解释。\n4.  计算综合质量指数 $Q$。\n\n**1. 从第一性原理推导质量指标**\n\n**亚硫酸氢盐转化效率 ($E$)**\n亚硫酸氢盐测序的基本原理是未甲基化的胞嘧啶 ($C$) 会被化学转化为尿嘧啶 ($U$)，而甲基化的胞嘧啶 ($5\\text{mC}$) 保持不变。经过PCR扩增后，尿嘧啶被读取为胸腺嘧啶 ($T$)。这种转化的效率是一个关键参数，因为未甲基化胞嘧啶的不完全转化会导致它们被错误地识别为甲基化的。\n\n为了测量这一效率，在亚硫酸氢盐处理前会“掺入”（spiked-in）一个未甲基化的对照基因组（例如，lambda噬菌体）。在这个对照中，所有的胞嘧啶都是未甲基化的，因此原则上都应该转化为尿嘧啶，并随后被读取为胸腺嘧啶。因此，转化效率 $E$ 是对照中所有符合条件的胞嘧啶中被成功读取为胸腺嘧啶的比例。\n\n设 $N_{\\text{eligible}}$ 为在未甲基化对照中观测到的总胞嘧啶位点数。设 $N_{T}$ 为这些位点被读取为胸腺嘧啶的次数（成功转化），$N_{C}$ 为它们被读取为胞嘧啶的次数（转化失败）。根据定义，$N_{\\text{eligible}} = N_{T} + N_{C}$。转化效率 $E$ 推导为成功结果数与总试验次数的比率：\n$$\nE = \\frac{\\text{成功转化的胞嘧啶数}}{\\text{符合条件的总胞嘧啶数}} = \\frac{N_{T}}{N_{\\text{eligible}}}\n$$\n\n**重复率 ($D$)**\n在测序文库的制备过程中，初始的DNA片段会通过聚合酶链式反应 (PCR) 进行扩增，以产生足够用于测序仪的材料。这个过程可能引入偏倚，某些片段会被优先扩增，导致由单个原始分子产生多个相同的拷贝。这些被称为PCR重复。高重复率会降低文库的分子复杂度，导致测序能力的浪费和有效覆盖度的降低。\n\n重复率 $D$ 是被识别为重复的总测序读长所占的比例。设 $R_{\\text{total}}$ 为比对到参考基因组的双端读长总数，而 $R_{\\text{dup}}$ 是这些读长中被标记为重复的子集（通常基于具有相同的作图坐标）。那么重复率为：\n$$\nD = \\frac{\\text{重复的双端读长数}}{\\text{比对上的双端读长总数}} = \\frac{R_{\\text{dup}}}{R_{\\text{total}}}\n$$\n\n**覆盖度均一性 (变异系数, $\\mathrm{CV}$)**\n理想的测序能在整个基因组范围内提供均一的覆盖深度，确保所有区域都有足够的数据进行稳健的统计分析。实际上，由于文库制备（例如，GC含量偏好）和测序过程中的偏倚，覆盖度从来都不是完全均一的。变异系数 ($\\mathrm{CV}$) 是衡量概率分布或频率分布离散程度的标准化度量，在此用于量化覆盖度的不均一性。它被定义为标准差与均值的比率。\n\n假设基因组被划分为 $N$ 个区间，$\\{d_{i}\\}_{i=1}^{N}$ 是每个区间的平均覆盖深度。样本均值覆盖度为 $\\bar{d} = \\frac{1}{N} \\sum_{i=1}^{N} d_{i}$。样本方差 $s^2$ 是对总体方差的无偏估计，由离均差平方和 ($\\text{SSE} = \\sum_{i=1}^{N} (d_{i} - \\bar{d})^{2}$) 计算得出：\n$$\ns^2 = \\frac{1}{N-1} \\sum_{i=1}^{N} (d_{i} - \\bar{d})^{2} = \\frac{\\text{SSE}}{N-1}\n$$\n样本标准差为 $s = \\sqrt{s^2}$。变异系数则是样本标准差与样本均值的比率：\n$$\n\\mathrm{CV} = \\frac{s}{\\bar{d}} = \\frac{\\sqrt{\\frac{\\text{SSE}}{N-1}}}{\\bar{d}}\n$$\n较低的 $\\mathrm{CV}$ 表示较高的覆盖度均一性。\n\n**2. 指标值的计算**\n\n现在，我们使用提供的数据集计算 $E$、$D$ 和 $\\mathrm{CV}$ 的值。\n\n对于亚硫酸氢盐转化效率 $E$：\n$N_{\\text{eligible}} = 3{,}200{,}000$ 且 $N_{T} = 3{,}190{,}400$。\n$$\nE = \\frac{N_{T}}{N_{\\text{eligible}}} = \\frac{3{,}190{,}400}{3{,}200{,}000} = 0.997\n$$\n\n对于重复率 $D$：\n$R_{\\text{total}} = 75{,}000{,}000$ 且 $R_{\\text{dup}} = 9{,}000{,}000$。\n$$\nD = \\frac{R_{\\text{dup}}}{R_{\\text{total}}} = \\frac{9{,}000{,}000}{75{,}000{,}000} = \\frac{9}{75} = \\frac{3}{25} = 0.12\n$$\n\n对于覆盖度均一性 $\\mathrm{CV}$：\n$N = 1000$，$\\bar{d} = 25$，且 $\\text{SSE} = 15{,}984$。\n首先，我们计算样本标准差 $s$：\n$$\ns = \\sqrt{\\frac{\\text{SSE}}{N-1}} = \\sqrt{\\frac{15{,}984}{1000-1}} = \\sqrt{\\frac{15{,}984}{999}} = \\sqrt{16} = 4\n$$\n现在，我们计算变异系数 $\\mathrm{CV}$：\n$$\n\\mathrm{CV} = \\frac{s}{\\bar{d}} = \\frac{4}{25} = 0.16\n$$\n\n**3. 质量阈值的合理解释**\n\n问题为高质量WGBS数据集提供了具有科学依据的阈值。\n\n- **亚硫酸氢盐转化效率阈值 $T_{E} = 0.995$**：高转化率对准确性至关重要。任何未能转化的未甲基化胞嘧啶都会被错误地读取为胞嘧啶，从而为甲基化产生假阳性信号。在诊断学中，检测甲基化的微小变化或识别低甲基化区域至关重要，因此必须将背景噪音降至最低。$E \\ge 0.995$ 的阈值确保了由未转化引起的假甲基化信号低于 $0.5\\%$，为可靠的诊断调用提供了所需的高信噪比。\n\n- **重复率阈值 $T_{D} = 0.20$**：低重复率反映了高复杂度的文库。高重复率 ($D > 0.20$) 表明起始材料不足或PCR扩增过度，这两者都可能引入显著的偏倚。这会导致测序的独特分子数量减少，从而降低有效覆盖度并损害甲基化水平估计的定量准确性。对于诊断应用而言，通过将 $D$ 保持在 $20\\%$ 以下来维持文库复杂度，对于获得无偏倚和可重复的结果至关重要。\n\n- **覆盖度均一性阈值 $T_{U} = 0.30$**：该阈值与变异系数 ($\\mathrm{CV}$) 有关。低的 $\\mathrm{CV}$ 值表示整个基因组的覆盖度均一。高度不均一（例如，$\\mathrm{CV} > 0.30$）意味着某些基因组区域的测序严重不足，导致在这些区域进行甲基化判定的统计功效较低。对于全面的诊断分析，拥有覆盖所有相关基因组位点的可靠数据至关重要。为 $\\mathrm{CV}$ 设定一个均一性阈值，可确保此类“盲点”被最小化。\n\n**4. 综合质量指数 $Q$ 的计算**\n\n综合质量指数 $Q$ 定义为：\n$$\nQ \\equiv \\left( \\min\\!\\left(1, \\frac{E}{T_{E}}\\right) \\cdot \\max\\!\\left(0, 1 - \\frac{D}{T_{D}}\\right) \\cdot \\max\\!\\left(0, 1 - \\frac{\\mathrm{CV}}{T_{U}}\\right) \\right)^{\\frac{1}{3}}\n$$\n我们代入计算出的指标值和给定的阈值：\n$E = 0.997$，$T_{E} = 0.995$\n$D = 0.12$，$T_{D} = 0.20$\n$\\mathrm{CV} = 0.16$，$T_{U} = 0.30$\n\n我们分别评估乘积中的每一项：\n- **第1项**：$\\min\\left(1, \\frac{E}{T_{E}}\\right) = \\min\\left(1, \\frac{0.997}{0.995}\\right)$。由于 $0.997 > 0.995$，该比率大于1，因此该项的值为 $1$。\n- **第2项**：$\\max\\left(0, 1 - \\frac{D}{T_{D}}\\right) = \\max\\left(0, 1 - \\frac{0.12}{0.20}\\right) = \\max(0, 1 - 0.6) = \\max(0, 0.4) = 0.4 = \\frac{2}{5}$。\n- **第3项**：$\\max\\left(0, 1 - \\frac{\\mathrm{CV}}{T_{U}}\\right) = \\max\\left(0, 1 - \\frac{0.16}{0.30}\\right) = \\max\\left(0, 1 - \\frac{16}{30}\\right) = \\max\\left(0, 1 - \\frac{8}{15}\\right) = \\max\\left(0, \\frac{7}{15}\\right) = \\frac{7}{15}$。\n\n现在，我们将这些项组合起来计算 $Q$：\n$$\nQ = \\left( 1 \\cdot \\frac{2}{5} \\cdot \\frac{7}{15} \\right)^{\\frac{1}{3}} = \\left( \\frac{14}{75} \\right)^{\\frac{1}{3}}\n$$\n我们计算其数值并四舍五入到四位有效数字：\n$$\nQ \\approx (0.186666...)^{\\frac{1}{3}} \\approx 0.571533...\n$$\n四舍五入到四位有效数字，我们得到 $Q \\approx 0.5715$。\n该值代表了测序实验质量的综合得分，该得分通过预定义的标准进行归一化，并使用几何平均值进行组合。",
            "answer": "$$\n\\boxed{0.5715}\n$$"
        },
        {
            "introduction": "在量化数据质量后，下一步是校正已知的系统性偏差。本练习聚焦于其中一种偏差——不完全的亚硫酸氢盐转化，它会人为地抬高表观甲基化水平。通过本练习，您将从第一性原理出发，推导出一个数学校正公式，从而将原始的、带有偏差的观测值转化为对真实生物信号更准确的估计。 ",
            "id": "5172342",
            "problem": "全基因组亚硫酸氢盐测序 (WGBS) 利用亚硫酸氢盐化学将未甲基化的胞嘧啶脱氨，使其转化为尿嘧啶，在聚合酶链式反应 (PCR) 后被读取为胸腺嘧啶，而甲基化的胞嘧啶则受到保护，并保持为胞嘧啶。考虑一个单一的胞嘧啶位点，其真实甲基化分数记为 $p \\in [0,1]$。设未甲基化胞嘧啶的不完全转化率为 $q \\in [0,1)$，定义为未甲基化的胞嘧啶在整个过程中未能脱氨并保持为胞嘧啶的概率。假设不存在甲基化胞嘧啶的过度转化、测序错误或比对偏倚。您对覆盖该位点的 $n$ 个独立读段进行测序，并计算观测到的甲基化比例 $\\hat{p} = k/n$，其中 $k$ 是比对后在该位置报告为胞嘧啶的读段数。\n\n从亚硫酸氢盐转化的化学特异性和读段结果的伯努利模型出发，推导观测到的甲基化比例的期望值作为 $p$ 和 $q$ 的函数，解释 $q$ 如何相对于 $p$ 夸大了表观甲基化，并通过反转该关系，构建一个仅用 $\\hat{p}$ 和 $q$ 表示的 $p$ 的一致估计量 $\\tilde{p}$。您的推导应从第一性原理出发，清楚地论证每个概率步骤。\n\n仅报告您最终的估计量 $\\tilde{p}$，以 $\\hat{p}$ 和 $q$ 的闭合形式函数表示。无需进行数值评估。不包括单位。最终答案必须是单一的解析表达式。",
            "solution": "该问题要求根据全基因组亚硫酸氢盐测序 (WGBS) 的观测数据，为单个胞嘧啶位点的真实甲基化分数 $p$ 推导一个一致估计量。该估计量必须考虑由转化率 $q$ 量化的未甲基化胞嘧啶的不完全转化。\n\n让我们从第一性原理开始对该过程进行形式化。我们关心的是在单个测序读段中观测到胞嘧啶（'C'）的事件。我们将此事件记为 $C_{obs}$。DNA分子上胞嘧啶的真实状态可以是甲基化的（我们记为事件 $M$），也可以是未甲基化的（记为 $U$）。\n\n根据问题陈述，真实甲基化分数为 $p$。这是该位点胞嘧啶被甲基化的先验概率。因此，我们有：\n$$P(M) = p$$\n$$P(U) = 1 - P(M) = 1 - p$$\n\n问题给出了基于真实底层状态观测到 'C' 的条件概率，其中包含了亚硫酸氢盐测序化学过程中的人为效应。\n1.  甲基化的胞嘧啶受保护不发生脱氨，并且总是被读取为 'C'。问题明确指出没有过度转化和测序错误。因此，在真实状态为甲基化的情况下观测到 'C' 的概率为 $1$：\n    $$P(C_{obs} | M) = 1$$\n2.  未甲基化的胞嘧啶应该被转化为尿嘧啶（并被读取为胸腺嘧啶）。然而，转化是不完全的，其概率为 $q$。不完全转化意味着未甲基化的胞嘧啶没有脱氨，并保持为胞嘧啶，随后被读取为 'C'。因此，在真实状态为未甲基化的情况下观测到 'C' 的概率等于不完全转化率 $q$：\n    $$P(C_{obs} | U) = q$$\n\n使用全概率定律，我们可以计算在任何单个读段中观测到 'C' 的边际概率，我们将其记为 $\\theta$。该概率是在所有可能真实状态上观测到 'C' 的概率之和，并由这些状态的概率加权：\n$$\\theta = P(C_{obs}) = P(C_{obs} | M) P(M) + P(C_{obs} | U) P(U)$$\n代入上面定义的值：\n$$\\theta = (1)(p) + (q)(1-p)$$\n$$\\theta = p + q - qp = p(1-q) + q$$\n\n这个 $\\theta$ 的表达式代表了单次伯努利试验（对应于一个读段）中成功（观测到 'C'）的真实概率。问题陈述我们有 $n$ 个独立读段。因此，'C' 读段的数量 $k$ 是一个遵循二项分布的随机变量，$k \\sim \\text{Binomial}(n, \\theta)$。\n\n观测到的甲基化比例 $\\hat{p}$ 定义为 $\\hat{p} = k/n$。我们需要推导其期望值。利用期望的性质以及二项随机变量的期望值为 $E[k] = n\\theta$ 这一事实：\n$$E[\\hat{p}] = E\\left[\\frac{k}{n}\\right] = \\frac{1}{n} E[k] = \\frac{1}{n} (n\\theta) = \\theta$$\n因此，观测到的甲基化比例的期望值为：\n$$E[\\hat{p}] = p(1-q) + q$$\n\n我们可以解释这个结果来理解不完全转化率 $q$ 如何夸大表观甲基化水平。期望观测值 $E[\\hat{p}]$ 可以重写为 $p + q(1-p)$。真实甲基化水平是 $p$。$q(1-p)$ 项表示一个加到真实值上的正偏倚或夸大。这种偏倚源于那些真实未甲基化（比例为 $1-p$）但由于转化失败（以概率 $q$ 发生）而被错误地读取为 'C' 的胞嘧啶。只有当 $q=0$（完全转化）或 $p=1$（该位点完全甲基化，因此没有未甲基化的胞嘧啶可被误读）时，这种夸大才为零。\n\n为了构建 $p$ 的一个一致估计量，我们可以采用矩估计法。该方法包括将样本矩与相应的总体矩相等，然后求解目标参数。在这里，一阶样本矩是观测比例 $\\hat{p}$，它是总体均值 $E[\\hat{p}]$ 的一个无偏估计量。根据大数定律，$\\hat{p}$ 是 $E[\\hat{p}]$ 的一个一致估计量。我们将观测到的统计量 $\\hat{p}$ 与其期望值相等：\n$$\\hat{p} = E[\\hat{p}] = p(1-q) + q$$\n\n现在我们对该方程进行代数求解以得到 $p$，我们将其记为 $\\tilde{p}$。\n$$\\hat{p} - q = \\tilde{p}(1-q)$$\n鉴于 $q \\in [0, 1)$，项 ($1-q$) 是非零的，所以我们可以用它来除：\n$$\\tilde{p} = \\frac{\\hat{p} - q}{1-q}$$\n\n该表达式为真实甲基化分数 $p$ 定义了一个一致估计量 $\\tilde{p}$。它通过考虑由不完全转化率 $q$ 引起的夸大来校正原始观测比例 $\\hat{p}$。其一致性源于 $\\hat{p}$ 的一致性和连续映射定理，因为 $\\tilde{p}$ 是 $\\hat{p}$ 的一个连续函数（对于固定的 $q \\neq 1$）。当 $n \\to \\infty$ 时，$\\hat{p} \\to E[\\hat{p}]$，因此 $\\tilde{p} \\to \\frac{E[\\hat{p}] - q}{1-q} = \\frac{(p(1-q)+q)-q}{1-q} = \\frac{p(1-q)}{1-q} = p$。\n得到的估计量 $\\tilde{p}$ 仅用可观测量 $\\hat{p}$ 和已知参数 $q$ 表示。",
            "answer": "$$\n\\boxed{\\frac{\\hat{p} - q}{1-q}}\n$$"
        },
        {
            "introduction": "分析流程的最终目标是利用高质量、经过校正的数据来回答生物学问题。本练习将引导您解决一个核心问题：如何识别不同生物群体（如疾病组与对照组）间的差异甲基化位点。这项高级练习引入了贝塔-二项分布模型，这是一个强大的统计工具，它能恰当地处理技术和生物学变异，从而对差异甲基化进行稳健的假设检验。 ",
            "id": "5172323",
            "problem": "一个研究团队正在分析单个胞嘧啶-磷酸-鸟嘌呤 (CpG) 位点的全基因组亚硫酸氢盐测序 (WGBS) 数据，以检测两个免疫学队列（一个疾病组和一个健康对照组）之间的差异甲基化。对于组 $g \\in \\{A,B\\}$ 中的每个生物学重复 $i$，该团队测量了该位点上甲基化的 reads 数量 $k_{g i}$ 和总覆盖度 $n_{g i}$。潜在的单 read 甲基化概率 $p_{g i}$ 通过假设其为随机变量 $p_{g i} \\sim \\mathrm{Beta}(\\alpha_{g}, \\beta_{g})$ 进行建模，以解释重复间的生物学过离散。其中 $\\alpha_{g} = \\phi \\pi_{g}$ 且 $\\beta_{g} = \\phi (1 - \\pi_{g})$，而 $\\phi > 0$ 是一个在组间共享的已知离散参数。在给定 $p_{g i}$ 的条件下，观测到的计数 $k_{g i}$ 服从二项分布 $k_{g i} \\mid p_{g i} \\sim \\mathrm{Binomial}(n_{g i}, p_{g i})$。参数 $\\pi_{g} \\in (0,1)$ 代表组水平的甲基化比例，并假设重复在组间和组内是独立的。\n\n从上述分层模型和 Beta 函数的定义 $B(a,b) = \\int_{0}^{1} t^{a-1} (1-t)^{b-1} \\, dt$（及其与 Gamma 函数 $\\Gamma(\\cdot)$ 的关系恒等式 $B(a,b) = \\frac{\\Gamma(a)\\Gamma(b)}{\\Gamma(a+b)}$）出发，推导在原假设 $H_{0} : \\pi_{A} = \\pi_{B} = \\pi$ 和备择假设 $H_{1} : \\pi_{A} \\neq \\pi_{B}$ 下观测计数的边际似然。然后，通过比较最大化的原假设和备择假设下的对数似然，构建似然比检验统计量 $T$。给出 $T$ 的闭式解析表达式，该表达式应使用观测计数 $\\{(k_{g i}, n_{g i})\\}$、已知的离散参数 $\\phi$ 以及在 $H_{0}$ 下的最大似然估计 $\\hat{\\pi}$ 和在 $H_{1}$ 下的最大似然估计 $(\\hat{\\pi}_{A}, \\hat{\\pi}_{B})$ 来表示。最后，在适用于该模型的标准正则性条件下，指明 $T$ 的渐近零分布。\n\n你的最终答案必须是检验统计量的单个闭式解析表达式及其渐近零分布的符号，使用 $\\mathrm{pmatrix}$ 环境一起呈现为单行矩阵。不需要进行数值计算，也不适用任何单位。",
            "solution": "用户希望使用贝塔-二项模型推导用于差异甲基化分析的似然比检验统计量。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n-   **组：** 两个队列，疾病组 $A$ 和健康对照组 $B$，由索引 $g \\in \\{A, B\\}$ 表示。\n-   **数据：** 对于组 $g$ 中的每个生物学重复 $i$，数据由一对 $(k_{gi}, n_{gi})$ 组成，其中 $k_{gi}$ 是甲基化的 reads 数量，$n_{gi}$ 是总覆盖度。设 $N_A$ 和 $N_B$ 分别为组 $A$ 和组 $B$ 中的重复数。\n-   **分层模型：**\n    1.  给定单 read 甲基化概率 $p_{gi}$，计数 $k_{gi}$ 的条件分布是二项分布：$k_{gi} \\mid p_{gi} \\sim \\mathrm{Binomial}(n_{gi}, p_{gi})$。\n    2.  组 $g$ 中重复的单 read 甲基化概率 $p_{gi}$ 是一个从 Beta 分布中抽取的随机变量，用以模拟生物学过离散：$p_{gi} \\sim \\mathrm{Beta}(\\alpha_g, \\beta_g)$。\n-   **参数化：** Beta 分布的参数由 $\\alpha_g = \\phi \\pi_g$ 和 $\\beta_g = \\phi(1-\\pi_g)$ 给出，其中：\n    -   $\\pi_g \\in (0,1)$ 是组 $g$ 的组水平平均甲基化比例。\n    -   $\\phi > 0$ 是一个在组间共享的已知离散参数。\n-   **假设：**\n    -   原假设 ($H_0$)：组水平的甲基化比例相等，即 $\\pi_A = \\pi_B = \\pi$。\n    -   备择假设 ($H_1$)：组水平的甲基化比例不相等，即 $\\pi_A \\neq \\pi_B$。\n-   **提供的恒等式：**\n    -   Beta 函数：$B(a,b) = \\int_{0}^{1} t^{a-1} (1-t)^{b-1} \\, dt$。\n    -   与 Gamma 函数的关系：$B(a,b) = \\frac{\\Gamma(a)\\Gamma(b)}{\\Gamma(a+b)}$。\n-   **假设：** 重复在组间和组内独立。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学依据：** 该问题描述了一个贝塔-二项模型，这是一个标准且非常合适的统计框架，用于分析具有过离散的计数数据，例如来自全基因组亚硫酸氢盐测序 (WGBS) 的 reads 计数。该模型在科学上是合理的，并在生物信息学中被广泛使用。\n-   **良态问题：** 这是一个良态问题。它要求推导似然比检验 (LRT) 统计量，这是统计推断中的一个标准程序。模型被完全指定，问题的结构旨在导出一个关于检验统计量形式的唯一解析结果。\n-   **客观性：** 问题以精确、形式化和客观的数学及统计术语陈述。\n\n**步骤 3：结论与行动**\n该问题被认为是有效的。这是一个标准但详细的统计建模和假设检验练习，与指定领域直接相关。我将继续进行推导。\n\n### 推导\n\n**1. 单个观测的边际似然**\n\n首先，我们推导在组 $g$ 的单个重复 $i$ 中，从总共 $n_{gi}$ 个 reads 中观测到 $k_{gi}$ 个计数的边际概率。这是通过将条件二项概率与先验 Beta 概率的乘积对 $p_{gi}$ 的所有可能值进行积分得到的。这就是贝塔-二项分布的概率质量函数 (PMF)。\n\n条件概率为：\n$$ P(k_{gi} | p_{gi}) = \\binom{n_{gi}}{k_{gi}} p_{gi}^{k_{gi}} (1-p_{gi})^{n_{gi}-k_{gi}} $$\n$p_{gi}$ 的先验概率密度为：\n$$ f(p_{gi} | \\alpha_g, \\beta_g) = \\frac{p_{gi}^{\\alpha_g-1} (1-p_{gi})^{\\beta_g-1}}{B(\\alpha_g, \\beta_g)} $$\n边际概率 $P(k_{gi})$ 是它们乘积的积分：\n$$ P(k_{gi}) = \\int_0^1 P(k_{gi} | p_{gi}) f(p_{gi} | \\alpha_g, \\beta_g) \\, dp_{gi} $$\n$$ P(k_{gi}) = \\int_0^1 \\binom{n_{gi}}{k_{gi}} p_{gi}^{k_{gi}} (1-p_{gi})^{n_{gi}-k_{gi}} \\frac{p_{gi}^{\\alpha_g-1} (1-p_{gi})^{\\beta_g-1}}{B(\\alpha_g, \\beta_g)} \\, dp_{gi} $$\n$$ P(k_{gi}) = \\frac{\\binom{n_{gi}}{k_{gi}}}{B(\\alpha_g, \\beta_g)} \\int_0^1 p_{gi}^{k_{gi}+\\alpha_g-1} (1-p_{gi})^{n_{gi}-k_{gi}+\\beta_g-1} \\, dp_{gi} $$\n根据定义，该积分为 Beta 函数 $B(k_{gi}+\\alpha_g, n_{gi}-k_{gi}+\\beta_g)$。\n$$ P(k_{gi}) = \\binom{n_{gi}}{k_{gi}} \\frac{B(k_{gi}+\\alpha_g, n_{gi}-k_{gi}+\\beta_g)}{B(\\alpha_g, \\beta_g)} $$\n代入 $\\alpha_g = \\phi\\pi_g$ 和 $\\beta_g = \\phi(1-\\pi_g)$：\n$$ P(k_{gi}; \\pi_g, \\phi) = \\binom{n_{gi}}{k_{gi}} \\frac{B(k_{gi}+\\phi\\pi_g, n_{gi}-k_{gi}+\\phi(1-\\pi_g))}{B(\\phi\\pi_g, \\phi(1-\\pi_g))} $$\n\n**2. 备择假设 ($H_1$) 下的对数似然**\n\n在 $H_1: \\pi_A \\neq \\pi_B$ 下，参数为 $(\\pi_A, \\pi_B)$。总似然 $L_1$ 是所有独立观测的边际概率的乘积。\n$$ L_1(\\pi_A, \\pi_B) = \\left( \\prod_{i=1}^{N_A} P(k_{Ai}; \\pi_A, \\phi) \\right) \\left( \\prod_{j=1}^{N_B} P(k_{Bj}; \\pi_B, \\phi) \\right) $$\n对数似然 $\\ell_1 = \\ln L_1$ 为：\n$$ \\ell_1(\\pi_A, \\pi_B) = \\sum_{i=1}^{N_A} \\ln P(k_{Ai}; \\pi_A, \\phi) + \\sum_{j=1}^{N_B} \\ln P(k_{Bj}; \\pi_B, \\phi) $$\n$$ \\ell_1(\\pi_A, \\pi_B) = \\sum_{g \\in \\{A,B\\}} \\sum_{i} \\left[ \\ln\\binom{n_{gi}}{k_{gi}} + \\ln B(k_{gi}+\\phi\\pi_g, n_{gi}-k_{gi}+\\phi(1-\\pi_g)) - \\ln B(\\phi\\pi_g, \\phi(1-\\pi_g)) \\right] $$\n项 $\\ln\\binom{n_{gi}}{k_{gi}}$ 不依赖于参数 $\\pi_A, \\pi_B$，并将在似然比中被抵消。令 $\\ell'_1$ 为对数似然中依赖于参数的部分：\n$$ \\ell'_1(\\pi_A, \\pi_B) = \\sum_{g \\in \\{A,B\\}} \\sum_{i} \\left[ \\ln B(k_{gi}+\\phi\\pi_g, n_{gi}-k_{gi}+\\phi(1-\\pi_g)) - \\ln B(\\phi\\pi_g, \\phi(1-\\pi_g)) \\right] $$\n$H_1$ 下的最大化对数似然是 $\\ell'_1(\\hat{\\pi}_A, \\hat{\\pi}_B)$，其中 $(\\hat{\\pi}_A, \\hat{\\pi}_B)$ 是最大似然估计 (MLE)。\n\n**3. 原假设 ($H_0$) 下的对数似然**\n\n在 $H_0: \\pi_A = \\pi_B = \\pi$ 下，只有一个参数 $\\pi$。对数似然 $\\ell_0(\\pi)$ 为：\n$$ \\ell_0(\\pi) = \\sum_{g \\in \\{A,B\\}} \\sum_{i} \\ln P(k_{gi}; \\pi, \\phi) $$\n$$ \\ell_0(\\pi) = \\sum_{g,i} \\left[ \\ln\\binom{n_{gi}}{k_{gi}} + \\ln B(k_{gi}+\\phi\\pi, n_{gi}-k_{gi}+\\phi(1-\\pi)) - \\ln B(\\phi\\pi, \\phi(1-\\pi)) \\right] $$\n令 $\\ell'_0$ 为依赖于参数的部分：\n$$ \\ell'_0(\\pi) = \\sum_{g,i} \\left[ \\ln B(k_{gi}+\\phi\\pi, n_{gi}-k_{gi}+\\phi(1-\\pi)) - \\ln B(\\phi\\pi, \\phi(1-\\pi)) \\right] $$\n$H_0$ 下的最大化对数似然是 $\\ell'_0(\\hat{\\pi})$，其中 $\\hat{\\pi}$ 是共同比例的 MLE。\n\n**4. 似然比检验统计量 ($T$)**\n\n似然比检验统计量 $T$ 由下式给出：\n$$ T = 2 \\left( \\sup_{\\pi_A, \\pi_B} \\ell_1(\\pi_A, \\pi_B) - \\sup_{\\pi} \\ell_0(\\pi) \\right) = 2 (\\ell_1(\\hat{\\pi}_A, \\hat{\\pi}_B) - \\ell_0(\\hat{\\pi})) $$\n常数项抵消，因此我们有：\n$$ T = 2 (\\ell'_1(\\hat{\\pi}_A, \\hat{\\pi}_B) - \\ell'_0(\\hat{\\pi})) $$\n让我们明确地写出这个式子。我们使用恒等式 $B(a,b) = \\frac{\\Gamma(a)\\Gamma(b)}{\\Gamma(a+b)}$，因此 $\\ln B(a,b) = \\ln\\Gamma(a) + \\ln\\Gamma(b) - \\ln\\Gamma(a+b)$。\n\n最大化的备择对数似然（依赖于参数的部分）是：\n$$ \\ell'_1(\\hat{\\pi}_A, \\hat{\\pi}_B) = \\sum_{g \\in \\{A,B\\}} \\sum_{i=1}^{N_g} \\left[ \\ln\\Gamma(k_{gi}+\\phi\\hat{\\pi}_g) + \\ln\\Gamma(n_{gi}-k_{gi}+\\phi(1-\\hat{\\pi}_g)) - \\ln\\Gamma(n_{gi}+\\phi) \\right] \\\\ - \\sum_{g \\in \\{A,B\\}} N_g \\left[ \\ln\\Gamma(\\phi\\hat{\\pi}_g) + \\ln\\Gamma(\\phi(1-\\hat{\\pi}_g)) - \\ln\\Gamma(\\phi) \\right] $$\n最大化的原假设对数似然（依赖于参数的部分）是：\n$$ \\ell'_0(\\hat{\\pi}) = \\sum_{g \\in \\{A,B\\}} \\sum_{i=1}^{N_g} \\left[ \\ln\\Gamma(k_{gi}+\\phi\\hat{\\pi}) + \\ln\\Gamma(n_{gi}-k_{gi}+\\phi(1-\\hat{\\pi})) - \\ln\\Gamma(n_{gi}+\\phi) \\right] \\\\ - (N_A+N_B) \\left[ \\ln\\Gamma(\\phi\\hat{\\pi}) + \\ln\\Gamma(\\phi(1-\\hat{\\pi})) - \\ln\\Gamma(\\phi) \\right] $$\n在计算 $T=2(\\ell'_1(\\hat{\\pi}_A, \\hat{\\pi}_B) - \\ell'_0(\\hat{\\pi}))$ 时，项 $-\\ln\\Gamma(n_{gi}+\\phi)$ 和 $+\\ln\\Gamma(\\phi)$ 会抵消。$T$ 的结果表达式为：\n$$ T = 2 \\Biggl( \\sum_{g \\in \\{A,B\\}} \\sum_{i=1}^{N_g} \\left[ \\ln\\Gamma(k_{gi}+\\phi\\hat{\\pi}_g) + \\ln\\Gamma(n_{gi}-k_{gi}+\\phi(1-\\hat{\\pi}_g)) \\right] - \\sum_{g \\in \\{A,B\\}} N_g \\left[ \\ln\\Gamma(\\phi\\hat{\\pi}_g) + \\ln\\Gamma(\\phi(1-\\hat{\\pi}_g)) \\right] \\\\ - \\left( \\sum_{g \\in \\{A,B\\}} \\sum_{i=1}^{N_g} \\left[ \\ln\\Gamma(k_{gi}+\\phi\\hat{\\pi}) + \\ln\\Gamma(n_{gi}-k_{gi}+\\phi(1-\\hat{\\pi})) \\right] - (N_A+N_B) \\left[ \\ln\\Gamma(\\phi\\hat{\\pi}) + \\ln\\Gamma(\\phi(1-\\hat{\\pi})) \\right] \\right) \\Biggr) $$\n这个表达式可以通过对每个数据集的项进行分组来重新排列，这样在符号上更清晰。对于有 $N_A$ 个重复（由 $i$ 索引）的组 $A$ 和有 $N_B$ 个重复（由 $j$ 索引）的组 $B$：\n$$ T = 2 \\Biggl( \\left( \\sum_{i=1}^{N_A} \\ln \\frac{\\Gamma(k_{Ai}+\\phi\\hat{\\pi}_A)}{\\Gamma(k_{Ai}+\\phi\\hat{\\pi})} + \\sum_{i=1}^{N_A} \\ln \\frac{\\Gamma(n_{Ai}-k_{Ai}+\\phi(1-\\hat{\\pi}_A))}{\\Gamma(n_{Ai}-k_{Ai}+\\phi(1-\\hat{\\pi}))} + N_A \\ln \\frac{\\Gamma(\\phi\\hat{\\pi})\\Gamma(\\phi(1-\\hat{\\pi}))}{\\Gamma(\\phi\\hat{\\pi}_A)\\Gamma(\\phi(1-\\hat{\\pi}_A))} \\right) \\\\ + \\left( \\sum_{j=1}^{N_B} \\ln \\frac{\\Gamma(k_{Bj}+\\phi\\hat{\\pi}_B)}{\\Gamma(k_{Bj}+\\phi\\hat{\\pi})} + \\sum_{j=1}^{N_B} \\ln \\frac{\\Gamma(n_{Bj}-k_{Bj}+\\phi(1-\\hat{\\pi}_B))}{\\Gamma(n_{Bj}-k_{Bj}+\\phi(1-\\hat{\\pi}))} + N_B \\ln \\frac{\\Gamma(\\phi\\hat{\\pi})\\Gamma(\\phi(1-\\hat{\\pi}))}{\\Gamma(\\phi\\hat{\\pi}_B)\\Gamma(\\phi(1-\\hat{\\pi}_B))} \\right) \\Biggl) $$\n对于最终答案，我们呈现第一个更明确的形式。\n\n**5. $T$ 的渐近零分布**\n\n根据威尔克斯定理 (Wilks' theorem)，对于大样本量（$N_A, N_B \\to \\infty$），只要满足某些正则性条件，似然比检验统计量 $T$ 在原假设下渐近服从卡方 ($\\chi^2$) 分布。贝塔-二项模型满足这些条件。$\\chi^2$ 分布的自由度是备择模型和原假设模型之间自由参数数量的差异。\n-   $H_1$ 下参数空间的维度：参数为 $(\\pi_A, \\pi_B)$，因此维度为 $2$。\n-   $H_0$ 下参数空间的维度：约束 $\\pi_A = \\pi_B = \\pi$ 留下一个自由参数 $\\pi$，因此维度为 $1$。\n-   维度差异（自由度）：$2 - 1 = 1$。\n\n因此，$T$ 在 $H_0$ 下的渐近分布是自由度为 $1$ 的卡方分布。\n$$ T \\xrightarrow{d} \\chi^2_1 \\quad \\text{在 } H_0 \\text{ 下} $$\n\n最终答案构成：问题要求给出 $T$ 的闭式表达式及其渐近零分布。这个复合答案将以行矩阵的形式呈现。下面 $T$ 的表达式为了完全清晰而展开，其中对组 $g$ 的 $i$ 的求和遍历该组中的所有重复，$N_g$ 是重复的数量。\n$$ T = 2 \\Biggl( \\sum_{g \\in \\{A,B\\}} \\sum_{i=1}^{N_g} \\left[ \\ln\\Gamma(k_{gi}+\\phi\\hat{\\pi}_g) + \\ln\\Gamma(n_{gi}-k_{gi}+\\phi(1-\\hat{\\pi}_g)) \\right] - \\sum_{g \\in \\{A,B\\}} N_g \\left[ \\ln\\Gamma(\\phi\\hat{\\pi}_g) + \\ln\\Gamma(\\phi(1-\\hat{\\pi}_g)) \\right] \\\\ - \\sum_{g \\in \\{A,B\\}} \\sum_{i=1}^{N_g} \\left[ \\ln\\Gamma(k_{gi}+\\phi\\hat{\\pi}) + \\ln\\Gamma(n_{gi}-k_{gi}+\\phi(1-\\hat{\\pi})) \\right] + (N_A+N_B) \\left[ \\ln\\Gamma(\\phi\\hat{\\pi}) + \\ln\\Gamma(\\phi(1-\\hat{\\pi})) \\right] \\Biggr) $$\n这里，$\\hat{\\pi}_g$ 代表在 $H_1$ 下组 $g$ 的 MLE（即，组 A 的 $\\hat{\\pi}_A$ 和组 B 的 $\\hat{\\pi}_B$）。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 2 \\Biggl( \\displaystyle\\sum_{g \\in \\{A,B\\}} \\sum_{i=1}^{N_g} \\left[ \\ln\\Gamma(k_{gi}+\\phi\\hat{\\pi}_g) + \\ln\\Gamma(n_{gi}-k_{gi}+\\phi(1-\\hat{\\pi}_g)) \\right] - \\sum_{g \\in \\{A,B\\}} N_g \\left[ \\ln\\Gamma(\\phi\\hat{\\pi}_g) + \\ln\\Gamma(\\phi(1-\\hat{\\pi}_g)) \\right] - \\sum_{g \\in \\{A,B\\}} \\sum_{i=1}^{N_g} \\left[ \\ln\\Gamma(k_{gi}+\\phi\\hat{\\pi}) + \\ln\\Gamma(n_{gi}-k_{gi}+\\phi(1-\\hat{\\pi})) \\right] + (N_A+N_B) \\left[ \\ln\\Gamma(\\phi\\hat{\\pi}) + \\ln\\Gamma(\\phi(1-\\hat{\\pi})) \\right] \\Biggr)  \\chi^2_1 \\end{pmatrix} } $$"
        }
    ]
}