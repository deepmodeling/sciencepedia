{
    "hands_on_practices": [
        {
            "introduction": "机器人手术的成功设置始于一个基础但关键的运动学挑战：计算实现期望对接姿态所需的关节配置。这个过程，即逆向运动学求解，是将外科医生的目标（如穿刺口位置和器械接近角度）转化为机器人各关节的具体指令。本练习将引导您通过一个典型的三自由度机械臂模型，计算出满足对接条件、关节限制和安全间隙的关节角度和器械插入深度，这是理解和设计机器人控制算法的核心实践。",
            "id": "5180660",
            "problem": "用于系统性手术的机器人床旁机械臂被建模为一个串联链，具有三个旋转关节，并在腕部连接一个直形手术器械。基坐标系的坐标轴定义为：$x$轴指向前方，$y$轴指向左方，$z$轴指向上方。肩关节位于基坐标原点上方的一个固定高度处。这些关节是：关节$1$是绕$z$轴的偏航旋转，角度为$q_1$；关节$2$是绕$y$轴的俯仰旋转，角度为$q_2$；关节$3$是绕$y$轴的俯仰旋转，角度为$q_3$。第一和第二连杆的长度分别为$L_1$和$L_2$，肩部高度为$H$。手术器械轴与腕部变换后的局部$x$轴对齐，其插入深度$s$沿着该轴线。为了在套管穿刺口处对接，器械轴必须穿过指定的穿刺口位置，并且轴线方向必须与从角度派生出的期望接近向量相匹配。远程运动中心（RCM）约束通过要求腕部到穿刺口的线段严格沿着器械轴线方向来强制执行。\n\n基本和核心定义：\n\n- 绕$z$轴旋转角度$q$的旋转矩阵为$R_z(q) = \\begin{bmatrix}\\cos q  -\\sin q  0 \\\\ \\sin q  \\cos q  0 \\\\ 0  0  1\\end{bmatrix}$，绕$y$轴旋转角度$q$的旋转矩阵为$R_y(q) = \\begin{bmatrix}\\cos q  0  \\sin q \\\\ 0  1  0 \\\\ -\\sin q  0  \\cos q\\end{bmatrix}$。\n- 单位接近向量$v$由方位角$\\phi$（绕$z$轴从$x$轴起的角度）和俯仰角$\\epsilon$（从$x$-$y$平面的夹角，向下为正）指定，其表达式为$v = [\\cos \\epsilon \\cos \\phi,\\ \\cos \\epsilon \\sin \\phi,\\ -\\sin \\epsilon]$。\n- 腕部位置为$p_W = [0,0,H]^T + R_z(q_1)\\big(L_1 R_y(q_2)[1,0,0]^T + L_2 R_y(\\alpha)[1,0,0]^T\\big)$，其中$\\alpha = q_2 + q_3$是控制器械轴线方向的净俯仰角。\n- 对接条件要求$p_W + s\\ R_z(q_1)R_y(\\alpha)[1,0,0]^T = r_{\\text{port}}$，这强制了RCM作用线穿过穿刺口。\n- 点$C$到线段$AB$的距离$d(C,AB)$的计算方法是：将点$C$投影到穿过$AB$的无限直线上，将投影参数限制在$[0,1]$范围内，然后计算到最近点的欧几里得范数。\n\n您的任务是计算对接时的关节配置$(q_1,q_2,q_3)$和器械插入深度$s$，验证关节限位和间隙约束，并为每种情况输出配置或可行性布尔值。\n\n假设和约束：\n\n- 关节限位：$q_1 \\in [-\\pi,\\pi]$，$q_2 \\in [-2.0,2.0]$ 弧度，$q_3 \\in [-2.0,2.0]$ 弧度。\n- 插入深度限位：$s \\in [0.05,0.40]$ 米。\n- 间隙约束：刚性连杆$S\\to E$和$E \\to W$不得进入以穿刺口位置$r_{\\text{port}}$为中心、半径为$R_{\\text{clear}}$的球形安全区域。此处$S=[0,0,H]^T$是肩部，$E=S+L_1 R_z(q_1)R_y(q_2)[1,0,0]^T$是肘部，$W=E+L_2 R_z(q_1)R_y(\\alpha)[1,0,0]^T$是腕部。器械段$W\\to r_{\\text{port}}$免于间隙检查。\n\n输入量和单位：\n\n- 连杆长度$L_1$和$L_2$，单位为米。\n- 肩部高度$H$，单位为米。\n- 穿刺口坐标$r_{\\text{port}} = [x,y,z]$，单位为米。\n- 接近角$\\phi$和$\\epsilon$，单位为弧度。\n- 间隙半径$R_{\\text{clear}}$，单位为米。\n\n所需计算：\n\n- 在可行的情况下，计算满足对接条件的$q_1$、$q_2$、$q_3$和$s$。\n- 验证$q_1$、$q_2$、$q_3$和$s$是否满足所述限位。\n- 验证从$r_{\\text{port}}$到每个刚性连杆段$S\\to E$和$E\\to W$的最小距离大于或等于$R_{\\text{clear}}$。\n\n边界情况处理：\n\n- 如果$\\cos \\alpha$接近于零（器械轴几乎垂直），则使用极限方程求解，而不除以$\\cos \\alpha$。\n- 如果旋转后的横向条件$|w_y|$（其中$w=R_z(-q_1)(r_{\\text{port}}-[0,0,H]^T)$）不充分接近于$0$，则在给定的运动学模型下无解。\n\n测试套件：\n\n使用以下五个测试用例，共享的机械臂参数为$L_1=0.45, L_2=0.35, H=0.80$，关节限位为$q_2,q_3 \\in [-2.0, 2.0]$ 弧度，$q_1 \\in [-\\pi,\\pi]$，以及插入限位为$s \\in [0.05, 0.40]$ 米：\n\n1. 正常路径：\n   - $r_{\\text{port}} = [0.85, 0.00, 0.50]$, $\\phi=0.00$, $\\epsilon=0.35$, $R_{\\text{clear}}=0.08$.\n2. 边界近垂直接近：\n   - $r_{\\text{port}} = [0.15, 0.233700, 0.05]$, $\\phi=1.00$, $\\epsilon=1.560796$, $R_{\\text{clear}}=0.10$.\n3. 横向不可行性：\n   - $r_{\\text{port}} = [0.50, 0.10, 0.45]$, $\\phi=0.00$, $\\epsilon=0.35$, $R_{\\text{clear}}=0.08$.\n4. 插入限位违反：\n   - $r_{\\text{port}} = [1.50, 0.00, 0.50]$, $\\phi=0.00$, $\\epsilon=0.35$, $R_{\\text{clear}}=0.08$.\n5. 间隙违反：\n   - $r_{\\text{port}} = [0.85, 0.00, 0.50]$, $\\phi=0.00$, $\\epsilon=0.35$, $R_{\\text{clear}}=0.20$.\n\n最终输出格式：\n\n您的程序应生成单行输出，其中包含所有五个测试用例的结果，格式为逗号分隔的Python风格列表。对于每个测试用例，如果所有约束都满足，则输出一个包含四个浮点数的列表$[q_1,q_2,q_3,s]$（角度单位为弧度，$s$单位为米），保留六位小数；如果不可行，则输出布尔值$False$。例如：$[[0.1,0.2,0.3,0.15],False,[...],...]$。",
            "solution": "用户需要一个机器人手术逆运动学问题的解决方案。\n\n**1. 问题验证**\n该问题定义明确且科学上合理。它提出了一个清晰的3自由度串联机械臂的运动学模型，并带有一个额外的类似棱柱关节的器械插入。约束条件（对接、RCM、关节限位、间隙）是机器人学中的标准配置。提供的机器人几何和运动方程是正确的。测试用例是具体的，旨在检查各种可行性条件。没有矛盾、歧义或事实错误。该问题是有效的。\n\n**2. 基于原理的解决方案设计**\n该问题要求解出关节角度$(q_1, q_2, q_3)$和器械插入深度$s$，以使机器人机械臂能够以给定的姿态在指定的穿刺口$r_{\\text{port}}$处对接。该姿态由一个接近向量$v$定义，该向量由方位角$\\phi$和俯仰角$\\epsilon$参数化。\n\n首先，我们确定机械臂所需的姿态。器械轴线方向$v_{\\text{ins}}$由施加在腕部的总旋转决定。这个旋转是一个偏航$q_1$后跟一个净俯仰$\\alpha = q_2 + q_3$。方向向量通过旋转局部工具轴$[1,0,0]^T$得到：\n$$ v_{\\text{ins}} = R_z(q_1) R_y(\\alpha) [1,0,0]^T = \\begin{bmatrix} \\cos q_1 \\cos \\alpha \\\\ \\sin q_1 \\cos \\alpha \\\\ -\\sin \\alpha \\end{bmatrix} $$\n这个方向必须与指定的接近向量$v = [\\cos \\epsilon \\cos \\phi, \\cos \\epsilon \\sin \\phi, -\\sin \\epsilon]^T$相匹配。\n将$v_{\\text{ins}}$和$v$的分量相等可得：\n1. $\\cos q_1 \\cos \\alpha = \\cos \\epsilon \\cos \\phi$\n2. $\\sin q_1 \\cos \\alpha = \\cos \\epsilon \\sin \\phi$\n3. $-\\sin \\alpha = -\\sin \\epsilon$\n\n由方程(3)，我们得到$\\sin \\alpha = \\sin \\epsilon$。主解对应于向下的俯仰，即$\\alpha = \\epsilon$。这也意味着$\\cos \\alpha = \\cos \\epsilon$，假设$\\epsilon \\in [-\\pi/2, \\pi/2]$。\n将$\\cos\\alpha = \\cos\\epsilon$代入(1)和(2)（并假设$\\cos\\epsilon \\neq 0$），我们发现$\\cos q_1 = \\cos\\phi$和$\\sin q_1 = \\sin\\phi$。这得出$q_1 = \\phi$。\n因此，两个所需的几何参数直接由接近向量确定：\n$q_1 = \\phi$\n$\\alpha = q_2 + q_3 = \\epsilon$\n\n接下来，我们使用位置约束。对接条件$p_W + s \\cdot v = r_{\\text{port}}$意味着腕部位置$p_W$必须位于穿过$r_{\\text{port}}$且方向为$-v$的直线上。\n$p_W = r_{\\text{port}} - s \\cdot v$\n\n腕部位置的正向运动学方程为：\n$$ p_W = \\begin{bmatrix}0\\\\0\\\\H\\end{bmatrix} + R_z(q_1) \\left( L_1 R_y(q_2) \\begin{bmatrix}1\\\\0\\\\0\\end{bmatrix} + L_2 R_y(\\alpha) \\begin{bmatrix}1\\\\0\\\\0\\end{bmatrix} \\right) $$\n为了简化，我们可以在一个随$q_1$关节旋转的二维平面中工作。我们将坐标系旋转$R_z(-q_1)$，使机械臂平面与基坐标系的$x-z$平㖣对齐。设$w = r_{\\text{port}} - [0,0,H]^T$。\n将位置方程乘以$R_z(-q_1)$得到：\n$$ R_z(-q_1) (p_W - \\begin{bmatrix}0\\\\0\\\\H\\end{bmatrix}) = L_1 R_y(q_2) \\begin{bmatrix}1\\\\0\\\\0\\end{bmatrix} + L_2 R_y(\\alpha) \\begin{bmatrix}1\\\\0\\\\0\\end{bmatrix} $$\n同样，$R_z(-q_1)(r_{\\text{port}} - s \\cdot v - [0,0,H]^T) = R_z(-q_1)w - s \\cdot R_z(-q_1)v$。\n注意，$R_z(-q_1)v = R_y(\\alpha)[1,0,0]^T$。\n设$w' = R_z(-q_1)w$。方程变为：\n$$ \\begin{bmatrix} L_1\\cos q_2 + L_2\\cos\\alpha \\\\ 0 \\\\ -L_1\\sin q_2 - L_2\\sin\\alpha \\end{bmatrix} = w' - s \\begin{bmatrix} \\cos\\alpha \\\\ 0 \\\\ -\\sin\\alpha \\end{bmatrix} $$\n这个向量方程解耦为三个标量方程。$y$分量给出$0 = w'_y$。由于$w'_y = -x_{\\text{port}}\\sin q_1 + y_{\\text{port}}\\cos q_1$，这是一个几何约束，即穿刺口必须位于由机械臂偏航角$q_1$定义的垂直平面内。如果不满足这个“横向可行性”条件$|w'_y| \\approx 0$，则不存在解。\n\n剩下的两个方程涉及未知数$q_2$和$s$：\n(A) $L_1\\cos q_2 + L_2\\cos\\alpha = w'_x - s\\cos\\alpha \\implies L_1\\cos q_2 = w'_x - (L_2+s)\\cos\\alpha$\n(B) $-L_1\\sin q_2 - L_2\\sin\\alpha = w'_z + s\\sin\\alpha \\implies L_1\\sin q_2 = -w'_z - (L_2+s)\\sin\\alpha$\n设$D = L_2+s$。我们可以通过平方并相加这两个方程来求解$D$：\n$$ L_1^2 = (w'_x - D\\cos\\alpha)^2 + (-w'_z - D\\sin\\alpha)^2 $$\n这简化为关于$D$的二次方程：\n$$ D^2 - 2(w'_x\\cos\\alpha - w'_z\\sin\\alpha)D + (w_x'^2 + w_z'^2 - L_1^2) = 0 $$\n这个二次方程的判别式是$\\Delta = L_1^2 - (w'_x\\sin\\alpha + w'_z\\cos\\alpha)^2$。要使$D$存在实数解，我们需要$\\Delta \\geq 0$。这是一个可达性约束。如果$\\Delta  0$，则目标不可达。\n\n如果$\\Delta \\ge 0$，我们找到$D$的两个解：\n$$ D = (w'_x\\cos\\alpha - w'_z\\sin\\alpha) \\pm \\sqrt{\\Delta} $$\n每个$D$的解都可能对应一个有效的机器人配置。对于每个候选解$D_i$：\n1. 计算$s_i = D_i - L_2$。\n2. 计算$q_{2,i} = \\text{atan2}(-w'_z - D_i\\sin\\alpha, w'_x - D_i\\cos\\alpha)$。\n3. 计算$q_{3,i} = \\alpha - q_{2,i}$。\n4. 检查$s_i, q_{2,i}, q_{3,i}$是否在各自的限位内。\n\n如果一个候选配置$(q_1, q_2, q_3, s)$满足所有关节和插入限位，我们必须执行最终的间隙检查。机械臂的两个刚性连杆，从肩部$S$到肘部$E$以及从肘部$E$到腕部$W$，不得与以穿刺口$r_{\\text{port}}$为中心、半径为$R_{\\text{clear}}$的球体相交。\n我们计算点$r_{\\text{port}}$到线段$SE$和$EW$的最小距离。\n- $S = [0,0,H]^T$\n- $E = S + L_1 R_z(q_1)R_y(q_2)[1,0,0]^T$\n- $W = E + L_2 R_z(q_1)R_y(\\alpha)[1,0,0]^T$\n从点$C$到线段$AB$的距离是通过将$C$投影到经过$A$和$B$的直线上来找到的。如果投影点落在该线段上，距离就是垂线的长度。如果投影点落在该线段之外，距离就是到较近端点（$A$或$B$）的距离。两个距离，$d(r_{\\text{port}}, SE)$和$d(r_{\\text{port}}, EW)$，都必须大于或等于$R_{\\text{clear}}$。\n\n如果一个配置通过了所有检查，它就是一个有效的解。如果$D$的两个解都产生有效的配置，我们必须选择一个。一个常见的约定是选择“伸展较小”的解。我们首先测试对应于较小$D$值的解，即$D = K - \\sqrt{\\Delta}$。如果它有效，我们就返回它。否则，我们测试另一个解。如果两者都无效，则该情况不可行。",
            "answer": "```python\nimport numpy as np\n\ndef dist_point_to_segment(p, a, b):\n    \"\"\"\n    Calculates the minimum distance from a point p to a line segment defined by a and b.\n    All inputs are numpy arrays.\n    \"\"\"\n    v = b - a\n    # Handle the case where the segment is just a point\n    v_dot_v = np.dot(v, v)\n    if v_dot_v == 0:\n        return np.linalg.norm(p - a)\n    \n    w = p - a\n    t = np.dot(w, v) / v_dot_v\n    t_clamped = np.clip(t, 0, 1)\n    \n    projection = a + t_clamped * v\n    return np.linalg.norm(p - projection)\n\ndef solve_case(L1, L2, H, q_lim, s_lim, r_port, phi, epsilon, R_clear):\n    \"\"\"\n    Solves for the joint configuration for a single test case.\n    \"\"\"\n    # 1. Determine base orientation q1 and net pitch alpha\n    q1 = phi\n    alpha = epsilon\n    \n    # Python's list slicing for limits\n    q2_lim, q3_lim = q_lim, q_lim\n\n    # Check q1 limits (though test cases are compliant)\n    if not (-np.pi = q1 = np.pi):\n        return False\n    \n    # 2. Transform port coordinates into the arm's 2D plane\n    r_port_np = np.array(r_port)\n    s0 = np.array([0, 0, H])\n    \n    cos_q1 = np.cos(q1)\n    sin_q1 = np.sin(q1)\n    \n    # Rotated coordinates of the port relative to the shoulder\n    w_prime_x = r_port_np[0] * cos_q1 + r_port_np[1] * sin_q1\n    w_prime_y = -r_port_np[0] * sin_q1 + r_port_np[1] * cos_q1\n    w_prime_z = r_port_np[2] - H\n    \n    # 3. Check for lateral infeasibility\n    if abs(w_prime_y) > 1e-9:\n        return False\n\n    # 4. Solve quadratic equation for D = L2 + s\n    cos_alpha = np.cos(alpha)\n    sin_alpha = np.sin(alpha)\n    \n    K = w_prime_x * cos_alpha - w_prime_z * sin_alpha\n    delta_sq_term = w_prime_x * sin_alpha + w_prime_z * cos_alpha\n    \n    delta = L1**2 - delta_sq_term**2\n\n    if delta  0:\n        return False\n        \n    sqrt_delta = np.sqrt(delta)\n    \n    # Two potential solutions for D, check the smaller one first\n    D_sols = [K - sqrt_delta, K + sqrt_delta] \n    \n    for D in D_sols:\n        # a. Calculate s and check limits\n        s = D - L2\n        if not (s_lim[0] = s = s_lim[1]):\n            continue\n            \n        # b. Calculate q2 and check limits\n        q2_y_arg = -w_prime_z - D * sin_alpha\n        q2_x_arg = w_prime_x - D * cos_alpha\n        q2 = np.arctan2(q2_y_arg, q2_x_arg)\n        if not (q2_lim[0] = q2 = q2_lim[1]):\n            continue\n            \n        # c. Calculate q3 and check limits\n        q3 = alpha - q2\n        if not (q3_lim[0] = q3 = q3_lim[1]):\n            continue\n            \n        # d. Clearance check\n        S = s0\n        Rz_q1 = np.array([[cos_q1, -sin_q1, 0],\n                          [sin_q1,  cos_q1, 0],\n                          [0,           0, 1]])\n        \n        v1_local = np.array([np.cos(q2), 0, -np.sin(q2)])\n        v1 = Rz_q1 @ v1_local\n        E = S + L1 * v1\n        \n        v2_local = np.array([cos_alpha, 0, -sin_alpha])\n        v2 = Rz_q1 @ v2_local\n        W = E + L2 * v2\n        \n        dist_se = dist_point_to_segment(r_port_np, S, E)\n        if dist_se  R_clear:\n            continue\n            \n        dist_ew = dist_point_to_segment(r_port_np, E, W)\n        if dist_ew  R_clear:\n            continue\n        \n        # All checks passed, this is a valid solution\n        return [q1, q2, q3, s]\n\n    # No valid configuration found\n    return False\n\ndef solve():\n    # Shared manipulator parameters\n    L1 = 0.45\n    L2 = 0.35\n    H = 0.80\n    q_lim = [-2.0, 2.0]\n    s_lim = [0.05, 0.40]\n\n    # Test suite\n    test_cases = [\n        # 1. Happy path\n        {'r_port': [0.85, 0.00, 0.50], 'phi': 0.00, 'epsilon': 0.35, 'R_clear': 0.08},\n        # 2. Boundary near-vertical approach\n        {'r_port': [0.15, 0.233700, 0.05], 'phi': 1.00, 'epsilon': 1.560796, 'R_clear': 0.10},\n        # 3. Lateral infeasibility\n        {'r_port': [0.50, 0.10, 0.45], 'phi': 0.00, 'epsilon': 0.35, 'R_clear': 0.08},\n        # 4. Insertion limit violation\n        {'r_port': [1.50, 0.00, 0.50], 'phi': 0.00, 'epsilon': 0.35, 'R_clear': 0.08},\n        # 5. Clearance violation\n        {'r_port': [0.85, 0.00, 0.50], 'phi': 0.00, 'epsilon': 0.35, 'R_clear': 0.20},\n    ]\n\n    results_str = []\n    for case in test_cases:\n        res = solve_case(L1, L2, H, q_lim, s_lim, **case)\n        \n        if isinstance(res, list):\n            # Format to 6 decimal places as required\n            formatted_res = f\"[{','.join(f'{x:.6f}' for x in res)}]\"\n            results_str.append(formatted_res)\n        else:\n            results_str.append(str(res))\n            \n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在理想的设置之后，我们必须面对手术室中的现实动态。本练习模拟了一个在对接过程中遇到的常见意外情况：一个障碍物（如手术铺单褶皱）出现在器械路径上。您将运用小角度运动学和几何原理，计算出在维持关键的远程运动中心（RCM）约束下，为避开障碍物所需的最小器械倾斜调整量。这项实践强调了机器人系统在保证安全和手术精度前提下，对环境变化做出实时调整的能力。",
            "id": "5180611",
            "problem": "一台用于微创手术的病人侧机器人手术车采用远程运动中心（RCM）约束，这意味着器械杆必须围绕套管针处的一个固定点转动，而不能使该点相对于患者发生平移。考虑一个初始对接情况，其中器械轴与局部垂直轴对齐，且RCM位于原点。器械的姿态由一个球形腕控制，其小角度运动可以通过围绕局部$\\hat{\\mathbf{x}}$轴的俯仰角$\\beta$、围绕局部$\\hat{\\mathbf{y}}$轴的偏航角$\\alpha$以及围绕局部$\\hat{\\mathbf{z}}$轴的滚转角$\\gamma$来参数化；器械轴初始时与$\\hat{\\mathbf{z}}$轴重合。滚转角$\\gamma$不改变轴的方向，因此不影响RCM约束。\n\n在对接过程中，一个意外的手术铺巾褶皱在距离RCM为有符号弧长$s$的位置（沿器械轴测量）横向伸入器械杆的路径中。为避免接触，该褶皱需要一个垂直于器械轴的横向间隙$c$，并且工程规定要求在几何间隙上施加一个大于1的乘性安全系数$m$，以考虑铺巾的柔顺性。\n\n请提出一种几何重构方案，通过围绕RCM实施一个纯粹的器械倾斜来保持端口对齐，该倾斜由垂直于$\\hat{\\mathbf{z}}$的平面内的小倾斜矢量$\\boldsymbol{\\theta}=(\\theta_{x},\\theta_{y})$表示。在小角度刚体运动学假设下，由该倾斜引起的、在弧长$s$处的器械杆的横向位移为$s\\lVert\\boldsymbol{\\theta}\\rVert$。\n\n假设腕部的小角度关节变化量$(\\Delta\\beta,\\Delta\\alpha)$直接映射到倾斜分量$(\\theta_{x},\\theta_{y})$（因此$(\\Delta\\beta,\\Delta\\alpha)=(\\theta_{x},\\theta_{y})$），并将关节角度变化矢量的欧几里得范数定义为$\\Delta=\\sqrt{(\\Delta\\beta)^{2}+(\\Delta\\alpha)^{2}}$。给定$s=0.32\\,\\mathrm{m}$，$c=0.014\\,\\mathrm{m}$和$m=1.1$，确定$\\Delta$的最小值，以保证满足带安全系数的间隙要求，同时保持RCM。将您的答案四舍五入到四位有效数字。角度以弧度表示。",
            "solution": "远程运动中心（RCM）约束要求器械的所有重构都必须通过围绕RCM的旋转来实现，而该点本身不发生平移。在遇到意外的横向障碍物时，一种保持端口对齐的科学有效方法是，在与当前轴线正交的平面内，围绕RCM对器械轴施加一个纯粹的倾斜。这可以由一个位于$\\hat{\\mathbf{x}}$–$\\hat{\\mathbf{y}}$平面内的小旋转矢量$\\boldsymbol{\\theta}$来表示，其中器械轴初始时与$\\hat{\\mathbf{z}}$轴重合。\n\n刚体运动学的基本原理指出，对于一个相对于旋转中心位于位置$\\mathbf{r}$的点，一个小角度旋转$\\boldsymbol{\\theta}$会产生位移$\\delta\\mathbf{r}=\\boldsymbol{\\theta}\\times\\mathbf{r}$。设器械杆上所关注的点位于沿$\\hat{\\mathbf{z}}$轴弧长为$s$的位置，因此$\\mathbf{r}=s\\,\\hat{\\mathbf{z}}$。对于一个与$\\hat{\\mathbf{z}}$正交的倾斜$\\boldsymbol{\\theta}=(\\theta_{x},\\theta_{y},0)$，横向位移的大小为\n\n$$\n\\lVert\\delta\\mathbf{r}\\rVert=\\lVert \\boldsymbol{\\theta}\\times (s\\,\\hat{\\mathbf{z}})\\rVert=s\\,\\lVert\\boldsymbol{\\theta}\\rVert\\,\\lVert\\hat{\\mathbf{z}}\\rVert\\,\\sin\\phi,\n$$\n\n其中$\\phi$是$\\boldsymbol{\\theta}$和$\\hat{\\mathbf{z}}$之间的夹角。由于$\\boldsymbol{\\theta}$与$\\hat{\\mathbf{z}}$正交，所以$\\sin\\phi=1$，且$\\lVert\\hat{\\mathbf{z}}\\rVert=1$，因此\n\n$$\n\\lVert\\delta\\mathbf{r}\\rVert=s\\,\\lVert\\boldsymbol{\\theta}\\rVert.\n$$\n\n为了在有安全系数的情况下避开障碍物，横向位移必须满足\n\n$$\ns\\,\\lVert\\boldsymbol{\\theta}\\rVert \\ge m\\,c.\n$$\n\n对于最小角度重构，我们使其取等号：\n\n$$\ns\\,\\lVert\\boldsymbol{\\theta}\\rVert = m\\,c \\quad \\Rightarrow \\quad \\lVert\\boldsymbol{\\theta}\\rVert=\\frac{m\\,c}{s}.\n$$\n\n假定小角度下的球形腕映射是直接的：$(\\Delta\\beta,\\Delta\\alpha)=(\\theta_{x},\\theta_{y})$。因此，关节角度变化矢量的欧几里得范数为\n\n$$\n\\Delta=\\sqrt{(\\Delta\\beta)^{2}+(\\Delta\\alpha)^{2}}=\\sqrt{\\theta_{x}^{2}+\\theta_{y}^{2}}=\\lVert\\boldsymbol{\\theta}\\rVert=\\frac{m\\,c}{s}.\n$$\n\n代入给定值$m=1.1$，$c=0.014\\,\\mathrm{m}$和$s=0.32\\,\\mathrm{m}$，\n\n$$\n\\Delta=\\frac{1.1\\times 0.014}{0.32}=\\frac{0.0154}{0.32}=0.048125\\ \\text{radians}.\n$$\n\n结果四舍五入到四位有效数字为\n\n$$\n\\Delta=0.04813\\ \\text{radians}.\n$$\n\n此次重构保持了RCM，因为它是一次围绕套管针点的纯旋转，并且通过将倾斜方向与障碍物的横向方向对齐，它在满足带安全系数的间隙要求的同时，使关节偏移最小化。围绕$\\hat{\\mathbf{z}}$轴的滚转角$\\gamma$没有被使用，因为它不改变轴的方向，因此对产生横向间隙没有贡献。",
            "answer": "$$\\boxed{0.04813}$$"
        },
        {
            "introduction": "超越了运动学的确定性世界，确保患者安全还需要一种系统性的、基于概率的风险评估方法。本练习将引导您使用故障树分析（FTA）这一强大的工程工具，来量化整个机器人手术平台的风险。通过分析电源、通信和关节编码器等关键子系统的故障概率，您将学会如何从组件层面的可靠性数据推导出系统级的整体不良事件风险，并识别出主要的风险来源。这是设计和验证安全关键医疗设备时不可或缺的技能。",
            "id": "5180677",
            "problem": "一个用于全身手术的机器人手术平台集成了三个关键子系统，这些子系统的故障可能引发不良事件，该事件定义为不受控制的器械运动，可能接触到关键结构。这些子系统是电源模块、通信模块和关节编码器/表决器模块。在单次手术期间，已知以下信息：\n\n- 电源模块架构：两个并联电源（主用和备用），可按需从主用电源自动切换到备用电源。每个电源的单次手术失效率为 $p_{P} = 1.5 \\times 10^{-3}$，其中一部分 $\\beta_{P} = 0.02$ 归因于共因失效 (CCF) 机制。切换设备的按需失效率为 $t = 4.0 \\times 10^{-3}$。\n- 通信模块架构：两个冗余链路，每个链路的单次手术失效率为 $p_{C} = 2.0 \\times 10^{-3}$，其中一部分 $\\beta_{C} = 0.05$ 是 CCF。一个主仲裁控制器具有独立的单次手术失效率 $a = 1.0 \\times 10^{-3}$。\n- 关节编码器/表决器模块架构：采用三模冗余 (TMR)，有三个编码器输入到一个多数表决器。每个编码器的单次手术失效率为 $p_{J} = 5.0 \\times 10^{-4}$，共因失效分数为 $\\beta_{J} = 0.10$。表决器具有独立的单次手术失效率 $v = 8.0 \\times 10^{-4}$。\n\n假设三个子系统（电源、通信、关节编码器/表决器）之间统计独立，并且每个子系统内部的控制器与其相关硬件之间也相互独立。在冗余通道内，使用传统的失效率 beta 因子划分法对共因失效进行建模。在推导中，仅使用基础概率法则（例如，并集、交集、独立性）和经过充分检验的可靠性建模概念（例如，beta 因子划分法）。\n\n将电源模块的顶事件定义为“两个电源都不可用”和“主电源失效且切换失败”的并集。将通信模块的顶事件定义为“两个链路都不可用”和“仲裁控制器失效”的并集。将关节编码器/表决器模块的顶事件定义为“至少两个编码器失效（导致多数表决错误）”和“表决器失效”的并集。\n\n如果三个子系统顶事件中的任何一个发生，则机器人平台的总不良事件就会发生。根据给定的参数，从第一性原理推导出总不良事件概率的解析表达式，然后使用上述数值进行计算。在您的推理中，根据最小割集的结构和贡献项的大小，确定哪个（些）子系统是总风险的主要贡献者，并说明原因。\n\n报告单次手术的最终总不良事件概率，以小数形式表示，并四舍五入到四位有效数字。无需单位。",
            "solution": "该问题要求基于机器人手术平台的三个主要子系统（电源、通信和关节编码器/表决器）的可靠性，推导并计算总不良事件概率。总不良事件，记为 $AE$，在任何一个子系统顶事件发生时即发生。设 $E_{Power}$、$E_{Comm}$ 和 $E_{Joint}$ 分别为电源、通信和关节编码器/表决器子系统的顶层失效事件。问题陈述这些子系统是统计独立的。因此，总不良事件的概率 $P(AE)$ 是这三个事件并集的概率：\n\n$$P(AE) = P(E_{Power} \\cup E_{Comm} \\cup E_{Joint})$$\n\n由于独立性，所有事件都不发生的概率是它们各自不发生概率的乘积。于是，并集的概率为：\n\n$$P(AE) = 1 - P(\\neg E_{Power} \\cap \\neg E_{Comm} \\cap \\neg E_{Joint}) = 1 - P(\\neg E_{Power})P(\\neg E_{Comm})P(\\neg E_{Joint})$$\n$$P(AE) = 1 - (1 - P(E_{Power}))(1 - P(E_{Comm}))(1 - P(E_{Joint}))$$\n\n令 $P_{Power} = P(E_{Power})$、$P_{Comm} = P(E_{Comm})$ 和 $P_{Joint} = P(E_{Joint})$。第一步是推导每个子系统的失效率。\n\n**1. 电源模块子系统 ($P_{Power}$)**\n\n电源模块由两个并联电源和一个切换开关组成。顶事件 $E_{Power}$ 定义为两个事件的并集：$A = (\\text{两个电源都不可用})$ 和 $B = (\\text{主电源失效且切换失败})$。\n设 $p_P = 1.5 \\times 10^{-3}$ 为单个电源的失效率，$\\beta_P = 0.02$ 为共因失效 (CCF) 分数。总失效率 $p_P$ 被划分为独立失效率 $p_{PI} = p_P(1-\\beta_P)$ 和共因失效率 $p_{PC} = p_P\\beta_P$。CCF 事件导致两个电源同时失效。\n事件 $A$（“两个电源都不可用”）在两个电源独立失效或发生 CCF 事件时发生。\n$$P(A) = p_{PI}^2 + p_{PC} = (p_P(1-\\beta_P))^2 + p_P\\beta_P$$\n事件 $B$ 是主电源失效（我们称其概率为 $p_P$）和切换开关失效（$t = 4.0 \\times 10^{-3}$）的交集。这两个是独立事件。\n$$P(B) = p_P \\cdot t$$\n子系统的总失效率 $P_{Power}$ 为 $P(A \\cup B) = P(A) + P(B) - P(A \\cap B)$。事件 $A \\cap B$ 是“(两个电源都不可用) 且 (主电源失效且切换失败)”。由于“两个电源都不可用”意味着“主电源失效”，这可以简化为“(两个电源都不可用) 且 (切换失败)”。因为切换开关与电源是独立的：\n$$P(A \\cap B) = P(A) \\cdot t = ((p_P(1-\\beta_P))^2 + p_P\\beta_P) \\cdot t$$\n合并这些项：\n$$P_{Power} = \\left[(p_P(1-\\beta_P))^2 + p_P\\beta_P\\right] + p_P t - \\left[(p_P(1-\\beta_P))^2 + p_P\\beta_P\\right] t$$\n数值计算：\n$p_{PI} = (1.5 \\times 10^{-3})(1 - 0.02) = 1.47 \\times 10^{-3}$\n$p_{PC} = (1.5 \\times 10^{-3})(0.02) = 3.0 \\times 10^{-5}$\n$P(A) = (1.47 \\times 10^{-3})^2 + 3.0 \\times 10^{-5} = 2.1609 \\times 10^{-6} + 3.0 \\times 10^{-5} = 3.21609 \\times 10^{-5}$\n$P(B) = (1.5 \\times 10^{-3})(4.0 \\times 10^{-3}) = 6.0 \\times 10^{-6}$\n$P(A \\cap B) = (3.21609 \\times 10^{-5})(4.0 \\times 10^{-3}) = 1.286436 \\times 10^{-7}$\n$$P_{Power} = 3.21609 \\times 10^{-5} + 6.0 \\times 10^{-6} - 1.286436 \\times 10^{-7} = 3.80322564 \\times 10^{-5}$$\n\n**2. 通信模块子系统 ($P_{Comm}$)**\n\n通信模块有两个冗余链路和一个主仲裁控制器。顶事件 $E_{Comm}$ 是“两个链路都不可用”($E_L$) 和“仲裁控制器失效”($E_a$) 的并集。这两个是独立事件。\n设 $p_C = 2.0 \\times 10^{-3}$ 为单个链路的失效率，$\\beta_C = 0.05$ 为 CCF 分数。\n两个链路都不可用的概率与电源的情况类似：\n$$P(E_L) = (p_C(1-\\beta_C))^2 + p_C\\beta_C$$\n控制器具有独立的失效率 $a = 1.0 \\times 10^{-3}$，因此 $P(E_a) = a$。\n子系统的失效率 $P_{Comm}$ 为 $P(E_L \\cup E_a) = P(E_L) + P(E_a) - P(E_L)P(E_a)$。\n$$P_{Comm} = \\left[(p_C(1-\\beta_C))^2 + p_C\\beta_C\\right] + a - \\left[(p_C(1-\\beta_C))^2 + p_C\\beta_C\\right]a$$\n数值计算：\n$p_{CI} = (2.0 \\times 10^{-3})(1 - 0.05) = 1.9 \\times 10^{-3}$\n$p_{CC} = (2.0 \\times 10^{-3})(0.05) = 1.0 \\times 10^{-4}$\n$P(E_L) = (1.9 \\times 10^{-3})^2 + 1.0 \\times 10^{-4} = 3.61 \\times 10^{-6} + 1.0 \\times 10^{-4} = 1.0361 \\times 10^{-4}$\n$$P_{Comm} = 1.0361 \\times 10^{-4} + 1.0 \\times 10^{-3} - (1.0361 \\times 10^{-4})(1.0 \\times 10^{-3})$$\n$$P_{Comm} = 1.10361 \\times 10^{-3} - 1.0361 \\times 10^{-7} = 1.10350639 \\times 10^{-3}$$\n\n**3. 关节编码器/表决器模块子系统 ($P_{Joint}$)**\n\n该模块对编码器使用三模冗余 (TMR)，其输出馈送给一个多数表决器。顶事件 $E_{Joint}$ 是“至少两个编码器失效”($E_{enc}$) 和“表决器失效”($E_v$) 的并集。这两个是独立事件。\n设 $p_J = 5.0 \\times 10^{-4}$ 为单个编码器的失效率，$\\beta_J = 0.10$ 为 CCF 分数。独立编码器失效的概率为 $p_{JI} = p_J(1-\\beta_J)$。我们将 CCF 项 $p_{JC} = p_J\\beta_J$ 建模为一个导致所有三个编码器都失效的事件的概率。\n如果发生 CCF 事件，或者两个编码器独立失效，或者所有三个都独立失效，则事件 $E_{enc}$ 发生。在此模型下，这些是不相交事件。\n$$P(E_{enc}) = p_{JC} + \\binom{3}{2} p_{JI}^2 (1-p_{JI}) + p_{JI}^3$$\n简化后， $P(E_{enc}) = p_{JC} + 3p_{JI}^2 - 3p_{JI}^3 + p_{JI}^3 = p_J\\beta_J + 3(p_J(1-\\beta_J))^2 - 2(p_J(1-\\beta_J))^3$。\n表决器的失效率为 $v = 8.0 \\times 10^{-4}$。\n子系统的失效率为 $P_{Joint} = P(E_{enc} \\cup E_v) = P(E_{enc}) + v - P(E_{enc})v$。\n$$P_{Joint} = \\left[p_J\\beta_J + 3(p_J(1-\\beta_J))^2 - 2(p_J(1-\\beta_J))^3\\right] + v - \\left[p_J\\beta_J + 3(p_J(1-\\beta_J))^2 - 2(p_J(1-\\beta_J))^3\\right]v$$\n数值计算：\n$p_{JI} = (5.0 \\times 10^{-4})(1 - 0.10) = 4.5 \\times 10^{-4}$\n$p_{JC} = (5.0 \\times 10^{-4})(0.10) = 5.0 \\times 10^{-5}$\n$P(E_{enc}) = 5.0 \\times 10^{-5} + 3(4.5 \\times 10^{-4})^2(1 - 4.5 \\times 10^{-4}) + (4.5 \\times 10^{-4})^3$\n$P(E_{enc}) = 5.0 \\times 10^{-5} + 3(2.025 \\times 10^{-7})(0.99955) + 9.1125 \\times 10^{-11} \\approx 5.0 \\times 10^{-5} + 6.072 \\times 10^{-7} \\approx 5.0607 \\times 10^{-5}$\n使用简化公式进行更精确的计算：\n$P(E_{enc}) = 5.0 \\times 10^{-5} + 3(4.5 \\times 10^{-4})^2 - 2(4.5 \\times 10^{-4})^3 = 5.0 \\times 10^{-5} + 6.075 \\times 10^{-7} - 1.8225 \\times 10^{-10} = 5.0607481775 \\times 10^{-5}$\n$$P_{Joint} = 5.060748 \\times 10^{-5} + 8.0 \\times 10^{-4} - (5.060748 \\times 10^{-5})(8.0 \\times 10^{-4})$$\n$$P_{Joint} = 8.5060748 \\times 10^{-4} - 4.048598 \\times 10^{-8} = 8.50566995 \\times 10^{-4}$$\n\n**4. 总不良事件概率 ($P_{AE}$)**\n\n结合各子系统的概率：\n$P_{AE} = 1 - (1 - P_{Power})(1 - P_{Comm})(1 - P_{Joint})$\n$P_{AE} = 1 - (1 - 3.80322564 \\times 10^{-5})(1 - 1.10350639 \\times 10^{-3})(1 - 8.50566995 \\times 10^{-4})$\n$P_{AE} = 1 - (0.9999619677)(0.9988964936)(0.9991494330)$\n$P_{AE} = 1 - 0.9980088916 = 0.0019911084$\n\n四舍五入到四位有效数字，总不良事件概率为 $0.001991$。\n\n**主要风险贡献者**\n\n为了确定主要贡献者，我们比较各子系统失效率的大小：\n$P_{Power} \\approx 3.80 \\times 10^{-5}$\n$P_{Comm} \\approx 1.10 \\times 10^{-3}$\n$P_{Joint} \\approx 8.51 \\times 10^{-4}$\n\n总风险约等于这些概率之和，$P_{AE} \\approx 1.99 \\times 10^{-3}$。通信模块和关节编码器/表决器模块是主要贡献者，分别约占总风险的 $55\\%$ 和 $43\\%$。电源模块的贡献很小，约为 $2\\%$。\n\n这种主导作用的原因在于子系统的架构。具有最高概率的最小割集决定了整个系统的风险。\n- 在通信模块中，冗余链路的组合失效率为 $P(E_L) \\approx 1.04 \\times 10^{-4}$。然而，单个仲裁控制器的失效率为 $a = 1.0 \\times 10^{-3}$。这个单一组件失效是一个最小割集，其概率比冗余链路失效的概率大一个数量级，因此在 $P_{Comm}$ 中占主导地位。\n- 类似地，在关节模块中，TMR 编码器系统的失效率为 $P(E_{enc}) \\approx 5.06 \\times 10^{-5}$。单个表决器的失效率为 $v = 8.0 \\times 10^{-4}$。表决器失效是一个最小割集，在 $P_{Joint}$ 中占主导地位。\n\n实质上，通信模块和关节模块的可靠性不是受其冗余组件的限制，而是受其非冗余串联组件（控制器和表决器）的限制，这些组件作为单点故障，具有相对较高的失效率。",
            "answer": "$$\\boxed{0.001991}$$"
        }
    ]
}