{
    "hands_on_practices": [
        {
            "introduction": "外科人体工程学的核心是客观评估外科医生在手术过程中承受的身体负荷。这项练习提供了一种实践方法，将原始的运动捕捉数据转化为标准化的工效学风险评分，这与像RULA这样的行业标准评估工具的原理相似。通过这个练习，你将掌握从基本运动学分析到量化评估手术姿势的核心技能，为设计更安全、更高效的手术工作环境奠定基础。",
            "id": "5183990",
            "problem": "给定在标准化腹腔镜任务中记录的关键解剖学标志点的三维运动捕捉位置，你的目标是仅基于运动学几何来计算一个简化的、受“上肢快速评估法”（RULA）启发的人体工学风险评分。使用向量微积分从标记点位置量化关节角度，然后应用明确的基于阈值的评分规则。必须为每个任务生成最终的风险等级。本问题侧重于从几何定义出发的第一性原理推导，不使用专有表格，因此是可普遍实现的。\n\n假设一个右手坐标系，其中全局向上垂直轴是单位向量 $\\hat{\\mathbf{z}}_{+} = (0,0,1)$，全局向下垂直轴是 $\\hat{\\mathbf{z}}_{-} = (0,0,-1)$，前向是 $\\hat{\\mathbf{x}}$ 轴，左右方向是 $\\hat{\\mathbf{y}}$ 轴（朝向受试者左侧为正）。所有位置均以米为单位。角度必须以度计算和表示，所有角度计算必须内部使用弧度，并在最后应用转换因子 $180/\\pi$。\n\n推导的基本依据：\n- 向量差：对于点 $\\mathbf{A}$ 和 $\\mathbf{B}$，从 $\\mathbf{A}$ 到 $\\mathbf{B}$ 的有向线段向量为 $\\mathbf{v} = \\mathbf{B} - \\mathbf{A}$。\n- 点积与角度：对于非零向量 $\\mathbf{a}$ 和 $\\mathbf{b}$，它们之间的夹角 $\\theta$ 为\n$$\n\\theta = \\arccos\\!\\left(\\frac{\\mathbf{a} \\cdot \\mathbf{b}}{\\|\\mathbf{a}\\|\\,\\|\\mathbf{b}\\|}\\right),\n$$\n其中 $\\|\\cdot\\|$ 表示欧几里得范数。由 $\\arccos(\\cdot)$ 返回的角度以弧度为单位，必须转换为度，即 $\\theta_{\\text{deg}} = \\theta \\cdot \\left(\\frac{180}{\\pi}\\right)$。\n\n计算以下节段向量和角度：\n- 上臂向量 $\\mathbf{u} = \\mathbf{E} - \\mathbf{S}$，其中 $\\mathbf{S}$ 是肩部，$\\mathbf{E}$ 是肘部。肩部抬升角 $\\theta_{UA} = \\angle(\\mathbf{u}, \\hat{\\mathbf{z}}_{-})$。\n- 前臂向量 $\\mathbf{f} = \\mathbf{W} - \\mathbf{E}$，其中 $\\mathbf{W}$ 是腕部。肘部角度 $\\theta_{EL} = \\angle(-\\mathbf{u}, \\mathbf{f})$。\n- 手部向量 $\\mathbf{h} = \\mathbf{H}_{hand} - \\mathbf{W}$，其中 $\\mathbf{H}_{hand}$ 是指尖。腕部伸展角 $\\theta_{WE} = \\angle(\\mathbf{f}, \\mathbf{h})$。腕部桡/尺偏通过水平面投影定义：$\\mathbf{f}_{xy} = (f_x, f_y, 0)$ 和 $\\mathbf{h}_{xy} = (h_x, h_y, 0)$，偏离角为 $\\theta_{WD} = \\angle(\\mathbf{f}_{xy}, \\mathbf{h}_{xy})$。\n- 躯干轴向量 $\\mathbf{t} = \\mathbf{T} - \\mathbf{P}$，其中 $\\mathbf{P}$ 是骨盆底部，$\\mathbf{T}$ 是躯干顶部。躯干屈曲角 $\\theta_{TR} = \\angle(\\mathbf{t}, \\hat{\\mathbf{z}}_{+})$。躯干侧屈角通过额状面投影计算，$\\mathbf{t}_{yz} = (0, t_y, t_z)$，其角度为 $\\theta_{LB} = \\angle(\\mathbf{t}_{yz}, \\hat{\\mathbf{z}}_{+})$。\n- 颈部屈曲向量 $\\mathbf{n} = \\mathbf{H}_{head} - \\mathbf{T}$，其中 $\\mathbf{H}_{head}$ 是头部中心。颈部屈曲角 $\\theta_{N} = \\angle(\\mathbf{n}, \\mathbf{t})$。\n- 膝部屈曲：定义大腿向量 $\\mathbf{q} = \\mathbf{H}_{hip} - \\mathbf{K}$ 和小腿向量 $\\mathbf{r} = \\mathbf{A} - \\mathbf{K}$，其中 $\\mathbf{H}_{hip}$ 是髋部，$\\mathbf{K}$ 是膝部，$\\mathbf{A}$ 是踝部。计算节段间角度 $\\theta_{\\text{knee-seg}} = \\angle(\\mathbf{q}, \\mathbf{r})$，并定义膝部屈曲为 $\\theta_{KF} = 180^\\circ - \\theta_{\\text{knee-seg}}$。\n\n应用以下基于阈值的评分规则。所有不等式均如书写所示，是精确且包含边界值的：\n\n上肢组 A：\n- 肩部抬升分 $S_{UA}$ 来自 $\\theta_{UA}$：\n  - 如果 $0^\\circ \\le \\theta_{UA} \\le 20^\\circ$：$S_{UA} = 1$。\n  - 如果 $20^\\circ  \\theta_{UA} \\le 45^\\circ$：$S_{UA} = 2$。\n  - 如果 $45^\\circ  \\theta_{UA} \\le 90^\\circ$：$S_{UA} = 3$。\n  - 如果 $\\theta_{UA} > 90^\\circ$：$S_{UA} = 4$。\n- 肘部分 $S_{EL}$ 来自 $\\theta_{EL}$：\n  - 如果 $60^\\circ \\le \\theta_{EL} \\le 100^\\circ$：$S_{EL} = 1$。\n  - 如果 $\\theta_{EL}  60^\\circ$ 或 $100^\\circ  \\theta_{EL} \\le 120^\\circ$：$S_{EL} = 2$。\n  - 如果 $\\theta_{EL} > 120^\\circ$：$S_{EL} = 3$。\n- 腕部伸展分 $S_{WE}$ 来自 $\\theta_{WE}$：\n  - 如果 $0^\\circ \\le \\theta_{WE} \\le 15^\\circ$：$S_{WE} = 1$。\n  - 如果 $15^\\circ  \\theta_{WE} \\le 30^\\circ$：$S_{WE} = 2$。\n  - 如果 $\\theta_{WE} > 30^\\circ$：$S_{WE} = 3$。\n- 腕部桡/尺偏增量 $\\Delta_{WD}$ 来自 $\\theta_{WD}$：\n  - 如果 $0^\\circ \\le \\theta_{WD} \\le 10^\\circ$：$\\Delta_{WD} = 0$。\n  - 如果 $10^\\circ  \\theta_{WD} \\le 20^\\circ$：$\\Delta_{WD} = 1$。\n  - 如果 $\\theta_{WD} > 20^\\circ$：$\\Delta_{WD} = 2$。\n- 外部负荷/重复增量 $L_a$ 来自工具质量 $m$（单位：千克）：\n  - 如果 $m \\ge 2$：$L_a = 1$。\n  - 如果 $m  2$：$L_a = 0$。\n- 上肢组得分：$A = S_{UA} + S_{EL} + S_{WE} + \\Delta_{WD} + L_a$。\n\n颈-躯干-腿部组 C：\n- 颈部屈曲分 $S_{N}$ 来自 $\\theta_{N}$：\n  - 如果 $0^\\circ \\le \\theta_{N} \\le 10^\\circ$：$S_{N} = 1$。\n  - 如果 $10^\\circ  \\theta_{N} \\le 20^\\circ$：$S_{N} = 2$。\n  - 如果 $20^\\circ  \\theta_{N} \\le 45^\\circ$：$S_{N} = 3$。\n  - 如果 $\\theta_{N} > 45^\\circ$：$S_{N} = 4$。\n- 躯干屈曲分 $S_{TR}$ 来自 $\\theta_{TR}$ 和侧屈增量 $\\Delta_{LB}$ 来自 $\\theta_{LB}$：\n  - 屈曲分 $S_{TR}$：\n    - 如果 $0^\\circ \\le \\theta_{TR} \\le 5^\\circ$：$S_{TR} = 1$。\n    - 如果 $5^\\circ  \\theta_{TR} \\le 20^\\circ$：$S_{TR} = 2$。\n    - 如果 $20^\\circ  \\theta_{TR} \\le 60^\\circ$：$S_{TR} = 3$。\n    - 如果 $\\theta_{TR} > 60^\\circ$：$S_{TR} = 4$。\n  - 侧屈增量 $\\Delta_{LB}$：\n    - 如果 $0^\\circ \\le \\theta_{LB} \\le 10^\\circ$：$\\Delta_{LB} = 0$。\n    - 如果 $\\theta_{LB} > 10^\\circ$：$\\Delta_{LB} = 1$。\n- 腿部分 $S_{LG}$ 来自膝部屈曲 $\\theta_{KF}$：\n  - 如果 $0^\\circ \\le \\theta_{KF} \\le 30^\\circ$：$S_{LG} = 1$。\n  - 如果 $\\theta_{KF} > 30^\\circ$：$S_{LG} = 2$。\n- 颈-躯干-腿部组得分：$C = S_{N} + (S_{TR} + \\Delta_{LB}) + S_{LG}$。\n\n最终综合评分和风险等级：\n- 综合评分 $S = \\max(A, C)$。\n- 风险等级 $R$ 从 $S$ 映射而来：\n  - 如果 $1 \\le S \\le 2$：$R = 1$。\n  - 如果 $3 \\le S \\le 4$：$R = 2$。\n  - 如果 $5 \\le S \\le 6$：$R = 3$。\n  - 如果 $S \\ge 7$：$R = 4$。\n每个任务仅报告最终风险等级 $R$。\n\n角度单位：度。质量单位：千克。位置单位：米。\n\n测试套件。对于每个任务 $i \\in \\{1,2,3,4\\}$，将为你提供12个三维点和一个标量质量：\n- 骨盆底部 $\\mathbf{P}$、躯干顶部 $\\mathbf{T}$、头部中心 $\\mathbf{H}_{head}$、右肩 $\\mathbf{S}$、右肘 $\\mathbf{E}$、右腕 $\\mathbf{W}$、右手指尖 $\\mathbf{H}_{hand}$、右髋 $\\mathbf{H}_{hip}$、右膝 $\\mathbf{K}$、右踝 $\\mathbf{A}$ 和工具质量 $m$。\n\n使用以下参数值：\n- 任务1（摄像头导航，近中立位）：\n  - $\\mathbf{P} = (0,\\,0,\\,1.0)$, $\\mathbf{T} = (0,\\,0,\\,1.5)$, $\\mathbf{H}_{head} = (0.05,\\,0,\\,1.7)$,\n  - $\\mathbf{S} = (0,\\,-0.2,\\,1.5)$, $\\mathbf{E} = (0,\\,-0.2,\\,1.2)$, $\\mathbf{W} = (0.2,\\,-0.2,\\,1.2)$, $\\mathbf{H}_{hand} = (0.35,\\,-0.2,\\,1.2)$,\n  - $\\mathbf{H}_{hip} = (0,\\,-0.1,\\,1.0)$, $\\mathbf{K} = (0,\\,-0.1,\\,0.55)$, $\\mathbf{A} = (0,\\,-0.1,\\,0.1)$, $m = 0.5$.\n- 任务2（缝合，抬臂和腕部伸展）：\n  - $\\mathbf{P} = (0,\\,0,\\,1.0)$, $\\mathbf{T} = (0,\\,0,\\,1.5)$, $\\mathbf{H}_{head} = (0.04,\\,0,\\,1.7)$,\n  - $\\mathbf{S} = (0,\\,-0.2,\\,1.5)$, $\\mathbf{E} = (0.144,\\,-0.2,\\,1.25)$, $\\mathbf{W} = (0.344,\\,-0.2,\\,1.25)$, $\\mathbf{H}_{hand} = (0.444,\\,-0.2,\\,1.30)$,\n  - $\\mathbf{H}_{hip} = (0,\\,-0.1,\\,1.0)$, $\\mathbf{K} = (0,\\,-0.1,\\,0.55)$, $\\mathbf{A} = (0,\\,-0.1,\\,0.1)$, $m = 0.5$.\n- 任务3（打结，颈部和躯干屈曲伴随桡偏）：\n  - $\\mathbf{P} = (0,\\,0,\\,1.0)$, $\\mathbf{T} = (0.234,\\,0,\\,1.454)$, $\\mathbf{H}_{head} = (0.534,\\,0,\\,1.504)$,\n  - $\\mathbf{S} = (0.234,\\,-0.2,\\,1.404)$, $\\mathbf{E} = (0.378,\\,-0.2,\\,1.154)$, $\\mathbf{W} = (0.578,\\,-0.2,\\,1.154)$, $\\mathbf{H}_{hand} = (0.578,\\,-0.1,\\,1.154)$,\n  - $\\mathbf{H}_{hip} = (0,\\,-0.1,\\,1.0)$, $\\mathbf{K} = (0.2,\\,-0.1,\\,0.8)$, $\\mathbf{A} = (0,\\,-0.1,\\,0.4)$, $m = 0.5$.\n- 任务4（吻合，使用重型工具并高度抬肩）：\n  - $\\mathbf{P} = (0,\\,0,\\,1.0)$, $\\mathbf{T} = (0,\\,0,\\,1.5)$, $\\mathbf{H}_{head} = (0.02,\\,0,\\,1.65)$,\n  - $\\mathbf{S} = (0,\\,-0.2,\\,1.5)$, $\\mathbf{E} = (0.25,\\,-0.2,\\,1.543)$, $\\mathbf{W} = (0.25,\\,-0.02,\\,1.543)$, $\\mathbf{H}_{hand} = (0.25,\\,0.08,\\,1.543)$,\n  - $\\mathbf{H}_{hip} = (0,\\,-0.1,\\,1.0)$, $\\mathbf{K} = (0,\\,-0.1,\\,0.55)$, $\\mathbf{A} = (0,\\,-0.1,\\,0.1)$, $m = 2.5$.\n\n你的程序必须计算四个任务中每个任务的风险等级 $R$，并生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[r_1,r_2,r_3,r_4]$），其中每个 $r_i$ 是 $\\{1,2,3,4\\}$ 中的一个整数。",
            "solution": "该问题被评估为有效。它在向量运动学和生物力学方面有科学依据，是适定的，具有从输入到唯一输出的清晰、确定性路径，并且其定义和规则是客观的。所有必要的数据和公式都已提供，其设置内部一致且没有矛盾，只有一个小例外。\n\n评分规则规定，中间得分 $A$ 和 $C$ 的最小可能值为 $3$（因为 $A = S_{UA} + S_{EL} + S_{WE} + \\Delta_{WD} + L_a \\ge 1+1+1+0+0 = 3$ 且 $C = S_{N} + (S_{TR} + \\Delta_{LB}) + S_{LG} \\ge 1+1+0+1 = 3$）。因此，最终综合评分 $S = \\max(A, C)$ 必须至少为 $3$。用于确定风险等级 $R$ 的规则“如果 $1 \\le S \\le 2$：$R = 1$” 定义了一个永远无法满足的关于 $S$ 的条件。这是一个微小的不一致，但并不会使问题无效，因为所有可达到的分数 $S$ 都落入其他定义明确的类别中，从而允许为给定的测试用例计算出唯一且正确的解。\n\n解决方案通过分步实现指定的计算来推进。\n\n**1. 向量和角度计算**\n运动学分析的核心是计算指定身体节段向量之间的角度。对于任意两个非零向量 $\\mathbf{a}$ 和 $\\mathbf{b}$，它们之间的夹角 $\\theta$ 使用点积公式计算：\n$$\n\\theta = \\arccos\\left(\\frac{\\mathbf{a} \\cdot \\mathbf{b}}{\\|\\mathbf{a}\\| \\|\\mathbf{b}\\|}\\right)\n$$\n$\\arccos$ 函数的结果以弧度为单位，必须通过乘以 $\\frac{180}{\\pi}$ 转换为度。为确保数值稳定性，$\\arccos$ 的参数被裁剪到 $[-1, 1]$ 范围内。在投影向量（例如 $\\mathbf{f}_{xy}$）变为零向量的情况下，所得角度定义为 $0^\\circ$。\n\n对每个任务数据集按如下方式计算特定的向量和角度，数据集提供了点 $\\mathbf{P}$ (骨盆)、$\\mathbf{T}$ (躯干顶部)、$\\mathbf{H}_{head}$ (头部中心)、$\\mathbf{S}$ (肩部)、$\\mathbf{E}$ (肘部)、$\\mathbf{W}$ (腕部)、$\\mathbf{H}_{hand}$ (指尖)、$\\mathbf{H}_{hip}$ (髋部)、$\\mathbf{K}$ (膝部)、$\\mathbf{A}$ (踝部) 的三维坐标和工具质量 $m$。全局向上和向下垂直向量分别为 $\\hat{\\mathbf{z}}_{+} = (0,0,1)$ 和 $\\hat{\\mathbf{z}}_{-} = (0,0,-1)$。\n\n- **上臂：** $\\mathbf{u} = \\mathbf{E} - \\mathbf{S}$。肩部抬升角 $\\theta_{UA} = \\angle(\\mathbf{u}, \\hat{\\mathbf{z}}_{-})$。\n- **前臂：** $\\mathbf{f} = \\mathbf{W} - \\mathbf{E}$。肘部角度 $\\theta_{EL} = \\angle(-\\mathbf{u}, \\mathbf{f})$。\n- **手部：** $\\mathbf{h} = \\mathbf{H}_{hand} - \\mathbf{W}$。腕部伸展角 $\\theta_{WE} = \\angle(\\mathbf{f}, \\mathbf{h})$。对于腕部偏离，向量被投影到水平面上：$\\mathbf{f}_{xy} = (f_x, f_y, 0)$ 和 $\\mathbf{h}_{xy} = (h_x, h_y, 0)$。角度为 $\\theta_{WD} = \\angle(\\mathbf{f}_{xy}, \\mathbf{h}_{xy})$。\n- **躯干：** $\\mathbf{t} = \\mathbf{T} - \\mathbf{P}$。躯干屈曲角 $\\theta_{TR} = \\angle(\\mathbf{t}, \\hat{\\mathbf{z}}_{+})$。对于侧屈，向量被投影到额状面上：$\\mathbf{t}_{yz} = (0, t_y, t_z)$。角度为 $\\theta_{LB} = \\angle(\\mathbf{t}_{yz}, \\hat{\\mathbf{z}}_{+})$。\n- **颈部：** $\\mathbf{n} = \\mathbf{H}_{head} - \\mathbf{T}$。颈部屈曲角 $\\theta_{N} = \\angle(\\mathbf{n}, \\mathbf{t})$。\n- **腿部：** 大腿向量 $\\mathbf{q} = \\mathbf{H}_{hip} - \\mathbf{K}$ 和小腿向量 $\\mathbf{r} = \\mathbf{A} - \\mathbf{K}$。节段间角度为 $\\theta_{\\text{knee-seg}} = \\angle(\\mathbf{q}, \\mathbf{r})$。膝部屈曲则为 $\\theta_{KF} = 180^\\circ - \\theta_{\\text{knee-seg}}$。\n\n**2. 人体工学评分计算**\n一旦所有角度都以度为单位计算出来，就应用指定的基于阈值的规则来确定各部分得分，然后将这些得分相加得到组得分 $A$ 和 $C$。\n\n**上肢组得分 ($A$)**\n- 肩部抬升分 $S_{UA}$ 由 $\\theta_{UA}$ 决定。\n- 肘部分 $S_{EL}$ 由 $\\theta_{EL}$ 决定。\n- 腕部伸展分 $S_{WE}$ 由 $\\theta_{WE}$ 决定。\n- 腕部偏离增量 $\\Delta_{WD}$ 由 $\\theta_{WD}$ 决定。\n- 负荷增量 $L_a$ 在 $m \\ge 2$ 时为 $1$，否则为 $0$。\n- 组得分为总和：$A = S_{UA} + S_{EL} + S_{WE} + \\Delta_{WD} + L_a$。\n\n**颈-躯干-腿部组得分 ($C$)**\n- 颈部屈曲分 $S_{N}$ 由 $\\theta_{N}$ 决定。\n- 躯干屈曲分 $S_{TR}$ 由 $\\theta_{TR}$ 决定。\n- 躯干侧屈增量 $\\Delta_{LB}$ 由 $\\theta_{LB}$ 决定。\n- 腿部分 $S_{LG}$ 由 $\\theta_{KF}$ 决定。\n- 组得分为总和：$C = S_{N} + (S_{TR} + \\Delta_{LB}) + S_{LG}$。\n\n**3. 最终风险等级确定**\n最终综合评分 $S$ 是两个组得分中的最大值：$S = \\max(A, C)$。然后根据提供的阈值将此分数映射到最终风险等级 $R \\in \\{1, 2, 3, 4\\}$：\n- 如果 $1 \\le S \\le 2$：$R = 1$ (如前所述，不可达)。\n- 如果 $3 \\le S \\le 4$：$R = 2$。\n- 如果 $5 \\le S \\le 6$：$R = 3$。\n- 如果 $S \\ge 7$：$R = 4$。\n\n将此完整流程应用于四个测试用例中的每一个，以生成最终的风险等级列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases and print the final results.\n    \"\"\"\n    \n    # Define global coordinate system vectors\n    Z_PLUS = np.array([0.0, 0.0, 1.0])\n    Z_MINUS = np.array([0.0, 0.0, -1.0])\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        { # Task 1\n            \"P\": np.array([0.0, 0.0, 1.0]), \"T\": np.array([0.0, 0.0, 1.5]), \"H_head\": np.array([0.05, 0.0, 1.7]),\n            \"S\": np.array([0.0, -0.2, 1.5]), \"E\": np.array([0.0, -0.2, 1.2]), \"W\": np.array([0.2, -0.2, 1.2]),\n            \"H_hand\": np.array([0.35, -0.2, 1.2]), \"H_hip\": np.array([0.0, -0.1, 1.0]), \"K\": np.array([0.0, -0.1, 0.55]),\n            \"A\": np.array([0.0, -0.1, 0.1]), \"m\": 0.5\n        },\n        { # Task 2\n            \"P\": np.array([0.0, 0.0, 1.0]), \"T\": np.array([0.0, 0.0, 1.5]), \"H_head\": np.array([0.04, 0.0, 1.7]),\n            \"S\": np.array([0.0, -0.2, 1.5]), \"E\": np.array([0.144, -0.2, 1.25]), \"W\": np.array([0.344, -0.2, 1.25]),\n            \"H_hand\": np.array([0.444, -0.2, 1.30]), \"H_hip\": np.array([0.0, -0.1, 1.0]), \"K\": np.array([0.0, -0.1, 0.55]),\n            \"A\": np.array([0.0, -0.1, 0.1]), \"m\": 0.5\n        },\n        { # Task 3\n            \"P\": np.array([0.0, 0.0, 1.0]), \"T\": np.array([0.234, 0.0, 1.454]), \"H_head\": np.array([0.534, 0.0, 1.504]),\n            \"S\": np.array([0.234, -0.2, 1.404]), \"E\": np.array([0.378, -0.2, 1.154]), \"W\": np.array([0.578, -0.2, 1.154]),\n            \"H_hand\": np.array([0.578, -0.1, 1.154]), \"H_hip\": np.array([0.0, -0.1, 1.0]), \"K\": np.array([0.2, -0.1, 0.8]),\n            \"A\": np.array([0.0, -0.1, 0.4]), \"m\": 0.5\n        },\n        { # Task 4\n            \"P\": np.array([0.0, 0.0, 1.0]), \"T\": np.array([0.0, 0.0, 1.5]), \"H_head\": np.array([0.02, 0.0, 1.65]),\n            \"S\": np.array([0.0, -0.2, 1.5]), \"E\": np.array([0.25, -0.2, 1.543]), \"W\": np.array([0.25, -0.02, 1.543]),\n            \"H_hand\": np.array([0.25, 0.08, 1.543]), \"H_hip\": np.array([0.0, -0.1, 1.0]), \"K\": np.array([0.0, -0.1, 0.55]),\n            \"A\": np.array([0.0, -0.1, 0.1]), \"m\": 2.5\n        }\n    ]\n\n    def angle_between_vectors(v1, v2):\n        \"\"\"Computes the angle between two vectors in degrees.\"\"\"\n        norm_v1 = np.linalg.norm(v1)\n        norm_v2 = np.linalg.norm(v2)\n        if norm_v1 == 0 or norm_v2 == 0:\n            return 0.0\n        \n        dot_product = np.dot(v1, v2)\n        cos_theta = dot_product / (norm_v1 * norm_v2)\n        # Clip to handle potential floating-point inaccuracies\n        cos_theta = np.clip(cos_theta, -1.0, 1.0)\n        \n        theta_rad = np.arccos(cos_theta)\n        return np.rad2deg(theta_rad)\n\n    def calculate_risk(case):\n        \"\"\"Calculates the ergonomic risk level for a single task.\"\"\"\n        # 1. Compute segment vectors\n        u = case[\"E\"] - case[\"S\"]     # Upper arm\n        f = case[\"W\"] - case[\"E\"]     # Forearm\n        h = case[\"H_hand\"] - case[\"W\"] # Hand\n        t = case[\"T\"] - case[\"P\"]       # Torso\n        n = case[\"H_head\"] - case[\"T\"] # Neck\n        q = case[\"H_hip\"] - case[\"K\"] # Thigh\n        r = case[\"A\"] - case[\"K\"]       # Shank\n\n        # 2. Compute angles\n        theta_UA = angle_between_vectors(u, Z_MINUS)\n        theta_EL = angle_between_vectors(-u, f)\n        theta_WE = angle_between_vectors(f, h)\n        \n        f_xy = np.array([f[0], f[1], 0.0])\n        h_xy = np.array([h[0], h[1], 0.0])\n        theta_WD = angle_between_vectors(f_xy, h_xy)\n\n        theta_TR = angle_between_vectors(t, Z_PLUS)\n        t_yz = np.array([0.0, t[1], t[2]])\n        theta_LB = angle_between_vectors(t_yz, Z_PLUS)\n        \n        theta_N = angle_between_vectors(n, t)\n        \n        theta_knee_seg = angle_between_vectors(q, r)\n        theta_KF = 180.0 - theta_knee_seg\n\n        # 3. Compute Group A score\n        if 0 = theta_UA = 20: S_UA = 1\n        elif 20  theta_UA = 45: S_UA = 2\n        elif 45  theta_UA = 90: S_UA = 3\n        else: S_UA = 4\n\n        if 60 = theta_EL = 100: S_EL = 1\n        elif theta_EL  60 or (100  theta_EL = 120): S_EL = 2\n        else: S_EL = 3\n        \n        if 0 = theta_WE = 15: S_WE = 1\n        elif 15  theta_WE = 30: S_WE = 2\n        else: S_WE = 3\n\n        if 0 = theta_WD = 10: Delta_WD = 0\n        elif 10  theta_WD = 20: Delta_WD = 1\n        else: Delta_WD = 2\n\n        L_a = 1 if case[\"m\"] >= 2 else 0\n        \n        A = S_UA + S_EL + S_WE + Delta_WD + L_a\n\n        # 4. Compute Group C score\n        if 0 = theta_N = 10: S_N = 1\n        elif 10  theta_N = 20: S_N = 2\n        elif 20  theta_N = 45: S_N = 3\n        else: S_N = 4\n\n        if 0 = theta_TR = 5: S_TR = 1\n        elif 5  theta_TR = 20: S_TR = 2\n        elif 20  theta_TR = 60: S_TR = 3\n        else: S_TR = 4\n        \n        Delta_LB = 1 if theta_LB > 10 else 0\n        \n        S_LG = 2 if theta_KF > 30 else 1\n\n        C = S_N + (S_TR + Delta_LB) + S_LG\n\n        # 5. Final composite score and risk level\n        S_final = max(A, C)\n\n        if 3 = S_final = 4: R = 2\n        elif 5 = S_final = 6: R = 3\n        elif S_final >= 7: R = 4\n        else: # Covers the unreachable 1 = S = 2 case\n            R = 1 \n        \n        return R\n\n    results = [calculate_risk(case) for case in test_cases]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一旦我们能够量化手术表现或人体工效学风险，就必须确保我们的测量结果是可靠的。这项练习深入探讨了经典测试理论（Classical Test Theory, CTT），这是一个评估测量一致性的基本框架。你将通过推导和应用斯皮尔曼-布朗预言公式（Spearman–Brown prophecy formula），来确定需要多少次重复试验才能达到期望的信度水平，这对于在外科模拟训练中开发稳健的评估工具至关重要。",
            "id": "5183921",
            "problem": "一项系统性外科手术的培训项目使用高保真腹腔镜缝合模拟器，通过对重复试验计算的无加权平均复合指标来评估双手灵巧度。设 $X_{i}$ 表示第 $i$ 次试验的观测分数，并假设试验是可交换的，且满足经典测量理论 (CTT) 的假设，即每个观测分数可分解为 $X_{i} = T + E_{i}$，其中 $T$ 是参与者在所有试验中共同的真实灵巧度分数，$E_{i}$ 是独立的误差项，满足 $\\mathbb{E}[E_{i}] = 0$，对所有 $i$ 都有 $\\mathrm{Var}(E_{i}) = \\sigma_{E}^{2}$，且 $E_{i}$ 与 $T$ 不相关。进一步假设试验是平行测量，因此 $\\mathrm{Var}(X_{i}) = \\sigma_{T}^{2} + \\sigma_{E}^{2}$ 在所有试验中均相同，且对于 $i \\neq j$ 有 $\\mathrm{Cov}(X_{i}, X_{j}) = \\sigma_{T}^{2}$。\n\n仅使用所述模型假设和经典测量理论中信度 $r = \\mathrm{Var}(T)/\\mathrm{Var}(X)$ 的定义，从第一性原理推导 Spearman–Brown 预言公式。该公式给出了由 $k$ 次平行试验平均形成的复合指标的信度 $R_{k}$，作为 $k$ 和单次试验信度 $r$ 的函数。然后，给定试点数据表明复合指标相邻试验间的跨试验皮尔逊相关系数为 $0.37$（这与平行试验的假设一致，因此该相关系数等于单次试验信度 $r$），确定最小的正整数 $k$，使得 $k$ 次试验复合指标的信度（以克朗巴赫系数 $\\alpha$ 表示）满足 $\\alpha \\ge 0.8$。\n\n将最终的 $k$ 以单一整数形式报告。不需要单位，除了选择满足标准的最小整数外，无需四舍五入到有效数字。",
            "solution": "经评估，问题陈述有效。其科学基础是经典测量理论 (CTT)，一个标准的心理测量学框架。所有术语都有明确定义，并提供了推导所求公式和求解未知参数所需的数据和假设。该问题是自洽、一致且客观的。\n\n解答过程分为两部分。首先，我们按要求从第一性原理推导 Spearman–Brown 预言公式。其次，我们使用该公式计算达到所需信度所需的最小试验次数。\n\n**第一部分：Spearman–Brown 预言公式的推导**\n\n设 $X_i$ 为第 $i$ 次试验的观测分数。根据所提供的经典测量理论模型，$X_i = T + E_i$，其中 $T$ 是真实分数，$E_i$ 是测量误差。试验是平行的，这意味着：\n1.  对于给定参与者，所有试验的真实分数 $T$ 相同。\n2.  误差项的均值为零，$\\mathbb{E}[E_i] = 0$。\n3.  误差项的方差在所有试验中恒定，$\\mathrm{Var}(E_i) = \\sigma_E^2$。\n4.  误差项之间以及误差项与真实分数之间不相关，即对于 $i \\neq j$ 有 $\\mathrm{Cov}(E_i, E_j) = 0$ 且 $\\mathrm{Cov}(T, E_i) = 0$。\n5.  观测分数的方差在所有试验中恒定，$\\mathrm{Var}(X_i) = \\sigma_X^2 = \\mathrm{Var}(T) + \\mathrm{Var}(E_i) = \\sigma_T^2 + \\sigma_E^2$。\n6.  任意两次不同试验分数之间的协方差是真实分数的方差，即对于 $i \\neq j$ 有 $\\mathrm{Cov}(X_i, X_j) = \\mathrm{Cov}(T+E_i, T+E_j) = \\mathrm{Var}(T) + \\mathrm{Cov}(T,E_j) + \\mathrm{Cov}(E_i,T) + \\mathrm{Cov}(E_i,E_j) = \\sigma_T^2$。\n\n复合指标是 $k$ 次试验的无加权平均值。我们用 $X_k^*$ 表示这个复合分数。\n$$X_k^* = \\frac{1}{k} \\sum_{i=1}^{k} X_i$$\n这个复合分数的信度，记为 $R_k$，定义为真实分数方差与观测复合分数方差之比。复合分数的真实分数仍然是 $T$。\n$$R_k = \\frac{\\mathrm{Var}(T)}{\\mathrm.Var}(X_k^*)} = \\frac{\\sigma_T^2}{\\mathrm.Var}(X_k^*)}$$\n我们必须求出复合分数的方差 $\\mathrm{Var}(X_k^*)$。\n$$\\mathrm{Var}(X_k^*) = \\mathrm{Var}\\left(\\frac{1}{k} \\sum_{i=1}^{k} X_i\\right) = \\frac{1}{k^2} \\mathrm{Var}\\left(\\sum_{i=1}^{k} X_i\\right)$$\n一组随机变量之和的方差等于它们方差之和加上所有唯一配对协方差之和的两倍。\n$$\\mathrm{Var}\\left(\\sum_{i=1}^{k} X_i\\right) = \\sum_{i=1}^{k} \\mathrm{Var}(X_i) + \\sum_{i \\neq j} \\mathrm{Cov}(X_i, X_j)$$\n这里有 $k$ 个方差项和 $k(k-1)$ 个协方差项。使用平行试验的假设：\n$$\\mathrm{Var}\\left(\\sum_{i=1}^{k} X_i\\right) = k \\cdot \\mathrm{Var}(X_i) + k(k-1) \\cdot \\mathrm{Cov}(X_i, X_j) = k \\sigma_X^2 + k(k-1) \\sigma_T^2$$\n代入 $\\sigma_X^2 = \\sigma_T^2 + \\sigma_E^2$：\n$$\\mathrm{Var}\\left(\\sum_{i=1}^{k} X_i\\right) = k(\\sigma_T^2 + \\sigma_E^2) + k(k-1)\\sigma_T^2 = k\\sigma_T^2 + k\\sigma_E^2 + k^2\\sigma_T^2 - k\\sigma_T^2 = k^2\\sigma_T^2 + k\\sigma_E^2$$\n现在我们可以计算 $\\mathrm{Var}(X_k^*)$：\n$$\\mathrm{Var}(X_k^*) = \\frac{1}{k^2} (k^2\\sigma_T^2 + k\\sigma_E^2) = \\sigma_T^2 + \\frac{\\sigma_E^2}{k}$$\n因此，复合分数的信度为：\n$$R_k = \\frac{\\sigma_T^2}{\\sigma_T^2 + \\frac{\\sigma_E^2}{k}}$$\n为了将 $R_k$ 表示为单次试验信度 $r$ 的函数，我们使用定义 $r = \\mathrm{Var}(T)/\\mathrm{Var}(X)$。\n$$r = \\frac{\\sigma_T^2}{\\sigma_T^2 + \\sigma_E^2}$$\n由此，我们可以用 $r$ 来表示误差方差与真实分数方差之比：\n$$\\frac{1}{r} = \\frac{\\sigma_T^2 + \\sigma_E^2}{\\sigma_T^2} = 1 + \\frac{\\sigma_E^2}{\\sigma_T^2} \\implies \\frac{\\sigma_E^2}{\\sigma_T^2} = \\frac{1}{r} - 1 = \\frac{1-r}{r}$$\n因此，$\\sigma_E^2 = \\sigma_T^2 \\frac{1-r}{r}$。将此代入 $R_k$ 的表达式中：\n$$R_k = \\frac{\\sigma_T^2}{\\sigma_T^2 + \\frac{1}{k} \\left(\\sigma_T^2 \\frac{1-r}{r}\\right)} = \\frac{\\sigma_T^2}{\\sigma_T^2 \\left(1 + \\frac{1-r}{kr}\\right)}$$\n消去 $\\sigma_T^2$ 项并化简复合分数：\n$$R_k = \\frac{1}{1 + \\frac{1-r}{kr}} = \\frac{1}{\\frac{kr + 1 - r}{kr}} = \\frac{kr}{1 + (k-1)r}$$\n这就是 Spearman–Brown 预言公式，它给出了由 $k$ 次平行试验构成的复合指标的信度，作为 $k$ 和单次试验信度 $r$ 的函数。\n\n**第二部分：试验次数的计算**\n\n问题陈述，试点数据显示相邻试验间的相关性为 $0.37$。根据平行试验的假设，任意两次试验间的相关性等于单次试验信度 $r$。因此，$r = 0.37$。\n\n问题还陈述，$k$ 次试验复合指标的信度以克朗巴赫系数 $\\alpha$ 表示。对于平行试验，克朗巴赫系数等价于由 Spearman–Brown 预言公式给出的信度。因此，我们可以设定 $\\alpha = R_k$。\n\n我们需要找到满足 $\\alpha \\ge 0.8$ 的最小正整数 $k$。\n$$R_k = \\frac{kr}{1 + (k-1)r} \\ge 0.8$$\n代入 $r = 0.37$：\n$$\\frac{k(0.37)}{1 + (k-1)(0.37)} \\ge 0.8$$\n$$\\frac{0.37k}{1 + 0.37k - 0.37} \\ge 0.8$$\n$$\\frac{0.37k}{0.63 + 0.37k} \\ge 0.8$$\n由于 $k$ 是一个正整数，分母 $0.63 + 0.37k$ 是正数。我们可以在不等式两边同乘以分母而不改变不等号的方向。\n$$0.37k \\ge 0.8 (0.63 + 0.37k)$$\n$$0.37k \\ge 0.504 + 0.296k$$\n现在，我们求解 $k$：\n$$0.37k - 0.296k \\ge 0.504$$\n$$0.074k \\ge 0.504$$\n$$k \\ge \\frac{0.504}{0.074}$$\n$$k \\ge 6.81081...$$\n由于 $k$ 必须是正整数，满足此条件的最小整数值为 $7$。信度必须在至少 $7$ 次试验中测量才能达到 $\\alpha \\ge 0.8$ 的目标。",
            "answer": "$$\\boxed{7}$$"
        },
        {
            "introduction": "除了评估个人表现，人因工程学的最终目标是提升整个外科系统的安全性。本练习介绍了失效模式与效应分析（Failure Modes and Effects Analysis, FMEA），这是一种系统化的前瞻性风险管理方法，用于识别潜在的系统失效、量化其风险并确定改进的优先顺序。你将学习如何运用这一强大工具，在资源有限的情况下做出数据驱动的决策，以最有效的方式提高手术室的安全性。",
            "id": "5184059",
            "problem": "为研究人因工程学和人体工程学对可靠性的影响，我们对手术室(OR)器械准备过程进行了高保真基于仿真的流程分析。该研究旨在构建一个故障模式与影响分析 (FMEA)，以便在固定资源预算下对缓解措施进行优先级排序。FMEA 对严重性、发生率和检测难度使用序数标度，每个指标的评级从 $1$（最佳）到 $10$（最差）。对于每种故障模式，严重性分数 $S$ 估计了故障发生时对患者的伤害程度，发生率分数 $O$ 根据仿真中观察到的频率和人体工程学压力源来近似故障在准备过程中发生的可能性，而检测难度分数 $D$ 代表了在对患者产生影响之前检测到该故障的难度。请从第一性原理出发，基于风险作为不确定性下预期损失以及检测性作为先发风险控制的核心定义，推导出适用于序数标度的 FMEA 风险评分指标，然后将其应用于以下故障模式和候选缓解措施。\n\n基线故障模式（分数源自仿真日志和人因工程学评估）：\n\n- 故障模式 $1$ (FM$1$)：电动驱动器扭矩校准错误。基线分数：$S_{1}=8$, $O_{1}=4$, $D_{1}=7$。\n- 故障模式 $2$ (FM$2$)：托盘中缺少腹腔镜施夹钳。基线分数：$S_{2}=6$, $O_{2}=5$, $D_{2}=5$。\n- 故障模式 $3$ (FM$3$)：因包装损坏导致的无菌状态破坏。基线分数：$S_{3}=9$, $O_{3}=3$, $D_{3}=6$。\n\n候选缓解措施（资源成本及其对序数分数的影响根据仿真干预和人体工程学重新设计原型估算）：\n\n- 缓解措施 $M_{1}$（术前校准双重检查），资源成本 $c_{1}=3$：对于 FM$1$，使 $O_{1}$ 降低 $2$ 分，使 $D_{1}$ 降低 $2$ 分。\n- 缓解措施 $M_{2}$（使用条形码验证的托盘配套），资源成本 $c_{2}=4$：对于 FM$2$，使 $O_{2}$ 降低 $3$ 分，使 $D_{2}$ 降低 $2$ 分。\n- 缓解措施 $M_{3}$（无菌完整性压力衰减测试），资源成本 $c_{3}=5$：对于 FM$3$，使 $O_{3}$ 降低 $2$ 分，使 $D_{3}$ 降低 $3$ 分。\n\n假设缓解措施仅影响指定的故障模式，并且是可加的，即应用某项缓解措施会使相应的 $O$ 和 $D$ 分数相对于基线值发生所述数量的变化，且分数下限为 $1$。你的资源预算为 $B=7$ 个单位，你可以选择总成本不超过 $B$ 的任意缓解措施子集。\n\n使用推导出的 FMEA 风险评分指标，计算三种故障模式的汇总基线风险，并为预算约束下每个可行的缓解措施组合计算缓解后的汇总风险。然后，确定在所有可行组合中，汇总风险可实现的最大降低量。\n\n最终答案以单个精确整数形式提供，该整数等于在预算约束下三种故障模式汇总风险指标可实现的最大降低量。无需四舍五入，也无需报告单位。",
            "solution": "该问题被评估为有效，因为它在风险管理理论（失效模式与效应分析，FMEA）方面具有科学依据，并且是适定、客观的。所有必要的数据和约束都已清晰提供。\n\n**1. FMEA风险优先级数（RPN）的推导**\n风险优先级数（RPN）是FMEA中用于量化风险的标准指标。其推导基于风险的基本定义：风险是潜在危害的严重性（Severity, S）、其发生的可能性（Occurrence, O）以及在造成危害前未能检测到它的可能性（Detection, D）的函数。\n- **严重性 (S):** 代表如果故障发生，对患者造成的伤害程度。\n- **发生率 (O):** 代表故障发生的频率或可能性。\n- **检测难度 (D):** 代表在故障影响到最终用户（患者）之前，有多大可能无法检测到该故障。高D值意味着低检测率。\n\n因此，一个未被检测到的故障所带来的风险，即风险优先级数，被定义为这三个因素的乘积：\n$$ \\text{RPN} = S \\times O \\times D $$\n对于一个包含多种独立故障模式的系统，其总风险可以近似为所有单个故障模式RPN的总和：\n$$ \\text{RPN}_{\\text{汇总}} = \\sum_{i} (S_i \\times O_i \\times D_i) $$\n这个推导出的指标将用于后续计算。\n\n**2. 基线风险计算**\n首先，计算每个故障模式的基线RPN：\n- FM1: $R_{1, \\text{基线}} = 8 \\times 4 \\times 7 = 224$\n- FM2: $R_{2, \\text{基线}} = 6 \\times 5 \\times 5 = 150$\n- FM3: $R_{3, \\text{基线}} = 9 \\times 3 \\times 6 = 162$\n汇总基线风险为：\n$$ R_{\\text{汇总, 基线}} = 224 + 150 + 162 = 536 $$\n\n**3. 可行缓解措施组合分析**\n总预算为 $B=7$。缓解措施的成本为 $c_{1}=3, c_{2}=4, c_{3}=5$。可行的组合及其成本为：\n- $\\{M_1\\}$: 成本 3\n- $\\{M_2\\}$: 成本 4\n- $\\{M_3\\}$: 成本 5\n- $\\{M_1, M_2\\}$: 成本 $3+4=7$\n其他组合（如 $\\{M_1, M_3\\}$）超出预算。\n\n现在，为每个可行组合计算缓解后的风险和风险降低量 ($\\Delta R$)。\n\n- **组合 $\\{M_1\\}$ (成本 3):**\n  - FM1的新分数为: $O_1' = 4-2=2$, $D_1' = 7-2=5$。\n  - 新的 $R_1' = 8 \\times 2 \\times 5 = 80$。\n  - 风险降低量: $\\Delta R_{\\{M_1\\}} = 224 - 80 = 144$。\n\n- **组合 $\\{M_2\\}$ (成本 4):**\n  - FM2的新分数为: $O_2' = 5-3=2$, $D_2' = 5-2=3$。\n  - 新的 $R_2' = 6 \\times 2 \\times 3 = 36$。\n  - 风险降低量: $\\Delta R_{\\{M_2\\}} = 150 - 36 = 114$。\n\n- **组合 $\\{M_3\\}$ (成本 5):**\n  - FM3的新分数为: $O_3' = 3-2=1$, $D_3' = 6-3=3$。\n  - 新的 $R_3' = 9 \\times 1 \\times 3 = 27$。\n  - 风险降低量: $\\Delta R_{\\{M_3\\}} = 162 - 27 = 135$。\n\n- **组合 $\\{M_1, M_2\\}$ (成本 7):**\n  - 此组合同时缓解FM1和FM2。总风险降低量是各项降低量之和。\n  - 总风险降低量: $\\Delta R_{\\{M_1, M_2\\}} = \\Delta R_{\\{M_1\\}} + \\Delta R_{\\{M_2\\}} = 144 + 114 = 258$。\n\n**4. 确定最大风险降低量**\n比较所有可行组合的风险降低量：\n- $\\Delta R_{\\{M_1\\}} = 144$\n- $\\Delta R_{\\{M_2\\}} = 114$\n- $\\Delta R_{\\{M_3\\}} = 135$\n- $\\Delta R_{\\{M_1, M_2\\}} = 258$\n在预算约束下，可实现的最大风险降低量是 $258$。",
            "answer": "$$\\boxed{258}$$"
        }
    ]
}