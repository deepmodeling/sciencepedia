{
    "hands_on_practices": [
        {
            "introduction": "在亚硫酸氢盐测序中，我们观察到的数据并不能直接等同于生物学真实情况。本练习将从第一性原理出发，构建一个全面的概率模型，以揭示实验过程中的各种技术误差（如不完全的化学转换和测序错误）如何系统性地影响并扭曲原始的甲基化测量结果。通过推导真实的甲基化比例与观测值之间的数学关系，你将深刻理解为何计算校正是生物信息学分析流程中不可或缺的一环 。",
            "id": "4544156",
            "problem": "进行了一项全基因组亚硫酸氢盐测序 (WGBS) 实验，以估算单个胞嘧啶-磷酸-鸟嘌呤 (CpG) 位点的 DNA 甲基化比例。在亚硫酸氢盐处理中，未甲基化的胞嘧啶被化学转化为尿嘧啶（在聚合酶链式反应扩增后被读取为胸腺嘧啶），而 5-甲基胞嘧啶 (5mC) 在很大程度上抵抗转化并保持为胞嘧啶。考虑以下针对单个 CpG 位点的随机模型：\n\n- 设 CpG 位点的真实甲基化比例为 $p \\in [0,1]$。\n- 对于未甲基化的胞嘧啶，亚硫酸氢盐独立地以概率 $e \\in (0,1)$ 转化为胸腺嘧啶，而未转化（非转化）的概率为 $1-e$。\n- 对于甲基化的胞嘧啶 (5mC)，错误地转化为胸腺嘧啶的概率为 $\\delta \\in [0,1)$，而保持为胞嘧啶的概率为 $1-\\delta$。\n- 在测序过程中，碱基识别错误是独立的，将胞嘧啶分子识别为胸腺嘧啶的概率为 $\\epsilon_{CT}$，将胸腺嘧啶分子识别为胞嘧啶的概率为 $\\epsilon_{TC}$。\n\n经过比对和质量过滤后，观测甲基化比例定义为在 CpG 位点报告为胞嘧啶的测序读数的比例，记为 $m_{\\text{obs}} \\in [0,1]$。\n\n仅从上述定义和全概率定律出发，推导 $m_{\\text{obs}}$ 作为 $p$, $e$, $\\delta$, $\\epsilon_{CT}$ 和 $\\epsilon_{TC}$ 的函数表达式。然后，使用测量值 $m_{\\text{obs}} = 0.40$ 和实验校准的参数 $e = 0.98$, $\\delta = 0.002$, $\\epsilon_{CT} = 0.001$ 及 $\\epsilon_{TC} = 0.0015$，求解真实甲基化比例 $p$。\n\n接下来，通过将不完全转化下的观测比例与其在完全转化下的假设值进行比较，量化观测甲基化比例中仅由不完全转化引起的加性偏差。形式上，将不完全转化影响定义为\n$$I \\equiv m_{\\text{obs}}(e) - m_{\\text{obs}}(1),$$\n其中 $m_{\\text{obs}}(1)$ 表示在假设极限 $e=1$ 且所有其他参数保持不变的情况下的观测比例。推导 $I$ 关于 $p$, $e$, $\\epsilon_{CT}$ 和 $\\epsilon_{TC}$ 的表达式，并使用相同的参数和您对 $p$ 的估计值对其进行数值计算。\n\n将估计的真实甲基化比例 $p$ 和不完全转化影响 $I$ 均以十进制数报告，各自四舍五入到四位有效数字。无需单位。",
            "solution": "首先验证该问题，以确保其具有科学依据、是良定的和客观的。该问题描述了用于分析全基因组亚硫酸氢盐测序 (WGBS) 数据的标准概率模型，这是表观遗传学中的一项核心技术。参数 ($p, e, \\delta, \\epsilon_{CT}, \\epsilon_{TC}$) 代表了定义明确且符合实际的现象：真实甲基化水平、亚硫酸氢盐转化效率、对甲基化胞嘧啶的保护以及测序错误率。给定值对于真实实验是合理的。该问题是自洽的，提供了推导所需表达式和求解未知量的所有必要信息。这是一个应用概率论和生物信息学领域的可形式化问题，没有科学或事实上的不健全、模糊性或矛盾。因此，该问题被认为是有效的，下面提供了完整的解决方案。\n\n观测到的甲基化比例 $m_{\\text{obs}}$ 是在 CpG 位点随机选择的一个测序读数报告为胞嘧啶的概率。我们可以通过以亚硫酸氢盐处理前胞嘧啶分子的真实状态为条件，使用全概率定律来计算这个概率。\n\n设 $M$ 为胞嘧啶被甲基化 (5mC) 的事件， $U$ 为其未被甲基化的事件。其概率由 $P(M) = p$ 和 $P(U) = 1-p$ 给出。\n设 $C_{\\text{obs}}$ 为在测序读数中观测到胞嘧啶的事件。我们寻求的量是 $m_{\\text{obs}} = P(C_{\\text{obs}})$。\n\n根据全概率定律：\n$$m_{\\text{obs}} = P(C_{\\text{obs}}) = P(C_{\\text{obs}}|M)P(M) + P(C_{\\text{obs}}|U)P(U)$$\n$$m_{\\text{obs}} = p \\cdot P(C_{\\text{obs}}|M) + (1-p) \\cdot P(C_{\\text{obs}}|U)$$\n\n为了求条件概率 $P(C_{\\text{obs}}|M)$ 和 $P(C_{\\text{obs}}|U)$，我们进一步以亚硫酸氢盐处理后、测序前分子的化学状态为条件。设 $C_{\\text{chem}}$ 为处理后分子在化学上是胞嘧啶的事件， $T_{\\text{chem}}$ 为其已被转化为尿嘧啶（将变为胸腺嘧啶）的事件。\n\n对于甲基化的胞嘧啶（事件 $M$）：\n- 抵抗转化（保持为 $C_{\\text{chem}}$）的概率为 $1-\\delta$。因此，$P(C_{\\text{chem}}|M) = 1-\\delta$。\n- 错误转化（变为 $T_{\\text{chem}}$）的概率为 $\\delta$。因此，$P(T_{\\text{chem}}|M) = \\delta$。\n\n对于未甲基化的胞嘧啶（事件 $U$）：\n- 转化（变为 $T_{\\text{chem}}$）的概率为 $e$。因此，$P(T_{\\text{chem}}|U) = e$。\n- 未转化（保持为 $C_{\\text{chem}}$）的概率为 $1-e$。因此，$P(C_{\\text{chem}}|U) = 1-e$。\n\n在测序期间，可能发生错误：\n- 一个化学上的胞嘧啶 ($C_{\\text{chem}}$) 被错误地读取为胸腺嘧啶的概率为 $\\epsilon_{CT}$。因此，它被正确读取为胞嘧啶的概率为 $P(C_{\\text{obs}}|C_{\\text{chem}}) = 1 - \\epsilon_{CT}$。\n- 一个化学上的胸腺嘧啶 ($T_{\\text{chem}}$) 被错误地读取为胞嘧啶的概率为 $P(C_{\\text{obs}}|T_{\\text{chem}}) = \\epsilon_{TC}$。\n\n现在我们可以计算 $P(C_{\\text{obs}}|M)$ 和 $P(C_{\\text{obs}}|U)$：\n$$P(C_{\\text{obs}}|M) = P(C_{\\text{obs}}|C_{\\text{chem}}, M)P(C_{\\text{chem}}|M) + P(C_{\\text{obs}}|T_{\\text{chem}}, M)P(T_{\\text{chem}}|M)$$\n由于测序错误与原始甲基化状态无关：\n$$P(C_{\\text{obs}}|M) = P(C_{\\text{obs}}|C_{\\text{chem}})P(C_{\\text{chem}}|M) + P(C_{\\text{obs}}|T_{\\text{chem}})P(T_{\\text{chem}}|M)$$\n$$P(C_{\\text{obs}}|M) = (1 - \\epsilon_{CT})(1 - \\delta) + \\epsilon_{TC}\\delta$$\n\n类似地，对于未甲基化的情况：\n$$P(C_{\\text{obs}}|U) = P(C_{\\text{obs}}|C_{\\text{chem}}, U)P(C_{\\text{chem}}|U) + P(C_{\\text{obs}}|T_{\\text{chem}}, U)P(T_{\\text{chem}}|U)$$\n$$P(C_{\\text{obs}}|U) = P(C_{\\text{obs}}|C_{\\text{chem}})P(C_{\\text{chem}}|U) + P(C_{\\text{obs}}|T_{\\text{chem}})P(T_{\\text{chem}}|U)$$\n$$P(C_{\\text{obs}}|U) = (1 - \\epsilon_{CT})(1 - e) + \\epsilon_{TC}e$$\n\n将这些代入 $m_{\\text{obs}}$ 的表达式中：\n$$m_{\\text{obs}} = p \\left[ (1 - \\epsilon_{CT})(1 - \\delta) + \\epsilon_{TC}\\delta \\right] + (1-p) \\left[ (1 - \\epsilon_{CT})(1 - e) + \\epsilon_{TC}e \\right]$$\n这就是 $m_{\\text{obs}}$ 的通用表达式。\n\n为了求解真实甲基化比例 $p$，我们重排该方程。设 $p$ 的系数为 $A$ ，$(1-p)$ 的系数为 $B$。\n$A = (1 - \\epsilon_{CT})(1 - \\delta) + \\epsilon_{TC}\\delta$\n$B = (1 - \\epsilon_{CT})(1 - e) + \\epsilon_{TC}e$\n所以，$m_{\\text{obs}} = pA + (1-p)B = pA + B - pB = p(A-B) + B$。\n求解 $p$：\n$$p = \\frac{m_{\\text{obs}} - B}{A - B}$$\n\n现在，我们代入给定的数值：$m_{\\text{obs}} = 0.40$, $e = 0.98$, $\\delta = 0.002$, $\\epsilon_{CT} = 0.001$, 和 $\\epsilon_{TC} = 0.0015$。\n首先，计算 $A$ 和 $B$：\n$$A = (1 - 0.001)(1 - 0.002) + (0.0015)(0.002) = (0.999)(0.998) + 0.000003 = 0.997002 + 0.000003 = 0.997005$$\n$$B = (1 - 0.001)(1 - 0.98) + (0.0015)(0.98) = (0.999)(0.02) + 0.00147 = 0.01998 + 0.00147 = 0.02145$$\n然后，计算 $p$：\n$$p = \\frac{0.40 - 0.02145}{0.997005 - 0.02145} = \\frac{0.37855}{0.975555} \\approx 0.388040$$\n四舍五入到四位有效数字，$p \\approx 0.3880$。\n\n接下来，我们量化不完全转化影响，$I \\equiv m_{\\text{obs}}(e) - m_{\\text{obs}}(1)$。\n$m_{\\text{obs}}(e)$ 的表达式是我们推导的通用表达式。对于 $m_{\\text{obs}}(1)$，我们将 $e=1$ 代入通用表达式中：\n$$m_{\\text{obs}}(1) = p \\left[ (1 - \\epsilon_{CT})(1 - \\delta) + \\epsilon_{TC}\\delta \\right] + (1-p) \\left[ (1 - \\epsilon_{CT})(1 - 1) + \\epsilon_{TC}(1) \\right]$$\n$$m_{\\text{obs}}(1) = p \\left[ (1 - \\epsilon_{CT})(1 - \\delta) + \\epsilon_{TC}\\delta \\right] + (1-p) \\epsilon_{TC}$$\n现在，我们计算差值 $I$：\n$$I = m_{\\text{obs}}(e) - m_{\\text{obs}}(1)$$\n$$I = \\left( p \\left[ \\dots \\right] + (1-p) \\left[ (1 - \\epsilon_{CT})(1 - e) + \\epsilon_{TC}e \\right] \\right) - \\left( p \\left[ \\dots \\right] + (1-p) \\epsilon_{TC} \\right)$$\n乘以 $p$ 的项相互抵消。\n$$I = (1-p) \\left[ (1 - \\epsilon_{CT})(1 - e) + \\epsilon_{TC}e \\right] - (1-p) \\epsilon_{TC}$$\n$$I = (1-p) \\left( (1 - \\epsilon_{CT})(1 - e) + \\epsilon_{TC}e - \\epsilon_{TC} \\right)$$\n$$I = (1-p) \\left( (1 - \\epsilon_{CT})(1 - e) - \\epsilon_{TC}(1 - e) \\right)$$\n$$I = (1-p)(1-e)(1 - \\epsilon_{CT} - \\epsilon_{TC})$$\n这就是 $I$ 关于 $p$, $e$, $\\epsilon_{CT}$ 和 $\\epsilon_{TC}$ 的表达式。\n\n最后，我们使用我们计算出的 $p \\approx 0.388040$ 的值和给定的参数来数值计算 $I$：\n$$I = (1 - 0.388040)(1 - 0.98)(1 - 0.001 - 0.0015)$$\n$$I = (0.61196)(0.02)(1 - 0.0025)$$\n$$I = (0.61196)(0.02)(0.9975)$$\n$$I = (0.0122392)(0.9975) \\approx 0.012208594$$\n四舍五入到四位有效数字，$I \\approx 0.01221$。\n\n估计的真实甲基化比例为 $p \\approx 0.3880$，不完全转化影响为 $I \\approx 0.01221$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.3880  0.01221 \\end{pmatrix}}$$"
        },
        {
            "introduction": "理论模型的构建让我们认识到了潜在的偏差来源，现在让我们转向一个更贴近实际数据处理的场景。本练习模拟了分析流程中的关键第一步：对原始测序读数进行质量控制，过滤掉低质量和可能引入偏见的数据。在此基础上，你将应用矩估计法，推导出一个能够校正部分技术误差的甲基化水平估计量，从而将理论知识与数据清洗的实践相结合 。",
            "id": "4544197",
            "problem": "一个胞嘧啶-磷酸-鸟嘌呤（CpG）位点通过全基因组亚硫酸氢盐测序进行探查。在亚硫酸氢钠处理中，未甲基化的胞嘧啶会脱氨基转变为尿嘧啶，并在测序中被读取为胸腺嘧啶，而甲基化的胞嘧啶则保持为胞嘧啶。Phred碱基质量分数 $Q$ 编码了碱基识别错误的概率，公式为 $P(\\text{error}) = 10^{-Q/10}$。Phred标度的比对质量 $MQ$ 编码了测序读段（read）被错误比对的概率，公式为 $P(\\text{wrong map}) = 10^{-MQ/10}$。被标记为重复的读段被假定为聚合酶链式反应（PCR）的重复序列，应予以排除。给定一个覆盖单个CpG位点的包含20个读段的数据集，其中包括在CpG位点观测到的碱基（$C$ 或 $T$）、读段的比对质量 $MQ$、CpG位置的碱基质量 $Q$ 以及一个重复标记 $\\mathrm{DUP} \\in \\{0,1\\}$：\n- 读段 $1$：碱基 $C$, $MQ=37$, $Q=35$, $\\mathrm{DUP}=0$\n- 读段 $2$：碱基 $C$, $MQ=41$, $Q=32$, $\\mathrm{DUP}=0$\n- 读段 $3$：碱基 $T$, $MQ=38$, $Q=33$, $\\mathrm{DUP}=0$\n- 读段 $4$：碱基 $C$, $MQ=29$, $Q=38$, $\\mathrm{DUP}=0$\n- 读段 $5$：碱基 $T$, $MQ=36$, $Q=28$, $\\mathrm{DUP}=0$\n- 读段 $6$：碱基 $C$, $MQ=60$, $Q=40$, $\\mathrm{DUP}=1$\n- 读段 $7$：碱基 $C$, $MQ=60$, $Q=40$, $\\mathrm{DUP}=0$\n- 读段 $8$：碱基 $T$, $MQ=31$, $Q=31$, $\\mathrm{DUP}=0$\n- 读段 $9$：碱基 $T$, $MQ=34$, $Q=30$, $\\mathrm{DUP}=0$\n- 读段 $10$：碱基 $C$, $MQ=35$, $Q=30$, $\\mathrm{DUP}=0$\n- 读段 $11$：碱基 $T$, $MQ=50$, $Q=39$, $\\mathrm{DUP}=0$\n- 读段 $12$：碱基 $C$, $MQ=33$, $Q=29$, $\\mathrm{DUP}=0$\n- 读段 $13$：碱基 $C$, $MQ=32$, $Q=35$, $\\mathrm{DUP}=0$\n- 读段 $14$：碱基 $T$, $MQ=45$, $Q=35$, $\\mathrm{DUP}=1$\n- 读段 $15$：碱基 $C$, $MQ=42$, $Q=31$, $\\mathrm{DUP}=0$\n- 读段 $16$：碱基 $T$, $MQ=55$, $Q=37$, $\\mathrm{DUP}=0$\n- 读段 $17$：碱基 $C$, $MQ=47$, $Q=30$, $\\mathrm{DUP}=0$\n- 读段 $18$：碱基 $T$, $MQ=30$, $Q=30$, $\\mathrm{DUP}=0$\n- 读段 $19$：碱基 $C$, $MQ=44$, $Q=34$, $\\mathrm{DUP}=0$\n- 读段 $20$：碱基 $T$, $MQ=39$, $Q=31$, $\\mathrm{DUP}=0$\n\n应用以下筛选条件以获得高置信度的观测数据：仅保留 $MQ \\ge 30$、CpG位置的碱基质量 $Q \\ge 30$ 且 $\\mathrm{DUP} = 0$ 的读段。设 $n$ 为保留的读段数量，$c$ 为保留的观测到 $C$ 的计数，$t$ 为保留的观测到 $T$ 的计数，其中 $n=c+t$。\n\n假设亚硫酸氢盐未转换率为 $r = 0.01$，意味着一个未甲基化的胞嘧啶在测序前未能转换的概率为 $r$。假设一个对称的碱基识别错误模型，每个读段的错误概率 $e$ 等于由最低保留碱基质量阈值所隐含的错误率，即 $e = 10^{-Q_{\\min}/10}$，其中 $Q_{\\min}=30$。在这些假设和亚硫酸氢盐转换的生化过程下，从第一性原理出发，推导在一个保留的读段中观测到该位点为 $C$ 的概率，并将其表示为甲基化分数 $m \\in [0,1]$ 的线性函数。然后，使用矩估计法，将经验分数 $\\hat{p} = c/n$ 等同于推导出的期望值，求解 $m$ 的估计量 $\\hat{m}$ 的闭式解，并根据筛选后的数据计算其数值。\n\n简要说明在此背景下，每种筛选（比对质量、碱基质量、重复序列移除）如何影响估计的偏差和方差，但最终答案只需报告 $\\hat{m}$ 的数值（不带百分号的小数）。将你报告的最终值四舍五入至四位有效数字。",
            "solution": "该问题被评估为有效，因为它科学地基于亚硫酸氢盐测序的原理，问题设定良好，有足够的数据和明确的目标，并且陈述客观。\n\n解答过程分为五个步骤：首先，筛选提供的测序数据；其次，推导观测碱基作为甲基化分数函数的概率模型；第三，使用矩估计法推导甲基化分数的估计量；第四，计算该估计值的数值；第五，说明使用数据筛选的理由。\n\n首先，必须对原始测序数据进行筛选，以仅保留高置信度的观测数据。指定的标准是比对质量 $MQ \\ge 30$、CpG位置的碱基质量 $Q \\ge 30$，并且没有重复标记（即 $\\mathrm{DUP} = 0$）。我们将这些筛选条件应用于这20个读段的集合：\n- 读段 $1$：$C, MQ=37, Q=35, \\mathrm{DUP}=0$。保留。\n- 读段 $2$：$C, MQ=41, Q=32, \\mathrm{DUP}=0$。保留。\n- 读段 $3$：$T, MQ=38, Q=33, \\mathrm{DUP}=0$。保留。\n- 读段 $4$：$C, MQ=29, Q=38, \\mathrm{DUP}=0$。丢弃 ($MQ  30$)。\n- 读段 $5$：$T, MQ=36, Q=28, \\mathrm{DUP}=0$。丢弃 ($Q  30$)。\n- 读段 $6$：$C, MQ=60, Q=40, \\mathrm{DUP}=1$。丢弃 ($\\mathrm{DUP} = 1$)。\n- 读段 $7$：$C, MQ=60, Q=40, \\mathrm{DUP}=0$。保留。\n- 读段 $8$：$T, MQ=31, Q=31, \\mathrm{DUP}=0$。保留。\n- 读段 $9$：$T, MQ=34, Q=30, \\mathrm{DUP}=0$。保留。\n- 读段 $10$：$C, MQ=35, Q=30, \\mathrm{DUP}=0$。保留。\n- 读段 $11$：$T, MQ=50, Q=39, \\mathrm{DUP}=0$。保留。\n- 读段 $12$：$C, MQ=33, Q=29, \\mathrm{DUP}=0$。丢弃 ($Q  30$)。\n- 读段 $13$：$C, MQ=32, Q=35, \\mathrm{DUP}=0$。保留。\n- 读段 $14$：$T, MQ=45, Q=35, \\mathrm{DUP}=1$。丢弃 ($\\mathrm{DUP} = 1$)。\n- 读段 $15$：$C, MQ=42, Q=31, \\mathrm{DUP}=0$。保留。\n- 读段 $16$：$T, MQ=55, Q=37, \\mathrm{DUP}=0$。保留。\n- 读段 $17$：$C, MQ=47, Q=30, \\mathrm{DUP}=0$。保留。\n- 读段 $18$：$T, MQ=30, Q=30, \\mathrm{DUP}=0$。保留。\n- 读段 $19$：$C, MQ=44, Q=34, \\mathrm{DUP}=0$。保留。\n- 读段 $20$：$T, MQ=39, Q=31, \\mathrm{DUP}=0$。保留。\n\n筛选后，保留的读段数为 $n=15$。观测到的胞嘧啶（$C$）计数为 $c=8$。观测到的胸腺嘧啶（$T$）计数为 $t=7$。总和为 $c+t = 8+7=15=n$，符合预期。观测到 $C$ 碱基的经验分数为 $\\hat{p} = \\frac{c}{n} = \\frac{8}{15}$。\n\n其次，我们推导在给定的保留读段中观测到该位点为 $C$ 的概率，记作 $P(\\text{obs}=C)$。该概率是真实甲基化分数 $m \\in [0,1]$、亚硫酸氢盐未转换率 $r$ 和碱基识别错误率 $e$ 的函数。假设一个DNA分子被甲基化的概率为 $m$，未被甲基化的概率为 $1-m$。\n\n观测到 $C$ 可能源于两种基于DNA分子真实状态的互斥情况：\n1.  原始胞嘧啶被甲基化（概率为 $m$）。它不受亚硫酸氢盐处理的影响，保持为 $C$。然后它被正确测序为 $C$。碱基正确识别的概率为 $1-e$。此路径的总概率为 $P(\\text{obs}=C \\text{ and methylated}) = m \\times 1 \\times (1-e) = m(1-e)$。\n\n2.  原始胞嘧啶未被甲基化（概率为 $1-m$）。两条子路径可导致观测到 $C$：\n    a. 亚硫酸氢盐未转换：未甲基化的 $C$ 未能转换为尿嘧啶（概率为 $r$）。它保持为 $C$，然后被正确测序为 $C$（概率为 $1-e$）。此子路径的概率为 $(1-m) \\times r \\times (1-e)$。\n    b. 转换和测序错误：未甲基化的 $C$ 正确转换为尿嘧啶（被读取为 $T$）（概率为 $1-r$）。这个 $T$ 随后由于碱基识别错误被错误地测序为 $C$（概率为 $e$）。此子路径的概率为 $(1-m) \\times (1-r) \\times e$。\n\n观测到 $C$ 的总概率是这些不相交路径的概率之和：\n$$ P(\\text{obs}=C) = m(1-e) + (1-m)r(1-e) + (1-m)(1-r)e $$\n该表达式可以重新整理以显示其对 $m$ 的线性依赖性：\n$$ P(\\text{obs}=C) = m(1-e) + (1-m)[r(1-e) + e(1-r)] $$\n$$ P(\\text{obs}=C) = m(1-e) + (1-m)(r - re + e - re) $$\n$$ P(\\text{obs}=C) = m(1-e) + (1-m)(r + e - 2re) $$\n按 $m$ 合并项：\n$$ P(\\text{obs}=C) = m(1-e) - m(r+e-2re) + (r+e-2re) $$\n$$ P(\\text{obs}=C) = m[(1-e) - (r+e-2re)] + (r+e-2re) $$\n$$ P(\\text{obs}=C) = m[1 - 2e - r + 2re] + (r+e-2re) $$\n对 $m$ 的系数进行因式分解得到 $(1-r)(1-2e)$。因此，线性函数为：\n$$ P(\\text{obs}=C) = m(1-r)(1-2e) + (r+e-2re) $$\n\n第三，我们推导 $m$ 的估计量 $\\hat{m}$。矩估计法将经验样本矩与相应的理论总体矩相等同。在这里，我们将观测到的 $C$ 的样本比例 $\\hat{p} = c/n$ 与理论概率 $P(\\text{obs}=C)$ 等同：\n$$ \\hat{p} = \\hat{m}(1-r)(1-2e) + (r+e-2re) $$\n求解估计量 $\\hat{m}$：\n$$ \\hat{p} - (r+e-2re) = \\hat{m}(1-r)(1-2e) $$\n$$ \\hat{m} = \\frac{\\hat{p} - (r+e-2re)}{(1-r)(1-2e)} $$\n这是甲基化分数 $m$ 的闭式估计量。\n\n第四，我们对 $\\hat{m}$ 进行数值计算。给定的参数是未转换率 $r = 0.01$ 和碱基识别错误概率 $e$，该概率由最低质量阈值 $Q_{\\min}=30$ 推导得出：\n$$ e = 10^{-Q_{\\min}/10} = 10^{-30/10} = 10^{-3} = 0.001 $$\n我们有经验分数 $\\hat{p} = 8/15$。\n$r+e-2re$ 项计算如下：\n$$ r+e-2re = 0.01 + 0.001 - 2(0.01)(0.001) = 0.011 - 0.00002 = 0.01098 $$\n分母项 $(1-r)(1-2e)$ 为：\n$$ (1-r)(1-2e) = (1-0.01)(1-2 \\times 0.001) = (0.99)(1-0.002) = (0.99)(0.998) = 0.98802 $$\n将这些值代入 $\\hat{m}$ 的估计量公式中：\n$$ \\hat{m} = \\frac{\\frac{8}{15} - 0.01098}{0.98802} $$\n$$ \\hat{m} = \\frac{0.53333... - 0.01098}{0.98802} = \\frac{0.522353...}{0.98802} \\approx 0.528687 $$\n四舍五入到四位有效数字，估计的甲基化水平为 $\\hat{m} \\approx 0.5287$。\n\n第五，我们简要说明数据筛选步骤的理由。\n- **比对质量（$MQ$）筛选**：此筛选移除了可能并非源自目标基因组位点的读段。包含此类读段会引入显著偏差，因为它们的甲基化状态与目标CpG位点无关。例如，如果一个错误比对的读段来自一个未甲基化的旁系同源区域，它会贡献一个 $T$ 观测值，从而人为地降低甲基化估计值。移除低 $MQ$ 值的读段可以减少这种偏差来源。\n- **碱基质量（$Q$）筛选**：此筛选移除了具有高错误概率的碱基识别。包含低质量碱基会增加 $C$ 和 $T$ 计数的噪声，导致最终估计值 $\\hat{m}$ 的方差更高。此外，推导过程假设了一个单一的、低的错误率 $e$。包含具有更高错误概率的读段会违反此模型假设，并可能引入偏差。筛选高质量 $Q$ 值的读段确保了错误模型是一个合理的近似，并提高了估计的精确度。\n- **重复读段移除**：PCR重复是指源自单个DNA片段扩增的多个读段。包含它们会违反独立观测的假设。这会实际上过度计算来自一个原始分子的证据，导致方差估计值被人为地降低，并可能产生严重偏差。如果被过度扩增的单个片段是甲基化的，估计值将向上偏高；如果是未甲基化的，则向下偏低。移除重复序列确保每个保留的读段都是从分子群体中的一次独立抽样，从而产生一个更准确和无偏的 $m$ 估计值。",
            "answer": "$$\\boxed{0.5287}$$"
        },
        {
            "introduction": "在掌握了群体水平的估计方法后，我们将深入到最精细的单分子、单碱基层面进行推理，这代表了现代甲基化分析的尖端技术。这项高级练习将指导你运用贝叶斯框架，综合利用来自单条测序读数的所有信息——包括具体的碱基读数、其对应的测序质量分数以及该位点的基因组上下文（CpG 或 CH）。通过这种方式，你将学会如何为单个胞嘧啶的甲基化状态做出概率性判断，从而更精确地量化表观遗传的异质性 。",
            "id": "4544155",
            "problem": "一条单端全基因组亚硫酸氢盐测序 (WGBS) 读段已被比对到正链上经胞嘧啶到胸腺嘧啶转换后的参考序列。在亚硫酸氢盐化学处理中，未甲基化的胞嘧啶会脱氨基形成尿嘧啶，并在聚合酶延伸后被读取为胸腺嘧啶，而甲基化的胞嘧啶则受到保护，仍然是胞嘧啶。假设对于未甲基化的胞嘧啶，亚硫酸氢盐转换效率为 $e = 0.99$，而对于甲基化的胞嘧啶，转换效率为零。测序错误按碱基独立建模，使用 Phred 质量分值 $Q$ 表示，其中错误概率为 $p_{\\text{err}} = 10^{-Q/10}$。在发生错误的条件下，替换为其他三种核苷酸中任意一种的概率相等。\n\n给定跨越基因组位置 $3$ 到 $14$（含）的正链转换后参考序列子串：\nTTGTTTATGTGT\n\n一条长度为12的读段与该子串的比对在位置上是完全匹配的（无插入或缺失），其读段碱基和 Phred 质量分值如下（索引 $1$ 对应基因组位置 $3$，索引 $12$ 对应基因组位置 $14$）：\n- 读段碱基: TCGTTCATGTGT\n- 质量分值 $Q_{1..12}$: $[35, 30, 40, 25, 32, 28, 37, 33, 39, 20, 36, 30]$\n\n给定一个二进制掩码，指示转换后参考序列中的哪些位置来源于未转换基因组中的胞嘧啶（即，转换后参考序列由于基因组C的转换而显示为T的位置）。在上述子串中（基因组位置 $3$ 至 $14$），胞嘧啶来源位置的索引为 $\\{1, 2, 4, 6, 10\\}$，对应于基因组位置 $\\{3, 4, 6, 8, 12\\}$。对于这些胞嘧啶来源位置，还给出了它们的上下文分类：基因组位置 $4$ 和 $12$ 是胞嘧啶-磷酸-鸟嘌呤 (CpG) 上下文，基因组位置 $3$、$6$ 和 $8$ 是C后跟一个非鸟嘌呤碱基 (CH) 的上下文。\n\n使用贝叶斯模型来判断所覆盖的胞嘧啶来源位置的甲基化状态。令 $M$ 表示胞嘧啶被甲基化的事件， $U$ 表示未甲基化的事件。使用以下先验概率：\n- CpG 上下文的先验甲基化概率 $P(M \\mid \\text{CpG}) = 0.7$，\n- CH 上下文的先验甲基化概率 $P(M \\mid \\text{CH}) = 0.1$。\n\n从第一性原理出发，为每个被覆盖的胞嘧啶来源位置 $i$，根据其观测到的碱基 $b_i$ 和质量分值 $Q_i$，推导出每个位点的后验概率 $P(M \\mid b_i)$。然后：\n1. 将转换后参考序列中每个胞嘧啶来源位置的碱基还原为胞嘧啶，同时保持所有其他位置不变，从而重建该区域的原始基因组序列。\n2. 计算所覆盖的胞嘧啶来源位置的期望甲基化分数，即每个位点后验甲基化概率的平均值：\n$$\\bar{f} = \\frac{1}{N}\\sum_{i \\in \\{\\text{cytosine-origin indices}\\}} P(M \\mid b_i),$$\n其中 $N$ 是被覆盖的胞嘧啶来源位置的数量。\n\n将最终的期望甲基化分数 $\\bar{f}$ 表示为不带百分号的小数，并将您的答案四舍五入到四位有效数字。不需要单位。",
            "solution": "该问题具有科学依据，定义明确，并包含得出唯一解所需的所有信息，因此被认为是有效的。解决方案首先重建原始基因组序列，然后应用贝叶斯模型来确定指定胞嘧啶来源位点的期望甲基化分数。\n\n模型的给定参数如下：\n- 未甲基化胞嘧啶的亚硫酸氢盐转换效率：$e = 0.99$。\n- Phred 质量分值为 $Q$ 的碱基的测序错误概率：$p_{\\text{err}} = 10^{-Q/10}$。\n- 在发生错误的条件下，替换为其他三种碱基中任意一种的概率相等。\n- CpG 上下文的先验甲基化概率：$P(M \\mid \\text{CpG}) = 0.7$。\n- CH 上下文的先验甲基化概率：$P(M \\mid \\text{CH}) = 0.1$。\n\n12个碱基对区域（基因组位置 $3$ 到 $14$）的数据如下：\n- 转换后的参考序列：`TTGTTTATGTGT`\n- 读段碱基 ($b_i$)：`TCGTTCATGTGT`\n- 质量分值 ($Q_i$)：$[35, 30, 40, 25, 32, 28, 37, 33, 39, 20, 36, 30]$\n- 胞嘧啶来源索引（1-based，在子串内）：$\\{1, 2, 4, 6, 10\\}$。\n- 这些胞嘧啶来源位点的上下文：\n    - CpG：索引 $2$ 和 $10$。\n    - CH：索引 $1, 4, 6$。\n\n### 第一部分：重建原始基因组序列\n\n转换后的参考序列 `TTGTTTATGTGT` 在原始基因组序列中是未甲基化胞嘧啶（`C`）并成功转换的位置上显示为胸腺嘧啶（`T`）。题目说明索引 $\\{1, 2, 4, 6, 10\\}$ 是胞嘧啶来源位置。在给定的转换后参考序列中，所有这些位置都是 `T`。为了重建原始基因组序列，我们将这些 `T` 还原为 `C`。\n\n- 转换后参考序列：`T T G T T T A T G T G T`\n- 1-based 索引：   `1 2 3 4 5 6 7 8 9 10 11 12`\n- C 来源位点（用 `*` 标记）：`* *   *   *     *`\n\n将索引 $1, 2, 4, 6, 10$ 处的碱基还原：\n- 索引 $1$: `T` $\\rightarrow$ `C`\n- 索引 $2$: `T` $\\rightarrow$ `C`\n- 索引 $4$: `T` $\\rightarrow$ `C`\n- 索引 $6$: `T` $\\rightarrow$ `C`\n- 索引 $10$: `T` $\\rightarrow$ `C`\n\n该区域最终的原始基因组序列是 `CCGCTCATGCGT`。\n\n### 第二部分：计算期望甲基化分数\n\n我们计算期望甲基化分数 $\\bar{f}$，即 $N=5$ 个胞嘧啶来源位点上每个位点后验甲基化概率 $P(M \\mid b_i)$ 的平均值。\n$$ \\bar{f} = \\frac{1}{N}\\sum_{i \\in \\{1, 2, 4, 6, 10\\}} P(M \\mid b_i) $$\n对于每个位点 $i$，我们使用贝叶斯定理来计算在给定观测碱基 $b_i$ 及其质量分值 $Q_i$ 的条件下，甲基化（$M$）的后验概率：\n$$ P(M \\mid b_i, Q_i) = \\frac{P(b_i \\mid M, Q_i) P(M)}{P(b_i \\mid Q_i)} $$\n分母，即边缘似然，是所有可能状态（甲基化 $M$ 和未甲基化 $U$）的概率之和：\n$$ P(b_i \\mid Q_i) = P(b_i \\mid M, Q_i) P(M) + P(b_i \\mid U, Q_i) P(U) $$\n未甲基化的先验概率为 $P(U) = 1 - P(M)$。每个位点的错误概率为 $p_{\\text{err},i} = 10^{-Q_i/10}$。\n\n似然函数 $P(b_i \\mid \\text{State}, Q_i)$ 取决于胞嘧啶的真实潜在状态。\n\n**给定甲基化（$M$）的似然：**\n如果一个胞嘧啶是甲基化的，它不会被转换。待测序的碱基是 `C`。\n- 如果观测到的碱基是 `C` ($b_i = \\text{'C'}$) ，则测序仪读数正确。\n  $$ P(b_i=\\text{'C'} \\mid M, Q_i) = 1 - p_{\\text{err},i} $$\n- 如果观测到的碱基不是 `C` ($b_i \\in \\{\\text{'A', 'T', 'G'}\\}$) ，则发生了测序错误。\n  $$ P(b_i \\neq \\text{'C'} \\mid M, Q_i) = \\frac{p_{\\text{err},i}}{3} $$\n\n**给定未甲基化（$U$）的似然：**\n如果一个胞嘧啶是未甲基化的，它有 $e=0.99$ 的概率被转换为尿嘧啶（`U`），并被读作胸腺嘧啶（`T`）。它有 $1-e=0.01$ 的概率未能转换而保持为 `C`。这是一个混合模型，其中待测序的真实碱基有 $e$ 的概率是 `T`，有 $1-e$ 的概率是 `C`。\n令 $L(b_i | \\text{true}, Q_i)$ 为在给定真实碱基的情况下观测到 $b_i$ 的概率。\n$$ P(b_i \\mid U, Q_i) = e \\cdot L(b_i \\mid \\text{true='T'}, Q_i) + (1-e) \\cdot L(b_i \\mid \\text{true='C'}, Q_i) $$\n- 如果观测到的碱基是 `C` ($b_i = \\text{'C'}$):\n  $$ P(b_i=\\text{'C'} \\mid U, Q_i) = e \\cdot \\frac{p_{\\text{err},i}}{3} + (1-e) \\cdot (1 - p_{\\text{err},i}) $$\n- 如果观测到的碱基是 `T` ($b_i = \\text{'T'}$):\n  $$ P(b_i=\\text{'T'} \\mid U, Q_i) = e \\cdot (1 - p_{\\text{err},i}) + (1-e) \\cdot \\frac{p_{\\text{err},i}}{3} $$\n- 如果观测到的碱基是 `A` 或 `G` ($b_i \\in \\{\\text{'A', 'G'}\\}$):\n  $$ P(b_i \\in \\{\\text{'A', 'G'}\\} \\mid U, Q_i) = e \\cdot \\frac{p_{\\text{err},i}}{3} + (1-e) \\cdot \\frac{p_{\\text{err},i}}{3} = \\frac{p_{\\text{err},i}}{3} $$\n\n现在，我们为 $N=5$ 个胞嘧啶来源位点中的每一个计算 $P(M \\mid b_i)$。\n\n**位点 1 (索引 1):**\n- 上下文: CH, $P(M)=0.1$, $P(U)=0.9$。\n- 数据: $b_1=\\text{'T'}$, $Q_1=35$。$p_{\\text{err},1} = 10^{-3.5}$。\n- 似然：\n  $L_M = P(b_1=\\text{'T'} \\mid M) = \\frac{p_{\\text{err},1}}{3} = \\frac{10^{-3.5}}{3}$。\n  $L_U = P(b_1=\\text{'T'} \\mid U) = 0.99(1-10^{-3.5}) + 0.01(\\frac{10^{-3.5}}{3})$。\n- 后验概率：\n  $P(M \\mid b_1) = \\frac{L_M \\cdot 0.1}{L_M \\cdot 0.1 + L_U \\cdot 0.9} \\approx \\frac{(\\frac{3.162 \\times 10^{-4}}{3}) \\cdot 0.1}{(...) \\cdot 0.1 + (0.99(0.99968) + 0.01(\\frac{3.162 \\times 10^{-4}}{3})) \\cdot 0.9} \\approx \\frac{1.054 \\times 10^{-5}}{1.054 \\times 10^{-5} + 0.8907} \\approx 1.1832 \\times 10^{-5}$。\n\n**位点 2 (索引 2):**\n- 上下文: CpG, $P(M)=0.7$, $P(U)=0.3$。\n- 数据: $b_2=\\text{'C'}$, $Q_2=30$。$p_{\\text{err},2} = 10^{-3}$。\n- 似然：\n  $L_M = P(b_2=\\text{'C'} \\mid M) = 1-10^{-3} = 0.999$。\n  $L_U = P(b_2=\\text{'C'} \\mid U) = 0.99(\\frac{10^{-3}}{3}) + 0.01(1-10^{-3}) = 0.00033 + 0.00999 = 0.01032$。\n- 后验概率：\n  $P(M \\mid b_2) = \\frac{0.999 \\cdot 0.7}{0.999 \\cdot 0.7 + 0.01032 \\cdot 0.3} = \\frac{0.6993}{0.6993 + 0.003096} = \\frac{0.6993}{0.702396} \\approx 0.995593$。\n\n**位点 3 (索引 4):**\n- 上下文: CH, $P(M)=0.1$, $P(U)=0.9$。\n- 数据: $b_4=\\text{'T'}$, $Q_4=25$。$p_{\\text{err},4} = 10^{-2.5}$。\n- 似然：\n  $L_M = P(b_4=\\text{'T'} \\mid M) = \\frac{10^{-2.5}}{3}$。\n  $L_U = P(b_4=\\text{'T'} \\mid U) = 0.99(1-10^{-2.5}) + 0.01(\\frac{10^{-2.5}}{3})$。\n- 后验概率：\n  $P(M \\mid b_4) = \\frac{L_M \\cdot 0.1}{L_M \\cdot 0.1 + L_U \\cdot 0.9} \\approx \\frac{(\\frac{3.162 \\times 10^{-3}}{3}) \\cdot 0.1}{(...) \\cdot 0.1 + (0.99(0.9968) + 0.01(\\frac{3.162 \\times 10^{-3}}{3})) \\cdot 0.9} \\approx \\frac{1.054 \\times 10^{-4}}{1.054 \\times 10^{-4} + 0.8882} \\approx 1.1866 \\times 10^{-4}$。\n\n**位点 4 (索引 6):**\n- 上下文: CH, $P(M)=0.1$, $P(U)=0.9$。\n- 数据: $b_6=\\text{'C'}$, $Q_6=28$。$p_{\\text{err},6} = 10^{-2.8}$。\n- 似然：\n  $L_M = P(b_6=\\text{'C'} \\mid M) = 1-10^{-2.8} \\approx 0.998415$。\n  $L_U = P(b_6=\\text{'C'} \\mid U) = 0.99(\\frac{10^{-2.8}}{3}) + 0.01(1-10^{-2.8}) \\approx 0.000523 + 0.009984 = 0.010507$。\n- 后验概率：\n  $P(M \\mid b_6) = \\frac{0.998415 \\cdot 0.1}{0.998415 \\cdot 0.1 + 0.010507 \\cdot 0.9} = \\frac{0.0998415}{0.0998415 + 0.0094563} = \\frac{0.0998415}{0.1092978} \\approx 0.913480$。\n\n**位点 5 (索引 10):**\n- 上下文: CpG, $P(M)=0.7$, $P(U)=0.3$。\n- 数据: $b_{10}=\\text{'T'}$, $Q_{10}=20$。$p_{\\text{err},10} = 10^{-2} = 0.01$。\n- 似然：\n  $L_M = P(b_{10}=\\text{'T'} \\mid M) = \\frac{0.01}{3}$。\n  $L_U = P(b_{10}=\\text{'T'} \\mid U) = 0.99(1-0.01) + 0.01(\\frac{0.01}{3}) = 0.99(0.99) + \\frac{0.0001}{3} = 0.9801 + 3.\\overline{3} \\times 10^{-5} \\approx 0.980133$。\n- 后验概率：\n  $P(M \\mid b_{10}) = \\frac{(\\frac{0.01}{3}) \\cdot 0.7}{(\\frac{0.01}{3}) \\cdot 0.7 + 0.980133 \\cdot 0.3} = \\frac{0.002\\overline{3}}{0.002\\overline{3} + 0.29404} = \\frac{0.002\\overline{3}}{0.29637\\overline{3}} \\approx 0.007873$。\n\n最后，我们计算这五个后验概率的平均值：\n$$ \\bar{f} = \\frac{1}{5} \\left( P(M \\mid b_1) + P(M \\mid b_2) + P(M \\mid b_4) + P(M \\mid b_6) + P(M \\mid b_{10}) \\right) $$\n$$ \\bar{f} \\approx \\frac{1}{5} (1.1832 \\times 10^{-5} + 0.995593 + 1.1866 \\times 10^{-4} + 0.913480 + 0.007873) $$\n$$ \\bar{f} \\approx \\frac{1}{5} (0.000011832 + 0.995593 + 0.00011866 + 0.913480 + 0.007873) $$\n$$ \\bar{f} \\approx \\frac{1.917076}{5} \\approx 0.3834152 $$\n将结果四舍五入到四位有效数字，得到 $\\bar{f} = 0.3834$。",
            "answer": "$$ \\boxed{0.3834} $$"
        }
    ]
}