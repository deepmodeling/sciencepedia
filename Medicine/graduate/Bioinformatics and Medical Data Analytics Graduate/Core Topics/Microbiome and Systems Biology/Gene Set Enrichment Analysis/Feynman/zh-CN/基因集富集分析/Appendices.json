{
    "hands_on_practices": [
        {
            "introduction": "基因集富集分析（Gene Set Enrichment Analysis, GSEA）的核心是计算富集分数（Enrichment Score, $ES$）。通过手动计算一个小型假设数据集的 $ES$ ，本练习旨在揭示 GSEA “游走求和”统计量的内部机制，将抽象概念转化为具体的计算步骤。这有助于您从根本上理解基因集成员在排序列表中的位置如何影响最终的富集分数。",
            "id": "4567424",
            "problem": "给定一个来自转录组差异表型分析的预排序基因列表，每个基因都关联一个排序度量值，该值被解释为与表型相关性的绝对值。任务是，使用类似 Kolmogorov–Smirnov 的移动总和定义，从第一性原理出发，计算加权参数 $p=1$ 时的基因集富集分析 (GSEA) 富集分数，然后识别前导子集 (leading-edge subset)。不要使用任何预先记忆的快捷公式；相反，应根据命中（hits）和未命中（misses）的经验累积分布函数的定义，明确地构建移动总和过程。\n\n基因总数为 $N=10$，从最相关到最不相关的排序列表如下：\n1. MYC，分数为 $10$\n2. TP53，分数为 $9$\n3. EGFR，分数为 $8$\n4. BRCA1，分数为 $7$\n5. PTEN，分数为 $6$\n6. KRAS，分数为 $5$\n7. AKT1，分数为 $4$\n8. BRAF，分数为 $3$\n9. MDM2，分数为 $2$\n10. CDK2，分数为 $1$\n\n考虑一个大小为 $|S|=3$ 的基因集 $S$，给定为 $S=\\{\\text{TP53}, \\text{KRAS}, \\text{MDM2}\\}$。使用加权参数 $p=1$，使得在命中时，移动总和增加一个与该基因分数成正比、并由 $S$ 中所有基因总分标准化的值；在未命中时，移动总和减少一个恒定值，使得所有未命中的总减少量等于 $1$。\n\n从命中和未命中的经验累积分布函数的定义以及它们在排序列表上的差异出发，手动计算：\n- 富集分数 (ES)，即移动总和与零的最大偏差，以及\n- 达到富集分数位置所对应的前导子集。\n\n将富集分数表示为一个精确的既约有理数（不要四舍五入），不带单位。最终答案应仅为富集分数。",
            "solution": "### 解答\n基因集富集分析 (GSEA) 的富集分数 (ES) 是通过遍历基因排序列表 $L$ 并计算一个移动总和统计量来得到的。ES 是该移动总和与零的最大偏差。排序列表中任意位置 $i$ 处的移动总和，是基因集 $S$ 中存在的基因（命中）的加权经验累积分布函数与不在 $S$ 中的基因（未命中）的经验累积分布函数之间的差值。\n\n首先，我们识别排序列表中的命中和未命中。基因总数为 $N=10$。基因集 $S=\\{\\text{TP53}, \\text{KRAS}, \\text{MDM2}\\}$ 包含 $N_H = |S| = 3$ 个基因（命中）。不在 $S$ 中的基因数量为 $N_M = N - N_H = 10 - 3 = 7$（未命中）。\n\n带有命中/未命中状态和分数（$r_j$）的排序列表如下：\n1. MYC, $r_1=10$ (未命中)\n2. TP53, $r_2=9$ (命中)\n3. EGFR, $r_3=8$ (未命中)\n4. BRCA1, $r_4=7$ (未命中)\n5. PTEN, $r_5=6$ (未命中)\n6. KRAS, $r_6=5$ (命中)\n7. AKT1, $r_7=4$ (未命中)\n8. BRAF, $r_8=3$ (未命中)\n9. MDM2, $r_9=2$ (命中)\n10. CDK2, $r_{10}=1$ (未命中)\n\n在排序位置 $i$ 的移动总和，记为 $ES_i$，定义为 $ES_i = P_{hit}(S, i) - P_{miss}(S, i)$。\n\n项 $P_{hit}(S, i)$ 是命中的加权经验累积分布。当加权参数 $p=1$ 时，其计算公式为：\n$$P_{hit}(S, i) = \\sum_{g_j \\in S, j \\le i} \\frac{r_j}{N_R}$$\n其中 $N_R$ 是归一化因子，等于 $S$ 中所有基因的分数之和：\n$$N_R = \\sum_{g_j \\in S} r_j = r_{\\text{TP53}} + r_{\\text{KRAS}} + r_{\\text{MDM2}} = 9 + 5 + 2 = 16$$\n当我们在排序位置 $j$ 遇到一个命中基因 $g_j \\in S$，其分数为 $r_j$ 时，移动总和增加 $\\frac{r_j}{N_R} = \\frac{r_j}{16}$。\n\n项 $P_{miss}(S, i)$ 是未命中的经验累积分布：\n$$P_{miss}(S, i) = \\sum_{g_j \\notin S, j \\le i} \\frac{1}{N_M}$$\n其中 $N_M = 7$。当我们在排序位置 $j$ 遇到一个未命中基因 $g_j \\notin S$ 时，移动总和减少 $\\frac{1}{N_M} = \\frac{1}{7}$。\n\n我们现在计算排序列表中每个基因 $g_i$ 的移动总和 $ES_i$，从 $ES_0=0$ 开始。\n\n1.  **基因 1 (MYC, 未命中):**\n    $P_{hit}(S, 1) = 0$。 $P_{miss}(S, 1) = \\frac{1}{7}$。\n    $ES_1 = 0 - \\frac{1}{7} = -\\frac{1}{7} = -\\frac{16}{112}$。\n\n2.  **基因 2 (TP53, 命中, 分数=9):**\n    $P_{hit}(S, 2) = \\frac{9}{16}$。 $P_{miss}(S, 2) = \\frac{1}{7}$。\n    $ES_2 = \\frac{9}{16} - \\frac{1}{7} = \\frac{63 - 16}{112} = \\frac{47}{112}$。\n\n3.  **基因 3 (EGFR, 未命中):**\n    $P_{hit}(S, 3) = \\frac{9}{16}$。 $P_{miss}(S, 3) = \\frac{2}{7}$。\n    $ES_3 = \\frac{9}{16} - \\frac{2}{7} = \\frac{63 - 32}{112} = \\frac{31}{112}$。\n\n4.  **基因 4 (BRCA1, 未命中):**\n    $P_{hit}(S, 4) = \\frac{9}{16}$。 $P_{miss}(S, 4) = \\frac{3}{7}$。\n    $ES_4 = \\frac{9}{16} - \\frac{3}{7} = \\frac{63 - 48}{112} = \\frac{15}{112}$。\n\n5.  **基因 5 (PTEN, 未命中):**\n    $P_{hit}(S, 5) = \\frac{9}{16}$。 $P_{miss}(S, 5) = \\frac{4}{7}$。\n    $ES_5 = \\frac{9}{16} - \\frac{4}{7} = \\frac{63 - 64}{112} = -\\frac{1}{112}$。\n\n6.  **基因 6 (KRAS, 命中, 分数=5):**\n    $P_{hit}(S, 6) = \\frac{9}{16} + \\frac{5}{16} = \\frac{14}{16}$。 $P_{miss}(S, 6) = \\frac{4}{7}$。\n    $ES_6 = \\frac{14}{16} - \\frac{4}{7} = \\frac{7}{8} - \\frac{4}{7} = \\frac{49 - 32}{56} = \\frac{17}{56} = \\frac{34}{112}$。\n\n7.  **基因 7 (AKT1, 未命中):**\n    $P_{hit}(S, 7) = \\frac{14}{16}$。 $P_{miss}(S, 7) = \\frac{5}{7}$。\n    $ES_7 = \\frac{14}{16} - \\frac{5}{7} = \\frac{7}{8} - \\frac{5}{7} = \\frac{49 - 40}{56} = \\frac{9}{56} = \\frac{18}{112}$。\n\n8.  **基因 8 (BRAF, 未命中):**\n    $P_{hit}(S, 8) = \\frac{14}{16}$。 $P_{miss}(S, 8) = \\frac{6}{7}$。\n    $ES_8 = \\frac{14}{16} - \\frac{6}{7} = \\frac{7}{8} - \\frac{6}{7} = \\frac{49 - 48}{56} = \\frac{1}{56} = \\frac{2}{112}$。\n\n9.  **基因 9 (MDM2, 命中, 分数=2):**\n    $P_{hit}(S, 9) = \\frac{14}{16} + \\frac{2}{16} = \\frac{16}{16} = 1$。 $P_{miss}(S, 9) = \\frac{6}{7}$。\n    $ES_9 = 1 - \\frac{6}{7} = \\frac{1}{7} = \\frac{16}{112}$。\n\n10. **基因 10 (CDK2, 未命中):**\n    $P_{hit}(S, 10) = 1$。 $P_{miss}(S, 10) = \\frac{7}{7} = 1$。\n    $ES_{10} = 1 - 1 = 0$。\n\n移动总和值的序列为：$\\{-\\frac{16}{112}, \\frac{47}{112}, \\frac{31}{112}, \\frac{15}{112}, -\\frac{1}{112}, \\frac{34}{112}, \\frac{18}{112}, \\frac{2}{112}, \\frac{16}{112}, 0\\}$。\n\n富集分数 (ES) 是该移动总和与零的最大偏差。也就是移动总和绝对值的最大值：\n$$ES = \\max_{i=1,\\ldots,10} |ES_i|$$\n该集合中的最大值为 $ES_2 = \\frac{47}{112}$。最小值为 $ES_1 = -\\frac{16}{112}$。\n与零的最大偏差为 $\\max(\\frac{47}{112}, |-\\frac{16}{112}|) = \\max(\\frac{47}{112}, \\frac{16}{112}) = \\frac{47}{112}$。\n因此，富集分数为 $\\frac{47}{112}$。数字 $47$ 是一个质数，不能整除 $112 = 2^4 \\times 7$，所以这个分数是最简形式。\n\n前导子集由基因集 $S$ 中，在排序列表里出现在达到最大富集分数位置（含）之前的所有基因组成。最大分数 $ES = \\frac{47}{112}$ 出现在排序位置 $i=2$ 处。排序列表到位置 2 为止的基因为 $\\{\\text{MYC}, \\text{TP53}\\}$。该集合与基因集 $S$ 的交集为 $\\{\\text{TP53}\\}$。因此，前导子集为 $\\{\\text{TP53}\\}$。",
            "answer": "$$\\boxed{\\frac{47}{112}}$$"
        },
        {
            "introduction": "原始的富集分数（$ES$）受基因集大小和排序列表的影响，难以直接比较，因此需要将其标准化为归一化富集分数（Normalized Enrichment Score, $NES$）。本练习模拟了将观察到的 $ES$ 与通过置换检验生成的零分布进行比较的过程，从而计算出 $NES$ 。掌握这一关键步骤对于评估富集结果的统计显著性至关重要。",
            "id": "4345921",
            "problem": "在基因集富集分析 (GSEA) 中，一个基因集的观测富集分数 $ES$ 是通过对一个排序的基因列表进行游走求和统计得到的，而 $ES$ 大小的空分布是通过表型标签置换生成的，用以估计伪富集的预期大小。为了消除对基因集大小和抽样变异性的依赖，标准化过程使用绝对富集分数的空分布将观测到的 $ES$ 映射到一个无量纲的标度上。考虑一个基因集，其观测到的 $ES$ 等于 $0.62$。通过 $N$ 次置换，绝对富集分数的经验空分布得出的均值为 $0.31$，标准差为 $0.12$。假设当从绝对值空分布映射到标准化富集分数 $NES$ 时，标准化过程保留了观测 $ES$ 的符号。\n\n使用应用于绝对空分布大小的均值标准化和 $z$-分数标准化的统计定义，计算以下两个 $NES$ 值：\n- 均值标准化的 $NES$，以及\n- $z$-分数标准化的 $NES$。\n\n请将您的最终答案以行向量 $\\left(NES_{\\text{mean}}, NES_{z}\\right)$ 的顺序呈现，并将每个值四舍五入到四位有效数字。无需单位。",
            "solution": "首先，确定给定的值：\n- 观测富集分数，$ES_{obs} = 0.62$。\n- 通过置换生成的绝对富集分数的空分布 $|ES|_{null}$ 具有以下特性：\n  - 均值，$\\mu_{|ES|} = 0.31$。\n  - 标准差，$\\sigma_{|ES|} = 0.12$。\n\n问题指明标准化过程保留了观测 $ES$ 的符号。由于 $ES_{obs} = 0.62$ 是正数，所以两个得到的 $NES$ 值都将是正数。标准化是通过将观测分数的绝对值 $|ES_{obs}|$ 与绝对值空分布进行对比来实现的。\n\n观测富集分数的绝对值为 $|ES_{obs}| = |0.62| = 0.62$。\n\n两种要求的标准化方法是均值标准化和 $z$-分数标准化。\n\n1.  **均值标准化的 $NES$ ($NES_{\\text{mean}}$)**\n    在 GSEA 的背景下，均值标准化涉及将观测分数通过空分布的均值进行标准化。问题指示我们使用绝对分数的空分布。因此，将观测 $ES$ 的绝对值除以来自空分布的绝对分数的均值。然后应用原始 $ES_{obs}$ 的符号。\n\n    公式为：\n    $$NES_{\\text{mean}} = \\text{sign}(ES_{obs}) \\times \\frac{|ES_{obs}|}{\\mu_{|ES|}}$$\n    鉴于 $ES_{obs} > 0$，则 $\\text{sign}(ES_{obs}) = +1$。\n    代入给定值：\n    $$NES_{\\text{mean}} = \\frac{0.62}{0.31} = 2$$\n    四舍五入到四位有效数字，结果为 $2.000$。\n\n2.  **$z$-分数标准化的 $NES$ ($NES_{z}$)**\n    $z$-分数标准化通过表示一个值与分布均值相差的标准差数量来重新缩放该值。在这里，我们根据绝对分数空分布的均值和标准差来标准化观测 $ES$ 的绝对值 $|ES_{obs}|$。保留原始 $ES_{obs}$ 的符号。\n\n    $z$-分数的公式是 $z = \\frac{(x - \\mu)}{\\sigma}$。将此应用于我们的情境中：\n    $$NES_{z} = \\text{sign}(ES_{obs}) \\times \\frac{|ES_{obs}| - \\mu_{|ES|}}{\\sigma_{|ES|}}$$\n    同样，由于 $ES_{obs} > 0$，所以 $\\text{sign}(ES_{obs}) = +1$。\n    代入给定值：\n    $$NES_{z} = \\frac{0.62 - 0.31}{0.12} = \\frac{0.31}{0.12}$$\n    $$NES_{z} \\approx 2.58333...$$\n    将此值四舍五入到四位有效数字，得到 $2.583$。\n\n最终答案应以行向量 $(NES_{\\text{mean}}, NES_{z})$ 的形式呈现，并将计算出的值四舍五入到四位有效数字。\n计算出的值为 $NES_{\\text{mean}} = 2.000$ 和 $NES_{z} = 2.583$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 2.000  2.583 \\end{pmatrix}}$$"
        },
        {
            "introduction": "为了深入检验对 GSEA 计算逻辑的理解，我们可以考虑一个极限情况。这个思想实验要求您推导出一个仅包含单个基因的基因集的富集分数的封闭形式表达式 。通过这种方式，您可以将 $ES$ 与该基因在列表中的排名直接联系起来，从而加深对 GSEA 算法基本原理的数学直觉。",
            "id": "2393962",
            "problem": "考虑应用于基因排序列表的基因集富集分析（GSEA; Gene Set Enrichment Analysis）。设有一个包含 $N$ 个不同基因的排序列表 $\\mathcal{L}$，其排名从 $1$（顶部）到 $N$（底部）。设基因集 $\\mathcal{S}$ 只包含一个基因（因此 $N_H = |\\mathcal{S}| = 1$），并假设该基因在列表 $\\mathcal{L}$ 中的排名为 $k \\in \\{1,2,\\dots,N\\}$。使用指数为 $p \\ge 0$ 的标准GSEA加权移动总和定义：从 $i=1$ 到 $i=N$ 向下扫描列表时，定义移动总和 $R(i)$ 如下。如果排名第 $i$ 的基因在 $\\mathcal{S}$ 中，则将 $R(i)$ 增加 $|r_i|^{p} / NR$，其中 $NR = \\sum_{g \\in \\mathcal{S}} |r_g|^{p}$；如果它不在 $\\mathcal{S}$ 中，则将 $R(i)$ 减少 $1/(N - N_H)$。定义富集分数（Enrichment Score）$ES$ 为在此过程中遇到的移动总和的最大值，即 $ES = \\max_{1 \\le i \\le N} R(i)$。请将 $ES$ 完全表示为仅含 $N$ 和 $k$ 的封闭形式函数。不需要进行数值计算或四舍五入，也无需报告单位。",
            "solution": "### 解答\n我们定义移动总和 $R(i)$ 从 $R(0)=0$ 开始。在每一步 $j \\in \\{1, 2, \\dots, N\\}$，移动总和的变化量为 $\\Delta_j$。\n一次“命中”仅在排名 $i=k$ 时发生。由于基因集 $\\mathcal{S}$ 只包含一个基因（设其度量值为 $r_k$），归一化因子 $NR = |r_k|^p$。因此，对于任意 $p \\ge 0$，命中时的增量为 $\\Delta_k = |r_k|^p / |r_k|^p = 1$（假设 $r_k \\neq 0$）。\n一次“未命中”在任何排名 $i \\neq k$ 时发生。减量为 $-\\frac{1}{N-N_H}$。由于 $N_H=1$，减量为 $-\\frac{1}{N-1}$。\n因此，如果 $j=k$，则 $\\Delta_j = 1$；如果 $j \\neq k$，则 $\\Delta_j = -\\frac{1}{N-1}$。\n\n在步骤 $i$ 的移动总和由 $R(i) = \\sum_{j=1}^{i} \\Delta_j$ 给出。我们根据 $i$ 相对于 $k$ 的值分情况分析 $R(i)$。\n\n情况1：$1 \\le i  k$。\n在此范围内，每一步都是“未命中”。\n$$R(i) = \\sum_{j=1}^{i} \\left(-\\frac{1}{N-1}\\right) = i \\left(-\\frac{1}{N-1}\\right) = -\\frac{i}{N-1}$$\n由于 $i \\ge 1$ 且 $N > 1$，此范围内的所有 $R(i)$ 值均为负数。命中前一刻的值是 $R(k-1) = -\\frac{k-1}{N-1}$。\n\n情况2：$i=k$。\n移动总和包括 $k-1$ 次未命中和在步骤 $k$ 的一次命中。\n$$R(k) = R(k-1) + \\Delta_k = -\\frac{k-1}{N-1} + 1 = \\frac{-(k-1) + (N-1)}{N-1} = \\frac{N-k}{N-1}$$\n由于 $1 \\le k \\le N$，我们有 $0 \\le N-k \\le N-1$，所以 $0 \\le R(k) \\le 1$。\n\n情况3：$k  i \\le N$。\n在步骤 $i$ 的移动总和是步骤 $k$ 的总和加上从 $k+1$ 到 $i$ 所有步骤的减量。共有 $i-k$ 个这样的步骤，全都是未命中。\n$$R(i) = R(k) + \\sum_{j=k+1}^{i} \\left(-\\frac{1}{N-1}\\right) = R(k) - \\frac{i-k}{N-1}$$\n代入 $R(k)$ 的表达式：\n$$R(i) = \\frac{N-k}{N-1} - \\frac{i-k}{N-1} = \\frac{(N-k) - (i-k)}{N-1} = \\frac{N-i}{N-1}$$\n在此范围 $k  i \\le N$ 内，随着 $i$ 增加，$N-i$ 减少，因此 $R(i)$ 是 $i$ 的严格递减函数。该值序列从 $R(k+1) = \\frac{N-(k+1)}{N-1}$ 开始，到 $R(N) = \\frac{N-N}{N-1}=0$ 结束。\n\n为了找到富集分数 $ES = \\max_{1 \\le i \\le N} R(i)$，我们必须在 $R(i)$ 的所有表达式中找到最大值。\n- 对于 $1 \\le i  k$，$R(i) = -i/(N-1) \\le 0$。\n- 对于 $i \\ge k$，$R(i) = (N-i)/(N-1)$。由于 $i>k$，有 $N-i  N-k$，这意味着对所有 $i > k$ 都有 $R(i)  R(k)$（假设 $N-1>0$）。\n$i \\ge k$ 时的值序列 $R(i)$ 为 $R(k), R(k+1), \\dots, R(N)$，这是一个严格递减序列。\n因此，在范围 $i \\ge k$ 内的最大值是 $R(k)$。\n由于所有 $i  k$ 的 $R(i)$ 值均为非正数，而 $R(k)$ 是非负数，因此全局最大值是 $R(k)$。\n\n因此，富集分数为 $ES = R(k) = \\frac{N-k}{N-1}$。",
            "answer": "$$\\boxed{\\frac{N-k}{N-1}}$$"
        }
    ]
}