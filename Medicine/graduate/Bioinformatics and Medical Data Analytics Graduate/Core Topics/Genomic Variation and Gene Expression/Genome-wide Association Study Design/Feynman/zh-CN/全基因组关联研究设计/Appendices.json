{
    "hands_on_practices": [
        {
            "introduction": "在全基因组关联研究 (GWAS) 的设计中，群体分层是一个必须谨慎处理的关键混杂因素。如果病例和对照组的祖源背景存在系统性差异，并且等位基因频率也因祖源而异，那么即使某个单核苷酸多态性 (SNP) 与疾病毫无因果关系，也可能观察到虚假的关联信号。本练习 () 将通过一个假设场景，手把手地向您展示这种偏误是如何产生的，并量化其对关联检验统计量（如优势比）的影响。",
            "id": "4568675",
            "problem": "考虑一项设计为病例-对照研究的全基因组关联研究 (GWAS)，该研究在一个分层群体中进行，该群体包含两个亚群体，记为 $S_{1}$ 和 $S_{2}$。$S_{1}$ 中的疾病患病率为 $\\pi_{1} = 0.1$，$S_{2}$ 中的疾病患病率为 $\\pi_{2} = 0.2$。一个单核苷酸多态性 (SNP) 在 $S_{1}$ 中的次要等位基因频率为 $q_{1} = 0.2$，在 $S_{2}$ 中为 $q_{2} = 0.5$。该 SNP 对疾病没有因果效应，意味着在每个亚群体内部，该等位基因与疾病状态是独立的。\n\n基础群体是两个亚群体的等量混合，混合权重为 $w_{1} = 0.5$ 和 $w_{2} = 0.5$。对照组是从非患病个体中抽样的，抽样比例与其在基础群体中的出现比例成正比（即，对于亚群体 $S_{i}$，与 $w_{i}(1 - \\pi_{i})$ 成正比）。然而，病例组是根据设计从患病率较高的亚群体 $S_{2}$ 中过采样得到的：在病例组中，有 $\\alpha_{2} = 0.8$ 的比例来自 $S_{2}$，有 $\\alpha_{1} = 0.2$ 的比例来自 $S_{1}$。\n\n定义朴素等位基因优势比为病例组中等位基因优势与对照组中等位基因优势之比，计算时忽略亚群体标签，将所有病例汇集在一起，所有对照汇集在一起。假设在大样本极限下，期望频率等于观测比例，并且每个亚群体内部都符合哈迪-温伯格平衡。\n\n仅使用这些前提和定义，计算次要等位基因的朴素等位基因优势比。请以精确值的形式给出最终答案，无需四舍五入。",
            "solution": "该问题要求在一个存在群体分层的病例-对照研究中计算朴素等位基因优势比。分析过程将首先确定汇集的病例组和汇集的对照组中的次要等位基因频率，然后利用这些频率计算优势比。\n\n设 $A$ 表示次要等位基因，$a$ 表示主要等位基因。亚群体 $S_i$ 中的次要等位基因频率为 $q_i$。给定值为 $q_1 = 0.2$ 和 $q_2 = 0.5$。亚群体 $S_i$ 中的疾病患病率为 $\\pi_i$，给定值为 $\\pi_1 = 0.1$ 和 $\\pi_2 = 0.2$。基础群体是两个亚群体的等量混合，权重为 $w_1 = w_2 = 0.5$。\n\n朴素等位基因优势比 $OR_{naive}$ 定义为汇集的病例组中次要等位基因的优势与汇集的对照组中次要等位基因的优势之比。设 $q_{case}$ 为所有病例中等位基因 $A$ 的频率，$q_{control}$ 为所有对照中等位基因 $A$ 的频率。该优势比由以下公式给出：\n$$\nOR_{naive} = \\frac{q_{case} / (1 - q_{case})}{q_{control} / (1 - q_{control})}\n$$\n问题的核心是计算 $q_{case}$ 和 $q_{control}$。\n\n首先，我们计算汇集的病例组中的次要等位基因频率 $q_{case}$。问题陈述，最终的病例组由来自亚群体 $S_1$ 的比例为 $\\alpha_1 = 0.2$ 的个体和来自亚群体 $S_2$ 的比例为 $\\alpha_2 = 0.8$ 的个体组成。因此，$P(S_1|\\text{Case}) = \\alpha_1$ 且 $P(S_2|\\text{Case}) = \\alpha_2$。\n问题陈述，该 SNP 没有因果效应，这意味着在每个亚群体内部，等位基因频率与疾病状态无关。因此，来自亚群体 $S_i$ 的病例中的等位基因频率就是该亚群体中的等位基因频率 $q_i$。\n使用全概率公式，病例组中的总次要等位基因频率为：\n$$\nq_{case} = P(A|\\text{Case}) = P(A|\\text{Case}, S_1)P(S_1|\\text{Case}) + P(A|\\text{Case}, S_2)P(S_2|\\text{Case})\n$$\n$$\nq_{case} = q_1 \\alpha_1 + q_2 \\alpha_2\n$$\n代入给定值：\n$$\nq_{case} = (0.2)(0.2) + (0.5)(0.8) = 0.04 + 0.40 = 0.44\n$$\n以分数形式表示，$q_{case} = \\frac{44}{100} = \\frac{11}{25}$。\n\n接下来，我们计算汇集的对照组中的次要等位基因频率 $q_{control}$。首先，我们必须确定对照组的构成。对照组是从非患病个体中抽样的，抽样比例与其在基础群体中的出现比例成正比。亚群体 $S_i$ 中非患病个体在总人口中所占的比例与 $w_i(1 - \\pi_i)$ 成正比。\n来自亚群体 $S_1$ 的对照组比例，记为 $\\beta_1$，是：\n$$\n\\beta_1 = P(S_1|\\text{Control}) = \\frac{w_1(1 - \\pi_1)}{w_1(1 - \\pi_1) + w_2(1 - \\pi_2)}\n$$\n来自亚群体 $S_2$ 的对照组比例，记为 $\\beta_2$，是：\n$$\n\\beta_2 = P(S_2|\\text{Control}) = \\frac{w_2(1 - \\pi_2)}{w_1(1 - \\pi_1) + w_2(1 - \\pi_2)}\n$$\n代入给定值 $w_1=0.5$, $w_2=0.5$, $\\pi_1=0.1$ 和 $\\pi_2=0.2$：\n$$\n\\beta_1 = \\frac{0.5(1 - 0.1)}{0.5(1 - 0.1) + 0.5(1 - 0.2)} = \\frac{0.5(0.9)}{0.5(0.9) + 0.5(0.8)} = \\frac{0.45}{0.45 + 0.40} = \\frac{0.45}{0.85} = \\frac{45}{85} = \\frac{9}{17}\n$$\n对于 $\\beta_2$：\n$$\n\\beta_2 = \\frac{0.5(0.8)}{0.85} = \\frac{0.40}{0.85} = \\frac{40}{85} = \\frac{8}{17}\n$$\n检验一下，$\\beta_1 + \\beta_2 = \\frac{9}{17} + \\frac{8}{17} = 1$。\n\n现在，我们可以使用全概率公式来计算 $q_{control}$，这与 $q_{case}$ 的计算类似：\n$$\nq_{control} = P(A|\\text{Control}) = P(A|\\text{Control}, S_1)P(S_1|\\text{Control}) + P(A|\\text{Control}, S_2)P(S_2|\\text{Control})\n$$\n$$\nq_{control} = q_1 \\beta_1 + q_2 \\beta_2\n$$\n代入 $q_i$ 和 $\\beta_i$ 的值：\n$$\nq_{control} = (0.2)\\left(\\frac{9}{17}\\right) + (0.5)\\left(\\frac{8}{17}\\right) = \\left(\\frac{1}{5}\\right)\\left(\\frac{9}{17}\\right) + \\left(\\frac{1}{2}\\right)\\left(\\frac{8}{17}\\right)\n$$\n$$\nq_{control} = \\frac{9}{85} + \\frac{4}{17} = \\frac{9}{85} + \\frac{4 \\times 5}{17 \\times 5} = \\frac{9}{85} + \\frac{20}{85} = \\frac{29}{85}\n$$\n\n最后，我们计算朴素等位基因优势比。\n病例组中次要等位基因的优势是：\n$$\n\\text{Odds}_{case} = \\frac{q_{case}}{1 - q_{case}} = \\frac{11/25}{1 - 11/25} = \\frac{11/25}{14/25} = \\frac{11}{14}\n$$\n对照组中次要等位基因的优势是：\n$$\n\\text{Odds}_{control} = \\frac{q_{control}}{1 - q_{control}} = \\frac{29/85}{1 - 29/85} = \\frac{29/85}{56/85} = \\frac{29}{56}\n$$\n朴素等位基因优势比是这两个优势的比值：\n$$\nOR_{naive} = \\frac{\\text{Odds}_{case}}{\\text{Odds}_{control}} = \\frac{11/14}{29/56} = \\frac{11}{14} \\times \\frac{56}{29}\n$$\n因为 $56 = 4 \\times 14$，表达式可以简化为：\n$$\nOR_{naive} = \\frac{11}{\\cancel{14}} \\times \\frac{4 \\times \\cancel{14}}{29} = \\frac{11 \\times 4}{29} = \\frac{44}{29}\n$$\n这个大于 $1$ 的结果说明了群体分层如何在亚群体内部不存在关联的情况下，导致一个伪关联的产生。",
            "answer": "$$\\boxed{\\frac{44}{29}}$$"
        },
        {
            "introduction": "连锁不平衡 (Linkage Disequilibrium, LD) 是理解 GWAS 结果和进行精细定位 (fine-mapping) 的核心概念。它量化了在同一条染色体上，不同位点的等位基因之间的非随机关联程度。本练习 () 旨在通过一个具体的单倍型计数数据集，让您从第一性原理出发，计算连锁不平衡的三个关键指标：$D$、$D'$ 和 $r^2$，从而加深对这些度量及其背后遗传学意义的理解。",
            "id": "4568692",
            "problem": "在全基因组关联研究 (GWAS) 设计的背景下，单核苷酸多态性 (SNP) 对之间的连锁不平衡 (LD) 为标签SNP的选择效率提供了信息。考虑在$N=1000$条染色体样本上观察到的两个双等位基因SNP，其等位基因为$\\{A,a\\}$和$\\{B,b\\}$。观察到的单倍型计数为$(AB,Ab,aB,ab)=(400,100,100,400)$。仅使用基于单倍型和等位基因频率的LD的经典群体遗传学定义，计算这两个SNP的LD系数$D$、标准化系数$D'$以及相关系数的平方$r^{2}$。将每个值表示为精确的有理数，不进行四舍五入且不带单位，并按$D$、$D'$、$r^{2}$的顺序报告这三个数。",
            "solution": "全基因组关联研究 (GWAS) 设计利用连锁不平衡 (LD) 结构来选择信息丰富的标签单核苷酸多态性 (SNP)。对于具有等位基因$\\{A,a\\}$和$\\{B,b\\}$的两个双等位基因位点，LD量化了同一条染色体上两个位点等位基因之间的依赖关系。其基本原理包括以下标准的群体遗传学定义：\n- 单倍型频率定义为四种单倍型的概率，通过其计数除以染色体总数来估计。\n- 等位基因频率是相应单倍型频率的边际总和。\n- LD系数为 $D = P_{AB} - p_{A}p_{B}$，其中$P_{AB}$是$AB$的单倍型频率，$p_{A}$和$p_{B}$分别是$A$和$B$的等位基因频率。\n- 标准化LD为 $D' = D / D_{\\max}$，其中$D_{\\max}$是在给定等位基因频率下$D$可能的最大绝对值；具体来说，如果$D0$，则$D_{\\max}=\\min\\{p_{A}(1-p_{B}),\\,(1-p_{A})p_{B}\\}$，如果$D0$，则$D_{\\max}=\\min\\{p_{A}p_{B},\\,(1-p_{A})(1-p_{B})\\}$。\n- 相关系数的平方为 $r^{2} = \\dfrac{D^{2}}{p_{A}(1-p_{A})\\,p_{B}(1-p_{B})}$。\n\n设单倍型计数表示为$n_{AB}=400$，$n_{Ab}=100$，$n_{aB}=100$和$n_{ab}=400$，总数为$N=1000$。估计的单倍型频率为\n$$\n\\hat{P}_{AB}=\\frac{n_{AB}}{N}=\\frac{400}{1000}=\\frac{2}{5},\\quad\n\\hat{P}_{Ab}=\\frac{n_{Ab}}{N}=\\frac{100}{1000}=\\frac{1}{10},\\quad\n\\hat{P}_{aB}=\\frac{n_{aB}}{N}=\\frac{100}{1000}=\\frac{1}{10},\\quad\n\\hat{P}_{ab}=\\frac{n_{ab}}{N}=\\frac{400}{1000}=\\frac{2}{5}.\n$$\n等位基因频率通过对单倍型进行边缘化得到：\n$$\n\\hat{p}_{A}=\\hat{P}_{AB}+\\hat{P}_{Ab}=\\frac{2}{5}+\\frac{1}{10}=\\frac{1}{2},\\qquad\n\\hat{p}_{B}=\\hat{P}_{AB}+\\hat{P}_{aB}=\\frac{2}{5}+\\frac{1}{10}=\\frac{1}{2}.\n$$\n根据LD系数的定义，\n$$\n\\hat{D}=\\hat{P}_{AB}-\\hat{p}_{A}\\hat{p}_{B}=\\frac{2}{5}-\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)=\\frac{2}{5}-\\frac{1}{4}=\\frac{8}{20}-\\frac{5}{20}=\\frac{3}{20}.\n$$\n由于$\\hat{D}0$，用于标准化的适当界限是\n$$\nD_{\\max}=\\min\\!\\left\\{\\hat{p}_{A}(1-\\hat{p}_{B}),\\,(1-\\hat{p}_{A})\\hat{p}_{B}\\right\\}\n=\\min\\!\\left\\{\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right),\\,\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)\\right\\}\n=\\frac{1}{4}.\n$$\n因此，\n$$\n\\hat{D}'=\\frac{\\hat{D}}{D_{\\max}}=\\frac{\\frac{3}{20}}{\\frac{1}{4}}=\\frac{3}{20}\\cdot 4=\\frac{3}{5}.\n$$\n最后，相关系数的平方为\n$$\n\\hat{r}^{2}=\\frac{\\hat{D}^{2}}{\\hat{p}_{A}(1-\\hat{p}_{A})\\,\\hat{p}_{B}(1-\\hat{p}_{B})}\n=\\frac{\\left(\\frac{3}{20}\\right)^{2}}{\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)}\n=\\frac{\\frac{9}{400}}{\\frac{1}{16}}=\\frac{9}{400}\\cdot 16=\\frac{9}{25}.\n$$\n因此，精确值为$\\hat{D}=\\dfrac{3}{20}$，$\\hat{D}'=\\dfrac{3}{5}$和$\\hat{r}^{2}=\\dfrac{9}{25}$。",
            "answer": "$$\\boxed{\\begin{pmatrix}\\frac{3}{20}  \\frac{3}{5}  \\frac{9}{25}\\end{pmatrix}}$$"
        },
        {
            "introduction": "当一个基因组区域内的多个SNP都显示出与性状的显著关联时，一个核心任务是区分独立的遗传信号和由连锁不平衡（LD）引起的“搭便车”信号。条件分析是解决这一问题的有力工具，它允许我们评估一个SNP在统计上校正了邻近SNP效应后的关联强度。本练习 () 将引导您推导并计算条件 Z-score，展示如何利用边际关联统计量和LD信息来剖析复杂的关联信号。",
            "id": "4568689",
            "problem": "在一项全基因组关联研究（Genome-Wide Association Study, GWAS）中，考虑两个具有加性基因型编码的单核苷酸多态性（single-nucleotide polymorphism, SNP），其汇总检验统计量以边际标准化得分统计量（边际 $Z$ 分数）的形式报告。根据广义线性模型的大样本理论，对于适当缩放的基因型以及二元或定量表型，相关 SNPs 的边际 $Z$ 分数的联合分布可以很好地用一个多元正态分布来近似，该分布在零假设下均值为零，协方差由连锁不平衡（Linkage Disequilibrium, LD）相关矩阵给出。具体来说，对于两个 SNPs，设边际 $Z$ 分数的向量为 $Z=(Z_1,Z_2)^{\\top}$，LD 相关性为 $r$，因此协方差矩阵为 $\\Sigma=\\begin{pmatrix}1  r \\\\ r  1\\end{pmatrix}$。利用这些基础，推导出给定第二个 SNP 的条件下第一个 SNP 的标准化条件 $Z$ 统计量，其形式为将 $Z_1$ 投影到 $Z_2$ 上所产生的残差进行适当归一化的结果。然后，使用观测值 $Z_1=8$，$Z_2=6$ 和 LD 相关性 $r=0.6$ 来计算这个条件 $Z$ 统计量的值。将最终答案表示为一个实数。不需要四舍五入。在首次使用时定义所有缩写词，包括全基因组关联研究 (GWAS)、单核苷酸多态性 (SNP) 和连锁不平衡 (LD)。",
            "solution": "该问题要求在全基因组关联研究（Genome-Wide Association Study, GWAS）的背景下，推导并计算一个标准化的条件检验统计量。GWAS 是一种用于遗传学的方法，旨在将特定的遗传变异，即单核苷酸多态性（single-nucleotide polymorphisms, SNPs），与特定的性狀或疾病联系起来。不同基因座上等位基因之间的统计相关性被称为连锁不平衡（Linkage Disequilibrium, LD）。\n\n问题指出，两个 SNPs 的边际标准化得分统计量（边际 $Z$ 分数）的联合分布，用向量 $Z = (Z_1, Z_2)^{\\top}$ 表示，近似为一个二元正态分布。在任一 SNP 均无关联的零假设下，均值向量为零。协方差矩阵由 LD 相关矩阵给出。因此，统计模型为：\n$$\n\\begin{pmatrix} Z_1 \\\\ Z_2 \\end{pmatrix} \\sim \\mathcal{N} \\left( \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}, \\begin{pmatrix} 1  r \\\\ r  1 \\end{pmatrix} \\right)\n$$\n这里，$E[Z_1] = E[Z_2] = 0$，$\\text{Var}(Z_1) = \\text{Var}(Z_2) = 1$，且相关性 $\\text{Corr}(Z_1, Z_2) = r$，由于方差为单位1，它也是协方差。\n\n任务是推导在给定第二个 SNP 的条件下，第一个 SNP 的标准化条件 $Z$ 统计量 $Z_{1|2}$。该统计量被描述为“将 $Z_1$ 投影到 $Z_2$ 上所产生的残差进行适当归一化”。这意味着一个线性回归框架，其中我们将 $Z_1$ 建模为 $Z_2$ 的函数。\n\n随机变量 $Z_1$ 在 $Z_2$ 上的线性投影是其条件期望 $E[Z_1 | Z_2]$。对于二元正态分布，条件期望是条件变量的线性函数。给定 $Z_2 = z_2$ 时 $Z_1$ 的条件分布的一般公式是正态分布，其均值为 $\\mu_{1|2}$，方差为 $\\sigma_{1|2}^2$：\n$$\n\\mu_{1|2} = E[Z_1 | Z_2 = z_2] = E[Z_1] + \\frac{\\text{Cov}(Z_1, Z_2)}{\\text{Var}(Z_2)} (z_2 - E[Z_2])\n$$\n$$\n\\sigma_{1|2}^2 = \\text{Var}(Z_1 | Z_2 = z_2) = \\text{Var}(Z_1) \\left( 1 - \\text{Corr}(Z_1, Z_2)^2 \\right)\n$$\n代入我们问题中的特定参数：$E[Z_1]=0$，$E[Z_2]=0$，$\\text{Var}(Z_2)=1$，$\\text{Cov}(Z_1, Z_2)=r$，以及 $\\text{Corr}(Z_1, Z_2)=r$。\n$$\nE[Z_1 | Z_2 = z_2] = 0 + \\frac{r}{1}(z_2 - 0) = r z_2\n$$\n因此，$Z_1$ 在 $Z_2$ 上的线性投影是 $rZ_2$。\n\n残差 $R$ 是观测值 $Z_1$ 与其基于投影的预测值（即其条件期望）之间的差：\n$$\nR = Z_1 - E[Z_1 | Z_2] = Z_1 - rZ_2\n$$\n问题要求将此残差“适当归一化”以创建一个标准化的条件 $Z$ 统计量。根据定义，一个标准化的统计量在零假设下均值为 $0$，方差为 $1$。让我们求出残差 $R$ 的无条件均值和方差。\n残差的均值为：\n$$\nE[R] = E[Z_1 - rZ_2] = E[Z_1] - rE[Z_2] = 0 - r(0) = 0\n$$\n残差的方差为：\n$$\n\\text{Var}(R) = \\text{Var}(Z_1 - rZ_2) = \\text{Var}(Z_1) + \\text{Var}(-rZ_2) + 2\\text{Cov}(Z_1, -rZ_2)\n$$\n$$\n\\text{Var}(R) = \\text{Var}(Z_1) + r^2\\text{Var}(Z_2) - 2r\\text{Cov}(Z_1, Z_2)\n$$\n代入已知的方差和协方差：\n$$\n\\text{Var}(R) = 1 + r^2(1) - 2r(r) = 1 + r^2 - 2r^2 = 1 - r^2\n$$\n残差 $R = Z_1 - rZ_2$ 是两个联合正态随机变量的线性组合，因此它本身也服从均值为 $0$、方差为 $1 - r^2$ 的正态分布。\n\n为了获得一个单位方差的标准化统计量（一个 $Z$ 统计量），我们必须将残差除以其标准差，即 $\\sqrt{\\text{Var}(R)} = \\sqrt{1 - r^2}$。因此，给定 SNP $2$ 条件下 SNP $1$ 的标准化条件 $Z$ 统计量（我们记为 $Z_{1|2}$）为：\n$$\nZ_{1|2} = \\frac{R}{\\sqrt{\\text{Var}(R)}} = \\frac{Z_1 - rZ_2}{\\sqrt{1 - r^2}}\n$$\n这个推導出的表达式代表了在考虑了 SNP $1$ 与 SNP $2$ 的 LD 之后，SNP $1$ 的关联信号。\n\n现在，我们使用提供的观测值来计算该统计量：$Z_1 = 8$，$Z_2 = 6$，$r = 0.6$。\n将这些值代入推导出的公式：\n$$\nZ_{1|2} = \\frac{8 - (0.6)(6)}{\\sqrt{1 - (0.6)^2}}\n$$\n首先，我们计算分子：\n$$\n8 - (0.6)(6) = 8 - 3.6 = 4.4\n$$\n接下来，我们计算分母中平方根内的项：\n$$\n1 - (0.6)^2 = 1 - 0.36 = 0.64\n$$\n则分母为：\n$$\n\\sqrt{0.64} = 0.8\n$$\n最后，我们计算条件 $Z$ 统计量的值：\n$$\nZ_{1|2} = \\frac{4.4}{0.8} = \\frac{44}{8} = \\frac{11}{2} = 5.5\n$$\n得到的条件 $Z$ 统计量是 $5.5$。",
            "answer": "$$\\boxed{5.5}$$"
        }
    ]
}