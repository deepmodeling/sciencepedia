{
    "hands_on_practices": [
        {
            "introduction": "要掌握基于规则的临床决策支持系统，我们必须首先理解其核心引擎的工作原理。这个练习将引导你完成这一基本过程：将患者的临床事实转化为逻辑命题，应用包含合取（$\\land$）与析取（$\\lor$）的规则进行评估，并最终通过加权汇总计算出警报严重性得分。通过解决这个问题 ()，你将亲身体验一个规则从数据输入到决策输出的全过程，为后续更复杂的应用打下坚实的基础。",
            "id": "4606609",
            "problem": "一个基于规则的临床决策支持系统使用具有精确布尔语义的命题逻辑和加权线性聚合来生成一个无量纲的警报严重性评分。该问题的基础包括以下经过充分检验的定义和事实：通过真值函数语义定义的合取和析取的命题逻辑，知识库系统中的封闭世界假设（未指明的事实被视为假），以及临床决策支持中使用的规则激活的标准线性加权聚合。合取的定义为：对于命题 $X$ 和 $Y$，其真值 $t(X \\land Y)$ 等于 $1$ 当且仅当 $t(X) = 1$ 且 $t(Y) = 1$，否则为 $0$。析取的定义为：$t(X \\lor Y) = 1$ 当且仅当 $t(X) = 1$ 或 $t(Y) = 1$，否则为 $0$。在封闭世界假设下，任何未出现在患者数据中的前件文字都被赋值为 $0$。\n\n考虑以下旨在检测与非甾体抗炎药 (NSAID) 相关的肾脏和胃肠道风险的患者事实和规则库。该患者的估算肾小球滤过率 (eGFR) 为 $g = 45$ 毫升/分钟/1.73平方米，目前正在服用布洛芬（一种NSAID），并且没有胃肠道 (GI) 出血史。没有正在使用的抗凝剂，也没有正在使用的血管紧张素转换酶 (ACE) 抑制剂。将这些事实编码为布尔命题：$A$ 表示“正在使用布洛芬”，$H$ 表示“有胃肠道出血史”，$B$ 表示“正在使用抗凝剂”，$P$ 表示“正在使用ACE抑制剂”。$g$ 与阈值的数值比较被视为前件文字，如果为真则产生 $1$，如果为假则产生 $0$。该系统的三条规则如下：\n\n- 规则 $R_1$：$A \\land (g  60) \\Rightarrow$ 肾脏风险；权重 $w_1 = 0.57$。\n- 规则 $R_2$：$A \\land (H \\lor B) \\Rightarrow$ 胃肠道风险；权重 $w_2 = 0.28$。\n- 规则 $R_3$：$(g  30) \\lor (A \\land P) \\Rightarrow$ 高严重性禁忌症；权重 $w_3 = 0.42$。\n\n警报严重性评分 $S$ 通过将每条规则的权重与其真值相乘后求和来计算，即 $S = \\sum_{i=1}^{3} w_i \\cdot t(R_i)$，其中 $t(R_i) \\in \\{0,1\\}$ 是通过用给定的患者事实评估其前件得到的规则 $R_i$ 的真值。系统的警报阈值为 $\\theta = 0.50$，这意味着当且仅当 $S \\ge \\theta$ 时触发警报。\n\n请根据患者的事实评估这三条规则及其合取和析取前件，从基本原理推导出警报决策，并计算最终的警报严重性评分 $S$。将最终的严重性评分表示为一个无量纲实数，并将您的答案四舍五入到 $4$ 位有效数字。最终答案中不要包含任何单位。",
            "solution": "该问题是有效的，因为它具有科学依据、表述清晰且客观。它提供了一套完整且一致的定义、事实和规则，这些都是使用命题逻辑和加权聚合的既定原则（这些原则在临床决策支持系统领域是标准方法）计算出唯一解所必需的。\n\n目标是根据一组规则为给定患者计算警报严重性评分 $S$，并确定是否触发警报。该评分使用公式 $S = \\sum_{i=1}^{3} w_i \\cdot t(R_i)$ 计算，其中 $w_i$ 是规则 $R_i$ 的权重，$t(R_i)$ 是其前件的布尔真值（真为 $1$，假为 $0$）。\n\n首先，我们必须将患者的临床数据形式化为问题中定义的命题文字的真值。患者数据如下：\n- 估算肾小球滤过率，$g = 45$。\n- 正在使用布洛芬，对应于命题 $A$。\n- 无胃肠道出血史，对应于命题 $H$。\n- 无正在使用的抗凝剂，对应于命题 $B$。\n- 无正在使用的ACE抑制剂，对应于命题 $P$。\n\n基于这些事实，我们为这些命题赋真值：\n- $t(A) = 1$ 因为患者正在服用布洛芬。\n- $t(H) = 0$ 因为没有胃肠道出血史。\n- $t(B) = 0$ 因为没有正在使用的抗凝剂。\n- $t(P) = 0$ 因为没有正在使用的ACE抑制剂。\n\n接下来，我们评估涉及患者 eGFR（$g = 45$）的数值比较文字：\n- 文字 $(g  60)$ 评估为 $45  60$，为真。因此，$t(g  60) = 1$。\n- 文字 $(g  30)$ 评估为 $45  30$，为假。因此，$t(g  30) = 0$。\n\n现在我们可以评估每条规则的前件以确定其真值 $t(R_i)$。\n\n评估规则 $R_1$：前件是 $A \\land (g  60)$。\n真值 $t(R_1)$ 是合取式 $t(A \\land (g  60))$ 的真值。\n根据合取的定义，$t(X \\land Y)$ 为 $1$ 当且仅当 $t(X)=1$ 且 $t(Y)=1$。\n我们有 $t(A) = 1$ 和 $t(g  60) = 1$。\n因此，$t(R_1) = 1 \\land 1 = 1$。规则 $R_1$ 被激活。\n\n评估规则 $R_2$：前件是 $A \\land (H \\lor B)$。\n真值 $t(R_2)$ 是 $t(A \\land (H \\lor B))$。我们首先评估析取式 $(H \\lor B)$。\n根据析取的定义，$t(X \\lor Y)$ 为 $1$ 当且仅当 $t(X)=1$ 或 $t(Y)=1$。\n我们有 $t(H) = 0$ 和 $t(B) = 0$。\n因此，$t(H \\lor B) = 0 \\lor 0 = 0$。\n现在我们评估合取式 $A \\land (H \\lor B)$。我们有 $t(A) = 1$ 和 $t(H \\lor B) = 0$。\n因此，$t(R_2) = 1 \\land 0 = 0$。规则 $R_2$ 未被激活。\n\n评估规则 $R_3$：前件是 $(g  30) \\lor (A \\land P)$。\n真值 $t(R_3)$ 是 $t((g  30) \\lor (A \\land P))$。我们首先评估合取式 $(A \\land P)$。\n我们有 $t(A) = 1$ 和 $t(P) = 0$。\n因此，$t(A \\land P) = 1 \\land 0 = 0$。\n现在我们评估析取式 $(g  30) \\lor (A \\land P)$。我们有 $t(g  30) = 0$ 和 $t(A \\land P) = 0$。\n因此，$t(R_3) = 0 \\lor 0 = 0$。规则 $R_3$ 未被激活。\n\n在确定了每条规则前件的真值（$t(R_1) = 1$, $t(R_2) = 0$, $t(R_3) = 0$）之后，我们现在可以计算警报严重性评分 $S$。给定的规则权重为 $w_1 = 0.57$，$w_2 = 0.28$ 和 $w_3 = 0.42$。\n$$ S = w_1 \\cdot t(R_1) + w_2 \\cdot t(R_2) + w_3 \\cdot t(R_3) $$\n$$ S = (0.57 \\cdot 1) + (0.28 \\cdot 0) + (0.42 \\cdot 0) $$\n$$ S = 0.57 + 0 + 0 $$\n$$ S = 0.57 $$\n警报阈值给定为 $\\theta = 0.50$。如果 $S \\ge \\theta$，系统将触发警报。\n由于 $S = 0.57$，且 $0.57 \\ge 0.50$，因此确实会生成一个警报。\n\n问题要求将最终警报严重性评分 $S$ 表示为一个无量纲实数，并四舍五入到 $4$ 位有效数字。计算出的评分为 $S=0.57$。将此值表示为 $4$ 位有效数字得到 $0.5700$。",
            "answer": "$$ \\boxed{0.5700} $$"
        },
        {
            "introduction": "一个逻辑上“正确”的规则在临床实践中不一定有效。本练习旨在揭示规则的理论性能与其临床实际效用之间的关键联系，特别是在处理警报疲劳这一普遍挑战时。你将应用贝叶斯定理，利用灵敏度（sensitivity, $Se$）和特异性（specificity, $Sp$）等指标计算阳性预测值（Positive Predictive Value, $PPV$）和阴性预测值（Negative Predictive Value, $NPV$）()，从而深刻理解为何在低患病率场景下，即使是设计良好的规则也可能产生大量的假阳性警报。",
            "id": "4606481",
            "problem": "一家医院实施了一套基于规则的临床决策支持系统（CDSS），该系统根据一个结合了生命体征和实验室阈值的预定义逻辑规则来标记潜在的早期脓毒症。该规则发出的二元警报被视为一种具有已知操作特性的诊断测试：灵敏度为 $0.85$，特异度为 $0.90$。在某给定月份服务的患者群体中，符合早期脓毒症临床定义的疾病患病率为 $\\pi = 0.02$。阳性预测值（PPV）和阴性预测值（NPV）将分别作为给定阳性或阴性警报下患病的后验概率来计算。\n\n从贝叶斯定理以及灵敏度和特异度作为条件概率的核心定义出发，推导 $PPV = \\mathbb{P}(D \\mid T^{+})$ 和 $NPV = \\mathbb{P}(D^{c} \\mid T^{-})$ 的表达式，其中 $D$ 表示患者确实患有早期脓毒症的事件，$T^{+}$ 表示 CDSS 规则触发警报的事件。使用灵敏度 $= 0.85$、特异度 $= 0.90$ 和患病率 $\\pi = 0.02$ 来评估这些表达式。将 $PPV$ 和 $NPV$ 表示为小数，并将答案四舍五入至四位有效数字。\n\n然后，在基于规则的 CDSS 中警报疲劳风险的背景下，利用关于基础率、假阳性和预期警报负担的第一性原理推理来解释计算出的 $PPV$ 和 $NPV$。你的解释应该是定性的，并以推导出的量为基础；不要在给定参数之外引入新的数值假设。",
            "solution": "首先对问题陈述进行科学基础、逻辑一致性和客观性验证。\n\n### 步骤1：提取给定信息\n- CDSS规则的灵敏度：$Se = \\mathbb{P}(T^{+} \\mid D) = 0.85$\n- CDSS规则的特异度：$Sp = \\mathbb{P}(T^{-} \\mid D^c) = 0.90$\n- 早期脓毒症的患病率：$\\pi = \\mathbb{P}(D) = 0.02$\n- $D$ 是患者患有早期脓毒症的事件。\n- $D^c$ 是患者没有患早期脓毒症的事件。\n- $T^{+}$ 是 CDSS 规则触发阳性警报的事件。\n- $T^{-}$ 是 CDSS 规则未触发警报（阴性结果）的事件。\n- 任务是推导并计算阳性预测值 $PPV = \\mathbb{P}(D \\mid T^{+})$ 和阴性预测值 $NPV = \\mathbb{P}(D^c \\mid T^{-})$。\n- $PPV$ 和 $NPV$ 的最终数值答案必须四舍五入至四位有效数字。\n- 任务还要求在警报疲劳的背景下对结果进行定性解释。\n\n### 步骤2：使用提取的给定信息进行验证\n该问题具有科学依据，是贝叶斯概率在医学诊断中的标准应用。灵敏度、特异度、患病率、PPV 和 NPV 的概念是流行病学和医学信息学的基础。所提供的数值对于临床筛查工具是符合实际的。该问题是适定的，因为提供了所有必要信息来推导出一个唯一、稳定的解。语言精确客观。该问题没有验证标准中列出的任何缺陷。\n\n### 步骤3：结论与行动\n该问题被判定为 **有效**。将提供完整解答。\n\n### 推导与计算\n\n让我们根据给定信息正式定义概率。\n该疾病（早期脓毒症）的患病率为 $\\pi = \\mathbb{P}(D) = 0.02$。\n不患该疾病的概率为 $\\mathbb{P}(D^c) = 1 - \\mathbb{P}(D) = 1 - \\pi = 1 - 0.02 = 0.98$。\n\n灵敏度，或称真阳性率（TPR），是在患有该疾病的情况下出现阳性警报的概率：\n$$Se = \\mathbb{P}(T^{+} \\mid D) = 0.85$$\n特异度，或称真阴性率（TNR），是在没有该疾病的情况下出现阴性警报的概率：\n$$Sp = \\mathbb{P}(T^{-} \\mid D^c) = 0.90$$\n\n由此，我们可以推导出互补概率：\n假阴性率（FNR）是在患有该疾病的情况下出现阴性警报的概率：\n$$\\mathbb{P}(T^{-} \\mid D) = 1 - \\mathbb{P}(T^{+} \\mid D) = 1 - Se = 1 - 0.85 = 0.15$$\n假阳性率（FPR）是在没有该疾病的情况下出现阳性警报的概率：\n$$\\mathbb{P}(T^{+} \\mid D^c) = 1 - \\mathbb{P}(T^{-} \\mid D^c) = 1 - Sp = 1 - 0.90 = 0.10$$\n\n**阳性预测值（PPV）推导**\n\nPPV 是在给定阳性警报的情况下患有该疾病的后验概率，即 $\\mathbb{P}(D \\mid T^{+})$。使用贝叶斯定理：\n$$PPV = \\mathbb{P}(D \\mid T^{+}) = \\frac{\\mathbb{P}(T^{+} \\mid D) \\mathbb{P}(D)}{\\mathbb{P}(T^{+})}$$\n分母 $\\mathbb{P}(T^{+})$ 是出现阳性警报的总概率。可以使用全概率定律将其展开：\n$$\\mathbb{P}(T^{+}) = \\mathbb{P}(T^{+} \\mid D) \\mathbb{P}(D) + \\mathbb{P}(T^{+} \\mid D^c) \\mathbb{P}(D^c)$$\n代入灵敏度、特异度和患病率的定义：\n$$PPV = \\frac{(Se)(\\pi)}{(Se)(\\pi) + (1 - Sp)(1 - \\pi)}$$\n现在，我们用给定的值来评估这个表达式：\n$$PPV = \\frac{(0.85)(0.02)}{(0.85)(0.02) + (1 - 0.90)(1 - 0.02)} = \\frac{0.017}{0.017 + (0.10)(0.98)}$$\n$$PPV = \\frac{0.017}{0.017 + 0.098} = \\frac{0.017}{0.115} \\approx 0.147826...$$\n四舍五入到四位有效数字，$PPV = 0.1478$。\n\n**阴性预测值（NPV）推导**\n\nNPV 被定义为在给定阴性警报的情况下不患该疾病的后验概率，即 $\\mathbb{P}(D^c \\mid T^{-})$。使用贝叶斯定理：\n$$NPV = \\mathbb{P}(D^c \\mid T^{-}) = \\frac{\\mathbb{P}(T^{-} \\mid D^c) \\mathbb{P}(D^c)}{\\mathbb{P}(T^{-})}$$\n分母 $\\mathbb{P}(T^{-})$ 是出现阴性警报的总概率。可以使用全概率定律将其展开：\n$$\\mathbb{P}(T^{-}) = \\mathbb{P}(T^{-} \\mid D^c) \\mathbb{P}(D^c) + \\mathbb{P}(T^{-} \\mid D) \\mathbb{P}(D)$$\n代入灵敏度、特异度和患病率的定义：\n$$NPV = \\frac{(Sp)(1 - \\pi)}{(Sp)(1 - \\pi) + (1 - Se)(\\pi)}$$\n现在，我们用给定的值来评估这个表达式：\n$$NPV = \\frac{(0.90)(1 - 0.02)}{(0.90)(1 - 0.02) + (1 - 0.85)(0.02)} = \\frac{(0.90)(0.98)}{(0.90)(0.98) + (0.15)(0.02)}$$\n$$NPV = \\frac{0.882}{0.882 + 0.003} = \\frac{0.882}{0.885} \\approx 0.996610...$$\n四舍五入到四位有效数字，$NPV = 0.9966$。\n\n### 在警报疲劳背景下的解读\n\n计算出的阳性预测值为 $PPV = 0.1478$。这一结果表明，当 CDSS 对某位患者发出警报时，该患者实际患有早期脓毒症的概率仅为 $14.78\\%$。反过来说，这意味着 $1 - PPV = 1 - 0.1478 = 0.8522$，即 $85.22\\%$ 的警报是假阳性。这种极低的信噪比是导致警报疲劳的主要原因。\n\n当临床医生被大量警报淹没，而其中绝大多数不具有临床可操作性时，就会产生警报疲劳。在这种情况下，大约每 $100$ 次警报中，只有约 $15$ 次对应于真正的早期脓毒症病例，而 $85$ 次将是假警报。尽管灵敏度（$0.85$）和特异度（$0.90$）都相当高，但导致这种低 PPV 的根本原因是该疾病的低患病率或基础率（$\\pi = 0.02$）。健康个体的数量（占人口的 $98\\%$）远大于脓毒症患者的数量（$2\\%$）。即使将一个不算高的假阳性率 $10\\%$（$1 - Sp$）应用于这个庞大的健康人群，所产生的假阳性警报的绝对数量也远远超过从少数脓毒症人群中产生的真阳性警报的数量。\n\n让我们考虑一个包含 $10,000$ 名患者的队列。\n脓毒症患者数量：$10,000 \\times 0.02 = 200$。\n非脓毒症患者数量：$10,000 \\times 0.98 = 9,800$。\n真阳性警报数量：$200 \\times Se = 200 \\times 0.85 = 170$。\n假阳性警报数量：$9,800 \\times (1-Sp) = 9,800 \\times 0.10 = 980$。\n总警报数量：$170 + 980 = 1,150$。\n真警报的比例是 $\\frac{170}{1150} \\approx 0.1478$，这正是 PPV。与真阳性（$170$）相比，假阳性（$980$）的巨大数量构成了显著的“警报负担”。反复调查警报却发现没有潜在疾病的临床医生可能会变得不敏感，并可能开始忽略、无视或不信任所有警报，包括那些至关重要的真阳性警报。这种行为违背了 CDSS 旨在提高患者安全的初衷。\n\n相比之下，计算出的阴性预测值为 $NPV = 0.9966$。这个极高的值表明 CDSS 的阴性结果高度可靠。如果没有触发警报，患者没有患早期脓毒症的概率为 $99.66\\%$。这在排除该疾病方面提供了很强的临床价值，并使临床医生能够自信地将资源集中到其他地方。然而，警报疲劳问题是由阳性警报的管理所驱动的，其中低 PPV 对系统的可用性和有效性构成了重大挑战。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.1478  0.9966 \\end{pmatrix}}$$"
        },
        {
            "introduction": "理论知识最终需要通过现代技术标准来实现。本练习将带你进入基于标准的临床决策支持系统的世界，在这里，规则不再是抽象的陈述，而是使用临床质量语言（Clinical Quality Language, CQL）编写并作用于快速医疗互操作性资源（Fast Healthcare Interoperability Resources, FHIR）数据之上。通过逐步解析CQL脚本并根据给定的FHIR数据包进行评估 ()，你将模拟在真实医疗IT环境中执行决策支持逻辑的全过程，掌握将理论应用于实践的关键技能。",
            "id": "4606553",
            "problem": "一家医院实施了一个基于规则的临床决策支持系统，该系统使用快速医疗保健互操作性资源 (FHIR) 和临床质量语言 (CQL) 来评估高钾血症风险。给定一个单患者的 FHIR Bundle（R4 版本），其中包含恰好两个 Observation 资源和一个 MedicationRequest 资源。评估使用 FHIR R4 的标准 FHIR-to-CQL 模型映射、用于列表筛选、时间间隔和排序的临床质量语言 (CQL) 原生语义，以及用于量值的统一计量单位代码 (UCUM)。\n\n假设和评估上下文：\n- 对于所有对 $Now()$ 的引用，使用临床质量语言 (CQL) 的时间点评估，逻辑时钟固定在 $@2025\\text{-}11\\text{-}11\\text{T}00{:}00{:}00\\text{Z}$。\n- 时间间隔算术使用 CQL 标准语义。当 $X$ 是一个时间点时，将 $X$ during $[a,b)$ 解释为 $a  X  b$。\n- 除所列资源外，没有其他相关资源。下面省略的字段应视为不存在。\n\nFHIR Bundle 内容（仅含必要字段）：\n- 观察资源 $O_1$：\n  - resourceType: \"Observation\"\n  - status: \"final\"\n  - code.coding: system \"http://loinc.org\", code \"2823-3\"\n  - valueQuantity.value: $5.8$\n  - valueQuantity.unit: \"mmol/L\"\n  - valueQuantity.system: \"http://unitsofmeasure.org\"\n  - valueQuantity.code: \"mmol/L\"\n  - effectiveDateTime: \"@2025-11-10T09:00:00Z\"\n- 观察资源 $O_2$：\n  - resourceType: \"Observation\"\n  - status: \"final\"\n  - code.coding: system \"http://loinc.org\", code \"2823-3\"\n  - valueQuantity.value: $5.2$\n  - valueQuantity.unit: \"mmol/L\"\n  - valueQuantity.system: \"http://unitsofmeasure.org\"\n  - valueQuantity.code: \"mmol/L\"\n  - effectiveDateTime: \"@2025-11-08T09:00:00Z\"\n- 药物请求资源 $M_1$：\n  - resourceType: \"MedicationRequest\"\n  - status: \"active\"\n  - intent: \"order\"\n  - medicationCodeableConcept.coding: system \"http://www.nlm.nih.gov/research/umls/rxnorm\", code \"29046\" (赖诺普利 lisinopril)\n  - authoredOn: \"@2025-11-01T12:00:00Z\"\n\n用于评估的临床质量语言 (CQL) 逻辑如下：\n\nlibrary Hyperkalemia version '1.0.0'\nusing FHIR version '4.0.1'\ninclude FHIRHelpers version '4.0.1' called FHIRHelpers\n\ndefine \"Window Start\":\n  Now() - 3 days\n\ndefine \"Recent Serum Potassium\":\n  [Observation] O\n    where O.status in {'final','amended'}\n      and exists (O.code.coding C where C.system = 'http://loinc.org' and C.code = '2823-3')\n      and (O.effective as dateTime) during Interval(\"Window Start\", Now())\n\ndefine \"Latest Serum Potassium\":\n  Last(\"Recent Serum Potassium\" O sort by (O.effective as dateTime))\n\ndefine \"Is Hyperkalemic\":\n  let Q: (\"Latest Serum Potassium\".value as Quantity)\n  return (Q.unit = 'mmol/L' or Q.code = 'mmol/L') and (Q.value  5.5)\n\ndefine \"On Risk Medication\":\n  exists (\n    [MedicationRequest] M\n      where M.status = 'active'\n        and exists (M.medicationCodeableConcept.coding R\n                      where R.system = 'http://www.nlm.nih.gov/research/umls/rxnorm'\n                        and R.code in {'29046','617314','316049'})\n  )\n\ndefine \"Hyperkalemia Alert\":\n  \"Is Hyperkalemic\" and \"On Risk Medication\"\n\n任务：\n- 根据指定的假设，对照提供的 FHIR Bundle 评估 CQL 定义。计算 CQL 表达式 \"Hyperkalemia Alert\" 的值。\n- 将结果以数值形式表示，如果为 true 则为 $1$，如果为 false 则为 $0$。无需四舍五入。答案是无量纲的，不得包含任何单位。",
            "solution": "问题陈述已经过验证，被确定为一个定义明确、有科学依据的客观问题。它提供了一套完整且一致的数据（FHIR 资源）和逻辑（CQL 表达式），可用于确定性评估。该场景在临床信息学领域是现实的。我们开始解题。\n\n任务是评估最终的临床质量语言 (CQL) 表达式 `\"Hyperkalemia Alert\"`，其值为布尔值。最终结果必须表示为 $1$ (true) 或 $0$ (false)。评估过程通过顺序解析所提供的 CQL 库中的每个 `define` 语句来进行。\n\n评估上下文将 `Now()` 函数的逻辑时钟设置在一个固定的时间点：\n$$\n\\text{Now()} = @2025\\text{-}11\\text{-}11\\text{T}00{:}00{:}00\\text{Z}\n$$\n\n**1. 评估 `\"Window Start\"`**\n\n该定义计算了用于纳入观察资源的时间窗口的起始点。\n$$\n\\text{\"Window Start\"} := \\text{Now()} - 3 \\text{ days}\n$$\n代入 `Now()` 的值：\n$$\n\\text{\"Window Start\"} = @2025\\text{-}11\\text{-}11\\text{T}00{:}00{:}00\\text{Z} - 3 \\text{ days} = @2025\\text{-}11\\text{-}08\\text{T}00{:}00{:}00\\text{Z}\n$$\n\n**2. 评估 `\"Recent Serum Potassium\"`**\n\n此表达式根据多个标准筛选可用的 `Observation` 资源（$O_1$ 和 $O_2$）。结果是一个匹配资源的列表。\n\n筛选标准如下：\n- `O.status in {'final','amended'}`\n- `exists (O.code.coding C where C.system = 'http://loinc.org' and C.code = '2823-3')`\n- `(O.effective as dateTime) during Interval(\"Window Start\", Now())`\n\n第三个标准的时间间隔是从 `\"Window Start\"` 到 `Now()`，即 $I = [@2025-11-08\\text{T}00:00:00\\text{Z}, @2025-11-11\\text{T}00:00:00\\text{Z})$。问题规定，对于时间点 $X$，$X$ during $[a,b)$ 被解释为 $a  X  b$。\n\n我们来评估每个观察资源：\n\n- **对于观察资源 $O_1$：**\n    - `status`：`'final'`。这匹配 `{'final','amended'}`。\n    - `code.coding`：`system = 'http://loinc.org'`，`code = '2823-3'`。这匹配。\n    - `effectiveDateTime`：$t_1 = @2025-11-10\\text{T}09:00:00\\text{Z}$。我们检查 `@2025-11-08\\text{T}00:00:00\\text{Z}  t_1  @2025-11-11\\text{T}00:00:00\\text{Z}` 是否成立。这是成立的。\n    - 所有标准均满足。$O_1$ 被包含在 `\"Recent Serum Potassium\"` 中。\n\n- **对于观察资源 $O_2$：**\n    - `status`：`'final'`。这匹配 `{'final','amended'}`。\n    - `code.coding`：`system = 'http://loinc.org'`，`code = '2823-3'`。这匹配。\n    - `effectiveDateTime`：$t_2 = @2025-11-08\\text{T}09:00:00\\text{Z}$。我们检查 `@2025-11-08\\text{T}00:00:00\\text{Z}  t_2  @2025-11-11\\text{T}00:00:00\\text{Z}` 是否成立。这是成立的。\n    - 所有标准均满足。$O_2$ 被包含在 `\"Recent Serum Potassium\"` 中。\n\n`\"Recent Serum Potassium\"` 的结果列表包含两个观察资源：`[$O_2, O_1$]`。在此阶段，顺序未指定。\n\n**3. 评估 `\"Latest Serum Potassium\"`**\n\n此表达式对 `\"Recent Serum Potassium\"` 列表进行排序，并选择最后一个元素。\n$$\n\\text{\"Latest Serum Potassium\"} := \\text{Last} ( \\text{\"Recent Serum Potassium\"} \\text{ O sort by (O.effective as dateTime)} )\n$$\n要排序的列表是 `[$O_1, O_2$]`。排序键是 `effectiveDateTime`，按升序排列。\n- $O_1$ `effectiveDateTime`：`@2025-11-10T09:00:00Z`\n- $O_2$ `effectiveDateTime`：`@2025-11-08T09:00:00Z`\n\n由于 `@2025-11-08...` 早于 `@2025-11-10...`，排序后的列表是 `[$O_2, O_1$]`。`Last` 操作符返回此排序列表的最后一个元素，即 $O_1$。\n因此，`\"Latest Serum Potassium\"` 的评估结果为观察资源 $O_1$。\n\n**4. 评估 `\"Is Hyperkalemic\"`**\n\n此表达式评估关于 `\"Latest Serum Potassium\"` 值的条件。\n$$\n\\text{let Q} := (\\text{\"Latest Serum Potassium\"}.\\text{value as Quantity}) \\\\\n\\text{return (Q.unit = 'mmol/L' or Q.code = 'mmol/L') and (Q.value  5.5)}\n$$\n该资源是 $O_1$。其 `valueQuantity` 字段对应于 CQL `Quantity` 类型 $Q$。\n- `Q.value` = $5.8$\n- `Q.unit` = `'mmol/L'`\n- `Q.code` = `'mmol/L'`\n\n我们评估布尔表达式：\n- `(Q.unit = 'mmol/L' or Q.code = 'mmol/L')`：即 `('mmol/L' = 'mmol/L' or 'mmol/L' = 'mmol/L')`，结果为 `true`。\n- `(Q.value  5.5)`：即 `(5.8  5.5)`，结果为 `true`。\n\n最终表达式为 `true and true`，评估结果为 `true`。\n因此，`\"Is Hyperkalemic\"` 为 `true`。\n\n**5. 评估 `\"On Risk Medication\"`**\n\n此表达式检查是否存在针对某些药物的活动 `MedicationRequest`。\n$$\n\\text{exists} ( [\\text{MedicationRequest}] \\text{ M where M.status = 'active' and exists} ( \\dots ) )\n$$\n我们检查唯一的 `MedicationRequest` 资源 $M_1$。\n- `M.status = 'active'`: $M_1$ 的状态是 `'active'`。此条件满足。\n- 内部的 `exists` 子句检查药物代码：\n  - `M.medicationCodeableConcept.coding R where R.system = 'http://www.nlm.nih.gov/research/umls/rxnorm' and R.code in {'29046','617314','316049'}`\n  - 对于 $M_1$，其编码具有 `system = 'http://www.nlm.nih.gov/research/umls/rxnorm'` 和 `code = '29046'`。\n  - system 匹配。代码 `'29046'` 在指定的集合 `{'29046','617314','316049'}` 中。\n  - 内部的 `exists` 为 `true`。\n\n由于 $M_1$ 的两个条件都满足，筛选出的 `MedicationRequest` 列表为 `[$M_1$]`。因为该列表不为空，外部的 `exists` 表达式评估为 `true`。\n因此，`\"On Risk Medication\"` 为 `true`。\n\n**6. 评估 `\"Hyperkalemia Alert\"`**\n\n这是最终的表达式，结合了前面的结果。\n$$\n\\text{\"Hyperkalemia Alert\"} := \\text{\"Is Hyperkalemic\" and \"On Risk Medication\"}\n$$\n代入已评估的布尔值：\n$$\n\\text{\"Hyperkalemia Alert\"} = \\text{true and true} = \\text{true}\n$$\n\n**结论**\n\nCQL 表达式 `\"Hyperkalemia Alert\"` 的评估结果为 `true`。问题要求将此结果以数值形式表示，true 为 $1$，false 为 $0$。因此，最终答案是 $1$。",
            "answer": "$$\n\\boxed{1}\n$$"
        }
    ]
}