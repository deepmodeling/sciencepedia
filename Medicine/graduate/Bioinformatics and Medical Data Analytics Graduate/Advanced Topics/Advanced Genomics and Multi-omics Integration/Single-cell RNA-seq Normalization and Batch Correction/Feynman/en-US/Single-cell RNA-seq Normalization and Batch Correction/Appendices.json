{
    "hands_on_practices": [
        {
            "introduction": "The most fundamental challenge in comparing single-cell transcriptomes is the vast difference in sequencing depth, or library size, between individual cells. This exercise provides a foundational hands-on experience with library-size normalization, a critical first step in nearly all scRNA-seq analysis pipelines. By working through this example , you will see firsthand how apparent differences in raw gene counts can be entirely explained by technical sampling variation, reinforcing the necessity of placing all cells onto a common scale before making biological comparisons.",
            "id": "4608308",
            "problem": "A single-cell RNA sequencing (scRNA-seq) experiment produces count vectors for genes in individual cells, where the observed counts are proportional to the underlying transcript composition and the cell-specific library size. Under the standard sampling view, observed counts $x = (x_{1}, \\dots, x_{p})$ in a cell arise from sampling $n$ molecules with gene-wise probabilities $(\\pi_{1}, \\dots, \\pi_{p})$, so that the expected counts satisfy $\\mathbb{E}[x_{i}] = n \\pi_{i}$ and the vector $x$ is proportional to the composition vector $\\pi$ with proportionality factor $n$ (the library size). Library-size normalization (also called counts per $s$ or counts-per-$s$ scaling) seeks a normalized vector that represents gene-wise fractions scaled to a fixed total $s$, so the sum of its entries equals $s$, thereby removing the effect of library size while preserving composition.\n\nConsider two cells with four genes and observed count vectors $x^{(1)} = [100, 50, 0, 350]$ and $x^{(2)} = [200, 100, 0, 700]$. Perform library-size normalization for each cell to a common scale $s = 10^{4}$, ensuring that each normalized vector sums to $10^{4}$. Then, compute the Euclidean distance $D$ between the two normalized vectors. Provide $D$ as the final answer. Do not round; report the exact value. Briefly interpret the result in terms of whether differences between the two cells are attributable to library size versus compositional differences, and discuss the implication for batch correction in single-cell RNA-seq analysis within bioinformatics and medical data analytics.",
            "solution": "The problem requires us to perform library-size normalization on two single-cell count vectors and then compute the Euclidean distance between the resulting normalized vectors. This process is fundamental to removing technical artifacts related to sequencing depth before comparing cellular profiles.\n\nFirst, we calculate the total library size (total UMI count) for each cell.\n-   For cell 1, the library size $n_1$ is the sum of its gene counts:\n    $n_1 = 100 + 50 + 0 + 350 = 500$.\n-   For cell 2, the library size $n_2$ is:\n    $n_2 = 200 + 100 + 0 + 700 = 1000$.\n\nNext, we normalize each count vector to a common scale $s = 10,000$. The normalization is performed by dividing each count by its cell's library size and then multiplying by the target scale $s$. Let $y^{(c)}$ be the normalized vector for cell $c$.\n-   For cell 1, the normalized vector $y^{(1)}$ is:\n    $$ y^{(1)} = \\frac{10000}{500} \\times [100, 50, 0, 350] = 20 \\times [100, 50, 0, 350] = [2000, 1000, 0, 7000] $$\n-   For cell 2, the normalized vector $y^{(2)}$ is:\n    $$ y^{(2)} = \\frac{10000}{1000} \\times [200, 100, 0, 700] = 10 \\times [200, 100, 0, 700] = [2000, 1000, 0, 7000] $$\n\nFinally, we compute the Euclidean distance $D$ between the two normalized vectors $y^{(1)}$ and $y^{(2)}$.\n$$ D = \\sqrt{(2000-2000)^2 + (1000-1000)^2 + (0-0)^2 + (7000-7000)^2} = \\sqrt{0^2 + 0^2 + 0^2 + 0^2} = 0 $$\nThe Euclidean distance is exactly $0$.\n\n**Interpretation:** The fact that the Euclidean distance is zero means that after normalization, the two cells are identical in their gene expression composition. The initial differences in the raw count vectors ($x^{(2)}$ had counts exactly double those of $x^{(1)}$) were entirely attributable to the difference in library size ($n_2$ was double $n_1$). This result powerfully demonstrates that raw counts are misleading and that library-size normalization is an essential first step to reveal the true compositional similarities or differences between cells, which is a foundational concept for any downstream analysis, including batch correction.",
            "answer": "$$ \\boxed{0} $$"
        },
        {
            "introduction": "While simple library-size scaling is intuitive, it can be skewed by highly expressed genes or significant compositional differences between cells. To address this, more robust methods have been developed. This practice  delves into the median-of-ratios method, a widely-adopted technique that provides a more stable estimate of cell-specific size factors by using a pseudo-reference cell. Completing this exercise will give you practical insight into a powerful algorithm at the heart of popular differential expression tools.",
            "id": "4608294",
            "problem": "In Single-cell Ribonucleic Acid sequencing (scRNA-seq) normalization, a common starting point is the multiplicative sampling-depth model: for each gene index $g$ and cell index $c$, the observed count $x_{g,c}$ arises from an underlying gene-specific expression level $q_g$ multiplied by a cell-specific sampling depth or size factor $s_c$, with stochastic sampling noise that is multiplicative on the original scale and additive on the logarithmic scale. Under this model, a robust approach to estimate $s_c$ up to a common multiplicative constant leverages a per-gene expression proxy shared across cells, such as the per-gene geometric mean $m_g$, and then aggregates the gene-wise ratios within each cell using a robust statistic across genes.\n\nConsider three genes ($g \\in \\{1,2,3\\}$) and two cells ($c \\in \\{1,2\\}$). You are given per-gene geometric means $m_g$ and observed counts $x_{g,c}$ as follows:\n- $m_1 = 10$, $m_2 = 50$, $m_3 = 100$,\n- $x_{1,1} = 12$, $x_{2,1} = 45$, $x_{3,1} = 105$,\n- $x_{1,2} = 8$, $x_{2,2} = 60$, $x_{3,2} = 95$.\n\nUsing the median-of-ratios logic grounded in the multiplicative model and robust aggregation across genes, compute the unscaled size factors for the two cells and then rescale them so that the geometric mean across the two rescaled size factors equals $1$. Express your final rescaled size factors in exact form (do not round), and report them as a two-entry row matrix. No physical units are required in the final answer.",
            "solution": "The problem asks for the calculation of rescaled size factors for two cells based on the median-of-ratios normalization method, a common technique in single-cell RNA sequencing (scRNA-seq) data analysis.\n\nFirst, we must validate the problem statement.\nThe givens are:\n- The number of genes is $3$, with indices $g \\in \\{1, 2, 3\\}$.\n- The number of cells is $2$, with indices $c \\in \\{1, 2\\}$.\n- The multiplicative model for observed counts $x_{g,c}$ is given by $x_{g,c} \\approx q_g \\cdot s_c$, where $q_g$ is the gene-specific expression level and $s_c$ is the cell-specific size factor.\n- The per-gene geometric means, which serve as a proxy for $q_g$, are: $m_1 = 10$, $m_2 = 50$, $m_3 = 100$.\n- The observed counts for cell $c=1$ are: $x_{1,1} = 12$, $x_{2,1} = 45$, $x_{3,1} = 105$.\n- The observed counts for cell $c=2$ are: $x_{1,2} = 8$, $x_{2,2} = 60$, $x_{3,2} = 95$.\n- The procedure is to estimate an unscaled size factor for each cell by taking the median of the ratios of observed counts to the gene-specific geometric means.\n- The final size factors must be rescaled such that their geometric mean is equal to $1$.\n\nThe problem is scientifically grounded, describing a standard bioinformatics algorithm (median-of-ratios normalization). It is well-posed, providing all necessary data and a clear, deterministic procedure. The language is objective and the setup is complete and consistent. Therefore, the problem is valid, and we may proceed with the solution.\n\nThe core principle is that for a given cell $c$, the ratio $\\frac{x_{g,c}}{m_g}$ provides an estimate of the size factor $s_c$ for each gene $g$. To obtain a single robust estimate for $s_c$, we compute the median of these ratios across all genes. Let's denote the unscaled size factor for cell $c$ as $\\hat{s}'_c$.\n\nFor cell $c=1$, we calculate the ratios for each gene:\n- Gene $1$: $r_{1,1} = \\frac{x_{1,1}}{m_1} = \\frac{12}{10} = 1.2$\n- Gene $2$: $r_{2,1} = \\frac{x_{2,1}}{m_2} = \\frac{45}{50} = \\frac{9}{10} = 0.9$\n- Gene $3$: $r_{3,1} = \\frac{x_{3,1}}{m_3} = \\frac{105}{100} = 1.05$\n\nThe set of ratios for cell $1$ is $\\{1.2, 0.9, 1.05\\}$. To find the median, we sort this set: $\\{0.9, 1.05, 1.2\\}$. The median is the middle value.\n$$ \\hat{s}'_1 = \\text{median}(\\{1.2, 0.9, 1.05\\}) = 1.05 = \\frac{105}{100} = \\frac{21}{20} $$\n\nFor cell $c=2$, we perform the same calculation:\n- Gene $1$: $r_{1,2} = \\frac{x_{1,2}}{m_1} = \\frac{8}{10} = 0.8$\n- Gene $2$: $r_{2,2} = \\frac{x_{2,2}}{m_2} = \\frac{60}{50} = \\frac{6}{5} = 1.2$\n- Gene $3$: $r_{3,2} = \\frac{x_{3,2}}{m_3} = \\frac{95}{100} = 0.95$\n\nThe set of ratios for cell $2$ is $\\{0.8, 1.2, 0.95\\}$. Sorting this set gives $\\{0.8, 0.95, 1.2\\}$. The median is the middle value.\n$$ \\hat{s}'_2 = \\text{median}(\\{0.8, 1.2, 0.95\\}) = 0.95 = \\frac{95}{100} = \\frac{19}{20} $$\n\nSo, the unscaled size factors are $\\hat{s}'_1 = \\frac{21}{20}$ and $\\hat{s}'_2 = \\frac{19}{20}$.\n\nNext, we need to rescale these factors so that their geometric mean is $1$. Let the final rescaled size factors be $\\hat{s}_1$ and $\\hat{s}_2$. They are obtained by dividing the unscaled factors by a common scaling constant, $k$: $\\hat{s}_c = \\frac{\\hat{s}'_c}{k}$.\nThe condition is $\\sqrt{\\hat{s}_1 \\cdot \\hat{s}_2} = 1$.\nSubstituting the expression for the rescaled factors:\n$$ \\sqrt{\\frac{\\hat{s}'_1}{k} \\cdot \\frac{\\hat{s}'_2}{k}} = 1 $$\n$$ \\frac{\\sqrt{\\hat{s}'_1 \\cdot \\hat{s}'_2}}{k} = 1 $$\nThis implies that the scaling constant $k$ must be the geometric mean of the unscaled size factors:\n$$ k = \\sqrt{\\hat{s}'_1 \\cdot \\hat{s}'_2} $$\nLet's compute $k$:\n$$ k = \\sqrt{\\frac{21}{20} \\cdot \\frac{19}{20}} = \\sqrt{\\frac{21 \\cdot 19}{20^2}} = \\frac{\\sqrt{399}}{20} $$\n\nNow, we can compute the final rescaled size factors $\\hat{s}_1$ and $\\hat{s}_2$:\n$$ \\hat{s}_1 = \\frac{\\hat{s}'_1}{k} = \\frac{21/20}{\\sqrt{399}/20} = \\frac{21}{\\sqrt{399}} $$\n$$ \\hat{s}_2 = \\frac{\\hat{s}'_2}{k} = \\frac{19/20}{\\sqrt{399}/20} = \\frac{19}{\\sqrt{399}} $$\n\nThe final rescaled size factors for cell $1$ and cell $2$ are $\\frac{21}{\\sqrt{399}}$ and $\\frac{19}{\\sqrt{399}}$, respectively. These are to be reported as a two-entry row matrix.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{21}{\\sqrt{399}} & \\frac{19}{\\sqrt{399}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "After applying normalization and batch correction techniques, a critical question remains: did the integration work? Relying on visual inspection of embeddings like UMAP can be misleading. This practice introduces the Local Inverse Simpson's Index (LISI), a rigorous, quantitative metric for assessing the quality of data integration on a local, per-cell level . By calculating LISI, you will learn how to objectively measure the degree of batch mixing, a key criterion for a successful batch correction.",
            "id": "4608304",
            "problem": "In single-cell ribonucleic acid sequencing (single-cell RNA-seq) integration, a central goal is to mix batches while preserving cell-type structure. Consider a local neighborhood of $k$ nearest neighbors around a query cell in an integrated embedding. Let $p_{\\ell}$ denote the empirical proportion of label $\\ell$ among these $k$ neighbors. A widely used, well-tested base measure of diversity, the Simpson concentration index, is defined as $D = \\sum_{\\ell} p_{\\ell}^{2}$, which equals the probability that two labels drawn independently from the local label distribution are the same. The Local Inverse Simpson's Index (LISI) is constructed from this base to quantify local label diversity in the embedding. Define the Local Inverse Simpson's Index (LISI) and explain how it yields the integration Local Inverse Simpson's Index (iLISI) when $\\ell$ indexes batch labels and the cell-type Local Inverse Simpson's Index (cLISI) when $\\ell$ indexes biological cell types.\n\nNow consider a toy neighborhood with $k = 20$ nearest neighbors. The batch label counts in this neighborhood are $n_{A} = 9$ for batch $A$, $n_{B} = 6$ for batch $B$, and $n_{C} = 5$ for batch $C$. Using only these batch labels, compute the LISI for this neighborhood. Round your final numerical answer to four significant figures. No units are required.",
            "solution": "The problem asks for three things: a definition of the Local Inverse Simpson's Index (LISI), an explanation of its application as iLISI and cLISI, and a calculation based on provided data.\n\nFirst, we define the LISI. The problem states that the Simpson concentration index is $D = \\sum_{\\ell} p_{\\ell}^{2}$. This index measures the probability that two individuals (in this case, cells) drawn randomly from a population (the local neighborhood) belong to the same group (label $\\ell$). A value of $D=1$ indicates a complete lack of diversity (all individuals are of the same group), while a smaller value of $D$ indicates higher diversity. The \"Inverse Simpson's Index\" is the reciprocal of the concentration index. Therefore, the Local Inverse Simpson's Index (LISI) is defined as:\n$$\n\\text{LISI} = \\frac{1}{D} = \\frac{1}{\\sum_{\\ell} p_{\\ell}^{2}}\n$$\nThe LISI value can be interpreted as the effective number of distinct labels in the local neighborhood. A higher LISI value signifies greater diversity (mixing) of labels.\n\nSecond, we explain the distinction between integration LISI (iLISI) and cell-type LISI (cLISI). The distinction lies in what the label $\\ell$ represents.\n-   **iLISI (integration LISI)**: In this case, the label $\\ell$ represents the experimental batch or dataset of origin for each cell. The goal of data integration is to mix cells from different batches so that technical batch effects are removed. A high iLISI score for a cell's neighborhood is desirable, as it indicates the neighborhood is composed of cells from many different batches. This signifies successful batch correction.\n-   **cLISI (cell-type LISI)**: Here, the label $\\ell$ represents the biological cell type. A successful integration should preserve the underlying biological structure, meaning that cells of the same type should remain clustered together. Therefore, a low cLISI score is desirable. A low cLISI indicates that a cell's neighborhood is homogeneous with respect to cell type, signifying that the biological distinctions have not been blurred or erroneously mixed.\n\nThird, we compute the LISI for the given toy neighborhood using batch labels. This corresponds to calculating an iLISI value.\nThe total number of nearest neighbors is $k = 20$.\nThe counts for the three batch labels are:\n-   Batch A: $n_{A} = 9$\n-   Batch B: $n_{B} = 6$\n-   Batch C: $n_{C} = 5$\n\nThe empirical proportions ($p_{\\ell}$) for each batch are calculated as $p_{\\ell} = n_{\\ell} / k$.\n$$\np_A = \\frac{n_A}{k} = \\frac{9}{20}\n$$\n$$\np_B = \\frac{n_B}{k} = \\frac{6}{20}\n$$\n$$\np_C = \\frac{n_C}{k} = \\frac{5}{20}\n$$\nNext, we calculate the Simpson concentration index, $D$.\n$$\nD = p_A^2 + p_B^2 + p_C^2 = \\left(\\frac{9}{20}\\right)^2 + \\left(\\frac{6}{20}\\right)^2 + \\left(\\frac{5}{20}\\right)^2\n$$\n$$\nD = \\frac{81}{400} + \\frac{36}{400} + \\frac{25}{400} = \\frac{81 + 36 + 25}{400} = \\frac{142}{400} = \\frac{71}{200}\n$$\nFinally, we compute the LISI, which is the reciprocal of $D$.\n$$\n\\text{LISI} = \\frac{1}{D} = \\frac{1}{71/200} = \\frac{200}{71}\n$$\nTo provide a numerical answer, we perform the division and round to four significant figures.\n$$\n\\text{LISI} = \\frac{200}{71} \\approx 2.8169014...\n$$\nRounding to four significant figures yields $2.817$. This value indicates that the effective number of batches in this local neighborhood is approximately $2.817$, suggesting a good degree of mixing among the three present batches.",
            "answer": "$$\\boxed{2.817}$$"
        }
    ]
}