{
    "hands_on_practices": [
        {
            "introduction": "掌握质量调整生命年（QALY）的计算，首先要理解其基本定义，即健康效用函数在时间上的积分。本练习通过一个简化的分段恒定效用函数场景，帮助您直观地把握QALY作为“效用-时间”曲线下面积的核心思想，这是所有后续复杂分析的基础。通过这个练习，您将亲手计算一个病人在不同健康阶段所累积的QALY值。",
            "id": "5053286",
            "problem": "在一项关于新型心力衰竭疗法的转化医学研究中，单个患者在固定随访期内的健康相关生活质量轨迹由瞬时效用函数 $u(t)$ 建模，其中 $t$ 是以年为单位的时间，$u(t) \\in [0,1]$ 反映了在时间 $t$ 的健康状态价值。根据定义，在时间范围 $[0,T]$ 内累积的总质量调整生命年 (QALYs) 是瞬时效用函数的时间积分，即 $u(t)$ 在 $[0,T]$ 上对时间的积分。在为期 $T$ 年的时间范围内，该患者经历了两个临床稳定阶段：从基线到时间 $t_1$ 的较高效应阶段，以及此后的较低效应阶段（由于一次非致命性不良事件）。假设 $u(t)$ 是分段常数函数，当 $t \\in [0,t_1]$ 时，$u(t)=u_1$；当 $t \\in (t_1,T]$ 时，$u(t)=u_2$。取 $u_1=0.82$，$u_2=0.68$，$t_1=9$ 个月，以及 $T=2$ 年。从总 QALYs 在 $[0,T]$ 上的积分定义出发，推导该分段常数轨迹的总 QALYs 表达式，然后计算其数值。使用曲线下面积的观点，结合时间加权的健康状态来解释结果。以 QALYs 为单位表示最终结果，并将您的数值答案四舍五入到四位有效数字。",
            "solution": "在尝试解答之前，对问题陈述进行验证。\n\n**步骤 1：提取已知条件**\n- 瞬时效用函数：$u(t)$，其中 $t$ 是以年为单位的时间，且 $u(t) \\in [0,1]$。\n- 在 $[0,T]$ 上的总质量调整生命年 (QALYs) 定义：$u(t)$ 从 $0$ 到 $T$ 的时间积分。\n- $u(t)$ 的模型：分段常数函数。\n- 第一阶段的效用：当 $t \\in [0,t_1]$ 时，$u(t)=u_1$。\n- 第二阶段的效用：当 $t \\in (t_1,T]$ 时，$u(t)=u_2$。\n- $u_1$ 的值：$0.82$。\n- $u_2$ 的值：$0.68$。\n- 转换时间：$t_1 = 9$ 个月。\n- 总时间范围：$T=2$ 年。\n- 任务要求：推导总 QALYs 的表达式，计算其数值，解释结果，并将最终答案四舍五入到四位有效数字。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据**：该问题具有科学依据。将 QALYs 定义为时间依赖效用函数的积分是健康经济学和成果研究的基石，这些领域对转化医学至关重要。使用分段常数函数是建模健康状态随时间变化的有效标准简化方法。\n- **适定性**：该问题是适定的。它提供了清晰的定义、$u(t)$ 的具体函数形式以及计算唯一解所需的所有参数。\n- **客观性**：问题陈述语言精确、客观，没有主观论断。\n- **完整性与一致性**：该问题是自洽的。所有需要的数据（$u_1$、$u_2$、$t_1$、$T$）均已提供。没有矛盾之处。$t_1$（月）和 $T$（年）的单位不同，需要进行转换，这是解决物理和工程问题的标准步骤，并非不一致。\n- **现实性**：对于患有慢性病并经历不良事件的患者来说，该情景和数值是现实的。\n- **结构**：问题结构清晰，能够导出一个唯一的、有意义的解。\n\n**步骤 3：结论与行动**\n该问题被判定为**有效**。将提供完整解答。\n\n**解题推导**\n\n总质量调整生命年 (QALYs)，记为 $Q$，由瞬时效用函数 $u(t)$ 在指定时间范围 $[0, T]$ 上的积分定义。\n$$ Q = \\int_{0}^{T} u(t) \\, dt $$\n效用函数 $u(t)$ 是一个分段常数函数：\n$$\nu(t) =\n\\begin{cases}\nu_1  \\text{for } 0 \\le t \\le t_1 \\\\\nu_2  \\text{for } t_1  t \\le T\n\\end{cases}\n$$\n其中 $u_1$ 和 $u_2$ 是常数。为了计算该积分，我们必须在不连续点 $t_1$ 处将其拆分：\n$$ Q = \\int_{0}^{t_1} u(t) \\, dt + \\int_{t_1}^{T} u(t) \\, dt $$\n将 $u(t)$ 的常数值代入各自的区间，得到：\n$$ Q = \\int_{0}^{t_1} u_1 \\, dt + \\int_{t_1}^{T} u_2 \\, dt $$\n由于 $u_1$ 和 $u_2$ 相对于积分变量 $t$ 是常数，因此可以将它们从积分中提出：\n$$ Q = u_1 \\int_{0}^{t_1} dt + u_2 \\int_{t_1}^{T} dt $$\n进行积分运算，得到：\n$$ Q = u_1 [t]_{0}^{t_1} + u_2 [t]_{t_1}^{T} $$\n$$ Q = u_1 (t_1 - 0) + u_2 (T - t_1) $$\n由此得出该分段常数轨迹的总 QALYs 的最终推导表达式：\n$$ Q = u_1 t_1 + u_2 (T - t_1) $$\n**解释**\n该表达式具有清晰的几何解释，即效用函数 $u(t)$ 从 $t=0$ 到 $t=T$ 的曲线下面积。它由两个矩形的面积之和构成：\n1.  第一个矩形的高为 $u_1$，宽为 $t_1$。其面积为 $u_1 t_1$，表示在第一个较高效应阶段累积的 QALYs。\n2.  第二个矩形的高为 $u_2$，宽为 $(T - t_1)$。其面积为 $u_2(T - t_1)$，表示在第二个较低效应阶段累积的 QALYs。\n因此，总 QALYs 是每个健康状态的效用值之和，每个效用值都按在该状态下所花费的时间长度进行加权。这就是评估“时间加权健康状态”的本质。\n\n**数值计算**\n给定的参数值为：\n- $u_1 = 0.82$\n- $u_2 = 0.68$\n- $T = 2$ 年\n- $t_1 = 9$ 个月\n\n为保持一致性，所有时间变量必须使用相同的单位。我们将 $t_1$ 从月转换为年。由于一年有 $12$ 个月：\n$$ t_1 = 9 \\, \\text{months} \\times \\frac{1 \\, \\text{year}}{12 \\, \\text{months}} = \\frac{9}{12} \\, \\text{years} = 0.75 \\, \\text{years} $$\n现在，我们将这些数值代入推导出的 $Q$ 的表达式中：\n$$ Q = (0.82)(0.75) + (0.68)(2 - 0.75) $$\n首先，计算第二阶段的持续时间：\n$$ T - t_1 = 2 - 0.75 = 1.25 \\, \\text{years} $$\n将此结果代回 $Q$ 的方程中：\n$$ Q = (0.82)(0.75) + (0.68)(1.25) $$\n现在，我们计算乘积：\n$$ (0.82)(0.75) = 0.615 $$\n$$ (0.68)(1.25) = 0.85 $$\n最后，将两个部分相加，求得总 QALYs：\n$$ Q = 0.615 + 0.85 = 1.465 $$\n问题要求将数值答案四舍五入到四位有效数字。计算出的值 $1.465$ 已经包含四位有效数字（$1$、$4$、$6$、$5$）。因此，无需进一步四舍五入。\n\n该患者在为期 $2$ 年的时间范围内累积的总 QALYs 为 $1.465$。",
            "answer": "$$\n\\boxed{1.465}\n$$"
        },
        {
            "introduction": "在真实的临床研究中，QALY的计算不仅是数学问题，更涉及严谨的方法学。当一项治疗在带来益处的同时也可能引发不良事件（AE），准确评估其净影响就变得至关重要，特别是当AE的症状与疾病本身的症状重叠时。本练习旨在训练您辨别并正确处理效用递减中的“双重计算”陷阱，这是确保成本-效果分析结论可靠性的关键技能。",
            "id": "5053247",
            "problem": "一项转化性试验评估了一种治疗晚期心力衰竭的新疗法，其年化效益以质量调整生命年（QALY）进行概括。质量调整生命年（QALY）定义为健康相关效用函数在时间上的积分，即 $Q = \\int_0^T u(t)\\,dt$，其中 $u(t)$ 是时间 $t$ 时的健康状态效用，$T$ 是评估期限（此处，$T$ 等于 $1$ 年）。效用 $u(t)$ 每周使用一种经过验证的多属性效用量具（MAUI）进行测量，该量具可同时捕捉疼痛、疲劳和恶心。在该试验中，疾病健康状态效用（已包含疾病症状）是分段恒定的：第 $1$–$12$ 周，$u_D(t) = 0.72$；第 $13$–$24$ 周，$u_D(t) = 0.78$；第 $25$–$52$ 周，$u_D(t) = 0.80$。在第 $9$–$20$ 周发生了一次不良事件（AE），该事件引起恶心，并将疲劳从中度加重至重度。MAUI 经过验证的评分表明，在将其他领域固定在疾病水平的情况下，疲劳从中度变为重度会使指数降低 $\\Delta u_F = 0.03$，而从无恶心变为中度恶心会使指数降低 $\\Delta u_N = 0.05$。另一份出版物报告了基于人群的不良事件负效用，在其他方面健康的个体中估计，疲劳为 $0.04$，恶心为 $0.06$。\n\n仅使用 QALY 作为效用-时间曲线下面积的定义以及重叠症状领域不应被重复计算的原则，确定该患者正确的年化 QALY。假设整个过程中的存活率为 $1$，并完全按照规定将每周效用视为分段恒定的段落。哪个选项最准确地避免了疾病症状和不良事件负效用之间的重叠部分的重复计算？\n\nA. $0.7538$ QALYs，通过在第 $9$–$20$ 周从疾病效用中减去已发表的不良事件负效用 $0.04$（疲劳）和 $0.06$（恶心）计算得出。\n\nB. $0.7585$ QALYs，通过在第 $9$–$20$ 周使用 MAUI 的量具内增量递减值 $\\Delta u_F = 0.03$ 和 $\\Delta u_N = 0.05$ 调整疾病效用计算得出。\n\nC. $0.7654$ QALYs，通过仅在第 $9$–$20$ 周减去恶心的 $\\Delta u_N = 0.05$ 并保持疲劳不变（因为疲劳已是疾病效用的一部分）计算得出。\n\nD. $0.7629$ QALYs，通过在第 $9$–$20$ 周对疾病效用应用 $8\\%$ 的乘法比例减少以反映合并的不良事件负效用计算得出。",
            "solution": "该问题要求计算一名参与转化性试验患者的年化质量调整生命年（QALY）。计算必须考虑具有时变效用的基线疾病状态和在特定持续时间内发生的不良事件（AE）。任务的核心是选择正确的方法来调整不良事件的健康效用，并严格遵守不重复计算症状影响的原则。\n\n首先，让我们将 QALY 计算公式化。总评估期限为 $T=1$ 年，相当于 $52$ 周。QALY 定义为效用函数 $u(t)$ 在此期间的积分：\n$$Q = \\int_0^T u(t)\\,dt$$\n由于效用是按周给出的分段恒定函数，积分可以计算为总和，其中时间单位是年。对于一个持续 $N$ 周且效用恒为 $u$ 的时期，对总 QALY 的贡献为 $u \\times \\frac{N}{52}$。\n$$Q = \\sum_{i} u_i \\cdot \\frac{N_i}{52}$$\n其中 $u_i$ 是在 $N_i$ 周内的恒定效用，且 $\\sum_i N_i = 52$。\n\n我们首先在不考虑不良事件的情况下，根据疾病状态效用 $u_D(t)$ 建立基线年化 QALY。\n疾病效用分为三段：\n1.  第 $1$–$12$ 周（$N_1 = 12$ 周）：$u_D(t) = 0.72$\n2.  第 $13$–$24$ 周（$N_2 = 12$ 周）：$u_D(t) = 0.78$\n3.  第 $25$–$52$ 周（$N_3 = 28$ 周）：$u_D(t) = 0.80$\n\n仅考虑疾病状态的总年化 QALY $Q_D$ 将是：\n$$Q_D = \\frac{1}{52} \\left[ (12 \\times 0.72) + (12 \\times 0.78) + (28 \\times 0.80) \\right]$$\n$$Q_D = \\frac{1}{52} \\left[ 8.64 + 9.36 + 22.4 \\right] = \\frac{40.4}{52} \\approx 0.776923$$\n\n接下来，我们必须考虑不良事件（AE）。不良事件发生在第 $9$ 周到第 $20$ 周，总持续时间为 $20 - 9 + 1 = 12$ 周。该不良事件会引起恶心并加重疲劳。关键步骤是确定在此期间应用的正确效用递减量。\n\n问题提供了两组负效用值：\n1.  **MAUI 量具内递减值：** 疲劳加重的 $\\Delta u_F = 0.03$ 和出现恶心的 $\\Delta u_N = 0.05$。这些值代表了由用于确定基线疾病效用 $u_D(t)$ 的同一量具测量的效用变化。\n2.  **基于人群的负效用：** 疲劳为 $0.04$，恶心为 $0.06$，来自另一份出版物，并在“其他方面健康的个体”中估算。\n\n指导原则是避免“重复计算”。基线疾病效用 $u_D(t)$ 是用 MAUI 测量的，该量具已包含疲劳作为一个领域。因此，基线效用分数已经反映了因疾病导致中度疲劳的负效用。在此基础上再应用一个外部的、基于人群的“疲劳”负效用（值 $0.04$）将是错误的，因为它会重复计算疲劳的影响：一次在基线 $u_D(t)$ 中，另一次作为单独的递减量。\n\n正确的方法是使用 MAUI 提供的量具内递减值。这些值旨在测量健康状态的*增量*变化。$\\Delta u_F = 0.03$ 是疲劳从“中度”加重至“重度”所带来的特定效用损失。$\\Delta u_N = 0.05$ 是从“无”恶心变为“中度”恶心的效用损失。这些是可相加的，因为它们影响不同的健康领域（或被指定为单独的递减量）。不良事件期间每周的总效用递减量为：\n$$\\Delta u_{AE} = \\Delta u_F + \\Delta u_N = 0.03 + 0.05 = 0.08$$\n\n现在我们将此递减量应用于不良事件期间（第 $9$–$20$ 周）的效用函数。此期间跨越了两个不同的基线效用段：\n-   **第 $9$–$12$ 周（4周）：** 基线效用为 $u_D(t) = 0.72$。调整后的效用为 $u(t) = 0.72 - 0.08 = 0.64$。\n-   **第 $13$–$20$ 周（8周）：** 基线效用为 $u_D(t) = 0.78$。调整后的效用为 $u(t) = 0.78 - 0.08 = 0.70$。\n\n现在我们可以通过构建全年的完整分段效用函数来计算最终的年化 QALY：\n-   第 $1$–$8$ 周（$8$ 周）：$u(t) = 0.72$\n-   第 $9$–$12$ 周（$4$ 周）：$u(t) = 0.64$\n-   第 $13$–$20$ 周（$8$ 周）：$u(t) = 0.70$\n-   第 $21$–$24$ 周（$4$ 周）：$u(t) = 0.78$\n-   第 $25$–$52$ 周（$28$ 周）：$u(t) = 0.80$\n\n总 QALY 为：\n$$Q = \\frac{1}{52} \\left[ (8 \\times 0.72) + (4 \\times 0.64) + (8 \\times 0.70) + (4 \\times 0.78) + (28 \\times 0.80) \\right]$$\n$$Q = \\frac{1}{52} \\left[ 5.76 + 2.56 + 5.60 + 3.12 + 22.40 \\right]$$\n$$Q = \\frac{39.44}{52} \\approx 0.7584615...$$\n四舍五入到四位小数，得到 $0.7585$ QALYs。\n\n现在，我们评估每个选项。\n\n**A. $0.7538$ QALYs，通过在第 $9$–$20$ 周从疾病效用中减去已发表的不良事件负效用 $0.04$（疲劳）和 $0.06$（恶心）计算得出。**\n此选项使用基于人群的负效用。总递减量为 $$ \\Delta u = 0.04 + 0.06 = 0.10 $$\n-   第 $9$–$12$ 周：$u(t) = 0.72 - 0.10 = 0.62$。\n-   第 $13$–$20$ 周：$u(t) = 0.78 - 0.10 = 0.68$。\n总 QALY 计算如下：\n$$Q = \\frac{1}{52} \\left[ (8 \\times 0.72) + (4 \\times 0.62) + (8 \\times 0.68) + (4 \\times 0.78) + (28 \\times 0.80) \\right]$$\n$$Q = \\frac{1}{52} \\left[ 5.76 + 2.48 + 5.44 + 3.12 + 22.40 \\right] = \\frac{39.2}{52} \\approx 0.753846...$$\n对于所述方法，计算在数值上是正确的。然而，该方法在概念上存在缺陷。它重复计算了疲劳的影响，因为基线疾病效用已经包含了一定程度的疲劳。这违反了问题的核心原则。\n**结论：不正确。**\n\n**B. $0.7585$ QALYs，通过在第 $9$–$20$ 周使用 MAUI 的量具内增量递减值 $\\Delta u_F = 0.03$ 和 $\\Delta u_N = 0.05$ 调整疾病效用计算得出。**\n此选项使用量具内递减值。总递减量为 $\\Delta u_{AE} = 0.03 + 0.05 = 0.08$。如上所述，计算结果为：\n$$Q = \\frac{39.44}{52} \\approx 0.7584615... \\approx 0.7585$$\n计算在数值上是正确的。该方法在概念上是合理的，因为它使用来自同一测量系统（MAUI）的递减值来测量不良事件的*增量*影响，从而避免了重复计算。这完全符合健康效用评估的最佳实践以及问题的明确指示。\n**结论：正确。**\n\n**C. $0.7654$ QALYs，通过仅在第 $9$–$20$ 周减去恶心的 $\\Delta u_N = 0.05$ 并保持疲劳不变（因为疲劳已是疾病效用的一部分）计算得出。**\n此选项试图通过完全忽略疲劳的变化来避免重复计算。使用的递减量仅为 $$ \\Delta u = \\Delta u_N = 0.05 $$\n-   第 $9$–$12$ 周：$u(t) = 0.72 - 0.05 = 0.67$。\n-   第 $13$–$20$ 周：$u(t) = 0.78 - 0.05 = 0.73$。\n总 QALY 计算如下：\n$$Q = \\frac{1}{52} \\left[ (8 \\times 0.72) + (4 \\times 0.67) + (8 \\times 0.73) + (4 \\times 0.78) + (28 \\times 0.80) \\right]$$\n$$Q = \\frac{1}{52} \\left[ 5.76 + 2.68 + 5.84 + 3.12 + 22.40 \\right] = \\frac{39.8}{52} \\approx 0.76538...$$\n对于所述方法，计算在数值上是正确的。然而，其推理是错误的。虽然疲劳是疾病的一部分，但不良事件*加重*了它。MAUI 递减值 $\\Delta u_F = 0.03$ 正确量化了与这种*恶化*相关的效用损失，而不是与一开始就有疲劳相关的效用损失。忽略这种变化会低估不良事件的负面影响。这是对重复计算原则的错误应用。\n**结论：不正确。**\n\n**D. $0.7629$ QALYs，通过在第 $9$–$20$ 周对疾病效用应用 $8\\%$ 的乘法比例减少以反映合并的不良事件负效用计算得出。**\n此选项提出了一个乘法模型。$8\\%$ 的减少可能来自 $\\Delta u_F + \\Delta u_N = 0.03 + 0.05 = 0.08$。效用乘以 $(1-0.08) = 0.92$。\n-   第 $9$–$12$ 周：$u(t) = 0.72 \\times 0.92 = 0.6624$。\n-   第 $13$–$20$ 周：$u(t) = 0.78 \\times 0.92 = 0.7176$。\n总 QALY 计算如下：\n$$Q = \\frac{1}{52} \\left[ (8 \\times 0.72) + (4 \\times 0.6624) + (8 \\times 0.7176) + (4 \\times 0.78) + (28 \\times 0.80) \\right]$$\n$$Q = \\frac{1}{52} \\left[ 5.76 + 2.6496 + 5.7408 + 3.12 + 22.40 \\right] = \\frac{39.6704}{52} \\approx 0.76289...$$\n对于所述方法，计算在数值上是正确的。然而，该方法本身并非标准方法，除非效用量具的属性有此规定。多属性效用量具通常基于一个加法模型，其中递减量被减去。应用乘法模型是一种临时选择，它假设不良事件的负效用与基线健康状态成比例，这是一个不同的理论假设。效用递减的标准和最直接的解释是加法减除。\n**结论：不正确。**",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "现实世界中的医疗决策通常需要预测干预措施在整个生命周期内的长期效果。马尔可夫模型是实现这一目标的核心工具，它通过模拟患者在不同健康状态间的转移来估算累积的成本和QALY。通过这个编程实践，您将从零开始构建一个离散时间队列马尔可夫模型，综合运用状态转移、效用权重、半周期校正和贴现等关键概念，深入体验健康经济学模型的构建过程。",
            "id": "4995247",
            "problem": "您的任务是在全球健康决策分析的背景下，实现一个离散时间队列马尔可夫模型，用以计算折扣质量调整生命年 (QALYs)。请严格从基本定义出发：一个质量调整生命年 (QALY) 是个体生存轨迹上健康相关生命质量权重的时间积分，而卫生经济学中的折扣则应用一个恒定的年率，使得未来健康的价值低于当前健康的价值。在队列马尔可夫模型中，个体在任何给定时间点都处于若干互斥健康状态中的一种，并且在等长周期内状态之间转移的概率是时间同质的。“死亡”是一个吸收态。使用半周期校正来近似每个周期内的连续时间累积。\n\n您的程序必须：\n- 将队列表示为各状态上的概率分布。\n- 使用提供的状态转移矩阵，在周期中向前传播该分布。\n- 通过对周期开始和结束时的健康效用流取平均，乘以以年为单位的周期长度，并在周期中点时间对该累积值进行折扣，从而使用半周期校正计算每个周期内的 QALY 累积。对所有周期的结果求和，以获得指定时间范围内的总折扣 QALYs。\n- 将每个情景的结果四舍五入到 3 位小数，并以年为单位报告答案。\n\n起始定义（请勿使用非从这些定义推导出的快捷公式）：\n- QALY 定义为健康效用对时间的积分，其中效用值位于区间 $[0,1]$ 内，并与生存时间相乘，$1$ 对应于完美健康，$0$ 对应于死亡。\n- 恒定率折扣应用一个因子，该因子取决于年折扣率和健康效应发生的时间。\n- 时间同质性马尔可夫链通过每周期乘以一个固定的转移矩阵来演化状态占据概率向量。\n\n您的程序必须以一种普遍适用、纯数学的方式实现该算法。下面提供的所有数值必须严格按照给定值使用。所有最终输出均以年为单位表示。此任务不涉及角度。所给出的率是小数（例如，$0.03$ 表示百分之三），而不是百分比。\n\n测试套件：\n对于以下每个情景，使用半周期校正计算总折扣 QALYs，并输出一个以年为单位、四舍五入到 3 位小数的浮点数。\n\n情景 A (理想路径：三状态模型，年度周期)：\n- 状态：健康 $H$、患病 $S$、死亡 $D$ (吸收态)。\n- 转移矩阵 $T_A = \\begin{pmatrix} 0.88  0.08  0.04 \\\\ 0.10  0.80  0.10 \\\\ 0.00  0.00  1.00 \\end{pmatrix}$。\n- 效用权重 $u_A = \\begin{pmatrix} 0.92 \\\\ 0.65 \\\\ 0.00 \\end{pmatrix}$。\n- 初始分布 $p_{0,A} = \\begin{pmatrix} 1.00 \\\\ 0.00 \\\\ 0.00 \\end{pmatrix}$。\n- 年折扣率 $r_A = 0.03$。\n- 周期长度 $\\Delta_A = 1.0$ 年。\n- 时间范围 $Y_A = 10.0$ 年。\n\n情景 B (边界条件：零折扣)：\n- 状态和转移与情景 A 相同。\n- 效用权重 $u_B = u_A$。\n- 初始分布 $p_{0,B} = p_{0,A}$。\n- 年折扣率 $r_B = 0.00$。\n- 周期长度 $\\Delta_B = 1.0$ 年。\n- 时间范围 $Y_B = 10.0$ 年。\n\n情景 C (边缘情况：半年周期，更快进展)：\n- 状态：稳定 $St$、进展 $Pr$、死亡 $D$ (吸收态)。\n- 转移矩阵 $T_C = \\begin{pmatrix} 0.70  0.25  0.05 \\\\ 0.00  0.85  0.15 \\\\ 0.00  0.00  1.00 \\end{pmatrix}$。\n- 效用权重 $u_C = \\begin{pmatrix} 0.80 \\\\ 0.50 \\\\ 0.00 \\end{pmatrix}$。\n- 初始分布 $p_{0,C} = \\begin{pmatrix} 1.00 \\\\ 0.00 \\\\ 0.00 \\end{pmatrix}$。\n- 年折扣率 $r_C = 0.03$。\n- 周期长度 $\\Delta_C = 0.5$ 年。\n- 时间范围 $Y_C = 3.0$ 年。\n\n情景 D (边缘情况：时间范围内无死亡)：\n- 状态：良好 $W$、死亡 $D$ (吸收态)。\n- 转移矩阵 $T_D = \\begin{pmatrix} 1.00  0.00 \\\\ 0.00  1.00 \\end{pmatrix}$。\n- 效用权重 $u_D = \\begin{pmatrix} 0.95 \\\\ 0.00 \\end{pmatrix}$。\n- 初始分布 $p_{0,D} = \\begin{pmatrix} 1.00 \\\\ 0.00 \\end{pmatrix}$。\n- 年折扣率 $r_D = 0.03$。\n- 周期长度 $\\Delta_D = 1.0$ 年。\n- 时间范围 $Y_D = 10.0$ 年。\n\n情景 E (边缘情况：高折扣率)：\n- 状态和转移与情景 A 相同。\n- 效用权重 $u_E = u_A$。\n- 初始分布 $p_{0,E} = p_{0,A}$。\n- 年折扣率 $r_E = 0.10$。\n- 周期长度 $\\Delta_E = 1.0$ 年。\n- 时间范围 $Y_E = 10.0$ 年。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按 $A,B,C,D,E$ 的顺序排列结果。每个元素都是一个以年为单位、四舍五入到 3 位小数的浮点数。例如，一个有效的输出格式是 $\\left[ x_A, x_B, x_C, x_D, x_E \\right]$，其中每个 $x_\\cdot$ 都四舍五入到 3 位小数并以年为单位表示。",
            "solution": "该问题要求使用离散时间队列马尔可夫模型计算总折扣质量调整生命年 (QALYs)。解决方案是根据指定的马尔可夫过程、健康效用和经济折扣的基本原理推导出来的。\n\n队列马尔可夫模型描述了一组个体在一系列离散时间间隔（即周期）内，经历一组有限的、互斥的健康状态的演进过程。\n\n设状态集合为 $S = \\{s_1, s_2, \\dots, s_m\\}$，其中 $m$ 是状态的数量。在周期 $k$（其中 $k=0, 1, 2, \\dots$）开始时，队列在每个状态中的比例由一个状态概率行向量 $\\boldsymbol{p}_k = [p_{k,1}, p_{k,2}, \\dots, p_{k,m}]$ 表示，其中 $\\sum_{i=1}^{m} p_{k,i} = 1$。\n\n该模型是时间同质性的，意味着在每个周期内，状态之间的转移概率是恒定的。这些概率包含在一个 $m \\times m$ 的转移矩阵 $T$ 中，其中元素 $T_{ij}$ 是在一个周期内从状态 $s_i$ 移动到状态 $s_j$ 的概率。状态向量根据以下方程演化：\n$$\n\\boldsymbol{p}_{k+1} = \\boldsymbol{p}_k T\n$$\n周期 $k$ 的状态向量可以通过初始状态向量 $\\boldsymbol{p}_0$ 计算得出：\n$$\n\\boldsymbol{p}_k = \\boldsymbol{p}_0 T^k\n$$\n其中 $T^k$ 是矩阵 $T$ 的 $k$ 次幂。\n\n每个健康状态 $s_i$ 都与一个健康相关生命质量权重（或称效用）$u_i$ 相关联，其中 $u_i \\in [0, 1]$。这些权重被收集到一个列向量 $\\boldsymbol{u} = [u_1, u_2, \\dots, u_m]^T$ 中。在周期 $k$ 开始时，队列的总期望效用是状态向量和效用向量的点积：\n$$\nU_k = \\boldsymbol{p}_k \\cdot \\boldsymbol{u} = \\sum_{i=1}^{m} p_{k,i} u_i\n$$\n问题指定使用半周期校正来近似离散周期内 QALYs 的连续累积。在一个周期内累积的 QALYs 是基于该周期开始和结束时平均效用。对于周期 $k$，其时间跨度为从 $t_k = k\\Delta$ 到 $t_{k+1} = (k+1)\\Delta$，其中 $\\Delta$ 是以年为单位的周期长度，周期开始时的期望效用是 $U_k$，结束时是 $U_{k+1} = \\boldsymbol{p}_{k+1} \\cdot \\boldsymbol{u}$。\n\n周期 $k$ 内的平均效用是：\n$$ \\bar{U}_k = \\frac{U_k + U_{k+1}}{2} $$\n在周期 $k$ 内累积的未折扣 QALYs 是这个平均效用乘以周期时长：\n$$ Q_{k, \\text{undiscounted}} = \\bar{U}_k \\Delta = \\left( \\frac{U_k + U_{k+1}}{2} \\right) \\Delta $$\n未来的健康产出比当前的价值要低。这通过使用年折扣率 $r$ 来建模。在时间 $t$ 获得的健康效益会乘以一个折扣因子 $(1+r)^{-t}$。问题指定，一个周期内累积的 QALYs 应被视为在该周期的中点发生来进行折扣。周期 $k$ 的中点时间是 $t_{k, \\text{mid}} = k\\Delta + \\frac{\\Delta}{2} = (k+0.5)\\Delta$。\n\n因此，周期 $k$ 的折扣因子是：\n$$ d_k = \\frac{1}{(1+r)^{t_{k, \\text{mid}}}} = (1+r)^{-(k+0.5)\\Delta} $$\n周期 $k$ 的折扣 QALYs 是未折扣 QALYs 与折扣因子的乘积：\n$$ Q_{k, \\text{discounted}} = Q_{k, \\text{undiscounted}} \\times d_k = \\left( \\frac{(\\boldsymbol{p}_k \\cdot \\boldsymbol{u}) + (\\boldsymbol{p}_{k+1} \\cdot \\boldsymbol{u})}{2} \\right) \\Delta (1+r)^{-(k+0.5)\\Delta} $$\n在 $Y$ 年的时间范围内，总折扣 QALYs 是每个周期折扣 QALYs 的总和。总周期数为 $N = Y/\\Delta$。求和从周期 $k=0$ 到 $k=N-1$：\n$$ Q_{\\text{total}} = \\sum_{k=0}^{N-1} Q_{k, \\text{discounted}} $$\n代入完整表达式，我们得到用于计算的最终公式：\n$$\nQ_{\\text{total}} = \\sum_{k=0}^{N-1} \\left[ \\left( \\frac{(\\boldsymbol{p}_k \\cdot \\boldsymbol{u}) + ((\\boldsymbol{p}_k T) \\cdot \\boldsymbol{u})}{2} \\right) \\Delta (1+r)^{-(k+0.5)\\Delta} \\right]\n$$\n该公式通过迭代每个周期来实现，在迭代中更新状态概率向量，计算周期开始和结束时的效用，应用半周期校正和折扣，并累积结果。每个情景的最终值都四舍五入到 $3$ 位小数。\n\n算法如下：\n1. 对于给定情景，确定参数：转移矩阵 $T$、效用向量 $\\boldsymbol{u}$、初始状态向量 $\\boldsymbol{p}_0$、年折扣率 $r$、周期长度 $\\Delta$ 和时间范围 $Y$。\n2. 计算周期数 $N = Y/\\Delta$。\n3. 初始化总折扣 QALYs，$Q_{\\text{total}} = 0$。\n4. 初始化当前状态向量 $\\boldsymbol{p}_{\\text{current}} = \\boldsymbol{p}_0$。\n5. 对 $k$ 从 $0$ 到 $N-1$ 进行循环：\n    a. 计算下一个周期开始时的状态向量：$\\boldsymbol{p}_{\\text{next}} = \\boldsymbol{p}_{\\text{current}} T$。\n    b. 计算当前周期开始时的效用：$U_{\\text{current}} = \\boldsymbol{p}_{\\text{current}} \\cdot \\boldsymbol{u}$。\n    c. 计算当前周期结束时的效用：$U_{\\text{next}} = \\boldsymbol{p}_{\\text{next}} \\cdot \\boldsymbol{u}$。\n    d. 计算该周期的平均效用：$\\bar{U} = (U_{\\text{current}} + U_{\\text{next}}) / 2$。\n    e. 计算周期中点时间：$t_{\\text{mid}} = (k + 0.5)\\Delta$。\n    f. 计算折扣因子：$d = (1+r)^{-t_{\\text{mid}}}$。\n    g. 计算该周期的折扣 QALYs 并累加到总数中：$Q_{\\text{total}} = Q_{\\text{total}} + \\bar{U} \\Delta d$。\n    h. 更新状态向量以用于下一次迭代：$\\boldsymbol{p}_{\\text{current}} = \\boldsymbol{p}_{\\text{next}}$。\n6. 循环结束后，将 $Q_{\\text{total}}$ 四舍五入到 $3$ 位小数。\n此过程将应用于所有五个提供的情景。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_discounted_qalys(T, u, p0, r, delta, Y):\n    \"\"\"\n    Computes discounted Quality-Adjusted Life Years (QALYs) using a cohort Markov model.\n\n    Args:\n        T (np.ndarray): The state transition probability matrix.\n        u (np.ndarray): The utility vector for the states.\n        p0 (np.ndarray): The initial state probability distribution vector.\n        r (float): The annual discount rate.\n        delta (float): The length of each cycle in years.\n        Y (float): The total time horizon in years.\n\n    Returns:\n        float: The total discounted QALYs.\n    \"\"\"\n    # Ensure all inputs are numpy arrays for consistent matrix operations\n    T = np.asarray(T, dtype=float)\n    u = np.asarray(u, dtype=float)\n    p0 = np.asarray(p0, dtype=float)\n\n    # Calculate the number of cycles\n    num_cycles = int(Y / delta)\n\n    total_discounted_qaly = 0.0\n    p_current = p0\n\n    for k in range(num_cycles):\n        # State vector at the end of the cycle\n        p_next = p_current @ T\n\n        # Utility at the start and end of the cycle\n        utility_current = p_current @ u\n        utility_next = p_next @ u\n        \n        # Average utility over the cycle (half-cycle correction)\n        avg_utility = (utility_current + utility_next) / 2.0\n\n        # Undiscounted QALYs for the cycle\n        qaly_k_undiscounted = avg_utility * delta\n\n        # Time at the midpoint of the cycle for discounting\n        mid_cycle_time = (k + 0.5) * delta\n\n        # Discount factor for the cycle\n        discount_factor = 1.0 / ((1.0 + r) ** mid_cycle_time)\n        \n        # Discounted QALYs for the cycle\n        qaly_k_discounted = qaly_k_undiscounted * discount_factor\n        \n        # Add to the total\n        total_discounted_qaly += qaly_k_discounted\n\n        # Update the state vector for the next iteration\n        p_current = p_next\n        \n    return total_discounted_qaly\n\ndef solve():\n    \"\"\"\n    Defines test cases, computes QALYs for each, and prints the results.\n    \"\"\"\n    # Scenario A\n    T_A = [[0.88, 0.08, 0.04], [0.10, 0.80, 0.10], [0.00, 0.00, 1.00]]\n    u_A = [0.92, 0.65, 0.00]\n    p0_A = [1.00, 0.00, 0.00]\n    r_A = 0.03\n    delta_A = 1.0\n    Y_A = 10.0\n\n    # Scenario B\n    T_B = T_A\n    u_B = u_A\n    p0_B = p0_A\n    r_B = 0.00\n    delta_B = 1.0\n    Y_B = 10.0\n\n    # Scenario C\n    T_C = [[0.70, 0.25, 0.05], [0.00, 0.85, 0.15], [0.00, 0.00, 1.00]]\n    u_C = [0.80, 0.50, 0.00]\n    p0_C = [1.00, 0.00, 0.00]\n    r_C = 0.03\n    delta_C = 0.5\n    Y_C = 3.0\n\n    # Scenario D\n    T_D = [[1.00, 0.00], [0.00, 1.00]]\n    u_D = [0.95, 0.00]\n    p0_D = [1.00, 0.00]\n    r_D = 0.03\n    delta_D = 1.0\n    Y_D = 10.0\n\n    # Scenario E\n    T_E = T_A\n    u_E = u_A\n    p0_E = p0_A\n    r_E = 0.10\n    delta_E = 1.0\n    Y_E = 10.0\n\n    test_cases = [\n        (T_A, u_A, p0_A, r_A, delta_A, Y_A),\n        (T_B, u_B, p0_B, r_B, delta_B, Y_B),\n        (T_C, u_C, p0_C, r_C, delta_C, Y_C),\n        (T_D, u_D, p0_D, r_D, delta_D, Y_D),\n        (T_E, u_E, p0_E, r_E, delta_E, Y_E),\n    ]\n\n    results = []\n    for case in test_cases:\n        T, u, p0, r, delta, Y = case\n        result = compute_discounted_qalys(T, u, p0, r, delta, Y)\n        results.append(result)\n\n    # Format the final output string as a list of numbers rounded to 3 decimal places.\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}