{
    "hands_on_practices": [
        {
            "introduction": "在许多放射组学和数字病理学工作流程中，关键的第一步是准确地分割出感兴趣的区域（Region of Interest, ROI），例如肿瘤。此分割步骤的质量至关重要，因为所有后续的特征提取都依赖于它。本练习将引导您从精确率（precision）和召回率（recall）等基本定义出发，推导出戴斯系数（Dice Coefficient），这是一个评估分割算法性能的核心指标。通过亲自推导并分析它对分割不足和分割过度两种常见错误的敏感性，您将深刻地理解我们是如何从数学上量化分割准确性的。",
            "id": "5073369",
            "problem": "一个转化放射组学流程在计算面积归一化纹理特征之前，需要对数字病理学全切片图像进行稳健的病灶分割。考虑一个二元分割任务，其中病灶的真实标签掩模是一个可测集 $G \\subset \\mathbb{R}^{2}$，其面积为 $|G| = A > 0$（单位为 $\\mathrm{mm}^{2}$），而一个算法生成了一个预测掩模 $P \\subset \\mathbb{R}^{2}$。假设存在以下科学上真实的边界误差模型：\n- 分割不足：真实标签面积的一部分 $s \\in [0,1]$ 被漏掉，因此假阴性面积为 $|G \\setminus P| = s A$。\n- 过分割：在真实标签之外增加了一部分额外面积 $r \\ge 0$，因此假阳性面积为 $|P \\setminus G| = r A$。\n- 漏掉的区域 $G \\setminus P$ 和额外的区域 $P \\setminus G$ 彼此不相交，且与保留的重叠区域 $P \\cap G$ 也不相交。\n\n从集合值掩模的二元分割基本定义出发：\n- 真阳性面积 $T_{P} = |P \\cap G|$，\n- 假阳性面积 $F_{P} = |P \\setminus G|$，\n- 假阴性面积 $F_{N} = |G \\setminus P|$，\n- 精确率 $\\pi = \\dfrac{T_{P}}{T_{P} + F_{P}}$，\n- 召回率 $\\rho = \\dfrac{T_{P}}{T_{P} + F_{N}}$，\n- $F_{1}$ 分数，定义为精确率和召回率的调和平均数。\n\n仅使用这些定义，推导出一个解析表达式，该表达式表示通过计算掩模 $P$ 和 $G$ 的精确率和召回率的调和平均数而得到的集合相似性指数，并将其表示为过分割分数 $r$ 和分割不足分数 $s$ 的函数。然后，使用微积分第一性原理和集合测度，定性地解释在该边界误差模型下，此指数如何随 $r$ 和 $s$ 变化。\n\n你的最终答案必须是仅含 $r$ 和 $s$ 的单个闭式表达式。该指数无单位。不要四舍五入。",
            "solution": "该问题陈述经评估具有科学依据、提法恰当、客观且自成体系。所提供的分割度量（真阳性面积、假阳性面积、假阴性面积、精确率、召回率和 $F_1$ 分数）的定义在计算机视觉和医学图像分析领域是标准定义。该误差模型由分割不足分数 $s$ 和过分割分数 $r$ 参数化，是对现实世界分割误差的有效且可形式化的简化。任务是推导一个解析表达式，并使用既定的数学原理分析其行为。因此，该问题被认为是有效的，并且可以构建解决方案。\n\n目标是推导集合相似性指数（定义为 $F_1$ 分数）的表达式，将其表示为过分割分数 $r$ 和分割不足分数 $s$ 的函数。$F_1$ 分数是精确率（$\\pi$）和召回率（$\\rho$）的调和平均数。\n\n基本定义如下：\n- 精确率：$\\pi = \\dfrac{T_{P}}{T_{P} + F_{P}}$\n- 召回率：$\\rho = \\dfrac{T_{P}}{T_{P} + F_{N}}$\n- $F_1$ 分数：$F_{1} = 2 \\dfrac{\\pi \\rho}{\\pi + \\rho}$\n\n问题提供了以下基于面积为 $|G| = A > 0$ 的真实标签掩模 $G$ 和预测掩模 $P$ 的关系：\n- 假阴性面积：$F_{N} = |G \\setminus P| = sA$，其中 $s \\in [0,1]$。\n- 假阳性面积：$F_{P} = |P \\setminus G| = rA$，其中 $r \\ge 0$。\n\n首先，我们必须用给定参数表示真阳性面积 $T_{P} = |P \\cap G|$。真实标签集 $G$ 可以被划分为两个不相交的子集：被正确识别的区域（$P \\cap G$）和被漏掉的区域（$G \\setminus P$）。因此，$G$ 的面积是这两个部分面积之和：\n$$|G| = |P \\cap G| + |G \\setminus P|$$\n代入已知项：\n$$A = T_{P} + F_{N}$$\n我们现在可以解出 $T_{P}$：\n$$T_{P} = A - F_{N} = A - sA = (1-s)A$$\n\n有了用 $A$、$r$ 和 $s$ 表示的 $T_{P}$、$F_{P}$ 和 $F_{N}$ 的表达式，我们就可以推导精确率和召回率的表达式。\n\n精确率 $\\pi$ 为：\n$$\\pi = \\dfrac{T_{P}}{T_{P} + F_{P}} = \\dfrac{(1-s)A}{(1-s)A + rA}$$\n假设 $A > 0$，我们可以消去分子和分母中的 $A$：\n$$\\pi = \\dfrac{1-s}{1-s+r}$$\n该表达式在分母不为零的情况下有效。由于 $s \\in [0,1]$ 且 $r \\ge 0$，分母 $1-s+r$ 仅在 $s=1$ 且 $r=0$ 时为零。在这种情况下，$T_P = 0$ 且 $F_P = 0$，因此 $\\pi$ 的形式为 $0/0$。我们将看到这种情况在最终的 $F_1$ 表达式中得到了正确处理。\n\n召回率 $\\rho$ 为：\n$$\\rho = \\dfrac{T_{P}}{T_{P} + F_{N}} = \\dfrac{(1-s)A}{(1-s)A + sA} = \\dfrac{(1-s)A}{A}$$\n假设 $A > 0$：\n$$\\rho = 1-s$$\n这个结果很直观：召回率是被捕获的真实标签的比例，即 $1$ 减去被漏掉的比例 $s$。\n\n现在，我们将 $\\pi$ 和 $\\rho$ 的表达式代入 $F_1$ 分数的公式。对于 $s \\neq 1$，我们有：\n$$F_{1} = 2 \\dfrac{\\pi \\rho}{\\pi + \\rho} = 2 \\dfrac{\\left(\\dfrac{1-s}{1-s+r}\\right)(1-s)}{\\left(\\dfrac{1-s}{1-s+r}\\right) + (1-s)}$$\n我们可以从分母中提出因子 $(1-s)$：\n$$F_{1} = 2 \\dfrac{\\dfrac{(1-s)^2}{1-s+r}}{(1-s)\\left(\\dfrac{1}{1-s+r} + 1\\right)} = \\dfrac{2(1-s)}{1-s+r} \\cdot \\dfrac{1}{\\dfrac{1 + (1-s+r)}{1-s+r}}$$\n简化第二项：\n$$F_{1} = \\dfrac{2(1-s)}{1-s+r} \\cdot \\dfrac{1-s+r}{2-s+r}$$\n这可以简化为该指数的最终解析表达式，我们将其记为 $I(r,s)$：\n$$I(r,s) = \\dfrac{2(1-s)}{2-s+r}$$\n该表达式也能很好地处理 $s=1$ 的边缘情况。在这种情况下，$I(r,1) = \\frac{2(1-1)}{2-1+r} = \\frac{0}{1+r} = 0$，这对于一个完全漏掉整个目标的分割是正确的值。一个完美的分割（$s=0, r=0$）得出 $I(0,0) = \\frac{2(1-0)}{2-0+0} = 1$。推导出的表达式也等同于戴斯相似系数（Dice Similarity Coefficient），即 $2|P \\cap G| / (|P| + |G|)$。\n\n为了定性地解释该指数如何随 $r$ 和 $s$ 变化，我们通过计算 $I(r,s)$ 的偏导数来运用微积分第一性原理。\n\n首先，考虑相对于过分割分数 $r$ 的变化，保持 $s$ 不变：\n$$\\dfrac{\\partial I}{\\partial r} = \\dfrac{\\partial}{\\partial r} \\left( \\dfrac{2(1-s)}{2-s+r} \\right) = 2(1-s) \\cdot \\dfrac{-1}{(2-s+r)^{2}} = -\\dfrac{2(1-s)}{(2-s+r)^{2}}$$\n对于给定的约束条件（$s \\in [0,1], r \\ge 0$），分母 $(2-s+r)^2$ 总是正的。项 $(1-s)$ 是非负的。因此，$\\frac{\\partial I}{\\partial r} \\le 0$。在任何分割不是完全失败的情况下（$s  1$），导数是严格为负的。这意味着该指数是 $r$ 的严格递减函数。定性地讲，随着过分割面积的增加（$r$ 增大），相似性指数减小，反映出分割质量变差。\n\n接下来，考虑相对于分割不足分数 $s$ 的变化，保持 $r$ 不变。使用商法则求导：\n$$\\dfrac{\\partial I}{\\partial s} = \\dfrac{(\\frac{d}{ds}(2(1-s)))(2-s+r) - (2(1-s))(\\frac{d}{ds}(2-s+r))}{(2-s+r)^{2}}$$\n$$\\dfrac{\\partial I}{\\partial s} = \\dfrac{(-2)(2-s+r) - (2-2s)(-1)}{(2-s+r)^{2}} = \\dfrac{-4+2s-2r + 2-2s}{(2-s+r)^{2}}$$\n$$\\dfrac{\\partial I}{\\partial s} = \\dfrac{-2-2r}{(2-s+r)^{2}} = -\\dfrac{2(1+r)}{(2-s+r)^{2}}$$\n分母 $(2-s+r)^2$ 总是正的。分子项 $2(1+r)$ 也总是正的，因为 $r \\ge 0$。因此，$\\frac{\\partial I}{\\partial s}$ 的整个表达式是严格为负的。这意味着该指数是 $s$ 的严格递减函数。定性地讲，随着漏掉的真实标签面积比例的增加（$s$ 增大），相似性指数减小，反映出分割质量变差。\n\n总之，过分割误差（$r$ 增加）和分割不足误差（$s$ 增加）都会导致集合相似性指数的单调递减，这证实了该指数正确地惩罚了两种类型的分割不准确性。",
            "answer": "$$\n\\boxed{\\frac{2(1-s)}{2-s+r}}\n$$"
        },
        {
            "introduction": "在成功分割感兴趣区域之后，下一步便是提取能够量化其底层生物学特性的特征，这些特性常常通过图像的纹理（texture）得以体现。本练习聚焦于灰度共生矩阵（Gray-Level Co-Occurrence Matrix, GLCM），这是一种通过分析像素对的空间关系来捕捉纹理信息的经典统计方法。通过从一个给定的图像块中手动构建GLCM并计算一个关键的纹理特征——对比度（contrast），您将揭开这一基础技术的面纱，并巩固其数学定义与所代表的视觉纹理之间的直观联系。",
            "id": "5073256",
            "problem": "一块苏木精和伊红 (HE) 染色的结直肠癌标本的全切片图像图块已被强度量化为 $4$ 个离散灰度级，以支持转化放射组学和数字病理学中的定量纹理分析。考虑以下 $5 \\times 5$ 的感兴趣区域 (ROI)，其中每个条目表示灰度级 $i \\in \\{0,1,2,3\\}$：\n$$\n\\begin{pmatrix}\n0  0  1  2  3 \\\\\n0  1  1  2  3 \\\\\n1  1  1  2  2 \\\\\n2  2  1  1  0 \\\\\n3  2  2  1  0\n\\end{pmatrix}.\n$$\n从灰度共生矩阵 (GLCM) 的定义出发，其中条目 $p_{ij}$ 是在空间位置 $(r,c)$ 处观察到灰度级为 $i$ 的像素和在 $(r+\\Delta r, c+\\Delta c)$ 处观察到灰度级为 $j$ 的像素的归一化联合频率（对于指定的空间偏移），执行以下操作：\n\n1. 使用对应于 $0^{\\circ}$ 方向（水平向右）和 $d=1$ 像素距离的空间偏移，推导此 ROI 的 GLCM，并获得概率归一化条目 $p_{ij}$。\n2. 从概率论的第一性原理以及将对比度解释为强度差平方的期望出发，推导出 GLCM 对比度特征关于 $p_{ij}$ 的解析形式。\n3. 计算给定 ROI 上指定偏移的对比度数值。将对比度的最终值表示为无量纲小数，并四舍五入到四位有效数字。\n4. 使用 $p_{ij}$ 的概率意义和空间采样几何，简要解释改变方向（例如，$0^{\\circ}$ 与 $90^{\\circ}$）和改变距离 $d$ 预计将如何影响以各向异性基质纤维和腺体结构为特征的组织学纹理中的对比度。\n\n所有数学步骤和量都必须明确展示，所有符号和数字都必须用 LaTeX 书写。在定义方向性时，角度应以度为单位处理。除核心定义和标准概率事实外，未经推导不得假定任何外部公式。",
            "solution": "在尝试解答之前，对问题进行验证。\n\n### 第1步：提取已知条件\n- 一个具有整数灰度级的 $5 \\times 5$ 感兴趣区域 (ROI) 矩阵：\n$$ M = \\begin{pmatrix} 0  0  1  2  3 \\\\ 0  1  1  2  3 \\\\ 1  1  1  2  2 \\\\ 2  2  1  1  0 \\\\ 3  2  2  1  0 \\end{pmatrix} $$\n- 灰度级集合为 $i \\in \\{0, 1, 2, 3\\}$，因此灰度级数量为 $N_g = 4$。\n- 灰度共生矩阵 (GLCM) 由条目 $p_{ij}$ 定义，这些条目是观察到由空间偏移 $(\\Delta r, \\Delta c)$ 分隔的灰度级为 $i$ 的像素和灰度级为 $j$ 的像素的归一化联合频率。\n- 任务1要求使用方向为 $0^{\\circ}$ 且距离为 $d=1$ 像素的特定空间偏移。\n- 任务2要求从第一性原理推导对比度特征。\n- 任务3要求计算给定ROI和偏移下的对比度值，并四舍五入到四位有效数字。\n- 任务4要求定性解释偏移方向和距离的变化如何影响各向异性组织学纹理中的对比度。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据：** 该问题牢固植根于医学图像处理中纹理分析的既定领域，特别是数字病理学和放射组学。GLCM及其特征（如对比度）是该领域中使用的标准、定义明确的定量工具。\n- **适定性：** 解决问题所需的所有信息均已提供。ROI矩阵、灰度级和空间偏移都已明确定义。任务清晰明确，可得出一个唯一、可计算的解。\n- **客观性：** 问题以精确、客观的语言陈述。它依赖于数学定义和形式化程序，而非主观解释。\n- **一致性与完整性：** 问题是自洽且内部一致的。计算所需的信息没有缺失，也没有任何矛盾的约束。\n- **可行性：** 所提供的数据和要求的计算完全现实且计算上可行。\n\n### 第3步：结论与行动\n该问题科学合理、适定、客观且完整。因此，判定其为 **有效**。将提供完整解答。\n\n### 解答\n\n根据题目要求，解答分为四个部分。\n\n**1. 针对指定偏移推导GLCM**\n\n指定的空间偏移是方向为 $0^{\\circ}$ 且距离为 $d=1$ 像素。这对应于向右移动一个像素，因此偏移向量为 $(\\Delta r, \\Delta c) = (0, 1)$。我们必须计算ROI中所有相邻像素对 $(i, j)$ 的数量，其中 $j$ 位于 $i$ 的正右方。ROI的尺寸为 $5 \\times 5$。对于 $5$ 行中的每一行，都有 $5-1=4$ 个这样的水平像素对。需要计数的总像素对数量为 $N_p = 5 \\times 4 = 20$。\n\n灰度级为 $i, j \\in \\{0, 1, 2, 3\\}$。我们构建一个 $4 \\times 4$ 的共生计数矩阵 $C$，其中条目 $C_{ij}$ 是灰度级为 $i$ 的像素紧邻右侧是灰度级为 $j$ 的像素的次数。\n\n让我们逐行系统地扫描ROI：\n- 第1行 ($0, 0, 1, 2, 3$): 像素对为 $(0,0)$, $(0,1)$, $(1,2)$, $(2,3)$。\n- 第2行 ($0, 1, 1, 2, 3$): 像素对为 $(0,1)$, $(1,1)$, $(1,2)$, $(2,3)$。\n- 第3行 ($1, 1, 1, 2, 2$): 像素对为 $(1,1)$, $(1,1)$, $(1,2)$, $(2,2)$。\n- 第4行 ($2, 2, 1, 1, 0$): 像素对为 $(2,2)$, $(2,1)$, $(1,1)$, $(1,0)$。\n- 第5行 ($3, 2, 2, 1, 0$): 像素对为 $(3,2)$, $(2,2)$, $(2,1)$, $(1,0)$。\n\n我们统计这些像素对来填充计数矩阵 $C$：\n- $C_{00}$: $1$ (来自第1行)\n- $C_{01}$: $2$ (来自第1行, 第2行)\n- $C_{10}$: $2$ (来自第4行, 第5行)\n- $C_{11}$: $4$ (来自第2行, 第3行(x2), 第4行)\n- $C_{12}$: $3$ (来自第1行, 第2行, 第3行)\n- $C_{21}$: $2$ (来自第4行, 第5行)\n- $C_{22}$: $3$ (来自第3行, 第4行, 第5行)\n- $C_{23}$: $2$ (来自第1行, 第2行)\n- $C_{32}$: $1$ (来自第5行)\n所有其他的条目 $C_{ij}$ 均为 $0$。\n\n未归一化的共生计数矩阵 $C$ 为：\n$$ C = \\begin{pmatrix} 1  2  0  0 \\\\ 2  4  3  0 \\\\ 0  2  3  2 \\\\ 0  0  1  0 \\end{pmatrix} $$\n$C$ 中所有条目的总和为 $1+2+2+4+3+2+3+2+1 = 20$，这与我们预期的总像素对数 $N_p$ 相符。\n\n题目要求的是概率归一化的条目 $p_{ij}$。这些条目通过将 $C$ 的每个条目除以总像素对数 $N_p=20$ 得到。\n$$ p_{ij} = \\frac{C_{ij}}{N_p} $$\n得到的概率归一化GLCM，即 $P$，为：\n$$ P = \\frac{1}{20} \\begin{pmatrix} 1  2  0  0 \\\\ 2  4  3  0 \\\\ 0  2  3  2 \\\\ 0  0  1  0 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{20}  \\frac{2}{20}  0  0 \\\\ \\frac{2}{20}  \\frac{4}{20}  \\frac{3}{20}  0 \\\\ 0  \\frac{2}{20}  \\frac{3}{20}  \\frac{2}{20} \\\\ 0  0  \\frac{1}{20}  0 \\end{pmatrix} $$\n\n**2. 对比度特征解析形式的推导**\n\n题目要求从第一性原理推导对比度特征，并将其解释为强度差平方的期望。\n设 $I_1$ 和 $I_2$ 为两个离散随机变量，表示由空间偏移 $(\\Delta r, \\Delta c)$ 定义的像素对中第一个和第二个像素的灰度级。GLCM条目 $p_{ij}$ 表示灰度级 $i, j \\in \\{0, 1, ..., N_g-1\\}$ 的估计联合概率质量函数 $P(I_1=i, I_2=j)$，其中 $N_g=4$。\n\n对于一个共现像素对 $(i, j)$，其强度（灰度级）差为 $i-j$。强度差的平方为 $(i-j)^2$。\n\n我们记为 $K$ 的对比度特征，被定义为该平方差的期望值。对于离散随机变量，函数 $f(I_1, I_2)$ 的期望由所有可能结果的加权和给出，其中权重是联合概率：\n$$ E[f(I_1, I_2)] = \\sum_{i=0}^{N_g-1} \\sum_{j=0}^{N_g-1} f(i,j) P(I_1=i, I_2=j) $$\n在本例中，函数为 $f(i,j) = (i-j)^2$。将此代入期望公式，我们得到对比度特征的解析形式：\n$$ K = \\sum_{i=0}^{N_g-1} \\sum_{j=0}^{N_g-1} (i-j)^2 p_{ij} $$\n该表达式表示在指定偏移下图像中存在的局部变化的度量；它是GLCM的一个矩（具体来说，是关于主对角线的二阶矩）。\n\n**3. 对比度数值的计算**\n\n使用推导出的公式和GLCM $P$，我们计算对比度 $K$ 的值。当 $N_g=4$ 时，灰度级为 $i,j \\in \\{0, 1, 2, 3\\}$。\n$$ K = \\sum_{i=0}^{3} \\sum_{j=0}^{3} (i-j)^2 p_{ij} = \\sum_{i=0}^{3} \\sum_{j=0}^{3} (i-j)^2 \\frac{C_{ij}}{20} $$\n为了计算总和，我们可以将每个计数 $C_{ij}$ 乘以相应的平方差 $(i-j)^2$：\n- 对于 $p_{00}$，$(0-0)^2 \\cdot \\frac{1}{20} = 0 \\cdot \\frac{1}{20} = 0$。\n- 对于 $p_{01}$，$(0-1)^2 \\cdot \\frac{2}{20} = 1 \\cdot \\frac{2}{20} = \\frac{2}{20}$。\n- 对于 $p_{10}$，$(1-0)^2 \\cdot \\frac{2}{20} = 1 \\cdot \\frac{2}{20} = \\frac{2}{20}$。\n- 对于 $p_{11}$，$(1-1)^2 \\cdot \\frac{4}{20} = 0 \\cdot \\frac{4}{20} = 0$。\n- 对于 $p_{12}$，$(1-2)^2 \\cdot \\frac{3}{20} = 1 \\cdot \\frac{3}{20} = \\frac{3}{20}$。\n- 对于 $p_{21}$，$(2-1)^2 \\cdot \\frac{2}{20} = 1 \\cdot \\frac{2}{20} = \\frac{2}{20}$。\n- 对于 $p_{22}$，$(2-2)^2 \\cdot \\frac{3}{20} = 0 \\cdot \\frac{3}{20} = 0$。\n- 对于 $p_{23}$，$(2-3)^2 \\cdot \\frac{2}{20} = 1 \\cdot \\frac{2}{20} = \\frac{2}{20}$。\n- 对于 $p_{32}$，$(3-2)^2 \\cdot \\frac{1}{20} = 1 \\cdot \\frac{1}{20} = \\frac{1}{20}$。\n所有其他的 $p_{ij}$ 均为零，对总和没有贡献。\n\n将这些贡献相加：\n$$ K = \\frac{2}{20} + \\frac{2}{20} + \\frac{3}{20} + \\frac{2}{20} + \\frac{2}{20} + \\frac{1}{20} = \\frac{2+2+3+2+2+1}{20} = \\frac{12}{20} $$\n$$ K = \\frac{3}{5} = 0.6 $$\n题目要求最终值以四舍五入到四位有效数字的小数表示。\n$$ K = 0.6000 $$\n\n**4. 偏移对对比度影响的解释**\n\n对比度特征 $K = \\sum \\sum (i-j)^2 p_{ij}$ 用灰度级的平方差 $(i-j)^2$ 对每个联合概率 $p_{ij}$ 进行加权。高对比度值表示具有大灰度级差异的共现像素频率高，这在视觉上对应于“繁忙”或清晰的纹理。\n\n来自像结直肠癌等组织的组织学纹理，由于有组织的生物结构（如基质纤维和腺体构造），通常表现出各向异性。\n\n- **改变方向的影响：** 考虑一个具有水平排列基质纤维的纹理。\n  - 如果使用水平方向 ($0^{\\circ}$) 计算GLCM，偏移会*沿着*纤维对像素进行采样。由于单个纤维内的像素可能具有相似的灰度级，联合概率 $p_{ij}$ 将集中在GLCM的主对角线或其附近（即 $i \\approx j$ 的地方）。对于这些高概率条目，加权因子 $(i-j)^2$ 会很小，从而导致一个**低的对比度**值。\n  - 如果将方向更改为垂直 ($90^{\\circ}$)，偏移现在会*跨越*纤维对像素进行采样。这条路径会频繁地穿过纤维与周围组织（如细胞质、细胞外基质）之间的边界。这导致具有不同灰度级的共现像素的概率更高（例如，一个暗的纤维像素旁边是一个亮的基质像素）。因此，GLCM的非对角线条目（其中 $|i-j|$ 较大）将具有更高的概率。这些条目乘以大的 $(i-j)^2$ 权重，从而产生一个**高的对比度**值。\n  - 因此，在各向异性纹理中，对比度特征是方向依赖的，分析其在不同方向上的值可以量化各向异性的程度和方向。\n\n- **改变距离 $d$ 的影响：** 距离参数 $d$ 控制纹理分析的尺度。\n  - 对于小距离（例如 $d=1$），GLCM捕捉精细尺度的纹理细节。相邻像素高度相关，通常属于相同的微观结构。与跨结构测量相比，这通常会导致较低的对比度，除非纹理非常细密或嘈杂。\n  - 随着距离 $d$ 的增加，像素对之间的相关性通常会降低。这种关系是依赖于纹理的。如果 $d$ 变得与图像中对象的特征尺寸（例如，腺体或纤维束的宽度）相当，偏移可能会频繁地跨越这些对象与其背景之间的边界。这可能导致在该特定距离上对比度值出现峰值。\n  - 对于非常大的距离 ($d \\to \\infty$)，像素灰度级变得统计上独立。联合概率 $p_{ij}$ 接近边际概率的乘积 $p_{i} p_{j}$。对比度值将稳定在一个与图像灰度直方图的总体方差相关的值，反映的是全局而非局部变化。\n  - 总之，改变 $d$ 可以在不同空间尺度上探测纹理特性，揭示组织中结构元素的尺寸和周期性信息。",
            "answer": "$$\\boxed{0.6000}$$"
        },
        {
            "introduction": "转化研究的最终目标不仅是构建一个高精度的预测模型，更是创造一个能够辅助并改善临床决策的实用工具，而传统的性能指标（如准确率）往往无法完全捕捉这种临床价值。本练习将向您介绍决策曲线分析（Decision Curve Analysis, DCA），这是一个评估模型临床净获益（net benefit）的强大框架。 通过从基本原则出发推导净获益公式并将其应用于一个具体的临床场景，您将学会如何评估一个模型是否比默认的临床策略（例如治疗所有患者或不治疗任何患者）更有价值，从而真正打通从模型性能到临床应用的“最后一公里”。",
            "id": "5073217",
            "problem": "在一项转化医学研究中，该研究整合了来自数字病理学的定量放射组学和计算组织形态计量学，一个融合预测模型输出了患者层面的预测概率，该概率表明患者是否具有可能改变治疗方案的高风险肿瘤表型。临床应用遵循一个阈值概率决策规则：如果预测概率 $r$ 超过一个阈值 $p_t \\in (0,1)$，则对患者进行治疗，否则不进行治疗。决策曲线分析 (DCA) 通过量化在不同阈值概率下所做治疗决策的净临床价值，来评估此类模型的临床效用。\n\n从以下基本原则出发：\n- 在不确定性下的二元决策中，阈值概率 $p_t$ 体现了治疗真阳性（true positive）的益处与治疗假阳性（false positive）的危害之间的权衡。隐含的相对危害-效益权重为 $w = \\frac{p_t}{1 - p_t}$。\n- 在一个大小为 $n$ 的验证样本中，根据决策规则“如果 $r \\ge p_t$ 则治疗”，定义真阳性 $\\mathrm{TP}$ 和假阳性 $\\mathrm{FP}$，并以“每位患者的真阳性等效单位”来考量净临床价值。\n- 假设对于单次决策，益处和危害在患者间是可加的，且与时间无关。\n\n任务：\n1) 仅使用上述原则，推导净效益 $\\mathrm{NB}(p_t)$ 作为 $\\mathrm{TP}$、$\\mathrm{FP}$、$n$ 和 $p_t$ 的函数表达式。\n\n2) 考虑一个包含 $n = 20$ 名患者的留出验证队列，这些患者具有真实标签 $y_i \\in \\{0,1\\}$ 和模型预测概率 $r_i \\in [0,1]$。决策规则是：如果 $r_i \\ge p_t$ 则治疗。使用你推导的表达式计算在 $p_t \\in \\{0.1, 0.2, 0.3, 0.4\\}$ 时的 $\\mathrm{NB}(p_t)$，其中“真阳性”是指被治疗且 $y_i=1$ 的患者，“假阳性”是指被治疗且 $y_i=0$ 的患者。\n\n数据如下：\n- 患者 $1$：$r_1 = 0.05$, $y_1 = 0$\n- 患者 $2$：$r_2 = 0.08$, $y_2 = 0$\n- 患者 $3$：$r_3 = 0.09$, $y_3 = 0$\n- 患者 $4$：$r_4 = 0.12$, $y_4 = 0$\n- 患者 $5$：$r_5 = 0.14$, $y_5 = 0$\n- 患者 $6$：$r_6 = 0.18$, $y_6 = 0$\n- 患者 $7$：$r_7 = 0.19$, $y_7 = 0$\n- 患者 $8$：$r_8 = 0.21$, $y_8 = 0$\n- 患者 $9$：$r_9 = 0.23$, $y_9 = 1$\n- 患者 $10$：$r_{10} = 0.27$, $y_{10} = 1$\n- 患者 $11$：$r_{11} = 0.31$, $y_{11} = 1$\n- 患者 $12$：$r_{12} = 0.33$, $y_{12} = 0$\n- 患者 $13$：$r_{13} = 0.36$, $y_{13} = 1$\n- 患者 $14$：$r_{14} = 0.39$, $y_{14} = 0$\n- 患者 $15$：$r_{15} = 0.42$, $y_{15} = 1$\n- 患者 $16$：$r_{16} = 0.48$, $y_{16} = 1$\n- 患者 $17$：$r_{17} = 0.55$, $y_{17} = 1$\n- 患者 $18$：$r_{18} = 0.64$, $y_{18} = 1$\n- 患者 $19$：$r_{19} = 0.72$, $y_{19} = 1$\n- 患者 $20$：$r_{20} = 0.85$, $y_{20} = 1$\n\n3) 设总结性性能指标为 $\\mathrm{NB}(p_t)$ 在集合 $\\{0.1, 0.2, 0.3, 0.4\\}$ 上的算术平均值。计算这个平均净效益，并将其作为你的最终答案。\n\n将最终数值答案表示为小数（不带百分号）。将你的最终答案四舍五入到四位有效数字。",
            "solution": "用户希望我通过验证问题来解决它，如果问题有效，则进行解答。\n\n### 第一步：提取已知信息\n-   问题背景设定在转化医学领域，整合了放射组学和数字病理学。\n-   一个预测模型输出高风险肿瘤表型的概率 $r$。\n-   使用一个决策规则：如果 $r \\ge p_t$ 则治疗，其中 $p_t \\in (0,1)$ 是一个阈值概率。\n-   使用决策曲线分析（DCA）来评估模型的临床效用。\n-   相对危害-效益权重为 $w = \\frac{p_t}{1 - p_t}$。\n-   净临床价值以“每位患者的真阳性等效单位”表示。\n-   定义：$\\mathrm{TP}$ 是真阳性数量，$\\mathrm{FP}$ 是假阳性数量，$n$ 是样本大小。\n-   任务1：推导净效益 $\\mathrm{NB}(p_t)$ 作为 $\\mathrm{TP}$、$\\mathrm{FP}$、$n$ 和 $p_t$ 的函数表达式。\n-   任务2：为一个 $n=20$ 的验证队列计算在 $p_t \\in \\{0.1, 0.2, 0.3, 0.4\\}$ 时的 $\\mathrm{NB}(p_t)$。提供了20名患者的数据（预测概率 $r_i$ 和真实标签 $y_i$ 的配对）。真阳性是被治疗且 $y_i=1$ 的患者，假阳性是被治疗且 $y_i=0$ 的患者。\n-   任务3：计算在任务2中计算出的四个 $\\mathrm{NB}(p_t)$ 值的算术平均值。\n-   最终答案必须是四舍五入到四位有效数字的小数。\n\n### 第二步：使用提取的已知信息进行验证\n1.  **科学依据**：该问题基于决策曲线分析（DCA），这是一种用于评估预测模型临床效用的标准且被广泛接受的统计方法。所提供的定义，包括阈值概率 $p_t$ 和危害-效益比 $w$ 之间的关系，是DCA理论的基础。放射组学和数字病理学的应用背景是进行此类分析的常见且适当的领域。该问题在科学上是合理的。\n2.  **良构性**：问题分为三个清晰的、连续的任务。它要求从第一性原理进行推导，将推导出的公式应用于一个完整的数据集，并进行最终的汇总计算。所有必要的数据（$n$、患者层面的 $r_i$ 和 $y_i$ 值，以及 $p_t$ 集合）都已提供。存在一个唯一的、有意义的解。\n3.  **客观性**：问题以精确、定量和无偏见的语言陈述。没有主观或基于意见的元素。\n\n问题是自洽的、一致的，并且没有违反任何无效标准。\n\n### 第三步：结论与行动\n问题有效。将提供解答。\n\n### 解答\n\n解答按顺序解决三个任务。\n\n**第一部分：净效益表达式的推导**\n\n决策策略的净效益（$\\mathrm{NB}$）定义为总益处减去总危害，并进行标准化以用一个通用单位表示。问题规定净临床价值应以“每位患者的真阳性等效单位”表示。\n\n将正确识别并治疗具有高风险表型的患者（真阳性）的益处归一化为 $1$。一个群体的总益处是真阳性的数量 $\\mathrm{TP}$。\n\n治疗不具有高风险表型的患者（假阳性）的危害是相对于真阳性益处进行加权的。这个相对权重由 $w = \\frac{p_t}{1 - p_t}$ 给出，其中 $p_t$ 是决策者在治疗与不治疗之间无差异的阈值概率。该群体的总危害是假阳性的数量 $\\mathrm{FP}$ 乘以这个权重：$\\mathrm{FP} \\times w$。\n\n对于整个 $n$ 名患者的样本，以真阳性等效单位表示的总净效益是总益处减去总危害：\n$$ \\text{总净效益} = \\mathrm{TP} - (\\mathrm{FP} \\times w) $$\n代入 $w$ 的表达式：\n$$ \\text{总净效益} = \\mathrm{TP} - \\mathrm{FP} \\left( \\frac{p_t}{1 - p_t} \\right) $$\n问题要求的是每位患者的净效益 $\\mathrm{NB}(p_t)$。为得到此值，我们将总净效益除以样本大小 $n$：\n$$ \\mathrm{NB}(p_t) = \\frac{\\text{总净效益}}{n} = \\frac{1}{n} \\left[ \\mathrm{TP} - \\mathrm{FP} \\left( \\frac{p_t}{1 - p_t} \\right) \\right] $$\n这个表达式也可以写成真阳性率与加权假阳性率之差：\n$$ \\mathrm{NB}(p_t) = \\frac{\\mathrm{TP}}{n} - \\frac{\\mathrm{FP}}{n} \\left( \\frac{p_t}{1 - p_t} \\right) $$\n这就是所要求的净效益表达式。\n\n**第二部分：计算验证队列的净效益**\n\n验证队列由 $n=20$ 名患者组成。决策规则是如果预测概率 $r_i$ 大于或等于阈值 $p_t$，则进行治疗。我们为每个指定的阈值计算真阳性（$\\mathrm{TP}$）和假阳性（$\\mathrm{FP}$）的数量。\n\n提供的数据如下：\n-   $y=0$（无高风险表型）的患者：$r \\in \\{0.05, 0.08, 0.09, 0.12, 0.14, 0.18, 0.19, 0.21, 0.33, 0.39\\}$\n-   $y=1$（高风险表型）的患者：$r \\in \\{0.23, 0.27, 0.31, 0.36, 0.42, 0.48, 0.55, 0.64, 0.72, 0.85\\}$\n\n我们为 $p_t \\in \\{0.1, 0.2, 0.3, 0.4\\}$ 计算 $\\mathrm{NB}(p_t)$。\n\n**情况1：$p_t = 0.1$**\n-   被治疗的患者满足 $r_i \\ge 0.1$。\n-   $\\mathrm{FP}$：$y_i=0$ 且 $r_i \\ge 0.1$ 的患者。这些是 $r \\in \\{0.12, 0.14, 0.18, 0.19, 0.21, 0.33, 0.39\\}$ 的患者。计数：$\\mathrm{FP}=7$。\n-   $\\mathrm{TP}$：$y_i=1$ 且 $r_i \\ge 0.1$ 的患者。所有 $10$ 名 $y_i=1$ 的患者其 $r_i  0.2$，所以都被治疗。计数：$\\mathrm{TP}=10$。\n-   $\\mathrm{NB}(0.1) = \\frac{10}{20} - \\frac{7}{20} \\left( \\frac{0.1}{1 - 0.1} \\right) = \\frac{1}{2} - \\frac{7}{20} \\left( \\frac{0.1}{0.9} \\right) = \\frac{1}{2} - \\frac{7}{20} \\left( \\frac{1}{9} \\right) = \\frac{1}{2} - \\frac{7}{180} = \\frac{90 - 7}{180} = \\frac{83}{180}$。\n\n**情况2：$p_t = 0.2$**\n-   被治疗的患者满足 $r_i \\ge 0.2$。\n-   $\\mathrm{FP}$：$y_i=0$ 且 $r_i \\ge 0.2$ 的患者。这些是 $r \\in \\{0.21, 0.33, 0.39\\}$ 的患者。计数：$\\mathrm{FP}=3$。\n-   $\\mathrm{TP}$：$y_i=1$ 且 $r_i \\ge 0.2$ 的患者。所有 $10$ 名 $y_i=1$ 的患者都满足此条件。计数：$\\mathrm{TP}=10$。\n-   $\\mathrm{NB}(0.2) = \\frac{10}{20} - \\frac{3}{20} \\left( \\frac{0.2}{1 - 0.2} \\right) = \\frac{1}{2} - \\frac{3}{20} \\left( \\frac{0.2}{0.8} \\right) = \\frac{1}{2} - \\frac{3}{20} \\left( \\frac{1}{4} \\right) = \\frac{1}{2} - \\frac{3}{80} = \\frac{40 - 3}{80} = \\frac{37}{80}$。\n\n**情况3：$p_t = 0.3$**\n-   被治疗的患者满足 $r_i \\ge 0.3$。\n-   $\\mathrm{FP}$：$y_i=0$ 且 $r_i \\ge 0.3$ 的患者。这些是 $r \\in \\{0.33, 0.39\\}$ 的患者。计数：$\\mathrm{FP}=2$。\n-   $\\mathrm{TP}$：$y_i=1$ 且 $r_i \\ge 0.3$ 的患者。这些是 $r \\in \\{0.31, 0.36, 0.42, 0.48, 0.55, 0.64, 0.72, 0.85\\}$ 的患者。计数：$\\mathrm{TP}=8$。\n-   $\\mathrm{NB}(0.3) = \\frac{8}{20} - \\frac{2}{20} \\left( \\frac{0.3}{1 - 0.3} \\right) = \\frac{2}{5} - \\frac{1}{10} \\left( \\frac{0.3}{0.7} \\right) = \\frac{2}{5} - \\frac{1}{10} \\left( \\frac{3}{7} \\right) = \\frac{2}{5} - \\frac{3}{70} = \\frac{28 - 3}{70} = \\frac{25}{70} = \\frac{5}{14}$。\n\n**情况4：$p_t = 0.4$**\n-   被治疗的患者满足 $r_i \\ge 0.4$。\n-   $\\mathrm{FP}$：$y_i=0$ 且 $r_i \\ge 0.4$ 的患者。没有这样的患者。计数：$\\mathrm{FP}=0$。\n-   $\\mathrm{TP}$：$y_i=1$ 且 $r_i \\ge 0.4$ 的患者。这些是 $r \\in \\{0.42, 0.48, 0.55, 0.64, 0.72, 0.85\\}$ 的患者。计数：$\\mathrm{TP}=6$。\n-   $\\mathrm{NB}(0.4) = \\frac{6}{20} - \\frac{0}{20} \\left( \\frac{0.4}{1 - 0.4} \\right) = \\frac{6}{20} - 0 = \\frac{3}{10}$。\n\n**第三部分：计算平均净效益**\n\n最后的任务是计算四个净效益值的算术平均值。\n$$ \\text{平均 NB} = \\frac{1}{4} \\left[ \\mathrm{NB}(0.1) + \\mathrm{NB}(0.2) + \\mathrm{NB}(0.3) + \\mathrm{NB}(0.4) \\right] $$\n为了精确，代入分数值：\n$$ \\text{平均 NB} = \\frac{1}{4} \\left( \\frac{83}{180} + \\frac{37}{80} + \\frac{5}{14} + \\frac{3}{10} \\right) $$\n为了对分数求和，我们找到 $180$、$80$、$14$ 和 $10$ 的公分母。\n素因数分解为 $180 = 2^2 \\cdot 3^2 \\cdot 5$，$80 = 2^4 \\cdot 5$，$14 = 2 \\cdot 7$，$10 = 2 \\cdot 5$。\n最小公倍数是 $2^4 \\cdot 3^2 \\cdot 5 \\cdot 7 = 16 \\cdot 9 \\cdot 5 \\cdot 7 = 5040$。\n$$ \\text{平均 NB} = \\frac{1}{4} \\left( \\frac{83 \\cdot 28}{5040} + \\frac{37 \\cdot 63}{5040} + \\frac{5 \\cdot 360}{5040} + \\frac{3 \\cdot 504}{5040} \\right) $$\n$$ \\text{平均 NB} = \\frac{1}{4} \\left( \\frac{2324}{5040} + \\frac{2331}{5040} + \\frac{1800}{5040} + \\frac{1512}{5040} \\right) $$\n$$ \\text{平均 NB} = \\frac{1}{4} \\left( \\frac{2324 + 2331 + 1800 + 1512}{5040} \\right) $$\n$$ \\text{平均 NB} = \\frac{1}{4} \\left( \\frac{7967}{5040} \\right) = \\frac{7967}{20160} $$\n现在，我们将这个分数转换为小数，并按要求四舍五入到四位有效数字。\n$$ \\text{平均 NB} = \\frac{7967}{20160} \\approx 0.39518849... $$\n四舍五入到四位有效数字，得到 $0.3952$。",
            "answer": "$$\\boxed{0.3952}$$"
        }
    ]
}