{
    "hands_on_practices": [
        {
            "introduction": "动脉狭窄是常见的病理现象，它会引起波的反射，从而改变整个动脉系统的压力和血流模式。本练习旨在通过一维波动理论，分析波在狭窄处的传播与反射。通过将狭窄处的非线性压力-流量关系在平均状态附近进行线性化，我们可以推导出适用于小信号波动的反射和透射系数的解析表达式。这项练习将加深您对局部病变如何影响全局脉动血流动力学的理解，并掌握一种在生物力学分析中应用广泛的线性化技术。",
            "id": "4211994",
            "problem": "考虑一个由一维 (1D) 质量和动量守恒以及线性弹性壁描述的弹性动脉系统中的脉搏波传播。一个局部的短狭窄引入了额外的稳态压力损失，其模型为\n$$\\Delta P(Q) = K \\frac{\\rho}{2} \\left(\\frac{Q}{A_s}\\right)^{2},$$\n其中 $K$ 是一个无量纲损失系数，$\\rho$ 是血液密度，$Q$ 是通过狭窄处的体积流量，$A_s$ 是狭窄处的残余管腔面积（在所考虑的小扰动范围内假定为常数）。\n\n两条无损耗的半无限长动脉在狭窄处交汇：上游动脉的特征阻抗为 $Z_1$，下游动脉的特征阻抗为 $Z_2$。假设存在平均流量 $Q_0 > 0$。在此平均流量之上，一个复振幅为 $P_i$ 的小振幅、时谐压力波从上游动脉入射。下游动脉是半无限长的，因此在狭窄之后不会发生进一步的反射。除了狭窄处，分布性粘性效应可以忽略不计。\n\n从关于平均状态线性化的一维质量和动量平衡以及特征阻抗的定义出发，将狭窄处的压力-损失关系在 $Q_0$ 附近线性化，以获得其小信号形式。然后，利用通过狭窄处的流量连续性和其上的线性化压降，推导：\n- 上游反射压力波的复反射系数 $\\Gamma = P_r / P_i$，以及\n- 远端脉冲压力振幅的复透射比 $\\tau_p = P_t / P_i$，其中 $P_t$ 是紧邻狭窄远端的透射前行压力波的复振幅。\n\n请用 $K$、$\\rho$、$Q_0$、$A_s$、$Z_1$ 和 $Z_2$ 表示您的最终答案，形式为闭式符号表达式。将您的最终答案以行矩阵 $\\big[\\Gamma \\;\\; \\tau_p\\big]$ 的形式给出。不需要进行数值计算。最终表达式中不要包含单位。",
            "solution": "用户提供了一个问题陈述，需要进行验证，如果有效，则进行求解。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n\n-   **系统：** 一维、弹性动脉系统。\n-   **狭窄压力损失模型：** 局部的短狭窄，其稳态压力损失由 $\\Delta P(Q) = K \\frac{\\rho}{2} \\left(\\frac{Q}{A_s}\\right)^{2}$ 给出。\n-   **模型参数：** $K$ 是无量纲损失系数，$\\rho$ 是血液密度，$Q$ 是体积流量，$A_s$ 是狭窄处的恒定残余管腔面积。\n-   **动脉配置：** 两条无损耗的半无限长动脉在狭窄处交汇。上游动脉的特征阻抗为 $Z_1$。下游动脉的特征阻抗为 $Z_2$。\n-   **流动条件：** 存在平均流量 $Q_0 > 0$。一个复振幅为 $P_i$ 的小振幅、时谐压力波从上游动脉入射。下游动脉是半无限长的，意味着没有远端反射。\n-   **假设：** 分布性粘性效应可以忽略不计。\n-   **任务：**\n    1.  将狭窄压力-损失关系在平均流量 $Q_0$ 附近线性化。\n    2.  推导复反射系数 $\\Gamma = P_r / P_i$。\n    3.  推导远端脉冲压力的复透射比 $\\tau_p = P_t / P_i$。\n-   **输出要求：** 用 $K$、$\\rho$、$Q_0$、$A_s$、$Z_1$ 和 $Z_2$ 表示结果。最终答案应为一个行矩阵 $[\\Gamma \\;\\; \\tau_p]$。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n-   **科学依据：** 该问题基于一维血液动力学的成熟原理。波传播的控制方程（线性化的质量和动量平衡）是标准的，特征阻抗的概念也是如此。狭窄的压力损失模型 $\\Delta P \\propto Q^2$ 是一个经典的液压公式，源自带损失项的 Bernoulli 原理，在生物力学中广泛使用。该设置是一个科学上合理（尽管简化了）的模型，用于研究动脉狭窄处的脉搏波反射和透射。\n-   **适定性：** 该问题是适定的。它提供了所有必要的物理定律、组件模型（动脉、狭窄）和边界条件（半无限长远端血管），以确定反射和透射系数的唯一解。\n-   **客观性：** 问题陈述使用了精确、客观和定量的语言，没有任何主观或非科学的主张。\n-   **结论：** 该问题不违反任何无效性标准。它是生物力学流体动力学领域一个标准的、可解的问题。\n\n**步骤 3：判定和行动**\n\n问题有效。可以进行求解过程。\n\n### 推导过程\n\n求解需要三个主要步骤：$1$) 线性化非线性的狭窄压力-流量关系，2) 定义上游和下游动脉中压力波和流量波之间的关系，以及 3) 在狭窄处应用连续性条件以求解未知的反射波和透射波振幅。\n\n**1. 狭窄压降关系的线性化**\n\n任意点的总压力 $P$ 和总流量 $Q$ 可以分解为一个平均（稳态）分量和一个小的、时变（搏动或交流）分量。我们记 $Q = Q_0 + q$，其中 $Q_0$ 是平均流量，$q$ 是小的搏动流量分量。通过狭窄处的压降 $\\Delta P$ 是总流量 $Q$ 的函数：\n$$ \\Delta P(Q) = K \\frac{\\rho}{2 A_s^2} Q^2 $$\n我们使用一阶泰勒级数展开，将此关系在平均流量 $Q_0$ 附近线性化：\n$$ \\Delta P(Q) \\approx \\Delta P(Q_0) + \\left. \\frac{d(\\Delta P)}{dQ} \\right|_{Q=Q_0} (Q - Q_0) $$\n总压降 $\\Delta P$ 是平均压降 $\\Delta P_0 = \\Delta P(Q_0)$ 和小的搏动压降 $\\Delta p = \\Delta P(Q) - \\Delta P(Q_0)$ 的和。根据泰勒展开，压降的搏动分量与流量的搏动分量 $q = Q - Q_0$ 的关系为：\n$$ \\Delta p = \\left. \\frac{d(\\Delta P)}{dQ} \\right|_{Q=Q_0} q $$\n我们计算 $\\Delta P(Q)$ 对 $Q$ 的导数：\n$$ \\frac{d(\\Delta P)}{dQ} = \\frac{d}{dQ} \\left( K \\frac{\\rho}{2 A_s^2} Q^2 \\right) = K \\frac{\\rho}{2 A_s^2} (2Q) = K \\frac{\\rho Q}{A_s^2} $$\n在平均流量 $Q=Q_0$ 处计算该导数，得到搏动压降和搏动流量之间的线性关系：\n$$ \\Delta p = \\left( K \\frac{\\rho Q_0}{A_s^2} \\right) q $$\n这个关系类似于欧姆定律 $\\Delta V = IR$。我们定义线性化狭窄阻力 $R_s$ 为：\n$$ R_s = K \\frac{\\rho Q_0}{A_s^2} $$\n对于时谐波，我们可以使用复振幅（相量）来表示搏动分量。搏动压降 ($\\Delta P_{\\text{ac}}$) 和搏动流量 ($Q_{\\text{ac}}$) 的复振幅的线性化狭窄关系为：\n$$ \\Delta P_{\\text{ac}} = R_s Q_{\\text{ac}} $$\n\n**2. 动脉中的波关系**\n\n设狭窄位于 $x=0$ 处。\n在上游动脉 ($x  0$) 中，总搏动压力是入射波 ($P_i$) 和反射波 ($P_r$) 的和。总搏动流量是与这些波相关的流量之和。在狭窄入口处 ($x=0^{-}$) ，复振幅为：\n-   搏动压力：$P_{\\text{up}} = P_i + P_r$\n-   搏动流量：$Q_{\\text{up}} = Q_i + Q_r$\n\n上游动脉的特征阻抗 $Z_1$ 关联了每个波分量的压力和流量：$P_i = Z_1 Q_i$ 和 $P_r = -Z_1 Q_r$。反射波的负号是因为其传播方向与正坐标方向相反。因此，狭窄入口处的总搏动流量为：\n$$ Q_{\\text{up}} = \\frac{P_i}{Z_1} - \\frac{P_r}{Z_1} = \\frac{1}{Z_1} (P_i - P_r) $$\n在下游动脉 ($x > 0$) 中，由于动脉是半无限长的，只有前向传播的透射波 ($P_t$)。在狭窄出口处 ($x=0^{+}$)，复振幅为：\n-   搏动压力：$P_{\\text{down}} = P_t$\n-   搏动流量：$Q_{\\text{down}} = Q_t$\n\n下游动脉的特征阻抗 $Z_2$ 关联了这些量：$P_t = Z_2 Q_t$，这意味着 $Q_t = P_t / Z_2$。\n\n**3. 边界条件的应用与求解**\n\n在狭窄处 ($x=0$)，我们对搏动分量应用两个边界条件：\n1.  **流量连续性：** 搏动流量必须在短狭窄处是连续的。设 $Q_{\\text{ac}}$ 为这个共同的流量。\n    $$ Q_{\\text{ac}} = Q_{\\text{up}} = Q_{\\text{down}} \\implies \\frac{1}{Z_1} (P_i - P_r) = \\frac{P_t}{Z_2} $$\n2.  **压降：** 通过狭窄处的搏动压降由线性化阻力 $R_s$ 决定。\n    $$ \\Delta P_{\\text{ac}} = P_{\\text{up}} - P_{\\text{down}} = R_s Q_{\\text{ac}} \\implies (P_i + P_r) - P_t = R_s Q_{\\text{ac}} $$\n\n现在我们有一个方程组，可以求解以 $P_i$ 表示的 $P_r$ 和 $P_t$。根据流量连续性方程，我们可以将 $P_t$ 表示为：\n$$ P_t = \\frac{Z_2}{Z_1} (P_i - P_r) \\quad (1) $$\n我们注意到 $Q_{\\text{ac}} = P_t / Z_2$。将此式和方程 $(1)$ 代入压降方程：\n$$ (P_i + P_r) - \\left( \\frac{Z_2}{Z_1} (P_i - P_r) \\right) = R_s \\left( \\frac{P_t}{Z_2} \\right) = R_s \\left( \\frac{1}{Z_2} \\frac{Z_2}{Z_1} (P_i - P_r) \\right) $$\n$$ P_i + P_r - \\frac{Z_2}{Z_1} P_i + \\frac{Z_2}{Z_1} P_r = \\frac{R_s}{Z_1} (P_i - P_r) $$\n为简化起见，我们将 $P_i$ 和 $P_r$ 的项分组：\n$$ P_r \\left( 1 + \\frac{Z_2}{Z_1} + \\frac{R_s}{Z_1} \\right) = P_i \\left( -1 + \\frac{Z_2}{Z_1} + \\frac{R_s}{Z_1} \\right) $$\n整个方程乘以 $Z_1$：\n$$ P_r (Z_1 + Z_2 + R_s) = P_i (-Z_1 + Z_2 + R_s) $$\n因此，反射系数 $\\Gamma = P_r / P_i$ 为：\n$$ \\Gamma = \\frac{Z_2 + R_s - Z_1}{Z_1 + Z_2 + R_s} $$\n\n为了找到透射比 $\\tau_p = P_t / P_i$，我们可以将 $P_r$ 的表达式代回方程 $(1)$：\n$$ \\frac{P_r}{P_i} = \\Gamma \\implies P_r = \\Gamma P_i $$\n$$ P_t = \\frac{Z_2}{Z_1} (P_i - \\Gamma P_i) = P_i \\frac{Z_2}{Z_1} (1 - \\Gamma) $$\n所以，$\\tau_p = \\frac{Z_2}{Z_1}(1 - \\Gamma)$。代入 $\\Gamma$ 的表达式：\n$$ \\tau_p = \\frac{Z_2}{Z_1} \\left( 1 - \\frac{Z_2 + R_s - Z_1}{Z_1 + Z_2 + R_s} \\right) $$\n$$ \\tau_p = \\frac{Z_2}{Z_1} \\left( \\frac{(Z_1 + Z_2 + R_s) - (Z_2 + R_s - Z_1)}{Z_1 + Z_2 + R_s} \\right) $$\n$$ \\tau_p = \\frac{Z_2}{Z_1} \\left( \\frac{2 Z_1}{Z_1 + Z_2 + R_s} \\right) = \\frac{2 Z_2}{Z_1 + Z_2 + R_s} $$\n\n最后，我们将线性化狭窄阻力的定义 $R_s = K \\frac{\\rho Q_0}{A_s^2}$ 代入 $\\Gamma$ 和 $\\tau_p$ 的表达式中。\n\n复反射系数为：\n$$ \\Gamma = \\frac{Z_2 + K \\frac{\\rho Q_0}{A_s^2} - Z_1}{Z_1 + Z_2 + K \\frac{\\rho Q_0}{A_s^2}} $$\n复透射比为：\n$$ \\tau_p = \\frac{2Z_2}{Z_1 + Z_2 + K \\frac{\\rho Q_0}{A_s^2}} $$\n这些就是所要求的最终符号表达式。",
            "answer": "$$ \\boxed{\n\\begin{pmatrix}\n\\frac{Z_2 - Z_1 + K \\frac{\\rho Q_0}{A_s^2}}{Z_1 + Z_2 + K \\frac{\\rho Q_0}{A_s^2}}  \\frac{2Z_2}{Z_1 + Z_2 + K \\frac{\\rho Q_0}{A_s^2}}\n\\end{pmatrix}\n} $$"
        },
        {
            "introduction": "从无创测量中量化动脉壁的材料属性，是评估心血管健康状况的核心目标之一。本练习将指导您如何将可测量的生物信号（如压力和血管截面积）与底层的力学模型联系起来，以实现参数估计。基于薄壁圆筒假设和Kelvin-Voigt粘弹性本构模型，您将推导出一个联系压力、面积及其时间变化率的线性模型，并利用该模型通过线性回归方法估计动脉壁的弹性与粘性参数。这个实践将为您提供基于模型的参数辨识的实战经验，搭建起生物力学理论与实际数据分析之间的桥梁。",
            "id": "4212001",
            "problem": "给定在单个位置同步测量的动脉内压力和动脉横截面积的时间序列，它们分别通过压平眼压计和超声获得。目标是建立并实现一个线性回归模型，在薄壁圆柱体和 Kelvin-Voigt 黏弹性本构定律的假设下，根据压力-面积轨迹估计管壁弹性模量与厚度的乘积 $E h$ 以及管壁黏度模量 $\\eta_w$。仅使用以下基本依据：\n- 薄壁圆柱体的环向应力-压力-几何关系：周向（环向）应力 $\\,\\sigma_\\theta\\,$ 满足 $\\,\\sigma_\\theta = P r / h\\,$，其中 $\\,P\\,$ 是跨壁压，$\\,r\\,$ 是瞬时半径，$\\,h\\,$ 是管壁厚度。\n- 动脉壁的 Kelvin-Voigt 黏弹性本构定律：$\\,\\sigma_\\theta = E\\,\\varepsilon + \\eta_w\\,d\\varepsilon/dt\\,$，其中 $\\,E\\,$ 是弹性模量，$\\,\\eta_w\\,$ 是管壁黏度模量，$\\,\\varepsilon\\,$ 是周向应变。\n- 半径与面积之间的小应变关系：对于围绕基线半径 $\\,r_0\\,$ 和基线面积 $\\,A_0 = \\pi r_0^2\\,$ 的小变形，周向应变 $\\,\\varepsilon\\,$ 可近似为 $\\,\\varepsilon \\approx (A - A_0)/(2 A_0)\\,$。\n\n利用这些依据，推导一个线性回归模型，将测量的压力 $\\,P(t)\\,$ 表示为面积偏差 $\\,A(t) - A_0\\,$ 及其时间导数 $\\,dA/dt\\,$ 的线性函数，并包含一个截距项以考虑外部压力和校准偏移。从拟合的回归系数中，恢复出具有物理一致单位的 $\\,E h\\,$ 和 $\\,\\eta_w\\,$。\n\n你的程序必须：\n1. 对每个测试用例，在 $\\,T = 10\\,$ 秒的时间内以 $\\,500\\,$ Hz 的采样率构建一个合成数据集 $\\,\\{t, A(t), P(t)\\}\\,$。角度使用弧度。设 $\\,A_0 = \\pi r_0^2\\,$ 并生成面积轨迹\n$$\nA(t) = A_0 \\left[ 1 + \\alpha \\sin(2\\pi f\\, t) + 0.25\\,\\alpha \\sin(4\\pi f\\, t + \\phi) \\right],\n$$\n其中 $\\,\\alpha\\,$ 是面积分数变化，$\\,f\\,$ 是基频。相位 $\\,\\phi\\,$ 必须设置为 $\\,\\phi = \\pi/6\\,$。根据上述表达式解析计算 $\\,dA/dt\\,$。使用以下公式生成压力轨迹\n$$\nP(t) = b + k_1 \\left( A(t) - A_0 \\right) + k_2 \\frac{dA}{dt}(t),\n$$\n其中\n$$\nk_1 = \\frac{E h}{2 r_0 A_0}, \\qquad k_2 = \\frac{\\eta_w h}{2 r_0 A_0}.\n$$\n此处 $\\,b\\,$ 是一个恒定的压力偏移量。\n2. 对 $\\,P(t)\\,$ 关于预测变量 $\\,1\\,$、$\\,A(t)-A_0\\,$ 和 $\\,dA/dt\\,$ 执行线性最小二乘回归，以估计系数 $\\,\\hat{b}\\,$、$\\,\\hat{k}_1\\,$ 和 $\\,\\hat{k}_2\\,$。\n3. 使用以下公式从拟合系数中恢复物理参数\n$$\n\\widehat{E h} = 2 r_0 A_0\\,\\hat{k}_1, \\qquad \\widehat{\\eta_w} = \\frac{2 r_0 A_0}{h}\\,\\hat{k}_2.\n$$\n4. 报告 $\\,\\widehat{E h}\\,$（单位：帕斯卡-米，Pa·m）和 $\\,\\widehat{\\eta_w}\\,$（单位：帕斯卡-秒，Pa·s）。两者均表示为四舍五入到三位有效数字的浮点数。\n\n测试套件：\n- 情况 1（典型，多谐波，中等黏度）：$\\,r_0 = 2.5\\times 10^{-3}\\,$ m, $\\,h = 0.5\\times 10^{-3}\\,$ m, $\\,E h = 120\\,$ Pa·m, $\\,\\eta_w = 1.0\\times 10^{5}\\,$ Pa·s, $\\,f = 1.25\\,$ Hz, $\\,\\alpha = 0.05\\,$, $\\,b = 13332\\,$ Pa。\n- 情况 2（黏度可忽略的边界情况）：$\\,r_0 = 2.0\\times 10^{-3}\\,$ m, $\\,h = 0.4\\times 10^{-3}\\,$ m, $\\,E h = 80\\,$ Pa·m, $\\,\\eta_w = 0\\,$ Pa·s, $\\,f = 1.00\\,$ Hz, $\\,\\alpha = 0.04\\,$, $\\,b = 10665\\,$ Pa。\n- 情况 3（高黏度，较硬管壁）：$\\,r_0 = 1.8\\times 10^{-3}\\,$ m, $\\,h = 0.6\\times 10^{-3}\\,$ m, $\\,E h = 150\\,$ Pa·m, $\\,\\eta_w = 5.0\\times 10^{5}\\,$ Pa·s, $\\,f = 0.80\\,$ Hz, $\\,\\alpha = 0.06\\,$, $\\,b = 14664\\,$ Pa。\n- 情况 4（小信号边缘情况）：$\\,r_0 = 3.0\\times 10^{-3}\\,$ m, $\\,h = 0.7\\times 10^{-3}\\,$ m, $\\,E h = 200\\,$ Pa·m, $\\,\\eta_w = 8.0\\times 10^{4}\\,$ Pa·s, $\\,f = 1.50\\,$ Hz, $\\,\\alpha = 0.005\\,$, $\\,b = 12000\\,$ Pa。\n\n你的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表，其中每个测试用例贡献一个双元素列表 $\\,\\left[\\widehat{E h},\\widehat{\\eta_w}\\right]\\,$。例如，输出格式必须为\n$$\n\\left[ [\\widehat{E h}_1,\\widehat{\\eta_w}_1], [\\widehat{E h}_2,\\widehat{\\eta_w}_2], [\\widehat{E h}_3,\\widehat{\\eta_w}_3], [\\widehat{E h}_4,\\widehat{\\eta_w}_4] \\right].\n$$",
            "solution": "用户想要解决一个生物力学问题。\n该问题要求验证并解决一个与动脉力学相关的问题。目标是根据压力和面积数据估计动脉的材料特性。\n\n### 方法与公式\n\n该问题要求从压力 $P(t)$ 和横截面积 $A(t)$ 的时间序列数据中，估计动脉壁的两个物理参数：刚度-厚度乘积 $E h$ 和管壁黏度模量 $\\eta_w$。估计将基于简化的动脉物理模型，使用线性回归来执行。\n\n**1. 线性回归模型的推导**\n\n推导始于问题陈述中提供的三个基本假设：\n\n1.  **薄壁圆柱体力学**：周向环状应力 $\\sigma_\\theta$ 与跨壁压 $P$、瞬时半径 $r$ 和管壁厚度 $h$ 通过以下公式相关联：\n    $$ \\sigma_\\theta = \\frac{P r}{h} $$\n\n2.  **Kelvin-Voigt 黏弹性本构定律**：动脉壁材料被建模为线性黏弹性固体，其中应力是应变 $\\varepsilon$ 和应变率 $d\\varepsilon/dt$ 的线性组合：\n    $$ \\sigma_\\theta = E \\varepsilon + \\eta_w \\frac{d\\varepsilon}{dt} $$\n    此处， $E$ 是杨氏模量，$\\eta_w$ 是管壁黏度模量。\n\n3.  **小应变运动学**：对于围绕基线半径 $r_0$ 和基线面积 $A_0 = \\pi r_0^2$ 的小变形，周向应变 $\\varepsilon = (r-r_0)/r_0$ 可以用面积变化来近似。由于 $A = \\pi r^2$，我们有 $r = \\sqrt{A/\\pi}$。因此，$\\varepsilon = \\sqrt{A/A_0} - 1$。对于小的 $x = (A-A_0)/A_0$，使用泰勒级数展开 $(1+x)^{1/2} \\approx 1 + x/2$，我们得到给定的近似式：\n    $$ \\varepsilon \\approx \\frac{A - A_0}{2 A_0} $$\n    应变的时间导数则为：\n    $$ \\frac{d\\varepsilon}{dt} \\approx \\frac{1}{2 A_0} \\frac{dA}{dt} $$\n\n通过将环向应力 $\\sigma_\\theta$ 的两个表达式相等，我们结合了力学模型和材料模型：\n$$ \\frac{P r}{h} = E \\varepsilon + \\eta_w \\frac{d\\varepsilon}{dt} $$\n\n代入 $\\varepsilon$ 和 $d\\varepsilon/dt$ 的小应变近似值：\n$$ \\frac{P(t) r(t)}{h} = E \\left( \\frac{A(t) - A_0}{2 A_0} \\right) + \\eta_w \\left( \\frac{1}{2 A_0} \\frac{dA}{dt}(t) \\right) $$\n\n为了获得压力 $P(t)$ 的线性关系，我们求解 $P(t)$ 并应用进一步的线性化。对于小应变，瞬时半径 $r(t)$ 接近基线半径 $r_0$，因此我们可以在项 $Pr/h$ 中近似 $r(t) \\approx r_0$。这是一个标准的简化方法，它使模型相对于几何变量线性化。\n$$ P(t) \\approx \\frac{h}{r_0} \\left[ E \\left( \\frac{A(t) - A_0}{2 A_0} \\right) + \\eta_w \\left( \\frac{1}{2 A_0} \\frac{dA}{dt}(t) \\right) \\right] $$\n\n重新整理各项，我们得到：\n$$ P(t) \\approx \\left( \\frac{E h}{2 r_0 A_0} \\right) (A(t) - A_0) + \\left( \\frac{\\eta_w h}{2 r_0 A_0} \\right) \\frac{dA}{dt}(t) $$\n\n这个方程模拟了跨壁压。测量的动脉压 $P_{meas}(t)$ 是跨壁压与任何外部压力之和，再加上可能的校准偏移。我们可以将这些常数项合并为一个截距 $b$。这导出了最终的线性回归模型：\n$$ P_{meas}(t) = b + k_1 (A(t) - A_0) + k_2 \\frac{dA}{dt}(t) $$\n其中系数 $k_1$ 和 $k_2$ 定义为：\n$$ k_1 = \\frac{E h}{2 r_0 A_0} \\qquad \\text{和} \\qquad k_2 = \\frac{\\eta_w h}{2 r_0 A_0} $$\n\n**2. 参数估计过程**\n\n该任务涉及一系列步骤：\n\n1.  **数据合成**：对于每个测试用例，我们在 $T=10$ 秒的持续时间内，以 $f_s = 500$ Hz 的采样率生成面积 $A(t)$ 和压力 $P(t)$ 的合成时间序列数据。\n    - 时间向量为 $t_i = i/f_s$，其中 $i=0, 1, \\dots, T f_s - 1$。\n    - 面积信号 $A(t)$ 使用指定公式生成，该公式包含一个基频及其一次谐波：\n      $$ A(t) = A_0 \\left[ 1 + \\alpha \\sin(2\\pi f t) + 0.25 \\alpha \\sin(4\\pi f t + \\phi) \\right] $$\n      其中 $\\phi = \\pi/6$。\n    - 通过对 $A(t)$ 的表达式求导，解析地计算时间导数 $dA/dt$：\n      $$ \\frac{dA}{dt}(t) = A_0 \\alpha \\left[ (2\\pi f) \\cos(2\\pi f t) + 0.25 (4\\pi f) \\cos(4\\pi f t + \\phi) \\right] $$\n    - 然后使用带有测试用例中提供的真实参数的线性模型来合成压力信号 $P(t)$。系数 $k_1$ 和 $k_2$ 由真实的 $E h$ 和 $\\eta_w$ 计算得出。\n\n2.  **线性回归**：我们建立并求解一个多元线性最小二乘问题，以从生成的数据 $\\{t_i, A(t_i), P(t_i)\\}$ 中估计系数 $(\\hat{b}, \\hat{k}_1, \\hat{k}_2)$。模型为 $P(t_i) = \\beta_0 + \\beta_1 (A(t_i) - A_0) + \\beta_2 \\frac{dA}{dt}(t_i)$。设计矩阵 $\\mathbf{X}$ 有三列：一列全为 1（用于截距），一列为预测变量 $(A(t) - A_0)$，一列为预测变量 $dA/dt$。通过求解正规方程来找到系数向量 $\\boldsymbol{\\beta} = [\\beta_0, \\beta_1, \\beta_2]^T$，通常使用像 `numpy.linalg.lstsq` 这样的鲁棒数值方法。\n\n3.  **参数恢复**：一旦获得估计的系数 $(\\hat{b}, \\hat{k}_1, \\hat{k}_2)$，我们反转 $k_1$ 和 $k_2$ 的关系式以找到物理参数。在此步骤中，假定基线几何参数 $r_0$ 和 $h$ 是已知的。\n    - 从 $\\hat{k}_1 \\approx k_1 = \\frac{E h}{2 r_0 A_0}$，我们恢复估计的刚度-厚度乘积 $\\widehat{E h}$：\n      $$ \\widehat{E h} = 2 r_0 A_0 \\hat{k}_1 $$\n    - 从 $\\hat{k}_2 \\approx k_2 = \\frac{\\eta_w h}{2 r_0 A_0}$，我们求解 $\\eta_w$。这需要管壁厚度 $h$，每个测试用例中都已提供。\n      $$ \\widehat{\\eta_w} = \\frac{2 r_0 A_0}{h} \\hat{k}_2 $$\n\n4.  **输出格式化**：最终的估计值 $\\widehat{E h}$ 和 $\\widehat{\\eta_w}$ 被四舍五入到三位有效数字，并以指定的列表格式呈现给每个测试用例。由于合成数据是在没有噪声的情况下生成的，因此恢复的参数应与真实值非常接近，仅受数值精度的限制。\n\n这个过程构成了一个完整的前向模拟和反演问题求解方案，在理想、无噪声的数据上验证了参数估计技术。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Solves the biomechanics parameter estimation problem for a suite of test cases.\n    \"\"\"\n\n    def round_to_sf(x, sf):\n        \"\"\"\n        Rounds a float to a specified number of significant figures.\n        \"\"\"\n        if x == 0:\n            return 0.0\n        \n        sign = -1 if x  0 else 1\n        x_abs = abs(x)\n        \n        # Use logarithms to find the order of magnitude\n        order_of_magnitude = math.floor(math.log10(x_abs))\n        \n        # Calculate the power of 10 to scale the number\n        power = sf - 1 - order_of_magnitude\n        \n        # Scale the number, round to the nearest integer, then unscale\n        scaled_x = x_abs * (10**power)\n        rounded_scaled_x = round(scaled_x)\n        rounded_x = rounded_scaled_x / (10**power)\n        \n        return sign * rounded_x\n\n    # Test suite from the problem statement\n    test_cases = [\n        # Case 1: (r0, h, Eh, eta_w, f, alpha, b)\n        (2.5e-3, 0.5e-3, 120.0, 1.0e5, 1.25, 0.05, 13332.0),\n        # Case 2:\n        (2.0e-3, 0.4e-3, 80.0, 0.0, 1.00, 0.04, 10665.0),\n        # Case 3:\n        (1.8e-3, 0.6e-3, 150.0, 5.0e5, 0.80, 0.06, 14664.0),\n        # Case 4:\n        (3.0e-3, 0.7e-3, 200.0, 8.0e4, 1.50, 0.005, 12000.0)\n    ]\n\n    results = []\n    \n    # Simulation parameters\n    T = 10.0  # seconds\n    fs = 500.0 # Hz\n    phi = np.pi / 6.0\n    \n    t = np.arange(0, T, 1/fs)\n\n    for case in test_cases:\n        r0, h, Eh_true, eta_w_true, f, alpha, b = case\n\n        # 1. Generate Synthetic Data\n        A0 = np.pi * r0**2\n        \n        # Area trajectory A(t)\n        term1_A = alpha * np.sin(2 * np.pi * f * t)\n        term2_A = 0.25 * alpha * np.sin(4 * np.pi * f * t + phi)\n        A_t = A0 * (1 + term1_A + term2_A)\n        \n        # Area time derivative dA/dt\n        term1_dAdt = 2 * np.pi * f * alpha * np.cos(2 * np.pi * f * t)\n        term2_dAdt = 0.25 * 4 * np.pi * f * alpha * np.cos(4 * np.pi * f * t + phi)\n        dAdt = A0 * (term1_dAdt + term2_dAdt)\n\n        # Pressure trajectory P(t) using the true model coefficients\n        k1_true = Eh_true / (2 * r0 * A0)\n        k2_true = (eta_w_true * h) / (2 * r0 * A0)\n        \n        delta_A = A_t - A0\n        P_t = b + k1_true * delta_A + k2_true * dAdt\n\n        # 2. Perform Linear Least-Squares Regression\n        # Model: P(t) = b_hat * 1 + k1_hat * (A(t)-A0) + k2_hat * dA/dt\n        X = np.stack([np.ones_like(t), delta_A, dAdt], axis=1)\n        \n        # Solve for coefficients [b_hat, k1_hat, k2_hat]\n        coeffs, _, _, _ = np.linalg.lstsq(X, P_t, rcond=None)\n        b_hat, k1_hat, k2_hat = coeffs\n        \n        # 3. Recover Physical Parameters\n        Eh_hat = 2 * r0 * A0 * k1_hat\n        eta_w_hat = (2 * r0 * A0 / h) * k2_hat\n        \n        # 4. Round to three significant figures\n        Eh_hat_rounded = round_to_sf(Eh_hat, 3)\n        eta_w_hat_rounded = round_to_sf(eta_w_hat, 3)\n\n        results.append([Eh_hat_rounded, eta_w_hat_rounded])\n\n    # Format the final output string as specified\n    formatted_pairs = [f\"[{pair[0]},{pair[1]}]\" for pair in results]\n    final_string = f\"[{','.join(formatted_pairs)}]\"\n    \n    print(final_string)\n\nsolve()\n```"
        },
        {
            "introduction": "动脉壁的力学特性通常并非均匀分布，例如其硬度会随着与心脏距离的增加而变化。为了捕捉这种空间异质性，我们需要更高级的计算方法来求解反问题。本练习将引导您运用伴随方法（adjoint method）来高效计算目标函数的梯度，并通过梯度下降法从动脉两端的压力波形数据中重构沿血管轴向分布的刚度剖面$E h(x)$ 。掌握这种求解偏微分方程约束下的反问题的技术，对于前沿的生物力学研究和先进医疗设备开发至关重要。",
            "id": "4211970",
            "problem": "考虑一根长度为 $L$、未变形时半径恒为 $R_0$ 的细长轴对称动脉，其中充满了密度为 $\\rho$ 的不可压缩流体。在小振幅压力扰动和观测窗口内粘性损失可忽略的条件下，压力场 $p(x,t)$ 的一维演化可由线性对流输运模型近似，\n$$\n\\frac{\\partial p}{\\partial t}(x,t) + c(x)\\,\\frac{\\partial p}{\\partial x}(x,t) = 0,\n$$\n其中 $c(x)$ 是局部波速，由薄壁圆柱形血管的 Moens–Korteweg 关系确定，\n$$\nc(x) = \\sqrt{\\frac{E h(x)}{2 \\rho R_0}},\n$$\n$E h(x)$ 是空间变化的管壁刚度（杨氏模量乘以管壁厚度），单位为 $\\mathrm{N/m}$。在近端，压力被指定为测量的近端波形 $p_{\\mathrm{prox}}(t)$，即 $p(0,t) = p_{\\mathrm{prox}}(t)$，在 $x = L$ 处可获得远端测量值 $p_{\\mathrm{dist}}(t)$。初始条件为 $p(x,0) = p_{\\mathrm{prox}}(0)$。\n\n您的任务是，给定测量的近端和远端压力波形，利用上述离散化一维平流模型的伴随梯度，构建并实现一个最小二乘反问题，以估计空间分布 $E h(x)$。该反问题应最小化以下目标函数，\n$$\nJ(E h) = \\frac{1}{2}\\sum_{n=0}^{N_t-1}\\left[p_{\\mathrm{pred}}(L,t_n) - p_{\\mathrm{dist}}(t_n)\\right]^2 + \\frac{\\beta}{2}\\sum_{i=0}^{N_x-2}\\left(E h_{i+1} - E h_i\\right)^2,\n$$\n其中 $p_{\\mathrm{pred}}(L,t_n)$ 是正向模型根据当前 $E h(x)$ 预测的远端压力，离散正则化参数 $\\beta \\ge 0$ 用于施加空间平滑性约束，$N_t$ 是时间步数，$N_x$ 是空间网格点数。\n\n在均匀空间网格（包含 $N_x$ 个点，$x_i = i\\,\\Delta x$，$i \\in \\{0,\\dots,N_x-1\\}$，其中 $\\Delta x = L/(N_x-1)$）和均匀时间网格（包含 $N_t$ 个点，$t_n = n\\,\\Delta t$，$n \\in \\{0,\\dots,N_t-1\\}$）上对正向模型进行离散化。当 $c(x) > 0$ 时，使用一阶迎风显式格式，\n$$\np_i^{n+1} = p_i^n - \\Delta t\\,c_i\\,\\frac{p_i^n - p_{i-1}^n}{\\Delta x},\\quad i=1,\\dots,N_x-1,\n$$\n并在所有时间步 $n$ 上使用边界赋值 $p_0^n = p_{\\mathrm{prox}}(t_n)$。\n\n推导并实现此时间推进格式的离散伴随方法，用以计算目标函数 $J$ 相对于每个空间网格点上 $E h_i$ 的梯度，并使用梯度下降法估计 $E h(x)$。相对于 $E h_i$ 的梯度必须通过对 $c_i(E h_i)$ 和离散伴随灵敏度应用链式法则来获得。通过在每次更新后将 $E h_i$ 投影到一个下界 $E h_{\\min} > 0$ 上，来确保 $E h(x)$ 的正性。\n\n您必须使用的基本原理：\n- 在细长动脉中，质量和动量守恒在小振幅和短时窗内反射可忽略的假设下，会导致压力的下游输运，此处由线性平流方程表示。\n- Moens–Korteweg 关系通过 $c(x) = \\sqrt{E h(x)/(2 \\rho R_0)}$ 将局部管壁刚度 $E h(x)$ 与波速 $c(x)$ 联系起来。\n- 带有 Tikhonov 正则化的最小二乘估计给出了目标函数 $J(E h)$。\n\n物理和数值单位：\n- $E h(x)$ 以 $\\mathrm{N/m}$ 表示。\n- 压力 $p$ 以 $\\mathrm{Pa}$ 表示。\n- 长度以 $\\mathrm{m}$ 表示，时间以 $\\mathrm{s}$ 表示。\n- 本问题不涉及角度单位。\n\n在正向和反向计算中，实现以下固定参数值：\n- 血管和流体：$L = 0.2\\,\\mathrm{m}$，$R_0 = 0.01\\,\\mathrm{m}$，$\\rho = 1060\\,\\mathrm{kg/m^3}$。\n- 离散化：$N_x = 80$，$\\Delta x = L/(N_x-1)$，$\\Delta t = 10^{-4}\\,\\mathrm{s}$，$T = 0.2\\,\\mathrm{s}$，$N_t = T/\\Delta t$。\n- 正则化：$\\beta = 10^{-3}$。\n- 梯度下降：$N_{\\mathrm{iter}} = 30$ 次迭代，初始猜测 $E h_i^{(0)} = 1500\\,\\mathrm{N/m}$（对所有 $i$），学习率 $\\alpha_{\\mathrm{lr}} = 0.1$，投影下界 $E h_{\\min} = 800\\,\\mathrm{N/m}$。\n\n测量的近端和远端波形：\n- 对于下述每个测试用例，通过使用真实刚度分布 $E h_{\\mathrm{true}}(x)$ 和给定的近端输入 $p_{\\mathrm{prox}}(t)$ 模拟正向模型，来构建测量的远端波形 $p_{\\mathrm{dist}}(t)$。\n\n近端输入波形：\n- 使用高斯调制的正弦波，\n$$\np_{\\mathrm{prox}}(t) = p_0 + A \\exp\\!\\left(-\\frac{(t-t_c)^2}{2\\sigma^2}\\right)\\sin(2\\pi f t),\n$$\n其中 $p_0 = 10000\\,\\mathrm{Pa}$，$A = 5000\\,\\mathrm{Pa}$，$t_c = 0.05\\,\\mathrm{s}$，$\\sigma = 0.02\\,\\mathrm{s}$，$f = 8\\,\\mathrm{Hz}$。\n\n基于伴随的梯度详细说明：\n- 令 $r_n = p_{N_x-1}^n - p_{\\mathrm{dist}}(t_n)$ 表示时间 $t_n$ 的远端残差。\n- 定义每个网格点和时间层的伴随变量 $\\lambda_i^n$，其终端条件为 $\\lambda_i^{N_t} = 0$。\n- 残差仅在 $i = N_x - 1$ 处对 $\\partial J/\\partial p_i^n = r_n$ 有贡献，在其他地方为零。\n- 对于显式迎风格式，离散伴随递推关系为\n$$\n\\lambda_i^n = \\frac{\\partial J}{\\partial p_i^n} + \\lambda_i^{n+1}\\left(1 - \\frac{\\Delta t\\,c_i}{\\Delta x}\\right) + \\lambda_{i+1}^{n+1}\\left(\\frac{\\Delta t\\,c_{i+1}}{\\Delta x}\\right),\\quad i=0,\\dots,N_x-2,\n$$\n以及\n$$\n\\lambda_{N_x-1}^n = \\frac{\\partial J}{\\partial p_{N_x-1}^n} + \\lambda_{N_x-1}^{n+1}\\left(1 - \\frac{\\Delta t\\,c_{N_x-1}}{\\Delta x}\\right),\n$$\n其中 $\\lambda_{N_x}^{n+1}$ 被解释为零。\n- 时间推进更新对 $c_i$ 的灵敏度为\n$$\n\\frac{\\partial p_i^{n+1}}{\\partial c_i} = -\\Delta t\\,\\frac{p_i^n - p_{i-1}^n}{\\Delta x}.\n$$\n- 相对于 $c_i$ 的梯度为\n$$\n\\frac{\\partial J}{\\partial c_i} = \\sum_{n=0}^{N_t-1} \\lambda_i^{n+1}\\left(-\\Delta t\\,\\frac{p_i^n - p_{i-1}^n}{\\Delta x}\\right).\n$$\n- 使用 $c_i^2 = E h_i/(2\\rho R_0)$，应用链式法则 $\\frac{\\partial c_i}{\\partial E h_i} = \\frac{1}{4 \\rho R_0 c_i}$，得到\n$$\n\\frac{\\partial J}{\\partial E h_i} = \\frac{1}{4 \\rho R_0 c_i}\\,\\frac{\\partial J}{\\partial c_i} + \\beta\\left(2 E h_i - E h_{i-1} - E h_{i+1}\\right),\n$$\n正则化项在边界 $i=0$ 和 $i=N_x-1$ 处采用相应的单边形式。\n\n测试套件：\n- 使用三种真实刚度分布 $E h_{\\mathrm{true}}(x)$：\n  1. 恒定值：对所有 $x$，$E h_{\\mathrm{true}}(x) = 1400\\,\\mathrm{N/m}$。\n  2. 线性梯度：$E h_{\\mathrm{true}}(x) = 1000\\,\\mathrm{N/m} + 1000\\,\\mathrm{N/m}\\cdot (x/L)$。\n  3. 阶跃变化：当 $x  L/2$ 时，$E h_{\\mathrm{true}}(x) = 1500\\,\\mathrm{N/m}$；当 $x \\ge L/2$ 时，$E h_{\\mathrm{true}}(x) = 3500\\,\\mathrm{N/m}$。\n\n对每个测试用例，运行梯度下降法，并报告最终估计的刚度分布的相对均方根误差，\n$$\n\\varepsilon = \\sqrt{\\frac{\\sum_{i=0}^{N_x-1}\\left(E h_i^{(\\mathrm{final})} - E h_{\\mathrm{true},i}\\right)^2}{\\sum_{i=0}^{N_x-1}\\left(E h_{\\mathrm{true},i}\\right)^2}},\n$$\n结果为无量纲小数。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含 3 个测试用例的结果，格式为方括号内以逗号分隔的列表，例如 $[e_1,e_2,e_3]$，其中每个 $e_k$ 是测试用例 $k$ 的相对误差 $\\varepsilon$。",
            "solution": "用户提供了一个问题陈述，要求根据压力波测量数据，实现一种基于伴随方法的动脉壁刚度后验估计。该问题被构建为一个带有 Tikhonov 正则化的最小二乘优化问题，使用梯度下降法求解。其梯度通过离散伴随方法进行高效计算。\n\n### 问题验证\n\n已根据指定标准对问题陈述进行了严格验证。\n\n1.  **已知条件提取**：所有物理参数、数学模型、数值格式、优化参数和测试用例均已从问题陈述中成功提取。\n2.  **标准验证**：\n    *   **科学依据**：该问题在动脉波传播的生物力学方面有充分的依据。在所述假设（小振幅、可忽略的粘性和反射）下，使用一维线性平流方程是有效的简化。Moens–Korteweg 关系是连接波速与管壁属性的基本原理。对于 PDE 约束问题的梯度优化，使用伴随方法是计算科学中的一种标准且强大的技术。所有物理和数值参数都是真实且自洽的。例如，显式迎风格式稳定性的 Courant-Friedrichs-Lewy (CFL) 条件得到满足：$c_{\\max} = \\sqrt{E h_{\\max} / (2 \\rho R_0)} \\approx \\sqrt{3500 / (2 \\cdot 1060 \\cdot 0.01)} \\approx 12.85\\,\\mathrm{m/s}$，由此得到的库朗数 $\\nu = c_{\\max} \\Delta t / \\Delta x \\approx 12.85 \\cdot 10^{-4} / (0.2/79) \\approx 0.51  1$。\n    *   **适定性**：该问题被构建为一个明确定义的计算任务。它对正向模型、待最小化的目标函数、具体的优化算法（梯度下降）以及所有必要参数进行了完整描述。Tikhonov 正则化项的引入有助于稳定该反问题。\n    *   **客观性**：该问题以精确、无歧义的数学语言陈述，不含主观因素。\n    *   **内部一致性**：离散伴随方程的推导以及后续的梯度计算已经过验证。对于一个正向更新算子 $p^{n+1} = \\mathbf{M} p^n + b^n$，其伴随算子通过 $\\lambda^n = \\mathbf{M}^T \\lambda^{n+1} + \\partial J/\\partial p^n$ 将灵敏度反向传播。对于给定的迎风格式，$p_i^{n+1} = (1 - \\nu_i) p_i^n + \\nu_i p_{i-1}^n$（其中 $\\nu_i = c_i \\Delta t/\\Delta x$），其转置算子正确地给出了伴随递推关系 $\\lambda_i^n = (1-\\nu_i)\\lambda_i^{n+1} + \\nu_{i+1}\\lambda_{i+1}^{n+1} + \\partial J/\\partial p_i^n$，这与问题陈述中提供的公式相符。应用链式法则求解相对于刚度 $E h_i$ 的梯度的过程也是正确的。\n\n该问题被判定为**有效**。这是一个完整、一致且科学合理的问题。我们现在可以着手求解。\n\n### 算法求解\n求解过程被构建为指定梯度下降算法的实现。每次迭代包含三个主要部分：正向求解器、伴随求解器和梯度计算。\n\n1.  **正向模型**：正向模型基于给定的刚度分布 $E h(x)$ 模拟压力波传播 $p(x,t)$。\n    *   它接受一个数组 $E h_i$ 作为输入。\n    *   首先，为每个空间网格点 $x_i$ 计算局部波速 $c_i = \\sqrt{E h_i / (2 \\rho R_0)}$。\n    *   初始化一个二维数组 $p_i^n$ 来表示压力场。应用初始条件 $p_i^0 = p_{\\mathrm{prox}}(t_0)$（对所有 $i$）。\n    *   通过迭代时间步 $n=0, \\dots, N_t-2$ 来进行模拟。在每一步中：\n        *   设置近端边界条件：$p_0^{n+1} = p_{\\mathrm{prox}}(t_{n+1})$。\n        *   使用一阶显式迎风格式更新内部空间点 $i=1, \\dots, N_x-1$ 处的压力：$p_i^{n+1} = p_i^n - c_i \\frac{\\Delta t}{\\Delta x} (p_i^n - p_{i-1}^n)$。\n    *   该函数返回完整的压力场 $p_i^n$。\n\n2.  **伴随模型**：伴随模型计算拉格朗日乘子（伴随变量）$\\lambda_i^n$，它表示目标函数 $J$ 相对于状态变量 $p_i^n$ 的灵敏度。\n    *   伴随方程从 $n=N_t-1$ 到 $0$ 向后求解。\n    *   终端条件为 $\\lambda_i^{N_t} = 0$（对所有 $i$）。\n    *   在每个向后时间步中，根据下一时间步的值 $\\lambda_j^{n+1}$ 和目标函数在当前时间对压力的梯度 $\\partial J / \\partial p_i^n$ 来计算伴随变量 $\\lambda_i^n$。\n    *   $\\partial J / \\partial p_i^n$ 项仅在远端 $i=N_x-1$ 非零，其值等于预测和测量的远端压力之间的残差 $p_{N_x-1}^n - p_{\\mathrm{dist}}(t_n)$。\n    *   使用问题陈述中指定的递推关系来更新所有 $i$ 的伴随变量。\n\n3.  **梯度计算与更新**：一旦正向和伴随变量已知，就计算目标函数 $J$ 相对于控制参数 $E h_i$ 的梯度。\n    *   使用公式 $\\frac{\\partial J}{\\partial c_i} = \\sum_{n=0}^{N_t-1} \\lambda_i^{n+1} \\left( -\\Delta t \\frac{p_i^n - p_{i-1}^n}{\\Delta x} \\right)$，通过对每个时间步的贡献求和，计算 $J$ 的失配部分相对于波速的梯度 $\\partial J_{misfit} / \\partial c_i$。\n    *   应用链式法则将此梯度转换为相对于刚度的梯度：$\\frac{\\partial J_{misfit}}{\\partial E h_i} = \\frac{\\partial J_{misfit}}{\\partial c_i} \\frac{\\partial c_i}{\\partial E h_i}$，其中 $\\frac{\\partial c_i}{\\partial E h_i} = \\frac{1}{4\\rho R_0 c_i}$。\n    *   使用有限差分计算 Tikhonov 正则化项的梯度 $\\partial J_{reg} / \\partial E h_i$。对于内部点，这对应于 $\\beta(2E h_i - E h_{i-1} - E h_{i+1})$，在边界处使用单边差分。\n    *   总梯度是失配梯度和正则化梯度的和：$\\nabla_{Eh} J = \\nabla_{Eh} J_{misfit} + \\nabla_{Eh} J_{reg}$。\n    *   使用梯度下降步骤更新刚度分布：$E h^{(k+1)} = E h^{(k)} - \\alpha_{\\mathrm{lr}} \\nabla_{Eh} J$。\n    *   最后，通过将更新后的刚度投影到最小允许值上来强制执行正性约束：$E h_i^{(k+1)} = \\max(E h_i^{(k+1)}, E h_{\\min})$。\n\n对每个测试用例，该迭代过程重复固定次数。对于每个用例，首先通过使用已知的真实刚度分布 $E h_{\\mathrm{true}}(x)$ 运行正向模型，来人工生成“测量的”远端压力 $p_{\\mathrm{dist}}(t)$。优化之后，将最终估计的分布 $E h^{(\\mathrm{final})}$ 与真实值进行比较，以计算相对均方根误差 $\\varepsilon$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the inverse problem of estimating arterial wall stiffness using an\n    adjoint-based gradient descent method.\n    \"\"\"\n    # --- 1. Define constants and parameters ---\n    # Vessel and fluid properties\n    L = 0.2           # m\n    R0 = 0.01         # m\n    rho = 1060.0      # kg/m^3\n\n    # Discretization parameters\n    Nx = 80\n    dx = L / (Nx - 1)\n    dt = 1e-4         # s\n    T = 0.2           # s\n    Nt = int(T / dt)\n\n    # Inverse problem parameters\n    beta = 1e-3       # Regularization parameter\n    N_iter = 30       # Number of gradient descent iterations\n    Eh_initial = 1500.0 # N/m, initial guess for stiffness\n    alpha_lr = 0.1    # Learning rate\n    Eh_min = 800.0    # N/m, lower bound for stiffness projection\n\n    # --- 2. Set up grids and proximal input waveform ---\n    x = np.linspace(0, L, Nx)\n    t = np.arange(Nt) * dt\n\n    # Proximal pressure waveform\n    p0 = 10000.0      # Pa\n    A = 5000.0        # Pa\n    t_c = 0.05        # s\n    sigma = 0.02      # s\n    f = 8.0           # Hz\n    p_prox = p0 + A * np.exp(-(t - t_c)**2 / (2 * sigma**2)) * np.sin(2 * np.pi * f * t)\n\n    # --- 3. Define test cases ---\n    Eh_true_cases = [\n        np.full(Nx, 1400.0),  # Case 1: Constant\n        1000.0 + 1000.0 * (x / L), # Case 2: Linear gradient\n        np.where(x  L / 2, 1500.0, 3500.0) # Case 3: Step change\n    ]\n    \n    results = []\n\n    def forward_solve(Eh_profile):\n        \"\"\"\n        Solves the 1D advection equation using first-order upwind scheme.\n        \"\"\"\n        p = np.zeros((Nx, Nt))\n        c = np.sqrt(Eh_profile / (2 * rho * R0))\n        \n        # Initial condition: p(x, 0) = p_prox(0)\n        p[:, 0] = p_prox[0]\n        \n        # Time marching loop\n        for n in range(Nt - 1):\n            # Boundary condition: p(0, t) = p_prox(t)\n            p[0, n + 1] = p_prox[n + 1]\n            \n            # Upwind scheme for i = 1, ..., Nx-1\n            p[1:, n + 1] = p[1:, n] - dt * c[1:] * (p[1:, n] - p[:-1, n]) / dx\n        return p\n\n    # --- 4. Main loop over test cases ---\n    for Eh_true in Eh_true_cases:\n        # Generate synthetic \"measured\" distal data\n        p_true = forward_solve(Eh_true)\n        p_dist = p_true[Nx - 1, :]\n        \n        # --- Gradient Descent Optimization ---\n        Eh_est = np.full(Nx, Eh_initial)\n        \n        for _ in range(N_iter):\n            # --- Step A: Forward solve for predicted pressure ---\n            p_pred = forward_solve(Eh_est)\n            \n            # --- Step B: Adjoint solve for Lagrange multipliers ---\n            c_est = np.sqrt(Eh_est / (2 * rho * R0))\n            \n            # Adjoint variables, with terminal condition lam(t=T)=0\n            lam = np.zeros((Nx, Nt + 1))\n            \n            # Distal residual (misfit)\n            residuals = p_pred[Nx - 1, :] - p_dist\n            \n            # Backward time loop for adjoint system\n            for n in range(Nt - 1, -1, -1):\n                dJ_dp_n = np.zeros(Nx)\n                dJ_dp_n[Nx - 1] = residuals[n]\n                \n                # Adjoint recursion for i = 0, ..., Nx-2\n                nu_i = dt * c_est[:-1] / dx\n                nu_i_plus_1 = dt * c_est[1:] / dx\n                lam[:-1, n] = dJ_dp_n[:-1] + lam[:-1, n + 1] * (1 - nu_i) + lam[1:, n + 1] * nu_i_plus_1\n                \n                # Adjoint recursion for i = Nx-1\n                nu_nx_minus_1 = dt * c_est[Nx - 1] / dx\n                lam[Nx - 1, n] = dJ_dp_n[Nx - 1] + lam[Nx - 1, n + 1] * (1 - nu_nx_minus_1)\n\n            # --- Step C: Gradient calculation ---\n            # Gradient of misfit w.r.t. c\n            grad_c = np.zeros(Nx)\n            # Sum over time steps where lam[n+1] is potentially non-zero\n            for n in range(Nt - 1):\n                # Valid for i=1,...,Nx-1\n                grad_c[1:] += lam[1:, n + 1] * (-dt / dx * (p_pred[1:, n] - p_pred[:-1, n]))\n            \n            # Apply chain rule to get gradient w.r.t. Eh\n            # Note: grad_c[0] is zero, so grad_Eh_misfit[0] is also zero\n            grad_Eh_misfit = (1 / (4 * rho * R0 * c_est)) * grad_c\n            \n            # Gradient of regularization term\n            grad_Eh_reg = np.zeros(Nx)\n            grad_Eh_reg[1:Nx-1] = beta * (2 * Eh_est[1:Nx-1] - Eh_est[0:Nx-2] - Eh_est[2:Nx])\n            grad_Eh_reg[0] = beta * (Eh_est[0] - Eh_est[1])\n            grad_Eh_reg[Nx-1] = beta * (Eh_est[Nx-1] - Eh_est[Nx-2])\n            \n            # Total gradient\n            total_grad_Eh = grad_Eh_misfit + grad_Eh_reg\n            \n            # --- Step D: Update Eh and project ---\n            Eh_est -= alpha_lr * total_grad_Eh\n            Eh_est = np.maximum(Eh_min, Eh_est)\n        \n        # --- 5. Calculate final error for the test case ---\n        error_num = np.sum((Eh_est - Eh_true)**2)\n        error_den = np.sum(Eh_true**2)\n        epsilon = np.sqrt(error_num / error_den)\n        results.append(epsilon)\n    \n    # --- 6. Final output ---\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}