{
    "hands_on_practices": [
        {
            "introduction": "Accurate kinematic data is the foundation of biomechanical analysis, yet all experimental measurements are subject to error. This exercise addresses the critical issue of skin motion artifact, a major source of error in optical motion capture. By propagating simulated marker noise through a hip angle calculation, you will quantify the uncertainty in kinematic outputs, a crucial skill for interpreting experimental results with appropriate scientific rigor. ",
            "id": "4178180",
            "problem": "Consider a planar sagittal-plane model of hip joint biomechanics during quasi-static stance, in which the pelvis local coordinate system is known with negligible error and defines the anterior ($x$) and superior ($y$) axes. The long axis of the thigh segment is estimated from two skin-mounted markers on the lateral thigh: a proximal marker $M_{1}$ and a distal marker $M_{2}$. The thigh axis vector is defined as $\\mathbf{v} = \\mathbf{M}_{2} - \\mathbf{M}_{1}$, and the hip flexion angle $\\theta$ is computed from this axis as $\\theta = \\arctan2(v_{y}, v_{x})$, where $\\mathbf{v} = (v_{x}, v_{y})$ in the pelvis coordinate system. Assume the true thigh axis has magnitude $L$ and true flexion angle $\\theta_{0}$, so that $v_{x} = L \\cos(\\theta_{0})$ and $v_{y} = L \\sin(\\theta_{0})$.\n\nSkin motion artifact is modeled as additive marker displacement noise. Let the observed marker positions be $\\tilde{\\mathbf{M}}_{i} = \\mathbf{M}_{i} + \\boldsymbol{\\epsilon}_{i}$ for $i \\in \\{1,2\\}$, where each $\\boldsymbol{\\epsilon}_{i}$ is a zero-mean Gaussian random vector with anisotropic, axis-aligned covariance. Specifically, for each marker,\n$\\boldsymbol{\\epsilon}_{i} \\sim \\mathcal{N}\\!\\left(\\mathbf{0}, \\boldsymbol{\\Sigma}_{m}\\right)$ with $\\boldsymbol{\\Sigma}_{m} = \\mathrm{diag}\\!\\left(\\sigma_{x}^{2}, \\sigma_{y}^{2}\\right)$, and there is cross-marker correlation along each axis such that $\\mathrm{corr}\\!\\left(\\epsilon_{1x}, \\epsilon_{2x}\\right) = \\mathrm{corr}\\!\\left(\\epsilon_{1y}, \\epsilon_{2y}\\right) = \\rho$. Assume no cross-axis coupling, i.e., $\\mathrm{cov}\\!\\left(\\epsilon_{ix}, \\epsilon_{jy}\\right) = 0$ for all $i,j$.\n\nUsing first principles (kinematics definitions and first-order linearization of $\\arctan2$), propagate the marker displacement noise through the hip angle calculation to obtain the expected Root Mean Square (RMS) hip angle error due solely to the skin motion artifact. Treat the pelvis coordinate system as exact. Use the following numerical values:\n- $L = 0.40$ m,\n- $\\theta_{0} = 30^{\\circ}$,\n- $\\sigma_{x} = 0.008$ m,\n- $\\sigma_{y} = 0.012$ m,\n- $\\rho = 0.60$.\n\nExpress the final expected RMS hip angle error in degrees. Round your answer to four significant figures.",
            "solution": "The problem requires the calculation of the expected Root Mean Square (RMS) hip angle error resulting from marker placement noise. The hip flexion angle, $\\theta$, is defined as a function of the components of the thigh axis vector $\\mathbf{v} = (v_x, v_y)$, where $\\theta = \\arctan2(v_y, v_x)$. The error in $\\theta$ is caused by errors in $v_x$ and $v_y$, which in turn are caused by noise in the marker positions. We can quantify this using first-order error propagation.\n\nLet $\\theta_0$ be the true hip angle and $\\theta$ be the measured angle. The error in the angle is $\\Delta\\theta = \\theta - \\theta_0$. Using a first-order Taylor series expansion of $\\theta(v_x, v_y)$ around the true vector components, $(v_{x0}, v_{y0})$, the angle error can be approximated as:\n$$\n\\Delta\\theta \\approx \\left. \\frac{\\partial \\theta}{\\partial v_x} \\right|_{0} \\Delta v_x + \\left. \\frac{\\partial \\theta}{\\partial v_y} \\right|_{0} \\Delta v_y\n$$\nwhere $\\Delta v_x = v_x - v_{x0}$ and $\\Delta v_y = v_y - v_{y0}$ are the errors in the vector components, and the partial derivatives are evaluated at the true values.\n\nThe expected RMS error is defined as $\\sqrt{\\mathrm{E}[(\\Delta\\theta)^2]}$. Since the noise sources are zero-mean, the expected errors $\\mathrm{E}[\\Delta v_x]$ and $\\mathrm{E}[\\Delta v_y]$ are zero. Consequently, the expected angle error $\\mathrm{E}[\\Delta\\theta]$ is approximately zero. Therefore, $\\mathrm{E}[(\\Delta\\theta)^2] \\approx \\mathrm{var}(\\Delta\\theta)$, and the RMS error is the standard deviation of the angle error, $\\sigma_{\\theta}$.\n\nThe variance of the angle error, $\\mathrm{var}(\\Delta\\theta)$, is given by the general formula for propagation of uncertainty:\n$$\n\\sigma_{\\theta}^2 = \\mathrm{var}(\\Delta\\theta) \\approx \\left(\\frac{\\partial \\theta}{\\partial v_x}\\right)^2 \\mathrm{var}(\\Delta v_x) + \\left(\\frac{\\partial \\theta}{\\partial v_y}\\right)^2 \\mathrm{var}(\\Delta v_y) + 2 \\left(\\frac{\\partial \\theta}{\\partial v_x}\\right) \\left(\\frac{\\partial \\theta}{\\partial v_y}\\right) \\mathrm{cov}(\\Delta v_x, \\Delta v_y)\n$$\n\nFirst, we find the partial derivatives of $\\theta = \\arctan(v_y / v_x)$:\n$$\n\\frac{\\partial \\theta}{\\partial v_x} = \\frac{1}{1 + (v_y/v_x)^2} \\left(-\\frac{v_y}{v_x^2}\\right) = \\frac{-v_y}{v_x^2 + v_y^2}\n$$\n$$\n\\frac{\\partial \\theta}{\\partial v_y} = \\frac{1}{1 + (v_y/v_x)^2} \\left(\\frac{1}{v_x}\\right) = \\frac{v_x}{v_x^2 + v_y^2}\n$$\nThe true vector components are $v_{x0} = L \\cos(\\theta_0)$ and $v_{y0} = L \\sin(\\theta_0)$. The squared magnitude is $v_{x0}^2 + v_{y0}^2 = L^2$. Evaluating the derivatives at the true values:\n$$\n\\left. \\frac{\\partial \\theta}{\\partial v_x} \\right|_{0} = \\frac{-L \\sin(\\theta_0)}{L^2} = -\\frac{\\sin(\\theta_0)}{L}\n$$\n$$\n\\left. \\frac{\\partial \\theta}{\\partial v_y} \\right|_{0} = \\frac{L \\cos(\\theta_0)}{L^2} = \\frac{\\cos(\\theta_0)}{L}\n$$\n\nNext, we determine the statistical properties of the vector component errors, $\\Delta v_x$ and $\\Delta v_y$. The observed thigh vector is $\\tilde{\\mathbf{v}} = \\tilde{\\mathbf{M}}_2 - \\tilde{\\mathbf{M}}_1 = (\\mathbf{M}_2 + \\boldsymbol{\\epsilon}_2) - (\\mathbf{M}_1 + \\boldsymbol{\\epsilon}_1) = (\\mathbf{M}_2 - \\mathbf{M}_1) + (\\boldsymbol{\\epsilon}_2 - \\boldsymbol{\\epsilon}_1) = \\mathbf{v}_0 + \\Delta\\mathbf{v}$.\nThe error vector is $\\Delta\\mathbf{v} = \\boldsymbol{\\epsilon}_2 - \\boldsymbol{\\epsilon}_1$. The components of the error vector are:\n$$\n\\Delta v_x = \\epsilon_{2x} - \\epsilon_{1x}\n$$\n$$\n\\Delta v_y = \\epsilon_{2y} - \\epsilon_{1y}\n$$\nThe variances of these components are:\n$$\n\\mathrm{var}(\\Delta v_x) = \\mathrm{var}(\\epsilon_{2x} - \\epsilon_{1x}) = \\mathrm{var}(\\epsilon_{2x}) + \\mathrm{var}(\\epsilon_{1x}) - 2\\mathrm{cov}(\\epsilon_{1x}, \\epsilon_{2x})\n$$\nGiven $\\mathrm{var}(\\epsilon_{1x}) = \\mathrm{var}(\\epsilon_{2x}) = \\sigma_x^2$ and $\\mathrm{corr}(\\epsilon_{1x}, \\epsilon_{2x}) = \\rho$, we have $\\mathrm{cov}(\\epsilon_{1x}, \\epsilon_{2x}) = \\rho\\sigma_x^2$. Thus:\n$$\n\\mathrm{var}(\\Delta v_x) = \\sigma_x^2 + \\sigma_x^2 - 2\\rho\\sigma_x^2 = 2\\sigma_x^2(1-\\rho)\n$$\nSimilarly, for the $y$-component:\n$$\n\\mathrm{var}(\\Delta v_y) = \\mathrm{var}(\\epsilon_{2y}) + \\mathrm{var}(\\epsilon_{1y}) - 2\\mathrm{cov}(\\epsilon_{1y}, \\epsilon_{2y}) = \\sigma_y^2 + \\sigma_y^2 - 2\\rho\\sigma_y^2 = 2\\sigma_y^2(1-\\rho)\n$$\nThe covariance term is:\n$$\n\\mathrm{cov}(\\Delta v_x, \\Delta v_y) = \\mathrm{cov}(\\epsilon_{2x} - \\epsilon_{1x}, \\epsilon_{2y} - \\epsilon_{1y}) = \\mathrm{cov}(\\epsilon_{2x},\\epsilon_{2y}) - \\mathrm{cov}(\\epsilon_{2x},\\epsilon_{1y}) - \\mathrm{cov}(\\epsilon_{1x},\\epsilon_{2y}) + \\mathrm{cov}(\\epsilon_{1x},\\epsilon_{1y})\n$$\nThe problem states that there is no cross-axis coupling, i.e., $\\mathrm{cov}(\\epsilon_{ix}, \\epsilon_{jy}) = 0$ for all $i,j \\in \\{1,2\\}$. Therefore, all terms in the covariance expansion are zero, and $\\mathrm{cov}(\\Delta v_x, \\Delta v_y) = 0$.\n\nSubstituting the derivatives and variances into the formula for $\\sigma_{\\theta}^2$:\n$$\n\\sigma_{\\theta}^2 \\approx \\left(-\\frac{\\sin(\\theta_0)}{L}\\right)^2 [2\\sigma_x^2(1-\\rho)] + \\left(\\frac{\\cos(\\theta_0)}{L}\\right)^2 [2\\sigma_y^2(1-\\rho)]\n$$\n$$\n\\sigma_{\\theta}^2 \\approx \\frac{2(1-\\rho)}{L^2} \\left[ \\sigma_x^2\\sin^2(\\theta_0) + \\sigma_y^2\\cos^2(\\theta_0) \\right]\n$$\nNow, we substitute the given numerical values:\n$L = 0.40$ m\n$\\theta_0 = 30^{\\circ}$\n$\\sigma_x = 0.008$ m\n$\\sigma_y = 0.012$ m\n$\\rho = 0.60$\n\nWe have $\\sin(30^{\\circ}) = 0.5$ and $\\cos(30^{\\circ}) = \\frac{\\sqrt{3}}{2}$.\nThus, $\\sin^2(30^{\\circ}) = 0.25$ and $\\cos^2(30^{\\circ}) = 0.75$.\nThe marker error variances are $\\sigma_x^2 = (0.008)^2 = 6.4 \\times 10^{-5}$ m$^2$ and $\\sigma_y^2 = (0.012)^2 = 1.44 \\times 10^{-4}$ m$^2$.\nThe segment length squared is $L^2 = (0.40)^2 = 0.16$ m$^2$.\nThe correlation factor is $1-\\rho = 1-0.60 = 0.40$.\n\nLet's compute the variance of the angle in radians squared:\n$$\n\\sigma_{\\theta}^2 \\approx \\frac{2(0.40)}{0.16} \\left[ (6.4 \\times 10^{-5})(0.25) + (1.44 \\times 10^{-4})(0.75) \\right]\n$$\n$$\n\\sigma_{\\theta}^2 \\approx 5 \\left[ 1.6 \\times 10^{-5} + 1.08 \\times 10^{-4} \\right] = 5 \\left[ 0.16 \\times 10^{-4} + 1.08 \\times 10^{-4} \\right]\n$$\n$$\n\\sigma_{\\theta}^2 \\approx 5 [1.24 \\times 10^{-4}] = 6.2 \\times 10^{-4} \\text{ rad}^2\n$$\nThe RMS error is the standard deviation, $\\sigma_{\\theta}$:\n$$\n\\sigma_{\\theta} = \\sqrt{6.2 \\times 10^{-4}} \\approx 0.0248998 \\text{ rad}\n$$\nFinally, we convert this result from radians to degrees:\n$$\n\\sigma_{\\theta, \\text{deg}} = \\sigma_{\\theta} \\times \\frac{180^{\\circ}}{\\pi} \\approx 0.0248998 \\times \\frac{180}{\\pi} \\approx 1.42668^{\\circ}\n$$\nRounding to four significant figures, the expected RMS hip angle error is $1.427^{\\circ}$.",
            "answer": "$$\n\\boxed{1.427}\n$$"
        },
        {
            "introduction": "Musculoskeletal models are powerful tools for understanding the relationship between anatomy and function. A key component of these models is the accurate representation of musculotendon paths, as they determine how muscle length and moment arm change with joint motion. This computational practice challenges you to implement a muscle wrapping algorithm around a simplified joint obstacle, providing hands-on experience with the geometric principles that underpin modern biomechanical simulation software. ",
            "id": "4178199",
            "problem": "A single-degree-of-freedom hip joint is modeled as a perfect spherical joint with a spherical obstacle representing either the acetabular rim or the femoral head. A musculotendon path connects a fixed origin on the pelvis to a fixed insertion on the femur, which undergoes rigid-body rotation about the hip joint center. When the straight-line segment between the origin and the rotated insertion point would penetrate the spherical obstacle, the path wraps: it follows a straight segment from the origin to a tangent point on the sphere, a spherical geodesic arc on the obstacle surface between two tangent points, and a straight segment from the second tangent point to the insertion. When no penetration occurs, the path is the straight-line segment.\n\nUse the following foundational bases:\n- Newton’s laws of motion and the definition of work as force times displacement. Employ the principle of virtual work that relates the moment generated by a musculotendon to the derivative of musculotendon length with respect to the generalized coordinate.\n- Rigid-body kinematics: rotation of a point about a fixed axis is described by a rotation matrix.\n- Euclidean geometry: the minimal path avoiding a convex spherical obstacle lies in the plane spanned by the joint center and the two endpoints; tangent segments from an external point to a circle in that plane have equal lengths, and the geodesic on the sphere between tangent points projects to a circular arc within that plane.\n\nPrecisely define the geometry:\n- The hip joint center is at the origin, $\\mathbf{O} = (0,0,0)$ in meters.\n- The spherical obstacle has radius $R = 0.026$ meters centered at $\\mathbf{O}$.\n- The pelvis coordinate axes are orthonormal with $x$ anterior, $y$ superior, and $z$ lateral.\n- Hip flexion–extension is modeled as a pure rotation about the $y$-axis by angle $\\theta$ (in radians). The femoral insertion position in pelvis coordinates is $\\mathbf{p}_2(\\theta) = R_y(\\theta)\\,\\mathbf{p}_{2,b}$, where $\\mathbf{p}_{2,b}$ is the insertion point expressed in the femur local frame and\n$$\nR_y(\\theta) =\n\\begin{bmatrix}\n\\cos\\theta  0  \\sin\\theta \\\\\n0  1  0 \\\\\n-\\sin\\theta  0  \\cos\\theta\n\\end{bmatrix}.\n$$\n\nPath specification and computation requirements:\n- The straight segment $\\overline{\\mathbf{p}_1\\mathbf{p}_2(\\theta)}$ must be checked for intersection with the sphere of radius $R$. Intersection occurs if the minimal distance from $\\mathbf{O}$ to the segment is strictly less than $R$.\n- If intersection occurs (wrap case), construct the wrapped path within the plane spanned by $\\mathbf{O}$, $\\mathbf{p}_1$, and $\\mathbf{p}_2(\\theta)$. In that plane, treat the sphere as a circle of radius $R$. From $\\mathbf{p}_1$ and $\\mathbf{p}_2(\\theta)$, determine the two possible tangent directions to the circle for each external point and select the pair of tangent points that results in the minimal total path length, which is the sum of the two tangent segment lengths and the circle arc length connecting the tangent points. The tangent segment length from an external point at distance $d$ from the origin equals $\\sqrt{d^2 - R^2}$, and the arc length is $R$ times the minimal angular separation between the chosen tangent directions. Ensure the chosen arc is the shorter arc on the circle.\n- If no intersection occurs (no-wrap case), the path length is simply the Euclidean norm $\\|\\mathbf{p}_2(\\theta) - \\mathbf{p}_1\\|$.\n\nMoment arm specification:\n- Using first principles, relate the musculotendon moment about the hip flexion–extension axis to the change in musculotendon length under an infinitesimal rotation. You must compute the moment arm $r(\\theta)$ as the derivative of the musculotendon length $L(\\theta)$ with respect to $\\theta$ (in radians). Express the moment arm in meters. You may approximate the derivative numerically using a symmetric finite difference with a sufficiently small step in $\\theta$ to ensure accuracy and stability.\n\nUnits and outputs:\n- Express all musculotendon lengths in meters and moment arms in meters. Use angles in radians.\n- For numerical derivative, select a small step size $\\delta\\theta$ in radians. Use a symmetric difference formula to compute $r(\\theta)$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[L_1,r_1,L_2,r_2,\\dots]$ for the test suite below. Each floating-point number must be rounded to six decimal places.\n\nTest suite:\nFor each case, the origin $\\mathbf{p}_1$ and base insertion $\\mathbf{p}_{2,b}$ are given; compute $L(\\theta)$ and $r(\\theta)$ at the specified $\\theta$.\n\n- Case 1 (happy path, likely wrap for a lateral muscle at neutral):\n  - $\\mathbf{p}_1 = (-0.010,\\,0.080,\\,0.050)$ m\n  - $\\mathbf{p}_{2,b} = (0.005,\\,0.000,\\,0.040)$ m\n  - $\\theta = 0.0$ radians\n- Case 2 (variation in angle for the same muscle, increased flexion):\n  - $\\mathbf{p}_1 = (-0.010,\\,0.080,\\,0.050)$ m\n  - $\\mathbf{p}_{2,b} = (0.005,\\,0.000,\\,0.040)$ m\n  - $\\theta = 0.7$ radians\n- Case 3 (anterior muscle under extension, testing geometry on the anterior side):\n  - $\\mathbf{p}_1 = (0.030,\\,0.080,\\,-0.010)$ m\n  - $\\mathbf{p}_{2,b} = (0.010,\\,-0.010,\\,-0.030)$ m\n  - $\\theta = -0.5$ radians\n- Case 4 (boundary condition: straight line tangent to the sphere at neutral):\n  - $\\mathbf{p}_1 = (-0.100,\\,0.000,\\,R)$ m with $R = 0.026$ m\n  - $\\mathbf{p}_{2,b} = (0.100,\\,0.000,\\,R)$ m with $R = 0.026$ m\n  - $\\theta = 0.0$ radians\n- Case 5 (no-wrap case with a more medial–posterior line-of-sight):\n  - $\\mathbf{p}_1 = (0.010,\\,0.070,\\,-0.080)$ m\n  - $\\mathbf{p}_{2,b} = (0.020,\\,-0.020,\\,-0.060)$ m\n  - $\\theta = -0.3$ radians\n\nYour program must implement the geometry and kinematics described above, compute $L(\\theta)$ and $r(\\theta)$ for each case, and output a single line with the ten numbers $[L_1,r_1,L_2,r_2,L_3,r_3,L_4,r_4,L_5,r_5]$, rounded to six decimal places.",
            "solution": "The problem is deemed valid as it is scientifically grounded in the principles of biomechanics, kinematics, and Euclidean geometry. It is well-posed, with all necessary parameters and conditions defined, allowing for a unique and stable solution. The problem is objective, complete, and its components are internally consistent and physically plausible within the context of a simplified biomechanical model.\n\nThe solution is to compute the musculotendon length $L(\\theta)$ and its corresponding moment arm $r(\\theta)$ for a simplified hip joint model. The process involves determining the path of a musculotendon, which may either be a straight line or wrap around a spherical obstacle representing the joint. The moment arm is then calculated as the derivative of the path length with respect to the joint angle.\n\nThe core of the computation is a function that calculates the musculotendon length $L$ for a given joint angle $\\theta$. This function takes as input the muscle origin point $\\mathbf{p}_1$, the insertion point in the bone's local frame $\\mathbf{p}_{2,b}$, the joint angle $\\theta$, and the obstacle radius $R$.\n\n1.  **Rigid-Body Kinematics**:\n    The position of the muscle insertion on the femur, $\\mathbf{p}_2(\\theta)$, is found by rotating its position in the local femoral frame, $\\mathbf{p}_{2,b}$, about the flexion-extension axis (the $y$-axis) by the angle $\\theta$. The origin of the joint is at $\\mathbf{O} = (0,0,0)$. The transformation is given by:\n    $$\n    \\mathbf{p}_2(\\theta) = R_y(\\theta)\\,\\mathbf{p}_{2,b}\n    $$\n    where $R_y(\\theta)$ is the rotation matrix about the $y$-axis:\n    $$\n    R_y(\\theta) =\n    \\begin{bmatrix}\n    \\cos\\theta  0  \\sin\\theta \\\\\n    0  1  0 \\\\\n    -\\sin\\theta  0  \\cos\\theta\n    \\end{bmatrix}\n    $$\n\n2.  **Path Type Determination (Wrap vs. No-Wrap)**:\n    The path of the musculotendon is the shortest possible line between $\\mathbf{p}_1$ and $\\mathbf{p}_2(\\theta)$ that does not penetrate the spherical obstacle of radius $R$ centered at the origin. Both $\\mathbf{p}_1$ and $\\mathbf{p}_2(\\theta)$ are assumed to be outside the sphere, i.e., $\\|\\mathbf{p}_1\\| > R$ and $\\|\\mathbf{p}_2(\\theta)\\| > R$. The wrapping condition is determined by analyzing the geometry in the plane spanned by $\\mathbf{O}$, $\\mathbf{p}_1$, and $\\mathbf{p}_2(\\theta)$.\n\n    Let $d_1 = \\|\\mathbf{p}_1\\|$ and $d_2 = \\|\\mathbf{p}_2(\\theta)\\|$ be the distances of the origin and insertion points from the joint center. Let $\\alpha$ be the angle between the vectors $\\mathbf{p}_1$ and $\\mathbf{p}_2(\\theta)$, which is calculated as:\n    $$\n    \\alpha = \\arccos\\left(\\frac{\\mathbf{p}_1 \\cdot \\mathbf{p}_2(\\theta)}{d_1 d_2}\\right)\n    $$\n    The path wraps around the sphere if the straight line segment between $\\mathbf{p}_1$ and $\\mathbf{p}_2(\\theta)$ would intersect it. This condition is geometrically equivalent to the angle $\\alpha$ being greater than the sum of the angles formed by the tangent lines from each point to the sphere. Let these tangent angles be $\\beta_1$ and $\\beta_2$, given by:\n    $$\n    \\beta_1 = \\arccos\\left(\\frac{R}{d_1}\\right) \\quad \\text{and} \\quad \\beta_2 = \\arccos\\left(\\frac{R}{d_2}\\right)\n    $$\n    Wrapping occurs if and only if $\\alpha > \\beta_1 + \\beta_2$.\n\n3.  **Path Length Calculation, $L(\\theta)$**:\n    -   **No-Wrap Case**: If $\\alpha \\le \\beta_1 + \\beta_2$, the path is a straight line segment. Its length is the Euclidean distance between the points:\n        $$\n        L(\\theta) = \\|\\mathbf{p}_2(\\theta) - \\mathbf{p}_1\\|\n        $$\n    -   **Wrap Case**: If $\\alpha > \\beta_1 + \\beta_2$, the path consists of two straight segments tangent to the sphere and a geodesic arc on the sphere's surface connecting the two tangent points.\n        The length of the tangent segment from $\\mathbf{p}_1$ is $L_{t1} = \\sqrt{d_1^2 - R^2}$.\n        The length of the tangent segment from $\\mathbf{p}_2(\\theta)$ is $L_{t2} = \\sqrt{d_2^2 - R^2}$.\n        The angle of the wrapping arc, $\\gamma$, is the total angle minus the tangent angles: $\\gamma = \\alpha - (\\beta_1 + \\beta_2)$.\n        The length of the arc is $L_{arc} = R \\gamma$.\n        The total path length is the sum of these three components:\n        $$\n        L(\\theta) = L_{t1} + L_{t2} + L_{arc} = \\sqrt{d_1^2 - R^2} + \\sqrt{d_2^2 - R^2} + R\\left( \\arccos\\left(\\frac{\\mathbf{p}_1 \\cdot \\mathbf{p}_2(\\theta)}{d_1 d_2}\\right) - \\arccos\\left(\\frac{R}{d_1}\\right) - \\arccos\\left(\\frac{R}{d_2}\\right) \\right)\n        $$\n\n4.  **Moment Arm Calculation, $r(\\theta)$**:\n    The moment arm $r(\\theta)$ is defined by the principle of virtual work as the derivative of the musculotendon length with respect to the generalized coordinate $\\theta$:\n    $$\n    r(\\theta) = \\frac{dL(\\theta)}{d\\theta}\n    $$\n    This derivative is approximated numerically using a second-order accurate symmetric finite difference formula with a small step size $\\delta\\theta$:\n    $$\n    r(\\theta) \\approx \\frac{L(\\theta + \\delta\\theta) - L(\\theta - \\delta\\theta)}{2 \\delta\\theta}\n    $$\n    A sufficiently small step size, such as $\\delta\\theta = 10^{-7}$ radians, is chosen to ensure numerical accuracy and stability.\n\nFor each test case, the above steps are carried out. First, $L(\\theta)$ is computed for the specified angle $\\theta$. Then, the length function is evaluated at $\\theta + \\delta\\theta$ and $\\theta - \\delta\\theta$ to compute the moment arm $r(\\theta)$. The results are then collected and formatted as specified.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the hip joint biomechanics problem for a suite of test cases.\n    \"\"\"\n    # Global constants defined in the problem\n    R = 0.026  # meters\n    DELTA_THETA = 1e-7  # radians, for finite difference\n\n    def get_rotation_matrix_y(theta):\n        \"\"\"\n        Computes the rotation matrix for a rotation about the y-axis.\n        \"\"\"\n        c, s = np.cos(theta), np.sin(theta)\n        return np.array([\n            [c, 0, s],\n            [0, 1, 0],\n            [-s, 0, c]\n        ], dtype=np.float64)\n\n    def compute_length(theta, p1, p2_b):\n        \"\"\"\n        Calculates the musculotendon path length for a given angle theta.\n\n        The function determines whether the path is a straight line or if it\n        wraps around the spherical obstacle, and computes the length accordingly.\n\n        Args:\n            theta (float): The joint angle in radians.\n            p1 (np.ndarray): The 3D vector of the muscle origin.\n            p2_b (np.ndarray): The 3D vector of the muscle insertion in the\n                               femur's local frame.\n\n        Returns:\n            float: The calculated musculotendon path length in meters.\n        \"\"\"\n        # Step 1: Calculate the rotated insertion point p2\n        rot_matrix = get_rotation_matrix_y(theta)\n        p2 = rot_matrix @ p2_b\n\n        # Step 2: Determine if wrapping occurs\n        d1 = np.linalg.norm(p1)\n        d2 = np.linalg.norm(p2)\n\n        # The problem setup ensures endpoints are outside the sphere.\n        # If an endpoint were inside or on the sphere, wrapping is ill-defined\n        # or defaults to straight line. We check just in case.\n        if d1 = R or d2 = R:\n            return np.linalg.norm(p2 - p1)\n\n        # Calculate angle alpha between p1 and p2 vectors from origin\n        dot_p1_p2 = np.dot(p1, p2)\n        # Clip for numerical stability of arccos\n        cos_alpha = np.clip(dot_p1_p2 / (d1 * d2), -1.0, 1.0)\n        alpha = np.arccos(cos_alpha)\n\n        # Calculate tangent angles beta1 and beta2\n        beta1 = np.arccos(np.clip(R / d1, -1.0, 1.0))\n        beta2 = np.arccos(np.clip(R / d2, -1.0, 1.0))\n\n        # Step 3: Calculate path length based on wrapping condition\n        if alpha > (beta1 + beta2):\n            # Wrap Case: path is tangent-arc-tangent\n            len_tangent1 = np.sqrt(d1**2 - R**2)\n            len_tangent2 = np.sqrt(d2**2 - R**2)\n            \n            arc_angle_gamma = alpha - beta1 - beta2\n            len_arc = R * arc_angle_gamma\n            \n            return len_tangent1 + len_tangent2 + len_arc\n        else:\n            # No-Wrap Case: path is a straight line\n            return np.linalg.norm(p2 - p1)\n\n    # Test suite provided in the problem statement\n    test_cases = [\n        # Case 1\n        {'p1': np.array([-0.010, 0.080, 0.050]), 'p2_b': np.array([0.005, 0.000, 0.040]), 'theta': 0.0},\n        # Case 2\n        {'p1': np.array([-0.010, 0.080, 0.050]), 'p2_b': np.array([0.005, 0.000, 0.040]), 'theta': 0.7},\n        # Case 3\n        {'p1': np.array([0.030, 0.080, -0.010]), 'p2_b': np.array([0.010, -0.010, -0.030]), 'theta': -0.5},\n        # Case 4\n        {'p1': np.array([-0.100, 0.000, R]), 'p2_b': np.array([0.100, 0.000, R]), 'theta': 0.0},\n        # Case 5\n        {'p1': np.array([0.010, 0.070, -0.080]), 'p2_b': np.array([0.020, -0.020, -0.060]), 'theta': -0.3}\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        p1 = case['p1']\n        p2_b = case['p2_b']\n        theta = case['theta']\n        \n        # Calculate musculotendon length L(theta)\n        L_theta = compute_length(theta, p1, p2_b)\n        \n        # Calculate L(theta + d_theta) and L(theta - d_theta) for finite difference\n        L_plus = compute_length(theta + DELTA_THETA, p1, p2_b)\n        L_minus = compute_length(theta - DELTA_THETA, p1, p2_b)\n        \n        # Calculate moment arm r(theta) using symmetric finite difference\n        r_theta = (L_plus - L_minus) / (2 * DELTA_THETA)\n        \n        all_results.append(L_theta)\n        all_results.append(r_theta)\n        \n    # Format the final output string as required, with rounding to six decimal places.\n    formatted_results = [f\"{val:.6f}\" for val in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Inverse dynamics provides the net joint moment required for a given motion, but does not reveal how individual muscles contribute to this total effort. This problem bridges that gap by applying the fundamental principles of rotational kinetics, namely the cross product, to determine a single muscle's contribution to the net hip moment. This analysis is essential for understanding muscle function, coordination strategies, and the physiological basis of movement. ",
            "id": "4178161",
            "problem": "A subject is analyzed during the terminal stance phase of gait. Consider the pelvis segment coordinate system with origin at the hip joint center. The pelvis axes are defined as follows: the $x$-axis points anteriorly, the $y$-axis points superiorly, and the $z$-axis points to the subject’s right (mediolateral axis). Adopt the right-hand rule for moments, and define a positive hip flexion-extension moment as the component along the $+z$-axis that produces hip extension.\n\nAt a specific instant, a posterior hip extensor muscle has a measured muscle force vector in the pelvis frame given by components $\\mathbf{F} = (-1500, 600, -400)$ N. A position vector from the hip joint center to a point on the muscle’s line of action is measured as $\\mathbf{r} = (-0.03, 0.05, 0.04)$ m. The net hip flexion-extension moment from Inverse Dynamics (ID) at this instant, resolved about the $+z$-axis in the pelvis frame, is $+50$ N·m (positive extension).\n\nStarting only from Newton’s laws (including that internal forces generate moments about a reference point via their lines of action) and the definition of moment about an axis, perform the following:\n\n1. Derive the contribution of this muscle to the hip flexion-extension moment about the $+z$-axis at the specified instant.\n2. Using moment balance about the $+z$-axis, determine the magnitude of the antagonistic flexion moment that must be present from other structures so that the total flexion-extension moment equals the net ID moment at that instant.\n\nExpress the required antagonistic flexion moment magnitude in N·m. Round your final answer to four significant figures.",
            "solution": "The problem requires the calculation of a muscle's moment contribution and a subsequent antagonistic moment using the principles of static equilibrium. The solution proceeds from the fundamental definition of the moment of a force.\n\nAccording to Newton's laws, a force $\\mathbf{F}$ applied at a point defined by a position vector $\\mathbf{r}$ relative to a reference point creates a moment $\\mathbf{M}$ about that reference point. The moment vector is defined by the cross product of the position vector and the force vector:\n$$ \\mathbf{M} = \\mathbf{r} \\times \\mathbf{F} $$\nThe problem is set within a right-handed Cartesian coordinate system with basis vectors $\\{\\mathbf{i}, \\mathbf{j}, \\mathbf{k}\\}$ corresponding to the $\\{x, y, z\\}$ axes (anterior, superior, right). The vectors $\\mathbf{r}$ and $\\mathbf{F}$ are given in component form:\n$$ \\mathbf{r} = r_x \\mathbf{i} + r_y \\mathbf{j} + r_z \\mathbf{k} $$\n$$ \\mathbf{F} = F_x \\mathbf{i} + F_y \\mathbf{j} + F_z \\mathbf{k} $$\nThe cross product can be expanded to find the components of the moment vector $\\mathbf{M} = M_x \\mathbf{i} + M_y \\mathbf{j} + M_z \\mathbf{k}$:\n$$ \\mathbf{M} = (r_y F_z - r_z F_y)\\mathbf{i} + (r_z F_x - r_x F_z)\\mathbf{j} + (r_x F_y - r_y F_x)\\mathbf{k} $$\nThe component of the moment about the $z$-axis, which corresponds to the hip flexion-extension moment in this problem's convention, is therefore:\n$$ M_z = r_x F_y - r_y F_x $$\n\n**Part 1: Derive the contribution of the muscle to the hip flexion-extension moment.**\n\nThe problem provides the following data:\nThe force vector of the posterior hip extensor muscle is $\\mathbf{F} = (-1500, 600, -400) \\, \\text{N}$. Its components are:\n$F_x = -1500 \\, \\text{N}$\n$F_y = 600 \\, \\text{N}$\n$F_z = -400 \\, \\text{N}$\n\nThe position vector from the hip joint center to the muscle's line of action is $\\mathbf{r} = (-0.03, 0.05, 0.04) \\, \\text{m}$. Its components are:\n$r_x = -0.03 \\, \\text{m}$\n$r_y = 0.05 \\, \\text{m}$\n$r_z = 0.04 \\, \\text{m}$\n\nThe moment contribution from this muscle about the $z$-axis, denoted as $M_{musc, z}$, is calculated using the formula for $M_z$:\n$$ M_{musc, z} = r_x F_y - r_y F_x $$\nSubstituting the numerical values:\n$$ M_{musc, z} = (-0.03 \\, \\text{m}) \\times (600 \\, \\text{N}) - (0.05 \\, \\text{m}) \\times (-1500 \\, \\text{N}) $$\n$$ M_{musc, z} = -18 \\, \\text{N·m} - (-75 \\, \\text{N·m}) $$\n$$ M_{musc, z} = -18 \\, \\text{N·m} + 75 \\, \\text{N·m} $$\n$$ M_{musc, z} = 57 \\, \\text{N·m} $$\nThe problem defines a positive moment about the $+z$-axis as producing hip extension. The calculated moment $M_{musc, z}$ is positive, indicating that this muscle generates an extension moment of magnitude $57 \\, \\text{N·m}$.\n\n**Part 2: Determine the magnitude of the antagonistic flexion moment.**\n\nThe principle of moment balance dictates that the net moment about an axis is the algebraic sum of all individual moment contributions about that same axis. The net hip flexion-extension moment, $M_{net, z}$, is given as the sum of the moment from the specified extensor muscle, $M_{musc, z}$, and the moment from all other structures, which is described as an antagonistic flexion moment, $M_{antag, z}$.\nThe balance equation is:\n$$ M_{net, z} = M_{musc, z} + M_{antag, z} $$\nThe problem provides the net moment from an Inverse Dynamics (ID) analysis:\n$$ M_{net, z} = +50 \\, \\text{N·m} $$\nThe positive sign signifies a net extension moment. We can now solve for the antagonistic moment component, $M_{antag, z}$:\n$$ M_{antag, z} = M_{net, z} - M_{musc, z} $$\nSubstituting the known values for $M_{net, z}$ and the calculated value for $M_{musc, z}$:\n$$ M_{antag, z} = 50 \\, \\text{N·m} - 57 \\, \\text{N·m} $$\n$$ M_{antag, z} = -7 \\, \\text{N·m} $$\nThe negative sign of $M_{antag, z}$ indicates that this moment acts in the direction opposite to extension, which is flexion, as per the established convention. This confirms its description as an \"antagonistic flexion moment\". The question asks for the *magnitude* of this moment, which is the absolute value of $M_{antag, z}$:\n$$ |M_{antag, z}| = |-7 \\, \\text{N·m}| = 7 \\, \\text{N·m} $$\nThe problem requires the final answer to be rounded to four significant figures. Expressing $7$ with four significant figures gives $7.000$.\nThus, the magnitude of the required antagonistic flexion moment is $7.000 \\, \\text{N·m}$.",
            "answer": "$$\n\\boxed{7.000}\n$$"
        }
    ]
}