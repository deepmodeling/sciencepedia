{
    "hands_on_practices": [
        {
            "introduction": "在任何生物力学分析中，定义一个一致的解剖参考坐标系都是至关重要的第一步。本练习 (  ) 提供了一个实践机会，让您能够使用基本的向量代数工具——格拉姆-施密特正交化和向量叉积——从解剖标志点衍生的向量中构建这样一个坐标系。掌握这项核心技能对于准确解读运动捕捉数据至关重要。",
            "id": "4163223",
            "problem": "一个实验室坐标测量系统在一个全局笛卡尔坐标系中采集了人体前臂节段上解剖学标志点的三维位置。根据这些标志点，形成了两个位移向量：\n$$\\mathbf{u} = \\begin{pmatrix}36 \\\\ -12 \\\\ 48\\end{pmatrix}\\ \\text{mm}, \\quad \\mathbf{v} = \\begin{pmatrix}18 \\\\ 30 \\\\ -6\\end{pmatrix}\\ \\text{mm}.$$\n根据国际生物力学学会（International Society of Biomechanics, ISB）推荐的常规做法，一个固定于刚性节段的解剖学参考坐标系可以基于标志点的方向来构建。你需要仅使用以下核心定义来构建一个节段固定的标准正交右手基 $\\{\\hat{\\mathbf{x}}, \\hat{\\mathbf{y}}, \\hat{\\mathbf{z}}\\}$：\n- 向量 $\\mathbf{a}$ 和 $\\mathbf{b}$ 的点积是 $\\mathbf{a}\\cdot\\mathbf{b}$，欧几里得范数是 $\\|\\mathbf{a}\\| = \\sqrt{\\mathbf{a}\\cdot\\mathbf{a}}$。\n- 格拉姆-施密特过程（Gram–Schmidt process）使用由点积定义的投影和由欧几里得范数进行的归一化，来对一组非共线向量进行标准正交化。\n- 叉积 $\\mathbf{a}\\times\\mathbf{b}$ 返回一个同时与 $\\mathbf{a}$ 和 $\\mathbf{b}$ 正交的向量，并确定了右手系。\n定义 $\\hat{\\mathbf{x}}$ 为沿 $\\mathbf{u}$ 方向（长轴近端到远端方向）的单位向量，定义 $\\hat{\\mathbf{y}}$ 为通过对 $\\mathbf{v}$ 相对于 $\\hat{\\mathbf{x}}$ 进行标准正交化得到的单位向量，使得 $\\hat{\\mathbf{y}}$ 位于 $\\mathbf{u}$ 和 $\\mathbf{v}$ 的生成空间内但与 $\\hat{\\mathbf{x}}$ 正交，并定义 $\\hat{\\mathbf{z}} = \\hat{\\mathbf{x}} \\times \\hat{\\mathbf{y}}$ 来构成一个右手三向量组。将得到的基写成 $3\\times 3$ 的方向矩阵\n$$B = [\\hat{\\mathbf{x}}\\ \\hat{\\mathbf{y}}\\ \\hat{\\mathbf{z}}],$$\n所有元素都用根式精确表示。该方向矩阵是无量纲的。不需要进行数值舍入。",
            "solution": "用户要求从两个给定的向量 $\\mathbf{u}$ 和 $\\mathbf{v}$ 构建一个右手标准正交基 $\\{\\hat{\\mathbf{x}}, \\hat{\\mathbf{y}}, \\hat{\\mathbf{z}}\\}$，并将其表示为一个 $3\\times 3$ 的方向矩阵 $B = [\\hat{\\mathbf{x}}\\ \\hat{\\mathbf{y}}\\ \\hat{\\mathbf{z}}]$。\n\n### 步骤 1：问题验证\n\n**提取的已知条件：**\n- 输入向量为 $\\mathbf{u} = \\begin{pmatrix}36 \\\\ -12 \\\\ 48\\end{pmatrix}\\ \\text{mm}$ 和 $\\mathbf{v} = \\begin{pmatrix}18 \\\\ 30 \\\\ -6\\end{pmatrix}\\ \\text{mm}$。\n- 解剖学基 $\\{\\hat{\\mathbf{x}}, \\hat{\\mathbf{y}}, \\hat{\\mathbf{z}}\\}$ 必须是标准正交且为右手系。\n- 构建规则如下：\n    1. $\\hat{\\mathbf{x}}$ 是沿 $\\mathbf{u}$ 方向的单位向量。\n    2. $\\hat{\\mathbf{y}}$ 是通过对 $\\mathbf{v}$ 相对于 $\\hat{\\mathbf{x}}$ 进行标准正交化得到的单位向量。\n    3. $\\hat{\\mathbf{z}} = \\hat{\\mathbf{x}} \\times \\hat{\\mathbf{y}}$。\n- 最终输出必须是矩阵 $B = [\\hat{\\mathbf{x}}\\ \\hat{\\mathbf{y}}\\ \\hat{\\mathbf{z}}]$，其元素用根式精确表示。\n\n**使用提取的已知条件进行验证：**\n该问题具有科学依据，在生物力学参考坐标系这一背景下使用了标准的向量代数（归一化、格拉姆-施密特过程、叉积），这些方法在该领域是常规应用。该问题是适定的；指令精确，并且考虑到输入向量非零且非共线，将导出一个唯一的标准正交基。这两个向量不共线，因为不存在单一的标量 $k$ 使得 $\\mathbf{v} = k\\mathbf{u}$（例如，$18/36 = 1/2$，但 $30/(-12) \\neq 1/2$）。语言是客观的，数据是完整且一致的。因此，该问题是有效的。\n\n### 步骤 2：求解推导\n\n按顺序执行构建基向量的步骤。\n\n**1. 计算第一个基向量 $\\hat{\\mathbf{x}}$：**\n向量 $\\hat{\\mathbf{x}}$ 被定义为 $\\mathbf{u}$ 方向上的单位向量。这通过将 $\\mathbf{u}$ 除以其欧几里得范数 $\\|\\mathbf{u}\\|$ 来计算。\n首先，计算 $\\mathbf{u}$ 的范数：\n$$ \\|\\mathbf{u}\\| = \\sqrt{36^2 + (-12)^2 + 48^2} $$\n为了简化计算，我们可以提取出 $\\mathbf{u}$ 各分量的最大公约数，即 $12$。\n$$ \\mathbf{u} = 12 \\begin{pmatrix} 3 \\\\ -1 \\\\ 4 \\end{pmatrix} $$\n那么范数是：\n$$ \\|\\mathbf{u}\\| = |12| \\sqrt{3^2 + (-1)^2 + 4^2} = 12 \\sqrt{9 + 1 + 16} = 12\\sqrt{26} $$\n现在，我们求单位向量 $\\hat{\\mathbf{x}}$：\n$$ \\hat{\\mathbf{x}} = \\frac{\\mathbf{u}}{\\|\\mathbf{u}\\|} = \\frac{12 \\begin{pmatrix} 3 \\\\ -1 \\\\ 4 \\end{pmatrix}}{12\\sqrt{26}} = \\frac{1}{\\sqrt{26}} \\begin{pmatrix} 3 \\\\ -1 \\\\ 4 \\end{pmatrix} = \\begin{pmatrix} 3/\\sqrt{26} \\\\ -1/\\sqrt{26} \\\\ 4/\\sqrt{26} \\end{pmatrix} $$\n\n**2. 计算第二个基向量 $\\hat{\\mathbf{y}}$：**\n向量 $\\hat{\\mathbf{y}}$ 是通过应用格拉姆-施密特过程将 $\\mathbf{v}$ 相对于 $\\hat{\\mathbf{x}}$ 正交化，然后对结果进行归一化得到的。\n设 $\\mathbf{w}$ 是 $\\mathbf{v}$ 中与 $\\hat{\\mathbf{x}}$ 正交的分量。\n$$ \\mathbf{w} = \\mathbf{v} - (\\mathbf{v} \\cdot \\hat{\\mathbf{x}})\\hat{\\mathbf{x}} $$\n我们必须首先计算点积 $\\mathbf{v} \\cdot \\hat{\\mathbf{x}}$：\n$$ \\mathbf{v} \\cdot \\hat{\\mathbf{x}} = \\begin{pmatrix} 18 \\\\ 30 \\\\ -6 \\end{pmatrix} \\cdot \\frac{1}{\\sqrt{26}} \\begin{pmatrix} 3 \\\\ -1 \\\\ 4 \\end{pmatrix} = \\frac{1}{\\sqrt{26}} (18 \\cdot 3 + 30 \\cdot (-1) + (-6) \\cdot 4) $$\n$$ \\mathbf{v} \\cdot \\hat{\\mathbf{x}} = \\frac{1}{\\sqrt{26}} (54 - 30 - 24) = \\frac{1}{\\sqrt{26}}(0) = 0 $$\n点积为零，这表明原始向量 $\\mathbf{u}$ 和 $\\mathbf{v}$ 已经正交。因此，格拉姆-施密特正交化步骤被简化，因为 $\\mathbf{v}$ 在 $\\hat{\\mathbf{x}}$ 上的投影为零。\n$$ \\mathbf{w} = \\mathbf{v} - (0)\\hat{\\mathbf{x}} = \\mathbf{v} $$\n为了求得 $\\hat{\\mathbf{y}}$，我们只需对 $\\mathbf{w} = \\mathbf{v}$ 进行归一化。\n首先，计算 $\\mathbf{v}$ 的范数：\n$$ \\|\\mathbf{v}\\| = \\sqrt{18^2 + 30^2 + (-6)^2} $$\n我们提取出最大公约数，即 $6$。\n$$ \\mathbf{v} = 6 \\begin{pmatrix} 3 \\\\ 5 \\\\ -1 \\end{pmatrix} $$\n范数是：\n$$ \\|\\mathbf{v}\\| = |6| \\sqrt{3^2 + 5^2 + (-1)^2} = 6 \\sqrt{9 + 25 + 1} = 6\\sqrt{35} $$\n现在，我们求单位向量 $\\hat{\\mathbf{y}}$：\n$$ \\hat{\\mathbf{y}} = \\frac{\\mathbf{v}}{\\|\\mathbf{v}\\|} = \\frac{6 \\begin{pmatrix} 3 \\\\ 5 \\\\ -1 \\end{pmatrix}}{6\\sqrt{35}} = \\frac{1}{\\sqrt{35}} \\begin{pmatrix} 3 \\\\ 5 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 3/\\sqrt{35} \\\\ 5/\\sqrt{35} \\\\ -1/\\sqrt{35} \\end{pmatrix} $$\n\n**3. 计算第三个基向量 $\\hat{\\mathbf{z}}$：**\n向量 $\\hat{\\mathbf{z}}$ 由 $\\hat{\\mathbf{x}}$ 和 $\\hat{\\mathbf{y}}$ 的叉积定义，以形成一个右手系。\n$$ \\hat{\\mathbf{z}} = \\hat{\\mathbf{x}} \\times \\hat{\\mathbf{y}} = \\left( \\frac{1}{\\sqrt{26}} \\begin{pmatrix} 3 \\\\ -1 \\\\ 4 \\end{pmatrix} \\right) \\times \\left( \\frac{1}{\\sqrt{35}} \\begin{pmatrix} 3 \\\\ 5 \\\\ -1 \\end{pmatrix} \\right) $$\n$$ \\hat{\\mathbf{z}} = \\frac{1}{\\sqrt{26}\\sqrt{35}} \\begin{pmatrix} 3 \\\\ -1 \\\\ 4 \\end{pmatrix} \\times \\begin{pmatrix} 3 \\\\ 5 \\\\ -1 \\end{pmatrix} $$\n标量前因子是 $1/\\sqrt{26 \\cdot 35} = 1/\\sqrt{910}$。\n整数向量的叉积是：\n$$ \\begin{pmatrix} 3 \\\\ -1 \\\\ 4 \\end{pmatrix} \\times \\begin{pmatrix} 3 \\\\ 5 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} (-1)(-1) - (4)(5) \\\\ (4)(3) - (3)(-1) \\\\ (3)(5) - (-1)(3) \\end{pmatrix} = \\begin{pmatrix} 1 - 20 \\\\ 12 + 3 \\\\ 15 + 3 \\end{pmatrix} = \\begin{pmatrix} -19 \\\\ 15 \\\\ 18 \\end{pmatrix} $$\n因此，第三个基向量是：\n$$ \\hat{\\mathbf{z}} = \\frac{1}{\\sqrt{910}} \\begin{pmatrix} -19 \\\\ 15 \\\\ 18 \\end{pmatrix} = \\begin{pmatrix} -19/\\sqrt{910} \\\\ 15/\\sqrt{910} \\\\ 18/\\sqrt{910} \\end{pmatrix} $$\n\n**4. 组合方向矩阵 $B$：**\n方向矩阵 $B$ 由基向量 $\\hat{\\mathbf{x}}$、$\\hat{\\mathbf{y}}$ 和 $\\hat{\\mathbf{z}}$作为其列向量排列而成。\n$$ B = [\\hat{\\mathbf{x}}\\ \\hat{\\mathbf{y}}\\ \\hat{\\mathbf{z}}] = \\begin{pmatrix} 3/\\sqrt{26}  3/\\sqrt{35}  -19/\\sqrt{910} \\\\ -1/\\sqrt{26}  5/\\sqrt{35}  15/\\sqrt{910} \\\\ 4/\\sqrt{26}  -1/\\sqrt{35}  18/\\sqrt{910} \\end{pmatrix} $$\n该矩阵按要求构建，所有元素都用根式精确表示。推导至此结束。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{3}{\\sqrt{26}}  \\frac{3}{\\sqrt{35}}  -\\frac{19}{\\sqrt{910}} \\\\ -\\frac{1}{\\sqrt{26}}  \\frac{5}{\\sqrt{35}}  \\frac{15}{\\sqrt{910}} \\\\ \\frac{4}{\\sqrt{26}}  -\\frac{1}{\\sqrt{35}}  \\frac{18}{\\sqrt{910}} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在构建了坐标系之后，我们需要精确地描述其空间姿态。虽然旋转矩阵很直观，但四元数在计算上具有避免万向节死锁和高效组合旋转等优势。本练习 (  ) 旨在搭建起欧拉角、旋转矩阵和四元数之间的概念桥梁，加深您对这些用于三维运动学分析的关键数学工具的理解。",
            "id": "4163216",
            "problem": "一个右手笛卡尔解剖参考系 $\\{G\\}$ 根据标准临床惯例定义：$X$ 轴指向前方，$Y$ 轴指向上方，$Z$ 轴指向患者的右侧。一个刚性分段附加坐标系 $\\{S\\}$ 相对于 $\\{G\\}$ 的方向由一系列外旋 Tait–Bryan 旋转确定，这些旋转按 $Z$-$Y$-$X$ 顺序围绕 $\\{G\\}$ 的固定轴应用，并遵循右手定则。具体而言，$\\{S\\}$ 相对于 $\\{G\\}$ 的方向由以下角度给出：$\\psi = \\pi/3$（绕 $Z$ 轴），$\\theta = \\pi/4$（绕 $Y$ 轴），以及 $\\phi = \\pi/6$（绕 $X$ 轴），所有角度均以弧度为单位。\n\n仅使用基本定义，不借助快捷转换公式，完成以下任务：\n\n1. 根据在 $\\{G\\}$ 坐标系中由右手定则导出的基本旋转矩阵，构造旋转矩阵 $R_{G \\leftarrow S}$，其形式为有序乘积 $R_{Z}(\\psi) R_{Y}(\\theta) R_{X}(\\phi)$。\n\n2. 根据单位四元数的轴-角定义，通过使用 Hamilton 乘积按相同顺序组合绕 $Z$、$Y$ 和 $X$ 轴旋转的三个轴-角四元数，构建与相同方向对应的单位四元数 $q$。确保 $q$ 是单位化的。\n\n3. 使用从单位四元数到正常正交矩阵的标准映射，将 $q$ 转换回旋转矩阵 $R(q)$，并通过计算相对旋转 $R_{\\mathrm{rel}} = R(q) R_{G \\leftarrow S}^{\\top}$ 及相关角度来量化 $R(q)$ 和 $R_{G \\leftarrow S}$ 之间的一致性\n$$\n\\Delta = \\arccos\\!\\left(\\frac{\\mathrm{tr}(R_{\\mathrm{rel}}) - 1}{2}\\right).\n$$\n将 $\\Delta$ 以弧度表示，并将结果四舍五入至六位有效数字。\n\n4. 评论单位四元数的双重覆盖性质：证明 $q$ 和 $-q$ 编码了相同的物理旋转，并计算在单位三维球面上 $q$ 和 $-q$ 之间的测地距离，其定义为\n$$\nd_{S^{3}} = \\arccos\\!\\big(q \\cdot (-q)\\big),\n$$\n其中点号表示 $\\mathbb{R}^{4}$ 中的欧几里得内积。将 $d_{S^{3}}$ 以弧度精确表示。报告 $d_{S^{3}}$ 作为你的最终答案。",
            "solution": "将通过首先提取所有给定信息，然后评估其科学和逻辑的合理性来验证该问题。\n\n### 步骤1：提取给定信息\n- **解剖参考系 $\\{G\\}$**：一个右手笛卡尔坐标系，其 $X$ 轴指向前方，$Y$ 轴指向上方，$Z$ 轴指向患者的右侧。\n- **分段附加坐标系 $\\{S\\}$**：一个坐标系，其相对于 $\\{G\\}$ 的方向由一系列外旋 Tait–Bryan 旋转定义。\n- **旋转顺序**：旋转按 $Z$-$Y$-$X$ 顺序围绕 $\\{G\\}$ 的固定轴应用。\n- **旋转角度**：\n  - $\\psi = \\pi/3$ 弧度，绕 $Z$ 轴。\n  - $\\theta = \\pi/4$ 弧度，绕 $Y$ 轴。\n  - $\\phi = \\pi/6$ 弧度，绕 $X$ 轴。\n- **任务1（旋转矩阵）**：构造 $R_{G \\leftarrow S}$ 为有序乘积 $R_{G \\leftarrow S} = R_{Z}(\\psi) R_{Y}(\\theta) R_{X}(\\phi)$。\n- **任务2（单位四元数）**：通过按相同顺序组合各个轴-角四元数来构造单位四元数 $q$：$q = q_Z q_Y q_X$。\n- **任务3（一致性检查）**：将 $q$ 转换为旋转矩阵 $R(q)$。计算相对旋转 $R_{\\mathrm{rel}} = R(q) R_{G \\leftarrow S}^{\\top}$ 及其相关角度 $\\Delta = \\arccos\\!\\left(\\frac{\\mathrm{tr}(R_{\\mathrm{rel}}) - 1}{2}\\right)$。$\\Delta$ 的结果应四舍五入到六位有效数字。\n- **任务4（双重覆盖和测地距离）**：证明单位四元数的双重覆盖性质。计算单位三维球面上 $q$ 和 $-q$ 之间的测地距离，定义为 $d_{S^{3}} = \\arccos\\!\\big(q \\cdot (-q)\\big)$。\n\n### 步骤2：使用提取的给定信息进行验证\n根据所需标准评估该问题：\n- **科学基础**：该问题使用了刚体运动学的标准概念，特别是用旋转矩阵和单位四元数（versors）来表示三维方向。这些是数学、物理和工程中的基本工具。定义和公式都是标准的。\n- **适定性**：该问题提供了所有必要信息（旋转类型、顺序、角度），并要求计算具体的、可推导的量。任务逻辑上前后衔接，并导向唯一的解。\n- **客观性**：该问题以精确的数学和生物力学语言陈述。任务是客观的计算。\n- **一致性**：该问题明确定义了矩阵和四元数表示的组合顺序分别为 $R_Z R_Y R_X$ 和 $q_Z q_Y q_X$。尽管外旋的“Z-Y-X顺序”通常意味着矩阵乘积为 $R_X R_Y R_Z$，但该问题提供了一个明确的、尽管非标准的定义以供遵循。这是一个有效的表述，旨在测试遵循指定定义的能力。\n- **未检测到其他缺陷**。该问题并非微不足道、不切实际或不科学。\n\n### 步骤3：结论和行动\n该问题是**有效的**。将提供一个完整的、有理有据的解答。\n\n---\n\n### 第1部分：构造旋转矩阵\n围绕固定坐标系 $\\{G\\}$ 各轴、遵循右手定则的基本旋转矩阵如下：\n$$\nR_X(\\phi) = \\begin{pmatrix} 1  0  0 \\\\ 0  \\cos\\phi  -\\sin\\phi \\\\ 0  \\sin\\phi  \\cos\\phi \\end{pmatrix}\n$$\n$$\nR_Y(\\theta) = \\begin{pmatrix} \\cos\\theta  0  \\sin\\theta \\\\ 0  1  0 \\\\ -\\sin\\theta  0  \\cos\\theta \\end{pmatrix}\n$$\n$$\nR_Z(\\psi) = \\begin{pmatrix} \\cos\\psi  -\\sin\\psi  0 \\\\ \\sin\\psi  \\cos\\psi  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\n问题指定旋转矩阵 $R_{G \\leftarrow S}$ 为乘积 $R_{Z}(\\psi) R_{Y}(\\theta) R_{X}(\\phi)$。首先，我们计算乘积 $R_Y(\\theta) R_X(\\phi)$：\n$$\nR_Y(\\theta) R_X(\\phi) = \\begin{pmatrix} \\cos\\theta  0  \\sin\\theta \\\\ 0  1  0 \\\\ -\\sin\\theta  0  \\cos\\theta \\end{pmatrix} \\begin{pmatrix} 1  0  0 \\\\ 0  \\cos\\phi  -\\sin\\phi \\\\ 0  \\sin\\phi  \\cos\\phi \\end{pmatrix} = \\begin{pmatrix} \\cos\\theta  \\sin\\theta\\sin\\phi  \\sin\\theta\\cos\\phi \\\\ 0  \\cos\\phi  -\\sin\\phi \\\\ -\\sin\\theta  \\cos\\theta\\sin\\phi  \\cos\\theta\\cos\\phi \\end{pmatrix}\n$$\n接下来，我们左乘 $R_Z(\\psi)$：\n$$\nR_{G \\leftarrow S} = R_Z(\\psi) \\big(R_Y(\\theta) R_X(\\phi)\\big) = \\begin{pmatrix} \\cos\\psi  -\\sin\\psi  0 \\\\ \\sin\\psi  \\cos\\psi  0 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} \\cos\\theta  \\sin\\theta\\sin\\phi  \\sin\\theta\\cos\\phi \\\\ 0  \\cos\\phi  -\\sin\\phi \\\\ -\\sin\\theta  \\cos\\theta\\sin\\phi  \\cos\\theta\\cos\\phi \\end{pmatrix}\n$$\n执行最终的矩阵乘法，得到：\n$$\nR_{G \\leftarrow S} = \\begin{pmatrix}\n\\cos\\psi\\cos\\theta  \\cos\\psi\\sin\\theta\\sin\\phi - \\sin\\psi\\cos\\phi  \\cos\\psi\\sin\\theta\\cos\\phi + \\sin\\psi\\sin\\phi \\\\\n\\sin\\psi\\cos\\theta  \\sin\\psi\\sin\\theta\\sin\\phi + \\cos\\psi\\cos\\phi  \\sin\\psi\\sin\\theta\\cos\\phi - \\cos\\psi\\sin\\phi \\\\\n-\\sin\\theta  \\cos\\theta\\sin\\phi  \\cos\\theta\\cos\\phi\n\\end{pmatrix}\n$$\n这就是所需旋转矩阵的符号形式。\n\n### 第2部分：构造单位四元数\n表示绕单位轴 $\\mathbf{u} = u_x\\mathbf{i} + u_y\\mathbf{j} + u_z\\mathbf{k}$ 旋转角度 $\\alpha$ 的单位四元数由 $q = \\cos(\\alpha/2) + \\sin(\\alpha/2)(u_x\\mathbf{i} + u_y\\mathbf{j} + u_z\\mathbf{k})$ 给出。绕标准轴旋转的基本四元数是：\n- 绕 $X$ 轴旋转 $\\phi$：$q_X(\\phi) = \\cos(\\phi/2) + \\mathbf{i}\\sin(\\phi/2)$\n- 绕 $Y$ 轴旋转 $\\theta$：$q_Y(\\theta) = \\cos(\\theta/2) + \\mathbf{j}\\sin(\\theta/2)$\n- 绕 $Z$ 轴旋转 $\\psi$：$q_Z(\\psi) = \\cos(\\psi/2) + \\mathbf{k}\\sin(\\psi/2)$\n\n复合四元数 $q$ 通过与矩阵相同的顺序进行 Hamilton 乘积形成，$q = q_Z(\\psi) q_Y(\\theta) q_X(\\phi)$。让我们将 $\\cos(\\alpha/2)$ 缩写为 $c_{\\alpha/2}$，将 $\\sin(\\alpha/2)$ 缩写为 $s_{\\alpha/2}$。\n$$\nq = (c_{\\psi/2} + \\mathbf{k}s_{\\psi/2}) (c_{\\theta/2} + \\mathbf{j}s_{\\theta/2}) (c_{\\phi/2} + \\mathbf{i}s_{\\phi/2})\n$$\n首先，我们使用 Hamilton 乘积法则（$\\mathbf{ji} = -\\mathbf{k}$）计算乘积 $(c_{\\theta/2} + \\mathbf{j}s_{\\theta/2})(c_{\\phi/2} + \\mathbf{i}s_{\\phi/2})$：\n$$\nq_Y q_X = c_{\\theta/2}c_{\\phi/2} + \\mathbf{i}c_{\\theta/2}s_{\\phi/2} + \\mathbf{j}s_{\\theta/2}c_{\\phi/2} + \\mathbf{ji}s_{\\theta/2}s_{\\phi/2} = c_{\\theta/2}c_{\\phi/2} + \\mathbf{i}c_{\\theta/2}s_{\\phi/2} + \\mathbf{j}s_{\\theta/2}c_{\\phi/2} - \\mathbf{k}s_{\\theta/2}s_{\\phi/2}\n$$\n现在，使用 $\\mathbf{ki}=\\mathbf{j}$，$\\mathbf{kj}=-\\mathbf{i}$ 和 $\\mathbf{k}^2=-1$ 左乘 $q_Z = (c_{\\psi/2} + \\mathbf{k}s_{\\psi/2})$：\n\\begin{align*}\nq =  (c_{\\psi/2} + \\mathbf{k}s_{\\psi/2}) (c_{\\theta/2}c_{\\phi/2} + \\mathbf{i}c_{\\theta/2}s_{\\phi/2} + \\mathbf{j}s_{\\theta/2}c_{\\phi/2} - \\mathbf{k}s_{\\theta/2}s_{\\phi/2}) \\\\\n=  c_{\\psi/2}(c_{\\theta/2}c_{\\phi/2} + \\mathbf{i}c_{\\theta/2}s_{\\phi/2} + \\mathbf{j}s_{\\theta/2}c_{\\phi/2} - \\mathbf{k}s_{\\theta/2}s_{\\phi/2}) \\\\\n + \\mathbf{k}s_{\\psi/2}(c_{\\theta/2}c_{\\phi/2} + \\mathbf{i}c_{\\theta/2}s_{\\phi/2} + \\mathbf{j}s_{\\theta/2}c_{\\phi/2} - \\mathbf{k}s_{\\theta/2}s_{\\phi/2}) \\\\\n=  (c_{\\psi/2}c_{\\theta/2}c_{\\phi/2} + s_{\\psi/2}s_{\\theta/2}s_{\\phi/2}) \\\\\n + \\mathbf{i}(c_{\\psi/2}c_{\\theta/2}s_{\\phi/2} - s_{\\psi/2}s_{\\theta/2}c_{\\phi/2}) \\\\\n + \\mathbf{j}(c_{\\psi/2}s_{\\theta/2}c_{\\phi/2} + s_{\\psi/2}c_{\\theta/2}s_{\\phi/2}) \\\\\n + \\mathbf{k}(s_{\\psi/2}c_{\\theta/2}c_{\\phi/2} - c_{\\psi/2}s_{\\theta/2}s_{\\phi/2})\n\\end{align*}\n所以，四元数 $q = w + x\\mathbf{i} + y\\mathbf{j} + z\\mathbf{k}$ 的分量是：\n$w = c_{\\psi/2}c_{\\theta/2}c_{\\phi/2} + s_{\\psi/2}s_{\\theta/2}s_{\\phi/2}$\n$x = c_{\\psi/2}c_{\\theta/2}s_{\\phi/2} - s_{\\psi/2}s_{\\theta/2}c_{\\phi/2}$\n$y = c_{\\psi/2}s_{\\theta/2}c_{\\phi/2} + s_{\\psi/2}c_{\\theta/2}s_{\\phi/2}$\n$z = s_{\\psi/2}c_{\\theta/2}c_{\\phi/2} - c_{\\psi/2}s_{\\theta/2}s_{\\phi/2}$\n由于 $q$ 是单位四元数的乘积，它保证是一个单位四元数，即 $w^2+x^2+y^2+z^2=1$。\n\n### 第3部分：一致性检查\n对应于单位四元数 $q = w+x\\mathbf{i}+y\\mathbf{j}+z\\mathbf{k}$ 的旋转矩阵 $R(q)$ 是：\n$$\nR(q) = \\begin{pmatrix} w^2+x^2-y^2-z^2  2(xy-wz)  2(xz+wy) \\\\ 2(xy+wz)  w^2-x^2+y^2-z^2  2(yz-wx) \\\\ 2(xz-wy)  2(yz+wx)  w^2-x^2-y^2+z^2 \\end{pmatrix}\n$$\n为了验证 $R(q) = R_{G \\leftarrow S}$，我们可以检查一个元素。例如，让我们验证元素 $R_{11}$：\n$R_{11}(q) = w^2+x^2-y^2-z^2 = (c_{\\psi/2}^2 c_{\\theta/2}^2 + s_{\\psi/2}^2 s_{\\theta/2}^2) - (c_{\\psi/2}^2 s_{\\theta/2}^2 + s_{\\psi/2}^2 c_{\\theta/2}^2) = c_{\\psi/2}^2(c_{\\theta/2}^2-s_{\\theta/2}^2) - s_{\\psi/2}^2(c_{\\theta/2}^2-s_{\\theta/2}^2) = (c_{\\psi/2}^2-s_{\\psi/2}^2)(c_{\\theta/2}^2-s_{\\theta/2}^2) = \\cos(\\psi)\\cos(\\theta)$。\n这与 $R_{G \\leftarrow S}$ 的 $R_{11}$ 元素完全匹配。对所有其他元素的类似代数验证证实了这两个矩阵是相同的，即 $R(q) = R_{G \\leftarrow S}$。\n\n相对旋转矩阵是 $R_{\\mathrm{rel}} = R(q) R_{G \\leftarrow S}^{\\top}$。由于 $R(q)$ 和 $R_{G \\leftarrow S}$ 是相同的正常正交矩阵，所以 $R_{G \\leftarrow S}^{\\top} = R(q)^{-1}$。因此：\n$$\nR_{\\mathrm{rel}} = R(q) R(q)^{-1} = I = \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\n单位矩阵的迹是 $\\mathrm{tr}(R_{\\mathrm{rel}}) = 1+1+1 = 3$。相关角度 $\\Delta$ 是：\n$$\n\\Delta = \\arccos\\!\\left(\\frac{\\mathrm{tr}(R_{\\mathrm{rel}}) - 1}{2}\\right) = \\arccos\\!\\left(\\frac{3 - 1}{2}\\right) = \\arccos(1)\n$$\n解析上，$\\Delta = 0$ 弧度。四舍五入到六位有效数字，即为 $0.000000$。\n\n### 第4部分：双重覆盖性质和测地距离\n单位四元数 $q$ 及其负值 $-q$ 表示相同的物理旋转。这是 $SU(2)$ 对 $SO(3)$ 的双重覆盖性质。我们可以通过检查从四元数到旋转矩阵的转换公式来证明这一点。$R(q)$ 的元素是 $q$ 分量的二次方。例如，$R_{12}(q) = 2(xy - wz)$。如果我们将 $q=(w,x,y,z)$ 替换为 $-q=(-w,-x,-y,-z)$，该元素变为：\n$$\nR_{12}(-q) = 2((-x)(-y) - (-w)(-z)) = 2(xy - wz) = R_{12}(q)\n$$\n矩阵 $R(q)$ 中的所有项都具有这种形式（两个四元数分量的乘积）。因此，$R(q) = R(-q)$，这证明了 $q$ 和 $-q$ 都编码了相同的空间旋转。\n\n单位3维球面 $S^3$ 上两点（四元数）之间的测地距离是它们在 $\\mathbb{R}^4$ 中对应向量之间的夹角。问题要求计算 $q$ 和 $-q$ 之间的距离。这由以下公式给出：\n$$\nd_{S^{3}} = \\arccos\\!\\big(q \\cdot (-q)\\big)\n$$\n在 $\\mathbb{R}^4$ 中，$q = (w, x, y, z)$ 和 $-q = (-w, -x, -y, -z)$ 的点积是：\n$$\nq \\cdot (-q) = w(-w) + x(-x) + y(-y) + z(-z) = -(w^2 + x^2 + y^2 + z^2)\n$$\n因为 $q$ 是一个单位四元数，其分量的平方和为1：$w^2 + x^2 + y^2 + z^2 = 1$。\n因此：\n$$\nq \\cdot (-q) = -1\n$$\n将此代回距离公式：\n$$\nd_{S^{3}} = \\arccos(-1)\n$$\n$-1$ 的反余弦值为 $\\pi$ 弧度。这个结果是符合预期的，因为 $q$ 和 $-q$ 是3维球面上的对跖点，它们之间的测地距离是大圆周长的一半。\n精确值为 $d_{S^3} = \\pi$。",
            "answer": "$$\n\\boxed{\\pi}\n$$"
        },
        {
            "introduction": "本练习 (  ) 是一个综合性实践，要求您将前面学到的概念应用于一个真实的临床研究问题：分析人体在特定解剖平面内的运动。这个计算问题挑战您整合坐标变换、数值微分和几何投影等方法来量化运动质量。它清晰地展示了抽象的数学框架如何直接转化为具有临床意义的洞察。",
            "id": "4163249",
            "problem": "给定一个在步态试验中记录的离散髋关节中心轨迹，该轨迹位于一个附着于骨盆的笛卡尔坐标系中，同时给定一个相对于全局解剖笛卡尔坐标系的恒定骨盆姿态。全局解剖坐标系具有单位轴 $\\hat{\\mathbf{x}}_G$ (前)、$\\hat{\\mathbf{y}}_G$ (上) 和 $\\hat{\\mathbf{z}}_G$ (右)。矢状面定义为由 $\\hat{\\mathbf{x}}_G$ 和 $\\hat{\\mathbf{y}}_G$ 张成的平面，其法向量为 $\\mathbf{n}_s = \\hat{\\mathbf{z}}_G$。骨盆坐标系具有单位轴 $\\hat{\\mathbf{x}}_P$、$\\hat{\\mathbf{y}}_P$ 和 $\\hat{\\mathbf{z}}_P$。骨盆姿态由一个将骨盆坐标系坐标映射到全局坐标系的恒定旋转矩阵 $\\mathbf{R}_{GP}$ 和一个恒定的全局原点偏移向量 $\\mathbf{o}_G$ 定义。\n\n使用以下基本原理：\n- 笛卡尔坐标变换的定义：在骨盆坐标系中表示的点 $\\mathbf{p}_P$ 通过 $\\mathbf{p}_G = \\mathbf{R}_{GP}\\,\\mathbf{p}_P + \\mathbf{o}_G$ 映射到全局坐标。\n- 速度的定义为时间导数 $\\mathbf{v}(t) = d\\mathbf{p}(t)/dt$，对于离散时间样本，通过有限差分进行数值近似。\n- 欧几里得内积和向量在某方向上的分量分解：向量 $\\mathbf{a}$ 在单位方向 $\\hat{\\mathbf{n}}$ 上的投影，其大小为 $\\mathbf{a}\\cdot \\hat{\\mathbf{n}}$，向量为 $(\\mathbf{a}\\cdot \\hat{\\mathbf{n}})\\hat{\\mathbf{n}}$。\n- 点在平面上投影的定义为减去其沿平面法向量的分量。\n- 向量与平面所成角度与该向量沿平面法向量分量之间的几何关系。\n\n实现一个程序，对每个提供的测试用例执行以下计算：\n1. 使用给定的 $\\mathbf{R}_{GP}$ 和 $\\mathbf{o}_G$，将在均匀间隔 $\\Delta t$ 采样的离散骨盆坐标系髋关节中心轨迹 $\\{\\mathbf{p}_P[k]\\}_{k=0}^{N-1}$ 变换到全局坐标系 $\\{\\mathbf{p}_G[k]\\}$。\n2. 对于内部样本使用中心差分，对于第一个和最后一个样本使用前向/后向差分来近似 $d\\mathbf{p}_G/dt$，从而计算每个时间索引处的切线（速度）向量 $\\{\\mathbf{v}_G[k]\\}$。\n3. 通过减去沿 $\\mathbf{n}_s$ 的分量，计算 $\\{\\mathbf{p}_G[k]\\}$ 在矢状面上的投影 $\\{\\mathbf{p}_{\\Pi}[k]\\}$。\n4. 量化切线向量与矢状面之间的偏离角序列 $\\{\\alpha[k]\\}$，其中 $\\alpha[k]$ 定义为 $\\mathbf{v}_G[k]$ 与平面之间的夹角。角度单位必须是弧度。如果 $\\|\\mathbf{v}_G[k]\\| = 0$，则按惯例定义 $\\alpha[k] = 0$。\n5. 通过计算每个测试用例的均方根偏离角 $\\alpha_{\\mathrm{rms}} = \\sqrt{\\frac{1}{N}\\sum_{k=0}^{N-1}\\alpha[k]^2}$ 和最大偏离角 $\\alpha_{\\max} = \\max_{k}\\alpha[k]$ 来汇总偏离角。以弧度为单位报告两者。\n\n距离以米表示，时间以秒表示，角度以弧度表示。全局坐标系中的矢状面法向量为 $\\mathbf{n}_s = [0,0,1]^{\\top}$。所有欧拉角均以弧度指定，旋转矩阵 $\\mathbf{R}_{GP}$ 是根据偏航-俯仰-滚转角 $(\\psi,\\theta,\\phi)$，使用 $Z$-$Y$-$X$ 外旋（等效于 $X$-$Y$-$Z$ 内旋）约定构建的：$\\mathbf{R}_{GP} = \\mathbf{R}_z(\\psi)\\,\\mathbf{R}_y(\\theta)\\,\\mathbf{R}_x(\\phi)$。\n\n参数值测试套件：\n- 测试用例 $1$ (正常路径)：$N = 101$，$\\Delta t = 0.01\\,\\text{s}$，$\\mathbf{o}_G = [0,0,0]^{\\top}\\,\\text{m}$，$(\\psi,\\theta,\\phi) = (0.1,-0.05,0.02)\\,\\text{rad}$，频率 $f = 1.5\\,\\text{Hz}$，骨盆坐标系轨迹由下式定义\n  $$\n  x_P(t) = 0.05\\,\\sin(2\\pi f t),\\quad y_P(t) = 0.04\\,\\cos(2\\pi f t),\\quad z_P(t) = 0.02\\,\\sin(4\\pi f t),\n  $$\n  对于 $t = k\\,\\Delta t$，$k = 0,\\ldots,N-1$。\n- 测试用例 $2$ (纯矢状面运动)：$N = 101$，$\\Delta t = 0.01\\,\\text{s}$，$\\mathbf{o}_G = [0.1,-0.05,0.0]^{\\top}\\,\\text{m}$，$(\\psi,\\theta,\\phi) = (0.2,0.0,0.0)\\,\\text{rad}$，$f = 1.0\\,\\text{Hz}$，骨盆坐标系轨迹\n  $$\n  x_P(t) = 0.06\\,\\sin(2\\pi f t),\\quad y_P(t) = 0.05\\,\\cos(2\\pi f t),\\quad z_P(t) = 0.0.\n  $$\n- 测试用例 $3$ (倾斜的骨盆坐标系)：$N = 121$，$\\Delta t = 0.008\\,\\text{s}$，$\\mathbf{o}_G = [0.2,0.9,-0.1]^{\\top}\\,\\text{m}$，$(\\psi,\\theta,\\phi) = (0.6,0.3,-0.4)\\,\\text{rad}$，$f = 2.0\\,\\text{Hz}$，骨盆坐标系轨迹\n  $$\n  x_P(t) = 0.04\\,\\sin(2\\pi f t),\\quad y_P(t) = 0.03\\,\\cos(2\\pi f t),\\quad z_P(t) = 0.015\\,\\sin(2\\pi f t) + 0.005\\,t.\n  $$\n- 测试用例 $4$ (边界带有静止段)：$N = 101$，$\\Delta t = 0.01\\,\\text{s}$，$\\mathbf{o}_G = [-0.1,0.1,0.1]^{\\top}\\,\\text{m}$，$(\\psi,\\theta,\\phi) = (-0.3,0.1,0.25)\\,\\text{rad}$，$f = 1.2\\,\\text{Hz}$。定义 $T = (N-1)\\Delta t$。对于 $t \\leq 0.5\\,T$，\n  $$\n  x_P(t) = 0.05\\,\\sin(2\\pi f t),\\quad y_P(t) = 0.04\\,\\cos(2\\pi f t),\\quad z_P(t) = 0.01\\,\\sin(2\\pi f t).\n  $$\n  对于 $t > 0.5\\,T$，将骨盆坐标系位置保持在 $t = 0.5\\,T$ 时的值不变（静止段），从而在静止区间内产生零速度样本。\n\n您的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果本身是一个包含两个浮点数的列表 $[\\alpha_{\\mathrm{rms}},\\alpha_{\\max}]$，单位为弧度。例如：\n$[\\,[\\alpha_{\\mathrm{rms}}^{(1)},\\alpha_{\\max}^{(1)}],\\,[\\alpha_{\\mathrm{rms}}^{(2)},\\alpha_{\\max}^{(2)}],\\,\\ldots\\,]$。",
            "solution": "该问题要求对髋关节相对于全局解剖坐标系矢状面的运动进行定量分析。这涉及一系列明确定义的运动学和几何计算，概述如下。\n\n首先，我们建立必要的坐标系。全局解剖坐标系是一个右手笛卡尔坐标系，其坐标轴为 $\\hat{\\mathbf{x}}_G$ (前)、$\\hat{\\mathbf{y}}_G$ (上) 和 $\\hat{\\mathbf{z}}_G$ (右)。矢状面是由 $\\hat{\\mathbf{x}}_G$ 和 $\\hat{\\mathbf{y}}_G$ 张成的平面；因此其法向量为 $\\mathbf{n}_s = \\hat{\\mathbf{z}}_G = [0, 0, 1]^{\\top}$。髋关节的轨迹最初以局部骨盆坐标系中的一组离散点 $\\{\\mathbf{p}_P[k]\\}$ 的形式给出。\n\n整个过程包括将轨迹转换到全局坐标系，计算其速度，然后计算每个瞬间的速度向量与全局矢状面之间的夹角。\n\n**第 1 步：坐标变换**\n从骨盆坐标系到全局坐标系的点 $\\mathbf{p}_P$ 的变换由以下仿射变换给出：\n$$\n\\mathbf{p}_G = \\mathbf{R}_{GP}\\,\\mathbf{p}_P + \\mathbf{o}_G\n$$\n其中 $\\mathbf{o}_G$ 是恒定的原点偏移向量，$\\mathbf{R}_{GP}$ 是将骨盆坐标系方向映射到全局坐标系的恒定旋转矩阵。问题指定 $\\mathbf{R}_{GP}$ 是根据偏航-俯仰-滚转欧拉角序列 $(\\psi, \\theta, \\phi)$ 并使用 $Z$-$Y$-$X$ 外旋约定构建的。得到的旋转矩阵是各个旋转矩阵的乘积：\n$$\n\\mathbf{R}_{GP} = \\mathbf{R}_z(\\psi)\\,\\mathbf{R}_y(\\theta)\\,\\mathbf{R}_x(\\phi)\n$$\n其中，基本旋转矩阵为：\n$$\n\\mathbf{R}_x(\\phi) = \\begin{pmatrix} 1  0  0 \\\\ 0  \\cos\\phi  -\\sin\\phi \\\\ 0  \\sin\\phi  \\cos\\phi \\end{pmatrix}, \\quad\n\\mathbf{R}_y(\\theta) = \\begin{pmatrix} \\cos\\theta  0  \\sin\\theta \\\\ 0  1  0 \\\\ -\\sin\\theta  0  \\cos\\theta \\end{pmatrix}, \\quad\n\\mathbf{R}_z(\\psi) = \\begin{pmatrix} \\cos\\psi  -\\sin\\psi  0 \\\\ \\sin\\psi  \\cos\\psi  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\n将此变换应用于离散轨迹的每个点 $\\mathbf{p}_P[k]$，以获得在全局解剖坐标系中的点序列 $\\{\\mathbf{p}_G[k]\\}$。\n\n**第 2 步：速度计算**\n速度向量 $\\mathbf{v}_G(t)$ 是位置向量 $\\mathbf{p}_G(t)$ 的时间导数。对于以均匀时间间隔 $\\Delta t$ 采样的离散轨迹 $\\{\\mathbf{p}_G[k]\\}$，其导数使用有限差分进行近似。按照规定，我们使用：\n- 对于第一个样本 ($k=0$)，使用一阶前向差分：\n  $$\n  \\mathbf{v}_G[0] = \\frac{\\mathbf{p}_G[1] - \\mathbf{p}_G[0]}{\\Delta t}\n  $$\n- 对于最后一个样本 ($k=N-1$)，使用一阶后向差分：\n  $$\n  \\mathbf{v}_G[N-1] = \\frac{\\mathbf{p}_G[N-1] - \\mathbf{p}_G[N-2]}{\\Delta t}\n  $$\n- 对于所有内部样本 ($0  k  N-1$)，使用二阶中心差分：\n  $$\n  \\mathbf{v}_G[k] = \\frac{\\mathbf{p}_G[k+1] - \\mathbf{p}_G[k-1]}{2\\Delta t}\n  $$\n此过程产生离散的全局速度轨迹 $\\{\\mathbf{v}_G[k]\\}$。\n\n**第 3 步：位置在矢状面上的投影**\n此步骤需要计算每个全局位置向量 $\\mathbf{p}_G[k]$ 在矢状面上的正交投影。点在平面上的投影是通过减去其沿平面法向量的分量得到的。给定矢状面法向量 $\\mathbf{n}_s$，$\\mathbf{p}_G[k]$ 的投影 $\\mathbf{p}_{\\Pi}[k]$ 为：\n$$\n\\mathbf{p}_{\\Pi}[k] = \\mathbf{p}_G[k] - (\\mathbf{p}_G[k] \\cdot \\mathbf{n}_s)\\mathbf{n}_s\n$$\n此计算根据问题描述执行，尽管得到的投影轨迹 $\\{\\mathbf{p}_{\\Pi}[k]\\}$ 在后续步骤中并未使用。\n\n**第 4 步：偏离角计算**\n核心任务是量化运动偏离矢状面的程度。这被定义为速度向量 $\\mathbf{v}_G[k]$ 与矢状面本身之间的夹角 $\\alpha[k]$。从几何上看，向量与平面之间的夹角 $\\alpha$ 与向量与平面法向量之间的夹角 $\\beta$ 互余，即 $\\alpha = \\frac{\\pi}{2} - \\beta$。这意味着 $\\sin(\\alpha) = \\cos(\\beta)$。\n角 $\\beta$ 的余弦可以使用欧几里得内积求得：\n$$\n\\cos(\\beta) = \\frac{|\\mathbf{v}_G[k] \\cdot \\mathbf{n}_s|}{\\|\\mathbf{v}_G[k]\\| \\|\\mathbf{n}_s\\|}\n$$\n由于 $\\mathbf{n}_s$ 是单位向量（$\\|\\mathbf{n}_s\\|=1$）且 $\\mathbf{v}_G[k] \\cdot \\mathbf{n}_s$ 是速度向量的 $z$ 分量 $v_{G,z}[k]$，因此上式可简化为：\n$$\n\\sin(\\alpha[k]) = \\frac{|v_{G,z}[k]|}{\\|\\mathbf{v}_G[k]\\|}\n$$\n因此，偏离角 $\\alpha[k]$ 可以计算为：\n$$\n\\alpha[k] = \\arcsin\\left(\\frac{|v_{G,z}[k]|}{\\|\\mathbf{v}_G[k]\\|}\\right)\n$$\n此公式对任何非零速度向量均有效。根据所述约定，如果 $\\|\\mathbf{v}_G[k]\\| = 0$，则偏离角定义为 $\\alpha[k] = 0$。\n\n**第 5 步：偏离角汇总**\n最后，使用两个指标来总结偏离角序列 $\\{\\alpha[k]\\}$：\n- 均方根 (RMS) 偏离角，它捕捉了整个试验过程中偏离的典型幅度：\n  $$\n  \\alpha_{\\mathrm{rms}} = \\sqrt{\\frac{1}{N}\\sum_{k=0}^{N-1}\\alpha[k]^2}\n  $$\n- 最大偏离角，它标识了偏离矢状面的峰值：\n  $$\n  \\alpha_{\\max} = \\max_{k \\in \\{0, \\dots, N-1\\}} \\alpha[k]\n  $$\n这两个以弧度计算的值，为每个测试用例的轨迹平面性提供了简洁的总结。整个算法的流程是：生成指定的轨迹，然后依次应用这五个步骤。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the biomechanics problem for all test cases.\n    It orchestrates the calculation for each case and prints the final result.\n    \"\"\"\n\n    def build_rotation_matrix(psi, theta, phi):\n        \"\"\"\n        Constructs the rotation matrix R_GP from Z-Y-X extrinsic Euler angles.\n        R_GP = R_z(psi) @ R_y(theta) @ R_x(phi)\n        \n        Args:\n            psi (float): Yaw angle in radians.\n            theta (float): Pitch angle in radians.\n            phi (float): Roll angle in radians.\n        \n        Returns:\n            np.ndarray: The 3x3 rotation matrix.\n        \"\"\"\n        c1, s1 = np.cos(phi), np.sin(phi)\n        c2, s2 = np.cos(theta), np.sin(theta)\n        c3, s3 = np.cos(psi), np.sin(psi)\n\n        # Rotation matrix about x-axis\n        Rx = np.array([[1, 0, 0], [0, c1, -s1], [0, s1, c1]])\n        # Rotation matrix about y-axis\n        Ry = np.array([[c2, 0, s2], [0, 1, 0], [-s2, 0, c2]])\n        # Rotation matrix about z-axis\n        Rz = np.array([[c3, -s3, 0], [s3, c3, 0], [0, 0, 1]])\n\n        return Rz @ Ry @ Rx\n\n    def solve_case(params):\n        \"\"\"\n        Processes a single test case according to the problem statement.\n        \"\"\"\n        N, dt, o_G, euler_angles, f, trajectory_func = params\n        psi, theta, phi = euler_angles\n\n        # Generate time vector and pelvis-frame trajectory p_P\n        t = np.arange(N) * dt\n        p_P = trajectory_func(t, N, dt, f)\n\n        # Step 1: Transform p_P to global frame p_G\n        R_GP = build_rotation_matrix(psi, theta, phi)\n        # p_G = R_GP @ p_P.T transposed + o_G\n        p_G = (R_GP @ p_P.T).T + np.array(o_G)\n\n        # Step 2: Compute global velocity v_G using finite differences\n        v_G = np.gradient(p_G, dt, axis=0)\n\n        # Step 3: Project p_G onto sagittal plane (not used later but required)\n        n_s = np.array([0.0, 0.0, 1.0])\n        p_G_dot_n = np.dot(p_G, n_s)\n        p_Pi = p_G - np.outer(p_G_dot_n, n_s)\n        \n        # Step 4: Compute deviation angle alpha for each time sample\n        v_G_norm = np.linalg.norm(v_G, axis=1)\n        alpha = np.zeros(N)\n        \n        # Mask for non-zero velocity to avoid division by zero\n        non_zero_mask = v_G_norm  1e-12\n        \n        if np.any(non_zero_mask):\n            v_G_z_masked = v_G[non_zero_mask, 2]\n            v_G_norm_masked = v_G_norm[non_zero_mask]\n            \n            # sin(alpha) = |v_G_z| / ||v_G||\n            sin_alpha = np.abs(v_G_z_masked) / v_G_norm_masked\n            \n            # Clip to handle floating point inaccuracies where sin_alpha  1\n            sin_alpha = np.clip(sin_alpha, 0.0, 1.0)\n            alpha[non_zero_mask] = np.arcsin(sin_alpha)\n\n        # Step 5: Aggregate angles to get RMS and max deviation\n        alpha_rms = np.sqrt(np.mean(alpha**2))\n        alpha_max = np.max(alpha)\n        \n        return [alpha_rms, alpha_max]\n\n    # Trajectory generation functions for each test case\n    def traj_case1(t, N, dt, f):\n        x_P = 0.05 * np.sin(2 * np.pi * f * t)\n        y_P = 0.04 * np.cos(2 * np.pi * f * t)\n        z_P = 0.02 * np.sin(4 * np.pi * f * t)\n        return np.vstack([x_P, y_P, z_P]).T\n\n    def traj_case2(t, N, dt, f):\n        x_P = 0.06 * np.sin(2 * np.pi * f * t)\n        y_P = 0.05 * np.cos(2 * np.pi * f * t)\n        z_P = np.zeros_like(t)\n        return np.vstack([x_P, y_P, z_P]).T\n\n    def traj_case3(t, N, dt, f):\n        x_P = 0.04 * np.sin(2 * np.pi * f * t)\n        y_P = 0.03 * np.cos(2 * np.pi * f * t)\n        z_P = 0.015 * np.sin(2 * np.pi * f * t) + 0.005 * t\n        return np.vstack([x_P, y_P, z_P]).T\n\n    def traj_case4(t, N, dt, f):\n        T = (N - 1) * dt\n        split_time = 0.5 * T\n        \n        p_P = np.zeros((N, 3))\n        moving_mask = t = split_time\n        stationary_mask = ~moving_mask\n\n        # Calculate positions for the moving part of the trajectory\n        moving_t = t[moving_mask]\n        if moving_t.size  0:\n            p_P[moving_mask, 0] = 0.05 * np.sin(2 * np.pi * f * moving_t)\n            p_P[moving_mask, 1] = 0.04 * np.cos(2 * np.pi * f * moving_t)\n            p_P[moving_mask, 2] = 0.01 * np.sin(2 * np.pi * f * moving_t)\n\n        # Hold the last calculated position for the stationary part\n        if np.any(stationary_mask):\n            last_moving_idx = np.where(moving_mask)[0][-1]\n            last_pos = p_P[last_moving_idx]\n            p_P[stationary_mask] = last_pos\n\n        return p_P\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, dt, o_G, euler, f, traj_func)\n        (101, 0.01, [0, 0, 0], (0.1, -0.05, 0.02), 1.5, traj_case1),\n        (101, 0.01, [0.1, -0.05, 0.0], (0.2, 0.0, 0.0), 1.0, traj_case2),\n        (121, 0.008, [0.2, 0.9, -0.1], (0.6, 0.3, -0.4), 2.0, traj_case3),\n        (101, 0.01, [-0.1, 0.1, 0.1], (-0.3, 0.1, 0.25), 1.2, traj_case4)\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result = solve_case(case_params)\n        results.append(result)\n\n    # Format the final list of results into the required string format.\n    # str([a, b]) produces '[a, b]', and joining these with commas gives\n    # '[a, b],[c, d]'. The outer brackets are added by the f-string.\n    results_str = \",\".join(map(str, results))\n    \n    # Final print statement in the exact required format.\n    print(f\"[{results_str}]\")\n\nsolve()\n```"
        }
    ]
}