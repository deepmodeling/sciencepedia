{
    "hands_on_practices": [
        {
            "introduction": "A crucial first step in processing data from an inertial measurement unit (IMU) is to characterize and compensate for its inherent sensor errors. Gyroscope bias, a persistent offset in the angular velocity reading, is a dominant source of error that leads to unbounded drift in orientation estimates if left uncorrected. This practice will guide you through the fundamental technique of estimating this bias using data from periods when the sensor is known to be stationary, a method commonly known as a Zero-Velocity Update (ZUPT). You will develop a statistically principled estimator and analyze its performance, providing a concrete link between statistical theory and practical sensor calibration .",
            "id": "4180126",
            "problem": "A three-axis Inertial Measurement Unit (IMU) gyroscope is mounted on a human shank during quiet standing in a biomechanics laboratory. The gyroscope output is modeled at discrete sample index $k$ by the additive measurement model\n$$\n\\boldsymbol{\\omega}_{m}(k) = \\boldsymbol{\\omega}(k) + \\boldsymbol{b}_{\\omega} + \\boldsymbol{n}(k),\n$$\nwhere $\\boldsymbol{\\omega}_{m}(k) \\in \\mathbb{R}^{3}$ is the measured angular velocity, $\\boldsymbol{\\omega}(k) \\in \\mathbb{R}^{3}$ is the true angular velocity, $\\boldsymbol{b}_{\\omega} \\in \\mathbb{R}^{3}$ is a constant bias vector over the experiment, and $\\boldsymbol{n}(k) \\in \\mathbb{R}^{3}$ is zero-mean, independent, identically distributed Gaussian noise with covariance matrix $\\boldsymbol{\\Sigma}_{\\omega} = \\mathrm{diag}(\\sigma_{x}^{2}, \\sigma_{y}^{2}, \\sigma_{z}^{2})$. Short static intervals are detected in real time by thresholding the Euclidean norm of the measured angular velocity over a moving window: a window is flagged static if the average of $\\|\\boldsymbol{\\omega}_{m}\\|$ over the window is less than a threshold $\\gamma$. Within a detected static interval, the biomechanics assumption is that the segment is not rotating, i.e., $\\boldsymbol{\\omega}(k) = \\boldsymbol{0}$ for all samples $k$ in that interval.\n\nYou are asked to develop and analyze a statistically principled estimator for the gyroscope bias $\\boldsymbol{b}_{\\omega}$ using data from the detected static intervals. Formulate an estimator using samples collected across all detected static intervals and derive, from first principles, the variance of this estimator in terms of the total number of samples aggregated from all static intervals and the noise covariance parameters. Then compute the mean squared error (defined as the trace of the estimator covariance) for the following specific experimental configuration:\n\n- Sampling frequency $f_{s} = 100\\,\\mathrm{Hz}$.\n- Noise standard deviations per axis are $\\sigma_{x} = 0.005\\,\\mathrm{rad/s}$, $\\sigma_{y} = 0.006\\,\\mathrm{rad/s}$, and $\\sigma_{z} = 0.004\\,\\mathrm{rad/s}$.\n- Five detected static intervals with durations $T_{1} = 0.30\\,\\mathrm{s}$, $T_{2} = 0.25\\,\\mathrm{s}$, $T_{3} = 0.20\\,\\mathrm{s}$, $T_{4} = 0.15\\,\\mathrm{s}$, and $T_{5} = 0.40\\,\\mathrm{s}$.\n\nAssume independence of noise across samples and axes and that the detection step identifies intervals correctly without further truncation of samples inside each interval. Express the final mean squared error in $(\\mathrm{rad/s})^{2}$ and round your answer to four significant figures. The final answer must be a single real number.",
            "solution": "The problem asks for the formulation and analysis of an estimator for the gyroscope bias vector $\\boldsymbol{b}_{\\omega}$ using data from detected static intervals. The final goal is to compute the mean squared error (MSE) of this estimator for a given experimental configuration.\n\nFirst, we establish the measurement model during the static intervals. The problem states that for a static interval, the true angular velocity is zero, i.e., $\\boldsymbol{\\omega}(k) = \\boldsymbol{0}$ for any sample index $k$ within such an interval. The general measurement model is given as:\n$$\n\\boldsymbol{\\omega}_{m}(k) = \\boldsymbol{\\omega}(k) + \\boldsymbol{b}_{\\omega} + \\boldsymbol{n}(k)\n$$\nSubstituting the static condition $\\boldsymbol{\\omega}(k) = \\boldsymbol{0}$, the model simplifies to:\n$$\n\\boldsymbol{\\omega}_{m}(k) = \\boldsymbol{b}_{\\omega} + \\boldsymbol{n}(k)\n$$\nHere, we are tasked with estimating the constant vector $\\boldsymbol{b}_{\\omega}$ from a series of noisy measurements $\\boldsymbol{\\omega}_{m}(k)$. The noise $\\boldsymbol{n}(k)$ is given to be zero-mean, independent, and identically distributed (i.i.d.) Gaussian noise with covariance $\\boldsymbol{\\Sigma}_{\\omega}$.\n\nA statistically principled estimator for a constant vector corrupted by additive zero-mean noise is the sample mean of the measurements. This estimator is the Maximum Likelihood Estimator (MLE) for a constant mean in Gaussian noise, and it is also the Best Linear Unbiased Estimator (BLUE). We aggregate all samples from all detected static intervals. Let the total number of samples be $N$. We can denote the sequence of these collected measurements as $\\{\\boldsymbol{\\omega}_{m}(j)\\}_{j=1}^{N}$. The estimator for $\\boldsymbol{b}_{\\omega}$, denoted as $\\hat{\\boldsymbol{b}}_{\\omega}$, is:\n$$\n\\hat{\\boldsymbol{b}}_{\\omega} = \\frac{1}{N} \\sum_{j=1}^{N} \\boldsymbol{\\omega}_{m}(j)\n$$\nNext, we derive the variance, which for a vector estimator is its covariance matrix, $\\mathrm{Cov}(\\hat{\\boldsymbol{b}}_{\\omega})$. First, let's find the expected value of the estimator to check for bias.\n$$\nE[\\hat{\\boldsymbol{b}}_{\\omega}] = E\\left[\\frac{1}{N} \\sum_{j=1}^{N} \\boldsymbol{\\omega}_{m}(j)\\right] = \\frac{1}{N} \\sum_{j=1}^{N} E[\\boldsymbol{\\omega}_{m}(j)]\n$$\nFor each measurement $j$, $E[\\boldsymbol{\\omega}_{m}(j)] = E[\\boldsymbol{b}_{\\omega} + \\boldsymbol{n}(j)] = E[\\boldsymbol{b}_{\\omega}] + E[\\boldsymbol{n}(j)]$. Since $\\boldsymbol{b}_{\\omega}$ is a constant vector, $E[\\boldsymbol{b}_{\\omega}] = \\boldsymbol{b}_{\\omega}$. The noise is zero-mean, so $E[\\boldsymbol{n}(j)] = \\boldsymbol{0}$. Thus, $E[\\boldsymbol{\\omega}_{m}(j)] = \\boldsymbol{b}_{\\omega}$.\nSubstituting this back into the expression for $E[\\hat{\\boldsymbol{b}}_{\\omega}]$:\n$$\nE[\\hat{\\boldsymbol{b}}_{\\omega}] = \\frac{1}{N} \\sum_{j=1}^{N} \\boldsymbol{b}_{\\omega} = \\frac{1}{N} (N \\boldsymbol{b}_{\\omega}) = \\boldsymbol{b}_{\\omega}\n$$\nThe estimator is unbiased.\n\nNow we compute the covariance matrix of the estimator.\n$$\n\\mathrm{Cov}(\\hat{\\boldsymbol{b}}_{\\omega}) = \\mathrm{Var}(\\hat{\\boldsymbol{b}}_{\\omega}) = \\mathrm{Var}\\left(\\frac{1}{N} \\sum_{j=1}^{N} \\boldsymbol{\\omega}_{m}(j)\\right)\n$$\nBecause the noise samples $\\boldsymbol{n}(j)$ are independent across the sample index $j$, the measurements $\\boldsymbol{\\omega}_{m}(j)$ are also independent. The variance of a sum of independent random vectors is the sum of their variances.\n$$\n\\mathrm{Cov}(\\hat{\\boldsymbol{b}}_{\\omega}) = \\frac{1}{N^2} \\sum_{j=1}^{N} \\mathrm{Var}(\\boldsymbol{\\omega}_{m}(j))\n$$\nThe variance of a single measurement is $\\mathrm{Var}(\\boldsymbol{\\omega}_{m}(j)) = \\mathrm{Var}(\\boldsymbol{b}_{\\omega} + \\boldsymbol{n}(j))$. Since $\\boldsymbol{b}_{\\omega}$ is constant, it does not affect the variance. Therefore, $\\mathrm{Var}(\\boldsymbol{\\omega}_{m}(j)) = \\mathrm{Var}(\\boldsymbol{n}(j)) = \\boldsymbol{\\Sigma}_{\\omega}$.\nSubstituting this into the covariance expression for the estimator:\n$$\n\\mathrm{Cov}(\\hat{\\boldsymbol{b}}_{\\omega}) = \\frac{1}{N^2} \\sum_{j=1}^{N} \\boldsymbol{\\Sigma}_{\\omega} = \\frac{1}{N^2} (N \\boldsymbol{\\Sigma}_{\\omega}) = \\frac{1}{N} \\boldsymbol{\\Sigma}_{\\omega}\n$$\nThe problem defines the Mean Squared Error (MSE) as the trace of the estimator's covariance matrix.\n$$\n\\mathrm{MSE} = \\mathrm{Tr}(\\mathrm{Cov}(\\hat{\\boldsymbol{b}}_{\\omega})) = \\mathrm{Tr}\\left(\\frac{1}{N} \\boldsymbol{\\Sigma}_{\\omega}\\right) = \\frac{1}{N} \\mathrm{Tr}(\\boldsymbol{\\Sigma}_{\\omega})\n$$\nThe noise covariance matrix is given as $\\boldsymbol{\\Sigma}_{\\omega} = \\mathrm{diag}(\\sigma_{x}^{2}, \\sigma_{y}^{2}, \\sigma_{z}^{2})$.\nThe trace of this matrix is the sum of its diagonal elements:\n$$\n\\mathrm{Tr}(\\boldsymbol{\\Sigma}_{\\omega}) = \\sigma_{x}^{2} + \\sigma_{y}^{2} + \\sigma_{z}^{2}\n$$\nSo, the final expression for the MSE is:\n$$\n\\mathrm{MSE} = \\frac{\\sigma_{x}^{2} + \\sigma_{y}^{2} + \\sigma_{z}^{2}}{N}\n$$\nNow we compute the numerical value for the given configuration. First, we find the total number of samples, $N$. The number of samples $N_i$ in an interval of duration $T_i$ with sampling frequency $f_s$ is $N_i = T_i \\times f_s$.\nThe durations of the five static intervals are $T_1 = 0.30\\,\\mathrm{s}$, $T_2 = 0.25\\,\\mathrm{s}$, $T_3 = 0.20\\,\\mathrm{s}$, $T_4 = 0.15\\,\\mathrm{s}$, and $T_5 = 0.40\\,\\mathrm{s}$. The sampling frequency is $f_s = 100\\,\\mathrm{Hz}$.\nThe number of samples from each interval is:\n$N_1 = 0.30 \\times 100 = 30$\n$N_2 = 0.25 \\times 100 = 25$\n$N_3 = 0.20 \\times 100 = 20$\n$N_4 = 0.15 \\times 100 = 15$\n$N_5 = 0.40 \\times 100 = 40$\nThe total number of samples is the sum:\n$N = N_1 + N_2 + N_3 + N_4 + N_5 = 30 + 25 + 20 + 15 + 40 = 130$.\n\nNext, we calculate the trace of the noise covariance matrix, $\\mathrm{Tr}(\\boldsymbol{\\Sigma}_{\\omega})$. The noise standard deviations are given as $\\sigma_{x} = 0.005\\,\\mathrm{rad/s}$, $\\sigma_{y} = 0.006\\,\\mathrm{rad/s}$, and $\\sigma_{z} = 0.004\\,\\mathrm{rad/s}$.\nThe variances are:\n$\\sigma_{x}^{2} = (0.005)^{2} = 0.000025 = 2.5 \\times 10^{-5}\\,(\\mathrm{rad/s})^{2}$\n$\\sigma_{y}^{2} = (0.006)^{2} = 0.000036 = 3.6 \\times 10^{-5}\\,(\\mathrm{rad/s})^{2}$\n$\\sigma_{z}^{2} = (0.004)^{2} = 0.000016 = 1.6 \\times 10^{-5}\\,(\\mathrm{rad/s})^{2}$\nThe trace is the sum of these variances:\n$$\n\\mathrm{Tr}(\\boldsymbol{\\Sigma}_{\\omega}) = (2.5 + 3.6 + 1.6) \\times 10^{-5} = 7.7 \\times 10^{-5}\\,(\\mathrm{rad/s})^{2}\n$$\nFinally, we compute the MSE:\n$$\n\\mathrm{MSE} = \\frac{\\mathrm{Tr}(\\boldsymbol{\\Sigma}_{\\omega})}{N} = \\frac{7.7 \\times 10^{-5}}{130} \\approx 5.9230769... \\times 10^{-7}\\,(\\mathrm{rad/s})^{2}\n$$\nRounding the result to four significant figures as requested gives $5.923 \\times 10^{-7}$.",
            "answer": "$$\n\\boxed{5.923 \\times 10^{-7}}\n$$"
        },
        {
            "introduction": "Once an orientation is estimated, a common and critical task is to quantify the difference between two orientations, whether to calculate the error of an estimator or to describe the motion between two points in time. Since rotations exist on a curved manifold, a simple element-wise subtraction of representations like Euler angles is mathematically incorrect and can be misleading. This exercise explores the proper way to compute the \"difference\" by finding the shortest rotational path, or geodesic, between two orientations represented by unit quaternions. Mastering this calculation is essential for correctly analyzing the performance of orientation estimation algorithms and for tasks like rotational interpolation .",
            "id": "4180113",
            "problem": "Consider an Inertial Measurement Unit (IMU) orientation estimation pipeline in which orientations are represented by unit quaternions under the Hamilton convention with scalar-first form. Let $q = [w, x, y, z]$ denote a unit quaternion, with unit norm, acting on vectors by the standard quaternion sandwiching operation. The relative orientation taking orientation $q_1$ to orientation $q_2$ is given by the quaternion product $q_{\\Delta} = q_2 \\otimes q_1^{-1}$, where $q_1^{-1}$ is the quaternion inverse. The geodesic distance on the three-dimensional Special Orthogonal Group $\\mathrm{SO}(3)$ between two orientations is defined as the minimal rotation angle that maps one orientation into the other, which is the rotation angle of the shortest rotation represented by $q_{\\Delta}$.\n\nStarting from first principles (properties of unit quaternions, the definition of quaternion inverse, and quaternion multiplication rules), derive the angle-axis representation of $q_{\\Delta}$, explicitly identifying how to obtain the geodesic rotation angle and axis from its scalar and vector parts, including the correct treatment of the unit quaternion double cover to ensure the shortest rotation.\n\nThen, evaluate the geodesic rotation angle for the following specific orientations\n- $q_1 = \\left[\\frac{\\sqrt{3}}{2}, \\frac{1}{2\\sqrt{3}}, \\frac{1}{2\\sqrt{3}}, \\frac{1}{2\\sqrt{3}}\\right]$,\n- $q_2 = \\left[\\frac{1}{2}, 0, 0, \\frac{\\sqrt{3}}{2}\\right]$.\n\nProvide the final answer as an exact closed-form expression for the minimal geodesic rotation angle in radians. Do not provide a numerical approximation. The final answer must be a single real-valued expression.",
            "solution": "A unit quaternion $q$ is expressed in scalar-first form as $q = [w, x, y, z]$, where $w$ is the scalar part and $\\mathbf{v} = [x, y, z]$ is the vector part. For a unit quaternion, its norm is $\\|q\\| = \\sqrt{w^2 + x^2 + y^2 + z^2} = 1$. A rotation in three-dimensional space by an angle $\\theta$ around a unit axis vector $\\mathbf{u}$ can be represented by the unit quaternion\n$$q = \\left[\\cos\\left(\\frac{\\theta}{2}\\right), \\sin\\left(\\frac{\\theta}{2}\\right)\\mathbf{u}\\right]$$\nBy comparing the general form $q = [w, \\mathbf{v}]$ with the angle-axis form, we can establish the relationships:\n$$w = \\cos\\left(\\frac{\\theta}{2}\\right)$$\n$$\\mathbf{v} = \\sin\\left(\\frac{\\theta}{2}\\right)\\mathbf{u}$$\nFrom these, the rotation angle $\\theta$ and axis $\\mathbf{u}$ can be extracted from a given unit quaternion $q=[w, \\mathbf{v}]$:\n$$\\theta = 2 \\arccos(w)$$\nThe range of the $\\arccos$ function is $[0, \\pi]$, so $\\theta$ as calculated will be in the range $[0, 2\\pi]$. The vector part gives the axis:\n$$\\|\\mathbf{v}\\| = \\left\\|\\sin\\left(\\frac{\\theta}{2}\\right)\\mathbf{u}\\right\\| = \\left|\\sin\\left(\\frac{\\theta}{2}\\right)\\right| \\|\\mathbf{u}\\| = \\left|\\sin\\left(\\frac{\\theta}{2}\\right)\\right|$$\nSince $\\theta/2 \\in [0, \\pi]$, $\\sin(\\theta/2) \\ge 0$. Thus, $\\|\\mathbf{v}\\| = \\sin(\\theta/2)$. The axis is then:\n$$\\mathbf{u} = \\frac{\\mathbf{v}}{\\sin(\\theta/2)} = \\frac{\\mathbf{v}}{\\|\\mathbf{v}\\|}$$\nThis is defined as long as $\\|\\mathbf{v}\\| \\neq 0$, which corresponds to $\\theta \\neq 0$. If $\\theta=0$, the quaternion is $[1, 0, 0, 0]$, representing an identity rotation with an undefined axis.\n\nThe relative orientation that transforms an orientation represented by $q_1$ to an orientation represented by $q_2$ is given by the quaternion product $q_{\\Delta} = q_2 \\otimes q_1^{-1}$.\nFor any quaternion $q_1 = [w_1, \\mathbf{v}_1]$, its inverse is $q_1^{-1} = \\frac{q_1^*}{\\|q_1\\|^2}$, where $q_1^* = [w_1, -\\mathbf{v}_1]$ is its conjugate. Since $q_1$ is a unit quaternion, $\\|q_1\\|^2=1$, and its inverse simplifies to its conjugate: $q_1^{-1} = q_1^*$.\nLet $q_1 = [w_1, \\mathbf{v}_1]$ and $q_2 = [w_2, \\mathbf{v}_2]$. The relative orientation is $q_{\\Delta} = q_2 \\otimes q_1^*$. Using the Hamilton product rule $([w_a, \\mathbf{v}_a] \\otimes [w_b, \\mathbf{v}_b] = [w_a w_b - \\mathbf{v}_a \\cdot \\mathbf{v}_b, w_a \\mathbf{v}_b + w_b \\mathbf{v}_a + \\mathbf{v}_a \\times \\mathbf{v}_b])$, we have:\n$$q_{\\Delta} = [w_2, \\mathbf{v}_2] \\otimes [w_1, -\\mathbf{v}_1] = [w_2 w_1 - \\mathbf{v}_2 \\cdot (-\\mathbf{v}_1), w_2(-\\mathbf{v}_1) + w_1\\mathbf{v}_2 + \\mathbf{v}_2 \\times (-\\mathbf{v}_1)]$$\nLet $q_{\\Delta} = [w_\\Delta, \\mathbf{v}_\\Delta]$. The scalar part is:\n$$w_\\Delta = w_1 w_2 + \\mathbf{v}_1 \\cdot \\mathbf{v}_2$$\nThis is the dot product of $q_1$ and $q_2$ viewed as vectors in $\\mathbb{R}^4$. The vector part is:\n$$\\mathbf{v}_\\Delta = w_1 \\mathbf{v}_2 - w_2 \\mathbf{v}_1 - \\mathbf{v}_1 \\times \\mathbf{v}_2$$\nThe rotation angle corresponding to $q_\\Delta$ is $\\theta_\\Delta = 2\\arccos(w_\\Delta)$.\n\nA crucial property of using quaternions to represent rotations is the double cover of the special orthogonal group $\\mathrm{SO}(3)$. This means that both $q$ and $-q$ represent the same physical rotation. If $q = [\\cos(\\theta/2), \\sin(\\theta/2)\\mathbf{u}]$ represents a rotation by angle $\\theta$, then $-q = [-\\cos(\\theta/2), -\\sin(\\theta/2)\\mathbf{u}]$ represents a rotation by an angle $\\theta' = 2\\arccos(-\\cos(\\theta/2)) = 2\\arccos(\\cos(\\pi - \\theta/2)) = 2(\\pi - \\theta/2) = 2\\pi - \\theta$. The geodesic distance on $\\mathrm{SO}(3)$ corresponds to the minimal rotation angle, which is $\\min(\\theta, 2\\pi - \\theta)$. This minimal angle must lie in the interval $[0, \\pi]$.\nAn angle is in $[0, \\pi]$ if its half-angle is in $[0, \\pi/2]$, which means the cosine of its half-angle must be non-negative. To find the minimal rotation angle $\\theta_{geo}$, we must choose the quaternion representation (either $q_\\Delta$ or $-q_\\Delta$) that has a non-negative scalar part. The scalar part of this representation will be $|w_\\Delta|$. Thus, the geodesic rotation angle is:\n$$\\theta_{geo} = 2 \\arccos(|w_\\Delta|) = 2 \\arccos(|w_1 w_2 + \\mathbf{v}_1 \\cdot \\mathbf{v}_2|)$$\n\nWe now evaluate this for the given quaternions:\n$$q_1 = \\left[\\frac{\\sqrt{3}}{2}, \\frac{1}{2\\sqrt{3}}, \\frac{1}{2\\sqrt{3}}, \\frac{1}{2\\sqrt{3}}\\right]$$\n$$q_2 = \\left[\\frac{1}{2}, 0, 0, \\frac{\\sqrt{3}}{2}\\right]$$\nFirst, we identify the scalar and vector parts:\n$$w_1 = \\frac{\\sqrt{3}}{2}, \\quad \\mathbf{v}_1 = \\left[\\frac{1}{2\\sqrt{3}}, \\frac{1}{2\\sqrt{3}}, \\frac{1}{2\\sqrt{3}}\\right]$$\n$$w_2 = \\frac{1}{2}, \\quad \\mathbf{v}_2 = \\left[0, 0, \\frac{\\sqrt{3}}{2}\\right]$$\nNext, we compute the scalar part of the relative quaternion, $w_\\Delta$:\n$$w_\\Delta = w_1 w_2 + \\mathbf{v}_1 \\cdot \\mathbf{v}_2$$\nThe product of the scalar parts is:\n$$w_1 w_2 = \\left(\\frac{\\sqrt{3}}{2}\\right)\\left(\\frac{1}{2}\\right) = \\frac{\\sqrt{3}}{4}$$\nThe dot product of the vector parts is:\n$$\\mathbf{v}_1 \\cdot \\mathbf{v}_2 = \\left(\\frac{1}{2\\sqrt{3}}\\right)(0) + \\left(\\frac{1}{2\\sqrt{3}}\\right)(0) + \\left(\\frac{1}{2\\sqrt{3}}\\right)\\left(\\frac{\\sqrt{3}}{2}\\right) = 0 + 0 + \\frac{\\sqrt{3}}{4\\sqrt{3}} = \\frac{1}{4}$$\nSumming these results gives $w_\\Delta$:\n$$w_\\Delta = \\frac{\\sqrt{3}}{4} + \\frac{1}{4} = \\frac{1+\\sqrt{3}}{4}$$\nSince $1+\\sqrt{3} > 0$, we have $|w_\\Delta| = w_\\Delta = \\frac{1+\\sqrt{3}}{4}$.\nThe geodesic rotation angle $\\theta_{geo}$ is:\n$$\\theta_{geo} = 2 \\arccos\\left(\\frac{1+\\sqrt{3}}{4}\\right)$$\nThis is an exact, closed-form expression as required.",
            "answer": "$$\\boxed{2 \\arccos\\left(\\frac{1+\\sqrt{3}}{4}\\right)}$$"
        },
        {
            "introduction": "While accelerometers and gyroscopes provide information about dynamic motion, magnetometers are vital for anchoring the heading estimate and preventing long-term drift in yaw. However, their utility is often compromised in real-world environments, especially indoors, due to local magnetic disturbances. This advanced practice tackles this challenge head-on by demonstrating how to build a robust sensor fusion system. You will derive a statistical \"gating\" mechanism that allows an Extended Kalman Filter (EKF) to intelligently decide whether a magnetometer measurement is reliable or corrupted, a key technique for achieving accurate heading estimation in non-ideal conditions .",
            "id": "4180109",
            "problem": "A wearable Inertial Measurement Unit (IMU) comprising a tri-axial accelerometer, gyroscope, and magnetometer is mounted on the thorax to estimate heading (yaw) during indoor walking. The IMU runs an attitude Extended Kalman Filter (EKF) that fuses gyroscope and accelerometer with magnetometer measurements to bound yaw drift. The EKF uses a magnetometer update only when a statistical gate indicates the local magnetic environment is undisturbed.\n\nAssume the following physically realistic model. Let the navigation frame be the North-East-Down frame, and let the true unit Earth magnetic field direction in the navigation frame be the known vector $\\mathbf{b}^{n} \\in \\mathbb{R}^{3}$ with $|\\mathbf{b}^{n}| = 1$. The EKF has a current attitude estimate $\\widehat{\\mathbf{R}}_{n}^{b} \\in \\mathrm{SO}(3)$ that rotates vectors from the navigation frame to the body frame, and a small attitude estimation error parameterized by a body-frame small-angle vector $\\delta \\boldsymbol{\\theta} \\in \\mathbb{R}^{3}$, with $\\delta \\boldsymbol{\\theta} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{P}_{\\theta})$. The predicted body-frame unit magnetic direction is $\\mathbf{h} = \\widehat{\\mathbf{R}}_{n}^{b} \\mathbf{b}^{n}$, where $|\\mathbf{h}| = 1$.\n\nThe magnetometer provides a measurement of the body-frame magnetic field that is normalized to unit length, yielding $\\mathbf{m}^{b} \\in \\mathbb{R}^{3}$ with $|\\mathbf{m}^{b}| \\approx 1$. In the absence of local disturbances, model the measurement (after normalization and bias compensation) as\n$$\n\\mathbf{m}^{b} \\approx \\mathbf{h} - [\\mathbf{h}]_{\\times} \\, \\delta \\boldsymbol{\\theta} + \\mathbf{v},\n$$\nwhere $[\\mathbf{h}]_{\\times} \\in \\mathbb{R}^{3 \\times 3}$ is the skew-symmetric matrix such that $[\\mathbf{h}]_{\\times} \\mathbf{x} = \\mathbf{h} \\times \\mathbf{x}$ for any $\\mathbf{x} \\in \\mathbb{R}^{3}$, and $\\mathbf{v} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{R}_{m})$ is zero-mean measurement noise. Local magnetic disturbances add an unknown perturbation $\\mathbf{d}$ to the right-hand side, which may be non-Gaussian and time-varying. To avoid improper updates when disturbed, the EKF gates magnetometer updates using a residual constructed to be insensitive to magnitude changes and only sensitive to directional inconsistencies.\n\nDefine the orthogonal projector onto the tangent plane of the unit sphere at $\\mathbf{h}$ as $\\mathbf{P}(\\mathbf{h}) = \\mathbf{I}_{3} - \\mathbf{h} \\mathbf{h}^{\\top}$. Consider the residual\n$$\n\\mathbf{r} = \\mathbf{P}(\\mathbf{h}) \\left( \\mathbf{m}^{b} - \\mathbf{h} \\right),\n$$\nand assume that under undisturbed conditions ($\\mathbf{d} = \\mathbf{0}$), this residual can be linearized as\n$$\n\\mathbf{r} \\approx \\mathbf{H} \\, \\delta \\boldsymbol{\\theta} + \\mathbf{w}, \\quad \\text{with} \\quad \\mathbf{H} = - \\mathbf{P}(\\mathbf{h}) [\\mathbf{h}]_{\\times}, \\quad \\mathbf{w} = \\mathbf{P}(\\mathbf{h}) \\mathbf{v}.\n$$\nLet the undisturbed residual covariance be $\\mathbf{S} = \\mathbf{H} \\mathbf{P}_{\\theta} \\mathbf{H}^{\\top} + \\mathbf{P}(\\mathbf{h}) \\mathbf{R}_{m} \\mathbf{P}(\\mathbf{h})$. Because $\\mathbf{r}$ lies in the two-dimensional tangent plane, the effective residual has two degrees of freedom.\n\nStarting from fundamental kinematic linearization and Gaussian residual modeling, derive a statistically principled gating criterion based on the Mahalanobis norm of $\\mathbf{r}$ that maintains a false alarm probability (erroneously declaring a disturbance) of $\\alpha = 0.01$ under undisturbed conditions. Your derivation must justify the residualâ€™s distribution and the number of degrees of freedom used in the gate. Then, compute the numerical value of the corresponding gating threshold for the Mahalanobis statistic. Round your final answer to four significant figures. Express the final answer as a dimensionless number.",
            "solution": "The problem requires the derivation of a statistically principled gating criterion for magnetometer measurements in an Extended Kalman Filter (EKF). The goal is to compute the numerical threshold for a Mahalanobis test statistic that ensures a false alarm probability of $\\alpha = 0.01$.\n\nThe gating procedure is a hypothesis test. The null hypothesis, $H_0$, is that the local magnetic environment is undisturbed ($\\mathbf{d}=\\mathbf{0}$). The alternative hypothesis, $H_1$, is that a disturbance is present ($\\mathbf{d} \\neq \\mathbf{0}$). A false alarm occurs when we reject $H_0$ even though it is true. The probability of this event is denoted by $\\alpha$.\n\nUnder the null hypothesis, the measurement residual $\\mathbf{r}$ is modeled as a linear transformation of zero-mean Gaussian random vectors. The attitude estimation error is given as $\\delta \\boldsymbol{\\theta} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{P}_{\\theta})$ and the magnetometer measurement noise is $\\mathbf{v} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{R}_{m})$. The linearized residual is given as $\\mathbf{r} \\approx \\mathbf{H} \\, \\delta \\boldsymbol{\\theta} + \\mathbf{w}$, where $\\mathbf{H} = - \\mathbf{P}(\\mathbf{h}) [\\mathbf{h}]_{\\times}$ and $\\mathbf{w} = \\mathbf{P}(\\mathbf{h}) \\mathbf{v}$. Since linear transformations of Gaussian random vectors result in a Gaussian random vector, the residual $\\mathbf{r}$ under $H_0$ is a zero-mean Gaussian random vector, $\\mathbf{r} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{S})$. The covariance matrix $\\mathbf{S}$ is given by $\\mathbf{S} = \\mathbf{H} \\mathbf{P}_{\\theta} \\mathbf{H}^{\\top} + \\mathbf{P}(\\mathbf{h}) \\mathbf{R}_{m} \\mathbf{P}(\\mathbf{h})$.\n\nThe gating criterion is based on the Mahalanobis squared distance of the residual, defined as the test statistic $\\gamma$:\n$$\n\\gamma = \\mathbf{r}^{\\top} \\mathbf{S}^{\\dagger} \\mathbf{r}\n$$\nwhere $\\mathbf{S}^{\\dagger}$ is the Moore-Penrose pseudoinverse of the covariance matrix $\\mathbf{S}$.\n\nA fundamental theorem in statistics states that if a random vector $\\mathbf{x} \\in \\mathbb{R}^{n}$ follows a multivariate normal distribution $\\mathcal{N}(\\mathbf{0}, \\mathbf{\\Sigma})$ where the covariance matrix $\\mathbf{\\Sigma}$ has rank $k \\leq n$, then the quadratic form $\\mathbf{x}^{\\top} \\mathbf{\\Sigma}^{\\dagger} \\mathbf{x}$ follows a chi-squared distribution with $k$ degrees of freedom, denoted $\\chi^{2}(k)$.\n\nTo apply this theorem, we must determine the rank of the covariance matrix $\\mathbf{S}$. The residual vector is defined as $\\mathbf{r} = \\mathbf{P}(\\mathbf{h}) (\\mathbf{m}^{b} - \\mathbf{h})$. The matrix $\\mathbf{P}(\\mathbf{h}) = \\mathbf{I}_{3} - \\mathbf{h} \\mathbf{h}^{\\top}$ is an orthogonal projector. Its purpose is to project a vector onto the plane orthogonal to the unit vector $\\mathbf{h}$. The dimension of this plane is $2$. Consequently, any vector $\\mathbf{r}$ in the image of $\\mathbf{P}(\\mathbf{h})$ must lie within this two-dimensional subspace. The covariance matrix $\\mathbf{S}$ of such a random vector will be rank-deficient, with a rank of at most $2$. Assuming the uncertainty from $\\mathbf{P}_{\\theta}$ and $\\mathbf{R}_{m}$ is not degenerate with respect to this plane, the rank of $\\mathbf{S}$ will be exactly $2$. The problem statement confirms this by stating that \"the effective residual has two degrees of freedom.\" Therefore, the test statistic $\\gamma$ follows a chi-squared distribution with $k=2$ degrees of freedom:\n$$\n\\gamma \\sim \\chi^{2}(2)\n$$\nThe gating rule is to reject the measurement update if the observed statistic $\\gamma$ exceeds a certain threshold, $\\tau$. We seek to find the value of $\\tau$ such that the probability of a false alarm is $\\alpha = 0.01$. This is expressed as:\n$$\nP(\\gamma > \\tau | H_0) = \\alpha\n$$\nThis is equivalent to finding the value $\\tau$ for which the cumulative distribution function (CDF) of the $\\chi^{2}(2)$ distribution equals $1-\\alpha$. Let $F_{\\chi^{2}(k)}(x)$ be the CDF of the chi-squared distribution with $k$ degrees of freedom. We must solve for $\\tau$ in:\n$$\nF_{\\chi^{2}(2)}(\\tau) = 1 - \\alpha\n$$\nThe probability density function (PDF) of a $\\chi^{2}(k)$ distribution is $f(x;k) = \\frac{1}{2^{k/2} \\Gamma(k/2)} x^{k/2-1} \\exp(-x/2)$. For $k=2$, the Gamma function term is $\\Gamma(2/2)=\\Gamma(1)=1$. The PDF simplifies to:\n$$\nf(x;2) = \\frac{1}{2^{1} \\cdot 1} x^{1-1} \\exp(-x/2) = \\frac{1}{2}\\exp(-x/2)\n$$\nThis is the PDF of an exponential distribution with a rate parameter $\\lambda = 1/2$. The CDF for $x \\geq 0$ is found by integration:\n$$\nF_{\\chi^{2}(2)}(x) = \\int_{0}^{x} \\frac{1}{2}\\exp(-t/2) \\, dt = \\left[ -\\exp(-t/2) \\right]_{0}^{x} = 1 - \\exp(-x/2)\n$$\nWe can now solve for the threshold $\\tau$:\n$$\n1 - \\exp(-\\tau/2) = 1 - \\alpha\n$$\n$$\n\\exp(-\\tau/2) = \\alpha\n$$\nTaking the natural logarithm of both sides:\n$$\n-\\frac{\\tau}{2} = \\ln(\\alpha)\n$$\n$$\n\\tau = -2 \\ln(\\alpha)\n$$\nSubstituting the given false alarm probability $\\alpha = 0.01$:\n$$\n\\tau = -2 \\ln(0.01)\n$$\nThis can be calculated as:\n$$\n\\tau = -2 \\ln(10^{-2}) = -2 (-2 \\ln(10)) = 4 \\ln(10)\n$$\nUsing the value $\\ln(10) \\approx 2.30258509...$:\n$$\n\\tau \\approx 4 \\times 2.30258509... \\approx 9.21034037...\n$$\nThe problem requires the final answer to be rounded to four significant figures. The resulting dimensionless value for the gating threshold is $9.210$.\nThe gating criterion is therefore: if $\\mathbf{r}^{\\top} \\mathbf{S}^{\\dagger} \\mathbf{r} > 9.210$, declare a disturbance and reject the magnetometer measurement.",
            "answer": "$$\n\\boxed{9.210}\n$$"
        }
    ]
}