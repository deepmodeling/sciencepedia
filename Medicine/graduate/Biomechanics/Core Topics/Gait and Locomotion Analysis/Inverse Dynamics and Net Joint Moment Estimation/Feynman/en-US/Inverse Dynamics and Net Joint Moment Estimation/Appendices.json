{
    "hands_on_practices": [
        {
            "introduction": "To master inverse dynamics, we must first be proficient in its fundamental components. This initial practice focuses on deriving a single, crucial term in the Newton-Euler equations: the moment generated by gravity. By starting from first principles, you will use vector cross products to calculate the gravitational moment on the shank, reinforcing the critical importance of rigorously defining coordinate systems, position vectors, and sign conventions—skills that are essential for preventing common errors in more complex biomechanical models .",
            "id": "4181307",
            "problem": "Consider a quasi-static sagittal-plane analysis of the shank (lower leg) segment during a standing posture. Treat the shank as a rigid body of mass $m$ whose center of mass lies at a fixed distance $d$ from the knee joint center along the shank. Adopt a right-handed Cartesian coordinate system with the anterior direction as $+x$, the superior direction as $+y$, and the knee flexion-extension axis as $+z$ pointing out of the sagittal plane. Let the position vector from the knee joint center to the shank center of mass be oriented at an angle $\\theta$ posterior from the vertical, so that $\\theta>0$ denotes a posterior tilt of the shank center line relative to the $+y$ axis. Gravity acts as a uniform field producing a force of magnitude $m g$ in the $-y$ direction. Define the positive external net joint moment at the knee as a moment that tends to increase knee flexion, i.e., a counterclockwise rotation in the $x$–$y$ plane corresponding to the $+z$ direction.\n\nStarting only from Newton’s laws and the definition of the moment of a force about a point, derive an analytic expression for the gravitational moment about the knee due to the shank’s weight as a function of $\\theta$. Then, for the specific posture with $m=3.9$ $\\text{kg}$, $d=0.21$ $\\text{m}$, $\\theta=20$ $\\text{degrees}$, and $g=9.81$ $\\text{m}\\,\\text{s}^{-2}$, evaluate the gravitational knee moment. Round your final numerical result to four significant figures. Express the final moment in $\\text{N}\\cdot\\text{m}$ and take the angle in degrees. In addition to the derivation and calculation, explain how the chosen sign convention determines whether the gravitational moment is flexion or extension and how the expression’s sign would change under alternative common conventions, but ensure the final numerical answer is computed under the conventions stated above.",
            "solution": "The problem requires the derivation of an expression for the gravitational moment at the knee joint and its subsequent numerical evaluation. The validation process confirms the problem is scientifically grounded, well-posed, and contains all necessary information.\n\nThe moment of a force, or torque, $\\vec{M}$, generated by a force $\\vec{F}$ applied at a position $\\vec{r}$ relative to a point of rotation is defined by the cross product:\n$$\n\\vec{M} = \\vec{r} \\times \\vec{F}\n$$\nIn this problem, the point of rotation is the knee joint center, which we take as the origin of our coordinate system, $O=(0,0,0)$. The force is the gravitational force acting on the shank's center of mass (CoM).\n\nFirst, we define the position vector $\\vec{r}$ from the knee joint center to the shank's CoM. The shank's CoM is at a distance $d$ from the knee. The orientation is given by an angle $\\theta$ posterior from the vertical. The coordinate system is defined with the $+y$ axis representing the superior (vertical) direction and the $+x$ axis representing the anterior direction. Consequently, the posterior direction corresponds to the $-x$ axis. An angle $\\theta$ posterior from the vertical means the position vector originates from the $+y$ axis and is rotated by an angle $\\theta$ towards the $-x$ axis.\n\nThe components of the position vector $\\vec{r}$ are therefore:\n$$\nr_x = -d \\sin(\\theta)\n$$\n$$\nr_y = d \\cos(\\theta)\n$$\nThe problem is in the sagittal plane ($x$-$y$ plane), so the $z$-component is zero. In the defined right-handed Cartesian coordinate system ($\\hat{\\imath}$ for $+x$, $\\hat{\\jmath}$ for $+y$, $\\hat{k}$ for $+z$), the position vector is:\n$$\n\\vec{r} = -d \\sin(\\theta) \\hat{\\imath} + d \\cos(\\theta) \\hat{\\jmath}\n$$\n\nNext, we define the gravitational force vector $\\vec{F}_g$. The force has a magnitude of $m g$ and acts in the negative vertical direction ($-y$ direction). Thus, the force vector is:\n$$\n\\vec{F}_g = -mg \\hat{\\jmath}\n$$\n\nNow, we can compute the gravitational moment about the knee, $\\vec{M}_g$, by taking the cross product of $\\vec{r}$ and $\\vec{F}_g$:\n$$\n\\vec{M}_g = \\vec{r} \\times \\vec{F}_g = \\left( -d \\sin(\\theta) \\hat{\\imath} + d \\cos(\\theta) \\hat{\\jmath} \\right) \\times \\left( -mg \\hat{\\jmath} \\right)\n$$\nUsing the distributive property of the cross product:\n$$\n\\vec{M}_g = \\left( -d \\sin(\\theta) \\hat{\\imath} \\times -mg \\hat{\\jmath} \\right) + \\left( d \\cos(\\theta) \\hat{\\jmath} \\times -mg \\hat{\\jmath} \\right)\n$$\nWe use the properties of the cross product for unit vectors: $\\hat{\\imath} \\times \\hat{\\jmath} = \\hat{k}$ and $\\hat{\\jmath} \\times \\hat{\\jmath} = \\vec{0}$.\nThe second term becomes zero. The first term simplifies to:\n$$\n\\vec{M}_g = (-d \\sin(\\theta))(-mg)(\\hat{\\imath} \\times \\hat{\\jmath}) = mgd \\sin(\\theta) \\hat{k}\n$$\nThis vector represents the moment generated by gravity. The problem defines that a positive external net joint moment tends to increase knee flexion and corresponds to a counterclockwise rotation in the $x$-$y$ plane, which is a moment in the $+z$ direction (represented by $\\hat{k}$). Therefore, the scalar expression for the gravitational moment, consistent with the given convention, is the $z$-component of $\\vec{M}_g$.\n\nThe derived analytic expression for the gravitational moment about the knee is:\n$$\nM_g(\\theta) = mgd \\sin(\\theta)\n$$\n\nWe are now asked to evaluate this moment for the specific case where $m=3.9~\\text{kg}$, $d=0.21~\\text{m}$, $\\theta=20~\\text{degrees}$, and $g=9.81~\\text{m}\\,\\text{s}^{-2}$.\nSubstituting these values into the expression:\n$$\nM_g = (3.9~\\text{kg}) \\times (9.81~\\text{m}\\,\\text{s}^{-2}) \\times (0.21~\\text{m}) \\times \\sin(20^{\\circ})\n$$\nFirst, we calculate the product of the magnitudes:\n$$\n(3.9) \\times (9.81) \\times (0.21) \\approx 8.03439~\\text{N}\\cdot\\text{m}\n$$\nNext, we evaluate the sine of the angle:\n$$\n\\sin(20^{\\circ}) \\approx 0.34202014\n$$\nMultiplying these results gives the moment:\n$$\nM_g \\approx 8.03439 \\times 0.34202014 \\approx 2.74801~\\text{N}\\cdot\\text{m}\n$$\nRounding the result to four significant figures, we get:\n$$\nM_g = 2.748~\\text{N}\\cdot\\text{m}\n$$\n\nFinally, we address the role of the sign convention.\nIn the problem's convention, a positive moment is a flexion moment (counter-clockwise, $+z$). Our calculated moment $M_g = mgd \\sin(\\theta)$ is positive for $\\theta \\in (0, 180^{\\circ})$, which covers all physically relevant shank positions in this context. Therefore, for the given posterior tilt ($\\theta=20^{\\circ}$), gravity produces a flexion moment. This is intuitive, as the weight of the posteriorly-tilted shank pulls it downward, tending to bend (flex) the knee. In a quasi-static condition, this gravitational flexion moment must be counteracted by an internal extension moment (generated by muscles like the quadriceps and ligaments) to maintain the pose.\n\nIf an alternative common convention were used where an extension moment (clockwise, $-z$) is defined as positive, our physical derivation of the moment vector $\\vec{M}_g = mgd \\sin(\\theta) \\hat{k}$ remains unchanged. However, its representation as a scalar value under this new convention would be $M_{g, \\text{ext-pos}} = -mgd \\sin(\\theta)$. The expression's sign would be inverted.\n\nIf the angle were defined differently, for example, as an anterior tilt from the vertical, the position vector would be $\\vec{r} = +d \\sin(\\theta) \\hat{\\imath} + d \\cos(\\theta) \\hat{\\jmath}$. This would lead to a moment $\\vec{M}_g = -mgd \\sin(\\theta) \\hat{k}$, which is an extension moment. This is also intuitive, as a forward-tilted shank's weight would tend to straighten (extend) the knee. The choice of coordinate system and definitions for angles and positive rotation direction are crucial for the final expression and its interpretation.\n\nThe final numerical calculation is based strictly on the conventions provided in the problem statement.",
            "answer": "$$\n\\boxed{2.748}\n$$"
        },
        {
            "introduction": "While full three-dimensional analysis provides the most accurate results, biomechanists often employ simplified two-dimensional models for efficiency. This exercise challenges you to quantify the trade-offs of such simplifications by implementing both a full 3D and a simplified 2D inverse dynamics model for a single segment. By calculating the error between the two under various conditions, you will gain a concrete understanding of how out-of-plane motions, gyroscopic coupling, and non-sagittal forces contribute to inaccuracies, allowing you to make more informed modeling decisions in your own research .",
            "id": "4181311",
            "problem": "You must write a complete, runnable program that quantifies how ignoring out-of-plane motion and transverse plane Ground Reaction Force (GRF) components affects net joint moment estimation when using two-dimensional (2D) inverse dynamics in biomechanics. Consider a rigid foot-shank segment during stance. Use a right-handed laboratory coordinate system with unit basis vectors $\\hat{\\mathbf{x}}$ (forward), $\\hat{\\mathbf{y}}$ (mediolateral), and $\\hat{\\mathbf{z}}$ (upward). The sagittal plane is defined by the $\\hat{\\mathbf{x}}$–$\\hat{\\mathbf{z}}$ axes. The net joint moment of interest is the flexion-extension moment about the knee or ankle axis, which need not be aligned with the laboratory $\\hat{\\mathbf{y}}$ axis due to limb yaw.\n\nStart from the following fundamental bases:\n- Newton’s Second Law for translation: $\\sum \\mathbf{F} = m \\mathbf{a}_{\\mathrm{com}}$, where $m$ is mass and $\\mathbf{a}_{\\mathrm{com}}$ is the Center of Mass (COM) acceleration.\n- Rigid body rotational dynamics (Euler’s equation) about an arbitrary fixed point (the joint center): the vector sum of external moments about the joint equals the rotational inertia and the translational inertia contributions about that point. Let $\\mathbf{I}$ be the inertia tensor in the laboratory frame, $\\boldsymbol{\\omega}$ be angular velocity, and $\\boldsymbol{\\alpha}$ be angular acceleration. Let $\\mathbf{r}_{\\mathrm{com}}$ be the position vector from the joint center to the COM, $\\mathbf{r}_{\\mathrm{grf}}$ be the position vector from the joint center to the Center of Pressure (COP) of the GRF, $\\mathbf{F}_{\\mathrm{grf}}$ be the GRF vector, $\\mathbf{M}_{\\mathrm{free}}$ be the GRF free moment vector at the COP, and $\\mathbf{F}_{g}$ be the gravity force vector acting at the COM. Use the vector cross product $\\times$ and dot product $\\cdot$ operators.\n\nTask:\n1. Compute the three-dimensional (3D) net joint moment vector about the joint center using the above laws and definitions. Then compute the flexion-extension component by projecting the 3D net joint moment onto the unit vector $\\mathbf{u}_{y}$ obtained by rotating the laboratory $\\hat{\\mathbf{y}}$ axis by a yaw angle $\\psi$ about $\\hat{\\mathbf{z}}$. The yaw rotation is defined by $\\mathbf{u}_{y} = \\mathbf{R}_{z}(\\psi)\\,\\hat{\\mathbf{y}}$, where $\\mathbf{R}_{z}(\\psi)$ is the right-handed rotation about $\\hat{\\mathbf{z}}$ by $\\psi$ radians.\n2. Compute a 2D sagittal-plane approximation to the flexion-extension moment that assumes the flexion-extension axis is aligned with the laboratory $\\hat{\\mathbf{y}}$ axis, ignores out-of-plane angular velocities and their gyroscopic coupling, and uses only sagittal-plane components for translational inertia and GRF contributions.\n3. Report the error magnitude as the absolute difference between the 3D projected flexion-extension moment and the 2D approximation.\n\nDefinitions:\n- Ground Reaction Force (GRF) is the external force measured at the foot-ground interface.\n- Center of Mass (COM) is the mass-weighted average position of the segment.\n- Center of Pressure (COP) is the point of application of the resultant GRF on the support surface.\n- Gravity acts as $\\mathbf{F}_{g} = m \\mathbf{g}$ with $\\mathbf{g} = (0, 0, -g)$ and $g = 9.81$.\n\nAngle unit requirement: all angles must be in radians. Physical unit requirement: all moments must be reported in Newton-meters (N·m). Your program must compute the error magnitude for each test case in N·m and round each result to three decimals.\n\nImplementational notes:\n- Treat the inertia tensor $\\mathbf{I}$ as diagonal in the laboratory frame with principal moments $(I_{xx}, I_{yy}, I_{zz})$.\n- The 3D net joint moment about the joint center should be derived from first principles using the laws above, including the gyroscopic term $\\boldsymbol{\\omega} \\times (\\mathbf{I}\\boldsymbol{\\omega})$ and translational inertia term $\\mathbf{r}_{\\mathrm{com}} \\times (m \\mathbf{a}_{\\mathrm{com}})$.\n- The 2D approximation for the sagittal-plane flexion-extension moment should neglect the gyroscopic coupling and treat the flexion-extension axis as perfectly aligned with $\\hat{\\mathbf{y}}$, using only the laboratory $y$-component of the moment balance.\n\nTest Suite:\nProvide the error magnitude for each of the following four gait trial parameter sets. All vectors are given in the laboratory frame and all quantities must be used as specified.\n- Case $1$ (general, small yaw, mild out-of-plane):\n  - $m = 8.0$ $\\mathrm{kg}$.\n  - $(I_{xx}, I_{yy}, I_{zz}) = (0.08, 0.12, 0.10)$ $\\mathrm{kg\\cdot m^2}$.\n  - $\\mathbf{r}_{\\mathrm{com}} = (0.15, 0.00, -0.04)$ $\\mathrm{m}$.\n  - $\\mathbf{a}_{\\mathrm{com}} = (1.20, 0.10, 0.50)$ $\\mathrm{m/s^2}$.\n  - $\\mathbf{r}_{\\mathrm{grf}} = (0.20, 0.03, -0.02)$ $\\mathrm{m}$.\n  - $\\mathbf{F}_{\\mathrm{grf}} = (350.0, 15.0, 800.0)$ $\\mathrm{N}$.\n  - $\\mathbf{M}_{\\mathrm{free}} = (0.0, -5.0, 12.0)$ $\\mathrm{N\\cdot m}$.\n  - $\\boldsymbol{\\omega} = (1.50, 8.00, 0.80)$ $\\mathrm{rad/s}$.\n  - $\\boldsymbol{\\alpha} = (5.00, 12.00, -2.00)$ $\\mathrm{rad/s^2}$.\n  - $\\psi = 0.10$ $\\mathrm{rad}$.\n- Case $2$ (boundary, perfectly planar, axis aligned):\n  - $m = 6.0$ $\\mathrm{kg}$.\n  - $(I_{xx}, I_{yy}, I_{zz}) = (0.05, 0.09, 0.06)$ $\\mathrm{kg\\cdot m^2}$.\n  - $\\mathbf{r}_{\\mathrm{com}} = (0.13, 0.00, -0.03)$ $\\mathrm{m}$.\n  - $\\mathbf{a}_{\\mathrm{com}} = (0.80, 0.00, 0.40)$ $\\mathrm{m/s^2}$.\n  - $\\mathbf{r}_{\\mathrm{grf}} = (0.18, 0.00, -0.01)$ $\\mathrm{m}$.\n  - $\\mathbf{F}_{\\mathrm{grf}} = (300.0, 0.0, 750.0)$ $\\mathrm{N}$.\n  - $\\mathbf{M}_{\\mathrm{free}} = (0.0, -4.0, 0.0)$ $\\mathrm{N\\cdot m}$.\n  - $\\boldsymbol{\\omega} = (0.00, 7.50, 0.00)$ $\\mathrm{rad/s}$.\n  - $\\boldsymbol{\\alpha} = (0.00, 10.00, 0.00)$ $\\mathrm{rad/s^2}$.\n  - $\\psi = 0.00$ $\\mathrm{rad}$.\n- Case $3$ (edge, large yaw with strong out-of-plane angular motion):\n  - $m = 7.5$ $\\mathrm{kg}$.\n  - $(I_{xx}, I_{yy}, I_{zz}) = (0.06, 0.11, 0.16)$ $\\mathrm{kg\\cdot m^2}$.\n  - $\\mathbf{r}_{\\mathrm{com}} = (0.16, 0.02, -0.05)$ $\\mathrm{m}$.\n  - $\\mathbf{a}_{\\mathrm{com}} = (1.00, 0.20, 0.60)$ $\\mathrm{m/s^2}$.\n  - $\\mathbf{r}_{\\mathrm{grf}} = (0.21, 0.04, -0.02)$ $\\mathrm{m}$.\n  - $\\mathbf{F}_{\\mathrm{grf}} = (320.0, 20.0, 780.0)$ $\\mathrm{N}$.\n  - $\\mathbf{M}_{\\mathrm{free}} = (0.0, -6.0, 15.0)$ $\\mathrm{N\\cdot m}$.\n  - $\\boldsymbol{\\omega} = (3.00, 9.00, 2.50)$ $\\mathrm{rad/s}$.\n  - $\\boldsymbol{\\alpha} = (2.00, 11.00, -3.00)$ $\\mathrm{rad/s^2}$.\n  - $\\psi = 0.5235987756$ $\\mathrm{rad}$.\n- Case $4$ (edge, substantial lateral GRF and moderate yaw):\n  - $m = 6.8$ $\\mathrm{kg}$.\n  - $(I_{xx}, I_{yy}, I_{zz}) = (0.07, 0.10, 0.09)$ $\\mathrm{kg\\cdot m^2}$.\n  - $\\mathbf{r}_{\\mathrm{com}} = (0.14, -0.01, -0.04)$ $\\mathrm{m}$.\n  - $\\mathbf{a}_{\\mathrm{com}} = (0.90, -0.10, 0.50)$ $\\mathrm{m/s^2}$.\n  - $\\mathbf{r}_{\\mathrm{grf}} = (0.19, -0.04, -0.015)$ $\\mathrm{m}$.\n  - $\\mathbf{F}_{\\mathrm{grf}} = (310.0, 35.0, 770.0)$ $\\mathrm{N}$.\n  - $\\mathbf{M}_{\\mathrm{free}} = (0.0, -3.0, 20.0)$ $\\mathrm{N\\cdot m}$.\n  - $\\boldsymbol{\\omega} = (2.00, 8.50, 1.80)$ $\\mathrm{rad/s}$.\n  - $\\boldsymbol{\\alpha} = (1.50, 12.50, -2.20)$ $\\mathrm{rad/s^2}$.\n  - $\\psi = 0.20943951$ $\\mathrm{rad}$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the error magnitudes for the four test cases, as a comma-separated list enclosed in square brackets, each rounded to three decimals and expressed in N·m (e.g., $[e_1,e_2,e_3,e_4]$).",
            "solution": "The problem is assessed as valid because it is scientifically grounded in the principles of rigid body dynamics, well-posed with a complete and consistent set of data and definitions, and pertains directly to a core topic in biomechanics. The numerical values provided are physically plausible for human gait analysis.\n\nThe objective is to quantify the error introduced by a simplified two-dimensional (2D) inverse dynamics model compared to a more complete three-dimensional (3D) model for estimating the flexion-extension net joint moment. The problem will be solved in three stages: first, deriving the full 3D net joint moment vector and projecting it onto the true flexion-extension axis; second, deriving the approximate 2D flexion-extension moment; and third, computing the absolute difference between these two quantities.\n\nLet the joint center be the origin $O$ of our analysis. The fundamental equation of rotational dynamics states that the sum of all moments about a point equals the rate of change of angular momentum about that point. To find the net joint moment $\\mathbf{M}_{\\mathrm{joint}}$, we rearrange Newton-Euler's equations for a rigid body. The sum of external moments acting on the segment, including the joint moment, is equated to the change in the segment's angular momentum. The equation, solving for the joint moment, is:\n$$ \\mathbf{M}_{\\mathrm{joint}} = \\frac{d\\mathbf{H}_{\\mathrm{com}}}{dt} + \\mathbf{r}_{\\mathrm{com}} \\times (m \\mathbf{a}_{\\mathrm{com}}) - \\sum\\mathbf{M}_{\\mathrm{ext},O} $$\nwhere $\\mathbf{H}_{\\mathrm{com}}$ is the angular momentum about the segment's center of mass (COM), $\\mathbf{r}_{\\mathrm{com}}$ is the position vector from the joint to the COM, $m$ is the mass, $\\mathbf{a}_{\\mathrm{com}}$ is the acceleration of the COM, and $\\sum\\mathbf{M}_{\\mathrm{ext},O}$ is the sum of all external moments (excluding the joint moment) about the joint center $O$.\n\nThe rate of change of angular momentum about the COM is given by Euler's equation:\n$$ \\frac{d\\mathbf{H}_{\\mathrm{com}}}{dt} = \\mathbf{I}_{\\mathrm{com}} \\boldsymbol{\\alpha} + \\boldsymbol{\\omega} \\times (\\mathbf{I}_{\\mathrm{com}} \\boldsymbol{\\omega}) $$\nHere, $\\mathbf{I}_{\\mathrm{com}}$ is the inertia tensor about the COM (given as $\\mathbf{I}$ in the problem statement), $\\boldsymbol{\\alpha}$ is the angular acceleration, and $\\boldsymbol{\\omega}$ is the angular velocity. The term $\\boldsymbol{\\omega} \\times (\\mathbf{I}_{\\mathrm{com}} \\boldsymbol{\\omega})$ represents the gyroscopic and centrifugal effects.\n\nThe external moments about the joint $O$ are due to the ground reaction force (GRF) and gravity:\n$$ \\sum\\mathbf{M}_{\\mathrm{ext},O} = (\\mathbf{r}_{\\mathrm{grf}} \\times \\mathbf{F}_{\\mathrm{grf}}) + \\mathbf{M}_{\\mathrm{free}} + (\\mathbf{r}_{\\mathrm{com}} \\times \\mathbf{F}_{g}) $$\nwhere $\\mathbf{r}_{\\mathrm{grf}}$ is the position vector from the joint to the center of pressure (COP), $\\mathbf{F}_{\\mathrm{grf}}$ is the GRF vector, $\\mathbf{M}_{\\mathrm{free}}$ is the free moment from the GRF, and $\\mathbf{F}_{g} = m\\mathbf{g}$ is the force of gravity, with $\\mathbf{g} = (0, 0, -g)$ where $g=9.81 \\, \\mathrm{m/s^2}$.\n\nCombining these, we get the expression for the full 3D net joint moment vector, $\\mathbf{M}_{\\mathrm{joint}, 3D}$:\n$$ \\mathbf{M}_{\\mathrm{joint}, 3D} = \\mathbf{I} \\boldsymbol{\\alpha} + \\boldsymbol{\\omega} \\times (\\mathbf{I} \\boldsymbol{\\omega}) + \\mathbf{r}_{\\mathrm{com}} \\times (m \\mathbf{a}_{\\mathrm{com}}) - (\\mathbf{r}_{\\mathrm{grf}} \\times \\mathbf{F}_{\\mathrm{grf}}) - \\mathbf{M}_{\\mathrm{free}} - (\\mathbf{r}_{\\mathrm{com}} \\times m\\mathbf{g}) $$\nThe problem defines the inertia tensor $\\mathbf{I}$ as diagonal in the laboratory frame, $\\mathbf{I} = \\mathrm{diag}(I_{xx}, I_{yy}, I_{zz})$.\n\nThe flexion-extension moment, $M_{3D,flex/ext}$, is the projection of this 3D moment vector onto the true flexion-extension axis, defined by the unit vector $\\mathbf{u}_{y}$. This axis is obtained by rotating the laboratory $\\hat{\\mathbf{y}}=(0, 1, 0)$ axis by a yaw angle $\\psi$ about the $\\hat{\\mathbf{z}}$ axis:\n$$ \\mathbf{u}_{y} = \\mathbf{R}_{z}(\\psi)\\,\\hat{\\mathbf{y}} = \\begin{pmatrix} \\cos\\psi & -\\sin\\psi & 0 \\\\ \\sin\\psi & \\cos\\psi & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -\\sin\\psi \\\\ \\cos\\psi \\\\ 0 \\end{pmatrix} $$\nThe projected moment is then calculated using the dot product:\n$$ M_{3D,flex/ext} = \\mathbf{M}_{\\mathrm{joint}, 3D} \\cdot \\mathbf{u}_{y} $$\n\nNext, we formulate the 2D sagittal-plane approximation, $M_{2D,flex/ext}$. This approximation makes several simplifying assumptions:\n1.  The flexion-extension axis is aligned with the laboratory $\\hat{\\mathbf{y}}$ axis ($\\psi=0$).\n2.  All out-of-plane motions and forces are ignored. This means only the $x$ and $z$ components of vectors are considered for cross products.\n3.  Gyroscopic and centrifugal effects, $\\boldsymbol{\\omega} \\times (\\mathbf{I} \\boldsymbol{\\omega})$, are neglected.\n\nThese assumptions simplify the moment calculation to only its $y$-component, considering only sagittal-plane ($x-z$) dynamics. The 2D moment is the $y$-component of the simplified moment balance:\n$$ M_{2D,flex/ext} = (\\mathbf{I}\\boldsymbol{\\alpha})_y + (\\mathbf{r}_{\\mathrm{com}} \\times m\\mathbf{a}_{\\mathrm{com}})_y - (\\mathbf{r}_{\\mathrm{grf}} \\times \\mathbf{F}_{\\mathrm{grf}})_y - (\\mathbf{M}_{\\mathrm{free}})_y - (\\mathbf{r}_{\\mathrm{com}} \\times m\\mathbf{g})_y $$\nApplying the 2D assumptions to each term:\n-   Rotational inertia: $(\\mathbf{I}\\boldsymbol{\\alpha})_y = I_{yy} \\alpha_y$.\n-   Translational inertia: $(\\mathbf{r}_{\\mathrm{com, sag}} \\times m\\mathbf{a}_{\\mathrm{com, sag}})_y = m (r_{\\mathrm{com},z} a_{\\mathrm{com},x} - r_{\\mathrm{com},x} a_{\\mathrm{com},z})$.\n-   GRF moment: $(\\mathbf{r}_{\\mathrm{grf, sag}} \\times \\mathbf{F}_{\\mathrm{grf, sag}})_y = r_{\\mathrm{grf},z} F_{\\mathrm{grf},x} - r_{\\mathrm{grf},x} F_{\\mathrm{grf},z}$.\n-   Free moment: The sagittal plane moment is simply the $y$-component, $M_{\\mathrm{free},y}$.\n-   Gravity moment: $(\\mathbf{r}_{\\mathrm{com, sag}} \\times m\\mathbf{g})_y = m g r_{\\mathrm{com},x}$, since $\\mathbf{g}$ has no $x$ or $y$ component.\n\nAssembling the 2D equation:\n$$ M_{2D,flex/ext} = I_{yy} \\alpha_y + m(r_{\\mathrm{com},z} a_{\\mathrm{com},x} - r_{\\mathrm{com},x} a_{\\mathrm{com},z}) - (r_{\\mathrm{grf},z} F_{\\mathrm{grf},x} - r_{\\mathrm{grf},x} F_{\\mathrm{grf},z}) - M_{\\mathrm{free},y} - m g r_{\\mathrm{com},x} $$\n\nFinally, the error magnitude for each test case is computed as the absolute difference between the 3D-derived moment and its 2D approximation:\n$$ \\text{Error} = | M_{3D,flex/ext} - M_{2D,flex/ext} | $$\nThe provided test cases will be processed according to these equations to determine the error magnitude, which quantifies the effect of the simplifying assumptions inherent in 2D analysis.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the error in net joint moment estimation between a 3D model\n    and a simplified 2D model for four test cases.\n    \"\"\"\n    g_const = 9.81\n    g_vec = np.array([0.0, 0.0, -g_const])\n\n    test_cases = [\n        # Case 1\n        {\n            \"m\": 8.0, \"I_diag\": (0.08, 0.12, 0.10),\n            \"r_com\": (0.15, 0.00, -0.04), \"a_com\": (1.20, 0.10, 0.50),\n            \"r_grf\": (0.20, 0.03, -0.02), \"F_grf\": (350.0, 15.0, 800.0),\n            \"M_free\": (0.0, -5.0, 12.0),\n            \"omega\": (1.50, 8.00, 0.80), \"alpha\": (5.00, 12.00, -2.00),\n            \"psi\": 0.10\n        },\n        # Case 2\n        {\n            \"m\": 6.0, \"I_diag\": (0.05, 0.09, 0.06),\n            \"r_com\": (0.13, 0.00, -0.03), \"a_com\": (0.80, 0.00, 0.40),\n            \"r_grf\": (0.18, 0.00, -0.01), \"F_grf\": (300.0, 0.0, 750.0),\n            \"M_free\": (0.0, -4.0, 0.0),\n            \"omega\": (0.00, 7.50, 0.00), \"alpha\": (0.00, 10.00, 0.00),\n            \"psi\": 0.00\n        },\n        # Case 3\n        {\n            \"m\": 7.5, \"I_diag\": (0.06, 0.11, 0.16),\n            \"r_com\": (0.16, 0.02, -0.05), \"a_com\": (1.00, 0.20, 0.60),\n            \"r_grf\": (0.21, 0.04, -0.02), \"F_grf\": (320.0, 20.0, 780.0),\n            \"M_free\": (0.0, -6.0, 15.0),\n            \"omega\": (3.00, 9.00, 2.50), \"alpha\": (2.00, 11.00, -3.00),\n            \"psi\": 0.5235987756\n        },\n        # Case 4\n        {\n            \"m\": 6.8, \"I_diag\": (0.07, 0.10, 0.09),\n            \"r_com\": (0.14, -0.01, -0.04), \"a_com\": (0.90, -0.10, 0.50),\n            \"r_grf\": (0.19, -0.04, -0.015), \"F_grf\": (310.0, 35.0, 770.0),\n            \"M_free\": (0.0, -3.0, 20.0),\n            \"omega\": (2.00, 8.50, 1.80), \"alpha\": (1.50, 12.50, -2.20),\n            \"psi\": 0.20943951\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        m = case[\"m\"]\n        I_diag = np.array(case[\"I_diag\"])\n        r_com = np.array(case[\"r_com\"])\n        a_com = np.array(case[\"a_com\"])\n        r_grf = np.array(case[\"r_grf\"])\n        F_grf = np.array(case[\"F_grf\"])\n        M_free = np.array(case[\"M_free\"])\n        omega = np.array(case[\"omega\"])\n        alpha = np.array(case[\"alpha\"])\n        psi = case[\"psi\"]\n        \n        # --- 3D Calculation ---\n        I = np.diag(I_diag)\n\n        # Rate of change of angular momentum about COM\n        term_I_alpha = I @ alpha\n        term_gyro = np.cross(omega, I @ omega)\n        \n        # Translational inertia term expressed as a moment about the joint\n        term_trans_inertia = np.cross(r_com, m * a_com)\n        \n        # External moment terms about the joint\n        moment_grf = np.cross(r_grf, F_grf)\n        moment_gravity = np.cross(r_com, m * g_vec)\n        \n        # Total 3D net joint moment vector\n        M_joint_3D = (term_I_alpha + term_gyro + term_trans_inertia -\n                      moment_grf - M_free - moment_gravity)\n\n        # Flexion-extension axis unit vector\n        u_y = np.array([-np.sin(psi), np.cos(psi), 0.0])\n        \n        # Projected 3D flexion/extension moment\n        M_3D_flex_ext = np.dot(M_joint_3D, u_y)\n\n        # --- 2D Calculation ---\n        # Extract sagittal plane components (indices 0 and 2 for x and z)\n        Iyy = I_diag[1]\n        alpha_y = alpha[1]\n        \n        r_com_x, r_com_z = r_com[0], r_com[2]\n        a_com_x, a_com_z = a_com[0], a_com[2]\n        \n        r_grf_x, r_grf_z = r_grf[0], r_grf[2]\n        F_grf_x, F_grf_z = F_grf[0], F_grf[2]\n        \n        M_free_y = M_free[1]\n\n        # Assemble the 2D moment equation\n        term_I_alpha_2D = Iyy * alpha_y\n        term_trans_inertia_2D = m * (r_com_z * a_com_x - r_com_x * a_com_z)\n        moment_grf_2D = r_grf_z * F_grf_x - r_grf_x * F_grf_z\n        moment_gravity_2D = m * g_const * r_com_x\n        \n        M_2D_flex_ext = (term_I_alpha_2D + term_trans_inertia_2D -\n                         moment_grf_2D - M_free_y - moment_gravity_2D)\n        \n        # --- Error Calculation ---\n        error = abs(M_3D_flex_ext - M_2D_flex_ext)\n        results.append(round(error, 3))\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.3f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having explored the dynamics of a single segment, the next step is to analyze an interconnected system of segments, which better represents biological limbs. This practice introduces the powerful recursive Newton-Euler algorithm, the standard computational method for solving inverse dynamics in multi-segment chains. By implementing this distal-to-proximal recursion, you will learn how joint reaction forces and net joint moments are propagated through a kinematic chain, transitioning from single-body analysis to the systemic approach required to understand coordinated human movement .",
            "id": "4181295",
            "problem": "Consider a planar Two-Dimensional (2D) chain of $n$ rigid body segments linked serially from proximal to distal. Each segment $s \\in \\{1,2,\\dots,n\\}$ has a proximal joint at point $P_s$, a distal joint at point $D_s$, a mass $m_s$, a planar moment of inertia about its Center of Mass (COM) $I_s$, a COM acceleration vector $\\mathbf{a}_{C,s} \\in \\mathbb{R}^2$, and an angular acceleration $\\alpha_s \\in \\mathbb{R}$. The gravitational acceleration is the constant vector $\\mathbf{g} \\in \\mathbb{R}^2$. For each segment $s$, let $\\mathbf{r}_{P C,s} \\in \\mathbb{R}^2$ denote the position vector from the COM to the proximal joint, and $\\mathbf{r}_{D C,s} \\in \\mathbb{R}^2$ denote the position vector from the COM to the distal joint. The distal end of the last segment $s=n$ may be subject to a known external contact load consisting of a force vector $\\mathbf{F}_{\\text{ext}}^{(n)} \\in \\mathbb{R}^2$ applied at $D_n$ and an external free moment $M_{\\text{ext}}^{(n)} \\in \\mathbb{R}$ about the COM due to that contact.\n\nStarting from the fundamental laws of mechanics, specifically Newton’s Second Law of Motion ($\\sum \\mathbf{F} = m \\mathbf{a}$) and Euler’s rotational equation for rigid bodies ($\\sum M = I \\alpha$), derive recursive equations that propagate the joint reaction forces and net joint moments from the distal segment to the proximal segment for the entire chain. Your derivation must use the sign convention that positive moments are counterclockwise about the out-of-plane axis, and the 2D cross product of position and force vectors is the scalar $r_x F_y - r_y F_x$. Angles must be treated in radians.\n\nAfter deriving the recursion, implement it for $n=3$ segments using the parameter sets provided in the test suite below. For each test case, you must compute the ordered list of proximal net joint moments $[M_{p}^{(3)},M_{p}^{(2)},M_{p}^{(1)}]$ corresponding to the proximal joints of segments $s=3,2,1$, respectively. Express each moment in Newton-meters (N·m), rounded to three decimal places.\n\nAssumptions and conventions:\n- The coordinate frame is fixed with $\\hat{\\mathbf{x}}$ pointing anterior (forward) and $\\hat{\\mathbf{y}}$ pointing superior (up).\n- The only external forces considered are gravity acting at the COM of each segment and, for the last segment $s=n$, the known contact force $\\mathbf{F}_{\\text{ext}}^{(n)}$ at $D_n$. Gravity contributes no moment about the COM because it acts at the COM.\n- The reaction force and net moment at an inter-segment joint act on each adjacent segment with equal magnitude and opposite direction (Newton’s Third Law), enabling distal-to-proximal propagation.\n\nTest Suite (all physical quantities are specified in International System of Units (SI), angles in radians, and the final moments must be reported in N·m):\n\nLet $n=3$. Segment properties common to all test cases:\n- Masses: $m_1 = 8.0$, $m_2 = 4.0$, $m_3 = 1.2$ kilograms.\n- Inertias: $I_1 = 0.20$, $I_2 = 0.05$, $I_3 = 0.01$ kilogram–meter squared.\n- COM-to-proximal vectors: $\\mathbf{r}_{P C,1} = (0.0,\\,0.20)$ meters, $\\mathbf{r}_{P C,2} = (0.0,\\,0.20)$ meters, $\\mathbf{r}_{P C,3} = (-0.05,\\,0.03)$ meters.\n- COM-to-distal vectors: $\\mathbf{r}_{D C,1} = (0.0,\\,-0.20)$ meters, $\\mathbf{r}_{D C,2} = (0.0,\\,-0.20)$ meters, $\\mathbf{r}_{D C,3} = (0.15,\\,-0.02)$ meters.\n\nTest Case A (general dynamic, distal contact):\n- Gravity: $\\mathbf{g} = (0.0,\\,-9.81)$ meters per second squared.\n- COM accelerations: $\\mathbf{a}_{C,1} = (0.50,\\,0.30)$, $\\mathbf{a}_{C,2} = (0.80,\\,1.20)$, $\\mathbf{a}_{C,3} = (0.20,\\,0.50)$ meters per second squared.\n- Angular accelerations: $\\alpha_1 = 0.50$, $\\alpha_2 = 1.00$, $\\alpha_3 = -0.30$ radians per second squared.\n- Distal contact on segment $3$: $\\mathbf{F}_{\\text{ext}}^{(3)} = (-50.0,\\,600.0)$ Newtons, $M_{\\text{ext}}^{(3)} = 10.0$ Newton–meters.\n\nTest Case B (boundary: zero accelerations, no distal contact):\n- Gravity: $\\mathbf{g} = (0.0,\\,-9.81)$ meters per second squared.\n- COM accelerations: $\\mathbf{a}_{C,1} = (0.0,\\,0.0)$, $\\mathbf{a}_{C,2} = (0.0,\\,0.0)$, $\\mathbf{a}_{C,3} = (0.0,\\,0.0)$ meters per second squared.\n- Angular accelerations: $\\alpha_1 = 0.0$, $\\alpha_2 = 0.0$, $\\alpha_3 = 0.0$ radians per second squared.\n- Distal contact on segment $3$: $\\mathbf{F}_{\\text{ext}}^{(3)} = (0.0,\\,0.0)$ Newtons, $M_{\\text{ext}}^{(3)} = 0.0$ Newton–meters.\n\nTest Case C (edge: zero gravity, moment-only distal load):\n- Gravity: $\\mathbf{g} = (0.0,\\,0.0)$ meters per second squared.\n- COM accelerations: $\\mathbf{a}_{C,1} = (0.10,\\,0.20)$, $\\mathbf{a}_{C,2} = (0.00,\\,0.10)$, $\\mathbf{a}_{C,3} = (-0.05,\\,0.00)$ meters per second squared.\n- Angular accelerations: $\\alpha_1 = 0.00$, $\\alpha_2 = 0.20$, $\\alpha_3 = 0.30$ radians per second squared.\n- Distal contact on segment $3$: $\\mathbf{F}_{\\text{ext}}^{(3)} = (0.0,\\,0.0)$ Newtons, $M_{\\text{ext}}^{(3)} = -15.0$ Newton–meters.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The output must be the list of three sublists, one per test case, in the order Test Case A, Test Case B, Test Case C. Each sublist must contain the three proximal net joint moments $[M_{p}^{(3)},M_{p}^{(2)},M_{p}^{(1)}]$ (in N·m), each rounded to three decimal places, with no spaces. For example, the printed string must have the form “[[m_{A,3},m_{A,2},m_{A,1}],[...],[...]]” where each $m_{A,i}$ is a float string with three decimal places.",
            "solution": "The problem requires the derivation and implementation of the recursive Newton-Euler equations for inverse dynamics of a planar $n$-segment serial chain. The goal is to compute the net joint moments at the proximal end of each segment, propagating calculations from the distal to the proximal end of the chain.\n\nThe derivation is founded upon Newton's Second Law for linear motion and Euler's equation for angular motion of a rigid body. Let us consider an arbitrary segment $s$ in the chain, where $s \\in \\{1, 2, \\dots, n\\}$.\n\nA free-body diagram of segment $s$ includes the following forces and moments:\n1.  $\\mathbf{F}_{p}^{(s)}$: The reaction force exerted by the proximal segment ($s-1$) on segment $s$ at the proximal joint $P_s$.\n2.  $\\mathbf{F}_{d}^{(s)}$: The reaction force exerted by the distal segment ($s+1$) on segment $s$ at the distal joint $D_s$.\n3.  $\\mathbf{F}_{g}^{(s)} = m_s \\mathbf{g}$: The gravitational force acting at the Center of Mass (COM).\n4.  $M_{p}^{(s)}$: The net joint moment exerted by the proximal segment ($s-1$) on segment $s$ about the proximal joint $P_s$.\n5.  $M_{d}^{(s)}$: The net joint moment exerted by the distal segment ($s+1$) on segment $s$ about the distal joint $D_s$.\n\nThe motion of the segment is described by its COM acceleration $\\mathbf{a}_{C,s}$ and its angular acceleration $\\alpha_s$.\n\nApplying Newton's Second Law to segment $s$:\n$$ \\sum \\mathbf{F}_s = \\mathbf{F}_{p}^{(s)} + \\mathbf{F}_{d}^{(s)} + m_s \\mathbf{g} = m_s \\mathbf{a}_{C,s} $$\nWe can rearrange this to solve for the proximal force $\\mathbf{F}_{p}^{(s)}$:\n$$ \\mathbf{F}_{p}^{(s)} = m_s (\\mathbf{a}_{C,s} - \\mathbf{g}) - \\mathbf{F}_{d}^{(s)} $$\n\nApplying Euler's equation for the sum of moments about the COM of segment $s$:\n$$ \\sum M_{C,s} = I_s \\alpha_s $$\nThe moments about the COM are generated by the joint reaction forces and the net joint moments. The gravitational force $\\mathbf{F}_{g}^{(s)}$ acts at the COM and thus creates no moment about it.\nLet $\\mathbf{r}_{PC,s}$ be the vector from the COM to the proximal joint $P_s$, and $\\mathbf{r}_{DC,s}$ be the vector from the COM to the distal joint $D_s$. The moment equation is:\n$$ M_{p}^{(s)} + M_{d}^{(s)} + (\\mathbf{r}_{PC,s} \\times \\mathbf{F}_{p}^{(s)}) + (\\mathbf{r}_{DC,s} \\times \\mathbf{F}_{d}^{(s)}) = I_s \\alpha_s $$\nThe 2D cross product is a scalar defined as $\\mathbf{r} \\times \\mathbf{F} = r_x F_y - r_y F_x$.\n\nTo establish a recursion, we use Newton's Third Law at the joint between segment $s$ and segment $s+1$ (which is joint $D_s = P_{s+1}$). The force and moment exerted by segment $s+1$ on segment $s$ are equal and opposite to those exerted by segment $s$ on segment $s+1$.\nThe force $\\mathbf{F}_{d}^{(s)}$ is the force from segment $s+1$ on $s$. The force $\\mathbf{F}_{p}^{(s+1)}$ is the force from segment $s$ on $s+1$. Therefore:\n$$ \\mathbf{F}_{d}^{(s)} = -\\mathbf{F}_{p}^{(s+1)} $$\nSimilarly, for the net joint moments:\n$$ M_{d}^{(s)} = -M_{p}^{(s+1)} $$\n\nSubstituting these relations into the equations of motion for segment $s$ yields the recursive formulas.\nThe force recursion:\n$$ \\mathbf{F}_{p}^{(s)} = m_s (\\mathbf{a}_{C,s} - \\mathbf{g}) - (-\\mathbf{F}_{p}^{(s+1)}) = m_s (\\mathbf{a}_{C,s} - \\mathbf{g}) + \\mathbf{F}_{p}^{(s+1)} $$\n\nThe moment recursion:\n$$ M_{p}^{(s)} - M_{p}^{(s+1)} + (\\mathbf{r}_{PC,s} \\times \\mathbf{F}_{p}^{(s)}) + (\\mathbf{r}_{DC,s} \\times (-\\mathbf{F}_{p}^{(s+1)})) = I_s \\alpha_s $$\nSolving for the proximal moment $M_{p}^{(s)}$:\n$$ M_{p}^{(s)} = M_{p}^{(s+1)} + I_s \\alpha_s - (\\mathbf{r}_{PC,s} \\times \\mathbf{F}_{p}^{(s)}) + (\\mathbf{r}_{DC,s} \\times \\mathbf{F}_{p}^{(s+1)}) $$\nNote that the calculation of $M_{p}^{(s)}$ requires $\\mathbf{F}_{p}^{(s)}$, which must be computed first in each step.\n\nThe recursion proceeds from the most distal segment, $s=n$, to the most proximal, $s=1$. We must first establish the equations for the base case, $s=n$. At the distal end of segment $n$, there is no segment $n+1$. Instead, there may be known external loads: a force $\\mathbf{F}_{\\text{ext}}^{(n)}$ applied at $D_n$ and a free moment $M_{\\text{ext}}^{(n)}$ about the COM.\nThe distal force on segment $n$ is thus $\\mathbf{F}_{d}^{(n)} = \\mathbf{F}_{\\text{ext}}^{(n)}$.\n\nApplying Newton's Second Law for segment $s=n$:\n$$ \\mathbf{F}_{p}^{(n)} + \\mathbf{F}_{\\text{ext}}^{(n)} + m_n \\mathbf{g} = m_n \\mathbf{a}_{C,n} $$\n$$ \\mathbf{F}_{p}^{(n)} = m_n (\\mathbf{a}_{C,n} - \\mathbf{g}) - \\mathbf{F}_{\\text{ext}}^{(n)} $$\n\nFor the moments about the COM of segment $n$, there is no distal joint moment $M_d^{(n)}$. Instead, the external free moment $M_{\\text{ext}}^{(n)}$ and the moment from the external force $\\mathbf{F}_{\\text{ext}}^{(n)}$ are applied.\n$$ M_{p}^{(n)} + (\\mathbf{r}_{PC,n} \\times \\mathbf{F}_{p}^{(n)}) + (\\mathbf{r}_{DC,n} \\times \\mathbf{F}_{\\text{ext}}^{(n)}) + M_{\\text{ext}}^{(n)} = I_n \\alpha_n $$\n$$ M_{p}^{(n)} = I_n \\alpha_n - M_{\\text{ext}}^{(n)} - (\\mathbf{r}_{PC,n} \\times \\mathbf{F}_{p}^{(n)}) - (\\mathbf{r}_{DC,n} \\times \\mathbf{F}_{\\text{ext}}^{(n)}) $$\n\nThe computational procedure is as follows:\n1.  **Base Case ($s=n$):**\n    a. Calculate the proximal force $\\mathbf{F}_{p}^{(n)}$ using the external force $\\mathbf{F}_{\\text{ext}}^{(n)}$ and the segment's motion.\n    b. Calculate the proximal moment $M_{p}^{(n)}$ using the external loads, $\\mathbf{F}_{p}^{(n)}$, and the segment's motion.\n2.  **Recursive Step (for $s = n-1, n-2, \\dots, 1$):**\n    a. The quantities $\\mathbf{F}_{p}^{(s+1)}$ and $M_{p}^{(s+1)}$ are known from the previous step (calculation on the more distal segment).\n    b. Calculate the proximal force $\\mathbf{F}_{p}^{(s)}$ using the recursive force equation.\n    c. Calculate the proximal moment $M_{p}^{(s)}$ using the recursive moment equation.\n3.  **Result:** The process yields the list of proximal net joint moments $[M_{p}^{(n)}, \\dots, M_{p}^{(1)}]$. For this problem, we compute $[M_{p}^{(3)}, M_{p}^{(2)}, M_{p}^{(1)}]$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements the recursive Newton-Euler inverse dynamics equations\n    for a 2D n-segment chain to calculate net joint moments.\n    \"\"\"\n\n    # Segment properties common to all test cases\n    # Indices 0, 1, 2 correspond to segments 1, 2, 3\n    n = 3\n    m = np.array([8.0, 4.0, 1.2])  # Masses m_1, m_2, m_3\n    I = np.array([0.20, 0.05, 0.01])  # Inertias I_1, I_2, I_3\n    r_pc = np.array([[0.0, 0.20], [0.0, 0.20], [-0.05, 0.03]])  # COM to Proximal joint vectors\n    r_dc = np.array([[0.0, -0.20], [0.0, -0.20], [0.15, -0.02]])  # COM to Distal joint vectors\n\n    test_cases = [\n        # Test Case A (general dynamic, distal contact)\n        {\n            \"g\": np.array([0.0, -9.81]),\n            \"a_c\": np.array([[0.50, 0.30], [0.80, 1.20], [0.20, 0.50]]),\n            \"alpha\": np.array([0.50, 1.00, -0.30]),\n            \"F_ext_n\": np.array([-50.0, 600.0]),\n            \"M_ext_n\": 10.0,\n        },\n        # Test Case B (boundary: zero accelerations, no distal contact)\n        {\n            \"g\": np.array([0.0, -9.81]),\n            \"a_c\": np.array([[0.0, 0.0], [0.0, 0.0], [0.0, 0.0]]),\n            \"alpha\": np.array([0.0, 0.0, 0.0]),\n            \"F_ext_n\": np.array([0.0, 0.0]),\n            \"M_ext_n\": 0.0,\n        },\n        # Test Case C (edge: zero gravity, moment-only distal load)\n        {\n            \"g\": np.array([0.0, 0.0]),\n            \"a_c\": np.array([[0.10, 0.20], [0.00, 0.10], [-0.05, 0.00]]),\n            \"alpha\": np.array([0.00, 0.20, 0.30]),\n            \"F_ext_n\": np.array([0.0, 0.0]),\n            \"M_ext_n\": -15.0,\n        }\n    ]\n\n    all_results = []\n\n    def cross_2d(r, F):\n        return r[0] * F[1] - r[1] * F[0]\n\n    for case in test_cases:\n        g = case[\"g\"]\n        a_c = case[\"a_c\"]\n        alpha = case[\"alpha\"]\n        F_ext_n = case[\"F_ext_n\"]\n        M_ext_n = case[\"M_ext_n\"]\n\n        # Storage for proximal forces and moments\n        # Python index i corresponds to segment s=i+1\n        F_p = np.zeros((n, 2))\n        M_p = np.zeros(n)\n        \n        # --- Start recursion from the most distal segment (s=n) ---\n        s_idx = n - 1 # Python index for segment n\n\n        # Calculate proximal force on segment n\n        F_p[s_idx] = m[s_idx] * (a_c[s_idx] - g) - F_ext_n\n\n        # Calculate proximal moment on segment n\n        M_p[s_idx] = (I[s_idx] * alpha[s_idx] - M_ext_n\n                      - cross_2d(r_pc[s_idx], F_p[s_idx])\n                      - cross_2d(r_dc[s_idx], F_ext_n))\n\n        # --- Propagate proximally for s = n-1, ..., 1 ---\n        for s_idx in range(n - 2, -1, -1):\n            s_plus_1_idx = s_idx + 1\n\n            # Proximal force from the next distal segment\n            F_p_s_plus_1 = F_p[s_plus_1_idx]\n            \n            # Proximal moment from the next distal segment\n            M_p_s_plus_1 = M_p[s_plus_1_idx]\n\n            # Calculate proximal force on segment s\n            F_p[s_idx] = m[s_idx] * (a_c[s_idx] - g) + F_p_s_plus_1\n\n            # Calculate proximal moment on segment s\n            M_p[s_idx] = (M_p_s_plus_1 + I[s_idx] * alpha[s_idx]\n                          - cross_2d(r_pc[s_idx], F_p[s_idx])\n                          + cross_2d(r_dc[s_idx], F_p_s_plus_1))\n\n        # The problem asks for [M_p^(3), M_p^(2), M_p^(1)]\n        # This corresponds to indices [2, 1, 0]\n        case_results = [M_p[2], M_p[1], M_p[0]]\n        all_results.append(case_results)\n\n    # Format the final output string as per requirements\n    output_str = \"[\" + \",\".join([f\"[{','.join([f'{m:.3f}' for m in res])}]\" for res in all_results]) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}