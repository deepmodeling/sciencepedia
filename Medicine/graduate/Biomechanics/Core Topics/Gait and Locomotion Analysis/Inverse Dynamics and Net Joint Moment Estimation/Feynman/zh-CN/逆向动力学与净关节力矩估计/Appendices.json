{
    "hands_on_practices": [
        {
            "introduction": "在掌握了如何计算单个力矩分量之后，下一步是将其整合进一个完整的理论框架中。这项练习要求你为单个刚体节段推导出完整的三维（3D）逆动力学方程。通过符号推导得出净关节力矩的最终表达式，可以深刻理解惯性项、外载荷、坐标系变换以及它们之间复杂的相互作用，这是连接理论与实际应用的关键一步。",
            "id": "4181289",
            "problem": "将一个刚性足段建模为在支撑期与地面相互作用的单个刚体。该段有一个固连于其质心并与其惯性主轴对齐的体固坐标系 $B$；一个惯性全局坐标系 $G$；以及一个位于解剖学踝关节中心的近端踝关节坐标系 $P$。设该段质心的位置为 $\\mathbf{r}_{C}^{G}(t)$，加速度为 $\\mathbf{a}_{C}^{G}(t)$，角速度为 $\\boldsymbol{\\omega}^{B}(t)$，角加速度为 $\\boldsymbol{\\alpha}^{B}(t)$。关于质心的惯性张量，在体固坐标系 $B$ 中表示为 $\\mathbf{I}_{C}^{B}$（恒定、对称、正定）。旋转矩阵为 $\\mathbf{R}_{GB}(t)$，它将分量从体固坐标系 $B$ 映射到惯性坐标系 $G$；以及 $\\mathbf{R}_{PG}(t)$，它将分量从惯性坐标系 $G$ 映射到近端关节坐标系 $P$。近端踝关节中心的位置为 $\\mathbf{r}_{p}^{G}(t)$，地面压力中心的位置为 $\\mathbf{r}_{\\mathrm{cop}}^{G}(t)$。\n\n地面在 $\\mathbf{r}_{\\mathrm{cop}}^{G}(t)$ 处施加一个地面反作用力 (GRF) $\\mathbf{f}_{\\mathrm{grf}}^{G}(t)$，并在压力中心周围施加一个自由力矩（有时称为扭转或摩擦自由力矩）$\\mathbf{m}_{\\mathrm{grf}}^{G}(t)$。重力作用为 $\\mathbf{g}^{G}$，假定在 $G$ 中为常数。足部质量为 $m$。踝关节处未知的内部净关节反作用力包括一个力 $\\mathbf{f}_{p}^{G}(t)$ 和一个作用于 $\\mathbf{r}_{p}^{G}(t)$ 的净踝关节力矩 $\\mathbf{m}_{p}^{G}(t)$。所有向量（例如 $\\mathbf{r}$、$\\mathbf{f}$、$\\mathbf{m}$、$\\boldsymbol{\\omega}$、$\\boldsymbol{\\alpha}$、$\\mathbf{g}$）都是三维的，并带有一个上标，表示其分量所在的坐标系。叉乘用 $\\times$ 表示，并在其参数上标所指示的坐标系内进行。使用国际单位制 (SI)；扭矩以牛顿-米表示。\n\n仅从刚体平动的牛顿第二定律和关于质心的欧拉转动方程出发，推导该单段模型中连接外部载荷、惯性项和内部关节反作用力的完整三维逆动力学关系。然后，系统地消去未知的近端关节反作用力 $\\mathbf{f}_{p}^{G}(t)$，以获得一个用近端关节坐标系 $P$ 表示的净踝关节力矩向量的单一闭式解析表达式。只提供在坐标系 $P$ 中的净踝关节力矩的最终表达式。\n\n您的最终答案必须是单一的解析表达式。不要在最终答案中提供中间步骤或方程。不需要四舍五入。您的最终表达式应与国际单位制（牛顿-米）一致，但不要在最终表达式中包含单位。",
            "solution": "问题陈述是经典刚体动力学在生物力学系统中的一次有效应用，符合既定的科学原理且提法得当。所有必要的量都已定义，且不存在矛盾。\n\n目标是通过将牛顿-欧拉方程应用于足部的单段模型，来推导净踝关节力矩向量 $\\mathbf{m}_{p}^{P}$ 的表达式。推导过程首先计算在全局惯性坐标系中的净关节力矩 $\\mathbf{m}_{p}^{G}$，然后将其变换到近端关节坐标系 $P$。\n\n一个直接而巧妙的方法来消去未知的近端关节反作用力 $\\mathbf{f}_{p}^{G}$，是对此力作用点（即踝关节中心 $\\mathbf{r}_{p}^{G}$）求力矩和。\n\n关于任意点 $P$ 的外力矩总和 $\\sum \\mathbf{M}_{P}^{G}$ 的一般方程由力矩的传递公式给出：\n$$ \\sum \\mathbf{M}_{P}^{G} = \\frac{d\\mathbf{H}_{C}^{G}}{dt} + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{P}^{G}) \\times m\\mathbf{a}_{C}^{G} $$\n其中 $\\frac{d\\mathbf{H}_{C}^{G}}{dt}$ 是关于质心 $C$ 的角动量变化率，$\\mathbf{r}_{C}^{G}$ 和 $\\mathbf{a}_{C}^{G}$ 是质心的位置和加速度，$\\mathbf{r}_{P}^{G}$ 是点 $P$ 的位置，$m$ 是刚体的质量。所有向量都在全局坐标系 $G$ 中表示。\n\n对于此问题，点 $P$ 是近端踝关节中心，因此 $\\mathbf{r}_{P}^{G}$ 被替换为 $\\mathbf{r}_{p}^{G}$。关于 $\\mathbf{r}_{p}^{G}$ 的外力矩有：\n$1$。未知的净踝关节力矩 $\\mathbf{m}_{p}^{G}$。\n$2$。由作用于压力中心 $\\mathbf{r}_{\\mathrm{cop}}^{G}$ 的地面反作用力 $\\mathbf{f}_{\\mathrm{grf}}^{G}$ 产生的力矩。该力矩为 $(\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G}$。\n$3$。地面反作用自由力矩 $\\mathbf{m}_{\\mathrm{grf}}^{G}$。\n$4$。由作用于质心 $\\mathbf{r}_{C}^{G}$ 的重力 $m\\mathbf{g}^{G}$ 产生的力矩。该力矩为 $(\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G}$。\n\n关节反作用力 $\\mathbf{f}_{p}^{G}$ 作用于 $\\mathbf{r}_{p}^{G}$，因此其关于该点的力矩为零。\n\n因此，外力矩的总和为：\n$$ \\sum \\mathbf{M}_{p}^{G} = \\mathbf{m}_{p}^{G} + (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} + \\mathbf{m}_{\\mathrm{grf}}^{G} + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} $$\n现在，我们将其与力矩传递公式中的惯性项相等：\n$$ \\mathbf{m}_{p}^{G} + (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} + \\mathbf{m}_{\\mathrm{grf}}^{G} + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} = \\frac{d\\mathbf{H}_{C}^{G}}{dt} + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{a}_{C}^{G} $$\n求解未知的关节力矩 $\\mathbf{m}_{p}^{G}$：\n$$ \\mathbf{m}_{p}^{G} = \\frac{d\\mathbf{H}_{C}^{G}}{dt} + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{a}_{C}^{G} - (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} - (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} - \\mathbf{m}_{\\mathrm{grf}}^{G} $$\n项 $\\frac{d\\mathbf{H}_{C}^{G}}{dt}$ 是关于质心的角动量变化率。最方便的计算方法是在体固坐标系 $B$ 中使用欧拉方程，其中惯性张量 $\\mathbf{I}_{C}^{B}$ 是恒定的，然后旋转到全局坐标系 $G$ 中。在坐标系 $B$ 中的欧拉方程为：\n$$ \\sum \\mathbf{M}_{C}^{B} = \\mathbf{I}_{C}^{B} \\boldsymbol{\\alpha}^{B} + \\boldsymbol{\\omega}^{B} \\times (\\mathbf{I}_{C}^{B} \\boldsymbol{\\omega}^{B}) $$\n右侧是相对于体固坐标系的角动量变化率。为了得到相对于惯性坐标系 $G$ 的变化率，我们使用旋转矩阵 $\\mathbf{R}_{GB}$ 将此向量变换到坐标系 $G$：\n$$ \\frac{d\\mathbf{H}_{C}^{G}}{dt} = \\mathbf{R}_{GB} \\left( \\mathbf{I}_{C}^{B} \\boldsymbol{\\alpha}^{B} + \\boldsymbol{\\omega}^{B} \\times (\\mathbf{I}_{C}^{B} \\boldsymbol{\\omega}^{B}) \\right) $$\n将此代入 $\\mathbf{m}_{p}^{G}$ 的表达式中：\n$$ \\mathbf{m}_{p}^{G} = \\mathbf{R}_{GB} \\left(\\mathbf{I}_{C}^{B} \\boldsymbol{\\alpha}^{B} + \\boldsymbol{\\omega}^{B} \\times (\\mathbf{I}_{C}^{B} \\boldsymbol{\\omega}^{B}) \\right) + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{a}_{C}^{G} - (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} - (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} - \\mathbf{m}_{\\mathrm{grf}}^{G} $$\n最后，问题要求净踝关节力矩在近端关节坐标系 $P$ 中表示。这需要使用给定的旋转矩阵 $\\mathbf{R}_{PG}$ 从坐标系 $G$ 变换到坐标系 $P$：\n$$ \\mathbf{m}_{p}^{P} = \\mathbf{R}_{PG} \\mathbf{m}_{p}^{G} $$\n代入 $\\mathbf{m}_{p}^{G}$ 的完整表达式，得到最终的闭式解析表达式：\n$$ \\mathbf{m}_{p}^{P} = \\mathbf{R}_{PG} \\left[ \\mathbf{R}_{GB} \\left(\\mathbf{I}_{C}^{B} \\boldsymbol{\\alpha}^{B} + \\boldsymbol{\\omega}^{B} \\times (\\mathbf{I}_{C}^{B} \\boldsymbol{\\omega}^{B}) \\right) + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{a}_{C}^{G} - (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} - (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} - \\mathbf{m}_{\\mathrm{grf}}^{G} \\right] $$\n这个表达式表示由跨越踝关节的肌肉、韧带和骨-骨接触力产生的净内力矩，它是根据该段的运动学和作用于其上的外力计算得出的。",
            "answer": "$$ \\boxed{ \\mathbf{R}_{PG} \\left[ \\mathbf{R}_{GB} \\left(\\mathbf{I}_{C}^{B} \\boldsymbol{\\alpha}^{B} + \\boldsymbol{\\omega}^{B} \\times \\left(\\mathbf{I}_{C}^{B} \\boldsymbol{\\omega}^{B}\\right) \\right) + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{a}_{C}^{G} - (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} - (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} - \\mathbf{m}_{\\mathrm{grf}}^{G} \\right] } $$"
        },
        {
            "introduction": "虽然三维模型最为精确，但在研究和临床实践中，二维（2D）简化模型因其便捷性而广泛使用。这项编程练习将理论付诸实践，要求你量化2D模型相对于3D模型的误差。通过亲手实现这两种模型并比较它们的计算结果，你将对忽略平面外动力学项（如陀螺效应和横向地面反作用力）所引入的误差大小有直观且定量的认识，从而能够批判性地评估不同模型的适用场景。",
            "id": "4181311",
            "problem": "您必须编写一个完整、可运行的程序，用于量化在生物力学中使用二维 (2D) 逆动力学时，忽略平面外运动和地面反作用力 (GRF) 横向平面分量对净关节力矩估算的影响。考虑支撑期的一个刚性足-小腿链段。使用一个右手实验室坐标系，其单位基向量为 $\\hat{\\mathbf{x}}$ (向前)、$\\hat{\\mathbf{y}}$ (内外侧向) 和 $\\hat{\\mathbf{z}}$ (向上)。矢状面由 $\\hat{\\mathbf{x}}$–$\\hat{\\mathbf{z}}$ 轴定义。我们关注的净关节力矩是绕膝关节或踝关节轴线的屈伸力矩，该轴线由于肢体偏航可能不与实验室坐标系的 $\\hat{\\mathbf{y}}$ 轴对齐。\n\n从以下基本原理开始：\n- 牛顿第二平移定律：$\\sum \\mathbf{F} = m \\mathbf{a}_{\\mathrm{com}}$，其中 $m$ 是质量，$\\mathbf{a}_{\\mathrm{com}}$ 是质心 (COM) 的加速度。\n- 绕任意固定点（关节中心）的刚体转动动力学（欧拉方程）：绕该关节的外部力矩矢量和等于该点的转动惯量和平动惯量贡献。令 $\\mathbf{I}$ 为实验室坐标系中的惯性张量，$\\boldsymbol{\\omega}$ 为角速度，$\\boldsymbol{\\alpha}$ 为角加速度。令 $\\mathbf{r}_{\\mathrm{com}}$ 为从关节中心到质心的位置矢量，$\\mathbf{r}_{\\mathrm{grf}}$ 为从关节中心到地面反作用力 (GRF) 压力中心 (COP) 的位置矢量，$\\mathbf{F}_{\\mathrm{grf}}$ 为 GRF 矢量，$\\mathbf{M}_{\\mathrm{free}}$ 为在 COP 处的 GRF 自由力矩矢量，$\\mathbf{F}_{g}$ 为作用在质心上的重力矢量。使用矢量叉乘 $\\times$ 和点乘 $\\cdot$ 运算符。\n\n任务：\n1. 使用上述定律和定义，计算绕关节中心的三维 (3D) 净关节力矩矢量。然后，通过将 3D 净关节力矩投影到单位矢量 $\\mathbf{u}_{y}$ 上来计算屈伸分量，该单位矢量是通过将实验室坐标系的 $\\hat{\\mathbf{y}}$ 轴绕 $\\hat{\\mathbf{z}}$ 轴旋转一个偏航角 $\\psi$ 得到的。偏航旋转定义为 $\\mathbf{u}_{y} = \\mathbf{R}_{z}(\\psi)\\,\\hat{\\mathbf{y}}$，其中 $\\mathbf{R}_{z}(\\psi)$ 是绕 $\\hat{\\mathbf{z}}$ 轴按右手规则旋转 $\\psi$ 弧度。\n2. 计算屈伸力矩的二维 (2D) 矢状面近似值，该近似值假设屈伸轴与实验室坐标系的 $\\hat{\\mathbf{y}}$ 轴对齐，忽略平面外角速度及其陀螺耦合效应，并且仅使用矢状面分量来计算平动惯量和 GRF 的贡献。\n3. 将误差大小报告为 3D 投影屈伸力矩与 2D 近似值之间的绝对差。\n\n定义：\n- 地面反作用力 (GRF) 是在足-地接触面上测量的外力。\n- 质心 (COM) 是链段的质量加权平均位置。\n- 压力中心 (COP) 是合地面反作用力在支撑面上的作用点。\n- 重力作用为 $\\mathbf{F}_{g} = m \\mathbf{g}$，其中 $\\mathbf{g} = (0, 0, -g)$ 且 $g = 9.81$。\n\n角度单位要求：所有角度必须以弧度为单位。物理单位要求：所有力矩必须以牛顿·米 (N·m) 为单位报告。您的程序必须计算每个测试用例的误差大小（单位：N·m），并将每个结果四舍五入到三位小数。\n\n实现说明：\n- 将惯性张量 $\\mathbf{I}$ 视为在实验室坐标系中对角的，其主惯量矩为 $(I_{xx}, I_{yy}, I_{zz})$。\n- 绕关节中心的 3D 净关节力矩应使用上述定律从第一性原理推导，包括陀螺项 $\\boldsymbol{\\omega} \\times (\\mathbf{I}\\boldsymbol{\\omega})$ 和平动惯量项 $\\mathbf{r}_{\\mathrm{com}} \\times (m \\mathbf{a}_{\\mathrm{com}})$。\n- 矢状面屈伸力矩的 2D 近似应忽略陀螺耦合，并将屈伸轴视为与 $\\hat{\\mathbf{y}}$ 完全对齐，仅使用力矩平衡的实验室坐标系 y 分量。\n\n测试套件：\n为以下四个步态试验参数集提供误差大小。所有矢量都在实验室坐标系中给出，所有量必须按规定使用。\n- 案例 1 (通用情况，小偏航角，轻微平面外运动):\n  - $m = 8.0$ $\\mathrm{kg}$。\n  - $(I_{xx}, I_{yy}, I_{zz}) = (0.08, 0.12, 0.10)$ $\\mathrm{kg\\cdot m^2}$。\n  - $\\mathbf{r}_{\\mathrm{com}} = (0.15, 0.00, -0.04)$ $\\mathrm{m}$。\n  - $\\mathbf{a}_{\\mathrm{com}} = (1.20, 0.10, 0.50)$ $\\mathrm{m/s^2}$。\n  - $\\mathbf{r}_{\\mathrm{grf}} = (0.20, 0.03, -0.02)$ $\\mathrm{m}$。\n  - $\\mathbf{F}_{\\mathrm{grf}} = (350.0, 15.0, 800.0)$ $\\mathrm{N}$。\n  - $\\mathbf{M}_{\\mathrm{free}} = (0.0, -5.0, 12.0)$ $\\mathrm{N\\cdot m}$。\n  - $\\boldsymbol{\\omega} = (1.50, 8.00, 0.80)$ $\\mathrm{rad/s}$。\n  - $\\boldsymbol{\\alpha} = (5.00, 12.00, -2.00)$ $\\mathrm{rad/s^2}$。\n  - $\\psi = 0.10$ $\\mathrm{rad}$。\n- 案例 2 (边界情况，完全平面运动，轴线对齐):\n  - $m = 6.0$ $\\mathrm{kg}$。\n  - $(I_{xx}, I_{yy}, I_{zz}) = (0.05, 0.09, 0.06)$ $\\mathrm{kg\\cdot m^2}$。\n  - $\\mathbf{r}_{\\mathrm{com}} = (0.13, 0.00, -0.03)$ $\\mathrm{m}$。\n  - $\\mathbf{a}_{\\mathrm{com}} = (0.80, 0.00, 0.40)$ $\\mathrm{m/s^2}$。\n  - $\\mathbf{r}_{\\mathrm{grf}} = (0.18, 0.00, -0.01)$ $\\mathrm{m}$。\n  - $\\mathbf{F}_{\\mathrm{grf}} = (300.0, 0.0, 750.0)$ $\\mathrm{N}$。\n  - $\\mathbf{M}_{\\mathrm{free}} = (0.0, -4.0, 0.0)$ $\\mathrm{N\\cdot m}$。\n  - $\\boldsymbol{\\omega} = (0.00, 7.50, 0.00)$ $\\mathrm{rad/s}$。\n  - $\\boldsymbol{\\alpha} = (0.00, 10.00, 0.00)$ $\\mathrm{rad/s^2}$。\n  - $\\psi = 0.00$ $\\mathrm{rad}$。\n- 案例 3 (边缘情况，大偏航角伴随强烈平面外角运动):\n  - $m = 7.5$ $\\mathrm{kg}$。\n  - $(I_{xx}, I_{yy}, I_{zz}) = (0.06, 0.11, 0.16)$ $\\mathrm{kg\\cdot m^2}$。\n  - $\\mathbf{r}_{\\mathrm{com}} = (0.16, 0.02, -0.05)$ $\\mathrm{m}$。\n  - $\\mathbf{a}_{\\mathrm{com}} = (1.00, 0.20, 0.60)$ $\\mathrm{m/s^2}$。\n  - $\\mathbf{r}_{\\mathrm{grf}} = (0.21, 0.04, -0.02)$ $\\mathrm{m}$。\n  - $\\mathbf{F}_{\\mathrm{grf}} = (320.0, 20.0, 780.0)$ $\\mathrm{N}$。\n  - $\\mathbf{M}_{\\mathrm{free}} = (0.0, -6.0, 15.0)$ $\\mathrm{N\\cdot m}$。\n  - $\\boldsymbol{\\omega} = (3.00, 9.00, 2.50)$ $\\mathrm{rad/s}$。\n  - $\\boldsymbol{\\alpha} = (2.00, 11.00, -3.00)$ $\\mathrm{rad/s^2}$。\n  - $\\psi = 0.5235987756$ $\\mathrm{rad}$。\n- 案例 4 (边缘情况，显著的侧向GRF和中等偏航角):\n  - $m = 6.8$ $\\mathrm{kg}$。\n  - $(I_{xx}, I_{yy}, I_{zz}) = (0.07, 0.10, 0.09)$ $\\mathrm{kg\\cdot m^2}$。\n  - $\\mathbf{r}_{\\mathrm{com}} = (0.14, -0.01, -0.04)$ $\\mathrm{m}$。\n  - $\\mathbf{a}_{\\mathrm{com}} = (0.90, -0.10, 0.50)$ $\\mathrm{m/s^2}$。\n  - $\\mathbf{r}_{\\mathrm{grf}} = (0.19, -0.04, -0.015)$ $\\mathrm{m}$。\n  - $\\mathbf{F}_{\\mathrm{grf}} = (310.0, 35.0, 770.0)$ $\\mathrm{N}$。\n  - $\\mathbf{M}_{\\mathrm{free}} = (0.0, -3.0, 20.0)$ $\\mathrm{N\\cdot m}$。\n  - $\\boldsymbol{\\omega} = (2.00, 8.50, 1.80)$ $\\mathrm{rad/s}$。\n  - $\\boldsymbol{\\alpha} = (1.50, 12.50, -2.20)$ $\\mathrm{rad/s^2}$。\n  - $\\psi = 0.20943951$ $\\mathrm{rad}$。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含四个测试用例的误差大小，格式为用方括号括起来的逗号分隔列表，每个值四舍五入到三位小数，单位为 N·m (例如, $[e_1,e_2,e_3,e_4]$)。",
            "solution": "该问题被评估为有效，因为它科学地基于刚体动力学原理，具有一组完整且一致的数据和定义，是适定的，并且直接关系到生物力学的核心课题。所提供的数值对于人类步态分析是物理上合理的。\n\n目标是量化一个简化的二维 (2D) 逆动力学模型与一个更完整的三维 (3D) 模型在估算屈伸净关节力矩时所引入的误差。该问题将分三个阶段解决：首先，推导完整的三维 (3D) 净关节力矩矢量，并将其投影到真实的屈伸轴上；其次，推导近似的二维 (2D) 屈伸力矩；第三，计算这两个量之间的绝对差。\n\n设关节中心为我们分析的原点 $O$。转动动力学的基本方程指出，绕某一点的所有力矩之和等于绕该点的角动量变化率。为了求得净关节力矩 $\\mathbf{M}_{\\mathrm{joint}}$，我们重新排列刚体的牛顿-欧拉方程。作用在链段上的外力矩（包括关节力矩）之和，等于链段角动量的变化。求解关节力矩的方程为：\n$$ \\mathbf{M}_{\\mathrm{joint}} = \\frac{d\\mathbf{H}_{\\mathrm{com}}}{dt} + \\mathbf{r}_{\\mathrm{com}} \\times (m \\mathbf{a}_{\\mathrm{com}}) - \\sum\\mathbf{M}_{\\mathrm{ext},O} $$\n其中 $\\mathbf{H}_{\\mathrm{com}}$ 是绕链段质心 (COM) 的角动量，$\\mathbf{r}_{\\mathrm{com}}$ 是从关节到 COM 的位置矢量，$m$ 是质量，$\\mathbf{a}_{\\mathrm{com}}$ 是 COM 的加速度，$\\sum\\mathbf{M}_{\\mathrm{ext},O}$ 是绕关节中心 $O$ 的所有外力矩（不包括关节力矩）之和。\n\n绕 COM 的角动量变化率由欧拉方程给出：\n$$ \\frac{d\\mathbf{H}_{\\mathrm{com}}}{dt} = \\mathbf{I}_{\\mathrm{com}} \\boldsymbol{\\alpha} + \\boldsymbol{\\omega} \\times (\\mathbf{I}_{\\mathrm{com}} \\boldsymbol{\\omega}) $$\n这里，$\\mathbf{I}_{\\mathrm{com}}$ 是绕 COM 的惯性张量（在问题描述中给出为 $\\mathbf{I}$），$\\boldsymbol{\\alpha}$ 是角加速度，$\\boldsymbol{\\omega}$ 是角速度。$\\boldsymbol{\\omega} \\times (\\mathbf{I}_{\\mathrm{com}} \\boldsymbol{\\omega})$ 项代表陀螺效应和离心效应。\n\n绕关节 $O$ 的外力矩来自地面反作用力 (GRF) 和重力：\n$$ \\sum\\mathbf{M}_{\\mathrm{ext},O} = (\\mathbf{r}_{\\mathrm{grf}} \\times \\mathbf{F}_{\\mathrm{grf}}) + \\mathbf{M}_{\\mathrm{free}} + (\\mathbf{r}_{\\mathrm{com}} \\times \\mathbf{F}_{g}) $$\n其中 $\\mathbf{r}_{\\mathrm{grf}}$ 是从关节到压力中心 (COP) 的位置矢量，$\\mathbf{F}_{\\mathrm{grf}}$ 是 GRF 矢量，$\\mathbf{M}_{\\mathrm{free}}$ 是 GRF 的自由力矩，$\\mathbf{F}_{g} = m\\mathbf{g}$ 是重力，其中 $\\mathbf{g} = (0, 0, -g)$ 且 $g=9.81 \\, \\mathrm{m/s^2}$。\n\n结合这些，我们得到完整三维净关节力矩矢量 $\\mathbf{M}_{\\mathrm{joint}, 3D}$ 的表达式：\n$$ \\mathbf{M}_{\\mathrm{joint}, 3D} = \\mathbf{I} \\boldsymbol{\\alpha} + \\boldsymbol{\\omega} \\times (\\mathbf{I} \\boldsymbol{\\omega}) + \\mathbf{r}_{\\mathrm{com}} \\times (m \\mathbf{a}_{\\mathrm{com}}) - (\\mathbf{r}_{\\mathrm{grf}} \\times \\mathbf{F}_{\\mathrm{grf}}) - \\mathbf{M}_{\\mathrm{free}} - (\\mathbf{r}_{\\mathrm{com}} \\times m\\mathbf{g}) $$\n问题将惯性张量 $\\mathbf{I}$ 定义为在实验室坐标系中对角的，即 $\\mathbf{I} = \\mathrm{diag}(I_{xx}, I_{yy}, I_{zz})$。\n\n屈伸力矩 $M_{3D,flex/ext}$ 是这个 3D 力矩矢量在真实屈伸轴上的投影，该轴由单位矢量 $\\mathbf{u}_{y}$ 定义。该轴线是通过将实验室坐标系的 $\\hat{\\mathbf{y}}=(0, 1, 0)$ 轴绕 $\\hat{\\mathbf{z}}$ 轴旋转一个偏航角 $\\psi$ 得到的：\n$$ \\mathbf{u}_{y} = \\mathbf{R}_{z}(\\psi)\\,\\hat{\\mathbf{y}} = \\begin{pmatrix} \\cos\\psi  -\\sin\\psi  0 \\\\ \\sin\\psi  \\cos\\psi  0 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -\\sin\\psi \\\\ \\cos\\psi \\\\ 0 \\end{pmatrix} $$\n然后使用点积计算投影力矩：\n$$ M_{3D,flex/ext} = \\mathbf{M}_{\\mathrm{joint}, 3D} \\cdot \\mathbf{u}_{y} $$\n\n接下来，我们构建二维矢状面近似 $M_{2D,flex/ext}$。这个近似做了几个简化假设：\n1. 屈伸轴与实验室坐标系的 $\\hat{\\mathbf{y}}$ 轴对齐 ($\\psi=0$)。\n2. 所有平面外的运动和力都被忽略。这意味着在叉乘中只考虑矢量的 $x$ 和 $z$ 分量。\n3. 陀螺效应和离心效应 $\\boldsymbol{\\omega} \\times (\\mathbf{I} \\boldsymbol{\\omega})$ 被忽略。\n\n这些假设将力矩计算简化为仅考虑其 $y$ 分量，只计入矢状面 ($x-z$) 动力学。二维力矩是简化力矩平衡的 $y$ 分量：\n$$ M_{2D,flex/ext} = (\\mathbf{I}\\boldsymbol{\\alpha})_y + (\\mathbf{r}_{\\mathrm{com}} \\times m\\mathbf{a}_{\\mathrm{com}})_y - (\\mathbf{r}_{\\mathrm{grf}} \\times \\mathbf{F}_{\\mathrm{grf}})_y - (\\mathbf{M}_{\\mathrm{free}})_y - (\\mathbf{r}_{\\mathrm{com}} \\times m\\mathbf{g})_y $$\n将二维假设应用于每一项：\n- 转动惯量：$(\\mathbf{I}\\boldsymbol{\\alpha})_y = I_{yy} \\alpha_y$。\n- 平动惯量：$(\\mathbf{r}_{\\mathrm{com, sag}} \\times m\\mathbf{a}_{\\mathrm{com, sag}})_y = m (r_{\\mathrm{com},z} a_{\\mathrm{com},x} - r_{\\mathrm{com},x} a_{\\mathrm{com},z})$。\n- GRF 力矩：$(\\mathbf{r}_{\\mathrm{grf, sag}} \\times \\mathbf{F}_{\\mathrm{grf, sag}})_y = r_{\\mathrm{grf},z} F_{\\mathrm{grf},x} - r_{\\mathrm{grf},x} F_{\\mathrm{grf},z}$。\n- 自由力矩：矢状面力矩就是 $y$ 分量 $M_{\\mathrm{free},y}$。\n- 重力力矩：$(\\mathbf{r}_{\\mathrm{com, sag}} \\times m\\mathbf{g})_y = m g r_{\\mathrm{com},x}$，因为 $\\mathbf{g}$ 没有 $x$ 或 $y$ 分量。\n\n组合二维方程：\n$$ M_{2D,flex/ext} = I_{yy} \\alpha_y + m(r_{\\mathrm{com},z} a_{\\mathrm{com},x} - r_{\\mathrm{com},x} a_{\\mathrm{com},z}) - (r_{\\mathrm{grf},z} F_{\\mathrm{grf},x} - r_{\\mathrm{grf},x} F_{\\mathrm{grf},z}) - M_{\\mathrm{free},y} - m g r_{\\mathrm{com},x} $$\n\n最后，每个测试用例的误差大小计算为 3D 推导力矩与其 2D 近似值之间的绝对差：\n$$ \\text{Error} = | M_{3D,flex/ext} - M_{2D,flex/ext} | $$\n所提供的测试案例将根据这些方程进行处理，以确定误差大小，该误差量化了二维分析中固有的简化假设所带来的影响。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the error in net joint moment estimation between a 3D model\n    and a simplified 2D model for four test cases.\n    \"\"\"\n    g_const = 9.81\n    g_vec = np.array([0.0, 0.0, -g_const])\n\n    test_cases = [\n        # Case 1\n        {\n            \"m\": 8.0, \"I_diag\": (0.08, 0.12, 0.10),\n            \"r_com\": (0.15, 0.00, -0.04), \"a_com\": (1.20, 0.10, 0.50),\n            \"r_grf\": (0.20, 0.03, -0.02), \"F_grf\": (350.0, 15.0, 800.0),\n            \"M_free\": (0.0, -5.0, 12.0),\n            \"omega\": (1.50, 8.00, 0.80), \"alpha\": (5.00, 12.00, -2.00),\n            \"psi\": 0.10\n        },\n        # Case 2\n        {\n            \"m\": 6.0, \"I_diag\": (0.05, 0.09, 0.06),\n            \"r_com\": (0.13, 0.00, -0.03), \"a_com\": (0.80, 0.00, 0.40),\n            \"r_grf\": (0.18, 0.00, -0.01), \"F_grf\": (300.0, 0.0, 750.0),\n            \"M_free\": (0.0, -4.0, 0.0),\n            \"omega\": (0.00, 7.50, 0.00), \"alpha\": (0.00, 10.00, 0.00),\n            \"psi\": 0.00\n        },\n        # Case 3\n        {\n            \"m\": 7.5, \"I_diag\": (0.06, 0.11, 0.16),\n            \"r_com\": (0.16, 0.02, -0.05), \"a_com\": (1.00, 0.20, 0.60),\n            \"r_grf\": (0.21, 0.04, -0.02), \"F_grf\": (320.0, 20.0, 780.0),\n            \"M_free\": (0.0, -6.0, 15.0),\n            \"omega\": (3.00, 9.00, 2.50), \"alpha\": (2.00, 11.00, -3.00),\n            \"psi\": 0.5235987756\n        },\n        # Case 4\n        {\n            \"m\": 6.8, \"I_diag\": (0.07, 0.10, 0.09),\n            \"r_com\": (0.14, -0.01, -0.04), \"a_com\": (0.90, -0.10, 0.50),\n            \"r_grf\": (0.19, -0.04, -0.015), \"F_grf\": (310.0, 35.0, 770.0),\n            \"M_free\": (0.0, -3.0, 20.0),\n            \"omega\": (2.00, 8.50, 1.80), \"alpha\": (1.50, 12.50, -2.20),\n            \"psi\": 0.20943951\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        m = case[\"m\"]\n        I_diag = np.array(case[\"I_diag\"])\n        r_com = np.array(case[\"r_com\"])\n        a_com = np.array(case[\"a_com\"])\n        r_grf = np.array(case[\"r_grf\"])\n        F_grf = np.array(case[\"F_grf\"])\n        M_free = np.array(case[\"M_free\"])\n        omega = np.array(case[\"omega\"])\n        alpha = np.array(case[\"alpha\"])\n        psi = case[\"psi\"]\n        \n        # --- 3D Calculation ---\n        I = np.diag(I_diag)\n\n        # Rate of change of angular momentum about COM\n        term_I_alpha = I @ alpha\n        term_gyro = np.cross(omega, I @ omega)\n        \n        # Translational inertia term expressed as a moment about the joint\n        term_trans_inertia = np.cross(r_com, m * a_com)\n        \n        # External moment terms about the joint\n        moment_grf = np.cross(r_grf, F_grf)\n        moment_gravity = np.cross(r_com, m * g_vec)\n        \n        # Total 3D net joint moment vector\n        M_joint_3D = (term_I_alpha + term_gyro + term_trans_inertia -\n                      moment_grf - M_free - moment_gravity)\n\n        # Flexion-extension axis unit vector\n        u_y = np.array([-np.sin(psi), np.cos(psi), 0.0])\n        \n        # Projected 3D flexion/extension moment\n        M_3D_flex_ext = np.dot(M_joint_3D, u_y)\n\n        # --- 2D Calculation ---\n        # Extract sagittal plane components (indices 0 and 2 for x and z)\n        Iyy = I_diag[1]\n        alpha_y = alpha[1]\n        \n        r_com_x, r_com_z = r_com[0], r_com[2]\n        a_com_x, a_com_z = a_com[0], a_com[2]\n        \n        r_grf_x, r_grf_z = r_grf[0], r_grf[2]\n        F_grf_x, F_grf_z = F_grf[0], F_grf[2]\n        \n        M_free_y = M_free[1]\n\n        # Assemble the 2D moment equation\n        term_I_alpha_2D = Iyy * alpha_y\n        term_trans_inertia_2D = m * (r_com_z * a_com_x - r_com_x * a_com_z)\n        moment_grf_2D = r_grf_z * F_grf_x - r_grf_x * F_grf_z\n        moment_gravity_2D = m * g_const * r_com_x\n        \n        M_2D_flex_ext = (term_I_alpha_2D + term_trans_inertia_2D -\n                         moment_grf_2D - M_free_y - moment_gravity_2D)\n        \n        # --- Error Calculation ---\n        error = abs(M_3D_flex_ext - M_2D_flex_ext)\n        results.append(round(error, 3))\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.3f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}