{
    "hands_on_practices": [
        {
            "introduction": "本练习将从基础入手，分离出逆动力学方程中最简单但至关重要的一个组成部分：由重力产生的力矩。通过从第一性原理推导这个力矩，你将巩固对力如何产生力矩以及符号约定关键作用的理解。这个练习是掌握更复杂动力学分析的基础。",
            "id": "4181307",
            "problem": "考虑站立姿势下小腿（shank）节段的准静态矢状面分析。将小腿视为一个质量为 $m$ 的刚体，其质心位于沿小腿方向距膝关节中心固定距离 $d$ 处。采用右手笛卡尔坐标系，其中向前方向为 $+x$ 轴，向上方向为 $+y$ 轴，膝关节屈伸轴为 $+z$ 轴，指向矢状面外。设从膝关节中心到小腿质心的位置向量与垂直方向成 $\\theta$ 角向后倾斜，因此 $\\theta>0$ 表示小腿中心线相对于 $+y$ 轴向后倾斜。重力作为均匀场，在 $-y$ 方向上产生一个大小为 $m g$ 的力。将膝关节处的正外部净关节力矩定义为倾向于增加膝关节屈曲的力矩，即在 $x$–$y$ 平面内对应于 $+z$ 方向的逆时针旋转。\n\n仅从牛顿定律和力对某点的力矩定义出发，推导因小腿重量产生的绕膝关节的重力力矩关于 $\\theta$ 的解析表达式。然后，对于 $m=3.9 \\text{ kg}$，$d=0.21 \\text{ m}$，$\\theta=20^{\\circ}$，$g=9.81 \\text{ m/s}^2$ 的特定姿势，计算膝关节的重力力矩。将最终数值结果四舍五入至四位有效数字。最终力矩以 $\\text{N}\\cdot\\text{m}$ 为单位，角度以度为单位。除了推导和计算，还需解释所选的符号约定如何决定重力力矩是屈曲力矩还是伸展力矩，以及在其他常见约定下该表达式的符号会如何变化，但要确保最终数值答案是根据上述约定计算的。",
            "solution": "该问题要求推导膝关节处重力力矩的表达式并进行数值计算。验证过程确认了该问题具有科学依据，提法明确，并包含了所有必要信息。\n\n由作用在相对于旋转点的位置 $\\vec{r}$ 处的力 $\\vec{F}$ 所产生的力矩 $\\vec{M}$，由叉积定义：\n$$\n\\vec{M} = \\vec{r} \\times \\vec{F}\n$$\n在本问题中，旋转点是膝关节中心，我们将其作为坐标系的原点 $O=(0,0,0)$。作用力是作用在小腿质心（CoM）上的重力。\n\n首先，我们定义从膝关节中心到小腿质心的位置向量 $\\vec{r}$。小腿质心距离膝关节 $d$。其方向由一个从垂直方向向后倾斜的角度 $\\theta$ 给出。坐标系定义为 $+y$ 轴代表向上（垂直）方向，$+x$ 轴代表向前方向。因此，向后方向对应于 $-x$ 轴。从垂直方向向后倾斜角度 $\\theta$ 意味着位置向量从 $+y$ 轴开始，向 $-x$ 轴方向旋转了角度 $\\theta$。\n\n因此，位置向量 $\\vec{r}$ 的分量为：\n$$\nr_x = -d \\sin(\\theta)\n$$\n$$\nr_y = d \\cos(\\theta)\n$$\n问题是在矢状面（$x$-$y$ 平面）内，所以 $z$ 分量为零。在定义的右手笛卡尔坐标系中（$\\hat{\\imath}$ 代表 $+x$，$\\hat{\\jmath}$ 代表 $+y$，$\\hat{k}$ 代表 $+z$），位置向量为：\n$$\n\\vec{r} = -d \\sin(\\theta) \\hat{\\imath} + d \\cos(\\theta) \\hat{\\jmath}\n$$\n\n接下来，我们定义重力向量 $\\vec{F}_g$。该力的大小为 $m g$，方向为负垂直方向（$-y$ 方向）。因此，力向量为：\n$$\n\\vec{F}_g = -mg \\hat{\\jmath}\n$$\n\n现在，我们可以通过计算 $\\vec{r}$ 和 $\\vec{F}_g$ 的叉积来计算绕膝关节的重力力矩 $\\vec{M}_g$：\n$$\n\\vec{M}_g = \\vec{r} \\times \\vec{F}_g = \\left( -d \\sin(\\theta) \\hat{\\imath} + d \\cos(\\theta) \\hat{\\jmath} \\right) \\times \\left( -mg \\hat{\\jmath} \\right)\n$$\n使用叉积的分配律：\n$$\n\\vec{M}_g = \\left( -d \\sin(\\theta) \\hat{\\imath} \\times -mg \\hat{\\jmath} \\right) + \\left( d \\cos(\\theta) \\hat{\\jmath} \\times -mg \\hat{\\jmath} \\right)\n$$\n我们使用单位向量的叉积性质：$\\hat{\\imath} \\times \\hat{\\jmath} = \\hat{k}$ 和 $\\hat{\\jmath} \\times \\hat{\\jmath} = \\vec{0}$。\n第二项变为零。第一项简化为：\n$$\n\\vec{M}_g = (-d \\sin(\\theta))(-mg)(\\hat{\\imath} \\times \\hat{\\jmath}) = mgd \\sin(\\theta) \\hat{k}\n$$\n这个向量表示由重力产生的力矩。问题定义正的外部净关节力矩倾向于增加膝关节屈曲，并对应于 $x$-$y$ 平面中的逆时针旋转，即 $+z$ 方向的力矩（由 $\\hat{k}$ 表示）。因此，与给定约定一致的重力力矩的标量表达式是 $\\vec{M}_g$ 的 $z$ 分量。\n\n推导出的绕膝关节的重力力矩的解析表达式为：\n$$\nM_g(\\theta) = mgd \\sin(\\theta)\n$$\n\n现在要求我们计算在 $m=3.9\\text{ kg}$，$d=0.21\\text{ m}$，$\\theta=20^{\\circ}$ 和 $g=9.81\\text{ m/s}^2$ 的特定情况下的该力矩。\n将这些值代入表达式中：\n$$\nM_g = (3.9\\text{ kg}) \\times (9.81\\text{ m/s}^2) \\times (0.21\\text{ m}) \\times \\sin(20^{\\circ})\n$$\n首先，我们计算各量值的乘积：\n$$\n(3.9) \\times (9.81) \\times (0.21) \\approx 8.03439~\\text{N}\\cdot\\text{m}\n$$\n接下来，我们计算角度的正弦值：\n$$\n\\sin(20^{\\circ}) \\approx 0.34202014\n$$\n将这些结果相乘得到力矩：\n$$\nM_g \\approx 8.03439 \\times 0.34202014 \\approx 2.74801~\\text{N}\\cdot\\text{m}\n$$\n将结果四舍五入至四位有效数字，我们得到：\n$$\nM_g = 2.748~\\text{N}\\cdot\\text{m}\n$$\n\n最后，我们讨论符号约定的作用。\n在问题的约定中，正力矩是屈曲力矩（逆时针，$+z$ 方向）。我们计算出的力矩 $M_g = mgd \\sin(\\theta)$ 在 $\\theta \\in (0, 180^{\\circ})$ 时为正，这涵盖了在此背景下所有物理上可能的小腿位置。因此，对于给定的向后倾斜（$\\theta=20^{\\circ}$），重力产生一个屈曲力矩。这是直观的，因为向后倾斜的小腿的重量会向下拉动它，倾向于使膝关节弯曲（屈曲）。在准静态条件下，这个重力屈曲力矩必须由一个内部伸展力矩（由股四头肌和韧带等产生）来抵消，以维持姿势。\n\n如果使用另一种常见的约定，即伸展力矩（顺时针，$-z$ 方向）定义为正，我们对力矩向量 $\\vec{M}_g = mgd \\sin(\\theta) \\hat{k}$ 的物理推导保持不变。然而，在这个新约定下，其标量值的表示将是 $M_{g, \\text{ext-pos}} = -mgd \\sin(\\theta)$。表达式的符号将会反转。\n\n如果角度的定义不同，例如，定义为从垂直方向向前倾斜，则位置向量将是 $\\vec{r} = +d \\sin(\\theta) \\hat{\\imath} + d \\cos(\\theta) \\hat{\\jmath}$。这将导致力矩 $\\vec{M}_g = -mgd \\sin(\\theta) \\hat{k}$，这是一个伸展力矩。这也很直观，因为向前倾斜的小腿的重量会倾向于使膝关节伸直（伸展）。坐标系的选择以及角度和正旋转方向的定义对于最终表达式及其解释至关重要。\n\n最终的数值计算严格基于问题陈述中提供的约定。",
            "answer": "$$\n\\boxed{2.748}\n$$"
        },
        {
            "introduction": "在理解了单个力矩的基础上，本练习将挑战你为一个刚体构建完整的动力学图景。你将推导完整的三维逆动力学方程，综合考虑惯性项、外力以及坐标系变换，以求解未知的净关节力矩。这是生物力学分析的理论基石。",
            "id": "4181289",
            "problem": "一个刚性足段被建模为在支撑相期间与地面相互作用的单个刚体。该足段有一个固定于其质心并与其惯性主轴对齐的体坐标系 $B$；一个惯性全局坐标系 $G$；以及一个位于解剖学踝关节中心的近端踝关节坐标系 $P$。设该足段质心的位置为 $\\mathbf{r}_{C}^{G}(t)$，加速度为 $\\mathbf{a}_{C}^{G}(t)$，角速度为 $\\boldsymbol{\\omega}^{B}(t)$，角加速度为 $\\boldsymbol{\\alpha}^{B}(t)$。关于质心的惯性张量，在体坐标系 $B$ 中表示为 $\\mathbf{I}_{C}^{B}$（恒定、对称、正定）。旋转矩阵为 $\\mathbf{R}_{GB}(t)$（将分量从体坐标系 $B$ 映射到惯性坐标系 $G$）和 $\\mathbf{R}_{PG}(t)$（将分量从惯性坐标系 $G$ 映射到近端关节坐标系 $P$）。近端踝关节中心的位置是 $\\mathbf{r}_{p}^{G}(t)$，地面压力中心的位置是 $\\mathbf{r}_{\\mathrm{cop}}^{G}(t)$。\n\n地面在 $\\mathbf{r}_{\\mathrm{cop}}^{G}(t)$ 处施加一个地面反作用力 (GRF) $\\mathbf{f}_{\\mathrm{grf}}^{G}(t)$，并围绕压力中心施加一个自由力矩（有时称为扭转或摩擦自由力矩）$\\mathbf{m}_{\\mathrm{grf}}^{G}(t)$。重力作用为 $\\mathbf{g}^{G}$，假定在 $G$ 中为常数。足的质量为 $m$。踝关节处未知的内部净关节反作用力由一个力 $\\mathbf{f}_{p}^{G}(t)$ 和一个施加在 $\\mathbf{r}_{p}^{G}(t)$ 处的净踝关节力矩 $\\mathbf{m}_{p}^{G}(t)$ 组成。所有向量（例如 $\\mathbf{r}$、$\\mathbf{f}$、$\\mathbf{m}$、$\\boldsymbol{\\omega}$、$\\boldsymbol{\\alpha}$、$\\mathbf{g}$）都是三维的，并带有一个上标，用以指明其分量所在的坐标系。叉乘用 $\\times$ 表示，并在其参数上标所指示的坐标系内进行。使用国际单位制（SI）；力矩以牛顿·米表示。\n\n仅从刚体平动的牛顿第二定律和关于质心的欧拉旋转方程出发，推导该单段模型中连接外部载荷、惯性项和内部关节反作用力的完整三维逆动力学关系。然后，系统地消去未知的近端关节反作用力 $\\mathbf{f}_{p}^{G}(t)$，以获得在近端关节坐标系 $P$ 中表示的净踝关节力矩向量的单一闭式解析表达式。仅提供在坐标系 $P$ 中的净踝关节力矩的最终表达式。\n\n您的最终答案必须是单一的解析表达式。最终答案中不要提供中间步骤或方程。不需要四舍五入。您的最终表达式应与国际单位制（牛顿·米）一致，但不要在最终表达式中包含单位。",
            "solution": "该问题陈述是经典刚体动力学在生物力学系统中的一个有效应用，符合既定的科学原理，且问题提法是适定的。所有必要的量都已定义，且不存在矛盾。\n\n目标是通过将牛顿-欧拉方程应用于足部的单段模型，来推导净踝关节力矩向量 $\\mathbf{m}_{p}^{P}$ 的表达式。推导过程首先计算在全局惯性坐标系中的净关节力矩 $\\mathbf{m}_{p}^{G}$，然后将其转换到近端关节坐标系 $P$。\n\n一个直接而巧妙的消除未知近端关节反作用力 $\\mathbf{f}_{p}^{G}$ 的方法是，对该力作用点（即踝关节中心 $\\mathbf{r}_{p}^{G}$）的力矩求和。\n\n关于任意点 $P$ 的外力矩之和 $\\sum \\mathbf{M}_{P}^{G}$ 的一般方程由力矩的传递公式给出：\n$$ \\sum \\mathbf{M}_{P}^{G} = \\frac{d\\mathbf{H}_{C}^{G}}{dt} + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{P}^{G}) \\times m\\mathbf{a}_{C}^{G} $$\n其中 $\\frac{d\\mathbf{H}_{C}^{G}}{dt}$ 是关于质心 $C$ 的角动量变化率，$\\mathbf{r}_{C}^{G}$ 和 $\\mathbf{a}_{C}^{G}$ 是质心的位置和加速度，$\\mathbf{r}_{P}^{G}$ 是点 $P$ 的位置， $m$ 是刚体的质量。所有向量都在全局坐标系 $G$ 中表示。\n\n对于本问题，点 $P$ 是近端踝关节中心，因此 $\\mathbf{r}_{P}^{G}$ 被替换为 $\\mathbf{r}_{p}^{G}$。关于 $\\mathbf{r}_{p}^{G}$ 的外力矩有：\n1. 未知的净踝关节力矩 $\\mathbf{m}_{p}^{G}$。\n2. 由作用在压力中心 $\\mathbf{r}_{\\mathrm{cop}}^{G}$ 的地面反作用力 $\\mathbf{f}_{\\mathrm{grf}}^{G}$ 产生的力矩。该力矩为 $(\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G}$。\n3. 地面反作用自由力矩 $\\mathbf{m}_{\\mathrm{grf}}^{G}$。\n4. 由作用在质心 $\\mathbf{r}_{C}^{G}$ 的重力 $m\\mathbf{g}^{G}$ 产生的力矩。该力矩为 $(\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G}$。\n\n关节反作用力 $\\mathbf{f}_{p}^{G}$ 作用于 $\\mathbf{r}_{p}^{G}$，因此其关于该点的力矩为零。\n\n因此，外力矩之和为：\n$$ \\sum \\mathbf{M}_{p}^{G} = \\mathbf{m}_{p}^{G} + (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} + \\mathbf{m}_{\\mathrm{grf}}^{G} + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} $$\n现在，我们将其与力矩传递公式中的惯性项相等：\n$$ \\mathbf{m}_{p}^{G} + (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} + \\mathbf{m}_{\\mathrm{grf}}^{G} + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} = \\frac{d\\mathbf{H}_{C}^{G}}{dt} + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{a}_{C}^{G} $$\n求解未知关节力矩 $\\mathbf{m}_{p}^{G}$：\n$$ \\mathbf{m}_{p}^{G} = \\frac{d\\mathbf{H}_{C}^{G}}{dt} + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{a}_{C}^{G} - (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} - (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} - \\mathbf{m}_{\\mathrm{grf}}^{G} $$\n项 $\\frac{d\\mathbf{H}_{C}^{G}}{dt}$ 是关于质心的角动量变化率。最方便的计算方法是在体坐标系 $B$ 中使用欧拉方程（其中惯性张量 $\\mathbf{I}_{C}^{B}$ 是常数），然后旋转到全局坐标系 $G$ 中。在坐标系 $B$ 中的欧拉方程是：\n$$ \\sum \\mathbf{M}_{C}^{B} = \\mathbf{I}_{C}^{B} \\boldsymbol{\\alpha}^{B} + \\boldsymbol{\\omega}^{B} \\times (\\mathbf{I}_{C}^{B} \\boldsymbol{\\omega}^{B}) $$\n等式右边是角动量相对于体坐标系的变化率。为了得到相对于惯性坐标系 $G$ 的变化率，我们使用旋转矩阵 $\\mathbf{R}_{GB}$ 将此向量转换到坐标系 $G$：\n$$ \\frac{d\\mathbf{H}_{C}^{G}}{dt} = \\mathbf{R}_{GB} \\left( \\mathbf{I}_{C}^{B} \\boldsymbol{\\alpha}^{B} + \\boldsymbol{\\omega}^{B} \\times (\\mathbf{I}_{C}^{B} \\boldsymbol{\\omega}^{B}) \\right) $$\n将此代入 $\\mathbf{m}_{p}^{G}$ 的表达式中：\n$$ \\mathbf{m}_{p}^{G} = \\mathbf{R}_{GB} \\left(\\mathbf{I}_{C}^{B} \\boldsymbol{\\alpha}^{B} + \\boldsymbol{\\omega}^{B} \\times (\\mathbf{I}_{C}^{B} \\boldsymbol{\\omega}^{B}) \\right) + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{a}_{C}^{G} - (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} - (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} - \\mathbf{m}_{\\mathrm{grf}}^{G} $$\n最后，问题要求净踝关节力矩在近端关节坐标系 $P$ 中表示。这需要使用给定的旋转矩阵 $\\mathbf{R}_{PG}$ 从坐标系 $G$ 转换到坐标系 $P$：\n$$ \\mathbf{m}_{p}^{P} = \\mathbf{R}_{PG} \\mathbf{m}_{p}^{G} $$\n代入 $\\mathbf{m}_{p}^{G}$ 的完整表达式，得到最终的闭式解析表达式：\n$$ \\mathbf{m}_{p}^{P} = \\mathbf{R}_{PG} \\left[ \\mathbf{R}_{GB} \\left(\\mathbf{I}_{C}^{B} \\boldsymbol{\\alpha}^{B} + \\boldsymbol{\\omega}^{B} \\times (\\mathbf{I}_{C}^{B} \\boldsymbol{\\omega}^{B}) \\right) + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{a}_{C}^{G} - (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} - (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} - \\mathbf{m}_{\\mathrm{grf}}^{G} \\right] $$\n该表达式代表了由跨越踝关节的肌肉、韧带和骨骼间接触力产生的净内力矩，该力矩是根据足段的运动学和作用于其上的外力计算得出的。",
            "answer": "$$ \\boxed{ \\mathbf{R}_{PG} \\left[ \\mathbf{R}_{GB} \\left(\\mathbf{I}_{C}^{B} \\boldsymbol{\\alpha}^{B} + \\boldsymbol{\\omega}^{B} \\times \\left(\\mathbf{I}_{C}^{B} \\boldsymbol{\\omega}^{B}\\right) \\right) + (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{a}_{C}^{G} - (\\mathbf{r}_{C}^{G} - \\mathbf{r}_{p}^{G}) \\times m\\mathbf{g}^{G} - (\\mathbf{r}_{\\mathrm{cop}}^{G} - \\mathbf{r}_{p}^{G}) \\times \\mathbf{f}_{\\mathrm{grf}}^{G} - \\mathbf{m}_{\\mathrm{grf}}^{G} \\right] } $$"
        },
        {
            "introduction": "真实的生物系统是由多个节段组成的链条。这个练习将单节段分析（如在  中推导的）扩展到一个完整的系统，通过开发和实现递归牛顿-欧拉算法。这种强大的方法让你能够通过将力和力矩从链条的末端（如足部）向更近端的关节传播，从而高效地计算出一系列关节的力矩。",
            "id": "4181295",
            "problem": "考虑一个由 $n$ 个刚体节段从近端到远端串联而成的平面二维(2D)链。每个节段 $s \\in \\{1,2,\\dots,n\\}$ 都有一个位于点 $P_s$ 的近端关节、一个位于点 $D_s$ 的远端关节、质量 $m_s$、绕其质心(COM)的平面转动惯量 $I_s$、质心加速度向量 $\\mathbf{a}_{C,s} \\in \\mathbb{R}^2$ 以及角加速度 $\\alpha_s \\in \\mathbb{R}$。重力加速度是一个恒定向量 $\\mathbf{g} \\in \\mathbb{R}^2$。对于每个节段 $s$，令 $\\mathbf{r}_{P C,s} \\in \\mathbb{R}^2$ 表示从质心到近端关节的位置向量，$\\mathbf{r}_{D C,s} \\in \\mathbb{R}^2$ 表示从质心到远端关节的位置向量。最后一个节段 $s=n$ 的远端可能受到一个已知的外部接触载荷，该载荷包括作用于 $D_n$ 的力向量 $\\mathbf{F}_{\\text{ext}}^{(n)} \\in \\mathbb{R}^2$ 和由该接触引起的绕质心的外部自由力矩 $M_{\\text{ext}}^{(n)} \\in \\mathbb{R}$。\n\n从力学基本定律出发，特别是 Newton 第二运动定律 ($\\sum \\mathbf{F} = m \\mathbf{a}$) 和 Euler 刚体转动方程 ($\\sum M = I \\alpha$)，推导出为整个链条将关节反作用力和净关节力矩从远端节段传播到近端节段的递推方程。您的推导必须使用以下符号约定：绕平面外轴的逆时针方向为正力矩，位置向量和力向量的二维叉积为标量 $r_x F_y - r_y F_x$。角度必须以弧度为单位处理。\n\n在推导出递推关系后，使用下面测试套件中提供的参数集，为 $n=3$ 个节段实现它。对于每个测试用例，您必须计算与节段 $s=3,2,1$ 的近端关节分别对应的近端净关节力矩的有序列表 $[M_{p}^{(3)},M_{p}^{(2)},M_{p}^{(1)}]$。每个力矩以牛顿·米 (N·m) 为单位表示，并四舍五入到三位小数。\n\n假设和约定：\n- 坐标系是固定的，$\\hat{\\mathbf{x}}$ 指向前（前方），$\\hat{\\mathbf{y}}$ 指向上（上方）。\n- 考虑的唯一外力是作用于每个节段质心的重力，以及对于最后一个节段 $s=n$，作用于 $D_n$ 的已知接触力 $\\mathbf{F}_{\\text{ext}}^{(n)}$。重力作用于质心，因此不产生绕质心的力矩。\n- 节段间关节的反作用力和净力矩以大小相等、方向相反的方式作用于每个相邻节段（Newton 第三定律），这使得从远端到近端的传播成为可能。\n\n测试套件（所有物理量均以国际单位制(SI)指定，角度以弧度为单位，最终力矩必须以 N·m 报告）：\n\n设 $n=3$。所有测试用例共有的节段属性：\n- 质量：$m_1 = 8.0$，$m_2 = 4.0$，$m_3 = 1.2$ 千克。\n- 转动惯量：$I_1 = 0.20$，$I_2 = 0.05$，$I_3 = 0.01$ 千克·米^2。\n- 质心到近端向量：$\\mathbf{r}_{P C,1} = (0.0,\\,0.20)$ 米，$\\mathbf{r}_{P C,2} = (0.0,\\,0.20)$ 米，$\\mathbf{r}_{P C,3} = (-0.05,\\,0.03)$ 米。\n- 质心到远端向量：$\\mathbf{r}_{D C,1} = (0.0,\\,-0.20)$ 米，$\\mathbf{r}_{D C,2} = (0.0,\\,-0.20)$ 米，$\\mathbf{r}_{D C,3} = (0.15,\\,-0.02)$ 米。\n\n测试用例 A（一般动态，远端接触）：\n- 重力：$\\mathbf{g} = (0.0,\\,-9.81)$ 米/秒^2。\n- 质心加速度：$\\mathbf{a}_{C,1} = (0.50,\\,0.30)$，$\\mathbf{a}_{C,2} = (0.80,\\,1.20)$，$\\mathbf{a}_{C,3} = (0.20,\\,0.50)$ 米/秒^2。\n- 角加速度：$\\alpha_1 = 0.50$，$\\alpha_2 = 1.00$，$\\alpha_3 = -0.30$ 弧度/秒^2。\n- 节段 3 上的远端接触：$\\mathbf{F}_{\\text{ext}}^{(3)} = (-50.0,\\,600.0)$ 牛顿，$M_{\\text{ext}}^{(3)} = 10.0$ 牛顿·米。\n\n测试用例 B（边界：零加速度，无远端接触）：\n- 重力：$\\mathbf{g} = (0.0,\\,-9.81)$ 米/秒^2。\n- 质心加速度：$\\mathbf{a}_{C,1} = (0.0,\\,0.0)$，$\\mathbf{a}_{C,2} = (0.0,\\,0.0)$，$\\mathbf{a}_{C,3} = (0.0,\\,0.0)$ 米/秒^2。\n- 角加速度：$\\alpha_1 = 0.0$，$\\alpha_2 = 0.0$，$\\alpha_3 = 0.0$ 弧度/秒^2。\n- 节段 3 上的远端接触：$\\mathbf{F}_{\\text{ext}}^{(3)} = (0.0,\\,0.0)$ 牛顿，$M_{\\text{ext}}^{(3)} = 0.0$ 牛顿·米。\n\n测试用例 C（边缘：零重力，仅力矩的远端载荷）：\n- 重力：$\\mathbf{g} = (0.0,\\,0.0)$ 米/秒^2。\n- 质心加速度：$\\mathbf{a}_{C,1} = (0.10,\\,0.20)$，$\\mathbf{a}_{C,2} = (0.00,\\,0.10)$，$\\mathbf{a}_{C,3} = (-0.05,\\,0.00)$ 米/秒^2。\n- 角加速度：$\\alpha_1 = 0.00$，$\\alpha_2 = 0.20$，$\\alpha_3 = 0.30$ 弧度/秒^2。\n- 节段 3 上的远端接触：$\\mathbf{F}_{\\text{ext}}^{(3)} = (0.0,\\,0.0)$ 牛顿，$M_{\\text{ext}}^{(3)} = -15.0$ 牛顿·米。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。输出必须是包含三个子列表的列表，每个子列表对应一个测试用例，顺序为测试用例 A、测试用例 B、测试用例 C。每个子列表必须包含三个近端净关节力矩 $[M_{p}^{(3)},M_{p}^{(2)},M_{p}^{(1)}]$（单位 N·m），每个力矩都四舍五入到三位小数，且无空格。例如，打印的字符串必须具有 `[[$m_{A,3}$,$m_{A,2}$,$m_{A,1}$],[...],[...]]` 的形式，其中每个 $m_{A,i}$ 是一个保留三位小数的浮点数字符串。",
            "solution": "该问题要求推导并实现用于平面 n 节段串联链逆动力学分析的递推 Newton-Euler 方程。目标是计算每个节段近端的净关节力矩，将计算从链的远端传播到近端。\n\n推导基于用于线性运动的 Newton 第二定律和用于刚体角运动的 Euler 方程。让我们考虑链中的任意节段 $s$，其中 $s \\in \\{1, 2, \\dots, n\\}$。\n\n节段 $s$ 的受力分析图包括以下力和力矩：\n1.  $\\mathbf{F}_{p}^{(s)}$: 近端节段 ($s-1$) 在近端关节 $P_s$ 处对节段 $s$ 施加的反作用力。\n2.  $\\mathbf{F}_{d}^{(s)}$: 远端节段 ($s+1$) 在远端关节 $D_s$ 处对节段 $s$ 施加的反作用力。\n3.  $\\mathbf{F}_{g}^{(s)} = m_s \\mathbf{g}$: 作用于质心 (COM) 的重力。\n4.  $M_{p}^{(s)}$: 近端节段 ($s-1$) 对节段 $s$ 施加的绕近端关节 $P_s$ 的净关节力矩。\n5.  $M_{d}^{(s)}$: 远端节段 ($s+1$) 对节段 $s$ 施加的绕远端关节 $D_s$ 的净关节力矩。\n\n节段的运动由其质心加速度 $\\mathbf{a}_{C,s}$ 和角加速度 $\\alpha_s$ 描述。\n\n对节段 $s$ 应用 Newton 第二定律：\n$$ \\sum \\mathbf{F}_s = \\mathbf{F}_{p}^{(s)} + \\mathbf{F}_{d}^{(s)} + m_s \\mathbf{g} = m_s \\mathbf{a}_{C,s} $$\n我们可以重新整理这个方程来求解近端力 $\\mathbf{F}_{p}^{(s)}$:\n$$ \\mathbf{F}_{p}^{(s)} = m_s (\\mathbf{a}_{C,s} - \\mathbf{g}) - \\mathbf{F}_{d}^{(s)} $$\n\n对节段 $s$ 应用关于质心的力矩求和的 Euler 方程：\n$$ \\sum M_{C,s} = I_s \\alpha_s $$\n绕质心的力矩由关节反作用力和净关节力矩产生。重力 $\\mathbf{F}_{g}^{(s)}$ 作用于质心，因此不产生绕质心的力矩。\n令 $\\mathbf{r}_{PC,s}$ 为从质心到近端关节 $P_s$ 的向量，$\\mathbf{r}_{DC,s}$ 为从质心到远端关节 $D_s$ 的向量。力矩方程为：\n$$ M_{p}^{(s)} + M_{d}^{(s)} + (\\mathbf{r}_{PC,s} \\times \\mathbf{F}_{p}^{(s)}) + (\\mathbf{r}_{DC,s} \\times \\mathbf{F}_{d}^{(s)}) = I_s \\alpha_s $$\n二维叉积是一个标量，定义为 $\\mathbf{r} \\times \\mathbf{F} = r_x F_y - r_y F_x$。\n\n为了建立递推关系，我们在节段 $s$ 和节段 $s+1$ 之间的关节（即关节 $D_s = P_{s+1}$）处使用 Newton 第三定律。节段 $s+1$ 施加于节段 $s$ 的力和力矩与节段 $s$ 施加于节段 $s+1$ 的力和力矩大小相等，方向相反。\n力 $\\mathbf{F}_{d}^{(s)}$ 是节段 $s+1$ 施加于 $s$ 的力。力 $\\mathbf{F}_{p}^{(s+1)}$ 是节段 $s$ 施加于 $s+1$ 的力。因此：\n$$ \\mathbf{F}_{d}^{(s)} = -\\mathbf{F}_{p}^{(s+1)} $$\n类似地，对于净关节力矩：\n$$ M_{d}^{(s)} = -M_{p}^{(s+1)} $$\n\n将这些关系代入节段 $s$ 的运动方程，得到递推公式。\n力递推：\n$$ \\mathbf{F}_{p}^{(s)} = m_s (\\mathbf{a}_{C,s} - \\mathbf{g}) - (-\\mathbf{F}_{p}^{(s+1)}) = m_s (\\mathbf{a}_{C,s} - \\mathbf{g}) + \\mathbf{F}_{p}^{(s+1)} $$\n\n力矩递推：\n$$ M_{p}^{(s)} - M_{p}^{(s+1)} + (\\mathbf{r}_{PC,s} \\times \\mathbf{F}_{p}^{(s)}) + (\\mathbf{r}_{DC,s} \\times (-\\mathbf{F}_{p}^{(s+1)})) = I_s \\alpha_s $$\n求解近端力矩 $M_{p}^{(s)}$:\n$$ M_{p}^{(s)} = M_{p}^{(s+1)} + I_s \\alpha_s - (\\mathbf{r}_{PC,s} \\times \\mathbf{F}_{p}^{(s)}) + (\\mathbf{r}_{DC,s} \\times \\mathbf{F}_{p}^{(s+1)}) $$\n注意，$M_{p}^{(s)}$ 的计算需要 $\\mathbf{F}_{p}^{(s)}$，而 $\\mathbf{F}_{p}^{(s)}$ 必须在每一步中首先计算。\n\n递推从最远端的节段 $s=n$ 进行到最近端的节段 $s=1$。我们必须首先为基本情况 $s=n$ 建立方程。在节段 $n$ 的远端，没有节段 $n+1$。取而代之的是，可能存在已知的外部载荷：一个作用于 $D_n$ 的力 $\\mathbf{F}_{\\text{ext}}^{(n)}$ 和一个绕质心的自由力矩 $M_{\\text{ext}}^{(n)}$。\n因此，作用于节段 $n$ 的远端力为 $\\mathbf{F}_{d}^{(n)} = \\mathbf{F}_{\\text{ext}}^{(n)}$。\n\n对节段 $s=n$ 应用 Newton 第二定律：\n$$ \\mathbf{F}_{p}^{(n)} + \\mathbf{F}_{\\text{ext}}^{(n)} + m_n \\mathbf{g} = m_n \\mathbf{a}_{C,n} $$\n$$ \\mathbf{F}_{p}^{(n)} = m_n (\\mathbf{a}_{C,n} - \\mathbf{g}) - \\mathbf{F}_{\\text{ext}}^{(n)} $$\n\n对于绕节段 $n$ 质心的力矩，不存在远端关节力矩 $M_d^{(n)}$。取而代之的是，施加了外部自由力矩 $M_{\\text{ext}}^{(n)}$ 和由外力 $\\mathbf{F}_{\\text{ext}}^{(n)}$ 产生的力矩。\n$$ M_{p}^{(n)} + (\\mathbf{r}_{PC,n} \\times \\mathbf{F}_{p}^{(n)}) + (\\mathbf{r}_{DC,n} \\times \\mathbf{F}_{\\text{ext}}^{(n)}) + M_{\\text{ext}}^{(n)} = I_n \\alpha_n $$\n$$ M_{p}^{(n)} = I_n \\alpha_n - M_{\\text{ext}}^{(n)} - (\\mathbf{r}_{PC,n} \\times \\mathbf{F}_{p}^{(n)}) - (\\mathbf{r}_{DC,n} \\times \\mathbf{F}_{\\text{ext}}^{(n)}) $$\n\n计算过程如下：\n1.  **基本情况 ($s=n$):**\n    a. 使用外力 $\\mathbf{F}_{\\text{ext}}^{(n)}$ 和节段的运动来计算近端力 $\\mathbf{F}_{p}^{(n)}$。\n    b. 使用外部载荷、$\\mathbf{F}_{p}^{(n)}$ 和节段的运动来计算近端力矩 $M_{p}^{(n)}$。\n2.  **递推步骤 (对于 $s = n-1, n-2, \\dots, 1$):**\n    a. 量 $\\mathbf{F}_{p}^{(s+1)}$ 和 $M_{p}^{(s+1)}$ 从上一步（对更远端节段的计算）中已知。\n    b. 使用力的递推方程计算近端力 $\\mathbf{F}_{p}^{(s)}$。\n    c. 使用力矩的递推方程计算近端力矩 $M_{p}^{(s)}$。\n3.  **结果:** 该过程产生近端净关节力矩的列表 $[M_{p}^{(n)}, \\dots, M_{p}^{(1)}]$。对于本问题，我们计算 $[M_{p}^{(3)}, M_{p}^{(2)}, M_{p}^{(1)}]$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements the recursive Newton-Euler inverse dynamics equations\n    for a 2D n-segment chain to calculate net joint moments.\n    \"\"\"\n\n    # Segment properties common to all test cases\n    # Indices 0, 1, 2 correspond to segments 1, 2, 3\n    n = 3\n    m = np.array([8.0, 4.0, 1.2])  # Masses m_1, m_2, m_3\n    I = np.array([0.20, 0.05, 0.01])  # Inertias I_1, I_2, I_3\n    r_pc = np.array([[0.0, 0.20], [0.0, 0.20], [-0.05, 0.03]])  # COM to Proximal joint vectors\n    r_dc = np.array([[0.0, -0.20], [0.0, -0.20], [0.15, -0.02]])  # COM to Distal joint vectors\n\n    test_cases = [\n        # Test Case A (general dynamic, distal contact)\n        {\n            \"g\": np.array([0.0, -9.81]),\n            \"a_c\": np.array([[0.50, 0.30], [0.80, 1.20], [0.20, 0.50]]),\n            \"alpha\": np.array([0.50, 1.00, -0.30]),\n            \"F_ext_n\": np.array([-50.0, 600.0]),\n            \"M_ext_n\": 10.0,\n        },\n        # Test Case B (boundary: zero accelerations, no distal contact)\n        {\n            \"g\": np.array([0.0, -9.81]),\n            \"a_c\": np.array([[0.0, 0.0], [0.0, 0.0], [0.0, 0.0]]),\n            \"alpha\": np.array([0.0, 0.0, 0.0]),\n            \"F_ext_n\": np.array([0.0, 0.0]),\n            \"M_ext_n\": 0.0,\n        },\n        # Test Case C (edge: zero gravity, moment-only distal load)\n        {\n            \"g\": np.array([0.0, 0.0]),\n            \"a_c\": np.array([[0.10, 0.20], [0.00, 0.10], [-0.05, 0.00]]),\n            \"alpha\": np.array([0.00, 0.20, 0.30]),\n            \"F_ext_n\": np.array([0.0, 0.0]),\n            \"M_ext_n\": -15.0,\n        }\n    ]\n\n    all_results = []\n\n    def cross_2d(r, F):\n        return r[0] * F[1] - r[1] * F[0]\n\n    for case in test_cases:\n        g = case[\"g\"]\n        a_c = case[\"a_c\"]\n        alpha = case[\"alpha\"]\n        F_ext_n = case[\"F_ext_n\"]\n        M_ext_n = case[\"M_ext_n\"]\n\n        # Storage for proximal forces and moments\n        # Python index i corresponds to segment s=i+1\n        F_p = np.zeros((n, 2))\n        M_p = np.zeros(n)\n        \n        # --- Start recursion from the most distal segment (s=n) ---\n        s_idx = n - 1 # Python index for segment n\n\n        # Calculate proximal force on segment n\n        F_p[s_idx] = m[s_idx] * (a_c[s_idx] - g) - F_ext_n\n\n        # Calculate proximal moment on segment n\n        M_p[s_idx] = (I[s_idx] * alpha[s_idx] - M_ext_n\n                      - cross_2d(r_pc[s_idx], F_p[s_idx])\n                      - cross_2d(r_dc[s_idx], F_ext_n))\n\n        # --- Propagate proximally for s = n-1, ..., 1 ---\n        for s_idx in range(n - 2, -1, -1):\n            s_plus_1_idx = s_idx + 1\n\n            # Proximal force from the next distal segment\n            F_p_s_plus_1 = F_p[s_plus_1_idx]\n            \n            # Proximal moment from the next distal segment\n            M_p_s_plus_1 = M_p[s_plus_1_idx]\n\n            # Calculate proximal force on segment s\n            F_p[s_idx] = m[s_idx] * (a_c[s_idx] - g) + F_p_s_plus_1\n\n            # Calculate proximal moment on segment s\n            M_p[s_idx] = (M_p_s_plus_1 + I[s_idx] * alpha[s_idx]\n                          - cross_2d(r_pc[s_idx], F_p[s_idx])\n                          + cross_2d(r_dc[s_idx], F_p_s_plus_1))\n\n        # The problem asks for [M_p^(3), M_p^(2), M_p^(1)]\n        # This corresponds to indices [2, 1, 0]\n        case_results = [M_p[2], M_p[1], M_p[0]]\n        all_results.append(case_results)\n\n    # Format the final output string as per requirements\n    output_str = \"[\" + \",\".join([f\"[{','.join([f'{m:.3f}' for m in res])}]\" for res in all_results]) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}