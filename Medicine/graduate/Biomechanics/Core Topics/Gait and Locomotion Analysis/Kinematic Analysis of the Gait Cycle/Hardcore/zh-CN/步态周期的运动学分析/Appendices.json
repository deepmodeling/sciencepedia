{
    "hands_on_practices": [
        {
            "introduction": "步态分析始于理解其基本的时间结构。通过识别足跟触地和足尖离地等关键事件，我们可以计算出描述行走节律与稳定性的重要参数。第一个练习  将训练你如何从带有时间戳的数据中计算支撑期时长、摆动期时长和占空比，并要求你从第一性原理出发，解释这些简单的时间指标如何与静态稳定性的核心概念相关联。",
            "id": "4184045",
            "problem": "一位研究人员正在使用标准事件定义来分析一种慢速、对称的双足步态：支撑相是特定肢体与地面接触的时间段，摆动相是该肢体不与地面接触的时间段，而特定肢体的步态周期（步幅）是指从一次同侧足跟着地到下一次同侧足跟着地之间的时间段。记录的左腿带时间戳的步态事件如下：左足跟着地时间为 $t = 0.00 \\text{ s}$、$t = 1.32 \\text{ s}$、$t = 2.64 \\text{ s}$ 和 $t = 3.96 \\text{ s}$；左足尖离地时间为 $t = 0.88 \\text{ s}$、$t = 2.21 \\text{ s}$ 和 $t = 3.53 \\text{ s}$。仅使用以下基本运动学定义：$T_{\\text{stance}}$ 为一个步幅内同侧足跟着地和同侧足尖离地之间的时间差，$T_{\\text{swing}}$ 为同侧足尖离地和下一次同侧足跟着地之间的时间差，以及 $T_{\\text{stride}}$ 为连续两次同侧足跟着地之间的时间差，计算前3个步幅中每一个的左腿支撑相和摆动相持续时间，以及相应的占空比（定义为步态周期中该肢体与地面接触的时间比例）。然后，计算这3个步幅的平均占空比。最后，从第一性原理出发，通过参考质心(COM)相对于支撑基(BoS)的投影以及双足支撑相的时间比例，解释在慢速双足步态中占空比如何与静态稳定裕度相关。\n\n所有持续时间以秒为单位表示，占空比以无量纲小数表示，最终数值答案仅报告平均占空比。将平均占空比四舍五入到4位有效数字。",
            "solution": "问题陈述已被解析和验证。所有给定的数据、定义和条件在科学上都是合理的、一致的且定义明确的。该问题是生物力学中的一个标准运动学分析。所提供的数据对于要求的计算是充分且符合实际的。因此，该问题被认为是有效的。\n\n解题过程分为两部分：第一部分是计算左腿前3个步幅的运动学参数，第二部分是解释占空比与静态稳定性之间的关系。\n\n**第一部分：运动学计算**\n\n问题提供了左腿带有时间戳的事件：\n左足跟着地 (LHS) 时间：$t_{LHS,1}=0.00 \\text{ s}$，$t_{LHS,2}=1.32 \\text{ s}$，$t_{LHS,3}=2.64 \\text{ s}$，$t_{LHS,4}=3.96 \\text{ s}$。\n左足尖离地 (LTO) 时间：$t_{LTO,1}=0.88 \\text{ s}$，$t_{LTO,2}=2.21 \\text{ s}$，$t_{LTO,3}=3.53 \\text{ s}$。\n\n一个步幅被定义为从一次同侧足跟着地到下一次同侧足跟着地的时间间隔。我们分析前3个步幅。\n\n**步幅 1：**\n该步幅始于 $t_{LHS,1} = 0.00 \\text{ s}$，止于 $t_{LHS,2} = 1.32 \\text{ s}$。\n步幅持续时间 $T_{\\text{stride},1}$ 为：\n$$T_{\\text{stride},1} = t_{LHS,2} - t_{LHS,1} = 1.32 \\text{ s} - 0.00 \\text{ s} = 1.32 \\text{ s}$$\n与此步幅对应的足尖离地事件是 $t_{LTO,1} = 0.88 \\text{ s}$。\n支撑相持续时间 $T_{\\text{stance},1}$ 是从足跟着地到足尖离地的时间：\n$$T_{\\text{stance},1} = t_{LTO,1} - t_{LHS,1} = 0.88 \\text{ s} - 0.00 \\text{ s} = 0.88 \\text{ s}$$\n摆动相持续时间 $T_{\\text{swing},1}$ 是从足尖离地到下一次足跟着地的时间：\n$$T_{\\text{swing},1} = t_{LHS,2} - t_{LTO,1} = 1.32 \\text{ s} - 0.88 \\text{ s} = 0.44 \\text{ s}$$\n作为检验，$T_{\\text{stride},1} = T_{\\text{stance},1} + T_{\\text{swing},1} = 0.88 \\text{ s} + 0.44 \\text{ s} = 1.32 \\text{ s}$，结果一致。\n此步幅的占空比 $DF_1$ 是步幅中用于支撑相的时间比例：\n$$DF_1 = \\frac{T_{\\text{stance},1}}{T_{\\text{stride},1}} = \\frac{0.88}{1.32} = \\frac{2}{3}$$\n\n**步幅 2：**\n该步幅始于 $t_{LHS,2} = 1.32 \\text{ s}$，止于 $t_{LHS,3} = 2.64 \\text{ s}$。\n步幅持续时间 $T_{\\text{stride},2}$ 为：\n$$T_{\\text{stride},2} = t_{LHS,3} - t_{LHS,2} = 2.64 \\text{ s} - 1.32 \\text{ s} = 1.32 \\text{ s}$$\n与此步幅对应的足尖离地事件是 $t_{LTO,2} = 2.21 \\text{ s}$。\n支撑相持续时间 $T_{\\text{stance},2}$ 为：\n$$T_{\\text{stance},2} = t_{LTO,2} - t_{LHS,2} = 2.21 \\text{ s} - 1.32 \\text{ s} = 0.89 \\text{ s}$$\n摆动相持续时间 $T_{\\text{swing},2}$ 为：\n$$T_{\\text{swing},2} = t_{LHS,3} - t_{LTO,2} = 2.64 \\text{ s} - 2.21 \\text{ s} = 0.43 \\text{ s}$$\n作为检验，$T_{\\text{stride},2} = T_{\\text{stance},2} + T_{\\text{swing},2} = 0.89 \\text{ s} + 0.43 \\text{ s} = 1.32 \\text{ s}$，结果一致。\n此步幅的占空比 $DF_2$ 为：\n$$DF_2 = \\frac{T_{\\text{stance},2}}{T_{\\text{stride},2}} = \\frac{0.89}{1.32}$$\n\n**步幅 3：**\n该步幅始于 $t_{LHS,3} = 2.64 \\text{ s}$，止于 $t_{LHS,4} = 3.96 \\text{ s}$。\n步幅持续时间 $T_{\\text{stride},3}$ 为：\n$$T_{\\text{stride},3} = t_{LHS,4} - t_{LHS,3} = 3.96 \\text{ s} - 2.64 \\text{ s} = 1.32 \\text{ s}$$\n与此步幅对应的足尖离地事件是 $t_{LTO,3} = 3.53 \\text{ s}$。\n支撑相持续时间 $T_{\\text{stance},3}$ 为：\n$$T_{\\text{stance},3} = t_{LTO,3} - t_{LHS,3} = 3.53 \\text{ s} - 2.64 \\text{ s} = 0.89 \\text{ s}$$\n摆动相持续时间 $T_{\\text{swing},3}$ 为：\n$$T_{\\text{swing},3} = t_{LHS,4} - t_{LTO,3} = 3.96 \\text{ s} - 3.53 \\text{ s} = 0.43 \\text{ s}$$\n作为检验，$T_{\\text{stride},3} = T_{\\text{stance},3} + T_{\\text{swing},3} = 0.89 \\text{ s} + 0.43 \\text{ s} = 1.32 \\text{ s}$，结果一致。\n此步幅的占空比 $DF_3$ 为：\n$$DF_3 = \\frac{T_{\\text{stance},3}}{T_{\\text{stride},3}} = \\frac{0.89}{1.32}$$\n\n**平均占空比：**\n3个步幅的平均占空比 $\\overline{DF}$ 是各独立占空比的算术平均值：\n$$\\overline{DF} = \\frac{DF_1 + DF_2 + DF_3}{3} = \\frac{1}{3} \\left( \\frac{0.88}{1.32} + \\frac{0.89}{1.32} + \\frac{0.89}{1.32} \\right)$$\n$$\\overline{DF} = \\frac{0.88 + 0.89 + 0.89}{3 \\times 1.32} = \\frac{2.66}{3.96}$$\n$$\\overline{DF} \\approx 0.671717...$$\n四舍五入到4位有效数字，平均占空比为 $0.6717$。\n\n**第二部分：占空比与静态稳定性**\n\n物体的静态稳定性要求其质心(COM)的垂直投影落在其支撑基(BoS)之内。对于双足步态，BoS的性质在整个步态周期中会发生变化。\n主要的支撑相包括单足支撑（一只脚在地上）和双足支撑（两只脚都在地上）。在单足支撑期间，BoS被限制在单只支撑脚的区域内，这个区域非常小。为了保持稳定，必须精确控制COM使其保持在这个小区域上方，这通常需要主动、动态的控制，而不是依赖被动、静态的稳定性。在双足支撑期间，BoS是双脚所覆盖区域的凸包，这个区域要大得多。一个大的BoS允许COM位置有更大的误差容限，从而提供高度的静态稳定性。\n\n占空比 $DF = T_{\\text{stance}}/T_{\\text{stride}}$，与双足支撑相的存在及其持续时间有根本性的关联。对于对称步态，对侧（例如，右侧）肢体的足跟着地发生在同侧（例如，左侧）肢体步态周期的50%处。如果当对侧肢体开始其支撑相时，同侧肢体仍处于其支撑相，则会出现双足支撑相。\n\n让我们将左腿的步幅持续时间归一化为1个时间单位，即$T_{\\text{stride}}=1$。左腿处于支撑相的持续时间为 $T_{\\text{stance}} = DF$。右腿在时间 $t=0.5$ 时触地并开始其支撑相。左腿的支撑相在时间 $t=DF$ 结束。如果右腿接触地面时左腿仍在地面上，则存在双足支撑期。这个条件在 $DF > 0.5$ 时满足。此双足支撑期的持续时间为 $T_{\\text{DS}_1} = DF - 0.5$。第二个双足支撑期发生在左腿摆动相结束时，增加了总的双足支撑时间。步态周期中用于双足支撑的总时间比例为 $2 \\times (DF - 0.5) = 2DF - 1$。\n\n这种关系为步态稳定性建立了一个清晰的层级：\n1.  如果 $DF > 0.5$，则 $2DF-1 > 0$，意味着存在非零的双足支撑期。这是行走的特征。该步态被认为具有正的静态稳定裕度，因为存在COM可以被定位在一个大的BoS内而无需动态控制的阶段。更大的 $DF$ 对应更长的双足支撑时间，因此具有更大的静态稳定裕度。计算出的 $\\overline{DF} \\approx 0.67$ 表明这是一种具有显著双足支撑时间的慢速行走。\n2.  如果 $DF = 0.5$，则 $2DF-1 = 0$，意味着没有双足支撑相。一只脚接触地面的瞬间，另一只脚就抬起。这是从行走到跑步的理论过渡点。该步态具有零静态稳定裕度，完全依赖于动态稳定性。\n3.  如果 $DF  0.5$，方程 $2DF-1$ 会得到一个负值，这表示没有双足支撑。相反，它表明存在一个腾空相，即双脚都不在地面上。这是跑步的特征。静态稳定性是不可能的，因为在腾空相期间BoS不存在。\n\n总之，从第一性原理来看，占空比直接量化了步态周期中用于支撑相的时间比例。对于对称的双足步态，大于0.5的占空比是存在双足支撑相的充分必要条件，而双足支撑相又提供了一个大的支撑基，并使得存在静态稳定期成为可能。因此，在慢速双足步态中，更高的占空比会导致更大的静态稳定裕度。",
            "answer": "$$\\boxed{0.6717}$$"
        },
        {
            "introduction": "精确的运动学分析有赖于严格定义的坐标系。在实际操作中，诸如步道之类的测量设备可能无法与实验室的全局坐标系完美对齐，从而在数据中引入系统误差。这个练习  将引导你通过第一性原理推导，来量化横断面上一个简单的未对准如何导致测量旋转角度时产生一个恒定的偏差，为实验误差分析提供了重要的一课。",
            "id": "4184070",
            "problem": "一个生物力学实验室使用一个步道，其局部坐标系 $W$ 旨在与实验室全局坐标系 $L$ 对齐，使得前进轴为 $X$ 轴，内外侧轴为 $Y$ 轴，垂直轴为 $Z$ 轴。在实践中，步道坐标系 $W$ 在横断面上存在未对准：其坐标轴是通过将全局坐标系 $L$ 绕 $Z$ 轴旋转一个恒定角度 $\\alpha$（绕 $+Z$ 的右手定则）得到的。一个刚体节段（例如，骨盆）在 $L$ 中的朝向由时变旋转矩阵 $R_{L}(t) \\in \\mathrm{SO}(3)$ 给出。实验室使用 $ZXY$ Cardan 序列报告横断面角度，其中横断面角度 $\\psi(t)$ 定义为 $R_{L}(t)$ 分解中绕 $Z$ 轴的第一次旋转，其测量的对应值 $\\tilde{\\psi}(t)$ 类似地定义为相对于未对准的步道坐标系 $W$ 表示的同一物理节段朝向的分解中绕 $Z$ 轴的第一次旋转。\n\n假设在步态周期的所有时间 $t$ 内，$-\\pi  \\psi(t)  \\pi$；$ZXY$ 分解在感兴趣的时间窗口内是唯一且无奇异点的；并且 $L$ 和 $W$ 之间的唯一区别是绕 $Z$ 轴的横断面未对准角度 $\\alpha$（即，$Z$ 轴在两个坐标系中是相同的）。使用第一性原理运动学（旋转矩阵、坐标系变换和 Cardan 角定义），推导由 $b(\\alpha) = \\tilde{\\psi}(t) - \\psi(t)$ 定义的系统偏差 $b(\\alpha)$，作为步道未对准角度 $\\alpha$ 的函数。以弧度表示您的最终解析表达式。无需进行数值计算。",
            "solution": "问题要求推导因测量坐标系未对准而导致的刚体节段横断面角度测量中的系统偏差。我们将使用涉及旋转矩阵和 Cardan 角分解的第一性原理运动学。\n\n首先，我们建立全局实验室坐标系（表示为 $L$）和未对准的步道坐标系（表示为 $W$）之间的关系。问题陈述，坐标系 $W$ 是通过将坐标系 $L$ 绕其公共 $Z$ 轴旋转一个恒定角度 $\\alpha$ 得到的。这描述了基向量的变换。设坐标系 $L$ 的基向量为 $\\{\\mathbf{e}_{L,x}, \\mathbf{e}_{L,y}, \\mathbf{e}_{L,z}\\}$，坐标系 $W$ 的基向量为 $\\{\\mathbf{e}_{W,x}, \\mathbf{e}_{W,y}, \\mathbf{e}_{W,z}\\}$。将坐标系绕 $Z$ 轴旋转角度 $\\alpha$ 意味着，当用旧坐标系的坐标表示时，新的基向量由以下公式给出：\n$$ \\mathbf{e}_{W,x} = \\cos(\\alpha)\\mathbf{e}_{L,x} + \\sin(\\alpha)\\mathbf{e}_{L,y} $$\n$$ \\mathbf{e}_{W,y} = -\\sin(\\alpha)\\mathbf{e}_{L,x} + \\cos(\\alpha)\\mathbf{e}_{L,y} $$\n$$ \\mathbf{e}_{W,z} = \\mathbf{e}_{L,z} $$\n将向量坐标从坐标系 $W$ 变换到坐标系 $L$ 的旋转矩阵，我们可表示为 $R_{L \\leftarrow W}$，其列是坐标系 $W$ 在坐标系 $L$ 中表示的基向量。\n$$ R_{L \\leftarrow W} = \\begin{pmatrix} \\cos(\\alpha)  -\\sin(\\alpha)  0 \\\\ \\sin(\\alpha)  \\cos(\\alpha)  0 \\\\ 0  0  1 \\end{pmatrix} = R_Z(\\alpha) $$\n此处，$R_Z(\\alpha)$ 表示绕 $Z$ 轴旋转角度 $\\alpha$。\n\n反之，将坐标从坐标系 $L$ 变换到坐标系 $W$ 的旋转矩阵，表示为 $R_{W \\leftarrow L}$，是 $R_{L \\leftarrow W}$ 的逆矩阵。\n$$ R_{W \\leftarrow L} = (R_{L \\leftarrow W})^{-1} = (R_Z(\\alpha))^{-1} = R_Z(-\\alpha) = \\begin{pmatrix} \\cos(\\alpha)  \\sin(\\alpha)  0 \\\\ -\\sin(\\alpha)  \\cos(\\alpha)  0 \\\\ 0  0  1 \\end{pmatrix} $$\n\n刚体节段的朝向由一个时变旋转矩阵给出。让我们将该节段的物体固定坐标系表示为 $B$。该节段在全局坐标系 $L$ 中的朝向由矩阵 $R_L(t)$ 给出，它将坐标从坐标系 $B$ 变换到坐标系 $L$，即 $R_{L \\leftarrow B}(t)$。类似地，该节段在步道坐标系 $W$ 中的朝向由 $R_W(t) = R_{W \\leftarrow B}(t)$ 给出。\n\n这些朝向矩阵之间的关系可以通过复合变换找到。物体坐标系中的一个向量 $\\mathbf{v}_B$ 变换到实验室坐标系为 $\\mathbf{v}_L = R_L(t) \\mathbf{v}_B$。同一个向量在步道坐标系中的坐标是 $\\mathbf{v}_W = R_{W \\leftarrow L} \\mathbf{v}_L$。代入 $\\mathbf{v}_L$ 的表达式，我们得到：\n$$ \\mathbf{v}_W = R_{W \\leftarrow L} (R_L(t) \\mathbf{v}_B) = (R_{W \\leftarrow L} R_L(t)) \\mathbf{v}_B $$\n根据定义，我们也有 $\\mathbf{v}_W = R_W(t) \\mathbf{v}_B$。因为这对任何向量 $\\mathbf{v}_B$ 都必须成立，我们推导出朝向矩阵之间的关系：\n$$ R_W(t) = R_{W \\leftarrow L} R_L(t) $$\n代入 $R_{W \\leftarrow L}$ 的表达式：\n$$ R_W(t) = R_Z(-\\alpha) R_L(t) $$\n\n问题陈述，横断面角度 $\\psi(t)$ 和 $\\tilde{\\psi}(t)$ 是从一个 $ZXY$ Cardan 序列分解中获得的。\n对于在全局坐标系 $L$ 中的朝向，其分解为：\n$$ R_L(t) = R_Z(\\psi(t)) R_X(\\theta(t)) R_Y(\\phi(t)) $$\n其中 $\\psi(t)$ 是我们感兴趣的角度。\n\n对于在步道坐标系 $W$ 中的朝向，其分解为：\n$$ R_W(t) = R_Z(\\tilde{\\psi}(t)) R_X(\\tilde{\\theta}(t)) R_Y(\\tilde{\\phi}(t)) $$\n其中 $\\tilde{\\psi}(t)$ 是测量的角度。\n\n现在，我们将这些分解代入矩阵关系式 $R_W(t) = R_Z(-\\alpha) R_L(t)$：\n$$ R_Z(\\tilde{\\psi}(t)) R_X(\\tilde{\\theta}(t)) R_Y(\\tilde{\\phi}(t)) = R_Z(-\\alpha) \\left[ R_Z(\\psi(t)) R_X(\\theta(t)) R_Y(\\phi(t)) \\right] $$\n绕同一轴的旋转是可交换的，它们的角度相加。因此，$R_Z(-\\alpha) R_Z(\\psi(t)) = R_Z(\\psi(t) - \\alpha)$。方程变为：\n$$ R_Z(\\tilde{\\psi}(t)) R_X(\\tilde{\\theta}(t)) R_Y(\\tilde{\\phi}(t)) = R_Z(\\psi(t) - \\alpha) R_X(\\theta(t)) R_Y(\\phi(t)) $$\n该方程显示了同一朝向矩阵的两种不同的 $ZXY$ Cardan 参数化。问题明确指出“$ZXY$ 分解在感兴趣的时间窗口内是唯一且无奇异点的”。这种唯一性允许我们直接将序列中对应的角度等同起来。通过比较等式左右两边，我们发现：\n$$ \\tilde{\\psi}(t) = \\psi(t) - \\alpha $$\n$$ \\tilde{\\theta}(t) = \\theta(t) $$\n$$ \\tilde{\\phi}(t) = \\phi(t) $$\n系统偏差定义为 $b(\\alpha) = \\tilde{\\psi}(t) - \\psi(t)$。使用推导出的第一个等式：\n$$ b(\\alpha) = (\\psi(t) - \\alpha) - \\psi(t) $$\n$$ b(\\alpha) = -\\alpha $$\n该偏差是一个恒定值，等于步道未对准角度的负值。此结果与时间 $t$ 以及其他朝向角 $\\theta(t)$ 和 $\\phi(t)$ 无关，证实了它是一个系统偏差。该表达式以角度 $\\alpha$ 给出，根据标准科学惯例和题目的指示，假定其单位为弧度。",
            "answer": "$$ \\boxed{-\\alpha} $$"
        },
        {
            "introduction": "现代生物力学在很大程度上依赖于处理连续的运动学数据流，以识别离散且有意义的事件和阶段。最后的这个练习  将从理论走向应用，要求你设计并实现一个基于规则的算法，以自动检测步态中的足平放期和支撑中期。通过将生物力学的定义转化为一个计算分类器，你将在步态分析研究的一项核心任务中获得实践经验。",
            "id": "4184123",
            "problem": "设计并实现一个确定性的、基于规则的运动学分类器，该分类器仅使用足部俯仰角 $\\theta_f(t)$ 和小腿角速度 $\\omega_s(t)$ 来识别支撑相内的两个子阶段：足平放（foot-flat）和支撑中期（midstance）。该分类器必须在离散、均匀采样的时间序列 $\\{\\theta_f[k]\\}_{k=0}^{K-1}$ 和 $\\{\\omega_s[k]\\}_{k=0}^{K-1}$ 上运行，采样周期 $\\Delta t$ 为常数。角度必须以弧度表示，角速度以弧度/秒表示，时间以秒表示。模型必须基于生物力学和运动学的第一性原理进行论证，但实现必须纯粹依赖于所提供的运动学信号和下述明确规则，不得引用任何外部背景。\n\n您必须实现以下基于运动学定义的检测规则，以定位足平放和支撑中期的最早开始时间（在一个支撑相区间内）：\n\n- 足平放开始：最早的时间索引 $k_{\\text{FF}}$，在该索引开始的至少 $N_{\\text{flat}}$ 个样本的连续驻留期间，以下两个条件同时成立：\n  1. $|\\theta_f[k]| \\le \\theta_{\\text{tol}}$，且\n  2. $|\\omega_s[k]| \\le \\omega_{\\text{flat}}$。\n  \n- 支撑中期开始：最早的时间索引 $k_{\\text{MS}}  k_{\\text{FF}}$，在该索引开始的至少 $N_{\\text{mid}}$ 个样本的连续驻留期间，以下两个条件同时成立：\n  1. $|\\theta_f[k]| \\le \\theta_{\\text{tol}}$，且\n  2. $\\omega_s[k] \\ge \\omega_{\\text{mid}}$。\n\n如果某个请求的阶段不存在这样的索引，则为该阶段返回 $-1$。将检测到的索引转换为时间 $t_{\\text{FF}} = k_{\\text{FF}} \\Delta t$ 和 $t_{\\text{MS}} = k_{\\text{MS}} \\Delta t$。驻留样本数必须根据指定的驻留时长和采样周期计算得出，即 $N_{\\text{flat}} = \\lceil \\Delta t_{\\text{flat}} / \\Delta t \\rceil$ 和 $N_{\\text{mid}} = \\lceil \\Delta t_{\\text{mid}} / \\Delta t \\rceil$。\n\n在所有测试中请使用以下常量：\n- 角度容差：$\\theta_{\\text{tol}} = 0.087266$ 弧度。\n- 足平放驻留时长：$\\Delta t_{\\text{flat}} = 0.04$ 秒。\n- 支撑中期驻留时长：$\\Delta t_{\\text{mid}} = 0.06$ 秒。\n- 足平放时的小腿低速边界：$\\omega_{\\text{flat}} = 0.2$ 弧度/秒。\n- 支撑中期的小腿前进边界：$\\omega_{\\text{mid}} = 0.5$ 弧度/秒。\n\n实现您的程序以评估以下测试套件。在所有测试中，使用采样频率 $f_s = 100$ 赫兹，采样周期 $\\Delta t = 1/f_s = 0.01$ 秒，总时长 $T = 1.0$ 秒，以及离散时间戳 $t_k = k \\Delta t$，其中 $k \\in \\{0,1,\\dots,99\\}$：\n\n- 测试 1（小腿速度递增的一般进程）：\n  - $\\theta_f(t) = 0.12 \\exp(-t/0.1) - 0.005$ 对于 $t \\in [0,T)$。\n  - $\\omega_s(t) = \\begin{cases}\n    0.0,  t  0.20 \\\\\n    0.1 + \\dfrac{0.7}{0.15}(t - 0.20),  0.20 \\le t  0.35 \\\\\n    0.8,  t \\ge 0.35\n  \\end{cases}$\n\n- 测试 2（在支撑中期阈值处的边界驻留；早期足平放）：\n  - $\\theta_f(t) = 0.05$ 对所有 $t$。\n  - $\\omega_s(t) = \\begin{cases}\n    0.0,  t  0.30 \\\\\n    0.5,  0.30 \\le t  0.36 \\\\\n    0.49,  t \\ge 0.36\n  \\end{cases}$\n\n- 测试 3（无支撑中期；可检测到足平放）：\n  - $\\theta_f(t) = 0.02$ 对所有 $t$。\n  - $\\omega_s(t) = 0.15$ 对所有 $t$。\n\n- 测试 4（无足平放；因足部不平而无支撑中期）：\n  - $\\theta_f(t) = 0.15$ 对所有 $t$。\n  - $\\omega_s(t) = 0.6$ 对所有 $t$。\n\n- 测试 5（晚期足平放后接明确的支撑中期）：\n  - $\\theta_f(t) = 0.2 \\exp(-t/0.5)$ 对于 $t \\in [0,T)$。\n  - $\\omega_s(t) = \\begin{cases}\n    0.1,  t  0.60 \\\\\n    0.7,  t \\ge 0.60\n  \\end{cases}$\n\n对于每个测试，计算 $(t_{\\text{FF}}, t_{\\text{MS}})$（单位：秒）。将每个时间报告为四舍五入到三位小数的浮点数。如果未检测到某个阶段，则该条目报告为 $-1$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素本身是按上述顺序排列的针对一个测试的双元素列表，例如：$[\\,[t_{\\text{FF},1},t_{\\text{MS},1}],\\,[t_{\\text{FF},2},t_{\\text{MS},2}],\\,\\dots\\,]$。最终的数值必须以秒为单位，并四舍五入到三位小数。",
            "solution": "设计用于步态子阶段的运动学分类器的问题是有效的。它在生物力学上有科学依据，在数学上是适定的，并且所有参数和规则都已明确无误地指定。在简化的步态模型背景下，所提供的测试用例在物理上是合理的。因此，我们可以着手解决。\n\n### 1. 基于原理的设计\n\n任务是仅使用足部俯仰角 $\\theta_f(t)$ 和小腿角速度 $\\omega_s(t)$ 来识别人类步态支撑期中的两个关键子阶段的开始：足平放（foot-flat）和支撑中期（midstance）。\n\n- **足平放（FF）：** 该阶段的生物力学特征是足部近似水平且相对于地面静止。在承重反应阶段向后旋转（负角速度）的小腿，其旋转速度减慢至接近于零。分类规则将此形式化：\n    1.  足部俯仰角接近于零：$|\\theta_f(t)| \\le \\theta_{\\text{tol}}$。这捕捉了足部的“平放”姿态。\n    2.  小腿角速度很低：$|\\omega_s(t)| \\le \\omega_{\\text{flat}}$。这反映了当身体质心经过踝关节时小腿旋转最小的时刻。\n- **支撑中期（MS）：** 该阶段跟随足平放阶段，其特征是小腿在静止的足部上方向前推进。身体质心从踝关节后方移动到其前方位置。分类规则捕捉了这一运动学事件：\n    1.  足部保持平放在地面上：$|\\theta_f(t)| \\le \\theta_{\\text{tol}}$。\n    2.  小腿表现出明确的前向角速度：$\\omega_s(t) \\ge \\omega_{\\text{mid}}$。这标志着胫骨（小腿）越过距骨（踝关节）的前进过程。\n\n规则还规定，这些条件必须持续一个最小的连续时长，即“驻留”，以确保检测到的事件是一个稳定的阶段而不是瞬时伪影。这是生物力学事件检测中提高对信号噪声鲁棒性的标准做法。问题要求找到每个阶段的*最早*出现点，并且逻辑上约束支撑中期必须在足平放之后发生（$k_{\\text{MS}} > k_{\\text{FF}}$）。\n\n### 2. 算法实现\n\n我们开发一个确定性算法，在离散时间序列数据上实现这些规则。对于每个测试用例的总体流程包括数据生成、参数计算和序贯事件检测。\n\n#### 2.1. 系统参数与信号生成\n\n首先，我们确定常量和仿真参数。采样周期为 $\\Delta t = 1/f_s = 1/100 = 0.01$ 秒。驻留样本数 $N_{\\text{flat}}$ 和 $N_{\\text{mid}}$ 根据所需的时间长度 $\\Delta t_{\\text{flat}} = 0.04$ 秒和 $\\Delta t_{\\text{mid}} = 0.06$ 秒计算得出：\n$$\nN_{\\text{flat}} = \\lceil \\frac{\\Delta t_{\\text{flat}}}{\\Delta t} \\rceil = \\lceil \\frac{0.04}{0.01} \\rceil = \\lceil 4 \\rceil = 4 \\text{ 个样本}\n$$\n$$\nN_{\\text{mid}} = \\lceil \\frac{\\Delta t_{\\text{mid}}}{\\Delta t} \\rceil = \\lceil \\frac{0.06}{0.01} \\rceil = \\lceil 6 \\rceil = 6 \\text{ 个样本}\n$$\n对于每个测试用例，我们为 $k=0, 1, \\dots, 99$ 生成一个时间向量 $t[k] = k \\Delta t$。然后，通过在每个时间步长 $t[k]$ 上评估给定的函数，计算出足部俯仰角时间序列 $\\{\\theta_f[k]\\}_{k=0}^{K-1}$ 和小腿角速度时间序列 $\\{\\omega_s[k]\\}_{k=0}^{K-1}$。\n\n#### 2.2. 事件检测算法\n\n分类器的核心是一个寻找索引 $k_{\\text{FF}}$ 和 $k_{\\text{MS}}$ 的搜索算法。\n\n**步骤 A：寻找足平放开始点 ($k_{\\text{FF}}$)**\n\n1.  **识别候选样本：** 对于从 $0$ 到 $K-1$ 的每个样本索引 $k$，我们检查瞬时足平放条件是否满足。这将生成一个布尔数组 `is_ff_candidate`，其中当且仅当以下条件成立时，`is_ff_candidate[k]` 为真：\n    $$\n    |\\theta_f[k]| \\le \\theta_{\\text{tol}} \\quad \\text{且} \\quad |\\omega_s[k]| \\le \\omega_{\\text{flat}}\n    $$\n    这里，$\\theta_{\\text{tol}} = 0.087266$ 弧度和 $\\omega_{\\text{flat}} = 0.2$ 弧度/秒。\n\n2.  **搜索驻留窗口：** 我们从索引 $k=0$ 到 $K - N_{\\text{flat}}$ 遍历时间序列。对于每个 $k$，我们检查它是否标志着一个至少包含 $N_{\\text{flat}}$ 个候选样本的连续块的开始。这等效于检查切片 `is_ff_candidate[k : k + N_flat]` 中的所有值是否都为真。\n\n3.  **确定 $k_{\\text{FF}}$：** 第一个满足驻留条件的索引 $k$ 被赋值为 $k_{\\text{FF}}$。如果循环完成而没有找到这样的索引，则表示未检测到足平放阶段，我们设置 $k_{\\text{FF}} = -1$。\n\n**步骤 B：寻找支撑中期开始点 ($k_{\\text{MS}}$)**\n\n仅当成功检测到足平放（$k_{\\text{FF}} \\neq -1$）时，才执行此步骤。\n\n1.  **识别候选样本：** 与足平放步骤类似，我们创建一个布尔数组 `is_ms_candidate`，其中当且仅当瞬时支撑中期条件满足时，`is_ms_candidate[k]` 为真：\n    $$\n    |\\theta_f[k]| \\le \\theta_{\\text{tol}} \\quad \\text{且} \\quad \\omega_s[k] \\ge \\omega_{\\text{mid}}\n    $$\n    这里，$\\omega_{\\text{mid}} = 0.5$ 弧度/秒。\n\n2.  **搜索驻留窗口：** 我们从紧随足平放开始点的索引处开始遍历时间序列，即从 $k = k_{\\text{FF}} + 1$ 到 $K - N_{\\text{mid}}$。对于每个 $k$，我们检查它是否标志着一个至少包含 $N_{\\text{mid}}$ 个支撑中期候选样本的连续块的开始，通过测试切片 `is_ms_candidate[k : k + N_mid]`。\n\n3.  **确定 $k_{\\text{MS}}$：** 第一个满足此条件的索引 $k$ 被赋值为 $k_{\\text{MS}}$。如果没有找到这样的索引，或者如果未检测到足平放，我们设置 $k_{\\text{MS}} = -1$。\n\n#### 2.3. 最终输出生成\n\n检测到的索引使用 $t = k \\Delta t$ 转换为以秒为单位的时间。每个测试用例的最终结果 $(t_{\\text{FF}}, t_{\\text{MS}})$ 四舍五入到三位小数。索引 $-1$ 对应的时间报告为整数 $-1$。所有测试用例的结果集合被格式化为一个表示列表的列表的单个字符串，根据规定，不含空格。\n```python\nimport numpy as np\nimport json\nimport math\n\ndef solve():\n    \"\"\"\n    Main function to run the kinematic gait phase classifier on all test cases.\n    \"\"\"\n\n    # --- Constants and Simulation Parameters ---\n    THETA_TOL = 0.087266  # rad (5 degrees)\n    DT_FLAT = 0.04        # s\n    DT_MID = 0.06         # s\n    OMEGA_FLAT = 0.2      # rad/s\n    OMEGA_MID = 0.5       # rad/s\n    \n    FS = 100.0            # Hz\n    DT = 1.0 / FS         # s\n    T_TOTAL = 1.0         # s\n    K = int(T_TOTAL * FS) # Number of samples\n    \n    N_flat = math.ceil(DT_FLAT / DT)\n    N_mid = math.ceil(DT_MID / DT)\n    \n    time_vec = np.arange(K) * DT\n\n    # --- Test Case Definitions ---\n    test_cases = [\n        {\n            \"name\": \"Test 1: General progression\",\n            \"theta_f\": lambda t: 0.12 * np.exp(-t / 0.1) - 0.005,\n            \"omega_s\": lambda t: np.piecewise(t,\n                [t  0.20, (t >= 0.20)  (t  0.35)],\n                [0.0, lambda t_in: 0.1 + (0.7 / 0.15) * (t_in - 0.20), 0.8]\n            )\n        },\n        {\n            \"name\": \"Test 2: Boundary dwell at midstance threshold\",\n            \"theta_f\": lambda t: np.full_like(t, 0.05),\n            \"omega_s\": lambda t: np.piecewise(t,\n                [t  0.30, (t >= 0.30)  (t  0.36)],\n                [0.0, 0.5, 0.49]\n            )\n        },\n        {\n            \"name\": \"Test 3: No midstance; flat detectable\",\n            \"theta_f\": lambda t: np.full_like(t, 0.02),\n            \"omega_s\": lambda t: np.full_like(t, 0.15)\n        },\n        {\n            \"name\": \"Test 4: No flat; no midstance\",\n            \"theta_f\": lambda t: np.full_like(t, 0.15),\n            \"omega_s\": lambda t: np.full_like(t, 0.6)\n        },\n        {\n            \"name\": \"Test 5: Late flat followed by clear midstance\",\n            \"theta_f\": lambda t: 0.2 * np.exp(-t / 0.5),\n            \"omega_s\": lambda t: np.piecewise(t,\n                [t  0.60],\n                [0.1, 0.7]\n            )\n        }\n    ]\n\n    def find_gait_events(theta_f_series, omega_s_series):\n        \"\"\"\n        Applies the rule-based classifier to find foot-flat and midstance start times.\n        \"\"\"\n        k_ff = -1\n        k_ms = -1\n        \n        # --- Foot-Flat Detection ---\n        is_ff_candidate = (np.abs(theta_f_series) = THETA_TOL)  (np.abs(omega_s_series) = OMEGA_FLAT)\n        \n        for k in range(K - N_flat + 1):\n            if np.all(is_ff_candidate[k : k + N_flat]):\n                k_ff = k\n                break\n        \n        # --- Midstance Detection ---\n        if k_ff != -1:\n            is_ms_candidate = (np.abs(theta_f_series) = THETA_TOL)  (omega_s_series >= OMEGA_MID)\n            \n            # Search must start after k_ff\n            start_search_k = k_ff + 1\n            for k in range(start_search_k, K - N_mid + 1):\n                if np.all(is_ms_candidate[k : k + N_mid]):\n                    k_ms = k\n                    break\n\n        t_ff = round(k_ff * DT, 3) if k_ff != -1 else -1\n        t_ms = round(k_ms * DT, 3) if k_ms != -1 else -1\n\n        return [t_ff, t_ms]\n\n    # --- Run all tests and collect results ---\n    all_results = []\n    for case in test_cases:\n        theta_f_signal = case[\"theta_f\"](time_vec)\n        omega_s_signal = case[\"omega_s\"](time_vec)\n        \n        result_pair = find_gait_events(theta_f_signal, omega_s_signal)\n        all_results.append(result_pair)\n    \n    # Format and create the final output string.\n    # The problem specifies rounding to 3 decimal places, but Python's round() \n    # and json.dumps may not show trailing zeros. The spec is about numerical precision.\n    return json.dumps(all_results, separators=(',', ':'))\n\n# This is a helper to generate the answer. The final answer tag should contain the output string.\n# print(solve())\n```",
            "answer": "[[0.18,0.29],[0.0,0.3],[0.0,-1],[-1,-1],[0.42,0.6]]"
        }
    ]
}