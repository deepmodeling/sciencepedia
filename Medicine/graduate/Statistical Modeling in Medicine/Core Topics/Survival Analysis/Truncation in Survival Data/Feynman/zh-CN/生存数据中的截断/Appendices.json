{
    "hands_on_practices": [
        {
            "introduction": "在处理左截断数据时，最基本的任务是正确构建风险集。这个练习  将指导你如何针对一个包含左截断和右删失的小型假设数据集，手动完成此过程。通过在每个失败事件发生时精确追踪处于风险中的个体，你将为理解 Kaplan-Meier 估计量如何适应复杂数据结构打下坚实的基础。",
            "id": "4985814",
            "problem": "一项临床研究跟踪患者发生首次心血管事件的时间，单位为月。由于招募延迟，每位患者可能会在一段时间后才进入研究，这导致了左截断。如果患者失访或在事件发生前研究结束，则可能会出现右删失。对于患者 $i$，观测数据为左截断时间 $L_i$、观测时间 $T_i$ 和事件指示符 $\\delta_i$，其中 $\\delta_i = 1$ 表示在时间 $T_i$ 发生事件，$\\delta_i = 0$ 表示在时间 $T_i$ 发生右删失。$8$ 位患者的数据集如下：\n- 患者 $1$：$(L_1 = 0, T_1 = 3, \\delta_1 = 1)$。\n- 患者 $2$：$(L_2 = 1, T_2 = 5, \\delta_2 = 1)$。\n- 患者 $3$：$(L_3 = 2, T_3 = 6, \\delta_3 = 0)$。\n- 患者 $4$：$(L_4 = 4, T_4 = 7, \\delta_4 = 1)$。\n- 患者 $5$：$(L_5 = 0.5, T_5 = 9, \\delta_5 = 1)$。\n- 患者 $6$：$(L_6 = 3.2, T_6 = 8, \\delta_6 = 0)$。\n- 患者 $7$：$(L_7 = 5.5, T_7 = 10, \\delta_7 = 0)$。\n- 患者 $8$：$(L_8 = 0, T_8 = 4, \\delta_8 = 0)$。\n\n假设没有同时发生的事件（tied failures），也没有删失与事件在完全相同的时间发生。\n\n仅使用生存分析中风险集和计数过程的基本定义，计算在每个不同的观测事件时间 $u$ 的风险集大小 $Y(u)$ 和事件数 $d(u)$。在每个事件时间 $u$，验证风险集排除了那些尚未进入研究的个体（即 $L_i > u$）或在 $u$ 之前已经删失或发生事件的个体。然后，使用这些值和乘积极限原则，计算在 $t = 9$ 个月时的Kaplan–Meier (KM) 生存估计值，记为 $\\hat{S}(9)$。请将最终答案表示为精确分数，不要四舍五入。",
            "solution": "我们从带有左截断和右删失的生存数据的标准计数过程表示法开始。对于每个个体 $i$，定义事件计数过程\n$$\nN_i(t) = \\mathbf{1}\\{T_i \\le t, \\delta_i = 1\\},\n$$\n以及在险指示符\n$$\nY_i(t) = \\mathbf{1}\\{L_i \\le t \\le T_i\\}.\n$$\n时间 $t$ 的风险集是 $R(t) = \\{i : Y_i(t) = 1\\}$，其大小为 $Y(t) = |R(t)|$。时间 $t$ 的事件数是 $d(t) = \\sum_{i=1}^{n} \\mathbf{1}\\{T_i = t, \\delta_i = 1\\}$。对于左截断，个体只有在进入研究后（即时间 $t$ 大于其 $L_i$）才对风险集有贡献。对于右删失，个体在其删失时间之后便会离开风险集。\n\n数据集中的不同观测事件时间为 $u \\in \\{3, 5, 7, 9\\}$。我们计算在每个事件时间 $u$ 的 $R(u)$ 和 $Y(u)$，并验证左截断和右删失所要求的排除条件。\n\n在 $u = 3$ 时：\n- 包括满足 $L_i \\le 3$ 和 $T_i \\ge 3$ 的个体：患者 $1$ ($L_1 = 0, T_1 = 3$)、$2$ ($L_2 = 1, T_2 = 5$)、$3$ ($L_3 = 2, T_3 = 6$)、$5$ ($L_5 = 0.5, T_5 = 9$) 和 $8$ ($L_8 = 0, T_8 = 4$)。\n- 排除尚未进入研究的个体：$4$ ($L_4 = 4$)、$6$ ($L_6 = 3.2$)、$7$ ($L_7 = 5.5$)。\n- 在时间 3 之前没有人被删失或发生事件。\n因此，$R(3) = \\{1, 2, 3, 5, 8\\}$，所以 $Y(3) = 5$，且 $d(3) = 1$（患者 1 在时间 3 发生事件）。\n\n在 $u = 5$ 时：\n- 移除在时间 5 之前发生事件或被删失的个体：患者 $1$（在时间 3 发生事件）和患者 $8$（在时间 4 被删失）不再处于风险中。\n- 包括满足 $L_i \\le 5$ 和 $T_i \\ge 5$ 的个体：患者 $2$ ($L_2 = 1, T_2 = 5$)、$3$ ($L_3 = 2, T_3 = 6$)、$4$ ($L_4 = 4, T_4 = 7$)、$5$ ($L_5 = 0.5, T_5 = 9$) 和 $6$ ($L_6 = 3.2, T_6 = 8$)。\n- 排除尚未进入研究的个体：患者 $7$ ($L_7 = 5.5$)。\n这验证了排除了尚未进入研究的个体和已移除的个体。因此，$R(5) = \\{2, 3, 4, 5, 6\\}$，所以 $Y(5) = 5$，且 $d(5) = 1$（患者 2 在时间 5 发生事件）。\n\n在 $u = 7$ 时：\n- 移除在时间 7 之前发生事件或被删失的个体：患者 $2$（在时间 5 发生事件）被移除；患者 $3$（在时间 6 被删失）被移除。\n- 包括满足 $L_i \\le 7$ 和 $T_i \\ge 7$ 的个体：患者 $4$ ($L_4 = 4, T_4 = 7$)、$5$ ($L_5 = 0.5, T_5 = 9$)、$6$ ($L_6 = 3.2, T_6 = 8$) 和 $7$ ($L_7 = 5.5, T_7 = 10$)。\n这再次验证了排除了在时间 7 之前被删失的个体，并且仅在左截断时间之后才被纳入。因此，$R(7) = \\{4, 5, 6, 7\\}$，所以 $Y(7) = 4$，且 $d(7) = 1$（患者 4 在时间 7 发生事件）。\n\n在 $u = 9$ 时：\n- 移除在时间 9 之前发生事件或被删失的个体：患者 $4$（在时间 7 发生事件）和患者 $6$（在时间 8 被删失）被移除。\n- 包括满足 $L_i \\le 9$ 和 $T_i \\ge 9$ 的个体：患者 $5$ ($L_5 = 0.5, T_5 = 9$) 和 $7$ ($L_7 = 5.5, T_7 = 10$)。\n因此，$R(9) = \\{5, 7\\}$，所以 $Y(9) = 2$，且 $d(9) = 1$（患者 5 在时间 9 发生事件）。\n\n我们已经在每个事件时间验证了 $R(u)$ 排除了那些尚未进入研究的个体（即 $L_i > u$）以及那些在 $u$ 之前已经发生事件或被删失的个体。利用这些风险集大小和事件计数，我们计算在 $t = 9$ 个月时的 Kaplan–Meier (KM) 乘积极限生存估计值：\n$$\n\\hat{S}(9) = \\prod_{u \\in \\{3, 5, 7, 9\\}} \\left(1 - \\frac{d(u)}{Y(u)}\\right) = \\left(1 - \\frac{1}{5}\\right)\\left(1 - \\frac{1}{5}\\right)\\left(1 - \\frac{1}{4}\\right)\\left(1 - \\frac{1}{2}\\right).\n$$\n计算该乘积，\n$$\n\\hat{S}(9) = \\frac{4}{5} \\cdot \\frac{4}{5} \\cdot \\frac{3}{4} \\cdot \\frac{1}{2} = \\frac{16}{25} \\cdot \\frac{3}{4} \\cdot \\frac{1}{2} = \\frac{48}{200} = \\frac{6}{25}.\n$$\n因此，在 $t = 9$ 个月时的 KM 生存估计值为 $\\hat{S}(9) = \\frac{6}{25}$。",
            "answer": "$$\\boxed{\\frac{6}{25}}$$"
        },
        {
            "introduction": "正确处理左截断为何至关重要？这个练习  将通过一个具体的计算来揭示其重要性。你将分别使用正确考虑了延迟进入的方法和忽略该信息的朴素方法来计算生存估计，通过比较两者差异，你将亲手量化并解释“永生时间偏倚”（immortal time bias），这是生存分析中一个普遍且严重的陷阱。",
            "id": "4562470",
            "problem": "一个放射组学队列评估从癌症诊断到死亡的时间，并且只包括在诊断后、于一个患者特定的进入时间点进行了基线影像扫描的患者。这种纳入标准造成了左截断：事件时间早于其进入时间的患者不会被观察到。设时间原点为诊断时间，每位患者有一个左截断时间 $L_{i}$（自诊断以来的进入时间）、一个观测时间 $X_{i}$ 和一个事件指示符 $\\delta_{i}$，其中如果事件在 $X_{i}$ 发生，则 $\\delta_{i} = 1$，如果在 $X_{i}$ 被右删失，则 $\\delta_{i} = 0$。观测到的患者如下：\n- 患者 $E$：$L_{E} = 0$, $X_{E} = 7$, $\\delta_{E} = 1$\n- 患者 $A$：$L_{A} = 2$, $X_{A} = 5$, $\\delta_{A} = 1$\n- 患者 $G$：$L_{G} = 4$, $X_{G} = 6$, $\\delta_{G} = 1$\n- 患者 $B$：$L_{B} = 6$, $X_{B} = 9$, $\\delta_{B} = 1$\n- 患者 $F$：$L_{F} = 10$, $X_{F} = 11$, $\\delta_{F} = 0$\n- 患者 $C$：$L_{C} = 12$, $X_{C} = 14$, $\\delta_{C} = 1$\n- 患者 $D$：$L_{D} = 1$, $X_{D} = 20$, $\\delta_{D} = 0$\n\n从生存函数 $S(t) = \\Pr(T > t)$、作为瞬时失效率的风险函数 $h(t)$，以及针对左截断右删失数据使用适当风险集的乘积极限（Kaplan-Meier）估计量的定义出发，用两种方法计算在 $t = 12$ 个月时的 Kaplan-Meier 生存估计值：\n1. 考虑了左截断的正确估计量，其中时间 $t$ 的风险集为 $\\{i: L_{i} \\leq t \\leq X_{i}\\}$。\n2. 忽略左截断的朴素估计量，它将所有 $L_{i}$ 视为 $0$，因此时间 $t$ 的风险集为 $\\{i: t \\leq X_{i}\\}$。\n\n将 $t = 12$ 个月时的有符号偏差定义为 $b(12) = S_{\\text{naive}}(12) - S_{\\text{LTRC}}(12)$，其中 $S_{\\text{LTRC}}(t)$ 表示考虑了左截断的估计量，$S_{\\text{naive}}(t)$ 表示忽略左截断的估计量。在你的推导中，通过描述失真的风险集如何改变事件数与风险人数的比率，来定性地论证偏差是向上还是向下，并将其与在包含现患病例的放射组学队列中经常观察到的风险函数形状联系起来。将 $b(12)$ 报告为一个实数，四舍五入到四位有效数字。时间单位为月；最终报告的偏差是无量纲的。",
            "solution": "该问题要求计算并比较在时间 $t=12$ 个月时的两个 Kaplan-Meier 生存估计值：一个正确考虑了左截断右删失（LTRC）数据，另一个是忽略左截断的朴素估计值。\n\n生存函数 $S(t) = \\Pr(T > t)$ 的 Kaplan-Meier 或乘积极限估计量由下式给出：\n$$ \\hat{S}(t) = \\prod_{j: t_j \\leq t} \\left(1 - \\frac{d_j}{n_j}\\right) $$\n其中 $t_j$ 是不同的事件时间，$d_j$ 是在时间 $t_j$ 发生的事件数，$n_j$ 是在时间 $t_j$ 之前处于风险中的个体数。风险集的定义，以及因此产生的 $n_j$ 值，是两种估计量之间的关键区别。\n\n所提供的数据包含 $N=7$ 名患者。为清晰起见，将事件时间排序：\n- 患者 A：($L_A=2$, $X_A=5$, $\\delta_A=1$)\n- 患者 G：($L_G=4$, $X_G=6$, $\\delta_G=1$)\n- 患者 E：($L_E=0$, $X_E=7$, $\\delta_E=1$)\n- 患者 B：($L_B=6$, $X_B=9$, $\\delta_B=1$)\n- 患者 F：($L_F=10$, $X_F=11$, $\\delta_F=0$)\n- 患者 C：($L_C=12$, $X_C=14$, $\\delta_C=1$)\n- 患者 D：($L_D=1$, $X_D=20$, $\\delta_D=0$)\n\n唯一的事件时间为 $t \\in \\{5, 6, 7, 9, 14\\}$。我们需要计算在 $t=12$ 个月时的生存概率。\n\n**1. 考虑左截断的估计量 ($S_{\\text{LTRC}}$)**\n\n时间 $t$ 的风险集被正确定义为 $R(t) = \\{i: L_i \\leq t \\leq X_i\\}$。对于在时间 $t_j$ 发生的事件，风险人数 $n_j$ 是集合 $\\{i: L_i \\leq t_j \\text{ and } X_i \\geq t_j\\}$ 的基数。\n\n- 在事件时间 $t_1 = 5$ 时：\n风险集 $R(5)$ 包括在时间 $5$ 或之前进入研究并且在时间 $5$ 时仍在研究中的患者。\n$R(5) = \\{\\text{A, G, E, D}\\}$，因为 $L_A=2 \\le 5$, $L_G=4 \\le 5$, $L_E=0 \\le 5$, $L_D=1 \\le 5$，并且他们的 $X_i \\ge 5$。患者 B、F、C 的进入时间 $L_i > 5$。\n风险人数为 $n_1 = 4$。发生了一个事件（患者 A），所以 $d_1 = 1$。\n生存因子为 $1 - \\frac{d_1}{n_1} = 1 - \\frac{1}{4} = \\frac{3}{4}$。\n\n- 在事件时间 $t_2 = 6$ 时：\n风险集 $R(6)$ 包括满足 $L_i \\leq 6$ 和 $X_i \\geq 6$ 的患者。\n$R(6) = \\{\\text{G, E, B, D}\\}$。患者 A 已经发生事件。患者 B 现在进入风险集 ($L_B=6$)。\n风险人数为 $n_2 = 4$。发生了一个事件（患者 G），所以 $d_2 = 1$。\n生存因子为 $1 - \\frac{d_2}{n_2} = 1 - \\frac{1}{4} = \\frac{3}{4}$。\n\n- 在事件时间 $t_3 = 7$ 时：\n风险集 $R(7)$ 包括满足 $L_i \\leq 7$ 和 $X_i \\geq 7$ 的患者。\n$R(7) = \\{\\text{E, B, D}\\}$。\n风险人数为 $n_3 = 3$。发生了一个事件（患者 E），所以 $d_3 = 1$。\n生存因子为 $1 - \\frac{d_3}{n_3} = 1 - \\frac{1}{3} = \\frac{2}{3}$。\n\n- 在事件时间 $t_4 = 9$ 时：\n风险集 $R(9)$ 包括满足 $L_i \\leq 9$ 和 $X_i \\geq 9$ 的患者。\n$R(9) = \\{\\text{B, D}\\}$。\n风险人数为 $n_4 = 2$。发生了一个事件（患者 B），所以 $d_4 = 1$。\n生存因子为 $1 - \\frac{d_4}{n_4} = 1 - \\frac{1}{2} = \\frac{1}{2}$。\n\n下一个事件发生在 $t_5 = 14$，晚于 $t=12$。患者 F 在 $t=11$ 时被删失，这不改变生存估计值。因此，对于 $t \\in [9, 11)$，生存概率是恒定的。在 $t=12$ 时，自 $t=9$ 以来没有事件发生。\n因此，$S_{\\text{LTRC}}(12)$ 是截至 $t=9$ 的事件的生存因子的累积乘积：\n$$ S_{\\text{LTRC}}(12) = \\left(1 - \\frac{1}{4}\\right) \\times \\left(1 - \\frac{1}{4}\\right) \\times \\left(1 - \\frac{1}{3}\\right) \\times \\left(1 - \\frac{1}{2}\\right) = \\frac{3}{4} \\times \\frac{3}{4} \\times \\frac{2}{3} \\times \\frac{1}{2} = \\frac{18}{96} = \\frac{3}{16} $$\n\n**2. 朴素估计量 ($S_{\\text{naive}}$)**\n\n这个估计量忽略了左截断，将所有进入时间视为 $L_i = 0$。时间 $t$ 的风险集变为 $\\{i: t \\leq X_i\\}$，等价于 $\\{i: X_i \\geq t\\}$。所有 $N=7$ 名患者都从 $t=0$ 开始被认为处于风险中。\n\n- 在事件时间 $t_1 = 5$ 时：\n风险集 $R(5)$ 包括所有患者，因为他们的 $X_i \\ge 5$。\n$R(5) = \\{\\text{A, G, E, B, F, C, D}\\}$。\n风险人数为 $n_1 = 7$。发生了一个事件（患者 A），所以 $d_1 = 1$。\n生存因子为 $1 - \\frac{1}{7} = \\frac{6}{7}$。\n\n- 在事件时间 $t_2 = 6$ 时：\n风险集 $R(6)$ 包括满足 $X_i \\geq 6$ 的所有患者。患者 A 被移除。\n$R(6) = \\{\\text{G, E, B, F, C, D}\\}$。\n风险人数为 $n_2 = 6$。发生了一个事件（患者 G），所以 $d_2 = 1$。\n生存因子为 $1 - \\frac{1}{6} = \\frac{5}{6}$。\n\n- 在事件时间 $t_3 = 7$ 时：\n风险集 $R(7)$ 包括满足 $X_i \\geq 7$ 的所有患者。患者 G 被移除。\n$R(7) = \\{\\text{E, B, F, C, D}\\}$。\n风险人数为 $n_3 = 5$。发生了一个事件（患者 E），所以 $d_3 = 1$。\n生存因子为 $1 - \\frac{1}{5} = \\frac{4}{5}$。\n\n- 在事件时间 $t_4 = 9$ 时：\n风险集 $R(9)$ 包括满足 $X_i \\geq 9$ 的所有患者。患者 E 被移除。\n$R(9) = \\{\\text{B, F, C, D}\\}$。\n风险人数为 $n_4 = 4$。发生了一个事件（患者 B），所以 $d_4 = 1$。\n生存因子为 $1 - \\frac{1}{4} = \\frac{3}{4}$。\n\n生存概率 $S_{\\text{naive}}(12)$ 计算到 $t=12$ 之前的最后一个事件，即 $t=9$ 时：\n$$ S_{\\text{naive}}(12) = \\left(1 - \\frac{1}{7}\\right) \\times \\left(1 - \\frac{1}{6}\\right) \\times \\left(1 - \\frac{1}{5}\\right) \\times \\left(1 - \\frac{1}{4}\\right) = \\frac{6}{7} \\times \\frac{5}{6} \\times \\frac{4}{5} \\times \\frac{3}{4} = \\frac{3}{7} $$\n\n**3. 偏差计算与定性论证**\n\n在 $t=12$ 个月时的有符号偏差为 $b(12) = S_{\\text{naive}}(12) - S_{\\text{LTRC}}(12)$。\n$$ b(12) = \\frac{3}{7} - \\frac{3}{16} = \\frac{3 \\times 16 - 3 \\times 7}{7 \\times 16} = \\frac{48 - 21}{112} = \\frac{27}{112} $$\n换算成小数，$b(12) \\approx 0.2410714$。四舍五入到四位有效数字，结果是 $0.2411$。\n\n偏差的正号表明朴素估计量高估了生存概率，是一种向上偏差。这种系统性误差被称为**不朽时间偏倚**。\n\n偏差的产生是因为朴素估计量错误地定义了风险集。通过假设所有患者从时间 $t=0$ 开始就处于风险中，它将那些在不可能被观察到发生事件的时期内的个体也包括在风险集中。例如，在第一个事件时间 $t=5$ 时，朴素风险集的大小为 $n_{\\text{naive}}(5) = 7$，而正确的风险集大小为 $n_{\\text{LTRC}}(5) = 4$。朴素方法错误地包括了尚未被观察的患者 B、F 和 C。\n\n在每个早期事件时间，风险贡献项 $d_j/n_j$ 中的分母 $n_j$ 都被这样扩大了。因此，朴素估计量系统性地低估了瞬时风险率：$\\hat{h}_{\\text{naive}}(t_j) = d_j/n_{j, \\text{naive}}  d_j/n_{j, \\text{LTRC}} = \\hat{h}_{\\text{LTRC}}(t_j)$。较低的风险率意味着较高的生存概率。生存函数是形如 $(1 - d_j/n_j)$ 的项的乘积。由于对于朴素估计量，这些项中的每一项都更大（更接近于 $1$），它们的累积乘积 $S_{\\text{naive}}(t)$ 会大于 $S_{\\text{LTRC}}(t)$，从而导致一条过于乐观的生存曲线。\n\n在包含现患病例（即自诊断后已经存活了一段时间的患者）的放射组学队列中，左截断是固有的。这些队列偏向于更“健康”的个体，因为那些患有侵袭性极强疾病的患者在满足研究的影像纳入标准之前就已经发生事件。真实的总体风险通常在初期很高，然后下降。LTRC 估计量正确地捕捉了早期风险人群中较高的风险。而朴素估计量通过将在其截断区间 $(0, L_i)$ 内“不朽”的受试者包括进来，未能观察到这一早期高风险阶段，并将风险平均分配到一个被错误扩大的群体中，从而扭曲了风险函数的形状并高估了生存率。",
            "answer": "$$\\boxed{0.2411}$$"
        },
        {
            "introduction": "生存曲线是一个点估计，但若没有对其不确定性的度量，它就是不完整的。这个高级练习  将引导你从点估计走向区间估计，挑战你推导并应用适用于左截断数据的格林伍德公式（Greenwood's formula）。掌握此方法是构建生存概率置信区间和进行假设检验的关键一步。",
            "id": "4992405",
            "problem": "一项针对晚期心力衰竭患者的队列研究仅在诊断后且在经历感兴趣的事件（死亡）之前纳入个体。由于个体必须存活到其进入时间才能被观察到，因此数据存在左截断问题。每位患者贡献一个进入时间 $A_i$、一个观测时间 $X_i$ 和一个事件指示符 $\\delta_i \\in \\{0,1\\}$，其中 $\\delta_i = 1$ 表示在时间 $X_i$ 发生事件，而 $\\delta_i = 0$ 表示在时间 $X_i$ 发生右删失。目标是失效时间 $T$ 在 $T \\ge A$ 条件下的生存函数 $S(t)$，使用延迟进入Kaplan–Meier (KM) 估计量进行估计。\n\n给定 $n=8$ 位患者的数据：\n- 患者 $1$: $(A_1, X_1, \\delta_1) = (0.5, 3.0, 1)$\n- 患者 $2$: $(A_2, X_2, \\delta_2) = (1.0, 6.0, 0)$\n- 患者 $3$: $(A_3, X_3, \\delta_3) = (2.0, 5.0, 1)$\n- 患者 $4$: $(A_4, X_4, \\delta_4) = (4.0, 9.0, 0)$\n- 患者 $5$: $(A_5, X_5, \\delta_5) = (0.0, 8.0, 1)$\n- 患者 $6$: $(A_6, X_6, \\delta_6) = (7.0, 10.0, 1)$\n- 患者 $7$: $(A_7, X_7, \\delta_7) = (5.0, 7.0, 1)$\n- 患者 $8$: $(A_8, X_8, \\delta_8) = (8.5, 12.0, 0)$\n\n仅使用风险率、生存和计数过程的基本定义，推导在左截断和右删失情况下延迟进入Kaplan–Meier生存估计量的Greenwood型渐近方差表达式。然后，应用您的推导，计算上述数据集在 $t^\\star = 8$ 时 $\\hat{S}(t)$ 的方差估计值。将最终数值表示为无舍入的精确分数。",
            "solution": "该问题要求分两部分：首先，推导延迟进入Kaplan-Meier (KM) 估计量的Greenwood型方差公式；其次，将其应用于给定的数据集，以计算在 $t^\\star = 8$ 时 $\\hat{S}(t)$ 的方差。\n\n### 第1部分：Greenwood型方差公式的推导\n\n设 $T$ 为失效时间随机变量。生存函数为 $S(t) = P(T > t)$。我们有来自 $n$ 个个体的数据 $(A_i, X_i, \\delta_i)$，其中 $i \\in \\{1, \\dots, n\\}$，$A_i$ 是左截断（进入）时间，$X_i = \\min(T_i, C_i)$ 是观测时间（其中 $T_i$ 是失效时间，$C_i$ 是删失时间），$\\delta_i = I(T_i \\le C_i)$ 是事件指示符。个体 $i$ 仅在其存活至进入时间（即 $T_i \\ge A_i$）时才被纳入研究。\n\n设排序后的不同事件时间为 $t_1  t_2  \\dots  t_k$。\n在存在左截断的情况下，生存函数 $S(t)$ 的Kaplan-Meier估计量由下式给出：\n$$ \\hat{S}(t) = \\prod_{j: t_j \\le t} \\left(1 - \\frac{d_j}{Y_j}\\right) $$\n其中 $d_j$ 是在时间 $t_j$ 的事件数，$Y_j$ 是在时间 $t_j$ 之前处于风险中的个体数。对左截断数据而言，关键的修正在于风险集 $R(t)$ 的定义，它包括在时间 $t$ 或之前已进入研究且尚未经历事件或被删失的个体。\n在时间 $t_j$ 的风险集大小为：\n$$ Y_j = |R(t_j)| = \\left|\\{i: A_i \\le t_j \\le X_i\\}\\right| = \\sum_{i=1}^n I(A_i \\le t_j \\le X_i) $$\n在时间 $t_j$ 的事件数为：\n$$ d_j = \\sum_{i=1}^n I(X_i = t_j, \\delta_i = 1) $$\n为了推导方差，我们使用delta方法。首先求 $\\ln(\\hat{S}(t))$ 的方差会更方便。\n$$ \\ln(\\hat{S}(t)) = \\ln\\left(\\prod_{j: t_j \\le t} \\left(1 - \\frac{d_j}{Y_j}\\right)\\right) = \\sum_{j: t_j \\le t} \\ln\\left(1 - \\frac{d_j}{Y_j}\\right) $$\n此和式中对应于不同事件时间的项是近似独立的。因此，和的方差约等于方差的和：\n$$ \\text{Var}[\\ln(\\hat{S}(t))] \\approx \\sum_{j: t_j \\le t} \\text{Var}\\left[\\ln\\left(1 - \\frac{d_j}{Y_j}\\right)\\right] $$\n在风险集 $Y_j$ 给定的条件下，事件数 $d_j$ 可以建模为二项随机变量，$d_j \\sim \\text{Binomial}(Y_j, \\pi_j)$，其中 $\\pi_j$ 是在 $t_j$ 时发生事件的条件概率。该概率的估计量是 $\\hat{\\pi}_j = d_j/Y_j$。$\\hat{\\pi}_j$ 的方差是 $\\text{Var}[\\hat{\\pi}_j] = \\frac{\\pi_j(1-\\pi_j)}{Y_j}$。\n\n我们对函数 $g(\\pi) = \\ln(1-\\pi)$ 应用delta方法。其导数为 $g'(\\pi) = -\\frac{1}{1-\\pi}$。$g(\\hat{\\pi}_j)$ 的方差近似为：\n$$ \\text{Var}[g(\\hat{\\pi}_j)] \\approx [g'(\\pi_j)]^2 \\text{Var}[\\hat{\\pi}_j] = \\left(-\\frac{1}{1-\\pi_j}\\right)^2 \\frac{\\pi_j(1-\\pi_j)}{Y_j} = \\frac{1}{(1-\\pi_j)^2} \\frac{\\pi_j(1-\\pi_j)}{Y_j} = \\frac{\\pi_j}{Y_j(1-\\pi_j)} $$\n我们通过将 $\\pi_j$ 替换为其估计值 $\\hat{\\pi}_j = d_j/Y_j$ 来估计此方差：\n$$ \\widehat{\\text{Var}}\\left[\\ln\\left(1 - \\frac{d_j}{Y_j}\\right)\\right] = \\frac{d_j/Y_j}{Y_j(1 - d_j/Y_j)} = \\frac{d_j/Y_j}{Y_j\\left(\\frac{Y_j-d_j}{Y_j}\\right)} = \\frac{d_j}{Y_j(Y_j-d_j)} $$\n对截至时间 $t$ 的所有事件时间求和，得到 $\\ln(\\hat{S}(t))$ 的估计方差：\n$$ \\widehat{\\text{Var}}[\\ln(\\hat{S}(t))] = \\sum_{j: t_j \\le t} \\frac{d_j}{Y_j(Y_j-d_j)} $$\n为了求出 $\\hat{S}(t)$ 的方差，我们再次应用delta方法，这次是针对从 $\\ln(S)$ 到 $S$ 的变换。由于 $\\hat{S}(t) = \\exp(\\ln(\\hat{S}(t)))$，且对于 $f(x) = \\exp(x)$，有 $f'(x) = \\exp(x)$，我们得到：\n$$ \\text{Var}[\\hat{S}(t)] \\approx \\left(\\frac{d}{d\\ln S} S\\right)^2 \\text{Var}[\\ln(\\hat{S}(t))] = [S(t)]^2 \\text{Var}[\\ln(\\hat{S}(t))] $$\n代入估计值，得到延迟进入Kaplan-Meier估计量的Greenwood型方差公式：\n$$ \\widehat{\\text{Var}}[\\hat{S}(t)] = [\\hat{S}(t)]^2 \\sum_{j: t_j \\le t} \\frac{d_j}{Y_j(Y_j-d_j)} $$\n此推导成立，因为左截断的影响已在风险集 $Y_j$ 的构建中被完全考虑。\n\n### 第2部分：$\\widehat{\\text{Var}}[\\hat{S}(8)]$ 的计算\n\n我们将推导出的公式应用于给定数据集，计算 $t^\\star = 8$ 时的情况。\n数据集为：\nP$1$: $(0.5, 3.0, 1)$，P$2$: $(1.0, 6.0, 0)$，P$3$: $(2.0, 5.0, 1)$，P$4$: $(4.0, 9.0, 0)$，P$5$: $(0.0, 8.0, 1)$，P$6$: $(7.0, 10.0, 1)$，P$7$: $(5.0, 7.0, 1)$，P$8$: $(8.5, 12.0, 0)$。\n\n首先，我们确定 $t_j \\le 8$ 的不同事件时间：$t_1=3.0$, $t_2=5.0$, $t_3=7.0$ 和 $t_4=8.0$。\n\n接下来，我们为每个事件时间计算 $d_j$、$Y_j$、生存概率因子和方差分量。\n\n1.  **事件时间 $t_1 = 3.0$:**\n    -   事件：患者 $1$。因此 $d_1 = 1$。\n    -   风险集 $R(3.0) = \\{i: A_i \\le 3.0 \\le X_i\\}$：\n        -   P$1: 0.5 \\le 3.0 \\le 3.0$ (是)\n        -   P$2: 1.0 \\le 3.0 \\le 6.0$ (是)\n        -   P$3: 2.0 \\le 3.0 \\le 5.0$ (是)\n        -   P$5: 0.0 \\le 3.0 \\le 8.0$ (是)\n    -   $Y_1 = 4$。\n    -   KM因子：$1 - \\frac{1}{4} = \\frac{3}{4}$。方差项：$\\frac{1}{4(4-1)} = \\frac{1}{12}$。\n\n2.  **事件时间 $t_2 = 5.0$:**\n    -   事件：患者 $3$。因此 $d_2 = 1$。\n    -   风险集 $R(5.0) = \\{i: A_i \\le 5.0 \\le X_i\\}$：\n        -   P$2: 1.0 \\le 5.0 \\le 6.0$ (是)\n        -   P$3: 2.0 \\le 5.0 \\le 5.0$ (是)\n        -   P$4: 4.0 \\le 5.0 \\le 9.0$ (是)\n        -   P$5: 0.0 \\le 5.0 \\le 8.0$ (是)\n        -   P$7: 5.0 \\le 5.0 \\le 7.0$ (是)\n    -   $Y_2 = 5$。\n    -   KM因子：$1 - \\frac{1}{5} = \\frac{4}{5}$。方差项：$\\frac{1}{5(5-1)} = \\frac{1}{20}$。\n\n3.  **事件时间 $t_3 = 7.0$:**\n    -   事件：患者 $7$。因此 $d_3 = 1$。\n    -   风险集 $R(7.0) = \\{i: A_i \\le 7.0 \\le X_i\\}$：\n        -   P$4: 4.0 \\le 7.0 \\le 9.0$ (是)\n        -   P$5: 0.0 \\le 7.0 \\le 8.0$ (是)\n        -   P$6: 7.0 \\le 7.0 \\le 10.0$ (是)\n        -   P$7: 5.0 \\le 7.0 \\le 7.0$ (是)\n    -   $Y_3 = 4$。\n    -   KM因子：$1 - \\frac{1}{4} = \\frac{3}{4}$。方差项：$\\frac{1}{4(4-1)} = \\frac{1}{12}$。\n\n4.  **事件时间 $t_4 = 8.0$:**\n    -   事件：患者 $5$。因此 $d_4 = 1$。\n    -   风险集 $R(8.0) = \\{i: A_i \\le 8.0 \\le X_i\\}$：\n        -   P$4: 4.0 \\le 8.0 \\le 9.0$ (是)\n        -   P$5: 0.0 \\le 8.0 \\le 8.0$ (是)\n        -   P$6: 7.0 \\le 8.0 \\le 10.0$ (是)\n    -   $Y_4 = 3$。\n    -   KM因子：$1 - \\frac{1}{3} = \\frac{2}{3}$。方差项：$\\frac{1}{3(3-1)} = \\frac{1}{6}$。\n\n现在我们可以计算所需的各部分。\nKM估计值 $\\hat{S}(8)$ 是：\n$$ \\hat{S}(8) = \\prod_{j=1}^4 \\left(1 - \\frac{d_j}{Y_j}\\right) = \\left(\\frac{3}{4}\\right)\\left(\\frac{4}{5}\\right)\\left(\\frac{3}{4}\\right)\\left(\\frac{2}{3}\\right) = \\frac{72}{240} = \\frac{3}{10} $$\n方差的求和项是：\n$$ \\sum_{j: t_j \\le 8} \\frac{d_j}{Y_j(Y_j-d_j)} = \\frac{1}{12} + \\frac{1}{20} + \\frac{1}{12} + \\frac{1}{6} $$\n$$ = \\frac{2}{12} + \\frac{1}{6} + \\frac{1}{20} = \\frac{1}{6} + \\frac{1}{6} + \\frac{1}{20} = \\frac{2}{6} + \\frac{1}{20} = \\frac{1}{3} + \\frac{1}{20} $$\n使用公分母 $60$：\n$$ = \\frac{20}{60} + \\frac{3}{60} = \\frac{23}{60} $$\n最后，我们计算方差估计值：\n$$ \\widehat{\\text{Var}}[\\hat{S}(8)] = [\\hat{S}(8)]^2 \\sum_{j: t_j \\le 8} \\frac{d_j}{Y_j(Y_j-d_j)} = \\left(\\frac{3}{10}\\right)^2 \\left(\\frac{23}{60}\\right) $$\n$$ = \\left(\\frac{9}{100}\\right) \\left(\\frac{23}{60}\\right) = \\frac{9 \\times 23}{100 \\times 60} = \\frac{207}{6000} $$\n这个分数可以通过将分子和分母除以它们的最大公约数 $3$ 来化简：\n$$ \\widehat{\\text{Var}}[\\hat{S}(8)] = \\frac{207 \\div 3}{6000 \\div 3} = \\frac{69}{2000} $$\n$69$ 的质因数是 $3$ 和 $23$，而 $2000$ 的质因数是 $2$ 和 $5$。没有其他公因数，所以该分数已是最简形式。",
            "answer": "$$\\boxed{\\frac{69}{2000}}$$"
        }
    ]
}