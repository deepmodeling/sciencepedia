{
    "hands_on_practices": [
        {
            "introduction": "生存分析的旅程并非始于复杂的公式，而是始于细致的数据整理。第一个练习将重点放在一项基本技能上：将原始的事件时间数据转化为结构化的生命表，这是应用Kaplan-Meier方法的必要步骤。通过追踪风险集中的受试者数量 ($Y_j$)、事件数量 ($d_j$) 和删失观测数量 ($c_j$)，你将构建一个清晰、系统的摘要，它构成了后续分析的主干 。",
            "id": "1961488",
            "problem": "一项临床试验旨在评估新药“Neurostabil”在预防神经系统症状复发方面的疗效。15名受试者参与了这项为期12个月的研究。对于每位受试者，数据都以数对 `(time, status)` 的形式记录，其中 `time` 是距离症状复发（事件发生）或受试者被删失的月数，而 `status` 是一个指示变量（1表示事件发生，0表示删失）。如果受试者中途退出研究，或者在研究结束时仍未经历事件，则该受试者被视为删失。\n\n15名受试者的数据如下：\n(3, 1), (5, 1), (12, 0), (7, 1), (4, 0), (9, 1), (7, 1), (10, 0), (11, 1), (12, 0), (3, 1), (7, 1), (8, 0), (5, 0), (9, 1)\n\n为准备进行Kaplan-Meier生存分析，你需要汇总这些数据。设 $t_1  t_2  \\dots  t_k$ 是唯一的、有序的事件时间序列。对于每个不同的事件时间 $t_j$（其中 $j=1, \\dots, k$），我们定义以下量：\n- $Y_j$：在时间 $t_j$ 之前处于风险中的受试者数量。如果一个受试者在时间 $t_j$ 之前既未发生事件也未被删失，则认为其处于风险中。\n- $d_j$：在时间 $t_j$ 发生事件的受试者数量。\n- $c_j$：在时间区间 $[t_{j-1}, t_j)$ 内被删失的受试者数量，其中 $t_0 = 0$。\n\n确定所有不同事件时间对应的三元组 $(Y_j, d_j, c_j)$ 序列。将你的答案以矩阵形式呈现，其中第 $j$ 行包含第 $j$ 个事件时间对应的三元组。",
            "solution": "我们总共有15名受试者。设不同的、有序的事件时间为 $t_{1}$",
            "answer": "$$\\boxed{\\begin{pmatrix}\n15  2  0 \\\\\n12  1  1 \\\\\n10  3  1 \\\\\n6  2  1 \\\\\n3  1  1\n\\end{pmatrix}}$$"
        },
        {
            "introduction": "数据整理完毕后，你就可以开始估算生存函数了。本练习将指导你完成Kaplan-Meier估计量的核心计算，应用其著名的乘积极限公式。你将亲眼见证该估计量如何通过一系列条件生存概率的乘积构建而成，以及它如何通过在每个事件时间点调整风险集来巧妙地处理删失数据 。",
            "id": "4806038",
            "problem": "一项随机临床研究对 $n=5$ 名独立患者进行右删失下的随访。对于患者 $i$，令 $T_i$ 表示真实事件时间，$C_i$ 表示删失时间，并定义观测对 $(Y_i,\\delta_i)$ 为 $Y_i=\\min\\{T_i,C_i\\}$ 和 $\\delta_i=\\mathbf{1}\\{T_i \\leq C_i\\}$。假设为非信息性右删失，这意味着事件时间与删失时间独立，并且删失不改变 $T_i$ 的分布。观测数据 $(Y_i,\\delta_i)$ 为 $(2,1)$, $(4,0)$, $(4,1)$, $(6,1)$, $(7,0)$。\n\n从生存函数 $S(t)=\\mathbb{P}(Tt)$ 的定义出发，并根据在独立右删失下生存函数可以表示为跨越观测事件时间的条件生存概率乘积的原理，推导出基于每个不同观测事件时间的风险集和事件计数的 $S(t)$ 的非参数估计量。当事件时间和删失时间出现相等值（结）时，在构建风险人数时，将同一时间的事件视为发生在删失之前。\n\n计算数据集中每个不同事件时间的估计生存率 $\\hat{S}(t)$，并按事件时间 $t=2$，$t=4$ 和 $t=6$ 的升序报告这些值。以未经四舍五入的分数形式提供精确值。",
            "solution": "该问题是有效的，因为它在科学上基于生存分析的原理，给出了所有必要的数据和假设，问题陈述清晰，并且客观。它展示了使用Kaplan-Meier方法从右删失数据中估计生存函数的标准应用。\n\n生存函数 $S(t)$ 定义为事件时间 $T$ 大于某个时间 $t$ 的概率：\n$$S(t) = \\mathbb{P}(T > t)$$\nKaplan-Meier 方法提供了从可能被删失的观测数据中对该函数进行非参数估计的方法。其核心原理是将生存函数表示为在观测到的事件时间点上的条件概率的乘积。\n\n设 $t_{(1)}  t_{(2)}  \\dots  t_{(k)}$ 为样本中观测到的 $k$ 个不同的事件时间。在 $t_{(j)} \\le t  t_{(j+1)}$ 的情况下，生存超过时间 $t$ 的概率等同于生存超过最后一个观测事件时间 $t_{(j)}$ 的概率。这可以使用概率的链式法则表示：\n$$\nS(t) = \\mathbb{P}(T > t_{(j)}) = \\mathbb{P}(T > t_{(1)} \\text{ and } T > t_{(2)} \\text{ and } \\dots \\text{ and } T > t_{(j)})\n$$\n$$\nS(t) = \\mathbb{P}(T > t_{(1)}) \\times \\mathbb{P}(T > t_{(2)} | T > t_{(1)}) \\times \\dots \\times \\mathbb{P}(T > t_{(j)} | T > t_{(j-1)})\n$$\n这可以写成乘积形式：\n$$S(t) = \\prod_{i: t_{(i)} \\le t} \\mathbb{P}(T > t_{(i)} | T > t_{(i-1)}), \\quad \\text{with } t_{(0)} = 0$$\n每一项 $\\mathbb{P}(T > t_{(i)} | T > t_{(i-1)})$ 是在给定生存至该时间点的情况下，生存超过时间 $t_{(i)}$ 的条件概率。这可以重写为 $1 - \\mathbb{P}(T = t_{(i)} | T \\ge t_{(i)})$，其中后一项是在时间 $t_{(i)}$ 发生事件的条件概率，即该时间的风险率。\n\n在非信息性删失的假设下，我们可以从数据中估计这个条件概率。我们为每个不同的事件时间 $t_{(i)}$ 定义以下量：\n- 风险集 $R(t_{(i)})$ 是指在时间 $t_{(i)}$ 之前仍在观察中的所有个体的集合。\n- 风险人数 $n_i$ 是风险集的大小，即 $n_i = |R(t_{(i)})| = |\\{j: Y_j \\ge t_{(i)}\\}|$。\n- 事件数 $d_i$ 是在时间 $t_{(i)}$ 发生事件的个体数量，即 $d_i = |\\{j: Y_j = t_{(i)}, \\delta_j = 1\\}|$。\n\n在时间 $t_{(i)}$ 发生事件的条件概率的估计值为比例 $\\frac{d_i}{n_i}$。因此，生存超过时间 $t_{(i)}$ 的估计条件概率为 $1 - \\frac{d_i}{n_i}$。\n\n将这些估计值代入乘积形式，得到生存函数的 Kaplan-Meier 乘积限估计量：\n$$\\hat{S}(t) = \\prod_{i: t_{(i)} \\le t} \\left(1 - \\frac{d_i}{n_i}\\right)$$\n按照惯例，$\\hat{S}(0) = 1$。生存函数的估计是一个阶梯函数，在事件时间之间保持不变，仅在观测到的事件时间点上改变其值。\n\n现在，我们将此方法应用于给定数据。患者总数为 $n=5$。观测数据对 $(Y_i, \\delta_i)$ 为 $(2,1), (4,0), (4,1), (6,1), (7,0)$。\n不同的观测时间为 $2, 4, 6, 7$。事件时间（其中 $\\delta_i=1$）为 $t=2, 4, 6$。\n\n我们构建一个生命表来组织计算：\n\n**1. 时间区间 $t \\in [0, 2)$**\n初始风险患者数为 $n=5$。没有事件发生。\n$\\hat{S}(t) = 1$ for $t  2$。\n\n**2. 第一个事件时间, $t=2$**\n- 在时间 $t=2$ 之前处于风险中的个体数量为 $n_2 = 5$。所有患者仍在研究中。\n- 在 $t=2$ 时的事件数为 $d_2 = 1$。\n- 条件生存概率为 $1 - \\frac{d_2}{n_2} = 1 - \\frac{1}{5} = \\frac{4}{5}$。\n- 在 $t=2$ 时的估计生存函数为 $\\hat{S}(2) = \\hat{S}(0) \\times \\left(1 - \\frac{d_2}{n_2}\\right) = 1 \\times \\frac{4}{5} = \\frac{4}{5}$。\n- 在此时间点之后，有1名患者发生了事件。仍在风险中的患者数量为 $5 - 1 = 4$。\n\n**3. 第二个事件时间, $t=4$**\n- 在时间 $t=4$ 时，有一次事件 $(4,1)$ 和一次删失 $(4,0)$。\n- 在时间 $t=4$ 之前处于风险中的个体数量包括所有观测时间 $Y_i \\ge 4$ 的个体。这些是数据为 $(4,0), (4,1), (6,1), (7,0)$ 的患者。因此，风险人数为 $n_4 = 4$。\n- 在 $t=4$ 时的事件数为 $d_4 = 1$。\n- 根据问题的相等值处理规则，事件在删失之前处理。风险集 $n_4=4$ 正确地包括了这两个个体。\n- 条件生存概率为 $1 - \\frac{d_4}{n_4} = 1 - \\frac{1}{4} = \\frac{3}{4}$。\n- 在 $t=4$ 时的估计生存函数为 $\\hat{S}(4) = \\hat{S}(2) \\times \\left(1 - \\frac{d_4}{n_4}\\right) = \\frac{4}{5} \\times \\frac{3}{4} = \\frac{3}{5}$。\n- 在此时间点之后，有1名患者发生了事件，1名患者被删失。仍在风险中的患者数量为初始的4人减去1个事件和1个删失，剩下 $4 - 1 - 1 = 2$ 人。\n\n**4. 第三个事件时间, $t=6$**\n- 在时间 $t=6$ 之前处于风险中的个体数量包括那些观测时间 $Y_i \\ge 6$ 的个体。这些是数据为 $(6,1)$ 和 $(7,0)$ 的患者。因此，风险人数为 $n_6 = 2$。\n- 在 $t=6$ 时的事件数为 $d_6 = 1$。\n- 条件生存概率为 $1 - \\frac{d_6}{n_6} = 1 - \\frac{1}{2} = \\frac{1}{2}$。\n- 在 $t=6$ 时的估计生存函数为 $\\hat{S}(6) = \\hat{S}(4) \\times \\left(1 - \\frac{d_6}{n_6}\\right) = \\frac{3}{5} \\times \\frac{1}{2} = \\frac{3}{10}$。\n- 在此时间点之后，有1名患者发生了事件。剩余人数为 $2 - 1 = 1$。\n\n最后的观测是在 $t=7$ 时的一次删失。生存估计在删失时间点不发生改变，因此对于所有 $t \\ge 6$，$\\hat{S}(t) = \\frac{3}{10}$。\n\n所要求的值是在不同事件时间 $t=2, 4, 6$ 的估计生存概率。\n- $\\hat{S}(2) = \\frac{4}{5}$\n- $\\hat{S}(4) = \\frac{3}{5}$\n- $\\hat{S}(6) = \\frac{3}{10}$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{4}{5}  \\frac{3}{5}  \\frac{3}{10}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "生存曲线的点估计只讲述了故事的一部分；理解其不确定性对于可靠的统计推断至关重要。最后一个练习将介绍Greenwood公式，这是计算Kaplan-Meier估计量方差的标准方法。完成此练习将使你能够从简单的描述性曲线转向量化估计的可靠性，这是构建置信区间的关键一步 。",
            "id": "4989554",
            "problem": "在一个前瞻性临床队列研究中，对六名患者进行事件发生时间（time-to-event）随访，数据存在右删失。对于患者$i$，观测到的数据对为$(X_i,\\delta_i)$，其中$X_i$是观测时间，$\\delta_i \\in \\{0,1\\}$表示删失（$\\delta_i=0$）或事件发生（$\\delta_i=1$）。数据如下：\n$$(X,\\delta)=\\big((2,1),(3,0),(4,1),(5,1),(6,0),(7,1)\\big)。$$\n假设所有患者的事件时间独立同分布，且右删失是独立的、非信息性的，因此由观测样本构成的风险集能够忠实地代表条件生存概率。\n\n从生存函数$S(t)=\\Pr(Tt)$的定义以及生存概率在不同事件时间点上分解为条件生存概率的原理出发，基于观测到的风险集和事件计数，推导乘积极限估计量（Kaplan-Meier (KM) 估计量）$\\hat{S}(t)$在$t=5$处的值。然后，利用基于独立增量下乘法估计量方差的渐近方差理论，并对$\\ln\\hat{S}(t)$使用一阶delta方法，求出$\\hat{S}(5)$的Greenwood方差估计值，并计算相关的标准误。\n\n报告两个量：\n- $\\hat{S}(5)$的Greenwood方差估计值，以及\n- $\\hat{S}(5)$的标准误。\n\n将两个值都四舍五入到四位有效数字。不需要单位，并将任何比例表示为小数或分数（不要使用百分号）。",
            "solution": "该问题陈述清晰且科学严谨，为估计生存函数及其方差提供了完整的数据集和标准假设。我们开始求解。\n\n生存函数$S(t) = \\Pr(T > t)$表示事件发生时间$T$大于某个时间$t$的概率。Kaplan-Meier (KM) 估计量$\\hat{S}(t)$为可能存在右删失的事件时间数据提供了一种对$S(t)$的非参数估计。它是一种基于每个不同事件时间点的条件概率的乘积极限估计量。\n\n首先，我们整理给出的$6$名患者的数据$(X_i,\\delta_i)$：\n$$(X,\\delta)=\\big((2,1),(3,0),(4,1),(5,1),(6,0),(7,1)\\big)。$$\n这里，$\\delta_i=1$表示事件发生，$\\delta_i=0$表示删失。我们必须确定不同的事件时间$t_{(j)}$，并对每个时间点，确定在该时间点之前处于风险中的个体数量$n_j$以及在该时间点发生的事件数量$d_j$。设初始患者数量为$N_0=6$。\n\n不同的事件时间为$t=2$，$t=4$，$t=5$和$t=7$。\n我们来构建一个生命表：\n\\begin{itemize}\n    \\item 在事件时间$t_{(1)}=2$时：风险集包括所有在时间$2$之前未发生事件或未被删失的个体。所有$6$名患者都处于风险中。因此，$n_1=6$。此时发生一个事件，所以$d_1=1$。\n    \\item 一名患者在时间$t=3$时被删失。该个体从后续事件时间的风险集中移除。\n    \\item 在事件时间$t_{(2)}=4$时：风险集由观测时间$X_i \\ge 4$的个体组成。在$t=2$时发生事件的患者和在$t=3$时被删失的患者从最初的$6$人中移除。因此，$n_2 = 6 - 1 - 1 = 4$。在$t=4$时发生一个事件，所以$d_2=1$。\n    \\item 在事件时间$t_{(3)}=5$时：风险集由$X_i \\ge 5$的个体组成。在$t=4$时发生事件的患者从前一个包含$4$人的风险集中移除。因此，$n_3 = 4 - 1 = 3$。在$t=5$时发生一个事件，所以$d_3=1$。\n    \\item 一名患者在时间$t=6$时被删失。该个体从风险集中移除。\n    \\item 在事件时间$t_{(4)}=7$时：风险集由$X_i \\ge 7$的个体组成。在$t=5$时发生事件的患者和在$t=6$时被删失的患者被移除。因此，$n_4=3-1-1=1$。在$t=7$时发生一个事件，所以$d_4=1$。\n\\end{itemize}\n\n生命表总结如下：\n\\begin{center}\n\\begin{tabular}{c | c | c}\n事件时间 $t_{(j)}$  风险人数 $n_j$  事件数 $d_j$ \\\\\n\\hline\n$2$  $6$  $1$ \\\\\n$4$  $4$  $1$ \\\\\n$5$  $3$  $1$ \\\\\n$7$  $1$  $1$ \\\\\n\\end{tabular}\n\\end{center}\n\nKaplan-Meier估计量$\\hat{S}(t)$由截至时间$t$的条件生存概率的乘积给出：\n$$ \\hat{S}(t) = \\prod_{j: t_{(j)} \\le t} \\left(1 - \\frac{d_j}{n_j}\\right) $$\n我们需要在$t=5$处计算该值。小于或等于$5$的事件时间为$t_{(1)}=2$、$t_{(2)}=4$和$t_{(3)}=5$。\n$$ \\hat{S}(5) = \\left(1 - \\frac{d_1}{n_1}\\right) \\times \\left(1 - \\frac{d_2}{n_2}\\right) \\times \\left(1 - \\frac{d_3}{n_3}\\right) $$\n代入生命表中的值：\n$$ \\hat{S}(5) = \\left(1 - \\frac{1}{6}\\right) \\times \\left(1 - \\frac{1}{4}\\right) \\times \\left(1 - \\frac{1}{3}\\right) = \\frac{5}{6} \\times \\frac{3}{4} \\times \\frac{2}{3} = \\frac{30}{72} = \\frac{5}{12} $$\n\n接下来，我们推导$\\hat{S}(5)$的Greenwood方差估计值。KM估计量的方差公式是通过对数转换后的生存函数$\\ln(\\hat{S}(t))$使用delta方法推导出来的。在独立增量的假设下，$\\ln(\\hat{S}(t))$的方差近似为条件生存概率对数的方差之和。\n$$ \\hat{V}(\\ln \\hat{S}(t)) \\approx \\sum_{j: t_{(j)} \\le t} \\frac{d_j}{n_j(n_j - d_j)} $$\n再次应用delta方法，从$\\ln(\\hat{S}(t))$变换回$\\hat{S}(t)$，我们得到Greenwood公式：\n$$ \\hat{V}(\\hat{S}(t)) = [\\hat{S}(t)]^2 \\hat{V}(\\ln \\hat{S}(t)) = [\\hat{S}(t)]^2 \\sum_{j: t_{(j)} \\le t} \\frac{d_j}{n_j(n_j - d_j)} $$\n对于$t=5$，我们需要计算$j=1, 2, 3$的求和项：\n$$ \\sum_{j: t_{(j)} \\le 5} \\frac{d_j}{n_j(n_j - d_j)} = \\frac{d_1}{n_1(n_1 - d_1)} + \\frac{d_2}{n_2(n_2 - d_2)} + \\frac{d_3}{n_3(n_3 - d_3)} $$\n$$ = \\frac{1}{6(6-1)} + \\frac{1}{4(4-1)} + \\frac{1}{3(3-1)} $$\n$$ = \\frac{1}{30} + \\frac{1}{12} + \\frac{1}{6} $$\n为了对这些分数求和，我们找到一个公分母，即$60$：\n$$= \\frac{2}{60} + \\frac{5}{60} + \\frac{10}{60} = \\frac{17}{60} $$\n现在我们可以计算$\\hat{S}(5)$的方差：\n$$ \\hat{V}(\\hat{S}(5)) = [\\hat{S}(5)]^2 \\left(\\frac{17}{60}\\right) = \\left(\\frac{5}{12}\\right)^2 \\left(\\frac{17}{60}\\right) = \\frac{25}{144} \\times \\frac{17}{60} $$\n简化表达式：\n$$ \\hat{V}(\\hat{S}(5)) = \\frac{25 \\times 17}{144 \\times 60} = \\frac{5 \\times 17}{144 \\times 12} = \\frac{85}{1728} $$\n换算成小数，即为$85 \\div 1728 \\approx 0.0491898...$\n四舍五入到四位有效数字，Greenwood的方差估计值为：\n$$ \\hat{V}(\\hat{S}(5)) \\approx 0.04919 $$\n\n标准误（SE）是方差的平方根：\n$$ \\text{SE}(\\hat{S}(5)) = \\sqrt{\\hat{V}(\\hat{S}(5))} = \\sqrt{\\frac{85}{1728}} $$\n换算成小数，即为$\\sqrt{0.0491898...} \\approx 0.2217877...$\n四舍五入到四位有效数字，标准误为：\n$$ \\text{SE}(\\hat{S}(5)) \\approx 0.2218 $$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.04919  0.2218\n\\end{pmatrix}\n}\n$$"
        }
    ]
}