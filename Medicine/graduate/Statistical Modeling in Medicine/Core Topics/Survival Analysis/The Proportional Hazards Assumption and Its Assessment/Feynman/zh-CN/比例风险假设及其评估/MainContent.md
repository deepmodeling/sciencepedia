## 引言
在医学研究、[公共卫生](@entry_id:273864)和许多其他科学领域，理解事件发生时间（如疾病复发或患者生存）的驱动因素至关重要。[Cox比例风险模型](@entry_id:174252)作为[生存分析](@entry_id:264012)领域的一块基石，为研究人员提供了一个强大而灵活的工具来量化各种协变量对事件风险的影响。然而，这个模型的优雅与力量，都建立在一个核心前提之上：**[比例风险](@entry_id:166780)（Proportional Hazards, PH）假设**。该假设断言，一个因素（如一种新疗法或一个风险标志物）对风险的相对影响在时间长河中是恒定不变的。

然而，如果这一基本假设不成立，我们从模型中得出的结论——通常以单一的[风险比](@entry_id:173429)（Hazard Ratio）来概括——就可能产生严重的误导，掩盖了早期有益但后期有害（或反之）的复杂动态。因此，严谨地评估并恰当地处理[比例风险假设](@entry_id:163597)，是确保[生存分析](@entry_id:264012)结论科学性和可靠性的关键一步，也是从优秀的数据分析师迈向卓越的统计思想家的必经之路。

本文将系统地引导您深入理解[比例风险假设](@entry_id:163597)的里里外外。在第一章**“原理与机制”**中，我们将剖析PH假设的数学本质，理解David Cox爵士巧妙的[偏似然](@entry_id:165240)估计法，并学习一系列图形化和量化的诊断工具来“质询”该假设。随后，在第二章**“应用与跨学科联结”**中，我们将通过丰富的临床研究和[流行病学](@entry_id:141409)案例，展示这些诊断工具在实践中的应用，并探讨[竞争风险](@entry_id:173277)、[未观测异质性](@entry_id:142880)等复杂场景下PH假设带来的挑战与洞见。最后，在第三章**“动手实践”**中，您将有机会通过解决具体问题，将理论[知识转化](@entry_id:893170)为实际操作技能。现在，让我们首先深入其内部，探索[比例风险假设](@entry_id:163597)的原理与机制。

## 原理与机制

在上一章中，我们已经对[比例风险模型](@entry_id:921975)有了初步的印象。现在，让我们像物理学家探索自然法则一样，深入其内部，欣赏其设计的精妙，理解其运作的机制，并学会如何“质问”它，以确保我们从数据中得到的结论是可靠的。

### 比例的魔力：将时间与风险因素分离

想象一下，我们正在研究一个事件，比如心脏病的发生。每个人发生事件的“瞬时风险”——我们称之为**[风险函数](@entry_id:166593) (hazard function)** $h(t)$——在生命的不同时刻是不断变化的。年轻时风险很低，随着年龄增长，风险逐渐攀升。这个随时[间变](@entry_id:902015)化的固有风险曲线，就像一条蜿蜒起伏的道路，对每个人来说都形态相似，但具体数值可能不同。

现在，我们想知道某个因素，比如是否服用一种新药，对这个风险有何影响。最简单的想法是，这个药物可能会将整个风险曲线向上或向下移动。但更优雅、也更强大的假设是，药物的作用是“成比例”的。这意味着，在任何时刻 $t$，服药者的风险都是未服药者风险的一个固定倍数。

这就是**[Cox比例风险模型](@entry_id:174252) (Cox Proportional Hazards model)** 的核心思想。它将[风险函数](@entry_id:166593) $h(t \mid x)$ 分解为两部分：

$$
h(t \mid x) = h_0(t) \exp(x^\top\beta)
$$

这里，$x$ 是一个包含我们感兴趣的各种因素（如用药、年龄、性别等）的向量。$h_0(t)$ 是**[基线风险函数](@entry_id:899532) (baseline hazard function)**，它代表了当所有因素 $x$ 都为零时，那个普适的、随时[间变](@entry_id:902015)化的“固有风险曲线”。它完全不依赖于个体特征，是所有人的“共性”。而 $\exp(x^\top\beta)$ 这一项，则完全由个体的特征 $x$ 决定，它像一个调节器，将基线风险进行“成比例”的缩放。$\beta$ 是我们要估计的系数，它量化了每个因素的影响力。

这个公式的美妙之处在于其惊人的分离性。如果我们想比较两个不同个体（拥有特征 $x_1$ 和 $x_2$）的风险，我们只需计算它们的比值：

$$
\frac{h(t \mid x_1)}{h(t \mid x_2)} = \frac{h_0(t) \exp(x_1^\top\beta)}{h_0(t) \exp(x_2^\top\beta)} = \exp((x_1 - x_2)^\top\beta)
$$

看到了吗？那个复杂的、我们一无所知的[基线风险函数](@entry_id:899532) $h_0(t)$，在比值中被神奇地约掉了！我们得到的这个比值，被称为**[风险比](@entry_id:173429) (Hazard Ratio, HR)**，它是一个不随时[间变](@entry_id:902015)化的常数 。这正是“[比例风险](@entry_id:166780)”这个名字的由来。它告诉我们，无论是在研究的第1天还是第10年，一个因素（比如服药）带来的[相对风险降低](@entry_id:922913)（或增加）的幅度是恒定的。这为我们[解释模型](@entry_id:925527)结果提供了极大的便利。

### 如何在“一无所知”中洞察真相：[偏似然](@entry_id:165240)的巧思

你可能会问：既然我们对 $h_0(t)$ 一无所知，我们又如何能估计出 $\beta$ 呢？这正是 David Cox 爵士的天才之处，他为此发明了**[偏似然](@entry_id:165240) (partial likelihood)** 的方法 。

这个想法非常巧妙。想象一下，在某个确切的时间点 $t_i$，我们观察到了一个事件的发生。让我们暂时忽略事件发生的确切时间，只关注“是谁”发生了事件。在 $t_i$ 这个时刻，有一群人（我们称之为**[风险集](@entry_id:917426) (risk set)**）都还“存活”并且有风险发生事件。[偏似然](@entry_id:165240)方法的核心问题是：**“鉴于在此刻[风险集](@entry_id:917426)中的某个人确实发生了事件，那么，事件恰好发生在我们观察到的这位特定患者身上的概率是多少？”**

这个[条件概率](@entry_id:151013)可以通过比较[风险集](@entry_id:917426)中每个人的风险来计算。对于[风险集](@entry_id:917426)中的任何一个个体 $j$，其在 $t_i$ 时刻的风险是 $h_j(t_i) = h_0(t_i)\exp(x_j^\top\beta)$。因此，我们观察到的患者 $i$ 发生事件的概率，相对于[风险集](@entry_id:917426)中所有其他人，就是：

$$
P(\text{患者 } i \text{ 发生事件} \mid \text{风险集中发生了一个事件}) = \frac{h_i(t_i)}{\sum_{j \in \text{风险集}} h_j(t_i)} = \frac{h_0(t_i)\exp(x_i^\top\beta)}{\sum_{j \in \text{风险集}} h_0(t_i)\exp(x_j^\top\beta)} = \frac{\exp(x_i^\top\beta)}{\sum_{j \in \text{风险集}} \exp(x_j^\top\beta)}
$$

再一次，那个神秘的 $h_0(t_i)$ 被完全约掉了！我们得到的这个概率表达式只与我们想要估计的 $\beta$ 和我们在数据中可以观察到的[协变](@entry_id:634097)量 $x$ 有关。通过将每一个事件发生时刻的这种概率连乘起来，我们就构建了一个只依赖于 $\beta$ 的“偏[似然函数](@entry_id:141927)”。最大化这个函数，我们就能得到对 $\beta$ 的估计，而全程无需对 $h_0(t)$ 的具体形态做任何假设。这使得[Cox模型](@entry_id:916493)成为一个强大的**[半参数模型](@entry_id:200031)**，它在[参数化](@entry_id:272587)的[协变](@entry_id:634097)量效应和非[参数化](@entry_id:272587)的基线风险之间取得了完美的平衡。

### 假设的检验：我们如何知道模型是否正确？

[比例风险假设](@entry_id:163597)赋予了[Cox模型](@entry_id:916493)强大的解释力和灵活性，但这一切都建立在一个关键前提上：这个假设本身是成立的。如果[风险比](@entry_id:173429)并非恒定，那么我们估计出的单一 $\beta$ 值就是对真实情况的一种误导性平均，可能会掩盖重要的动态变化。因此，对[比例风险假设](@entry_id:163597)的检验，是每一次[Cox模型](@entry_id:916493)分析中不可或缺的关键步骤。

#### 肉眼可见的线索：[生存曲线](@entry_id:924638)的[交叉](@entry_id:147634)与平行

在进行复杂的统计检验之前，我们的眼睛往往是最好的诊断工具。

一个最直观、最强烈的非比例性信号，是**[生存曲线](@entry_id:924638)的交叉** 。[生存曲线](@entry_id:924638) $S(t)$ 描绘了研究对象存活超过时间 $t$ 的概率。根据[比例风险](@entry_id:166780)的数学关系 $S(t \mid x) = [S_0(t)]^{\exp(x^\top\beta)}$，如果两组的[风险比](@entry_id:173429)（HR）不等于1，那么它们的[生存曲线](@entry_id:924638)除了在起点（$t=0$时$S=1$）相交外，永远不应该再次相交。如果一组的风险始终高于另一组（HR > 1），其[生存曲线](@entry_id:924638)将始终位于下方。反之亦然。因此，如果你在图中看到两条[生存曲线](@entry_id:924638)发生了交叉，比如一种疗法在早期看似有害（生存率更低），但在后期却显示出益处（生存率反超），这几乎是[比例风险假设](@entry_id:163597)被违背的“铁证”。这表明[风险比](@entry_id:173429)HR在随时[间变](@entry_id:902015)化，甚至改变了方向（从大于1变为小于1）。

一个更精细的图形诊断方法是**对数-负对数生存图 (log-minus-log survival plot)** 。这个名字听起来复杂，但其背后的逻辑很美。通过对[生存函数](@entry_id:267383)进行 $\log(-\log S(t))$ 的变换，我们可以得到一个与累积基线风险的对数呈[线性关系](@entry_id:267880)的量：

$$
\log(-\log S(t \mid x)) = \log(H_0(t)) + x^\top\beta
$$

这里 $H_0(t)$ 是累积基线风险。这个公式告诉我们，如果[比例风险假设](@entry_id:163597)成立，那么在对数-负对数图上，不同[协变](@entry_id:634097)量组的曲线应该具有完全相同的形状（由共同的 $\log(H_0(t))$ 决定），仅仅在垂直方向上有所平移（平移的量就是 $x^\top\beta$）。换句话说，**这些曲线应该是互相平行的**。如果曲线出现[交叉](@entry_id:147634)或者系统性地发散/收敛，就提示[比例风险假设](@entry_id:163597)可能不成立。一个等价的方法是绘制对数累积风险图（$\log \hat{H}(t)$ vs. $\log t$），其中 $\hat{H}(t)$ 是用Nelson-Aalen方法估计的[累积风险函数](@entry_id:169734)，其解释与对数-负对数图完全相同。

#### 侦探的工具箱：[Schoenfeld残差](@entry_id:925335)

图形诊断很直观，但我们需要更客观的量化工具。这就是**[Schoenfeld残差](@entry_id:925335) (Schoenfeld residuals)** 发挥作用的地方 。

[Schoenfeld残差](@entry_id:925335)的构想同样充满巧思。在每个事件发生的时间点 $t_i$，我们关注两件事：
1.  实际发生事件的那个人的协变量值，记为 $x_i$。
2.  在那个时刻，[风险集](@entry_id:917426)中所有人的“期望”[协变](@entry_id:634097)量值，记为 $\bar{x}(t_i, \hat{\beta})$。这个[期望值](@entry_id:153208)是根据模型赋予每个人的风险权重计算出来的[加权平均值](@entry_id:894528)。

[Schoenfeld残差](@entry_id:925335)就是这两者之差：$r_i = x_i - \bar{x}(t_i, \hat{\beta})$。它本质上是在问：“实际发生事件的这个人，其特征与我们模型在那个时刻预期的‘典型’失败者特征相比，有何不同？”

如果[比例风险假设](@entry_id:163597)成立，即协变量的影响 $\beta$ 不随时间改变，那么这些残差在时间轴上应该没有任何系统性的趋势，它们会像一群没有纪律的蜜蜂一样，随机地散布在0线上下。然而，如果一个协变量的影响实际上随时间减弱，那么在研究后期，模型（它假设效应不变）会低估该[协变](@entry_id:634097)量的作用，导致残差出现系统性的偏离。

**Grambsch–Therneau检验**  就是将这个想法形式化的统计检验。它通过一个回归模型来检验（经过尺度变换的）[Schoenfeld残差](@entry_id:925335)与时间之间是否存在显著的非零斜率。如果回归结果显示斜率在统计上显著不为零，我们就有力地拒绝了[比例风险假设](@entry_id:163597)，表明该[协变](@entry_id:634097)量的效应是时变的。

### 当比例性失效：更深层的机制与巧妙的对策

当我们发现[比例风险假设](@entry_id:163597)不成立时，一个更深层次的问题摆在了面前：为什么？这不仅仅是一个技术问题，它可能揭示了我们研究现象背后更复杂的生物学或社会学机制。

#### 时间的尺度：是年龄还是病程？

有时，非比例性的出现并非源于协变量效应本身的变化，而是因为我们选错了衡量“时间”的尺子 。在一个[流行病学](@entry_id:141409)[队列研究](@entry_id:910370)中，我们通常关心两个“时间”：一个是自进入研究开始计算的**研究时长 (time-on-study)**，另一个是参与者的**生理年龄 (attained age)**。

假设风险的真正驱动因素是生理年龄——毕竟，许多疾病的风险主要随年龄增长。但如果我们在模型中使用了研究时长作为时间轴，会发生什么？在研究时长为5年的[风险集](@entry_id:917426)中，会混杂着50岁加入研究现在55岁的人，和70岁加入研究现在75岁的人。他们的生理年龄和固有风险截然不同。如果某个我们关心的暴露因素（比如一种生活习惯）又恰好与年龄相关，那么这种在[风险集](@entry_id:917426)中对年龄的“混淆”就会扭曲我们对该暴露因素效应的估计，凭空制造出[非比例风险](@entry_id:902590)的假象。

正确的做法是，将生理年龄作为模型的时间轴。这意味着我们需要处理**延迟进入 (delayed entry)** 或**[左截断](@entry_id:909727) (left truncation)**，因为每个人的观测都是从他们各自的入组年龄才开始的。通过这样做，在任意年龄 $a$ 的[风险集](@entry_id:917426)中的个体，他们的年龄都是完全相同的。这就在非参数的基线风险 $h_0(a)$ 中完美地控制了年龄的复杂影响，从而可能让原本看似非比例的协变量效应，回归其比例性的“本真”。这个例子绝佳地说明了，对研究问题的深刻理解（风险的真正驱动力是什么）是选择正确[统计模型](@entry_id:165873)的关键。

#### 看不见的“脆弱”之手：[未观测异质性](@entry_id:142880)的影响

最微妙、也最引人深思的非比例性来源之一，是**未观测到的异质性 (unobserved heterogeneity)**，通常被称为**脆弱性 (frailty)** 。

想象一下，即使在协变量完全相同的人群中，个体之间仍然存在我们无法测量到的差异——有些人天生更“脆弱”，有些人则更“强健”。假设一个药物的疗效对于每一个个体来说都是恒定的（即条件性的[比例风险](@entry_id:166780)成立）。但是，当我们观察整个群体时，会发生一种动态的“筛选效应”：在治疗组和[对照组](@entry_id:747837)中，那些最脆弱的个体往往会更早地发生事件并退出[风险集](@entry_id:917426)。这个“[幸存者偏差](@entry_id:895963)”的过程在风险更高的组中发生得更快。

其结果是，随着时间的推移，两个组中仍在被观察的“幸存者”都变得越来越“强健”。这种成分上的动态变化，导致我们在群体层面观察到的**边际[风险比](@entry_id:173429) (marginal hazard ratio)** 会逐渐减弱，并向1趋近，即使真实的个体层面疗效恒定不变。这种效应被称为“易感人群的耗竭 (depletion of the susceptibles)”。

这就带来了诊断上的挑战 ：我们观察到的[风险比](@entry_id:173429)随时间衰减，究竟是因为药物的真实疗效随时间减弱，还是仅仅是这种由[未观测异质性](@entry_id:142880)引起的统计假象？一个有效的区分方法是，如果我们能找到一个很好的基线**预后评分**，它可以很好地代表个体的“脆弱”程度，那么我们可以在这个评分的不同[分层](@entry_id:907025)内部分析。如果在更同质的（即“脆弱性”相似的）人群[分层](@entry_id:907025)中，非比例现象消失了，那么异质性很可能就是“罪魁祸首”。反之，如果非比例现象（特别是像[生存曲线](@entry_id:924638)[交叉](@entry_id:147634)这种复杂模式）在每个[分层](@entry_id:907025)中都持续存在，那么它更可能反映了药物真实的、随时[间变](@entry_id:902015)化的生物学效应。

#### 模型的修正：[分层](@entry_id:907025)与时变系数

最后，当我们确信[比例风险假设](@entry_id:163597)不成立并理解其原因后，我们有多种方法来修正我们的模型。

如果非比例性是由一个[分类变量](@entry_id:637195)（如不同的临床中心）引起的，并且我们有理由相信每个中心的基线风险曲线形状不同，我们可以采用**[分层Cox模型](@entry_id:903440) (stratified Cox model)** 。[分层](@entry_id:907025)允许每个中心拥有自己独立的、非参数的[基线风险函数](@entry_id:899532) $h_{0s}(t)$，同时假设其他[协变](@entry_id:634097)量的效应 $\beta$ 在所有中心内部是共同的。这样，模型就适应了中心间的基线差异，而无需为其建立参数模型。

如果一个[协变](@entry_id:634097)量的效应确实随时[间变](@entry_id:902015)化，那么最好的方式就是坦然面对，并在模型中直接体现这一点。我们可以通过引入该协变量与时间函数的**[交互作用](@entry_id:164533)项**，来建立一个**时变系数 (time-varying coefficient)** 模型，即让 $\beta$ 成为时间 $t$ 的函数 $\beta(t)$ 。这虽然让[模型解释](@entry_id:637866)起来更复杂，但却能更真实地反映数据背后的动态过程。

总而言之，[比例风险假设](@entry_id:163597)是[Cox模型](@entry_id:916493)优雅与力量的基石，但它并非神圣不可侵犯。理解其内涵、学会诊断其是否成立、探究其失效的深层原因，并掌握修正模型的策略，是我们作为严谨的科学研究者，从数据中发掘可靠知识的必经之路。这趟旅程，充满了统计的智慧与科学的洞见。