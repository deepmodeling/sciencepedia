{
    "hands_on_practices": [
        {
            "introduction": "皮尔逊 $\\chi^2$ 统计量是评估模型拟合优度的基本工具，尤其适用于分组数据。它通过比较观测频数与模型预测的期望频数来量化模型与数据之间的一致性。本练习  将引导您手动完成计算过程，从而加深对“观测值与期望值比较”这一核心思想的理解。",
            "id": "4965716",
            "problem": "一项多中心外科手术结果研究评估了术后$30$天内发生感染的概率。在每个中心 $j$，研究人员记录了 $m_j$ 名患者和 $y_j$ 例感染。一个具有二项方差函数和逻辑连接函数的广义线性模型（GLM）被用于拟合分组二项数据，使用标准化的合并症指数 $x_j$ 作为单一协变量。拟合的线性预测变量是 $g(\\pi_j) = \\log\\!\\left(\\frac{\\pi_j}{1-\\pi_j}\\right) = \\beta_0 + \\beta_1 x_j$，其中 $\\pi_j$ 是中心 $j$ 的感染概率。最大似然估计值为 $\\hat{\\beta}_0 = \\ln\\!\\left(\\frac{0.2}{0.8}\\right)$ 和 $\\hat{\\beta}_1 = \\ln(2)$。五个中心的协变量、样本量和观测到的感染数如下：\n- $j=1$: $x_1 = 0$, $m_1 = 50$, $y_1 = 12$。\n- $j=2$: $x_2 = 1$, $m_2 = 60$, $y_2 = 18$。\n- $j=3$: $x_3 = 2$, $m_3 = 80$, $y_3 = 42$。\n- $j=4$: $x_4 = 3$, $m_4 = 90$, $y_4 = 55$。\n- $j=5$: $x_5 = 4$, $m_5 = 100$, $y_5 = 78$。\n\n从分组结果的二项模型出发，基于拟合模型下二项分布的均值和方差，推导中心 $j$ 的适当的皮尔逊残差，并通过将各中心的残差平方相加来构建皮尔逊拟合优度统计量。使用上述数据计算该拟合优度统计量。将最终统计量表示为一个实数。如果任何中间数值需要近似，请在最后一步之前以符号形式进行；本问题不需要对最终统计量进行四舍五入。",
            "solution": "该问题是有效的，因为它在科学上基于统计理论，问题提出得当且数据充分，并且陈述客观。\n\n该问题要求计算一个逻辑回归模型的皮尔逊拟合优度统计量，该模型拟合了来自五个外科中心的分组二项数据。\n\n该模型假设对于每个中心 $j$，观测到的感染数 $y_j$ 服从二项分布，$Y_j \\sim \\text{Binomial}(m_j, \\pi_j)$，其中 $m_j$ 是患者总数，$\\pi_j$ 是感染概率。$Y_j$ 的均值和方差由下式给出：\n$$\nE[Y_j] = m_j \\pi_j\n$$\n$$\n\\text{Var}(Y_j) = m_j \\pi_j (1 - \\pi_j)\n$$\n逻辑回归模型通过 logit 连接函数将概率 $\\pi_j$ 与线性预测变量 $\\eta_j = \\beta_0 + \\beta_1 x_j$ 联系起来：\n$$\n\\eta_j = \\text{logit}(\\pi_j) = \\ln\\left(\\frac{\\pi_j}{1-\\pi_j}\\right)\n$$\n第 $j$ 组的皮尔逊残差定义为观测计数 $y_j$ 和拟合计数 $\\hat{y}_j$ 之间的差值，并用模型下观测计数的估计标准差进行标准化。拟合计数为 $\\hat{y}_j = m_j \\hat{\\pi}_j$，其中 $\\hat{\\pi}_j$ 是中心 $j$ 的拟合概率。估计方差为 $\\widehat{\\text{Var}}(Y_j) = m_j \\hat{\\pi}_j (1 - \\hat{\\pi}_j)$。\n\n因此，中心 $j$ 的皮尔逊残差，记为 $r_{P,j}$，是：\n$$\nr_{P,j} = \\frac{y_j - E[Y_j]}{\\sqrt{\\widehat{\\text{Var}}(Y_j)}} = \\frac{y_j - m_j \\hat{\\pi}_j}{\\sqrt{m_j \\hat{\\pi}_j (1 - \\hat{\\pi}_j)}}\n$$\n皮尔逊拟合优度统计量，通常记为 $X^2$，是所有 $J$ 个中心的皮尔逊残差平方和：\n$$\nX^2 = \\sum_{j=1}^{J} r_{P,j}^2 = \\sum_{j=1}^{J} \\frac{(y_j - m_j \\hat{\\pi}_j)^2}{m_j \\hat{\\pi}_j (1 - \\hat{\\pi}_j)}\n$$\n在本问题中，我们有 $J=5$ 个中心。第一步是使用提供的模型参数的最大似然估计值 $\\hat{\\beta}_0 = \\ln(0.2/0.8) = \\ln(0.25)$ 和 $\\hat{\\beta}_1 = \\ln(2)$ 来计算每个中心的拟合概率 $\\hat{\\pi}_j$。\n\n中心 $j$ 的拟合线性预测变量是 $\\hat{\\eta}_j = \\hat{\\beta}_0 + \\hat{\\beta}_1 x_j$。\n$$\n\\hat{\\eta}_j = \\ln(0.25) + x_j \\ln(2) = \\ln(0.25 \\cdot 2^{x_j}) = \\ln(2^{-2} \\cdot 2^{x_j}) = \\ln(2^{x_j-2})\n$$\n为了求出拟合概率 $\\hat{\\pi}_j$，我们应用逆 logit 函数：\n$$\n\\hat{\\pi}_j = \\text{logit}^{-1}(\\hat{\\eta}_j) = \\frac{\\exp(\\hat{\\eta}_j)}{1 + \\exp(\\hat{\\eta}_j)} = \\frac{\\exp(\\ln(2^{x_j-2}))}{1 + \\exp(\\ln(2^{x_j-2}))} = \\frac{2^{x_j-2}}{1 + 2^{x_j-2}}\n$$\n将分子和分母同乘以 $2^2=4$ 得到一个更便于计算的形式：\n$$\n\\hat{\\pi}_j = \\frac{4 \\cdot 2^{x_j-2}}{4 \\cdot (1 + 2^{x_j-2})} = \\frac{2^2 \\cdot 2^{x_j-2}}{4 + 4 \\cdot 2^{x_j-2}} = \\frac{2^{x_j}}{4 + 2^{x_j}}\n$$\n我们现在为五个中心中的每一个计算 $X^2$ 统计量的分量。\n\n对于中心 $j=1$：\n$x_1=0$, $m_1=50$, $y_1=12$。\n$\\hat{\\pi}_1 = \\frac{2^0}{4+2^0} = \\frac{1}{5} = 0.2$。\n拟合计数：$\\hat{y}_1 = m_1 \\hat{\\pi}_1 = 50 \\times 0.2 = 10$。\n估计方差：$m_1 \\hat{\\pi}_1 (1-\\hat{\\pi}_1) = 50 \\times 0.2 \\times (1-0.2) = 10 \\times 0.8 = 8$。\n残差平方：$\\frac{(y_1 - \\hat{y}_1)^2}{m_1 \\hat{\\pi}_1 (1-\\hat{\\pi}_1)} = \\frac{(12-10)^2}{8} = \\frac{2^2}{8} = \\frac{4}{8} = 0.5$。\n\n对于中心 $j=2$：\n$x_2=1$, $m_2=60$, $y_2=18$。\n$\\hat{\\pi}_2 = \\frac{2^1}{4+2^1} = \\frac{2}{6} = \\frac{1}{3}$。\n拟合计数：$\\hat{y}_2 = m_2 \\hat{\\pi}_2 = 60 \\times \\frac{1}{3} = 20$。\n估计方差：$m_2 \\hat{\\pi}_2 (1-\\hat{\\pi}_2) = 60 \\times \\frac{1}{3} \\times (1-\\frac{1}{3}) = 20 \\times \\frac{2}{3} = \\frac{40}{3}$。\n残差平方：$\\frac{(y_2 - \\hat{y}_2)^2}{m_2 \\hat{\\pi}_2 (1-\\hat{\\pi}_2)} = \\frac{(18-20)^2}{40/3} = \\frac{(-2)^2}{40/3} = \\frac{4 \\times 3}{40} = \\frac{12}{40} = 0.3$。\n\n对于中心 $j=3$：\n$x_3=2$, $m_3=80$, $y_3=42$。\n$\\hat{\\pi}_3 = \\frac{2^2}{4+2^2} = \\frac{4}{8} = \\frac{1}{2} = 0.5$。\n拟合计数：$\\hat{y}_3 = m_3 \\hat{\\pi}_3 = 80 \\times 0.5 = 40$。\n估计方差：$m_3 \\hat{\\pi}_3 (1-\\hat{\\pi}_3) = 80 \\times 0.5 \\times (1-0.5) = 40 \\times 0.5 = 20$。\n残差平方：$\\frac{(y_3 - \\hat{y}_3)^2}{m_3 \\hat{\\pi}_3 (1-\\hat{\\pi}_3)} = \\frac{(42-40)^2}{20} = \\frac{2^2}{20} = \\frac{4}{20} = 0.2$。\n\n对于中心 $j=4$：\n$x_4=3$, $m_4=90$, $y_4=55$。\n$\\hat{\\pi}_4 = \\frac{2^3}{4+2^3} = \\frac{8}{12} = \\frac{2}{3}$。\n拟合计数：$\\hat{y}_4 = m_4 \\hat{\\pi}_4 = 90 \\times \\frac{2}{3} = 60$。\n估计方差：$m_4 \\hat{\\pi}_4 (1-\\hat{\\pi}_4) = 90 \\times \\frac{2}{3} \\times (1-\\frac{2}{3}) = 60 \\times \\frac{1}{3} = 20$。\n残差平方：$\\frac{(y_4 - \\hat{y}_4)^2}{m_4 \\hat{\\pi}_4 (1-\\hat{\\pi}_4)} = \\frac{(55-60)^2}{20} = \\frac{(-5)^2}{20} = \\frac{25}{20} = 1.25$。\n\n对于中心 $j=5$：\n$x_5=4$, $m_5=100$, $y_5=78$。\n$\\hat{\\pi}_5 = \\frac{2^4}{4+2^4} = \\frac{16}{20} = \\frac{4}{5} = 0.8$。\n拟合计数：$\\hat{y}_5 = m_5 \\hat{\\pi}_5 = 100 \\times 0.8 = 80$。\n估计方差：$m_5 \\hat{\\pi}_5 (1-\\hat{\\pi}_5) = 100 \\times 0.8 \\times (1-0.8) = 80 \\times 0.2 = 16$。\n残差平方：$\\frac{(y_5 - \\hat{y}_5)^2}{m_5 \\hat{\\pi}_5 (1-\\hat{\\pi}_5)} = \\frac{(78-80)^2}{16} = \\frac{(-2)^2}{16} = \\frac{4}{16} = 0.25$。\n\n最后，皮尔逊拟合优度统计量 $X^2$ 是这些残差平方的总和：\n$$\nX^2 = 0.5 + 0.3 + 0.2 + 1.25 + 0.25\n$$\n$$\nX^2 = (0.5 + 0.3 + 0.2) + (1.25 + 0.25) = 1.0 + 1.5 = 2.5\n$$\n皮尔逊拟合优度统计量的值是 $2.5$。",
            "answer": "$$\n\\boxed{2.5}\n$$"
        },
        {
            "introduction": "在评估模型时，我们不仅关心统计拟合度，更关心其预测的准确性。布里尔分数 (Brier score) 是一种“固有评分规则” (proper scoring rule)，专门用于衡量概率预测的质量。本练习  演示了如何量化一个模型相对于简单基线模型的性能提升，这在临床预测和机器学习应用中是一项至关重要的技能。",
            "id": "4965723",
            "problem": "一家医院部署了一个基于逻辑回归（LR）的风险模型，用于筛查前来急诊科就诊的成年患者中的隐性菌血症。该模型输出菌血症的预测概率，下游决策是使用一个阈值进行的，但此处的目的在于使用一个严格评分规则来评估模型的拟合优度。考虑一个包含 $N=20$ 名患者的留出评估集，其中包含来自LR模型的样本外预测概率和编码为 $y_{i} \\in \\{0,1\\}$ 的观测结果，其中 $y_{i}=1$ 表示确诊菌血症病例，$y_{i}=0$ 表示无菌血症。评估使用二元事件的平方误差评分进行，其技巧（skill）相对于一个基线模型来衡量，该基线模型为评估集中的每个个体预测观测到的患病率。这个基线反映了一个恒定概率的“气候学”模型，该模型在忽略个体层面特征的筛查情境下是合适的。\n\n这 $20$ 名患者具有以下 $(p_{i}, y_{i})$ 对：\n\n- 4 名患者，$p_{i}=0.05$ 且 $y_{i}=0$。\n- 2 名患者，$p_{i}=0.10$ 且 $y_{i}=0$。\n- 3 名患者，$p_{i}=0.40$ 且 $y_{i}=0$。\n- 2 名患者，$p_{i}=0.60$ 且 $y_{i}=0$。\n- 4 名患者，$p_{i}=0.85$ 且 $y_{i}=1$。\n- 3 名患者，$p_{i}=0.70$ 且 $y_{i}=1$。\n- 2 名患者，$p_{i}=0.20$ 且 $y_{i}=1$。\n\n计算LR模型相对于预测观测患病率的基线模型的布里尔技能分数（BSS）。然后，在所述的医学筛查情境下解释BSS的大小，重点说明其相对于基线在平方误差风险方面的改进意味着什么。将布里尔技能分数的数值答案四舍五入到四位有效数字。不需要单位。",
            "solution": "该评估对二元结果的概率性预测使用了一个严格评分规则，具体来说是平方误差分数。对于单个预测 $p_{i}$ 和结果 $y_{i} \\in \\{0,1\\}$，其对布里尔分数的贡献是 $(p_{i} - y_{i})^{2}$。模型在 $N$ 个观测值上的布里尔分数是这些平方误差的平均值：\n$$\n\\text{BS}_{\\text{model}} = \\frac{1}{N} \\sum_{i=1}^{N} (p_{i} - y_{i})^{2}.\n$$\n在此筛查情境中，基线模型为每个个体预测一个等于观测患病率 $\\bar{y} = \\frac{1}{N} \\sum_{i=1}^{N} y_{i}$ 的恒定概率。对于这个恒定预测器，布里尔分数可以通过以结果为条件，从第一性原理推导得出：\n- 当 $y_{i}=1$ 时，平方误差为 $(1 - \\bar{y})^{2}$。\n- 当 $y_{i}=0$ 时，平方误差为 $\\bar{y}^{2}$。\n对 $y_{i}$ 的分布取平均，并使用 $\\mathbb{P}(y_{i}=1)=\\bar{y}$ 和 $\\mathbb{P}(y_{i}=0)=1-\\bar{y}$，可得\n$$\n\\text{BS}_{\\text{baseline}} = \\bar{y} \\cdot (1 - \\bar{y})^{2} + (1 - \\bar{y}) \\cdot \\bar{y}^{2} = \\bar{y}(1-\\bar{y}).\n$$\n布里尔技能分数（BSS）将相对于基线的改进量化为\n$$\n\\text{BSS} = 1 - \\frac{\\text{BS}_{\\text{model}}}{\\text{BS}_{\\text{baseline}}}.\n$$\n$\\text{BSS} > 0$ 表示性能优于基线；$\\text{BSS}=0$ 表示性能与基线相同；$\\text{BSS} < 0$ 表示性能差于基线。\n\n我们现在根据给定数据计算这些量。\n\n步骤1：计算观测患病率 $\\bar{y}$。\n阳性病例总数为 $4+3+2=9$（来自三个阳性组），且 $N=20$，所以\n$$\n\\bar{y} = \\frac{9}{20} = 0.45.\n$$\n因此，\n$$\n\\text{BS}_{\\text{baseline}} = \\bar{y}(1-\\bar{y}) = \\frac{9}{20}\\cdot\\frac{11}{20} = \\frac{99}{400} = 0.2475.\n$$\n\n步骤2：通过对所有患者的 $(p_{i}-y_{i})^{2}$求和再除以$N$来计算 $\\text{BS}_{\\text{model}}$。\n\n对于 $y_{i}=0$，平方误差为 $p_{i}^{2}$：\n- 4 名患者，$p_{i}=0.05$：和 $= 4 \\cdot (0.05)^{2} = 4 \\cdot 0.0025 = 0.01$。\n- 2 名患者，$p_{i}=0.10$：和 $= 2 \\cdot (0.10)^{2} = 2 \\cdot 0.01 = 0.02$。\n- 3 名患者，$p_{i}=0.40$：和 $= 3 \\cdot (0.40)^{2} = 3 \\cdot 0.16 = 0.48$。\n- 2 名患者，$p_{i}=0.60$：和 $= 2 \\cdot (0.60)^{2} = 2 \\cdot 0.36 = 0.72$。\n阴性病例总计：\n$$\nS_{0} = 0.01 + 0.02 + 0.48 + 0.72 = 1.23.\n$$\n\n对于 $y_{i}=1$，平方误差为 $(1-p_{i})^{2}$：\n- 4 名患者，$p_{i}=0.85$：和 $= 4 \\cdot (1 - 0.85)^{2} = 4 \\cdot (0.15)^{2} = 4 \\cdot 0.0225 = 0.09$。\n- 3 名患者，$p_{i}=0.70$：和 $= 3 \\cdot (1 - 0.70)^{2} = 3 \\cdot (0.30)^{2} = 3 \\cdot 0.09 = 0.27$。\n- 2 名患者，$p_{i}=0.20$：和 $= 2 \\cdot (1 - 0.20)^{2} = 2 \\cdot (0.80)^{2} = 2 \\cdot 0.64 = 1.28$。\n阳性病例总计：\n$$\nS_{1} = 0.09 + 0.27 + 1.28 = 1.64.\n$$\n\n对所有 $N=20$ 名患者求和：\n$$\n\\sum_{i=1}^{N} (p_{i} - y_{i})^{2} = S_{0} + S_{1} = 1.23 + 1.64 = 2.87.\n$$\n因此，\n$$\n\\text{BS}_{\\text{model}} = \\frac{2.87}{20} = \\frac{287}{2000} = 0.1435.\n$$\n\n步骤3：计算布里尔技能分数。\n使用精确分数，\n$$\n\\frac{\\text{BS}_{\\text{model}}}{\\text{BS}_{\\text{baseline}}} = \\frac{\\frac{287}{2000}}{\\frac{99}{400}} = \\frac{287}{2000} \\cdot \\frac{400}{99} = \\frac{287}{5 \\cdot 99} = \\frac{287}{495}.\n$$\n因此，\n$$\n\\text{BSS} = 1 - \\frac{287}{495} = \\frac{495 - 287}{495} = \\frac{208}{495}.\n$$\n转换为小数并四舍五入到四位有效数字，\n$$\n\\text{BSS} = \\frac{208}{495} \\approx 0.4202 \\quad \\text{(四位有效数字)}.\n$$\n\n在医学筛查情境下的解释：布里尔技能分数为 $0.4202$ 表明，相对于为每位患者预测观测患病率的基线模型，逻辑回归模型将概率性预测的均方误差减少了大约 $42.02\\%$。从筛查的角度来看，这一数值反映了在校准风险估计方面，相较于仅使用患病率的预测有了实质性的改进，这意味着模型提供了显著更优的个体化概率预测，能够支持比单独基于患病率的决策阈值更为有效的决策阈值。",
            "answer": "$$\\boxed{0.4202}$$"
        },
        {
            "introduction": "一个优秀的预测模型不仅需要能准确地对患者进行风险排序（区分度），还需要其预测的概率值本身是准确的（校准度）。本练习  通过一个思想实验，揭示了为何一个模型可以拥有出色的区分度（如高 AUC 值），但其校准度却可能很差。这对于那些用于辅助决策的模型来说，是一个至关重要的洞见。",
            "id": "4965808",
            "problem": "一家医院开发了一个临床决策支持系统，使用逻辑回归模型来预测因急性失代偿性心力衰竭入院患者的$30$天死亡率。令 $Y \\in \\{0,1\\}$ 表示$30$天内的死亡情况，令 $S$ 表示模型的线性预测变量，因此在给定 $S$ 的情况下，真实的死亡条件概率为 $P(Y=1 \\mid S=s) = \\sigma(s)$，其中 $\\sigma(z) = \\frac{1}{1+\\exp(-z)}$ 是逻辑斯谛函数，$\\logit(p) = \\ln\\!\\left(\\frac{p}{1-p}\\right)$ 是其反函数。模型的预测概率为 $\\hat{\\pi} = \\sigma(S)$，因此根据构造，该模型是完美校准的。\n\n一位研究者希望在不改变排序的情况下“锐化”风险分层。他们提出了一个变换后的预测 $\\tilde{\\pi} = g(\\hat{\\pi})$，定义为\n$$\n\\tilde{\\pi} \\equiv \\sigma\\!\\big(a + b\\,\\logit(\\hat{\\pi})\\big),\n$$\n其中常数 $a \\in \\mathbb{R}$ 且 $b>0$。考虑具体选择 $a = 0.4$ 和 $b = 2$。\n\n仅使用基本定义，完成以下任务：\n- 证明 $g$ 在 $(0,1)$ 上是严格递增的，因此保留了由 $\\hat{\\pi}$ 引导的患者排序。\n- 从受试者工作特征曲线下面积（AUC）的定义 $\\,\\mathrm{AUC} = P\\big(S_{1} > S_{0}\\big)$ 出发，其中 $S_{1}$ 是随机选择的病例（$Y=1$）的得分，$S_{0}$ 是随机选择的对照（$Y=0$）的得分，论证任何对得分的严格递增变换都会保留AUC。\n- 从第一性原理出发，推导 $Y$ 与变换后的线性预测变量 $S' \\equiv \\logit(\\tilde{\\pi}) = a + b S$ 之间的人群校准关系，即，将 $\\logit\\!\\big(P(Y=1 \\mid S'=s')\\big)$ 推导为 $s'$ 的线性函数。确定校准截距和校准斜率。\n- 最后，对于给定的 $(a,b) = (0.4, 2)$，数值计算校准斜率。\n\n将最终答案以校准斜率的单一数值形式给出。无需四舍五入；给出精确值。",
            "solution": "该问题提法清晰，有科学依据，并为完整的推导提供了所有必要的信息。\n\n该问题要求对一个变换后的逻辑回归预测变量进行四部分分析。让我们系统地处理每个部分。最初的完美校准模型有一个线性预测变量 $S$，使得事件 $Y=1$ 的真实概率由 $P(Y=1 \\mid S=s) = \\sigma(s)$ 给出，其中 $\\sigma(z) = (1+\\exp(-z))^{-1}$ 是逻辑斯谛函数。模型的预测概率是 $\\hat{\\pi} = \\sigma(S)$。\n\n研究者提出了一个变换后的预测 $\\tilde{\\pi} = g(\\hat{\\pi})$，其中变换函数为 $g(p) = \\sigma(a + b\\,\\logit(p))$，对于 $p \\in (0,1)$，常数 $a \\in \\mathbb{R}$ 且 $b>0$。\n\n**第一部分：证明 $g$ 在 $(0,1)$ 上是严格递增的**\n\n为了证明函数 $g(p)$ 在 $p \\in (0,1)$ 上是严格递增的，我们必须证明它的一阶导数 $g'(p)$ 在此区间上严格为正。我们使用链式法则进行微分。\n令 $u(p) = a + b\\,\\logit(p)$。那么 $g(p) = \\sigma(u(p))$。\n其导数为 $g'(p) = \\sigma'(u(p)) \\cdot u'(p)$。\n\n首先，我们求出各组成函数的导数。logit函数 $\\logit(p) = \\ln(p) - \\ln(1-p)$ 的导数是：\n$$\n\\frac{d}{dp}\\logit(p) = \\frac{1}{p} - \\frac{-1}{1-p} = \\frac{1}{p} + \\frac{1}{1-p} = \\frac{1-p+p}{p(1-p)} = \\frac{1}{p(1-p)}\n$$\n对于任何 $p \\in (0,1)$， $p$ 和 $1-p$ 都是正数，所以它们的乘积 $p(1-p)$ 是正数。因此，对于 $p \\in (0,1)$，$\\frac{d}{dp}\\logit(p) > 0$。\n\n逻辑斯谛函数 $\\sigma(z)$ 的导数是：\n$$\n\\sigma'(z) = \\frac{d}{dz}\\left(\\frac{1}{1+\\exp(-z)}\\right) = -\\frac{-\\exp(-z)}{(1+\\exp(-z))^2} = \\frac{\\exp(-z)}{(1+\\exp(-z))^2}\n$$\n这也可以写成 $\\sigma'(z) = \\sigma(z)(1-\\sigma(z))$。由于 $\\sigma(z)$ 将 $\\mathbb{R}$ 映射到 $(0,1)$，对于任何有限的 $z$，$\\sigma(z)$ 和 $1-\\sigma(z)$ 都是严格为正的。因此，对于所有 $z \\in \\mathbb{R}$，$\\sigma'(z) > 0$。\n\n现在，我们计算 $u'(p)$：\n$$\nu'(p) = \\frac{d}{dp}\\big(a + b\\,\\logit(p)\\big) = b \\cdot \\frac{d}{dp}\\logit(p) = \\frac{b}{p(1-p)}\n$$\n已知 $b>0$ 且 $p \\in (0,1)$，因此 $u'(p) > 0$。\n\n最后，组合导数 $g'(p)$：\n$$\ng'(p) = \\sigma'(u(p)) \\cdot u'(p)\n$$\n正如已证明的，$\\sigma'(u(p))$ 是正的，因为 $u(p)$ 的值域是 $\\mathbb{R}$ 的一个子集，并且 $u'(p)$ 是正的。两个正数的乘积是正的。\n$$\ng'(p) > 0 \\quad \\text{for all } p \\in (0,1)\n$$\n这证实了 $g(p)$ 在其定义域上是一个严格递增的函数。因此，这个变换保留了由 $\\hat{\\pi}$ 决定的患者风险排序。\n\n**第二部分：论证AUC被保留**\n\n受试者工作特征曲线下面积（AUC）被定义为随机选择的阳性病例（$Y=1$）的得分高于随机选择的阴性病例（$Y=0$）的得分的概率。令 $\\hat{\\pi}_1$ 为随机病例的得分，$\\hat{\\pi}_0$ 为随机对照的得分。原始模型的AUC为 $\\mathrm{AUC}_{\\hat{\\pi}} = P(\\hat{\\pi}_1 > \\hat{\\pi}_0)$。问题陈述使用线性预测变量 $S$ 进行定义，$\\mathrm{AUC} = P(S_1 > S_0)$；由于 $\\hat{\\pi}=\\sigma(S)$ 且 $\\sigma$ 是严格递增的，排序是相同的，所以 $P(S_1 > S_0) = P(\\hat{\\pi}_1 > \\hat{\\pi}_0)$。\n\n新的得分由变换 $\\tilde{\\pi} = g(\\hat{\\pi})$ 给出。新得分的AUC为 $\\mathrm{AUC}_{\\tilde{\\pi}} = P(\\tilde{\\pi}_1 > \\tilde{\\pi}_0)$。\n我们已经证明函数 $g$ 是严格递增的。一个严格递增的函数保持序关系，这意味着对于其定义域中的任意两个值 $x_1, x_2$，$x_1 > x_2 \\iff g(x_1) > g(x_2)$。\n将此应用于我们的得分，不等式 $\\hat{\\pi}_1 > \\hat{\\pi}_0$ 成立当且仅当不等式 $g(\\hat{\\pi}_1) > g(\\hat{\\pi}_0)$ 成立。这等价于 $\\tilde{\\pi}_1 > \\tilde{\\pi}_0$。\n因此，事件 $\\{\\hat{\\pi}_1 > \\hat{\\pi}_0\\}$ 和 $\\{\\tilde{\\pi}_1 > \\tilde{\\pi}_0\\}$ 是相同的。因为事件相同，它们的概率必须相等：\n$$\nP(\\hat{\\pi}_1 > \\hat{\\pi}_0) = P(\\tilde{\\pi}_1 > \\tilde{\\pi}_0)\n$$\n因此，$\\mathrm{AUC}_{\\hat{\\pi}} = \\mathrm{AUC}_{\\tilde{\\pi}}$。任何对模型得分的严格递增变换都会保留AUC，因为AUC仅依赖于得分的排序，而这种排序在此类变换下是不变的。\n\n**第三部分：推导 $S'$ 的人群校准关系**\n\n新的线性预测变量定义为 $S' \\equiv \\logit(\\tilde{\\pi})$。我们首先用原始线性预测变量 $S$ 来表示 $S'$。\n我们已知 $\\tilde{\\pi} = \\sigma(a + b\\,\\logit(\\hat{\\pi}))$。\n我们也知道 $\\hat{\\pi} = \\sigma(S)$，并且因为 $\\logit$ 是 $\\sigma$ 的反函数，我们有 $\\logit(\\hat{\\pi}) = \\logit(\\sigma(S)) = S$。\n将此代入 $\\tilde{\\pi}$ 的表达式中：\n$$\n\\tilde{\\pi} = \\sigma(a + bS)\n$$\n现在，我们可以求出 $S'$：\n$$\nS' = \\logit(\\tilde{\\pi}) = \\logit(\\sigma(a + bS)) = a + bS\n$$\n我们需要推导校准关系，即 $\\logit\\!\\big(P(Y=1 \\mid S'=s')\\big)$ 关于 $s'$ 的函数形式。\n条件 $S' = s'$ 等价于 $a + bS = s'$，可以解出 $S$：\n$$\nS = \\frac{s' - a}{b}\n$$\n因此，以 $S'=s'$为条件等价于以 $S = \\frac{s' - a}{b}$ 为条件。\n我们可以写出：\n$$\nP(Y=1 \\mid S'=s') = P\\left(Y=1 \\mid S = \\frac{s' - a}{b}\\right)\n$$\n问题陈述原始模型是完美校准的，这意味着对于任何值 $s$，$P(Y=1 \\mid S=s) = \\sigma(s)$。我们应用这个基本关系：\n$$\nP(Y=1 \\mid S'=s') = \\sigma\\left(\\frac{s' - a}{b}\\right)\n$$\n为了在 logit 尺度上找到校准关系，我们对两边应用 $\\logit$ 函数：\n$$\n\\logit\\!\\big(P(Y=1 \\mid S'=s')\\big) = \\logit\\left(\\sigma\\left(\\frac{s' - a}{b}\\right)\\right)\n$$\n由于 $\\logit$ 和 $\\sigma$ 是反函数，$\\logit(\\sigma(z))=z$。因此：\n$$\n\\logit\\!\\big(P(Y=1 \\mid S'=s')\\big) = \\frac{s' - a}{b}\n$$\n将其重写为标准线性形式（截距 + 斜率 $\\times$ 预测变量）：\n$$\n\\logit\\!\\big(P(Y=1 \\mid S'=s')\\big) = -\\frac{a}{b} + \\frac{1}{b}s'\n$$\n这就是所求的校准关系。真实对数优势比与新预测变量 $s'$ 之间的关系是线性的。\n\n校准截距是常数项 $-\\frac{a}{b}$。\n校准斜率是预测变量 $s'$ 的系数，即 $\\frac{1}{b}$。\n\n**第四部分：计算校准斜率**\n\n问题给出了具体的参数值 $a=0.4$ 和 $b=2$。\n使用上面推导出的校准斜率公式：\n$$\n\\text{校准斜率} = \\frac{1}{b}\n$$\n代入 $b=2$：\n$$\n\\text{校准斜率} = \\frac{1}{2}\n$$\n校准斜率的数值是 $0.5$。",
            "answer": "$$\n\\boxed{0.5}\n$$"
        }
    ]
}