{
    "hands_on_practices": [
        {
            "introduction": "理论与实践之间的桥梁通常是通过精确的计算来搭建的。虽然大样本正态近似在样本量估算中很方便，但它们在小样本情况下可能会不准确。这个练习将引导您回归第一性原理，当方差未知时，使用非中心$t$分布推导单样本$t$检验的精确功效函数，并要求您设计一个数值算法来求解所需的最小样本量。掌握这项技能对于在样本量有限的研究中进行严谨的统计功效分析至关重要。",
            "id": "4979726",
            "problem": "一项临床药理学研究中的单样本均值比较将在方差未知的高斯抽样模型下进行分析。设 $\\{X_i\\}_{i=1}^n$ 是独立同分布的，其中 $X_i \\sim \\mathcal{N}(\\mu,\\sigma^2)$，且 $\\sigma^2$ 未知。考虑使用由样本均值和无偏样本方差构建的常规 Student $t$ 统计量，检验原假设 $H_0:\\mu=\\mu_0$ 与双侧备择假设 $H_1:\\mu\\neq\\mu_0$。定义标准化效应大小 $d=(\\mu_1-\\mu_0)/\\sigma$，其中 $\\mu_1$ 是备择假设下的真实均值，并在 I 型错误水平 $\\alpha\\in(0,1)$ 下定义目标功效 $\\pi\\in(0,1)$。\n\n仅从以下基本事实出发：(i) 如果 $Z\\sim\\mathcal{N}(0,1)$ 和 $U\\sim\\chi^2_\\nu$ 独立，则中心 Student $t$ 变量为 $T=Z/\\sqrt{U/\\nu}$；(ii) 在非零均值偏移下，比率 $T_\\text{alt}=(Z+\\delta)/\\sqrt{U/\\nu}$ 服从自由度为 $\\nu$、非中心化参数为 $\\delta$ 的非中心 Student $t$ 分布；(iii) 对于来自 $\\mathcal{N}(\\mu,\\sigma^2)$ 的 $n$ 个观测值的单样本 $t$ 统计量，自由度为 $\\nu=n-1$，并且在 $H_1:\\mu=\\mu_1$ 下，非中心化参数等于 $\\delta(n)=\\sqrt{n}\\,d$，推导双侧 $t$ 检验的功效 $\\mathsf{Power}(n)$ 作为 $n$、$\\alpha$ 和 $d$ 的函数表达式，该表达式应使用非中心 Student $t$ 分布的累积分布函数来表示。然后，设计并实现一个数值算法，以找到满足 $\\mathsf{Power}(n)\\geq \\pi$ 的最小整数 $n\\geq 2$。\n\n您的实现必须遵守以下计算和输出要求：\n- 您必须使用有限 $n$ 的精确非中心 Student $t$ 分布；不允许使用渐近或正态近似。\n- 所有角度均不相关。不涉及物理单位。所有概率必须指定并解释为 $(0,1)$ 内的小数。\n- 如果 $d=0$，请推断对于任何有限的 $n$，$\\mathsf{Power}(n)$ 会发生什么，并在您的算法中一致地处理此边界情况：如果 $\\pi>\\alpha$，则声明没有有限的 $n$ 可以达到目标功效；如果 $\\pi\\leq \\alpha$，则返回最小的有效 $n$。\n- 您的算法必须是单调性感知的，并且必须返回达到目标功效的最小 $n$。它应该通过一个可证明终止的搜索过程，在整数上对 $\\mathsf{Power}(n)$ 进行区间限定然后反演。\n\n测试套件。您的程序必须为以下每个双侧检验的参数集 $(d,\\alpha,\\pi)$ 计算最小的 $n$：\n- 案例 1：$(d,\\alpha,\\pi)=(0.5,0.05,0.8)$。\n- 案例 2：$(d,\\alpha,\\pi)=(0.2,0.05,0.8)$。\n- 案例 3：$(d,\\alpha,\\pi)=(1.0,0.05,0.9)$。\n- 案例 4：$(d,\\alpha,\\pi)=(0.0,0.05,0.8)$。\n- 案例 5：$(d,\\alpha,\\pi)=(0.5,0.10,0.5)$。\n\n最终输出格式。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。对于上述五个案例，输出 $[n_1,n_2,n_3,n_4,n_5]$，其中 $n_j$ 是案例 $j$ 的最小整数样本量，如果无法通过有限样本量达到所要求的功效，$n_4$ 必须是浮点无穷大，以浮点值的形式写入，以便在编程语言打印时显示为 $inf$。",
            "solution": "该问题是有效的，因为它在科学上基于已建立的统计理论，问题提法明确且客观。它提供了一套完整且一致的定义和约束，这对于推导出唯一且有意义的解是必要的。该任务是统计功效分析中的一个标准问题，需要严格应用统计分布理论和数值方法。\n\n我们首先推导指定的单样本、双侧 Student's $t$ 检验的功效函数。\n\n检验统计量由 $T = \\frac{\\bar{X} - \\mu_0}{S/\\sqrt{n}}$ 给出，其中 $\\bar{X}$ 是样本均值， $S^2$ 是来自大小为 $n$ 的样本的无偏样本方差。\n\n在原假设 $H_0: \\mu = \\mu_0$ 下，样本从 $\\mathcal{N}(\\mu_0, \\sigma^2)$ 中抽取。检验统计量 $T$ 服从自由度为 $\\nu = n-1$ 的中心 Student's $t$ 分布，记为 $T \\sim t_{n-1}$。\n\n该检验是双侧的，I 型错误率为 $\\alpha$。如果 $|T| > c$，我们拒绝 $H_0$，其中 $c$ 是临界值。此临界值是自由度为 $n-1$ 的中心 $t$ 分布的上 $\\alpha/2$ 分位数。我们定义 $c(n) \\equiv t_{1-\\alpha/2, n-1}$，其中 $t_{q, \\nu}$ 是 $t_\\nu$ 分布的第 $q$ 个分位数。因此，拒绝域为 $T  -c(n)$ 或 $T > c(n)$。\n\n检验的功效 $\\mathsf{Power}(n)$ 是在备择假设 $H_1: \\mu = \\mu_1$ 为真时拒绝 $H_0$ 的概率。\n$$\n\\mathsf{Power}(n) = P\\left( |T| > c(n) \\mid H_1 \\right) = P\\left( T > c(n) \\mid H_1 \\right) + P\\left( T  -c(n) \\mid H_1 \\right)\n$$\n为了评估此概率，我们必须确定 $T$ 在 $H_1$ 下的分布。我们可以将该统计量重写为：\n$$\nT = \\frac{\\bar{X} - \\mu_0}{S/\\sqrt{n}} = \\frac{(\\bar{X} - \\mu_1) + (\\mu_1 - \\mu_0)}{S/\\sqrt{n}}\n$$\n将分子和分母除以 $\\sigma/\\sqrt{n}$ 得到：\n$$\nT = \\frac{\\frac{\\bar{X} - \\mu_1}{\\sigma/\\sqrt{n}} + \\frac{\\mu_1 - \\mu_0}{\\sigma/\\sqrt{n}}}{S/\\sigma} = \\frac{\\frac{\\bar{X} - \\mu_1}{\\sigma/\\sqrt{n}} + \\sqrt{n} \\frac{\\mu_1 - \\mu_0}{\\sigma}}{S/\\sigma}\n$$\n根据所提供的事实：\n(i) 在 $H_1$ 下，$Z = \\frac{\\bar{X} - \\mu_1}{\\sigma/\\sqrt{n}} \\sim \\mathcal{N}(0,1)$。\n(ii) 根据 Cochran 定理，$U = \\frac{(n-1)S^2}{\\sigma^2} \\sim \\chi^2_{n-1}$ 且与 $Z$ 独立。因此，$S/\\sigma = \\sqrt{U/(n-1)}$。\n(iii) 标准化效应大小为 $d = (\\mu_1 - \\mu_0)/\\sigma$。非中心化参数为 $\\delta(n) = \\sqrt{n} d$。\n\n将这些代入 $T$ 的表达式中，我们得到：\n$$\nT = \\frac{Z + \\delta(n)}{\\sqrt{U/\\nu}} \\quad \\text{其中 } \\nu = n-1\n$$\n这是一个非中心 Student's $t$ 分布随机变量的标准形式。因此，在 $H_1$ 下，$T$ 服从自由度为 $\\nu = n-1$、非中心化参数为 $\\delta(n) = \\sqrt{n} d$ 的非中心 Student's $t$ 分布。我们用 $t_{n-1, \\delta(n)}$ 表示此分布。\n\n令 $F_{t, \\nu, \\delta}(\\cdot)$ 为自由度为 $\\nu$、非中心化参数为 $\\delta$ 的非中心 $t$ 分布的累积分布函数 (CDF)。则功效为：\n$$\n\\mathsf{Power}(n) = P(T_{alt} > c(n)) + P(T_{alt}  -c(n))\n$$\n其中 $T_{alt} \\sim t_{n-1, \\sqrt{n}d}$。这可以用 CDF 表示为：\n$$\n\\mathsf{Power}(n) = (1 - F_{t, n-1, \\sqrt{n}d}(c(n))) + F_{t, n-1, \\sqrt{n}d}(-c(n))\n$$\n其中 $c(n) = t_{1-\\alpha/2, n-1}$。这是功效作为 $n$、$\\alpha$ 和 $d$ 函数的期望表达式。\n\n对于效应大小 $d=0$ 的边界情况，非中心化参数 $\\delta(n) = \\sqrt{n} \\cdot 0 = 0$。非中心化参数为零的非中心 $t$ 分布与中心 $t$ 分布相同。因此，在 $d=0$ 的 $H_1$ 下（这等同于 $H_0$），统计量 $T \\sim t_{n-1}$。功效计算变为：\n$$\n\\mathsf{Power}(n) = P(|T| > t_{1-\\alpha/2, n-1} \\mid T \\sim t_{n-1})\n$$\n根据临界值的定义，这个概率恰好是 $\\alpha$。因此，对于 $d=0$，$\\mathsf{Power}(n) = \\alpha$ 对任何 $n \\ge 2$ 成立。要达到目标功效 $\\pi$，我们需要 $\\alpha \\ge \\pi$。\n- 如果 $\\pi > \\alpha$，没有有限的样本量 $n$ 能满足条件。所需的样本量是无限的。\n- 如果 $\\pi \\le \\alpha$，对于所有有效的样本量，条件都得到满足。问题要求最小的整数 $n \\ge 2$，所以答案是 $n=2$。\n\n为了找到满足 $\\mathsf{Power}(n) \\ge \\pi$ 的最小整数 $n \\ge 2$，我们设计一个数值算法。对于任何固定的 $d \\neq 0$ 和 $\\alpha$，$\\mathsf{Power}(n)$ 是一个关于 $n$ 的单调递增函数。这种单调性使得高效搜索成为可能。我们的算法包括两个阶段：\n\n1.  **区间限定阶段**：我们必须找到一个保证包含解的区间 $[n_{low}, n_{high}]$。我们从 $n_{low} = 2$ 开始。如果 $\\mathsf{Power}(2) \\ge \\pi$，则 $n=2$ 是解。否则，我们通过从 $n_{high} = 4$ 开始并反复加倍（$n_{high} \\leftarrow 2 \\cdot n_{high}$）来建立一个上界，直到找到一个 $n_{high}$ 使得 $\\mathsf{Power}(n_{high}) \\ge \\pi$。在每一步中，我们用 $n_{high}$ 的前一个值更新 $n_{low}$。这个过程有效地找到了一个包含最小解的区间 $(n_{low}, n_{high}]$。\n\n2.  **搜索阶段**：一旦区间被确定，我们使用二分搜索在整数范围 $[n_{low}, n_{high}]$ 内找到满足功效要求的最小 $n$。设搜索范围为 `[low, high]`。在每一步中，我们计算中点 `mid = (low + high) // 2` 的功效。\n    - 如果 $\\mathsf{Power}(mid) \\ge \\pi$，则 `mid` 是一个潜在的解，我们尝试通过设置 `high = mid` 来寻找一个更小的解。\n    - 如果 $\\mathsf{Power}(mid)  \\pi$，则 `mid` 太小，解必须更大。我们设置 `low = mid + 1`。\n    当 `low` 等于 `high` 时搜索终止，这将是区间内达到目标功效 $\\pi$ 的最小整数 $n$。由于区间的构造是为了界定真正的最小 $n$，因此该值是所需的最小样本量。由于功效函数的单调性，这种两阶段搜索被证明是可终止且正确的。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import t, nct\n\ndef calculate_power(n, d, alpha):\n    \"\"\"\n    Calculates the exact power of a two-sided one-sample t-test.\n\n    Args:\n        n (int): The sample size.\n        d (float): The standardized effect size, (mu1 - mu0) / sigma.\n        alpha (float): The significance level (type I error rate).\n\n    Returns:\n        float: The power of the test.\n    \"\"\"\n    if n  2:\n        return 0.0\n\n    # Degrees of freedom for the t-test\n    nu = n - 1\n\n    # Critical value from the central t-distribution for a two-sided test.\n    # ppf is the percent point function (inverse of CDF, or quantile function).\n    critical_value = t.ppf(1 - alpha / 2.0, df=nu)\n\n    # Noncentrality parameter under the alternative hypothesis\n    delta = d * np.sqrt(n)\n\n    # Power is the probability of rejecting H0 when H1 is true.\n    # Under H1, the test statistic follows a noncentral t-distribution.\n    # Power = P(T_alt > c) + P(T_alt  -c)\n    # where c is the critical_value and T_alt has a noncentral t-distribution.\n    # nct.cdf(x, df, nc) is the CDF of the noncentral t-distribution.\n    power = 1.0 - nct.cdf(critical_value, df=nu, nc=delta) + nct.cdf(-critical_value, df=nu, nc=delta)\n\n    return power\n\ndef find_min_sample_size(d, alpha, pi):\n    \"\"\"\n    Finds the smallest integer sample size n >= 2 that achieves the target power.\n\n    This function implements a monotonicity-aware search algorithm, first bracketing\n    the solution and then using binary search to find the exact integer.\n\n    Args:\n        d (float): The standardized effect size.\n        alpha (float): The significance level.\n        pi (float): The target power.\n\n    Returns:\n        int or float: The minimal sample size, or np.inf if no finite size exists.\n    \"\"\"\n    # Handle the edge case where the effect size is zero.\n    if d == 0:\n        # If d=0, the power is always equal to alpha for any n >= 2.\n        # A solution exists only if the target power is not greater than alpha.\n        if pi > alpha:\n            return np.inf\n        else:\n            # If power >= pi is achievable, the smallest valid n is 2.\n            return 2\n\n    # A minimal sample size of n=2 is required for variance calculation.\n    # Check if n=2 already meets the power requirement.\n    if calculate_power(2, d, alpha) >= pi:\n        return 2\n\n    # Bracketing phase: Find an interval [n_low, n_high] that contains the solution.\n    # We expand the interval exponentially until power(n_high) >= pi.\n    n_low = 2\n    n_high = 4\n    while calculate_power(n_high, d, alpha)  pi:\n        n_low = n_high\n        n_high *= 2\n        # Safety stop for unreasonable sample sizes\n        if n_high > 10**7:\n            raise OverflowError(\"Sample size search exceeded 10,000,000.\")\n\n    # Search phase: Use binary search to find the smallest integer n in the bracket.\n    # The solution is known to be in the range [n_low, n_high].\n    low = n_low\n    high = n_high\n    \n    # This binary search variant finds the first element in a sorted sequence\n    # that satisfies the condition (i.e., power >= pi).\n    while low  high:\n        mid = (low + high) // 2\n        if calculate_power(mid, d, alpha)  pi:\n            low = mid + 1\n        else:\n            high = mid\n            \n    # The loop terminates when low == high, which is the smallest n satisfying the condition.\n    return low\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (d, alpha, pi)\n    test_cases = [\n        (0.5, 0.05, 0.8),  # Case 1\n        (0.2, 0.05, 0.8),  # Case 2\n        (1.0, 0.05, 0.9),  # Case 3\n        (0.0, 0.05, 0.8),  # Case 4\n        (0.5, 0.10, 0.5),  # Case 5\n    ]\n\n    results = []\n    for d, alpha, pi in test_cases:\n        result = find_min_sample_size(d, alpha, pi)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了单个检验的功效计算后，下一步是将其应用于比较不同的试验设计目标。临床试验的一个核心决策是证明一项新疗法是“优效”（superiority）还是仅仅“非劣效”（non-inferiority）。此练习探讨了这一选择如何影响样本量，特别是在处理二元结局（如治愈或未治愈）时。您将量化分析非劣效性界值（non-inferiority margin）的微小变化如何导致所需样本量发生巨大变化，这在实际试验规划中是一个关键的考量因素。",
            "id": "4979728",
            "problem": "一家申办方正在设计一项随机、平行分组的临床试验，该试验针对一个二元终点（例如，临床治愈），在新疗法组和对照组之间进行等比例分配。根据既往证据，预计对照组的治愈率为 $0.70$。申办方正在考虑针对同一终点进行优效性试验或非劣效性（NI）试验。假设使用大样本正态近似来处理两个独立二项分布率之差，两组样本量相等，并且选择样本量以在特定的备择假设下，将单侧I类错误概率 $\\alpha = 0.025$ 控制在一定水平，同时达到 $1-\\beta = 0.90$ 的检验效能。使用标准正态分位数 $z_{1-0.025} \\approx 1.96$ 和 $z_{0.90} \\approx 1.28$。忽略连续性校正和有限样本调整。\n\n考虑以下计划假设：\n- 优效性设计：原假设为新疗法在绝对风险差上不优于对照组，备择假设的目标是从 $0.70$ 绝对改善到 $0.75$。\n- 非劣效性设计：原假设为新疗法在绝对风险差上比对照组差超过一个界值 $\\Delta  0$，备择假设的计划情景为 $p_T = p_C = 0.70$（真实相等），并针对界值 $\\Delta \\in \\{0.10, 0.05, 0.03\\}$ 进行评估。\n\n在这些假设下，以下哪些陈述是正确的？\n\nA. 对于目标为从 $0.70$ 绝对改善到 $0.75$ 的优效性设计，每组所需的样本量约等于 $n \\approx 1{,}670$，而与之对应的，在 $\\Delta = 0.05$ 和 $p_T = p_C = 0.70$ 条件下的非劣效性设计，需要略大的每组样本量 $n$。\n\nB. 当 $p_T = p_C = 0.70$ 时，将非劣效性界值从 $\\Delta = 0.10$ 减半至 $\\Delta = 0.05$，所需的每组样本量 $n$ 大约会增加一倍。\n\nC. 对于 $\\Delta = 0.03$、$p_T = p_C = 0.70$、$\\alpha = 0.025$（单侧）和检验效能为 $0.90$ 的非劣效性设计，每组样本量 $n$ 将在 $4{,}900$ 左右，大约是在相同假设下 $\\Delta = 0.10$ 时所需样本量的 $11$ 倍。\n\nD. 保持分母中的绝对效应和相同的比例参数不变，将 $\\alpha = 0.025$ 的单侧非劣效性检验替换为总 $\\alpha = 0.05$ 的双侧优效性检验会严格减少所需的样本量 $n$，因为其临界值更小。",
            "solution": "用户希望我验证并解决一个关于临床试验样本量计算的生物统计学问题。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- **试验类型**：随机、平行分组临床试验，等比例分配 ($n_T = n_C = n$)。\n- **终点**：二元。\n- **对照组率**：预期 $p_C = 0.70$。\n- **统计方法**：两个独立二项分布率之差的大样本正态近似。\n- **I类错误**：单侧 $\\alpha = 0.025$。\n- **检验效能**：$1-\\beta = 0.90$。\n- **正态分位数**：$z_{1-\\alpha} = z_{0.975} \\approx 1.96$；$z_{1-\\beta} = z_{0.90} \\approx 1.28$。\n- **简化假设**：无连续性校正或有限样本调整。\n- **优效性设计**：原假设 $H_0: p_T - p_C \\le 0$。用于检验效能计算的备择假设：$p_C = 0.70$, $p_T = 0.75$。\n- **非劣效性（NI）设计**：原假设 $H_0: p_T - p_C \\le -\\Delta$，界值为 $\\Delta  0$。用于检验效能计算的备择假设：$p_T = p_C = 0.70$。考虑的界值：$\\Delta \\in \\{0.10, 0.05, 0.03\\}$。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，提法得当且客观。它概述了一项标准的生物统计学任务：计算和比较优效性试验与非劣效性试验的样本量。所提供的数据完整且一致，适用于标准大样本公式。各项假设（$p_C$、效应大小、界值、错误率）均在临床试验计划的合理范围内。不存在矛盾、歧义或违反科学原则之处。\n\n**步骤 3：结论与行动**\n该问题是**有效的**。我将继续进行解答。\n\n### 推导与选项评估\n\n对于比较来自等样本量独立分组的两个率 $p_T$ 和 $p_C$，使用显著性水平为 $\\alpha$、检验效能为 $1-\\beta$ 的单侧检验，其每组样本量 $n$ 的通用公式如下：\n$$ n = \\frac{(z_{1-\\alpha} \\sqrt{V_0} + z_{1-\\beta} \\sqrt{V_A})^2}{(\\delta_A - \\delta_0)^2} $$\n其中 $\\delta_0$ 是原假设中差值 $p_T - p_C$ 的边界，$\\delta_A$ 是备择假设下假定的真实差值，$V_0$ 是原假设下的合并方差项，$V_A$ 是备择假设下的合并方差项。一个常见且标准的简化方法（题目设置也隐含了此方法）是假设方差恒定，并使用备择假设下的值进行评估，即 $V_0 \\approx V_A = p_{TA}(1-p_{TA}) + p_{CA}(1-p_{CA})$，其中 $p_{TA}$ 和 $p_{CA}$ 是备择假设下的率。\n\n简化后的公式变为：\n$$ n = \\frac{(z_{1-\\alpha} + z_{1-\\beta})^2 (p_{TA}(1-p_{TA}) + p_{CA}(1-p_{CA}))}{(\\delta_A - \\delta_0)^2} $$\n给定 $z_{1-\\alpha} = z_{0.975} \\approx 1.96$ 和 $z_{1-\\beta} = z_{0.90} \\approx 1.28$。因此，项 $(z_{1-\\alpha} + z_{1-\\beta})^2 \\approx (1.96 + 1.28)^2 = (3.24)^2 = 10.4976$。\n\n**1. 优效性设计计算**\n- 原假设：$H_0: p_T - p_C \\le 0$，所以 $\\delta_0 = 0$。\n- 用于检验效能计算的备择假设：$p_{CA}=0.70$ 和 $p_{TA}=0.75$。\n- 备择假设下的差值为 $\\delta_A = p_{TA} - p_{CA} = 0.75 - 0.70 = 0.05$。\n- 方差项为 $V_A = p_{TA}(1-p_{TA}) + p_{CA}(1-p_{CA}) = 0.75(1-0.75) + 0.70(1-0.70) = 0.75(0.25) + 0.70(0.30) = 0.1875 + 0.21 = 0.3975$。\n- 每组样本量 $n_{sup}$ 为：\n$$ n_{sup} = \\frac{(1.96 + 1.28)^2 \\times 0.3975}{(0.05)^2} = \\frac{10.4976 \\times 0.3975}{0.0025} = \\frac{4.172796}{0.0025} = 1669.1184 $$\n所以，$n_{sup} \\approx 1670$。\n\n**2. 非劣效性设计计算**\n- 原假设：$H_0: p_T - p_C \\le -\\Delta$，所以 $\\delta_0 = -\\Delta$。\n- 用于检验效能计算的备择假设：$p_{TA} = p_{CA} = 0.70$。\n- 备择假设下的差值为 $\\delta_A = p_{TA} - p_{CA} = 0.70 - 0.70 = 0$。\n- 样本量公式的分母是 $(\\delta_A - \\delta_0)^2 = (0 - (-\\Delta))^2 = \\Delta^2$。\n- 方差项为 $V_A = p_{TA}(1-p_{TA}) + p_{CA}(1-p_{CA}) = 0.70(1-0.70) + 0.70(1-0.70) = 2 \\times (0.70 \\times 0.30) = 2 \\times 0.21 = 0.42$。\n- 每组样本量 $n_{NI}$ 为：\n$$ n_{NI} = \\frac{(1.96 + 1.28)^2 \\times 0.42}{\\Delta^2} = \\frac{10.4976 \\times 0.42}{\\Delta^2} = \\frac{4.4090}{ ( \\Delta^2)} $$\n在这些假设下，这个用于非劣效性试验的通用公式将用于评估各个选项。\n\n---\n**逐项分析**\n\n**A. 对于目标为从 $0.70$ 绝对改善到 $0.75$ 的优效性设计，每组所需的样本量约等于 $n \\approx 1{,}670$，而与之对应的，在 $\\Delta = 0.05$ 和 $p_T = p_C = 0.70$ 条件下的非劣效性设计，需要略大的每组样本量 $n$。**\n- 陈述的第一部分声称 $n_{sup} \\approx 1{,}670$。我们的计算得出 $n_{sup} \\approx 1669.1$，四舍五入为 $1670$。这是正确的。\n- 对于第二部分，我们计算 $\\Delta = 0.05$ 时的非劣效性样本量：\n$$ n_{NI}(\\Delta=0.05) = \\frac{4.4090}{(0.05)^2} = \\frac{4.4090}{0.0025} = 1763.6 $$\n所以，$n_{NI} \\approx 1764$。\n- 比较两者，$1764 > 1670$。非劣效性设计需要更大的样本量。原因是分母中的效应大小在数值上是相同的（$0.05$ vs $\\Delta=0.05$），但用于非劣效性计算的方差项（$0.42$）大于用于优效性计算的方差项（$0.3975$）。该陈述在事实上是准确的。\n- **结论：正确。**\n\n**B. 当 $p_T = p_C = 0.70$ 时，将非劣效性界值从 $\\Delta = 0.10$ 减半至 $\\Delta = 0.05$，所需的每组样本量 $n$ 大约会增加一倍。**\n- 我们的非劣效性设计样本量公式为 $n_{NI} \\propto \\frac{1}{\\Delta^2}$。\n- 设 $n_1$ 为 $\\Delta_1 = 0.10$ 时的样本量，$n_2$ 为 $\\Delta_2 = 0.05$ 时的样本量。\n- 界值减半意味着 $\\Delta_2 = \\Delta_1 / 2$。\n- 样本量之比为 $\\frac{n_2}{n_1} = \\frac{1/\\Delta_2^2}{1/\\Delta_1^2} = \\left(\\frac{\\Delta_1}{\\Delta_2}\\right)^2 = \\left(\\frac{\\Delta_1}{\\Delta_1/2}\\right)^2 = 2^2 = 4$。\n- 因此，将非劣效性界值减半会使所需样本量增加到原来的四倍，而不是两倍。\n- 具体计算如下：\n    - $n_{NI}(\\Delta=0.10) = \\frac{4.4090}{(0.10)^2} = 440.9 \\approx 441$。\n    - $n_{NI}(\\Delta=0.05) = 1763.6 \\approx 1764$。\n    - 比率为 $1764 / 441 = 4$。\n- 该陈述是错误的。\n- **结论：不正确。**\n\n**C. 对于 $\\Delta = 0.03$、$p_T = p_C = 0.70$、$\\alpha = 0.025$（单侧）和检验效能为 $0.90$ 的非劣效性设计，每组样本量 $n$ 将在 $4{,}900$ 左右，大约是在相同假设下 $\\Delta = 0.10$ 时所需样本量的 $11$ 倍。**\n- 首先，我们计算 $\\Delta = 0.03$ 时的样本量：\n$$ n_{NI}(\\Delta=0.03) = \\frac{4.4090}{(0.03)^2} = \\frac{4.4090}{0.0009} = 4898.88... $$\n这个值 $n \\approx 4899$ 确实是“在 $4{,}900$ 左右”。第一部分是正确的。\n- 其次，我们将其与 $\\Delta=0.10$ 时的样本量进行比较，我们已计算出 $n_{NI}(\\Delta=0.10) \\approx 441$。\n- 比率为 $\\frac{n_{NI}(\\Delta=0.03)}{n_{NI}(\\Delta=0.10)} = \\frac{4898.88...}{440.9} \\approx 11.11$。\n- 这“大约是大11倍”。\n- 另外，使用比例关系：比率 $= \\left(\\frac{\\Delta_1}{\\Delta_2}\\right)^2 = \\left(\\frac{0.10}{0.03}\\right)^2 = \\left(\\frac{10}{3}\\right)^2 = \\frac{100}{9} \\approx 11.11$。\n- 陈述的两个部分都是准确的。\n- **结论：正确。**\n\n**D. 保持分母中的绝对效应和相同的比例参数不变，将 $\\alpha = 0.025$ 的单侧非劣效性检验替换为总 $\\alpha = 0.05$ 的双侧优效性检验会严格减少所需的样本量 $n$，因为其临界值更小。**\n- 我们来分析样本量公式中受影响的组成部分。该公式主要由 $(z_{\\text{critical}} + z_{\\text{power}})^2$ 这一项驱动。\n- 情况1：$\\alpha = 0.025$ 的单侧检验。与I类错误相关的分位数是 $z_{1-\\alpha} = z_{1-0.025} = z_{0.975} \\approx 1.96$。\n- 情况2：总 $\\alpha = 0.05$ 的双侧检验。这意味着 alpha 风险被分配到两个尾部，每个尾部的大小为 $\\alpha/2 = 0.025$。对于上尾拒绝域，临界值为 $z_{1-\\alpha/2} = z_{1-0.025} = z_{0.975} \\approx 1.96$。\n- 两种情况下，I类错误部分的临界值是相同的（$z_{0.975}$）。检验效能部分（$z_{1-\\beta}$）也相同。因此，单侧检验的乘数 $(z_{1-\\alpha} + z_{1-\\beta})^2$ 与双侧检验的乘数 $(z_{1-\\alpha/2} + z_{1-\\beta})^2$ 是相同的。\n- 由于公式的所有其他组成部分（“分母中的绝对效应和相同的比例参数”）根据题目设定保持不变，所需的样本量 $n$ 将是相同的，而不是严格减少。\n- 所提供的理由（“因为其临界值更小”）是错误的。两种情况下相关的临界值是相同的。\n- **结论：不正确。**",
            "answer": "$$\\boxed{AC}$$"
        },
        {
            "introduction": "除了试验目标，试验结构本身也是一个关键的设计杠杆。对于慢性病的复发事件研究，交叉设计（crossover design）通过让每位受试者同时充当治疗组和对照组的角色，通常比传统的平行组设计更高效。本练习将深入探讨交叉试验中计数数据（count data）的样本量计算，利用条件泊松模型消除受试者间的变异。通过量化比较交叉设计与平行设计的效率，您将深刻理解通过精巧的“自身前后对照”设计来减少样本需求的强大威力。",
            "id": "4979687",
            "problem": "一项随机双周期交叉研究将比较一种新的预防性方案与标准护理在慢性病人群中复发性急性感染事件发生率方面的效果。每个受试者将提供两个等长的观察期 $T$，一个接受新预防方案，一个接受标准护理，顺序随机分配。设 $Y_{i1}$ 和 $Y_{i2}$ 分别表示受试者 $i$ 在预防方案期和标准护理期的事件计数。假设以下源于第一性原理的生成模型：\n\n- 在给定不可观测的受试者特异性基线强度 $\\lambda_i$ 的条件下，每个时期内的事件来自一个泊松过程，且两个时期条件独立。\n- 均值计数满足 $\\mathbb{E}[Y_{i1} \\mid \\lambda_i] = \\lambda_i T \\exp(\\beta/2)$ 和 $\\mathbb{E}[Y_{i2} \\mid \\lambda_i] = \\lambda_i T \\exp(-\\beta/2)$，其中 $\\beta = \\ln(\\theta)$ 是比较预防方案与标准护理的对数率比。\n\n先前数据得出的计划值表明，$\\mathbb{E}[\\lambda_i] = m = 0.04$ 事件/天，每个观察期长度为 $T = 60$ 天。该研究旨在以双侧 I 型错误率 $\\alpha = 0.05$ 和功效 $1 - \\beta_{\\text{power}} = 0.90$ 检测出具有临床意义的率比 $\\theta = 0.75$。\n\n使用条件泊松方法，通过对受试者内总数 $S_i = Y_{i1} + Y_{i2}$ 取条件以消除讨厌参数 $\\lambda_i$，从第一性原理推导一个用于 $H_0\\!:\\, \\beta = 0$ 的瓦尔德检验，并获得备择假设下每对的期望费雪信息。然后计算达到所述功效所需的最小配对整数数量 $n$。\n\n最后，为了获得设计上的洞见，假设在一个具有相等分配的非配对双臂平行设计中，受试者水平的异质性导致了负二项变异，其方差函数为 $\\operatorname{Var}(Y) = \\mu \\{1 + \\phi \\mu\\}$，过度离散参数为 $\\phi = 0.5$。使用相同的 $m$、$T$ 和 $\\theta$，计算每个总受试者信息的比率（配对设计中的一个配对与非配对设计中两个独立受试者（每臂一个）相比）。解释该比率所隐含的效率增益或损失。\n\n你的最终数值答案只报告达到目标功效的最小整数 $n$。不要在最终答案中包含任何其他量。",
            "solution": "问题陈述经过严格验证，确认有效。它基于已建立的临床试验设计统计理论，特别是针对计数数据的交叉研究。该问题提法恰当，给定条件完整且一致，可以推导出一个唯一且有意义的解。所用术语客观而精确。\n\n第一步是推导条件分析的统计模型。设 $Y_{i1}$ 和 $Y_{i2}$ 分别为受试者 $i$ 在预防方案期和标准护理期的事件计数。观察期长度为 $T$。在给定受试者特异性基线率 $\\lambda_i$ 的条件下，这些计数是独立的泊松变量：\n$Y_{i1} \\mid \\lambda_i \\sim \\text{Poisson}(\\mu_{i1})$，其中 $\\mu_{i1} = \\lambda_i T \\exp(\\beta/2)$\n$Y_{i2} \\mid \\lambda_i \\sim \\text{Poisson}(\\mu_{i2})$，其中 $\\mu_{i2} = \\lambda_i T \\exp(-\\beta/2)$\n其中 $\\beta = \\ln(\\theta)$ 是对数率比。\n\n为了消除讨厌参数 $\\lambda_i$，我们以受试者 $i$ 的总计数 $S_i = Y_{i1} + Y_{i2}$ 为条件。由于 $S_i$ 是两个独立泊松变量之和，其在给定 $\\lambda_i$ 下的分布也是泊松分布：\n$S_i \\mid \\lambda_i \\sim \\text{Poisson}(\\mu_{i1} + \\mu_{i2})$。\n在给定 $S_i=s_i$ 的条件下，$Y_{i1}$ 的条件分布是：\n$$ P(Y_{i1}=y_{i1} \\mid S_i=s_i) = \\frac{P(Y_{i1}=y_{i1}, Y_{i2}=s_i-y_{i1})}{P(S_i=s_i)} $$\n在给定 $\\lambda_i$ 的条件下，这个概率变为：\n$$ P(Y_{i1}=y_{i1} \\mid S_i=s_i, \\lambda_i) = \\frac{P(Y_{i1}=y_{i1} \\mid \\lambda_i) P(Y_{i2}=s_i-y_{i1} \\mid \\lambda_i)}{P(S_i=s_i \\mid \\lambda_i)} $$\n$$ = \\frac{ \\frac{\\exp(-\\mu_{i1})\\mu_{i1}^{y_{i1}}}{y_{i1}!} \\frac{\\exp(-\\mu_{i2})\\mu_{i2}^{s_i-y_{i1}}}{(s_i-y_{i1})!} }{ \\frac{\\exp(-(\\mu_{i1}+\\mu_{i2}))(\\mu_{i1}+\\mu_{i2})^{s_i}}{s_i!} } $$\n$$ = \\frac{s_i!}{y_{i1}!(s_i-y_{i1})!} \\frac{\\mu_{i1}^{y_{i1}}\\mu_{i2}^{s_i-y_{i1}}}{(\\mu_{i1}+\\mu_{i2})^{s_i}} = \\binom{s_i}{y_{i1}} p^{y_{i1}} (1-p)^{s_i-y_{i1}} $$\n其中概率 $p$ 是：\n$$ p = \\frac{\\mu_{i1}}{\\mu_{i1}+\\mu_{i2}} = \\frac{\\lambda_i T \\exp(\\beta/2)}{\\lambda_i T \\exp(\\beta/2) + \\lambda_i T \\exp(-\\beta/2)} = \\frac{\\exp(\\beta/2)}{\\exp(\\beta/2) + \\exp(-\\beta/2)} $$\n这可以化简为 $p = \\frac{1}{1 + \\exp(-\\beta)}$，即逻辑斯蒂函数。关键在于，$p$ 不依赖于 $\\lambda_i$，因此条件分布不含讨厌参数。所以，对于每个总计数 $S_i > 0$ 的受试者 $i$，其条件分布为二项分布：$Y_{i1} \\mid S_i=s_i \\sim \\text{Binomial}(s_i, p)$。\n\n基于此条件分布，受试者 $i$ 的对数似然函数为：\n$$ l_i(\\beta) = \\ln\\binom{S_i}{Y_{i1}} + Y_{i1}\\ln(p) + (S_i-Y_{i1})\\ln(1-p) $$\n$$ l_i(\\beta) = \\text{const} + Y_{i1}\\beta - S_i\\ln(1+\\exp(\\beta)) $$\n受试者 $i$ 的得分函数（一阶导数）是：\n$$ U_i(\\beta) = \\frac{\\partial l_i}{\\partial \\beta} = Y_{i1} - S_i \\frac{\\exp(\\beta)}{1+\\exp(\\beta)} = Y_{i1} - S_i p $$\n在给定 $S_i$ 的条件下，受试者 $i$ 的费雪信息是：\n$$ I_i(\\beta \\mid S_i) = -\\frac{\\partial^2 l_i}{\\partial \\beta^2} = S_i \\frac{\\partial p}{\\partial \\beta} = S_i p(1-p) $$\n用于 $H_0: \\beta=0$ 的瓦尔德检验基于检验统计量 $W = \\frac{\\hat{\\beta}}{\\text{se}(\\hat{\\beta})}$，其中 $\\hat{\\beta}$ 是从总条件似然 $L(\\beta) = \\sum_i l_i(\\beta)$ 得到的 $\\beta$ 的最大似然估计，并且 $\\text{se}(\\hat{\\beta}) = \\left(\\sum_i I_i(\\hat{\\beta} \\mid S_i)\\right)^{-1/2}$。如果 $|W|  z_{1-\\alpha/2}$，则拒绝 $H_0$。\n\n接下来，我们推导每个配对的期望费雪信息 $I_1(\\beta)$。这是 $I_i(\\beta \\mid S_i)$ 在 $S_i$ 的分布上的期望：\n$$ I_1(\\beta) = \\mathbb{E}[I_i(\\beta \\mid S_i)] = \\mathbb{E}[S_i p(1-p)] = \\mathbb{E}[S_i] p(1-p) $$\n$S_i$ 的期望通过先对 $\\lambda_i$ 取条件得到：\n$$ \\mathbb{E}[S_i \\mid \\lambda_i] = \\mu_{i1} + \\mu_{i2} = \\lambda_i T (\\exp(\\beta/2) + \\exp(-\\beta/2)) = 2\\lambda_i T \\cosh(\\beta/2) $$\n对 $\\lambda_i$ 取期望，并使用 $\\mathbb{E}[\\lambda_i] = m$：\n$$ \\mathbb{E}[S_i] = 2mT\\cosh(\\beta/2) $$\n项 $p(1-p)$ 化简为：\n$$ p(1-p) = \\frac{\\exp(\\beta/2)}{\\exp(\\beta/2) + \\exp(-\\beta/2)} \\frac{\\exp(-\\beta/2)}{\\exp(\\beta/2) + \\exp(-\\beta/2)} = \\frac{1}{(\\exp(\\beta/2) + \\exp(-\\beta/2))^2} = \\frac{1}{4\\cosh^2(\\beta/2)} $$\n结合这些，得到每对的期望信息：\n$$ I_1(\\beta) = 2mT\\cosh(\\beta/2) \\cdot \\frac{1}{4\\cosh^2(\\beta/2)} = \\frac{mT}{2\\cosh(\\beta/2)} $$\n在备择假设下，$\\theta_A = 0.75$，所以 $\\beta_A = \\ln(0.75)$。\n$$ \\cosh(\\beta_A/2) = \\frac{\\exp(\\ln(0.75)/2) + \\exp(-\\ln(0.75)/2)}{2} = \\frac{\\sqrt{0.75} + 1/\\sqrt{0.75}}{2} = \\frac{\\sqrt{3}/2 + 2/\\sqrt{3}}{2} = \\frac{7}{4\\sqrt{3}} $$\n备择假设下的信息为：\n$$ I_1(\\beta_A) = \\frac{mT}{2(7/(4\\sqrt{3}))} = \\frac{2\\sqrt{3}mT}{7} $$\n\n在检验水平为 $\\alpha$ 的双侧检验中，为达到功效 $1-\\beta_{\\text{power}}$ 所需的样本量 $n$ 由瓦尔德检验的标准公式给出：\n$$ n \\approx \\frac{(z_{1-\\alpha/2} + z_{1-\\beta_{\\text{power}}})^2}{\\beta_A^2 I_1(\\beta_A)} $$\n给定 $\\alpha=0.05$ 和 $1-\\beta_{\\text{power}}=0.90$，得出 $z_{1-\\alpha/2}=z_{0.975} \\approx 1.96$ 和 $z_{1-\\beta_{\\text{power}}}=z_{0.90} \\approx 1.2816$。\n计划值为 $m=0.04$ 事件/天和 $T=60$ 天。效应量为 $\\beta_A = \\ln(0.75) \\approx -0.28768$。\n备择假设下每对的信息为：\n$$ I_1(\\beta_A) = \\frac{2\\sqrt{3}(0.04)(60)}{7} = \\frac{4.8\\sqrt{3}}{7} \\approx 1.18765 $$\n将这些值代入样本量公式：\n$$ n = \\frac{(1.96 + 1.2816)^2}{(\\ln(0.75))^2 \\left(\\frac{4.8\\sqrt{3}}{7}\\right)} \\approx \\frac{(3.2416)^2}{(-0.28768)^2(1.18765)} \\approx \\frac{10.508}{0.08276 \\times 1.18765} \\approx \\frac{10.508}{0.09827} \\approx 106.93 $$\n由于配对数必须是整数，我们向上取整，得到 $n=107$。\n\n最后，为了获得设计上的洞见，我们计算信息比率。在配对设计中，来自一个配对的信息是 $I_{\\text{paired}} = I_1(\\beta_A) \\approx 1.1877$。\n对于非配对设计，我们有两个独立的受试者，每臂一个，其计数服从负二项分布，方差为 $\\operatorname{Var}(Y) = \\mu(1+\\phi\\mu)$ 且 $\\phi=0.5$。均值为 $\\mu_1 = mT\\exp(\\beta/2)$ 和 $\\mu_2 = mT\\exp(-\\beta/2)$。来自这两个受试者的关于 $\\beta$ 的费雪信息是：\n$$ I_{\\text{unpaired}}(\\beta) = \\left(\\frac{d\\mu_1}{d\\beta}\\right)^2 \\frac{1}{\\operatorname{Var}(Y_1)} + \\left(\\frac{d\\mu_2}{d\\beta}\\right)^2 \\frac{1}{\\operatorname{Var}(Y_2)} $$\n由于 $\\frac{d\\mu_1}{d\\beta} = \\frac{1}{2}\\mu_1$ 且 $\\frac{d\\mu_2}{d\\beta} = -\\frac{1}{2}\\mu_2$，上式变为：\n$$ I_{\\text{unpaired}}(\\beta) = \\frac{1}{4} \\left( \\frac{\\mu_1}{1+\\phi\\mu_1} + \\frac{\\mu_2}{1+\\phi\\mu_2} \\right) $$\n在备择假设下，$mT=2.4$，$\\beta_A=\\ln(0.75)$，$\\phi=0.5$。\n$\\mu_1 = 2.4 \\sqrt{0.75} = 1.2\\sqrt{3} \\approx 2.0785$。\n$\\mu_2 = 2.4 / \\sqrt{0.75} = 1.6\\sqrt{3} \\approx 2.7713$。\n$$ I_{\\text{unpaired}}(\\beta_A) \\approx \\frac{1}{4} \\left( \\frac{2.0785}{1+0.5(2.0785)} + \\frac{2.7713}{1+0.5(2.7713)} \\right) \\approx \\frac{1}{4} \\left( \\frac{2.0785}{2.03925} + \\frac{2.7713}{2.38565} \\right) \\approx 0.5452 $$\n每个总受试者的信息比率为：\n$$ \\text{Ratio} = \\frac{I_{\\text{paired}}}{I_{\\text{unpaired}}} \\approx \\frac{1.1877}{0.5452} \\approx 2.18 $$\n这个大于 2 的比率表明交叉设计有显著的效率增益。对于相同数量的总观测值（例如，1 个配对 vs 2 个独立个体），交叉研究提供的关于治疗效应的统计信息是其两倍以上。这种增益是由于配对设计通过进行受试者内比较，能够消除受试者间的变异性（$\\lambda_i$）。平行设计模型中较大的过度离散参数 $\\phi=0.5$ 意味着高的受试者间变异性，这会增大估计量的方差并减少信息量，从而使得交叉设计相对而言效率高得多。",
            "answer": "$$\n\\boxed{107}\n$$"
        }
    ]
}