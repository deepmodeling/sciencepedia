{
    "hands_on_practices": [
        {
            "introduction": "本练习将带您回归假设检验的本源。我们将手动计算I类和II类错误（分别为 $\\alpha$ 和 $\\beta$）的概率以及检验的统计功效（power），这些是评估和设计临床研究的基石。此实践旨在阐明，一个特定决策规则的选择将如何直接影响检验的性能，并揭示在控制不同类型错误之间存在的固有权衡 。",
            "id": "4989124",
            "problem": "一项关于高血压的临床试验旨在检测群体平均收缩压是否出现 $5$ 毫米汞柱（mmHg）的临床显著降低。假设治疗后的个体收缩压测量值是独立同分布的正态随机变量，其标准差已知为 $\\sigma = 12$ mmHg，均值 $\\mu$ 未知。治疗前的基线平均收缩压为 $\\mu_{0} = 140$ mmHg。预先指定一条决策规则：如果样本量为 $n = 64$ 的试验所得到的样本均值 $\\bar{X}$ 满足 $\\bar{X} \\le \\mu_{0} - 5$ mmHg，则宣布检测到均值下降并拒绝原假设。\n\n在假设检验的框架内，考虑简单原假设 $H_{0}: \\mu = \\mu_{0}$ 和简单备择假设 $H_{1}: \\mu = \\mu_{0} - 5$，同时认识到单侧的科学备择假设是 $H_{1}: \\mu  \\mu_{0}$。从已知方差的正态抽样下样本均值的基本分布性质以及第一类和第二类错误的定义出发，针对指定的 $n$ 和决策规则，推导出以下内容：\n\n- 在 $H_{0}$ 下的第一类错误概率 $\\alpha$。\n- 在点备择假设 $\\mu = \\mu_{0} - 5$ 下的第二类错误概率 $\\beta$。\n- 检测到 $5$ mmHg 降低的功效 $1 - \\beta$。\n\n然后，评估该程序相对于检测 $5$ mmHg 平均降低的常规设计目标 $\\alpha^{\\star} = 0.05$ 和功效目标 $\\pi^{\\star} = 0.80$ 是否足够。\n\n将您的最终数值答案（所达到的功效）四舍五入到四位有效数字。最终答案以小数形式表示，不带百分号。",
            "solution": "对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n- 群体平均收缩压的临床显著降低值：$5$ mmHg。\n- 个体测量值是独立同分布（i.i.d.）的正态随机变量。\n- 已知总体标准差：$\\sigma = 12$ mmHg。\n- 未知总体均值：$\\mu$。\n- 基线均值（原假设）：$\\mu_{0} = 140$ mmHg。\n- 样本量：$n = 64$。\n- 决策规则：如果样本均值 $\\bar{X} \\le \\mu_{0} - 5$ mmHg，则拒绝原假设。\n- 原假设：$H_{0}: \\mu = \\mu_{0}$。\n- 简单备择假设：$H_{1}: \\mu = \\mu_{0} - 5$。\n- 常规目标第一类错误：$\\alpha^{\\star} = 0.05$。\n- 常规目标功效：$\\pi^{\\star} = 0.80$。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题是关于已知方差的正态分布总体的均值的假设检验的标准应用。\n- **科学依据：** 背景和参数是生物统计学中模拟临床试验问题的典型设置。使用正态分布来描述血压是一种常见且合理的近似。数值是现实的。\n- **问题定义良好：** 提供了计算所需概率的所有必要信息（$\\mu_0$, $\\sigma$, $n$ 和精确的决策规则）。问题明确，可以得出唯一解。\n- **客观性：** 问题以精确的、量化的术语陈述，不含主观性。\n\n### 步骤 3：结论和行动\n该问题是有效的，因为它科学合理、定义良好且内部一致。将推导出解答。\n\n### 推导\n该问题背后的基本原理是样本均值 $\\bar{X}$ 的分布。给定来自均值为 $\\mu$、已知标准差为 $\\sigma$ 的正态总体的样本量为 $n$ 的随机样本，样本均值 $\\bar{X}$ 也服从正态分布，其均值为 $\\mu$，标准差为 $\\frac{\\sigma}{\\sqrt{n}}$。样本均值的这个标准差被称为标准误（$SE$）。\n因此，$\\bar{X}$ 的分布指定为：\n$$ \\bar{X} \\sim N\\left(\\mu, \\frac{\\sigma^2}{n}\\right) $$\n根据给定值 $n=64$ 和 $\\sigma=12$ mmHg，标准误为：\n$$ SE = \\frac{\\sigma}{\\sqrt{n}} = \\frac{12}{\\sqrt{64}} = \\frac{12}{8} = 1.5 \\text{ mmHg} $$\n\n为了计算概率，我们使用以下变换将 $\\bar{X}$ 标准化为标准正态随机变量 $Z \\sim N(0, 1)$：\n$$ Z = \\frac{\\bar{X} - \\mu}{SE} = \\frac{\\bar{X} - \\mu}{1.5} $$\n\n**1. 第一类错误概率（$\\alpha$）**\n第一类错误是在原假设 $H_0$ 实际为真时拒绝它的概率。\n$$ \\alpha = P(\\text{Reject } H_0 \\mid H_0 \\text{ is true}) $$\n决策规则是如果 $\\bar{X} \\le \\mu_0 - 5$，则拒绝 $H_0$。“$H_0$ 为真”的条件意味着真实的总体均值为 $\\mu = \\mu_0$。\n$$ \\alpha = P(\\bar{X} \\le \\mu_0 - 5 \\mid \\mu = \\mu_0) $$\n我们通过减去 $H_0$ 下的均值（即 $\\mu_0$）并除以标准误来标准化该不等式：\n$$ \\alpha = P\\left(\\frac{\\bar{X} - \\mu_0}{SE} \\le \\frac{(\\mu_0 - 5) - \\mu_0}{SE}\\right) $$\n$$ \\alpha = P\\left(Z \\le \\frac{-5}{1.5}\\right) = P(Z \\le -3.333...) = P(Z \\le -10/3) $$\n设 $\\Phi(z)$ 为标准正态分布的累积分布函数（CDF）。那么，$\\alpha = \\Phi(-10/3)$。其值约为 $\\alpha \\approx 0.000429$。\n\n**2. 第二类错误概率（$\\beta$）**\n第二类错误是在备择假设 $H_1$ 为真时未能拒绝原假设 $H_0$ 的概率。\n$$ \\beta = P(\\text{Fail to reject } H_0 \\mid H_1 \\text{ is true}) $$\n“未能拒绝 $H_0$”是拒绝规则的补集，因此对应于事件 $\\bar{X}  \\mu_0 - 5$。简单备择假设 $H_1$ 指定真实的总体均值为 $\\mu = \\mu_0 - 5$。我们用 $\\mu_1 = \\mu_0 - 5$ 表示这个备择均值。\n$$ \\beta = P(\\bar{X}  \\mu_0 - 5 \\mid \\mu = \\mu_1) $$\n代入 $\\mu_1 = \\mu_0 - 5$，我们得到：\n$$ \\beta = P(\\bar{X}  \\mu_1 \\mid \\mu = \\mu_1) $$\n在 $H_1$ 下，$\\bar{X}$ 的抽样分布以 $\\mu_1$ 为中心。我们通过减去 $H_1$ 下的均值（即 $\\mu_1$）并除以标准误来标准化该不等式：\n$$ \\beta = P\\left(\\frac{\\bar{X} - \\mu_1}{SE}  \\frac{\\mu_1 - \\mu_1}{SE}\\right) $$\n$$ \\beta = P(Z  0) $$\n对于关于 $0$ 对称的标准正态分布，其值大于均值的概率恰好是 $0.5$。\n$$ \\beta = 0.5 $$\n\n**3. 检测到 $5$ mmHg 降低的功效 ($1-\\beta$)**\n检验的功效是正确拒绝一个错误的原假设的概率。它定义为 $1 - \\beta$。\n$$ \\text{Power} = 1 - \\beta = 1 - 0.5 = 0.5 $$\n\n**4. 充分性评估**\n我们将计算出的检验特征与常规设计目标进行比较。\n- **第一类错误比较：** 计算出的第一类错误为 $\\alpha \\approx 0.000429$。这远小于常规目标 $\\alpha^{\\star} = 0.05$。因此，该检验非常保守，意味着它极不可能产生假阳性结果。\n- **功效比较：** 计算出的功效为 $1 - \\beta = 0.5$。这远低于常规目标功效 $\\pi^{\\star} = 0.80$。这表明，按此特定决策规则设计的该研究，只有 $50\\%$ 的机会检测到指定的 $5$ mmHg 平均血压降低。\n\n**关于充分性的结论：** 该程序不充分。虽然其对第一类错误的控制异常严格，但相对于常规标准而言，其功效严重不足。低功效意味着该研究有很高的风险无法检测到指定大小的真实效应（第二类错误），即使治疗有效，其结果也可能不具决定性。将临界值具体选择在 $\\mu_0 - 5$，这恰好是备择假设下的均值，直接导致了 $0.5$ 的功效。一个设计合理的试验会根据期望的 $\\alpha$ 水平（例如，$\\alpha=0.05$）来设定临界值，这对于给定的样本量通常会产生更高的功效。\n\n问题要求计算出的功效，并四舍五入到四位有效数字。\n功效 $= 0.5$。保留四位有效数字，即为 $0.5000$。",
            "answer": "$$\\boxed{0.5000}$$"
        },
        {
            "introduction": "一个极小的 $p$ 值表示结果具有统计显著性，但这是否总是意味着它在实践中或生物学上同样重要？这项计算练习旨在突显统计显著性与效应大小之间的关键区别，这也是一个常见的混淆点。通过处理一个样本量极大的假设数据集，您将亲身体会到，即使是一个微不足道的效应，也可能产生高度显著的统计结果 。",
            "id": "2398939",
            "problem": "您正在分析一个单基因在两种实验条件下的表达情况，这两种条件分别表示为条件 $A$ 和条件 $B$。测量值均为正数，并且在每种条件下都应被视为独立同分布（i.i.d.），其样本来自方差有限但可能不相等的正态分布。设总体均值分别为 $\\mu_A$ 和 $\\mu_B$。对于每种条件，您都将获得样本量、样本均值和样本标准差。您必须使用该模型下的精确双边 $p$ 值来评估原假设 $H_0: \\mu_A = \\mu_B$ 与双边备择假设 $H_1: \\mu_A \\neq \\mu_B$。另外，将倍数变化（fold-change）定义为 $\\mathrm{FC} = \\bar{x}_B / \\bar{x}_A$，其中 $\\bar{x}_A$ 和 $\\bar{x}_B$ 分别是条件 $A$ 和条件 $B$ 的样本均值。\n\n使用以下阈值：\n- 显著性阈值 $\\alpha = 10^{-12}$。\n- 生物学可忽略容差 $\\tau = 10^{-2}$（即，与 $1$ 的偏差不超过 $0.01$ 被认为是生物学上可忽略的）。\n\n对于下面的每个测试用例，判断以下两个标准是否同时成立：(i) 双边 $p$ 值严格小于 $\\alpha$，以及 (ii) 倍数变化在生物学上是可忽略的，即 $\\lvert \\mathrm{FC} - 1 \\rvert \\le \\tau$。为每个测试用例报告一个布尔值：如果两个标准都成立，则为 $\\,\\text{True}\\,$，否则为 $\\,\\text{False}\\,$。\n\n测试套件（每个用例为 $(n_A, n_B, \\bar{x}_A, \\bar{x}_B, s_A, s_B)$）：\n- 用例 $1$：$(200000, 200000, 100.0, 100.14, 1.0, 1.0)$。\n- 用例 $2$：$(50000, 50000, 50.0, 50.5, 2.0, 2.0)$。\n- 用例 $3$：$(6, 6, 100.0, 100.3, 1.5, 1.5)$。\n- 用例 $4$：$(1000, 1000, 100.0, 100.0, 5.0, 5.0)$。\n- 用例 $5$：$(100000, 100000, 80.0, 81.6, 1.5, 1.5)$。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[\\,\\text{True},\\text{False},\\text{True}\\,]$），结果按用例 $1$ 到 $5$ 的顺序排列。",
            "solution": "对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n- **实验设置**：两种条件，$A$ 和 $B$。\n- **各条件下的数据**：测量值独立同分布（i.i.d.），来自总体均值为 $\\mu_A$ 和 $\\mu_B$、方差有限但可能不相等的正态分布。\n- **为各用例提供的统计数据**：条件 $A$ 的样本量 ($n_A$)、条件 $B$ 的样本量 ($n_B$)、条件 $A$ 的样本均值 ($\\bar{x}_A$)、条件 $B$ 的样本均值 ($\\bar{x}_B$)、条件 $A$ 的样本标准差 ($s_A$) 以及条件 $B$ 的样本标准差 ($s_B$)。\n- **假设检验**：原假设 $H_0: \\mu_A = \\mu_B$ 与双边备择假设 $H_1: \\mu_A \\neq \\mu_B$。\n- **倍数变化定义**：$\\mathrm{FC} = \\bar{x}_B / \\bar{x}_A$。\n- **阈值**：\n    - 显著性阈值：$\\alpha = 10^{-12}$。\n    - 生物学可忽略容差：$\\tau = 10^{-2}$。\n- **判定标准**：确定是否同时满足以下两个条件：\n    1. 双边 $p$ 值严格小于 $\\alpha$。\n    2. 倍数变化在生物学上是可忽略的，定义为 $\\lvert \\mathrm{FC} - 1 \\rvert \\le \\tau$。\n- **测试套件**：\n    - 用例 $1$：$(200000, 200000, 100.0, 100.14, 1.0, 1.0)$。\n    - 用例 $2$：$(50000, 50000, 50.0, 50.5, 2.0, 2.0)$。\n    - 用例 $3$：$(6, 6, 100.0, 100.3, 1.5, 1.5)$。\n    - 用例 $4$：$(1000, 1000, 100.0, 100.0, 5.0, 5.0)$。\n    - 用例 $5$：$(100000, 100000, 80.0, 81.6, 1.5, 1.5)$。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据、定义明确且客观。它提出了一个生物统计学中的标准问题：比较两个独立组的均值。\n- **科学依据**：该问题基于已建立的假设检验统计框架。使用 t 检验比较正态分布总体的均值是一个基本概念。问题正确地指出了方差可能不相等，这需要使用 Welch t 检验，这是一个标准且稳健的程序。\n- **定义明确性**：为每个用例提供了所有必要的参数（$n_A, n_B, \\bar{x}_A, \\bar{x}_B, s_A, s_B$）。判定标准清晰明确。每个测试用例都存在唯一、稳定的解。\n- **客观性**：该问题以精确的数学和统计语言陈述，没有主观论断或歧义。\n\n该问题没有表现出无效标准中列出的任何缺陷。它是一个可形式化、完整且现实的统计任务。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n### 解题推导\n任务是评估每个测试用例是否同时满足两个不同的标准。第一个标准与统计显著性有关，第二个标准与实际或生物学显著性有关。\n\n#### 标准 1：统计显著性（$p$ 值）\n我们必须检验原假设 $H_0: \\mu_A = \\mu_B$ 与双边备择假设 $H_1: \\mu_A \\neq \\mu_B$。问题陈述表明，基础总体是正态的，但其方差可能不相等。这就是 Behrens-Fisher 问题。适用的统计检验是 Welch t 检验，该检验不假定方差相等。\n\n检验统计量 $t$ 的计算公式如下：\n$$\nt = \\frac{\\bar{x}_A - \\bar{x}_B}{\\sqrt{\\frac{s_A^2}{n_A} + \\frac{s_B^2}{n_B}}}\n$$\n其中 $\\bar{x}_A$ 和 $\\bar{x}_B$ 是样本均值，$s_A^2$ 和 $s_B^2$ 是样本方差，$n_A$ 和 $n_B$ 是样本量。\n\n在原假设下，该统计量近似服从 Student t 分布。自由度 $\\nu$ 使用 Welch-Satterthwaite 方程进行近似计算：\n$$\n\\nu \\approx \\frac{\\left(\\frac{s_A^2}{n_A} + \\frac{s_B^2}{n_B}\\right)^2}{\\frac{\\left(\\frac{s_A^2}{n_A}\\right)^2}{n_A - 1} + \\frac{\\left(\\frac{s_B^2}{n_B}\\right)^2}{n_B - 1}}\n$$\n\n双边 $p$ 值是在假设原假设为真的前提下，观测到至少与计算出的检验统计量一样极端的统计量的概率。其计算公式为：\n$$\np = 2 \\cdot \\mathbb{P}(T_\\nu \\ge |t|)\n$$\n其中 $T_\\nu$ 是一个服从自由度为 $\\nu$ 的 t 分布的随机变量。\n\n如果此 $p$ 值严格小于给定的显著性阈值 $\\alpha = 10^{-12}$，则第一个标准得到满足。\n$$\np  10^{-12}\n$$\n\n#### 标准 2：生物学可忽略性（倍数变化）\n倍数变化 $\\mathrm{FC}$ 定义为样本均值的比率：\n$$\n\\mathrm{FC} = \\frac{\\bar{x}_B}{\\bar{x}_A}\n$$\n问题将变化定义为生物学上可忽略的，如果倍数变化与 $1$ 的绝对偏差不超过容差 $\\tau = 10^{-2}$。用数学方式表示为：\n$$\n|\\mathrm{FC} - 1| \\le \\tau\n$$\n代入 $\\tau$ 的值：\n$$\n\\left|\\frac{\\bar{x}_B}{\\bar{x}_A} - 1\\right| \\le 0.01\n$$\n\n#### 最终决策逻辑\n对于每个测试用例，我们计算 Welch t 检验的 $p$ 值和倍数变化。然后我们评估这两个条件的逻辑与：\n$$\n(\\text{结果为真}) \\iff (p  10^{-12}) \\land \\left( \\left|\\frac{\\bar{x}_B}{\\bar{x}_A} - 1\\right| \\le 0.01 \\right)\n$$\n将对所提供的五个测试用例中的每一个执行此评估。\n\n值得注意的是，如果样本量非常大，即使效应量很小（生物学上可忽略），也可能具有高度的统计显著性。差异的标准误 $\\sqrt{s_A^2/n_A + s_B^2/n_B}$ 随着 $n_A$ 和 $n_B$ 的增加而减小，这可能导致即使样本均值差异 $(\\bar{x}_A - \\bar{x}_B)$ 非常小，$t$ 统计量的值也会很大。本问题旨在阐释统计推断中的这一基本概念。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import t as t_dist\n\ndef solve():\n    \"\"\"\n    Solves the problem by analyzing gene expression data under two conditions\n    using Welch's t-test and a fold-change criterion.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (n_A, n_B, x_bar_A, x_bar_B, s_A, s_B)\n    test_cases = [\n        (200000, 200000, 100.0, 100.14, 1.0, 1.0),   # Case 1\n        (50000, 50000, 50.0, 50.5, 2.0, 2.0),       # Case 2\n        (6, 6, 100.0, 100.3, 1.5, 1.5),             # Case 3\n        (1000, 1000, 100.0, 100.0, 5.0, 5.0),       # Case 4\n        (100000, 100000, 80.0, 81.6, 1.5, 1.5),     # Case 5\n    ]\n\n    # Define thresholds\n    alpha = 1e-12\n    tau = 1e-2\n\n    results = []\n    for case in test_cases:\n        n_A, n_B, x_bar_A, x_bar_B, s_A, s_B = case\n\n        # --- Criterion 2: Biological Negligibility ---\n        # Handle division by zero for x_bar_A, though not present in tests.\n        if x_bar_A == 0:\n            # If x_bar_A is 0, FC is undefined or infinite if x_bar_B is not 0.\n            # This would not be negligible. If both are 0, FC is ambiguous.\n            # We assume non-zero means as is typical in gene expression.\n            # Here we treat FC as non-negligible.\n            is_negligible = False\n        else:\n            fold_change = x_bar_B / x_bar_A\n            is_negligible = np.abs(fold_change - 1) = tau\n\n        # --- Criterion 1: Statistical Significance ---\n        # Welch's t-test for two independent samples.\n        var_A = s_A**2\n        var_B = s_B**2\n\n        # Handle edge case where difference is exactly zero\n        if x_bar_A == x_bar_B:\n            p_value = 1.0\n        else:\n            # Standard error of the difference\n            se_diff = np.sqrt(var_A / n_A + var_B / n_B)\n\n            # Welch's t-statistic\n            t_statistic = (x_bar_A - x_bar_B) / se_diff\n        \n            # Welch-Satterthwaite equation for degrees of freedom (nu)\n            term_A = (var_A / n_A)\n            term_B = (var_B / n_B)\n            \n            # Handle cases where sample size is too small (e.g., n=1)\n            # The tests have n > 1, so no division by zero here.\n            dof_numerator = (term_A + term_B)**2\n            dof_denominator = (term_A**2 / (n_A - 1)) + (term_B**2 / (n_B - 1))\n            \n            if dof_denominator == 0:\n                # This would only happen in pathological cases not relevant here\n                # (e.g., zero variance and n>1 which implies all points are same)\n                # Assign a large DoF as a fallback.\n                dof = n_A + n_B - 2\n            else:\n                dof = dof_numerator / dof_denominator\n\n            # Two-sided p-value from the t-distribution survival function (1-CDF)\n            # Using sf is more accurate for very small p-values (in the tail)\n            p_value = 2 * t_dist.sf(np.abs(t_statistic), df=dof)\n\n        is_significant = p_value  alpha\n\n        # --- Final Decision ---\n        # The result is True if and only if both criteria are met.\n        final_decision = is_significant and is_negligible\n        results.append(final_decision)\n\n    # Format the final output as specified\n    output_str = '[' + ','.join(str(res) for res in results) + ']'\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "在数据分析中，我们对受试者进行分组或分层的方式可能会极大地改变最终结论。本练习将介绍辛普森悖论（Simpson's Paradox），这是一个引人入胜的统计学现象，其中在不同数据组中观察到的趋势，在这些组合并后会发生逆转。这个动手实践问题将揭示在医学研究中识别和处理混杂变量的至关重要性 。",
            "id": "2398958",
            "problem": "给定一个为计算生物学和生物信息学构建的二元结果临床比较：对于每个测试用例，存在两个组（一个新治疗组和一个对照组），并且队列按生物性别（男性和女性）分层。在每个分层和组中，都为您提供了个体总数和经历不良事件的个体数量。设 $N_{s,g}$ 表示性别 $s \\in \\{\\text{male}, \\text{female}\\}$ 和组别 $g \\in \\{\\text{treatment}, \\text{control}\\}$ 中的总人数，并设 $X_{s,g}$ 表示相应的不良事件数量。定义事件概率 $p_{s,g}$ 为 $p_{s,g} = X_{s,g} / N_{s,g}$，以及各组总人数 $N_{\\text{treatment}} = \\sum_{s} N_{s,\\text{treatment}}$，$N_{\\text{control}} = \\sum_{s} N_{s,\\text{control}}$，总事件数 $X_{\\text{treatment}} = \\sum_{s} X_{s,\\text{treatment}}$ 和 $X_{\\text{control}} = \\sum_{s} X_{s,\\text{control}}$，以及总概率 $p_{\\text{treatment}} = X_{\\text{treatment}} / N_{\\text{treatment}}$ 和 $p_{\\text{control}} = X_{\\text{control}} / N_{\\text{control}}$。\n\n对于每个测试用例，您必须确定数据集是否在双边显著性水平 $\\alpha = 0.05$ 下表现出具有统计显著性的辛普森悖论，此处定义为：\n- 在男性分层中，治疗是显著有害的：$p_{\\text{male},\\text{treatment}}  p_{\\text{male},\\text{control}}$ 且在关于治疗组和对照组之间不良事件概率相等的有效假设检验下，差异在水平 $\\alpha$ 上具有统计显著性。\n- 在女性分层中，治疗是显著有害的：$p_{\\text{female},\\text{treatment}}  p_{\\text{female},\\text{control}}$ 且在关于治疗组和对照组之间不良事件概率相等的有效假设检验下，差异在水平 $\\alpha$ 上具有统计显著性。\n- 总体上（忽略性别），治疗是显著有益的：$p_{\\text{treatment}}  p_{\\text{control}}$ 且在关于治疗组和对照组之间不良事件概率相等的有效假设检验下，差异在水平 $\\alpha$ 上具有统计显著性。\n\n在每次假设检验中，原假设是治疗组和对照组的不良事件概率相等，决策规则是当且仅当双边 $p$ 值小于或等于 $\\alpha$ 时拒绝原假设。对于每个测试用例，您必须返回一个布尔值，指示上述所有三个要点是否同时成立。\n\n测试套件。对于每个测试用例，输入参数是八个整数 $(N_{\\text{male},\\text{treatment}}, X_{\\text{male},\\text{treatment}}, N_{\\text{male},\\text{control}}, X_{\\text{male},\\text{control}}, N_{\\text{female},\\text{treatment}}, X_{\\text{female},\\text{treatment}}, N_{\\text{female},\\text{control}}, X_{\\text{female},\\text{control}})$：\n- 案例 A（旨在满足具有强统计显著性的辛普森悖论）：$(1000, 180, 20000, 1800, 20000, 400, 5000, 50)$。\n- 案例 B（存在方向性逆转但总体上不显著）：$(200, 40, 1000, 100, 2000, 80, 1000, 20)$。\n- 案例 C（无悖论；治疗在分层内和总体上均有害）：$(1000, 150, 1000, 100, 1000, 40, 1000, 20)$。\n\n程序要求。您的程序必须为每个测试用例构建男性、女性和总体的 $2\\times 2$ 表格；在双边水平 $\\alpha = 0.05$ 下执行有效的假设检验，以评估治疗组和对照组之间不良事件概率的相等性；在每次比较中验证所需的效果方向；并输出一个布尔值，指示是否存在具有统计显著性的辛普森悖论。您的程序应产生单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，`[resultA, resultB, resultC]`），其中每个条目都是字面标记 True 或 False。不允许有其他输出。",
            "solution": "问题陈述经过验证。\n\n步骤1：提取已知信息。\n- 队列分层：按生物性别分为两个分层，$s \\in \\{\\text{male}, \\text{female}\\}$。\n- 实验组：两个组别，$g \\in \\{\\text{treatment}, \\text{control}\\}$。\n- 原始数据：对于每个分层 $s$ 和组别 $g$，我们被给予个体总数 $N_{s,g}$，以及经历不良事件的个体数 $X_{s,g}$。\n- 派生量：\n  - 特定分层的事件概率：$p_{s,g} = X_{s,g} / N_{s,g}$。\n  - 总体总人数：$N_{\\text{treatment}} = \\sum_{s} N_{s,\\text{treatment}}$，$N_{\\text{control}} = \\sum_{s} N_{s,\\text{control}}$。\n  - 总体总事件数：$X_{\\text{treatment}} = \\sum_{s} X_{s,\\text{treatment}}$，$X_{\\text{control}} = \\sum_{s} X_{s,\\text{control}}$。\n  - 总体事件概率：$p_{\\text{treatment}} = X_{\\text{treatment}} / N_{\\text{treatment}}$，$p_{\\text{control}} = X_{\\text{control}} / N_{\\text{control}}$。\n- 显著性水平：双边检验为 $\\alpha = 0.05$。\n- 假设检验：原假设是治疗组和对照组的不良事件概率相等。如果双边 $p$ 值小于或等于 $\\alpha$，则拒绝原假设。\n- 具有统计显著性的辛普森悖论的定义：同时满足三个条件：\n  1. 男性分层：治疗是显著有害的，即 $p_{\\text{male},\\text{treatment}}  p_{\\text{male},\\text{control}}$ 并且差异在水平 $\\alpha$ 上具有统计显著性。\n  2. 女性分层：治疗是显著有害的，即 $p_{\\text{female},\\text{treatment}}  p_{\\text{female},\\text{control}}$ 并且差异在水平 $\\alpha$ 上具有统计显著性。\n  3. 总体人群：治疗是显著有益的，即 $p_{\\text{treatment}}  p_{\\text{control}}$ 并且差异在水平 $\\alpha$ 上具有统计显著性。\n- 测试用例（输入：$(N_{m,t}, X_{m,t}, N_{m,c}, X_{m,c}, N_{f,t}, X_{f,t}, N_{f,c}, X_{f,c})$）：\n  - 案例 A：$(1000, 180, 20000, 1800, 20000, 400, 5000, 50)$。\n  - 案例 B：$(200, 40, 1000, 100, 2000, 80, 1000, 20)$。\n  - 案例 C：$(1000, 150, 1000, 100, 1000, 40, 1000, 20)$。\n- 输出格式：单行输出，包含一个布尔结果列表，例如，`[True,False,False]`。\n\n步骤2：使用提取的已知信息进行验证。\n- 该问题具有 **科学依据**。它在临床试验分析的背景下探讨了辛普森悖论，这是一个有详细记载的统计现象，也是生物统计学和计算生物学中的一个标准应用。\n- 该问题是 **适定的**。悖论的条件以数学精度陈述。所有必要的数据和参数，包括显著性水平 $\\alpha$，都已提供。为每个案例确定布尔结果的任务是明确无误的。\n- 该问题是 **客观的**。它使用精确的定量语言表述，没有主观或基于意见的断言。“有效的假设检验”一词允许选择一个标准的统计程序，这在科学背景下是一个可接受的规范。所提供的计数是整数，其中 $X \\le N$，这在物理上是一致的。\n\n步骤3：结论与行动。\n该问题被认为是 **有效的**。它是自洽的、科学上合理的和适定的。可以构建一个严谨的解决方案。\n\n任务是为每个测试用例验证是否满足定义具有统计显著性的辛普森悖论的一组特定三个条件。这需要执行三个独立的假设检验：一个用于男性分层，一个用于女性分层，一个用于汇总（总体）数据。每个检验都评估治疗组和对照组之间不良事件概率相等的原假设 ($H_0: p_{\\text{treatment}} = p_{\\text{control}}$)，相对于双边备择假设 ($H_1: p_{\\text{treatment}} \\neq p_{\\text{control}}$)。\n\n一个科学上合适且“有效的假设检验”，用于比较来自独立样本的两个比例，是 Pearson 卡方独立性检验（Pearson's chi-squared test of independence）在 $2 \\times 2$ 列联表上的应用。对于大样本（如此处所示），该检验等效于双边双比例 $z$ 检验。对于任何比较，一个治疗组有 $N_t$ 个个体中的 $X_t$ 个事件，一个对照组有 $N_c$ 个个体中的 $X_c$ 个事件，数据可以排列在以下列联表中：\n$$\n\\begin{array}{c|cc|c}\n   \\text{Adverse Event}  \\text{No Event}  \\text{Total} \\\\ \\hline\n\\text{Treatment}  X_t  N_t - X_t  N_t \\\\\n\\text{Control}  X_c  N_c - X_c  N_c\n\\end{array}\n$$\n卡方检验统计量从此表中计算得出，其对应的 $p$ 值与显著性水平 $\\alpha = 0.05$ 进行比较。如果 $p \\le \\alpha$，则拒绝原假设。\n\n每个测试用例的程序如下：\n1.  验证男性分层的条件。\n    - 首先，检查方向性：治疗组中不良事件的样本比例是否大于对照组？即，$p_{\\text{male},\\text{treatment}}  p_{\\text{male},\\text{control}}$ 是否成立？\n    - 如果方向正确，则为男性构建 $2 \\times 2$ 表格并执行卡方检验。检查所得的 $p$ 值是否 $\\le 0.05$。\n    - 只有当方向和统计显著性标准都满足时，男性的条件才算满足。\n\n2.  验证女性分层的条件。\n    - 检查方向性：$p_{\\text{female},\\text{treatment}}  p_{\\text{female},\\text{control}}$ 是否成立？\n    - 如果成立，则为女性构建 $2 \\times 2$ 表格，执行卡方检验，并检查 $p$ 值是否 $\\le 0.05$。\n    - 只有当两个标准都满足时，女性的条件才算满足。\n\n3.  验证总体人群的条件。\n    - 首先，汇总数据：$N_t = N_{m,t} + N_{f,t}$，$X_t = X_{m,t} + X_{f,t}$，$N_c = N_{m,c} + N_{f,c}$，以及 $X_c = X_{m,c} + X_{f,c}$。\n    - 检查方向性：治疗组的总体不良事件比例是否小于对照组？即，$p_{\\text{treatment}}  p_{\\text{control}}$ 是否成立？\n    - 如果方向正确，则为汇总数据构建 $2 \\times 2$ 表格，执行卡方检验，并检查 $p$ 值是否 $\\le 0.05$。\n    - 只有当两个标准都满足时，总体的条件才算满足。\n\n最后，当且仅当上述所有三个条件——针对男性、女性和总体人群——同时为真时，所定义的辛普森悖论才存在。根据这一最终判定，为每个测试用例返回一个布尔结果。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import chi2_contingency\n\ndef solve():\n    \"\"\"\n    Solves the Simpson's paradox problem for the given test cases.\n    \"\"\"\n\n    # Significance level\n    alpha = 0.05\n\n    # Test cases: (N_mt, X_mt, N_mc, X_mc, N_ft, X_ft, N_fc, X_fc)\n    # m = male, f = female, t = treatment, c = control\n    test_cases = [\n        # Case A: Intended to satisfy Simpson’s paradox with strong statistical significance\n        (1000, 180, 20000, 1800, 20000, 400, 5000, 50),\n        # Case B: Directional reversal present but not significant overall\n        (200, 40, 1000, 100, 2000, 80, 1000, 20),\n        # Case C: No paradox; treatment harmful within strata and overall\n        (1000, 150, 1000, 100, 1000, 40, 1000, 20),\n    ]\n\n    def check_hypothesis(X_t, N_t, X_c, N_c, direction, alpha_level):\n        \"\"\"\n        Performs a hypothesis test for two proportions and checks directionality.\n\n        Args:\n            X_t (int): Number of events in treatment group.\n            N_t (int): Total individuals in treatment group.\n            X_c (int): Number of events in control group.\n            N_c (int): Total individuals in control group.\n            direction (str): 'greater' or 'less', specifying the required\n                             relationship p_t vs p_c.\n            alpha_level (float): The significance level.\n\n        Returns:\n            bool: True if direction and significance conditions are met.\n        \"\"\"\n        # Avoid division by zero if a group has no subjects.\n        if N_t == 0 or N_c == 0:\n            return False\n\n        p_t = X_t / N_t\n        p_c = X_c / N_c\n\n        # 1. Check directionality\n        if direction == 'greater':\n            if not p_t > p_c:\n                return False\n        elif direction == 'less':\n            if not p_t  p_c:\n                return False\n        else:\n            # Invalid direction specification\n            return False\n            \n        # 2. Check statistical significance\n        # Construct the 2x2 contingency table\n        # Table: [[events_t, no_events_t], [events_c, no_events_c]]\n        contingency_table = np.array([\n            [X_t, N_t - X_t],\n            [X_c, N_c - X_c]\n        ])\n\n        # Perform Pearson's chi-squared test.\n        # The p-value is for a two-sided test, as required.\n        # correction=True is the default (Yates' correction for continuity).\n        try:\n            _, p_value, _, _ = chi2_contingency(contingency_table)\n        except ValueError:\n            # This can happen if a row/column sum is zero, which is handled\n            # by the N_t/N_c check, but as a safeguard.\n            return False\n\n        return p_value = alpha_level\n\n    results = []\n    for case in test_cases:\n        N_mt, X_mt, N_mc, X_mc, N_ft, X_ft, N_fc, X_fc = case\n\n        # Condition 1: Male stratum - Treatment significantly harmful\n        male_cond_met = check_hypothesis(X_mt, N_mt, X_mc, N_mc, 'greater', alpha)\n\n        # Condition 2: Female stratum - Treatment significantly harmful\n        female_cond_met = check_hypothesis(X_ft, N_ft, X_fc, N_fc, 'greater', alpha)\n\n        # Condition 3: Overall - Treatment significantly beneficial\n        # Aggregate data\n        N_t_overall = N_mt + N_ft\n        X_t_overall = X_mt + X_ft\n        N_c_overall = N_mc + N_fc\n        X_c_overall = X_mc + X_fc\n        \n        overall_cond_met = check_hypothesis(X_t_overall, N_t_overall, X_c_overall, N_c_overall, 'less', alpha)\n        \n        # Simpson's Paradox holds if all three conditions are met\n        is_paradox = male_cond_met and female_cond_met and overall_cond_met\n        results.append(is_paradox)\n\n    # Format the output as a string list of booleans literal\n    # e.g., \"[True,False,False]\"\n    output_str = f\"[{','.join(str(r) for r in results)}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}