{
    "hands_on_practices": [
        {
            "introduction": "在我们评估关联强度时，点估计（如风险比、比值比或率比）本身并不足够。为了进行统计推断，如构建置信区间或进行假设检验，我们必须量化这些估计量的不确定性。本练习将通过第一性原理，指导您使用Delta方法推导对数风险比（$ \\ln(\\text{RR}) $）、对数比值比（$ \\ln(\\text{OR}) $）和对数率比（$ \\ln(\\text{IRR}) $）的方差估计公式。完成此练习将使您深刻理解这些关联度量背后统计基础，以及统计软件中标准误计算的理论依据。",
            "id": "4972058",
            "problem": "一项前瞻性队列研究在一个二元健康结局上比较了一个暴露组和一个非暴露组，并在一个平行的监测系统中，基于人时数比较了发病率。令 $a$ 表示暴露组中出现结局的数目，$b$ 表示暴露组中未出现结局的数目，因此暴露组的大小为 $n_{1} = a + b$。令 $c$ 表示非暴露组中出现结局的数目，$d$ 表示非暴露组中未出现结局的数目，因此非暴露组的大小为 $n_{0} = c + d$。定义经验风险比 (RR)、比值比 (OR) 和发病率比 (IRR) 如下：\n$$\\widehat{\\text{RR}} = \\frac{a / n_{1}}{c / n_{0}}, \\quad \\widehat{\\text{OR}} = \\frac{a / b}{c / d} = \\frac{a d}{b c}, \\quad \\widehat{\\text{IRR}} = \\frac{X_{1} / T_{1}}{X_{0} / T_{0}},$$\n其中 $X_{1}$ 和 $X_{0}$ 分别表示暴露组和非暴露组中的独立泊松事件计数，$T_{1}$ 和 $T_{0}$ 表示相应的固定人时总数。\n\n假设以下数据生成机制：\n- 在队列研究部分，$a \\sim \\text{Binomial}(n_{1}, p_{1})$ 和 $c \\sim \\text{Binomial}(n_{0}, p_{0})$ 相互独立，其中 $p_{1}$ 和 $p_{0}$ 是暴露组和非暴露组的真实风险。\n- 在发病率部分，$X_{1} \\sim \\text{Poisson}(\\lambda_{1} T_{1})$ 和 $X_{0} \\sim \\text{Poisson}(\\lambda_{0} T_{0})$ 相互独立，其中 $\\lambda_{1}$ 和 $\\lambda_{0}$ 是真实的发病率。\n\n仅使用二项模型和泊松模型的大样本理论的基本原理以及Delta方法，推导 $\\widehat{\\operatorname{Var}}\\!\\left[\\ln\\!\\left(\\widehat{\\text{RR}}\\right)\\right]$、$\\widehat{\\operatorname{Var}}\\!\\left[\\ln\\!\\left(\\widehat{\\text{OR}}\\right)\\right]$ 和 $\\widehat{\\operatorname{Var}}\\!\\left[\\ln\\!\\left(\\widehat{\\text{IRR}}\\right)\\right]$ 的一阶大样本估计量，并纯粹用 $a, b, c, d, X_{1}, X_{0}, T_{1}, T_{0}$ 表示。\n\n你的最终答案必须是一个单一的闭式解析表达式，以行矩阵的形式呈现，其中三个条目按 $\\widehat{\\operatorname{Var}}\\!\\left[\\ln\\!\\left(\\widehat{\\text{RR}}\\right)\\right]$、$\\widehat{\\operatorname{Var}}\\!\\left[\\ln\\!\\left(\\widehat{\\text{OR}}\\right)\\right]$、$\\widehat{\\operatorname{Var}}\\!\\left[\\ln\\!\\left(\\widehat{\\text{IRR}}\\right)\\right]$ 的顺序排列。使用自然对数 $\\ln$。不需要进行数值计算、四舍五入或添加单位。",
            "solution": "该问题要求推导风险比 ($\\widehat{\\text{RR}}$)、比值比 ($\\widehat{\\text{OR}}$) 和发病率比 ($\\widehat{\\text{IRR}}$) 的自然对数的方差的大样本估计量。此推导的核心理论工具是Delta方法。\n\nDelta方法为一个或多个随机变量的函数的方差提供了一阶泰勒级数近似。对于单个随机变量 $Y$ 和可微函数 $g$，$g(Y)$ 的方差近似为：\n$$ \\operatorname{Var}[g(Y)] \\approx \\left( g'(E[Y]) \\right)^2 \\operatorname{Var}[Y] $$\n对于两个独立随机变量 $Y_1$ 和 $Y_2$ 的函数，$g(Y_1, Y_2)$ 的方差近似为：\n$$ \\operatorname{Var}[g(Y_1, Y_2)] \\approx \\left( \\frac{\\partial g}{\\partial y_1} \\right)^2 \\operatorname{Var}[Y_1] + \\left( \\frac{\\partial g}{\\partial y_2} \\right)^2 \\operatorname{Var}[Y_2] $$\n其中偏导数在 $Y_1$ 和 $Y_2$ 的期望值处求值。该方差的大样本估计量（表示为 $\\widehat{\\operatorname{Var}}$）是通过将总体参数（包括期望值和方差）替换为其基于样本的估计值得到的。\n\n所要求的三个方差估计量分别推导如下。\n\n1.  **$\\widehat{\\operatorname{Var}}\\!\\left[\\ln\\!\\left(\\widehat{\\text{RR}}\\right)\\right]$ 的推导**\n\n经验风险比定义为 $\\widehat{\\text{RR}} = \\frac{\\hat{p}_{1}}{\\hat{p}_{0}}$，其中 $\\hat{p}_{1} = a/n_{1}$ 和 $\\hat{p}_{0} = c/n_{0}$ 分别是暴露组和非暴露组的估计风险。其自然对数为 $\\ln(\\widehat{\\text{RR}}) = \\ln(\\hat{p}_{1}) - \\ln(\\hat{p}_{0})$。\n随机变量 $a \\sim \\text{Binomial}(n_{1}, p_{1})$ 和 $c \\sim \\text{Binomial}(n_{0}, p_{0})$ 相互独立。因此，估计量 $\\hat{p}_{1} = a/n_{1}$ 和 $\\hat{p}_{0} = c/n_{0}$ 也相互独立。\n由于独立性，差的方差等于方差的和：\n$$ \\operatorname{Var}[\\ln(\\widehat{\\text{RR}})] = \\operatorname{Var}[\\ln(\\hat{p}_{1})] + \\operatorname{Var}[\\ln(\\hat{p}_{0})] $$\n我们对每一项应用Delta方法。令 $g(p) = \\ln(p)$，则 $g'(p) = 1/p$。\n$\\hat{p}_{1}$ 的方差为 $\\operatorname{Var}[\\hat{p}_{1}] = \\operatorname{Var}[a/n_{1}] = \\frac{1}{n_{1}^2}\\operatorname{Var}[a] = \\frac{n_{1} p_{1}(1-p_{1})}{n_{1}^2} = \\frac{p_{1}(1-p_{1})}{n_{1}}$。\n对 $\\ln(\\hat{p}_{1})$ 应用Delta方法：\n$$ \\operatorname{Var}[\\ln(\\hat{p}_{1})] \\approx \\left( g'(p_1) \\right)^2 \\operatorname{Var}[\\hat{p}_{1}] = \\left(\\frac{1}{p_{1}}\\right)^2 \\frac{p_{1}(1-p_{1})}{n_{1}} = \\frac{1-p_{1}}{n_{1} p_{1}} $$\n类似地，对于非暴露组：\n$$ \\operatorname{Var}[\\ln(\\hat{p}_{0})] \\approx \\frac{1-p_{0}}{n_{0} p_{0}} $$\n将这些结合起来，得到 $\\ln(\\widehat{\\text{RR}})$ 的近似方差：\n$$ \\operatorname{Var}[\\ln(\\widehat{\\text{RR}})] \\approx \\frac{1-p_{1}}{n_{1} p_{1}} + \\frac{1-p_{0}}{n_{0} p_{0}} $$\n为了获得估计量 $\\widehat{\\operatorname{Var}}\\!\\left[\\ln\\!\\left(\\widehat{\\text{RR}}\\right)\\right]$，我们将真实概率 $p_{1}$ 和 $p_{0}$ 替换为它们的样本估计值 $\\hat{p}_{1} = a/n_{1}$ 和 $\\hat{p}_{0} = c/n_{0}$。\n$$ \\widehat{\\operatorname{Var}}\\!\\left[\\ln\\!\\left(\\widehat{\\text{RR}}\\right)\\right] = \\frac{1-\\hat{p}_{1}}{n_{1}\\hat{p}_{1}} + \\frac{1-\\hat{p}_{0}}{n_{0}\\hat{p}_{0}} = \\frac{1 - a/n_{1}}{n_{1}(a/n_{1})} + \\frac{1 - c/n_{0}}{n_{0}(c/n_{0})} $$\n$$ = \\frac{(n_{1}-a)/n_{1}}{a} + \\frac{(n_{0}-c)/n_{0}}{c} = \\frac{b/n_{1}}{a} + \\frac{d/n_{0}}{c} = \\frac{b}{an_{1}} + \\frac{d}{cn_{0}} $$\n由于 $n_{1} = a+b$ 和 $n_{0} = c+d$，这可以写成：\n$$ \\frac{b}{a(a+b)} + \\frac{d}{c(c+d)} = \\left(\\frac{1}{a} - \\frac{1}{a+b}\\right) + \\left(\\frac{1}{c} - \\frac{1}{c+d}\\right) $$\n因此，最终的估计量为 $\\frac{1}{a} - \\frac{1}{a+b} + \\frac{1}{c} - \\frac{1}{c+d}$。\n\n2.  **$\\widehat{\\operatorname{Var}}\\!\\left[\\ln\\!\\left(\\widehat{\\text{OR}}\\right)\\right]$ 的推导**\n\n经验比值比是 $\\widehat{\\text{OR}} = \\frac{a/b}{c/d}$。用比例来表示更为方便：$\\widehat{\\text{OR}} = \\frac{\\hat{p}_{1}/(1-\\hat{p}_{1})}{\\hat{p}_{0}/(1-\\hat{p}_{0})}$。\n比值比的自然对数，即对数比值比，是：\n$$ \\ln(\\widehat{\\text{OR}}) = \\ln\\left(\\frac{\\hat{p}_{1}}{1-\\hat{p}_{1}}\\right) - \\ln\\left(\\frac{\\hat{p}_{0}}{1-\\hat{p}_{0}}\\right) = \\text{logit}(\\hat{p}_{1}) - \\text{logit}(\\hat{p}_{0}) $$\n和之前一样，$\\hat{p}_{1}$ 和 $\\hat{p}_{0}$ 是独立的。我们对logit函数 $g(p) = \\text{logit}(p) = \\ln(p) - \\ln(1-p)$ 应用Delta方法。\n其导数为 $g'(p) = \\frac{1}{p} + \\frac{1}{1-p} = \\frac{1}{p(1-p)}$。\n$\\text{logit}(\\hat{p}_{1})$ 的方差为：\n$$ \\operatorname{Var}[\\text{logit}(\\hat{p}_{1})] \\approx \\left( g'(p_1) \\right)^2 \\operatorname{Var}[\\hat{p}_{1}] = \\left(\\frac{1}{p_{1}(1-p_{1})}\\right)^2 \\frac{p_{1}(1-p_{1})}{n_{1}} = \\frac{1}{n_{1}p_{1}(1-p_{1})} $$\n根据独立性，$\\ln(\\widehat{\\text{OR}})$ 的方差为：\n$$ \\operatorname{Var}[\\ln(\\widehat{\\text{OR}})] \\approx \\frac{1}{n_{1}p_{1}(1-p_{1})} + \\frac{1}{n_{0}p_{0}(1-p_{0})} $$\n通过将参数替换为样本估计值来找到估计量：\n$$ \\widehat{\\operatorname{Var}}\\!\\left[\\ln\\!\\left(\\widehat{\\text{OR}}\\right)\\right] = \\frac{1}{n_{1}\\hat{p}_{1}(1-\\hat{p}_{1})} + \\frac{1}{n_{0}\\hat{p}_{0}(1-\\hat{p}_{0})} $$\n现在，代入 $\\hat{p}_{1} = a/n_{1}$，$1-\\hat{p}_{1} = b/n_{1}$，$\\hat{p}_{0} = c/n_{0}$ 和 $1-\\hat{p}_{0} = d/n_{0}$：\n$$ \\widehat{\\operatorname{Var}}\\!\\left[\\ln\\!\\left(\\widehat{\\text{OR}}\\right)\\right] = \\frac{1}{n_{1}\\frac{a}{n_{1}}\\frac{b}{n_{1}}} + \\frac{1}{n_{0}\\frac{c}{n_{0}}\\frac{d}{n_{0}}} = \\frac{n_{1}}{ab} + \\frac{n_{0}}{cd} $$\n代入 $n_{1} = a+b$ 和 $n_{0} = c+d$：\n$$ \\frac{a+b}{ab} + \\frac{c+d}{cd} = \\left(\\frac{a}{ab} + \\frac{b}{ab}\\right) + \\left(\\frac{c}{cd} + \\frac{d}{cd}\\right) = \\frac{1}{b} + \\frac{1}{a} + \\frac{1}{d} + \\frac{1}{c} $$\n因此，最终的估计量是 $\\frac{1}{a} + \\frac{1}{b} + \\frac{1}{c} + \\frac{1}{d}$。\n\n3.  **$\\widehat{\\operatorname{Var}}\\!\\left[\\ln\\!\\left(\\widehat{\\text{IRR}}\\right)\\right]$ 的推导**\n\n经验发病率比为 $\\widehat{\\text{IRR}} = \\frac{X_{1}/T_{1}}{X_{0}/T_{0}}$。其自然对数为：\n$$ \\ln(\\widehat{\\text{IRR}}) = \\ln(X_{1}) - \\ln(X_{0}) - \\ln(T_{1}) + \\ln(T_{0}) $$\n随机变量是事件计数 $X_{1} \\sim \\text{Poisson}(\\lambda_{1} T_{1})$ 和 $X_{0} \\sim \\text{Poisson}(\\lambda_{0} T_{0})$，它们是独立的。人时总数 $T_{1}$ 和 $T_{0}$ 是固定常数。\n和的方差是方差的和（常数的方差为零）：\n$$ \\operatorname{Var}[\\ln(\\widehat{\\text{IRR}})] = \\operatorname{Var}[\\ln(X_{1})] + \\operatorname{Var}[\\ln(X_{0})] $$\n我们对 $g(X) = \\ln(X)$ 应用Delta方法，其导数为 $g'(X) = 1/X$。对于泊松分布，方差等于均值，所以 $\\operatorname{Var}[X_{1}] = E[X_{1}] = \\lambda_{1} T_{1}$。\n对 $\\ln(X_{1})$ 应用Delta方法：\n$$ \\operatorname{Var}[\\ln(X_{1})] \\approx \\left( g'(E[X_{1}]) \\right)^2 \\operatorname{Var}[X_{1}] = \\left(\\frac{1}{E[X_{1}]}\\right)^2 \\operatorname{Var}[X_{1}] = \\frac{\\operatorname{Var}[X_{1}]}{(E[X_{1}])^2} = \\frac{\\lambda_{1} T_{1}}{(\\lambda_{1} T_{1})^2} = \\frac{1}{\\lambda_{1} T_{1}} $$\n类似地，对于非暴露组，$\\operatorname{Var}[\\ln(X_{0})] \\approx \\frac{1}{\\lambda_{0} T_{0}}$。\n$\\ln(\\widehat{\\text{IRR}})$ 的近似方差为：\n$$ \\operatorname{Var}[\\ln(\\widehat{\\text{IRR}})] \\approx \\frac{1}{\\lambda_{1} T_{1}} + \\frac{1}{\\lambda_{0} T_{0}} $$\n为了构建估计量 $\\widehat{\\operatorname{Var}}\\!\\left[\\ln\\!\\left(\\widehat{\\text{IRR}}\\right)\\right]$，我们必须估计参数 $\\mu_{1}=\\lambda_{1}T_{1}$ 和 $\\mu_{0}=\\lambda_{0}T_{0}$。对于泊松分布，均值参数 $\\mu$ 的最大似然估计是观测到的计数。因此，我们将 $\\lambda_{1}T_{1}$ 替换为 $X_{1}$，将 $\\lambda_{0}T_{0}$ 替换为 $X_{0}$。\n$$ \\widehat{\\operatorname{Var}}\\!\\left[\\ln\\!\\left(\\widehat{\\text{IRR}}\\right)\\right] = \\frac{1}{X_{1}} + \\frac{1}{X_{0}} $$\n这就是对数发病率比的方差的最终估计量。\n\n将推导出的三个大样本估计量按要求组合成一个行矩阵。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{1}{a} - \\frac{1}{a+b} + \\frac{1}{c} - \\frac{1}{c+d}  \\frac{1}{a} + \\frac{1}{b} + \\frac{1}{c} + \\frac{1}{d}  \\frac{1}{X_{1}} + \\frac{1}{X_{0}} \\end{pmatrix} } $$"
        },
        {
            "introduction": "匹配病例对照研究是一种控制混杂因素的有效设计，但由于每个匹配对都引入了一个冗余参数（nuisance parameter），直接应用标准逻辑回归会导致有偏估计。为了解决这个问题，我们可以采用条件逻辑回归。本练习将引导您推导单个匹配对的条件似然，展示如何通过条件化消除冗余参数，从而获得对感兴趣参数（对数比值比）的有效估计。通过这个过程，您将理解为何分析最终仅依赖于不一致对（discordant pairs），并掌握处理匹配数据的关键理论。",
            "id": "4972042",
            "problem": "一项 $1{:}1$ 匹配病例对照研究评估了二元暴露 $X \\in \\{0,1\\}$ 与二元结局 $Y \\in \\{0,1\\}$ 之间的关联，其中 $Y=1$ 表示病例，$Y=0$ 表示对照。每个匹配对 $i$ 由两名个体组成，这两名个体在测量的匹配因素（例如，年龄、诊所和日历时间）上具有可比性，并且对内的病例对照状态由 $Y$ 决定。假设每个匹配对具有一个分层特异性截距，其逻辑回归模型如下：\n$$\n\\operatorname{logit}\\big(\\Pr(Y=1 \\mid X=x, \\text{pair } i)\\big) \\;=\\; \\alpha_i + \\beta x,\n$$\n其中 $\\alpha_i$ 是特定于匹配对 $i$ 的未知滋扰参数，$\\beta$ 是与 $X$ 相关的我们感兴趣的对数比值比参数。\n\n仅使用逻辑斯谛函数、比值和条件概率的定义，并且不借助任何预先推导的条件似然捷径：\n\n- 通过以“对中恰好有一名受试者是病例”（即 $\\sum_{j=1}^{2} Y_{ij} = 1$）这一事件为条件，推导单个匹配对 $i$ 的条件似然贡献，并明确展示滋扰参数 $\\alpha_i$ 是如何通过这种条件化被消除的。\n- 结合来自独立匹配对的成对条件贡献，用不一致对的数量来表示完整的条件似然，其中不一致对是指病例和对照具有不同暴露值的匹配对。令 $m_{10}$ 表示病例暴露（$X=1$）且对照未暴露（$X=0$）的匹配对数量，令 $m_{01}$ 表示病例未暴露（$X=0$）且对照暴露（$X=1$）的匹配对数量。\n- 使用您推导出的条件似然，以 $m_{10}$ 和 $m_{01}$ 的形式获得 $\\exp(\\beta)$ 的最大似然估计量。将 $\\exp(\\beta)$ 解释为匹配比值比 (OR)，在首次使用时定义比值比 (OR)，并解释条件化如何控制匹配因素。\n- 对于一个数据集，$m_{10} = 18$，$m_{01} = 12$，其余匹配对为一致对，计算 $\\exp(\\hat{\\beta})$ 的数值。以单个无单位的数字形式提供最终答案；无需四舍五入。",
            "solution": "### 推导与解答\n\n**第1部分：单个匹配对的条件似然**\n\n设匹配对 $i$ 中的两名个体由 $j=1$ 和 $j=2$ 索引。他们各自的暴露为 $X_{i1}$ 和 $X_{i2}$。逻辑模型由 $\\operatorname{logit}\\big(\\Pr(Y_{ij}=1 \\mid X_{ij}, i)\\big) = \\alpha_i + \\beta X_{ij}$ 给出。逻辑斯谛函数是 $p = \\frac{\\exp(\\eta)}{1+\\exp(\\eta)}$，其中 $\\eta$ 是线性预测变量。因此，匹配对 $i$ 中的个体 $j$ 成为病例（$Y_{ij}=1$）的概率是：\n$$\nP_{ij} = \\Pr(Y_{ij}=1 \\mid X_{ij}, i) \\;=\\; \\frac{\\exp(\\alpha_i + \\beta X_{ij})}{1 + \\exp(\\alpha_i + \\beta X_{ij})}\n$$\n而成为对照（$Y_{ij}=0$）的概率是：\n$$\n1 - P_{ij} = \\Pr(Y_{ij}=0 \\mid X_{ij}, i) \\;=\\; \\frac{1}{1 + \\exp(\\alpha_i + \\beta X_{ij})}\n$$\n根据设计，每个匹配对恰好有一个病例和一个对照，所以我们以事件 $\\sum_{j=1}^{2} Y_{ij} = 1$ 为条件。让我们将两位个体观察到的暴露记为 $(x_{i1}, x_{i2})$，他们的结局记为 $(y_{i1}, y_{i2})$。不失一般性，假设个体1是病例（$y_{i1}=1$），个体2是对照（$y_{i2}=0$）。该匹配对对条件似然的贡献是在其中一个是病例另一个是对照的条件下，出现这一特定结局配置的概率。\n$$\nL_i(\\beta) = \\Pr(Y_{i1}=1, Y_{i2}=0 \\mid \\sum_{j=1}^{2} Y_{ij} = 1, X_{i1}=x_{i1}, X_{i2}=x_{i2})\n$$\n使用条件概率的定义 $P(A \\mid B) = P(A \\cap B) / P(B)$：\n$$\nL_i(\\beta) = \\frac{\\Pr(Y_{i1}=1, Y_{i2}=0 \\mid x_{i1}, x_{i2})}{\\Pr(\\sum_{j=1}^{2} Y_{ij} = 1 \\mid x_{i1}, x_{i2})}\n$$\n假设两名个体的结局在其协变量（包括分层 $\\alpha_i$）给定的条件下是独立的，则分子为：\n$$\n\\Pr(Y_{i1}=1, Y_{i2}=0 \\mid x_{i1}, x_{i2}) = P_{i1}(1-P_{i2}) = \\frac{\\exp(\\alpha_i + \\beta x_{i1})}{1 + \\exp(\\alpha_i + \\beta x_{i1})} \\cdot \\frac{1}{1 + \\exp(\\alpha_i + \\beta x_{i2})}\n$$\n分母是条件事件的总概率，它有两种可能性：个体1是病例且个体2是对照，或者个体1是对照且个体2是病例。\n$$\n\\Pr(\\sum_{j=1}^{2} Y_{ij} = 1 \\mid x_{i1}, x_{i2}) = P_{i1}(1-P_{i2}) + (1-P_{i1})P_{i2}\n$$\n$$\n= \\frac{\\exp(\\alpha_i + \\beta x_{i1})}{(1+\\exp(\\alpha_i + \\beta x_{i1}))(1+\\exp(\\alpha_i + \\beta x_{i2}))} + \\frac{\\exp(\\alpha_i + \\beta x_{i2})}{(1+\\exp(\\alpha_i + \\beta x_{i1}))(1+\\exp(\\alpha_i + \\beta x_{i2}))}\n$$\n$$\n= \\frac{\\exp(\\alpha_i + \\beta x_{i1}) + \\exp(\\alpha_i + \\beta x_{i2})}{(1+\\exp(\\alpha_i + \\beta x_{i1}))(1+\\exp(\\alpha_i + \\beta x_{i2}))}\n$$\n分子除以分母，分母中的公因子被约去：\n$$\nL_i(\\beta) = \\frac{\\exp(\\alpha_i + \\beta x_{i1})}{\\exp(\\alpha_i + \\beta x_{i1}) + \\exp(\\alpha_i + \\beta x_{i2})}\n$$\n为展示滋扰参数 $\\alpha_i$ 的消除，我们从分子和分母中提出因子 $\\exp(\\alpha_i)$：\n$$\nL_i(\\beta) = \\frac{\\exp(\\alpha_i) \\exp(\\beta x_{i1})}{\\exp(\\alpha_i) \\exp(\\beta x_{i1}) + \\exp(\\alpha_i) \\exp(\\beta x_{i2})} = \\frac{\\exp(\\alpha_i) \\exp(\\beta x_{i1})}{\\exp(\\alpha_i) (\\exp(\\beta x_{i1}) + \\exp(\\beta x_{i2}))}\n$$\n约去 $\\exp(\\alpha_i)$，我们得到匹配对 $i$ 的条件似然贡献，其中个体1是病例，个体2是对照：\n$$\nL_i(\\beta) = \\frac{\\exp(\\beta x_{i1})}{\\exp(\\beta x_{i1}) + \\exp(\\beta x_{i2})}\n$$\n这个表达式只依赖于匹配对中两个个体的暴露和我们感兴趣的参数 $\\beta$，从而成功地消除了滋扰参数 $\\alpha_i$。\n\n**第2部分：完整条件似然**\n\n让我们将匹配对 $i$ 中病例的暴露记为 $x_{ic}$，对照的暴露记为 $x_{ik}$。匹配对 $i$ 的条件似然是在给定暴露集合 $\\{x_{ic}, x_{ik}\\}$ 的条件下，暴露为 $x_{ic}$ 的个体是病例的概率：\n$$\nL_i(\\beta) = \\frac{\\exp(\\beta x_{ic})}{\\exp(\\beta x_{ic}) + \\exp(\\beta x_{ik})}\n$$\n完整的条件似然 $L_C(\\beta)$ 是所有 $N$ 个独立匹配对贡献的乘积：\n$$\nL_C(\\beta) = \\prod_{i=1}^{N} \\frac{\\exp(\\beta x_{ic})}{\\exp(\\beta x_{ic}) + \\exp(\\beta x_{ik})}\n$$\n我们可以将匹配对分为四种类型：\n1.  一致暴露对（$m_{11}$ 对）：$x_{ic}=1, x_{ik}=1$。贡献为 $\\frac{\\exp(\\beta \\cdot 1)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 1)} = \\frac{1}{2}$。\n2.  一致未暴露对（$m_{00}$ 对）：$x_{ic}=0, x_{ik}=0$。贡献为 $\\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 0)} = \\frac{1}{2}$。\n3.  不一致对（$m_{10}$ 对）：$x_{ic}=1, x_{ik}=0$。贡献为 $\\frac{\\exp(\\beta \\cdot 1)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0)} = \\frac{\\exp(\\beta)}{1+\\exp(\\beta)}$。\n4.  不一致对（$m_{01}$ 对）：$x_{ic}=0, x_{ik}=1$。贡献为 $\\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 1)} = \\frac{1}{1+\\exp(\\beta)}$。\n\n完整的条件似然是这些项的乘积，每一项都取其各自计数的幂：\n$$\nL_C(\\beta) = \\left(\\frac{1}{2}\\right)^{m_{11}} \\left(\\frac{1}{2}\\right)^{m_{00}} \\left(\\frac{\\exp(\\beta)}{1+\\exp(\\beta)}\\right)^{m_{10}} \\left(\\frac{1}{1+\\exp(\\beta)}\\right)^{m_{01}}\n$$\n$$\nL_C(\\beta) = \\left(\\frac{1}{2}\\right)^{m_{11}+m_{00}} \\frac{[\\exp(\\beta)]^{m_{10}}}{[1+\\exp(\\beta)]^{m_{10}}[1+\\exp(\\beta)]^{m_{01}}}\n$$\n$$\nL_C(\\beta) = \\left(\\frac{1}{2}\\right)^{m_{11}+m_{00}} \\frac{\\exp(\\beta m_{10})}{(1+\\exp(\\beta))^{m_{10}+m_{01}}}\n$$\n如上所示，只有不一致对（$m_{10}$ 和 $m_{01}$）为 $\\beta$ 的估计提供信息。\n\n**第3部分：最大似然估计量与解释**\n\n为了找到 $\\beta$ 的最大似然估计量 (MLE)，我们最大化对数似然 $\\ell_C(\\beta) = \\ln(L_C(\\beta))$：\n$$\n\\ell_C(\\beta) = (m_{11}+m_{00})\\ln(1/2) + m_{10}\\beta - (m_{10}+m_{01})\\ln(1+\\exp(\\beta))\n$$\n我们对 $\\beta$ 求导并令其为零：\n$$\n\\frac{d\\ell_C(\\beta)}{d\\beta} = m_{10} - (m_{10}+m_{01}) \\frac{\\exp(\\beta)}{1+\\exp(\\beta)}\n$$\n将导数设为零以找到最大似然估计量 $\\hat{\\beta}$：\n$$\nm_{10} - (m_{10}+m_{01}) \\frac{\\exp(\\hat{\\beta})}{1+\\exp(\\hat{\\beta})} = 0\n$$\n$$\nm_{10} = (m_{10}+m_{01}) \\frac{\\exp(\\hat{\\beta})}{1+\\exp(\\hat{\\beta})}\n$$\n$$\nm_{10}(1+\\exp(\\hat{\\beta})) = (m_{10}+m_{01})\\exp(\\hat{\\beta})\n$$\n$$\nm_{10} + m_{10}\\exp(\\hat{\\beta}) = m_{10}\\exp(\\hat{\\beta}) + m_{01}\\exp(\\hat{\\beta})\n$$\n$$\nm_{10} = m_{01}\\exp(\\hat{\\beta})\n$$\n求解比值比的最大似然估计量 $\\exp(\\hat{\\beta})$，得到：\n$$\n\\exp(\\hat{\\beta}) = \\frac{m_{10}}{m_{01}}\n$$\n解释：比值比 (Odds Ratio, OR) 是衡量暴露与结局之间关联性的一种度量。它表示在特定暴露下发生某种结局的比值，与没有该暴露时发生该结局的比值的比率。从我们的模型中，$\\ln(\\text{Odds}(Y=1)) = \\alpha_i + \\beta x$。在一个分层 $i$ 内，暴露（$X=1$）与非暴露（$X=0$）的比值比是：\n$$\nOR = \\frac{\\text{Odds}(Y=1 \\mid X=1, i)}{\\text{Odds}(Y=1 \\mid X=0, i)} = \\frac{\\exp(\\alpha_i + \\beta \\cdot 1)}{\\exp(\\alpha_i + \\beta \\cdot 0)} = \\frac{\\exp(\\alpha_i)\\exp(\\beta)}{\\exp(\\alpha_i)} = \\exp(\\beta)\n$$\n因此，$\\exp(\\beta)$ 是比值比，在所有匹配对中是恒定的。它的估计量 $\\exp(\\hat{\\beta}) = m_{10}/m_{01}$ 被称为匹配比值比。它是病例暴露的不一致对数量与对照暴露的不一致对数量的比值。\n\n条件化方法控制了诸如年龄、性别或临床中心等匹配因素。这些因素被假设对一个匹配对中两个个体的结局基线风险具有共同的影响。这种共同影响由分层特异性截距 $\\alpha_i$ 捕捉。通过以“每个匹配对恰好包含一个病例和一个对照”这一事实为条件，我们推导出了一个不依赖于 $\\alpha_i$ 的似然函数。因此，$\\beta$ 的最终估计值不会被用于匹配的因素所混淆，因为它们的影响已在估计过程中从数学上被消除了。\n\n**第4部分：数值计算**\n\n给定数据：$m_{10} = 18$ 且 $m_{01} = 12$。点估计不需要一致对的数量。\n比值比 $\\exp(\\beta)$ 的最大似然估计量的数值为：\n$$\n\\exp(\\hat{\\beta}) = \\frac{m_{10}}{m_{01}} = \\frac{18}{12} = \\frac{3}{2} = 1.5\n$$",
            "answer": "$$\n\\boxed{1.5}\n$$"
        },
        {
            "introduction": "在实践中，计算样本比值比的简单公式 $ ad/bc $ 在任何单元格计数为零时都会失效，导致估计值为零、无穷大或无法定义。这个问题在处理罕见事件或小样本数据时尤为常见，其背后是被称为（准）完全分离（(quasi-)complete separation）的现象。本练习旨在让您直面这一统计病理学问题，分析标准最大似然估计为何会失败，并探索更稳健的替代方法，如基于精确条件推断的Fisher精确检验。通过处理含有零单元格的数据，您将学会诊断估计过程中的问题，并理解精确方法在处理稀疏数据时的重要性。",
            "id": "4972025",
            "problem": "一项关于医院系统中罕见不良事件的病例对照研究记录了以下暴露交叉表：病例组中，$12$ 人暴露，$3$ 人未暴露；对照组中，$0$ 人暴露，$25$ 人未暴露。令 $Y \\in \\{0,1\\}$ 表示病例状态（$Y=1$ 为病例，$Y=0$ 为对照），令 $X \\in \\{0,1\\}$ 表示暴露。感兴趣的关联度量是比值比 $\\theta$，定义为病例组中的暴露比值与对照组中的暴露比值之比，其中比值由某一层内暴露概率 $p$ 定义为 $p/(1-p)$。假设在各层内进行独立的伯努利抽样，并考虑两种似然：一种是无条件似然，其中 $p_1=\\mathbb{P}(X=1\\mid Y=1)$ 和 $p_0=\\mathbb{P}(X=1\\mid Y=0)$ 直接从数据中估计；另一种是通过对 $2\\times 2$ 表的固定边际进行条件化得到的条件似然。\n\n仅使用比值和比值比的核心定义，以及在同质层中伯努利概率的最大似然估计等于观测比例这一事实，推断在这个存在零单元格的表中 $\\theta$ 的最大似然估计的行为。然后，考虑基于给定边际的暴露病例计数的条件分布对 $\\theta$ 进行精确条件推断，以及通过在名义水平 $1-\\alpha$（其中 $\\alpha=0.05$）下反转双侧 Fisher 精确检验来构建置信区间。\n\n在此背景下，哪个选项最准确地描述了为什么 $\\theta$ 的最大似然估计是无界的，通过 Fisher 反转法获得的精确条件置信集的形状是什么，以及小样本校正是否能产生有限的端点？\n\nA. 在此表中，$\\theta$ 的无条件最大似然估计是无穷大，因为对照组中估计的暴露概率为 $0$，使得对照组的比值为 $0$，从而导致比值比趋向 $+\\infty$。在固定边际下，当 $\\theta\\to\\infty$ 时，条件似然将所有概率质量置于上界 $a=n_1$ 处，因此条件最大似然估计也发散。通过反转 Fisher 精确检验得到的精确双侧 $95\\%$ 置信集的形式为 $[L,\\infty)$ 且 $L1$，这反映了观测到的暴露病例计数位于其支撑集的上边界；向每个单元格添加 Haldane–Anscombe $+1/2$ 伪计数可以产生一个有限但有偏的区间。\n\nB. Fisher 的精确条件 $95\\%$ 置信区间即使在出现零单元格时也总是有限的，因为超几何似然在 $\\theta$ 上对称衰减，所以两个界限都不可能是无限的。\n\nC. Firth 的惩罚似然（Jeffreys 先验惩罚）总是与通过 Fisher 精确条件反转法获得的区间相匹配，因此惩罚化不会改变端点，也无法解决由零单元格引起的发散问题。\n\nD. 在固定边际下，任何零单元格表中 $\\theta$ 的条件最大似然估计都是 $\\theta=1$，因此在条件分析中不存在发散；任何无穷大的估计都仅源于不恰当的无条件模型。\n\nE. 在基于泊松计数的率比的队列分析中，任何一组中出现零事件都会产生未定义的点估计，但无论是否存在零单元格，精确泊松方法总能为率比产生有限的 $95\\%$ 置信区间。",
            "solution": "### 解题推导\n\n首先，我们将提供的数据构造成一个标准的 $2 \\times 2$ 表格式，单元格用 $a, b, c, d$ 表示。\n-   $a$：暴露病例 = $12$\n-   $b$：暴露对照 = $0$\n-   $c$：未暴露病例 = $3$\n-   $d$：未暴露对照 = $25$\n\n该表为：\n$$\n\\begin{array}{c|cc|c}\n  \\text{病例 ($Y=1$)}  \\text{对照 ($Y=0$)}  \\text{总计} \\\\\n\\hline\n\\text{暴露 ($X=1$)}  a=12  b=0  m_1=12 \\\\\n\\text{未暴露 ($X=0$)}  c=3  d=25  m_0=28 \\\\\n\\hline\n\\text{总计}  n_1=15  n_0=25  N=40\n\\end{array}\n$$\n\n**1. $\\theta$ 的无条件最大似然估计**\n\n问题要求估计 $\\theta = \\frac{p_1/(1-p_1)}{p_0/(1-p_0)}$。\n根据伯努利概率的 MLE 是样本比例的原理：\n-   $p_1 = \\mathbb{P}(X=1 \\mid Y=1)$ 的 MLE 是 $\\hat{p}_1 = \\frac{a}{a+c} = \\frac{12}{12+3} = \\frac{12}{15} = 0.8$。\n-   $p_0 = \\mathbb{P}(X=1 \\mid Y=0)$ 的 MLE 是 $\\hat{p}_0 = \\frac{b}{b+d} = \\frac{0}{0+25} = 0$。\n\n现在，我们计算每组比值的 MLE：\n-   病例中暴露比值的 MLE：$\\frac{\\hat{p}_1}{1-\\hat{p}_1} = \\frac{0.8}{1-0.8} = \\frac{0.8}{0.2} = 4$。这也等于 $\\frac{a}{c} = \\frac{12}{3} = 4$。\n-   对照中暴露比值的 MLE：$\\frac{\\hat{p}_0}{1-\\hat{p}_0} = \\frac{0}{1-0} = 0$。这也等于 $\\frac{b}{d} = \\frac{0}{25} = 0$。\n\n比值比的无条件 MLE，$\\hat{\\theta}_{MLE}$，是这些估计的比值之比：\n$$ \\hat{\\theta}_{MLE} = \\frac{a/c}{b/d} = \\frac{ad}{bc} = \\frac{12 \\times 25}{0 \\times 3} = \\frac{300}{0} $$\n这个表达式涉及除以零，因此是未定义的。当分母从正方向趋近于零时，极限为 $+\\infty$。因此，$\\theta$ 的无条件 MLE 是无界的（无穷大）。发生这种情况是因为对照组中估计的暴露概率为 $0$，导致该组的估计比值为 $0$。\n\n**2. $\\theta$ 的条件最大似然估计**\n\n在条件分析中，我们以表的边际总数为条件：$n_1=15$，$n_0=25$，$m_1=12$，$m_0=28$。计数 $a$（暴露病例）的分布遵循非中心超几何分布，其概率质量函数仅依赖于 $\\theta$：\n$$ P(A=k \\mid n_1, m_1, N; \\theta) = \\frac{\\binom{n_1}{k}\\binom{N-n_1}{m_1-k}\\theta^k}{\\sum_{j} \\binom{n_1}{j}\\binom{N-n_1}{m_1-j}\\theta^j} $$\n$A$ 的可能值范围是 $k \\in [\\max(0, n_1+m_1-N), \\min(n_1, m_1)]$。\n对于我们的数据，支撑集是 $k \\in [\\max(0, 15+12-40), \\min(15, 12)] = [\\max(0, -13), 12] = [0, 12]$。\n观测值为 $a=12$，这是支撑集中的最大可能值。\n\n条件对数似然函数是 $l(\\theta; a) = a \\log(\\theta) + \\text{const} - \\log\\left(\\sum_{j} \\binom{n_1}{j}\\binom{N-n_1}{m_1-j}\\theta^j\\right)$。它关于 $\\log(\\theta)$ 的导数是 $a - E[A; \\theta]$。条件 MLE 通过求解 $E[A; \\theta] = a_{obs}$ 找到。\n期望值 $E[A; \\theta]$ 是 $\\theta$ 的一个严格递增函数，其值受限于 $A$ 的支撑集，即 $0 \\le E[A; \\theta] \\le 12$。由于我们的观测值 $a_{obs}=12$ 是支撑集的上边界，方程 $E[A; \\theta] = 12$ 只能在 $\\theta \\to \\infty$ 的极限情况下成立。这种情况被称为单调似然或分离，它意味着 $\\theta$ 的条件 MLE 也发散到 $+\\infty$。\n\n**3. 通过 Fisher 反转法得到的精确条件置信集**\n\n$\\theta$ 的一个 $100(1-\\alpha)\\%$ 置信集是所有 $\\theta_0$ 值的集合，对于这些值，在水平 $\\alpha$ 下，对 $H_0: \\theta = \\theta_0$ 的双侧检验不会被拒绝。对于 $\\alpha=0.05$，我们对每个尾部使用 $\\alpha/2 = 0.025$。\n区间是 $[L, U]$，其中：\n-   $L$ 是使上尾概率等于 $\\alpha/2$ 的 $\\theta$ 值。\n    $ P(A \\ge a_{obs} \\mid \\theta=L) = \\alpha/2 $。\n    在我们的例子中，$a_{obs}=12$。由于 $12$ 是最大值，这可以简化为 $P(A=12 \\mid \\theta=L) = 0.025$。\n    概率 $P(A=12 \\mid \\theta)$ 是 $\\theta$ 的一个严格递增函数。在 $\\theta=0$ 时，此概率为 $0$。当 $\\theta \\to \\infty$ 时，它趋近于 $1$。因此，必须存在一个唯一的、有限的、正的 $L$ 值来解这个方程。对于 $\\theta=1$，$P(A=12) = \\frac{\\binom{15}{12}\\binom{25}{0}}{\\binom{40}{12}}$，这个值极小（约 $8 \\times 10^{-8}$）。为了使这个概率达到 $0.025$，我们必须有 $L  1$。\n\n-   $U$ 是使下尾概率等于 $\\alpha/2$ 的 $\\theta$ 值。\n    $ P(A \\le a_{obs} \\mid \\theta=U) = \\alpha/2 $。\n    在我们的例子中，$a_{obs}=12$。由于 $A$ 的支撑集是 $[0, 12]$，事件 $A \\le 12$ 包含了整个样本空间。\n    因此，对于任何 $\\theta$ 值，$P(A \\le 12 \\mid \\theta) = 1$。\n    求解 $U$ 的方程变为 $1 = 0.025$，这是不可能的。这意味着没有任何 $\\theta$ 值（无论多大）可以根据此标准从置信集中排除。上界是无穷大。\n\n最终得到的 $95\\%$ 置信集是一个单侧区间，形式为 $[L, \\infty)$，其中 $L1$。\n\n**4. 小样本校正**\n\nHaldane-Anscombe 校正向每个单元格添加 $0.5$ 的伪计数，以缓解零计数带来的问题。\n校正后的表是：$a'=12.5$, $b'=0.5$, $c'=3.5$, $d'=25.5$。\n校正后的比值比估计是：\n$$ \\hat{\\theta}_{adj} = \\frac{a'd'}{b'c'} = \\frac{12.5 \\times 25.5}{0.5 \\times 3.5} = \\frac{318.75}{1.75} \\approx 182.14 $$\n这个估计是有限的。基于此校正表的置信区间（例如，Woolf's logit interval）也将具有有限的端点。这种校正引入了已知的偏差，以换取获得有限的估计值和区间。\n\n### 逐项分析选项\n\n**A. 在此表中，$\\theta$ 的无条件最大似然估计是无穷大，因为对照组中估计的暴露概率为 $0$，使得对照组的比值为 $0$，从而导致比值比趋向 $+\\infty$。在固定边际下，当 $\\theta\\to\\infty$ 时，条件似然将所有概率质量置于上界 $a=n_1$ 处，因此条件最大似然估计也发散。通过反转 Fisher 精确检验得到的精确双侧 $95\\%$ 置信集的形式为 $[L,\\infty)$ 且 $L1$，这反映了观测到的暴露病例计数位于其支撑集的上边界；向每个单元格添加 Haldane–Anscombe $+1/2$ 伪计数可以产生一个有限但有偏的区间。**\n\n-   关于无条件 MLE 为无穷大的推理是正确的，如上所述。\n-   关于条件 MLE 发散的推理也是正确的。观测到的计数处于其最大可能值（$a=12$，这里恰好是 $m_1$，但更一般地是 $\\min(n_1, m_1)$）。当 $\\theta \\to \\infty$ 时，条件似然将所有概率质量置于此边界的陈述，是解释 MLE 为何发散的正确直觉。\n-   将精确置信集描述为 $[L, \\infty)$ 且 $L1$ 是正确的，其给出的原因（观测值在支撑集边界上）是准确的。\n-   Haldane-Anscombe（$+1/2$）伪计数校正会产生一个有限但有偏的区间的陈述也是正确的。\n-   **结论：正确。**\n\n**B. Fisher 的精确条件 $95\\%$ 置信区间即使在出现零单元格时也总是有限的，因为超几何似然在 $\\theta$ 上对称衰减，所以两个界限都不可能是无限的。**\n\n-   这个陈述是错误的。如上所推导，当一个观测值位于其支撑集的边界上时（如果存在像 $b=0$ 这样的零单元格，而 $a, c, d  0$，这种情况必然发生），精确区间是单侧的，因此不是有限的。\n-   其理由也是错误的。似然是基于非中心超几何分布，该分布关于 $\\theta$ 是不对称的。\n-   **结论：不正确。**\n\n**C. Firth 的惩罚似然（Jeffreys 先验惩罚）总是与通过 Fisher 精确条件反转法获得的区间相匹配，因此惩罚化不会改变端点，也无法解决由零单元格引起的发散问题。**\n\n-   这是错误的。Firth 型惩罚是一种专门设计用于解决分离/单调似然问题并产生有限点估计和置信区间的方法。其产生的区间通常与精确条件区间不同，并且在这种情况下，在性质上是不同的（即有限对无限）。\n-   **结论：不正确。**\n\n**D. 在固定边际下，任何零单元格表中 $\\theta$ 的条件最大似然估计都是 $\\theta=1$，因此在条件分析中不存在发散；任何无穷大的估计都仅源于不恰当的无条件模型。**\n\n-   这是错误的。如推导所示，在这种情况下，条件 MLE 也发散到 $+\\infty$。只有当观测计数 $a$ 等于其在零假设 $\\theta=1$ 下的期望值时，MLE 才会是 $\\theta=1$，而该期望值为 $E[A \\mid \\theta=1] = n_1 m_1 / N = (15 \\times 12) / 40 = 4.5$。观测计数是 $12$，而不是 $4.5$。\n-   **结论：不正确。**\n\n**E. 在基于泊松计数的率比的队列分析中，任何一组中出现零事件都会产生未定义的点估计，但无论是否存在零单元格，精确泊松方法总能为率比产生有限的 $95\\%$ 置信区间。**\n\n-   该选项讨论了一个不同但类似的统计问题。其断言是有缺陷的。虽然如果参照组有零个事件，率比的 MLE 是未定义的，但率比的精确置信区间并*不*总是有限的。如果参照组有零个事件而指数组有一个或多个事件，率比的精确条件（基于二项分布）置信区间将是单侧的，形式为 $[L, \\infty)$，与比值比的情况完全类似。\n-   **结论：不正确。**",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}