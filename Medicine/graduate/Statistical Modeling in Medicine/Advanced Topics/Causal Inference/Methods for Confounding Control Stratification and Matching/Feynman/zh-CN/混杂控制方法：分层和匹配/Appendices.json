{
    "hands_on_practices": [
        {
            "introduction": "当我们在评估治疗效果时，如果忽略了一个同时影响治疗选择和疾病结局的“混杂因素”，我们可能会得出完全错误的结论。本练习将通过一个具体的数值例子来揭示这种混杂的潜在影响，你将计算一个忽略了关键混杂因素（疾病严重程度）的边际风险差，并亲眼见证辛普森悖论 (Simpson’s paradox) 是如何导致与分层分析结果截然相反的结论的 。这个计算过程直观地展示了为什么在观察性研究中控制混杂至关重要。",
            "id": "4973496",
            "problem": "考虑一项针对社区获得性肺炎住院成年人的观察性队列研究，该研究评估了早期广谱抗生素治疗（$T=1$）与延迟或窄谱治疗（$T=0$）对30天内临床康复这一二元结局（$Y=1$表示康复，$Y=0$表示未康复）的影响。入院时的疾病严重程度根据一个经过验证的严重程度指数分为两个分层：$\\mathcal{S}_{0}$层（病情较轻）和$\\mathcal{S}_{1}$层（病情严重）。严重程度是治疗-结局关系的一个潜在混杂因素，因为它既影响治疗选择，也影响预后。\n\n您获得以下计数：\n\n- 在分层 $\\mathcal{S}_{0}$ 中：治疗组（$T=1$）的50人中有42人康复；未治疗组（$T=0$）的400人中有320人康复。\n- 在分层 $\\mathcal{S}_{1}$ 中：治疗组（$T=1$）的600人中有150人康复；未治疗组（$T=0$）的80人中有18人康复。\n\n请仅使用基本概率定义，且不引入未经检验的建模假设，计算总体边际风险差，定义为\n$$ RD_{\\text{marginal}} \\equiv \\Pr(Y=1 \\mid T=1) - \\Pr(Y=1 \\mid T=0), $$\n其中忽略了严重程度分层（即，将 $\\mathcal{S}_{0}$ 和 $\\mathcal{S}_{1}$ 合并）。请将您的答案表示为小数，并将最终结果四舍五入至四位有效数字。",
            "solution": "该问题陈述已经过严格验证，并被认为是有效的。它具有科学依据、定义明确且客观。它提出了一个基于所提供计数数据的标准流行病学任务，能够得出一个唯一且有意义的解。所有必要信息均已提供，不存在矛盾或含糊之处。\n\n目标是计算总体边际风险差 $RD_{\\text{marginal}}$，该值量化了在忽略混杂变量（疾病严重程度）时，治疗组和未治疗组之间康复概率的差异。其定义如下：\n$$\nRD_{\\text{marginal}} \\equiv \\Pr(Y=1 \\mid T=1) - \\Pr(Y=1 \\mid T=0)\n$$\n在这里，$Y=1$ 表示康复，$T=1$ 表示接受早期广谱抗生素治疗，$T=0$ 表示替代治疗方案。这些概率是根据提供的样本计数估计的。\n\n该问题要求我们将数据跨两个严重程度分层（$\\mathcal{S}_{0}$（较轻）和 $\\mathcal{S}_{1}$（严重））进行合并。我们首先汇总治疗人群（$T=1$）和未治疗人群（$T=0$）在两个分层中的计数。\n\n设 $N_{T=t, S=s}$ 为个体数量，$C_{T=t, S=s}$ 为康复个体计数，其中治疗状态 $t \\in \\{0, 1\\}$，分层 $s \\in \\{0, 1\\}$。\n\n给定数据如下：\n对于分层 $\\mathcal{S}_{0}$：\n- 治疗组（$T=1$）：$C_{T=1, S=0} = 42$， $N_{T=1, S=0} = 50$。\n- 未治疗组（$T=0$）：$C_{T=0, S=0} = 320$， $N_{T=0, S=0} = 400$。\n\n对于分层 $\\mathcal{S}_{1}$：\n- 治疗组（$T=1$）：$C_{T=1, S=1} = 150$， $N_{T=1, S=1} = 600$。\n- 未治疗组（$T=0$）：$C_{T=0, S=1} = 18$， $N_{T=0, S=1} = 80$。\n\n为了计算边际概率，我们首先找出整个研究人群在合并分层后的总计数。\n\n治疗组（$T=1$）中康复的总人数：\n$$\nC_{T=1} = C_{T=1, S=0} + C_{T=1, S=1} = 42 + 150 = 192\n$$\n治疗组（$T=1$）的总人数：\n$$\nN_{T=1} = N_{T=1, S=0} + N_{T=1, S=1} = 50 + 600 = 650\n$$\n\n未治疗组（$T=0$）中康复的总人数：\n$$\nC_{T=0} = C_{T=0, S=0} + C_{T=0, S=1} = 320 + 18 = 338\n$$\n未治疗组（$T=0$）的总人数：\n$$\nN_{T=0} = N_{T=0, S=0} + N_{T=0, S=1} = 400 + 80 = 480\n$$\n\n现在，我们使用这些汇总的计数来估计每个治疗组康复的边际概率（风险）。\n\n给定治疗（$T=1$）的康复概率估计为：\n$$\n\\Pr(Y=1 \\mid T=1) \\approx \\frac{C_{T=1}}{N_{T=1}} = \\frac{192}{650}\n$$\n\n给定未治疗（$T=0$）的康复概率估计为：\n$$\n\\Pr(Y=1 \\mid T=0) \\approx \\frac{C_{T=0}}{N_{T=0}} = \\frac{338}{480}\n$$\n\n最后，我们通过从治疗组的风险中减去未治疗组的风险来计算边际风险差：\n$$\nRD_{\\text{marginal}} \\approx \\frac{192}{650} - \\frac{338}{480}\n$$\n我们将这些分数转换为小数形式进行计算：\n$$\n\\frac{192}{650} \\approx 0.2953846...\n$$\n$$\n\\frac{338}{480} = \\frac{169}{240} \\approx 0.7041666...\n$$\n因此，风险差为：\n$$\nRD_{\\text{marginal}} \\approx 0.2953846 - 0.7041666 = -0.408782...\n$$\n题目要求答案四舍五入至四位有效数字。前四位有效数字是 $4$、$0$、$8$ 和 $7$。第五位有效数字是 $8$，大于等于 $5$，所以我们将第四位有效数字向上取整。\n$$\nRD_{\\text{marginal}} \\approx -0.4088\n$$\n这个负值表明，在这个粗略的、未经调整的分析中，与替代治疗方案相比，早期广谱抗生素治疗与显著更低的康复概率相关。这个与直觉相反的结果是一个典型的“因适应症而混杂”（confounding by indication）的例子（辛普森悖论的一种形式），在这种情况下，病情最重的患者被优先给予所研究的治疗，使得该治疗看起来有害，而实际上它可能是有益的或中性的。",
            "answer": "$$\n\\boxed{-0.4088}\n$$"
        },
        {
            "introduction": "在了解了分层的重要性之后，我们转向另一种强大的混杂控制技术：匹配。最理想的匹配方式似乎是为每个处理组的受试者找到一个在所有关键混杂因素上取值完全相同的对照组受试者，即“精确匹配”。本练习从第一性原理出发，探讨了在连续混杂因素上实现精确匹配的理论可行性，这个看似简单的问题将揭示一个基本限制，并为发展更实用的匹配方法（如卡尺匹配）提供理论依据 。",
            "id": "4973476",
            "problem": "考虑一项观察性队列研究，其中有 $n_1$ 名处理对象和 $n_0$ 名对照对象。每个对象都有一个用于匹配的实值基线混杂因素 $L$。假设数据生成机制如下：对于处理对象，混杂因素值 $\\{L^{(1)}_i\\}_{i=1}^{n_1}$ 是从分布 $F_1$ 中独立抽取的样本，该分布相对于 $\\mathbb{R}$ 上的勒贝格测度是绝对连续的，其密度为 $f_1$。对于对照对象，混杂因素值 $\\{L^{(0)}_j\\}_{j=1}^{n_0}$ 是从分布 $F_0$ 中独立抽取的样本，该分布也相对于 $\\mathbb{R}$ 上的勒贝格测度是绝对连续的，其密度为 $f_0$。所有抽取在对象之间和组别之间都是相互独立的。“精确匹配”定义为满足 $L^{(1)}_i = L^{(0)}_j$ 的配对 $(i,j)$。令 $M$ 表示在处理组和对照组之间可以形成的不相交精确匹配对的最大数量，其中每个对象最多只能用于一个配对。\n\n从绝对连续性和期望的核心定义出发，并且不使用任何快捷公式，根据所述假设推导精确匹配的期望数量 $\\mathbb{E}[M]$ 的值。你的最终答案必须是一个实数值。不需要四舍五入。",
            "solution": "首先对问题进行验证，以确保其科学合理、定义明确且客观。\n\n### 步骤1：提取已知条件\n-   处理对象数量：$n_1$。\n-   对照对象数量：$n_0$。\n-   处理对象的混杂因素：$\\{L^{(1)}_i\\}_{i=1}^{n_1}$ 是从具有密度 $f_1$ 的分布 $F_1$ 中独立抽取的样本。\n-   对照对象的混杂因素：$\\{L^{(0)}_j\\}_{j=1}^{n_0}$ 是从具有密度 $f_0$ 的分布 $F_0$ 中独立抽取的样本。\n-   分布 $F_1$ 和 $F_0$ 相对于 $\\mathbb{R}$ 上的勒贝格测度是绝对连续的。\n-   所有抽取都是相互独立的。\n-   精确匹配是满足 $L^{(1)}_i = L^{(0)}_j$ 的配对 $(i,j)$。\n-   $M$ 是不相交精确匹配对的最大数量。\n-   目标是推导 $\\mathbb{E}[M]$。\n\n### 步骤2：使用提取的已知条件进行验证\n-   **科学依据**：该问题基于概率论的基本原理，特别是关于连续随机变量、其分布、密度和期望。观察性研究中的匹配是统计学中的一个标准课题。\n-   **定义明确**：问题陈述清晰。数量 $n_1$、$n_0$ 作为参数给出。随机变量的属性（独立性、绝对连续性）已明确。待推导的量 $\\mathbb{E}[M]$ 在概率论中有明确定义。可以推导出唯一、稳定且有意义的解。\n-   **客观性**：问题使用精确的数学语言陈述，没有歧义或主观论断。\n\n### 步骤3：结论与行动\n该问题是有效的。这是一个在概率论和统计学中定义明确的理论问题。我现在将进行解的正式推导。\n\n问题要求计算 $M$ 的期望值，即在 $n_1$ 名处理对象和 $n_0$ 名对照对象组之间可以形成的不相交精确匹配对的最大数量。当处理对象 $i$ 和对照对象 $j$ 的基线混杂因素值相等时，即 $L^{(1)}_i = L^{(0)}_j$，就会发生精确匹配。\n\n让我们为每个可能的处理对象 $i \\in \\{1, 2, \\dots, n_1\\}$ 和对照对象 $j \\in \\{1, 2, \\dots, n_0\\}$ 的配对定义一个指示变量 $I_{ij}$。如果发生精确匹配，该变量取值为1，否则为0：\n$$\nI_{ij} = \\begin{cases} 1  \\text{if } L^{(1)}_i = L^{(0)}_j \\\\ 0  \\text{if } L^{(1)}_i \\neq L^{(0)}_j \\end{cases}\n$$\n计算重复次数（即不一定是不相交的）的精确匹配总数可以表示为 $N$，其中 $N = \\sum_{i=1}^{n_1} \\sum_{j=1}^{n_0} I_{ij}$。我们感兴趣的量 $M$ 是不相交配对的最大数量。根据定义，不相交配对的数量不能超过总配对数。因此，我们有不等式 $0 \\le M \\le N$。\n\n根据期望的单调性，如果随机变量 $X$ 和 $Y$ 满足 $X \\le Y$，则 $\\mathbb{E}[X] \\le \\mathbb{E}[Y]$。将此应用于我们的不等式，我们得到：\n$$ 0 \\le \\mathbb{E}[M] \\le \\mathbb{E}[N] $$\n现在我们来计算 $\\mathbb{E}[N]$。根据期望的线性性质，随机变量之和的期望等于它们期望之和：\n$$ \\mathbb{E}[N] = \\mathbb{E}\\left[ \\sum_{i=1}^{n_1} \\sum_{j=1}^{n_0} I_{ij} \\right] = \\sum_{i=1}^{n_1} \\sum_{j=1}^{n_0} \\mathbb{E}[I_{ij}] $$\n指示变量的期望是它所指示事件的概率。因此，对于任意配对 $(i,j)$：\n$$ \\mathbb{E}[I_{ij}] = P(L^{(1)}_i = L^{(0)}_j) $$\n问题的核心归结为计算这个概率。问题陈述 $L^{(1)}_i$ 和 $L^{(0)}_j$ 是从相对于 $\\mathbb{R}$ 上的勒贝格测度绝对连续的分布中抽取的独立随机变量。这意味着它们是连续随机变量，分别拥有概率密度函数 $f_1$ 和 $f_0$。\n\n令 $X = L^{(1)}_i$ 和 $Y = L^{(0)}_j$。由于它们的独立性，随机向量 $(X, Y)$ 的联合概率密度函数是它们各自密度的乘积：\n$$ f_{X,Y}(x, y) = f_1(x) f_0(y) $$\n随机向量 $(X,Y)$ 落入某个区域 $A \\subseteq \\mathbb{R}^2$ 的概率由联合密度函数在该区域上的积分给出：\n$$ P((X,Y) \\in A) = \\iint_A f_{X,Y}(x,y) \\,dx\\,dy $$\n事件 $X = Y$ 对应于区域 $A = \\{(x,y) \\in \\mathbb{R}^2 \\mid y=x\\}$，这是 $xy$ 平面中的一条直线。为了求该事件的概率，我们必须沿这条线对联合密度进行积分。然而，$\\mathbb{R}^2$ 中的一条直线的二维勒贝格测度为零。由于联合概率测度相对于勒贝格测度是绝对连续的，任何对应于勒贝格测度为零的集合的事件，其概率必须为零。\n\n更正式地，令 $Z = X - Y$。事件 $X = Y$ 与事件 $Z = 0$ 相同。由于 $X$ 和 $Y$ 是连续随机变量，它们的差 $Z$ 也是一个连续随机变量。对于任何具有概率密度函数 $f_Z(z)$ 的连续随机变量 $Z$，其取任何特定值 $c$ 的概率由下式给出：\n$$ P(Z=c) = \\int_c^c f_Z(z) \\,dz = 0 $$\n因此，$P(X-Y=0) = 0$，这意味着 $P(X=Y) = 0$。\n\n这个基本结果意味着任何单个处理对象和任何单个对照对象之间精确匹配的概率为零：\n$$ P(L^{(1)}_i = L^{(0)}_j) = 0 \\quad \\text{for all } i,j $$\n将此结果代回指示变量的期望表达式中：\n$$ \\mathbb{E}[I_{ij}] = 0 $$\n现在，我们可以计算匹配的总期望数 $\\mathbb{E}[N]$：\n$$ \\mathbb{E}[N] = \\sum_{i=1}^{n_1} \\sum_{j=1}^{n_0} \\mathbb{E}[I_{ij}] = \\sum_{i=1}^{n_1} \\sum_{j=1}^{n_0} 0 = 0 $$\n最后，我们回到涉及所需量 $\\mathbb{E}[M]$ 的不等式：\n$$ 0 \\le \\mathbb{E}[M] \\le \\mathbb{E}[N] $$\n代入 $\\mathbb{E}[N]=0$，我们得到：\n$$ 0 \\le \\mathbb{E}[M] \\le 0 $$\n这个不等式迫使我们得出结论，$\\mathbb{E}[M]$ 必须恰好为零。\n\n这个结果是混杂因素 $L$ 是一个连续变量这一假设的直接推论。在实践中，测量是以有限精度进行的，并且匹配是在一个容差（卡尺匹配）内执行的，这将产生非零的匹配概率。然而，在问题陈述的理想化理论条件下，精确匹配的概率为零，导致期望匹配数为零。",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "鉴于对连续变量进行精确匹配的理论不可能性，研究人员通常采用卡尺匹配（caliper matching）作为一种实用的替代方案，即在某个可接受的容差范围内（卡尺宽度 $\\delta$）进行匹配。然而，选择合适的卡尺宽度需要在减少偏倚和保留足够样本量之间进行权衡。本练习要求你推导在使用卡尺匹配时，成功匹配对数的期望值表达式，这是一个在研究设计阶段至关重要的技能，可以帮助研究者预测匹配过程对最终分析样本量的影响 。",
            "id": "4973494",
            "problem": "一项临床研究使用基于标量预后评分 $L$ 的风险集匹配来评估一种治疗对术后结果的影响，该评分总结了基线风险。在治疗组中，随机抽取的治疗组受试者的预后评分被建模为 $L_{t} \\sim \\mathcal{N}(\\mu_{t}, \\sigma_{t}^{2})$；在对照组中，其预后评分被建模为 $L_{c} \\sim \\mathcal{N}(\\mu_{c}, \\sigma_{c}^{2})$，并且 $L_{t}$ 和 $L_{c}$ 是独立的。共有 $n_{t}$ 名治疗组受试者和 $n_{c}$ 名对照组受试者，其中 $n_{c}$ 足够大，以至于有放回地抽样对照组是合适的。\n\n一个有放回的 $1{:}1$ 匹配程序按如下方式实施：对于 $n_{t}$ 名治疗组受试者中的每一位，从对照组池中有放回地独立随机抽取一名对照组受试者，当且仅当对于一个固定的卡尺宽度 $\\delta > 0$ ，卡尺规则 $|L_{t} - L_{c}| \\leq \\delta$ 成立时，该配对才被保留。如果该规则不成立，则该治疗组受试者保持未匹配状态，并从分析中剔除。对每个治疗组受试者独立重复此过程。\n\n从概率论的第一性原理（期望的线性性、独立性以及独立正态随机变量之差的分布）出发，推导保留的匹配对的期望数量的解析表达式，该表达式是 $n_{t}$、$\\mu_{t}$、$\\mu_{c}$、$\\sigma_{t}^{2}$、$\\sigma_{c}^{2}$ 和 $\\delta$ 的函数。请使用标准正态分布的累积分布函数（记为 $\\Phi(\\cdot)$）来表示您的最终答案，并提供一个单一的闭式解析表达式。不需要进行数值近似，也不需要四舍五入。",
            "solution": "题目要求我们计算在卡尺匹配规则下保留的匹配对的期望数量。该规则是：对于每个治疗组受试者，有放回地独立抽取一个对照组受试者，当且仅当 $|L_{t} - L_{c}| \\leq \\delta$ 时，该配对被保留。治疗组的预后评分建模为 $L_{t} \\sim \\mathcal{N}(\\mu_{t}, \\sigma_{t}^{2})$，对照组的预后评分建模为 $L_{c} \\sim \\mathcal{N}(\\mu_{c}, \\sigma_{c}^{2})$，且 $L_{t}$ 和 $L_{c}$ 相互独立。\n\n我们将使用的基本原理是：\n- 期望的线性性：对于指示随机变量 $I_{i}$，有 $\\mathbb{E}\\left[\\sum_{i=1}^{n_{t}} I_{i}\\right] = \\sum_{i=1}^{n_{t}} \\mathbb{E}[I_{i}]$。\n- $L_{t}$ 和 $L_{c}$ 的独立性，以及两个独立正态随机变量之差服从正态分布的性质，其均值等于均值之差，方差等于方差之和。\n- 标准正态分布的累积分布函数（CDF）的定义，$\\Phi(x) = \\mathbb{P}(Z \\leq x)$，其中 $Z \\sim \\mathcal{N}(0,1)$。\n\n定义指示变量 $I_{i}$，其中 $i = 1, \\dots, n_{t}$。如果第 $i$ 个治疗组受试者被保留（即为该治疗组受试者随机抽取的对照组满足 $|L_{t}^{(i)} - L_{c}^{(i)}| \\leq \\delta$），则 $I_{i} = 1$，否则 $I_{i} = 0$。保留的匹配对的总数是\n$$\nM \\equiv \\sum_{i=1}^{n_{t}} I_{i}.\n$$\n根据期望的线性性，有\n$$\n\\mathbb{E}[M] = \\sum_{i=1}^{n_{t}} \\mathbb{E}[I_{i}] = n_{t} \\, \\mathbb{E}[I_{1}],\n$$\n因为对于从同分布 $L_{t}^{(i)} \\sim \\mathcal{N}(\\mu_{t}, \\sigma_{t}^{2})$ 和 $L_{c}^{(i)} \\sim \\mathcal{N}(\\mu_{c}, \\sigma_{c}^{2})$ 中抽取的样本应用了相同的匹配程序，所以每个 $I_{i}$ 都有相同的分布，并且在不同的 $i$ 之间以及 $L_{t}^{(i)}$ 和 $L_{c}^{(i)}$ 之间都是独立的。\n\n接下来，注意到\n$$\n\\mathbb{E}[I_{1}] = \\mathbb{P}\\left(|L_{t} - L_{c}| \\leq \\delta\\right).\n$$\n定义差值随机变量\n$$\nD \\equiv L_{t} - L_{c}.\n$$\n因为 $L_{t} \\sim \\mathcal{N}(\\mu_{t}, \\sigma_{t}^{2})$ 和 $L_{c} \\sim \\mathcal{N}(\\mu_{c}, \\sigma_{c}^{2})$ 是独立的，所以差值 $D$ 服从正态分布，其参数为\n$$\n\\mu_{\\Delta} \\equiv \\mathbb{E}[D] = \\mu_{t} - \\mu_{c}, \\quad \\sigma_{\\Delta}^{2} \\equiv \\operatorname{Var}(D) = \\sigma_{t}^{2} + \\sigma_{c}^{2},\n$$\n即\n$$\nD \\sim \\mathcal{N}(\\mu_{\\Delta}, \\sigma_{\\Delta}^{2}).\n$$\n因此，\n$$\n\\mathbb{P}\\left(|L_{t} - L_{c}| \\leq \\delta\\right) = \\mathbb{P}\\left(|D| \\leq \\delta\\right) = \\mathbb{P}\\left(-\\delta \\leq D \\leq \\delta\\right).\n$$\n使用 $Z = (D - \\mu_{\\Delta})/\\sigma_{\\Delta}$ 对 $D$ 进行标准化，其中 $Z \\sim \\mathcal{N}(0,1)$，我们得到\n$$\n\\mathbb{P}\\left(-\\delta \\leq D \\leq \\delta\\right) = \\mathbb{P}\\left(\\frac{-\\delta - \\mu_{\\Delta}}{\\sigma_{\\Delta}} \\leq Z \\leq \\frac{\\delta - \\mu_{\\Delta}}{\\sigma_{\\Delta}}\\right) = \\Phi\\!\\left(\\frac{\\delta - \\mu_{\\Delta}}{\\sigma_{\\Delta}}\\right) - \\Phi\\!\\left(\\frac{-\\delta - \\mu_{\\Delta}}{\\sigma_{\\Delta}}\\right),\n$$\n其中 $\\Phi(\\cdot)$ 表示标准正态分布的累积分布函数。\n\n综合这些结果，保留的匹配对的期望数量是\n$$\n\\mathbb{E}[M] = n_{t} \\left[ \\Phi\\!\\left(\\frac{\\delta - (\\mu_{t} - \\mu_{c})}{\\sqrt{\\sigma_{t}^{2} + \\sigma_{c}^{2}}}\\right) - \\Phi\\!\\left(\\frac{-\\delta - (\\mu_{t} - \\mu_{c})}{\\sqrt{\\sigma_{t}^{2} + \\sigma_{c}^{2}}}\\right) \\right].\n$$\n该表达式是关于 $n_{t}$、$\\mu_{t}$、$\\mu_{c}$、$\\sigma_{t}^{2}$、$\\sigma_{c}^{2}$、$\\delta$ 以及标准正态累积分布函数 $\\Phi(\\cdot)$ 的完全解析式，它直接由期望的线性性和独立正态随机变量之差的分布推导得出。",
            "answer": "$$\\boxed{n_{t}\\left[\\Phi\\!\\left(\\frac{\\delta-(\\mu_{t}-\\mu_{c})}{\\sqrt{\\sigma_{t}^{2}+\\sigma_{c}^{2}}}\\right)-\\Phi\\!\\left(\\frac{-\\delta-(\\mu_{t}-\\mu_{c})}{\\sqrt{\\sigma_{t}^{2}+\\sigma_{c}^{2}}}\\right)\\right]}$$"
        }
    ]
}