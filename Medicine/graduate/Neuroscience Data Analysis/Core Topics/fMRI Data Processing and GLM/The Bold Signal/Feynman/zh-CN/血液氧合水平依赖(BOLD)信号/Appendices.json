{
    "hands_on_practices": [
        {
            "introduction": "要深刻理解血氧水平依赖（BOLD）信号，我们必须从其生物物理根源入手。BOLD信号的特性，例如其初始上升、峰值和随后的下冲，都由神经活动触发的局部血液动力学变化所决定。本练习将引导你通过经验性的Grubb关系式，探索脑血流量（CBF）与脑血容量（CBV）之间的非线性耦合，这是理解血液动力学响应的关键一步。通过这个练习，你将能够量化这些变化，并从原理上理解刺激后信号下冲（post-stimulus undershoot）这一常见现象的产生机制。",
            "id": "3998822",
            "problem": "考虑一个短暂的神经刺激，它使脑血流量 (Cerebral Blood Flow, CBF) 在短时间内增加一个恒定的比例。设基线 CBF 为 $f_{0}$，基线脑血容量 (Cerebral Blood Volume, CBV) 为 $v_{0}$。定义相对变化为 $r_{f} = f/f_{0}$ 和 $r_{v} = v/v_{0}$。假设在峰值响应期间为准稳态血液动力学，并且经验建立的 Grubb 关系 $v \\propto f^{\\alpha}$ 在局部成立，其中指数 $\\alpha$ 表征微血管顺应性。根据质量平衡，血容量动态遵循 $dv/dt = \\text{inflow} - \\text{outflow}$，在峰值的准稳态条件下，瞬时 $r_{v}$ 可通过 Grubb 关系与 $r_{f}$ 相关联。\n\n假设刺激在峰值时产生 $20\\%$ 的 CBF 增加，即 $r_{f} = 1.2$，且局部 Grubb 指数为 $\\alpha = 0.2$。仅使用上述定义和 Grubb 耦合关系，推导峰值时 CBV 分数变化的闭合形式表达式 $\\Delta v / v_{0} = r_{v} - 1$，然后计算其数值。将最终数值答案四舍五入至四位有效数字。将分数变化表示为无量纲小数（不要使用百分号）。\n\n最后，在不援引任何特定的血氧水平依赖 (Blood Oxygenation Level Dependent, BOLD) 信号方程的情况下，利用脱氧血红蛋白含量和体积的定义，定性地讨论此 CBV 变化的幅度及其相对于 CBF 可能的延迟恢复如何导致 BOLD 信号中的刺激后下冲。首次使用时定义所有缩写词：血氧水平依赖 (BOLD)、脑血容量 (CBV)、脑血流量 (CBF)。",
            "solution": "该问题要求基于给定的脑血流量 (Cerebral Blood Flow, CBF) 变化和已建立的经验关系，推导和计算脑血容量 (Cerebral Blood Volume, CBV) 的分数变化，然后定性讨论血氧水平依赖 (Blood Oxygenation Level Dependent, BOLD) 信号中的刺激后下冲。\n\n首先，我们推导峰值时 CBV 分数变化的闭合形式表达式。\n问题陈述了经验建立的 Grubb 关系，该关系将由 $v$ 表示的 CBV 与由 $f$ 表示的 CBF 耦合起来：\n$$v \\propto f^{\\alpha}$$\n这种比例关系可以写成一个带有比例常数 $k$ 的方程：\n$$v = k f^{\\alpha}$$\n这种关系在不同的生理状态下都成立，包括基线和激活状态。设基线 CBV 为 $v_{0}$，基线 CBF 为 $f_{0}$。在基线状态下，方程为：\n$$v_{0} = k f_{0}^{\\alpha}$$\n在刺激诱导响应的峰值，CBV 为 $v$，CBF 为 $f$。方程为：\n$$v = k f^{\\alpha}$$\n为了找到相对变化之间的关系，我们可以将峰值激活时的方程除以基线时的方程：\n$$\\frac{v}{v_{0}} = \\frac{k f^{\\alpha}}{k f_{0}^{\\alpha}}$$\n常数 $k$ 消去，得到：\n$$\\frac{v}{v_{0}} = \\left(\\frac{f}{f_{0}}\\right)^{\\alpha}$$\n问题将相对变化定义为 $r_{v} = v/v_{0}$ 和 $r_{f} = f/f_{0}$。将这些定义代入方程，得到相对变化之间的耦合关系：\n$$r_{v} = r_{f}^{\\alpha}$$\n问题要求的是 CBV 的分数变化，定义为 $\\frac{\\Delta v}{v_{0}}$。我们可以用 $r_v$ 来表示它：\n$$\\frac{\\Delta v}{v_{0}} = \\frac{v - v_{0}}{v_{0}} = \\frac{v}{v_{0}} - \\frac{v_{0}}{v_{0}} = r_{v} - 1$$\n通过代入 $r_{v}$ 的表达式，我们得到以 CBF 分数变化表示的 CBV 分数变化的最终闭合形式表达式：\n$$\\frac{\\Delta v}{v_{0}} = r_{f}^{\\alpha} - 1$$\n\n接下来，我们使用提供的数据计算此分数变化的数值。\n刺激使 CBF 增加了 $20\\%$，这意味着峰值流量 $f$ 是基线流量 $f_0$ 的 $120\\%$。这对应的相对变化 $r_f$ 为：\n$$r_{f} = \\frac{f}{f_{0}} = \\frac{1.20 f_{0}}{f_{0}} = 1.2$$\n给定的局部 Grubb 指数为 $\\alpha = 0.2$。\n将这些值代入我们推导的表达式中：\n$$\\frac{\\Delta v}{v_{0}} = (1.2)^{0.2} - 1$$\n我们可以计算其数值。注意，指数 $0.2$ 等价于 $5$ 次方根：\n$$(1.2)^{0.2} = (1.2)^{1/5} = \\sqrt[5]{1.2} \\approx 1.037137$$\n因此，分数变化为：\n$$\\frac{\\Delta v}{v_{0}} \\approx 1.037137 - 1 = 0.037137$$\n将此结果四舍五入至四位有效数字，得到：\n$$\\frac{\\Delta v}{v_{0}} \\approx 0.03714$$\n\n最后，我们定性地讨论这种 CBV 变化的幅度及其相对于 CBF 可能的延迟恢复如何导致刺激后下冲。\n血氧水平依赖 (Blood Oxygenation Level Dependent, BOLD) 信号用于功能性磁共振成像，通过检测血氧合的变化来间接测量神经活动。该信号对局部脱氧血红蛋白的浓度敏感，脱氧血红蛋白具有顺磁性，会引起磁场不均匀性。脱氧血红蛋白浓度越低，BOLD 信号就越高。\n\n在神经刺激期间，脑血流量 (Cerebral Blood Flow, CBF) 即血液输送速率会大幅增加。这种流量增加显著地过度补偿了氧气消耗的较小增加。其结果是脱氧血红蛋白从毛细血管床的静脉端被“冲刷”掉，导致其浓度下降，从而使 BOLD 信号增加。这种 CBF 的增加也迫使脑血容量 (Cerebral Blood Volume, CBV) 即特定脑区中的总血量增加，因为血管为了容纳更高的血流而扩张。\n\n刺激后下冲是指在神经刺激停止后的一段时间内，BOLD 信号降至其刺激前基线水平以下的现象。对此效应的一个主要假设集中在 CBF 和 CBV 恢复的不同时间动态上。刺激停止后，CBF 倾向于相对较快地恢复到基线水平。然而，被拉伸的静脉血管具有顺应性，其恢复到基线容积的速度要慢得多。这种生物力学特性导致了一个瞬时状态，即 CBF 已经正常化（或接近正常化），但 CBV 仍然升高。\n\n在这个特定的刺激后时期：\n1.  **CBF 处于基线水平**：新鲜的含氧血液供应恢复正常。\n2.  **CBV 升高**：静脉室的容积仍大于其基线状态。\n\n因为代谢性耗氧率继续维持在接近基线的水平，脱氧血红蛋白仍在产生。这些脱氧血红蛋白现在汇集在仍然增大的静脉容积中。成像体素内的脱氧血红蛋白总量（即其浓度与静脉血容量的乘积）变得比初始基线时更大。这种增加的总顺磁性脱氧血红蛋白量会产生更强的局部磁场畸变，导致信号衰减更快，因此 BOLD 信号低于初始基线水平。这种效应会一直持续到静脉 CBV 完全恢复到其基线状态，此时 BOLD 信号也恢复到基线。因此，快速恢复的 CBF 和缓慢恢复的 CBV 之间恢复时间尺度的不匹配是提出的解释刺激后 BOLD 下冲的关键机制。",
            "answer": "$$\n\\boxed{0.03714}\n$$"
        },
        {
            "introduction": "在掌握了BOLD信号的生理基础后，下一个挑战是如何精确地对其时间动态进行建模。血液动力学响应函数（HRF）是描述神经元脉冲活动如何转化为可观测BOLD信号的数学模型，但其形态在不同个体和脑区之间存在显著差异。这个动手编程练习旨在模拟一个常见且重要的问题：当使用一个固定的“标准”HRF去拟合一个具有内在延迟的真实大脑响应时，会导致对活动振幅的估计产生偏差。你将通过实现一个包含时间导数基函数的增强模型，来亲身体验并量化这种先进技术如何有效校正延迟，从而提高模型拟合的准确性和稳健性。",
            "id": "3998785",
            "problem": "考虑将功能性磁共振成像 (fMRI) 的血氧水平依赖 (BOLD) 信号的卷积模型视为一个线性时不变系统：观测到的信号是刺激时间序列与血流动力学响应函数 (HRF) 卷积的结果。设刺激是一个以固定时间分辨率采样的离散时间序列。BOLD 信号遵循卷积的线性叠加和时移特性。广义线性模型 (GLM) 为线性回归参数提供了一个普通最小二乘估计量。\n\n您的任务是，量化在使用不匹配的标准 HRF 拟合由延迟 HRF 生成的数据时引入的偏差，并测量在 GLM 中增加时间导数基函数时所带来的改善。请使用基于卷积模型和线性回归的原理推导来定义和计算幅度偏差及其减少量。\n\n使用以下基础理论：\n\n- 观测到的 BOLD 信号被建模为卷积：对于一个刺激序列 $s[n]$ 和一个 HRF $h[n]$，无噪声响应为 $y[n] = \\sum_{k=0}^{\\infty} s[k] h[n-k] \\Delta t$，其中 $\\Delta t$ 是以秒为单位的采样间隔。\n- GLM 假设 $y = X \\beta + \\varepsilon$，并使用普通最小二乘法来估计 $\\hat{\\beta} = (X^{\\top} X)^{-1} X^{\\top} y$，其中 $X$ 是设计矩阵，$\\varepsilon$ 是残差（此处，设 $\\varepsilon = 0$ 以分离模型不匹配偏差）。\n- 标准血流动力学响应函数 (HRF) $h_{0}(t)$ 定义为两个伽马密度函数的差，这在神经影像学中被广泛使用。在离散时间内，在有限支撑集上以 $\\Delta t$ 的间隔对其进行采样。\n\n请精确实现以下步骤：\n\n1. 设采样间隔为 $\\Delta t = 0.5$ 秒。设总模拟时长为 $T = 120$ 秒。构建离散时间网格 $t = 0, \\Delta t, 2\\Delta t, \\ldots, T - \\Delta t$。\n\n2. 对于 $t \\ge 0$，通过以下公式定义标准 HRF $h_{0}(t)$\n   $$h_{0}(t) = g(t; a_{1}, b_{1}) - c \\, g(t; a_{2}, b_{2}),$$\n   其中 $g(t; a, b)$ 是伽马密度\n   $$g(t; a, b) = \\frac{t^{a-1} e^{-t/b}}{b^{a} \\Gamma(a)}, \\quad t \\ge 0,$$\n   并使用参数 $a_{1} = 6$，$b_{1} = 1$，$a_{2} = 16$，$b_{2} = 1$ 以及 $c = 1/6$。在 $t = 0, \\Delta t, \\ldots, t_{\\max}$（其中 $t_{\\max} = 32$ 秒）上对 $h_{0}(t)$ 进行采样，并对于 $t  0$ 设 $h_{0}(t) = 0$。\n\n3. 构建一个刺激序列 $s[n]$，该序列包含五个 1 秒的盒状事件，分别发生在 10 秒、30 秒、50 秒、70 秒和 90 秒。也就是说，如果一个事件在时间 $t_{e}$ 开始，那么对于索引 $n$ 满足 $t[n] \\in [t_{e}, t_{e} + 1)$ 的情况，设 $s[n] = 1$，否则设 $s[n] = 0$。\n\n4. 将延迟 HRF 定义为 $h_{d}(t) = h_{0}(t - d)$，其中当 $t - d  0$ 时 $h_{d}(t) = 0$。这里的 $d$ 是一个以秒为单位的恒定延迟，可以为正（晚响应）或为负（早响应）。通过使用 $d/\\Delta t$ 的整数样本位移，实现采样后 HRF 的离散时间平移。\n\n5. 通过离散卷积生成无噪声观测数据 $y[n]$：\n   $$y[n] = \\Delta t \\sum_{k=0}^{N-1} s[k] h_{d}[n-k],$$\n   并截断至刺激长度 $N$。\n\n6. 构建仅含标准 HRF 的 GLM 设计矩阵 $X_{1} = [r_{c}, \\mathbf{1}]$，其中 $\\mathbf{1}$ 是全为 1 的列向量，而\n   $$r_{c}[n] = \\Delta t \\sum_{k=0}^{N-1} s[k] h_{0}[n-k],$$\n   是标准回归量。计算普通最小二乘估计 $\\hat{\\beta}_{1}$，并将幅度估计 $\\hat{A}_{1}$ 定义为标准回归量的系数，即 $\\hat{\\beta}_{1}$ 的第一个分量。设真实幅度为 $A_{\\text{true}} = 1$。将偏差定义为 $b_{1} = \\hat{A}_{1} - A_{\\text{true}}$。\n\n7. 构建经导数增强的 GLM 设计矩阵 $X_{2} = [r_{c}, r_{d}, \\mathbf{1}]$，其中 $r_{d}[n]$ 是通过将刺激与标准 HRF 的时间导数进行卷积得到的回归量：\n   $$r_{d}[n] = \\Delta t \\sum_{k=0}^{N-1} s[k] \\left(\\frac{d}{dt} h_{0}\\right)[n-k],$$\n   其导数通过对采样后的 $h_{0}(t)$ 使用有限差分进行数值计算。计算 $\\hat{\\beta}_{2}$ 并将 $\\hat{A}_{2}$ 定义为 $\\hat{\\beta}_{2}$ 的第一个分量，其偏差为 $b_{2} = \\hat{A}_{2} - A_{\\text{true}}$。\n\n8. 将导数基函数带来的改善量化为绝对偏差的减少量：\n   $$R = |b_{1}| - |b_{2}|.$$\n   正的 $R$ 值表示幅度偏差减小。\n\n测试套件：\n\n对以下延迟 $d$（以秒为单位）评估改善量 $R$：\n\n- 案例 1：$d = 0.0$（无延迟，边界情况）。\n- 案例 2：$d = 0.5$（小的正延迟）。\n- 案例 3：$d = 2.0$（中等正延迟）。\n- 案例 4：$d = 4.0$（大的正延迟）。\n- 案例 5：$d = -0.5$（小的负延迟）。\n\n要求输出：\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[r_{1}, r_{2}, r_{3}, r_{4}, r_{5}]$），列表中的每个 $r_{i}$ 是对应测试案例计算出的改善量 $R$。所有数值均以十进制浮点数表示。时间单位始终为秒；幅度和偏差均为无量纲。",
            "solution": "该问题要求对功能性磁共振成像 (fMRI) 信号模型中，当真实与建模的血流动力学响应函数 (HRF) 不匹配时，幅度估计产生的偏差进行定量分析，并评估通过时间导数基函数增强广义线性模型 (GLM) 来校正此偏差的有效性。整个过程基于线性时不变 (LTI) 系统理论和普通最小二乘 (OLS) 估计。\n\n首先，我们按规定建立数学和计算框架。\n\n**1. 时间离散化与刺激定义**\n模拟在总时长 $T = 120$ 秒内进行，采样间隔为 $\\Delta t = 0.5$ 秒。这定义了一个离散时间网格 $t_n = n \\Delta t$，其中 $n = 0, 1, \\ldots, N-1$，$N = T/\\Delta t = 240$。\n刺激 $s[n]$ 是一个表示神经事件的二元序列。它由五个 1 秒的盒状函数组成，分别在 $t_e \\in \\{10, 30, 50, 70, 90\\}$ 秒时开始。对于每个在 $t_e$ 开始的事件，所有满足 $t_e \\le t_n  t_e + 1$ 的时间点 $t_n$，其对应的离散刺激样本 $s[n]$ 均设为 1，否则为 0。\n\n**2. 血流动力学响应函数 (HRF) 定义**\n标准 HRF，记作 $h_0(t)$，模拟了 BOLD 信号对一个短暂、脉冲式神经事件的响应。它被定义为两个伽马概率密度函数的差：\n$$h_{0}(t) = g(t; a_{1}, b_{1}) - c \\, g(t; a_{2}, b_{2})$$\n其中伽马密度函数 $g(t; a, b)$ 由下式给出：\n$$g(t; a, b) = \\frac{t^{a-1} e^{-t/b}}{b^{a} \\Gamma(a)}, \\quad t \\ge 0$$\n参数指定为 $a_{1} = 6$, $b_{1} = 1$, $a_{2} = 16$, $b_{2} = 1$, 以及 $c = 1/6$。我们在 $t_{max} = 32$ 秒的有限支撑集上以时间分辨率 $\\Delta t$ 对 $h_0(t)$ 进行采样，以获得离散滤波器核 $h_0[n]$。\n\n数据背后的真实 HRF 是标准 HRF 的时移版本，$h_d(t) = h_0(t-d)$，其中 $d$ 是以秒为单位的延迟。正的 $d$ 对应延迟响应，负的 $d$ 对应提前响应。在离散域中，这是通过将采样后的核 $h_0[n]$ 平移 $d/\\Delta t$ 个样本来实现的。对于 $k = d/\\Delta t$ 个样本的位移，如果 $k>0$，我们在 $h_0[n]$ 前面加上 $k$ 个零并截断末尾；如果 $k0$，我们移除前 $|k|$ 个样本并在末尾追加 $|k|$ 个零。这样就产生了离散的延迟核 $h_d[n]$。\n\n**3. 通过卷积生成数据**\n在线性时不变 (LTI) 系统假设下，无噪声 BOLD 信号 $y[n]$ 是刺激 $s[n]$ 与真实（延迟）HRF 核 $h_d[n]$ 的离散卷积，并按采样间隔 $\\Delta t$ 进行缩放：\n$$y[n] = \\Delta t \\sum_{k=0}^{N-1} s[k] h_{d}[n-k]$$\n此操作模拟了对刺激序列中每个分量的响应的线性叠加。\n\n**4. GLM 估计与偏差计算**\n广义线性模型 (GLM) 框架用于估计响应的幅度。模型为 $y = X \\beta + \\varepsilon$。我们考虑一个无噪声场景 ($\\varepsilon=0$) 以分离由模型不匹配引起的偏差。参数 $\\beta$ 的普通最小二乘 (OLS) 估计为 $\\hat{\\beta} = (X^{\\top} X)^{-1} X^{\\top} y$。\n\n**模型 1：仅使用标准 HRF 的 GLM**\n第一个模型尝试仅使用标准 HRF 来解释数据 $y$。设计矩阵 $X_1$ 由两个回归量构成：\n1.  标准回归量 $r_c[n]$，由刺激 $s[n]$ 与标准 HRF $h_0[n]$ 卷积形成：$r_c[n] = \\Delta t \\sum_k s[k] h_0[n-k]$。\n2.  一个截距项，即一个全为 1 的列，用于模拟基线信号水平。\n因此，$X_1 = [r_c, \\mathbf{1}]$。我们求解系统 $y = X_1 \\beta_1$ 得到 $\\hat{\\beta}_1 = [\\hat{A}_1, \\text{intercept}]^{\\top}$。根据构造，响应的真实幅度为 $A_{\\text{true}} = 1$。此第一个估计量的偏差为 $b_1 = \\hat{A}_1 - A_{\\text{true}}$。当 $d \\neq 0$ 时，$y$ 与 $r_c$ 不匹配，导致非零偏差 $b_1$。\n\n**模型 2：使用导数增强的 GLM**\n第二个模型基于延迟 HRF 的一阶泰勒级数近似：\n$$h_d(t) = h_0(t-d) \\approx h_0(t) - d \\cdot \\frac{d}{dt}h_0(t)$$\n与刺激 $s(t)$ 进行卷积表明，所得信号 $y(t)$ 可以近似为 $r_c(t) = s(t) * h_0(t)$ 和 $s(t) * \\frac{d}{dt}h_0(t)$ 的线性组合。这启发我们在 GLM 中添加一个基于 HRF 时间导数的回归量。\n\n标准 HRF 的导数 $\\frac{d}{dt}h_0(t)$ 通过在采样核 $h_0[n]$ 上使用有限差分法进行数值计算。该导数核与刺激进行卷积，创建导数回归量：$r_d[n] = \\Delta t \\sum_k s[k] (\\frac{d}{dt}h_0)[n-k]$。\n\n增强后的设计矩阵为 $X_2 = [r_c, r_d, \\mathbf{1}]$。我们求解 $y = X_2 \\beta_2$ 得到 $\\hat{\\beta}_2 = [\\hat{A}_2, \\hat{\\beta}_{d}, \\text{intercept}]^{\\top}$。幅度估计 $\\hat{A}_2$ 是标准回归量的系数。其偏差为 $b_2 = \\hat{A}_2 - A_{\\text{true}}$。通过考虑时间偏移，该模型有望提供更准确的幅度估计，从而使得偏差 $|b_2|$ 相较于 $|b_1|$ 更小。\n\n**5. 量化改善**\n包含时间导数基函数所带来的改善被量化为绝对偏差的减少量：\n$$R = |b_1| - |b_2|$$\n正值的 $R$ 表示增强模型提供了偏差更小的响应幅度估计。我们为测试套件中每个指定的延迟 $d$ 计算 $R$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import gamma\n\ndef solve():\n    \"\"\"\n    Computes the reduction in amplitude estimation bias for an fMRI GLM\n    by augmenting the model with a temporal derivative basis function.\n    \"\"\"\n\n    def g_pdf(t, a, b):\n        \"\"\"Gamma probability density function.\"\"\"\n        # Handle t=0 case where t**(a-1) is 0 for a > 1\n        t_safe = np.maximum(t, 1e-12)\n        val = (t_safe**(a - 1) * np.exp(-t_safe / b)) / (b**a * gamma(a))\n        val[t == 0] = 0.0\n        return val\n\n    def calculate_improvement(d):\n        \"\"\"\n        Calculates the bias improvement R for a given delay d.\n        \"\"\"\n        # 1. Setup time grid and constants\n        dt = 0.5  # Sampling interval in seconds\n        T = 120.0  # Total duration in seconds\n        t_max_hrf = 32.0  # HRF support duration\n        time_vec = np.arange(0, T, dt)\n        N = len(time_vec)\n        A_true = 1.0\n\n        # 2. Define canonical HRF h0(t)\n        hrf_time_vec = np.arange(0, t_max_hrf + dt, dt)\n        a1, b1 = 6.0, 1.0\n        a2, b2 = 16.0, 1.0\n        c = 1.0 / 6.0\n        h0_sampled = g_pdf(hrf_time_vec, a1, b1) - c * g_pdf(hrf_time_vec, a2, b2)\n\n        # 3. Construct stimulus train s[n]\n        s = np.zeros(N)\n        event_times = [10.0, 30.0, 50.0, 70.0, 90.0]\n        event_duration = 1.0\n        for t_e in event_times:\n            event_indices = (time_vec >= t_e)  (time_vec  t_e + event_duration)\n            s[event_indices] = 1.0\n\n        # 4. Define the delayed HRF h_d(t)\n        shift_samples = int(round(d / dt))\n        h_d_sampled = np.zeros_like(h0_sampled)\n        if shift_samples == 0:\n            h_d_sampled = h0_sampled.copy()\n        elif shift_samples > 0:\n            h_d_sampled[shift_samples:] = h0_sampled[:-shift_samples]\n        else: # shift_samples  0\n            h_d_sampled[:shift_samples] = h0_sampled[-shift_samples:]\n\n        # 5. Generate noise-free observed data y[n]\n        y = dt * np.convolve(s, h_d_sampled, mode='full')[:N]\n\n        # 6. Canonical-only GLM (GLM 1)\n        r_c = dt * np.convolve(s, h0_sampled, mode='full')[:N]\n        intercept = np.ones(N)\n        X1 = np.vstack([r_c, intercept]).T\n        \n        beta1, _, _, _ = np.linalg.lstsq(X1, y, rcond=None)\n        A1_hat = beta1[0]\n        b1 = A1_hat - A_true\n\n        # 7. Derivative-augmented GLM (GLM 2)\n        h0_deriv = np.gradient(h0_sampled, dt)\n        r_d = dt * np.convolve(s, h0_deriv, mode='full')[:N]\n        X2 = np.vstack([r_c, r_d, intercept]).T\n        \n        beta2, _, _, _ = np.linalg.lstsq(X2, y, rcond=None)\n        A2_hat = beta2[0]\n        b2 = A2_hat - A_true\n\n        # 8. Quantify improvement R\n        R = abs(b1) - abs(b2)\n        return R\n\n    # Test Suite: Delays d in seconds\n    test_cases = [\n        0.0,   # Case 1: no delay\n        0.5,   # Case 2: small positive delay\n        2.0,   # Case 3: moderate positive delay\n        4.0,   # Case 4: large positive delay\n        -0.5   # Case 5: small negative delay\n    ]\n\n    results = []\n    for d_val in test_cases:\n        improvement = calculate_improvement(d_val)\n        results.append(improvement)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "通用线性模型（GLM）是功能磁共振成像（fMRI）数据分析的基石，它使我们能够从复杂的BOLD时间序列中分离出与特定任务相关的神经活动。然而，GLM估计结果的可靠性在很大程度上取决于实验设计。本练习聚焦于一个核心的统计问题：当设计矩阵中的多个回归量高度相关（即存在多重共线性）时，参数估计的方差会急剧膨胀，从而降低统计功效。通过从第一性原理推导方差膨胀因子（VIF），你将深入理解为何正交的实验设计至关重要，并学会如何诊断和量化共线性对fMRI结果可解释性的影响。",
            "id": "4198478",
            "problem": "使用广义线性模型 (GLM) 对单个体素的血氧水平依赖 (BOLD) 时间序列进行建模。设观测到的时间序列为 $y \\in \\mathbb{R}^{N}$，设计矩阵为 $X \\in \\mathbb{R}^{N \\times p}$，其中 $p=3$ 个回归量分别对应两个任务条件和一个伪迹运动参数，并假设参数向量为 $\\beta \\in \\mathbb{R}^{3}$。假设模型为经典线性模型，噪声为独立同分布的高斯噪声：$\\epsilon \\sim \\mathcal{N}(0, \\sigma^{2} I_{N})$，且 $y = X \\beta + \\epsilon$，参数通过普通最小二乘法 (OLS) 进行估计。$X$ 的 $3$ 列是通过将事件序列与典范血流动力学响应函数 (HRF) 进行卷积，然后按列进行标准化以使其均值为零、方差为单位一而构建的。样本量为 $N=200$。将回归量分别记为 $A$、$B$ 和 $M$（分别代表两个任务条件和运动伪迹）。$X$ 各列的样本相关矩阵为\n$$\nR \\;=\\; \\begin{pmatrix}\n1   r   0 \\\\\nr   1   0 \\\\\n0   0   1\n\\end{pmatrix},\n$$\n其中 $r = 0.8$。根据在这种列标准化下样本相关矩阵的定义，有 $X^{\\top} X = N R$。\n\n基于经典线性模型下普通最小二乘估计量的基本性质，并仅使用上面给出的信息，推导 OLS 系数估计的方差与设计相关结构之间的关系。利用此关系，将每个系数的方差膨胀因子定义为其在给定设计下的方差与一个反事实设计下的方差之比，其中反事实设计的三列相互正交，但其列范数与给定设计中的相同。计算在给定的 $R$ 和 $N$ 下，回归量 $A$、$B$ 和 $M$ 的方差膨胀因子。\n\n将 $(A, B, M)$ 的三个方差膨胀因子以单行矩阵的形式报告，使用 LaTeX 的 $\\texttt{pmatrix}$ 环境。请勿对答案进行四舍五入。",
            "solution": "问题要求推导和计算应用于 BOLD 时间序列的广义线性模型 (GLM) 中参数的普通最小二乘 (OLS) 估计的方差膨胀因子 (VIF)。\n\n首先，我们建立 OLS 估计量的基本性质。模型由 $y = X \\beta + \\epsilon$ 给出，其中 $y \\in \\mathbb{R}^{N}$ 是观测数据，$X \\in \\mathbb{R}^{N \\times p}$ 是设计矩阵，$\\beta \\in \\mathbb{R}^{p}$ 是参数向量，$\\epsilon$ 是噪声向量。给定 $p=3$ 和 $N=200$。噪声被假定为白高斯噪声，$\\epsilon \\sim \\mathcal{N}(0, \\sigma^{2} I_{N})$，其中 $\\sigma^2$ 是噪声方差，$I_N$ 是 $N \\times N$ 的单位矩阵。\n\n$\\beta$ 的 OLS 估计量由表达式 $\\hat{\\beta} = (X^{\\top} X)^{-1} X^{\\top} y$ 给出。该估计量的协方差矩阵 $\\text{Cov}(\\hat{\\beta})$ 推导如下：\n$$\n\\text{Cov}(\\hat{\\beta}) = \\text{Cov}((X^{\\top} X)^{-1} X^{\\top} y)\n$$\n由于 $X$ 是一个固定的回归量矩阵，我们可以写出：\n$$\n\\text{Cov}(\\hat{\\beta}) = (X^{\\top} X)^{-1} X^{\\top} \\text{Cov}(y) ( (X^{\\top} X)^{-1} X^{\\top} )^{\\top}\n$$\n数据 $y$ 的协方差为 $\\text{Cov}(y) = \\text{Cov}(X\\beta + \\epsilon) = \\text{Cov}(\\epsilon) = \\sigma^2 I_N$。将此代入 $\\text{Cov}(\\hat{\\beta})$ 的表达式中得到：\n$$\n\\text{Cov}(\\hat{\\beta}) = (X^{\\top} X)^{-1} X^{\\top} (\\sigma^2 I_N) X (X^{\\top} X)^{-1} = \\sigma^2 (X^{\\top} X)^{-1} (X^{\\top} X) (X^{\\top} X)^{-1}\n$$\n这可以简化为众所周知的结果：\n$$\n\\text{Cov}(\\hat{\\beta}) = \\sigma^2 (X^{\\top} X)^{-1}\n$$\n单个系数估计 $\\hat{\\beta}_j$ 的方差是该协方差矩阵的第 $j$ 个对角元素：\n$$\n\\text{Var}(\\hat{\\beta}_j) = [\\text{Cov}(\\hat{\\beta})]_{jj} = \\sigma^2 [(X^{\\top} X)^{-1}]_{jj}\n$$\n问题指出，对于给定的设计矩阵 $X$，关系式 $X^{\\top} X = N R$ 成立，其中 $N=200$ 是样本量，$R$ 是 $X$ 各列的样本相关矩阵。将此代入方差表达式中，我们找到了估计的方差与设计相关结构之间的关系：\n$$\n\\text{Var}(\\hat{\\beta}_j) = \\sigma^2 [(N R)^{-1}]_{jj} = \\frac{\\sigma^2}{N} [R^{-1}]_{jj}\n$$\n方差膨胀因子 (VIF) 定义为在给定设计下系数估计的方差与在反事实设计下其方差之比，其中反事实设计中的回归量相互正交但具有相同的列范数。\n\n首先，让我们确定反事实正交设计（记为 $X_{ortho}$）中的方差。问题指出，$X_{ortho}$ 的列与 $X$ 的列具有相同的范数。$X^{\\top}X = NR$ 的对角元素是 $(X^{\\top}X)_{jj} = X_j^{\\top}X_j = \\|X_j\\|^2$。由于 $R_{jj}=1$，对于每一列 $j$ 我们有 $\\|X_j\\|^2 = N \\cdot 1 = N$。因此，反事实设计 $X_{ortho}$ 具有正交的列，且 $\\|X_{ortho,j}\\|^2 = N$。这个正交设计的格拉姆矩阵是一个对角矩阵：\n$$\nX_{ortho}^{\\top} X_{ortho} = \\begin{pmatrix} N   0   0 \\\\ 0   N   0 \\\\ 0   0   N \\end{pmatrix} = N I_3\n$$\n在这种情况下，估计量 $\\hat{\\beta}_{j, ortho}$ 的方差为：\n$$\n\\text{Var}(\\hat{\\beta}_{j, ortho}) = \\sigma^2 [(N I_3)^{-1}]_{jj} = \\sigma^2 \\left[\\frac{1}{N} I_3\\right]_{jj} = \\frac{\\sigma^2}{N}\n$$\n现在，我们可以按定义计算第 $j$ 个系数的 VIF：\n$$\n\\text{VIF}_j = \\frac{\\text{Var}(\\hat{\\beta}_j)}{\\text{Var}(\\hat{\\beta}_{j, ortho})} = \\frac{\\frac{\\sigma^2}{N} [R^{-1}]_{jj}}{\\frac{\\sigma^2}{N}} = [R^{-1}]_{jj}\n$$\n因此，每个系数的 VIF 就是相关矩阵 $R$ 的逆矩阵的相应对角元素。\n\n给定的相关矩阵为：\n$$\nR = \\begin{pmatrix}\n1   r   0 \\\\\nr   1   0 \\\\\n0   0   1\n\\end{pmatrix} \\quad\\text{with}\\quad r = 0.8\n$$\n这是一个块对角矩阵。它的逆矩阵是其各分块的逆矩阵所组成的块对角矩阵。设左上角的 $2 \\times 2$ 分块为 $R_{12} = \\begin{pmatrix} 1  r \\\\ r  1 \\end{pmatrix}$。\n该分块的行列式是 $\\det(R_{12}) = 1 \\cdot 1 - r \\cdot r = 1 - r^2$。\n其逆矩阵为 $R_{12}^{-1} = \\frac{1}{1-r^2} \\begin{pmatrix} 1  -r \\\\ -r  1 \\end{pmatrix}$。\n右下角的分块只是标量 $1$，其逆为 $1$。\n因此，完整相关矩阵的逆矩阵是：\n$$\nR^{-1} = \\begin{pmatrix}\n\\frac{1}{1-r^2}  \\frac{-r}{1-r^2}  0 \\\\\n\\frac{-r}{1-r^2}  \\frac{1}{1-r^2}  0 \\\\\n0  0  1\n\\end{pmatrix}\n$$\n三个回归量 (A, B, M) 的 VIF 是该矩阵的对角元素：\n$\\text{VIF}_A = [R^{-1}]_{11} = \\frac{1}{1-r^2}$\n$\\text{VIF}_B = [R^{-1}]_{22} = \\frac{1}{1-r^2}$\n$\\text{VIF}_M = [R^{-1}]_{33} = 1$\n\n我们代入给定的值 $r=0.8$：\n$r^2 = (0.8)^2 = 0.64$\n$1 - r^2 = 1 - 0.64 = 0.36$\n回归量 $A$ 和 $B$ 的 VIF 是：\n$\\text{VIF}_A = \\text{VIF}_B = \\frac{1}{0.36} = \\frac{1}{36/100} = \\frac{100}{36} = \\frac{25}{9}$\n回归量 $M$ 的 VIF 是：\n$\\text{VIF}_M = 1$\n这个结果是预料之中的，因为回归量 $M$ 与回归量 $A$ 和 $B$ 不相关，所以其方差不会因为它们的存在而膨胀。$A$ 和 $B$ 之间的高度相关性导致它们各自系数估计的方差显著膨胀。\n\n$(A, B, M)$ 的三个方差膨胀因子是 $(\\frac{25}{9}, \\frac{25}{9}, 1)$。我们将其报告为单行矩阵。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{25}{9}  \\frac{25}{9}  1 \\end{pmatrix}}\n$$"
        }
    ]
}