{
    "hands_on_practices": [
        {
            "introduction": "Before we can correct for differences in slice acquisition times, we must first be able to precisely calculate them. This exercise provides a foundational understanding of fMRI temporal structure by asking you to derive a mathematical model for slice timing from first principles. By working through a common interleaved acquisition scheme, you will develop the crucial skill of translating a sequence description into a predictive formula for the timing of any given slice, which is the necessary first step in any slice timing correction procedure .",
            "id": "4164941",
            "problem": "You are analyzing a single-band Echo Planar Imaging (EPI) functional Magnetic Resonance Imaging (fMRI) sequence with interleaved even-odd slice ordering. The volume comprises $N=36$ axial slices, indexed by integers $s \\in \\{1,2,\\dots,36\\}$ from inferior to superior. The Repetition Time (TR) is $T_R = 2.0 \\text{ s}$. Assume:\n- Each slice occupies a constant acquisition duration, and slices are acquired back-to-back within the volume without idle time. Thus, the per-slice acquisition duration is $\\Delta t = T_R/N$.\n- The acquisition order is interleaved with even slices first in ascending index, followed by odd slices in ascending index, that is, $2,4,6,\\dots,36,1,3,5,\\dots,35$.\n- The acquisition time $t(s)$ of slice $s$ is defined as the onset time of the slice readout relative to the start of the volume at $t=0$.\n\nStarting from fundamental definitions of EPI timing and uniform per-slice acquisition, derive a closed-form expression for the mapping from slice index $s$ to acquisition time $t(s)$ under the specified interleaved even-odd ordering. Then, using your derived mapping, compute the acquisition time of slice $s=26$ relative to the volume start. Express the final numerical time in seconds and round your answer to four significant figures.",
            "solution": "The problem is to derive a closed-form expression for the acquisition time $t(s)$ of a slice with index $s$ in a single-band EPI sequence and then to compute this time for a specific slice. The given parameters are the total number of slices $N=36$, the Repetition Time $T_R = 2.0 \\text{ s}$, and a specific interleaved acquisition order. The slice index $s$ ranges from $1$ to $36$.\n\nFirst, we establish the fundamental timing unit. The problem states that all slices are acquired with a constant duration and back-to-back within the volume time $T_R$. Therefore, the per-slice acquisition duration, $\\Delta t$, is the total time divided by the number of slices:\n$$\n\\Delta t = \\frac{T_R}{N}\n$$\nSubstituting the given values, we find:\n$$\n\\Delta t = \\frac{2.0 \\text{ s}}{36} = \\frac{1}{18} \\text{ s}\n$$\nThe acquisition time $t(s)$ of slice $s$ is its onset time relative to the start of the volume. This time is determined by the slice's position in the acquisition sequence. Let us define a zero-indexed acquisition position, $p$, where $p \\in \\{0, 1, \\dots, N-1\\}$. The first slice acquired corresponds to $p=0$, the second to $p=1$, and so on. The acquisition time for a slice at position $p$ is given by:\n$$\nt_p = p \\cdot \\Delta t = p \\frac{T_R}{N}\n$$\nTo find the function $t(s)$, we must first find the mapping from the slice index $s$ to its acquisition position, $p(s)$. The acquisition order is specified as interleaved even-odd: all even-indexed slices are acquired first in ascending order, followed by all odd-indexed slices in ascending order. The sequence is $2, 4, \\dots, 36, 1, 3, \\dots, 35$.\n\nWe derive the function $p(s)$ by considering two cases based on the parity of the slice index $s$.\n\nCase 1: $s$ is an even number.\nThe even slices are acquired in the order $2, 4, 6, \\dots, 36$.\nThe slice $s=2$ is the first slice acquired, so its position is $p(2)=0$.\nThe slice $s=4$ is the second slice acquired, so its position is $p(4)=1$.\nThe slice $s=6$ is the third slice acquired, so its position is $p(6)=2$.\nWe can see a pattern. For an even slice $s$, it is the $(s/2)$-th slice in the acquisition sequence. Since the position index $p$ is zero-based, the position is one less than its order in the sequence. Thus, for an even slice $s$:\n$$\np(s) = \\frac{s}{2} - 1\n$$\n\nCase 2: $s$ is an odd number.\nThe odd slices are acquired after all the even slices have been acquired. There are $N/2$ even slices. For $N=36$, this is $36/2 = 18$ even slices. These slices occupy the first $18$ positions in the sequence, from $p=0$ to $p=17$. Therefore, the acquisition of odd slices begins at position $p=18$, which is $p=N/2$.\nThe odd slices are acquired in the order $1, 3, 5, \\dots, 35$.\nThe first odd slice acquired is $s=1$, and its position is $p(1) = N/2 = 18$.\nThe second odd slice acquired is $s=3$, and its position is $p(3) = N/2 + 1 = 19$.\nAn odd slice $s$ can be written as $s = 2k-1$ for some integer $k \\ge 1$. For $s=1$, $k=1$. For $s=3$, $k=2$. In general, $k = (s+1)/2$. The slice $s$ is the $k$-th odd slice to be acquired.\nThe position of the $k$-th odd slice in the overall sequence is $p = (N/2) + (k-1)$. Substituting the expression for $k$ in terms of $s$:\n$$\np(s) = \\frac{N}{2} + \\left(\\frac{s+1}{2} - 1\\right) = \\frac{N}{2} + \\frac{s-1}{2} = \\frac{N+s-1}{2}\n$$\n\nCombining these two cases, we can write the complete mapping from slice index $s$ to acquisition position $p(s)$ as a piecewise function:\n$$\np(s) = \\begin{cases} \\frac{s-2}{2} & \\text{if } s \\text{ is even} \\\\ \\frac{N+s-1}{2} & \\text{if } s \\text{ is odd} \\end{cases}\n$$\nNow, we can write the closed-form expression for the acquisition time $t(s) = p(s) \\cdot \\Delta t$:\n$$\nt(s) = \\begin{cases} \\left(\\frac{s-2}{2}\\right) \\frac{T_R}{N} & \\text{if } s \\text{ is even} \\\\ \\left(\\frac{N+s-1}{2}\\right) \\frac{T_R}{N} & \\text{if } s \\text{ is odd} \\end{cases}\n$$\nThis is the required general closed-form expression for the acquisition time as a function of the slice index.\n\nThe problem then asks to compute the acquisition time of slice $s=26$.\nSince $s=26$ is an even number, we use the first part of the piecewise function:\n$$\nt(26) = \\left(\\frac{26-2}{2}\\right) \\frac{T_R}{N}\n$$\nSubstituting the given values $N=36$ and $T_R=2.0 \\text{ s}$:\n$$\nt(26) = \\left(\\frac{24}{2}\\right) \\frac{2.0}{36} = 12 \\cdot \\frac{2.0}{36} = \\frac{24.0}{36}\n$$\nSimplifying the fraction gives:\n$$\nt(26) = \\frac{2}{3} \\text{ s}\n$$\nAs a decimal, this is $t(26) = 0.6666\\dots \\text{ s}$. The problem requires the answer to be rounded to four significant figures.\n$$\nt(26) \\approx 0.6667 \\text{ s}\n$$",
            "answer": "$$\n\\boxed{0.6667}\n$$"
        },
        {
            "introduction": "Motion correction algorithms summarize head movement between volumes using a set of six rigid-body parameters, but how do these abstract numbers relate to physical voxel displacement? This practice demystifies these parameters by having you apply them directly to calculate the final position of a voxel following a rotation and a translation. This exercise builds a concrete intuition for how even small, sub-millimeter movements can impact the data, particularly for voxels far from the center of rotation, underscoring the necessity of robust motion correction .",
            "id": "4164907",
            "problem": "A functional Magnetic Resonance Imaging (fMRI) time series is corrected for subject motion using a rigid-body model in three-dimensional Euclidean space. Assume the scanner coordinate system is Cartesian with the isocenter at the origin, and voxel coordinates are expressed in millimeters. Consider a single-frame motion consisting of a pure rotation about the $z$-axis by an angle $\\alpha$ followed by a pure translation along the $x$-axis by $t_{x}$. A voxel originally located at $(x,y,z)=(40,0,0)$ undergoes this transformation. Using the standard definitions of rigid-body transformations in $\\mathbb{R}^{3}$ (rotation about an axis and translation), and the Euclidean norm for displacement, derive the expression for the magnitude of the displacement of this voxel between its pre-motion and post-motion positions. Then evaluate this displacement for $\\alpha=0.5^\\circ$ and $t_{x}=1\\,\\mathrm{mm}$. Use radians for trigonometric functions, converting degrees to radians via $\\theta_{\\mathrm{rad}}=\\theta_{\\mathrm{deg}}\\cdot\\frac{\\pi}{180}$. Express the final displacement in millimeters and round your answer to four significant figures.",
            "solution": "The problem requires us to determine the magnitude of the displacement of a voxel subjected to a sequence of rigid-body transformations: a rotation followed by a translation. We will first derive a general algebraic expression for this displacement and then evaluate it using the specified numerical values.\n\nA rigid-body transformation in three-dimensional Euclidean space, $\\mathbb{R}^{3}$, preserves the distances between any two points of the body. The transformation described in the problem is a composition of a rotation and a translation. The order of these operations is critical and must be followed as specified.\n\nLet the initial position of the voxel be represented by the column vector $\\mathbf{p}$. The problem states this position is $(x,y,z)=(40,0,0)$. All coordinates are in millimeters ($\\mathrm{mm}$).\n$$\n\\mathbf{p} = \\begin{pmatrix} x \\\\ y \\\\ z \\end{pmatrix} = \\begin{pmatrix} 40 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\nThe first transformation is a pure rotation about the $z$-axis by an angle $\\alpha$. This operation is represented by the rotation matrix $R_z(\\alpha)$:\n$$\nR_z(\\alpha) = \\begin{pmatrix} \\cos(\\alpha) & -\\sin(\\alpha) & 0 \\\\ \\sin(\\alpha) & \\cos(\\alpha) & 0 \\\\ 0 & 0 & 1 \\end{pmatrix}\n$$\nThe position of the voxel after this rotation, which we denote as $\\mathbf{p}'$, is given by the matrix-vector product $R_z(\\alpha)\\mathbf{p}$:\n$$\n\\mathbf{p}' = R_z(\\alpha)\\mathbf{p} = \\begin{pmatrix} \\cos(\\alpha) & -\\sin(\\alpha) & 0 \\\\ \\sin(\\alpha) & \\cos(\\alpha) & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} 40 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 40\\cos(\\alpha) \\\\ 40\\sin(\\alpha) \\\\ 0 \\end{pmatrix}\n$$\nThe second transformation is a pure translation along the $x$-axis by an amount $t_{x}$. This is represented by the addition of a translation vector $\\mathbf{t}$:\n$$\n\\mathbf{t} = \\begin{pmatrix} t_{x} \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\nThe final position of the voxel, $\\mathbf{p''}$, is obtained by applying the translation to the rotated position $\\mathbf{p}'$:\n$$\n\\mathbf{p''} = \\mathbf{p}' + \\mathbf{t} = \\begin{pmatrix} 40\\cos(\\alpha) \\\\ 40\\sin(\\alpha) \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} t_{x} \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 40\\cos(\\alpha) + t_{x} \\\\ 40\\sin(\\alpha) \\\\ 0 \\end{pmatrix}\n$$\nThe displacement vector, $\\Delta\\mathbf{p}$, is the difference between the final position $\\mathbf{p''}$ and the initial position $\\mathbf{p}$:\n$$\n\\Delta\\mathbf{p} = \\mathbf{p''} - \\mathbf{p} = \\begin{pmatrix} 40\\cos(\\alpha) + t_{x} \\\\ 40\\sin(\\alpha) \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 40 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 40(\\cos(\\alpha) - 1) + t_{x} \\\\ 40\\sin(\\alpha) \\\\ 0 \\end{pmatrix}\n$$\nThe magnitude of the displacement, which we denote as $D$, is the Euclidean norm of the displacement vector, $D = \\|\\Delta\\mathbf{p}\\|$. It is calculated as the square root of the sum of the squares of the components of $\\Delta\\mathbf{p}$:\n$$\nD = \\sqrt{( (40\\cos(\\alpha) + t_{x}) - 40 )^2 + (40\\sin(\\alpha) - 0)^2 + (0 - 0)^2}\n$$\nThis simplifies to the general expression for the displacement magnitude:\n$$\nD = \\sqrt{(40(\\cos(\\alpha) - 1) + t_{x})^2 + (40\\sin(\\alpha))^2}\n$$\nWe are now asked to evaluate this expression for the specific values $\\alpha = 0.5^\\circ$ and $t_{x} = 1\\,\\mathrm{mm}$. As required, we first convert the angle $\\alpha$ from degrees to radians:\n$$\n\\alpha_{\\mathrm{rad}} = 0.5^\\circ \\times \\frac{\\pi}{180^\\circ} = \\frac{\\pi}{360}\\,\\mathrm{radians}\n$$\nSubstituting the values of $\\alpha$ and $t_{x}$ into the expression for $D$:\n$$\nD = \\sqrt{ \\left(40\\left(\\cos\\left(\\frac{\\pi}{360}\\right) - 1\\right) + 1\\right)^2 + \\left(40\\sin\\left(\\frac{\\pi}{360}\\right)\\right)^2 }\n$$\nWe proceed with the numerical calculation. First, we evaluate the arguments of the trigonometric functions and then the components of the displacement vector:\n$\\alpha = \\frac{\\pi}{360} \\approx 0.008726646\\,\\mathrm{rad}$\n$\\cos(\\alpha) \\approx \\cos(0.008726646) \\approx 0.999961923$\n$\\sin(\\alpha) \\approx \\sin(0.008726646) \\approx 0.008726535$\n\nThe component of the displacement vector along the $x$-axis, $\\Delta x$, is:\n$$\n\\Delta x = 40(\\cos(\\alpha) - 1) + 1 \\approx 40(0.999961923 - 1) + 1 = 40(-0.000038077) + 1 \\approx -0.00152308 + 1 = 0.99847692\n$$\nThe component of the displacement vector along the $y$-axis, $\\Delta y$, is:\n$$\n\\Delta y = 40\\sin(\\alpha) \\approx 40(0.008726535) \\approx 0.3490614\n$$\nThe component along the $z$-axis, $\\Delta z$, is $0$.\n\nNow we calculate the magnitude $D$:\n$$\nD = \\sqrt{(\\Delta x)^2 + (\\Delta y)^2} \\approx \\sqrt{(0.99847692)^2 + (0.3490614)^2}\n$$\n$$\nD \\approx \\sqrt{0.99695614 + 0.12184386} = \\sqrt{1.11880000}\n$$\n$$\nD \\approx 1.05773342\\,\\mathrm{mm}\n$$\nThe problem requires the final answer to be rounded to four significant figures. The first four significant figures are $1$, $0$, $5$, and $7$. The fifth significant digit is $7$, which is greater than or equal to $5$, so we round up the last significant digit.\n$$\nD \\approx 1.058 \\,\\mathrm{mm}\n$$",
            "answer": "$$\n\\boxed{1.058}\n$$"
        },
        {
            "introduction": "Effective fMRI preprocessing is more than a series of isolated steps; it is a holistic strategy designed to maximize data quality. This final practice moves beyond simple calculation to the critical task of designing an optimal correction workflow that integrates both temporal and spatial corrections. You will synthesize principles of signal processing and statistical modeling to determine the ideal reference time for slice timing correction and justify a method that minimizes interpolation-induced data blurring, a key consideration for preserving the statistical power and validity of your analysis .",
            "id": "4164960",
            "problem": "A functional Magnetic Resonance Imaging (fMRI) experiment uses an event-related design with nominal event onsets jittered in steps of 0.5 seconds across runs. The data are acquired with a Repetition Time (TR) of 2 seconds and interleaved slice acquisition in a single-shot echo-planar imaging sequence. Assume each sliceâ€™s time stamp corresponds to the temporal center of its readout window within each volume. A General Linear Model (GLM) is fit to the data using regressors constructed by convolving the event time series with a fixed Hemodynamic Response Function (HRF). You are tasked with designing a slice timing correction strategy that is compatible with rigid-body motion correction and minimizes bias in the GLM regressors due to within-volume slice-time offsets.\n\nStarting from the fundamental linear time-invariant convolution model for the Blood Oxygen Level Dependent (BOLD) signal, and treating small temporal resampling shifts via first-order approximations, derive the choice of a single slice timing correction reference time $t_{\\mathrm{ref}}$ (within each TR) that minimizes the expected bias in the GLM regressors across slices when event phases relative to the volume onset are distributed uniformly over the TR due to the 0.5-second jitter. Interleaved ordering need not be modeled explicitly beyond the fact that slice acquisition times are uniformly spaced within each volume.\n\nDesign a scientifically sound strategy that integrates slice timing correction with rigid-body motion correction in a way that minimizes interpolation-induced blurring, and compute the numerical value of the optimal $t_{\\mathrm{ref}}$ for this dataset. Express your final numerical answer for $t_{\\mathrm{ref}}$ in seconds, rounded to four significant figures.",
            "solution": "The problem consists of three parts:\n1.  Derive the optimal slice timing correction reference time, $t_{\\mathrm{ref}}$, that minimizes bias under specific modeling assumptions.\n2.  Design an integrated strategy for slice timing correction (STC) and rigid-body motion correction (MC) that minimizes data blurring.\n3.  Compute the numerical value of the optimal $t_{\\mathrm{ref}}$ based on the provided experimental parameters.\n\n**Part 1: Derivation of the Optimal Reference Time $t_{\\mathrm{ref}}$**\n\nLet the underlying continuous Blood Oxygen Level Dependent (BOLD) signal, as predicted by the convolution of neural events with a hemodynamic response function (HRF), be denoted by $x(t)$. In an fMRI acquisition with Repetition Time $TR$, the $v$-th volume acquisition begins at time $t_v = v \\cdot TR$. Due to multi-slice acquisition, each slice $s$ is acquired at a slightly different time within the volume, $t_v + \\Delta t_s$, where $\\Delta t_s$ is the slice acquisition time relative to the beginning of the TR. The measured signal for slice $s$ in volume $v$ is therefore $x_s(v) = x(t_v + \\Delta t_s)$.\n\nThe problem states that slice acquisition times are uniformly spaced within the volume. We can model the set of slice timings $\\{\\Delta t_s\\}$ as being drawn from a continuous uniform distribution, $\\Delta t_s \\sim U(0, TR)$. This is a simplification, as the times are discrete, but it is a standard and effective approximation for this type of derivation.\n\nSlice timing correction (STC) aims to create a new dataset where all slices within a volume appear to have been acquired at a single common reference time, $t_{\\mathrm{ref}}$, relative to the volume onset. The corrected signal for volume $v$, denoted $\\tilde{x}(v)$, should be an estimate of the true signal at time $t_v + t_{\\mathrm{ref}}$, i.e., $\\tilde{x}(v) \\approx x(t_v + t_{\\mathrm{ref}})$.\n\nThis correction requires temporally resampling the data from each slice. Temporal resampling is an interpolation process, which inevitably introduces some error. Using a second-order Taylor series expansion, the true signal $x(t_v + \\Delta t_s)$ that we want to shift to time $t_v + t_{\\mathrm{ref}}$ can be related to the value at the target time:\n$$x(t_v + \\Delta t_s) \\approx x(t_v + t_{\\mathrm{ref}}) + \\dot{x}(t_v + t_{\\mathrm{ref}})(\\Delta t_s - t_{\\mathrm{ref}}) + \\frac{1}{2}\\ddot{x}(t_v + t_{\\mathrm{ref}})(\\Delta t_s - t_{\\mathrm{ref}})^2$$\nAn ideal interpolation algorithm (e.g., sinc interpolation) would perfectly reconstruct $x(t_v + t_{\\mathrm{ref}})$ from the samples $x_s(v)$, but practical interpolators (like linear or spline) have errors. The leading error term in these approximations is proportional to the curvature of the signal and the square of the temporal shift distance. Thus, the error, $\\epsilon_s$, introduced by correcting slice $s$ to the reference time $t_{\\mathrm{ref}}$ is proportional to the squared temporal distance of the shift:\n$$\\epsilon_s \\propto (\\Delta t_s - t_{\\mathrm{ref}})^2$$\n\nThe problem asks to minimize bias in the GLM regressors. A crucial source of modeling error (which leads to biased parameter estimates) is the discrepancy between the timing of the data and the timing of the model regressor. Best practice dictates that after performing STC to a reference time $t_{\\mathrm{ref}}$, the GLM regressors should also be constructed to model the signal at that same time, $t_{\\mathrm{ref}}$. By adopting this practice, the timing mismatch between the corrected data and the model is eliminated by design.\n\nThe remaining source of systematic error is the STC interpolation error itself. To minimize the overall bias introduced by the STC procedure across the entire volume, we must choose a $t_{\\mathrm{ref}}$ that minimizes the total interpolation error summed over all slices. This is equivalent to minimizing the expected interpolation error, where the expectation is taken over the distribution of slice acquisition times $\\Delta t_s$.\n\nWe seek to find the $t_{\\mathrm{ref}}$ that minimizes the expected squared temporal shift:\n$$L(t_{\\mathrm{ref}}) = E_{\\Delta t_s}[(\\Delta t_s - t_{\\mathrm{ref}})^2]$$\nGiven that $\\Delta t_s \\sim U(0, TR)$, the expectation is calculated by the integral:\n$$L(t_{\\mathrm{ref}}) = \\int_0^{TR} (\\tau - t_{\\mathrm{ref}})^2 \\frac{1}{TR} d\\tau$$\nTo find the minimum, we differentiate $L(t_{\\mathrm{ref}})$ with respect to $t_{\\mathrm{ref}}$ and set the result to zero:\n$$\\frac{dL}{dt_{\\mathrm{ref}}} = \\frac{d}{dt_{\\mathrm{ref}}} \\left[ \\frac{1}{TR} \\int_0^{TR} (\\tau^2 - 2\\tau t_{\\mathrm{ref}} + t_{\\mathrm{ref}}^2) d\\tau \\right]$$\n$$\\frac{dL}{dt_{\\mathrm{ref}}} = \\frac{1}{TR} \\int_0^{TR} \\frac{\\partial}{\\partial t_{\\mathrm{ref}}} (\\tau^2 - 2\\tau t_{\\mathrm{ref}} + t_{\\mathrm{ref}}^2) d\\tau = \\frac{1}{TR} \\int_0^{TR} (-2\\tau + 2t_{\\mathrm{ref}}) d\\tau$$\n$$\\frac{dL}{dt_{\\mathrm{ref}}} = \\frac{2}{TR} \\left[ -\\frac{\\tau^2}{2} + t_{\\mathrm{ref}}\\tau \\right]_0^{TR} = \\frac{2}{TR} \\left( -\\frac{TR^2}{2} + t_{\\mathrm{ref}}TR \\right) = 2(t_{\\mathrm{ref}} - \\frac{TR}{2})$$\nSetting the derivative to zero to find the extremum:\n$$2(t_{\\mathrm{ref}} - \\frac{TR}{2}) = 0 \\implies t_{\\mathrm{ref}} = \\frac{TR}{2}$$\nThe second derivative is $\\frac{d^2L}{dt_{\\mathrm{ref}}^2} = 2 > 0$, confirming that this value of $t_{\\mathrm{ref}}$ corresponds to a minimum.\n\nThe optimal choice for the slice timing correction reference time, which minimizes the average interpolation error across slices, is the mean of the slice acquisition times. For a uniform distribution of slice times over $[0, TR]$, this is $TR/2$. The specified jitter in event onsets, which ensures that stimulus timing is not locked to slice acquisition, makes the assumption of minimizing average interpolation error a valid primary objective.\n\n**Part 2: Integrated Motion and Slice Timing Correction Strategy**\n\nBoth rigid-body motion correction (MC) and slice timing correction (STC) require resampling the fMRI data. MC resamples data in space, while STC resamples data in time. Performing these two operations sequentially involves two separate interpolation steps. Each interpolation step introduces some degree of smoothing or blurring, which degrades the spatial and temporal precision of the final data and can reduce statistical power.\n\nA scientifically superior strategy is to combine both transformations into a single 4D resampling step. This minimizes interpolation-induced blurring by applying only one interpolation kernel to the original raw data to produce the final corrected data.\n\nThe procedure is as follows:\n1.  **Estimate Motion Parameters**: First, estimate the rigid-body transformation parameters (e.g., $3$ translations and $3$ rotations) for each volume relative to a common reference volume (e.g., the first volume or the mean of all volumes). This step estimates the spatial transformation matrix for each time point but does not resample the data.\n2.  **Define Combined Transformation**: For any voxel in the final, corrected 4D dataset at a specific spatio-temporal coordinate $(x', y', z', t'_v)$, we can calculate its corresponding source coordinate in the original, raw 4D dataset $(x, y, z, t)$. The transformation involves:\n    a. **Spatial Mapping**: The spatial coordinate $(x', y', z')$ in the corrected (reference) space is mapped back to its original, unaligned position $(x, y, z)$ using the inverse of the estimated motion transformation for that volume.\n    b. **Temporal Mapping**: The target time for the corrected volume is $t'_v = t_v + t_{\\mathrm{ref}}$. The data for the source voxel at spatial position $(x, y, z)$ was acquired at a slice-specific time $t = t_v + \\Delta t_s$, where $s$ is the slice index corresponding to the $z$ coordinate. The temporal resampling must account for this shift.\n3.  **Perform Single-Step Resampling**: The value for each voxel in the output grid is computed by applying a single 4D interpolation function (e.g., linear, spline, or sinc) to the raw 4D data at the calculated source coordinates. This process effectively applies the spatial motion correction and temporal slice time correction simultaneously, transforming the raw 4D dataset into the final clean 4D dataset in one go.\n\nThis integrated approach is the most accurate as it avoids the compounding of errors from multiple resampling operations, thereby maximally preserving the inherent resolution of the fMRI data.\n\n**Part 3: Numerical Calculation of $t_{\\mathrm{ref}}$**\n\nFrom the derivation in Part 1, the optimal reference time is $t_{\\mathrm{ref}} = TR/2$.\nThe problem provides the Repetition Time:\n$$TR = 2 \\text{ seconds}$$\nSubstituting this value into the formula:\n$$t_{\\mathrm{ref}} = \\frac{2}{2} = 1 \\text{ second}$$\nThe problem requires the answer to be expressed with four significant figures. Therefore, the numerical value is $1.000$ seconds.",
            "answer": "$$\\boxed{1.000}$$"
        }
    ]
}