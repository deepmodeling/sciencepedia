{
    "hands_on_practices": [
        {
            "introduction": "功能性磁共振成像（fMRI）数据呈现为一系列的三维脑体积，但这些体积并非瞬时采集的。每个脑体积内的各切片（slice）是在一个重复时间（$T_R$）内的不同时间点获取的，这导致了时间上的错位。本练习  提供了一个动手实践的机会，您将学习如何根据扫描仪参数精确计算每个切片的采集时间，这是切片时间校正算法的第一步，旨在确保整个大脑数据在时间上的一致性。",
            "id": "4163858",
            "problem": "一名研究人员正在将医学数字成像与通信（DICOM）功能性磁共振成像（fMRI）数据转换为神经影像信息学技术倡议（NIfTI）格式。数据是使用回波平面成像（EPI）技术采集的，采用隔层升序的切片采集方式，单带（无同步多层），且在整个重复时间内每层切片的采集间隔恒定。扫描仪日志显示了以下采集模式：在每个体积（volume）内，首先按升序采集偶数索引的切片，然后按升序采集奇数索引的切片。考虑生成的 NIfTI 体积，其切片编号从 $0$（最下层）到 $N-1$（最上层）。假设血氧水平依赖（BOLD）信号在每个重复时间内以依赖于切片的偏移量采样一次，并且总的切片采集时间跨越整个重复时间。\n\n已知：\n- 重复时间 $T_R = 1.6$ 秒。\n- 切片数 $N = 16$。\n- 隔层升序顺序：在每个体积内为 $\\{0, 2, 4, \\dots, 14, 1, 3, 5, \\dots, 15\\}$。\n\n任务：\n1. 计算长度为 $N$ 的 NIfTI SliceTiming 向量（单位：秒），按切片索引从 $0$ 到 $N-1$ 排序，其中第 $i$ 个条目是切片 $i$ 相对于体积采集开始的时间偏移量（单位：秒）。\n2. 从离散时间采样的定义和傅里叶变换的时移特性出发，简要解释切片时间校正算法如何使用此向量将每个切片的时间序列重采样到一个共同的参考时间。\n\n向量条目以秒为单位表示。使用精确值，不要四舍五入。",
            "solution": "该问题是有效的，因为它具有科学依据、问题明确、客观，并包含足够、一致的信息来推导出唯一解。所描述的场景是功能性磁共振成像（fMRI）数据预处理中的一个标准程序。\n\n总体任务是首先计算给定 fMRI 采集协议的切片采集时间，然后解释切片时间校正的理论基础。\n\n**第 1 部分：计算 SliceTiming 向量**\n\n问题指明，在单个重复时间 $T_R = 1.6$ 秒内采集 $N=16$ 个切片。采集过程跨越整个重复时间，且每层切片的采集间隔恒定。这意味着在采集序列中任意两个连续切片的采集时间间隔是恒定的。这个时间间隔 $\\Delta t$ 可以计算如下：\n$$\n\\Delta t = \\frac{T_R}{N} = \\frac{1.6 \\, \\text{s}}{16} = 0.1 \\, \\text{s}\n$$\n采集顺序被指定为隔层升序，即先采集所有偶数索引的切片，再采集所有奇数索引的切片。切片索引范围为 $0$ 到 $N-1 = 15$。因此，按时间排序的明确采集序列为：\n$$\n\\{0, 2, 4, 6, 8, 10, 12, 14, 1, 3, 5, 7, 9, 11, 13, 15\\}\n$$\n给定切片的采集时间由其在此序列中的位置决定。设序列中的时间位置用 $p$ 表示，其中 $p$ 的范围是从 $0$ 到 $N-1 = 15$。在时间位置 $p$ 采集的切片的时间偏移量为 $p \\times \\Delta t$。\n\n我们需要找到每个切片的采集时间，并按切片索引 $i$ 从 $0$ 到 $15$ 排序。设 $t_i$ 为索引为 $i$ 的切片的采集时间。\n\n对于偶数索引的切片，$i = 2k$，其中 $k \\in \\{0, 1, \\dots, 7\\}$：\n索引为 $i=2k$ 的切片是第 $(k+1)$ 个被采集的切片。其时间位置为 $p=k$。\n因此，其采集时间为：\n$$\nt_{2k} = k \\times \\Delta t = k \\times 0.1 \\, \\text{s}\n$$\n\n对于奇数索引的切片，$i = 2k+1$，其中 $k \\in \\{0, 1, \\dots, 7\\}$：\n这些切片在所有 $N/2=8$ 个偶数切片采集完毕后才被采集。序列中第一个奇数切片的索引是 $1$（对应于 $k=0$），其时间位置为 $p=8$。索引为 $i=2k+1$ 的奇数切片是第 $(k+1)$ 个被采集的奇数切片。其在整个序列中的时间位置是 $p = (N/2) + k = 8 + k$。\n因此，其采集时间为：\n$$\nt_{2k+1} = (8+k) \\times \\Delta t = (8+k) \\times 0.1 \\, \\text{s}\n$$\n\n使用这些公式，我们可以计算出每个切片索引 $i \\in \\{0, 1, \\dots, 15\\}$ 的时间：\n$t_0 = 0 \\times 0.1 = 0.0$ s\n$t_1 = (8+0) \\times 0.1 = 0.8$ s\n$t_2 = 1 \\times 0.1 = 0.1$ s\n$t_3 = (8+1) \\times 0.1 = 0.9$ s\n$t_4 = 2 \\times 0.1 = 0.2$ s\n$t_5 = (8+2) \\times 0.1 = 1.0$ s\n$t_6 = 3 \\times 0.1 = 0.3$ s\n$t_7 = (8+3) \\times 0.1 = 1.1$ s\n$t_8 = 4 \\times 0.1 = 0.4$ s\n$t_9 = (8+4) \\times 0.1 = 1.2$ s\n$t_{10} = 5 \\times 0.1 = 0.5$ s\n$t_{11} = (8+5) \\times 0.1 = 1.3$ s\n$t_{12} = 6 \\times 0.1 = 0.6$ s\n$t_{13} = (8+6) \\times 0.1 = 1.4$ s\n$t_{14} = 7 \\times 0.1 = 0.7$ s\n$t_{15} = (8+7) \\times 0.1 = 1.5$ s\n\nNIfTI SliceTiming 向量就是这些采集时间的列表，按切片索引从 $0$ 到 $15$ 排序。\n\n**第 2 部分：切片时间校正的原理**\n\n上面计算出的 SliceTiming 向量为每个切片 $i$ 提供了相对于体积采集开始的时间偏移量 $t_i$。切片时间校正（STC）算法利用这些信息将每个切片的时间序列重采样到一个共同的参考时间，从而减轻后续分析（例如，事件相关分析）中因假设一个体积内的所有数据都是同时采集而产生的伪影。\n\nSTC 的基本原理植根于离散时间采样和傅里叶变换的时移特性。任何给定体素的 BOLD 信号都是时间的连续函数 $s(t)$。对于切片 $i$ 中的一个体素，该信号在对应于每个体积采集的离散时间点上被采样，但带有一个偏移量 $t_i$。因此，切片 $i$ 中一个体素在 $M$ 个体积内的采样时间序列为 $x_i[k] = s(k T_R + t_i)$，其中 $k=0, 1, \\dots, M-1$。\n\nSTC 的目标是估计信号值，就如同所有切片都在一个共同的参考时间被采集一样。设这个参考时间是相对于体积开始的一个偏移量 $t_{\\text{ref}}$（例如，对于第一个切片，$t_{\\text{ref}}=0$；或者对于采集窗口的中间，$t_{\\text{ref}}=T_R/2$）。我们希望找到值 $x_i^{\\text{corr}}[k] = s(k T_R + t_{\\text{ref}})$。这等同于将原始连续信号 $s(t)$ 平移一个时间量 $\\Delta t_i = t_{\\text{ref}} - t_i$。\n\n连续傅里叶变换的时移特性指出，如果一个信号 $f(t)$ 的傅里叶变换是 $F(\\omega)$，那么时移后的信号 $f(t - \\tau)$ 的傅里叶变换是 $F(\\omega) \\exp(-j\\omega\\tau)$。这个特性提供了一种执行非整数时间平移的直接方法，这对于 STC 来说通常是必需的，因为所需的平移量 $\\Delta t_i$ 不一定是采样间隔 $T_R$ 的整数倍。\n\nSTC 算法的步骤如下：\n1. 对每个体素的时间序列 $x_i[k]$ 计算其离散傅里叶变换（DFT），得到频域表示 $X_i[m]$，其中 $m$ 是频率索引。\n2. 对每个频率分量 $m$ 应用一个相移。为了将信号在时间上平移 $\\Delta t_i = t_{\\text{ref}} - t_i$，将复数值 $X_i[m]$ 乘以一个相位因子 $\\exp(-j \\omega_m \\Delta t_i)$，其中 $\\omega_m = \\frac{2\\pi m}{M T_R}$ 是对应于索引 $m$ 的角频率。校正后的频域信号是 $X_i^{\\text{corr}}[m] = X_i[m] \\exp\\left(-j \\frac{2\\pi m}{M T_R} \\Delta t_i\\right)$。\n3. 计算 $X_i^{\\text{corr}}[m]$ 的离散傅里叶逆变换（IDFT），以获得校正后的时域信号 $x_i^{\\text{corr}}[k]$。这个新的时间序列代表了重采样到共同参考时间 $t_{\\text{ref}}$ 的 BOLD 信号。\n\n这种基于傅里叶的插值在理论上等同于在时域中与 sinc 函数进行卷积，这是对带限信号进行重采样的理想方法。因此，SliceTiming 向量是关键的输入，它为每个切片指定了所需的平移量 $\\Delta t_i$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.0  0.8  0.1  0.9  0.2  1.0  0.3  1.1  0.4  1.2  0.5  1.3  0.6  1.4  0.7  1.5 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "除了时间偏移，fMRI数据还容易受到由磁场不均匀性引起的空间畸变的影响。本练习  深入探讨了回波平面成像（EPI）的物理原理，以揭示这些畸变是如何产生和量化的。通过推导像`TotalReadoutTime`这样的关键BIDS（脑成像数据结构）标准参数，并理解它们的作用，您将学会如何计算这些空间位移的大小，这是“解扭曲”脑图像的关键一步。",
            "id": "4163811",
            "problem": "一名研究人员正在使用脑成像数据结构（BIDS）为一个功能性磁共振成像（fMRI）数据集进行磁敏感伪影校正的准备工作。该序列是二维的回波平面成像（EPI），并且用于单次运行的 DICOM（医学数字成像与通信）头文件包含以下字段：\n\n- InPlanePhaseEncodingDirection = \"COL\"\n- 厂商特定的布尔字段，指示沿相位编码轴的 blip 极性（负）\n- ImageOrientationPatient 方向余弦：行 $(1, 0, 0)$，列 $(0, 1, 0)$，层 $(0, 0, 1)$，用于轴向采集\n- EffectiveEchoSpacing $t_{\\mathrm{esp}} = 5.8 \\times 10^{-4}$ s\n- ReconMatrixPE $N_{\\mathrm{PE}} = 96$\n- 沿相位编码方向的体素大小 $\\Delta y = 2.0$ mm\n\n假设已使用标准的右-前-上（RAS）约定，将数据转换为神经影像信息学技术倡议（NIfTI）格式，其中体素索引轴 $(i, j, k)$ 分别对应于左-右、后-前和下-上方向。该研究人员还有一个独立估计的离共振图，提供了由静态磁场不均匀性引起的局部频率偏移 $\\Delta f$（单位为赫兹）。\n\n从 EPI k 空间采样和磁共振离共振物理学的第一性原理出发，并仅使用上述信息：\n\n1. 以 EffectiveEchoSpacing $t_{\\mathrm{esp}}$ 和相位编码样本数 $N_{\\mathrm{PE}}$ 为变量，推导 BIDS 字段 TotalReadoutTime $T_{\\mathrm{ro}}$ 的表达式。\n2. 使用傅里叶位移定理和离共振频率 $\\Delta f$（在信号模型中定义为恒定的附加角频率）的定义，推导 $\\Delta f$、$T_{\\mathrm{ro}}$ 与沿相位编码方向的位移（以体素为单位，然后以毫米为单位）之间的关系。\n3. 使用提供的 DICOM 字段和方向，定性地论证 BIDS PhaseEncodingDirection 值的合理性（无需报告该值；您只需用它来确定发生位移的轴），并解释为什么 $T_{\\mathrm{ro}}$ 和 PhaseEncodingDirection 对于从 $\\Delta f$ 估计磁敏感引起的位移幅度是必要且充分的。\n4. 对于一个 $\\Delta f = 120$ Hz 的体素，使用推导出的表达式和提供的参数，计算沿相位编码方向的位移幅度（以毫米为单位）。将最终数值答案四舍五入到四位有效数字。以毫米表示最终位移。",
            "solution": "问题陈述具有科学依据，提法明确，并包含足够且一致的信息来推导所需的关系并计算最终的数值答案。所有提供的参数对于 fMRI 中的回波平面成像（EPI）序列都是物理上真实的。因此，该问题是有效的，可以构建解决方案。\n\n解决方案的结构是按顺序解决问题的四个部分。\n\n## 1. TotalReadoutTime ($T_{\\mathrm{ro}}$) 的推导\n\n`TotalReadoutTime`（表示为 $T_{\\mathrm{ro}}$）是 BIDS 标准中描述磁敏感失真的一个关键参数。它定义为在 EPI 序列中，从采集第一个回波的中心到采集最后一个回波的中心所经过的时间。\n\n`EffectiveEchoSpacing`（表示为 $t_{\\mathrm{esp}}$）代表在相位编码方向上两个连续回波中心之间的时间。对于 2D EPI 序列，这是在 k 空间中采样连续行之间的时间。\n\n`ReconMatrixPE`（表示为 $N_{\\mathrm{PE}}$）给出了相位编码的总步数，这对应于在该维度上为形成图像而采集的 k 空间行数。\n\n如果有 $N_{\\mathrm{PE}}$ 个回波（或 k 空间行），则它们之间有 $N_{\\mathrm{PE}} - 1$ 个间隔。由于每个间隔的持续时间为 $t_{\\mathrm{esp}}$，因此从第一个回波到最后一个回波的总时间是间隔数与每个间隔持续时间的乘积。\n\n因此，`TotalReadoutTime` 的表达式为：\n$$T_{\\mathrm{ro}} = (N_{\\mathrm{PE}} - 1) \\times t_{\\mathrm{esp}}$$\n\n## 2. 位移关系的推导\n\nEPI 中的磁敏感引起的失真源于局部磁场不均匀性，这种不均匀性通过离共振频率 $\\Delta f$ 来量化。这种离共振会在测量的 MR 信号中引起一个随时间变化的相位误差。在存在离共振 $\\Delta f$ 的情况下，位于位置 $\\vec{r}$、自旋密度为 $\\rho(\\vec{r})$ 的自旋产生的信号 $S$ 会被一个相位项 $\\exp(-i 2\\pi \\Delta f t)$ 调制：\n$$S(t) \\propto \\rho(\\vec{r}) \\exp(-i \\phi_{\\text{spatial}}(t)) \\exp(-i 2\\pi \\Delta f t)$$\n其中 $\\phi_{\\text{spatial}}(t)$ 是由成像梯度赋予的相位。\n\n在 EPI 中，k 空间是逐行遍历的。假设相位编码方向用 y 轴表示。采集 k 空间某一行的时间 $t$ 与其沿相位编码轴的位置 $k_y$ 成线性比例关系。因此，由 $\\Delta f$ 引起的相位误差在 k 空间中表现为沿 $k_y$ 方向添加的线性相位斜坡。\n\n根据傅里叶位移定理，频域（k 空间）中的线性相移对应于图像域中的空间位移。具体来说，如果函数 $f(y)$ 的傅里叶变换是 $F(k_y)$，那么函数 $f(y-y_0)$ 的傅里叶变换是 $F(k_y) \\exp(-i k_y y_0)$。\n\n离共振项 $\\exp(-i 2\\pi \\Delta f t)$ 可以在此背景下解释。时间 $t$ 与 $k_y$ 耦合。在相位编码方向的整个采集中（总共耗时 $T_{\\mathrm{ro}}$），k 空间被采样。我们可以在相位编码方向上定义一个“每像素带宽”$BW_{\\mathrm{PE}}$。这是一个体素宽度所对应的频率范围。$BW_{\\mathrm{PE}}$ 是执行相位编码的总时间（即 `TotalReadoutTime`）的倒数：\n$$BW_{\\mathrm{PE}} = \\frac{1}{T_{\\mathrm{ro}}} = \\frac{1}{(N_{\\mathrm{PE}} - 1) t_{\\mathrm{esp}}}$$\n重建算法会将离共振频率 $\\Delta f$ 误解为一个位移。这个位移的幅度，以体素为单位（$\\delta_{\\mathrm{vxl}}$），是离共振频率与该方向上每像素带宽的比值：\n$$\\delta_{\\mathrm{vxl}} = \\frac{\\Delta f}{BW_{\\mathrm{PE}}}$$\n代入 $BW_{\\mathrm{PE}}$ 的表达式，我们得到以体素为单位的位移：\n$$\\delta_{\\mathrm{vxl}} = \\Delta f \\cdot T_{\\mathrm{ro}} = \\Delta f \\cdot (N_{\\mathrm{PE}} - 1) t_{\\mathrm{esp}}$$\n要将此位移从体素转换为物理单位（如毫米），我们乘以沿相位编码方向的体素大小 $\\Delta y$：\n$$\\delta_{\\mathrm{mm}} = \\delta_{\\mathrm{vxl}} \\cdot \\Delta y = \\Delta f \\cdot T_{\\mathrm{ro}} \\cdot \\Delta y$$\n这就是离共振频率 $\\Delta f$、总读出时间 $T_{\\mathrm{ro}}$ 和最终产生的空间位移（以毫米为单位）之间的基本关系。\n\n## 3. BIDS 字段 `PhaseEncodingDirection` 和 `TotalReadoutTime` 的合理性论证\n\n问题陈述指出 DICOM 字段 `InPlanePhaseEncodingDirection` 是 `\"COL\"`。对于 2D 采集，这意味着相位编码是沿着图像矩阵的列进行的。对于轴向采集，`ImageOrientationPatient` 的方向余弦被指定为行 $(1, 0, 0)$ 和列 $(0, 1, 0)$。在标准的 NIfTI RAS（右-前-上）坐标系中，图像矩阵轴 $(i, j, k)$ 通常分别对应于左-右（L-R）、后-前（P-A）和下-上（I-S）解剖方向。矩阵的列对应于第二个维度，即 $j$ 轴。因此，相位编码是沿着 NIfTI 的 $j$ 轴进行的，该轴与患者的后-前（P-A）轴对齐。这证明了 BIDS 的 `PhaseEncodingDirection` 可以是 `j` 或 `j-`（符号取决于 blip 极性，题目中给出的是负极性，意味着方向是 `j-`，尽管问题不要求报告这个值）。\n\n对于估计位移幅度而言，`PhaseEncodingDirection` 和 `TotalReadoutTime` 的必要性和充分性解释如下：\n\n- **`PhaseEncodingDirection` 的必要性**：EPI 中磁敏感引起的失真这一物理现象，导致像素位移*仅*沿着相位编码方向发生。这是因为由 $\\Delta f$ 引起的相位误差是在对相位编码方向上不同 k 空间行进行采样的相对较长的时间内累积的。读出方向的采样速度要快得多，因此与时间相关的相位误差可以忽略不计。因此，要对此失真进行建模或校正，必须知道位移发生的轴向。`PhaseEncodingDirection` 提供了这一关键信息。\n\n- **`TotalReadoutTime` 的必要性**：如第 2 部分所推导，位移的幅度（以体素为单位）与 $T_{\\mathrm{ro}}$ 成正比。此参数量化了离共振相位误差累积的总时间窗口，这些误差随后在图像重建过程中通过傅里叶变换被混叠成空间错位。没有 $T_{\\mathrm{ro}}$，从给定的离共振频率 $\\Delta f$ 到空间位移幅度的映射就是不确定的。\n\n- **充分性**：为了*估计位移幅度*，这两个参数是充分的。给定一个为每个体素提供 $\\Delta f$ 的离共振图，`PhaseEncodingDirection` 确定了位移的轴（例如 P-A 轴），而 `TotalReadoutTime` 允许使用公式 $\\delta_{\\mathrm{vxl}} = \\Delta f \\cdot T_{\\mathrm{ro}}$ 计算沿该轴的位移幅度。这提供了一个完整的体素位移图，它是失真校正的基础。\n\n## 4. 位移幅度的计算\n\n我们需要为具有特定离共振频率的体素计算位移幅度（以毫米为单位）。\n\n给定的参数是：\n- 离共振频率, $\\Delta f = 120$ Hz\n- 有效回波间距, $t_{\\mathrm{esp}} = 5.8 \\times 10^{-4}$ s\n- 相位编码步数, $N_{\\mathrm{PE}} = 96$\n- 沿相位编码方向的体素大小, $\\Delta y = 2.0$ mm\n\n首先，我们计算 `TotalReadoutTime`, $T_{\\mathrm{ro}}$：\n$$T_{\\mathrm{ro}} = (N_{\\mathrm{PE}} - 1) t_{\\mathrm{esp}} = (96 - 1) \\times (5.8 \\times 10^{-4} \\text{ s}) = 95 \\times 5.8 \\times 10^{-4} \\text{ s} = 0.0551 \\text{ s}$$\n接下来，我们使用推导出的关系计算位移幅度（以毫米为单位），$\\delta_{\\mathrm{mm}}$：\n$$\\delta_{\\mathrm{mm}} = \\Delta f \\cdot T_{\\mathrm{ro}} \\cdot \\Delta y$$\n代入数值：\n$$\\delta_{\\mathrm{mm}} = (120 \\text{ Hz}) \\cdot (0.0551 \\text{ s}) \\cdot (2.0 \\text{ mm})$$\nHz（即 $s^{-1}$）与 $s$ 的乘积得到一个无量纲量，代表以体素为单位的位移：\n$$\\delta_{\\mathrm{vxl}} = 120 \\times 0.0551 = 6.612$$\n那么，以毫米为单位的位移是：\n$$\\delta_{\\mathrm{mm}} = 6.612 \\times 2.0 \\text{ mm} = 13.224 \\text{ mm}$$\n问题要求将最终答案四舍五入到四位有效数字。\n$$\\delta_{\\mathrm{mm}} \\approx 13.22 \\text{ mm}$$\n这表示超过 1.3 厘米的显著空间失真，对于具有高磁敏感梯度和大离共振的区域来说，这是一个符合实际的数值。",
            "answer": "$$ \\boxed{13.22} $$"
        },
        {
            "introduction": "fMRI中的一个主要噪声来源是与神经活动无关的缓慢信号漂移。本练习  介绍了一种在通用线性模型（GLM）框架内，使用离散余弦变换（DCT）去除这种低频噪声的强大技术。您将学习如何构建这些用于“清洗”数据的数学基函数，并理解它们如何通过建模并剔除信号中不必要的变异成分来实现高通滤波。",
            "id": "4163890",
            "problem": "一次功能性磁共振成像（fMRI）扫描序列包含 $N=750$ 个体积（volumes），以重复时间 $TR=0.8$ s 进行采样，因此总采集持续时间为 $T=N \\cdot TR$。为了在通用线性模型（GLM）的预处理过程中去除低频漂移，构建一个基于离散余弦变换（DCT）的高通滤波器。该滤波器通过包含一组正交归一的余弦基函数来实现，这些基函数的时间周期大于或等于指定的截止值 $128$ s。\n\n从第一性原理出发，利用离散时间 $n \\in \\{0,1,\\dots,N-1\\}$ 上第二类离散余弦变换（DCT-II）基的基本定义和正交归一性要求，推导整数模式索引 $k \\geq 0$ 的归一化滤波器系数（基列）$b_{k}[n]$。将整数索引 $k$ 与 $b_{k}[n]$ 在持续时间为 $T$ 的观测窗口内的隐含时间周期 $P_{k}$ 联系起来，并确定使得 $P_{K} \\geq 128$ s 的最大整数 $K$。解释在 GLM 预处理流程中，将 $\\{b_{k}[n]\\}_{k=0}^{K}$ 作为无关回归量如何实现高通滤波，并阐明其投影解释。\n\n将您的最终答案表示为 $K$ 的整数值。无需四舍五入。最终答案框中不提供单位。",
            "solution": "该问题要求推导用于 fMRI 分析的、使用离散余弦变换（DCT）的高通滤波器回归量，根据指定的周期截止值确定此类回归量的数量，并解释在通用线性模型（GLM）框架内的滤波机制。\n\n首先，我们验证问题陈述。\n\n### 第 1 步：提取已知条件\n- 体积数（时间点数）：$N=750$。\n- 重复时间：$TR=0.8$ s。\n- 总采集持续时间：$T = N \\cdot TR$。\n- 滤波方法：使用一组 DCT 基函数进行高通滤波。\n- 周期截止值：所包含的基函数的时间周期必须大于或等于 $128$ s。\n- DCT 类型：第二类离散余弦变换（DCT-II）。\n- 时间索引：$n \\in \\{0, 1, \\dots, N-1\\}$。\n- 基函数表示法：$b_k[n]$，其中整数模式索引 $k \\geq 0$。\n- 要求输出：推导归一化的 $b_k[n]$，$k$ 与周期 $P_k$ 之间的关系，无关回归量集合 $\\{b_k[n]\\}_{k=0}^{K}$ 的最大整数 $K$，以及对滤波机制的解释。\n\n### 第 2 步：使用提取的已知条件进行验证\n该问题具有科学依据，描述了 fMRI 预处理中一种标准且广泛使用的技术（在 GLM 中通过无关回归实现高通滤波，正如在 SPM 等软件中实现的那样）。所有术语都是信号处理和神经科学领域的标准术语。问题是适定的，提供了计算 $K$ 的唯一整数解所需的所有参数（$N$、$TR$、截止周期）。语言客观、精确。问题有效。\n\n### 第 3 步：推导与求解\n\n**1. 正交归一的 DCT-II 基函数**\n\n长度为 $N$ 的序列 $x[n]$ 的 DCT-II 变换由其基函数定义。未归一化的基函数，即 DCT-II 矩阵的列，由下式给出：\n$$c_k[n] = \\cos\\left[\\frac{\\pi k}{N}\\left(n + \\frac{1}{2}\\right)\\right]$$\n其中离散时间索引 $n \\in \\{0, 1, \\dots, N-1\\}$，频率索引 $k \\in \\{0, 1, \\dots, N-1\\}$。\n\n为了用作正交归一的回归量，这些基函数必须被归一化，使其内积满足 $\\sum_{n=0}^{N-1} b_k[n] b_j[n] = \\delta_{kj}$，其中 $\\delta_{kj}$ 是克罗内克 δ。这需要将每个向量 $c_k$ 除以其欧几里得范数 $\\|c_k\\| = \\sqrt{\\sum_{n=0}^{N-1} (c_k[n])^2}$。\n\n对于 $k=0$ 的情况：\n$$c_0[n] = \\cos(0) = 1$$\n范数的平方为：\n$$\\|c_0\\|^2 = \\sum_{n=0}^{N-1} 1^2 = N$$\n归一化常数为 $1/\\sqrt{N}$。\n\n对于 $k \\in \\{1, 2, \\dots, N-1\\}$ 的情况：\n范数的平方为：\n$$\\|c_k\\|^2 = \\sum_{n=0}^{N-1} \\cos^2\\left[\\frac{\\pi k}{N}\\left(n + \\frac{1}{2}\\right)\\right]$$\n使用恒等式 $\\cos^2(\\theta) = \\frac{1}{2}(1 + \\cos(2\\theta))$：\n$$\\|c_k\\|^2 = \\sum_{n=0}^{N-1} \\frac{1}{2}\\left(1 + \\cos\\left[\\frac{2\\pi k}{N}\\left(n + \\frac{1}{2}\\right)\\right]\\right) = \\frac{N}{2} + \\frac{1}{2}\\sum_{n=0}^{N-1}\\cos\\left(\\frac{2\\pi k n}{N} + \\frac{\\pi k}{N}\\right)$$\n求和项是复指数几何级数的实部，对于 $1 \\le k  N$，其和为零。因此：\n$$\\|c_k\\|^2 = \\frac{N}{2}$$\n归一化常数为 $\\sqrt{2/N}$。\n\n因此，正交归一的 DCT-II 基函数 $b_k[n]$ 为：\n$$\nb_k[n] = \\begin{cases}\n\\sqrt{\\frac{1}{N}}  \\text{当 } k=0 \\\\\n\\sqrt{\\frac{2}{N}} \\cos\\left[\\frac{\\pi k}{N}\\left(n + \\frac{1}{2}\\right)\\right]  \\text{当 } k \\in \\{1, 2, \\dots, N-1\\}\n\\end{cases}\n$$\n\n**2. 索引 k 与时间周期 Pk 之间的关系**\n\n当 $k0$ 时，基函数 $b_k[n]$ 是一个采样的余弦波。“数字”角频率是 $\\Omega_k = \\frac{\\pi k}{N}$ 弧度/样本。样本之间的物理时间是重复时间 $TR$。连续时间角频率 $\\omega_k$ 通过 $\\omega_k = \\Omega_k / TR$ 与数字频率相关联。\n$$\\omega_k = \\frac{\\pi k}{N \\cdot TR}$$\n时间周期 $P_k$ 通过 $P_k = 2\\pi / \\omega_k$ 与角频率相关。\n$$P_k = \\frac{2\\pi}{\\left(\\frac{\\pi k}{N \\cdot TR}\\right)} = \\frac{2 N \\cdot TR}{k}$$\nfMRI 扫描的总持续时间为 $T = N \\cdot TR$。将此代入 $P_k$ 的表达式中：\n$$P_k = \\frac{2T}{k}$$\n此公式表明，索引为 $k$ 的基函数在总采集时间 $T$ 内完成 $k/2$ 个周期。对于 $k=1$，周期为 $P_1 = 2T$，对应于在该区间内完成半个余弦周期。对于 $k=0$，基函数是一个常数（直流分量），其周期形式上是无限的，$P_0 = \\infty$。\n\n**3. 确定最大整数 K**\n\n给定参数：\n$N=750$\n$TR=0.8$ s\n\n首先，我们计算总采集持续时间 $T$：\n$$T = N \\cdot TR = 750 \\cdot 0.8 \\text{ s} = 600 \\text{ s}$$\n第 $k$ 个基函数的周期是：\n$$P_k = \\frac{2T}{k} = \\frac{2 \\cdot 600 \\text{ s}}{k} = \\frac{1200}{k} \\text{ s}$$\n高通滤波器是通过包含所有周期大于或等于 $128$ s 截止值的基函数 $\\{b_k[n]\\}$ 来构建的。我们需要找到最大的整数索引 $K$，使得无关回归量集合为 $\\{b_k[n]\\}_{k=0}^{K}$。这意味着我们必须找到满足条件 $P_k \\geq 128$ s 的最大整数 $k$（我们称之为 $K$）。\n\n对于 $k=0$，$P_0 = \\infty$，满足 $\\infty \\geq 128$ s。所以 $k=0$ 的回归量被包括在内。\n对于 $k  0$，我们有不等式：\n$$\\frac{1200}{k} \\geq 128$$\n因为 $k$ 是一个正整数，我们可以将不等式两边同乘以 $k$ 而不改变不等号方向：\n$$1200 \\geq 128k$$\n$$k \\leq \\frac{1200}{128}$$\n让我们简化这个分数：\n$$\\frac{1200}{128} = \\frac{300}{32} = \\frac{75}{8} = 9.375$$\n条件是 $k \\leq 9.375$。由于 $k$ 必须是整数，因此 $k$ 可能的正整数值为 $1, 2, 3, 4, 5, 6, 7, 8, 9$。\n满足该标准的最大整数索引是 $k=9$。\n因此，要包含的回归量对应的索引为 $k = 0, 1, \\dots, 9$。问题要求的是集合 $\\{b_k[n]\\}_{k=0}^{K}$ 中的最大整数 $K$，即 $K=9$。\n\n**4. GLM 中的滤波机制**\n\nfMRI 分析中的通用线性模型（GLM）将来自单个体素的时间序列数据 $Y$ 建模为预测变量的线性组合加上误差：\n$$Y = X\\beta + \\epsilon$$\n这里，$Y$ 是 $N \\times 1$ 的 fMRI 数据向量，$X$ 是 $N \\times P$ 的设计矩阵（有 $P$ 个回归量），$\\beta$ 是 $P \\times 1$ 的待估计参数向量，$\\epsilon$ 是 $N \\times 1$ 的残差向量。\n\n为了实现高通滤波，设计矩阵 $X$ 通过加入低频 DCT 基函数作为无关回归量来进行增广。设计矩阵的形式为：\n$$X = [X_{\\text{interest}} \\quad X_{\\text{nuisance}}]$$\n其中 $X_{\\text{interest}}$ 包含对实验任务的预期 BOLD 响应进行建模的回归量，而 $X_{\\text{nuisance}}$ 包含低频漂移分量：\n$$X_{\\text{nuisance}} = [b_0 \\quad b_1 \\quad \\dots \\quad b_K]$$\n其中 $b_k$ 是表示基函数 $b_k[n]$ 的列向量。在我们的例子中，$K=9$。\n\n参数 $\\beta$ 通常使用普通最小二乘法（OLS）进行估计，得到 $\\hat{\\beta} = (X^TX)^{-1}X^TY$。关键的理解是，这个估计过程有效地将数据 $Y$ 中的方差“划分”给 $X$ 中的不同回归量。通过将列 $\\{b_k\\}_{k=0}^K$ 包含在模型中，fMRI 信号中任何与这些低频余弦函数系统性协变的方差都会归因于它们。\n\n投影解释如下：OLS 拟合 $\\hat{Y} = X\\hat{\\beta}$ 是数据向量 $Y$ 在由设计矩阵 $X$ 的列所张成的向量空间（子空间）上的正交投影。这个子空间，我们称之为 $\\mathcal{C}(X)$，是感兴趣的回归量张成的子空间 $\\mathcal{C}(X_{\\text{interest}})$ 和无关回归量张成的子空间 $\\mathcal{C}(X_{\\text{nuisance}})$ 的和。\n当我们检验关于与 $X_{\\text{interest}}$ 相关参数的假设时，GLM 程序在考虑了所有其他回归量（包括无关回归量）所解释的方差之后，有效地分离出这些回归量的独特贡献。这等效于首先将数据 $Y$ 和感兴趣的回归量 $X_{\\text{interest}}$ 投影到与无关回归量张成的空间正交的子空间上，然后进行回归。这种正交化从数据中移除了任何可以被 DCT 基组建模的低频信号分量，从而实现高通滤波。随后的统计分析便在“清除”了这些低频漂移的信号上进行。",
            "answer": "$$\\boxed{9}$$"
        }
    ]
}