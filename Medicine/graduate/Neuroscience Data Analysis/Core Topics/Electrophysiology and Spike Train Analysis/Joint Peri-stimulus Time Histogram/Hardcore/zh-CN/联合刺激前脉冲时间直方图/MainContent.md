## 引言
在探索大脑如何处理信息的征途中，理解单个神经元的活动已不再足够。真正的挑战在于揭示大量神经元如何协同工作，形成复杂的[群体编码](@entry_id:909814)。传统的周边刺激时间[直方图](@entry_id:178776)（PSTH）虽然能描绘单个神经元对刺激的平均响应，却忽略了神经元之间至关重要的相互作用。为了填补这一知识空白，联合周边刺激时间[直方图](@entry_id:178776)（Joint Peri-stimulus Time Histogram, JPSTH）应运而生，它是一种强大的分析工具，专门用于量化神经元对之间随时间动态变化的协同发放模式。与假设神经元相关性不随时间变化的互相关图不同，JPSTH能够捕捉在刺激过程中相关性结构的演化，从而提供对网络动态更深刻的见解。

本文将系统地引导您掌握[JPSTH](@entry_id:1126845)的核心知识与应用。在第一章“原理与机制”中，我们将深入探讨[JPSTH](@entry_id:1126845)的数学基础，重点学习如何构建JPSTH矩阵，以及如何通过关键的“移位预测子”校正方法，将反映真实网络耦合的“噪声相关”从由刺激驱动的“信号相关”中分离出来。接着，在第二章“应用与跨学科联系”中，我们将展示[JPSTH](@entry_id:1126845)在解读神经环路、推断[功能连接](@entry_id:196282)以及与信息论、网络科学等领域交叉应用中的巨大威力。最后，在“动手实践”部分，您将通过具体的编程和分析练习，将理论知识转化为解决实际问题的能力。通过这一系列的学习，您将能够自信地运用[JPSTH](@entry_id:1126845)来揭示神经数据中隐藏的协同奥秘。

## 原理与机制

在神经科学中，理解神经元群体如何协同编码信息是核心挑战之一。虽然单个神经元的发放率（由**周边刺激时间直方图 (Peri-Stimulus Time Histogram, PSTH)** 所量化）揭示了其对刺激的平均响应，但神经元之间的相互作用包含了更丰富的网络动态信息。**联合周边刺激时间直方图 (Joint Peri-stimulus Time Histogram, [JPSTH](@entry_id:1126845))** 是一种强大的分析工具，专门用于揭示和量化在重复刺激实验中，两个神经元在时间上的协同发放模式。本章将深入探讨 [JPSTH](@entry_id:1126845) 的基本原理、其与[相关分析](@entry_id:265289)方法的区别、校正机制以及如何从其复杂的二维结构中解读潜在的生理机制。

### 联合发放概率的二维表征

JPSTH 的核心思想是构建一个二维矩阵，其坐标轴为相对于刺激开始的[绝对时间](@entry_id:265046)。矩阵中的每个元素 $(t_1, t_2)$ 代表了在大量重复试验中，神经元1在时间 $t_1$ 附近发放脉冲且神经元2在时间 $t_2$ 附近发放脉冲的联合概率或频次。形式上，如果我们将试验窗口划分为宽度为 $\Delta t$ 的小时间仓，JPSTH 矩阵的一个元素 $J(t_1, t_2)$ 就是对所有试验中，神经元1在时间仓 $t_1$ 内的发放数与神经元2在时间仓 $t_2$ 内的发放数的乘积进行累加。

这个二维表征与更传统的一维**[互相关图](@entry_id:1123225) (cross-correlogram, CCG)** 有着本质的区别。CCG 通过将一个神经元的脉冲时间相对于另一个神经元的[脉冲时间](@entry_id:1132155)对齐，并对所有时间点进行平均，来计算在不同时间延迟 $\tau = t_2 - t_1$ 下的脉冲偶合概率。因此，CCG 是一个关于时间**延迟** $\tau$ 的一维函数，它假设神经元之间的相关性结构在整个分析窗口内是**平稳的 (stationary)**。

然而，在 stimulus-evoked activity 中，神经元的相关性很可能不是平稳的。例如，一个刺激可能在早期诱发同步发放，而在[后期](@entry_id:165003)由于[反馈抑制](@entry_id:136838)而导致发放回避。在这种情况下，一维的 CCG 会将正相关和负相关效应平均掉，可能导致掩盖或完全抵消真实的、随时间变化的动态相互作用 。[JPSTH](@entry_id:1126845) 作为 $(t_1, t_2)$ **[绝对时间](@entry_id:265046)**的函数，保留了这种时间分辨信息，使其能够捕捉到试验过程中相关性结构的动态演化。从数学上看，标准的 CCG 可以通过对 [JPSTH](@entry_id:1126845) 矩阵沿[反对角线](@entry_id:155920)（即 $t_2 - t_1 = \tau$ 为常数的线）求和得到。因此，[JPSTH](@entry_id:1126845) 是一个比 CCG 更为基础和信息更丰富的统计量 。

### 分解相关性：[信号相关](@entry_id:274796)与噪声相关

原始的 JPSTH 矩阵 $J(t_1, t_2)$ 捕捉了所有形式的联合发放，但这些联合发放源于两种截然不同的机制。理解这两者的区别对于正确解释[神经编码](@entry_id:263658)至关重要。

1.  **[信号相关](@entry_id:274796) (Signal Correlation)**：这种相关性源于两个神经元都以一种锁时于刺激的方式改变其发放率。例如，如果一个刺激使得两个神经元都在刺激后 $50 \text{ ms}$ 到 $100 \text{ ms}$ 之间提高其平均发放率（即它们的 PSTH 都在此时段有峰值），那么仅仅由于概率，我们就会期望在这一时段观察到更多的联合发放。这种由共享的、锁时于刺激的驱动所引起的联合发放模式，反映的是神经元对信号的**独立**响应的疊加，而非它们之间的直接相互作用。

2.  **[噪声相关](@entry_id:1128753) (Noise Correlation)**：这种相关性指的是在控制了平均刺激响应（即 PSTH）之后， trial-by-trial 的发放变异性中所存在的相关性。它源于神经元之间直接的突触连接、共享的来自其他神经元的非锁时输入，或是受共同的、缓慢的脑状态（如注意力或唤醒水平）波动的影响。这些是在单个试验层面发生的相互作用，反映了网络的内在动态。

原始 [JPSTH](@entry_id:1126845) 矩阵混合了这两种相关性。例如，在许多感觉皮层的记录中，原始 [JPSTH](@entry_id:1126845) 常常呈现出沿主对角线 ($t_1 \approx t_2$) 的一个宽阔的隆起带。这通常主要反映了信号相关：因为两个神经元对刺激的响应时间进程相似，它们的 PSTH 形状也相似，导致其乘积在对角线附近出现高峰 。为了揭示真正反映网络连接的[噪声相关](@entry_id:1128753)，我们必须从原始 [JPSTH](@entry_id:1126845) 中移除[信号相关](@entry_id:274796)的贡献。

### 校正方法：移位预测子

从原始 JPSTH 中分离[噪声相关](@entry_id:1128753)性的标准方法是使用**移位预测子 (shift-predictor)** 或**试验混洗预测子 (trial-shuffling predictor)**。该方法的核心思想是构建一个“虚假”的 [JPSTH](@entry_id:1126845)，它只包含[信号相关](@entry_id:274796)，而不包含任何 trial-by-trial 的[噪声相关](@entry_id:1128753)。

这是通过将一个神经元在第 $k$ 次试验中的[脉冲序列](@entry_id:1132157)与另一个神经元在**不同**的第 $j$ 次试验（$j \neq k$）中的[脉冲序列](@entry_id:1132157)进行相关计算来实现的。由于试验之间的噪声波动被认为是独立的，这种跨试验的配对打破了所有真实的 trial-by-trial 耦合。然而，由于每次试验中的刺激是相同的，这种混洗操作保留了每个神经元锁时于刺激的平均发放率（PSTH）。因此，通过对所有可能的非匹配试验对 $(k, j)$ 进行平均，我们得到的[移位](@entry_id:145848)预测子 JPSTH，$J_{\text{pred}}(t_1, t_2)$，就成为了信号相关的一个良好估计。在数学上，它近似于两个神经元 PSTH 的乘积 。

在实践中，一个常用的构造方法是将神经元1在试验 $k$ 的数据与神经元2在试验 $k+1$ 的数据配对（$k=1, \dots, K-1$）。在试验独立且响应平稳的假设下，这个估计量是 PSTH 乘积的无偏估计。为了处理边界，可以使用“循环包裹”(circular wrapping)，即将第 $K$ 次试验与第 $1$ 次试验配对，这样可以利用所有数据并同样得到无偏估计 。

一个更稳健的预测子可以通过多次随机地重排一个神经元的试验顺序并平均结果来获得。这相比于单一的相邻试验配对，能提供一个方差更低的估计，因为它利用了更多样化的试验组合 。

在统计上，如果我们将脉冲发放建模为条件[非齐次泊松过程](@entry_id:1128851)，其在试验 $k$ 和时间 $t$ 的瞬时发放率为 $\lambda_i(t)$，且两个神经元在给定 stimulus-locked rates 的条件下是独立的，那么移位预测子 $S(t_1,t_2) = \sum_{k=1}^{K} x_{1}^{(k)}(t_{1})\,x_{2}^{(\pi(k))}(t_{2})$（其中 $x_i^{(k)}(t)$ 是时间仓内的脉冲计数，$\pi$ 是试验索引的一个置换）的[期望值](@entry_id:150961)为 $\mathbb{E}[S(t_{1},t_{2})] = K\lambda_{1}(t_{1})\lambda_{2}(t_{2})\Delta^{2}$。其方差为 $\mathrm{Var}[S(t_{1},t_{2})] = K\lambda_{1}(t_{1})\lambda_{2}(t_{2})\Delta^{2}(1 + \lambda_{1}(t_{1})\Delta + \lambda_{2}(t_{2})\Delta)$ 。这为该预测子的统计特性提供了坚实的理论基础。

### 解读残差 JPSTH

通过从原始 [JPSTH](@entry_id:1126845) 中减去移位预测子，我们得到了**残差 JPSTH (residual JPSTH)**，有时也称为**协方差 JPSTH** 或**锚定 [JPSTH](@entry_id:1126845) (anchored [JPSTH](@entry_id:1126845))**：

$J_{\text{res}}(t_1, t_2) = J_{\text{raw}}(t_1, t_2) - J_{\text{pred}}(t_1, t_2)$

这个残差矩阵中的每个元素，代表了在时间点 $(t_1, t_2)$ 观察到的联合发放数与纯粹基于平均发放率所预期的联合发放数之间的差异（超出或不足的数量）。因此，残差 [JPSTH](@entry_id:1126845) 揭示了噪声相关的结构。事实上，它可以被证明等价于在每个时间仓对 $(t_1, t_2)$ 上，两个神经元发放计数序列的跨试验协方差 。

例如，让我们计算一个具体的残差值。假设在5次试验中，两个神经元在第3个时间仓 ($b_3$) 的发放计数（0或1）分别为 $X_{\cdot,3} = [1, 0, 1, 1, 1]$ 和 $Y_{\cdot,3} = [1, 0, 1, 0, 1]$。
-   神经元X的PSTH值是 $\mathrm{PSTH}_{X}(3) = (1+0+1+1+1)/5 = \frac{4}{5}$。
-   神经元Y的PSTH值是 $\mathrm{PSTH}_{Y}(3) = (1+0+1+0+1)/5 = \frac{3}{5}$。
-   原始[JPSTH](@entry_id:1126845)值（对角线元素）是 $J_{\text{raw}}(3,3) = \sum X_{r,3}Y_{r,3} = 1\cdot1 + 0\cdot0 + 1\cdot1 + 1\cdot0 + 1\cdot1 = 3$。
-   预测值是 $J_{\text{pred}}(3,3) = R \cdot \mathrm{PSTH}_{X}(3) \cdot \mathrm{PSTH}_{Y}(3) = 5 \cdot \frac{4}{5} \cdot \frac{3}{5} = \frac{12}{5}$。
-   因此，残差值是 $J_{\text{res}}(3,3) = 3 - \frac{12}{5} = \frac{3}{5}$。
这个正值 $\frac{3}{5}$ 表明，在这第3个时间仓内，两个神经元同时发放的次数比基于它们各自平均发放率预期的要多，提示存在正的[噪声相关](@entry_id:1128753)（即同步性）。

残差 JPSTH 中的不同模式可以映射到特定的生理机制：

*   **对角线上的窄 ridge (Narrow ridge on the diagonal)**：如果残差 [JPSTH](@entry_id:1126845) 在主对角线 $t_1 = t_2$ 上显示出一个显著的正值区域，这表明两个神经元倾向于在相同的 trial-by-trial 噪声波动下同步发放。这通常是由一个共同的、快速波动的输入源引起的。一个重要的理论见解是，如果这种共享波动 $u_k(t)$ 具有自相关函数 $R_u(\tau)$，那么残差 JPSTH 的结构将正比于 $R_u(t_2-t_1)$。这意味着对角线 ridge 的宽度不是由分析的时间仓大小决定的，而是由共享噪声相关的时间尺度决定的 。

*   **离对角线的窄 ridge (Narrow ridge off the diagonal)**：一个位于 $t_2 - t_1 = \delta$ （其中 $\delta$ 是一个小常数）平行于主对角线的窄正值 ridge 是一个直接的、**单突触兴奋性连接**的经典标志。它表明，每当神经元1在时间 $t_1$ 发放一个脉冲后，神经元2在 $t_1 + \delta$ 时刻发放一个脉冲的概率显著增加。这里的延迟 $\delta$ 代表了[轴突传导](@entry_id:177368)和[突触传递](@entry_id:142801)的总时间。ridge 的狭窄宽度反映了突触传递的高度时间精确性。例如，一个在 $t_2 - t_1 \approx +5 \text{ ms}$ 处的窄 ridge，强烈暗示存在一个从神经元1到神经元2的、延迟为5毫秒的兴奋性连接 。反之，一个负值的 trough 则暗示了抑制性连接。通过一个生成模型，我们可以更精确地将 ridge 的宽度与生理参数联系起来。如果神经元B的[脉冲时间](@entry_id:1132155) $T_B = T_A + \delta + \epsilon$，其中 $\epsilon \sim \mathcal{N}(0,\sigma_{\epsilon}^2)$ 是突触[抖动](@entry_id:200248) (jitter)，那么残差 [JPSTH](@entry_id:1126845) 中 ridge 的**半峰全宽 (Full Width at Half Maximum, FWHM)** 直接由[抖动](@entry_id:200248)的标准差决定，为 $2\sqrt{2\ln(2)}\sigma_{\epsilon}$ 。

*   **宽阔的结构 (Broad structures)**：如果整个残差 JPSTH 矩阵呈现为一个广泛的、正值的“基座”，这表明两个神经元受到一个缓慢变化的、非锁时于刺激的共同驱动。例如，动物的注意或唤醒状态在不同试验间缓慢波动，可能导致在某些试验中两个神经元的兴奋性都普遍较高，而在另一些试验中则都较低。这会诱导一个跨越所有时间仓对 $(t_1, t_2)$ 的正协方差 。

### 高级主题：[控制混杂因素](@entry_id:909803)

标准的移位预测子校正假设，除了 stimulus-locked rates 外，神经元之间是独立的。然而，在真实的生物回路中，情况往往更复杂。[噪声相关](@entry_id:1128753)本身可能源于多种机制，其中一些可能被误解为直接连接。

#### 共同输入问题

一个经典的问题是，两个没有直接连接的神经元A和B，如果都接收来自第三个神经元C的共同输入，它们的残差 JPSTH 中也会出现相关性结构。trial-by-trial 的C神经元发放波动会同时驱动A和B，导致它们的残差 [JPSTH](@entry_id:1126845) 中出现一个 ridge，其形状反映了C发放的[自相关](@entry_id:138991)性。这种由未观测到的共同原因引起的“伪”相关性，可能会被错误地解释为A和B之间的直接连接或共享输入的证据 。

如果共同输入源C被同时记录下来，我们可以采用更高级的统计方法来“部分掉”它的影响：
1.  **[偏相关](@entry_id:144470) (Partial Correlation)**：在每个时间仓对 $(t_1, t_2)$，我们可以计算A和B发放计数在所有试验上的皮尔逊相关系数，同时将C在适当时间的发放计数作为[控制变量](@entry_id:137239)，计算偏相关系数。这可以构建一个“偏残差JPSTH”，它揭示了在排除了C的线性影响后A和B之间剩余的相关性 。
2.  **[广义线性模型](@entry_id:900434) (Generalized Linear Models, GLM)**：一个更强大的方法是为每个神经元（A和B）拟合一个GLM。模型的预测变量不仅包括刺激本身，还包括C神经元的历史发放活动。在拟合模型后，我们可以从原始[脉冲序列](@entry_id:1132157)中减去由C的活动所预测的部分，然后在得到的残差[脉冲序列](@entry_id:1132157)上计算[JPSTH](@entry_id:1126845)。如果模型准确地捕捉了C的影响，那么由C引起的伪相关将被移除 。

#### 行为协变量问题

类似地，trial-by-trial 的行为变化（如反应时间 $R_k$）也可能成为混杂因素。如果一个动物在快速反应的试验中，两个神经元的发放率都系统性地升高，这将在A和B之间产生一个正的协方差，即使它们之间没有直接的神经联系。标准的[移位](@entry_id:145848)预测子无法校正这种与行为相关的共同调制，因为它只考虑了平均的、与试验无关的 PSTH 。

解决这个问题的正确方法是明确地将行为变量纳入模型。类似于处理共同输入问题，我们可以：
-   对每个神经元和每个时间仓，建立一个回归模型（如GLM），用试验的反应时间 $R_k$ 来预测发放计数 $n_{ik}(t)$。这会得到一个依赖于行为的条件[发放率估计](@entry_id:1125007) $\hat{\lambda}_i(t \mid R_k)$。
-   然后，构建一个**行为预测子** $B(t_1, t_2) = \sum_{k=1}^{K}\hat{\lambda}_1(t_1 \mid R_k)\,\hat{\lambda}_2(t_2 \mid R_k)\,( \Delta t)^2$。
-   从原始[JPSTH](@entry_id:1126845)中减去这个行为预测子，得到的残差将揭示在控制了反应时间相关的共同调制后，是否还存在额外的神经元间相关性。这个过程有效地将相关性分解为行为驱动的部分和纯粹的内部网络部分 。

总之，JPSTH是一个揭示神经元动态相互作用的多功能工具。然而，对其的精确解读要求仔细地分解不同来源的相关性，并应用恰当的[统计模型](@entry_id:165873)来校正和控制潜在的混杂因素。通过这种严谨的方法，JPSTH能够为我们提供关于[神经回路功能](@entry_id:183982)连接和信息处理机制的深刻见解。