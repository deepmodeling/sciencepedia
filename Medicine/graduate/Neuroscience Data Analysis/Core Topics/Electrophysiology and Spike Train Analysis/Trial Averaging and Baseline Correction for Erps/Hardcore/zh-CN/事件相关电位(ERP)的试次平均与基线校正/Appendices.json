{
    "hands_on_practices": [
        {
            "introduction": "事件相关电位（ERP）分析的一个核心假设是，刺激前基线期的活动是平稳的，并且与刺激后的任务相关活动无关。然而，当缓慢的脑电活动（如线性漂移）在不同条件下存在差异时，基线校正本身就可能在真实ERP响应完全相同的情况下，人为地制造出虚假的刺激后幅度差异。这个练习通过一个简化的生成模型，从数学上推导出这种伪影是如何产生的，从而帮助你深入理解基线校正的潜在陷阱。",
            "id": "4173065",
            "problem": "考虑一个测量事件相关电位 (ERP; Event-Related Potential) 的双条件实验，其中条件 $c \\in \\{A,B\\}$ 的每次试验都会产生一个单通道时间序列 $x_{c,i}(t)$，该序列定义在一个时间窗口 $t \\in [-T_0, T_1]$ 内，刺激出现在 $t = 0$ 时刻。条件 $c$ 的 ERP 是跨试验的平均值 $\\bar{x}_c(t) = \\frac{1}{N_c} \\sum_{i=1}^{N_c} x_{c,i}(t)$，在潜伏期 $\\tau$ 的一个成分的振幅定义为基线校正后的 $\\bar{x}_c(\\tau)$。基线校正从每个时间点减去刺激前窗口 $[-T_b,0)$ 内的均值，并逐次试验地应用：$x'_{c,i}(t) = x_{c,i}(t) - \\frac{1}{T_b}\\int_{-T_b}^{0} x_{c,i}(u)\\,du$，经基线校正的 ERP 为 $\\bar{x}'_c(t) = \\frac{1}{N_c} \\sum_{i=1}^{N_c} x'_{c,i}(t)$。假设一个生成模型，其中测量到的信号包含一个诱发响应、一个缓慢的非诱发基线过程和噪声：$x_{c,i}(t) = s_c(t) + d_{c,i}(t) + \\epsilon_{c,i}(t)$，其中 $s_c(t)$ 是特定于条件的诱发响应，$d_{c,i}(t)$ 是一个在 $t=0$ 前后都存在的缓慢过程，而 $\\epsilon_{c,i}(t)$ 是均值为零且独立于 $s_c(t)$ 和 $d_{c,i}(t)$ 的噪声。假设 $d_{c,i}(t)$ 在该时间窗口内可以被一个确定性的线性趋势 $d_{c,i}(t) = \\alpha_c t$ 很好地近似，其中 $\\alpha_c$ 可能因条件而异，这是由于缓慢漂移或先前过程的重叠造成的，并且对于所有 $t \\ge 0$ 都有 $s_A(t) = s_B(t)$。在这些假设和定义下，用 $\\alpha_A$、$\\alpha_B$、 $T_b$ 和 $\\tau$ 来推导预期差异 $\\Delta(\\tau) = \\mathbb{E}[\\bar{x}'_A(\\tau) - \\bar{x}'_B(\\tau)]$，并利用你的推导来评估减去具有不同均值的基线如何能在刺激后诱发伪振幅差异 (spurious amplitude differences)。然后，评估以下陈述，并选出所有关于伪差的存在及其缓解策略的正确陈述：\n\nA. 如果刺激前的漂移是特定于条件的，并在刺激后以 $d_c(t) = \\alpha_c t$ 的形式继续存在，那么即使真实的诱发响应相同，使用窗口 $[-T_b,0)$ 进行基线校正也会在潜伏期 $\\tau$ 产生一个预期差异，其值为 $(\\alpha_A - \\alpha_B)\\,(\\tau + T_b/2)$。\n\nB. 无论基线动态如何非平稳，使用特定于条件的基线校正总能保证刺激后振幅差异的无偏性。\n\nC. 通过对试验重新加权以使经验基线均值相等来匹配各条件间的基线分布，可以消除偏差中的恒定偏移部分，但不能消除由不同斜率引起的时间变化部分。\n\nD. 在单次试验水平的广义线性模型 (GLM; General Linear Model) 中，将基线均值作为一个协变量，在控制刺激前基线的同时，将诱发振幅估计为刺激后回归量的系数，如果模型包含适当的基函数（例如，时间的线性项），则可以消除恒定和线性漂移引起的偏差。\n\nE. $2\\,\\mathrm{Hz}$ 的高通滤波对于 ERP 来说总是一种安全的基线策略，因为它从不扭曲成分的振幅。",
            "solution": "问题陈述具有科学依据，提法恰当且客观。它提出了一个简化但标准的事件相关电位 (ERP) 数据生成模型，用以探讨在存在特定于条件的线性漂移时，基线校正所引入的伪影 (artifacts)。所有术语都得到了定义，假设也是明确的，这使得一个唯一且有意义的解答成为可能。因此，我将继续进行推导和评估。\n\n第一步是推导两种条件下经基线校正的 ERP 振幅之间的预期差异，$\\Delta(\\tau) = \\mathbb{E}[\\bar{x}'_A(\\tau) - \\bar{x}'_B(\\tau)]$。\n\n条件 $c$ 中单次试验 $i$ 的基线校正信号由下式给出：\n$$x'_{c,i}(t) = x_{c,i}(t) - B_{c,i}$$\n其中 $B_{c,i}$ 是信号在刺激前基线区间 $[-T_b, 0)$ 内的均值：\n$$B_{c,i} = \\frac{1}{T_b}\\int_{-T_b}^{0} x_{c,i}(u)\\,du$$\n观测信号的生成模型是：\n$$x_{c,i}(t) = s_c(t) + d_{c,i}(t) + \\epsilon_{c,i}(t)$$\n其中 $s_c(t)$ 是诱发信号，$d_{c,i}(t)$ 是缓慢漂移，$\\epsilon_{c,i}(t)$ 是零均值噪声。\n我们已知漂移的具体形式为 $d_{c,i}(t) = \\alpha_c t$。通常假设在刺激前的时间里，诱发响应 $s_c(t)$ 为零，即对于 $t  0$，有 $s_c(t) = 0$。\n\n将模型代入基线均值 $B_{c,i}$ 的表达式中：\n$$B_{c,i} = \\frac{1}{T_b}\\int_{-T_b}^{0} [s_c(u) + \\alpha_c u + \\epsilon_{c,i}(u)]\\,du$$\n鉴于当 $u0$ 时 $s_c(u) = 0$，上式可简化为：\n$$B_{c,i} = \\frac{1}{T_b}\\int_{-T_b}^{0} [\\alpha_c u + \\epsilon_{c,i}(u)]\\,du = \\frac{\\alpha_c}{T_b}\\int_{-T_b}^{0} u\\,du + \\frac{1}{T_b}\\int_{-T_b}^{0} \\epsilon_{c,i}(u)\\,du$$\n线性项的积分是 $\\int_{-T_b}^{0} u\\,du = \\left[\\frac{u^2}{2}\\right]_{-T_b}^{0} = 0 - \\frac{(-T_b)^2}{2} = -\\frac{T_b^2}{2}$。\n所以，单次试验的基线均值是：\n$$B_{c,i} = \\frac{\\alpha_c}{T_b} \\left(-\\frac{T_b^2}{2}\\right) + \\frac{1}{T_b}\\int_{-T_b}^{0} \\epsilon_{c,i}(u)\\,du = -\\frac{\\alpha_c T_b}{2} + \\frac{1}{T_b}\\int_{-T_b}^{0} \\epsilon_{c,i}(u)\\,du$$\n现在，我们求在刺激后潜伏期 $\\tau \\ge 0$ 的基线校正信号：\n$$x'_{c,i}(\\tau) = x_{c,i}(\\tau) - B_{c,i} = [s_c(\\tau) + \\alpha_c \\tau + \\epsilon_{c,i}(\\tau)] - \\left[-\\frac{\\alpha_c T_b}{2} + \\frac{1}{T_b}\\int_{-T_b}^{0} \\epsilon_{c,i}(u)\\,du\\right]$$\n$$x'_{c,i}(\\tau) = s_c(\\tau) + \\alpha_c \\tau + \\frac{\\alpha_c T_b}{2} + \\epsilon_{c,i}(\\tau) - \\frac{1}{T_b}\\int_{-T_b}^{0} \\epsilon_{c,i}(u)\\,du$$\n特定于条件的 ERP $\\bar{x}'_c(\\tau)$ 是 $x'_{c,i}(\\tau)$ 在 $N_c$ 次试验中的平均值。对所有可能的噪声实现取期望 $\\mathbb{E}[...]$，并注意到对于所有 $t$ 都有 $\\mathbb{E}[\\epsilon_{c,i}(t)] = 0$，我们得到：\n$$\\mathbb{E}[\\bar{x}'_c(\\tau)] = \\mathbb{E}\\left[\\frac{1}{N_c}\\sum_{i=1}^{N_c} x'_{c,i}(\\tau)\\right] = s_c(\\tau) + \\alpha_c \\tau + \\frac{\\alpha_c T_b}{2} = s_c(\\tau) + \\alpha_c\\left(\\tau + \\frac{T_b}{2}\\right)$$\n条件 A 和 B 之间的预期差异是：\n$$\\Delta(\\tau) = \\mathbb{E}[\\bar{x}'_A(\\tau)] - \\mathbb{E}[\\bar{x}'_B(\\tau)] = \\left[s_A(\\tau) + \\alpha_A\\left(\\tau + \\frac{T_b}{2}\\right)\\right] - \\left[s_B(\\tau) + \\alpha_B\\left(\\tau + \\frac{T_b}{2}\\right)\\right]$$\n$$\\Delta(\\tau) = (s_A(\\tau) - s_B(\\tau)) + (\\alpha_A - \\alpha_B)\\left(\\tau + \\frac{T_b}{2}\\right)$$\n问题陈述指出，真实的刺激后诱发响应是相同的，即对于 $t \\ge 0$ 有 $s_A(t) = s_B(t)$。因此，对于 $\\tau \\ge 0$，第一项为零。由此产生的预期差异纯粹是基线校正与差异性漂移相互作用造成的伪影：\n$$\\Delta(\\tau) = (\\alpha_A - \\alpha_B)\\left(\\tau + \\frac{T_b}{2}\\right)$$\n这个推导表明，刺激前漂移斜率的差异 $(\\alpha_A \\neq \\alpha_B)$ 会诱发一个刺激后的伪振幅差异，这个差异不是恒定的，而是随潜伏期 $\\tau$ 线性变化。\n\n现在，我将评估每个陈述。\n\nA. 如果刺激前的漂移是特定于条件的，并在刺激后以 $d_c(t) = \\alpha_c t$ 的形式继续存在，那么即使真实的诱发响应相同，使用窗口 $[-T_b,0)$ 进行基线校正也会在潜伏期 $\\tau$ 产生一个预期差异，其值为 $(\\alpha_A - \\alpha_B)\\,(\\tau + T_b/2)$。\n该陈述与上面推导出的结果直接且精确地匹配。其公式与我们在给定假设下计算出的伪预期差异 $\\Delta(\\tau)$ 完全相同。\n结论：**正确**。\n\nB. 无论基线动态如何非平稳，使用特定于条件的基线校正总能保证刺激后振幅差异的无偏性。\n这个陈述是错误的。我的推导提供了一个直接的反例。在线性非平稳动态 ($d_c(t)=\\alpha_c t$) 的情况下，应用特定于条件的基线校正会导致对振幅差异的有偏估计，$\\Delta(\\tau) = (\\alpha_A - \\alpha_B)(\\tau + T_b/2)$，如果 $\\alpha_A \\neq \\alpha_B$ 则该值非零。“总能保证”这个说法太绝对了，因为这种常见的基线校正方法众所周知对各种形式的非平稳性都很敏感。\n结论：**不正确**。\n\nC. 通过对试验重新加权以使经验基线均值相等来匹配各条件间的基线分布，可以消除偏差中的恒定偏移部分，但不能消除由不同斜率引起的时间变化部分。\n推导出的偏差是 $\\Delta(\\tau) = (\\alpha_A - \\alpha_B)\\tau + (\\alpha_A - \\alpha_B)\\frac{T_b}{2}$。它包含两个部分：一个时变部分 $(\\alpha_A - \\alpha_B)\\tau$ 和一个恒定偏移部分 $(\\alpha_A - \\alpha_B)\\frac{T_b}{2}$。条件 c 的预期基线均值是 $\\mathbb{E}[B_c] = -\\frac{\\alpha_c T_b}{2}$。预期基线均值的差异因此是 $\\mathbb{E}[B_A] - \\mathbb{E}[B_B] = -(\\alpha_A - \\alpha_B)\\frac{T_b}{2}$。恒定偏移偏差是该差异的负值。一个匹配经验基线均值的程序（例如，通过子抽样或重加权试验）强制使各条件间的平均基线水平相等，从而消除了偏差中的恒定偏移贡献。然而，这个程序并不会改变底层的信号动态。时变部分 $(\\alpha_A - \\alpha_B)\\tau$ 源于在时间 $\\tau$ 的实际信号包含了 $\\alpha_c \\tau$ 这一项，而这种持续漂移的差异并不能通过调整刺激前均值来校正。因此，该陈述准确地描述了这种校正策略的效果。\n结论：**正确**。\n\nD. 在单次试验水平的广义线性模型 (GLM; General Linear Model) 中，将基线均值作为一个协变量，在控制刺激前基线的同时，将诱发振幅估计为刺激后回归量的系数，如果模型包含适当的基函数（例如，时间的线性项），则可以消除恒定和线性漂移引起的偏差。\n该陈述描述了一种复杂且有效的缓解此类伪影的方法。GLM 可以对多个因素对观测数据的贡献进行建模。在一个单次试验水平的 $x_{c,i}(t)$ 数据模型中，可以包含实验条件、该次试验的刺激前基线均值、时间 $t$ 本身，以及关键的时间与条件的交互作用的回归量。一个形式为 $x_i(t) \\sim \\text{Condition} + B_i + t + \\text{Condition} \\times t$ 的模型通过主效应 $t$ 和交互项明确地对特定于条件的线性漂移进行建模和估计。通过解释这种差异性漂移，模型可以提供对诱发响应上条件效应的无偏估计。这种方法消除了偏差的根本原因（差异性斜率），从而同时校正了伪影的时变和恒定偏移部分。\n结论：**正确**。\n\nE. $2\\,\\mathrm{Hz}$ 的高通滤波对于 ERP 来说总是一种安全的基线策略，因为它从不扭曲成分的振幅。\n这个陈述是绝对错误的。高通滤波是一种线性时不变操作，它会移除或衰减低于其截止频率的频率分量。虽然它能有效移除缓慢漂移（这是一种低频现象），但它也会扭曲信号中任何在阻带有能量的感兴趣部分。许多重要的 ERP 成分，如 P300、慢皮层电位和准备电位，其特征是缓慢的电压变化，并且在 $2\\,\\mathrm{Hz}$ 以下有大量能量。应用 $2\\,\\mathrm{Hz}$ 的高通滤波器会严重衰减和扭曲这些成分，可能导致对其振幅和潜伏期的错误结论。没有任何滤波策略是“永远安全”或“从不扭曲”的；滤波器参数的选择必须根据感兴趣的特定 ERP 成分和噪声的性质仔细考虑。\n结论：**不正确**。",
            "answer": "$$\\boxed{ACD}$$"
        },
        {
            "introduction": "在理论上理解了基线差异的危害之后，一个关键的实践步骤是在我们自己的数据中检测这些差异。本练习将指导你完成一个完整的编码任务，包括生成具有已知基线偏移的合成ERP数据，并使用统计检验来比较不同实验条件下的基线分布。通过这个动手实践，你将掌握在进行任何刺激后效应分析之前，执行关键的基线分析诊断检查的技能。",
            "id": "4202094",
            "problem": "给你一项关于脑电图（EEG）事件相关电位（ERP）分析的正式任务，该任务侧重于试验平均和基线校正，并完全以数学和统计术语来构建。目标是使用关于统计估计和假设检验的基本原理，比较不同实验条件和电极之间的基线。你必须实现一个完整的程序，该程序能够生成合成的、科学上可信的类 ERP 数据，应用基线计算和校正，然后在不同条件和电极间进行比较性基线分析。\n\n请使用以下基础。ERP 是一种与刺激锁时的信号，定义为重复试验的期望值。设 $x_{c,e,i}(t)$ 表示条件 $c$、电极 $e$、试验 $i$ 在相对时间 $t$（毫秒）时的振幅（微伏），其中 $t = 0$ 表示刺激开始。基线定义在一个刺激前时间窗 $B = [t_1, t_2]$ 上，其中 $t_1  0$ 且 $t_2 \\le 0$。每次试验的基线均值为\n$$\nb_{c,e,i} = \\frac{1}{|B|} \\sum_{t \\in B} x_{c,e,i}(t).\n$$\n每次试验的基线校正是如下变换\n$$\n\\tilde{x}_{c,e,i}(t) = x_{c,e,i}(t) - b_{c,e,i}.\n$$\n一个条件和一个电极的试验平均 ERP 定义为跨试验的算术平均值：\n$$\n\\mathrm{ERP}_{c,e}(t) = \\frac{1}{n_c} \\sum_{i=1}^{n_c} \\tilde{x}_{c,e,i}(t),\n$$\n其中 $n_c$ 是条件 $c$ 中的试验次数。为了评估每个电极在不同条件下的基线是否存在差异，将每次试验的基线均值建模为独立样本，并使用双边 Welch's $t$检验在显著性水平 $\\alpha = 0.05$ 下比较两个特定条件的基线分布。此方法依赖于样本均值作为无偏估计量的经过充分检验的特性，以及对高斯噪声的大样本近似。\n\n你的程序必须按如下方式为每个测试用例生成类 ERP 的合成数据。对于每次试验、每个电极和每个条件，通过对三个分量求和来构建 $x_{c,e,i}(t)$：一个应用于整个时间序列的特定于条件的恒定基线偏移 $\\Delta_{c,e}$（微伏），一个共同的锁时 ERP“凸起”（建模为振幅为 $A$ 微伏、中心位于时间 $\\mu$ 毫秒、宽度参数为 $\\sigma$ 毫秒的高斯脉冲），以及在每个时间点独立采样的零均值高斯噪声（标准差为 $\\eta$ 微伏）。所有时间点和时间窗均以毫秒为单位定义，并根据采样率 $f_s$（赫兹）以整数毫秒分辨率进行采样。振幅必须以微伏为单位处理和解释，时间必须以毫秒为单位处理和解释。不使用角度。\n\n对于每个测试用例，执行以下计算：\n- 使用指定的基线窗口为所有试验和电极计算 $b_{c,e,i}$。\n- 应用基线校正得到 $\\tilde{x}_{c,e,i}(t)$，并通过试验平均形成 $\\mathrm{ERP}_{c,e}(t)$。\n- 对于每个电极，在 $\\alpha = 0.05$ 的水平上进行双边 Welch's $t$检验，比较 $\\{b_{A,e,i}\\}_{i=1}^{n_A}$ 与 $\\{b_{B,e,j}\\}_{j=1}^{n_B}$。\n- 统计基线差异具有统计学意义的电极数量，即 $p$值严格小于 $0.05$ 的电极数量。\n\n该测试套件包含三组参数集，旨在实现覆盖性和科学真实性。在所有情况下，ERP 成分在不同条件下是相同的，以确保基线是主要差异因素。此外，随机数生成必须通过固定种子对每个测试用例进行确定性生成，以使输出可复现。\n\n测试用例 1（包含多个电极和平衡试验的通用“理想路径”）：\n- 采样率 $f_s = 1000$ 赫兹。\n- 时间轴从 $t_{\\min} = -200$ 毫秒到 $t_{\\max} = 600$ 毫秒（含）。\n- 基线窗口 $B = [-200, 0]$ 毫秒（含）。\n- 试验次数 $n_A = 120$ 和 $n_B = 120$。\n- 电极数量 $E = 3$，索引为 $e \\in \\{0,1,2\\}$。\n- 基线偏移（微伏）：对于所有 $e$，$\\Delta_{A,e} = 0$；以及 $\\Delta_{B,0} = 0$，$\\Delta_{B,1} = 0.8$，$\\Delta_{B,2} = 1.2$。\n- ERP 高斯脉冲参数：振幅 $A = 5$，中心 $\\mu = 300$，宽度 $\\sigma = 50$。\n- 噪声标准差 $\\eta = 0.5$ 微伏。\n- 确定性随机种子 $s = 42$。\n\n测试用例 2（具有短基线窗口和单个电极的类边界情况）：\n- 采样率 $f_s = 500$ 赫兹。\n- 时间轴从 $t_{\\min} = -20$ 毫秒到 $t_{\\max} = 200$ 毫秒（含）。\n- 基线窗口 $B = [-20, 0]$ 毫秒（含）。\n- 试验次数 $n_A = 60$ 和 $n_B = 60$。\n- 电极数量 $E = 1$，索引为 $e = 0$。\n- 基线偏移（微伏）：$\\Delta_{A,0} = 0$ 和 $\\Delta_{B,0} = 0$。\n- ERP 高斯脉冲参数：振幅 $A = 3$，中心 $\\mu = 100$，宽度 $\\sigma = 30$。\n- 噪声标准差 $\\eta = 0.6$ 微伏。\n- 确定性随机种子 $s = 43$。\n\n测试用例 3（具有不等试验次数和一个电极上存在强基线差异的边缘情况）：\n- 采样率 $f_s = 1000$ 赫兹。\n- 时间轴从 $t_{\\min} = -100$ 毫秒到 $t_{\\max} = 500$ 毫秒（含）。\n- 基线窗口 $B = [-100, 0]$ 毫秒（含）。\n- 试验次数 $n_A = 100$ 和 $n_B = 70$。\n- 电极数量 $E = 3$，索引为 $e \\in \\{0,1,2\\}$。\n- 基线偏移（微伏）：对于所有 $e$，$\\Delta_{A,e} = 0$；以及 $\\Delta_{B,0} = 2.0$，$\\Delta_{B,1} = 0$，$\\Delta_{B,2} = 0$。\n- ERP 高斯脉冲参数：振幅 $A = 4$，中心 $\\mu = 200$，宽度 $\\sigma = 40$。\n- 噪声标准差 $\\eta = 0.7$ 微伏。\n- 确定性随机种子 $s = 44$。\n\n你的程序必须输出一行，其中包含测试用例 1、2 和 3 的显著电极数量的整数计数，格式为一个逗号分隔的列表，用方括号括起来且不含空格，例如 `[x_1,x_2,x_3]`。此输出没有单位，因为它是一个计数。计算中的所有中间量必须按照每个测试用例的规定，正确使用微伏作为振幅单位，毫秒作为时间单位。假设检验必须是双边的，并使用 $\\alpha = 0.05$。",
            "solution": "用户提供的问题是有效的。它在科学上基于神经生理信号处理和统计推断的原理，特别是关于事件相关电位（ERP）的原理。该问题是适定的，所有参数、模型和程序都得到了明确无歧义的定义，确保了唯一且可复现的解。它客观且不含无法形式化或主观的元素。因此，将提供一个解决方案。\n\n该问题要求实现一个计算模型来分析合成的 ERP 数据。核心任务是根据指定的模型生成数据，计算每次试验的基线，然后对这些基线在两种实验条件之间进行一组电极的统计比较。\n\n解决方案分为四个主要阶段：(1) 生成合成 ERP 数据，(2) 计算每次试验的基线均值，(3) 对这些均值进行统计假设检验，以及 (4) 汇总指定测试用例的结果。\n\n**1. 合成数据生成**\n给定条件 $c \\in \\{A, B\\}$、电极 $e$ 和试验 $i$ 在时间 $t$ 的电压信号建模为：\n$$\nx_{c,e,i}(t) = \\Delta_{c,e} + G(t; A, \\mu, \\sigma) + \\epsilon_{c,e,i}(t)\n$$\n其中：\n- $\\Delta_{c,e}$ 是一个特定于条件和电极的恒定基线偏移，单位为微伏（$\\mu$V）。该项代表我们旨在检测的大脑活动的潜在差异。\n- $G(t; A, \\mu, \\sigma)$ 是一个确定性的、所有试验共有的锁时 ERP 成分，建模为高斯脉冲：\n$$\nG(t; A, \\mu, \\sigma) = A \\exp\\left(-\\frac{(t - \\mu)^2}{2\\sigma^2}\\right)\n$$\n这里，$A$ 是振幅（$\\mu$V），$\\mu$ 是时间中心（ms），$\\sigma$ 是脉冲的宽度（ms）。\n- $\\epsilon_{c,e,i}(t)$ 是一个随机噪声项，建模为来自均值为零、标准差为 $\\eta$ 的高斯分布的独立样本，即 $\\epsilon_{c,e,i}(t) \\sim \\mathcal{N}(0, \\eta^2)$。\n\n对于每个测试用例，我们首先根据指定的采样率 $f_s$（单位 Hz）和时间范围 $[t_{\\min}, t_{\\max}]$（单位 ms）建立一个离散时间向量。时间步长为 $\\Delta t = 1000/f_s$ ms。时间向量由点 $t_k = t_{\\min} + k \\cdot \\Delta t$ 组成，直至 $t_{\\max}$。对于每个条件、电极和试验，通过将恒定偏移、在每个时间点评估的共同高斯脉冲以及高斯噪声的唯一实现相加来构建一个时间序列。使用固定的随机数生成器种子确保了可复现性。\n\n**2. 每次试验的基线计算**\n基线期定义为一个刺激前时间窗 $B = [t_1, t_2]$，其中 $t_2 \\le 0$。每次试验的基线均值 $b_{c,e,i}$ 是信号 $x_{c,e,i}(t)$ 在此窗口内的离散时间点上的样本均值。它是基线期间真实平均振幅的估计量。\n$$\nb_{c,e,i} = \\frac{1}{N_B} \\sum_{k \\text{ s.t. } t_k \\in B} x_{c,e,i}(t_k)\n$$\n其中 $N_B$ 是窗口 $B$ 中的时间样本数。由于 ERP 成分 $G(t)$ 被设计为在基线期间可忽略不计，且噪声 $\\epsilon(t)$ 的均值为零，因此基线均值的期望值约等于真实偏移量：$\\mathbb{E}[b_{c,e,i}] \\approx \\Delta_{c,e}$。\n\n问题还指定要计算基线校正后的信号 $\\tilde{x}_{c,e,i}(t) = x_{c,e,i}(t) - b_{c,e,i}$ 和试验平均的 $\\mathrm{ERP}_{c,e}(t) = \\frac{1}{n_c} \\sum_{i=1}^{n_c} \\tilde{x}_{c,e,i}(t)$。虽然这些是 ERP 分析中的标准步骤，但比较基线的核心任务仅依赖于 $b_{c,e,i}$ 值。这些量是作为指定程序的一部分计算的。\n\n**3. 统计假设检验**\n为确定给定电极 $e$ 的基线活动在条件 $A$ 和 $B$ 之间是否存在显著差异，我们比较它们各自的每次试验基线均值分布，即 $\\{b_{A,e,i}\\}_{i=1}^{n_A}$ 和 $\\{b_{B,e,j}\\}_{j=1}^{n_B}$。原假设（$H_0$）是基线的真实总体均值相等（$\\mathbb{E}[b_{A,e}] = \\mathbb{E}[b_{B,e}]$），这意味着基线偏移没有差异（$\\Delta_{A,e} = \\Delta_{B,e}$）。备择假设（$H_A$）是它们不相等。\n\n此比较采用双边 Welch's $t$检验。该检验是合适的，因为它不假设两组之间的方差或样本大小（$n_A$ vs $n_B$）相等，使其比标准的学生 t 检验更为鲁棒。该检验得出一个 $p$值，表示在原假设为真的情况下，观察到样本均值差异等于或大于计算值的概率。如果此 $p$值小于预定义的显著性水平 $\\alpha = 0.05$，我们拒绝原假设，并断定该电极的基线存在统计学上的显著差异。\n\n**4. 算法实现与结果汇总**\n总体算法如下：\n1. 初始化一个列表，用于存储每个测试用例的结果。\n2. 对于问题中定义的三个测试用例中的每一个：\n    a. 配置所有参数：$f_s, t_{\\min}, t_{\\max}, B, n_A, n_B, E, \\{\\Delta_{c,e}\\}, A, \\mu, \\sigma, \\eta$ 和随机种子 $s$。\n    b. 使用指定的种子创建一个可复现的随机数生成器。\n    c. 构建离散时间向量。\n    d. 生成共同的高斯 ERP 脉冲。\n    e. 对于每个条件（$A$ 和 $B$）：\n        i. 通过广播结合偏移、ERP 脉冲和噪声，生成完整的数据张量 $x_{c,e,i}(t)$。\n        ii. 识别与基线窗口 $B$ 对应的时间索引。\n        iii. 通过对基线索引上的数据进行平均，计算每次试验的基线均值 $b_{c,e,i}$，得到一个形状为（电极数，试验数）的矩阵。\n    f. 初始化一个显著电极计数器为 $0$。\n    g. 对于从 $0$ 到 $E-1$ 的每个电极索引 $e$：\n        i. 提取两个基线均值样本：$\\{b_{A,e,i}\\}$ 和 $\\{b_{B,e,j}\\}$。\n        ii. 对这两个样本执行双边 Welch's $t$检验。\n        iii. 如果得出的 $p$值严格小于 $0.05$，则增加计数器。\n    h. 将最终计数追加到结果列表中。\n3. 将结果列表格式化为指定的输出字符串 `\"[count1,count2,count3]\"`。\n\n该过程在提供的 Python 代码中实现，利用 `numpy` 进行高效的数组计算，并使用 `scipy.stats.ttest_ind` 进行统计检验。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import stats\n\ndef run_analysis(params: dict) - int:\n    \"\"\"\n    Generates synthetic ERP data and performs baseline comparison for a single test case.\n\n    Args:\n        params: A dictionary containing all parameters for the test case.\n\n    Returns:\n        The number of electrodes with a statistically significant baseline difference.\n    \"\"\"\n    # Unpack parameters from the dictionary\n    f_s = params[\"f_s\"]\n    t_min, t_max = params[\"t_range\"]\n    b_win_start, b_win_end = params[\"b_win\"]\n    n_trials = params[\"n_trials\"]\n    E = params[\"E\"]\n    deltas = params[\"deltas\"]\n    erp_params = params[\"erp_params\"]\n    eta = params[\"eta\"]\n    seed = params[\"seed\"]\n\n    # 1. Setup time vector and reproducible random number generator\n    rng = np.random.default_rng(seed)\n    sampling_interval = 1000.0 / f_s\n    # Use np.arange with a small tolerance for the endpoint to be inclusive\n    time_vector = np.arange(t_min, t_max + 1e-9, sampling_interval)\n\n    # 2. Generate common ERP component (Gaussian pulse)\n    A = erp_params['A']\n    mu = erp_params['mu']\n    sigma = erp_params['sigma']\n    erp_bump = A * np.exp(-((time_vector - mu)**2) / (2 * sigma**2))\n\n    baseline_means = {}\n    conditions = ['A', 'B']\n\n    for cond in conditions:\n        n_c = n_trials[cond]\n        delta_c = deltas[cond]\n\n        # 3. Generate synthetic data x_c,e,i(t)\n        # Noise tensor: (electrodes, trials, time points)\n        noise = rng.normal(loc=0.0, scale=eta, size=(E, n_c, len(time_vector)))\n        \n        # Combine components using broadcasting:\n        # delta_c: (E,) -> (E, 1, 1)\n        # erp_bump: (time,) -> (1, 1, time)\n        # noise: (E, n_c, time)\n        x_c = delta_c[:, np.newaxis, np.newaxis] + erp_bump[np.newaxis, np.newaxis, :] + noise\n\n        # 4. Compute per-trial baseline means b_c,e,i\n        baseline_mask = (time_vector >= b_win_start)  (time_vector = b_win_end)\n        b_c = np.mean(x_c[:, :, baseline_mask], axis=2)\n        baseline_means[cond] = b_c  # Shape: (E, n_c)\n\n        # As required, perform baseline correction and trial averaging, though not used in the final result\n        # _tilde_x_c = x_c - b_c[:, :, np.newaxis]\n        # _erp_c = np.mean(_tilde_x_c, axis=1)\n\n    # 5. Perform Welch's t-test for each electrode\n    significant_electrodes_count = 0\n    alpha = 0.05\n    baselines_A = baseline_means['A']\n    baselines_B = baseline_means['B']\n\n    for e in range(E):\n        sample_A = baselines_A[e, :]\n        sample_B = baselines_B[e, :]\n        \n        # Perform two-sided Welch's t-test\n        _t_stat, p_val = stats.ttest_ind(sample_A, sample_B, equal_var=False, alternative='two-sided')\n        \n        if p_val  alpha:\n            significant_electrodes_count += 1\n            \n    return significant_electrodes_count\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test Case 1\n        {\n            \"f_s\": 1000, \"t_range\": (-200, 600), \"b_win\": (-200, 0),\n            \"n_trials\": {'A': 120, 'B': 120}, \"E\": 3,\n            \"deltas\": {'A': np.array([0.0, 0.0, 0.0]), 'B': np.array([0.0, 0.8, 1.2])},\n            \"erp_params\": {'A': 5, 'mu': 300, 'sigma': 50},\n            \"eta\": 0.5, \"seed\": 42\n        },\n        # Test Case 2\n        {\n            \"f_s\": 500, \"t_range\": (-20, 200), \"b_win\": (-20, 0),\n            \"n_trials\": {'A': 60, 'B': 60}, \"E\": 1,\n            \"deltas\": {'A': np.array([0.0]), 'B': np.array([0.0])},\n            \"erp_params\": {'A': 3, 'mu': 100, 'sigma': 30},\n            \"eta\": 0.6, \"seed\": 43\n        },\n        # Test Case 3\n        {\n            \"f_s\": 1000, \"t_range\": (-100, 500), \"b_win\": (-100, 0),\n            \"n_trials\": {'A': 100, 'B': 70}, \"E\": 3,\n            \"deltas\": {'A': np.array([0.0, 0.0, 0.0]), 'B': np.array([2.0, 0.0, 0.0])},\n            \"erp_params\": {'A': 4, 'mu': 200, 'sigma': 40},\n            \"eta\": 0.7, \"seed\": 44\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        result = run_analysis(params)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "除了条件间的系统性差异外，基线估计的准确性本身也可能受到单个试次中随机伪影（如瞬时噪声尖峰）的挑战。标准的均值减法对这类离群值非常敏感，可能导致不准确的基线校正。本练习探讨了稳健统计中的高级方法，要求你计算在存在污染（即离群值）的情况下，Huber M-估计器对基线偏差的影响，从而让你了解如何构建更抗干扰的ERP分析流程。",
            "id": "4202140",
            "problem": "一个实验室使用脑电图（electroencephalography）记录了对视觉刺激的多个试验（trial）的事件相关电位（ERP; Event-Related Potential）。在对试验进行平均之前，每个试验都进行了基线校正，即减去一个在刺激前 $-200 \\,\\mathrm{ms}$ 到 $0 \\,\\mathrm{ms}$ 的窗口内计算出的基线估计量。假设采样率足够高，使得基线窗口能产生许多独立样本，并且大样本近似对于估计量的期望是有效的。\n\n设任意给定试验中的基线样本独立同分布于一个污染混合模型：样本以 $1 - \\epsilon$ 的概率从高斯分布 $\\mathcal{N}(0, \\sigma^{2})$ 中抽取，以 $\\epsilon$ 的概率是振幅为 $A$ 的异常值（$A \\gg \\sigma$），这模拟了基线内出现的罕见正向伪迹。这种污染是单侧的（正向）。假设刺激后时刻的测量噪声均值为零，且与基线样本独立。\n\n定义三种从基线窗口计算得出的单试验基线估计量：样本均值、样本中位数，以及一个稳健的Huber M-估计量，其影响函数为\n$$\n\\psi(x) \\;=\\; \n\\begin{cases}\nx,  |x| \\le c,\\\\\nc\\,\\mathrm{sign}(x),  |x|  c,\n\\end{cases}\n$$\n其中 $c$ 是一个固定的阈值。在上述混合模型的大样本极限下，Huber基线估计量等于求解总体估计方程 $E[\\psi(X - \\theta)] = 0$ 的唯一解 $\\theta$。因为 $A \\gg c$，异常值对 $E[\\psi(X - \\theta)]$ 的贡献在 $+c$ 处饱和。\n\n设在 $t_{0} = 100 \\,\\mathrm{ms}$ 时，潜在的真实ERP振幅为 $S_{0}$，且在所有试验中均相同。经过基线校正（从每个试验中减去基线估计量）和试验平均后，在 $t_{0}$ 处的期望平均振幅为 $S_{0}$ 减去基线估计量的期望值。\n\n给定 $\\epsilon = 0.1$、$\\sigma = 1.5 \\,\\mu\\mathrm{V}$、 $A = 12 \\,\\mu\\mathrm{V}$、 $c = 2 \\,\\mu\\mathrm{V}$ 和 $S_{0} = 3.2 \\,\\mu\\mathrm{V}$，使用所述的大样本近似方法，计算当基线估计量为Huber M-估计量时，在 $t_{0}$ 处的期望平均振幅。以微伏（microvolts）为单位表示您的最终结果，并将答案四舍五入到四位有效数字。",
            "solution": "目标是计算在刺激后时间点 $t_{0} = 100 \\,\\mathrm{ms}$ 的期望平均振幅。该量由 $S_{0} - E[\\text{基线估计量}]$ 给出，其中 $S_{0}$ 是真实的ERP振幅，基线估计量是Huber M-估计量。问题指明，在大样本极限下，单次试验的估计量收敛于求解估计方程 $E[\\psi(X - \\theta)] = 0$ 的总体值 $\\theta$。对多个试验进行平均，基线估计量的期望值就是这个总体值 $\\theta$。因此，我们需要计算 $S_{0} - \\theta$。\n\n代表单个基线样本的随机变量 $X$ 服从一个污染混合模型。其分布由下式给出：\n$X \\sim (1 - \\epsilon) \\mathcal{N}(0, \\sigma^{2}) + \\epsilon \\delta_A$\n其中 $\\delta_A$ 是在振幅 $A$ 处的点质量。\n\n$\\theta$ 的估计方程是 $E[\\psi(X - \\theta)] = 0$。我们可以根据全期望定律，对混合模型的各个成分展开这个期望：\n$$ (1 - \\epsilon) E_{Z \\sim \\mathcal{N}(0, \\sigma^2)}[\\psi(Z - \\theta)] + \\epsilon E_{Y \\sim \\delta_A}[\\psi(Y - \\theta)] = 0 $$\n\n让我们来计算第二项，它对应于异常值的贡献。该期望就是函数在点质量 $A$ 处的取值：\n$E_{Y \\sim \\delta_A}[\\psi(Y - \\theta)] = \\psi(A - \\theta)$。\n影响函数 $\\psi(x)$ 由下式给出：\n$$\n\\psi(x) \\;=\\; \n\\begin{cases}\nx,  |x| \\le c,\\\\\nc\\,\\mathrm{sign}(x),  |x|  c,\n\\end{cases}\n$$\n我们已知 $A = 12 \\,\\mu\\mathrm{V}$ 和 $c = 2 \\,\\mu\\mathrm{V}$。真实的基线均值为 $E[X] = (1-\\epsilon)(0) + \\epsilon A = 0.1 \\times 12 = 1.2 \\,\\mu\\mathrm{V}$。Huber M-估计量是稳健的，其值将小于均值，所以我们可以预期 $\\theta$ 是一个小的正值。这保证了 $A - \\theta  c$。因此，$\\psi(A - \\theta) = c \\cdot \\mathrm{sign}(A - \\theta) = c$。\n\n估计方程简化为：\n$$ (1 - \\epsilon) E_{Z \\sim \\mathcal{N}(0, \\sigma^2)}[\\psi(Z - \\theta)] + \\epsilon c = 0 $$\n\n现在我们必须计算高斯分量的期望值，$E_{Z \\sim \\mathcal{N}(0, \\sigma^2)}[\\psi(Z - \\theta)]$。令 $\\phi(z; \\mu, \\sigma^2)$ 和 $\\Phi(z; \\mu, \\sigma^2)$ 分别为正态分布的概率密度函数（PDF）和累积分布函数（CDF）。该期望由以下积分给出：\n$$ E[\\psi(Z - \\theta)] = \\int_{-\\infty}^{\\infty} \\psi(z - \\theta) \\phi(z; 0, \\sigma^2) dz $$\n我们根据 $\\psi$ 的定义将积分分成几部分：\n$$ E[\\psi(Z - \\theta)] = \\int_{-\\infty}^{\\theta-c} (-c) \\phi(z; 0, \\sigma^2) dz + \\int_{\\theta-c}^{\\theta+c} (z - \\theta) \\phi(z; 0, \\sigma^2) dz + \\int_{\\theta+c}^{\\infty} c \\phi(z; 0, \\sigma^2) dz $$\n为简化计算，我们使用标准正态PDF $\\phi_{std}(x)$ 和CDF $\\Phi_{std}(x)$。令 $z' = z/\\sigma$。那么 $\\phi(z; 0, \\sigma^2) dz = \\phi_{std}(z') dz'$。该期望可以写为：\n$$ E[\\psi(Z - \\theta)] = \\sigma(\\phi_{std}(\\frac{\\theta-c}{\\sigma}) - \\phi_{std}(\\frac{\\theta+c}{\\sigma})) - \\theta(\\Phi_{std}(\\frac{\\theta+c}{\\sigma}) - \\Phi_{std}(\\frac{\\theta-c}{\\sigma})) + c(1 - \\Phi_{std}(\\frac{\\theta+c}{\\sigma}) - \\Phi_{std}(\\frac{\\theta-c}{\\sigma})) $$\n将此代入完整的估计方程中：\n$$ (1-\\epsilon) \\left[ \\sigma(\\phi_{std}(\\tfrac{\\theta-c}{\\sigma}) - \\phi_{std}(\\tfrac{\\theta+c}{\\sigma})) - \\theta(\\Phi_{std}(\\tfrac{\\theta+c}{\\sigma}) - \\Phi_{std}(\\tfrac{\\theta-c}{\\sigma})) + c(1 - \\Phi_{std}(\\tfrac{\\theta+c}{\\sigma}) - \\Phi_{std}(\\tfrac{\\theta-c}{\\sigma})) \\right] + \\epsilon c = 0 $$\n这是一个关于 $\\theta$ 的超越方程，必须通过数值方法求解。我们代入给定值：\n$\\epsilon = 0.1$\n$\\sigma = 1.5 \\,\\mu\\mathrm{V}$\n$c = 2 \\,\\mu\\mathrm{V}$\n\n方程变为：\n$$ (0.9) \\left[ 1.5(\\phi_{std}(\\tfrac{\\theta-2}{1.5}) - \\phi_{std}(\\tfrac{\\theta+2}{1.5})) - \\theta(\\Phi_{std}(\\tfrac{\\theta+2}{1.5}) - \\Phi_{std}(\\tfrac{\\theta-2}{1.5})) + 2(1 - \\Phi_{std}(\\tfrac{\\theta+2}{1.5}) - \\Phi_{std}(\\tfrac{\\theta-2}{1.5})) \\right] + (0.1)(2) = 0 $$\n使用数值求根算法解此方程得到 $\\theta$：\n$$ \\theta \\approx 0.272185 \\,\\mu\\mathrm{V} $$\n在给定的伪迹污染模型下，这个值代表了由Huber M-估计量引入的期望偏差。\n\n最后，我们计算在 $t_{0}$ 处的期望平均振幅，即经此基线偏差校正后的真实信号振幅：\n$$ \\text{期望振幅} = S_{0} - \\theta $$\n代入 $S_{0}$ 和计算出的 $\\theta$ 的值：\n$$ \\text{期望振幅} = 3.2 \\,\\mu\\mathrm{V} - 0.272185 \\,\\mu\\mathrm{V} = 2.927815 \\,\\mu\\mathrm{V} $$\n问题要求将结果四舍五入到四位有效数字。\n$$ 2.927815 \\to 2.928 $$",
            "answer": "$$\n\\boxed{2.928}\n$$"
        }
    ]
}