{
    "hands_on_practices": [
        {
            "introduction": "ROC分析的核心在于理解真正率（$TPR$）和假正率（$FPR$）之间的权衡。第一个练习将这些抽象概念置于一个使用具体数据的实际场景中。通过从一个简单的列联表计算这些比率，然后估计像约登指数（Youden index）这样的派生指标的统计不确定性，您将深刻体会到抽样变异性如何影响分类器性能度量的可靠性，这是解释任何实验结果的关键。",
            "id": "4568431",
            "problem": "一项预防医学领域的初步筛查研究评估了一种用于早期检测结直肠肿瘤的血液分类器。在固定的决策阈值 $\\tau$ 下，该分类器被应用于一个便利样本，该样本包含 $120$ 名经活检确诊患有晚期肿瘤的个体和 $380$ 名经结肠镜检查无肿瘤的无症状对照者。在患病组中，有 $84$ 人筛查结果为阳性，$36$ 人为阴性。在非患病组中，有 $57$ 人筛查结果为阳性，$323$ 人为阴性。使用核心概率定义，即真阳性率（在真正患病者中检测结果为阳性的概率）和假阳性率（在真正非患病者中检测结果为阳性的概率）是由经验频率估计的条件概率，请在阈值 $\\tau$ 下完成以下任务：\n- 以小数形式计算经验真阳性率和经验假阳性率。\n- 将每组内的测试结果视为独立同分布的伯努利随机变量，并将患病组和非患病组视为独立样本，从比例的二项方差出发，通过用经验率替代未知参数，推导尤登指数 $J = \\mathrm{TPR} - \\mathrm{FPR}$ 标准误的近似大样本表达式。然后计算 $95\\%$ 的瓦尔德半宽 $h = z_{0.975}\\,\\widehat{\\mathrm{SE}}(J)$，其中 $z_{0.975} = 1.96$。\n将您最终的 $h$ 数值答案四舍五入至四位有效数字。所有率均以小数（而非百分比）表示。仅提供 $h$ 的值作为您的最终答案。",
            "solution": "该问题被评估为有效，因为它在生物统计学原理上具有科学依据，问题陈述清晰，数据完整一致，且表述客观。\n\n该问题要求计算尤登指数 $J$ 的 $95\\%$ 瓦尔德半宽。我们首先根据提供的数据定义并计算必要的经验量。\n\n患病组的个体数量为 $N_D = 120$，非患病组的个体数量为 $N_{ND} = 380$。\n患病组中的阳性筛查数（真阳性）为 $TP = 84$。\n非患病组中的阳性筛查数（假阳性）为 $FP = 57$。\n\n真阳性率 ($\\mathrm{TPR}$) 是在个体患病的情况下测试结果为阳性的条件概率。其经验估计值，记为 $\\widehat{\\mathrm{TPR}}$，计算为筛查结果为阳性的患病个体所占的比例：\n$$\n\\widehat{\\mathrm{TPR}} = \\frac{TP}{N_D} = \\frac{84}{120} = 0.7\n$$\n假阳性率 ($\\mathrm{FPR}$) 是在个体未患病的情况下测试结果为阳性的条件概率。其经验估计值，记为 $\\widehat{\\mathrm{FPR}}$，计算为筛查结果为阳性的非患病个体所占的比例：\n$$\n\\widehat{\\mathrm{FPR}} = \\frac{FP}{N_{ND}} = \\frac{57}{380} = 0.15\n$$\n尤登指数定义为 $J = \\mathrm{TPR} - \\mathrm{FPR}$。其经验估计值为 $\\widehat{J} = \\widehat{\\mathrm{TPR}} - \\widehat{\\mathrm{FPR}}$。\n\n为了求出 $\\widehat{J}$ 的标准误，我们首先推导其方差。问题指出患病组和非患病组是独立样本。因此，它们各自的经验比例 $\\widehat{\\mathrm{TPR}}$ 和 $\\widehat{\\mathrm{FPR}}$ 是独立的随机变量。两个独立随机变量之差的方差等于它们方差之和：\n$$\n\\mathrm{Var}(\\widehat{J}) = \\mathrm{Var}(\\widehat{\\mathrm{TPR}} - \\widehat{\\mathrm{FPR}}) = \\mathrm{Var}(\\widehat{\\mathrm{TPR}}) + \\mathrm{Var}(\\widehat{\\mathrm{FPR}})\n$$\n测试结果被视为独立同分布的伯努利试验。真阳性数 $TP$ 服从二项分布 $\\mathrm{Bin}(N_D, \\mathrm{TPR})$。估计量 $\\widehat{\\mathrm{TPR}} = \\frac{TP}{N_D}$ 是一个样本比例。对于来自 $n$ 次试验、真实概率为 $p$ 的样本比例 $\\hat{p}$，其方差为 $\\mathrm{Var}(\\hat{p}) = \\frac{p(1-p)}{n}$。应用此原理，$\\widehat{\\mathrm{TPR}}$ 和 $\\widehat{\\mathrm{FPR}}$ 的方差分别为：\n$$\n\\mathrm{Var}(\\widehat{\\mathrm{TPR}}) = \\frac{\\mathrm{TPR}(1 - \\mathrm{TPR})}{N_D}\n$$\n$$\n\\mathrm{Var}(\\widehat{\\mathrm{FPR}}) = \\frac{\\mathrm{FPR}(1 - \\mathrm{FPR})}{N_{ND}}\n$$\n将这些代入 $\\mathrm{Var}(\\widehat{J})$ 的表达式中，得到：\n$$\n\\mathrm{Var}(\\widehat{J}) = \\frac{\\mathrm{TPR}(1 - \\mathrm{TPR})}{N_D} + \\frac{\\mathrm{FPR}(1 - \\mathrm{FPR})}{N_{ND}}\n$$\n$\\widehat{J}$ 的标准误是其方差的平方根，即 $\\mathrm{SE}(\\widehat{J}) = \\sqrt{\\mathrm{Var}(\\widehat{J})}$。\n\n对于大样本近似，我们通过用经验估计值 $\\widehat{\\mathrm{TPR}}$ 和 $\\widehat{\\mathrm{FPR}}$ 替代未知的真实参数 $\\mathrm{TPR}$ 和 $\\mathrm{FPR}$ 来估计标准误。这给出了估计的标准误 $\\widehat{\\mathrm{SE}}(\\widehat{J})$：\n$$\n\\widehat{\\mathrm{SE}}(\\widehat{J}) = \\sqrt{\\frac{\\widehat{\\mathrm{TPR}}(1 - \\widehat{\\mathrm{TPR}})}{N_D} + \\frac{\\widehat{\\mathrm{FPR}}(1 - \\widehat{\\mathrm{FPR}})}{N_{ND}}}\n$$\n现在，我们代入数值：$\\widehat{\\mathrm{TPR}}=0.7$，$\\widehat{\\mathrm{FPR}}=0.15$，$N_D=120$，以及 $N_{ND}=380$。\n$$\n\\widehat{\\mathrm{SE}}(\\widehat{J}) = \\sqrt{\\frac{0.7(1 - 0.7)}{120} + \\frac{0.15(1 - 0.15)}{380}}\n$$\n$$\n\\widehat{\\mathrm{SE}}(\\widehat{J}) = \\sqrt{\\frac{0.7(0.3)}{120} + \\frac{0.15(0.85)}{380}}\n$$\n$$\n\\widehat{\\mathrm{SE}}(\\widehat{J}) = \\sqrt{\\frac{0.21}{120} + \\frac{0.1275}{380}}\n$$\n计算各项：\n$$\n\\frac{0.21}{120} = 0.00175\n$$\n$$\n\\frac{0.1275}{380} \\approx 0.0003355263\n$$\n估计的方差是：\n$$\n\\widehat{\\mathrm{Var}}(\\widehat{J}) \\approx 0.00175 + 0.0003355263 = 0.0020855263\n$$\n因此，估计的标准误为：\n$$\n\\widehat{\\mathrm{SE}}(\\widehat{J}) \\approx \\sqrt{0.0020855263} \\approx 0.04566756\n$$\n最后一步是使用公式 $h = z_{0.975}\\,\\widehat{\\mathrm{SE}}(\\widehat{J})$ 计算 $95\\%$ 的瓦尔德半宽 $h$，其中 $z_{0.975} = 1.96$。\n$$\nh \\approx 1.96 \\times 0.04566756 \\approx 0.089508424\n$$\n问题要求将最终答案四舍五入到四位有效数字。$0.089508424$ 的前四位有效数字是 $8$、$9$、$5$ 和 $0$。随后的数字是 $8$，大于或等于 $5$，因此我们将最后一位有效数字向上取整。\n$$\nh \\approx 0.08951\n$$",
            "answer": "$$\n\\boxed{0.08951}\n$$"
        },
        {
            "introduction": "虽然经验数据为我们提供了离散的点，但许多神经解码器输出的是连续的分数。本练习从离散计数转向连续的信号检测模型，这是神经科学中一个常见的框架。通过在一个高斯假设下推导出最大化约登指数的最优决策阈值，您将把基于微积分的优化与在ROC曲线上寻找最佳工作点的几何目标联系起来。",
            "id": "4189213",
            "problem": "对皮层神经元的单通道细胞外记录使用一个简单的阈值检测器进行分析，该检测器作用于一个标量检测统计量 $A$（带通滤波片段的峰峰值振幅）。在一个时间窗内，只要 $A \\geq \\tau$（对于某个阈值 $\\tau$），检测器就宣告存在一个尖峰。假设一个生成模型，其中 $A$ 的类条件分布是方差相等的高斯分布：在噪声（无尖峰）条件下，$A \\mid \\text{噪声} \\sim \\mathcal{N}(\\mu_{0}, \\sigma^{2})$；在尖峰条件下，$A \\mid \\text{尖峰} \\sim \\mathcal{N}(\\mu_{1}, \\sigma^{2})$。在此记录中，经验校准得出 $\\mu_{0} = 0$ 微伏，$\\mu_{1} = 60$ 微伏，以及 $\\sigma = 20$ 微伏。\n\n仅使用受试者工作特征（ROC）曲线关于真阳性率和假阳性率的核心定义，以及 Youden 指数 $J(\\tau)$ 定义为灵敏度（真阳性率）与脱落率（假阳性率）之差，完成以下任务：\n\n1. 从 $J(\\tau) = \\text{TPR}(\\tau) - \\text{FPR}(\\tau)$ 和上述类条件高斯模型出发，推导 $J(\\tau)$ 关于标准正态累积分布函数的表达式。\n2. 从第一性原理出发，确定使 $J(\\tau)$ 最大化的阈值 $\\tau^{\\star}$ 并计算 $J(\\tau^{\\star})$。\n3. 从决策理论的角度，简要论证在存在对称与非对称错分成本以及类别不平衡的情况下，最大化 Youden 指数何时适用、何时不适用。\n\n使用给定参数报告最优阈值和最大化后的 Youden 指数的数值。阈值以微伏表示。将阈值和最大化后的 Youden 指数均四舍五入至四位有效数字。最终答案应仅包含数值（无单位），顺序为 $\\tau^{\\star}, J(\\tau^{\\star})$。",
            "solution": "首先对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n-   检测统计量是一个标量 $A$。\n-   如果检测统计量 $A$ 大于或等于阈值 $\\tau$（即 $A \\geq \\tau$），则宣告存在一个尖峰。\n-   在给定噪声的情况下，$A$ 的类条件概率分布为 $A \\mid \\text{噪声} \\sim \\mathcal{N}(\\mu_{0}, \\sigma^{2})$。\n-   在给定尖峰的情况下，$A$ 的类条件概率分布为 $A \\mid \\text{尖峰} \\sim \\mathcal{N}(\\mu_{1}, \\sigma^{2})$。\n-   给定的参数为 $\\mu_{0} = 0$ 微伏，$\\mu_{1} = 60$ 微伏，以及 $\\sigma = 20$ 微伏。\n-   Youden 指数定义为 $J(\\tau) = \\text{TPR}(\\tau) - \\text{FPR}(\\tau)$，其中 TPR 是真阳性率，FPR 是假阳性率。\n-   任务是：\n    1.  推导 $J(\\tau)$ 关于标准正态累积分布函数（CDF）的表达式。\n    2.  找到使 $J(\\tau)$ 最大化的最优阈值 $\\tau^{\\star}$，并计算最大值 $J(\\tau^{\\star})$。\n    3.  为最大化 Youden 指数的适用性提供决策理论上的论证。\n    4.  报告 $\\tau^{\\star}$（以微伏为单位）和 $J(\\tau^{\\star})$ 的数值，四舍五入到四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学基础**：该问题在统计决策理论及其在神经科学中尖峰检测的应用方面有很好的基础，这是计算神经科学的一个标准课题。使用高斯模型来描述信号振幅是一种常见且有效的简化假设。\n-   **适定性**：该问题是适定的。所有必要的参数和定义（$\\mathcal{N}(\\mu_{0}, \\sigma^{2})$、$\\mathcal{N}(\\mu_{1}, \\sigma^{2})$、$J(\\tau)$）都已提供，足以推导和优化目标函数。待优化的函数是良态的，确保存在唯一最大值。\n-   **客观性**：问题以精确、客观和量化的术语陈述。\n-   **不完整或矛盾的设置**：问题是自洽且一致的。没有遗漏任何基本信息，也不存在矛盾。\n-   **不切实际或不可行**：参数值（$\\mu_0 = 0$、$\\mu_1 = 60$、$\\sigma = 20$）对于细胞外神经记录是物理上现实的。\n\n### 步骤 3：结论与行动\n问题被判定为**有效**。将提供完整解答。\n\n***\n\n### 1. Youden 指数 $J(\\tau)$ 的推导\nYouden 指数定义为 $J(\\tau) = \\text{TPR}(\\tau) - \\text{FPR}(\\tau)$。我们必须首先推导真阳性率（TPR）和假阳性率（FPR）作为阈值 $\\tau$ 的函数表达式。\n\n真阳性率（或称灵敏度）是在存在尖峰时正确检测到尖峰的概率。这对应于在“尖峰”条件下事件 $A \\geq \\tau$ 发生。\n$$\n\\text{TPR}(\\tau) = P(A \\geq \\tau \\mid \\text{尖峰})\n$$\n在“尖峰”条件下，随机变量 $A$ 服从分布 $\\mathcal{N}(\\mu_{1}, \\sigma^{2})$。为计算此概率，我们通过定义 $Z = \\frac{A - \\mu_{1}}{\\sigma}$ 来标准化该变量，其中 $Z \\sim \\mathcal{N}(0, 1)$。\n不等式 $A \\geq \\tau$ 等价于 $\\frac{A - \\mu_{1}}{\\sigma} \\geq \\frac{\\tau - \\mu_{1}}{\\sigma}$。\n设 $\\Phi(z)$ 为标准正态分布的累积分布函数（CDF），$\\Phi(z) = P(Z \\leq z)$。那么，\n$$\n\\text{TPR}(\\tau) = P\\left(Z \\geq \\frac{\\tau - \\mu_{1}}{\\sigma}\\right) = 1 - P\\left(Z  \\frac{\\tau - \\mu_{1}}{\\sigma}\\right) = 1 - \\Phi\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right)\n$$\n\n假阳性率（或称脱落率）是在仅有噪声时错误宣告存在尖峰的概率。这对应于在“噪声”条件下事件 $A \\geq \\tau$ 发生。\n$$\n\\text{FPR}(\\tau) = P(A \\geq \\tau \\mid \\text{噪声})\n$$\n在“噪声”条件下，随机变量 $A$ 服从分布 $\\mathcal{N}(\\mu_{0}, \\sigma^{2})$。我们通过定义 $Z = \\frac{A - \\mu_{0}}{\\sigma}$ 来标准化该变量，其中 $Z \\sim \\mathcal{N}(0, 1)$。\n不等式 $A \\geq \\tau$ 等价于 $\\frac{A - \\mu_{0}}{\\sigma} \\geq \\frac{\\tau - \\mu_{0}}{\\sigma}$。\n$$\n\\text{FPR}(\\tau) = P\\left(Z \\geq \\frac{\\tau - \\mu_{0}}{\\sigma}\\right) = 1 - P\\left(Z  \\frac{\\tau - \\mu_{0}}{\\sigma}\\right) = 1 - \\Phi\\left(\\frac{\\tau - \\mu_{0}}{\\sigma}\\right)\n$$\n\n现在，我们将这些表达式代入 $J(\\tau)$ 的定义中：\n$$\nJ(\\tau) = \\text{TPR}(\\tau) - \\text{FPR}(\\tau) = \\left[1 - \\Phi\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right)\\right] - \\left[1 - \\Phi\\left(\\frac{\\tau - \\mu_{0}}{\\sigma}\\right)\\right]\n$$\n$$\nJ(\\tau) = \\Phi\\left(\\frac{\\tau - \\mu_{0}}{\\sigma}\\right) - \\Phi\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right)\n$$\n这就是所求的 $J(\\tau)$ 关于标准正态 CDF 的表达式。\n\n### 2. Youden 指数的最大化\n为找到使 $J(\\tau)$ 最大化的阈值 $\\tau^{\\star}$，我们计算 $J(\\tau)$ 对 $\\tau$ 的导数并令其为零。设 $\\phi(z) = \\frac{d\\Phi(z)}{dz} = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{z^2}{2}\\right)$ 为标准正态分布的概率密度函数（PDF）。使用链式法则：\n$$\n\\frac{dJ}{d\\tau} = \\frac{d}{d\\tau}\\left[\\Phi\\left(\\frac{\\tau - \\mu_{0}}{\\sigma}\\right) - \\Phi\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right)\\right] = \\phi\\left(\\frac{\\tau - \\mu_{0}}{\\sigma}\\right) \\cdot \\frac{1}{\\sigma} - \\phi\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right) \\cdot \\frac{1}{\\sigma}\n$$\n将导数设为零以求最优阈值 $\\tau^{\\star}$：\n$$\n\\frac{1}{\\sigma} \\left[ \\phi\\left(\\frac{\\tau^{\\star} - \\mu_{0}}{\\sigma}\\right) - \\phi\\left(\\frac{\\tau^{\\star} - \\mu_{1}}{\\sigma}\\right) \\right] = 0\n$$\n$$\n\\phi\\left(\\frac{\\tau^{\\star} - \\mu_{0}}{\\sigma}\\right) = \\phi\\left(\\frac{\\tau^{\\star} - \\mu_{1}}{\\sigma}\\right)\n$$\n代入 $\\phi(z)$ 的表达式：\n$$\n\\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{1}{2}\\left(\\frac{\\tau^{\\star} - \\mu_{0}}{\\sigma}\\right)^2\\right) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{1}{2}\\left(\\frac{\\tau^{\\star} - \\mu_{1}}{\\sigma}\\right)^2\\right)\n$$\n对两边取自然对数并化简：\n$$\n\\left(\\frac{\\tau^{\\star} - \\mu_{0}}{\\sigma}\\right)^2 = \\left(\\frac{\\tau^{\\star} - \\mu_{1}}{\\sigma}\\right)^2 \\implies (\\tau^{\\star} - \\mu_{0})^2 = (\\tau^{\\star} - \\mu_{1})^2\n$$\n此方程产生两种可能性：\n1. $\\tau^{\\star} - \\mu_{0} = \\tau^{\\star} - \\mu_{1}$，这意味着 $\\mu_{0} = \\mu_{1}$。这是不成立的，因为均值是不同的。\n2. $\\tau^{\\star} - \\mu_{0} = -(\\tau^{\\star} - \\mu_{1}) = \\mu_{1} - \\tau^{\\star}$。\n对第二种情况求解 $\\tau^{\\star}$：\n$$\n2\\tau^{\\star} = \\mu_{0} + \\mu_{1} \\implies \\tau^{\\star} = \\frac{\\mu_{0} + \\mu_{1}}{2}\n$$\n这个值对应于两个类条件 PDF，$p(A|\\text{噪声})$ 和 $p(A|\\text{尖峰})$ 相交的点。为确认这是一个最大值，可以应用二阶导数检验，它会显示在这一点上 $d^2J/d\\tau^2  0$（假定 $\\mu_1 > \\mu_0$）。\n\n现在我们通过将 $\\tau^{\\star}$ 代回 $J(\\tau)$ 的表达式来计算 $J(\\tau^{\\star})$：\n$$\nJ(\\tau^{\\star}) = \\Phi\\left(\\frac{\\frac{\\mu_{0} + \\mu_{1}}{2} - \\mu_{0}}{\\sigma}\\right) - \\Phi\\left(\\frac{\\frac{\\mu_{0} + \\mu_{1}}{2} - \\mu_{1}}{\\sigma}\\right)\n$$\n$$\nJ(\\tau^{\\star}) = \\Phi\\left(\\frac{\\mu_{1} - \\mu_{0}}{2\\sigma}\\right) - \\Phi\\left(\\frac{\\mu_{0} - \\mu_{1}}{2\\sigma}\\right)\n$$\n使用正态 CDF 的对称性质 $\\Phi(-z) = 1 - \\Phi(z)$：\n$$\nJ(\\tau^{\\star}) = \\Phi\\left(\\frac{\\mu_{1} - \\mu_{0}}{2\\sigma}\\right) - \\left[1 - \\Phi\\left(\\frac{\\mu_{1} - \\mu_{0}}{2\\sigma}\\right)\\right] = 2\\Phi\\left(\\frac{\\mu_{1} - \\mu_{0}}{2\\sigma}\\right) - 1\n$$\n\n### 3. 决策理论论证\n最大化 Youden 指数 $J = \\text{TPR} - \\text{FPR}$，在几何上等同于在 ROC 曲线上找到与机会线（$y=x$）垂直距离最大的点。这个标准同等地权衡了增加 TPR 的收益和增加 FPR 的成本。\n\n在特定的决策理论假设下，该策略是**适用**的：\n1.  **对称错分成本**：假阴性（漏掉一个真实尖峰）的成本 $C_{FN}$ 等于假阳性（检测到一个不存在的尖峰）的成本 $C_{FP}$。\n2.  **均等类别先验**：尖峰的先验概率 $P(\\text{尖峰})$ 和噪声的先验概率 $P(\\text{噪声})$ 相等，即 $P(\\text{尖峰}) = P(\\text{噪声}) = 0.5$。\n在这两个条件下，最大化 $J$ 等同于最小化总分类错误率 $P(\\text{错误}) = P(\\text{尖峰}) (1 - \\text{TPR}) + P(\\text{噪声}) \\text{FPR}$，从而最大化整体准确率。\n\n当这些假设被违反时，该策略是**不适用**的：\n1.  **非对称错分成本**：例如，如果漏掉一个尖峰比一次虚警的危害大得多（$C_{FN} \\gg C_{FP}$），则应选择一个较低的阈值来提高 TPR，即使这会导致更高的 FPR。一个例子是癫痫发作的检测，其中漏检事件是至关重要的。最优阈值会移动以优先保证灵敏度。\n2.  **类别不平衡**：在大多数神经科学应用中，尖峰是稀有事件，意味着 $P(\\text{尖峰}) \\ll P(\\text{噪声})$。在这种情况下，即使 FPR 很低，也可能导致大量的假阳性，其绝对数量可能会超过真阳性。最优策略将是选择一个更高的阈值来强制实现一个非常低的 FPR，从而提高检测器的精确率。\n\n一般来说，最优阈值由似然比检验确定，该检验将似然比 $\\frac{p(A|\\text{尖峰})}{p(A|\\text{噪声})}$ 与一个依赖于成本和先验的项 $\\frac{C_{FP} P(\\text{噪声})}{C_{FN} P(\\text{尖峰})}$ 进行比较。最大化 Youden 指数隐含地将此项设为 $1$。\n\n### 4. 数值计算\n使用给定参数：$\\mu_{0} = 0$，$\\mu_{1} = 60$，以及 $\\sigma = 20$。\n\n最优阈值 $\\tau^{\\star}$ 是：\n$$\n\\tau^{\\star} = \\frac{0 + 60}{2} = 30\n$$\n由于参数单位是微伏，$\\tau^{\\star} = 30$ 微伏。\n\n最大 Youden 指数 $J(\\tau^{\\star})$ 是：\n$$\nJ(30) = 2\\Phi\\left(\\frac{60 - 0}{2 \\cdot 20}\\right) - 1 = 2\\Phi\\left(\\frac{60}{40}\\right) - 1 = 2\\Phi(1.5) - 1\n$$\n从标准统计表或计算可知，标准正态 CDF 在 $z=1.5$ 处的值为 $\\Phi(1.5) \\approx 0.9331928...$。\n$$\nJ(30) \\approx 2 \\times 0.9331928 - 1 = 1.8663856 - 1 = 0.8663856\n$$\n将结果四舍五入至四位有效数字：\n-   $\\tau^{\\star} = 30.00$\n-   $J(\\tau^{\\star}) = 0.8664$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 30.00  0.8664 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "掌握ROC分析的最后一步是将理论转化为代码。这个练习将指导您完成构建一个完整的计算流程，从原始分数和标签到完全构建的ROC曲线，再到计算部分曲线下面积（partial Area Under the Curve, pAUC）。这种动手实践对于评估真实的神经分类器至关重要，尤其是在对特定、低假正率区间的性能感兴趣时。",
            "id": "4189171",
            "problem": "给定与电生理学基准真相二元标签在时间窗上对齐的反卷积钙成像活动分数。对于一个包含 $n$ 个时间窗的数据集，设 $s_i \\in \\mathbb{R}$ 表示第 $i$ 个时间窗的反卷积分数， $y_i \\in \\{0,1\\}$ 表示基准真相标签，其中 $y_i = 1$ 表示在时间窗 $i$ 内发生了一个经电生理学确认的事件（峰电位）。事件检测器在阈值为 $\\tau \\in \\mathbb{R}$ 时，如果 $s_i \\ge \\tau$，则宣告一次阳性检测，否则宣告为阴性检测。从第一性原理出发，定义并使用以下概念：\n\n- 在阈值 $\\tau$ 下的真阳性（TP）、假阳性（FP）、真阴性（TN）和假阴性（FN）计数是关于 $y_i$ 的预测函数。\n- 真阳性率（TPR）为 $ \\mathrm{TPR}(\\tau) = \\dfrac{\\mathrm{TP}(\\tau)}{P} $，其中 $P = \\sum_{i=1}^{n} y_i$ 是阳性样本总数。\n- 假阳性率（FPR）为 $ \\mathrm{FPR}(\\tau) = \\dfrac{\\mathrm{FP}(\\tau)}{N} $，其中 $N = \\sum_{i=1}^{n} (1 - y_i)$ 是阴性样本总数。\n- 受试者工作特征（ROC）曲线是通过将阈值 $\\tau$ 从 $+\\infty$ 变化到 $-\\infty$ 所描绘出的一组点 $\\{(\\mathrm{FPR}(\\tau), \\mathrm{TPR}(\\tau)) : \\tau \\in \\mathbb{R}\\}$，仅在能够改变预测的阈值处进行评估，对于有限数据而言，这些阈值是唯一的分数值。\n- 对于给定的假阳性预算 $ \\alpha \\in [0,1] $，部分曲线下面积（partial AUC）是沿 ROC 曲线计算的积分 $$ \\mathrm{pAUC}(\\alpha) = \\int_{0}^{\\alpha} \\mathrm{TPR}(\\mathrm{FPR}) \\, d(\\mathrm{FPR}) $$，计算时使用连续 ROC 点之间的分段线性插值。归一化部分 AUC 定义为 $$ \\mathrm{pAUC}_{\\mathrm{norm}}(\\alpha) = \\begin{cases}\\dfrac{\\mathrm{pAUC}(\\alpha)}{\\alpha},  \\alpha > 0, \\\\ 0,  \\alpha = 0.\\end{cases} $$\n\n您的任务是实现一个完整的、可运行的程序，对于下面提供的每个测试用例，使用上述基本定义从分数和标签构建 ROC 曲线，计算在指定低假阳性率约束 $\\alpha$ 下的部分 AUC，并以小数形式返回归一化的部分 AUC 值。您必须通过将唯一的分数阈值按降序排序、对平局值进行分组，并使用精确计数来生成单调的 $\\mathrm{FPR}$ 和 $\\mathrm{TPR}$ 序列来计算 ROC 曲线，然后使用梯形法则在分段线性 ROC 段上积分直至 $ \\alpha $。\n\n使用以下测试套件。每个测试用例是一个三元组 $(\\mathbf{s}, \\mathbf{y}, \\alpha)$，其中 $\\mathbf{s}$ 是分数列表，$\\mathbf{y}$ 是与 $\\mathbf{s}$ 对齐的标签列表，$\\alpha$ 是最大假阳性率。所有量都是无量纲的，必须表示为小数（而不是百分比）。\n\n- 案例 1（理想情况，中度重叠，大致平衡）：\n  - $\\mathbf{s} = [\\, 0.88, 0.82, 0.79, 0.75, 0.71, 0.64, 0.58, 0.54, 0.66, 0.60, 0.59, 0.57, 0.52, 0.50, 0.46, 0.43, 0.38, 0.34, 0.29, 0.22 \\,]$\n  - $\\mathbf{y} = [\\, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 \\,]$\n  - $\\alpha = 0.10$\n- 案例 2（所有分数相同，类似随机分类器的行为）：\n  - $\\mathbf{s} = [\\, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50 \\,]$\n  - $\\mathbf{y} = [\\, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0 \\,]$\n  - $\\alpha = 0.20$\n- 案例 3（阴性样本高度不平衡，极低的假阳性预算）：\n  - $\\mathbf{s} = [\\, 0.90, 0.87, 0.85, 0.88, 0.86, 0.84, 0.70, 0.60, 0.58, 0.55, 0.52, 0.50, 0.47, 0.45, 0.43, 0.40, 0.37, 0.35, 0.33, 0.30, 0.28, 0.26, 0.24, 0.22, 0.20, 0.18, 0.16, 0.14, 0.12, 0.10 \\,]$\n  - $\\mathbf{y} = [\\, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 \\,]$\n  - $\\alpha = 0.02$\n- 案例 4（完美分离）：\n  - $\\mathbf{s} = [\\, 0.95, 0.92, 0.90, 0.88, 0.85, 0.20, 0.18, 0.15, 0.10, 0.05 \\,]$\n  - $\\mathbf{y} = [\\, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0 \\,]$\n  - $\\alpha = 0.30$\n- 案例 5（反向分类器，低假阳性率下的最差情况）：\n  - $\\mathbf{s} = [\\, 0.20, 0.18, 0.15, 0.10, 0.05, 0.95, 0.92, 0.90, 0.88, 0.85 \\,]$\n  - $\\mathbf{y} = [\\, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0 \\,]$\n  - $\\alpha = 0.10$\n- 案例 6（边界条件 $\\alpha = 0$）：\n  - $\\mathbf{s} = [\\, 0.70, 0.60, 0.55, 0.40 \\,]$\n  - $\\mathbf{y} = [\\, 1, 0, 1, 0 \\,]$\n  - $\\alpha = 0.00$\n\n您的程序应生成单行输出，其中包含按上述顺序排列的各个案例的归一化部分 AUC 值，形式为用方括号括起来的逗号分隔列表，例如 $[r_1,r_2,r_3,r_4,r_5,r_6]$，其中每个 $r_k$ 是案例 $k$ 计算出的 $\\mathrm{pAUC}_{\\mathrm{norm}}(\\alpha)$ 的小数值。",
            "solution": "所述问题是有效的。它在科学上基于信号检测理论的原理，特别是受试者工作特征（ROC）曲线的构建和分析，这是神经科学、机器学习及其他STEM领域评估二元分类器的标准方法。该问题是适定 (well-posed) 的，所有必要的定义、数据和约束都已提供，以确保一个唯一的、可验证的解决方案。其语言客观且数学上精确。因此，我们可以着手进行一个有原则的解决方案。\n\n任务是为一系列数据集计算归一化部分曲线下面积 $\\mathrm{pAUC}_{\\mathrm{norm}}(\\alpha)$。这需要一个两步过程：首先，根据提供的分数和标签构建 ROC 曲线；其次，在该曲线上积分至指定的假阳性率 $\\alpha$。\n\n**1. 从第一性原理构建 ROC 曲线**\n\nROC 曲线说明了一个二元分类器系统在其判别阈值变化时的诊断能力。该曲线绘制了在不同阈值设置下的真阳性率（$\\mathrm{TPR}$）对假阳性率（$\\mathrm{FPR}$）的图。\n\n给定一组分数 $\\{s_i\\}_{i=1}^n$ 和相应的真实二元标签 $\\{y_i\\}_{i=1}^n$（其中 $y_i \\in \\{0,1\\}$），决策规则将分数 $s_i$ 大于或等于阈值 $\\tau$ 的观测 $i$ 分类为阳性，否则为阴性。\n\n基本量在给定阈值 $\\tau$ 下定义如下：\n- 真阳性, $\\mathrm{TP}(\\tau)$: 正确识别的阳性实例计数。$\\mathrm{TP}(\\tau) = \\sum_{i: s_i \\ge \\tau \\land y_i=1} 1$。\n- 假阳性, $\\mathrm{FP}(\\tau)$: 错误识别为阳性的阴性实例计数。$\\mathrm{FP}(\\tau) = \\sum_{i: s_i \\ge \\tau \\land y_i=0} 1$。\n- 真阴性, $\\mathrm{TN}(\\tau)$: 正确识别的阴性实例计数。\n- 假阴性, $\\mathrm{FN}(\\tau)$: 错误识别为阴性的阳性实例计数。\n\n实际阳性实例的总数是 $P = \\sum_{i=1}^n y_i$，实际阴性实例的总数是 $N = \\sum_{i=1}^n (1 - y_i)$。\n\n然后，率定义为：\n- 真阳性率: $\\mathrm{TPR}(\\tau) = \\dfrac{\\mathrm{TP}(\\tau)}{P}$\n- 假阳性率: $\\mathrm{FPR}(\\tau) = \\dfrac{\\mathrm{FP}(\\tau)}{N}$\n\n为了构建 ROC 曲线，我们追踪当 $\\tau$ 从 $+\\infty$ 扫到 $-\\infty$ 时的 $(\\mathrm{FPR}(\\tau), \\mathrm{TPR}(\\tau))$ 点。\n- 在 $\\tau = +\\infty$ 时，没有分数满足标准 $s_i \\ge \\tau$。因此，$\\mathrm{TP}(+\\infty) = 0$ 且 $\\mathrm{FP}(+\\infty) = 0$。这给出了 ROC 曲线的起点 $(\\mathrm{FPR}, \\mathrm{TPR}) = (0, 0)$。\n- 随着 $\\tau$ 的减小，它将穿过分数 $s_i$ 的值。$\\mathrm{TP}(\\tau)$ 和 $\\mathrm{FP}(\\tau)$ 的值是分段常数，仅当 $\\tau$ 等于数据中存在的分数之一时才会改变。因此，我们只需要在对应于唯一分数值的阈值处评估这些率。\n\n生成 ROC 点的算法如下：\n1.  识别数据中的唯一分数值集合，并按降序排序，设其为 $\\{t_1, t_2, \\dots, t_k\\}$，其中 $t_1 > t_2 > \\dots > t_k$。\n2.  初始化累积真阳性 $\\mathrm{tp}_{\\mathrm{cum}}$ 和累积假阳性 $\\mathrm{fp}_{\\mathrm{cum}}$ 为 $0$。用 $(0, 0)$ 初始化 ROC 点列表。\n3.  对于从 $j=1$ 到 $k$ 的每个唯一阈值 $t_j$：\n    a. 在所有分数为 $s_i = t_j$ 的数据点中，计算实际阳性标签的数量（$\\Delta \\mathrm{tp}$）和实际阴性标签的数量（$\\Delta \\mathrm{fp}$）。\n    b. 更新累积计数：$\\mathrm{tp}_{\\mathrm{cum}} \\leftarrow \\mathrm{tp}_{\\mathrm{cum}} + \\Delta \\mathrm{tp}$ 和 $\\mathrm{fp}_{\\mathrm{cum}} \\leftarrow \\mathrm{fp}_{\\mathrm{cum}} + \\Delta \\mathrm{fp}$。\n    c. 将一个新点 $(\\mathrm{fp}_{\\mathrm{cum}}/N, \\mathrm{tp}_{\\mathrm{cum}}/P)$ 添加到 ROC 点列表中。\n这个过程通过在 ROC 图上对角移动来正确处理分数并列的情况，同时增加 $\\mathrm{TPR}$ 和 $\\mathrm{FPR}$。得到的点列表通过线段连接，形成 ROC 曲线。\n\n**2. 部分 AUC 计算与归一化**\n\n部分曲线下面积 $\\mathrm{pAUC}(\\alpha)$ 是 ROC 曲线从 $\\mathrm{FPR}=0$到 $\\mathrm{FPR}=\\alpha$ 的积分：\n$$ \\mathrm{pAUC}(\\alpha) = \\int_{0}^{\\alpha} \\mathrm{TPR}(\\mathrm{FPR}) \\, d(\\mathrm{FPR}) $$\n由于从有限数据构建的 ROC 曲线是分段线性的，这个积分可以计算为由连续 ROC 点形成的梯形面积之和。\n\n设 ROC 点序列为 $(x_0, y_0), (x_1, y_1), \\dots, (x_m, y_m)$，其中 $(x_0, y_0) = (0, 0)$ 且 $x_i = \\mathrm{FPR}_i, y_i = \\mathrm{TPR}_i$。\n计算 $\\mathrm{pAUC}(\\alpha)$ 的算法是：\n1.  初始化总面积 $A$ 为 $0$。\n2.  从 $i=1$ 到 $m$ 遍历 ROC 点。设前一个点为 $(x_{i-1}, y_{i-1})$，当前点为 $(x_i, y_i)$。\n3.  如果前一个点的 FPR 已经超出了预算（即 $x_{i-1} \\ge \\alpha$），则终止积分。\n4.  如果当前段完全在预算内（即 $x_i \\le \\alpha$），则将整个梯形的面积加到总面积上：\n    $$ A \\leftarrow A + \\frac{1}{2} (y_i + y_{i-1})(x_i - x_{i-1}) $$\n5.  如果当前段穿过预算边界（即 $x_{i-1}  \\alpha  x_i$），我们必须只积分到 $\\alpha$。我们通过沿从 $(x_{i-1}, y_{i-1})$ 到 $(x_i, y_i)$ 的线段进行线性插值来找到 $\\mathrm{FPR}=\\alpha$ 时的 TPR 值：\n    $$ y_{\\alpha} = y_{i-1} + (y_i - y_{i-1}) \\frac{\\alpha - x_{i-1}}{x_i - x_{i-1}} $$\n    这个最后的、被截断的梯形面积是：\n    $$ A \\leftarrow A + \\frac{1}{2} (y_{\\alpha} + y_{i-1})(\\alpha - x_{i-1}) $$\n    加上这个面积后，积分完成，因此我们终止循环。\n\n最后，问题要求的是归一化部分 AUC，其定义为：\n$$ \\mathrm{pAUC}_{\\mathrm{norm}}(\\alpha) = \\begin{cases}\\dfrac{\\mathrm{pAUC}(\\alpha)}{\\alpha},  \\alpha > 0, \\\\ 0,  \\alpha = 0.\\end{cases} $$\n这种归一化对结果进行了缩放。对于一个在任何 $\\mathrm{FPR}>0$ 时都能达到 $\\mathrm{TPR}=1$ 的完美分类器，$\\mathrm{pAUC}(\\alpha)$ 将是 $\\alpha$，因此 $\\mathrm{pAUC}_{\\mathrm{norm}}(\\alpha)=1$。对于一个不比沿对角线随机猜测（$\\mathrm{TPR}=\\mathrm{FPR}$）更好的分类器，$\\mathrm{pAUC}(\\alpha) = \\alpha^2/2$，且 $\\mathrm{pAUC}_{\\mathrm{norm}}(\\alpha)=\\alpha/2$。对于在低 FPR 区域只产生假阳性的最差情况分类器，$\\mathrm{pAUC}_{\\mathrm{norm}}(\\alpha)=0$。\n\n以下实现遵循这些原则来解决所提供的测试用例。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem for all test cases specified.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (happy path, moderate overlap, balanced-ish)\n        (\n            [0.88, 0.82, 0.79, 0.75, 0.71, 0.64, 0.58, 0.54, 0.66, 0.60, 0.59, 0.57, 0.52, 0.50, 0.46, 0.43, 0.38, 0.34, 0.29, 0.22],\n            [1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            0.10\n        ),\n        # Case 2 (all scores identical, random-like classifier behavior)\n        (\n            [0.50, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50],\n            [1, 1, 1, 1, 1, 0, 0, 0, 0, 0],\n            0.20\n        ),\n        # Case 3 (highly imbalanced negatives, extremely low false positive budget)\n        (\n            [0.90, 0.87, 0.85, 0.88, 0.86, 0.84, 0.70, 0.60, 0.58, 0.55, 0.52, 0.50, 0.47, 0.45, 0.43, 0.40, 0.37, 0.35, 0.33, 0.30, 0.28, 0.26, 0.24, 0.22, 0.20, 0.18, 0.16, 0.14, 0.12, 0.10],\n            [1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            0.02\n        ),\n        # Case 4 (perfect separation)\n        (\n            [0.95, 0.92, 0.90, 0.88, 0.85, 0.20, 0.18, 0.15, 0.10, 0.05],\n            [1, 1, 1, 1, 1, 0, 0, 0, 0, 0],\n            0.30\n        ),\n        # Case 5 (inverted classifier, worst-case under low false positives)\n        (\n            [0.20, 0.18, 0.15, 0.10, 0.05, 0.95, 0.92, 0.90, 0.88, 0.85],\n            [1, 1, 1, 1, 1, 0, 0, 0, 0, 0],\n            0.10\n        ),\n        # Case 6 (boundary condition alpha = 0)\n        (\n            [0.70, 0.60, 0.55, 0.40],\n            [1, 0, 1, 0],\n            0.00\n        )\n    ]\n\n    results = []\n    for scores, labels, alpha in test_cases:\n        result = calculate_pauc_norm(scores, labels, alpha)\n        results.append(f\"{result:.8f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_pauc_norm(scores, labels, alpha):\n    \"\"\"\n    Computes the normalized partial Area Under the ROC Curve (pAUC_norm).\n\n    Args:\n        scores (list or np.ndarray): Deconvolved activity scores.\n        labels (list or np.ndarray): Ground-truth binary labels (0 or 1).\n        alpha (float): The maximum false positive rate for partial AUC calculation.\n\n    Returns:\n        float: The normalized partial AUC value.\n    \"\"\"\n    if alpha == 0.0:\n        return 0.0\n\n    scores = np.asarray(scores, dtype=np.float64)\n    labels = np.asarray(labels, dtype=np.int32)\n    \n    pos_mask = (labels == 1)\n    neg_mask = (labels == 0)\n    \n    P = np.sum(pos_mask)\n    N = np.sum(neg_mask)\n\n    if P == 0 or N == 0:\n        # If no positives, TPR is always 0, so pAUC is 0.\n        # If no negatives, FPR is always 0, ROC is a vertical line at FPR=0,\n        # so integral over [0, alpha] has zero width and area is 0.\n        return 0.0\n\n    # Get unique scores and sort them in descending order for threshold sweeping\n    unique_scores = np.unique(scores)[::-1]\n    \n    roc_points = [(0.0, 0.0)]\n    tp_cum = 0\n    fp_cum = 0\n    \n    # Construct ROC curve points by processing scores in descending order\n    for threshold in unique_scores:\n        threshold_mask = (scores == threshold)\n        delta_tp = np.sum(pos_mask[threshold_mask])\n        delta_fp = np.sum(neg_mask[threshold_mask])\n        \n        tp_cum += delta_tp\n        fp_cum += delta_fp\n        \n        roc_points.append((fp_cum / N, tp_cum / P))\n\n    # Calculate partial AUC using trapezoidal rule\n    pauc = 0.0\n    for i in range(1, len(roc_points)):\n        x_prev, y_prev = roc_points[i - 1]\n        x_curr, y_curr = roc_points[i]\n\n        # Stop if the previous point is already past the budget\n        if x_prev = alpha:\n            break\n\n        # If the whole segment is within the budget, add the full trapezoid area\n        if x_curr = alpha:\n            pauc += 0.5 * (y_prev + y_curr) * (x_curr - x_prev)\n        # If the segment crosses the budget, add the area up to alpha and stop\n        else:\n            # Check for vertical line case: x_curr == x_prev\n            # If so, this segment has zero width and adds no area.\n            if x_curr > x_prev:\n                # Interpolate TPR at FPR = alpha\n                y_interp = y_prev + (y_curr - y_prev) * (alpha - x_prev) / (x_curr - x_prev)\n                pauc += 0.5 * (y_prev + y_interp) * (alpha - x_prev)\n            break\n            \n    # Normalize the partial AUC by alpha\n    pauc_norm = pauc / alpha\n    return pauc_norm\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}