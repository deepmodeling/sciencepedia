{
    "hands_on_practices": [
        {
            "introduction": "在评估一个分类器时，我们常常希望找到一个“最优”的操作点。约登指数（Youden's Index），定义为 $J = \\mathrm{TPR} - \\mathrm{FPR}$，提供了一个直观的优化标准，它在几何上对应于ROC曲线上离机会线（$y=x$）最远的点。本练习将指导您，在一个神经科学中常见的场景下（即用高斯分布对神经元发放进行建模），推导出能最大化约登指数的最优阈值，从而锻炼您的解析推导能力。",
            "id": "4189213",
            "problem": "对来自皮层神经元的单通道细胞外记录使用一个简单的阈值检测器进行分析，该检测器作用于一个标量检测统计量 $A$（带通滤波片段的峰峰值振幅）。在一个时间窗内，只要 $A \\geq \\tau$（其中 $\\tau$ 为某个阈值），检测器就宣告一个脉冲。假设一个生成模型，其中 $A$ 的类条件分布是方差相等的高斯分布：在噪声（无脉冲）条件下，$A \\mid \\text{噪声} \\sim \\mathcal{N}(\\mu_{0}, \\sigma^{2})$；在脉冲条件下，$A \\mid \\text{脉冲} \\sim \\mathcal{N}(\\mu_{1}, \\sigma^{2})$。在此记录中，经验校准得出 $\\mu_{0} = 0$ 微伏，$\\mu_{1} = 60$ 微伏，以及 $\\sigma = 20$ 微伏。\n\n仅使用受试者工作特征（ROC）曲线关于真阳性率和假阳性率的核心定义，以及 Youden 指数 $J(\\tau)$ 定义为灵敏度（真阳性率）与脱落率（假阳性率）之差，完成以下任务：\n\n1. 从 $J(\\tau) = \\text{TPR}(\\tau) - \\text{FPR}(\\tau)$ 和上述类条件高斯模型出发，推导 $J(\\tau)$ 关于标准正态累积分布函数的表达式。\n2. 从第一性原理出发，确定使 $J(\\tau)$ 最大化的阈值 $\\tau^{\\star}$，并计算 $J(\\tau^{\\star})$。\n3. 从决策理论的角度简要论证，在存在对称与非对称错分成本以及类别不平衡的情况下，最大化 Youden 指数分别在何时是合适的与不合适的。\n\n使用给定参数，报告最优阈值和最大化后的 Youden 指数的数值。阈值以微伏为单位。将阈值和最大化后的 Youden 指数均四舍五入至四位有效数字。最终答案应仅包含数值（无单位），顺序为 $\\tau^{\\star}, J(\\tau^{\\star})$。",
            "solution": "首先对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n-   检测统计量是一个标量 $A$。\n-   如果检测统计量 $A$ 大于或等于阈值 $\\tau$（即 $A \\geq \\tau$），则宣告一个脉冲。\n-   给定噪声条件下，$A$ 的类条件概率分布为 $A \\mid \\text{噪声} \\sim \\mathcal{N}(\\mu_{0}, \\sigma^{2})$。\n-   给定脉冲条件下，$A$ 的类条件概率分布为 $A \\mid \\text{脉冲} \\sim \\mathcal{N}(\\mu_{1}, \\sigma^{2})$。\n-   给定参数为 $\\mu_{0} = 0$ 微伏，$\\mu_{1} = 60$ 微伏，以及 $\\sigma = 20$ 微伏。\n-   Youden 指数定义为 $J(\\tau) = \\text{TPR}(\\tau) - \\text{FPR}(\\tau)$，其中 TPR 是真阳性率，FPR 是假阳性率。\n-   任务是：\n    1.  推导 $J(\\tau)$ 关于标准正态累积分布函数（CDF）的表达式。\n    2.  找到使 $J(\\tau)$ 最大化的最优阈值 $\\tau^{\\star}$，并计算最大值 $J(\\tau^{\\star})$。\n    3.  为最大化 Youden 指数的适用性提供决策理论上的论证。\n    4.  报告 $\\tau^{\\star}$（以微伏为单位）和 $J(\\tau^{\\star})$ 的数值，四舍五入到四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学依据**：该问题在统计决策理论及其在神经科学脉冲检测中的应用方面有充分的依据，这是计算神经科学中的一个标准课题。使用高斯模型来描述信号振幅是一种常见且有效的简化假设。\n-   **适定性**：问题是适定的。所有必要的参数和定义（$\\mathcal{N}(\\mu_{0}, \\sigma^{2})$、$\\mathcal{N}(\\mu_{1}, \\sigma^{2})$、$J(\\tau)$）都已提供，足以推导和优化目标函数。待优化的函数性质良好，确保存在唯一的最大值。\n-   **客观性**：问题以精确、客观和量化的方式陈述。\n-   **不完整或矛盾的设置**：问题是自洽且一致的。没有缺少必要信息，也不存在矛盾。\n-   **不切实际或不可行**：参数值（$\\mu_0 = 0$, $\\mu_1 = 60$, $\\sigma = 20$）对于细胞外神经记录是物理上现实的。\n\n### 步骤 3：结论与行动\n问题被判定为**有效**。将提供完整解答。\n\n***\n\n### 1. Youden 指数 $J(\\tau)$ 的推导\nYouden 指数定义为 $J(\\tau) = \\text{TPR}(\\tau) - \\text{FPR}(\\tau)$。我们必须首先推导真阳性率（TPR）和假阳性率（FPR）作为阈值 $\\tau$ 的函数的表达式。\n\n真阳性率，或称灵敏度，是在存在脉冲时正确检测到脉冲的概率。这对应于“脉冲”条件下事件 $A \\geq \\tau$ 的发生。\n$$\n\\text{TPR}(\\tau) = P(A \\geq \\tau \\mid \\text{脉冲})\n$$\n在“脉冲”条件下，随机变量 $A$ 服从分布 $\\mathcal{N}(\\mu_{1}, \\sigma^{2})$。为计算此概率，我们通过定义 $Z = \\frac{A - \\mu_{1}}{\\sigma}$ 来标准化该变量，其中 $Z \\sim \\mathcal{N}(0, 1)$。\n不等式 $A \\geq \\tau$ 等价于 $\\frac{A - \\mu_{1}}{\\sigma} \\geq \\frac{\\tau - \\mu_{1}}{\\sigma}$。\n设 $\\Phi(z)$ 为标准正态分布的累积分布函数（CDF），$\\Phi(z) = P(Z \\leq z)$。那么，\n$$\n\\text{TPR}(\\tau) = P\\left(Z \\geq \\frac{\\tau - \\mu_{1}}{\\sigma}\\right) = 1 - P\\left(Z  \\frac{\\tau - \\mu_{1}}{\\sigma}\\right) = 1 - \\Phi\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right)\n$$\n\n假阳性率，或称脱落率，是在仅有噪声时错误宣告存在脉冲的概率。这对应于“噪声”条件下事件 $A \\geq \\tau$ 的发生。\n$$\n\\text{FPR}(\\tau) = P(A \\geq \\tau \\mid \\text{噪声})\n$$\n在“噪声”条件下，随机变量 $A$ 服从分布 $\\mathcal{N}(\\mu_{0}, \\sigma^{2})$。我们通过定义 $Z = \\frac{A - \\mu_{0}}{\\sigma}$ 来标准化该变量，其中 $Z \\sim \\mathcal{N}(0, 1)$。\n不等式 $A \\geq \\tau$ 等价于 $\\frac{A - \\mu_{0}}{\\sigma} \\geq \\frac{\\tau - \\mu_{0}}{\\sigma}$。\n$$\n\\text{FPR}(\\tau) = P\\left(Z \\geq \\frac{\\tau - \\mu_{0}}{\\sigma}\\right) = 1 - P\\left(Z  \\frac{\\tau - \\mu_{0}}{\\sigma}\\right) = 1 - \\Phi\\left(\\frac{\\tau - \\mu_{0}}{\\sigma}\\right)\n$$\n\n现在，我们将这些表达式代入 $J(\\tau)$ 的定义中：\n$$\nJ(\\tau) = \\text{TPR}(\\tau) - \\text{FPR}(\\tau) = \\left[1 - \\Phi\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right)\\right] - \\left[1 - \\Phi\\left(\\frac{\\tau - \\mu_{0}}{\\sigma}\\right)\\right]\n$$\n$$\nJ(\\tau) = \\Phi\\left(\\frac{\\tau - \\mu_{0}}{\\sigma}\\right) - \\Phi\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right)\n$$\n这就是所求的 $J(\\tau)$ 关于标准正态CDF的表达式。\n\n### 2. Youden 指数的最大化\n为了找到使 $J(\\tau)$ 最大化的阈值 $\\tau^{\\star}$，我们计算 $J(\\tau)$ 对 $\\tau$ 的导数并将其设为零。设 $\\phi(z) = \\frac{d\\Phi(z)}{dz} = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{z^2}{2}\\right)$ 为标准正态分布的概率密度函数（PDF）。使用链式法则：\n$$\n\\frac{dJ}{d\\tau} = \\frac{d}{d\\tau}\\left[\\Phi\\left(\\frac{\\tau - \\mu_{0}}{\\sigma}\\right) - \\Phi\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right)\\right] = \\phi\\left(\\frac{\\tau - \\mu_{0}}{\\sigma}\\right) \\cdot \\frac{1}{\\sigma} - \\phi\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right) \\cdot \\frac{1}{\\sigma}\n$$\n将导数设为零以求最优阈值 $\\tau^{\\star}$：\n$$\n\\frac{1}{\\sigma} \\left[ \\phi\\left(\\frac{\\tau^{\\star} - \\mu_{0}}{\\sigma}\\right) - \\phi\\left(\\frac{\\tau^{\\star} - \\mu_{1}}{\\sigma}\\right) \\right] = 0\n$$\n$$\n\\phi\\left(\\frac{\\tau^{\\star} - \\mu_{0}}{\\sigma}\\right) = \\phi\\left(\\frac{\\tau^{\\star} - \\mu_{1}}{\\sigma}\\right)\n$$\n代入 $\\phi(z)$ 的表达式：\n$$\n\\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{1}{2}\\left(\\frac{\\tau^{\\star} - \\mu_{0}}{\\sigma}\\right)^2\\right) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{1}{2}\\left(\\frac{\\tau^{\\star} - \\mu_{1}}{\\sigma}\\right)^2\\right)\n$$\n对两边取自然对数并化简：\n$$\n\\left(\\frac{\\tau^{\\star} - \\mu_{0}}{\\sigma}\\right)^2 = \\left(\\frac{\\tau^{\\star} - \\mu_{1}}{\\sigma}\\right)^2 \\implies (\\tau^{\\star} - \\mu_{0})^2 = (\\tau^{\\star} - \\mu_{1})^2\n$$\n这个方程产生两种可能性：\n1. $\\tau^{\\star} - \\mu_{0} = \\tau^{\\star} - \\mu_{1}$，这意味着 $\\mu_{0} = \\mu_{1}$。这是错误的，因为两个均值是不同的。\n2. $\\tau^{\\star} - \\mu_{0} = -(\\tau^{\\star} - \\mu_{1}) = \\mu_{1} - \\tau^{\\star}$。\n对第二种情况求解 $\\tau^{\\star}$：\n$$\n2\\tau^{\\star} = \\mu_{0} + \\mu_{1} \\implies \\tau^{\\star} = \\frac{\\mu_{0} + \\mu_{1}}{2}\n$$\n该值对应于两个类条件PDF，$p(A|\\text{噪声})$ 和 $p(A|\\text{脉冲})$ 相交的点。为确认这是一个最大值，可以应用二阶导数检验，它会表明在该点 $\\frac{d^2J}{d\\tau^2}  0$，因为 $\\mu_1 > \\mu_0$。\n\n现在我们通过将 $\\tau^{\\star}$ 代回 $J(\\tau)$ 的表达式来计算 $J(\\tau^{\\star})$：\n$$\nJ(\\tau^{\\star}) = \\Phi\\left(\\frac{\\frac{\\mu_{0} + \\mu_{1}}{2} - \\mu_{0}}{\\sigma}\\right) - \\Phi\\left(\\frac{\\frac{\\mu_{0} + \\mu_{1}}{2} - \\mu_{1}}{\\sigma}\\right)\n$$\n$$\nJ(\\tau^{\\star}) = \\Phi\\left(\\frac{\\mu_{1} - \\mu_{0}}{2\\sigma}\\right) - \\Phi\\left(\\frac{\\mu_{0} - \\mu_{1}}{2\\sigma}\\right)\n$$\n利用正态CDF的对称性 $\\Phi(-z) = 1 - \\Phi(z)$：\n$$\nJ(\\tau^{\\star}) = \\Phi\\left(\\frac{\\mu_{1} - \\mu_{0}}{2\\sigma}\\right) - \\left[1 - \\Phi\\left(\\frac{\\mu_{1} - \\mu_{0}}{2\\sigma}\\right)\\right] = 2\\Phi\\left(\\frac{\\mu_{1} - \\mu_{0}}{2\\sigma}\\right) - 1\n$$\n\n### 3. 决策理论论证\n最大化 Youden 指数，$J = \\text{TPR} - \\text{FPR}$，在几何上等同于在 ROC 曲线上找到与机会线（$y=x$）垂直距离最大的点。该准则同等地权衡了增加 TPR 的收益和增加 FPR 的成本。\n\n在特定的决策理论假设下，该策略是**合适的**：\n1.  **对称的错分成本**：假阴性（漏掉一个真实脉冲）的成本 $C_{FN}$ 等于假阳性（检测到一个不存在的脉冲）的成本 $C_{FP}$。\n2.  **相等的类别先验概率**：脉冲的先验概率 $P(\\text{脉冲})$ 与噪声的先验概率 $P(\\text{噪声})$ 相等，即 $P(\\text{脉冲}) = P(\\text{噪声}) = 0.5$。\n在这两个条件下，最大化 $J$ 等同于最小化总分类错误率 $P(\\text{错误}) = P(\\text{脉冲}) (1 - \\text{TPR}) + P(\\text{噪声}) \\text{FPR}$，从而最大化整体准确率。\n\n当这些假设被违反时，该策略是**不合适的**：\n1.  **非对称的错分成本**：例如，如果漏掉一个脉冲比一个假警报的危害大得多（$C_{FN} \\gg C_{FP}$），则应选择一个较低的阈值以增加 TPR，即使这会以更高的 FPR 为代价。一个例子是癫痫发作的检测，其中漏检事件是至关重要的。最优阈值会移动以优先考虑灵敏度。\n2.  **类别不平衡**：在大多数神经科学应用中，脉冲是罕见事件，意味着 $P(\\text{脉冲}) \\ll P(\\text{噪声})$。在这种情况下，即使 FPR 很低，也可能导致大量的假阳性，可能会淹没真阳性。最优策略是选择一个更高的阈值来强制实现非常低的 FPR，从而提高检测器的精确度。\n\n通常，最优阈值由似然比检验确定，该检验将似然比 $\\frac{p(A|\\text{脉冲})}{p(A|\\text{噪声})}$ 与一个依赖于成本和先验概率的项 $\\frac{C_{FP} P(\\text{噪声})}{C_{FN} P(\\text{脉冲})}$ 进行比较。最大化 Youden 指数隐含地将此项的值设为 $1$。\n\n### 4. 数值计算\n使用给定参数：$\\mu_{0} = 0$，$\\mu_{1} = 60$，和 $\\sigma = 20$。\n\n最优阈值 $\\tau^{\\star}$ 为：\n$$\n\\tau^{\\star} = \\frac{0 + 60}{2} = 30\n$$\n由于参数单位是微伏，$\\tau^{\\star} = 30$ 微伏。\n\n最大 Youden 指数 $J(\\tau^{\\star})$ 为：\n$$\nJ(30) = 2\\Phi\\left(\\frac{60 - 0}{2 \\cdot 20}\\right) - 1 = 2\\Phi\\left(\\frac{60}{40}\\right) - 1 = 2\\Phi(1.5) - 1\n$$\n根据标准统计表或计算，标准正态 CDF 在 $z=1.5$ 处的值为 $\\Phi(1.5) \\approx 0.9331928...$。\n$$\nJ(30) \\approx 2 \\times 0.9331928 - 1 = 1.8663856 - 1 = 0.8663856\n$$\n将结果四舍五入至四位有效数字：\n-   $\\tau^{\\star} = 30.00$\n-   $J(\\tau^{\\star}) = 0.8664$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 30.00  0.8664 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在现实世界的应用中，不同类型错误（例如假阳性和假阴性）所带来的代价往往是不对等的。本练习在前一个练习的基础上，引入了一个更复杂但也更贴近实际的决策理论框架，目标是找到一个能最小化总期望代价的贝叶斯最优阈值。通过这个练习，您将学会如何综合考虑非对称的错误代价和类别不平衡问题，并将最优决策与ROC曲线的切线斜率联系起来。",
            "id": "4189176",
            "problem": "一个皮层解码器产生一个连续的神经度量分数 $S$，旨在指示一个短暂的体感刺激是否存在（$Y=1$）或不存在（$Y=0$）。在某一特定实验条件下，$S$ 的条件分布可以很好地用等方差的高斯密度来描述：当 $Y=1$ 时，$S \\sim \\mathcal{N}(\\mu_{1}, \\sigma^{2})$；当 $Y=0$ 时，$S \\sim \\mathcal{N}(\\mu_{0}, \\sigma^{2})$。一个阈值规则规定：如果 $S \\geq \\tau$，则判断刺激存在，否则判断为不存在。设刺激存在试验的先验概率为 $\\pi = \\mathbb{P}(Y=1)$，则 $\\mathbb{P}(Y=0)=1-\\pi$。设 $C_{FP}$ 表示假阳性（当刺激不存在时判断为存在）的成本，$C_{FN}$ 表示假阴性（当刺激存在时判断为不存在）的成本。受试者工作特征（ROC）曲线是由阈值 $\\tau$ 索引的所有可达到的真阳性率（TPR）和假阳性率（FPR）对组成的集合，其中 $\\mathrm{TPR}(\\tau) = \\mathbb{P}(S \\geq \\tau \\mid Y=1)$ 且 $\\mathrm{FPR}(\\tau) = \\mathbb{P}(S \\geq \\tau \\mid Y=0)$。\n\n仅从期望错分成本、高斯密度以及ROC作为阈值的参数曲线的定义出发，推导最小化期望错分成本的贝叶斯最优阈值 $\\tau^{\\star}$。然后，使用ROC由 $\\tau$ 参数化的表示，说明在最优工作点处ROC曲线的斜率如何与成本最小化所隐含的切线条件相关联。\n\n最后，根据以下实验测得的参数值计算最优阈值：$\\mu_{0} = -0.2$, $\\mu_{1} = 1.0$, $\\sigma = 0.5$, $C_{FP} = 2$, $C_{FN} = 4$, $\\pi = 0.4$。将您的 $\\tau^{\\star}$ 数值答案四舍五入到四位有效数字。",
            "solution": "首先验证问题，以确保其具有科学依据、良构且客观。\n\n### 步骤1：提取已知条件\n- 神经度量分数：$S$。\n- 刺激状态：$Y=1$（存在），$Y=0$（不存在）。\n- 刺激存在时的条件分布（$Y=1$）：$S \\sim \\mathcal{N}(\\mu_{1}, \\sigma^{2})$。\n- 刺激不存在时的条件分布（$Y=0$）：$S \\sim \\mathcal{N}(\\mu_{0}, \\sigma^{2})$。\n- 决策规则：如果 $S \\geq \\tau$，则判断刺激存在，如果 $S  \\tau$，则判断刺激不存在。\n- 刺激存在试验的先验概率：$\\pi = \\mathbb{P}(Y=1)$，$\\mathbb{P}(Y=0)=1-\\pi$。\n- 假阳性成本：$C_{FP}$。\n- 假阴性成本：$C_{FN}$。\n- 真阳性率：$\\mathrm{TPR}(\\tau) = \\mathbb{P}(S \\geq \\tau \\mid Y=1)$。\n- 假阳性率：$\\mathrm{FPR}(\\tau) = \\mathbb{P}(S \\geq \\tau \\mid Y=0)$。\n- 任务1：推导最小化期望错分成本的贝叶斯最优阈值 $\\tau^{\\star}$。\n- 任务2：将ROC曲线在 $\\tau^{\\star}$ 处的斜率与成本最小化所隐含的切线条件联系起来。\n- 任务3：根据参数 $\\mu_{0} = -0.2$, $\\mu_{1} = 1.0$, $\\sigma = 0.5$, $C_{FP} = 2$, $C_{FN} = 4$, $\\pi = 0.4$ 计算 $\\tau^{\\star}$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，使用了信号检测论和贝叶斯决策论的标准原理，这些是神经科学数据分析的核心。使用高斯分布来建模神经响应是一种常见且有效的简化。该问题是良构的，提供了所有必要的参数（$\\mu_0, \\mu_1, \\sigma, C_{FP}, C_{FN}, \\pi$）和一个明确的目标（最小化期望成本）。术语精确且客观。该问题是自洽的、一致的，并且不违反任何科学或数学原理。\n\n### 步骤3：结论与行动\n问题有效。我们开始求解。\n\n### 第1部分：贝叶斯最优阈值 $\\tau^{\\star}$ 的推导\n\n期望错分成本 $C(\\tau)$ 是假阳性和假阴性期望成本的总和。当 $Y=0$ 但决策为 $1$（即 $S \\geq \\tau$）时，发生假阳性。当 $Y=1$ 但决策为 $0$（即 $S  \\tau$）时，发生假阴性。\n\n期望成本由下式给出：\n$$\nC(\\tau) = C_{FP} \\cdot \\mathbb{P}(\\text{决策}=1, Y=0) + C_{FN} \\cdot \\mathbb{P}(\\text{决策}=0, Y=1)\n$$\n根据全概率定律和决策规则：\n$$\nC(\\tau) = C_{FP} \\cdot \\mathbb{P}(S \\geq \\tau \\mid Y=0) \\mathbb{P}(Y=0) + C_{FN} \\cdot \\mathbb{P}(S  \\tau \\mid Y=1) \\mathbb{P}(Y=1)\n$$\n设 $p(s|Y=i)$ 表示给定状态 $Y=i$ 时分数 $S$ 的概率密度函数（PDF）。对于 $i \\in \\{0, 1\\}$，这是高斯PDF：$p(s|Y=i) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(s-\\mu_i)^2}{2\\sigma^2}\\right)$。\n成本函数可以写成积分形式：\n$$\nC(\\tau) = C_{FP} (1-\\pi) \\int_{\\tau}^{\\infty} p(s|Y=0) \\,ds + C_{FN} \\pi \\int_{-\\infty}^{\\tau} p(s|Y=1) \\,ds\n$$\n为了找到最小化 $C(\\tau)$ 的阈值 $\\tau^{\\star}$，我们将 $C(\\tau)$ 对 $\\tau$ 求导，并令其结果为零。使用莱布尼茨积分法则（$\\frac{d}{dx} \\int_{a(x)}^{b(x)} f(t) dt = f(b(x))b'(x) - f(a(x))a'(x)$），我们得到：\n$$\n\\frac{dC(\\tau)}{d\\tau} = C_{FP} (1-\\pi) [-p(\\tau|Y=0)] + C_{FN} \\pi [p(\\tau|Y=1)]\n$$\n为求最优阈值 $\\tau^{\\star}$，将导数设为零：\n$$\nC_{FN} \\pi p(\\tau^{\\star}|Y=1) = C_{FP} (1-\\pi) p(\\tau^{\\star}|Y=0)\n$$\n这可以重排为一个似然比条件：\n$$\n\\frac{p(\\tau^{\\star}|Y=1)}{p(\\tau^{\\star}|Y=0)} = \\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi}\n$$\n现在，我们将高斯PDF代入此方程。常数项 $\\frac{1}{\\sqrt{2\\pi\\sigma^2}}$ 被消掉：\n$$\n\\frac{\\exp\\left(-\\frac{(\\tau^{\\star}-\\mu_1)^2}{2\\sigma^2}\\right)}{\\exp\\left(-\\frac{(\\tau^{\\star}-\\mu_0)^2}{2\\sigma^2}\\right)} = \\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi}\n$$\n$$\n\\exp\\left(\\frac{(\\tau^{\\star}-\\mu_0)^2 - (\\tau^{\\star}-\\mu_1)^2}{2\\sigma^2}\\right) = \\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi}\n$$\n对两边取自然对数：\n$$\n\\frac{(\\tau^{\\star}-\\mu_0)^2 - (\\tau^{\\star}-\\mu_1)^2}{2\\sigma^2} = \\ln\\left(\\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi}\\right)\n$$\n展开分子中的平方项：\n$$\n(\\tau^{\\star2} - 2\\tau^{\\star}\\mu_0 + \\mu_0^2) - (\\tau^{\\star2} - 2\\tau^{\\star}\\mu_1 + \\mu_1^2) = 2\\tau^{\\star}(\\mu_1 - \\mu_0) - (\\mu_1^2 - \\mu_0^2)\n$$\n将其代回并求解 $\\tau^{\\star}$：\n$$\n2\\tau^{\\star}(\\mu_1 - \\mu_0) - (\\mu_1^2 - \\mu_0^2) = 2\\sigma^2 \\ln\\left(\\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi}\\right)\n$$\n$$\n2\\tau^{\\star}(\\mu_1 - \\mu_0) = \\mu_1^2 - \\mu_0^2 + 2\\sigma^2 \\ln\\left(\\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi}\\right)\n$$\n$$\n2\\tau^{\\star}(\\mu_1 - \\mu_0) = (\\mu_1 - \\mu_0)(\\mu_1 + \\mu_0) + 2\\sigma^2 \\ln\\left(\\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi}\\right)\n$$\n假设 $\\mu_1 \\neq \\mu_0$，我们除以 $2(\\mu_1 - \\mu_0)$：\n$$\n\\tau^{\\star} = \\frac{\\mu_1+\\mu_0}{2} + \\frac{\\sigma^2}{\\mu_1-\\mu_0} \\ln\\left(\\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi}\\right)\n$$\n\n### 第2部分：ROC斜率和切线条件\n\nROC曲线是 $(\\mathrm{FPR}(\\tau), \\mathrm{TPR}(\\tau))$ 的参数图。ROC曲线上对应于阈值 $\\tau$ 的点的斜率为 $\\frac{d(\\mathrm{TPR})}{d(\\mathrm{FPR})}$。根据链式法则，这等于 $\\frac{d(\\mathrm{TPR})/d\\tau}{d(\\mathrm{FPR})/d\\tau}$。\n\n首先，我们求TPR和FPR对 $\\tau$ 的导数：\n$$\n\\mathrm{TPR}(\\tau) = \\int_{\\tau}^{\\infty} p(s|Y=1) \\,ds \\implies \\frac{d(\\mathrm{TPR})}{d\\tau} = -p(\\tau|Y=1)\n$$\n$$\n\\mathrm{FPR}(\\tau) = \\int_{\\tau}^{\\infty} p(s|Y=0) \\,ds \\implies \\frac{d(\\mathrm{FPR})}{d\\tau} = -p(\\tau|Y=0)\n$$\n因此，ROC曲线的斜率为：\n$$\n\\frac{d(\\mathrm{TPR})}{d(\\mathrm{FPR})} = \\frac{-p(\\tau|Y=1)}{-p(\\tau|Y=0)} = \\frac{p(\\tau|Y=1)}{p(\\tau|Y=0)}\n$$\n这是分数 $\\tau$ 处的似然比。\n\n现在考虑成本最小化带来的切线条件。总成本为 $C(\\tau) = C_{FP}(1-\\pi)\\mathrm{FPR}(\\tau) + C_{FN}\\pi(1-\\mathrm{TPR}(\\tau))$。\n在ROC空间中（坐标轴为FPR, TPR），恒定期望成本线（等成本线）定义为：\n$$\nC_{\\text{const}} = C_{FP}(1-\\pi)\\mathrm{FPR} + C_{FN}\\pi(1-\\mathrm{TPR})\n$$\n重新整理以将TPR表示为FPR的函数（类似于 $y=mx+b$）：\n$$\nC_{FN}\\pi\\mathrm{TPR} = C_{FP}(1-\\pi)\\mathrm{FPR} + C_{FN}\\pi - C_{\\text{const}}\n$$\n$$\n\\mathrm{TPR} = \\left(\\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi}\\right)\\mathrm{FPR} + \\left(1 - \\frac{C_{\\text{const}}}{C_{FN}\\pi}\\right)\n$$\n这些等成本线的斜率是恒定的，等于 $M = \\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi}$。\n最小化期望成本对应于在凸的ROC曲线上找到与某条等成本线相切的点。在这个最优工作点，ROC曲线的斜率必须等于等成本线的斜率。\n因此，在最优阈值 $\\tau^{\\star}$ 处：\n$$\n\\text{ROC在 } \\tau^{\\star} \\text{ 处的斜率} = \\text{等成本线斜率}\n$$\n$$\n\\frac{p(\\tau^{\\star}|Y=1)}{p(\\tau^{\\star}|Y=0)} = \\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi}\n$$\n这与通过直接对成本函数 $C(\\tau)$ 求导得出的最优条件完全相同。这证实了贝叶斯最优工作点位于ROC曲线与代表成本和先验概率之间权衡的直线之间的切点这一几何解释。\n\n### 第3部分：$\\tau^{\\star}$ 的数值计算\n\n给定参数如下：\n$\\mu_{0} = -0.2$, $\\mu_{1} = 1.0$, $\\sigma = 0.5$, $C_{FP} = 2$, $C_{FN} = 4$, $\\pi = 0.4$。\n由此，我们推导出：\n$\\sigma^2 = (0.5)^2 = 0.25$\n$1-\\pi = 1 - 0.4 = 0.6$\n\n我们使用推导出的 $\\tau^{\\star}$ 公式：\n$$\n\\tau^{\\star} = \\frac{\\mu_1+\\mu_0}{2} + \\frac{\\sigma^2}{\\mu_1-\\mu_0} \\ln\\left(\\frac{C_{FP}(1-\\pi)}{C_{FN}\\pi}\\right)\n$$\n代入数值：\n$$\n\\tau^{\\star} = \\frac{1.0 + (-0.2)}{2} + \\frac{0.25}{1.0 - (-0.2)} \\ln\\left(\\frac{2 \\times 0.6}{4 \\times 0.4}\\right)\n$$\n$$\n\\tau^{\\star} = \\frac{0.8}{2} + \\frac{0.25}{1.2} \\ln\\left(\\frac{1.2}{1.6}\\right)\n$$\n$$\n\\tau^{\\star} = 0.4 + \\frac{0.25}{1.2} \\ln(0.75)\n$$\n现在，我们计算数值：\n$$\n\\frac{0.25}{1.2} = \\frac{1/4}{6/5} = \\frac{5}{24} \\approx 0.208333...\n$$\n$$\n\\ln(0.75) \\approx -0.287682\n$$\n$$\n\\tau^{\\star} \\approx 0.4 + (0.208333...) \\times (-0.287682)\n$$\n$$\n\\tau^{\\star} \\approx 0.4 - 0.05993375\n$$\n$$\n\\tau^{\\star} \\approx 0.34006625\n$$\n四舍五入到四位有效数字，最优阈值为 $0.3401$。",
            "answer": "$$\n\\boxed{0.3401}\n$$"
        },
        {
            "introduction": "理论模型为我们提供了深刻的洞见，但将这些概念应用于真实的离散数据则需要具体的计算能力。本练习将引导您从零开始，通过编程实现从原始得分和标签构建ROC曲线的完整过程，并学习如何正确处理得分并列的情况。此外，本练习还将介绍部分曲线下面积（partial Area Under the Curve, pAUC）的计算，这在许多应用场景中（尤其是当严格控制假阳性率至关重要时）是一个极为关键的性能评估指标。",
            "id": "4189171",
            "problem": "给定在时间窗上与电生理学基准二元标签对齐的反卷积钙成像活动分数。对于一个包含 $n$ 个时间窗的数据集，设 $s_i \\in \\mathbb{R}$ 表示第 $i$ 个时间窗的反卷积分数，$y_i \\in \\{0,1\\}$ 表示基准标签，其中 $y_i = 1$ 表示在时间窗 $i$ 中发生了一个经电生理学确认的事件（尖峰）。一个事件检测器在阈值 $\\tau \\in \\mathbb{R}$ 下，如果 $s_i \\ge \\tau$ 则声明为阳性检测，否则声明为阴性检测。请从基本原理出发，定义并使用以下概念：\n\n- 在阈值 $\\tau$ 下的真阳性（TP）、假阳性（FP）、真阴性（TN）和假阴性（FN）计数是预测相对于 $y_i$ 的函数。\n- 真阳性率（TPR）为 $ \\mathrm{TPR}(\\tau) = \\dfrac{\\mathrm{TP}(\\tau)}{P} $，其中 $P = \\sum_{i=1}^{n} y_i$ 是阳性总数。\n- 假阳性率（FPR）为 $ \\mathrm{FPR}(\\tau) = \\dfrac{\\mathrm{FP}(\\tau)}{N} $，其中 $N = \\sum_{i=1}^{n} (1 - y_i)$ 是阴性总数。\n- 受试者工作特征（ROC）曲线是通过将阈值 $\\tau$ 从 $+\\infty$ 变化到 $-\\infty$ 所描绘出的一组点 $\\{(\\mathrm{FPR}(\\tau), \\mathrm{TPR}(\\tau)) : \\tau \\in \\mathbb{R}\\}$，仅在那些会改变预测的阈值处进行评估，对于有限数据而言，这些阈值是唯一的分数值。\n- 对于给定的假阳性预算 $ \\alpha \\in [0,1] $，部分曲线下面积（partial AUC）是沿 ROC 曲线使用连续 ROC 点之间的分段线性插值计算的积分 $$ \\mathrm{pAUC}(\\alpha) = \\int_{0}^{\\alpha} \\mathrm{TPR}(\\mathrm{FPR}) \\, d(\\mathrm{FPR}) $$ 归一化部分 AUC 定义为 $$ \\mathrm{pAUC}_{\\mathrm{norm}}(\\alpha) = \\begin{cases}\\dfrac{\\mathrm{pAUC}(\\alpha)}{\\alpha},  \\alpha > 0, \\\\ 0,  \\alpha = 0.\\end{cases} $$\n\n您的任务是实现一个完整的、可运行的程序，对于下面提供的每个测试用例，使用上述基本定义根据分数和标签构建 ROC 曲线，计算在指定的低假阳性率约束 $\\alpha$ 下的部分 AUC，并以小数形式返回归一化的部分 AUC 值。您必须通过将唯一分数阈值按降序排序、对平局进行分组，并使用精确计数生成单调的 $\\mathrm{FPR}$ 和 $\\mathrm{TPR}$ 序列来计算 ROC 曲线，然后在分段线性的 ROC 片段上使用梯形法则积分至 $ \\alpha $。\n\n请使用以下测试套件。每个测试用例是一个三元组 $(\\mathbf{s}, \\mathbf{y}, \\alpha)$，其中 $\\mathbf{s}$ 是分数列表，$\\mathbf{y}$ 是与 $\\mathbf{s}$ 对齐的标签列表，$\\alpha$ 是最大假阳性率。所有量都是无量纲的，并且必须表示为小数（而非百分比）。\n\n- 案例 $1$（标准情况，中度重叠，大致平衡）：\n  - $\\mathbf{s} = [\\, 0.88, 0.82, 0.79, 0.75, 0.71, 0.64, 0.58, 0.54, 0.66, 0.60, 0.59, 0.57, 0.52, 0.50, 0.46, 0.43, 0.38, 0.34, 0.29, 0.22 \\,]$\n  - $\\mathbf{y} = [\\, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 \\,]$\n  - $\\alpha = 0.10$\n- 案例 $2$（所有分数相同，类似随机的分类器行为）：\n  - $\\mathbf{s} = [\\, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50 \\,]$\n  - $\\mathbf{y} = [\\, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0 \\,]$\n  - $\\alpha = 0.20$\n- 案例 $3$（阴性样本高度不平衡，极低的假阳性预算）：\n  - $\\mathbf{s} = [\\, 0.90, 0.87, 0.85, 0.88, 0.86, 0.84, 0.70, 0.60, 0.58, 0.55, 0.52, 0.50, 0.47, 0.45, 0.43, 0.40, 0.37, 0.35, 0.33, 0.30, 0.28, 0.26, 0.24, 0.22, 0.20, 0.18, 0.16, 0.14, 0.12, 0.10 \\,]$\n  - $\\mathbf{y} = [\\, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 \\,]$\n  - $\\alpha = 0.02$\n- 案例 $4$（完美分离）：\n  - $\\mathbf{s} = [\\, 0.95, 0.92, 0.90, 0.88, 0.85, 0.20, 0.18, 0.15, 0.10, 0.05 \\,]$\n  - $\\mathbf{y} = [\\, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0 \\,]$\n  - $\\alpha = 0.30$\n- 案例 $5$（反向分类器，低假阳性率下的最坏情况）：\n  - $\\mathbf{s} = [\\, 0.20, 0.18, 0.15, 0.10, 0.05, 0.95, 0.92, 0.90, 0.88, 0.85 \\,]$\n  - $\\mathbf{y} = [\\, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0 \\,]$\n  - $\\alpha = 0.10$\n- 案例 $6$（边界条件 $\\alpha = 0$）：\n  - $\\mathbf{s} = [\\, 0.70, 0.60, 0.55, 0.40 \\,]$\n  - $\\mathbf{y} = [\\, 1, 0, 1, 0 \\,]$\n  - $\\alpha = 0.00$\n\n您的程序应生成单行输出，其中包含按上述顺序排列的各案例的归一化部分 AUC 值，格式为逗号分隔的列表并用方括号括起，例如 $[r_1,r_2,r_3,r_4,r_5,r_6]$，其中每个 $r_k$ 是为案例 $k$ 计算的 $\\mathrm{pAUC}_{\\mathrm{norm}}(\\alpha)$ 的小数值。",
            "solution": "所述问题是有效的。它在科学上基于信号检测理论的原理，特别是受试者工作特征（ROC）曲线的构建和分析，这是神经科学、机器学习和其他 STEM 领域用于评估二元分类器的标准方法。该问题是适定的，提供了所有必要的定义、数据和约束，以确保一个唯一的、可验证的解决方案。其语言是客观的，数学上是精确的。因此，我们可以着手于一个有原则的解决方案。\n\n任务是为一系列数据集计算归一化部分曲线下面积，即 $\\mathrm{pAUC}_{\\mathrm{norm}}(\\alpha)$。这需要一个两步过程：首先，从提供的分数和标签构建 ROC 曲线；其次，在该曲线上积分至指定的假阳性率 $\\alpha$。\n\n**1. 从基本原理构建 ROC 曲线**\n\nROC 曲线描绘了一个二元分类器系统在其判别阈值变化时的诊断能力。该曲线绘制了在不同阈值设置下的真阳性率（$\\mathrm{TPR}$）对假阳性率（$\\mathrm{FPR}$）的图。\n\n给定一组分数 $\\{s_i\\}_{i=1}^n$ 和相应的真实二元标签 $\\{y_i\\}_{i=1}^n$（其中 $y_i \\in \\{0,1\\}$），一个决策规则将观测值 $i$ 分类为阳性，如果其分数 $s_i$ 大于或等于一个阈值 $\\tau$，否则为阴性。\n\n基本量在给定阈值 $\\tau$ 下定义如下：\n- 真阳性，$\\mathrm{TP}(\\tau)$：被正确识别为阳性的实例计数。$\\mathrm{TP}(\\tau) = \\sum_{i: s_i \\ge \\tau \\land y_i=1} 1$。\n- 假阳性，$\\mathrm{FP}(\\tau)$：被错误识别为阳性的阴性实例计数。$\\mathrm{FP}(\\tau) = \\sum_{i: s_i \\ge \\tau \\land y_i=0} 1$。\n- 真阴性，$\\mathrm{TN}(\\tau)$：被正确识别为阴性的实例计数。\n- 假阴性，$\\mathrm{FN}(\\tau)$：被错误识别为阴性的阳性实例计数。\n\n实际阳性实例的总数是 $P = \\sum_{i=1}^n y_i$，实际阴性实例的总数是 $N = \\sum_{i=1}^n (1 - y_i)$。\n\n然后，比率定义为：\n- 真阳性率：$\\mathrm{TPR}(\\tau) = \\dfrac{\\mathrm{TP}(\\tau)}{P}$\n- 假阳性率：$\\mathrm{FPR}(\\tau) = \\dfrac{\\mathrm{FP}(\\tau)}{N}$\n\n为了构建 ROC 曲线，我们追踪当 $\\tau$ 从 $+\\infty$ 扫描到 $-\\infty$ 时的 $(\\mathrm{FPR}(\\tau), \\mathrm{TPR}(\\tau))$ 点。\n- 当 $\\tau = +\\infty$ 时，没有分数满足准则 $s_i \\ge \\tau$。因此，$\\mathrm{TP}(+\\infty) = 0$ 且 $\\mathrm{FP}(+\\infty) = 0$。这给出了 ROC 曲线的起点，$(\\mathrm{FPR}, \\mathrm{TPR}) = (0, 0)$。\n- 随着 $\\tau$ 的减小，它将穿过分数 $s_i$ 的值。$\\mathrm{TP}(\\tau)$ 和 $\\mathrm{FP}(\\tau)$ 的值是分段常数，仅当 $\\tau$ 等于数据中存在的分数之一时才会改变。因此，我们只需要在对应于唯一分数值的阈值处评估这些比率。\n\n生成 ROC 点的算法如下：\n1. 识别数据中的唯一分数值集合，并按降序对其进行排序，设这些值为 $\\{t_1, t_2, \\dots, t_k\\}$，其中 $t_1 > t_2 > \\dots > t_k$。\n2. 初始化累积真阳性 $\\mathrm{tp}_{\\mathrm{cum}}$ 和累积假阳性 $\\mathrm{fp}_{\\mathrm{cum}}$ 为 $0$。用 $(0, 0)$ 初始化 ROC 点列表。\n3. 对于从 $j=1$ 到 $k$ 的每个唯一阈值 $t_j$：\n    a. 计算在所有分数为 $s_i = t_j$ 的数据点中，实际阳性标签的数量（$\\Delta \\mathrm{tp}$）和实际阴性标签的数量（$\\Delta \\mathrm{fp}$）。\n    b. 更新累积计数：$\\mathrm{tp}_{\\mathrm{cum}} \\leftarrow \\mathrm{tp}_{\\mathrm{cum}} + \\Delta \\mathrm{tp}$ 和 $\\mathrm{fp}_{\\mathrm{cum}} \\leftarrow \\mathrm{fp}_{\\mathrm{cum}} + \\Delta \\mathrm{fp}$。\n    c. 将一个新点 $(\\mathrm{fp}_{\\mathrm{cum}}/N, \\mathrm{tp}_{\\mathrm{cum}}/P)$ 添加到 ROC 点列表中。\n这个过程通过在 ROC 图上对角移动来正确处理分数平局，同时增加 $\\mathrm{TPR}$ 和 $\\mathrm{FPR}$。得到的点列表用线段连接起来，就构成了 ROC 曲线。\n\n**2. 部分 AUC 计算与归一化**\n\n部分曲线下面积 $\\mathrm{pAUC}(\\alpha)$ 是 ROC 曲线从 $\\mathrm{FPR}=0$ 到 $\\mathrm{FPR}=\\alpha$ 的积分：\n$$ \\mathrm{pAUC}(\\alpha) = \\int_{0}^{\\alpha} \\mathrm{TPR}(\\mathrm{FPR}) \\, d(\\mathrm{FPR}) $$\n由于从有限数据构建的 ROC 曲线是分段线性的，这个积分可以计算为由连续 ROC 点形成的梯形面积之和。\n\n设 ROC 点的序列为 $(x_0, y_0), (x_1, y_1), \\dots, (x_m, y_m)$，其中 $(x_0, y_0) = (0, 0)$ 且 $x_i = \\mathrm{FPR}_i, y_i = \\mathrm{TPR}_i$。\n计算 $\\mathrm{pAUC}(\\alpha)$ 的算法是：\n1. 初始化总面积 $A$ 为 $0$。\n2. 从 $i=1$ 到 $m$ 遍历 ROC 点。设前一个点为 $(x_{i-1}, y_{i-1})$，当前点为 $(x_i, y_i)$。\n3. 如果前一个点的 FPR 已经超出了预算（即 $x_{i-1} \\ge \\alpha$），则终止积分。\n4. 如果当前段完全在预算内（即 $x_i \\le \\alpha$），则将整个梯形的面积加到总面积上：\n   $$ A \\leftarrow A + \\frac{1}{2} (y_i + y_{i-1})(x_i - x_{i-1}) $$\n5. 如果当前段跨越了预算边界（即 $x_{i-1}  \\alpha  x_i$），我们必须只积分到 $\\alpha$。我们通过沿从 $(x_{i-1}, y_{i-1})$ 到 $(x_i, y_i)$ 的线段进行线性插值来找到 $\\mathrm{FPR}=\\alpha$ 处的 TPR 值：\n   $$ y_{\\alpha} = y_{i-1} + (y_i - y_{i-1}) \\frac{\\alpha - x_{i-1}}{x_i - x_{i-1}} $$\n   这个最终的、被裁剪后的梯形面积是：\n   $$ A \\leftarrow A + \\frac{1}{2} (y_{\\alpha} + y_{i-1})(\\alpha - x_{i-1}) $$\n   加上这个面积后，积分完成，因此我们终止循环。\n\n最后，问题要求的是归一化的部分 AUC，其定义为：\n$$ \\mathrm{pAUC}_{\\mathrm{norm}}(\\alpha) = \\begin{cases}\\dfrac{\\mathrm{pAUC}(\\alpha)}{\\alpha},  \\alpha > 0, \\\\ 0,  \\alpha = 0.\\end{cases} $$\n这种归一化对结果进行了缩放。对于一个在任何 $\\mathrm{FPR}>0$ 时都能达到 $\\mathrm{TPR}=1$ 的完美分类器，$\\mathrm{pAUC}(\\alpha)$ 将是 $\\alpha$，因此 $\\mathrm{pAUC}_{\\mathrm{norm}}(\\alpha)=1$。对于一个不优于沿对角线随机猜测的分类器，$\\mathrm{TPR}=\\mathrm{FPR}$，$\\mathrm{pAUC}(\\alpha) = \\alpha^2/2$，并且 $\\mathrm{pAUC}_{\\mathrm{norm}}(\\alpha)=\\alpha/2$。对于在低 FPR 区域只产生假阳性的最坏情况分类器，$\\mathrm{pAUC}_{\\mathrm{norm}}(\\alpha)=0$。\n\n以下实现遵循这些原则来解决所提供的测试用例。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem for all test cases specified.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (happy path, moderate overlap, balanced-ish)\n        (\n            [0.88, 0.82, 0.79, 0.75, 0.71, 0.64, 0.58, 0.54, 0.66, 0.60, 0.59, 0.57, 0.52, 0.50, 0.46, 0.43, 0.38, 0.34, 0.29, 0.22],\n            [1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            0.10\n        ),\n        # Case 2 (all scores identical, random-like classifier behavior)\n        (\n            [0.50, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50, 0.50],\n            [1, 1, 1, 1, 1, 0, 0, 0, 0, 0],\n            0.20\n        ),\n        # Case 3 (highly imbalanced negatives, extremely low false positive budget)\n        (\n            [0.90, 0.87, 0.85, 0.88, 0.86, 0.84, 0.70, 0.60, 0.58, 0.55, 0.52, 0.50, 0.47, 0.45, 0.43, 0.40, 0.37, 0.35, 0.33, 0.30, 0.28, 0.26, 0.24, 0.22, 0.20, 0.18, 0.16, 0.14, 0.12, 0.10],\n            [1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            0.02\n        ),\n        # Case 4 (perfect separation)\n        (\n            [0.95, 0.92, 0.90, 0.88, 0.85, 0.20, 0.18, 0.15, 0.10, 0.05],\n            [1, 1, 1, 1, 1, 0, 0, 0, 0, 0],\n            0.30\n        ),\n        # Case 5 (inverted classifier, worst-case under low false positives)\n        (\n            [0.20, 0.18, 0.15, 0.10, 0.05, 0.95, 0.92, 0.90, 0.88, 0.85],\n            [1, 1, 1, 1, 1, 0, 0, 0, 0, 0],\n            0.10\n        ),\n        # Case 6 (boundary condition alpha = 0)\n        (\n            [0.70, 0.60, 0.55, 0.40],\n            [1, 0, 1, 0],\n            0.00\n        )\n    ]\n\n    results = []\n    for scores, labels, alpha in test_cases:\n        result = calculate_pauc_norm(scores, labels, alpha)\n        results.append(f\"{result:.8f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_pauc_norm(scores, labels, alpha):\n    \"\"\"\n    Computes the normalized partial Area Under the ROC Curve (pAUC_norm).\n\n    Args:\n        scores (list or np.ndarray): Deconvolved activity scores.\n        labels (list or np.ndarray): Ground-truth binary labels (0 or 1).\n        alpha (float): The maximum false positive rate for partial AUC calculation.\n\n    Returns:\n        float: The normalized partial AUC value.\n    \"\"\"\n    if alpha == 0.0:\n        return 0.0\n\n    scores = np.asarray(scores, dtype=np.float64)\n    labels = np.asarray(labels, dtype=np.int32)\n    \n    pos_mask = (labels == 1)\n    neg_mask = (labels == 0)\n    \n    P = np.sum(pos_mask)\n    N = np.sum(neg_mask)\n\n    if P == 0 or N == 0:\n        # If no positives, TPR is always 0, so pAUC is 0.\n        # If no negatives, FPR is always 0, ROC is a vertical line at FPR=0,\n        # so integral over [0, alpha] has zero width and area is 0.\n        return 0.0\n\n    # Get unique scores and sort them in descending order for threshold sweeping\n    unique_scores = np.unique(scores)[::-1]\n    \n    roc_points = [(0.0, 0.0)]\n    tp_cum = 0\n    fp_cum = 0\n    \n    # Construct ROC curve points by processing scores in descending order\n    for threshold in unique_scores:\n        threshold_mask = (scores == threshold)\n        delta_tp = np.sum(pos_mask[threshold_mask])\n        delta_fp = np.sum(neg_mask[threshold_mask])\n        \n        tp_cum += delta_tp\n        fp_cum += delta_fp\n        \n        roc_points.append((fp_cum / N, tp_cum / P))\n\n    # Calculate partial AUC using trapezoidal rule\n    pauc = 0.0\n    for i in range(1, len(roc_points)):\n        x_prev, y_prev = roc_points[i - 1]\n        x_curr, y_curr = roc_points[i]\n\n        # Stop if the previous point is already past the budget\n        if x_prev >= alpha:\n            break\n\n        # If the whole segment is within the budget, add the full trapezoid area\n        if x_curr = alpha:\n            pauc += 0.5 * (y_prev + y_curr) * (x_curr - x_prev)\n        # If the segment crosses the budget, add the area up to alpha and stop\n        else:\n            # Check for vertical line case: x_curr == x_prev\n            # If so, this segment has zero width and adds no area.\n            if x_curr > x_prev:\n                # Interpolate TPR at FPR = alpha\n                y_interp = y_prev + (y_curr - y_prev) * (alpha - x_prev) / (x_curr - x_prev)\n                pauc += 0.5 * (y_prev + y_interp) * (alpha - x_prev)\n            break\n            \n    # Normalize the partial AUC by alpha\n    pauc_norm = pauc / alpha\n    return pauc_norm\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}