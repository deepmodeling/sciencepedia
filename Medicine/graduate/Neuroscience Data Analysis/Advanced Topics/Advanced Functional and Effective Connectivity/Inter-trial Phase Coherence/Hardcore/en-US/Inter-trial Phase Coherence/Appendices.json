{
    "hands_on_practices": [
        {
            "introduction": "To truly grasp Inter-Trial Phase Coherence (ITPC), it's best to build it from fundamental concepts. This first exercise guides you through this process, starting from the intuitive representation of neural signal phases as vectors in the complex plane. By deriving the definitions for ITPC and the circular mean direction from this first principle, you will solidify your understanding of ITPC as a measure of phase consistency across trials. ",
            "id": "4171087",
            "problem": "In a visual event-related potential study, a continuous intracranial electroencephalography signal is analyzed with a complex time–frequency transform. At a fixed time–frequency coordinate $(t^{\\ast}, f^{\\ast})$, the instantaneous phase of the analytic signal is extracted for $N$ independent trials of the same stimulus. The phases are measured in radians and given by the multiset\n$$\n\\{\\phi_n\\}_{n=1}^{N}=\\{0,\\,0,\\,0,\\,0,\\,0,\\,\\pi,\\,\\pi,\\,\\pi,\\,\\tfrac{\\pi}{3},\\,\\tfrac{\\pi}{3},\\,-\\tfrac{\\pi}{3},\\,-\\tfrac{\\pi}{3}\\}.\n$$\nHere $N=12$. Starting only from the fundamental identification that each phase $\\phi_n$ determines a direction on the unit circle in the complex plane and that the net directional tendency across trials is captured by the vector sum of these unit directions, derive from first principles the definitions for inter-trial phase coherence (ITPC) and the circular mean direction at $(t^{\\ast}, f^{\\ast})$. Then compute their values for the given phases.\n\nExpress the circular mean direction in radians. Provide your final answer as a single row matrix containing, in order, the inter-trial phase coherence and the circular mean direction. Do not include units in the final boxed answer. No rounding is required; report exact values if they exist.",
            "solution": "The problem requires the derivation of the definitions for inter-trial phase coherence (ITPC) and circular mean direction from first principles, followed by their computation for a given set of phase data. The fundamental principle provided is the representation of each phase $\\phi_n$ as a unit-length vector in the complex plane, with the net directional tendency given by their vector sum.\n\n**1. Derivation from First Principles**\n\nLet the number of independent trials be $N$. The phase of the signal at a specific time-frequency point in trial $n$ is $\\phi_n$, where $n \\in \\{1, 2, \\dots, N\\}$. Following the problem's guiding principle, each phase $\\phi_n$ is represented as a unit vector on the unit circle in the complex plane. This vector can be written as a complex number $z_n$ using Euler's formula:\n$$\nz_n = e^{i\\phi_n} = \\cos(\\phi_n) + i\\sin(\\phi_n)\n$$\nThe magnitude of each vector is $|z_n| = \\sqrt{\\cos^2(\\phi_n) + \\sin^2(\\phi_n)} = 1$.\n\nThe problem states that the net directional tendency is captured by the vector sum of these unit directions. We define this resultant vector, $R$, as the sum of all individual complex vectors:\n$$\nR = \\sum_{n=1}^{N} z_n = \\sum_{n=1}^{N} e^{i\\phi_n}\n$$\nTo find the *average* directional tendency, we normalize this sum by the number of trials, $N$. This yields the mean resultant vector, $\\bar{R}$:\n$$\n\\bar{R} = \\frac{1}{N} \\sum_{n=1}^{N} e^{i\\phi_n}\n$$\nThis mean resultant vector $\\bar{R}$ is a complex number that can be expressed in polar form as $\\bar{R} = |\\bar{R}| e^{i\\bar{\\phi}}$, where $|\\bar{R}|$ is its magnitude and $\\bar{\\phi}$ is its angle (argument).\n\nThe magnitude, $|\\bar{R}|$, quantifies the consistency or clustering of the phases across trials. If all phases are identical, i.e., $\\phi_n = \\phi$ for all $n$, then $\\bar{R} = \\frac{1}{N} \\sum_{n=1}^{N} e^{i\\phi} = \\frac{1}{N}(N e^{i\\phi}) = e^{i\\phi}$, and its magnitude is $|\\bar{R}| = 1$. This represents perfect phase coherence. Conversely, if the phases are uniformly distributed around the unit circle, the vector sum tends to cancel out, $\\sum e^{i\\phi_n} \\to 0$, so $|\\bar{R}| \\to 0$. This represents a complete lack of phase coherence. Therefore, the magnitude of the mean resultant vector is the formal definition of **Inter-Trial Phase Coherence (ITPC)**.\n$$\n\\text{ITPC} = \\left| \\frac{1}{N} \\sum_{n=1}^{N} e^{i\\phi_n} \\right|\n$$\nThe value of ITPC is bounded between $0$ and $1$.\n\nThe angle, $\\bar{\\phi} = \\arg(\\bar{R})$, of the mean resultant vector represents the central tendency of the distribution of phases. This angle is the **circular mean direction**. It is the argument of the sum of the vectors, as dividing by the positive real number $N$ does not change the angle.\n$$\n\\bar{\\phi} = \\arg\\left( \\sum_{n=1}^{N} e^{i\\phi_n} \\right)\n$$\nTo compute this, we can first express the sum in Cartesian form:\n$$\n\\sum_{n=1}^{N} e^{i\\phi_n} = \\sum_{n=1}^{N} \\cos(\\phi_n) + i \\sum_{n=1}^{N} \\sin(\\phi_n)\n$$\nThe argument $\\bar{\\phi}$ is then found using the two-argument arctangent function, $\\text{atan2}(y, x)$:\n$$\n\\bar{\\phi} = \\text{atan2}\\left(\\sum_{n=1}^{N} \\sin(\\phi_n), \\sum_{n=1}^{N} \\cos(\\phi_n)\\right)\n$$\n\n**2. Computation for the Given Data**\n\nThe problem provides $N=12$ trials with the following multiset of phases in radians:\n$$\n\\{\\phi_n\\}_{n=1}^{12}=\\{0,\\,0,\\,0,\\,0,\\,0,\\,\\pi,\\,\\pi,\\,\\pi,\\,\\tfrac{\\pi}{3},\\,\\tfrac{\\pi}{3},\\,-\\tfrac{\\pi}{3},\\,-\\tfrac{\\pi}{3}\\}\n$$\nWe compute the resultant vector $R$ by summing the corresponding complex exponentials. We can group the terms by their phase value:\n- $5$ trials with $\\phi = 0$\n- $3$ trials with $\\phi = \\pi$\n- $2$ trials with $\\phi = \\frac{\\pi}{3}$\n- $2$ trials with $\\phi = -\\frac{\\pi}{3}$\n\nThe sum is:\n$$\nR = \\sum_{n=1}^{12} e^{i\\phi_n} = 5 \\cdot e^{i0} + 3 \\cdot e^{i\\pi} + 2 \\cdot e^{i\\pi/3} + 2 \\cdot e^{-i\\pi/3}\n$$\nWe evaluate the complex exponentials:\n- $e^{i0} = \\cos(0) + i\\sin(0) = 1$\n- $e^{i\\pi} = \\cos(\\pi) + i\\sin(\\pi) = -1$\n- $e^{i\\pi/3} = \\cos(\\pi/3) + i\\sin(\\pi/3) = \\frac{1}{2} + i\\frac{\\sqrt{3}}{2}$\n- $e^{-i\\pi/3} = \\cos(-\\pi/3) + i\\sin(-\\pi/3) = \\frac{1}{2} - i\\frac{\\sqrt{3}}{2}$\n\nSubstituting these values into the sum for $R$:\n$$\nR = 5(1) + 3(-1) + 2\\left(\\frac{1}{2} + i\\frac{\\sqrt{3}}{2}\\right) + 2\\left(\\frac{1}{2} - i\\frac{\\sqrt{3}}{2}\\right)\n$$\n$$\nR = 5 - 3 + (1 + i\\sqrt{3}) + (1 - i\\sqrt{3})\n$$\nGrouping the real and imaginary parts:\n$$\nR = (5 - 3 + 1 + 1) + i(\\sqrt{3} - \\sqrt{3})\n$$\n$$\nR = 4 + i0 = 4\n$$\nNow we compute the mean resultant vector $\\bar{R}$:\n$$\n\\bar{R} = \\frac{R}{N} = \\frac{4}{12} = \\frac{1}{3}\n$$\nThe **Inter-Trial Phase Coherence (ITPC)** is the magnitude of $\\bar{R}$:\n$$\n\\text{ITPC} = |\\bar{R}| = \\left|\\frac{1}{3}\\right| = \\frac{1}{3}\n$$\nThe **circular mean direction** $\\bar{\\phi}$ is the argument of $\\bar{R}$:\n$$\n\\bar{\\phi} = \\arg(\\bar{R}) = \\arg\\left(\\frac{1}{3}\\right)\n$$\nSince $\\frac{1}{3}$ is a positive real number, its angle on the complex plane is $0$.\n$$\n\\bar{\\phi} = 0 \\text{ radians}\n$$\nThe required values are an ITPC of $\\frac{1}{3}$ and a circular mean direction of $0$ radians.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{3} & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "With the definition of ITPC established, the next practical challenge is choosing the right parameters for your time-frequency analysis. This exercise tackles the Heisenberg-Gabor uncertainty principle as it applies to Morlet wavelets, a common tool for ITPC estimation. You will derive a principled criterion for selecting the wavelet's cycle count, $n_c$, to optimally balance temporal precision against frequency specificity, a critical skill for producing interpretable and reproducible results. ",
            "id": "4171065",
            "problem": "You are designing a time-frequency analysis pipeline to quantify Inter-Trial Phase Coherence (ITPC) in human electroencephalography (EEG) during an event-related paradigm, targeting the alpha band centered at frequency $f_{0} = 12$ Hz. You will use a complex Morlet wavelet in the time domain, modeled as a Gaussian-windowed complex sinusoid centered at $f_{0}$ with temporal Gaussian standard deviation $\\sigma_{t}$. For scientific interpretability and reproducibility of ITPC estimates, you seek a principled choice of the wavelet cycle count $n_{c}$ that balances temporal precision against frequency specificity, recognizing that tighter temporal localization broadens the spectral profile and vice versa.\n\nStarting from first principles appropriate to this context, including the Fourier transform properties of Gaussians and the definition of full width at half maximum (FWHM) for a Gaussian envelope, do the following:\n\n1. Derive from the Gaussian–Gaussian duality under the Fourier transform the relationship between temporal and spectral standard deviations $\\sigma_{t}$ and $\\sigma_{f}$ for a Gaussian-windowed complex sinusoid, and connect these to the wavelet cycle count $n_{c}$ via a definition grounded in the number of oscillatory cycles contained within the Gaussian window.\n\n2. Justify a dimensionless and frequency-normalized trade-off criterion that balances temporal precision against frequency specificity for ITPC by minimizing the sum of the time-domain FWHM expressed in units of the period $1/f_{0}$ and the frequency-domain FWHM expressed in units of $f_{0}$. Explicitly derive the optimal cycle count $n_{c}$ under this criterion.\n\n3. Using your derived optimal $n_{c}$, compute the implied FWHM in the time domain (in seconds) and the frequency domain (in Hertz) at $f_{0} = 12$ Hz.\n\nReport the final answer as three values in the order: the optimal cycle count $n_{c}$ (dimensionless), the time-domain FWHM in seconds, and the frequency-domain FWHM in Hertz. Round each to four significant figures. Express time in seconds and frequency in Hertz. Do not include units in your final boxed answer.",
            "solution": "We begin with a complex Morlet wavelet in the time domain defined as a complex sinusoid at center frequency $f_{0}$ multiplied by a Gaussian envelope,\n$$\nw(t) = A \\exp\\!\\big(i 2\\pi f_{0} t\\big)\\,\\exp\\!\\Big(-\\frac{t^{2}}{2\\sigma_{t}^{2}}\\Big),\n$$\nwhere $A$ is an amplitude constant and $\\sigma_{t}$ is the temporal standard deviation of the Gaussian window. The Fourier transform of a Gaussian is a Gaussian; applying the Fourier transform to $w(t)$ yields a Gaussian in frequency centered at $f_{0}$ with spectral standard deviation $\\sigma_{f}$ given by\n$$\nW(f) \\propto \\exp\\!\\Big(-2\\pi^{2}\\sigma_{t}^{2}\\,(f - f_{0})^{2}\\Big),\n$$\nfrom which the standard deviation in frequency is obtained by matching the exponent to the canonical Gaussian form $\\exp\\!\\big(- (f-f_{0})^{2}/(2\\sigma_{f}^{2})\\big)$. Equating coefficients gives\n$$\n\\frac{1}{2\\sigma_{f}^{2}} = 2\\pi^{2}\\sigma_{t}^{2}\n\\quad\\Longrightarrow\\quad\n\\sigma_{f} = \\frac{1}{2\\pi\\sigma_{t}}.\n$$\n\nA widely used and physically grounded definition of the wavelet cycle count is the number of carrier cycles within the Gaussian window, which, for a Gaussian characterized by $\\sigma_{t}$ (or equivalently by $\\sigma_{f}$), can be expressed as\n$$\nn_{c} \\equiv 2\\pi f_{0}\\sigma_{t}.\n$$\nUsing the relation between $\\sigma_{t}$ and $\\sigma_{f}$, this can also be written as\n$$\nn_{c} = \\frac{f_{0}}{\\sigma_{f}}.\n$$\nThese relations capture the trade-off: increasing $n_{c}$ expands $\\sigma_{t}$ (poorer temporal precision) and reduces $\\sigma_{f}$ (greater frequency specificity), and vice versa.\n\nFor a Gaussian with standard deviation $\\sigma$, the full width at half maximum (FWHM) is\n$$\n\\mathrm{FWHM} = 2\\sqrt{2\\ln 2}\\,\\sigma.\n$$\nTherefore, the time-domain and frequency-domain FWHM are\n$$\n\\mathrm{FWHM}_{t} = 2\\sqrt{2\\ln 2}\\,\\sigma_{t}\n\\quad\\text{and}\\quad\n\\mathrm{FWHM}_{f} = 2\\sqrt{2\\ln 2}\\,\\sigma_{f}.\n$$\nSubstituting $\\sigma_{t} = \\frac{n_{c}}{2\\pi f_{0}}$ and $\\sigma_{f} = \\frac{f_{0}}{n_{c}}$ (the latter following from $\\sigma_{f} = \\frac{1}{2\\pi\\sigma_{t}}$ and the definition of $n_{c}$), we obtain\n$$\n\\mathrm{FWHM}_{t}(n_{c}) = 2\\sqrt{2\\ln 2}\\,\\frac{n_{c}}{2\\pi f_{0}}\n= \\frac{\\sqrt{2\\ln 2}}{\\pi}\\,\\frac{n_{c}}{f_{0}},\n$$\n$$\n\\mathrm{FWHM}_{f}(n_{c}) = 2\\sqrt{2\\ln 2}\\,\\frac{f_{0}}{n_{c}}.\n$$\n\nTo balance temporal precision and frequency specificity for Inter-Trial Phase Coherence (ITPC) in a dimensionless and frequency-normalized manner, we consider the sum of relative widths:\n$$\nJ(n_{c}) \\equiv \\frac{\\mathrm{FWHM}_{t}(n_{c})}{1/f_{0}} + \\frac{\\mathrm{FWHM}_{f}(n_{c})}{f_{0}}\n= f_{0}\\,\\mathrm{FWHM}_{t}(n_{c}) + \\frac{\\mathrm{FWHM}_{f}(n_{c})}{f_{0}}.\n$$\nThis criterion measures temporal width as a fraction of one cycle and spectral width as a fraction of the center frequency, providing a symmetric and dimensionless trade-off tailored to phase-based measures like ITPC.\n\nUsing the expressions above,\n$$\nJ(n_{c}) = f_{0}\\left(\\frac{\\sqrt{2\\ln 2}}{\\pi}\\,\\frac{n_{c}}{f_{0}}\\right) + \\frac{1}{f_{0}}\\left(2\\sqrt{2\\ln 2}\\,\\frac{f_{0}}{n_{c}}\\right)\n= \\frac{\\sqrt{2\\ln 2}}{\\pi}\\,n_{c} + \\frac{2\\sqrt{2\\ln 2}}{n_{c}}.\n$$\nDefine constants\n$$\nc_{t} \\equiv \\frac{\\sqrt{2\\ln 2}}{\\pi}, \\quad c_{f} \\equiv 2\\sqrt{2\\ln 2},\n$$\nso that $J(n_{c}) = c_{t}\\,n_{c} + \\frac{c_{f}}{n_{c}}$. Minimizing $J(n_{c})$ over $n_{c} > 0$ by setting the derivative to zero,\n$$\n\\frac{dJ}{dn_{c}} = c_{t} - \\frac{c_{f}}{n_{c}^{2}} = 0\n\\quad\\Longrightarrow\\quad\nn_{c}^{\\star} = \\sqrt{\\frac{c_{f}}{c_{t}}}\n= \\sqrt{\\frac{2\\sqrt{2\\ln 2}}{\\sqrt{2\\ln 2}/\\pi}}\n= \\sqrt{2\\pi}.\n$$\nThus, the optimal cycle count under this balanced, dimensionless criterion is\n$$\nn_{c}^{\\star} = \\sqrt{2\\pi}.\n$$\n\nSubstituting $n_{c}^{\\star}$ into the FWHM expressions yields particularly symmetric forms. First,\n$$\n\\mathrm{FWHM}_{t}^{\\star} = \\frac{\\sqrt{2\\ln 2}}{\\pi}\\,\\frac{\\sqrt{2\\pi}}{f_{0}}\n= \\frac{2\\sqrt{\\ln 2 / \\pi}}{f_{0}},\n$$\nand\n$$\n\\mathrm{FWHM}_{f}^{\\star} = 2\\sqrt{2\\ln 2}\\,\\frac{f_{0}}{\\sqrt{2\\pi}}\n= 2\\sqrt{\\frac{\\ln 2}{\\pi}}\\,f_{0}.\n$$\nHence,\n$$\n\\mathrm{FWHM}_{t}^{\\star} = \\frac{2\\sqrt{\\ln 2 / \\pi}}{f_{0}}, \\qquad\n\\mathrm{FWHM}_{f}^{\\star} = 2\\sqrt{\\ln 2 / \\pi}\\,f_{0}.\n$$\n\nFor $f_{0} = 12$ Hz, we keep constants symbolic until the final numerical evaluation. Let\n$$\nK \\equiv 2\\sqrt{\\frac{\\ln 2}{\\pi}},\n$$\nso that $\\mathrm{FWHM}_{t}^{\\star} = \\frac{K}{f_{0}}$ and $\\mathrm{FWHM}_{f}^{\\star} = K f_{0}$. Evaluate $K$ numerically at the end:\n$$\nK = 2\\sqrt{\\frac{\\ln 2}{\\pi}} \\approx 2\\sqrt{\\frac{0.6931471806}{3.1415926536}}\n\\approx 2 \\times 0.469718639 \\approx 0.939437278.\n$$\nTherefore,\n$$\nn_{c}^{\\star} = \\sqrt{2\\pi} \\approx 2.506628274, \\quad\n\\mathrm{FWHM}_{t}^{\\star} = \\frac{0.939437278}{12}\\ \\text{s} \\approx 0.07828644\\ \\text{s}, \\quad\n\\mathrm{FWHM}_{f}^{\\star} = 0.939437278 \\times 12\\ \\text{Hz} \\approx 11.273247\\ \\text{Hz}.\n$$\nRounded to four significant figures:\n$$\nn_{c}^{\\star} \\approx 2.507, \\quad \\mathrm{FWHM}_{t}^{\\star} \\approx 0.07829\\ \\text{s}, \\quad \\mathrm{FWHM}_{f}^{\\star} \\approx 11.27\\ \\text{Hz}.\n$$\nThese values reflect a balanced compromise for ITPC estimation at $f_{0} = 12$ Hz under a principled, dimensionless normalization that is invariant to the absolute frequency scale.",
            "answer": "$$\\boxed{\\begin{pmatrix}2.507 & 0.07829 & 11.27\\end{pmatrix}}$$"
        },
        {
            "introduction": "Observing a high ITPC value is not enough; you must determine if it is statistically significant or simply arose by chance. This final practice introduces a robust, non-parametric method for statistical inference: permutation testing. By implementing a procedure that randomly shifts phase time series, you will learn to construct a null distribution that preserves the temporal dynamics within each trial while breaking cross-trial alignment, allowing for a rigorous test of your observed ITPC. ",
            "id": "4171116",
            "problem": "You are given phase time series across trials at a single frequency and asked to estimate the statistical significance of inter-trial phase coherence using a permutation-based null constructed by random circular shifts within trials. The inter-trial phase coherence quantifies the consistency of phase across trials at a given time and frequency. For a single time index $t^{\\star}$ and frequency index $f^{\\star}$, the observed inter-trial phase coherence is computed from the phase values across trials at that $(t^{\\star}, f^{\\star})$. All phase angles are measured in radians. The permutation-based null is constructed by independently circularly shifting each trial’s phase time series along the time axis by a random lag sampled uniformly from $\\{0,1,\\dots,T-1\\}$, where $T$ is the number of time samples per trial, and recomputing the inter-trial phase coherence at $(t^{\\star}, f^{\\star})$. Repeating this procedure yields a distribution of null inter-trial phase coherence values that preserves within-trial temporal structure while disrupting cross-trial alignment at the analysis time point.\n\nFundamental base definitions: Let there be $N$ trials and $T$ time samples per trial. At a fixed frequency, denote the phase for trial $n$ at time $t$ by $\\phi_{n}(t)$, for $n \\in \\{1,2,\\dots,N\\}$ and $t \\in \\{0,1,\\dots,T-1\\}$. Define the unit complex phasor associated with $\\phi_{n}(t)$ by $z_{n}(t) = e^{i \\phi_{n}(t)}$, where $i$ is the imaginary unit. The inter-trial phase coherence at time $t$ is the magnitude of the mean unit phasor across trials at that time, namely\n$$\n\\mathrm{ITPC}(t) = \\left| \\frac{1}{N} \\sum_{n=1}^{N} z_{n}(t) \\right| = \\left| \\frac{1}{N} \\sum_{n=1}^{N} e^{i \\phi_{n}(t)} \\right|.\n$$\n\nPermutation-based null construction: For each permutation $p \\in \\{1,2,\\dots,P\\}$, independently sample a circular shift lag $k_{n}^{(p)} \\in \\{0,1,\\dots,T-1\\}$ for each trial $n$ and form the shifted phase time series $\\phi_{n}^{(p)}(t) = \\phi_{n}\\big((t - k_{n}^{(p)}) \\bmod T\\big)$. Compute the inter-trial phase coherence at $t^{\\star}$ from the shifted trials,\n$$\n\\mathrm{ITPC}^{(p)}(t^{\\star}) = \\left| \\frac{1}{N} \\sum_{n=1}^{N} e^{i \\phi_{n}^{(p)}(t^{\\star})} \\right|.\n$$\nThe collection $\\{\\mathrm{ITPC}^{(p)}(t^{\\star})\\}_{p=1}^{P}$ is the permutation-based null distribution at $(t^{\\star}, f^{\\star})$.\n\nStatistical assessment: Use the permutation-based null to compute a one-sided $p$-value for the observed inter-trial phase coherence $\\mathrm{ITPC}_{\\mathrm{obs}}(t^{\\star})$ as the fraction of null values that are greater than or equal to the observed value, with a standard finite-sample correction to avoid a zero probability estimate.\n\nYour task is to implement a program that:\n1. Constructs specified synthetic phase time series $\\phi_{n}(t)$ (in radians) for each test case below.\n2. Computes the observed inter-trial phase coherence $\\mathrm{ITPC}_{\\mathrm{obs}}(t^{\\star})$.\n3. Generates $P$ permutation-based null samples by random circular shifts per trial and computes the null distribution $\\{\\mathrm{ITPC}^{(p)}(t^{\\star})\\}_{p=1}^{P}$.\n4. Computes the one-sided $p$-value for each test case as a decimal in $[0,1]$, rounded to six decimal places.\n5. Produces a single line of output containing the $p$-values for all test cases as a comma-separated list enclosed in square brackets.\n\nAngle unit requirement: All phases are expressed in radians. No degree values should be used.\n\nTest suite and data generation specifications:\n- For each case, the program must use the specified random number seed to ensure reproducibility. Random sampling is performed using a pseudo-random number generator initialized with the given seed. All phases must be wrapped into the interval $[-\\pi, \\pi]$ after construction to ensure valid angle values.\n\n- Case A (happy path with partial alignment at the analysis time):\n  - Trials $N = 24$, time samples $T = 400$, permutations $P = 2000$, analysis time index $t^{\\star} = 200$, seed $s = 42$.\n  - Data construction: Initialize $\\phi_{n}(t)$ as independent samples from $\\mathcal{U}([-\\pi,\\pi])$ for all $n$ and $t$. Impose partial alignment at $t^{\\star}$ by setting $\\phi_{n}(t^{\\star}) = \\theta + \\epsilon_{n}$ for all $n$, where $\\theta = 1.0$ and $\\epsilon_{n} \\sim \\mathcal{N}(0, \\sigma^{2})$ with $\\sigma = 0.3$. Wrap angles into $[-\\pi,\\pi]$.\n\n- Case B (random phases, no alignment):\n  - Trials $N = 24$, time samples $T = 400$, permutations $P = 2000$, analysis time index $t^{\\star} = 123$, seed $s = 123$.\n  - Data construction: $\\phi_{n}(t)$ are independent samples from $\\mathcal{U}([-\\pi,\\pi])$ for all $n$ and $t$. Wrap angles into $[-\\pi,\\pi]$.\n\n- Case C (perfect alignment at the analysis time):\n  - Trials $N = 50$, time samples $T = 300$, permutations $P = 2000$, analysis time index $t^{\\star} = 150$, seed $s = 7$.\n  - Data construction: Initialize $\\phi_{n}(t)$ as independent samples from $\\mathcal{U}([-\\pi,\\pi])$ for all $n$ and $t$. Impose perfect alignment at $t^{\\star}$ by setting $\\phi_{n}(t^{\\star}) = 0$ for all $n$. Wrap angles into $[-\\pi,\\pi]$.\n\n- Case D (boundary case with a degenerate time axis):\n  - Trials $N = 10$, time samples $T = 1$, permutations $P = 1000$, analysis time index $t^{\\star} = 0$, seed $s = 2024$.\n  - Data construction: $\\phi_{n}(t)$ are independent samples from $\\mathcal{U}([-\\pi,\\pi])$ for all $n$ and $t$. Wrap angles into $[-\\pi,\\pi]$.\n\nAnswer specification:\n- For each case, the program must compute the one-sided permutation $p$-value defined as\n$$\np = \\frac{1 + \\sum_{p=1}^{P} \\mathbf{1}\\left\\{\\mathrm{ITPC}^{(p)}(t^{\\star}) \\ge \\mathrm{ITPC}_{\\mathrm{obs}}(t^{\\star})\\right\\}}{P + 1},\n$$\nwhere $\\mathbf{1}\\{\\cdot\\}$ is the indicator function.\n- The final program output must be a single line with the format $[\\text{p\\_A},\\text{p\\_B},\\text{p\\_C},\\text{p\\_D}]$, where each $\\text{p\\_X}$ is the $p$-value for case $X$ rounded to six decimal places and expressed as a decimal in $[0,1]$ with no percent sign.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[\\text{result1},\\text{result2},\\text{result3},\\text{result4}]$).",
            "solution": "The problem requires the implementation of a permutation-based statistical test to evaluate the significance of inter-trial phase coherence (ITPC) in synthetic time series data. The solution involves data generation, computation of the observed ITPC, construction of a null distribution using circular shifts, and calculation of a $p$-value. The process is validated against fundamental principles of signal processing and non-parametric statistics in neuroscience.\n\nThe core quantity of interest is the Inter-Trial Phase Coherence, $\\mathrm{ITPC}(t)$. For a given time point $t$ and a fixed frequency, we have a set of phase angles $\\{\\phi_{n}(t)\\}_{n=1}^{N}$ across $N$ trials. Each phase angle $\\phi_{n}(t)$ can be represented as a unit vector, or phasor, $z_{n}(t) = e^{i \\phi_{n}(t)}$ in the complex plane, where $i$ is the imaginary unit. The $\\mathrm{ITPC}(t)$ is defined as the magnitude of the average of these phasors:\n$$\n\\mathrm{ITPC}(t) = \\left| \\frac{1}{N} \\sum_{n=1}^{N} z_{n}(t) \\right| = \\left| \\frac{1}{N} \\sum_{n=1}^{N} e^{i \\phi_{n}(t)} \\right|\n$$\nThis value ranges from $0$ to $1$. An $\\mathrm{ITPC}$ value near $1$ indicates that the phase angles across trials are highly consistent (i.e., tightly clustered), suggesting a strong neural synchronization to an event. Conversely, an $\\mathrm{ITPC}$ value near $0$ indicates that the phases are distributed randomly or uniformly across trials, suggesting a lack of consistent synchronization.\n\nTo determine if an observed $\\mathrm{ITPC}_{\\mathrm{obs}}$ at a specific time $t^{\\star}$ is statistically significant, we must compare it to a null hypothesis. The null hypothesis, $H_0$, posits that there is no true phase consistency across trials at time $t^{\\star}$. Any observed coherence is merely due to chance. A powerful, non-parametric method to generate a distribution under $H_0$ is permutation testing.\n\nThe specific permutation strategy employed here is the random circular shift of each trial's time series. For each of $P$ permutations, and for each trial $n \\in \\{1, 2, \\dots, N\\}$, the entire phase time series $\\phi_n(t)$ is circularly shifted by a random lag $k_n^{(p)}$, chosen uniformly from $\\{0, 1, \\dots, T-1\\}$, where $T$ is the number of time points. This creates a new set of permuted phase time series, $\\phi_n^{(p)}(t) = \\phi_n\\big((t - k_n^{(p)}) \\pmod T\\big)$.\n\nThis procedure is principled because it selectively disrupts the cross-trial temporal alignment at the analysis time $t^{\\star}$ while preserving the intrinsic temporal structure (like autocorrelation) within each trial. By drawing the phase for trial $n$ from a random time point within that same trial, we effectively simulate the null hypothesis: the phase at time $t^{\\star}$ for trial $n$ is unrelated to the phase at $t^{\\star}$ for any other trial $m \\neq n$.\n\nThe algorithmic procedure for each test case is as follows:\n\n1.  **Data Generation**: The phase data matrix $\\phi_{n}(t)$ of size $N \\times T$ is constructed according to the specifications for each case. A pseudo-random number generator is initialized with the given seed $s$ for reproducibility. For all cases, after the initial values are generated and specific alignments are imposed, all phase angles in the matrix are wrapped to the interval $[-\\pi, \\pi]$ to ensure they are valid. This is achieved using the function `arctan2(sin(angle), cos(angle))`.\n\n2.  **Observed Statistic Calculation**: The observed inter-trial phase coherence, $\\mathrm{ITPC}_{\\mathrm{obs}}(t^{\\star})$, is computed using the generated phase data at the analysis time index $t^{\\star}$. The phases $\\phi_n(t^{\\star})$ from all $N$ trials are extracted, converted to complex phasors $e^{i \\phi_n(t^{\\star})}$, averaged, and the absolute value of this complex mean is taken.\n\n3.  **Null Distribution Construction**: A loop is executed $P$ times to generate the null distribution. In each iteration $p$:\n    a. A vector of $N$ random integer lags, $\\{k_n^{(p)}\\}_{n=1}^N$, is sampled uniformly from $\\{0, 1, \\dots, T-1\\}$.\n    b. For each trial $n$, the phase at the shifted time index, $(t^{\\star} - k_n^{(p)}) \\pmod T$, is retrieved from the original data matrix $\\phi_n(t)$. This forms the set of permuted phases for this iteration.\n    c. The null ITPC, $\\mathrm{ITPC}^{(p)}(t^{\\star})$, is calculated from this set of permuted phases in the same way as $\\mathrm{ITPC}_{\\mathrm{obs}}(t^{\\star})$.\n    d. The resulting value is stored, forming the null distribution $\\{\\mathrm{ITPC}^{(p)}(t^{\\star})\\}_{p=1}^{P}$.\n\n4.  **p-Value Computation**: The one-sided $p$-value is calculated to assess the significance of $\\mathrm{ITPC}_{\\mathrm{obs}}(t^{\\star})$. It is the proportion of null ITPC values that are greater than or equal to the observed value. A standard finite-sample correction is applied to prevent $p$-values of $0$ and provide a more conservative estimate:\n    $$\n    p = \\frac{1 + \\sum_{p=1}^{P} \\mathbf{1}\\left\\{\\mathrm{ITPC}^{(p)}(t^{\\star}) \\ge \\mathrm{ITPC}_{\\mathrm{obs}}(t^{\\star})\\right\\}}{P + 1}\n    $$\n    where $\\mathbf{1}\\{\\cdot\\}$ is the indicator function, which is $1$ if the condition is true and $0$ otherwise. The final value is rounded to six decimal places.\n\nThis entire process is systematically applied to each of the four test cases defined in the problem, yielding four distinct $p$-values.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef _wrap_to_pi(angles):\n    \"\"\"\n    Wraps angles to the interval [-pi, pi].\n    This is a robust way to handle angle wrapping for any real-valued input.\n    \"\"\"\n    return np.arctan2(np.sin(angles), np.cos(angles))\n\ndef calculate_itpc_p_value(N, T, P, t_star, seed, data_gen_params):\n    \"\"\"\n    Calculates the permutation-based p-value for inter-trial phase coherence (ITPC).\n\n    Args:\n        N (int): Number of trials.\n        T (int): Number of time samples per trial.\n        P (int): Number of permutations.\n        t_star (int): Analysis time index.\n        seed (int): Seed for the random number generator.\n        data_gen_params (dict): Parameters for data generation.\n\n    Returns:\n        float: The computed p-value.\n    \"\"\"\n    # 1. Initialization and RNG\n    rng = np.random.default_rng(seed)\n\n    # 2. Data Generation\n    # Initialize with uniform random phases\n    phi_nt = rng.uniform(-np.pi, np.pi, size=(N, T))\n\n    # Apply case-specific modifications\n    case_type = data_gen_params.get('type', 'random')\n    if case_type == 'partial_alignment':\n        theta = data_gen_params['theta']\n        sigma = data_gen_params['sigma']\n        noise = rng.normal(loc=0.0, scale=sigma, size=N)\n        phi_nt[:, t_star] = theta + noise\n    elif case_type == 'perfect_alignment':\n        phi_nt[:, t_star] = 0.0\n\n    # Wrap all generated phases to [-pi, pi] as per problem specification.\n    phi_nt = _wrap_to_pi(phi_nt)\n\n    # 3. Compute Observed ITPC\n    phases_obs = phi_nt[:, t_star]\n    itpc_obs = np.abs(np.mean(np.exp(1j * phases_obs)))\n\n    # 4. Generate Null Distribution\n    itpc_null = np.zeros(P)\n    \n    # Pre-generate all random shifts for efficiency\n    all_shifts = rng.integers(0, T, size=(P, N))\n\n    for p in range(P):\n        shifts = all_shifts[p, :]\n        permuted_time_indices = (t_star - shifts) % T\n\n        # Use fancy indexing to get all permuted phases for this iteration\n        permuted_phases = phi_nt[np.arange(N), permuted_time_indices]\n\n        itpc_null[p] = np.abs(np.mean(np.exp(1j * permuted_phases)))\n\n    # 5. Compute p-value\n    count = np.sum(itpc_null >= itpc_obs)\n    p_value = (1.0 + count) / (P + 1.0)\n\n    return p_value\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: happy path with partial alignment\n        {'N': 24, 'T': 400, 'P': 2000, 't_star': 200, 'seed': 42,\n         'data_gen_params': {'type': 'partial_alignment', 'theta': 1.0, 'sigma': 0.3}},\n        # Case B: random phases, no alignment\n        {'N': 24, 'T': 400, 'P': 2000, 't_star': 123, 'seed': 123,\n         'data_gen_params': {'type': 'random'}},\n        # Case C: perfect alignment\n        {'N': 50, 'T': 300, 'P': 2000, 't_star': 150, 'seed': 7,\n         'data_gen_params': {'type': 'perfect_alignment'}},\n        # Case D: boundary case with degenerate time axis\n        {'N': 10, 'T': 1, 'P': 1000, 't_star': 0, 'seed': 2024,\n         'data_gen_params': {'type': 'degenerate'}}\n    ]\n\n    results = []\n    for case in test_cases:\n        p_val = calculate_itpc_p_value(**case)\n        results.append(f\"{p_val:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}