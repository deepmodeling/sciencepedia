{
    "hands_on_practices": [
        {
            "introduction": "To truly grasp phase-amplitude coupling (PAC), we must first master its quantitative heart: the Modulation Index (MI). This initial practice isolates this core calculation, removing the complexities of signal pre-processing. By working with a pre-defined distribution of high-frequency amplitude across low-frequency phase bins, you can focus entirely on applying the information-theoretic formula that measures how much this distribution deviates from uniformity . This exercise builds an intuition for what the MI value truly represents in the neurophysiological context of slow-oscillation and sleep-spindle interactions during NREM sleep.",
            "id": "5061794",
            "problem": "A central feature of non-rapid eye movement (NREM) sleep architecture is the interaction between cortical slow oscillations and thalamocortical sleep spindles. Cortical slow oscillations are large-amplitude, low-frequency ($0.5$–$1$ $\\mathrm{Hz}$) waves whose phase modulates the instantaneous amplitude of sleep spindles in the sigma band ($11$–$16$ $\\mathrm{Hz}$), reflecting coordinated thalamocortical activity. Consider an artifact-free $10$-minute segment of stage $N2$ NREM sleep during which the local field potential from prefrontal cortex has been band-pass filtered to isolate slow oscillations and sigma-band activity. The instantaneous phase of the slow oscillation and the amplitude envelope of the sigma band have been estimated using the analytic signal derived from the Hilbert transform, and the spindle-band amplitude has been averaged within $N=8$ equal-width phase bins spanning $-\\pi$ to $\\pi$. The resulting phase-binned, normalized mean spindle amplitude distribution (which sums to $1$) is:\n\n$$\np = \\big(0.05,\\ 0.07,\\ 0.08,\\ 0.10,\\ 0.16,\\ 0.18,\\ 0.20,\\ 0.16\\big).\n$$\n\nUsing a principled, information-theoretic definition of phase–amplitude coupling that quantifies how far the observed phase-binned amplitude distribution deviates from a uniform distribution over phase and scales this deviation by its maximum possible value for $N$ bins, compute the coupling value for this dataset. Express your final result as a unitless decimal and round your answer to four significant figures.",
            "solution": "The problem statement is evaluated as valid. It is scientifically grounded in established principles of neurophysiology and signal processing, well-posed with sufficient information for a unique solution, and framed using objective, formalizable language. The provided data are consistent and realistic.\n\nThe problem asks for the computation of a phase-amplitude coupling (PAC) value based on an information-theoretic definition. This definition requires quantifying the deviation of an observed phase-binned amplitude distribution, $P$, from a uniform distribution, $U$, and then normalizing this deviation by its maximum possible value. This procedure precisely describes a standard metric for PAC known as the Modulation Index (MI).\n\nThe core of this metric is the Kullback-Leibler (KL) divergence, $D_{KL}(P||U)$, which measures the information gain when one revises one's beliefs from the prior probability distribution $U$ to the posterior probability distribution $P$. It quantifies the \"distance\" from $P$ to $U$.\n\nThe given observed distribution of normalized spindle amplitude across $N=8$ phase bins is:\n$$ P = (p_1, p_2, \\dots, p_8) = \\big(0.05,\\ 0.07,\\ 0.08,\\ 0.10,\\ 0.16,\\ 0.18,\\ 0.20,\\ 0.16\\big) $$\nA uniform distribution, $U$, over $N=8$ bins would have a probability of $p_i = \\frac{1}{N} = \\frac{1}{8} = 0.125$ for each bin.\n\nThe KL divergence from $P$ to $U$ is defined as:\n$$ D_{KL}(P||U) = \\sum_{i=1}^{N} p_i \\log\\left(\\frac{p_i}{u_i}\\right) $$\nUsing the natural logarithm ($\\ln$), and substituting $u_i = \\frac{1}{N}$:\n$$ D_{KL}(P||U) = \\sum_{i=1}^{N} p_i \\ln(N p_i) = \\sum_{i=1}^{N} p_i (\\ln(N) + \\ln(p_i)) $$\n$$ D_{KL}(P||U) = \\ln(N) \\sum_{i=1}^{N} p_i + \\sum_{i=1}^{N} p_i \\ln(p_i) $$\nSince $P$ is a probability distribution, $\\sum_{i=1}^{N} p_i = 1$. This simplifies the expression in terms of the Shannon entropy of the distribution $P$, which is $H(P) = -\\sum_{i=1}^{N} p_i \\ln(p_i)$.\n$$ D_{KL}(P||U) = \\ln(N) - H(P) $$\nThe maximum possible value for the KL divergence, $D_{KL,max}$, occurs when the distribution is maximally concentrated, i.e., all the amplitude is in a single bin. For such a distribution, $P_{max}$, one $p_k=1$ and all other $p_j=0$ for $j \\neq k$. The entropy of this distribution is $H(P_{max}) = - (1 \\ln(1) + (N-1) \\times 0 \\ln(0)) = 0$, where we use the limit definition $x \\ln(x) \\to 0$ as $x \\to 0$.\nThe maximum deviation is therefore:\n$$ D_{KL,max} = \\ln(N) - H(P_{max}) = \\ln(N) $$\nThe Modulation Index (MI) is the KL divergence normalized by this maximum value:\n$$ \\text{MI} = \\frac{D_{KL}(P||U)}{D_{KL,max}} = \\frac{\\ln(N) - H(P)}{\\ln(N)} $$\nWe now compute this value for the given data.\nFirst, we calculate the Shannon entropy $H(P)$ for the distribution $p$:\n$$ H(P) = - \\sum_{i=1}^{8} p_i \\ln(p_i) $$\n$$ H(P) = - \\big[ 0.05 \\ln(0.05) + 0.07 \\ln(0.07) + 0.08 \\ln(0.08) + 0.10 \\ln(0.10) + 0.16 \\ln(0.16) + 0.18 \\ln(0.18) + 0.20 \\ln(0.20) + 0.16 \\ln(0.16) \\big] $$\nThe individual terms are:\n$0.05 \\ln(0.05) \\approx -0.149787$\n$0.07 \\ln(0.07) \\approx -0.186148$\n$0.08 \\ln(0.08) \\approx -0.202058$\n$0.10 \\ln(0.10) \\approx -0.230259$\n$2 \\times 0.16 \\ln(0.16) \\approx 2 \\times (-0.293213) = -0.586426$\n$0.18 \\ln(0.18) \\approx -0.308664$\n$0.20 \\ln(0.20) \\approx -0.321888$\n\nSumming these values:\n$$ \\sum_{i=1}^{8} p_i \\ln(p_i) \\approx -0.149787 - 0.186148 - 0.202058 - 0.230259 - 0.586426 - 0.308664 - 0.321888 = -1.985230 $$\nThus, the entropy is:\n$$ H(P) \\approx -(-1.985230) = 1.985230 \\text{ nats} $$\nThe maximum possible entropy for $N=8$ bins is:\n$$ H_{max} = \\ln(N) = \\ln(8) \\approx 2.079442 \\text{ nats} $$\nNow, we can compute the Modulation Index:\n$$ \\text{MI} = \\frac{\\ln(8) - H(P)}{\\ln(8)} \\approx \\frac{2.079442 - 1.985230}{2.079442} $$\n$$ \\text{MI} \\approx \\frac{0.094212}{2.079442} \\approx 0.0453063 $$\nThe problem requires the result to be rounded to four significant figures.\n$$ \\text{MI} \\approx 0.04531 $$\nThis unitless value represents the strength of the phase-amplitude coupling. A value of $0$ indicates no coupling (a uniform amplitude distribution), while a value of $1$ indicates maximal coupling (all amplitude locked to a single phase bin).",
            "answer": "$$\\boxed{0.04531}$$"
        },
        {
            "introduction": "Moving from a single calculation to a complete workflow is a critical step in developing practical data analysis skills. This exercise guides you through implementing an entire PAC analysis pipeline, from generating synthetic data with known ground-truth coupling to performing the statistical test for a significant change . By simulating signals that mimic intracranial EEG during preictal and ictal periods in epilepsy, you will gain hands-on experience with filtering, applying the Hilbert transform, calculating the Modulation Index, and using surrogate data to assess statistical significance—a comprehensive skillset for any neuroscientist.",
            "id": "5015887",
            "problem": "You are given the task of quantifying phase–amplitude coupling (PAC) between the phase of a low-frequency oscillation and the amplitude of a high-frequency oscillation in a single intracranial electroencephalography (iEEG) channel, and then testing whether this coupling significantly increases from the preictal period to the ictal period. The investigation concerns epilepsy and seizure network dynamics and is grounded in well-tested signal processing principles applied to iEEG neurophysiology.\n\nStarting principles and definitions:\n\n- Let $x(t)$ be a real-valued iEEG time series sampled at rate $f_s$ samples per second (in $\\mathrm{Hz}$). A band-pass filtered component $x_{[f_{\\ell},f_h]}(t)$ is obtained using a zero-phase finite impulse response filter with passband $[f_{\\ell},f_h]$ where $f_{\\ell}$ and $f_h$ are in $\\mathrm{Hz}$.\n- For a real signal $y(t)$, the analytic signal defined via the Hilbert transform is $z(t) = y(t) + i\\,\\mathcal{H}\\{y(t)\\}$. The instantaneous amplitude is $A(t) = |z(t)|$, and the instantaneous phase (in radians) is $\\phi(t) = \\arg[z(t)]$.\n- Phase–amplitude coupling is operationalized by taking the instantaneous phase of the theta band ($4–8\\,\\mathrm{Hz}$) and the instantaneous amplitude of the gamma band ($30–80\\,\\mathrm{Hz}$). To quantify coupling, partition the phase range $[-\\pi,\\pi)$ into $N$ equal bins. For each bin $k \\in \\{1,\\dots,N\\}$, compute the mean gamma amplitude $\\bar{A}_k$ over time points whose theta phase falls in bin $k$. Let $p_k = \\bar{A}_k / \\sum_{j=1}^{N} \\bar{A}_j$ and $u_k = 1/N$ be the uniform distribution. The Modulation Index (MI) is the normalized Kullback–Leibler divergence\n$$\n\\mathrm{MI} = \\frac{ \\sum_{k=1}^{N} p_k \\log\\left(\\frac{p_k}{u_k}\\right)}{ \\log(N) }.\n$$\n- To test a significant change in PAC, define the observed difference $\\Delta_{\\mathrm{obs}} = \\mathrm{MI}_{\\mathrm{ictal}} - \\mathrm{MI}_{\\mathrm{preictal}}$. Construct a null distribution for $\\Delta$ by circularly shifting the gamma amplitude time series relative to the theta phase (independently within the preictal and ictal segments) by random offsets (measured in samples) and recomputing the difference. The one-sided $p$-value for an increase is the proportion of surrogate differences greater than or equal to $\\Delta_{\\mathrm{obs}}$, using a total of $S$ surrogates. A statistically significant increase is declared if $\\Delta_{\\mathrm{obs}} > 0$ and $p < \\alpha$, where $\\alpha$ is the significance level.\n\nYour program must implement the above principles and produce results for the following self-contained test suite. In each test, generate synthetic iEEG signals for preictal and ictal periods using the following generative model. Let $\\theta(t) = 2\\pi f_{\\theta} t$ and $\\gamma(t) = 2\\pi f_{\\gamma} t$, with $t$ in seconds. The iEEG signal is\n$$\nx(t) = A_{\\theta}\\cos\\left(\\theta(t)\\right) + \\left[A_{\\gamma,0}\\left(1 + k\\cos\\left(\\theta(t) - \\phi_0\\right)\\right)\\right]\\cos\\left(\\gamma(t)\\right) + \\eta(t),\n$$\nwhere $\\eta(t)$ is zero-mean Gaussian noise with standard deviation $\\sigma$ (in the same units as $x(t)$), $k$ is the coupling strength (dimensionless), $A_{\\theta}$ and $A_{\\gamma,0}$ are baseline amplitudes, and $\\phi_0$ is a preferred theta phase (in radians). Ensure the amplitude envelope is nonnegative for all $t$ by choosing $k$ such that $1 + k\\cos(\\cdot) \\ge 0$.\n\nFor each test case, perform the following steps:\n\n1. Generate preictal and ictal iEEG signals using the generative model with the specified parameters below.\n2. Extract theta phase by band-pass filtering $x(t)$ in $[4,8]\\,\\mathrm{Hz}$ and computing the analytic phase $\\phi_{\\theta}(t)$ in radians.\n3. Extract gamma amplitude by band-pass filtering $x(t)$ in $[30,80]\\,\\mathrm{Hz}$ and computing the analytic amplitude $A_{\\gamma}(t)$.\n4. Compute $\\mathrm{MI}_{\\mathrm{preictal}}$ and $\\mathrm{MI}_{\\mathrm{ictal}}$ using $N$ phase bins.\n5. Compute the one-sided $p$-value for an increase using $S$ circular-shift surrogates independently in the preictal and ictal segments.\n6. Return a boolean result for each test case indicating whether there is a statistically significant increase in PAC from preictal to ictal at level $\\alpha$.\n\nUse radians for all phase quantities. Use $\\mathrm{Hz}$ for frequencies and seconds for time. The final outputs are booleans; no physical unit is needed for the outputs.\n\nTest suite parameter sets (each case uses $A_{\\theta} = 0.5$, $A_{\\gamma,0} = 1.0$, $\\phi_0 = 0$ radians, $N = 18$ bins, $S = 200$ surrogates, and $\\alpha = 0.05$):\n\n- Case $1$ (happy path: clear increase in coupling):\n  - Sampling rate $f_s = 1000\\,\\mathrm{Hz}$,\n  - Preictal duration $T_{\\mathrm{pre}} = 10\\,\\mathrm{s}$,\n  - Ictal duration $T_{\\mathrm{ict}} = 10\\,\\mathrm{s}$,\n  - Theta frequency $f_{\\theta} = 6\\,\\mathrm{Hz}$,\n  - Gamma frequency $f_{\\gamma} = 50\\,\\mathrm{Hz}$,\n  - Preictal coupling $k_{\\mathrm{pre}} = 0.10$,\n  - Ictal coupling $k_{\\mathrm{ict}} = 0.40$,\n  - Noise standard deviation $\\sigma = 0.5$.\n- Case $2$ (no change in coupling):\n  - $f_s = 1000\\,\\mathrm{Hz}$,\n  - $T_{\\mathrm{pre}} = 10\\,\\mathrm{s}$,\n  - $T_{\\mathrm{ict}} = 10\\,\\mathrm{s}$,\n  - $f_{\\theta} = 6\\,\\mathrm{Hz}$,\n  - $f_{\\gamma} = 50\\,\\mathrm{Hz}$,\n  - $k_{\\mathrm{pre}} = 0.20$,\n  - $k_{\\mathrm{ict}} = 0.20$,\n  - $\\sigma = 0.5$.\n- Case $3$ (decrease in coupling):\n  - $f_s = 1000\\,\\mathrm{Hz}$,\n  - $T_{\\mathrm{pre}} = 10\\,\\mathrm{s}$,\n  - $T_{\\mathrm{ict}} = 10\\,\\mathrm{s}$,\n  - $f_{\\theta} = 6\\,\\mathrm{Hz}$,\n  - $f_{\\gamma} = 50\\,\\mathrm{Hz}$,\n  - $k_{\\mathrm{pre}} = 0.35$,\n  - $k_{\\mathrm{ict}} = 0.05$,\n  - $\\sigma = 0.5$.\n- Case $4$ (boundary: shorter segments challenge detection):\n  - $f_s = 1000\\,\\mathrm{Hz}$,\n  - $T_{\\mathrm{pre}} = 5\\,\\mathrm{s}$,\n  - $T_{\\mathrm{ict}} = 5\\,\\mathrm{s}$,\n  - $f_{\\theta} = 6\\,\\mathrm{Hz}$,\n  - $f_{\\gamma} = 50\\,\\mathrm{Hz}$,\n  - $k_{\\mathrm{pre}} = 0.10$,\n  - $k_{\\mathrm{ict}} = 0.40$,\n  - $\\sigma = 0.7$.\n\nFinal output format:\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"), where each \"result\" is a boolean ($\\mathrm{True}$ or $\\mathrm{False}$) indicating whether there is a statistically significant increase in PAC from preictal to ictal at level $\\alpha$ for the corresponding test case.",
            "solution": "The user has provided a problem that is scientifically sound, well-posed, and objective. It outlines a standard procedure in computational neuroscience for quantifying and comparing phase-amplitude coupling (PAC) between two physiological states. The problem requires the implementation of a full pipeline, from signal generation to statistical analysis, based on established principles. The methods specified—including the use of a zero-phase FIR filter, the Hilbert transform for extracting analytic signal components, the Modulation Index (MI) based on Kullback-Leibler divergence, and a permutation test using circular shifts for statistical inference—are all standard and appropriate for the task.\n\nThe problem is specified with sufficient detail to allow for a unique and verifiable solution, with one minor exception: the order of the finite impulse response (FIR) filter is not provided. This is a necessary parameter for filter design. In accordance with my role as an expert, I will select reasonable, standard values for this parameter and state my choice. This omission does not invalidate the problem, as a practitioner in the field is expected to make such a choice based on established heuristics. I will proceed with a full solution.\n\nHere is a step-by-step breakdown of the methodology employed.\n\n**1. Synthetic Signal Generation**\n\nThe foundation of this problem is the generative model for the intracranial electroencephalography (iEEG) signal, $x(t)$. The model is given by:\n$$\nx(t) = A_{\\theta}\\cos(2\\pi f_{\\theta} t) + \\left[A_{\\gamma,0}\\left(1 + k\\cos(2\\pi f_{\\theta} t - \\phi_0)\\right)\\right]\\cos(2\\pi f_{\\gamma} t) + \\eta(t)\n$$\nThis equation describes a signal composed of three parts: a low-frequency theta oscillation, a high-frequency gamma oscillation whose amplitude is modulated by the phase of the theta oscillation, and additive Gaussian noise $\\eta(t)$ with standard deviation $\\sigma$. The parameter $k$ controls the strength of the coupling. For each test case, we generate two such signals: one for the preictal period with coupling $k_{\\mathrm{pre}}$, and one for the ictal period with coupling $k_{\\mathrm{ict}}$. The time vector $t$ is generated for the specified duration ($T_{\\mathrm{pre}}$ or $T_{\\mathrm{ict}}$) and sampling rate ($f_s$).\n\n**2. Signal Processing: Filtering and Analytic Signal Extraction**\n\nTo isolate the relevant frequency components, we apply band-pass filtering. The problem specifies a zero-phase FIR filter. This is implemented using two functions from the `scipy.signal` library:\n- `scipy.signal.firwin`: This function designs a linear-phase FIR filter given a filter order and cutoff frequencies. For the filter order, which was not specified, I will use standard heuristics. For the theta band ($[4, 8]\\,\\mathrm{Hz}$), an order of $251$ is chosen, corresponding to approximately one full cycle of the lowest frequency ($4\\,\\mathrm{Hz}$) at the given sampling rate of $1000\\,\\mathrm{Hz}$. For the gamma band ($[30, 80]\\,\\mathrm{Hz}$), an order of $101$ is chosen. Odd filter orders are selected to create Type I (symmetric) filters.\n- `scipy.signal.filtfilt`: This function applies the designed filter to the signal twice, once forward and once backward. This procedure removes the phase delay introduced by the filter, resulting in the required zero-phase output.\n\nAfter filtering, we obtain the theta-band signal $x_{\\theta}(t)$ and the gamma-band signal $x_{\\gamma}(t)$. From these, we extract the instantaneous phase and amplitude. This is accomplished using the Hilbert transform, $\\mathcal{H}$, to construct the analytic signal $z(t) = y(t) + i\\,\\mathcal{H}\\{y(t)\\}$.\n- The theta phase is extracted as $\\phi_{\\theta}(t) = \\arg[z_{\\theta}(t)]$, where $z_{\\theta}(t)$ is the analytic signal of $x_{\\theta}(t)$.\n- The gamma amplitude is extracted as $A_{\\gamma}(t) = |z_{\\gamma}(t)|$, where $z_{\\gamma}(t)$ is the analytic signal of $x_{\\gamma}(t)$.\n\n**3. Quantification of Coupling: The Modulation Index (MI)**\n\nThe degree of PAC is quantified using the Modulation Index (MI). This involves the following steps for a given pair of phase ($\\phi_{\\theta}$) and amplitude ($A_{\\gamma}$) time series:\n1.  The continuous phase range $[-\\pi, \\pi)$ is discretized into $N=18$ equal-sized bins.\n2.  For each time point $t$, we identify which phase bin the value $\\phi_{\\theta}(t)$ falls into.\n3.  For each bin $k \\in \\{1, \\dots, N\\}$, we calculate the mean of all gamma amplitude values $A_{\\gamma}(t)$ whose corresponding phase $\\phi_{\\theta}(t)$ fell into that bin. Let this mean amplitude be $\\bar{A}_k$.\n4.  This distribution of mean amplitudes is normalized to form a probability distribution $p_k = \\bar{A}_k / \\sum_{j=1}^{N} \\bar{A}_j$.\n5.  The MI is then calculated as the normalized Kullback-Leibler (KL) divergence between the distribution $P = \\{p_k\\}$ and a uniform distribution $U = \\{u_k = 1/N\\}$. The formula is:\n    $$\n    \\mathrm{MI} = \\frac{ D_{KL}(P || U) }{ \\log(N) } = \\frac{ \\sum_{k=1}^{N} p_k \\log\\left(\\frac{p_k}{u_k}\\right)}{ \\log(N) }\n    $$\n    An MI of $0$ indicates no coupling (the amplitude distribution is uniform across phase bins), while an MI approaching $1$ indicates maximal coupling. In implementation, care is taken to handle the case where $p_k=0$, for which the term $p_k \\log(p_k)$ is defined as $0$.\n\n**4. Statistical Hypothesis Testing**\n\nTo determine if the PAC increase from preictal to ictal is statistically significant, we perform a non-parametric permutation test.\n1.  First, we compute the MI for the preictal and ictal periods, $\\mathrm{MI}_{\\mathrm{preictal}}$ and $\\mathrm{MI}_{\\mathrm{ictal}}$, respectively. The observed difference is $\\Delta_{\\mathrm{obs}} = \\mathrm{MI}_{\\mathrm{ictal}} - \\mathrm{MI}_{\\mathrm{preictal}}$.\n2.  Next, we generate a null distribution of such differences under the hypothesis of no coupling. This is done by repeatedly breaking the relationship between the theta phase and gamma amplitude time series. For each of $S=200$ surrogate trials:\n    a. Within the preictal segment, the gamma amplitude time series $A_{\\gamma, \\mathrm{pre}}(t)$ is circularly shifted by a random number of samples. A new surrogate MI, $\\mathrm{MI}_{\\mathrm{pre, surr}}$, is computed using the original phase $\\phi_{\\theta, \\mathrm{pre}}(t)$ and the shifted amplitude.\n    b. The same procedure is performed independently on the ictal segment to compute $\\mathrm{MI}_{\\mathrm{ict, surr}}$.\n    c. A surrogate difference is calculated: $\\Delta_{\\mathrm{surr}} = \\mathrm{MI}_{\\mathrm{ict, surr}} - \\mathrm{MI}_{\\mathrm{pre, surr}}$.\n3.  The collection of $S$ surrogate differences forms the empirical null distribution. The one-sided p-value is the proportion of surrogate differences that are greater than or equal to the observed difference: $p = \\frac{\\text{count}(\\Delta_{\\mathrm{surr}} \\ge \\Delta_{\\mathrm{obs}})}{S}$.\n4.  A statistically significant increase in PAC is declared if two conditions are met: the observed difference shows an increase ($\\Delta_{\\mathrm{obs}} > 0$) and the p-value is below the significance level ($p  \\alpha = 0.05$).\n\nThis complete pipeline is applied to each of the four test cases provided. For reproducibility, a fixed seed is used for the random number generator, which affects both the noise generation and the surrogate shifts.",
            "answer": "```python\nimport numpy as np\nfrom scipy import signal\n\ndef solve():\n    \"\"\"\n    Main function to solve the PAC analysis problem for all test cases.\n    \"\"\"\n    # Set a seed for reproducibility of noise and surrogate shifts.\n    np.random.seed(0)\n\n    # Define the test cases from the problem statement.\n    common_params = {\n        'A_theta': 0.5,\n        'A_gamma0': 1.0,\n        'phi0': 0.0,\n        'N_bins': 18,\n        'S_surrogates': 200,\n        'alpha': 0.05,\n    }\n    test_cases = [\n        # Case 1 (happy path: clear increase in coupling)\n        {'fs': 1000, 'T_pre': 10, 'T_ict': 10, 'f_theta': 6, 'f_gamma': 50, 'k_pre': 0.10, 'k_ict': 0.40, 'sigma': 0.5},\n        # Case 2 (no change in coupling)\n        {'fs': 1000, 'T_pre': 10, 'T_ict': 10, 'f_theta': 6, 'f_gamma': 50, 'k_pre': 0.20, 'k_ict': 0.20, 'sigma': 0.5},\n        # Case 3 (decrease in coupling)\n        {'fs': 1000, 'T_pre': 10, 'T_ict': 10, 'f_theta': 6, 'f_gamma': 50, 'k_pre': 0.35, 'k_ict': 0.05, 'sigma': 0.5},\n        # Case 4 (boundary: shorter segments challenge detection)\n        {'fs': 1000, 'T_pre': 5, 'T_ict': 5, 'f_theta': 6, 'f_gamma': 50, 'k_pre': 0.10, 'k_ict': 0.40, 'sigma': 0.7},\n    ]\n\n    def generate_signal(T, fs, f_theta, f_gamma, A_theta, A_gamma0, k, phi0, sigma):\n        \"\"\"Generates the synthetic iEEG signal based on the model.\"\"\"\n        num_samples = int(T * fs)\n        t = np.arange(num_samples) / fs\n        theta_t = 2 * np.pi * f_theta * t\n        gamma_t = 2 * np.pi * f_gamma * t\n        \n        # Generative model\n        low_freq_component = A_theta * np.cos(theta_t)\n        amp_modulator = A_gamma0 * (1 + k * np.cos(theta_t - phi0))\n        high_freq_component = amp_modulator * np.cos(gamma_t)\n        noise = sigma * np.random.randn(num_samples)\n        \n        return low_freq_component + high_freq_component + noise\n\n    def compute_mi(phase, amp, N_bins):\n        \"\"\"Computes the Modulation Index (MI).\"\"\"\n        phase_bins = np.linspace(-np.pi, np.pi, N_bins + 1)\n        # Assign each phase value to a bin. np.digitize uses 1-based indexing for bins.\n        binned_phase = np.digitize(phase, bins=phase_bins)\n        \n        mean_amp_per_bin = np.zeros(N_bins)\n        for k in range(1, N_bins + 1):\n            amp_in_bin = amp[binned_phase == k]\n            if len(amp_in_bin) > 0:\n                mean_amp_per_bin[k-1] = np.mean(amp_in_bin)\n        \n        # Normalize to a probability distribution p_k\n        total_mean_amp = np.sum(mean_amp_per_bin)\n        if total_mean_amp == 0:\n            return 0.0\n        \n        p = mean_amp_per_bin / total_mean_amp\n        \n        # Compute Kullback-Leibler divergence D_KL(P || U)\n        u = 1.0 / N_bins\n        p_nonzero = p[p > 0]\n        # KL divergence: sum(p*log(p/u)) = sum(p*log(p)) - sum(p*log(u))\n        # = sum(p*log(p)) + log(N)\n        kl_div = np.sum(p_nonzero * np.log(p_nonzero)) + np.log(N_bins)\n        \n        # Normalize by log(N)\n        mi = kl_div / np.log(N_bins)\n        return mi\n\n    results = []\n    \n    # Filter parameters\n    theta_band = [4, 8]\n    gamma_band = [30, 80]\n    fir_order_theta = 251 # Corresponds to ~1 cycle of the 4 Hz component at 1 kHz fs\n    fir_order_gamma = 101 # Corresponds to ~3 cycles of the 30 Hz component at 1 kHz fs\n\n    for case_params in test_cases:\n        params = {**common_params, **case_params}\n        fs = params['fs']\n        \n        # 1. Generate preictal and ictal signals\n        x_pre = generate_signal(params['T_pre'], fs, params['f_theta'], params['f_gamma'], params['A_theta'], params['A_gamma0'], params['k_pre'], params['phi0'], params['sigma'])\n        x_ict = generate_signal(params['T_ict'], fs, params['f_theta'], params['f_gamma'], params['A_theta'], params['A_gamma0'], params['k_ict'], params['phi0'], params['sigma'])\n        \n        # 2-3. Filter signals and extract phase/amplitude\n        # Design filters\n        b_theta = signal.firwin(fir_order_theta, theta_band, fs=fs, pass_zero='bandpass')\n        b_gamma = signal.firwin(fir_order_gamma, gamma_band, fs=fs, pass_zero='bandpass')\n        \n        # Preictal processing\n        x_pre_theta = signal.filtfilt(b_theta, 1, x_pre)\n        phase_pre = np.angle(signal.hilbert(x_pre_theta))\n        x_pre_gamma = signal.filtfilt(b_gamma, 1, x_pre)\n        amp_pre = np.abs(signal.hilbert(x_pre_gamma))\n        \n        # Ictal processing\n        x_ict_theta = signal.filtfilt(b_theta, 1, x_ict)\n        phase_ict = np.angle(signal.hilbert(x_ict_theta))\n        x_ict_gamma = signal.filtfilt(b_gamma, 1, x_ict)\n        amp_ict = np.abs(signal.hilbert(x_ict_gamma))\n        \n        # 4. Compute observed MI and their difference\n        mi_pre = compute_mi(phase_pre, amp_pre, params['N_bins'])\n        mi_ict = compute_mi(phase_ict, amp_ict, params['N_bins'])\n        obs_diff = mi_ict - mi_pre\n        \n        # 5. Perform surrogate testing\n        surrogate_diffs = np.zeros(params['S_surrogates'])\n        for i in range(params['S_surrogates']):\n            # Preictal surrogate\n            shift_pre = np.random.randint(1, len(amp_pre))\n            amp_pre_surr = np.roll(amp_pre, shift_pre)\n            mi_pre_surr = compute_mi(phase_pre, amp_pre_surr, params['N_bins'])\n            \n            # Ictal surrogate\n            shift_ict = np.random.randint(1, len(amp_ict))\n            amp_ict_surr = np.roll(amp_ict, shift_ict)\n            mi_ict_surr = compute_mi(phase_ict, amp_ict_surr, params['N_bins'])\n            \n            surrogate_diffs[i] = mi_ict_surr - mi_pre_surr\n            \n        # Compute one-sided p-value\n        p_value = np.sum(surrogate_diffs >= obs_diff) / params['S_surrogates']\n        \n        # 6. Determine significance\n        is_significant_increase = (obs_diff > 0) and (p_value  params['alpha'])\n        results.append(is_significant_increase)\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "After learning how to compute PAC, an expert practitioner must learn how to critically interpret the results. This advanced practice challenges you to think about a major pitfall in PAC analysis: spurious coupling caused by non-sinusoidal waveform shapes rather than genuine cross-frequency interaction. The exercise presents two generative models—one with a non-sinusoidal artifact and one with true amplitude modulation—and asks you to reason about how PAC estimators and alternative measures like the bispectrum would respond to each . Developing this nuanced understanding is essential for distinguishing true neural communication from methodological artifacts.",
            "id": "4151524",
            "problem": "Consider a continuous neural time series $x(t)$ composed of two additive components under two alternative generative scenarios that are commonly encountered in electrophysiology. Let $x(t) = s_L(t) + s_H(t)$ where $s_L(t)$ is a low-frequency component with fundamental frequency $f_L$, and $s_H(t)$ is a high-frequency component. The analytic signal of a bandpassed version $x_H(t)$ centered at $f_H$ is $z_H(t) = A_H(t) e^{i \\phi_H(t)}$, where $A_H(t)$ is the instantaneous amplitude (envelope) and $\\phi_H(t)$ is the instantaneous phase. The phase of the low-frequency component is $\\phi_L(t)$, obtained via the Hilbert transform in a narrow band around $f_L$. Phase–Amplitude Coupling (PAC) refers to a statistical dependence between $\\phi_L(t)$ and $A_H(t)$.\n\nThe bispectrum of $x(t)$ is defined via its Fourier transform $X(f)$ as $B(f_1,f_2) = \\mathbb{E}\\left[ X(f_1) X(f_2) X^*(f_1 + f_2) \\right]$, where $*$ denotes complex conjugation and the expectation is taken over time segments or trials under stationarity. The bispectrum measures quadratic phase coupling among frequency triplets $(f_1, f_2, f_3)$ that satisfy $f_3 = f_1 + f_2$.\n\nTwo models are considered:\n\nModel $\\mathrm{A}$ (non-sinusoidal waveform shape): $s_L(t) = \\sum_{n=1}^{N} c_n \\cos\\!\\left(2\\pi n f_L t + \\psi_n\\right)$ with $N \\geq 2$, $c_n \\in \\mathbb{R}$, and phases $\\psi_n$ stable over the observation. There is no explicit narrowband high-frequency carrier; $s_H(t)$ is negligible, but bandpass filtering at frequencies above $f_L$ can capture broadband transients generated by sharp features in $s_L(t)$.\n\nModel $\\mathrm{B}$ (genuine amplitude modulation): $s_H(t) = \\left(a_0 + m \\cos\\!\\left(\\phi_L(t) + \\theta\\right)\\right) \\cos\\!\\left(2\\pi f_H t\\right)$ with $a_0 \\geq 0$, $m \\geq 0$, and a phase offset $\\theta$. Here the low-frequency phase $\\phi_L(t)$ modulates the amplitude of a narrowband carrier at $f_H$.\n\nStarting from the standard properties of Fourier analysis and Hilbert transforms, and using only their core definitions, reason about the spectral and statistical signatures of the two models. In particular, address how PAC estimators and the bispectrum behave in each case, including the role of sidebands and harmonics, and the impact of trial averaging when the modulator-carrier phase offset $\\theta$ varies across trials.\n\nWhich statements correctly characterize the relative behavior of Phase–Amplitude Coupling estimators and bispectral measures under Models $\\mathrm{A}$ and $\\mathrm{B}$?\n\nA. In Model $\\mathrm{A}$, the bispectrum displays strong peaks among harmonics of $f_L$ due to stable quadratic phase coupling inherent to non-sinusoidal waveform shape, and PAC estimators can report elevated coupling between $\\phi_L(t)$ and $A_H(t)$ even without a true high-frequency carrier, because broadband transients inflate $A_H(t)$ at specific low-frequency phases. In Model $\\mathrm{B}$, the bispectrum shows peaks connecting $f_L$ with the carrier sidebands at $f_H \\pm f_L$, while PAC estimators detect dependence between $\\phi_L(t)$ and $A_H(t)$; thus, bispectrum distinguishes genuine amplitude modulation by sidebands rather than integer harmonics.\n\nB. The bispectrum cannot detect amplitude modulation under any circumstances because it is a third-order statistic that is only sensitive to non-Gaussian noise; by contrast, PAC estimators detect both non-sinusoidal waveform harmonics and genuine amplitude modulation equally well.\n\nC. When $s_L(t)$ is non-sinusoidal, PAC estimates computed from the Hilbert transform remain exactly zero because the amplitude envelope $A_H(t)$ is orthogonal to $\\phi_L(t)$, whereas the bispectrum correctly detects harmonic coupling; therefore, PAC is immune to waveform shape.\n\nD. If $\\theta$ in Model $\\mathrm{B}$ varies randomly across trials, bispectrum estimates averaged across trials can be strongly attenuated due to loss of phase consistency in the triple product $X(f_1) X(f_2) X^*(f_1+f_2)$, whereas within-trial PAC estimators can still detect the dependence between $\\phi_L(t)$ and $A_H(t)$ by time-resolved statistics, even if cross-trial phase alignment is weak.\n\nE. Frequency modulation of the high-frequency carrier by $f_L$ produces bispectral peaks identical to amplitude modulation and increases PAC to the same degree as amplitude modulation; therefore, bispectrum and PAC cannot distinguish amplitude from frequency modulation.\n\nSelect all correct options.",
            "solution": "We begin from core definitions in time-frequency analysis. The analytic signal for a bandpassed component $x_H(t)$ centered at frequency $f_H$ is $z_H(t) = A_H(t) e^{i \\phi_H(t)}$, where $A_H(t)$ is the instantaneous amplitude (envelope) and $\\phi_H(t)$ is the instantaneous phase obtained by the Hilbert transform. Phase–Amplitude Coupling (PAC) quantifies statistical dependence between the low-frequency phase $\\phi_L(t)$ and the high-frequency amplitude $A_H(t)$, which can be assessed by measures of dependence such as correlation, mutual information, or phase-binned amplitude non-uniformity. The bispectrum is defined as $B(f_1,f_2) = \\mathbb{E}\\left[ X(f_1) X(f_2) X^*(f_1 + f_2) \\right]$, the ensemble expectation of a triple product of Fourier coefficients whose phases enter as $\\angle X(f_1) + \\angle X(f_2) - \\angle X(f_1 + f_2)$; nonzero values indicate consistent quadratic phase coupling among the triad, either within time segments or across trials.\n\nWe analyze the two models:\n\nModel $\\mathrm{A}$: $s_L(t)$ is non-sinusoidal and has a Fourier series $s_L(t) = \\sum_{n=1}^{N} c_n \\cos(2\\pi n f_L t + \\psi_n)$, with $N \\geq 2$. This implies discrete spectral lines at $n f_L$ with fixed phases $\\psi_n$ over the observation. Because the waveform is deterministic and non-sinusoidal, there are intrinsic harmonic relations. For any pair of harmonics $(k f_L, m f_L)$, their sum is $(k+m) f_L$, which is also a harmonic. The bispectrum $B(k f_L, m f_L)$ depends on $\\mathbb{E}\\left[ X(k f_L) X(m f_L) X^*((k+m) f_L) \\right]$. With stable phases $\\psi_n$, the phase combination $\\psi_k + \\psi_m - \\psi_{k+m}$ is constant, so $B(k f_L,m f_L)$ is nonzero. Therefore, the bispectrum naturally exhibits peaks among harmonic triplets of the fundamental due to waveform shape. Even if there is no narrowband high-frequency carrier, bandpassing $x(t)$ at frequencies above $f_L$ captures broadband energy concentrated near sharp features. Sharp transients inflate the instantaneous amplitude $A_H(t)$ at particular phases of $\\phi_L(t)$ (e.g., near peaks or troughs), leading PAC estimators to report dependence between $\\phi_L(t)$ and $A_H(t)$ despite the absence of a distinct high-frequency generator. Hence, non-sinusoidal waveform shape can produce elevated PAC and strong bispectral coupling among harmonics.\n\nModel $\\mathrm{B}$: $s_H(t) = \\left(a_0 + m \\cos(\\phi_L(t) + \\theta)\\right) \\cos(2\\pi f_H t)$ represents amplitude modulation of a carrier at $f_H$ by a low-frequency process whose instantaneous phase is $\\phi_L(t)$. To understand its spectral content, consider a simplified case where $\\phi_L(t) \\approx 2\\pi f_L t$ over a short interval and apply the trigonometric identity $\\cos \\alpha \\cos \\beta = \\frac{1}{2}\\left[\\cos(\\alpha+\\beta) + \\cos(\\alpha-\\beta)\\right]$. Then\n$$\ns_H(t) = a_0 \\cos(2\\pi f_H t) + m \\cos(2\\pi f_L t + \\theta) \\cos(2\\pi f_H t)\n= a_0 \\cos(2\\pi f_H t) + \\frac{m}{2} \\cos\\!\\left( 2\\pi (f_H + f_L) t + \\theta \\right) + \\frac{m}{2} \\cos\\!\\left( 2\\pi (f_H - f_L) t - \\theta \\right).\n$$\n\nThus amplitude modulation generates sidebands at $f_H \\pm f_L$ with phases offset by $\\pm \\theta$. The bispectrum will be nonzero for triads involving $(f_L, f_H)$ and $f_H + f_L$, since $X(f_L) X(f_H) X^*(f_H + f_L)$ has a stable phase combination $\\angle X(f_L) + \\angle X(f_H) - \\angle X(f_H + f_L) \\approx \\theta$ if phases are consistent; similarly, $B(f_L, f_H - f_L)$ couples to $f_H$. Hence, genuine amplitude modulation is detected by bispectral peaks that connect the low frequency and the high-frequency carrier via sidebands, which are not integer multiples of $f_L$. PAC estimators detect dependence between $\\phi_L(t)$ and $A_H(t)$ because the envelope $A_H(t)$ contains the modulator at $f_L$, producing elevated cross-frequency dependence.\n\nImpact of trial averaging and phase variability: The bispectrum relies on phase consistency of the triads across segments or trials, as it averages the complex triple product. If the modulator-carrier phase offset $\\theta$ varies randomly across trials, the ensemble average $\\mathbb{E}\\left[ X(f_1) X(f_2) X^*(f_1+f_2) \\right]$ tends to cancel due to rotating phase factors, attenuating bispectral magnitude even when amplitude modulation exists within each trial. PAC estimators commonly compute within-trial dependence between $\\phi_L(t)$ and $A_H(t)$ and then average magnitudes or nonparametric dependence measures across trials; such within-trial statistics can remain elevated despite cross-trial phase misalignment, so PAC can be more robust to random $\\theta$ than bispectrum under trial averaging.\n\nWe now analyze each option:\n\nOption A: This statement asserts two points. First, in Model $\\mathrm{A}$, the bispectrum has strong peaks among harmonics of $f_L$ due to stable quadratic phase coupling, and PAC can be inflated by broadband transients aligned to specific $\\phi_L(t)$—both are consistent with the analysis of non-sinusoidal waveform shape. Second, in Model $\\mathrm{B}$, the bispectrum shows peaks connecting $f_L$ with sidebands at $f_H \\pm f_L$, while PAC detects dependence between $\\phi_L(t)$ and $A_H(t)$; moreover, the bispectrum distinguishes genuine amplitude modulation by sidebands rather than integer harmonics. This matches the derivation of sidebands and triadic couplings for amplitude modulation. Verdict: Correct.\n\nOption B: This claims that the bispectrum cannot detect amplitude modulation under any circumstances and is only sensitive to non-Gaussian noise, while PAC detects both phenomena equally well. Our derivation shows that amplitude modulation produces sidebands and stable phase relations such that $B(f_L,f_H)$ and $B(f_L,f_H-f_L)$ are nonzero when phases are consistent. The bispectrum is designed to detect quadratic phase coupling, not merely non-Gaussian noise, and it does detect amplitude modulation under appropriate conditions. Verdict: Incorrect.\n\nOption C: This asserts that PAC estimates remain exactly zero for non-sinusoidal $s_L(t)$ due to orthogonality between $A_H(t)$ and $\\phi_L(t)$. However, bandpass filtering near high frequencies captures broadband energy from sharp waveform features; the instantaneous amplitude $A_H(t)$ tends to be elevated at specific phases of $\\phi_L(t)$, so PAC can be spuriously high in the presence of non-sinusoidal wave shape. There is no theoretical orthogonality guaranteeing zero dependence between $A_H(t)$ and $\\phi_L(t)$ under these conditions. Verdict: Incorrect.\n\nOption D: This claims that random trial-to-trial variability in $\\theta$ attenuates the bispectrum upon averaging due to loss of phase consistency in the triple product, while within-trial PAC can still detect dependence between $\\phi_L(t)$ and $A_H(t)$. The bispectrum averages complex quantities whose phases rotate with $\\theta$, leading to cancellation when $\\theta$ is random; PAC typically computes within-trial dependence and then averages magnitudes, which is more robust to cross-trial phase variability. This is consistent with the analysis. Verdict: Correct.\n\nOption E: This claims that frequency modulation yields identical bispectral peaks and PAC increases to the same degree as amplitude modulation, implying indistinguishability. In frequency modulation, the carrier frequency is modulated, leading to a spectrum with multiple sidebands given by Bessel function weights at $f_H \\pm k f_L$ for $k \\geq 1$, and phase relationships differ from simple amplitude modulation; PAC, which measures dependence of $\\phi_L(t)$ on $A_H(t)$, need not be elevated in the same way because the envelope $A_H(t)$ in pure frequency modulation can remain approximately constant while the instantaneous frequency varies. The bispectral pattern is not identical to amplitude modulation, and PAC does not necessarily increase similarly. Verdict: Incorrect.\n\nTherefore, the correct options are A and D.",
            "answer": "$$\\boxed{AD}$$"
        }
    ]
}