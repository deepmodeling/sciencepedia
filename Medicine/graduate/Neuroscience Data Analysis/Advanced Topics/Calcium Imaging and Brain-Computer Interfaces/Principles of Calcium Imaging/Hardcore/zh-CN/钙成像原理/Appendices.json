{
    "hands_on_practices": [
        {
            "introduction": "任何定量测量都始于对仪器噪声特性的理解。在钙成像中，荧光信号会受到物理来源的噪声的干扰。CCD或CMOS相机中的总噪声可以被建模为信号相关的“散粒噪声”（源于光的量子特性）和信号无关的“读出噪声”（源于电子器件）的组合。通过分析信号方差如何随其均值变化，我们可以分解这些噪声源，这项练习  提供了一种校准成像系统的实践方法，这是任何严谨定量分析（包括脉冲推断和精确荧光定量）至关重要的第一步。",
            "id": "4188069",
            "problem": "您正在使用光子计数模型和带有电子读出的相机来分析钙成像中的荧光信号。基本假设是：光子到达遵循泊松统计，具有独立的电子读出噪声，并且相机响应是线性的。从以下基本原理出发：(i) 泊松统计意味着，如果检测到的光电子数量用 $N$ 表示，其均值为 $E[N] = \\mu_e$，则方差为 $Var(N) = \\mu_e$；(ii) 随机变量 $X$ 通过 $Y = a X$ 进行线性变换，其方差缩放为 $Var(Y) = a^2 Var(X)$；(iii) 独立随机变量的方差相加，因此如果 $X$ 和 $Z$ 独立，则 $Var(X+Z) = Var(X) + Var(Z)$；(iv) 相机读出噪声可以建模为一个零均值高斯随机变量，其方差为 $Var(R) = \\sigma_r^2$。在这些假设下，推导出连接测量计数值方差与测量计数值均值的函数关系（以计数为单位），并说明如何从测量数据中推断出由散粒噪声和读出噪声引起的贡献。然后，建立法诺因子（定义为方差与均值的比率）的公式，并用它来跨不同亮度水平验证模型。\n\n您的程序必须为每个提供的测试数据集执行以下操作：\n- 通过将一个线性模型拟合到从上述第一性原理推导出的方差-均值关系，从测量的计数值均值和方差中估计有效增益 $k$（单位：计数/电子）和读出噪声标准差 $\\sigma_r$（单位：计数），同时强制参数满足物理非负性。\n- 计算每个亮度水平 $\\mu_i$（单位：计数）下测量的法诺因子 $F_i = Var_i / \\mu_i$，并使用您的拟合参数计算相同亮度水平下模型预测的法诺因子。\n- 对于每个数据集，报告一个三元组，包括估计的有效增益 $k$（单位：计数/电子）、估计的读出噪声标准差 $\\sigma_r$（单位：计数），以及在所有亮度水平上测量与预测的法诺因子之间的最大绝对偏差（无量纲）。\n\n使用以下数据集测试套件，每个数据集由一个测量计数值均值数组和相应的测量计数值方差数组指定。所有计数值都以计数为单位，所有方差都以计数的平方为单位。这些亮度水平是使用线性传感器测量的荧光钙成像的典型值。\n\n- 数据集 $1$（中等亮度范围，混合噪声贡献）：\n  - 均值计数：$[\\;10,\\;30,\\;60,\\;120,\\;240,\\;480\\;]$\n  - 方差计数：$[\\;19.25,\\;45.25,\\;84.25,\\;162.25,\\;318.25,\\;630.25\\;]$\n\n- 数据集 $2$（低亮度范围，读出噪声更显著）：\n  - 均值计数：$[\\;2,\\;4,\\;8,\\;16,\\;32,\\;64\\;]$\n  - 方差计数：$[\\;17.8,\\;19.6,\\;23.2,\\;30.4,\\;44.8,\\;73.6\\;]$\n\n- 数据集 $3$（高亮度范围，散粒噪声占主导）：\n  - 均值计数：$[\\;1000,\\;2000,\\;4000,\\;8000\\;]$\n  - 方差计数：$[\\;1802.25,\\;3602.25,\\;7202.25,\\;14402.25\\;]$\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素对应一个数据集，其本身是一个形式为 $[\\;k,\\;\\sigma_r,\\;d\\;]$ 的列表，其中 $k$ 的单位是计数/电子，$\\sigma_r$ 的单位是计数，$d$ 是最大绝对法诺因子偏差（无量纲）。例如，输出格式必须是 $[\\;[k_1,\\sigma_{r,1},d_1],[k_2,\\sigma_{r,2},d_2],[k_3,\\sigma_{r,3},d_3]\\;]$。",
            "solution": "该问题要求推导相机噪声的函数关系，并应用此模型从实验数据中估计关键传感器参数。推导和分析将基于所提供的第一性原理进行。\n\n首先，我们推导以相机计数表示的测量方差与荧光信号测量均值之间的函数关系。设 $N_e$ 为一个像素在给定时间间隔内检测到的光电子数量。这是一个随机变量。根据原理 (i)，光子到达是一个泊松过程，因此如果光电子的平均数量为 $E[N_e] = \\mu_e$，则方差为 $Var(N_e) = \\mu_e$。\n\n相机电子设备将这些光电子转换为以计数为单位测量的数字信号。设这个转换因子（或增益）为 $k$ 计数/电子。题目说明相机响应是线性的。除了由光子产生的信号（散粒噪声）外，相机还引入了其自身的电子读出噪声，我们用随机变量 $R$ 来表示。以计数为单位的总测量信号 $C$ 是这两个分量的和：\n$$C = k N_e + R$$\n读出噪声 $R$ 假设独立于光电子信号 $N_e$。\n\n我们首先求出测量信号的均值 $\\mu_c = E[C]$。利用期望算子的线性性质：\n$$\\mu_c = E[k N_e + R] = E[k N_e] + E[R] = k E[N_e] + E[R]$$\n根据原理 (iv)，读出噪声 $R$ 是一个零均值过程，所以 $E[R]=0$。因此，测量的信号均值与光电子的平均数量成正比：\n$$\\mu_c = k \\mu_e$$\n这个方程通过增益 $k$ 将以计数为单位的均值信号 $\\mu_c$ 与以光电子为单位的均值信号 $\\mu_e$ 联系起来。我们可以用可测量的 $\\mu_c$ 来表示 $\\mu_e$，即 $\\mu_e = \\mu_c / k$。\n\n接下来，我们推导测量信号的方差 $Var_c = Var(C)$。由于信号分量 $k N_e$ 和读出噪声 $R$ 是独立的，根据原理 (iii)，它们的方差相加：\n$$Var_c = Var(k N_e + R) = Var(k N_e) + Var(R)$$\n根据原理 (iv)，读出噪声的方差为 $Var(R) = \\sigma_r^2$，其中 $\\sigma_r$ 是以计数为单位的读出噪声标准差。对于信号分量，我们使用原理 (ii) 关于线性变换下对方差的缩放：\n$$Var(k N_e) = k^2 Var(N_e)$$\n代入原理 (i) 的泊松特性 $Var(N_e) = \\mu_e$：\n$$Var(k N_e) = k^2 \\mu_e$$\n这一项 $k^2 \\mu_e$ 代表散粒噪声方差。为了用测量的均值计数 $\\mu_c$ 来表示它，我们代入 $\\mu_e = \\mu_c / k$：\n$$Var(k N_e) = k^2 \\left(\\frac{\\mu_c}{k}\\right) = k \\mu_c$$\n结合散粒噪声和读出噪声的方差分量，我们得出最终的函数关系：\n$$Var_c = k \\mu_c + \\sigma_r^2$$\n这个方程对于均值信号 $\\mu_c$ 是线性的。它表明总测量方差 $Var_c$ 是散粒噪声方差（与均值信号线性相关）和读出噪声方差（一个恒定偏移量）之和。这是许多科学成像传感器噪声特性的一个基本模型。\n\n为了从测量数据对 $(\\mu_{c,i}, Var_{c,i})$ 中推断参数 $k$ 和 $\\sigma_r^2$，可以对 $Var_c$ 与 $\\mu_c$ 进行线性回归。拟合线的斜率提供了增益 $k$ 的估计，y轴截距提供了读出噪声方差 $\\sigma_r^2$ 的估计。两个参数都必须是物理上非负的，即 $k \\ge 0$ 和 $\\sigma_r^2 \\ge 0$。因此，非负最小二乘线性拟合是合适的估计方法。\n\n法诺因子，定义为方差与均值的比率，是用于模型验证的一个有用工具。测量的法诺因子为 $F_{meas} = Var_c / \\mu_c$。使用我们推导的模型，预测的法诺因子为：\n$$F_{pred} = \\frac{k \\mu_c + \\sigma_r^2}{\\mu_c} = k + \\frac{\\sigma_r^2}{\\mu_c}$$\n该模型预测法诺因子不是恒定的，而是取决于信号水平 $\\mu_c$。对于高信号水平（$\\mu_c \\gg \\sigma_r^2/k$），法诺因子趋近于一个等于增益 $k$ 的常数值。对于低信号水平，法诺因子由读出噪声项主导并变大。测量与预测的法诺因子之间的偏差，$d = \\max_i |F_{meas,i} - F_{pred,i}|$，可作为模型对数据拟合优度的度量。\n\n解决该问题的算法如下：\n$1$. 对于每个包含测量均值计数 $(\\mu_{c,i})$ 和方差 $(Var_{c,i})$ 的数据集，构建一个线性系统 $A \\mathbf{x} \\approx \\mathbf{b}$，其中 $\\mathbf{x} = [k, \\sigma_r^2]^T$，设计矩阵 $A$ 的列为 $[\\mu_{c,i}]$ 和一个全为1的列，$\\mathbf{b}$ 是向量 $[Var_{c,i}]$。\n$2$. 使用非负最小二乘算法求解 $\\mathbf{x}$，以找到估计的增益 $k$ 和读出噪声方差 $\\sigma_r^2$，并遵守物理约束 $k \\ge 0$ 和 $\\sigma_r^2 \\ge 0$。\n$3$. 计算读出噪声标准差 $\\sigma_r = \\sqrt{\\sigma_r^2}$。\n$4$. 对每个数据点 $i$，计算测量的法诺因子 $F_{meas,i} = Var_{c,i} / \\mu_{c,i}$ 和预测的法诺因子 $F_{pred,i} = k + \\sigma_r^2 / \\mu_{c,i}$。\n$5$. 找到最大绝对偏差 $d = \\max_i |F_{meas,i} - F_{pred,i}|$。\n$6$. 为每个数据集报告三元组 $[k, \\sigma_r, d]$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import lsq_linear\n\ndef solve():\n    \"\"\"\n    Derives sensor parameters from noise measurements and validates the model.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (\n            np.array([10., 30., 60., 120., 240., 480.]),\n            np.array([19.25, 45.25, 84.25, 162.25, 318.25, 630.25])\n        ),\n        (\n            np.array([2., 4., 8., 16., 32., 64.]),\n            np.array([17.8, 19.6, 23.2, 30.4, 44.8, 73.6])\n        ),\n        (\n            np.array([1000., 2000., 4000., 8000.]),\n            np.array([1802.25, 3602.25, 7202.25, 14402.25])\n        )\n    ]\n\n    results = []\n    for mean_counts, var_counts in test_cases:\n        # The derived model is Var = k * mu + sigma_r^2.\n        # This is a linear model y = m*x + c, where:\n        # y = Var (variance of counts)\n        # x = mu (mean counts)\n        # m = k (effective gain, counts/electron)\n        # c = sigma_r^2 (read noise variance, counts^2)\n\n        # Set up the linear least-squares problem Ax = b.\n        # The design matrix A has the mean counts as the first column\n        # and a column of ones for the intercept term.\n        A = np.vstack([mean_counts, np.ones(len(mean_counts))]).T\n        b = var_counts\n\n        # We need to solve for x = [k, sigma_r^2] subject to non-negativity.\n        # We use scipy.optimize.lsq_linear for this constrained regression.\n        # The bounds are [0, inf] for both parameters.\n        bounds = ([0, 0], [np.inf, np.inf])\n        res = lsq_linear(A, b, bounds=bounds)\n        \n        # Extract the estimated parameters\n        k_est, sigma_r_sq_est = res.x\n        \n        # Calculate the read noise standard deviation\n        sigma_r_est = np.sqrt(sigma_r_sq_est)\n\n        # Compute the Fano factors and the maximum deviation\n        # Measured Fano factor: F_meas = Var_i / mu_i\n        fano_meas = var_counts / mean_counts\n        \n        # Predicted Fano factor from the model: F_pred = k + sigma_r^2 / mu_i\n        fano_pred = k_est + sigma_r_sq_est / mean_counts\n        \n        # Maximum absolute deviation between measured and predicted Fano factors\n        max_fano_dev = np.max(np.abs(fano_meas - fano_pred))\n\n        # Store the results for this dataset\n        results.append([k_est, sigma_r_est, max_fano_dev])\n\n    # Final print statement in the exact required format.\n    # The output format is a list of lists: [[k1, sr1, d1], [k2, sr2, d2], ...]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "钙成像的最终目的通常是估计细胞内钙离子浓度，这需要将测得的荧光强度 $F$ 转换为浓度值 $[\\mathrm{Ca}]$。这种转换依赖于一个生物物理模型，通常是希尔方程（Hill equation），它描述了钙离子浓度与指示剂结合分数之间的非线性关系。这项练习  将指导你推导该转换公式并分析其灵敏度，理解测量噪声如何通过这种非线性变换进行传播将揭示为何钙指示剂仅在特定的动态范围内最可靠，而在极低（基线）或极高（饱和）的钙水平下会失去其定量能力。",
            "id": "4188020",
            "problem": "一种比例式钙离子指示剂根据与游离钙结合的指示剂分子比例来报告荧光强度。假设在一个充分混合的区域内，基于质量作用结合和希尔（Hill）协同性描述，存在以下物理模型：结合指示剂的比例由下式给出：$$\\theta = \\frac{([\\mathrm{Ca}]/K_{d})^{n}}{1 + ([\\mathrm{Ca}]/K_{d})^{n}},$$ 其中 $[\\mathrm{Ca}]$ 是游离钙离子浓度，$K_{d}$ 是解离常数，$n$ 是希尔系数。测得的荧光是未结合态和结合态的线性混合，$$F = F_{\\min} + (F_{\\max} - F_{\\min})\\,\\theta,$$ 其中 $F_{\\min}$ 和 $F_{\\max}$ 分别是基线荧光和饱和荧光。假设 $F_{\\min} = 120$ 任意单位，$F_{\\max} = 1020$ 任意单位，$K_{d} = 300$ 纳摩尔，$n = 2$。假设荧光测量上存在加性、零均值的高斯噪声，其标准差为 $ \\sigma_{F} = 15$ 任意单位。获得了三个荧光测量值：$F_{1} = 165$ 任意单位，$F_{2} = 570$ 任意单位，以及 $F_{3} = 975$ 任意单位。\n\n仅以上述定义为出发点：\n\n1. 推导 $[\\mathrm{Ca}]$ 作为 $F$, $F_{\\min}$, $F_{\\max}$, $K_{d}$ 和 $n$ 的函数的封闭形式表达式。\n2. 使用推导出的表达式，计算对应于 $F_{1}$、$F_{2}$ 和 $F_{3}$ 的 $[\\mathrm{Ca}]$，并以纳摩尔为单位表示。\n3. 使用一阶误差传播，推导推断的 $[\\mathrm{Ca}]$ 的局部相对标准差，用 $F$, $F_{\\min}$, $F_{\\max}$, $n$ 和 $\\sigma_{F}$ 表示，并根据此表达式解释在基线和饱和附近的可识别性。\n4. 最后，计算在 $F_{1}$ 或 $F_{3}$（取较差者）处推断的 $[\\mathrm{Ca}]$ 的相对标准差与在 $F_{2}$ 处的值之比。将该比值表示为无量纲小数，并四舍五入到四位有效数字。",
            "solution": "问题陈述基于钙成像分析中使用的标准生物物理模型，提供了一组有效且适定的问题。所有必要的常数和数据均已给出，没有科学或逻辑上的不一致之处。因此，我将进行完整解答。\n\n问题分为四个部分。我将依次解答每一部分。\n\n第一部分：推导 $[\\mathrm{Ca}]$ 作为荧光 $F$ 的函数。\n\n我们已知两个基本方程：\n1. 指示剂结合比例 $\\theta$ 的希尔方程：\n$$ \\theta = \\frac{([\\mathrm{Ca}]/K_{d})^{n}}{1 + ([\\mathrm{Ca}]/K_{d})^{n}} $$\n2. 荧光 $F$ 的线性模型：\n$$ F = F_{\\min} + (F_{\\max} - F_{\\min})\\,\\theta $$\n\n我们的目标是推导钙离子浓度 $[\\mathrm{Ca}]$ 的封闭形式表达式，用 $F$ 和已知参数 $F_{\\min}$、$F_{\\max}$、$K_{d}$ 和 $n$ 表示。\n\n首先，我们对荧光方程求解 $\\theta$。\n$$ F - F_{\\min} = (F_{\\max} - F_{\\min})\\,\\theta $$\n$$ \\theta = \\frac{F - F_{\\min}}{F_{\\max} - F_{\\min}} $$\n该表达式代表归一化荧光，等同于指示剂的结合比例。\n\n接下来，我们将这个 $\\theta$ 的表达式与希尔方程相等：\n$$ \\frac{F - F_{\\min}}{F_{\\max} - F_{\\min}} = \\frac{([\\mathrm{Ca}]/K_{d})^{n}}{1 + ([\\mathrm{Ca}]/K_{d})^{n}} $$\n为简化代数运算，我们定义一个变量 $X = ([\\mathrm{Ca}]/K_{d})^{n}$。方程变为：\n$$ \\frac{F - F_{\\min}}{F_{\\max} - F_{\\min}} = \\frac{X}{1 + X} $$\n现在，我们求解 $X$：\n$$ (F - F_{\\min})(1 + X) = (F_{\\max} - F_{\\min})X $$\n$$ F - F_{\\min} + (F - F_{\\min})X = (F_{\\max} - F_{\\min})X $$\n$$ F - F_{\\min} = [(F_{\\max} - F_{\\min}) - (F - F_{\\min})]X $$\n$$ F - F_{\\min} = (F_{\\max} - F)X $$\n$$ X = \\frac{F - F_{\\min}}{F_{\\max} - F} $$\n现在，我们代回 $X = ([\\mathrm{Ca}]/K_{d})^{n}$：\n$$ \\left(\\frac{[\\mathrm{Ca}]}{K_{d}}\\right)^{n} = \\frac{F - F_{\\min}}{F_{\\max} - F} $$\n为了分离出 $[\\mathrm{Ca}]$，我们对两边取 $n$ 次方根，然后乘以 $K_{d}$：\n$$ \\frac{[\\mathrm{Ca}]}{K_{d}} = \\left(\\frac{F - F_{\\min}}{F_{\\max} - F}\\right)^{1/n} $$\n$$ [\\mathrm{Ca}] = K_{d} \\left(\\frac{F - F_{\\min}}{F_{\\max} - F}\\right)^{1/n} $$\n这就是所要求的 $[\\mathrm{Ca}]$ 的封闭形式表达式。\n\n第二部分：根据给定的荧光值计算 $[\\mathrm{Ca}]$。\n\n我们使用推导出的表达式和给定的常数：$F_{\\min} = 120$，$F_{\\max} = 1020$，$K_{d} = 300$ 纳摩尔（nM），以及 $n = 2$。\n\n对于 $F_{1} = 165$：\n$$ [\\mathrm{Ca}]_{1} = 300 \\left(\\frac{165 - 120}{1020 - 165}\\right)^{1/2} = 300 \\left(\\frac{45}{855}\\right)^{1/2} = 300 \\left(\\frac{1}{19}\\right)^{1/2} = \\frac{300}{\\sqrt{19}} \\, \\mathrm{nM} \\approx 68.82 \\, \\mathrm{nM} $$\n\n对于 $F_{2} = 570$：\n$$ [\\mathrm{Ca}]_{2} = 300 \\left(\\frac{570 - 120}{1020 - 570}\\right)^{1/2} = 300 \\left(\\frac{450}{450}\\right)^{1/2} = 300 \\left(1\\right)^{1/2} = 300 \\, \\mathrm{nM} $$\n这个结果是预料之中的，因为 $F_2 = 570$ 是荧光范围的中点，对应于 $\\theta = 0.5$，根据希尔方程的定义，这发生在 $[\\mathrm{Ca}] = K_{d}$ 时。\n\n对于 $F_{3} = 975$：\n$$ [\\mathrm{Ca}]_{3} = 300 \\left(\\frac{975 - 120}{1020 - 975}\\right)^{1/2} = 300 \\left(\\frac{855}{45}\\right)^{1/2} = 300 \\left(19\\right)^{1/2} = 300\\sqrt{19} \\, \\mathrm{nM} \\approx 1307.67 \\, \\mathrm{nM} $$\n\n第三部分：相对标准差的推导与解释。\n\n我们使用一阶误差传播公式。对于函数 $y = f(x)$，不确定度 $\\sigma_y$ 与不确定度 $\\sigma_x$ 的关系为 $\\sigma_y \\approx |\\frac{dy}{dx}|\\sigma_x$。\n这里，我们的函数是 $[\\mathrm{Ca}](F)$，测量不确定度是 $\\sigma_F$。推断的钙离子浓度的标准差 $\\sigma_{[\\mathrm{Ca}]}$ 为：\n$$ \\sigma_{[\\mathrm{Ca}]} \\approx \\left| \\frac{d[\\mathrm{Ca}]}{dF} \\right| \\sigma_{F} $$\n相对标准差为 $\\frac{\\sigma_{[\\mathrm{Ca}]}}{[\\mathrm{Ca}]}$。\n$$ \\frac{\\sigma_{[\\mathrm{Ca}]}}{[\\mathrm{Ca}]} \\approx \\frac{1}{[\\mathrm{Ca}]} \\left| \\frac{d[\\mathrm{Ca}]}{dF} \\right| \\sigma_{F} $$\n让我们使用第一部分的表达式计算导数 $\\frac{d[\\mathrm{Ca}]}{dF}$。为简化起见，令 $C = [\\mathrm{Ca}]$ 并使用链式法则。\n$$ C = K_{d} \\left(\\frac{F - F_{\\min}}{F_{\\max} - F}\\right)^{1/n} \\implies \\ln(C) = \\ln(K_{d}) + \\frac{1}{n}\\left[ \\ln(F - F_{\\min}) - \\ln(F_{\\max} - F) \\right] $$\n对 $F$ 求导：\n$$ \\frac{1}{C}\\frac{dC}{dF} = \\frac{1}{n} \\left[ \\frac{1}{F - F_{\\min}} - \\frac{-1}{F_{\\max} - F} \\right] = \\frac{1}{n} \\left[ \\frac{1}{F - F_{\\min}} + \\frac{1}{F_{\\max} - F} \\right] $$\n$$ \\frac{1}{C}\\frac{dC}{dF} = \\frac{1}{n} \\frac{(F_{\\max} - F) + (F - F_{\\min})}{(F - F_{\\min})(F_{\\max} - F)} = \\frac{1}{n} \\frac{F_{\\max} - F_{\\min}}{(F - F_{\\min})(F_{\\max} - F)} $$\n由于当 $F_{\\min}  F  F_{\\max}$ 时，$\\frac{1}{[\\mathrm{Ca}]} \\frac{d[\\mathrm{Ca}]}{dF}$ 为正，我们可以去掉绝对值符号。\n$$ \\frac{\\sigma_{[\\mathrm{Ca}]}}{[\\mathrm{Ca}]} \\approx \\left( \\frac{1}{[\\mathrm{Ca}]} \\frac{d[\\mathrm{Ca}]}{dF} \\right) \\sigma_F = \\frac{1}{n} \\frac{F_{\\max} - F_{\\min}}{(F - F_{\\min})(F_{\\max} - F)} \\sigma_{F} $$\n这就是推导出的 $[\\mathrm{Ca}]$ 的局部相对标准差的表达式。\n\n解释：相对标准差，即钙离子估计的相对误差，与乘积 $(F - F_{\\min})(F_{\\max} - F)$ 成反比。该乘积项在边界 $F=F_{\\min}$ 和 $F=F_{\\max}$ 处为零，在范围中心 $F = (F_{\\min}+F_{\\max})/2$ 处为最大值。因此，当测量的荧光 $F$ 接近基线 ($F_{\\min}$) 或饱和 ($F_{\\max}$) 时，分母趋近于零，相对误差 $\\frac{\\sigma_{[\\mathrm{Ca}]}}{[\\mathrm{Ca}]}$ 发散至无穷大。这标志着可识别性的灾难性丧失。在基线和饱和附近，$[\\mathrm{Ca}]$ 和 $F$ 之间的关系非常平坦，这意味着钙离子浓度的巨大变化仅产生微小、被噪声掩盖的荧光变化。因此，指示剂在这些区域不敏感，测量值对于量化 $[\\mathrm{Ca}]$ 是不可靠的。\n\n第四部分：计算相对标准差的比值。\n\n令 $RSD(F)$ 表示在荧光 $F$ 处的相对标准差。\n$$ RSD(F) = \\frac{\\sigma_F}{n} \\frac{F_{\\max} - F_{\\min}}{(F - F_{\\min})(F_{\\max} - F)} $$\n我们需要比较 $RSD(F_1)$、$RSD(F_2)$ 和 $RSD(F_3)$。术语“较差”意味着更大的相对标准差。\n让我们为每个测量点计算分母项 $(F - F_{\\min})(F_{\\max} - F)$。$F_{\\min}=120$, $F_{\\max}=1020$。\n\n对于 $F_{1} = 165$：\n$$ (165 - 120)(1020 - 165) = (45)(855) = 38475 $$\n\n对于 $F_{2} = 570$：\n$$ (570 - 120)(1020 - 570) = (450)(450) = 202500 $$\n\n对于 $F_{3} = 975$：\n$$ (975 - 120)(1020 - 975) = (855)(45) = 38475 $$\n\n由于 $RSD$ 表达式的分子相同，最大的 $RSD$ 将对应最小的分母。此处，$RSD(F_1) = RSD(F_3)$，且两者均大于 $RSD(F_2)$。因此，“较差”的情况对应于 $F_1$ 或 $F_3$。\n\n我们需要计算较差的 $RSD$ 与在 $F_2$ 处的 $RSD$ 之比。\n$$ \\frac{RSD(F_1)}{RSD(F_2)} = \\frac{\\frac{\\sigma_F}{n} \\frac{F_{\\max} - F_{\\min}}{(F_1 - F_{\\min})(F_{\\max} - F_1)}}{\\frac{\\sigma_F}{n} \\frac{F_{\\max} - F_{\\min}}{(F_2 - F_{\\min})(F_{\\max} - F_2)}} = \\frac{(F_2 - F_{\\min})(F_{\\max} - F_2)}{(F_1 - F_{\\min})(F_{\\max} - F_1)} $$\n代入计算出的分母值：\n$$ \\mathrm{Ratio} = \\frac{202500}{38475} $$\n为简化分数：\n$$ \\mathrm{Ratio} = \\frac{202500 \\div 25}{38475 \\div 25} = \\frac{8100}{1539} $$\n$$ \\mathrm{Ratio} = \\frac{8100 \\div 9}{1539 \\div 9} = \\frac{900}{171} $$\n$$ \\mathrm{Ratio} = \\frac{900 \\div 9}{171 \\div 9} = \\frac{100}{19} $$\n作为小数，该比值为 $100 \\div 19 \\approx 5.263157...$。\n四舍五入到四位有效数字，该比值为 $5.263$。",
            "answer": "$$\\boxed{5.263}$$"
        },
        {
            "introduction": "现代神经科学实验经常同时使用多种荧光报告分子来监测不同的细胞群体或过程，当它们的发射光谱重叠时，挑战就出现了，这会导致信号混合。假设这是一个线性混合过程，我们可以使用来自纯样本的校准数据来构建一个“混合矩阵”，而“解混”的过程就变成了一个求解线性方程组的问题。这项练习  提供了光谱解混的实践经验，你将实现最优线性估计器来分离混合信号，并学习如何量化估计浓度的不确定性，这是解读来自复杂、多重实验数据的关键技能。",
            "id": "4188056",
            "problem": "您正在分析两种发射光谱重叠的基因编码钙指示剂，其信号由两个检测通道记录。在没有探测器饱和的低至中等光子通量下，测得的荧光可以很好地近似为指示剂贡献的线性叠加外加加性噪声。校准使用纯样本：一个只含指示剂$1$，另一个只含指示剂$2$，每个样本的已知相对浓度均为$1$（任意单位）。每次校准测量提供一个二维响应向量，单位为任意荧光单位（a.u.），每个检测通道一个值。一个单独的混合样本为相同的通道提供了一个二维测量值（a.u.）。通道噪声被建模为零均值高斯分布，每个通道的标准差（a.u.）已知，并且通道噪声协方差矩阵是对角矩阵。\n\n从检测的线性度和叠加原理出发，并使用各通道间高斯噪声独立的假设，推导出统计上最优的线性解混矩阵，该矩阵将测量的通道强度映射到估计的指示剂浓度。将此矩阵应用于混合样本，以估计两种指示剂的浓度。通过计算解混与校准估计的混合组成的有效系统的非对角元素，来量化解混后的残余串扰。通过解混过程传播测量噪声，以计算每个估计浓度的标准差（不确定性）。所有浓度和不确定性都必须以相同的任意浓度单位（a.u.）报告。串扰值必须以小数（分数）报告，不带百分号。\n\n您的程序必须为以下三个案例的测试套件实现这一端到端的过程。对于每个案例，您会得到两个校准向量（仅指示剂$1$和仅指示剂$2$）、混合样本测量向量以及两个通道的噪声标准差。所有值均以任意单位（a.u.）给出。校准向量定义了混合矩阵的列。对于每个案例，按以下顺序输出六个浮点数：指示剂$1$的估计浓度、指示剂$2$的估计浓度、从指示剂$2$到指示剂$1$估计值的残余串扰、从指示剂$1$到指示剂$2$估计值的残余串扰、指示剂$1$估计值的标准差、指示剂$2$估计值的标准差。\n\n测试套件：\n- 案例$1$（良态重叠）：\n  - 校准（仅指示剂$1$）：通道$1$ $1200$，通道$2$ $300$。\n  - 校准（仅指示剂$2$）：通道$1$ $400$，通道$2$ $1000$。\n  - 混合样本：通道$1$ $1500$，通道$2$ $1100$。\n  - 通道噪声标准差：通道$1$ $\\;20$，通道$2$ $\\;25$。\n- 案例$2$（更强的重叠，较差的条件）：\n  - 校准（仅指示剂$1$）：通道$1$ $1000$，通道$2$ $800$。\n  - 校准（仅指示剂$2$）：通道$1$ $900$，通道$2$ $1100$。\n  - 混合样本：通道$1$ $1600$，通道$2$ $1700$。\n  - 通道噪声标准差：通道$1$ $\\;50$，通道$2$ $\\;50$。\n- 案例$3$（混合物以指示剂$1$为主）：\n  - 校准（仅指示剂$1$）：通道$1$ $800$，通道$2$ $200$。\n  - 校准（仅指示剂$2$）：通道$1$ $300$，通道$2$ $900$。\n  - 混合样本：通道$1$ $820$，通道$2$ $210$。\n  - 通道噪声标准差：通道$1$ $\\;30$，通道$2$ $\\;30$。\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表，结果按案例顺序展平排列。例如，输出必须具有$[r_1,r_2,\\dots,r_{18}]$的形式，其中包含$18$个浮点数，对应于每个案例的六个输出，按三个案例的顺序连接而成。除无单位的小数串扰量外，所有输出均以任意单位（a.u.）表示。",
            "solution": "用户希望解决一个荧光信号的线性解混问题。\n\n### 第1步：提取已知条件\n- **模型**：测量的荧光$\\mathbf{m}$是指示剂贡献$\\mathbf{c}$的线性叠加与加性噪声$\\mathbf{n}$的和，由$\\mathbf{m} = A\\mathbf{c} + \\mathbf{n}$给出。\n- **系统**：两种指示剂，两个检测通道。\n- **校准**：指示剂$1$和指示剂$2$在已知相对浓度为$1$时的纯样本产生二维响应向量$\\mathbf{s}_1$和$\\mathbf{s}_2$。这些向量构成了混合矩阵$A$的列，因此$A = [\\mathbf{s}_1 | \\mathbf{s}_2]$。\n- **噪声模型**：通道噪声是零均值高斯分布。噪声向量$\\mathbf{n}$具有一个对角协方差矩阵$\\Sigma_n = \\text{diag}(\\sigma_1^2, \\sigma_2^2)$，其中$\\sigma_1$和$\\sigma_2$是已知的通道噪声标准差。\n- **任务**：\n  1. 推导统计上最优的线性解混矩阵$W$。\n  2. 将$W$应用于混合样本测量值$\\mathbf{m}$以估计浓度$\\hat{\\mathbf{c}} = [\\hat{c}_1, \\hat{c}_2]^T$。\n  3. 计算残余串扰，定义为有效系统矩阵$WA$的非对角元素。\n  4. 计算每个估计浓度的标准差（不确定性）。\n- **测试案例**：\n  - **案例1**：\n    - $\\mathbf{s}_1 = [1200, 300]^T$\n    - $\\mathbf{s}_2 = [400, 1000]^T$\n    - $\\mathbf{m} = [1500, 1100]^T$\n    - $[\\sigma_1, \\sigma_2] = [20, 25]$\n  - **案例2**：\n    - $\\mathbf{s}_1 = [1000, 800]^T$\n    - $\\mathbf{s}_2 = [900, 1100]^T$\n    - $\\mathbf{m} = [1600, 1700]^T$\n    - $[\\sigma_1, \\sigma_2] = [50, 50]$\n  - **案例3**：\n    - $\\mathbf{s}_1 = [800, 200]^T$\n    - $\\mathbf{s}_2 = [300, 900]^T$\n    - $\\mathbf{m} = [820, 210]^T$\n    - $[\\sigma_1, \\sigma_2] = [30, 30]$\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据**：该问题描述了带加性高斯噪声的信号线性解混。这是包括荧光显微镜和光谱成像在内的许多领域中的一个标准且物理上现实的模型。对此类问题使用广义最小二乘法是统计估计理论的基石。该问题牢固地植根于线性代数和统计学。\n- **适定性**：该问题要求推导并应用标准的统计估计程序。为每个案例提供了所有必要的数据（校准向量、混合样本数据、噪声特性）。任务定义明确，只要混合矩阵是可逆的（对于给定的数据是可逆的），每个案例都应有唯一的稳定解。\n- **客观性**：该问题以精确的数学和科学语言陈述。没有主观或含糊的术语。\n\n该问题是自洽、一致且科学合理的。未发现任何缺陷。\n\n### 第3步：结论与行动\n该问题是**有效的**。将提供一个完整、合理的解决方案。\n\n### 基于原理的解决方案\n\n从光谱重叠的荧光信号中估计指示剂浓度是一个经典的线性解混问题。我们首先形式化物理模型，然后基于统计原理推导出最优估计程序。\n\n#### 1. 系统建模\n令$\\mathbf{c} = \\begin{pmatrix} c_1 \\\\ c_2 \\end{pmatrix}$为两种指示剂的未知浓度向量。令$\\mathbf{m} = \\begin{pmatrix} m_1 \\\\ m_2 \\end{pmatrix}$为两个检测通道中测得的荧光强度向量。根据线性叠加原理，浓度与理想无噪声测量值之间的关系由一个线性变换给出：\n$$ \\mathbf{m}_{\\text{ideal}} = A \\mathbf{c} $$\n其中$A$是一个$2 \\times 2$的混合矩阵。$A$的列是每种指示剂在单位浓度下的光谱响应向量。问题将这些作为校准向量$\\mathbf{s}_1$和$\\mathbf{s}_2$提供。因此，\n$$ A = \\begin{pmatrix} |  | \\\\ \\mathbf{s}_1  \\mathbf{s}_2 \\\\ |  | \\end{pmatrix} $$\n真实的测量值受到加性高斯噪声$\\mathbf{n}$的干扰，因此完整模型为：\n$$ \\mathbf{m} = A \\mathbf{c} + \\mathbf{n} $$\n假设噪声向量$\\mathbf{n}$的均值为零，即$\\mathbb{E}[\\mathbf{n}] = \\mathbf{0}$，且由于通道噪声是独立的，其协方差矩阵$\\Sigma_n$是对角的：\n$$ \\Sigma_n = \\mathbb{E}[\\mathbf{n} \\mathbf{n}^T] = \\begin{pmatrix} \\sigma_1^2  0 \\\\ 0  \\sigma_2^2 \\end{pmatrix} $$\n其中$\\sigma_1$和$\\sigma_2$是每个通道中给定的噪声标准差。\n\n#### 2. 最优线性解混与浓度估计\n我们寻求真实浓度$\\mathbf{c}$的一个估计$\\hat{\\mathbf{c}}$，该估计是测量值$\\mathbf{m}$的线性函数，即$\\hat{\\mathbf{c}} = W \\mathbf{m}$，其中$W$是某个解混矩阵。问题要求的是“统计上最优”的此类矩阵。对于具有高斯噪声的线性模型，最大似然估计（MLE）是最佳选择。它通过最小化加权残差平方和来找到，其中权重是噪声协方差的逆。这等同于解决广义最小二乘（GLS）问题：\n$$ \\min_{\\mathbf{c}} (\\mathbf{m} - A\\mathbf{c})^T \\Sigma_n^{-1} (\\mathbf{m} - A\\mathbf{c}) $$\n该最小化问题的解给出了估计的浓度向量$\\hat{\\mathbf{c}}$：\n$$ \\hat{\\mathbf{c}} = (A^T \\Sigma_n^{-1} A)^{-1} A^T \\Sigma_n^{-1} \\mathbf{m} $$\n由此，我们确定统计上最优的线性解混矩阵$W$为：\n$$ W = (A^T \\Sigma_n^{-1} A)^{-1} A^T \\Sigma_n^{-1} $$\n这个估计器，被称为最佳线性无偏估计器（BLUE），在所有线性无偏估计器中提供最精确的估计。\n\n#### 3. 残余串扰\n问题通过“有效系统”矩阵来定义残余串扰，该矩阵由解混操作（$W$）与混合操作（$A$）复合而成。这个矩阵，$M_{eff} = WA$，描述了在没有噪声的情况下，从真实浓度$\\mathbf{c}$到估计浓度$\\hat{\\mathbf{c}}$的变换：\n$$ \\hat{\\mathbf{c}}_{\\text{noiseless}} = W (A \\mathbf{c}) = (WA) \\mathbf{c} = M_{eff} \\mathbf{c} $$\n$M_{eff}$的非对角元素量化了一种指示剂的真实浓度“泄漏”到另一种指示剂估计值中的程度。让我们为最优解混矩阵$W$计算$M_{eff}$：\n$$ M_{eff} = WA = \\left( (A^T \\Sigma_n^{-1} A)^{-1} A^T \\Sigma_n^{-1} \\right) A = (A^T \\Sigma_n^{-1} A)^{-1} (A^T \\Sigma_n^{-1} A) $$\n$$ M_{eff} = I = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} $$\n其中$I$是$2 \\times 2$的单位矩阵。这个结果证明了GLS估计器的一个基本特性：它是无偏的。根据定义，一个无偏估计器平均能正确恢复真实参数，这意味着从真实参数到估计参数的系统性映射是单位变换。因此，有效系统矩阵的非对角元素恒为零。从指示剂$2$到指示剂$1$估计值的残余串扰（$(WA)_{12}$）和从指示剂$1$到指示剂$2$估计值的残余串扰（$(WA)_{21}$）都为$0$。\n\n#### 4. 不确定性传播\n虽然估计器没有系统性串扰，但由于随机噪声$\\mathbf{n}$的存在，估计值仍然具有不确定性。$\\hat{\\mathbf{c}}$的不确定性由其协方差矩阵$\\Sigma_{\\hat{\\mathbf{c}}}$来表征。我们可以通过将噪声从$\\mathbf{m}$传播到$\\hat{\\mathbf{c}}$来推导它：\n$$ \\hat{\\mathbf{c}} = W \\mathbf{m} = W(A\\mathbf{c} + \\mathbf{n}) = WA\\mathbf{c} + W\\mathbf{n} = \\mathbf{c} + W\\mathbf{n} $$\n估计误差为$\\hat{\\mathbf{c}} - \\mathbf{c} = W\\mathbf{n}$。估计的协方差矩阵则为：\n$$ \\Sigma_{\\hat{\\mathbf{c}}} = \\mathbb{E}[(\\hat{\\mathbf{c}} - \\mathbf{c})(\\hat{\\mathbf{c}} - \\mathbf{c})^T] = \\mathbb{E}[(W\\mathbf{n})(W\\mathbf{n})^T] = W \\mathbb{E}[\\mathbf{n}\\mathbf{n}^T] W^T = W \\Sigma_n W^T $$\n代入$W$的表达式：\n$$ \\Sigma_{\\hat{\\mathbf{c}}} = \\left( (A^T \\Sigma_n^{-1} A)^{-1} A^T \\Sigma_n^{-1} \\right) \\Sigma_n \\left( (A^T \\Sigma_n^{-1} A)^{-1} A^T \\Sigma_n^{-1} \\right)^T $$\n使用恒等式$(XY)^T = Y^T X^T$并注意到$\\Sigma_n$和$A^T \\Sigma_n^{-1} A$是对称的：\n$$ \\Sigma_{\\hat{\\mathbf{c}}} = (A^T \\Sigma_n^{-1} A)^{-1} (A^T \\Sigma_n^{-1}) \\Sigma_n (\\Sigma_n^{-1} A) (A^T \\Sigma_n^{-1} A)^{-1} $$\n由于$\\Sigma_n^{-1} \\Sigma_n = I$，这可以漂亮地简化：\n$$ \\Sigma_{\\hat{\\mathbf{c}}} = (A^T \\Sigma_n^{-1} A)^{-1} (A^T A) (A^T \\Sigma_n^{-1} A)^{-1} $$\n等等，代数可以更简单：\n$$ \\Sigma_{\\hat{\\mathbf{c}}} = (A^T \\Sigma_n^{-1} A)^{-1} (A^T \\Sigma_n^{-1}) \\Sigma_n ( \\Sigma_n^{-1} A ((A^T \\Sigma_n^{-1} A)^T)^{-1}) $$\n令$F = A^T \\Sigma_n^{-1} A$。则$W = F^{-1}A^T\\Sigma_n^{-1}$。\n$$ \\Sigma_{\\hat{\\mathbf{c}}} = W \\Sigma_n W^T = (F^{-1}A^T\\Sigma_n^{-1}) \\Sigma_n (\\Sigma_n^{-1} A F^{-1}) = F^{-1}A^T (\\Sigma_n^{-1}\\Sigma_n) \\Sigma_n^{-1} A F^{-1} = F^{-1} (A^T \\Sigma_n^{-1} A) F^{-1} = F^{-1} F F^{-1} = F^{-1} $$\n因此，估计浓度的协方差矩阵就是矩阵$A^T \\Sigma_n^{-1} A$的逆：\n$$ \\Sigma_{\\hat{\\mathbf{c}}} = (A^T \\Sigma_n^{-1} A)^{-1} $$\n每种浓度估计值的标准差（不确定性）$\\sigma_{\\hat{c}_i}$是该协方差矩阵相应对角元素的平方根：\n$$ \\sigma_{\\hat{c}_1} = \\sqrt{(\\Sigma_{\\hat{\\mathbf{c}}})_{11}} \\quad \\text{和} \\quad \\sigma_{\\hat{c}_2} = \\sqrt{(\\Sigma_{\\hat{\\mathbf{c}}})_{22}} $$\n\n将为每个测试案例实施以下算法：\n1.  根据输入数据构建矩阵$A$和向量$\\mathbf{m}$。\n2.  构建对角矩阵$\\Sigma_n^{-1}$，其对角线元素为$1/\\sigma_1^2$和$1/\\sigma_2^2$。\n3.  计算矩阵$F = A^T \\Sigma_n^{-1} A$。\n4.  计算协方差矩阵$\\Sigma_{\\hat{\\mathbf{c}}} = F^{-1}$。\n5.  计算估计的浓度向量$\\hat{\\mathbf{c}} = \\Sigma_{\\hat{\\mathbf{c}}} (A^T \\Sigma_n^{-1}) \\mathbf{m}$。\n6.  残余串扰值为$0.0$和$0.0$。\n7.  不确定性为$\\sigma_{\\hat{c}_1} = \\sqrt{(\\Sigma_{\\hat{\\mathbf{c}}})_{0,0}}$和$\\sigma_{\\hat{c}_2} = \\sqrt{(\\Sigma_{\\hat{\\mathbf{c}}})_{1,1}}$。\n8.  返回$\\hat{c}_1, \\hat{c}_2, 0.0, 0.0, \\sigma_{\\hat{c}_1}, \\sigma_{\\hat{c}_2}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the linear unmixing problem for three test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (s1, s2, m, noise_std)\n    # s1: calibration vector for indicator 1\n    # s2: calibration vector for indicator 2\n    # m: mixed sample measurement vector\n    # noise_std: channel noise standard deviations\n    test_cases = [\n        (\n            np.array([1200.0, 300.0]),\n            np.array([400.0, 1000.0]),\n            np.array([1500.0, 1100.0]),\n            np.array([20.0, 25.0])\n        ),\n        (\n            np.array([1000.0, 800.0]),\n            np.array([900.0, 1100.0]),\n            np.array([1600.0, 1700.0]),\n            np.array([50.0, 50.0])\n        ),\n        (\n            np.array([800.0, 200.0]),\n            np.array([300.0, 900.0]),\n            np.array([820.0, 210.0]),\n            np.array([30.0, 30.0])\n        )\n    ]\n\n    results = []\n    \n    for s1, s2, m, noise_std in test_cases:\n        # Step 1: Construct the mixing matrix A and noise covariance matrix\n        # The mixing matrix A has the calibration vectors as its columns.\n        A = np.vstack((s1, s2)).T\n        \n        # The noise covariance matrix Sigma_n is diagonal with variances on the diagonal.\n        # Its inverse, Sigma_n_inv, is also diagonal with inverse variances.\n        noise_var = noise_std**2\n        Sigma_n_inv = np.diag(1.0 / noise_var)\n\n        # Step 2: Calculate the intermediate matrix F = A^T * Sigma_n_inv * A\n        # This is the Fisher Information Matrix for this model.\n        F = A.T @ Sigma_n_inv @ A\n\n        # Step 3: Calculate the covariance matrix of the estimated concentrations\n        # This is the inverse of F.\n        # Sigma_c_hat = inv(F)\n        Sigma_c_hat = np.linalg.inv(F)\n\n        # Step 4: Calculate the optimal unmixing matrix W\n        # W = (A^T * Sigma_n_inv * A)^-1 * A^T * Sigma_n_inv = Sigma_c_hat * A^T * Sigma_n_inv\n        W = Sigma_c_hat @ A.T @ Sigma_n_inv\n\n        # Step 5: Estimate the concentrations\n        # c_hat = W * m\n        c_hat = W @ m\n        c1_est, c2_est = c_hat\n\n        # Step 6: Compute residual cross-talk\n        # As derived in the solution, the effective system matrix WA = I.\n        # Thus, the off-diagonal elements (cross-talk) are identically zero.\n        crosstalk_21 = 0.0\n        crosstalk_12 = 0.0\n\n        # Step 7: Compute the standard deviations of the estimated concentrations\n        # These are the square roots of the diagonal elements of Sigma_c_hat.\n        std_c1 = np.sqrt(Sigma_c_hat[0, 0])\n        std_c2 = np.sqrt(Sigma_c_hat[1, 1])\n\n        # Append the six required values to the results list\n        results.extend([c1_est, c2_est, crosstalk_21, crosstalk_12, std_c1, std_c2])\n\n    # Final print statement in the exact required format.\n    # The format is a single line, comma-separated list of floats enclosed in brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}