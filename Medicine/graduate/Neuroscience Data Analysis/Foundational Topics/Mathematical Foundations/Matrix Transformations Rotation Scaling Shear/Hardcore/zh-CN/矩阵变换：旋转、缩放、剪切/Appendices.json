{
    "hands_on_practices": [
        {
            "introduction": "在神经科学数据分析中，对齐不同时间点或不同被试的大脑图像或功能图谱是一项基本任务。仿射变换是实现这一目标的核心工具。本练习将通过一个二维视网膜拓扑图谱配准的简化场景，帮助你从基本原理出发，深入理解刚性变换的本质——即变换如何保持几何形状和大小不变。你将动手计算一个仿射变换 ，并推导出一个严格的数学判据来判定其线性部分是否为刚性变换，从而将几何直觉与严谨的矩阵代数联系起来。",
            "id": "4177142",
            "problem": "在功能性磁共振成像（fMRI）或皮层脑电图（ECoG）分析中，为了跨会话对齐二维（$2$-D）视网膜拓扑场图，我们使用仿射变换来配准神经元响应坐标。设仿射映射定义为 $T(x)=A x + b$，其中\n$$\nA=\\begin{pmatrix}0  -1 \\\\ 1  0\\end{pmatrix}, \\quad b=\\begin{pmatrix}3 \\\\ -2\\end{pmatrix}.\n$$\n考虑位于\n$$\nx^{\\ast}=\\begin{pmatrix}-0.8 \\\\ 2.3\\end{pmatrix}\n$$\n的神经元质心。\n首先，计算映射后的坐标 $T(x^{\\ast})$。然后，仅使用基本定义（仿射变换、欧几里得范数、内积和正交矩阵），推导出一个严格的判据，以判断线性部分 $A$ 是否保持所有欧几里得距离，并因此在与任何平移结合时构成刚性变换。最后，为定量总结刚性判决，计算标量刚性偏离指数\n$$\n\\Delta=\\|A^{\\top}A - I\\|_{F},\n$$\n其中 $\\|\\,\\cdot\\,\\|_{F}$ 表示弗罗贝尼乌斯范数，$I$ 是单位矩阵。将 $\\Delta$ 作为你的最终答案。如果计算出的值为数值，请精确报告（无需四舍五入）。",
            "solution": "我们从神经科学数据分析中与仿射配准相关的基本定义开始。$\\mathbb{R}^{2}$ 中的仿射变换是形如 $T(x)=A x + b$ 的映射，其中 $A \\in \\mathbb{R}^{2 \\times 2}$ 且 $b \\in \\mathbb{R}^{2}$。向量 $z \\in \\mathbb{R}^{2}$ 的欧几里得范数是 $\\|z\\|=\\sqrt{z^{\\top}z}$，矩阵 $M \\in \\mathbb{R}^{2 \\times 2}$ 的弗罗贝尼乌斯范数是 $\\|M\\|_{F}=\\sqrt{\\sum_{i=1}^{2}\\sum_{j=1}^{2} M_{ij}^{2}}$。一个线性映射保持所有欧几里得距离，当且仅当它对所有向量都保持欧几里得范数，这等价于一个由 $A^{\\top}A=I$ 表征的正交线性变换。\n\n步骤 $1$：计算映射后的坐标 $T(x^{\\ast})$。已知\n$$\nA=\\begin{pmatrix}0  -1 \\\\ 1  0\\end{pmatrix}, \\quad b=\\begin{pmatrix}3 \\\\ -2\\end{pmatrix}, \\quad x^{\\ast}=\\begin{pmatrix}-0.8 \\\\ 2.3\\end{pmatrix},\n$$\n我们有\n$$\nA x^{\\ast}=\\begin{pmatrix}0  -1 \\\\ 1  0\\end{pmatrix}\\begin{pmatrix}-0.8 \\\\ 2.3\\end{pmatrix}=\\begin{pmatrix}-2.3 \\\\ -0.8\\end{pmatrix},\n$$\n因此\n$$\nT(x^{\\ast})=A x^{\\ast}+b=\\begin{pmatrix}-2.3 \\\\ -0.8\\end{pmatrix}+\\begin{pmatrix}3 \\\\ -2\\end{pmatrix}=\\begin{pmatrix}0.7 \\\\ -2.8\\end{pmatrix}.\n$$\n\n步骤 $2$：从第一性原理推导刚性判据。一个变换 $T(x)=A x + b$ 是刚性的（保持距离），如果对于所有点对 $x_{1}, x_{2} \\in \\mathbb{R}^{2}$，\n$$\n\\|T(x_{1})-T(x_{2})\\|=\\|x_{1}-x_{2}\\|.\n$$\n由于求差时平移量 $b$ 会抵消，这简化为对所有 $z \\in \\mathbb{R}^{2}$ 的要求，\n$$\n\\|A z\\|=\\|z\\|.\n$$\n使用欧几里得范数的定义，此条件为\n$$\n\\sqrt{(A z)^{\\top}(A z)}=\\sqrt{z^{\\top}z} \\quad \\text{对所有 } z,\n$$\n将两边平方后（由于范数非负，等价性得以保持），变为\n$$\nz^{\\top}A^{\\top}A z=z^{\\top}z \\quad \\text{对所有 } z.\n$$\n根据极化恒等式和二次型的性质，上述等式对所有 $z$ 成立，当且仅当\n$$\nA^{\\top}A=I,\n$$\n这正是 $A$ 为正交矩阵的定义。因此，线性部分 $A$ 具有刚性的充分必要条件是 $A^{\\top}A=I$。\n\n步骤 $3$：计算刚性偏离指数 $\\Delta=\\|A^{\\top}A - I\\|_{F}$。我们计算\n$$\nA^{\\top}=\\begin{pmatrix}0  1 \\\\ -1  0\\end{pmatrix}, \\quad A^{\\top}A=\\begin{pmatrix}0  1 \\\\ -1  0\\end{pmatrix}\\begin{pmatrix}0  -1 \\\\ 1  0\\end{pmatrix}=\\begin{pmatrix}1  0 \\\\ 0  1\\end{pmatrix}=I.\n$$\n因此\n$$\nA^{\\top}A - I=\\begin{pmatrix}1  0 \\\\ 0  1\\end{pmatrix}-\\begin{pmatrix}1  0 \\\\ 0  1\\end{pmatrix}=\\begin{pmatrix}0  0 \\\\ 0  0\\end{pmatrix}.\n$$\n零矩阵的弗罗贝尼乌斯范数是\n$$\n\\|A^{\\top}A - I\\|_{F}=\\sqrt{0^{2}+0^{2}+0^{2}+0^{2}}=0.\n$$\n\n结论：映射后的坐标为 $T(x^{\\ast})=\\begin{pmatrix}0.7 \\\\ -2.8\\end{pmatrix}$，线性部分 $A$ 是正交的，刚性偏离指数 $\\Delta=0$，表明这是一个与平移相结合的完美刚性变换（一个纯旋转）。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "线性变换不仅包括我们熟悉的旋转和缩放，还包括像剪切这样的非刚性形变，它们在处理神经影像数据中的扫描伪影时经常出现。本练习将深入剖析剪切变换的数学结构 ，这是一个典型的不可对角化矩阵的例子。通过从第一性原理出发，计算其特征值、特征向量和广义特征向量，你将构建出该变换的若尔当标准型 (Jordan normal form)，从而揭示这类重要变换的内在谱特性。",
            "id": "4177175",
            "problem": "通过双光子显微镜（2PM）获得的钙成像平面的二维切片经过后处理以校正逐行漂移。一个普遍存在的伪影是由扫描轨迹引起的水平剪切：每一行都按其垂直坐标成比例的量进行平移。在规范基中，此预处理步骤被建模为一个作用于平面坐标 $x$ 和 $y$ 的线性变换，通过\n$$\n\\begin{pmatrix}\nx' \\\\ y'\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1  \\alpha \\\\\n0  1\n\\end{pmatrix}\n\\begin{pmatrix}\nx \\\\ y\n\\end{pmatrix},\n$$\n其中 $\\alpha \\neq 0$ 是一个从数据中估计出的无量纲剪切参数。将此变换视为 $\\mathbb{R}^{2}$ 上的线性算子，仅使用特征值、特征向量、广义特征向量和若尔当标准型的定义来分析其谱结构。\n\n从定义开始：\n- 线性算子 $A$ 的一个特征值 $\\lambda$ 满足 $\\det(A - \\lambda I) = 0$，相应的特征向量 $v \\neq \\mathbf{0}$ 满足 $(A - \\lambda I)v = \\mathbf{0}$。\n- 一个秩为 2 的广义特征向量 $w$ 满足 $(A - \\lambda I)w = v$，其中 $v$ 是一个特征向量。\n- $A$ 的若尔当标准型是一个块对角矩阵，其若尔当块对应于每个特征值，通过相似变换 $A = P J P^{-1}$ 获得，其中 $P$ 的列构成了广义特征向量链。\n\n对于剪切矩阵\n$$\nS(\\alpha) = \\begin{pmatrix} 1  \\alpha \\\\ 0  1 \\end{pmatrix},\n$$\n证明其特征基是否是亏损的，并显式计算若尔当标准型 $J$。构造一个有效的广义特征向量链，并展示一个相似矩阵 $P$ 使得 $S(\\alpha) = P J P^{-1}$，从第一性原理出发验证此分解。作为最终答案，请以单个解析表达式的形式报告若尔当标准型矩阵 $J$。不需要四舍五入，也不涉及单位。如果出现角度，请以弧度表示。",
            "solution": "该问题要求分析水平剪切矩阵 $S(\\alpha) = \\begin{pmatrix} 1  \\alpha \\\\ 0  1 \\end{pmatrix}$ (其中 $\\alpha \\neq 0$) 的谱结构，并最终得到其若尔当标准型。分析将从特征值和特征向量的基本定义开始。\n\n首先，我们通过求解特征方程 $\\det(S(\\alpha) - \\lambda I) = 0$ 来求 $S(\\alpha)$ 的特征值，其中 $I$ 是 $2 \\times 2$ 单位矩阵。\n$$\n\\det\\left( \\begin{pmatrix} 1  \\alpha \\\\ 0  1 \\end{pmatrix} - \\lambda \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} \\right) = \\det \\begin{pmatrix} 1-\\lambda  \\alpha \\\\ 0  1-\\lambda \\end{pmatrix} = 0\n$$\n行列式为 $(1-\\lambda)^2 - (\\alpha)(0) = (1-\\lambda)^2$。\n令其为零得到 $(1-\\lambda)^2 = 0$，其唯一解为 $\\lambda = 1$。该特征值的代数重数为 2。\n\n接下来，我们通过求解方程 $(S(\\alpha) - \\lambda I)v = \\mathbf{0}$ 来找到对应于特征值 $\\lambda = 1$ 的特征向量，其中 $v = \\begin{pmatrix} v_x \\\\ v_y \\end{pmatrix}$ 是一个非零向量。\n$$\n(S(\\alpha) - 1 \\cdot I)v = \\begin{pmatrix} 1-1  \\alpha \\\\ 0  1-1 \\end{pmatrix} \\begin{pmatrix} v_x \\\\ v_y \\end{pmatrix} = \\begin{pmatrix} 0  \\alpha \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} v_x \\\\ v_y \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n这个矩阵-向量方程对应于线性系统：\n$$\n\\begin{cases}\n0 \\cdot v_x + \\alpha \\cdot v_y = 0 \\\\\n0 \\cdot v_x + 0 \\cdot v_y = 0\n\\end{cases}\n$$\n第二个方程是平凡的（$0=0$）。第一个方程是 $\\alpha v_y = 0$。由于题目规定 $\\alpha \\neq 0$，我们必须有 $v_y = 0$。分量 $v_x$ 是一个自由变量。因此，任何特征向量都必须具有 $v = \\begin{pmatrix} k \\\\ 0 \\end{pmatrix}$ 的形式，其中标量 $k \\neq 0$。\n与 $\\lambda=1$ 相关联的特征空间是所有这种形式的向量的集合，它由单个向量 $\\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$ 张成。该特征空间的维数为 1，这意味着特征值 $\\lambda=1$ 的几何重数为 1。\n\n$\\lambda=1$ 的代数重数为 2，而其几何重数为 1。由于几何重数小于代数重数，因此不存在 $\\mathbb{R}^2$ 的特征向量基。因此，矩阵 $S(\\alpha)$ 是亏损的且不可对角化。\n\n由于 $S(\\alpha)$ 是一个 $2 \\times 2$ 矩阵，它有一个代数重数为 2、几何重数为 1 的特征值 $\\lambda=1$，因此其若尔当标准型 $J$ 必须由一个对应于 $\\lambda=1$ 的大小为 2 的若尔当块组成。该块的形式为 $\\begin{pmatrix} \\lambda  1 \\\\ 0  \\lambda \\end{pmatrix}$。\n因此，$S(\\alpha)$ 的若尔当标准型为：\n$$\nJ = \\begin{pmatrix} 1  1 \\\\ 0  1 \\end{pmatrix}\n$$\n为了找到相似变换 $S(\\alpha) = P J P^{-1}$，我们必须从一个广义特征向量链构造矩阵 $P$。设该链为 $\\{v_1, v_2\\}$，其中 $v_1$ 是一个特征向量，$v_2$ 是一个秩为 2 的广义特征向量。这些向量由以下关系定义：\n$$\n(S(\\alpha) - I) v_1 = \\mathbf{0}\n$$\n$$\n(S(\\alpha) - I) v_2 = v_1\n$$\n我们需要找到一个向量 $v_2$，它本身不是特征向量，但在变换 $(S(\\alpha)-I)$ 下的像是特征向量。广义特征向量 $v_2$ 属于 $(S(\\alpha)-I)^2$ 的零空间，但不属于 $(S(\\alpha)-I)$ 的零空间。\n首先，我们计算 $(S(\\alpha)-I)^2$：\n$$\n(S(\\alpha)-I)^2 = \\begin{pmatrix} 0  \\alpha \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} 0  \\alpha \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ 0  0 \\end{pmatrix}\n$$\n由于 $(S(\\alpha)-I)^2$ 是零矩阵，其零空间是整个空间 $\\mathbb{R}^2$。我们可以选择任何不是特征向量的向量 $v_2$（即，不是 $\\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$ 的倍数）。一个简单的选择是 $v_2 = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$。\n\n现在，我们使用链的定义来找到 $v_1$：\n$$\nv_1 = (S(\\alpha) - I) v_2 = \\begin{pmatrix} 0  \\alpha \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} \\alpha \\\\ 0 \\end{pmatrix}\n$$\n这个向量 $v_1 = \\begin{pmatrix} \\alpha \\\\ 0 \\end{pmatrix}$ 确实是一个有效的特征向量，因为它是 $\\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$ 的非零倍数。\n广义特征向量链是 $\\{v_1, v_2\\} = \\left\\{ \\begin{pmatrix} \\alpha \\\\ 0 \\end{pmatrix}, \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} \\right\\}$。\n\n相似矩阵 $P$ 由这些链向量按顺序作为其列构成：\n$$\nP = \\begin{pmatrix} v_1  v_2 \\end{pmatrix} = \\begin{pmatrix} \\alpha  0 \\\\ 0  1 \\end{pmatrix}\n$$\n为了验证分解 $S(\\alpha) = P J P^{-1}$，我们首先计算 $P$ 的逆矩阵。由于 $P$ 是一个对角矩阵，其逆矩阵很简单：\n$$\nP^{-1} = \\begin{pmatrix} \\frac{1}{\\alpha}  0 \\\\ 0  1 \\end{pmatrix}\n$$\n现在我们计算乘积 $P J P^{-1}$：\n$$\nP J P^{-1} = \\begin{pmatrix} \\alpha  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 1  1 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} \\frac{1}{\\alpha}  0 \\\\ 0  1 \\end{pmatrix}\n$$\n首先，将 $P$ 和 $J$ 相乘：\n$$\nP J = \\begin{pmatrix} \\alpha  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 1  1 \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} (\\alpha)(1) + (0)(0)  (\\alpha)(1) + (0)(1) \\\\ (0)(1) + (1)(0)  (0)(1) + (1)(1) \\end{pmatrix} = \\begin{pmatrix} \\alpha  \\alpha \\\\ 0  1 \\end{pmatrix}\n$$\n现在，右乘 $P^{-1}$：\n$$\n(P J) P^{-1} = \\begin{pmatrix} \\alpha  \\alpha \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} \\frac{1}{\\alpha}  0 \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} (\\alpha)(\\frac{1}{\\alpha}) + (\\alpha)(0)  (\\alpha)(0) + (\\alpha)(1) \\\\ (0)(\\frac{1}{\\alpha}) + (1)(0)  (0)(0) + (1)(1) \\end{pmatrix} = \\begin{pmatrix} 1  \\alpha \\\\ 0  1 \\end{pmatrix}\n$$\n得到的矩阵确实是 $S(\\alpha)$，这验证了分解。谱分析完成，若尔当标准型 $J$ 已被显式计算和验证。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1  1 \\\\\n0  1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在处理fMRI等时间序列神经数据时，平滑地处理头部运动估计是一个巨大挑战，因为简单地对旋转参数进行平均会导致不符合物理规律的形变。本练习将引导你进入三维旋转的优雅世界，利用四元数在三维球面上进行球面线性插值 (Slerp) 。你将推导并应用这一强大技术，来解决两个旋转姿态之间的“最短路径”插值问题，并理解为什么这种方法能够确保插值过程中的变换始终是纯旋转，从而避免引入不必要的缩放或剪切。",
            "id": "4177172",
            "problem": "功能性磁共振成像（fMRI）运动校正中的一个常见挑战是在时间上平滑估计的头部方向，同时不引入非刚性伪影，如缩放或剪切。考虑三维旋转群 $\\mathrm{SO}(3)$ 及其由单位四元数构成的双覆盖，单位四元数与三维球面 $\\mathbb{S}^{3} \\subset \\mathbb{R}^{4}$ 等同。一个单位四元数 $q = (q_{w}, q_{x}, q_{y}, q_{z})$ 表示一个旋转，对径点等同关系 $q \\sim -q$ 解释了其对 $\\mathrm{SO}(3)$ 的双覆盖。$\\mathbb{S}^{3}$ 上最短路径插值的内在几何概念（相对于由 $\\mathbb{R}^{4}$ 上的欧几里得内积诱导的标准球面度量而言的测地线）产生了一条连接两个单位四元数的匀速大圆路径，这提供了一种原则性的方法来插值旋转，当转换为旋转矩阵时不会引入缩放或剪切。\n\n从以下基本事实出发：\n- 三维空间中的旋转构成特殊正交群 $\\mathrm{SO}(3)$，任何旋转都可以用一个单位四元数 $q \\in \\mathbb{S}^{3}$ 表示，并满足等价关系 $q \\sim -q$。\n- 在标准黎曼度量下，$\\mathbb{S}^{3}$ 上的测地线是大圆，两个非对径点之间的最短路径是唯一的匀速大圆弧。\n- $\\mathbb{R}^{4}$ 中的内积由 $\\langle q_{0}, q_{1} \\rangle = q_{0w} q_{1w} + q_{0x} q_{1x} + q_{0y} q_{1y} + q_{0z} q_{1z}$ 给出，它通过 $\\Omega = \\arccos(\\langle q_{0}, q_{1} \\rangle)$ 确定单位四元数之间的夹角。\n\n推导两个单位四元数 $q_{0}$ 和 $q_{1}$ 之间在 $\\mathbb{S}^{3}$ 上的唯一匀速最短路径插值表达式，然后在以下神经科学运动校正场景中对其进行求值：设 $q_{0} = (1, 0, 0, 0)$（单位旋转），$q_{1}$ 是表示绕 $z$ 轴旋转 $\\pi/2$ 弧度的单位四元数。计算沿最短测地线路径长度分数 $t = \\frac{1}{3}$ 处的插值四元数。以精确的封闭形式表示最终答案的四元数分量 $(q_{w}, q_{x}, q_{y}, q_{z})$，不要进行数值取整。\n\n在你的推导中，论证为什么当将此测地线插值作为旋转矩阵应用于三维体数据时可以避免缩放和剪切，并简要解释这种插值如何支持fMRI中头部运动估计的时间平滑。最终答案必须是插值四元数的单个解析表达式，使用 \\texttt{pmatrix} 环境写成行矩阵。整个过程中角度均以弧度处理。",
            "solution": "求解过程包括四个部分：\n1.  推导在三维球面 $\\mathbb{S}^3$ 上两个单位四元数之间匀速最短路径插值的通用公式。\n2.  论证为什么这种插值方法能保持刚性（即避免缩放和剪切）。\n3.  解释该方法在fMRI运动参数时间平滑中的应用。\n4.  将推导出的公式应用于问题中给出的具体案例。\n\n**1. 测地线插值（SLERP）的推导**\n\n设 $q_0$ 和 $q_1$ 为 $\\mathbb{R}^4$ 中两个不同的、非对径的单位四元数。作为向量，它们位于单位三维球面 $\\mathbb{S}^3$ 上。它们在球面上的最短路径是通过它们的那个大圆的较短弧。这个大圆位于由向量 $q_0$ 和 $q_1$ 张成的二维平面内。\n\n这两个向量之间的夹角 $\\Omega$ 由它们的内积给出：\n$$ \\Omega = \\arccos(\\langle q_0, q_1 \\rangle) $$\n由于 $q_0$ 和 $q_1$ 是单位四元数，所以 $\\|q_0\\|=1$ 且 $\\|q_1\\|=1$。为了取最短路径，如果 $\\langle q_0, q_1 \\rangle  0$，我们可以通过用 $-q_1$ 替换 $q_1$ 来确保 $\\Omega \\in [0, \\pi/2]$，因为 $q_1$ 和 $-q_1$ 代表相同的旋转。我们假设已完成此操作。\n\n大圆弧上的任意点 $q(t)$ 都可以表示为包含该弧的平面的一个标准正交基的线性组合。我们可以选择 $q_0$ 作为第一个基向量。第二个基向量，我们称之为 $u$，必须是位于由 $\\{q_0, q_1\\}$ 张成的平面内且与 $q_0$ 正交的单位向量。我们可以使用Gram-Schmidt过程构造这样一个向量。令 $v = q_1 - \\langle q_1, q_0 \\rangle q_0$。该向量 $v$ 与 $q_0$ 正交。其范数的平方为：\n$$ \\|v\\|^2 = \\langle q_1 - \\langle q_1, q_0 \\rangle q_0, q_1 - \\langle q_1, q_0 \\rangle q_0 \\rangle = \\|q_1\\|^2 - 2\\langle q_1, q_0 \\rangle^2 + \\langle q_1, q_0 \\rangle^2 \\|q_0\\|^2 $$\n因为 $\\|q_0\\|=\\|q_1\\|=1$ 且 $\\langle q_0, q_1 \\rangle = \\cos(\\Omega)$，我们有：\n$$ \\|v\\|^2 = 1 - 2\\cos^2(\\Omega) + \\cos^2(\\Omega) = 1 - \\cos^2(\\Omega) = \\sin^2(\\Omega) $$\n因此，$\\|v\\| = \\sin(\\Omega)$（因为 $\\Omega \\in [0, \\pi)$，$\\sin(\\Omega) \\ge 0$）。单位向量是 $u = \\frac{v}{\\|v\\|} = \\frac{q_1 - \\cos(\\Omega)q_0}{\\sin(\\Omega)}$。\n\n集合 $\\{q_0, u\\}$ 构成了该平面的一个标准正交基。匀速插值对应于以恒定角速度遍历该弧。要从 $q_0$ 到 $q_1$ 的路径上走过比例为 $t$ 的路程，我们必须从 $q_0$ 旋转 $t\\Omega$ 的角度。在基 $\\{q_0, u\\}$ 中，这是一个简单的二维旋转：\n$$ q(t) = \\cos(t\\Omega) q_0 + \\sin(t\\Omega) u $$\n代入 $u$ 的表达式：\n$$ q(t) = \\cos(t\\Omega) q_0 + \\sin(t\\Omega) \\left( \\frac{q_1 - \\cos(\\Omega)q_0}{\\sin(\\Omega)} \\right) $$\n对 $q_0$ 和 $q_1$ 的项进行分组：\n$$ q(t) = \\left( \\cos(t\\Omega) - \\frac{\\sin(t\\Omega)\\cos(\\Omega)}{\\sin(\\Omega)} \\right) q_0 + \\left( \\frac{\\sin(t\\Omega)}{\\sin(\\Omega)} \\right) q_1 $$\n使用三角恒等式 $\\sin(A-B) = \\sin(A)\\cos(B) - \\cos(A)\\sin(B)$，$q_0$ 的系数可以简化为：\n$$ \\frac{\\sin(\\Omega)\\cos(t\\Omega) - \\cos(\\Omega)\\sin(t\\Omega)}{\\sin(\\Omega)} = \\frac{\\sin(\\Omega - t\\Omega)}{\\sin(\\Omega)} = \\frac{\\sin((1-t)\\Omega)}{\\sin(\\Omega)} $$\n这就得到了球面线性插值（SLERP）公式：\n$$ q(t) = \\frac{\\sin((1-t)\\Omega)}{\\sin(\\Omega)} q_0 + \\frac{\\sin(t\\Omega)}{\\sin(\\Omega)} q_1 $$\n该公式定义了对于 $t \\in [0, 1]$ 的唯一匀速最短路径插值。\n\n**2. 避免缩放和剪切的论证**\n\n一个变换矩阵当且仅当它属于特殊正交群 $\\mathrm{SO}(3)$ 时，才表示纯旋转。这些矩阵是正交的（$R^T R = I$）且行列式为 $+1$。一个关键性质是它们保持长度和角度，因此它们是无缩放或剪切的刚体变换。\n\n任何单位四元数 $q$ 都对应于 $\\mathrm{SO}(3)$ 中的一个旋转矩阵。因此，要证明插值变换始终是纯旋转，我们只需要证明插值四元数 $q(t)$ 对于所有 $t \\in [0, 1]$ 都是单位四元数。\n\n使用表达式 $q(t) = \\cos(t\\Omega) q_0 + \\sin(t\\Omega) u$ 以及 $\\{q_0, u\\}$ 是一个标准正交基的事实，我们计算 $q(t)$ 范数的平方：\n$$ \\|q(t)\\|^2 = \\langle \\cos(t\\Omega) q_0 + \\sin(t\\Omega) u, \\cos(t\\Omega) q_0 + \\sin(t\\Omega) u \\rangle $$\n$$ \\|q(t)\\|^2 = \\cos^2(t\\Omega) \\langle q_0, q_0 \\rangle + \\sin^2(t\\Omega) \\langle u, u \\rangle + 2\\cos(t\\Omega)\\sin(t\\Omega)\\langle q_0, u \\rangle $$\n由于 $\\langle q_0, q_0 \\rangle = \\|q_0\\|^2 = 1$，$\\langle u, u \\rangle = \\|u\\|^2 = 1$，并且 $\\langle q_0, u \\rangle = 0$：\n$$ \\|q(t)\\|^2 = \\cos^2(t\\Omega) \\cdot 1 + \\sin^2(t\\Omega) \\cdot 1 + 0 = 1 $$\n由于对于所有 $t \\in [0, 1]$ 都有 $\\|q(t)\\|=1$，所以插值四元数始终是单位四元数。因此，它始终表示 $\\mathrm{SO}(3)$ 中的纯旋转，从而保证插值不会引入像缩放或剪切这样的非刚性伪影。\n\n**3. 在fMRI运动平滑中的应用**\n\n在fMRI分析中，扫描期间的头部运动是伪影的一个重要来源。运动校正算法估计将每个脑体积对齐到参考体积所需的刚体变换（三维旋转和三维平移）。这会产生一个旋转参数的时间序列，每个采集的体积对应一个参数。这个序列可能含有噪声或生理上不合理的跳变，这可能是由于估计误差或被试的急动造成的。\n\n对这些参数进行时间平滑是可取的。然而，天真地对常见的旋转表示（如欧拉角或旋转矩阵）进行滤波或平均是有问题的。欧拉角存在万向节死锁和旋转空间非均匀表示的问题。对旋转矩阵进行平均通常不会得到一个有效的旋转矩阵。\n\n通过将旋转表示为单位四元数，我们将问题转移到流形 $\\mathbb{S}^3$ 上。然后可以使用这个空间的内在几何来进行平滑或插值。SLERP提供了一种在两个给定旋转之间找到中间旋转的原则性方法。对于时间滤波（例如移动平均），这个概念被扩展到寻找多个四元数的几何平均值。这个过程确保了整个平滑后的头部方向轨迹都由有效旋转组成，对应于所有可能头部方向空间中的一条平滑、物理上合理的路径。\n\n**4. 具体计算**\n\n我们需要求解在 $q_0 = (1, 0, 0, 0)$ 和 $q_1$ 之间 $t = \\frac{1}{3}$ 处的插值四元数，其中 $q_1$ 表示绕 $z$ 轴旋转 $\\theta = \\pi/2$。\n\n首先，我们确定 $q_1$。对于绕单位轴 $\\mathbf{u}=(u_x, u_y, u_z)$ 旋转角度 $\\theta$ 的情况，对应的单位四元数是 $q = (\\cos(\\theta/2), u_x \\sin(\\theta/2), u_y \\sin(\\theta/2), u_z \\sin(\\theta/2))$。\n这里，$\\theta = \\pi/2$ 且 $\\mathbf{u}=(0, 0, 1)$。因此，$\\theta/2 = \\pi/4$。\n$$ q_1 = (\\cos(\\pi/4), 0 \\cdot \\sin(\\pi/4), 0 \\cdot \\sin(\\pi/4), 1 \\cdot \\sin(\\pi/4)) = (\\frac{\\sqrt{2}}{2}, 0, 0, \\frac{\\sqrt{2}}{2}) $$\n\n接下来，我们计算 $q_0$ 和 $q_1$ 之间的夹角 $\\Omega$：\n$$ \\langle q_0, q_1 \\rangle = (1)(\\frac{\\sqrt{2}}{2}) + (0)(0) + (0)(0) + (0)(\\frac{\\sqrt{2}}{2}) = \\frac{\\sqrt{2}}{2} $$\n$$ \\Omega = \\arccos(\\frac{\\sqrt{2}}{2}) = \\frac{\\pi}{4} $$\n\n现在，我们使用 SLERP 公式，并代入 $t = \\frac{1}{3}$：\n$$ q(\\frac{1}{3}) = \\frac{\\sin((1-\\frac{1}{3})\\frac{\\pi}{4})}{\\sin(\\frac{\\pi}{4})} q_0 + \\frac{\\sin(\\frac{1}{3}\\frac{\\pi}{4})}{\\sin(\\frac{\\pi}{4})} q_1 $$\n$$ q(\\frac{1}{3}) = \\frac{\\sin(\\frac{2}{3} \\frac{\\pi}{4})}{\\sin(\\frac{\\pi}{4})} q_0 + \\frac{\\sin(\\frac{\\pi}{12})}{\\sin(\\frac{\\pi}{4})} q_1 = \\frac{\\sin(\\frac{\\pi}{6})}{\\sin(\\frac{\\pi}{4})} q_0 + \\frac{\\sin(\\frac{\\pi}{12})}{\\sin(\\frac{\\pi}{4})} q_1 $$\n\n我们需要以下正弦函数的值：\n- $\\sin(\\pi/6) = \\frac{1}{2}$\n- $\\sin(\\pi/4) = \\frac{\\sqrt{2}}{2}$\n- $\\sin(\\pi/12) = \\sin(15^\\circ) = \\sin(45^\\circ - 30^\\circ) = \\sin(45^\\circ)\\cos(30^\\circ) - \\cos(45^\\circ)\\sin(30^\\circ) = \\frac{\\sqrt{2}}{2}\\frac{\\sqrt{3}}{2} - \\frac{\\sqrt{2}}{2}\\frac{1}{2} = \\frac{\\sqrt{6}-\\sqrt{2}}{4}$\n\n现在计算系数：\n- $q_0$ 的系数：$\\frac{\\sin(\\pi/6)}{\\sin(\\pi/4)} = \\frac{1/2}{\\sqrt{2}/2} = \\frac{1}{\\sqrt{2}} = \\frac{\\sqrt{2}}{2}$\n- $q_1$ 的系数：$\\frac{\\sin(\\pi/12)}{\\sin(\\pi/4)} = \\frac{(\\sqrt{6}-\\sqrt{2})/4}{\\sqrt{2}/2} = \\frac{\\sqrt{6}-\\sqrt{2}}{2\\sqrt{2}} = \\frac{\\sqrt{2}(\\sqrt{3}-1)}{2\\sqrt{2}} = \\frac{\\sqrt{3}-1}{2}$\n\n最后，我们计算插值四元数 $q(\\frac{1}{3})$：\n$$ q(\\frac{1}{3}) = \\frac{\\sqrt{2}}{2} (1, 0, 0, 0) + \\frac{\\sqrt{3}-1}{2} (\\frac{\\sqrt{2}}{2}, 0, 0, \\frac{\\sqrt{2}}{2}) $$\n各分量为：\n- $q_w = \\frac{\\sqrt{2}}{2} \\cdot 1 + \\frac{\\sqrt{3}-1}{2} \\cdot \\frac{\\sqrt{2}}{2} = \\frac{\\sqrt{2}}{2} + \\frac{\\sqrt{6}-\\sqrt{2}}{4} = \\frac{2\\sqrt{2} + \\sqrt{6}-\\sqrt{2}}{4} = \\frac{\\sqrt{6}+\\sqrt{2}}{4}$\n- $q_x = \\frac{\\sqrt{2}}{2} \\cdot 0 + \\frac{\\sqrt{3}-1}{2} \\cdot 0 = 0$\n- $q_y = \\frac{\\sqrt{2}}{2} \\cdot 0 + \\frac{\\sqrt{3}-1}{2} \\cdot 0 = 0$\n- $q_z = \\frac{\\sqrt{2}}{2} \\cdot 0 + \\frac{\\sqrt{3}-1}{2} \\cdot \\frac{\\sqrt{2}}{2} = \\frac{\\sqrt{6}-\\sqrt{2}}{4}$\n\n插值后的四元数为 $(\\frac{\\sqrt{6}+\\sqrt{2}}{4}, 0, 0, \\frac{\\sqrt{6}-\\sqrt{2}}{4})$。这对应于绕 $z$ 轴旋转角度 $t\\theta = \\frac{1}{3} \\frac{\\pi}{2} = \\frac{\\pi}{6}$，因为 $\\cos(\\pi/12) = \\frac{\\sqrt{6}+\\sqrt{2}}{4}$ 且 $\\sin(\\pi/12) = \\frac{\\sqrt{6}-\\sqrt{2}}{4}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{\\sqrt{6}+\\sqrt{2}}{4}  0  0  \\frac{\\sqrt{6}-\\sqrt{2}}{4}\n\\end{pmatrix}\n}\n$$"
        }
    ]
}