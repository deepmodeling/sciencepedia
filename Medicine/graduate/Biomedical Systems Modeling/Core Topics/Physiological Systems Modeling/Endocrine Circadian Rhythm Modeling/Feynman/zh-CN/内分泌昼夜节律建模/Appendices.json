{
    "hands_on_practices": [
        {
            "introduction": "实践的第一步是构建一个描述关键昼夜节律激素——褪黑素——的基础模型。该模型基于一个简单的质量平衡原理：褪黑素浓度的变化速率等于其产生速率与清除速率之差。通过这个练习 ，你将探索该系统如何响应抑制褪黑素产生的周期性光信号，并亲手实践使用线性常微分方程（ODE）这一生理系统建模的基本工具，从而理解如何根据激素的底层动态来预测其节律性行为。",
            "id": "3883933",
            "problem": "一个内分泌变量，如血浆褪黑素浓度，记为 $M(t)$，可以通过一个质量平衡常微分方程（ODE）来建模，该方程描述了由昼夜节律起搏器驱动的产生过程和一级清除过程。假设产生速率通过一个产生增益 $k_{s} > 0$ 与昼夜节律驱动 $S(t)$ 成正比，并且清除过程由一个一级速率常数 $k_{d} > 0$ 控制。光照 $L(t)$ 通过抑制昼夜节律驱动来对其进行调节，调节关系为 $S(t) = S_{0}\\left(1 - \\alpha L(t)\\right)$，其中 $S_{0} > 0$ 是未受调节的驱动水平，$\\alpha \\in [0,1)$ 是一个无量纲的光敏参数。由此得到的常微分方程为\n$$\\dot{M}(t) = k_{s} S(t) - k_{d} M(t).$$\n假设光输入 $L(t)$ 包含一个基线分量和一个单一的主导昼夜节律谐波，并表示为\n$$L(t) = \\bar{L} + L_{1} \\cos\\left(\\omega t\\right),$$\n其中 $\\bar{L} \\ge 0$ 是一个恒定的基线光照水平，$L_{1} \\ge 0$ 是昼夜节律调制的振幅，$\\omega > 0$ 是昼夜节律驱动的角频率。假设系统达到了其唯一的有界周期性稳态。将 $M(t)$ 的稳态振荡幅度定义为其正弦分量围绕均值的幅度（即基波的峰谷差的一半）。\n\n从产生-清除平衡和对周期性强迫的线性时不变响应的第一性原理出发，推导 $M(t)$ 的稳态振荡幅度的闭式表达式，使其成为 $\\alpha$、$k_{s}$、$k_{d}$、$S_{0}$、$L_{1}$ 和 $\\omega$ 的显式函数。请将最终答案表示为单个解析表达式。不需要数值近似或四舍五入。最终表达式中不要包含单位。",
            "solution": "该模型是一个表达产生和清除过程的线性一阶常微分方程（ODE）：\n$$\\dot{M}(t) = k_{s} S(t) - k_{d} M(t), \\quad k_{s} > 0, \\; k_{d} > 0.$$\n昼夜节律驱动 $S(t)$ 被光抑制，关系如下：\n$$S(t) = S_{0}\\left(1 - \\alpha L(t)\\right), \\quad S_{0} > 0, \\; \\alpha \\in [0,1).$$\n根据假设的光输入\n$$L(t) = \\bar{L} + L_{1}\\cos(\\omega t), \\quad \\bar{L} \\ge 0, \\; L_{1} \\ge 0, \\; \\omega > 0,$$\n驱动变为\n\\begin{align*}\nS(t) = S_{0}\\left(1 - \\alpha\\left(\\bar{L} + L_{1}\\cos(\\omega t)\\right)\\right) \\\\\n= S_{0}\\left(1 - \\alpha \\bar{L}\\right) - S_{0}\\alpha L_{1}\\cos(\\omega t).\n\\end{align*}\n因此，该常微分方程可以写成\n$$\\dot{M}(t) + k_{d} M(t) = k_{s} S_{0}\\left(1 - \\alpha \\bar{L}\\right) - k_{s} S_{0} \\alpha L_{1} \\cos(\\omega t).$$\n由于系统是线性时不变的，稳态解 $M_{\\mathrm{ss}}(t)$ 由一个恒定驱动引起的常数（均值）分量和一个余弦强迫引起的正弦分量组成。我们寻求一个形式如下的稳态解\n$$M_{\\mathrm{ss}}(t) = M_{\\mathrm{mean}} + A \\cos(\\omega t) + B \\sin(\\omega t),$$\n其中 $M_{\\mathrm{mean}}$ 是常数分量，$A$、$B$ 是基波的系数。求导，\n$$\\frac{d}{dt}M_{\\mathrm{ss}}(t) = -A \\omega \\sin(\\omega t) + B \\omega \\cos(\\omega t).$$\n将 $M_{\\mathrm{ss}}(t)$ 及其导数代入常微分方程：\n\\begin{align*}\n\\left(-A \\omega \\sin(\\omega t) + B \\omega \\cos(\\omega t)\\right) + k_{d}\\left(M_{\\mathrm{mean}} + A \\cos(\\omega t) + B \\sin(\\omega t)\\right) = k_{s} S_{0}\\left(1 - \\alpha \\bar{L}\\right) - k_{s} S_{0} \\alpha L_{1} \\cos(\\omega t).\n\\end{align*}\n分别令常数项以及 $\\cos(\\omega t)$ 和 $\\sin(\\omega t)$ 的系数相等。常数项给出\n$$k_{d} M_{\\mathrm{mean}} = k_{s} S_{0}\\left(1 - \\alpha \\bar{L}\\right), \\quad \\text{so} \\quad M_{\\mathrm{mean}} = \\frac{k_{s}}{k_{d}} S_{0}\\left(1 - \\alpha \\bar{L}\\right).$$\n对于谐波分量，令 $\\cos(\\omega t)$ 和 $\\sin(\\omega t)$ 的系数相等：\n\\begin{align*}\n\\cos(\\omega t): \\quad  B \\omega + k_{d} A = -k_{s} S_{0} \\alpha L_{1}, \\\\\n\\sin(\\omega t): \\quad  -A \\omega + k_{d} B = 0.\n\\end{align*}\n求解关于 $A$ 和 $B$ 的 $2 \\times 2$ 线性系统。由 $\\sin$ 方程可得，\n$$k_{d} B = A \\omega \\quad \\Rightarrow \\quad B = \\frac{A \\omega}{k_{d}}.$$\n代入 $\\cos$ 方程：\n\\begin{align*}\n\\left(\\frac{A \\omega}{k_{d}}\\right)\\omega + k_{d} A = -k_{s} S_{0} \\alpha L_{1}, \\\\\nA \\left(\\frac{\\omega^{2}}{k_{d}} + k_{d}\\right) = -k_{s} S_{0} \\alpha L_{1}, \\\\\nA \\left(\\frac{\\omega^{2} + k_{d}^{2}}{k_{d}}\\right) = -k_{s} S_{0} \\alpha L_{1}, \\\\\nA = -\\frac{k_{s} S_{0} \\alpha L_{1} k_{d}}{\\omega^{2} + k_{d}^{2}}.\n\\end{align*}\n然后\n$$B = \\frac{A \\omega}{k_{d}} = -\\frac{k_{s} S_{0} \\alpha L_{1} \\omega}{\\omega^{2} + k_{d}^{2}}.$$\n稳态振荡幅度（正弦分量的幅值）为\n$$\\mathcal{A} = \\sqrt{A^{2} + B^{2}}.$$\n计算\n\\begin{align*}\nA^{2} + B^{2} = \\left(\\frac{k_{s} S_{0} \\alpha L_{1}}{\\omega^{2} + k_{d}^{2}}\\right)^{2}\\left(k_{d}^{2} + \\omega^{2}\\right) \\\\\n= \\left(k_{s} S_{0} \\alpha L_{1}\\right)^{2} \\frac{1}{\\omega^{2} + k_{d}^{2}}.\n\\end{align*}\n因此\n$$\\mathcal{A}(\\alpha) = \\frac{k_{s} S_{0} \\alpha L_{1}}{\\sqrt{\\omega^{2} + k_{d}^{2}}}.$$\n该表达式表明，稳态幅度与光敏参数 $\\alpha$ 呈线性关系，并被一阶清除动力学的低通特性所衰减，衰减因子为分母中的 $\\sqrt{\\omega^{2} + k_{d}^{2}}$。",
            "answer": "$$\\boxed{\\frac{k_{s} S_{0} \\alpha L_{1}}{\\sqrt{\\omega^{2} + k_{d}^{2}}}}$$"
        },
        {
            "introduction": "在建立了下游激素的动态模型后，我们现在将目光转向更为核心的中央节律起搏器。真实的生物钟不仅仅是被动响应外部信号，它们是能够自我维持振荡的系统。本练习  将引导你使用 Stuart-Landau 振荡器这一典范模型，来理解系统如何自主产生节律。你将深入探索“授时” (entrainment) 这一核心概念，即外部信号（如每日的光暗循环）如何与内部时钟同步，并掌握分析生物振荡器与环境保持同步机制的强大非线性动力学方法。",
            "id": "3883882",
            "problem": "考虑一个用于内分泌节律的极简昼夜节律时钟模型，其中激素代理变量的相位相干振荡由复变量 $z(t)$ 表示，该变量遵循斯图尔特-朗道动力学，这是一种超临界霍普夫分岔附近的典范型。无驱动模型为 $\\dot{z}=(\\lambda+i\\omega)z-\\beta|z|^{2}z$，其中 $\\lambda>0$ 和 $\\beta>0$ 描述了振幅的增长和非线性饱和，$\\omega>0$ 是内禀角频率。为了对视交叉上核 (SCN) 的光输入及其下游内分泌影响所导致的光驱动同步进行建模，引入一个周期性光驱动作为加性复策动项 $\\dot{z}=(\\lambda+i\\omega)z-\\beta|z|^{2}z+f\\exp(i\\Omega t)$，其中 $f\\ge 0$ 是光输入的耦合强度，$\\Omega$ 是光暗周期的角频率。\n\n任务：\n1) 从受驱斯图尔特-朗道方程出发，设 $z(t)=r(t)\\exp(i\\theta(t))$，其中实振幅 $r(t)\\ge 0$，相位 $\\theta(t)\\in\\mathbb{R}$。通过分离实部和虚部，推导振幅 $r(t)$ 和相位 $\\theta(t)$ 的耦合常微分方程。\n2) 在 $0",
            "solution": "### 第1部分：推导振幅和相位的方程\n我们从受驱的斯图尔特-朗道方程开始：\n$$ \\dot{z} = (\\lambda+i\\omega)z - \\beta|z|^{2}z + f\\exp(i\\Omega t) $$\n代入极坐标表示 $z(t) = r(t)\\exp(i\\theta(t))$。其时间导数为：\n$$ \\dot{z} = \\frac{d}{dt}(r e^{i\\theta}) = \\dot{r}e^{i\\theta} + i r \\dot{\\theta}e^{i\\theta} $$\n将此式代入原方程，并注意到 $|z|^2 = |r e^{i\\theta}|^2 = r^2$：\n$$ \\dot{r}e^{i\\theta} + i r \\dot{\\theta}e^{i\\theta} = (\\lambda+i\\omega)r e^{i\\theta} - \\beta r^3 e^{i\\theta} + f e^{i\\Omega t} $$\n将整个方程乘以 $e^{-i\\theta}$：\n$$ \\dot{r} + i r \\dot{\\theta} = (\\lambda+i\\omega)r - \\beta r^3 + f e^{i(\\Omega t - \\theta)} $$\n展开右侧的复数项：\n$$ \\dot{r} + i r \\dot{\\theta} = \\lambda r + i\\omega r - \\beta r^3 + f \\big(\\cos(\\Omega t - \\theta) + i\\sin(\\Omega t - \\theta)\\big) $$\n通过分离实部和虚部，我们得到两个耦合的实数方程。\n实部：\n$$ \\dot{r} = \\lambda r - \\beta r^3 + f\\cos(\\Omega t - \\theta) $$\n虚部：\n$$ r\\dot{\\theta} = \\omega r + f\\sin(\\Omega t - \\theta) $$\n假设 $r>0$（远离平凡不动点），我们可以将第二个方程除以 $r$。为了方便分析，我们使用三角函数的性质，将辐角写为 $\\theta - \\Omega t$：\n$$ \\dot{r} = r(\\lambda - \\beta r^2) + f\\cos(\\theta - \\Omega t) $$\n$$ \\dot{\\theta} = \\omega + \\frac{f}{r}\\sin(\\Omega t - \\theta) = \\omega - \\frac{f}{r}\\sin(\\theta - \\Omega t) $$\n这是振幅 $r(t)$ 和相位 $\\theta(t)$ 的耦合常微分方程。\n\n### 第2部分：简化为关于相位差 $\\psi(t)$ 的单个方程\n首先，我们确定无驱动振子（$f=0$）的稳态振幅 $r^{\\ast}$。此时振幅方程为 $\\dot{r} = r(\\lambda - \\beta r^2)$。稳态（$\\dot{r}=0$）时，非平凡解满足 $\\lambda - \\beta (r^{\\ast})^2 = 0$，得到稳定的极限环振幅：\n$$ r^{\\ast} = \\sqrt{\\frac{\\lambda}{\\beta}} $$\n在弱驱动近似下 ($0 < f \\ll 1$)，我们假设振幅 $r(t)$ 快速弛豫到其极限环值附近，即 $r(t) \\approx r^{\\ast}$。\n我们定义相位差 $\\psi(t) = \\theta(t) - \\Omega t$。其时间导数为：\n$$ \\dot{\\psi} = \\dot{\\theta} - \\Omega $$\n将第1部分中 $\\dot{\\theta}$ 的表达式代入，并使用 $r \\approx r^{\\ast}$ 和 $\\theta - \\Omega t = \\psi$：\n$$ \\dot{\\psi} = \\left(\\omega - \\frac{f}{r^{\\ast}}\\sin(\\psi)\\right) - \\Omega $$\n整理后得到关于 $\\psi(t)$ 的简化标量方程，即阿德勒方程：\n$$ \\dot{\\psi} = (\\omega - \\Omega) - \\frac{f}{r^{\\ast}}\\sin(\\psi) $$\n$1:1$ 同步（或锁相）的条件是该方程存在一个稳定不动点 $\\psi^{\\ast}$，使得 $\\dot{\\psi}=0$。因此，不动点必须满足：\n$$ 0 = (\\omega - \\Omega) - \\frac{f}{r^{\\ast}}\\sin(\\psi^{\\ast}) $$\n可以改写为：\n$$ \\sin(\\psi^{\\ast}) = \\frac{r^{\\ast}(\\omega - \\Omega)}{f} $$\n\n### 第3部分：最小光耦合强度 $f_c$\n为了存在实数解 $\\psi^{\\ast}$，$\\sin(\\psi^{\\ast})$ 的值必须位于区间 $[-1, 1]$ 内。这施加了以下条件：\n$$ \\left| \\frac{r^{\\ast}(\\omega - \\Omega)}{f} \\right| \\le 1 $$\n$$ f \\ge r^{\\ast}|\\omega - \\Omega| $$\n因此，实现同步所需的最小光耦合强度 $f_c$ 是：\n$$ f_c = r^{\\ast}|\\omega - \\Omega| $$\n代入无驱动振幅 $r^{\\ast} = \\sqrt{\\lambda/\\beta}$ 的表达式：\n$$ f_c = |\\omega - \\Omega| \\sqrt{\\frac{\\lambda}{\\beta}} $$\n这个结果定义了阿诺德舌的边界。当 $f < f_c$ 时，不存在稳定的锁相解，系统表现出准周期行为（相位漂移）。当 $f \\ge f_c$ 时，同步是可能的。这个临界强度揭示了一种权衡关系：内禀频率与驱动频率的失谐越大（$|\\omega - \\Omega|$ 越大），或振子自身的极限环振幅越大（$r^*$ 越大），就需要更强的外部驱动力（更大的 $f$）来实现同步。",
            "answer": "$$\\boxed{|\\omega - \\Omega| \\sqrt{\\frac{\\lambda}{\\beta}}}$$"
        },
        {
            "introduction": "理论模型的威力只有在与真实世界数据相结合时才能完全展现。在临床和研究中，一个常见的挑战是如何通过少数且通常带有噪声的测量值来确定个体的内在昼夜节律相位。本实践  引入了贝叶斯推断框架来应对这一挑战。你将把褪黑素节律的数学模型与统计学原理相结合，来估算最可能的昼夜节律相位，并量化该估计的不确定性。这个编程练习将理论建模与实际数据分析联系起来，让你掌握在个性化医疗和时间生物学研究中至关重要的现代统计技术。",
            "id": "3883910",
            "problem": "您的任务是使用一个基于内分泌昼夜节律的生物医学系统建模的、有原则的概率模型，从三个唾液褪黑素浓度样本中估计褪黑素分泌的昼夜节律相位。假设昼夜节律振荡器可以很好地由褪黑素分泌的单个谐波分量来近似，并带有加性高斯测量噪声。建模的目标是推断振荡器的相位并量化其不确定性。\n\n假设褪黑素浓度的生成模型如下：\n对于观测时间 $t_1$、$t_2$ 和 $t_3$（以小时为单位），测得的褪黑素浓度 $y_1$、$y_2$ 和 $y_3$（以皮克/毫升，$\\mathrm{pg/mL}$ 为单位）被建模为\n$$\ny_i = B + A \\cos(\\omega t_i - \\phi) + \\epsilon_i,\\quad \\epsilon_i \\sim \\mathcal{N}(0,\\sigma^2),\\quad i \\in \\{1,2,3\\},\n$$\n其中，$B$ 是基线浓度（单位为 $\\mathrm{pg/mL}$），$A$ 是振荡幅度（单位为 $\\mathrm{pg/mL}$），$\\phi$ 是昼夜节律相位（一个以弧度为单位的角度），$\\sigma$ 是测量噪声的标准差（单位为 $\\mathrm{pg/mL}$），$\\omega$ 是由24小时的昼夜节律周期定义的角频率：\n$$\n\\omega = \\frac{2\\pi}{24}\\ \\text{弧度/小时}.\n$$\n假设相位 $\\phi$ 的先验分布是冯·米塞斯分布，其平均方向为 $\\mu$（以弧度为单位），集中参数为 $\\kappa$：\n$$\np(\\phi) \\propto \\exp\\!\\big(\\kappa \\cos(\\phi - \\mu)\\big).\n$$\n\n从适用于内分泌昼夜节律的生物医学系统建模的基本原理出发：\n- 周期性振荡器及其角频率的定义，周期为 $T$ 时关系为 $\\omega = 2\\pi/T$。\n- 测量误差的高斯噪声模型，其中 $\\epsilon \\sim \\mathcal{N}(0,\\sigma^2)$。\n- 用于结合似然和先验以形成后验分布 $p(\\phi\\mid y) \\propto p(y\\mid \\phi) p(\\phi)$ 的贝叶斯法则。\n\n推导 $\\phi$ 的后验分布，并通过最大化后验分布来计算最大后验估计 $\\hat{\\phi}$。通过使用拉普拉斯近似，在 $\\hat{\\phi}$ 处逼近对数后验的局部曲率来量化 $\\hat{\\phi}$ 的不确定性，将后验标准差 $\\sigma_\\phi$ 报告为\n$$\n\\sigma_\\phi \\approx \\sqrt{\\frac{1}{\\mathcal{H}}},\n$$\n其中 $\\mathcal{H}$ 是对数后验关于 $\\phi$ 的二阶导数在 $\\hat{\\phi}$ 处取值的负数。\n\n角度单位要求：所有角度，包括估计的相位 $\\hat{\\phi}$ 和报告的不确定性 $\\sigma_\\phi$，都必须以弧度表示。\n\n物理单位要求：褪黑素浓度以 $\\mathrm{pg/mL}$ 为单位，时间以小时为单位，角频率以弧度/小时为单位。\n\n实现一个程序，该程序：\n- 使用从高斯噪声模型导出的似然和上面定义的冯·米塞斯先验来构建 $\\phi$ 的对数后验函数。\n- 通过在区间 $[0,2\\pi)$ 上最大化对数后验来找到 $\\hat{\\phi}$。\n- 在 $\\hat{\\phi}$ 处使用对数后验的二阶导数有限差分近似来估算 $\\sigma_\\phi$。\n- 将每个测试用例的结果以 $[\\hat{\\phi}, \\sigma_\\phi]$ 对的形式返回。\n\n测试套件：\n为以下参数集提供结果（每个参数集包括时间 $t_i$（小时）、浓度 $y_i$（pg/mL）、振幅 $A$（pg/mL）、基线 $B$（pg/mL）、噪声标准差 $\\sigma$（pg/mL）、先验均值 $\\mu$（弧度）和先验集中度 $\\kappa$）。对于每种情况，取 $\\omega = 2\\pi/24$ 弧度/小时。\n\n- 情况1（典型的夜间采样，信息丰富的数据）：\n  - $t_1 = 22.0$, $t_2 = 2.0$, $t_3 = 6.0$。\n  - $y_1 = 38.0$, $y_2 = 55.0$, $y_3 = 26.0$。\n  - $A = 25.0$, $B = 30.0$, $\\sigma = 5.0$。\n  - $\\mu = \\omega \\cdot 2.0$, $\\kappa = 2.0$。\n\n- 情况2（午间采样，信息较弱的数据，先验影响后验）：\n  - $t_1 = 12.0$, $t_2 = 12.5$, $t_3 = 13.0$。\n  - $y_1 = 28.0$, $y_2 = 31.0$, $y_3 = 27.0$。\n  - $A = 25.0$, $B = 30.0$, $\\sigma = 8.0$。\n  - $\\mu = \\omega \\cdot 2.0$, $\\kappa = 1.5$。\n\n- 情况3（典型的夜间采样，高噪声，宽后验）：\n  - $t_1 = 22.0$, $t_2 = 2.0$, $t_3 = 6.0$。\n  - $y_1 = 60.0$, $y_2 = 20.0$, $y_3 = 45.0$。\n  - $A = 25.0$, $B = 30.0$, $\\sigma = 15.0$。\n  - $\\mu = \\omega \\cdot 2.0$, $\\kappa = 0.5$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。每个结果必须是针对一个测试用例的双元素列表 $[\\hat{\\phi}, \\sigma_\\phi]$，两者都以弧度表示。例如，输出应如下所示\n$$\n[\\,[\\hat{\\phi}_1,\\sigma_{\\phi,1}],\\,[\\hat{\\phi}_2,\\sigma_{\\phi,2}],\\,[\\hat{\\phi}_3,\\sigma_{\\phi,3}]\\,]\n$$\n打印行中不含空格。",
            "solution": "该问题要求从三个离散的浓度测量值中估计褪黑素分泌的昼夜节律相位 $\\phi$。这被构建为一个贝叶斯推断问题，我们寻求相位的最大后验（MAP）估计 $\\hat{\\phi}$ 及其不确定性的度量，即后验标准差 $\\sigma_\\phi$。解决方案的步骤是：首先定义统计模型，然后推导后验分布，最后详细说明用于优化和不确定性量化的数值方法。\n\n基本原理如下：\n1.  褪黑素昼夜节律的正弦模型：$y(t) = B + A \\cos(\\omega t - \\phi)$。\n2.  测量误差的加性高斯噪声模型：$\\epsilon \\sim \\mathcal{N}(0, \\sigma^2)$。\n3.  用于推断的贝叶斯法则：$p(\\phi \\mid \\mathbf{y}) \\propto p(\\mathbf{y} \\mid \\phi) p(\\phi)$。\n\n**1. 贝叶斯模型构建**\n\n第一步是构建在给定观测数据 $\\mathbf{y} = \\{y_1, y_2, y_3\\}$ 条件下相位 $\\phi$ 的后验概率分布。根据贝叶斯法则，后验分布与似然和先验的乘积成正比。\n\n**1.1. 似然函数，$p(\\mathbf{y} \\mid \\phi)$**\n在时间 $t_i$ 单个褪黑素浓度测量值 $y_i$ 的生成模型如下：\n$$\ny_i = B + A \\cos(\\omega t_i - \\phi) + \\epsilon_i\n$$\n项 $\\epsilon_i$ 代表测量噪声，假设其服从均值为零、方差为 $\\sigma^2$ 的高斯分布，即 $\\epsilon_i \\sim \\mathcal{N}(0, \\sigma^2)$。这意味着单个测量值 $y_i$ 在给定相位 $\\phi$ 条件下的概率分布也是高斯分布：\n$$\ny_i \\mid \\phi \\sim \\mathcal{N}\\big(B + A \\cos(\\omega t_i - \\phi), \\sigma^2\\big)\n$$\n因此，第 $i$ 次观测的概率密度函数（PDF）为：\n$$\np(y_i \\mid \\phi) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left( -\\frac{(y_i - [B + A \\cos(\\omega t_i - \\phi)])^2}{2\\sigma^2} \\right)\n$$\n假设在给定相位 $\\phi$ 的条件下，三次测量是条件独立的，那么数据向量 $\\mathbf{y}$ 的总似然是各个概率的乘积：\n$$\np(\\mathbf{y} \\mid \\phi) = \\prod_{i=1}^{3} p(y_i \\mid \\phi) = \\left(\\frac{1}{\\sqrt{2\\pi\\sigma^2}}\\right)^3 \\exp\\left( -\\frac{1}{2\\sigma^2} \\sum_{i=1}^{3} (y_i - B - A \\cos(\\omega t_i - \\phi))^2 \\right)\n$$\n\n**1.2. 先验分布，$p(\\phi)$**\n相位的先验分布 $p(\\phi)$ 概括了我们在观测数据之前对 $\\phi$ 的信念。问题指定了冯·米塞斯分布，这对于像相位角这样的环形数据是一个合适的选择。其概率密度函数（PDF）由下式给出：\n$$\np(\\phi) \\propto \\exp\\big(\\kappa \\cos(\\phi - \\mu)\\big)\n$$\n其中 $\\mu$ 是先验平均方向（我们对相位的先验最佳猜测），$\\kappa \\geq 0$ 是集中参数，表示我们先验信念的强度。较大的 $\\kappa$ 对应于更集中（更确定）的先验。\n\n**2. 对数后验分布**\n为了计算稳定性和数学上的便利，特别是在优化方面，我们使用后验分布的自然对数 $L(\\phi) = \\log p(\\phi \\mid \\mathbf{y})$。\n$$\nL(\\phi) = \\log(p(\\mathbf{y} \\mid \\phi) p(\\phi)) + C_0 = \\log p(\\mathbf{y} \\mid \\phi) + \\log p(\\phi) + C_0\n$$\n其中 $C_0$ 是一个不依赖于 $\\phi$ 的归一化常数。代入似然和先验的表达式，并舍去所有相对于 $\\phi$ 为常数的项，我们得到：\n$$\nL(\\phi) \\propto -\\frac{1}{2\\sigma^2} \\sum_{i=1}^{3} (y_i - B - A \\cos(\\omega t_i - \\phi))^2 + \\kappa \\cos(\\phi - \\mu)\n$$\n这个函数，即对数后验，表示任何给定相位 $\\phi$ 的相对后验概率。\n\n**3. 最大后验（MAP）估计**\nMAP 估计 $\\hat{\\phi}$ 是使后验概率最大化的 $\\phi$ 值，这等同于使对数后验函数最大化。\n$$\n\\hat{\\phi} = \\underset{\\phi \\in [0, 2\\pi)}{\\arg\\max} \\, L(\\phi)\n$$\n这个最大化问题没有简单的闭式解，必须通过数值方法求解。最大值的搜索在区间 $[0, 2\\pi)$ 上进行，代表所有可能的相位。在计算上，这是通过使用数值优化算法最小化负对数后验 $-L(\\phi)$ 来实现的。\n\n**4. 不确定性量化：拉普拉斯近似**\n估计 $\\hat{\\phi}$ 的不确定性由后验分布在其峰值周围的宽度来量化。拉普拉斯近似将后验分布建模为以 MAP 估计 $\\hat{\\phi}$ 为中心的高斯分布。这个近似高斯分布的方差作为我们不确定性的度量。\n\n对于一维参数 $\\phi$，后验分布近似为：\n$$\np(\\phi \\mid \\mathbf{y}) \\approx \\mathcal{N}(\\hat{\\phi}, \\mathcal{H}^{-1})\n$$\n其中 $\\mathcal{H}$ 是观测到的费雪信息，或者更简单地说，是在众数 $\\hat{\\phi}$ 处计算的对数后验二阶导数的负值：\n$$\n\\mathcal{H} = - \\frac{d^2 L(\\phi)}{d\\phi^2} \\Bigg|_{\\phi=\\hat{\\phi}}\n$$\n$\\mathcal{H}$ 的值衡量了对数后验在其峰值处的曲率；更大的曲率（更大的 $\\mathcal{H}$）意味着更尖锐的峰值，从而不确定性更低。\n\n问题指定使用有限差分格式来近似这个二阶导数。中心差分公式为：\n$$\n\\frac{d^2 L(\\phi)}{d\\phi^2} \\Bigg|_{\\phi=\\hat{\\phi}} \\approx \\frac{L(\\hat{\\phi}+h) - 2L(\\hat{\\phi}) + L(\\hat{\\phi}-h)}{h^2}\n$$\n对于一个小的步长 $h$。因此，$\\mathcal{H}$ 计算如下：\n$$\n\\mathcal{H} \\approx -\\frac{L(\\hat{\\phi}+h) - 2L(\\hat{\\phi}) + L(\\hat{\\phi}-h)}{h^2}\n$$\n后验方差为 $\\sigma_\\phi^2 \\approx 1/\\mathcal{H}$，而标准差，即所期望的不确定性度量，是：\n$$\n\\sigma_\\phi \\approx \\sqrt{\\frac{1}{\\mathcal{H}}}\n$$\n\n**计算流程总结：**\n对于每个测试用例：\n1.  使用提供的参数（$t_i$, $y_i$, $A$, $B$, $\\sigma$, $\\mu$, $\\kappa$）为负对数后验 $-L(\\phi)$ 定义一个函数。\n2.  使用有界数值最小化器（例如 `scipy.optimize.minimize_scalar`）在区间 $[0, 2\\pi)$ 中找到 $\\hat{\\phi}$。\n3.  对于一个小的 $h$（例如 $10^{-5}$），在 $\\hat{\\phi}$、$\\hat{\\phi}+h$ 和 $\\hat{\\phi}-h$ 处评估负对数后验函数。\n4.  使用这些值计算负对数后验的二阶导数，这是我们对 $\\mathcal{H}$ 的估计。\n5.  计算后验标准差为 $\\sigma_\\phi = 1/\\sqrt{\\mathcal{H}}$。\n6.  返回数据对 $[\\hat{\\phi}, \\sigma_\\phi]$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Solves for the MAP estimate and uncertainty of the circadian phase for given test cases.\n    \"\"\"\n    \n    # Define the constant angular frequency\n    omega = 2 * np.pi / 24.0\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (typical nocturnal sampling, informative data)\n        {\n            \"t\": [22.0, 2.0, 6.0], \"y\": [38.0, 55.0, 26.0],\n            \"A\": 25.0, \"B\": 30.0, \"sigma\": 5.0,\n            \"mu\": omega * 2.0, \"kappa\": 2.0\n        },\n        # Case 2 (midday sampling, weakly informative data)\n        {\n            \"t\": [12.0, 12.5, 13.0], \"y\": [28.0, 31.0, 27.0],\n            \"A\": 25.0, \"B\": 30.0, \"sigma\": 8.0,\n            \"mu\": omega * 2.0, \"kappa\": 1.5\n        },\n        # Case 3 (typical nocturnal sampling, high noise)\n        {\n            \"t\": [22.0, 2.0, 6.0], \"y\": [60.0, 20.0, 45.0],\n            \"A\": 25.0, \"B\": 30.0, \"sigma\": 15.0,\n            \"mu\": omega * 2.0, \"kappa\": 0.5\n        }\n    ]\n\n    results = []\n    h = 1e-5  # Step size for finite difference approximation\n\n    for case in test_cases:\n        t = np.array(case[\"t\"])\n        y = np.array(case[\"y\"])\n        A = case[\"A\"]\n        B = case[\"B\"]\n        sigma = case[\"sigma\"]\n        mu = case[\"mu\"]\n        kappa = case[\"kappa\"]\n\n        def neg_log_posterior(phi):\n            \"\"\"\n            Computes the negative of the log-posterior for a given phase phi.\n            The function is defined as - (log_likelihood + log_prior).\n            Constants independent of phi are ignored.\n            \"\"\"\n            # Likelihood term\n            model_predictions = B + A * np.cos(omega * t - phi)\n            sum_sq_errors = np.sum(((y - model_predictions) / sigma) ** 2)\n            log_likelihood = -0.5 * sum_sq_errors\n            \n            # Prior term\n            log_prior = kappa * np.cos(phi - mu)\n            \n            # Negative log posterior to be minimized\n            return -(log_likelihood + log_prior)\n\n        # Find the MAP estimate by minimizing the negative log-posterior\n        # over the interval [0, 2*pi).\n        opt_result = minimize_scalar(\n            neg_log_posterior, \n            bounds=(0, 2 * np.pi), \n            method='bounded'\n        )\n        phi_hat = opt_result.x\n\n        # Calculate the Hessian (H) using a central finite-difference approximation\n        # of the second derivative of the function we minimized (neg_log_posterior).\n        # H = f''(x_min) approx (f(x_min+h) - 2f(x_min) + f(x_min-h)) / h^2\n        f_val_at_min = opt_result.fun\n        f_val_plus_h = neg_log_posterior(phi_hat + h)\n        f_val_minus_h = neg_log_posterior(phi_hat - h)\n        \n        hessian = (f_val_plus_h - 2 * f_val_at_min + f_val_minus_h) / (h ** 2)\n\n        # The posterior standard deviation sigma_phi is sqrt(1/H).\n        # We check for hessian > 0 to ensure we are at a minimum and variance is positive.\n        if hessian > 0:\n            sigma_phi = np.sqrt(1.0 / hessian)\n        else:\n            # This case indicates a problem (e.g., optimization failed, flat posterior)\n            # and results in undefined or infinite uncertainty.\n            sigma_phi = np.inf\n        \n        results.append([phi_hat, sigma_phi])\n\n    # Format the final output string exactly as specified, with no spaces.\n    results_str_parts = [f\"[{res[0]},{res[1]}]\" for res in results]\n    final_output_str = f\"[{','.join(results_str_parts)}]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}