{
    "hands_on_practices": [
        {
            "introduction": "本章的第一个实践练习将从最基本的构件开始：为心肌细胞中的一个微域（即二联管腔隙）的钙离子浓度建立模型。这个练习要求我们基于质量守恒和扩散等第一性原理，推导并求解一个简单的一阶常微分方程 (ODE)。通过这个过程，你将掌握将生物物理原理转化为数学模型并进行求解的基础技能，这是所有生物物理建模工作的基石。",
            "id": "3942844",
            "problem": "你需要使用单室常微分方程，在快速缓冲近似下，对心室肌细胞中的二联管腔亚空间钙离子浓度进行建模。目标是计算当L型钙电流（LCC）$I_{\\mathrm{Ca,L}}(t)$ 是持续时间为 $\\tau$ 的方波脉冲时，二联管腔钙离子浓度 $[\\mathrm{Ca}]_{\\mathrm{dyad}}(t)$ 的时间进程。该模型必须从第一性原理推导，并实现为一个程序，该程序能根据给定的测试参数套件，在指定时间点计算 $[\\mathrm{Ca}]_{\\mathrm{dyad}}(t)$ 的值。\n\n基本原理和假设：\n- 控制体积内的质量守恒：摩尔数的变化率等于流入量减去流出量。\n- 用于离子通量的Faraday定律：由化合价为 $z$ 的离子携带的离子电流 $I$ 所关联的摩尔流入通量为 $J_{\\mathrm{in}} = -I/(z F)$，其中 $F$ 是Faraday常数。\n- Fick扩散定律，近似为二联管腔和肌浆之间的一维平板：从二联管腔扩散出的通量为 $J_{\\mathrm{diff}} = \\dfrac{D_{\\mathrm{Ca}} A}{L} \\left([\\mathrm{Ca}]_{\\mathrm{dyad}} - [\\mathrm{Ca}]_{i}\\right)$，其中 $D_{\\mathrm{Ca}}$ 是扩散系数，$A$ 是有效交换面积，$L$ 是特征扩散长度，$[\\mathrm{Ca}]_{i}$ 是（假定恒定的）肌浆钙离子浓度。\n- 快速缓冲近似（RBA）：快速缓冲剂被假定处于快速平衡状态，产生一个有效缓冲容量因子 $(1+\\kappa)$，该因子用于缩放游离钙的时间导数。\n- L型钙电流 $I_{\\mathrm{Ca,L}}(t)$ 在 $0 \\le t  \\tau$ 期间是一个振幅为 $I_{0}$ 的方波脉冲，在 $t \\ge \\tau$ 时为 $0$。使用生理学符号约定，即 $I_{0}  0$ 表示内向电流，这会增加 $[\\mathrm{Ca}]_{\\mathrm{dyad}}$。\n- 二联管腔被视为一个体积为 $V_{\\mathrm{dyad}}$ 的充分混合隔室。\n- 静息状态下肌浆钙离子浓度恒定：$[\\mathrm{Ca}]_{i} = 0.1\\,\\mu\\mathrm{M}$。\n\n需要实现的推导目标：\n- 从上述原理出发，写出二联管腔中考虑了 $J_{\\mathrm{in}}$ 和 $J_{\\mathrm{diff}}$ 的钙离子平衡方程，除以二联管腔体积 $V_{\\mathrm{dyad}}$，并引入缓冲容量因子 $(1+\\kappa)$，从而得到一个关于 $[\\mathrm{Ca}]_{\\mathrm{dyad}}(t)$ 的一阶线性常微分方程。该方程在脉冲期间由常数输入驱动，之后驱动项为零，呈分段特性。\n- 钙离子的化合价使用 $z=2$，Faraday常数使用 $F = 96485\\,\\mathrm{C/mol}$。\n- 用于二联管腔到肌浆交换的几何常数固定为 $A = 0.04\\,\\mu\\mathrm{m}^{2}$ 和 $L = 0.2\\,\\mu\\mathrm{m}$，在计算中你必须将它们转换为 $\\mathrm{m}^{2}$ 和 $\\mathrm{m}$。\n\n初始条件：\n- $[\\mathrm{Ca}]_{\\mathrm{dyad}}(0) = [\\mathrm{Ca}]_{i}$。\n\n单位要求和输出规格：\n- 所有计算必须使用国际单位制（SI units）进行。最终报告的 $[\\mathrm{Ca}]_{\\mathrm{dyad}}$ 必须以微摩尔浓度（$\\mu\\mathrm{M}$）表示，并四舍五入到六位小数的浮点数。\n- 对每个测试用例，在时间点 $t = 0.001\\,\\mathrm{s}$、$t = 0.005\\,\\mathrm{s}$ 和 $t = 0.020\\,\\mathrm{s}$ 处计算 $[\\mathrm{Ca}]_{\\mathrm{dyad}}(t)$ 的值。\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个条目对应一个测试用例，其本身是一个包含三个数值（单位为 $\\mu\\mathrm{M}$，对应指定时间点）的列表。例如，一个有效的输出格式为 $[[x_{11},x_{12},x_{13}],[x_{21},x_{22},x_{23}],[x_{31},x_{32},x_{33}]]$.\n\n测试套件：\n- 使用以下参数集；除非另有说明，所有量均采用国际单位制。对于每个用例，$I_{\\mathrm{Ca,L}}(t)$ 是一个从 $t=0$ 到 $t=\\tau$ 振幅为 $I_{0}$ 的方波脉冲，此后为零。\n\n1) 正常路径用例：\n   - $I_{0} = -5 \\times 10^{-13}\\,\\mathrm{A}$，\n   - $\\tau = 0.005\\,\\mathrm{s}$，\n   - $V_{\\mathrm{dyad}} = 2 \\times 10^{-20}\\,\\mathrm{m}^{3}$，\n   - $D_{\\mathrm{Ca}} = 2 \\times 10^{-10}\\,\\mathrm{m}^{2}/\\mathrm{s}$，\n   - $\\kappa = 30$。\n\n2) 边界用例（无脉冲）：\n   - $I_{0} = -5 \\times 10^{-13}\\,\\mathrm{A}$，\n   - $\\tau = 0.000\\,\\mathrm{s}$，\n   - $V_{\\mathrm{dyad}} = 2 \\times 10^{-20}\\,\\mathrm{m}^{3}$，\n   - $D_{\\mathrm{Ca}} = 2 \\times 10^{-10}\\,\\mathrm{m}^{2}/\\mathrm{s}$，\n   - $\\kappa = 30$。\n\n3) 边缘用例（慢交换，无缓冲）：\n   - $I_{0} = -5 \\times 10^{-13}\\,\\mathrm{A}$，\n   - $\\tau = 0.005\\,\\mathrm{s}$，\n   - $V_{\\mathrm{dyad}} = 2 \\times 10^{-20}\\,\\mathrm{m}^{3}$，\n   - $D_{\\mathrm{Ca}} = 1 \\times 10^{-12}\\,\\mathrm{m}^{2}/\\mathrm{s}$，\n   - $\\kappa = 0$。\n\n答案类型：\n- 对于每个测试用例，返回一个包含三个浮点数的列表（单位为 $\\mu\\mathrm{M}$），分别对应于 $t = 0.001\\,\\mathrm{s}$、$t = 0.005\\,\\mathrm{s}$ 和 $t = 0.020\\,\\mathrm{s}$。",
            "solution": "该问题旨在确定心室肌细胞在受到L型钙电流 $I_{\\mathrm{Ca,L}}(t)$ 方波脉冲作用下，其二联管腔钙离子浓度 $[\\mathrm{Ca}]_{\\mathrm{dyad}}(t)$ 的时间进程。该模型是一个从第一性原理推导出的单室常微分方程。\n\n### 步骤1：问题验证\n\n**1.1. 提取给定条件**\n- **控制原理**：\n  - 质量守恒：$\\text{摩尔数的变化率} = \\text{流入量} - \\text{流出量}$。\n  - 电流产生的离子通量：$J_{\\mathrm{in}} = -I/(z F)$，其中 $I$ 是离子电流，$z$ 是化合价，$F$ 是Faraday常数。\n  - 扩散通量（Fick定律近似）：$J_{\\mathrm{diff}} = \\frac{D_{\\mathrm{Ca}} A}{L} ([\\mathrm{Ca}]_{\\mathrm{dyad}} - [\\mathrm{Ca}]_{i})$。\n- **假设**：\n  - 二联管腔是一个体积为 $V_{\\mathrm{dyad}}$ 的充分混合隔室。\n  - 快速缓冲近似（RBA）适用，引入了一个缓冲容量因子 $(1+\\kappa)$。\n  - 肌浆钙离子浓度恒定：$[\\mathrm{Ca}]_{i} = 0.1\\,\\mu\\mathrm{M}$。\n- **输入驱动函数**：\n  - L型钙电流 $I_{\\mathrm{Ca,L}}(t)$ 是一个方波脉冲：\n    $I_{\\mathrm{Ca,L}}(t) = I_{0}$ 对于 $0 \\le t  \\tau$（$I_0  0$ 表示内向电流）。\n    $I_{\\mathrm{Ca,L}}(t) = 0$ 对于 $t \\ge \\tau$。\n- **常数**：\n  - 钙离子化合价：$z = 2$。\n  - Faraday常数：$F = 96485\\,\\mathrm{C/mol}$。\n  - 扩散交换面积：$A = 0.04\\,\\mu\\mathrm{m}^{2}$。\n  - 扩散长度：$L = 0.2\\,\\mu\\mathrm{m}$。\n- **初始条件**：\n  - 在时间 $t=0$ 时，$[\\mathrm{Ca}]_{\\mathrm{dyad}}(0) = [\\mathrm{Ca}]_{i}$。\n- **测试套件参数**：\n  - 用例1：$I_{0} = -5 \\times 10^{-13}\\,\\mathrm{A}$, $\\tau = 0.005\\,\\mathrm{s}$, $V_{\\mathrm{dyad}} = 2 \\times 10^{-20}\\,\\mathrm{m}^{3}$, $D_{\\mathrm{Ca}} = 2 \\times 10^{-10}\\,\\mathrm{m}^{2}/\\mathrm{s}$, $\\kappa = 30$。\n  - 用例2：$I_{0} = -5 \\times 10^{-13}\\,\\mathrm{A}$, $\\tau = 0.000\\,\\mathrm{s}$, $V_{\\mathrm{dyad}} = 2 \\times 10^{-20}\\,\\mathrm{m}^{3}$, $D_{\\mathrm{Ca}} = 2 \\times 10^{-10}\\,\\mathrm{m}^{2}/\\mathrm{s}$, $\\kappa = 30$。\n  - 用例3：$I_{0} = -5 \\times 10^{-13}\\,\\mathrm{A}$, $\\tau = 0.005\\,\\mathrm{s}$, $V_{\\mathrm{dyad}} = 2 \\times 10^{-20}\\,\\mathrm{m}^{3}$, $D_{\\mathrm{Ca}} = 1 \\times 10^{-12}\\,\\mathrm{m}^{2}/\\mathrm{s}$, $\\kappa = 0$。\n- **输出要求**：\n  - 在 $t = 0.001\\,\\mathrm{s}$、$t = 0.005\\,\\mathrm{s}$ 和 $t = 0.020\\,\\mathrm{s}$ 时刻计算 $[\\mathrm{Ca}]_{\\mathrm{dyad}}(t)$。\n  - 以微摩尔浓度（$\\mu\\mathrm{M}$）报告结果，四舍五入到六位小数。\n  - 最终输出为包含列表的列表的单行字符串。\n  - 所有计算必须使用国际单位制（SI units）。\n\n**1.2. 验证与结论**\n该问题是**有效的**。\n- 它在生物物理学的既定原理（质量守恒、电扩散）上具有**科学依据**。快速缓冲近似是此类模型中标准的简化假设。\n- 它是**适定的**，描述了一个带分段常数驱动项和指定初始条件的一阶线性常微分方程，这保证了唯一且稳定的解。\n- 语言是**客观**和精确的。\n- 设置是**完整且一致的**，提供了推导和求解模型所需的所有常数、初始条件和参数。\n- 对于心肌细胞微区的生理环境，这些值是**现实的**。\n- 该问题需要进行不平凡的推导和求解，因此它不是一个**伪深刻或同义反复的**问题。\n\n### 步骤2：控制方程和解的推导\n\n**2.1. ODE的构建**\n令 $N_{\\mathrm{Ca, tot}}(t)$ 为二联管腔体积 $V_{\\mathrm{dyad}}$ 中钙离子的总摩尔数（游离加缓冲）。根据质量守恒原理，其变化率是流入该体积的摩尔通量之和：\n$$\n\\frac{d N_{\\mathrm{Ca, tot}}}{dt} = J_{\\mathrm{in}}(t) - J_{\\mathrm{diff}}(t)\n$$\n快速缓冲近似表明，总钙离子浓度 $[\\mathrm{Ca}]_{\\mathrm{tot}}$ 与游离钙离子浓度 $[\\mathrm{Ca}]_{\\mathrm{dyad}}$ 成正比变化，比例因子为 $(1+\\kappa)$。因此，$N_{\\mathrm{Ca, tot}} = (1+\\kappa)[\\mathrm{Ca}]_{\\mathrm{dyad}} V_{\\mathrm{dyad}}$。其变化率为：\n$$\n\\frac{d N_{\\mathrm{Ca, tot}}}{dt} = (1+\\kappa) V_{\\mathrm{dyad}} \\frac{d[\\mathrm{Ca}]_{\\mathrm{dyad}}}{dt}\n$$\n通量由下式给出：\n- 来自L型钙电流 $I_{\\mathrm{Ca,L}}(t)$ 的流入通量：$J_{\\mathrm{in}}(t) = \\frac{-I_{\\mathrm{Ca,L}}(t)}{zF}$。负号是为了校正内向阳离子电流为负的约定。\n- 向肌浆的扩散流出通量：$J_{\\mathrm{diff}}(t) = \\frac{D_{\\mathrm{Ca}} A}{L} ([\\mathrm{Ca}]_{\\mathrm{dyad}}(t) - [\\mathrm{Ca}]_{i})$。\n\n将这些代入质量平衡方程得到：\n$$\n(1+\\kappa) V_{\\mathrm{dyad}} \\frac{d[\\mathrm{Ca}]_{\\mathrm{dyad}}}{dt} = \\frac{-I_{\\mathrm{Ca,L}}(t)}{zF} - \\frac{D_{\\mathrm{Ca}} A}{L} ([\\mathrm{Ca}]_{\\mathrm{dyad}}(t) - [\\mathrm{Ca}]_{i})\n$$\n等式两边除以 $(1+\\kappa)V_{\\mathrm{dyad}}$ 并重新整理各项，得到标准形式 $\\frac{dy}{dt} + P(t)y = Q(t)$ 的一阶线性ODE。令 $y(t) = [\\mathrm{Ca}]_{\\mathrm{dyad}}(t)$:\n$$\n\\frac{dy}{dt} + \\left( \\frac{D_{\\mathrm{Ca}} A}{L V_{\\mathrm{dyad}}(1+\\kappa)} \\right) y = \\frac{-I_{\\mathrm{Ca,L}}(t)}{zF V_{\\mathrm{dyad}}(1+\\kappa)} + \\left( \\frac{D_{\\mathrm{Ca}} A}{L V_{\\mathrm{dyad}}(1+\\kappa)} \\right) [\\mathrm{Ca}]_{i}\n$$\n为简化起见，我们定义两个常数：\n- 钙离子交换的速率常数 $\\alpha$：$\\alpha = \\frac{D_{\\mathrm{Ca}} A}{L V_{\\mathrm{dyad}}(1+\\kappa)}$。其单位是 $\\mathrm{s}^{-1}$。\n- 由电流引起的驱动项 $\\beta(t)$：$\\beta(t) = \\frac{-I_{\\mathrm{Ca,L}}(t)}{zF V_{\\mathrm{dyad}}(1+\\kappa)}$。\nODE变为：\n$$\n\\frac{dy}{dt} + \\alpha y(t) = \\beta(t) + \\alpha [\\mathrm{Ca}]_{i}\n$$\n\n**2.2. ODE的求解**\n该ODE针对输入电流 $I_{\\mathrm{Ca,L}}(t)$ 的两个阶段进行分段求解。对于形式为 $\\frac{dy}{dt} + \\alpha y = C$ 的方程，其通解为 $y(t) = \\frac{C}{\\alpha} + \\left(y(t_0) - \\frac{C}{\\alpha}\\right) e^{-\\alpha (t-t_0)}$。\n\n**阶段1：脉冲开启 ($0 \\le t  \\tau$)**\n在此期间，$I_{\\mathrm{Ca,L}}(t) = I_0$，是一个常数。驱动项 $\\beta(t)$ 也是常数，$\\beta_0 = \\frac{-I_0}{zF V_{\\mathrm{dyad}}(1+\\kappa)}$。ODE是：\n$$\n\\frac{dy}{dt} + \\alpha y = \\beta_0 + \\alpha [\\mathrm{Ca}]_{i}\n$$\n$y(t)$ 松弛趋向的稳态解 ($y_{\\infty,1}$) 为：\n$$\ny_{\\infty,1} = \\frac{\\beta_0 + \\alpha [\\mathrm{Ca}]_{i}}{\\alpha} = \\frac{\\beta_0}{\\alpha} + [\\mathrm{Ca}]_{i} = \\frac{-I_0 L}{zF D_{\\mathrm{Ca}} A} + [\\mathrm{Ca}]_{i}\n$$\n我们定义常数 $K = \\frac{-I_0 L}{zF D_{\\mathrm{Ca}} A}$。则 $y_{\\infty,1} = K + [\\mathrm{Ca}]_{i}$。\n从初始条件 $y(0) = [\\mathrm{Ca}]_{i}$ 出发的解是：\n$$\ny(t) = y_{\\infty,1} + (y(0) - y_{\\infty,1})e^{-\\alpha t} = (K + [\\mathrm{Ca}]_{i}) + ([\\mathrm{Ca}]_{i} - (K + [\\mathrm{Ca}]_{i}))e^{-\\alpha t}\n$$\n$$\n[\\mathrm{Ca}]_{\\mathrm{dyad}}(t) = [\\mathrm{Ca}]_{i} + K(1 - e^{-\\alpha t}), \\quad \\text{对于 } 0 \\le t  \\tau\n$$\n\n**阶段2：脉冲关闭 ($t \\ge \\tau$)**\n在此期间，$I_{\\mathrm{Ca,L}}(t) = 0$，所以 $\\beta(t) = 0$。ODE是：\n$$\n\\frac{dy}{dt} + \\alpha y = \\alpha [\\mathrm{Ca}]_{i}\n$$\n稳态解 ($y_{\\infty,2}$) 是 $y_{\\infty,2} = \\frac{\\alpha [\\mathrm{Ca}]_{i}}{\\alpha} = [\\mathrm{Ca}]_{i}$。\n解从 $t=\\tau$ 开始，初始条件是阶段1结束时的浓度 $y(\\tau)$。\n$$\ny(\\tau) = [\\mathrm{Ca}]_{i} + K(1 - e^{-\\alpha \\tau})\n$$\n对于 $t \\ge \\tau$ 的解是：\n$$\ny(t) = y_{\\infty,2} + (y(\\tau) - y_{\\infty,2})e^{-\\alpha (t-\\tau)}\n$$\n$$\n[\\mathrm{Ca}]_{\\mathrm{dyad}}(t) = [\\mathrm{Ca}]_{i} + ([\\mathrm{Ca}]_{i} + K(1 - e^{-\\alpha \\tau}) - [\\mathrm{Ca}]_{i})e^{-\\alpha (t-\\tau)}\n$$\n$$\n[\\mathrm{Ca}]_{\\mathrm{dyad}}(t) = [\\mathrm{Ca}]_{i} + K(1 - e^{-\\alpha \\tau})e^{-\\alpha (t-\\tau)}, \\quad \\text{对于 } t \\ge \\tau\n$$\n\n**2.3. 单位换算**\n所有计算必须使用国际单位制（SI units）。浓度的基本单位是 $\\mathrm{mol}/\\mathrm{m}^3$。给定和要求的单位是微摩尔浓度（$\\mu\\mathrm{M}$），其中 $1\\,\\mathrm{M} = 1\\,\\mathrm{mol}/\\mathrm{L}$。\n- $1\\,\\mathrm{m}^3 = 1000\\,\\mathrm{L}$，所以 $1\\,\\mathrm{mol}/\\mathrm{m}^3 = 10^{-3}\\,\\mathrm{M}$。\n- $1\\,\\mu\\mathrm{M} = 10^{-6}\\,\\mathrm{M}$。\n- 因此，$1\\,\\mathrm{mol}/\\mathrm{m}^3 = 10^{-3} / 10^{-6} \\,\\mu\\mathrm{M} = 1000\\,\\mu\\mathrm{M}$。\n- 要将SI单位（$\\mathrm{mol}/\\mathrm{m}^3$）转换为 $\\mu\\mathrm{M}$，我们需要乘以 $10^3$。\n- 反之，要将 $\\mu\\mathrm{M}$ 转换为 $\\mathrm{mol}/\\mathrm{m}^3$，我们需要乘以 $10^{-3}$。\n- $[\\mathrm{Ca}]_{i} = 0.1\\,\\mu\\mathrm{M} = 0.1 \\times 10^{-3} \\,\\mathrm{mol}/\\mathrm{m}^3 = 10^{-4}\\,\\mathrm{mol}/\\mathrm{m}^3$。\n- 几何常数必须转换为米：\n  - $A = 0.04\\,\\mu\\mathrm{m}^2 = 0.04 \\times (10^{-6}\\,\\mathrm{m})^2 = 4 \\times 10^{-14}\\,\\mathrm{m}^2$。\n  - $L = 0.2\\,\\mu\\mathrm{m} = 0.2 \\times 10^{-6}\\,\\mathrm{m} = 2 \\times 10^{-7}\\,\\mathrm{m}$。\n\n上面推导的解析解在下面的程序中实现，用于计算指定测试用例和时间点下的二联管腔钙离子浓度。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the dyadic calcium concentration in a ventricular myocyte\n    using a single-compartment ODE model under the rapid buffer approximation.\n    \"\"\"\n\n    # --- Fixed constants in SI units ---\n    F_CONST = 96485.0  # Faraday constant (C/mol)\n    Z_CA = 2.0  # Valence of Calcium\n    \n    # Geometric constants converted to SI units (m)\n    AREA_EXCHANGE = 0.04e-12  # Exchange area (m^2), from 0.04 um^2\n    DIFFUSION_LENGTH = 0.2e-6  # Diffusion length (m), from 0.2 um\n    \n    # Myoplasmic calcium concentration converted to SI units (mol/m^3)\n    # 0.1 uM = 0.1e-6 mol/L = 0.1e-6 * 1000 mol/m^3 = 1e-4 mol/m^3\n    CA_I = 1.0e-4  # Myoplasmic Ca concentration (mol/m^3)\n    \n    # Evaluation times in seconds\n    EVALUATION_TIMES = [0.001, 0.005, 0.020]\n\n    # --- Test suite definition ---\n    test_cases = [\n        # Case 1: Happy-path case\n        {\n            \"I0\": -5.0e-13,      # A\n            \"tau\": 0.005,       # s\n            \"V_dyad\": 2.0e-20,  # m^3\n            \"D_Ca\": 2.0e-10,    # m^2/s\n            \"kappa\": 30.0\n        },\n        # Case 2: Boundary case (no pulse)\n        {\n            \"I0\": -5.0e-13,\n            \"tau\": 0.000,\n            \"V_dyad\": 2.0e-20,\n            \"D_Ca\": 2.0e-10,\n            \"kappa\": 30.0\n        },\n        # Case 3: Edge case (slow exchange, no buffering)\n        {\n            \"I0\": -5.0e-13,\n            \"tau\": 0.005,\n            \"V_dyad\": 2.0e-20,\n            \"D_Ca\": 1.0e-12,\n            \"kappa\": 0.0\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        I0 = case[\"I0\"]\n        tau = case[\"tau\"]\n        V_dyad = case[\"V_dyad\"]\n        D_Ca = case[\"D_Ca\"]\n        kappa = case[\"kappa\"]\n\n        # --- Calculate derived model parameters ---\n        \n        # Rate constant alpha (s^-1)\n        # alpha = (D_Ca * A) / (L * V_dyad * (1 + kappa))\n        alpha = (D_Ca * AREA_EXCHANGE) / (DIFFUSION_LENGTH * V_dyad * (1.0 + kappa))\n\n        # Peak concentration change factor K (mol/m^3)\n        # K = (-I0 * L) / (z * F * D_Ca * A)\n        K = (-I0 * DIFFUSION_LENGTH) / (Z_CA * F_CONST * D_Ca * AREA_EXCHANGE)\n\n        case_results = []\n        for t in EVALUATION_TIMES:\n            ca_dyad_si = 0.0  # Concentration in mol/m^3\n\n            if t  tau:\n                # Phase 1: Pulse is ON\n                # [Ca]_dyad(t) = [Ca]_i + K * (1 - exp(-alpha * t))\n                ca_dyad_si = CA_I + K * (1.0 - np.exp(-alpha * t))\n            else:\n                # Phase 2: Pulse is OFF\n                # [Ca]_dyad(t) = [Ca]_i + K * (1 - exp(-alpha * tau)) * exp(-alpha * (t - tau))\n                if tau == 0.0:\n                    # If pulse duration is zero, concentration remains at baseline\n                    ca_dyad_si = CA_I\n                else:\n                    term1 = K * (1.0 - np.exp(-alpha * tau))\n                    term2 = np.exp(-alpha * (t - tau))\n                    ca_dyad_si = CA_I + term1 * term2\n            \n            # Convert concentration from SI units (mol/m^3) to micromolar (uM)\n            # 1 mol/m^3 = 1000 uM\n            ca_dyad_uM = ca_dyad_si * 1000.0\n            \n            # Round to six decimal places as required\n            case_results.append(round(ca_dyad_uM, 6))\n        \n        all_results.append(case_results)\n\n    # --- Format output string ---\n    # Convert each inner list to its string representation without spaces\n    str_results = [str(res).replace(\" \", \"\") for res in all_results]\n    # Join the string representations with commas and enclose in brackets\n    final_output_str = f\"[{','.join(str_results)}]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了如何为钙离子瞬变过程建模后，我们将更进一步，利用这一信号来预测一个关键的生理输出——心肌细胞的收缩力。此实践将指导你整合一个耦合常微分方程系统，该系统描述了钙离子与肌钙蛋白的结合如何引发横桥循环并最终产生力。这个练习旨在展示如何通过连接不同的分子事件模型来构建更复杂的系统，从而阐明从分子到细胞功能的联系。",
            "id": "3942851",
            "problem": "要求您设计并实现一个程序，该程序使用一个基于生物物理的钙调控横桥模型来计算心室肌细胞的等长收缩力响应，并将模型计算出的峰值力与实验报告的峰值力值进行比较。该模型必须从基本反应动力学和机械性横桥循环出发，并且必须使用一个长度依赖的重叠因子来反映肌小节的力-长度关系。该程序必须求解由提供的测量钙瞬变驱动的控制性常微分方程（ODE），计算产生的力-时间进程，提取峰值力，并报告与实验峰值力的绝对差值。所有输出必须以千帕（kPa）为单位表示，并汇总为打印在一行上的单个列表。\n\n从以下基本基础开始：\n\n- 钙与肌钙蛋白C（TnC）结合的质量作用定律：令 $A(t)$ 为细肌丝上因钙结合而处于“激活”状态的调节位点的分数。其动力学由以下公式给出\n$$\n\\frac{dA}{dt} = k_{\\mathrm{on}}\\,[\\mathrm{Ca}^{2+}](t)\\,\\big(1 - A(t)\\big) - k_{\\mathrm{off}}\\,A(t),\n$$\n其中 $k_{\\mathrm{on}}$ 是钙结合速率常数，单位为 $\\mu\\mathrm{M}^{-1}\\,\\mathrm{s}^{-1}$；$k_{\\mathrm{off}}$ 是解离速率常数，单位为 $\\mathrm{s}^{-1}$；$[\\mathrm{Ca}^{2+}](t)$ 是测量的胞浆钙浓度，单位为 $\\mu\\mathrm{M}$。\n\n- 两态横桥（XB）循环模型：令 $x(t)$ 为处于附着、产生力状态的肌球蛋白头部的分数。其动力学由以下公式给出\n$$\n\\frac{dx}{dt} = f_{\\mathrm{attach}}(t)\\,\\big(1 - x(t)\\big) - g_{\\mathrm{detach}}\\,x(t),\n$$\n其中附着速率为 $f_{\\mathrm{attach}}(t) = k_f\\,A(t)\\,\\gamma(\\mathrm{SL})$，脱离速率为 $g_{\\mathrm{detach}} = k_g$。$k_f$ 和 $k_g$ 的单位均为 $\\mathrm{s}^{-1}$，$\\gamma(\\mathrm{SL})$ 是一个捕捉肌小节长度依赖性的无量纲重叠因子。\n\n- 长度依赖的重叠因子：使用为肌小节长度 $\\mathrm{SL}$（单位为 $\\mu\\mathrm{m}$）定义的分段线性重叠因子 $\\gamma(\\mathrm{SL})$：\n$$\n\\gamma(\\mathrm{SL}) =\n\\begin{cases}\n0,  \\mathrm{SL} \\le 1.6, \\\\\n\\dfrac{\\mathrm{SL} - 1.6}{2.2 - 1.6},  1.6  \\mathrm{SL}  2.2, \\\\\n1 - \\dfrac{\\mathrm{SL} - 2.2}{2.6 - 2.2},  2.2 \\le \\mathrm{SL}  2.6, \\\\\n0,  \\mathrm{SL} \\ge 2.6.\n\\end{cases}\n$$\n\n- 等长条件下的力计算：瞬时等长收缩力为\n$$\nF(t) = F_{\\max}\\,x(t)\\,\\gamma(\\mathrm{SL}),\n$$\n其中 $F_{\\max}$ 是最大可能等长力（在 $\\gamma(\\mathrm{SL}) = 1$ 和 $x(t)=1$ 时），单位为 $\\mathrm{kPa}$。\n\n测量的钙瞬变应以双指数波形的形式提供，该波形形状旨在反映实验记录，并随时间采样。对于时间 $t$（单位为秒），定义瞬变为\n$$\n[\\mathrm{Ca}^{2+}](t) = C_{\\mathrm{rest}} + H(t - t_0)\\,A_{\\mathrm{Ca}}\\,\\left(e^{-\\frac{t - t_0}{\\tau_{\\mathrm{decay}}}} - e^{-\\frac{t - t_0}{\\tau_{\\mathrm{rise}}}}\\right),\n$$\n其中 $C_{\\mathrm{rest}}$ 是静息钙浓度，单位为 $\\mu\\mathrm{M}$；$A_{\\mathrm{Ca}}$ 是振幅，单位为 $\\mu\\mathrm{M}$；$t_0$ 是起始时间，单位为 $\\mathrm{s}$；$\\tau_{\\mathrm{rise}}$ 是上升时间常数，单位为 $\\mathrm{s}$；$\\tau_{\\mathrm{decay}}$ 是衰减时间常数，单位为 $\\mathrm{s}$；$H(\\cdot)$ 是亥维赛阶跃函数。瞬变必须在 $[0,1]$ 秒的时间范围内以 $\\Delta t = 0.0005$ 秒的时间步长进行均匀采样。\n\n您的程序必须使用随时间变化的 $[\\mathrm{Ca}^{2+}](t)$ 和每个测试用例指定的参数，对 $A(t)$ 和 $x(t)$ 的耦合常微分方程进行数值积分，从 $A(0)=0$ 和 $x(0)=0$ 开始，然后计算 $F(t)$ 及其峰值 $F_{\\mathrm{peak}}$（单位为 $\\mathrm{kPa}$）。对于数值积分，您可以使用固定步长的四阶龙格－库塔方法。\n\n物理单位和输出：\n\n- 时间必须以 $\\mathrm{s}$ 为单位处理，肌小节长度以 $\\mu\\mathrm{m}$ 为单位，钙浓度以 $\\mu\\mathrm{M}$ 为单位，力以 $\\mathrm{kPa}$ 为单位。\n- 每个测试用例的最终输出必须是绝对差值 $|F_{\\mathrm{peak}} - F_{\\mathrm{peak,exp}}|$，单位为 $\\mathrm{kPa}$，其中 $F_{\\mathrm{peak,exp}}$ 是该测试用例的实验报告峰值力。\n- 所有输出均以 $\\mathrm{kPa}$ 为单位，表示为十进制数。\n\n测试套件：\n\n请精确实现以下四个测试用例，每个用例都包含参数和实验峰值力：\n\n- 用例 1（通用，“理想路径”）：\n  - $\\mathrm{SL} = 2.1$,\n  - $k_{\\mathrm{on}} = 40$ $\\mu\\mathrm{M}^{-1}\\,\\mathrm{s}^{-1}$,\n  - $k_{\\mathrm{off}} = 20$ $\\mathrm{s}^{-1}$,\n  - $k_f = 200$ $\\mathrm{s}^{-1}$,\n  - $k_g = 150$ $\\mathrm{s}^{-1}$,\n  - $F_{\\max} = 60$ $\\mathrm{kPa}$,\n  - 钙瞬变参数: $C_{\\mathrm{rest}} = 0.1$ $\\mu\\mathrm{M}$, $A_{\\mathrm{Ca}} = 0.8$ $\\mu\\mathrm{M}$, $t_0 = 0.05$ $\\mathrm{s}$, $\\tau_{\\mathrm{rise}} = 0.015$ $\\mathrm{s}$, $\\tau_{\\mathrm{decay}} = 0.15$ $\\mathrm{s}$,\n  - 实验峰值力: $F_{\\mathrm{peak,exp}} = 20.0$ $\\mathrm{kPa}$。\n\n- 用例 2（低钙振幅边界情况）：\n  - $\\mathrm{SL} = 2.1$,\n  - $k_{\\mathrm{on}} = 40$ $\\mu\\mathrm{M}^{-1}\\,\\mathrm{s}^{-1}$,\n  - $k_{\\mathrm{off}} = 20$ $\\mathrm{s}^{-1}$,\n  - $k_f = 200$ $\\mathrm{s}^{-1}$,\n  - $k_g = 150$ $\\mathrm{s}^{-1}$,\n  - $F_{\\max} = 60$ $\\mathrm{kPa}$,\n  - 钙瞬变参数: $C_{\\mathrm{rest}} = 0.1$ $\\mu\\mathrm{M}$, $A_{\\mathrm{Ca}} = 0.1$ $\\mu\\mathrm{M}$, $t_0 = 0.05$ $\\mathrm{s}$, $\\tau_{\\mathrm{rise}} = 0.015$ $\\mathrm{s}$, $\\tau_{\\mathrm{decay}} = 0.15$ $\\mathrm{s}$,\n  - 实验峰值力: $F_{\\mathrm{peak,exp}} = 8.0$ $\\mathrm{kPa}$。\n\n- 用例 3（肌小节长度在低重叠附近的边界）：\n  - $\\mathrm{SL} = 1.62$,\n  - $k_{\\mathrm{on}} = 40$ $\\mu\\mathrm{M}^{-1}\\,\\mathrm{s}^{-1}$,\n  - $k_{\\mathrm{off}} = 20$ $\\mathrm{s}^{-1}$,\n  - $k_f = 200$ $\\mathrm{s}^{-1}$,\n  - $k_g = 150$ $\\mathrm{s}^{-1}$,\n  - $F_{\\max} = 60$ $\\mathrm{kPa}$,\n  - 钙瞬变参数: $C_{\\mathrm{rest}} = 0.1$ $\\mu\\mathrm{M}$, $A_{\\mathrm{Ca}} = 0.8$ $\\mu\\mathrm{M}$, $t_0 = 0.05$ $\\mathrm{s}$, $\\tau_{\\mathrm{rise}} = 0.015$ $\\mathrm{s}$, $\\tau_{\\mathrm{decay}} = 0.15$ $\\mathrm{s}$,\n  - 实验峰值力: $F_{\\mathrm{peak,exp}} = 0.3$ $\\mathrm{kPa}$。\n\n- 用例 4（快速脱离边界情况）：\n  - $\\mathrm{SL} = 2.1$,\n  - $k_{\\mathrm{on}} = 40$ $\\mu\\mathrm{M}^{-1}\\,\\mathrm{s}^{-1}$,\n  - $k_{\\mathrm{off}} = 20$ $\\mathrm{s}^{-1}$,\n  - $k_f = 200$ $\\mathrm{s}^{-1}$,\n  - $k_g = 300$ $\\mathrm{s}^{-1}$,\n  - $F_{\\max} = 60$ $\\mathrm{kPa}$,\n  - 钙瞬变参数: $C_{\\mathrm{rest}} = 0.1$ $\\mu\\mathrm{M}$, $A_{\\mathrm{Ca}} = 0.8$ $\\mu\\mathrm{M}$, $t_0 = 0.05$ $\\mathrm{s}$, $\\tau_{\\mathrm{rise}} = 0.015$ $\\mathrm{s}$, $\\tau_{\\mathrm{decay}} = 0.15$ $\\mathrm{s}$,\n  - 实验峰值力: $F_{\\mathrm{peak,exp}} = 12.5$ $\\mathrm{kPa}$。\n\n程序要求：\n\n- 实现上述常微分方程和钙瞬变采样。\n- 在 $[0,1]$ $\\mathrm{s}$ 范围内，使用时间步长为 $\\Delta t = 0.0005$ $\\mathrm{s}$ 的固定步长四阶龙格－库塔积分法。\n- 对于每个测试用例，计算 $F_{\\mathrm{peak}}$ 并报告绝对误差 $|F_{\\mathrm{peak}} - F_{\\mathrm{peak,exp}}|$（单位为 $\\mathrm{kPa}$）。\n\n最终输出格式：\n\n您的程序应生成单行输出，其中包含四个测试用例的绝对误差，格式为方括号括起来的逗号分隔列表，例如 $[e_1,e_2,e_3,e_4]$，其中每个 $e_i$ 是一个以 $\\mathrm{kPa}$ 为单位的十进制数。",
            "solution": "所提出的问题是通过数值求解一个模拟钙动力学和横桥循环的常微分方程（ODE）系统，来计算心室肌细胞的等长收缩力。然后将计算出的峰值力与给定的实验值进行比较。该问题具有科学依据、是良定的，并包含了获得唯一解所需的所有信息。因此，我们可以着手进行系统性的、基于原理的推导和实现。\n\n该模型是一个耦合的双变量、一阶、非齐次常微分方程系统，描述了肌丝激活和力生成的动力学。状态变量是 $A(t)$（由钙激活的肌钙蛋白C调节位点的分数）和 $x(t)$（处于力生成状态的肌球蛋白横桥的分数）。\n\n第一个控制方程基于质量作用定律，模拟了钙与肌钙蛋白C的结合与解离：\n$$\n\\frac{dA}{dt} = k_{\\mathrm{on}}\\,[\\mathrm{Ca}^{2+}](t)\\,\\big(1 - A(t)\\big) - k_{\\mathrm{off}}\\,A(t)\n$$\n此处，$A(t)$ 表示可用位点的分数，因此 $(1 - A(t))$ 是未占据位点的分数。第一项 $k_{\\mathrm{on}}\\,[\\mathrm{Ca}^{2+}](t)\\,(1 - A(t))$ 描述了结合速率，它与钙浓度和可用位点的分数成正比。第二项 $k_{\\mathrm{off}}\\,A(t)$ 描述了解离速率，它与已占据位点的分数成正比。此过程的驱动输入是胞浆钙浓度 $[\\mathrm{Ca}^{2+}](t)$，它被提供为一个预定义的时间 $t$ 的函数。\n\n第二个控制方程描述了肌球蛋白横桥在脱离的、不产生力的状态和附着的、产生力的状态之间的转换。这是一个简化的两态模型：\n$$\n\\frac{dx}{dt} = f_{\\mathrm{attach}}(t)\\,\\big(1 - x(t)\\big) - g_{\\mathrm{detach}}\\,x(t)\n$$\n附着速率 $f_{\\mathrm{attach}}(t) = k_f\\,A(t)\\,\\gamma(\\mathrm{SL})$ 依赖于细肌丝的激活水平 $A(t)$、一个基础速率常数 $k_f$ 以及一个依赖于肌小节长度的重叠因子 $\\gamma(\\mathrm{SL})$。脱离速率被假定为一个常数 $g_{\\mathrm{detach}} = k_g$。\n\n该模型通过分段线性重叠因子 $\\gamma(\\mathrm{SL})$ 融入了已被广泛认可的肌纤维力-长度关系，该因子表示在给定肌小节长度 $\\mathrm{SL}$ 下可能的横桥相互作用的分数：\n$$\n\\gamma(\\mathrm{SL}) =\n\\begin{cases}\n0,  \\mathrm{SL} \\le 1.6\\,\\mu\\mathrm{m} \\\\\n(\\mathrm{SL} - 1.6) / 0.6,  1.6\\,\\mu\\mathrm{m}  \\mathrm{SL}  2.2\\,\\mu\\mathrm{m} \\\\\n1 - (\\mathrm{SL} - 2.2) / 0.4,  2.2\\,\\mu\\mathrm{m} \\le \\mathrm{SL}  2.6\\,\\mu\\mathrm{m} \\\\\n0,  \\mathrm{SL} \\ge 2.6\\,\\mu\\mathrm{m}\n\\end{cases}\n$$\n该函数在 $\\mathrm{SL} = 2.2\\,\\mu\\mathrm{m}$ 处达到峰值，并在短长度和长长度下线性下降至零。\n\n驱动钙瞬变 $[\\mathrm{Ca}^{2+}](t)$ 由一个双指数函数建模，该函数捕捉了收缩过程中细胞内钙浓度快速上升和较慢衰减的典型特征：\n$$\n[\\mathrm{Ca}^{2+}](t) = C_{\\mathrm{rest}} + H(t - t_0)\\,A_{\\mathrm{Ca}}\\,\\left(e^{-\\frac{t - t_0}{\\tau_{\\mathrm{decay}}}} - e^{-\\frac{t - t_0}{\\tau_{\\mathrm{rise}}}}\\right)\n$$\n其中 $H(\\cdot)$ 是亥维赛阶跃函数，确保瞬变在起始时间 $t_0$ 开始。\n\n最后，等长力 $F(t)$ 与附着的横桥分数 $x(t)$ 和重叠因子 $\\gamma(\\mathrm{SL})$ 成正比：\n$$\nF(t) = F_{\\max}\\,x(t)\\,\\gamma(\\mathrm{SL})\n$$\n其中 $F_{\\max}$ 是肌肉可以产生的最大应力。\n\n为了求解该系统，我们必须将其视为一个初值问题（IVP）。系统的状态可以用向量 $\\mathbf{y}(t) = [A(t), x(t)]^T$ 表示。于是，常微分方程系统为 $\\frac{d\\mathbf{y}}{dt} = \\mathbf{f}(t, \\mathbf{y})$。给定的初始条件为 $A(0) = 0$ 和 $x(0) = 0$，表示心室肌细胞初始处于静息状态。\n\n我们被要求使用固定步长的四阶龙格－库塔（RK4）方法进行数值积分。对于此类问题，该方法在准确性和计算效率之间提供了良好的平衡。对于时间步长 $\\Delta t$，状态向量从时间 $t_n$ 推进到 $t_{n+1} = t_n + \\Delta t$ 的过程如下：\n$$\n\\begin{aligned}\n\\mathbf{k}_1 = \\mathbf{f}(t_n, \\mathbf{y}_n) \\\\\n\\mathbf{k}_2 = \\mathbf{f}(t_n + \\frac{\\Delta t}{2}, \\mathbf{y}_n + \\frac{\\Delta t}{2} \\mathbf{k}_1) \\\\\n\\mathbf{k}_3 = \\mathbf{f}(t_n + \\frac{\\Delta t}{2}, \\mathbf{y}_n + \\frac{\\Delta t}{2} \\mathbf{k}_2) \\\\\n\\mathbf{k}_4 = \\mathbf{f}(t_n + \\Delta t, \\mathbf{y}_n + \\Delta t \\mathbf{k}_3) \\\\\n\\mathbf{y}_{n+1} = \\mathbf{y}_n + \\frac{\\Delta t}{6} (\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)\n\\end{aligned}\n$$\n从 $t=0$ 时的 $\\mathbf{y}_0 = [0, 0]^T$ 开始，在从 $t=0$ 到 $t=1$ 秒的时间网格上，以 $\\Delta t = 0.0005$ 秒的步长迭代应用此过程。\n\n对于每个测试用例，算法如下：\n1.  提取所有模型参数（$\\mathrm{SL}, k_{\\mathrm{on}}, k_{\\mathrm{off}}, k_f, k_g, F_{\\max}$）和钙瞬变参数（$C_{\\mathrm{rest}}, A_{\\mathrm{Ca}}, t_0, \\tau_{\\mathrm{rise}}, \\tau_{\\mathrm{decay}}$）。\n2.  根据给定的肌小节长度计算恒定的重叠因子 $\\gamma(\\mathrm{SL})$。\n3.  定义从 $t=0$ 到 $t=1$ 且 $\\Delta t = 0.0005$ 的时间网格。\n4.  初始化数组以存储 $A(t)$ 和 $x(t)$ 的历史记录，初始条件为 $A(0)=0$ 和 $x(0)=0$。\n5.  遍历时间网格。在每个步骤中，应用RK4算法从 $t_i$ 的状态计算出 $[A(t_{i+1}), x(t_{i+1})]$ 的状态。\n6.  一旦完全计算出 $A(t)$ 和 $x(t)$ 的时间进程，使用其定义计算力-时间历史 $F(t)$。\n7.  找到力-时间历史的最大值，$F_{\\mathrm{peak}} = \\max(F(t))$。\n8.  计算绝对差值 $|F_{\\mathrm{peak}} - F_{\\mathrm{peak,exp}}|$，其中 $F_{\\mathrm{peak,exp}}$ 是提供的实验峰值力。\n\n对所有四个指定的测试用例重复此过程，并收集和报告所得的绝对差值。",
            "answer": "```python\nimport numpy as np\n\ndef calcium_transient(t, C_rest, A_Ca, t0, tau_rise, tau_decay):\n    \"\"\"\n    Computes the calcium concentration at time t.\n    \"\"\"\n    if t  t0:\n        return C_rest\n    else:\n        dt_onset = t - t0\n        return C_rest + A_Ca * (np.exp(-dt_onset / tau_decay) - np.exp(-dt_onset / tau_rise))\n\ndef gamma_sl(SL):\n    \"\"\"\n    Computes the sarcomere length-dependent overlap factor.\n    \"\"\"\n    if SL = 1.6:\n        return 0.0\n    elif 1.6  SL  2.2:\n        return (SL - 1.6) / (2.2 - 1.6)\n    elif 2.2 = SL  2.6:\n        return 1.0 - (SL - 2.2) / (2.6 - 2.2)\n    else:  # SL >= 2.6\n        return 0.0\n\ndef ode_system(t, y, k_on, k_off, k_f, k_g, gamma, ca_params):\n    \"\"\"\n    Defines the system of ODEs for [A, x].\n    y: state vector [A, x]\n    \"\"\"\n    A, x = y\n    \n    Ca_t = calcium_transient(t, **ca_params)\n    \n    # ODE for Troponin C activation\n    dAdt = k_on * Ca_t * (1.0 - A) - k_off * A\n    \n    # ODE for crossbridge attachment\n    f_attach = k_f * A * gamma\n    dxdt = f_attach * (1.0 - x) - k_g * x\n    \n    return np.array([dAdt, dxdt])\n\ndef solve():\n    \"\"\"\n    Main function to run simulations for all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        {\n            \"SL\": 2.1, \"k_on\": 40, \"k_off\": 20, \"k_f\": 200, \"k_g\": 150, \"F_max\": 60,\n            \"C_rest\": 0.1, \"A_Ca\": 0.8, \"t0\": 0.05, \"tau_rise\": 0.015, \"tau_decay\": 0.15,\n            \"F_peak_exp\": 20.0\n        },\n        {\n            \"SL\": 2.1, \"k_on\": 40, \"k_off\": 20, \"k_f\": 200, \"k_g\": 150, \"F_max\": 60,\n            \"C_rest\": 0.1, \"A_Ca\": 0.1, \"t0\": 0.05, \"tau_rise\": 0.015, \"tau_decay\": 0.15,\n            \"F_peak_exp\": 8.0\n        },\n        {\n            \"SL\": 1.62, \"k_on\": 40, \"k_off\": 20, \"k_f\": 200, \"k_g\": 150, \"F_max\": 60,\n            \"C_rest\": 0.1, \"A_Ca\": 0.8, \"t0\": 0.05, \"tau_rise\": 0.015, \"tau_decay\": 0.15,\n            \"F_peak_exp\": 0.3\n        },\n        {\n            \"SL\": 2.1, \"k_on\": 40, \"k_off\": 20, \"k_f\": 200, \"k_g\": 300, \"F_max\": 60,\n            \"C_rest\": 0.1, \"A_Ca\": 0.8, \"t0\": 0.05, \"tau_rise\": 0.015, \"tau_decay\": 0.15,\n            \"F_peak_exp\": 12.5\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # Simulation parameters\n        dt = 0.0005\n        t_start = 0.0\n        t_end = 1.0\n        num_points = int((t_end - t_start) / dt) + 1\n        time_points = np.linspace(t_start, t_end, num_points)\n\n        # State variable history\n        # y_history[i, 0] is A, y_history[i, 1] is x\n        y_history = np.zeros((num_points, 2))\n        y_history[0, :] = [0.0, 0.0]  # Initial conditions\n\n        # Unpack case parameters\n        ca_params = {\n            \"C_rest\": case[\"C_rest\"], \"A_Ca\": case[\"A_Ca\"], \"t0\": case[\"t0\"],\n            \"tau_rise\": case[\"tau_rise\"], \"tau_decay\": case[\"tau_decay\"]\n        }\n        gamma = gamma_sl(case[\"SL\"])\n\n        # RK4 Integration\n        for i in range(num_points - 1):\n            t_i = time_points[i]\n            y_i = y_history[i, :]\n\n            k1 = ode_system(t_i, y_i, case[\"k_on\"], case[\"k_off\"], case[\"k_f\"], case[\"k_g\"], gamma, ca_params)\n            k2 = ode_system(t_i + 0.5 * dt, y_i + 0.5 * dt * k1, case[\"k_on\"], case[\"k_off\"], case[\"k_f\"], case[\"k_g\"], gamma, ca_params)\n            k3 = ode_system(t_i + 0.5 * dt, y_i + 0.5 * dt * k2, case[\"k_on\"], case[\"k_off\"], case[\"k_f\"], case[\"k_g\"], gamma, ca_params)\n            k4 = ode_system(t_i + dt, y_i + dt * k3, case[\"k_on\"], case[\"k_off\"], case[\"k_f\"], case[\"k_g\"], gamma, ca_params)\n            \n            y_next = y_i + (dt / 6.0) * (k1 + 2.0 * k2 + 2.0 * k3 + k4)\n            y_history[i + 1, :] = y_next\n        \n        # Extract crossbridge history\n        x_history = y_history[:, 1]\n        \n        # Calculate force history\n        force_history = case[\"F_max\"] * x_history * gamma\n\n        # Peak force and error calculation\n        F_peak_model = np.max(force_history)\n        error = abs(F_peak_model - case[\"F_peak_exp\"])\n        results.append(error)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "前面的练习专注于描述平均行为的确定性模型，而本节将带你进入单个通道事件的随机世界。钙信号在亚细胞层面本质上是随机的，由少数离子通道的开放和关闭引起。这项高级实践将介绍Gillespie算法，用于精确模拟兰尼碱受体簇的随机动力学，从而让你能够研究钙火花等确定性模型无法捕捉的涌现现象。",
            "id": "3942829",
            "problem": "您的任务是使用 Gillespie 随机模拟算法构建心室肌细胞中兰尼碱受体 (RyR) 簇的随机模拟，以便在指定的开放和关闭速率以及耦合参数下，估计钙火花振幅和持续时间的分布。该模拟必须根植于化学主方程，并必须实现 Gillespie 直接法。所有量和动力学都必须以纯数学术语表述，并进行数值计算。\n\n从以下基本基础开始：\n\n- 化学主方程控制着连续时间马尔可夫跳跃过程中概率的时间演化。对于一组以 $j$ 索引、在状态 $x$ 下倾向函数为 $a_j(x)$ 的反应通道，到下一次反应的等待时间呈指数分布，其速率为 $a_0(x) = \\sum_j a_j(x)$，下一次反应的身份以与 $a_j(x) / a_0(x)$ 成正比的概率抽取。\n\n- Gillespie 直接法通过在每一步根据以下公式抽取等待时间 $\\tau$ 和反应通道索引 $j$ 来生成此过程的精确样本路径：\n$$\n\\tau = -\\frac{\\ln r_1}{a_0(x)}, \\quad \\text{选择 } j \\text{ 使得 } \\sum_{k=1}^{j-1} a_k(x)  r_2 a_0(x) \\le \\sum_{k=1}^{j} a_k(x),\n$$\n其中 $r_1$ 和 $r_2$ 是在 $(0,1)$ 上的独立均匀随机变量。\n\n模型规格：\n\n- 考虑一个由 $N$ 个相同的 RyR 通道组成的簇，每个通道可以处于开放或关闭两种状态之一。令 $n(t)$ 表示在时间 $t$ 开放的通道数，因此 $n(t) \\in \\{0,1,\\dots,N\\}$。\n\n- 释放域中的局部钙浓度被建模为开放通道数的准稳态函数：\n$$\nc(t) = c_b + \\phi \\, n(t),\n$$\n其中 $c_b$ 是基线钙浓度，$\\phi$ 是每个开放通道的耦合增量。一个钙火花事件的振幅定义为\n$$\nA = \\max_{t \\in \\text{event}} c(t) - c_b,\n$$\n以微摩尔 (uM) 表示。\n\n- 每个关闭通道的开放速率根据 Hill 型定律取决于局部钙浓度：\n$$\nk_{\\text{open}}(c) = k_+ \\, c^h,\n$$\n其中 $k_+$ 是开放速率系数，而 $h$ 是 Hill 指数。每个开放通道的关闭速率是恒定的：\n$$\nk_{\\text{close}} = k_-.\n$$\n\n- 当有 $n$ 个通道开放时，总倾向函数为\n$$\na_0(n) = (N-n)\\,k_+\\,c^h + n\\,k_- \\quad \\text{且} \\quad c = c_b + \\phi n.\n$$\n在 $n>0$ 的任何状态下，都有两个反应通道：一个开放反应，倾向函数为 $a_{\\text{open}}(n) = (N-n)\\,k_+\\,c^h$；以及一个关闭反应，倾向函数为 $a_{\\text{close}}(n) = n\\,k_-$。当 $n=0$ 时，只有开放反应是可能的，其倾向函数为 $a_{\\text{open}}(0) = N\\,k_+\\,c_b^h$。\n\n事件定义：\n\n- 一个钙火花事件在系统从 $n=0$ 转换到 $n=1$ 的瞬间开始（从静息状态首次开放），并在系统转换回 $n=0$ 的瞬间结束（所有通道关闭）。钙火花持续时间 $D$ 定义为在该事件期间 $n(t) > 0$ 所花费的总时间，以秒 (s) 表示。钙火花振幅 $A$ 如上定义，以微摩尔 (uM) 表示。\n\n模拟要求：\n\n- 实现 Gillespie 直接法来模拟 $n(t)$ 的随机轨迹，根据上述定义检测钙火花事件，并为每个事件记录其振幅 $A$ 和持续时间 $D$。\n\n- 为保证数值稳定性和确保终止，模拟应在收集到指定数量的事件 $M$ 或达到指定的最大真实世界模拟时间 $T_{\\max}$ 后停止，以先到者为准。如果没有收集到任何事件，则该测试用例的统计数据返回四个零。\n\n- 对于每个测试用例，计算收集到的事件的汇总统计数据：平均振幅 $\\overline{A}$、平均持续时间 $\\overline{D}$、振幅的变异系数 $\\mathrm{CV}_A = \\sigma_A / \\overline{A}$ 和持续时间的变异系数 $\\mathrm{CV}_D = \\sigma_D / \\overline{D}$，其中 $\\sigma$ 表示样本标准差。如果分母为零，则将相应的变异系数定义为零。\n\n单位和输出格式：\n\n- 振幅必须以微摩尔 (uM) 表示。持续时间必须以秒 (s) 表示。所有最终数字必须四舍五入到六位小数。\n\n- 您的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。列表中的每个元素对应一个测试用例，并且本身必须是按 $[\\overline{A},\\overline{D},\\mathrm{CV}_A,\\mathrm{CV}_D]$ 顺序排列的四个浮点数列表。\n\n测试套件：\n\n使用以下测试套件（每个元组按 $(N,k_+,k_-,\\phi,h,c_b,M,T_{\\max},\\text{seed})$ 的顺序列出参数）：\n\n1. 正常路径耦合与速率：$(20, 50.0, 2.0, 0.3, 2, 0.05, 100, 50.0, 12345)$。\n2. 弱耦合边缘案例：$(20, 50.0, 2.0, 0.05, 2, 0.05, 100, 200.0, 23456)$。\n3. 快速关闭边界情况：$(20, 50.0, 10.0, 0.3, 2, 0.05, 100, 50.0, 34567)$。\n4. 强耦合与慢速关闭：$(20, 80.0, 1.0, 0.5, 2, 0.05, 100, 50.0, 45678)$。\n\n以上所有数字均以适当单位给出：$k_+$ 的单位是 $\\text{s}^{-1}\\,\\text{uM}^{-h}$，$k_-$ 的单位是 $\\text{s}^{-1}$，$\\phi$ 的单位是 $\\text{uM}$，$c_b$ 的单位是 $\\text{uM}$，$M$ 是事件计数，$T_{\\max}$ 的单位是 $\\text{s}$，$\\text{seed}$ 是一个无量纲的伪随机数生成器种子。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果（例如，\"[[a1,d1,cvA1,cvD1],[a2,d2,cvA2,cvD2],...]\"），振幅以微摩尔 (uM) 为单位，持续时间以秒 (s) 为单位，所有数值均四舍五入到六位小数。",
            "solution": "问题陈述经过严格评估，被认为是有效的。它具有科学依据、问题设定良好，并为数值模拟提供了一套完整且一致的定义、参数和要求。兰尼碱受体 (RyR) 簇的模型是一个标准（尽管简化了）的表示，用于计算生物学中研究钙诱导的钙释放。使用 Gillespie 随机模拟算法 (SSA) 是模拟系统化学主方程时间演化的正确、精确的方法。所有参数和单位在量纲上都是一致的，并且在物理上是合理的。因此，该问题可以按陈述求解。\n\n该解决方案通过构建一个遵循 Gillespie 直接法的数值模拟来实现，以生成开放 RyR 通道数 $n(t)$ 的精确随机轨迹。\n\n**1. 模型和状态表示**\n系统在任何时间 $t$ 的状态完全由整数 $n(t)$ 描述，表示开放通道的数量，其中 $n \\in \\{0, 1, \\dots, N\\}$。模拟在静息状态 $n(0) = 0$、时间 $t=0$ 时初始化。\n\n**2. Gillespie 算法实现**\n模拟的核心是一个循环，它迭代地将系统从一个反应事件推进到下一个。在每一步，从时间 $t$ 的状态 $n$ 开始：\n\n首先，计算反应倾向函数。有两种可能的反应类型：通道开放或通道关闭。\n局部钙浓度 $c$ 是 $n$ 的准稳态函数：\n$$c(n) = c_b + \\phi n$$\n$(N-n)$ 个关闭通道中之一开放的倾向函数为：\n$$a_{\\text{open}}(n) = (N-n) k_+ c(n)^h = (N-n) k_+ (c_b + \\phi n)^h$$\n$n$ 个开放通道中之一关闭的倾向函数为：\n$$a_{\\text{close}}(n) = n k_-$$\n总倾向函数 $a_0(n)$ 是所有可能反应倾向函数的总和：\n$$a_0(n) = a_{\\text{open}}(n) + a_{\\text{close}}(n)$$\n如果 $n=0$，则 $a_{\\text{close}}(0)=0$。如果 $n=N$，则 $a_{\\text{open}}(N)=0$。\n\n其次，从 $(0, 1)$ 上的均匀分布中抽取两个独立的随机数 $r_1, r_2$。\n\n第三，计算到下一次反应的时间 $\\tau$。这个等待时间呈指数分布，速率为 $a_0(n)$：\n$$\\tau = -\\frac{\\ln(r_1)}{a_0(n)}$$\n然后，模拟时间从 $t$ 推进到 $t' = t + \\tau$。\n\n第四，选择要发生的下一个反应。如果 $r_2 a_0(n)  a_{\\text{open}}(n)$，则选择通道开放事件，状态从 $n$ 转换到 $n+1$。否则，选择通道关闭事件，状态从 $n$ 转换到 $n-1$。\n\n模拟循环持续重复这些步骤，直到收集到目标数量的事件 $M$，或者模拟时间 $t$ 超过最大允许时间 $T_{\\max}$。如果计算出的下一个事件时间 $t'$ 会超过 $T_{\\max}$，循环将终止，任何正在进行中、未完成的事件都将被丢弃。\n\n**3. 事件检测和测量**\n钙火花由特定的状态转换定义。事件跟踪如下：\n- **事件开始**：当系统在时间 $t$ 从状态 $n=0$ 转换到 $n=1$ 时，一个钙火花事件开始。在此转换时，记录事件开始时间，并将一个跟踪事件期间最大开放通道数的变量 $n_{\\text{max,event}}$ 初始化为 $1$。\n- **事件持续**：只要 $n(t) > 0$，事件就持续进行。如果 $n(t)$ 超过当前最大值，则更新 $n_{\\text{max,event}}$ 的值：$n_{\\text{max,event}} = \\max(n_{\\text{max,event}}, n(t))$。\n- **事件结束**：当系统在时间 $t$ 转换回状态 $n=0$ 时，事件结束。此时，计算并存储钙火花的持续时间 $D$ 和振幅 $A$。\n  - 持续时间是自事件开始以来经过的总时间：$D = t - t_{\\text{start}}$。\n  - 振幅由事件期间的最大开放通道数导出，即 $A = \\max(c(t)) - c_b = \\phi \\cdot n_{\\text{max,event}}$。\n\n**4. 统计分析**\n模拟终止后，对收集到的事件振幅 $\\{A_i\\}$ 和持续时间 $\\{D_i\\}$ 的列表进行分析。\n- 如果没有收集到事件（即列表为空），该测试用例的统计数据均为零。\n- 否则，计算平均振幅 $\\overline{A}$ 和平均持续时间 $\\overline{D}$。\n- 样本标准差 $\\sigma_A$ 和 $\\sigma_D$ 使用分母为 $N_{events}-1$ 进行计算（1个自由度校正，`ddof=1`）。如果只收集到一个事件，则标准差取为 $0$。\n- 变异系数计算为 $\\mathrm{CV}_A = \\sigma_A / \\overline{A}$ 和 $\\mathrm{CV}_D = \\sigma_D / \\overline{D}$。如果平均值为零，则相应的变异系数定义为零。\n\n所有最终统计值都四舍五入到六位小数以供输出，遵循问题的格式要求。对测试套件中的每个参数集重复此过程，为确保可复现性，每个案例的伪随机数生成器都重新设定种子。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef run_simulation(N, k_plus, k_minus, phi, h, c_b, M, T_max, seed):\n    \"\"\"\n    Runs a Gillespie simulation of an RyR cluster.\n\n    Args:\n        N (int): Number of RyR channels.\n        k_plus (float): Opening rate coefficient.\n        k_minus (float): Closing rate per channel.\n        phi (float): Calcium increment per open channel.\n        h (float): Hill exponent for opening.\n        c_b (float): Baseline calcium concentration.\n        M (int): Target number of events to collect.\n        T_max (float): Maximum simulation time.\n        seed (int): Seed for the random number generator.\n\n    Returns:\n        list: A list of four floats: [mean_A, mean_D, cv_A, cv_D].\n    \"\"\"\n    rng = np.random.default_rng(seed)\n\n    t = 0.0\n    n = 0\n    collected_events = []\n\n    in_event = False\n    event_start_time = 0.0\n    max_n_in_event = 0\n\n    while len(collected_events)  M and t  T_max:\n        # Calculate propensities for the current state n at time t\n        c = c_b + phi * n\n        # Power calculation needs a non-negative base\n        c_eff = max(0.0, c)\n        a_open = (N - n) * k_plus * (c_eff ** h)\n        a_close = n * k_minus\n        a_total = a_open + a_close\n\n        if a_total = 1e-12: # Avoid division by zero or floating point issues\n            break\n\n        # Calculate time to next event\n        tau = -math.log(rng.uniform(0, 1)) / a_total\n        next_t = t + tau\n\n        # If next event is beyond T_max, end the simulation\n        if next_t > T_max:\n            break\n\n        # Choose the reaction\n        prev_n = n\n        if rng.uniform(0, 1) * a_total  a_open:\n            n += 1  # Opening\n        else:\n            n -= 1  # Closing\n\n        # Advance time to the moment of the reaction\n        t = next_t\n\n        # Event detection and measurement logic\n        if not in_event and prev_n == 0 and n == 1:\n            # Event starts\n            in_event = True\n            event_start_time = t\n            max_n_in_event = 1\n        elif in_event:\n            if n > 0:\n                # Event continues\n                max_n_in_event = max(max_n_in_event, n)\n            else:  # n == 0, event ends\n                duration = t - event_start_time\n                amplitude = phi * max_n_in_event\n                collected_events.append({'amp': amplitude, 'dur': duration})\n\n                # Reset for next event\n                in_event = False\n                max_n_in_event = 0\n\n    # Post-simulation statistical analysis\n    if not collected_events:\n        return [0.0, 0.0, 0.0, 0.0]\n\n    amplitudes = [e['amp'] for e in collected_events]\n    durations = [e['dur'] for e in collected_events]\n\n    mean_A = np.mean(amplitudes)\n    mean_D = np.mean(durations)\n\n    n_events = len(collected_events)\n    std_A = np.std(amplitudes, ddof=1) if n_events > 1 else 0.0\n    std_D = np.std(durations, ddof=1) if n_events > 1 else 0.0\n\n    cv_A = std_A / mean_A if mean_A != 0.0 else 0.0\n    cv_D = std_D / mean_D if mean_D != 0.0 else 0.0\n\n    return [mean_A, mean_D, cv_A, cv_D]\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Test suite: (N, k_+, k_-, phi, h, c_b, M, T_max, seed)\n    test_cases = [\n        (20, 50.0, 2.0, 0.3, 2, 0.05, 100, 50.0, 12345),\n        (20, 50.0, 2.0, 0.05, 2, 0.05, 100, 200.0, 23456),\n        (20, 50.0, 10.0, 0.3, 2, 0.05, 100, 50.0, 34567),\n        (20, 80.0, 1.0, 0.5, 2, 0.05, 100, 50.0, 45678),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        stats = run_simulation(*case)\n        all_results.append(stats)\n\n    # Format the final output string as per requirements\n    formatted_results = []\n    for res_list in all_results:\n        # Format each number to 6 decimal places\n        formatted_nums = [f\"{num:.6f}\" for num in res_list]\n        formatted_results.append(f\"[{','.join(formatted_nums)}]\")\n\n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}