{
    "hands_on_practices": [
        {
            "introduction": "To understand how a cardiac myocyte contracts, we must first model the trigger. This practice takes you back to first principles to build a deterministic model of the dyadic subspace, the critical microdomain where calcium first enters the cell through L-type calcium channels. By deriving and solving an ordinary differential equation (ODE) based on fundamental physics, you will gain hands-on experience in quantifying how ionic currents and diffusion shape the local calcium signals that initiate contraction .",
            "id": "3942844",
            "problem": "You are asked to model dyadic subspace calcium concentration in a ventricular myocyte using a single-compartment ordinary differential equation under the rapid buffer approximation. The goal is to compute the time course of the dyadic calcium concentration $[\\mathrm{Ca}]_{\\mathrm{dyad}}(t)$ when the L-type calcium current (LCC) $I_{\\mathrm{Ca,L}}(t)$ is a square pulse of duration $\\tau$. The model must be derived from first principles and implemented as a program that evaluates $[\\mathrm{Ca}]_{\\mathrm{dyad}}(t)$ at specified times for a given test suite of parameters.\n\nFundamental base and assumptions:\n- Mass conservation in a control volume: the rate of change of the number of moles equals inflow minus outflow.\n- Faraday’s law for ion flux: the molar influx associated with an ionic current $I$ carried by ions of valence $z$ is $J_{\\mathrm{in}} = -I/(z F)$, where $F$ is the Faraday constant.\n- Fick’s law of diffusion approximated as a one-dimensional slab between the dyad and the myoplasm: the diffusive flux out of the dyad is $J_{\\mathrm{diff}} = \\dfrac{D_{\\mathrm{Ca}} A}{L} \\left([\\mathrm{Ca}]_{\\mathrm{dyad}} - [\\mathrm{Ca}]_{i}\\right)$, where $D_{\\mathrm{Ca}}$ is the diffusion coefficient, $A$ is the effective exchange area, $L$ is the characteristic diffusion length, and $[\\mathrm{Ca}]_{i}$ is the (assumed constant) myoplasmic calcium concentration.\n- Rapid Buffer Approximation (RBA): fast buffers are assumed to be in rapid equilibrium, yielding an effective buffer capacity factor $(1+\\kappa)$ that scales the time derivative of free calcium.\n- The L-type calcium current $I_{\\mathrm{Ca,L}}(t)$ is a square pulse of amplitude $I_{0}$ during $0 \\le t  \\tau$, and $0$ for $t \\ge \\tau$. Use the physiological sign convention that $I_{0}  0$ denotes inward current, which increases $[\\mathrm{Ca}]_{\\mathrm{dyad}}$.\n- The dyad is treated as a well-mixed compartment of volume $V_{\\mathrm{dyad}}$.\n- The myoplasmic calcium concentration is constant at rest: $[\\mathrm{Ca}]_{i} = 0.1\\,\\mu\\mathrm{M}$.\n\nDerivation targets to implement:\n- Starting from the above principles, write down the balance on calcium in the dyad accounting for $J_{\\mathrm{in}}$ and $J_{\\mathrm{diff}}$, divide by the dyad volume $V_{\\mathrm{dyad}}$, and incorporate the buffer capacity factor $(1+\\kappa)$ to obtain a first-order linear ordinary differential equation for $[\\mathrm{Ca}]_{\\mathrm{dyad}}(t)$ that is piecewise driven by a constant input during the pulse and zero afterwards.\n- Use the valence $z = 2$ for calcium and Faraday constant $F = 96485\\,\\mathrm{C/mol}$.\n- Geometry constants for dyad-to-myoplasm exchange are fixed to $A = 0.04\\,\\mu\\mathrm{m}^{2}$ and $L = 0.2\\,\\mu\\mathrm{m}$, which you must convert to $\\mathrm{m}^{2}$ and $\\mathrm{m}$ in computation.\n\nInitial condition:\n- $[\\mathrm{Ca}]_{\\mathrm{dyad}}(0) = [\\mathrm{Ca}]_{i}$.\n\nRequired units and output specification:\n- All computations must be performed in SI units. The final reported $[\\mathrm{Ca}]_{\\mathrm{dyad}}$ must be expressed in micromolar ($\\mu\\mathrm{M}$) as floats rounded to six decimal places.\n- Evaluate $[\\mathrm{Ca}]_{\\mathrm{dyad}}(t)$ at times $t = 0.001\\,\\mathrm{s}$, $t = 0.005\\,\\mathrm{s}$, and $t = 0.020\\,\\mathrm{s}$ for each test case.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry corresponds to one test case and is itself a list of three numbers in $\\mu\\mathrm{M}$ at the specified times. For example, a valid output format is $[[x_{11},x_{12},x_{13}],[x_{21},x_{22},x_{23}],[x_{31},x_{32},x_{33}]]$.\n\nTest suite:\n- Use the following parameter sets; all quantities are in SI units unless stated otherwise. For each case, $I_{\\mathrm{Ca,L}}(t)$ is a square pulse with amplitude $I_{0}$ from $t=0$ to $t=\\tau$, and zero thereafter.\n\n1) Happy-path case:\n   - $I_{0} = -5 \\times 10^{-13}\\,\\mathrm{A}$,\n   - $\\tau = 0.005\\,\\mathrm{s}$,\n   - $V_{\\mathrm{dyad}} = 2 \\times 10^{-20}\\,\\mathrm{m}^{3}$,\n   - $D_{\\mathrm{Ca}} = 2 \\times 10^{-10}\\,\\mathrm{m}^{2}/\\mathrm{s}$,\n   - $\\kappa = 30$.\n\n2) Boundary case (no pulse):\n   - $I_{0} = -5 \\times 10^{-13}\\,\\mathrm{A}$,\n   - $\\tau = 0.000\\,\\mathrm{s}$,\n   - $V_{\\mathrm{dyad}} = 2 \\times 10^{-20}\\,\\mathrm{m}^{3}$,\n   - $D_{\\mathrm{Ca}} = 2 \\times 10^{-10}\\,\\mathrm{m}^{2}/\\mathrm{s}$,\n   - $\\kappa = 30$.\n\n3) Edge case (slow exchange, no buffering):\n   - $I_{0} = -5 \\times 10^{-13}\\,\\mathrm{A}$,\n   - $\\tau = 0.005\\,\\mathrm{s}$,\n   - $V_{\\mathrm{dyad}} = 2 \\times 10^{-20}\\,\\mathrm{m}^{3}$,\n   - $D_{\\mathrm{Ca}} = 1 \\times 10^{-12}\\,\\mathrm{m}^{2}/\\mathrm{s}$,\n   - $\\kappa = 0$.\n\nAnswer type:\n- For each test case, return a list of three floats in $\\mu\\mathrm{M}$ corresponding to $t = 0.001\\,\\mathrm{s}$, $t = 0.005\\,\\mathrm{s}$, and $t = 0.020\\,\\mathrm{s}$.",
            "solution": "The problem is to determine the time course of dyadic calcium concentration, $[\\mathrm{Ca}]_{\\mathrm{dyad}}(t)$, in a ventricular myocyte subjected to a square pulse of L-type calcium current, $I_{\\mathrm{Ca,L}}(t)$. The model is a single-compartment ordinary differential equation derived from first principles.\n\n### Step 1: Problem Validation\n\n**1.1. Extraction of Givens**\n- **Governing Principles**:\n  - Mass conservation: $\\text{rate of change of moles} = \\text{inflow} - \\text{outflow}$.\n  - Ion flux from current: $J_{\\mathrm{in}} = -I/(z F)$, where $I$ is ionic current, $z$ is valence, and $F$ is Faraday's constant.\n  - Diffusive flux (Fick's law approximation): $J_{\\mathrm{diff}} = \\frac{D_{\\mathrm{Ca}} A}{L} ([\\mathrm{Ca}]_{\\mathrm{dyad}} - [\\mathrm{Ca}]_{i})$.\n- **Assumptions**:\n  - The dyad is a well-mixed compartment of volume $V_{\\mathrm{dyad}}$.\n  - Rapid Buffer Approximation (RBA) applies, introducing a buffer capacity factor $(1+\\kappa)$.\n  - Myoplasmic calcium concentration is constant: $[\\mathrm{Ca}]_{i} = 0.1\\,\\mu\\mathrm{M}$.\n- **Input Forcing Function**:\n  - L-type calcium current $I_{\\mathrm{Ca,L}}(t)$ is a square pulse:\n    $I_{\\mathrm{Ca,L}}(t) = I_{0}$ for $0 \\le t  \\tau$ (with $I_0  0$ for inward current).\n    $I_{\\mathrm{Ca,L}}(t) = 0$ for $t \\ge \\tau$.\n- **Constants**:\n  - Calcium valence: $z = 2$.\n  - Faraday constant: $F = 96485\\,\\mathrm{C/mol}$.\n  - Diffusion exchange area: $A = 0.04\\,\\mu\\mathrm{m}^{2}$.\n  - Diffusion length: $L = 0.2\\,\\mu\\mathrm{m}$.\n- **Initial Condition**:\n  - At time $t=0$, $[\\mathrm{Ca}]_{\\mathrm{dyad}}(0) = [\\mathrm{Ca}]_{i}$.\n- **Test Suite Parameters**:\n  - Case 1: $I_{0} = -5 \\times 10^{-13}\\,\\mathrm{A}$, $\\tau = 0.005\\,\\mathrm{s}$, $V_{\\mathrm{dyad}} = 2 \\times 10^{-20}\\,\\mathrm{m}^{3}$, $D_{\\mathrm{Ca}} = 2 \\times 10^{-10}\\,\\mathrm{m}^{2}/\\mathrm{s}$, $\\kappa = 30$.\n  - Case 2: $I_{0} = -5 \\times 10^{-13}\\,\\mathrm{A}$, $\\tau = 0.000\\,\\mathrm{s}$, $V_{\\mathrm{dyad}} = 2 \\times 10^{-20}\\,\\mathrm{m}^{3}$, $D_{\\mathrm{Ca}} = 2 \\times 10^{-10}\\,\\mathrm{m}^{2}/\\mathrm{s}$, $\\kappa = 30$.\n  - Case 3: $I_{0} = -5 \\times 10^{-13}\\,\\mathrm{A}$, $\\tau = 0.005\\,\\mathrm{s}$, $V_{\\mathrm{dyad}} = 2 \\times 10^{-20}\\,\\mathrm{m}^{3}$, $D_{\\mathrm{Ca}} = 1 \\times 10^{-12}\\,\\mathrm{m}^{2}/\\mathrm{s}$, $\\kappa = 0$.\n- **Output Requirements**:\n  - Evaluate $[\\mathrm{Ca}]_{\\mathrm{dyad}}(t)$ at $t = 0.001\\,\\mathrm{s}$, $t = 0.005\\,\\mathrm{s}$, and $t = 0.020\\,\\mathrm{s}$.\n  - Report results in micromolar ($\\mu\\mathrm{M}$), rounded to six decimal places.\n  - Final output is a single-line string of a list of lists.\n  - All calculations must be in SI units.\n\n**1.2. Validation and Verdict**\nThe problem is **valid**.\n- It is **scientifically grounded** in established principles of biophysics (mass conservation, electrodiffusion). The Rapid Buffer Approximation is a standard simplifying assumption in such models.\n- It is **well-posed**, describing a first-order linear ordinary differential equation with a piecewise constant forcing term and a specified initial condition, which guarantees a unique, stable solution.\n- The language is **objective** and precise.\n- The setup is **complete and consistent**, providing all necessary constants, initial conditions, and parameters to derive and solve the model.\n- The values are **realistic** for the physiological context of a cardiac myocyte microdomain.\n- The problem requires a non-trivial derivation and solution, thus it is not a **pseudo-profound or tautological** question.\n\n### Step 2: Derivation of the Governing Equation and Solution\n\n**2.1. Formulation of the ODE**\nLet $N_{\\mathrm{Ca, tot}}(t)$ be the total number of moles of calcium (free plus buffered) in the dyadic volume $V_{\\mathrm{dyad}}$. By the principle of mass conservation, its rate of change is the sum of molar fluxes into the volume:\n$$\n\\frac{d N_{\\mathrm{Ca, tot}}}{dt} = J_{\\mathrm{in}}(t) - J_{\\mathrm{diff}}(t)\n$$\nThe rapid buffer approximation states that the total calcium concentration, $[\\mathrm{Ca}]_{\\mathrm{tot}}$, changes proportionally to the free calcium concentration, $[\\mathrm{Ca}]_{\\mathrm{dyad}}$, with a proportionality factor $(1+\\kappa)$. Thus, $N_{\\mathrm{Ca, tot}} = (1+\\kappa)[\\mathrm{Ca}]_{\\mathrm{dyad}} V_{\\mathrm{dyad}}$. The rate of change is:\n$$\n\\frac{d N_{\\mathrm{Ca, tot}}}{dt} = (1+\\kappa) V_{\\mathrm{dyad}} \\frac{d[\\mathrm{Ca}]_{\\mathrm{dyad}}}{dt}\n$$\nThe fluxes are given as:\n- Influx from L-type calcium current $I_{\\mathrm{Ca,L}}(t)$: $J_{\\mathrm{in}}(t) = \\frac{-I_{\\mathrm{Ca,L}}(t)}{zF}$. The negative sign corrects for the convention that inward cation current is negative.\n- Diffusive efflux to the myoplasm: $J_{\\mathrm{diff}}(t) = \\frac{D_{\\mathrm{Ca}} A}{L} ([\\mathrm{Ca}]_{\\mathrm{dyad}}(t) - [\\mathrm{Ca}]_{i})$.\n\nSubstituting these into the mass balance equation gives:\n$$\n(1+\\kappa) V_{\\mathrm{dyad}} \\frac{d[\\mathrm{Ca}]_{\\mathrm{dyad}}}{dt} = \\frac{-I_{\\mathrm{Ca,L}}(t)}{zF} - \\frac{D_{\\mathrm{Ca}} A}{L} ([\\mathrm{Ca}]_{\\mathrm{dyad}}(t) - [\\mathrm{Ca}]_{i})\n$$\nDividing by $(1+\\kappa)V_{\\mathrm{dyad}}$ and rearranging terms yields a first-order linear ODE in the standard form $\\frac{dy}{dt} + P(t)y = Q(t)$. Let $y(t) = [\\mathrm{Ca}]_{\\mathrm{dyad}}(t)$:\n$$\n\\frac{dy}{dt} + \\left( \\frac{D_{\\mathrm{Ca}} A}{L V_{\\mathrm{dyad}}(1+\\kappa)} \\right) y = \\frac{-I_{\\mathrm{Ca,L}}(t)}{zF V_{\\mathrm{dyad}}(1+\\kappa)} + \\left( \\frac{D_{\\mathrm{Ca}} A}{L V_{\\mathrm{dyad}}(1+\\kappa)} \\right) [\\mathrm{Ca}]_{i}\n$$\nTo simplify, let's define two constants:\n- The rate constant of calcium exchange, $\\alpha$: $\\alpha = \\frac{D_{\\mathrm{Ca}} A}{L V_{\\mathrm{dyad}}(1+\\kappa)}$. Its unit is $\\mathrm{s}^{-1}$.\n- The forcing term due to the current, $\\beta(t)$: $\\beta(t) = \\frac{-I_{\\mathrm{Ca,L}}(t)}{zF V_{\\mathrm{dyad}}(1+\\kappa)}$.\nThe ODE becomes:\n$$\n\\frac{dy}{dt} + \\alpha y(t) = \\beta(t) + \\alpha [\\mathrm{Ca}]_{i}\n$$\n\n**2.2. Solution of the ODE**\nThe ODE is solved piecewise for the two phases of the input current $I_{\\mathrm{Ca,L}}(t)$. The general solution to an equation of the form $\\frac{dy}{dt} + \\alpha y = C$ is $y(t) = \\frac{C}{\\alpha} + \\left(y(t_0) - \\frac{C}{\\alpha}\\right) e^{-\\alpha (t-t_0)}$.\n\n**Phase 1: Pulse ON ($0 \\le t  \\tau$)**\nDuring this interval, $I_{\\mathrm{Ca,L}}(t) = I_0$, which is constant. The forcing term $\\beta(t)$ is also constant, $\\beta_0 = \\frac{-I_0}{zF V_{\\mathrm{dyad}}(1+\\kappa)}$. The ODE is:\n$$\n\\frac{dy}{dt} + \\alpha y = \\beta_0 + \\alpha [\\mathrm{Ca}]_{i}\n$$\nThe steady-state solution ($y_{\\infty,1}$) towards which $y(t)$ relaxes is:\n$$\ny_{\\infty,1} = \\frac{\\beta_0 + \\alpha [\\mathrm{Ca}]_{i}}{\\alpha} = \\frac{\\beta_0}{\\alpha} + [\\mathrm{Ca}]_{i} = \\frac{-I_0 L}{zF D_{\\mathrm{Ca}} A} + [\\mathrm{Ca}]_{i}\n$$\nLet's define the constant $K = \\frac{-I_0 L}{zF D_{\\mathrm{Ca}} A}$. Then $y_{\\infty,1} = K + [\\mathrm{Ca}]_{i}$.\nThe solution starting from the initial condition $y(0) = [\\mathrm{Ca}]_{i}$ is:\n$$\ny(t) = y_{\\infty,1} + (y(0) - y_{\\infty,1})e^{-\\alpha t} = (K + [\\mathrm{Ca}]_{i}) + ([\\mathrm{Ca}]_{i} - (K + [\\mathrm{Ca}]_{i}))e^{-\\alpha t}\n$$\n$$\n[\\mathrm{Ca}]_{\\mathrm{dyad}}(t) = [\\mathrm{Ca}]_{i} + K(1 - e^{-\\alpha t}), \\quad \\text{for } 0 \\le t  \\tau\n$$\n\n**Phase 2: Pulse OFF ($t \\ge \\tau$)**\nDuring this interval, $I_{\\mathrm{Ca,L}}(t) = 0$, so $\\beta(t) = 0$. The ODE is:\n$$\n\\frac{dy}{dt} + \\alpha y = \\alpha [\\mathrm{Ca}]_{i}\n$$\nThe steady-state solution ($y_{\\infty,2}$) is $y_{\\infty,2} = \\frac{\\alpha [\\mathrm{Ca}]_{i}}{\\alpha} = [\\mathrm{Ca}]_{i}$.\nThe solution starts at $t=\\tau$ with the initial condition being the concentration at the end of Phase 1, $y(\\tau)$.\n$$\ny(\\tau) = [\\mathrm{Ca}]_{i} + K(1 - e^{-\\alpha \\tau})\n$$\nThe solution for $t \\ge \\tau$ is:\n$$\ny(t) = y_{\\infty,2} + (y(\\tau) - y_{\\infty,2})e^{-\\alpha (t-\\tau)}\n$$\n$$\n[\\mathrm{Ca}]_{\\mathrm{dyad}}(t) = [\\mathrm{Ca}]_{i} + ([\\mathrm{Ca}]_{i} + K(1 - e^{-\\alpha \\tau}) - [\\mathrm{Ca}]_{i})e^{-\\alpha (t-\\tau)}\n$$\n$$\n[\\mathrm{Ca}]_{\\mathrm{dyad}}(t) = [\\mathrm{Ca}]_{i} + K(1 - e^{-\\alpha \\tau})e^{-\\alpha (t-\\tau)}, \\quad \\text{for } t \\ge \\tau\n$$\n\n**2.3. Unit Conversion**\nAll calculations must be in SI units. The base unit for concentration is $\\mathrm{mol}/\\mathrm{m}^3$. The given and required units are in micromolar ($\\mu\\mathrm{M}$), where $1\\,\\mathrm{M} = 1\\,\\mathrm{mol}/\\mathrm{L}$.\n- $1\\,\\mathrm{m}^3 = 1000\\,\\mathrm{L}$, so $1\\,\\mathrm{mol}/\\mathrm{m}^3 = 10^{-3}\\,\\mathrm{M}$.\n- $1\\,\\mu\\mathrm{M} = 10^{-6}\\,\\mathrm{M}$.\n- Therefore, $1\\,\\mathrm{mol}/\\mathrm{m}^3 = 10^{-3} / 10^{-6} \\,\\mu\\mathrm{M} = 1000\\,\\mu\\mathrm{M}$.\n- To convert from SI units ($\\mathrm{mol}/\\mathrm{m}^3$) to $\\mu\\mathrm{M}$, we multiply by $10^3$.\n- Conversely, to convert from $\\mu\\mathrm{M}$ to $\\mathrm{mol}/\\mathrm{m}^3$, we multiply by $10^{-3}$.\n- $[\\mathrm{Ca}]_{i} = 0.1\\,\\mu\\mathrm{M} = 0.1 \\times 10^{-3} \\,\\mathrm{mol}/\\mathrm{m}^3 = 10^{-4}\\,\\mathrm{mol}/\\mathrm{m}^3$.\n- The geometric constants must be converted to meters:\n  - $A = 0.04\\,\\mu\\mathrm{m}^2 = 0.04 \\times (10^{-6}\\,\\mathrm{m})^2 = 4 \\times 10^{-14}\\,\\mathrm{m}^2$.\n  - $L = 0.2\\,\\mu\\mathrm{m} = 0.2 \\times 10^{-6}\\,\\mathrm{m} = 2 \\times 10^{-7}\\,\\mathrm{m}$.\n\nThe analytical solutions derived above are implemented in the program below to compute the dyadic calcium concentrations for the specified test cases and time points.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the dyadic calcium concentration in a ventricular myocyte\n    using a single-compartment ODE model under the rapid buffer approximation.\n    \"\"\"\n\n    # --- Fixed constants in SI units ---\n    F_CONST = 96485.0  # Faraday constant (C/mol)\n    Z_CA = 2.0  # Valence of Calcium\n    \n    # Geometric constants converted to SI units (m)\n    AREA_EXCHANGE = 0.04e-12  # Exchange area (m^2), from 0.04 um^2\n    DIFFUSION_LENGTH = 0.2e-6  # Diffusion length (m), from 0.2 um\n    \n    # Myoplasmic calcium concentration converted to SI units (mol/m^3)\n    # 0.1 uM = 0.1e-6 mol/L = 0.1e-6 * 1000 mol/m^3 = 1e-4 mol/m^3\n    CA_I = 1.0e-4  # Myoplasmic Ca concentration (mol/m^3)\n    \n    # Evaluation times in seconds\n    EVALUATION_TIMES = [0.001, 0.005, 0.020]\n\n    # --- Test suite definition ---\n    test_cases = [\n        # Case 1: Happy-path case\n        {\n            \"I0\": -5.0e-13,      # A\n            \"tau\": 0.005,       # s\n            \"V_dyad\": 2.0e-20,  # m^3\n            \"D_Ca\": 2.0e-10,    # m^2/s\n            \"kappa\": 30.0\n        },\n        # Case 2: Boundary case (no pulse)\n        {\n            \"I0\": -5.0e-13,\n            \"tau\": 0.000,\n            \"V_dyad\": 2.0e-20,\n            \"D_Ca\": 2.0e-10,\n            \"kappa\": 30.0\n        },\n        # Case 3: Edge case (slow exchange, no buffering)\n        {\n            \"I0\": -5.0e-13,\n            \"tau\": 0.005,\n            \"V_dyad\": 2.0e-20,\n            \"D_Ca\": 1.0e-12,\n            \"kappa\": 0.0\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        I0 = case[\"I0\"]\n        tau = case[\"tau\"]\n        V_dyad = case[\"V_dyad\"]\n        D_Ca = case[\"D_Ca\"]\n        kappa = case[\"kappa\"]\n\n        # --- Calculate derived model parameters ---\n        \n        # Rate constant alpha (s^-1)\n        # alpha = (D_Ca * A) / (L * V_dyad * (1 + kappa))\n        alpha = (D_Ca * AREA_EXCHANGE) / (DIFFUSION_LENGTH * V_dyad * (1.0 + kappa))\n\n        # Peak concentration change factor K (mol/m^3)\n        # K = (-I0 * L) / (z * F * D_Ca * A)\n        K = (-I0 * DIFFUSION_LENGTH) / (Z_CA * F_CONST * D_Ca * AREA_EXCHANGE)\n\n        case_results = []\n        for t in EVALUATION_TIMES:\n            ca_dyad_si = 0.0  # Concentration in mol/m^3\n\n            if t  tau:\n                # Phase 1: Pulse is ON\n                # [Ca]_dyad(t) = [Ca]_i + K * (1 - exp(-alpha * t))\n                ca_dyad_si = CA_I + K * (1.0 - np.exp(-alpha * t))\n            else:\n                # Phase 2: Pulse is OFF\n                # [Ca]_dyad(t) = [Ca]_i + K * (1 - exp(-alpha * tau)) * exp(-alpha * (t - tau))\n                if tau == 0.0:\n                    # If pulse duration is zero, concentration remains at baseline\n                    ca_dyad_si = CA_I\n                else:\n                    term1 = K * (1.0 - np.exp(-alpha * tau))\n                    term2 = np.exp(-alpha * (t - tau))\n                    ca_dyad_si = CA_I + term1 * term2\n            \n            # Convert concentration from SI units (mol/m^3) to micromolar (uM)\n            # 1 mol/m^3 = 1000 uM\n            ca_dyad_uM = ca_dyad_si * 1000.0\n            \n            # Round to six decimal places as required\n            case_results.append(round(ca_dyad_uM, 6))\n        \n        all_results.append(case_results)\n\n    # --- Format output string ---\n    # Convert each inner list to its string representation without spaces\n    str_results = [str(res).replace(\" \", \"\") for res in all_results]\n    # Join the string representations with commas and enclose in brackets\n    final_output_str = f\"[{','.join(str_results)}]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "While deterministic models are powerful, calcium release from the sarcoplasmic reticulum is fundamentally a stochastic process, driven by the random opening and closing of ryanodine receptor (RyR) channels. This exercise introduces you to the world of stochastic simulation by implementing the Gillespie algorithm to model an RyR cluster and predict the properties of elementary calcium sparks. You will learn how the collective behavior of a few protein channels can give rise to discrete signaling events, a cornerstone of modern cell biology .",
            "id": "3942829",
            "problem": "You are tasked with constructing a stochastic simulation of a Ryanodine Receptor (RyR) cluster in a ventricular myocyte using the Gillespie stochastic simulation algorithm, in order to estimate the distribution of calcium spark amplitudes and durations under specified opening and closing rates and coupling parameters. The simulation must be rooted in the chemical master equation and must implement the Gillespie direct method. All quantities and dynamics are to be formulated in purely mathematical terms and computed numerically.\n\nStart from the following fundamental base:\n\n- The chemical master equation governs the time evolution of probabilities in a continuous-time Markov jump process. For a set of reaction channels indexed by $j$ with propensities $a_j(x)$ in state $x$, the waiting time to the next reaction is exponentially distributed with rate $a_0(x) = \\sum_j a_j(x)$, and the identity of the next reaction is drawn with probability proportional to $a_j(x) / a_0(x)$.\n\n- The Gillespie direct method produces exact sample paths of this process by drawing the waiting time $\\tau$ and reaction channel index $j$ at each step according to\n$$\n\\tau = -\\frac{\\ln r_1}{a_0(x)}, \\quad \\text{choose } j \\text{ such that } \\sum_{k=1}^{j-1} a_k(x)  r_2 a_0(x) \\le \\sum_{k=1}^{j} a_k(x),\n$$\nwhere $r_1$ and $r_2$ are independent uniform random variables on $(0,1)$.\n\nModel specification:\n\n- Consider a cluster of $N$ identical RyR channels, each of which can be in one of two states, open or closed. Let $n(t)$ denote the number of open channels at time $t$, so $n(t) \\in \\{0,1,\\dots,N\\}$.\n\n- The local calcium concentration in the release domain is modeled as a quasi-steady function of the number of open channels:\n$$\nc(t) = c_b + \\phi \\, n(t),\n$$\nwhere $c_b$ is the baseline calcium concentration and $\\phi$ is the coupling increment per open channel. The amplitude of a spark event is defined as\n$$\nA = \\max_{t \\in \\text{event}} c(t) - c_b,\n$$\nexpressed in micromolar (uM).\n\n- The opening rate for each closed channel depends on the local calcium concentration by a Hill-type law:\n$$\nk_{\\text{open}}(c) = k_+ \\, c^h,\n$$\nwhere $k_+$ is the opening rate coefficient and $h$ is the Hill exponent. The closing rate per open channel is constant:\n$$\nk_{\\text{close}} = k_-.\n$$\n\n- The total propensity when $n$ channels are open is\n$$\na_0(n) = (N-n)\\,k_+\\,c^h + n\\,k_- \\quad \\text{with} \\quad c = c_b + \\phi n.\n$$\nThere are two reaction channels at any state with $n0$: an opening reaction with propensity $a_{\\text{open}}(n) = (N-n)\\,k_+\\,c^h$ and a closing reaction with propensity $a_{\\text{close}}(n) = n\\,k_-$. When $n=0$, only opening reactions are possible with propensity $a_{\\text{open}}(0) = N\\,k_+\\,c_b^h$.\n\nEvent definitions:\n\n- A spark event begins at the instant when the system transitions from $n=0$ to $n=1$ (first opening from quiescence), and ends at the instant when it transitions back to $n=0$ (all channels closed). The spark duration $D$ is defined as the total time spent with $n(t)  0$ during that event, expressed in seconds (s). The spark amplitude $A$ is defined as above, expressed in micromolar (uM).\n\nSimulation requirements:\n\n- Implement the Gillespie direct method to simulate the stochastic trajectory of $n(t)$, detect spark events according to the above definitions, and record for each event its amplitude $A$ and duration $D$.\n\n- For numerical stability and to ensure termination, the simulation should stop after collecting a specified number of events $M$ or reaching a specified maximum wall-clock simulation time $T_{\\max}$, whichever occurs first. If no events are collected, return four zeros for the statistics of that test case.\n\n- For each test case, compute summary statistics over the collected events: mean amplitude $\\overline{A}$, mean duration $\\overline{D}$, coefficient of variation of amplitude $\\mathrm{CV}_A = \\sigma_A / \\overline{A}$, and coefficient of variation of duration $\\mathrm{CV}_D = \\sigma_D / \\overline{D}$, where $\\sigma$ denotes the sample standard deviation. If the denominator is zero, define the corresponding coefficient of variation as zero.\n\nUnits and output formatting:\n\n- Amplitudes must be expressed in micromolar (uM). Durations must be expressed in seconds (s). All final numbers must be rounded to six decimal places.\n\n- Your program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element of the list corresponds to one test case and must itself be a list of four floating-point numbers in the order $[\\overline{A},\\overline{D},\\mathrm{CV}_A,\\mathrm{CV}_D]$.\n\nTest suite:\n\nUse the following test suite (each tuple lists parameters in the order $(N,k_+,k_-,\\phi,h,c_b,M,T_{\\max},\\text{seed})$):\n\n1. Happy-path coupling and rates: $(20, 50.0, 2.0, 0.3, 2, 0.05, 100, 50.0, 12345)$.\n2. Weak coupling edge case: $(20, 50.0, 2.0, 0.05, 2, 0.05, 100, 200.0, 23456)$.\n3. Fast closing boundary: $(20, 50.0, 10.0, 0.3, 2, 0.05, 100, 50.0, 34567)$.\n4. Strong coupling and slow closing: $(20, 80.0, 1.0, 0.5, 2, 0.05, 100, 50.0, 45678)$.\n\nAll numbers above are given in appropriate units: $k_+$ in $\\text{s}^{-1}\\,\\text{uM}^{-h}$, $k_-$ in $\\text{s}^{-1}$, $\\phi$ in $\\text{uM}$, $c_b$ in $\\text{uM}$, $M$ in event count, $T_{\\max}$ in $\\text{s}$, and $\\text{seed}$ is a dimensionless pseudorandom number generator seed.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[[a1,d1,cvA1,cvD1],[a2,d2,cvA2,cvD2],...]\"), with amplitudes in micromolar (uM) and durations in seconds (s), all rounded to six decimal places.",
            "solution": "The problem statement is critically evaluated and found to be valid. It is scientifically grounded, well-posed, and provides a complete and consistent set of definitions, parameters, and requirements for a numerical simulation. The model of a Ryanodine Receptor (RyR) cluster is a standard, albeit simplified, representation used in computational biology to study calcium-induced calcium release. The use of the Gillespie Stochastic Simulation Algorithm (SSA) is the correct, exact method for simulating the time evolution of the system's chemical master equation. All parameters and units are dimensionally consistent and physically plausible. The problem is thus solvable as stated.\n\nThe solution is implemented by constructing a numerical simulation that follows the Gillespie direct method to generate exact stochastic trajectories of the number of open RyR channels, $n(t)$.\n\n**1. Model and State Representation**\nThe state of the system at any time $t$ is fully described by the integer $n(t)$, representing the number of open channels, where $n \\in \\{0, 1, \\dots, N\\}$. The simulation is initialized in the quiescent state, $n(0) = 0$, at time $t=0$.\n\n**2. Gillespie Algorithm Implementation**\nThe core of the simulation is a loop that iteratively advances the system from one reaction event to the next. At each step, starting with state $n$ at time $t$:\n\nFirst, the reaction propensities are calculated. There are two possible reaction types: a channel opening or a channel closing.\nThe local calcium concentration, $c$, is a quasi-steady function of $n$:\n$$c(n) = c_b + \\phi n$$\nThe propensity for one of the $(N-n)$ closed channels to open is:\n$$a_{\\text{open}}(n) = (N-n) k_+ c(n)^h = (N-n) k_+ (c_b + \\phi n)^h$$\nThe propensity for one of the $n$ open channels to close is:\n$$a_{\\text{close}}(n) = n k_-$$\nThe total propensity, $a_0(n)$, is the sum of all possible reaction propensities:\n$$a_0(n) = a_{\\text{open}}(n) + a_{\\text{close}}(n)$$\nIf $n=0$, $a_{\\text{close}}(0)=0$. If $n=N$, $a_{\\text{open}}(N)=0$.\n\nSecond, two independent random numbers, $r_1, r_2$, are drawn from a uniform distribution on $(0, 1)$.\n\nThird, the time until the next reaction, $\\tau$, is calculated. This waiting time is exponentially distributed with rate $a_0(n)$:\n$$\\tau = -\\frac{\\ln(r_1)}{a_0(n)}$$\nThe simulation time is then advanced from $t$ to $t' = t + \\tau$.\n\nFourth, the next reaction to occur is chosen. If $r_2 a_0(n)  a_{\\text{open}}(n)$, a channel opening event is selected, and the state transitions from $n$ to $n+1$. Otherwise, a channel closing event is selected, and the state transitions from $n$ to $n-1$.\n\nThe simulation loop continues, repeating these steps, until either the target number of events, $M$, has been collected, or the simulation time $t$ exceeds the maximum allowed time, $T_{\\max}$. If the next calculated event time $t'$ would exceed $T_{\\max}$, the loop terminates, and any ongoing, uncompleted event is discarded.\n\n**3. Event Detection and Measurement**\nCalcium sparks are defined by specific state transitions. An event is tracked as follows:\n- **Event Start**: A spark event begins at time $t$ when the system transitions from the state $n=0$ to $n=1$. Upon this transition, the event start time is recorded, and a variable tracking the maximum number of open channels during the event, $n_{\\text{max,event}}$, is initialized to $1$.\n- **Event Continuation**: As long as $n(t)  0$, the event is ongoing. The value of $n_{\\text{max,event}}$ is updated if $n(t)$ exceeds the current maximum: $n_{\\text{max,event}} = \\max(n_{\\text{max,event}}, n(t))$.\n- **Event End**: The event concludes at time $t$ when the system transitions back to the state $n=0$. At this point, the spark's duration $D$ and amplitude $A$ are calculated and stored.\n  - The duration is the total time elapsed since the event started: $D = t - t_{\\text{start}}$.\n  - The amplitude is derived from the maximum number of open channels during the event, as $A = \\max(c(t)) - c_b = \\phi \\cdot n_{\\text{max,event}}$.\n\n**4. Statistical Analysis**\nAfter the simulation terminates, the collected list of event amplitudes $\\{A_i\\}$ and durations $\\{D_i\\}$ is analyzed.\n- If no events were collected (i.e., the list is empty), the statistics for that test case are all zero.\n- Otherwise, the mean amplitude $\\overline{A}$ and mean duration $\\overline{D}$ are calculated.\n- The sample standard deviations, $\\sigma_A$ and $\\sigma_D$, are computed using a denominator of $N_{events}-1$ (1 degree of freedom correction, `ddof=1`). If only one event is collected, the standard deviation is taken to be $0$.\n- The coefficients of variation are computed as $\\mathrm{CV}_A = \\sigma_A / \\overline{A}$ and $\\mathrm{CV}_D = \\sigma_D / \\overline{D}$. If a mean is zero, the corresponding CV is defined as zero.\n\nAll final statistical values are rounded to six decimal places for output, adhering to the problem's formatting requirements. The process is repeated for each parameter set in the test suite, with the pseudorandom number generator re-seeded for each case to ensure reproducibility.",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef run_simulation(N, k_plus, k_minus, phi, h, c_b, M, T_max, seed):\n    \"\"\"\n    Runs a Gillespie simulation of an RyR cluster.\n\n    Args:\n        N (int): Number of RyR channels.\n        k_plus (float): Opening rate coefficient.\n        k_minus (float): Closing rate per channel.\n        phi (float): Calcium increment per open channel.\n        h (float): Hill exponent for opening.\n        c_b (float): Baseline calcium concentration.\n        M (int): Target number of events to collect.\n        T_max (float): Maximum simulation time.\n        seed (int): Seed for the random number generator.\n\n    Returns:\n        list: A list of four floats: [mean_A, mean_D, cv_A, cv_D].\n    \"\"\"\n    rng = np.random.default_rng(seed)\n\n    t = 0.0\n    n = 0\n    collected_events = []\n\n    in_event = False\n    event_start_time = 0.0\n    max_n_in_event = 0\n\n    while len(collected_events)  M and t  T_max:\n        # Calculate propensities for the current state n at time t\n        c = c_b + phi * n\n        # Power calculation needs a non-negative base\n        c_eff = max(0.0, c)\n        a_open = (N - n) * k_plus * (c_eff ** h)\n        a_close = n * k_minus\n        a_total = a_open + a_close\n\n        if a_total = 1e-12: # Avoid division by zero or floating point issues\n            break\n\n        # Calculate time to next event\n        tau = -math.log(rng.uniform(0, 1)) / a_total\n        next_t = t + tau\n\n        # If next event is beyond T_max, end the simulation\n        if next_t > T_max:\n            break\n\n        # Choose the reaction\n        prev_n = n\n        if rng.uniform(0, 1) * a_total  a_open:\n            n += 1  # Opening\n        else:\n            n -= 1  # Closing\n\n        # Advance time to the moment of the reaction\n        t = next_t\n\n        # Event detection and measurement logic\n        if not in_event and prev_n == 0 and n == 1:\n            # Event starts\n            in_event = True\n            event_start_time = t\n            max_n_in_event = 1\n        elif in_event:\n            if n > 0:\n                # Event continues\n                max_n_in_event = max(max_n_in_event, n)\n            else:  # n == 0, event ends\n                duration = t - event_start_time\n                amplitude = phi * max_n_in_event\n                collected_events.append({'amp': amplitude, 'dur': duration})\n\n                # Reset for next event\n                in_event = False\n                max_n_in_event = 0\n\n    # Post-simulation statistical analysis\n    if not collected_events:\n        return [0.0, 0.0, 0.0, 0.0]\n\n    amplitudes = [e['amp'] for e in collected_events]\n    durations = [e['dur'] for e in collected_events]\n\n    mean_A = np.mean(amplitudes)\n    mean_D = np.mean(durations)\n\n    n_events = len(collected_events)\n    std_A = np.std(amplitudes, ddof=1) if n_events > 1 else 0.0\n    std_D = np.std(durations, ddof=1) if n_events > 1 else 0.0\n\n    cv_A = std_A / mean_A if mean_A != 0.0 else 0.0\n    cv_D = std_D / mean_D if mean_D != 0.0 else 0.0\n\n    return [mean_A, mean_D, cv_A, cv_D]\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Test suite: (N, k_+, k_-, phi, h, c_b, M, T_max, seed)\n    test_cases = [\n        (20, 50.0, 2.0, 0.3, 2, 0.05, 100, 50.0, 12345),\n        (20, 50.0, 2.0, 0.05, 2, 0.05, 100, 200.0, 23456),\n        (20, 50.0, 10.0, 0.3, 2, 0.05, 100, 50.0, 34567),\n        (20, 80.0, 1.0, 0.5, 2, 0.05, 100, 50.0, 45678),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        stats = run_simulation(*case)\n        all_results.append(stats)\n\n    # Format the final output string as per requirements\n    formatted_results = []\n    for res_list in all_results:\n        # Format each number to 6 decimal places\n        formatted_nums = [f\"{num:.6f}\" for num in res_list]\n        formatted_results.append(f\"[{','.join(formatted_nums)}]\")\n\n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "The ultimate purpose of the calcium transient is to activate the contractile machinery and generate force. In this final practice, we connect the upstream calcium signal to its downstream mechanical output by modeling the dynamics of myofilament activation and crossbridge cycling. By numerically integrating a system of ODEs that represent troponin-calcium binding and force production, you will simulate a complete isometric twitch, bridging the gap between molecular events and cellular function .",
            "id": "3942851",
            "problem": "You are asked to design and implement a program that computes the isometric twitch force response of a ventricular myocyte using a biophysically grounded calcium-regulated crossbridge model and compares the peak modeled force to experimentally reported peak force values. The model must begin from fundamental reaction kinetics and mechanistic crossbridge cycling, and it must use a length-dependent overlap factor to reflect the sarcomere force–length relationship. The program must integrate the governing ordinary differential equations (ODEs) driven by a provided measured calcium transient, compute the resulting force time course, extract the peak force, and report the absolute differences to experimental peak forces. All outputs must be expressed in kilopascals and aggregated as a single list printed on one line.\n\nBegin from the following fundamental base:\n\n- Law of mass action for binding of calcium to Troponin C (TnC): Let $A(t)$ be the fraction of regulatory sites on the thin filament in the \"activated\" state due to calcium binding. The kinetics are given by\n$$\n\\frac{dA}{dt} = k_{\\mathrm{on}}\\,[\\mathrm{Ca}^{2+}](t)\\,\\big(1 - A(t)\\big) - k_{\\mathrm{off}}\\,A(t),\n$$\nwhere $k_{\\mathrm{on}}$ is the calcium association rate constant in units of $\\mu\\mathrm{M}^{-1}\\,\\mathrm{s}^{-1}$, $k_{\\mathrm{off}}$ is the dissociation rate constant in units of $\\mathrm{s}^{-1}$, and $[\\mathrm{Ca}^{2+}](t)$ is the measured cytosolic calcium concentration in units of $\\mu\\mathrm{M}$.\n\n- Two-state crossbridge (XB) cycling model: Let $x(t)$ be the fraction of myosin heads in the attached, force-generating state. The kinetics are given by\n$$\n\\frac{dx}{dt} = f_{\\mathrm{attach}}(t)\\,\\big(1 - x(t)\\big) - g_{\\mathrm{detach}}\\,x(t),\n$$\nwith an attachment rate $f_{\\mathrm{attach}}(t) = k_f\\,A(t)\\,\\gamma(\\mathrm{SL})$ and a detachment rate $g_{\\mathrm{detach}} = k_g$, where $k_f$ and $k_g$ have units of $\\mathrm{s}^{-1}$, and $\\gamma(\\mathrm{SL})$ is a dimensionless overlap factor capturing sarcomere length dependence.\n\n- Length-dependent overlap factor: Use a piecewise-linear overlap factor $\\gamma(\\mathrm{SL})$ defined for sarcomere length $\\mathrm{SL}$ (in $\\mu\\mathrm{m}$) as\n$$\n\\gamma(\\mathrm{SL}) =\n\\begin{cases}\n0,  \\mathrm{SL} \\le 1.6, \\\\\n\\dfrac{\\mathrm{SL} - 1.6}{2.2 - 1.6},  1.6  \\mathrm{SL}  2.2, \\\\\n1 - \\dfrac{\\mathrm{SL} - 2.2}{2.6 - 2.2},  2.2 \\le \\mathrm{SL}  2.6, \\\\\n0,  \\mathrm{SL} \\ge 2.6.\n\\end{cases}\n$$\n\n- Force calculation under isometric conditions: The instantaneous isometric twitch force is\n$$\nF(t) = F_{\\max}\\,x(t)\\,\\gamma(\\mathrm{SL}),\n$$\nwhere $F_{\\max}$ is the maximum possible isometric force (at $\\gamma(\\mathrm{SL}) = 1$ and $x(t)=1$) in units of $\\mathrm{kPa}$.\n\nThe measured calcium transient shall be provided as a bi-exponential waveform shaped to reflect experimental recordings, sampled over time. For time $t$ in seconds, define the transient as\n$$\n[\\mathrm{Ca}^{2+}](t) = C_{\\mathrm{rest}} + H(t - t_0)\\,A_{\\mathrm{Ca}}\\,\\left(e^{-\\frac{t - t_0}{\\tau_{\\mathrm{decay}}}} - e^{-\\frac{t - t_0}{\\tau_{\\mathrm{rise}}}}\\right),\n$$\nwhere $C_{\\mathrm{rest}}$ is the resting calcium concentration in $\\mu\\mathrm{M}$, $A_{\\mathrm{Ca}}$ is the amplitude in $\\mu\\mathrm{M}$, $t_0$ is the onset time in $\\mathrm{s}$, $\\tau_{\\mathrm{rise}}$ is the rise time constant in $\\mathrm{s}$, $\\tau_{\\mathrm{decay}}$ is the decay time constant in $\\mathrm{s}$, and $H(\\cdot)$ is the Heaviside step function. The transient must be sampled uniformly in time over $[0,1]$ seconds with time step $\\Delta t = 0.0005$ seconds.\n\nYour program must numerically integrate the coupled ODEs for $A(t)$ and $x(t)$ using the time-dependent $[\\mathrm{Ca}^{2+}](t)$ and the specified parameters for each test case, starting from $A(0)=0$ and $x(0)=0$, and then compute $F(t)$ and its peak value $F_{\\mathrm{peak}}$ in $\\mathrm{kPa}$. For numerical integration, you may use a fixed-step fourth-order Runge–Kutta method.\n\nPhysical units and outputs:\n\n- Time must be handled in $\\mathrm{s}$, sarcomere length in $\\mu\\mathrm{m}$, calcium concentration in $\\mu\\mathrm{M}$, and force in $\\mathrm{kPa}$.\n- The final outputs must be the absolute differences $|F_{\\mathrm{peak}} - F_{\\mathrm{peak,exp}}|$ in $\\mathrm{kPa}$ for each test case, where $F_{\\mathrm{peak,exp}}$ is the experimentally reported peak force for that test case.\n- Express all outputs in $\\mathrm{kPa}$ as decimal numbers.\n\nTest suite:\n\nImplement exactly the following four test cases, each with parameters and experimental peak force:\n\n- Case $1$ (general, \"happy path\"):\n  - $\\mathrm{SL} = 2.1$,\n  - $k_{\\mathrm{on}} = 40 \\, \\mu\\mathrm{M}^{-1}\\,\\mathrm{s}^{-1}$,\n  - $k_{\\mathrm{off}} = 20 \\, \\mathrm{s}^{-1}$,\n  - $k_f = 200 \\, \\mathrm{s}^{-1}$,\n  - $k_g = 150 \\, \\mathrm{s}^{-1}$,\n  - $F_{\\max} = 60 \\, \\mathrm{kPa}$,\n  - Calcium transient parameters: $C_{\\mathrm{rest}} = 0.1 \\, \\mu\\mathrm{M}$, $A_{\\mathrm{Ca}} = 0.8 \\, \\mu\\mathrm{M}$, $t_0 = 0.05 \\, \\mathrm{s}$, $\\tau_{\\mathrm{rise}} = 0.015 \\, \\mathrm{s}$, $\\tau_{\\mathrm{decay}} = 0.15 \\, \\mathrm{s}$,\n  - Experimental peak force: $F_{\\mathrm{peak,exp}} = 20.0 \\, \\mathrm{kPa}$.\n\n- Case $2$ (low calcium amplitude edge case):\n  - $\\mathrm{SL} = 2.1$,\n  - $k_{\\mathrm{on}} = 40 \\, \\mu\\mathrm{M}^{-1}\\,\\mathrm{s}^{-1}$,\n  - $k_{\\mathrm{off}} = 20 \\, \\mathrm{s}^{-1}$,\n  - $k_f = 200 \\, \\mathrm{s}^{-1}$,\n  - $k_g = 150 \\, \\mathrm{s}^{-1}$,\n  - $F_{\\max} = 60 \\, \\mathrm{kPa}$,\n  - Calcium transient parameters: $C_{\\mathrm{rest}} = 0.1 \\, \\mu\\mathrm{M}$, $A_{\\mathrm{Ca}} = 0.1 \\, \\mu\\mathrm{M}$, $t_0 = 0.05 \\, \\mathrm{s}$, $\\tau_{\\mathrm{rise}} = 0.015 \\, \\mathrm{s}$, $\\tau_{\\mathrm{decay}} = 0.15 \\, \\mathrm{s}$,\n  - Experimental peak force: $F_{\\mathrm{peak,exp}} = 8.0 \\, \\mathrm{kPa}$.\n\n- Case $3$ (sarcomere-length boundary near low overlap):\n  - $\\mathrm{SL} = 1.62$,\n  - $k_{\\mathrm{on}} = 40 \\, \\mu\\mathrm{M}^{-1}\\,\\mathrm{s}^{-1}$,\n  - $k_{\\mathrm{off}} = 20 \\, \\mathrm{s}^{-1}$,\n  - $k_f = 200 \\, \\mathrm{s}^{-1}$,\n  - $k_g = 150 \\, \\mathrm{s}^{-1}$,\n  - $F_{\\max} = 60 \\, \\mathrm{kPa}$,\n  - Calcium transient parameters: $C_{\\mathrm{rest}} = 0.1 \\, \\mu\\mathrm{M}$, $A_{\\mathrm{Ca}} = 0.8 \\, \\mu\\mathrm{M}$, $t_0 = 0.05 \\, \\mathrm{s}$, $\\tau_{\\mathrm{rise}} = 0.015 \\, \\mathrm{s}$, $\\tau_{\\mathrm{decay}} = 0.15 \\, \\mathrm{s}$,\n  - Experimental peak force: $F_{\\mathrm{peak,exp}} = 0.3 \\, \\mathrm{kPa}$.\n\n- Case $4$ (fast detachment edge case):\n  - $\\mathrm{SL} = 2.1$,\n  - $k_{\\mathrm{on}} = 40 \\, \\mu\\mathrm{M}^{-1}\\,\\mathrm{s}^{-1}$,\n  - $k_{\\mathrm{off}} = 20 \\, \\mathrm{s}^{-1}$,\n  - $k_f = 200 \\, \\mathrm{s}^{-1}$,\n  - $k_g = 300 \\, \\mathrm{s}^{-1}$,\n  - $F_{\\max} = 60 \\, \\mathrm{kPa}$,\n  - Calcium transient parameters: $C_{\\mathrm{rest}} = 0.1 \\, \\mu\\mathrm{M}$, $A_{\\mathrm{Ca}} = 0.8 \\, \\mu\\mathrm{M}$, $t_0 = 0.05 \\, \\mathrm{s}$, $\\tau_{\\mathrm{rise}} = 0.015 \\, \\mathrm{s}$, $\\tau_{\\mathrm{decay}} = 0.15 \\, \\mathrm{s}$,\n  - Experimental peak force: $F_{\\mathrm{peak,exp}} = 12.5 \\, \\mathrm{kPa}$.\n\nProgram requirements:\n\n- Implement the above ODEs and calcium transient sampling.\n- Use a fixed-step fourth-order Runge–Kutta integration with time step $\\Delta t = 0.0005$ $\\mathrm{s}$ over $[0,1]$ $\\mathrm{s}$.\n- For each test case, compute $F_{\\mathrm{peak}}$ and report the absolute error $|F_{\\mathrm{peak}} - F_{\\mathrm{peak,exp}}|$ in $\\mathrm{kPa}$.\n\nFinal output format:\n\nYour program should produce a single line of output containing the absolute errors for the four test cases as a comma-separated list enclosed in square brackets, for example, $[e_1,e_2,e_3,e_4]$, where each $e_i$ is a decimal number in $\\mathrm{kPa}$.",
            "solution": "The problem posed is to compute the isometric twitch force of a ventricular myocyte by numerically solving a system of ordinary differential equations (ODEs) that model calcium kinetics and crossbridge cycling. The computed peak force is then compared to a given experimental value. The problem is scientifically grounded, well-posed, and contains all necessary information for a unique solution. We may therefore proceed with a systematic, principle-based derivation and implementation.\n\nThe model is a coupled two-variable, first-order, non-homogeneous ODE system describing the dynamics of myofilament activation and force generation. The state variables are $A(t)$, the fraction of troponin C regulatory sites activated by calcium, and $x(t)$, the fraction of myosin crossbridges in a force-generating state.\n\nThe first governing equation models the binding and unbinding of calcium to troponin C based on the law of mass action:\n$$\n\\frac{dA}{dt} = k_{\\mathrm{on}}\\,[\\mathrm{Ca}^{2+}](t)\\,\\big(1 - A(t)\\big) - k_{\\mathrm{off}}\\,A(t)\n$$\nHere, $A(t)$ represents the fraction of available sites, so $(1 - A(t))$ is the fraction of unoccupied sites. The first term, $k_{\\mathrm{on}}\\,[\\mathrm{Ca}^{2+}](t)\\,(1 - A(t))$, describes the rate of association, proportional to the calcium concentration and the fraction of available sites. The second term, $k_{\\mathrm{off}}\\,A(t)$, describes the rate of dissociation, proportional to the fraction of occupied sites. The driving input for this process is the cytosolic calcium concentration, $[\\mathrm{Ca}^{2+}](t)$, which is provided as a pre-defined function of time $t$.\n\nThe second governing equation describes the transitions of myosin crossbridges between a detached, non-force-generating state and an attached, force-generating state. This is a simplified two-state model:\n$$\n\\frac{dx}{dt} = f_{\\mathrm{attach}}(t)\\,\\big(1 - x(t)\\big) - g_{\\mathrm{detach}}\\,x(t)\n$$\nThe attachment rate, $f_{\\mathrm{attach}}(t) = k_f\\,A(t)\\,\\gamma(\\mathrm{SL})$, is dependent on the level of thin filament activation $A(t)$, a base rate constant $k_f$, and a sarcomere length-dependent overlap factor $\\gamma(\\mathrm{SL})$. The detachment rate is assumed to be a constant, $g_{\\mathrm{detach}} = k_g$.\n\nThe model incorporates the well-established force-length relationship of muscle fibers through the piecewise-linear overlap factor $\\gamma(\\mathrm{SL})$, which represents the fraction of possible crossbridge interactions at a given sarcomere length $\\mathrm{SL}$:\n$$\n\\gamma(\\mathrm{SL}) =\n\\begin{cases}\n0,  \\mathrm{SL} \\le 1.6\\,\\mu\\mathrm{m} \\\\\n(\\mathrm{SL} - 1.6) / 0.6,  1.6\\,\\mu\\mathrm{m}  \\mathrm{SL}  2.2\\,\\mu\\mathrm{m} \\\\\n1 - (\\mathrm{SL} - 2.2) / 0.4,  2.2\\,\\mu\\mathrm{m} \\le \\mathrm{SL}  2.6\\,\\mu\\mathrm{m} \\\\\n0,  \\mathrm{SL} \\ge 2.6\\,\\mu\\mathrm{m}\n\\end{cases}\n$$\nThis function peaks at $\\mathrm{SL} = 2.2\\,\\mu\\mathrm{m}$ and declines linearly to zero at short and long lengths.\n\nThe driving calcium transient, $[\\mathrm{Ca}^{2+}](t)$, is modeled by a bi-exponential function, which captures the characteristic rapid rise and slower decay of intracellular calcium during a twitch:\n$$\n[\\mathrm{Ca}^{2+}](t) = C_{\\mathrm{rest}} + H(t - t_0)\\,A_{\\mathrm{Ca}}\\,\\left(e^{-\\frac{t - t_0}{\\tau_{\\mathrm{decay}}}} - e^{-\\frac{t - t_0}{\\tau_{\\mathrm{rise}}}}\\right)\n$$\nwhere $H(\\cdot)$ is the Heaviside step function, ensuring the transient begins at the onset time $t_0$.\n\nFinally, the isometric force $F(t)$ is directly proportional to the fraction of attached crossbridges $x(t)$ and the overlap factor $\\gamma(\\mathrm{SL})$:\n$$\nF(t) = F_{\\max}\\,x(t)\\,\\gamma(\\mathrm{SL})\n$$\nwhere $F_{\\max}$ is the maximum stress the muscle can produce.\n\nTo solve this system, we must address it as an initial value problem (IVP). The state of the system can be represented by a vector $\\mathbf{y}(t) = [A(t), x(t)]^T$. The ODE system is then $\\frac{d\\mathbf{y}}{dt} = \\mathbf{f}(t, \\mathbf{y})$. The initial conditions are given as $A(0) = 0$ and $x(0) = 0$, meaning the myocyte is initially at rest.\n\nWe are instructed to use a fixed-step fourth-order Runge-Kutta (RK4) method for numerical integration. This method provides a good balance of accuracy and computational efficiency for this type of problem. For a time step $\\Delta t$, the state vector is advanced from time $t_n$ to $t_{n+1} = t_n + \\Delta t$ as follows:\n$$\n\\begin{aligned}\n\\mathbf{k}_1 = \\mathbf{f}(t_n, \\mathbf{y}_n) \\\\\n\\mathbf{k}_2 = \\mathbf{f}(t_n + \\frac{\\Delta t}{2}, \\mathbf{y}_n + \\frac{\\Delta t}{2} \\mathbf{k}_1) \\\\\n\\mathbf{k}_3 = \\mathbf{f}(t_n + \\frac{\\Delta t}{2}, \\mathbf{y}_n + \\frac{\\Delta t}{2} \\mathbf{k}_2) \\\\\n\\mathbf{k}_4 = \\mathbf{f}(t_n + \\Delta t, \\mathbf{y}_n + \\Delta t \\mathbf{k}_3) \\\\\n\\mathbf{y}_{n+1} = \\mathbf{y}_n + \\frac{\\Delta t}{6} (\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)\n\\end{aligned}\n$$\nThis procedure is applied iteratively, starting from $\\mathbf{y}_0 = [0, 0]^T$ at $t=0$, over a time grid from $t=0$ to $t=1$ second with a step size of $\\Delta t = 0.0005$ seconds.\n\nFor each test case, the algorithm is as follows:\n1.  Extract all model parameters ($\\mathrm{SL}, k_{\\mathrm{on}}, k_{\\mathrm{off}}, k_f, k_g, F_{\\max}$) and calcium transient parameters ($C_{\\mathrm{rest}}, A_{\\mathrm{Ca}}, t_0, \\tau_{\\mathrm{rise}}, \\tau_{\\mathrm{decay}}$).\n2.  Calculate the constant overlap factor $\\gamma(\\mathrm{SL})$ for the given sarcomere length.\n3.  Define the time grid from $t=0$ to $t=1$ with $\\Delta t = 0.0005$.\n4.  Initialize arrays to store the history of $A(t)$ and $x(t)$, with initial conditions $A(0)=0$ and $x(0)=0$.\n5.  Iterate through the time grid. In each step, apply the RK4 algorithm to compute the state $[A(t_{i+1}), x(t_{i+1})]$ from the state at $t_i$.\n6.  Once the time-courses for $A(t)$ and $x(t)$ are fully computed, calculate the force history $F(t)$ using its definition.\n7.  Find the maximum value of the force history, $F_{\\mathrm{peak}} = \\max(F(t))$.\n8.  Compute the absolute difference $|F_{\\mathrm{peak}} - F_{\\mathrm{peak,exp}}|$ where $F_{\\mathrm{peak,exp}}$ is the provided experimental peak force.\n\nThis procedure is repeated for all four specified test cases, and the resulting absolute differences are collected and reported.",
            "answer": "```python\nimport numpy as np\n\ndef calcium_transient(t, C_rest, A_Ca, t0, tau_rise, tau_decay):\n    \"\"\"\n    Computes the calcium concentration at time t.\n    \"\"\"\n    if t  t0:\n        return C_rest\n    else:\n        dt_onset = t - t0\n        return C_rest + A_Ca * (np.exp(-dt_onset / tau_decay) - np.exp(-dt_onset / tau_rise))\n\ndef gamma_sl(SL):\n    \"\"\"\n    Computes the sarcomere length-dependent overlap factor.\n    \"\"\"\n    if SL = 1.6:\n        return 0.0\n    elif 1.6  SL  2.2:\n        return (SL - 1.6) / (2.2 - 1.6)\n    elif 2.2 = SL  2.6:\n        return 1.0 - (SL - 2.2) / (2.6 - 2.2)\n    else:  # SL >= 2.6\n        return 0.0\n\ndef ode_system(t, y, k_on, k_off, k_f, k_g, gamma, ca_params):\n    \"\"\"\n    Defines the system of ODEs for [A, x].\n    y: state vector [A, x]\n    \"\"\"\n    A, x = y\n    \n    Ca_t = calcium_transient(t, **ca_params)\n    \n    # ODE for Troponin C activation\n    dAdt = k_on * Ca_t * (1.0 - A) - k_off * A\n    \n    # ODE for crossbridge attachment\n    f_attach = k_f * A * gamma\n    dxdt = f_attach * (1.0 - x) - k_g * x\n    \n    return np.array([dAdt, dxdt])\n\ndef solve():\n    \"\"\"\n    Main function to run simulations for all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        {\n            \"SL\": 2.1, \"k_on\": 40, \"k_off\": 20, \"k_f\": 200, \"k_g\": 150, \"F_max\": 60,\n            \"C_rest\": 0.1, \"A_Ca\": 0.8, \"t0\": 0.05, \"tau_rise\": 0.015, \"tau_decay\": 0.15,\n            \"F_peak_exp\": 20.0\n        },\n        {\n            \"SL\": 2.1, \"k_on\": 40, \"k_off\": 20, \"k_f\": 200, \"k_g\": 150, \"F_max\": 60,\n            \"C_rest\": 0.1, \"A_Ca\": 0.1, \"t0\": 0.05, \"tau_rise\": 0.015, \"tau_decay\": 0.15,\n            \"F_peak_exp\": 8.0\n        },\n        {\n            \"SL\": 1.62, \"k_on\": 40, \"k_off\": 20, \"k_f\": 200, \"k_g\": 150, \"F_max\": 60,\n            \"C_rest\": 0.1, \"A_Ca\": 0.8, \"t0\": 0.05, \"tau_rise\": 0.015, \"tau_decay\": 0.15,\n            \"F_peak_exp\": 0.3\n        },\n        {\n            \"SL\": 2.1, \"k_on\": 40, \"k_off\": 20, \"k_f\": 200, \"k_g\": 300, \"F_max\": 60,\n            \"C_rest\": 0.1, \"A_Ca\": 0.8, \"t0\": 0.05, \"tau_rise\": 0.015, \"tau_decay\": 0.15,\n            \"F_peak_exp\": 12.5\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # Simulation parameters\n        dt = 0.0005\n        t_start = 0.0\n        t_end = 1.0\n        num_points = int((t_end - t_start) / dt) + 1\n        time_points = np.linspace(t_start, t_end, num_points)\n\n        # State variable history\n        # y_history[i, 0] is A, y_history[i, 1] is x\n        y_history = np.zeros((num_points, 2))\n        y_history[0, :] = [0.0, 0.0]  # Initial conditions\n\n        # Unpack case parameters\n        ca_params = {\n            \"C_rest\": case[\"C_rest\"], \"A_Ca\": case[\"A_Ca\"], \"t0\": case[\"t0\"],\n            \"tau_rise\": case[\"tau_rise\"], \"tau_decay\": case[\"tau_decay\"]\n        }\n        gamma = gamma_sl(case[\"SL\"])\n\n        # RK4 Integration\n        for i in range(num_points - 1):\n            t_i = time_points[i]\n            y_i = y_history[i, :]\n\n            k1 = ode_system(t_i, y_i, case[\"k_on\"], case[\"k_off\"], case[\"k_f\"], case[\"k_g\"], gamma, ca_params)\n            k2 = ode_system(t_i + 0.5 * dt, y_i + 0.5 * dt * k1, case[\"k_on\"], case[\"k_off\"], case[\"k_f\"], case[\"k_g\"], gamma, ca_params)\n            k3 = ode_system(t_i + 0.5 * dt, y_i + 0.5 * dt * k2, case[\"k_on\"], case[\"k_off\"], case[\"k_f\"], case[\"k_g\"], gamma, ca_params)\n            k4 = ode_system(t_i + dt, y_i + dt * k3, case[\"k_on\"], case[\"k_off\"], case[\"k_f\"], case[\"k_g\"], gamma, ca_params)\n            \n            y_next = y_i + (dt / 6.0) * (k1 + 2.0 * k2 + 2.0 * k3 + k4)\n            y_history[i + 1, :] = y_next\n        \n        # Extract crossbridge history\n        x_history = y_history[:, 1]\n        \n        # Calculate force history\n        force_history = case[\"F_max\"] * x_history * gamma\n\n        # Peak force and error calculation\n        F_peak_model = np.max(force_history)\n        error = abs(F_peak_model - case[\"F_peak_exp\"])\n        results.append(error)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}