{
    "hands_on_practices": [
        {
            "introduction": "精确的心率变异性（HRV）分析始于高质量的数据采集。在实践中，心电图（ECG）信号的离散采样不可避免地会在R波峰值检测中引入时间误差，即“抖动”。本练习  是一个基础实践，旨在连接硬件层面的采样率 $f_s$ 与最终RR间期序列的保真度，帮助您理解并量化这一核心噪声源。掌握这一概念对于为所有后续HRV分析建立可靠的噪声基底至关重要。",
            "id": "3906338",
            "problem": "以频率 $f_{s}$ 对心电图 (ECG) 进行采样，以检测 R 波峰并构建逐搏间隔（$RR$ 间期）序列。高频 (HF) 心率变异性 (HRV) 是指与呼吸性窦性心律失常相关的、$RR$ 序列在 $0.15$–$0.40$ Hz 标称频带内的波动。在 HF 频谱分析中，通常将 $RR$ 序列重采样到均匀时间网格上，并且必须避免在感兴趣的频带内产生混叠。ECG 的离散采样会在检测到的 R 波峰时间中引入时间量化，这种量化会以抖动的形式传播到 $RR$ 间期中。\n\n从奈奎斯特-香农采样定理和均匀量化误差的定义出发，论证选择 ECG 采样率 $f_{s}$ 的合理性，该采样率需满足以下要求：(i) 在后续为进行高频带分析而对 $RR$ 序列进行均匀重采样时防止混叠，以及 (ii) 最小化由 ECG 采样分辨率引起的时间抖动。假设以下模型前提：\n- 感兴趣的高频带为 $0.15$–$0.40$ Hz。\n- 在进行均匀重采样之前，用于频谱分析的 $RR$ 序列重采样将使用一个严格带限的低通插值滤波器。\n- 每个检测到的 R 波峰时间被量化到最近的 ECG 采样时间点，每个波峰的量化误差在区间 $\\left[-\\frac{T_{s}}{2}, \\frac{T_{s}}{2}\\right]$ 上均匀分布，其中 $T_{s} = \\frac{1}{f_{s}}$ 是 ECG 采样周期。\n- 连续 R 波峰的量化误差是相互独立的。\n\n然后，从第一性原理出发，推导单个 $RR$ 间期中仅由 ECG 采样量化引起的均方根 (RMS) 时间误差的解析表达式，并计算其在 $f_{s} = 250$ Hz 时的值。最终误差以秒为单位表示，并将答案四舍五入到四位有效数字。",
            "solution": "该问题是有效的，因为它科学地基于数字信号处理和生物医学系统建模的原理，问题陈述清晰，信息充分且一致，并以客观、正式的语言表述。我们将继续进行解答。\n\n该问题包括两部分。第一，基于混叠和时间抖动的考虑，论证 ECG 采样率 $f_{s}$ 选择的合理性。第二，推导 $RR$ 间期中均方根 (RMS) 时间误差的表达式，并计算其在给定 $f_s$ 下的值。\n\n第 1 部分：ECG 采样率 $f_s$ 选择的合理性论证。\n\n选择一个足够高的 ECG 采样率 $f_s$ 至关重要，主要有两个原因，这与问题的要求相符。\n\n(i) 防止混叠：问题要求在感兴趣的高频 (HF) 频带（定义为 $0.15$–$0.40$ Hz）内防止混叠。根据奈奎斯特-香农采样定理，为避免在对信号进行采样时发生混叠，采样频率必须严格大于信号中最大频率分量的两倍 ($f_{\\text{sample}} > 2f_{\\text{max}}$)。用于 HRV 分析的信号是 $RR$ 间期序列。这个序列通常以频率 $f_{\\text{resample}}$ 重采样到均匀的时间网格上。为了在不产生混叠的情况下分析高达 $f_{\\text{max,HRV}} = 0.40$ Hz 的频谱内容，这个重采样频率必须满足 $f_{\\text{resample}} > 2 \\times 0.40 \\text{ Hz} = 0.8$ Hz。\n\n虽然 ECG 采样率 $f_s$ 并不直接设定 $f_{\\text{resample}}$，但它是整个分析有效性的一个关键先决条件。$RR$ 间期是从 ECG 信号中 R 波峰的位置推导出来的。ECG 波形本身，特别是包含 R 波峰的 QRS 波群，其重要的频率分量可延伸至 $100$ Hz 甚至更高。为了准确地表示 QRS 波群的形态，从而精确定位 R 波峰，ECG 信号必须以足够高的采样率 $f_s$ 进行采样，以防止 ECG 信号本身发生混叠。如果 $f_s$ 过低，QRS 波群将会失真，导致 R 波峰检测中出现系统性误差，这种误差远比简单的量化抖动严重。因此，需要一个高的 $f_s$ (通常 $\\geq 250$ Hz) 来确保从中构建 $RR$ 序列的原始数据的完整性。这可以防止在进行 HRV 特定的重采样和频谱分析之前，$RR$ 间期数据就已损坏。\n\n(ii) 最小化时间抖动：ECG 采样的离散性在时域上引入了量化误差。R 波峰的真实时间可以发生在任何时刻，但它被检测并记录在最近的采样点的时间。这会产生一个时间误差，即抖动。问题陈述该误差在区间 $\\left[-\\frac{T_{s}}{2}, \\frac{T_{s}}{2}\\right]$ 上均匀分布，其中 $T_s = 1/f_s$ 是 ECG 采样周期。这个时间误差的大小与采样周期 $T_s$ 成正比。为了最小化这个误差，必须最小化 $T_s$。由于 $T_s = 1/f_s$，最小化 $T_s$ 等同于最大化采样频率 $f_s$。更高的采样率 $f_s$ 提供了更精细的时间网格，减少了最大可能的量化误差，从而降低了检测到的 R 波峰位置时间抖动的总体方差。这种抖动会传播到计算出的 $RR$ 间期中，在 HRV 频谱中表现为宽带噪声。通过选择高的 $f_s$ 来降低这个噪声基底，对于准确量化高频带中生理性的低幅度信号至关重要。\n\n总之，选择一个高的 $f_s$ 是为了确保准确捕捉底层的 ECG 信号以进行可靠的 R 波峰检测，并直接最小化在推导出的 $RR$ 间期序列中表现为噪声的时间量化误差。\n\n第 2 部分：RMS 时间误差的推导与计算。\n\n设两个连续 R 波峰的真实、连续时间位置为 $t_{i}$ 和 $t_{i+1}$。真实的 $RR$ 间期为 $RR_{\\text{true}} = t_{i+1} - t_{i}$。相应的测量时间，量化到最近的采样点，为 $\\hat{t}_i$ 和 $\\hat{t}_{i+1}$。测量的 $RR$ 间期为 $\\widehat{RR} = \\hat{t}_{i+1} - \\hat{t}_i$。单个波峰的量化误差是一个随机变量 $e_k = \\hat{t}_k - t_k$。问题陈述 $e_k$ 在区间 $[-\\frac{T_s}{2}, \\frac{T_s}{2}]$ 上均匀分布，其中 $T_s = 1/f_s$。\n\n单个 $RR$ 间期的误差 $E_{RR}$ 是测量间期与真实间期之差：\n$$E_{RR} = \\widehat{RR} - RR_{\\text{true}} = (\\hat{t}_{i+1} - \\hat{t}_i) - (t_{i+1} - t_i) = (\\hat{t}_{i+1} - t_{i+1}) - (\\hat{t}_i - t_i) = e_{i+1} - e_i$$\n我们需要求出 $E_{RR}$ 的均方根 (RMS) 值，其定义为 $\\sqrt{\\mathrm{E}[E_{RR}^2]}$，其中 $\\mathrm{E}[\\cdot]$ 是期望算子。\n\n首先，我们来求单个波峰量化误差 $e_k$ 的均值和方差。对于一个在 $[a, b]$ 上均匀分布的随机变量 $X$，其均值为 $\\mathrm{E}[X] = \\frac{a+b}{2}$，方差为 $\\mathrm{Var}(X) = \\frac{(b-a)^2}{12}$。对于 $e_k$，我们有 $a = -T_s/2$ 和 $b = T_s/2$。\n误差的均值为：\n$$\\mathrm{E}[e_k] = \\frac{-\\frac{T_s}{2} + \\frac{T_s}{2}}{2} = 0$$\n误差的方差为：\n$$\\mathrm{Var}(e_k) = \\frac{(\\frac{T_s}{2} - (-\\frac{T_s}{2}))^2}{12} = \\frac{T_s^2}{12}$$\n\n现在，我们分析 $RR$ 间期误差 $E_{RR} = e_{i+1} - e_i$。\n$RR$ 间期误差的均值为：\n$$\\mathrm{E}[E_{RR}] = \\mathrm{E}[e_{i+1} - e_i] = \\mathrm{E}[e_{i+1}] - \\mathrm{E}[e_i] = 0 - 0 = 0$$\n$RR$ 间期误差的方差为 $\\mathrm{Var}(E_{RR})$。问题陈述连续 R 波峰的量化误差是相互独立的。对于独立的随机变量，它们差的方差等于它们方差的和：\n$$\\mathrm{Var}(E_{RR}) = \\mathrm{Var}(e_{i+1} - e_i) = \\mathrm{Var}(e_{i+1}) + \\mathrm{Var}(e_i)$$\n由于 $e_i$ 和 $e_{i+1}$ 是同分布的，所以它们的方差相同：\n$$\\mathrm{Var}(E_{RR}) = \\frac{T_s^2}{12} + \\frac{T_s^2}{12} = \\frac{2T_s^2}{12} = \\frac{T_s^2}{6}$$\nRMS 值是 $\\sqrt{\\mathrm{E}[E_{RR}^2]}$。对于一个均值为 $\\mu_X$ 的随机变量 $X$，我们有 $\\mathrm{Var}(X) = \\mathrm{E}[X^2] - (\\mathrm{E}[X])^2$。由于 $\\mathrm{E}[E_{RR}] = 0$，方差等于均方值：$\\mathrm{Var}(E_{RR}) = \\mathrm{E}[E_{RR}^2]$。\n因此，RMS 误差是方差的平方根：\n$$\\text{RMS}(E_{RR}) = \\sqrt{\\mathrm{Var}(E_{RR})} = \\sqrt{\\frac{T_s^2}{6}} = \\frac{T_s}{\\sqrt{6}}$$\n这就是所求的单个 $RR$ 间期中 RMS 时间误差的解析表达式。代入 $T_s = 1/f_s$，表达式为 $\\frac{1}{f_s\\sqrt{6}}$。\n\n现在，我们计算 ECG 采样率为 $f_s = 250$ Hz 时的这个值。\n采样周期为 $T_s = \\frac{1}{f_s} = \\frac{1}{250} \\text{ s} = 0.004$ s。\n将该值代入 RMS 误差表达式：\n$$\\text{RMS}(E_{RR}) = \\frac{0.004}{\\sqrt{6}} \\text{ s}$$\n数值计算结果为：\n$$\\text{RMS}(E_{RR}) \\approx \\frac{0.004}{2.44948974...} \\text{ s} \\approx 0.00163299... \\text{ s}$$\n问题要求答案四舍五入到四位有效数字。\n$$\\text{RMS}(E_{RR}) \\approx 0.001633 \\text{ s}$$\n用科学记数法表示，即为 $1.633 \\times 10^{-3}$ s。",
            "answer": "$$\\boxed{1.633 \\times 10^{-3}}$$"
        },
        {
            "introduction": "呼吸性窦性心律不齐（RSA）是高频HRV的关键生理来源，反映了心肺之间的动态耦合。为了定量评估这种耦合关系，我们可以采用相干性等频域分析工具。本练习  提供了一个实用的编程任务，要求您估算模拟的呼吸信号与RR间期信号之间的相干性，从而深入理解如何量化和解释RSA。",
            "id": "3906314",
            "problem": "您的任务是形式化并计算一种频域耦合度量，该度量与生物医学系统建模中的心率变异性分析相关，用于衡量呼吸信号和心搏间隔序列之间的关系。目标是定义一个跨频率的无量纲线性关联度量，记为 $C_{xy}(f)$，用于衡量呼吸信号 $x(t)$ 和心搏间隔（与呼吸性窦性心律不齐相关）信号 $y(t)$ 之间的关系，然后计算并解释该度量在与呼吸性窦性心律不齐 (Respiratory Sinus Arrhythmia, RSA) 相关的高频带中的值。您需要从第一性原理出发，使用互相关和傅里叶变换的定义，以及从这些定义中导出的谱密度概念。您不能假设任何快捷公式。您的推导必须基于以下基本定义：\n- 互相关 $R_{xy}(\\tau)$ 定义为时移乘积的期望值，$R_{xy}(\\tau) = \\mathbb{E}[x(t)\\,y(t+\\tau)]$。\n- 功率谱密度由自相关的傅里叶变换定义，互谱密度由互相关的傅里叶变换定义。\n- 傅里叶变换使用弧度作为角度单位，频率单位为赫兹，因此其参数为 $2\\pi f t$。\n\n在完成推导，得到一个界于 $0$ 和 $1$ 之间的归一化频域关联度量 $C_{xy}(f)$ 后，您需要实现一个程序，使用基于相同原理的离散时间估计器来计算它。具体要求如下：\n- 程序必须使用与上述推导一致的估计器，并通过加窗平均周期图法 (Welch 法) 对自谱密度和互谱密度进行估计，从而计算幅值平方相干性 $C_{xy}(f)$。\n- 通过在赫兹单位下的高频带 $[0.15,\\,0.40]$ 上对 $C_{xy}(f)$ 进行平均，来解释呼吸性窦性心律不齐的强度；所得的平均值是一个介于 $0$ 和 $1$ 之间的实数，值越大表示 RSA 耦合越强。\n\n信号和单位：\n- 将 $x(t)$ 视为均匀采样的呼吸时间序列，将 $y(t)$ 视为均匀采样的心搏间隔时间序列（心搏间隔图）。时间单位为秒，频率单位为赫兹，正弦参数中的角度单位为弧度，$C_{xy}(f)$ 为无量纲。\n- 使用采样频率 $f_s$（单位为赫兹）和持续时间 $T$（单位为秒）构建 $N = \\lfloor f_s T \\rfloor$ 个样本，采样间隔为 $\\Delta t = 1/f_s$。\n- 呼吸信号建模为 $x(t) = A_r \\sin(2\\pi f_r t) + \\eta_x(t)$。\n- 心搏间隔信号建模为 $y(t) = RR_0 + k \\sin(2\\pi f_r t + \\phi) + \\eta_y(t)$，其中 $RR_0$ 是基线间隔（单位为秒），$k$ 是耦合强度（单位为秒），$\\phi$ 是相位偏移（单位为弧度）。设 $\\phi = 0$。\n- 噪声项 $\\eta_x(t)$ 和 $\\eta_y(t)$ 是独立的零均值高斯白噪声，其标准差分别为 $\\sigma_x$ 和 $\\sigma_y$。\n\n算法要求：\n- 使用加窗、重叠分段平均 (Welch 法) 和汉宁窗进行谱估计。\n- 确保频率分辨率足以分辨 $[0.15,\\,0.40]$ 赫兹的高频带；角度单位为弧度。\n- 计算与您的推导一致的 $C_{xy}(f)$，然后计算 $C_{xy}(f)$ 在高频带上的平均值。\n\n测试套件：\n使用以下参数集构建信号并计算平均高频相干性。对于每种情况，设置 $f_s = 4$（赫兹），并使用指定的独立随机种子以保证可复现性。\n1. 理想路径 RSA 情况：$T = 300$, $A_r = 1.0$, $f_r = 0.25$, $RR_0 = 0.80$, $k = 0.12$, $\\sigma_x = 0.05$, $\\sigma_y = 0.02$, seed $= 42$。\n2. 无耦合情况：$T = 300$, $A_r = 1.0$, $f_r = 0.25$, $RR_0 = 0.80$, $k = 0.00$, $\\sigma_x = 0.05$, $\\sigma_y = 0.02$, seed $= 43$。\n3. 边界高频 RSA 情况：$T = 300$, $A_r = 1.0$, $f_r = 0.40$, $RR_0 = 0.80$, $k = 0.12$, $\\sigma_x = 0.05$, $\\sigma_y = 0.02$, seed $= 44$。\n4. 低频呼吸耦合情况：$T = 300$, $A_r = 1.0$, $f_r = 0.10$, $RR_0 = 0.80$, $k = 0.12$, $\\sigma_x = 0.05$, $\\sigma_y = 0.02$, seed $= 45$。\n\n输出规格：\n- 对于每个测试用例，计算 $C_{xy}(f)$ 在 $[0.15,\\,0.40]$ 赫兹频带上的平均值，并将其作为浮点数返回。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个值都四舍五入到三位小数，例如 $[r_1,r_2,r_3,r_4]$，其中每个 $r_i$ 是第 $i$ 个测试用例的平均高频相干性。",
            "solution": "该问题要求对一个归一化的频域耦合度量（即幅值平方相干性）进行形式化推导，并随后对建模的呼吸信号和心搏间隔信号进行计算。验证和解决方案如下所述。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n\n- **基本定义：**\n    - 互相关：$R_{xy}(\\tau) = \\mathbb{E}[x(t)\\,y(t+\\tau)]$。\n    - 谱密度（功率谱和互谱）被定义为相应相关函数的傅里叶变换。\n    - 傅里叶变换角度：参数为 $2\\pi f t$。\n- **目标：**\n    - 推导一个界于 0 和 1 之间的归一化频域关联度量 $C_{xy}(f)$。\n    - 使用加窗平均周期图法 (Welch 法) 计算幅值平方相干性 $C_{xy}(f)$。\n    - 通过在 $[0.15,\\,0.40]$ 赫兹的高频 (HF) 频带上对 $C_{xy}(f)$ 进行平均，来解释呼吸性窦性心律不齐 (RSA) 的强度。\n- **信号模型和参数：**\n    - 信号：$x(t)$ (呼吸) 和 $y(t)$ (心搏间隔)。\n    - 时间 $t$ 单位为秒，频率 $f$ 单位为赫兹。\n    - 采样频率：$f_s$。采样间隔：$\\Delta t = 1/f_s$。样本数：$N = \\lfloor f_s T \\rfloor$。\n    - 呼吸信号：$x(t) = A_r \\sin(2\\pi f_r t) + \\eta_x(t)$。\n    - 心搏间隔信号：$y(t) = RR_0 + k \\sin(2\\pi f_r t + \\phi) + \\eta_y(t)$，相位偏移 $\\phi=0$。\n    - 噪声：$\\eta_x(t)$ 和 $\\eta_y(t)$ 是独立的零均值高斯白噪声，标准差分别为 $\\sigma_x$ 和 $\\sigma_y$。\n- **算法要求：**\n    - 谱估计：使用汉宁窗的 Welch 法。\n    - 平均频带：$[0.15,\\,0.40]$ Hz。\n- **测试套件：**\n    - 公共参数：$f_s = 4$ Hz, $T = 300$ s。\n    - 情况 1 (理想路径)：$A_r = 1.0, f_r = 0.25, RR_0 = 0.80, k = 0.12, \\sigma_x = 0.05, \\sigma_y = 0.02$, seed $= 42$。\n    - 情况 2 (无耦合)：$A_r = 1.0, f_r = 0.25, RR_0 = 0.80, k = 0.00, \\sigma_x = 0.05, \\sigma_y = 0.02$, seed $= 43$。\n    - 情况 3 (边界高频)：$A_r = 1.0, f_r = 0.40, RR_0 = 0.80, k = 0.12, \\sigma_x = 0.05, \\sigma_y = 0.02$, seed $= 44$。\n    - 情况 4 (低频)：$A_r = 1.0, f_r = 0.10, RR_0 = 0.80, k = 0.12, \\sigma_x = 0.05, \\sigma_y = 0.02$, seed $= 45$。\n- **输出规格：**\n    - 单行输出：`[r_1,r_2,r_3,r_4]`，其中 $r_i$ 是第 $i$ 种情况下的平均高频相干性，四舍五入到三位小数。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n根据验证标准对问题陈述进行评估：\n\n- **科学基础：** 该问题牢固地植根于时间序列分析和生物医学信号处理的既定原则。相关性、谱密度、相干性和 Welch 法等概念是这些领域的标准工具。将其应用于呼吸性窦性心律不齐 (RSA) 的建模是生理学和生物医学工程中一个经典且被充分理解的问题。该问题具有科学合理性。\n- **适定性：** 所有必要的参数、信号模型和算法约束都已明确提供。目标定义清晰：推导一个标准量，并为一组给定参数计算它。这种结构确保了在指定随机种子以保证可复现性的前提下，可以为每个测试用例找到唯一且有意义的解决方案。该问题是适定的。\n- **客观性：** 问题使用精确、量化且无偏见的技术语言进行阐述。它不包含主观性陈述或观点。\n- **完整性与一致性：** 问题是自洽的。它提供了解决问题所需的所有数据和定义。所提供的信息中没有矛盾之处。\n- **现实性：** 虽然信号模型是对真实生理信号的简化，但它们是研究 RSA 线性耦合方面的标准且有用的一阶近似。参数和频带在生理学上是现实的。\n\n**步骤 3：结论与行动**\n\n该问题有效。它满足了科学性、适定性、客观性和完整性的所有标准。因此，将提供完整的解决方案。\n\n### 幅值平方相干性的推导\n\n我们按照规定，从两个联合宽平稳随机过程 $x(t)$ 和 $y(t)$ 的第一性原理开始。\n\n$x(t)$ 和 $y(t)$ 之间的互相关函数定义为：\n$$ R_{xy}(\\tau) = \\mathbb{E}[x(t) y(t+\\tau)] $$\n其中 $\\mathbb{E}[\\cdot]$ 表示期望算子，$\\tau$ 是时间延迟。自相关函数是其特例：\n$$ R_{xx}(\\tau) = \\mathbb{E}[x(t) x(t+\\tau)] $$\n$$ R_{yy}(\\tau) = \\mathbb{E}[y(t) y(t+\\tau)] $$\n\nWiener-Khinchin 定理通过傅里叶变换将相关函数与谱密度函数联系起来。互谱密度 $S_{xy}(f)$ 是互相关函数的傅里叶变换：\n$$ S_{xy}(f) = \\mathcal{F}\\{R_{xy}(\\tau)\\} = \\int_{-\\infty}^{\\infty} R_{xy}(\\tau) e^{-i 2\\pi f \\tau} d\\tau $$\n类似地，功率谱密度 (PSDs) $S_{xx}(f)$ 和 $S_{yy}(f)$ 分别是其各自自相关函数的傅里叶变换：\n$$ S_{xx}(f) = \\mathcal{F}\\{R_{xx}(\\tau)\\} = \\int_{-\\infty}^{\\infty} R_{xx}(\\tau) e^{-i 2\\pi f \\tau} d\\tau $$\n$$ S_{yy}(f) = \\mathcal{F}\\{R_{yy}(\\tau)\\} = \\int_{-\\infty}^{\\infty} R_{yy}(\\tau) e^{-i 2\\pi f \\tau} d\\tau $$\n\n功率谱密度 $S_{xx}(f)$ 和 $S_{yy}(f)$ 是实值且非负的，表示信号功率在频率上的分布。互谱密度 $S_{xy}(f)$ 通常是一个复函数。其幅值表示 $x(t)$ 和 $y(t)$ 在频率 $f$ 上的相关程度，其相位表示信号在该频率下的相位延迟。\n\n为了获得一个无量纲的线性关联度量，我们对互谱密度进行归一化。这引出了复相干函数 $\\gamma_{xy}(f)$ 的定义：\n$$ \\gamma_{xy}(f) = \\frac{S_{xy}(f)}{\\sqrt{S_{xx}(f) S_{yy}(f)}} $$\n\n最常用的度量是幅值平方相干性 (MSC)，此处记为 $C_{xy}(f)$，它是一个实值函数：\n$$ C_{xy}(f) = |\\gamma_{xy}(f)|^2 = \\frac{|S_{xy}(f)|^2}{S_{xx}(f) S_{yy}(f)} $$\n\n为了证明 $C_{xy}(f)$ 界于 $0$ 和 $1$ 之间，我们依赖一个等价于 Cauchy-Schwarz 不等式的性质。考虑一个任意复常数 $\\alpha$。对于所有频率 $f$，组合过程 $x(t) - \\alpha y(t)$ 的功率谱密度必须是非负的：\n$$ S_{x-\\alpha y, x-\\alpha y}(f) \\ge 0 $$\n利用期望和傅里叶变换算子的线性性质展开此表达式，我们得到：\n$$ S_{x-\\alpha y, x-\\alpha y}(f) = S_{xx}(f) - \\alpha S_{yx}(f) - \\alpha^* S_{xy}(f) + |\\alpha|^2 S_{yy}(f) \\ge 0 $$\n注意 $S_{yx}(f) = S_{xy}^*(f)$。因此，表达式变为：\n$$ S_{xx}(f) - \\alpha S_{xy}^*(f) - \\alpha^* S_{xy}(f) + |\\alpha|^2 S_{yy}(f) \\ge 0 $$\n这个不等式必须对任意复数 $\\alpha$ 成立。我们选择一个特定的 $\\alpha$ 来最大化所获得的信息。令 $\\alpha = \\frac{S_{xy}(f)}{S_{yy}(f)}$。将此代入不等式（假设 $S_{yy}(f) > 0$）：\n$$ S_{xx}(f) - \\frac{S_{xy}(f)}{S_{yy}(f)} S_{xy}^*(f) - \\frac{S_{xy}^*(f)}{S_{yy}(f)} S_{xy}(f) + \\frac{|S_{xy}(f)|^2}{S_{yy}(f)^2} S_{yy}(f) \\ge 0 $$\n$$ S_{xx}(f) - \\frac{|S_{xy}(f)|^2}{S_{yy}(f)} - \\frac{|S_{xy}(f)|^2}{S_{yy}(f)} + \\frac{|S_{xy}(f)|^2}{S_{yy}(f)} \\ge 0 $$\n$$ S_{xx}(f) - \\frac{|S_{xy}(f)|^2}{S_{yy}(f)} \\ge 0 $$\n整理各项，我们得到：\n$$ S_{xx}(f) S_{yy}(f) \\ge |S_{xy}(f)|^2 $$\n由于功率谱密度是非负的，我们可以用乘积 $S_{xx}(f)S_{yy}(f)$（假设其非零）去除，而不改变不等式的方向：\n$$ 1 \\ge \\frac{|S_{xy}(f)|^2}{S_{xx}(f) S_{yy}(f)} $$\n$C_{xy}(f)$ 定义的左侧是一个平方幅值除以非负值，因此它必须是非负的。综合这些结果，我们确认了其界限：\n$$ 0 \\le C_{xy}(f) \\le 1 $$\n推导至此完成。$C_{xy}(f)$ 提供了一个归一化的度量，用于衡量两个信号在每个频率 $f$ 上的线性耦合程度。值为 $1$ 表示完全线性相关，而值为 $0$ 表示在该频率下没有线性相关。\n\n### 计算实现\n\n程序将实现对给定测试用例计算 $C_{xy}(f)$ 及其在 HF 频带上的平均值。\n\n1.  **信号生成**：对于每个测试用例，根据指定的模型生成离散时间信号 $x[n]$ 和 $y[n]$。从 $t=0$ 到 $T$ 以 $\\Delta t=1/f_s$ 的步长创建一个时间向量。使用为每个案例设定的可复现随机数生成器生成噪声。$y(t)$ 中的直流项 $RR_0$ 由谱估计函数处理。\n\n2.  **谱估计 (Welch 法)**：使用 `scipy.signal.coherence` 函数。该函数内部通过以下步骤估计功率谱密度 ($S_{xx}, S_{yy}$) 和互谱密度 ($S_{xy}$):\n    a. 将信号分割成重叠的段。\n    b. 对每个段应用窗函数（按要求使用汉宁窗）以减少频谱泄漏。\n    c. 对每个段计算用于功率谱密度的幅值平方 FFT 和用于互谱密度的共轭乘积。\n    d. 在所有段上对这些谱估计进行平均。这种平均降低了最终估计的方差。\n    然后，该函数根据推导出的公式计算 $C_{xy}(f)$。选择段长度 (`nperseg`) 为 $256$，以提供 $f_s/\\text{nperseg} = 4/256 \\approx 0.0156$ Hz 的频率分辨率，这对于指定的频带是足够的。使用 $50\\%$ 的重叠 (`noverlap=128`)，这是一个常见的选择。\n\n3.  **频带平均**：相干性函数的输出是一个相干值向量和一个对应的频率向量。程序识别出频率在 HF 频带 $[0.15, 0.40]$ Hz 内的索引。然后计算这些索引处的相干值的平均值，得到一个量化 RSA 强度的标量值。\n\n4.  **迭代与输出**：对所有四个测试用例重复此过程。收集得到的平均相干性值，并格式化为所需的字符串输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import signal\n\ndef solve():\n    \"\"\"\n    Solves the problem of computing high-frequency coherence for four test cases.\n    \"\"\"\n    \n    test_cases = [\n        # Case 1: Happy path RSA\n        {'T': 300, 'Ar': 1.0, 'fr': 0.25, 'RR0': 0.80, 'k': 0.12, 'sigma_x': 0.05, 'sigma_y': 0.02, 'seed': 42, 'fs': 4.0},\n        # Case 2: No coupling\n        {'T': 300, 'Ar': 1.0, 'fr': 0.25, 'RR0': 0.80, 'k': 0.00, 'sigma_x': 0.05, 'sigma_y': 0.02, 'seed': 43, 'fs': 4.0},\n        # Case 3: Boundary high-frequency RSA\n        {'T': 300, 'Ar': 1.0, 'fr': 0.40, 'RR0': 0.80, 'k': 0.12, 'sigma_x': 0.05, 'sigma_y': 0.02, 'seed': 44, 'fs': 4.0},\n        # Case 4: Low-frequency respiration coupling\n        {'T': 300, 'Ar': 1.0, 'fr': 0.10, 'RR0': 0.80, 'k': 0.12, 'sigma_x': 0.05, 'sigma_y': 0.02, 'seed': 45, 'fs': 4.0},\n    ]\n\n    results = []\n\n    def compute_hf_coherence(params):\n        \"\"\"\n        Generates signals and computes the average high-frequency coherence.\n        \"\"\"\n        # Unpack parameters\n        T = params['T']\n        Ar = params['Ar']\n        fr = params['fr']\n        RR0 = params['RR0']\n        k = params['k']\n        sigma_x = params['sigma_x']\n        sigma_y = params['sigma_y']\n        seed = params['seed']\n        fs = params['fs']\n\n        # Set up a random number generator for reproducibility\n        rng = np.random.default_rng(seed)\n\n        # Generate time vector\n        N = int(fs * T)\n        t = np.arange(N) / fs\n\n        # Generate noise signals\n        eta_x = rng.normal(0, sigma_x, N)\n        eta_y = rng.normal(0, sigma_y, N)\n\n        # Generate respiration and interbeat-interval signals\n        # x(t) = A_r * sin(2*pi*f_r*t) + eta_x(t)\n        x = Ar * np.sin(2 * np.pi * fr * t) + eta_x\n        # y(t) = RR_0 + k * sin(2*pi*f_r*t) + eta_y(t), phase phi=0\n        y = RR0 + k * np.sin(2 * np.pi * fr * t) + eta_y\n\n        # Define spectral estimation parameters for Welch's method\n        # nperseg determines frequency resolution. res = fs/nperseg = 4/256 = 0.015625 Hz\n        nperseg = 256\n        noverlap = nperseg // 2 # 50% overlap\n\n        # Compute magnitude-squared coherence using Welch's method\n        # The detrend='constant' argument (default) correctly handles the RR0 mean offset in y(t).\n        frequencies, Cxy = signal.coherence(x, \n                                             y, \n                                             fs=fs, \n                                             window='hann', \n                                             nperseg=nperseg, \n                                             noverlap=noverlap)\n\n        # Define high-frequency band for RSA\n        hf_band_low = 0.15\n        hf_band_high = 0.40\n\n        # Find indices of frequencies within the high-frequency band\n        hf_indices = np.where((frequencies >= hf_band_low) & (frequencies <= hf_band_high))\n        \n        # Extract coherence values in the HF band\n        hf_coherence = Cxy[hf_indices]\n        \n        # Compute the average coherence over the band\n        if len(hf_coherence) == 0:\n            return 0.0 # Should not happen with chosen parameters\n        \n        avg_hf_coherence = np.mean(hf_coherence)\n\n        return avg_hf_coherence\n\n    for case in test_cases:\n        result = compute_hf_coherence(case)\n        results.append(result)\n\n    # Format the final output string as specified, rounding to 3 decimal places\n    formatted_results = [f\"{r:.3f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "除了非参数频域方法外，参数化建模为HRV分析提供了另一种强大视角，能够捕捉心率逐搏（beat-by-beat）的历史依赖动态。本练习  将引导您构建一个先进的、依赖于历史信息的逆高斯更新过程模型。您将通过推导其得分函数——即对数似然函数的梯度——来完成模型拟合中最关键的第一步，这是将复杂理论模型应用于实际数据分析的核心技能。",
            "id": "3906288",
            "problem": "给定一个受试者在静息状态下观测到的逐搏 $RR$ 间期序列 $\\{t_{i}\\}_{i=1}^{n}$（单位为秒）。假设搏动间隔构成一个更新过程，其在给定直至第 $i-1$ 次搏动的历史 $\\mathcal{H}_{i-1}$ 条件下的条件到达间隔时间分布为逆高斯分布，且其均值依赖于历史。具体来说，设条件分布为逆高斯分布，其均值为 $\\mu_{i}$，形态参数为 $\\lambda$，其中均值通过一个简约的自回归历史特征依赖于历史，形式如下\n$$\n\\mu_{i} \\equiv \\mu(t_{i}\\,|\\,\\mathcal{H}_{i-1}) \\;=\\; \\exp\\!\\big(\\beta_{0} + \\beta_{1}\\, (t_{i-1} - m_{i-1})\\big),\n$$\n且形态参数 $\\lambda>0$ 对所有 $i$ 保持不变。量 $m_{i}$ 是一个平滑基线，由一个指数加权移动平均构造，其平滑因子 $\\alpha \\in (0,1)$ 已知，\n$$\nm_{i} \\;=\\; (1-\\alpha)\\, m_{i-1} + \\alpha\\, t_{i}, \\quad \\text{其中 } m_{0} \\text{ 已知},\n$$\n并且我们以初始值 $t_{0}$ 已知为条件。对于 $t>0$，均值 $\\mu>0$ 和形态参数 $\\lambda>0$ 的逆高斯密度为\n$$\nf(t \\mid \\mu,\\lambda) \\;=\\; \\sqrt{\\frac{\\lambda}{2\\pi t^{3}}}\\, \\exp\\!\\left(-\\frac{\\lambda\\,(t-\\mu)^{2}}{2\\,\\mu^{2}\\, t}\\right).\n$$\n假设在给定历史的条件下，各区间条件独立，因此似然函数是条件密度的乘积。仅使用上述定义和最大似然估计的基本原理，基于 $\\{t_{i}\\}_{i=1}^{n}$ 构建参数向量 $\\theta = (\\beta_{0}, \\beta_{1}, \\lambda)$ 的完整对数似然函数，并推导出得分函数 $s(\\theta) = \\partial \\ell(\\theta)/\\partial \\theta$ 的封闭形式解析表达式。将最终的得分向量明确地用 $\\{t_{i}\\}_{i=1}^{n}$、$\\{m_{i-1}\\}_{i=1}^{n}$、$\\alpha$ 以及参数 $\\beta_{0}$、$\\beta_{1}$ 和 $\\lambda$ 表示，其中 $\\{m_{i}\\}$ 和 $t_{0}$ 被视为数据的给定函数和已知常数（因此不引入额外参数）。\n\n将你的最终答案表示为 $s(\\theta)$ 的单个行向量表达式，其元素分别对应于对 $\\beta_{0}$、$\\beta_{1}$ 和 $\\lambda$ 的偏导数。不要四舍五入。最终答案中不需要单位。",
            "solution": "该问题要求针对一个特定的心率变异性时间序列模型，推导其对数似然函数及相应的得分函数。\n\n### 问题验证\n\n首先，我们验证问题陈述。\n\n**步骤 1：提取已知条件**\n- 数据：一个 $RR$ 间期序列 $\\{t_{i}\\}_{i=1}^{n}$。\n- 模型：一个更新过程，其中给定历史 $\\mathcal{H}_{i-1}$ 的条件下，到达间隔时间 $t_i$ 的条件分布为逆高斯分布，$t_i | \\mathcal{H}_{i-1} \\sim \\text{IG}(\\mu_i, \\lambda)$。\n- 逆高斯概率密度函数（PDF）：$f(t \\mid \\mu,\\lambda) = \\sqrt{\\frac{\\lambda}{2\\pi t^{3}}}\\, \\exp\\left(-\\frac{\\lambda\\,(t-\\mu)^{2}}{2\\,\\mu^{2}\\, t}\\right)$，对于 $t>0$, $\\mu>0$, $\\lambda>0$。\n- 条件均值：$\\mu_{i} = \\exp(\\beta_{0} + \\beta_{1}\\, (t_{i-1} - m_{i-1}))$。\n- 形态参数：$\\lambda > 0$，对所有 $i$ 恒定。\n- 平滑基线：$m_{i} = (1-\\alpha)\\, m_{i-1} + \\alpha\\, t_{i}$，其中 $\\alpha \\in (0,1)$ 且 $m_{0}$ 已知。\n- 初始条件：$t_{0}$ 已知。\n- 参数向量：$\\theta = (\\beta_{0}, \\beta_{1}, \\lambda)$。\n- 任务：构建对数似然函数 $\\ell(\\theta)$ 并推导得分函数 $s(\\theta) = \\partial \\ell(\\theta)/\\partial \\theta$。\n\n**步骤 2：使用提取的已知条件进行验证**\n对问题的有效性进行评估。\n- **科学基础：** 该模型是一种带有自回归特征的点过程模型的特定形式，这是生物医学系统建模（尤其是心率变异性）中的一种标准方法。逆高斯分布是模拟正值事件时间的常用且合适的选择。该模型在科学上是连贯的。\n- **适定性：** 该问题在数学上是适定的。它要求为一个完全指定的参数模型推导对数似然及其梯度（得分函数）。这是最大似然理论中的一个标准且可解的问题。\n- **客观性：** 问题陈述使用了精确、无歧义的数学语言。\n\n该问题没有表现出任何诸如科学上不合理、不完整、矛盾或含糊不清的缺陷。\n\n**步骤 3：结论与行动**\n问题被判定为**有效**。我们继续推导解答。\n\n### 似然与对数似然函数的构建\n\n问题陈述，在给定历史的条件下，各区间是条件独立的。观测序列 $\\{t_i\\}_{i=1}^n$ 的总似然函数 $L(\\theta)$ 是条件概率密度的乘积：\n$$\nL(\\theta) = \\prod_{i=1}^{n} f(t_i \\mid \\mathcal{H}_{i-1}) = \\prod_{i=1}^{n} f(t_i \\mid \\mu_i(\\beta_0, \\beta_1), \\lambda)\n$$\n其中参数为 $\\theta = (\\beta_0, \\beta_1, \\lambda)$。\n\n对数似然函数 $\\ell(\\theta) = \\ln L(\\theta)$ 是各个对数密度的和：\n$$\n\\ell(\\theta) = \\sum_{i=1}^{n} \\ln f(t_i \\mid \\mu_i, \\lambda)\n$$\n代入逆高斯密度的表达式：\n$$\n\\ell(\\theta) = \\sum_{i=1}^{n} \\ln \\left[ \\left(\\frac{\\lambda}{2\\pi t_i^3}\\right)^{1/2} \\exp\\left(-\\frac{\\lambda(t_i - \\mu_i)^2}{2\\mu_i^2 t_i}\\right) \\right]\n$$\n$$\n\\ell(\\theta) = \\sum_{i=1}^{n} \\left[ \\frac{1}{2}\\ln\\left(\\frac{\\lambda}{2\\pi}\\right) - \\frac{3}{2}\\ln(t_i) - \\frac{\\lambda(t_i - \\mu_i)^2}{2\\mu_i^2 t_i} \\right]\n$$\n将依赖于参数的项与不依赖参数的项分开：\n$$\n\\ell(\\theta) = \\frac{n}{2}\\ln(\\lambda) - \\frac{n}{2}\\ln(2\\pi) - \\frac{3}{2}\\sum_{i=1}^{n}\\ln(t_i) - \\frac{\\lambda}{2}\\sum_{i=1}^{n}\\frac{(t_i - \\mu_i)^2}{\\mu_i^2 t_i}\n$$\n项 $-\\frac{n}{2}\\ln(2\\pi) - \\frac{3}{2}\\sum_{i=1}^{n}\\ln(t_i)$ 相对于 $\\theta$ 是常数，在求导时会消失。为了求得得分函数，我们可以专注于 $\\ell(\\theta)$ 中依赖于参数的部分：\n$$\n\\ell(\\theta) = \\frac{n}{2}\\ln(\\lambda) - \\frac{\\lambda}{2}\\sum_{i=1}^{n}\\frac{(t_i - \\mu_i)^2}{\\mu_i^2 t_i} + \\text{const.}\n$$\n项 $\\mu_i = \\exp(\\beta_0 + \\beta_1(t_{i-1} - m_{i-1}))$ 依赖于 $\\beta_0$ 和 $\\beta_1$。\n\n### 得分函数推导\n\n得分函数是对数似然函数关于每个参数的偏导数向量：$s(\\theta) = \\frac{\\partial\\ell(\\theta)}{\\partial\\theta} = \\begin{pmatrix} \\frac{\\partial\\ell}{\\partial\\beta_0}  \\frac{\\partial\\ell}{\\partial\\beta_1}  \\frac{\\partial\\ell}{\\partial\\lambda} \\end{pmatrix}$。\n\n**1. 关于 $\\lambda$ 的偏导数**\n\n我们对 $\\ell(\\theta)$ 关于 $\\lambda$ 求导，将 $\\mu_i$ 视为常数，因为它不依赖于 $\\lambda$。\n$$\n\\frac{\\partial\\ell}{\\partial\\lambda} = \\frac{\\partial}{\\partial\\lambda}\\left( \\frac{n}{2}\\ln(\\lambda) - \\frac{\\lambda}{2}\\sum_{i=1}^{n}\\frac{(t_i - \\mu_i)^2}{\\mu_i^2 t_i} \\right)\n$$\n$$\n\\frac{\\partial\\ell}{\\partial\\lambda} = \\frac{n}{2\\lambda} - \\frac{1}{2}\\sum_{i=1}^{n}\\frac{(t_i - \\mu_i)^2}{\\mu_i^2 t_i}\n$$\n\n**2. 关于 $\\beta_0$ 和 $\\beta_1$ 的偏导数**\n\n这些导数需要使用链式法则，因为 $\\ell$ 通过 $\\mu_i$ 依赖于 $\\beta_0$ 和 $\\beta_1$。设 $\\ell_i$ 是对数似然和中的第 $i$ 项。\n$$\n\\frac{\\partial\\ell}{\\partial\\beta_j} = \\sum_{i=1}^{n} \\frac{\\partial\\ell_i}{\\partial\\beta_j} = \\sum_{i=1}^{n} \\frac{\\partial\\ell_i}{\\partial\\mu_i} \\frac{\\partial\\mu_i}{\\partial\\beta_j} \\quad \\text{对于 } j=0, 1.\n$$\n首先，我们求 $\\ell_i$ 的相关部分关于 $\\mu_i$ 的导数：\n$$\n\\frac{\\partial}{\\partial\\mu_i}\\left( -\\frac{\\lambda(t_i - \\mu_i)^2}{2\\mu_i^2 t_i} \\right) = -\\frac{\\lambda}{2t_i} \\frac{\\partial}{\\partial\\mu_i}\\left( \\frac{t_i^2 - 2t_i\\mu_i + \\mu_i^2}{\\mu_i^2} \\right)\n$$\n$$\n= -\\frac{\\lambda}{2t_i} \\frac{\\partial}{\\partial\\mu_i}\\left( t_i^2\\mu_i^{-2} - 2t_i\\mu_i^{-1} + 1 \\right)\n$$\n$$\n= -\\frac{\\lambda}{2t_i} \\left( t_i^2(-2)\\mu_i^{-3} - 2t_i(-1)\\mu_i^{-2} \\right) = -\\frac{\\lambda}{2t_i} \\left( \\frac{-2t_i^2}{\\mu_i^3} + \\frac{2t_i}{\\mu_i^2} \\right)\n$$\n$$\n= -\\frac{\\lambda}{2t_i} \\cdot \\frac{2t_i}{\\mu_i^3} (-\\mu_i + t_i) = \\frac{\\lambda(t_i - \\mu_i)}{\\mu_i^3}\n$$\n接下来，我们求 $\\mu_i$ 关于 $\\beta_0$ 和 $\\beta_1$ 的偏导数：\n$$\n\\mu_i = \\exp(\\beta_0 + \\beta_1(t_{i-1} - m_{i-1}))\n$$\n$$\n\\frac{\\partial\\mu_i}{\\partial\\beta_0} = \\exp(\\beta_0 + \\beta_1(t_{i-1} - m_{i-1})) \\cdot 1 = \\mu_i\n$$\n$$\n\\frac{\\partial\\mu_i}{\\partial\\beta_1} = \\exp(\\beta_0 + \\beta_1(t_{i-1} - m_{i-1})) \\cdot (t_{i-1} - m_{i-1}) = \\mu_i(t_{i-1} - m_{i-1})\n$$\n现在，我们使用链式法则组合这些结果。\n\n对于 $\\beta_0$：\n$$\n\\frac{\\partial\\ell}{\\partial\\beta_0} = \\sum_{i=1}^{n} \\frac{\\partial\\ell_i}{\\partial\\mu_i}\\frac{\\partial\\mu_i}{\\partial\\beta_0} = \\sum_{i=1}^{n} \\left(\\frac{\\lambda(t_i - \\mu_i)}{\\mu_i^3}\\right) (\\mu_i) = \\sum_{i=1}^{n} \\frac{\\lambda(t_i - \\mu_i)}{\\mu_i^2}\n$$\n\n对于 $\\beta_1$：\n$$\n\\frac{\\partial\\ell}{\\partial\\beta_1} = \\sum_{i=1}^{n} \\frac{\\partial\\ell_i}{\\partial\\mu_i}\\frac{\\partial\\mu_i}{\\partial\\beta_1} = \\sum_{i=1}^{n} \\left(\\frac{\\lambda(t_i - \\mu_i)}{\\mu_i^3}\\right) (\\mu_i(t_{i-1} - m_{i-1}))\n$$\n$$\n\\frac{\\partial\\ell}{\\partial\\beta_1} = \\sum_{i=1}^{n} \\frac{\\lambda(t_i - \\mu_i)(t_{i-1} - m_{i-1})}{\\mu_i^2}\n$$\n\n**3. 组合得分向量**\n\n得分函数 $s(\\theta)$ 是偏导数的行向量：\n$$\ns(\\theta) = \\begin{pmatrix} \\frac{\\partial\\ell}{\\partial\\beta_0}  \\frac{\\partial\\ell}{\\partial\\beta_1}  \\frac{\\partial\\ell}{\\partial\\lambda} \\end{pmatrix}\n$$\n代入推导出的表达式，我们得到最终结果：\n$$\ns(\\theta) = \\begin{pmatrix}\n\\displaystyle\\sum_{i=1}^{n} \\frac{\\lambda(t_i - \\mu_i)}{\\mu_i^2} \n\\displaystyle\\sum_{i=1}^{n} \\frac{\\lambda(t_i - \\mu_i)(t_{i-1} - m_{i-1})}{\\mu_i^2} \n\\displaystyle\\frac{n}{2\\lambda} - \\frac{1}{2}\\sum_{i=1}^{n}\\frac{(t_i - \\mu_i)^2}{\\mu_i^2 t_i}\n\\end{pmatrix}\n$$\n其中 $\\mu_i = \\exp(\\beta_0 + \\beta_1(t_{i-1} - m_{i-1}))$。此表达式是用指定的量表示的。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\displaystyle\\sum_{i=1}^{n} \\frac{\\lambda(t_i - \\mu_i)}{\\mu_i^2}  \\displaystyle\\sum_{i=1}^{n} \\frac{\\lambda(t_i - \\mu_i)(t_{i-1} - m_{i-1})}{\\mu_i^2}  \\displaystyle\\frac{n}{2\\lambda} - \\frac{1}{2}\\sum_{i=1}^{n}\\frac{(t_i - \\mu_i)^{2}}{\\mu_i^{2} t_i}\n\\end{pmatrix}\n}\n$$"
        }
    ]
}