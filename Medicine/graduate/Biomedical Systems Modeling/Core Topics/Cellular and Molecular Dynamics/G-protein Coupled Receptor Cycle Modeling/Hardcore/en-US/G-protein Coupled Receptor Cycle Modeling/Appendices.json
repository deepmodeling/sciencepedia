{
    "hands_on_practices": [
        {
            "introduction": "This first practice builds your foundational modeling skills by tackling a common pharmacological scenario: two different agonists competing for the same receptor. By applying the law of mass action and the principle of receptor conservation, you will derive the composite signaling output of the system. This exercise is essential for understanding how the presence of a partial agonist can modulate the response to a full agonist, a key concept in receptor theory and drug design .",
            "id": "3887903",
            "problem": "Consider a single-occupancy G-protein coupled receptor (GPCR) cycle in a well-mixed compartment with a fixed total receptor pool $R_T$. Two ligands compete for the same orthosteric binding site: a full agonist with concentration $L_1$ and a partial agonist with concentration $L_2$. The ligands have equilibrium dissociation constants $K_{D1}$ and $K_{D2}$, respectively, defined by the law of mass action so that, at steady state, the receptorâ€“ligand complexes satisfy $K_{D1} = \\frac{[R][L_1]}{[RL_1]}$ and $K_{D2} = \\frac{[R][L_2]}{[RL_2]}$, where $[R]$ is the concentration of free receptor, $[RL_1]$ is the concentration of receptor bound to $L_1$, and $[RL_2]$ is the concentration of receptor bound to $L_2$. Assume no receptor dimerization, no allosteric modulation, and no cooperativity. The receptor is at equilibrium with both ligands present simultaneously, and binding is mutually exclusive.\n\nLet the signaling efficacy of the full agonist be $\\varepsilon_1$ and that of the partial agonist be $\\varepsilon_2$, where $\\varepsilon_1$ and $\\varepsilon_2$ are dimensionless constants between $0$ and $1$ that quantify the probability that a ligand-bound receptor is in the signaling-competent active conformation. Assume constitutive activity of the free receptor is negligible. Further assume the downstream G-protein activation is fast and proportional to the fraction of receptors in the active conformation at steady state, so the normalized signaling output $E(L_1,L_2)$ equals the fraction of receptors that are active.\n\nStarting from the law of mass action and conservation of receptors, derive a closed-form expression for the composite steady-state normalized signaling output $E(L_1,L_2)$ as an explicit function of $L_1$, $L_2$, $K_{D1}$, $K_{D2}$, $\\varepsilon_1$, and $\\varepsilon_2$. Express your final answer as a single analytic expression. No numerical evaluation is required and no units should be included in the final expression.",
            "solution": "The problem requires the derivation of a closed-form expression for the normalized signaling output of a GPCR system with two competing ligands. The derivation must be based on the principles of mass action kinetics at equilibrium and the conservation of total receptor concentration.\n\nFirst, we establish the fundamental equations governing the system at steady state, as provided in the problem statement.\n\nThe total concentration of receptors, $R_T$, is constant and is the sum of the concentrations of free receptors, $[R]$, receptors bound to the full agonist, $[RL_1]$, and receptors bound to the partial agonist, $[RL_2]$. This is the law of conservation of receptors:\n$$R_T = [R] + [RL_1] + [RL_2]$$\n\nThe interactions between the ligands and the receptor are described by the law of mass action, defined by their respective equilibrium dissociation constants, $K_{D1}$ and $K_{D2}$:\nFor the full agonist $L_1$:\n$$K_{D1} = \\frac{[R] L_1}{[RL_1]}$$\nFor the partial agonist $L_2$:\n$$K_{D2} = \\frac{[R] L_2}{[RL_2]}$$\nHere, $L_1$ and $L_2$ represent the concentrations of the respective ligands.\n\nFrom these mass action equations, we can express the concentrations of the ligand-bound receptor complexes in terms of the free receptor concentration $[R]$:\n$$[RL_1] = \\frac{[R] L_1}{K_{D1}}$$\n$$[RL_2] = \\frac{[R] L_2}{K_{D2}}$$\n\nNext, we substitute these expressions into the receptor conservation equation:\n$$R_T = [R] + \\frac{[R] L_1}{K_{D1}} + \\frac{[R] L_2}{K_{D2}}$$\nFactoring out the free receptor concentration $[R]$ yields:\n$$R_T = [R] \\left( 1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}} \\right)$$\n\nThe normalized signaling output, $E(L_1, L_2)$, is defined as the fraction of the total receptor pool that is in an active, signaling-competent conformation. The contribution to the active receptor pool comes from receptors bound to $L_1$ and receptors bound to $L_2$. The signaling efficacy parameters, $\\varepsilon_1$ and $\\varepsilon_2$, represent the probabilities that a receptor bound to $L_1$ or $L_2$, respectively, is active. The problem states that constitutive activity from free receptors is negligible.\nThus, the total concentration of active receptors, $[R_{active}]$, is:\n$$[R_{active}] = \\varepsilon_1 [RL_1] + \\varepsilon_2 [RL_2]$$\n\nThe normalized signaling output $E$ is this quantity divided by the total receptor concentration $R_T$:\n$$E(L_1, L_2) = \\frac{[R_{active}]}{R_T} = \\frac{\\varepsilon_1 [RL_1] + \\varepsilon_2 [RL_2]}{R_T} = \\varepsilon_1 \\frac{[RL_1]}{R_T} + \\varepsilon_2 \\frac{[RL_2]}{R_T}$$\nThe terms $\\frac{[RL_1]}{R_T}$ and $\\frac{[RL_2]}{R_T}$ represent the fractional occupancy of the total receptor pool by each ligand. We can derive expressions for these fractions.\n\nUsing the expressions for $[RL_1]$ and $R_T$ in terms of $[R]$:\n$$\\frac{[RL_1]}{R_T} = \\frac{\\frac{[R] L_1}{K_{D1}}}{[R] \\left( 1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}} \\right)} = \\frac{\\frac{L_1}{K_{D1}}}{1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}}}$$\nSimilarly, for the second ligand:\n$$\\frac{[RL_2]}{R_T} = \\frac{\\frac{[R] L_2}{K_{D2}}}{[R] \\left( 1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}} \\right)} = \\frac{\\frac{L_2}{K_{D2}}}{1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}}}$$\n\nFinally, we substitute these expressions for fractional occupancy back into the equation for the normalized signaling output $E(L_1, L_2)$:\n$$E(L_1, L_2) = \\varepsilon_1 \\left( \\frac{\\frac{L_1}{K_{D1}}}{1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}}} \\right) + \\varepsilon_2 \\left( \\frac{\\frac{L_2}{K_{D2}}}{1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}}} \\right)$$\nCombining the terms over the common denominator gives the final closed-form expression for the composite steady-state normalized signaling output:\n$$E(L_1, L_2) = \\frac{\\varepsilon_1 \\frac{L_1}{K_{D1}} + \\varepsilon_2 \\frac{L_2}{K_{D2}}}{1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}}}$$\nThis expression gives the total response as a function of the concentrations of the two competing ligands and their respective binding and efficacy parameters.",
            "answer": "$$\\boxed{\\frac{\\varepsilon_1 \\frac{L_1}{K_{D1}} + \\varepsilon_2 \\frac{L_2}{K_{D2}}}{1 + \\frac{L_1}{K_{D1}} + \\frac{L_2}{K_{D2}}}}$$"
        },
        {
            "introduction": "Building on the principles of competitive binding, this practice explores the quantitative effects of a competitive antagonist. You will first derive the famous Schild relation from mass-action principles and then implement a numerical simulation to generate dose-response curves and perform a Schild analysis. This powerful technique is a cornerstone of pharmacology, allowing for the robust estimation of an antagonist's dissociation constant ($K_B$) from experimental data .",
            "id": "3887970",
            "problem": "Consider a minimal, mechanistic model of a G-protein coupled receptor (GPCR) system in which a single receptor site binds a reversible agonist and a reversible competitive antagonist. The receptor cycles between free state, agonist-bound active state, and antagonist-bound inactive state. Under the assumption of rapid binding equilibration relative to downstream signaling, and that the antagonist has zero efficacy, the observed effect is proportional to the fraction of receptors occupied by the agonist. The fundamental base is the law of mass action for reversible binding and the definition of equilibrium dissociation constants and dose-response measures.\n\nYou are to analyze and simulate how a reversible competitive antagonist shifts the half-maximal effective concentration ($EC_{50}$) of the agonist without altering the maximal effect ($E_{\\max}$), and then derive and estimate the antagonist equilibrium dissociation constant from Schild analysis.\n\nTasks:\n1. Starting from mass-action equilibrium for two ligands competing for the same receptor site, with agonist concentration $[A]$, antagonist concentration $[B]$, agonist equilibrium dissociation constant $K_A$ (units: molar, $\\mathrm{M}$), antagonist equilibrium dissociation constant $K_B$ (units: molar, $\\mathrm{M}$), total receptor concentration $R_T$, and assuming the antagonist has zero efficacy while the agonist has unit efficacy, derive:\n   - The fraction of receptors occupied by the agonist, expressed in terms of $[A]$, $[B]$, $K_A$, and $K_B$.\n   - That the maximal effect $E_{\\max}$ is unchanged by the antagonist under pure competition when $[A]\\to\\infty$.\n   - The apparent half-maximal effective concentration in the presence of antagonist, $\\mathrm{EC50}([B])$, and the dose ratio $\\mathrm{DR}([B]) = \\mathrm{EC50}([B])/\\mathrm{EC50}(0)$.\n   - The Schild relation linking $\\log_{10}(\\mathrm{DR}([B]) - 1)$ and $\\log_{10}([B])$ for a competitive antagonist, and the expression for $K_B$ in terms of the Schild plot intercept.\n\n2. Implement a simulation at equilibrium that computes the effect $E([A],[B])$ as a function of $[A]$ for several fixed antagonist concentrations $[B]$, using the occupancy fraction derived from mass action and an effect proportional to agonist occupancy. For each antagonist concentration $[B]$, compute $EC_{50}([B])$ numerically as the agonist concentration $[A]$ at which the effect reaches one half of its maximal value for that $[B]$. Use monotonic interpolation on a logarithmic agonist concentration grid to estimate $EC_{50}([B])$.\n\n3. For the Schild analysis, compute the dose ratio values $\\mathrm{DR}([B])$ for the non-zero antagonist concentrations and perform a linear regression of $y = \\log_{10}(\\mathrm{DR}([B]) - 1)$ versus $x = \\log_{10}([B])$. Estimate the slope and intercept. From the intercept $c$ of the regression line $y = m x + c$, estimate $K_B$ in molar units as $K_B^{\\mathrm{est}} = 10^{-c}$.\n\n4. Verify two properties numerically:\n   - Competitive mechanism check: The Schild slope $m$ should be approximately $1$. Report a boolean indicating whether $|m - 1| \\leq \\delta$, with tolerance $\\delta = 0.05$.\n   - Maximal effect invariance: For each antagonist concentration $[B]$, the maximal effect across the agonist grid should agree with the zero-antagonist maximal effect to within a relative tolerance $\\epsilon = 10^{-3}$. Report a boolean indicating whether this holds for all tested $[B]$ in each test case.\n\nAll concentrations and dissociation constants must be treated in molar units ($\\mathrm{M}$). Effects may be reported in arbitrary units. Angles do not appear. Do not use percentage signs; all ratios are unitless decimals.\n\nTest suite:\nSimulate the dose-response and Schild analysis for the following parameter sets. For each case, use a logarithmically spaced agonist concentration grid over the specified range. In all cases, set $E_{\\max} = 1.0$ (arbitrary units).\n\n- Case $1$ (happy path):\n  - $K_A = 5\\times 10^{-8}\\ \\mathrm{M}$, $K_B = 2\\times 10^{-8}\\ \\mathrm{M}$.\n  - Antagonist concentrations: $[B] \\in \\{1\\times 10^{-9},\\ 5\\times 10^{-9},\\ 2\\times 10^{-8},\\ 1\\times 10^{-7}\\}\\ \\mathrm{M}$.\n  - Agonist grid: $[A] \\in [1\\times 10^{-10},\\ 1\\times 10^{-4}]\\ \\mathrm{M}$ with $501$ points.\n\n- Case $2$ (weak antagonist boundary):\n  - $K_A = 1\\times 10^{-7}\\ \\mathrm{M}$, $K_B = 1\\times 10^{-5}\\ \\mathrm{M}$.\n  - Antagonist concentrations: $[B] \\in \\{1\\times 10^{-7},\\ 5\\times 10^{-7},\\ 1\\times 10^{-6},\\ 5\\times 10^{-6}\\}\\ \\mathrm{M}$.\n  - Agonist grid: $[A] \\in [1\\times 10^{-10},\\ 1\\times 10^{-2}]\\ \\mathrm{M}$ with $501$ points.\n\n- Case $3$ (strong antagonist coverage):\n  - $K_A = 1\\times 10^{-9}\\ \\mathrm{M}$, $K_B = 1\\times 10^{-9}\\ \\mathrm{M}$.\n  - Antagonist concentrations: $[B] \\in \\{1\\times 10^{-10},\\ 3\\times 10^{-10},\\ 1\\times 10^{-9},\\ 3\\times 10^{-9},\\ 1\\times 10^{-8}\\}\\ \\mathrm{M}$.\n  - Agonist grid: $[A] \\in [1\\times 10^{-12},\\ 1\\times 10^{-3}]\\ \\mathrm{M}$ with $601$ points.\n\nFinal output specification:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a list of three elements:\n- The estimated antagonist equilibrium dissociation constant $K_B^{\\mathrm{est}}$ in $\\mathrm{M}$ (float).\n- A boolean indicating whether the Schild slope is within tolerance $\\delta$ of $1$.\n- A boolean indicating whether $E_{\\max}$ is invariant within tolerance $\\epsilon$ across the tested $[B]$.\n\nFor example, the output format must be like $[[v_1,b_1,c_1],[v_2,b_2,c_2],[v_3,b_3,c_3]]$ where $v_i$ are floats in $\\mathrm{M}$, and $b_i$, $c_i$ are booleans. Your program must not print any other text.",
            "solution": "The problem statement is assessed to be valid. It is scientifically grounded in established principles of receptor pharmacology, specifically the law of mass action applied to competitive ligand binding. The problem is well-posed, providing all necessary definitions, constants, and initial conditions to derive the required relationships and perform the numerical simulations. The language is objective and the tasks are clearly defined, leading to a unique and verifiable solution.\n\n### 1. Theoretical Derivations\n\n#### 1.1. Agonist Occupancy Fraction\n\nWe model the interactions of a receptor $R$ with an agonist $A$ and a competitive antagonist $B$ at equilibrium. The reactions are:\n$$ R + A \\rightleftharpoons RA $$\n$$ R + B \\rightleftharpoons RB $$\nwhere $RA$ is the agonist-bound receptor complex and $RB$ is the antagonist-bound receptor complex.\n\nThe equilibrium dissociation constants, $K_A$ and $K_B$, are defined by the law of mass action:\n$$ K_A = \\frac{[R][A]}{[RA]} $$\n$$ K_B = \\frac{[R][B]}{[RB]} $$\nHere, $[R]$, $[A]$, $[RA]$, $[B]$, and $[RB]$ represent the molar concentrations of the free receptor, agonist, agonist-receptor complex, antagonist, and antagonist-receptor complex, respectively.\n\nThe total concentration of receptors, $R_T$, is the sum of receptors in all possible states:\n$$ R_T = [R] + [RA] + [RB] $$\nThe fraction of receptors occupied by the agonist, $\\theta_A$, is defined as:\n$$ \\theta_A = \\frac{[RA]}{R_T} $$\nTo express $\\theta_A$ in terms of $[A]$, $[B]$, $K_A$, and $K_B$, we first express $[R]$ and $[RB]$ in terms of $[RA]$:\nFrom the definition of $K_A$, we have $[R] = \\frac{K_A [RA]}{[A]}$.\nFrom the definition of $K_B$, we have $[RB] = \\frac{[R][B]}{K_B}$. Substituting the expression for $[R]$ gives:\n$$ [RB] = \\frac{K_A [RA] [B]}{[A] K_B} $$\nNow, substitute the expressions for $[R]$ and $[RB]$ into the equation for $R_T$:\n$$ R_T = \\frac{K_A [RA]}{[A]} + [RA] + \\frac{K_A [RA] [B]}{[A] K_B} $$\nFactor out $[RA]$:\n$$ R_T = [RA] \\left( \\frac{K_A}{[A]} + 1 + \\frac{K_A [B]}{[A] K_B} \\right) $$\n$$ R_T = [RA] \\left( \\frac{K_A + [A] + \\frac{K_A [B]}{K_B}}{[A]} \\right) $$\n$$ R_T = [RA] \\left( \\frac{[A] + K_A \\left(1 + \\frac{[B]}{K_B}\\right)}{[A]} \\right) $$\nThe agonist occupancy fraction $\\theta_A = [RA]/R_T$ is then:\n$$ \\theta_A = \\frac{[A]}{[A] + K_A \\left(1 + \\frac{[B]}{K_B}\\right)} $$\nThis is the desired expression for the fraction of receptors occupied by the agonist.\n\n#### 1.2. Invariance of Maximal Effect ($E_{\\max}$)\n\nThe pharmacological effect $E$ is proportional to the agonist occupancy fraction $\\theta_A$. Let $E_{\\max,\\text{sys}}$ be the system's absolute maximal effect, corresponding to $\\theta_A = 1$. Then, $E = E_{\\max,\\text{sys}} \\cdot \\theta_A$. The maximal effect for a given antagonist concentration $[B]$ is found by taking the limit of $E$ as the agonist concentration $[A]$ approaches infinity. This corresponds to a saturating dose of the agonist.\n\n$$ E_{\\max}([B]) = \\lim_{[A]\\to\\infty} E = E_{\\max,\\text{sys}} \\cdot \\lim_{[A]\\to\\infty} \\theta_A $$\n$$ \\lim_{[A]\\to\\infty} \\theta_A = \\lim_{[A]\\to\\infty} \\frac{[A]}{[A] + K_A \\left(1 + \\frac{[B]}{K_B}\\right)} $$\nTo evaluate the limit, we divide the numerator and denominator by $[A]$:\n$$ \\lim_{[A]\\to\\infty} \\frac{1}{1 + \\frac{K_A}{[A]} \\left(1 + \\frac{[B]}{K_B}\\right)} = \\frac{1}{1 + 0} = 1 $$\nThus, for any finite antagonist concentration $[B]$, the maximal agonist occupancy approaches $1$. The maximal effect is:\n$$ E_{\\max}([B]) = E_{\\max,\\text{sys}} \\cdot 1 = E_{\\max,\\text{sys}} $$\nThis demonstrates that for a pure competitive antagonist, the maximal effect is independent of the antagonist's concentration.\n\n#### 1.3. Apparent Half-Maximal Effective Concentration ($EC_{50}$) and Dose Ratio (DR)\n\nThe half-maximal effective concentration, $EC_{50}$, is the agonist concentration at which the effect is $50\\%$ of the maximum. This occurs when $\\theta_A = 1/2$. The apparent $EC_{50}$ in the presence of antagonist, denoted $EC_{50}([B])$, is the value of $[A]$ that satisfies this condition.\n$$ \\frac{1}{2} = \\frac{[A]}{[A] + K_A \\left(1 + \\frac{[B]}{K_B}\\right)} $$\nSetting $[A] = EC_{50}([B])$:\n$$ EC_{50}([B]) + K_A \\left(1 + \\frac{[B]}{K_B}\\right) = 2 \\cdot EC_{50}([B]) $$\n$$ EC_{50}([B]) = K_A \\left(1 + \\frac{[B]}{K_B}\\right) $$\nIn the absence of antagonist ($[B]=0$), the $EC_{50}$ is:\n$$ EC_{50}(0) = K_A \\left(1 + \\frac{0}{K_B}\\right) = K_A $$\nThe dose ratio, $\\mathrm{DR}([B])$, is the ratio of the apparent $EC_{50}$ in the presence of antagonist to the $EC_{50}$ in its absence:\n$$ \\mathrm{DR}([B]) = \\frac{EC_{50}([B])}{EC_{50}(0)} = \\frac{K_A \\left(1 + \\frac{[B]}{K_B}\\right)}{K_A} = 1 + \\frac{[B]}{K_B} $$\n\n#### 1.4. The Schild Relation\n\nThe Schild relation linearizes the relationship between the dose ratio and the antagonist concentration. Starting with the expression for the dose ratio:\n$$ \\mathrm{DR}([B]) - 1 = \\frac{[B]}{K_B} $$\nTaking the base-10 logarithm of both sides gives the Schild equation:\n$$ \\log_{10}(\\mathrm{DR}([B]) - 1) = \\log_{10}\\left(\\frac{[B]}{K_B}\\right) $$\n$$ \\log_{10}(\\mathrm{DR}([B]) - 1) = \\log_{10}([B]) - \\log_{10}(K_B) $$\nThis equation is in the linear form $y = mx + c$, where:\n- $y = \\log_{10}(\\mathrm{DR}([B]) - 1)$\n- $x = \\log_{10}([B])$\n- The slope is $m=1$.\n- The y-intercept is $c = -\\log_{10}(K_B)$.\n\nA key characteristic of pure competitive antagonism is a Schild plot with a slope of unity. From the intercept $c$, the antagonist's dissociation constant $K_B$ can be estimated:\n$$ c = -\\log_{10}(K_B) \\implies \\log_{10}(K_B) = -c \\implies K_B = 10^{-c} $$\nThe value $-\\log_{10}(K_B)$ is also known as the $\\mathrm{pA}_2$ value.\n\n### 2. Numerical Implementation Strategy\n\nThe theoretical framework above is translated into a numerical simulation.\n\n- **Dose-Response Simulation**: For each test case, we define a logarithmically spaced grid of agonist concentrations $[A]$. A maximal effect $E_{\\max}$ of $1.0$ is assumed, so the effect $E$ is numerically equal to the agonist occupancy fraction $\\theta_A$. For a control case with $[B]=0$ and for each specified non-zero antagonist concentration $[B]$, we compute the effect curve across the $[A]$ grid using the derived formula: $E([A],[B]) = \\frac{[A]}{[A] + K_A(1 + [B]/K_B)}$.\n\n- **EC50 Estimation**: For each effect curve, the maximal effect on the grid, $E_{\\max}^{\\text{num}}$, is taken as the effect at the highest agonist concentration. The half-maximal effect is $E_{\\max}^{\\text{num}}/2$. We then find the corresponding agonist concentration, $EC_{50}$, by performing linear interpolation between the points of the effect curve. Since the agonist concentration is on a log scale, we interpolate $\\log_{10}([A])$ against $E$ to find $\\log_{10}(EC_{50})$ at the half-maximal effect value, and then compute $EC_{50} = 10^{\\log_{10}(EC_{50})}$. This is done for $[B]=0$ to get $EC_{50}(0)$ and for each non-zero $[B]$ to get $EC_{50}([B])$.\n\n- **Schild Analysis**: Using the calculated $EC_{50}$ values, dose ratios $\\mathrm{DR}([B]) = EC_{50}([B])/EC_{50}(0)$ are computed for each antagonist concentration. We then construct the variables for the Schild plot regression: $y = \\log_{10}(\\mathrm{DR}([B]) - 1)$ and $x = \\log_{10}([B])$. A linear least-squares regression is performed to fit the model $y = mx + c$, which yields the slope $m$ and intercept $c$. The antagonist dissociation constant is estimated as $K_B^{\\mathrm{est}} = 10^{-c}$.\n\n- **Verification Checks**:\n  1. **Competitive Mechanism Check**: The theoretical slope of the Schild plot for a competitive antagonist is $1$. We verify this numerically by checking if the absolute difference between the estimated slope $m$ and $1$ is within a tolerance $\\delta=0.05$: $|m - 1| \\le 0.05$.\n  2. **Maximal Effect Invariance**: We verify that the antagonist does not suppress the maximal effect. For each non-zero antagonist concentration $[B]$, the maximal effect observed on the grid, $E_{\\max}^{\\text{num}}([B])$, is compared to the maximal effect in the control case, $E_{\\max}^{\\text{num}}(0)$. The check passes if the relative difference is within a tolerance $\\epsilon=10^{-3}$ for all tested $[B]$ values: $\\frac{|E_{\\max}^{\\text{num}}([B]) - E_{\\max}^{\\text{num}}(0)|}{E_{\\max}^{\\text{num}}(0)} \\le 10^{-3}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the GPCR simulation and Schild analysis for all test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: happy path\n        (5e-8, 2e-8, [1e-9, 5e-9, 2e-8, 1e-7], (1e-10, 1e-4, 501)),\n        # Case 2: weak antagonist boundary\n        (1e-7, 1e-5, [1e-7, 5e-7, 1e-6, 5e-6], (1e-10, 1e-2, 501)),\n        # Case 3: strong antagonist coverage\n        (1e-9, 1e-9, [1e-10, 3e-10, 1e-9, 3e-9, 1e-8], (1e-12, 1e-3, 601)),\n    ]\n    \n    delta = 0.05\n    epsilon = 1e-3\n\n    results = []\n    for case in test_cases:\n        KA, KB, B_concs, A_grid_spec = case\n        result = analyze_case(KA, KB, B_concs, A_grid_spec, delta, epsilon)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The format [val1,bool1a,bool1b],[val2,bool2a,bool2b]... is achieved by stringifying the inner list\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef analyze_case(KA, KB, B_concs, A_grid_spec, delta, epsilon):\n    \"\"\"\n    Performs the full analysis for a single set of parameters.\n    \n    Args:\n        KA (float): Agonist equilibrium dissociation constant.\n        KB (float): Antagonist equilibrium dissociation constant.\n        B_concs (list of float): List of antagonist concentrations to test.\n        A_grid_spec (tuple): (min, max, num_points) for the agonist concentration grid.\n        delta (float): Tolerance for Schild slope verification.\n        epsilon (float): Relative tolerance for maximal effect invariance check.\n\n    Returns:\n        list: [KB_est, is_competitive, is_emax_invariant]\n    \"\"\"\n    A_grid_min, A_grid_max, A_grid_points = A_grid_spec\n    A_concs_grid = np.logspace(np.log10(A_grid_min), np.log10(A_grid_max), A_grid_points)\n    log_A_concs_grid = np.log10(A_concs_grid)\n\n    def calculate_effect(A, B, KA_val, KB_val):\n        \"\"\"Calculates effect based on agonist occupancy, with E_max=1.0.\"\"\"\n        # Using the derived occupancy formula: theta_A = [A] / ([A] + KA * (1 + [B]/KB))\n        # The effect E is proportional to theta_A, and with E_max=1, E = theta_A.\n        return A / (A + KA_val * (1.0 + B / KB_val))\n\n    # --- Control Case ([B] = 0) ---\n    E_0 = calculate_effect(A_concs_grid, 0.0, KA, KB)\n    # Maximal effect on the grid is the effect at the highest agonist concentration\n    E_max_0 = E_0[-1]\n    half_max_0 = E_max_0 / 2.0\n    # Interpolate on log scale to find log(EC50)\n    log_EC50_0 = np.interp(half_max_0, E_0, log_A_concs_grid)\n    EC50_0 = 10**log_EC50_0\n\n    # --- Antagonist Cases ([B]  0) ---\n    EC50_B_list = []\n    E_max_B_list = []\n    \n    for B in B_concs:\n        E_B = calculate_effect(A_concs_grid, B, KA, KB)\n        E_max_B = E_B[-1]\n        E_max_B_list.append(E_max_B)\n        \n        half_max_B = E_max_B / 2.0\n        log_EC50_B = np.interp(half_max_B, E_B, log_A_concs_grid)\n        EC50_B_list.append(10**log_EC50_B)\n    \n    # --- Schild Analysis ---\n    DR = np.array(EC50_B_list) / EC50_0\n    \n    # Check for DR  1. In this ideal model, DR = 1 + [B]/KB  1, so log(DR-1) is safe.\n    # A small positive value is added to DR - 1 for numerical stability in case DR is extremely close to 1.\n    y = np.log10(DR - 1.0 + np.finfo(float).eps)\n    x = np.log10(np.array(B_concs))\n    \n    # Perform linear regression y = mx + c using numpy.linalg.lstsq\n    A_matrix = np.vstack([x, np.ones(len(x))]).T\n    m, c = np.linalg.lstsq(A_matrix, y, rcond=None)[0]\n    \n    # Estimate KB from the intercept c = -log10(KB)\n    KB_est = 10**(-c)\n\n    # --- Verification Checks ---\n    # 1. Competitive mechanism check: Schild slope should be ~1\n    is_competitive = abs(m - 1.0) = delta\n    \n    # 2. Maximal effect invariance check\n    max_effect_inv_check_results = []\n    for E_max_B in E_max_B_list:\n        relative_diff = abs(E_max_B - E_max_0) / E_max_0\n        max_effect_inv_check_results.append(relative_diff = epsilon)\n    is_emax_invariant = all(max_effect_inv_check_results)\n\n    return [KB_est, is_competitive, is_emax_invariant]\n\nsolve()\n```"
        },
        {
            "introduction": "This final practice moves from orthosteric competition to the more nuanced world of allosteric modulation, a key area in modern drug development. You will apply the allosteric ternary complex model to derive how a modulator can alter agonist potency and then use simulation to demonstrate the critical concept of \"probe dependence\". This exercise highlights how an allosteric drug's observed effects can vary depending on the specific agonist it is paired with, a crucial consideration for therapeutic design .",
            "id": "3887908",
            "problem": "Consider a receptor-ligand system for a G-protein coupled receptor (GPCR) in which an orthosteric agonist and an allosteric modulator can bind simultaneously, following the Law of Mass Action at equilibrium. The receptor exists in four conformational binding states: free receptor $R$, receptor bound to agonist $AR$, receptor bound to modulator $RM$, and receptor bound to both agonist and modulator $ARM$. Two distinct orthosteric agonists $A_1$ and $A_2$ compete for the same orthosteric site, and a single allosteric modulator $M$ binds to a separate site. Let the microscopic dissociation constants be $K_{A_1}$ and $K_{A_2}$ for $A_1$ and $A_2$, and $K_M$ for $M$. Cooperative interactions are captured by the binding cooperativity parameter $\\alpha_i$ for the pair $(A_i, M)$, defined such that the affinity of $A_i$ for the receptor in the presence of bound $M$ is scaled by $\\alpha_i$, and the affinity of $M$ in the presence of bound $A_i$ is likewise consistent with thermodynamic cycle constraints. Efficacy (stimulus generation) of an agonist-bound receptor state is modulated by an efficacy scaling factor $\\beta_i$ when the modulator is co-bound, relative to the efficacy of the agonist-bound receptor without the modulator. Assume the transduction from active receptor occupancy to measured response is monotonic and time-invariant, and treat the system at equilibrium. There is negligible basal activity in the absence of agonist.\n\nUsing only the foundational base of the Law of Mass Action, conservation of receptor, and equilibrium thermodynamics for allosteric ternary complexes, derive the steady-state fractional occupancies of the receptor states for each agonist $A_i$ at a fixed modulator concentration $[M]$, and then derive the agonist concentration $[A_i]$ that produces one-half of the maximal response observed as $[A_i]\\to\\infty$ at that fixed $[M]$. Define the potency $EC50_i([M])$ for agonist $A_i$ at modulator concentration $[M]$ as the concentration $[A_i]$ that yields half-maximal response under those conditions. For each agonist $A_i$, compute the dimensionless potency shift ratio\n$$\nS_i([M]) \\equiv \\frac{EC50_i([M])}{EC50_i(0)}.\n$$\nThe goal is to demonstrate probe dependence: the same modulator alters the potencies of two agonists differently under the allosteric model. Your program must implement the derived expressions and compute $S_1([M])$ and $S_2([M])$ for the specified test suite.\n\nAssumptions to use explicitly:\n- Equilibrium binding governed by the Law of Mass Action.\n- The modulator $M$ does not bind to the orthosteric site and the agonists $A_1$ and $A_2$ do not bind to the allosteric site.\n- The binding cooperativity parameters $\\alpha_i$ are constant and reflect pairwise interaction between $A_i$ and $M$.\n- Efficacy scaling parameters $\\beta_i$ affect response only when both agonist and modulator are co-bound; the transduction is monotonic and depends on active occupancy.\n- Responses are measured at equilibrium; all concentrations are in molar units ($\\mathrm{M}$). The final reported values are dimensionless ratios $S_i([M])$ and thus have no unit.\n\nTest Suite (each case uses the same modulator within the case for both agonists):\n- Case $1$ (happy path; positive cooperativity with $A_1$ and negative with $A_2$):\n  - $K_{A_1} = 3.0\\times 10^{-8}\\ \\mathrm{M}$, $K_{A_2} = 3.0\\times 10^{-7}\\ \\mathrm{M}$, $K_M = 1.0\\times 10^{-6}\\ \\mathrm{M}$, $[M] = 1.0\\times 10^{-6}\\ \\mathrm{M}$,\n  - $\\alpha_1 = 5.0$, $\\alpha_2 = 0.5$, $\\beta_1 = 1.0$, $\\beta_2 = 1.0$.\n- Case $2$ (boundary; modulator is binding-neutral for both agonists):\n  - $K_{A_1} = 1.0\\times 10^{-8}\\ \\mathrm{M}$, $K_{A_2} = 5.0\\times 10^{-8}\\ \\mathrm{M}$, $K_M = 1.0\\times 10^{-6}\\ \\mathrm{M}$, $[M] = 1.0\\times 10^{-6}\\ \\mathrm{M}$,\n  - $\\alpha_1 = 1.0$, $\\alpha_2 = 1.0$, $\\beta_1 = 2.0$, $\\beta_2 = 0.5$.\n- Case $3$ (edge; saturating modulator relative to its affinity):\n  - $K_{A_1} = 5.0\\times 10^{-8}\\ \\mathrm{M}$, $K_{A_2} = 2.0\\times 10^{-7}\\ \\mathrm{M}$, $K_M = 1.0\\times 10^{-7}\\ \\mathrm{M}$, $[M] = 1.0\\times 10^{-5}\\ \\mathrm{M}$,\n  - $\\alpha_1 = 10.0$, $\\alpha_2 = 0.1$, $\\beta_1 = 1.0$, $\\beta_2 = 1.0$.\n- Case $4$ (edge; very low modulator relative to its affinity):\n  - $K_{A_1} = 2.0\\times 10^{-8}\\ \\mathrm{M}$, $K_{A_2} = 8.0\\times 10^{-8}\\ \\mathrm{M}$, $K_M = 1.0\\times 10^{-6}\\ \\mathrm{M}$, $[M] = 1.0\\times 10^{-9}\\ \\mathrm{M}$,\n  - $\\alpha_1 = 3.0$, $\\alpha_2 = 0.3$, $\\beta_1 = 1.0$, $\\beta_2 = 1.0$.\n\nYour program should compute, for each case in the order $1$ through $4$, the tuple $(S_1([M]), S_2([M]))$ and produce a single line of output containing the eight results in a comma-separated list enclosed in square brackets, ordered as $[S_1^{(1)}, S_2^{(1)}, S_1^{(2)}, S_2^{(2)}, S_1^{(3)}, S_2^{(3)}, S_1^{(4)}, S_2^{(4)}]$. Each value should be rounded to six decimal places. The output is dimensionless.",
            "solution": "The problem statement has been critically examined and is determined to be valid. It is scientifically grounded in the established principles of pharmacological receptor theory, specifically the allosteric ternary complex model. The problem is well-posed, objective, and provides a complete and consistent set of definitions and parameters, allowing for a unique and meaningful solution. The derivation of the potency shift ratio is a standard, non-trivial exercise in quantitative systems pharmacology.\n\nThe solution proceeds by first deriving a general expression for the potency shift ratio, $S_i([M])$, from first principles. This ratio quantifies how an allosteric modulator $M$ alters the potency ($EC50$) of an orthosteric agonist $A_i$.\n\nLet us consider the binding equilibria for a single agonist $A_i$ and the modulator $M$ with the receptor $R$. The system involves four states: $R$ (free receptor), $A_iR$ (agonist-bound), $RM$ (modulator-bound), and $A_iRM$ (ternary complex). According to the Law of Mass Action at equilibrium, we have the following relationships defined by microscopic dissociation constants:\n\n$1.$ Agonist binding to free receptor: $R + A_i \\rightleftharpoons A_iR$\n$$K_{A_i} = \\frac{[R][A_i]}{[A_iR]}$$\n$2.$ Modulator binding to free receptor: $R + M \\rightleftharpoons RM$\n$$K_M = \\frac{[R][M]}{[RM]}$$\n$3.$ Agonist binding to modulator-bound receptor: $RM + A_i \\rightleftharpoons A_iRM$\n$$K'_{A_i} = \\frac{[RM][A_i]}{[A_iRM]}$$\n$4.$ Modulator binding to agonist-bound receptor: $A_iR + M \\rightleftharpoons A_iRM$\n$$K'_{M} = \\frac{[A_iR][M]}{[A_iRM]}$$\n\nThe principle of thermodynamic detailed balance requires that for any closed loop, the product of equilibrium constants is one. For the cycle $R \\to A_iR \\to A_iRM \\to RM \\to R$, this implies $K_{A_i} K'_{M} = K_M K'_{A_i}$.\n\nThe cooperativity parameter $\\alpha_i$ is defined as the factor by which the modulator $M$ scales the affinity of the agonist $A_i$. Affinity is the inverse of the dissociation constant. The affinity of $A_i$ for $RM$ is $1/K'_{A_i}$, and for $R$ is $1/K_{A_i}$. Thus:\n$$\\frac{1}{K'_{A_i}} = \\frac{\\alpha_i}{K_{A_i}} \\implies K'_{A_i} = \\frac{K_{A_i}}{\\alpha_i}$$\nThe thermodynamic cycle constraint ensures this relationship is symmetric for the binding of $M$: $K'_{M} = K_M/\\alpha_i$.\n\nWe can express the concentration of each receptor state in terms of the free receptor concentration $[R]$:\n$$[A_iR] = \\frac{[R][A_i]}{K_{A_i}}$$\n$$[RM] = \\frac{[R][M]}{K_M}$$\n$$[A_iRM] = \\frac{[RM][A_i]}{K'_{A_i}} = \\frac{([R][M]/K_M)[A_i]}{K_{A_i}/\\alpha_i} = \\frac{\\alpha_i [R][A_i][M]}{K_{A_i}K_M}$$\n\nThe total receptor concentration, $[R]_T$, is conserved:\n$$[R]_T = [R] + [A_iR] + [RM] + [A_iRM]$$\n$$[R]_T = [R] \\left( 1 + \\frac{[A_i]}{K_{A_i}} + \\frac{[M]}{K_M} + \\frac{\\alpha_i[A_i][M]}{K_{A_i}K_M} \\right)$$\nFactoring the denominator, $D$, gives:\n$$D = \\left( 1 + \\frac{[M]}{K_M} \\right) + \\frac{[A_i]}{K_{A_i}} \\left( 1 + \\frac{\\alpha_i [M]}{K_M} \\right)$$\nSo, $[R] = [R]_T / D$.\n\nThe response (or stimulus, $Stim$) is assumed to be a function of the concentration of active, agonist-bound receptor states. With no basal activity, the active states are $A_iR$ and $A_iRM$. Let the intrinsic efficacy of agonist $A_i$ be $\\tau_i$. The efficacy in the ternary complex $A_iRM$ is scaled by $\\beta_i$.\n$$Stim_i = \\tau_i [A_iR] + \\tau_i \\beta_i [A_iRM]$$\n$$Stim_i = \\tau_i \\left( \\frac{[R][A_i]}{K_{A_i}} \\right) + \\tau_i \\beta_i \\left( \\frac{\\alpha_i [R][A_i][M]}{K_{A_i}K_M} \\right) = \\frac{\\tau_i [R][A_i]}{K_{A_i}} \\left( 1 + \\frac{\\beta_i \\alpha_i [M]}{K_M} \\right)$$\nSubstituting $[R] = [R]_T / D$:\n$$Stim_i([A_i]) = \\frac{\\frac{\\tau_i [R]_T [A_i]}{K_{A_i}} \\left( 1 + \\frac{\\beta_i \\alpha_i [M]}{K_M} \\right)}{ \\left( 1 + \\frac{[M]}{K_M} \\right) + \\frac{[A_i]}{K_{A_i}} \\left( 1 + \\frac{\\alpha_i [M]}{K_M} \\right)}$$\nThis equation describes a hyperbolic relationship between stimulus and agonist concentration $[A_i]$. To find the $EC50$, we rearrange it into the standard form $Y = \\frac{Y_{max} \\cdot X}{EC50 + X}$. We divide the numerator and denominator by the term multiplying $[A_i]$ in the denominator, which is $\\frac{1}{K_{A_i}}\\left(1 + \\frac{\\alpha_i[M]}{K_M}\\right)$:\n$$Stim_i([A_i]) = \\frac{ \\tau_i [R]_T \\frac{1 + \\frac{\\beta_i \\alpha_i [M]}{K_M}}{1 + \\frac{\\alpha_i [M]}{K_M}} [A_i] }{ K_{A_i} \\frac{1 + \\frac{[M]}{K_M}}{1 + \\frac{\\alpha_i [M]}{K_M}} + [A_i] }$$\nFrom this form, we identify the half-maximal effective concentration, $EC50_i([M])$, at a fixed modulator concentration $[M]$:\n$$EC50_i([M]) = K_{A_i} \\frac{1 + \\frac{[M]}{K_M}}{1 + \\frac{\\alpha_i [M]}{K_M}}$$\nNotice that the efficacy scaling parameter $\\beta_i$ affects the maximal response but not the $EC50$.\n\nThe problem requires the potency shift ratio $S_i([M]) \\equiv EC50_i([M]) / EC50_i(0)$. First, we find $EC50_i(0)$ by setting $[M]=0$ in the expression above:\n$$EC50_i(0) = K_{A_i} \\frac{1 + 0}{1 + 0} = K_{A_i}$$\nThis confirms that in the absence of the modulator, the $EC50$ is equal to the agonist's dissociation constant, as expected in this model.\n\nNow, we compute the ratio:\n$$S_i([M]) = \\frac{EC50_i([M])}{EC50_i(0)} = \\frac{K_{A_i} \\frac{1 + \\frac{[M]}{K_M}}{1 + \\frac{\\alpha_i [M]}{K_M}}}{K_{A_i}}$$\n$$S_i([M]) = \\frac{1 + \\frac{[M]}{K_M}}{1 + \\frac{\\alpha_i [M]}{K_M}}$$\nThis final expression is independent of the agonist's own binding properties ($K_{A_i}$) and efficacy parameters ($\\beta_i$), depending only on the modulator's properties ($K_M, [M]$) and its interaction with the agonist-receptor complex ($\\alpha_i$). This is the formula to be implemented.\n\nFor each test case, we compute $S_1([M])$ and $S_2([M])$ using the provided values for $\\alpha_1$, $\\alpha_2$, $K_M$, and $[M]$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the potency shift ratio for two agonists in the presence of an allosteric modulator\n    based on the allosteric ternary complex model.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (happy path; PAM for A1, NAM for A2)\n        {'K_A1': 3.0e-8, 'K_A2': 3.0e-7, 'K_M': 1.0e-6, 'M_conc': 1.0e-6, \n         'alpha1': 5.0, 'alpha2': 0.5, 'beta1': 1.0, 'beta2': 1.0},\n        \n        # Case 2 (boundary; binding-neutral for both agonists)\n        {'K_A1': 1.0e-8, 'K_A2': 5.0e-8, 'K_M': 1.0e-6, 'M_conc': 1.0e-6, \n         'alpha1': 1.0, 'alpha2': 1.0, 'beta1': 2.0, 'beta2': 0.5},\n        \n        # Case 3 (edge; saturating modulator)\n        {'K_A1': 5.0e-8, 'K_A2': 2.0e-7, 'K_M': 1.0e-7, 'M_conc': 1.0e-5, \n         'alpha1': 10.0, 'alpha2': 0.1, 'beta1': 1.0, 'beta2': 1.0},\n\n        # Case 4 (edge; very low modulator)\n        {'K_A1': 2.0e-8, 'K_A2': 8.0e-8, 'K_M': 1.0e-6, 'M_conc': 1.0e-9, \n         'alpha1': 3.0, 'alpha2': 0.3, 'beta1': 1.0, 'beta2': 1.0},\n    ]\n\n    def calculate_potency_shift(alpha, K_M, M_conc):\n        \"\"\"\n        Calculates the potency shift ratio S_i([M]) for an agonist A_i.\n\n        The formula is derived from the allosteric ternary complex model:\n        S_i([M]) = (1 + [M]/K_M) / (1 + alpha_i * [M]/K_M)\n\n        Args:\n            alpha (float): The binding cooperativity parameter for the agonist-modulator pair.\n            K_M (float): The dissociation constant of the modulator.\n            M_conc (float): The concentration of the modulator.\n\n        Returns:\n            float: The dimensionless potency shift ratio.\n        \"\"\"\n        # A dimensionless concentration of the modulator is a useful intermediate.\n        m_normalized = M_conc / K_M\n        \n        numerator = 1.0 + m_normalized\n        denominator = 1.0 + alpha * m_normalized\n        \n        # Avoid division by zero, although not expected with valid parameters (alpha = 0).\n        if denominator == 0:\n            return np.inf\n\n        return numerator / denominator\n\n    results = []\n    for case in test_cases:\n        # For each case, calculate the shift for agonist 1 and agonist 2\n        S1 = calculate_potency_shift(case['alpha1'], case['K_M'], case['M_conc'])\n        S2 = calculate_potency_shift(case['alpha2'], case['K_M'], case['M_conc'])\n        \n        results.append(S1)\n        results.append(S2)\n\n    # Format the final output as a single comma-separated list of values\n    # rounded to six decimal places, enclosed in square brackets.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}