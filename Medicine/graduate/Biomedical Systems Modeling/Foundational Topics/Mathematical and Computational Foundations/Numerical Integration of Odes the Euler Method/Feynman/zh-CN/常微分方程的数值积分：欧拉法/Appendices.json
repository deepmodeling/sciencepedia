{
    "hands_on_practices": [
        {
            "introduction": "理论分析是数值方法应用的基础。本练习将从最简单的一阶线性常微分方程出发，引导您推导显式欧拉法的核心稳定性条件 。通过这个练习，您将理解为何数值积分的步长选择不仅关乎精度，更直接决定了仿真结果是否会发散，并学会如何将这一基本原理推广到更贴近生物实际的时变系统中。",
            "id": "3912967",
            "problem": "考虑生物医学系统建模中的单室药代动力学清除模型，其中浓度 $x(t)$ 遵循常微分方程 (ODE) $\\dot{x}(t) = a(t)\\,x(t)$，且对于所有 $t$ 都有 $a(t)  0$。您打算使用显式欧拉法，以均匀时间步长 $h  0$ 对该 ODE 进行数值积分。从应用于标量线性动力系统的显式欧拉法的严格定义和稳定性的基本概念出发，推导时间步长 $h$ 需满足的条件，以确保当连续时间系统是渐近稳定时（即当 $a$ 是一个负常数时），数值解的幅值会渐近衰减。接着，将您的推导扩展到 $a(t)$ 是时变但保持为负的情况，并精确解释在这种情况下受稳定性限制的步长如何变化，区分使用均匀步长 $h$ 和时变步长序列 $\\{h_n\\}$ 的情况。\n\n最后，假设消除速率呈现昼夜节律调制，其模型为\n$$\na(t) = -\\big(\\alpha + \\beta \\cos(\\omega t)\\big),\n$$\n其中 $\\alpha = 1.7\\,\\mathrm{s}^{-1}$，$\\beta = 0.2\\,\\mathrm{s}^{-1}$，角频率 $\\omega = 5\\,\\mathrm{s}^{-1}$。在时间区间 $[0,10]\\,\\mathrm{s}$ 内，确定能保证该区间内所有 $t$ 的数值解线性稳定性的最大均匀显式欧拉步长 $h_{\\max}$。最终答案以秒为单位，并四舍五入到四位有效数字。",
            "solution": "本问题要求推导应用于一阶线性常微分方程 (ODE) 的显式欧拉法的稳定性条件，首先是常系数情况，然后是时变系数情况。最后，必须将此条件应用于一个涉及周期性系数的特定情况，以求出最大稳定均匀时间步长。\n\n让我们从分析一般的标量线性 ODE 开始：\n$$\n\\dot{x}(t) = \\frac{dx}{dt} = a(t)x(t)\n$$\n显式欧拉法通过使用一阶泰勒展开，在离散时间步长 $t_n = n h$（其中 $h$ 是时间步长）处近似求解：\n$$\nx(t_{n+1}) \\approx x(t_n) + h \\dot{x}(t_n)\n$$\n将 $x(t_n)$ 的数值近似记为 $x_n$，更新规则变为：\n$$\nx_{n+1} = x_n + h f(t_n, x_n)\n$$\n对于给定的 ODE，$f(t_n, x_n) = a(t_n)x_n$。因此，显式欧拉格式为：\n$$\nx_{n+1} = x_n + h a(t_n) x_n = (1 + h a(t_n)) x_n\n$$\n\n**第1部分：常系数情况**\n首先，考虑 $a(t) = a$ 是一个负常数的情况。连续系统为 $\\dot{x} = ax$，其解为 $x(t) = x(0) \\exp(at)$。由于 $a  0$，该解是渐近稳定的，意味着当 $t \\to \\infty$ 时 $x(t) \\to 0$。\n\n数值格式变为：\n$$\nx_{n+1} = (1 + h a) x_n\n$$\n为使数值解也是渐近稳定的，其幅值必须在每一步都衰减，即对于 $x_n \\neq 0$ 有 $|x_{n+1}|  |x_n|$。这要求放大因子 $G = \\frac{x_{n+1}}{x_n} = 1 + h a$ 的幅值严格小于 $1$：\n$$\n|G|  1 \\implies |1 + h a|  1\n$$\n这个不等式可以展开为：\n$$\n-1  1 + h a  1\n$$\n不等式的右侧，$1 + h a  1$，简化为 $h a  0$。由于给定 $h > 0$ 和 $a  0$，此条件总是满足的。\n不等式的左侧，$-1  1 + h a$，提供了关键的稳定性约束：\n$$\n-2  h a\n$$\n由于 $a$ 是负数，除以 $a$ 会反转不等号：\n$$\nh  -\\frac{2}{a}\n$$\n由于 $a0$，$-a = |a|$，所以该条件也可以写成 $h  \\frac{2}{|a|}$。这就是确保常系数系统数值解渐近衰减的时间步长 $h$ 需满足的条件。\n\n**第2部分：时变系数情况**\n现在，让我们将分析扩展到 $a(t)$ 是时变但始终为负（对于所有 $t$ 都有 $a(t)  0$）的情况。在第 $n$ 步的欧拉更新规则是：\n$$\nx_{n+1} = (1 + h a(t_n)) x_n\n$$\n这一步的放大因子是 $G_n = 1 + h a(t_n)$。为使数值解的幅值单调衰减，我们要求在每一步 $n$ 都有 $|G_n|  1$。\n$$\n|1 + h a(t_n)|  1\n$$\n和之前一样，由于 $h > 0$ 和 $a(t_n)  0$，条件 $1 + h a(t_n)  1$ 总是满足的。非平凡的约束来自 $1 + h a(t_n) > -1$，这得出：\n$$\nh a(t_n) > -2 \\implies h  -\\frac{2}{a(t_n)}\n$$\n这个结果允许两种步长选择方案：\n\n1.  **时变步长序列 $\\{h_n\\}$**：可以在每次迭代中调整步长。稳定性条件就是 $h_n  -\\frac{2}{a(t_n)}$。这允许在 $|a(t_n)|$ 较小时使用较大的步长，而在 $|a(t_n)|$ 较大时强制使用较小的步长。\n\n2.  **均匀步长 $h$**：如果在整个积分区间内使用恒定的步长 $h$，它必须对所有遇到的 $a(t)$ 值都满足稳定性约束。这意味着 $h$ 必须小于界限 $-\\frac{2}{a(t)}$ 的最小可能值。\n    $$\n    h  \\min_{t} \\left(-\\frac{2}{a(t)}\\right)\n    $$\n    由于 $a(t)$ 是负数，最小化 $-\\frac{2}{a(t)}$ 等价于找到使 $a(t)$ 尽可能负的 $t$ 值，即，在区间上找到 $a(t)$ 的最小值。设 $a_{\\min} = \\min_{t} a(t)$。均匀步长的条件变为：\n    $$\n    h  -\\frac{2}{a_{\\min}} = \\frac{2}{-a_{\\min}} = \\frac{2}{\\max_{t} |a(t)|}\n    $$\n    这确保了系统动力学中“最刚性”部分的稳定性，即变化率最快的部分。\n\n**第3部分：具体案例与计算**\n问题提供了一个特定的消除速率模型：\n$$\na(t) = -\\big(\\alpha + \\beta \\cos(\\omega t)\\big)\n$$\n参数为 $\\alpha = 1.7\\,\\mathrm{s}^{-1}$，$\\beta = 0.2\\,\\mathrm{s}^{-1}$，$\\omega = 5\\,\\mathrm{s}^{-1}$。我们需要找到在时间区间 $t \\in [0, 10]\\,\\mathrm{s}$ 内保证稳定性的最大均匀步长 $h_{\\max}$。\n\n根据均匀步长的推导，我们必须满足条件 $h  2 / \\max_{t \\in [0,10]} |a(t)|$。\n让我们在指定区间上求 $|a(t)|$ 的最大值。\n$$\n|a(t)| = |-\\big(\\alpha + \\beta \\cos(\\omega t)\\big)| = \\alpha + \\beta \\cos(\\omega t)\n$$\n条件 $\\alpha > \\beta > 0$ 确保 $\\alpha + \\beta \\cos(\\omega t)$ 总是正数，因此绝对值处理很简单。\n\n为了最大化该函数，我们需要最大化 $\\cos(\\omega t)$ 项。余弦函数的最大值为 $1$。这发生在其参数是 $2\\pi$ 的整数倍时，即 $\\omega t = 2k\\pi$，$k \\in \\mathbb{Z}$。\n我们必须检查在区间 $[0, 10]\\,\\mathrm{s}$ 内是否存在这样的 $t$。\n当 $\\omega = 5\\,\\mathrm{s}^{-1}$ 时，这意味着 $5t = 2k\\pi$，或 $t = \\frac{2k\\pi}{5}$。\n当 $k=0$ 时，$t=0$，它在区间内。因此，可以达到最大值。\n\n$|a(t)|$ 的最大值为：\n$$\n\\max_{t \\in [0,10]} |a(t)| = \\alpha + \\beta \\cdot \\max_{t \\in [0,10]} (\\cos(\\omega t)) = \\alpha + \\beta \\cdot 1 = \\alpha + \\beta\n$$\n因此，均匀步长 $h$ 的稳定性条件是：\n$$\nh  \\frac{2}{\\alpha + \\beta}\n$$\n最大均匀步长 $h_{\\max}$ 是此范围的上确界：\n$$\nh_{\\max} = \\frac{2}{\\alpha + \\beta}\n$$\n代入给定值 $\\alpha = 1.7\\,\\mathrm{s}^{-1}$ 和 $\\beta = 0.2\\,\\mathrm{s}^{-1}$：\n$$\nh_{\\max} = \\frac{2}{1.7 + 0.2} = \\frac{2}{1.9}\\,\\mathrm{s}\n$$\n现在，我们计算数值并四舍五入到四位有效数字：\n$$\nh_{\\max} = \\frac{2}{1.9} \\approx 1.05263157... \\,\\mathrm{s}\n$$\n四舍五入到四位有效数字得到 $1.053\\,\\mathrm{s}$。",
            "answer": "$$\\boxed{1.053}$$"
        },
        {
            "introduction": "现实世界中的生物系统大多是非线性的。本练习探讨一个更微妙但至关重要的问题：即使原始连续系统拥有一个稳定的平衡点，不恰当的数值积分也可能错误地产生振荡甚至混沌行为 。通过分析一个典型的自抑制细胞因子模型，您将亲手计算导致这种“翻转不稳定性”的临界步长，深刻体会数值方法可能引入的伪影及其对模型解释的潜在风险。",
            "id": "3913014",
            "problem": "一个细胞培养中抑制性自分泌细胞因子的单室模型由常微分方程（ODE）描述\n$$\n\\frac{dx}{dt} = f(x) = \\frac{s}{1 + \\left(\\frac{x}{K}\\right)^{n}} - c\\,x,\n$$\n其中 $x(t)$ 是细胞因子浓度，$s$ 是最大产生速率，$K$ 是半饱和浓度，$n$ 是控制抑制强度的希尔系数（Hill coefficient），$c$ 是一阶清除率。假设选择参数使得平衡点位于半饱和点，即取 $s = 2\\,c\\,K$，从而 $x^{\\ast} = K$ 满足 $f(x^{\\ast}) = 0$。考虑使用显式欧拉方法（explicit Euler method）对该常微分方程进行数值积分，\n$$\nx_{k+1} = x_{k} + h\\,f(x_{k}),\n$$\n其中时间步长 $h  0$ 为常数。从连续时间平衡点和线性化的基本定义，以及平衡点的离散时间线性稳定性出发，推导在 $x^{\\ast}$ 附近欧拉更新的局部离散时间稳定性乘子，并展示当 $h$ 过大时，欧拉方法使一个连续时间稳定平衡点变得不稳定的条件。将翻转（倍周期）不稳定性（flip (period-doubling) instability）定义为当离散时间乘子穿过 $-1$ 时发生的稳定性丧失，并确定发生这种情况时的临界步长 $h_{\\mathrm{flip}}$。\n\n使用参数值 $c = 0.7$ $\\mathrm{hr}^{-1}$，$n = 4$ 和 $K = 5$ $\\mathrm{ng}\\,\\mathrm{mL}^{-1}$，以及 $s = 2\\,c\\,K$，计算 $h_{\\mathrm{flip}}$ 的数值。将您的答案四舍五入到四位有效数字，并以小时为单位表示。",
            "solution": "该问题是有效的，因为它是一个适定的、有科学依据的练习，内容涉及将一种数值方法应用于一个标准生物医学系统模型的稳定性分析。所有必要信息均已提供，问题没有矛盾或含糊之处。\n\n单室模型由常微分方程（ODE）描述：\n$$\n\\frac{dx}{dt} = f(x) = \\frac{s}{1 + \\left(\\frac{x}{K}\\right)^{n}} - c\\,x\n$$\n其中 $x(t)$ 是细胞因子浓度，$s$、$K$、$n$ 和 $c$ 是正常数。参数受到约束，$s = 2\\,c\\,K$，这在 $x^{\\ast} = K$ 处建立了一个平衡点。我们可以通过将 $x = K$ 和 $s = 2\\,c\\,K$ 代入 $f(x)$ 来验证这一点：\n$$\nf(K) = \\frac{2\\,c\\,K}{1 + \\left(\\frac{K}{K}\\right)^{n}} - c\\,K = \\frac{2\\,c\\,K}{1 + 1^{n}} - c\\,K = \\frac{2\\,c\\,K}{2} - c\\,K = c\\,K - c\\,K = 0\n$$\n因此，$x^{\\ast} = K$ 确实是连续时间系统的一个平衡点。\n\n首先，我们确定这个平衡点在连续时间系统中的稳定性。平衡点 $x^{\\ast}$ 的局部稳定性由导数 $f'(x^{\\ast}) = \\frac{df}{dx}|_{x=x^{\\ast}}$ 的符号决定。如果 $f'(x^{\\ast})  0$，则平衡点是稳定的。我们计算 $f(x)$ 的导数：\n$$\nf'(x) = \\frac{d}{dx} \\left[ s \\left(1 + \\left(\\frac{x}{K}\\right)^{n}\\right)^{-1} - c\\,x \\right]\n$$\n使用链式法则：\n$$\nf'(x) = -s \\left(1 + \\left(\\frac{x}{K}\\right)^{n}\\right)^{-2} \\cdot \\frac{d}{dx}\\left(\\frac{x}{K}\\right)^{n} - c\n$$\n$$\nf'(x) = -s \\left(1 + \\left(\\frac{x}{K}\\right)^{n}\\right)^{-2} \\cdot n \\left(\\frac{x}{K}\\right)^{n-1} \\cdot \\frac{1}{K} - c\n$$\n现在，我们在平衡点 $x^{\\ast} = K$ 处计算这个导数：\n$$\nf'(K) = -s \\left(1 + \\left(\\frac{K}{K}\\right)^{n}\\right)^{-2} \\cdot \\frac{n}{K} \\left(\\frac{K}{K}\\right)^{n-1} - c\n$$\n$$\nf'(K) = -s \\left(1 + 1\\right)^{-2} \\cdot \\frac{n}{K} \\left(1\\right)^{n-1} - c = -s (2)^{-2} \\frac{n}{K} - c = -\\frac{s\\,n}{4\\,K} - c\n$$\n代入给定条件 $s = 2\\,c\\,K$：\n$$\nf'(K) = -\\frac{(2\\,c\\,K)\\,n}{4\\,K} - c = -\\frac{2\\,c\\,n}{4} - c = -\\frac{c\\,n}{2} - c = -c\\left(\\frac{n}{2} + 1\\right)\n$$\n由于参数 $c$ 和 $n$ 是正数，所以 $f'(K)$ 严格为负。因此，平衡点 $x^{\\ast}=K$ 在连续时间模型中是局部稳定的。\n\n接下来，我们分析该常微分方程的显式欧拉方法（explicit Euler method）：\n$$\nx_{k+1} = x_{k} + h\\,f(x_{k})\n$$\n这是一个形如 $x_{k+1} = G(x_k)$ 的离散时间动力系统，其中更新函数为 $G(x) = x + h\\,f(x)$。该常微分方程的平衡点 $x^{\\ast}$ 是此映射的一个不动点，因为 $f(x^{\\ast})=0$ 意味着 $G(x^{\\ast}) = x^{\\ast} + h \\cdot 0 = x^{\\ast}$。\n\n离散时间系统中不动点 $x^{\\ast}$ 的局部稳定性由局部稳定性乘子 $\\lambda$ 决定，该乘子是更新函数在不动点处的导数：\n$$\n\\lambda = G'(x^{\\ast}) = \\frac{d}{dx}\\left[x + h\\,f(x)\\right]_{x=x^{\\ast}} = 1 + h\\,f'(x^{\\ast})\n$$\n不动点稳定的充要条件是 $|\\lambda|  1$，即 $-1  \\lambda  1$。\n代入 $f'(K)$ 的表达式：\n$$\n\\lambda = 1 + h \\left[-c\\left(\\frac{n}{2} + 1\\right)\\right] = 1 - h\\,c\\left(\\frac{n}{2} + 1\\right)\n$$\n稳定性条件是：\n$$\n-1  1 - h\\,c\\left(\\frac{n}{2} + 1\\right)  1\n$$\n我们分别分析这两个不等式。右侧的不等式是：\n$$\n1 - h\\,c\\left(\\frac{n}{2} + 1\\right)  1 \\implies -h\\,c\\left(\\frac{n}{2} + 1\\right)  0\n$$\n由于 $h0$，$c0$ 和 $n0$，项 $h\\,c\\left(\\frac{n}{2} + 1\\right)$ 总是正的，所以这个不等式总是成立。\n\n左侧的不等式决定了稳定性边界：\n$$\n-1  1 - h\\,c\\left(\\frac{n}{2} + 1\\right) \\implies h\\,c\\left(\\frac{n}{2} + 1\\right)  2\n$$\n$$\nh  \\frac{2}{c\\left(\\frac{n}{2} + 1\\right)}\n$$\n如果步长 $h$ 超过这个临界值，乘子 $\\lambda$ 将变得小于 $-1$，数值计算出的解将在平衡点周围表现出增长的振荡，即使底层的连续时间平衡点是稳定的。这就是欧拉方法使一个稳定平衡点变得不稳定的条件。\n\n翻转或倍周期不稳定性发生在稳定性丧失的确切点，即乘子 $\\lambda$ 穿过 $-1$ 的时候。临界步长 $h_{\\mathrm{flip}}$ 是使 $\\lambda = -1$ 的 $h$ 值。\n$$\n1 - h_{\\mathrm{flip}}\\,c\\left(\\frac{n}{2} + 1\\right) = -1\n$$\n求解 $h_{\\mathrm{flip}}$：\n$$\nh_{\\mathrm{flip}}\\,c\\left(\\frac{n}{2} + 1\\right) = 2\n$$\n$$\nh_{\\mathrm{flip}} = \\frac{2}{c\\left(\\frac{n}{2} + 1\\right)}\n$$\n这就是临界步长的解析表达式。\n\n最后，我们使用给定的参数值 $c = 0.7$ $\\mathrm{hr}^{-1}$ 和 $n = 4$ 来计算 $h_{\\mathrm{flip}}$ 的数值。此计算不需要 $K$ 的值。\n$$\nh_{\\mathrm{flip}} = \\frac{2}{0.7 \\left(\\frac{4}{2} + 1\\right)} = \\frac{2}{0.7 \\left(2 + 1\\right)} = \\frac{2}{0.7 \\times 3} = \\frac{2}{2.1}\n$$\n$$\nh_{\\mathrm{flip}} = \\frac{20}{21} \\approx 0.95238095... \\, \\mathrm{hr}\n$$\n将结果四舍五入到四位有效数字，我们得到 $0.9524$ 小时。",
            "answer": "$$\n\\boxed{0.9524}\n$$"
        },
        {
            "introduction": "从理论分析走向实际应用，是建模能力的关键一步。本练习要求您为一个带周期性推注给药的药物动力学模型编写一个显式欧拉积分器 。这项任务的挑战不仅在于实现算法本身，更在于处理给药瞬间浓度跳变的“事件”，并通过与解析解的直接比较，来量化数值方法的系统偏差，从而培养在实践中评估模拟结果可靠性的能力。",
            "id": "3913071",
            "problem": "考虑一个具有一级消除的线性单室药代动力学模型，该模型在规律的时间间隔内接受瞬时静脉推注给药。设 $C(t)$ 表示血浆中的药物浓度，假定其在空间上是充分混合的。具有一级消除的单室系统的质量平衡方程为 $V \\,\\dfrac{dC}{dt} = - \\mathrm{CL}\\, C$，其中 $V$ 是分布容积，$\\mathrm{CL}$ 是清除率。定义消除速率常数 $k = \\mathrm{CL}/V$。在时间 $t_k = k \\,\\tau$（对于整数 $k \\ge 0$）瞬时给予大小为 $D$ 的推注剂量，其模型为浓度的瞬时跳跃：$C(t_k^+) = C(t_k^-) + D/V$。在两次给药之间，动力学由常微分方程（ODE）控制：$\\dfrac{dC}{dt} = -k C$。所有物理量均以其标准单位表示：剂量 $D$ 单位为 $\\mathrm{mg}$，容积 $V$ 单位为 $\\mathrm{L}$，清除率 $\\mathrm{CL}$ 单位为 $\\mathrm{L}\\,\\mathrm{h}^{-1}$，浓度 $C$ 单位为 $\\mathrm{mg}\\,\\mathrm{L}^{-1}$，时间 $t$ 单位为 $\\mathrm{h}$，给药间隔 $\\tau$ 单位为 $\\mathrm{h}$，步长 $h$ 单位为 $\\mathrm{h}$。\n\n任务：为两次给药之间的 ODE 实现一个显式前向欧拉数值积分器，并满足以下事件处理要求：如果一个给药时间 $t_k$ 严格落在一个大小为 $h$ 的基本步长内，则必须分割该步长，使得一个子步长恰好在 $t_k$ 处结束，施加瞬时跳跃，然后继续积分。积分器使用固定的基本步长 $h$。重复给药方案是在 $t=0$ 时及此后每隔 $\\tau$ 时间进行一次推注给药。\n\n对于下面测试套件中的每一组参数：\n1. 模拟系统直至达到稳态。使用以下标准来选择模拟的给药次数：选择最小的整数 $M$，使得 $\\exp(-k \\,\\tau\\, M) \\le \\epsilon$（其中 $\\epsilon = 10^{-10}$），并从 $C(0^+) = D/V$ 开始模拟 $M$ 个给药间隔。对于线性系统，此标准保证了初始条件的残留记忆衰减到可忽略的水平。\n2. 根据模拟的最后一个给药间隔，计算欧拉近似的稳态峰浓度（刚给药后）和稳态谷浓度（下一次给药前）。将它们分别表示为 $C_{\\mathrm{peak,\\,Euler}}$ 和 $C_{\\mathrm{trough,\\,Euler}}$，单位均为 $\\mathrm{mg}\\,\\mathrm{L}^{-1}$。\n3. 对于每隔 $\\tau$ 时间进行瞬时推注的相同模型，使用从带跳跃的线性 ODE 的基本解推导出的解析计算，计算相应的精确连续时间稳态峰浓度和谷浓度 $C_{\\mathrm{peak,\\,exact}}$ 和 $C_{\\mathrm{trough,\\,exact}}$。结果以 $\\mathrm{mg}\\,\\mathrm{L}^{-1}$ 表示。\n4. 对每组参数，报告有符号偏差，定义为 $\\mathrm{bias}_{\\mathrm{peak}} = C_{\\mathrm{peak,\\,Euler}} - C_{\\mathrm{peak,\\,exact}}$ 和 $\\mathrm{bias}_{\\mathrm{trough}} = C_{\\mathrm{trough,\\,Euler}} - C_{\\mathrm{trough,\\,exact}}$，单位为 $\\mathrm{mg}\\,\\mathrm{L}^{-1}$。\n\n您的程序必须实现上述逻辑，并生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按顺序汇总所有测试用例的结果。对于每个测试用例，按顺序输出两个浮点数 $[\\mathrm{bias}_{\\mathrm{peak}}, \\mathrm{bias}_{\\mathrm{trough}}]$，并将它们展平到一个列表中。所有输出都必须以十进制数（无百分号）表示，单位为 $\\mathrm{mg}\\,\\mathrm{L}^{-1}$。\n\n测试套件（五组参数），每组指定为 $(D, V, \\mathrm{CL}, \\tau, h)$：\n- 案例 A（理想路径，高分辨率）：$(1000, 50, 5, 12, 0.5)$，其中 $D=1000\\,\\mathrm{mg}$, $V=50\\,\\mathrm{L}$, $\\mathrm{CL}=5\\,\\mathrm{L}\\,\\mathrm{h}^{-1}$, $\\tau=12\\,\\mathrm{h}$, $h=0.5\\,\\mathrm{h}$。\n- 案例 B（较粗糙但对齐，$\\tau/h$ 为整数）：$(1000, 50, 5, 12, 3)$，其中 $h=3\\,\\mathrm{h}$。\n- 案例 C（较粗糙且不对齐，测试步长分割）：$(1000, 50, 5, 8, 3)$，其中 $\\tau=8\\,\\mathrm{h}$, $h=3\\,\\mathrm{h}$。\n- 案例 D（非常粗糙，欧拉每步因子为正，测试大 $h$ 效应）：$(1000, 50, 5, 24, 9.5)$，其中 $\\tau=24\\,\\mathrm{h}$, $h=9.5\\,\\mathrm{h}$。\n- 案例 E（每个给药间隔单步）：$(1000, 50, 5, 6, 6)$，其中 $\\tau=6\\,\\mathrm{h}$, $h=6\\,\\mathrm{h}$。\n\n最终输出格式要求：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，对于五个案例为 $[x_1,x_2,\\dots,x_{10}]$，每个案例按顺序提供两个数字：峰浓度偏差，然后是谷浓度偏差）。所有数字必须是浮点数，以十进制表示法表示 $\\mathrm{mg}\\,\\mathrm{L}^{-1}$。",
            "solution": "用户希望分析一个具有一级消除和重复瞬时静脉推注给药的线性单室药代动力学模型。任务是比较通过解析解获得的稳态峰、谷药物浓度与通过使用显式前向欧拉方法的数值模拟获得的结果。需要报告多组参数下，数值解与解析解之间的偏差。\n\n问题的核心涉及两个主要部分：推导精确的解析解和实现一个能处理给药事件的精细数值模拟。\n\n**1. 稳态解析解**\n\n系统在两次给药之间由线性常微分方程（ODE）描述：\n$$\n\\frac{dC}{dt} = -k C(t)\n$$\n其中 $k = \\mathrm{CL}/V$ 是消除速率常数。此 ODE 的解为 $C(t) = C_0 e^{-kt}$，其中 $C_0$ 是衰减期在 $t=0$ 时的浓度。\n\n每隔 $\\tau$ 小时给予大小为 $D$ 的推注剂量。这会引入一个大小为 $D/V$ 的周期性浓度跳跃。设 $C_{\\mathrm{peak}, n}$ 为第 $n$ 次给药后的瞬时峰浓度，$C_{\\mathrm{trough}, n}$ 为第 $n$ 次给药前的瞬时谷浓度。\n\n浓度在给药间隔 $\\tau$ 内衰减：\n$$\nC_{\\mathrm{trough}, n+1} = C_{\\mathrm{peak}, n} \\, e^{-k\\tau}\n$$\n衰减后立即给予下一次剂量：\n$$\nC_{\\mathrm{peak}, n+1} = C_{\\mathrm{trough}, n+1} + \\frac{D}{V} = C_{\\mathrm{peak}, n} \\, e^{-k\\tau} + \\frac{D}{V}\n$$\n这是峰浓度的线性递推关系。在稳态时，相邻间隔的浓度是相同的，因此 $C_{\\mathrm{peak}, n+1} = C_{\\mathrm{peak}, n} = C_{\\mathrm{peak,\\,exact}}$。\n求解 $C_{\\mathrm{peak,\\,exact}}$ 可得解析的稳态峰浓度：\n$$\nC_{\\mathrm{peak,\\,exact}} \\left(1 - e^{-k\\tau}\\right) = \\frac{D}{V} \\implies C_{\\mathrm{peak,\\,exact}} = \\frac{D/V}{1 - e^{-k\\tau}}\n$$\n相应的稳态谷浓度通过应用一个间隔的衰减得到：\n$$\nC_{\\mathrm{trough,\\,exact}} = C_{\\mathrm{peak,\\,exact}} \\, e^{-k\\tau}\n$$\n\n**2. 使用前向欧拉法的数值模拟**\n\n前向欧拉法用于近似求解 ODE。对于步长 $\\Delta t$，更新规则是：\n$$\nC(t + \\Delta t) \\approx C(t) + \\Delta t \\left( \\frac{dC}{dt} \\right)\\bigg|_t = C(t) + \\Delta t (-k C(t)) = C(t) (1 - k \\Delta t)\n$$\n模拟协议要求达到实际的稳态。这通过模拟足够数量的给药间隔 $M$ 来实现，直到初始条件 $C(0)=0$ 的影响消失。标准是选择最小的整数 $M$，使得 $e^{-k\\tau M} \\le \\epsilon$，其中 $\\epsilon = 10^{-10}$。取自然对数并整理可得：\n$$\n-k\\tau M \\le \\ln(\\epsilon) \\implies M \\ge \\frac{-\\ln(\\epsilon)}{k\\tau}\n$$\n因此，我们选择 $M = \\lceil \\frac{-\\ln(\\epsilon)}{k\\tau} \\rceil$。\n\n模拟被构造成一个遍历 $M$ 个给药间隔的循环。这种设计清晰地将连续的衰减动力学与离散的给药事件分离开来。\n\n对于每个间隔 $j \\in \\{0, 1, \\dots, M-1\\}$：\n1.  **给药事件：** 间隔开始时的浓度 $C_{\\mathrm{trough}}$ 因推注剂量而增加：$C_{\\mathrm{peak}} = C_{\\mathrm{trough}} + D/V$。如果这是最后一个间隔（即 $j = M-1$），则将此峰值记录为 $C_{\\mathrm{peak,\\,Euler}}$。\n2.  **衰减阶段：** 模拟在持续时间为 $\\tau$ 的间隔内的衰减。这是通过执行多个欧拉步来完成的。为了按规定正确处理事件时间，使用固定的基本步长 $h$。对于间隔内的每一步，实际步长 $\\Delta t$ 被确定为基本步长 $h$ 和当前给药间隔中剩余时间的最小值。也就是说，如果间隔内的当前局部时间是 $t_{\\mathrm{local}}$，那么 $\\Delta t = \\min(h, \\tau - t_{\\mathrm{local}})$。这确保了模拟以大小为 $h$ 的步长进行，但在最后会采取一个较小的步长以精确地落在间隔的末尾，从而正确地实现了指定的步长分割逻辑。\n3.  **更新：** 模拟完间隔内的衰减后，最终浓度即为下一个间隔的谷浓度。\n\n在遍历 $M$ 个间隔的循环完成后，最终的浓度即为稳态谷浓度 $C_{\\mathrm{trough,\\,Euler}}$。\n\n**3. 偏差计算**\n\n最后，通过从数值近似值中减去解析值来计算有符号偏差：\n$$\n\\mathrm{bias}_{\\mathrm{peak}} = C_{\\mathrm{peak,\\,Euler}} - C_{\\mathrm{peak,\\,exact}}\n$$\n$$\n\\mathrm{bias}_{\\mathrm{trough}} = C_{\\mathrm{trough,\\,Euler}} - C_{\\mathrm{trough,\\,exact}}\n$$\n由于前向欧拉法是应用于凸解曲线（$C''(t) = k^2 C(t) > 0$）的一阶方法，预计它在每一步都会低估真实浓度。这导致预测，对于给定的稳定测试用例（其中 $1-kh > 0$），两个偏差都将为负。该实现将为每个指定的参数集计算这些偏差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries are required or permitted.\n\ndef solve():\n    \"\"\"\n    Main function to solve the pharmacokinetic modeling problem.\n    It iterates through test cases, runs simulations, and prints the results.\n    \"\"\"\n\n    test_cases = [\n        # (D, V, CL, tau, h)\n        (1000.0, 50.0, 5.0, 12.0, 0.5),   # Case A\n        (1000.0, 50.0, 5.0, 12.0, 3.0),   # Case B\n        (1000.0, 50.0, 5.0, 8.0, 3.0),    # Case C\n        (1000.0, 50.0, 5.0, 24.0, 9.5),   # Case D\n        (1000.0, 50.0, 5.0, 6.0, 6.0),    # Case E\n    ]\n\n    all_results = []\n    for case in test_cases:\n        D, V, CL, tau, h = case\n        \n        # Calculate constants\n        k = CL / V\n        dose_conc_jump = D / V\n        epsilon = 1e-10\n\n        # --- Part 1: Analytical Solution ---\n        # The denominator 1 - exp(-k*tau) is always > 0 for k>0, tau>0.\n        C_peak_exact = dose_conc_jump / (1.0 - np.exp(-k * tau))\n        C_trough_exact = C_peak_exact * np.exp(-k * tau)\n\n        # --- Part 2: Numerical Simulation with Forward Euler ---\n        # Determine the number of dosing intervals to simulate to reach steady state\n        # The equation is M >= -log(epsilon) / (k * tau)\n        M = int(np.ceil(-np.log(epsilon) / (k * tau)))\n\n        # Initialize simulation variables\n        C_current_trough = 0.0  # Concentration just before a dose\n        C_peak_euler = 0.0\n        \n        # Loop through M dosing intervals\n        for j in range(M):\n            # Apply dose to get the peak concentration for the current interval\n            C_peak_for_interval = C_current_trough + dose_conc_jump\n\n            # If this is the last interval (j = M-1), store the peak value\n            if j == M - 1:\n                C_peak_euler = C_peak_for_interval\n            \n            # Simulate the decay over the interval of duration tau\n            C_in_interval = C_peak_for_interval\n            t_local = 0.0\n            \n            # Use a small tolerance relative to tau to avoid infinite loops from float errors\n            while t_local  tau - 1e-9 * tau:\n                # Determine step size: min of base step h and remaining time in interval\n                dt = min(h, tau - t_local)\n                \n                # Apply Forward Euler step\n                C_in_interval = C_in_interval * (1.0 - k * dt)\n                \n                # Advance local time\n                t_local += dt\n\n            # Update the trough concentration for the next interval\n            C_current_trough = C_in_interval\n        \n        # The final trough concentration is the value at the end of the last interval\n        C_trough_euler = C_current_trough\n\n        # --- Part 3: Calculate Biases ---\n        bias_peak = C_peak_euler - C_peak_exact\n        bias_trough = C_trough_euler - C_trough_exact\n        \n        all_results.append(bias_peak)\n        all_results.append(bias_trough)\n\n    # Final print statement in the exact required format.\n    # Using a specific format string for floats to ensure decimal notation.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}