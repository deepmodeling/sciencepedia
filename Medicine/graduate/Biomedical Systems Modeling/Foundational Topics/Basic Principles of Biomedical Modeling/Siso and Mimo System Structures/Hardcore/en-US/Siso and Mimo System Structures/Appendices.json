{
    "hands_on_practices": [
        {
            "introduction": "Understanding the dynamic response of physiological systems is the cornerstone of biomedical modeling. This first exercise grounds us in the fundamentals of Single-Input Single-Output (SISO) systems by analyzing a classic first-order plus time delay model, commonly used to represent processes like respiration. By calculating the steady-state response to a sinusoidal input, you will practice core frequency-domain techniques and learn how to use practical tools like the Padé approximation to handle time delays, which are ubiquitous in biological signal transport .",
            "id": "3928545",
            "problem": "A respiratory plant in a Single-Input Single-Output (SISO) configuration is modeled as a linear time-invariant system with transfer function $G(s)=\\frac{k}{\\tau s+1}\\exp(-\\theta s)$, where $k0$ is a dimensionless gain summarizing the static sensitivity of alveolar ventilation to ventilatory command, $\\tau0$ is a mechanical time constant of the lung in seconds, and $\\theta0$ is a positive transport delay in seconds attributable to neuromechanical response and gas transport. The input ventilatory command is $u(t)=U_{0}\\cos(\\omega t)$ for $t\\geq 0$, where $U_{0}0$ is the amplitude expressed in liters per minute and $\\omega0$ is the angular frequency in radians per second. Assume the system is internally stable and linear, and that the output $y(t)$ is alveolar ventilation expressed in liters per minute.\n\nStarting from the fundamental definitions of linear time-invariant systems in the time and frequency domains (convolution, sinusoidal steady-state response, and the Laplace transform evaluated on the imaginary axis), and using a first-order Padé approximation of the time delay about $s=0$, derive the sinusoidal steady-state output $y_{\\text{ss}}(t)$ and compute:\n\n1. The output steady-state amplitude $A_{\\text{out}}$ in liters per minute.\n2. The output steady-state phase shift $\\phi$ relative to $u(t)$ in radians.\n\nExpress your final answers as closed-form analytic expressions in terms of $k$, $\\tau$, $\\theta$, $\\omega$, and $U_{0}$. Provide the phase in radians. No numerical evaluation is required, and no rounding is needed. The final answer must be given as an ordered pair $(A_{\\text{out}},\\phi)$.",
            "solution": "The steady-state response of a stable, linear time-invariant (LTI) system with transfer function $H(s)$ to a sinusoidal input $u(t) = U_0 \\cos(\\omega t)$ is given by $y_{\\text{ss}}(t) = U_0 |H(j\\omega)| \\cos(\\omega t + \\angle H(j\\omega))$. The output is a sinusoid of the same frequency $\\omega$, with its amplitude scaled by the magnitude of the frequency response $|H(j\\omega)|$ and its phase shifted by the argument of the frequency response $\\angle H(j\\omega)$.\n\nThe given transfer function is $G(s)=\\frac{k}{\\tau s+1}\\exp(-\\theta s)$. The problem requires the use of a first-order Padé approximation for the time delay term, $\\exp(-\\theta s)$, about $s=0$. The most common and appropriate interpretation of a \"first-order\" Padé approximation is the $[1,1]$ approximant, which is a rational function with first-order polynomials in both the numerator and the denominator. We denote it as $R_{1,1}(s)$.\n\nThe Maclaurin series for $\\exp(-\\theta s)$ is:\n$$ \\exp(-\\theta s) = 1 - \\theta s + \\frac{(\\theta s)^2}{2!} - \\frac{(\\theta s)^3}{3!} + \\dots $$\nThe $[1,1]$ Padé approximant has the form $R_{1,1}(s) = \\frac{1+a_1 s}{1+b_1 s}$. We determine the coefficients $a_1$ and $b_1$ by matching the series expansion of $R_{1,1}(s)$ to that of $\\exp(-\\theta s)$ up to the highest possible order, which is $1+1=2$.\n$$ \\frac{1+a_1 s}{1+b_1 s} = (1+a_1 s)(1 - b_1 s + (b_1 s)^2 - \\dots) = 1 + (a_1 - b_1)s + (b_1^2 - a_1 b_1)s^2 + \\dots $$\nComparing coefficients:\n\\begin{itemize}\n    \\item Coefficient of $s^1$: $a_1 - b_1 = -\\theta$\n    \\item Coefficient of $s^2$: $b_1^2 - a_1 b_1 = \\frac{\\theta^2}{2}$\n\\end{itemize}\nFrom the first equation, $a_1 = b_1 - \\theta$. Substituting into the second equation:\n$$ b_1^2 - (b_1 - \\theta)b_1 = \\frac{\\theta^2}{2} \\implies b_1^2 - b_1^2 + \\theta b_1 = \\frac{\\theta^2}{2} \\implies \\theta b_1 = \\frac{\\theta^2}{2} $$\nSince $\\theta  0$, we find $b_1 = \\frac{\\theta}{2}$. Substituting back gives $a_1 = \\frac{\\theta}{2} - \\theta = -\\frac{\\theta}{2}$.\nThus, the first-order Padé approximation is:\n$$ \\exp(-\\theta s) \\approx R_{1,1}(s) = \\frac{1 - \\frac{\\theta}{2}s}{1 + \\frac{\\theta}{2}s} $$\nThe approximated system transfer function, $G_a(s)$, is:\n$$ G_a(s) = \\frac{k}{\\tau s+1} \\cdot \\frac{1 - \\frac{\\theta}{2}s}{1 + \\frac{\\theta}{2}s} $$\nTo find the sinusoidal steady-state response, we evaluate the frequency response by setting $s = j\\omega$:\n$$ G_a(j\\omega) = \\frac{k}{1+j\\omega\\tau} \\cdot \\frac{1 - j\\frac{\\omega\\theta}{2}}{1 + j\\frac{\\omega\\theta}{2}} $$\nThe steady-state output is $y_{\\text{ss}}(t) = A_{\\text{out}}\\cos(\\omega t + \\phi)$, where $A_{\\text{out}} = U_0|G_a(j\\omega)|$ and $\\phi = \\angle G_a(j\\omega)$.\n\n1. Calculation of the output amplitude $A_{\\text{out}}$:\nThe amplitude is $A_{\\text{out}} = U_0 |G_a(j\\omega)|$. The magnitude of $G_a(j\\omega)$ is the product of the magnitudes of its components:\n$$ |G_a(j\\omega)| = \\left| \\frac{k}{1+j\\omega\\tau} \\right| \\cdot \\left| \\frac{1 - j\\frac{\\omega\\theta}{2}}{1 + j\\frac{\\omega\\theta}{2}} \\right| $$\nSince $k0$, $|k|=k$. The magnitude of the first-order term is:\n$$ |1+j\\omega\\tau| = \\sqrt{1^2 + (\\omega\\tau)^2} = \\sqrt{1 + \\omega^2\\tau^2} $$\nThe Padé approximant term is an all-pass filter. Its magnitude is:\n$$ \\left| \\frac{1 - j\\frac{\\omega\\theta}{2}}{1 + j\\frac{\\omega\\theta}{2}} \\right| = \\frac{|1 - j\\frac{\\omega\\theta}{2}|}{|1 + j\\frac{\\omega\\theta}{2}|} = \\frac{\\sqrt{1^2 + (-\\frac{\\omega\\theta}{2})^2}}{\\sqrt{1^2 + (\\frac{\\omega\\theta}{2})^2}} = \\frac{\\sqrt{1+\\frac{\\omega^2\\theta^2}{4}}}{\\sqrt{1+\\frac{\\omega^2\\theta^2}{4}}} = 1 $$\nCombining these results, the magnitude of the frequency response is:\n$$ |G_a(j\\omega)| = \\frac{k}{\\sqrt{1 + \\omega^2\\tau^2}} \\cdot 1 = \\frac{k}{\\sqrt{1 + \\omega^2\\tau^2}} $$\nTherefore, the output steady-state amplitude is:\n$$ A_{\\text{out}} = \\frac{k U_0}{\\sqrt{1 + \\omega^2\\tau^2}} $$\n\n2. Calculation of the output phase shift $\\phi$:\nThe phase shift is $\\phi = \\angle G_a(j\\omega)$. The phase of a product of complex numbers is the sum of their individual phases:\n$$ \\phi = \\angle \\left(\\frac{k}{1+j\\omega\\tau}\\right) + \\angle \\left(\\frac{1 - j\\frac{\\omega\\theta}{2}}{1 + j\\frac{\\omega\\theta}{2}}\\right) $$\nThis can be expanded as:\n$$ \\phi = \\angle(k) - \\angle(1+j\\omega\\tau) + \\angle\\left(1-j\\frac{\\omega\\theta}{2}\\right) - \\angle\\left(1+j\\frac{\\omega\\theta}{2}\\right) $$\nWe evaluate each term:\n\\begin{itemize}\n    \\item $\\angle(k) = 0$ since $k$ is a positive real number.\n    \\item $\\angle(1+j\\omega\\tau) = \\arctan(\\frac{\\omega\\tau}{1}) = \\arctan(\\omega\\tau)$.\n    \\item $\\angle\\left(1-j\\frac{\\omega\\theta}{2}\\right) = \\arctan\\left(\\frac{-\\omega\\theta/2}{1}\\right) = -\\arctan\\left(\\frac{\\omega\\theta}{2}\\right)$, since the real part is positive.\n    \\item $\\angle\\left(1+j\\frac{\\omega\\theta}{2}\\right) = \\arctan\\left(\\frac{\\omega\\theta/2}{1}\\right) = \\arctan\\left(\\frac{\\omega\\theta}{2}\\right)$.\n\\end{itemize}\nCombining the phase components gives the total phase shift:\n$$ \\phi = 0 - \\arctan(\\omega\\tau) + \\left(-\\arctan\\left(\\frac{\\omega\\theta}{2}\\right)\\right) - \\arctan\\left(\\frac{\\omega\\theta}{2}\\right) $$\n$$ \\phi = -\\arctan(\\omega\\tau) - 2\\arctan\\left(\\frac{\\omega\\theta}{2}\\right) $$\nThe phase is given in radians, as is standard for the `arctan` function.\n\nThe final expressions for the amplitude and phase are:\n$$ A_{\\text{out}} = \\frac{k U_0}{\\sqrt{1 + \\omega^2\\tau^2}} $$\n$$ \\phi = -\\arctan(\\omega\\tau) - 2\\arctan\\left(\\frac{\\omega\\theta}{2}\\right) $$",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{k U_{0}}{\\sqrt{1 + \\omega^{2}\\tau^{2}}}  -\\arctan(\\omega\\tau) - 2\\arctan\\left(\\frac{\\omega\\theta}{2}\\right) \\end{pmatrix} } $$"
        },
        {
            "introduction": "While SISO models are essential, most physiological systems are inherently interconnected. This practice transitions our focus to Multiple-Input Multiple-Output (MIMO) structures, where the key challenge is managing the interactions between different control channels. Using the Relative Gain Array (RGA), a powerful analytical tool, you will assess the suitability of a simple decentralized control strategy for a drug infusion system and uncover the critical difference between steady-state and dynamic coupling, a crucial insight for designing effective multivariable controllers .",
            "id": "3928521",
            "problem": "Consider a linearized two-input two-output biomedical regulation system for mean arterial pressure and heart rate under vasoactive drug infusions. The inputs $u_1$ and $u_2$ are infusion rates of two drugs, and the outputs $y_1$ and $y_2$ are deviations in mean arterial pressure and heart rate, respectively, from a homeostatic baseline. The plant is modeled by the $2 \\times 2$ transfer function matrix\n$$\nG(s) \\;=\\;\n\\begin{pmatrix}\n\\displaystyle \\frac{1}{50 s + 1}  \\displaystyle 0.05\\,\\frac{1 + 50 s}{5 s + 1} \\\\[10pt]\n\\displaystyle 0.05\\,\\frac{1 + 40 s}{4 s + 1}  \\displaystyle \\frac{1}{30 s + 1}\n\\end{pmatrix}.\n$$\nThis structure arises from mass-balance linearization and reflex pathway dynamics: the diagonal elements are slow first-order pharmacodynamic effects, while the off-diagonal elements are lead-lag cross-couplings mediated by baroreflex pathways that are weak at steady state but stronger dynamically.\n\nYou are asked to assess the quality of diagonal pairing (input $u_1$ with output $y_1$, and input $u_2$ with output $y_2$) using the Relative Gain Array (RGA). The Relative Gain Array (RGA) at a complex frequency $s$ is defined for a square Multiple-Input Multiple-Output (MIMO) plant $G(s)$ by\n$$\n\\Lambda(s) \\;=\\; G(s) \\,\\circ\\, \\big(G(s)^{-T}\\big),\n$$\nwhere $\\circ$ denotes the Hadamard (elementwise) product and $^{-T}$ denotes inverse transpose. In the steady state, $s = 0$, the RGA $\\Lambda(0)$ indicates the pairing quality; diagonal elements near $1$ and small off-diagonal elements indicate favorable diagonal pairing. However, diagonal pairing can perform poorly if dynamic interactions are strong near the intended loop bandwidth, even when the steady-state RGA is favorable.\n\nStarting from the given model and the RGA definition, do the following:\n\n1. Evaluate the steady-state RGA $\\Lambda(0)$ and comment on the diagonal pairing quality based on its diagonal and off-diagonal entries.\n2. Define the dynamic RGA at frequency $\\omega$ as $\\Lambda(j\\omega)$ and evaluate the $(1,1)$ element $\\Lambda_{11}(j\\omega)$ at the frequency $\\omega^\\star = 0.2$ (in radians per second). This frequency represents a typical target bandwidth for Single-Input Single-Output (SISO) decentralized designs for the given slow diagonal dynamics.\n3. Quantify the severity of dynamic interaction for the diagonal pairing by computing the scalar\n$$\nS \\;=\\; \\big|\\Lambda_{11}(j\\omega^\\star)\\big|.\n$$\n\nExpress the final value of $S$ as a dimensionless number and round your answer to four significant figures. No other quantities are to be reported in the final answer.",
            "solution": "The problem requires the analysis of a $2 \\times 2$ Multiple-Input Multiple-Output (MIMO) system using the Relative Gain Array (RGA), $\\Lambda(s)$. The RGA is defined as\n$$\n\\Lambda(s) = G(s) \\circ \\left(G(s)^{-T}\\right)\n$$\nwhere $G(s)$ is the plant's transfer function matrix, $\\circ$ denotes the Hadamard (elementwise) product, and $^{-T}$ denotes the inverse transpose.\n\nThe given plant transfer function is\n$$\nG(s) =\n\\begin{pmatrix}\ng_{11}(s)  g_{12}(s) \\\\\ng_{21}(s)  g_{22}(s)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\displaystyle \\frac{1}{50 s + 1}  \\displaystyle 0.05\\,\\frac{1 + 50 s}{5 s + 1} \\\\\n\\displaystyle 0.05\\,\\frac{1 + 40 s}{4 s + 1}  \\displaystyle \\frac{1}{30 s + 1}\n\\end{pmatrix}\n$$\n\nFor a general $2 \\times 2$ matrix $G(s)$, its inverse is\n$$\nG(s)^{-1} = \\frac{1}{\\det(G(s))}\n\\begin{pmatrix}\ng_{22}(s)  -g_{12}(s) \\\\\n-g_{21}(s)  g_{11}(s)\n\\end{pmatrix}\n$$\nThe inverse transpose is therefore\n$$\nG(s)^{-T} = \\left(G(s)^{-1}\\right)^T = \\frac{1}{\\det(G(s))}\n\\begin{pmatrix}\ng_{22}(s)  -g_{21}(s) \\\\\n-g_{12}(s)  g_{11}(s)\n\\end{pmatrix}\n$$\nThe RGA matrix $\\Lambda(s)$ is then calculated by elementwise multiplication:\n$$\n\\Lambda(s) = \\frac{1}{\\det(G(s))}\n\\begin{pmatrix}\ng_{11}(s)g_{22}(s)  -g_{12}(s)g_{21}(s) \\\\\n-g_{21}(s)g_{12}(s)  g_{22}(s)g_{11}(s)\n\\end{pmatrix}\n$$\nThe determinant of $G(s)$ is $\\det(G(s)) = g_{11}(s)g_{22}(s) - g_{12}(s)g_{21}(s)$.\nThe $(1,1)$ element of the RGA, $\\Lambda_{11}(s)$, is given by\n$$\n\\Lambda_{11}(s) = \\frac{g_{11}(s)g_{22}(s)}{\\det(G(s))} = \\frac{g_{11}(s)g_{22}(s)}{g_{11}(s)g_{22}(s) - g_{12}(s)g_{21}(s)} = \\frac{1}{1 - \\frac{g_{12}(s)g_{21}(s)}{g_{11}(s)g_{22}(s)}}\n$$\n\n**1. Steady-State RGA Evaluation**\n\nFirst, we evaluate the steady-state gain matrix $G(0)$ by setting $s=0$:\n$$\nG(0) =\n\\begin{pmatrix}\n\\displaystyle \\frac{1}{1}  \\displaystyle 0.05\\,\\frac{1}{1} \\\\\n\\displaystyle 0.05\\,\\frac{1}{1}  \\displaystyle \\frac{1}{1}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1  0.05 \\\\\n0.05  1\n\\end{pmatrix}\n$$\nThe determinant is $\\det(G(0)) = (1)(1) - (0.05)(0.05) = 1 - 0.0025 = 0.9975$.\nThe inverse transpose is\n$$\nG(0)^{-T} = \\frac{1}{0.9975}\n\\begin{pmatrix}\n1  -0.05 \\\\\n-0.05  1\n\\end{pmatrix}\n$$\nThe steady-state RGA, $\\Lambda(0)$, is\n$$\n\\Lambda(0) = G(0) \\circ G(0)^{-T} =\n\\begin{pmatrix}\n1  0.05 \\\\\n0.05  1\n\\end{pmatrix}\n\\circ\n\\frac{1}{0.9975}\n\\begin{pmatrix}\n1  -0.05 \\\\\n-0.05  1\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\frac{1}{0.9975}  \\frac{-0.0025}{0.9975} \\\\\n\\frac{-0.0025}{0.9975}  \\frac{1}{0.9975}\n\\end{pmatrix}\n$$\nNumerically,\n$$\n\\Lambda(0) \\approx\n\\begin{pmatrix}\n1.0025  -0.0025 \\\\\n-0.0025  1.0025\n\\end{pmatrix}\n$$\nAn RGA matrix with diagonal elements close to $1$ and off-diagonal elements close to $0$ indicates that interactions are weak and diagonal pairing is appropriate. Based on $\\Lambda(0)$, the steady-state interactions are minimal, suggesting that a decentralized control strategy pairing $u_1$ with $y_1$ and $u_2$ with $y_2$ would be effective for slow, steady-state command following.\n\n**2. Dynamic RGA Evaluation**\n\nNext, we evaluate the dynamic interaction at the frequency $\\omega^\\star = 0.2 \\, \\text{rad/s}$. We focus on the element $\\Lambda_{11}(j\\omega^\\star)$. Let's define the interaction measure $\\lambda(s) = \\frac{g_{12}(s)g_{21}(s)}{g_{11}(s)g_{22}(s)}$, such that $\\Lambda_{11}(s) = \\frac{1}{1-\\lambda(s)}$.\n\nFirst, we express $\\lambda(s)$ in terms of the given transfer functions:\n$$\n\\lambda(s) = \\frac{\\left(0.05\\,\\frac{1 + 50s}{5s + 1}\\right) \\left(0.05\\,\\frac{1 + 40s}{4s + 1}\\right)}{\\left(\\frac{1}{50s + 1}\\right) \\left(\\frac{1}{30s + 1}\\right)} = 0.0025 \\frac{(1+50s)(1+40s)(50s+1)(30s+1)}{(5s+1)(4s+1)}\n$$\nSince $1+50s = 50s+1$, this simplifies to:\n$$\n\\lambda(s) = 0.0025 \\frac{(1+50s)^2(1+40s)(1+30s)}{(1+5s)(1+4s)}\n$$\nWe evaluate this at $s = j\\omega^\\star = j(0.2)$:\nThe terms become:\n$1+50s = 1+j50(0.2) = 1+j10$\n$1+40s = 1+j40(0.2) = 1+j8$\n$1+30s = 1+j30(0.2) = 1+j6$\n$1+5s = 1+j5(0.2) = 1+j1$\n$1+4s = 1+j4(0.2) = 1+j0.8$\n\nSubstituting these into the expression for $\\lambda(j0.2)$:\n$$\n\\lambda(j0.2) = 0.0025 \\frac{(1+j10)^2(1+j8)(1+j6)}{(1+j1)(1+j0.8)}\n$$\nWe perform the complex arithmetic:\nNumerator terms:\n$(1+j10)^2 = 1^2 + 2(j10) + (j10)^2 = 1 + j20 - 100 = -99 + j20$\n$(1+j8)(1+j6) = 1 + j6 + j8 + j^2(48) = 1 + j14 - 48 = -47 + j14$\nNumerator product: $(-99+j20)(-47+j14) = (-99)(-47) + (-99)(j14) + (j20)(-47) + (j20)(j14) = 4653 - j1386 - j940 - 280 = 4373 - j2326$.\n\nDenominator product: $(1+j1)(1+j0.8) = 1 + j0.8 + j1 + j^2(0.8) = 1 + j1.8 - 0.8 = 0.2 + j1.8$.\n\nSo,\n$$\n\\lambda(j0.2) = 0.0025 \\frac{4373 - j2326}{0.2 + j1.8}\n$$\nTo divide, we multiply the numerator and denominator by the conjugate of the denominator, which is $0.2 - j1.8$:\n$$\n\\lambda(j0.2) = 0.0025 \\frac{(4373 - j2326)(0.2 - j1.8)}{(0.2 + j1.8)(0.2 - j1.8)} = 0.0025 \\frac{4373(0.2) - j4373(1.8) - j2326(0.2) + j^2(2326)(1.8)}{0.2^2 + 1.8^2}\n$$\n$$\n\\lambda(j0.2) = 0.0025 \\frac{874.6 - j7871.4 - j465.2 - 4186.8}{0.04 + 3.24} = 0.0025 \\frac{-3312.2 - j8336.6}{3.28}\n$$\n$$\n\\lambda(j0.2) = \\frac{-8.2805 - j20.8415}{3.28} \\approx -2.5245 - j6.3541\n$$\nNow we compute $\\Lambda_{11}(j\\omega^\\star)$:\n$$\n\\Lambda_{11}(j0.2) = \\frac{1}{1 - \\lambda(j0.2)} = \\frac{1}{1 - (-2.5245 - j6.3541)} = \\frac{1}{3.5245 + j6.3541}\n$$\n\n**3. Severity of Dynamic Interaction**\n\nThe severity of the dynamic interaction is quantified by $S = |\\Lambda_{11}(j\\omega^\\star)|$.\n$$\nS = \\left| \\frac{1}{3.5245 + j6.3541} \\right| = \\frac{1}{|3.5245 + j6.3541|}\n$$\nThe magnitude of the denominator is:\n$$\n|3.5245 + j6.3541| = \\sqrt{3.5245^2 + 6.3541^2} \\approx \\sqrt{12.4221 + 40.3745} = \\sqrt{52.7966} \\approx 7.2661\n$$\nTherefore,\n$$\nS = \\frac{1}{7.2661} \\approx 0.137627\n$$\nRounding to four significant figures, the value is $S=0.1376$.\nThis value, $|\\Lambda_{11}(j\\omega^\\star)| \\approx 0.1376$, is significantly different from the steady-state value $\\Lambda_{11}(0) \\approx 1.0025$. A value of $|\\Lambda_{11}(j\\omega)|$ far from $1$ indicates strong dynamic coupling at frequency $\\omega$. In this case, the analysis reveals that despite favorable steady-state characteristics, the system exhibits severe dynamic interactions near the target bandwidth, which would compromise the performance and stability of a simple diagonal decentralized controller.",
            "answer": "$$\n\\boxed{0.1376}\n$$"
        },
        {
            "introduction": "Modern biomedical devices increasingly rely on computational models to interpret sensor data and estimate internal physiological states. This final practice explores the robustness of such model-based approaches by introducing the concept of the condition number of the system's frequency response matrix, $G(j\\omega)$. By writing a program to evaluate how system properties affect this metric, you will gain a hands-on understanding of how to quantify the risk of noise amplification when inverting a MIMO model, a critical safety consideration for real-world clinical applications .",
            "id": "3928578",
            "problem": "A biomedical engineer is tasked with assessing whether inversion-based input reconstruction is safe for linear multi-input multi-output systems encountered in clinical devices that sense and stimulate physiological signals. The engineer considers frequency-domain inversion of a linear time-invariant (LTI) model and seeks to quantify the worst-case amplification of measurement noise during inversion at each angular frequency. The amplification is characterized by the condition number of the frequency response matrix. Starting from fundamental definitions, the frequency response of an LTI model given in state-space form with matrices $A \\in \\mathbb{R}^{n \\times n}$, $B \\in \\mathbb{R}^{n \\times m}$, $C \\in \\mathbb{R}^{p \\times n}$, and $D \\in \\mathbb{R}^{p \\times m}$ is the complex matrix-valued function $G(j\\omega)$ obtained by evaluating the input-output map on the imaginary axis, with $j$ denoting the imaginary unit and $\\omega$ the angular frequency in radians per second. The multiplicative amplification of relative errors under inversion at a fixed $\\omega$ is quantified by the condition number of the matrix $G(j\\omega)$ induced by the Euclidean norm. Safe inversion for clinical input reconstruction is said to hold over a frequency band if the maximum condition number across that frequency band does not exceed a specified bound.\n\nYour task is to write a program that, for each test system and frequency grid specified below, computes the maximum condition number across the grid and produces a safety decision based on a fixed threshold. The angle unit is radians per second. All floating-point results must be rounded to three decimal places.\n\nDefinitions and requirements to be used:\n- The frequency response is defined by the fundamental input-output relation of a linear time-invariant state-space system, evaluated on the imaginary axis $s = j\\omega$.\n- The condition number at frequency $\\omega$ is defined with respect to the Euclidean norm, and it assesses relative error amplification under inversion at that frequency. This quantity is real and nonnegative for any complex matrix.\n- For a scalar nonzero complex number, the condition number induced by the Euclidean norm equals $1$.\n\nSafety decision rule:\n- Define the safety threshold as $K_{\\text{safe}} = 50$ (dimensionless).\n- For each test case, compute $K_{\\max} = \\max_{\\omega \\in \\Omega} \\kappa\\big(G(j\\omega)\\big)$ on the provided discrete frequency set $\\Omega$.\n- Declare inversion \"safe\" if and only if $K_{\\max} \\le K_{\\text{safe}}$.\n\nTest suite:\n- Use the same frequency set for all test cases, defined by $\\Omega = \\{\\omega_k\\}_{k=1}^{200}$ where $\\omega_k$ are $200$ logarithmically spaced points from $10^{-2}$ to $10^{2}$ in radians per second.\n- Test case 1 (single-input single-output): $A_1 = [-2]$, $B_1 = [1]$, $C_1 = [1]$, $D_1 = [0]$. This is a baseline with a single pole at $-2$.\n- Test case 2 (two-input two-output, diagonal and well-conditioned): \n  $$\n  A_2 = \\begin{bmatrix} -1  0 \\\\ 0  -0.1 \\end{bmatrix},\\quad\n  B_2 = \\begin{bmatrix} 1  0 \\\\ 0  1 \\end{bmatrix},\\quad\n  C_2 = \\begin{bmatrix} 1  0 \\\\ 0  1 \\end{bmatrix},\\quad\n  D_2 = \\begin{bmatrix} 0  0 \\\\ 0  0 \\end{bmatrix}.\n  $$\n- Test case 3 (two-input two-output, nearly collinear outputs leading to near singularity): \n  $$\n  A_3 = \\begin{bmatrix} -1  0 \\\\ 0  -1 \\end{bmatrix},\\quad\n  B_3 = \\begin{bmatrix} 1  0 \\\\ 0  1 \\end{bmatrix},\\quad\n  C_3 = \\begin{bmatrix} 1  1 \\\\ 1  1+\\varepsilon \\end{bmatrix},\\quad\n  D_3 = \\begin{bmatrix} 0  0 \\\\ 0  0 \\end{bmatrix},\n  $$\n  with $\\varepsilon = 10^{-3}$.\n\nComputational tasks:\n- For each test case and each $\\omega \\in \\Omega$, evaluate the complex matrix $G(j\\omega)$ using the state-space data.\n- For each $G(j\\omega)$, compute the condition number induced by the Euclidean norm. Handle rank-deficient matrices by treating the condition number as $+\\infty$.\n- For each test case, compute $K_{\\max}$ and determine the safety boolean according to the rule above.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets.\n- Each test case’s result must be a list of length two: the first element is $K_{\\max}$ rounded to three decimal places, and the second element is a boolean indicating safety (True if safe, False otherwise).\n- The final line must therefore have the form $[[K_{\\max,1},\\text{Safe}_1],[K_{\\max,2},\\text{Safe}_2],[K_{\\max,3},\\text{Safe}_3]]$ with no additional text.\n\nUnit and rounding requirements:\n- Angular frequency must be treated in radians per second.\n- Round each $K_{\\max}$ to three decimal places before printing.",
            "solution": "The primary objective is to evaluate the safety of inverting linear time-invariant (LTI) systems by quantifying the worst-case amplification of noise. This amplification is measured by the condition number of the system's frequency response matrix, $G(j\\omega)$. A maximum allowable condition number, $K_{\\text{safe}}$, serves as the safety threshold.\n\nFirst, we establish the theoretical foundation. An LTI system described by the state-space representation\n$$\n\\begin{align*}\n\\dot{x}(t) = Ax(t) + Bu(t) \\\\\ny(t) = Cx(t) + Du(t)\n\\end{align*}\n$$\nwhere $x \\in \\mathbb{R}^n$ is the state vector, $u \\in \\mathbb{R}^m$ is the input vector, and $y \\in \\mathbb{R}^p$ is the output vector, has a transfer function matrix $G(s)$ that maps the Laplace transform of the input, $U(s)$, to the Laplace transform of the output, $Y(s)$. This relationship is given by $Y(s) = G(s)U(s)$. The transfer function matrix is derived from the state-space matrices ($A, B, C, D$) as:\n$$\nG(s) = C(sI - A)^{-1}B + D\n$$\nThe frequency response of the system is obtained by evaluating this transfer function on the imaginary axis, by setting the complex variable $s$ to $j\\omega$, where $j$ is the imaginary unit and $\\omega$ is the angular frequency in radians per second. The frequency response is thus the complex matrix-valued function:\n$$\nG(j\\omega) = C(j\\omega I - A)^{-1}B + D\n$$\nThis matrix $G(j\\omega)$ relates a sinusoidal input at frequency $\\omega$ to the corresponding sinusoidal output in the steady state.\n\nThe problem of input reconstruction involves estimating the input $u$ that produced a measured output $y$. In the frequency domain, this corresponds to solving the linear system $Y(j\\omega) = G(j\\omega)U(j\\omega)$ for $U(j\\omega)$, which requires computing $U(j\\omega) = G(j\\omega)^{-1}Y(j\\omega)$. The numerical stability of this inversion is crucial, especially in the presence of measurement noise in $Y(j\\omega)$.\n\nThe condition number of a matrix quantifies the sensitivity of the solution of a linear system to errors in the data. For a matrix $M$, the condition number with respect to the Euclidean norm (also known as the spectral norm or $2$-norm) is defined as the ratio of its largest singular value, $\\sigma_{\\max}(M)$, to its smallest singular value, $\\sigma_{\\min}(M)$:\n$$\n\\kappa(M) = \\frac{\\sigma_{\\max}(M)}{\\sigma_{\\min}(M)}\n$$\nIf $M$ is singular, then $\\sigma_{\\min}(M) = 0$, and the condition number is considered to be infinite. A large condition number indicates that the matrix is close to being singular and that its inversion is highly sensitive to small perturbations, leading to large amplification of relative errors.\n\nAs specified, for a non-zero scalar complex number $z \\in \\mathbb{C}$, there is only one singular value, $|z|$. Thus, $\\sigma_{\\max} = \\sigma_{\\min} = |z|$, and its condition number is $\\kappa(z) = |z|/|z| = 1$.\n\nThe computational procedure for each test case is as follows:\n1. Define the frequency grid $\\Omega$ as a set of $200$ points logarithmically spaced from $10^{-2}$ to $10^2$ rad/s.\n2. For each frequency $\\omega \\in \\Omega$, compute the frequency response matrix $G(j\\omega)$. Numerically, it is more stable to first solve the linear system $(j\\omega I - A)X = B$ for the matrix $X$, and then compute $G(j\\omega) = CX + D$.\n3. Compute the condition number $\\kappa(G(j\\omega))$.\n4. The maximum condition number for the test case is $K_{\\max} = \\max_{\\omega \\in \\Omega} \\kappa(G(j\\omega))$.\n5. A safety decision is made based on the rule: the system is \"safe\" if and only if $K_{\\max} \\le K_{\\text{safe}}$, where $K_{\\text{safe}} = 50$.\n\nWe now analyze each test case:\n\n**Test Case 1 (SISO):**\nThe system is given by $A_1 = [-2]$, $B_1 = [1]$, $C_1 = [1]$, and $D_1 = [0]$. This is a single-input, single-output system.\nThe transfer function is a scalar:\n$$\nG_1(s) = C_1(sI - A_1)^{-1}B_1 + D_1 = [1](s - [-2])^{-1}[1] + [0] = \\frac{1}{s+2}\n$$\nThe frequency response is $G_1(j\\omega) = \\frac{1}{j\\omega+2}$. For any real frequency $\\omega$, $j\\omega+2 \\neq 0$, so $G_1(j\\omega)$ is a non-zero complex scalar. According to the definition provided, the condition number of any non-zero scalar is $1$. Therefore, for this system, $\\kappa(G_1(j\\omega)) = 1$ for all $\\omega$.\nThis gives $K_{\\max,1} = \\max_{\\omega \\in \\Omega} (1) = 1$.\nSince $1 \\le 50$, this system is declared **safe**.\n\n**Test Case 2 (MIMO, Well-conditioned):**\nThe system matrices are diagonal: $A_2 = \\text{diag}(-1, -0.1)$, $B_2=I$, $C_2=I$, $D_2=0$.\nThe system is decoupled, and its frequency response matrix is also diagonal:\n$$\nG_2(j\\omega) = (j\\omega I - A_2)^{-1} = \\begin{bmatrix} (j\\omega+1)^{-1}  0 \\\\ 0  (j\\omega+0.1)^{-1} \\end{bmatrix}\n$$\nThe singular values of a diagonal matrix are the absolute values of its diagonal entries.\n$$\n\\sigma_1 = \\left|\\frac{1}{j\\omega+1}\\right| = \\frac{1}{\\sqrt{\\omega^2+1}}, \\quad \\sigma_2 = \\left|\\frac{1}{j\\omega+0.1}\\right| = \\frac{1}{\\sqrt{\\omega^2+0.01}}\n$$\nFor any $\\omega \\ge 0$, we have $\\omega^2+1  \\omega^2+0.01$, which implies $\\sigma_1  \\sigma_2$. Thus, $\\sigma_{\\max} = \\sigma_2$ and $\\sigma_{\\min} = \\sigma_1$.\nThe condition number is:\n$$\n\\kappa(G_2(j\\omega)) = \\frac{\\sigma_{\\max}}{\\sigma_{\\min}} = \\frac{\\sigma_2}{\\sigma_1} = \\frac{\\sqrt{\\omega^2+1}}{\\sqrt{\\omega^2+0.01}}\n$$\nTo find $K_{\\max,2}$, we must find the maximum of this function over $\\omega \\in [10^{-2}, 10^2]$. The function is monotonically decreasing for $\\omega  0$. Therefore, the maximum occurs at the lowest frequency in the grid, $\\omega = 10^{-2}$.\n$$\nK_{\\max,2} = \\kappa(G_2(j \\cdot 10^{-2})) = \\sqrt{\\frac{(10^{-2})^2+1}{(10^{-2})^2+0.01}} = \\sqrt{\\frac{1.0001}{0.0101}} \\approx 9.95086\n$$\nRounding to three decimal places gives $K_{\\max,2} = 9.951$.\nSince $9.951 \\le 50$, this system is declared **safe**.\n\n**Test Case 3 (MIMO, Ill-conditioned):**\nThe system is given by $A_3 = -I$, $B_3 = I$, $C_3 = \\begin{bmatrix} 1  1 \\\\ 1  1+\\varepsilon \\end{bmatrix}$ with $\\varepsilon = 10^{-3}$, and $D_3 = 0$.\nThe frequency response is:\n$$\nG_3(j\\omega) = C_3(j\\omega I - (-I))^{-1}B_3 + D_3 = C_3((j\\omega+1)I)^{-1}I = \\frac{1}{j\\omega+1}C_3\n$$\nThe condition number has the property that for any non-zero scalar $\\alpha$, $\\kappa(\\alpha M) = \\kappa(M)$. The term $\\frac{1}{j\\omega+1}$ is a non-zero scalar for all $\\omega$. Therefore, the condition number is constant across all frequencies:\n$$\n\\kappa(G_3(j\\omega)) = \\kappa(C_3) = \\kappa\\left(\\begin{bmatrix} 1  1 \\\\ 1  1+10^{-3} \\end{bmatrix}\\right)\n$$\nThe matrix $C_3$ is nearly singular because its columns are nearly collinear, which suggests a high condition number. We can compute this value numerically. The singular values of $C_3$ are approximately $\\sigma_{\\max} \\approx 2.0005$ and $\\sigma_{\\min} \\approx 0.0005$.\nThe condition number is $\\kappa(C_3) = \\sigma_{\\max}/\\sigma_{\\min} \\approx 4002.000$.\nThus, $K_{\\max,3} = \\kappa(C_3) \\approx 4002.000$.\nRounding to three decimal places yields $K_{\\max,3} = 4002.000$.\nSince $4002.000  50$, this system is declared **unsafe**.\n\nThe results are summarized as:\n- Case 1: $K_{\\max,1} = 1.000$, Safety = True.\n- Case 2: $K_{\\max,2} = 9.951$, Safety = True.\n- Case 3: $K_{\\max,3} = 4002.000$, Safety = False.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum condition number for three LTI systems over a\n    frequency grid and determines if inversion is 'safe' based on a threshold.\n    \"\"\"\n    K_SAFE = 50.0\n    omega_grid = np.logspace(-2, 2, num=200)\n\n    # Test Case 1: SISO system\n    A1 = np.array([[-2.0]])\n    B1 = np.array([[1.0]])\n    C1 = np.array([[1.0]])\n    D1 = np.array([[0.0]])\n\n    # Test Case 2: MIMO, well-conditioned\n    A2 = np.array([[-1.0, 0.0], [0.0, -0.1]])\n    B2 = np.array([[1.0, 0.0], [0.0, 1.0]])\n    C2 = np.array([[1.0, 0.0], [0.0, 1.0]])\n    D2 = np.array([[0.0, 0.0]])\n\n    # Test Case 3: MIMO, ill-conditioned\n    epsilon = 1e-3\n    A3 = np.array([[-1.0, 0.0], [0.0, -1.0]])\n    B3 = np.array([[1.0, 0.0], [0.0, 1.0]])\n    C3 = np.array([[1.0, 1.0], [1.0, 1.0 + epsilon]])\n    D3 = np.array([[0.0, 0.0]])\n\n    test_cases = [\n        (A1, B1, C1, D1),\n        (A2, B2, C2, D2),\n        (A3, B3, C3, D3)\n    ]\n\n    final_results = []\n\n    for A, B, C, D in test_cases:\n        k_max = 0.0\n        n = A.shape[0]\n        m = B.shape[1]\n        p = C.shape[0]\n\n        condition_numbers = []\n\n        for omega in omega_grid:\n            s = 1j * omega\n            \n            # G(jω) = C * (jωI - A)^-1 * B + D\n            # A numerically stable way to compute this is to solve\n            # (jωI - A)X = B for X, then G = CX + D.\n            try:\n                # The matrix (sI - A) is guaranteed to be invertible for stable A\n                # and real omega.\n                X = np.linalg.solve(s * np.eye(n) - A, B)\n                G_jw = C @ X + D\n            except np.linalg.LinAlgError:\n                # This case should not be reached with the given stable systems.\n                # If it were, the condition number would be infinite.\n                condition_numbers.append(np.inf)\n                continue\n\n            # For a scalar, the condition number is 1 (for non-zero case).\n            if p == 1 and m == 1:\n                # G_jw is a 1x1 matrix.\n                if np.abs(G_jw[0, 0]) > 1e-12: # Check for non-zero to be safe\n                    cond_num = 1.0\n                else: \n                    # If G_jw is zero, it is singular.\n                    cond_num = np.inf\n            else:\n                cond_num = np.linalg.cond(G_jw)\n            \n            condition_numbers.append(cond_num)\n        \n        k_max = np.max(condition_numbers)\n        \n        is_safe = k_max = K_SAFE\n        \n        # Round the final maximum condition number to three decimal places.\n        # np.round doesn't work on inf, but the problem cases give finite numbers.\n        rounded_k_max = round(k_max, 3)\n        \n        final_results.append([rounded_k_max, is_safe])\n\n    # Format the output string exactly as required.\n    output_parts = []\n    for k_val, safe_bool in final_results:\n        # Format the float to always have three decimal places\n        k_str = f\"{k_val:.3f}\"\n        # str(bool) correctly gives 'True' or 'False'\n        s_str = str(safe_bool)\n        output_parts.append(f\"[{k_str},{s_str}]\")\n        \n    print(f\"[{','.join(output_parts)}]\")\n\nsolve()\n```"
        }
    ]
}