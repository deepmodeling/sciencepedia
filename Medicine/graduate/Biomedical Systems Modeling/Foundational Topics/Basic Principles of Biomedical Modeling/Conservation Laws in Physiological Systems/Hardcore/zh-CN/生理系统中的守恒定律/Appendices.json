{
    "hands_on_practices": [
        {
            "introduction": "本实践将质量守恒定律应用于药理学中的一个基本问题：设计有效的药物给药方案。通过分析一个单室模型，您将发现时间平均的药物输注速率与最终达到的稳态浓度之间存在一个强大的关系。这个练习展示了守恒定律如何为临床医学中的实际设计挑战提供简洁的解决方案。",
            "id": "3878824",
            "problem": "一个体积为 $V$、以清除率 $CL$ 为特征进行线性消除的单一充分混合中央生理房室，由一个每个周期 $T$ 重复一次的周期性输注输入 $R_{in}(t)$ 供给。设中央房室浓度为 $C(t)$，其药量为 $A(t)=V\\,C(t)$。主导的质量守恒原理意味着中央房室中流入和流出之间的平衡，从而得到一个形式为 $dA/dt = R_{in}(t) - \\text{(消除速率)}$ 的常微分方程 (ODE)，单位为单位时间内的质量。假设消除通过 $CL$ 与 $C(t)$ 成正比，因此消除速率等于 $CL\\,C(t)$。\n\n通过选择决定 $R_{in}(t)$ 振幅或基线的未知输注参数来设计给药方案，使得在一个周期内 $C(t)$ 的周期性稳态时间平均值等于一个指定的目标 $\\overline{C}_{\\text{target}}$。三角函数中出现的角度必须以弧度解释。所有物理量使用以下单位：$CL$ 单位为升/小时 (L/h)，$V$ 单位为升 (L)，$T$、$\\tau$、$\\tau_{\\text{on}}$、$\\delta_{\\text{up}}$ 和 $\\delta_{\\text{down}}$ 单位为小时 (h)，$R_{in}(t)$ 和任何振幅参数单位为毫克/小时 (mg/h)，$C(t)$ 和 $\\overline{C}_{\\text{target}}$ 单位为毫克/升 (mg/L)。您的程序必须为每个指定的波形计算出在周期性稳态下达到目标时间平均浓度的唯一输注参数值，并将这些参数值以毫克/小时 (mg/h) 为单位，输出为单个用方括号括起来的逗号分隔列表，不含任何附加文本。\n\n您必须仅使用上述的质量守恒和线性消除假设，并且不得依赖于超出在周期性稳态状态下对一个周期的 ODE 进行积分所得出的任何快捷公式。设计必须对任何现代编程语言普遍有效，并纯粹以数学和逻辑术语表达。\n\n测试套件。对于下方的每个案例，确定并报告相应的输注参数，单位为 mg/h，形式为浮点数。角度单位为弧度。\n\n- 案例 1（方波输注）：周期 $T = 12$ 小时，每个周期内以恒定速率 $r_0$（未知）输注的持续时间为 $\\tau=3$ 小时，其余时间为 $0$；清除率 $CL=5$ L/h；目标平均浓度 $\\overline{C}_{\\text{target}}=2$ mg/L。确定 $r_0$。\n\n- 案例 2（三角波输注）：周期 $T=8$ 小时；在每个周期内，输注在 $\\tau=2$ 小时的时间内从 $0$ 线性增加到峰值 $r_0$（未知），其余时间为 $0$；清除率 $CL=4.5$ L/h；目标平均浓度 $\\overline{C}_{\\text{target}}=3$ mg/L。确定 $r_0$。\n\n- 案例 3（带基线的正弦输注）：周期 $T=24$ 小时；输注为 $R_{in}(t) = b_0 + a \\sin\\!\\big(2\\pi t/T\\big)$，其中振幅 $a=10$ mg/h 为已知，基线 $b_0$ 未知；清除率 $CL=4$ L/h；目标平均浓度 $\\overline{C}_{\\text{target}}=3$ mg/L。确定 $b_0$。\n\n- 案例 4（梯形输注）：周期 $T=8$ 小时；输注在 $\\delta_{\\text{up}}=1$ 小时内从 $0$ 线性增加到平台 $r_0$（未知），在 $r_0$ 保持 $\\tau_{\\text{on}}=4$ 小时，然后在 $\\delta_{\\text{down}}=1$ 小时内从 $r_0$ 线性减少到 $0$，其余时间为 $0$；清除率 $CL=6$ L/h；目标平均浓度 $\\overline{C}_{\\text{target}}=1.5$ mg/L。确定 $r_0$。\n\n- 案例 5（恒定输注）：周期 $T=24$ 小时；输注为 $R_{in}(t) = r_0$（未知常数）；清除率 $CL=7$ L/h；目标平均浓度 $\\overline{C}_{\\text{target}}=1.25$ mg/L。确定 $r_0$。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，单位为 mg/h，按 $[r_0^{(1)},r_0^{(2)},b_0^{(3)},r_0^{(4)},r_0^{(5)}]$ 的顺序排列，其中上标表示如上所述的案例编号。例如，如果 $\\big[40.0,80.0,12.0,14.4,8.75\\big]$ 是计算出的正确输注参数（单位为 mg/h），则形如此类的输出是有效的。",
            "solution": "该问题要求为各种周期性给药方案找到一个输注参数，以在稳态下实现目标时间平均药物浓度 $\\overline{C}_{\\text{target}}$。解决所有案例的统一原则源于对一个周期内的质量平衡方程进行积分。\n\n**1. 推导通用稳态关系**\n单房室中药物的质量平衡由以下常微分方程（ODE）给出：\n$$\n\\frac{dA(t)}{dt} = R_{in}(t) - R_{out}(t)\n$$\n其中 $A(t)$ 是药物量，$R_{in}(t)$ 是输注速率，$R_{out}(t)$ 是消除速率。\n问题指出消除是线性的，以清除率 $CL$ 为特征，因此 $R_{out}(t) = CL \\cdot C(t)$。药量 $A(t)$ 通过 $A(t) = V \\cdot C(t)$ 与浓度 $C(t)$ 相关，其中 $V$ 是恒定的分布容积。\n将这些代入质量平衡方程：\n$$\n\\frac{d(V \\cdot C(t))}{dt} = R_{in}(t) - CL \\cdot C(t)\n$$\n由于 $V$ 是恒定的：\n$$\nV \\frac{dC(t)}{dt} = R_{in}(t) - CL \\cdot C(t)\n$$\n在周期性稳态下，所有状态变量，包括浓度 $C(t)$，都与输入具有相同的周期 $T$，即 $C(t+T) = C(t)$。\n我们将此ODE在一个完整周期内从任意时间 $t_0$ 到 $t_0+T$进行积分：\n$$\n\\int_{t_0}^{t_0+T} V \\frac{dC(t)}{dt} dt = \\int_{t_0}^{t_0+T} \\left( R_{in}(t) - CL \\cdot C(t) \\right) dt\n$$\n左侧变为：\n$$\nV \\int_{t_0}^{t_0+T} dC = V [C(t_0+T) - C(t_0)]\n$$\n由于周期性稳态条件，$C(t_0+T) = C(t_0)$，因此左侧为零。\n$$\n0 = \\int_{t_0}^{t_0+T} R_{in}(t) dt - \\int_{t_0}^{t_0+T} CL \\cdot C(t) dt\n$$\n由于 $CL$ 是一个常数，我们可以重新整理此方程：\n$$\nCL \\int_{t_0}^{t_0+T} C(t) dt = \\int_{t_0}^{t_0+T} R_{in}(t) dt\n$$\n函数 $f(t)$ 在一个周期 $T$ 内的时间平均值定义为 $\\overline{f} = \\frac{1}{T} \\int_{t_0}^{t_0+T} f(t) dt$。使用此定义，我们可以用时间平均浓度 $\\overline{C}$ 和时间平均输注速率 $\\overline{R_{in}}$ 重写该方程：\n$$\nCL \\cdot (T \\cdot \\overline{C}) = T \\cdot \\overline{R_{in}}\n$$\n这简化为一个非常简洁而有力的关系：\n$$\n\\overline{R_{in}} = CL \\cdot \\overline{C}\n$$\n这意味着在稳态下，药物的平均给药速率必须等于平均消除速率。为了达到目标平均浓度 $\\overline{C}_{\\text{target}}$，我们必须设计输注方案，使得：\n$$\n\\overline{R_{in}} = CL \\cdot \\overline{C}_{\\text{target}}\n$$\n这个单一的方程使我们能够解决每个案例中的未知参数，而无需求解完整的ODE。分布容积 $V$ 是不必要的，因为它从最终的平均浓度关系中消除了。\n\n**2. 应用于具体案例**\n对于每个案例，我们首先根据给定的 $CL$ 和 $\\overline{C}_{\\text{target}}$ 计算所需的平均输注速率 $\\overline{R_{in}}$。然后，我们用未知参数表示特定波形的平均输注速率，并求解该参数。\n\n**案例 1：方波输注**\n- 所需 $\\overline{R_{in}} = 5 \\text{ L/h} \\times 2 \\text{ mg/L} = 10 \\text{ mg/h}$。\n- 平均速率是总剂量 $(r_0 \\cdot \\tau)$ 除以周期 $T$：$\\overline{R_{in}} = \\frac{r_0 \\cdot 3}{12} = \\frac{r_0}{4}$。\n- 令两者相等：$\\frac{r_0}{4} = 10 \\implies r_0 = 40$ mg/h。\n\n**案例 2：三角波输注**\n- 所需 $\\overline{R_{in}} = 4.5 \\text{ L/h} \\times 3 \\text{ mg/L} = 13.5 \\text{ mg/h}$。\n- 每个周期的总剂量是三角形的面积：$\\frac{1}{2} \\cdot \\text{底} \\cdot \\text{高} = \\frac{1}{2} \\tau r_0 = \\frac{1}{2} (2) r_0 = r_0$。\n- 平均速率为 $\\overline{R_{in}} = \\frac{\\text{总剂量}}{T} = \\frac{r_0}{8}$。\n- 令两者相等：$\\frac{r_0}{8} = 13.5 \\implies r_0 = 108$ mg/h。\n\n**案例 3：带基线的正弦输注**\n- 所需 $\\overline{R_{in}} = 4 \\text{ L/h} \\times 3 \\text{ mg/L} = 12 \\text{ mg/h}$。\n- 在一个完整周期内，$R_{in}(t) = b_0 + a \\sin(2\\pi t/T)$ 的平均值就是常数项 $b_0$，因为正弦项的平均值为零。因此，$\\overline{R_{in}} = b_0$。\n- 令两者相等：$b_0 = 12$ mg/h。\n\n**案例 4：梯形输注**\n- 所需 $\\overline{R_{in}} = 6 \\text{ L/h} \\times 1.5 \\text{ mg/L} = 9 \\text{ mg/h}$。\n- 总剂量是梯形的面积。该面积可以计算为中心矩形和两个侧边三角形的面积之和：面积 = $(\\frac{1}{2} \\delta_{\\text{up}} r_0) + (\\tau_{\\text{on}} r_0) + (\\frac{1}{2} \\delta_{\\text{down}} r_0) = r_0 (\\frac{1}{2} \\cdot 1 + 4 + \\frac{1}{2} \\cdot 1) = 5 r_0$。\n- 平均速率为 $\\overline{R_{in}} = \\frac{5 r_0}{8}$。\n- 令两者相等：$\\frac{5 r_0}{8} = 9 \\implies 5 r_0 = 72 \\implies r_0 = 14.4$ mg/h。\n\n**案例 5：恒定输注**\n- 所需 $\\overline{R_{in}} = 7 \\text{ L/h} \\times 1.25 \\text{ mg/L} = 8.75 \\text{ mg/h}$。\n- 对于恒定输注 $R_{in}(t) = r_0$，平均速率就是 $r_0$。因此，$\\overline{R_{in}} = r_0$。\n- 令两者相等：$r_0 = 8.75$ mg/h。\n\n这些计算得出了每个案例所需的输注参数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the unknown infusion parameters for five different dosing regimens\n    to achieve a target time-average drug concentration at periodic steady-state.\n\n    The core principle used is that at periodic steady-state in a linear\n    pharmacokinetic system, the average rate of infusion equals the average\n    rate of elimination: R_in_avg = CL * C_target_avg.\n    \"\"\"\n    \n    results = []\n\n    # Case 1 (square-wave infusion):\n    # R_in_avg = (r0 * tau) / T\n    # r0 = (CL * C_target * T) / tau\n    T1 = 12.0\n    tau1 = 3.0\n    CL1 = 5.0\n    C_target1 = 2.0\n    r0_1 = (CL1 * C_target1 * T1) / tau1\n    results.append(r0_1)\n\n    # Case 2 (triangular infusion):\n    # Total infused amount per period (Area) = 0.5 * tau * r0\n    # R_in_avg = Area / T = (0.5 * tau * r0) / T\n    # r0 = (CL * C_target * T) / (0.5 * tau)\n    T2 = 8.0\n    tau2 = 2.0\n    CL2 = 4.5\n    C_target2 = 3.0\n    r0_2 = (CL2 * C_target2 * T2) / (0.5 * tau2)\n    results.append(r0_2)\n\n    # Case 3 (sinusoidal infusion with baseline):\n    # R_in_avg = b0, since the average of a sine wave over a full period is 0.\n    # b0 = CL * C_target\n    CL3 = 4.0\n    C_target3 = 3.0\n    b0_3 = CL3 * C_target3\n    results.append(b0_3)\n\n    # Case 4 (trapezoidal infusion):\n    # Total infused amount per period (Area) = Area_triangle1 + Area_rect + Area_triangle2\n    # Area = (0.5 * delta_up * r0) + (tau_on * r0) + (0.5 * delta_down * r0)\n    # Area = r0 * (0.5 * delta_up + tau_on + 0.5 * delta_down)\n    # The problem can also be viewed as a trapezoid with height r0 and parallel\n    # sides of length tau_on and (delta_up + tau_on + delta_down).\n    # Area = 0.5 * (tau_on + (delta_up + tau_on + delta_down)) * r0\n    # R_in_avg = Area / T\n    # r0 = (CL * C_target * T) / Area_factor where Area = Area_factor * r0\n    T4 = 8.0\n    delta_up4 = 1.0\n    tau_on4 = 4.0\n    delta_down4 = 1.0\n    CL4 = 6.0\n    C_target4 = 1.5\n    # Area_factor = 0.5 * delta_up4 + tau_on4 + 0.5 * delta_down4\n    Area_factor4 = 0.5 * (tau_on4 + (delta_up4 + tau_on4 + delta_down4))\n    r0_4 = (CL4 * C_target4 * T4) / Area_factor4\n    results.append(r0_4)\n\n    # Case 5 (constant infusion):\n    # R_in_avg = r0\n    # r0 = CL * C_target\n    CL5 = 7.0\n    C_target5 = 1.25\n    r0_5 = CL5 * C_target5\n    results.append(r0_5)\n\n    # The final print statement must produce only the single-line format\n    # \"[result1,result2,result3,result4,result5]\" with no other text.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在集总参数模型的基础上，本练习将探讨守恒定律如何控制生理系统中空间分布的输运过程，例如肾小管。您将推导溶质浓度沿小管的控制微分方程，并为一个沿其长度具有分段特定属性的系统求解该方程。这项实践是理解空间异质性的流动和渗透性如何塑造生理功能的关键。",
            "id": "3878827",
            "problem": "将单个肾单位的集合管建模为一个沿轴向坐标 $x$ 排列的一维管道，$x=0$ 处为入口，$x=L$ 处为出口。管腔内尿素浓度用 $C(x)$ 表示，单位为 $\\mathrm{mol}\\,\\mathrm{m}^{-3}$。该管道被划分为 $S$ 个连续的管段，由 $s \\in \\{1,\\dots,S\\}$ 索引，各段长度为 $\\{L_s\\}$（单位为 $\\mathrm{m}$），且满足 $\\sum_{s=1}^{S} L_s = L$。在管段 $s$ 内，体积流率 $Q_s$（单位为 $\\mathrm{m}^3\\,\\mathrm{s}^{-1}$）、膜对尿素的渗透性 $P_s$（单位为 $\\mathrm{m}\\,\\mathrm{s}^{-1}$）、单位轴向长度的表面积 $S'_s$（单位为 $\\mathrm{m}$）以及周围间质尿素浓度 $C_{\\mathrm{is},s}$（单位为 $\\mathrm{mol}\\,\\mathrm{m}^{-3}$）均为恒定值。假设系统处于稳态且横截面均匀，因此任何微分控制体积内尿素质量的轴向累积为零。与周围环境的唯一交换是与跨膜浓度差成正比的穿膜通量。\n\n仅从一维控制体积中溶质的质量守恒原理以及跨膜通量与浓度差成正比的定义出发，在所述假设下推导每个管段中 $C(x)$ 的控制方程。然后，利用 $C(x)$ 在管段界面处的逻辑连续性以及指定的入口边界浓度 $C(0)=C_{\\mathrm{in}}$，确定整个管道的 $C(x)$。\n\n为便于计算，您必须仅在管段边界处，即轴向位置 $x_0 = 0$、$x_1 = L_1$、$x_2 = L_1+L_2$ 等等，直到 $x_S = \\sum_{s=1}^{S} L_s$ 处，对解进行求值。所有中间计算必须使用国际单位制（SI）进行，最终报告的浓度必须以 $\\mathrm{mol}\\,\\mathrm{m}^{-3}$ 为单位表示，并四舍五入到小数点后 $6$ 位。\n\n实现一个程序，为以下每个测试用例计算并报告这些边界位置处的管腔尿素浓度列表。在所有情况下，设置 $S=3$，并为每个管段使用相同的单位长度表面积，$S'_s = 6.0 \\times 10^{-5}\\ \\mathrm{m}$（对所有 $s$）。\n\n测试用例 1（代表性髓质梯度）：\n- $C_{\\mathrm{in}} = 100.0\\ \\mathrm{mol}\\,\\mathrm{m}^{-3}$。\n- 管段长度: $L_1 = 0.005\\ \\mathrm{m}$, $L_2 = 0.003\\ \\mathrm{m}$, $L_3 = 0.005\\ \\mathrm{m}$。\n- 体积流率: $Q_1 = 8.0 \\times 10^{-13}\\ \\mathrm{m}^3\\,\\mathrm{s}^{-1}$, $Q_2 = 6.0 \\times 10^{-13}\\ \\mathrm{m}^3\\,\\mathrm{s}^{-1}$, $Q_3 = 5.0 \\times 10^{-13}\\ \\mathrm{m}^3\\,\\mathrm{s}^{-1}$。\n- 渗透性: $P_1 = 1.0 \\times 10^{-6}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$, $P_2 = 1.0 \\times 10^{-5}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$, $P_3 = 1.0 \\times 10^{-4}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$。\n- 间质浓度: $C_{\\mathrm{is},1} = 50.0\\ \\mathrm{mol}\\,\\mathrm{m}^{-3}$, $C_{\\mathrm{is},2} = 200.0\\ \\mathrm{mol}\\,\\mathrm{m}^{-3}$, $C_{\\mathrm{is},3} = 400.0\\ \\mathrm{mol}\\,\\mathrm{m}^{-3}$。\n\n测试用例 2（高流量状态）：\n- $C_{\\mathrm{in}} = 100.0\\ \\mathrm{mol}\\,\\mathrm{m}^{-3}$。\n- 管段长度: $L_1 = 0.005\\ \\mathrm{m}$, $L_2 = 0.003\\ \\mathrm{m}$, $L_3 = 0.005\\ \\mathrm{m}$。\n- 体积流率: $Q_1 = 2.0 \\times 10^{-12}\\ \\mathrm{m}^3\\,\\mathrm{s}^{-1}$, $Q_2 = 2.0 \\times 10^{-12}\\ \\mathrm{m}^3\\,\\mathrm{s}^{-1}$, $Q_3 = 2.0 \\times 10^{-12}\\ \\mathrm{m}^3\\,\\mathrm{s}^{-1}$。\n- 渗透性: $P_1 = 1.0 \\times 10^{-6}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$, $P_2 = 1.0 \\times 10^{-5}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$, $P_3 = 1.0 \\times 10^{-4}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$。\n- 间质浓度: $C_{\\mathrm{is},1} = 50.0\\ \\mathrm{mol}\\,\\mathrm{m}^{-3}$, $C_{\\mathrm{is},2} = 200.0\\ \\mathrm{mol}\\,\\mathrm{m}^{-3}$, $C_{\\mathrm{is},3} = 400.0\\ \\mathrm{mol}\\,\\mathrm{m}^{-3}$。\n\n测试用例 3（低渗透性，下降的间质浓度）：\n- $C_{\\mathrm{in}} = 100.0\\ \\mathrm{mol}\\,\\mathrm{m}^{-3}$。\n- 管段长度: $L_1 = 0.005\\ \\mathrm{m}$, $L_2 = 0.003\\ \\mathrm{m}$, $L_3 = 0.005\\ \\mathrm{m}$。\n- 体积流率: $Q_1 = 8.0 \\times 10^{-13}\\ \\mathrm{m}^3\\,\\mathrm{s}^{-1}$, $Q_2 = 6.0 \\times 10^{-13}\\ \\mathrm{m}^3\\,\\mathrm{s}^{-1}$, $Q_3 = 5.0 \\times 10^{-13}\\ \\mathrm{m}^3\\,\\mathrm{s}^{-1}$。\n- 渗透性: $P_1 = 1.0 \\times 10^{-7}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$, $P_2 = 1.0 \\times 10^{-7}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$, $P_3 = 1.0 \\times 10^{-7}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$。\n- 间质浓度: $C_{\\mathrm{is},1} = 50.0\\ \\mathrm{mol}\\,\\mathrm{m}^{-3}$, $C_{\\mathrm{is},2} = 50.0\\ \\mathrm{mol}\\,\\mathrm{m}^{-3}$, $C_{\\mathrm{is},3} = 50.0\\ \\mathrm{mol}\\,\\mathrm{m}^{-3}$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。每个元素对应一个测试用例，并且其本身也是一个用方括号括起来的、由轴向边界浓度 $[C(x_0), C(x_1), C(x_2), C(x_3)]$（单位为 $\\mathrm{mol}\\,\\mathrm{m}^{-3}$）组成的逗号分隔列表，每个浓度值都四舍五入到小数点后 6 位。例如，打印的结构必须类似于 $[[c_{0,1},c_{1,1},c_{2,1},c_{3,1}],[c_{0,2},c_{1,2},c_{2,2},c_{3,2}],[c_{0,3},c_{1,3},c_{2,3},c_{3,3}]]$，其中 $c_{i,j}$ 表示测试用例 $j$ 的第 $i$ 个边界值。",
            "solution": "我们可以通过推导每个管段中尿素浓度的控制微分方程，然后依次求解来解决这个问题。\n\n**1. 推导控制方程**\n考虑管段 $s$ 内一个长度为 $\\Delta x$ 的微分控制体积。在稳态下，进入的质量必须等于流出的质量。质量通过在位置 $x$ 的对流进入，并通过在 $x+\\Delta x$ 的对流以及沿长度 $\\Delta x$ 的跨膜输运流出。\n质量平衡方程为：\n$$\n\\text{流入质量} - \\text{流出质量} = 0\n$$\n$$\nQ_s C(x) - \\left[ Q_s C(x+\\Delta x) + J_{mem,s} \\cdot (S'_s \\Delta x) \\right] = 0\n$$\n其中 $J_{mem,s}$ 是向外的膜通量。问题指出该通量与浓度差成正比：$J_{mem,s} = P_s (C(x) - C_{\\mathrm{is},s})$。代入此式：\n$$\nQ_s C(x) - Q_s C(x+\\Delta x) - P_s S'_s (C(x) - C_{\\mathrm{is},s}) \\Delta x = 0\n$$\n重新整理并除以 $\\Delta x$：\n$$\n-Q_s \\frac{C(x+\\Delta x) - C(x)}{\\Delta x} - P_s S'_s (C(x) - C_{\\mathrm{is},s}) = 0\n$$\n取 $\\Delta x \\to 0$ 的极限，我们得到管段 $s$ 的一阶常微分方程（ODE）：\n$$\nQ_s \\frac{dC}{dx} + P_s S'_s (C(x) - C_{\\mathrm{is},s}) = 0\n$$\n这是一个可分离的线性ODE。设 $y(x) = C(x) - C_{\\mathrm{is},s}$。则 $\\frac{dy}{dx} = \\frac{dC}{dx}$。ODE变为：\n$$\nQ_s \\frac{dy}{dx} = -P_s S'_s y \\implies \\frac{dy}{y} = -\\frac{P_s S'_s}{Q_s} dx\n$$\n\n**2. 求解ODE**\n设管段 $s$ 从全局坐标 $x_{s-1}$ 开始，到 $x_s$ 结束，其长度为 $L_s = x_s - x_{s-1}$。我们在管段上对ODE进行积分：\n$$\n\\int_{y(x_{s-1})}^{y(x_s)} \\frac{dy}{y} = -\\int_{x_{s-1}}^{x_s} \\frac{P_s S'_s}{Q_s} dx\n$$\n$$\n\\ln\\left(\\frac{y(x_s)}{y(x_{s-1})}\\right) = -\\frac{P_s S'_s}{Q_s} L_s\n$$\n代回 $y(x) = C(x) - C_{\\mathrm{is},s}$：\n$$\n\\frac{C(x_s) - C_{\\mathrm{is},s}}{C(x_{s-1}) - C_{\\mathrm{is},s}} = \\exp\\left(-\\frac{P_s S'_s L_s}{Q_s}\\right)\n$$\n求解管段出口浓度 $C(x_s)$：\n$$\nC(x_s) = C_{\\mathrm{is},s} + \\left(C(x_{s-1}) - C_{\\mathrm{is},s}\\right) \\exp\\left(-\\frac{P_s S'_s L_s}{Q_s}\\right)\n$$\n\n**3. 迭代计算**\n问题要求计算三个管段边界处的浓度：$C(x_0)$、$C(x_1)$、$C(x_2)$ 和 $C(x_3)$，其中 $x_0=0$。\n-   我们已知入口处的初始浓度：$C(x_0) = C_{\\mathrm{in}}$。\n-   管段1（$s=1$）末端的浓度使用推导出的公式和 $C(x_0)$ 作为输入进行计算。\n-   由于浓度是连续的，管段1的出口浓度即为管段2的入口浓度，即 $C(x_1)$ 是管段2的输入。\n-   对所有管段重复此过程。\n算法如下：\n1.  用入口值初始化一个浓度列表：`concentrations = [C_in]`。\n2.  对于每个管段 $s$ (从1到S)：\n    a.  设 $C_{in,s}$ 为上一步计算出的浓度。\n    b.  使用管段 $s$ 的参数（$L_s, Q_s, P_s, C_{\\mathrm{is},s}$）通过上述公式计算出口浓度 $C_{out,s}$。\n    c.  将 $C_{out,s}$ 添加到浓度列表中。\n3.  最终列表将包含 $[C(x_0), C(x_1), C(x_2), C(x_3)]$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the urea concentration at segment boundaries in a model of a\n    nephron collecting duct for multiple test cases.\n    \"\"\"\n    \n    # Define the common parameter S_prime\n    S_prime = 6.0e-5  # m\n\n    # Define the test cases as a list of dictionaries.\n    test_cases = [\n        {\n            # Test case 1 (representative medullary gradient)\n            \"C_in\": 100.0,\n            \"L_s\": [0.005, 0.003, 0.005],\n            \"Q_s\": [8.0e-13, 6.0e-13, 5.0e-13],\n            \"P_s\": [1.0e-6, 1.0e-5, 1.0e-4],\n            \"C_is_s\": [50.0, 200.0, 400.0]\n        },\n        {\n            # Test case 2 (high-flow regime)\n            \"C_in\": 100.0,\n            \"L_s\": [0.005, 0.003, 0.005],\n            \"Q_s\": [2.0e-12, 2.0e-12, 2.0e-12],\n            \"P_s\": [1.0e-6, 1.0e-5, 1.0e-4],\n            \"C_is_s\": [50.0, 200.0, 400.0]\n        },\n        {\n            # Test case 3 (low-permeability, declining interstitial)\n            \"C_in\": 100.0,\n            \"L_s\": [0.005, 0.003, 0.005],\n            \"Q_s\": [8.0e-13, 6.0e-13, 5.0e-13],\n            \"P_s\": [1.0e-7, 1.0e-7, 1.0e-7],\n            \"C_is_s\": [50.0, 50.0, 50.0]\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        C_in = case[\"C_in\"]\n        L_s = case[\"L_s\"]\n        Q_s = case[\"Q_s\"]\n        P_s = case[\"P_s\"]\n        C_is_s = case[\"C_is_s\"]\n        \n        # Number of segments\n        S = len(L_s)\n        \n        # List to store concentrations at boundaries [C(x0), C(x1), ..., C(xS)]\n        boundary_concentrations = [C_in]\n        \n        current_C = C_in\n        \n        # Iterate through each segment to calculate the outlet concentration\n        for s in range(S):\n            L = L_s[s]\n            Q = Q_s[s]\n            P = P_s[s]\n            C_is = C_is_s[s]\n            \n            # The inlet concentration for this segment is the outlet of the previous one\n            C_in_segment = current_C\n            \n            # Dimensionless exponent k = (P * S' * L) / Q\n            k = (P * S_prime * L) / Q\n            \n            # Calculate the outlet concentration for the current segment\n            C_out_segment = C_is + (C_in_segment - C_is) * np.exp(-k)\n            \n            # Store the result and update the current concentration for the next iteration\n            boundary_concentrations.append(C_out_segment)\n            current_C = C_out_segment\n        \n        all_results.append(boundary_concentrations)\n\n    # Format the final output string as per the problem specification\n    # [[c_0,1,c_1,1,...],[c_0,2,c_1,2,...],...] with 6 decimal places.\n    \n    # A list to hold string representations of each test case's results\n    inner_lists_str = []\n    \n    for result_list in all_results:\n        # Format each concentration to 6 decimal places\n        rounded_res = [f\"{c:.6f}\" for c in result_list]\n        # Join the numbers with commas and enclose in brackets\n        inner_str = f\"[{','.join(rounded_res)}]\"\n        inner_lists_str.append(inner_str)\n        \n    # Join the inner lists with commas and enclose in outer brackets\n    final_output = f\"[{','.join(inner_lists_str)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "最后的实践练习连接了理论模型及其实际计算实现，这是现代生物医学建模的一项关键技能。您将研究一种求解平流方程的常用数值方法如何引入人为的“数值扩散”，这可能违反全局质量守恒。这项练习提供了一个关于分析数值方案的准确性和守恒特性的重要性的深刻教训。",
            "id": "3878823",
            "problem": "考虑一个一维组织灌注毛细血管段，其模型为一根长度为 $L$、横截面积恒为 $A$ 的管道，通过恒定轴向速度 $u$ 的平流作用，输运一种浓度为 $c(x,t)$ 的稀释、非反应性溶质。管腔内溶质的控制性守恒定律是连续性方程 $\\partial c / \\partial t + \\partial (u c)/\\partial x = 0$，且在 $x=L$ 处为流出边界。使用包含 $N$ 个宽度为 $\\Delta x = L/N$ 的控制体积的均匀有限体积网格，其半离散更新在时间上通过向前欧拉步长进行近似，并采用迎风格式数值通量。令 Courant–Friedrichs–Lewy (CFL) 数为 $\\lambda = u \\Delta t / \\Delta x$。\n\n假设初始管腔浓度向出口处呈斜坡下降，以模拟一个陡峭的冲刷前缘：\n- 对于 $0 \\le x \\le L - \\delta$，$c(x,0) = c_{0}$，\n- 对于 $L - \\delta \\le x \\le L$，$c(x,0) = c_{0} \\,(L - x)/\\delta$，\n其中 $c$ 是连续的，且 $c(L,0)=0$。\n\n按如下方式处理迎风格式数值扩散对全局质量的单步、主阶效应：将迎风离散化视为求解一个出现伪扩散项的修正偏微分方程，并假设在单个时间步 $\\Delta t$ 内，出口梯度保持其初始值不变，同时由于入口 $x=0$ 处的梯度为零，该处的数值扩散通量可忽略不计。利用这些假设，计算单个时间步内完全由数值扩散引起的离散全局质量损失。\n\n使用以下参数值：\n- $L = 1.0 \\times 10^{-2}\\ \\text{m}$，\n- $A = 1.0 \\times 10^{-6}\\ \\text{m}^{2}$，\n- $u = 1.0 \\times 10^{-3}\\ \\text{m}\\,\\text{s}^{-1}$，\n- $N = 100$，因此 $\\Delta x = L/N$，\n- $\\lambda = 0.60$，\n- $\\Delta t = \\lambda \\Delta x / u$，\n- $c_{0} = 1.0\\ \\text{mmol}\\,\\text{m}^{-3}$，\n- $\\delta = 5.0 \\times 10^{-4}\\ \\text{m}$。\n\n仅从守恒定律和离散迎风通量出发，推导该格式引起的主阶数值扩散系数，然后评估由相关的出口扩散通量导致的单步质量差异。以 $\\text{mmol}$ 为单位表示最终的质量差异，并将答案四舍五入到三位有效数字。此外，简要解释这种数值扩散对灌注模型中守恒性的影响，并区分流出边界条件下的局部守恒和全局守恒。",
            "solution": "该问题要求计算当将一阶迎风有限体积格式应用于一维平流方程时，由数值扩散导致的单个时间步内的质量损失。解决方案需要推导修正偏微分方程（MPDE）以识别数值扩散项。\n\n**1. 推导修正偏微分方程 (MPDE)**\n物理控制方程是一维平流方程：\n$$\n\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = 0\n$$\n问题描述了一个采用前向欧拉时间步长和一阶迎风通量（对于 $u>0$）的有限体积离散化：\n$$\n\\frac{c_i^{n+1} - c_i^n}{\\Delta t} = -u \\frac{c_i^n - c_{i-1}^n}{\\Delta x}\n$$\n为了找到MPDE，我们对每个项在点 $(x_i, t_n)$ 附近进行泰勒级数展开，其中我们将 $c(x_i, t_n)$ 表示为 $c$，其偏导数用下标表示（例如，$c_t, c_x, c_{xx}$）。\n$$\nc_i^{n+1} = c(x_i, t_n + \\Delta t) = c + \\Delta t c_t + \\frac{(\\Delta t)^2}{2} c_{tt} + O((\\Delta t)^3)\n$$\n$$\nc_{i-1}^n = c(x_i - \\Delta x, t_n) = c - \\Delta x c_x + \\frac{(\\Delta x)^2}{2} c_{xx} - \\frac{(\\Delta x)^3}{6} c_{xxx} + O((\\Delta x)^4)\n$$\n将这些展开式代入离散方程：\n$$\n\\frac{c + \\Delta t c_t + \\frac{(\\Delta t)^2}{2} c_{tt} + \\dots - c}{\\Delta t} = -u \\frac{c - (c - \\Delta x c_x + \\frac{(\\Delta x)^2}{2} c_{xx} + \\dots)}{\\Delta x}\n$$\n$$\nc_t + \\frac{\\Delta t}{2} c_{tt} + \\dots = -u \\frac{\\Delta x c_x - \\frac{(\\Delta x)^2}{2} c_{xx} + \\dots}{\\Delta x}\n$$\n$$\nc_t + \\frac{\\Delta t}{2} c_{tt} + \\dots = -u c_x + \\frac{u \\Delta x}{2} c_{xx} + \\dots\n$$\n重新整理以匹配原始PDE的形式，得到截断误差：\n$$\nc_t + u c_x = \\frac{u \\Delta x}{2} c_{xx} - \\frac{\\Delta t}{2} c_{tt} + \\dots\n$$\n为了消除时间导数 $c_{tt}$，我们对主阶方程本身进行微分：$c_t \\approx -u c_x$。对时间求导得到 $c_{tt} \\approx -u c_{xt}$，对空间求导得到 $c_{tx} \\approx -u c_{xx}$。假设连续性，$c_{xt}=c_{tx}$，因此 $c_{tt} \\approx -u(-u c_{xx}) = u^2 c_{xx}$。\n将此代回截断误差方程：\n$$\nc_t + u c_x = \\frac{u \\Delta x}{2} c_{xx} - \\frac{\\Delta t}{2} (u^2 c_{xx}) + O(\\Delta x^2, \\Delta t^2)\n$$\n提出公因式并使用CFL数定义 $\\lambda = u \\Delta t / \\Delta x$：\n$$\n\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = \\left( \\frac{u \\Delta x}{2} - \\frac{u^2 \\Delta t}{2} \\right) \\frac{\\partial^2 c}{\\partial x^2} + \\dots = \\frac{u \\Delta x}{2} \\left( 1 - \\frac{u \\Delta t}{\\Delta x} \\right) \\frac{\\partial^2 c}{\\partial x^2} + \\dots\n$$\n因此，MPDE为：\n$$\n\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = K_{num} \\frac{\\partial^2 c}{\\partial x^2} \\quad \\text{其中} \\quad K_{num} = \\frac{u \\Delta x}{2} (1 - \\lambda)\n$$\n主阶误差项表现为物理扩散项，其中 $K_{num}$ 是数值扩散系数。\n\n**2. 计算质量损失**\n区域 $[0, L]$ 内溶质的总质量为 $M(t) = \\int_0^L A c(x,t) dx$。其变化率通过在区域内对MPDE进行积分得到：\n$$\n\\frac{dM}{dt} = A \\int_0^L \\frac{\\partial c}{\\partial t} dx = A \\int_0^L \\left( -u \\frac{\\partial c}{\\partial x} + K_{num} \\frac{\\partial^2 c}{\\partial x^2} \\right) dx\n$$\n$$\n\\frac{dM}{dt} = A \\left[ -u c(x,t) + K_{num} \\frac{\\partial c}{\\partial x} \\right]_0^L\n$$\n这表明总质量因边界处的物理对流 ($u c$) 和数值扩散 ($K_{num} \\frac{\\partial c}{\\partial x}$) 而变化。仅由数值扩散引起的质量变化为：\n$$\n\\dot{M}_{num} = A \\left[ K_{num} \\frac{\\partial c}{\\partial x} \\right]_0^L = A K_{num} \\left( \\frac{\\partial c}{\\partial x}\\bigg|_{x=L} - \\frac{\\partial c}{\\partial x}\\bigg|_{x=0} \\right)\n$$\n问题假设 $\\frac{\\partial c}{\\partial x}\\big|_{x=0} = 0$（根据初始条件剖面），并且出口梯度在时间步内恒定，等于其初始值。对于 $L-\\delta \\le x \\le L$，初始剖面为 $c(x,0) = c_0 (L-x)/\\delta$。该区域的梯度为：\n$$\n\\frac{\\partial c}{\\partial x} = \\frac{d}{dx} \\left( \\frac{c_0}{\\delta}(L-x) \\right) = -\\frac{c_0}{\\delta}\n$$\n因此，$\\frac{\\partial c}{\\partial x}\\big|_{x=L, t=0} = -c_0/\\delta$。\n数值扩散引起的质量变化率为：\n$$\n\\dot{M}_{num} = A K_{num} \\left( -\\frac{c_0}{\\delta} - 0 \\right) = -\\frac{A K_{num} c_0}{\\delta}\n$$\n负号表示区域的质量损失。在单个时间步长 $\\Delta t$ 内损失的质量为：\n$$\n\\Delta M_{loss, num} = |\\dot{M}_{num}| \\Delta t = \\frac{A c_0 K_{num} \\Delta t}{\\delta}\n$$\n\n**3. 数值评估**\n首先，计算所需参数：\n- $\\Delta x = L/N = 1.0 \\times 10^{-2} / 100 = 1.0 \\times 10^{-4}$ m.\n- $\\Delta t = \\lambda \\Delta x / u = (0.60 \\times 1.0 \\times 10^{-4}) / (1.0 \\times 10^{-3}) = 0.06$ s.\n- $K_{num} = \\frac{u \\Delta x}{2}(1 - \\lambda) = \\frac{(1.0 \\times 10^{-3})(1.0 \\times 10^{-4})}{2}(1 - 0.60) = (0.5 \\times 10^{-7})(0.40) = 2.0 \\times 10^{-8}$ m$^2$/s.\n\n现在，计算质量损失：\n$$\n\\Delta M_{loss, num} = \\frac{(1.0 \\times 10^{-6}\\ \\text{m}^2) (1.0\\ \\text{mmol}\\,\\text{m}^{-3}) (2.0 \\times 10^{-8}\\ \\text{m}^2\\,\\text{s}^{-1}) (0.06\\ \\text{s})}{5.0 \\times 10^{-4}\\ \\text{m}}\n$$\n$$\n\\Delta M_{loss, num} = \\frac{1.2 \\times 10^{-15}}{5.0 \\times 10^{-4}} \\text{ mmol} = 0.24 \\times 10^{-11} \\text{ mmol} = 2.4 \\times 10^{-12} \\text{ mmol}\n$$\n四舍五入到三位有效数字，结果为 $2.40 \\times 10^{-12}$ mmol。\n\n**对守恒性的影响**\n有限体积法通过其构建方式是局部守恒的，意味着质量在相邻单元之间完美传递。然而，全局守恒关系到整个计算域的总质量，则不被保证。数值扩散项在边界处产生了一个非物理通量 $-K_{num} \\frac{\\partial c}{\\partial x}$。在浓度梯度不为零的流出边界（例如当一个陡峭的前沿离开区域时），这种非物理通量会将质量带出区域，从而违反全局质量守恒。这会导致对总质量的系统性低估，对于追踪物质输送或冲刷过程的模型来说，这是一个关键的误差来源。需要更高阶的数值格式来减轻这种效应，从而更好地保持全局量。",
            "answer": "$$ \\boxed{2.40 \\times 10^{-12}} $$"
        }
    ]
}