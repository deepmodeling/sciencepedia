{
    "hands_on_practices": [
        {
            "introduction": "要构建一个稳健的基于智能体的模型，我们首先必须定义单个智能体（例如免疫细胞）如何移动。本练习将演示一个基本原理：从无偏随机游走这一简单的微观规则推导出宏观的扩散方程。通过掌握这一推导过程 ，您将深刻理解如何在计算模型中参数化和解释细胞的随机迁移行为。",
            "id": "3870843",
            "problem": "一个用于模拟免疫细胞巡逻的基于智能体的模型 (ABM) 在二维方格点阵上实现，该点阵代表肿瘤微环境的组织薄片。一个单独的细胞毒性T淋巴细胞 (CTL) 智能体从原点开始，在每个离散时间增量 $\\,\\Delta t\\,$ 内，以等概率移动一个长度为 $\\,h\\,$ 的点阵步长，到达四个最近邻位点之一。环境是均匀且各向同性的，没有外部信号（无趋化性），因此行走是无偏的。智能体在时间 $\\,t\\,$ 的位置被建模为其独立同分布的点阵位移的累积和。\n\n从适用于生物医学系统建模和随机过程的第一性原理出发，论证从离散时间、离散空间的无偏随机行走过渡到关于智能体位置的概率密度 $\\,p(x,y,t)\\,$ 的连续空间、连续时间的描述的合理性。基于此连续介质描述以及二维空间中各向同性扩散的扩散系数定义，推导出有效扩散系数 $\\,D\\,$ 作为点阵步长 $\\,h\\,$ 和时间步长 $\\,\\Delta t\\,$ 的函数。\n\n你的最终答案必须是 $\\,D\\,$ 关于 $\\,h\\,$ 和 $\\,\\Delta t\\,$ 的单个封闭形式的符号表达式。不要代入数值。如果 $\\,h\\,$ 的单位是微米，$\\,\\Delta t\\,$ 的单位是秒，请用平方微米每秒表示扩散系数。无需四舍五入。",
            "solution": "该问题陈述经评估具有科学依据、良构且客观。它描述了一个标准的物理模型——离散随机行走，并要求严格推导其连续极限，这是统计物理学及其在生物学中应用的一个基本步骤。所有必要的参数都已提供，没有矛盾或含糊之处。该问题是有效的。\n\n问题要求论证从离散时间、离散空间的随机行走过渡到连续扩散方程的合理性，并随后推导出有效扩散系数 $D$。\n\n设细胞毒性T淋巴细胞 (CTL) 智能体在二维方格点阵上的位置由坐标 $(x, y)$ 给出，这些坐标是点阵步长 $h$ 的整数倍。设 $P(x, y, t)$ 为在时间 $t$ 时在位点 $(x, y)$ 找到该智能体的概率，其中时间是离散时间增量 $\\Delta t$ 的倍数。\n\n智能体的运动是一个离散时间马尔可夫过程。在每个时间步长 $t$，位于 $(x, y)$ 的智能体以 $\\frac{1}{4}$ 的等概率移动到其四个最近邻位点 $(x+h, y)$、$(x-h, y)$、$(x, y+h)$ 或 $(x, y-h)$ 之一。在时间 $t + \\Delta t$ 位于位点 $(x, y)$ 的概率取决于在时间 $t$ 位于相邻位点的概率。这种关系由该过程的主方程描述：\n$$P(x, y, t + \\Delta t) = \\frac{1}{4} \\left[ P(x-h, y, t) + P(x+h, y, t) + P(x, y-h, t) + P(x, y+h, t) \\right]$$\n\n为了论证并实现向连续描述的过渡，我们假设 $P(x, y, t)$ 可以用一个光滑、二次可微的概率密度函数 $p(x, y, t)$ 来近似。这一假设在远大于基本步长 $h$ 和时间步长 $\\Delta t$ 的空间和时间尺度上是有效的。我们通过对函数 $p(x, y, t)$ 在点 $(x, y, t)$ 周围进行泰勒级数展开来分析主方程。\n\n主方程的左侧对时间进行展开：\n$$p(x, y, t + \\Delta t) = p(x, y, t) + \\frac{\\partial p}{\\partial t} \\Delta t + O((\\Delta t)^2)$$\n\n右侧的各项在 $(x, y)$ 周围对空间进行展开：\n$$p(x \\pm h, y, t) = p(x, y, t) \\pm h \\frac{\\partial p}{\\partial x} + \\frac{h^2}{2} \\frac{\\partial^2 p}{\\partial x^2} \\pm \\frac{h^3}{6} \\frac{\\partial^3 p}{\\partial x^3} + O(h^4)$$\n$$p(x, y \\pm h, t) = p(x, y, t) \\pm h \\frac{\\partial p}{\\partial y} + \\frac{h^2}{2} \\frac{\\partial^2 p}{\\partial y^2} \\pm \\frac{h^3}{6} \\frac{\\partial^3 p}{\\partial y^3} + O(h^4)$$\n\n将这些展开式代入主方程的右侧：\n$$ \\frac{1}{4} \\left[ (p - h \\frac{\\partial p}{\\partial x} + \\frac{h^2}{2} \\frac{\\partial^2 p}{\\partial x^2}) + (p + h \\frac{\\partial p}{\\partial x} + \\frac{h^2}{2} \\frac{\\partial^2 p}{\\partial x^2}) + (p - h \\frac{\\partial p}{\\partial y} + \\frac{h^2}{2} \\frac{\\partial^2 p}{\\partial y^2}) + (p + h \\frac{\\partial p}{\\partial y} + \\frac{h^2}{2} \\frac{\\partial^2 p}{\\partial y^2}) \\right] + \\dots $$\n这里我们截断了 $h^3$ 及更高阶的项。由于行走的对称性，一阶导数项（以及所有奇数阶项）在求和时相互抵消：\n$$ \\frac{1}{4} \\left[ 4p(x,y,t) + h^2 \\left( \\frac{\\partial^2 p}{\\partial x^2} + \\frac{\\partial^2 p}{\\partial y^2} \\right) \\right] + O(h^4) = p(x,y,t) + \\frac{h^2}{4} \\nabla^2 p(x,y,t) + O(h^4) $$\n其中 $\\nabla^2 = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}$ 是二维拉普拉斯算子。\n\n现在我们令展开后的左侧和右侧相等：\n$$ p(x, y, t) + \\frac{\\partial p}{\\partial t} \\Delta t + O((\\Delta t)^2) = p(x, y, t) + \\frac{h^2}{4} \\nabla^2 p(x,y,t) + O(h^4) $$\n\n从两边减去 $p(x, y, t)$ 得到：\n$$ \\frac{\\partial p}{\\partial t} \\Delta t + O((\\Delta t)^2) = \\frac{h^2}{4} \\nabla^2 p + O(h^4) $$\n\n两边除以 $\\Delta t$：\n$$ \\frac{\\partial p}{\\partial t} + O(\\Delta t) = \\frac{h^2}{4\\Delta t} \\nabla^2 p + O\\left(\\frac{h^4}{\\Delta t}\\right) $$\n\n从离散主方程到连续偏微分方程的过渡，在扩散极限下是合理的，即 $\\Delta t \\to 0$ 和 $h \\to 0$ 同时发生，且比率 $\\frac{h^2}{\\Delta t}$ 保持为有限的非零值。在此极限下，高阶项 $O(\\Delta t)$ 和 $O(\\frac{h^4}{\\Delta t})$ 消失。这便得到了连续方程：\n$$ \\frac{\\partial p}{\\partial t} = \\left( \\frac{h^2}{4\\Delta t} \\right) \\nabla^2 p $$\n\n该方程具有二维标准各向同性扩散方程（也称为菲克第二定律）的形式：\n$$ \\frac{\\partial p}{\\partial t} = D \\nabla^2 p $$\n其中 $D$ 是有效扩散系数。\n\n通过将推导出的方程与标准形式进行比较，我们可以直接确定扩散系数 $D$ 的表达式：\n$$ D = \\frac{h^2}{4\\Delta t} $$\n这个表达式给出了在步长为 $h$、时间步长为 $\\Delta t$ 的二维方格点阵上进行无偏随机行走的智能体的有效扩散系数。\n\n$D$ 的单位由 $h$ 和 $\\Delta t$ 的单位决定。如果 $h$ 的单位是微米 ($\\mu m$)，$\\Delta t$ 的单位是秒 ($s$)，那么 $D$ 的单位就是 $(\\mu m)^2 / s$，或 $\\mu m^2 s^{-1}$，这是细胞生物学中扩散系数的标准单位。",
            "answer": "$$\\boxed{\\frac{h^2}{4 \\Delta t}}$$"
        },
        {
            "introduction": "在为智能体的移动建模后，下一个关键步骤是捕捉其生命周期：增殖与死亡。本实践介绍了高尔顿-沃森分支过程，这是一个强大的框架，可用于模拟细胞种群（如肿瘤克隆或扩增的淋巴细胞家族）的随机命运。通过从基本的细胞层面结果推导出种群的灭绝概率 ，您将学会如何评估一个小的细胞群体是注定被清除，还是具有指数级增长的潜力。",
            "id": "3870840",
            "problem": "在一个增殖性肿瘤细胞克隆的基于智能体的模型（ABM; Agent-Based Model）中，每个智能体代表一个存活的肿瘤细胞。在每个细胞周期结束时，一个智能体会被随机数量的存活子细胞所替代，遵循以下生物学上合理的、假定在所有智能体和代际之间独立同分布的结果：\n- 细胞凋亡，不产生存活子细胞，概率为 $p_0$。\n- 不对称分裂（例如，保留一个存活子细胞和一个非存活产物），产生一个存活子细胞，概率为 $p_1$。\n- 对称分裂，产生两个存活子细胞，概率为 $p_2$。\n假设没有其他结果，因此 $p_0 + p_1 + p_2 = 1$。初始种群由单个存活细胞组成。\n\n令 $K$ 表示单个细胞在其周期结束时产生的存活子细胞数量，并定义后代生成函数 $f(s)$ 为 $f(s) = \\mathbb{E}[s^{K}]$，其中 $s \\in [0,1]$。仅使用后代生成函数的核心定义以及 Galton–Watson 分支过程的独立性结构，推导出确定从单个初始细胞开始的克隆的灭绝概率 $q$ 的表达式，然后为以下每个参数集计算 $q$：\n- 参数组 A：$p_0 = 0.55$，$p_1 = 0.25$，$p_2 = 0.20$。\n- 参数组 B：$p_0 = 0.20$，$p_1 = 0.15$，$p_2 = 0.65$。\n\n将你的最终答案表示为按（参数组 A, 参数組 B）顺序排列的行矩阵。如果任何值为精确有理数，请以精确分数形式表示；否则，请给出精确代数值。无需四舍五入。灭绝概率是无量纲的，不要包含单位。",
            "solution": "问题陈述被评估为具有科学依据、良定且客观。它为分支过程理论中的一个标准问题提供了完整且一致的设置，该理论是生物医学系统建模中的常用工具。因此，该问题被认为是有效的。\n\n所描述的模型是一个 Galton-Watson 分支过程。令 $Z_n$ 为第 $n$ 代的存活肿瘤细胞数量，初始条件为 $Z_0=1$。单个细胞产生的后代（存活子细胞）数量 $K$ 是一个随机变量，其概率分布如下：\n$$\n\\mathbb{P}(K=k) =\n\\begin{cases}\np_0  \\text{for } k=0 \\\\\np_1  \\text{for } k=1 \\\\\np_2  \\text{for } k=2 \\\\\n0  \\text{otherwise}\n\\end{cases}\n$$\n问题要求使用后代生成函数 $f(s)$，定义为 $f(s) = \\mathbb{E}[s^{K}]$。根据离散随机变量的期望值定义，我们有：\n$$\nf(s) = \\sum_{k=0}^{\\infty} \\mathbb{P}(K=k)s^k = p_0 s^0 + p_1 s^1 + p_2 s^2 = p_0 + p_1s + p_2s^2\n$$\n问题要求推导确定灭绝概率 $q$ 的表达式。灭绝概率定义为 $q = \\mathbb{P}(\\text{灭绝} | Z_0=1)$。“灭绝”事件意味着种群大小在某一代变为 $0$。令 $q_n = \\mathbb{P}(Z_n=0 | Z_0=1)$ 为种群在第 $n$ 代或之前灭绝的概率。序列 $\\{q_n\\}_{n \\ge 0}$ 是非递减的且有上界 1，因此其极限 $q = \\lim_{n \\to \\infty} q_n$ 存在，即为灭绝概率。\n\n种群 $Z_{n+1}$ 是上一代 $Z_n$ 个体后代的总和。种群在第 $n+1$ 代灭绝，当且仅当来自单个初始细胞的所有后代谱系到第 $n+1$ 代时都已消亡。这等价于说，对于初始细胞的 $K$ 个后代中的每一个，其自身的分支子过程（在统计上与原过程相同）在 $n$ 代内灭绝。由于这些子过程的独立性，我们可以写出 $q_{n+1}$ 关于 $q_n$ 的递推关系：\n$$\nq_{n+1} = \\mathbb{P}(Z_{n+1}=0) = \\sum_{k=0}^{2} \\mathbb{P}(Z_{n+1}=0|K=k)\\mathbb{P}(K=k) = \\sum_{k=0}^{2} (q_n)^k p_k\n$$\n这得到 $q_{n+1} = p_0(q_n)^0 + p_1(q_n)^1 + p_2(q_n)^2 = f(q_n)$。当 $n \\to \\infty$ 时取极限，并利用多项式函数 $f(s)$ 的连续性，我们发现 $q$ 必須是 $f(s)$ 的一个不动点：\n$$\nq = f(q)\n$$\n因此，灭绝概率 $q$ 是方程 $s = f(s)$ 的一个解。代入 $f(s)$ 的表达式，我们得到：\n$$\ns = p_0 + p_1s + p_2s^2\n$$\n这可以被重新整理为一个标准的二次方程：\n$$\np_2s^2 + (p_1-1)s + p_0 = 0\n$$\n我们已知约束条件 $p_0+p_1+p_2=1$，这意味着 $p_1-1 = -p_0-p_2$。将此代入二次方程，得到：\n$$\np_2s^2 - (p_0+p_2)s + p_0 = 0\n$$\n我们可以观察到 $s=1$ 是一个根：$p_2(1)^2 - (p_0+p_2)(1) + p_0 = p_2 - p_0 - p_2 + p_0 = 0$。由于 $s=1$ 是一个根，$(s-1)$ 必定是该二次多项式的一个因子。对多项式进行因式分解得到：\n$$\n(s-1)(p_2s - p_0) = 0\n$$\n因此，方程 $s=f(s)$ 的两个根是 $s=1$ 和 $s = \\frac{p_0}{p_2}$ (如果 $p_2 \\ne 0$）。如果 $p_2=0$，方程是线性的，唯一的根是 $s=1$。\n\n分支过程的一个基本定理指出，灭绝概率 $q$ 是方程 $s=f(s)$ 的最小非负根。因此，我们必须选择两个根 $1$ 和 $\\frac{p_0}{p_2}$ 中较小的一个。概率 $p_0$ 和 $p_2$ 是非负的，所以根 $\\frac{p_0}{p_2}$ 也是非负的。因此，灭绝概率由下式给出：\n$$\nq = \\min\\left(1, \\frac{p_0}{p_2}\\right)\n$$\n这个结果与平均后代数 $\\mu = \\mathbb{E}[K] = f'(1) = p_1 + 2p_2$ 相关。如果 $\\mu \\le 1$，则灭绝是必然的（$q=1$）。如果 $\\mu  1$，则有正的存活概率，因此 $q  1$。条件 $\\mu  1$ 等价于 $p_1+2p_2  1 = p_0+p_1+p_2$，化简为 $p_2  p_0$，或 $\\frac{p_0}{p_2}  1$。因此，推导出的 $q$ 的表达式与一般理论是一致的。\n\n现在我们为两个给定的参数集计算 $q$。\n\n**参数组 A：**$p_0 = 0.55$，$p_1 = 0.25$，$p_2 = 0.20$。\n首先，我们计算比率 $\\frac{p_0}{p_2}$：\n$$\n\\frac{p_0}{p_2} = \\frac{0.55}{0.20} = \\frac{55}{20} = \\frac{11}{4}\n$$\n灭绝概率 $q_A$ 是 $1$ 和 $\\frac{11}{4}$ 中的最小值：\n$$\nq_A = \\min\\left(1, \\frac{11}{4}\\right) = 1\n$$\n另外，平均后代数是 $\\mu_A = p_1 + 2p_2 = 0.25 + 2(0.20) = 0.25 + 0.40 = 0.65$。由于 $\\mu_A \\le 1$，灭绝概率为 $1$。\n\n**参数组 B：**$p_0 = 0.20$，$p_1 = 0.15$，$p_2 = 0.65$。\n首先，我们计算比率 $\\frac{p_0}{p_2}$：\n$$\n\\frac{p_0}{p_2} = \\frac{0.20}{0.65} = \\frac{20}{65} = \\frac{4}{13}\n$$\n灭绝概率 $q_B$ 是 $1$ 和 $\\frac{4}{13}$ 中的最小值：\n$$\nq_B = \\min\\left(1, \\frac{4}{13}\\right) = \\frac{4}{13}\n$$\n另外，平均后代数是 $\\mu_B = p_1 + 2p_2 = 0.15 + 2(0.65) = 0.15 + 1.30 = 1.45$。由于 $\\mu_B  1$，灭绝概率小于 $1$，这证实了 $q_B = \\frac{4}{13}$ 是正确的根。\n\n最终答案是参数组 A 和参数组 B 灭绝概率组成的行矩阵。\n对于参数组 A，$q_A = 1$。\n对于参数组 B，$q_B = \\frac{4}{13}$。\n最终答案以所要求的矩阵格式呈现。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1  \\frac{4}{13} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "现代的基于智能体的模型通常在一个动态的环境中运行，例如一个由引导细胞行为的信号分子（细胞因子）构成的场。本练习将通过使用有限差分法数值求解反应-扩散方程，为您提供对该环境进行建模的实践经验。通过实现更新规则并理解CFL稳定性条件 ，您将能够构建出智能体与其环境共同演化的复杂混合模型。",
            "id": "3870827",
            "problem": "您正在模拟一个扩散、衰减且有源的场，该场代表了免疫反应、肿瘤或传染病传播的基于代理的模型中的细胞因子浓度。该宏观场遵循反应扩散偏微分方程 $\\,\\partial_t c = D \\nabla^2 c - \\lambda c + S\\,$，其中 $\\,c\\,$ 是一个归一化的无量纲浓度场，$\\,D\\,$ 是扩散系数，单位为 $\\mathrm{m}^2/\\mathrm{s}$，$\\,\\lambda\\,$ 是衰减率，单位为 $\\mathrm{s}^{-1}$，$\\,S\\,$ 是一个无量纲的源项。该场定义在一个 $\\,d\\,$ 维的均匀笛卡尔网格上，每个维度的间距为 $\\,\\Delta x\\,$，并且在所有边界上施加零通量诺伊曼边界条件（法向导数为零）。\n\n任务：\n1. 使用前向欧拉时间离散化和均匀网格上离散拉普拉斯算子的二阶中心差分，为 $\\,c\\,$ 构建一个有限差分显式更新方案。通过边界值的“幽灵单元”复制来强制法向导数为零，从而实现零通量诺伊曼边界条件。显式地使用这样的离散拉普拉斯算子：对于内部点，它用二阶差分之和代替 $\\,\\nabla^2\\,$；对于邻近边界的点，它使用所选择的幽灵单元值，以使边界表面上的离散法向导数为零。\n2. 从显式扩散的 Von Neumann 稳定性角度，计算 $\\,d\\,$ 维下的 Courant–Friedrichs–Lewy (CFL) 时间步长限制 $\\,\\Delta t \\le \\frac{\\Delta x^2}{2 d D}\\,$。\n3. 对每个测试用例，计算：\n   - 最大稳定时间步长 $\\,\\Delta t_{\\mathrm{CFL}} = \\frac{\\Delta x^2}{2 d D}\\,$，并以秒为单位报告。\n   - 一个布尔值，说明在施加的诺伊曼边界条件下，一个随机初始化（使用固定随机种子）的 $\\,c\\,$ 的拉普拉斯算子的离散域积分是否在指定容差内数值上为零。具体来说，令 $\\,\\mathcal{L}[c]\\,$ 表示在诺伊曼边界下计算的离散拉普拉斯算子。计算 $\\,I = \\Delta x^d \\sum_{\\text{grid}} \\mathcal{L}[c]\\,$ 并检查 $\\,|I| \\le \\varepsilon \\max\\{1, \\Delta x^d \\sum_{\\text{grid}} |c|\\}\\,$ 是否成立，其中 $\\,\\varepsilon = 10^{-12}\\,$。若不等式成立，则报告 $\\,\\text{True}\\,$，否则报告 $\\,\\text{False}\\,$。\n\n使用的基本原理：\n- 菲克扩散定律, $\\,\\mathbf{J} = - D \\nabla c\\,$.\n- 控制体积内的守恒定律, $\\,\\partial_t c = - \\nabla \\cdot \\mathbf{J} - \\lambda c + S\\,$, 得到 $\\,\\partial_t c = D \\nabla^2 c - \\lambda c + S\\,$.\n- 均匀网格上前向欧拉时间离散化和空间导数的标准二阶有限差分。\n- 应用于线性常系数扩散的显式格式的 Von Neumann 稳定性分析，其中稳定性界限由离散拉普拉斯算子的最大模特征值确定。\n\n网格、参数和测试套件：\n在所有测试用例中，使用固定的随机种子 $\\,42\\,$ 来初始化 $\\,c\\,$，其值为从 $\\,[0,1]\\,$ 区间均匀抽取的独立同分布值。对于所有情况，将 $\\,c\\,$ 和 $\\,S\\,$ 视为无量纲量；只有 $\\,D\\,$, $\\,\\Delta x\\,$ 和 $\\,\\Delta t\\,$ 带有物理单位。对于每个用例，在整个网格上使用一个恒定的源 $\\,S\\,$（无量纲）。测试用例如下：\n\n- 用例 A (正常路径，一维):\n  - $\\,d = 1\\,$\n  - 网格形状 $\\,N = 5\\,$\n  - $\\,\\Delta x = 2 \\times 10^{-5}\\,\\mathrm{m}\\,$\n  - $\\,D = 1 \\times 10^{-10}\\,\\mathrm{m}^2/\\mathrm{s}\\,$\n  - $\\,\\lambda = 0.3\\,\\mathrm{s}^{-1}\\,$\n  - $\\,S = 0.1\\,$\n\n- 用例 B (二维，中等扩散):\n  - $\\,d = 2\\,$\n  - 网格形状 $\\,N_x = 21\\,$, $\\,N_y = 21\\,$\n  - $\\,\\Delta x = 1 \\times 10^{-5}\\,\\mathrm{m}\\,$\n  - $\\,D = 1 \\times 10^{-9}\\,\\mathrm{m}^2/\\mathrm{s}\\,$\n  - $\\,\\lambda = 0.5\\,\\mathrm{s}^{-1}\\,$\n  - $\\,S = 0.2\\,$\n\n- 用例 C (三维，较大间距):\n  - $\\,d = 3\\,$\n  - 网格形状 $\\,N_x = 11\\,$, $\\,N_y = 11\\,$, $\\,N_z = 11\\,$\n  - $\\,\\Delta x = 5 \\times 10^{-5}\\,\\mathrm{m}\\,$\n  - $\\,D = 5 \\times 10^{-10}\\,\\mathrm{m}^2/\\mathrm{s}\\,$\n  - $\\,\\lambda = 0.05\\,\\mathrm{s}^{-1}\\,$\n  - $\\,S = 0.0\\,$\n\n- 用例 D (边缘案例，二维，细网格):\n  - $\\,d = 2\\,$\n  - 网格形状 $\\,N_x = 9\\,$, $\\,N_y = 9\\,$\n  - $\\,\\Delta x = 2 \\times 10^{-6}\\,\\mathrm{m}\\,$\n  - $\\,D = 1 \\times 10^{-9}\\,\\mathrm{m}^2/\\mathrm{s}\\,$\n  - $\\,\\lambda = 1.0\\,\\mathrm{s}^{-1}\\,$\n  - $\\,S = 0.0\\,$\n\n输出规格：\n- 对于每个测试用例，生成一个列表 $\\,\\left[\\Delta t_{\\mathrm{CFL}},\\, \\text{flux\\_conservative}\\right]\\,$，其中 $\\,\\Delta t_{\\mathrm{CFL}}\\,$ 是一个以秒为单位的浮点数，而 $\\,\\text{flux\\_conservative}\\,$ 是一个布尔值，指示 $\\,|I| \\le \\varepsilon \\max\\{1, \\Delta x^d \\sum |c|\\}\\,$ 是否成立。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如 $\\,\\left[\\,[\\Delta t_{\\mathrm{CFL},A}, \\text{flux\\_conservative}_A],\\,[\\Delta t_{\\mathrm{CFL},B}, \\text{flux\\_conservative}_B],\\,[\\Delta t_{\\mathrm{CFL},C}, \\text{flux\\_conservative}_C],\\,[\\Delta t_{\\mathrm{CFL},D}, \\text{flux\\_conservative}_D]\\,\\right]\\,$。",
            "solution": "用户提供的问题被评估为**有效**。该问题具有科学依据，是适定的、客观的，并包含获得唯一、可验证解所需的所有必要信息。我们将着手解决它。\n\n### **1. 理论阐述**\n\n该问题要求在 $d$ 维笛卡尔网格上对反应扩散偏微分方程 (PDE) 进行数值求解：\n$$\n\\partial_t c = D \\nabla^2 c - \\lambda c + S\n$$\n其中，$c$ 是浓度，$D$ 是扩散系数，$\\lambda$ 是衰减率，$S$ 是源项。\n\n#### **1.1. 有限差分离散化**\n\n我们采用有限差分法来离散化该偏微分方程。\n\n**时间离散化**：对时间导数 $\\partial_t c$ 使用前向欧拉格式。对于时间步长 $\\Delta t$，时间步 $n+1$ 的浓度 $c^{n+1}$ 从时间步 $n$ 的浓度 $c^n$ 更新如下：\n$$\n\\frac{c^{n+1} - c^n}{\\Delta t} = D \\nabla^2 c^n - \\lambda c^n + S\n$$\n重新整理得到显式更新规则：\n$$\nc^{n+1} = c^n + \\Delta t (D \\mathcal{L}[c^n] - \\lambda c^n + S)\n$$\n其中 $\\mathcal{L}$ 代表离散拉普拉斯算子。\n\n**空间离散化**：拉普拉斯算子 $\\nabla^2 = \\sum_{k=1}^d \\frac{\\partial^2}{\\partial x_k^2}$ 在间距为 $\\Delta x$ 的均匀网格上使用二阶中心差分模板进行离散化。对于一个内部点 $\\mathbf{i} = (i_1, \\dots, i_d)$，离散拉普拉斯算子为：\n$$\n\\mathcal{L}[c]_{\\mathbf{i}} = \\sum_{k=1}^d \\frac{c_{\\mathbf{i}+\\mathbf{e}_k} - 2c_{\\mathbf{i}} + c_{\\mathbf{i}-\\mathbf{e}_k}}{\\Delta x^2}\n$$\n其中 $\\mathbf{e}_k$ 是沿第 $k$ 维的单位向量。\n\n#### **1.2. 诺伊曼边界条件**\n\n在所有边界上施加零通量诺伊曼边界条件 $\\frac{\\partial c}{\\partial n} = 0$。此处，$\\mathbf{n}$ 是外法向向量。对于笛卡尔网格，这简化为沿垂直于边界表面的坐标轴的偏导数为零。\n\n我们使用“幽灵单元”来实现这一点。考虑一个一维网格，点索引为 $i = 0, \\dots, N-1$。在边界 $i=0$ 处，边界表面位于 $i=-1/2$。此表面上导数的二阶中心差分为：\n$$\n\\frac{\\partial c}{\\partial x}\\bigg|_{i=-1/2} \\approx \\frac{c_0 - c_{-1}}{\\Delta x} = 0 \\implies c_{-1} = c_0\n$$\n这意味着索引为 $i=-1$ 的幽灵单元中的值是边界单元 $i=0$ 处值的副本。这种方法，即“幽灵单元复制”，应用于所有边界。\n\n在计算边界点（例如 $i=0$）的拉普拉斯算子时，我们使用标准的中心差分模板，现在它涉及幽灵单元：\n$$\n\\mathcal{L}[c]_0 = \\frac{c_1 - 2c_0 + c_{-1}}{\\Delta x^2}\n$$\n代入幽灵单元值 $c_{-1} = c_0$，我们得到：\n$$\n\\mathcal{L}[c]_0 = \\frac{c_1 - 2c_0 + c_0}{\\Delta x^2} = \\frac{c_1 - c_0}{\\Delta x^2}\n$$\n这种方法在整个网格上保持了一致的模板结构，这对于实现非常有利，尤其是在使用像 NumPy 这样的库进行矢量化操作时。`np.pad` 函数的 `mode='edge'` 模式直接实现了这种幽灵单元复制。\n\n### **2. 计算任务**\n\n#### **2.1. Courant–Friedrichs–Lewy (CFL) 稳定性条件**\n\n用于扩散方程的前向欧拉时间步进格式是条件稳定的。一次 Von Neumann 稳定性分析表明，该方法当且仅当时间步长 $\\Delta t$ 满足 Courant–Friedrichs–Lewy (CFL) 条件时才稳定。对于 $d$ 维扩散方程，该条件为：\n$$\n\\Delta t \\le \\frac{\\Delta x^2}{2 d D}\n$$\n问题要求计算最大稳定时间步长 $\\Delta t_{\\mathrm{CFL}}$，它对应于等式：\n$$\n\\Delta t_{\\mathrm{CFL}} = \\frac{\\Delta x^2}{2 d D}\n$$\n反应项 $-\\lambda c$（其中 $\\lambda \\ge 0$）不会对前向欧拉方法引入更严格的稳定性约束。\n\n#### **2.2. 离散拉普拉斯算子的守恒性质**\n\n问题要求检查一个与拉普拉斯算子积分相关的数值性质。连续散度定理指出，对于向量场 $\\mathbf{F}$，有 $\\int_V (\\nabla \\cdot \\mathbf{F}) dV = \\oint_{\\partial V} \\mathbf{F} \\cdot d\\mathbf{A}$。令 $\\mathbf{F} = \\nabla c$，则变为：\n$$\n\\int_V \\nabla^2 c \\, dV = \\oint_{\\partial V} \\nabla c \\cdot d\\mathbf{A}\n$$\n在零通量诺伊曼边界条件下，法向导数 $\\nabla c \\cdot \\mathbf{n}$ 在边界 $\\partial V$ 上处处为零。因此，右侧的面积分为零，这意味着拉普拉斯算子的体积分为零。\n\n这个性质对我们的离散公式也成立。由于幽灵单元的条件，离散拉普拉斯算子在整个网格上的和是一个可以消掉的伸缩级数。让我们在一维情况下进行演示：\n$$\n\\sum_{i=0}^{N-1} \\mathcal{L}[c]_i = \\frac{1}{\\Delta x^2} \\sum_{i=0}^{N-1} (c_{i+1} - 2c_i + c_{i-1})\n$$\n使用幽灵单元值 $c_{-1}=c_0$ 和 $c_N=c_{N-1}$，这个和可以伸缩相消：\n$$\n\\sum_{i=0}^{N-1} (c_{i+1} - c_i) - (c_i - c_{i-1}) = (c_N - c_{N-1}) - (c_0 - c_{-1}) = (c_{N-1} - c_{N-1}) - (c_0 - c_0) = 0\n$$\n在数值上，这个和应该在机器精度范围内为零。我们通过计算离散积分 $I = \\Delta x^d \\sum_{\\text{grid}} \\mathcal{L}[c]$ 并使用提供的容差检查来验证它是否数值上为零：\n$$\n|I| \\le \\varepsilon \\max\\{1, \\Delta x^d \\sum_{\\text{grid}} |c|\\}\n$$\n其中 $\\varepsilon = 10^{-12}$。该检查稳健地将绝对误差 $|I|$ 与一个随场 $c$ 的量级缩放的阈值进行比较，同时提供了一个最小绝对容差 $\\varepsilon$。\n\n### **3. 实现与求解逻辑**\n\n对每个测试用例，执行以下步骤：\n1.  设置维度 $d$、网格形状以及物理参数 $\\Delta x$ 和 $D$。\n2.  计算最大稳定时间步长 $\\Delta t_{\\mathrm{CFL}} = \\frac{\\Delta x^2}{2 d D}$。\n3.  使用固定的随机种子 $42$ 从 $[0, 1]$ 上的均匀分布中抽样，初始化一个 $d$ 维的浓度值网格 $c$，以确保可复现性。\n4.  实现一个函数来计算网格上的离散拉普拉斯算子 $\\mathcal{L}[c]$。该函数使用填充（`np.pad` 及 `mode='edge'`）来正确处理任意维度下诺伊曼边界条件的幽灵单元。\n5.  计算拉普拉斯算子的离散积分 $I = \\Delta x^d \\sum \\mathcal{L}[c]$。\n6.  评估布尔条件 $|I| \\le 10^{-12} \\max\\{1, \\Delta x^d \\sum |c|\\}$。\n7.  为该测试用例存储配对 $[\\Delta t_{\\mathrm{CFL}}, \\text{布尔结果}]$。\n8.  遍历所有测试用例后，将收集到的结果格式化为指定的输出字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by calculating the CFL time step and checking the \n    conservation property of the discrete Laplacian for several test cases.\n    \"\"\"\n\n    def compute_laplacian(c: np.ndarray, dx: float) - np.ndarray:\n        \"\"\"\n        Computes the discrete Laplacian of a d-dimensional field 'c' with \n        zero-flux Neumann boundary conditions.\n\n        Args:\n            c (np.ndarray): The input concentration field.\n            dx (float): The uniform grid spacing.\n\n        Returns:\n            np.ndarray: The discrete Laplacian of the field.\n        \"\"\"\n        d = c.ndim\n        lap_c = np.zeros_like(c, dtype=np.float64)\n        denom = dx**2\n\n        # Sum the second differences along each dimension\n        for axis in range(d):\n            # Pad the array along the current axis to handle boundaries.\n            # mode='edge' replicates boundary values, implementing the ghost\n            # cell rule c_{-1} = c_0.\n            padding = [(0, 0)] * d\n            padding[axis] = (1, 1)\n            c_padded = np.pad(c, pad_width=padding, mode='edge')\n\n            # Use slicing on the padded array to get neighbors.\n            # These slices are constructed to produce arrays of the same shape as 'c'.\n            slice_plus = [slice(None)] * d\n            slice_plus[axis] = slice(2, None)\n            \n            slice_center = [slice(None)] * d\n            slice_center[axis] = slice(1, -1)\n\n            slice_minus = [slice(None)] * d\n            slice_minus[axis] = slice(0, -2)\n\n            lap_c += (c_padded[tuple(slice_plus)] \n                      - 2 * c_padded[tuple(slice_center)] \n                      + c_padded[tuple(slice_minus)])\n\n        return lap_c / denom\n\n    test_cases = [\n        # Case A: d=1, N=5, dx=2e-5, D=1e-10, lam=0.3, S=0.1\n        {\n            \"d\": 1, \"shape\": (5,), \"dx\": 2e-5, \"D\": 1e-10,\n            \"lambda\": 0.3, \"S\": 0.1\n        },\n        # Case B: d=2, Nx=21, Ny=21, dx=1e-5, D=1e-9, lam=0.5, S=0.2\n        {\n            \"d\": 2, \"shape\": (21, 21), \"dx\": 1e-5, \"D\": 1e-9,\n            \"lambda\": 0.5, \"S\": 0.2\n        },\n        # Case C: d=3, Nx=11, Ny=11, Nz=11, dx=5e-5, D=5e-10, lam=0.05, S=0.0\n        {\n            \"d\": 3, \"shape\": (11, 11, 11), \"dx\": 5e-5, \"D\": 5e-10,\n            \"lambda\": 0.05, \"S\": 0.0\n        },\n        # Case D: d=2, Nx=9, Ny=9, dx=2e-6, D=1e-9, lam=1.0, S=0.0\n        {\n            \"d\": 2, \"shape\": (9, 9), \"dx\": 2e-6, \"D\": 1e-9,\n            \"lambda\": 1.0, \"S\": 0.0\n        },\n    ]\n\n    results = []\n    # Use a fixed random seed for reproducibility.\n    rng = np.random.default_rng(seed=42)\n    \n    for case in test_cases:\n        d = case[\"d\"]\n        shape = case[\"shape\"]\n        dx = case[\"dx\"]\n        D = case[\"D\"]\n        \n        # Task 1: Compute the maximum stable time step (CFL condition)\n        dt_cfl = (dx**2) / (2 * d * D)\n        \n        # Task 2: Check the numerical conservation of the Laplacian\n        \n        # Initialize the concentration field 'c'\n        c = rng.uniform(0, 1, size=shape)\n        \n        # Compute the discrete Laplacian\n        lap_c = compute_laplacian(c, dx)\n        \n        # Compute the discrete integral I\n        volume_element = dx**d\n        laplacian_integral = volume_element * np.sum(lap_c)\n        \n        # Compute the comparison term for the tolerance check\n        norm_c_integral = volume_element * np.sum(np.abs(c))\n        \n        # Check if the integral is numerically zero within the given tolerance\n        epsilon = 1e-12\n        threshold = epsilon * max(1.0, norm_c_integral)\n        is_flux_conservative = np.abs(laplacian_integral) = threshold\n        \n        results.append([dt_cfl, is_flux_conservative])\n\n    # Convert the list of lists to the required string format.\n    # The boilerplate f\"[{','.join(map(str, results))}]\" produces the correct format\n    # which includes spaces after commas within the inner lists, e.g., '[2.0, True]'.\n    final_output_string = f\"[{','.join(map(str, results))}]\"\n    \n    # Print the final output in the required single-line format.\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}