{
    "hands_on_practices": [
        {
            "introduction": "在有限差分法中，精确地施加边界条件至关重要。生物医学输运模型中常见的通量边界条件，要求在区域边界处对导数进行精确近似。本练习将重点使用泰勒级数展开来推导一个高阶单边有限差分格式，掌握此项技术是构建能准确捕捉组织界面药物通量等物理现象的数值方案的基础。",
            "id": "3913384",
            "problem": "一个描述药物经皮渗透进入灌注组织的一维模型由具有一阶清除的扩散偏微分方程（PDE）$u_{t}(x,t) = D\\,u_{xx}(x,t) - k\\,u(x,t)$（对于 $x \\geq 0$）描述，其中 $u(x,t)$ 是归一化的无量纲药物浓度，$D$ 是扩散系数，$k$ 是清除率。在稳态下，空间分布 $u(x)$ 满足常微分方程 $D\\,u_{xx}(x) - k\\,u(x) = 0$。在组织界面 $x=0$ 处的扩散通量通过 Fick 定律 $J(0) = -D\\,u_{x}(0)$ 与生理学耦合，因此需要对 $u_{x}(0)$ 进行精确的数值近似。\n\n考虑一个间距为 $h>0$ 的均匀网格，其网格点为 $x_{0}=0$、$x_{1}=h$ 和 $x_{2}=2h$。仅使用 $u(0)$、$u(h)$ 和 $u(2h)$，从 $u(x)$ 在 $x=0$ 处的泰勒级数展开开始，并通过消除低阶误差项来强制其与导数的定义属性保持一致，推导一个对 $u_{x}(0)$ 的单边有限差分近似，该近似对 $h$ 具有二阶精度。明确求出截断误差的主阶项，此处定义为 $\\tau(h) = u_{x}(0) - \\mathcal{D}_{h}[u]$，其中 $\\mathcal{D}_{h}[u]$ 表示将您的有限差分算子应用于精确解 $u$。\n\n然后，对于解析浓度分布 $u(x) = \\exp(-\\lambda x)$，当 $\\lambda = 5$ 且网格间距 $h = 0.02$ 时，计算截断误差的主阶项 $\\tau(h)$ 的纯数值。将您的最终数值答案四舍五入到 4 位有效数字。",
            "solution": "该问题要求使用网格点 $x_0=0$、$x_1=h$ 和 $x_2=2h$ 处的函数值，为一阶导数 $u_x(0)$ 推导一个单边、二阶精确的有限差分公式。它还要求确定截断误差的主阶项，并针对一个特定的函数和参数对其进行数值计算。\n\n首先，我们推导有限差分近似。设 $u_x(0)$ 的近似表示为 $\\mathcal{D}_h[u]$。我们寻求一个 $u(0)$、$u(h)$ 和 $u(2h)$ 的线性组合，其形式如下：\n$$\n\\mathcal{D}_h[u] = A u(0) + B u(h) + C u(2h)\n$$\n其中 $A$、$B$ 和 $C$ 是待定常数。\n\n为求出这些常数，我们使用 $u(x)$ 在 $x=0$ 处的泰勒级数展开。假设 $u(x)$ 足够光滑，我们有：\n$$\nu(h) = u(0) + h u_x(0) + \\frac{h^2}{2!} u_{xx}(0) + \\frac{h^3}{3!} u_{xxx}(0) + O(h^4)\n$$\n$$\nu(2h) = u(0) + (2h) u_x(0) + \\frac{(2h)^2}{2!} u_{xx}(0) + \\frac{(2h)^3}{3!} u_{xxx}(0) + O(h^4)\n$$\n将这些展开式代入 $\\mathcal{D}_h[u]$ 的表达式中：\n$$\n\\mathcal{D}_h[u] = A u(0) + B\\left(u(0) + h u_x(0) + \\frac{h^2}{2} u_{xx}(0) + \\dots\\right) + C\\left(u(0) + 2h u_x(0) + \\frac{4h^2}{2} u_{xx}(0) + \\dots\\right)\n$$\n我们按 $u$ 在 $x=0$ 处的导数对各项进行分组：\n$$\n\\mathcal{D}_h[u] = (A+B+C)u(0) + (Bh + 2Ch)u_x(0) + \\left(B\\frac{h^2}{2} + C\\frac{4h^2}{2}\\right)u_{xx}(0) + \\dots\n$$\n为了使 $\\mathcal{D}_h[u]$ 成为 $u_x(0)$ 的一个近似，$u_x(0)$ 的系数必须为 $1$，而其他项的系数应为 $0$。为达到二阶精度，误差必须是 $O(h^2)$ 阶的，这意味着 $u(0)$ 和 $u_{xx}(0)$ 的系数必须为零。这给了我们一个关于 $A$、$B$ 和 $C$ 的三元线性方程组：\n1.  $u(0)$ 的系数：$A+B+C = 0$\n2.  $u_x(0)$ 的系数：$Bh + 2Ch = 1 \\implies B + 2C = \\frac{1}{h}$\n3.  $u_{xx}(0)$ 的系数：$B\\frac{h^2}{2} + C\\frac{4h^2}{2} = 0 \\implies B + 4C = 0$\n\n从方程(3)，我们得到 $B = -4C$。将此代入方程(2)：\n$$\n(-4C) + 2C = \\frac{1}{h} \\implies -2C = \\frac{1}{h} \\implies C = -\\frac{1}{2h}\n$$\n现在我们可以求出 $B$：\n$$\nB = -4C = -4\\left(-\\frac{1}{2h}\\right) = \\frac{2}{h}\n$$\n最后，使用方程(1)求出 $A$：\n$$\nA = -B - C = -\\left(\\frac{2}{h}\\right) - \\left(-\\frac{1}{2h}\\right) = -\\frac{4}{2h} + \\frac{1}{2h} = -\\frac{3}{2h}\n$$\n将系数 $A$、$B$ 和 $C$ 代回 $\\mathcal{D}_h[u]$ 的公式，我们得到有限差分近似：\n$$\n\\mathcal{D}_h[u] = -\\frac{3}{2h}u(0) + \\frac{2}{h}u(h) - \\frac{1}{2h}u(2h) = \\frac{-3u(0) + 4u(h) - u(2h)}{2h}\n$$\n\n接下来，我们求截断误差的主阶项，其定义为 $\\tau(h) = u_x(0) - \\mathcal{D}_h[u]$。我们需要将泰勒级数展开到更高一阶的项，这涉及到 $u_{xxx}(0)$：\n$$\nu(h) = u(0) + h u_x(0) + \\frac{h^2}{2} u_{xx}(0) + \\frac{h^3}{6} u_{xxx}(0) + O(h^4)\n$$\n$$\nu(2h) = u(0) + 2h u_x(0) + \\frac{4h^2}{2} u_{xx}(0) + \\frac{8h^3}{6} u_{xxx}(0) + O(h^4)\n$$\n将这些代入推导出的算子 $\\mathcal{D}_h[u]$：\n$$\n\\mathcal{D}_h[u] = \\frac{1}{2h} \\left[ -3u(0) + 4\\left(u(0) + h u_x(0) + \\frac{h^2}{2} u_{xx}(0) + \\frac{h^3}{6} u_{xxx}(0) + \\dots\\right) - \\left(u(0) + 2h u_x(0) + 2h^2 u_{xx}(0) + \\frac{4h^3}{3} u_{xxx}(0) + \\dots\\right) \\right]\n$$\n收集各导数项的系数：\n- 对于 $u(0)$: $\\frac{1}{2h}(-3+4-1) = 0$\n- 对于 $u_x(0)$: $\\frac{1}{2h}(4h - 2h) = \\frac{2h}{2h} = 1$\n- 对于 $u_{xx}(0)$: $\\frac{1}{2h}\\left(4\\frac{h^2}{2} - 2h^2\\right) = 0$\n- 对于 $u_{xxx}(0)$: $\\frac{1}{2h}\\left(4\\frac{h^3}{6} - \\frac{8h^3}{6}\\right) = \\frac{1}{2h}\\left(-\\frac{4h^3}{6}\\right) = -\\frac{2h^3}{6h} = -\\frac{h^2}{3}$\n\n所以，该算子的展开式为：\n$$\n\\mathcal{D}_h[u] = u_x(0) - \\frac{h^2}{3}u_{xxx}(0) + O(h^3)\n$$\n那么截断误差为：\n$$\n\\tau(h) = u_x(0) - \\mathcal{D}_h[u] = u_x(0) - \\left(u_x(0) - \\frac{h^2}{3}u_{xxx}(0) + O(h^3)\\right) = \\frac{h^2}{3}u_{xxx}(0) + O(h^3)\n$$\n截断误差的主阶项是 $\\frac{h^2}{3}u_{xxx}(0)$。这证实了该近似是二阶精确的。\n\n最后，我们对给定的函数 $u(x) = \\exp(-\\lambda x)$（参数为 $\\lambda = 5$ 和 $h = 0.02$）计算这个主阶误差项。我们需要 $u(x)$ 在 $x=0$ 处的三阶导数。\n$$\nu(x) = \\exp(-\\lambda x)\n$$\n$$\nu_x(x) = -\\lambda \\exp(-\\lambda x)\n$$\n$$\nu_{xx}(x) = \\lambda^2 \\exp(-\\lambda x)\n$$\n$$\nu_{xxx}(x) = -\\lambda^3 \\exp(-\\lambda x)\n$$\n在 $x=0$ 处，三阶导数为：\n$$\nu_{xxx}(0) = -\\lambda^3 \\exp(0) = -\\lambda^3\n$$\n现在，将此代入主阶误差项的公式：\n$$\n\\tau(h) \\approx \\frac{h^2}{3}u_{xxx}(0) = -\\frac{h^2 \\lambda^3}{3}\n$$\n代入数值 $\\lambda = 5$ 和 $h = 0.02$：\n$$\n\\tau(0.02) \\approx -\\frac{(0.02)^2 (5)^3}{3} = -\\frac{(4 \\times 10^{-4})(125)}{3} = -\\frac{500 \\times 10^{-4}}{3} = -\\frac{0.05}{3}\n$$\n计算其值：\n$$\n-\\frac{0.05}{3} \\approx -0.016666...\n$$\n四舍五入到 4 位有效数字，我们得到 $-0.01667$。",
            "answer": "$$\\boxed{-0.01667}$$"
        },
        {
            "introduction": "许多生物组织具有异质性，意味着其物理属性（如扩散系数）在空间上是变化的。一个稳健的数值方法必须能处理这种变系数问题。本练习将指导你使用基于调和平均的守恒格式，来离散一个带有可变系数的二维扩散方程，这有助于你理解如何为更真实的异质系统构建隐式有限差分格式，并分析其最终线性系统的结构。",
            "id": "3913347",
            "problem": "考虑在二维空间中对一种可溶性药物在薄而均匀的组织片中的被动输运进行建模。令 $u(x,y,t)$ 表示药物浓度，$D(x,y)$ 表示一个空间变化的有效扩散系数，该系数捕捉了组织的微观结构异质性。在质量守恒和菲克扩散的假设下，浓度根据以下偏微分方程 (PDE) 演化\n$$\nu_{t} = \\nabla \\cdot \\big(D \\nabla u\\big)\n$$\n该方程定义在矩形域 $\\Omega = (0,L_{x}) \\times (0,L_{y})$ 上，边界 $\\partial\\Omega$ 上具有齐次狄利克雷边界条件 $u=0$，并给定初始条件 $u(x,y,0)=u_{0}(x,y)$。你需要推导一个适用于生物医学系统建模中数值模拟的、保守的全隐式时空离散化格式。\n\n设该域被划分为一个均匀的笛卡尔网格，在 $x$ 方向上有 $N_{x}$ 个节点，在 $y$ 方向上有 $N_{y}$ 个节点，间距分别为 $h_{x} = L_{x}/(N_{x}-1)$ 和 $h_{y} = L_{y}/(N_{y}-1)$。用 $u_{i,j}^{n} \\approx u(x_{i},y_{j},t^{n})$ 表示节点未知数，其中 $x_{i} = (i-1)h_{x}$，$y_{j} = (j-1)h_{y}$，对于固定的时间步长 $\\Delta t>0$，$t^{n} = n\\Delta t$。为了在考虑 $D(x,y)$ 异质性的同时近似跨单元面的通量，使用通过相邻节点值的调和平均得到的面心扩散系数，例如：\n$$\nD_{i+\\frac{1}{2},j} = \\left(\\frac{1}{2}\\left(\\frac{1}{D_{i,j}}+\\frac{1}{D_{i+1,j}}\\right)\\right)^{-1} = \\frac{2D_{i,j}D_{i+1,j}}{D_{i,j}+D_{i+1,j}},\n$$\n$D_{i-\\frac{1}{2},j}$、$D_{i,j+\\frac{1}{2}}$ 和 $D_{i,j-\\frac{1}{2}}$ 的定义类似。\n\n从守恒定律和菲克定律出发，并使用保守通量形式的有限差分法 (FDM)，执行以下操作：\n\n- 为内部节点 $(i,j)$（其中 $i\\in\\{2,\\dots,N_{x}-1\\}$, $j\\in\\{2,\\dots,N_{y}-1\\}$）推导全隐式后向欧拉更新格式，用面心通量和 $u^{n+1}$ 的中心差分表示离散散度。\n- 在齐次狄利克雷边界条件下，组装得到的线性系统 $\\mathbf{A}\\mathbf{u}^{n+1}=\\mathbf{b}$，并仔细确定将节点 $(i,j)$ 与其最近邻 $(i\\pm 1,j)$ 和 $(i,j\\pm 1)$ 耦合的模板和系数。\n- 在未知量采用字典序（例如，逐行排序）的情况下，描述矩阵 $\\mathbf{A}$ 的结构，包括其对称性和稀疏模式，用保守通量离散化所产生的五点模板来表示。\n\n最后，提供全隐式格式中对应于一个通用内部节点 $(i,j)$ 的系数矩阵对角元的精确解析表达式，用 $\\Delta t$、$h_{x}$、$h_{y}$ 和面心扩散系数 $D_{i\\pm\\frac{1}{2},j}$、$D_{i,j\\pm\\frac{1}{2}}$ 表示。你的最终答案必须是这个单一的闭式表达式。不需要进行数值计算，最终的方框表达式中不應包含任何单位。",
            "solution": "物理出发点是质量守恒定律和菲克扩散定律。控制体内的质量守恒意味着浓度 $u$ 的变化率等于通量的净流入，因此\n$$\nu_{t} = \\nabla \\cdot \\big(D \\nabla u\\big),\n$$\n其中 $D(x,y)$ 是有效扩散系数。该方程与菲克定律一致，菲克定律指出扩散通量与浓度梯度成正比，即 $\\mathbf{J} = -D \\nabla u$，而守恒定律给出 $u_{t} = -\\nabla \\cdot \\mathbf{J} = \\nabla\\cdot(D\\nabla u)$。\n\n我们在均匀的笛卡尔网格上对 $\\Omega$ 进行离散化，并使用面心通量推导保守的离散散度。定义节点值 $u_{i,j}^{n}$、间距 $h_{x}$、$h_{y}$ 和时间步长 $\\Delta t$。在内部节点 $(i,j)$ 处，考虑一个以 $(x_{i},y_{j})$ 为中心的矩形控制体，其面位于 $x_{i\\pm\\frac{1}{2}} = x_{i}\\pm\\frac{h_{x}}{2}$ 和 $y_{j\\pm\\frac{1}{2}} = y_{j}\\pm\\frac{h_{y}}{2}$。连续散度可以用穿过各个面的净通量除以控制体尺寸来近似。在右侧面，$x$方向上的离散通量为\n$$\nJ_{x}\\big|_{i+\\frac{1}{2},j} = -D_{i+\\frac{1}{2},j}\\,\\frac{u_{i+1,j}-u_{i,j}}{h_{x}},\n$$\n在左侧面\n$$\nJ_{x}\\big|_{i-\\frac{1}{2},j} = -D_{i-\\frac{1}{2},j}\\,\\frac{u_{i,j}-u_{i-1,j}}{h_{x}}.\n$$\n类似地，在 $y$ 方向上，顶部面的通量为\n$$\nJ_{y}\\big|_{i,j+\\frac{1}{2}} = -D_{i,j+\\frac{1}{2}}\\,\\frac{u_{i,j+1}-u_{i,j}}{h_{y}},\n$$\n在底部面\n$$\nJ_{y}\\big|_{i,j-\\frac{1}{2}} = -D_{i,j-\\frac{1}{2}}\\,\\frac{u_{i,j}-u_{i,j-1}}{h_{y}}.\n$$\n这些表达式使用了面心扩散系数 $D_{i\\pm\\frac{1}{2},j}$ 和 $D_{i,j\\pm\\frac{1}{2}}$。为了对具有不连续或急剧变化的 $D$ 的异质组织进行建模，一种保持通量连续性的保守选择是相邻节点扩散系数之间的调和平均，例如：\n$$\nD_{i+\\frac{1}{2},j} = \\left(\\frac{1}{2}\\left(\\frac{1}{D_{i,j}}+\\frac{1}{D_{i+1,j}}\\right)\\right)^{-1} = \\frac{2D_{i,j}D_{i+1,j}}{D_{i,j}+D_{i+1,j}},\n$$\n$D_{i-\\frac{1}{2},j}$、$D_{i,j+\\frac{1}{2}}$ 和 $D_{i,j-\\frac{1}{2}}$ 的定义类似。\n\n根据有限体积的观点，在 $(i,j)$ 处的离散散度是净向外通量除以单元尺寸。使用上述通量，离散空间算子 $\\mathcal{L}[u]_{i,j}$ 为\n$$\n\\mathcal{L}[u]_{i,j} = \\frac{J_{x}\\big|_{i+\\frac{1}{2},j}-J_{x}\\big|_{i-\\frac{1}{2},j}}{h_{x}} + \\frac{J_{y}\\big|_{i,j+\\frac{1}{2}}-J_{y}\\big|_{i,j-\\frac{1}{2}}}{h_{y}}.\n$$\n代入通量定义可得\n\\begin{align*}\n\\mathcal{L}[u]_{i,j}\n= \\frac{1}{h_{x}}\\left( -D_{i+\\frac{1}{2},j}\\,\\frac{u_{i+1,j}-u_{i,j}}{h_{x}} + D_{i-\\frac{1}{2},j}\\,\\frac{u_{i,j}-u_{i-1,j}}{h_{x}} \\right) \\\\\n\\quad + \\frac{1}{h_{y}}\\left( -D_{i,j+\\frac{1}{2}}\\,\\frac{u_{i,j+1}-u_{i,j}}{h_{y}} + D_{i,j-\\frac{1}{2}}\\,\\frac{u_{i,j}-u_{i,j-1}}{h_{y}} \\right) \\\\\n= -\\frac{D_{i+\\frac{1}{2},j}}{h_{x}^{2}} u_{i+1,j} + \\left(\\frac{D_{i+\\frac{1}{2},j}+D_{i-\\frac{1}{2},j}}{h_{x}^{2}}\\right) u_{i,j} - \\frac{D_{i-\\frac{1}{2},j}}{h_{x}^{2}} u_{i-1,j} \\\\\n\\quad -\\frac{D_{i,j+\\frac{1}{2}}}{h_{y}^{2}} u_{i,j+1} + \\left(\\frac{D_{i,j+\\frac{1}{2}}+D_{i,j-\\frac{1}{2}}}{h_{y}^{2}}\\right) u_{i,j} - \\frac{D_{i,j-\\frac{1}{2}}}{h_{y}^{2}} u_{i,j-1}.\n\\end{align*}\n我们现在采用全隐式后向欧拉时间离散化：\n$$\n\\frac{u_{i,j}^{n+1}-u_{i,j}^{n}}{\\Delta t} = \\mathcal{L}[u^{n+1}]_{i,j}.\n$$\n两边乘以 $\\Delta t$ 并将所有包含 $u^{n+1}$ 的项移到左边，我们得到每个内部节点 $(i,j)$ 处的线性系统：\n\\begin{align*}\n\\left( 1 + \\Delta t \\left[ \\frac{D_{i+\\frac{1}{2},j}+D_{i-\\frac{1}{2},j}}{h_{x}^{2}} + \\frac{D_{i,j+\\frac{1}{2}}+D_{i,j-\\frac{1}{2}}}{h_{y}^{2}} \\right] \\right) u_{i,j}^{n+1} \\\\\n\\quad - \\Delta t \\left( \\frac{D_{i+\\frac{1}{2},j}}{h_{x}^{2}} \\right) u_{i+1,j}^{n+1}\n- \\Delta t \\left( \\frac{D_{i-\\frac{1}{2},j}}{h_{x}^{2}} \\right) u_{i-1,j}^{n+1}\n- \\Delta t \\left( \\frac{D_{i,j+\\frac{1}{2}}}{h_{y}^{2}} \\right) u_{i,j+1}^{n+1}\n- \\Delta t \\left( \\frac{D_{i,j-\\frac{1}{2}}}{h_{y}^{2}} \\right) u_{i,j-1}^{n+1}\n= u_{i,j}^{n}.\n\\end{align*}\n在齐次狄利克雷边界条件 $u=0$ on $\\partial\\Omega$ 下，边界节点是已知的，不作为未知数出现在系统中；涉及内部索引集之外的邻居的贡献项会消失，或者在需要时（对于非零边界数据）被并入右侧项。\n\n将未知数 $\\{u_{i,j}^{n+1}\\}$ 按字典序（例如，将 $(i,j)$ 映射到单个索引 $p = (j-1)N_{x} + i$）收集起来，矩阵 $\\mathbf{A}$ 具有一个五点模板：每个内部节点都与自身及其四个最近邻 $(i\\pm 1,j)$ 和 $(i,j\\pm 1)$ 耦合。在 $(i,j)$ 处的对角元是\n$$\na_{i,j} = 1 + \\Delta t \\left( \\frac{D_{i+\\frac{1}{2},j}+D_{i-\\frac{1}{2},j}}{h_{x}^{2}} + \\frac{D_{i,j+\\frac{1}{2}}+D_{i,j-\\frac{1}{2}}}{h_{y}^{2}} \\right),\n$$\n与邻居对应的非对角元是\n\\begin{align*}\na_{i,j;i+1,j} = - \\Delta t \\left( \\frac{D_{i+\\frac{1}{2},j}}{h_{x}^{2}} \\right), \\\\\na_{i,j;i-1,j} = - \\Delta t \\left( \\frac{D_{i-\\frac{1}{2},j}}{h_{x}^{2}} \\right), \\\\\na_{i,j;i,j+1} = - \\Delta t \\left( \\frac{D_{i,j+\\frac{1}{2}}}{h_{y}^{2}} \\right), \\\\\na_{i,j;i,j-1} = - \\Delta t \\left( \\frac{D_{i,j-\\frac{1}{2}}}{h_{y}^{2}} \\right).\n\\end{align*}\n对称性源于当 $D_{i+\\frac{1}{2},j}$ 等于由相同调和平均法则计算的 $D_{i+1/2,j}$ 时，跨共享面的通量贡献在两个相邻方程中以相同的大小出现；因此 $\\mathbf{A}$ 是对称的。对于齐次狄利克雷边界，$\\mathbf{A}$ 也是严格对角占优的，并且由于底层的扩散算子，它是对称正定 (SPD) 的。\n\n因此，所要求的全隐式格式中通用内部节点 $(i,j)$ 的对角元的解析表达式为\n$$\n1 + \\Delta t \\left( \\frac{D_{i+\\frac{1}{2},j}+D_{i-\\frac{1}{2},j}}{h_{x}^{2}} + \\frac{D_{i,j+\\frac{1}{2}}+D_{i,j-\\frac{1}{2}}}{h_{y}^{2}} \\right).\n$$",
            "answer": "$$\\boxed{1 + \\Delta t \\left( \\frac{D_{i+\\frac{1}{2},j}+D_{i-\\frac{1}{2},j}}{h_{x}^{2}} + \\frac{D_{i,j+\\frac{1}{2}}+D_{i,j-\\frac{1}{2}}}{h_{y}^{2}} \\right)}$$"
        },
        {
            "introduction": "在推导出数值格式后，下一步是将其付诸实践并验证其正确性。通过与已知精确解的比较来量化误差，是验证过程中的一个基本环节。此问题要求你实现 Crank-Nicolson 方法，并使用离散的 $L^2$ 和 $H^1$ 范数来计算误差，它们分别衡量解本身及其梯度的误差。这项综合练习连接了理论与实践，提供了编写求解器和评估其性能的第一手经验，这对任何计算建模者来说都是至关重要的。",
            "id": "3913301",
            "problem": "考虑一维无量纲溶质在代表均匀组织的平板中的扩散，其模型建立在空间域 $x \\in (0,1)$ 上，由偏微分方程 (PDE) $u_t = u_{xx}$ 描述，并具有齐次狄利克雷边界条件 $u(0,t) = 0$ 和 $u(1,t) = 0$（对于所有 $t \\ge 0$）。场 $u(x,t)$ 表示无量纲浓度，它是通过将浓度按特征浓度 $C_0$、长度按特征长度 $L$、时间按 $L^2/D_0$（其中 $D_0$ 为参考扩散系数）进行缩放得到的。你必须使用有限差分法，在具有 $N$ 个内部点的均匀空间网格上，并采用 Crank–Nicolson 时间步进格式，对这个初边值问题进行数值求解，直至最终时间 $T$。对于由正弦模态组成的初始条件 $u(x,0) = \\sum_{k} a_k \\sin(k \\pi x)$，其精确解为 $u(x,t) = \\sum_{k} a_k \\exp\\left(- (k \\pi)^2 t\\right) \\sin(k \\pi x)$，你应该使用此精确解作为基准（ground truth），以量化在时间 $T$ 的数值误差。\n\n从质量守恒和菲克第一定律出发，在间距为 $\\Delta x = 1/(N+1)$ 的均匀网格上使用一致的黎曼和近似，推导并实现：\n- 在 $(0,1)$ 上误差 $e(x) = u_{\\text{num}}(x,T) - u_{\\text{exact}}(x,T)$ 的离散 $L^2$ 范数，以及\n- 基于梯度的网格近似，并利用 $x=0$ 和 $x=1$ 处的齐次狄利克雷边界条件，推导并实现误差的离散类 $H^1$ 半范数。\n\n这些离散量的定义必须与连续 $L^2$ 范数 $\\|e\\|_{L^2(0,1)} = \\left(\\int_0^1 e(x)^2 \\, dx\\right)^{1/2}$ 和连续 $H^1$ 半范数 $|e|_{H^1(0,1)} = \\left(\\int_0^1 (e_x(x))^2 \\, dx\\right)^{1/2}$ 相一致。\n\n在时间上使用 Crank–Nicolson 格式，时间步长为均匀的 $\\Delta t$，使得 $M = T/\\Delta t$ 为整数。空间离散化必须在内部点上使用二阶中心差分，并在边界上强制 $u=0$。通过在内部网格点上对给定的初始条件进行采样来初始化数值解。\n\n你必须实现一个单一程序，对于每个测试用例，计算在时间 $T$ 的离散 $L^2$ 误差和离散类 $H^1$ 半范数误差，并以无物理单位（无量纲）的实数形式返回这两个误差。如果涉及角度，必须以弧度为单位进行解释。最终输出必须将所有测试用例的结果聚合到一行中。\n\n需要实现的测试套件：\n- 案例 $1$ (基线，单模态): $N = 64$，$T = 0.05$，$\\Delta t = 0.0005$，初始条件 $u(x,0) = 1.0 \\cdot \\sin(1 \\cdot \\pi x)$。\n- 案例 $2$ (多模态): $N = 64$，$T = 0.02$，$\\Delta t = 0.00025$，初始条件 $u(x,0) = 0.7 \\cdot \\sin(1 \\cdot \\pi x) + 0.3 \\cdot \\sin(2 \\cdot \\pi x)$。\n- 案例 $3$ (粗网格，高阶模态): $N = 8$，$T = 0.005$，$\\Delta t = 0.0005$，初始条件 $u(x,0) = 1.0 \\cdot \\sin(3 \\cdot \\pi x)$。\n- 案例 $4$ (长时间衰减): $N = 64$，$T = 0.5$，$\\Delta t = 0.001$，初始条件 $u(x,0) = 1.0 \\cdot \\sin(4 \\cdot \\pi x)$。\n- 案例 $5$ (近奈奎斯特内容): $N = 32$，$T = 0.005$，$\\Delta t = 0.0001$，初始条件 $u(x,0) = 1.0 \\cdot \\sin(10 \\cdot \\pi x)$。\n\n对于每个案例，计算两个标量输出：在时间 $T$ 的离散 $L^2$ 误差和离散类 $H^1$ 半范数误差，两者均为非负实数。\n\n最终输出格式要求：\n- 你的程序应生成单行输出，其中包含案例结果的列表，每个案例表示为一个二元列表 $[E_{L2},E_{H1}]$。整个输出必须是这些数对的单一列表，不含空格，数字采用小写科学记数法格式，小数点后精确到八位。例如，包含两个案例的输出应如下所示：$[[1.23456789e-04,2.34567891e-03],[\\dots,\\dots],\\dots]$，其中省略号表示其他案例。程序必须精确打印这单行内容。\n\n注意：由于模型是无量纲的，输出中不得报告任何物理单位。所有计算都应是确定性的，使用给定的参数。",
            "solution": "所提出的问题是一个针对一维扩散（热）方程的适定初边值问题。它基于输运现象的基本原理，在数学上是一致的，并且提供了数值求解所需的所有参数。因此，该问题被认为是有效的，并将提供一个解决方案。\n\n任务是求解在空间域 $x \\in (0,1)$ 上，时间 $t \\ge 0$ 的无量纲扩散方程\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial^2 u}{\\partial x^2}\n$$\n边界条件为齐次狄利克雷类型，$u(0,t) = 0$ 和 $u(1,t) = 0$。初始条件以正弦模态之和的形式给出，$u(x,0) = \\sum_{k} a_k \\sin(k \\pi x)$。我们将使用 Crank-Nicolson 有限差分法，然后推导并计算离散误差范数。\n\n### 数值格式：Crank-Nicolson 方法\n\n我们首先对区域进行离散化。空间域 $(0,1)$ 被离散化为 $N+1$ 个等长的子区间，宽度为 $\\Delta x = 1/(N+1)$。这定义了一个包含 $N$ 个内部点 $x_i = i \\Delta x$（$i=1, 2, \\dots, N$）的网格。边界点为 $x_0 = 0$ 和 $x_{N+1} = 1$。时间域以均匀步长 $\\Delta t$ 进行离散化，使得 $t_j = j \\Delta t$。令 $u_i^j \\approx u(x_i, t_j)$ 为网格点 $(x_i, t_j)$ 处解的数值近似。\n\n在网格点 $x_i$ 处的空间二阶导数 $u_{xx}$ 使用二阶中心差分进行近似：\n$$\n\\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{x_i, t_j} \\approx \\frac{u_{i-1}^j - 2u_i^j + u_{i+1}^j}{(\\Delta x)^2}\n$$\n\nCrank-Nicolson 格式使用前向差分来离散化时间导数，并将空间导数近似为它在时间 $t_j$ 和 $t_{j+1}$ 处值的平均值：\n$$\n\\frac{u_i^{j+1} - u_i^j}{\\Delta t} = \\frac{1}{2} \\left( \\frac{u_{i-1}^{j+1} - 2u_i^{j+1} + u_{i+1}^{j+1}}{(\\Delta x)^2} + \\frac{u_{i-1}^{j} - 2u_i^j + u_{i+1}^j}{(\\Delta x)^2} \\right)\n$$\n我们定义参数 $r = \\frac{\\Delta t}{2(\\Delta x)^2}$。我们可以重新整理该方程，将步骤 $j+1$ 的未知项（左侧）与步骤 $j$ 的已知项（右侧）分离开：\n$$\n-r u_{i-1}^{j+1} + (1+2r) u_i^{j+1} - r u_{i+1}^{j+1} = r u_{i-1}^{j} + (1-2r) u_i^j + r u_{i+1}^j\n$$\n该方程对 $N$ 个内部点 $i=1, \\dots, N$ 均有效。边界条件意味着对所有 $j$都有 $u_0^j = 0$ 和 $u_{N+1}^j=0$。\n\n令 $\\mathbf{u}^j = [u_1^j, u_2^j, \\dots, u_N^j]^T$ 为时间 $t_j$ 时内部点解值的向量。该方程组可以写成矩阵形式：\n$$\n\\mathbf{A} \\mathbf{u}^{j+1} = \\mathbf{B} \\mathbf{u}^j\n$$\n其中 $\\mathbf{A}$ 和 $\\mathbf{B}$ 是 $N \\times N$ 的三对角矩阵：\n$$\n\\mathbf{A} = \\begin{pmatrix}\n1+2r  -r  0  \\dots \\\\\n-r  1+2r  -r  \\dots \\\\\n0  \\ddots  \\ddots  \\ddots \\\\\n\\dots  0  -r  1+2r\n\\end{pmatrix}\n\\quad , \\quad\n\\mathbf{B} = \\begin{pmatrix}\n1-2r  r  0  \\dots \\\\\nr  1-2r  r  \\dots \\\\\n0  \\ddots  \\ddots  \\ddots \\\\\n\\dots  0  r  1-2r\n\\end{pmatrix}\n$$\n为了将解从时间 $t_j$推进到 $t_{j+1}$，我们求解线性系统 $\\mathbf{A} \\mathbf{u}^{j+1} = \\mathbf{b}^j$，其中 $\\mathbf{b}^j = \\mathbf{B} \\mathbf{u}^j$。由于 $\\mathbf{A}$ 是对称、正定且三对角的，这个系统可以非常高效地求解。\n\n### 离散误差范数的推导\n\n在最终时间 $T$ 的误差为 $e(x) = u_{\\text{num}}(x,T) - u_{\\text{exact}}(x,T)$。令 $e_i = e(x_i)$ 为内部网格点 $i=1, \\dots, N$ 处的误差。边界条件确保误差在边界处为零，因此 $e_0 = e(x_0) = 0$ 且 $e_{N+1} = e(x_{N+1}) = 0$。\n\n**离散 $L^2$ 范数**\n\n连续 $L^2$ 范数由积分 $\\|e\\|_{L^2(0,1)} = \\left(\\int_0^1 e(x)^2 \\, dx\\right)^{1/2}$ 定义。我们使用内部网格点上的黎曼和来近似这个积分。每个网格点 $x_i$ 可被看作代表一个宽度为 $\\Delta x$ 的单元。该积分近似为：\n$$\n\\int_0^1 e(x)^2 \\, dx \\approx \\sum_{i=1}^{N} e(x_i)^2 \\Delta x = \\Delta x \\sum_{i=1}^{N} e_i^2\n$$\n这导出了误差的离散 $L^2$ 范数的定义：\n$$\nE_{L2} = \\|e\\|_{\\text{discrete } L^2} = \\left(\\Delta x \\sum_{i=1}^{N} e_i^2\\right)^{1/2}\n$$\n用误差向量 $\\mathbf{e} = [e_1, \\dots, e_N]^T$ 表示，这即是 $\\sqrt{\\Delta x} \\|\\mathbf{e}\\|_2$，其中 $\\|\\cdot\\|_2$ 是标准的欧几里得向量范数。\n\n**离散类 $H^1$ 半范数**\n\n连续 $H^1$ 半范数涉及空间导数：$|e|_{H^1(0,1)} = \\left(\\int_0^1 (e_x(x))^2 \\, dx\\right)^{1/2}$，其中 $e_x = \\partial e / \\partial x$。这个积分与扩散通量的能量有关，根据菲克定律，扩散通量与浓度梯度成正比。我们首先近似导数 $e_x$。一个一致的选择是使用在网格点之间居中的一阶有限差分。在中点 $x_{i+1/2} = (x_i+x_{i+1})/2$ 处，导数近似为：\n$$\ne_x(x_{i+1/2}) \\approx \\frac{e_{i+1} - e_i}{\\Delta x}\n$$\n我们有 $N+1$ 个这样的中点，对应 $i = 0, \\dots, N$。然后，我们使用中点法则求积，对这 $N+1$ 个区间进行求和，来近似 $(e_x)^2$ 的积分：\n$$\n\\int_0^1 (e_x(x))^2 \\, dx \\approx \\sum_{i=0}^{N} \\left( e_x(x_{i+1/2}) \\right)^2 \\Delta x \\approx \\sum_{i=0}^{N} \\left( \\frac{e_{i+1} - e_i}{\\Delta x} \\right)^2 \\Delta x = \\frac{1}{\\Delta x} \\sum_{i=0}^{N} (e_{i+1} - e_i)^2\n$$\n给定边界条件，$e_0 = e_{N+1} = 0$。由此产生的误差的离散类 $H^1$ 半范数为：\n$$\nE_{H1} = |e|_{\\text{discrete } H^1} = \\left(\\frac{1}{\\Delta x} \\sum_{i=0}^{N} (e_{i+1} - e_i)^2\\right)^{1/2}\n$$\n\n### 实现\n求解数值解的过程是：首先通过在内部网格点上对给定的初始条件 $u(x,0)$ 进行采样来设置初始状态向量 $\\mathbf{u}^0$。然后，对于直至最终时间 $T$ 的每个时间步，求解三对角系统 $\\mathbf{A} \\mathbf{u}^{j+1} = \\mathbf{B} \\mathbf{u}^j$ 以得到 $\\mathbf{u}^{j+1}$。最终的数值解向量为 $u_{\\text{num}}(x_i, T)$。精确解也在相同的网格点和时间点上进行评估。计算误差向量，并使用推导出的公式计算两个离散范数 $E_{L2}$ 和 $E_{H1}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Solves the 1D diffusion equation using the Crank-Nicolson method for several\n    test cases and computes L2 and H1-seminorm errors.\n    \"\"\"\n    \n    test_cases = [\n        # Case 1: (N, T, dt, initial_condition_modes)\n        (64, 0.05, 0.0005, [(1.0, 1)]),\n        # Case 2\n        (64, 0.02, 0.00025, [(0.7, 1), (0.3, 2)]),\n        # Case 3\n        (8, 0.005, 0.0005, [(1.0, 3)]),\n        # Case 4\n        (64, 0.5, 0.001, [(1.0, 4)]),\n        # Case 5\n        (32, 0.005, 0.0001, [(1.0, 10)])\n    ]\n    \n    results = []\n\n    for N, T, dt, ic_modes in test_cases:\n        \n        # 1. Grid and parameter setup\n        dx = 1.0 / (N + 1)\n        x_interior = np.linspace(dx, 1.0 - dx, N)\n        M = int(round(T / dt))\n\n        # 2. Define initial and exact solution functions\n        def u_initial(x, modes):\n            res = np.zeros_like(x, dtype=float)\n            for a, k in modes:\n                res += a * np.sin(k * np.pi * x)\n            return res\n\n        def u_exact(x, t, modes):\n            res = np.zeros_like(x, dtype=float)\n            for a, k in modes:\n                res += a * np.exp(-(k * np.pi)**2 * t) * np.sin(k * np.pi * x)\n            return res\n\n        # 3. Crank-Nicolson solver setup\n        r = dt / (2.0 * dx**2)\n        \n        # Matrix A (LHS) in banded format for scipy.linalg.solve_banded\n        # (1, 1) indicates 1 lower and 1 upper diagonal\n        ab_A = np.zeros((3, N))\n        ab_A[0, 1:] = -r       # Upper diagonal\n        ab_A[1, :] = 1.0 + 2.0 * r # Main diagonal\n        ab_A[2, :-1] = -r      # Lower diagonal\n\n        # Initialize solution vector\n        u_current = u_initial(x_interior, ic_modes)\n        \n        # 4. Time stepping loop\n        for _ in range(M):\n            # Construct RHS vector b = B @ u_current\n            # B is tridiagonal with (r, 1-2r, r)\n            b = np.zeros(N)\n            # Interior points of the vector\n            if N > 2:\n                b[1:-1] = r * u_current[:-2] + (1.0 - 2.0 * r) * u_current[1:-1] + r * u_current[2:]\n            # Endpoints of the vector (handles N=1 and N=2 cases correctly)\n            if N >= 1:\n                b[0] = (1.0 - 2.0 * r) * u_current[0]\n                if N > 1:\n                    b[0] += r * u_current[1]\n            if N >= 2:\n                b[-1] = r * u_current[-2] + (1.0 - 2.0 * r) * u_current[-1]\n            \n            # Solve the tridiagonal system A * u_next = b\n            u_next = solve_banded((1, 1), ab_A, b)\n            u_current = u_next\n        \n        u_final_numeric = u_current\n        \n        # 5. Error calculation\n        u_final_exact = u_exact(x_interior, T, ic_modes)\n        error_vec = u_final_numeric - u_final_exact\n        \n        # 6. Compute discrete norms\n        # L2 norm\n        l2_error = np.sqrt(dx * np.sum(error_vec**2))\n        \n        # H1-like seminorm\n        # Need to include boundary points (error is 0 there)\n        error_vec_full = np.concatenate(([0.0], error_vec, [0.0]))\n        error_diffs = np.diff(error_vec_full)\n        h1_seminorm_error = np.sqrt(np.sum(error_diffs**2) / dx)\n        \n        results.append([l2_error, h1_seminorm_error])\n\n    # 7. Final print statement in the exact required format\n    output_str = \",\".join([f\"[{l2:.8e},{h1:.8e}]\" for l2, h1 in results])\n    print(f\"[{output_str}]\")\n\nsolve()\n```"
        }
    ]
}