{
    "hands_on_practices": [
        {
            "introduction": "Tau-leaping方法的核心在于巧妙地选择时间步长 $\\tau$。这个选择必须在模拟速度和精度之间取得平衡，即 $\\tau$ 要足够大以实现加速，又要足够小以保证反应倾向性在步长内近似恒定。本练习将引导你推导并应用一种标准的自适应 $\\tau$ 选择方法，该方法通过控制每个物种数量的相对变化来确保模拟的准确性 。",
            "id": "3935710",
            "problem": "考虑一个由化学主方程（CME）建模的充分混合的生化系统，该系统通过随机模拟算法（SSA）进行模拟。该系统由三种分子种类组成，其离散的拷贝数分别表示为 $X_{A}$、$X_{B}$ 和 $X_{C}$，它们在质量作用动力学下经历两个反应通道：\n$$\nR_{1}: A + B \\to C, \\quad R_{2}: C \\to A + B\n$$\n令反应 $j$ 的化学计量变化向量为 $\\boldsymbol{\\nu}_{j} = (\\nu_{jA}, \\nu_{jB}, \\nu_{jC})$，其中 $j \\in \\{1,2\\}$。在质量作用动力学下，反应 $j$ 的倾向函数为 $a_{j}(\\boldsymbol{X}) = c_{j} h_{j}(\\boldsymbol{X})$，其中 $c_{j} > 0$ 是速率常数，$h_{j}(\\boldsymbol{X})$ 计算了与化学计量要求一致的不同反应物组合的数量。对于上述反应，这得到\n$$\na_{1}(\\boldsymbol{X}) = c_{1} X_{A} X_{B}, \\quad a_{2}(\\boldsymbol{X}) = c_{2} X_{C}.\n$$\n在用于加速随机模拟的 $\\tau$-跳跃近似中，选择一个跳跃间隔 $\\tau > 0$，使得每个倾向函数在 $[t, t+\\tau)$ 区间内保持近似恒定，这可以通过限制每种分子数量相对于其当前值的期望涨落和典型涨落来实现。\n\n从将 $\\tau$-跳跃定义为一种近似方法开始，其中反应 $j$ 在 $[t, t+\\tau)$ 内的发生次数被建模为一个均值为 $a_{j}(\\boldsymbol{X})\\,\\tau$ 的泊松随机变量，通过要求每种分子 $i \\in \\{A,B,C\\}$ 的相对变化的均值和方差贡献都受一个预设容差 $\\epsilon \\in (0,1)$ 的限制，推导 $\\tau$ 的一个自适应上界，该上界用分子数量 $\\boldsymbol{X}$、化学计量系数 $\\nu_{ji}$ 和质量作用倾向 $a_{j}(\\boldsymbol{X})$ 表示。\n\n然后，对于状态\n$$\nX_{A} = 120, \\quad X_{B} = 80, \\quad X_{C} = 30,\n$$\n速率常数为\n$$\nc_{1} = 1.0 \\times 10^{-4} \\ \\text{s}^{-1}, \\quad c_{2} = 5.0 \\times 10^{-2} \\ \\text{s}^{-1},\n$$\n且容差为\n$$\n\\epsilon = 0.05,\n$$\n计算满足您推导出的界限的相应自适应 $\\tau$。您的最终答案以秒为单位，并四舍五入到四位有效数字。",
            "solution": "我们从化学主方程（CME）的角度开始，其中状态 $\\boldsymbol{X}(t)$ 作为一个连续时间马尔可夫跳跃过程演化。在 $\\tau$-跳跃近似下，当跳跃条件成立时（即倾向函数在短时间内保持近似恒定），反应 $j$ 在时间间隔 $[t,t+\\tau)$ 内的发生次数可以近似为一个泊松随机变量 $P_{j}(\\tau)$，其均值为 $a_{j}(\\boldsymbol{X}(t))\\,\\tau$。\n\n令反应 $j$ 的化学计量变化向量为 $\\boldsymbol{\\nu}_{j} = (\\nu_{jA}, \\nu_{jB}, \\nu_{jC})$，因此在跳跃间隔内种类 $i$ 的净变化为\n$$\n\\Delta X_{i}(\\tau) = \\sum_{j} \\nu_{ji} P_{j}(\\tau).\n$$\n因为 $P_{j}(\\tau)$ 是参数为 $a_{j}(\\boldsymbol{X})\\,\\tau$ 的（近似）独立的泊松随机变量，它们的均值和方差为\n$$\n\\mathbb{E}[P_{j}(\\tau)] = a_{j}(\\boldsymbol{X})\\,\\tau, \\quad \\mathrm{Var}[P_{j}(\\tau)] = a_{j}(\\boldsymbol{X})\\,\\tau.\n$$\n因此，对于每种分子 $i$，其净变化的均值和方差为\n$$\n\\mathbb{E}[\\Delta X_{i}(\\tau)] = \\sum_{j} \\nu_{ji} \\, \\mathbb{E}[P_{j}(\\tau)] = \\left( \\sum_{j} \\nu_{ji} a_{j}(\\boldsymbol{X}) \\right) \\tau \\equiv \\mu_{i}(\\boldsymbol{X}) \\, \\tau,\n$$\n$$\n\\mathrm{Var}[\\Delta X_{i}(\\tau)] = \\sum_{j} \\nu_{ji}^{2} \\, \\mathrm{Var}[P_{j}(\\tau)] = \\left( \\sum_{j} \\nu_{ji}^{2} a_{j}(\\boldsymbol{X}) \\right) \\tau \\equiv \\sigma_{i}^{2}(\\boldsymbol{X}) \\, \\tau,\n$$\n这里利用了独立性以及对于独立的 $Z_{j}$，有 $\\mathrm{Var}\\left(\\sum_{j} Z_{j}\\right)=\\sum_{j} \\mathrm{Var}(Z_{j})$ 这一事实。\n\n为了维持跳跃条件，一个常见的标准是，将每种分子 $i$ 的期望相对变化和典型涨落的度量（通过方差）都限制在一个小容差 $\\epsilon \\in (0,1)$ 内。具体来说，我们强制要求\n$$\n\\frac{|\\mathbb{E}[\\Delta X_{i}(\\tau)]|}{X_{i}} \\le \\epsilon, \\quad \\frac{\\sqrt{\\mathrm{Var}[\\Delta X_{i}(\\tau)]}}{X_{i}} \\le \\epsilon,\n$$\n对所有分子种类 $i$ 成立。代入均值和方差的表达式可得\n$$\n\\frac{|\\mu_{i}(\\boldsymbol{X})|\\,\\tau}{X_{i}} \\le \\epsilon \\quad \\Rightarrow \\quad \\tau \\le \\frac{\\epsilon X_{i}}{|\\mu_{i}(\\boldsymbol{X})|},\n$$\n以及\n$$\n\\frac{\\sqrt{\\sigma_{i}^{2}(\\boldsymbol{X})\\,\\tau}}{X_{i}} \\le \\epsilon \\quad \\Rightarrow \\quad \\sqrt{\\tau} \\le \\frac{\\epsilon X_{i}}{\\sqrt{\\sigma_{i}^{2}(\\boldsymbol{X})}} \\quad \\Rightarrow \\quad \\tau \\le \\frac{(\\epsilon X_{i})^{2}}{\\sigma_{i}^{2}(\\boldsymbol{X})}.\n$$\n为了对所有分子种类都满足这两个约束，因此 $\\tau$ 的自适应上界为\n$$\n\\tau \\le \\min_{i} \\left\\{ \\min \\left( \\frac{\\epsilon X_{i}}{|\\mu_{i}(\\boldsymbol{X})|}, \\ \\frac{(\\epsilon X_{i})^{2}}{\\sigma_{i}^{2}(\\boldsymbol{X})} \\right) \\right\\},\n$$\n其中\n$$\n\\mu_{i}(\\boldsymbol{X}) = \\sum_{j} \\nu_{ji} a_{j}(\\boldsymbol{X}), \\quad \\sigma_{i}^{2}(\\boldsymbol{X}) = \\sum_{j} \\nu_{ji}^{2} a_{j}(\\boldsymbol{X}).\n$$\n这就将自适应 $\\tau$ 界限表示为了分子数量 $X_{i}$、化学计量系数 $\\nu_{ji}$ 和质量作用倾向 $a_{j}(\\boldsymbol{X})$ 的函数。\n\n我们现在为这个特定系统计算 $\\tau$。化学计量为\n$$\n\\boldsymbol{\\nu}_{1} = (-1, -1, +1), \\quad \\boldsymbol{\\nu}_{2} = (+1, +1, -1).\n$$\n在给定状态和速率常数下的倾向函数为\n$$\na_{1}(\\boldsymbol{X}) = c_{1} X_{A} X_{B} = \\left(1.0 \\times 10^{-4}\\right) \\cdot 120 \\cdot 80 = 0.96,\n$$\n$$\na_{2}(\\boldsymbol{X}) = c_{2} X_{C} = \\left(5.0 \\times 10^{-2}\\right) \\cdot 30 = 1.5.\n$$\n计算每种分子的 $\\mu_{i}(\\boldsymbol{X})$：\n$$\n\\mu_{A} = \\nu_{1A} a_{1} + \\nu_{2A} a_{2} = (-1)\\cdot 0.96 + (+1)\\cdot 1.5 = 0.54,\n$$\n$$\n\\mu_{B} = \\nu_{1B} a_{1} + \\nu_{2B} a_{2} = (-1)\\cdot 0.96 + (+1)\\cdot 1.5 = 0.54,\n$$\n$$\n\\mu_{C} = \\nu_{1C} a_{1} + \\nu_{2C} a_{2} = (+1)\\cdot 0.96 + (-1)\\cdot 1.5 = -0.54.\n$$\n计算每种分子的 $\\sigma_{i}^{2}(\\boldsymbol{X})$（注意化学计量系数的平方）：\n$$\n\\sigma_{A}^{2} = \\nu_{1A}^{2} a_{1} + \\nu_{2A}^{2} a_{2} = (1)\\cdot 0.96 + (1)\\cdot 1.5 = 2.46,\n$$\n$$\n\\sigma_{B}^{2} = \\nu_{1B}^{2} a_{1} + \\nu_{2B}^{2} a_{2} = (1)\\cdot 0.96 + (1)\\cdot 1.5 = 2.46,\n$$\n$$\n\\sigma_{C}^{2} = \\nu_{1C}^{2} a_{1} + \\nu_{2C}^{2} a_{2} = (1)\\cdot 0.96 + (1)\\cdot 1.5 = 2.46.\n$$\n当 $\\epsilon = 0.05$ 时，针对各种分子的约束为：\n\n对于分子 A ($X_{A} = 120$)：\n$$\n\\frac{\\epsilon X_{A}}{|\\mu_{A}|} = \\frac{0.05 \\cdot 120}{0.54} = \\frac{6}{0.54} \\approx 11.111111\\ldots,\n$$\n$$\n\\frac{(\\epsilon X_{A})^{2}}{\\sigma_{A}^{2}} = \\frac{(6)^{2}}{2.46} = \\frac{36}{2.46} \\approx 14.634146\\ldots,\n$$\n因此 $\\tau_{A} \\le \\min(11.111111\\ldots, 14.634146\\ldots) = 11.111111\\ldots$。\n\n对于分子 B ($X_{B} = 80$)：\n$$\n\\frac{\\epsilon X_{B}}{|\\mu_{B}|} = \\frac{0.05 \\cdot 80}{0.54} = \\frac{4}{0.54} \\approx 7.407407\\ldots,\n$$\n$$\n\\frac{(\\epsilon X_{B})^{2}}{\\sigma_{B}^{2}} = \\frac{(4)^{2}}{2.46} = \\frac{16}{2.46} \\approx 6.504065\\ldots,\n$$\n因此 $\\tau_{B} \\le \\min(7.407407\\ldots, 6.504065\\ldots) = 6.504065\\ldots$。\n\n对于分子 C ($X_{C} = 30$)：\n$$\n\\frac{\\epsilon X_{C}}{|\\mu_{C}|} = \\frac{0.05 \\cdot 30}{0.54} = \\frac{1.5}{0.54} \\approx 2.777777\\ldots,\n$$\n$$\n\\frac{(\\epsilon X_{C})^{2}}{\\sigma_{C}^{2}} = \\frac{(1.5)^{2}}{2.46} = \\frac{2.25}{2.46} \\approx 0.914634\\ldots,\n$$\n因此 $\\tau_{C} \\le \\min(2.777777\\ldots, 0.914634\\ldots) = 0.914634\\ldots$。\n\n为了同时满足所有分子的条件，我们必须取\n$$\n\\tau \\le \\min\\left( \\tau_{A}, \\tau_{B}, \\tau_{C} \\right) = 0.914634\\ldots \\ \\text{秒}.\n$$\n因此，在此界限下选择的自适应 $\\tau$ 是\n$$\n\\tau = 0.914634\\ldots \\ \\text{秒}.\n$$\n四舍五入到四位有效数字，可得\n$$\n\\tau \\approx 0.9146 \\ \\text{秒}.\n$$",
            "answer": "$$\\boxed{0.9146}$$"
        },
        {
            "introduction": "在掌握了如何构建一个既能自适应调控时间步长又能避免负数种群的稳健tau-leaping算法后，我们面临一个终极问题：它何时才真正优于精确但缓慢的随机模拟算法（SSA）？这个高级练习将此比较形式化，通过在固定的计算预算下分析两种方法的统计效率来回答这个问题。它为“我们为什么以及何时应该使用tau-leaping近似”提供了定量的答案 。",
            "id": "3935678",
            "problem": "考虑在生物化学反应网络建模中常用的迁入-死亡生灭过程：一个物种的计数为 $X(t) \\in \\mathbb{Z}_{\\ge 0}$，根据反应演化，其倾向函数为 $a_1(x) = \\lambda$（迁入或出生）和 $a_2(x) = \\mu x$（死亡），其中 $\\lambda$ 和 $\\mu$ 是单位为 $s^{-1}$ 的正常数。该过程是一个连续时间马尔可夫链（CTMC），并且对于 $\\mu > 0$ 是遍历的。假设系统在其稳态分布下被初始化。\n\n在固定的计算预算 $B$（以任意操作单位计）下，考虑稳态均值 $m = \\mathbb{E}[X]$ 的两种估计量：\n- 在随机模拟算法（SSA）下，定义在模拟时域 $T$（单位：秒）内的连续时间平均估计量 $\\bar{X}_T = \\frac{1}{T} \\int_0^T X(t) \\, dt$。在稳态下，单位时间的期望反应事件数为 $\\mathbb{E}[a_1(X) + a_2(X)] = \\lambda + \\mu \\mathbb{E}[X]$，总计算成本与事件数量成正比，即 $C_{\\text{SSA}} \\approx c_{\\text{SSA}} \\times \\text{(事件数)}$，其中 $c_{\\text{SSA}}$ 是每个事件的成本（单位：操作数）。将 $C_{\\text{SSA}}$ 等同于预算 $B$ 以确定 SSA 下的 $T$。\n- 在 tau-跳跃法下，定义离散时间样本均值估计量 $\\hat{X}_M = \\frac{1}{M} \\sum_{k=1}^M X(k \\tau)$，使用固定的跳跃步长 $\\tau$（单位：秒）和在时域 $T = M \\tau$ 内观察到的 $M$ 步。tau-跳跃法的计算成本与步数成正比，即 $C_{\\text{TL}} \\approx c_{\\text{TL}} \\times M$，其中 $c_{\\text{TL}}$ 是每次跳跃的成本（单位：操作数）。将 $C_{\\text{TL}}$ 等同于预算 $B$ 以确定 tau-跳跃法下的 $M$（并因此确定 $T$）。\n\n从适用于生物医学系统建模的基本原理出发：\n- 迁入-死亡 CTMC 的化学主方程（CME），\n- 线性生灭过程的稳态性和遍历性，\n- 自协方差 $C(t) = \\mathrm{Cov}(X(t), X(0))$ 的定义及其在时间平均估计量方差中的作用，通过连续采样的积分自相关和格点采样的离散自相关求和，\n\n推导每个估计量方差的闭式大时域近似表达式，用 $\\lambda$、$\\mu$、$\\tau$、$c_{\\text{SSA}}$、$c_{\\text{TL}}$ 和 $B$ 表示。然后，对于相同的预算 $B$，确定哪种方法产生的方差更小，从而“获胜”。\n\n所有与时间相关的量都必须以秒为单位处理。方差值必须以分子数平方（无量纲计数单位）的实数形式报告。此问题不涉及角度。任何比率都应表示为小数。\n\n您的程序必须实现推导出的公式，并为以下参数集的测试套件生成结果，涵盖典型、慢/快动态以及成本对比场景。每个测试用例是一个元组 $(\\lambda, \\mu, \\tau, c_{\\text{SSA}}, c_{\\text{TL}}, B)$，其中 $\\lambda$ 和 $\\mu$ 的单位是 $s^{-1}$，$\\tau$ 的单位是 $s$，$c_{\\text{SSA}}$ 和 $c_{\\text{TL}}$ 的单位是操作数/事件（或跳跃），$B$ 的单位是操作数：\n- 测试用例 1：$(\\lambda, \\mu, \\tau, c_{\\text{SSA}}, c_{\\text{TL}}, B) = ($$10$, $$1$, $$0.1$, $$1$, $$1$, $$10^{6}$$)$\n- 测试用例 2：$(\\lambda, \\mu, \\tau, c_{\\text{SSA}}, c_{\\text{TL}}, B) = ($$0.5$, $$0.1$, $$0.05$, $$1$, $$1$, $$5 \\times 10^{5}$$)$\n- 测试用例 3：$(\\lambda, \\mu, \\tau, c_{\\text{SSA}}, c_{\\text{TL}}, B) = ($$50$, $$5$, $$0.2$, $$1$, $$0.2$, $$5 \\times 10^{6}$$)$\n- 测试用例 4：$(\\lambda, \\mu, \\tau, c_{\\text{SSA}}, c_{\\text{TL}}, B) = ($$1$, $$10$, $$0.05$, $$1$, $$1$, $$2 \\times 10^{6}$$)$\n- 测试用例 5：$(\\lambda, \\mu, \\tau, c_{\\text{SSA}}, c_{\\text{TL}}, B) = ($$100$, $$1$, $$2.0$, $$1$, $$0.1$, $$10^{7}$$)$\n\n对于每个测试用例，计算：\n- 根据推导的大时域公式计算的 SSA 估计量方差。\n- 根据推导的大时域公式计算的 tau-跳跃法估计量方差。\n- 一个布尔值，指示在该情况下 tau-跳跃法是否产生比 SSA 严格更小的方差。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。此顶层列表的每个元素对应一个测试用例，并且本身必须是 $[$$v_{\\text{SSA}}$$,$$v_{\\text{TL}}$$,$$w$$]$ 形式的列表，其中 $v_{\\text{SSA}}$ 和 $v_{\\text{TL}}$ 是浮点数，$w$ 是布尔值。例如，输出格式必须类似于 $[[$$0.12$$,$$0.08$$,$$True$$],[$$...$$]]$。",
            "solution": "目标是推导并比较在固定计算预算下，一个迁入-死亡过程稳态均值的两种估计量的方差。这两种估计量分别是来自随机模拟算法（SSA）的连续时间平均值，以及来自 tau-跳跃法（TL）的离散时间样本均值。\n\n该过程由以下反应定义：\n$$ \\emptyset \\xrightarrow{\\lambda} X $$\n$$ X \\xrightarrow{\\mu} \\emptyset $$\n倾向函数为 $a_1(x) = \\lambda$ 和 $a_2(x) = \\mu x$。参数 $\\lambda$ 和 $\\mu$ 是单位为 $s^{-1}$ 的正常数速率常数（其中 $\\lambda$ 的单位隐含为 分子数 $\\cdot s^{-1}$）。\n\n**1. 迁入-死亡过程的稳态性质**\n\n该过程的稳态分布 $P_s(x)$ 通过求解稳态下的化学主方程（$\\frac{d P(x,t)}{dt} = 0$）得到。解是一个泊松分布：\n$$ P_s(x) = \\frac{(\\lambda/\\mu)^x e^{-\\lambda/\\mu}}{x!} $$\n稳态均值 $m = \\mathbb{E}[X]$ 和方差 $\\sigma^2 = \\mathrm{Var}(X)$ 由泊松分布的性质给出：\n$$ m = \\mathbb{E}[X] = \\frac{\\lambda}{\\mu} $$\n$$ \\sigma^2 = \\mathrm{Var}(X) = \\frac{\\lambda}{\\mu} $$\n虽然方差的形式单位是（计数）$^2$，但对于泊松过程，其数值与均值相等。我们假设系统在此稳态下初始化并保持在该状态。\n\n**2. 自协方差函数**\n\n对于一个稳态过程，自协方差函数 $C(t) = \\mathrm{Cov}(X(t), X(0))$ 描述了过程在时间延迟为 $t$ 时的自身相关性。对于像这样的线性生灭过程，以初始状态 $X(0)$ 为条件的过程均值根据以下方程演化：\n$$ \\frac{d\\mathbb{E}[X(t)|X(0)]}{dt} = \\lambda - \\mu \\mathbb{E}[X(t)|X(0)] $$\n该微分方程的解为 $\\mathbb{E}[X(t)|X(0)] = \\frac{\\lambda}{\\mu} + (X(0) - \\frac{\\lambda}{\\mu})e^{-\\mu t}$。\n然后，自协方差计算如下：\n$$ C(t) = \\mathrm{Cov}(\\mathbb{E}[X(t)|X(0)], X(0)) = \\mathrm{Cov}\\left(\\frac{\\lambda}{\\mu} + \\left(X(0) - \\frac{\\lambda}{\\mu}\\right)e^{-\\mu t}, X(0)\\right) $$\n利用协方差的性质，上式简化为：\n$$ C(t) = e^{-\\mu t} \\mathrm{Cov}(X(0), X(0)) = e^{-\\mu t} \\mathrm{Var}(X) $$\n代入稳态方差 $\\mathrm{Var}(X) = \\lambda/\\mu$，我们得到自协方差函数：\n$$ C(t) = \\frac{\\lambda}{\\mu} e^{-\\mu t} $$\n\n**3. SSA 估计量的方差**\n\nSSA 估计量是连续时间平均 $\\bar{X}_T = \\frac{1}{T} \\int_0^T X(t) \\, dt$。对于一个大的模拟时域 $T$，此估计量对稳态过程的方差由下式给出：\n$$ \\mathrm{Var}(\\bar{X}_T) \\approx \\frac{2}{T} \\int_0^\\infty C(s) \\, ds $$\n我们首先计算积分自协方差：\n$$ \\int_0^\\infty C(s) \\, ds = \\int_0^\\infty \\frac{\\lambda}{\\mu} e^{-\\mu s} \\, ds = \\frac{\\lambda}{\\mu} \\left[ -\\frac{1}{\\mu} e^{-\\mu s} \\right]_0^\\infty = \\frac{\\lambda}{\\mu^2} $$\n因此，方差为 $\\mathrm{Var}(\\bar{X}_T) \\approx \\frac{2\\lambda}{T\\mu^2}$。\n\n计算预算 $B$ 通过成本模型 $C_{\\text{SSA}} \\approx c_{\\text{SSA}} \\times (\\text{事件数}) = B$ 与模拟时间 $T$ 相关。在稳态下，期望的总反应速率为 $\\mathbb{E}[a_1(X) + a_2(X)] = \\mathbb{E}[\\lambda + \\mu X] = \\lambda + \\mu(\\lambda/\\mu) = 2\\lambda$。\n在时域 $T$ 内的期望事件数为 $2\\lambda T$。因此成本为 $B = c_{\\text{SSA}} (2\\lambda T)$，这给出了模拟时间：\n$$ T = \\frac{B}{2\\lambda c_{\\text{SSA}}} $$\n将这个 $T$ 代入方差表达式，得到 SSA 估计量方差 $v_{\\text{SSA}}$ 的最终公式：\n$$ v_{\\text{SSA}} = \\mathrm{Var}(\\bar{X}_T) \\approx \\frac{2\\lambda}{\\mu^2} \\left( \\frac{1}{B / (2\\lambda c_{\\text{SSA}})} \\right) = \\frac{4 c_{\\text{SSA}} \\lambda^2}{B \\mu^2} $$\n\n**4. Tau-跳跃法估计量的方差**\n\ntau-跳跃法估计量是离散时间样本均值 $\\hat{X}_M = \\frac{1}{M} \\sum_{k=1}^M X(k\\tau)$。对于大量的步数 $M$，其方差由下式给出：\n$$ \\mathrm{Var}(\\hat{X}_M) \\approx \\frac{1}{M} \\left[ C(0) + 2 \\sum_{k=1}^\\infty C(k\\tau) \\right] $$\n使用 $C(t) = \\frac{\\lambda}{\\mu}e^{-\\mu t}$，求和部分是一个几何级数：\n$$ \\sum_{k=1}^\\infty C(k\\tau) = \\sum_{k=1}^\\infty \\frac{\\lambda}{\\mu} e^{-\\mu k \\tau} = \\frac{\\lambda}{\\mu} \\sum_{k=1}^\\infty (e^{-\\mu\\tau})^k = \\frac{\\lambda}{\\mu} \\frac{e^{-\\mu\\tau}}{1 - e^{-\\mu\\tau}} $$\n将此结果与 $C(0) = \\lambda/\\mu$ 一同代入方差公式：\n$$ \\mathrm{Var}(\\hat{X}_M) \\approx \\frac{1}{M} \\left[ \\frac{\\lambda}{\\mu} + 2 \\frac{\\lambda}{\\mu} \\frac{e^{-\\mu\\tau}}{1-e^{-\\mu\\tau}} \\right] = \\frac{\\lambda}{M\\mu} \\left[ \\frac{1-e^{-\\mu\\tau} + 2e^{-\\mu\\tau}}{1-e^{-\\mu\\tau}} \\right] = \\frac{\\lambda}{M\\mu} \\left( \\frac{1+e^{-\\mu\\tau}}{1-e^{-\\mu\\tau}} \\right) $$\n计算成本为 $C_{\\text{TL}} = c_{\\text{TL}} M = B$，所以跳跃次数为 $M = B/c_{\\text{TL}}$。代入 $M$ 得到 tau-跳跃法估计量方差 $v_{\\text{TL}}$ 的最终公式：\n$$ v_{\\text{TL}} = \\mathrm{Var}(\\hat{X}_M) \\approx \\frac{c_{\\text{TL}}}{B} \\frac{\\lambda}{\\mu} \\left( \\frac{1+e^{-\\mu\\tau}}{1-e^{-\\mu\\tau}} \\right) $$\n\n**用于实现的最终公式**\n\n用问题参数表示的估计量方差为：\n- SSA 方差：$v_{\\text{SSA}} = \\frac{4 c_{\\text{SSA}} \\lambda^2}{B \\mu^2}$\n- Tau-跳跃法方差：$v_{\\text{TL}} = \\frac{c_{\\text{TL}} \\lambda}{B \\mu} \\left( \\frac{1+e^{-\\mu\\tau}}{1-e^{-\\mu\\tau}} \\right)$\n\n这些公式将被实现，以评估给定测试用例的估计量。如果 $v_{\\text{TL}}  v_{\\text{SSA}}$，则 tau-跳跃法“获胜”。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries outside the Python standard library are permitted.\n\ndef solve():\n    \"\"\"\n    Derives and compares the estimator variances for the immigration-death process\n    under SSA and tau-leaping for a fixed computational budget.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (lambda, mu, tau, c_SSA, c_TL, B)\n    test_cases = [\n        (10.0, 1.0, 0.1, 1.0, 1.0, 1e6),\n        (0.5, 0.1, 0.05, 1.0, 1.0, 5e5),\n        (50.0, 5.0, 0.2, 1.0, 0.2, 5e6),\n        (1.0, 10.0, 0.05, 1.0, 1.0, 2e6),\n        (100.0, 1.0, 2.0, 1.0, 0.1, 1e7)\n    ]\n\n    results = []\n    for case in test_cases:\n        lambda_val, mu_val, tau_val, c_ssa, c_tl, B_val = case\n\n        # Calculate SSA estimator variance\n        # Formula: v_SSA = (4 * c_SSA * lambda^2) / (B * mu^2)\n        v_ssa = (4.0 * c_ssa * lambda_val**2) / (B_val * mu_val**2)\n\n        # Calculate tau-leaping estimator variance\n        # Formula: v_TL = (c_TL * lambda / (B * mu)) * (1 + exp(-mu*tau)) / (1 - exp(-mu*tau))\n        mu_tau = mu_val * tau_val\n        \n        # Handle the case where 1 - exp(-mu*tau) is very close to zero, though\n        # with mu > 0 and tau > 0, this won't happen.\n        if mu_tau == 0:\n            # This corresponds to coth(x) ~ 1/x for small x, which leads to infinite variance.\n            # In practice, mu and tau are positive, so this is just a safeguard.\n            v_tl = float('inf') \n        else:\n            exp_term = np.exp(-mu_tau)\n            correlation_factor = (1.0 + exp_term) / (1.0 - exp_term)\n            v_tl = (c_tl * lambda_val / (B_val * mu_val)) * correlation_factor\n\n        # Determine which method wins (has strictly smaller variance)\n        winner_is_tl = v_tl  v_ssa\n        \n        # Append the results for this case in the specified format [v_ssa, v_tl, is_tl_winner]\n        results.append([v_ssa, v_tl, winner_is_tl])\n\n    # Format the final output string as a list of lists.\n    # The required format is `[[v_ssa_1,v_tl_1,win_1],[v_ssa_2,v_tl_2,win_2],...]`\n    # The default string representation of a list of lists in Python matches this.\n    result_strings = []\n    for res in results:\n        # Manually format to ensure standard representation of floats and booleans.\n        result_strings.append(f\"[{res[0]},{res[1]},{str(res[2])}]\")\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        }
    ]
}