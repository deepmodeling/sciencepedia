{
    "hands_on_practices": [
        {
            "introduction": "第一个练习将带您完成粒子滤波器的基本更新步骤。通过手动计算一小组粒子的重要性权重和最终的后验均值估计，您将具体理解来自观测的新信息如何通过重新加权粒子来修正系统状态的估计。该练习是序贯重要性采样方法的基石。 ",
            "id": "3917036",
            "problem": "一位生物医学工程师正在使用粒子滤波来估计一名1型糖尿病患者在使用连续血糖监测仪（CGM）进行常规监测期间的血浆葡萄糖浓度。隐藏状态 $x_t$ 表示时间 $t$ 时的血浆葡萄糖浓度，单位为 mg/dL，观测模型由一个具有已知传感器噪声方差的高斯似然指定。该工程师已经执行了预测步骤，并生成了一个带有相应先验权重的粒子集。时间 $t$ 的观测值是单个CGM读数，目标是计算归一化重要性权重和血浆葡萄糖的滤波后验均值。生理学背景是符合实际的：由于传感器噪声和校准不确定性，CGM传感器在真实血浆葡萄糖值附近表现出近似高斯分布的测量误差，其标准差已知。\n\n使用以下科学上合理的数据：\n- 粒子数 $N$ 为 $5$。\n- 预测的粒子状态（单位 mg/dL）：$x_t^{(1)} = 140$, $x_t^{(2)} = 148$, $x_t^{(3)} = 152$, $x_t^{(4)} = 160$, $x_t^{(5)} = 172$。\n- 先验权重（总和为 $1$）：$w_{t-1}^{(1)} = 0.10$, $w_{t-1}^{(2)} = 0.25$, $w_{t-1}^{(3)} = 0.30$, $w_{t-1}^{(4)} = 0.20$, $w_{t-1}^{(5)} = 0.15$。\n- 时间 $t$ 的观测值（CGM读数，单位 mg/dL）：$y_t = 154$。\n- 测量噪声标准差：$\\sigma_v = 6$ mg/dL，似然 $p(y_t \\mid x_t)$ 建模为以 $x_t$ 为中心、方差为 $\\sigma_v^2$ 的高斯分布。\n\n从贝叶斯推断和粒子滤波中序贯重要性采样的基本原理出发，计算：\n1. 对于 $i = 1, \\dots, N$，使用测量似然和先验权重计算未归一化的重要性权重 $\\tilde{w}_t^{(i)}$。\n2. 将每个 $\\tilde{w}_t^{(i)}$ 除以所有粒子的总和，得到归一化权重 $\\bar{w}_t^{(i)}$。\n3. 滤波后验均值 $\\hat{x}_t = \\sum_{i=1}^{N} \\bar{w}_t^{(i)} x_t^{(i)}$。\n\n然后，相对于典型的血糖目标，对 $\\hat{x}_t$ 的值给出一个简短的临床解释。以 mg/dL 为单位表示 $\\hat{x}_t$ 的最终数值，并将答案四舍五入到四位有效数字。最终的方框答案必须只包含数值，不带单位。",
            "solution": "该问题具有科学依据，提法恰当，客观，并包含计算唯一且有意义解所需的所有必要信息。它代表了序贯重要性采样（粒子滤波的核心）在一个现实的生物医学状态估计任务中的标准应用。所有提供的数据在物理上和生理上都是合理的。因此，该问题被认为是有效的。\n\n目标是使用粒子滤波计算隐藏状态——血浆葡萄糖浓度 $x_t$ 的滤波后验均值。给定一个包含 $N=5$ 个粒子的集合 $\\{x_t^{(i)}\\}_{i=1}^N$，这些粒子代表了从预测状态分布 $p(x_t \\mid y_{1:t-1})$ 中抽取的样本。每个粒子都有一个相关的先验权重 $w_{t-1}^{(i)}$，对于一个除了状态转移模型外没有特定提议分布的标准粒子滤波器，该权重是从前一时间步的后验权重继承而来的，并满足 $\\sum_{i=1}^N w_{t-1}^{(i)} = 1$。在接收到新的测量值 $y_t$ 后，我们根据贝叶斯法则更新这些权重。\n\n给定截至时间 $t$ 的所有观测值，状态 $x_t$ 的后验分布由贝叶斯定理给出：\n$$p(x_t \\mid y_{1:t}) \\propto p(y_t \\mid x_t) p(x_t \\mid y_{1:t-1})$$\n这里，$p(y_t \\mid x_t)$ 是似然，$p(x_t \\mid y_{1:t-1})$ 是先验（或预测）分布。在粒子滤波器中，先验分布由加权的粒子集近似表示：\n$$p(x_t \\mid y_{1:t-1}) \\approx \\sum_{i=1}^N w_{t-1}^{(i)} \\delta(x_t - x_t^{(i)})$$\n其中 $\\delta(\\cdot)$ 是狄拉克δ函数。\n\n更新步骤涉及为每个粒子计算新的重要性权重。第 $i$ 个粒子的未归一化重要性权重 $\\tilde{w}_t^{(i)}$ 通过将其先验权重与给定该粒子状态下的观测似然相乘来计算：\n$$ \\tilde{w}_t^{(i)} = w_{t-1}^{(i)} p(y_t \\mid x_t^{(i)}) $$\n似然 $p(y_t \\mid x_t)$ 被建模为均值为 $x_t$、方差为 $\\sigma_v^2$ 的高斯分布。其概率密度函数为：\n$$p(y_t \\mid x_t^{(i)}) = \\frac{1}{\\sqrt{2\\pi\\sigma_v^2}} \\exp\\left(-\\frac{(y_t - x_t^{(i)})^2}{2\\sigma_v^2}\\right)$$\n常数项 $\\frac{1}{\\sqrt{2\\pi\\sigma_v^2}}$ 是所有粒子的一个公共缩放因子，在计算中间的未归一化权重时可以省略，因为它将在归一化步骤中被抵消。因此，我们可以计算成比例的未归一化权重为 $\\tilde{w}_t^{(i)} \\propto w_{t-1}^{(i)} \\exp\\left(-\\frac{(y_t - x_t^{(i)})^2}{2\\sigma_v^2}\\right)$。\n\n给定的数据是：\n- 粒子数：$N = 5$。\n- 粒子状态（mg/dL）：$x_t^{(1)} = 140$, $x_t^{(2)} = 148$, $x_t^{(3)} = 152$, $x_t^{(4)} = 160$, $x_t^{(5)} = 172$。\n- 先验权重：$w_{t-1}^{(1)} = 0.10$, $w_{t-1}^{(2)} = 0.25$, $w_{t-1}^{(3)} = 0.30$, $w_{t-1}^{(4)} = 0.20$, $w_{t-1}^{(5)} = 0.15$。\n- 观测值（mg/dL）：$y_t = 154$。\n- 测量噪声标准差（mg/dL）：$\\sigma_v = 6$，所以方差为 $\\sigma_v^2 = 36$。\n\n**1. 计算未归一化重要性权重 $\\tilde{w}_t^{(i)}$**\n\n我们为每个粒子计算指数项 $-\\frac{(y_t - x_t^{(i)})^2}{2\\sigma_v^2} = -\\frac{(154 - x_t^{(i)})^2}{72}$。\n- 对于 $i=1$: $-\\frac{(154 - 140)^2}{72} = -\\frac{14^2}{72} = -\\frac{196}{72} = -\\frac{49}{18}$。\n- 对于 $i=2$: $-\\frac{(154 - 148)^2}{72} = -\\frac{6^2}{72} = -\\frac{36}{72} = -0.5$。\n- 对于 $i=3$: $-\\frac{(154 - 152)^2}{72} = -\\frac{2^2}{72} = -\\frac{4}{72} = -\\frac{1}{18}$。\n- 对于 $i=4$: $-\\frac{(154 - 160)^2}{72} = -\\frac{(-6)^2}{72} = -\\frac{36}{72} = -0.5$。\n- 对于 $i=5$: $-\\frac{(154 - 172)^2}{72} = -\\frac{(-18)^2}{72} = -\\frac{324}{72} = -4.5$。\n\n现在，我们计算未归一化的权重，$\\tilde{w}_t^{(i)} \\propto w_{t-1}^{(i)} \\exp(\\dots)$:\n- $\\tilde{w}_t^{(1)} \\propto 0.10 \\times \\exp(-49/18) \\approx 0.10 \\times 0.065733 = 0.0065733$\n- $\\tilde{w}_t^{(2)} \\propto 0.25 \\times \\exp(-0.5) \\approx 0.25 \\times 0.606531 = 0.1516328$\n- $\\tilde{w}_t^{(3)} \\propto 0.30 \\times \\exp(-1/18) \\approx 0.30 \\times 0.945959 = 0.2837877$\n- $\\tilde{w}_t^{(4)} \\propto 0.20 \\times \\exp(-0.5) \\approx 0.20 \\times 0.606531 = 0.1213062$\n- $\\tilde{w}_t^{(5)} \\propto 0.15 \\times \\exp(-4.5) \\approx 0.15 \\times 0.011109 = 0.0016664$\n\n**2. 计算归一化权重 $\\bar{w}_t^{(i)}$**\n\n首先，将未归一化的权重求和以找到归一化常数：\n$$ S = \\sum_{j=1}^{N} \\tilde{w}_t^{(j)} \\approx 0.0065733 + 0.1516328 + 0.2837877 + 0.1213062 + 0.0016664 \\approx 0.5649664 $$\n接下来，通过除以总和 $S$ 来归一化每个权重：$\\bar{w}_t^{(i)} = \\frac{\\tilde{w}_t^{(i)}}{S}$。\n- $\\bar{w}_t^{(1)} = \\frac{0.0065733}{0.5649664} \\approx 0.0116348$\n- $\\bar{w}_t^{(2)} = \\frac{0.1516328}{0.5649664} \\approx 0.2683931$\n- $\\bar{w}_t^{(3)} = \\frac{0.2837877}{0.5649664} \\approx 0.5023101$\n- $\\bar{w}_t^{(4)} = \\frac{0.1213062}{0.5649664} \\approx 0.2147139$\n- $\\bar{w}_t^{(5)} = \\frac{0.0016664}{0.5649664} \\approx 0.0029496$\n这些归一化权重的总和约等于1，符合预期。\n\n**3. 计算滤波后验均值 $\\hat{x}_t$**\n\n滤波后验均值提供了时间 $t$ 的最终状态估计，它是使用新的归一化权重对粒子状态进行的加权平均：\n$$ \\hat{x}_t = \\sum_{i=1}^{N} \\bar{w}_t^{(i)} x_t^{(i)} $$\n代入数值：\n$$ \\hat{x}_t \\approx (0.0116348 \\times 140) + (0.2683931 \\times 148) + (0.5023101 \\times 152) + (0.2147139 \\times 160) + (0.0029496 \\times 172) $$\n$$ \\hat{x}_t \\approx 1.628872 + 39.722179 + 76.351135 + 34.354224 + 0.507331 $$\n$$ \\hat{x}_t \\approx 152.563741 $$\n四舍五入到四位有效数字，滤波后验均值为 $152.6$ mg/dL。\n\n**临床解释**\n\n血浆葡萄糖浓度的滤波估计值为 $\\hat{x}_t \\approx 152.6$ mg/dL。该值代表了模型对真实血糖水平的最佳估计，它融合了先验预测（由初始加权粒子代表）和新的CGM测量值 $y_t=154$ mg/dL。该估计值与测量值非常接近，因为预测步骤中最可能的粒子 $x_t^{(3)}=152$ mg/dL（其具有最高的先验权重 $w_{t-1}^{(3)} = 0.30$）也最接近新的观测值。这种高先验置信度和高似然的组合导致该粒子获得了非常大的后验权重（$\\bar{w}_t^{(3)} \\approx 0.50$），从而极大地影响了后验均值。\n\n在临床背景下，152.6 mg/dL的血糖水平被认为是轻度升高（轻度高血糖）。根据美国糖尿病协会的建议，糖尿病患者的典型血糖目标通常是餐前80-130 mg/dL，餐后一到两小时低于180 mg/dL。该估计值落在可接受的餐后范围内，但高于餐前目标，表明该个体的血糖有偏高趋势，但尚未达到需要立即警惕的水平。与单独的原始传感器读数相比，此滤波估计提供了对血糖状态更稳健的描述，因为它融合了关于系统动态和过去状态的知识。",
            "answer": "$$\\boxed{152.6}$$"
        },
        {
            "introduction": "在任何实际应用中，直接通过指数运算计算权重可能会因数值下溢而失败，尤其是在处理信息量大的数据时。本练习介绍了一项关键技术，即“对数-和-指数”（log-sum-exp）技巧，用于在不损失精度的情况下稳健地归一化权重。掌握这种方法对于构建可靠的粒子滤波器至关重要。 ",
            "id": "3917055",
            "problem": "在一个用于估计潜在血浆葡萄糖浓度的临床验证葡萄糖-胰岛素最小模型中，使用粒子滤波器（Particle Filter, PF）。假设在时间 $t$，一组 $N=4$ 个粒子在结合了带噪声的连续血糖监测读数的似然之后，累积了未归一化的对数权重 $\\ell_t^{(i)}=\\log \\tilde{w}_t^{(i)}$。归一化权重 $\\bar{w}_t^{(i)}$ 必须满足 $\\bar{w}_t^{(i)} \\propto \\exp\\{\\ell_t^{(i)}\\}$ 和 $\\sum_{i=1}^{N} \\bar{w}_t^{(i)}=1$。由于序列长且测量信息丰富，对数权重可能为非常大的负数。您观察到以下值：\n- $\\ell_t^{(1)}=-1200.0$，\n- $\\ell_t^{(2)}=-1198.0$，\n- $\\ell_t^{(3)}=-1205.0$，\n- $\\ell_t^{(4)}=-1199.5$。\n\n在标准双精度算术中，对 $\\ell_t^{(i)}$ 直接进行指数运算会发生下溢。请仅从归一化重要性权重的定义以及“一个分数的分子和分母同乘以一个正常数，其值不变”这一要求出发，推导一种从 $\\ell_t^{(i)}$ 计算 $\\bar{w}_t^{(i)}$ 且能避免下溢的数值稳定方法。然后，利用该推论，确定以下哪个选项既 (i) 正确描述了植根于这些原则的数值稳定过程，又 (ii) 针对给定的 $\\ell_t^{(i)}$ 得出了正确的归一化权重数值（四舍五入到3位有效数字）。\n\nA. 令 $a=\\max_{i}\\ell_t^{(i)}$，构建平移后的对数权重 $u^{(i)}=\\ell_t^{(i)}-a$，计算 $s=\\sum_{j=1}^{N}\\exp\\{u^{(j)}\\}$，并设置 $\\bar{w}_t^{(i)}=\\exp\\{u^{(i)}\\}/s$。等效地，计算对数归一化因子 $\\log Z=a+\\log\\big(\\sum_{j=1}^{N}\\exp\\{\\ell_t^{(j)}-a\\}\\big)$，然后设置 $\\bar{w}_t^{(i)}=\\exp\\{\\ell_t^{(i)}-\\log Z\\}$。对于给定的 $\\ell_t^{(i)}$，这会得到 $\\big(0.0996,\\;0.7359,\\;0.000671,\\;0.164\\big)$。\n\nB. 通过对数权重的均值 $\\bar{\\ell}=\\frac{1}{N}\\sum_{j=1}^{N}\\ell_t^{(j)}$ 对其进行中心化，得到 $v^{(i)}=\\ell_t^{(i)}-\\bar{\\ell}$，求幂得到 $r^{(i)}=\\exp\\{v^{(i)}\\}$，并定义 $\\bar{w}_t^{(i)}=r^{(i)}/N$，因为围绕均值进行中心化可以控制尺度，而除以 $N$ 可以强制执行平均。\n\nC. 使用恒等式 $\\bar{w}_t^{(i)}=\\exp\\{\\ell_t^{(i)}\\}/\\sum_{j=1}^{N}\\ell_t^{(j)}$，用对数权重之和替换可能不稳定的指数和，以避免下溢，这样可以在不需要重新缩放的情况下稳定分母。\n\nD. 为避免下溢，将每个 $\\ell_t^{(i)}$ 在一个阈值以下进行裁剪（例如，将所有 $\\ell_t^{(i)}-700$ 的值设为 $-700$），对裁剪后的值求幂，并按其总和进行归一化；这样可以丢弃极不可能的粒子，并在无需任何额外转换的情况下稳定指数运算。\n\n选择唯一的最佳选项。",
            "solution": "首先对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n- 在一个葡萄糖-胰岛素最小模型中，使用粒子滤波器 (PF) 进行状态估计。\n- 粒子数量为 $N=4$。\n- 时间 $t$ 的未归一化对数权重如下：\n  - $\\ell_t^{(1)} = -1200.0$\n  - $\\ell_t^{(2)} = -1198.0$\n  - $\\ell_t^{(3)} = -1205.0$\n  - $\\ell_t^{(4)} = -1199.5$\n  其中 $\\ell_t^{(i)} = \\log \\tilde{w}_t^{(i)}$ 且 $\\tilde{w}_t^{(i)}$ 是未归一化的权重。\n- 归一化权重 $\\bar{w}_t^{(i)}$ 必须满足两个条件：\n  1. 比例性：$\\bar{w}_t^{(i)} \\propto \\exp\\{\\ell_t^{(i)}\\}$\n  2. 总和为一：$\\sum_{i=1}^{N} \\bar{w}_t^{(i)} = 1$\n- 陈述了一个数值问题：在标准双精度算术中，对 $\\ell_t^{(i)}$ 直接求幂会导致下溢。\n- 任务是基于归一化权重的定义以及一个分数的分子和分母同乘以一个相同的正常数其值不变的性质，推导一种计算 $\\bar{w}_t^{(i)}$ 的数值稳定方法。\n- 最后，根据所描述过程的正确性和计算出的数值的准确性（四舍五入到3位有效数字），评估给定的选项。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题在计算统计学及其在生物医学系统建模中的应用方面有充分的依据。粒子滤波、重要性权重、对数权重以及归一化的数值挑战（log-sum-exp 技巧）都是该领域的标准和基本概念。\n- **定义明确**：问题定义清晰。给定的对数权重和归一化定义唯一地确定了归一化权重。问题要求对一种稳定的计算方法及其应用进行有原则的推导，这是一项定义明确的任务。\n- **客观性**：所有信息均以客观的数学术语提供。没有歧义或主观性。\n\n### 步骤 3：结论与行动\n问题陈述是有效的。它在科学上是合理的，定义明确且客观。我将继续进行推导和求解。\n\n### 数值稳定方法的推导\n\n第 $i$ 个粒子的归一化重要性权重定义为其未归一化权重与所有未归一化权重之和的比率：\n$$ \\bar{w}_t^{(i)} = \\frac{\\tilde{w}_t^{(i)}}{\\sum_{j=1}^{N} \\tilde{w}_t^{(j)}} $$\n给定对数权重 $\\ell_t^{(i)} = \\log \\tilde{w}_t^{(i)}$，我们有 $\\tilde{w}_t^{(i)} = \\exp\\{\\ell_t^{(i)}\\}$。将其代入定义可得：\n$$ \\bar{w}_t^{(i)} = \\frac{\\exp\\{\\ell_t^{(i)}\\}}{\\sum_{j=1}^{N} \\exp\\{\\ell_t^{(j)}\\}} $$\n正如问题所述，对于大的负值 $\\ell_t^{(j)}$（例如 $-1200.0$），在标准浮点算术中，$\\exp\\{\\ell_t^{(j)}\\}$ 项将计算为零（下溢）。如果所有项都下溢，将导致除以零。\n\n为解决此问题，我们利用一个原理：一个分数的值在分子和分母同乘以一个相同的正常数（比如 $C$）时保持不变。\n$$ \\bar{w}_t^{(i)} = \\frac{C \\cdot \\exp\\{\\ell_t^{(i)}\\}}{C \\cdot \\sum_{j=1}^{N} \\exp\\{\\ell_t^{(j)}\\}} = \\frac{C \\cdot \\exp\\{\\ell_t^{(i)}\\}}{\\sum_{j=1}^{N} (C \\cdot \\exp\\{\\ell_t^{(j)}\\})} $$\n让我们选择一个对指数参数有用的常数 $C$ 的形式。令 $C = \\exp\\{-a\\}$，其中 $a$ 是某个实数。\n$$ \\bar{w}_t^{(i)} = \\frac{\\exp\\{-a\\} \\cdot \\exp\\{\\ell_t^{(i)}\\}}{\\sum_{j=1}^{N} (\\exp\\{-a\\} \\cdot \\exp\\{\\ell_t^{(j)}\\})} = \\frac{\\exp\\{\\ell_t^{(i)} - a\\}}{\\sum_{j=1}^{N} \\exp\\{\\ell_t^{(j)} - a\\}} $$\n对于任何 $a$，这个变换都是精确的。为确保数值稳定性，我们必须选择 $a$ 以使指数的参数 $\\ell_t^{(j)} - a$ 不会是大的负数。一个稳健的选择是平移所有对数权重，使最大值变为零。这可以通过将 $a$ 设置为所有对数权重的最大值来实现：\n$$ a = \\max_{j=1, \\dots, N} \\ell_t^{(j)} $$\n通过这种选择，具有最大对数权重的粒子的新指数为 $a - a = 0$，因此其对应的项 $\\exp\\{a-a\\}$ 为 $\\exp\\{0\\} = 1$。所有其他指数 $\\ell_t^{(j)} - a$ 将小于或等于零，因此它们的指数值将在 $0$ 和 $1$ 之间。这可以防止上溢（因为指数是非正的）和整个和的下溢（因为至少有一项是 $1$）。这通常被称为 log-sum-exp 技巧。\n\n### 数值计算\n\n让我们将此过程应用于给定的对数权重：\n$\\ell_t^{(1)}=-1200.0$, $\\ell_t^{(2)}=-1198.0$, $\\ell_t^{(3)}=-1205.0$, $\\ell_t^{(4)}=-1199.5$。\n\n1.  找到最大对数权重：\n    $$ a = \\max\\{-1200.0, -1198.0, -1205.0, -1199.5\\} = -1198.0 $$\n2.  计算平移后的对数权重，$u^{(i)} = \\ell_t^{(i)} - a$：\n    - $u^{(1)} = -1200.0 - (-1198.0) = -2.0$\n    - $u^{(2)} = -1198.0 - (-1198.0) = 0.0$\n    - $u^{(3)} = -1205.0 - (-1198.0) = -7.0$\n    - $u^{(4)} = -1199.5 - (-1198.0) = -1.5$\n3.  计算经过指数运算的平移对数权重之和，$s = \\sum_{j=1}^{N} \\exp\\{u^{(j)}\\}$：\n    $$ s = \\exp\\{-2.0\\} + \\exp\\{0.0\\} + \\exp\\{-7.0\\} + \\exp\\{-1.5\\} $$\n    使用计算器：\n    $$ s \\approx 0.135335 + 1.0 + 0.000912 + 0.223130 \\approx 1.359377 $$\n4.  计算归一化权重 $\\bar{w}_t^{(i)} = \\exp\\{u^{(i)}\\} / s$，并四舍五入到3位有效数字：\n    - $\\bar{w}_t^{(1)} = \\frac{\\exp\\{-2.0\\}}{s} \\approx \\frac{0.135335}{1.359377} \\approx 0.0995568 \\rightarrow 0.0996$\n    - $\\bar{w}_t^{(2)} = \\frac{\\exp\\{0.0\\}}{s} \\approx \\frac{1.0}{1.359377} \\approx 0.7356333 \\rightarrow 0.736$\n    - $\\bar{w}_t^{(3)} = \\frac{\\exp\\{-7.0\\}}{s} \\approx \\frac{0.000912}{1.359377} \\approx 0.0006708 \\rightarrow 0.000671$\n    - $\\bar{w}_t^{(4)} = \\frac{\\exp\\{-1.5\\}}{s} \\approx \\frac{0.223130}{1.359377} \\approx 0.1641390 \\rightarrow 0.164$\n\n正确计算出的归一化权重，四舍五入到3位有效数字，大约是 $(0.0996, 0.736, 0.000671, 0.164)$。\n\n### 逐项分析选项\n\n**A. 令 $a=\\max_{i}\\ell_t^{(i)}$，构建平移后的对数权重 $u^{(i)}=\\ell_t^{(i)}-a$，计算 $s=\\sum_{j=1}^{N}\\exp\\{u^{(j)}\\}$，并设置 $\\bar{w}_t^{(i)}=\\exp\\{u^{(i)}\\}/s$。等效地，计算对数归一化因子 $\\log Z=a+\\log\\big(\\sum_{j=1}^{N}\\exp\\{\\ell_t^{(j)}-a\\}\\big)$，然后设置 $\\bar{w}_t^{(i)}=\\exp\\{\\ell_t^{(i)}-\\log Z\\}$。对于给定的 $\\ell_t^{(i)}$，这会得到 $\\big(0.0996,\\;0.7359,\\;0.000671,\\;0.164\\big)$。**\n\n- **过程**：所描述的过程正是从第一性原理推导出的 log-sum-exp 方法。所提出的两种表述都是实现这种稳定归一化的正确方法。\n- **数值**：提供的值是 $\\big(0.0996,\\;0.7359,\\;0.000671,\\;0.164\\big)$。与我计算出的值 $\\big(0.0996,\\;0.736,\\;0.000671,\\;0.164\\big)$ 相比，四个值中有三个完全匹配。第二个值 $\\bar{w}_t^{(2)}$ 给出的是 $0.7359$（精确到4位有效数字），而四舍五入到3位有效数字的正确值是 $0.736$。这似乎是选项文本中的一个小错误或印刷错误。\n- **结论**：**正确**。所描述的过程是合理且有原则的。尽管在一个数值上存在微小的差异，但这个选项远远优于其他描述了根本性错误方法的选项。它是“唯一的最佳选项”。\n\n**B. 通过对数权重的均值 $\\bar{\\ell}=\\frac{1}{N}\\sum_{j=1}^{N}\\ell_t^{(j)}$ 对其进行中心化，得到 $v^{(i)}=\\ell_t^{(i)}-\\bar{\\ell}$，求幂得到 $r^{(i)}=\\exp\\{v^{(i)}\\}$，并定义 $\\bar{w}_t^{(i)}=r^{(i)}/N$，因为围绕均值进行中心化可以控制尺度，而除以 $N$ 可以强制执行平均。**\n\n- **过程**：这个过程在数学上是不正确的。归一化的正确分母是经过指数运算的平移对数权重之和，即 $\\sum_{j=1}^N \\exp\\{v^{(j)}\\}$，而不是粒子数 $N$。$\\sum_{j=1}^N \\exp\\{v^{(j)}\\} = N$ 这一陈述通常不成立。\n- **结论**：**不正确**。\n\n**C. 使用恒等式 $\\bar{w}_t^{(i)}=\\exp\\{\\ell_t^{(i)}\\}/\\sum_{j=1}^{N}\\ell_t^{(j)}$，用对数权重之和替换可能不稳定的指数和，以避免下溢，这样可以在不需要重新缩放的情况下稳定分母。**\n\n- **过程**：所提出的“恒等式”是错误的。它错误地将权重之和 $\\sum_{j=1}^N \\tilde{w}_t^{(j)} = \\sum_{j=1}^N \\exp\\{\\ell_t^{(j)}\\}$ 替换为对数权重之和 $\\sum_{j=1}^N \\ell_t^{(j)}$。这两个量是不相等的。这是一个根本性的数学错误。\n- **结论**：**不正确**。\n\n**D. 为避免下溢，将每个 $\\ell_t^{(i)}$ 在一个阈值以下进行裁剪（例如，将所有 $\\ell_t^{(i)}-700$ 的值设为 $-700$），对裁剪后的值求幂，并按其总和进行归一化；这样可以丢弃极不可能的粒子，并在无需任何额外转换的情况下稳定指数运算。**\n\n- **过程**：该方法不是从第一性原理推导出来的，而是一种临时性的近似。裁剪对数权重会改变其值，从而改变权重的相对比例。例如，它可能使两个原始概率不同的粒子看起来概率相等。这会引入偏差，并导致不正确的后验分布。而 log-sum-exp 技巧是一种精确的变换，不会引入此类偏差。\n- **结论**：**不正确**。\n\n### 结论\n选项 A 是唯一一个描述了数学上正确且有原则的数值稳定权重归一化过程的选项。尽管其报告的一个数值存在微小误差，但它无疑是所有选项中最好的，因为选项 B、C 和 D 提出的方法都存在根本性缺陷。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "更新步骤可能导致权重退化，即少数几个粒子占据了绝大部分权重，从而使滤波器失效。本练习探讨了如何使用有效粒子数 ($N_{\\mathrm{eff}}$) 来量化此问题，并指导您推导出一个基于原则的阈值，以触发重采样，这是维持粒子集长期健康和多样性的关键步骤。 ",
            "id": "3916982",
            "problem": "一个研究小组正在部署一个序贯蒙特卡罗粒子滤波器（PF），以使用非线性状态空间模型来估计重症监护室中的血浆葡萄糖浓度。在某一特定的更新时刻 $t$，该粒子滤波器有 $N=8$ 个粒子，其归一化重要性权重 $\\{\\bar{w}_{t}^{(i)}\\}_{i=1}^{8}$ 由下式给出\n$$\n\\left[0.35,\\;0.25,\\;0.15,\\;0.10,\\;0.06,\\;0.04,\\;0.03,\\;0.02\\right].\n$$\n该小组希望基于均方误差（MSE）的权衡来设定一个有原则的重采样阈值。他们采用以下决策规则：当有效样本大小低于某个阈值 $N_{\\mathrm{th}}$ 时，他们将进行重采样。该阈值被隐式地定义为，在有重采样和没有重采样两种情况下，后验均值的自归一化重要性采样估计器的预期单步预测均方误差相等时的有效样本大小值。\n\n假设以下建模基于标准重要性采样方差缩放。令 $\\kappa$ 表示当所有粒子权重相等时，葡萄糖模型在时刻 $t$ 的后验状态方差尺度；取 $\\kappa = 49$，单位为 $(\\text{mg}\\,\\text{dL}^{-1})^{2}$。在没有重采样的情况下，后验均值估计器的单步预测均方误差近似为 $\\kappa$ 除以有效样本大小。在系统重采样和粗糙化的情况下，单步预测均方误差近似为等权重蒙特卡罗方差与一个附加的样本贫化惩罚项 $\\beta$ 之和；取 $\\beta = 1.225$，单位为 $(\\text{mg}\\,\\text{dL}^{-1})^{2}$。\n\n任务：\n1) 从有效样本大小的定义出发（即产生与当前加权样本相同估计器方差的等权重样本数量），推导出一个用 $\\{\\bar{w}_{t}^{(i)}\\}_{i=1}^{N}$ 表示 $N_{\\mathrm{eff}}$ 的公式，并根据给定的权重计算 $N_{\\mathrm{eff}}$。\n\n2) 从决策规则出发（即重采样阈值 $N_{\\mathrm{th}}$ 是使得有重采样和无重采样的预期单步预测均方误差相等的 $N_{\\mathrm{eff}}$ 值），推导出一个用 $N$、$\\kappa$ 和 $\\beta$ 表示 $N_{\\mathrm{th}}$ 的闭式表达式，然后根据所提供的值进行数值计算。\n\n3) 在此生物医学滤波背景下，从后验均值估计器的方差和偏差的角度，简要解释选择比第2项中获得的值显著更高或更低的 $N_{\\mathrm{th}}$ 会带来哪些定性后果。\n\n你最终报告的答案应该仅为第2项中的 $N_{\\mathrm{th}}$ 值，以最简精确分数形式表示（不要用小数近似）。最终答案中不应包含单位。",
            "solution": "所述问题具有科学依据，提法恰当且客观。所有必要的数据和定义都已提供，并且在粒子滤波理论中没有内部矛盾或违反基本原则的地方。因此，我们可以进行完整求解。\n\n该问题要求完成与粒子滤波器中重采样相关的三个任务。我们将按顺序解决它们。\n\n1) 有效样本大小 $N_{\\mathrm{eff}}$ 的推导与计算。\n\n有效样本大小 $N_{\\mathrm{eff}}$ 定义为，能够产生与当前 $N$ 个非等权重粒子集合具有相同估计器方差的假设性等权重粒子的数量。\n\n设我们关心的状态为 $x$，并让粒子滤波器使用一组 $N$ 个粒子 $\\{x_t^{(i)}\\}_{i=1}^{N}$ 及其对应的归一化重要性权重 $\\{\\bar{w}_{t}^{(i)}\\}_{i=1}^{N}$ 来近似其后验分布，其中 $\\sum_{i=1}^{N} \\bar{w}_{t}^{(i)} = 1$。后验均值由 $\\hat{E}[x_t] = \\sum_{i=1}^{N} \\bar{w}_{t}^{(i)} x_t^{(i)}$ 估计。\n\n假设粒子 $x_t^{(i)}$ 是从方差为 $\\sigma^2_p$ 的提议分布中独立同分布地抽取的样本，则该估计器的方差为：\n$$ \\text{Var}(\\hat{E}[x_t]) = \\text{Var}\\left(\\sum_{i=1}^{N} \\bar{w}_{t}^{(i)} x_t^{(i)}\\right) = \\sum_{i=1}^{N} (\\bar{w}_{t}^{(i)})^2 \\text{Var}(x_t^{(i)}) = \\sigma_p^2 \\sum_{i=1}^{N} (\\bar{w}_{t}^{(i)})^2 $$\n现在，考虑一个大小为 $N_{\\mathrm{eff}}$ 的假设样本，其权重相等，即 $w^{(j)} = 1/N_{\\mathrm{eff}}$，对于 $j=1, \\dots, N_{\\mathrm{eff}}$。这个均匀样本的均值估计器的方差将是：\n$$ \\text{Var}(\\hat{E}_{\\text{unif}}[x_t]) = \\sigma_p^2 \\sum_{j=1}^{N_{\\mathrm{eff}}} \\left(\\frac{1}{N_{\\mathrm{eff}}}\\right)^2 = \\sigma_p^2 \\cdot N_{\\mathrm{eff}} \\cdot \\frac{1}{N_{\\mathrm{eff}}^2} = \\frac{\\sigma_p^2}{N_{\\mathrm{eff}}} $$\n根据 $N_{\\mathrm{eff}}$ 的定义，令两个方差相等：\n$$ \\frac{\\sigma_p^2}{N_{\\mathrm{eff}}} = \\sigma_p^2 \\sum_{i=1}^{N} (\\bar{w}_{t}^{(i)})^2 $$\n求解 $N_{\\mathrm{eff}}$，我们得到标准公式：\n$$ N_{\\mathrm{eff}} = \\frac{1}{\\sum_{i=1}^{N} (\\bar{w}_{t}^{(i)})^2} $$\n对于给定的问题，我们有 $N=8$，权重 $\\{\\bar{w}_{t}^{(i)}\\}_{i=1}^{8}$ 为 $[0.35, 0.25, 0.15, 0.10, 0.06, 0.04, 0.03, 0.02]$。我们计算权重的平方和：\n$$ \\sum_{i=1}^{8} (\\bar{w}_{t}^{(i)})^2 = (0.35)^2 + (0.25)^2 + (0.15)^2 + (0.10)^2 + (0.06)^2 + (0.04)^2 + (0.03)^2 + (0.02)^2 $$\n$$ \\sum_{i=1}^{8} (\\bar{w}_{t}^{(i)})^2 = 0.1225 + 0.0625 + 0.0225 + 0.0100 + 0.0036 + 0.0016 + 0.0009 + 0.0004 = 0.224 $$\n因此，有效样本大小为：\n$$ N_{\\mathrm{eff}} = \\frac{1}{0.224} = \\frac{1}{224/1000} = \\frac{1000}{224} = \\frac{125}{28} \\approx 4.46 $$\n\n2) 重采样阈值 $N_{\\mathrm{th}}$ 的推导与计算。\n\n重采样阈值 $N_{\\mathrm{th}}$ 被定义为，在有重采样和无重采样两种情况下，预期单步预测均方误差（MSE）相等的 $N_{\\mathrm{eff}}$ 值。问题为此提供了这些 MSE 的近似值：\n$$ \\text{MSE}_{\\text{no-resample}} \\approx \\frac{\\kappa}{N_{\\mathrm{eff}}} $$\n$$ \\text{MSE}_{\\text{resample}} \\approx \\frac{\\kappa}{N} + \\beta $$\n这里，$\\kappa$ 是后验状态方差尺度，$N$ 是粒子总数，$\\beta$ 是样本贫化惩罚项。项 $\\kappa/N$ 代表等权重蒙特卡罗估计器的方差。决策规则是在阈值 $N_{\\mathrm{eff}} = N_{\\mathrm{th}}$ 处令 MSE 相等：\n$$ \\frac{\\kappa}{N_{\\mathrm{th}}} = \\frac{\\kappa}{N} + \\beta $$\n我们求解该方程以得到 $N_{\\mathrm{th}}$。首先，我们合并右侧的项：\n$$ \\frac{\\kappa}{N_{\\mathrm{th}}} = \\frac{\\kappa + N\\beta}{N} $$\n将两边取倒数得到：\n$$ \\frac{N_{\\mathrm{th}}}{\\kappa} = \\frac{N}{\\kappa + N\\beta} $$\n最后，两边乘以 $\\kappa$ 得到阈值的闭式表达式：\n$$ N_{\\mathrm{th}} = \\frac{\\kappa N}{\\kappa + N\\beta} $$\n我们已知 $N=8$，$\\kappa=49$，以及 $\\beta=1.225$。为确保得到一个精确的分数答案，我们将 $\\beta$ 转换为分数：$\\beta = 1.225 = \\frac{1225}{1000} = \\frac{245}{200} = \\frac{49}{40}$。\n现在我们将这些值代入 $N_{\\mathrm{th}}$ 的表达式中：\n$$ N_{\\mathrm{th}} = \\frac{49 \\cdot 8}{49 + 8 \\cdot \\left(\\frac{49}{40}\\right)} $$\n首先，我们简化分母：\n$$ 49 + 8 \\cdot \\frac{49}{40} = 49 + \\frac{49}{5} = \\frac{5 \\cdot 49}{5} + \\frac{49}{5} = \\frac{6 \\cdot 49}{5} $$\n现在我们将此结果代回到 $N_{\\mathrm{th}}$ 的表达式中：\n$$ N_{\\mathrm{th}} = \\frac{49 \\cdot 8}{\\frac{6 \\cdot 49}{5}} = \\frac{49 \\cdot 8 \\cdot 5}{6 \\cdot 49} $$\n$49$ 这个因子可以消掉：\n$$ N_{\\mathrm{th}} = \\frac{8 \\cdot 5}{6} = \\frac{40}{6} = \\frac{20}{3} $$\n\n3) 选择 $N_{\\mathrm{th}}$ 的定性后果。\n\n值 $N_{\\mathrm{th}} = 20/3 \\approx 6.67$ 代表了基于所提供的 MSE 模型的重采样的最优权衡点。显著偏离此值会对滤波器性能产生有害影响，特别是影响后验均值估计器的方差。\n\n选择比 $20/3$ 显著更高的 $N_{\\mathrm{th}}$：这会导致过于频繁的重采样。即使在粒子权重没有高度退化的情况下，滤波器也会进行重采样。虽然在每一步都进行重采样会将单步估计器方差减小到其最小值（$\\kappa/N$），但这一操作并非没有代价。重采样的随机性会引入其自身的变异性，表现为样本贫化——随着粒子变得高度相关，粒子多样性随时间推移而丧失。该模型通过附加惩罚项 $\\beta$ 来捕捉这一成本。通过过于频繁地重采样，会不必要地招致惩罚 $\\beta$，从而使平均 MSE 高于可实现的最小值。由于贫化的粒子集无法适应新信息，估计器在多个时间步长上的方差会增加，尽管在每次重采样后估计器暂时是无偏的。\n\n选择比 $20/3$ 显著更低的 $N_{\\mathrm{th}}$：这会导致不频繁的重采样。滤波器在干预之前会容忍非常高水平的粒子退化。随着滤波器在没有重采样的情况下演化，重要性权重的方差会增加，导致 $N_{\\mathrm{eff}}$ 急剧下降。后验均值估计器的方差（近似为 $\\kappa/N_{\\mathrm{eff}}$）将无界增长。滤波器的大部分计算量都浪费在传播权重可忽略的粒子上，而估计值仅依赖于极少数“更适应”的粒子。这会导致估计不稳定且方差很高。虽然这种选择避免了样本贫化惩罚 $\\beta$，但其代价是粒子退化导致的灾难性估计器方差，从而导致更高的 MSE，并使滤波器在跟踪血浆葡萄糖浓度方面失效。估计器在技术上保持无偏，但其极高的方差使其在实践中毫无用处。",
            "answer": "$$\\boxed{\\frac{20}{3}}$$"
        }
    ]
}