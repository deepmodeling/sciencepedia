{
    "hands_on_practices": [
        {
            "introduction": "任何基因组尺度代谢模型的基础都是化学计量矩阵 $S$。这个练习将指导你完成将一个简单的反应网络转化为其数学表示的过程，这对于所有后续的计算分析至关重要。通过手动构建 $S$ 矩阵，你将具体理解它如何为每个代谢物编码质量守恒的原则。",
            "id": "3888980",
            "problem": "在全基因组尺度代谢模型中，基于均匀混合假设的细胞内质量平衡由代谢物浓度的时间导数与反应通量之间的线性关系表示，其中化学计量矩阵编码了反应的参与情况。从生化网络在稳态或动态下的质量守恒出发，每个胞内代谢物的平衡可以写成 $d\\mathbf{x}/dt = S\\,\\mathbf{v}$ 的形式，其中 $S$ 是化学计量矩阵，其元素 $s_{ij}$ 等于代谢物 $i$ 在反应 $j$ 中的带符号化学计量系数（消耗为负，生成为正，不参与为零）。考虑一个最小闭合网络，其中包含三种代谢物和三个不可逆反应，分别为 $R1: A \\to B$、$R2: B \\to C$ 和 $R3: C \\to A$，每个反应都具有单位化学计量系数。使用质量平衡公式所隐含的标准符号约定，采用代谢物顺序 $\\{A,B,C\\}$ 作为行，反应顺序 $\\{R1,R2,R3\\}$ 作为列，构建化学计量矩阵 $S$。将 $S$ 明确地写成一个 $3 \\times 3$ 的整数值矩阵。最终答案必须是明确的矩阵，不需要任何四舍五入或单位。",
            "solution": "该问题要求为给定的生化网络构建化学计量矩阵，记为 $S$。控制该系统的基本关系是胞内代谢物的质量平衡方程，其形式如下：\n$$\n\\frac{d\\mathbf{x}}{dt} = S\\,\\mathbf{v}\n$$\n在此方程中，$\\mathbf{x}$ 是代谢物浓度向量，$\\mathbf{v}$ 是反应通量向量，$S$ 是化学计量矩阵。$S$ 矩阵的一个元素 $s_{ij}$ 代表代谢物 $i$ 在反应 $j$ 中的带符号化学计量系数。问题指定了标准的符号约定：对于被消耗的代谢物（反应物），系数为负；对于生成的代谢物，系数为正。如果某种代谢物不参与反应，其对应的系数为零。\n\n问题定义了一个包含 $3$ 种代谢物和 $3$ 个反应的网络。代谢物的顺序（对应于矩阵的行）被指定为 $\\{A,B,C\\}$。因此，第 $1$行对应代谢物 $A$，第 $2$ 行对应代谢物 $B$，第 $3$ 行对应代谢物 $C$。反应的顺序（对应于矩阵的列）被指定为 $\\{R1,R2,R3\\}$。因此，第 $1$ 列对应反应 $R1$，第 $2$ 列对应反应 $R2$，第 $3$ 列对应反应 $R3$。因此，矩阵 $S$ 将是一个 $3 \\times 3$ 的矩阵。\n\n给出的反应如下：\n- $R1: A \\to B$\n- $R2: B \\to C$\n- $R3: C \\to A$\n\n所有反应均被说明具有“单位化学计量系数”，这意味着每个非零系数的绝对值为 $1$。\n\n我们现在可以通过确定每一列的元素来构建矩阵 $S$，其中每一列代表一个单一的反应。\n\n对于第一列（$j=1$），它对应于反应 $R1: A \\to B$：\n- 代谢物 $A$（第 $i=1$ 行）被消耗。根据符号约定，其化学计量系数为负。鉴于单位系数，我们有 $s_{11} = -1$。\n- 代谢物 $B$（第 $i=2$ 行）被生成。其系数为正，所以 $s_{21} = +1$。\n- 代谢物 $C$（第 $i=3$ 行）不参与此反应。因此，$s_{31} = 0$。\n$S$ 的第一列因此是 $\\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\end{pmatrix}$。\n\n对于第二列（$j=2$），它对应于反应 $R2: B \\to C$：\n- 代谢物 $A$（第 $i=1$ 行）不参与。因此，$s_{12} = 0$。\n- 代谢物 $B$（第 $i=2$ 行）被消耗。其系数为负，所以 $s_{22} = -1$。\n- 代谢物 $C$（第 $i=3$ 行）被生成。其系数为正，所以 $s_{32} = +1$。\n$S$ 的第二列因此是 $\\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\end{pmatrix}$。\n\n对于第三列（$j=3$），它对应于反应 $R3: C \\to A$：\n- 代谢物 $A$（第 $i=1$ 行）被生成。其系数为正，所以 $s_{13} = +1$。\n- 代谢物 $B$（第 $i=2$ 行）不参与。因此，$s_{23} = 0$。\n- 代谢物 $C$（第 $i=3$ 行）被消耗。其系数为负，所以 $s_{33} = -1$。\n$S$ 的第三列因此是 $\\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\end{pmatrix}$。\n\n最后，通过组合这三列，我们形成了完整的化学计量矩阵 $S$：\n$$\nS = \\begin{pmatrix} s_{11}  s_{12}  s_{13} \\\\ s_{21}  s_{22}  s_{23} \\\\ s_{31}  s_{32}  s_{33} \\end{pmatrix} = \\begin{pmatrix} -1  0  1 \\\\ 1  -1  0 \\\\ 0  1  -1 \\end{pmatrix}\n$$\n这就是根据指定约定代表给定网络化学计量的明确的 $3 \\times 3$ 整数值矩阵。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -1  0  1 \\\\ 1  -1  0 \\\\ 0  1  -1 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "一旦代谢网络由化学计量矩阵表示，我们就可以使用基于约束的方法来模拟其行为。本实践介绍了通量平衡分析（FBA），用于寻找最优状态（如最大生长速率），以及通量变异性分析（FVA），用于探索在该最优状态下所有可能的代谢通量范围。通过这个计算练习，你将学会识别备择最优解和反应耦合，揭示系统的代谢灵活性。",
            "id": "3888937",
            "problem": "给定一组小而科学一致的基因组尺度代谢模型 (GSMM) 片段，供您使用稳态约束基础建模进行分析。其基础是稳态下的质量平衡和线性约束：化学计量矩阵 $S \\in \\mathbb{R}^{m \\times n}$ 编码代谢物平衡，通量向量 $v \\in \\mathbb{R}^{n}$ 满足 $S v = 0$，并且每个反应通量 $v_j$ 受下界和上界约束，$l_j \\le v_j \\le u_j$。目标是线性的，代表生长（生物质）反应。通量平衡分析 (FBA) 寻找最大生物质通量，而在最优生长条件下的通量变异性分析 (FVA) 则针对指定反应，在维持最优生长值的前提下，寻找最小和最大可行通量。\n\n任务。对以下每个测试用例，执行以下操作：\n1. 通过求解在 $S v = 0$ 和 $l \\le v \\le u$ 约束下最大化生物质反应通量的线性规划问题，计算最优生物质通量。\n2. 将生物质反应精确地保持在其最优值，通过求解两个线性规划问题，计算指定目标反应的最小和最大可行通量值：\n   - 在 $S v = 0$、$l \\le v \\le u$ 以及等式约束 $v_{j_{\\mathrm{bio}}} = v_{\\mathrm{opt}}$ 的条件下，最小化目标反应通量。\n   - 在相同约束下，最大化目标反应通量；等效地，最小化目标通量的负值。\n\n所有通量值必须以毫摩尔/克干重/小时 (mmol gDW$^{-1}$ h$^{-1}$) 表示。以四舍五入到 $6$ 位小数的普通十进制数报告数值答案。对 $j_{\\mathrm{bio}}$ 和 $j_{\\mathrm{tgt}}$ 使用从零开始的反应指数。\n\n科学背景。仅使用线性规划和质量平衡方程。不要调用任何绕过这些原则的快捷公式。假设确定性的、时不变的稳态，并精确满足等式约束。\n\n测试套件。对于每个案例，$S$、$l$、$u$、生物质反应指数 $j_{\\mathrm{bio}}$ 和目标反应指数 $j_{\\mathrm{tgt}}$ 均已给出。每个 $S$ 和边界集都很小，但探讨了不同的方面：具有内部循环的交替最优解、固定通量的紧密耦合，以及最优生长为零但存在内部通量变异性的边界情况。\n\n案例 A（具有内部循环的交替最优解）：\n$$\nS = \\begin{bmatrix}\n1  -1  0  -1  1 \\\\\n0  1  -1  0  -1\n\\end{bmatrix},\\quad\n\\ell = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ -5 \\end{bmatrix},\\quad\nu = \\begin{bmatrix} 10 \\\\ 100 \\\\ 100 \\\\ 2 \\\\ 5 \\end{bmatrix},\\quad\nj_{\\mathrm{bio}} = 2,\\quad j_{\\mathrm{tgt}} = 1.\n$$\n\n案例 B（紧密耦合固定目标通量）：\n$$\nS = \\begin{bmatrix} 1  -1 \\end{bmatrix},\\quad\n\\ell = \\begin{bmatrix} 0 \\\\ 0 \\end{bmatrix},\\quad\nu = \\begin{bmatrix} 10 \\\\ 100 \\end{bmatrix},\\quad\nj_{\\mathrm{bio}} = 1,\\quad j_{\\mathrm{tgt}} = 0.\n$$\n\n案例 C（最优生长为零但通过可逆循环存在内部变异性的边界情况）：\n$$\nS = \\begin{bmatrix}\n1  -1  0  1 \\\\\n0  1  -1  -1\n\\end{bmatrix},\\quad\n\\ell = \\begin{bmatrix} 0 \\\\ -10 \\\\ 0 \\\\ -10 \\end{bmatrix},\\quad\nu = \\begin{bmatrix} 0 \\\\ 10 \\\\ 100 \\\\ 10 \\end{bmatrix},\\quad\nj_{\\mathrm{bio}} = 2,\\quad j_{\\mathrm{tgt}} = 1.\n$$\n\n最终输出规范。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个条目对应一个测试用例，并且其本身是目标反应在最优生长条件下的一个双元素列表 $[v_{\\min}, v_{\\max}]$。例如，输出格式必须与 $[ [v_{\\min}^{(A)}, v_{\\max}^{(A)}], [v_{\\min}^{(B)}, v_{\\max}^{(B)}], [v_{\\min}^{(C)}, v_{\\max}^{(C)}] ]$ 完全一样，每个值四舍五入到 $6$ 位小数并以 mmol gDW$^{-1}$ h$^{-1}$ 表示；不得有任何附加文本。在纯ASCII中，方括号必须打印出来，列表元素之间除了逗号外没有空格，从而形成类似 $[[a,b],[c,d],[e,f]]$ 的格式。",
            "solution": "用户提供的问题陈述已经过分析和验证。\n\n### 第1步：提取给定信息\n\n**案例 A：**\n- 化学计量矩阵：$S = \\begin{bmatrix} 1  -1  0  -1  1 \\\\ 0  1  -1  0  -1 \\end{bmatrix}$\n- 下界：$\\ell = \\begin{bmatrix} 0  0  0  0  -5 \\end{bmatrix}^T$\n- 上界：$u = \\begin{bmatrix} 10  100  100  2  5 \\end{bmatrix}^T$\n- 生物质反应指数：$j_{\\mathrm{bio}} = 2$\n- 目标反应指数：$j_{\\mathrm{tgt}} = 1$\n\n**案例 B：**\n- 化学计量矩阵：$S = \\begin{bmatrix} 1  -1 \\end{bmatrix}$\n- 下界：$\\ell = \\begin{bmatrix} 0  0 \\end{bmatrix}^T$\n- 上界：$u = \\begin{bmatrix} 10  100 \\end{bmatrix}^T$\n- 生物质反应指数：$j_{\\mathrm{bio}} = 1$\n- 目标反应指数：$j_{\\mathrm{tgt}} = 0$\n\n**案例 C：**\n- 化学计量矩阵：$S = \\begin{bmatrix} 1  -1  0  1 \\\\ 0  1  -1  -1 \\end{bmatrix}$\n- 下界：$\\ell = \\begin{bmatrix} 0  -10  0  -10 \\end{bmatrix}^T$\n- 上界：$u = \\begin{bmatrix} 0  10  100  10 \\end{bmatrix}^T$\n- 生物质反应指数：$j_{\\mathrm{bio}} = 2$\n- 目标反应指数：$j_{\\mathrm{tgt}} = 1$\n\n### 第2步：使用提取的给定信息进行验证\n\n1.  **科学依据**：该问题基于代谢网络的约束基础建模，特别是通量平衡分析 (FBA) 和通量变异性分析 (FVA)。这些是系统生物学和生物信息学中标准且成熟的技术。其核心原则——稳态质量平衡 ($S v = 0$) 和线性优化——是基础且科学合理的。\n2.  **适定性**：所提出的问题是线性规划 (LP) 问题。对于每种情况，由 $S v = 0$ 和 $l \\le v \\le u$ 定义的可行域是非空的（例如，$v=0$ 是一个可行解）且有界的（由于所有通量都有明确的下界和上界）。在一个非空、紧凑（封闭且有界）的集合上优化的线性目标函数保证有有限且可达的最优解。因此，所描述的所有 FBA 和 FVA 问题都是适定的。\n3.  **目标明确**：该问题用精确的数学定义（$S$、$l$、$u$、$v, j_{\\mathrm{bio}}, j_{\\mathrm{tgt}}$）和清晰、无歧义的指令进行了规定。每个测试用例的数据都已明确提供。\n4.  **无其他缺陷**：该问题是自包含的、一致的，并且不违反任何其他验证标准。\n\n### 第3步：结论与行动\n\n问题是有效的。将提供解决方案。\n\n### 基于原则的设计与求解\n\n该问题的核心在于求解一系列线性规划 (LP) 问题。我们将首先为通量平衡分析 (FBA) 和通量变异性分析 (FVA) 构建通用数学问题，然后将其应用于每个具体案例。\n\n**1. 通量平衡分析 (FBA)**\n\nFBA 用于找到一个最优的通量分布，以最大化给定的生物学目标，通常是生物质反应的通量。这被表述为一个LP问题：\n$$\n\\begin{aligned}\nv_{\\mathrm{opt}} = \\max_{v} \\quad  c^T v \\\\\n\\text{s.t.} \\quad  S v = 0 \\\\\n l \\le v \\le u\n\\end{aligned}\n$$\n这里，$v \\in \\mathbb{R}^n$ 是反应通量向量，$S \\in \\mathbb{R}^{m \\times n}$ 是化学计量矩阵，$l, u \\in \\mathbb{R}^n$ 分别是通量的下界和上界。目标向量 $c$ 通常是一个标准基向量 $e_{j_{\\mathrm{bio}}}$，其中 $j_{\\mathrm{bio}}$ 是生物质反应的指数。因此，我们正在最大化 $v_{j_{\\mathrm{bio}}}$。\n\n**2. 通量变异性分析 (FVA)**\n\nFVA 确定特定反应在维持某种状态（如最优生长）下的可能通量值范围。从FBA找到最优生物质通量 $v_{\\mathrm{opt}}$ 后，我们添加一个约束将生物质通量固定为此值，即 $v_{j_{\\mathrm{bio}}} = v_{\\mathrm{opt}}$。然后，我们为目标反应 $j_{\\mathrm{tgt}}$ 求解两个LP问题：一个用于找到其可能的最小通量 ($v_{\\min}$)，另一个用于找到其最大通量 ($v_{\\max}$)。\n\nFVA 最小化问题是：\n$$\n\\begin{aligned}\nv_{\\min} = \\min_{v} \\quad  v_{j_{\\mathrm{tgt}}} \\\\\n\\text{s.t.} \\quad  S v = 0 \\\\\n l \\le v \\le u \\\\\n v_{j_{\\mathrm{bio}}} = v_{\\mathrm{opt}}\n\\end{aligned}\n$$\n\nFVA 最大化问题是：\n$$\n\\begin{aligned}\nv_{\\max} = \\max_{v} \\quad  v_{j_{\\mathrm{tgt}}} \\\\\n\\text{s.t.} \\quad  S v = 0 \\\\\n l \\le v \\le u \\\\\n v_{j_{\\mathrm{bio}}} = v_{\\mathrm{opt}}\n\\end{aligned}\n$$\n这些LP问题将使用数值方法为每个测试用例求解。\n\n---\n\n**案例 A 分析**\n\n- $S = \\begin{bmatrix} 1  -1  0  -1  1 \\\\ 0  1  -1  0  -1 \\end{bmatrix}$，$l = [0, 0, 0, 0, -5]^T$，$u = [10, 100, 100, 2, 5]^T$，$j_{\\mathrm{bio}}=2$，$j_{\\mathrm{tgt}}=1$。\n- 稳态方程为 $v_0 - v_1 - v_3 + v_4 = 0$ 和 $v_1 - v_2 - v_4 = 0$。\n- 求解 $v_0$ 和 $v_1$：$v_1 = v_2 + v_4$ 和 $v_0 = v_1 + v_3 - v_4 = (v_2 + v_4) + v_3 - v_4 = v_2 + v_3$。\n- 我们希望在边界约束下最大化 $v_2$ ($j_{\\mathrm{bio}}=2$)：\n  - $0 \\le v_0 \\le 10 \\implies 0 \\le v_2 + v_3 \\le 10$\n  - $0 \\le v_1 \\le 100 \\implies 0 \\le v_2 + v_4 \\le 100$\n  - 以及对 $v_2, v_3, v_4$ 的直接边界：$0 \\le v_2 \\le 100$，$0 \\le v_3 \\le 2$，$-5 \\le v_4 \\le 5$。\n- 从 $v_2 + v_3 \\le 10$，我们推断出 $v_2 \\le 10 - v_3$。由于 $v_3 \\ge 0$，$v_2$ 的最大可能值为 $10$。这在 $v_3 = 0$ 时实现。\n- 所以，$v_{\\mathrm{opt}} = 10$。\n- 对于 FVA，我们固定 $v_2 = 10$。这迫使 $v_3 = 0$（由 $10+v_3 \\le 10$ 和 $v_3 \\ge 0$ 得出）。因此，$v_0 = v_2 + v_3 = 10$。\n- 其余变量通过 $v_1 = v_2 + v_4 = 10 + v_4$ 关联。$v_1$ 和 $v_4$ 的边界是 $0 \\le v_1 \\le 100$ 和 $-5 \\le v_4 \\le 5$。\n- 将 $v_1 = 10 + v_4$ 代入其边界，得到 $0 \\le 10+v_4 \\le 100 \\implies -10 \\le v_4 \\le 90$。$v_4$ 的有效范围是 $[-10, 90]$ 与其自身边界 $[-5, 5]$ 的交集，即 $[-5, 5]$。\n- 目标通量是 $v_1$。其范围由 $v_4$ 的范围决定：\n  - $v_{1, \\min} = 10 + v_{4, \\min} = 10 + (-5) = 5$。\n  - $v_{1, \\max} = 10 + v_{4, \\max} = 10 + (5) = 15$。\n- 案例 A 的结果：$[5, 15]$。\n\n---\n\n**案例 B 分析**\n\n- $S = [1 \\; -1]$，$l = [0, 0]^T$，$u = [10, 100]^T$，$j_{\\mathrm{bio}}=1$，$j_{\\mathrm{tgt}}=0$。\n- 稳态方程是 $v_0 - v_1 = 0$，这意味着 $v_0 = v_1$。这是一种“紧密耦合”。\n- 我们希望在边界约束下最大化 $v_1$ ($j_{\\mathrm{bio}}=1$)：$0 \\le v_0 \\le 10$ 和 $0 \\le v_1 \\le 100$。\n- 由于 $v_0 = v_1$，两个约束都适用于 $v_1$：$0 \\le v_1 \\le 10$ 和 $0 \\le v_1 \\le 100$。交集是 $0 \\le v_1 \\le 10$。\n- 最大生物质通量是 $v_{\\mathrm{opt}} = 10$。\n- 对于 FVA，我们固定 $v_1 = 10$。我们想要目标通量 $v_0$ ($j_{\\mathrm{tgt}}=0$) 的范围。\n- 从耦合关系 $v_0 = v_1$ 可知，如果 $v_1$ 固定为 $10$，那么 $v_0$ 也必须是 $10$。没有变异性。\n- $v_{0, \\min} = 10$ 且 $v_{0, \\max} = 10$。\n- 案例 B 的结果：$[10, 10]$。\n\n---\n\n**案例 C 分析**\n\n- $S = \\begin{bmatrix} 1  -1  0  1 \\\\ 0  1  -1  -1 \\end{bmatrix}$，$l = [0, -10, 0, -10]^T$，$u = [0, 10, 100, 10]^T$，$j_{\\mathrm{bio}}=2$，$j_{\\mathrm{tgt}}=1$。\n- $v_0$ 的边界是 $0 \\le v_0 \\le 0$，所以 $v_0 = 0$。\n- 稳态方程为 $v_0 - v_1 + v_3 = 0$ 和 $v_1 - v_2 - v_3 = 0$。\n- 将 $v_0=0$ 代入第一个方程得到 $-v_1 + v_3 = 0$，所以 $v_1 = v_3$。\n- 将 $v_1 = v_3$ 代入第二个方程得到 $v_3 - v_2 - v_3 = 0$，简化为 $-v_2 = 0$，所以 $v_2 = 0$。\n- 对于任何可行解，生物质通量 $v_2$ 始终为 $0$。\n- 最大生物质通量是 $v_{\\mathrm{opt}} = 0$。\n- 对于 FVA，我们固定 $v_2 = 0$，这已经是系统的一个属性。我们寻求目标通量 $v_1$ ($j_{\\mathrm{tgt}}=1$) 的范围。\n- 可行通量分布的特征是 $v_0=0$、$v_2=0$ 和 $v_1=v_3$。\n- $v_1$ 的边界是 $-10 \\le v_1 \\le 10$。$v_3$ 的边界是 $-10 \\le v_3 \\le 10$。由于 $v_1=v_3$，这些约束是一致的。$v_1$ 在 $[-10, 10]$ 中的任何值都是可行的，此时 $v_3$ 取相同的值。\n- 因此，$v_1$ 的可能值范围是其完整的允许范围。\n  - $v_{1, \\min} = -10$。\n  - $v_{1, \\max} = 10$。\n- 案例 C 的结果：$[-10, 10]$。\n\n实现将遵循此逻辑，通过使用 `scipy.optimize.linprog` 建立并求解相应的LP问题。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve_fva_case(S, l, u, j_bio, j_tgt):\n    \"\"\"\n    Performs FBA followed by FVA for a single metabolic model case.\n\n    Args:\n        S (np.ndarray): Stoichiometric matrix.\n        l (np.ndarray): Lower flux bounds.\n        u (np.ndarray): Upper flux bounds.\n        j_bio (int): Index of the biomass reaction.\n        j_tgt (int): Index of the target reaction for FVA.\n\n    Returns:\n        list: A two-element list [v_min, v_max] for the target reaction.\n    \"\"\"\n    m, n = S.shape\n    b_eq = np.zeros(m)\n    bounds = list(zip(l, u))\n\n    # --- Part 1: Flux Balance Analysis (FBA) ---\n    # Objective: maximize v_j_bio, which is equivalent to minimizing -v_j_bio\n    c_fba = np.zeros(n)\n    c_fba[j_bio] = -1.0\n\n    # Solve the FBA linear program\n    fba_res = linprog(c=c_fba, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs-ds')\n\n    if not fba_res.success:\n        # This should not happen for the given valid problems.\n        # This would indicate an infeasible or unbounded model.\n        raise RuntimeError(f\"FBA failed for the given case: {fba_res.message}\")\n    \n    # The optimal biomass flux. The result fun is the minimum, so we negate it.\n    v_opt = -fba_res.fun\n\n    # --- Part 2: Flux Variability Analysis (FVA) ---\n    # Add a new equality constraint: v_j_bio = v_opt\n    S_fva = np.vstack([S, np.zeros(n)])\n    S_fva[-1, j_bio] = 1.0\n    b_fva = np.append(b_eq, v_opt)\n    \n    # Sub-problem 2a: Minimize target reaction flux\n    c_fva_min = np.zeros(n)\n    c_fva_min[j_tgt] = 1.0\n\n    fva_min_res = linprog(c=c_fva_min, A_eq=S_fva, b_eq=b_fva, bounds=bounds, method='highs-ds')\n    \n    if not fva_min_res.success:\n        raise RuntimeError(f\"FVA minimization failed: {fva_min_res.message}\")\n    v_min = fva_min_res.fun\n\n    # Sub-problem 2b: Maximize target reaction flux\n    # We minimize the negative of the target flux\n    c_fva_max = np.zeros(n)\n    c_fva_max[j_tgt] = -1.0\n\n    fva_max_res = linprog(c=c_fva_max, A_eq=S_fva, b_eq=b_fva, bounds=bounds, method='highs-ds')\n    \n    if not fva_max_res.success:\n        raise RuntimeError(f\"FVA maximization failed: {fva_max_res.message}\")\n    v_max = -fva_max_res.fun\n\n    return [v_min, v_max]\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, solve them, and print the output.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (alternate optima with internal cycle)\n        {\n            \"S\": np.array([[1, -1, 0, -1, 1], [0, 1, -1, 0, -1]]),\n            \"l\": np.array([0, 0, 0, 0, -5]),\n            \"u\": np.array([10, 100, 100, 2, 5]),\n            \"j_bio\": 2, \"j_tgt\": 1,\n        },\n        # Case B (tight coupling fixes the target flux)\n        {\n            \"S\": np.array([[1, -1]]),\n            \"l\": np.array([0, 0]),\n            \"u\": np.array([10, 100]),\n            \"j_bio\": 1, \"j_tgt\": 0,\n        },\n        # Case C (boundary case with zero optimal growth)\n        {\n            \"S\": np.array([[1, -1, 0, 1], [0, 1, -1, -1]]),\n            \"l\": np.array([0, -10, 0, -10]),\n            \"u\": np.array([0, 10, 100, 10]),\n            \"j_bio\": 2, \"j_tgt\": 1,\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        v_min_max = solve_fva_case(\n            S=case[\"S\"], l=case[\"l\"], u=case[\"u\"], \n            j_bio=case[\"j_bio\"], j_tgt=case[\"j_tgt\"]\n        )\n        results.append(v_min_max)\n\n    # Format the final output string exactly as specified.\n    # e.g., [[val1,val2],[val3,val4],[val5,val6]]\n    # Each value rounded to 6 decimal places.\n    formatted_results = [f\"[{res[0]:.6f},{res[1]:.6f}]\" for res in results]\n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    \n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "基因组尺度模型是预测基因扰动表型效应的强大工具。本练习将通量平衡分析应用于识别合成致死基因对——即那些单独非必需但共同删除时致命的基因对。通过模拟双基因敲除，你将学习如何揭示代谢通路中的功能冗余，这是系统生物学和治疗靶点发现中的一个关键概念。",
            "id": "3888967",
            "problem": "给定一组由化学计量矩阵和通量边界表示的分支代谢网络，这些网络处于通量平衡分析（FBA）的稳态假设背景下。在稳态下，细胞内代谢物的浓度不随时间变化，且通量满足质量平衡方程。您的任务是为每个网络计算一个合成致死反应对，该反应对会阻断生物质的生成，而任何单个反应的删除都不会，并从理论上解释通路之间的相互依赖关系。\n\n定义与基础：\n- 通量平衡分析（FBA）假设稳态，即细胞内代谢物浓度没有可忽略的累积。质量平衡约束由以下线性系统给出：\n$$\nS \\, v = 0,\n$$\n其中 $S \\in \\mathbb{R}^{m \\times n}$ 是化学计量矩阵，包含 $m$ 种代谢物和 $n$ 个反应，$v \\in \\mathbb{R}^{n}$ 是反应通量向量。\n- 通量边界施加了生理上有意义的约束：\n$$\n\\ell \\le v \\le u,\n$$\n其中下界为 $\\ell \\in \\mathbb{R}^{n}$，上界为 $u \\in \\mathbb{R}^{n}$。\n- 生物质生成被建模为一个特殊的汇反应，其索引为 $b \\in \\{0,1,\\dots,n-1\\}$，目标是最大化生物质通量 $v_b$。这被表述为一个线性规划问题，其目标向量为 $c \\in \\mathbb{R}^{n}$，其中 $c_b = 1$ 且对于 $i \\ne b$ 有 $c_i = 0$；优化问题是：\n$$\n\\max_{v \\in \\mathbb{R}^n} \\; c^\\top v \\quad \\text{subject to} \\quad S v = 0, \\; \\ell \\le v \\le u.\n$$\n- 对于一组可删除的反应 $D \\subseteq \\{0,1,\\dots,n-1\\}$，合成致死对 $(i,j)$（其中 $i,j \\in D$, $i \\ne j$）定义为在给定的生物质通量正性数值容差 $\\tau  0$ 下，满足以下性质的对：\n  1. 当反应 $i$ 被删除（即 $v_i = 0$，通过边界 $0 \\le v_i \\le 0$ 强制执行）时，最优生物质通量为严格正值：$\\max c^\\top v  \\tau$。\n  2. 当反应 $j$ 被删除时，最优生物质通量为严格正值：$\\max c^\\top v  \\tau$。\n  3. 当反应 $i$ 和 $j$ 都被删除时，最优生物质通量在容差范围内为零：$\\max c^\\top v \\le \\tau$。\n- 在所有满足上述性质的对中，选择字典序最小的对，即具有最小 $i$ 的对 $(i,j)$，如果 $i$ 相同，则选择具有最小 $j$ 的对。\n\n您的程序必须为以下测试套件中的每个网络计算这样一个对。如果网络中不存在合成致死对，则在该情况下返回一个空列表 $[\\ ]$。\n\n数值容差：\n- 使用容差 $\\tau = 10^{-7}$ 来判断正性（$ \\tau$）与有效零（$\\le \\tau$）。\n\n索引约定：\n- 反应使用从零开始的索引。\n\n测试套件（所有边界单位为任意通量单位；所有矩阵和向量均为精确整数项）：\n\n情况1（通往必需前体的平行冗余通路）：\n- 代谢物：$m = 2$，排序为 $[A, X]$。\n- 反应：$n = 4$，排序为 $[R_0, R_1, R_2, R_3]$，其中 $R_0$ 是吸收反应，$R_3$ 是生物质反应。\n- 化学计量矩阵\n$$\nS = \\begin{bmatrix}\n1  -1  -1  0 \\\\\n0  1  1  -1\n\\end{bmatrix}.\n$$\n- 下界\n$$\n\\ell = \\begin{bmatrix}\n0 \\\\ 0 \\\\ 0 \\\\ 0\n\\end{bmatrix}, \\quad\nu = \\begin{bmatrix}\n10 \\\\ 1000 \\\\ 1000 \\\\ 1000\n\\end{bmatrix}.\n$$\n- 生物质反应索引 $b = 3$。\n- 可删除集合 $D = \\{1, 2\\}$。\n\n情况2（一个两步分支和一个通往相同前体的直接捷径）：\n- 代谢物：$m = 3$，排序为 $[A, Y, X]$。\n- 反应：$n = 5$，排序为 $[R_0, R_1, R_2, R_3, R_4]$，其中 $R_0$ 是吸收反应，$R_4$ 是生物质反应。\n- 化学计量矩阵\n$$\nS = \\begin{bmatrix}\n1  -1  0  -1  0 \\\\\n0  1  -1  0  0 \\\\\n0  0  1  1  -1\n\\end{bmatrix}.\n$$\n- 下界\n$$\n\\ell = \\begin{bmatrix}\n0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0\n\\end{bmatrix}, \\quad\nu = \\begin{bmatrix}\n10 \\\\ 1000 \\\\ 1000 \\\\ 1000 \\\\ 1000\n\\end{bmatrix}.\n$$\n- 生物质反应索引 $b = 4$。\n- 可删除集合 $D = \\{1, 2, 3\\}$。\n\n情况3（单一路径，无冗余）：\n- 代谢物：$m = 2$，排序为 $[A, X]$。\n- 反应：$n = 3$，排序为 $[R_0, R_1, R_2]$，其中 $R_0$ 是吸收反应，$R_2$ 是生物质反应。\n- 化学计量矩阵\n$$\nS = \\begin{bmatrix}\n1  -1  0 \\\\\n0  1  -1\n\\end{bmatrix}.\n$$\n- 下界\n$$\n\\ell = \\begin{bmatrix}\n0 \\\\ 0 \\\\ 0\n\\end{bmatrix}, \\quad\nu = \\begin{bmatrix}\n10 \\\\ 1000 \\\\ 1000\n\\end{bmatrix}.\n$$\n- 生物质反应索引 $b = 2$。\n- 可删除集合 $D = \\{1\\}$。\n\n您的程序必须为每种情况计算出来自 $D$ 的字典序最小的合成致死对 $(i,j)$（如果存在），否则返回一个空列表。最终输出格式必须是单行，包含一个用方括号括起来的逗号分隔列表，其中每个元素要么是空列表 $[\\ ]$，要么是带有从零开始索引的列表 $[i,j]$。例如，输出应类似于\n$$\n[\\,[i_1,j_1],[\\ ],[i_3,j_3]\\,]\n$$\n但打印为不带任何附加文本的单行。此问题中没有角度或物理单位，所有数值答案都是整数列表。通过遵守稳态质量平衡和线性约束，并完全按照规定计算线性规划，确保科学真实性。",
            "solution": "用户提供了一个科学上合理、定义明确且客观的问题。该问题基于生物医学系统建模领域内通量平衡分析（FBA）的既定原则。所有必要的数据和定义都已提供，以解决所述问题。因此，该问题被认为是有效的。\n\n### 基于原则的设计和解决方案演练\n\n核心任务是识别代谢网络中的合成致死反应对。一个合成致死对 $(i, j)$ 是一对反应，它们对于细胞目标（此处为生物质生成）来说单独是非必需的，但联合起来是必需的。同时移除它们会导致目标函数失效。这种现象通常源于代谢通路中的冗余，即两个或多个反应或通路可以执行等效功能。\n\n**1. 通量平衡分析（FBA）公式化**\n\n分析的基础是稳态假设，该假设假定在相关时间尺度上，内源代谢物的浓度不发生变化。这表示为每个代谢物的质量平衡方程：\n$$\nS v = 0\n$$\n其中 $S$ 是 $m \\times n$ 的化学计量矩阵，代表 $m$ 种代谢物和 $n$ 个反应，$v$ 是 $n$ 个反应通量的向量。\n\n每个通量 $v_k$ 的可能范围受到下界 $\\ell_k$ 和上界 $u_k$ 的约束：\n$$\n\\ell \\le v \\le u\n$$\n这些边界可以代表热力学约束（例如，不可逆性，$v_k \\ge 0$）或营养吸收或酶容量的限制。\n\n细胞目标被假定为最大化一个特定的生物功能，建模为通过生物质反应的通量 $v_b$。这被表述为一个线性规划（LP）问题：\n$$\n\\text{maximize} \\quad c^\\top v \\quad \\text{subject to} \\quad S v = 0, \\quad \\ell \\le v \\le u\n$$\n其中目标向量 $c$ 的定义为 $c_b=1$ 且所有其他分量为零。\n\n**2. 定义和识别合成致死对**\n\n从一组可删除反应 $D$ 中选出的一对反应 $(i,j)$ 被定义为合成致死，如果它满足三个条件，并根据数值容差 $\\tau = 10^{-7}$ 进行检查：\n1.  **单个删除 $i$ 的可行性**：当反应 $i$ 被删除时，最大生物质通量大于 $\\tau$。\n2.  **单个删除 $j$ 的可行性**：当反应 $j$ 被删除时，最大生物质通量大于 $\\tau$。\n3.  **双重删除 $(i,j)$ 的致死性**：当反应 $i$ 和 $j$ 都被删除时，最大生物质通量小于或等于 $\\tau$。\n\n一个反应的删除在计算上通过将其通量边界设置为零来建模，即对于一个被删除的反应 $k$，我们设置 $\\ell_k = 0$ 和 $u_k = 0$。\n\n**3. 算法方法**\n\n为了找到每个给定网络的字典序最小合成致死对，我们将采用一种系统搜索算法：\n1.  对于每个测试案例（网络），获取可删除反应的集合 $D$。\n2.  从 $D$ 中生成所有唯一的对 $(i, j)$，使得 $i  j$。为确保首先找到字典序最小的对，搜索应按 $i$ 递增的顺序进行，对于每个 $i$，再按 $j$ 递增的顺序进行。\n3.  对于每个候选对 $(i, j)$：\n    a.  删除反应 $i$ 并解决 FBA 问题。检查最优生物质通量是否  $\\tau$。\n    b.  如果是，则删除反应 $j$ 并解决 FBA 问题。检查最优生物质通量是否  $\\tau$。\n    c.  如果两个单次删除都是可行的，则同时删除反应 $i$ 和 $j$ 并解决 FBA 问题。检查最优生物质通量是否 $\\le \\tau$。\n4.  第一个满足所有三个条件的对 $(i,j)$ 是字典序最小的合成致死对。我们记录这个对，然后处理下一个测试案例。\n5.  如果搜索完成而没有找到任何这样的对，则该网络中不存在合成致死对，我们记录一个空列表。\n\n线性规划问题将使用 `scipy.optimize.linprog` 来解决。由于该函数执行最小化，最大化 $c^\\top v$ 的目标被转换为最小化 $-c^\\top v$。\n\n**4. 测试案例分析**\n\n*   **情况1**：该网络有两个平行反应（$R_1, R_2$），它们从底物 $A$ 产生必需的生物质前体 $X$。\n    - $R_0: \\rightarrow A$\n    - $R_1: A \\rightarrow X$\n    - $R_2: A \\rightarrow X$\n    - $R_3: X \\rightarrow \\text{Biomass}$\n    反应 $R_1$ 和 $R_2$ 是冗余的。单独删除任何一个，另一个仍能维持到 $X$ 的通量，因此生物质生成是可行的。同时删除 $R_1$ 和 $R_2$ 会切断从 $A$ 到 $X$ 的连接，使得生物质生成不可能。可删除集合为 $D=\\{1, 2\\}$，因此唯一可能的对是 $(1, 2)$，它是合成致死的。\n\n*   **情况2**：该网络有两种替代途径从 $A$ 产生前体 $X$：一个直接捷径（$R_3$）和一个两步通路（$R_1, R_2$）。\n    - $R_0: \\rightarrow A$\n    - 路径 1: $R_1: A \\rightarrow Y$，然后 $R_2: Y \\rightarrow X$\n    - 路径 2: $R_3: A \\rightarrow X$ (捷径)\n    - $R_4: X \\rightarrow \\text{Biomass}$\n    可删除的反应是 $D=\\{1, 2, 3\\}$。我们寻找字典序最小的合成致死对。候选对有 $(1,2)$、$(1,3)$、$(2,3)$。\n    - 删除对 $(1,2)$ 不是致死的，因为捷径 $R_3$ 仍然存在。\n    - 删除对 $(1,3)$ 是致死的。它敲除了捷径（$R_3$）和替代路径的入口点（$R_1$）。单独删除 $R_1$ 或 $R_3$ 都不是致死的。因此，$(1,3)$ 是一个合成致死对。\n    - 由于我们按字典序搜索，$(1,3)$ 是第一个找到的，并且是答案。\n\n*   **情况3**：该网络是一个简单的线性通路。\n    - $R_0: \\rightarrow A$\n    - $R_1: A \\rightarrow X$\n    - $R_2: X \\rightarrow \\text{Biomass}$\n    反应 $R_1$ 对生物质生成是必需的。仅删除它本身就将是致死的。根据合成致死的定义（其中单个删除必须是可行的），如果一个反应本身是必需的，它就不能成为合成致死对的一部分。此外，可删除集合 $D=\\{1\\}$ 只包含一个反应，无法形成不同反应的对。因此，不存在合成致死对。\n\n这一详细分析证实了理论预期，并为实现提供了信息。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\nimport itertools\n\ndef solve():\n    \"\"\"\n    Solves for the lexicographically smallest synthetic lethal pair in a set of metabolic networks.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"S\": np.array([\n                [1, -1, -1, 0],\n                [0, 1, 1, -1]\n            ]),\n            \"l\": np.array([0, 0, 0, 0]),\n            \"u\": np.array([10, 1000, 1000, 1000]),\n            \"b\": 3,\n            \"D\": [1, 2]\n        },\n        {\n            \"S\": np.array([\n                [1, -1, 0, -1, 0],\n                [0, 1, -1, 0, 0],\n                [0, 0, 1, 1, -1]\n            ]),\n            \"l\": np.array([0, 0, 0, 0, 0]),\n            \"u\": np.array([10, 1000, 1000, 1000, 1000]),\n            \"b\": 4,\n            \"D\": [1, 2, 3]\n        },\n        {\n            \"S\": np.array([\n                [1, -1, 0],\n                [0, 1, -1]\n            ]),\n            \"l\": np.array([0, 0, 0]),\n            \"u\": np.array([10, 1000, 1000]),\n            \"b\": 2,\n            \"D\": [1]\n        }\n    ]\n\n    tau = 1e-7\n    results = []\n\n    def run_fba(S, l, u, b):\n        \"\"\"\n        Performs Flux Balance Analysis to maximize biomass flux.\n        \n        Args:\n            S (np.ndarray): Stoichiometric matrix.\n            l (np.ndarray): Lower flux bounds.\n            u (np.ndarray): Upper flux bounds.\n            b (int): Index of the biomass reaction.\n\n        Returns:\n            float: The maximum biomass flux.\n        \"\"\"\n        num_reactions = S.shape[1]\n        c_obj = np.zeros(num_reactions)\n        c_obj[b] = -1  # To maximize v_b, we minimize -v_b\n\n        # Bounds must be a sequence of (min, max) tuples\n        bounds = list(zip(l, u))\n        \n        # A_eq @ x == b_eq\n        A_eq = S\n        b_eq = np.zeros(S.shape[0])\n\n        res = linprog(c=c_obj, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n\n        if res.success:\n            return -res.fun\n        else:\n            return 0.0\n\n    for case in test_cases:\n        S, l_orig, u_orig, b, D = case[\"S\"], case[\"l\"], case[\"u\"], case[\"b\"], case[\"D\"]\n        sl_pair_found = None\n\n        # Sort D to ensure lexicographical order of pairs\n        D.sort()\n        \n        # Generate pairs (i, j) with i  j\n        candidate_pairs = list(itertools.combinations(D, 2))\n\n        for i, j in candidate_pairs:\n            # Condition 1: Check single deletion of i\n            l_del_i, u_del_i = l_orig.copy(), u_orig.copy()\n            l_del_i[i], u_del_i[i] = 0, 0\n            biomass_i = run_fba(S, l_del_i, u_del_i, b)\n            \n            if biomass_i  tau:\n                # Condition 2: Check single deletion of j\n                l_del_j, u_del_j = l_orig.copy(), u_orig.copy()\n                l_del_j[j], u_del_j[j] = 0, 0\n                biomass_j = run_fba(S, l_del_j, u_del_j, b)\n                \n                if biomass_j  tau:\n                    # Condition 3: Check double deletion of i and j\n                    l_del_ij, u_del_ij = l_orig.copy(), u_orig.copy()\n                    l_del_ij[i], u_del_ij[i] = 0, 0\n                    l_del_ij[j], u_del_ij[j] = 0, 0\n                    biomass_ij = run_fba(S, l_del_ij, u_del_ij, b)\n\n                    if biomass_ij = tau:\n                        sl_pair_found = [i, j]\n                        break  # Found the lexicographically smallest pair\n\n        if sl_pair_found:\n            results.append(sl_pair_found)\n        else:\n            results.append([])\n    \n    # Format the final output string exactly as specified\n    final_str_parts = []\n    for res in results:\n        if res:\n            final_str_parts.append(f\"[{res[0]},{res[1]}]\")\n        else:\n            final_str_parts.append(\"[]\")\n    final_output = f\"[{','.join(final_str_parts)}]\"\n\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}