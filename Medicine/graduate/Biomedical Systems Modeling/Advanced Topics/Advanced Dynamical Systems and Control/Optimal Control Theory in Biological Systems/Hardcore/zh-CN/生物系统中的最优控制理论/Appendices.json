{
    "hands_on_practices": [
        {
            "introduction": "应用最优控制理论始于掌握庞特里亚金极大值原理（Pontryagin's Maximum Principle, PMP）。本练习将通过一个经典的葡萄糖-胰岛素调节模型，提供对PMP的基础实践。你将推导哈密顿量（Hamiltonian）和协态动力学方程，它们构成了最优性必要条件的核心，并由此确定最优的胰岛素输注策略。",
            "id": "3914940",
            "problem": "考虑外源性胰岛素输注期间的单一个个体葡萄糖-胰岛素调节模型。葡萄糖状态、胰岛素作用和血浆胰岛素分别由 $G(t)$、$X(t)$ 和 $I(t)$ 表示。外源性碳水化合物扰动 $D(t)$ 是已知的非负函数，控制输入 $u(t)$ 是外部输注的胰岛素。令 $G_{\\mathrm{b}}$ 表示基础葡萄糖水平，$G_{\\mathrm{ref}}$ 表示期望的葡萄糖设定点。动力学由以下方程指定：\n$$\n\\begin{aligned}\n\\dot{G}(t) = -k_{g}\\big(G(t)-G_{\\mathrm{b}}\\big) - X(t)\\,G(t) + D(t), \\\\\n\\dot{X}(t) = -k_{x} X(t) + s\\, I(t), \\\\\n\\dot{I}(t) = -k_{i} I(t) + u(t),\n\\end{aligned}\n$$\n其中 $k_{g}>0$、$k_{x}>0$、$k_{i}>0$ 和 $s>0$ 是已知的生理参数。控制是有界的，$0 \\leq u(t) \\leq u_{\\max}$，时间域为 $t\\in[0,T]$，其中 $T>0$。性能指标通过以下方式惩罚葡萄糖偏移和控制能量：\n$$\nJ[u] \\;=\\; \\frac{1}{2} \\int_{0}^{T} \\left( q\\,\\big(G(t)-G_{\\mathrm{ref}}\\big)^{2} \\;+\\; r\\, u(t)^{2} \\right)\\, dt \\;+\\; \\frac{1}{2}\\, p\\,\\big(G(T)-G_{\\mathrm{ref}}\\big)^{2},\n$$\n其中 $q>0$、$r>0$ 和 $p\\ge 0$ 是权重系数，$G_{\\mathrm{ref}}$ 是常数。\n\n使用庞特里亚金极大值原理（Pontryagin Maximum Principle, PMP），从第一性原理推导哈密顿函数 $H(x,\\lambda,u,t)$ 和协态动力学 $\\dot{\\lambda}(t) = -\\partial H/\\partial x$，其中 $x(t) = \\big(G(t), X(t), I(t)\\big)^{\\top}$，协态为 $\\lambda(t) = \\big(\\lambda_{G}(t), \\lambda_{X}(t), \\lambda_{I}(t)\\big)^{\\top}$。然后，确定该输入仿射系统的平稳控制律 $u^{\\ast}(t)$，用开关函数表示，并明确考虑控制边界。\n\n将您的最终结果按以下顺序在一个单行矩阵中表示：\n1) 哈密顿函数 $H$，\n2) 作为三元组 $\\big(\\dot{\\lambda}_{G},\\dot{\\lambda}_{X},\\dot{\\lambda}_{I}\\big)$ 的协态动力学，\n3) 用开关函数明确给出的平稳控制 $u^{\\ast}(t)$。\n\n不需要进行数值计算。您的最终答案必须是单一的闭式解析表达式。如果使用任何缩写，请在首次出现时写出其全称。不要包含单位。",
            "solution": "用户提供了一个应用于生物系统的最优控制理论问题。任务是使用庞特里亚金极大值原理（PMP）推导哈密顿函数、协态动力学和最优控制律。\n\n### 第1步：提取已知条件\n\n状态向量为 $x(t) = \\big(G(t), X(t), I(t)\\big)^{\\top}$，分别代表葡萄糖浓度、胰岛素作用和血浆胰岛素。控制输入是外部胰岛素输注率 $u(t)$。\n\n状态动力学由以下常微分方程组给出：\n$$\n\\begin{aligned}\n\\dot{G}(t) = -k_{g}\\big(G(t)-G_{\\mathrm{b}}\\big) - X(t)\\,G(t) + D(t) \\\\\n\\dot{X}(t) = -k_{x} X(t) + s\\, I(t) \\\\\n\\dot{I}(t) = -k_{i} I(t) + u(t)\n\\end{aligned}\n$$\n参数 $k_{g}$、$k_{x}$、$k_{i}$ 和 $s$ 是正常数。$G_{\\mathrm{b}}$ 是基础葡萄糖水平，为一个常数。$D(t)$ 是一个已知的非负扰动函数。\n\n控制输入是有界的：$0 \\leq u(t) \\leq u_{\\max}$。\n\n需要最小化的性能指标（代价泛函）是：\n$$\nJ[u] \\;=\\; \\frac{1}{2} \\int_{0}^{T} \\left( q\\,\\big(G(t)-G_{\\mathrm{ref}}\\big)^{2} \\;+\\; r\\, u(t)^{2} \\right)\\, dt \\;+\\; \\frac{1}{2}\\, p\\,\\big(G(T)-G_{\\mathrm{ref}}\\big)^{2}\n$$\n权重系数 $q$、$r$ 是正数，$p$ 是非负数。$G_{\\mathrm{ref}}$ 是恒定的期望葡萄糖设定点。时间域为 $t \\in [0, T]$，其中 $T>0$。\n\n协态向量表示为 $\\lambda(t) = \\big(\\lambda_{G}(t), \\lambda_{X}(t), \\lambda_{I}(t)\\big)^{\\top}$。\n\n### 第2步：使用提取的已知条件进行验证\n\n1.  **科学依据：** 该问题使用了 Bergman 最小模型的一个简化版本，这是一个广泛接受的葡萄糖-胰岛素动力学数学模型。目标函数是标准二次型，用于在最优控制中惩罚偏离设定点和控制能量。该设置在科学和数学上都是合理的。\n2.  **适定性：** 问题提供了应用庞特里亚金极大值原理（PMP）所需的所有要素。动力学已定义，代价泛函已指定，控制约束已给出。对于这类问题，预期存在解。\n3.  **客观性：** 问题使用精确的数学语言陈述，没有歧义或主观因素。\n4.  **完整性和一致性：** 所有参数和函数都已定义。在推导哈密顿函数、协态方程和控制律的任务中，没有缺失数据或矛盾的约束。\n5.  **无其他缺陷：** 在数学建模的背景下，该问题并非微不足道、不适定或不切实际。\n\n### 第3步：结论与行动\n\n问题陈述有效。我将继续进行推导。\n\n### 使用庞特里亚金极大值原理（PMP）进行推导\n\nPMP为最优控制提供了必要条件。它涉及定义哈密顿函数并分析其性质。\n\n**1. 哈密顿函数**\n\n哈密顿函数 $H(x, \\lambda, u, t)$ 定义为 $H = L + \\lambda^{\\top}f$，其中 $L(x, u, t)$ 是代价泛函的被积函数，$f(x, u, t)$ 是状态动力学的向量场。\n\n被积函数 $L$ 为：\n$$\nL(G, X, I, u) = \\frac{1}{2} q \\left(G - G_{\\mathrm{ref}}\\right)^{2} + \\frac{1}{2} r u^{2}\n$$\n状态动力学向量 $f$ 为：\n$$\nf(G, X, I, u, t) = \\begin{pmatrix} -k_{g}\\big(G-G_{\\mathrm{b}}\\big) - XG + D(t) \\\\ -k_{x} X + sI \\\\ -k_{i} I + u \\end{pmatrix}\n$$\n因此，哈密顿函数为：\n$$\nH = L + \\lambda_{G} \\dot{G} + \\lambda_{X} \\dot{X} + \\lambda_{I} \\dot{I}\n$$\n代入 $L$ 和状态导数的表达式，得到哈密顿函数，为清晰起见，省略了变量的时间依赖性：\n$$\nH = \\frac{1}{2} q \\left(G - G_{\\mathrm{ref}}\\right)^{2} + \\frac{1}{2} r u^{2} + \\lambda_{G} \\left(-k_{g}(G - G_{\\mathrm{b}}) - XG + D(t)\\right) + \\lambda_{X} \\left(-k_{x} X + sI\\right) + \\lambda_{I} \\left(-k_{i} I + u\\right)\n$$\n\n**2. 协态动力学**\n\n协态（或伴随）方程由 $\\dot{\\lambda}(t) = -\\frac{\\partial H}{\\partial x}$ 给出。我们计算哈密顿函数对每个状态变量的偏导数。\n\n对于 $\\lambda_{G}$：\n$$\n\\frac{\\partial H}{\\partial G} = q\\left(G - G_{\\mathrm{ref}}\\right) + \\lambda_{G}\\left(-k_{g} - X\\right)\n$$\n$$\n\\dot{\\lambda}_{G} = -\\frac{\\partial H}{\\partial G} = -q\\left(G - G_{\\mathrm{ref}}\\right) + \\lambda_{G}\\left(k_{g} + X\\right)\n$$\n对于 $\\lambda_{X}$：\n$$\n\\frac{\\partial H}{\\partial X} = \\lambda_{G}(-G) + \\lambda_{X}(-k_{x}) = -G\\lambda_{G} - k_{x}\\lambda_{X}\n$$\n$$\n\\dot{\\lambda}_{X} = -\\frac{\\partial H}{\\partial X} = G\\lambda_{G} + k_{x}\\lambda_{X}\n$$\n对于 $\\lambda_{I}$：\n$$\n\\frac{\\partial H}{\\partial I} = \\lambda_{X}(s) + \\lambda_{I}(-k_{i}) = s\\lambda_{X} - k_{i}\\lambda_{I}\n$$\n$$\n\\dot{\\lambda}_{I} = -\\frac{\\partial H}{\\partial I} = -s\\lambda_{X} + k_{i}\\lambda_{I}\n$$\n因此，协态动力学是以下三元组：\n$$\n\\left(\\dot{\\lambda}_{G}, \\dot{\\lambda}_{X}, \\dot{\\lambda}_{I}\\right) = \\left(-q(G - G_{\\mathrm{ref}}) + \\lambda_{G}(k_{g} + X), \\quad G\\lambda_{G} + k_{x}\\lambda_{X}, \\quad -s\\lambda_{X} + k_{i}\\lambda_{I}\\right)\n$$\n\n**3. 平稳控制律**\n\n根据PMP，最优控制 $u^{\\ast}(t)$ 必须在每个时间 $t$ 在容许控制集 $\\mathcal{U} = [0, u_{\\max}]$ 上使哈密顿函数 $H$ 最小化。\n哈密顿函数是 $u$ 的函数：\n$$\nH(u) = \\frac{1}{2} r u^{2} + \\lambda_{I} u + (\\text{terms not involving } u)\n$$\n由于 $r > 0$，$H(u)$ 是关于 $u$ 的凸抛物线。为了找到其最小值，我们计算其对 $u$ 的导数：\n$$\n\\frac{\\partial H}{\\partial u} = ru + \\lambda_{I}\n$$\n将导数设为零，得到无约束最小值在 $u = -\\frac{\\lambda_{I}}{r}$。\n\n为了考虑边界 $0 \\leq u \\leq u_{\\max}$，我们将此无约束解投影到容许区间 $[0, u_{\\max}]$ 上。这产生了一个饱和控制律。分析如下：\n- 如果 $-\\frac{\\lambda_{I}}{r}  0$，等价于 $\\lambda_{I}  0$，则增函数 $H(u)$ 在 $[0, u_{\\max}]$ 上的最小值出现在下界，即 $u^{\\ast} = 0$。\n- 如果 $-\\frac{\\lambda_{I}}{r} > u_{\\max}$，等价于 $\\lambda_{I}  -r u_{\\max}$，则减函数 $H(u)$ 在 $[0, u_{\\max}]$ 上的最小值出现在上界，即 $u^{\\ast} = u_{\\max}$。\n- 如果 $0 \\leq -\\frac{\\lambda_{I}}{r} \\leq u_{\\max}$，等价于 $-r u_{\\max} \\leq \\lambda_{I} \\leq 0$，则无约束最小值位于容许区间内，因此 $u^{\\ast} = -\\frac{\\lambda_{I}}{r}$。\n\n问题提到了“开关函数”。在此背景下，协态 $\\lambda_{I}(t)$ 充当开关函数，因为其值决定了哪个控制区域（下界、上界或内部）是活动的。最优控制律 $u^{\\ast}(t)$ 明确表示为该开关函数 $\\lambda_{I}(t)$ 的分段函数：\n$$\nu^{\\ast}(t) = \\begin{cases} u_{\\max}  \\text{for } \\lambda_I(t)  -r u_{\\max} \\\\ -\\frac{\\lambda_I(t)}{r}  \\text{for } -r u_{\\max} \\le \\lambda_I(t) \\le 0 \\\\ 0  \\text{for } \\lambda_I(t)  0 \\end{cases}\n$$\n至此完成了所需的推导。结果将按照指定的矩阵格式进行组合。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{2} q (G - G_{\\mathrm{ref}})^{2} + \\frac{1}{2} r u^{2} + \\lambda_{G} (-k_{g}(G - G_{\\mathrm{b}}) - XG + D(t)) + \\lambda_{X} (-k_{x} X + sI) + \\lambda_{I} (-k_{i} I + u)  \\begin{pmatrix} -q(G - G_{\\mathrm{ref}}) + \\lambda_{G}(k_{g} + X) \\\\ G\\lambda_{G} + k_{x}\\lambda_{X} \\\\ -s\\lambda_{X} + k_{i}\\lambda_{I} \\end{pmatrix}  \\begin{cases} u_{\\max}  \\text{if } \\lambda_I  -r u_{\\max} \\\\ -\\frac{\\lambda_I}{r}  \\text{if } -r u_{\\max} \\le \\lambda_I \\le 0 \\\\ 0  \\text{if } \\lambda_I > 0 \\end{cases} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "虽然最小化哈密顿量是PMP的核心，但某些问题，特别是控制变量线性出现的问题，会导致无法直接确定最优控制的情况。这引出了需要进一步分析的“奇异弧”（singular arcs）概念，这在许多生物优化问题中至关重要。本练习将深入探讨这一高级主题，指导你确定奇异控制的条件，并为一个基因表达模型推导出相应的反馈控制律。",
            "id": "3914914",
            "problem": "考虑一个关于非零基础工作点的、受光遗传调控的单一蛋白质的线性化两阶段基因表达模型。设状态向量为 $x(t) = \\begin{pmatrix} m(t) \\\\ p(t) \\end{pmatrix}$，其中 $m(t)$ 是信使核糖核酸 (mRNA) 浓度与基线的偏差，$p(t)$ 是蛋白质浓度与基线的偏差。标量控制 $u(t)$ 表示转录起始率与基线的偏差，由于小信号线性化，允许取正值或负值。其动力学为\n$$\n\\dot{m}(t) = k_{m}\\,u(t) - \\delta_{m}\\,m(t), \\qquad\n\\dot{p}(t) = k_{p}\\,m(t) - \\delta_{p}\\,p(t),\n$$\n其中参数 $k_{m}$、$k_{p}$、$\\delta_{m}$ 和 $\\delta_{p}$ 均为严格正值。考虑在 $[0,T]$ 上的有限时域最优控制问题，其代价泛函为\n$$\nJ[u] = \\int_{0}^{T} \\left( \\tfrac{1}{2}\\,q_{m}\\,m(t)^{2} + \\tfrac{1}{2}\\,q_{p}\\,p(t)^{2} + \\rho\\,u(t) \\right)\\,dt,\n$$\n其中 $q_{m}0$、$q_{p}0$ 且 $\\rho0$。为了进行奇异弧分析，不设终端代价，也没有显式的控制边界。\n\n使用庞特里亚金最大值原理（PMP）进行最小化，分析最优性的必要条件，并确定是否存在奇异弧。如果存在，确定其奇异阶数（使得开关函数的 $r$ 阶时间导数显式地依赖于 $u$ 的最小整数 $r \\geq 0$），并计算相应的奇异控制律 $u_{\\mathrm{sing}}(t)$，该控制律纯粹用 $m(t)$、$p(t)$ 和模型参数表示。假设协态是绝对连续的，并且所有函数对于所需的微分都足够光滑。\n\n你的最终答案必须是一个包含两个条目的行矩阵：第一个条目是奇异阶数的整数值，第二个条目是奇异控制的闭式表达式。不需要进行数值计算；用符号形式表示最终结果。如果你选择定义任何中间符号，请在最终表达式中将它们消去，以使奇异控制直接由 $m(t)$、$p(t)$ 和给定参数表示。",
            "solution": "该问题陈述有效。这是一个形式完善的最优控制问题，基于系统生物学和控制理论的标准原理。系统动力学代表了一个线性化的两阶段基因表达模型，这是一个常见且科学上合理的构造。目标泛函定义清晰，所有参数都规定了必要的条件（例如，正性）。任务要求应用庞特里亚金最大值原理（PMP）来分析奇异弧，这是最优控制理论中的标准程序。该问题是自洽的、数学上一致的，并且没有任何科学或逻辑上的缺陷。\n\n我们应用庞特里亚金最大值原理进行最小化。状态向量为 $x(t) = \\begin{pmatrix} m(t) \\\\ p(t) \\end{pmatrix}$，协态向量为 $\\lambda(t) = \\begin{pmatrix} \\lambda_m(t) \\\\ \\lambda_p(t) \\end{pmatrix}$。该系统的哈密顿量 $H$ 定义为：\n$$\nH(x, u, \\lambda) = L(x, u) + \\lambda^{T}f(x, u)\n$$\n其中 $L(x, u) = \\tfrac{1}{2}\\,q_{m}\\,m(t)^{2} + \\tfrac{1}{2}\\,q_{p}\\,p(t)^{2} + \\rho\\,u(t)$ 是代价泛函的被积函数，$f(x, u)$ 是描述系统动力学的向量场。\n代入给定的表达式，哈密顿量为：\n$$\nH = \\left( \\tfrac{1}{2}\\,q_{m}\\,m^{2} + \\tfrac{1}{2}\\,q_{p}\\,p^{2} + \\rho\\,u \\right) + \\lambda_{m}(k_{m}\\,u - \\delta_{m}\\,m) + \\lambda_{p}(k_{p}\\,m - \\delta_{p}\\,p)\n$$\n我们可以根据控制输入 $u(t)$ 对各项进行重新组合：\n$$\nH = (k_{m}\\lambda_{m} + \\rho)u + \\tfrac{1}{2}\\,q_{m}\\,m^{2} + \\tfrac{1}{2}\\,q_{p}\\,p^{2} - \\delta_{m}\\lambda_{m}m + k_{p}\\lambda_{p}m - \\delta_{p}\\lambda_{p}p\n$$\nPMP 指出，最优控制 $u^{*}(t)$ 必须在每个时间 $t \\in [0,T]$ 最小化哈密顿量 $H$。由于哈密顿量在控制 $u$ 上是线性的，最小化控制取决于其系数的符号，该系数被称为开关函数 $\\Phi(t)$。\n$$\n\\Phi(t) = \\frac{\\partial H}{\\partial u} = k_{m}\\lambda_{m}(t) + \\rho\n$$\n由于对 $u$ 没有显式边界，非奇异最优控制将是无穷幅值的“砰砰”控制，这在物理上是不现实的，并表明最优轨迹可能位于奇异弧上。如果开关函数在一个有限时间区间内为零，即对于 $t \\in [t_1, t_2] \\subseteq [0,T]$ 有 $\\Phi(t) = 0$，则可能出现奇异弧。为使此条件成立，$\\Phi(t)$ 的所有时间导数在此区间内也必须为零。\n\n奇异阶数 $r$ 是使 $\\Phi(t)$ 的 $r$ 阶全时间导数（记为 $\\Phi^{(r)}(t)$）显式地依赖于控制 $u(t)$ 的最小整数。我们计算这些导数。\n\n为使奇异弧存在，第一个条件是：\n$$\n\\Phi(t) = k_{m}\\lambda_{m}(t) + \\rho = 0\n$$\n这意味着在奇异弧上，协态 $\\lambda_m(t)$ 必须为常数：\n$$\n\\lambda_{m}(t) = -\\frac{\\rho}{k_{m}}\n$$\n这是零阶条件（$r=0$）。它不包含 $u$。我们接着计算一阶导数 $\\dot{\\Phi}(t)$。\n$$\n\\dot{\\Phi}(t) = k_{m}\\dot{\\lambda}_{m}(t)\n$$\n协态动力学由 $\\dot{\\lambda} = -\\frac{\\partial H}{\\partial x}$ 给出。\n$$\n\\dot{\\lambda}_{m} = -\\frac{\\partial H}{\\partial m} = -\\left( q_{m}m - \\delta_{m}\\lambda_{m} + k_{p}\\lambda_{p} \\right) = -q_{m}m + \\delta_{m}\\lambda_{m} - k_{p}\\lambda_{p}\n$$\n$$\n\\dot{\\lambda}_{p} = -\\frac{\\partial H}{\\partial p} = -\\left( q_{p}p - \\delta_{p}\\lambda_{p} \\right) = -q_{p}p + \\delta_{p}\\lambda_{p}\n$$\n因此，开关函数的一阶导数为：\n$$\n\\dot{\\Phi}(t) = k_{m}(-q_{m}m + \\delta_{m}\\lambda_{m} - k_{p}\\lambda_{p})\n$$\n这个 $\\dot{\\Phi}(t)$ 的表达式不显式地依赖于 $u(t)$。对于奇异弧，我们要求 $\\dot{\\Phi}(t) = 0$。\n$$\n-q_{m}m(t) + \\delta_{m}\\lambda_{m}(t) - k_{p}\\lambda_{p}(t) = 0\n$$\n代入由 $\\Phi(t)=0$ 条件得到的 $\\lambda_{m}(t)$ 的常数值：\n$$\n-q_{m}m(t) + \\delta_{m}\\left(-\\frac{\\rho}{k_{m}}\\right) - k_{p}\\lambda_{p}(t) = 0\n$$\n这使我们能够用状态 $m(t)$ 沿奇异弧表示协态 $\\lambda_p(t)$：\n$$\n\\lambda_{p}(t) = -\\frac{q_{m}}{k_{p}}m(t) - \\frac{\\rho\\delta_{m}}{k_{m}k_{p}}\n$$\n现在，我们计算二阶时间导数 $\\ddot{\\Phi}(t)$。\n$$\n\\ddot{\\Phi}(t) = \\frac{d}{dt}\\left( \\dot{\\Phi}(t) \\right) = k_{m}(-q_{m}\\dot{m} + \\delta_{m}\\dot{\\lambda}_{m} - k_{p}\\dot{\\lambda}_{p})\n$$\n在奇异弧上，$\\lambda_m(t)$ 是常数，所以 $\\dot{\\lambda}_m(t)=0$。表达式简化为：\n$$\n\\ddot{\\Phi}(t) = k_{m}(-q_{m}\\dot{m} - k_{p}\\dot{\\lambda}_{p})\n$$\n我们代入状态和协态动力学的表达式：\n$\\dot{m}(t) = k_{m}u(t) - \\delta_{m}m(t)$\n$\\dot{\\lambda}_{p}(t) = -q_{p}p(t) + \\delta_{p}\\lambda_{p}(t)$\n将这些代入 $\\ddot{\\Phi}(t)$：\n$$\n\\ddot{\\Phi}(t) = k_{m}\\left( -q_{m}(k_{m}u - \\delta_{m}m) - k_{p}(-q_{p}p + \\delta_{p}\\lambda_{p}) \\right)\n$$\n$$\n\\ddot{\\Phi}(t) = k_{m}\\left( -q_{m}k_{m}u + q_{m}\\delta_{m}m + k_{p}q_{p}p-k_{p}\\delta_{p}\\lambda_{p} \\right)\n$$\n控制 $u(t)$ 首次显式地出现在开关函数的二阶导数中。因此，奇异阶数为 $r=2$。\n\n为了求出奇异控制 $u_{\\mathrm{sing}}(t)$，我们令 $\\ddot{\\Phi}(t)=0$ 并解出 $u$：\n$$\n-q_{m}k_{m}u_{\\mathrm{sing}} + q_{m}\\delta_{m}m + k_{p}q_{p}p - k_{p}\\delta_{p}\\lambda_{p} = 0\n$$\n$$\nu_{\\mathrm{sing}}(t) = \\frac{1}{q_{m}k_{m}}\\left( q_{m}\\delta_{m}m(t) + k_{p}q_{p}p(t) - k_{p}\\delta_{p}\\lambda_{p}(t) \\right)\n$$\n这个表达式目前依赖于协态 $\\lambda_p(t)$。我们使用从 $\\dot{\\Phi}(t)=0$ 条件导出的关系来消去它：\n$$\n\\lambda_{p}(t) = -\\frac{q_{m}}{k_{p}}m(t) - \\frac{\\rho\\delta_{m}}{k_{m}k_{p}}\n$$\n将此代入 $u_{\\mathrm{sing}}(t)$ 的表达式中：\n$$\nu_{\\mathrm{sing}}(t) = \\frac{1}{q_{m}k_{m}}\\left[ q_{m}\\delta_{m}m(t) + k_{p}q_{p}p(t) - k_{p}\\delta_{p}\\left(-\\frac{q_{m}}{k_{p}}m(t) - \\frac{\\rho\\delta_{m}}{k_{m}k_{p}}\\right) \\right]\n$$\n$$\nu_{\\mathrm{sing}}(t) = \\frac{1}{q_{m}k_{m}}\\left[ q_{m}\\delta_{m}m(t) + k_{p}q_{p}p(t) + q_{m}\\delta_{p}m(t) + \\frac{\\rho\\delta_{m}\\delta_{p}}{k_{m}} \\right]\n$$\n对含 $m(t)$ 的项进行分组并简化：\n$$\nu_{\\mathrm{sing}}(t) = \\frac{1}{q_{m}k_{m}}\\left[ q_{m}(\\delta_{m}+\\delta_{p})m(t) + q_{p}k_{p}p(t) + \\frac{\\rho\\delta_{m}\\delta_{p}}{k_{m}} \\right]\n$$\n最后，分配外面的项，得到作为状态和系统参数函数的奇异控制：\n$$\nu_{\\mathrm{sing}}(t) = \\frac{\\delta_{m} + \\delta_{p}}{k_{m}} m(t) + \\frac{q_{p}k_{p}}{q_{m}k_{m}} p(t) + \\frac{\\rho\\delta_{m}\\delta_{p}}{q_{m}k_{m}^{2}}\n$$\n这表示一个带有仿射偏移的线性状态反馈控制律。\n\n答案的两个部分是奇异阶数 $r=2$ 和推导出的 $u_{\\mathrm{sing}}(t)$ 的表达式。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 2  \\frac{\\delta_{m}+\\delta_{p}}{k_{m}}m(t) + \\frac{q_{p}k_{p}}{q_{m}k_{m}}p(t) + \\frac{\\rho\\delta_{m}\\delta_{p}}{q_{m}k_{m}^{2}} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "对于复杂的现实世界生物系统，通过PMP获得解析解通常是不可行的，因此数值方法至关重要。本练习通过引入直接配置法（direct collocation），将连续时间理论与实际计算联系起来，该方法将最优控制问题转化为一个非线性规划（Nonlinear Programming, NLP）问题。你将为离散化后的系统推导卡罗需-库恩-塔克（Karush-Kuhn-Tucker, KKT）条件，并理解它们如何在离散框架下对应于PMP的必要条件。",
            "id": "3914945",
            "problem": "考虑一个化疗给药下的肿瘤细胞群体单室模型，其中质量守恒和在标称工作点附近的线性化得到在持续时间为 $h0$ 的给药间隔内的受控动力学 $\\dot{x}(t) = a\\,x(t) + b\\,u(t)$。此处，$x(t)$ 是肿瘤细胞数量，$u(t)$ 是给药速率，$a$ 是局部肿瘤净增长率常数，$b$ 是将给药速率映射到肿瘤生长净减少量的局部药物疗效系数。假设每个间隔做一次给药决策，并在配置阶段保持该决策不变。\n\n使用隐式中点直接配置法在单个区间 $\\left[0,h\\right]$ 上对动力学进行离散化。引入决策变量 $x_c$、$u_c$ 和 $x_1$，分别表示配置点的状态和控制，以及区间末端的状态，其中初始状态 $x_0$ 已知。直接配置等式为\n$$\nx_c = x_0 + \\frac{h}{2}\\,f(x_c,u_c), \\qquad x_1 = x_0 + h\\,f(x_c,u_c),\n$$\n其中 $f(x,u) = a\\,x + b\\,u$。\n\n构建一个非线性规划 (Nonlinear Programming (NLP)) 问题，该问题最小化一个作为临床目标的标准二次代理\n$$\nJ(x_1,u_c) = \\frac{1}{2}\\,q\\,x_1^{2} + \\frac{1}{2}\\,r\\,u_c^{2},\n$$\n其中 $q0$ 惩罚终端肿瘤负荷，$r0$ 惩罚给药毒性，并受直接配置等式约束。从等式约束优化的 Karush-Kuhn-Tucker (KKT) 条件的基本定义出发，通过为配置方程引入拉格朗日乘子，推导此离散化最优控制问题的平稳性条件和可行性条件。然后，化简 KKT 系统，以获得最优配置控制 $u_c^{\\star}$ 仅作为 $a$、$b$、$q$、$r$、$h$ 和 $x_0$ 的函数的单个闭式解析表达式。\n\n解释所得 KKT 条件作为离散平衡法则的生物学意义：说明每个平稳性方程如何表达边际毒性与边际治疗效益之间的平衡，以及拉格朗日乘子如何作为影子价格，将肿瘤细胞的边际价值跨越配置阶段和区间末端进行传播。\n\n以符号形式给出 $u_c^{\\star}$ 的最终表达式。不要代入数值。最终表达式中不要包含单位。无需四舍五入。",
            "solution": "问题在于，在单个时间区间 $[0,h]$ 上找到最优恒定控制 $u_c$，以最小化二次成本函数，该问题受通过隐式中点配置法离散化的肿瘤细胞群体动力学约束。这可以构建为一个带等式约束的非线性规划 (NLP) 问题。\n\n该 NLP 的决策变量是配置状态 $x_c$、配置控制 $u_c$ 和终端状态 $x_1$。初始状态 $x_0$ 是一个给定参数。\n\n需要最小化的目标函数是：\n$$\nJ(x_1, u_c) = \\frac{1}{2} q x_1^2 + \\frac{1}{2} r u_c^2\n$$\n该问题受从隐式中点配置法推导出的两个等式约束：\n\\begin{align*}\nc_1(x_c, u_c, x_1) = x_c - x_0 - \\frac{h}{2} f(x_c, u_c) = 0 \\\\\nc_2(x_c, u_c, x_1) = x_1 - x_0 - h f(x_c, u_c) = 0\n\\end{align*}\n其中系统动力学函数为 $f(x,u) = ax + bu$。将其代入约束条件，得到：\n\\begin{align*}\nc_1(x_c, u_c, x_1) = x_c - x_0 - \\frac{h}{2}(a x_c + b u_c) = 0 \\label{eq:c1} \\\\\nc_2(x_c, u_c, x_1) = x_1 - x_0 - h(a x_c + b u_c) = 0 \\label{eq:c2}\n\\end{align*}\n为求解此约束优化问题，我们使用拉格朗日乘子法。我们通过将用拉格朗日乘子 $\\lambda_c$ 和 $\\lambda_1$ 加权的约束条件增广到目标函数中，来构造拉格朗日函数 $L$：\n$$\nL(x_c, u_c, x_1, \\lambda_c, \\lambda_1) = J(x_1, u_c) - \\lambda_c c_1(x_c, u_c, x_1) - \\lambda_1 c_2(x_c, u_c, x_1)\n$$\n代入 $J$ 和约束条件的表达式：\n$$\nL = \\frac{1}{2}q x_1^2 + \\frac{1}{2}r u_c^2 - \\lambda_c \\left( x_c - x_0 - \\frac{h}{2}(a x_c + b u_c) \\right) - \\lambda_1 \\left( x_1 - x_0 - h(a x_c + b u_c) \\right)\n$$\n最优性的一阶必要条件是 Karush-Kuhn-Tucker (KKT) 条件。对于此等式约束问题，这些条件包括平稳性条件和可行性条件。\n\n平稳性条件要求拉格朗日函数关于决策变量 $(x_c, u_c, x_1)$ 的梯度为零：\n\\begin{align*}\n\\frac{\\partial L}{\\partial x_c} = -\\lambda_c \\left(1 - \\frac{ah}{2}\\right) - \\lambda_1(-ah) = 0 \\label{eq:dLdxc} \\\\\n\\frac{\\partial L}{\\partial u_c} = r u_c - \\lambda_c \\left(-\\frac{bh}{2}\\right) - \\lambda_1(-bh) = 0 \\label{eq:dLduc} \\\\\n\\frac{\\partial L}{\\partial x_1} = q x_1 - \\lambda_1 = 0 \\label{eq:dLdx1}\n\\end{align*}\n可行性条件要求约束条件得到满足，这等价于将 $L$ 关于乘子的偏导数设为零：\n\\begin{align*}\n\\frac{\\partial L}{\\partial \\lambda_c} = -(x_c - x_0 - \\frac{h}{2}(a x_c + b u_c)) = 0 \\label{eq:dLdlamc} \\\\\n\\frac{\\partial L}{\\partial \\lambda_1} = -(x_1 - x_0 - h(a x_c + b u_c)) = 0 \\label{eq:dLdlam1}\n\\end{align*}\n这给出了一个关于五个未知数 $x_c$、$u_c$、$x_1$、$\\lambda_c$ 和 $\\lambda_1$ 的五方程系统。\n\n在求解该系统之前，我们可以解释这些 KKT 条件。\n可行性条件仅说明解必须遵循离散化的系统动力学。\n平稳性条件表达了类似经济学的平衡原则。拉格朗日乘子 $\\lambda_c$ 和 $\\lambda_1$被解释为影子价格，表示目标函数 $J$ 对于约束微小变化的边际成本（或灵敏度）。\n$1$. 条件 $\\frac{\\partial L}{\\partial x_1} = q x_1 - \\lambda_1 = 0$ 意味着 $\\lambda_1 = q x_1$。该方程将终端肿瘤群体的影子价格 $\\lambda_1$ 设为其边际惩罚 $\\frac{\\partial J}{\\partial x_1} = q x_1$。这是一个关于影子价格的终端边界条件。\n$2$. 条件 $\\frac{\\partial L}{\\partial u_c} = r u_c + \\frac{bh}{2}\\lambda_c + bh\\lambda_1 = 0$ 可写为 $r u_c = -(\\frac{bh}{2}\\lambda_c + bh\\lambda_1)$。左侧 $r u_c$ 代表药物剂量的边际毒性成本。右侧代表边际治疗效益，即通过施加控制 $u_c$ 所实现的总成本降低，该效益通过其对状态 $x_c$ 和 $x_1$ 的影响进行传播。最优性条件要求平衡此边际成本与边际效益。\n$3$. 条件 $\\frac{\\partial L}{\\partial x_c} = -\\lambda_c(1 - \\frac{ah}{2}) + ah\\lambda_1 = 0$，或 $\\lambda_c(1 - \\frac{ah}{2}) = ah\\lambda_1$，是一个离散伴随（或协态）方程。它将配置点处的影子价格 $\\lambda_c$ 与区间末端的影子价格 $\\lambda_1$ 联系起来。它描述了肿瘤群体的边际价值如何通过区间沿时间向后传播，并由参数 $a$ 所代表的肿瘤自然生长动力学进行调整。\n\n现在，我们求解该系统以得到 $u_c^{\\star}$。\n从 $\\frac{\\partial L}{\\partial x_1} = 0$ 可得 $\\lambda_1 = q x_1$。\n将此代入另外两个平稳性方程：\n\\begin{align*}\n-\\lambda_c\\left(1 - \\frac{ah}{2}\\right) + ah(q x_1) = 0 \\implies \\lambda_c = \\frac{ahq x_1}{1 - \\frac{ah}{2}} \\\\\nr u_c + \\frac{bh}{2}\\lambda_c + bh(q x_1) = 0\n\\end{align*}\n将 $\\lambda_c$ 的表达式代入第二个方程：\n$$\nr u_c + \\frac{bh}{2} \\left( \\frac{ahq x_1}{1 - \\frac{ah}{2}} \\right) + bhq x_1 = 0\n$$\n提取公因式 $bhq x_1$：\n$$\nr u_c + bhq x_1 \\left( \\frac{a h/2}{1 - ah/2} + 1 \\right) = 0\n$$\n化简括号中的项：\n$$\n\\frac{ah/2 + 1 - ah/2}{1 - ah/2} = \\frac{1}{1 - ah/2}\n$$\n方程变为：\n$$\nr u_c + \\frac{bhq x_1}{1 - ah/2} = 0\n$$\n这给出了最优控制 $u_c$ 和终端状态 $x_1$ 之间的直接关系：\n$$\nu_c = -\\frac{bhq}{r(1 - ah/2)} x_1\n$$\n接下来，我们必须用初始状态 $x_0$ 和系统参数来表示 $x_1$。我们使用两个可行性（配置）方程：\n\\begin{align*}\nx_c(1 - \\frac{ah}{2}) = x_0 + \\frac{bh}{2} u_c \\implies x_c = \\frac{x_0 + \\frac{bh}{2} u_c}{1 - \\frac{ah}{2}} \\\\\nx_1 = x_0 + h(a x_c + b u_c)\n\\end{align*}\n将 $x_c$ 的表达式代入 $x_1$ 的方程中：\n$$\nx_1 = x_0 + h \\left( a \\left( \\frac{x_0 + \\frac{bh}{2} u_c}{1 - \\frac{ah}{2}} \\right) + b u_c \\right)\n$$\n现在将用 $x_1$ 表示的 $u_c$ 的表达式代入此方程：\n$$\nx_1 = x_0 + h \\left( a \\frac{x_0 + \\frac{bh}{2} \\left(-\\frac{bhq}{r(1 - ah/2)} x_1\\right)}{1 - \\frac{ah}{2}} + b \\left(-\\frac{bhq}{r(1 - ah/2)} x_1\\right) \\right)\n$$\n这个方程只包含未知数 $x_1$。我们求解 $x_1$：\n$$\nx_1 = x_0 + \\frac{ahx_0}{1 - ah/2} - \\frac{ab^2h^3q}{2r(1 - ah/2)^2} x_1 - \\frac{b^2h^2q}{r(1 - ah/2)} x_1\n$$\n将含 $x_1$ 的项归到左边，将含 $x_0$ 的项归到右边：\n$$\nx_1 \\left( 1 + \\frac{ab^2h^3q}{2r(1 - ah/2)^2} + \\frac{b^2h^2q}{r(1 - ah/2)} \\right) = x_0 \\left( 1 + \\frac{ah}{1 - ah/2} \\right)\n$$\n化简两边。对于右边：\n$$\nx_0 \\left( \\frac{1 - ah/2 + ah}{1 - ah/2} \\right) = x_0 \\frac{1 + ah/2}{1 - ah/2}\n$$\n对于左边 $x_1$ 的系数：\n$$\n1 + \\frac{b^2h^2q}{r(1-ah/2)^2} \\left( \\frac{ah}{2} + (1 - \\frac{ah}{2}) \\right) = 1 + \\frac{b^2h^2q}{r(1-ah/2)^2}\n$$\n因此 $x_1$ 的方程变为：\n$$\nx_1 \\left( 1 + \\frac{b^2h^2q}{r(1-ah/2)^2} \\right) = x_0 \\frac{1 + ah/2}{1 - ah/2}\n$$\n$$\nx_1 \\left( \\frac{r(1-ah/2)^2 + b^2h^2q}{r(1-ah/2)^2} \\right) = x_0 \\frac{1 + ah/2}{1 - ah/2}\n$$\n$$\nx_1 = x_0 \\frac{1 + ah/2}{1 - ah/2} \\frac{r(1-ah/2)^2}{r(1-ah/2)^2 + b^2h^2q} = x_0 \\frac{r(1+ah/2)(1-ah/2)}{r(1-ah/2)^2 + b^2h^2q}\n$$\n最后，我们将这个 $x_1$ 的表达式代回我们关于 $u_c$ 的方程中：\n$$\nu_c^{\\star} = -\\frac{bhq}{r(1 - ah/2)} x_1 = -\\frac{bhq}{r(1 - ah/2)} \\left( x_0 \\frac{r(1+ah/2)(1-ah/2)}{r(1-ah/2)^2 + b^2h^2q} \\right)\n$$\n项 $r(1 - ah/2)$ 从分子和分母中约去，得到最优控制 $u_c^{\\star}$ 的最终表达式：\n$$\nu_c^{\\star} = -bhq x_0 \\frac{1+ah/2}{r(1-ah/2)^2 + b^2h^2q}\n$$\n这个表达式为了清晰可以展开，但这种紧凑形式就足够了。分母可以写作 $r(1 - ah + a^2h^2/4) + qb^2h^2$。",
            "answer": "$$\\boxed{- \\frac{b h q x_{0} (1 + \\frac{ah}{2})}{r(1-\\frac{ah}{2})^{2} + q b^{2} h^{2}}}$$"
        }
    ]
}