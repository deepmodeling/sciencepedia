{
    "hands_on_practices": [
        {
            "introduction": "To understand antigenic drift, we must first identify the evolutionary forces shaping the virus. The ratio of nonsynonymous to synonymous substitution rates, $\\omega = dN/dS$, serves as a powerful indicator of natural selection, where a value of $\\omega \\gt 1$ signifies positive selection favoring protein changes. This practice will guide you through the implementation of a codon substitution model to estimate $\\omega$ across the influenza hemagglutinin (HA) gene, allowing you to directly test the core hypothesis that antigenic sites are under intense pressure to evolve and evade host immunity .",
            "id": "4657325",
            "problem": "You are tasked with implementing a site-wise inference of the nonsynonymous to synonymous substitution rate ratio, denoted by $dN/dS$ (conventionally called $\\omega$), for the influenza hemagglutinin (HA) protein-coding sequence using a continuous-time Markov chain on codons and interpreting elevated values at antigenic sites as evidence of positive selection, consistent with antigenic drift. Your program must build a codon substitution model, compute site-specific maximum likelihood estimates of $\\omega$ on a small fixed star phylogeny, and then summarize whether antigenic sites show elevated $\\omega$ relative to non-antigenic sites.\n\nFundamental base:\n- The genetic code maps each sense codon to one of a kind amino acid, with three stop codons that do not code for amino acids.\n- A continuous-time Markov chain on codons with state space restricted to sense codons can model codon substitutions, where instantaneous rates reflect single-nucleotide changes, transition versus transversion mutation bias, and a scaling factor on nonsynonymous changes.\n- For a rate matrix $Q$, the time-$t$ transition probability matrix is $P(t) = \\exp(Qt)$, and the likelihood of observed tip states on a star phylogeny marginalizes over the unobserved ancestral state with stationary distribution $\\pi$.\n- The nonsynonymous to synonymous rate ratio $\\omega = dN/dS$ captures the relative fixation rates of nonsynonymous to synonymous changes under selection; $\\omega > 1$ indicates positive selection, $\\omega \\approx 1$ neutrality, and $\\omega < 1$ purifying selection.\n\nModel assumptions to implement:\n- State space consists of all sense codons under the standard genetic code (exclude stop codons).\n- Instantaneous rate $q_{ij}$ is nonzero only if codons $i$ and $j$ differ by a single nucleotide. Let the nucleotide mutation bias be controlled by a transition-versus-transversion ratio parameter $\\kappa$. For a single-nucleotide change, use a base mutation rate that is proportional to $\\kappa$ if the change is a transition and proportional to $1$ if it is a transversion. Multiply this base rate by $\\omega$ if the change is nonsynonymous, and by $1$ if it is synonymous. Set $q_{ii}$ so that each row sums to zero.\n- Use uniform stationary codon frequencies over sense codons, $\\pi_i = 1/N$ where $N$ is the number of sense codons.\n- Scale $Q$ so that the mean substitution rate is $1$ per unit time under $\\pi$, i.e., $-\\sum_i \\pi_i q_{ii} = 1$. With this scaling, branch length $t$ is measured in expected substitutions per codon.\n\nPhylogeny and likelihood:\n- Use a star phylogeny with three leaves with equal branch lengths. For each site, the observed codons at the three leaves are denoted $(x_1, x_2, x_3)$. For a given $\\omega$, the site likelihood under branch length $t$ is\n$$\n\\mathcal{L}(\\omega) \\;=\\; \\sum_{a} \\pi_a \\prod_{\\ell=1}^{3} P_{a,x_\\ell}(t),\n$$\nwhere $P(t) = \\exp(Qt)$ is the transition probability matrix. The site-specific maximum likelihood estimate $\\widehat{\\omega}$ is the value of $\\omega$ on a specified grid that maximizes $\\mathcal{L}(\\omega)$.\n- Use a fixed transition/transversion bias $\\kappa = 3.0$ (dimensionless) and branch length $t = 0.5$ (in expected substitutions per codon).\n\nAntigenic drift and interpretation:\n- Antigenic regions of HA are subject to immune pressure and are expected to exhibit elevated $\\omega$ under positive selection. You will compute the mean of $\\widehat{\\omega}$ over a set of antigenic sites and over a set of non-antigenic sites, then report the difference.\n\nComputational task:\n1. Construct the codon alphabet of size $N$ by excluding stop codons under the standard genetic code.\n2. For a grid of $\\omega$ values $\\Omega = \\{0.05, 0.1, 0.2, 0.5, 0.8, 1.0, 1.2, 1.5, 2.0, 3.0, 5.0\\}$, build $Q(\\omega)$ as above, scale it to unit mean rate, and compute $P_\\omega(t) = \\exp(Q(\\omega) t)$ for the given $t$.\n3. For each site and each dataset, compute the site likelihood $\\mathcal{L}(\\omega)$ by summing over all ancestral codon states and taking the product across the three leaves. Select $\\widehat{\\omega}$ as the grid value maximizing $\\mathcal{L}(\\omega)$ for that site.\n4. For each dataset, compute the mean of $\\widehat{\\omega}$ across antigenic sites and the mean across non-antigenic sites, then compute the difference $\\Delta = \\overline{\\omega}_{\\text{antigenic}} - \\overline{\\omega}_{\\text{non-antigenic}}$.\n\nInput data are fixed within the program; no user input is required.\n\nUse the following three datasets (each with three sequences labeled $A$, $B$, $C$ and six codon positions). Codons are written with nucleotides from the set $\\{A,C,G,T\\}$:\n\n- Dataset 1 (antigenic sites predominantly synonymous or conserved):\n  - Antigenic site indices: $\\{2,5\\}$ (one-based indexing).\n  - $A$: [GCT, GAA, TTT, ATG, CTA, CGT]\n  - $B$: [GCT, GAG, TTC, ATG, TTA, CGC]\n  - $C$: [GCT, GAA, TTT, ATA, CTA, AGT]\n\n- Dataset 2 (antigenic sites with multiple nonsynonymous differences):\n  - Antigenic site indices: $\\{2,5\\}$.\n  - $A$: [GCT, GAA, TTT, ATG, CTA, CGT]\n  - $B$: [GCT, AAA, TTC, ATG, GTA, CGC]\n  - $C$: [GCT, GCA, TTT, ATG, TCA, CGT]\n\n- Dataset 3 (ambiguous signal with mixed synonymous and nonsynonymous changes):\n  - Antigenic site indices: $\\{2,5\\}$.\n  - $A$: [GCT, GAA, TTT, ATG, CTA, CGT]\n  - $B$: [GCT, GAG, TTC, ATA, CTT, CGT]\n  - $C$: [GCT, AAA, TTT, ATG, CTA, CGC]\n\nAngle units are not applicable. No physical units are involved. All results are dimensionless.\n\nTest suite and required output:\n- Implement the above for the three datasets with $\\kappa = 3.0$, $t = 0.5$, and the specified $\\Omega$.\n- For each dataset, compute $\\Delta$ as defined. Your program should produce a single line of output containing the results for the three datasets as a comma-separated list of three floats rounded to three decimals, enclosed in square brackets, in the order of Dataset 1, Dataset 2, Dataset 3 (e.g., \"[0.123,0.456,-0.789]\").",
            "solution": "The problem is deemed valid as it is scientifically grounded in the principles of molecular evolution, well-posed with a clear and complete set of instructions, and objective in its formulation. The task is to implement a site-specific codon substitution model to infer the nonsynonymous-to-synonymous substitution rate ratio, $\\omega$, and to ascertain if antigenic sites in the influenza hemagglutinin (HA) protein show evidence of positive selection.\n\nThe solution proceeds in four main stages:\n1.  Definition of the codon model and state space.\n2.  Construction of the instantaneous rate matrix, $Q$.\n3.  Calculation of site likelihoods on a star phylogeny.\n4.  Maximum likelihood estimation of $\\omega$ for each site and analysis of the results.\n\n**1. Codon Model State Space**\n\nThe model operates on codons, which are triplets of nucleotides. The standard genetic code maps $64$ possible codons to $20$ amino acids and $3$ stop signals. The state space of our continuous-time Markov chain is restricted to the $N=61$ sense codons, excluding the three stop codons (`TAA`, `TAG`, `TGA`). A definitive list of these $61$ codons is established, and a mapping is created from each codon string to a unique integer index from $0$ to $60$ for matrix operations. The stationary distribution, $\\pi$, is assumed to be uniform over this state space, such that the frequency of any sense codon $i$ is $\\pi_i = 1/N = 1/61$.\n\n**2. Instantaneous Rate Matrix, $Q(\\omega, \\kappa)$**\n\nThe instantaneous rate of substitution from codon $i$ to codon $j$, denoted by $q_{ij}$ for $i \\neq j$, is defined based on a mechanistic model of nucleotide mutation and selection. The matrix $Q$ is of size $N \\times N$, i.e., $61 \\times 61$.\n\nThe rate $q_{ij}$ is non-zero only if codons $i$ and $j$ differ by a single nucleotide. For such pairs, the rate is given by:\n$$\nq_{ij} =\n\\begin{cases}\n    \\kappa             & \\text{if synonymous transition} \\\\\n    1                  & \\text{if synonymous transversion} \\\\\n    \\omega \\cdot \\kappa  & \\text{if nonsynonymous transition} \\\\\n    \\omega \\cdot 1       & \\text{if nonsynonymous transversion}\n\\end{cases}\n$$\n- A **transition** is a substitution between purines (A $\\leftrightarrow$ G) or between pyrimidines (C $\\leftrightarrow$ T). A **transversion** is any other substitution (purine $\\leftrightarrow$ pyrimidine). The transition/transversion rate ratio is fixed at $\\kappa = 3.0$.\n- A substitution is **synonymous** if it does not change the amino acid encoded by the codon. The rate of such changes is scaled by a factor of $1$.\n- A substitution is **nonsynonymous** if it results in a different amino acid. The rate of such changes is scaled by the parameter $\\omega = dN/dS$, which represents the selective pressure.\n\nThe diagonal elements of the rate matrix are defined to ensure that the rows sum to zero:\n$$\nq_{ii} = - \\sum_{j \\neq i} q_{ij}\n$$\nFinally, the entire matrix $Q$ is scaled to ensure the average substitution rate is $1$ per unit time. With a uniform stationary distribution $\\pi_i = 1/N$, this condition is $-\\sum_{i=0}^{N-1} \\pi_i q_{ii} = 1$, which simplifies to:\n$$\nS = -\\frac{1}{N} \\sum_{i=0}^{N-1} q_{ii} = 1\n$$\nThus, an initial unscaled matrix is constructed, and then every element is divided by the scaling factor $S = -\\frac{1}{N} \\sum_i q_{ii}^{\\text{unscaled}}$. A separate rate matrix is constructed for each value of $\\omega$ in the specified grid $\\Omega = \\{0.05, 0.1, 0.2, 0.5, 0.8, 1.0, 1.2, 1.5, 2.0, 3.0, 5.0\\}$.\n\n**3. Phylogenetic Likelihood Calculation**\n\nThe problem specifies a star phylogeny with three tips (sequences $A, B, C$) and a common ancestor. All three branches leading from the ancestor to the tips have an equal length of $t = 0.5$, measured in expected substitutions per codon.\n\nThe probability of codon $i$ changing to codon $j$ over a branch of length $t$ is given by the matrix of transition probabilities, $P(t) = \\exp(Q t)$, where $Q$ is the scaled rate matrix. This matrix exponential is computed for each $Q(\\omega)$ matrix.\n\nFor a single site in the alignment, let the observed codons at the three tips be $(x_1, x_2, x_3)$. The likelihood of observing this data given a value of $\\omega$ is calculated by marginalizing over all possible ancestral codons, $a$:\n$$\n\\mathcal{L}(\\omega) = \\sum_{a=0}^{N-1} \\pi_a \\prod_{\\ell=1}^{3} P_{a,x_\\ell}(t)\n$$\nGiven our assumption of uniform stationary frequencies, $\\pi_a = 1/N$, the formula becomes:\n$$\n\\mathcal{L}(\\omega) = \\frac{1}{N} \\sum_{a=0}^{N-1} P_{a,x_1}(t) \\cdot P_{a,x_2}(t) \\cdot P_{a,x_3}(t)\n$$\nThis likelihood is computed for each site and for every $\\omega$ in the grid $\\Omega$.\n\n**4. Estimation and Analysis**\n\nFor each site, the maximum likelihood estimate of omega, $\\widehat{\\omega}$, is determined by finding the value in the grid $\\Omega$ that maximizes the site likelihood $\\mathcal{L}(\\omega)$.\n\nAfter computing $\\widehat{\\omega}$ for all six sites in a dataset, the sites are partitioned into two groups: antigenic and non-antigenic, based on the provided indices (sites $2$ and $5$ are antigenic). The mean $\\widehat{\\omega}$ is calculated for each group:\n$$\n\\overline{\\omega}_{\\text{antigenic}} = \\frac{1}{2}\\sum_{i \\in \\{2,5\\}} \\widehat{\\omega}_i \\quad \\text{and} \\quad \\overline{\\omega}_{\\text{non-antigenic}} = \\frac{1}{4}\\sum_{i \\in \\{1,3,4,6\\}} \\widehat{\\omega}_i\n$$\nThe final result for each dataset is the difference between these means, $\\Delta = \\overline{\\omega}_{\\text{antigenic}} - \\overline{\\omega}_{\\text{non-antigenic}}$. A positive $\\Delta$ indicates that, on average, antigenic sites are under stronger positive selection than non-antigenic sites, consistent with the theory of antigenic drift. This entire procedure is repeated for all three provided datasets.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef solve():\n    \"\"\"\n    Implements a codon substitution model to infer site-wise dN/dS ratios (omega)\n    and analyze differences between antigenic and non-antigenic sites for influenza HA.\n    \"\"\"\n    \n    # --- 1. Model and Problem Constants ---\n\n    KAPPA = 3.0  # Transition/transversion rate ratio\n    T = 0.5  # Branch length\n    OMEGA_GRID = [0.05, 0.1, 0.2, 0.5, 0.8, 1.0, 1.2, 1.5, 2.0, 3.0, 5.0]\n\n    GENETIC_CODE = {\n        'AAA': 'K', 'AAC': 'N', 'AAG': 'K', 'AAT': 'N',\n        'ACA': 'T', 'ACC': 'T', 'ACG': 'T', 'ACT': 'T',\n        'AGA': 'R', 'AGC': 'S', 'AGG': 'R', 'AGT': 'S',\n        'ATA': 'I', 'ATC': 'I', 'ATG': 'M', 'ATT': 'I',\n        'CAA': 'Q', 'CAC': 'H', 'CAG': 'Q', 'CAT': 'H',\n        'CCA': 'P', 'CCC': 'P', 'CCG': 'P', 'CCT': 'P',\n        'CGA': 'R', 'CGC': 'R', 'CGG': 'R', 'CGT': 'R',\n        'CTA': 'L', 'CTC': 'L', 'CTG': 'L', 'CTT': 'L',\n        'GAA': 'E', 'GAC': 'D', 'GAG': 'E', 'GAT': 'D',\n        'GCA': 'A', 'GCC': 'A', 'GCG': 'A', 'GCT': 'A',\n        'GGA': 'G', 'GGC': 'G', 'GGG': 'G', 'GGT': 'G',\n        'GTA': 'V', 'GTC': 'V', 'GTG': 'V', 'GTT': 'V',\n        'TAA': '*', 'TAC': 'Y', 'TAG': '*', 'TAT': 'Y',\n        'TCA': 'S', 'TCC': 'S', 'TCG': 'S', 'TCT': 'S',\n        'TGA': '*', 'TGC': 'C', 'TGG': 'W', 'TGT': 'C',\n        'TTA': 'L', 'TTC': 'F', 'TTG': 'L', 'TTT': 'F',\n    }\n    \n    # --- 2. Helper Functions ---\n\n    def get_codons_and_maps(genetic_code):\n        \"\"\"Generates the list of sense codons and their index mappings.\"\"\"\n        codons = sorted([c for c, aa in genetic_code.items() if aa != '*'])\n        codon_to_idx = {c: i for i, c in enumerate(codons)}\n        n_codons = len(codons)\n        return codons, codon_to_idx, n_codons\n\n    def is_transition(n1, n2):\n        \"\"\"Checks if a nucleotide change is a transition.\"\"\"\n        purines = 'AG'\n        pyrimidines = 'CT'\n        return (n1 in purines and n2 in purines) or (n1 in pyrimidines and n2 in pyrimidines)\n\n    def build_q_matrix(omega, kappa, codons, codon_to_idx, n_codons, genetic_code):\n        \"\"\"Builds the unscaled codon substitution rate matrix Q.\"\"\"\n        q = np.zeros((n_codons, n_codons))\n        for i in range(n_codons):\n            for j in range(n_codons):\n                if i == j:\n                    continue\n                \n                codon1, codon2 = codons[i], codons[j]\n                \n                # Check for single nucleotide difference\n                diff_pos = -1\n                diff_count = 0\n                for k in range(3):\n                    if codon1[k] != codon2[k]:\n                        diff_count += 1\n                        diff_pos = k\n                \n                if diff_count == 1:\n                    rate = kappa if is_transition(codon1[diff_pos], codon2[diff_pos]) else 1.0\n                    \n                    is_synonymous = genetic_code[codon1] == genetic_code[codon2]\n                    if not is_synonymous:\n                        rate *= omega\n                    \n                    q[i, j] = rate\n        return q\n\n    def scale_q_matrix(q, n_codons):\n        \"\"\"Sets diagonal elements and scales the Q matrix.\"\"\"\n        row_sums = q.sum(axis=1)\n        np.fill_diagonal(q, -row_sums)\n        \n        # Scaling factor: -sum(pi_i * q_ii) where pi_i = 1/n_codons\n        # This is equivalent to (1/n_codons) * sum of absolute values of diagonal\n        scaling_factor = -np.diag(q).sum() / n_codons\n        if scaling_factor > 0:\n            q /= scaling_factor\n        return q\n\n    def precompute_p_matrices(omega_grid, kappa, t, codons, codon_to_idx, n_codons, genetic_code):\n        \"\"\"Precomputes transition probability matrices P(t) for all omega values.\"\"\"\n        p_matrices = {}\n        for omega in omega_grid:\n            q_unscaled = build_q_matrix(omega, kappa, codons, codon_to_idx, n_codons, genetic_code)\n            q_scaled = scale_q_matrix(q_unscaled, n_codons)\n            p_matrices[omega] = expm(q_scaled * t)\n        return p_matrices\n\n    def calculate_site_omega(site_codons, codon_to_idx, p_matrices, omega_grid, n_codons):\n        \"\"\"Calculates the maximum likelihood estimate of omega for a single site.\"\"\"\n        max_likelihood = -1.0\n        best_omega = -1.0\n        \n        c1, c2, c3 = site_codons\n        idx1, idx2, idx3 = codon_to_idx[c1], codon_to_idx[c2], codon_to_idx[c3]\n\n        for omega in omega_grid:\n            P_t = p_matrices[omega]\n            # Vectorized calculation of likelihood\n            # P_t[:, idx] gives the column vector of probabilities of transitioning to codon `idx` from any ancestor\n            likelihood_vec = P_t[:, idx1] * P_t[:, idx2] * P_t[:, idx3]\n            # Marginalize over all ancestors, with uniform prior pi_a = 1/n_codons\n            site_likelihood = likelihood_vec.sum() / n_codons\n            \n            if site_likelihood > max_likelihood:\n                max_likelihood = site_likelihood\n                best_omega = omega\n        \n        return best_omega\n\n    # --- 3. Main Execution Logic ---\n    \n    codons, codon_to_idx, n_codons = get_codons_and_maps(GENETIC_CODE)\n    p_matrices = precompute_p_matrices(OMEGA_GRID, KAPPA, T, codons, codon_to_idx, n_codons, GENETIC_CODE)\n    \n    ds1_A = [\"GCT\", \"GAA\", \"TTT\", \"ATG\", \"CTA\", \"CGT\"]\n    ds1_B = [\"GCT\", \"GAG\", \"TTC\", \"ATG\", \"TTA\", \"CGC\"]\n    ds1_C = [\"GCT\", \"GAA\", \"TTT\", \"ATA\", \"CTA\", \"AGT\"]\n    \n    ds2_A = [\"GCT\", \"GAA\", \"TTT\", \"ATG\", \"CTA\", \"CGT\"]\n    ds2_B = [\"GCT\", \"AAA\", \"TTC\", \"ATG\", \"GTA\", \"CGC\"]\n    ds2_C = [\"GCT\", \"GCA\", \"TTT\", \"ATG\", \"TCA\", \"CGT\"]\n\n    ds3_A = [\"GCT\", \"GAA\", \"TTT\", \"ATG\", \"CTA\", \"CGT\"]\n    ds3_B = [\"GCT\", \"GAG\", \"TTC\", \"ATA\", \"CTT\", \"CGT\"]\n    ds3_C = [\"GCT\", \"AAA\", \"TTT\", \"ATG\", \"CTA\", \"CGC\"]\n\n    test_cases = [\n        {'seqs': (ds1_A, ds1_B, ds1_C), 'antigenic_sites': {2, 5}},\n        {'seqs': (ds2_A, ds2_B, ds2_C), 'antigenic_sites': {2, 5}},\n        {'seqs': (ds3_A, ds3_B, ds3_C), 'antigenic_sites': {2, 5}},\n    ]\n    \n    final_results = []\n    \n    for case in test_cases:\n        seq_A, seq_B, seq_C = case['seqs']\n        antigenic_sites_1based = case['antigenic_sites']\n        num_sites = len(seq_A)\n        \n        antigenic_omegas = []\n        non_antigenic_omegas = []\n        \n        for i in range(num_sites):\n            site_codons = (seq_A[i], seq_B[i], seq_C[i])\n            site_omega_hat = calculate_site_omega(site_codons, codon_to_idx, p_matrices, OMEGA_GRID, n_codons)\n            \n            if (i + 1) in antigenic_sites_1based:\n                antigenic_omegas.append(site_omega_hat)\n            else:\n                non_antigenic_omegas.append(site_omega_hat)\n        \n        mean_antigenic = np.mean(antigenic_omegas) if antigenic_omegas else 0.0\n        mean_non_antigenic = np.mean(non_antigenic_omegas) if non_antigenic_omegas else 0.0\n        \n        delta = mean_antigenic - mean_non_antigenic\n        final_results.append(f\"{delta:.3f}\")\n\n    print(f\"[{','.join(final_results)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "After identifying that positive selection drives antigenic drift, a deeper question emerges: how do the fitness effects of individual mutations combine? This exercise introduces the concept of epistasis, which describes non-additive interactions where the combined effect of mutations is not equal to the sum of their individual effects. By calculating the epistasis coefficient, $\\epsilon$, from experimental data, you will quantify whether mutations act synergistically or antagonistically, providing crucial insight into the structure of the fitness landscape that guides influenza evolution .",
            "id": "4657405",
            "problem": "In a controlled within-host competition experiment designed to model antigenic drift in Influenza A virus (subtype H3N2), two amino acid substitutions in the hemagglutinin protein, denoted mutation $A$ and mutation $B$, were measured for their selection coefficients on the Malthusian fitness scale under partially immune serum. The Malthusian selection coefficient $s$ is defined as the per-replication-cycle difference in Malthusian growth rate relative to a reference strain and is dimensionless. Let $s_A$ denote the selection coefficient of mutation $A$ alone, $s_B$ the selection coefficient of mutation $B$ alone, and $s_{AB}$ the selection coefficient of the double mutant carrying both $A$ and $B$, all measured in the same genetic background and conditions.\n\nFundamental base: In haploid asexual populations, when fitness effects combine without epistasis on the Malthusian scale, the expected combined effect equals the sum of individual effects. Epistasis is defined as the deviation of the observed combined effect from this additive expectation.\n\n1. Starting from these definitions, derive an expression for the epistasis coefficient $\\epsilon$ in terms of $s_A$, $s_B$, and $s_{AB}$.\n\n2. Using the measured values $s_A = 0.041$, $s_B = 0.026$, and $s_{AB} = 0.089$, compute the numerical value of $\\epsilon$ and, based on its sign, briefly interpret whether the interaction between $A$ and $B$ is synergistic or antagonistic in the context of antigenic drift versus antigenic shift.\n\nRound your numerical answer for $\\epsilon$ to three significant figures. Express your final numerical answer as a dimensionless number (no units).",
            "solution": "The user has provided a problem from the field of evolutionary virology, asking for the derivation of an expression for epistasis and its subsequent calculation and interpretation based on provided data.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- **Topic**: Antigenic drift in Influenza A virus (subtype H3N2), within-host competition experiment.\n- **Mutations**: Two amino acid substitutions, $A$ and $B$, in the hemagglutinin protein.\n- **Selection Coefficients**:\n    - $s_A$: selection coefficient of mutation $A$ alone.\n    - $s_B$: selection coefficient of mutation $B$ alone.\n    - $s_{AB}$: selection coefficient of the double mutant with both $A$ and $B$.\n- **Definition of Malthusian Selection Coefficient ($s$)**: The per-replication-cycle difference in Malthusian growth rate relative to a reference strain; dimensionless.\n- **Fundamental Base for Epistasis**: In haploid asexual populations, the expected combined fitness effect on the Malthusian scale without epistasis is the sum of the individual effects.\n- **Definition of Epistasis ($\\epsilon$)**: The deviation of the observed combined effect from the additive expectation.\n- **Measured Values**: $s_A = 0.041$, $s_B = 0.026$, $s_{AB} = 0.089$.\n- **Task 1**: Derive an expression for the epistasis coefficient $\\epsilon$ in terms of $s_A$, $s_B$, and $s_{AB}$.\n- **Task 2**: Compute the numerical value of $\\epsilon$, rounding to three significant figures, and interpret its sign (synergistic vs. antagonistic) in the context of antigenic drift versus antigenic shift.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded**: The problem is firmly rooted in established principles of population genetics and virology. The concepts of Malthusian fitness, selection coefficients, epistasis, antigenic drift, and antigenic shift are standard and accurately represented. The experimental context (within-host competition) and the use of influenza hemagglutinin as a model are canonical in the field.\n- **Well-Posed**: The problem is clearly stated, with all necessary definitions and data provided to derive an expression, perform a calculation, and provide an interpretation. A unique, stable solution exists.\n- **Objective**: The problem is presented in precise, technical language, free from subjectivity or bias.\n\n**Step 3: Verdict and Action**\nThe problem is scientifically sound, self-contained, and well-posed. It is deemed **valid**. The solution will be provided below.\n\n### Solution\n\n**Part 1: Derivation of the Epistasis Coefficient, $\\epsilon$**\n\nThe problem is based on an additive model of fitness effects on the Malthusian scale. Let the Malthusian fitness of the reference (wild-type) strain be $m_0$. The fitness values of the single mutants ($m_A$, $m_B$) and the double mutant ($m_{AB}$) are defined relative to this reference fitness.\n\nThe selection coefficient, $s$, is defined as the difference in Malthusian growth rates. Therefore:\n- For mutation $A$: $s_A = m_A - m_0$\n- For mutation $B$: $s_B = m_B - m_0$\n- For the double mutant $AB$: $s_{AB} = m_{AB} - m_0$\n\nThe problem states that in the absence of epistasis, the expected combined effect is the sum of the individual effects. Let us denote the expected selection coefficient of the double mutant under the assumption of no epistasis as $s_{AB, \\text{exp}}$. According to the additive model:\n$$s_{AB, \\text{exp}} = s_A + s_B$$\n\nEpistasis, $\\epsilon$, is defined as the deviation of the observed combined effect, $s_{AB}$, from this additive expectation, $s_{AB, \\text{exp}}$. Mathematically, this is expressed as the difference between the observed and expected values:\n$$\\epsilon = s_{AB} - s_{AB, \\text{exp}}$$\n\nSubstituting the expression for the expected selection coefficient into the equation for epistasis, we obtain the general expression for $\\epsilon$:\n$$\\epsilon = s_{AB} - (s_A + s_B)$$\nThis is the required expression for the epistasis coefficient.\n\n**Part 2: Calculation and Interpretation of $\\epsilon$**\n\nWe are given the following measured values for the selection coefficients:\n- $s_A = 0.041$\n- $s_B = 0.026$\n- $s_{AB} = 0.089$\n\nUsing the derived formula, we can compute the numerical value of $\\epsilon$:\n$$\\epsilon = 0.089 - (0.041 + 0.026)$$\nFirst, we compute the sum of the individual effects:\n$$s_A + s_B = 0.041 + 0.026 = 0.067$$\nNow, we calculate the deviation:\n$$\\epsilon = 0.089 - 0.067 = 0.022$$\nThe problem requires the answer to be rounded to three significant figures. Therefore, we express the result as:\n$$\\epsilon = 0.0220$$\n\n**Interpretation:**\n\nThe calculated value of the epistasis coefficient is $\\epsilon = 0.0220$, which is a positive number ($\\epsilon > 0$). This is known as **positive epistasis** or **synergistic epistasis**. It signifies that the combined fitness effect of the two mutations, $A$ and $B$, is greater than the sum of their individual effects. The mutations potentiate each other, resulting in a double mutant that is more fit than would be predicted by a simple additive model.\n\nThe problem is set in the context of **antigenic drift**, which is the gradual evolution of a virus through the accumulation of point mutations in its surface proteins (like hemagglutinin) to evade host immunity. The experimental setup measuring selection coefficients for specific amino acid substitutions is a direct model of this process. The presence of positive epistasis means that this particular combination of mutations provides a disproportionately large advantage, potentially allowing the virus to escape pre-existing immunity more effectively and accelerating the process of antigenic drift.\n\nIn contrast, **antigenic shift** is a distinct, more abrupt evolutionary process involving the reassortment of entire gene segments between different influenza strains. This can lead to the emergence of a novel virus with a completely new hemagglutinin subtype, potentially causing a pandemic. The experiment described does not model antigenic shift. Therefore, the interpretation of this synergistic interaction is directly relevant to the dynamics of antigenic drift, suggesting that evolutionary pathways involving multiple mutations can be more favorable than expected, facilitating the virus's continuous adaptation to its host population.",
            "answer": "$$\\boxed{0.0220}$$"
        },
        {
            "introduction": "The molecular processes of antigenic drift have profound consequences at the population level, most notably the recurrence of seasonal influenza epidemics. This can be explored using compartmental models that link viral evolution to disease dynamics. In this practice, you will analyze a Susceptible-Infectious-Recovered (SIR) model that explicitly includes immune escape, representing the continuous generation of susceptible individuals due to antigenic drift, and determine the conditions under which this feedback drives oscillations in disease incidence .",
            "id": "4657414",
            "problem": "You are given a compartmental model for influenza transmission with antigenic drift, formulated as a Susceptible–Infectious–Recovered (SIR) model with demographic turnover and immune escape. Susceptible–Infectious–Recovered (SIR) denotes the standard epidemiological compartments: susceptible individuals $S$, infectious individuals $I$, and recovered (immune) individuals $R$. Demographic turnover is represented by a per capita birth and death rate $\\nu$, and antigenic drift-driven immune escape is represented by a rate $\\mu_a$ moving individuals from $R$ back to $S$. Transmission follows mass-action incidence with rate $\\beta$, and recovery occurs at rate $\\gamma$. The total population size $N$ is constant because births and deaths balance. The model is\n$$\n\\frac{dS}{dt} = \\nu N - \\frac{\\beta S I}{N} + \\mu_a R - \\nu S,\\quad\n\\frac{dI}{dt} = \\frac{\\beta S I}{N} - \\gamma I - \\nu I,\\quad\n\\frac{dR}{dt} = \\gamma I - \\mu_a R - \\nu R,\n$$\nwith $N = S + I + R$ constant.\n\nStarting only from these definitions and the model structure, determine whether small perturbations around the endemic equilibrium produce damped oscillations in incidence (that is, in $I$). When oscillations exist, compute the oscillation period in years implied by the local linear dynamics; when oscillations do not exist, define the period to be $0.0$ years. Your approach must be principled: derive the endemic equilibrium for $I>0$ under the condition $\\mathcal{R}_0 > 1$, where the basic reproduction number $\\mathcal{R}_0$ satisfies $\\mathcal{R}_0 = \\beta / (\\gamma + \\nu)$, then construct the Jacobian of the reduced system in $(S,I)$, analyze its eigenvalues, and extract the period from the imaginary part when the eigenvalues are complex. Express the final period in years as a real number rounded to $3$ decimal places.\n\nPhysical units: all rates $\\beta$, $\\gamma$, $\\nu$, and $\\mu_a$ are per year, and the output period must be expressed in years. If $\\beta \\le \\gamma + \\nu$ (no endemic equilibrium with $I^*>0$) or the linearization yields only real eigenvalues (no oscillatory component), output $0.0$.\n\nYour program must evaluate the following test suite. Each test case is a tuple $(N,\\beta,\\gamma,\\nu,\\mu_a)$, with $N$ in persons and rates in per year, and should return one float per test case, the oscillation period in years rounded to $3$ decimal places, using the rule above:\n\n- Case $1$: $N = 10^6$, $\\beta = 140.0$, $\\gamma = 121.0$, $\\nu = 1/70 \\approx 0.0142857$, $\\mu_a = 0.5$.\n- Case $2$ (near threshold with negligible drift, expected non-oscillatory): $N = 10^6$, $\\beta = 121.1$, $\\gamma = 121.0$, $\\nu = 1/70 \\approx 0.0142857$, $\\mu_a = 0.0$.\n- Case $3$ (higher transmission and substantial drift): $N = 10^6$, $\\beta = 200.0$, $\\gamma = 121.0$, $\\nu = 1/70 \\approx 0.0142857$, $\\mu_a = 5.0$.\n- Case $4$ (slower recovery scenario): $N = 10^6$, $\\beta = 60.0$, $\\gamma = 52.0$, $\\nu = 1/70 \\approx 0.0142857$, $\\mu_a = 0.5$.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[r_1,r_2,r_3,r_4]$), where each $r_i$ is the period in years for the corresponding test case, rounded to $3$ decimal places as a standard decimal representation.",
            "solution": "The user-provided problem is assessed as **valid** because it is scientifically grounded in established epidemiological modeling theory, is mathematically well-posed, and its instructions are objective and self-contained. The task is to determine the period of damped oscillations around the endemic equilibrium of a specified Susceptible–Infectious–Recovered (SIR) model. The solution requires a principled derivation based on linear stability analysis.\n\nThe model is described by the following system of ordinary differential equations (ODEs):\n$$\n\\frac{dS}{dt} = \\nu N - \\frac{\\beta S I}{N} + \\mu_a R - \\nu S\n$$\n$$\n\\frac{dI}{dt} = \\frac{\\beta S I}{N} - (\\gamma + \\nu) I\n$$\n$$\n\\frac{dR}{dt} = \\gamma I - \\mu_a R - \\nu R\n$$\nThe total population $N = S + I + R$ is constant, as the sum of the derivatives is zero: $\\frac{d(S+I+R)}{dt} = \\nu N - \\nu(S+I+R) = \\nu N - \\nu N = 0$. This allows us to reduce the system's dimensionality by substituting $R = N - S - I$. The dynamics can be fully described by a two-dimensional system in $S$ and $I$:\n$$\n\\frac{dS}{dt} = \\nu N - \\frac{\\beta S I}{N} + \\mu_a (N - S - I) - \\nu S = (\\nu + \\mu_a)N - (\\nu+\\mu_a)S - \\frac{\\beta S I}{N} - \\mu_a I\n$$\n$$\n\\frac{dI}{dt} = \\frac{\\beta S I}{N} - (\\gamma + \\nu)I\n$$\n\nWe seek the endemic equilibrium $(S^*, I^*)$ by setting the derivatives to zero, under the condition $I^* > 0$. From $\\frac{dI}{dt} = 0$, we have:\n$$\n\\left( \\frac{\\beta S^*}{N} - (\\gamma + \\nu) \\right) I^* = 0\n$$\nSince $I^* > 0$, we must have:\n$$\n\\frac{\\beta S^*}{N} - (\\gamma + \\nu) = 0 \\implies S^* = \\frac{N(\\gamma + \\nu)}{\\beta}\n$$\nFor an endemic state to be meaningful ($S^* < N$), we must have $\\beta > \\gamma+\\nu$, which is equivalent to the basic reproduction number $\\mathcal{R}_0 = \\frac{\\beta}{\\gamma+\\nu} > 1$. This is the condition for the existence of an endemic equilibrium with positive prevalence. If $\\mathcal{R}_0 \\le 1$, no such equilibrium exists, and the period is defined as $0.0$.\n\nNext, we find $I^*$ by setting $\\frac{dS}{dt} = 0$:\n$$\n(\\nu + \\mu_a)N - (\\nu+\\mu_a)S^* - \\frac{\\beta S^* I^*}{N} - \\mu_a I^* = 0\n$$\nSubstituting $\\frac{\\beta S^*}{N} = \\gamma + \\nu$:\n$$\n(\\nu + \\mu_a)N - (\\nu+\\mu_a)S^* - (\\gamma + \\nu)I^* - \\mu_a I^* = 0\n$$\n$$\n(\\nu + \\mu_a)(N - S^*) = (\\gamma + \\nu + \\mu_a)I^*\n$$\n$$\nI^* = \\frac{(\\nu + \\mu_a)(N - S^*)}{\\gamma + \\nu + \\mu_a} = \\frac{(\\nu + \\mu_a) N \\left(1 - \\frac{\\gamma+\\nu}{\\beta}\\right)}{\\gamma + \\nu + \\mu_a}\n$$\n\nTo analyze the stability and oscillatory behavior around $(S^*, I^*)$, we compute the Jacobian matrix $J$ of the reduced system:\n$$\nJ = \\begin{pmatrix} \\frac{\\partial}{\\partial S}(\\frac{dS}{dt}) & \\frac{\\partial}{\\partial I}(\\frac{dS}{dt}) \\\\ \\frac{\\partial}{\\partial S}(\\frac{dI}{dt}) & \\frac{\\partial}{\\partial I}(\\frac{dI}{dt}) \\end{pmatrix}_{(S^*, I^*)}\n$$\nThe partial derivatives are:\n$$\n\\frac{\\partial}{\\partial S}(\\frac{dS}{dt}) = -(\\nu+\\mu_a) - \\frac{\\beta I}{N}, \\quad \\frac{\\partial}{\\partial I}(\\frac{dS}{dt}) = -\\frac{\\beta S}{N} - \\mu_a\n$$\n$$\n\\frac{\\partial}{\\partial S}(\\frac{dI}{dt}) = \\frac{\\beta I}{N}, \\quad \\frac{\\partial}{\\partial I}(\\frac{dI}{dt}) = \\frac{\\beta S}{N} - (\\gamma+\\nu)\n$$\nEvaluating these at the equilibrium $(S^*, I^*)$ yields:\n$$\nJ = \\begin{pmatrix} -(\\nu+\\mu_a) - \\frac{\\beta I^*}{N} & -(\\gamma+\\nu) - \\mu_a \\\\ \\frac{\\beta I^*}{N} & 0 \\end{pmatrix} = \\begin{pmatrix} -(\\nu+\\mu_a) - \\frac{\\beta I^*}{N} & -(\\gamma+\\nu+\\mu_a) \\\\ \\frac{\\beta I^*}{N} & 0 \\end{pmatrix}\n$$\nThe eigenvalues $\\lambda$ of $J$ are the roots of the characteristic equation $\\lambda^2 - \\text{Tr}(J)\\lambda + \\det(J) = 0$, where:\n$$\n\\text{Tr}(J) = -(\\nu+\\mu_a) - \\frac{\\beta I^*}{N}\n$$\n$$\n\\det(J) = \\left(\\frac{\\beta I^*}{N}\\right) (\\gamma+\\nu+\\mu_a)\n$$\nSince all parameters ($\\nu, \\mu_a, \\beta, \\gamma$) are non-negative and $I^*>0$, it is clear that $\\text{Tr}(J) < 0$. This ensures that the real parts of the eigenvalues are negative, meaning the equilibrium is locally stable (perturbations are damped).\n\nOscillations occur if the eigenvalues are a complex conjugate pair. This happens when the discriminant of the characteristic equation, $\\Delta = \\text{Tr}(J)^2 - 4\\det(J)$, is negative.\n$$\n\\Delta = \\left(-(\\nu+\\mu_a) - \\frac{\\beta I^*}{N}\\right)^2 - 4\\left(\\frac{\\beta I^*}{N}\\right)(\\gamma+\\nu+\\mu_a) < 0\n$$\nIf $\\Delta \\ge 0$, the eigenvalues are real, there are no oscillations, and the period $T$ is $0.0$.\nIf $\\Delta < 0$, the eigenvalues are $\\lambda = \\frac{\\text{Tr}(J)}{2} \\pm i\\omega$, where the angular frequency of oscillation $\\omega$ is:\n$$\n\\omega = \\frac{\\sqrt{-\\Delta}}{2} = \\frac{\\sqrt{4\\det(J) - \\text{Tr}(J)^2}}{2}\n$$\nThe period of oscillation $T$ is given by $T = \\frac{2\\pi}{\\omega}$.\n\nThe computational algorithm is as follows:\n1. For each parameter set $(N, \\beta, \\gamma, \\nu, \\mu_a)$, calculate $\\mathcal{R}_0 = \\beta / (\\gamma+\\nu)$.\n2. If $\\mathcal{R}_0 \\le 1$, the period $T = 0.0$.\n3. If $\\mathcal{R}_0 > 1$, proceed to calculate the equilibrium and stability properties.\n4. Calculate $I^* = \\frac{(\\nu + \\mu_a) N (1 - 1/\\mathcal{R}_0)}{\\gamma + \\nu + \\mu_a}$.\n5. Define a helper variable $X = \\frac{\\beta I^*}{N}$.\n6. Calculate the trace $\\text{Tr}(J) = -(\\nu+\\mu_a) - X$ and determinant $\\det(J) = X(\\gamma+\\nu+\\mu_a)$.\n7. Calculate the discriminant $\\Delta = \\text{Tr}(J)^2 - 4\\det(J)$.\n8. If $\\Delta \\ge 0$, the period $T=0.0$.\n9. If $\\Delta < 0$, calculate the angular frequency $\\omega = \\frac{\\sqrt{-\\Delta}}{2}$ and the period $T = \\frac{2\\pi}{\\omega}$.\n10. Round the final period $T$ to $3$ decimal places.\n\nThis procedure is robust and directly follows from the problem statement. The comment \"expected non-oscillatory\" for Case 2 is noted, but the calculation must adhere strictly to the derived mathematical conditions. If the conditions for oscillation are met, a non-zero period will be computed.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_period(N, beta, gamma, nu, mu_a):\n    \"\"\"\n    Calculates the oscillation period for the given SIR model with immune escape.\n\n    Args:\n        N (float): Total population size.\n        beta (float): Transmission rate (per year).\n        gamma (float): Recovery rate (per year).\n        nu (float): Per capita birth and death rate (per year).\n        mu_a (float): Rate of immune escape (per year).\n\n    Returns:\n        float: The oscillation period in years. Returns 0.0 if no oscillations\n               or if the endemic equilibrium does not exist.\n    \"\"\"\n    # The combination gamma + nu appears frequently.\n    gamma_nu = gamma + nu\n\n    # Check for existence of the endemic equilibrium, which requires R0 > 1.\n    # If beta <= gamma_nu, R0 <= 1, so no endemic equilibrium with I > 0.\n    if beta <= gamma_nu:\n        return 0.0\n\n    R0 = beta / gamma_nu\n    \n    # Calculate the endemic equilibrium for the number of infectious individuals, I*.\n    # Using the expression derived from the model equations.\n    # N = S + I + R, dI/dt = beta*S*I/N - (gamma+nu)*I = 0 => S* = N*(gamma+nu)/beta\n    # dS/dt = nu*N - beta*S*I/N + mu_a*R - nu*S = 0\n    # I* = (nu + mu_a) * N * (1 - 1/R0) / (gamma + nu + mu_a)\n    I_star_num = (nu + mu_a) * N * (1.0 - 1.0 / R0)\n    I_star_den = gamma + nu + mu_a\n    \n    # It's possible for the denominator to be zero in an unphysical limit, but not for these cases.\n    if I_star_den == 0:\n        return 0.0 # Avoid division by zero\n    \n    I_star = I_star_num / I_star_den\n    \n    # Construct the Jacobian matrix elements at the equilibrium (S*, I*).\n    # The reduced system is in (S, I).\n    # J = [[- (nu + mu_a) - beta*I*/N,   - (gamma + nu + mu_a)],\n    #      [beta*I*/N,                   0                  ]]\n    \n    # For convenience, let X = beta * I* / N\n    X = beta * I_star / N\n\n    # The trace and determinant of the Jacobian matrix.\n    tr_J = - (nu + mu_a) - X\n    det_J = X * (gamma + nu + mu_a)\n    \n    # The eigenvalues are complex (implying oscillations) if the discriminant is negative.\n    discriminant = tr_J**2 - 4.0 * det_J\n    \n    if discriminant >= 0:\n        # Real eigenvalues, no oscillations.\n        return 0.0\n    else:\n        # Complex eigenvalues, oscillations occur.\n        # Eigenvalues are lambda = (tr_J / 2) +/- i * omega\n        # where omega is the angular frequency.\n        omega = np.sqrt(-discriminant) / 2.0\n        \n        # The period of oscillation T = 2*pi / omega.\n        if omega > 0:\n            period = 2.0 * np.pi / omega\n            return period\n        else:\n             # Should not happen if discriminant is negative.\n            return 0.0\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # (N, beta, gamma, nu, mu_a)\n    test_cases = [\n        (1e6, 140.0, 121.0, 1.0/70.0, 0.5),\n        (1e6, 121.1, 121.0, 1.0/70.0, 0.0),\n        (1e6, 200.0, 121.0, 1.0/70.0, 5.0),\n        (1e6, 60.0, 52.0, 1.0/70.0, 0.5),\n    ]\n\n    results = []\n    for case in test_cases:\n        period = calculate_period(*case)\n        results.append(period)\n\n    # Format the results to 3 decimal places and print in the specified format.\n    formatted_results = [f\"{r:.3f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}