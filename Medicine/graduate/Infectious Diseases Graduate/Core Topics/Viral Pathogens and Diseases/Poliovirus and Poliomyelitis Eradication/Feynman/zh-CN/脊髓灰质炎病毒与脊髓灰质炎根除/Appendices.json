{
    "hands_on_practices": [
        {
            "introduction": "为了有效抗击传染病，我们必须首先定量地理解其传播动态。本练习将指导您为脊髓灰质炎病毒建立一个数学模型，该病毒通过人际直接接触和环境污染两种途径传播。通过从第一性原理出发推导基本再生数 $R_0$ 和群体免疫阈值，您将掌握决定流行病是否会蔓延以及需要多少人口获得免疫才能阻止其传播的基础概念 。",
            "id": "4681832",
            "problem": "一个人口稠密、卫生设施不足的城市居住区正面临脊髓灰质炎病毒传播的风险。考虑一个带有环境污染室的易感-感染-移除（SIR）模型。在无病平衡状态下，在时间 $t=0$ 时，将一名感染者引入一个完全易感的人群中，其中 $S(0) \\approx N$。传播通过两种途径进行：\n\n- 直接口-口接触：一名感染者每天与随机选择的人进行 $c$ 次潜在的传染性接触，每次接触独立地以概率 $p_{d}$ 造成感染。在均匀混合且 $S \\approx N$ 的情况下，当该个体保持传染性时，此指示病例在时间 $t$ 通过直接接触产生的总新感染率为 $c\\,p_{d}$。\n- 环境粪-口暴露：环境的污染水平为 $E(t)$，遵循线性动力学 $dE/dt = \\sigma I(t) - \\delta E(t)$，其中 $I(t)$ 是指示病例在时间 $t$ 具有传染性的指示函数，$\\sigma$ 是向环境中的排毒率，$\\delta$ 是一阶污染衰变率。在均匀混合且 $S \\approx N$ 的情况下，此指示病例在时间 $t$ 通过环境途径产生的总新感染率为 $\\alpha\\,E(t)$，其中 $\\alpha$ 是对人群的单位污染感染风险。\n\n假设传染期持续时间呈指数分布，均值为 $T$，因此恢复率为 $\\gamma = 1/T$。仅使用上述定义和第一性原理（即，对单个典型感染病例的整个生命史中的总新感染风险以及环境室的线性脉冲响应进行积分），完成以下任务：\n\n1. 将该系统的基本再生数 $R_{0}$ 在数学上定义为：在完全易感的人群中引入单个典型感染者所引起的预期二代感染数。并用 $c$、$p_{d}$、$\\alpha$、$\\sigma$、$\\delta$ 和 $\\gamma$ 推导出 $R_{0}$。\n2. 在均匀混合和完全免疫的假设下，从第一性原理出发，推导出群体免疫阈值 $H$ 关于 $R_{0}$ 的表达式，然后根据下面描述的设置对 $H$ 进行数值计算。\n\n使用以下参数值，这些值在此情景下的脊髓灰质炎病毒是合理的：$c = 10$ 次接触/天，$p_{d} = 0.012$，$\\alpha = 0.004$ 每单位每天，$\\sigma = 5$ 单位/天，$\\delta = 0.5$ 每天，以及 $T = 21$ 天。将您最终的 $H$ 数值答案四舍五入到四位有效数字，并以小数形式表示（不要使用百分号）。",
            "solution": "在进行求解之前，需要对问题陈述进行验证。\n\n### 第1步：提取已知条件\n- **模型：** 带有环境污染室（$E$）的易感-感染-移除（SIR）模型。\n- **初始状态：** 在时间 $t=0$ 时，一名感染者被引入一个完全易感的人群中，$S(0) \\approx N$。\n- **直接传播：**\n  - 接触率：$c$\n  - 每次接触的感染概率：$p_{d}$\n  - 单个病例产生的新直接感染率：$c p_{d}$\n- **环境传播：**\n  - 环境动力学：$\\frac{dE}{dt} = \\sigma I(t) - \\delta E(t)$，其中 $I(t)$ 是指示病例具有传染性的指示函数。\n  - 排毒率：$\\sigma$\n  - 污染衰变率：$\\delta$\n  - 单个病例产生的新环境感染率：$\\alpha E(t)$\n  - 单位污染感染风险：$\\alpha$\n- **恢复：**\n  - 传染期持续时间呈指数分布，均值为 $T$。\n  - 恢复率为 $\\gamma = 1/T$。\n- **任务1：** 定义基本再生数 $R_{0}$，并用 $c$、$p_{d}$、$\\alpha$、$\\sigma$、$\\delta$ 和 $\\gamma$ 进行推导。$R_{0}$ 是在完全易感人群中，单个典型病例引起的预期二代感染数。\n- **任务2：** 推导出群体免疫阈值 $H$ 关于 $R_{0}$ 的表达式，并对其进行数值计算。\n- **参数值：**\n  - $c = 10 \\text{ 天}^{-1}$\n  - $p_{d} = 0.012$\n  - $\\alpha = 0.004 \\text{ (单位} \\cdot \\text{天)}^{-1}$\n  - $\\sigma = 5 \\text{ 单位} \\cdot \\text{天}^{-1}$\n  - $\\delta = 0.5 \\text{ 天}^{-1}$\n  - $T = 21 \\text{ 天}$\n- **数值精度：** 将 $H$ 的最终值四舍五入到四位有效数字。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，采用了适用于脊髓灰质炎等粪-口传播疾病的标准流行病学建模框架（带有环境宿主的SIR模型）。基本再生数（$R_0$）和群体免疫阈值（$H$）的概念是传染病动力学的基础原理。所有术语定义清晰，所提供的参数被指明是合理的，并且在量纲上是一致的。该问题是适定的、客观的、自洽的，为获得唯一解提供了足够的信息。它没有违反任何科学原理，不包含矛盾，也不依赖于主观论断。\n\n### 第3步：结论与行动\n问题是**有效的**。将提供完整解答。\n\n### 基本再生数 $R_0$ 的推导\n\n基本再生数 $R_0$ 定义为在完全易感的人群中，单个典型感染者产生的预期二代感染数。它可以分解为对应于两种传播途径的两个部分：\n$$R_{0} = R_{0,d} + R_{0,e}$$\n其中 $R_{0,d}$ 是直接口-口接触的贡献，$R_{0,e}$ 是环境粪-口暴露的贡献。\n\n**1. 直接传播部分 ($R_{0,d}$):**\n假设人口数量大且完全易感（$S/N \\approx 1$），一个感染者通过直接接触以恒定速率 $c p_{d}$ 引起新感染。传染期的持续时间，我们称之为随机变量 $\\tau$，呈均值为 $T$ 的指数分布。恢复率为 $\\gamma = 1/T$，因此传染期的预期持续时间为 $E[\\tau] = 1/\\gamma$。\n\n对于一个传染期持续时间为 $\\tau$ 的个体，通过直接途径产生的二代感染总数是速率乘以持续时间，即 $c p_{d} \\tau$。为了求出典型病例的预期二代感染数，我们对随机持续时间 $\\tau$ 取期望：\n$$R_{0,d} = E[c p_{d} \\tau] = c p_{d} E[\\tau]$$\n代入 $E[\\tau] = 1/\\gamma$，我们得到：\n$$R_{0,d} = \\frac{c p_{d}}{\\gamma}$$\n\n**2. 环境传播部分 ($R_{0,e}$):**\n来自环境的新感染率由 $\\alpha E(t)$ 给出。在单个个体整个感染过程中，通过环境途径造成的感染总数是此速率在所有时间上的积分：\n$$N_e = \\int_0^\\infty \\alpha E(t) dt$$\n为了求得 $R_{0,e}$，我们需要计算 $N_e$ 在传染期分布上的期望值。首先，我们求出贡献到环境中的总病原体载量 $\\int_0^\\infty E(t) dt$。环境污染 $E(t)$ 的动力学由以下线性常微分方程给出：\n$$\\frac{dE}{dt} = \\sigma I(t) - \\delta E(t)$$\n其中 $I(t)$ 是一个指示函数，当指示病例具有传染性时为 $1$，否则为 $0$。对于一个从 $t=0$ 开始、传染期持续时间为 $\\tau$ 的个体，我们在 $0 \\le t \\le \\tau$ 时有 $I(t)=1$，在 $t > \\tau$ 时有 $I(t)=0$。我们假设 $E(0)=0$。\n\n我们可以将该微分方程从 $t=0$ 积分到 $t=\\infty$：\n$$\\int_0^\\infty \\frac{dE}{dt} dt = \\int_0^\\infty (\\sigma I(t) - \\delta E(t)) dt$$\n$$[E(t)]_0^\\infty = \\sigma \\int_0^\\infty I(t) dt - \\delta \\int_0^\\infty E(t) dt$$\n由于污染从零开始（$E(0)=0$），并且在污染源被移除后最终必须衰减到零（$E(\\infty)=0$），所以左侧为 $0$。指示函数 $I(t)$ 的积分就是持续时间 $\\tau$。\n$$0 = \\sigma \\tau - \\delta \\int_0^\\infty E(t) dt$$\n求解积分后的污染量得到：\n$$\\int_0^\\infty E(t) dt = \\frac{\\sigma \\tau}{\\delta}$$\n对于这个特定的持续时间 $\\tau$，总感染数为：\n$$N_e(\\tau) = \\alpha \\int_0^\\infty E(t) dt = \\frac{\\alpha \\sigma \\tau}{\\delta}$$\n为了求出典型病例的预期二代感染数，我们对随机持续时间 $\\tau$ 计算 $N_e(\\tau)$ 的期望值：\n$$R_{0,e} = E[N_e(\\tau)] = E\\left[\\frac{\\alpha \\sigma \\tau}{\\delta}\\right] = \\frac{\\alpha \\sigma}{\\delta} E[\\tau]$$\n代入 $E[\\tau] = 1/\\gamma$：\n$$R_{0,e} = \\frac{\\alpha \\sigma}{\\delta \\gamma}$$\n\n**3. 总基本再生数 ($R_0$):**\n将两部分相加，得到 $R_0$ 的总表达式：\n$$R_{0} = R_{0,d} + R_{0,e} = \\frac{c p_{d}}{\\gamma} + \\frac{\\alpha \\sigma}{\\delta \\gamma}$$\n这可以因式分解为：\n$$R_{0} = \\frac{1}{\\gamma} \\left( c p_{d} + \\frac{\\alpha \\sigma}{\\delta} \\right)$$\n\n### 群体免疫阈值 $H$ 的推导与计算\n\n群体免疫阈值（$H$）是指为了阻止感染传播，群体中必须具有免疫力的最低人口比例。如果有效再生数 $R_{eff}$ 小于 $1$，则疫情无法增长。$R_{eff}$ 是在群体中有一部分人已经免疫时，产生的二代感染数。\n\n对于一个均匀混合的群体，如果群体中有比例为 $p$ 的人具有免疫力（因此不是易感者），那么易感者的比例是 $1-p$。一个感染者的接触只有在接触到易感者时才会导致新的感染。因此，有效再生数会因群体中易感者的比例而减少：\n$$R_{eff} = R_0 \\times (\\text{易感者比例}) = R_0 \\frac{S}{N}$$\n群体免疫阈值 $H$ 是指当 $R_{eff}$ 等于 $1$ 时，具有免疫力的个体的特定比例。在这个阈值下，易感者的比例是 $1-H$。\n$$1 = R_0 (1-H)$$\n求解 $H$ 得到群体免疫阈值的表达式：\n$$1-H = \\frac{1}{R_0} \\implies H = 1 - \\frac{1}{R_0}$$\n\n现在，我们将使用提供的参数值对 $H$ 进行数值计算。\n首先，我们确定恢复率 $\\gamma$：\n$$T = 21 \\text{ 天} \\implies \\gamma = \\frac{1}{T} = \\frac{1}{21} \\text{ 天}^{-1}$$\n接下来，我们使用推导出的公式和给定的参数计算 $R_0$：\n$c = 10$, $p_{d} = 0.012$, $\\alpha = 0.004$, $\\sigma = 5$, $\\delta = 0.5$。\n$$R_0 = \\frac{1}{1/21} \\left( (10)(0.012) + \\frac{(0.004)(5)}{0.5} \\right)$$\n$$R_0 = 21 \\left( 0.12 + \\frac{0.02}{0.5} \\right)$$\n$$R_0 = 21 (0.12 + 0.04)$$\n$$R_0 = 21 (0.16)$$\n$$R_0 = 3.36$$\n现在我们可以计算群体免疫阈值 $H$：\n$$H = 1 - \\frac{1}{R_0} = 1 - \\frac{1}{3.36}$$\n$$H = 1 - 0.29761904...$$\n$$H = 0.70238095...$$\n按照要求，将结果四舍五入到四位有效数字：\n$$H \\approx 0.7024$$",
            "answer": "$$\\boxed{0.7024}$$"
        },
        {
            "introduction": "现代疾病监测不仅仅是统计病例数，它还涉及到对病原体自身遗传信息的解码。本练习将介绍分子钟分析的核心原理，这是在脊髓灰质炎根除残局阶段追踪疫苗衍生脊髓灰质炎病毒（VDPV）的有力工具。您将应用 Jukes-Cantor 核苷酸替换模型来估计一个病毒谱系的传播时间，这项关键技能对于评估 VDPV 带来的风险和指导公共卫生对策至关重要 。",
            "id": "4681799",
            "problem": "脊髓灰质炎病毒监测中的一个核心工具是基于病毒蛋白1 (VP1) 编码区累积的核苷酸替换进行分子钟定年。考虑一个源自口服脊髓灰质炎疫苗（OPV）的病毒谱系，其中疫苗株序列是时间 $t=0$ 时的已知祖先。假设以下基本前提：核苷酸替换沿着该谱系累积，其过程为一个时间齐次连续时间马尔可夫链，具有恒定的单位点替换率 $\\mu$（单位点每年替换数），且碱基的平衡频率相等，即 Jukes–Cantor 模型。在此模型下，各点位上变化的累积是一个泊松过程，并且可观察到的与祖先序列的差异比例是单位点预期替换数 $B=\\mu t$ 的函数。\n\n一个监测实验室对一个分离株的 VP1 区域（长度 $L=906$ 个核苷酸）进行了测序，并观察到与相应的 Sabin 疫苗株相比有 $n=28$ 个核苷酸差异。脊髓灰质炎病毒 VP1 的分子钟已经通过纵向数据集校准，其速率约为 $\\mu = 1.00 \\times 10^{-2}$ 单位点每年替换数。\n\n从核苷酸之间具有相等瞬时替换率的连续时间马尔可夫链描述出发，推导在有限位点校正下，连接观察到的汉明距离比例 $\\hat{p}=n/L$ 与单位点预期替换数 $B=\\mu t$ 之间的关系，然后求出传播时间 $t$ 的最大似然估计。使用上述数据和给定的 $\\mu$ 计算 $t$ 的值。将你的答案四舍五入到四位有效数字。最终结果以年为单位表示。",
            "solution": "该问题要求推导用于遗传距离的 Jukes-Cantor (JC69) 校正公式，并应用该公式来估计一个脊髓灰质炎病毒谱系的传播时间。\n\n### 第1步：推导 Jukes-Cantor 校正公式\n\nJukes-Cantor 核苷酸替换模型是一个在四个核苷酸 $\\{A, C, G, T\\}$ 状态空间上的连续时间马尔可夫链。它假设从任何一个核苷酸到任何其他核苷酸的替换率是一个常数，记为 $\\alpha$。此过程的速率矩阵 $Q$ 是一个 $4 \\times 4$ 矩阵，其中非对角线元素 $Q_{ij}$（当 $i \\neq j$ 时）等于 $\\alpha$，而对角线元素 $Q_{ii}$ 的选择使得每行之和为零，即 $Q_{ii} = -3\\alpha$。\n\n$$\nQ = \\begin{pmatrix}\n-3\\alpha  \\alpha  \\alpha  \\alpha \\\\\n\\alpha  -3\\alpha  \\alpha  \\alpha \\\\\n\\alpha  \\alpha  -3\\alpha  \\alpha \\\\\n\\alpha  \\alpha  \\alpha  -3\\alpha\n\\end{pmatrix} = \\alpha (J - 4I)\n$$\n\n其中 $J$ 是全为1的 $4 \\times 4$ 矩阵，$I$ 是 $4 \\times 4$ 的单位矩阵。\n\n问题陈述了单位点替换率为 $\\mu$。该速率是经核苷酸稳态分布加权的平均替换率。对于 JC69 模型，稳态分布是均匀的，即每个核苷酸 $i$ 的 $\\pi_i = \\frac{1}{4}$。离开状态 $i$ 的速率为 $\\sum_{j \\neq i} Q_{ij} = 3\\alpha$。因此，单位点的总替换率为：\n$$\n\\mu = \\sum_{i} \\pi_i \\left( \\sum_{j \\neq i} Q_{ij} \\right) = \\sum_{i} \\frac{1}{4} (3\\alpha) = 4 \\left( \\frac{1}{4} \\cdot 3\\alpha \\right) = 3\\alpha\n$$\n这给出了关系式 $\\alpha = \\frac{\\mu}{3}$。速率矩阵可以用 $\\mu$ 表示为：\n$$\nQ = \\frac{\\mu}{3} (J - 4I)\n$$\n\n在时间间隔 $t$ 内的转移概率矩阵 $P(t)$ 由矩阵指数 $P(t) = \\exp(Qt)$ 给出。\n$$\nP(t) = \\exp\\left( \\frac{\\mu t}{3} (J - 4I) \\right) = \\exp\\left( -\\frac{4\\mu t}{3} I \\right) \\exp\\left( \\frac{\\mu t}{3} J \\right)\n$$\n第一项是标量矩阵 $\\exp\\left(-\\frac{4\\mu t}{3}\\right)I$。对于第二项，我们使用性质 $J^k = 4^{k-1}J$（对于 $k \\ge 1$）和指数函数的泰勒级数展开：\n$$\n\\exp(cJ) = I + \\sum_{k=1}^{\\infty} \\frac{(cJ)^k}{k!} = I + \\sum_{k=1}^{\\infty} \\frac{c^k 4^{k-1}}{k!} J = I + \\frac{J}{4} \\sum_{k=1}^{\\infty} \\frac{(4c)^k}{k!} = I + \\frac{J}{4} (\\exp(4c) - 1)\n$$\n设 $c = \\frac{\\mu t}{3}$，我们有 $4c = \\frac{4\\mu t}{3}$。\n$$\n\\exp\\left(\\frac{\\mu t}{3}J\\right) = I + \\frac{J}{4}\\left(\\exp\\left(\\frac{4\\mu t}{3}\\right) - 1\\right)\n$$\n合并 $P(t)$ 的各项：\n$$\nP(t) = \\exp\\left(-\\frac{4\\mu t}{3}\\right) \\left[ I + \\frac{J}{4}\\left(\\exp\\left(\\frac{4\\mu t}{3}\\right) - 1\\right) \\right] = \\exp\\left(-\\frac{4\\mu t}{3}\\right)I + \\frac{J}{4}\\left(1 - \\exp\\left(-\\frac{4\\mu t}{3}\\right)\\right)\n$$\n$P(t)$ 的对角线元素 $P_{ii}(t)$ 表示一个核苷酸在时间 $t$ 后未发生改变的概率。\n$$\nP_{ii}(t) = \\exp\\left(-\\frac{4\\mu t}{3}\\right) + \\frac{1}{4}\\left(1 - \\exp\\left(-\\frac{4\\mu t}{3}\\right)\\right) = \\frac{1}{4} + \\frac{3}{4}\\exp\\left(-\\frac{4\\mu t}{3}\\right)\n$$\n非对角线元素 $P_{ij}(t)$（当 $i \\neq j$ 时）表示一个核苷酸变为某个特定的不同核苷酸的概率。\n$$\nP_{ij}(t) = \\frac{1}{4}\\left(1 - \\exp\\left(-\\frac{4\\mu t}{3}\\right)\\right)\n$$\n在时间 $t$ 后显示差异的位点的期望比例（我们称之为 $p(t)$）是一个位点被与祖先核苷酸不同的任何核苷酸占据的概率。这等于 $1 - P_{ii}(t)$。\n$$\np(t) = 1 - P_{ii}(t) = 1 - \\left( \\frac{1}{4} + \\frac{3}{4}\\exp\\left(-\\frac{4\\mu t}{3}\\right) \\right) = \\frac{3}{4}\\left(1 - \\exp\\left(-\\frac{4\\mu t}{3}\\right)\\right)\n$$\n问题将单位点预期替换数定义为 $B = \\mu t$。将此代入方程，得到期望差异比例与遗传距离 $B$ 之间的关系。\n$$\np(B) = \\frac{3}{4}\\left(1 - \\exp\\left(-\\frac{4B}{3}\\right)\\right)\n$$\n这就是所要求的基本关系。\n\n### 第2步：传播时间 $t$ 的最大似然估计\n\n观测结果是在长度为 $L$ 的序列中有 $n$ 个差异。差异数 $n$ 可以建模为从二项分布 $n \\sim \\text{Binom}(L, p)$ 中抽取的一个样本，其中 $p$ 是一个位点存在差异的真实概率。似然函数为 $L(p | n, L) = \\binom{L}{n} p^n (1-p)^{L-n}$。\n\n比例 $p$ 的最大似然估计 (MLE) 是观察到的样本比例 $\\hat{p}$：\n$$\n\\hat{p} = \\frac{n}{L}\n$$\n为了求出时间 $t$ 的最大似然估计，我们首先反转推导出的关系，将 $t$ 表示为 $p$ 的函数。\n$$\np = \\frac{3}{4}\\left(1 - \\exp\\left(-\\frac{4\\mu t}{3}\\right)\\right)\n$$\n$$\n\\frac{4p}{3} = 1 - \\exp\\left(-\\frac{4\\mu t}{3}\\right)\n$$\n$$\n\\exp\\left(-\\frac{4\\mu t}{3}\\right) = 1 - \\frac{4p}{3}\n$$\n$$\n-\\frac{4\\mu t}{3} = \\ln\\left(1 - \\frac{4p}{3}\\right)\n$$\n$$\nt(p) = -\\frac{3}{4\\mu}\\ln\\left(1 - \\frac{4p}{3}\\right)\n$$\n根据最大似然估计的不变性， $t$ 的最大似然估计（记为 $\\hat{t}$）可以通过将 $\\hat{p}$ 代入 $t(p)$ 的表达式中得到。\n$$\n\\hat{t} = -\\frac{3}{4\\mu}\\ln\\left(1 - \\frac{4\\hat{p}}{3}\\right) = -\\frac{3}{4\\mu}\\ln\\left(1 - \\frac{4n}{3L}\\right)\n$$\n这个公式提供了传播时间 $t$ 的最大似然估计。\n\n### 第3步：计算传播时间\n\n我们已知以下数据：\n- 核苷酸差异数，$n = 28$。\n- VP1 编码区长度，$L = 906$ 个核苷酸。\n- 替换率，$\\mu = 1.00 \\times 10^{-2}$ 单位点每年替换数。\n\n首先，我们计算观察到的差异比例 $\\hat{p}$：\n$$\n\\hat{p} = \\frac{n}{L} = \\frac{28}{906}\n$$\n现在，将这些值代入 $\\hat{t}$ 的最大似然估计公式中：\n$$\n\\hat{t} = -\\frac{3}{4(1.00 \\times 10^{-2})} \\ln\\left(1 - \\frac{4}{3} \\cdot \\frac{28}{906}\\right)\n$$\n$$\n\\hat{t} = -\\frac{3}{0.04} \\ln\\left(1 - \\frac{112}{2718}\\right)\n$$\n$$\n\\hat{t} = -75 \\ln\\left(\\frac{2718-112}{2718}\\right) = -75 \\ln\\left(\\frac{2606}{2718}\\right)\n$$\n现在我们计算数值：\n$$\n\\hat{t} = -75 \\ln(0.9587932303\\dots)\n$$\n$$\n\\hat{t} = -75 (-0.042079603\\dots)\n$$\n$$\n\\hat{t} = 3.1559702\\dots\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\n\\hat{t} \\approx 3.156 \\text{ 年}\n$$\n该病毒谱系自从疫苗株分化以来的估计传播时间为 $3.156$ 年。",
            "answer": "$$\\boxed{3.156}$$"
        },
        {
            "introduction": "制定合理的公共卫生决策需要整合来自多个（通常是不完美的）数据流的证据。这项动手编程挑战将让您扮演公共卫生数据分析师的角色，任务是建立一个贝叶斯框架，以整合两个关键的脊髓灰质炎监测系统：急性弛缓性麻痹（AFP）监测和环境采样。通过计算病毒传播的后验概率，您将学会如何正式地结合不同来源的证据来量化不确定性，并为决策者提供一个稳健的评估 。",
            "id": "4681774",
            "problem": "您需要实现一个贝叶斯决策论程序，该程序整合了急性弛缓性麻痹 (AFP) 监测和环境监测，以估计在一个固定的观察窗口内，某个指定集水区中持续性脊髓灰质炎病毒传播的后验概率。感兴趣的潜在状态为 $C \\in \\{0,1\\}$，其中 $C=1$ 表示在观察窗口内存在持续传播，而 $C=0$ 表示不存在持续传播。\n\n基本原理：使用贝叶斯定理和标准分布模型。假设在给定潜在状态的情况下，各监测流是条件独立的。设 AFP 观测数据由泊松分布建模，环境检测计数由二项分布建模，每个分布的参数都依赖于状态。\n\n用作基础的定义和建模假设：\n- 设传播的先验概率为 $P(C=1)=\\pi$，则 $P(C=0)=1-\\pi$。\n- 设观察窗口内检测到的 AFP 脊髓灰质炎病例数为 $n_{\\mathrm{AFP}}$。在 $C=1$ 的条件下，将 $n_{\\mathrm{AFP}}$ 建模为均值为 $\\lambda_1$ 的泊松随机变量，其中 $\\lambda_1$ 代表存在持续传播时检测到的 AFP 病例的期望数量。在 $C=0$ 的条件下，将 $n_{\\mathrm{AFP}}$ 建模为均值为 $\\lambda_0$ 的泊松随机变量，其中 $\\lambda_0$ 代表没有传播时的假阳性或背景检测。\n- 设采集的环境样本数量为 $S$，其中 $y_{\\mathrm{env}}$ 个样本检测呈阳性。在 $C=1$ 的条件下，将 $y_{\\mathrm{env}}$ 建模为参数为 $S$ 和 $p_1$ 的二项随机变量，其中 $p_1$ 是存在持续传播时单个样本的检测概率。在 $C=0$ 的条件下，将 $y_{\\mathrm{env}}$ 建模为参数为 $S$ 和 $p_0$ 的二项随机变量，其中 $p_0$ 是没有传播时单个样本的假阳性概率。\n- 假设在给定 $C$ 的情况下，AFP 和环境观测是条件独立的。\n\n您的任务：\n- 对于每个测试用例，仅使用上述原理计算后验概率 $P(C=1 \\mid \\text{data})$。您必须使用泊松和二项概率质量函数构建 $C=1$ 和 $C=0$ 下的似然，并通过贝叶斯定理将其与先验结合。在对数空间中实现计算以确保数值稳定性，并以数学上一致的方式处理诸如 $S=0$、$p \\in \\{0,1\\}$ 和 $\\pi \\in \\{0,1\\}$ 等边缘情况。\n\n输入规范：\n- 无外部输入。您的程序必须在内部编码以下参数集测试套件。每个测试用例都是一个如上定义的有序元组 $(\\pi, \\lambda_1, \\lambda_0, S, p_1, p_0, n_{\\mathrm{AFP}}, y_{\\mathrm{env}})$。\n\n覆盖典型、边界和边缘情况的测试套件：\n- 案例 $1$：$(0.5, 0.8, 0.01, 12, 0.3, 0.001, 0, 0)$\n- 案例 $2$：$(0.2, 1.2, 0.02, 8, 0.25, 0.001, 1, 0)$\n- 案例 $3$：$(0.1, 0.5, 0.005, 20, 0.4, 0.002, 0, 3)$\n- 案例 $4$：$(0.7, 2.0, 0.01, 50, 0.5, 0.001, 0, 0)$\n- 案例 $5$：$(0.4, 0.7, 0.02, 0, 0.0, 0.0, 0, 0)$\n- 案例 $6$：$(0.001, 0.3, 0.01, 10, 0.2, 0.001, 0, 1)$\n- 案例 $7$：$(0.99, 1.5, 0.01, 12, 0.3, 0.001, 2, 5)$\n\n输出规范：\n- 对于每个测试用例，将持续传播的后验概率 $P(C=1 \\mid \\text{data})$ 计算为浮点数。将每个后验概率四舍五入到小数点后 $6$ 位。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果（例如，[r1,r2,r3,r4,r5,r6,r7]），其中 $r_i$ 是按上述顺序排列的案例 $i$ 的四舍五入后的后验概率。\n\n科学真实性和单位：\n- 所有参数都是在固定窗口内的无量纲概率或期望计数；不需要物理单位。\n- 角度单位不适用。\n\n您的实现必须严格遵守所述的统计建模假设和指定的输出格式。最终输出必须是四舍五入到小数点后 6 位的数值浮点数，并完全按照描述进行汇总。",
            "solution": "该问题要求实现一个贝叶斯模型，用以计算脊髓灰质炎病毒传播的后验概率，由潜在状态 $C=1$ 表示，其条件是给定来自两个独立流的监测数据：急性弛缓性麻痹 (AFP) 病例计数和环境样本检测。状态 $C=0$ 表示没有传播。数据包括观测到的 AFP 病例数 $n_{\\mathrm{AFP}}$，以及从总共 $S$ 个样本中检测出的阳性环境样本数 $y_{\\mathrm{env}}$。\n\n解决方案是使用贝叶斯定理从第一性原理推导出来的。传播的后验概率由下式给出：\n$$\nP(C=1 \\mid n_{\\mathrm{AFP}}, y_{\\mathrm{env}}) = \\frac{P(n_{\\mathrm{AFP}}, y_{\\mathrm{env}} \\mid C=1) P(C=1)}{P(n_{\\mathrm{AFP}}, y_{\\mathrm{env}})}\n$$\n分母是边际似然或证据，通过全概率定律获得：\n$$\nP(n_{\\mathrm{AFP}}, y_{\\mathrm{env}}) = P(n_{\\mathrm{AFP}}, y_{\\mathrm{env}} \\mid C=1) P(C=1) + P(n_{\\mathrm{AFP}}, y_{\\mathrm{env}} \\mid C=0) P(C=0)\n$$\n设传播的先验概率为 $P(C=1) = \\pi$，这意味着 $P(C=0) = 1-\\pi$。设给定状态 $C=c$ 时数据的似然表示为 $L_c = P(n_{\\mathrm{AFP}}, y_{\\mathrm{env}} \\mid C=c)$。那么后验概率可以写成：\n$$\nP(C=1 \\mid \\text{data}) = \\frac{L_1 \\pi}{L_1 \\pi + L_0 (1-\\pi)}\n$$\n问题指出，在给定传播状态 $C$ 的情况下，两个监测流是条件独立的。因此，联合似然 $L_c$ 是各个似然的乘积：\n$$\nL_c = P(n_{\\mathrm{AFP}} \\mid C=c) \\times P(y_{\\mathrm{env}} \\mid C=c)\n$$\n这些似然的模型规定如下：\n1.  **AFP 监测：** 病例数 $n_{\\mathrm{AFP}}$ 服从泊松分布。\n    -   如果 $C=1$，$n_{\\mathrm{AFP}} \\sim \\text{Poisson}(\\lambda_1)$，所以 $P(n_{\\mathrm{AFP}} \\mid C=1) = \\frac{e^{-\\lambda_1} \\lambda_1^{n_{\\mathrm{AFP}}}}{n_{\\mathrm{AFP}}!}$。\n    -   如果 $C=0$，$n_{\\mathrm{AFP}} \\sim \\text{Poisson}(\\lambda_0)$，所以 $P(n_{\\mathrm{AFP}} \\mid C=0) = \\frac{e^{-\\lambda_0} \\lambda_0^{n_{\\mathrm{AFP}}}}{n_{\\mathrm{AFP}}!}$。\n\n2.  **环境监测：** 阳性样本数 $y_{\\mathrm{env}}$ 服从二项分布。\n    -   如果 $C=1$，$y_{\\mathrm{env}} \\sim \\text{Binomial}(S, p_1)$，所以 $P(y_{\\mathrm{env}} \\mid C=1) = \\binom{S}{y_{\\mathrm{env}}} p_1^{y_{\\mathrm{env}}} (1-p_1)^{S - y_{\\mathrm{env}}}$。\n    -   如果 $C=0$，$y_{\\mathrm{env}} \\sim \\text{Binomial}(S, p_0)$，所以 $P(y_{\\mathrm{env}} \\mid C=0) = \\binom{S}{y_{\\mathrm{env}}} p_0^{y_{\\mathrm{env}}} (1-p_0)^{S - y_{\\mathrm{env}}}$。\n\n直接计算这些概率可能导致数值下溢。一种稳健的方法是在对数空间中进行计算。用后验优势比来表示后验概率很方便。传播 ($C=1$) 与不传播 ($C=0$) 的后验优势比为：\n$$\n\\frac{P(C=1 \\mid \\text{data})}{P(C=0 \\mid \\text{data})} = \\frac{L_1}{L_0} \\times \\frac{\\pi}{1-\\pi}\n$$\n这是贝叶斯因子 ($L_1/L_0$) 和先验优势比 ($\\pi/(1-\\pi)$) 的乘积。后验概率 $P(C=1 \\mid \\text{data})$ 可以从 $C=0$ 对 $C=1$ 的后验优势比中恢复：\n$$\nP(C=1 \\mid \\text{data}) = \\frac{1}{1 + \\frac{P(C=0 \\mid \\text{data})}{P(C=1 \\mid \\text{data})}} = \\frac{1}{1 + \\frac{L_0(1-\\pi)}{L_1\\pi}}\n$$\n让我们将 $C=0$ 对 $C=1$ 的对数后验优势比定义为 $\\theta$：\n$$\n\\theta = \\log\\left(\\frac{L_0(1-\\pi)}{L_1\\pi}\\right) = \\log\\left(\\frac{L_0}{L_1}\\right) + \\log\\left(\\frac{1-\\pi}{\\pi}\\right)\n$$\n那么，$P(C=1 \\mid \\text{data}) = \\frac{1}{1 + e^{\\theta}}$。这个公式在数值上是稳定的。\n\n项 $\\log(L_0/L_1)$ 是对数贝叶斯因子。它是对数似然的差：\n$$\n\\log\\left(\\frac{L_0}{L_1}\\right) = \\log(L_0) - \\log(L_1)\n$$\n对数似然 $\\log(L_c)$ 是：\n$$\n\\log(L_c) = \\left(-\\lambda_c + n_{\\mathrm{AFP}}\\log(\\lambda_c) - \\log(n_{\\mathrm{AFP}}!)\\right) + \\left(\\log\\binom{S}{y_{\\mathrm{env}}} + y_{\\mathrm{env}}\\log(p_c) + (S-y_{\\mathrm{env}})\\log(1-p_c)\\right)\n$$\n在计算差值 $\\log(L_0) - \\log(L_1)$ 时，$\\log(n_{\\mathrm{AFP}}!)$ 和 $\\log\\binom{S}{y_{\\mathrm{env}}}$ 项会抵消，从而简化了对数贝叶斯因子的表达式：\n$$\n\\log\\left(\\frac{L_0}{L_1}\\right) = (\\lambda_1 - \\lambda_0) + n_{\\mathrm{AFP}}(\\log\\lambda_0 - \\log\\lambda_1) + y_{\\mathrm{env}}(\\log p_0 - \\log p_1) + (S-y_{\\mathrm{env}})(\\log(1-p_0) - \\log(1-p_1))\n$$\n为了处理参数或计数为零的边缘情况（例如 $n_{\\mathrm{AFP}}=0$，$p_0=0$），必须仔细计算形如 $x\\log(y)$ 的项。使用约定 $0\\log(0) = 0$，`scipy.special.xlogy(x, y)` 函数可以正确处理这种情况。\n\n$\\theta$ 的完整表达式为：\n$$\n\\theta = \\left((\\lambda_1 - \\lambda_0) + (x\\log y(n_{\\mathrm{AFP}}, \\lambda_0) - x\\log y(n_{\\mathrm{AFP}}, \\lambda_1))\\right) + \\left((x\\log y(y_{\\mathrm{env}}, p_0) - x\\log y(y_{\\mathrm{env}}, p_1)) + (x\\log y(S-y_{\\mathrm{env}}, 1-p_0) - x\\log y(S-y_{\\mathrm{env}}, 1-p_1))\\right) + (\\log(1-\\pi) - \\log(\\pi))\n$$\n先验 $\\pi$ 的边缘情况被分开处理：如果 $\\pi=0$，后验概率 $P(C=1|\\text{data})$ 必须为 $0$；如果 $\\pi=1$，则必须为 $1$。该实现为每个测试用例封装了此逻辑，计算 $\\theta$，并推导出最终的后验概率。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import xlogy\n\ndef calculate_posterior(pi, lambda1, lambda0, S, p1, p0, n_afp, y_env):\n    \"\"\"\n    Calculates the posterior probability of circulation P(C=1 | data)\n    using a Bayesian model with Poisson and Binomial likelihoods.\n\n    Args:\n        pi (float): Prior probability of circulation, P(C=1).\n        lambda1 (float): Expected AFP cases under circulation (C=1).\n        lambda0 (float): Expected AFP cases without circulation (C=0).\n        S (int): Total number of environmental samples.\n        p1 (float): Detection probability per sample under circulation (C=1).\n        p0 (float): False positive probability per sample without circulation (C=0).\n        n_afp (int): Observed number of AFP cases.\n        y_env (int): Observed number of positive environmental samples.\n\n    Returns:\n        float: The posterior probability of circulation, P(C=1 | data).\n    \"\"\"\n    # Handle edge cases for the prior probability pi.\n    # If the prior belief is absolute, the posterior must match.\n    if pi == 0.0:\n        return 0.0\n    if pi == 1.0:\n        return 1.0\n\n    # The computation is based on the log posterior odds of no circulation (C=0)\n    # versus circulation (C=1), which is log(P(C=0|data)/P(C=1|data)).\n    # This equals log(L0/L1) + log((1-pi)/pi), where L is the likelihood.\n\n    # 1. Calculate the log of the Bayes Factor for C=0 vs C=1: log(L0/L1).\n    # This is log(L0) - log(L1). The factorial/combinatorial terms cancel.\n    # We use scipy.special.xlogy(x, y) which computes x * log(y) and handles\n    # the case where x=0, ensuring the result is 0.\n\n    # Component from AFP data (Poisson model likelihood ratio):\n    # (lambda1 - lambda0) + n_afp * (log(lambda0) - log(lambda1))\n    log_bf_afp = (lambda1 - lambda0) + (xlogy(n_afp, lambda0) - xlogy(n_afp, lambda1))\n\n    # Component from environmental data (Binomial model likelihood ratio):\n    # y_env * (log(p0) - log(p1)) + (S - y_env) * (log(1-p0) - log(1-p1))\n    log_bf_env = (xlogy(y_env, p0) - xlogy(y_env, p1)) + \\\n                 (xlogy(S - y_env, 1 - p0) - xlogy(S - y_env, 1 - p1))\n\n    log_bayes_factor_01 = log_bf_afp + log_bf_env\n\n    # 2. Calculate the log of the prior odds for C=0 vs C=1.\n    log_prior_odds_01 = np.log(1 - pi) - np.log(pi)\n\n    # 3. The log of the posterior odds for C=0 vs C=1 is the sum.\n    log_posterior_odds_01 = log_bayes_factor_01 + log_prior_odds_01\n\n    # 4. Convert log posterior odds back to the probability of C=1.\n    # P(C=1|data) = 1 / (1 + PosteriorOdds(C=0|data)/PosteriorOdds(C=1|data))\n    #             = 1 / (1 + exp(log_posterior_odds_01))\n    # This formula is numerically stable and handles Inf/-Inf correctly.\n    # np.exp(-inf) -> 0; np.exp(inf) -> inf.\n    posterior_C1 = 1.0 / (1.0 + np.exp(log_posterior_odds_01))\n    \n    return posterior_C1\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (pi, lambda1, lambda0, S, p1, p0, n_AFP, y_env)\n        (0.5, 0.8, 0.01, 12, 0.3, 0.001, 0, 0),\n        (0.2, 1.2, 0.02, 8, 0.25, 0.001, 1, 0),\n        (0.1, 0.5, 0.005, 20, 0.4, 0.002, 0, 3),\n        (0.7, 2.0, 0.01, 50, 0.5, 0.001, 0, 0),\n        (0.4, 0.7, 0.02, 0, 0.0, 0.0, 0, 0),\n        (0.001, 0.3, 0.01, 10, 0.2, 0.001, 0, 1),\n        (0.99, 1.5, 0.01, 12, 0.3, 0.001, 2, 5)\n    ]\n\n    results = []\n    for case in test_cases:\n        pi, lambda1, lambda0, S, p1, p0, n_afp, y_env = case\n        posterior = calculate_posterior(pi, lambda1, lambda0, S, p1, p0, n_afp, y_env)\n        # Round the result to 6 decimal places as specified.\n        results.append(f\"{posterior:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}