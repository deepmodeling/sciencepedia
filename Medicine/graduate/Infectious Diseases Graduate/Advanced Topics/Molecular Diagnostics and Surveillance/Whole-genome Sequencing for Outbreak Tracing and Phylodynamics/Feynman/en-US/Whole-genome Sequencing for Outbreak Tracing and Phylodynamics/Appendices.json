{
    "hands_on_practices": [
        {
            "introduction": "The power of whole-genome sequencing (WGS) for outbreak tracing hinges on the accumulation of genetic diversity over the course of an epidemic. However, in short, explosive outbreaks, pathogens may not have sufficient time for mutations to arise on the internal branches of the phylogeny that connect different transmission clusters. This exercise provides a quantitative framework, rooted in the Poisson nature of substitutions, to estimate the expected number of phylogenetically informative sites, allowing you to predict and understand these fundamental resolution limits. ",
            "id": "4706980",
            "problem": "A research team is using whole-genome sequencing to trace transmission in a short-duration outbreak of a haploid RNA virus. Mutations are modeled as a memoryless Poisson point process along each branch of the time-scaled phylogeny, with a constant per-site substitution rate $\\mu$ (substitutions per site per day), under the infinite-sites model and negligible recombination. In this setting, a site is phylogenetically informative for resolving branching order if and only if the mutation arose on an internal branch that subtends at least two sampled genomes, so that both the ancestral and derived alleles are each present in at least two sequences at the end of sampling.\n\nConsider a time-scaled phylogeny reconstructed from $12$ genomes sampled at the end of the outbreak, whose internal branches (each subtending at least two tips) have lengths $2.5$ days, $1.2$ days, and $0.8$ days. Terminal branches are long due to rapid, near-synchronous sampling but do not contribute to phylogenetically informative changes under the above criterion. The whole-genome alignment length is $L=30{,}000$ sites, and the per-site substitution rate is $\\mu = 1.1 \\times 10^{-6}$ substitutions per site per day.\n\nUsing only the above assumptions and quantities, estimate the expected number of phylogenetically informative sites in this dataset. Round your answer to three significant figures and express it as a pure number without units. Briefly explain the resolution limits that arise in short outbreaks in terms of your estimate.",
            "solution": "The problem is assessed as valid. It is scientifically grounded in the principles of molecular evolution, internally consistent, and provides all necessary data to compute the requested estimate.\n\nThe problem asks for the expected number of phylogenetically informative sites in a whole-genome dataset from a viral outbreak. The model for mutation accumulation is a Poisson process.\n\nFirst, we identify the given parameters:\n- The whole-genome alignment length is $L = 30,000$ sites.\n- The per-site substitution rate is $\\mu = 1.1 \\times 10^{-6}$ substitutions per site per day.\n- The number of sampled genomes is $12$.\n- The problem defines phylogenetically informative sites as those resulting from mutations on specific internal branches of the phylogeny. The lengths of these branches are given as $b_1 = 2.5$ days, $b_2 = 1.2$ days, and $b_3 = 0.8$ days.\n\nThe number of substitutions along any given branch of the phylogeny is a random variable that follows a Poisson distribution. The rate parameter, $\\lambda$, of this distribution is the product of the per-site substitution rate ($\\mu$), the number of sites ($L$), and the duration of the branch in time ($t$). Thus, the expected number of substitutions on a branch of length $t$ is $E[S] = \\mu \\times L \\times t$.\n\nThe problem states that phylogenetically informative sites arise from mutations occurring only on the specified internal branches. Under the infinite-sites model, each new mutation occurs at a unique site in the genome. Therefore, the expected number of phylogenetically informative sites, denoted $E[N_{\\text{inf}}]$, is equal to the total expected number of mutations occurring across all the specified internal branches.\n\nBy the linearity of expectation, the total expected number of mutations is the sum of the expected numbers on each individual branch. This is equivalent to multiplying the genomic substitution rate ($\\mu \\times L$) by the total length of all relevant branches.\n\nLet $T_{\\text{int}}$ be the total length of the internal branches where informative mutations can occur.\n$$T_{\\text{int}} = b_1 + b_2 + b_3$$\nSubstituting the given values:\n$$T_{\\text{int}} = 2.5 + 1.2 + 0.8 = 4.5 \\text{ days}$$\n\nNow, we can calculate the expected number of informative sites, $E[N_{\\text{inf}}]$:\n$$E[N_{\\text{inf}}] = \\mu \\times L \\times T_{\\text{int}}$$\n\nPlugging in the numerical values for the parameters:\n$$E[N_{\\text{inf}}] = (1.1 \\times 10^{-6} \\text{ site}^{-1} \\text{day}^{-1}) \\times (30,000 \\text{ sites}) \\times (4.5 \\text{ days})$$\n\nFirst, calculate the genome-wide substitution rate, $R_G$:\n$$R_G = \\mu \\times L = (1.1 \\times 10^{-6}) \\times (3 \\times 10^4) = 3.3 \\times 10^{-2} \\text{ substitutions per day}$$\n\nNow, multiply by the total internal branch length:\n$$E[N_{\\text{inf}}] = R_G \\times T_{\\text{int}} = (3.3 \\times 10^{-2}) \\times 4.5$$\n$$E[N_{\\text{inf}}] = 0.033 \\times 4.5 = 0.1485$$\n\nThe problem requires the answer to be rounded to three significant figures. The first three significant figures are $1$, $4$, and $8$. The next digit is $5$, so we round the last significant figure up.\n$$E[N_{\\text{inf}}] \\approx 0.149$$\n\nRegarding the resolution limits, this estimate provides a clear explanation. The expected number of phylogenetically informative sites, $E[N_{\\text{inf}}]$, is approximately $0.149$. Since this value is much less than $1$, it indicates that it is highly probable to observe zero such sites in any given realization of this outbreak. The actual number of informative sites, $N_{\\text{inf}}$, follows a Poisson distribution with mean $\\lambda = 0.1485$. The probability of observing zero informative sites is:\n$$P(N_{\\text{inf}} = 0) = \\frac{\\lambda^0 \\exp(-\\lambda)}{0!} = \\exp(-0.1485) \\approx 0.862$$\nThis means there is an approximately $86\\%$ probability that the dataset will contain no sites that can help resolve the internal branching order of the phylogeny. Phylogenetic resolution, the ability to determine the tree topology, is critically dependent on these informative sites. Without them, the relationships between the sampled genomes cannot be determined, and the resulting phylogeny is an unresolved \"star-like\" topology. This scarcity of genetic variation accumulated over the short internal branches of a rapid outbreak poses a fundamental limit to the resolution of transmission tracing using genomic data.",
            "answer": "$$\\boxed{0.149}$$"
        },
        {
            "introduction": "When genomic data alone is insufficient to resolve transmission links—for example, when two cases share identical pathogen genomes—we can increase our inferential power by integrating other sources of information. This practice demonstrates a core technique in modern phylodynamics: combining genomic evidence with epidemiological timing within a formal probabilistic framework. By modeling the serial interval with a Gamma distribution and applying Bayesian reasoning, you will learn to calculate the posterior probability of a direct transmission link, a fundamental skill for nuanced outbreak investigation. ",
            "id": "4706992",
            "problem": "In a hospital outbreak of an acute viral infection, whole-genome sequencing (WGS) reveals two cases with identical consensus sequences sampled $\\Delta t = 5$ days apart. Assume the following modeling framework to integrate genomic and epidemiological timing information for outbreak tracing: the serial interval (time from symptom onset in an infector to symptom onset in the infectee) is modeled by a Gamma distribution with mean $m = 4$ days and variance $v = 2$ days$^{2}$. Assume sampling delays are identical across cases so that sampling time differences equal serial interval sums along transmission chains. Further, suppose that, conditional on the chain length, serial intervals along a chain are independent and identically distributed. Motivated by the genomic identity over a short calendar time, adopt a two-hypothesis model in which either there is a single direct transmission ($N=1$) or exactly one intermediate host ($N=2$), with equal prior probabilities $P(N=1) = P(N=2) = \\tfrac{1}{2}$ and $P(N \\ge 3) = 0$. Under $N=n$, the $\\Delta t$ is the sum of $n$ independent serial intervals. In the small-window limit around $t=\\Delta t$, approximate event probabilities with the corresponding probability densities evaluated at $t$. Using only these assumptions and starting from fundamental definitions of the Gamma distribution’s mean and variance and the additivity of independent Gamma variables with common scale, compute the posterior probability that the two cases share a direct transmission link given $\\Delta t = 5$ days. Express your final answer as a decimal and round to four significant figures. Do not include any units in your final answer.",
            "solution": "The objective is to compute the posterior probability of direct transmission, $P(N=1)$, given the observation that the time difference between samples is $\\Delta t = 5$ days. This is a Bayesian inference problem, and the desired quantity is $P(N=1 | \\Delta t = 5)$.\n\nAccording to Bayes' theorem, the posterior probability is given by:\n$$ P(N=1 | \\Delta t = 5) = \\frac{P(\\Delta t = 5 | N=1) P(N=1)}{P(\\Delta t = 5)} $$\nThe denominator, the marginal probability of the observation, is found by summing over all possible hypotheses using the law of total probability:\n$$ P(\\Delta t = 5) = P(\\Delta t = 5 | N=1) P(N=1) + P(\\Delta t = 5 | N=2) P(N=2) $$\nThe problem states that we can approximate the probability of an event in a small window around $\\Delta t$ with the value of the probability density function (pdf) at that point. Let $f_n(t)$ be the pdf of the time difference $\\Delta t$ under the hypothesis of $n$ transmissions. Thus, we can write $P(\\Delta t=5 | N=n) \\propto f_n(5)$. The posterior probability becomes:\n$$ P(N=1 | \\Delta t = 5) \\approx \\frac{f_1(5) P(N=1)}{f_1(5) P(N=1) + f_2(5) P(N=2)} $$\nWe are given that the prior probabilities are equal, $P(N=1) = P(N=2) = \\frac{1}{2}$. Substituting these values simplifies the expression:\n$$ P(N=1 | \\Delta t = 5) \\approx \\frac{f_1(5) \\cdot \\frac{1}{2}}{f_1(5) \\cdot \\frac{1}{2} + f_2(5) \\cdot \\frac{1}{2}} = \\frac{f_1(5)}{f_1(5) + f_2(5)} $$\nTo solve this, we must first determine the pdfs $f_1(t)$ and $f_2(t)$.\n\nFirst, we find the parameters of the Gamma distribution for a single serial interval. Let a single serial interval $T$ be a random variable following a Gamma distribution, $T \\sim \\text{Gamma}(\\alpha, \\beta)$, with shape parameter $\\alpha > 0$ and rate parameter $\\beta > 0$. The pdf is $f(t; \\alpha, \\beta) = \\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)} t^{\\alpha-1} \\exp(-\\beta t)$. The mean $m$ and variance $v$ of this distribution are given by:\n$$ m = E[T] = \\frac{\\alpha}{\\beta} $$\n$$ v = \\text{Var}(T) = \\frac{\\alpha}{\\beta^2} $$\nWe are given $m = 4$ days and $v = 2$ days$^2$. We can solve for $\\alpha$ and $\\beta$:\n$$ \\frac{m}{v} = \\frac{\\alpha/\\beta}{\\alpha/\\beta^2} = \\beta \\implies \\beta = \\frac{4}{2} = 2 $$\nUsing $\\beta=2$, we can find $\\alpha$:\n$$ \\alpha = m \\cdot \\beta = 4 \\cdot 2 = 8 $$\nSo, a single serial interval is modeled by a $\\text{Gamma}(\\alpha=8, \\beta=2)$ distribution.\n\nUnder the hypothesis $N=1$, the time difference $\\Delta t$ is the duration of a single serial interval. Therefore, the distribution of $\\Delta t$ is $\\text{Gamma}(8, 2)$, and its pdf, $f_1(t)$, is:\n$$ f_1(t) = f(t; 8, 2) = \\frac{2^8}{\\Gamma(8)} t^{8-1} \\exp(-2t) = \\frac{256}{7!} t^7 \\exp(-2t) $$\n\nUnder the hypothesis $N=2$, $\\Delta t$ is the sum of two independent and identically distributed serial intervals, $\\Delta t = T_1 + T_2$, where $T_1, T_2 \\sim \\text{Gamma}(8, 2)$. A fundamental property of the Gamma distribution is that the sum of independent Gamma variables with the same rate parameter is also a Gamma variable. The new shape parameter is the sum of the individual shape parameters.\n$$ \\Delta t \\sim \\text{Gamma}(\\alpha_1+\\alpha_2, \\beta) = \\text{Gamma}(8+8, 2) = \\text{Gamma}(16, 2) $$\nThe pdf for this case, $f_2(t)$, is:\n$$ f_2(t) = f(t; 16, 2) = \\frac{2^{16}}{\\Gamma(16)} t^{16-1} \\exp(-2t) = \\frac{65536}{15!} t^{15} \\exp(-2t) $$\n\nNow we can compute the posterior probability by evaluating the ratio of these densities at $t = \\Delta t = 5$:\n$$ P(N=1 | \\Delta t = 5) \\approx \\frac{f_1(5)}{f_1(5) + f_2(5)} = \\frac{1}{1 + \\frac{f_2(5)}{f_1(5)}} $$\nLet's compute the ratio $R = \\frac{f_2(5)}{f_1(5)}$:\n$$ R = \\frac{\\frac{2^{16}}{15!} 5^{15} \\exp(-2 \\cdot 5)}{\\frac{2^8}{7!} 5^7 \\exp(-2 \\cdot 5)} = \\frac{2^{16} \\cdot 5^{15} \\cdot 7!}{2^8 \\cdot 5^7 \\cdot 15!} $$\nThe $\\exp(-10)$ terms cancel. Simplifying the powers and factorials:\n$$ R = \\frac{2^{16-8} \\cdot 5^{15-7}}{15!/7!} = \\frac{2^8 \\cdot 5^8}{15 \\cdot 14 \\cdot 13 \\cdot 12 \\cdot 11 \\cdot 10 \\cdot 9 \\cdot 8} = \\frac{(2 \\cdot 5)^8}{15 \\cdot 14 \\cdot 13 \\cdot 12 \\cdot 11 \\cdot 10 \\cdot 9 \\cdot 8} $$\n$$ R = \\frac{10^8}{259459200} = \\frac{100000000}{259459200} $$\nTo simplify this fraction, we can express the denominator in terms of its prime factors.\nThe denominator is $15!/7! = (3 \\cdot 5) \\cdot (2 \\cdot 7) \\cdot 13 \\cdot (2^2 \\cdot 3) \\cdot 11 \\cdot (2 \\cdot 5) \\cdot 3^2 \\cdot 2^3 = 2^7 \\cdot 3^4 \\cdot 5^2 \\cdot 7 \\cdot 11 \\cdot 13$.\nThe numerator is $10^8 = (2 \\cdot 5)^8 = 2^8 \\cdot 5^8$.\nThe ratio $R$ is therefore:\n$$ R = \\frac{2^8 \\cdot 5^8}{2^7 \\cdot 3^4 \\cdot 5^2 \\cdot 7 \\cdot 11 \\cdot 13} = \\frac{2 \\cdot 5^6}{3^4 \\cdot 7 \\cdot 11 \\cdot 13} = \\frac{2 \\cdot 15625}{81 \\cdot 1001} = \\frac{31250}{81081} $$\nNow, we substitute this back into the expression for the posterior probability:\n$$ P(N=1 | \\Delta t = 5) \\approx \\frac{1}{1 + R} = \\frac{1}{1 + \\frac{31250}{81081}} = \\frac{1}{\\frac{81081 + 31250}{81081}} = \\frac{81081}{112331} $$\nPerforming the division gives the final numerical answer:\n$$ P(N=1 | \\Delta t = 5) \\approx 0.721815... $$\nRounding to four significant figures, the posterior probability is $0.7218$.",
            "answer": "$$\\boxed{0.7218}$$"
        },
        {
            "introduction": "A primary goal of phylodynamic analysis is to estimate key epidemiological parameters that guide public health interventions. This hands-on coding exercise bridges the gap between a reconstructed transmission tree and a critical population-level metric: the effective reproductive number, $R_e$. By implementing an algorithm to calculate transmission rates and infectious durations directly from tree data, you will see how the branching structure and timing of a phylogeny translate into quantitative insights about an outbreak's growth potential. ",
            "id": "4707035",
            "problem": "You are given a set of reconstructed transmission trees derived from whole-genome sequencing (WGS) for pathogens in infectious disease outbreaks. Each tree represents inferred transmission events between hosts along time, where a node corresponds to an infected host with a start time of infectiousness and an end time of infectiousness (removal). An edge from a parent to a child indicates a transmission from the parent to the child at the child's infection time. The goal is to estimate the effective reproductive number (R_e), defined as the expected number of secondary infections generated by a typical infectious host under prevailing conditions, from the tree by combining estimates of the average branching intensity (transmission rate per unit time) and infectious branch durations, and then compare the resulting estimate to an independent epidemiological estimate for each tree.\n\nFundamental base and definitions:\n- The effective reproductive number (R_e) is defined as $R_e = \\mathbb{E}[\\text{number of transmissions per infectious host}]$ under current conditions.\n- Consider a homogeneous birth-death model for transmission where transmission events per infectious host occur as a Poisson process with rate $\\beta$ (per unit time), and host removal occurs with rate $\\gamma$. The infectious duration $D$ has mean $\\mathbb{E}[D] = 1/\\gamma$. Under these assumptions, the expected number of transmissions per host is $R_e = \\beta \\cdot \\mathbb{E}[D]$.\n- For a set of hosts with observed infectious intervals, and potentially right-censoring at a study end time $T_{\\text{end}}$, the maximum likelihood estimate (MLE) for the homogeneous Poisson rate $\\hat{\\beta}$ is the total number of observed transmission events $N$ divided by the total observed exposure time $\\sum_i T_i$, where $T_i$ is the observed infectious time-at-risk for host $i$. Specifically, $\\hat{\\beta} = N / \\sum_i T_i$. If all infectious durations are fully observed and uncensored, an empirical estimate of $\\mathbb{E}[D]$ is the sample mean $\\hat{\\mathbb{E}}[D] = \\frac{1}{n} \\sum_i D_i$. If durations are censored, an independent epidemiological estimate of the mean duration $D_{\\text{epi}}$ may be used for $\\mathbb{E}[D]$.\n- The resulting tree-based estimate of $R_e$ is $\\hat{R}_e = \\hat{\\beta} \\cdot \\widehat{\\mathbb{E}}[D]$, where $\\widehat{\\mathbb{E}}[D]$ is either the uncensored sample mean or an independent epidemiological mean.\n\nYour task:\n- Implement a program to compute $\\hat{R}_e$ for each tree using the above principles.\n- For each host $i$, you are given an infection start time $s_i$ (in days), an infectious end time $e_i$ (in days) which may be unknown (denoted as censored), and a list of child nodes indicating transmissions from $i$. The study end time is $T_{\\text{end}}$ (in days).\n- The observed time-at-risk for host $i$ is $T_i = \\max\\{0, \\min(e_i, T_{\\text{end}}) - s_i\\}$, in days. A transmission from host $i$ to its child $j$ is counted if the child’s infection time $s_j \\le T_{\\text{end}}$ and $s_j \\in [s_i, \\min(e_i, T_{\\text{end}})]$.\n- Compute the total number of observed transmissions $N$, the total observed exposure time $\\sum_i T_i$, and $\\hat{\\beta} = N / \\sum_i T_i$.\n- Compute $\\widehat{\\mathbb{E}}[D]$ as follows:\n  - If the tree specifies to use the tree-derived mean, take all hosts with non-censored durations satisfying $e_i \\le T_{\\text{end}}$ and compute $\\hat{\\mathbb{E}}[D] = \\frac{1}{n_{\\text{unc}}} \\sum_{i: e_i \\le T_{\\text{end}}} (e_i - s_i)$, in days. If $n_{\\text{unc}} = 0$, fall back to the provided independent mean $D_{\\text{epi}}$, in days.\n  - Otherwise, use the provided independent mean $D_{\\text{epi}}$, in days.\n- Compute the tree-based $R_e$ estimate $\\hat{R}_e = \\hat{\\beta} \\cdot \\widehat{\\mathbb{E}}[D]$ (dimensionless).\n- Compare $\\hat{R}_e$ to the provided independent epidemiological estimate $R_{e,\\text{epi}}$ (dimensionless) by computing the absolute difference $|\\hat{R}_e - R_{e,\\text{epi}}|$ and a boolean indicating whether this difference is within a given tolerance $\\tau$ (dimensionless), where the tolerance is specified per test (e.g., $\\tau = 0.1$).\n\nUnits and output specification:\n- All times must be treated in days. Rates are per day. The effective reproductive number $R_e$ is dimensionless. When reporting numeric results, round all floats to three decimal places.\n- Your program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets. Each test case result must itself be a list containing the rounded $\\hat{R}_e$ (float), the rounded $R_{e,\\text{epi}}$ (float), the rounded absolute difference (float), and the boolean within-tolerance indicator. For example: \"[[r1_tree,r1_epi,diff1,ok1],[r2_tree,r2_epi,diff2,ok2],...]\".\n\nTest suite:\nUse the following four trees as the input test suite. In each tree, ensure transmission times are within the infectious interval of each parent, and treat censored durations correctly.\n\n- Test case $1$ (early-growth window with right-censoring; use independent mean duration):\n  - $T_{\\text{end}} = 10$ days, use $D_{\\text{epi}} = 8.0$ days, $\\tau = 0.1$, $R_{e,\\text{epi}} = 1.5$.\n  - Nodes (id: $(s_i,e_i)$ days, children list):\n    - $0$: $(0, 15)$, children $[1,2,3]$; child infection times: $s_1 = 2$, $s_2 = 4$, $s_3 = 7$.\n    - $1$: $(2, 12)$, children $[4,5]$; child infection times: $s_4 = 5$, $s_5 = 9$.\n    - $2$: $(4, 12)$, children $[6]$; child infection time: $s_6 = 7$.\n    - $3$: $(7, \\text{censored})$, children $[7]$; child infection time: $s_7 = 9$.\n    - $4$: $(5, 13)$, children $[]$.\n    - $5$: $(9, \\text{censored})$, children $[]$.\n    - $6$: $(7, 14)$, children $[]$.\n    - $7$: $(9, \\text{censored})$, children $[]$.\n- Test case $2$ (completed slow-spread outbreak; use tree-derived mean duration):\n  - $T_{\\text{end}} = 100$ days, use tree mean, $\\tau = 0.1$, $R_{e,\\text{epi}} = 0.8$.\n  - Nodes:\n    - $0$: $(0, 8)$, children $[1,2]$; $s_1 = 2$, $s_2 = 4$.\n    - $1$: $(2, 6)$, children $[]$.\n    - $2$: $(4, 9)$, children $[3]$; $s_3 = 7$.\n    - $3$: $(7, 10)$, children $[]$.\n- Test case $3$ (no observed transmission; use tree-derived mean duration):\n  - $T_{\\text{end}} = 10$ days, use tree mean, $\\tau = 0.1$, $R_{e,\\text{epi}} = 0.05$.\n  - Nodes:\n    - $0$: $(0, 5)$, children $[]$.\n- Test case $4$ (completed moderate transmission; use tree-derived mean duration):\n  - $T_{\\text{end}} = 100$ days, use tree mean, $\\tau = 0.1$, $R_{e,\\text{epi}} = 0.85$.\n  - Nodes:\n    - $0$: $(0, 10)$, children $[1,2]$; $s_1 = 3$, $s_2 = 6$.\n    - $1$: $(3, 8)$, children $[3]$; $s_3 = 5$.\n    - $2$: $(6, 15)$, children $[4,5]$; $s_4 = 8$, $s_5 = 9$.\n    - $3$: $(5, 9)$, children $[]$.\n    - $4$: $(8, 13)$, children $[]$.\n    - $5$: $(9, 12)$, children $[]$.\n\nYour program must implement the above logic precisely and produce the single-line output as specified, with floats rounded to three decimal places and booleans indicating tolerance satisfaction. No external input is required; the program must embed the test suite internally.",
            "solution": "The problem statement has been critically validated and is deemed valid. It is scientifically grounded in established principles of infectious disease phylodynamics, mathematically well-posed, and provides a complete and consistent set of definitions and data.\n\nThe core task is to estimate the effective reproductive number, $R_e$, from a reconstructed transmission tree and compare it to an independent epidemiological estimate, $R_{e,\\text{epi}}$. The fundamental principle is based on a homogeneous birth-death model of transmission, where $R_e$ is the product of the transmission rate per infectious host, $\\beta$, and the mean duration of infectiousness, $\\mathbb{E}[D]$. The relationship is given by:\n$$R_e = \\beta \\cdot \\mathbb{E}[D]$$\n\nThe algorithmic procedure involves estimating the two components, $\\beta$ and $\\mathbb{E}[D]$, from the provided tree data.\n\n**1. Estimation of the Transmission Rate ($\\hat{\\beta}$)**\n\nThe transmission rate is estimated using its Maximum Likelihood Estimate (MLE) for a homogeneous Poisson process, which is the total number of observed events divided by the total observation time. In this context:\n$$\\hat{\\beta} = \\frac{N}{\\sum_i T_i}$$\nwhere $N$ is the total number of observed transmission events and $\\sum_i T_i$ is the total time-at-risk summed over all infectious hosts in the study.\n\n-   **Total Observed Transmissions ($N$):** We determine $N$ by examining each parent-child transmission link in the tree. A transmission from a parent host $i$ to a child host $j$ is counted if it occurs within the observation window. This requires satisfying two conditions: the child's infection time, $s_j$, must occur before or at the study end time, $T_{\\text{end}}$, and it must fall within the parent's observed infectious period. The valid transmission interval for host $i$ is $[s_i, \\min(e_i, T_{\\text{end}})]$. Thus, a transmission is counted if $s_j \\le T_{\\text{end}}$ and $s_i \\le s_j \\le \\min(e_i, T_{\\text{end}})$.\n\n-   **Total Time-at-Risk ($\\sum_i T_i$):** This quantity represents the total duration across all hosts during which they were infectious and could have been observed transmitting the pathogen. For each host $i$, with infection start time $s_i$ and end time $e_i$, the observed time-at-risk, $T_i$, is truncated by the study end time $T_{\\text{end}}$. If the end of infectiousness $e_i$ is unknown (censored), it is treated as extending beyond $T_{\\text{end}}$. The formula for a single host's contribution is:\n    $$T_i = \\max\\{0, \\min(e_i, T_{\\text{end}}) - s_i\\}$$\n    The total time-at-risk is the sum of these values over all hosts in the tree.\n\n**2. Estimation of Mean Infectious Duration ($\\widehat{\\mathbb{E}}[D]$)**\n\nThe problem specifies two distinct methods for estimating the mean infectious duration, $\\mathbb{E}[D]$:\n\n-   **Tree-Derived Mean:** When specified, this estimate is calculated as the sample mean of infectious durations for a specific subset of hosts. A host $i$ is included in this calculation only if their infectious duration is fully observed (i.e., $e_i$ is not censored) and their infectious period concludes on or before the study end time ($e_i \\le T_{\\text{end}}$). If $n_{\\text{unc}}$ is the number of such hosts, the estimate is:\n    $$\\widehat{\\mathbb{E}}[D] = \\frac{1}{n_{\\text{unc}}} \\sum_{i: e_i \\le T_{\\text{end}}} (e_i - s_i)$$\n    If no hosts meet these criteria ($n_{\\text{unc}} = 0$), the calculation falls back to using the provided independent epidemiological mean, $D_{\\text{epi}}$.\n\n-   **Independent Epidemiological Mean:** When specified, the externally provided value, $D_{\\text{epi}}$, is used directly for $\\widehat{\\mathbb{E}}[D]$. This is common when tree data is heavily censored or deemed insufficient for a reliable internal estimate.\n\n**3. Final Calculation and Comparison**\n\nWith estimates for both components, the tree-based effective reproductive number, $\\hat{R}_e$, is computed as:\n$$\\hat{R}_e = \\hat{\\beta} \\cdot \\widehat{\\mathbb{E}}[D]$$\nThis dimensionless value represents the average number of secondary infections per host as inferred from the transmission tree's structure and timing.\n\nFinally, this estimate is compared against the independent epidemiological value $R_{e,\\text{epi}}$. The comparison is quantified by the absolute difference, $|\\hat{R}_e - R_{e,\\text{epi}}|$, and a boolean check to determine if this difference is within a given tolerance, $\\tau$:\n$$|\\hat{R}_e - R_{e,\\text{epi}}| \\le \\tau$$\nThe implementation will process each test case according to these principles, yielding values for $\\hat{R}_e$, $R_{e,\\text{epi}}$, their absolute difference, and the tolerance check, with all floating-point results rounded to three decimal places.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and compares tree-based and epidemiological estimates of the\n    effective reproductive number (R_e) for a suite of transmission trees.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # np.inf is used to represent censored end-of-infectiousness times.\n    test_cases = [\n        # Test case 1: early-growth window with right-censoring; use independent mean duration\n        {\n            \"T_end\": 10.0,\n            \"d_epi\": 8.0,\n            \"tau\": 0.1,\n            \"r_epi\": 1.5,\n            \"use_tree_mean\": False,\n            \"nodes\": {\n                0: {'s': 0.0, 'e': 15.0, 'children': [1, 2, 3]},\n                1: {'s': 2.0, 'e': 12.0, 'children': [4, 5]},\n                2: {'s': 4.0, 'e': 12.0, 'children': [6]},\n                3: {'s': 7.0, 'e': np.inf, 'children': [7]},\n                4: {'s': 5.0, 'e': 13.0, 'children': []},\n                5: {'s': 9.0, 'e': np.inf, 'children': []},\n                6: {'s': 7.0, 'e': 14.0, 'children': []},\n                7: {'s': 9.0, 'e': np.inf, 'children': []}\n            }\n        },\n        # Test case 2: completed slow-spread outbreak; use tree-derived mean duration\n        {\n            \"T_end\": 100.0,\n            \"d_epi\": 0,  # Not used, but provided for fallback consistency\n            \"tau\": 0.1,\n            \"r_epi\": 0.8,\n            \"use_tree_mean\": True,\n            \"nodes\": {\n                0: {'s': 0.0, 'e': 8.0, 'children': [1, 2]},\n                1: {'s': 2.0, 'e': 6.0, 'children': []},\n                2: {'s': 4.0, 'e': 9.0, 'children': [3]},\n                3: {'s': 7.0, 'e': 10.0, 'children': []}\n            }\n        },\n        # Test case 3: no observed transmission; use tree-derived mean duration\n        {\n            \"T_end\": 10.0,\n            \"d_epi\": 5.0,  # Fallback value\n            \"tau\": 0.1,\n            \"r_epi\": 0.05,\n            \"use_tree_mean\": True,\n            \"nodes\": {\n                0: {'s': 0.0, 'e': 5.0, 'children': []}\n            }\n        },\n        # Test case 4: completed moderate transmission; use tree-derived mean duration\n        {\n            \"T_end\": 100.0,\n            \"d_epi\": 0,  # Not used\n            \"tau\": 0.1,\n            \"r_epi\": 0.85,\n            \"use_tree_mean\": True,\n            \"nodes\": {\n                0: {'s': 0.0, 'e': 10.0, 'children': [1, 2]},\n                1: {'s': 3.0, 'e': 8.0, 'children': [3]},\n                2: {'s': 6.0, 'e': 15.0, 'children': [4, 5]},\n                3: {'s': 5.0, 'e': 9.0, 'children': []},\n                4: {'s': 8.0, 'e': 13.0, 'children': []},\n                5: {'s': 9.0, 'e': 12.0, 'children': []}\n            }\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        T_end = case[\"T_end\"]\n        nodes_data = case[\"nodes\"]\n        \n        total_exposure_time = 0.0\n        total_transmissions = 0\n        \n        # Calculate total exposure time and total number of transmissions\n        for host_id, data in nodes_data.items():\n            s_i = data['s']\n            e_i = data['e']\n            \n            # Calculate observed time-at-risk for host i\n            time_at_risk = max(0, min(e_i, T_end) - s_i)\n            total_exposure_time += time_at_risk\n            \n            # Check for observed transmissions from host i\n            parent_risk_end = min(e_i, T_end)\n            for child_id in data['children']:\n                child_data = nodes_data[child_id]\n                s_j = child_data['s']\n                \n                # Check if transmission is observed within the valid time window\n                if s_j <= T_end and s_i <= s_j <= parent_risk_end:\n                    total_transmissions += 1\n\n        # Calculate beta_hat (transmission rate)\n        if total_exposure_time > 0:\n            beta_hat = total_transmissions / total_exposure_time\n        else:\n            beta_hat = 0.0\n\n        # Calculate mean infectious duration (E[D])\n        mean_D = 0.0\n        if case[\"use_tree_mean\"]:\n            uncensored_durations = []\n            for host_id, data in nodes_data.items():\n                if data['e'] != np.inf and data['e'] <= T_end:\n                    duration = data['e'] - data['s']\n                    uncensored_durations.append(duration)\n            \n            if len(uncensored_durations) > 0:\n                mean_D = sum(uncensored_durations) / len(uncensored_durations)\n            else:\n                # Fallback to provided independent mean if no hosts qualify\n                mean_D = case[\"d_epi\"]\n        else:\n            mean_D = case[\"d_epi\"]\n\n        # Calculate tree-based R_e\n        r_e_hat = beta_hat * mean_D\n        \n        # Compare with epidemiological R_e\n        r_epi = case[\"r_epi\"]\n        abs_diff = abs(r_e_hat - r_epi)\n        is_within_tolerance = abs_diff <= case[\"tau\"]\n        \n        # Format results as specified: list of [float, float, float, bool]\n        result_list = [\n            round(r_e_hat, 3),\n            round(r_epi, 3),  # Problem says to round all floats\n            round(abs_diff, 3),\n            is_within_tolerance\n        ]\n        results.append(result_list)\n        \n    # Final print statement must produce the single-line format specified.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}