{
    "hands_on_practices": [
        {
            "introduction": "Effective management of Alcohol Use Disorder often requires tailoring pharmacotherapy to individual patient characteristics, especially in the presence of comorbidities like liver disease. This first exercise grounds clinical decision-making in fundamental pharmacokinetic principles, demonstrating why a drug like lorazepam is preferred over diazepam in hepatic impairment. You will derive a patient-specific dosing interval by matching the desired therapeutic profile—specifically, the peak-to-trough fluctuation at steady state—providing a quantitative basis for designing a safer and more effective treatment regimen from first principles. ",
            "id": "4792577",
            "problem": "A hospitalized patient with alcohol use disorder and decompensated cirrhosis requires a fixed-schedule benzodiazepine regimen to manage withdrawal. Due to hepatic impairment, the clinical team plans to select lorazepam over diazepam, motivated by lorazepam’s predominant Phase II glucuronidation and the expectation of relatively preserved clearance. To ensure comparable symptom control with minimized oversedation risk, the team aims to match the steady-state peak-to-trough oscillation achieved by a standard diazepam schedule used in normal hepatic function.\n\nAssume a one-compartment model with first-order elimination for both drugs. The patient’s mass is 80 kilograms. For diazepam in normal hepatic function, use a volume of distribution of 1.0 liters per kilogram and a clearance of 1.2 liters per hour, and consider a dosing interval of 12 hours. For lorazepam, use a volume of distribution of 1.3 liters per kilogram and a normal hepatic clearance of 4.8 liters per hour; in this patient’s hepatic impairment, assume lorazepam clearance is reduced to 0.80 of its normal value while volume of distribution is unchanged.\n\nStarting from fundamental pharmacokinetic definitions and well-tested relations for linear, first-order elimination and multiple dosing at steady state, determine the lorazepam dosing interval in hours that will produce the same steady-state peak-to-trough concentration ratio as diazepam achieves with 12-hour dosing in normal hepatic function. Express your final answer in hours and round to four significant figures.",
            "solution": "The user wants me to solve the following problem:\nA hospitalized patient with alcohol use disorder and decompensated cirrhosis requires a fixed-schedule benzodiazepine regimen to manage withdrawal. Due to hepatic impairment, the clinical team plans to select lorazepam over diazepam, motivated by lorazepam’s predominant Phase II glucuronidation and the expectation of relatively preserved clearance. To ensure comparable symptom control with minimized oversedation risk, the team aims to match the steady-state peak-to-trough oscillation achieved by a standard diazepam schedule used in normal hepatic function. Assume a one-compartment model with first-order elimination for both drugs. The patient’s mass is $80$ kilograms. For diazepam in normal hepatic function, use a volume of distribution of $1.0$ liters per kilogram and a clearance of $1.2$ liters per hour, and consider a dosing interval of $12$ hours. For lorazepam, use a volume of distribution of $1.3$ liters per kilogram and a normal hepatic clearance of $4.8$ liters per hour; in this patient’s hepatic impairment, assume lorazepam clearance is reduced to $0.80$ of its normal value while volume of distribution is unchanged. Starting from fundamental pharmacokinetic definitions and well-tested relations for linear, first-order elimination and multiple dosing at steady state, determine the lorazepam dosing interval in hours that will produce the same steady-state peak-to-trough concentration ratio as diazepam achieves with $12$-hour dosing in normal hepatic function. Express your final answer in hours and round to four significant figures.\n\n### Step 1: Extract Givens\nThe data and conditions provided in the problem statement are:\n-   Pharmacokinetic model: One-compartment model with first-order elimination.\n-   Patient mass: $m = 80 \\text{ kg}$.\n-   Diazepam parameters (normal hepatic function):\n    -   Volume of distribution per unit mass: $V_{d,D,per\\_kg} = 1.0 \\text{ L/kg}$.\n    -   Total body clearance: $CL_D = 1.2 \\text{ L/h}$.\n    -   Dosing interval: $\\tau_D = 12 \\text{ h}$.\n-   Lorazepam parameters (patient):\n    -   Volume of distribution per unit mass: $V_{d,L,per\\_kg} = 1.3 \\text{ L/kg}$ (unchanged from normal).\n    -   Normal total body clearance: $CL_{L,normal} = 4.8 \\text{ L/h}$.\n    -   Patient's total body clearance: $CL_L = 0.80 \\times CL_{L,normal}$.\n-   Objective: Determine the lorazepam dosing interval, $\\tau_L$, such that the steady-state peak-to-trough concentration ratio for lorazepam in the patient equals that for diazepam in normal hepatic function.\n-   Required Precision: Round the final answer to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed against the validation criteria:\n-   **Scientifically Grounded**: The problem is based on the one-compartment model with first-order kinetics, a fundamental and widely used framework in clinical pharmacokinetics. The provided pharmacokinetic parameters for diazepam and lorazepam are within realistic physiological ranges. The clinical rationale for choosing lorazepam over diazepam in hepatic impairment is sound, reflecting established medical practice regarding drug metabolism pathways (Phase II glucuronidation vs. Phase I oxidation). The problem is firmly rooted in established scientific principles.\n-   **Well-Posed**: The problem provides all necessary parameters to calculate the desired quantity, $\\tau_L$. The objective is clearly defined: to equate the steady-state peak-to-trough ratios of the two drugs under their respective specified conditions. A unique solution can be derived from the given information.\n-   **Objective**: The problem is stated using precise, unbiased, and standard terminology of pharmacokinetics. It is free from subjective claims or ambiguity.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is scientifically sound, well-posed, objective, and complete. I will proceed with a full solution.\n\n### Solution\nThe primary objective is to find the dosing interval for lorazepam, $\\tau_L$, that results in the same steady-state peak-to-trough concentration ratio, $R_{ss}$, as that of diazepam. The condition is therefore:\n$$R_{ss,L} = R_{ss,D}$$\n\nFor a drug administered intermittently in a one-compartment model with first-order elimination, the concentration of the drug in the body decays exponentially between doses. At steady state, the concentration reaches a peak, $C_{max,ss}$, immediately after a dose and declines to a trough, $C_{min,ss}$, just before the next dose is administered after a dosing interval $\\tau$. The relationship between the peak and trough concentrations is given by:\n$$C_{min,ss} = C_{max,ss} \\cdot \\exp(-k_e \\tau)$$\nwhere $k_e$ is the first-order elimination rate constant.\n\nThe steady-state peak-to-trough concentration ratio, $R_{ss}$, is defined as:\n$$R_{ss} = \\frac{C_{max,ss}}{C_{min,ss}} = \\frac{C_{max,ss}}{C_{max,ss} \\cdot \\exp(-k_e \\tau)} = \\exp(k_e \\tau)$$\nThis ratio represents the extent of concentration fluctuation over a dosing interval at steady state. The problem assumes an underlying IV bolus model for this peak/trough dynamic, which is a standard simplification for such problems.\n\nTo satisfy the problem's condition, we set the ratios for lorazepam and diazepam equal:\n$$\\exp(k_{e,L} \\tau_L) = \\exp(k_{e,D} \\tau_D)$$\n\nTaking the natural logarithm of both sides of the equation yields a direct relationship between the dosing intervals and elimination rate constants:\n$$k_{e,L} \\tau_L = k_{e,D} \\tau_D$$\n\nWe can solve for the unknown lorazepam dosing interval, $\\tau_L$:\n$$\\tau_L = \\tau_D \\frac{k_{e,D}}{k_{e,L}}$$\n\nThe elimination rate constant, $k_e$, is related to the total body clearance, $CL$, and the total volume of distribution, $V_d$, by the fundamental pharmacokinetic equation:\n$$k_e = \\frac{CL}{V_d}$$\n\nSubstituting this relationship into the equation for $\\tau_L$:\n$$\\tau_L = \\tau_D \\frac{CL_D / V_{d,D}}{CL_L / V_{d,L}} = \\tau_D \\frac{CL_D \\cdot V_{d,L}}{CL_L \\cdot V_{d,D}}$$\n\nThe total volume of distribution, $V_d$, is calculated from the given volume of distribution per unit mass and the patient's mass, $m$:\n$$V_d = V_{d, per\\_kg} \\cdot m$$\n\nSubstituting this into the equation for $\\tau_L$:\n$$\\tau_L = \\tau_D \\frac{CL_D \\cdot (V_{d,L,per\\_kg} \\cdot m)}{CL_L \\cdot (V_{d,D,per\\_kg} \\cdot m)}$$\n\nThe patient's mass, $m$, cancels from the numerator and denominator. This shows that the required dosing interval to achieve a specific fluctuation ratio is independent of the patient's mass, provided that the clearance is given as a total value and the volume of distribution scales linearly with mass. The resulting equation is:\n$$\\tau_L = \\tau_D \\frac{CL_D \\cdot V_{d,L,per\\_kg}}{CL_L \\cdot V_{d,D,per\\_kg}}$$\n\nNow, we substitute the given values into this equation.\nFirst, we calculate the patient's lorazepam clearance, $CL_L$:\n$$CL_L = 0.80 \\times CL_{L,normal} = 0.80 \\times 4.8 \\text{ L/h} = 3.84 \\text{ L/h}$$\n\nThe other parameters are:\n-   $\\tau_D = 12 \\text{ h}$\n-   $CL_D = 1.2 \\text{ L/h}$\n-   $V_{d,D,per\\_kg} = 1.0 \\text{ L/kg}$\n-   $V_{d,L,per\\_kg} = 1.3 \\text{ L/kg}$\n\nSubstituting these values into the expression for $\\tau_L$:\n$$\\tau_L = 12 \\text{ h} \\times \\frac{(1.2 \\text{ L/h}) \\cdot (1.3 \\text{ L/kg})}{(3.84 \\text{ L/h}) \\cdot (1.0 \\text{ L/kg})}$$\n$$\\tau_L = 12 \\text{ h} \\times \\frac{1.56}{3.84}$$\n$$\\tau_L = 12 \\text{ h} \\times 0.40625$$\n$$\\tau_L = 4.875 \\text{ h}$$\n\nThe problem requires the answer to be rounded to four significant figures. The calculated value $4.875$ already has four significant figures.\nThe required dosing interval for lorazepam is $4.875$ hours.",
            "answer": "$$\\boxed{4.875}$$"
        },
        {
            "introduction": "Building upon the principles of regimen design, this practice addresses a frequent and high-risk clinical scenario: managing acute alcohol withdrawal in a patient who has already received various medications. This problem requires you to synthesize concepts of equipotent dose conversion with first-order elimination kinetics to accurately estimate the residual sedative effect from multiple benzodiazepines. By calculating this cumulative \"on-board\" effect, you can then determine the precise supplemental dose needed to reach a therapeutic target without causing oversedation, a crucial skill for safe and effective acute care. ",
            "id": "4792622",
            "problem": "A hospitalized patient with severe Alcohol Use Disorder (AUD) withdrawal symptoms has already received multiple benzodiazepine doses before arrival. You are tasked with calculating a safe initial lorazepam dose to give now, using equipotent benzodiazepine equivalence and pharmacokinetic principles to account for residual on-board drug. Use the following well-tested facts as the fundamental base for your derivation:\n\n1. Equipotent benzodiazepine equivalence: $10\\,\\mathrm{mg}$ diazepam $\\equiv 25\\,\\mathrm{mg}$ chlordiazepoxide $\\equiv 2\\,\\mathrm{mg}$ lorazepam.\n2. First-order elimination for drug amount remaining at time $t$: if $D_0$ is the administered dose (in $\\mathrm{mg}$), the amount remaining is $D(t) = D_0 \\exp(-kt)$, where $k = \\ln(2)/t_{1/2}$ and $t_{1/2}$ is the elimination half-life.\n3. Elimination half-lives (assume single-compartment kinetics and complete bioavailability for the doses given below): diazepam $t_{1/2} = 36\\,\\mathrm{h}$, lorazepam $t_{1/2} = 12\\,\\mathrm{h}$, chlordiazepoxide $t_{1/2} = 10\\,\\mathrm{h}$.\n4. For severe withdrawal, a conservative, symptom-triggered protocol targets an initial cumulative diazepam-equivalent load of $S = 30\\,\\mathrm{mg}$ to achieve control of agitation and tremor without oversedation.\n5. In moderate hepatic impairment, reduce the calculated supplemental dose by a safety factor $s = 0.80$ to mitigate oversedation risk.\n6. To minimize oversedation risk in this patient with hepatic impairment, administer lorazepam rather than diazepam or chlordiazepoxide for the initial dose now, converting from the diazepam-equivalent supplemental requirement using the equivalence in item 1.\n\nPatient-specific data:\n- Prehospital and early Emergency Department benzodiazepine doses:\n  - Diazepam $10\\,\\mathrm{mg}$ intravenous at $t = -2\\,\\mathrm{h}$.\n  - Lorazepam $1\\,\\mathrm{mg}$ intravenous at $t = -1.5\\,\\mathrm{h}$.\n  - Chlordiazepoxide $25\\,\\mathrm{mg}$ oral at $t = -3\\,\\mathrm{h}$ (assume complete systemic availability by now).\n- Current time is $t = 0\\,\\mathrm{h}$.\n\nTasks:\n- Compute the residual diazepam-equivalent amount on board at $t=0\\,\\mathrm{h}$ from each prior dose using first-order elimination and the equipotent equivalence, and sum these to obtain $R$.\n- Compute the additional diazepam-equivalent amount needed as $S - R$ (if negative, set to $0$).\n- Apply the hepatic safety factor $s$ to this supplemental diazepam-equivalent requirement.\n- Convert the safety-adjusted diazepam-equivalent supplemental amount to a single lorazepam dose to administer now, using the equipotent equivalence above. For this calculation, do not exceed a single-dose cap of $4\\,\\mathrm{mg}$ lorazepam; if your computed dose exceeds this cap, use the cap instead.\n- Round your final lorazepam dose to three significant figures. Express your final answer in $\\mathrm{mg}$ of lorazepam.",
            "solution": "We proceed from the provided fundamental pharmacologic facts and equivalence relationships. The goal is to determine a single lorazepam dose now that safely supplements the residual benzodiazepine effect to reach the target diazepam-equivalent load $S = 30\\,\\mathrm{mg}$, then reduce by the safety factor $s = 0.80$ and convert to lorazepam using the equipotent equivalence.\n\nStep 1: Compute residual amounts for each administered benzodiazepine at $t=0\\,\\mathrm{h}$ using first-order elimination $D(t) = D_{0}\\,\\exp(-k t)$ with $k = \\ln(2)/t_{1/2}$.\n\n1. Diazepam:\n- Administered dose $D_{0,\\mathrm{dia}} = 10\\,\\mathrm{mg}$ at $t = -2\\,\\mathrm{h}$.\n- Half-life $t_{1/2,\\mathrm{dia}} = 36\\,\\mathrm{h}$, so $k_{\\mathrm{dia}} = \\ln(2)/36$.\n- Residual diazepam amount:\n$$D_{\\mathrm{dia}}(0) = 10\\,\\exp\\!\\left(-\\frac{\\ln(2)}{36}\\cdot 2\\right) = 10\\,\\exp\\!\\left(-\\frac{\\ln(2)}{18}\\right) = 10 \\cdot 2^{-1/18}.$$\nSince diazepam itself defines the diazepam-equivalent, its residual diazepam-equivalent contribution is simply\n$$R_{\\mathrm{dia}} = 10 \\cdot \\exp\\!\\left(-\\frac{\\ln(2)}{18}\\right).$$\n\n2. Lorazepam:\n- Administered dose $D_{0,\\mathrm{lor}} = 1\\,\\mathrm{mg}$ at $t = -1.5\\,\\mathrm{h}$.\n- Half-life $t_{1/2,\\mathrm{lor}} = 12\\,\\mathrm{h}$, so $k_{\\mathrm{lor}} = \\ln(2)/12$.\n- Residual lorazepam amount:\n$$D_{\\mathrm{lor}}(0) = 1\\,\\exp\\!\\left(-\\frac{\\ln(2)}{12}\\cdot 1.5\\right) = \\exp\\!\\left(-\\frac{\\ln(2)}{8}\\right) = 2^{-1/8}.$$\n- Convert residual lorazepam to diazepam-equivalents using the equipotent ratio $2\\,\\mathrm{mg}$ lorazepam $\\equiv 10\\,\\mathrm{mg}$ diazepam, i.e., $1\\,\\mathrm{mg}$ lorazepam $\\equiv 5\\,\\mathrm{mg}$ diazepam:\n$$R_{\\mathrm{lor}} = 5 \\cdot D_{\\mathrm{lor}}(0) = 5 \\cdot \\exp\\!\\left(-\\frac{\\ln(2)}{8}\\right) = 5 \\cdot 2^{-1/8}.$$\n\n3. Chlordiazepoxide:\n- Administered dose $D_{0,\\mathrm{clo}} = 25\\,\\mathrm{mg}$ at $t = -3\\,\\mathrm{h}$.\n- Half-life $t_{1/2,\\mathrm{clo}} = 10\\,\\mathrm{h}$, so $k_{\\mathrm{clo}} = \\ln(2)/10$.\n- Residual chlordiazepoxide amount:\n$$D_{\\mathrm{clo}}(0) = 25\\,\\exp\\!\\left(-\\frac{\\ln(2)}{10}\\cdot 3\\right) = 25\\,\\exp\\!\\left(-\\frac{3\\,\\ln(2)}{10}\\right) = 25 \\cdot 2^{-3/10}.$$\n- Convert residual chlordiazepoxide to diazepam-equivalents using the equipotent ratio $25\\,\\mathrm{mg}$ chlordiazepoxide $\\equiv 10\\,\\mathrm{mg}$ diazepam, i.e., multiply by $10/25 = 0.4$:\n$$R_{\\mathrm{clo}} = 0.4 \\cdot D_{\\mathrm{clo}}(0) = 0.4 \\cdot 25 \\cdot 2^{-3/10} = 10 \\cdot 2^{-3/10}.$$\n\nSum the residual diazepam-equivalents:\n$$R = R_{\\mathrm{dia}} + R_{\\mathrm{lor}} + R_{\\mathrm{clo}} = 10 \\cdot 2^{-1/18} + 5 \\cdot 2^{-1/8} + 10 \\cdot 2^{-3/10}.$$\n\nStep 2: Compute the supplemental diazepam-equivalent requirement:\n$$\\Delta = S - R.$$\nIf $\\Delta < 0$, set $\\Delta = 0$; otherwise use the positive value. With the provided values, we will find $\\Delta > 0$.\n\nStep 3: Apply the hepatic safety factor $s = 0.80$ to reduce the supplemental requirement:\n$$\\Delta_{s} = s \\cdot \\Delta.$$\n\nStep 4: Convert $\\Delta_{s}$ (diazepam-equivalents) to a lorazepam dose using the equipotent relationship $10\\,\\mathrm{mg}$ diazepam $\\equiv 2\\,\\mathrm{mg}$ lorazepam, i.e., multiply by the factor $2/10 = 0.2$:\n$$D_{\\mathrm{lor,init}} = 0.2 \\cdot \\Delta_{s}.$$\nIf $D_{\\mathrm{lor,init}} > 4\\,\\mathrm{mg}$, cap at $4\\,\\mathrm{mg}$; otherwise, use $D_{\\mathrm{lor,init}}$ as calculated.\n\nNow compute numerically.\n\nEvaluate each residual term using $\\ln(2) \\approx 0.6931471805599453$:\n- Diazepam residual factor:\n$$2^{-1/18} = \\exp\\!\\left(-\\frac{\\ln(2)}{18}\\right) \\approx \\exp(-0.0385081767) \\approx 0.962233,$$\nso\n$$R_{\\mathrm{dia}} \\approx 10 \\times 0.962233 = 9.62233.$$\n- Lorazepam residual factor:\n$$2^{-1/8} = \\exp\\!\\left(-\\frac{\\ln(2)}{8}\\right) \\approx \\exp(-0.0866433976) \\approx 0.917006,$$\nso\n$$R_{\\mathrm{lor}} \\approx 5 \\times 0.917006 = 4.58503.$$\n- Chlordiazepoxide residual factor:\n$$2^{-3/10} = \\exp\\!\\left(-\\frac{3\\,\\ln(2)}{10}\\right) \\approx \\exp(-0.2079441542) \\approx 0.812194,$$\nso\n$$R_{\\mathrm{clo}} \\approx 10 \\times 0.812194 = 8.12194.$$\n\nSum:\n$$R \\approx 9.62233 + 4.58503 + 8.12194 = 22.32930.$$\n\nCompute supplemental requirement:\n$$\\Delta = S - R = 30 - 22.32930 = 7.67070.$$\n\nApply safety factor:\n$$\\Delta_{s} = 0.80 \\times 7.67070 = 6.13656.$$\n\nConvert to lorazepam dose:\n$$D_{\\mathrm{lor,init}} = 0.2 \\times 6.13656 = 1.22731.$$\n\nCheck cap of $4\\,\\mathrm{mg}$: $1.22731 < 4$, so no capping is needed.\n\nRound to three significant figures:\n$$D_{\\mathrm{lor,init}} \\approx 1.23.$$\n\nThus, the safe initial lorazepam dose to give now is $1.23\\,\\mathrm{mg}$.",
            "answer": "$$\\boxed{1.23}$$"
        },
        {
            "introduction": "This final practice elevates the task from single-point calculations to the design of a dynamic, protocol-based treatment strategy, reflecting the move towards algorithmic and data-driven clinical medicine. You will develop a quantitative, symptom-triggered dosing algorithm that balances aggressive symptom control with robust safety constraints, including dose caps and a cumulative sedation model. By translating clinical goals and safety limits into a deterministic set of rules, this exercise provides hands-on experience in building a sophisticated decision-support tool for managing alcohol withdrawal systematically. ",
            "id": "4792635",
            "problem": "You are asked to design and implement a deterministic titration algorithm for symptom-triggered benzodiazepine dosing in alcohol withdrawal that balances two competing goals: minimizing oversedation and preventing breakthrough withdrawal symptoms. The algorithm must operate on purely mathematical quantities and be derived from well-accepted fundamentals: first-order elimination kinetics, linear pharmacodynamic slopes near a working point, symptom-targeted control toward a band of Clinical Institute Withdrawal Assessment for Alcohol scale, revised (CIWA-Ar) scores, and hard dose caps to reflect safety constraints. The algorithm should produce a recommended single dose in milligrams for each test case, based on the current CIWA-Ar score and the dosing history. Your program must compute and print these recommendations for a small test suite.\n\nFundamental base and assumptions:\n- The current symptom severity is represented by a CIWA-Ar score denoted by $c_t$ (unitless).\n- The target symptom band is defined by a lower bound $c_L$ and an upper bound $c_U$, with a target center $c^\\star$ in the middle. Use $c_L=8$, $c_U=12$, and $c^\\star=10$.\n- The symptom response to a small dose increment is approximated linearly near the working point; each milligram reduces the next-assessment CIWA-Ar by a constant slope $k_c$ (unit: CIWA-Ar points per milligram). Use $k_c=2.5$.\n- Sedation risk is modeled via an effect-compartment index $e_t$ that increases linearly with administered milligrams and decays by first-order elimination. Each milligram increases the index by $k_e$ (unitless per milligram), and the index decays with half-life $t_{1/2}$ according to standard first-order elimination. Use $k_e=1$ and $t_{1/2}=14$ hours. Specifically, a dose $d_i$ given $h_i$ hours ago contributes $k_e d_i 2^{-h_i/t_{1/2}}$ to $e_t$.\n- A hard oversedation ceiling is imposed: $e_t$ must not exceed $e_{\\max}$. Use $e_{\\max}=8$.\n- Dose caps are enforced as hard constraints: a single-dose maximum $D_{\\text{single}}$, a rolling $1$-hour cumulative maximum $D_{1\\text{h}}$, and a rolling $6$-hour cumulative maximum $D_{6\\text{h}}$. Use $D_{\\text{single}}=4$ milligrams, $D_{1\\text{h}}=8$ milligrams, and $D_{6\\text{h}}=24$ milligrams. For the rolling windows, include doses administered at times $h_i$ satisfying $h_i \\le 1$ for the $1$-hour window and $h_i \\le 6$ for the $6$-hour window.\n- To prevent breakthrough symptoms at high severity, impose a rescue policy: if $c_t \\ge c_{\\text{break}}$, the recommended dose should not be less than a minimal rescue dose $d_{\\text{rescue}}$ unless restricted by a safety constraint. Use $c_{\\text{break}}=20$ and $d_{\\text{rescue}}=2$ milligrams.\n\nDerivation target and required algorithmic form:\n- Use the linear pharmacodynamic symptom model to compute an ideal unconstrained dose that centers the expected next CIWA-Ar score near $c^\\star$, then apply safety constraints in a principled order.\n- Let $d$ denote the next single dose in milligrams. The predicted next-assessment symptom level is modeled as $c_{t+} = c_t - k_c d$. Choose $d$ to minimize deviation from the target center while avoiding oversedation by enforcing that $e_t + k_e d \\le e_{\\max}$ and that hard cumulative dose caps are not exceeded.\n- Compute the following intermediate quantities:\n  1. The effect-compartment index $e_t = \\sum_i k_e d_i 2^{-h_i/t_{1/2}}$, where $d_i$ are prior doses and $h_i$ are hours since each dose.\n  2. The remaining allowances from caps: $A_{\\text{single}} = D_{\\text{single}}$, $A_{1\\text{h}} = \\max\\{0, D_{1\\text{h}} - \\sum_{h_i \\le 1} d_i\\}$, and $A_{6\\text{h}} = \\max\\{0, D_{6\\text{h}} - \\sum_{h_i \\le 6} d_i\\}$. The aggregate cap allowance is $A_{\\text{cap}} = \\min\\{A_{\\text{single}}, A_{1\\text{h}}, A_{6\\text{h}}\\}$.\n  3. The ideal unconstrained dose toward the target center: $d_{\\text{ideal}} = \\max\\{0, (c_t - c^\\star)/k_c\\}$.\n  4. The sedation-limited allowance: $A_{\\text{sed}} = \\max\\{0, (e_{\\max} - e_t)/k_e\\}$.\n- The primary recommended dose before rescue logic is $d_0 = \\min\\{d_{\\text{ideal}}, A_{\\text{sed}}, A_{\\text{cap}}\\}$.\n- The rescue rule is then applied: if $c_t \\ge c_{\\text{break}}$ and $d_0  d_{\\text{rescue}}$, set the final dose to $d = \\min\\{d_{\\text{rescue}}, A_{\\text{sed}}, A_{\\text{cap}}\\}$; otherwise $d = d_0$.\n- The algorithm must output $d$ in milligrams, rounded to one decimal place.\n\nInput representation and test suite:\n- Each test case is a pair $(c_t, \\mathcal{H})$ where $c_t$ is the current CIWA-Ar score (unitless), and $\\mathcal{H}$ is a list of prior doses with their times as $(d_i, h_i)$, where $d_i$ is in milligrams and $h_i$ is in hours before the current time. The present time is $h=0$ by convention. All $h_i$ are nonnegative real numbers.\n- Use the following test suite of six cases to exercise the algorithm across different regimes. For each case, compute the recommended dose $d$ in milligrams (rounded to one decimal place):\n  1. Case A (happy path, moderate symptoms, no prior doses): $c_t=18$, $\\mathcal{H}=[]$.\n  2. Case B (already on target, no dosing): $c_t=10$, $\\mathcal{H}=[]$.\n  3. Case C (severe symptoms but near oversedation from recent dosing): $c_t=24$, $\\mathcal{H}=[(4.0,1.0),(4.0,2.0)]$.\n  4. Case D (hourly cap binding): $c_t=22$, $\\mathcal{H}=[(7.5,0.5)]$.\n  5. Case E (six-hour cap strongly binding and high residual effect): $c_t=21$, $\\mathcal{H}=[(10.0,5.0),(8.0,3.0),(5.5,1.0)]$.\n  6. Case F (boundary of lower target): $c_t=8$, $\\mathcal{H}=[]$.\n\nAngle units are not applicable. All dose outputs must be expressed in milligrams and rounded to one decimal place. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\") in the same order as the listed test cases.",
            "solution": "We construct a principled algorithm by integrating basic pharmacokinetics and control objectives. The derivation starts from the following fundamentals.\n\nFirst-order elimination law for the effect compartment: If $x(t)$ denotes an effect-compartment proxy, then under first-order elimination and instantaneous input, the contribution of a dose $d_i$ administered at time $t_i$ to the current effect $x(t)$ at time $t$ is proportional to $d_i \\,\\exp(-k (t - t_i))$, where $k$ is the elimination rate constant. The half-life $t_{1/2}$ satisfies $t_{1/2} = (\\ln 2)/k$, hence $\\exp(-k \\Delta t) = 2^{-\\Delta t / t_{1/2}}$ for lag $\\Delta t$. We adopt an effect index $e_t$ that sums individual contributions scaled by a pharmacodynamic slope $k_e$:\n$$\ne_t = \\sum_i k_e\\, d_i\\, 2^{-h_i/t_{1/2}},\n$$\nwhere $h_i$ is the time in hours since dose $d_i$.\n\nLinearized pharmacodynamics near a working point: For small changes near a working point, the assumed next-assessment CIWA-Ar response to dose $d$ may be approximated as\n$$\nc_{t+} \\approx c_t - k_c\\, d,\n$$\nwhere $k_c$ is a positive slope in units of CIWA-Ar points per milligram.\n\nControl objective: We steer $c_{t+}$ toward a target center $c^\\star$ within a tolerable band $[c_L, c_U]$. A simple convex surrogate loss is the squared deviation $(c_{t+} - c^\\star)^2$, minimized subject to hard safety constraints. Because the surrogate and constraints are separable in the single decision variable $d$, the unconstrained minimizer is given by differentiating the quadratic surrogate with respect to $d$, yielding an ideal target dose\n$$\nd_{\\text{ideal}} = \\max\\{0, (c_t - c^\\star)/k_c\\}.\n$$\nThe nonnegativity constraint arises from the irreversibility of dosing.\n\nSafety constraints: We must enforce\n1. Oversedation ceiling $e_t + k_e\\, d \\le e_{\\max}$, which rearranges to a sedation-limited allowance\n$$\nA_{\\text{sed}} = \\max\\{0, (e_{\\max} - e_t)/k_e\\}.\n$$\n2. Cumulative dose caps: For a single dose, $d \\le D_{\\text{single}}$; in the last $1$ hour, total dose (including $d$) must satisfy\n$$\n\\sum_{h_i \\le 1} d_i + d \\le D_{1\\text{h}},\n$$\nand in the last $6$ hours,\n$$\n\\sum_{h_i \\le 6} d_i + d \\le D_{6\\text{h}}.\n$$\nThese imply remaining allowances\n$$\nA_{1\\text{h}} = \\max\\{0, D_{1\\text{h}} - \\sum_{h_i \\le 1} d_i\\}, \\quad\nA_{6\\text{h}} = \\max\\{0, D_{6\\text{h}} - \\sum_{h_i \\le 6} d_i\\},\n$$\nand $A_{\\text{single}} = D_{\\text{single}}$. The cap-limited allowance is\n$$\nA_{\\text{cap}} = \\min\\{A_{\\text{single}}, A_{1\\text{h}}, A_{6\\text{h}}\\}.\n$$\n\nPrimary recommendation: The constrained minimizer under independent upper bounds collapses to clamping the unconstrained minimizer to the most restrictive allowance,\n$$\nd_0 = \\min\\{d_{\\text{ideal}}, A_{\\text{sed}}, A_{\\text{cap}}\\}.\n$$\nThis follows from the monotonicity of $c_{t+}$ in $d$ and the convexity of the surrogate objective.\n\nRescue policy: To reduce risk of breakthrough symptoms at high severity, we require a minimal intervention if severity exceeds a break point, provided that safety constraints are not violated. With $c_{\\text{break}}$ and $d_{\\text{rescue}}$ given, define\n$$\nd =\n\\begin{cases}\n\\min\\{d_{\\text{rescue}}, A_{\\text{sed}}, A_{\\text{cap}}\\},  \\text{if } c_t \\ge c_{\\text{break}} \\text{ and } d_0  d_{\\text{rescue}}, \\\\\nd_0,  \\text{otherwise}.\n\\end{cases}\n$$\nThis preserves the oversedation ceiling and dose caps.\n\nParameterization: Use $c_L=8$, $c_U=12$, and $c^\\star=10$; $k_c=2.5$; $k_e=1$; $t_{1/2}=14$ hours; $e_{\\max}=8$; $D_{\\text{single}}=4$ milligrams; $D_{1\\text{h}}=8$ milligrams; $D_{6\\text{h}}=24$ milligrams; $c_{\\text{break}}=20$; and $d_{\\text{rescue}}=2$ milligrams. For computing $e_t$, use the exact binary-decay form $2^{-h_i/t_{1/2}}$.\n\nAlgorithmic procedure for one test case $(c_t, \\mathcal{H})$:\n1. Compute $e_t \\leftarrow \\sum_{(d_i,h_i)\\in \\mathcal{H}} k_e\\, d_i\\, 2^{-h_i/t_{1/2}}$.\n2. Compute rolling sums $S_{1\\text{h}} \\leftarrow \\sum_{h_i \\le 1} d_i$ and $S_{6\\text{h}} \\leftarrow \\sum_{h_i \\le 6} d_i$.\n3. Compute allowances $A_{1\\text{h}} \\leftarrow \\max\\{0, D_{1\\text{h}} - S_{1\\text{h}}\\}$, $A_{6\\text{h}} \\leftarrow \\max\\{0, D_{6\\text{h}} - S_{6\\text{h}}\\}$, $A_{\\text{single}} \\leftarrow D_{\\text{single}}$, and $A_{\\text{cap}} \\leftarrow \\min\\{A_{\\text{single}}, A_{1\\text{h}}, A_{6\\text{h}}\\}$.\n4. Compute $d_{\\text{ideal}} \\leftarrow \\max\\{0, (c_t - c^\\star)/k_c\\}$ and $A_{\\text{sed}} \\leftarrow \\max\\{0, (e_{\\max} - e_t)/k_e\\}$.\n5. Set $d_0 \\leftarrow \\min\\{d_{\\text{ideal}}, A_{\\text{sed}}, A_{\\text{cap}}\\}$.\n6. If $c_t \\ge c_{\\text{break}}$ and $d_0  d_{\\text{rescue}}$, set $d \\leftarrow \\min\\{d_{\\text{rescue}}, A_{\\text{sed}}, A_{\\text{cap}}\\}$; else set $d \\leftarrow d_0$.\n7. Round $d$ to one decimal place.\n\nThis algorithm is directly implementable. Applying it to the specified test suite yields the final outputs. The final program must produce a single line containing a Python-like list of the six dose recommendations, in milligrams, rounded to one decimal place, in the order of the cases A through F.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef decay_factor(hours: float, half_life: float) - float:\n    \"\"\"\n    First-order elimination with half-life: fraction remaining after 'hours'.\n    Uses the identity exp(-k t) = 2^{-t / t_half}.\n    \"\"\"\n    return 2.0 ** (-hours / half_life)\n\ndef compute_effect_index(history, k_e: float, half_life: float) - float:\n    \"\"\"\n    Sum of effect-compartment contributions from history.\n    history: list of (dose_mg, hours_ago)\n    \"\"\"\n    e = 0.0\n    for d_i, h_i in history:\n        e += k_e * d_i * decay_factor(h_i, half_life)\n    return e\n\ndef compute_window_sums(history, window_hours: float) - float:\n    \"\"\"\n    Sum of doses within a rolling window, including doses given exactly at the boundary (=).\n    \"\"\"\n    total = 0.0\n    for d_i, h_i in history:\n        if h_i = window_hours:\n            total += d_i\n    return total\n\ndef recommend_dose(ciwa: float, history):\n    # Parameters (units noted in comments)\n    c_L = 8.0        # CIWA lower bound (unitless)\n    c_U = 12.0       # CIWA upper bound (unitless)\n    c_star = 10.0    # CIWA target center (unitless)\n    k_c = 2.5        # CIWA points reduced per mg\n    k_e = 1.0        # effect index increment per mg (unitless)\n    t_half = 14.0    # hours\n    e_max = 8.0      # effect index ceiling (unitless)\n    D_single = 4.0   # mg\n    D_1h = 8.0       # mg per 1 hour rolling window\n    D_6h = 24.0      # mg per 6 hour rolling window\n    c_break = 20.0   # CIWA threshold for rescue\n    d_rescue = 2.0   # mg minimal rescue dose\n\n    # Compute effect index\n    e_t = compute_effect_index(history, k_e, t_half)\n\n    # Compute cumulative doses in windows\n    S_1h = compute_window_sums(history, 1.0)\n    S_6h = compute_window_sums(history, 6.0)\n\n    # Remaining allowances from caps\n    A_single = D_single\n    A_1h = max(0.0, D_1h - S_1h)\n    A_6h = max(0.0, D_6h - S_6h)\n    A_cap = min(A_single, A_1h, A_6h)\n\n    # Ideal dose toward target center (nonnegative)\n    d_ideal = max(0.0, (ciwa - c_star) / k_c)\n\n    # Sedation-limited allowance\n    A_sed = max(0.0, (e_max - e_t) / k_e)\n\n    # Primary constrained recommendation\n    d0 = min(d_ideal, A_sed, A_cap)\n\n    # Rescue policy for high severity\n    if ciwa = c_break and d0  d_rescue:\n        d = min(d_rescue, A_sed, A_cap)\n    else:\n        d = d0\n\n    # Round to one decimal place\n    d_rounded = float(f\"{d:.1f}\")\n    return d_rounded\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (current_CIWA, history=[(dose_mg, hours_ago), ...])\n    test_cases = [\n        (18.0, []),                                      # Case A\n        (10.0, []),                                      # Case B\n        (24.0, [(4.0, 1.0), (4.0, 2.0)]),                # Case C\n        (22.0, [(7.5, 0.5)]),                            # Case D\n        (21.0, [(10.0, 5.0), (8.0, 3.0), (5.5, 1.0)]),   # Case E\n        (8.0, []),                                       # Case F\n    ]\n\n    results = []\n    for ciwa, history in test_cases:\n        result = recommend_dose(ciwa, history)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}