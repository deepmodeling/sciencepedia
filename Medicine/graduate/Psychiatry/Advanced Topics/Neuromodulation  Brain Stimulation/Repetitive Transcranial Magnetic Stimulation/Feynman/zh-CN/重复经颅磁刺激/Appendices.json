{
    "hands_on_practices": [
        {
            "introduction": "实施rTMS的关键第一步是准确定位目标脑区。本练习聚焦于一种基础且广泛使用的方法——国际10-20系统，该系统利用简单的头皮测量来近似定位如背外侧前额叶皮层（DLPFC）等皮层区域。掌握这种计算方法对于理解非神经导航rTMS至关重要，并为理解更先进的靶点定位技术提供了坚实的基础。",
            "id": "4754531",
            "problem": "在精神病学中的重复经颅磁刺激 (rTMS) 靶向中，左背外侧前额叶皮层 (DLPFC) 通常由国际10-20脑电图 (EEG) 系统中的 $F3$ 位置来近似。国际10-20脑电图系统的定义是，沿着解剖学标志点之间的弧线放置电极，使得相邻间距在两端为 $10\\%$，在相关弧线的内部点之间为 $20\\%$。考虑一名受试者，已沿其皮肤测量了两个头皮弧长：\n\n- 鼻根点到枕外粗隆的中线弧长为 $D_{\\mathrm{NI}} = 36.8\\ \\mathrm{cm}$。\n- 经过 $Fz$ 的额排（$F$-排）上，从左耳前点到右耳前点的弧长为 $A_{F} = 29.4\\ \\mathrm{cm}$，该弧线沿前额和上额部头皮向前追踪测量。\n\n在 $Cz$ 处采用一个局部切平面坐标系，其坐标轴方向如下：$x$-轴沿矢状中线指向鼻根点方向（向前），$y$-轴沿额排（$F$-排）指向左耳前标志点方向（向左侧）。仅使用国际10-20脑电图系统的核心定义和测量的弧长，从第一性原理推导从 $Cz$到 $F3$ 位置的向前和向左侧的偏移量，记为 $(\\Delta x_{\\mathrm{ant}}, \\Delta y_{\\mathrm{lat}})$，其中 $\\Delta x_{\\mathrm{ant}}$ 是沿矢状中线从 $Cz$ 到 $Fz$ 测量的距离，$\\Delta y_{\\mathrm{lat}}$ 是沿 $F$-排从 $Fz$ 到 $F3$ 测量的距离。\n\n以厘米为单位表示最终的有序数对 $(\\Delta x_{\\mathrm{ant}}, \\Delta y_{\\mathrm{lat}})$，并将数值四舍五入到四位有效数字。",
            "solution": "用户希望我基于国际10-20脑电图系统解决一个关于rTMS靶向的问题。我必须首先验证问题陈述。\n\n### 第1步：提取已知条件\n- **系统**：国际10–20脑电图 (EEG) 系统。\n- **系统规则**：在相关弧线上，两端连续间距为 $10\\%$，内部点之间为 $20\\%$。\n- **标志点近似**：左背外侧前额叶皮层 (DLPFC) 由脑电图位置 $F3$ 近似。\n- **测量的弧长**：\n    - 鼻根点到枕外粗隆的中线弧长：$D_{\\mathrm{NI}} = 36.8\\ \\mathrm{cm}$。\n    - 沿额排（$F$-排）的左耳前点到右耳前点的弧长：$A_{F} = 29.4\\ \\mathrm{cm}$。\n- **坐标系（概念性）**：在 $Cz$ 处的局部切平面坐标系。$x$-轴沿矢状中线向前， $y$-轴沿额排向左侧。\n- **待求量**：弧长的有序数对 $(\\Delta x_{\\mathrm{ant}}, \\Delta y_{\\mathrm{lat}})$，其中：\n    - $\\Delta x_{\\mathrm{ant}}$ 是沿矢状中线从 $Cz$ 到 $Fz$ 的弧长。\n    - $\\Delta y_{\\mathrm{lat}}$ 是沿 $F$-排从 $Fz$ 到 $F3$ 的弧长。\n- **输出要求**：以厘米为单位表示 $(\\Delta x_{\\mathrm{ant}}, \\Delta y_{\\mathrm{lat}})$，数值四舍五入到四位有效数字。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，因为它基于国际10–20系统，这是神经生理学和临床神经病学中用于脑电图电极放置以及延伸用于rTMS靶向的标准。解剖标志点（鼻根点、枕外粗隆、耳前点）和电极位置（$Cz$, $Fz$, $F3$）都是标准的。给定的测量值对于成年人头部是符合实际的。问题陈述客观、精确且自成一体，提供了推导唯一解所需的所有信息。问题表述良好，没有违反任何科学或数学原理，不存在歧义或矛盾。\n\n### 第3步：结论与行动\n问题有效。我现在开始解答。\n\n该问题要求根据国际10-20脑电图系统的规则计算头皮上的两个特定弧长。需要确定的量是 $\\Delta x_{\\mathrm{ant}}$（沿中线从 $Cz$到 $Fz$ 的向前距离）和 $\\Delta y_{\\mathrm{lat}}$（沿额弧从 $Fz$ 到 $F3$ 的向左侧距离）。\n\n首先，我们计算向前偏移量 $\\Delta x_{\\mathrm{ant}}$，它位于连接鼻根点 ($Nz$) 和枕外粗隆 ($Iz$) 的矢状中线上。该中线的总弧长为 $D_{\\mathrm{NI}} = 36.8\\ \\mathrm{cm}$。10-20系统通过在特定的分数距离处放置电极来划分此弧。从前部（鼻根点）到后部（枕外粗隆）的标志点和电极序列是：$Nz$, $Fpz$, $Fz$, $Cz$, $Pz$, $Oz$, $Iz$。根据定义，$Cz$ 点是顶点，位于鼻根点到枕外粗隆距离的 $50\\%$ 标记处。\n\n沿此中线相邻点之间的分数距离由该系统的命名约定定义：\n- 从鼻根点 ($Nz$) 到 $Fpz$ 的距离是 $D_{\\mathrm{NI}}$ 的 $10\\%$。\n- 从 $Fpz$ 到 $Fz$ 的距离是 $D_{\\mathrm{NI}}$ 的 $20\\%$。\n- 从 $Fz$ 到 $Cz$ 的距离是 $D_{\\mathrm{NI}}$ 的 $20\\%$。\n- 从 $Cz$ 到 $Pz$ 的距离是 $D_{\\mathrm{NI}}$ 的 $20\\%$。\n- 从 $Pz$ 到 $Oz$ 的距离是 $D_{\\mathrm{NI}}$ 的 $20\\%$。\n- 从 $Oz$ 到枕外粗隆 ($Iz$) 的距离是 $D_{\\mathrm{NI}}$ 的 $10\\%$。\n这些百分比的总和确认了总弧长：$10\\% + 20\\% + 20\\% + 20\\% + 20\\% + 10\\% = 100\\%$。\n\n问题将 $\\Delta x_{\\mathrm{ant}}$ 定义为沿矢状中线从 $Cz$ 到 $Fz$ 方向测量的弧长。根据10-20系统的划分，该距离对应于 $Cz$ 和 $Fz$ 之间的段。\n因此，$\\Delta x_{\\mathrm{ant}}$ 是鼻根点到枕外粗隆总距离 $D_{\\mathrm{NI}}$ 的 $20\\%$。\n$$ \\Delta x_{\\mathrm{ant}} = 0.20 \\times D_{\\mathrm{NI}} $$\n代入给定值 $D_{\\mathrm{NI}} = 36.8\\ \\mathrm{cm}$:\n$$ \\Delta x_{\\mathrm{ant}} = 0.20 \\times 36.8\\ \\mathrm{cm} = 7.36\\ \\mathrm{cm} $$\n\n接下来，我们计算向左侧的偏移量 $\\Delta y_{\\mathrm{lat}}$，它位于额弧（'$F$-排'）上。此弧连接左耳前点 ($A1$) 和右耳前点 ($A2$)，并穿过中线点 $Fz$。此弧的总长度为 $A_{F} = 29.4\\ \\mathrm{cm}$。\n此弧上从左到右的电极序列是：$A1$, $F7$, $F3$, $Fz$, $F4$, $F8$, $A2$。$Fz$ 点位于矢状中平面上，是 $F3$ 和 $F4$ 之间弧线的中点。\n\n沿此横向弧的分数距离也由10-20系统定义：\n- 从左耳前点 ($A1$) 到 $F7$ 的距离是 $A_{F}$ 的 $10\\%$。\n- 从 $F7$ 到 $F3$ 的距离是 $A_{F}$ 的 $20\\%$。\n- 从 $F3$ 到 $Fz$ 的距离是 $A_{F}$ 的 $20\\%$。\n- 从 $Fz$ 到 $F4$ 的距离是 $A_{F}$ 的 $20\\%$。\n- 从 $F4$ 到 $F8$ 的距离是 $A_{F}$ 的 $20\\%$。\n- 从 $F8$ 到右耳前点 ($A2$) 的距离是 $A_{F}$ 的 $10\\%$。\n这些百分比的总和为 $10\\% + 20\\% + 20\\% + 20\\% + 20\\% + 10\\% = 100\\%$。\n\n问题将 $\\Delta y_{\\mathrm{lat}}$ 定义为沿 $F$-排从 $Fz$ 到 $F3$ 方向测量的弧长。这对应于 $Fz$ 和 $F3$ 之间的段。\n因此，$\\Delta y_{\\mathrm{lat}}$ 是总弧长 $A_{F}$ 的 $20\\%$。\n$$ \\Delta y_{\\mathrm{lat}} = 0.20 \\times A_{F} $$\n代入给定值 $A_{F} = 29.4\\ \\mathrm{cm}$:\n$$ \\Delta y_{\\mathrm{lat}} = 0.20 \\times 29.4\\ \\mathrm{cm} = 5.88\\ \\mathrm{cm} $$\n\n问题要求最终的有序数对 $(\\Delta x_{\\mathrm{ant}}, \\Delta y_{\\mathrm{lat}})$，其数值四舍五入到四位有效数字。\n$\\Delta x_{\\mathrm{ant}}$ 的计算值为 $7.36\\ \\mathrm{cm}$。保留四位有效数字，即为 $7.360\\ \\mathrm{cm}$。\n$\\Delta y_{\\mathrm{lat}}$ 的计算值为 $5.88\\ \\mathrm{cm}$。保留四位有效数字，即为 $5.880\\ \\mathrm{cm}$。\n因此，偏移量的有序数对为 $(7.360, 5.880)$，单位为厘米。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 7.360  5.880 \\end{pmatrix} } $$"
        },
        {
            "introduction": "靶点定位后，必须通过方案参数精确定义rTMS的治疗“剂量”。本实践将深入探讨一个标准rTMS治疗方案的计算细节，将频率、刺激串持续时间、刺激串间期等概念转化为总脉冲数和总治疗时长。这项计算对于临床工作流程、资源规划以及确保治疗实施的一致性至关重要。",
            "id": "4754572",
            "problem": "一名重度抑郁症 (MDD) 患者接受处方，对其左背外侧前额叶皮层进行高频重复经颅磁刺激 (rTMS)。该方案采用的刺激频率为 $10\\,\\mathrm{Hz}$，以刺激序列的形式施加，每个序列持续 $4\\,\\mathrm{s}$，序列间歇为 $26\\,\\mathrm{s}$，总共 $75$ 个序列。假设序列间歇仅发生在连续的序列之间，最后一个序列之后没有间歇，且治疗时长定义为所有序列时间的总和加上所有序列间歇时间的总和，不包括第一个序列之前的任何准备或休息时间，也不包括最后一个序列之后的任何时间。根据频率（单位：赫兹）定义为每秒脉冲数，以及施加的总脉冲数等于所有序列的脉冲数之和，计算总治疗时长和施加的总脉冲数。\n\n将治疗时长以分钟表示，并四舍五入至四位有效数字。将总脉冲数表示为无量纲的计数值。以行向量的形式提供最终答案，其中第一个元素是治疗时长（单位：分钟），第二个元素是施加的总脉冲数。",
            "solution": "对用户提供的问题进行有效性评估。\n\n### 第1步：提取已知条件\n- 刺激频率：$f = 10\\,\\mathrm{Hz}$\n- 序列持续时间：$t_{train} = 4\\,\\mathrm{s}$\n- 序列间歇：$t_{inter} = 26\\,\\mathrm{s}$\n- 序列总数：$N_{trains} = 75$\n- 条件：序列间歇仅发生在连续序列之间，最后一个序列之后没有间歇。\n- 治疗时长定义：所有序列时间的总和加上所有序列间歇时间的总和。\n- 要求输出：\n  1. 总治疗时长，单位为分钟，四舍五入至四位有效数字。\n  2. 施加的总脉冲数，为无量纲计数值。\n- 最终答案格式：一个包含治疗时长和总脉冲数的行向量。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，因为所提供的重复经颅磁刺激 (rTMS) 方案参数是治疗重度抑郁症的临床实践中标准且广泛使用的。术语精确，所要求的计算基于频率和时间间隔的基本定义。该问题提法明确，提供了所有必要信息且无矛盾。它是客观的，不含任何非科学性论断。\n\n### 第3步：结论与行动\n问题被判定为有效。将推导解答。\n\n解答过程分为两部分：首先，计算施加的总脉冲数；其次，计算总治疗时长。\n\n**第1部分：计算施加的总脉冲数**\n\n刺激频率 $f$ 为 $10\\,\\mathrm{Hz}$，相当于每秒 $10$ 个脉冲。每个刺激序列的持续时间为 $t_{train} = 4\\,\\mathrm{s}$。单个序列中施加的脉冲数 $P_{train}$ 是频率与序列持续时间的乘积。\n$$P_{train} = f \\times t_{train}$$\n代入给定值：\n$$P_{train} = 10\\,\\mathrm{s^{-1}} \\times 4\\,\\mathrm{s} = 40\\,\\text{pulses}$$\n施加的总脉冲数 $P_{total}$ 是每个序列的脉冲数乘以序列总数 $N_{trains}$。\n$$P_{total} = P_{train} \\times N_{trains}$$\n代入数值：\n$$P_{total} = 40 \\times 75 = 3000$$\n施加的总脉冲数为 $3000$。\n\n**第2部分：计算总治疗时长**\n\n总治疗时长 $T_{session}$ 定义为施加刺激序列所花费的总时间与序列间歇总时间之和。\n\n首先，我们计算刺激序列的总持续时间 $T_{trains\\_total}$。这是序列总数与单个序列持续时间的乘积。\n$$T_{trains\\_total} = N_{trains} \\times t_{train}$$\n代入数值：\n$$T_{trains\\_total} = 75 \\times 4\\,\\mathrm{s} = 300\\,\\mathrm{s}$$\n接下来，我们计算序列间歇的总持续时间。问题指明序列间歇仅发生在连续的序列之间。对于 $N_{trains}$ 个序列，共有 $N_{trains} - 1$ 个间歇将它们分开。\n$$N_{inter} = N_{trains} - 1 = 75 - 1 = 74$$\n这些间歇的总持续时间 $T_{inter\\_total}$ 是间歇次数与单个间歇持续时间 $t_{inter}$ 的乘积。\n$$T_{inter\\_total} = N_{inter} \\times t_{inter} = (N_{trains} - 1) \\times t_{inter}$$\n代入数值：\n$$T_{inter\\_total} = 74 \\times 26\\,\\mathrm{s} = 1924\\,\\mathrm{s}$$\n以秒为单位的总治疗时长 $T_{session\\_s}$ 是序列总时间与间歇总时间之和。\n$$T_{session\\_s} = T_{trains\\_total} + T_{inter\\_total}$$\n$$T_{session\\_s} = 300\\,\\mathrm{s} + 1924\\,\\mathrm{s} = 2224\\,\\mathrm{s}$$\n问题要求将治疗时长以分钟表示。一分钟有 $60$ 秒。\n$$T_{session\\_min} = \\frac{T_{session\\_s}}{60}$$\n$$T_{session\\_min} = \\frac{2224}{60}\\,\\mathrm{min} = 37.0666... \\,\\mathrm{min}$$\n结果必须四舍五入至四位有效数字。第五位有效数字是 $6$，因此我们将第四位数字进位。\n$$T_{session\\_min} \\approx 37.07\\,\\mathrm{min}$$\n两个要求的值是 $37.07\\,\\mathrm{min}$ 的治疗时长和总共 $3000$ 个脉冲。按要求将这些值以行向量的形式呈现。",
            "answer": "$$\\boxed{\\begin{pmatrix} 37.07  3000 \\end{pmatrix}}$$"
        },
        {
            "introduction": "超越解剖学上的经验法则，现代rTMS利用功能性神经影像技术，根据个体的大脑回路实现个性化治疗。这项高级实践将引导您完成一个计算流程，以识别与抑郁症关键相关脑区（如膝下前扣带皮层）存在功能连接的精确DLPFC靶点。通过从fMRI数据中计算出最佳线圈放置参数，您将把神经影像分析与神经导航rTMS的实际应用联系起来。",
            "id": "4754561",
            "problem": "给定一个个体预处理后的静息态功能性磁共振成像 (rs-fMRI) 数据。临床目标是在背外侧前额叶皮层 (DLPFC) 中选择一个与膝下前扣带皮层 (sgACC) 最大程度反相关的刺激靶点，然后为重复经颅磁刺激 (rTMS) 定义一个与该靶点对齐的可重复线圈放置方案。位置使用蒙特利尔神经学研究所 (MNI) 坐标（单位为毫米），角度使用度。所有坐标值和几何量必须以毫米表示，所有角度必须以度表示。所有报告的数值输出必须四舍五入到三位小数。\n\n使用的基本原理和定义：\n- 静息态功能性磁共振成像 (rs-fMRI) 会为每个大脑位置生成一个时间序列。对于一个种子时间序列 $\\mathbf{s} = (s_1, s_2, \\dots, s_n)$ 和一个候选时间序列 $\\mathbf{x} = (x_1, x_2, \\dots, x_n)$，皮尔逊相关系数定义为\n$$\nr(\\mathbf{s}, \\mathbf{x}) = \\frac{\\sum_{i=1}^n (s_i - \\bar{s})(x_i - \\bar{x})}{\\sqrt{\\sum_{i=1}^n (s_i - \\bar{s})^2}\\sqrt{\\sum_{i=1}^n (x_i - \\bar{x})^2}},\n$$\n其中 $\\bar{s}$ 和 $\\bar{x}$ 是样本均值。如果任一时间序列的方差为零（分母等于零），则按惯例设置 $r(\\mathbf{s}, \\mathbf{x}) = 0$。\n- 反相关定义为最负的皮尔逊相关系数；即，选择具有最小 $r$ 值的候选者。\n- 头部几何形状被近似为一个以原点为中心、半径为 $R$ 毫米的球体。对于一个满足 $\\|\\mathbf{p}_t\\|  R$ 的靶点坐标 $\\mathbf{p}_t = (x_t,y_t,z_t)$，头皮入口点被建模为从原点穿过 $\\mathbf{p}_t$ 的射线与头皮球体的交点：\n$$\n\\mathbf{e} = \\frac{R}{\\|\\mathbf{p}_t\\|}\\mathbf{p}_t,\n$$\n且局部向外法线为 $\\mathbf{n} = \\frac{\\mathbf{e}}{R}$。\n- 为了定义一个可重复的切向线圈方向，将解剖学上的前方方向 $\\mathbf{a} = (0,1,0)$ 投影到点 $\\mathbf{e}$ 处的切平面上：\n$$\n\\mathbf{t} = \\mathbf{a} - (\\mathbf{a}\\cdot\\mathbf{n})\\mathbf{n}.\n$$\n如果 $\\|\\mathbf{t}\\|$ 在数值上可忽略不计，则使用侧方方向 $\\mathbf{l} = (1,0,0)$ 并设置 $\\mathbf{t} = \\mathbf{l} - (\\mathbf{l}\\cdot\\mathbf{n})\\mathbf{n}$。将 $\\mathbf{t}$ 归一化为单位长度。按如下方式计算与 $\\mathbf{t}$ 对齐的线圈手柄的偏航角、俯仰角和滚转角（以度为单位）：\n- 偏航角（$x$-$y$ 平面中的方位角）：$\\theta_{\\mathrm{yaw}} = \\operatorname{atan2}(t_y, t_x)\\cdot\\frac{180}{\\pi}$。\n- 俯仰角（从 $x$-$y$ 平面的仰角）：$\\theta_{\\mathrm{pitch}} = \\operatorname{atan2}(t_z, \\sqrt{t_x^2 + t_y^2})\\cdot\\frac{180}{\\pi}$。\n- 滚转角：对于一个规范的方向选择，设置 $\\theta_{\\mathrm{roll}} = 0$。\n\n靶点选择规则：\n- 为每个候选 DLPFC 时间序列 $\\mathbf{x}_j$（位于坐标 $\\mathbf{p}_j$）计算 $r(\\mathbf{s}, \\mathbf{x}_j)$。\n- 选择使 $r(\\mathbf{s}, \\mathbf{x}_j)$ 最小化的索引 $j^\\*$。如果在 $\\varepsilon = 10^{-12}$ 的容差范围内有多个候选者具有相等的最小相关性，则通过选择与参考 DLPFC 坐标 $\\mathbf{p}_{\\mathrm{ref}}$ 的欧几里得距离最小的那个来打破平局。如果仍然平局，则选择字典序最小的坐标（先比较 $x$，然后是 $y$，然后是 $z$）。\n\n您的程序必须实现此过程，并为每个测试用例生成一个包含九个浮点数的列表作为输出：\n$[x_t,y_t,z_t,e_x,e_y,e_z,\\theta_{\\mathrm{yaw}},\\theta_{\\mathrm{pitch}},\\theta_{\\mathrm{roll}}]$，\n其中坐标单位为毫米，角度单位为度，所有数值均四舍五入到三位小数。\n\n测试套件：\n- 案例 1 (理想路径)：$R = 90$，种子时间序列 $\\mathbf{s} = [0.2,-0.1,0.3,-0.2,0.1,-0.3]$，候选者\n    - $\\mathbf{p}_1 = [-38,44,26]$, $\\mathbf{x}_1 = [-0.2,0.1,-0.3,0.2,-0.1,0.3]$,\n    - $\\mathbf{p}_2 = [-32,50,24]$, $\\mathbf{x}_2 = [0.2,0.1,0.25,0.1,0.2,0.1]$,\n    - $\\mathbf{p}_3 = [-40,36,30]$, $\\mathbf{x}_3 = [-0.1,0.05,-0.15,0.1,-0.05,0.15]$,\n  参考坐标 $\\mathbf{p}_{\\mathrm{ref}} = [-38,44,26]$。\n- 案例 2 (无负相关)：$R = 90$，种子时间序列 $\\mathbf{s} = [0.1,0.2,0.1,0.2,0.1,0.2]$，候选者\n    - $\\mathbf{p}_1 = [-38,44,26]$, $\\mathbf{x}_1 = [0.11,0.19,0.12,0.18,0.1,0.21]$,\n    - $\\mathbf{p}_2 = [-30,46,28]$, $\\mathbf{x}_2 = [0.05,0.22,0.08,0.19,0.12,0.17]$,\n    - $\\mathbf{p}_3 = [-42,40,24]$, $\\mathbf{x}_3 = [0.09,0.21,0.09,0.21,0.09,0.21]$,\n  参考坐标 $\\mathbf{p}_{\\mathrm{ref}} = [-38,44,26]$。\n- 案例 3 (打破平局)：$R = 90$，种子时间序列 $\\mathbf{s} = [0.4,-0.2,0.3,-0.1,0.2,-0.3]$，候选者\n    - $\\mathbf{p}_1 = [-35,45,25]$, $\\mathbf{x}_1 = [-0.2,0.1,-0.15,0.05,-0.1,0.15]$,\n    - $\\mathbf{p}_2 = [-41,43,27]$, $\\mathbf{x}_2 = [-0.2,0.1,-0.15,0.05,-0.1,0.15]$,\n    - $\\mathbf{p}_3 = [-33,47,29]$, $\\mathbf{x}_3 = [-0.1,0.05,-0.07,0.02,-0.05,0.08]$,\n  参考坐标 $\\mathbf{p}_{\\mathrm{ref}} = [-38,44,26]$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例的结果本身是一个包含九个四舍五入浮点数的列表，例如：\n$[[x_1,y_1,z_1,e_{x1},e_{y1},e_{z1},\\theta_{\\mathrm{yaw1}},\\theta_{\\mathrm{pitch1}},\\theta_{\\mathrm{roll1}}],[x_2,\\dots],[x_3,\\dots]]$。",
            "solution": "用户提供了一个问题，要求确定重复经颅磁刺激 (rTMS) 的最佳靶点以及相应的线圈放置参数。该方法基于静息态功能性磁共振成像 (rs-fMRI) 数据。\n\n此问题被认为是有效的，因为它科学上基于既定的神经导航原理，数学上定义明确且具有唯一的解标准，并且提供了解决该问题所需的所有数据。解决方案分为两个主要阶段：首先，选择最佳靶点坐标；其次，计算线圈放置的几何参数。\n\n### 阶段 1：最佳靶点选择\n\n主要目标是在背外侧前额叶皮层 (DLPFC) 中确定一个靶点坐标 $\\mathbf{p}_t$，该靶点与种子区域——膝下前扣带皮层 (sgACC)——最大程度地反相关。这通过找到其 fMRI 时间序列与种子时间序列呈现最负皮尔逊相关的候选坐标来实现。\n\n过程如下：\n\n1.  **计算皮尔逊相关性**：对于每个候选者 $j$（其坐标为 $\\mathbf{p}_j$，时间序列为 $\\mathbf{x}_j$），我们计算其与种子时间序列 $\\mathbf{s}$ 的皮尔逊相关系数 $r_j = r(\\mathbf{s}, \\mathbf{x}_j)$。公式为：\n    $$r(\\mathbf{s}, \\mathbf{x}) = \\frac{\\sum_{i=1}^n (s_i - \\bar{s})(x_i - \\bar{x})}{\\sqrt{\\sum_{i=1}^n (s_i - \\bar{s})^2}\\sqrt{\\sum_{i=1}^n (x_i - \\bar{x})^2}}$$\n    根据问题约定，如果 $\\mathbf{s}$ 或 $\\mathbf{x}_j$ 的方差为零，则相关性 $r_j$ 取值为 $0$。\n\n2.  **确定最小相关性**：我们找到所有候选者中的最小相关值：$r_{\\min} = \\min_{j} \\{r_j\\}$。\n\n3.  **应用打破平局规则**：一个多层次的打破平局程序确保选出唯一的靶点。\n    a.  **相关性平局**：首先，我们识别所有相关性 $r_j$ 与最小相关性之差在容差 $\\varepsilon = 10^{-12}$ 内的候选者。设这些平局候选者的集合为 $C_1$。\n        $$C_1 = \\{ \\text{候选者 } j \\mid |r_j - r_{\\min}| \\le \\varepsilon \\}$$\n    b.  **距离平局**：如果 $C_1$ 包含多个候选者，我们计算每个候选者坐标 $\\mathbf{p}_j$ 到给定参考坐标 $\\mathbf{p}_{\\mathrm{ref}}$ 的欧几里得距离 $d_j = \\|\\mathbf{p}_j - \\mathbf{p}_{\\mathrm{ref}}\\|$。我们找到最小距离 $d_{\\min} = \\min_{j \\in C_1} \\{d_j\\}$，并从 $C_1$ 中选出具有该最小距离的候选者组成新集合 $C_2$。在比较距离以处理浮点数运算时，可以使用类似的容差，尽管在提供的案例中并非严格必要。\n    c.  **字典序平局**：如果 $C_2$ 仍然包含多个候选者，我们根据它们的坐标 $\\mathbf{p}_j$ 按字典序（先按 $x$，再按 $y$，最后按 $z$）对其进行排序。此排序列表中的第一个候选者被选为最终靶点。\n\n所选候选者的坐标被指定为靶点坐标 $\\mathbf{p}_t = (x_t, y_t, z_t)$。\n\n### 阶段 2：线圈放置计算\n\n一旦确定了靶点 $\\mathbf{p}_t$，我们便基于球形头部模型来确定线圈放置参数。\n\n1.  **头皮入口点**：头部被建模为一个以原点为中心、半径为 $R$ 的球体。线圈与头皮的接触点 $\\mathbf{e}$，是通过将靶点 $\\mathbf{p}_t$ 从原点投影到该球体表面上找到的。\n    $$ \\mathbf{e} = \\frac{R}{\\|\\mathbf{p}_t\\|}\\mathbf{p}_t $$\n    其中 $\\|\\mathbf{p}_t\\| = \\sqrt{x_t^2 + y_t^2 + z_t^2}$ 是靶点坐标向量的欧几里得范数。\n\n2.  **线圈方向**：线圈必须在入口点 $\\mathbf{e}$ 处与头皮相切。\n    a.  首先，我们计算入口点 $\\mathbf{e}$ 处的向外单位法向量 $\\mathbf{n}$。对于以原点为中心的球体，这只是 $\\mathbf{e}$ 的归一化位置向量：\n        $$ \\mathbf{n} = \\frac{\\mathbf{e}}{R} = \\frac{\\mathbf{p}_t}{\\|\\mathbf{p}_t\\|} $$\n    b.  通过参考头部的解剖轴来定义一个可重复的切向方向。我们将标准的前方方向向量 $\\mathbf{a} = (0, 1, 0)$ 投影到点 $\\mathbf{e}$ 处的切平面上。该切平面由法线 $\\mathbf{n}$ 定义。投影是通过减去 $\\mathbf{a}$ 平行于 $\\mathbf{n}$ 的分量来实现的：\n        $$ \\mathbf{t} = \\mathbf{a} - (\\mathbf{a}\\cdot\\mathbf{n})\\mathbf{n} $$\n    c.  处理一种特殊情况，即靶点位于 $y$ 轴上，这使得 $\\mathbf{n}$ 与 $\\mathbf{a}$ 平行，导致 $\\mathbf{t}$ 成为零向量。如果 $\\|\\mathbf{t}\\|$ 在数值上可忽略不计（例如，$  10^{-9}$），我们使用侧方方向向量 $\\mathbf{l} = (1, 0, 0)$ 来代替 $\\mathbf{a}$，并重新计算 $\\mathbf{t} = \\mathbf{l} - (\\mathbf{l}\\cdot\\mathbf{n})\\mathbf{n}$。\n    d.  将得到的向量 $\\mathbf{t}$ 归一化为单位长度，以表示最终的线圈手柄方向：$\\hat{\\mathbf{t}} = \\mathbf{t} / \\|\\mathbf{t}\\|$。设 $\\hat{\\mathbf{t}} = (t_x, t_y, t_z)$。\n\n3.  **方向角**：将方向向量 $\\hat{\\mathbf{t}}$ 转换为 TMS 设备的一组偏航角、俯仰角和滚转角。\n    -   **偏航角**：这是在水平（$x-y$）平面内的旋转，计算为 $\\hat{\\mathbf{t}}$ 投影的方位角。\n        $$ \\theta_{\\mathrm{yaw}} = \\operatorname{atan2}(t_y, t_x) \\cdot \\frac{180}{\\pi} $$\n    -   **俯仰角**：这是从水平面的仰角。\n        $$ \\theta_{\\mathrm{pitch}} = \\operatorname{atan2}(t_z, \\sqrt{t_x^2 + t_y^2}) \\cdot \\frac{180}{\\pi} $$\n    -   **滚转角**：按照惯例，对于规范方向，滚转角设置为零。\n        $$ \\theta_{\\mathrm{roll}} = 0 $$\n\n最后，对于每个测试用例，我们汇集所需的九个值：靶点坐标 $(x_t, y_t, z_t)$、头皮入口点坐标 $(e_x, e_y, e_z)$ 和线圈角度 $(\\theta_{\\mathrm{yaw}}, \\theta_{\\mathrm{pitch}}, \\theta_{\\mathrm{roll}})$。所有数值结果均四舍五入到三位小数。\n\n对问题陈述中提供的每个测试用例都执行这个完整的、确定性的程序。",
            "answer": "[[-38.000,44.000,26.000,-58.583,67.821,40.082,130.569,25.684,0.000],[-42.000,40.000,24.000,-64.331,61.267,36.760,136.384,23.332,0.000],[-41.000,43.000,27.000,-61.644,64.650,40.596,133.644,26.035,0.000]]"
        }
    ]
}