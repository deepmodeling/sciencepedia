{
    "hands_on_practices": [
        {
            "introduction": "A crucial first step in assessing a potential Circadian Rhythm Sleep-Wake Disorder is to quantify the extent of any misalignment between an individual's endogenous biological clock and their social or occupational schedules. This practice  provides hands-on experience with one of the most fundamental tools for this purpose: the sleep log. By analyzing sleep-wake timings from a hypothetical clinical scenario, you will learn to calculate \"Social Jet Lag,\" a powerful metric that captures the discrepancy between sleep patterns on constrained workdays versus unconstrained free days, bridging the gap between raw patient data and a quantitative measure of circadian disruption.",
            "id": "4697880",
            "problem": "A central question in circadian rhythm sleep-wake disorders is whether the endogenous sleep timing, reflected by the midpoint of sleep on unconstrained days, is misaligned with socially constrained sleep timing. In chronobiology and psychiatry, the sleep midpoint is the halfway point between sleep onset and final awakening, and it serves as a pragmatic proxy of circadian phase in the absence of physiological markers such as dim light melatonin onset. Consider the following $14$ consecutive days of sleep logs for a resident physician with fixed early work start times. For each day, you are given the local clock time for sleep onset and final awakening. There were no time-zone changes, no daylight saving time transitions, and no naps. Assume sleep onset is the moment of lights-off with intent to sleep, and final awakening is the last awakening with getting out of bed. Workdays are constrained by occupational demands; free days are unconstrained.\n\nWeek $1$:\n- Day $1$ (Monday, work): sleep onset $23{:}20$, final awakening $06{:}40$.\n- Day $2$ (Tuesday, work): sleep onset $23{:}30$, final awakening $06{:}30$.\n- Day $3$ (Wednesday, work): sleep onset $00{:}00$, final awakening $07{:}00$.\n- Day $4$ (Thursday, work): sleep onset $23{:}10$, final awakening $06{:}20$.\n- Day $5$ (Friday, work): sleep onset $00{:}10$, final awakening $06{:}50$.\n- Day $6$ (Saturday, free): sleep onset $01{:}50$, final awakening $09{:}50$.\n- Day $7$ (Sunday, free): sleep onset $02{:}10$, final awakening $10{:}30$.\n\nWeek $2$:\n- Day $8$ (Monday, work): sleep onset $23{:}40$, final awakening $06{:}30$.\n- Day $9$ (Tuesday, work): sleep onset $23{:}50$, final awakening $06{:}50$.\n- Day $10$ (Wednesday, work): sleep onset $00{:}05$, final awakening $06{:}55$.\n- Day $11$ (Thursday, work): sleep onset $23{:}25$, final awakening $06{:}45$.\n- Day $12$ (Friday, work): sleep onset $00{:}15$, final awakening $06{:}45$.\n- Day $13$ (Saturday, free): sleep onset $02{:}00$, final awakening $09{:}30$.\n- Day $14$ (Sunday, free): sleep onset $01{:}40$, final awakening $10{:}00$.\n\nUsing the concept of sleep midpoint, compute for each day the mid-sleep clock time, average the mid-sleep times across all workdays and across all free days, and operationalize Social Jet Lag (SJL) as the absolute difference between these two average mid-sleep times. Then infer the resident’s chronotype relative to occupational demands based on the direction and magnitude of this difference. Express the SJL in hours and round your final numerical answer to four significant figures.",
            "solution": "The problem requires the calculation of Social Jet Lag (SJL) from a provided $14$-day sleep log and an inference of the individual's chronotype. The procedure is as follows:\n$1$. Convert all clock times to a non-ambiguous, continuous numerical scale. We will use minutes from midnight, where a time `HH:MM` is converted to a numerical value $T$ by the formula $T = \\text{HH} \\times 60 + \\text{MM}$.\n$2$. For each day $i$, calculate the sleep midpoint, $MS_i$. The sleep midpoint is the halfway point between sleep onset time, $T_{onset}$, and final awakening time, $T_{wake}$.\n$3$. The calculation must account for sleep intervals that cross midnight.\n    - If sleep does not cross midnight ($T_{wake} > T_{onset}$), the sleep midpoint is $MS = \\frac{T_{onset} + T_{wake}}{2}$.\n    - If sleep crosses midnight ($T_{wake} \\le T_{onset}$), the awakening occurs on the next calendar day. The midpoint, expressed in minutes from midnight on the day of awakening, is $MS = \\frac{T_{onset} + (T_{wake} + 1440)}{2} \\pmod{1440}$. The term $1440$ represents the number of minutes in a $24$-hour day.\n$4$. Segregate the days into workdays and free days.\n$5$. Calculate the average sleep midpoint for workdays, $\\overline{MS_W}$.\n$6$. Calculate the average sleep midpoint for free days, $\\overline{MS_F}$. Since the calculated midpoints for each group are clustered closely and do not span midnight, a simple arithmetic mean is appropriate.\n$7$. Compute SJL as the absolute difference between the two averages: $SJL = |\\overline{MS_F} - \\overline{MS_W}|$.\n$8$. Convert the result from minutes to hours and round to four significant figures as specified.\n$9$. Infer the chronotype based on the direction and magnitude of the sleep timing difference between free days and workdays.\n\nFirst, we calculate the sleep midpoint for all workdays. There are $10$ workdays.\n- Day $1$ (work): Onset $23{:}20$ ($1400$ min), Wake $06{:}40$ ($400$ min). Crosses midnight. $MS_1 = \\frac{1400 + 400 + 1440}{2} \\pmod{1440} = 1620 \\pmod{1440} = 180$ min.\n- Day $2$ (work): Onset $23{:}30$ ($1410$ min), Wake $06{:}30$ ($390$ min). Crosses midnight. $MS_2 = \\frac{1410 + 390 + 1440}{2} \\pmod{1440} = 1620 \\pmod{1440} = 180$ min.\n- Day $3$ (work): Onset $00{:}00$ ($0$ min), Wake $07{:}00$ ($420$ min). No crossing. $MS_3 = \\frac{0 + 420}{2} = 210$ min.\n- Day $4$ (work): Onset $23{:}10$ ($1390$ min), Wake $06{:}20$ ($380$ min). Crosses midnight. $MS_4 = \\frac{1390 + 380 + 1440}{2} \\pmod{1440} = 1605 \\pmod{1440} = 165$ min.\n- Day $5$ (work): Onset $00{:}10$ ($10$ min), Wake $06{:}50$ ($410$ min). No crossing. $MS_5 = \\frac{10 + 410}{2} = 210$ min.\n- Day $8$ (work): Onset $23{:}40$ ($1420$ min), Wake $06{:}30$ ($390$ min). Crosses midnight. $MS_8 = \\frac{1420 + 390 + 1440}{2} \\pmod{1440} = 1625 \\pmod{1440} = 185$ min.\n- Day $9$ (work): Onset $23{:}50$ ($1430$ min), Wake $06{:}50$ ($410$ min). Crosses midnight. $MS_9 = \\frac{1430 + 410 + 1440}{2} \\pmod{1440} = 1640 \\pmod{1440} = 200$ min.\n- Day $10$ (work): Onset $00{:}05$ ($5$ min), Wake $06{:}55$ ($415$ min). No crossing. $MS_{10} = \\frac{5 + 415}{2} = 210$ min.\n- Day $11$ (work): Onset $23{:}25$ ($1405$ min), Wake $06{:}45$ ($405$ min). Crosses midnight. $MS_{11} = \\frac{1405 + 405 + 1440}{2} \\pmod{1440} = 1625 \\pmod{1440} = 185$ min.\n- Day $12$ (work): Onset $00{:}15$ ($15$ min), Wake $06{:}45$ ($405$ min). No crossing. $MS_{12} = \\frac{15 + 405}{2} = 210$ min.\n\nThe set of workday midpoints is {$180, 180, 210, 165, 210, 185, 200, 210, 185, 210$} minutes.\nThe average mid-sleep on workdays is:\n$$ \\overline{MS_W} = \\frac{180+180+210+165+210+185+200+210+185+210}{10} = \\frac{1935}{10} = 193.5 \\text{ minutes} $$\nThis corresponds to a clock time of $03{:}13{:}30$.\n\nNext, we calculate the sleep midpoint for all free days. There are $4$ free days.\n- Day $6$ (free): Onset $01{:}50$ ($110$ min), Wake $09{:}50$ ($590$ min). No crossing. $MS_6 = \\frac{110 + 590}{2} = 350$ min.\n- Day $7$ (free): Onset $02{:}10$ ($130$ min), Wake $10{:}30$ ($630$ min). No crossing. $MS_7 = \\frac{130 + 630}{2} = 380$ min.\n- Day $13$ (free): Onset $02{:}00$ ($120$ min), Wake $09{:}30$ ($570$ min). No crossing. $MS_{13} = \\frac{120 + 570}{2} = 345$ min.\n- Day $14$ (free): Onset $01{:}40$ ($100$ min), Wake $10{:}00$ ($600$ min). No crossing. $MS_{14} = \\frac{100 + 600}{2} = 350$ min.\n\nThe set of free day midpoints is {$350, 380, 345, 350$} minutes.\nThe average mid-sleep on free days is:\n$$ \\overline{MS_F} = \\frac{350+380+345+350}{4} = \\frac{1425}{4} = 356.25 \\text{ minutes} $$\nThis corresponds to a clock time of $05{:}56{:}15$.\n\nNow, we compute the Social Jet Lag (SJL) as the absolute difference between these two averages.\n$$ SJL = |\\overline{MS_F} - \\overline{MS_W}| = |356.25 - 193.5| = 162.75 \\text{ minutes} $$\nTo express this in hours, we divide by $60$:\n$$ SJL_{hours} = \\frac{162.75}{60} = 2.7125 \\text{ hours} $$\nRounding this to four significant figures gives $2.713$ hours.\n\nFinally, we infer the chronotype. The average sleep midpoint on free days ($\\overline{MS_F} \\approx 05{:}56$) is substantially later than on workdays ($\\overline{MS_W} \\approx 03{:}14$). This positive difference ($\\overline{MS_F} - \\overline{MS_W} > 0$) signifies that the individual's endogenous sleep timing, expressed on free days, is later than the sleep schedule imposed by occupational demands. This pattern is the hallmark of a **late chronotype** (an \"owl\") who is forced to wake up earlier than their biological preference on workdays. The magnitude of the SJL, over $2.5$ hours, is considered large and indicates a significant misalignment between the endogenous circadian clock and social schedules, a common issue in circadian rhythm sleep-wake disorders.",
            "answer": "$$\\boxed{2.713}$$"
        },
        {
            "introduction": "Once a potential misalignment is identified, the next clinical step is an accurate differential diagnosis, which often requires synthesizing more sophisticated data than simple sleep logs. This exercise  simulates a common diagnostic challenge, tasking you with distinguishing between two distinct circadian disorders by integrating patterns from actigraphy, physiological markers like Dim Light Melatonin Onset (DLMO), and quantitative rest-activity metrics such as Interdaily Stability ($IS$). This practice hones the critical skill of pattern recognition, helping you to interpret multi-modal data to infer the underlying pathophysiology of a patient's complaint.",
            "id": "4697872",
            "problem": "A sighted graduate student aged $25$ years presents with difficulty maintaining a stable sleep schedule. Over the course of $28$ consecutive days of actigraphy (double-plotted), the main consolidated sleep episode appears well-preserved in duration and continuity, with average total sleep time of $7.3~\\mathrm{h}$ per $24~\\mathrm{h}$, median wake after sleep onset of $24~\\mathrm{min}$, and a single dominant sleep episode on most days. However, the timing of the main sleep episode shows a steady daily delay in clock time: sleep onset shifts later by approximately $50~\\mathrm{min/day}$, such that the major sleep episode cycles through the entire $24~\\mathrm{h}$ day over the four-week recording. Nonparametric rest-activity metrics computed from the actigraphy show Interdaily Stability (IS) of $0.19$ and Intradaily Variability (IV) of $0.72$. Dim Light Melatonin Onset (DLMO) measured on day $2$ and day $12$ shows an $8.5~\\mathrm{h}$ delay relative to clock time across that interval. The student reports a stable light environment without shift work or transmeridian travel during the monitoring period.\n\nUse the following foundations to interpret the pattern: a circadian pacemaker with intrinsic period $\\tau$ entrains to the $24~\\mathrm{h}$ light-dark cycle (denoted $T = 24~\\mathrm{h}$) when stable phase relationships are achieved; when not entrained, phase drifts approximately $\\Delta \\phi \\approx \\tau - T$ per day, producing a systematic progression across days; Interdaily Stability (IS) quantifies how strongly activity is phase-locked to the $24~\\mathrm{h}$ cycle (higher values reflect stronger coupling), and Intradaily Variability (IV) quantifies within-day fragmentation (higher values reflect more fragmentation).\n\nWhich option best identifies the most likely diagnosis and provides the most accurate reasoning based on the actigraphy and metrics?\n\nA. Non-24-Hour Sleep-Wake Disorder (N24SWD): Low IS indicates failure of entrainment to $24~\\mathrm{h}$ zeitgebers; preserved consolidation (moderate IV) and a monotonic daily phase delay of approximately constant slope imply $\\tau > 24~\\mathrm{h}$ with free-running behavior.\n\nB. Irregular Sleep-Wake Rhythm Disorder (ISWRD): Low IS alone indicates ISWRD; the apparent slow drift is a non-specific plotting artifact on a double-plot actogram, and IV does not help differentiate these disorders.\n\nC. Delayed Sleep-Wake Phase Disorder (DSWPD): The predominant complaint is late sleep with otherwise normal consolidation; IS and IV are not informative in phase disorders, and a stable late phase best explains the findings.\n\nD. Shift Work Disorder: Rotating schedules produce low IS and linear phase drift; the observed DLMO delay is expected with changing shifts, making occupational scheduling the primary cause here.",
            "solution": "### Problem Validation\n\n**Step 1: Extract Givens**\n- Patient: Sighted graduate student, aged $25$ years.\n- Monitoring method: Actigraphy for $28$ consecutive days.\n- Sleep characteristics:\n    - Main consolidated sleep episode is well-preserved.\n    - Average total sleep time: $7.3~\\mathrm{h}$ per $24~\\mathrm{h}$.\n    - Median wake after sleep onset (WASO): $24~\\mathrm{min}$.\n    - Single dominant sleep episode on most days.\n- Phase drift of sleep:\n    - Sleep onset shifts later by approximately $50~\\mathrm{min/day}$.\n    - The major sleep episode cycles through the entire $24~\\mathrm{h}$ day over the four-week period.\n- Nonparametric rest-activity metrics:\n    - Interdaily Stability (IS): $0.19$.\n    - Intradaily Variability (IV): $0.72$.\n- Physiological marker:\n    - Dim Light Melatonin Onset (DLMO) measured on day $2$ and day $12$.\n    - The DLMO shows an $8.5~\\mathrm{h}$ delay relative to clock time across this $10$-day interval.\n- Environmental conditions:\n    - Stable light environment.\n    - No shift work.\n    - No transmeridian travel.\n- Foundational principles provided:\n    - Entrainment: A circadian pacemaker with intrinsic period $\\tau$ entrains to an external period $T = 24~\\mathrm{h}$ when stable phase relationships are achieved.\n    - Free-run: When not entrained, phase drifts by approximately $\\Delta \\phi \\approx \\tau - T$ per day.\n    - IS: Quantifies phase-locking to the $24~\\mathrm{h}$ cycle (higher is stronger).\n    - IV: Quantifies within-day fragmentation (higher is more fragmented).\n\n**Step 2: Validate Using Extracted Givens**\nThe problem statement is scientifically grounded, well-posed, and objective.\n- **Scientific Grounding**: The problem uses standard concepts and terminology from chronobiology and sleep medicine, including actigraphy, DLMO, IS, IV, entrainment, free-running period ($\\tau$), and circadian rhythm sleep-wake disorders. The scenario described is a classic clinical presentation.\n- **Consistency and Realism**: The provided data are internally consistent and realistic.\n    1. The subjective report of a steady daily delay in sleep timing is quantified by the actigraphy finding of a $50~\\mathrm{min/day}$ shift in sleep onset.\n    2. This behavioral drift is independently corroborated by a physiological marker, the DLMO. The delay between day $2$ and day $12$ is $12 - 2 = 10$ days. The total phase delay is $8.5~\\mathrm{h}$. The average daily delay is $\\frac{8.5~\\mathrm{h}}{10~\\mathrm{days}} = 0.85~\\mathrm{h/day}$. Converting to minutes: $0.85 \\times 60~\\mathrm{min} = 51~\\mathrm{min}$. This value ($51~\\mathrm{min/day}$) is in excellent agreement with the behaviorally observed drift of approximately $50~\\mathrm{min/day}$. This consistency demonstrates the phenomenon is real and not an artifact.\n    3. An IS value of $0.19$ is very low, which is quantitatively consistent with a rhythm that is not entrained (not phase-locked) to the $24~\\mathrm{h}$ day.\n    4. A median WASO of $24~\\mathrm{min}$ confirms the qualitative description of a \"well-preserved\" and consolidated sleep episode.\n- **Well-Posed**: The problem is well-posed. Sufficient information is provided to distinguish between the differential diagnoses offered in the options. The explicit exclusion of external factors like shift work and travel makes the problem self-contained.\n- **Objectivity**: The language is objective and presents quantitative data without subjective bias.\n\n**Step 3: Verdict and Action**\nThe problem statement is valid. I will proceed with deriving a solution.\n\n### Solution Derivation\n\nThe central feature of this case is the systematic, progressive delay of the sleep-wake cycle and the underlying circadian pacemaker, demonstrated by both actigraphy and DLMO. This indicates that the patient's internal clock is not synchronized (entrained) to the $24$-hour day-night cycle. Instead, it is \"free-running\" at its own intrinsic period, $\\tau$.\n\n1.  **Calculate the Intrinsic Period ($\\tau$)**: The daily phase shift, $\\Delta \\phi$, is given by the formula $\\Delta \\phi \\approx \\tau - T$. Here, $T$ is the period of the external environment, which is $24~\\mathrm{h}$. The observed daily delay is $\\Delta \\phi$.\n    - From sleep onset drift, $\\Delta \\phi \\approx 50~\\mathrm{min} \\approx 0.83~\\mathrm{h}$.\n    - From DLMO drift, $\\Delta \\phi = 51~\\mathrm{min} = 0.85~\\mathrm{h}$.\n    - Since the phase is delaying (occurring later each day), the intrinsic period $\\tau$ must be longer than the environmental period $T$.\n    - Using the more precise DLMO data: $\\tau = T + \\Delta \\phi = 24~\\mathrm{h} + 0.85~\\mathrm{h} = 24.85~\\mathrm{h}$.\n    - This corresponds to a period of approximately $24$ hours and $51$ minutes.\n\n2.  **Interpret the Metrics**:\n    - **IS = $0.19$**: The Interdaily Stability metric quantifies the regularity of the rhythm on a day-to-day basis, relative to the $24~\\mathrm{h}$ clock. A free-running rhythm, by definition, is not stable relative to the $24~\\mathrm{h}$ day. Its phase constantly changes. Therefore, a very low IS value is expected and confirms the lack of entrainment.\n    - **IV = $0.72$**: The Intradaily Variability metric quantifies fragmentation. The patient's sleep is described as \"well-preserved in duration and continuity,\" with a low WASO ($24~\\mathrm{min}$). This suggests that the sleep episode itself is not fragmented, even though its timing is unstable. An IV of $0.72$ is moderately elevated but not indicative of the highly fragmented, polyphasic sleep pattern seen in disorders like Irregular Sleep-Wake Rhythm Disorder (ISWRD).\n\n3.  **Identify the Disorder**: The clinical picture is that of a circadian rhythm with an intrinsic period significantly longer than $24$ hours, leading to a failure of entrainment and a \"free-running\" pattern. This is the defining characteristic of **Non-24-Hour Sleep-Wake Disorder (N24SWD)**. Although more common in totally blind individuals who lack light perception, it can also occur in sighted individuals, as presented here.\n\n### Option-by-Option Analysis\n\n**A. Non-24-Hour Sleep-Wake Disorder (N24SWD): Low IS indicates failure of entrainment to $24~\\mathrm{h}$ zeitgebers; preserved consolidation (moderate IV) and a monotonic daily phase delay of approximately constant slope imply $\\tau > 24~\\mathrm{h}$ with free-running behavior.**\n- This option correctly identifies the diagnosis as N24SWD.\n- The reasoning is entirely correct:\n    - \"Low IS indicates failure of entrainment to $24~\\mathrm{h}$ zeitgebers\": Correct. An IS of $0.19$ is very low and signifies lack of phase-locking to the $24$-hour day.\n    - \"preserved consolidation (moderate IV)\": Correct. The low WASO ($24~\\mathrm{min}$) and description of the sleep episode support preserved consolidation, distinguishing it from highly fragmented disorders. The IV value is consistent with this.\n    - \"monotonic daily phase delay of approximately constant slope\": Correct. This is evidenced by both the $50~\\mathrm{min/day}$ sleep delay and the $8.5~\\mathrm{h}$ DLMO delay over $10$ days.\n    - \"imply $\\tau > 24~\\mathrm{h}$ with free-running behavior\": Correct. This is the direct implication of a consistent daily delay, as derived above.\n- **Verdict**: **Correct**.\n\n**B. Irregular Sleep-Wake Rhythm Disorder (ISWRD): Low IS alone indicates ISWRD; the apparent slow drift is a non-specific plotting artifact on a double-plot actogram, and IV does not help differentiate these disorders.**\n- The diagnosis of ISWRD is incorrect. ISWRD is characterized by a lack of a discernible, consolidated sleep-wake rhythm, with multiple short sleep bouts scattered irregularly across the $24$-hour period. This patient has a \"single dominant sleep episode.\"\n- The reasoning is flawed:\n    - \"Low IS alone indicates ISWRD\": While ISWRD has low IS, it is not the only disorder with this feature. N24SWD also has low IS. It is not a sufficient condition for diagnosing ISWRD.\n    - \"the apparent slow drift is a non-specific plotting artifact\": This is factually incorrect. The drift is measured by two independent means (behavioral sleep onset and physiological DLMO) which show remarkable agreement. It is a biological reality, not a plotting artifact.\n    - \"IV does not help differentiate these disorders\": This is also incorrect. The highly fragmented pattern of ISWRD typically results in a much higher IV than what would be seen in N24SWD with consolidated sleep.\n- **Verdict**: **Incorrect**.\n\n**C. Delayed Sleep-Wake Phase Disorder (DSWPD): The predominant complaint is late sleep with otherwise normal consolidation; IS and IV are not informative in phase disorders, and a stable late phase best explains the findings.**\n- The diagnosis of DSWPD is incorrect. DSWPD involves a *stable* entrainment to a delayed phase (e.g., consistently sleeping from 3 AM to 11 AM). This patient's rhythm is *unstable* and constantly drifting later each day.\n- The reasoning is flawed:\n    - \"a stable late phase best explains the findings\": This directly contradicts the core finding of a continuous $50~\\mathrm{min/day}$ drift.\n    - \"IS and IV are not informative in phase disorders\": This is false. A patient with DSWPD who maintains a regular, albeit delayed, schedule would show a high IS value, as their rhythm is perfectly periodic over $24~\\mathrm{h}$. The low IS of $0.19$ in this case is highly informative and argues strongly against any stable phase disorder like DSWPD.\n- **Verdict**: **Incorrect**.\n\n**D. Shift Work Disorder: Rotating schedules produce low IS and linear phase drift; the observed DLMO delay is expected with changing shifts, making occupational scheduling the primary cause here.**\n- The diagnosis of Shift Work Disorder is incorrect. This is an exogenous disorder caused by a work schedule that conflicts with the natural sleep-wake cycle.\n- The reasoning is flawed because it ignores a key piece of information provided in the problem statement: \"The student reports a stable light environment without shift work or transmeridian travel during the monitoring period.\" This explicitly rules out an occupational or environmental cause, pointing to an endogenous (internal) origin of the problem.\n- **Verdict**: **Incorrect**.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Moving from assessment and diagnosis to treatment, modern chronotherapy is increasingly focused on personalized and dynamic interventions. This advanced practice  explores the computational foundations of such treatments, where an intervention's timing is not static but is algorithmically adjusted based on the patient's observed response. You will engage with a simplified but powerful model of the human circadian system's response to light—the Phase Response Curve (PRC)—to design an adaptive scheduling algorithm, reflecting the cutting edge of personalized circadian medicine and its integration of clinical knowledge with computational modeling.",
            "id": "4697894",
            "problem": "You are tasked with implementing an adaptive daily scheduling algorithm for a single timed intervention (for example, bright light exposure) to entrain a patient's circadian phase toward a desired target. The algorithm must update the next day's intervention time based on the observed phase shift and adherence, while respecting safety limits. The goal is to minimize the estimated phase error after the next intervention, subject to timing and safety constraints.\n\nFundamental base and modeling assumptions:\n\n- The human circadian pacemaker can be modeled as a limit-cycle oscillator with a phase variable $\\phi$ measured in hours modulo $24$. For clinical timing purposes, we use a clock-referenced event such as the Dim Light Melatonin Onset (DLMO) as a surrogate for phase, denoted $T_c$ (current observed DLMO in hours on a $24$-hour clock), and the desired target DLMO $T_d$.\n\n- Phase changes induced by timed light follow a well-tested Phase Response Curve (PRC) that is approximately sinusoidal with respect to the timing of the stimulus relative to internal phase. For a single brief intervention at clock time $\\tau$, the expected phase shift in hours is modeled as\n$$\ns(\\tau; a, k, T_c, \\phi_0) = a \\, k \\, \\sin\\!\\left(\\frac{2\\pi}{24}\\left((\\tau - T_c) - \\phi_0\\right)\\right),\n$$\nwhere $a \\in [0,1]$ is the adherence factor for the next day (fraction of prescribed exposure achieved), $k$ is a sensitivity parameter (in hours) reflecting individual magnitude of response, and $\\phi_0$ is a phase offset parameter that locates the PRC zero crossing. This $s(\\tau)$ is a signed quantity: positive values represent advances (earlier phase), and negative values represent delays (later phase). For safety, the effective shift is saturated:\n$$\n\\hat{s}(\\tau) = \\max\\big(-S_{\\max}, \\, \\min(S_{\\max}, \\, s(\\tau)\\big)\\big),\n$$\nwhere $S_{\\max}$ is the maximum allowed magnitude of daily phase correction in hours.\n\n- The shortest signed difference on a $24$-hour circle between two clock times $x$ and $y$ is given by\n$$\n\\mathrm{wrap}_{12}(x - y) = \\big((x - y + 12) \\bmod 24\\big) - 12,\n$$\nwhich returns a value in $[-12,12]$.\n\n- Personalization: the sensitivity parameter $k$ is adapted daily using the observed previous day's phase shift $\\Delta\\phi_{\\text{obs,prev}}$ (in hours, positive for advances) at the previous intervention time $\\tau_{\\text{prev}}$ with adherence $a_{\\text{prev}}$. Using a simple gradient step to reduce squared prediction error,\n$$\n\\tilde{\\Delta}_{\\text{prev}} = a_{\\text{prev}} \\, k_{\\text{old}} \\, \\sin\\!\\left(\\frac{2\\pi}{24}\\left((\\tau_{\\text{prev}} - T_c) - \\phi_0\\right)\\right),\n$$\n$$\ne_k = \\Delta\\phi_{\\text{obs,prev}} - \\tilde{\\Delta}_{\\text{prev}},\n$$\n$$\nk_{\\text{new}} = \\max\\!\\left(k_{\\min}, \\, \\min\\!\\left(k_{\\max}, \\, k_{\\text{old}} + \\eta \\, e_k \\, a_{\\text{prev}} \\, \\sin\\!\\left(\\frac{2\\pi}{24}\\left((\\tau_{\\text{prev}} - T_c) - \\phi_0\\right)\\right)\\right)\\right),\n$$\nwhere $\\eta$ is a learning rate, and $k_{\\min}, k_{\\max}$ are bounds ensuring physiological plausibility.\n\n- Safety and feasibility constraints for the next intervention time $\\tau_{\\text{next}}$:\n    1. Allowed window: $\\tau_{\\text{next}} \\in [W_{\\text{start}}, W_{\\text{end}}]$.\n    2. Daily adjustment limit: $|\\tau_{\\text{next}} - \\tau_{\\text{prev}}| \\le L_{\\max}$.\n\n- Objective for choosing $\\tau_{\\text{next}}$ on a grid with step $\\Delta t$ (in hours) is to minimize\n$$\nJ(\\tau) = \\left| \\mathrm{wrap}_{12}\\!\\left((T_c - \\hat{s}(\\tau)) - T_d \\right) \\right| + \\lambda \\, |\\tau - \\tau_{\\text{prev}}|,\n$$\nwhere the first term is the estimated magnitude of the phase error after applying the next intervention (advance reduces $T_c$), and the second term penalizes large day-to-day changes for safety and adherence ($\\lambda \\ge 0$).\n\nImplementation requirements:\n\n1. Implement the functions $\\mathrm{wrap}_{12}(\\cdot)$, $s(\\tau)$, $\\hat{s}(\\tau)$, the adaptive update for $k$ as above, and the objective $J(\\tau)$.\n2. For each test case below, compute $k_{\\text{new}}$ and then select $\\tau_{\\text{next}}$ by minimizing $J(\\tau)$ over the feasible grid $\\tau \\in [W_{\\text{start}}, W_{\\text{end}}]$ with $|\\tau - \\tau_{\\text{prev}}| \\le L_{\\max}$, using resolution $\\Delta t = 0.25$ hours. If the feasible set is empty, move $\\tau_{\\text{prev}}$ toward the window by at most $L_{\\max}$ and clamp to the window boundaries.\n3. Express all quantities in hours. The program should output the recommended $\\tau_{\\text{next}}$ values as floating-point numbers in hours on the local $24$-hour clock. No angles in degrees are used.\n4. The final output format must be a single line containing the results as a comma-separated list enclosed in square brackets, for example $[7.75,8.00,6.50]$.\n\nConstants (apply to all test cases unless otherwise specified):\n- $S_{\\max} = 2.5$ hours.\n- $L_{\\max} = 1.5$ hours.\n- $\\lambda = 0.1$.\n- $\\phi_0 = 0.0$ hours.\n- $\\eta = 0.5$.\n- $k_{\\min} = 0.5$ hours, $k_{\\max} = 3.0$ hours.\n- $k_{\\text{old}} = 1.8$ hours.\n- Grid step $\\Delta t = 0.25$ hours.\n\nTest suite (each case is a tuple of parameters in the exact order: $(T_d, T_c, \\tau_{\\text{prev}}, a_{\\text{prev}}, \\Delta\\phi_{\\text{obs,prev}}, a, W_{\\text{start}}, W_{\\text{end}})$):\n- Case 1 (delayed phase, high adherence, morning window): $(21.0, \\, 23.5, \\, 7.0, \\, 0.8, \\, 0.8, \\, 0.9, \\, 6.0, \\, 10.0)$.\n- Case 2 (small delay, zero adherence next day, evening window): $(22.0, \\, 22.5, \\, 20.0, \\, 0.7, \\, -0.5, \\, 0.0, \\, 19.0, \\, 21.0)$.\n- Case 3 (near-entrained, stable morning schedule): $(20.0, \\, 20.1, \\, 6.5, \\, 1.0, \\, 0.0, \\, 1.0, \\, 6.0, \\, 10.0)$.\n- Case 4 (advanced phase, constrained early window): $(21.0, \\, 16.0, \\, 7.5, \\, 0.6, \\, 0.3, \\, 0.8, \\, 6.0, \\, 9.0)$.\n- Case 5 (large error, cap by $S_{\\max}$, morning window): $(21.0, \\, 3.0, \\, 8.0, \\, 0.9, \\, 1.5, \\, 1.0, \\, 6.0, \\, 9.0)$.\n\nYour program should produce a single line of output containing the recommended $\\tau_{\\text{next}}$ for each case in order, formatted as a comma-separated list enclosed in square brackets, for example $[\\tau_{\\text{next,1}},\\tau_{\\text{next,2}},\\tau_{\\text{next,3}},\\tau_{\\text{next,4}},\\tau_{\\text{next,5}}]$.",
            "solution": "The problem statement has been meticulously reviewed and is determined to be valid. It is scientifically grounded in established principles of computational chronobiology, mathematically well-posed as a constrained optimization problem, and objectively specified with all necessary parameters and definitions. The problem is self-contained, internally consistent, and requires a non-trivial algorithmic implementation.\n\nThe solution process for each test case involves two main stages: first, updating the individual sensitivity parameter $k$ based on the most recent observed data, and second, determining the optimal intervention time for the next day, $\\tau_{\\text{next}}$, by minimizing a cost function over a set of feasible times.\n\nThe procedural steps are as follows:\n\n1.  **Update the Sensitivity Parameter ($k$)**: The sensitivity parameter, $k$, which represents the magnitude of an individual's phase response to the intervention, is adapted using a gradient-descent-based rule. The goal is to minimize the error between the observed phase shift from the previous day, $\\Delta\\phi_{\\text{obs,prev}}$, and the shift predicted by the model using the old parameter, $k_{\\text{old}}$.\n\n    The predicted shift for the previous day, $\\tilde{\\Delta}_{\\text{prev}}$, is calculated using the phase response curve (PRC) model:\n    $$\n    \\tilde{\\Delta}_{\\text{prev}} = a_{\\text{prev}} \\, k_{\\text{old}} \\, \\sin\\!\\left(\\frac{2\\pi}{24}\\left((\\tau_{\\text{prev}} - T_c) - \\phi_0\\right)\\right)\n    $$\n    Here, $a_{\\text{prev}}$ is the adherence factor for the previous intervention at time $\\tau_{\\text{prev}}$, and $T_c$ is the current measured circadian phase. The prediction error, $e_k$, is the difference between the observed and predicted shifts:\n    $$\n    e_k = \\Delta\\phi_{\\text{obs,prev}} - \\tilde{\\Delta}_{\\text{prev}}\n    $$\n    The update for $k$ is a step in the direction that reduces this error, scaled by the learning rate $\\eta$ and the sensitivity of the prediction to $k$. The derivative of the prediction error with respect to $k_{\\text{old}}$ provides the gradient direction. This leads to the update rule:\n    $$\n    k_{\\text{new_raw}} = k_{\\text{old}} + \\eta \\, e_k \\, a_{\\text{prev}} \\, \\sin\\!\\left(\\frac{2\\pi}{24}\\left((\\tau_{\\text{prev}} - T_c) - \\phi_0\\right)\\right)\n    $$\n    The resulting new value is then clamped to a physiologically plausible range $[k_{\\min}, k_{\\max}]$:\n    $$\n    k_{\\text{new}} = \\max\\!\\left(k_{\\min}, \\, \\min\\!\\left(k_{\\max}, \\, k_{\\text{new_raw}}\\right)\\right)\n    $$\n    This $k_{\\text{new}}$ is used for all subsequent calculations for the upcoming day's intervention.\n\n2.  **Determine the Feasible Set for $\\tau_{\\text{next}}$**: The selection of the next intervention time, $\\tau_{\\text{next}}$, is subject to two constraints: it must lie within a prescribed window $[W_{\\text{start}}, W_{\\text{end}}]$, and its change from the previous day's time must not exceed a maximum adjustment limit $L_{\\max}$.\n    \n    The adjustment limit constraint is $|\\tau_{\\text{next}} - \\tau_{\\text{prev}}| \\le L_{\\max}$, which defines the interval $[\\tau_{\\text{prev}} - L_{\\max}, \\tau_{\\text{prev}} + L_{\\max}]$. The feasible continuous range for $\\tau_{\\text{next}}$ is the intersection of these two intervals:\n    $$\n    [\\tau_{\\min}, \\tau_{\\max}] = [\\max(W_{\\text{start}}, \\tau_{\\text{prev}} - L_{\\max}), \\min(W_{\\text{end}}, \\tau_{\\text{prev}} + L_{\\max})]\n    $$\n    The problem specifies a search over a discrete grid. The set of candidate times, $\\mathcal{T}_{\\text{feasible}}$, is generated by discretizing this interval with a step of $\\Delta t=0.25$ hours.\n    \n    If $\\tau_{\\min} > \\tau_{\\max}$, the feasible set is empty. In this case, a specific rule is applied: $\\tau_{\\text{next}}$ is set to the boundary of the window $[W_{\\text{start}}, W_{\\text{end}}]$ that is closest to $\\tau_{\\text{prev}}$. If $\\tau_{\\text{prev}}$ is too early (i.e., $\\tau_{\\text{prev}} + L_{\\max} < W_{\\text{start}}$), $\\tau_{\\text{next}}$ is set to $W_{\\text{start}}$. If $\\tau_{\\text{prev}}$ is too late (i.e., $\\tau_{\\text{prev}} - L_{\\max} > W_{\\text{end}}$), $\\tau_{\\text{next}}$ is set to $W_{\\text{end}}$.\n\n3.  **Optimize $\\tau_{\\text{next}}$ by Minimizing the Objective Function ($J(\\tau)$)**: For each candidate time $\\tau \\in \\mathcal{T}_{\\text{feasible}}$, the objective function $J(\\tau)$ is evaluated. This function balances two competing goals: minimizing the expected phase error after the intervention and minimizing the day-to-day change in intervention timing.\n    $$\n    J(\\tau) = \\left| \\mathrm{wrap}_{12}\\!\\left((T_c - \\hat{s}(\\tau)) - T_d \\right) \\right| + \\lambda \\, |\\tau - \\tau_{\\text{prev}}|\n    $$\n    The calculation proceeds as follows:\n    \n    a.  Calculate the expected raw phase shift $s(\\tau)$ using the updated $k_{\\text{new}}$ and the projected adherence $a$:\n        $$\n        s(\\tau) = a \\, k_{\\text{new}} \\, \\sin\\!\\left(\\frac{2\\pi}{24}\\left((\\tau - T_c) - \\phi_0\\right)\\right)\n        $$\n    \n    b.  Apply the safety saturation to get the effective shift $\\hat{s}(\\tau)$:\n        $$\n        \\hat{s}(\\tau) = \\max\\big(-S_{\\max}, \\, \\min(S_{\\max}, \\, s(\\tau)\\big)\\big)\n        $$\n    \n    c.  The first term of $J(\\tau)$ is the magnitude of the projected phase error. The projected phase after the shift is $T_c - \\hat{s}(\\tau)$ (since a positive shift is an advance, reducing the clock time of the DLMO). The error is the shortest distance on the $24$-hour clock to the target phase $T_d$, calculated using the $\\mathrm{wrap}_{12}$ function: $\\mathrm{wrap}_{12}(x - y) = \\big(((x - y) + 12) \\pmod{24}\\big) - 12$.\n    \n    d.  The second term of $J(\\tau)$ is a penalty proportional to the magnitude of the change from the previous day's schedule, $|\\tau - \\tau_{\\text{prev}}|$, weighted by the factor $\\lambda$.\n    \n    The optimal next intervention time, $\\tau_{\\text{next}}$, is the value of $\\tau$ from the feasible grid that minimizes $J(\\tau)$:\n    $$\n    \\tau_{\\text{next}} = \\underset{\\tau \\in \\mathcal{T}_{\\text{feasible}}}{\\arg\\min} \\, J(\\tau)\n    $$\n    In case of a tie, the first value in the search grid that achieves the minimum is selected. This entire process is repeated for each test case provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements an adaptive circadian scheduling algorithm to determine the optimal\n    timing for a daily intervention.\n    \"\"\"\n    \n    # Define global constants\n    S_MAX = 2.5   # hours, max daily phase correction\n    L_MAX = 1.5   # hours, max daily schedule adjustment\n    LAMBDA = 0.1  # penalty weight for schedule change\n    PHI_0 = 0.0   # hours, PRC phase offset\n    ETA = 0.5     # learning rate for k\n    K_MIN = 0.5   # hours, min sensitivity\n    K_MAX = 3.0   # hours, max sensitivity\n    K_OLD = 1.8   # hours, initial sensitivity\n    DT = 0.25     # hours, grid step for tau search\n\n    # Test suite from the problem statement\n    # (Td, Tc, tau_prev, a_prev, delta_phi_obs_prev, a, W_start, W_end)\n    test_cases = [\n        (21.0, 23.5, 7.0, 0.8, 0.8, 0.9, 6.0, 10.0),\n        (22.0, 22.5, 20.0, 0.7, -0.5, 0.0, 19.0, 21.0),\n        (20.0, 20.1, 6.5, 1.0, 0.0, 1.0, 6.0, 10.0),\n        (21.0, 16.0, 7.5, 0.6, 0.3, 0.8, 6.0, 9.0),\n        (21.0, 3.0, 8.0, 0.9, 1.5, 1.0, 6.0, 9.0),\n    ]\n\n    # --- Helper functions ---\n    def wrap12(diff):\n        \"\"\"Computes the shortest signed difference on a 24-hour circle.\"\"\"\n        return ((diff + 12) % 24) - 12\n\n    def s_func(tau, a, k, Tc):\n        \"\"\"Calculates the raw phase shift s(tau).\"\"\"\n        arg = (2 * np.pi / 24) * ((tau - Tc) - PHI_0)\n        return a * k * np.sin(arg)\n\n    def s_hat_func(s_val):\n        \"\"\"Calculates the saturated phase shift.\"\"\"\n        return np.clip(s_val, -S_MAX, S_MAX)\n\n    def J_func(tau, Td, Tc, tau_prev, a, k_new):\n        \"\"\"Calculates the objective function J(tau).\"\"\"\n        s_val = s_func(tau, a, k_new, Tc)\n        s_hat = s_hat_func(s_val)\n        \n        projected_Tc = Tc - s_hat\n        phase_error = np.abs(wrap12(projected_Tc - Td))\n        \n        schedule_penalty = LAMBDA * np.abs(tau - tau_prev)\n        \n        return phase_error + schedule_penalty\n\n    results = []\n\n    for case in test_cases:\n        Td, Tc, tau_prev, a_prev, delta_phi_obs_prev, a_next, W_start, W_end = case\n\n        # --- Step 1: Update the sensitivity parameter k ---\n        sine_term_arg = (2 * np.pi / 24) * ((tau_prev - Tc) - PHI_0)\n        sine_val = np.sin(sine_term_arg)\n        \n        delta_prev_predicted = a_prev * K_OLD * sine_val\n        e_k = delta_phi_obs_prev - delta_prev_predicted\n        \n        # Note: The problem states k_old is a constant initial value for all cases.\n        # This implies k is not carried over from one case to the next.\n        k_new_raw = K_OLD + ETA * e_k * a_prev * sine_val\n        k_new = np.clip(k_new_raw, K_MIN, K_MAX)\n\n        # --- Step 2: Determine the feasible set for tau_next ---\n        tau_min_feasible = max(W_start, tau_prev - L_MAX)\n        tau_max_feasible = min(W_end, tau_prev + L_MAX)\n\n        if tau_min_feasible > tau_max_feasible:\n            # Handle empty feasible set as per problem spec\n            if tau_prev + L_MAX  W_start:\n                tau_next = W_start\n            else: # tau_prev - L_MAX > W_end\n                tau_next = W_end\n        else:\n            # --- Step 3: Optimize tau_next over the feasible grid ---\n            # Create the grid of candidate tau values\n            # Add a small epsilon to include the endpoint in np.arange\n            tau_grid = np.arange(tau_min_feasible, tau_max_feasible + DT/2, DT)\n\n            # Evaluate the objective function for all candidate taus\n            J_values = [J_func(tau, Td, Tc, tau_prev, a_next, k_new) for tau in tau_grid]\n            \n            # Find the tau that minimizes J\n            min_index = np.argmin(J_values)\n            tau_next = tau_grid[min_index]\n        \n        results.append(f\"{tau_next:.2f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}