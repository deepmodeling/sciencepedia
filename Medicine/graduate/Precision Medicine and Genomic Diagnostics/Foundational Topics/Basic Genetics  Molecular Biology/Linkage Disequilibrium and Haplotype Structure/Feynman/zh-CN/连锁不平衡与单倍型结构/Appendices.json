{
    "hands_on_practices": [
        {
            "introduction": "在我们解释连锁不平衡（LD）模式之前，我们必须能够区分真实的生物学关联和由有限样本量引入的随机噪声。这项练习将引导你推导在两个位点真正不连锁的情况下，样本连锁不平衡度量 $\\hat{r}^2$ 的期望值。理解这种“噪声基线”对于正确解读基因组数据至关重要，尤其是在涉及稀有变异的研究中 。",
            "id": "4355695",
            "problem": "考虑用于精准医疗和基因组诊断的人类稀有变异测序数据集中的两个双等位基因座，其等位基因分别表示为 $\\{A,a\\}$ 和 $\\{B,b\\}$。假设在基础群体中满足哈迪-温伯格平衡（HWE）和随机交配，并假定这两个基因座是物理上不连锁的，因此它们真实的连锁不平衡（LD）系数为零。设等位基因 $A$ 的群体频率为 $p_{A}$，等位基因 $B$ 的群体频率为 $p_{B}$，四种单倍型概率分别为 $P_{AB}$、$P_{Ab}$、$P_{aB}$ 和 $P_{ab}$，且当连锁不平衡为零时，$P_{AB} = p_{A} p_{B}$。\n\n定义连锁不平衡系数为 $D = P_{AB} - p_{A} p_{B}$，标准化的连锁不平衡度量为 $r^{2} = \\dfrac{D^{2}}{p_{A}(1 - p_{A})\\,p_{B}(1 - p_{B})}$。在一个包含 $N$ 条定相染色体（单倍型）的样本中，设经验频率为 $\\hat P_{AB}$、$\\hat p_{A}$ 和 $\\hat p_{B}$，并定义经验连锁不平衡估计量为 $\\hat D = \\hat P_{AB} - \\hat p_{A}\\,\\hat p_{B}$ 和 $\\hat{r}^{2} = \\dfrac{\\hat{D}^{2}}{\\hat{p}_{A}(1 - \\hat{p}_{A})\\,\\hat{p}_{B}(1 - \\hat{p}_{B})}$。\n\n在稀有变异关联研究中，一个常见的做法是应用次要等位基因频率（MAF）阈值 $t$（例如 $t = 0.01$），只保留次要等位基因频率在区间 $[t,\\,1 - t]$ 内的变异。在此背景下，回答以下问题：\n\n从核心定义和独立性下单倍型多项式抽样的性质出发，推导 $\\mathbb{E}[\\hat r^{2}]$ 的主导阶行为的表达式，该表达式是样本量 $N$ 和 MAF 阈值 $t$ 的函数。从第一性原理出发，解释连锁不平衡对次要等位基因频率和样本量的依赖性如何进入期望值，并说明以 MAF 阈值 $p_{A}, p_{B} \\in [t,\\,1 - t]$ 为条件是否会改变 $\\mathbb{E}[\\hat r^{2}]$ 的主导阶值。\n\n最后，考虑一个由 $2400$ 名无亲缘关系的个体组成的队列，该队列已被完美定相，因此有 $N = 4800$ 条单倍型，且 MAF 阈值为 $t = 0.01$。在上述假设下，计算应用 MAF 阈值后主导阶 $\\mathbb{E}[\\hat r^{2}]$ 的数值，并将最终答案四舍五入至四位有效数字。最终答案以纯数字的科学记数法表示。",
            "solution": "问题陈述已经过严格评估，并被确定为有效。它在科学上基于群体遗传学原理，问题定义明确，客观，并包含足够的信息以推导出唯一解。因此，我们可以继续进行推导和计算。\n\n该问题要求在无连锁不平衡（$D=0$）的原假设下，两个物理上不连锁的基因座之间样本相关系数平方的期望值 $\\mathbb{E}[\\hat{r}^2]$ 的主导阶行为。\n\n设两个双等位基因座的等位基因为 $\\{A, a\\}$ 和 $\\{B, b\\}$。在一个包含 $N$ 条定相染色体（单倍型）的样本中，设四种可能单倍型的计数为 $n_{AB}$、$n_{Ab}$、$n_{aB}$ 和 $n_{ab}$，使得 $n_{AB} + n_{Ab} + n_{aB} + n_{ab} = N$。这些计数服从参数为 $N$ 和概率为 $\\{P_{AB}, P_{Ab}, P_{aB}, P_{ab}\\}$ 的多项式分布。\n\n在连锁平衡（$D=0$）的假设下，这些概率由相应等位基因频率的乘积给出：\n$P_{AB} = p_A p_B$\n$P_{Ab} = p_A (1-p_B)$\n$P_{aB} = (1-p_A) p_B$\n$P_{ab} = (1-p_A) (1-p_B)$\n\n样本等位基因频率为 $\\hat{p}_A = (n_{AB} + n_{Ab})/N$ 和 $\\hat{p}_B = (n_{AB} + n_{aB})/N$。样本单倍型频率为 $\\hat{P}_{AB} = n_{AB}/N$。\n样本连锁不平衡系数为 $\\hat{D} = \\hat{P}_{AB} - \\hat{p}_A \\hat{p}_B$。\n样本相关系数的平方定义为 $\\hat{r}^2 = \\frac{\\hat{D}^2}{\\hat{p}_A(1-\\hat{p}_A)\\hat{p}_B(1-\\hat{p}_B)}$。\n\n推导 $\\hat{r}^2$ 期望值的一个直接且有原则的方法是将其与 $2 \\times 2$ 列联表中独立性的皮尔逊卡方统计量联系起来。我们这两个基因座的列联表将具有以下计数：\n\n|          | 等位基因 B | 等位基因 b | 总计    |\n|----------|----------|----------|----------|\n| 等位基因 A | $n_{AB}$ | $n_{Ab}$ | $N\\hat{p}_A$ |\n| 等位基因 a | $n_{aB}$ | $n_{ab}$ | $N(1-\\hat{p}_A)$ |\n| 总计    | $N\\hat{p}_B$ | $N(1-\\hat{p}_B)$ | $N$        |\n\n此表的皮尔逊卡方统计量 $X^2$ 可以用单倍型计数表示为：\n$$X^2 = \\frac{N (n_{AB}n_{ab} - n_{Ab}n_{aB})^2}{(n_{AB}+n_{Ab})(n_{aB}+n_{ab})(n_{AB}+n_{aB})(n_{Ab}+n_{ab})}$$\n我们可以使用样本频率重写分子和分母。项 $n_{AB}n_{ab} - n_{Ab}n_{aB}$ 可以被证明等于 $N^2 \\hat{D}$。分母是 $N^4 \\hat{p}_A(1-\\hat{p}_A)\\hat{p}_B(1-\\hat{p}_B)$。\n将这些代入 $X^2$ 的表达式中：\n$$X^2 = \\frac{N (N^2 \\hat{D})^2}{N^4 \\hat{p}_A(1-\\hat{p}_A)\\hat{p}_B(1-\\hat{p}_B)} = \\frac{N^5 \\hat{D}^2}{N^4 \\hat{p}_A(1-\\hat{p}_A)\\hat{p}_B(1-\\hat{p}_B)} = N \\frac{\\hat{D}^2}{\\hat{p}_A(1-\\hat{p}_A)\\hat{p}_B(1-\\hat{p}_B)}$$\n这揭示了卡方统计量与样本连锁不平衡度量 $\\hat{r}^2$ 之间的直接关系：\n$$X^2 = N \\hat{r}^2$$\n在两个基因座独立的零假设下（即 $D=0$），统计量 $X^2$ 已知渐近服从自由度为1的卡方分布，记作 $\\chi^2_1$。\n\n服从 $\\chi^2_k$ 分布的随机变量的期望值为 $k$。因此，对于 $X^2$ 的渐近分布，我们有：\n$$\\mathbb{E}[X^2] = 1$$\n使用关系式 $X^2 = N \\hat{r}^2$，我们可以求得 $\\hat{r}^2$ 的近似期望：\n$$\\mathbb{E}[N \\hat{r}^2] \\approx 1$$\n$$\\implies N \\mathbb{E}[\\hat{r}^2] \\approx 1$$\n$$\\implies \\mathbb{E}[\\hat{r}^2] \\approx \\frac{1}{N}$$\n这就是 $\\mathbb{E}[\\hat{r}^2]$ 的主导阶行为。更精确的分析表明，对于有限样本，一个更好的近似是 $\\frac{1}{N-1}$，但对于大样本 $N$，$\\frac{1}{N}$ 是正确的主导阶项。\n\n现在，我们来回答提出的具体问题：\n\n1.  **对样本量（$N$）和次要等位基因频率（MAF）的依赖性**：\n    推导出的表达式 $\\mathbb{E}[\\hat{r}^2] \\approx 1/N$ 显示了对样本量 $N$ 的明确反比关系。这是抽样方差的一个基本结果。即使真实的连锁不平衡为零，任何有限的单倍型样本都会在单倍型计数上表现出随机波动，从而导致非零的样本连锁不平衡 $\\hat{D}$。这些样本估计量的方差与样本量成反比。由于 $\\mathbb{E}[\\hat{r}^2]$ 是这种抽样噪音的度量（当 $D=0$ 时），它随着 $N$ 的增加而减小。\n    $\\mathbb{E}[\\hat{r}^2]$ 的主导阶表达式明显独立于等位基因频率 $p_A$ 和 $p_B$。虽然 $\\hat{r}^2$ 本身的定义在其分母中包含依赖于等位基因频率的项 $\\hat{p}_A(1-\\hat{p}_A)\\hat{p}_B(1-\\hat{p}_B)$，但其分子 $\\mathbb{E}[\\hat{D}^2]$ 在主导阶上也与 $p_A(1-p_A)p_B(1-p_B)$ 成正比。具体来说，在 $D=0$ 的条件下，$\\hat{D}$ 的方差为 $\\text{Var}(\\hat{D}) \\approx \\frac{p_A(1-p_A)p_B(1-p_B)}{N}$。在求该比率的期望时，这些依赖于频率的项相互抵消，只留下对 $1/N$ 的依赖性。\n\n2.  **MAF 阈值 $t$ 的影响**：\n    问题规定变异是基于 MAF 阈值 $t$ 进行筛选的，使得等位基因频率满足 $p_A, p_B \\in [t, 1-t]$。如上所述，主导阶期望 $\\mathbb{E}[\\hat{r}^2] \\approx 1/N$ 独立于具体的等位基因频率 $p_A$ 和 $p_B$。因此，将分析限制在等位基因频率位于区间 $[t, 1-t]$ 内的基因座上，并不会改变期望的主导阶值。结果仍然是 $1/N$。\n    在实践中，这种筛选器的主要作用是通过避免分母极小（即当某个等位基因非常罕见时）的情况来提高 $\\hat{r}^2$ 统计量的稳定性，这反过来又使得本推导中使用的大样本近似更为准确。MAF 阈值 $t$ 本身并未出现在期望的最终表达式中。\n\n3.  **数值计算**：\n    给定一个由 $2400$ 名个体组成的队列，单倍型的数量为 $N = 2 \\times 2400 = 4800$。MAF 阈值为 $t = 0.01$。如前所述，这个阈值不影响期望值的计算。\n    使用推导出的主导阶表达式：\n    $$\\mathbb{E}[\\hat{r}^2] \\approx \\frac{1}{N} = \\frac{1}{4800}$$\n    为了用科学记数法表示并四舍五入到四位有效数字：\n    $$\\frac{1}{4800} = \\frac{1}{4.8 \\times 10^3} \\approx 0.208333... \\times 10^{-3} = 2.08333... \\times 10^{-4}$$\n    四舍五入到四位有效数字得到 $2.083 \\times 10^{-4}$。",
            "answer": "$$ \\boxed{2.083 \\times 10^{-4}} $$"
        },
        {
            "introduction": "单倍型块是具有强连锁不平衡的基因组区域，它们之间被重组“热点”隔开。这项练习介绍了一种经典方法，即四配子检验，用于识别与简单的无重组历史不相容的遗传标记对。你将在此基础上开发一种算法，以找到解释一组给定单倍型所需的最小重组事件数，从而提供一个简约的历史重建 。",
            "id": "4355722",
            "problem": "给定一个二元单倍型矩阵，代表在无限位点模型下，跨二等位单核苷酸多态性 (SNP) 位点的定相单倍型。该矩阵有 $n$ 行（单倍型）和 $m$ 列（位点），其元素为 $\\{0,1\\}$，分别表示祖先等位基因和衍生等位基因。完美系统发育模型断言，在无限位点假设下，当且仅当每对位点都是两两相容时，观测到的单倍型才能由一棵没有重组的树来解释。一个基础且广泛使用的两两相容性检验是四配子检验：如果在一对位点 $(i,j)$ 上，跨所有单倍型观测到的有序等位基因对集合包含所有四种组合 $\\{(0,0),(0,1),(1,0),(1,1)\\}$，则这对位点与完美系统发育不相容。\n\n在简约完美系统发育框架中，当存在不相容性时，通过在相邻位点之间设置重组断点来对基因组进行分段，以确保每个片段都容许一个完美系统发育（也就是说，在每个片段内，每对位点通过四配子检验都是两两相容的）。重组断点只能放置在 $m-1$ 个连续位点之间的间隙之一，这些间隙由整数 $0,1,\\dots,m-2$ 索引，其中间隙 $k$ 位于位点 $k$ 和位点 $k+1$ 之间。\n\n从以下基础出发：\n- 在无限位点模型下，两个位点上存在所有四种有序等位基因对意味着，没有任何单一的树可以在没有重组或复发突变的情况下解释这两个位点。\n- 在简约完美系统发育框架中，不允许复发突变，而重组被建模为将序列分割成片段的断点，每个片段都必须能由一个完美系统发育解释（因此，必须在片段内通过两两四配子检验）。\n\n请推导、证明并实现一个算法，该算法计算将单倍型矩阵分割成容许完美系统发育的区块所需的最少重组断点数。您的推导必须将问题简化为位点索引线上一个良构的组合优化问题，并且必须得出一个正确且可证明为最优的算法。\n\n算法的输入是一个 $n \\times m$ 的二元矩阵 $H$，输出是一个非负整数：所需的最小重组断点数。对于每一对不相容的位点 $(i,j)$（其中 $0 \\le i  j \\le m-1$），请注意，任何有效的分段都必须在间隙区间 $\\{i,i+1,\\dots,j-1\\}$ 中放置至少一个断点，否则这些位点将保留在同一片段中，从而违反完美系统发育条件。您的算法应利用这种结构来计算最小断点数。\n\n您的程序必须实现推导出的算法，并在以下单倍型矩阵测试套件上进行评估。所有矩阵均以行为单倍型、列为位点的方式指定；条目在 $\\{0,1\\}$ 中：\n\n- 测试用例 $1$（完美系统发育，预期零重组）：\n  $$H^{(1)} = \\begin{bmatrix}\n  0  0  0 \\\\\n  0  1  0 \\\\\n  1  1  0 \\\\\n  1  1  1\n  \\end{bmatrix}.$$\n\n- 测试用例 $2$（相邻不相容性，需要在每个相邻间隙处设置断点）：\n  $$H^{(2)} = \\begin{bmatrix}\n  0  0  0  0 \\\\\n  0  1  0  1 \\\\\n  1  0  1  0 \\\\\n  1  1  1  1\n  \\end{bmatrix}.$$\n\n- 测试用例 $3$（区块间的单个边界；许多不相容性都跨越同一个边界）：\n  $$H^{(3)} = \\begin{bmatrix}\n  0  0  0  0  0 \\\\\n  0  0  0  1  1 \\\\\n  1  1  1  0  0 \\\\\n  1  1  1  1  1\n  \\end{bmatrix}.$$\n\n- 测试用例 $4$（两个不相交的不相容性范围；需要至少两个断点）：\n  $$H^{(4)} = \\begin{bmatrix}\n  0  0  0  0  0  0 \\\\\n  0  0  1  0  0  1 \\\\\n  1  0  0  1  0  0 \\\\\n  1  0  1  0  0  1 \\\\\n  0  0  0  1  0  1\n  \\end{bmatrix}.$$\n\n- 测试用例 $5$（双位点四配子对；单个断点即可）：\n  $$H^{(5)} = \\begin{bmatrix}\n  0  0 \\\\\n  0  1 \\\\\n  1  0 \\\\\n  1  1\n  \\end{bmatrix}.$$\n\n输出规范：您的程序应生成单行输出，其中包含每个测试用例的最小重组断点数，按顺序排列，格式为逗号分隔的列表并用方括号括起，例如 $\\texttt{[r_1,r_2,r_3,r_4,r_5]}$，其中每个 $r_k$ 是一个整数。\n\n不涉及物理单位或角度单位。所有整数都应不带任何附加符号。程序必须是自包含的，并且不得从标准输入或任何外部文件读取输入。算法必须根据所述原理推导并忠实实现。",
            "solution": "用户提供的问题已经过分析，并被认为是有效的。它在群体遗传学方面有科学依据，作为一个组合优化问题是良构的，并且所有术语和条件都得到了清晰客观的定义。\n\n### 问题验证\n\n#### 步骤 1：提取已知条件\n\n- **输入**：一个大小为 $n \\times m$ 的二元单倍型矩阵 $H$，其中 $n$ 是单倍型数量， $m$ 是二等位 SNP 位点数量。元素为 $\\{0, 1\\}$，分别代表祖先等位基因和衍生等位基因。\n- **模型**：假设为无限位点模型，即每次突变都发生在一个新位点上，没有逆向或平行突变。\n- **完美系统发育**：一组单倍型能由一个完美系统发育（一棵没有重组的树）解释，当且仅当每对位点都是两两相容的。\n- **两两相容性检验（四配子检验）**：如果在一对位点 $(i, j)$ 上观测到的有序等位基因对集合包含所有四种组合：$\\{(0,0), (0,1), (1,0), (1,1)\\}$，则这对位点是不相容的。\n- **重组模型**：重组通过在相邻位点之间的间隙放置断点来建模。有 $m-1$ 个可能的间隙，索引为 $0, 1, \\dots, m-2$。间隙 $k$ 处的断点位于位点 $k$ 和位点 $k+1$ 之间。\n- **分段目标**：将位点序列分割成多个区块，每个区块都必须容许一个完美系统发育。这意味着在每个区块内，所有位点对都必须是两两相容的。\n- **约束**：对于任何不相容的位点对 $(i, j)$（其中 $i  j$），任何有效的分段都必须在间隙区间 $\\{i, i+1, \\dots, j-1\\}$ 中放置至少一个断点。\n- **目标**：计算实现有效分段所需的最少重组断点数。\n- **输出**：一个代表此最小数量的非负整数。\n- **测试用例**：提供了五个特定的单倍型矩阵 $H^{(1)}, \\dots, H^{(5)}$ 用于评估。\n- **输出格式**：单行 `[r_1,r_2,r_3,r_4,r_5]`，其中 $r_k$ 是测试用例 $k$ 的结果。\n\n#### 步骤 2：使用提取的已知条件进行验证\n\n- **科学依据**：该问题基于计算生物学和群体遗传学中基础且广泛使用的概念，包括无限位点模型、完美系统发育和四配子检验 (Hudson and Kaplan, 1985)。这些是分析单倍型数据和推断重组的标准理论工具。该问题在科学上是合理的。\n- **问题良定**：该问题要求在明确的约束条件下求最小断点数。这是一个定义明确的组合优化问题，保证存在唯一的最小整数值（其值至少为 $0$，至多为 $m-1$）。\n- **客观性**：问题陈述使用了正式、精确和无歧义的术语。所有定义和条件都是数学化的，没有主观解释的余地。\n- **完整性与一致性**：问题是自包含的。输入、不相容性规则、分段机制和优化目标都已明确提供，并且相互一致。\n- **现实性**：单倍型矩阵和最小化重组的问题是基因组分析中现实世界问题的简化但忠实的表示。\n\n#### 步骤 3：结论与行动\n\n该问题有效。将提供完整的推导和解决方案。\n\n### 推导与解决方案\n\n问题是要将位点集合 $\\{0, 1, \\dots, m-1\\}$ 划分为最少数量的连续区块，使得在每个区块内，所有位点对都是相容的。在间隙 $k$ 处放置一个断点会在位点 $k$ 和位点 $k+1$ 之间创建一个边界。\n\n**形式化为组合问题**\n\n设 $H$ 为给定的 $n \\times m$ 单倍型矩阵。两个位点 $i$ 和 $j$（$i  j$）之间不相容的条件是，四种配子——$(0,0), (0,1), (1,0), (1,1)$——都出现在由第 $i$ 列和第 $j$ 列构成的子矩阵的行中。如果一对位点 $(i, j)$ 不相容，它们就不能共存于同一个有效的区块中。这意味着任何有效的分段都必须在满足 $i \\le k  j-1$ 的间隙 $k$ 处放置至少一个断点。\n\n这个要求可以被构建成一个**命中集 (Hitting Set)** 问题。设点集为间隙 $P = \\{0, 1, \\dots, m-2\\}$。对于每一对不相容的位点 $(i, j)$（$i  j$），我们定义一个约束区间 $C_{ij} = [i, j-1]$。我们的目标是找到一个最小尺寸的点子集 $B \\subseteq P$（断点），使得对于每个约束区间 $C_{ij}$，交集 $B \\cap C_{ij}$ 都不为空。这是线段区间上的命中集问题，已知可以通过贪心算法在多项式时间内求解。\n\n**最优贪心算法**\n\n解决区间命中集问题的标准贪心策略如下：找到结束点最早的区间，在该结束点处放置一个点，移除所有被该点命中的区间，然后重复此过程，直到所有区间都被命中。对于我们的问题，一个等效且更直接的方法是单次从左到右扫描位点。\n\n该算法通过尝试从染色体的起始位置（或上一个断点之后的位点）开始，构建尽可能大的有效区块。\n\n1.  初始化断点数 $R$ 为 $0$。初始化当前区块的起始位点 `block_start` 为位点 $0$。\n2.  从 $1$ 到 $m-1$ 遍历位点 $j$。\n3.  对于每个位点 $j$，检查它与当前区块内所有在它之前的位点 $i$ 的相容性，其中 `block_start` $\\le i  j$。\n4.  相容性通过对矩阵 $H$ 的第 $i$ 列和第 $j$ 列进行四配子检验来测试。\n5.  如果发现一对不相容的位点 $(i, j)$，则无法将位点 $j$ 包含在从 `block_start` 开始的当前区块中。因此，当前区块必须在位点 $j-1$ 处结束。为了实现这一点，我们必须在间隙 $j-1$ 处放置一个断点。\n6.  一旦发现这样的不相容性，我们将断点计数 $R$ 加一，并在位点 $j$ 处开始一个新的区块。我们更新 `block_start` 为 $j$。然后我们可以停止检查位点 $j$ 与现已终止的区块中更早的位点，并继续处理下一个位点 $j+1$。\n7.  如果位点 $j$ 与范围 [`block_start`, $j-1$] 内的所有位点 $i$ 都相容，则区块扩展以包含位点 $j$，算法继续检查位点 $j+1$。\n\n这个过程一直持续到所有位点直到 $m-1$ 都被处理完毕。$R$ 的最终值就是所需的最少断点数。\n\n**最优性证明**\n\n设贪心算法为 $G$。假设 $G$ 在间隙 $g_1  g_2  \\dots  g_{R_G}$ 处放置了 $R_G$ 个断点。设 $O$ 是一个最优解，它在间隙 $p_1  p_2  \\dots  p_{R_O}$ 处放置了 $R_O$ 个断点。我们必须证明 $R_G = R_O$。\n\n第一个贪心断点 $g_1$ 放置在间隙 $j_1-1$ 处，其中 $j_1$ 是大于 $0$ 的最小位点索引，使得存在一对不相容的位点 $(i_1, j_1)$，满足 $0 \\le i_1  j_1$。任何有效的解决方案都必须切断区间 $[i_1, j_1-1]$，这需要在间隙区间 $[i_1, j_1-1]$ 中放置一个断点。因此，任何最优解的第一个断点 $p_1$ 必须满足 $p_1 \\le j_1-1 = g_1$。\n\n现在，归纳假设对于前 $k$ 个断点，有 $p_k \\le g_k$。让我们考虑第 $(k+1)$ 个贪心断点 $g_{k+1}$。它被放置在间隙 $j_{k+1}-1$ 处，其中 $j_{k+1}$ 是大于 $g_k+1$ 的最小位点索引，使得存在一对不相容的位点 $(i_{k+1}, j_{k+1})$，满足 $g_k+1 \\le i_{k+1}  j_{k+1}$。任何有效的解决方案都必须在间隙区间 $[i_{k+1}, j_{k+1}-1]$ 中放置一个断点。由于在 $p_k$ 之后开始的区块必须是有效的，且 $p_k \\le g_k  i_{k+1}$，解 $O$ 必须有一个断点 $p_l$ 命中该区间。在 $p_k$ 之后的第一个这样的断点是 $p_{k+1}$。因此，$p_{k+1}$ 必须在范围 $[i_{k+1}, j_{k+1}-1]$ 内，这意味着 $p_{k+1} \\le j_{k+1}-1 = g_{k+1}$。通过归纳法，对于所有 $k=1, \\dots, R_O$，都有 $p_k \\le g_k$。\n\n如果 $R_O  R_G$，考虑在间隙 $p_{R_O}$ 之后开始的区块。由于 $p_{R_O} \\le g_{R_O}$，这个区块开始于在 $g_{R_O}$ 之后开始的区块或其之前。贪心算法放置了它的第 $(R_O+1)$ 个断点 $g_{R_O+1}$，因为它发现了一对不相容的位点 $(i, j)$，其中 $g_{R_O}+1 \\le i  j$。由于 $p_{R_O} \\le g_{R_O}$，位点 $i$ 和 $j$ 都落入最优解的最后一个区块 $[p_{R_O}+1, m-1]$ 中。这与 $O$ 是一个有效解的假设相矛盾。因此，$R_O$ 不能小于 $R_G$。由于 $O$ 是一个最优解，所以 $R_O \\le R_G$。唯一可能性是 $R_O = R_G$。\n\n因此，贪心算法被证明是最优的。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements an algorithm to compute the minimum number of \n    recombination breakpoints required to segment a haplotype matrix into \n    perfect-phylogeny-admissible blocks.\n    \"\"\"\n\n    test_cases_raw = [\n        # Test Case 1 (perfect phylogeny, expect zero recombinations)\n        [[0, 0, 0], [0, 1, 0], [1, 1, 0], [1, 1, 1]],\n        # Test Case 2 (adjacent incompatibilities)\n        [[0, 0, 0, 0], [0, 1, 0, 1], [1, 0, 1, 0], [1, 1, 1, 1]],\n        # Test Case 3 (a single boundary)\n        [[0, 0, 0, 0, 0], [0, 0, 0, 1, 1], [1, 1, 1, 0, 0], [1, 1, 1, 1, 1]],\n        # Test Case 4 (two disjoint incompatibility ranges)\n        [[0, 0, 0, 0, 0, 0], [0, 0, 1, 0, 0, 1], [1, 0, 0, 1, 0, 0], [1, 0, 1, 0, 0, 1], [0, 0, 0, 1, 0, 1]],\n        # Test Case 5 (two-site four-gamete pair)\n        [[0, 0], [0, 1], [1, 0], [1, 1]],\n    ]\n    \n    test_cases = [np.array(tc, dtype=np.int8) for tc in test_cases_raw]\n\n    def are_incompatible(haplotype_matrix, site1_idx, site2_idx):\n        \"\"\"\n        Performs the four-gamete test for two sites.\n        A pair of sites is incompatible if all four possible combinations of alleles\n        (0,0), (0,1), (1,0), (1,1) are observed across the haplotypes.\n        \n        Args:\n            haplotype_matrix (np.ndarray): The n x m haplotype matrix.\n            site1_idx (int): The index of the first site (column).\n            site2_idx (int): The index of the second site (column).\n            \n        Returns:\n            bool: True if the sites are incompatible, False otherwise.\n        \"\"\"\n        gametes = set()\n        num_haplotypes = haplotype_matrix.shape[0]\n        for i in range(num_haplotypes):\n            gamete = (haplotype_matrix[i, site1_idx], haplotype_matrix[i, site2_idx])\n            gametes.add(gamete)\n        return len(gametes) == 4\n\n    def min_recombinations(H):\n        \"\"\"\n        Computes the minimum number of breakpoints using a greedy algorithm.\n        The algorithm iteratively extends a block of sites from left to right.\n        If adding a new site introduces an incompatibility with any site\n        already in the block, a breakpoint is placed and a new block starts.\n\n        Args:\n            H (np.ndarray): The n x m haplotype matrix.\n\n        Returns:\n            int: The minimum number of recombination breakpoints.\n        \"\"\"\n        n, m = H.shape\n        if m  2:\n            return 0\n\n        num_breakpoints = 0\n        block_start_site = 0\n        \n        # Iterate through each site to potentially add it to the current block\n        for j in range(1, m):\n            # Check if the new site j is compatible with all sites in the current block\n            for i in range(block_start_site, j):\n                if are_incompatible(H, i, j):\n                    # Incompatibility found. The current block MUST end at j-1.\n                    # Place a breakpoint at gap j-1.\n                    num_breakpoints += 1\n                    # Start a new block at site j.\n                    block_start_site = j\n                    # Move to the next site j+1\n                    break\n        \n        return num_breakpoints\n\n    results = []\n    for H in test_cases:\n        result = min_recombinations(H)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "大多数现代基因组分析依赖于通过计算方法进行的单倍型定相，因为通过实验确定单倍型成本高昂。因此，量化这些定相算法的准确性至关重要。本练习聚焦于“转换错误率”——一个衡量定相性能的关键指标，并指导你使用来自亲子三人组的“金标准”数据，为其推导估计量和置信区间 。",
            "id": "4355742",
            "problem": "在等位基因间存在非随机关联（即连锁不平衡）的区域中，统计定相的一个常用性能指标是已定相单倍型的转换错误率。考虑一项精准医疗和基因组诊断学的研究，该研究使用亲子三人组，为连锁不平衡块中后代的一部分连续杂合性单核苷酸多态性位点建立基准定相。假设当亲本基因型使得遗传传递明确无误时，孟德尔遗传能在该位点为后代提供正确的单倍型方向，并且无信息区间已被排除。\n\n您在所有后代中观察到，在所分析的连锁不平衡块内，共有 $13{,}640$ 个连续杂合位点对。其中，$1{,}100$ 个连续位点对对于基于遗传传递的基准来说是无信息的，因此被排除，剩下 $12{,}540$ 个有信息转换机会。将算法定相的单倍型与三人组衍生的基准进行比较，您统计到 $173$ 个实例，其中两个连续杂合位点之间的相位方向与基准不一致。\n\n仅使用基本定义和经过充分检验的统计学原理：\n- 在此背景下，精确定义已定相单倍型的转换错误率。\n- 从一个独立的、错误概率为 $p$ 的未知转换结果的伯努利模型出发，使用 $12{,}540$ 次机会和 $173$ 个观测到的错误，推导转换错误率的最大似然估计量 $\\hat{p}$。\n- 通过对二项比例的大样本得分检验（即Wilson得分区间）进行逆运算，推导 $p$ 的一个双侧 $(1-\\alpha)$ 置信区间（以符号形式表示），使用标准正态分位数 $z_{1-\\alpha/2}$。不假设任何连续性校正。\n- 最后，使用 $\\alpha = 0.05$、$z_{0.975} = 1.96$ 以及给定的计数，对您的表达式进行数值计算，并以小数形式报告最大似然估计值以及双侧 $95\\%$ 置信区间的两个端点。\n\n将报告的每个量四舍五入到四位有效数字。以单行矩阵 $\\left(\\hat{p}, L, U\\right)$ 的形式提供您的最终数值答案，其中 $\\hat{p}$ 是点估计值，$L$ 是下限，$U$ 是上限。所有量都以纯数字表示，不带单位或百分号。",
            "solution": "该问题被认为是有效的，因为它在统计遗传学方面有科学依据，问题阐述清晰，数据充分，目标明确，并且没有矛盾或含糊之处。\n\n### 1. 转换错误率的定义\n\n转换错误率是用于衡量单倍型定相算法性能的一个指标。它被定义为在两个连续的杂合位点之间，推断出的相位关系（即哪个等位基因在哪条亲本染色体上）不正确的概率 $p$。在本问题的背景下，一个转换错误的“机会”是指任何一对连续的杂合位点，其真实相位可以通过亲子三人组数据确定。转换错误率是观测到错误的此类机会所占的比例。它可以通过数据进行估计，即观测到的转换错误数 $k$ 除以有信息机会的总数 $n$。\n\n### 2. 转换错误率的最大似然估计量 (MLE)\n\n该问题为 $n$ 个有信息机会中的每一个结果指定了一个伯努利模型。设 $X_i$ 为第 $i$ 个机会的指示随机变量，其中 $i \\in \\{1, 2, \\dots, n\\}$。我们定义，如果发生转换错误，则 $X_i=1$（概率为 $p$）；如果相位正确，则 $X_i=0$（概率为 $1-p$）。假设错误是独立事件，观测到的错误总数 $k = \\sum_{i=1}^{n} X_i$ 服从二项分布，$K \\sim \\text{Binomial}(n, p)$。\n\n在 $n$ 次试验中观测到 $k$ 个错误的概率质量函数为：\n$$ P(K=k | n, p) = \\binom{n}{k} p^k (1-p)^{n-k} $$\n当将此函数视为观测数据 $(n, k)$ 下参数 $p$ 的函数时，它就是似然函数 $L(p)$：\n$$ L(p; k, n) = \\binom{n}{k} p^k (1-p)^{n-k} $$\n为了找到最大似然估计量 (MLE) $\\hat{p}$，我们需要最大化 $L(p)$。由于对数是单调函数，在计算上最大化似然函数的自然对数（即对数似然 $\\ln L(p)$）更为简单。\n$$ \\ln L(p) = \\ln\\left(\\binom{n}{k}\\right) + k \\ln(p) + (n-k) \\ln(1-p) $$\n我们通过对 $p$ 求导并令其为零来找到最大值：\n$$ \\frac{d}{dp} \\ln L(p) = \\frac{k}{p} - \\frac{n-k}{1-p} = 0 $$\n求解 $p$：\n$$ \\frac{k}{p} = \\frac{n-k}{1-p} $$\n$$ k(1-p) = p(n-k) $$\n$$ k - kp = np - kp $$\n$$ k = np $$\n因此，$p$ 的最大似然估计量为：\n$$ \\hat{p} = \\frac{k}{n} $$\n二阶导数 $\\frac{d^2}{dp^2} \\ln L(p) = -\\frac{k}{p^2} - \\frac{n-k}{(1-p)^2}$ 在 $p \\in (0,1)$ 时为负，证实该值对应于一个最大值。\n\n### 3. Wilson得分置信区间的推导\n\n$p$ 的一个双侧 $(1-\\alpha)$ 置信区间可以通过对大样本得分检验进行逆运算来推导。原假设 $H_0: p=p_0$ 的检验统计量由下式给出：\n$$ Z = \\frac{\\hat{p} - p_0}{\\sqrt{p_0(1-p_0)/n}} $$\n其中 $\\hat{p} = k/n$。置信区间是在显著性水平 $\\alpha$ 下我们不会拒绝 $H_0$ 的所有 $p_0$ 值的集合。这对应于不等式 $|Z| \\le z_{1-\\alpha/2}$，其中 $z_{1-\\alpha/2}$ 是标准正态分布的上 $(1-\\alpha/2)$ 分位数。为简便起见，我们用 $p$ 表示 $p_0$，用 $z$ 表示 $z_{1-\\alpha/2}$。\n$$ \\left| \\frac{\\hat{p} - p}{\\sqrt{p(1-p)/n}} \\right| \\le z $$\n两边平方得到：\n$$ (\\hat{p} - p)^2 \\le z^2 \\frac{p(1-p)}{n} $$\n乘以 $n$ 并展开各项，得到一个关于 $p$ 的二次不等式：\n$$ n(\\hat{p}^2 - 2\\hat{p}p + p^2) \\le z^2(p - p^2) $$\n$$ n\\hat{p}^2 - 2n\\hat{p}p + np^2 \\le z^2p - z^2p^2 $$\n将各项重新排列成标准形式 $Ap^2 + Bp + C \\le 0$：\n$$ (n+z^2)p^2 - (2n\\hat{p} + z^2)p + n\\hat{p}^2 \\le 0 $$\n相应二次方程 $(n+z^2)p^2 - (2n\\hat{p} + z^2)p + n\\hat{p}^2 = 0$ 的根即为置信区间的端点。使用二次公式 $p = \\frac{-B \\pm \\sqrt{B^2-4AC}}{2A}$，其中 $A=n+z^2$，$B=-(2n\\hat{p}+z^2)$，$C=n\\hat{p}^2$：\n$$ p = \\frac{(2n\\hat{p} + z^2) \\pm \\sqrt{(-(2n\\hat{p} + z^2))^2 - 4(n+z^2)(n\\hat{p}^2)}}{2(n+z^2)} $$\n简化判别式（平方根下的项）：\n$$ (2n\\hat{p} + z^2)^2 - 4n(n+z^2)\\hat{p}^2 = 4n^2\\hat{p}^2 + 4n\\hat{p}z^2 + z^4 - 4n^2\\hat{p}^2 - 4nz^2\\hat{p}^2 \\\\ = 4n\\hat{p}z^2 - 4nz^2\\hat{p}^2 + z^4 = z^2(4n\\hat{p}(1-\\hat{p}) + z^2) $$\n将此代回求根公式，Wilson得分区间 $(L, U)$ 的端点为：\n$$ (L, U) = \\frac{2n\\hat{p} + z^2 \\mp z\\sqrt{4n\\hat{p}(1-\\hat{p}) + z^2}}{2(n+z^2)} $$\n其中 $z=z_{1-\\alpha/2}$。\n\n### 4. 数值计算\n\n给定值为：\n- 有信息转换机会总数：$n = 12{,}540$。\n- 观测到的转换错误数：$k = 173$。\n- 显著性水平：$\\alpha = 0.05$。\n- 标准正态分位数：$z = z_{1-0.05/2} = z_{0.975} = 1.96$。\n\n首先，我们计算最大似然估计的点估计值 $\\hat{p}$：\n$$ \\hat{p} = \\frac{k}{n} = \\frac{173}{12{,}540} \\approx 0.01379585... $$\n四舍五入到四位有效数字，$\\hat{p} = 0.01380$。\n\n接下来，我们计算Wilson得分区间。我们使用推导出的公式。首先，计算必要的组成部分：\n- $z^2 = (1.96)^2 = 3.8416$。\n- $n\\hat{p} = k = 173$。\n- $2n\\hat{p} = 2k = 346$。\n- $n+z^2 = 12{,}540 + 3.8416 = 12{,}543.8416$。\n- $2(n+z^2) = 2 \\times 12{,}543.8416 = 25{,}087.6832$。\n\n现在，计算平方根下的项：\n$$ 4n\\hat{p}(1-\\hat{p}) + z^2 = 4k\\left(1 - \\frac{k}{n}\\right) + z^2 = 4(173)\\left(1 - \\frac{173}{12{,}540}\\right) + 3.8416 $$\n$$ = 692(0.9862041...) + 3.8416 \\approx 682.45327 + 3.8416 = 686.29487 $$\n平方根为 $\\sqrt{686.29487} \\approx 26.19723$。\n需要加减的项是 $z\\sqrt{...} \\approx 1.96 \\times 26.19723 \\approx 51.34657$。\n\n区间端点为：\n$$ (L, U) = \\frac{2k + z^2 \\mp z\\sqrt{4k(1-k/n) + z^2}}{2(n+z^2)} $$\n$$ (L, U) = \\frac{346 + 3.8416 \\mp 51.34657}{25{,}087.6832} = \\frac{349.8416 \\mp 51.34657}{25{,}087.6832} $$\n下限 $L$ 为：\n$$ L = \\frac{349.8416 - 51.34657}{25{,}087.6832} = \\frac{298.49503}{25{,}087.6832} \\approx 0.0118980... $$\n上限 $U$ 为：\n$$ U = \\frac{349.8416 + 51.34657}{25{,}087.6832} = \\frac{401.18817}{25{,}087.6832} \\approx 0.0159913... $$\n将结果四舍五入到四位有效数字：\n- $\\hat{p} = 0.01380$\n- $L = 0.01190$\n- $U = 0.01599$\n\n最终的数值结果是点估计值 $\\hat{p}$，置信下限 $L$ 和置信上限 $U$。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 0.01380  0.01190  0.01599 \\end{pmatrix} } $$"
        }
    ]
}