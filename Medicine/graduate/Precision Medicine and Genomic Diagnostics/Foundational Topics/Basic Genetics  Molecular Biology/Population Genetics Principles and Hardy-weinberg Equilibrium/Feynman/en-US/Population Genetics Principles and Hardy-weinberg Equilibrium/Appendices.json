{
    "hands_on_practices": [
        {
            "introduction": "One of the most direct applications of Hardy-Weinberg principles in genomics is as a quality control metric. Before using genotype data for downstream analyses, such as disease association studies or pharmacogenomics, it is essential to check whether the observed genotype frequencies in a sample align with the expectations of Hardy-Weinberg Equilibrium (HWE). This practice exercise guides you through this fundamental procedure, starting with observed genotype counts to first estimate allele frequencies and then compute the expected genotype counts under HWE, culminating in the calculation of the chi-square statistic to test for significant deviations .",
            "id": "4370688",
            "problem": "A clinical pharmacogenomics laboratory aims to validate the genotype quality for a biallelic single-nucleotide variant in a gene implicated in adverse drug reactions before using the data for precision dosing. The cohort consists of $N$ unrelated individuals of homogeneous continental ancestry who were genotyped using a Clinical Laboratory Improvement Amendments (CLIA)-validated pipeline with orthogonal confirmation for discordant calls. Let the two alleles at the locus be denoted $A$ and $a$, and suppose the observed genotype counts are $n_{AA} = 290$, $n_{Aa} = 190$, and $n_{aa} = 20$, with $N = n_{AA} + n_{Aa} + n_{aa} = 500$.\n\nUsing only core definitions and first principles from population genetics, proceed as follows:\n- Define allele frequencies $p$ for allele $A$ and $q$ for allele $a$ in terms of the observed genotype counts and $N$, and explain the relationship between $p$ and $q$ for a biallelic locus.\n- From the random union of gametes model and the assumptions underlying Hardy-Weinberg Equilibrium (HWE), derive the expected genotype frequencies in terms of $p$ and $q$ without invoking any pre-memorized formulas.\n- Compute the expected genotype counts under HWE for the given sample using your derived expressions.\n- Treat this as a goodness-of-fit problem where the allele frequency parameters are estimated from the sample, and compute the chi-square test statistic for deviation from HWE using one degree of freedom.\n\nIn your reasoning, clearly articulate the conditions under which the chi-square approximation is valid for this test in a clinical genomics context (e.g., independence, ancestry homogeneity, and minimum expected cell counts), and briefly justify the degrees of freedom used.\n\nRound your final chi-square test statistic to four significant figures. Express the final answer as a unitless real number.",
            "solution": "The first step is to define the allele frequencies from the observed genotype counts. The total number of individuals in the sample is $N = n_{AA} + n_{Aa} + n_{aa} = 290 + 190 + 20 = 500$. Since each diploid individual carries two alleles at this locus, the total number of alleles in the sample is $2N = 1000$.\n\nThe frequency of allele $A$, denoted by $p$, is the total number of $A$ alleles divided by the total number of alleles in the sample. Individuals with genotype $AA$ carry two $A$ alleles, and individuals with genotype $Aa$ carry one $A$ allele.\nThe total count of allele $A$ is $2 \\times n_{AA} + 1 \\times n_{Aa}$.\nTherefore, the frequency $p$ is:\n$$p = \\frac{2n_{AA} + n_{Aa}}{2N}$$\nSubstituting the given values:\n$$p = \\frac{2(290) + 190}{2(500)} = \\frac{580 + 190}{1000} = \\frac{770}{1000} = 0.77$$\n\nSimilarly, the frequency of allele $a$, denoted by $q$, is the total number of $a$ alleles divided by the total number of alleles. Individuals with genotype $aa$ carry two $a$ alleles, and individuals with genotype $Aa$ carry one $a$ allele.\nThe total count of allele $a$ is $1 \\times n_{Aa} + 2 \\times n_{aa}$.\nTherefore, the frequency $q$ is:\n$$q = \\frac{n_{Aa} + 2n_{aa}}{2N}$$\nSubstituting the given values:\n$$q = \\frac{190 + 2(20)}{2(500)} = \\frac{190 + 40}{1000} = \\frac{230}{1000} = 0.23$$\n\nFor a biallelic locus, there are only two possible alleles, $A$ and $a$. Thus, their frequencies must sum to $1$. This can be shown from the definitions:\n$$p + q = \\frac{2n_{AA} + n_{Aa}}{2N} + \\frac{n_{Aa} + 2n_{aa}}{2N} = \\frac{2n_{AA} + 2n_{Aa} + 2n_{aa}}{2N} = \\frac{2(n_{AA} + n_{Aa} + n_{aa})}{2N} = \\frac{2N}{2N} = 1$$\nOur calculated values are consistent with this relationship: $0.77 + 0.23 = 1.00$.\n\nNext, we derive the expected genotype frequencies under the assumptions of Hardy-Weinberg Equilibrium (HWE). HWE describes a state of genetic stability in a population under specific idealized conditions, including random mating (panmixia), a large population size, and the absence of evolutionary influences such as mutation, gene flow, and natural selection. Under random mating, which is equivalent to the random union of gametes, we can model the formation of genotypes as independent probabilistic events.\nConsider a conceptual gene pool where the gametes carrying allele $A$ are present with frequency $p$ and gametes carrying allele $a$ are present with frequency $q$. The formation of a diploid genotype is equivalent to drawing two gametes independently from this pool.\nThe probability of forming a homozygous $AA$ genotype is the probability of drawing an $A$ gamete followed by another $A$ gamete. Since these are independent events, this probability is $p \\times p = p^2$.\n$$f(AA) = p^2$$\nThe probability of forming a homozygous $aa$ genotype is the probability of drawing an $a$ gamete followed by another $a$ gamete. This probability is $q \\times q = q^2$.\n$$f(aa) = q^2$$\nA heterozygous $Aa$ genotype can be formed in two mutually exclusive ways:\n1. Drawing an $A$ gamete first, then an $a$ gamete. The probability is $p \\times q$.\n2. Drawing an $a$ gamete first, then an $A$ gamete. The probability is $q \\times p$.\nThe total probability of forming a heterozygote is the sum of these probabilities: $pq + qp = 2pq$.\n$$f(Aa) = 2pq$$\nThese are the expected genotype frequencies under HWE. The sum of these frequencies is $p^2 + 2pq + q^2 = (p+q)^2 = 1^2 = 1$, as expected.\n\nNow, we compute the expected genotype counts for the given sample of size $N=500$. The expected count for each genotype is its expected frequency multiplied by the total sample size $N$. We use the allele frequencies $p=0.77$ and $q=0.23$ estimated from the sample data.\n\nExpected count of $AA$:\n$$E_{AA} = N \\times p^2 = 500 \\times (0.77)^2 = 500 \\times 0.5929 = 296.45$$\nExpected count of $Aa$:\n$$E_{Aa} = N \\times 2pq = 500 \\times 2 \\times 0.77 \\times 0.23 = 500 \\times 0.3542 = 177.10$$\nExpected count of $aa$:\n$$E_{aa} = N \\times q^2 = 500 \\times (0.23)^2 = 500 \\times 0.0529 = 26.45$$\nThe sum of expected counts is $296.45 + 177.10 + 26.45 = 500$, which matches the sample size $N$.\n\nFinally, we compute the chi-square ($\\chi^2$) test statistic to assess the goodness-of-fit between the observed and expected counts. The formula is:\n$$\\chi^2 = \\sum_{\\text{genotypes}} \\frac{(\\text{Observed} - \\text{Expected})^2}{\\text{Expected}}$$\nThe observed counts are $O_{AA} = 290$, $O_{Aa} = 190$, and $O_{aa} = 20$.\n$$\\chi^2 = \\frac{(O_{AA} - E_{AA})^2}{E_{AA}} + \\frac{(O_{Aa} - E_{Aa})^2}{E_{Aa}} + \\frac{(O_{aa} - E_{aa})^2}{E_{aa}}$$\n$$\\chi^2 = \\frac{(290 - 296.45)^2}{296.45} + \\frac{(190 - 177.10)^2}{177.10} + \\frac{(20 - 26.45)^2}{26.45}$$\n$$\\chi^2 = \\frac{(-6.45)^2}{296.45} + \\frac{(12.9)^2}{177.10} + \\frac{(-6.45)^2}{26.45}$$\n$$\\chi^2 = \\frac{41.6025}{296.45} + \\frac{166.41}{177.10} + \\frac{41.6025}{26.45}$$\n$$\\chi^2 \\approx 0.1403359 + 0.9396386 + 1.5728733$$\n$$\\chi^2 \\approx 2.6528478$$\nRounding the result to four significant figures gives $2.653$.\n\nThe degrees of freedom for this test are justified as follows. The general formula for degrees of freedom ($df$) in a goodness-of-fit test is $df = (\\text{number of categories}) - 1 - (\\text{number of parameters estimated from the data})$. We have $3$ genotype categories ($AA$, $Aa$, $aa$). We estimated one independent parameter, the allele frequency $p$, from the data (since $q$ is determined by $p$ via $q=1-p$). Therefore, the degrees of freedom are $df = 3 - 1 - 1 = 1$.\n\nThe validity of this chi-square test in a clinical genomics context depends on several conditions being met:\n1.  **Independence of Observations**: The problem states the cohort consists of $N$ **unrelated** individuals. This is a crucial assumption for the chi-square test. Cryptic relatedness, if not accounted for, would violate this.\n2.  **Ancestry Homogeneity**: The problem specifies a cohort of **homogeneous continental ancestry**. This is critical because population admixture (stratification) is a well-known cause for significant deviations from HWE, even with perfect genotyping. Testing for HWE is a standard quality control measure to detect such issues.\n3.  **Minimum Expected Cell Counts**: The chi-square distribution is a continuous approximation to the discrete multinomial distribution of the test statistic. This approximation is valid when the expected counts are sufficiently large. A common rule of thumb is that all expected counts should be at least $5$. Here, our expected counts are $E_{AA} = 296.45$, $E_{Aa} = 177.10$, and $E_{aa} = 26.45$, all of which are well above the threshold of $5$. Therefore, the use of the chi-square approximation is justified.\n4.  **Large Sample Size**: The total sample size $N=500$ is large enough to provide a stable estimate of allele frequencies and to satisfy the assumptions underlying the chi-square test's distributional properties.\nThe context of a CLIA-validated pipeline implies high-quality genotyping, which minimizes the chance of technical artifacts (e.g., differential allelic amplification, incorrect genotype calling) being the source of deviation from HWE. Thus, a significant deviation would more likely point to a violation of population genetic assumptions, like stratification, which this test is designed to detect.",
            "answer": "$$\n\\boxed{2.653}\n$$"
        },
        {
            "introduction": "While the chi-square test assesses deviation from HWE, it's crucial to understand the potential causes of such deviations. In addition to population-level factors like stratification or inbreeding, technical artifacts are a common culprit in genomic studies. This thought experiment challenges you to model the quantitative impact of a symmetric genotyping error on observed genotype frequencies . By deriving the probabilities of observed genotypes as a function of true allele frequencies and the error rate $\\epsilon$, you will gain a deeper appreciation for how measurement error can lead to an apparent, but not biological, departure from HWE.",
            "id": "4370682",
            "problem": "A clinical genotyping pipeline for a single nucleotide polymorphism (SNP) used in drug dosing stratification is deployed across a large cohort. Let the reference allele be $A$ with population allele frequency $p$, and define $q = 1 - p$. Assume that the population is in Hardy-Weinberg Equilibrium (HWE), so that the true genotype distribution over $\\{AA, Aa, aa\\}$ is given by the HWE proportions. The genotyping platform is known to have symmetric genotyping error: conditional on the true genotype, the observed genotype equals the true state with probability $1 - 2\\epsilon$, and equals each of the other two states with probability $\\epsilon$, where $0 \\leq \\epsilon \\leq \\tfrac{1}{2}$. Using the law of total probability and the HWE proportions as the foundational base, derive the observed genotype probabilities $P_{\\mathrm{obs}}(AA)$, $P_{\\mathrm{obs}}(Aa)$, and $P_{\\mathrm{obs}}(aa)$ as functions of $p$ and $\\epsilon$. Express your final answer as a single closed-form row vector containing the three observed genotype probabilities, simplified to depend only on $p$ and $\\epsilon$. No numerical approximation is required; provide the exact symbolic expression.",
            "solution": "We are asked to derive the observed genotype probabilities under a symmetric genotyping error model, given that the true genotype frequencies follow Hardy-Weinberg Equilibrium (HWE). The true probabilities for genotypes $\\{AA, Aa, aa\\}$ are $p^2$, $2pq$, and $q^2$ respectively, where $q=1-p$. The error model states that an observation is correct with probability $1-2\\epsilon$ and is one of the two incorrect genotypes with probability $\\epsilon$.\n\nWe use the law of total probability to find the probability of each observed genotype, summing over all possible true genotypes:\n$$P_{\\mathrm{obs}}(G) = \\sum_{G_{\\mathrm{true}} \\in \\{AA, Aa, aa\\}} P(G_{\\mathrm{obs}}=G | G_{\\mathrm{true}}) P_{\\mathrm{true}}(G_{\\mathrm{true}})$$\n\n**1. Probability of observing homozygous reference, $P_{\\mathrm{obs}}(AA)$**\nAn observed $AA$ can be a true $AA$ that was correctly genotyped, a true $Aa$ that was miscalled as $AA$, or a true $aa$ that was miscalled as $AA$.\n$$P_{\\mathrm{obs}}(AA) = P(G_{\\mathrm{obs}}=AA|G_{\\mathrm{true}}=AA)P_{\\mathrm{true}}(AA) + P(G_{\\mathrm{obs}}=AA|G_{\\mathrm{true}}=Aa)P_{\\mathrm{true}}(Aa) + P(G_{\\mathrm{obs}}=AA|G_{\\mathrm{true}}=aa)P_{\\mathrm{true}}(aa)$$\nSubstituting the given probabilities:\n$$P_{\\mathrm{obs}}(AA) = (1-2\\epsilon)p^2 + (\\epsilon)(2pq) + (\\epsilon)(q^2)$$\nUsing the identity $p^2 + 2pq + q^2 = 1$:\n$$P_{\\mathrm{obs}}(AA) = p^2 - 2\\epsilon p^2 + \\epsilon(2pq + q^2) = p^2 - 2\\epsilon p^2 + \\epsilon(1 - p^2)$$\n$$P_{\\mathrm{obs}}(AA) = p^2 - 2\\epsilon p^2 + \\epsilon - \\epsilon p^2 = p^2 + \\epsilon(1 - 3p^2)$$\n$$P_{\\mathrm{obs}}(AA) = (1-3\\epsilon)p^2 + \\epsilon$$\n\n**2. Probability of observing heterozygous, $P_{\\mathrm{obs}}(Aa)$**\nAn observed $Aa$ can be a true $AA$ miscalled as $Aa$, a true $Aa$ correctly called, or a true $aa$ miscalled as $Aa$.\n$$P_{\\mathrm{obs}}(Aa) = P(G_{\\mathrm{obs}}=Aa|G_{\\mathrm{true}}=AA)P_{\\mathrm{true}}(AA) + P(G_{\\mathrm{obs}}=Aa|G_{\\mathrm{true}}=Aa)P_{\\mathrm{true}}(Aa) + P(G_{\\mathrm{obs}}=Aa|G_{\\mathrm{true}}=aa)P_{\\mathrm{true}}(aa)$$\n$$P_{\\mathrm{obs}}(Aa) = (\\epsilon)p^2 + (1-2\\epsilon)(2pq) + (\\epsilon)(q^2)$$\nUsing the identity $p^2+q^2 = 1-2pq$:\n$$P_{\\mathrm{obs}}(Aa) = 2pq - 4\\epsilon pq + \\epsilon(p^2 + q^2) = 2pq - 4\\epsilon pq + \\epsilon(1 - 2pq)$$\n$$P_{\\mathrm{obs}}(Aa) = 2pq + \\epsilon(1 - 6pq)$$\nTo express this solely in terms of $p$ and $\\epsilon$, we substitute $q=1-p$:\n$$P_{\\mathrm{obs}}(Aa) = 2p(1-p) + \\epsilon(1 - 6p(1-p)) = (2p - 2p^2) + \\epsilon(1-6p+6p^2)$$\n$$P_{\\mathrm{obs}}(Aa) = (6\\epsilon-2)p^2 + (2-6\\epsilon)p + \\epsilon$$\n\n**3. Probability of observing homozygous variant, $P_{\\mathrm{obs}}(aa)$**\nBy symmetry with the $P_{\\mathrm{obs}}(AA)$ derivation, we can replace $p$ with $q$:\n$$P_{\\mathrm{obs}}(aa) = q^2 + \\epsilon(1 - 3q^2)$$\nTo express this solely in terms of $p$ and $\\epsilon$, we substitute $q=1-p$:\n$$P_{\\mathrm{obs}}(aa) = (1-p)^2 + \\epsilon(1 - 3(1-p)^2)$$\n$$P_{\\mathrm{obs}}(aa) = (1-2p+p^2) + \\epsilon(1 - 3(1-2p+p^2))$$\n$$P_{\\mathrm{obs}}(aa) = 1-2p+p^2 + \\epsilon(1 - 3+6p-3p^2)$$\n$$P_{\\mathrm{obs}}(aa) = (1-3\\epsilon)p^2 + (6\\epsilon-2)p + (1-2\\epsilon)$$\n\nThe three derived probabilities form the final result vector. As a check, their sum is:\n$[(1-3\\epsilon)p^2 + \\epsilon] + [(6\\epsilon-2)p^2 + (2-6\\epsilon)p + \\epsilon] + [(1-3\\epsilon)p^2 + (6\\epsilon-2)p + (1-2\\epsilon)]$\n$= (1-3\\epsilon+6\\epsilon-2+1-3\\epsilon)p^2 + (2-6\\epsilon+6\\epsilon-2)p + (\\epsilon+\\epsilon+1-2\\epsilon)$\n$= 0 \\cdot p^2 + 0 \\cdot p + 1 = 1$.\nThe sum is 1, confirming the derivation.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n(1-3\\epsilon)p^2 + \\epsilon & (6\\epsilon-2)p^2 + (2-6\\epsilon)p + \\epsilon & (1-3\\epsilon)p^2 + (6\\epsilon-2)p + (1-2\\epsilon)\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The chi-square test, while widely used, relies on an approximation that can be inaccurate when genotype counts are low, a common scenario with rare variants. In such cases, a more rigorous \"exact test\" is required. This advanced practice delves into the theoretical and computational foundation of the HWE exact test, which is a cornerstone of rare variant analysis in precision medicine . You will first derive the conditional probability distribution from combinatorial principles and then implement a program to calculate the mid-$p$ value, providing a hands-on experience with the sophisticated statistical methods used to ensure data quality in modern genomic diagnostics.",
            "id": "4370711",
            "problem": "A diploid, bi-allelic locus is genotyped in a cohort used for quality control in precision medicine and genomic diagnostics. Let there be a sample of $n$ unrelated individuals from a panmictic population with no inbreeding, no genotyping error, and no selection at the locus. Under Hardy-Weinberg Equilibrium (HWE), the genotype counts follow Hardy-Weinberg proportions induced by random union of gametes. Consider the conditional exact test for HWE that fixes the observed allele counts and enumerates all possible genotype count configurations consistent with these fixed allele counts and the fixed sample size.\n\nFundamental base:\n- Random union of gametes implies that, conditional on the total count of a particular allele among the $2n$ sampled chromosomes, all pairings of the $2n$ alleles into $n$ unordered diploid genotypes are equally likely.\n- The genotype configuration is determined by the number of heterozygotes. Given a fixed count of the allele $A$, denoted $m$, and the number of heterozygotes $h$, the remaining counts of homozygotes are fully determined by conservation of alleles and individuals.\n\nDefinitions:\n- Let the observed genotype counts be $(n_{AA}, n_{Aa}, n_{aa})$ for genotypes $AA$, $Aa$, and $aa$, respectively.\n- Let $n = n_{AA} + n_{Aa} + n_{aa}$ be the sample size.\n- Let $m = 2 n_{AA} + n_{Aa}$ be the total count of allele $A$ among the $2n$ sampled chromosomes.\n- Feasible genotype configurations at fixed $(n, m)$ correspond to all integers $h$ (the number of heterozygotes) such that $h$ has the same parity as $m$ and $0 \\le h \\le \\min(m, 2n - m)$; for each feasible $h$, the implied homozygote counts are $n_{AA} = (m - h)/2$ and $n_{aa} = (2n - m - h)/2$.\n\nTask:\n- Derive from first principles the conditional probability mass function for the number of heterozygotes $h$ under Hardy-Weinberg Equilibrium (HWE), using the random union of gametes model and combinatorial counting arguments. This derivation must start from the assumption that, conditional on $m$, each pairing of the $2n$ alleles into $n$ unordered diploid genotypes is equally likely.\n- Implement a program that:\n  1. Computes $n$ and $m$ from $(n_{AA}, n_{Aa}, n_{aa})$.\n  2. Enumerates all feasible $h$ values consistent with $(n, m)$.\n  3. Computes the conditional probability $P(h \\mid n, m)$ for each feasible $h$.\n  4. Computes the mid-$p$ value for the observed configuration, defined as the sum of probabilities strictly less than the observed configuration’s probability plus one half of the observed configuration’s probability. Formally, let $p_{\\text{obs}} = P(h_{\\text{obs}} \\mid n, m)$, then the mid-$p$ value is\n     $$p_{\\text{mid}} = \\sum_{h : P(h \\mid n, m) < p_{\\text{obs}}} P(h \\mid n, m) + \\frac{1}{2} p_{\\text{obs}}.$$\n  5. Handles boundary cases robustly, including situations with a single feasible configuration (such as $m = 0$, $m = 2n$, or $n = 1$ and $m = 1$), where $p_{\\text{mid}}$ must equal $0.5$.\n\nNumerical requirements:\n- All outputs must be expressed as decimals.\n- Round each reported mid-$p$ value to exactly $12$ decimal places.\n\nTest suite:\n- Use the following test cases, given as $(n_{AA}, n_{Aa}, n_{aa})$:\n  1. $(36, 48, 16)$ with $n = 100$ and $m = 120$.\n  2. $(0, 50, 0)$ with $n = 50$ and $m = 50$.\n  3. $(30, 0, 0)$ with $n = 30$ and $m = 60$.\n  4. $(12, 1, 12)$ with $n = 25$ and $m = 25$.\n  5. $(20, 18, 2)$ with $n = 40$ and $m = 58$.\n  6. $(0, 1, 0)$ with $n = 1$ and $m = 1$.\n\nFinal output format:\n- Your program should produce a single line of output containing the mid-$p$ values for the six test cases as a comma-separated list enclosed in square brackets, with each value rounded to $12$ decimal places (e.g., $[0.123456789012,0.500000000000,0.000000000001]$). No other text should be printed.",
            "solution": "The objective is to derive the conditional probability mass function (PMF) for the number of heterozygotes, $h$, under Hardy-Weinberg Equilibrium (HWE), and then to implement an algorithm to compute the mid-$p$ value for an observed genotype configuration.\n\n### Derivation of the PMF $P(h \\mid n, m)$\n\nThe derivation proceeds from the first principles of population genetics and statistical inference as specified in the problem statement. We consider a random sample of $n$ diploid individuals from a large, randomly mating (panmictic) population. Let the two alleles at the locus be $A$ and $a$, with population frequencies $p$ and $q=1-p$, respectively.\n\n1.  **Unconditional Probability of Genotype Counts**: Under HWE, the genotypes $AA$, $Aa$, and $aa$ occur with probabilities $p^2$, $2pq$, and $q^2$. For a random sample of $n$ individuals, the counts of these genotypes $(n_{AA}, n_{Aa}, n_{aa})$ follow a multinomial distribution. Let $h = n_{Aa}$ be the number of heterozygotes. The probability of observing a specific set of genotype counts is:\n    $$ P(n_{AA}, h, n_{aa}) = \\frac{n!}{n_{AA}! h! n_{aa}!} (p^2)^{n_{AA}} (2pq)^{h} (q^2)^{n_{aa}} $$\n    This can be rearranged by grouping terms with $p$ and $q$:\n    $$ P(n_{AA}, h, n_{aa}) = \\frac{n! \\, 2^h}{n_{AA}! h! n_{aa}!} p^{2n_{AA}+h} q^{h+2n_{aa}} $$\n\n2.  **Allele Counts**: The total count of allele $A$ in the sample is $m = 2n_{AA} + h$, and the total count of allele $a$ is $2n-m = h + 2n_{aa}$. Substituting these into the expression gives:\n    $$ P(n_{AA}, h, n_{aa}) = \\frac{n! \\, 2^h}{n_{AA}! h! n_{aa}!} p^m q^{2n-m} $$\n    This is the joint probability of the genotype counts and the allele counts (since the genotype counts determine the allele counts).\n\n3.  **Conditional Distribution**: The exact test for HWE conditions on the observed allele counts $(m, 2n-m)$, thereby eliminating the unknown allele frequency $p$ as a nuisance parameter. To find the conditional probability $P(n_{AA}, h, n_{aa} \\mid n, m)$, we must divide the joint probability by the marginal probability of observing $m$ copies of allele $A$ in a sample of $2n$ alleles. This marginal probability follows a binomial distribution, as each of the $2n$ alleles in the sample can be thought of as an independent draw from the population's gene pool:\n    $$ P(m \\mid n) = \\binom{2n}{m} p^m q^{2n-m} = \\frac{(2n)!}{m!(2n-m)!} p^m q^{2n-m} $$\n\n4.  **Final PMF**: The conditional probability is the ratio $P(n_{AA}, h, n_{aa}) / P(m \\mid n)$:\n    $$ P(h \\mid n, m) = \\frac{\\frac{n! \\, 2^h}{n_{AA}! h! n_{aa}!} p^m q^{2n-m}}{\\frac{(2n)!}{m!(2n-m)!} p^m q^{2n-m}} $$\n    The terms involving $p$ and $q$ cancel, yielding a distribution that depends only on the counts $n, m,$ and $h$:\n    $$ P(h \\mid n, m) = \\frac{n! \\, 2^h}{n_{AA}! h! n_{aa}!} \\frac{m!(2n-m)!}{(2n)!} $$\n    Given $n$ and $m$, the homozygote counts are functions of $h$: $n_{AA} = (m-h)/2$ and $n_{aa} = (2n-m-h)/2$. Substituting these gives the final PMF for $h$:\n    $$ P(h \\mid n, m) = \\frac{n! \\, m! \\, (2n-m)! \\, 2^h}{(2n)! \\, h! \\, ((m-h)/2)! \\, ((2n-m-h)/2)!} $$\n    This distribution is defined for all feasible integer values of $h$, which are those having the same parity as $m$ and satisfying $0 \\le h \\le \\min(m, 2n-m)$. This formula is the desired result derived from first principles. It corresponds to a specific case of the multivariate hypergeometric distribution and formalizes the combinatorial argument of counting the number of ways to pair $m$ 'A' alleles and $2n-m$ 'a' alleles into $n$ genotypes.\n\n### Algorithm for Mid-$p$ Value Computation\n\nThe program implements the following steps for each test case $(n_{AA,obs}, n_{Aa,obs}, n_{aa,obs})$:\n```python\nimport numpy as np\nfrom scipy.special import gammaln\n\ndef calculate_mid_p(n_AA_obs, n_Aa_obs, n_aa_obs):\n    \"\"\"\n    Computes the mid-p value for the Hardy-Weinberg Equilibrium exact test.\n    \"\"\"\n    n = n_AA_obs + n_Aa_obs + n_aa_obs\n    if n == 0:\n        return 0.5  # A reasonable default for an empty sample\n\n    m = 2 * n_AA_obs + n_Aa_obs\n    h_obs = n_Aa_obs\n\n    # Enumerate all feasible heterozygote counts (h)\n    h_min = m % 2\n    h_max = min(m, 2 * n - m)\n    feasible_h = list(range(h_min, h_max + 1, 2))\n\n    # If there is only one possible configuration, the mid-p-value is 0.5\n    if len(feasible_h) = 1:\n        return 0.5\n\n    # Compute log-probabilities for each feasible h to avoid numerical overflow/underflow\n    log_probs = {}\n    \n    # Constant part of the log-probability formula: log( n! m! (2n-m)! / (2n)! )\n    log_constant = (gammaln(n + 1) + gammaln(m + 1) + \n                    gammaln(2 * n - m + 1) - gammaln(2 * n + 1))\n    \n    for h in feasible_h:\n        # Implied homozygote counts\n        n_AA = (m - h) // 2\n        n_aa = (2 * n - m - h) // 2\n        \n        # Variable part of the log-probability: log( 2^h / (h! n_AA! n_aa!) )\n        log_variable_part = h * np.log(2) - (gammaln(h + 1) + \n                                             gammaln(n_AA + 1) + \n                                             gammaln(n_aa + 1))\n        \n        log_probs[h] = log_constant + log_variable_part\n\n    # Normalize probabilities to ensure numerical stability\n    max_log_prob = max(log_probs.values())\n    probs = {h: np.exp(lp - max_log_prob) for h, lp in log_probs.items()}\n    sum_of_probs = sum(probs.values())\n    probs = {h: p / sum_of_probs for h, p in probs.items()}\n    \n    p_obs = probs[h_obs]\n    \n    # Use a small tolerance for floating-point comparisons\n    tolerance = 1e-15 \n    sum_less = 0.0\n    sum_equal = 0.0\n    \n    for p in probs.values():\n        if p  p_obs - tolerance:\n            sum_less += p\n        elif abs(p - p_obs)  tolerance:\n            sum_equal += p\n            \n    p_mid = sum_less + 0.5 * sum_equal\n    \n    return p_mid\n```",
            "answer": "[0.960213161354,0.000000000067,0.500000000000,0.083333333333,0.540455850935,0.500000000000]"
        }
    ]
}