{
    "hands_on_practices": [
        {
            "introduction": "使用多基因风险评分（PRS）的第一步是理解其构建过程。本练习将指导您完成应用广泛的“聚类和阈值”（P+T）方法，这是一种利用全基因组关联研究（GWAS）摘要统计数据构建PRS的基础技术。通过根据统计显著性和连锁不平衡手动筛选遗传变异，您将亲身体验支撑大多数PRS模型的核心逻辑。",
            "id": "4326863",
            "problem": "在多基因风险建模中，一个核心定义是个体的多基因风险评分（PRS）是根据选定的单核苷酸多态性（SNPs）计算的基因型剂量的加权总和，其中的权重是从全基因组关联研究（GWAS）中获得的等位基因效应值。形式上，对于选定集合 $\\mathcal{J}$ 中由 $j$ 索引的 SNPs，原始 PRS 为 $S=\\sum_{j\\in\\mathcal{J}}\\hat{\\beta}_{j}G_{j}$，其中 $\\hat{\\beta}_{j}$ 是 GWAS 效应值（例如，每个等位基因的对数比值或标准化回归系数），而 $G_{j}\\in\\{0,1,2\\}$ 是个体风险增加等位基因的基因型剂量。在广泛使用的簇集和阈值法（通常称为 $P+T$）中，SNP 的选择过程是：(i) 对 GWAS 汇总统计数据应用 $p$ 值阈值，然后 (ii) 通过剪枝解决局部连锁不平衡（LD），使得保留的 SNPs 之间的成对 LD 低于指定阈值，该阈值通常用两个位点等位基因之间的相关系数平方 $r^{2}$ 来衡量。\n\n考虑一个包含 $10$ 个 SNPs 的玩具位点集，标记为 $s_{1},\\dots,s_{10}$。给定以下 GWAS 的 $p$ 值、等位基因效应值 $\\hat{\\beta}_{j}$ 以及单个个体的基因型剂量 $G_{j}$：\n- $p$ 值：$p_{1}=1.0\\times 10^{-8}$, $p_{2}=2.0\\times 10^{-7}$, $p_{3}=1.0\\times 10^{-5}$, $p_{4}=4.0\\times 10^{-6}$, $p_{5}=3.0\\times 10^{-5}$, $p_{6}=4.0\\times 10^{-7}$, $p_{7}=2.0\\times 10^{-6}$, $p_{8}=7.0\\times 10^{-6}$, $p_{9}=4.0\\times 10^{-9}$, $p_{10}=1.0\\times 10^{-4}$。\n- 效应值：$\\hat{\\beta}_{1}=0.12$, $\\hat{\\beta}_{2}=0.08$, $\\hat{\\beta}_{3}=-0.05$, $\\hat{\\beta}_{4}=0.04$, $\\hat{\\beta}_{5}=0.02$, $\\hat{\\beta}_{6}=0.09$, $\\hat{\\beta}_{7}=0.06$, $\\hat{\\beta}_{8}=-0.03$, $\\hat{\\beta}_{9}=0.11$, $\\hat{\\beta}_{10}=-0.01$。\n- 个体基因型（剂量）：$G_{1}=2$, $G_{2}=1$, $G_{3}=0$, $G_{4}=2$, $G_{5}=1$, $G_{6}=0$, $G_{7}=2$, $G_{8}=1$, $G_{9}=1$, $G_{10}=2$。\n\n成对 LD 由无序 SNP 对之间的 $r^{2}$ 概括。以下 SNP 对具有非默认的 LD 值：\n- 区块 1 LD：$r^{2}(s_{1},s_{2})=0.35$, $r^{2}(s_{1},s_{4})=0.12$, $r^{2}(s_{2},s_{4})=0.08$。\n- 区块 2 LD：$r^{2}(s_{6},s_{7})=0.15$, $r^{2}(s_{6},s_{8})=0.11$, $r^{2}(s_{7},s_{8})=0.09$。\n- 区块 3 LD：$r^{2}(s_{3},s_{5})=0.20$, $r^{2}(s_{3},s_{10})=0.05$, $r^{2}(s_{5},s_{10})=0.14$。\n对于上面未列出的所有其他无序对 $(s_{i},s_{j})$，取 $r^{2}(s_{i},s_{j})=0.04$。\n\n使用 $P+T$ 程序，GWAS $p$ 值阈值为 $p  5\\times 10^{-6}$，LD 剪枝保留与已选 SNPs 的成对 $r^{2}$ 严格小于 $0.1$ 的 SNPs，通过以下明确的簇集规则构建选定的 SNP 集合：在通过 $p$ 值阈值的 SNPs 中，按 $p$ 值升序排列；遍历此有序列表，当一个 SNP 被选中时，排除任何剩余的、与所选 SNP 的 $r^{2}$ 大于或等于 $0.1$ 的 SNP。继续此过程，直到有序列表耗尽。然后，为给定个体计算得到的原始 PRS $S=\\sum_{j\\in\\mathcal{J}}\\hat{\\beta}_{j}G_{j}$。将最终的 PRS 表示为一个无单位的数字，并将您的答案四舍五入到四位有效数字。",
            "solution": "首先对问题陈述进行严格的验证过程。\n\n### 步骤 1：提取给定信息\n- **PRS 公式**：原始多基因风险评分 (PRS) 为 $S=\\sum_{j\\in\\mathcal{J}}\\hat{\\beta}_{j}G_{j}$，其中 $\\mathcal{J}$ 是选定的单核苷酸多态性 (SNPs) 的集合，$\\hat{\\beta}_{j}$ 是效应值，而 $G_{j}$ 是基因型剂量。\n- **SNPs**：一组 $10$ 个 SNPs，索引为 $j=1, \\dots, 10$。\n- **GWAS $p$ 值**：$p_{1}=1.0\\times 10^{-8}$, $p_{2}=2.0\\times 10^{-7}$, $p_{3}=1.0\\times 10^{-5}$, $p_{4}=4.0\\times 10^{-6}$, $p_{5}=3.0\\times 10^{-5}$, $p_{6}=4.0\\times 10^{-7}$, $p_{7}=2.0\\times 10^{-6}$, $p_{8}=7.0\\times 10^{-6}$, $p_{9}=4.0\\times 10^{-9}$, $p_{10}=1.0\\times 10^{-4}$。\n- **效应值 ($\\hat{\\beta}_{j}$)**：$\\hat{\\beta}_{1}=0.12$, $\\hat{\\beta}_{2}=0.08$, $\\hat{\\beta}_{3}=-0.05$, $\\hat{\\beta}_{4}=0.04$, $\\hat{\\beta}_{5}=0.02$, $\\hat{\\beta}_{6}=0.09$, $\\hat{\\beta}_{7}=0.06$, $\\hat{\\beta}_{8}=-0.03$, $\\hat{\\beta}_{9}=0.11$, $\\hat{\\beta}_{10}=-0.01$。\n- **个体基因型 ($G_{j}$)**：$G_{1}=2$, $G_{2}=1$, $G_{3}=0$, $G_{4}=2$, $G_{5}=1$, $G_{6}=0$, $G_{7}=2$, $G_{8}=1$, $G_{9}=1$, $G_{10}=2$。\n- **连锁不平衡 ($r^{2}$)**：\n  - $r^{2}(s_{1},s_{2})=0.35$\n  - $r^{2}(s_{1},s_{4})=0.12$\n  - $r^{2}(s_{2},s_{4})=0.08$\n  - $r^{2}(s_{6},s_{7})=0.15$\n  - $r^{2}(s_{6},s_{8})=0.11$\n  - $r^{2}(s_{7},s_{8})=0.09$\n  - $r^{2}(s_{3},s_{5})=0.20$\n  - $r^{2}(s_{3},s_{10})=0.05$\n  - $r^{2}(s_{5},s_{10})=0.14$\n  - 所有其他成对 $r^{2}$ 值为 $0.04$。\n- **$P+T$ 程序参数**：\n  - $p$ 值阈值：$p  5\\times 10^{-6}$。\n  - LD 剪枝阈值：$r^{2}  0.1$。\n- **簇集规则**：通过 $p$ 值阈值筛选 SNPs，按 $p$ 值升序排列，然后迭代：选择一个索引 SNP，并剪掉任何与该索引 SNP 的 $r^{2} \\ge 0.1$ 的剩余 SNPs。\n- **任务**：计算原始 PRS，$S$，并四舍五入到四位有效数字。\n\n### 步骤 2：使用提取的给定信息进行验证\n该问题具有科学依据，描述了用于构建 PRS 的标准簇集和阈值法（$P+T$），这是统计遗传学中的一项基石技术。所有的定义和参数——$p$ 值、效应值、基因型剂量（$G_j \\in \\{0, 1, 2\\}$）和连锁不平衡（$r^2$）——都是标准的，并且具有合理的值。问题提法得当且内容自洽；所有必要的数据和用于 SNP 选择的确定性、无歧义的算法都已提供，确保了唯一解。语言客观、精确。该问题没有违反任何有效性标准。\n\n### 步骤 3：结论与行动\n问题有效，可以按陈述求解。\n\n### 解\n多基因风险评分（PRS）的计算分两个主要阶段进行：首先，使用指定的簇集和阈值法（$P+T$）程序选择相关 SNPs 的集合 $\\mathcal{J}$；其次，计算加权总和 $S = \\sum_{j\\in\\mathcal{J}}\\hat{\\beta}_{j}G_{j}$。\n\n**阶段 1：使用 $P+T$ 程序进行 SNP 选择**\n\n该程序包括一个 $p$ 值阈值设定步骤，之后是一个连锁不平衡（LD）剪枝（或簇集）步骤。\n\n**步骤 (i)：$p$ 值阈值设定**\n我们首先识别出所有 GWAS $p$ 值严格小于阈值 $5\\times 10^{-6}$ 的 SNPs。我们检查每个 SNP：\n- $s_{1}: p_{1}=1.0\\times 10^{-8}  5\\times 10^{-6}$ (通过)\n- $s_{2}: p_{2}=2.0\\times 10^{-7}  5\\times 10^{-6}$ (通过)\n- $s_{3}: p_{3}=1.0\\times 10^{-5} \\ge 5\\times 10^{-6}$ (未通过)\n- $s_{4}: p_{4}=4.0\\times 10^{-6}  5\\times 10^{-6}$ (通过)\n- $s_{5}: p_{5}=3.0\\times 10^{-5} \\ge 5\\times 10^{-6}$ (未通过)\n- $s_{6}: p_{6}=4.0\\times 10^{-7}  5\\times 10^{-6}$ (通过)\n- $s_{7}: p_{7}=2.0\\times 10^{-6}  5\\times 10^{-6}$ (通过)\n- $s_{8}: p_{8}=7.0\\times 10^{-6} \\ge 5\\times 10^{-6}$ (未通过)\n- $s_{9}: p_{9}=4.0\\times 10^{-9}  5\\times 10^{-6}$ (通过)\n- $s_{10}: p_{10}=1.0\\times 10^{-4} \\ge 5\\times 10^{-6}$ (未通过)\n\n通过此筛选的 SNPs 集合，我们称之为候选集 $\\mathcal{C}$，是 $\\mathcal{C} = \\{s_{1}, s_{2}, s_{4}, s_{6}, s_{7}, s_{9}\\}$。\n\n**步骤 (ii)：LD 簇集**\n簇集算法要求将 $\\mathcal{C}$ 中的 SNPs 按其 $p$ 值升序排列。\n候选 SNPs 的 $p$ 值为：\n- $p_{9} = 4.0\\times 10^{-9}$\n- $p_{1} = 1.0\\times 10^{-8}$\n- $p_{2} = 2.0\\times 10^{-7}$\n- $p_{6} = 4.0\\times 10^{-7}$\n- $p_{7} = 2.0\\times 10^{-6}$\n- $p_{4} = 4.0\\times 10^{-6}$\n\n要遍历的候选者有序列表是 $(s_{9}, s_{1}, s_{2}, s_{6}, s_{7}, s_{4})$。设 $\\mathcal{J}$ 为最终选定的 SNPs 集合，初始化为空。剪枝规则是，如果任何剩余的候选 SNP $s_k$ 与当前索引 SNP $s_i$ 的 LD 满足 $r^{2}(s_i, s_k) \\ge 0.1$，则丢弃该 SNP $s_k$。\n\n**迭代 1：**\n- 索引 SNP：$s_{9}$（最显著的 SNP）。它被添加到选择集中：$\\mathcal{J}=\\{s_{9}\\}$。\n- 我们检查剩余的候选者 $(s_{1}, s_{2}, s_{6}, s_{7}, s_{4})$ 与 $s_{9}$ 的 LD。除非特别说明，LD 为 $r^2=0.04$。\n  - $r^{2}(s_{9}, s_{1}) = 0.04  0.1$。$s_{1}$ 被保留。\n  - $r^{2}(s_{9}, s_{2}) = 0.04  0.1$。$s_{2}$ 被保留。\n  - $r^{2}(s_{9}, s_{6}) = 0.04  0.1$。$s_{6}$ 被保留。\n  - $r^{2}(s_{9}, s_{7}) = 0.04  0.1$。$s_{7}$ 被保留。\n  - $r^{2}(s_{9}, s_{4}) = 0.04  0.1$。$s_{4}$ 被保留。\n- 剩余候选者列表保持不变：$(s_{1}, s_{2}, s_{6}, s_{7}, s_{4})$。\n\n**迭代 2：**\n- 索引 SNP：$s_{1}$（有序列表中的下一个 SNP）。它被添加到选择集中：$\\mathcal{J}=\\{s_{9}, s_{1}\\}$。\n- 我们检查剩余的候选者 $(s_{2}, s_{6}, s_{7}, s_{4})$ 与 $s_{1}$ 的 LD。\n  - $r^{2}(s_{1}, s_{2}) = 0.35 \\ge 0.1$。$s_{2}$ 从列表中被剪除。\n  - $r^{2}(s_{1}, s_{6}) = 0.04  0.1$。$s_{6}$ 被保留。\n  - $r^{2}(s_{1}, s_{7}) = 0.04  0.1$。$s_{7}$ 被保留。\n  - $r^{2}(s_{1}, s_{4}) = 0.12 \\ge 0.1$。$s_{4}$ 从列表中被剪除。\n- 剩余候选者列表现在是 $(s_{6}, s_{7})$。\n\n**迭代 3：**\n- 索引 SNP：$s_{6}$。它被添加到选择集中：$\\mathcal{J}=\\{s_{9}, s_{1}, s_{6}\\}$。\n- 我们检查唯一剩下的候选者 $(s_{7})$ 与 $s_{6}$ 的 LD。\n  - $r^{2}(s_{6}, s_{7}) = 0.15 \\ge 0.1$。$s_{7}$ 从列表中被剪除。\n- 剩余候选者列表现在为空。\n\n由于候选列表已耗尽，算法终止。最终选定的 SNPs 集合是 $\\mathcal{J} = \\{s_{1}, s_{6}, s_{9}\\}$。\n\n**阶段 2：PRS 计算**\n\n原始 PRS, $S$，使用公式 $S=\\sum_{j\\in\\mathcal{J}}\\hat{\\beta}_{j}G_{j}$ 对选定的 SNPs $\\mathcal{J}=\\{1, 6, 9\\}$ 进行计算。\n$$S = \\hat{\\beta}_{1}G_{1} + \\hat{\\beta}_{6}G_{6} + \\hat{\\beta}_{9}G_{9}$$\n我们将这三个 SNPs 的给定效应值（$\\hat{\\beta}_{j}$）和基因型剂量（$G_{j}$）代入：\n- 对于 $j=1$：$\\hat{\\beta}_{1}=0.12$, $G_{1}=2$\n- 对于 $j=6$：$\\hat{\\beta}_{6}=0.09$, $G_{6}=0$\n- 对于 $j=9$：$\\hat{\\beta}_{9}=0.11$, $G_{9}=1$\n\n计算过程如下：\n$$S = (0.12 \\times 2) + (0.09 \\times 0) + (0.11 \\times 1)$$\n$$S = 0.24 + 0 + 0.11$$\n$$S = 0.35$$\n问题要求答案四舍五入到四位有效数字。计算出的值 $0.35$ 有两位有效数字。为了用四位有效数字表示，我们添加后缀零。\n$$S = 0.3500$$",
            "answer": "$$\\boxed{0.3500}$$"
        },
        {
            "introduction": "构建PRS后，我们必须评估其区分将要患病个体和不会患病个体的能力。本练习探讨受试者工作特征曲线下面积（AUC），这是评估PRS区分准确性的关键指标。通过从病例组和对照组的评分分布推导理论AUC，您将把统计理论与模型性能的实际衡量标准联系起来。",
            "id": "4326807",
            "problem": "一项生物样本库研究使用受试者工作特征曲线下面积 (AUC) 来评估多基因风险评分 (PRS) 对二元疾病结局的分类性能。根据设计，PRS 在祖源分层内进行了标准化，并且该研究使用了独立的训练队列和测试队列。在目标人群中，病例组和对照组的 PRS 分布近似为具有共同标准差的高斯分布。具体来说，假设病例的 PRS 分布为 $S_{1} \\sim \\mathcal{N}(\\mu_{1}, \\sigma^{2})$，对照的 PRS 分布为 $S_{0} \\sim \\mathcal{N}(\\mu_{0}, \\sigma^{2})$，且 $S_{1}$ 和 $S_{0}$ 相互独立。AUC 定义为随机抽样的病例比随机抽样的对照具有更高 PRS 的概率，即 $\\text{AUC} = \\mathbb{P}(S_{1}  S_{0})$。\n\n使用此定义以及高斯随机变量和标准正态累积分布函数的标准性质，为参数值 $\\mu_{1} = 0.4$、$\\mu_{0} = 0.0$ 和 $\\sigma = 0.2$（所有数值均为无量纲）计算模型隐含的 AUC。在一个外部验证数据集中，经验观测到的 AUC 为 $\\text{AUC}_{\\text{emp}} = 0.88$。\n\n报告模型隐含的 AUC 和经验 AUC 之间的绝对偏差，定义为 $D = |\\text{AUC}_{\\text{model}} - \\text{AUC}_{\\text{emp}}|$。将您的最终答案表示为不带百分号的小数，并四舍五入到四位有效数字。",
            "solution": "该问题要求计算模型隐含的受试者工作特征曲线下面积 ($\\text{AUC}_{\\text{model}}$) 与经验观测值 ($\\text{AUC}_{\\text{emp}}$) 之间的绝对偏差。第一步是根据给定的分布假设推导并计算 $\\text{AUC}_{\\text{model}}$。\n\n问题指出，病例的多基因风险评分 (PRS) $S_{1}$ 服从正态分布 $S_{1} \\sim \\mathcal{N}(\\mu_{1}, \\sigma^{2})$，而对照的 PRS $S_{0}$ 服从正态分布 $S_{0} \\sim \\mathcal{N}(\\mu_{0}, \\sigma^{2})$。变量 $S_{1}$ 和 $S_{0}$ 被假定为独立的。\n\n$\\text{AUC}$ 定义为随机抽样的病例比随机抽样的对照具有更高 PRS 的概率。这可以写成：\n$$\n\\text{AUC}_{\\text{model}} = \\mathbb{P}(S_{1} > S_{0})\n$$\n这等价于求两个分数之差为正的概率，即 $\\mathbb{P}(S_{1} - S_{0} > 0)$。\n\n我们定义一个新的随机变量 $Y = S_{1} - S_{0}$。由于 $S_{1}$ 和 $S_{0}$ 是独立的高斯随机变量，它们的差 $Y$ 也是一个高斯随机变量。我们可以确定这个新分布的参数。\n\n$Y$ 的均值是各自均值的差：\n$$\n\\mathbb{E}[Y] = \\mathbb{E}[S_{1} - S_{0}] = \\mathbb{E}[S_{1}] - \\mathbb{E}[S_{0}] = \\mu_{1} - \\mu_{0}\n$$\n由于 $S_{1}$ 和 $S_{0}$ 的独立性，$Y$ 的方差是各自方差的和：\n$$\n\\mathrm{Var}(Y) = \\mathrm{Var}(S_{1} - S_{0}) = \\mathrm{Var}(S_{1}) + (-1)^{2}\\mathrm{Var}(S_{0}) = \\mathrm{Var}(S_{1}) + \\mathrm{Var}(S_{0}) = \\sigma^{2} + \\sigma^{2} = 2\\sigma^{2}\n$$\n所以，差的分布为 $Y \\sim \\mathcal{N}(\\mu_{1} - \\mu_{0}, 2\\sigma^{2})$。\n\n我们需要计算 $\\mathbb{P}(Y > 0)$。为此，我们将 $Y$ 标准化以获得一个标准正态变量 $Z \\sim \\mathcal{N}(0, 1)$，使用以下变换：\n$$\nZ = \\frac{Y - \\mathbb{E}[Y]}{\\sqrt{\\mathrm{Var}(Y)}} = \\frac{Y - (\\mu_{1} - \\mu_{0})}{\\sqrt{2\\sigma^{2}}} = \\frac{Y - (\\mu_{1} - \\mu_{0})}{\\sigma\\sqrt{2}}\n$$\n我们现在可以用 $Z$ 来重写这个概率：\n$$\n\\mathbb{P}(Y > 0) = \\mathbb{P}\\left(\\frac{Y - (\\mu_{1} - \\mu_{0})}{\\sigma\\sqrt{2}} > \\frac{0 - (\\mu_{1} - \\mu_{0})}{\\sigma\\sqrt{2}}\\right) = \\mathbb{P}\\left(Z > -\\frac{\\mu_{1} - \\mu_{0}}{\\sigma\\sqrt{2}}\\right)\n$$\n设 $\\Phi(z)$ 为标准正态分布的累积分布函数 (CDF)，$\\Phi(z) = \\mathbb{P}(Z \\le z)$。该概率可以表示为：\n$$\n\\mathbb{P}\\left(Z > -\\frac{\\mu_{1} - \\mu_{0}}{\\sigma\\sqrt{2}}\\right) = 1 - \\Phi\\left(-\\frac{\\mu_{1} - \\mu_{0}}{\\sigma\\sqrt{2}}\\right)\n$$\n利用标准正态 CDF 的对称性 $\\Phi(-z) = 1 - \\Phi(z)$，我们可以重写该表达式：\n$$\n1 - \\Phi\\left(-\\frac{\\mu_{1} - \\mu_{0}}{\\sigma\\sqrt{2}}\\right) = 1 - \\left(1 - \\Phi\\left(\\frac{\\mu_{1} - \\mu_{0}}{\\sigma\\sqrt{2}}\\right)\\right) = \\Phi\\left(\\frac{\\mu_{1} - \\mu_{0}}{\\sigma\\sqrt{2}}\\right)\n$$\n因此，模型隐含的 $\\text{AUC}$ 的通用公式为：\n$$\n\\text{AUC}_{\\text{model}} = \\Phi\\left(\\frac{\\mu_{1} - \\mu_{0}}{\\sigma\\sqrt{2}}\\right)\n$$\n给定的参数值为 $\\mu_{1} = 0.4$, $\\mu_{0} = 0.0$, 和 $\\sigma = 0.2$。将这些值代入公式：\n$$\n\\text{AUC}_{\\text{model}} = \\Phi\\left(\\frac{0.4 - 0.0}{0.2 \\times \\sqrt{2}}\\right) = \\Phi\\left(\\frac{0.4}{0.2\\sqrt{2}}\\right) = \\Phi\\left(\\frac{2}{\\sqrt{2}}\\right) = \\Phi(\\sqrt{2})\n$$\n$\\sqrt{2}$ 的数值约为 $1.41421356...$。标准正态 CDF 在此点的值为：\n$$\n\\text{AUC}_{\\text{model}} \\approx \\Phi(1.41421356) \\approx 0.92135043\n$$\n问题指出，经验观测值为 $\\text{AUC}_{\\text{emp}} = 0.88$。我们需要求绝对偏差 $D$：\n$$\nD = |\\text{AUC}_{\\text{model}} - \\text{AUC}_{\\text{emp}}|\n$$\n代入数值：\n$$\nD = |0.92135043... - 0.88| = |0.04135043...| = 0.04135043...\n$$\n最终答案必须四舍五入到四位有效数字。$0.04135043...$ 的前四位有效数字是 $4$、$1$、$3$ 和 $5$。随后的数字是 $0$，这意味着我们不对最后一位有效数字进行进位。\n$$\nD \\approx 0.04135\n$$",
            "answer": "$$\\boxed{0.04135}$$"
        },
        {
            "introduction": "在临床上部署PRS模型的一个主要挑战是确保其得到良好校准，即其预测的风险与观察到的结果一致。最后一个练习展示了模型误校准的实际后果以及校准过程对临床决策的影响。通过分析校正一个校准不良的模型如何改变一组患者的治疗建议，您将体会到为什么校准对于PRS的负责任临床实施至关重要。",
            "id": "4326812",
            "problem": "在精准医疗中，多基因风险评分（PRS）可为常见疾病生成个性化的绝对风险预测，为基于阈值的预防性治疗决策提供信息。一个基于PRS的风险模型被部署在临床环境中，共有 $N = 2000$ 名患者，根据他们当前预测的 $5$ 年绝对风险 $p_{i}$ 和各层人数 $n_{i}$ 分为五个层：第 $1$ 层有 $n_{1} = 800$ 人，其 $p_{1} = 0.05$；第 $2$ 层有 $n_{2} = 400$ 人，其 $p_{2} = 0.08$；第 $3$ 层有 $n_{3} = 300$ 人，其 $p_{3} = 0.12$；第 $4$ 层有 $n_{4} = 300$ 人，其 $p_{4} = 0.18$；第 $5$ 层有 $n_{5} = 200$ 人，其 $p_{5} = 0.30$。当前的临床决策规则是为预测风险达到或超过 $0.10$ 阈值的患者提供预防性治疗。\n\n后续评估揭示了模型存在校准不良（miscalibration），其特征为在对数优势（log-odds）尺度上的校准斜率为 $0.6$。为了纠正这一点，模型在对数优势尺度上进行了重新校准（“整体校准”加上斜率调整），使得重新校准后的平均预测风险等于观测到的事件患病率 $\\pi_{\\text{obs}} = 0.12$。为解决此问题，应理解为重新校准作用于风险的logit值，其中logit函数定义为 $\\operatorname{logit}(p) = \\ln\\!\\big(p/(1-p)\\big)$，其逆函数（逻辑斯谛函数）为 $\\operatorname{logit}^{-1}(z) = \\frac{1}{1+\\exp(-z)}$。\n\n仅根据这些定义和所提供的数据，通过计算重新校准后预测风险达到或超过 $0.10$ 的患者数量与重新校准前相比的变化，来确定重新校准如何改变治疗决策。请以患者人数的整数形式提供最终的数量差。无需按有效数字进行四舍五入。答案必须是单个整数。",
            "solution": "任务是确定因模型重新校准而导致的接受预防性治疗的患者数量的变化。这个变化等于重新校准后接受治疗的患者人数减去重新校准前接受治疗的患者人数。\n\n首先，我们确定*重新校准前*接受治疗的患者人数。临床决策规则是为预测风险 $p \\ge 0.10$ 的患者提供治疗。五个分层的初始预测风险分别为 $p_{1} = 0.05$、$p_{2} = 0.08$、$p_{3} = 0.12$、$p_{4} = 0.18$ 和 $p_{5} = 0.30$。\n\n- 第1层：$p_{1} = 0.05  0.10$。患者不接受治疗。\n- 第2层：$p_{2} = 0.08  0.10$。患者不接受治疗。\n- 第3层：$p_{3} = 0.12 \\ge 0.10$。患者接受治疗。\n- 第4层：$p_{4} = 0.18 \\ge 0.10$。患者接受治疗。\n- 第5层：$p_{5} = 0.30 \\ge 0.10$。患者接受治疗。\n\n重新校准前接受治疗的患者人数 $N_{\\text{before}}$ 是接受治疗的各层人数之和：\n$N_{\\text{before}} = n_{3} + n_{4} + n_{5} = 300 + 300 + 200 = 800$。\n\n接下来，我们分析重新校准过程，以确定*重新校准后*接受治疗的患者人数 $N_{\\text{after}}$。重新校准在对数优势（logit）尺度上进行。设 $p_i$ 为第 $i$ 层患者的初始预测风险，$p'_i$ 为重新校准后的风险。logit函数为 $\\operatorname{logit}(p) = \\ln(p/(1-p))$。第 $i$ 层的初始对数优势为 $z_i = \\operatorname{logit}(p_i)$。\n\n重新校准后的对数优势 $z'_i$ 由初始对数优势的线性变换给出：\n$$z'_i = a + S \\cdot z_i$$\n其中 $S=0.6$ 是给定的校准斜率，$a$ 是整体校准截距。通过应用逆logit函数获得重新校准后的风险：\n$$p'_i = \\operatorname{logit}^{-1}(z'_i) = \\frac{1}{1 + \\exp(-z'_i)} = \\frac{1}{1 + \\exp(-(a + S \\cdot z_i))}$$\n\n截距 $a$ 由重新校准后的平均预测风险等于观测事件患病率 $\\pi_{\\text{obs}} = 0.12$ 这一条件确定。平均预测风险 $\\bar{p'}$ 是重新校准后各层风险的加权平均值：\n$$\\bar{p'} = \\frac{1}{N} \\sum_{i=1}^{5} n_i p'_i = \\pi_{\\text{obs}}$$\n代入数值 $N=2000$ 和 $\\pi_{\\text{obs}}=0.12$，预期的事件总数必须为 $N \\pi_{\\text{obs}} = 2000 \\cdot 0.12 = 240$。因此，$a$ 必须满足以下方程：\n$$\\sum_{i=1}^{5} n_i \\cdot \\frac{1}{1 + \\exp(-(a + S \\cdot \\operatorname{logit}(p_i)))} = 240$$\n\n重新校准后，如果第 $i$ 层患者的新风险 $p'_i \\ge 0.10$，他们将接受治疗。这个不等式可以在logit尺度上表示。设 $z_{thresh} = \\operatorname{logit}(0.10) = \\ln(0.10/0.90) = \\ln(1/9) = -\\ln(9)$。治疗的条件是 $z'_i \\ge z_{thresh}$。\n$$a + S \\cdot z_i \\ge -\\ln(9)$$\n$$a \\ge -\\ln(9) - S \\cdot z_i$$\n我们为每个分层定义一个临界截距 $a_{c,i}$，即在该截距值下，该分层重新校准后的风险恰好为 $0.10$：\n$$a_{c,i} = -\\ln(9) - S \\cdot z_i = -\\ln(9) - S \\cdot \\operatorname{logit}(p_i)$$\n当且仅当真实截距 $a$ 大于或等于其临界截距时，即 $a \\ge a_{c,i}$，第 $i$ 层将接受治疗。我们不需要找到 $a$ 的确切值，只需要确定它相对于那些治疗状态可能改变的分层的临界截距的位置。最初未接受治疗的分层是第1层和第2层。让我们计算它们的临界截距。\n\n$S=0.6$ 且 $-\\ln(9) \\approx -2.19722$。\n对于第1层：$p_1 = 0.05$，$z_1 = \\operatorname{logit}(0.05) = \\ln(1/19) \\approx -2.94444$。\n$a_{c,1} = -\\ln(9) - 0.6 \\cdot \\ln(1/19) = -\\ln(9) + 0.6 \\cdot \\ln(19) \\approx -2.19722 + 0.6 \\cdot (2.94444) = -2.19722 + 1.76666 = -0.43056$。\n\n对于第2层：$p_2 = 0.08$，$z_2 = \\operatorname{logit}(0.08) = \\ln(2/23) \\approx -2.44235$。\n$a_{c,2} = -\\ln(9) - 0.6 \\cdot \\ln(2/23) = -\\ln(9) + 0.6 \\cdot \\ln(11.5) \\approx -2.19722 + 0.6 \\cdot (2.44235) = -2.19722 + 1.46541 = -0.73181$。\n\n为了定位真实截距 $a$，我们在这些临界截距处评估预期事件的总数 $g(a) = \\sum n_i p'_i(a)$。\n让我们在 $a = a_{c,2} \\approx -0.73181$ 处评估 $g(a)$。在此截距下，$p'_2$ 恰好为 $0.10$。\n我们必须计算所有 $i=1, ..., 5$ 的 $p'_i(a_{c,2})$：\n$p'_i(a_{c,2}) = \\operatorname{logit}^{-1}(a_{c,2} + S \\cdot z_i)$。\n$z'_1(a_{c,2}) = a_{c,2} + 0.6 z_1 \\approx -0.73181 + 0.6(-2.94444) = -2.49847$。$p'_1 \\approx 0.07606$。\n$z'_2(a_{c,2}) = a_{c,2} + 0.6 z_2 = -\\ln(9)$。$p'_2 = 0.10$。\n$z'_3(a_{c,2}) = a_{c,2} + 0.6 z_3 \\approx -0.73181 + 0.6(-1.99243) = -1.92727$。$p'_3 \\approx 0.12702$。\n$z'_4(a_{c,2}) = a_{c,2} + 0.6 z_4 \\approx -0.73181 + 0.6(-1.51732) = -1.64220$。$p'_4 \\approx 0.16223$。\n$z'_5(a_{c,2}) = a_{c,2} + 0.6 z_5 \\approx -0.73181 + 0.6(-0.84730) = -1.24019$。$p'_5 \\approx 0.22442$。\n\n现在，我们计算 $a = a_{c,2}$ 时的总预期病例数：\n$g(a_{c,2}) = \\sum n_i p'_i(a_{c,2}) = 800(0.07606) + 400(0.10) + 300(0.12702) + 300(0.16223) + 200(0.22442)$\n$g(a_{c,2}) \\approx 60.85 + 40.00 + 38.11 + 48.67 + 44.88 = 232.51$。\n\n函数 $g(a)$ 是关于 $a$ 的逻辑斯谛函数之和，因此它随 $a$ 单调递增。由于 $g(a_{c,2}) = 232.51  240$，满足 $g(a)=240$ 所需的真实 $a$ 值必须大于 $a_{c,2}$。\n因此，我们确定了 $a > a_{c,2}$。\n\n现在我们来检查条件 $a \\ge a_{c,1}$。\n$a_{c,1} = -0.43056$。$a \\ge -0.43056$ 是否成立？\n让我们评估 $g(a_{c,1})$。当 $a = a_{c,1}$ 时，$p'_1$ 恰好为 $0.10$。其他风险值将比 $a_{c,2}$ 时更高。\n在 $a_{c,1}$ 处，$p'_1$ 恰好为 $0.10$。\n$z'_1(a_{c,1}) = a_{c,1}+Sz_1 = -\\ln(9) - Sz_1 + Sz_1 = -\\ln(9)$。所以 $p'_1=0.1$。\n$z'_2(a_{c,1}) = a_{c,1} + Sz_2 = -\\ln(9) - Sz_1 + Sz_2 = -\\ln(9) - S(z_1-z_2) \\approx -2.19722 - 0.6(-2.94444 - (-2.44235)) = -2.19722 - 0.6(-0.50209) \\approx -2.19722+0.30125=-1.89597$。\n$p'_2(a_{c1}) \\approx 1/(1+\\exp(1.89597)) \\approx 0.1305$。\n类似地，我们可以看到所有其他的 $p'_i(a_{c1})$ 都将 $>0.1$。\n对预期病例数求和：\n$g(a_{c,1})_1 = n_1 p'_1 = 800(0.1)=80$。\n$g(a_{c,1})_2 = n_2 p'_2 = 400(0.1305) = 52.2$。\n$p'_3(a_{c1}) = \\operatorname{logit}^{-1}(-\\ln(9)-S(z_1-z_3)) \\approx \\operatorname{logit}^{-1}(-2.19722 - 0.6(-0.95201)) \\approx \\operatorname{logit}^{-1}(-1.62601) \\approx 0.1648$。$n_3 p'_3 \\approx 49.44$。\n$p'_4(a_{c1}) = \\operatorname{logit}^{-1}(-\\ln(9)-S(z_1-z_4)) \\approx \\operatorname{logit}^{-1}(-1.34103) \\approx 0.2073$。$n_4 p'_4 \\approx 62.19$。\n$p'_5(a_{c1}) = \\operatorname{logit}^{-1}(-\\ln(9)-S(z_1-z_5)) \\approx \\operatorname{logit}^{-1}(-0.93906) \\approx 0.2811$。$n_5 p'_5 \\approx 56.22$。\n$g(a_{c,1}) \\approx 80 + 52.2 + 49.44 + 62.19 + 56.22 = 300.05$。\n由于 $g(a_{c,1}) = 300.05 > 240$，真实 $a$ 值必须小于 $a_{c,1}$。\n\n所以我们确定了真实截距 $a$ 的位置：$a_{c,2}  a  a_{c,1}$。\n这即是说 $-0.73181  a  -0.43056$。\n\n现在我们使用条件 $a \\ge a_{c,i}$ 来确定重新校准后每个分层的治疗状态：\n- 第1层：$a \\ge a_{c,1}$ 是否成立？不成立，因为 $a  a_{c,1}$。不予治疗。\n- 第2层：$a \\ge a_{c,2}$ 是否成立？成立，因为 $a > a_{c,2}$。接受治疗。\n- 第3、4、5层在校准前就接受治疗，它们的临界截距 $a_{c,i}$ 比 $a_{c,2}$ 更负，因此它们肯定会继续接受治疗。为完整起见：\n$a_{c,3} = -\\ln(9) - 0.6 z_3 \\approx -1.00176$。由于 $a > -0.73181 > -1.00176$，所以 $a>a_{c,3}$。接受治疗。\n$a_{c,4} = -\\ln(9) - 0.6 z_4 \\approx -1.28683$。由于 $a > a_{c,4}$。接受治疗。\n$a_{c,5} = -\\ln(9) - 0.6 z_5 \\approx -1.68884$。由于 $a > a_{c,5}$。接受治疗。\n\n因此，重新校准后，第2、3、4、5层接受治疗。\n重新校准后接受治疗的患者人数为：\n$N_{\\text{after}} = n_2 + n_3 + n_4 + n_5 = 400 + 300 + 300 + 200 = 1200$。\n\n接受治疗的患者人数变化为：\n$\\Delta N = N_{\\text{after}} - N_{\\text{before}} = 1200 - 800 = 400$。",
            "answer": "$$\\boxed{400}$$"
        }
    ]
}