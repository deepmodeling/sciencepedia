{
    "hands_on_practices": [
        {
            "introduction": "连锁不平衡（Linkage Disequilibrium, LD）矩阵是统计精细定位的基石，因为它描述了遗传变异之间的相关结构。本练习  提供了从基因型数据计算 LD 矩阵的实践经验，并解决了一个关键的现实世界挑战：小型参考面板中的抽样方差问题，这需要通过正则化来确保下游分析的数值稳定性和准确性。",
            "id": "4341798",
            "problem": "给定参考面板中一小部分个体的基因型剂量矩阵以及部分单核苷酸多态性（SNP）对应的外部等位基因频率。您的任务是实现一个程序，为每个测试用例计算成对连锁不平衡（LD）相关矩阵 $R$，评估使用外部与样本等位基因频率对 $R$ 的影响，并对 $R$ 应用基于收缩的正则化以减轻抽样方差。您的程序必须按如下规定输出每个测试用例的摘要指标。\n\n基本基础和定义：\n- 单核苷酸多态性（SNP）在一个基因型矩阵 $G \\in \\mathbb{R}^{n \\times m}$ 中编码，其条目在 $\\{0,1,2\\}$ 中，表示 $n$ 个个体和 $m$ 个SNP的备择等位基因剂量。\n- 在哈迪-温伯格平衡（HWE）下，对于备择等位基因频率为 $p \\in (0,1)$ 的SNP，其基因型剂量的期望均值为 $2p$，方差为 $2p(1-p)$。\n- 令 $p_j$ 表示SNP $j$ 的等位基因频率，可以由外部提供，也可以从样本中估计为 $\\hat{p}_j = \\frac{1}{2n}\\sum_{i=1}^{n} G_{ij}$。定义标准化基因型矩阵 $X \\in \\mathbb{R}^{n \\times m}$ 为\n$$\nX_{ij} \\;=\\; \\frac{G_{ij} - 2p_j}{\\sqrt{2p_j(1-p_j)}} \\, ,\n$$\n其中，如果需要，可在平方根内添加一个小的正常数 $\\varepsilon$ 来稳定分母，以避免除以零。\n- 样本LD相关矩阵估计为\n$$\nR \\;=\\; \\frac{1}{n-1} X^\\top X \\, ,\n$$\n当标准化精确时，该值等于样本相关性。\n- 有限样本估计误差会在 $R$ 中引入抽样方差。一种常用的正则化方法是向单位矩阵收缩：\n$$\nR_{\\lambda} \\;=\\; (1-\\lambda) R \\;+\\; \\lambda I_m \\, ,\n$$\n其中 $I_m$ 是 $m \\times m$ 的单位矩阵，$\\lambda \\in [0,1]$ 是收缩强度。\n- 假设标准化数据服从高斯-威沙特模型。一个近似的插入式估计量可以最小化预期的平方Frobenius误差来估计朝向 $I_m$ 的最优收缩强度，并可实现为：\n$$\n\\lambda^\\star \\;=\\; \\min\\!\\Bigg( 1, \\; \\max\\!\\Big( 0, \\; \\frac{\\phi}{\\delta + \\eta} \\Big) \\Bigg) \\, ,\n$$\n其中 $\\eta > 0$ 是一个小的数值，用于数值稳定性，以及\n$$\n\\phi \\;=\\; \\frac{1}{n-1} \\sum_{i \\neq j} \\big( R_{ij}^2 + 1 \\big) \\, , \\qquad\n\\delta \\;=\\; \\sum_{i \\neq j} R_{ij}^2 \\, .\n$$\n\n每个测试用例所需的计算：\n1.  给定 $G$ 和外部等位基因频率 $\\{p_j\\}_{j=1}^{m}$，在标准化中使用外部频率计算 $R_{\\text{ext}}$。\n2.  通过使用样本等位基因频率 $\\{\\hat{p}_j\\}_{j=1}^{m}$（而不是外部频率）进行标准化来计算 $R_{\\text{samp}}$。\n3.  使用 $R_{\\text{ext}}$，计算收缩强度 $\\lambda^\\star$ 和正则化矩阵\n$$\nR_{\\text{reg}} \\;=\\; (1-\\lambda^\\star) R_{\\text{ext}} \\;+\\; \\lambda^\\star I_m \\, .\n$$\n\n您的程序必须为每个测试用例输出以下三个量：\n- $R_{\\text{ext}}$ 和 $R_{\\text{samp}}$ 之间的最大绝对逐元素偏差：\n$$\nd \\;=\\; \\max_{i,j} \\big| \\big(R_{\\text{ext}}\\big)_{ij} - \\big(R_{\\text{samp}}\\big)_{ij} \\big| \\, .\n$$\n- $R_{\\text{ext}}$ 和 $R_{\\text{reg}}$ 之差的Frobenius范数：\n$$\nf \\;=\\; \\big\\| R_{\\text{ext}} - R_{\\text{reg}} \\big\\|_{\\mathrm{F}} \\, .\n$$\n- 一个布尔值，指示 $R_{\\text{reg}}$ 是否为严格正定，定义为所有特征值严格大于阈值 $\\tau$，其中 $\\tau = 10^{-8}$：\n$$\n\\text{is\\_spd} \\;=\\; \\big( \\lambda_{\\min}(R_{\\text{reg}}) > \\tau \\big) \\, .\n$$\n\n数值约定：\n- 如果需要，在 $X_{ij}$ 的方差分母稳定化中使用 $\\varepsilon = 10^{-8}$。\n- 在 $\\lambda^\\star$ 的分母中使用 $\\eta = 10^{-12}$ 以避免除以零。\n- 使用 $\\tau = 10^{-8}$ 来检验严格正定性。\n\n测试套件：\n提供以下四个测试用例。每个用例包含 $n$，$m$，基因型矩阵 $G$（行主序：$n$ 行和 $m$ 列），以及外部等位基因频率向量 $(p_1,\\ldots,p_m)$。\n\n- 测试用例A（一般情况；中等相关性）：$n=8$，$m=4$，\n  $$\n  G \\;=\\; \\begin{bmatrix}\n  0  0  2  1 \\\\\n  1  1  1  1 \\\\\n  2  2  0  2 \\\\\n  0  1  1  0 \\\\\n  1  1  2  2 \\\\\n  2  2  1  2 \\\\\n  0  0  0  0 \\\\\n  1  1  1  1\n  \\end{bmatrix} \\, , \\quad\n  (p_1,p_2,p_3,p_4) \\;=\\; (0.4,\\, 0.45,\\, 0.52,\\, 0.55) \\, .\n  $$\n- 测试用例B（存在稀有等位基因）：$n=10$，$m=3$，\n  $$\n  G \\;=\\; \\begin{bmatrix}\n  0  0  2 \\\\\n  0  1  1 \\\\\n  0  1  1 \\\\\n  0  0  2 \\\\\n  0  1  0 \\\\\n  0  0  1 \\\\\n  0  1  2 \\\\\n  0  0  0 \\\\\n  1  0  1 \\\\\n  0  1  2\n  \\end{bmatrix} \\, , \\quad\n  (p_1,p_2,p_3) \\;=\\; (0.04,\\, 0.3,\\, 0.55) \\, .\n  $$\n- 测试用例C（秩亏的 $R$，$m > n$）：$n=5$，$m=6$，\n  $$\n  G \\;=\\; \\begin{bmatrix}\n  0  1  2  0  1  2 \\\\\n  1  2  1  1  2  1 \\\\\n  2  1  0  2  1  0 \\\\\n  0  0  1  0  0  1 \\\\\n  1  1  2  1  1  2\n  \\end{bmatrix} \\, , \\quad\n  (p_1,\\ldots,p_6) \\;=\\; (0.2,\\, 0.5,\\, 0.6,\\, 0.3,\\, 0.5,\\, 0.6) \\, .\n  $$\n- 测试用例D（两个SNP之间完全相关）：$n=6$，$m=3$，\n  $$\n  G \\;=\\; \\begin{bmatrix}\n  0  0  0 \\\\\n  0  0  1 \\\\\n  1  1  0 \\\\\n  1  1  1 \\\\\n  2  2  0 \\\\\n  2  2  1\n  \\end{bmatrix} \\, , \\quad\n  (p_1,p_2,p_3) \\;=\\; (0.5,\\, 0.5,\\, 0.5) \\, .\n  $$\n\n最终输出格式：\n- 对于每个测试用例，计算如上定义的 $(d, f, \\text{is\\_spd})$。您的程序必须生成一行输出，其中包含一个由四个列表组成的列表，每个测试用例一个，顺序为 A、B、C、D。每个内部列表必须是 $[d,f,\\text{is\\_spd}]$ 的形式，其中 $d$ 和 $f$ 四舍五入到恰好 $6$ 位小数，而 $\\text{is\\_spd}$ 是一个布尔值。例如，\n$$\n\\big[ [d_A,f_A,\\text{is\\_spd}_A],\\; [d_B,f_B,\\text{is\\_spd}_B],\\; [d_C,f_C,\\text{is\\_spd}_C],\\; [d_D,f_D,\\text{is\\_spd}_D] \\big] \\, .\n$$\n\n科学真实性要求：\n- 您的实现应遵循上述定义，并且在给定常数 $\\varepsilon$、$\\eta$ 和 $\\tau$ 的情况下必须是数值稳定的。不得使用任何随机组件。",
            "solution": "该问题被认为是有效的，因为它在统计遗传学方面有科学依据，定义明确，提供了所有必要信息，并且其表述是客观的。它提出了一个清晰、算法上明确定义的任务，没有内部矛盾或不可行的要求。我们将继续提供完整的解决方案。\n\n任务是通过计算和比较连锁不平衡（LD）相关矩阵 $R$ 的不同估计值，来分析几个测试用例的基因型数据。该过程涉及基因型数据的标准化、相关矩阵的计算以及收缩正则化技术的应用。对于每个用例，我们必须报告三个摘要指标：两种LD估计值之间的最大偏差（$d$），正则化调整的幅度（$f$），以及对正则化矩阵严格正定性的检验（$\\text{is\\_spd}$）。\n\n让我们将步骤形式化。\n\n给定的测试用例提供了一个用于 $n$ 个个体和 $m$ 个SNP的基因型矩阵 $G \\in \\mathbb{R}^{n \\times m}$，以及一个外部等位基因频率向量 $p_{\\text{ext}} = (p_1, \\ldots, p_m)$。常数 $\\varepsilon = 10^{-8}$，$\\eta = 10^{-12}$ 和 $\\tau = 10^{-8}$ 被指定用于数值稳定性和测试。\n\n**第一步：基因型矩阵的标准化**\n\n第一步是标准化基因型矩阵 $G$。标准化公式如下：\n$$\nX_{ij} = \\frac{G_{ij} - 2p_j}{\\sqrt{2p_j(1-p_j)}}\n$$\n其中 $p_j$ 是SNP $j$ 的备择等位基因频率。分母代表哈迪-温伯格平衡（HWE）下的标准差，通过稳定化处理以防止除以零或非常小的数。我们通过将分母计算为 $\\sqrt{2p_j(1-p_j) + \\varepsilon}$ 来实现这一点。\n\n这个标准化过程必须对每个测试用例执行两次：\n1.  使用提供的外部等位基因频率 $\\{p_j\\}_{j=1}^{m}$ 生成矩阵 $X_{\\text{ext}}$。\n2.  使用样本估计的等位基因频率 $\\{\\hat{p}_j\\}_{j=1}^{m}$ 生成矩阵 $X_{\\text{samp}}$。SNP $j$ 的样本等位基因频率从数据中估计如下：\n    $$\n    \\hat{p}_j = \\frac{1}{2n} \\sum_{i=1}^{n} G_{ij}\n    $$\n\n**第二步：LD相关矩阵的计算**\n\n利用标准化矩阵，我们使用标准化数据的样本协方差公式计算两个LD相关矩阵 $R_{\\text{ext}}$ 和 $R_{\\text{samp}}$：\n$$\nR = \\frac{1}{n-1} X^\\top X\n$$\n这得到：\n$$\nR_{\\text{ext}} = \\frac{1}{n-1} X_{\\text{ext}}^\\top X_{\\text{ext}}\n$$\n$$\nR_{\\text{samp}} = \\frac{1}{n-1} X_{\\text{samp}}^\\top X_{\\text{samp}}\n$$\n$R_{\\text{ext}}$ 和 $R_{\\text{samp}}$ 都是 $m \\times m$ 的对称矩阵。\n\n**第三步：偏差指标 $d$ 的计算**\n\n第一个要求的输出指标 $d$ 量化了由外部频率与样本频率得出的LD矩阵之间的差异。它是最大的绝对逐元素差异：\n$$\nd = \\max_{i,j} \\left| \\left(R_{\\text{ext}}\\right)_{ij} - \\left(R_{\\text{samp}}\\right)_{ij} \\right|\n$$\n\n**第四步：收缩正则化**\n\n对矩阵 $R_{\\text{ext}}$ 进行正则化，以减少因有限样本量（$n$）引起的估计误差。正则化通过向单位矩阵 $I_m$ 收缩来执行：\n$$\nR_{\\text{reg}} = (1-\\lambda^\\star) R_{\\text{ext}} + \\lambda^\\star I_m\n$$\n最优收缩强度 $\\lambda^\\star$ 使用提供的插入式公式进行估计。首先，我们根据 $R_{\\text{ext}}$ 计算中间量 $\\phi$ 和 $\\delta$：\n$$\n\\delta = \\sum_{i \\neq j} \\left(R_{\\text{ext}}\\right)_{ij}^2\n$$\n$$\n\\phi = \\frac{1}{n-1} \\sum_{i \\neq j} \\left( \\left(R_{\\text{ext}}\\right)_{ij}^2 + 1 \\right)\n$$\n项 $\\sum_{i \\neq j} (\\cdot)$ 表示对矩阵所有非对角元素的求和。这可以通过计算所有元素的总和再减去对角元素的总和来得到。令 $S = \\sum_{i,j} \\left(R_{\\text{ext}}\\right)_{ij}^2$ 和 $S_{\\text{diag}} = \\sum_{i} \\left(R_{\\text{ext}}\\right)_{ii}^2$。则 $\\delta = S - S_{\\text{diag}}$。总和 $\\sum_{i \\neq j} 1$ 是非对角元素的数量，即 $m(m-1)$。因此，$\\phi$可以计算为：\n$$\n\\phi = \\frac{1}{n-1} \\left( \\delta + m(m-1) \\right)\n$$\n然后计算收缩强度 $\\lambda^\\star$，并使用 $\\eta$ 进行数值稳定化，并将其裁剪到区间 $[0,1]$ 内：\n$$\n\\lambda^\\star = \\min\\left( 1, \\max\\left( 0, \\frac{\\phi}{\\delta + \\eta} \\right) \\right)\n$$\n有了 $\\lambda^\\star$，我们现在可以计算正则化矩阵 $R_{\\text{reg}}$。\n\n**第五步：正则化效果指标 $f$ 的计算**\n\n第二个输出指标 $f$ 衡量正则化所应用的调整的幅度。它是原始矩阵与正则化矩阵之差的Frobenius范数：\n$$\nf = \\left\\| R_{\\text{ext}} - R_{\\text{reg}} \\right\\|_{\\mathrm{F}}\n$$\n代入 $R_{\\text{reg}}$ 的定义，我们可以看到 $R_{\\text{ext}} - R_{\\text{reg}} = \\lambda^\\star (R_{\\text{ext}} - I_m)$。因此：\n$$\nf = \\lambda^\\star \\left\\| R_{\\text{ext}} - I_m \\right\\|_{\\mathrm{F}}\n$$\n其中范数计算为 $\\|A\\|_{\\mathrm{F}} = \\sqrt{\\sum_{i,j} A_{ij}^2}$。\n\n**第六步：严格正定性（SPD）检验**\n\n最后一个指标 $\\text{is\\_spd}$ 是一个布尔值，表示 $R_{\\text{reg}}$ 是否严格正定。如果一个矩阵的所有特征值都严格为正，则该矩阵是严格正定的。我们使用一个小的正常数阈值 $\\tau = 10^{-8}$ 来检验此条件：\n$$\n\\text{is\\_spd} = \\left( \\lambda_{\\min}(R_{\\text{reg}}) > \\tau \\right)\n$$\n其中 $\\lambda_{\\min}(R_{\\text{reg}})$ 是 $R_{\\text{reg}}$ 的最小特征值。由于 $R_{\\text{reg}}$ 通过构造是对称的，其特征值是实数，并且可以使用高效的数值算法来找到它们。\n\n我们将对提供的四个测试用例中的每一个应用这整个计算序列，并按规定格式化结果 $(d, f, \\text{is\\_spd})$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem for all test cases and prints the final output.\n    \"\"\"\n    \n    # Numerical conventions\n    epsilon = 1e-8\n    eta = 1e-12\n    tau = 1e-8\n\n    # Test suite definition\n    test_cases = [\n        (8, 4, np.array([\n            [0, 0, 2, 1], [1, 1, 1, 1], [2, 2, 0, 2], [0, 1, 1, 0],\n            [1, 1, 2, 2], [2, 2, 1, 2], [0, 0, 0, 0], [1, 1, 1, 1]\n        ]), np.array([0.4, 0.45, 0.52, 0.55])),\n        (10, 3, np.array([\n            [0, 0, 2], [0, 1, 1], [0, 1, 1], [0, 0, 2], [0, 1, 0],\n            [0, 0, 1], [0, 1, 2], [0, 0, 0], [1, 0, 1], [0, 1, 2]\n        ]), np.array([0.04, 0.3, 0.55])),\n        (5, 6, np.array([\n            [0, 1, 2, 0, 1, 2], [1, 2, 1, 1, 2, 1], [2, 1, 0, 2, 1, 0],\n            [0, 0, 1, 0, 0, 1], [1, 1, 2, 1, 1, 2]\n        ]), np.array([0.2, 0.5, 0.6, 0.3, 0.5, 0.6])),\n        (6, 3, np.array([\n            [0, 0, 0], [0, 0, 1], [1, 1, 0], [1, 1, 1],\n            [2, 2, 0], [2, 2, 1]\n        ]), np.array([0.5, 0.5, 0.5]))\n    ]\n    \n    all_results = []\n\n    for n, m, G, p_ext in test_cases:\n        G_float = G.astype(np.float64)\n\n        # Helper function for standardization\n        def standardize(genotypes, freqs):\n            mean = 2 * freqs\n            # Stabilized variance term: add epsilon inside square root\n            variance = 2 * freqs * (1 - freqs)\n            std_dev = np.sqrt(variance + epsilon)\n            return (genotypes - mean) / std_dev\n        \n        # Helper function for LD matrix calculation\n        def calculate_R(X_mat, n_samples):\n            return (1 / (n_samples - 1)) * (X_mat.T @ X_mat)\n\n        # 1. Compute R_ext\n        X_ext = standardize(G_float, p_ext)\n        R_ext = calculate_R(X_ext, n)\n\n        # 2. Compute R_samp\n        p_samp = np.sum(G_float, axis=0) / (2 * n)\n        X_samp = standardize(G_float, p_samp)\n        R_samp = calculate_R(X_samp, n)\n        \n        # 3. Compute metric d\n        d = np.max(np.abs(R_ext - R_samp))\n\n        # 4. Compute shrinkage intensity lambda_star using R_ext\n        # Sum of squared off-diagonal elements\n        off_diag_sq_sum = np.sum(R_ext**2) - np.sum(np.diag(R_ext)**2)\n        \n        delta = off_diag_sq_sum\n        phi = (1 / (n - 1)) * (delta + m * (m - 1))\n        \n        lambda_val = phi / (delta + eta)\n        lambda_star = np.clip(lambda_val, 0, 1)\n        \n        # 5. Compute R_reg\n        I_m = np.identity(m)\n        R_reg = (1 - lambda_star) * R_ext + lambda_star * I_m\n\n        # 6. Compute metric f\n        f = np.linalg.norm(R_ext - R_reg, 'fro')\n\n        # 7. Compute metric is_spd\n        # Use eigvalsh for symmetric matrices; it's faster and returns sorted eigenvalues\n        eigenvalues = np.linalg.eigvalsh(R_reg)\n        is_spd = eigenvalues[0] > tau\n        \n        all_results.append([d, f, is_spd])\n\n    # Format the final output as a string representation of a list of lists.\n    formatted_lists = []\n    for d_val, f_val, s_val in all_results:\n        # Create a string for the sublist, e.g., \"[0.123456, 0.987654, True]\"\n        formatted_lists.append(f\"[{d_val:.6f}, {f_val:.6f}, {s_val}]\")\n    \n    # Join the sublist strings with a comma and space, and wrap in brackets.\n    final_output_string = f\"[{', '.join(formatted_lists)}]\"\n    \n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "在确定一个 GWAS 命中信号后，一个关键问题是该信号是由单个因果变异驱动，还是由同一区域的多个独立变异驱动。本练习  演示了条件分析这一基本技术，我们通过对顶层信号进行统计学调整来检验是否存在次级的、独立的关联。掌握这种计算对于在尝试精确定位具体因果变异之前，正确识别一个基因座内因果信号的数量至关重要。",
            "id": "4341984",
            "problem": "在精准医疗和基因组诊断的精细定位（fine-mapping）分析中，您获得了一个包含四个单核苷酸多态性（SNP；Single-Nucleotide Polymorphisms）位点的全基因组关联研究（GWAS；Genome-Wide Association Study）的边际关联统计数据。假设基因型已经标准化，并且根据线性关联测试的大样本理论，跨SNP的边际$z$-分数向量近似服从多元正态分布，其相关性等于连锁不平衡（LD；Linkage Disequilibrium）矩阵。\n\n边际$z$-分数为\n$$\n\\boldsymbol{z} = \\begin{pmatrix} 6.10 \\\\ 4.30 \\\\ 2.10 \\\\ -1.20 \\end{pmatrix},\n$$\nLD相关矩阵为\n$$\nR = \\begin{pmatrix}\n1  0.20  0.05  -0.02 \\\\\n0.20  1  0.10  -0.01 \\\\\n0.05  0.10  1  0 \\\\\n-0.02  -0.01  0  1\n\\end{pmatrix}.\n$$\n\n将具有最大绝对边际$z$-分数的SNP确定为领先SNP，并将SNP 2视为候选的次级信号。仅使用多元正态分布中条件化的基本原理以及$\\boldsymbol{z}$的协方差等于$R$的假设，推导出在以领先SNP为条件后，SNP 2的相应条件检验统计量。然后，确定在$M = 20$次检验中，该候选次级信号在双侧Bonferroni校正的全族错误率$\\alpha = 0.05$下是否仍然显著。\n\n最终答案仅报告SNP 2的条件$z$-分数。将您的最终答案四舍五入到四位有效数字。不需要单位。",
            "solution": "所陈述的问题具有科学依据，提法恰当，客观，并包含足够的信息以得出唯一解。其基础模型将GWAS的$z$-分数视为从一个协方差结构等于连锁不平衡（LD）矩阵的多元正态分布中抽取的样本，这是统计遗传学中用于精细定位和条件分析的标准且被广泛接受的框架。所提供的数据是一致且符合实际的。因此，该问题是有效的，我将进行完整解答。\n\n目标是在考虑了领先SNP的影响后，计算SNP 2的条件检验统计量。这个过程被称为条件分析，它有助于区分是单个关联信号通过连锁不平衡（LD）影响多个相关的SNP，还是一个位点上存在多个不同的关联信号。\n\n首先，我们确定领先SNP，其定义为具有最大绝对边际$z$-分数的SNP。给定的$z$-分数向量为：\n$$\n\\boldsymbol{z} = \\begin{pmatrix} z_1 \\\\ z_2 \\\\ z_3 \\\\ z_4 \\end{pmatrix} = \\begin{pmatrix} 6.10 \\\\ 4.30 \\\\ 2.10 \\\\ -1.20 \\end{pmatrix}\n$$\n绝对值为$|z_1| = 6.10$，$|z_2| = 4.30$，$|z_3| = 2.10$，$|z_4| = |-1.20| = 1.20$。其中最大值为$6.10$，对应于SNP 1。因此，SNP 1是领先SNP。\n\n接下来，我们推导候选次级信号SNP 2在给定领先SNP 1的观测统计量下的条件检验统计量。设SNP 1和SNP 2的$z$-分数的随机变量分别为$Z_1$和$Z_2$。根据问题陈述，它们的联合分布是二元正态分布，其均值向量反映了它们真实的遗传效应，协方差矩阵从提供的LD矩阵$R$中提取：\n$$\n\\begin{pmatrix} Z_1 \\\\ Z_2 \\end{pmatrix} \\sim \\mathcal{N} \\left( \\begin{pmatrix} \\lambda_1 \\\\ \\lambda_2 \\end{pmatrix}, \\begin{pmatrix} R_{11}  R_{12} \\\\ R_{21}  R_{22} \\end{pmatrix} \\right)\n$$\n其中$\\lambda_1$和$\\lambda_2$是代表真实效应的非中心化参数，协方差子矩阵为：\n$$\n\\begin{pmatrix} R_{11}  R_{12} \\\\ R_{21}  R_{22} \\end{pmatrix} = \\begin{pmatrix} 1  0.20 \\\\ 0.20  1 \\end{pmatrix}\n$$\nSNP 2的条件检验统计量，我们记为$z_{2|1}$，是SNP 2处关联性的一个标准化度量，该关联性不能被其与SNP 1的连锁不平衡所解释。这是从条件正态分布的性质推导出来的。条件统计量是$Z_2$的观测值减去其在给定$Z_1$下的期望值，再除以条件标准差。\n给定$Z_1 = z_1$时$Z_2$的期望值为$E[Z_2 | Z_1=z_1] = \\lambda_2 + R_{21} R_{11}^{-1} (z_1 - \\lambda_1)$。条件方差为$\\text{Var}(Z_2 | Z_1=z_1) = R_{22} - R_{21} R_{11}^{-1} R_{12}$。\n\n为了构建一个检验SNP 2没有独立效应的原假设（即$H_0: \\lambda_2 = 0$）的检验统计量，我们用领先SNP的观测统计量$z_1$来近似其未知的真实效应$\\lambda_1$。这是诸如GCTA-COJO等方法中的标准近似。在此近似下，由于与SNP 1的连锁不平衡，$Z_2$的期望值为$R_{21}R_{11}^{-1}z_1$。条件统计量通过将观测值$z_2$与此期望值之差进行标准化来构建：\n$$\nz_{2|1} = \\frac{z_2 - E[Z_2 | Z_1=z_1, \\lambda_1=z_1, \\lambda_2=0]}{\\sqrt{\\text{Var}(Z_2 | Z_1=z_1)}} = \\frac{z_2 - R_{21} R_{11}^{-1} z_1}{\\sqrt{R_{22} - R_{21} R_{11}^{-1} R_{12}}}\n$$\n由于$R$是一个相关矩阵，对角线元素$R_{11}$和$R_{22}$等于1。代入这些值可以简化公式：\n$$\nz_{2|1} = \\frac{z_2 - R_{21} z_1}{\\sqrt{1 - R_{21}^2}}\n$$\n这个公式实际上计算了$z_2$对$z_1$回归的标准化残差，它代表了$z_2$信号中与$z_1$信号统计上独立的部分。\n\n我们现在代入给定的数值：$z_1 = 6.10$，$z_2 = 4.30$，$R_{21} = 0.20$。\n$$\nz_{2|1} = \\frac{4.30 - (0.20)(6.10)}{\\sqrt{1 - (0.20)^2}}\n$$\n首先，计算分子：\n$$\n4.30 - (0.20)(6.10) = 4.30 - 1.22 = 3.08\n$$\n接下来，计算分母：\n$$\n\\sqrt{1 - (0.20)^2} = \\sqrt{1 - 0.04} = \\sqrt{0.96}\n$$\n因此，条件$z$-分数为：\n$$\nz_{2|1} = \\frac{3.08}{\\sqrt{0.96}} \\approx \\frac{3.08}{0.9797959} \\approx 3.14351\n$$\n四舍五入到四位有效数字，我们得到$z_{2|1} = 3.144$。\n\n最后，问题要求确定这个次级信号在Bonferroni校正的阈值下是否显著。全族错误率为$\\alpha = 0.05$，$M = 20$次检验。校正后的单个检验的$p$-值显著性水平为$p_{\\text{thresh}} = \\frac{\\alpha}{M} = \\frac{0.05}{20} = 0.0025$。\n我们的条件统计量$z_{2|1} \\approx 3.144$的双侧$p$-值为$p = 2 \\times P(Z > |3.144|)$，其中$Z \\sim \\mathcal{N}(0,1)$。这个$p$-值约等于$0.00167$。由于$0.00167  0.0025$，在考虑了领先SNP 1并进行多重检验校正后，SNP 2的条件信号确实是统计显著的。最终要求的答案是条件$z$-分数本身的值。",
            "answer": "$$\n\\boxed{3.144}\n$$"
        },
        {
            "introduction": "最终目标是从统计关联走向具有生物学合理性的因果机制。这项综合性练习  模拟了一个真实的研究场景，挑战您综合来自多个人群、多种功能基因组学分析（如 eQTLs、MPRAs）和计算注释的证据。通过驾驭这个复杂的数据环境，您将学会设计一个全面的分析计划，最终得出一个优先的因果变异、一个可检验的机制性假说以及一个实验验证的蓝图。",
            "id": "4341927",
            "problem": "给定一个基因组位点，其中包含四个双等位基因变异，分别表示为 $v_1$、$v_2$、$v_3$ 和 $v_4$。现有两个群体（欧洲血统 (EUR) 和非洲血统 (AFR)）的全基因组关联研究 (GWAS) 汇总统计数据。对于每个血统，您拥有与某个复杂性状关联的 $z$-分数、特定血统的连锁不平衡 (LD) 矩阵、来自疾病相关细胞类型的功能注释、与相关组织中最近的表达基因 $G$ 相关的表达数量性状位点 (eQTL) 汇总统计数据、与基因 $G$ 的蛋白质产物相关的蛋白质数量性状位点 (pQTL) 汇总统计数据，以及每个变异的等位基因特异性调控活性的大规模并行报告基因检测 (MPRA) 测量值。\n\n定义和使用的基本原理：\n- 贝叶斯定理：后验几率与先验几率乘以似然比成正比。\n- 在单一因果变异精细定位中，变异 $i$ 的后验包含概率 (PIP) 可以从各变异间的相对后验几率推导得出，其中似然可以在跨血统共享因果模型下，根据关联统计数据和特定血统的LD进行近似。\n- $95\\%$ 可信集是指累积PIP至少为 $0.95$ 的最小变异集合。\n- 共定位评估两种性状（例如，GWAS和eQTL）是否共享一个因果变异；当单一变异能同时解释两种信号且LD标记模式在不同血统间保持一致时，证据会增强。\n- 跨血统精细定位利用LD的差异来提高因果解析度。\n- 功能先验必须根据全基因组富集进行校准，而不是用作确定性过滤器。\n\n该位点的数据：\n- EUR GWAS $z$-分数：$z^{\\mathrm{EUR}}_{v_1} = 6.0$，$z^{\\mathrm{EUR}}_{v_2} = 5.8$，$z^{\\mathrm{EUR}}_{v_3} = 2.0$，$z^{\\mathrm{EUR}}_{v_4} = 0.5$。\n- AFR GWAS $z$-分数：$z^{\\mathrm{AFR}}_{v_1} = 5.0$，$z^{\\mathrm{AFR}}_{v_2} = 1.0$，$z^{\\mathrm{AFR}}_{v_3} = 2.5$，$z^{\\mathrm{AFR}}_{v_4} = 0.2$。\n- 变异间特定血统的LD（Pearson相关系数 $r$）：\n  - EUR: $r_{12}^{\\mathrm{EUR}} = 0.95$, $r_{13}^{\\mathrm{EUR}} = 0.10$, $r_{14}^{\\mathrm{EUR}} = 0.05$, $r_{23}^{\\mathrm{EUR}} = 0.08$, $r_{24}^{\\mathrm{EUR}} = 0.02$, $r_{34}^{\\mathrm{EUR}} = 0.03$。\n  - AFR: $r_{12}^{\\mathrm{AFR}} = 0.40$, $r_{13}^{\\mathrm{AFR}} = 0.05$, $r_{14}^{\\mathrm{AFR}} = 0.02$, $r_{23}^{\\mathrm{AFR}} = 0.03$, $r_{24}^{\\mathrm{AFR}} = 0.01$, $r_{34}^{\\mathrm{AFR}} = 0.02$。\n- 疾病相关细胞类型中的功能注释：\n  - $v_1$：增强子元件，带有ATAC-seq（使用测序技术的转座酶可及染色质分析）峰；备择等位基因破坏了一个转录因子 (TF) $X$ 的基序。\n  - $v_2$：基因间区，无开放染色质，无保守性。\n  - $v_3$：基因 $G$ 的启动子；启动子染色质开放；无基序破坏。\n  - $v_4$：内含子区，低保守性。\n- 相关组织中基因 $G$ 的eQTL汇总统计数据：\n  - $v_1$：$z_{\\mathrm{eQTL}} = 4.5$；备择等位基因降低 $G$ 的表达。\n  - $v_2$：$z_{\\mathrm{eQTL}} = 0.5$。\n  - $v_3$：$z_{\\mathrm{eQTL}} = 1.0$。\n  - $v_4$：$z_{\\mathrm{eQTL}} = 0.0$。\n- $G$ 蛋白质产物的pQTL：\n  - $v_1$：$z_{\\mathrm{pQTL}} = 3.0$；备择等位基因降低蛋白质丰度。\n- MPRA：\n  - $v_1$：备择等位基因使报告基因活性降低 $20\\%$，且信号在重复实验中一致。\n  - $v_2$：无可检测的等位基因效应。\n  - $v_3$：有 $5\\%$ 的小幅增加，但无统计学显著性。\n  - $v_4$：无效应。\n\n假设是病例-对照GWAS，表型和基因型已标准化，并且该性状在此位点只有一个主导信号。疾病相关细胞类型已得到充分表征，且基因 $G$ 在该组织中表达。\n\n问题：哪一个端到端的分析计划及其相应产出在科学上最合理，与数据和第一性原理内部一致，能产生有效的因果变异PIP、$95\\%$ 可信集、变异到基因的指派、机制假说以及优先的实验验证计划？\n\nA. 协调不同血统间的等位基因和汇总统计数据；进行各血统的质量控制；在单一共享因果变异模型下，使用特定血统的LD在每个血统中进行精细定位，允许存在多个信号但通过条件分析确认只有一个；通过联合似然整合各血统数据；使用一个经过校准的分层先验来整合功能注释，该先验适度上调增强子活性和ATAC-seq峰的权重；计算得出PIP为 $v_1: 0.96$, $v_2: 0.02$, $v_3: 0.02$, $v_4: 0.00$；将 $95\\%$ 可信集定义为 $\\{v_1\\}$；使用完整的汇总统计数据和LD在GWAS和eQTL/pQTL之间进行共定位，以获得共享因果变异 $v_1$ 的高后验概率；通过共定位以及使用接触活性（ABC）评分和启动子捕获Hi-C的增强子-基因连接，指派 $v_1 \\rightarrow G$；提出机制，$v_1$ 破坏TF $X$ 的结合，降低增强子活性，从而减少 $G$ 的表达和蛋白质丰度；优先安排实验：在诱导性多能干细胞 (iPSC) 衍生的疾病相关细胞中对 $v_1$ 进行CRISPR碱基编辑，进行等位基因特异性表达和蛋白质检测，对增强子进行CRISPR干扰 (CRISPRi)，以及针对TF $X$ 进行染色质免疫沉淀 (ChIP) 并检测等位基因特异性结合。\n\nB. 仅使用EUR的GWAS和LD；将MPRA视为确定性过滤器，排除 $v_2$、$v_3$ 和 $v_4$；在等同先验下计算PIP，得出 $v_1: 0.55$, $v_2: 0.40$, $v_3: 0.05$, $v_4: 0.00$；将 $95\\%$ 可信集定义为 $\\{v_1, v_2\\}$；通过距离将变异指派给最近的基因，忽略eQTL；推断机制为风险等位基因增加增强子活性；在不表达 $G$ 的通用细胞系（如HEK$293$）中进行荧光素酶报告基因检测，不进行等位基因特异性基因组编辑。\n\nC. 通过反方差加权合并EUR和AFR的$z$-分数，忽略LD；通过对$z$-分数的平方应用softmax函数来计算PIP，得出 $v_1: 0.70$, $v_2: 0.20$, $v_3: 0.10$, $v_4: 0.00$；将 $95\\%$ 可信集定义为 $\\{v_1, v_2\\}$；仅使用eQTL的$p$-值进行共定位，不考虑LD或精细定位；通过邻近性将变异指派给 $G$；在不协调MPRA和eQTL方向的情况下提出机制假说；建议在任何方便的细胞系中对 $G$ 进行常规CRISPR敲除。\n\nD. 进行跨血统精细定位，但应用一个未校准的功能先验，该先验严重加权启动子注释，迫使 $v_3$ 占主导地位；计算得出PIP为 $v_3: 0.80$, $v_1: 0.15$, $v_2: 0.04$, $v_4: 0.01$；将 $95\\%$ 可信集定义为 $\\{v_3\\}$；声称与弱eQTL证据存在共定位；主要根据 $v_3$ 处微小且不显著的MPRA效应来证明机制；优先进行启动子编辑而非增强子扰动。\n\n选择唯一的最佳选项。",
            "solution": "用户提供了一个关于GWAS位点精细定位的问题陈述，并要求评估几个提议的分析计划。任务是首先验证问题陈述，如果有效，则确定最科学合理的分析计划及其结果。\n\n### 第一步：提取已知信息\n\n-   **变异：** 单一位点的四个双等位基因变异：$v_1, v_2, v_3, v_4$。\n-   **群体：** 欧洲血统 (EUR) 和非洲血统 (AFR)。\n-   **GWAS关联数据：**\n    -   EUR $z$-分数：$z^{\\mathrm{EUR}}_{v_1} = 6.0$, $z^{\\mathrm{EUR}}_{v_2} = 5.8$, $z^{\\mathrm{EUR}}_{v_3} = 2.0$, $z^{\\mathrm{EUR}}_{v_4} = 0.5$。\n    -   AFR $z$-分数：$z^{\\mathrm{AFR}}_{v_1} = 5.0$, $z^{\\mathrm{AFR}}_{v_2} = 1.0$, $z^{\\mathrm{AFR}}_{v_3} = 2.5$, $z^{\\mathrm{AFR}}_{v_4} = 0.2$。\n-   **连锁不平衡 (LD) 数据 (Pearson相关系数, $r$)：**\n    -   EUR: $r_{12}^{\\mathrm{EUR}} = 0.95$。所有其他配对的 $|r| \\le 0.10$。\n    -   AFR: $r_{12}^{\\mathrm{AFR}} = 0.40$。所有其他配对的 $|r| \\le 0.05$。\n-   **功能基因组学数据（在疾病相关细胞类型中）：**\n    -   **注释：**\n        -   $v_1$：位于增强子元件中（带有ATAC-seq峰）；备择等位基因破坏了一个转录因子 (TF) $X$ 的基序。\n        -   $v_2$：基因间区，无开放染色质，无保守性。\n        -   $v_3$：位于基因 $G$ 的启动子中；位于开放染色质中。\n        -   $v_4$：内含子区，低保守性。\n    -   **基因 $G$ 的eQTL：**\n        -   $v_1$: $z_{\\mathrm{eQTL}} = 4.5$；备择等位基因降低 $G$ 的表达。\n        -   $v_2$: $z_{\\mathrm{eQTL}} = 0.5$。\n        -   $v_3$: $z_{\\mathrm{eQTL}} = 1.0$。\n        -   $v_4$: $z_{\\mathrm{eQTL}} = 0.0$。\n    -   **蛋白质 $G$ 的pQTL：**\n        -   $v_1$: $z_{\\mathrm{pQTL}} = 3.0$；备择等位基因降低蛋白质丰度。\n    -   **大规模并行报告基因检测 (MPRA)：**\n        -   $v_1$：备择等位基因显示出在重复实验中一致的 $20\\%$ 报告基因活性降低。\n        -   $v_2, v_4$：无效应。\n        -   $v_3$：微小且不显著的 $5\\%$ 活性增加。\n-   **定义和原理：**\n    -   用于后验几率的贝叶斯定理。\n    -   单一因果变异精细定位概念。\n    -   $95\\%$ 可信集的定义。\n    -   共定位的定义。\n    -   跨血统精细定位的原理。\n    -   使用经过校准而非确定性的功能先验的原理。\n-   **假设：** 单一主导信号；充分表征的相关细胞类型；基因 $G$ 表达。\n-   **问题：** 确定最科学合理的端到端分析计划及其结果。\n\n### 第二步：使用提取的已知信息进行验证\n\n对问题陈述的有效性进行评估。\n\n-   **科学依据：** 该问题牢固地植根于统计遗传学、群体遗传学和分子生物学的既定原则。所涉及的数据类型（GWAS z分数、LD矩阵、ATAC-seq、eQTL、pQTL、MPRA）和概念（精细定位、共定位、可信集）是现代基因组学的标准配置。所呈现的场景是跨血统精细定位的经典案例。\n-   **问题适定性：** 问题是适定的。它提供了充分、一致的数据，足以得出一个关于可能因果变异和机制的合理结论。多血统关联数据和多组学功能数据的结合旨在收敛到一个单一、稳定的解决方案。\n-   **客观性：** 语言精确客观。数据以数值形式呈现，原理以形式化方式陈述。\n-   **一致性检查：**\n    -   GWAS和LD数据相互一致且信息量高。在EUR群体中，$v_1$ 和 $v_2$ 具有非常相似且强烈的关联信号（$z^{\\mathrm{EUR}}_{v_1} = 6.0$, $z^{\\mathrm{EUR}}_{v_2} = 5.8$），因为它们处于极高的LD中（$r_{12}^{\\mathrm{EUR}} = 0.95$）。在AFR群体中，LD显著减弱（$r_{12}^{\\mathrm{AFR}} = 0.40$），关联信号仅由 $v_1$ 保留（$z^{\\mathrm{AFR}}_{v_1} = 5.0$），而 $v_2$ 的信号则衰减至基线水平（$z^{\\mathrm{AFR}}_{v_2} = 1.0$）。这种模式强烈表明 $v_1$ 是因果变异，而 $v_2$ 在欧洲人群中是一个标签SNP。\n    -   功能数据内部一致，并且都指向 $v_1$ 是功能性变异。$v_1$ 位于一个可及的增强子区域（ATAC-seq峰），其备择等位基因破坏了一个TF基序，在报告基因检测（MPRA）中显示出显著效应，是基因 $G$ 的强eQTL，也是蛋白质 $G$ 的pQTL。\n    -   效应方向也一致：$v_1$ 的备择等位基因与增强子活性降低（MPRA）、基因表达降低（eQTL）和蛋白质丰度降低（pQTL）相关。\n    -   其他变异缺乏这种证据的汇合。$v_3$ 位于启动子中，但功能效应非常微弱且不显著，GWAS关联也较弱。$v_2$ 和 $v_4$ 缺乏功能支持。\n-   **未发现缺陷：** 该问题没有违反任何指定的无效性标准。它在科学上是合理的、完整的、一致的、现实的、适定的，并且并非微不足道。\n\n### 第三步：裁定与行动\n\n问题陈述是**有效的**。现在将继续进行求解过程。\n\n### 基于原理的推导与选项评估\n\n最佳分析计划必须使用统计学和生物学上合理的方法，充分利用所有可用的数据源。\n\n1.  **精细定位策略：** 核心挑战是区分 $v_1$ 和 $v_2$。所提供的最强大的工具是EUR和AFR群体之间的LD差异。一个联合分析两个血统的汇总统计数据并使用各自LD矩阵的跨血统精细定位方法是目前最先进的方法。这将正确地传播证据，认识到单一因果变异（$v_1$）可以解释EUR群体中 $v_1$ 和 $v_2$ 的强信号（由于高LD），以及AFR群体中仅在 $v_1$ 处的孤立强信号（由于较低的LD）。\n\n2.  **功能数据的整合：** 丰富的功能数据应作为先验信息整合到贝叶斯精细定位框架中。根据所给定的原理，这些先验必须是*经过校准的*——意味着它们的权重是基于对特定注释在全基因组范围内富集因果变异程度的估计。这避免了主观或过强的“确定性”先验的陷阱。鉴于所给数据，“增强子活性”、“TF基序破坏”和“显著的MPRA效应”等注释会适度增加 $v_1$ 的先验概率。\n\n3.  **预期的精细定位结果：** 一个正确建模LD并整合了适度功能先验的联合跨血统分析，会将后验概率集中在 $v_1$ 上。$v_2$ 的信号将完全被其与 $v_1$ 在EUR群体中的LD所解释。因此，$v_1$ 的后验包含概率 (PIP) 将会非常高（例如，$PIP  0.95$），而所有其他变异的PIP将接近于零。由此产生的 $95\\%$ 可信集将仅包含 $v_1$。\n\n4.  **变异-基因-机制：**\n    *   **共定位：** 将GWAS信号与基因 $G$ 联系起来，共定位分析是正确的方法。这需要GWAS性状和分子性状（eQTL/pQTL）的完整汇总统计数据和LD。鉴于 $v_1$ 在所有三个性状（GWAS、eQTL、pQTL）上都有一致的强信号，预计共享因果变异的后验概率会很高。\n    *   **机制假说：** 证据汇集指向一个清晰且一致的机制故事：$v_1$ 的备择等位基因破坏了增强子中的一个TF $X$ 结合位点，从而降低了增强子的活性。这反过来下调了基因 $G$ 的表达，导致蛋白质 $G$ 的水平降低，进而影响疾病或性状风险。从增强子到基因 $G$ 的联系应由3D染色质相互作用数据（如启动子捕获Hi-C）或整合了此类信息的计算评分（如ABC）来支持。\n\n5.  **实验验证：** 该假说必须通过实验进行检验。金标准是在生物学相关的细胞环境（如iPSC衍生的疾病相关细胞）中对候选因果变异（$v_1$）进行精确的基因组编辑（如CRISPR碱基编辑），以观察预期的分子后果（TF结合、基因表达、蛋白质水平的变化）。扰动调控元件（如通过CRISPRi）也是验证其功能的关键实验。\n\n### 逐项分析选项\n\n**A. 分析计划：** 此选项概述的分析流程与推导出的理想工作流程完全一致。\n-   它正确地提出了使用联合似然和特定血统LD的跨血统精细定位。\n-   它正确地提议对功能数据使用经过校准的分层先验。\n-   报告的结果（$PIP_{v_1} = 0.96$，可信集 $\\{v_1\\}$）与对给定数据进行正确分析的预期完全相符。\n-   它正确地将使用完整汇总统计数据的共定位确定为基因指派的方法，并用3D基因组证据（Hi-C/ABC）来加强这一点。\n-   提出的机制与每一项提供的数据完全一致。\n-   优先安排的实验计划（在相关细胞中进行碱基编辑、CRISPRi、等位基因特异性检测）代表了当前功能验证的金标准。\n-   **结论：** **正确**。\n\n**B. 分析计划：** 此选项包含多个基本错误。\n-   它丢弃了AFR数据，而这正是解析因果变异的关键。仅限EUR的分析将效力不足，导致错误的可信集 $\\{v_1, v_2\\}$。\n-   它将MPRA用作确定性过滤器，违反了陈述的原则，并且是一种粗糙的分析方法。\n-   它提出了一种过时的基因指派方法（最近的基因），而忽略了直接证据（eQTL）。\n-   它陈述的机制（增加活性）与eQTL和MPRA数据直接矛盾。\n-   实验计划薄弱，使用了不相关的细胞系和信息量较少的检测方法。\n-   **结论：** **错误**。\n\n**C. 分析计划：** 此选项基于统计上无效的方法。\n-   在忽略LD的情况下，通过反方差加权合并z分数，对于在连锁变异位点进行精细定位是根本错误的。这使得整个分析的前提都无效。\n-   从z分数的softmax计算PIP是一种粗略的近似，仅在独立的假设下有效，而这里违反了该假设。\n-   仅用$p$-值且无LD进行共定位不是一种有效或现代的方法。\n-   它在基因指派（邻近性）和实验设计（非特异性细胞系）上采取了与选项B相同的糟糕选择。\n-   **结论：** **错误**。\n\n**D. 分析计划：** 此选项描述了一种有偏见且不科学的分析。\n-   它提议应用一个沉重的、未校准的功能先验来强行得到一个期望的结果（$v_3$ 为因果变异），这直接违反了陈述的原则，并忽略了指向 $v_1$ 的压倒性关联和功能数据。这是确认偏误的例子，而非客观科学。\n-   其结论——可信集为 $\\{v_3\\}$ 以及弱功能信号足以作为理由——是这种有偏见的先验所造成的人为结果，而非证据本身。\n-   它优先考虑对一个证据非常少的变异进行实验，这将是对资源的低效利用。\n-   **结论：** **错误**。\n\n基于全面的评估，选项A是唯一一个描述了科学严谨、技术先进、内部一致，并根据给定原则正确解释了所有提供的数据的计划。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}