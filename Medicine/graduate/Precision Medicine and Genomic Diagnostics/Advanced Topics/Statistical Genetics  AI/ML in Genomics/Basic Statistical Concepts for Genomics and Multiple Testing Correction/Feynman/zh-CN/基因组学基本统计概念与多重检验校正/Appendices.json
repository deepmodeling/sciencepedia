{
    "hands_on_practices": [
        {
            "introduction": "在开始应用任何校正方法之前，首先必须从根本上理解为什么需要进行多重检验校正。这个练习通过一个思想实验，模拟了在所有原假设都为真的“全局无效”情景下，不进行任何校正的后果。通过从第一性原理出发，您将亲自计算出在数千次检验中预期会出现的假阳性数量，从而深刻体会到在基因组学等高通量研究中，多重比较如何极大地增加了犯第一类错误的风险。",
            "id": "4317840",
            "problem": "在一次与精准医疗相关的高通量基因组诊断筛查中，假设一个实验室评估了 $m=10{,}000$ 个独立的假设，每个假设对应一个独特的变异与治疗反应表型之间的关联。为了量化未经校正分析的基线假阳性行为，假设所有原假设都为真，并且计算出的 $p$-值在原假设下是独立的，且严格服从 $[0,1]$ 上的均匀分布。实验室计划，如果一个变异未经校正的 $p$-值至多为固定阈值 $\\alpha=0.001$，则称其为一个发现。\n\n仅从以下定义出发：在真实的原假设下，$p$-值的分布为 $\\mathrm{Uniform}(0,1)$；各项检验之间相互独立；家族谬误率（Family-Wise Error Rate, FWER）是在整个检验族中出现至少一个假发现的概率。请从第一性原理推导出：\n- 在阈值 $\\alpha$ 下，未经校正的发现的期望数量，以及\n- 在阈值 $\\alpha$ 下的家族谬误率（FWER）。\n\n将你的最终答案表示为一个有序对 $\\left(E, F\\right)$，其中 $E$ 是未经校正的发现的期望数量，$F$ 是 FWER。无需四舍五入，也不需要单位。",
            "solution": "用户想要解决一个关于基因组学中统计指标的问题。\n\n### 步骤 1：问题验证\n\n我将首先根据指定的程序验证问题陈述。\n\n#### 步骤 1.1：提取已知条件\n\n-   独立假设的数量：$m=10{,}000$\n-   条件：所有原假设都为真。\n-   p值的分布：独立同分布于 $\\mathrm{Uniform}(0,1)$。\n-   发现阈值：如果p值至多为 $\\alpha=0.001$，则宣告一个发现。\n-   家族谬误率（FWER）的定义：至少出现一个假发现的概率。\n-   要求输出：从第一性原理推导（a）未经校正的发现的期望数量 $E$，和（b）家族谬误率 $F$。\n\n#### 步骤 1.2：使用提取的已知条件进行验证\n\n-   **科学性：** 该问题牢固地植根于统计假设检验的基本原理，特别是在多重比较的背景下。其假设——即在原假设下，p值是独立的并服从 $\\mathrm{Uniform}(0,1)$ 分布——是该领域的基石。所描述的场景（所有原假设都为真的“全局原假设”）是一个标准的理论构造，用于评估多重检验程序在I类错误控制方面的最差性能。\n-   **适定性：** 这是一个适定的问题。它提供了所有必要的参数（$m$, $\\alpha$）、分布和定义，以唯一地确定我们感兴趣的量（$E$ 和 $F$）。\n-   **客观性：** 问题以精确、客观的数学语言陈述，没有任何歧义或主观论断。\n-   **完整性和一致性：** 问题设定是完整的且内部一致的。没有信息缺失，也没有相互矛盾的约束。\n-   **现实性：** 检验数量（$m=10{,}000$）和显著性阈值（$\\alpha=0.001$）的值对于基因组学中的高通量筛选是现实的。\n-   **结论：** 问题是有效的。这是生物统计学中一个标准的、基础性的问题，用于考察核心概念。\n\n### 步骤 2：解题推导\n\n既然问题是有效的，我现在将从第一性原理推导所需的量。\n\n#### 发现的期望数量（$E$）的推导\n\n设 $p_i$ 表示第 $i$ 个假设的p值，其中 $i \\in \\{1, 2, \\ldots, m\\}$。我们已知 $p_i \\sim \\mathrm{Uniform}(0,1)$。\n\n如果第 $i$ 个假设的p值满足 $p_i \\le \\alpha$，则认为有了一个发现。我们为这个事件定义一个指示随机变量 $D_i$：\n$$\nD_i = \n\\begin{cases} \n1  \\text{ if } p_i \\le \\alpha \\\\\n0  \\text{ if } p_i > \\alpha \n\\end{cases}\n$$\n变量 $D_i$ 服从伯努利分布，$D_i \\sim \\mathrm{Bernoulli}(\\pi)$，其中成功概率 $\\pi$ 是单个检验获得一个发现的概率。该概率由下式给出：\n$$\n\\pi = P(D_i = 1) = P(p_i \\le \\alpha)\n$$\n由于 $p_i$ 在区间 $[0,1]$ 上均匀分布，其累积分布函数（CDF）为 $F(x) = x$（对于 $x \\in [0,1]$）。因此，\n$$\n\\pi = P(p_i \\le \\alpha) = \\int_{0}^{\\alpha} 1 \\, dx = \\alpha\n$$\n这个伯努利随机变量的期望值是 $E[D_i] = \\pi = \\alpha$。\n\n我们用 $V$ 表示的发现总数，是所有 $m$ 个检验的单个指示变量之和：\n$$\nV = \\sum_{i=1}^{m} D_i\n$$\n未经校正的发现的期望数量 $E$ 是 $V$ 的期望。根据期望的线性性质，我们有：\n$$\nE = E[V] = E\\left[\\sum_{i=1}^{m} D_i\\right] = \\sum_{i=1}^{m} E[D_i]\n$$\n由于对所有 $i$ 都有 $E[D_i] = \\alpha$，所以总和变为：\n$$\nE = \\sum_{i=1}^{m} \\alpha = m \\alpha\n$$\n代入给定值 $m = 10{,}000$ 和 $\\alpha = 0.001$：\n$$\nE = 10{,}000 \\times 0.001 = 10\n$$\n\n#### 家族谬误率（FWER）的推导\n\n问题陈述所有原假设都为真。因此，根据定义，任何发现都是一个假发现（I类错误）。FWER 定义为出现至少一个假发现的概率。\n$$\n\\text{FWER} = P(\\text{至少一个发现}) = P(V \\ge 1)\n$$\n计算其互补事件的概率更直接，即零发现的概率，$P(V=0)$。\n$$\nP(V=0) = P(D_1=0 \\text{ and } D_2=0 \\text{ and } \\ldots \\text{ and } D_m=0)\n$$\n在单次检验中没有发现的概率是：\n$$\nP(D_i = 0) = P(p_i > \\alpha) = 1 - P(p_i \\le \\alpha) = 1 - \\alpha\n$$\n问题陈述p值是独立的。这意味着事件 $\\{D_i=0\\}$ 对所有 $i$ 也是独立的。因此，所有 $m$ 个检验都没有发现的概率是它们各自概率的乘积：\n$$\nP(V=0) = \\prod_{i=1}^{m} P(D_i=0) = \\prod_{i=1}^{m} (1-\\alpha) = (1-\\alpha)^m\n$$\n那么，我们记为 $F$ 的 FWER 是：\n$$\nF = \\text{FWER} = 1 - P(V=0) = 1 - (1-\\alpha)^m\n$$\n代入给定值 $m = 10{,}000$ 和 $\\alpha = 0.001$：\n$$\nF = 1 - (1 - 0.001)^{10000} = 1 - (0.999)^{10000}\n$$\n问题不要求数值近似，所以这个精确形式就是 FWER 的最终表达式。\n\n最终答案是有序对 $(E, F)$。\n$$\nE = 10\n$$\n$$\nF = 1 - (0.999)^{10000}\n$$",
            "answer": "$$\n\\boxed{(10, 1 - (0.999)^{10000})}\n$$"
        },
        {
            "introduction": "面对多重检验带来的挑战，最严格的应对策略是控制家族谬误率（Family-Wise Error Rate, FWER），即在所有检验中至少出现一个假阳性的概率。本练习将指导您推导两种控制FWER的基础方法：Bonferroni校正和Šidák校正。通过比较这两种方法，您将理解它们在假设（如检验独立性）上的差异，并认识到为保证极低的FWER，我们需要付出显著降低统计功效的代价。",
            "id": "4317801",
            "problem": "一项精准医疗全基因组关联研究评估了生殖系单核苷酸多态性（SNPs）与一个定量表型之间的关系。假设有 $m=1{,}000{,}000$ 个假设检验，并且该研究旨在将所有检验的家族谬误率（FWER）控制在 $\\alpha=0.05$ 的水平。\n\n从第一性原理出发，仅使用 FWER 的定义（即在所有真实的原假设中至少出现一个假阳性的概率）和基本概率法则来：\n\n1) 推导出一个控制 FWER 的程序的单次检验p值阈值，该程序使用一个不需要检验间存在依赖性假设的不等式（Bonferroni 程序）。\n\n2) 在 $m$ 个检验相互独立的假设下，推导出一个能精确控制 FWER 的程序的单次检验p值阈值（Šidák 程序）。\n\n然后，对于 $m=1{,}000{,}000$ 和 $\\alpha=0.05$ 的情况，数值计算这两个阈值，并简要比较它们在发现上的严格性，说明哪个阈值更保守，以及在相对尺度上大约保守多少。将你的两个数值阈值四舍五入到四位有效数字。将最终阈值表示为p值阈值（无单位）。",
            "solution": "家族谬误率（FWER）定义为在所有真实原假设的检验中，至少出现一个假阳性的概率。设 $V$ 是假阳性的数量，设 $A_{i}$ 是检验 $i$ 上出现假阳性的事件。那么\n$$\n\\mathrm{FWER}=\\mathbb{P}(V\\geq 1)=\\mathbb{P}\\Big(\\bigcup_{i=1}^{m}A_{i}\\Big).\n$$\n\nBonferroni 程序（在无依赖性假设下有效）：\n根据联合界（概率的次可加性），对于任何事件 $A_{1},\\dots,A_{m}$，\n$$\n\\mathbb{P}\\Big(\\bigcup_{i=1}^{m}A_{i}\\Big)\\leq \\sum_{i=1}^{m}\\mathbb{P}(A_{i}).\n$$\n如果每次检验使用单次检验显著性阈值 $t$（即当 $p_{i}\\leq t$ 时拒绝），那么在真实原假设下 $\\mathbb{P}(A_{i})\\leq t$。因此，\n$$\n\\mathrm{FWER}\\leq \\sum_{i=1}^{m} t = m t.\n$$\n为确保 $\\mathrm{FWER}\\leq \\alpha$，只需设置 $m t \\leq \\alpha$，从而得到 Bonferroni 阈值\n$$\nt_{\\mathrm{Bonf}}=\\frac{\\alpha}{m}.\n$$\n\nŠidák 程序（在独立性下精确）：\n假设 $m$ 个检验相互独立，并且每个检验的单次检验阈值为 $t$。在全局原假设下，没有假阳性发生的概率是每个单独的原假设不被错误拒绝的概率的乘积：\n$$\n\\mathbb{P}(V=0)=\\prod_{i=1}^{m} \\mathbb{P}(A_{i}^{c})=(1-t)^{m}.\n$$\n因此\n$$\n\\mathrm{FWER}=\\mathbb{P}(V\\geq 1)=1-\\mathbb{P}(V=0)=1-(1-t)^{m}.\n$$\n为实现 $\\mathrm{FWER}=\\alpha$，解方程 $1-(1-t)^{m}=\\alpha$，得到 Šidák 阈值\n$$\nt_{\\mathrm{Sidak}}=1-(1-\\alpha)^{1/m}.\n$$\n\n对于 $m=1{,}000{,}000$ 和 $\\alpha=0.05$ 的数值计算：\n首先，Bonferroni 阈值是\n$$\nt_{\\mathrm{Bonf}}=\\frac{0.05}{1{,}000{,}000}=5.0\\times 10^{-8}.\n$$\n其次，Šidák 阈值是\n$$\nt_{\\mathrm{Sidak}}=1-(1-0.05)^{1/1{,}000{,}000}=1-0.95^{10^{-6}}.\n$$\n使用自然对数来计算 $0.95^{10^{-6}}$，\n$$\n0.95^{10^{-6}}=\\exp\\!\\big(10^{-6}\\ln(0.95)\\big),\n$$\n其中 $\\ln(0.95)=-0.0512932943875\\ldots$，所以\n$$\n10^{-6}\\ln(0.95)=-5.12932943875\\ldots\\times 10^{-8}.\n$$\n对于如此小的量级，$\\exp(x)=1+x+\\frac{x^{2}}{2}+O(x^{3})$，因此\n$$\n0.95^{10^{-6}}=\\exp\\!\\big(-5.1293\\ldots\\times 10^{-8}\\big)\\approx 1-5.12932943875\\times 10^{-8}+\\frac{(5.12932943875\\times 10^{-8})^{2}}{2},\n$$\n且二次校正项约为 $1.315\\times 10^{-15}$，在四位有效数字的精度下可以忽略不计。因此\n$$\nt_{\\mathrm{Sidak}}\\approx 5.1293294386\\times 10^{-8}.\n$$\n将两个阈值四舍五入到四位有效数字，得到\n$$\nt_{\\mathrm{Bonf}}=5.000\\times 10^{-8},\\quad t_{\\mathrm{Sidak}}=5.129\\times 10^{-8}.\n$$\n\n对发现严格性的解释：\n两种程序都将 $m=1{,}000{,}000$ 个检验的总体错误率控制在 $\\alpha=0.05$，这导致了全基因组扫描中典型的极小的单次检验阈值。Bonferroni 阈值略小于 Šidák 阈值，因此更严格（更保守）。相对差异约为\n$$\n\\frac{t_{\\mathrm{Sidak}}-t_{\\mathrm{Bonf}}}{t_{\\mathrm{Bonf}}}\\approx \\frac{5.129\\times 10^{-8}-5.000\\times 10^{-8}}{5.000\\times 10^{-8}}\\approx 2.58\\times 10^{-2},\n$$\n也就是说，在基于独立性假设的 Šidák 校正下，允许的p值大约增加了 $2.6$%。在实践中，由于连锁不平衡，基因组检验表现出依赖性，因此相对于有效独立检验数，这两个阈值都倾向于保守，其中 Bonferroni 更为保守。",
            "answer": "$$\\boxed{\\begin{pmatrix}5.000 \\times 10^{-8}  5.129 \\times 10^{-8}\\end{pmatrix}}$$"
        },
        {
            "introduction": "在许多探索性的基因组学研究中，控制族群谬误率（FWER）可能过于严苛，会错过许多潜在的重要发现。一种更现代且通常更强大的方法是控制错误发现率（False Discovery Rate, FDR），即在所有被拒绝的原假设中，错误拒绝（假阳性）所占的期望比例。本练习将引导您应用两种经典的FDR控制程序：Benjamini-Hochberg (BH) 和 Benjamini-Yekutieli (BY) 方法。通过这个实践，您将学会如何平衡发现新关联的能力与控制假阳性比例，并理解不同方法在处理检验间相关性时的差异。",
            "id": "4317734",
            "problem": "在精准肿瘤学领域，一项靶向性生殖系测序研究评估了 $m=8$ 个候选基因与一个二元临床终点的关联性，得到了排序后的 $p$ 值 $p_{(1)} \\leq p_{(2)} \\leq \\cdots \\leq p_{(8)}$。排序后的 $p$ 值为\n$$\np_{(1)}=0.004,\\; p_{(2)}=0.006,\\; p_{(3)}=0.011,\\; p_{(4)}=0.018,\\; p_{(5)}=0.032,\\; p_{(6)}=0.041,\\; p_{(7)}=0.072,\\; p_{(8)}=0.12.\n$$\n在名义水平 $\\alpha=0.1$ 下，应用两种控制错误发现率（FDR）的步进式多重检验程序：Benjamini–Hochberg (BH) 程序（在独立性或某些正相关结构下控制 FDR）和 Benjamini–Yekutieli (BY) 程序（在任意依赖结构下控制 FDR）。对于每种程序，确定在 $\\alpha$ 水平下哪些假设被拒绝，并令 $D_{\\mathrm{BH}}$ 和 $D_{\\mathrm{BY}}$ 分别表示在 BH 和 BY 程序下被拒绝的假设数量。报告单个数值 $D_{\\mathrm{BH}}-D_{\\mathrm{BY}}$。将最终答案表示为整数，无需四舍五入。",
            "solution": "用户提供了有效的问题陈述。\n\n### 第 1 步：提取已知信息\n- 待检验的假设数量：$m=8$。\n- 排序后的 $p$ 值：$p_{(1)}=0.004, p_{(2)}=0.006, p_{(3)}=0.011, p_{(4)}=0.018, p_{(5)}=0.032, p_{(6)}=0.041, p_{(7)}=0.072, p_{(8)}=0.12$。\n- 期望的错误发现率（FDR）控制水平：$\\alpha=0.1$。\n- 需应用的程序：Benjamini–Hochberg (BH) 和 Benjamini–Yekutieli (BY)。\n- 待确定的量：$D_{\\mathrm{BH}}$（BH 程序下拒绝的假设数量）和 $D_{\\mathrm{BY}}$（BY 程序下拒绝的假设数量）。\n- 需报告的最终值：$D_{\\mathrm{BH}} - D_{\\mathrm{BY}}$。\n\n### 第 2 步：使用提取的信息进行验证\n该问题具有科学依据，提法明确且客观。它展示了两种用于多重检验校正的基本统计程序的标准应用，这两种程序在基因组数据分析中至关重要。所有必要的数据均已提供，术语精确，设置无任何矛盾、模糊或事实错误。该问题要求直接且严谨地应用已确立的算法，从而得到一个唯一的、可验证的解。\n\n### 第 3 步：结论与行动\n问题有效。将提供完整解答。\n\n该问题要求应用两种不同的多重假设检验程序，即 Benjamini-Hochberg (BH) 程序和 Benjamini-Yekutieli (BY) 程序，以在名义水平 $\\alpha=0.1$ 下控制错误发现率（FDR）。我们从一项基因组研究中得到了 $m=8$ 个排序后的 $p$ 值。\n\n首先，我们应用 Benjamini-Hochberg (BH) 程序。这是一个步进式程序，它在检验是独立的或满足正回归依赖性的假设下控制 FDR。该程序如下：给定排序后的 $p$ 值 $p_{(1)} \\leq p_{(2)} \\leq \\cdots \\leq p_{(m)}$，我们找到满足\n$$p_{(k)} \\leq \\frac{k}{m} \\alpha$$\n的最大整数 $k$。如果存在这样的 $k$，我们拒绝与 $p$ 值 $p_{(1)}, p_{(2)}, \\dots, p_{(k)}$ 对应的原假设。拒绝的数量为 $D_{\\mathrm{BH}} = k$。如果不存在这样的 $k$，则不拒绝任何假设。\n\n在这个问题中，$m=8$ 且 $\\alpha=0.1$。对于每个排序后的 $p$ 值 $p_{(k)}$，BH 阈值为 $\\frac{k}{8}(0.1) = 0.0125 \\cdot k$。我们对从 $k=1$ 到 $k=8$ 的每个 $k$ 检验该条件。\n\n对于 $k=1$：$p_{(1)} = 0.004$。阈值为 $0.0125 \\times 1 = 0.0125$。因为 $0.004 \\leq 0.0125$，所以条件成立。\n对于 $k=2$：$p_{(2)} = 0.006$。阈值为 $0.0125 \\times 2 = 0.025$。因为 $0.006 \\leq 0.025$，所以条件成立。\n对于 $k=3$：$p_{(3)} = 0.011$。阈值为 $0.0125 \\times 3 = 0.0375$。因为 $0.011 \\leq 0.0375$，所以条件成立。\n对于 $k=4$：$p_{(4)} = 0.018$。阈值为 $0.0125 \\times 4 = 0.05$。因为 $0.018 \\leq 0.05$，所以条件成立。\n对于 $k=5$：$p_{(5)} = 0.032$。阈值为 $0.0125 \\times 5 = 0.0625$。因为 $0.032 \\leq 0.0625$，所以条件成立。\n对于 $k=6$：$p_{(6)} = 0.041$。阈值为 $0.0125 \\times 6 = 0.075$。因为 $0.041 \\leq 0.075$，所以条件成立。\n对于 $k=7$：$p_{(7)} = 0.072$。阈值为 $0.0125 \\times 7 = 0.0875$。因为 $0.072 \\leq 0.0875$，所以条件成立。\n对于 $k=8$：$p_{(8)} = 0.12$。阈值为 $0.0125 \\times 8 = 0.1$。因为 $0.12 > 0.1$，所以条件不成立。\n\n满足条件 $p_{(k)} \\leq \\frac{k}{m} \\alpha$ 的最大 $k$ 值为 $7$。因此，在 BH 程序下，我们拒绝与 $7$ 个最小的 $p$ 值对应的原假设。被拒绝的假设数量为 $D_{\\mathrm{BH}} = 7$。\n\n接下来，我们应用 Benjamini-Yekutieli (BY) 程序。这个程序更严格，它在检验之间存在任意依赖结构的情况下控制 FDR。它通过引入一个校正因子 $C(m)$ 来修改 BH 程序，该因子是第 $m$ 个调和数。该程序如下：找到满足\n$$p_{(k)} \\leq \\frac{k}{m \\cdot C(m)} \\alpha$$\n的最大整数 $k$，其中 $C(m) = \\sum_{i=1}^{m} \\frac{1}{i}$。拒绝的数量为 $D_{\\mathrm{BY}}=k$。\n\n对于 $m=8$，校正因子为 $C(8) = H_8$，即第 $8$ 个调和数。\n$$C(8) = \\sum_{i=1}^{8} \\frac{1}{i} = \\frac{1}{1} + \\frac{1}{2} + \\frac{1}{3} + \\frac{1}{4} + \\frac{1}{5} + \\frac{1}{6} + \\frac{1}{7} + \\frac{1}{8}$$\n使用公分母 $840$ 计算这个和：\n$$C(8) = \\frac{840}{840} + \\frac{420}{840} + \\frac{280}{840} + \\frac{210}{840} + \\frac{168}{840} + \\frac{140}{840} + \\frac{120}{840} + \\frac{105}{840} = \\frac{840+420+280+210+168+140+120+105}{840} = \\frac{2283}{840} = \\frac{761}{280}$$\n用小数形式表示，$C(8) \\approx 2.717857$。\n对于每个排序后的 $p$ 值 $p_{(k)}$，BY 阈值为 $\\frac{k}{m \\cdot C(m)} \\alpha = \\frac{k}{8 \\cdot (761/280)} (0.1) = \\frac{k \\cdot 0.1}{(761/35)} = \\frac{3.5 \\cdot k}{761}$。\n\n我们对每个 $k$ 检验该条件：\n$k$ 的阈值：$T_k = \\frac{3.5k}{761}$。\n对于 $k=1$：$p_{(1)} = 0.004$。阈值为 $T_1 = \\frac{3.5}{761} \\approx 0.004599$。因为 $0.004 \\leq T_1$，所以条件成立。\n对于 $k=2$：$p_{(2)} = 0.006$。阈值为 $T_2 = \\frac{7.0}{761} \\approx 0.009198$。因为 $0.006 \\leq T_2$，所以条件成立。\n对于 $k=3$：$p_{(3)} = 0.011$。阈值为 $T_3 = \\frac{10.5}{761} \\approx 0.013798$。因为 $0.011 \\leq T_3$，所以条件成立。\n对于 $k=4$：$p_{(4)} = 0.018$。阈值为 $T_4 = \\frac{14.0}{761} \\approx 0.018397$。因为 $0.018 \\leq T_4$，所以条件成立。\n对于 $k=5$：$p_{(5)} = 0.032$。阈值为 $T_5 = \\frac{17.5}{761} \\approx 0.022996$。因为 $0.032 > T_5$，所以条件不成立。\n由于当 $k=5$ 时条件不成立，我们无需检查 $k > 5$ 的情况。\n\n满足条件 $p_{(k)} \\leq \\frac{k}{m \\cdot C(m)} \\alpha$ 的最大 $k$ 值为 $4$。因此，在 BY 程序下，我们拒绝与 $4$ 个最小的 $p$ 值对应的原假设。被拒绝的假设数量为 $D_{\\mathrm{BY}} = 4$。\n\n问题要求计算 $D_{\\mathrm{BH}} - D_{\\mathrm{BY}}$ 的值。\n$D_{\\mathrm{BH}} = 7$\n$D_{\\mathrm{BY}} = 4$\n差值为 $D_{\\mathrm{BH}} - D_{\\mathrm{BY}} = 7 - 4 = 3$。",
            "answer": "$$\\boxed{3}$$"
        }
    ]
}