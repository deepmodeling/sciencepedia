{
    "hands_on_practices": [
        {
            "introduction": "精准医学试验的基石在于能够准确地将患者分配到最有可能受益的治疗组。这个分配过程通常依赖于生物标志物检测。本练习将探讨诊断检测并非完美时所带来的实际影响 。通过应用贝叶斯定理，您将学习如何计算阳性预测值（PPV）和阴性预测值（NPV）等关键指标，并量化在特定患者队列中因诊断错误而可能被错误分配的预期患者人数。这项技能对于评估临床试验设计的稳健性和解读其结果至关重要。",
            "id": "4326317",
            "problem": "一项精准肿瘤学领域的伞式临床试验使用集中式基因组诊断，在单一组织学癌症类型中将患者分配到生物标志物导向的治疗组。生物标志物 $B$ 用于识别一种可靶向变异。接受筛选的入组人群中，生物标志物的普遍率为 $p = 0.05$。该检测的灵敏度（真阳性率）为 $0.92$，特异度（真阴性率）为 $0.99$。设 $n = 200$ 为连续筛选并考虑分配治疗组的患者数量。\n\n仅使用灵敏度、特异度和贝叶斯定理的定义，并假设各患者的结果是独立的伯努利结果，推导该检测对生物标志物 $B$ 的阳性预测值 (PPV) 和阴性预测值 (NPV) 的表达式（用 $p$、灵敏度和特异度表示），然后根据给定的参数值进行计算。将“错误分配的患者”定义为：尽管实际不含生物标志物 $B$ 却被分配到生物标志物阳性组的筛选患者（假阳性），或者尽管实际含有生物标志物 $B$ 却未被分配到生物标志物阳性组的筛选患者（假阴性）。在独立性假设下，计算这组 $n = 200$ 的患者中错误分配患者的期望数量。\n\n将所有数值答案四舍五入至四位有效数字。将 PPV 和 NPV 表示为无单位的小数。以患者人数表示错误分配的期望数量。",
            "solution": "首先，我们定义相关事件，并将给定参数转换为概率符号。\n设 $D^+$ 为患者确实拥有生物标志物 $B$ 的事件。\n设 $D^-$ 为患者确实没有生物标志物 $B$ 的事件。\n设 $T^+$ 为检测结果为阳性的事件。\n设 $T^-$ 为检测结果为阴性的事件。\n\n根据问题陈述，我们已知：\n生物标志物的普遍率，$p = P(D^+) = 0.05$。\n患者不拥有生物标志物的概率是 $P(D^-) = 1 - P(D^+) = 1 - p = 1 - 0.05 = 0.95$。\n检测的灵敏度，$\\text{sens} = P(T^+ | D^+) = 0.92$。这是真阳性率。\n检测的特异度，$\\text{spec} = P(T^- | D^-) = 0.99$。这是真阴性率。\n筛选的患者总数为 $n = 200$。\n\n根据这些定义，我们可以推导出错误检测结果的概率：\n假阳性率 (FPR) 为 $P(T^+ | D^-) = 1 - P(T^- | D^-) = 1 - \\text{spec} = 1 - 0.99 = 0.01$。\n假阴性率 (FNR) 为 $P(T^- | D^+) = 1 - P(T^+ | D^+) = 1 - \\text{sens} = 1 - 0.92 = 0.08$。\n\n### PPV 和 NPV 的推导\n阳性预测值 (PPV) 是指检测结果为阳性的患者确实拥有该生物标志物的概率，即 $P(D^+ | T^+)$。使用贝叶斯定理：\n$$ \\text{PPV} = P(D^+ | T^+) = \\frac{P(T^+ | D^+) P(D^+)}{P(T^+)} $$\n分母 $P(T^+)$ 是检测结果为阳性的总概率，可以使用全概率公式计算：\n$$ P(T^+) = P(T^+ | D^+) P(D^+) + P(T^+ | D^-) P(D^-) $$\n代入符号定义：\n$$ P(T^+) = (\\text{sens}) \\cdot p + (1 - \\text{spec}) \\cdot (1 - p) $$\n因此，PPV 的表达式为：\n$$ \\text{PPV} = \\frac{(\\text{sens}) \\cdot p}{(\\text{sens}) \\cdot p + (1 - \\text{spec}) \\cdot (1 - p)} $$\n\n阴性预测值 (NPV) 是指检测结果为阴性的患者确实不拥有该生物标志物的概率，即 $P(D^- | T^-)$。使用贝叶斯定理：\n$$ \\text{NPV} = P(D^- | T^-) = \\frac{P(T^- | D^-) P(D^-)}{P(T^-)} $$\n分母 $P(T^-)$ 是检测结果为阴性的总概率：\n$$ P(T^-) = P(T^- | D^-) P(D^-) + P(T^- | D^+) P(D^+) $$\n代入符号定义：\n$$ P(T^-) = (\\text{spec}) \\cdot (1 - p) + (1 - \\text{sens}) \\cdot p $$\n因此，NPV 的表达式为：\n$$ \\text{NPV} = \\frac{(\\text{spec}) \\cdot (1 - p)}{(\\text{spec}) \\cdot (1 - p) + (1 - \\text{sens}) \\cdot p} $$\n\n### PPV 和 NPV 的计算\n现在我们将给定的数值代入推导出的表达式中。\n对于 PPV：\n$$ \\text{PPV} = \\frac{0.92 \\cdot 0.05}{0.92 \\cdot 0.05 + (1 - 0.99) \\cdot (1 - 0.05)} = \\frac{0.046}{0.046 + 0.01 \\cdot 0.95} = \\frac{0.046}{0.046 + 0.0095} = \\frac{0.046}{0.0555} \\approx 0.8288288... $$\n四舍五入至四位有效数字，$\\text{PPV} = 0.8288$。\n\n对于 NPV：\n$$ \\text{NPV} = \\frac{0.99 \\cdot (1 - 0.05)}{0.99 \\cdot (1 - 0.05) + (1 - 0.92) \\cdot 0.05} = \\frac{0.99 \\cdot 0.95}{0.99 \\cdot 0.95 + 0.08 \\cdot 0.05} = \\frac{0.9405}{0.9405 + 0.004} = \\frac{0.9405}{0.9445} \\approx 0.9957649... $$\n四舍五入至四位有效数字，$\\text{NPV} = 0.9958$。\n\n### 错误分配患者的期望数量\n错误分配的患者被定义为假阳性 (FP) 或假阴性 (FN)。从筛选人群中随机选择一名患者被错误分配的概率 $P(\\text{misassigned})$ 是这两个互斥事件的概率之和。\n\n假阳性的概率是不拥有生物标志物且检测结果为阳性的联合概率，即 $P(D^- \\cap T^+)$。\n$$ P(\\text{FP}) = P(T^+ | D^-) P(D^-) = (1 - \\text{spec})(1 - p) $$\n假阴性的概率是拥有生物标志物且检测结果为阴性的联合概率，即 $P(D^+ \\cap T^-)$。\n$$ P(\\text{FN}) = P(T^- | D^+) P(D^+) = (1 - \\text{sens}) p $$\n\n单个患者被错误分配的总概率是：\n$$ P(\\text{misassigned}) = P(\\text{FP}) + P(\\text{FN}) = (1 - \\text{spec})(1 - p) + (1 - \\text{sens}) p $$\n设 $M$ 是一个队列 $n$ 中错误分配患者数量的随机变量。由于假设每个患者的筛选结果是独立的伯努利试验，错误分配患者的期望数量 $E[M]$ 等于患者总数 $n$ 乘以单个患者被错误分配的概率。\n$$ E[M] = n \\cdot P(\\text{misassigned}) = n \\cdot \\left[ (1 - \\text{spec})(1 - p) + (1 - \\text{sens}) p \\right] $$\n\n代入给定的数值：\n$$ E[M] = 200 \\cdot \\left[ (1 - 0.99)(1 - 0.05) + (1 - 0.92)(0.05) \\right] $$\n$$ E[M] = 200 \\cdot \\left[ (0.01)(0.95) + (0.08)(0.05) \\right] $$\n$$ E[M] = 200 \\cdot \\left[ 0.0095 + 0.0040 \\right] $$\n$$ E[M] = 200 \\cdot 0.0135 = 2.7 $$\n四舍五入至四位有效数字，错误分配患者的期望数量为 $2.700$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.8288  0.9958  2.700 \\end{pmatrix}}$$"
        },
        {
            "introduction": "篮子、伞形和平台试验的一个共同特点是它们会同时检验多个假设（例如，每个队列或治疗臂一个假设），这会增加仅凭偶然性就得出阳性结果的风险。为了保持科学的严谨性，必须控制总体错误率（Family-Wise Error Rate, FWER），即在所有检验中至少犯一个I类错误的概率。本练习将引导您应用经典的Bonferroni校正法和更具统计效力的Holm程序来调整p值 。掌握这些多重检验校正方法对于从复杂的多臂试验中得出可靠结论是不可或缺的。",
            "id": "4326251",
            "problem": "一项精准肿瘤学篮子试验在 $K=6$ 个共享一个预测性基因组生物标志物的组织学定义队列中评估一种靶向治疗。每个队列针对一个共同的原假设，对一个二元临床终点实施单边假设检验，产生的原始 $p$ 值为 $\\{0.002,\\,0.017,\\,0.04,\\,0.06,\\,0.21,\\,0.33\\}$。在篮子试验、伞式试验和平台试验等多队列设计中，控制族错误率 (FWER) 对科学有效性至关重要。从 FWER 的定义和联合界 (Bonferroni 不等式)，以及序贯拒绝法所依据的通用降步法原则出发，推导 $K$ 个假设的 Bonferroni 程序和 Holm 程序的校正 $p$ 值。\n\n然后，将这些推导应用于六个队列以计算：\n1. 每个队列的 Bonferroni 校正 $p$ 值。\n2. 每个队列的 Holm 校正 $p$ 值（排序后的结果必须映射回原始队列索引，此处遵循给定 $p$ 值的升序）。\n\n通过将校正 $p$ 值与显著性水平 $\\alpha=0.05$ 进行比较来解释决策。将每个决策数值编码为 $1$（“拒绝该队列的原假设”）和 $0$（“不拒绝”）。将所有校正 $p$ 值四舍五入至四位有效数字。将最终答案报告为单个行矩阵，按以下连接顺序排列：\n- 队列 1 到 6 的 Bonferroni 校正 $p$ 值，\n- 队列 1 到 6 的 Holm 校正 $p$ 值，\n- Bonferroni 决策（按队列顺序），\n- Holm 决策（按队列顺序）。",
            "solution": "设有 $K$ 个原假设 $H_1, H_2, \\dots, H_K$ 及其对应的原始 $p$ 值 $p_1, p_2, \\dots, p_K$。多重检验程序的目标是控制族错误率 (FWER)，即在一族 $K$ 个检验中犯至少一个 I 型错误（错误地拒绝一个真实的原假设）的概率。如果一个程序满足 $FWER \\le \\alpha$，则称该程序在水平 $\\alpha$ 上控制了 FWER。\n\n设 $I_0$ 是对应于真实原假设的索引集合。那么，\n$$FWER = P\\left(\\bigcup_{i \\in I_0} \\{\\text{拒绝 } H_i\\}\\right)$$\n\n**Bonferroni 程序的推导**\nBonferroni 程序基于布尔不等式或联合界不等式，该不等式表明对于任何事件集合 $A_1, \\dots, A_K$：\n$$P\\left(\\bigcup_{i=1}^K A_i\\right) \\le \\sum_{i=1}^K P(A_i)$$\n将此应用于 FWER 的定义：\n$$FWER = P\\left(\\bigcup_{i \\in I_0} \\{\\text{拒绝 } H_i\\}\\right) \\le \\sum_{i \\in I_0} P(\\text{拒绝 } H_i)$$\n简单的 Bonferroni 方法在原始 $p$ 值 $p_i$ 小于或等于 $\\alpha/K$ 时拒绝假设 $H_i$。在真实的原假设 $H_i$ 下，$p$ 值 $p_i$ 服从 Uniform($0,1$) 分布，因此 $P(p_i \\le c) = c$。所以，$P(\\text{拒绝 } H_i) = P(p_i \\le \\alpha/K) = \\alpha/K$。\n将此代入不等式：\n$$FWER \\le \\sum_{i \\in I_0} \\frac{\\alpha}{K} = |I_0| \\frac{\\alpha}{K} \\le K \\frac{\\alpha}{K} = \\alpha$$\n这证明了该程序在水平 $\\alpha$ 上控制了 FWER。\n\nBonferroni 校正 $p$ 值 $\\tilde{p}_i^{\\text{Bonf}}$ 是使得假设 $H_i$ 被拒绝的最小总体显著性水平 $\\alpha$。当 $p_i \\le \\alpha/K$ 时发生拒绝，这等价于 $K p_i \\le \\alpha$。因此，校正 $p$ 值定义为：\n$$\\tilde{p}_i^{\\text{Bonf}} = \\min(K p_i, 1)$$\n该值以 1 为上限，因为概率不能超过 1。\n\n**Holm 程序的推导**\nHolm 程序是一种序贯降步法，其功效统一优于 Bonferroni 程序。它遵循以下步骤：\n1.  将原始 $p$ 值从小到大排序：$p_{(1)} \\le p_{(2)} \\le \\dots \\le p_{(K)}$。设相应的假设为 $H_{(1)}, H_{(2)}, \\dots, H_{(K)}$。\n2.  对于 $j = 1, 2, \\dots, K$，将第 $j$ 个有序 $p$ 值 $p_{(j)}$ 与一个序贯调整的显著性水平 $\\alpha / (K - j + 1)$ 进行比较。\n3.  如果 $p_{(1)} \\le \\alpha/K$，则拒绝 $H_{(1)}$ 并进行到步骤 $j=2$。否则，不拒绝所有假设并停止。\n4.  一般地，如果 $H_{(1)}, \\dots, H_{(j-1)}$ 已被拒绝，则将 $p_{(j)}$ 与 $\\alpha/(K - j + 1)$ 进行比较。如果 $p_{(j)} \\le \\alpha/(K - j + 1)$，则拒绝 $H_{(j)}$ 并继续。否则，不拒绝 $H_{(j)}$ 及所有剩余的假设 $H_{(j+1)}, \\dots, H_{(K)}$，并停止。\n\n第 $j$ 个有序假设 $H_{(j)}$ 的 Holm 校正 $p$ 值 $\\tilde{p}_{(j)}^{\\text{Holm}}$ 是从这个序贯过程中推导出来的。要拒绝 $H_{(j)}$，我们必须已经拒绝了所有在它之前的假设 $H_{(i)}$（对于 $i  j$）。这要求对于所有 $i = 1, \\dots, j$，都有 $p_{(i)} \\le \\alpha/(K - i + 1)$。这等价于要求对于所有 $i = 1, \\dots, j$，都有 $\\alpha \\ge (K - i + 1)p_{(i)}$。因此，对于 $H_{(j)}$，满足此条件的最小 $\\alpha$ 是这些所需值的最大值。为确保校正后的 $p$ 值是单调不减的，我们将第 $j$ 个有序假设的校正 $p$ 值定义为：\n$$\\tilde{p}_{(j)}^{\\text{Holm}} = \\min\\left(1, \\max_{i=1, \\dots, j} \\{(K-i+1)p_{(i)}\\}\\right)$$\n这可以递归计算：\n$\\tilde{p}_{(1)}^{\\text{Holm}} = \\min(1, K p_{(1)})$\n$\\tilde{p}_{(j)}^{\\text{Holm}} = \\min(1, \\max(\\tilde{p}_{(j-1)}^{\\text{Holm}}, (K-j+1)p_{(j)}))$ 对于 $j > 1$。\n\n**应用于给定数据**\n队列（假设）的数量为 $K=6$。原始 $p$ 值已按升序提供：\n$p_{(1)} = 0.002$\n$p_{(2)} = 0.017$\n$p_{(3)} = 0.04$\n$p_{(4)} = 0.06$\n$p_{(5)} = 0.21$\n$p_{(6)} = 0.33$\n\n显著性水平为 $\\alpha = 0.05$。\n\n**1. Bonferroni 校正 $p$ 值和决策**\n我们使用公式 $\\tilde{p}_j^{\\text{Bonf}} = \\min(6 p_j, 1)$。\n$\\tilde{p}_1^{\\text{Bonf}} = \\min(6 \\times 0.002, 1) = \\min(0.012, 1) = 0.01200$\n$\\tilde{p}_2^{\\text{Bonf}} = \\min(6 \\times 0.017, 1) = \\min(0.102, 1) = 0.1020$\n$\\tilde{p}_3^{\\text{Bonf}} = \\min(6 \\times 0.04, 1) = \\min(0.24, 1) = 0.2400$\n$\\tilde{p}_4^{\\text{Bonf}} = \\min(6 \\times 0.06, 1) = \\min(0.36, 1) = 0.3600$\n$\\tilde{p}_5^{\\text{Bonf}} = \\min(6 \\times 0.21, 1) = \\min(1.26, 1) = 1.000$\n$\\tilde{p}_6^{\\text{Bonf}} = \\min(6 \\times 0.33, 1) = \\min(1.98, 1) = 1.000$\n\n决策：如果 $\\tilde{p}_j^{\\text{Bonf}} \\le 0.05$，则拒绝 $H_j$。\n- 队列 1: $0.01200 \\le 0.05 \\implies$ 拒绝 (1)\n- 队列 2: $0.1020 > 0.05 \\implies$ 不拒绝 (0)\n- 队列 3: $0.2400 > 0.05 \\implies$ 不拒绝 (0)\n- 队列 4: $0.3600 > 0.05 \\implies$ 不拒绝 (0)\n- 队列 5: $1.000 > 0.05 \\implies$ 不拒绝 (0)\n- 队列 6: $1.000 > 0.05 \\implies$ 不拒绝 (0)\n\n**2. Holm 校正 $p$ 值和决策**\n我们使用递归公式 $\\tilde{p}_{(j)}^{\\text{Holm}} = \\min(1, \\max(\\tilde{p}_{(j-1)}^{\\text{Holm}}, (K-j+1)p_{(j)}))$。\n- 对于 $j=1$: $\\tilde{p}_{(1)}^{\\text{Holm}} = \\min(1, (6-1+1)p_{(1)}) = \\min(1, 6 \\times 0.002) = 0.01200$。\n- 对于 $j=2$: $\\tilde{p}_{(2)}^{\\text{Holm}} = \\min(1, \\max(\\tilde{p}_{(1)}^{\\text{Holm}}, (6-2+1)p_{(2)})) = \\min(1, \\max(0.012, 5 \\times 0.017)) = \\min(1, \\max(0.012, 0.085)) = 0.08500$。\n- 对于 $j=3$: $\\tilde{p}_{(3)}^{\\text{Holm}} = \\min(1, \\max(\\tilde{p}_{(2)}^{\\text{Holm}}, (6-3+1)p_{(3)})) = \\min(1, \\max(0.085, 4 \\times 0.04)) = \\min(1, \\max(0.085, 0.16)) = 0.1600$。\n- 对于 $j=4$: $\\tilde{p}_{(4)}^{\\text{Holm}} = \\min(1, \\max(\\tilde{p}_{(3)}^{\\text{Holm}}, (6-4+1)p_{(4)})) = \\min(1, \\max(0.16, 3 \\times 0.06)) = \\min(1, \\max(0.16, 0.18)) = 0.1800$。\n- 对于 $j=5$: $\\tilde{p}_{(5)}^{\\text{Holm}} = \\min(1, \\max(\\tilde{p}_{(4)}^{\\text{Holm}}, (6-5+1)p_{(5)})) = \\min(1, \\max(0.18, 2 \\times 0.21)) = \\min(1, \\max(0.18, 0.42)) = 0.4200$。\n- 对于 $j=6$: $\\tilde{p}_{(6)}^{\\text{Holm}} = \\min(1, \\max(\\tilde{p}_{(5)}^{\\text{Holm}}, (6-6+1)p_{(6)})) = \\min(1, \\max(0.42, 1 \\times 0.33)) = \\min(1, 0.42) = 0.4200$。\n\nHolm 校正 $p$ 值集合（四舍五入至四位有效数字）为：$\\{0.01200, 0.08500, 0.1600, 0.1800, 0.4200, 0.4200\\}$。\n\n决策：如果 $\\tilde{p}_j^{\\text{Holm}} \\le 0.05$，则拒绝 $H_j$。\n- 队列 1: $0.01200 \\le 0.05 \\implies$ 拒绝 (1)\n- 队列 2: $0.08500 > 0.05 \\implies$ 不拒绝 (0)\n- 队列 3: $0.1600 > 0.05 \\implies$ 不拒绝 (0)\n- 队列 4: $0.1800 > 0.05 \\implies$ 不拒绝 (0)\n- 队列 5: $0.4200 > 0.05 \\implies$ 不拒绝 (0)\n- 队列 6: $0.4200 > 0.05 \\implies$ 不拒绝 (0)\n\n在这种情况下，两种方法得出相同的结论：只有第一个队列的原假设被拒绝。\n\n最终答案构成：\n- Bonferroni 校正 $p$ 值：$0.01200, 0.1020, 0.2400, 0.3600, 1.000, 1.000$\n- Holm 校正 $p$ 值：$0.01200, 0.08500, 0.1600, 0.1800, 0.4200, 0.4200$\n- Bonferroni 决策：$1, 0, 0, 0, 0, 0$\n- Holm 决策：$1, 0, 0, 0, 0, 0$\n这些将组合成一个单一的行矩阵。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.01200  0.1020  0.2400  0.3600  1.000  1.000  0.01200  0.08500  0.1600  0.1800  0.4200  0.4200  1  0  0  0  0  0  1  0  0  0  0  0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "平台试验等自适应设计的一个核心优势是能够根据累积的数据进行动态调整，例如，将更多患者分配到看起来更有希望的治疗臂中，从而提高试验效率和伦理水平。这种“边学习边优化”的策略通常基于贝叶斯统计框架，在该框架中，关于疗效的先验信念会随着新数据的出现而不断更新。本练习将带您实践反应自适应随机分配的核心机制 ，您将运用贝叶斯共轭先验模型（Beta-Binomial模型）来计算后验概率，并据此调整患者分配比例。",
            "id": "4326226",
            "problem": "考虑一个在精准肿瘤学多臂平台试验中的响应自适应随机化策略，其中三种靶向疗法正在对一个由生物标志物定义的人群进行并行评估。设每个臂具有二元结局（成功与失败），并假设各臂的响应概率服从独立的贝塔-二项模型。具体来说，假设每个臂的响应概率的先验分布为贝塔先验 $\\operatorname{Beta}(1,1)$。您观察到的累积数据包括成功数 $(s_1,s_2,s_3)=(12,8,4)$ 和失败数 $(f_1,f_2,f_3)=(18,22,26)$。下一个待随机化的队列规模为 $N=270$ 名患者。决策策略是，根据指定的先验和观测数据，在贝塔-二项模型下，以与每个臂的后验期望响应概率成正比的概率来分配患者。\n\n从贝叶斯定理的基本定义以及贝塔先验与二项似然的共轭性出发，推导三个臂的响应概率的更新后验分布和后验期望。然后，推导所述策略所隐含的归一化分配概率，并计算下一队列 $N=270$ 名患者中每个臂的期望样本量。\n\n将三个分配概率和三个期望样本量以单行矩阵的形式报告。将期望样本量表示为患者计数。不要对任何数量进行四舍五入；提供精确值。",
            "solution": "设 $\\theta_k$ 为臂 $k$ 的未知真实响应概率，其中 $k \\in \\{1, 2, 3\\}$。每个臂的结局都是二元的（成功或失败），因此在 $n_k$ 次试验中成功次数 $s_k$ 服从二项分布，$s_k \\sim \\operatorname{Binomial}(n_k, \\theta_k)$。\n\n问题指定了贝塔-二项模型。对于每个臂 $k$，我们被给予了响应概率 $\\theta_k$ 的一个先验分布。该先验是一个贝塔分布，$\\theta_k \\sim \\operatorname{Beta}(\\alpha_0, \\beta_0)$。问题说明这是一个 $\\operatorname{Beta}(1, 1)$ 先验，即区间 $[0, 1]$ 上的均匀分布。因此，初始参数为 $\\alpha_0 = 1$ 和 $\\beta_0 = 1$。先验的概率密度函数为 $p(\\theta_k) = \\frac{\\Gamma(\\alpha_0+\\beta_0)}{\\Gamma(\\alpha_0)\\Gamma(\\beta_0)} \\theta_k^{\\alpha_0-1} (1-\\theta_k)^{\\beta_0-1}$，其中 $\\theta_k \\in [0, 1]$。\n\n在 $n_k = s_k + f_k$ 次试验中观察到 $s_k$ 次成功和 $f_k$ 次失败的似然由二项概率质量函数给出，它与 $\\theta_k^{s_k} (1-\\theta_k)^{f_k}$ 成正比。\n\n根据贝叶斯定理，$\\theta_k$ 的后验分布与先验分布和似然函数的乘积成正比：\n$$p(\\theta_k | s_k, f_k) \\propto p(\\theta_k) \\times L(\\theta_k | s_k, f_k)$$\n$$p(\\theta_k | s_k, f_k) \\propto \\left[ \\theta_k^{\\alpha_0-1} (1-\\theta_k)^{\\beta_0-1} \\right] \\times \\left[ \\theta_k^{s_k} (1-\\theta_k)^{f_k} \\right]$$\n$$p(\\theta_k | s_k, f_k) \\propto \\theta_k^{\\alpha_0+s_k-1} (1-\\theta_k)^{\\beta_0+f_k-1}$$\n这是贝塔分布的核。这证明了贝塔先验对于二项似然的共轭性。$\\theta_k$ 的更新后验分布是一个参数为 $\\alpha_k = \\alpha_0 + s_k$ 和 $\\beta_k = \\beta_0 + f_k$ 的贝塔分布。\n所以，$\\theta_k | s_k, f_k \\sim \\operatorname{Beta}(\\alpha_0 + s_k, \\beta_0 + f_k)$。\n\n我们有三个臂的累积数据：\n- 臂1: $s_1 = 12$, $f_1 = 18$\n- 臂2: $s_2 = 8$, $f_2 = 22$\n- 臂3: $s_3 = 4$, $f_3 = 26$\n\n以及所有臂的 $\\operatorname{Beta}(1, 1)$ 先验。现在我们可以计算每个臂的后验参数。\n- 对于臂1:\n  $\\alpha_1 = \\alpha_0 + s_1 = 1 + 12 = 13$\n  $\\beta_1 = \\beta_0 + f_1 = 1 + 18 = 19$\n  $\\theta_1$ 的后验分布是 $\\operatorname{Beta}(13, 19)$。\n- 对于臂2:\n  $\\alpha_2 = \\alpha_0 + s_2 = 1 + 8 = 9$\n  $\\beta_2 = \\beta_0 + f_2 = 1 + 22 = 23$\n  $\\theta_2$ 的后验分布是 $\\operatorname{Beta}(9, 23)$。\n- 对于臂3:\n  $\\alpha_3 = \\alpha_0 + s_3 = 1 + 4 = 5$\n  $\\beta_3 = \\beta_0 + f_3 = 1 + 26 = 27$\n  $\\theta_3$ 的后验分布是 $\\operatorname{Beta}(5, 27)$。\n\n随机化策略规定，下一队列的分配概率与后验期望响应概率成正比。一个服从 $\\operatorname{Beta}(\\alpha, \\beta)$ 分布的随机变量 $X$ 的期望值为 $E[X] = \\frac{\\alpha}{\\alpha + \\beta}$。设 $\\hat{\\theta}_k = E[\\theta_k | s_k, f_k]$ 为臂 $k$ 的后验期望。\n- 对于臂1:\n  $\\hat{\\theta}_1 = \\frac{\\alpha_1}{\\alpha_1 + \\beta_1} = \\frac{13}{13 + 19} = \\frac{13}{32}$\n- 对于臂2:\n  $\\hat{\\theta}_2 = \\frac{\\alpha_2}{\\alpha_2 + \\beta_2} = \\frac{9}{9 + 23} = \\frac{9}{32}$\n- 对于臂3:\n  $\\hat{\\theta}_3 = \\frac{\\alpha_3}{\\alpha_3 + \\beta_3} = \\frac{5}{5 + 27} = \\frac{5}{32}$\n\n臂 $k$ 的分配概率，记为 $\\pi_k$，与 $\\hat{\\theta}_k$ 成正比。我们必须将这些值归一化，使它们的和为1。归一化常数是后验期望的总和：\n$$ \\sum_{j=1}^3 \\hat{\\theta}_j = \\frac{13}{32} + \\frac{9}{32} + \\frac{5}{32} = \\frac{13 + 9 + 5}{32} = \\frac{27}{32} $$\n臂 $k$ 的分配概率为 $\\pi_k = \\frac{\\hat{\\theta}_k}{\\sum_{j=1}^3 \\hat{\\theta}_j}$。\n- 对于臂1:\n  $\\pi_1 = \\frac{13/32}{27/32} = \\frac{13}{27}$\n- 对于臂2:\n  $\\pi_2 = \\frac{9/32}{27/32} = \\frac{9}{27} = \\frac{1}{3}$\n- 对于臂3:\n  $\\pi_3 = \\frac{5/32}{27/32} = \\frac{5}{27}$\n\n下一队列的规模为 $N=270$ 名患者。分配到臂 $k$ 的期望患者数 $E[N_k]$ 由 $N \\times \\pi_k$ 给出。\n- 臂1的期望样本量:\n  $E[N_1] = 270 \\times \\pi_1 = 270 \\times \\frac{13}{27} = 10 \\times 13 = 130$\n- 臂2的期望样本量:\n  $E[N_2] = 270 \\times \\pi_2 = 270 \\times \\frac{1}{3} = 90$\n- 臂3的期望样本量:\n  $E[N_3] = 270 \\times \\pi_3 = 270 \\times \\frac{5}{27} = 10 \\times 5 = 50$\n\n结果是三个分配概率 $(\\pi_1, \\pi_2, \\pi_3)$ 和三个期望样本量 $(E[N_1], E[N_2], E[N_3])$。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{13}{27}  \\frac{1}{3}  \\frac{5}{27}  130  90  50 \\end{pmatrix} } $$"
        }
    ]
}