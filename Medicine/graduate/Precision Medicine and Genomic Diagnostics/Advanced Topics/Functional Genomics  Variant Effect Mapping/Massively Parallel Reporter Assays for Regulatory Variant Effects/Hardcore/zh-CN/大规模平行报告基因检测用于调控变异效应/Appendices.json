{
    "hands_on_practices": [
        {
            "introduction": "大规模并行报告基因检测 (MPRA) 分析的第一步是将原始测序计数转化为对调控活性的量化度量。这个基础练习旨在巩固从脱氧核糖核酸 (DNA) 和核糖核酸 (RNA) 条形码计数中计算标准化活性的核心原理，即将 RNA 丰度与 DNA 丰度进行归一化。通过这个练习 ，您将掌握如何计算等位基因效应大小的基本方法，这是后续更复杂统计建模的基础。",
            "id": "4357321",
            "problem": "大规模并行报告基因检测（MPRA）通过将候选调控序列与唯一条形码偶联，将其插入质粒文库，将文库导入细胞，并对输入的脱氧核糖核酸（DNA）条形码和输出的核糖核酸（RNA）条形码进行测序，来量化调控活性。根据中心法则和标准的报告基因检测设计，归因于某个调控序列的转录产出反映在其RNA条形码的丰度上，而输入剂量则反映在其DNA条形码的丰度上。MPRA分析中的一个核心且经过充分检验的做法是，将序列的归一化活性定义为RNA条形码计数与DNA条形码计数之比的以$2$为底的对数，从而将乘法性调控效应转换为加法量。然后，在以$2$为底的对数尺度上，等位基因倍数变化由等位基因之间归一化活性的差异来表示。\n\n考虑一项比较某个调控变异的两个等位基因的检测，这两个等位基因在同一个池中进行测量，因此文库大小因子和测序深度效应是共享的。假设条形码聚合已经完成，并且不存在需要使用伪计数的零计数情况。对于等位基因$1$，聚合后的RNA条形码计数为$300$，聚合后的DNA条形码计数为$100$。对于等位基因$2$，聚合后的RNA条形码计数为$150$，聚合后的DNA条形码计数为$150$。\n\n使用上述定义，计算归一化活性$A_{1}$和$A_{2}$，以及定义为等位基因$1$和等位基因$2$之间归一化活性差异的以$2$为底的对数等位基因倍数变化$\\Delta$。请用以$2$为底的对数的精确闭合形式表示你的答案；不要进行数值近似。不需要单位。",
            "solution": "本问题已经过验证。\n\n### 步骤1：提取已知条件\n- 序列的归一化活性定义为RNA条形码计数与DNA条形码计数之比的以$2$为底的对数。\n- 在以$2$为底的对数尺度上，等位基因倍数变化$\\Delta$定义为等位基因$1$和等位基因$2$之间归一化活性的差异。\n- 对于等位基因$1$：聚合后的RNA条形码计数为$300$；聚合后的DNA条形码计数为$100$。\n- 对于等位基因$2$：聚合后的RNA条形码计数为$150$；聚合后的DNA条形码计数为$150$。\n- 假设：不存在需要使用伪计数的零计数情况。\n- 要求计算：归一化活性$A_{1}$和$A_{2}$，以及以$2$为底的对数等位基因倍数变化$\\Delta = A_1 - A_2$。\n- 要求格式：使用以$2$为底的对数的精确闭合形式。\n\n### 步骤2：使用提取的已知条件进行验证\n对问题的有效性进行评估。\n- **科学依据**：该问题牢固地植根于大规模并行报告基因检测（MPRA）数据分析的标准实践中。将归一化活性定义为RNA与DNA计数的对数比率是量化调控功能的标准方法，计算等位基因之间的差异（对数倍数变化）是量化变异效应的常规方式。所描述的实验设置是典型的MPRA设计。\n- **适定性**：该问题是适定的。它提供了所有必要的数值数据和待计算量的清晰、明确的定义。存在唯一解，并且可以直接根据所提供的信息确定。\n- **客观性**：问题陈述是客观的，并使用了基因组学领域常见的精确技术语言。它不包含任何主观或基于意见的内容。\n\n该问题没有列出的缺陷。它在科学上是合理的，完全指定的，内部一致的，并且需要直接应用所提供的定义。\n\n### 步骤3：结论与行动\n问题有效。将提供解答。\n\n归一化活性$A$定义为RNA计数与DNA计数之比的以$2$为底的对数。设$C_{RNA}$为RNA条形码计数，$C_{DNA}$为DNA条形码计数。公式为：\n$$A = \\log_{2}\\left(\\frac{C_{RNA}}{C_{DNA}}\\right)$$\n\n我们已知两个等位基因（指定为等位基因$1$和等位基因$2$）的计数。\n对于等位基因$1$，计数为$C_{RNA,1} = 300$和$C_{DNA,1} = 100$。\n等位基因$1$的归一化活性$A_1$计算如下：\n$$A_{1} = \\log_{2}\\left(\\frac{300}{100}\\right) = \\log_{2}(3)$$\n\n对于等位基因$2$，计数为$C_{RNA,2} = 150$和$C_{DNA,2} = 150$。\n等位基因$2$的归一化活性$A_2$计算如下：\n$$A_{2} = \\log_{2}\\left(\\frac{150}{150}\\right) = \\log_{2}(1)$$\n根据对数的性质，对于任何底数$b > 0, b \\neq 1$，都有$\\log_{b}(1) = 0$。因此：\n$$A_{2} = 0$$\n\n以$2$为底的对数等位基因倍数变化$\\Delta$定义为等位基因$1$和等位基因$2$之间归一化活性的差异：\n$$\\Delta = A_{1} - A_{2}$$\n代入$A_1$和$A_2$的计算值：\n$$\\Delta = \\log_{2}(3) - 0 = \\log_{2}(3)$$\n\n因此，等位基因$1$的归一化活性为$\\log_{2}(3)$，等位基因$2$的归一化活性为$0$，以$2$为底的对数等位基因倍数变化为$\\log_{2}(3)$。问题要求以精确的闭合形式给出这三个值：$A_1$、$A_2$和$\\Delta$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\log_{2}(3)  0  \\log_{2}(3)\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "为了从 MPRA 数据中获得更准确和稳健的等位基因效应估计，我们需要超越简单的比率计算，转向专业的统计模型。此练习  介绍了如何使用广义线性模型 (GLM) 这一标准方法，它能恰当地处理测序计数的统计特性，并通过“偏移量”项精确地校正 DNA 起始量的差异。掌握这一实践有助于理解如何从模型系数中正确解读等位基因对调控活性的乘性效应。",
            "id": "4357264",
            "problem": "大规模并行报告基因检测 (Massively Parallel Reporter Assay, MPRA) 通过对带有条形码的构建体进行测序，并行测量许多等位基因变异的调控活性。对于每个带有条形码索引的构建体 $i$，您可以观察到脱氧核糖核酸 (DNA) 输入计数 $d_i$（反映质粒丰度）和核糖核酸 (RNA) 输出计数 $y_i$（反映转录活性）。您希望估计替代等位基因相对于参考等位基因的调控效应，同时考虑 DNA 输入的变化。令 $\\text{allele}_i \\in \\{0,1\\}$ 表示构建体 $i$ 携带的等位基因（$0$ 代表参考，$1$ 代表替代）。\n\n从以下基本依据出发：\n- 中心法则和报告基因检测：来自报告基因构建体的 RNA 输出是其调控序列驱动的转录活性的可观察代理，并且在其他所有条件相等的情况下，DNA 输入丰度会乘法性地缩放预期的 RNA 计数。\n- 广义线性模型 (GLM) 定义：GLM 为响应变量指定一个分布，其均值为 $E[y_i \\mid \\mathbf{x}_i] = \\mu_i$，一个连接函数 $g(\\mu_i)$ 是预测变量的线性函数，以及一个由离散参数控制的方差函数。\n- 用于测序计数的负二项分布：在负二项 (NB) 模型下，$y_i \\sim \\text{NB}(\\mu_i,\\phi)$，其均值为 $E[y_i]=\\mu_i$，方差为 $\\text{Var}(y_i) = \\mu_i + \\phi \\mu_i^2$，其中 $\\phi>0$ 是一个超离散参数。\n\n您拟合一个带有对数连接函数和 DNA 输入偏移量的 GLM，\n$$\n\\log(\\mu_i) = \\beta_0 + \\beta_1 \\cdot \\text{allele}_i + \\log(d_i),\n$$\n其中 $\\log(d_i)$ 作为偏移量而不是估计系数进入线性预测器。\n\n仅使用核心 GLM 结构、对数连接函数的偏移属性以及 NB 均值-方差特征，推导出 $\\beta_1$ 所估计的量（用经 DNA 输入归一化的预期 RNA 活性表示），并说明在此 MPRA 背景下如何将 $\\exp(\\beta_1)$ 解释为等位基因效应。\n\n在下述模型中，哪个选项最能准确地捕捉 $\\beta_1$（以及 $\\exp(\\beta_1)$）的正确解释？\n\nA. $\\exp(\\beta_1)$ 是替代等位基因相对于参考等位基因的单位 DNA 输入预期 RNA 计数的乘法变化；等效地，它是比较 $\\text{allele}_i=1$ 与 $\\text{allele}_i=0$ 时预期 RNA-DNA 均值比率 $E[y_i]/d_i$ 的比值。\n\nB. $\\beta_1$ 量化了超离散度如何随等位基因变化；它测量了由替代等位基因引起的 $\\phi$ 的变化，因此反映的是变异性而不是平均活性。\n\nC. $\\exp(\\beta_1)$ 是在 RNA 中观察到替代等位基因相对于 DNA 的优势比（odds ratio），类似于逻辑回归效应，因为连接函数是对数函数。\n\nD. 在保持 $d_i$ 固定的情况下，当从 $\\text{allele}_i=0$ 切换到 $\\text{allele}_i=1$ 时，$\\beta_1$ 是预期 RNA 计数 $E[y_i]$ 的绝对变化，并且它独立于基线活性 $\\beta_0$。\n\nE. $\\exp(\\beta_1)$ 是比较 $\\text{allele}_i=1$ 与 $\\text{allele_i=0}$ 时原始预期 RNA 计数 $E[y_i]$ 的乘法变化，忽略了 DNA 输入偏移量 $d_i$，因为 NB 均值已经考虑了缩放。",
            "solution": "用户提供了一个问题陈述，描述了用于分析大规模并行报告基因检测 (MPRA) 数据的广义线性模型 (GLM)。任务是验证此陈述，如果有效，则推导出模型参数 $\\beta_1$ 及其指数形式 $\\exp(\\beta_1)$ 的正确解释。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n\n*   **数据：** 对于每个构建体 $i$，我们有 DNA 输入计数 $d_i$ 和 RNA 输出计数 $y_i$。\n*   **预测变量：** $\\text{allele}_i \\in \\{0,1\\}$ 指示等位基因，其中 $0$ 代表参考等位基因，$1$ 代表替代等位基因。\n*   **背景原则：**\n    1.  RNA 输出是转录活性的代理，由 DNA 输入进行乘法缩放。\n    2.  该模型是一个 GLM，其均值为 $E[y_i \\mid \\mathbf{x}_i] = \\mu_i$，连接函数 $g(\\mu_i)$ 是预测变量的线性函数。\n    3.  响应变量 $y_i$ 服从负二项分布，$y_i \\sim \\text{NB}(\\mu_i, \\phi)$，其均值为 $E[y_i]=\\mu_i$，方差为 $\\text{Var}(y_i) = \\mu_i + \\phi \\mu_i^2$，其中 $\\phi > 0$ 是超离散参数。\n*   **模型设定：** 该 GLM 由以下方程定义：\n    $$\n    \\log(\\mu_i) = \\beta_0 + \\beta_1 \\cdot \\text{allele}_i + \\log(d_i)\n    $$\n    其中 $\\mu_i = E[y_i]$ 且 $\\log(d_i)$ 是一个偏移量。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n*   **科学依据：** 该问题牢固地基于定量基因组学和生物统计学的原理。使用负二项 GLM 对来自 MPRA 等高通量测序实验的计数数据进行建模是一种标准且成熟的方法。该模型结构包含一个用于输入文库大小（此处为 DNA 质粒丰度）的偏移量，是分析此类数据的典型方法（例如，在 DESeq2 和 edgeR 等软件包中）。所述原则在科学上是合理的。\n*   **适定性：** 这个问题是适定的。它提供了一个精确的数学模型，并要求解释其参数之一 $\\beta_1$。这种解释可以从给定的方程和定义中唯一地推导出来。\n*   **客观性：** 问题陈述以清晰、客观和标准的技术语言表达，没有歧义或主观声明。\n\n**步骤 3：结论和行动**\n\n问题陈述在科学上是合理的、适定的和客观的。它没有违反任何无效性标准。因此，该问题是**有效的**。我将继续进行推导和求解。\n\n### 推导与求解\n\n目标是从指定的 GLM 中推导出参数 $\\beta_1$ 的含义。该模型为：\n$$\n\\log(\\mu_i) = \\beta_0 + \\beta_1 \\cdot \\text{allele}_i + \\log(d_i)\n$$\n其中 $\\mu_i$ 是预期的 RNA 计数，$E[y_i]$。\n\n该问题强调了偏移量和对数连接函数的使用。对数连接函数的一个关键属性是，线性预测器中的偏移量对应于均值尺度上的一个乘法缩放因子。我们可以通过重新排列方程来看这一点：\n$$\n\\log(\\mu_i) - \\log(d_i) = \\beta_0 + \\beta_1 \\cdot \\text{allele}_i\n$$\n利用对数属性 $\\log(a) - \\log(b) = \\log(a/b)$，我们得到：\n$$\n\\log\\left(\\frac{\\mu_i}{d_i}\\right) = \\beta_0 + \\beta_1 \\cdot \\text{allele}_i\n$$\n这个重新排列的方程提供了最直接的解释。左边的量 $\\mu_i/d_i = E[y_i]/d_i$ 代表单位 DNA 输入的预期 RNA 计数。这个比率是调控序列内在转录活性的度量，并根据其在质粒库中的初始丰度进行了归一化。\n\n让我们分析两种等位基因类型的模型：\n\n1.  **对于参考等位基因 ($\\text{allele}_i = 0$)：**\n    模型变为：\n    $$\n    \\log\\left(\\frac{E[y_i | \\text{allele}_i=0]}{d_i}\\right) = \\beta_0 + \\beta_1 \\cdot 0 = \\beta_0\n    $$\n    因此，$\\exp(\\beta_0)$ 代表参考等位基因的基线转录活性（每个 DNA 的预期 RNA）。\n\n2.  **对于替代等位基因 ($\\text{allele}_i = 1$)：**\n    模型变为：\n    $$\n    \\log\\left(\\frac{E[y_i | \\text{allele}_i=1]}{d_i}\\right) = \\beta_0 + \\beta_1 \\cdot 1 = \\beta_0 + \\beta_1\n    $$\n\n为了解释 $\\beta_1$，我们可以从替代等位基因的方程中减去参考等位基因的方程：\n$$\n\\log\\left(\\frac{E[y_i|\\text{allele}_i=1]}{d_i}\\right) - \\log\\left(\\frac{E[y_i|\\text{allele}_i=0]}{d_i}\\right) = (\\beta_0 + \\beta_1) - \\beta_0 = \\beta_1\n$$\n再次应用对数减法规则：\n$$\n\\beta_1 = \\log\\left( \\frac{E[y_i|\\text{allele}_i=1]/d_i}{E[y_i|\\text{allele}_i=0]/d_i} \\right)\n$$\n这表明 $\\beta_1$ 是替代等位基因相对于参考等位基因的归一化转录活性（每个 DNA 的预期 RNA）比率的自然对数。\n\n为了解释 $\\exp(\\beta_1)$，我们只需对两边取指数：\n$$\n\\exp(\\beta_1) = \\frac{E[y_i|\\text{allele}_i=1]/d_i}{E[y_i|\\text{allele}_i=0]/d_i}\n$$\n因此，$\\exp(\\beta_1)$ 是比较替代等位基因与参考等位基因时，预期 RNA-DNA 均值的比率。这恰好是替代等位基因相对于参考等位基因的单位 DNA 输入预期 RNA 计数的乘法变化。这个量通常被称为等位基因偏斜或对调控活性的等位基因效应。\n\n### 逐项分析\n\n**A. $\\exp(\\beta_1)$ 是替代等位基因相对于参考等位基因的单位 DNA 输入预期 RNA 计数的乘法变化；等效地，它是比较 $\\text{allele}_i=1$ 与 $\\text{allele}_i=0$ 时预期 RNA-DNA 均值比率 $E[y_i]/d_i$ 的比值。**\n该陈述与我们的推导完全匹配。表达式 $\\exp(\\beta_1) = \\frac{E[y_i|\\text{allele}_i=1]/d_i}{E[y_i|\\text{allele}_i=0]/d_i}$ 表明它是预期 RNA-DNA 均值的比率，这与单位 DNA 输入预期 RNA 计数的乘法变化是同义的。\n**结论：正确。**\n\n**B. $\\beta_1$ 量化了超离散度如何随等位基因变化；它测量了由替代等位基因引起的 $\\phi$ 的变化，因此反映的是变异性而不是平均活性。**\n这是不正确的。参数 $\\beta_1$ 是均值 $\\mu_i$ 的线性预测器的一部分。超离散参数 $\\phi$ 是方差函数 $\\text{Var}(y_i) = \\mu_i + \\phi\\mu_i^2$ 的一部分。在指定的模型中，$\\phi$ 被视为一个单一的常数参数，并且不依赖于任何预测变量，包括 $\\text{allele}_i$。因此，$\\beta_1$ 建模的是对均值的影响，而不是对变异性或超离散度的影响。\n**结论：不正确。**\n\n**C. $\\exp(\\beta_1)$ 是在 RNA 中观察到替代等位基因相对于 DNA 的优势比（odds ratio），类似于逻辑回归效应，因为连接函数是对数函数。**\n这在多个层面上都是不正确的。首先，该模型是用于计数数据的负二项回归，而不是用于二元结果的逻辑回归。优势比是逻辑回归（使用 logit 连接函数）中系数的自然解释，而不是带有对数连接函数的 NB 回归。其次，量 $\\exp(\\beta_1)$ 是均值（或速率）的比率，而不是优势比。第三，在此背景下，“在 RNA 中观察到替代等位基因相对于 DNA 的优势比”这种说法在概念上是不连贯的。\n**结论：不正确。**\n\n**D. 在保持 $d_i$ 固定的情况下，当从 $\\text{allele}_i=0$ 切换到 $\\text{allele}_i=1$ 时，$\\beta_1$ 是预期 RNA 计数 $E[y_i]$ 的绝对变化，并且它独立于基线活性 $\\beta_0$。**\n这是不正确的。因为模型使用对数连接函数，预测变量对均值尺度 $E[y_i]$ 具有乘法效应，而非加法效应。$E[y_i]$ 的绝对变化是 $E[y | \\text{allele}=1, d_i] - E[y | \\text{allele}=0, d_i] = d_i\\exp(\\beta_0)(\\exp(\\beta_1)-1)$。这个变化不等于 $\\beta_1$，并且明显依赖于基线活性（$\\beta_0$）和 DNA 输入（$d_i$）。\n**结论：不正确。**\n\n**E. $\\exp(\\beta_1)$ 是比较 $\\text{allele}_i=1$ 与 $\\text{allele_i=0}$ 时原始预期 RNA 计数 $E[y_i]$ 的乘法变化，忽略了 DNA 输入偏移量 $d_i$，因为 NB 均值已经考虑了缩放。**\n这个陈述具有误导性，其推理是有缺陷的。虽然在固定 $d_i$ 的情况下，$\\exp(\\beta_1) = \\frac{E[y_i|\\text{allele}=1, d_i]}{E[y_i|\\text{allele}=0, d_i]}$ 是正确的，但偏移量的作用不应被忽略。偏移量正是模型用来解释 $d_i$ 缩放效应的机制。模型是*校正*了 $d_i$，而不是忽略它。其推理“因为 NB 均值已经考虑了缩放”是不正确的；NB 均值本身并不解释这种缩放——是包括偏移量的整个 GLM 结构强加了这种关系。选项 A 通过关注模型旨在估计的归一化活性，提供了更准确和根本的解释。\n**结论：不正确。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在精准医疗中，MPRA 的最终目标是帮助我们识别致病的功能性变异。这个高级练习  模拟了一个真实的变异优先级排序场景，要求您运用贝叶斯框架，将来自 MPRA 的实验证据与来自表达数量性状基因座 (eQTL) 共定位分析的遗传学证据相结合。通过构建一个量化的评分函数，您将学习如何整合不同来源的数据以做出有原则的决策，这是将功能基因组学研究成果转化为临床应用的关键一步。",
            "id": "4357293",
            "problem": "您正在设计一个基于第一性原理、可通过编程实现的评分函数，旨在使用 Massively Parallel Reporter Assay (MPRA) 的测量数据和 expression Quantitative Trait Loci (eQTL) 的共定位结果，对非编码遗传变异进行排序以供临床随访。您的目标是从第一性原理出发，推导出一个标量分数，该分数是“某个变异是在疾病相关背景下影响基因表达的临床相关调控变异”之后验概率的单调函数。然后，根据变异的预期临床效用对其进行排序。\n\n使用的基本原理：\n- 用于结合先验几率和似然比的 Bayes’ 定理。\n- 证据来源的独立性意味着对数似然比的可加性。\n- 用于 MPRA 效应值的高斯测量模型。\n- 用于在概率、几率和对数几率之间映射的 logit 函数和 logistic 函数。\n- 决策论原理，即当效用仅在假设为真时才实现的情况下，预期效用是效用与后验概率的乘积。\n\n为每个变异设立以下潜在二元假设：假设 $\\mathcal{H}_1$ 表示该变异是一个临床相关的调控变异；假设 $\\mathcal{H}_0$ 表示它不是。对于每个变异，您有两个证据来源：\n- 一个 MPRA 效应估计值 $e$ 及其标准误 $s$，在高斯测量模型下，观测值由正态分布建模。\n- 一个 eQTL 共定位后验概率 $c$，表示同一变异同时是 eQTL 和疾病关联的基础。\n\n假设以下建模选择：\n- 在 $\\mathcal{H}_0$ 假设下，MPRA 效应 $e$ 服从均值为 $0$、方差为 $s^2$ 的正态分布。\n- 在 $\\mathcal{H}_1$ 假设下，MPRA 效应 $e$ 服从均值为 $\\mu_A$、方差为 $s^2 + \\tau^2$ 的正态分布，其中 $\\mu_A$ 和 $\\tau$ 是超参数，分别代表功能状态下的预期偏移和额外的变异间方差。\n- eQTL 共定位概率 $c$ 被视为关于共定位的后验概率，该证据对对数似然比的贡献可以表示为其后验对数几率与共定位的基线先验对数几率之差，其中基线先验概率为 $\\pi_c$。\n- 基因座组中任何给定变异具有临床相关性的先验概率为 $\\pi_0$。\n- 为保证数值稳定性，在应用对数几率变换之前，概率值被裁剪到开区间 $(\\epsilon, 1 - \\epsilon)$ 内，其中 $\\epsilon$ 是一个小的正常量。\n- 每个变异都有一个非负的临床效用权重 $u$，代表如果该变异真正相关，验证它所具有的相对临床价值。\n\n您的任务：\n- 利用 Bayes’ 定理和独立性假设，结合 MPRA 和共定位证据，推导出一个与后验概率 $\\Pr(\\mathcal{H}_1 \\mid \\text{data})$ 单调相关的标量分数。然后，将用于排序的预期临床效用分数定义为 $u \\times \\Pr(\\mathcal{H}_1 \\mid \\text{data})$。\n- 将其实现为一个程序，对于每个测试用例，该程序接收数组 $e$、$s$、$c$ 和 $u$ 以及常量 $\\mu_A$、$\\tau$、$\\pi_c$、$\\pi_0$ 和 $\\epsilon$，并返回使预期效用最大化的排名最高变异的从零开始的索引。如果出现数值上完全相等（在容差 $\\delta$ 范围内），则返回这些最大值中的最小索引。使用容差 $\\delta = 10^{-12}$。\n\n测试套件：\n在以下四个测试用例上实现您的方法。对于每个用例，计算排名最高变异的单个整数索引，并按顺序输出这四个索引的列表。\n\n常量（所有测试用例均使用）：\n- $\\mu_A = 0.5$\n- $\\tau = 0.3$\n- $\\pi_c = 0.2$\n- $\\pi_0 = 0.01$\n- $\\epsilon = 10^{-6}$\n- $\\delta = 10^{-12}$\n\n用例 1（一般情况）：\n- $e = [\\,0.4,\\,1.2,\\,-0.1,\\,0.8,\\,0.0\\,]$\n- $s = [\\,0.2,\\,0.5,\\,0.3,\\,0.4,\\,0.1\\,]$\n- $c = [\\,0.6,\\,0.4,\\,0.9,\\,0.2,\\,0.5\\,]$\n- $u = [\\,1,\\,1,\\,1,\\,1,\\,1\\,]$\n\n用例 2（边界概率和精度）：\n- $e = [\\,0.0,\\,3.0,\\,0.1\\,]$\n- $s = [\\,10^{6},\\,1.0,\\,0.05\\,]$\n- $c = [\\,0.0,\\,1.0,\\,0.01\\,]$\n- $u = [\\,1,\\,1,\\,1\\,]$\n\n用例 3（完全相等，练习决胜规则）：\n- $e = [\\,0.5,\\,0.5\\,]$\n- $s = [\\,0.2,\\,0.2\\,]$\n- $c = [\\,0.5,\\,0.5\\,]$\n- $u = [\\,1,\\,1\\,]$\n\n用例 4（证据相同但效用不同）：\n- $e = [\\,0.6,\\,0.6,\\,0.6\\,]$\n- $s = [\\,0.3,\\,0.3,\\,0.3\\,]$\n- $c = [\\,0.6,\\,0.6,\\,0.6\\,]$\n- $u = [\\,1.0,\\,5.0,\\,0.5\\,]$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表，不含空格。例如，四个用例的输出应类似于“[0,2,1,3]”。您的程序必须实现上述推导，并将其完全按照规定应用于测试套件，返回一个指定格式的包含四个整数的列表。",
            "solution": "该问题是有效的，因为它具有科学依据、良态且客观。它为推导和实现一个用于遗传变异排序的统计模型提供了一套完整且一致的要求。\n\n核心任务是根据预期临床效用对遗传变异进行排序。变异 $i$ 的预期效用，记为 $U_i$，定义为其临床效用权重 $u_i$ 与其作为一个临床相关的调控变异的后验概率 $\\Pr(\\mathcal{H}_1 \\mid \\text{data}_i)$ 的乘积。\n$$ U_i = u_i \\times \\Pr(\\mathcal{H}_1 \\mid \\text{data}_i) $$\n在这里，$\\mathcal{H}_1$ 是变异具有临床相关性的假设，而 $\\mathcal{H}_0$ 是其不具有临床相关性的原假设。每个变异的数据包括一个 Massively Parallel Reporter Assay (MPRA) 的效应估计值 $e_i$ 及其标准误 $s_i$，以及一个 expression Quantitative Trait Locus (eQTL) 的共定位后验概率 $c_i$。\n\n为了计算后验概率 $\\Pr(\\mathcalH}_1 \\mid \\text{data}_i)$，我们采用 Bayes’ 定理。使用对数几率最为方便，因为问题假设证据来源（MPRA 和 eQTL）是独立的，这使得它们的贡献在对数几率空间中是可加的。\n\n给定数据下 $\\mathcal{H}_1$ 的后验对数几率是先验对数几率与来自每个证据来源的对数似然比（LLR）之和：\n$$ \\underbrace{\\log\\left(\\frac{\\Pr(\\mathcal{H}_1 \\mid \\text{data}_i)}{\\Pr(\\mathcal{H}_0 \\mid \\text{data}_i)}\\right)}_{\\text{后验对数几率}} = \\underbrace{\\log\\left(\\frac{\\Pr(\\mathcal{H}_1)}{\\Pr(\\mathcal{H}_0)}\\right)}_{\\text{先验对数几率}} + \\underbrace{\\log\\left(\\frac{p(e_i, s_i \\mid \\mathcal{H}_1)}{p(e_i, s_i \\mid \\mathcal{H}_0)}\\right)}_{\\text{LLR}_{\\text{MPRA}}} + \\underbrace{\\log\\left(\\frac{p(\\text{evidence from } c_i \\mid \\mathcal{H}_1)}{p(\\text{evidence from } c_i \\mid \\mathcal{H}_0)}\\right)}_{\\text{LLR}_{\\text{eQTL}}} $$\n\n让我们根据问题陈述来定义每一项。为保证数值稳定性，在应用 logit 变换 $\\text{logit}(p) = \\log(p/(1-p))$ 之前，概率 $p$ 被裁剪到区间 $(\\epsilon, 1 - \\epsilon)$ 内。\n\n1.  **先验对数几率**：一个变异具有临床相关性的先验概率为 $\\pi_0$。先验对数几率项由裁剪后的先验概率 $\\pi'_0 = \\text{clip}(\\pi_0, \\epsilon, 1-\\epsilon)$ 计算得出：\n    $$ \\text{先验对数几率} = \\text{logit}(\\pi'_0) = \\log\\left(\\frac{\\pi'_0}{1-\\pi'_0}\\right) $$\n\n2.  **eQTL对数似然比（$\\text{LLR}_{\\text{eQTL}}$）**：问题陈述指出，此项贡献是共定位的后验对数几率（由 $c_i$ 给出）与共定位的先验对数几率（由 $\\pi_c$ 给出）之差。设 $c'_i = \\text{clip}(c_i, \\epsilon, 1-\\epsilon)$ 和 $\\pi'_c = \\text{clip}(\\pi_c, \\epsilon, 1-\\epsilon)$。\n    $$ \\text{LLR}_{\\text{eQTL}, i} = \\text{logit}(c'_i) - \\text{logit}(\\pi'_c) = \\log\\left(\\frac{c'_i}{1-c'_i}\\right) - \\log\\left(\\frac{\\pi'_c}{1-\\pi'_c}\\right) $$\n    该项量化了 eQTL 共定位分析为 $\\mathcal{H}_1$ 提供的证据。\n\n3.  **MPRA对数似然比（$\\text{LLR}_{\\text{MPRA}}$）**：该项由指定的高斯测量模型推导得出。观测到效应值 $e_i$ 和标准误 $s_i$ 的似然由正态分布的概率密度函数（PDF）$\\mathcal{N}(\\cdot \\mid \\text{均值}, \\text{方差})$ 给出。\n    -   在 $\\mathcal{H}_0$ 假设下：$p(e_i \\mid s_i, \\mathcal{H}_0) = \\mathcal{N}(e_i \\mid 0, s_i^2)$\n    -   在 $\\mathcal{H}_1$ 假设下：$p(e_i \\mid s_i, \\mathcal{H}_1) = \\mathcal{N}(e_i \\mid \\mu_A, s_i^2 + \\tau^2)$\n    LLR是这两个似然函数之比的对数。我们可以将其计算为对数PDF之差：\n    $$ \\text{LLR}_{\\text{MPRA}, i} = \\log\\left(p(e_i \\mid s_i, \\mathcal{H}_1)\\right) - \\log\\left(p(e_i \\mid s_i, \\mathcal{H}_0)\\right) $$\n    使用正态分布的对数PDF公式 $\\log\\mathcal{N}(x \\mid \\mu, \\sigma^2) = -\\frac{1}{2}\\log(2\\pi\\sigma^2) - \\frac{(x-\\mu)^2}{2\\sigma^2}$，上式变为：\n    $$ \\text{LLR}_{\\text{MPRA}, i} = \\left[-\\frac{1}{2}\\log(2\\pi(s_i^2 + \\tau^2)) - \\frac{(e_i - \\mu_A)^2}{2(s_i^2 + \\tau^2)}\\right] - \\left[-\\frac{1}{2}\\log(2\\pi s_i^2) - \\frac{e_i^2}{2s_i^2}\\right] $$\n    $$ \\text{LLR}_{\\text{MPRA}, i} = \\frac{1}{2}\\log\\left(\\frac{s_i^2}{s_i^2 + \\tau^2}\\right) + \\frac{e_i^2}{2s_i^2} - \\frac{(e_i - \\mu_A)^2}{2(s_i^2 + \\tau^2)} $$\n\n结合这些项，变异 $i$ 的总后验对数几率，记为 $L_i$，是：\n$$ L_i = \\text{logit}(\\pi'_0) + \\text{LLR}_{\\text{MPRA}, i} + \\text{LLR}_{\\text{eQTL}, i} $$\n这个分数 $L_i$ 是后验概率的单调函数。\n\n为了获得后验概率 $\\Pr(\\mathcal{H}_1 \\mid \\text{data}_i)$，我们应用 logit 函数的逆函数，即 logistic (sigmoid) 函数：\n$$ \\Pr(\\mathcal{H}_1 \\mid \\text{data}_i) = \\sigma(L_i) = \\frac{1}{1 + e^{-L_i}} $$\n最后，变异 $i$ 的预期效用计算如下：\n$$ U_i = u_i \\times \\frac{1}{1 + e^{-L_i}} $$\n程序将为给定测试用例中的所有变异计算 $U_i$。然后它将识别出最大效用值 $U_{\\max} = \\max_i(U_i)$。排名最高的变异是满足 $|U_i - U_{\\max}| \\le \\delta$ 的最小索引 $i$，其中 $\\delta = 10^{-12}$ 是指定的用于决胜的容差。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import norm\n\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\n\ndef solve():\n    \"\"\"\n    Solves the variant ranking problem for the given test suite.\n    \"\"\"\n    # Define the constants from the problem statement.\n    mu_A = 0.5\n    tau = 0.3\n    pi_c = 0.2\n    pi_0 = 0.01\n    epsilon = 1e-6\n    delta = 1e-12\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (general case)\n        {\n            \"e\": np.array([0.4, 1.2, -0.1, 0.8, 0.0]),\n            \"s\": np.array([0.2, 0.5, 0.3, 0.4, 0.1]),\n            \"c\": np.array([0.6, 0.4, 0.9, 0.2, 0.5]),\n            \"u\": np.array([1, 1, 1, 1, 1]),\n        },\n        # Case 2 (edge probabilities and precisions)\n        {\n            \"e\": np.array([0.0, 3.0, 0.1]),\n            \"s\": np.array([1e6, 1.0, 0.05]),\n            \"c\": np.array([0.0, 1.0, 0.01]),\n            \"u\": np.array([1, 1, 1]),\n        },\n        # Case 3 (exact tie, exercise tie-breaking)\n        {\n            \"e\": np.array([0.5, 0.5]),\n            \"s\": np.array([0.2, 0.2]),\n            \"c\": np.array([0.5, 0.5]),\n            \"u\": np.array([1, 1]),\n        },\n        # Case 4 (different utilities with identical evidence)\n        {\n            \"e\": np.array([0.6, 0.6, 0.6]),\n            \"s\": np.array([0.3, 0.3, 0.3]),\n            \"c\": np.array([0.6, 0.6, 0.6]),\n            \"u\": np.array([1.0, 5.0, 0.5]),\n        },\n    ]\n\n    def logit(p):\n        \"\"\"Computes the logit function log(p / (1 - p)).\"\"\"\n        return np.log(p / (1.0 - p))\n\n    def calculate_expected_utilities(e, s, c, u):\n        \"\"\"\n        Calculates the expected clinical utility for a set of variants.\n        \"\"\"\n        # 1. Clip probabilities for numerical stability\n        pi0_clipped = np.clip(pi_0, epsilon, 1.0 - epsilon)\n        pic_clipped = np.clip(pi_c, epsilon, 1.0 - epsilon)\n        c_clipped = np.clip(c, epsilon, 1.0 - epsilon)\n        \n        # 2. Calculate prior log-odds\n        prior_log_odds = logit(pi0_clipped)\n        \n        # 3. Calculate eQTL log-likelihood ratio (LLR_eQTL)\n        llr_eqtl = logit(c_clipped) - logit(pic_clipped)\n        \n        # 4. Calculate MPRA log-likelihood ratio (LLR_MPRA)\n        # LLR = log(p(data|H1)) - log(p(data|H0))\n        # H0:\n        log_pdf_h0 = norm.logpdf(e, loc=0.0, scale=s)\n        # H1:\n        var_h1 = s**2 + tau**2\n        scale_h1 = np.sqrt(var_h1)\n        log_pdf_h1 = norm.logpdf(e, loc=mu_A, scale=scale_h1)\n        \n        llr_mpra = log_pdf_h1 - log_pdf_h0\n\n        # 5. Calculate total posterior log-odds\n        total_log_odds = prior_log_odds + llr_eqtl + llr_mpra\n        \n        # 6. Convert log-odds to posterior probability\n        # posterior_prob = 1 / (1 + exp(-total_log_odds))\n        posterior_prob = 1.0 / (1.0 + np.exp(-total_log_odds))\n        \n        # 7. Calculate expected utility\n        expected_utility = u * posterior_prob\n        \n        return expected_utility\n\n    results = []\n    for case in test_cases:\n        utilities = calculate_expected_utilities(case[\"e\"], case[\"s\"], case[\"c\"], case[\"u\"])\n        \n        # Find the index of the top-ranked variant\n        max_utility = np.max(utilities)\n        \n        # Find all indices that are maximizers within the tolerance delta\n        maximizer_indices = np.where(np.abs(utilities - max_utility) = delta)[0]\n        \n        # Per the tie-breaking rule, return the smallest index among the maximizers\n        best_index = np.min(maximizer_indices)\n        results.append(best_index)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}