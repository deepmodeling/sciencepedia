{
    "hands_on_practices": [
        {
            "introduction": "This exercise grounds our study of carrier screening in the fundamental principles of population genetics. By applying the Hardy-Weinberg equilibrium model, you will learn to connect a macroscopic population metric—disease prevalence—to the underlying frequency of carriers. This practice is essential for understanding the baseline risk in a population and for appreciating the power and limitations of common approximations used in genetic epidemiology .",
            "id": "4320836",
            "problem": "A clinical laboratory is designing an expanded carrier screening panel for an autosomal recessive condition. Assume a large randomly mating population under Hardy–Weinberg equilibrium and complete penetrance for affected individuals. Let the wild-type allele frequency be $p$ and the pathogenic allele frequency be $q$, with $p+q=1$. Under these assumptions, genotype frequencies are given by the binomial expansion of $(p+q)^{2}$, and disease prevalence among newborns equals the homozygous affected genotype frequency.\n\nNewborn screening surveillance estimates a disease prevalence of $q^{2}=\\frac{1}{10{,}000}$. Using only these foundational relationships, do the following:\n- Derive the exact carrier frequency in terms of $p$ and $q$ and compute its value from the given prevalence.\n- Derive the small-$q$ approximation for the carrier frequency and obtain its numerical value.\n- Define the approximation error as the difference between the approximate and exact carrier frequencies, and derive a closed-form expression for the relative error when $p\\neq 1$.\n  \nReport as your final answer the relative error, expressed as a decimal and rounded to four significant figures. Do not use a percentage sign. No units are required.",
            "solution": "The problem statement is scientifically grounded, well-posed, and objective. It is based on the foundational principles of population genetics, specifically the Hardy–Weinberg equilibrium model, and provides all necessary information for a unique and meaningful solution. Therefore, the problem is valid, and we proceed with the solution.\n\nThe problem assumes a population in Hardy–Weinberg equilibrium for an autosomal recessive condition. Let $p$ be the frequency of the wild-type allele and $q$ be the frequency of the pathogenic allele, with the constraint $p+q=1$. The frequencies of the three possible genotypes (homozygous wild-type, heterozygous, and homozygous pathogenic) are given by the terms of the binomial expansion of $(p+q)^2$:\n- Homozygous wild-type frequency: $p^2$\n- Heterozygous (carrier) frequency: $2pq$\n- Homozygous pathogenic (affected) frequency: $q^2$\n\nThe problem states that the disease prevalence among newborns is equal to the homozygous affected genotype frequency, which is given as $q^2 = \\frac{1}{10{,}000}$.\n\nFirst, we calculate the pathogenic allele frequency, $q$.\n$$q^2 = \\frac{1}{10{,}000}$$\nTaking the square root, we find $q$:\n$$q = \\sqrt{\\frac{1}{10{,}000}} = \\frac{1}{100} = 0.01$$\nNext, we calculate the wild-type allele frequency, $p$, using the relation $p+q=1$:\n$$p = 1-q = 1 - 0.01 = 0.99$$\n\n**1. Exact Carrier Frequency**\nThe exact carrier frequency is the frequency of heterozygous individuals, which is given by the term $2pq$ in the Hardy–Weinberg principle.\nThe derived expression is:\n$$ \\text{Exact Carrier Frequency} = 2pq $$\nUsing the calculated values of $p$ and $q$:\n$$ \\text{Exact Carrier Frequency} = 2(0.99)(0.01) = 0.0198 $$\n\n**2. Small-$q$ Approximation for Carrier Frequency**\nFor many genetic conditions, the pathogenic allele frequency $q$ is very small ($q \\ll 1$). In such cases, the wild-type allele frequency $p=1-q$ is very close to $1$. The small-$q$ approximation for the carrier frequency is derived by setting $p \\approx 1$ in the exact formula:\n$$ \\text{Approximate Carrier Frequency} = 2pq \\approx 2(1)q = 2q $$\nThe derived expression for the approximation is:\n$$ \\text{Approximate Carrier Frequency} = 2q $$\nUsing the calculated value of $q$:\n$$ \\text{Approximate Carrier Frequency} = 2(0.01) = 0.02 $$\n\n**3. Relative Error of the Approximation**\nThe problem defines the approximation error as the difference between the approximate and exact carrier frequencies.\n$$ \\text{Approximation Error} = (\\text{Approximate Frequency}) - (\\text{Exact Frequency}) = 2q - 2pq $$\nThe relative error is defined as the approximation error divided by the exact (true) value.\n$$ \\text{Relative Error} = \\frac{\\text{Approximation Error}}{\\text{Exact Frequency}} = \\frac{2q - 2pq}{2pq} $$\nWe are asked to derive a closed-form expression for this relative error. We can simplify the expression:\n$$ \\text{Relative Error} = \\frac{2q(1-p)}{2pq} $$\nSince $p \\neq 0$ (as $q=0.01$) we can cancel the $2q$ terms. The problem also states $p \\neq 1$, which corresponds to $q \\neq 0$, ensuring the exact frequency $2pq$ is non-zero and the division is well-defined.\n$$ \\text{Relative Error} = \\frac{1-p}{p} $$\nAlternatively, we can express this in terms of $q$. Since $p=1-q$, we have $1-p = q$. Substituting this into our expression gives:\n$$ \\text{Relative Error} = \\frac{q}{1-q} $$\nBoth $\\frac{1-p}{p}$ and $\\frac{q}{1-q}$ are valid closed-form expressions for the relative error.\n\nFinally, we compute the numerical value of the relative error using our calculated values for $p$ and $q$.\nUsing the expression in terms of $q$:\n$$ \\text{Relative Error} = \\frac{0.01}{1-0.01} = \\frac{0.01}{0.99} = \\frac{1}{99} $$\nTo express this as a decimal, we perform the division:\n$$ \\frac{1}{99} = 0.01010101\\overline{01}... $$\nThe problem requires this value to be rounded to four significant figures. The first significant figure is the first non-zero digit, which is the '1' in the hundredths place. The first four significant figures are $1, 0, 1, 0$. The digit following the fourth significant figure is a '1', so we do not round up.\n$$ \\text{Relative Error} \\approx 0.01010 $$\nThe trailing zero is retained to indicate the precision of four significant figures.",
            "answer": "$$\\boxed{0.01010}$$"
        },
        {
            "introduction": "Moving from population statistics to individual diagnostics, this practice addresses a critical concept in clinical interpretation: residual risk. A negative screening result rarely reduces risk to zero; this exercise uses Bayes' theorem to quantify the remaining probability of being a carrier. Mastering this calculation is crucial for accurately communicating test limitations and for making informed reproductive decisions based on genomic data .",
            "id": "4320838",
            "problem": "A single individual from a couple is undergoing carrier screening for a specific autosomal recessive disorder in the context of precision medicine and genomic diagnostics. Let the individual's prior probability of being a heterozygous carrier, based on ancestry and validated population data, be denoted by $p$ with $0 < p < 1$. The assay used has a detection rate (analytical sensitivity among true carriers for clinically reportable pathogenic variants) denoted by $r$ with $0 < r < 1$, and clinical specificity is approximately $1$ (i.e., the probability of a false positive is negligible). The individual receives a negative test result (no reportable pathogenic variant detected).\n\nStarting from the definitions of sensitivity and specificity and Bayes' theorem, derive the residual risk, defined as the posterior probability that the individual is still a carrier given the negative result, as a closed-form expression in terms of $p$ and $r$. Then, using first principles, explain qualitatively how this residual risk depends on $p$ and $r$ (i.e., whether it increases or decreases as each parameter increases), and obtain its linear approximation in the regime $p \\ll 1$ (small prior probability).\n\nExpress your final answer as a single analytic expression for the residual risk as a function of $p$ and $r$. No numerical rounding is required, and no units are involved.",
            "solution": "The problem statement is validated as scientifically grounded, well-posed, objective, and complete. It is a standard application of Bayesian probability theory to the domain of genetic diagnostics. All parameters are clearly defined, and the task is to derive and analyze a specific quantity, the residual risk.\n\nLet us define the relevant events:\n- $C$: The event that the individual is a heterozygous carrier.\n- $N$: The event that the individual is not a carrier (i.e., the complement of $C$).\n- $T^{-}$: The event that the individual receives a negative test result.\n- $T^{+}$: The event that the individual receives a positive test result.\n\nFrom the problem statement, we are given the following probabilities:\n- The prior probability of being a carrier is $P(C) = p$.\n- The prior probability of not being a carrier is $P(N) = 1 - P(C) = 1 - p$.\n- The detection rate, or analytical sensitivity, is the probability of a positive test given the individual is a carrier: $P(T^{+} | C) = r$.\n- The clinical specificity is the probability of a negative test given the individual is not a carrier. It is given as approximately $1$, so we set $P(T^{-} | N) = 1$.\n\nThe problem asks for the residual risk, which is the posterior probability that the individual is a carrier given a negative test result, denoted by $P(C | T^{-})$. We can derive this using Bayes' theorem:\n$$\nP(C | T^{-}) = \\frac{P(T^{-} | C) P(C)}{P(T^{-})}\n$$\nTo use this formula, we first need to determine the two terms on the right-hand side, $P(T^{-} | C)$ and $P(T^{-})$.\n\n$P(T^{-} | C)$ is the probability of a negative test for a true carrier. This is the false-negative rate. Since a test result for a carrier can only be positive or negative, we have:\n$$\nP(T^{-} | C) = 1 - P(T^{+} | C) = 1 - r\n$$\n$P(T^{-})$ is the total probability of receiving a negative test result. We can calculate this using the law of total probability, marginalizing over the status of the individual (carrier or non-carrier):\n$$\nP(T^{-}) = P(T^{-} | C) P(C) + P(T^{-} | N) P(N)\n$$\nSubstituting the known values into this equation:\n$$\nP(T^{-}) = (1 - r) \\cdot p + (1) \\cdot (1 - p)\n$$\n$$\nP(T^{-}) = p - pr + 1 - p = 1 - pr\n$$\nNow we can substitute the expressions for $P(C)$, $P(T^{-} | C)$, and $P(T^{-})$ back into Bayes' theorem:\n$$\nP(C | T^{-}) = \\frac{(1 - r) \\cdot p}{1 - pr}\n$$\nThis is the closed-form expression for the residual risk, which we will denote as $R(p, r)$.\n\nNext, we analyze qualitatively how this residual risk $R(p, r)$ depends on the parameters $p$ and $r$. We can do this by examining the partial derivatives of $R(p, r)$ with respect to each parameter.\n\nDependence on $p$ (prior probability):\nTo determine if the residual risk increases or decreases with $p$, we compute the partial derivative $\\frac{\\partial R}{\\partial p}$:\n$$\n\\frac{\\partial R}{\\partial p} = \\frac{\\partial}{\\partial p} \\left( \\frac{p(1 - r)}{1 - pr} \\right)\n$$\nUsing the quotient rule for differentiation, $\\frac{d}{dx}\\left(\\frac{u}{v}\\right) = \\frac{u'v - uv'}{v^2}$, with $u = p(1 - r)$ and $v = 1 - pr$:\n$$\n\\frac{\\partial R}{\\partial p} = \\frac{(1 - r)(1 - pr) - p(1 - r)(-r)}{(1 - pr)^2} = \\frac{(1 - r - pr + pr^2) - (-pr + pr^2)}{(1 - pr)^2}\n$$\n$$\n\\frac{\\partial R}{\\partial p} = \\frac{1 - r - pr + pr^2 + pr - pr^2}{(1 - pr)^2} = \\frac{1 - r}{(1 - pr)^2}\n$$\nGiven the constraints $0 < p < 1$ and $0 < r < 1$, the numerator $(1 - r)$ is positive, and the denominator $(1 - pr)^2$ is also positive. Thus, $\\frac{\\partial R}{\\partial p} > 0$. This means the residual risk is a monotonically increasing function of the prior probability $p$. Qualitatively, a higher initial risk of being a carrier results in a higher final risk, even after a negative test.\n\nDependence on $r$ (detection rate):\nTo determine the dependence on $r$, we compute the partial derivative $\\frac{\\partial R}{\\partial r}$:\n$$\n\\frac{\\partial R}{\\partial r} = \\frac{\\partial}{\\partial r} \\left( \\frac{p - pr}{1 - pr} \\right)\n$$\nUsing the quotient rule with $u = p - pr$ and $v = 1 - pr$:\n$$\n\\frac{\\partial R}{\\partial r} = \\frac{(-p)(1 - pr) - (p - pr)(-p)}{(1 - pr)^2} = \\frac{(-p + p^2r) - (-p^2 + p^2r)}{(1 - pr)^2}\n$$\n$$\n\\frac{\\partial R}{\\partial r} = \\frac{-p + p^2r + p^2 - p^2r}{(1 - pr)^2} = \\frac{p^2 - p}{(1 - pr)^2} = \\frac{p(p - 1)}{(1 - pr)^2}\n$$\nGiven $0 < p < 1$, the term $(p - 1)$ is negative, and $p$ is positive. So, the numerator $p(p - 1)$ is negative. The denominator $(1 - pr)^2$ is positive. Thus, $\\frac{\\partial R}{\\partial r} < 0$. This means the residual risk is a monotonically decreasing function of the detection rate $r$. Qualitatively, a more sensitive test (higher $r$) provides stronger evidence against being a carrier when the result is negative, thereby lowering the residual risk.\n\nFinally, we are asked to find the linear approximation of the residual risk in the regime where the prior probability is small, i.e., $p \\ll 1$. We can obtain this using a first-order Taylor expansion of $R(p, r)$ around $p=0$:\n$$\nR(p, r) \\approx R(0, r) + p \\cdot \\left. \\frac{\\partial R}{\\partial p} \\right|_{p=0}\n$$\nFirst, we evaluate $R(p, r)$ at $p=0$:\n$$\nR(0, r) = \\frac{0 \\cdot (1 - r)}{1 - 0 \\cdot r} = 0\n$$\nNext, we evaluate the partial derivative $\\frac{\\partial R}{\\partial p}$ at $p=0$:\n$$\n\\left. \\frac{\\partial R}{\\partial p} \\right|_{p=0} = \\left. \\frac{1 - r}{(1 - pr)^2} \\right|_{p=0} = \\frac{1 - r}{(1 - 0)^2} = 1 - r\n$$\nSubstituting these into the Taylor expansion formula:\n$$\nR(p, r) \\approx 0 + p(1 - r) = p(1 - r)\n$$\nThus, for small prior probabilities, the residual risk is approximately the prior probability multiplied by the false-negative rate of the test. This approximation arises because when $p$ is very small, the total probability of a negative result $P(T^{-}) = 1 - pr$ is very close to $1$.",
            "answer": "$$\n\\boxed{\\frac{p(1 - r)}{1 - pr}}\n$$"
        },
        {
            "introduction": "This final practice elevates our perspective from individual risk assessment to the strategic design of entire screening programs. You will tackle a real-world challenge in genomic medicine by framing panel design as a constrained optimization problem, balancing assay cost, detection rate, and population diversity. This computational exercise  develops vital skills in quantitative decision-making and resource allocation, which are central to the implementation of equitable and effective precision public health initiatives.",
            "id": "4320869",
            "problem": "You are tasked with designing an inclusive carrier screening panel for autosomal recessive disorders under a fixed assay budget, maximizing the expected detection rate across multiple ancestries. Base your reasoning on the following fundamental definitions and well-tested facts: for a biallelic locus under Hardy–Weinberg equilibrium, the heterozygous carrier frequency in an ancestry for an allele with frequency $p$ is $2p(1-p)$ and, for rare alleles where $p$ is small, $2p(1-p) \\approx 2p$. In autosomal recessive carrier screening, individuals are carriers if they harbor a single pathogenic variant, and, for disjoint, variant-specific detection targets, the probability that a given carrier is detected is the sum of the probabilities that each included target is detected. When detection is carried out using a laboratory method, the sensitivity can depend on the coverage strategy and ancestry. The expected detection rate across a screened population that is composed of multiple ancestries is the ancestry-weighted sum of the detection probabilities in each ancestry.\n\nYou are given a set of variants and three coverage strategies with defined sensitivities and costs. You must select, for each variant, one coverage option from a discrete set $\\{0,1,2,3\\}$, where $0$ means exclusion (no assay) and $1,2,3$ correspond to specified coverage strategies. The goal is to choose these options to maximize the expected detection rate under a budget constraint. Formulate and solve the optimization problem as described below.\n\nLet the ancestries be indexed by $a \\in \\{0,1,2\\}$, the variants by $v \\in \\{0,1,2,3,4\\}$, and the coverage options by $k \\in \\{0,1,2,3\\}$. Define $f_{a,v}$ as the probability that a randomly selected individual from ancestry $a$ is a heterozygous carrier of variant $v$. Define $s_{a,k}$ as the sensitivity in ancestry $a$ for coverage option $k$ (with $s_{a,0} = 0$ by definition). Define $c_{v,k}$ as the assay cost for selecting option $k$ for variant $v$ (with $c_{v,0} = 0$). Let $w_a$ be the ancestry mixture weight (proportion of the screened population in ancestry $a$), with $\\sum_a w_a = 1$ and $w_a \\ge 0$. A selection vector is $x = (x_0,x_1,x_2,x_3,x_4)$ with $x_v \\in \\{0,1,2,3\\}$.\n\nGiven a budget $B$, the optimization problem is to maximize the expected detection rate\n$$\nD(x) = \\sum_{a=0}^{2} w_a \\sum_{v=0}^{4} s_{a,x_v} \\, f_{a,v}\n$$\nsubject to the budget constraint\n$$\n\\sum_{v=0}^{4} c_{v,x_v} \\le B.\n$$\nYou must assume that variants are disjoint with respect to carrier states (an individual’s carrier status is explained by at most one included variant) and that detection events across included variants are mutually exclusive, so that summing per-variant detection probabilities is valid. The detection rate must be reported as a decimal in $[0,1]$ and rounded to six decimal places. The assay budget is in arbitrary cost units; no physical units are involved.\n\nCoverage strategy definitions (acronyms are expanded on first use):\n- Targeted Genotyping (TG), indexed by $k=1$.\n- Amplicon Sequencing (AMP), indexed by $k=2$.\n- Hybridization Capture sequencing (HC), indexed by $k=3$.\n- Exclusion (no assay) indexed by $k=0$.\n\nThe sensitivity matrix $S = [s_{a,k}]$ for $a \\in \\{0,1,2\\}$ and $k \\in \\{1,2,3\\}$ is:\n$$\nS =\n\\begin{pmatrix}\n0.92 & 0.97 & 0.995 \\\\\n0.85 & 0.95 & 0.99 \\\\\n0.88 & 0.96 & 0.993\n\\end{pmatrix},\n$$\nwith the convention $s_{a,0} = 0$ for all $a$.\n\nThe per-ancestry per-variant carrier probabilities $F = [f_{a,v}]$ for $a \\in \\{0,1,2\\}$ and $v \\in \\{0,1,2,3,4\\}$ are:\n$$\nF =\n\\begin{pmatrix}\n0.0040 & 0.0025 & 0.0009 & 0.0018 & 0.0005 \\\\\n0.0008 & 0.0012 & 0.0022 & 0.0011 & 0.0016 \\\\\n0.0015 & 0.0030 & 0.0007 & 0.0024 & 0.0010\n\\end{pmatrix}.\n$$\n\nThe cost matrix $C = [c_{v,k}]$ for $v \\in \\{0,1,2,3,4\\}$ and $k \\in \\{0,1,2,3\\}$ is:\n$$\nC =\n\\begin{pmatrix}\n0 & 1 & 2 & 3 \\\\\n0 & 1 & 3 & 3 \\\\\n0 & 2 & 2 & 3 \\\\\n0 & 1 & 2 & 4 \\\\\n0 & 1 & 2 & 3\n\\end{pmatrix}.\n$$\n\nYour program must implement an exact optimizer for the multiple-choice knapsack formulation described above, using principled derivations from probability and optimization. If multiple selections yield the same maximal expected detection rate, break ties by choosing the selection with the smaller total cost; if still tied, choose the lexicographically smallest selection vector (compare $x$ in increasing index order, minimizing $x_0$, then $x_1$, etc.).\n\nTest suite:\n- Case $1$: Budget $B = 5$, ancestry weights $w = [0.5, 0.3, 0.2]$.\n- Case $2$: Budget $B = 7$, ancestry weights $w = [0.1, 0.8, 0.1]$.\n- Case $3$: Budget $B = 0$, ancestry weights $w = [0.4, 0.3, 0.3]$.\n- Case $4$: Budget $B = 16$, ancestry weights $w = [0.33, 0.33, 0.34]$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test cases above. Each result must be a list of the form $[d^\\star, \\mathrm{cost}^\\star, x^\\star]$, where $d^\\star$ is the optimal expected detection rate rounded to six decimal places (decimal in $[0,1]$), $\\mathrm{cost}^\\star$ is the integer total assay cost used, and $x^\\star$ is the selected coverage vector of length $5$ with entries in $\\{0,1,2,3\\}$, where $0$ denotes exclusion, $1$ denotes Targeted Genotyping (TG), $2$ denotes Amplicon Sequencing (AMP), and $3$ denotes Hybridization Capture sequencing (HC).",
            "solution": "The problem statement has been validated and found to be self-contained, scientifically grounded, and well-posed. All data, conditions, and objectives are clearly defined. The problem is a standard, albeit simplified, model used in genomic medicine for designing diagnostic panels and is mathematically equivalent to a well-known optimization problem. Therefore, a valid solution can be derived.\n\nThe problem asks us to select a coverage strategy for each of $5$ genetic variants to maximize the total expected detection rate across a population composed of $3$ ancestries, subject to a total cost budget. This is a classic constrained optimization problem.\n\nLet the set of ancestries be indexed by $a \\in \\{0, 1, 2\\}$, the variants by $v \\in \\{0, 1, \\dots, 4\\}$, and the coverage options by $k \\in \\{0, 1, 2, 3\\}$. The options correspond to exclusion ($k=0$), Targeted Genotyping (TG, $k=1$), Amplicon Sequencing (AMP, $k=2$), and Hybridization Capture sequencing (HC, $k=3$).\n\nThe selection is represented by a vector $x = (x_0, x_1, x_2, x_3, x_4)$, where each $x_v \\in \\{0, 1, 2, 3\\}$ is the chosen coverage option for variant $v$.\n\nThe objective is to maximize the expected detection rate, $D(x)$, given by:\n$$\nD(x) = \\sum_{a=0}^{2} w_a \\sum_{v=0}^{4} s_{a,x_v} \\, f_{a,v}\n$$\nwhere $w_a$ is the proportion of ancestry $a$ in the population, $s_{a,k}$ is the sensitivity of option $k$ in ancestry $a$, and $f_{a,v}$ is the carrier probability for variant $v$ in ancestry $a$. The summation is valid under the stated assumption that variants are disjoint and detection events are mutually exclusive.\n\nThe optimization is subject to a budget constraint:\n$$\n\\sum_{v=0}^{4} c_{v,x_v} \\le B\n$$\nwhere $c_{v,k}$ is the cost of applying option $k$ to variant $v$, and $B$ is the total budget.\n\nWe can restructure the objective function by swapping the order of summation:\n$$\nD(x) = \\sum_{v=0}^{4} \\sum_{a=0}^{2} w_a s_{a,x_v} f_{a,v}\n$$\nLet us define the \"value\" or \"benefit\" of choosing option $k$ for variant $v$, denoted $d_{v,k}$, as its contribution to the total expected detection rate:\n$$\nd_{v,k} = \\sum_{a=0}^{2} w_a s_{a,k} f_{a,v}\n$$\nWith this definition, the problem is transformed into:\nMaximize:\n$$\n\\sum_{v=0}^{4} d_{v,x_v}\n$$\nSubject to:\n$$\n\\sum_{v=0}^{4} c_{v,x_v} \\le B\n$$\nand $x_v \\in \\{0, 1, 2, 3\\}$ for each $v \\in \\{0, 1, \\dots, 4\\}$.\n\nThis is a canonical formulation of the Multiple-Choice Knapsack Problem (MCKP). In this paradigm, we have $5$ groups of items (the variants). Each group $v$ contains $4$ items (the coverage options $k$). The item corresponding to $(v,k)$ has a value $d_{v,k}$ and a weight (cost) $c_{v,k}$. The goal is to choose exactly one item from each group to maximize the total value, without the total weight exceeding the knapsack's capacity (budget $B$).\n\nWhile MCKP is NP-hard in general, the specific instance in this problem is small. The number of variants is $V=5$, and the number of options per variant is $K=4$. The total number of possible selection vectors $x$ is $K^V = 4^5 = 1024$. This search space is small enough to be fully explored by an exhaustive search (brute-force) algorithm, which guarantees finding the exact optimal solution.\n\nThe algorithm proceeds as follows for each test case:\n1.  First, for the given ancestry weights $w = (w_0, w_1, w_2)$, pre-compute the $5 \\times 4$ value matrix $D_{val} = [d_{v,k}]$. Each element $d_{v,k}$ is calculated using the formula $d_{v,k} = \\sum_{a=0}^{2} w_a s_{a,k} f_{a,v}$. Note that since $s_{a,0}=0$ and $c_{v,0}=0$, the value $d_{v,0}$ is always $0$.\n2.  Initialize a candidate for the optimal solution: a detection rate $d^\\star = -1.0$, a cost $\\mathrm{cost}^\\star = \\infty$, and a selection vector $x^\\star = \\emptyset$.\n3.  Iterate through all $4^5 = 1024$ possible selection vectors $x = (x_0, x_1, x_2, x_3, x_4)$, where each $x_v \\in \\{0, 1, 2, 3\\}$.\n4.  For each vector $x$, calculate the current total cost, $C_{curr} = \\sum_{v=0}^{4} c_{v,x_v}$, and the current total detection rate, $D_{curr} = \\sum_{v=0}^{4} d_{v,x_v}$.\n5.  If $C_{curr} > B$, the selection is invalid; discard it and proceed to the next.\n6.  If the selection is valid, compare the current solution ($D_{curr}, C_{curr}, x$) with the best-so-far ($d^\\star, \\mathrm{cost}^\\star, x^\\star$) according to the specified tie-breaking rules:\n    a. If $D_{curr}$ is greater than $d^\\star$ (within a small floating-point tolerance), the current solution becomes the new best solution.\n    b. If $D_{curr}$ is equal to $d^\\star$, check the costs. If $C_{curr} < \\mathrm{cost}^\\star$, the current solution is better.\n    c. If both detection rate and cost are equal, compare the selection vectors lexicographically. If $x$ is smaller than $x^\\star$, the current solution is better.\n7.  After iterating through all possible selections, the stored ($d^\\star, \\mathrm{cost}^\\star, x^\\star$) is the unique optimal solution. The detection rate $d^\\star$ is then rounded to six decimal places as required.\nThis procedure is implemented for each of the $4$ test cases provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport itertools\n\ndef solve():\n    \"\"\"\n    Solves the multiple-choice knapsack problem for carrier screening panel design.\n    \"\"\"\n\n    # --- Static data provided in the problem statement ---\n    \n    # Sensitivity matrix S = [s_{a,k}] for a in {0,1,2}, k in {1,2,3}\n    S_given = np.array([\n        [0.92, 0.97, 0.995],\n        [0.85, 0.95, 0.99],\n        [0.88, 0.96, 0.993]\n    ])\n    # Prepend a column of zeros for k=0 (exclusion)\n    S = np.hstack([np.zeros((3, 1)), S_given])\n\n    # Per-ancestry per-variant carrier probabilities F = [f_{a,v}] for a in {0..4}, v in {0..4}\n    F = np.array([\n        [0.0040, 0.0025, 0.0009, 0.0018, 0.0005],\n        [0.0008, 0.0012, 0.0022, 0.0011, 0.0016],\n        [0.0015, 0.0030, 0.0007, 0.0024, 0.0010]\n    ])\n\n    # Cost matrix C = [c_{v,k}] for v in {0..4}, k in {0..3}\n    C = np.array([\n        [0, 1, 2, 3],\n        [0, 1, 3, 3],\n        [0, 2, 2, 3],\n        [0, 1, 2, 4],\n        [0, 1, 2, 3]\n    ])\n\n    # --- Test suite definition ---\n    test_cases = [\n        # (Budget B, ancestry weights w)\n        (5, np.array([0.5, 0.3, 0.2])),\n        (7, np.array([0.1, 0.8, 0.1])),\n        (0, np.array([0.4, 0.3, 0.3])),\n        (16, np.array([0.33, 0.33, 0.34])),\n    ]\n\n    all_results = []\n\n    for B, w in test_cases:\n        # --- Algorithm Implementation ---\n        \n        # 1. Pre-compute the value matrix d_{v,k}\n        # d_vk[v, k] = sum over a (w[a] * S[a, k] * F[a, v])\n        num_variants = F.shape[1]\n        num_options = S.shape[1]\n        d_vk = np.zeros((num_variants, num_options))\n        for v in range(num_variants):\n            for k in range(num_options):\n                d_vk[v, k] = np.dot(w, S[:, k] * F[:, v])\n\n        # 2. Initialize the best solution tracker\n        best_rate = -1.0\n        best_cost = float('inf')\n        best_selection = []\n        \n        # Use a small tolerance for floating point comparisons\n        TOLERANCE = 1e-9\n\n        # 3. Iterate through all 4^5 = 1024 possible selections\n        # The selection vector x is a tuple (x_0, x_1, x_2, x_3, x_4)\n        for x in itertools.product(range(num_options), repeat=num_variants):\n            \n            # 4. Calculate cost and detection rate for the current selection\n            current_cost = sum(C[v, x[v]] for v in range(num_variants))\n            current_rate = sum(d_vk[v, x[v]] for v in range(num_variants))\n\n            # 5. Check budget constraint\n            if current_cost > B:\n                continue\n\n            # 6. Apply tie-breaking rules to find the best solution\n            is_better = False\n            if current_rate > best_rate + TOLERANCE:\n                is_better = True\n            elif abs(current_rate - best_rate)  TOLERANCE:\n                if current_cost  best_cost:\n                    is_better = True\n                elif current_cost == best_cost:\n                    # Lexicographical comparison for the final tie-breaker\n                    if not best_selection or list(x)  best_selection:\n                        is_better = True\n            \n            if is_better:\n                best_rate = current_rate\n                best_cost = current_cost\n                best_selection = list(x)\n\n        # Format the result for the current test case\n        # Default to all-zero selection if no valid solution is found (e.g., negative budget)\n        if not best_selection:\n             best_rate = 0.0\n             best_cost = 0\n             best_selection = [0] * num_variants\n             \n        result_str = f\"[{best_rate:.6f}, {best_cost}, {best_selection}]\"\n        all_results.append(result_str)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        }
    ]
}