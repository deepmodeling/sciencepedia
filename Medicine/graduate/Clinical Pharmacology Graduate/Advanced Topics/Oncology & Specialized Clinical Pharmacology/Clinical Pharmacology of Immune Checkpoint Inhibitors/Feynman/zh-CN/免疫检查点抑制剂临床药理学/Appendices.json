{
    "hands_on_practices": [
        {
            "introduction": "免疫检查点抑制剂的疗效取决于其与靶点受体结合并阻断其功能的能力。本练习旨在探讨药物在靶点部位的浓度与其产生的受体占有率（Receptor Occupancy, RO）之间的基本关系。通过应用质量作用定律，您将量化这一关系，这是将药物剂量与其生物学效应联系起来的第一步。这项练习将帮助您理解药物亲和力（以平衡解离常数 $K_D$ 表示）和药物浓度 $C$ 如何共同决定靶点参与的程度。",
            "id": "4536177",
            "problem": "一种全人源单克隆抗体免疫检查点抑制剂靶向作用于T淋巴细胞上的程序性死亡蛋白1（PD-1）。在稳态下的组织间隙中，游离抗体浓度为 $C = 1\\,\\text{nM}$。该抗体以 $1{:}1$ 的可逆相互作用与PD-1结合，平衡解离常数为 $K_{D} = 0.1\\,\\text{nM}$。假设 (i) 受体是同质的，(ii) 相对于药代动力学时间尺度，结合是快速的，因此结合处于热力学平衡状态，(iii) 配体耗竭可忽略不计，因此游离浓度 $C$ 近似于受体表面的未结合配体浓度，以及 (iv) 不存在协同性或变构效应。\n\n仅以质量作用定律和平衡解离常数 $K_{D}$ 的定义为出发点，推导稳态受体占有率 $\\theta$（被抗体结合的总受体分数）关于游离浓度 $C$ 和 $K_{D}$ 的表达式。然后，根据给定的 $K_{D}$ 和 $C$ 计算 $\\theta$ 的值。将 $\\theta$ 的最终数值四舍五入至四位有效数字，并以小数形式表示（不要使用百分号）。\n\n最后，基于T细胞中PD-1信号的性质和您计算出的占有率，定性地解释在此占有率水平下，T细胞受体（TCR）信号和效应子功能变化的预期方向和相对幅度，假设下游信号传导与占有率呈单调关系，并且没有受体储备使该关系复杂化。您最终报告的答案必须仅为按上述说明格式化的 $\\theta$ 的数值。",
            "solution": "该问题要求推导稳态受体占有率 $\\theta$ 的表达式，然后根据给定的游离抗体浓度 $C$ 和平衡解离常数 $K_D$ 计算其值。最后，需要对结果进行定性解释。\n\n首先，我们根据质量作用定律，为配体（单克隆抗体）与受体（PD-1）的可逆结合建立理论框架。设 $R$ 表示游离受体， $C$ 表示游离抗体浓度， $RC$ 表示受体-抗体复合物。问题陈述这是一个 $1{:}1$ 的相互作用，可以用以下化学平衡表示：\n$$ R + C \\rightleftharpoons RC $$\n\n正向反应（结合）的速率由 $k_{on}[R][C]$ 给出，逆向反应（解离）的速率由 $k_{off}[RC]$ 给出，其中 $k_{on}$ 是结合速率常数， $k_{off}$ 是解离速率常数，方括号表示摩尔浓度。\n\n问题陈述结合处于热力学平衡状态。在平衡时，结合速率等于解离速率：\n$$ k_{on}[R][C] = k_{off}[RC] $$\n\n平衡解离常数 $K_D$ 定义为解离速率常数与结合速率常数的比值，即 $K_D = \\frac{k_{off}}{k_{on}}$。重排平衡方程，我们可以用各物质的浓度来表示 $K_D$：\n$$ K_D = \\frac{[R][C]}{[RC]} $$\n该方程关联了平衡状态下游离受体、游离配体和受体-配体复合物的浓度。\n\n受体占有率 $\\theta$ 定义为被配体结合的总受体库的分数。设 $R_T$ 为总受体浓度。总受体浓度是游离受体浓度 $[R]$ 和结合受体浓度 $[RC]$ 的和：\n$$ [R_T] = [R] + [RC] $$\n因此，占有率 $\\theta$ 为：\n$$ \\theta = \\frac{[RC]}{[R_T]} = \\frac{[RC]}{[R] + [RC]} $$\n\n为了推导 $\\theta$ 关于 $C$ 和 $K_D$ 的表达式，我们必须从 $\\theta$ 的表达式中消去 $[R]$ 和 $[RC]$。我们可以重排 $K_D$ 的定义，用 $[RC]$, $[C]$ 和 $K_D$ 来表示 $[R]$：\n$$ [R] = \\frac{K_D [RC]}{[C]} $$\n\n现在，将这个 $[R]$ 的表达式代入 $\\theta$ 方程的分母中：\n$$ \\theta = \\frac{[RC]}{\\left(\\frac{K_D [RC]}{[C]}\\right) + [RC]} $$\n\n我们可以从分母中提出公因子 $[RC]$：\n$$ \\theta = \\frac{[RC]}{[RC] \\left(\\frac{K_D}{C} + 1\\right)} $$\n\n假设有结合发生，则 $[RC]$ 不为零，因此我们可以消去分子和分母中的 $[RC]$ 项：\n$$ \\theta = \\frac{1}{\\frac{K_D}{C} + 1} $$\n\n为了简化此表达式，我们可以将分子和分母同乘以 $C$：\n$$ \\theta = \\frac{C}{K_D + C} $$\n这就是所求的受体占有率关于游离配体浓度 $C$ 和平衡解离常数 $K_D$ 的表达式。该关系式也称为非协同（$n=1$）系统的Hill-Langmuir方程。\n\n接下来，我们使用给定值计算 $\\theta$：\n游离抗体浓度， $C = 1\\,\\text{nM}$。\n平衡解离常数， $K_D = 0.1\\,\\text{nM}$。\n\n将这些值代入推导出的方程中：\n$$ \\theta = \\frac{1\\,\\text{nM}}{0.1\\,\\text{nM} + 1\\,\\text{nM}} = \\frac{1}{1.1} $$\n\n计算数值：\n$$ \\theta = 0.909090... $$\n\n问题要求将最终值四舍五入至四位有效数字。\n$$ \\theta \\approx 0.9091 $$\n\n最后，我们解释这个结果。蛋白质PD-1是T细胞上的一个抑制性受体。当被其天然配体（例如PD-L1）激活时，它会传递一个抑制T细胞受体（TCR）信号并削弱T细胞效应子功能的信号。该药物是一种与PD-1结合的抗体，通过阻断其天然配体的结合而充当竞争性拮抗剂。计算出的占有率 $\\theta \\approx 0.9091$ 表明，在给定的稳态浓度下，大约 $90.91\\%$ 的PD-1受体被该抗体结合和阻断。\n\n根据问题中下游效应与占有率呈单调关系的假设，这种高水平的受体阻断将显著阻止PD-1传递其抑制信号。解除对T细胞活化的这一强大抑制性制动，会导致T细胞功能的去抑制，即增强。因此，预期的变化方向是TCR信号和T细胞效应子功能（如增殖、细胞因子释放和细胞毒性）的显著**增加**。由于占有率接近饱和，表明该机制可达到的生物学反应接近最大值，因此预计该效应的幅度会很大。",
            "answer": "$$\\boxed{0.9091}$$"
        },
        {
            "introduction": "理解了靶点参与机制后，我们需要探究身体如何决定可用于靶点的药物浓度，这正是药代动力学（Pharmacokinetics, PK）的研究范畴。此实践聚焦于一个核心的药代动力学原理：药物清除率 $CL$、给药剂量 $D$ 与总药物暴露量（以曲线下面积 $AUC$ 表示）之间的关系。您将计算患者清除率的变化——这在临床实践中很常见——如何直接影响其总药物暴露量，这项练习突出了清除率在决定潜在疗效和毒性风险中的关键作用。",
            "id": "4536231",
            "problem": "一名患有转移性黑色素瘤的患者正在接受程序性死亡受体1 (PD-1) 免疫检查点抑制剂 (ICI) pembrolizumab的治疗，给药方式为每$3$周一次$200\\,\\text{mg}$固定剂量的静脉输注。考虑单次静脉注射$200\\,\\text{mg}$剂量的情况，其处置过程可由线性、时不变的药代动力学充分描述，这与单克隆抗体在治疗浓度下、在给药间隔内无明显靶介导药物处置的情况一致。由于疾病状态和全身性炎症的改变，该患者的全身总清除率从$0.3\\,\\text{L/day}$变为$0.2\\,\\text{L/day}$。仅使用质量平衡和清除率的核心定义，计算总暴露量的倍数变化，该变化定义为清除率改变后与改变前从零时到无穷大的血浆药物浓度-时间曲线下面积（$\\text{AUC}_{0\\to\\infty}$）之比。将最终数值答案表示为一个无量纲量，并四舍五入至三位有效数字；数值答案中不要包含单位。然后，从基本原理出发，简要论证在除所述清除率变化外，靶点表达、分布或给药方案均无变化的假设下，这种暴露量的变化预计将如何影响免疫检查点抑制剂的疗效和发生免疫相关不良事件的风险。",
            "solution": "首先对问题陈述进行验证，以确保其具有科学依据、良定且客观。\n\n**步骤1：提取已知条件**\n- 药物：pembrolizumab，一种程序性死亡受体1 (PD-1) 免疫检查点抑制剂 (ICI)。\n- 给药方式：静脉 (IV) 输注。\n- 剂量, $D$：$200\\,\\text{mg}$ (固定剂量)。\n- 药代动力学模型：线性、时不变，基于单次静脉注射剂量。无明显靶介导药物处置 (TMDD)。\n- 初始全身总清除率, $CL_1$：$0.3\\,\\text{L/day}$。\n- 最终全身总清除率, $CL_2$：$0.2\\,\\text{L/day}$。\n- 暴露量定义：从零时到无穷大的血浆药物浓度-时间曲线下面积, $\\text{AUC}_{0\\to\\infty}$。\n- 要求计算：总暴露量的倍数变化，定义为比值 $\\frac{\\text{AUC}_{2}}{\\text{AUC}_{1}}$，其中 $\\text{AUC}_1$ 是清除率变化前的暴露量，$\\text{AUC}_2$ 是变化后的暴露量。\n- 要求论证：从基本原理出发，解释暴露量的变化将如何影响疗效和免疫相关不良事件 (irAEs) 的风险。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题在科学上是合理的。Pembrolizumab是一种真实药物，其剂量、给药途径和药代动力学假设（单克隆抗体在治疗浓度下的线性处置）在临床药理学中是标准的。清除率数值在生理上是合理的。剂量、清除率和暴露量 ($\\text{AUC}$) 之间的关系是药代动力学的基本原理。该问题是良定的，提供了计算所需比值的所有必要信息。语言精确且客观。没有矛盾、歧义或违反科学原理之处。\n\n**结论：** 该问题有效。\n\n**定量解答**\n\n药物的全身总清除率 $CL$ 是一个药代动力学参数，它将药物从体内的消除速率与其血浆浓度 $C(t)$ 联系起来。根据定义，消除速率为 $CL \\cdot C(t)$。\n\n根据质量平衡原理，对于通过静脉途径给药的药物，在所有时间内从体内消除的药物总量必须等于进入体循环的总剂量 $D$。消除的药物总量是消除速率从零时到无穷大的积分：\n$$ \\text{Total amount eliminated} = \\int_{0}^{\\infty} \\text{Rate of elimination} \\,dt = \\int_{0}^{\\infty} CL \\cdot C(t) \\,dt $$\n由于问题陈述药代动力学是时不变的，因此 $CL$ 是一个常数。所以，我们可以写成：\n$$ \\text{Total amount eliminated} = CL \\int_{0}^{\\infty} C(t) \\,dt $$\n积分项 $\\int_{0}^{\\infty} C(t) \\,dt$ 根据定义是从零时到无穷大的血浆药物浓度-时间曲线下面积，即 $\\text{AUC}_{0\\to\\infty}$。因此，总消除量为 $CL \\cdot \\text{AUC}_{0\\to\\infty}$。\n\n将给药量与消除量相等，得到基本关系式：\n$$ D = CL \\cdot \\text{AUC}_{0\\to\\infty} $$\n该方程可以重排以求解暴露量：\n$$ \\text{AUC}_{0\\to\\infty} = \\frac{D}{CL} $$\n该方程表明，对于给定的剂量，总暴露量与清除率成反比。\n\n设 $\\text{AUC}_1$ 为对应于初始清除率 $CL_1$ 的暴露量，$\\text{AUC}_2$ 为对应于最终清除率 $CL_2$ 的暴露量。在两种情况下，给药剂量 $D = 200\\,\\text{mg}$ 保持不变。\n$$ \\text{AUC}_1 = \\frac{D}{CL_1} $$\n$$ \\text{AUC}_2 = \\frac{D}{CL_2} $$\n问题要求计算总暴露量的倍数变化，即比值 $\\frac{\\text{AUC}_2}{\\text{AUC}_1}$。\n$$ \\frac{\\text{AUC}_2}{\\text{AUC}_1} = \\frac{\\frac{D}{CL_2}}{\\frac{D}{CL_1}} = \\frac{D}{CL_2} \\cdot \\frac{CL_1}{D} = \\frac{CL_1}{CL_2} $$\n剂量 $D$ 被约去，表明暴露量的倍数变化仅取决于清除率的比值。\n\n给定值为 $CL_1 = 0.3\\,\\text{L/day}$ 和 $CL_2 = 0.2\\,\\text{L/day}$。将这些值代入表达式中：\n$$ \\frac{\\text{AUC}_2}{\\text{AUC}_1} = \\frac{0.3\\,\\text{L/day}}{0.2\\,\\text{L/day}} = 1.5 $$\n问题要求答案四舍五入至三位有效数字。精确值 $1.5$ 可以写成 $1.50$。\n\n**定性论证**\n\n$1.50$ 的倍数变化意味着患者的总药物暴露量增加了 $50\\%$。药物暴露量与其药理效应（包括期望效应和不良效应）之间的关系是临床药理学的核心原则，称为暴露-反应关系。\n\n1.  **对疗效的影响**：像pembrolizumab这样的免疫检查点抑制剂的疗效，是由其与T细胞上的PD-1受体结合并阻断该受体的能力所驱动的，从而恢复抗肿瘤免疫活性。这种结合是浓度依赖性的。暴露量 ($\\text{AUC}$) 增加 $50\\%$ 意味着pembrolizumab的血浆浓度会更高，并持续更长时间。这种暴露量增加对疗效的影响，取决于患者初始暴露水平在暴露-疗效曲线上的位置。对于单克隆抗体，在治疗浓度下，这种关系通常是平缓或平坦的（饱和状态），这意味着一旦达到某个暴露水平以实现接近最大化的受体占有率，暴露量的进一步增加只会带来递减的或没有额外的疗效改善。如果患者在 $CL_1 = 0.3\\,\\text{L/day}$ 时的初始暴露量已经处于这个平台上，那么增加的暴露量可能不会带来临床上有意义的抗肿瘤反应改善。然而，如果初始暴露量位于曲线的上升部分，那么 $50\\%$ 的增加可能会增强治疗效果。\n\n2.  **对安全性的影响（免疫相关不良事件, irAEs）**：ICI的作用机制也是其特有毒性——irAEs——的原因，这些毒性事件源于全身性免疫系统激活，导致健康组织发生炎性损伤。与疗效一样，irAEs的风险和严重程度也与药物暴露量有关。暴露-毒性关系通常比暴露-疗效关系更陡峭，且更不易饱和。因此，总药物暴露量增加 $50\\%$ 预计会增加患者发生irAEs的风险，或加重现有irAEs的严重程度。由较高药物浓度引起的更强、更持久的免疫激活，会增加对结肠（结肠炎）、肺（肺炎）、皮肤（皮炎）或内分泌腺（内分泌病）等器官产生免疫介导性损伤的可能性。因此，清除率的降低构成了一个重大的安全问题。",
            "answer": "$$\n\\boxed{1.50}\n$$"
        },
        {
            "introduction": "为整个患者群体设计给药方案，需要的不仅仅是单点计算；它要求我们必须考虑患者之间的变异性。这项高级练习将引入蒙特卡洛模拟，这是现代临床药理学中使用的一种强大的计算技术，它使我们能够整合药代动力学（如清除率 $CL$ 和分布容积 $V$）与药效动力学（如靶点亲和力 $K_D$）的变异性。通过构建一个模拟方案，您将能估算一个给药方案在不同患者群体中成功达到治疗靶点（在此案例中是高受体占有率）的概率。这项实践为您打开一扇窗，了解药物开发者如何利用定量模型来制定明智的给药策略决策，从而实现从个体计算到群体水平预测的跨越。",
            "id": "4536192",
            "problem": "一个团队正在使用单室静脉输注模型和线性药代动力学来评估免疫检查点抑制剂（ICI）的固定给药方案。您的任务是构建一个蒙特卡洛抽样方案，对于每个候选方案，在清除率（$CL$）、分布容积（$V$）和平衡解离常数（$K_D$）的分布上，估计稳态谷浓度的受体占有率（RO）超过 $0.9$ 的概率，即 $P(\\text{RO} > 0.9)$。将每个概率以四舍五入到四位小数的小数形式作答。\n\n使用以下基础来推导您的算法：\n- 线性药代动力学下单室模型的质量平衡：如果 $A(t)$ 是体内药物量，$C(t)$ 是药物浓度，则 $C(t)=A(t)/V$ 并且\n$$\\frac{dA(t)}{dt} = R_0(t) - CL \\cdot C(t),$$\n其中 $R_0(t)$ 是输注期间的零级输注速率，在非输注期间 $R_0(t)=0$。定义一级速率常数 $k$ 为 $k = CL/V$。\n- 假设通过持续时间为 $t_{\\text{inf}}$（小时）的零级输注和给药间隔为 $\\tau$（天）的重复相同剂量给药，达到稳态。稳态谷浓度定义为下一次输注开始前的瞬时浓度，即从上一次输注开始算起的 $t=\\tau$ 时刻。\n- 受体占有率（RO）由单一位点结合相互作用的质量作用定律定义为\n$$\\text{RO}(t) = \\frac{C(t)}{C(t) + K_D}.$$\n\n蒙特卡洛抽样方案：\n- 对于每个测试用例，从由中位数和几何变异系数（几何CV）参数化的对数正态分布中独立抽取 $CL$、$V$ 和 $K_D$ 的样本。如果 $X$ 的中位数为 $m$，几何CV为 $g$（以小数表示），则 $\\ln X \\sim \\mathcal{N}(\\mu, \\sigma^2)$，其中 $\\mu = \\ln m$，$\\sigma = \\sqrt{\\ln(1+g^2)}$。所有参数的样本之间都是相互独立的。\n- 对于每个样本，计算 $k = CL/V$，由零级输注和一级消除的单室模型得出的稳态谷浓度 $C_{\\min,\\text{ss}}$，然后计算 $\\text{RO}_{\\min} = \\dfrac{C_{\\min,\\text{ss}}}{C_{\\min,\\text{ss}} + K_D}$。评估事件 $\\text{RO}_{\\min} > 0.9$ 的指示函数。$P(\\text{RO} > 0.9)$ 的蒙特卡洛估计是这个指示函数在 $N$ 个样本上的均值。\n- 为保证可复现性，使用固定的随机种子 $20251111$。\n- 单位：\n  - $CL$ 单位为 $\\text{L/day}$。\n  - $V$ 单位为 $\\text{L}$。\n  - $K_D$ 单位为 $\\text{mg/L}$。\n  - 剂量单位为 $\\text{mg}$。\n  - 输注持续时间 $t_{\\text{inf}}$ 以 $\\text{hours}$（小时）为单位给出，必须通过除以 $24$ 转换为 $\\text{days}$（天）。\n  - 给药间隔 $\\tau$ 单位为 $\\text{days}$（天）。\n  - 输注期间的输注速率为 $R_0 = \\dfrac{\\text{Dose}}{t_{\\text{inf}}}$，单位为 $\\text{mg/day}$。\n\n测试套件：\n对于以下每种情况，使用指定的 $N$ 个样本计算 $P(\\text{RO} > 0.9)$ 的蒙特卡洛估计值。将每个概率以四舍五入到四位小数的小数形式报告。假设已达到稳态。\n\n- 情况 1（理想路径）：\n  - $N = 100000$\n  - 剂量 $= 240$ $\\text{mg}$，$\\tau = 14$ $\\text{天}$，$t_{\\text{inf}} = 0.5$ $\\text{小时}$\n  - $CL \\sim \\text{lognormal}$，中位数 $0.2$ $\\text{L/day}$，几何CV $0.3$\n  - $V \\sim \\text{lognormal}$，中位数 $3.5$ $\\text{L}$，几何CV $0.25$\n  - $K_D \\sim \\text{lognormal}$，中位数 $0.05$ $\\text{mg/L}$，几何CV $0.5$\n\n- 情况 2（长间隔，高剂量）：\n  - $N = 100000$\n  - 剂量 $= 400$ $\\text{mg}$，$\\tau = 42$ $\\text{天}$，$t_{\\text{inf}} = 0.5$ $\\text{小时}$\n  - $CL \\sim \\text{lognormal}$，中位数 $0.2$ $\\text{L/day}$，几何CV $0.3$\n  - $V \\sim \\text{lognormal}$，中位数 $3.5$ $\\text{L}$，几何CV $0.25$\n  - $K_D \\sim \\text{lognormal}$，中位数 $0.05$ $\\text{mg/L}$，几何CV $0.5$\n\n- 情况 3（临界亲和力）：\n  - $N = 100000$\n  - 剂量 $= 200$ $\\text{mg}$，$\\tau = 21$ $\\text{天}$，$t_{\\text{inf}} = 1.0$ $\\text{小时}$\n  - $CL \\sim \\text{lognormal}$，中位数 $0.25$ $\\text{L/day}$，几何CV $0.4$\n  - $V \\sim \\text{lognormal}$，中位数 $4.0$ $\\text{L}$，几何CV $0.3$\n  - $K_D \\sim \\text{lognormal}$，中位数 $2.0$ $\\text{mg/L}$，几何CV $0.6$\n\n- 情况 4（更长输注时间，强亲和力）：\n  - $N = 100000$\n  - 剂量 $= 480$ $\\text{mg}$，$\\tau = 28$ $\\text{天}$，$t_{\\text{inf}} = 3.0$ $\\text{小时}$\n  - $CL \\sim \\text{lognormal}$，中位数 $0.3$ $\\text{L/day}$，几何CV $0.5$\n  - $V \\sim \\text{lognormal}$，中位数 $3.0$ $\\text{L}$，几何CV $0.2$\n  - $K_D \\sim \\text{lognormal}$，中位数 $0.02$ $\\text{mg/L}$，几何CV $0.3$\n\n- 情况 5（边缘情况：弱暴露和弱亲和力）：\n  - $N = 100000$\n  - 剂量 $= 100$ $\\text{mg}$，$\\tau = 42$ $\\text{天}$，$t_{\\text{inf}} = 0.5$ $\\text{小时}$\n  - $CL \\sim \\text{lognormal}$，中位数 $0.35$ $\\text{L/day}$，几何CV $0.4$\n  - $V \\sim \\text{lognormal}$，中位数 $5.0$ $\\text{L}$，几何CV $0.3$\n  - $K_D \\sim \\text{lognormal}$，中位数 $2.0$ $\\text{mg/L}$，几何CV $0.6$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含五个情况的估计概率，格式为逗号分隔的列表，并用方括号括起来（例如，“[0.9876,0.9123,0.5000,1.0000,0.1234]”）。每个概率必须四舍五入到四位小数。不应打印其他任何文本。",
            "solution": "该问题要求构建一个蒙特卡洛模拟，以估计对于免疫检查点抑制剂（ICI）的几种固定给药方案，稳态谷浓度的受体占有率超过某一阈值的概率。该分析基于标准的单室药代动力学（PK）模型和单一位点结合的药效学（PD）模型。\n\n对问题陈述的验证证实了其科学性、适定性和客观性。所有必要的参数和模型都已指定，从而可以直接、明确地进行计算求解。\n\n解决方案分为三个主要步骤：\n1.  推导稳态谷浓度药物浓度（$C_{\\min,\\text{ss}}$）的解析表达式。\n2.  根据模型参数表述目标概率条件。\n3.  设计蒙特卡洛模拟算法以估计此概率。\n\n**1. 药代动力学模型和稳态谷浓度**\n\n药物浓度动态由一个具有零级静脉输注和一级消除的单室模型描述。浓度 $C(t)$ 由以下微分方程控制：\n$$ \\frac{dC(t)}{dt} = \\frac{R_0(t)}{V} - k C(t) $$\n其中 $V$ 是分布容积，$R_0(t)$ 是输注速率，$k = CL/V$ 是一级消除速率常数，$CL$ 是清除率。\n\n给药方案包括在每个给药间隔 $\\tau$ 内，以速率 $R_0 = \\frac{\\text{Dose}}{t_{\\text{inf}}}$ 进行持续时间为 $t_{\\text{inf}}$ 的连续输注。在稳态下，一个间隔内的浓度曲线是周期性的。输注开始时的浓度 $C_{\\min,\\text{ss}}$ 即为谷浓度。\n\n在输注阶段（$0 \\le t \\le t_{\\text{inf}}$），浓度从 $C_{\\min,\\text{ss}}$ 增加到峰浓度 $C_{\\max,\\text{ss}}$，遵循以下公式：\n$$ C(t) = \\frac{R_0}{kV} \\left(1 - e^{-kt}\\right) + C_{\\min,\\text{ss}} e^{-kt} $$\n在输注结束时（$t = t_{\\text{inf}}$），浓度为：\n$$ C_{\\max,\\text{ss}} = \\frac{R_0}{kV} \\left(1 - e^{-k t_{\\text{inf}}}\\right) + C_{\\min,\\text{ss}} e^{-k t_{\\text{inf}}} $$\n\n在输注后消除阶段（$t_{\\text{inf}} < t \\le \\tau$），输注速率 $R_0 = 0$，浓度从 $C_{\\max,\\text{ss}}$ 开始指数衰减：\n$$ C(t) = C_{\\max,\\text{ss}} e^{-k(t-t_{\\text{inf}})} $$\n在给药间隔结束时（$t = \\tau$），浓度返回到下一个周期的谷浓度值：\n$$ C_{\\min,\\text{ss}} = C_{\\max,\\text{ss}} e^{-k(\\tau - t_{\\text{inf}})} $$\n\n通过将 $C_{\\max,\\text{ss}}$ 的表达式代入 $C_{\\min,\\text{ss}}$ 的方程中并求解 $C_{\\min,\\text{ss}}$，我们得到稳态谷浓度的解析表达式：\n$$ C_{\\min,\\text{ss}} \\left(1 - e^{-k\\tau}\\right) = \\frac{R_0}{kV} \\left(1 - e^{-k t_{\\text{inf}}}\\right) e^{-k(\\tau - t_{\\text{inf}})} $$\n整理后得到最终公式：\n$$ C_{\\min,\\text{ss}} = \\frac{R_0}{kV} \\frac{1 - e^{-k t_{\\text{inf}}}}{1 - e^{-k\\tau}} e^{-k(\\tau - t_{\\text{inf}})} $$\n代入 $R_0 = \\frac{\\text{Dose}}{t_{\\text{inf}}}$ 和 $kV = CL$，我们得到用于计算的表达式：\n$$ C_{\\min,\\text{ss}} = \\frac{\\text{Dose}}{CL \\cdot t_{\\text{inf}}} \\frac{1 - e^{-k t_{\\text{inf}}}}{1 - e^{-k\\tau}} e^{-k(\\tau - t_{\\text{inf}})} $$\n关键是所有与时间相关的参数（$t_{\\text{inf}}$、$\\tau$、$k$、$CL$）都使用一致的单位。根据规定，$t_{\\text{inf}}$ 以小时为单位给出，必须转换为天，以匹配 $\\tau$（天）和 $CL$（L/天）的单位。\n\n**2. 药效学模型和目标条件**\n\n受体占有率（RO）使用单一位点结合相互作用的质量作用定律进行建模：\n$$ \\text{RO}(t) = \\frac{C(t)}{C(t) + K_D} $$\n其中 $K_D$ 是平衡解离常数。问题要求估计谷浓度受体占有率 $\\text{RO}_{\\min} = \\text{RO}(\\tau)$ 超过 $0.9$ 的概率：\n$$ P(\\text{RO}_{\\min} > 0.9) $$\n条件 $\\text{RO}_{\\min} > 0.9$ 可以用浓度来表示：\n$$ \\frac{C_{\\min,\\text{ss}}}{C_{\\min,\\text{ss}} + K_D} > 0.9 $$\n一个简单的代数变换可以分离出 $C_{\\min,\\text{ss}}$：\n$$ C_{\\min,\\text{ss}} > 0.9 (C_{\\min,\\text{ss}} + K_D) $$\n$$ 0.1 C_{\\min,\\text{ss}} > 0.9 K_D $$\n$$ C_{\\min,\\text{ss}} > 9 K_D $$\n这个不等式为评估每个模拟受试者提供了一个直接的标准。\n\n**3. 蒙特卡洛模拟设计**\n\n该模拟将通过生成大量虚拟受试者来估计所需概率，每个受试者都有一套从指定分布中抽样的独特 PK/PD 参数。\n\n每个测试用例的计划如下：\n1.  **参数抽样**：为 $CL$、$V$ 和 $K_D$ 生成 $N=100000$ 个独立样本。每个参数 $X$ 都遵循具有指定中位数 $m$ 和几何变异系数 $g$ 的对数正态分布。$\\ln X$ 的基础正态分布参数为 $\\mu = \\ln(m)$ 和 $\\sigma = \\sqrt{\\ln(1+g^2)}$。使用以固定种子（$20251111$）初始化的伪随机数生成器生成样本，以确保可复现性。\n\n2.  **计算**：对于 $N$ 个抽样参数集 $\\{CL_i, V_i, K_{D,i}\\}$ 中的每一个：\n    a. 计算消除速率常数 $k_i = CL_i / V_i$。\n    b. 使用步骤1中推导的公式计算稳态谷浓度 $C_{\\min,\\text{ss},i}$，确保单位一致（时间单位为天，体积单位为L，质量单位为mg）。\n    c. 评估布尔指示函数 $I(C_{\\min,\\text{ss},i} > 9 K_{D,i})$，如果条件为真，则为 $1$，否则为 $0$。\n\n3.  **概率估计**：概率 $P(\\text{RO}_{\\min} > 0.9)$ 估计为所有 $N$ 个样本上指示函数值的算术平均值：\n$$ \\hat{P} = \\frac{1}{N} \\sum_{i=1}^{N} I(C_{\\min,\\text{ss},i} > 9 K_{D,i}) $$\n\n此过程使用 Python 的 `numpy` 库实现，以进行高效的向量化计算。代码遍历所提供的五个测试用例，为每个用例执行模拟，并报告四舍五入到四位小数的估计概率。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(case, N, rng):\n    \"\"\"\n    Runs a Monte Carlo simulation for a single test case.\n\n    Args:\n        case (dict): A dictionary containing parameters for the test case.\n        N (int): The number of samples for the simulation.\n        rng (numpy.random.Generator): The random number generator instance.\n\n    Returns:\n        float: The estimated probability P(RO > 0.9).\n    \"\"\"\n    # Unpack case parameters\n    dose = case['dose']        # mg\n    tau = case['tau']          # days\n    t_inf_h = case['t_inf']    # hours\n    \n    cl_median, cl_gcv = case['cl_params']\n    v_median, v_gcv = case['v_params']\n    kd_median, kd_gcv = case['kd_params']\n    \n    # Unit conversion for infusion duration from hours to days\n    t_inf_d = t_inf_h / 24.0\n\n    # Calculate parameters for the underlying normal distributions\n    mu_cl = np.log(cl_median)\n    sigma_cl = np.sqrt(np.log(1 + cl_gcv**2))\n    \n    mu_v = np.log(v_median)\n    sigma_v = np.sqrt(np.log(1 + v_gcv**2))\n    \n    mu_kd = np.log(kd_median)\n    sigma_kd = np.sqrt(np.log(1 + kd_gcv**2))\n    \n    # Generate N samples from log-normal distributions\n    cl_samples = rng.lognormal(mean=mu_cl, sigma=sigma_cl, size=N)  # L/day\n    v_samples = rng.lognormal(mean=mu_v, sigma=sigma_v, size=N)    # L\n    kd_samples = rng.lognormal(mean=mu_kd, sigma=sigma_kd, size=N)  # mg/L\n    \n    # Calculate derived PK parameters for each sample\n    k_samples = cl_samples / v_samples  # 1/day\n\n    # Vectorized calculation of steady-state trough concentration (C_min_ss)\n    # C_min,ss = (Dose / (CL * t_inf)) * (1-exp(-k*t_inf))/(1-exp(-k*tau)) * exp(-k*(tau-t_inf))\n    kt_inf = k_samples * t_inf_d\n    ktau = k_samples * tau\n\n    # Use errstate to handle potential division by zero or NaN for edge cases, though unlikely.\n    with np.errstate(divide='ignore', invalid='ignore'):\n        term1 = dose / (cl_samples * t_inf_d)\n        \n        # Using np.expm1 for better precision with exponents near zero.\n        # 1 - exp(-x) = -expm1(-x)\n        term2_num = -np.expm1(-kt_inf)\n        term2_den = -np.expm1(-ktau)\n        \n        # Avoid division by zero if k is extremely small (so k*tau is near zero)\n        # In that limit, (1-exp(-kx))/(1-exp(-ky)) -> x/y\n        term2 = np.divide(term2_num, term2_den, out=np.full_like(term2_num, t_inf_d/tau), where=(term2_den!=0))\n        \n        term3 = np.exp(-k_samples * (tau - t_inf_d))\n        \n        c_min_ss_samples = term1 * term2 * term3\n\n    # The condition RO_min > 0.9 simplifies to C_min_ss > 9 * K_D\n    successes = np.sum(c_min_ss_samples > 9 * kd_samples)\n    \n    # Estimate the probability\n    probability = successes / N\n    \n    return probability\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run simulations, and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (happy path)\n        {'dose': 240, 'tau': 14, 't_inf': 0.5, 'cl_params': (0.2, 0.3), 'v_params': (3.5, 0.25), 'kd_params': (0.05, 0.5)},\n        # Case 2 (long interval, higher dose)\n        {'dose': 400, 'tau': 42, 't_inf': 0.5, 'cl_params': (0.2, 0.3), 'v_params': (3.5, 0.25), 'kd_params': (0.05, 0.5)},\n        # Case 3 (borderline affinity)\n        {'dose': 200, 'tau': 21, 't_inf': 1.0, 'cl_params': (0.25, 0.4), 'v_params': (4.0, 0.3), 'kd_params': (2.0, 0.6)},\n        # Case 4 (longer infusion, strong affinity)\n        {'dose': 480, 'tau': 28, 't_inf': 3.0, 'cl_params': (0.3, 0.5), 'v_params': (3.0, 0.2), 'kd_params': (0.02, 0.3)},\n        # Case 5 (edge case: weak exposure and weak affinity)\n        {'dose': 100, 'tau': 42, 't_inf': 0.5, 'cl_params': (0.35, 0.4), 'v_params': (5.0, 0.3), 'kd_params': (2.0, 0.6)},\n    ]\n\n    N = 100000\n    seed = 20251111\n    \n    # Initialize a single random number generator for all simulations for reproducibility\n    rng = np.random.default_rng(seed)\n    \n    results = []\n    for case in test_cases:\n        prob = run_simulation(case, N, rng)\n        results.append(prob)\n\n    # Final print statement in the exact required format.\n    # The f-string format specifier ':.4f' correctly rounds the number to 4 decimal places.\n    print(f\"[{','.join(f'{r:.4f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}