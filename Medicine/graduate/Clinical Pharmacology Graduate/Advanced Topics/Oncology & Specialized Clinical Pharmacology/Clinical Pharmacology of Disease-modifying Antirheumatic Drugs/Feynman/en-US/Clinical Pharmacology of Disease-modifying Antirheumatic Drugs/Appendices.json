{
    "hands_on_practices": [
        {
            "introduction": "Managing drug-drug interactions (DDIs) is a cornerstone of safe and effective pharmacotherapy, particularly for targeted synthetic DMARDs that are substrates of metabolic enzymes and drug transporters. This exercise explores the dual impact of co-administered drugs on both systemic clearance ($CL$) and oral bioavailability ($F$). By calculating dose adjustments for tofacitinib in the presence of a strong inhibitor and a strong inducer, you will practice dissecting pharmacokinetic parameters to maintain therapeutic exposure and prevent toxicity or loss of efficacy .",
            "id": "4531761",
            "problem": "A patient with rheumatoid arthritis is maintained on immediate-release tofacitinib, a Janus kinase inhibitor classified among targeted synthetic disease-modifying antirheumatic drugs, at a dosing regimen of $5\\,\\mathrm{mg}$ every $12\\,\\mathrm{h}$. Tofacitinib disposition is described by linear pharmacokinetics and low hepatic extraction. Its systemic clearance is composed of a renal component and metabolic components, with cytochrome P450 3A4 (CYP3A4) being the dominant metabolic pathway. Tofacitinib is also a substrate of P-glycoprotein (P-gp), which modulates the intestinal escape fraction and thus oral bioavailability. Assume the following baseline parameters: baseline oral bioavailability $F_{0} = 0.70$ (dimensionless), baseline systemic clearance $CL_{0} = 24\\,\\mathrm{L\\,h^{-1}}$, and fractional contributions to systemic clearance $f_{\\mathrm{CYP3A4}} = 0.60$, $f_{\\mathrm{renal}} = 0.30$, and $f_{\\mathrm{other}} = 0.10$. Assume the hepatic first-pass effect is negligible under the low-extraction assumption, so changes in metabolic intrinsic clearance do not materially alter hepatic first-pass availability. Consider two coadministrations:\n\n1. Ketoconazole, a strong inhibitor of CYP3A4 and P-gp, reduces the CYP3A4-mediated intrinsic clearance to $10\\%$ of its baseline value and increases the effective oral bioavailability via P-gp inhibition by a factor of $1.25$ relative to baseline (i.e., new $F$ is $1.25 \\times F_{0}$). All other clearance pathways are unchanged.\n\n2. Rifampin, a strong inducer of CYP3A4 and P-gp, increases the CYP3A4-mediated intrinsic clearance by a factor of $4.0$ relative to baseline (i.e., new CYP3A4 clearance is $4.0$ times baseline) and decreases the effective oral bioavailability via P-gp induction by a factor of $0.60$ relative to baseline (i.e., new $F$ is $0.60 \\times F_{0}$). All other clearance pathways are unchanged.\n\nStarting from core definitions for linear pharmacokinetics, conservation of mass, and pathway-specific contributions to total systemic clearance, first derive expressions that relate the steady-state exposure over a dosing interval $\\tau = 12\\,\\mathrm{h}$ to the dose, oral bioavailability, and systemic clearance, and show how coadministration alters the apparent oral clearance through simultaneous changes in CYP3A4-mediated metabolic clearance and P-gp-modulated bioavailability. Then compute the adjusted tofacitinib doses that would maintain the same steady-state average concentration over the dosing interval as at baseline when coadministered with ketoconazole or with rifampin, assuming $\\tau$ remains $12\\,\\mathrm{h}$ and that renal and non-CYP clearance components are unaffected by the perpetrators.\n\nExpress each adjusted dose in milligrams, and round your final numeric answers to three significant figures. Provide your final answer as a two-element row in the order $\\big[$ketoconazole-adjusted dose, rifampin-adjusted dose$\\big]$.",
            "solution": "The problem is a well-posed application of fundamental pharmacokinetic principles to a clinical drug-drug interaction scenario. It is scientifically grounded, internally consistent, and contains all necessary information to derive a unique solution. Therefore, the problem is valid.\n\nThe core principle for a drug administered orally under linear pharmacokinetic conditions at steady state is that the average rate of drug administration equals the average rate of drug elimination over a dosing interval, $\\tau$. The average steady-state plasma concentration, $C_{\\mathrm{ss,avg}}$, is defined by this balance.\n\nThe amount of drug that becomes systemically available from an oral dose $D$ is given by $F \\times D$, where $F$ is the oral bioavailability. The average rate of drug input into the systemic circulation is thus $\\frac{F \\times D}{\\tau}$.\n\nThe rate of elimination from the body is proportional to the plasma concentration, $C(t)$, and the constant of proportionality is the total systemic clearance, $CL$. The average rate of elimination at steady state is $CL \\times C_{\\mathrm{ss,avg}}$.\n\nEquating the average rates of input and elimination gives:\n$$CL \\times C_{\\mathrm{ss,avg}} = \\frac{F \\times D}{\\tau}$$\nThis can be rearranged to solve for the average steady-state concentration:\n$$C_{\\mathrm{ss,avg}} = \\frac{F \\times D}{CL \\times \\tau}$$\nThe total drug exposure over one dosing interval at steady state is the Area Under the Curve, $AUC_{\\tau,ss}$. It is related to the average concentration by $C_{\\mathrm{ss,avg}} = \\frac{AUC_{\\tau,ss}}{\\tau}$. Substituting this into the previous equation yields the fundamental relationship for exposure:\n$$AUC_{\\tau,ss} = \\frac{F \\times D}{CL}$$\nThe problem requires finding an adjusted dose, $D_{\\mathrm{adj}}$, that maintains the same average steady-state concentration as the baseline condition when a drug is coadministered. Let the baseline parameters be denoted with a subscript $0$ and the adjusted parameters with a subscript $\\mathrm{adj}$. The condition to be met is $C_{\\mathrm{ss,avg,adj}} = C_{\\mathrm{ss,avg},0}$.\n$$\\frac{F_{\\mathrm{adj}} \\times D_{\\mathrm{adj}}}{CL_{\\mathrm{adj}} \\times \\tau} = \\frac{F_0 \\times D_0}{CL_0 \\times \\tau}$$\nSince the dosing interval $\\tau$ remains unchanged, it cancels out. We can solve for the adjusted dose, $D_{\\mathrm{adj}}$:\n$$D_{\\mathrm{adj}} = D_0 \\times \\left(\\frac{F_0}{F_{\\mathrm{adj}}}\\right) \\times \\left(\\frac{CL_{\\mathrm{adj}}}{CL_0}\\right)$$\nThis equation shows that the dose must be adjusted by a factor that accounts for the fold-change in bioavailability and the fold-change in total systemic clearance. The term $CL/F$ is known as the apparent oral clearance. The dose adjustment factor is the ratio of the new apparent oral clearance to the old one: $D_{\\mathrm{adj}} / D_0 = (CL_{\\mathrm{adj}}/F_{\\mathrm{adj}}) / (CL_0/F_0)$.\n\nNext, we must determine how the coadministered drugs alter $F$ and $CL$. Total systemic clearance, $CL$, is the sum of all parallel elimination pathway clearances. From the problem statement:\n$$CL = CL_{\\mathrm{renal}} + CL_{\\mathrm{CYP3A4}} + CL_{\\mathrm{other}}$$\nThe baseline values for these partial clearances can be calculated from the baseline total clearance, $CL_0 = 24\\,\\mathrm{L\\,h^{-1}}$, and the given fractional contributions:\n$CL_{\\mathrm{CYP3A4},0} = f_{\\mathrm{CYP3A4}} \\times CL_0 = 0.60 \\times 24\\,\\mathrm{L\\,h^{-1}} = 14.4\\,\\mathrm{L\\,h^{-1}}$\n$CL_{\\mathrm{renal},0} = f_{\\mathrm{renal}} \\times CL_0 = 0.30 \\times 24\\,\\mathrm{L\\,h^{-1}} = 7.2\\,\\mathrm{L\\,h^{-1}}$\n$CL_{\\mathrm{other},0} = f_{\\mathrm{other}} \\times CL_0 = 0.10 \\times 24\\,\\mathrm{L\\,h^{-1}} = 2.4\\,\\mathrm{L\\,h^{-1}}$\n\nThe problem states that only the CYP3A4-mediated clearance is affected by the coadministered drugs. The new total clearance, $CL_{\\mathrm{adj}}$, will be the sum of the altered CYP3A4 clearance and the unchanged renal and other clearances.\n$$CL_{\\mathrm{adj}} = CL_{\\mathrm{CYP3A4,adj}} + CL_{\\mathrm{renal},0} + CL_{\\mathrm{other},0}$$\n\nLet's analyze each coadministration scenario.\n\n**1. Coadministration with Ketoconazole (inhibitor)**\n\nKetoconazole reduces the CYP3A4-mediated clearance to $10\\%$ of its baseline value and increases bioavailability by a factor of $1.25$.\n- New bioavailability: $F_k = 1.25 \\times F_0$. Therefore, the ratio $\\frac{F_0}{F_k} = \\frac{1}{1.25} = 0.8$.\n- New CYP3A4 clearance: $CL_{\\mathrm{CYP3A4},k} = 0.10 \\times CL_{\\mathrm{CYP3A4},0}$.\n- New total clearance, $CL_k$:\n$$CL_k = (0.10 \\times CL_{\\mathrm{CYP3A4},0}) + CL_{\\mathrm{renal},0} + CL_{\\mathrm{other},0}$$\nWe can express the ratio $CL_k/CL_0$ in terms of the fractional contributions:\n$$\\frac{CL_k}{CL_0} = \\frac{(0.10 \\times f_{\\mathrm{CYP3A4}} \\times CL_0) + (f_{\\mathrm{renal}} \\times CL_0) + (f_{\\mathrm{other}} \\times CL_0)}{CL_0}$$\n$$\\frac{CL_k}{CL_0} = 0.10 \\times f_{\\mathrm{CYP3A4}} + f_{\\mathrm{renal}} + f_{\\mathrm{other}}$$\nSubstituting the given values:\n$$\\frac{CL_k}{CL_0} = 0.10 \\times 0.60 + 0.30 + 0.10 = 0.06 + 0.30 + 0.10 = 0.46$$\nNow we compute the adjusted dose, $D_k$, using the baseline dose $D_0 = 5\\,\\mathrm{mg}$:\n$$D_k = D_0 \\times \\left(\\frac{F_0}{F_k}\\right) \\times \\left(\\frac{CL_k}{CL_0}\\right) = 5\\,\\mathrm{mg} \\times (0.8) \\times (0.46) = 1.84\\,\\mathrm{mg}$$\nRounding to three significant figures, the adjusted dose is $1.84\\,\\mathrm{mg}$.\n\n**2. Coadministration with Rifampin (inducer)**\n\nRifampin increases the CYP3A4-mediated clearance by a factor of $4.0$ and decreases bioavailability by a factor of $0.60$.\n- New bioavailability: $F_r = 0.60 \\times F_0$. Therefore, the ratio $\\frac{F_0}{F_r} = \\frac{1}{0.60}$.\n- New CYP3A4 clearance: $CL_{\\mathrm{CYP3A4},r} = 4.0 \\times CL_{\\mathrm{CYP3A4},0}$.\n- New total clearance, $CL_r$:\n$$CL_r = (4.0 \\times CL_{\\mathrm{CYP3A4},0}) + CL_{\\mathrm{renal},0} + CL_{\\mathrm{other},0}$$\nThe ratio $CL_r/CL_0$ is:\n$$\\frac{CL_r}{CL_0} = 4.0 \\times f_{\\mathrm{CYP3A4}} + f_{\\mathrm{renal}} + f_{\\mathrm{other}}$$\nSubstituting the given values:\n$$\\frac{CL_r}{CL_0} = 4.0 \\times 0.60 + 0.30 + 0.10 = 2.40 + 0.30 + 0.10 = 2.80$$\nNow we compute the adjusted dose, $D_r$:\n$$D_r = D_0 \\times \\left(\\frac{F_0}{F_r}\\right) \\times \\left(\\frac{CL_r}{CL_0}\\right) = 5\\,\\mathrm{mg} \\times \\left(\\frac{1}{0.60}\\right) \\times (2.80) = 5\\,\\mathrm{mg} \\times \\frac{2.80}{0.60} \\approx 23.333...\\,\\mathrm{mg}$$\nRounding to three significant figures, the adjusted dose is $23.3\\,\\mathrm{mg}$.\n\nThe final answers are the adjusted doses for coadministration with ketoconazole and rifampin, respectively.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.84 & 23.3\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Biologic DMARDs, such as monoclonal antibodies, have revolutionized rheumatology, but their efficacy can be compromised by immunogenicity—the development of anti-drug antibodies (ADAs). ADAs can neutralize the drug or, more commonly, form immune complexes that accelerate its clearance from the body. This practice provides a clear, quantitative demonstration of this phenomenon, challenging you to calculate the new steady-state trough concentration after ADAs have increased systemic clearance, based on the fundamental inverse relationship between drug exposure and clearance ($C_{ss} \\propto 1/CL$) .",
            "id": "4531849",
            "problem": "A patient with rheumatoid arthritis is treated with a fully human immunoglobulin G1 monoclonal antibody disease-modifying antirheumatic drug (DMARD) administered subcutaneously at a fixed dose and fixed dosing interval. At steady state prior to the development of anti-drug antibodies (ADAs), the measured trough concentration is $7.20$ mg/L. After several months, ADAs develop and increase the drug’s systemic clearance by $25\\%$ relative to baseline, with no change in dosing regimen, bioavailability, or the within-interval concentration–time shape factor that links the trough concentration to the average steady-state concentration. Assume linear pharmacokinetics.\n\nUsing only fundamental definitions of clearance and steady-state mass balance, determine the new steady-state trough concentration. Express your final answer in mg/L and round to three significant figures.",
            "solution": "The problem will first be validated to ensure it is scientifically sound, well-posed, and objective.\n\n### Step 1: Extract Givens\n- **Drug type:** Fully human immunoglobulin G1 monoclonal antibody disease-modifying antirheumatic drug (DMARD).\n- **Administration:** Subcutaneous, fixed dose, fixed dosing interval.\n- **Pharmacokinetic model:** Linear pharmacokinetics are assumed.\n- **Initial state (State 1, pre-ADA):** At steady state, the measured trough concentration is $C_{trough,1} = 7.20$ mg/L.\n- **Final state (State 2, post-ADA):** At steady state, after development of anti-drug antibodies (ADAs).\n- **Change in clearance:** Systemic clearance in State 2 ($CL_2$) is increased by $25\\%$ relative to baseline clearance in State 1 ($CL_1$).\n- **Invariants:** The dosing regimen (dose $D$ and dosing interval $\\tau$), bioavailability ($F$), and the \"within-interval concentration–time shape factor\" are unchanged.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded:** The problem is grounded in fundamental principles of clinical pharmacology and pharmacokinetics. The use of monoclonal antibodies as DMARDs, the development of anti-drug antibodies, and the consequent alteration of drug clearance are well-documented clinical phenomena. The concepts of steady state, clearance, bioavailability, and trough concentration are standard in the field.\n2.  **Well-Posed:** The problem is well-posed. It provides sufficient information to determine the new trough concentration. The relationship between steady-state concentration, clearance, and dosing is governed by fundamental pharmacokinetic equations. The invariance of the \"shape factor\" provides a direct link between the average and trough concentrations, which is key to the solution. A unique, stable, and meaningful solution exists.\n3.  **Objective:** The problem is stated in precise, objective language, using quantitative data and established terminology. It is free of subjective or opinion-based claims.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. It is scientifically sound, self-contained, and quantitatively defined. The solution process may proceed.\n\n### Solution\nThe solution is derived from the fundamental principles of steady-state pharmacokinetics.\n\nAt steady state, the rate of drug administration is equal to the rate of drug elimination when averaged over one dosing interval, $\\tau$. The average rate of administration for a drug given at a dose $D$ with a dosing interval $\\tau$ and bioavailability $F$ is $\\frac{F \\cdot D}{\\tau}$. The average rate of elimination is the product of the systemic clearance, $CL$, and the average steady-state plasma concentration, $C_{ss,avg}$.\n\nEquating these rates gives the mass-balance equation at steady state:\n$$CL \\cdot C_{ss,avg} = \\frac{F \\cdot D}{\\tau}$$\n\nThis equation can be rearranged to solve for the average steady-state concentration:\n$$C_{ss,avg} = \\frac{F \\cdot D}{CL \\cdot \\tau}$$\n\nThe problem states that a \"within-interval concentration–time shape factor\" links the trough concentration, $C_{trough}$, to the average steady-state concentration, $C_{ss,avg}$. Let us denote this dimensionless shape factor by $\\phi$. The relationship can be expressed as:\n$$C_{trough} = \\phi \\cdot C_{ss,avg}$$\nThe problem specifies that this factor $\\phi$ remains constant. This is a reasonable assumption if the development of ADAs increases the rate of elimination uniformly, without altering the shape of the concentration-time curve (e.g., by changing the volume of distribution or absorption rate constant, which were not mentioned).\n\nSubstituting the expression for $C_{ss,avg}$ into the equation for $C_{trough}$, we obtain:\n$$C_{trough} = \\phi \\cdot \\left(\\frac{F \\cdot D}{CL \\cdot \\tau}\\right)$$\n\nThis equation describes the relationship between the parameters at steady state. We can apply this equation to both the initial state (State 1, pre-ADA) and the final state (State 2, post-ADA).\n\nFor State 1:\n$$C_{trough,1} = \\phi \\cdot \\frac{F \\cdot D}{CL_1 \\cdot \\tau}$$\n\nFor State 2:\n$$C_{trough,2} = \\phi \\cdot \\frac{F \\cdot D}{CL_2 \\cdot \\tau}$$\n\nTo find the new trough concentration, $C_{trough,2}$, we can take the ratio of the two equations. The terms $F$, $D$, $\\tau$, and $\\phi$ are stated to be constant and will cancel.\n$$\\frac{C_{trough,2}}{C_{trough,1}} = \\frac{\\phi \\cdot \\frac{F \\cdot D}{CL_2 \\cdot \\tau}}{\\phi \\cdot \\frac{F \\cdot D}{CL_1 \\cdot \\tau}} = \\frac{CL_1}{CL_2}$$\n\nThis shows that the steady-state trough concentration is inversely proportional to the systemic clearance, a core principle of linear pharmacokinetics when dosing is held constant.\n\nThe problem states that the systemic clearance in State 2 ($CL_2$) is increased by $25\\%$ relative to the baseline clearance in State 1 ($CL_1$). This can be written as:\n$$CL_2 = CL_1 + (0.25 \\cdot CL_1) = (1 + 0.25) \\cdot CL_1 = 1.25 \\cdot CL_1$$\n\nNow, we substitute this relationship into our ratio equation:\n$$\\frac{C_{trough,2}}{C_{trough,1}} = \\frac{CL_1}{1.25 \\cdot CL_1} = \\frac{1}{1.25}$$\n\nWe can now solve for $C_{trough,2}$:\n$$C_{trough,2} = C_{trough,1} \\cdot \\frac{1}{1.25}$$\n\nThe initial trough concentration is given as $C_{trough,1} = 7.20$ mg/L. Substituting this value:\n$$C_{trough,2} = (7.20 \\text{ mg/L}) \\cdot \\frac{1}{1.25}$$\n$$C_{trough,2} = (7.20 \\text{ mg/L}) \\cdot 0.8$$\n$$C_{trough,2} = 5.760 \\text{ mg/L}$$\n\nThe problem requires the final answer to be rounded to three significant figures, consistent with the precision of the input value $7.20$ mg/L. The calculated value is $5.760$. Rounding to three significant figures gives $5.76$.",
            "answer": "$$\\boxed{5.76}$$"
        },
        {
            "introduction": "The significant inter-individual variability in the pharmacokinetics of biologic DMARDs presents a major challenge to standardized dosing. Model-informed precision dosing (MIPD) offers a powerful solution by using therapeutic drug monitoring (TDM) data to personalize treatment. This advanced, hands-on coding practice guides you through building a Bayesian adaptive dosing framework, where population-level pharmacokinetic 'priors' are updated with patient-specific trough concentrations to generate an individualized 'posterior' estimate of their parameters, which is then used to recommend an optimized dose for infliximab .",
            "id": "4531767",
            "problem": "You are tasked with constructing a Bayesian adaptive dosing framework for the monoclonal antibody infliximab, a Disease-Modifying Antirheumatic Drug (DMARD), to optimize dosing based on observed trough concentrations and prior pharmacokinetic parameters. Work within a one-compartment intravenous bolus repeated-dosing model with first-order elimination, assuming steady state at the time of trough measurement. Your program must calculate the recommended next maintenance dose that targets the midpoint of a specified trough concentration range.\n\nUse the following scientifically grounded bases and definitions:\n- One-compartment pharmacokinetic model with first-order elimination: if clearance is $CL$ (in $\\mathrm{L/day}$) and volume of distribution is $V$ (in $\\mathrm{L}$), then the elimination rate constant is $k = CL/V$ (in $\\mathrm{day}^{-1}$).\n- For repeated dosing at fixed interval $\\tau$ (in $\\mathrm{days}$) and dose $D$ (in $\\mathrm{mg}$) administered as an intravenous bolus, the steady-state trough concentration immediately before the next dose is\n$$\nC_{\\text{trough}}(CL,V; D,\\tau) = \\frac{D}{V} \\cdot \\frac{e^{-k \\tau}}{1 - e^{-k \\tau}} \\quad \\text{with} \\quad k = \\frac{CL}{V}.\n$$\n- Observational model: trough concentrations are measured with log-normal error. For the $i$-th observation, model\n$$\n\\log C_{\\text{obs},i} = \\log C_{\\text{trough}}(CL,V; D_i,\\tau) + \\epsilon_i, \\quad \\epsilon_i \\sim \\mathcal{N}(0,\\sigma^2),\n$$\nwhere $C_{\\text{obs},i}$ is in $\\mathrm{mg/L}$ and $\\sigma$ is a known standard deviation on the log scale.\n- Prior distribution on pharmacokinetic parameters: let $\\theta = (\\log CL, \\log V)^\\top$. Assume a Gaussian prior\n$$\n\\theta \\sim \\mathcal{N}(\\mu, \\Sigma),\n$$\nwith known mean vector $\\mu$ and covariance matrix $\\Sigma$.\n\nFormulate the posterior as a function of $\\theta$ given observed troughs $\\{C_{\\text{obs},i}\\}$ and corresponding doses $\\{D_i\\}$, all at the same dosing interval $\\tau$, and compute the maximum a posteriori estimate $\\hat{\\theta}$ by minimizing the negative log-posterior. Then, given a target trough concentration range $[C_{\\min}, C_{\\max}]$, define the midpoint $C^*_{\\text{mid}} = (C_{\\min} + C_{\\max})/2$, and compute the recommended next dose\n$$\nD^* = \\frac{C^*_{\\text{mid}}}{g(\\hat{\\theta}; \\tau)}, \\quad \\text{where} \\quad g(\\theta; \\tau) = \\frac{1}{V} \\cdot \\frac{e^{-k \\tau}}{1 - e^{-k \\tau}}, \\quad k = \\frac{CL}{V}.\n$$\nRound $D^*$ to the nearest $100$ $\\mathrm{mg}$ to reflect vial sizing constraints.\n\nImplement this framework as a complete, runnable program. No user input is required.\n\nUse the following constants and prior information for all test cases:\n- Dosing interval $\\tau = 56$ $\\mathrm{days}$.\n- Target trough range $[C_{\\min}, C_{\\max}] = [3, 7]$ $\\mathrm{mg/L}$, so $C^*_{\\text{mid}} = 5$ $\\mathrm{mg/L}$.\n- Prior mean $\\mu = (\\log(0.2), \\log(3.0))^\\top$ with $CL$ in $\\mathrm{L/day}$ and $V$ in $\\mathrm{L}$.\n- Prior covariance $\\Sigma = \\mathrm{diag}(0.04, 0.04)$, so the prior standard deviations for $\\log CL$ and $\\log V$ are each $0.2$.\n- Observation log-error standard deviation $\\sigma = 0.2$.\n\nTest Suite:\nEach test case consists of the maintenance doses used to generate the trough observations (in $\\mathrm{mg}$) and the corresponding observed trough concentration(s) (in $\\mathrm{mg/L}$). All observations are assumed to be at steady state with the interval $\\tau$ given above.\n\n- Test Case $1$: doses $[300]$ $\\mathrm{mg}$, troughs $[2.0]$ $\\mathrm{mg/L}$.\n- Test Case $2$: doses $[400]$ $\\mathrm{mg}$, troughs $[9.0]$ $\\mathrm{mg/L}$.\n- Test Case $3$: doses $[300, 300]$ $\\mathrm{mg}$, troughs $[1.0, 1.4]$ $\\mathrm{mg/L}$.\n- Test Case $4$: doses $[100]$ $\\mathrm{mg}$, troughs $[0.5]$ $\\mathrm{mg/L}$.\n\nRequired output:\nYour program should produce a single line of output containing the recommended next doses for the four test cases as a comma-separated list enclosed in square brackets and rounded to the nearest $100$ $\\mathrm{mg}$ (e.g., $[500,600,700,800]$). The output must be a list of integers in $\\mathrm{mg}$.",
            "solution": "The problem requires the construction of a Bayesian adaptive dosing algorithm for infliximab. The solution is predicated on a standard one-compartment pharmacokinetic model, updated with individual patient data to yield a personalized dose recommendation. The process involves Maximum A Posteriori (MAP) estimation of the patient's pharmacokinetic parameters followed by a calculation of the dose required to achieve a target trough concentration.\n\nThe core of the methodology is Bayesian inference, where prior knowledge about the pharmacokinetic parameters is updated using observed data to obtain a posterior distribution. The posterior probability of the parameters $\\theta$ given the data $\\mathcal{D}$ is given by Bayes' theorem: $p(\\theta | \\mathcal{D}) \\propto p(\\mathcal{D} | \\theta) p(\\theta)$, where $p(\\mathcal{D} | \\theta)$ is the likelihood of the data given the parameters, and $p(\\theta)$ is the prior distribution of the parameters. MAP estimation seeks the parameter values $\\hat{\\theta}$ that maximize this posterior probability, which is equivalent to minimizing the negative of the log-posterior.\n\nLet the pharmacokinetic parameters be represented by the vector $\\theta = (\\log CL, \\log V)^\\top$, where $CL$ is the clearance in $\\mathrm{L/day}$ and $V$ is the volume of distribution in $\\mathrm{L}$. The use of log-transformed parameters ensures their physical positivity.\n\nThe pharmacokinetic model is a one-compartment model with first-order elimination following repeated intravenous bolus administrations. The steady-state trough concentration, $C_{\\text{trough}}$, for a dose $D$ administered at a fixed interval $\\tau$ is given by:\n$$\nC_{\\text{trough}}(\\theta; D, \\tau) = \\frac{D}{V} \\cdot \\frac{e^{-k \\tau}}{1 - e^{-k \\tau}}, \\quad \\text{where} \\quad k = \\frac{CL}{V} = \\frac{e^{\\theta_1}}{e^{\\theta_2}} = e^{\\theta_1 - \\theta_2}\n$$\nThe model prediction can be expressed on the log scale, which is often more stable numerically. Using the identity $\\frac{e^{-x}}{1-e^{-x}} = \\frac{1}{e^x - 1}$, the log of the trough concentration is:\n$$\n\\log C_{\\text{trough}}(\\theta; D, \\tau) = \\log D - \\log V - \\log(e^{k\\tau} - 1) = \\log D - \\theta_2 - \\log(e^{\\tau e^{\\theta_1 - \\theta_2}} - 1)\n$$\nThis is denoted as $f(\\theta; D, \\tau)$.\n\nThe likelihood function is based on the observational model, which assumes that the observed log-trough concentrations, $\\log C_{\\text{obs},i}$, are normally distributed around the log-predicted trough concentrations with a known variance $\\sigma^2$. For a set of $N$ observations $\\mathcal{D} = \\{(D_i, C_{\\text{obs},i})\\}_{i=1}^N$:\n$$\n\\log p(\\mathcal{D} | \\theta) = \\mathcal{L}(\\theta) = \\sum_{i=1}^N \\log \\left( \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(\\log C_{\\text{obs},i} - f(\\theta; D_i, \\tau))^2}{2\\sigma^2}\\right) \\right)\n$$\nIgnoring constants, the negative log-likelihood is proportional to $\\frac{1}{\\sigma^2} \\sum_{i=1}^N (\\log C_{\\text{obs},i} - f(\\theta; D_i, \\tau))^2$.\n\nThe prior distribution for the parameters $\\theta$ is a multivariate normal distribution, $\\theta \\sim \\mathcal{N}(\\mu, \\Sigma)$, where $\\mu$ and $\\Sigma$ are the known prior mean vector and covariance matrix, respectively. The negative log-prior is, up to a constant, proportional to $(\\theta - \\mu)^\\top \\Sigma^{-1} (\\theta - \\mu)$.\n\nThe objective is to find the MAP estimate $\\hat{\\theta}$ by minimizing the negative log-posterior, which is the sum of the negative log-likelihood and the negative log-prior. This defines the objective function $F(\\theta)$:\n$$\nF(\\theta) = \\frac{1}{\\sigma^2} \\sum_{i=1}^N (\\log C_{\\text{obs},i} - f(\\theta; D_i, \\tau))^2 + (\\theta - \\mu)^\\top \\Sigma^{-1} (\\theta - \\mu)\n$$\nGiven the problem states that the observation variance is $\\sigma^2 = 0.2^2 = 0.04$ and the prior covariance is $\\Sigma = \\mathrm{diag}(0.04, 0.04)$, the weighting terms are equal. Thus, minimizing $F(\\theta)$ is equivalent to minimizing the simplified function $J(\\theta)$:\n$$\nJ(\\theta) = \\sum_{i=1}^N (\\log C_{\\text{obs},i} - f(\\theta; D_i, \\tau))^2 + (\\theta - \\mu)^\\top (\\theta - \\mu)\n$$\nThis unconstrained non-linear optimization problem is solved numerically. The Broyden–Fletcher–Goldfarb–Shanno (BFGS) algorithm is a suitable choice, starting with the prior mean $\\mu$ as the initial guess for $\\theta$.\n\nOnce the MAP estimate $\\hat{\\theta} = (\\hat{\\theta}_1, \\hat{\\theta}_2) = (\\log \\hat{CL}, \\log \\hat{V})$ is obtained, the recommended next dose $D^*$ is calculated to target the midpoint of the therapeutic range, $C^*_{\\text{mid}} = (C_{\\min} + C_{\\max})/2 = (3+7)/2 = 5 \\, \\mathrm{mg/L}$. Rearranging the trough concentration formula gives:\n$$\nD^* = C^*_{\\text{mid}} \\cdot \\hat{V} \\cdot (e^{\\hat{k}\\tau} - 1)\n$$\nwhere $\\hat{V} = e^{\\hat{\\theta}_2}$, $\\hat{k} = e^{\\hat{\\theta}_1 - \\hat{\\theta}_2}$, and $\\tau = 56 \\, \\mathrm{days}$. Numerically stable functions, such as `expm1(x)` which computes $e^x-1$, are used in the implementation to maintain precision.\n\nFinally, the calculated dose $D^*$ is rounded to the nearest $100 \\, \\mathrm{mg}$ to align with practical vial sizes. This is achieved by computing $\\text{round}(D^*/100) \\times 100$. A \"round half up\" convention is used for determinism, implemented as $\\lfloor D^*/100 + 0.5 \\rfloor \\times 100$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Constructs and applies a Bayesian adaptive dosing framework for infliximab.\n    \"\"\"\n    # Define constants and prior information based on the problem statement.\n    TAU = 56.0  # Dosing interval in days\n    C_TARGET_MID = 5.0  # Midpoint of the target trough range in mg/L\n    MU_PRIOR = np.array([np.log(0.2), np.log(3.0)])  # Prior mean for [log(CL), log(V)]\n    VAR_OBS_LOG = 0.2**2 # Variance of observation error on log scale\n    VAR_PRIOR_LOG = 0.04  # Prior variance for log(CL) and log(V)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'doses_mg': [300.0], 'troughs_mg_L': [2.0]},\n        {'doses_mg': [400.0], 'troughs_mg_L': [9.0]},\n        {'doses_mg': [300.0, 300.0], 'troughs_mg_L': [1.0, 1.4]},\n        {'doses_mg': [100.0], 'troughs_mg_L': [0.5]}\n    ]\n\n    results = []\n    # Process each test case to calculate the recommended dose.\n    for case in test_cases:\n        doses = np.array(case['doses_mg'])\n        troughs_obs = np.array(case['troughs_mg_L'])\n        log_troughs_obs = np.log(troughs_obs)\n\n        # The term 1/variance acts as a weight in the sum of squares.\n        # Since VAR_OBS_LOG and VAR_PRIOR_LOG are equal (0.04), they can be factored\n        # out of the objective function without changing the location of the minimum.\n        # We minimize a simplified sum of squared errors.\n        def objective_function(theta):\n            \"\"\"\n            Calculates the value of the objective function (proportional to the\n            negative log-posterior) for a given parameter vector theta.\n\n            Args:\n                theta (np.ndarray): A numpy array [log_cl, log_v].\n            \"\"\"\n            log_cl, log_v = theta\n            \n            # Prior component of the objective function (sum of squared z-scores)\n            prior_term = ((log_cl - MU_PRIOR[0])**2 + (log_v - MU_PRIOR[1])**2)\n\n            # Likelihood component\n            # k * tau = (CL/V) * tau = exp(log_cl - log_v) * tau\n            k_tau = TAU * np.exp(log_cl - log_v)\n            \n            # The predicted log trough is:\n            # log(D) - log(V) - log(exp(k*tau) - 1)\n            # np.log(np.expm1(x)) is a numerically stable way to compute log(exp(x)-1).\n            # The optimizer can handle 'inf' values if k_tau gets too large.\n            log_c_pred = np.log(doses) - log_v - np.log(np.expm1(k_tau))\n            \n            likelihood_term = np.sum((log_troughs_obs - log_c_pred)**2)\n            \n            return likelihood_term + prior_term\n\n        # The initial guess for the optimization is the prior mean.\n        initial_guess = MU_PRIOR\n        \n        # Use scipy.optimize.minimize with the BFGS algorithm to find the MAP estimate.\n        opt_result = minimize(objective_function, initial_guess, method='BFGS')\n        \n        # The MAP estimate for theta = [log(CL), log(V)]\n        theta_map = opt_result.x\n        log_cl_map, log_v_map = theta_map\n        \n        # Calculate the recommended dose to achieve the target trough concentration.\n        # Formula: D* = C_target * V * (exp(k*tau) - 1)\n        k_map_tau = TAU * np.exp(log_cl_map - log_v_map)\n        \n        # Use np.expm1 for numerical stability with the final dose calculation.\n        dose_reco = C_TARGET_MID * np.exp(log_v_map) * np.expm1(k_map_tau)\n        \n        # Round the dose to the nearest 100 mg (round half up convention).\n        rounded_dose = int(np.floor(dose_reco / 100.0 + 0.5) * 100)\n        \n        results.append(rounded_dose)\n\n    # Print the final results in the specified format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}