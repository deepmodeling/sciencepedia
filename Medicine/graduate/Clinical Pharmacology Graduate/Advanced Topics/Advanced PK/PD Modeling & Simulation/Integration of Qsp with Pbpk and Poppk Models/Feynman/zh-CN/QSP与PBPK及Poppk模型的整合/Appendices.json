{
    "hands_on_practices": [
        {
            "introduction": "定量系统药理学（QSP）模型通常使用摩尔浓度（如 $\\text{M}$）和秒（$\\text{s}$）作为单位，而生理药代动力学（PBPK）模型则常以质量浓度（如 $\\text{mg/L}$）和小时（$\\text{h}$）为单位。在整合这两种模型时，确保单位的一致性是至关重要的第一步。本练习将引导你通过第一性原理推导必要的单位转换因子，将一个QSP模块中的结合反应动力学参数无缝嵌入到PBPK模型的组织房室中。",
            "id": "4561904",
            "problem": "一个定量系统药理学 (QSP) 模块描述了组织中小分子药物与其受体之间的可逆结合相互作用 $D + R \\rightleftharpoons DR$。该过程由质量作用动力学控制，结合速率常数为 $k_{\\text{on}}$，解离速率常数为 $k_{\\text{off}}$。QSP 参数以摩尔单位指定：$k_{\\text{on}}$ 的单位为 $\\text{M}^{-1}\\text{s}^{-1}$，$k_{\\text{off}}$ 的单位为 $\\text{s}^{-1}$。您的任务是将此结合模块嵌入到一个全身生理药代动力学 (PBPK) 模型的组织房室中，用于群体药代动力学 (PopPK) 分析，其中所有状态变量均以质量浓度 $\\text{mg}/\\text{L}$ 表示，时间单位为 $\\text{h}$。PBPK 模型中的药物浓度、受体浓度和复合物浓度分别表示为 $Y_{D}$、$Y_{R}$ 和 $Y_{DR}$，单位均为 $\\text{mg}/\\text{L}$，其中 $Y_{DR}$ 表示复合物中所含药物的质量浓度。\n\n仅从摩尔浓度、分子量和质量作用动力学的定义出发，推导将 QSP 结合速率项映射到 PBPK 药物质量平衡中的单位一致变换：\n$$\n\\frac{dY_{D}}{dt} = -k_{\\text{on}}^{\\ast}\\,Y_{D}\\,Y_{R} + k_{\\text{off}}^{\\ast}\\,Y_{DR} + \\text{(其他 PBPK 通量)},\n$$\n其中 $k_{\\text{on}}^{\\ast}$ 的单位为 $\\text{L}\\,(\\text{mg}\\cdot\\text{h})^{-1}$，$k_{\\text{off}}^{\\ast}$ 的单位为 $\\text{h}^{-1}$。药物的分子量为 $MW_{D}$，受体的分子量为 $MW_{R}$，两者单位均为 $\\text{g}/\\text{mol}$。\n\n给定以下科学上合理的参数值：\n- $k_{\\text{on}} = 1.5\\times 10^{5}\\ \\text{M}^{-1}\\text{s}^{-1}$,\n- $k_{\\text{off}} = 2.0\\times 10^{-3}\\ \\text{s}^{-1}$,\n- $MW_{D} = 450\\ \\text{g}/\\text{mol}$,\n- $MW_{R} = 150{,}000\\ \\text{g}/\\text{mol}$,\n\n计算与 PBPK 兼容的结合速率系数 $k_{\\text{on}}^{\\ast}$，单位为 $\\text{L}\\,(\\text{mg}\\cdot\\text{h})^{-1}$。将您的答案四舍五入到三位有效数字。按要求以单位 $\\text{L}\\,(\\text{mg}\\cdot\\text{h})^{-1}$ 表示最终结果。最终答案必须是一个实数值。",
            "solution": "我们从反应 $D + R \\rightleftharpoons DR$ 以摩尔单位表示的质量作用动力学开始。以摩尔浓度单位表示，由结合引起的药物浓度 $C_{D}$（单位为 $\\text{mol}/\\text{L}$）的变化率为\n$$\n\\frac{dC_{D}}{dt}\\Big|_{\\text{bind}} = -k_{\\text{on}}\\,C_{D}\\,C_{R} + k_{\\text{off}}\\,C_{DR},\n$$\n其中 $C_{R}$ 是受体的摩尔浓度，$C_{DR}$ 是复合物的摩尔浓度。我们必须用质量浓度 $Y_{D}$、$Y_{R}$ 和 $Y_{DR}$（单位均为 $\\text{mg}/\\text{L}$）以及时间单位 $\\text{h}$ 来表示 PBPK 模型中的药物质量平衡。\n\n根据分子量的定义，摩尔浓度与质量浓度之间的转换关系为\n$$\nC_{D} = \\frac{Y_{D}}{MW_{D}}\\times 10^{-3},\\quad\nC_{R} = \\frac{Y_{R}}{MW_{R}}\\times 10^{-3},\\quad\nC_{DR} = \\frac{Y_{DR}}{MW_{D}}\\times 10^{-3},\n$$\n其中 $MW_{D}$ 和 $MW_{R}$ 的单位是 $\\text{g}/\\text{mol}$，因子 $10^{-3}$ 用于将 $\\text{mg}$ 转换为 $\\text{g}$。\n\n我们需要一个关于 $\\frac{dY_{D}}{dt}$ 的方程，单位为 $\\text{mg}\\,\\text{L}^{-1}\\,\\text{h}^{-1}$。使用链式法则以及关系式 $Y_{D} = C_{D}\\,MW_{D}\\times 10^{3}$（因为 $1\\,\\text{g} = 1000\\,\\text{mg}$），\n$$\n\\frac{dY_{D}}{dt} = \\frac{dC_{D}}{dt}\\times MW_{D}\\times 10^{3}.\n$$\n代入 $\\frac{dC_{D}}{dt}$ 的质量作用表达式，\n$$\n\\frac{dY_{D}}{dt}\\Big|_{\\text{bind}} = \\left(-k_{\\text{on}}\\,C_{D}\\,C_{R} + k_{\\text{off}}\\,C_{DR}\\right)\\,MW_{D}\\times 10^{3}.\n$$\n现在用以 $Y_{D}$、$Y_{R}$ 和 $Y_{DR}$ 表示的 $C_{D}$、$C_{R}$ 和 $C_{DR}$ 的转换式代入：\n$$\n\\frac{dY_{D}}{dt}\\Big|_{\\text{bind}} = -k_{\\text{on}}\\left(\\frac{Y_{D}}{MW_{D}}10^{-3}\\right)\\left(\\frac{Y_{R}}{MW_{R}}10^{-3}\\right)MW_{D}10^{3} + k_{\\text{off}}\\left(\\frac{Y_{DR}}{MW_{D}}10^{-3}\\right)MW_{D}10^{3}.\n$$\n简化每一项。对于结合项，\n$$\n-k_{\\text{on}}\\left(\\frac{Y_{D}}{MW_{D}}10^{-3}\\right)\\left(\\frac{Y_{R}}{MW_{R}}10^{-3}\\right)MW_{D}10^{3}\n= -k_{\\text{on}}\\,Y_{D}\\,Y_{R}\\,\\frac{10^{-3}}{MW_{R}},\n$$\n因为因子 $MW_{D}$ 被消掉了，且 $10^{-3}\\cdot 10^{-3}\\cdot 10^{3} = 10^{-3}$。对于解离项，\n$$\nk_{\\text{off}}\\left(\\frac{Y_{DR}}{MW_{D}}10^{-3}\\right)MW_{D}10^{3} = k_{\\text{off}}\\,Y_{DR}.\n$$\n因此，以 $\\text{mg}\\,\\text{L}^{-1}\\,\\text{s}^{-1}$ 为单位，\n$$\n\\frac{dY_{D}}{dt}\\Big|_{\\text{bind}} = -\\left(k_{\\text{on}}\\frac{10^{-3}}{MW_{R}}\\right)Y_{D}Y_{R} + k_{\\text{off}}\\,Y_{DR}.\n$$\n这确定了以质量单位每秒表示的、与 PBPK 兼容的结合速率系数为\n$$\nk_{\\text{on}}^{\\ast}(\\text{per s}) = k_{\\text{on}}\\frac{10^{-3}}{MW_{R}},\n$$\n单位为 $\\text{L}\\,(\\text{mg}\\cdot\\text{s})^{-1}$。为了将时间单位表示为小时，需乘以从秒到小时的转换因子：\n$$\nk_{\\text{on}}^{\\ast} = \\left(k_{\\text{on}}\\frac{10^{-3}}{MW_{R}}\\right)\\times 3600,\n$$\n现在的单位是 $\\text{L}\\,(\\text{mg}\\cdot\\text{h})^{-1}$。为了完整起见，解离速率转换为\n$$\nk_{\\text{off}}^{\\ast} = k_{\\text{off}}\\times 3600,\n$$\n单位为 $\\text{h}^{-1}$，因为 $Y_{DR}$ 已经是药物的质量浓度。\n\n我们现在使用所提供的参数计算 $k_{\\text{on}}^{\\ast}$ 的数值：\n- $k_{\\text{on}} = 1.5\\times 10^{5}\\ \\text{M}^{-1}\\text{s}^{-1}$,\n- $MW_{R} = 150{,}000\\ \\text{g}/\\text{mol}$。\n\n首先，计算每秒的质量形式：\n$$\nk_{\\text{on}}^{\\ast}(\\text{per s}) = \\left(1.5\\times 10^{5}\\right)\\times \\frac{10^{-3}}{150{,}000}\n= \\left(1.5\\times 10^{5}\\right)\\times \\left(\\frac{1}{150{,}000}\\right)\\times 10^{-3}\n= 10^{-3}.\n$$\n转换为每小时：\n$$\nk_{\\text{on}}^{\\ast} = 10^{-3}\\times 3600 = 3.6.\n$$\n按要求四舍五入到三位有效数字得到 $3.60$，单位为 $\\text{L}\\,(\\text{mg}\\cdot\\text{h})^{-1}$。",
            "answer": "$$\\boxed{3.60}$$"
        },
        {
            "introduction": "“由下至上”（bottom-up）的方法是构建PBPK模型的核心策略之一，它能帮助我们在获得临床数据前预测药物在人体内的药代动力学特征。本练习将具体展示如何将体外测定的酶动力学数据（一个典型的QSP模块）与PBPK框架下的生理学参数（如肝脏重量和血流量）相结合，从而推算出体内的肝清除率。掌握这一过程对于理解药物的机制性清除和进行首次人体剂量预测至关重要。",
            "id": "4561847",
            "problem": "一个定量系统药理学 (QSP) 模块使用米氏动力学来表征一种负责小分子药物主要代谢清除的肝酶，其中包含催化周转数 $k_{\\text{cat}}$ 和米氏常数 $K_m$。在一个基于生理的药代动力学 (PBPK) 肝脏模型中，假设肝脏是一个单一、充分混合的室，药物通过肝动脉和门静脉汇合成有效的肝血流入，总肝血流量为 $Q_h$。为了将 QSP 酶模块整合到这个 PBPK 背景中，并为下游的群体药代动力学 (PopPK) 建模提供一个机制性的肝清除率典型值，请推导体内肝血清除率 $CL_h$ 的表达式，该表达式应使用 $k_{\\text{cat}}$、$K_m$、单个肝细胞的酶量 $E_{\\text{hep}}$（每个肝细胞中具有催化活性的酶的摩尔数）、肝细胞密度 $H_{\\text{hep,g}}$（每克肝脏的肝细胞数）、肝脏质量 $M_{\\text{liver}}$（克）、血液中的未结合分数 $f_{u,b}$（无单位）和肝血流量 $Q_h$ 来表示。假设满足以下科学标准条件：\n- 低浓度限制，即细胞内未结合底物浓度远小于 $K_m$。\n- 血液和肝细胞之间的未结合药物瞬时平衡，因此在肝窦界面处，细胞内未结合浓度等于血液中的未结合浓度。\n- 充分混合的肝脏模型，在稳态下，流入、流出和代谢消耗之间达到质量平衡。\n\n然后，使用推导出的表达式，根据以下参数集计算 $CL_h$ 的数值：\n- $k_{\\text{cat}} = 1.0\\,\\text{s}^{-1}$，\n- $K_m = 1.0 \\times 10^{-5}\\,\\text{mol}\\,\\text{L}^{-1}$，\n- $E_{\\text{hep}} = 1.4 \\times 10^{-17}\\,\\text{mol}\\,\\text{hepatocyte}^{-1}$，\n- $H_{\\text{hep,g}} = 1.20 \\times 10^{8}\\,\\text{hepatocytes}\\,\\text{g}^{-1}$，\n- $M_{\\text{liver}} = 1.50 \\times 10^{3}\\,\\text{g}$，\n- $f_{u,b} = 0.10$，\n- $Q_h = 90\\,\\text{L}\\,\\text{h}^{-1}$。\n\n将最终的肝血清除率以 $\\text{L}\\,\\text{h}^{-1}$ 为单位表示，并将您的数值结果四舍五入到四位有效数字。",
            "solution": "我们从机理药理学和生理学中的标准核心原则开始：\n\n1. 准稳态假设下，单酶途径的米氏动力学。对于细胞内底物浓度 $C_{\\text{cell}}$ 和每个肝细胞中总催化活性酶量 $E_{\\text{hep}}$（以摩尔为单位），单个肝细胞的代谢速率 $v_{\\text{cell}}$ 为\n$$\nv_{\\text{cell}} \\;=\\; \\frac{k_{\\text{cat}}\\,E_{\\text{hep}}\\,C_{\\text{cell}}}{K_m + C_{\\text{cell}}} \\quad \\text{(摩尔/秒)}。\n$$\n\n2. 低浓度限制。在 $C_{\\text{cell}} \\ll K_m$ 的条件下，速率相对于 $C_{\\text{cell}}$ 变为一级反应：\n$$\nv_{\\text{cell}} \\;\\approx\\; \\frac{k_{\\text{cat}}\\,E_{\\text{hep}}}{K_m}\\,C_{\\text{cell}}.\n$$\n\n3. 在肝窦膜处，血液和肝细胞之间的未结合药物达到平衡。如果 $C_b$ 是血液中的总药物浓度，$f_{u,b}$ 是血液中的未结合分数，我们假设细胞内未结合浓度等于血液中的未结合浓度：\n$$\nC_{\\text{cell}}^{u} \\;=\\; C_b^{u} \\;=\\; f_{u,b}\\,C_b.\n$$\n在低浓度限制下，并忽略 $f_{u,b}$所反映的平衡之外的细胞内结合，为了确定相对于未结合浓度的内源性清除率，我们取 $C_{\\text{cell}} \\approx C_{\\text{cell}}^{u} = f_{u,b} C_b$。\n\n4. 通过肝细胞密度进行肝脏放大。肝脏中的肝细胞总数为\n$$\nN_{\\text{hep}} \\;=\\; H_{\\text{hep,g}}\\,M_{\\text{liver}}.\n$$\n因此，总的肝脏代谢速率 $v_{\\text{liver}}$ 为\n$$\nv_{\\text{liver}} \\;\\approx\\; N_{\\text{hep}}\\,v_{\\text{cell}} \\;=\\; \\left(\\frac{k_{\\text{cat}}\\,E_{\\text{hep}}}{K_m}\\right)\\,N_{\\text{hep}}\\,C_{\\text{cell}}.\n$$\n在未结合平衡假设下，\n$$\nv_{\\text{liver}} \\;\\approx\\; \\left(\\frac{k_{\\text{cat}}\\,E_{\\text{hep}}}{K_m}\\right)\\,N_{\\text{hep}}\\,f_{u,b}\\,C_b.\n$$\n\n5. 定义相对于未结合浓度的内源性清除率。参照未结合浓度的内源性（能力限制性）清除率 $CL_{\\text{int,u}}$ 满足\n$$\nv_{\\text{liver}} \\;=\\; CL_{\\text{int,u}}\\,C_b^{u} \\;=\\; CL_{\\text{int,u}}\\,f_{u,b}\\,C_b.\n$$\n与上述表达式比较可得\n$$\nCL_{\\text{int,u}} \\;=\\; \\left(\\frac{k_{\\text{cat}}\\,E_{\\text{hep}}}{K_m}\\right)\\,N_{\\text{hep}} \\;=\\; \\left(\\frac{k_{\\text{cat}}\\,E_{\\text{hep}}}{K_m}\\right)\\,H_{\\text{hep,g}}\\,M_{\\text{liver}}.\n$$\n\n6. 充分混合肝脏模型和血流限制。在一个充分混合的器官中，当流入流出平衡且代谢相对于未结合浓度为一级反应时，处于稳态下的相对于总血液浓度的肝血清除率 $CL_h$ 与肝血流量 $Q_h$、未结合分数 $f_{u,b}$ 和内源性清除率 $CL_{\\text{int,u}}$ 的关系如下\n$$\nCL_h \\;=\\; \\frac{Q_h\\,f_{u,b}\\,CL_{\\text{int,u}}}{Q_h + f_{u,b}\\,CL_{\\text{int,u}}}.\n$$\n该表达式在能力限制 $(f_{u,b}\\,CL_{\\text{int,u}} \\ll Q_h)$ 和血流限制 $(f_{u,b}\\,CL_{\\text{int,u}} \\gg Q_h)$ 两种情况之间平滑过渡，因此明确地包含了血流限制的影响。\n\n7. 结合这些关系，我们获得了用 QSP 参数和肝脏放大因子表示 $CL_h$ 的所需解析表达式：\n$$\nCL_h \\;=\\; \\frac{Q_h\\,f_{u,b}\\,\\left(\\dfrac{k_{\\text{cat}}\\,E_{\\text{hep}}}{K_m}\\,H_{\\text{hep,g}}\\,M_{\\text{liver}}\\right)}{Q_h + f_{u,b}\\,\\left(\\dfrac{k_{\\text{cat}}\\,E_{\\text{hep}}}{K_m}\\,H_{\\text{hep,g}}\\,M_{\\text{liver}}\\right)}.\n$$\n\n现在我们使用给定的参数集计算数值。首先计算肝细胞总数：\n$$\nN_{\\text{hep}} \\;=\\; H_{\\text{hep,g}}\\,M_{\\text{liver}} \\;=\\; \\left(1.20 \\times 10^{8}\\,\\frac{\\text{hepatocytes}}{\\text{g}}\\right)\\,\\left(1.50 \\times 10^{3}\\,\\text{g}\\right) \\;=\\; 1.80 \\times 10^{11}\\,\\text{hepatocytes}.\n$$\n计算内源性未结合物清除率：\n$$\nCL_{\\text{int,u}} \\;=\\; \\left(\\frac{k_{\\text{cat}}\\,E_{\\text{hep}}}{K_m}\\right)\\,N_{\\text{hep}} \\;=\\; \\left(\\frac{1.0\\,\\text{s}^{-1}\\times 1.4 \\times 10^{-17}\\,\\text{mol}}{1.0 \\times 10^{-5}\\,\\text{mol}\\,\\text{L}^{-1}}\\right)\\,\\left(1.80 \\times 10^{11}\\right).\n$$\n计算括号内的值：\n$$\n\\frac{1.0 \\times 1.4 \\times 10^{-17}}{1.0 \\times 10^{-5}} \\;=\\; 1.4 \\times 10^{-12}\\,\\text{L}\\,\\text{s}^{-1}\\,\\text{每个肝细胞},\n$$\n因此\n$$\nCL_{\\text{int,u}} \\;=\\; \\left(1.4 \\times 10^{-12}\\,\\text{L}\\,\\text{s}^{-1}\\right)\\,\\left(1.80 \\times 10^{11}\\right) \\;=\\; 0.252\\,\\text{L}\\,\\text{s}^{-1}.\n$$\n将肝血流量转换为一致的单位 $\\text{L}\\,\\text{s}^{-1}$：\n$$\nQ_h \\;=\\; 90\\,\\text{L}\\,\\text{h}^{-1} \\;=\\; \\frac{90}{3600}\\,\\text{L}\\,\\text{s}^{-1} \\;=\\; 0.025\\,\\text{L}\\,\\text{s}^{-1}.\n$$\n计算充分混合模型的清除率：\n$$\nCL_h \\;=\\; \\frac{Q_h\\,f_{u,b}\\,CL_{\\text{int,u}}}{Q_h + f_{u,b}\\,CL_{\\text{int,u}}}\n\\;=\\; \\frac{0.025 \\times 0.10 \\times 0.252}{0.025 + 0.10 \\times 0.252}\\,\\text{L}\\,\\text{s}^{-1}.\n$$\n计算分子和分母：\n$$\n\\text{分子} \\;=\\; 0.025 \\times 0.10 \\times 0.252 \\;=\\; 6.30 \\times 10^{-4}\\,\\text{L}^2\\,\\text{s}^{-2}, \\quad\n\\text{分母} \\;=\\; 0.025 + 0.0252 \\;=\\; 0.0502\\,\\text{L}\\,\\text{s}^{-1}.\n$$\n因此\n$$\nCL_h \\;=\\; \\frac{6.30 \\times 10^{-4}}{0.0502}\\,\\text{L}\\,\\text{s}^{-1} \\;\\approx\\; 0.01255\\,\\text{L}\\,\\text{s}^{-1}.\n$$\n转换回 $\\text{L}\\,\\text{h}^{-1}$：\n$$\nCL_h \\;=\\; 0.01255 \\times 3600 \\;\\approx\\; 45.18\\,\\text{L}\\,\\text{h}^{-1}.\n$$\n四舍五入到四位有效数字，肝血清除率为 $45.18\\,\\text{L}\\,\\text{h}^{-1}$。\n\n为完整起见，这个封闭形式的解析表达式适合作为将 QSP 酶模块与 PBPK 肝脏部分联系起来的、具有机理信息的典型参数，插入到群体药代动力学 (PopPK) 模型中，其形式为\n$$\nCL_h \\;=\\; \\frac{Q_h\\,f_{u,b}\\,\\left(\\dfrac{k_{\\text{cat}}\\,E_{\\text{hep}}}{K_m}\\,H_{\\text{hep,g}}\\,M_{\\text{liver}}\\right)}{Q_h + f_{u,b}\\,\\left(\\dfrac{k_{\\text{cat}}\\,E_{\\text{hep}}}{K_m}\\,H_{\\text{hep,g}}\\,M_{\\text{liver}}\\right)}.\n$$\n在血流限制的情况下，此表达式简化为 $CL_h \\to Q_h$；在能力限制的情况下，简化为 $CL_h \\to f_{u,b}\\,CL_{\\text{int,u}}$，从而明确地考虑了肝细胞密度和血流限制。",
            "answer": "$$\\boxed{45.18}$$"
        },
        {
            "introduction": "整合模型的一个强大应用是指导和优化药物研发策略，尤其是在实验设计方面。本项高级练习旨在演示如何利用一个整合了药代动力学（PK）和定量系统药理学（QSP）的复合模型，来设计最优的临床血样采集方案。通过运用群体药代动力学（PopPK）中的费雪信息矩阵（Fisher Information Matrix）等概念，我们可以确定哪些采样时间点能够为模型中的关键QSP参数提供最大的信息量，从而使研究投入的效益最大化。",
            "id": "4561770",
            "problem": "要求您实现一个程序，计算一个最优采样设计，以最大化关于一个机制性敏感性参数的信息。该参数在药代动力学模型中调节时变清除率。背景是定量系统药理学（QSP）、生理药代动力学（PBPK）和群体药代动力学（PopPK）的整合。模型和目标根据第一性原理和经过充分检验的公式定义如下。\n\n在时间 $t=0$ 时，将单次静脉推注剂量 $D$ 给药至分布容积为 $V$ 的单室模型中，用于描述药物浓度 $C(t)$。时变清除率 $CL(t)$ 受 QSP 生物标志物 $B(t)$ 的调节，其质量平衡方程为：\n$$\n\\frac{dC}{dt} \\;=\\; -\\frac{CL(t)}{V}\\,C(t), \\qquad C(0^+) \\;=\\; \\frac{D}{V}.\n$$\n基线清除率 $CL_0$ 存在个体间变异，建模为对数正态分布，$CL_0 = CL_{\\text{typ}}\\,e^{\\eta}$，其中 $\\eta \\sim \\mathcal{N}(0,\\omega^2)$，$CL_{\\text{typ}}$ 是典型值，$\\omega^2$ 是个体间变异的方差。QSP 生物标志物 $B(t)$ 遵循带有药物介导抑制的周转模型：\n$$\n\\frac{dB}{dt} \\;=\\; k_{\\text{prod}} - k_{\\text{deg}}\\,B - k_{\\text{inh}}\\,C\\,B, \\qquad B(0) = \\frac{k_{\\text{prod}}}{k_{\\text{deg}}}.\n$$\n根据 PBPK 知识，$CL(t)$ 与生物标志物的关系如下：\n$$\nCL(t) \\;=\\; CL_0 \\left(1 + \\alpha\\,B(t)\\right),\n$$\n其中 $\\alpha$ 是一个无量纲的敏感性参数。我们感兴趣并需要估计的固定效应参数是 $\\psi = \\alpha$。\n\n您将考虑一个群体设计，其中有 $N$ 名相同的受试者，每名受试者都在相同的采样时间点进行测量。测量噪声是加性的且方差齐性的：对于任何采样时间 $t$，观测模型为 $Y(t) = C(t) + \\varepsilon$，其中 $\\varepsilon \\sim \\mathcal{N}(0,\\sigma^2)$。关于 $CL_0$ 的个体间变异由 $\\eta \\sim \\mathcal{N}(0,\\omega^2)$ 表示，并通过一阶（线性化）近似来处理。对于单个时间点 $t$，令 $y_\\psi(t) = \\partial C(t)/\\partial \\psi$ 和 $y_\\eta(t) = \\partial C(t)/\\partial \\eta$ 表示在典型固定效应和 $\\eta=0$ 处评估的敏感性。在一阶群体近似下，时间点 $t$ 的单个观测对 $\\psi$ 的费雪信息（Fisher information）的贡献为：\n$$\n\\mathcal{I}_{\\psi\\psi}(t) \\;=\\; \\frac{\\left(y_\\psi(t)\\right)^2}{\\sigma^2 + \\left(y_\\eta(t)\\right)^2 \\omega^2}.\n$$\n对于在相同时间点测量的 $N$ 名独立受试者，总费雪信息是所有采样时间的 $\\mathcal{I}_{\\psi\\psi}(t)$ 之和的 $N$ 倍。\n\n您的程序必须：\n- 对于每个测试用例，对 $C(t)$ 和 $B(t)$ 的耦合系统进行时间上的正向积分，并通过对从系统雅可比矩阵以及关于 $\\psi$ 和 $\\eta$ 的偏导数导出的相关敏感性常微分方程进行积分，来同步计算正向敏感性 $y_\\psi(t)$ 和 $y_\\eta(t)$。\n- 给定一组候选采样时间，这组时间是根据 PBPK 的时间尺度（分布和消除窗口）确定的。您必须从此候选集中精确选择 $m$ 个不同的时间，以最大化 $\\psi$ 的总费雪信息，其定义如下：\n$$\n\\mathcal{I}_{\\text{tot}} \\;=\\; N \\sum_{t \\in \\mathcal{T}} \\frac{\\left(y_\\psi(t)\\right)^2}{\\sigma^2 + \\left(y_\\eta(t)\\right)^2 \\omega^2},\n$$\n其中 $\\mathcal{T}$ 是选定的包含 $m$ 个采样时间的集合。如果多个设计在数值公差范围内达到相同的最大值，则通过选择字典序最小的时间排序列表来打破平局。\n- 通过对所有 $\\binom{K}{m}$ 种组合进行穷举搜索来计算最优设计，其中 $K$ 是候选时间的数量。所有时间都必须以小时为单位表示。\n\n使用以下适定且科学上合理的测试套件，其中所有未明确列出的常数和初始条件都应严格按照上述说明进行解释。\n\n共有 3 个测试用例。对于每个测试用例，返回最优采样时间，形式为一个包含 $m$ 个浮点数的升序列表（单位为小时）。最终输出必须将所有测试用例的列表聚合为单行字符串形式的列表的列表。您必须：\n- 使用小时作为时间单位，并以小时报告时间。\n- 不要对候选时间进行四舍五入或修改，保留其精确的小数值。\n- 按照下面描述的精确格式提供结果。\n\n测试用例 1（一般情况）：\n- 剂量 $D = 100$ mg，容积 $V = 20$ L，典型清除率 $CL_{\\text{typ}} = 5$ L/h。\n- QSP 参数：$\\alpha = 0.3$（无量纲），$k_{\\text{prod}} = 1$ h$^{-1}$，$k_{\\text{deg}} = 0.5$ h$^{-1}$，$k_{\\text{inh}} = 0.02$ (L/mg)/h。\n- 群体参数：$N = 50$，残差标准差 $\\sigma = 0.05$ mg/L，个体间标准差 $\\omega = 0.3$（作用于 $\\eta$）。\n- 候选时间（小时）：$\\{0.5, 1.0, 2.0, 4.0, 8.0, 12.0\\}$。\n- 要选择的样本数：$m = 3$。\n\n测试用例 2（高残差噪声的边界情况）：\n- 与测试用例 1 相同，除了 $\\sigma = 0.5$ mg/L。\n- 要选择的样本数：$m = 3$。\n\n测试用例 3（个体间变异可忽略的边界情况）：\n- 与测试用例 1 相同，除了 $\\omega = 0.0$ 和 $N = 20$。\n- 要选择的样本数：$m = 4$。\n\n实现要求：\n- 使用一个稳健的常微分方程求解器来积分耦合模型和敏感性方程，选择合适的绝对和相对容差以确保稳定和准确的敏感性计算。\n- 在每个测试用例给定的精确候选时间点上评估敏感性。\n- 根据上述方法，通过最大化群体费雪信息来选择最优的 $m$ 个时间的子集，并遵循指定的平局打破规则。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个列表的列表，以逗号分隔且无空格。每个内部列表是对应测试用例的最优采样时间（单位为小时），按升序排列。例如：\"[[t11,t12,...],[t21,t22,...],[t31,t32,...]]\"，其中每个 $t_{ij}$ 都是一个浮点数。确保打印的字符串中没有任何空格。",
            "solution": "问题的核心是求解一个耦合常微分方程（ODE）组，该方程组描述了药物的药代动力学和相关生物标志物的动态，以及它们对模型参数的敏感性。解决方案主要分为三个阶段：数学模型的推导、优化问题的构建和数值实现。\n\n系统状态由药物浓度 $C(t)$ 和生物标志物水平 $B(t)$ 描述。在 $t=0$ 时，将单次静脉推注剂量 $D$ 给药至分布容积为 $V$ 的单室模型后，其动态由以下公式给出：\n$$\n\\frac{dC}{dt} = -\\frac{CL(t)}{V} C(t), \\quad C(0^+) = \\frac{D}{V}\n$$\n$$\n\\frac{dB}{dt} = k_{\\text{prod}} - k_{\\text{deg}} B(t) - k_{\\text{inh}} C(t) B(t), \\quad B(0) = \\frac{k_{\\text{prod}}}{k_{\\text{deg}}}\n$$\n清除率 $CL(t)$ 是时变的，受生物标志物 $B(t)$ 和基线清除率 $CL_0$ 的调节，关系如下：\n$$\nCL(t) = CL_0 \\left(1 + \\alpha B(t)\\right)\n$$\n基线清除率 $CL_0$ 存在对数正态的个体间变异：$CL_0 = CL_{\\text{typ}} e^{\\eta}$，其中 $\\eta \\sim \\mathcal{N}(0, \\omega^2)$。\n\n我们希望最大化其信息的目标参数是 $\\psi = \\alpha$。为了计算费雪信息，我们需要药物浓度 $C(t)$ 相对于目标参数 $\\psi$ 和随机效应 $\\eta$ 的一阶敏感性。令 $y_\\psi(t) = \\frac{\\partial C(t)}{\\partial \\psi}$ 和 $y_\\eta(t) = \\frac{\\partial C(t)}{\\partial \\eta}$。这些敏感性是通过求解一个增广 ODE 系统来计算的，并在典型参数值（即 $\\eta=0$，这意味着 $CL_0 = CL_{\\text{typ}}$）下进行评估。\n\n对于一个系统 $\\frac{d\\mathbf{x}}{dt} = \\mathbf{f}(\\mathbf{x}, p)$，其关于参数 $p$ 的敏感性方程的一般形式为 $\\frac{d\\mathbf{s}}{dt} = \\mathbf{J}\\mathbf{s} + \\frac{\\partial\\mathbf{f}}{\\partial p}$，其中 $\\mathbf{s} = \\frac{\\partial\\mathbf{x}}{\\partial p}$ 是敏感性向量，$\\mathbf{J}$ 是 $\\mathbf{f}$ 相对于 $\\mathbf{x}$ 的雅可比矩阵。\n\n令增广状态向量为 $\\mathbf{Z} = [C, B, y_{C\\psi}, y_{B\\psi}, y_{C\\eta}, y_{B\\eta}]^T$，其中 $y_{C\\psi} = \\frac{\\partial C}{\\partial \\psi}$，$y_{B\\psi} = \\frac{\\partial B}{\\partial \\psi}$，等等。需要积分的完整的 6 个 ODE 系统如下：\n\n1.  $\\frac{dC}{dt} = -\\frac{CL_{\\text{typ}}(1+\\alpha B)}{V} C$\n2.  $\\frac{dB}{dt} = k_{\\text{prod}} - k_{\\text{deg}}B - k_{\\text{inh}}CB$\n3.  $\\frac{d y_{C\\psi}}{dt} = -\\frac{CL_{\\text{typ}}(1+\\alpha B)}{V} y_{C\\psi} - \\frac{CL_{\\text{typ}}\\alpha C}{V} y_{B\\psi} - \\frac{CL_{\\text{typ}}BC}{V}$\n4.  $\\frac{d y_{B\\psi}}{dt} = -k_{\\text{inh}}B y_{C\\psi} - (k_{\\text{deg}} + k_{\\text{inh}}C) y_{B\\psi}$\n5.  $\\frac{d y_{C\\eta}}{dt} = -\\frac{CL_{\\text{typ}}(1+\\alpha B)}{V} y_{C\\eta} - \\frac{CL_{\\text{typ}}\\alpha C}{V} y_{B\\eta} - \\frac{CL_{\\text{typ}}(1+\\alpha B)C}{V}$\n6.  $\\frac{d y_{B\\eta}}{dt} = -k_{\\text{inh}}B y_{C\\eta} - (k_{\\text{deg}} + k_{\\text{inh}}C) y_{B\\eta}$\n\n状态变量的初始条件是 $C(0^+) = D/V$ 和 $B(0) = k_{\\text{prod}}/k_{\\text{deg}}$。所有敏感性状态的初始条件均为零，因为初始状态值不依赖于 $\\psi$ 或 $\\eta$。因此，$\\mathbf{Z}(0) = [D/V, k_{\\text{prod}}/k_{\\text{deg}}, 0, 0, 0, 0]^T$。\n\n这个增广系统从 $t=0$ 开始进行数值积分，直到最大的候选采样时间。该解提供了在每个候选时间点上 $y_\\psi(t) = y_{C\\psi}(t)$ 和 $y_\\eta(t) = y_{C\\eta}(t)$ 的值。\n\n在计算出敏感性后，时间点 $t$ 的单次测量对 $\\psi$ 的费雪信息的贡献计算如下：\n$$\n\\mathcal{I}_{\\psi\\psi}(t) = \\frac{\\left(y_\\psi(t)\\right)^2}{\\sigma^2 + \\left(y_\\eta(t)\\right)^2 \\omega^2}\n$$\n对于 $N$ 名受试者，一个包含 $m$ 个采样时间集合 $\\mathcal{T}$ 的设计的总费雪信息是：\n$$\n\\mathcal{I}_{\\text{tot}} = N \\sum_{t \\in \\mathcal{T}} \\mathcal{I}_{\\psi\\psi}(t)\n$$\n最后一步是从给定的 $K$ 个候选时间集合中，找到一个大小为 $m$ 的集合 $\\mathcal{T}$，以最大化 $\\mathcal{I}_{\\text{tot}}$。这是通过对所有 $\\binom{K}{m}$ 种可能的组合进行穷举搜索来完成的。每个候选时间的信息贡献是预先计算的。然后，对于每种 $m$ 个时间的组合，将总信息相加。产生最大和的组合被选为最优设计。指定的平局打破规则规定，如果多个组合产生相同的最大信息，则选择对应于字典序最小的时间排序列表的那个。这在算法上是通过按默认的字典序遍历组合来实现的，并且仅当找到一个严格更大的信息值时才更新已找到的最佳设计。\n\n提供的 Python 代码实现了这整个过程。它为 6 维 ODE 系统定义了一个函数，使用 `scipy.integrate.solve_ivp` 和稳健的容差来求解候选时间点上的状态和敏感性，计算每个点的信息贡献，最后使用 `itertools.combinations` 遍历所有组合，以找到并返回每个测试用例的最优设计。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\nfrom itertools import combinations\n\ndef solve():\n    \"\"\"\n    Main function to solve the optimal design problem for all test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Common parameters\n    base_params = {\n        'D': 100.0, 'V': 20.0, 'CL_typ': 5.0, 'alpha': 0.3,\n        'k_prod': 1.0, 'k_deg': 0.5, 'k_inh': 0.02,\n        't_candidates': [0.5, 1.0, 2.0, 4.0, 8.0, 12.0]\n    }\n\n    # Test Case 1\n    params1 = base_params.copy()\n    params1.update({'N': 50, 'sigma': 0.05, 'omega': 0.3, 'm': 3})\n\n    # Test Case 2\n    params2 = base_params.copy()\n    params2.update({'N': 50, 'sigma': 0.5, 'omega': 0.3, 'm': 3})\n\n    # Test Case 3\n    params3 = base_params.copy()\n    params3.update({'N': 20, 'sigma': 0.05, 'omega': 0.0, 'm': 4})\n    \n    test_cases = [params1, params2, params3]\n\n    results = []\n    for params in test_cases:\n        optimal_times = find_optimal_design(params)\n        results.append(optimal_times)\n\n    # Final print statement in the exact required format.\n    inner_strings = [f\"[{','.join(map(str, lst))}]\" for lst in results]\n    final_output = f\"[{','.join(inner_strings)}]\"\n    print(final_output)\n\ndef ode_system(t, z, CL_typ, V, alpha, k_prod, k_deg, k_inh):\n    \"\"\"\n    Defines the augmented system of 6 ODEs for state and sensitivity variables.\n    z = [C, B, y_C_alpha, y_B_alpha, y_C_eta, y_B_eta]\n    \"\"\"\n    C, B, y_Ca, y_Ba, y_Cn, y_Bn = z\n\n    # Time-varying clearance (at typical value eta=0)\n    CL_of_t = CL_typ * (1.0 + alpha * B)\n\n    # State equations\n    dCdt = - (CL_of_t / V) * C\n    dBdt = k_prod - k_deg * B - k_inh * C * B\n\n    # Sensitivity equations for psi = alpha\n    dyCadt = - (CL_of_t / V) * y_Ca - (CL_typ * alpha * C / V) * y_Ba - (CL_typ * B * C / V)\n    dyBadt = - (k_inh * B) * y_Ca - (k_deg + k_inh * C) * y_Ba\n\n    # Sensitivity equations for eta\n    # Note: ∂f₁/∂η at η=0 equals f₁ at η=0, which is dCdt.\n    dyCndt = - (CL_of_t / V) * y_Cn - (CL_typ * alpha * C / V) * y_Bn + dCdt \n    dyBndt = - (k_inh * B) * y_Cn - (k_deg + k_inh * C) * y_Bn\n\n    return [dCdt, dBdt, dyCadt, dyBadt, dyCndt, dyBndt]\n\ndef find_optimal_design(params):\n    \"\"\"\n    Computes the optimal sampling design for a single test case.\n    \"\"\"\n    D = params['D']\n    V = params['V']\n    CL_typ = params['CL_typ']\n    alpha = params['alpha']\n    k_prod = params['k_prod']\n    k_deg = params['k_deg']\n    k_inh = params['k_inh']\n    N = params['N']\n    sigma = params['sigma']\n    omega = params['omega']\n    t_candidates = params['t_candidates']\n    m = params['m']\n\n    # 1. Set up and solve the ODE system\n    z0 = [D / V, k_prod / k_deg, 0.0, 0.0, 0.0, 0.0]\n    t_span = [0.0, max(t_candidates)]\n    \n    ode_args = (CL_typ, V, alpha, k_prod, k_deg, k_inh)\n    \n    sol = solve_ivp(\n        fun=ode_system,\n        t_span=t_span,\n        y0=z0,\n        t_eval=t_candidates,\n        method='BDF',  # Robust solver for potentially stiff systems\n        args=ode_args,\n        atol=1e-9, rtol=1e-7 # Tolerances for accurate sensitivity computation\n    )\n\n    # 2. Extract sensitivities from the solution\n    y_psi = sol.y[2, :]  # ∂C/∂α\n    y_eta = sol.y[4, :]  # ∂C/∂η\n\n    # 3. Calculate the Fisher Information contribution for each candidate time\n    denominator = sigma**2 + (y_eta**2) * (omega**2)\n    # The problem setup ensures sigma > 0, so no division by zero.\n    info_per_point = (y_psi**2) / denominator\n\n    # 4. Exhaustive search over combinations to find the optimal design\n    candidate_indices = range(len(t_candidates))\n    max_info = -1.0\n    best_combo_indices = None\n\n    for combo_indices in combinations(candidate_indices, m):\n        current_info = np.sum(info_per_point[list(combo_indices)])\n        \n        # Update best combo only if current info is strictly greater.\n        # This handles the tie-breaking rule because itertools.combinations\n        # yields tuples in lexicographical order.\n        if current_info > max_info:\n            max_info = current_info\n            best_combo_indices = combo_indices\n    \n    if best_combo_indices is None:\n        # This case should not be reached with the given valid problem.\n        raise ValueError(\"Optimal design could not be determined.\")\n        \n    optimal_times = [float(t_candidates[i]) for i in best_combo_indices]\n    \n    return optimal_times\n\nsolve()\n```"
        }
    ]
}