{"hands_on_practices": [{"introduction": "理解刚体姿态（由四元数 $q(t)$ 描述）与其物理角速度 $\\vec{\\omega}$ 之间的关系是学习刚体动力学的第一步。本练习将引导你应用四元数运动学基本方程，从一个给定的、随时间变化的姿态四元数中，反向求解出刚体在自身坐标系下的角速度。这是分析和验证任何预设运动轨迹的核心技能 [@problem_id:2031381]。", "problem": "一颗小型卫星正在执行预设的姿态机动。其相对于固定惯性参考系的空间朝向由一个随时间变化的单位四元数 $q(t) = q_s(t) + q_1(t)\\mathbf{i} + q_2(t)\\mathbf{j} + q_3(t)\\mathbf{k}$ 描述。单位四元数是用于表示旋转的一种数学对象，其中 $q_s$ 是标量部分，$(q_1, q_2, q_3)$ 是矢量部分，且各分量满足条件 $q_s(t)^2 + q_1(t)^2 + q_2(t)^2 + q_3(t)^2 = 1$。\n\n卫星朝向四元数的分量由以下关于时间 $t$ （单位为秒）的函数给出：\n$$q_s(t) = \\cos\\left(\\frac{\\beta t^2}{2}\\right)\\cos\\left(\\frac{\\alpha t}{2}\\right)$$\n$$q_1(t) = \\cos\\left(\\frac{\\beta t^2}{2}\\right)\\sin\\left(\\frac{\\alpha t}{2}\\right)$$\n$$q_2(t) = \\sin\\left(\\frac{\\beta t^2}{2}\\right)\\sin\\left(\\frac{\\alpha t}{2}\\right)$$\n$$q_3(t) = \\sin\\left(\\frac{\\beta t^2}{2}\\right)\\cos\\left(\\frac{\\alpha t}{2}\\right)$$\n该机动由常数 $\\alpha = 0.50 \\text{ rad/s}$ 和 $\\beta = 0.10 \\text{ rad/s}^2$ 定义。\n\n确定在 $t = 2.0$ s 时，卫星在其体固参考系中测得的角速度矢量 $\\vec{\\omega}_B$ 的三个分量 $(\\omega_x, \\omega_y, \\omega_z)$。\n\n以指定顺序 $(\\omega_x, \\omega_y, \\omega_z)$ 的数值形式表示答案。所有分量的单位必须是 rad/s。将最终答案四舍五入到三位有效数字。", "solution": "令 $q(t) = [q_{s}(t), q_{1}(t), q_{2}(t), q_{3}(t)]$ 为一个单位四元数，其标量部分为 $q_{s}$，矢量部分为 $q_{v} = (q_{1}, q_{2}, q_{3})$。根据体角速度的标准四元数运动学，其关系为\n$$\n\\dot{q} = \\frac{1}{2}\\, q \\otimes [0,\\vec{\\omega}_{B}],\n$$\n从而\n$$\n\\vec{\\omega}_{B} = 2\\,\\text{vec}\\!\\left(q^{*} \\otimes \\dot{q}\\right),\n$$\n其中 $q^{*}$ 是 $q$ 的四元数共轭，$\\text{vec}(\\cdot)$ 提取其矢量部分。\n\n引入简写\n$$\nA(t) = \\frac{\\alpha t}{2}, \\quad B(t) = \\frac{\\beta t^{2}}{2}, \\quad A' = \\frac{\\alpha}{2}, \\quad B' = \\beta t,\n$$\n并定义 $cA = \\cos A$、$sA = \\sin A$、$cB = \\cos B$、$sB = \\sin B$。给定的四元数分量为\n$$\nq_{s} = cB\\,cA,\\quad q_{1} = cB\\,sA,\\quad q_{2} = sB\\,sA,\\quad q_{3} = sB\\,cA.\n$$\n该四元数可分解为两个基本旋转的乘积：\n$$\nq(t) = q_{B}(t) \\otimes q_{A}(t), \\quad q_{A} = [\\cos A,\\, \\sin A\\,\\mathbf{i}], \\quad q_{B} = [\\cos B,\\, \\sin B\\,\\mathbf{k}],\n$$\n这可以通过直接的四元数乘法来验证。这里，$q_{A}$ 是绕体坐标系 $x$ 轴旋转角度 $2A = \\alpha t$ 的旋转（右因子），而 $q_{B}$ 是绕惯性坐标系 $z$ 轴旋转角度 $2B = \\beta t^{2}$ 的旋转（左因子）。\n\n对乘积求导：\n$$\n\\dot{q} = \\dot{q}_{B} \\otimes q_{A} + q_{B} \\otimes \\dot{q}_{A}.\n$$\n使用每个因子的运动学关系，\n$$\n\\dot{q}_{A} = \\frac{1}{2}\\,q_{A}\\otimes[0,\\alpha\\,\\mathbf{e}_{x}], \\qquad\n\\dot{q}_{B} = \\frac{1}{2}\\,[0, 2\\beta t\\,\\mathbf{e}_{z}]\\otimes q_{B},\n$$\n我们得到\n$$\n\\dot{q} = \\frac{1}{2}\\,[0, 2\\beta t\\,\\mathbf{e}_{z}]\\otimes q + \\frac{1}{2}\\,q\\otimes[0,\\alpha\\,\\mathbf{e}_{x}].\n$$\n对于任意单位四元数 $q$ 和惯性矢量 $\\mathbf{v}_{I}$，恒等式\n$$\n[0,\\mathbf{v}_{I}] \\otimes q = q \\otimes [0, R(q)^{T}\\mathbf{v}_{I}]\n$$\n成立，其中 $R(q)$ 将体坐标系矢量映射到惯性坐标系矢量。将此应用于第一项，得到\n$$\n\\dot{q} = \\frac{1}{2}\\,q\\otimes\\big[0,\\; \\alpha\\,\\mathbf{e}_{x} + 2\\beta t\\,R(q)^{T}\\mathbf{e}_{z}\\big].\n$$\n与 $\\dot{q} = \\frac{1}{2} q \\otimes [0,\\vec{\\omega}_{B}]$ 比较可得\n$$\n\\vec{\\omega}_{B} = \\alpha\\,\\mathbf{e}_{x} + 2\\beta t\\,R(q)^{T}\\mathbf{e}_{z}.\n$$\n\n从 $q$ 计算 $R(q)^{T}\\mathbf{e}_{z}$。对于一个将体坐标系映射到惯性坐标系的单位四元数 $q = [q_{0},q_{1},q_{2},q_{3}]$，在体坐标系中表示的惯性 $z$ 轴是 $R(q)^{T}$ 的第三列，即：\n$$\nR(q)^{T}\\mathbf{e}_{z} =\n\\begin{pmatrix}\n2(q_{1}q_{3} - q_{0}q_{2}) \\\\\n2(q_{2}q_{3} + q_{0}q_{1}) \\\\\n1 - 2(q_{1}^{2} + q_{2}^{2})\n\\end{pmatrix}.\n$$\n代入 $q_{0}=cB cA$、$q_{1}=cB sA$、$q_{2}=sB sA$、$q_{3}=sB cA$ 可得\n$$\n2(q_{1}q_{3} - q_{0}q_{2}) = 2 cB sB (sA cA - cA sA) = 0,\n$$\n$$\n2(q_{2}q_{3} + q_{0}q_{1}) = 2(sB^{2} sA cA + cB^{2} cA sA) = 2 sA cA = \\sin(2A),\n$$\n$$\n1 - 2(q_{1}^{2} + q_{2}^{2}) = 1 - 2 sA^{2}(cB^{2} + sB^{2}) = 1 - 2 sA^{2} = \\cos(2A).\n$$\n因此\n$$\nR(q)^{T}\\mathbf{e}_{z} =\n\\begin{pmatrix}\n0 \\\\\n\\sin(2A) \\\\\n\\cos(2A)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 \\\\\n\\sin(\\alpha t) \\\\\n\\cos(\\alpha t)\n\\end{pmatrix}.\n$$\n因此，体角速度分量为\n$$\n\\vec{\\omega}_{B}(t) =\n\\begin{pmatrix}\n\\omega_{x} \\\\\n\\omega_{y} \\\\\n\\omega_{z}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\alpha \\\\\n2\\beta t\\,\\sin(\\alpha t) \\\\\n2\\beta t\\,\\cos(\\alpha t)\n\\end{pmatrix}.\n$$\n\n在 $t = 2.0$ s 时，$\\alpha = 0.50$ 且 $\\beta = 0.10$，\n$$\n\\alpha t = 1.0,\\quad 2\\beta t = 0.40,\n$$\n所以\n$$\n\\omega_{x} = 0.50,\\quad \\omega_{y} = 0.40\\,\\sin(1.0) \\approx 0.337,\\quad \\omega_{z} = 0.40\\,\\cos(1.0) \\approx 0.216,\n$$\n所有单位均为 rad/s，四舍五入到三位有效数字。", "answer": "$$\\boxed{\\begin{pmatrix} 0.500 & 0.337 & 0.216 \\end{pmatrix}}$$", "id": "2031381"}, {"introduction": "在理论基础上，我们进一步探索如何在计算机上模拟刚体的运动。本练习揭示了在使用四元数进行数值模拟时一个至关重要的实际问题：四元数模长的“漂移”现象。通过一个未使用归一化步骤的简单积分算法，你将亲手计算出这种数值误差的来源和大小，从而深刻理解在仿真中保持四元数单位范数的重要性 [@problem_id:2031365]。", "problem": "在卫星姿态动力学的仿真中，其姿态由一个单位四元数 $q = q_w + q_x \\mathbf{i} + q_y \\mathbf{j} + q_z \\mathbf{k}$ 表示，该四元数也可以记为向量 $(q_w, q_x, q_y, q_z)$。四元数的演化遵循运动学方程 $\\dot{q} = \\frac{1}{2} q \\otimes \\omega_B$，其中 $\\omega_B$ 是纯四元数 $(0, \\omega_{Bx}, \\omega_{By}, \\omega_{Bz})$，表示卫星在其体坐标系中的角速度。两个四元数 $p=(p_w, \\vec{p})$ 和 $q=(q_w, \\vec{q})$ 的四元数乘积定义为 $p \\otimes q = (p_w q_w - \\vec{p} \\cdot \\vec{q}, p_w \\vec{q} + q_w \\vec{p} + \\vec{p} \\times \\vec{q})$。\n\n考虑一颗初始处于无旋转参考姿态的卫星，其对应的初始四元数为 $q(0) = (1, 0, 0, 0)$。在 $t=0$ 时，卫星受到一个在体坐标系中给出的恒定角速度 $\\vec{\\omega}_B = (0, 0, 0.5)$ rad/s 的作用。\n\n一位工程师使用简单的前向欧拉积分方案 $q_{k+1} = q_k + \\Delta t \\cdot \\dot{q}_k$ 来仿真卫星在总时间 $T = 2.0$ s 内的姿态，时间步长为 $\\Delta t = 0.1$ s。然而，该工程师忽略了在每一步对四元数进行重新归一化，这是朴素实现中一个常见的误差来源。结果，计算出的四元数的范数（理想情况下应为1）将会发生漂移。\n\n设 $q_{final}$ 为从该仿真中在时间 $T$ 得到的非单位范数四元数。计算其范数的数值误差，定义为 $E = \\|q_{final}\\| - 1$。将你的最终答案四舍五入到四位有效数字。", "solution": "四元数运动学由下式给出\n$$\n\\dot{q}=\\frac{1}{2} q \\otimes \\omega_{B},\n$$\n其中 $\\omega_{B}=(0,0,0,\\omega)$ 且 $\\omega=0.5$。写出 $q=(q_{w},q_{x},q_{y},q_{z})$ 并使用四元数乘积\n$$\nq \\otimes \\omega_{B}=\\left(-q_{z}\\omega,\\; q_{y}\\omega,\\; -q_{x}\\omega,\\; q_{w}\\omega\\right),\n$$\n我们得到分量常微分方程\n$$\n\\dot{q}_{w}=-\\frac{\\omega}{2}q_{z},\\quad \\dot{q}_{x}=\\frac{\\omega}{2}q_{y},\\quad \\dot{q}_{y}=-\\frac{\\omega}{2}q_{x},\\quad \\dot{q}_{z}=\\frac{\\omega}{2}q_{w}.\n$$\n在 $q(0)=(1,0,0,0)$ 的条件下，使用时间步长 $\\Delta t$ 的前向欧拉更新 $q_{k+1}=q_{k}+\\Delta t\\,\\dot{q}_{k}$ 可得\n$$\nq_{w,k+1}=q_{w,k}-a\\,q_{z,k},\\quad q_{x,k+1}=q_{x,k}+a\\,q_{y,k},\\quad q_{y,k+1}=q_{y,k}-a\\,q_{x,k},\\quad q_{z,k+1}=q_{z,k}+a\\,q_{w,k},\n$$\n其中 $a=\\frac{\\Delta t\\,\\omega}{2}$。由于 $q_{x,0}=q_{y,0}=0$，递归关系对所有 $k$ 都保持 $q_{x,k}=q_{y,k}=0$，演化简化为\n$$\nq_{w,k+1}=q_{w,k}-a\\,q_{z,k},\\qquad q_{z,k+1}=q_{z,k}+a\\,q_{w,k}.\n$$\n定义 $s_{k}=q_{w,k}^{2}+q_{z,k}^{2}=\\|q_{k}\\|^{2}$。那么\n$$\ns_{k+1}=(q_{w,k}-a q_{z,k})^{2}+(q_{z,k}+a q_{w,k})^{2}=(1+a^{2})(q_{w,k}^{2}+q_{z,k}^{2})=(1+a^{2})s_{k}.\n$$\n在 $s_{0}=1$ 的条件下，经过 $n$ 步后我们有\n$$\ns_{n}=(1+a^{2})^{n}\\quad\\Rightarrow\\quad \\|q_{n}\\|=(1+a^{2})^{\\frac{n}{2}}.\n$$\n在总时间 $T$ 和步长 $\\Delta t$ 的情况下，步数为 $n=\\frac{T}{\\Delta t}$。因此，范数误差为\n$$\nE=\\|q_{n}\\|-1=(1+a^{2})^{\\frac{n}{2}}-1,\\qquad a=\\frac{\\Delta t\\,\\omega}{2},\\quad n=\\frac{T}{\\Delta t}.\n$$\n代入 $\\omega=0.5$，$\\Delta t=0.1$ 和 $T=2.0$ 可得\n$$\na=\\frac{0.1\\times 0.5}{2}=0.025,\\quad n=20,\\quad E=(1+0.025^{2})^{10}-1=(1+0.000625)^{10}-1.\n$$\n使用二项式展开并忽略高阶小项，\n$$\n(1+0.000625)^{10}\\approx 1+10(0.000625)+45(0.000625)^{2}+120(0.000625)^{3}=1.006267607421875,\n$$\n所以\n$$\nE\\approx 0.006267607421875.\n$$\n四舍五入到四位有效数字，得到 $E=0.006268$。", "answer": "$$\\boxed{0.006268}$$", "id": "2031365"}, {"introduction": "现在，我们将运动学与动力学联系起来，解决一个逆动力学问题。本练习要求你计算出驱动一个航天器精确遵循预定轨迹（通过球面线性插值SLERP定义）所需的控制力矩 $\\vec{\\tau}(t)$。这个实践将四元数运动学与欧拉动力学方程相结合，完整地展示了如何设计并控制一个刚体的姿态 [@problem_id:2031398]。", "problem": "一个被建模为刚体的航天器正在由其姿态控制系统进行姿态调整。在其与主轴 $(\\hat{e}_1, \\hat{e}_2, \\hat{e}_3)$ 对齐的体坐标系中，主转动惯量分别为 $I_1 = I_0$，$I_2 = 2I_0$ 和 $I_3 = 3I_0$，其中 $I_0$ 为某个常数。\n\n航天器的姿态由一个单位四元数 $q = w + x\\mathbf{i} + y\\mathbf{j} + z\\mathbf{k}$ 表示。姿态调整机动总共耗时 $T$。在 $t=0$ 时的初始姿态由单位四元数 $q_0 = 1$ 给出。在 $t=T$ 时的目标姿态为 $q_f = \\frac{1}{\\sqrt{2}} + \\frac{1}{2}\\mathbf{i} + \\frac{1}{2}\\mathbf{j}$。\n\n姿态路径 $q(t)$ 被规定遵循一种由以下公式定义的特殊类型的球面线性插值 (SLERP)：\n$$\nq(t) = q_0 \\left(q_0^{-1} q_f\\right)^{t/T}\n$$\n对于 $t \\in [0, T]$。\n\n确定控制系统为实现此运动所必须施加的时变力矩矢量 $\\vec{\\tau}(t) = (\\tau_1, \\tau_2, \\tau_3)$。该力矩应在航天器的体坐标系中表示。您的答案应为一个用常数 $I_0$ 和 $T$ 表示的矢量表达式。", "solution": "我们在体坐标系中使用四元数运动学和刚体动力学。规定的 SLERP 为\n$$\nq(t) = q_{0} \\left(q_{0}^{-1} q_{f}\\right)^{t/T}.\n$$\n当 $q_{0}=1$ 时，这变为\n$$\nq(t) = \\left(q_{f}\\right)^{t/T} = \\exp\\!\\left(\\frac{t}{T}\\,\\ln q_{f}\\right).\n$$\n对于单位四元数，体坐标系中的运动学关系为\n$$\n\\dot{q} = \\frac{1}{2}\\,q \\otimes (0,\\boldsymbol{\\omega}),\n$$\n其中 $\\boldsymbol{\\omega}$ 是在体坐标系中表示的角速度，$(0,\\boldsymbol{\\omega})$ 是相应的纯虚四元数。对 $q(t)$ 求导得到\n$$\n\\dot{q}(t) = \\frac{1}{T}\\,q(t)\\otimes \\ln q_{f}.\n$$\n与运动学方程进行比对，我们得到\n$$\n(0,\\boldsymbol{\\omega}) = \\frac{2}{T}\\,\\ln q_{f},\n$$\n因此 $\\boldsymbol{\\omega}$ 不随时间变化，且等于\n$$\n\\boldsymbol{\\omega} = \\frac{2}{T}\\,\\mathrm{vect}\\!\\left(\\ln q_{f}\\right).\n$$\n\n接下来，计算 $\\ln q_{f}$。将 $q_{f}$ 写为 $q_{f} = w + \\mathbf{v}$，其中 $w=\\frac{1}{\\sqrt{2}}$ 且 $\\mathbf{v}=\\left(\\frac{1}{2},\\frac{1}{2},0\\right)$。对于一个单位四元数，$w=\\cos(\\theta/2)$，$|\\mathbf{v}|=\\sin(\\theta/2)$，旋转轴 $\\hat{\\mathbf{u}}=\\mathbf{v}/|\\mathbf{v}|$，且\n$$\n\\ln q_{f} = \\left(0,\\hat{\\mathbf{u}}\\,\\frac{\\theta}{2}\\right).\n$$\n这里 $|\\mathbf{v}|=\\sqrt{\\frac{1}{2}}=\\frac{1}{\\sqrt{2}}$ 且 $w=\\frac{1}{\\sqrt{2}}$，因此 $\\theta = 2\\,\\operatorname{atan2}\\!\\left(|\\mathbf{v}|,w\\right) = \\frac{\\pi}{2}$ 且\n$$\n\\hat{\\mathbf{u}} = \\frac{\\left(\\frac{1}{2},\\frac{1}{2},0\\right)}{\\frac{1}{\\sqrt{2}}} = \\left(\\frac{1}{\\sqrt{2}},\\frac{1}{\\sqrt{2}},0\\right).\n$$\n因此\n$$\n\\ln q_{f} = \\left(0,\\hat{\\mathbf{u}}\\,\\frac{\\theta}{2}\\right) = \\left(0,\\frac{\\pi}{4}\\left(\\frac{1}{\\sqrt{2}},\\frac{1}{\\sqrt{2}},0\\right)\\right).\n$$\n由此可得，恒定的体角速度为\n$$\n\\boldsymbol{\\omega} = \\frac{2}{T}\\,\\mathrm{vect}\\!\\left(\\ln q_{f}\\right) = \\frac{\\pi}{2T}\\left(\\frac{1}{\\sqrt{2}},\\frac{1}{\\sqrt{2}},0\\right) = \\left(\\frac{\\pi}{2\\sqrt{2}\\,T},\\frac{\\pi}{2\\sqrt{2}\\,T},0\\right).\n$$\n\n在与主轴对齐的体坐标系中，刚体动力学方程为\n$$\n\\boldsymbol{\\tau} = \\mathbf{I}\\,\\dot{\\boldsymbol{\\omega}} + \\boldsymbol{\\omega} \\times (\\mathbf{I}\\,\\boldsymbol{\\omega}),\n$$\n其中 $\\mathbf{I}=\\mathrm{diag}(I_{1},I_{2},I_{3})=\\mathrm{diag}(I_{0},2I_{0},3I_{0})$。由于 $\\boldsymbol{\\omega}$ 是常数，$\\dot{\\boldsymbol{\\omega}}=\\mathbf{0}$，因此\n$$\n\\boldsymbol{\\tau} = \\boldsymbol{\\omega} \\times (\\mathbf{I}\\,\\boldsymbol{\\omega}).\n$$\n令 $a \\equiv \\frac{\\pi}{2\\sqrt{2}\\,T}$。则 $\\boldsymbol{\\omega}=(a,a,0)$ 且\n$$\n\\mathbf{I}\\,\\boldsymbol{\\omega} = (I_{0}a,\\,2I_{0}a,\\,0).\n$$\n因此\n$$\n\\boldsymbol{\\tau} = (a,a,0) \\times (I_{0}a,2I_{0}a,0) = \\left(0,\\,0,\\,a\\cdot 2I_{0}a - a\\cdot I_{0}a\\right) = \\left(0,0,I_{0}a^{2}\\right).\n$$\n将 $a^{2} = \\left(\\frac{\\pi}{2\\sqrt{2}\\,T}\\right)^{2} = \\frac{\\pi^{2}}{8T^{2}}$ 代入，得到体坐标系中的恒定力矩矢量：\n$$\n\\boldsymbol{\\tau}(t) = \\left(0,\\,0,\\,\\frac{I_{0}\\pi^{2}}{8T^{2}}\\right).\n$$\n该力矩不随时间变化，且与 $\\hat{e}_{3}$ 对齐，提供了维持恒定体速率 SLERP 运动所需的陀螺力矩。", "answer": "$$\\boxed{\\begin{pmatrix}0 & 0 & \\frac{I_{0}\\pi^{2}}{8T^{2}}\\end{pmatrix}}$$", "id": "2031398"}]}