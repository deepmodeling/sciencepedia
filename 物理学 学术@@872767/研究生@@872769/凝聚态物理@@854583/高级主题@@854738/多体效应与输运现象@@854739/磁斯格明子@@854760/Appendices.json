{"hands_on_practices": [{"introduction": "斯格明子数 $N_{\\mathrm{sk}}$ 是定义磁斯格明子的一个基本拓扑不变量。这个练习将指导你从第一性原理出发，对一个典型的Néel型斯格明子纹理进行直接计算。通过这个实践，你将加深对拓扑荷数学定义的理解，并明白为何这种结构会产生一个整数值的拓扑荷。", "problem": "考虑一个二维手性铁磁体，其单位磁化场是径向 Néel 结构，在极坐标中参数化为 $\\mathbf{n}(r,\\phi)=\\left(\\sin\\theta(r)\\cos\\phi,\\ \\sin\\theta(r)\\sin\\phi,\\ \\cos\\theta(r)\\right)$，其中 $r \\ge 0$ 是径向坐标，$\\phi \\in [0,2\\pi)$ 是方位角。假设边界条件为 $\\theta(0)=\\pi$ 和 $\\theta(\\infty)=0$，且 $\\theta(r)$ 在 $(0,\\infty)$ 上是光滑且严格单调的。在满足 $\\hat{\\mathbf{x}} \\times \\hat{\\mathbf{y}}=\\hat{\\mathbf{z}}$ 的右手实验室坐标系中进行计算，并取 $\\phi$ 为逆时针增加。\n\n仅使用光滑单位矢量场 $\\mathbf{n}:\\mathbb{R}^{2}\\to S^{2}$ 的标准拓扑荷（斯格明子数）定义，\n$$\nN_{\\mathrm{sk}}=\\frac{1}{4\\pi}\\int_{\\mathbb{R}^{2}} \\mathbf{n}\\cdot\\left(\\partial_{x}\\mathbf{n}\\times\\partial_{y}\\mathbf{n}\\right)\\, d^{2}r,\n$$\n从第一性原理出发，推导上述指定的结构 $\\mathbf{n}(r,\\phi)$ 的 $N_{\\mathrm{sk}}$ 的精确值。将最终答案表示为一个纯数，无需单位，也无需四舍五入。", "solution": "该问题要求计算指定的二维磁化结构 $\\mathbf{n}(r,\\phi)$ 的拓扑荷，即斯格明子数 $N_{\\mathrm{sk}}$。给定的定义是\n$$\nN_{\\mathrm{sk}}=\\frac{1}{4\\pi}\\int_{\\mathbb{R}^{2}} \\mathbf{n}\\cdot\\left(\\partial_{x}\\mathbf{n}\\times\\partial_{y}\\mathbf{n}\\right)\\, d^{2}r\n$$\n磁化场 $\\mathbf{n}$ 在极坐标 $(r, \\phi)$ 中参数化为\n$$\n\\mathbf{n}(r,\\phi)=\\left(\\sin\\theta(r)\\cos\\phi,\\ \\sin\\theta(r)\\sin\\phi,\\ \\cos\\theta(r)\\right)\n$$\n其边界条件为 $\\theta(0)=\\pi$ 和 $\\theta(\\infty)=0$。\n\n该积分在笛卡尔坐标 $(x, y)$ 中定义，而场 $\\mathbf{n}$ 在极坐标 $(r, \\phi)$ 中定义。最直接的方法是将整个积分变换到极坐标系。极坐标中的面积微元是 $d^{2}r = dx\\,dy = r\\,dr\\,d\\phi$。积分区域 $\\mathbb{R}^2$ 对应于 $r \\in [0, \\infty)$ 和 $\\phi \\in [0, 2\\pi)$。\n\n我们必须用极坐标表示被积函数 $\\mathbf{n}\\cdot\\left(\\partial_{x}\\mathbf{n}\\times\\partial_{y}\\mathbf{n}\\right)$。这需要变换偏导数 $\\partial_{x}$ 和 $\\partial_{y}$。使用链式法则和关系式 $x=r\\cos\\phi$, $y=r\\sin\\phi$：\n$$\n\\partial_{x} = \\frac{\\partial r}{\\partial x}\\partial_{r} + \\frac{\\partial\\phi}{\\partial x}\\partial_{\\phi} = \\cos\\phi\\,\\partial_{r} - \\frac{\\sin\\phi}{r}\\partial_{\\phi}\n$$\n$$\n\\partial_{y} = \\frac{\\partial r}{\\partial y}\\partial_{r} + \\frac{\\partial\\phi}{\\partial y}\\partial_{\\phi} = \\sin\\phi\\,\\partial_{r} + \\frac{\\cos\\phi}{r}\\partial_{\\phi}\n$$\n将这些算子应用于矢量场 $\\mathbf{n}$，我们得到 $\\partial_{x}\\mathbf{n}$ 和 $\\partial_{y}\\mathbf{n}$：\n$$\n\\partial_{x}\\mathbf{n} = \\cos\\phi\\,\\partial_{r}\\mathbf{n} - \\frac{\\sin\\phi}{r}\\partial_{\\phi}\\mathbf{n}\n$$\n$$\n\\partial_{y}\\mathbf{n} = \\sin\\phi\\,\\partial_{r}\\mathbf{n} + \\frac{\\cos\\phi}{r}\\partial_{\\phi}\\mathbf{n}\n$$\n接下来，我们计算叉积 $\\partial_{x}\\mathbf{n}\\times\\partial_{y}\\mathbf{n}$：\n$$\n\\partial_{x}\\mathbf{n}\\times\\partial_{y}\\mathbf{n} = \\left(\\cos\\phi\\,\\partial_{r}\\mathbf{n} - \\frac{\\sin\\phi}{r}\\partial_{\\phi}\\mathbf{n}\\right) \\times \\left(\\sin\\phi\\,\\partial_{r}\\mathbf{n} + \\frac{\\cos\\phi}{r}\\partial_{\\phi}\\mathbf{n}\\right)\n$$\n展开叉积并利用 $\\mathbf{a}\\times\\mathbf{a}=0$ 和 $\\mathbf{a}\\times\\mathbf{b}=-\\mathbf{b}\\times\\mathbf{a}$：\n$$\n\\partial_{x}\\mathbf{n}\\times\\partial_{y}\\mathbf{n} = \\cos\\phi\\sin\\phi(\\partial_{r}\\mathbf{n}\\times\\partial_{r}\\mathbf{n}) + \\frac{\\cos^2\\phi}{r}(\\partial_{r}\\mathbf{n}\\times\\partial_{\\phi}\\mathbf{n}) - \\frac{\\sin^2\\phi}{r}(\\partial_{\\phi}\\mathbf{n}\\times\\partial_{r}\\mathbf{n}) - \\frac{\\sin\\phi\\cos\\phi}{r^2}(\\partial_{\\phi}\\mathbf{n}\\times\\partial_{\\phi}\\mathbf{n})\n$$\n$$\n= \\frac{\\cos^2\\phi}{r}(\\partial_{r}\\mathbf{n}\\times\\partial_{\\phi}\\mathbf{n}) + \\frac{\\sin^2\\phi}{r}(\\partial_{r}\\mathbf{n}\\times\\partial_{\\phi}\\mathbf{n}) = \\frac{\\cos^2\\phi+\\sin^2\\phi}{r}(\\partial_{r}\\mathbf{n}\\times\\partial_{\\phi}\\mathbf{n})\n$$\n$$\n\\partial_{x}\\mathbf{n}\\times\\partial_{y}\\mathbf{n} = \\frac{1}{r}(\\partial_{r}\\mathbf{n}\\times\\partial_{\\phi}\\mathbf{n})\n$$\n因此，被积函数为 $\\frac{1}{r}\\mathbf{n}\\cdot(\\partial_{r}\\mathbf{n}\\times\\partial_{\\phi}\\mathbf{n})$。现在我们计算 $\\mathbf{n}$ 关于 $r$ 和 $\\phi$ 的偏导数：\n$$\n\\partial_{r}\\mathbf{n} = \\frac{d\\theta}{dr}\\left(\\cos\\theta(r)\\cos\\phi, \\cos\\theta(r)\\sin\\phi, -\\sin\\theta(r)\\right)\n$$\n$$\n\\partial_{\\phi}\\mathbf{n} = \\left(-\\sin\\theta(r)\\sin\\phi, \\sin\\theta(r)\\cos\\phi, 0\\right)\n$$\n我们现在计算标量三重积 $\\mathbf{n}\\cdot(\\partial_{r}\\mathbf{n}\\times\\partial_{\\phi}\\mathbf{n})$。这等于以这三个矢量的分量为行的矩阵的行列式：\n$$\n\\mathbf{n}\\cdot(\\partial_{r}\\mathbf{n}\\times\\partial_{\\phi}\\mathbf{n}) = \\det \\begin{pmatrix} \\sin\\theta\\cos\\phi  \\sin\\theta\\sin\\phi  \\cos\\theta \\\\ \\frac{d\\theta}{dr}\\cos\\theta\\cos\\phi  \\frac{d\\theta}{dr}\\cos\\theta\\sin\\phi  -\\frac{d\\theta}{dr}\\sin\\theta \\\\ -\\sin\\theta\\sin\\phi  \\sin\\theta\\cos\\phi  0 \\end{pmatrix}\n$$\n沿第三行展开行列式：\n$$\n= (-\\sin\\theta\\sin\\phi) \\det \\begin{pmatrix} \\sin\\theta\\sin\\phi  \\cos\\theta \\\\ \\frac{d\\theta}{dr}\\cos\\theta\\sin\\phi  -\\frac{d\\theta}{dr}\\sin\\theta \\end{pmatrix} - (\\sin\\theta\\cos\\phi) \\det \\begin{pmatrix} \\sin\\theta\\cos\\phi  \\cos\\theta \\\\ \\frac{d\\theta}{dr}\\cos\\theta\\cos\\phi  -\\frac{d\\theta}{dr}\\sin\\theta \\end{pmatrix}\n$$\n$$\n= (-\\sin\\theta\\sin\\phi) \\left[ -\\frac{d\\theta}{dr}\\sin^2\\theta\\sin\\phi - \\frac{d\\theta}{dr}\\cos^2\\theta\\sin\\phi \\right] - (\\sin\\theta\\cos\\phi) \\left[ -\\frac{d\\theta}{dr}\\sin^2\\theta\\cos\\phi - \\frac{d\\theta}{dr}\\cos^2\\theta\\cos\\phi \\right]\n$$\n$$\n= (-\\sin\\theta\\sin\\phi) \\left[ -\\frac{d\\theta}{dr}\\sin\\phi \\right] - (\\sin\\theta\\cos\\phi) \\left[ -\\frac{d\\theta}{dr}\\cos\\phi \\right]\n$$\n$$\n= \\frac{d\\theta}{dr}\\sin\\theta\\sin^2\\phi + \\frac{d\\theta}{dr}\\sin\\theta\\cos^2\\phi = \\sin\\theta(r)\\frac{d\\theta}{dr}\n$$\n现在，我们将其代回到斯格明子数积分的表达式中：\n$$\nN_{\\mathrm{sk}} = \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{0}^{\\infty} \\left( \\frac{1}{r} \\mathbf{n}\\cdot(\\partial_{r}\\mathbf{n}\\times\\partial_{\\phi}\\mathbf{n}) \\right) (r\\,dr\\,d\\phi)\n$$\n$$\nN_{\\mathrm{sk}} = \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{0}^{\\infty} \\left( \\frac{1}{r} \\sin\\theta(r)\\frac{d\\theta}{dr} \\right) (r\\,dr\\,d\\phi)\n$$\n$r$ 因子相互抵消：\n$$\nN_{\\mathrm{sk}} = \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{0}^{\\infty} \\sin\\theta(r)\\frac{d\\theta}{dr} \\,dr\\,d\\phi\n$$\n被积函数与 $\\phi$ 无关，因此对 $\\phi$ 的积分产生一个因子 $2\\pi$：\n$$\nN_{\\mathrm{sk}} = \\frac{2\\pi}{4\\pi}\\int_{0}^{\\infty} \\sin\\theta(r)\\frac{d\\theta}{dr} \\,dr = \\frac{1}{2}\\int_{0}^{\\infty} \\sin\\theta(r) \\frac{d\\theta}{dr} \\,dr\n$$\n为了计算剩余的积分，我们进行变量替换，从 $r$ 换到 $\\theta$。令 $u=\\theta(r)$，则 $du = \\frac{d\\theta}{dr}dr$。我们必须变换积分上下限。\n当 $r=0$ 时，下限为 $\\theta(0)=\\pi$。\n当 $r \\to \\infty$ 时，上限为 $\\theta(\\infty)=0$。\n积分为：\n$$\nN_{\\mathrm{sk}} = \\frac{1}{2}\\int_{\\theta(0)}^{\\theta(\\infty)} \\sin(u) \\,du = \\frac{1}{2}\\int_{\\pi}^{0} \\sin(u) \\,du\n$$\n计算该定积分：\n$$\nN_{\\mathrm{sk}} = \\frac{1}{2} \\left[-\\cos(u)\\right]_{\\pi}^{0} = \\frac{1}{2} \\left( (-\\cos(0)) - (-\\cos(\\pi)) \\right)\n$$\n$$\nN_{\\mathrm{sk}} = \\frac{1}{2} \\left( -1 - (-(-1)) \\right) = \\frac{1}{2}(-1 - 1) = \\frac{1}{2}(-2)\n$$\n$$\nN_{\\mathrm{sk}} = -1\n$$\n给定磁结构的拓扑荷精确地为 $-1$。这个整数值是符合预期的，因为 $N_{\\mathrm{sk}}$ 代表了从紧致化的平面 $\\mathbb{R}^2\\cup\\{\\infty\\} \\cong S^2$ 到磁化矢量目标球面 $S^2$ 的映射度。", "answer": "$$\\boxed{-1}$$", "id": "3003687"}, {"introduction": "在理解了斯格明子的静态拓扑性质之后，我们转向其动力学行为。斯格明子可以被外部力（如自旋流或磁场梯度）驱动，其运动由Thiele方程描述，该方程同时考虑了回旋力和耗散力。这个练习将帮助你应用这个关键的运动方程来预测斯格明子的末速度，这是斯格明子自旋电子学应用中的一个核心参数。", "problem": "二维铁磁薄膜中的磁斯格明子可被视为一种类粒子拓扑客体。在外部驱动力和耗散效应的作用下，其稳态运动由 Thiele 方程描述。斯格明子的速度 $\\vec{v}$ 局限于 $xy$ 平面内。\n\nThiele 方程为：\n$$\n\\vec{G} \\times \\vec{v} + \\eta \\vec{v} = \\vec{F}\n$$\n在此，$\\vec{v}$ 是斯格明子的终端速度。项 $\\vec{G} \\times \\vec{v}$ 代表陀螺力，其中 $\\vec{G} = G_0 \\hat{z}$ 是恒定的陀螺矢量，垂直于运动平面。项 $\\eta \\vec{v}$ 代表耗散阻力，其中 $\\eta$ 是一个正标量阻尼系数。$\\vec{F}$ 是驱动斯格明子的外力。\n\n考虑一个斯格明子受到一个沿 $x$ 轴正方向的恒定均匀力，该力由 $\\vec{F} = F_0 \\hat{x}$ 给出，其中 $F_0$ 是力的大小。\n\n计算斯格明子的终端速率（速度矢量的大小，$v = |\\vec{v}|$），并用 $F_0$、$G_0$ 和 $\\eta$ 表示。", "solution": "Thiele 方程为：\n\n$$\n\\vec{G} \\times \\vec{v} + \\eta \\vec{v} = \\vec{F}\n$$\n\n其中 $\\vec{G} = G_0 \\hat{z}$ 且 $\\vec{F} = F_0 \\hat{x}$。速度 $\\vec{v}$ 在 $xy$ 平面内，因此 $\\vec{v} = (v_x, v_y, 0)$。\n\n叉乘项为：\n\n$$\n\\vec{G} \\times \\vec{v} = \\begin{vmatrix}\n\\hat{x}  \\hat{y}  \\hat{z} \\\\\n0  0  G_0 \\\\\nv_x  v_y  0\n\\end{vmatrix} = (-G_0 v_y) \\hat{x} + (G_0 v_x) \\hat{y}\n$$\n\n耗散项为 $\\eta \\vec{v} = \\eta v_x \\hat{x} + \\eta v_y \\hat{y}$。外力为 $\\vec{F} = F_0 \\hat{x}$。代入 Thiele 方程，得到分量方程：\n\n对于 $x$ 分量：\n\n$$\n-G_0 v_y + \\eta v_x = F_0 \\quad (1)\n$$\n\n\n对于 $y$ 分量：\n\n$$\nG_0 v_x + \\eta v_y = 0 \\quad (2)\n$$\n\n\n由方程 (2) 解出 $v_y$：\n\n$$\n\\eta v_y = -G_0 v_x \\implies v_y = -\\frac{G_0}{\\eta} v_x\n$$\n\n\n代入方程 (1)：\n\n$$\n\\eta v_x - G_0 \\left( -\\frac{G_0}{\\eta} v_x \\right) = F_0\n$$\n\n\n$$\n\\eta v_x + \\frac{G_0^2}{\\eta} v_x = F_0\n$$\n\n两边同乘以 $\\eta$：\n\n$$\n\\eta^2 v_x + G_0^2 v_x = F_0 \\eta\n$$\n\n\n$$\nv_x (\\eta^2 + G_0^2) = F_0 \\eta\n$$\n\n\n$$\nv_x = \\frac{F_0 \\eta}{\\eta^2 + G_0^2}\n$$\n\n\n现在代回求 $v_y$：\n\n$$\nv_y = -\\frac{G_0}{\\eta} \\cdot \\frac{F_0 \\eta}{\\eta^2 + G_0^2} = -\\frac{G_0 F_0}{\\eta^2 + G_0^2}\n$$\n\n\n速度的大小为：\n\n$$\nv = \\sqrt{v_x^2 + v_y^2} = \\sqrt{ \\left( \\frac{F_0 \\eta}{\\eta^2 + G_0^2} \\right)^2 + \\left( -\\frac{G_0 F_0}{\\eta^2 + G_0^2} \\right)^2 }\n$$\n\n\n$$\nv = \\sqrt{ \\frac{F_0^2 \\eta^2}{( \\eta^2 + G_0^2 )^2} + \\frac{G_0^2 F_0^2}{( \\eta^2 + G_0^2 )^2} } = \\sqrt{ \\frac{F_0^2 (\\eta^2 + G_0^2)}{( \\eta^2 + G_0^2 )^2} } = \\sqrt{ \\frac{F_0^2}{\\eta^2 + G_0^2} } = \\frac{F_0}{\\sqrt{\\eta^2 + G_0^2}}\n$$\n\n\n因此，终端速率为 $ \\dfrac{F_0}{\\sqrt{\\eta^2 + G_0^2}} $。", "answer": "$$ \\boxed{\\dfrac{F_0}{\\sqrt{\\eta^2 + G_0^2}}} $$", "id": "151594"}, {"introduction": "本章的最后一个练习旨在连接解析理论与计算实践。虽然斯格明子数的连续积分形式在理论上很优美，但在数值计算中直接应用朴素的有限差分法可能会引入格点导致的误差，从而得到非整数结果。这个高级练习将介绍一种在离散格点上稳健计算 $N_{\\mathrm{sk}}$ 的方法，该方法基于几何直观的球面三角形面积求和，这对于进行微磁模拟的研究者来说是一项至关重要的技能。", "problem": "本任务要求您实现斯格明子数的鲁棒计算，该计算使用三角形上的有向面积来避免晶格诱导的赝象和非整数值。考虑一个具有周期性边界条件的二维方格晶格，该晶格代表一个单位长度的磁化场。磁化场由函数 $\\mathbf{n}(x,y)$ 给出，该函数将平面中的每个点映射到二维球面 $S^2$ 上的一个单位向量。斯格明子数 $N_{\\mathrm{sk}}$ 在连续统中由以下积分定义：\n$$\nN_{\\mathrm{sk}} = \\frac{1}{4\\pi}\\int \\mathbf{n}(x,y) \\cdot \\left(\\partial_x \\mathbf{n}(x,y) \\times \\partial_y \\mathbf{n}(x,y)\\right)\\,\\mathrm{d}x\\,\\mathrm{d}y,\n$$\n其中 $\\mathbf{n}(x,y)$ 对所有 $(x,y)$ 都是单位向量。\n\n在离散网格上，朴素有限差分近似的结果可能会因网格对尖锐纹理的分辨率不足或数值导数是病态的而受到晶格诱导赝象和非整数值的影响。为消除这些赝象，您的程序必须通过对晶格三角剖分中的有向球面面积进行求和来计算 $N_{\\mathrm{sk}}$。具体来说，晶格的每个方形单元必须以逆时针方向被分割成两个有向三角形，并且每个三角形的贡献必须根据其三个顶点处的单位向量计算，其方式应能表示它们在 $S^2$ 上的像所包围的有向球面面积。\n\n计算应通过以下方式确保数值稳定性：\n- 在两个方向上使用周期性边界条件。\n- 将每个晶格点上的 $\\mathbf{n}$ 归一化为单位长度。\n- 在 $S^2$ 上使用一个能处理近似共线自旋并避免模糊支割线的数值鲁棒的有向面积公式。\n\n您的程序必须实现以下测试套件。对于每个测试用例，在周期性网格上构建磁化场，并使用上述有向三角形方法计算 $N_{\\mathrm{sk}}$。所有角度都必须以弧度为单位，所有量均为无量纲，因此不需要物理单位。\n\n按如下方式定义斯格明子纹理。在围绕指定中心的极坐标 $(r,\\theta)$ 中，令\n$$\nf(r) = 2\\arctan\\left(\\exp\\left(\\frac{R - r}{\\lambda}\\right)\\right),\n$$\n并定义一个具有径向面内取向的 Néel 型斯格明子场：\n$$\n\\mathbf{n}(x,y) = \\left(\\sin f(r)\\,\\cos\\theta,\\;\\sin f(r)\\,\\sin\\theta,\\;\\cos f(r)\\right),\n$$\n其中 $r = \\sqrt{(x-x_0)^2+(y-y_0)^2}$ 且 $\\theta = \\operatorname{atan2}(y-y_0,x-x_0)$。这会产生一个在 $r=0$ 处核心磁化指向下方、远离核心处指向上方的场，其平滑轮廓由半径 $R$ 和壁宽 $\\lambda$ 控制。要翻转整体拓扑荷并反转远场取向，您可以使用逐点取反形成的场 $-\\mathbf{n}(x,y)$。\n\n构建以下测试用例：\n\n- 测试用例 1：在周期性网格上的单个平滑 Néel 斯格明子，参数为 $N_x = 128$，$N_y = 128$，两个方向的域长度 $L = 1.0$，中心 $(x_0,y_0) = (0.5,0.5)$，斯格明子半径 $R = 0.2$，壁宽 $\\lambda = 0.03$。使用如上所述的 Néel 纹理。\n\n- 测试用例 2：均匀铁磁态，其中 $\\mathbf{n}(x,y) = (0,0,1)$，网格参数为 $N_x = 64$，$N_y = 64$，域长度 $L = 1.0$。\n\n- 测试用例 3：一个具有相反拓扑荷的斯格明子，用于测试符号的鲁棒性，通过对测试用例 1 的场进行逐点取反来构建（即使用测试用例 1 的 $-\\mathbf{n}(x,y)$），网格参数相同，$N_x = 128$，$N_y = 128$，$L = 1.0$，但中心为 $(x_0,y_0) = (0.35,0.5)$，并保持 $R = 0.2$，$\\lambda = 0.03$。\n\n- 测试用例 4：一个弱无序铁磁体，通过取均匀态 $\\mathbf{n}(x,y) = (0,0,1)$ 并在每个格点上添加小的随机微扰，然后重新归一化到单位长度来获得。使用参数 $N_x = 64$，$N_y = 64$，$L = 1.0$，以及振幅为 $0.05$ 的随机微扰。为保证可复现性，请使用固定的随机种子。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的结果列表，每个条目是对应测试用例计算出的斯格明子数，四舍五入到六位小数。例如，输出格式必须为\n$$\n[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4],\n$$\n其中每个 $\\text{result}_i$ 是一个四舍五入到六位小数的浮点数。不应打印任何其他文本。程序必须是自包含的，且不得要求任何用户输入。", "solution": "斯格明子数 $N_{\\mathrm{sk}}$ 是一个拓扑不变量，它计算了从物理二维空间到由磁化场 $\\mathbf{n}(x,y)$ 构成的单位球面 $S^2$ 的映射度。其连续统定义，\n$$\nN_{\\mathrm{sk}} = \\frac{1}{4\\pi}\\int \\mathbf{n}(x,y)\\cdot\\left(\\partial_x\\mathbf{n}(x,y)\\times\\partial_y\\mathbf{n}(x,y)\\right)\\,\\mathrm{d}x\\,\\mathrm{d}y,\n$$\n源于映射 $\\mathbf{n}: \\mathbb{R}^2 \\to S^2$ 的雅可比行列式在整个平面上的积分。积分内的量是拓扑荷密度 $\\rho(x,y) = \\mathbf{n}\\cdot(\\partial_x\\mathbf{n}\\times\\partial_y\\mathbf{n})/(4\\pi)$，在不经过 $\\mathbf{n}$ 未定义的奇异点的平滑形变下，该密度保持不变。\n\n为了在离散网格上鲁棒地计算 $N_{\\mathrm{sk}}$，我们避免了对导数 $\\partial_x \\mathbf{n}$ 和 $\\partial_y \\mathbf{n}$ 的有限差分近似。取而代之的是，我们通过对物理网格中小三角形的像的有向球面面积进行求和来近似该曲面积分。该方法基于以下观察：对于 $S^2$ 上的三个单位向量 $\\mathbf{s}_1$、$\\mathbf{s}_2$ 和 $\\mathbf{s}_3$，它们定义的球面三角形的有向面积等于这些点由测地线弧连接所包围的立体角 $\\Omega(\\mathbf{s}_1,\\mathbf{s}_2,\\mathbf{s}_3)$。每个三角形对总斯格明子数的贡献为 $\\Omega/(4\\pi)$，对网格的三角剖分中的所有三角形求和即可近似该积分。\n\n有向球面面积 $\\Omega$ 的一个数值鲁棒表达式由以下公式给出：\n$$\n\\Omega(\\mathbf{s}_1,\\mathbf{s}_2,\\mathbf{s}_3) = 2\\,\\arctan2\\!\\left(\\,\\mathbf{s}_1\\cdot(\\mathbf{s}_2\\times\\mathbf{s}_3),\\;1+\\mathbf{s}_1\\cdot\\mathbf{s}_2+\\mathbf{s}_2\\cdot\\mathbf{s}_3+\\mathbf{s}_3\\cdot\\mathbf{s}_1\\,\\right),\n$$\n其中 $\\arctan2(y,x)$ 是双参数反正切函数，返回一个在 $(-\\pi,\\pi]$ 区间内的角度，并能处理正确的角度分支；点和叉分别表示 $\\mathbb{R}^3$ 中的标量积和矢量积。此公式源于球面三角学和 $S^2$ 的球极平面投影；它等效于将顶点处的角度相加再减去 $\\pi$，但在存在近似共线的自旋时更为稳定，因为它不会遭受灾难性抵消的影响。分子 $\\mathbf{s}_1\\cdot(\\mathbf{s}_2\\times\\mathbf{s}_3)$ 是三个向量的有向体积（三重积），而分母 $1+\\mathbf{s}_1\\cdot\\mathbf{s}_2+\\mathbf{s}_2\\cdot\\mathbf{s}_3+\\mathbf{s}_3\\cdot\\mathbf{s}_1$ 确保该公式保持良定义，除非在三角形跨越超过半球的构型下，而这种情况可由 $\\arctan2$ 的分支正确处理。\n\n要在方格晶格上使用此公式，我们按以下步骤操作：\n- 使用周期性边界条件，以便索引可以回绕：在 $x$ 正方向上，格点 $(i,j)$ 的邻居是 $(i+1 \\bmod N_x,j)$；在 $y$ 正方向上，其邻居是 $(i,j+1 \\bmod N_y)$。\n- 将每个基本方形单元以逆时针方向分割成两个三角形。对于一个角点在晶格索引 $(i,j)$、$(i+1,j)$、$(i+1,j+1)$ 和 $(i,j+1)$ 的单元，使用三角形 $T_1 = \\left[(i,j)\\to(i+1,j)\\to(i+1,j+1)\\right]$ 和 $T_2 = \\left[(i,j)\\to(i+1,j+1)\\to(i,j+1)\\right]$，其中箭头指示了定义方向的顶点次序。\n- 对每个三角形，使用其顶点的三个单位磁化向量计算 $\\Omega(\\mathbf{s}_1,\\mathbf{s}_2,\\mathbf{s}_3)$，并对贡献 $N_{\\mathrm{sk}} = \\sum_{\\text{triangles}} \\Omega/(4\\pi)$ 进行求和。\n\n如果磁化场在晶格间距的尺度上平滑变化，则此求和等效于连续统表达式的黎曼和。由于该公式使用 $S^2$ 上的有向面积，它自然会为分辨率良好的斯格明子产生整数值，并强烈抑制在基于导数的离散化方法中可能出现的非整数赝象，尤其是在斯格明子核心仅跨越少数几个晶格点时。\n\n为保证数值稳定性：\n- 在每个晶格点上归一化磁化矢量场：给定任何计算出的向量 $\\mathbf{v}$，用 $\\mathbf{v}/\\|\\mathbf{v}\\|$ 替换它，从而确保在整个网格中 $\\|\\mathbf{n}\\|=1$ 成立。\n- 直接使用基于 $\\arctan2$ 的立体角公式，无需临时的阈值处理；它能正确处理分母很小或为负的情况，并以正确的方向对面积进行求和。\n- 确保整个晶格的三角形取向一致，以避免贡献被错误地抵消。\n\n我们现在详细说明测试场的构建方法。\n\n对于 Néel 型斯格明子纹理，相对于中心 $(x_0,y_0)$ 定义极坐标 $r = \\sqrt{(x-x_0)^2+(y-y_0)^2}$ 和 $\\theta = \\operatorname{atan2}(y-y_0,x-x_0)$。使用轮廓\n$$\nf(r) = 2\\arctan\\left(\\exp\\left(\\frac{R - r}{\\lambda}\\right)\\right).\n$$\n然后定义\n$$\n\\mathbf{n}(x,y) = \\left(\\sin f(r)\\,\\cos\\theta,\\;\\sin f(r)\\,\\sin\\theta,\\;\\cos f(r)\\right),\n$$\n这会得到在 $r=0$ 处 $\\mathbf{n}(0) \\approx (0,0,-1)$ 且当 $r\\to\\infty$ 时 $\\mathbf{n} \\to (0,0,1)$。要获得具有相反拓扑荷和反转远场取向的场，只需逐点使用 $-\\mathbf{n}(x,y)$；该变换会翻转被积函数 $\\mathbf{n}\\cdot(\\partial_x\\mathbf{n}\\times\\partial_y\\mathbf{n})$ 的符号，因为在 $\\mathbf{n} \\mapsto -\\mathbf{n}$ 下每个因子都变号，从而得到 $N_{\\mathrm{sk}}\\mapsto -N_{\\mathrm{sk}}$。\n\n对于均匀铁磁测试，处处使用 $\\mathbf{n}(x,y) = (0,0,1)$。对于弱无序铁磁体，向 $(0,0,1)$ 添加一个分量在 $[-\\epsilon,\\epsilon]$ 内独立分布的小的随机向量 $\\boldsymbol{\\eta}(x,y)$ 并重新归一化，其中 $\\epsilon = 0.05$，并使用固定的随机种子以保证可复现性。\n\n程序的算法步骤：\n1. 构建网格坐标 $x_i = i\\,L/N_x$（$i=0,\\dots,N_x-1$）和 $y_j = j\\,L/N_y$（$j=0,\\dots,N_y-1$）。\n2. 根据所需的测试用例构建磁化场 $\\mathbf{n}_{i,j}$，并将 $\\mathbf{n}_{i,j}$ 归一化为单位长度。\n3. 对每个单元 $(i,j)$，如上所述定义两个逆时针方向的三角形 $T_1$ 和 $T_2$。\n4. 对每个顶点自旋为 $(\\mathbf{s}_1,\\mathbf{s}_2,\\mathbf{s}_3)$ 的三角形，计算\n$$\n\\Omega = 2\\,\\arctan2\\!\\left(\\,\\mathbf{s}_1\\cdot(\\mathbf{s}_2\\times\\mathbf{s}_3),\\;1+\\mathbf{s}_1\\cdot\\mathbf{s}_2+\\mathbf{s}_2\\cdot\\mathbf{s}_3+\\mathbf{s}_3\\cdot\\mathbf{s}_1\\,\\right),\n$$\n并累加 $N_{\\mathrm{sk}} \\leftarrow N_{\\mathrm{sk}} + \\Omega/(4\\pi)$。\n5. 将每个得到的 $N_{\\mathrm{sk}}$ 四舍五入到六位小数，并以指定的单行方括号列表格式打印它们。\n\n此过程源于连续统定义，将斯格明子数解释为磁化场覆盖在 $S^2$ 上的总有向面积，并用 $4\\pi$（单位球面的面积）进行归一化。使用逆时针方向的三角形确保了符号约定的一致性。周期性边界条件保证了三角剖分在拓扑上是闭合的（一个环面），因此对于具有整数拓扑度的纹理，在充分解析的情况下，立体角的总和会得到一个整数。$\\arctan2$ 公式的鲁棒性减轻了数值问题，如由近简并三角形或舍入误差导致的非整数求和，从而实现了指令中避免晶格诱导赝象和非整数值的目标。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solid_angle(s1, s2, s3):\n    \"\"\"\n    Compute the oriented spherical area (solid angle) Omega for the triangle\n    on the unit sphere defined by three unit vectors s1, s2, s3 using the\n    robust atan2-based formula:\n        Omega = 2 * atan2( s1 · (s2 × s3), 1 + s1·s2 + s2·s3 + s3·s1 )\n    \"\"\"\n    num = np.dot(s1, np.cross(s2, s3))\n    den = 1.0 + np.dot(s1, s2) + np.dot(s2, s3) + np.dot(s3, s1)\n    return 2.0 * np.arctan2(num, den)\n\ndef compute_Nsk(spins):\n    \"\"\"\n    Compute N_sk by summing oriented solid angles over a CCW triangular\n    decomposition of the periodic square lattice.\n    spins: array of shape (Nx, Ny, 3), unit vectors at lattice sites.\n    \"\"\"\n    Nx, Ny, _ = spins.shape\n    total_omega = 0.0\n    # Iterate over cells and split each into two CCW triangles\n    for i in range(Nx):\n        ip = (i + 1) % Nx\n        for j in range(Ny):\n            jp = (j + 1) % Ny\n            # Vertices\n            s00 = spins[i, j]\n            s10 = spins[ip, j]\n            s11 = spins[ip, jp]\n            s01 = spins[i, jp]\n            # Triangle 1: (i,j) -> (i+1,j) -> (i+1,j+1)  CCW\n            omega1 = solid_angle(s00, s10, s11)\n            # Triangle 2: (i,j) -> (i+1,j+1) -> (i,j+1)  CCW\n            omega2 = solid_angle(s00, s11, s01)\n            total_omega += (omega1 + omega2)\n    Nsk = total_omega / (4.0 * np.pi)\n    return Nsk\n\ndef normalize_field(spins):\n    \"\"\"\n    Normalize the spin field to unit length at every site.\n    \"\"\"\n    norms = np.linalg.norm(spins, axis=2, keepdims=True)\n    # Avoid division by zero by setting zero norms to 1 (should not occur)\n    norms[norms == 0.0] = 1.0\n    return spins / norms\n\ndef neel_skyrmion_field(Nx, Ny, L, center, R, lam):\n    \"\"\"\n    Construct a Néel-type skyrmion magnetization field on a periodic grid.\n    The in-plane component points radially and the profile is\n        f(r) = 2 * arctan( exp( (R - r)/lam ) )\n    Field:\n        n = ( sin f(r) * cos(theta), sin f(r) * sin(theta), cos f(r) )\n    \"\"\"\n    x0, y0 = center\n    # Grid coordinates\n    xs = (np.arange(Nx) * L) / Nx\n    ys = (np.arange(Ny) * L) / Ny\n    X, Y = np.meshgrid(xs, ys, indexing='ij')\n    dx = X - x0\n    dy = Y - y0\n    # Account for periodic wrap so r is shortest distance on torus\n    # Map dx, dy into [-L/2, L/2)\n    dx = (dx + 0.5 * L) % L - 0.5 * L\n    dy = (dy + 0.5 * L) % L - 0.5 * L\n    r = np.sqrt(dx*dx + dy*dy)\n    theta = np.arctan2(dy, dx)\n    f = 2.0 * np.arctan(np.exp((R - r) / lam))\n    sinf = np.sin(f)\n    cosf = np.cos(f)\n    nx = sinf * np.cos(theta)\n    ny = sinf * np.sin(theta)\n    nz = cosf\n    spins = np.stack([nx, ny, nz], axis=2)\n    return normalize_field(spins)\n\ndef uniform_field(Nx, Ny, direction=(0.0, 0.0, 1.0)):\n    \"\"\"\n    Construct a uniform magnetization field pointing in 'direction'.\n    \"\"\"\n    spins = np.zeros((Nx, Ny, 3), dtype=float)\n    spins[:, :, 0] = direction[0]\n    spins[:, :, 1] = direction[1]\n    spins[:, :, 2] = direction[2]\n    return normalize_field(spins)\n\ndef noisy_uniform_field(Nx, Ny, eps=0.05, seed=12345, direction=(0.0, 0.0, 1.0)):\n    \"\"\"\n    Construct a weakly disordered ferromagnet by adding small random noise\n    to a uniform direction and renormalizing.\n    \"\"\"\n    rng = np.random.default_rng(seed)\n    noise = rng.uniform(low=-eps, high=eps, size=(Nx, Ny, 3))\n    base = np.zeros((Nx, Ny, 3), dtype=float)\n    base[:, :, 0] = direction[0]\n    base[:, :, 1] = direction[1]\n    base[:, :, 2] = direction[2]\n    spins = base + noise\n    return normalize_field(spins)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1: Single Néel skyrmion, periodic grid\n        (\"skyrmion\", {\"Nx\": 128, \"Ny\": 128, \"L\": 1.0, \"center\": (0.5, 0.5), \"R\": 0.2, \"lam\": 0.03, \"invert\": False}),\n        # Test case 2: Uniform ferromagnet up\n        (\"uniform\", {\"Nx\": 64, \"Ny\": 64, \"L\": 1.0, \"direction\": (0.0, 0.0, 1.0)}),\n        # Test case 3: Skyrmion with opposite topological charge (field negated),\n        (\"skyrmion\", {\"Nx\": 128, \"Ny\": 128, \"L\": 1.0, \"center\": (0.35, 0.5), \"R\": 0.2, \"lam\": 0.03, \"invert\": True}),\n        # Test case 4: Weakly disordered ferromagnet\n        (\"noisy_uniform\", {\"Nx\": 64, \"Ny\": 64, \"L\": 1.0, \"eps\": 0.05, \"seed\": 2023, \"direction\": (0.0, 0.0, 1.0)}),\n    ]\n\n    results = []\n    for kind, params in test_cases:\n        if kind == \"skyrmion\":\n            Nx = params[\"Nx\"]; Ny = params[\"Ny\"]; L = params[\"L\"]\n            center = params[\"center\"]; R = params[\"R\"]; lam = params[\"lam\"]\n            invert = params[\"invert\"]\n            spins = neel_skyrmion_field(Nx, Ny, L, center, R, lam)\n            if invert:\n                spins = -spins\n            Nsk = compute_Nsk(spins)\n            results.append(round(float(Nsk), 6))\n        elif kind == \"uniform\":\n            Nx = params[\"Nx\"]; Ny = params[\"Ny\"]\n            direction = params.get(\"direction\", (0.0, 0.0, 1.0))\n            spins = uniform_field(Nx, Ny, direction=direction)\n            Nsk = compute_Nsk(spins)\n            results.append(round(float(Nsk), 6))\n        elif kind == \"noisy_uniform\":\n            Nx = params[\"Nx\"]; Ny = params[\"Ny\"]\n            eps = params[\"eps\"]; seed = params[\"seed\"]\n            direction = params.get(\"direction\", (0.0, 0.0, 1.0))\n            spins = noisy_uniform_field(Nx, Ny, eps=eps, seed=seed, direction=direction)\n            Nsk = compute_Nsk(spins)\n            results.append(round(float(Nsk), 6))\n        else:\n            results.append(float('nan'))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(lambda x: ('{:.6f}'.format(x) if isinstance(x, float) else str(x)), results))}]\")\n\nsolve()\n```", "id": "3003666"}]}