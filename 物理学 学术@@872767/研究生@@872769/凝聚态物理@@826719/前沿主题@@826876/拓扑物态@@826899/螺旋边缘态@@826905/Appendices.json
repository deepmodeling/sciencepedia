{"hands_on_practices": [{"introduction": "我们实践的第一步是直接推导螺旋边缘态的基本性质。我们将考虑拓扑绝缘体与普通绝缘体（或真空）之间的单个边界，这是存在边缘态的最简单情景。通过求解一个简化的Bernevig-Hughes-Zhang (BHZ)模型，我们可以找到被束缚在该界面上的电子态的波函数和能量色散关系 [@problem_id:440442]。这个练习将揭示螺旋边缘态最核心的两个特征：它们在空间上局域于边界，并具有线性的“狄拉克式”能量色散，这决定了它们独特的输运性质。", "problem": "Bernevig-Hughes-Zhang (BHZ) 模型是理解二维拓扑绝缘体的基石。在 $\\Gamma$ 点（$\\mathbf{k} \\approx 0$）附近的连续极限下，其有效哈密顿量可以写成一个 $4 \\times 4$ 的矩阵。为简单起见，我们在一个哈密顿量是块对角形式的基中进行计算，$H(\\mathbf{k}) = \\text{diag}(h(\\mathbf{k}), h^*(-\\mathbf{k}))$，分别描述自旋向上和自旋向下的电子。\n\n自旋向上的块 $h(\\mathbf{k})$ 由下式给出：\n$$\nh(\\mathbf{k}) = (M - B|\\mathbf{k}|^2)\\sigma_z + A(k_x\\sigma_x - k_y\\sigma_y)\n$$\n其中 $\\mathbf{k}=(k_x, k_y)$ 是二维波矢量，$\\sigma_{x,y,z}$ 是泡利矩阵，$A, B, M$ 是实数值的模型参数。\n\n通过在质量参数 $M$ 中构建一个畴壁，可以创建一个承载受保护边缘态的拓扑界面。考虑一个沿 $x$ 轴延伸的界面，其质量参数沿 $y$ 轴变化，由 $M(y) = M_0 \\text{sgn}(y)$ 给出，其中 $M_0 > 0$。假设模型参数 $B>0$，则当 $y0$ 时，$M0$，系统处于拓扑非平庸相（$M/B  0$）；当 $y>0$ 时，$M>0$，系统处于拓扑平庸相（$M/B > 0$）。这个界面支持两个反向传播的螺旋边缘态，其波函数局域在 $y=0$ 处，并且在小的 $k_x$ 值下具有线性色散关系。\n\n对于本问题，你可以通过设置 $B=0$ 来忽略哈密顿量中的二次项。系统由有效哈密顿量 $h(k_x, k_y \\to -i\\partial_y)$ 控制。\n\n假设 $A > 0$，计算右行边缘态在 $k_x=0$ 处的群速度 $v_g = dE(k_x)/dk_x$。用模型参数表示你的答案。", "solution": "1.  根据问题描述，哈密顿量中的自旋向上块为 $h(\\mathbf{k}) = A(k_x\\sigma_x - k_y\\sigma_y) + (M - B|\\mathbf{k}|^2)\\sigma_z$。我们设置 $B=0$ 并将 $k_y$ 替换为算符 $-i\\partial_y$，得到沿 $y$ 方向的有效哈密顿量：\n    $$h(k_x, -i\\partial_y) = A(k_x\\sigma_x - (-i\\partial_y)\\sigma_y) + M(y)\\sigma_z = A k_x \\sigma_x + iA\\partial_y\\sigma_y + M(y)\\sigma_z$$\n\n2.  为了寻找束缚在 $y=0$ 处的边缘态，我们首先求解 $k_x=0$ 时的零能本征态。方程为：\n    $$(iA\\partial_y\\sigma_y + M(y)\\sigma_z)\\psi_0(y) = 0$$\n    我们寻找一个形式为 $\\psi_0(y) = \\phi(y)\\chi$ 的解，其中 $\\chi$ 是一个常数旋量。代入后得到：\n    $$iA\\phi'(y)\\sigma_y\\chi + M_0\\text{sgn}(y)\\phi(y)\\sigma_z\\chi = 0$$\n    将方程左乘 $\\sigma_z$，并利用泡利矩阵关系 $\\sigma_z\\sigma_y = -i\\sigma_x$，我们得到：\n    $$iA\\phi'(y)(-i\\sigma_x)\\chi + M_0\\text{sgn}(y)\\phi(y)\\chi = 0 \\implies A\\phi'(y)\\sigma_x\\chi + M_0\\text{sgn}(y)\\phi(y)\\chi = 0$$\n\n3.  这个方程要求 $\\chi$ 是 $\\sigma_x$ 的本征态，即 $\\sigma_x\\chi = \\lambda\\chi$，其中 $\\lambda = \\pm 1$。代入后，关于空间部分 $\\phi(y)$ 的微分方程为：\n    $$A\\lambda\\phi'(y) = -M_0\\text{sgn}(y)\\phi(y) \\implies \\frac{\\phi'(y)}{\\phi(y)} = -\\frac{M_0}{A\\lambda}\\text{sgn}(y)$$\n    该方程的解为 $\\phi(y) \\propto \\exp\\left(-\\frac{M_0}{A\\lambda}|y|\\right)$。为了使波函数在 $y \\to \\pm\\infty$ 时可归一化，指数必须为负。由于 $A>0, M_0>0$，这要求 $\\lambda > 0$，即 $\\lambda=+1$。因此，零能边缘态的旋量部分是 $\\sigma_x$ 的本征值为 $+1$ 的本征态。\n\n4.  现在，我们将 $k_x$ 项 $H' = A k_x \\sigma_x$ 作为微扰。根据一阶微扰理论，边缘态的能量色散为：\n    $$E(k_x) = \\langle\\psi_0| H' |\\psi_0\\rangle = \\langle\\psi_0| A k_x \\sigma_x |\\psi_0\\rangle = A k_x \\langle\\chi|\\sigma_x|\\chi\\rangle$$\n    由于 $\\chi$ 是 $\\sigma_x$ 的本征值为 $+1$ 的本征态，我们得到 $E(k_x) = A k_x$。这是一个右行模式。\n\n5.  右行边缘态的群速度定义为 $v_g = \\frac{dE(k_x)}{dk_x}$。在 $k_x=0$ 附近，我们得到：\n    $$v_g = \\frac{d}{dk_x}(A k_x) = A$$", "answer": "$$\\boxed{A}$$", "id": "440442"}, {"introduction": "在理想的无限大体系中，边缘态是无能隙的。然而，在更真实的有限尺寸纳米带结构中，位于相对两侧的边缘态会相互作用。这个练习将探讨这种有限尺寸效应 [@problem_id:39127]。通过将另一条边的存在视为一种微扰，我们可以计算出两条边缘态波函数交叠（或称“杂化”）所导致的能隙。这个计算不仅展示了拓扑保护的局限性，还让我们掌握了应用微扰论来分析边缘态之间相互作用的重要技巧。", "problem": "二维拓扑绝缘体（TI）纳米带的螺旋边缘态可以通过一个有效的一维狄拉克哈密顿量来描述。考虑一个宽度为 $W$ 的拓扑绝缘体纳米带。在纵向动量为零（$k_x=0$）时，反向传播的边缘态的低能物理特性由沿横向 $y$ 的一维狄拉克哈密顿量描述：\n$$\nH = v_p \\sigma_y (-i\\hbar\\partial_y) + m(y) \\sigma_z\n$$\n此处，$v_p$ 是一个有效速度，$\\sigma_y$ 和 $\\sigma_z$ 是代表赝自旋自由度（例如，轨道）的泡利矩阵，而依赖于位置的质量项 $m(y)$ 定义了拓扑绝缘体纳米带的几何形状。对于纳米带内部的拓扑区域（$|y|  W/2$），质量为 $m(y) = -M$；对于外部的平庸绝缘区域（$|y| > W/2$），质量为 $m(y) = +M$，其中 $M$ 是一个正常数。\n\n在无限分离（$W \\to \\infty$）的极限下，这种构型在每个边缘（$y = -W/2$ 和 $y = +W/2$）上承载着两个局域化的零能模，称为 Jackiw-Rebbi 态。对于有限宽度 $W$，这两个态，我们称之为 $\\Psi_L(y)$ 和 $\\Psi_R(y)$，会发生杂化。这种杂化会消除它们在零能量处的简并，并打开一个有限尺寸能隙。\n\n未归一化的单边缘波函数由下式给出：\n-   **左边缘态（中心在 $y = -W/2$）：** $\\Psi_L(y) = e^{-\\frac{1}{\\hbar v_p} \\int_{-W/2}^y m_L(y') dy'} \\phi_L$，其中 $m_L(y) = -M \\text{sgn}(y+W/2)$，旋量 $\\phi_L$ 是 $(i\\sigma_y - \\sigma_z)$ 的归一化本征矢量，本征值为 0。\n-   **右边缘态（中心在 $y = W/2$）：** $\\Psi_R(y) = e^{-\\frac{1}{\\hbar v_p} \\int_{W/2}^y m_R(y') dy'} \\phi_R$，其中 $m_R(y) = M \\text{sgn}(y-W/2)$，旋量 $\\phi_R$ 是 $(i\\sigma_y + \\sigma_z)$ 的归一化本征矢量，本征值为 0。\n\n通过将另一个边缘的存在视为微扰，杂化能隙 $\\Delta_{gap}$ 可以从完整纳米带哈密顿量 $H$ 的非对角矩阵元 $h = \\langle \\Psi_L | H | \\Psi_R \\rangle$ 计算得出。能隙由 $\\Delta_{gap} = 2|h|$ 给出。计算时请使用归一化的单边缘波函数。\n\n推导杂化能隙 $\\Delta_{gap}$ 作为 $M$、$W$ 和 $v_p$ 的函数表达式。", "solution": "为了推导杂化能隙 $\\Delta_{\\text{gap}} = 2|h|$，其中 $h = \\langle \\Psi_L | H | \\Psi_R \\rangle$，我们首先使用归一化的单边缘波函数来分析矩阵元。\n\n**步骤 1：归一化波函数**  \n未归一化的左边缘态和右边缘态如下：\n$$\n\\Psi_L(y) = e^{-\\frac{1}{\\hbar v_p} \\int_{-W/2}^y m_L(y') dy'} \\phi_L, \\quad \\Psi_R(y) = e^{-\\frac{1}{\\hbar v_p} \\int_{W/2}^y m_R(y') dy'} \\phi_R,\n$$\n其中 $m_L(y) = -M \\text{sgn}(y + W/2)$ 且 $m_R(y) = M \\text{sgn}(y - W/2)$。积分可简化为：\n$$\n\\int_{-W/2}^y m_L(y') dy' = -M |y + W/2|, \\quad \\int_{W/2}^y m_R(y') dy' = -M |y - W/2|.\n$$\n因此，波函数的空间部分呈指数衰减：\n$$\n\\Psi_L(y) \\propto e^{-\\frac{M}{\\hbar v_p} |y + W/2|}, \\quad \\Psi_R(y) \\propto e^{-\\frac{M}{\\hbar v_p} |y - W/2|}.\n$$\n对其进行归一化，我们得到归一化常数 $N_L, N_R$：\n$$\nN_L = N_R = \\sqrt{\\frac{M}{\\hbar v_p}},\n$$\n因为模方的积分为：\n$$\n\\int_{-\\infty}^\\infty e^{-\\frac{2M}{\\hbar v_p} |y \\pm W/2|} dy = \\frac{\\hbar v_p}{M}.\n$$\n\n**步骤 2：计算 $h = \\langle \\Psi_L | H | \\Psi_R \\rangle$**  \n哈密顿量为 $H = v_p \\sigma_y (-i\\hbar \\partial_y) + m(y) \\sigma_z$。$h$ 的主要贡献来自于 $y = -W/2$（左边缘）附近的区域。$\\Psi_R$ 是单个右边缘哈密顿量 $H_R$ 的零能本征态，所以 $H_R \\Psi_R = 0$。因此 $H \\Psi_R = (H-H_R)\\Psi_R = (m(y) - m_R(y))\\sigma_z \\Psi_R$。当 $y  -W/2$ 时，$m(y) = +M$ 且 $m_R(y) = -M$，所以 $m(y) - m_R(y) = 2M$。因此在该区域 $H \\Psi_R = 2M\\sigma_z\\Psi_R$。\n矩阵元变为：\n$$\nh = \\int_{-\\infty}^{-W/2} \\Psi_L^\\dagger(y) \\cdot 2M \\sigma_z \\Psi_R(y) \\, dy.\n$$\n代入归一化的波函数和旋量（可以验证 $\\phi_L^\\dagger \\sigma_z \\phi_R = 1$）：\n$$\nh = 2M N_L N_R (\\phi_L^\\dagger \\sigma_z \\phi_R) \\int_{-\\infty}^{-W/2} e^{-\\frac{M}{\\hbar v_p}|y+W/2|} e^{-\\frac{M}{\\hbar v_p}|y-W/2|} \\, dy\n$$\n在积分区域 $y-W/2$ 内，上式简化为：\n$$\nh = 2M \\frac{M}{\\hbar v_p} \\cdot 1 \\cdot \\int_{-\\infty}^{-W/2} e^{\\frac{M}{\\hbar v_p}(y+W/2)} e^{\\frac{M}{\\hbar v_p}(y-W/2)} \\, dy = 2M \\frac{M}{\\hbar v_p} e^{-\\frac{MW}{\\hbar v_p}} \\int_{-\\infty}^{-W/2} e^{\\frac{2M}{\\hbar v_p}(y+W/2)} \\, dy\n$$\n令 $z = y + W/2$，积分变为：\n$$\n\\int_{-\\infty}^0 e^{\\frac{2M z}{\\hbar v_p}} dz = \\frac{\\hbar v_p}{2M}.\n$$\n代入后我们得到：\n$$\nh = 2M \\cdot \\frac{M}{\\hbar v_p} \\cdot e^{-\\frac{M W}{\\hbar v_p}} \\cdot \\frac{\\hbar v_p}{2M} = M e^{-\\frac{M W}{\\hbar v_p}}.\n$$\n\n**步骤 3：计算杂化能隙**  \n能隙为 $\\Delta_{\\text{gap}} = 2|h|$，得出：\n$$\n\\Delta_{\\text{gap}} = 2M e^{-\\frac{M W}{\\hbar v_p}}.\n$$", "answer": "$$\\boxed{2M e^{-\\frac{MW}{\\hbar v_p}}}$$", "id": "39127"}, {"introduction": "前面的练习聚焦于边缘态自身的性质，但一个更深刻的问题是：我们如何仅从材料的体态（bulk）电子结构出发，就预言其边界上必定存在受保护的边缘态？答案在于“体边对应原理”（bulk-boundary correspondence）。这个高级计算实践将引导你使用威尔逊环（Wilson loop）方法来计算体拓扑不变量 $\\mathbb{Z}_2$ [@problem_id:2993910]。通过亲手编写代码实现这一过程，你将能够从数值上判定一个材料的拓扑相，并直接验证一个非平庸的体拓扑不变量是如何保证螺旋边缘态存在的，从而深刻理解拓扑物理学的核心思想。", "problem": "您将为一个二维时间反演不变的量子自旋霍尔 (QSH) 绝缘体晶格模型实现数值威尔逊循环计算。目标是计算混合瓦尼尔中心沿一个晶格动量方向的流，并确定其缠绕数的奇偶性，该奇偶性可用于诊断 $\\mathbb{Z}_2$ 相。奇数缠绕奇偶性标志着一个非平凡的 $\\mathbb{Z}_2$ 相，以及存在受时间反演对称性 (TRS) 保护的螺旋边缘态。所有角度都必须以弧度处理。\n\n起点和定义（符合上下文的基础知识）：\n- 考虑一个由布洛赫哈密顿量 $H(\\mathbf{k})$ 描述的二维周期性晶体，其中晶格动量 $\\mathbf{k}=(k_x,k_y)$ 在布里渊区 (BZ) 内变化。布洛赫本征态 $|u_{n}(\\mathbf{k})\\rangle$ 满足 $H(\\mathbf{k})|u_{n}(\\mathbf{k})\\rangle = E_{n}(\\mathbf{k})|u_{n}(\\mathbf{k})\\rangle$，能量为 $E_{n}(\\mathbf{k})$，其中 $n$ 是能带指数。\n- 在固定 $k_x$ 时，沿 $k_y$ 方向的威尔逊循环是当 $k_y$ 绕布里渊区一周时，占据布洛赫态之间交叠矩阵的路径排序乘积。将 $k_y$ 离散化为 $N_y$ 个点，并定义连续点之间的交叠矩阵为 $F_i(k_x) = \\langle u_m(k_x,k_{y,i})|u_n(k_x,k_{y,i+1})\\rangle$，该矩阵限制在占据子空间内，其中指数 $m,n$ 遍历所有占据能带。为确保数值稳定性，使用奇异值分解将每个 $F_i(k_x)$ 替换为其最接近的酉矩阵。\n- 威尔逊循环矩阵 $W(k_x)$ 是通过将这些酉化的交叠矩阵沿着 $k_y$ 的闭合回路（包括从最后一点到第一点的连接）相乘得到的。$W(k_x)$ 的本征值形式为 $e^{i\\theta_j(k_x)}$，相位 $\\theta_j(k_x)$ 通过 $\\nu_j(k_x)=\\theta_j(k_x)/(2\\pi)$ 模 $1$ 定义了沿 $y$ 方向的混合瓦尼尔中心位置（以晶格常数为单位）。\n- 在半个布里渊区 $k_x\\in[0,\\pi]$ 内，$\\nu$-流与参考线（例如 $\\nu=0.5$）的交点数量的奇偶性，即为威尔逊循环方法计算的 $\\mathbb{Z}_2$ 不变量。奇数奇偶性表示存在螺旋边缘态的非平凡相。\n\n模型和实现细节：\n- 使用 Bernevig-Hughes-Zhang (BHZ) 晶格模型，参数为 $A$、$B$ 和 $M$。令 $\\sigma_x$、$\\sigma_y$、$\\sigma_z$ 为作用于轨道子空间的泡利矩阵。对于自旋向上的块，定义\n$$\nh_{\\uparrow}(k_x,k_y) = d_x(k_x,k_y)\\,\\sigma_x + d_y(k_x,k_y)\\,\\sigma_y + d_z(k_x,k_y)\\,\\sigma_z,\n$$\n其中\n$$\nd_x(k_x,k_y) = A\\sin(k_x),\\quad d_y(k_x,k_y) = A\\sin(k_y),\\quad d_z(k_x,k_y) = M - 2B\\left(2 - \\cos(k_x) - \\cos(k_y)\\right).\n$$\n时间反演对称性 (TRS) 通过自旋向下的块 $h_{\\downarrow}(k_x,k_y) = h_{\\uparrow}^{*}(-k_x,-k_y)$ 实现，得到完整的 $4\\times 4$ 哈密顿量\n$$\nH(k_x,k_y) = \\begin{pmatrix} h_{\\uparrow}(k_x,k_y)  0 \\\\ 0  h_{\\downarrow}(k_x,k_y) \\end{pmatrix}.\n$$\n- 在每个 $(k_x,k_y)$ 点，对角化 $H(k_x,k_y)$ 并选择能量最低的两个能带作为占据态。在固定的 $k_x$ 下，沿着 $k_y$ 回路构建占据态的交叠矩阵，将它们酉化，然后相乘以获得 $W(k_x)$。对角化 $W(k_x)$ 以获得 $\\theta_j(k_x)$，并通过使用最大交叠在相邻 $k_x$ 点之间匹配本征矢量来连续追踪这些相位。\n- 通过计算在区间 $k_x\\in[0,\\pi]$ 内，连续分支 $\\theta_j(k_x)$ 穿过参考角 $\\theta_{\\mathrm{ref}}=\\pi$（等效于 $\\nu=0.5$）的次数来确定穿越奇偶性。如果奇偶性为奇数，则分类为 $1$；如果为偶数，则为 $0$。\n- 在分类之前，计算整个布里渊区内第二和第三能带之间的最小直接带隙，以确认体系是带隙绝缘体。如果最小直接带隙小于数值容差，则返回 $-1$，表示由于系统实际上是无带隙的，拓扑分类未定义。使用 $10^{-5}$ 的容差。\n\n角度单位：\n- 所有动量 $k_x$ 和 $k_y$ 都必须视为以弧度为单位的角度。\n\n要求的程序输出：\n- 对每个测试用例，输出一个整数：\n    - $1$ 如果系统有带隙且在 $k_x\\in[0,\\pi]$ 内的穿越奇偶性为奇数，\n    - $0$ 如果系统有带隙且穿越奇偶性为偶数，\n    - $-1$ 如果最小直接带隙低于容差。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔结果列表（例如，$[r_1,r_2,r_3]$）。\n\n测试套件：\n- 使用以下参数集 $\\{A,B,M,N_x,N_y\\}$，其中 $N_x$ 是 $[0,2\\pi)$ 范围内 $k_x$ 点的数量，$N_y$ 是 $[0,2\\pi)$ 范围内 $k_y$ 点的数量：\n    1. $\\{1.0,1.0,1.0,41,101\\}$\n    2. $\\{1.0,1.0,5.0,41,101\\}$\n    3. $\\{1.0,1.0,4.0,41,101\\}$\n\n上述集合分别测试了一个典型的非平凡情况、一个平凡情况以及一个接近相变的情况（预计在晶格对称点上实际上是无带隙的）。输出必须是指定的确切格式的单行文本。", "solution": "用户提供了一个问题，要求计算二维量子自旋霍尔 (QSH) 绝缘体的 $\\mathbb{Z}_2$ 拓扑不变量，该绝缘体由 Bernevig-Hughes-Zhang (BHZ) 模型描述。所用方法是威尔逊循环法，该方法涉及计算混合瓦尼尔荷中心的缠绕数。\n\n首先，评估问题陈述的有效性。\n\n### 步骤 1：提取已知条件\n- **模型**：Bernevig-Hughes-Zhang (BHZ) 晶格模型，用于 QSH 绝缘体。\n- **哈密顿量**：一个 $4 \\times 4$ 的布洛赫哈密顿量 $H(k_x, k_y)$ 由 $H = \\mathrm{diag}(h_{\\uparrow}, h_{\\downarrow})$ 给出，其中 $h_{\\uparrow}(k_x, k_y) = d_x(\\mathbf{k})\\,\\sigma_x + d_y(\\mathbf{k})\\,\\sigma_y + d_z(\\mathbf{k})\\,\\sigma_z$。\n- **d-矢量**：分量为 $d_x = A\\sin(k_x)$、$d_y = A\\sin(k_y)$ 和 $d_z = M - 2B(2 - \\cos(k_x) - \\cos(k_y))$。\n- **时间反演对称性 (TRS)**：自旋向下块与自旋向上块的关系为 $h_{\\downarrow}(k_x, k_y) = h_{\\uparrow}^{*}(-k_x, -k_y)$。\n- **占据子空间**：能量最低的两个能带被认为是占据的。\n- **带隙检查**：需要进行先决条件检查，以确保系统有带隙。第二和第三能带之间的最小直接带隙必须大于 $10^{-5}$ 的容差。如果不满足，则认为系统是无带隙的，分类未定义（输出 $-1$）。\n- **威尔逊循环过程**：对于固定的 $k_x$，通过将布里渊区 (BZ) 的 $k_y$ 方向离散化为 $N_y$ 个点来构建威尔逊循环 $W(k_x)$。威尔逊循环是在相邻 $k_y$ 点的占据布洛赫态 $|u_n\\rangle$ 之间酉化的交叠矩阵 $F_i(k_x) = \\langle u_m(k_x,k_{y,i})|u_n(k_x,k_{y,i+1})\\rangle$ 的路径排序乘积。酉化通过奇异值分解 (SVD) 执行。\n- **混合瓦尼尔中心**：威尔逊循环矩阵 $W(k_x)$ 的本征值是形式为 $e^{i\\theta_j(k_x)}$ 的复数。相位 $\\theta_j(k_x)$ 与混合瓦尼尔中心的位置 $\\nu_j(k_x) = \\theta_j(k_x)/(2\\pi)$ 相关。\n- **$\\mathbb{Z}_2$ 不变量**：$\\mathbb{Z}_2$ 不变量由瓦尼尔中心流 $\\theta_j(k_x)$ 在 $k_x$ 遍历半个布里渊区（从 $k_x=0$ 到 $k_x=\\pi$）时，与参考线 $\\theta_{\\mathrm{ref}}=\\pi$ 的穿越次数的奇偶性决定。为确保连续性，必须通过匹配相邻 $k_x$ 点的 $W(k_x)$ 本征矢量来追踪相位。\n- **输出**：一个整数：$1$ 表示非平凡（奇数次穿越），$0$ 表示平凡（偶数次穿越），$-1$ 表示无带隙。\n- **参数**：测试用例以集合 $\\{A, B, M, N_x, N_y\\}$ 的形式提供。\n- **角度单位**：所有动量都以弧度为单位。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有坚实的科学基础，描述了现代凝聚态物理学中的一个标准且典型的问题。BHZ 模型是理解拓扑绝缘体的基石，而威尔逊循环方法是计算 $\\mathbb{Z}_2$ 不变量的稳健数值技术。该过程以足够的数学和物理严谨性进行了描述。所有参数、定义和约束都明确陈述且自洽。问题是适定的、客观的，并且没有违反任何基本原则。包含带隙检查和确保瓦尼尔谱连续性的具体程序，表明这是一个结构良好的问题。所选的测试用例代表了模型的非平凡、平凡和临界（无带隙）状态，这对于全面验证实现是恰当的。\n\n### 步骤 3：结论与行动\n该问题被认为是 **有效的**。将根据指定的算法提供一个解决方案。\n\n### 解决方案\n该解决方案实现了指定的威尔逊循环计算，以确定 BHZ 模型的 $\\mathbb{Z}_2$ 拓扑不变量。算法主要分三个阶段进行：带隙检查、威尔逊循环及其谱的计算，以及分析瓦尼尔中心流以确定穿越奇偶性。\n\n**1. 哈密顿量与带隙计算**\n完整的 $4 \\times 4$ 哈密顿量 $H(k_x, k_y)$ 是块对角的。自旋向上块 $h_{\\uparrow}$ 使用给定的 d-矢量和泡利矩阵 $\\sigma_x, \\sigma_y, \\sigma_z$ 构建。自旋向下块 $h_{\\downarrow}(k_x, k_y) = h_{\\uparrow}^{*}(-k_x, -k_y)$ 由此导出。由于 $\\sigma_x$ 和 $\\sigma_z$ 是实数，而 $\\sigma_y$ 是纯虚数，我们发现 $h_{\\downarrow}$ 是通过翻转 $h_{\\uparrow}$ 中 $d_x$ 分量的符号得到的：$h_{\\downarrow}(k_x, k_y) = -d_x\\sigma_x + d_y\\sigma_y + d_z\\sigma_z$。一个 $2 \\times 2$ 哈密顿量 $h = \\mathbf{d}\\cdot\\boldsymbol{\\sigma}$ 的能量本征值为 $\\pm|\\mathbf{d}|$。因此，完整哈密顿量 $H(k_x,k_y)$ 的四个本征值是 $\\pm|\\mathbf{d}(\\mathbf{k})|$ 的重复，因为 $|-d_x, d_y, d_z|$ 与 $|d_x, d_y, d_z|$ 相同。因此，能谱为 $\\{ -|\\mathbf{d}(\\mathbf{k})|, -|\\mathbf{d}(\\mathbf{k})|, |\\mathbf{d}(\\mathbf{k})|, |\\mathbf{d}(\\mathbf{k})| \\}$。两个最低能带的能量为 $E_{1,2}(\\mathbf{k}) = -|\\mathbf{d}(\\mathbf{k})|$，两个最高能带的能量为 $E_{3,4}(\\mathbf{k}) = |\\mathbf{d}(\\mathbf{k})|$。占据带和非占据带之间的直接带隙为 $E_3(\\mathbf{k}) - E_2(\\mathbf{k}) = 2|\\mathbf{d}(\\mathbf{k})|$。\n\n第一步是验证系统在整个布里渊区内都是有带隙的。我们在覆盖布里渊区 $[0, 2\\pi) \\times [0, 2\\pi)$ 的离散 $(k_x, k_y)$ 网格上计算此直接带隙的最小值。如果该最小值低于指定的容差 $10^{-5}$，则认为系统实际上是无带隙的，拓扑分类不明确，该测试用例的程序终止并返回 $-1$。\n\n**2. 威尔逊循环与瓦尼尔谱计算**\n如果系统有带隙，我们继续计算威尔逊循环。对于 $[0, \\pi]$ 范围内的每个离散值 $k_x$，计算沿 $k_y$ 方向的威尔逊循环。$k_y$ 循环被离散化为 $N_y$ 个点，$k_{y,i} = 2\\pi i / N_y$，$i=0, \\dots, N_y-1$。\n\n对于固定的 $k_x$，我们计算每个 $k_{y,i}$ 处 $H(k_x, k_{y,i})$ 的本征矢量。对应于两个最低本征值的两个本征矢量构成了占据子空间的基底，用 $4 \\times 2$ 矩阵 $U_i$ 表示。然后我们构建 $k_y$ 路径上相邻点之间的 $2 \\times 2$ 交叠矩阵：$F_i(k_x) = U_i^\\dagger U_{i+1}$，其中索引 $i+1$ 对 $N_y$ 取模。\n\n为了确保数值稳定性和正确的几何性质（因为威尔逊循环是一种平行输运），每个交叠矩阵 $F_i$ 都被其最近的酉矩阵替换。这通过奇异值分解 $F_i = P_i S_i Q_i^\\dagger$ 实现。相应的酉矩阵是 $F'_i = P_i Q_i^\\dagger$。\n\n给定 $k_x$ 的威尔逊循环矩阵是这些酉化交叠矩阵沿闭合 $k_y$ 回路的乘积：\n$$ W(k_x) = F'_{N_y-1} \\cdots F'_1 F'_0 $$\n这个酉矩阵 $W(k_x)$ 的本征值的形式为 $e^{i\\theta_j(k_x)}$，其中 $j=1,2$。相位 $\\theta_j(k_x)$，在相差一个 $2\\pi$ 的因子内被称为瓦尼尔荷中心，是我们关注的核心量。\n\n**3. 追踪瓦尼尔中心与计数穿越**\n最后一步是分析当 $k_x$ 从 $0$ 变化到 $\\pi$ 时 $\\theta_j(k_x)$ 的演化。在每个 $k_x$ 点直接对角化 $W(k_x)$ 将产生一组无序的相位。为了获得连续的“流”曲线，我们必须在每个 $k_x$ 步长对本征值（和本征矢量）进行排序，以匹配上一步的顺序。这是通过计算 $W(k_x)$ 和 $W(k_{x-\\Delta k_x})$ 的本征矢量之间的交叠，并选择使该交叠最大化的排列来实现的。对于 2 能带情况，这只需检查交换两个新本征矢量是否能与前一个更好地匹配。\n\n建立了连续的相位演化 $\\theta_j(k_x)$ 后，我们确定 $\\mathbb{Z}_2$ 不变量。数值计算的相位通常在 $(-\\pi, \\pi]$ 范围内，因此可能出现 $2\\pi$ 的跳跃。为了正确计数穿越次数，我们首先对每个分支的相位数据进行“展开”，得到一个连续函数 $\\Theta_j(k_x)$。$\\mathbb{Z}_2$ 不变量是这些连续分支在区间 $k_x \\in [0, \\pi]$ 内穿过 $\\pi$ 的奇数倍（即 $\\pm\\pi, \\pm3\\pi, \\dots$）次数的奇偶性。这等价于计算变量 $q_j(k_x) = (\\Theta_j(k_x) - \\pi)/(2\\pi)$ 穿过整数值的次数。将两个分支的这些穿越次数相加，得到总穿越次数。奇数总数对应于非平凡的 $\\mathbb{Z}_2$ 不变量（输出 $1$），表示存在受保护的螺旋边缘态。偶数总数表示平凡相（输出 $0$）。", "answer": "```python\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Main function to run the Z2 invariant calculation for all test cases.\n    \"\"\"\n    test_cases = [\n        # {A, B, M, Nx, Ny}\n        (1.0, 1.0, 1.0, 41, 101),\n        (1.0, 1.0, 5.0, 41, 101),\n        (1.0, 1.0, 4.0, 41, 101),\n    ]\n\n    results = []\n    for params in test_cases:\n        A, B, M, Nx, Ny = params\n        result = calculate_z2_invariant(A, B, M, Nx, Ny)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_z2_invariant(A, B, M, Nx, Ny):\n    \"\"\"\n    Calculates the Z2 invariant for the BHZ model given a set of parameters.\n    Returns 1 (nontrivial), 0 (trivial), or -1 (gapless).\n    \"\"\"\n    gap_tolerance = 1e-5\n    \n    # Pauli matrices\n    sigma_x = np.array([[0, 1], [1, 0]], dtype=np.complex128)\n    sigma_y = np.array([[0, -1j], [1j, 0]], dtype=np.complex128)\n    sigma_z = np.array([[1, 0], [0, -1]], dtype=np.complex128)\n\n    def construct_hamiltonian(kx, ky):\n        d_x = A * np.sin(kx)\n        d_y = A * np.sin(ky)\n        d_z = M - 2 * B * (2 - np.cos(kx) - np.cos(ky))\n        \n        h_up = d_x * sigma_x + d_y * sigma_y + d_z * sigma_z\n        h_down = -d_x * sigma_x + d_y * sigma_y + d_z * sigma_z\n        \n        H = np.zeros((4, 4), dtype=np.complex128)\n        H[0:2, 0:2] = h_up\n        H[2:4, 2:4] = h_down\n        return H\n\n    # 1. Gap Check across the entire Brillouin Zone\n    kx_grid_full = np.linspace(0, 2 * np.pi, Nx, endpoint=False)\n    ky_grid_full = np.linspace(0, 2 * np.pi, Ny, endpoint=False)\n    min_gap = np.inf\n\n    for kx in kx_grid_full:\n        for ky in ky_grid_full:\n            d_x = A * np.sin(kx)\n            d_y = A * np.sin(ky)\n            d_z = M - 2 * B * (2 - np.cos(kx) - np.cos(ky))\n            d_norm_sq = d_x**2 + d_y**2 + d_z**2\n            gap = 2 * np.sqrt(d_norm_sq)\n            if gap  min_gap:\n                min_gap = gap\n    \n    if min_gap  gap_tolerance:\n        return -1\n\n    # 2. Wilson Loop Calculation over kx in [0, pi]\n    num_kx_half = (Nx - 1) // 2 + 1\n    kx_grid_half = kx_grid_full[:num_kx_half]\n\n    wannier_phases = np.zeros((num_kx_half, 2))\n    last_w_eigvecs = None\n\n    for i, kx in enumerate(kx_grid_half):\n        # Obtain occupied states along the k_y loop for the current k_x\n        occupied_states_ky = np.zeros((Ny, 4, 2), dtype=np.complex128)\n        for j, ky in enumerate(ky_grid_full):\n            H = construct_hamiltonian(kx, ky)\n            _, eigvecs = linalg.eigh(H)\n            occupied_states_ky[j, :, :] = eigvecs[:, :2]\n\n        # Compute the Wilson loop matrix W(kx)\n        W = np.eye(2, dtype=np.complex128)\n        for j in range(Ny):\n            j_next = (j + 1) % Ny\n            U_j = occupied_states_ky[j, :, :]\n            U_j_next = occupied_states_ky[j_next, :, :]\n            \n            F = U_j.T.conj() @ U_j_next\n            P, _, Qh = linalg.svd(F)\n            F_unitary = P @ Qh\n            W = W @ F_unitary\n\n        # Diagonalize W(kx) and get phases\n        w_eigvals, w_eigvecs = linalg.eig(W)\n        \n        # Sort eigenvectors by maximizing overlap with previous k_x step\n        if last_w_eigvecs is not None:\n            overlap_matrix = last_w_eigvecs.T.conj() @ w_eigvecs\n            \n            # For 2x2, simpler to compare two permutations\n            cost_id = np.abs(overlap_matrix[0, 0]) + np.abs(overlap_matrix[1, 1])\n            cost_swap = np.abs(overlap_matrix[0, 1]) + np.abs(overlap_matrix[1, 0])\n            \n            if cost_swap  cost_id:\n                w_eigvals = w_eigvals[[1, 0]]\n                w_eigvecs = w_eigvecs[:, [1, 0]]\n\n        wannier_phases[i, :] = np.angle(w_eigvals)\n        last_w_eigvecs = w_eigvecs\n\n    # 3. Count crossings of the reference line theta = pi\n    total_crossings = 0\n    for j in range(2): # For each of the two Wannier center branches\n        phases = wannier_phases[:, j]\n        unwrapped_phases = np.unwrap(phases)\n        \n        # Count crossings of odd-integer multiples of pi\n        # This is equivalent to counting integer crossings of (phase - pi)/(2*pi)\n        q = (unwrapped_phases - np.pi) / (2 * np.pi)\n        crossings = np.sum(np.floor(q[1:]) != np.floor(q[:-1]))\n        total_crossings += crossings\n        \n    return total_crossings % 2\n\nif __name__ == \"__main__\":\n    solve()\n\n```", "id": "2993910"}]}