{"hands_on_practices": [{"introduction": "在任何粒子-网格（PIC）模拟中，核心任务是准确地追踪带电粒子随时间的运动。最常用的算法之一是蛙跳法（leapfrog integrator），因其高效和良好的长期稳定性而备受青睐。本练习 [@problem_id:296795] 将通过分析一个简谐振子模型，引导你推导蛙跳法保持数值稳定的关键条件，这是设置模拟时间步长 $\\Delta t$ 时必须考虑的基本约束。", "problem": "在粒子模拟 (PIC) 中，单个带电粒子的运动被随时间进行追踪。用于描述振荡运动（例如粒子在均匀磁场中回旋或在静电势阱中振荡）的最简单模型是简谐振子 (SHO)。一维简谐振子的运动方程由下式给出：\n$$\n\\frac{d^2x}{dt^2} = -\\omega_0^2 x\n$$\n其中 $x$ 是粒子的位置，$\\omega_0$ 是振荡的固有角频率。\n\n解决此类问题的一个广泛使用的数值积分算法是交错蛙跳法（或 Verlet 法）。位置和速度的离散更新方程为：\n$$\nv_{n+1/2} = v_{n-1/2} + a_n \\Delta t\n$$\n$$\nx_{n+1} = x_n + v_{n+1/2} \\Delta t\n$$\n此处，$x_n = x(t_n)$ 是在时间 $t_n = n \\Delta t$ 处的位置，$v_{n \\pm 1/2} = v(t_n \\pm \\Delta t/2)$ 是在半整数时间步长处计算的速度，$a_n = -\\omega_0^2 x_n$ 是在时间 $t_n$ 处的加速度，而 $\\Delta t$ 是恒定的时间步长。\n\n该格式的数值稳定性取决于无量纲参数 $\\alpha = \\omega_0 \\Delta t$。如果一个数值格式的放大矩阵的所有特征值的模都小于或等于一 $(|\\lambda| \\le 1)$，并且任何模恰好为一的特征值都必须是特征多项式的一个单根（非重根），则该格式被定义为稳定的。模为一的重根特征值会导致长期增长，这是一种数值不稳定性。\n\n通过对应用于简谐振子的蛙跳格式进行矩阵稳定性分析，推导出其稳定性条件。确定使该格式保持稳定的无量纲参数 $\\alpha$ 的最大值。", "solution": "我们将蛙跳更新方程 $v_{n+1/2} = v_{n-1/2} + a_n \\Delta t$ 和 $x_{n+1} = x_n + v_{n+1/2} \\Delta t$ 结合。\n将 $a_n = -\\omega_0^2 x_n$ 代入第一个方程：$v_{n+1/2} = v_{n-1/2} - \\omega_0^2 x_n \\Delta t$。\n从第二个方程以及其前一个时间步的形式 $x_n = x_{n-1} + v_{n-1/2} \\Delta t$，我们可以消去速度项。\n将 $v_{n-1/2} = (x_n - x_{n-1})/\\Delta t$ 和 $v_{n+1/2} = (x_{n+1} - x_n)/\\Delta t$ 代入速度更新方程：\n$$\n\\frac{x_{n+1} - x_n}{\\Delta t} = \\frac{x_n - x_{n-1}}{\\Delta t} - \\omega_0^2 x_n \\Delta t\n$$\n整理后可得一个关于位置的三项递推关系：\n$$\nx_{n+1} - (2 - (\\omega_0 \\Delta t)^2) x_n + x_{n-1} = 0\n$$\n令 $\\alpha = \\omega_0 \\Delta t$，并假设解的形式为 $x_n = \\lambda^n$，我们得到特征方程：\n$$\n\\lambda^2 - (2 - \\alpha^2) \\lambda + 1 = 0\n$$\n根据稳定性定义，特征值 $\\lambda$ 的模必须小于或等于1，且在单位圆上的重根会导致不稳定。方程根的乘积 $\\lambda_1 \\lambda_2 = 1$。要使解有界，根必须是模为1的复共轭对。这要求判别式为负：\n$$\n(2 - \\alpha^2)^2 - 4  0 \\implies \\alpha^2 (\\alpha^2 - 4)  0\n$$\n由于 $\\alpha^2 > 0$，这简化为 $\\alpha^2  4$，即 $|\\alpha|  2$。\n当 $|\\alpha| = 2$ 时，我们得到一个重根 $\\lambda = -1$，这不满足稳定性条件。因此，该格式保持稳定的 $\\alpha$ 的最大值为2。", "answer": "$$\\boxed{2}$$", "id": "296795"}, {"introduction": "当我们将连续的粒子运动离散化到网格上时，不可避免地会引入一些非物理效应。一个典型的例子就是“自作用力”（self-force），即粒子会感受到由其自身电荷在网格上产生的场的反作用力，这可能违反能量守恒并导致数值加热。通过本练习 [@problem_id:296780]，你将量化这种在使用线性权重（CIC）方案时产生的自作用力，从而深入理解PIC模拟中误差的来源及其对模拟精度的影响。", "problem": "在一维静电粒子模拟（PIC）中，使用线性权重（也称为云中元胞法或 CIC），带电粒子与计算网格相互作用，会产生一种非物理的“自作用力”。这种力的产生是由于粒子自身的电荷在沉积到网格上后，会产生一个网格化的电场，该电场在插值后又反作用于粒子本身。这种伪力是空间离散化的直接后果，并导致了数值加热和能量守恒的违背。\n\n对于一个电荷为 $q$ 的单个粒子，在一个网格间距为 $\\Delta x$、真空介电常数为 $\\epsilon_0$ 的无限长一维系统中，可以证明其自身网格化电场的势能 $U_{self}$ 会随其在网格单元内的位置而变化。该势能以网格周期 $\\Delta x$ 呈周期性变化，并且在一个由网格节点 $x_j$ 和 $x_{j+1}$ 定义的给定单元内，其表达式为：\n$$\nU_{self}(x) = \\frac{q^2 \\Delta x}{2\\epsilon_0} u(1-u)\n$$\n其中 $u = \\frac{x - x_j}{\\Delta x}$ 是粒子在单元内的归一化位置，对于 $x \\in [x_j, x_{j+1}]$。该能量在单元边界（$u=0$ 和 $u=1$）处为零，在单元中心（$u=1/2$）处达到最大值。\n\n与此自作用势相关的保守力为 $F_{self}(x) = -\\frac{\\partial U_{self}}{\\partial x}$。当粒子穿过单元时，该力会发生变化，其在一个单元内的空间平均值为零。为了量化该力的典型大小，计算其均方根（RMS）值是很有用的。\n\n对于一个在单个网格单元内均匀分布的粒子，推导其自作用力的均方根值 $F_{RMS}$。", "solution": "相关的自作用势和归一化位置：\n$$ U_{self}(x)=\\frac{q^2\\Delta x}{2\\epsilon_0}u(1-u),\\qquad u=\\frac{x-x_j}{\\Delta x} $$\n自作用力：\n$$ F_{self}(x)=-\\frac{\\partial U_{self}}{\\partial x} = -\\frac{1}{\\Delta x}\\frac{\\partial}{\\partial u}\\left(\\frac{q^2\\Delta x}{2\\epsilon_0}u(1-u)\\right) $$\n$$ = -\\frac{q^2}{2\\epsilon_0}(1-2u) = \\frac{q^2}{2\\epsilon_0}(2u-1) $$\n\n在 $u\\in[0,1]$ 上平方并求平均值：\n$$ F_{self}^2=\\frac{q^4}{4\\epsilon_0^2}(2u-1)^2, $$\n$$ \\langle F^2\\rangle=\\int_0^1\\frac{q^4}{4\\epsilon_0^2}(2u-1)^2\\,du = \\frac{q^4}{4\\epsilon_0^2}\\int_0^1(4u^2-4u+1)\\,du = \\frac{q^4}{4\\epsilon_0^2}\\cdot\\frac{1}{3} $$\n\n因此，均方根自作用力为\n$$ F_{RMS}=\\sqrt{\\langle F^2\\rangle} = \\frac{q^2}{2\\epsilon_0}\\sqrt{\\frac{1}{3}} = \\frac{q^2}{2\\sqrt{3}\\,\\epsilon_0} $$", "answer": "$$\\boxed{\\frac{q^2}{2\\sqrt{3}\\,\\epsilon_0}}$$", "id": "296780"}, {"introduction": "为了确保模拟结果的长期物理真实性，PIC代码必须严格遵守基本的守恒定律，其中电荷守恒至关重要。这要求粒子电荷在网格上的分配（charge assignment）与电流的沉积（current deposition）必须自洽。本练习 [@problem_id:296879] 探讨了一种确保电荷守恒的电流计算方法，它将粒子运动直接与网格电流联系起来，从而精确满足离散形式的电荷连续性方程。", "problem": "在粒子模拟（PIC）中，一个电荷守恒的电流分配格式对于长期的数值稳定性和准确性至关重要。这是通过确保离散连续性方程被精确满足来实现的。\n\n考虑一个具有均匀间距 $\\Delta x$ 的一维网格，其中网格节点位置由 $x_j = j \\Delta x$ 给出，其中 $j$ 为整数。分配给节点 $j$ 的电荷 $Q_j$ 和流过位于中点 $x_{j+1/2} = (j+1/2)\\Delta x$ 的边界的电流 $I_{j+1/2}$ 通过离散连续性方程相关联：\n$$\n\\frac{Q_j^{n+1} - Q_j^n}{\\Delta t} + I_{j+1/2} - I_{j-1/2} = 0\n$$\n其中上标 $n$ 和 $n+1$ 表示由 $\\Delta t$ 分隔的两个连续时间步。\n\n粒子的电荷使用一阶线性的云中单元（CIC）权重格式分配给网格节点。对于一个电荷为 $q$，位于节点 $j$ 和 $j+1$ 之间位置 $x_p$ 处的粒子，分配给这些节点的电荷为：\n$$\nQ_j = q \\frac{x_{j+1} - x_p}{\\Delta x} \\quad \\text{and} \\quad Q_{j+1} = q \\frac{x_p - x_j}{\\Delta x}\n$$\n\n分配给网格节点 $j$ 的电流 $I_j$ 被定义为流过两个相邻单元边界的电流的算术平均值：\n$$\nI_j = \\frac{1}{2} (I_{j-1/2} + I_{j+1/2})\n$$\n\n现在，考虑一个电荷为 $q$ 的单个粒子。在时间间隔 $\\Delta t$ 内，它从位置 $x_p^n$ 移动到 $x_p^{n+1}$。在此移动过程中，该粒子穿过位于 $x_i$ 的网格节点。具体来说，其初始位置 $x_p^n$ 位于单元 $[x_{i-1}, x_i)$ 内，其最终位置 $x_p^{n+1}$ 位于单元 $[x_i, x_{i+1})$ 内。设粒子在其起始单元内的相对位置为 $\\delta_n = (x_p^n - x_{i-1}) / \\Delta x$，在其最终单元内的相对位置为 $\\delta_{n+1} = (x_p^{n+1} - x_i) / \\Delta x$。注意，根据定义，$0 \\le \\delta_n  1$ 且 $0 \\le \\delta_{n+1}  1$。\n\n假设远离粒子处的电流为零（即 $\\lim_{j\\to-\\infty} I_{j+1/2} = 0$），请推导分配到包围粒子最终位置的两个节点（即 $I_{\\text{dep}} = I_i + I_{i+1}$）上的总电流 $I_{\\text{dep}}$ 的表达式。请用 $q$、$\\Delta t$、$\\delta_n$ 和 $\\delta_{n+1}$ 表示你的答案。", "solution": "1. 在时刻 $n$ 和 $n+1$，通过线性CIC在相关节点上的电荷分配：\n$$\n\\begin{aligned}\nQ_{i-1}^n = q(1-\\delta_n),  Q_i^n = q\\delta_n,  \\quad Q_{i+1}^n=0, \\\\\nQ_{i-1}^{n+1}=0,  Q_i^{n+1}=q(1-\\delta_{n+1}),  \\quad Q_{i+1}^{n+1}=q\\delta_{n+1}.\n\\end{aligned}\n$$\n所有其他的 $Q_j^n$ 和 $Q_j^{n+1}$ 均为零。\n\n2. 计算电荷变化 $\\Delta Q_j=Q_j^{n+1}-Q_j^n$ 并应用离散连续性方程\n$$\n\\frac{\\Delta Q_j}{\\Delta t}+I_{j+1/2}-I_{j-1/2}=0,\n$$\n其中 $I_{-\\infty-1/2}=0$。\n\n– 在 $j=i-1$ 处：$\\Delta Q_{i-1}=-q(1-\\delta_n)$，所以\n$$\nI_{i-1/2}=\\frac{q(1-\\delta_n)}{\\Delta t}.\n$$\n\n– 在 $j=i$ 处：$\\Delta Q_i=q(1-\\delta_n-\\delta_{n+1})$，因此\n$$\nI_{i+1/2}=I_{i-1/2}-\\frac{\\Delta Q_i}{\\Delta t}\n=\\frac{q(1-\\delta_n)}{\\Delta t}-\\frac{q(1-\\delta_n-\\delta_{n+1})}{\\Delta t}\n=\\frac{q\\delta_{n+1}}{\\Delta t}.\n$$\n\n– 在 $j=i+1$ 处：$\\Delta Q_{i+1}=q\\delta_{n+1}$ 给出\n$$\nI_{i+3/2}=I_{i+1/2}-\\frac{\\Delta Q_{i+1}}{\\Delta t}\n=\\frac{q\\delta_{n+1}}{\\Delta t}-\\frac{q\\delta_{n+1}}{\\Delta t}=0.\n$$\n\n3. 通过算术平均得到以节点为中心的电流：\n$$\nI_i=\\frac{I_{i-1/2}+I_{i+1/2}}{2}\n=\\frac{q}{2\\Delta t}(1-\\delta_n+\\delta_{n+1}),\n$$\n$$\nI_{i+1}=\\frac{I_{i+1/2}+I_{i+3/2}}{2}\n=\\frac{q\\delta_{n+1}}{2\\Delta t}.\n$$\n\n4. 在节点 $i, i+1$ 上的总分配电流：\n$$\nI_{\\rm dep}=I_i+I_{i+1}\n=\\frac{q}{2\\Delta t}(1-\\delta_n+2\\delta_{n+1}).\n$$", "answer": "$$\\boxed{\\frac{q}{2\\Delta t}(1-\\delta_n+2\\delta_{n+1})}$$", "id": "296879"}]}