{"hands_on_practices": [{"introduction": "随机波模型（Random Wave Model, RWM）为经典混沌系统的高能本征函数提供了一种强大的统计描述。本练习将让您直接实践如何运用 RWM 的基本假设，通过计算波函数梯度的方差，您将推导出一个关键的局部统计性质。这个量与系统的动能密度直接相关，并可以在微波台球等实验中进行检验。[@problem_id:872573]", "problem": "在量子混沌领域，经典混沌系统中波函数的统计特性引起了人们极大的兴趣。这些系统可以通过实验实现，例如使用二维微波腔或半导体量子点。在这两种情况下，面积为 $A$ 的二维混沌台球的稳态波函数（或电磁场的相应分量）$\\psi(\\mathbf{r})$ 由亥姆霍兹方程 $(\\nabla^2 + k^2)\\psi(\\mathbf{r}) = 0$ 描述，并具有适当的边界条件。量 $k$ 是波数。\n\n研究此类波函数的一个强大理论工具是随机波模型（Random Wave Model, RWM）。在该模型中，高能量下的实值波函数 $\\psi(\\mathbf{r})$ 被推测其行为类似于大量平面波的随机叠加，这些平面波具有相同的波数 $k$，但方向和相位是随机的。对于二维系统，这可以表示为对所有可能的波矢方向 $\\theta \\in [0, 2\\pi)$ 的积分：\n$$ \\psi(\\mathbf{r}) = \\mathcal{N} \\int_0^{2\\pi} [a(\\theta) \\cos(\\mathbf{k}(\\theta)\\cdot\\mathbf{r}) + b(\\theta) \\sin(\\mathbf{k}(\\theta)\\cdot\\mathbf{r})] \\, d\\theta $$\n此处，$\\mathbf{r}=(x,y)$ 是位置矢量，$\\mathbf{k}(\\theta) = (k\\cos\\theta, k\\sin\\theta)$ 是波矢。系数 $a(\\theta)$ 和 $b(\\theta)$ 是关于角度 $\\theta$ 的独立的、零均值的高斯随机函数，满足以下相关性性质：\n$$ \\langle a(\\theta) a(\\theta') \\rangle = \\delta(\\theta - \\theta') $$\n$$ \\langle b(\\theta) b(\\theta') \\rangle = \\delta(\\theta - \\theta') $$\n$$ \\langle a(\\theta) b(\\theta') \\rangle = 0 $$\n其中 $\\langle \\cdot \\rangle$ 表示对随机系数的系综平均。常数 $\\mathcal{N}$ 是一个归一化因子。\n\n波函数在台球面积 $A$ 上归一化为1：$\\int_A \\psi^2(\\mathbf{r}) \\, d^2r = 1$。任何量 $f(\\mathbf{r})$ 的空间平均定义为 $\\langle f \\rangle_{space} = \\frac{1}{A} \\int_A f(\\mathbf{r}) \\, d^2r$。对于混沌系统，遍历性假设允许将空间平均与系综平均等同起来，即 $\\langle \\cdot \\rangle_{space} = \\langle \\cdot \\rangle_{ens}$。\n\n基于此随机波模型，确定波函数空间梯度单个分量（例如 $x$ 分量）的方差。该方差定义为空间平均 $\\text{Var}(\\partial_x \\psi) = \\langle (\\partial_x \\psi - \\langle \\partial_x \\psi \\rangle_{space})^2 \\rangle_{space}$。用波数 $k$ 和面积 $A$ 表示你的答案。", "solution": "我们从二维的随机波表示开始，\n$$\n\\psi(\\mathbf r)\n= \\mathcal N\\int_0^{2\\pi}\\Bigl[a(\\theta)\\cos\\!\\bigl(\\mathbf k(\\theta)\\!\\cdot\\!\\mathbf r\\bigr)\n + b(\\theta)\\sin\\!\\bigl(\\mathbf k(\\theta)\\!\\cdot\\!\\mathbf r\\bigr)\\Bigr]\\,d\\theta,\n\\quad\n\\mathbf k(\\theta)=k(\\cos\\theta,\\sin\\theta).\n$$\n1.  $x$ 方向的导数为\n$$\n\\partial_x\\psi\n= \\mathcal N\\int_0^{2\\pi}\\Bigl[-\\,k\\cos\\theta\\;a(\\theta)\\,\n\\sin(\\mathbf k(\\theta)\\!\\cdot\\!\\mathbf r)\n\\;+\\;k\\cos\\theta\\;b(\\theta)\\,\\cos(\\mathbf k(\\theta)\\!\\cdot\\!\\mathbf r)\n\\Bigr]\\,d\\theta.\n$$\n2.  根据遍历性，空间方差等于系综平均，并且 $\\langle\\partial_x\\psi\\rangle=0$。因此\n$$\n\\Var(\\partial_x\\psi)\n=\\bigl\\langle(\\partial_x\\psi)^2\\bigr\\rangle\n=\\mathcal N^2\\,k^2\n\\int_0^{2\\pi}\\!d\\theta\\;\\cos^2\\theta\\;\\Bigl\\langle\na(\\theta)^2\\sin^2(\\dots)+b(\\theta)^2\\cos^2(\\dots)\n\\Bigr\\rangle.\n$$\n3.  使用 $\\langle a(\\theta)a(\\theta')\\rangle=\\langle b(\\theta)b(\\theta')\\rangle=\\delta(\\theta-\\theta')$，并利用 $\\sin^2(\\dots)+\\cos^2(\\dots)=1$ 的关系,\n$$\n\\bigl\\langle(\\partial_x\\psi)^2\\bigr\\rangle\n=\\mathcal N^2\\,k^2\n\\int_0^{2\\pi}\\cos^2\\theta\\,d\\theta\n=\\mathcal N^2\\,k^2\\;\\pi.\n$$\n4.  归一化条件 $\\int_A\\psi^2\\,d^2r=1$ 给出\n$$\n\\langle\\psi^2\\rangle\n=\\mathcal N^2\\int_0^{2\\pi}d\\theta\n=\\;2\\pi\\,\\mathcal N^2\n=\\frac1A\n\\;\\;\\Longrightarrow\\;\\;\n\\mathcal N^2=\\frac1{2\\pi\\,A}.\n$$\n5.  因此\n$$\n\\Var(\\partial_x\\psi)\n=\\frac1{2\\pi\\,A}\\;k^2\\;\\pi\n=\\frac{k^2}{2A}.\n$$", "answer": "$$\\boxed{\\frac{k^2}{2A}}$$", "id": "872573"}, {"introduction": "当 RWM 在实空间中描述波函数时，随机矩阵理论（Random Matrix Theory, RMT）则在希尔伯特空间中提供了一个强有力的等效图像，它预言混沌系统的本征函数是“遍历的”或完全离域的。本实践引入了逆参与率（Inverse Participation Ratio, IPR），这是一个量化量子态离域程度的标准度量。您将为一个完全混沌的系统计算期望的 IPR 值，从而对“量子遍历性”对于本征函数分量的具体含义获得定量的理解。[@problem_id:908234]", "problem": "在量子混沌的研究中，其经典对应部分是混沌的量子系统的统计特性，通常使用随机矩阵理论（RMT）来建模。对于不具备时间反演对称性的系统，适用的随机哈密顿量系综是高斯幺正系综（GUE）。RMT 的一个核心预测是，这类混沌系统的本征函数在任何通用基中都是“遍历的”或“完全离域的”。这意味着本征函数的行为类似于随机向量。\n\n具体来说，一个 $N \\times N$ GUE 哈密顿量的本征函数 $|\\psi\\rangle$，当在标准正交基 $\\{|n\\rangle\\}_{n=1}^N$ 中展开为 $|\\psi\\rangle = \\sum_{n=1}^N c_n |n\\rangle$ 时，其分量 $c_n$ 在统计上等价于从 $\\mathbb{C}^N$ 中单位超球面表面上均匀随机选取的向量的分量（此性质称为Haar随机性）。\n\n一个用以量化本征函数离域程度的有用度量是逆参与率（IPR），记作 $P_2$。对于一个归一化态 $|\\psi\\rangle$，其定义为：\n$$P_2 = \\sum_{n=1}^{N} |c_n|^4$$\n对于离域态（其中许多 $|c_n|^2$ 的数量级为 $1/N$），IPR 的值很小；而对于局域态（其中某一个 $|c_n|^2$ 接近于 1），IPR 的数量级为 1。\n\n假设本征函数的统计特性由 $\\mathbb{C}^N$ 中的一个Haar随机单位向量所描述，计算逆参与率的精确系综平均值 $\\langle P_2 \\rangle$。结果应表示为希尔伯特空间维度 $N$ 的函数。\n\n在推导过程中，你可以使用以下事实：对于 $\\mathbb{C}^N$ 中的一个Haar随机单位向量，任意单个分量模长的平方 $x = |c_k|^2$ 的概率分布为 $p(x) = (N-1)(1-x)^{N-2}$，其中 $x \\in [0, 1]$。", "solution": "我们希望计算\n$$\\langle P_2\\rangle \\;=\\;\\Big\\langle\\sum_{n=1}^N |c_n|^4\\Big\\rangle\n=\\sum_{n=1}^N \\langle |c_n|^4\\rangle.$$ \n根据对称性，所有分量都是等价的，因此\n$$\\langle P_2\\rangle = N\\,\\langle |c_1|^4\\rangle.$$ \n给定 $x=|c_1|^2$ 的概率密度函数（pdf），\n$$p(x)=(N-1)(1-x)^{\\,N-2},\\quad x\\in[0,1],$$ \n我们有\n$$\\langle |c_1|^4\\rangle = \\int_0^1 x^2\\,p(x)\\,dx\n=(N-1)\\int_0^1 x^2(1-x)^{N-2}\\,dx.$$ \n识别出贝塔积分：\n$$\\int_0^1 x^2(1-x)^{N-2}\\,dx = B(3,N-1)\n=\\frac{\\Gamma(3)\\,\\Gamma(N-1)}{\\Gamma(N+2)}.$$\n由于 $\\Gamma(3)=2!$ 且 $\\Gamma(N-1)=(N-2)!$，$\\Gamma(N+2)=(N+1)!$，\n$$\\int_0^1 x^2(1-x)^{N-2}\\,dx = \\frac{2\\,(N-2)!}{(N+1)!}\n=\\frac{2}{N(N+1)}.$$ \n因此\n$$\\langle |c_1|^4\\rangle = (N-1)\\,\\frac{2}{N(N+1)}\n=\\frac{2(N-1)}{N(N+1)}\\cdot\\frac{1}{\\,N-1\\,}\n=\\frac{2}{N(N+1)},$$\n所以\n$$\\langle P_2\\rangle = N\\cdot\\frac{2}{N(N+1)}\n=\\frac{2}{N+1}.$$", "answer": "$$\\boxed{\\frac{2}{N+1}}$$", "id": "908234"}, {"introduction": "由 RWM 和 RMT 描绘的完美遍历性图像并非故事的全部，一个引人入胜的偏差是“量子疤痕”（quantum scars）现象。这个计算练习超越了简单的解析模型，转向了识别这些结构的实际挑战。您将构建一个疤痕波函数的数值模型，并实现一个统计指标来量化其存在，从而在量子混沌领域获得应用于计算物理和数据分析的宝贵技能。[@problem_id:2425412]", "problem": "构建一个自包含程序，用以评估在一个为混沌量子台球建模的二维类本征函数场中，是否存在沿指定曲线分布的增强概率密度。该场定义在一个方形域上，由平面波的叠加构成，这些平面波受到指定曲线附近一个局部增强（“疤痕”）的调制。您的程序必须为每个测试案例生成一个标量指标，用以量化沿给定曲线相对于全局背景的增强程度。\n\n空间域为方形域 $\\left[0,1\\right]\\times\\left[0,1\\right]$，使用无量纲坐标 $\\left(x,y\\right)$。对于每个测试案例，定义一个每轴有 $N$ 个点的均匀网格。设 $M$ 为平面波的数量，$k$ 为一个正常数波数（单位为弧度/单位长度），方向 $\\theta_m$ 均匀分布，即 $\\theta_m = 2\\pi m/M$，其中 $m\\in\\{0,1,\\dots,M-1\\}$。定义相位 $\\phi_m = 2\\pi \\left(\\left(a m + b\\right) \\bmod M\\right)/M$，其中整数 $a$ 和 $b$ 满足 $a$ 与 $M$ 互质。设背景实值场为\n$$\nR(x,y) = \\frac{1}{\\sqrt{M}} \\sum_{m=0}^{M-1} \\cos\\!\\left(k\\left(\\cos\\theta_m\\, x + \\sin\\theta_m\\, y\\right) + \\phi_m\\right).\n$$\n对于由端点 $\\mathbf{p}_1=(x_1,y_1)$ 和 $\\mathbf{p}_2=(x_2,y_2)$ 指定的线段 $\\gamma$，定义点 $\\mathbf{r}=(x,y)$ 到该线段的距离为\n$$\nd(\\mathbf{r},\\gamma)=\\min_{t\\in[0,1]}\\left\\|\\mathbf{r}-\\left(\\mathbf{p}_1 + t\\left(\\mathbf{p}_2-\\mathbf{p}_1\\right)\\right)\\right\\|_2.\n$$\n给定一个非负振幅 $A$ 和一个正宽度参数 $\\sigma$，定义调制\n$$\nS(x,y) = 1 + A \\exp\\!\\left(-\\frac{d(x,y,\\gamma)^2}{2\\sigma^2}\\right).\n$$\n定义复值波函数代理为 $\\psi(x,y)=S(x,y)\\,R(x,y)$，相应的概率密度为 $\\rho(x,y)=|\\psi(x,y)|^2$。归一化 $\\psi$，使得 $\\rho$ 在域上的积分的离散近似值等于 $1$，其中使用均匀网格单元面积。\n\n对于每个测试案例，计算沿 $\\gamma$ 的以下标量增强指标：\n- 定义管状权重\n$$\nw(x,y)=\\exp\\!\\left(-\\frac{d(x,y,\\gamma)^2}{2\\sigma^2}\\right).\n$$\n- 设空间平均值在网格上使用均匀权重计算。定义\n$$\n\\bar{\\rho}=\\text{mean of }\\rho(x,y),\\qquad \\sigma_\\rho=\\text{standard deviation of }\\rho(x,y),\n$$\n以及管状加权平均值\n$$\n\\langle\\rho\\rangle_{\\gamma}=\\frac{\\sum \\rho(x,y)\\,w(x,y)}{\\sum w(x,y)}.\n$$\n- 所需指标是标准化增强\n$$\nZ=\\frac{\\langle\\rho\\rangle_{\\gamma}-\\bar{\\rho}}{\\sigma_\\rho}.\n$$\n\n所有测试案例使用以下固定的全局参数：$M=64$，$k=100$，$a=37$，$b=13$。角度 $\\theta_m$ 和相位 $\\phi_m$ 的单位是弧度。所有长度都是无量纲的。对于下面的线段端点和宽度，请将其解释为与域坐标相同的无量纲单位。\n\n测试套件（四个案例），每个案例以 $\\left(N,\\mathbf{p}_1,\\mathbf{p}_2,A,\\sigma\\right)$ 的形式给出：\n1. $\\left(128,(0.1,0.1),(0.9,0.9),0.5,0.02\\right)$\n2. $\\left(128,(0.5,0.1),(0.5,0.9),0.0,0.02\\right)$\n3. $\\left(64,(0.1,0.9),(0.9,0.1),0.08,0.02\\right)$\n4. $\\left(160,(0.5,0.05),(0.5,0.95),0.3,0.015\\right)$\n\n您的程序必须：\n- 为每个测试案例构建如上定义的 $\\rho(x,y)$，包括对 $\\psi$ 进行归一化，使得 $\\rho$ 的离散积分等于 $1$。\n- 完全按照上述定义为每个案例计算 $Z$。\n- 生成单行输出，包含四个 $Z$ 值的列表，每个值四舍五入到三位小数，格式为逗号分隔的列表，并用方括号括起来，例如 $\\left[\\text{z}_1,\\text{z}_2,\\text{z}_3,\\text{z}_4\\right]$。\n\n所有计算必须在无量纲单位下进行。角度单位为弧度。最终输出为无量纲实数。", "solution": "此问题已经过审查并被确认为有效。它提出了一个计算物理学中适定性良好的挑战，其理论根基深植于已建立的量子混沌理论。目标是数值构建并分析一个二维标量场，该场模拟了量子“疤痕”——即混沌系统中沿经典不稳定周期轨道的概率密度增强现象。解将通过对所提供的数学形式体系进行直接的数值实现来得出。\n\n执行流程如下。首先，对空间域进行离san化。随后，在此离散网格上计算背景场、相关几何量以及调制后的波函数。最后，对得到的概率密度进行归一化，并计算指定的统计指标。此过程的每一步详述如下。\n\n**1. 域离散化与固定参数**\n\n连续域 $\\left[0,1\\right]\\times\\left[0,1\\right]$ 被离散化为 $N \\times N$ 个点的均匀网格。网格坐标沿每条轴以 $1/(N-1)$ 的均匀间距生成，确保完全覆盖该域，包括其边界。所有测试案例的全局参数是固定的：平面波数量为 $M=64$，波数为 $k=100$，相位生成的系数为 $a=37$ 和 $b=13$。平面波方向 $\\theta_m$ 及其对应的相位 $\\phi_m$ 根据指定公式预先计算：\n$$\n\\theta_m = \\frac{2\\pi m}{M}, \\quad m \\in \\{0, 1, \\dots, M-1\\}\n$$\n$$\n\\phi_m = \\frac{2\\pi}{M} \\left( (a m + b) \\pmod{M} \\right)\n$$\n条件 $a=37$ 与 $M=64$ 互质得到满足，这对于生成合适的相位伪随机序列是必要的。\n\n**2. 背景场构建**\n\n实值背景场 $R(x,y)$ 被构建为平面波的叠加。这是量子混沌研究中的一种标准表述，通常称为随机波模型。该场在每个网格点 $(x,y)$ 上使用给定表达式计算：\n$$\nR(x,y) = \\frac{1}{\\sqrt{M}} \\sum_{m=0}^{M-1} \\cos\\!\\left(k\\left(x \\cos\\theta_m + y \\sin\\theta_m \\right) + \\phi_m\\right)\n$$\n在计算上，这可以通过创建两个 $N \\times N$ 数组来表示网格的 $x$ 和 $y$ 坐标，然后对每个波分量 $m$ 计算余弦函数的自变量并将所有 $m$ 的结果相加来高效实现。\n\n**3. 到线段的距离**\n\n分析需要计算每个网格点 $\\mathbf{r}=(x,y)$ 到指定线段 $\\gamma$ 的最短欧几里得距离，该线段由其端点 $\\mathbf{p}_1=(x_1, y_1)$ 和 $\\mathbf{p}_2=(x_2, y_2)$ 定义。设 $\\mathbf{u} = \\mathbf{p}_2 - \\mathbf{p}_1$ 是定义该线段方向和长度的向量。包含该线段的无限直线上的任意点可以参数化为 $\\mathbf{p}(t) = \\mathbf{p}_1 + t \\mathbf{u}$。与网格点 $\\mathbf{r}$ 在该直线上的正交投影对应的参数 $t$ 由下式给出：\n$$\nt = \\frac{(\\mathbf{r} - \\mathbf{p}_1) \\cdot \\mathbf{u}}{\\|\\mathbf{u}\\|^2}\n$$\n为了找到*线段* $\\gamma$ 上的最近点，此参数必须被限制在区间 $\\left[0,1\\right]$ 内。设 $t' = \\max(0, \\min(1, t))$。则线段上的最近点为 $\\mathbf{p}_{\\text{closest}} = \\mathbf{p}_1 + t' \\mathbf{u}$。所需的距离则计算为：\n$$\nd(\\mathbf{r}, \\gamma) = \\|\\mathbf{r} - \\mathbf{p}_{\\text{closest}}\\|_2\n$$\n此计算对网格上的每个点执行，生成一个 $N \\times N$ 的距离场。必须单独处理 $\\mathbf{p}_1 = \\mathbf{p}_2$（零长度线段）的特殊情况；在这种情况下，距离就是 $\\|\\mathbf{r} - \\mathbf{p}_1\\|_2$。\n\n**4. 波函数、概率密度与归一化**\n\n背景场 $R(x,y)$ 经调制以沿线段 $\\gamma$ 引入一个增强，即“疤痕”。调制因子 $S(x,y)$ 定义为：\n$$\nS(x,y) = 1 + A \\exp\\!\\left(-\\frac{d(x,y,\\gamma)^2}{2\\sigma^2}\\right)\n$$\n其中 $A$ 是疤痕振幅，$\\sigma$ 是其特征宽度。未归一化的实值波函数则为 $\\psi(x,y) = S(x,y) R(x,y)$。因此，概率密度为 $\\rho(x,y) = |\\psi(x,y)|^2 = (S(x,y) R(x,y))^2$。\n\n此密度必须进行归一化，使其在单位方形域上的积分等于 $1$。使用网格上的离散求和作为积分的近似，归一化条件为：\n$$\n\\sum_{i=1}^{N} \\sum_{j=1}^{N} \\rho_{\\text{norm}}(x_i, y_j) \\Delta A = 1\n$$\n其中单个网格单元的面积为 $\\Delta A = (1/(N-1))^2$。因此，归一化密度可由未归一化密度 $\\rho_{\\text{unnorm}}$ 按下式获得：\n$$\n\\rho_{\\text{norm}}(x,y) = \\frac{\\rho_{\\text{unnorm}}(x,y)}{\\left(\\sum_{i,j} \\rho_{\\text{unnorm}}(x_i, y_j)\\right) \\Delta A}\n$$\n\n**5. 增强指标计算**\n\n最后一步是计算标准化增强指标 $Z$。这需要从归一化的概率密度场 $\\rho(x,y)$ 导出三个统计量：\n- 全局平均密度，在所有网格点上计算：$\\bar{\\rho} = \\frac{1}{N^2} \\sum_{i,j} \\rho(x_i, y_j)$。\n- 密度的全局标准差：$\\sigma_\\rho = \\sqrt{\\frac{1}{N^2} \\sum_{i,j} (\\rho(x_i, y_j) - \\bar{\\rho})^2}$。\n- 管状加权平均密度 $\\langle\\rho\\rangle_{\\gamma}$。这是 $\\rho$ 依据与疤痕的接近程度进行加权的平均值，使用的权重函数为 $w(x,y) = \\exp\\left(-\\frac{d(x,y,\\gamma)^2}{2\\sigma^2}\\right)$。该加权平均值由下式给出：\n$$\n\\langle\\rho\\rangle_{\\gamma} = \\frac{\\sum_{i,j} \\rho(x_i,y_j) w(x_i,y_j)}{\\sum_{i,j} w(x_i,y_j)}\n$$\n指标 $Z$ 是一种 Z-分数，它量化了疤痕区域内密度增强相对于背景涨落的显著性。其定义为：\n$$\nZ = \\frac{\\langle\\rho\\rangle_{\\gamma} - \\bar{\\rho}}{\\sigma_\\rho}\n$$\n整个计算流程将应用于所提供的四个测试案例中的每一个，得出的 $Z$ 值将作为最终答案报告。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the quantum scar analysis problem for a set of test cases.\n    \"\"\"\n\n    # --- Fixed Global Parameters ---\n    M = 64\n    k = 100.0\n    a = 37\n    b = 13\n\n    # --- Pre-calculate angle and phase arrays ---\n    m_vals = np.arange(M)\n    thetas = 2.0 * np.pi * m_vals / M\n    phis = 2.0 * np.pi * ((a * m_vals + b) % M) / M\n    cos_thetas = np.cos(thetas)\n    sin_thetas = np.sin(thetas)\n\n    # --- Test Suite ---\n    test_cases = [\n        (128, (0.1, 0.1), (0.9, 0.9), 0.5, 0.02),\n        (128, (0.5, 0.1), (0.5, 0.9), 0.0, 0.02),\n        (64,  (0.1, 0.9), (0.9, 0.1), 0.08, 0.02),\n        (160, (0.5, 0.05), (0.5, 0.95), 0.3, 0.015)\n    ]\n\n    results = []\n\n    for case in test_cases:\n        N, p1_coords, p2_coords, A, sigma = case\n\n        # 1. Domain Discretization\n        grid_1d = np.linspace(0.0, 1.0, N)\n        X, Y = np.meshgrid(grid_1d, grid_1d)\n\n        # 2. Background Field R(x,y) Construction\n        R = np.zeros_like(X, dtype=np.float64)\n        for m in range(M):\n            R += np.cos(k * (X * cos_thetas[m] + Y * sin_thetas[m]) + phis[m])\n        R /= np.sqrt(M)\n\n        # 3. Distance d(x,y,gamma) Calculation\n        p1 = np.array(p1_coords, dtype=np.float64)\n        p2 = np.array(p2_coords, dtype=np.float64)\n        segment_vec = p2 - p1\n        segment_len_sq = np.dot(segment_vec, segment_vec)\n\n        if segment_len_sq == 0.0:\n            # Distance to a point\n            dist_sq = (X - p1[0])**2 + (Y - p1[1])**2\n        else:\n            # Project grid points onto the line defined by the segment\n            t = ((X - p1[0]) * segment_vec[0] + (Y - p1[1]) * segment_vec[1]) / segment_len_sq\n            # Clamp t to the [0, 1] interval to find the closest point on the segment\n            t_clipped = np.clip(t, 0.0, 1.0)\n            \n            # Coordinates of the closest point on the segment for each grid point\n            closest_x = p1[0] + t_clipped * segment_vec[0]\n            closest_y = p1[1] + t_clipped * segment_vec[1]\n            \n            # Calculate squared Euclidean distance\n            dist_sq = (X - closest_x)**2 + (Y - closest_y)**2\n        \n        # 4. Modulation S(x,y) and Weight w(x,y)\n        w = np.exp(-dist_sq / (2.0 * sigma**2))\n        S = 1.0 + A * w\n\n        # 5. Wavefunction psi, Density rho, and Normalization\n        psi = S * R\n        rho_unnorm = psi**2\n        \n        # The discrete integral is sum(rho) * cell_area\n        cell_area = (1.0 / (N - 1))**2 if N > 1 else 1.0\n        integral_rho = np.sum(rho_unnorm) * cell_area\n        rho = rho_unnorm / integral_rho\n        \n        # 6. Enhancement Indicator Z Calculation\n        rho_mean = np.mean(rho)\n        rho_std = np.std(rho)\n        \n        if rho_std == 0.0:\n            # Avoid division by zero in the unlikely case of a flat field\n            Z = 0.0\n        else:\n            # Calculate tube-weighted mean density\n            rho_weighted_mean = np.sum(rho * w) / np.sum(w)\n            # Calculate the standardized enhancement Z\n            Z = (rho_weighted_mean - rho_mean) / rho_std\n            \n        results.append(Z)\n\n    # Format the final output string as specified\n    formatted_results = [f\"{z:.3f}\" for z in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n\nsolve()\n\n```", "id": "2425412"}]}