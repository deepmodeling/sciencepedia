{"hands_on_practices": [{"introduction": "本次首个练习旨在对克拉默斯-克勒尼希（Kramers-Kronig, KK）关系进行一次基础性检验。你将从一个描述单个阻尼准粒子激发的简单洛伦兹谱函数出发，重建完整的复数格林函数。这个实践将强化谱表示 $A(\\omega)$ 与因果响应函数 $G^R(\\omega)$ 之间的深刻联系，展示因果律如何从虚部唯一地确定实部。[@problem_id:2998527]", "problem": "考虑一个平移不变系统中的单粒子激发，其频率分辨谱函数由洛伦兹函数给出\n$$\nA(\\omega)=\\frac{2\\Gamma}{\\left(\\omega-\\omega_{0}\\right)^{2}+\\Gamma^{2}},\n$$\n其中 $\\Gamma>0$ 且 $\\omega_{0}$ 为实数。假设系统是因果的，因此推迟格林函数 $G^{R}(\\omega)$ 在复频率平面的上半平面是解析的，并且当 $|\\omega|\\to\\infty$ 时趋于零。谱函数与推迟格林函数通过标准定义 $A(\\omega)=-2\\,\\Im\\,G^{R}(\\omega)$ 相关联，且它遵循求和规则 $\\int_{-\\infty}^{\\infty}\\frac{d\\omega}{2\\pi}\\,A(\\omega)=1$。 \n\n仅利用这些基本性质，确定与因果性和给定的 $A(\\omega)$ 一致的 $G^{R}(\\omega)$ 的唯一闭式表达式。然后，显式地验证你得到的 $G^{R}(\\omega)$ 的实部和虚部满足 Kramers–Kronig (KK) 关系，并检验由谱求和规则所暗示的大$|\\omega|$渐近行为。\n\n以 $G^{R}(\\omega)$ 的单个解析表达式的形式给出你的最终答案。不需要数值近似，也不需要单位。", "solution": "该问题是适定的，具有科学依据，且内部逻辑一致。所有给定的数据和条件在线性响应理论和多体物理的框架内都是标准的。因此，我们可以进行严格的推导。\n\n主要任务是在给定其关联的谱函数 $A(\\omega)$ 和某些基本性质的情况下，确定推迟格林函数 $G^R(\\omega)$。我们已知单粒子激发的谱函数为：\n$$\nA(\\omega) = \\frac{2\\Gamma}{\\left(\\omega-\\omega_{0}\\right)^{2}+\\Gamma^{2}}\n$$\n其中 $\\Gamma > 0$ 且 $\\omega_0$ 是一个实常数。谱函数与格林函数之间的关系由 $A(\\omega) = -2\\,\\Im\\,G^R(\\omega)$ 给出。由此，我们立即得到对于实频率 $\\omega$，$G^R(\\omega)$ 的虚部为：\n$$\n\\Im\\,G^R(\\omega) = -\\frac{1}{2}A(\\omega) = -\\frac{\\Gamma}{\\left(\\omega-\\omega_{0}\\right)^{2}+\\Gamma^{2}}\n$$\n问题陈述系统是因果的，这意味着推迟格林函数 $G^R(\\omega)$ 作为复频率 $\\omega$ 的函数，必须在上半平面（$\\Im\\,\\omega > 0$）内是解析的。还给定在上半平面内，当 $|\\omega| \\to \\infty$ 时 $G^R(\\omega) \\to 0$。\n\n一个在上半平面解析且在无穷远处趋于零的函数，其在实轴上的实部和虚部由 Kramers-Kronig (KK) 关系关联。我们可以利用 KK 关系从 $G^R(\\omega)$ 的虚部求出其实部：\n$$\n\\Re\\,G^R(\\omega) = \\mathcal{P} \\int_{-\\infty}^{\\infty} \\frac{d\\omega'}{\\pi} \\frac{\\Im\\,G^R(\\omega')}{\\omega'-\\omega}\n$$\n其中 $\\mathcal{P}$ 表示柯西主值。代入 $\\Im\\,G^R(\\omega')$ 的表达式：\n$$\n\\Re\\,G^R(\\omega) = \\mathcal{P} \\int_{-\\infty}^{\\infty} \\frac{d\\omega'}{\\pi} \\frac{-\\Gamma}{\\left((\\omega'-\\omega_0)^2+\\Gamma^2\\right)(\\omega'-\\omega)} = -\\frac{\\Gamma}{\\pi} \\mathcal{P} \\int_{-\\infty}^{\\infty} \\frac{d\\omega'}{\\left((\\omega'-\\omega_0)^2+\\Gamma^2\\right)(\\omega'-\\omega)}\n$$\n这个主值积分可以使用围道积分法计算。结果是：\n$$\n\\mathcal{P} \\int_{-\\infty}^{\\infty} \\frac{d\\omega'}{\\left((\\omega'-\\omega_0)^2+\\Gamma^2\\right)(\\omega'-\\omega)} = -\\frac{\\pi(\\omega-\\omega_0)}{\\Gamma\\left((\\omega-\\omega_0)^2+\\Gamma^2\\right)}\n$$\n将此结果代入 $\\Re\\,G^R(\\omega)$ 的表达式中：\n$$\n\\Re\\,G^R(\\omega) = -\\frac{\\Gamma}{\\pi} \\left( -\\frac{\\pi(\\omega-\\omega_0)}{\\Gamma\\left((\\omega-\\omega_0)^2+\\Gamma^2\\right)} \\right) = \\frac{\\omega-\\omega_0}{(\\omega-\\omega_0)^2+\\Gamma^2}\n$$\n现在，我们构建完整的格林函数 $G^R(\\omega) = \\Re\\,G^R(\\omega) + i\\,\\Im\\,G^R(\\omega)$：\n$$\nG^R(\\omega) = \\frac{\\omega-\\omega_0}{(\\omega-\\omega_0)^2+\\Gamma^2} + i \\left( -\\frac{\\Gamma}{(\\omega-\\omega_0)^2+\\Gamma^2} \\right) = \\frac{\\omega-\\omega_0 - i\\Gamma}{(\\omega-\\omega_0)^2+\\Gamma^2}\n$$\n分母可以因式分解为 $(\\omega-\\omega_0)^2+\\Gamma^2 = (\\omega-\\omega_0-i\\Gamma)(\\omega-\\omega_0+i\\Gamma)$。这可以进行简化：\n$$\nG^R(\\omega) = \\frac{\\omega-\\omega_0-i\\Gamma}{(\\omega-\\omega_0-i\\Gamma)(\\omega-\\omega_0+i\\Gamma)} = \\frac{1}{\\omega-\\omega_0+i\\Gamma}\n$$\n该函数在 $\\omega=\\omega_0-i\\Gamma$ 处有一个单极点。由于 $\\Gamma > 0$，该极点位于下半平面，这证实了 $G^R(\\omega)$ 在上半平面是解析的，符合因果性的要求。当 $|\\omega| \\to \\infty$ 时 $G^R(\\omega) \\to 0$ 的条件也显然得到满足。根据 Titchmarsh 定理（半平面柯西积分公式的一个推论），该解是唯一的。\n\n下一步是显式地验证我们推导出的 $G^R(\\omega)$ 的实部和虚部满足 KK 关系。我们已经用了一个关系式来求实部。现在我们来验证另一个：\n$$\n\\Im\\,G^R(\\omega) = -\\mathcal{P} \\int_{-\\infty}^{\\infty} \\frac{d\\omega'}{\\pi} \\frac{\\Re\\,G^R(\\omega')}{\\omega'-\\omega}\n$$\n代入 $\\Re\\,G^R(\\omega') = \\frac{\\omega'-\\omega_0}{(\\omega'-\\omega_0)^2+\\Gamma^2}$：\n$$\n\\Im\\,G^R(\\omega) = -\\frac{1}{\\pi} \\mathcal{P} \\int_{-\\infty}^{\\infty} \\frac{\\omega'-\\omega_0}{\\left((\\omega'-\\omega_0)^2+\\Gamma^2\\right)(\\omega'-\\omega)} d\\omega'\n$$\n计算此积分，例如通过围道积分法，得到：\n$$\n\\mathcal{P} \\int_{-\\infty}^{\\infty} \\frac{\\omega'-\\omega_0}{\\left((\\omega'-\\omega_0)^2+\\Gamma^2\\right)(\\omega'-\\omega)} d\\omega' = \\frac{\\pi\\Gamma}{(\\omega-\\omega_0)^2+\\Gamma^2}\n$$\n因此，\n$$\n\\Im\\,G^R(\\omega) = -\\frac{1}{\\pi} \\left( \\frac{\\pi\\Gamma}{(\\omega-\\omega_0)^2+\\Gamma^2} \\right) = -\\frac{\\Gamma}{(\\omega-\\omega_0)^2+\\Gamma^2}\n$$\n这与我们开始时的虚部完全匹配，从而完成了对 KK 关系的验证。\n\n最后，我们检验由谱求和规则所暗示的大$|\\omega|$渐近行为。对于大$|\\omega|$，$G^R(\\omega)$ 的展开与谱函数的矩有关：\n$$\nG^R(\\omega) = \\int_{-\\infty}^{\\infty} \\frac{d\\omega'}{2\\pi} \\frac{A(\\omega')}{\\omega-\\omega'} = \\frac{1}{\\omega} \\int_{-\\infty}^{\\infty} \\frac{d\\omega'}{2\\pi} \\frac{A(\\omega')}{1-\\omega'/\\omega} \\approx \\frac{1}{\\omega} \\int_{-\\infty}^{\\infty} \\frac{d\\omega'}{2\\pi} A(\\omega') + O\\left(\\frac{1}{\\omega^2}\\right)\n$$\n我们已知求和规则 $\\int_{-\\infty}^{\\infty} \\frac{d\\omega}{2\\pi} A(\\omega) = 1$。这意味着 $G^R(\\omega)$ 的主导渐近行为必须是 $G^R(\\omega) \\sim 1/\\omega$。\n我们来检验一下我们推导出的表达式在大$|\\omega|$极限下的行为：\n$$\nG^R(\\omega) = \\frac{1}{\\omega-\\omega_0+i\\Gamma} = \\frac{1}{\\omega} \\frac{1}{1 - \\frac{\\omega_0-i\\Gamma}{\\omega}}\n$$\n对于 $|\\omega| \\gg |\\omega_0-i\\Gamma|$，我们可以使用几何级数展开 $(1-z)^{-1} \\approx 1+z$：\n$$\nG^R(\\omega) \\approx \\frac{1}{\\omega} \\left( 1 + \\frac{\\omega_0-i\\Gamma}{\\omega} \\right) = \\frac{1}{\\omega} + O\\left(\\frac{1}{\\omega^2}\\right)\n$$\n主阶项确实是 $1/\\omega$，这与给定的求和规则一致。问题的所有条件都已满足。", "answer": "$$\\boxed{\\frac{1}{\\omega - \\omega_0 + i\\Gamma}}$$", "id": "2998527"}, {"introduction": "从抽象模型转向具体的物理系统，这个问题将探索导体的光电导率 $\\sigma(\\omega)$。你将处理一个包含自由载流子（德鲁德峰）和束缚电子跃迁（洛伦兹峰）的实际模型。通过应用KK关系从电导率的实部计算虚部，你将练习处理更复杂的响应函数，并将结果与基础的电导率 $f$-求和规则联系起来。[@problem_id:2998540]", "problem": "考虑一个均匀各向同性的导体，其复光学电导率 $\\sigma(\\omega)$ 具有时域因果性，即时域响应核 $\\sigma(t)$ 在 $t<0$ 时为零。对于所有实数 $\\omega$，实验测得的频率依赖电导率的实部由一个Drude峰和一个Lorentz峰叠加而成，\n$$\n\\operatorname{Re}\\sigma(\\omega)\n=\nA\\,\\frac{\\Gamma^{2}}{\\omega^{2}+\\Gamma^{2}}\n\\;+\\;\nB\\,\\frac{\\gamma\\,\\omega^{2}}{\\left(\\omega_{0}^{2}-\\omega^{2}\\right)^{2}+(\\gamma\\,\\omega)^{2}},\n$$\n其中 $A>0$、$B>0$、$\\Gamma>0$、$\\gamma>0$ 和 $\\omega_{0}>0$ 是材料参数。假设采用凝聚态物理的标准惯例，其中傅里叶变换使用 $\\exp(i\\omega t)$ 的时间依赖性，且因果性意味着 $\\sigma(\\omega)$ 在复 $\\omega$ 平面的上半平面是解析的。\n\n仅利用基于因果性的 $\\sigma(\\omega)$ 的解析性，计算与给定 $\\operatorname{Re}\\sigma(\\omega)$ 存在 Kramers-Kronig 关系的虚部 $\\operatorname{Im}\\sigma(\\omega)$。然后，从相同的因果性基础出发，通过计算 $\\int_{0}^{\\infty} \\operatorname{Re}\\sigma(\\omega)\\,d\\omega$ 并确定其对参数的依赖关系，验证电导率f-求和规则与上述参数化是一致的。\n\n请将您的最终答案表示为 $\\operatorname{Im}\\sigma(\\omega)$ 关于 $A$、$B$、$\\Gamma$、$\\gamma$、$\\omega_{0}$ 和 $\\omega$ 的单个闭合形式解析表达式。不需要进行数值计算。", "solution": "经审慎审查，问题陈述是有效的。它在科学上基于凝聚态物质中线性响应理论和电磁学的既定原理。该问题是适定的、客观的、自洽的，并且可以形式化。它描述了一个标准的光学电导率物理模型，并要求基于因果性这一基本原理进行计算，这是一个坚实的物理和数学基础。\n\n复电导率 $\\sigma(\\omega)$ 是一个时域因果的响应函数，这意味着其傅里叶变换 $\\sigma(\\omega)$ 在复频率平面的上半平面（$\\operatorname{Im}(\\omega)>0$）是解析的。这种解析性是Kramers-Kronig（KK）关系的根基，该关系连接了 $\\sigma(\\omega)$ 的实部和虚部。源于时域响应 $\\sigma(t)$ 实数性的另一个性质是 $\\sigma(-\\omega^*) = \\sigma(\\omega)^*$。对于实数频率 $\\omega$，这简化为 $\\sigma(-\\omega) = \\sigma(\\omega)^*$，意味着 $\\operatorname{Re}\\sigma(\\omega)$ 是 $\\omega$ 的偶函数，而 $\\operatorname{Im}\\sigma(\\omega)$ 是奇函数。所提供的 $\\operatorname{Re}\\sigma(\\omega)$ 确实是一个偶函数，与此原理一致。\n\n虚部 $\\operatorname{Im}\\sigma(\\omega)$ 可以通过Kramers-Kronig关系从实部 $\\operatorname{Re}\\sigma(\\omega)$ 中求得：\n$$ \\operatorname{Im}\\sigma(\\omega) = -\\frac{1}{\\pi} \\mathcal{P} \\int_{-\\infty}^{\\infty} \\frac{\\operatorname{Re}\\sigma(\\omega')}{\\omega' - \\omega} d\\omega' $$\n其中 $\\mathcal{P}$ 表示柯西主值。\n\n一个更直接的方法是构造一个在上半平面（$\\operatorname{Im}(z)>0$）解析的完整复函数 $\\sigma(z)$，使其在实轴上 $z=\\omega$ 时的实部与给定的 $\\operatorname{Re}\\sigma(\\omega)$ 相匹配。此函数的虚部即为所求的 $\\operatorname{Im}\\sigma(\\omega)$。\n\n给定的实部是两项之和，我们将其识别为一个类Drude项（$\\sigma_{1,D}$）和一个类Lorentz项（$\\sigma_{1,L}$）：\n$$ \\operatorname{Re}\\sigma(\\omega) = \\sigma_{1,D}(\\omega) + \\sigma_{1,L}(\\omega) $$\n其中\n$$ \\sigma_{1,D}(\\omega) = A\\,\\frac{\\Gamma^{2}}{\\omega^{2}+\\Gamma^{2}} \\quad \\text{和} \\quad \\sigma_{1,L}(\\omega) = B\\,\\frac{\\gamma\\,\\omega^{2}}{\\left(\\omega_{0}^{2}-\\omega^{2}\\right)^{2}+(\\gamma\\,\\omega)^{2}} $$\n根据线性性质，我们可以分别求出每一项的虚部，然后将结果相加。\n\n1.  **类Drude项：**\n    我们寻求一个在 $\\operatorname{Im}(z)>0$ 时解析的函数 $\\sigma_D(z)$，使得 $\\operatorname{Re}[\\sigma_D(\\omega)] = \\sigma_{1,D}(\\omega)$。所要求的函数其极点必须在下半平面。分母 $\\omega^2+\\Gamma^2$ 表明极点在 $z=\\pm i\\Gamma$。极点 $z=-i\\Gamma$ 位于下半平面。让我们利用这个极点来构造 $\\sigma_D(z)$。考虑函数 $\\sigma_D(z) = \\frac{iC}{z+i\\Gamma}$。对于实数 $z=\\omega$：\n    $$ \\sigma_D(\\omega) = \\frac{iC}{\\omega+i\\Gamma} = \\frac{iC(\\omega-i\\Gamma)}{\\omega^2+\\Gamma^2} = \\frac{C\\Gamma + iC\\omega}{\\omega^2+\\Gamma^2} $$\n    其实部为 $\\operatorname{Re}[\\sigma_D(\\omega)] = \\frac{C\\Gamma}{\\omega^2+\\Gamma^2}$。与 $\\sigma_{1,D}(\\omega) = \\frac{A\\Gamma^2}{\\omega^2+\\Gamma^2}$ 比较，我们必须有 $C\\Gamma = A\\Gamma^2$，所以 $C=A\\Gamma$。因此，Drude项的完整复函数是：\n    $$ \\sigma_D(z) = \\frac{iA\\Gamma}{z+i\\Gamma} $$\n    该函数按要求在上半平面是解析的。其在实数频率下的虚部是：\n    $$ \\operatorname{Im}\\sigma_D(\\omega) = \\operatorname{Im}\\left[\\frac{A\\Gamma^2+iA\\Gamma\\omega}{\\omega^2+\\Gamma^2}\\right] = A\\,\\frac{\\Gamma\\omega}{\\omega^2+\\Gamma^2} $$\n\n2.  **类Lorentz项：**\n    我们寻求一个在上半平面解析的函数 $\\sigma_L(z)$，使其在实轴上的实部为 $\\sigma_{1,L}(\\omega)$。标准的因果电导率的洛伦兹模型形式为 $\\sigma_L(z) = \\frac{-i C z}{\\omega_0^2 - z^2 - i\\gamma z}$，其中 $C$ 是一个实常数。该函数在上半平面是解析的，因为其极点位于下半平面。对于实数频率 $z=\\omega$，我们计算其实部：\n    $$ \\sigma_L(\\omega) = \\frac{-iC\\omega}{(\\omega_0^2-\\omega^2)-i\\gamma\\omega} = \\frac{-iC\\omega [(\\omega_0^2-\\omega^2)+i\\gamma\\omega]}{(\\omega_0^2-\\omega^2)^2+(\\gamma\\omega)^2} = \\frac{C\\gamma\\omega^2 - iC\\omega(\\omega_0^2-\\omega^2)}{(\\omega_0^2-\\omega^2)^2+(\\gamma\\omega)^2} $$\n    其实部为 $\\operatorname{Re}\\sigma_L(\\omega) = \\frac{C\\gamma\\omega^2}{(\\omega_0^2-\\omega^2)^2+(\\gamma\\omega)^2}$。\n    将此与问题中给出的项 $\\sigma_{1,L}(\\omega) = B\\,\\frac{\\gamma\\,\\omega^{2}}{\\left(\\omega_{0}^{2}-\\omega^{2}\\right)^{2}+(\\gamma\\,\\omega)^{2}}$ 进行比较，我们确定常数 $C=B$。\n    因此，完整的复洛伦兹项为 $\\sigma_L(z) = \\frac{-i B z}{\\omega_0^2-z^2-i\\gamma z}$。其在实轴上的虚部为：\n    $$ \\operatorname{Im}\\sigma_L(\\omega) = \\operatorname{Im}\\left[\\frac{B\\gamma\\omega^2 - iB\\omega(\\omega_0^2-\\omega^2)}{(\\omega_0^2-\\omega^2)^2+(\\gamma\\omega)^2}\\right] = -B\\,\\frac{\\omega(\\omega_0^2-\\omega^2)}{(\\omega_0^2-\\omega^2)^2+(\\gamma\\omega)^2} $$\n\n3.  **总虚部：**\n    结合两项的结果：\n    $$ \\operatorname{Im}\\sigma(\\omega) = \\operatorname{Im}\\sigma_D(\\omega) + \\operatorname{Im}\\sigma_L(\\omega) = A\\,\\frac{\\Gamma\\omega}{\\omega^{2}+\\Gamma^{2}} - B\\,\\frac{\\omega\\left(\\omega_{0}^{2}-\\omega^{2}\\right)}{\\left(\\omega_{0}^{2}-\\omega^{2}\\right)^{2}+(\\gamma\\,\\omega)^{2}} $$\n    这可以重写为：\n    $$ \\operatorname{Im}\\sigma(\\omega) = A\\,\\frac{\\Gamma\\omega}{\\omega^{2}+\\Gamma^{2}} + B\\,\\frac{\\omega\\left(\\omega^{2}-\\omega_{0}^{2}\\right)}{\\left(\\omega_{0}^{2}-\\omega^{2}\\right)^{2}+(\\gamma\\,\\omega)^{2}} $$\n\n4.  **电导率f-求和规则：**\n    问题要求通过计算积分 $\\int_0^\\infty \\operatorname{Re}\\sigma(\\omega)d\\omega$ 来验证求和规则。该积分代表总振子强度。\n    $$ I = \\int_0^\\infty \\operatorname{Re}\\sigma(\\omega) \\, d\\omega = \\int_0^\\infty A\\,\\frac{\\Gamma^{2}}{\\omega^{2}+\\Gamma^{2}} \\, d\\omega + \\int_0^\\infty B\\,\\frac{\\gamma\\,\\omega^{2}}{\\left(\\omega_{0}^{2}-\\omega^{2}\\right)^{2}+(\\gamma\\,\\omega)^{2}} \\, d\\omega $$\n    第一个积分（Drude部分）是：\n    $$ I_D = A\\Gamma^2 \\int_0^\\infty \\frac{d\\omega}{\\omega^2+\\Gamma^2} = A\\Gamma^2 \\left[\\frac{1}{\\Gamma}\\arctan\\left(\\frac{\\omega}{\\Gamma}\\right)\\right]_0^\\infty = A\\Gamma^2 \\left(\\frac{\\pi}{2\\Gamma}\\right) = \\frac{\\pi A\\Gamma}{2} $$\n    第二个积分（Lorentz部分）是标准的。我们可以用围道积分来计算它。考虑整个复函数 $\\sigma_L(z) = \\frac{-iBz}{\\omega_0^2-z^2-i\\gamma z}$ 在上半平面的一个大半圆上的积分。由于 $\\sigma_L(z)$ 在上半平面解析，根据柯西定理有 $\\oint \\sigma_L(z)dz = 0$。\n    $$ \\int_{-\\infty}^\\infty \\sigma_L(\\omega) \\, d\\omega + \\int_{\\text{arc}} \\sigma_L(z) \\, dz = 0 $$\n    对于大的 $|z|$，$\\sigma_L(z) \\sim \\frac{-iBz}{-z^2} = \\frac{iB}{z}$。沿弧线的积分变为 $\\int_0^\\pi \\frac{iB}{Re^{i\\theta}} (iRe^{i\\theta} d\\theta) = \\int_0^\\pi (-B)d\\theta = -B\\pi$。\n    所以，$\\int_{-\\infty}^\\infty \\sigma_L(\\omega) d\\omega - B\\pi = 0$。取实部：\n    $$ \\int_{-\\infty}^\\infty \\operatorname{Re}\\sigma_L(\\omega) \\, d\\omega = B\\pi $$\n    由于 $\\operatorname{Re}\\sigma_L(\\omega)$ 是偶函数，从 $0$ 到 $\\infty$ 的积分是此值的一半：\n    $$ I_L = \\int_0^\\infty \\operatorname{Re}\\sigma_L(\\omega) \\, d\\omega = \\frac{\\pi B}{2} $$\n    总积分是两部分贡献之和：\n    $$ \\int_0^\\infty \\operatorname{Re}\\sigma(\\omega) \\, d\\omega = I_D + I_L = \\frac{\\pi A\\Gamma}{2} + \\frac{\\pi B}{2} = \\frac{\\pi}{2}(A\\Gamma+B) $$\n    这个结果与f-求和规则一致，其中积分与总载流子密度成正比。$A\\Gamma$ 与自由载流子（Drude模型）的密度成正比，而 $B$ 与束缚载流子（Lorentz模型）的密度成正比。验证成功。题目要求的最终答案是 $\\operatorname{Im}\\sigma(\\omega)$ 的表达式。", "answer": "$$ \\boxed{ A\\,\\frac{\\Gamma\\omega}{\\omega^{2}+\\Gamma^{2}} + B\\,\\frac{\\omega\\left(\\omega^{2}-\\omega_{0}^{2}\\right)}{\\left(\\omega_{0}^{2}-\\omega^{2}\\right)^{2}+(\\gamma\\,\\omega)^{2}} } $$", "id": "2998540"}, {"introduction": "这最后一个高级实践旨在搭建解析理论与现代计算物理学之间的桥梁。你将探索虚（松原）频率轴上响应函数的高频行为与其谱函数矩（由求和规则支配）之间的关系。该练习的高潮在于设计一种能够明确执行这些求和规则的解析延拓数值算法，这是量子多体理论中的一项关键技术。[@problem_id:2998528]", "problem": "给定一个具有谱表示的因果标量响应函数。设 $A(\\omega)$ 是一个在大的 $|\\omega|$ 下衰减足够快的实谱密度。相关的响应 $\\chi(z)$ 在实轴之外是解析的，并接受柯西型表示\n$$\n\\chi(z) = \\int_{-\\infty}^{\\infty} \\frac{A(\\omega')}{\\omega' - z}\\, d\\omega' \\, ,\n$$\n这可由因果性和 Kramers-Kronig 关系推得。在虚轴上，松原数据是在一系列虚频率 $i\\omega_n$ 处的 $\\chi(i\\omega_n)$。\n\n您的任务是：\n\n1) 从第一性原理推导 $\\chi(i\\omega_n)$ 在大 $|\\omega_n|$ 下的行为如何编码谱密度的矩 $M_k = \\int_{-\\infty}^{\\infty} \\omega^k A(\\omega)\\, d\\omega$。具体而言，利用因果性所蕴含的解析结构，得到 $\\chi(i\\omega_n)$ 以 $1/(i\\omega_n)$ 的幂次展开的渐近展开式，并确定如何从前导项中提取 $M_0$ 和 $M_1$。通过在高频窗口上对 $\\chi(i\\omega_n)$ 的适当组合进行平均，从一组有限的大 $|\\omega_n|$ 值中实现 $M_0$ 和 $M_1$ 的数值估计器。\n\n2) 设计一种构造性方法，通过将 $A(\\omega)$ 表示为箱式基函数的非参数线性组合，在解析延拓中强制执行给定的求和规则。设 $\\{\\phi_j(\\omega)\\}_{j=1}^{N_b}$ 为箱式函数，它们在不相交的区间 $[a_j,b_j]$ 上为常数，高度为 $1/\\Delta_j$（其中 $\\Delta_j=b_j-a_j$），在其他地方为零，因此 $\\int \\phi_j(\\omega)\\,d\\omega = 1$。表示\n$$\nA(\\omega) = \\sum_{j=1}^{N_b} w_j \\phi_j(\\omega) \\, .\n$$\n证明松原数据对于权重 $w_j$ 是线性的，其核为\n$$\nK_{nj} = \\int_{-\\infty}^{\\infty} \\frac{\\phi_j(\\omega)}{\\omega - i\\omega_n}\\, d\\omega = \\frac{1}{\\Delta_j}\\,\\log\\!\\left(\\frac{b_j - i\\omega_n}{a_j - i\\omega_n}\\right) \\, ,\n$$\n并且矩是线性约束 $M_0 = \\sum_j w_j$ 和 $M_1 = \\sum_j w_j\\, \\frac{a_j+b_j}{2}$。构造一个 $w$ 的最小二乘解，该解在满足强制执行求和规则 $\\sum_j w_j = M_0$ 和 $\\sum_j w_j\\frac{a_j+b_j}{2}=M_1$ 的线性等式约束条件下，最小化 $\\sum_n \\left|\\sum_j K_{nj} w_j - \\chi(i\\omega_n)\\right|^2$。\n\n3) 按如下方式在程序中实现上述内容。所有量都是无单位的。使用下面给出的精确谱数据，通过 $\\chi(i\\omega_n)$ 的积分公式生成无噪声的松原数据，使用高频窗口从渐近展开中估计 $M_0$ 和 $M_1$，然后对 $w$ 进行无约束和有约束的最小二乘拟合。最后，计算下面要求的诊断指标。\n\n您可以使用的基本出发点：因果性意味着上半平面的解析性以及上述的 Kramers-Kronig 积分表示；对于固定的 $\\omega'$，当 $|\\omega'/z|<1$ 时，$1/(\\omega'-z)$ 在大 $|z|$ 下的展开是收敛的几何级数。\n\n测试套件：\n\n- 虚频率：使用 $T=1$ 和玻色子松原频率 $\\omega_n = 2\\pi n$，其中 $n\\ge 1$ 为整数。为 $n=1,\\dots,80$ 生成数据 $\\chi(i\\omega_n)$。使用高频窗口 $n=50,\\dots,80$ 进行矩估计。使用拟合窗口 $n=1,\\dots,60$ 进行最小二乘。\n\n- 解析延拓的基：使用一个均匀网格，包含 $N_b=120$ 个不相交的区间，覆盖 $[\\omega_{\\min},\\omega_{\\max}] = [-6.0,6.0]$，宽度相等 $\\Delta_j = 0.1$，因此 $a_j = -6.0 + 0.1\\,(j-1)$ 且 $b_j = a_j + 0.1$，对于 $j=1,\\dots,120$。\n\n- 三种情况的真实谱密度（每一项都是一个在 $[a,b]$ 上的箱，面积为 $\\alpha$，即在该区间上高度为 $\\alpha/\\Delta$，其他地方为零）：\n\n  1. 情况 A：一个箱，其 $(a,b,\\alpha) = (1.0, 2.0, 1.5)$。\n  \n  2. 情况 B：两个箱，其 $(a_1,b_1,\\alpha_1) = (-3.0, -1.0, 1.2)$ 和 $(a_2,b_2,\\alpha_2) = (2.0, 3.5, 0.8)$。\n  \n  3. 情况 C：两个对称箱，其 $(a_1,b_1,\\alpha_1) = (-4.0, -2.0, 1.0)$ 和 $(a_2,b_2,\\alpha_2) = (2.0, 4.0, 1.0)$。\n\n对于每种情况：\n\n- 通过对解析的箱贡献求和来生成精确的 $\\chi(i\\omega_n)$ 数据：\n$$\n\\chi(i\\omega_n) = \\sum_{\\ell} \\frac{\\alpha_\\ell}{\\Delta_\\ell} \\log\\!\\left(\\frac{b_\\ell - i\\omega_n}{a_\\ell - i\\omega_n}\\right) \\, .\n$$\n\n- 计算真实矩 $M_0 = \\sum_\\ell \\alpha_\\ell$ 和 $M_1 = \\sum_\\ell \\frac{\\alpha_\\ell}{\\Delta_\\ell}\\,\\frac{b_\\ell^2 - a_\\ell^2}{2}$。\n\n- 使用您的推导，通过在 $n=50,\\dots,80$ 上对适当的组合进行平均，从 $\\chi(i\\omega_n)$ 的大 $|\\omega_n|$ 渐近行为中估计 $\\widehat{M}_0$ 和 $\\widehat{M}_1$。\n\n- 为 $n=1,\\dots,60$ 构建核 $K_{nj}$ 和两个求和规则的约束矩阵，执行：\n  - 无约束最小二乘法以获得 $w^{\\mathrm{LS}}$。\n  - 带有两个线性等式约束的约束最小二乘法以获得 $w^{\\mathrm{cLS}}$。\n\n- 计算以下六个诊断指标：\n  - $e_0 = |\\widehat{M}_0 - M_0|$，\n  - $e_1 = |\\widehat{M}_1 - M_1|$，\n  - $r_{\\mathrm{LS}} = \\left(\\frac{1}{60}\\sum_{n=1}^{60} \\left|\\sum_j K_{nj} w^{\\mathrm{LS}}_j - \\chi(i\\omega_n)\\right|^2\\right)^{1/2}$，\n  - $r_{\\mathrm{cLS}} = \\left(\\frac{1}{60}\\sum_{n=1}^{60} \\left|\\sum_j K_{nj} w^{\\mathrm{cLS}}_j - \\chi(i\\omega_n)\\right|^2\\right)^{1/2}$，\n  - $d_0 = \\left|\\sum_j w^{\\mathrm{LS}}_j - M_0\\right|$，\n  - $d_1 = \\left|\\sum_j w^{\\mathrm{LS}}_j \\frac{a_j+b_j}{2} - M_1\\right|$.\n\n您的程序应生成单行输出，其中包含三种情况 A、B、C 的结果，按顺序串联成一个用方括号括起来的逗号分隔列表，即\n$[e_0^{(A)}, e_1^{(A)}, r_{\\mathrm{LS}}^{(A)}, r_{\\mathrm{cLS}}^{(A)}, d_0^{(A)}, d_1^{(A)}, e_0^{(B)}, e_1^{(B)}, r_{\\mathrm{LS}}^{(B)}, r_{\\mathrm{cLS}}^{(B)}, d_0^{(B)}, d_1^{(B)}, e_0^{(C)}, e_1^{(C)}, r_{\\mathrm{LS}}^{(C)}, r_{\\mathrm{cLS}}^{(C)}, d_0^{(C)}, d_1^{(C)}]$。\n所有量都是无单位的。输出的数字必须是浮点数。", "solution": "问题陈述已经过评估，被认为是有效的。它具有科学依据，是适定的、客观的且内部一致的。它提出了一个计算凝聚态物理中标准但非平凡的问题，涉及 Kramers-Kronig 关系、求和规则和数值解析延拓的应用。所有必要的参数和程序都已提供，以构建一个唯一且可验证的解决方案。\n\n该解决方案按问题陈述中描述的三个部分进行。\n\n### 1. 渐近展开和矩估计\n\n因果响应函数 $\\chi(z)$ 由谱表示给出：\n$$\n\\chi(z) = \\int_{-\\infty}^{\\infty} \\frac{A(\\omega')}{\\omega' - z}\\, d\\omega'\n$$\n其中 $A(\\omega')$ 是一个实谱密度，假设其在大的 $|\\omega'|$ 下衰减得足够快，以至于其矩 $M_k = \\int_{-\\infty}^{\\infty} (\\omega')^k A(\\omega')\\, d\\omega'$ 对于小的非负整数 $k$ 存在。我们感兴趣的是 $\\chi(z)$ 在 $z=i\\omega_n$ 且实数 $\\omega_n > 0$ 很大时的行为。\n\n积分的核可以在大 $|z|$ 时展开为几何级数：\n$$\n\\frac{1}{\\omega' - z} = \\frac{1}{-z(1 - \\omega'/z)} = -\\frac{1}{z} \\sum_{k=0}^{\\infty} \\left(\\frac{\\omega'}{z}\\right)^k\n$$\n当 $|\\omega'/z| < 1$ 时，此展开收敛。由于 $A(\\omega')$ 是局域的或快速衰减的，对于 $A(\\omega')$ 的任何给定支撑域，我们可以选择足够大的 $|z|$ 以确保一致收敛。\n\n将 $z=i\\omega_n$ 和级数展开式代入 $\\chi(z)$ 的积分中：\n$$\n\\chi(i\\omega_n) = \\int_{-\\infty}^{\\infty} A(\\omega') \\left( -\\frac{1}{i\\omega_n} \\sum_{k=0}^{\\infty} \\left(\\frac{\\omega'}{i\\omega_n}\\right)^k \\right) d\\omega'\n$$\n由于一致收敛，我们可以交换求和与积分的顺序：\n$$\n\\chi(i\\omega_n) = -\\sum_{k=0}^{\\infty} \\frac{1}{(i\\omega_n)^{k+1}} \\int_{-\\infty}^{\\infty} (\\omega')^k A(\\omega') d\\omega'\n$$\n识别出矩 $M_k$ 的定义，我们得到 $\\chi(i\\omega_n)$ 的渐近展开：\n$$\n\\chi(i\\omega_n) = -\\sum_{k=0}^{\\infty} \\frac{M_k}{(i\\omega_n)^{k+1}}\n$$\n让我们写出这个级数的前几项：\n$$\n\\chi(i\\omega_n) = -\\frac{M_0}{i\\omega_n} - \\frac{M_1}{(i\\omega_n)^2} - \\frac{M_2}{(i\\omega_n)^3} - \\dots\n$$\n利用恒等式 $1/i = -i$，我们可以分离实部和虚部：\n$$\n\\chi(i\\omega_n) = i\\frac{M_0}{\\omega_n} + \\frac{M_1}{\\omega_n^2} - i\\frac{M_2}{\\omega_n^3} - \\frac{M_3}{\\omega_n^4} + \\dots\n$$\n$$\n\\chi(i\\omega_n) = \\left( \\frac{M_1}{\\omega_n^2} - \\frac{M_3}{\\omega_n^4} + \\dots \\right) + i \\left( \\frac{M_0}{\\omega_n} - \\frac{M_2}{\\omega_n^3} + \\dots \\right)\n$$\n对于大的 $\\omega_n$，前导项占主导地位。因此，我们有以下渐近关系：\n$$\n\\mathrm{Re}[\\chi(i\\omega_n)] \\approx \\frac{M_1}{\\omega_n^2}\n$$\n$$\n\\mathrm{Im}[\\chi(i\\omega_n)] \\approx \\frac{M_0}{\\omega_n}\n$$\n这些关系提供了一种从高频松原数据直接估计矩 $M_0$ 和 $M_1$ 的方法：\n$$\nM_0 \\approx \\omega_n \\mathrm{Im}[\\chi(i\\omega_n)]\n$$\n$$\nM_1 \\approx \\omega_n^2 \\mathrm{Re}[\\chi(i\\omega_n)]\n$$\n为了从窗口 $[n_{\\min}, n_{\\max}]$ 内的一组有限的高频数据点 $\\{\\chi(i\\omega_n)\\}$ 获得一个鲁棒的数值估计器，我们可以在该窗口上对这些表达式进行平均：\n$$\n\\widehat{M}_0 = \\frac{1}{N_{\\text{win}}} \\sum_{n=n_{\\min}}^{n_{\\max}} \\omega_n \\mathrm{Im}[\\chi(i\\omega_n)]\n$$\n$$\n\\widehat{M}_1 = \\frac{1}{N_{\\text{win}}} \\sum_{n=n_{\\min}}^{n_{\\max}} \\omega_n^2 \\mathrm{Re}[\\chi(i\\omega_n)]\n$$\n其中 $N_{\\text{win}} = n_{\\max} - n_{\\min} + 1$ 是窗口中的点数。\n\n### 2. 解析延拓的约束最小二乘法\n\n我们将谱函数 $A(\\omega)$ 表示为 $N_b$ 个基函数的线性组合：\n$$\nA(\\omega) = \\sum_{j=1}^{N_b} w_j \\phi_j(\\omega)\n$$\n其中 $w_j$ 是实数权重，$\\{\\phi_j(\\omega)\\}$ 是箱式基函数。每个 $\\phi_j(\\omega)$ 在不相交的区间 $[a_j, b_j]$ 上的高度为 $1/\\Delta_j$，在其他地方为零，其中 $\\Delta_j = b_j - a_j$。这种归一化确保了 $\\int_{-\\infty}^{\\infty} \\phi_j(\\omega) d\\omega = 1$。\n\n将此表示代入 $\\chi(i\\omega_n)$ 的公式中：\n$$\n\\chi(i\\omega_n) = \\int_{-\\infty}^{\\infty} \\frac{\\sum_{j=1}^{N_b} w_j \\phi_j(\\omega')}{\\omega' - i\\omega_n} d\\omega' = \\sum_{j=1}^{N_b} w_j \\left( \\int_{-\\infty}^{\\infty} \\frac{\\phi_j(\\omega')}{\\omega' - i\\omega_n} d\\omega' \\right)\n$$\n这表明松原数据 $\\chi(i\\omega_n)$ 与权重 $w_j$ 是线性的。我们定义核矩阵 $K$，其元素为 $K_{nj}$：\n$$\nK_{nj} = \\int_{-\\infty}^{\\infty} \\frac{\\phi_j(\\omega')}{\\omega' - i\\omega_n} d\\omega' = \\int_{a_j}^{b_j} \\frac{1/\\Delta_j}{\\omega' - i\\omega_n} d\\omega' = \\frac{1}{\\Delta_j} \\left[ \\log(\\omega' - i\\omega_n) \\right]_{a_j}^{b_j}\n$$\n利用复对数的性质，这变成：\n$$\nK_{nj} = \\frac{1}{\\Delta_j} \\log\\left(\\frac{b_j - i\\omega_n}{a_j - i\\omega_n}\\right)\n$$\n该关系是一个线性方程组，$\\chi_n = \\sum_j K_{nj} w_j$，或矩阵形式为 $\\chi = Kw$。\n\n矩 $M_0$ 和 $M_1$ 也成为对权重 $w_j$ 的线性约束：\n$$\nM_0 = \\int_{-\\infty}^{\\infty} A(\\omega) d\\omega = \\sum_{j=1}^{N_b} w_j \\int_{-\\infty}^{\\infty} \\phi_j(\\omega) d\\omega = \\sum_{j=1}^{N_b} w_j\n$$\n$$\nM_1 = \\int_{-\\infty}^{\\infty} \\omega A(\\omega) d\\omega = \\sum_{j=1}^{N_b} w_j \\int_{-\\infty}^{\\infty} \\omega \\phi_j(\\omega) d\\omega\n$$\n一个基函数的一阶矩的积分为 $\\int_{a_j}^{b_j} \\omega (1/\\Delta_j) d\\omega = \\frac{1}{\\Delta_j} [\\omega^2/2]_{a_j}^{b_j} = \\frac{b_j^2 - a_j^2}{2\\Delta_j} = \\frac{a_j+b_j}{2}$。这产生了第二个约束：\n$$\nM_1 = \\sum_{j=1}^{N_b} w_j \\frac{a_j+b_j}{2}\n$$\n问题是找到实数权重向量 $w$，使其在满足线性等式约束 $M_0 = \\sum_j w_j$ 和 $M_1 = \\sum_{j} w_j (a_j+b_j)/2$ 的条件下，最小化平方残差 $\\|\\chi - Kw\\|^2_2$。这可以写成：\n$$\n\\text{最小化 } \\|Kw - \\chi\\|^2 \\quad \\text{约束条件} \\quad Cw = d\n$$\n其中 $w \\in \\mathbb{R}^{N_b}$, $K \\in \\mathbb{C}^{N_m \\times N_b}$, $\\chi \\in \\mathbb{C}^{N_m}$，且约束由以下给出\n$$\nC = \\begin{pmatrix} 1 & 1 & \\dots & 1 \\\\ \\frac{a_1+b_1}{2} & \\frac{a_2+b_2}{2} & \\dots & \\frac{a_{N_b}+b_{N_b}}{2} \\end{pmatrix} \\in \\mathbb{R}^{2 \\times N_b}, \\quad d = \\begin{pmatrix} M_0 \\\\ M_1 \\end{pmatrix} \\in \\mathbb{R}^2\n$$\n这是一个标准的等式约束最小二乘（LSE）问题。可以通过拉格朗日乘数法获得一个构造性解。这个问题的拉格朗日函数是：\n$$\n\\mathcal{L}(w, \\lambda) = (Kw - \\chi)^{\\dagger}(Kw - \\chi) + 2\\lambda^T (Cw - d)\n$$\n其中 $\\lambda \\in \\mathbb{R}^2$ 是拉格朗日乘数向量。对实向量 $w$ 求梯度并令其为零，得到：\n$$\n\\nabla_w \\mathcal{L} = 2\\,\\mathrm{Re}(K^{\\dagger}K) w - 2\\,\\mathrm{Re}(K^{\\dagger}\\chi) + 2C^T\\lambda = 0\n$$\n$$\\implies \\mathrm{Re}(K^{\\dagger}K) w + C^T\\lambda = \\mathrm{Re}(K^{\\dagger}\\chi)$$\n将此与约束方程 $Cw=d$ 结合，得到一个关于 $(w, \\lambda)$ 的块状矩阵线性方程组：\n$$\n\\begin{pmatrix} \\mathrm{Re}(K^{\\dagger}K) & C^T \\\\ C & 0 \\end{pmatrix}\n\\begin{pmatrix} w \\\\ \\lambda \\end{pmatrix}\n=\n\\begin{pmatrix} \\mathrm{Re}(K^{\\dagger}\\chi) \\\\ d \\end{pmatrix}\n$$\n解这个 $(N_b+2) \\times (N_b+2)$ 的系统，即可得到解向量 $w^{\\mathrm{cLS}}$。无约束最小二乘解 $w^{\\mathrm{LS}}$ 是通过求解正规方程 $\\mathrm{Re}(K^{\\dagger}K) w = \\mathrm{Re}(K^{\\dagger}\\chi)$ 找到的，这等同于在没有约束的情况下最小化 $\\|Kw-\\chi\\|^2$。\n\n### 3. 实现与诊断\n\n该过程通过编程实现。对于三个测试用例中的每一个，我们执行以下步骤：\n1. 根据给定的箱参数 $(\\alpha_\\ell, a_\\ell, b_\\ell)$ 定义真实谱密度 $A(\\omega)$。\n2. 计算精确矩 $M_0 = \\sum_\\ell \\alpha_\\ell$ 和 $M_1 = \\sum_\\ell \\alpha_\\ell (a_\\ell+b_\\ell)/2$。\n3. 对于 $n=1, \\dots, 80$（其中 $\\omega_n = 2\\pi n$），使用箱求和的解析公式生成无噪声的松原数据 $\\chi(i\\omega_n)$。\n4. 如第 1 部分所述，通过在高频窗口 $n=50, \\dots, 80$ 上平均来估计矩 $\\widehat{M}_0$ 和 $\\widehat{M}_1$。\n5. 为拟合窗口 $n=1, \\dots, 60$ 和在 $[-6.0, 6.0]$ 上的 $N_b=120$ 个箱的基构建复核矩阵 $K_{nj}$。\n6. 通过最小化 $\\|Kw - \\chi\\|^2$ 来求解无约束权重 $w^{\\mathrm{LS}}$。\n7. 使用真实矩 $M_0, M_1$ 构建约束矩阵 $C$ 和向量 $d$。求解第 2 部分中导出的块状 KKT 系统以找到约束权重 $w^{\\mathrm{cLS}}$。\n8. 计算六个指定的诊断指标：$e_0 = |\\widehat{M}_0 - M_0|$, $e_1 = |\\widehat{M}_1 - M_1|$，拟合残差的均方根 $r_{\\mathrm{LS}}$ 和 $r_{\\mathrm{cLS}}$，以及无约束拟合的求和规则违背量 $d_0 = |\\sum_j w^{\\mathrm{LS}}_j - M_0|$ 和 $d_1 = |\\sum_j w^{\\mathrm{LS}}_j (a_j+b_j)/2 - M_1|$。\n\n这个全面的过程允许对从渐近行为估计矩的准确性以及在解析延拓问题中强制执行求和规则的有效性进行定量评估。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the multi-part problem of moment estimation and constrained\n    analytic continuation for three test cases.\n    \"\"\"\n    # Define test cases: list of (a, b, alpha) for boxes\n    test_cases = [\n        [  # Case A\n            (1.0, 2.0, 1.5)\n        ],\n        [  # Case B\n            (-3.0, -1.0, 1.2),\n            (2.0, 3.5, 0.8)\n        ],\n        [  # Case C\n            (-4.0, -2.0, 1.0),\n            (2.0, 4.0, 1.0)\n        ]\n    ]\n\n    # Global parameters\n    T = 1.0\n    N_total = 80\n    N_hf_start = 50\n    N_fit = 60\n    \n    n_vals = np.arange(1, N_total + 1)\n    wn_vals = 2 * np.pi * T * n_vals\n\n    # Basis set parameters\n    Nb = 120\n    omega_min = -6.0\n    omega_max = 6.0\n    delta_w = (omega_max - omega_min) / Nb\n    \n    # Basis box intervals (0-indexed)\n    a_j = omega_min + np.arange(Nb) * delta_w\n    b_j = a_j + delta_w\n    \n    all_results = []\n\n    for case_boxes in test_cases:\n        # --- 1. Generate True Data and Moments ---\n        \n        # True moments\n        M0_true = sum(alpha for a, b, alpha in case_boxes)\n        # M1 = sum( integral(w * alpha/delta) ) = sum( alpha/delta * (b^2-a^2)/2 ) = sum( alpha * (a+b)/2 )\n        M1_true = sum(alpha * (a + b) / 2.0 for a, b, alpha in case_boxes)\n\n        # Generate exact Matsubara data\n        chi_n = np.zeros(N_total, dtype=np.complex128)\n        for a, b, alpha in case_boxes:\n            delta_box = b - a\n            # Use complex log: log(z1) - log(z2) = log(z1/z2)\n            chi_n += (alpha / delta_box) * np.log((b - 1j * wn_vals) / (a - 1j * wn_vals))\n\n        # --- 2. Estimate Moments from High-Frequency Data ---\n        \n        hf_mask = (n_vals >= N_hf_start)\n        wn_hf = wn_vals[hf_mask]\n        chi_hf = chi_n[hf_mask]\n\n        M0_est = np.mean(wn_hf * chi_hf.imag)\n        M1_est = np.mean(wn_hf**2 * chi_hf.real)\n\n        # --- 3. Set up and Solve Least Squares Problems ---\n        \n        # Fitting window data\n        fit_mask = (n_vals = N_fit)\n        wn_fit = wn_vals[fit_mask]\n        chi_fit = chi_n[fit_mask]\n\n        # Build Kernel Matrix K\n        # K_nj = (1/delta_w) * log((b_j - i*w_n) / (a_j - i*w_n))\n        # Broadcasting: wn_fit[:, None] (N_fit x 1), a_j[None, :] (1 x Nb)\n        K = (1 / delta_w) * np.log(\n            (b_j[None, :] - 1j * wn_fit[:, None]) / \n            (a_j[None, :] - 1j * wn_fit[:, None])\n        )\n\n        # Unconstrained Least Squares\n        # To handle complex K and chi for real w, stack real and imaginary parts\n        K_tilde = np.vstack([K.real, K.imag])\n        chi_tilde = np.concatenate([chi_fit.real, chi_fit.imag])\n        w_ls, _, _, _ = np.linalg.lstsq(K_tilde, chi_tilde, rcond=None)\n\n        # Constrained Least Squares (LSE) via Lagrange Multipliers\n        # Constraint matrix C and vector d\n        C = np.zeros((2, Nb))\n        C[0, :] = 1.0  # Sum rule for M0\n        C[1, :] = (a_j + b_j) / 2.0  # Sum rule for M1\n        d = np.array([M0_true, M1_true])\n        \n        # Build and solve the KKT system\n        # (Re(K'K)  C.T) (w) = (Re(K'chi))\n        # (C         0  ) (l) = (d        )\n        K_dag_K = K.T.conj() @ K\n        K_dag_chi = K.T.conj() @ chi_fit\n        \n        A_block = K_dag_K.real\n        b_vec = K_dag_chi.real\n        \n        LHS_matrix = np.block([\n            [A_block, C.T],\n            [C, np.zeros((2, 2))]\n        ])\n        RHS_vector = np.concatenate([b_vec, d])\n        \n        solution = np.linalg.solve(LHS_matrix, RHS_vector)\n        w_cls = solution[:Nb]\n\n        # --- 4. Compute Diagnostic Metrics ---\n        \n        e0 = np.abs(M0_est - M0_true)\n        e1 = np.abs(M1_est - M1_true)\n\n        res_ls = K @ w_ls - chi_fit\n        r_ls = np.sqrt(np.mean(np.abs(res_ls)**2))\n        \n        res_cls = K @ w_cls - chi_fit\n        r_cls = np.sqrt(np.mean(np.abs(res_cls)**2))\n\n        M0_ls = np.sum(w_ls)\n        M1_ls = np.sum(w_ls * C[1, :])\n        d0 = np.abs(M0_ls - M0_true)\n        d1 = np.abs(M1_ls - M1_true)\n\n        case_results = [e0, e1, r_ls, r_cls, d0, d1]\n        all_results.extend(case_results)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "2998528"}]}