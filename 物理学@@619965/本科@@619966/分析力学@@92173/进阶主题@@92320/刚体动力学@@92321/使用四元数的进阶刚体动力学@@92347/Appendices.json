{"hands_on_practices": [{"introduction": "这一首个练习是基础性的。我们将探讨刚体姿态（由一个时变四元数 $q(t)$ 描述）与其在体坐标系中的角速度 $\\vec{\\omega}_B$ 之间的直接关系。这个练习将巩固你对四元数运动学方程的理解，这是分析任何旋转运动的基石。[@problem_id:2031381]", "problem": "一颗小型卫星正在执行一个预编程的姿态机动。其在空间中的姿态，相对于一个固定惯性参考系，由一个随时间变化的单位四元数 $q(t) = q_s(t) + q_1(t)\\mathbf{i} + q_2(t)\\mathbf{j} + q_3(t)\\mathbf{k}$ 描述。单位四元数是用于表示旋转的一种数学对象，其中 $q_s$ 是标量部分，$(q_1, q_2, q_3)$ 是矢量部分，且各分量满足条件 $q_s(t)^2 + q_1(t)^2 + q_2(t)^2 + q_3(t)^2 = 1$。\n\n卫星姿态四元数的分量由以下关于时间 $t$ (单位为秒) 的函数给出：\n$$q_s(t) = \\cos\\left(\\frac{\\beta t^2}{2}\\right)\\cos\\left(\\frac{\\alpha t}{2}\\right)$$\n$$q_1(t) = \\cos\\left(\\frac{\\beta t^2}{2}\\right)\\sin\\left(\\frac{\\alpha t}{2}\\right)$$\n$$q_2(t) = \\sin\\left(\\frac{\\beta t^2}{2}\\right)\\sin\\left(\\frac{\\alpha t}{2}\\right)$$\n$$q_3(t) = \\sin\\left(\\frac{\\beta t^2}{2}\\right)\\cos\\left(\\frac{\\alpha t}{2}\\right)$$\n该机动由常数 $\\alpha = 0.50 \\text{ rad/s}$ 和 $\\beta = 0.10 \\text{ rad/s}^2$ 定义。\n\n确定在 $t = 2.0$ s 时刻，卫星在其自身体固参考系中测量的角速度矢量 $\\vec{\\omega}_B$ 的三个分量 $(\\omega_x, \\omega_y, \\omega_z)$。\n\n答案以三个分量的数值形式，并按指定顺序 $(\\omega_x, \\omega_y, \\omega_z)$ 给出。所有分量的单位必须是 rad/s。将最终答案四舍五入到三位有效数字。", "solution": "设 $q(t) = [q_{s}(t), q_{1}(t), q_{2}(t), q_{3}(t)]$ 是一个单位四元数，其标量部分为 $q_{s}$，矢量部分为 $q_{v} = (q_{1}, q_{2}, q_{3})$。使用关于体角速度的标准四元数运动学，其关系为\n$$\n\\dot{q} = \\frac{1}{2}\\, q \\otimes [0,\\vec{\\omega}_{B}]\n$$\n因此\n$$\n\\vec{\\omega}_{B} = 2\\,\\text{vec}\\!\\left(q^{*} \\otimes \\dot{q}\\right)\n$$\n其中 $q^{*}$ 是 $q$ 的四元数共轭，$\\text{vec}(\\cdot)$ 提取矢量部分。\n\n引入简写\n$$\nA(t) = \\frac{\\alpha t}{2}, \\quad B(t) = \\frac{\\beta t^{2}}{2}, \\quad A' = \\frac{\\alpha}{2}, \\quad B' = \\beta t\n$$\n并定义 $cA = \\cos A$, $sA = \\sin A$, $cB = \\cos B$, $sB = \\sin B$。给定的四元数分量为\n$$\nq_{s} = cB\\,cA,\\quad q_{1} = cB\\,sA,\\quad q_{2} = sB\\,sA,\\quad q_{3} = sB\\,cA.\n$$\n该四元数可以分解为两个基本旋转的乘积：\n$$\nq(t) = q_{B}(t) \\otimes q_{A}(t), \\quad q_{A} = [\\cos A,\\, \\sin A\\,\\mathbf{i}], \\quad q_{B} = [\\cos B,\\, \\sin B\\,\\mathbf{k}]\n$$\n这可以通过直接的四元数乘法来验证。此处 $q_{A}$ 是绕体坐标系 $x$ 轴旋转角度 $2A = \\alpha t$ 的旋转（右因子），而 $q_{B}$ 是绕惯性坐标系 $z$ 轴旋转角度 $2B = \\beta t^{2}$ 的旋转（左因子）。\n\n对乘积求导：\n$$\n\\dot{q} = \\dot{q}_{B} \\otimes q_{A} + q_{B} \\otimes \\dot{q}_{A}.\n$$\n对每个因子使用运动学关系式，\n$$\n\\dot{q}_{A} = \\frac{1}{2}\\,q_{A}\\otimes[0,\\alpha\\,\\mathbf{e}_{x}], \\qquad\n\\dot{q}_{B} = \\frac{1}{2}\\,[0, 2\\beta t\\,\\mathbf{e}_{z}]\\otimes q_{B}\n$$\n我们得到\n$$\n\\dot{q} = \\frac{1}{2}\\,[0, 2\\beta t\\,\\mathbf{e}_{z}]\\otimes q + \\frac{1}{2}\\,q\\otimes[0,\\alpha\\,\\mathbf{e}_{x}].\n$$\n对于任意单位四元数 $q$ 和惯性矢量 $\\mathbf{v}_{I}$，恒等式\n$$\n[0,\\mathbf{v}_{I}] \\otimes q = q \\otimes [0, R(q)^{T}\\mathbf{v}_{I}]\n$$\n成立，其中 $R(q)$ 将体坐标矢量映射到惯性坐标矢量。将此应用于第一项，得到\n$$\n\\dot{q} = \\frac{1}{2}\\,q\\otimes\\big[0,\\; \\alpha\\,\\mathbf{e}_{x} + 2\\beta t\\,R(q)^{T}\\mathbf{e}_{z}\\big].\n$$\n与 $\\dot{q} = \\frac{1}{2} q \\otimes [0,\\vec{\\omega}_{B}]$ 比较，得出\n$$\n\\vec{\\omega}_{B} = \\alpha\\,\\mathbf{e}_{x} + 2\\beta t\\,R(q)^{T}\\mathbf{e}_{z}.\n$$\n\n从 $q$ 计算 $R(q)^{T}\\mathbf{e}_{z}$。对于一个将体坐标映射到惯性坐标的单位四元数 $q = [q_{0},q_{1},q_{2},q_{3}]$，在体坐标系中表示的惯性 $z$ 轴是 $R(q)^{T}$ 的第三列，即，\n$$\nR(q)^{T}\\mathbf{e}_{z} =\n\\begin{pmatrix}\n2(q_{1}q_{3} - q_{0}q_{2}) \\\\[4pt]\n2(q_{2}q_{3} + q_{0}q_{1}) \\\\[4pt]\n1 - 2(q_{1}^{2} + q_{2}^{2})\n\\end{pmatrix}.\n$$\n代入 $q_{0}=cB cA$, $q_{1}=cB sA$, $q_{2}=sB sA$, $q_{3}=sB cA$ 得到\n$$\n2(q_{1}q_{3} - q_{0}q_{2}) = 2 cB sB (sA cA - cA sA) = 0,\n$$\n$$\n2(q_{2}q_{3} + q_{0}q_{1}) = 2(sB^{2} sA cA + cB^{2} cA sA) = 2 sA cA = \\sin(2A),\n$$\n$$\n1 - 2(q_{1}^{2} + q_{2}^{2}) = 1 - 2 sA^{2}(cB^{2} + sB^{2}) = 1 - 2 sA^{2} = \\cos(2A).\n$$\n因此\n$$\nR(q)^{T}\\mathbf{e}_{z} =\n\\begin{pmatrix}\n0 \\\\[2pt]\n\\sin(2A) \\\\[2pt]\n\\cos(2A)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 \\\\[2pt]\n\\sin(\\alpha t) \\\\[2pt]\n\\cos(\\alpha t)\n\\end{pmatrix}.\n$$\n因此，体角速度分量为\n$$\n\\vec{\\omega}_{B}(t) =\n\\begin{pmatrix}\n\\omega_{x} \\\\[2pt]\n\\omega_{y} \\\\[2pt]\n\\omega_{z}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\alpha \\\\[2pt]\n2\\beta t\\,\\sin(\\alpha t) \\\\[2pt]\n2\\beta t\\,\\cos(\\alpha t)\n\\end{pmatrix}.\n$$\n\n在 $t = 2.0$ s 时，$\\alpha = 0.50$ 且 $\\beta = 0.10$，\n$$\n\\alpha t = 1.0,\\quad 2\\beta t = 0.40,\n$$\n所以\n$$\n\\omega_{x} = 0.50,\\quad \\omega_{y} = 0.40\\,\\sin(1.0) \\approx 0.337,\\quad \\omega_{z} = 0.40\\,\\cos(1.0) \\approx 0.216,\n$$\n单位均为 rad/s，四舍五入到三位有效数字。", "answer": "$$\\boxed{\\begin{pmatrix} 0.500 \\\\ 0.337 \\\\ 0.216 \\end{pmatrix}}$$", "id": "2031381"}, {"introduction": "在运动学的基础上，这个练习深入到数值模拟的实际世界中。当通过积分运动学方程来预测物体姿态时，数值误差会累积，导致四元数的单位范数属性丧失。这个练习展示了这个关键问题，并强调了归一化对于维持模拟的物理和数学有效性的重要性。[@problem_id:2031365]", "problem": "在卫星姿态动力学的仿真中，其姿态由单位四元数 $q = q_w + q_x \\mathbf{i} + q_y \\mathbf{j} + q_z \\mathbf{k}$ 表示，也可表示为向量 $(q_w, q_x, q_y, q_z)$。四元数的演化遵循运动学方程 $\\dot{q} = \\frac{1}{2} q \\otimes \\omega_B$，其中 $\\omega_B$ 是纯四元数 $(0, \\omega_{Bx}, \\omega_{By}, \\omega_{Bz})$，表示卫星在其体坐标系中的角速度。对于两个四元数 $p=(p_w, \\vec{p})$ 和 $q=(q_w, \\vec{q})$，其四元数乘法定义为 $p \\otimes q = (p_w q_w - \\vec{p} \\cdot \\vec{q}, p_w \\vec{q} + q_w \\vec{p} + \\vec{p} \\times \\vec{q})$。\n\n考虑一颗卫星初始处于无旋转的参考姿态，对应的初始四元数为 $q(0) = (1, 0, 0, 0)$。在 $t=0$ 时，卫星受到一个在体坐标系下给出的恒定角速度 $\\vec{\\omega}_B = (0, 0, 0.5)$ rad/s。\n\n一位工程师使用简单的前向欧拉积分方案 $q_{k+1} = q_k + \\Delta t \\cdot \\dot{q}_k$ 对卫星的姿态进行仿真，总时间为 $T = 2.0$ s，时间步长为 $\\Delta t = 0.1$ s。然而，该工程师忽略了在每一步对四元数进行重新归一化，这是朴素实现中一个常见的误差来源。结果，计算出的四元数的模（其理想值应为1）将会发生漂移。\n\n设 $q_{final}$ 为从该仿真中在时间 $T$ 得到的非单位模四元数。计算其模的数值误差，定义为 $E = \\|q_{final}\\| - 1$。将最终答案四舍五入到四位有效数字。", "solution": "四元数运动学方程由下式给出\n$$\n\\dot{q}=\\frac{1}{2} q \\otimes \\omega_{B},\n$$\n其中 $\\omega_{B}=(0,0,0,\\omega)$ 且 $\\omega=0.5$。将 $q$写作 $q=(q_{w},q_{x},q_{y},q_{z})$ 并使用四元数乘法\n$$\nq \\otimes \\omega_{B}=\\left(-q_{z}\\omega,\\; q_{y}\\omega,\\; -q_{x}\\omega,\\; q_{w}\\omega\\right),\n$$\n我们得到分量形式的常微分方程组\n$$\n\\dot{q}_{w}=-\\frac{\\omega}{2}q_{z},\\quad \\dot{q}_{x}=\\frac{\\omega}{2}q_{y},\\quad \\dot{q}_{y}=-\\frac{\\omega}{2}q_{x},\\quad \\dot{q}_{z}=\\frac{\\omega}{2}q_{w}.\n$$\n对于初始条件 $q(0)=(1,0,0,0)$，使用步长为 $\\Delta t$ 的前向欧拉更新 $q_{k+1}=q_{k}+\\Delta t\\,\\dot{q}_{k}$ 可得\n$$\nq_{w,k+1}=q_{w,k}-a\\,q_{z,k},\\quad q_{x,k+1}=q_{x,k}+a\\,q_{y,k},\\quad q_{y,k+1}=q_{y,k}-a\\,q_{x,k},\\quad q_{z,k+1}=q_{z,k}+a\\,q_{w,k},\n$$\n其中 $a=\\frac{\\Delta t\\,\\omega}{2}$。因为 $q_{x,0}=q_{y,0}=0$，所以递推关系在所有 $k$ 下都保持 $q_{x,k}=q_{y,k}=0$，演化过程简化为\n$$\nq_{w,k+1}=q_{w,k}-a\\,q_{z,k},\\qquad q_{z,k+1}=q_{z,k}+a\\,q_{w,k}.\n$$\n定义 $s_{k}=q_{w,k}^{2}+q_{z,k}^{2}=\\|q_{k}\\|^{2}$。则\n$$\ns_{k+1}=(q_{w,k}-a q_{z,k})^{2}+(q_{z,k}+a q_{w,k})^{2}=(1+a^{2})(q_{w,k}^{2}+q_{z,k}^{2})=(1+a^{2})s_{k}.\n$$\n由于 $s_{0}=1$，经过 $n$ 步后我们有\n$$\ns_{n}=(1+a^{2})^{n}\\quad\\Rightarrow\\quad \\|q_{n}\\|=(1+a^{2})^{\\frac{n}{2}}.\n$$\n在总时间 $T$ 和步长 $\\Delta t$ 下，步数为 $n=\\frac{T}{\\Delta t}$。因此模误差为\n$$\nE=\\|q_{n}\\|-1=(1+a^{2})^{\\frac{n}{2}}-1,\\qquad a=\\frac{\\Delta t\\,\\omega}{2},\\quad n=\\frac{T}{\\Delta t}.\n$$\n代入 $\\omega=0.5$、$\\Delta t=0.1$ 和 $T=2.0$ 可得\n$$\na=\\frac{0.1\\times 0.5}{2}=0.025,\\quad n=20,\\quad E=(1+0.025^{2})^{10}-1=(1+0.000625)^{10}-1.\n$$\n使用二项式展开并忽略高阶项，\n$$\n(1+0.000625)^{10}\\approx 1+10(0.000625)+45(0.000625)^{2}+120(0.000625)^{3}=1.006267607421875,\n$$\n所以\n$$\nE\\approx 0.006267607421875.\n$$\n四舍五入到四位有效数字，得到 $E=0.006268$。", "answer": "$$\\boxed{0.006268}$$", "id": "2031365"}, {"introduction": "我们最后的练习将运动学与动力学联系起来，解决一个姿态控制中的常见问题。我们将不再从力来预测运动，而是计算使航天器遵循预定姿态路径（SLERP 轨迹）所需的控制力矩。这个练习要求你将欧拉运动方程与四元数运动学结合使用，以理解如何主动控制刚体的姿态。[@problem_id:2031398]", "problem": "一艘航天器，被建模为一个刚体，正通过其姿态控制系统进行重新定向。在其与主轴 $(\\hat{e}_1, \\hat{e}_2, \\hat{e}_3)$ 对齐的体坐标系中，主转动惯量为 $I_1 = I_0$，$I_2 = 2I_0$ 和 $I_3 = 3I_0$，其中 $I_0$ 为某个常数。\n\n航天器的姿态由单位四元数 $q = w + x\\mathbf{i} + y\\mathbf{j} + z\\mathbf{k}$ 表示。重定向机动总共耗时 $T$。$t=0$ 时的初始姿态由单位四元数 $q_0 = 1$ 给出。$t=T$ 时的目标姿态为 $q_f = \\frac{1}{\\sqrt{2}} + \\frac{1}{2}\\mathbf{i} + \\frac{1}{2}\\mathbf{j}$。\n\n姿态路径 $q(t)$ 被规定遵循一种特定类型的球面线性插值（SLERP），其公式定义为：\n$$\nq(t) = q_0 \\left(q_0^{-1} q_f\\right)^{t/T}\n$$\n对于 $t \\in [0, T]$。\n\n确定控制系统为实现此运动必须施加的时变力矩矢量 $\\vec{\\tau}(t) = (\\tau_1, \\tau_2, \\tau_3)$。力矩应在航天器的体坐标系中表示。您的答案应为一个用常数 $I_0$ 和 $T$ 表示的矢量表达式。", "solution": "我们在体坐标系中使用四元数运动学和刚体动力学。规定的球面线性插值（SLERP）为\n$$\nq(t) = q_{0} \\left(q_{0}^{-1} q_{f}\\right)^{t/T}.\n$$\n当 $q_{0}=1$ 时，这变为\n$$\nq(t) = \\left(q_{f}\\right)^{t/T} = \\exp\\!\\left(\\frac{t}{T}\\,\\ln q_{f}\\right).\n$$\n对于单位四元数，体坐标系中的运动学关系为\n$$\n\\dot{q} = \\frac{1}{2}\\,q \\otimes (0,\\boldsymbol{\\omega}),\n$$\n其中 $\\boldsymbol{\\omega}$ 是在体坐标系中表示的角速度，而 $(0,\\boldsymbol{\\omega})$ 是对应的纯虚四元数。对 $q(t)$ 求导得到\n$$\n\\dot{q}(t) = \\frac{1}{T}\\,q(t)\\otimes \\ln q_{f}.\n$$\n与运动学方程进行比对，我们得到\n$$\n(0,\\boldsymbol{\\omega}) = \\frac{2}{T}\\,\\ln q_{f},\n$$\n因此 $\\boldsymbol{\\omega}$ 是不随时间变化的常数，等于\n$$\n\\boldsymbol{\\omega} = \\frac{2}{T}\\,\\mathrm{vect}\\!\\left(\\ln q_{f}\\right).\n$$\n\n接下来，计算 $\\ln q_{f}$。设 $q_{f} = w + \\mathbf{v}$，其中 $w=\\frac{1}{\\sqrt{2}}$ 且 $\\mathbf{v}=\\left(\\frac{1}{2},\\frac{1}{2},0\\right)$。对于单位四元数，$w=\\cos(\\theta/2)$，$|\\mathbf{v}|=\\sin(\\theta/2)$，轴 $\\hat{\\mathbf{u}}=\\mathbf{v}/|\\mathbf{v}|$，并且\n$$\n\\ln q_{f} = \\left(0,\\hat{\\mathbf{u}}\\,\\frac{\\theta}{2}\\right).\n$$\n这里 $|\\mathbf{v}|=\\sqrt{\\frac{1}{2}}=\\frac{1}{\\sqrt{2}}$ 且 $w=\\frac{1}{\\sqrt{2}}$，因此 $\\theta = 2\\,\\arctan2\\!\\left(|\\mathbf{v}|,w\\right) = \\frac{\\pi}{2}$ 且\n$$\n\\hat{\\mathbf{u}} = \\frac{\\left(\\frac{1}{2},\\frac{1}{2},0\\right)}{\\frac{1}{\\sqrt{2}}} = \\left(\\frac{1}{\\sqrt{2}},\\frac{1}{\\sqrt{2}},0\\right).\n$$\n因此\n$$\n\\ln q_{f} = \\left(0,\\hat{\\mathbf{u}}\\,\\frac{\\theta}{2}\\right) = \\left(0,\\frac{\\pi}{4}\\left(\\frac{1}{\\sqrt{2}},\\frac{1}{\\sqrt{2}},0\\right)\\right).\n$$\n由此可知，恒定的体角速度为\n$$\n\\boldsymbol{\\omega} = \\frac{2}{T}\\,\\mathrm{vect}\\!\\left(\\ln q_{f}\\right) = \\frac{\\pi}{2T}\\left(\\frac{1}{\\sqrt{2}},\\frac{1}{\\sqrt{2}},0\\right) = \\left(\\frac{\\pi}{2\\sqrt{2}\\,T},\\frac{\\pi}{2\\sqrt{2}\\,T},0\\right).\n$$\n\n在与主轴对齐的体坐标系中，刚体动力学方程为\n$$\n\\boldsymbol{\\tau} = \\mathbf{I}\\,\\dot{\\boldsymbol{\\omega}} + \\boldsymbol{\\omega} \\times (\\mathbf{I}\\,\\boldsymbol{\\omega}),\n$$\n其中 $\\mathbf{I}=\\mathrm{diag}(I_{1},I_{2},I_{3})=\\mathrm{diag}(I_{0},2I_{0},3I_{0})$。因为 $\\boldsymbol{\\omega}$ 是常数，所以 $\\dot{\\boldsymbol{\\omega}}=\\mathbf{0}$，因此\n$$\n\\boldsymbol{\\tau} = \\boldsymbol{\\omega} \\times (\\mathbf{I}\\,\\boldsymbol{\\omega}).\n$$\n设 $a \\equiv \\frac{\\pi}{2\\sqrt{2}\\,T}$。则 $\\boldsymbol{\\omega}=(a,a,0)$ 且\n$$\n\\mathbf{I}\\,\\boldsymbol{\\omega} = (I_{0}a,\\,2I_{0}a,\\,0).\n$$\n因此\n$$\n\\boldsymbol{\\tau} = (a,a,0) \\times (I_{0}a,2I_{0}a,0) = \\left(0,\\,0,\\,a\\cdot 2I_{0}a - a\\cdot I_{0}a\\right) = \\left(0,0,I_{0}a^{2}\\right).\n$$\n代入 $a^{2} = \\left(\\frac{\\pi}{2\\sqrt{2}\\,T}\\right)^{2} = \\frac{\\pi^{2}}{8T^{2}}$，得到体坐标系中的恒定力矩矢量：\n$$\n\\boldsymbol{\\tau}(t) = \\left(0,\\,0,\\,\\frac{I_{0}\\pi^{2}}{8T^{2}}\\right).\n$$\n该力矩不随时间变化，且与 $\\hat{e}_{3}$ 对齐，提供了维持恒定体速率 SLERP 运动所需的陀螺力矩。", "answer": "$$\\boxed{\\begin{pmatrix} 0 \\\\ 0 \\\\ \\frac{I_{0}\\pi^{2}}{8T^{2}} \\end{pmatrix}}$$", "id": "2031398"}]}