{"hands_on_practices": [{"introduction": "在数字电路设计中，加法器的速度至关重要，而决定速度的关键因素是进位传播延迟。传统的行波进位加法器（RCA）虽然结构简单，但其延迟随位数线性增加，成为高性能计算的瓶颈。本练习将通过一个实际的比较，帮助我们量化分析进位跳跃加法器（CSA）的性能优势，并确定在何种规模下，采用更复杂的进位跳跃设计才开始具备明显的性能回报 [@problem_id:1919270]。", "problem": "一个数字设计团队正在评估两种用于定制处理器的不同$n$位加法器架构：一种是简单的行波进位加法器 (RCA)，另一种是更复杂的进位跳跃加法器 (CSA)。加法器的性能是通过其最坏情况传播延迟来衡量的，这是选择的主要标准。\n\n该团队已为其制造工艺确定了以下时序参数：\n- 单个1位全加器从进位输入到进位输出的传播延迟为 $t_{carry} = 0.8$ ns。\n- 单个1位全加器从进位输入到和输出的传播延迟为 $t_{sum} = 1.0$ ns。\n\n对于进位跳跃加法器，使用固定的 $k=4$ 位的块大小。因此，总位数 $n$ 必须是4的倍数。4位块的进位跳跃逻辑已被设计并确定了以下参数：\n- 一个进位信号旁路或“跳跃”一个4位块的传播延迟为 $t_{skip} = 1.2$ ns。\n\n一个$n$位RCA的最坏情况延迟是指，一个进位在最低有效位生成，并传播到最高有效位以产生最终和位所需的时间。$n$位CSA的最坏情况路径（有 $m=n/k$ 个块，其中 $m \\ge 2$）涉及一个进位在第一个块内行波传播，跳过中间的 $m-2$ 个块，最后在最后一个块内行波传播以产生最终和位所需的时间。\n\n确定最小的整数位宽 $n$，使得$n$位进位跳跃加法器的速度严格快于（即，具有更小的最坏情况传播延迟）$n$位行波进位加法器。", "solution": "设 $t_{carry}$ 为1位全加器从进位输入到进位输出的延迟， $t_{sum}$ 为1位全加器从进位输入到和输出的延迟， $t_{skip}$ 为进位跳跃加法器中每个$k$位块的跳跃延迟， $k=4$ 为固定块大小， $n$ 为总位宽（$k$的倍数）， $m=n/k$ 为块的数量。\n\n对于一个$n$位行波进位加法器 (RCA)，最坏情况延迟是进位传播通过 $n-1$ 级，然后产生最终的和：\n$$\nT_{\\mathrm{RCA}}(n) = (n-1)\\,t_{carry} + t_{sum}.\n$$\n\n对于有 $m\\ge 2$ 个块的$n$位进位跳跃加法器 (CSA)，最坏情况延迟路径是在第一个块内行波传播，跳过 $m-2$ 个中间块，然后在最后一个块内行波传播以产生最终的和。在第一个块内行波传播的延迟是 $k\\,t_{carry}$，跳过 $m-2$ 个块的延迟是 $(m-2)\\,t_{skip}$，在最后一个块内行波传播到最高有效和的延迟是 $(k-1)\\,t_{carry}+t_{sum}$。因此，\n$$\nT_{\\mathrm{CSA}}(n) = k\\,t_{carry} + (m-2)\\,t_{skip} + (k-1)\\,t_{carry} + t_{sum}\n= (2k-1)\\,t_{carry} + (m-2)\\,t_{skip} + t_{sum}.\n$$\n当 $m=\\frac{n}{k}$ 且 $k=4$ 时，\n$$\nT_{\\mathrm{CSA}}(n) = 7\\,t_{carry} + \\left(\\frac{n}{4}-2\\right)t_{skip} + t_{sum}.\n$$\n\n我们要求 $T_{\\mathrm{CSA}}(n) < T_{\\mathrm{RCA}}(n)$：\n$$\n7\\,t_{carry} + \\left(\\frac{n}{4}-2\\right)t_{skip} + t_{sum} < (n-1)\\,t_{carry} + t_{sum}.\n$$\n消去 $t_{sum}$ 并重新整理：\n$$\n(n-1)\\,t_{carry} - 7\\,t_{carry} > \\left(\\frac{n}{4}-2\\right)t_{skip}\n\\;\\;\\Longrightarrow\\;\\;\n(n-8)\\,t_{carry} > \\left(\\frac{n}{4}-2\\right)t_{skip} = \\frac{n-8}{4}\\,t_{skip}.\n$$\n对于 $m\\ge 2$，我们有 $n\\ge 8$。考虑以下情况：\n- 如果 $n=8$，则两边都为零，得到等式，而非严格不等式。\n- 如果 $n>8$，则 $n-8>0$，我们可以两边同除以 $n-8$ 得到\n$$\nt_{carry} > \\frac{1}{4}\\,t_{skip}.\n$$\n代入给定值 $t_{carry}=0.8$ ns 和 $t_{skip}=1.2$ ns，\n$$\n0.8 > \\frac{1}{4}\\cdot 1.2 = 0.3,\n$$\n此不等式成立。因此，对于每一个大于8且是4的倍数的 $n$，CSA都严格快于RCA。满足此条件的最小 $n$ （且 $m\\ge 2$）是 $n=12$。\n\n快速检验：\n$$\nT_{\\mathrm{CSA}}(12) = 7\\cdot 0.8 + 1\\cdot 1.2 + t_{sum} = 6.8 + t_{sum},\\quad\nT_{\\mathrm{RCA}}(12) = 11\\cdot 0.8 + t_{sum} = 8.8 + t_{sum},\n$$\n所以在 $n=12$ 时，CSA严格快于RCA。", "answer": "$$\\boxed{12}$$", "id": "1919270"}, {"introduction": "既然我们认识到进位跳跃加法器的潜力，下一个自然的问题就是如何优化其设计。块大小 $k$ 是一个关键的设计参数，它直接影响加法器的整体延迟，形成一种权衡：较小的 $k$ 意味着块内行波延迟短但需要跳过的块增多，而较大的 $k$ 则相反。此练习将引导我们探索一个更贴近实际的场景，其中块的跳跃延迟并非恒定，而是与块大小本身相关，我们将运用数学优化的方法来寻找最佳的统一块大小 $k_{opt}$ [@problem_id:1919267]。", "problem": "一位工程师正在设计一个64位的跳位进位加法器，他将该加法器划分为大小统一的块，块的大小记为 $k$。为了针对特定的现场可编程门阵列 (FPGA) 架构优化加法器的性能，采用了一个简化的最坏情况传播延迟 $T$ 的模型。该模型考虑了在单个块内进行行波进位所花费的时间与旁路块所花费的时间之间的权衡。\n\n总延迟 $T$ 可近似为以下两个分量的和：\n1.  进位在一个块内进行行波传播所需的最大时间，由 $k \\cdot t_r$ 给出，其中 $t_r$ 是一个常数，代表单个全加器的进位传播延迟。\n2.  信号传播通过所有块跳跃逻辑阶段的总时间。块的数量是 $N/k$，其中 $N=64$ 是总位数。这个累积的跳跃时间被建模为 $(N/k) \\cdot t_{skip}(k)$。\n\n每个块的跳跃延迟 $t_{skip}(k)$ 并非恒定。由于形成块传播信号的逻辑门的结构，该延迟取决于块的大小 $k$。对于目标技术，这种关系可以由非线性函数 $t_{skip}(k) = C\\sqrt{k}$ 精确建模，其中 $C$ 是一个由该技术的门电路特性决定的常数。\n\n确定能使总最坏情况传播延迟 $T$ 最小化的最优块大小 $k_{opt}$。请用 $N$、$t_r$ 和 $C$ 将答案表示为单个闭式解析表达式。", "solution": "我们将最坏情况传播延迟建模为\n$$\nT(k)=k\\,t_{r}+\\frac{N}{k}\\,t_{skip}(k),\n$$\n其中 $t_{skip}(k)=C\\sqrt{k}$。代入可得\n$$\nT(k)=k\\,t_{r}+\\frac{N}{k}\\,C\\sqrt{k}=k\\,t_{r}+N C\\,k^{-\\frac{1}{2}}.\n$$\n为了在 $k>0$ 的范围内最小化 $T(k)$，我们对 $k$ 求导，并将导数设为零：\n$$\n\\frac{dT}{dk}=t_{r}+N C\\,\\frac{d}{dk}\\!\\left(k^{-\\frac{1}{2}}\\right)=t_{r}-\\frac{1}{2}N C\\,k^{-\\frac{3}{2}}=0.\n$$\n求解 $k$：\n$$\nt_{r}=\\frac{1}{2}N C\\,k^{-\\frac{3}{2}}\n\\;\\;\\Longrightarrow\\;\\;\nk^{\\frac{3}{2}}=\\frac{N C}{2 t_{r}}\n\\;\\;\\Longrightarrow\\;\\;\nk=\\left(\\frac{N C}{2 t_{r}}\\right)^{\\frac{2}{3}}.\n$$\n二阶导数，\n$$\n\\frac{d^{2}T}{dk^{2}}=\\frac{3}{4}N C\\,k^{-\\frac{5}{2}}>0 \\quad \\text{for } k>0,\n$$\n证实了这是一个最小值。因此，最优块大小为\n$$\nk_{opt}=\\left(\\frac{N C}{2 t_{r}}\\right)^{\\frac{2}{3}}.\n$$", "answer": "$$\\boxed{\\left(\\frac{N C}{2 t_{r}}\\right)^{\\frac{2}{3}}}$$", "id": "1919267"}, {"introduction": "为了追求极致性能，设计师们发现采用非统一的块大小可以进一步优化进位跳跃加法器。其核心思想是，加法器中不同位置的进位传播路径重要性不同，因此可以针对性地调整块大小。此练习提供了一个结构化的设计挑战：通过平衡最长的块内行波延迟与跨越整个加法器的主要跳跃路径延迟，来设计一个具有对称但非统一块大小的32位加法器。这不仅是一个计算问题，更是一次深入理解延迟均衡原理的实践 [@problem_id:1919293]。", "problem": "一位电气工程师的任务是设计一个高性能的32位进位跳跃加法器。为优化加法器的速度，采用了不等长分组策略。该设计受到一系列特定的架构和时序约束。\n\n**物理与时序模型：**\n- 进位穿过单个全加器级的传播时间用 $t_{prop}$ 表示。\n- 进位“跳过”整个块所需的时间（假设组传播信号已准备好）用 $t_{skip}$ 表示。\n- 对于此特定工艺，已知 $t_{skip} = 2 t_{prop}$。\n\n**架构约束：**\n- 该32位加法器由总共 $M=6$ 个块构成。\n- 块大小关于加法器中心对称排列，遵循模式 $[k_1, k_2, k_3, k_3, k_2, k_1]$，其中 $k_i$ 是第 $i$ 个块的大小。\n- 设计必须使用正好三个不同的正整数块大小，记为 $S_A, S_B,$ 和 $S_C$，且排序为 $S_A < S_B < S_C$。\n\n**优化原则：**\n加法器中的最坏情况进位传播延迟需要被最小化。该最优值通过平衡两条关键延迟路径来实现：\n1.  **最大块内行波延迟 ($T_{ripple}$):** 进位穿过加法器中最大块的所有级所需的时间。穿过一个大小为 $k$ 的块的行波延迟时间为 $k \\cdot t_{prop}$。\n2.  **主跳跃路径延迟 ($T_{skip-path}$):** 从第一个块起始处产生的进位信号，穿过该块，跳过所有中间块，然后穿过最后一个块所需的时间。该延迟被建模为第一个块内的行波时间、跨越 $M-2$ 个中间块的跳跃时间以及最后一个块内的行波时间之和。\n\n你的任务是确定满足所有这些条件的三个整数块大小 $S_A, S_B,$ 和 $S_C$ 的值。请将答案表示为由这三个整数组成的行矩阵 $[S_A, S_B, S_C]$。", "solution": "我们用对称模式 $[k_{1},k_{2},k_{3},k_{3},k_{2},k_{1}]$ 表示这六个块的大小，其中有正好三个不同的正整数，按 $S_{A}<S_{B}<S_{C}$ 排序。根据对称性和排序，我们可以确定 $k_{1}=S_{A}$，$k_{2}=S_{B}$，以及 $k_{3}=S_{C}$。总位宽为 $32$ 位，因此\n$$\n2(k_{1}+k_{2}+k_{3})=32 \\quad \\Rightarrow \\quad k_{1}+k_{2}+k_{3}=16.\n$$\n\n相关的时序量如下：\n- 穿过大小为 $k$ 的块的行波时间：$k\\,t_{prop}$。\n- 跨越一个块的跳跃时间：$t_{skip}$，其中 $t_{skip}=2\\,t_{prop}$。\n\n通过平衡以下两项来最小化最坏情况延迟：\n1) 穿过最大块的最大块内行波延迟：\n$$\nT_{ripple}=k_{3}\\,t_{prop}.\n$$\n2) 从第一个块的输入到最后一个块的输出的主跳跃路径延迟，建模为穿过第一个块的行波延迟、跨越 $M-2=4$ 个中间块的跳跃延迟，以及穿过最后一个块的行波延迟：\n$$\nT_{skip\\text{-}path}=k_{1}\\,t_{prop}+4\\,t_{skip}+k_{1}\\,t_{prop}=2k_{1}\\,t_{prop}+8\\,t_{prop}.\n$$\n\n平衡这两条主导路径可得\n$$\nk_{3}\\,t_{prop}=2k_{1}\\,t_{prop}+8\\,t_{prop}\\quad \\Rightarrow \\quad k_{3}=2k_{1}+8.\n$$\n\n使用位宽约束来求解 $k_{2}$：\n$$\nk_{1}+k_{2}+k_{3}=16 \\;\\Rightarrow\\; k_{2}=16-k_{1}-k_{3}=16-k_{1}-(2k_{1}+8)=8-3k_{1}.\n$$\n\n对整数施加正数和严格排序约束 $k_{1}<k_{2}<k_{3}$：\n- $k_{2}>0 \\Rightarrow 8-3k_{1}>0 \\Rightarrow k_{1}\\leq 2$。\n- $k_{2}>k_{1} \\Rightarrow 8-3k_{1}>k_{1} \\Rightarrow 8>4k_{1} \\Rightarrow k_{1}<2$。\n\n因此，唯一可行的整数是 $k_{1}=1$。则\n$$\nk_{2}=8-3(1)=5,\\qquad k_{3}=2(1)+8=10,\n$$\n满足 $1<5<10$ 和 $1+5+10=16$。相应的延迟是平衡的：\n$$\nT_{ripple}=10\\,t_{prop},\\qquad T_{skip\\text{-}path}=2(1)\\,t_{prop}+8\\,t_{prop}=10\\,t_{prop}.\n$$\n\n因此，所需的不同块大小为 $S_{A}=1$，$S_{B}=5$ 和 $S_{C}=10$。", "answer": "$$\\boxed{\\begin{pmatrix}1 & 5 & 10\\end{pmatrix}}$$", "id": "1919293"}]}