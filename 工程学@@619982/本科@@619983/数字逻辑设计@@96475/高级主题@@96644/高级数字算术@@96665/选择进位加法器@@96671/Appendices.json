{"hands_on_practices": [{"introduction": "要真正理解选通进位加法器（Carry-Select Adder, CSLA）的设计理念，第一步是解构其基本组成。这个练习旨在帮助你可视化 CSLA 如何通过并行计算来预先处理可能的结果。通过清点一个特定设计中基本加法单元的数量，你将直接体会到其为速度所付出的硬件成本，从而对 CSLA 的空间换时间策略有一个具体的认识。[@problem_id:1919002]", "problem": "在一个定制处理器的设计中，为了优化速度，实现了一个12位进位选择加法器。该加法器由几个较小的4位行波进位加法器（RCA）模块构成。其架构如下：12位输入被划分为三个连续的4位段。第一个模块处理最低的4位（位0-3），它假设初始进位输入为0，直接计算其和与进位输出。对于随后的两个4位模块（分别处理位4-7和位8-11），每个模块都使用两个独立的4位RCA并行计算和与进位输出：一个假设来自前一级的进位输入为0，另一个则假设进位输入为1。然后，一个多路选择器会根据从前一级传播来的实际进位，为每个模块选择正确的结果。为了确定所需的总硬件资源，设计者需要计算基本构建块的数量。使用这种架构，计算一个12位结果总共需要执行多少次独立的4位RCA操作？", "solution": "这个12位进位选择加法器被划分为三个4位段。第一个4位模块（位0-3）使用一个4位RCA，其初始进位输入为0，因此贡献了一次4位RCA操作。接下来的两个4位模块（位4-7和位8-11）中的每一个都并行使用两个4位RCA，一个假设进位输入为0，另一个假设进位输入为1；两个计算都会执行，然后由一个多路选择器选择适当的结果，因此这些模块中的每一个都贡献了两次4位RCA操作。因此，执行的4位RCA操作总数为\n$$N_{\\text{RCA}}=1+2+2=5.$$", "answer": "$$\\boxed{5}$$", "id": "1919002"}, {"introduction": "理解了 CSLA 的结构之后，下一步是分析其性能优势。本练习将引导你计算决定加法器最高速度的关键路径延迟。通过追踪进位信号在不同级联的多路选择器（multiplexer）之间的传播路径，你将量化地理解为何选通进位结构相较于简单的行波进位加法器（Ripple-Carry Adder）能实现更快的运算速度。[@problem_id:1919043]", "problem": "一位数字系统工程师正在设计一个定制的 9 位算术逻辑单元，需要评估一个提出的加法器设计的性能。该设计是一个 9 位进位选择加法器，用于计算和 `S = A + B`，其中 `A = A[8:0]` 和 `B = B[8:0]` 是 9 位二进制数。\n\n该加法器的架构分为三个阶段，每个阶段处理 3 位：\n- **阶段 0 (第 2:0 位):** 此阶段由一个 3 位行波进位加法器 (RCA) 实现。该阶段的输入进位硬连线到逻辑 '0'。\n- **阶段 1 (第 5:3 位):** 此阶段采用两个并行的 3 位 RCA。第一个 RCA 假设其块级输入进位为 '0' 来计算和与输出进位。第二个 RCA 同时假设其块级输入进位为 '1' 来计算和与输出进位。然后，一组二选一多路复用器 (MUX) 根据阶段 0 产生的实际输出进位信号，选择正确的 3 位和以及正确的 1 位输出进位。\n- **阶段 2 (第 8:6 位):** 此阶段在结构上与阶段 1 相同。其选择 MUX 由阶段 1 产生的最终输出进位信号控制。\n\n用于构建该加法器的基本组件具有以下延迟特性：\n- 每个 3 位 RCA 由三个 1 位全加器 (FA) 构成。\n- 对于一个 1 位全加器，其任一输入 (A, B, Cin) 到其和输出的传播延迟为 `t_FA_sum = 2.4` ns。\n- 其任一输入 (A, B, Cin) 到其进位输出的传播延迟为 `t_FA_carry = 1.8` ns。\n- 一个二选一多路复用器的传播延迟，从其选择输入到其单位输出测量，为 `t_MUX = 0.9` ns。假定从 MUX 的数据输入端产生的延迟小于此值，且不在关键路径上。\n\n加法器的所有初始输入，即 `A` 和 `B` 的所有位，在时间 `t=0` 时均可用。计算加法器为最终的最高有效进位位（即阶段 2 的输出进位）产生稳定值所需的总时间。答案以纳秒 (ns) 为单位，并四舍五入到两位有效数字。", "solution": "我们确定，通往最终最高有效进位的关键路径是控制进位选择多路复用器的块级进位决策链，因为根据假设，MUX 从选择端到输出端的延迟主导了从数据输入端的延迟。\n\n已知：\n- 每个 3 位行波进位加法器 (RCA) 由三个串联的 1 位全加器构成。\n- 从任一 FA 输入到进位输出的延迟为 $t_{\\mathrm{FA,c}}=1.8$ ns。\n- 从 MUX 选择端到输出端的延迟为 $t_{\\mathrm{MUX}}=0.9$ ns。\n- 假定 MUX 数据输入延迟小于 $t_{\\mathrm{MUX}}$ 且不在关键路径上。\n\n阶段 0 (第 $[2:0]$ 位) 是一个 3 位 RCA，其输入进位固定为 $0$。从 $A[2:0],B[2:0]$ 到块输出进位的最坏情况延迟是三个 FA 进位传播延迟之和：\n$$\nt_{C0}=3\\,t_{\\mathrm{FA,c}}.\n$$\n阶段 1 (第 $[5:3]$ 位) 预先计算了块输入进位的两种可能性，并使用由 $C0$ 选择的 MUX。由于 MUX 的数据输入在时间 $3\\,t_{\\mathrm{FA,c}}$ 时就绪，而选择信号在 $t_{C0}$ 到达，因此阶段 1 的输出进位在 MUX 从选择端到输出端的延迟之后出现：\n$$\nt_{C1}=t_{C0}+t_{\\mathrm{MUX}}=3\\,t_{\\mathrm{FA,c}}+t_{\\mathrm{MUX}}.\n$$\n阶段 2 (第 $[8:6]$ 位) 与之相同，其 MUX 由 $C1$ 选择。它的两个预计算的候选进位在 $3\\,t_{\\mathrm{FA,c}}$ 时刻就绪，这个时间早于或等于选择信号的到达时间。因此，最终的输出进位在再增加一个 MUX 选择延迟后出现：\n$$\nt_{\\mathrm{final}}=t_{C1}+t_{\\mathrm{MUX}}=3\\,t_{\\mathrm{FA,c}}+2\\,t_{\\mathrm{MUX}}.\n$$\n代入给定的数值并化简：\n$$\nt_{\\mathrm{final}}=3\\cdot 1.8+2\\cdot 0.9=5.4+1.8=7.2\\ \\text{ns}.\n$$\n四舍五入到两位有效数字，结果仍为 $7.2$。", "answer": "$$\\boxed{7.2}$$", "id": "1919043"}, {"introduction": "我们已经知道 CSLA 的性能与块（block）的大小密切相关，但这引出了一个关键的设计问题：最佳的块大小是多少？这个进阶练习将让你扮演电路设计师的角色，去寻找最优的配置方案。你将推导出一个最小化总延迟的通用公式，这个过程不仅揭示了数字电路设计中一个普遍存在的权衡关系，也为你提供了优化算术逻辑单元的强大数学工具。[@problem_id:1919060]", "problem": "您是一名工程师，正在设计一个定制的算术逻辑单元（ALU），任务是优化一个N位进位选择加法器。该加法器通过将N个比特位划分为M个大小相等的块来构建，每个块为k位，其中N是k的倍数。\n\n其结构如下：\n- 第一个块（处理第0到k-1位）是一个标准的k位行波进位加法器（RCA）。\n- 每个后续的块（从第2块到第M块）由两个并行的k位RCA组成。一个RCA在假设进位输入为0的情况下计算和与进位输出，另一个则在假设进位输入为1的情况下进行同样的计算。然后，一组2-1多路选择器根据前一个块的实际进位输入，为该块选择正确的k个和位和单个进位输出位。\n\n假设有以下均匀的传播延迟：\n- 单个全加器（从任何输入到任何输出）的最坏情况传播延迟为 `t_{FA}`。\n- 设计中使用的任何2-1多路选择器的传播延迟为 `t_{MUX}`。\n- 所有主输入（`A_i`、`B_i` 和初始进位 `C_0`）在 `t=0` 时刻均可用。\n\n您的目标是找到一个最佳块大小 `k`，以最小化整个N位加法器的最坏情况传播延迟。为了进行此推导，您应将 `k` 视为一个连续实变量。请推导出一个关于 `N`、`t_{FA}` 和 `t_{MUX}` 的最佳块大小 `k` 的封闭形式表达式。", "solution": "假设将$N$位加法器划分为$M$个大小相等的块，每块$k$位，因此有$M = N/k$（其中$N$是$k$的倍数）。所有主输入在$t=0$时均可用。\n\n首先，我们来描述一个块内的延迟特性：\n- 一个$k$位行波进位加法器（RCA）从其输入到其进位输出和最高有效和位的最坏情况延迟为$k\\,t_{FA}$，因为进位必须在$k$个全加器中行波传递。\n\n现在，我们来追踪整个进位选择结构的最坏情况路径：\n- 第$1$块是一个单一的$k$位RCA。它的进位输出（以及其最高有效和）在以下时间准备就绪：\n$$\nT_{1} = k\\,t_{FA}.\n$$\n- 对于每个后续的块$j \\geq 2$，两个$k$位RCA预先计算假设进位输入为0和1时的结果。它们的输出（包括和与候选进位输出）在$k\\,t_{FA}$时刻准备就绪。第$j$块的实际输出由一组受前一块$j-1$实际进位输入控制的2-1多路选择器选出。因此，第$j$块的输出在以下时刻准备就绪：\n$$\nT_{j} = \\max\\!\\big(k\\,t_{FA},\\,T_{j-1}\\big) + t_{MUX}.\n$$\n由于$T_{1} = k\\,t_{FA}$，通过归纳法可得：\n$$\nT_{j} = k\\,t_{FA} + (j-1)\\,t_{MUX}, \\quad j = 1,2,\\dots,M.\n$$\n因此，这个$N$位加法器的总最坏情况延迟（即最后一个块$M$的延迟）为：\n$$\nT_{\\text{total}}(k) = T_{M} = k\\,t_{FA} + (M-1)\\,t_{MUX}.\n$$\n代入$M = N/k$得到：\n$$\nT_{\\text{total}}(k) = k\\,t_{FA} + \\left(\\frac{N}{k} - 1\\right)t_{MUX}.\n$$\n\n我们对$k>0$进行优化（将其视为连续变量）。定义：\n$$\ng(k) = k\\,t_{FA} + \\frac{N\\,t_{MUX}}{k},\n$$\n该函数与$T_{\\text{total}}(k)$仅相差一个常数偏移$-t_{MUX}$，这与优化无关。对其求导并令其等于零：\n$$\n\\frac{dg}{dk} = t_{FA} - \\frac{N\\,t_{MUX}}{k^{2}} = 0\n\\quad\\Longrightarrow\\quad\nk^{2} = \\frac{N\\,t_{MUX}}{t_{FA}}.\n$$\n因此驻点为：\n$$\nk^{*} = \\left(\\frac{N\\,t_{MUX}}{t_{FA}}\\right)^{\\frac{1}{2}}.\n$$\n二阶导数为：\n$$\n\\frac{d^{2}g}{dk^{2}} = \\frac{2N\\,t_{MUX}}{k^{3}} > 0\n$$\n这证明了该点为最小值点。因此，最佳块大小（在连续松弛的条件下）为：\n$$\nk_{\\text{opt}} = \\left(\\frac{N\\,t_{MUX}}{t_{FA}}\\right)^{\\frac{1}{2}}.\n$$", "answer": "$$\\boxed{\\left(\\frac{N\\,t_{MUX}}{t_{FA}}\\right)^{\\frac{1}{2}}}$$", "id": "1919060"}]}