{"hands_on_practices": [{"introduction": "学习如何构建最基础的硬件去抖动电路是处理机械开关噪声的第一步。这个练习将带你使用一个简单的 RC 低通滤波器来平滑电压信号的抖动。通过计算所需的电容值，你将亲身体验如何利用电路的基本物理原理 ($ \\tau = RC $) 来解决一个常见的数字逻辑设计问题 [@problem_id:1926770]。", "problem": "一位电子爱好者正在制作一个定制的街机摇杆。所使用的按钮是机械式的，并表现出一种称为“触点抖动”的现象，即激活开关时，其电触点会在稳定闭合之前反弹数次。这会产生一个噪声信号，可能被摇杆的数字控制器误解为多次快速的按钮按下。\n\n为了解决这个问题，为每个按钮实现了一个简单的硬件去抖电路。该电路由一个上拉电阻和一个电容器组成，构成一个电阻-电容 (RC) 低通滤波器。上拉电阻的阻值为 $R = 10.0 \\text{ k}\\Omega$。开关制造商的数据手册指出，触点抖动持续时间 $t_{bounce}$ 不会超过 $5.0 \\text{ ms}$。对于这类滤波器，一个可靠的工程准则是将其时间常数 $\\tau$ 设置为最大抖动持续时间的三倍以上，以确保电压波动被充分平滑，从而适应数字逻辑电路。\n\n根据指定的准则，计算构建此去抖电路所需的最小电容 $C$。将您的答案以微法拉 ($\\mu\\text{F}$) 为单位表示，并四舍五入到三位有效数字。", "solution": "RC 去抖电路的时间常数由物理关系 $\\tau = R C$ 定义。设计准则要求时间常数至少为最大抖动持续时间的三倍：\n$$\n\\tau \\geq 3\\,t_{\\text{bounce}}.\n$$\n结合这两个关系式，可得所需的电容：\n$$\nC \\geq \\frac{3\\,t_{\\text{bounce}}}{R}.\n$$\n代入以国际单位制（SI）表示的给定值，$t_{\\text{bounce}} = 5.0 \\times 10^{-3}\\ \\text{s}$ 和 $R = 10.0 \\times 10^{3}\\ \\Omega$：\n$$\nC_{\\min} = \\frac{3 \\times 5.0 \\times 10^{-3}}{10.0 \\times 10^{3}}\\ \\text{F} = \\frac{15.0 \\times 10^{-3}}{10.0 \\times 10^{3}}\\ \\text{F} = 1.5 \\times 10^{-6}\\ \\text{F}.\n$$\n转换为微法拉，$1.5 \\times 10^{-6}\\ \\text{F} = 1.50\\ \\mu\\text{F}$，四舍五入到三位有效数字。", "answer": "$$\\boxed{1.50}$$", "id": "1926770"}, {"introduction": "除了硬件滤波，我们还可以采用数字方法来解决开关抖动，这在微控制器和 FPGA 设计中尤为常见。这种同步去抖动技术通过在固定的时间间隔内对开关状态进行采样，并等待信号持续稳定一段时间后才确认其有效性。这个练习将帮助你量化这个“等待”过程，计算出确保可靠读数所需的最少稳定采样次数 [@problem_id:1926805]。", "problem": "在设计一款消费电子设备的数字接口时，使用了一个机械按钮作为主要输入。已知机械开关会表现出一种称为“触点抖动”的现象，即在按下或释放时，物理触点会在短时间内相互反弹，导致一系列快速、虚假的电信号跳变。为了滤除这种噪声并防止单次按钮按压产生多次错误输入，我们实现了一个同步去抖动电路。\n\n该电路在稳定系统时钟的每个上升沿采样开关的状态。只有当输入信号在一个新的、稳定的逻辑电平上保持至少若干个连续时钟周期时，状态变化才被认为是有效的。\n\n已知系统时钟频率为 $f_{clk} = 1 \\text{ kHz}$，所用特定型号按钮的最大指定触点抖动时间为 $t_{bounce} = 10 \\text{ ms}$，请确定去抖动电路为可靠地验证新的开关状态所必须记录的最小连续稳定采样次数 $N$（$N$为整数）。", "solution": "设系统时钟周期为 $T_{clk} = \\frac{1}{f_{clk}}$。如果电路需要 $N$ 次连续的稳定采样来验证新状态，那么从第一次到第 $N$ 次确认采样所经过的时间是 $(N-1)T_{clk}$（因为 $N$ 次采样之间有 $N-1$ 个采样间隔）。为保证在抖动时间完全结束之前不会发生验证，我们要求这段经过的时间至少等于最大抖动时间：\n$$\n(N-1)T_{clk} \\ge t_{bounce}.\n$$\n解出 $N$ 可得\n$$\nN \\ge 1 + \\frac{t_{bounce}}{T_{clk}} = 1 + t_{bounce} f_{clk}.\n$$\n因此，满足该要求的最小整数是\n$$\nN = \\left\\lceil 1 + t_{bounce} f_{clk} \\right\\rceil.\n$$\n代入 $f_{clk} = 1 \\times 10^{3}$ 和 $t_{bounce} = 10 \\times 10^{-3}$，\n$$\nt_{bounce} f_{clk} = 10 \\quad \\Rightarrow \\quad N = \\left\\lceil 1 + 10 \\right\\rceil = 11.\n$$", "answer": "$$\\boxed{11}$$", "id": "1926805"}, {"introduction": "掌握了同步采样的基本概念后，一个更深层次的设计问题是：为什么我们选择特定的逻辑元件？本练习通过一个假设情景，让你分析为何在采样电路中使用电平敏感的 D 锁存器（D-latch）会导致设计失败，而边沿触发的 D 触发器（D-flip-flop）却能成功。这不仅仅是一个选择题，更是一次对同步设计核心原则的深入思辨，有助于你理解在异步信号同步化过程中避免噪声传递的关键 [@problem_id:1926788]。", "problem": "一位工程师的任务是为一个使用机械式单刀双掷 (SPDT) 开关的控制面板设计一个鲁棒的数字输入系统。当拨动开关时，其内部触点会发生抖动，抖动持续时间最大为 $T_{bounce}$，在稳定到最终状态（逻辑 `0` 或逻辑 `1`）之前会产生一系列不必要的电脉冲。为了滤除这种噪声，提出了一种同步去抖动电路。\n\n这类电路的标准实现是使用一个上升沿触发的 D 型触发器来采样开关的状态。开关的输出连接到触发器的 D 输入，采样时钟连接到时钟输入。采样时钟的周期 $T_{clk}$ 被有意地设置为远大于 $T_{bounce}$。\n\n为了尝试使用更简单的逻辑元件，该工程师用一个电平敏感（透明）的 D 锁存器替换了边沿触发的 D 触发器。锁存器的 D 输入连接到开关，其门控（使能）输入连接到同一个采样时钟。这个 D 锁存器的配置是当时钟信号为 `HIGH` 时是透明的（即其输出 `Q` 跟随输入 `D`），而当时钟信号变为 `LOW` 时则锁存（保持）输入值。采样时钟的占空比为 50%。\n\n尽管时钟周期 $T_{clk}$ 远大于最大抖动持续时间 $T_{bounce}$，但使用 D 锁存器的新电路却无法产生一个持续干净、去抖动后的输出信号。下列哪个陈述最能描述这种失效的主要原因？\n\nA. 电路变得极易出现亚稳态，即锁存器的输出无限振荡或稳定在一个无效的电压电平上，因为抖动的输入信号在时钟下降沿附近违反了锁存器的建立时间和保持时间要求。\n\nB. 如果开关的拨动及其后续的抖动周期恰好发生在采样时钟为 `HIGH` 的时间区间内，那么来自开关的抖动脉冲会直接通过锁存器传播到其输出端。\n\nC. D 锁存器比 D 触发器消耗的静态功耗大得多，导致过热和热失控，从而损坏输出信号。\n\nD. 电路在第一次拨动开关时工作正常，但之后锁存器的输出会永久地卡在该状态，无法响应任何后续的开关拨动。\n\nE. 锁存器的内部逻辑总是会反转开关的稳定状态，导致去抖动后的输出与预期的开关位置在逻辑上相反。", "solution": "问题要求找出用 D 锁存器替换 D 触发器的同步去抖动电路的主要失效机制。让我们来分析正确设计和错误设计的行为。\n\n首先，让我们理解开关抖动现象。当一个机械开关被拨动时，物理触点并不会形成一个干净、单一的连接。相反，它们会在短时间内（`T_bounce`）相互反弹，导致电信号在 `HIGH` 和 `LOW` 之间快速交替，然后才稳定到其最终的稳定状态。去抖动电路的目标是忽略这些瞬态抖动，并产生一个单一、干净的状态转换。\n\n现在，我们来考虑使用上升沿触发的 D 型触发器的标准正确设计。这种类型的触发器是一个同步元件，它只在一个特定的瞬时时刻——时钟信号的上升沿——采样其 `D` 输入并将其传输到 `Q` 输出。然后，输出 `Q` 会在整个时钟周期内保持这个值，直到下一个上升沿到来。由于时钟周期 `T_{clk}` 远大于抖动持续时间 `T_{bounce}`，因此可以保证在下一个时钟沿到来时，开关信号已经稳定到其新的稳定值。因此，触发器采样到一个稳定、正确的值，其输出在整个时钟周期内保持干净和稳定，成功地滤除了抖动。\n\n接下来，我们分析使用电平敏感 D 锁存器的错误设计。D 锁存器的行为与 D 触发器不同。如问题所述，当锁存器的门控（使能）输入为 `HIGH` 时，它是透明的。“透明”意味着输出 `Q` 直接且连续地跟随输入 `D`。只有当门控输入变为 `LOW` 时，锁存器才会保持其值。占空比为 50% 的时钟信号连接到该门控输入。这意味着在时钟周期的一半时间，即 `T_{clk}/2` 内，锁存器处于透明模式。\n\n失效的原因就在于此。问题陈述 `T_{clk}` 远大于 `T_{bounce}`，但这并不排除抖动事件在任何特定时间发生。如果用户拨动开关，而整个抖动事件（持续时间为 `T_{bounce}`）恰好落在时钟为 `HIGH` 的 `T_{clk}/2` 时间区间内，那么锁存器将是透明的。在此期间，来自 `D` 输入端抖动开关的 `HIGH` 和 `LOW` 脉冲的快速序列将直接通过锁存器传递到 `Q` 输出端。因此，这个“去抖动器”的输出将与其输入一样充满噪声。该电路完全没有起到其滤除抖动的作用。这种情况恰好由选项 B 所描述。\n\n我们来评估一下其他选项：\n- A：虽然在同步器电路中，当建立/保持时间被违反时，亚稳态是一个真实存在的问题，但它不是这里主要的、最常见的失效模式。最直接和确定的失效是由于锁存器的透明性。在时钟的 `HIGH` 相位期间信号直接通过是一个必然的失效模式，而由特定的时序违规引起的亚稳态则是一个概率性事件。\n- C：锁存器和触发器之间的功耗差异通常不足以在此场景下引起热失控，这也不是一个主要的功能性失效。它是一个次要特性。\n- D：D 锁存器不会永久卡住。当时钟为 `HIGH` 时，它会跟随其输入。当时钟为 `LOW` 时，它会保持最后一个值，但在下一个周期它会再次更新。它不会永久卡住。\n- E：标准的 D 锁存器是一个非反相元件。它的 `Q` 输出反映的是 `D` 输入，而不是其反相。反相行为需要不同的电路配置。\n\n因此，主要且最根本的失效是锁存器的透明性，它允许抖动噪声在时钟为 `HIGH` 时通过。", "answer": "$$\\boxed{B}$$", "id": "1926788"}]}