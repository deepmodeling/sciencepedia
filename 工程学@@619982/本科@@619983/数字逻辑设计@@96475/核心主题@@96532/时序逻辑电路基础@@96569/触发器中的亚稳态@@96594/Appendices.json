{"hands_on_practices": [{"introduction": "我们如何在一个真实电路中“看到”亚稳态这个短暂的、概率性的状态？这个练习将向您介绍一种在实验室中非常实用的技术，即使用示波器的“余晖”模式。通过理解亚稳态在屏幕上留下的独特“特征”，您将对其模拟和时变的本质有一个更直观的把握。[@problem_id:1947264]", "problem": "一位数字系统工程师正在调试一个包含单个D型触发器的电路。已知数据输入（标记为`D`）相对于时钟输入`CLK`是异步的。为研究该电路在此条件下的行为，工程师将一个示波器探头连接到触发器的输出`Q`。示波器被设置为在`CLK`信号的上升沿触发，并启用了称为“无限余晖”的显示模式。此模式会使所有捕获的波形叠加在屏幕上，任何点的亮度对应于信号经过该点的频率。在电路运行几分钟后，工程师必须解读示波器屏幕上得到的图像。\n\n以下哪项关于示波器显示的文字描述，为触发器输出`Q`正在经历亚稳态提供了最明确的证据？\n\nA. 显示屏显示一个单一、清晰的方波，其频率恰好是`CLK`频率的一半。\n\nB. 显示屏显示两条明亮、实心的水平线，一条在逻辑'1'电压处，一条在逻辑'0'电压处。这些线之间的跳变是陡峭、垂直的，并精确地发生在触发时刻。\n\nC. 显示屏显示两条位于逻辑'1'和'0'电压处的明亮、实心水平线。在这两条线之间，从触发时刻附近开始，有一个明显的微弱、“发光”的轨迹区域，该区域水平延伸一段短暂且可变的持续时间。\n\nD. 显示屏显示一条位于逻辑'1'电压处的恒定、实心水平线，但这条线看起来粗壮而模糊，表明在'1'电平附近有快速、微小的电压波动。\n\nE. 显示屏显示一条单一、清晰的水平线，其电压电平大约在定义的逻辑'1'和'0'电压的中间位置。", "solution": "我们分析具有相对于时钟$CLK$为异步输入$D$的D型触发器。由于$D$是异步的，因此存在非零概率$D$在$CLK$上升沿附近的建立/保持时间窗口内发生跳变。当这种情况发生时，触发器可能进入亚稳态，其输出$Q$在恢复到稳定电平之前的一段随机时间内，既不是有效的逻辑'0'也不是有效的逻辑'1'。一个用于描述该恢复动态的标准模型是，输出电压会从不稳定的平衡点（判决阈值 $V_M$）以指数形式向某个稳定的逻辑电平解析。电压与 $V_M$ 的偏离程度会随时间呈指数增长，而其最终趋向于逻辑高还是逻辑低，则由噪声和器件不平衡等随机因素决定。亚稳态恢复时间$t_{\\text{res}}$的分布通常用指数尾部来建模；亚稳态持续时间超过某个值 $t$ 的概率可表示为：\n$$\n\\Pr(t_{\\text{res}} > t) \\propto e^{-t/\\tau}\n$$\n其中 $\\tau$ 是一个由器件物理特性决定的时间常数。因此，亚稳态事件相对罕见，其持续时间是可变的，且持续时间越长，其发生的可能性呈指数级下降。\n\n示波器在$CLK$的上升沿触发并设置为无限余晖模式，该模式会叠加多次采集，使得频繁出现的值显得明亮，而不频繁出现的值显得暗淡。在没有亚稳态的正常同步捕获下，$Q$在大部分时间里将处于两个逻辑电平之一，并且跳变将在触发后的明确时刻发生。因此，无限余晖模式将显示位于逻辑电平上的两条明亮水平线，跳变则表现为在距离触发点固定延迟处出现的陡峭垂直边缘。\n\n如果发生亚稳态，那么在触发时刻（采样瞬间）附近，$Q$可能会在一段随机持续时间$t_{\\text{res}}$内处于中间电压。经过多次采集，无限余晖显示因此不仅会累积两条位于逻辑电平上的明亮线条，还会累积一个从触发时刻附近开始、水平延伸可变长度（以反映随机的$t_{\\text{res}}$）的、位于两条线之间的微弱“云状”或“辉光”轨迹。因为长的亚稳态持续时间的概率与$e^{-t/\\tau}$成正比，所以这些中间轨迹的密度（亮度）随着与触发点的水平距离增加而减小，并且与逻辑电平相比，中间电平的轨迹是稀疏的，因此显得微弱。\n\n现在我们在此背景下评估各个选项：\n\nA. 一个频率为$CLK$一半的单一、清晰的方波表示$Q$在每个时钟沿确定性地翻转（如二分频行为），这并不表示亚稳态。\n\nB. 两条明亮的逻辑电平线，其间有在触发时刻精确发生的陡峭垂直跳变，这表明采样是一致且定时良好的，没有亚稳态引起的时序离散或中间电平。\n\nC. 两条明亮的逻辑电平线，外加一个从触发时刻附近开始、水平延伸一段短暂且可变持续时间的、位于两条线之间的明显微弱轨迹区域，这与亚稳态的特征完全匹配：在采样瞬间附近出现中间$Q$电平，其恢复时间$t_{\\text{res}}$可变，通过无限余晖累积，在两个逻辑电平之间形成一片微弱、模糊的带状区域。\n\nD. 位于逻辑'1'处的一条粗壮、模糊的线表明存在噪声或围绕稳定高电平的小幅波动，而不是亚稳态在采样沿附近特有的中间电平行为或可变持续时间的延迟。\n\nE. 一条单一、清晰的中间电平线表示一个恒定的直流中间电平（例如，节点被卡住或偏置不当、探头负载或驱动器未供电），而不是偶发的、随时间变化的亚稳态行为。\n\n因此，为亚稳态提供最明确证据的描述是选项C。", "answer": "$$\\boxed{C}$$", "id": "1947264"}, {"introduction": "亚稳态并非随机出现的故障，而是违反基本时序规则（如建立时间 $t_{su}$ 和保持时间 $t_h$）的直接后果。这项实践将挑战您设计一个仿真测试平台，以故意制造时序违规。掌握这项技能对于验证您自己设计的电路在面对异步输入时的鲁棒性至关重要。[@problem_id:1947265]", "problem": "一位工程师正在设计一个仿真测试平台，用以验证一个同步数字电路的行为。被测的关键组件是一个上升沿触发的D型触发器（DFF）。该DFF的制造商数据手册规定了相对于时钟信号（`CLK`）上升沿的以下时序参数：\n\n-   建立时间（$t_{su}$）：150 ps\n-   保持时间（$t_h$）：100 ps\n\n该测试平台使用一个周期为1000 ps的周期性时钟信号`CLK`。工程师的目标是以一种最有可能在DFF的输出端`Q`上故意引发亚稳态的方式来配置数据输入信号`D`。亚稳态是一种输出可能需要不可预测的长时间才能稳定到'0'或'1'状态的情况。\n\n以下哪种针对`D`输入的测试平台配置是专门设计用来引发时序违规，因此最有可能在DFF中引发亚稳态的？\n\nA. `D`输入在`CLK`信号出现上升沿的精确时刻从低电平转换到高电平。\n\nB. `D`输入在`CLK`信号上升沿之前的200 ps精确时刻从低电平转换到高电平。\n\nC. `D`输入由一个异步信号源驱动，其周期是`CLK`信号周期的1.4倍。\n\nD. `D`输入在两个连续`CLK`信号上升沿之间的时间中点精确时刻从低电平转换到高电平。\n\nE. `D`输入在`CLK`信号上升沿之后的200 ps精确时刻从低电平转换到高电平。", "solution": "设每个时钟上升沿发生在时间 $t=nT$，周期为 $T=1000\\ \\text{ps}$。设数据转换发生在相对于特定上升沿 $t=nT$ 的时间 $t=nT+\\Delta t$，因此偏移量为 $\\Delta t$。\n\n根据数据手册，相对于每个上升沿的建立和保持时间要求是：\n- 建立时间：在 $(-t_{su},0]$ 内无转换。\n- 保持时间：在 $[0,t_{h})$ 内无转换。\n\n因此，任何满足\n$$\n\\Delta t \\in (-t_{su},t_{h})\n$$\n的数据转换都会违反时序。使用 $t_{su}=150\\ \\text{ps}$ 和 $t_{h}=100\\ \\text{ps}$，禁止窗口为 $\\Delta t \\in (-150\\ \\text{ps},100\\ \\text{ps})$。当转换尽可能接近采样瞬间发生时，即 $\\Delta t=0$ 时，引发亚稳态的概率最大，因为它同时违反了建立时间和保持时间，并将锁存器置于亚稳态阈值上。\n\n根据每个选项的 $\\Delta t$ 进行评估：\n- A: $\\Delta t=0$。由于 $0 \\in (-t_{su},t_{h})$，建立时间和保持时间都被违反；这是最坏情况，引发亚稳态的概率最高。\n- B: $\\Delta t=-200\\ \\text{ps}$。由于 $-200<-t_{su}=-150$，这位于禁止区间之外；没有违规。\n- C: 周期为 $1.4T$ 的异步信号意味着 $\\Delta t$ 会随着时间在 $[0,T)$ 范围内漂移。发生违规的时钟沿比例为\n$$\n\\frac{t_{su}+t_{h}}{T}=\\frac{150+100}{1000}=\\frac{1}{4},\n$$\n因此违规是间歇性发生的，而不是以最大的单次事件概率发生。\n- D: $\\Delta t=\\frac{T}{2}=500\\ \\text{ps}$，这远在 $(-t_{su},t_{h})$ 之外；没有违规。\n- E: $\\Delta t=+200\\ \\text{ps}>t_{h}=100\\ \\text{ps}$；位于禁止区间之外；没有违规。\n\n因此，专门设计用来引发时序违规并具有最高概率引发亚稳态的配置，是使数据转换与时钟上升沿完全对齐的那一个。", "answer": "$$\\boxed{A}$$", "id": "1947265"}, {"introduction": "了解亚稳态的成因是第一步，而防止其带来的灾难性后果才是稳健设计的核心。本问题将分析一个常见但极其危险的设计错误：从同步器的中间级进行扇出。通过对一个正在解析中的亚稳态信号的模拟行为进行建模，您将揭示为何这种做法会导致系统性故障，并深刻体会到严格遵守同步设计规则的重要性。[@problem_id:1947246]", "problem": "一个关键数字电路被设计用来将异步输入信号 `ASYNC_IN` 同步到系统时钟域 `CLK`。该同步器由两个串行连接的D型触发器 `FF1` 和 `FF2` 组成。第一个触发器的输出 `Q1` 连接到第二个触发器的输入 `D2`。\n\n在一次违反良好设计实践的操作中，`Q1` 输出信号还被扇出以馈送至另外两个并行触发器 `FF_A` 和 `FF_B` 的数据输入端。因此，`D_A = Q1` 且 `D_B = Q1`。所有触发器（`FF1`、`FF_A` 和 `FF_B`）均由同一时钟 `CLK` 驱动，其周期为 `T_{clk}`。\n\n由于制造工艺的变化，`FF_A` 和 `FF_B` 的逻辑输入阈值略有不同。如果电压高于 `V_{th_A}`，`FF_A` 将其输入解释为逻辑‘1’；如果电压高于 `V_{th_B}`，`FF_B` 将其输入解释为逻辑‘1’。已知 `V_{th_A} < V_{th_B}`。\n\n在时间 `t=0` 时，`CLK` 的一个上升沿出现。就在此时钟沿之前，`ASYNC_IN` 信号发生跳变，违反了 `FF1` 的建立时间。这导致 `FF1` 的输出 `Q1` 进入亚稳态。`Q1` 的电压，记为 `V_{Q1}(t)`，开始向高电源轨 `V_{DD}` 解析。该解析过程遵循以下物理模型：\n$$V_{Q1}(t) = \\frac{V_{DD}}{2} + \\Delta V_0 \\exp\\left(\\frac{t}{\\tau_{res}}\\right)$$\n其中 `t \\ge 0` 是自时钟沿经过的时间，`\\Delta V_0` 是一个小的正初始电压位移，其值取决于输入跳变的精确时间，`\\tau_{res}` 是触发器亚稳态解析的特征时间常数。\n\n功能性故障定义为在 `t = T_{clk}` 的下一个时钟沿之后，输出 `Q_A` 和 `Q_B` 不相同的状态。为了让一个触发器可靠地捕获逻辑‘1’，其数据输入必须在关键采样时刻高于其电压阈值，该时刻发生在捕获时钟沿之前的建立时间 `t_{su}` 处。否则，它将捕获一个‘0’。\n\n确定将导致此功能性故障的初始电压位移 `\\Delta V_0` 的范围。通过提供 `\\Delta V_0` 的开区间的下界和上界来表示您的答案。", "solution": "将下一次时钟捕获的关键采样时刻定义为 $t_{s}=T_{clk}-t_{su}$。在此刻，$FF_{A}$ 和 $FF_{B}$ 两者看到的输入为\n$$\nV_{Q1}(t_{s})=\\frac{V_{DD}}{2}+\\Delta V_{0}\\exp\\left(\\frac{t_{s}}{\\tau_{res}}\\right).\n$$\n根据给定的捕获规则，$FF_{X}$（$X\\in\\{A,B\\}$）将捕获逻辑‘1’当且仅当 $V_{Q1}(t_{s})>V_{th_{X}}$，否则它将捕获‘0’。因为 $V_{th_{A}}<V_{th_{B}}$ 且 $V_{Q1}(t_{s})$ 是 $\\Delta V_{0}$ 的严格递增函数，所以获得 $Q_{A}\\neq Q_{B}$ 的唯一方法是满足\n$$\nV_{th_{A}}<V_{Q1}(t_{s})<V_{th_{B}}.\n$$\n将 $t_{s}$ 处的解析模型代入，可得双重不等式\n$$\nV_{th_{A}}<\\frac{V_{DD}}{2}+\\Delta V_{0}\\exp\\left(\\frac{t_{s}}{\\tau_{res}}\\right)<V_{th_{B}}.\n$$\n从三边同时减去 $\\frac{V_{DD}}{2}$ 得到\n$$\nV_{th_{A}}-\\frac{V_{DD}}{2}<\\Delta V_{0}\\exp\\left(\\frac{t_{s}}{\\tau_{res}}\\right)<V_{th_{B}}-\\frac{V_{DD}}{2}.\n$$\n因为 $\\exp(t_{s}/\\tau_{res})>0$，两边同除以该项来求解 $\\Delta V_{0}$：\n$$\n\\left(V_{th_{A}}-\\frac{V_{DD}}{2}\\right)\\exp\\left(-\\frac{t_{s}}{\\tau_{res}}\\right)<\\Delta V_{0}<\\left(V_{th_{B}}-\\frac{V_{DD}}{2}\\right)\\exp\\left(-\\frac{t_{s}}{\\tau_{res}}\\right).\n$$\n最后，将 $t_{s}$ 替换为 $T_{clk}-t_{su}$ 以获得导致功能性故障（$Q_{A}\\neq Q_{B}$）的初始位移 $\\Delta V_{0}$ 的开区间：\n$$\n\\left(V_{th_{A}}-\\frac{V_{DD}}{2}\\right)\\exp\\left(-\\frac{T_{clk}-t_{su}}{\\tau_{res}}\\right)<\\Delta V_{0}<\\left(V_{th_{B}}-\\frac{V_{DD}}{2}\\right)\\exp\\left(-\\frac{T_{clk}-t_{su}}{\\tau_{res}}\\right).\n$$\n因为 $\\Delta V_{0}$ 在物理上是正的，所以实际相关的集合是此开区间与 $\\Delta V_{0}>0$ 的交集；当 $V_{th_{A}}>\\frac{V_{DD}}{2}$ 且 $V_{th_{B}}>\\frac{V_{DD}}{2}$ 时，上述边界已经为正。", "answer": "$$\\boxed{\\left( \\left(V_{th_{A}}-\\frac{V_{DD}}{2}\\right)e^{-\\frac{T_{clk}-t_{su}}{\\tau_{res}}}, \\left(V_{th_{B}}-\\frac{V_{DD}}{2}\\right)e^{-\\frac{T_{clk}-t_{su}}{\\tau_{res}}} \\right)}$$", "id": "1947246"}]}