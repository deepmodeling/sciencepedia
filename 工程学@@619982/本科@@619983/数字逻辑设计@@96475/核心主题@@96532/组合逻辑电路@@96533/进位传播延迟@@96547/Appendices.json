{"hands_on_practices": [{"introduction": "在我们分析加法器性能时，“最坏情况延迟”是一个关键指标。这个练习将带你深入研究一个特定场景，即一个数与它的二进制补码相加，这种情况恰好会引发最长的进位传播链 [@problem_id:1917929]。通过从基本逻辑门的延迟出发，你将亲手计算出完整的传播延迟，从而深刻理解进位链是如何形成并成为电路速度瓶颈的。", "problem": "一个专用的8位数字电路被设计用于执行一项特定操作：它接收一个8位二进制数 `A = A_7A_6...A_0` 作为输入，并计算 `A` 与其自身二进制补码之和。该电路使用一个8位行波进位加法器实现，该加法器由8个相同的全加器（FA）模块构成，每个模块对应一个比特位。\n\n`A` 的二进制补码运算通过将 `A` 按位取反得到 `~A`，然后加1来实现。在行波进位加法器中，这是通过将 `A` 的各位输入到第一组输入端，将 `~A` 的各位输入到第二组输入端，并将最低有效位（LSB）级的初始进位设置为1来实现的。\n\n每个FA模块由基本逻辑门构成。在第 `i` 级，和比特 $S_i$ 和进位输出比特 $C_{out,i}$ 的逻辑由以下标准表达式给出：\n$S_i = A_i \\oplus B_i \\oplus C_{in,i}$\n$C_{out,i} = (A_i \\cdot B_i) + (C_{in,i} \\cdot (A_i \\oplus B_i))$\n其中 $A_i$ 和 $B_i$ 是数据输入，$C_{in,i}$ 是第 $i$ 级的进位输入。\n\n所使用的基本逻辑门的传播延迟如下：\n- 非门：$t_{NOT} = 0.50$ ns\n- 双输入与门：$t_{AND} = 1.00$ ns\n- 双输入或门：$t_{OR} = 1.10$ ns\n- 双输入异或门：$t_{XOR} = 1.50$ ns\n\n在时间 $t = 0$ 时，8位输入 $A$ 变为稳定。假设操作所需的初始进位信号在 $t = 0$ 时也已就绪且稳定。\n\n计算完成整个操作所需的总时间，即从开始到所有9个输出信号（8个和比特 $S_7$ 到 $S_0$，以及最高有效位级的最终进位输出）都稳定的时间。答案以纳秒为单位，并四舍五入到三位有效数字。", "solution": "该电路计算 $A+\\left(\\sim A\\right)+1$，其中 $\\sim A$ 是 $A$ 的按位取反。对于每个比特 $i$，取 $B_{i}=\\overline{A_{i}}$，因此全加器的输入为 $(A_{i},B_{i},C_{\\text{in},i})$，且 $C_{\\text{in},0}=1$。全加器的逻辑是\n$$\nS_{i}=A_{i}\\oplus B_{i}\\oplus C_{\\text{in},i},\\qquad\nC_{\\text{out},i}=(A_{i}\\cdot B_{i})+\\left(C_{\\text{in},i}\\cdot (A_{i}\\oplus B_{i})\\right).\n$$\n由于 $B_{i}=\\overline{A_{i}}$，我们有恒等式 $A_{i}\\oplus B_{i}=1$ 和 $A_{i}\\cdot B_{i}=0$。因此在功能上 $S_{i}=1\\oplus C_{\\text{in},i}=\\overline{C_{\\text{in},i}}$ 且 $C_{\\text{out},i}=C_{\\text{in},i}$。然而，实际实现的逻辑门仍会产生延迟，因此我们明确地计算传播时间。\n\n设门延迟为 $t_{\\text{NOT}}=0.50$ ns、 $t_{\\text{AND}}=1.00$ ns、 $t_{\\text{OR}}=1.10$ ns、 $t_{\\text{XOR}}=1.50$ ns。输入 $A_{i}$ 和 $C_{\\text{in},0}$ 在 $t=0$ 时稳定。\n\n定义中间信号：\n- $B_{i}=\\overline{A_{i}}$ 在以下时间就绪\n$$\nt_{B}=t_{\\text{NOT}}.\n$$\n- $X_{i}=A_{i}\\oplus B_{i}$ 在以下时间就绪\n$$\nt_{X}=\\max(0,t_{B})+t_{\\text{XOR}}=t_{\\text{NOT}}+t_{\\text{XOR}}.\n$$\n- $G_{i}=A_{i}\\cdot B_{i}$ 在以下时间就绪\n$$\nt_{G}=\\max(0,t_{B})+t_{\\text{AND}}=t_{\\text{NOT}}+t_{\\text{AND}}.\n$$\n对于第 $i$ 级的进位路径：\n- $T_{i}=C_{\\text{in},i}\\cdot X_{i}$ 在以下时间就绪\n$$\nt_{T,i}=\\max(t_{C\\text{in},i},t_{X})+t_{\\text{AND}}.\n$$\n- $C_{\\text{out},i}=G_{i}+T_{i}$ 在以下时间就绪\n$$\nt_{C\\text{out},i}=\\max(t_{G},t_{T,i})+t_{\\text{OR}}.\n$$\n\n在 $i=0$ 时，$t_{C\\text{in},0}=0$，所以\n$$\nt_{X}=t_{\\text{NOT}}+t_{\\text{XOR}},\\quad\nt_{T,0}=\\max(0,t_{X})+t_{\\text{AND}}=t_{X}+t_{\\text{AND}},\\quad\nt_{C\\text{out},0}=\\max(t_{G},t_{T,0})+t_{\\text{OR}}=t_{T,0}+t_{\\text{OR}}.\n$$\n因此\n$$\nt_{C\\text{out},0}=(t_{\\text{NOT}}+t_{\\text{XOR}})+t_{\\text{AND}}+t_{\\text{OR}}.\n$$\n对于 $i\\geq 1$，$t_{C\\text{in},i}=t_{C\\text{out},i-1}$。由于 $t_{C\\text{out},0}>t_{X}$，我们有 $\\max(t_{C\\text{in},i},t_{X})=t_{C\\text{in},i}$，因此\n$$\nt_{T,i}=t_{C\\text{in},i}+t_{\\text{AND}},\\qquad\nt_{C\\text{out},i}=t_{T,i}+t_{\\text{OR}}=t_{C\\text{in},i}+(t_{\\text{AND}}+t_{\\text{OR}}),\n$$\n这给出了递推关系\n$$\nt_{C\\text{out},i}=t_{C\\text{out},i-1}+(t_{\\text{AND}}+t_{\\text{OR}}),\\quad i\\geq 1.\n$$\n\n对于第 $i$ 级的和路径：\n$$\nt_{S,i}=\\max(t_{X},t_{C\\text{in},i})+t_{\\text{XOR}}.\n$$\n因此 $t_{S,0}=t_{X}+t_{\\text{XOR}}$，而对于 $i\\geq 1$，由于 $t_{C\\text{in},i}>t_{X}$，\n$$\nt_{S,i}=t_{C\\text{in},i}+t_{\\text{XOR}}=t_{C\\text{out},i-1}+t_{\\text{XOR}}.\n$$\n\n现在代入数值：\n$$\nt_{X}=0.50+1.50=2.00\\ \\text{ns},\\quad\nt_{G}=0.50+1.00=1.50\\ \\text{ns},\\quad\nt_{\\text{AND}}+t_{\\text{OR}}=1.00+1.10=2.10\\ \\text{ns}.\n$$\n因此\n$$\nt_{C\\text{out},0}=(0.50+1.50)+1.00+1.10=4.10\\ \\text{ns},\n$$\n而对于 $i\\geq 1$，\n$$\nt_{C\\text{out},i}=t_{C\\text{out},i-1}+2.10\\ \\text{ns}.\n$$\n因此，经过另外7级后，\n$$\nt_{C\\text{out},7}=t_{C\\text{out},0}+7\\times 2.10=4.10+14.70=18.80\\ \\text{ns}.\n$$\n对于和，\n$$\nt_{S,0}=t_{X}+t_{\\text{XOR}}=2.00+1.50=3.50\\ \\text{ns},\n$$\n而对于 $i\\geq 1$，\n$$\nt_{S,i}=t_{C\\text{out},i-1}+t_{\\text{XOR}}.\n$$\n特别地，\n$$\nt_{S,7}=t_{C\\text{out},6}+1.50=(4.10+6\\times 2.10)+1.50=16.70+1.50=18.20\\ \\text{ns}.\n$$\n\n九个输出中最晚稳定的是来自最高有效位级的最终进位输出，时间为 $18.80$ ns。因此，所有输出稳定所需的总时间是 $18.8$ ns（保留三位有效数字）。", "answer": "$$\\boxed{18.8}$$", "id": "1917929"}, {"introduction": "既然我们了解了行波进位加法器（RCA）的速度瓶颈，下一步自然是探索如何突破这一限制。本练习将介绍一种更快的结构：超前进位加法器（Carry-Select Adder），它通过并行计算两种可能的进位情况来缩短延迟 [@problem_id:1917908]。你将通过计算和对比，亲身体验从RCA到更优设计的性能提升，并理解如何通过巧妙的结构设计来优化关键路径。", "problem": "在数字逻辑设计中，算术电路的速度通常受限于进位传播。考虑一个单位全加器（FA）作为基本构建模块。对于此特定技术，FA产生稳定和输出与稳定进位输出的传播延迟是相同的，我们用 $t_{FA}$ 表示此延迟。该延迟从其三个输入（$A_i$、$B_i$、$C_{in}$）中的最后一个稳定时开始测量。\n\n一个8位行波进位加法器（RCA）由8个这样的FA级联构成。此8位RCA的最坏情况传播延迟，从所有输入位（$A_{0..7}$、$B_{0..7}$）和初始进位（$C_0$）稳定到最高有效和位（$S_7$）稳定的时刻开始测量，测得为 16.0 ns。\n\n为了提高性能，这个8位加法器被重新设计为进位选择加法器。这8位被分成两个4位块：一个低位块（位0-3）和一个高位块（位4-7）。低位块用一个4位RCA实现。高位块使用两个并行的4位RCA实现——一个假设来自低位块的进位为0来计算结果，另一个则假设进位为1。然后，一组2到1多路复用器（MUX）为高位块的和位（$S_{4..7}$）和最终进位输出（$C_8$）选择正确的结果。所有这些多路复用器的选择信号是来自低位块的实际进位输出（$C_4$）。\n\n一个2到1 MUX的传播延迟，从其选择输入到其输出测量，是FA延迟的一半，即 $t_{MUX} = 0.5 \\times t_{FA}$。与此相比，从MUX的数据输入到其输出的延迟可以忽略不计。\n\n计算这个8位进位选择加法器的新的最坏情况传播延迟。以纳秒为单位表示您的答案，并四舍五入到三位有效数字。", "solution": "全加器的和与进位的传播延迟相同，记为 $t_{FA}$。在一个$n$位行波进位加法器（RCA）中，最高有效和位 $S_{n-1}$ 的最坏情况时间是进位穿过前 $n-1$ 级所需的时间，再加上产生最终和所需的另一个 $t_{FA}$：\n$$\nt_{\\text{RCA}\\rightarrow S_{n-1}}=(n-1)t_{FA}+t_{FA}=n\\,t_{FA}.\n$$\n对于给定的8位RCA，到 $S_{7}$ 的测得最坏情况延迟为 $16.0$ ns，因此\n$$\n8\\,t_{FA}=16.0\\ \\Rightarrow\\ t_{FA}=2.0\\ \\text{ns}.\n$$\n对于分成两个4位块的进位选择加法器：\n- 低位的4位RCA在以下时间后产生 $C_{4}$\n$$\nt_{\\text{low}}=4\\,t_{FA}.\n$$\n- 每个高位的4位RCA（假设进位为 $0$ 或 $1$）在经过三次内部进位行波和一个最终求和延迟后产生 $S_{7}$，即\n$$\nt_{\\text{upper\\_data}}=4\\,t_{FA}.\n$$\n- 2到1 MUX的选择到输出延迟为\n$$\nt_{\\text{MUX}}=0.5\\times t_{FA}.\n$$\n加法器输出端的 $S_{7}$ 在正确的高位和值出现在MUX的数据输入端，并且选择信号（$C_{4}$）已通过MUX传播后才可用。由于MUX的数据到输出延迟可以忽略不计，到 $S_{7}$ 的总最坏情况延迟为\n$$\nt_{\\text{CSA}\\rightarrow S_{7}}=\\max\\!\\big(4\\,t_{FA},\\ 4\\,t_{FA}+0.5\\,t_{FA}\\big)=4.5\\,t_{FA}.\n$$\n代入 $t_{FA}=2.0$ ns，\n$$\nt_{\\text{CSA}\\rightarrow S_{7}}=4.5\\times 2.0\\ \\text{ns}=9.00\\ \\text{ns}.\n$$\n四舍五入到三位有效数字，结果是 $9.00$。", "answer": "$$\\boxed{9.00}$$", "id": "1917908"}, {"introduction": "进位传播的原理不仅限于简单的加法器，它同样适用于更复杂的多功能算术单元。这个练习将挑战你在一台可执行加法和减法的12位算术单元中，找出能引发最长传播延迟的输入组合与控制信号 [@problem_id:1917943]。通过分析不同选项，你将把对最坏情况的理解从具体计算提升到抽象的逻辑层面，学会如何预测一个电路在不同工作模式下的性能瓶颈。", "problem": "一个12位数字算术单元被设计用于对两个无符号12位操作数 $A$ 和 $B$ 执行加法和减法运算。该单元的核心是一个12位行波进位加法器 (RCA)。该运算由一个单独的控制信号 `SUB` 控制。\n\n电路的实现如下：\n- 当 $SUB = 0$ 时，该单元执行加法，计算 $S = A + B$。\n- 当 $SUB = 1$ 时，该单元执行减法，使用补码方法计算 $S = A - B$。\n\n为了实现这种双重功能，一层逻辑门电路会修改RCA的输入。RCA的两个12位输入是 $X$ 和 $Y$，初始进位输入是 $C_{in}$。这些输入由 $A$、$B$ 和 `SUB` 决定，如下所示：\n- 对于从0到11的每一位 $i$，RCA的输入位 $Y_i$ 由 $Y_i = B_i \\oplus \\text{SUB}$ 给出。\n- RCA的另一个输入就是 $X=A$。\n- RCA的初始进位输入是 $C_{in} = \\text{SUB}$。\n\n电路的总传播延迟由最长信号路径决定。在RCA中，当一个进位信号必须传播通过每一个全加器级时，会出现最坏情况延迟。\n\n以下哪种控制信号 `SUB` 和12位操作数 $A$ 和 $B$（以十六进制给出）的组合会导致电路表现出其最大可能传播延迟？请选择所有有效选项。\n\nA. `SUB = 0`, `A = 0x000`, `B = 0xFFF`\nB. `SUB = 1`, `A = 0x555`, `B = 0xAAA`\nC. `SUB = 1`, `A = 0xFFF`, `B = 0xFFF`\nD. `SUB = 1`, `A = 0x000`, `B = 0x001`\nE. `SUB = 1`, `A = 0x000`, `B = 0x000`", "solution": "这个12位单元通过向行波进位加法器 (RCA) 输入 $X = A$、$Y_{i} = B_{i} \\oplus \\text{SUB}$ 和 $C_{in} = \\text{SUB}$，来实现在 $\\text{SUB} = 0$ 时计算 $S = A + B$ 以及在 $\\text{SUB} = 1$ 时计算 $S = A + \\overline{B} + 1$。\n\n对于每个全加器级 $i$，定义传播信号和生成信号：\n$$P_{i} = X_{i} \\oplus Y_{i}, \\quad G_{i} = X_{i} Y_{i}.$$\n进位递归关系是：\n$$C_{i+1} = G_{i} \\lor \\left(P_{i} C_{i}\\right).$$\nRCA的最大传播延迟发生在进位必须贯穿每一级时，即当一个进位进入第0级（通过 $C_{in} = 1$ 或 $G_{0} = 1$），并且所有级的 $P_{i}=1$，这样 $C_{i+1} = C_{i}$ 在整个链条中都成立。因此，所需的条件是：\n- 在最低有效位端有一个进位源：$C_{0} = 1$ 或 $G_{0} = 1$。\n- 对于所有 $i \\in \\{0,\\dots,11\\}$，$P_{i} = 1$ 且 $G_{i} = 0$，这样进位就可以在不被阻塞或重新生成的情况下传播。\n\n计算用 $A$、$B$ 和 $\\text{SUB}$ 表示的 $P_{i}$：\n$$P_{i} = X_{i} \\oplus Y_{i} = A_{i} \\oplus (B_{i} \\oplus \\text{SUB}) = (A_{i} \\oplus B_{i}) \\oplus \\text{SUB}.$$\n\n情况 $\\text{SUB} = 1$：\n那么\n$$P_{i} = (A_{i} \\oplus B_{i}) \\oplus 1,$$\n所以 $P_{i} = 1$ 当且仅当 $A_{i} \\oplus B_{i} = 0$，即对于每个 $i$ 都有 $A_{i} = B_{i}$。因此，$A = B$（按位）确保了所有 $i$ 的 $P_{i} = 1$。此外，$C_{0} = \\text{SUB} = 1$，提供了初始进位。再者，由于 $Y_{i} = B_{i} \\oplus 1 = \\overline{B_{i}}$，生成信号为\n$$G_{i} = A_{i} Y_{i} = A_{i}\\,\\overline{B_{i}}.$$\n如果 $A_{i} = B_{i}$，那么所有 $i$ 的 $G_{i} = 0$。因此，当 $\\text{SUB} = 1$ 且 $A = B$ 时，我们有对于所有 $i$ 都有 $P_{i} = 1$ 和 $G_{i} = 0$，并且 $C_{0} = 1$，所以进位会贯穿所有12个级，从而达到最大延迟。\n\n分析给定的 $\\text{SUB} = 1$ 的选项：\n- 选项B：$A = 0x555$ 和 $B = 0xAAA$ 按位互补，所以 $A \\oplus B$ 的结果每一位都是1。那么对于所有 $i$ 都有 $P_{i} = (1) \\oplus 1 = 0$，所以没有进位传播链；不是最坏情况。\n- 选项C：$A = 0xFFF$，$B = 0xFFF$ 导致 $A = B$，所以对于所有 $i$ 都有 $P_{i} = 1$ 和 $G_{i} = 0$，且 $C_{0} = 1$；这是最坏情况。\n- 选项D：$A = 0x000$，$B = 0x001$ 导致 $A \\neq B$，具体来说 $P_{0} = 0$ 且对于 $i \\geq 1$ 有 $P_{i} = 1$。在 $C_{0} = 1$ 的情况下，第一级有 $P_{0} = 0$ 和 $G_{0} = 0$，所以 $C_{1} = 0$；进位立即被阻塞且不会传播；不是最坏情况。\n- 选项E：$A = 0x000$，$B = 0x000$ 导致 $A = B$，所以和选项C一样，有 $P_{i} = 1$，$G_{i} = 0$，和 $C_{0} = 1$；这是最坏情况。\n\n情况 $\\text{SUB} = 0$：\n那么 $Y = B$，$C_{0} = 0$，并且\n$$P_{i} = A_{i} \\oplus B_{i}, \\quad G_{i} = A_{i} B_{i}.$$\n为了在 $C_{0} = 0$ 的情况下获得一个完整的12级传播，我们需要 $G_{0} = 1$ 来产生 $C_{1} = 1$，并且对于所有 $i \\geq 1$ 都有 $P_{i} = 1$，$G_{i} = 0$。分析给定的选项：\n- 选项A：$A = 0x000$，$B = 0xFFF$ 导致所有 $i$ 的 $P_{i} = 1$ 和 $G_{i} = 0$，但是 $C_{0} = 0$ 且 $G_{0} = 0$，所以没有产生初始进位；链中没有进位传播；不是最坏情况。\n\n因此，只有 $\\text{SUB} = 1$ 且 $A = B$ 的选项能达到最大延迟。在所提供的选项中，满足条件的是选项C和E。", "answer": "$$\\boxed{CE}$$", "id": "1917943"}]}