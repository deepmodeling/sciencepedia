{"hands_on_practices": [{"introduction": "共质心版图的核心在于通过对称布局使匹配器件的几何中心重合。本练习将通过一个经典的A-B-B-A线性排列，引导你亲手计算并验证两组器件（A和B）的质心坐标是否一致。这是理解共质心技术如何工作的基本第一步，也为后续分析其抗梯度效应奠定了基础。", "problem": "一位模拟电路设计师正在设计一个关键差分对的布局。该差分对由两个匹配的晶体管组成，我们称之为晶体管1和晶体管2。为了改善对硅晶圆上工艺变化的匹配性能，每个晶体管被分成两个相同的单元器件。晶体管1的单元器件标记为'A'，晶体管2的单元器件标记为'B'。\n\n所有四个单元器件都被建模为边长为 $L$ 的相同正方形。它们沿x轴以线性阵列的方式彼此相邻放置，其中心位于直线 $y=0$ 上。从左到右的排列方式是A-B-B-A。最左边的第一个'A'器件占据的区域由 $0 \\le x \\le L$ 和 $-L/2 \\le y \\le L/2$ 定义。\n\n假设每个单元器件的属性是均匀的，为了计算质心，其位置可以用其几何中心的一个点来表示。计算两个'A'器件组合的总体几何质心坐标 $(x_A, y_A)$，以及两个'B'器件组合的总体几何质心坐标 $(x_B, y_B)$。\n\n请用 $L$ 表示你的答案。将最终答案以一个 $2 \\times 2$ 矩阵的形式呈现，其中第一行包含坐标 $(x_A, y_A)$，第二行包含坐标 $(x_B, y_B)$。", "solution": "问题要求计算两组器件'A'和'B'的几何质心，它们以线性的A-B-B-A模式排列。每个器件都是边长为 $L$ 的正方形。一组相同物体的质心是各个物体质心坐标的平均值。\n\n首先，我们来确定四个单元器件各自的几何中心坐标。这些器件从 $x=0$ 开始沿x轴连续放置，并以 $y=0$ 为中心。\n\n1.  **第一个'A'器件 (A1)：**\n    该器件占据区域 $0 \\le x \\le L$。其几何中心位于此区间的中点。\n    x坐标为 $x_{A1} = \\frac{0 + L}{2} = \\frac{L}{2}$。\n    y坐标为 $y_{A1} = 0$。\n    因此，A1的中心位于 $(\\frac{L}{2}, 0)$。\n\n2.  **第一个'B'器件 (B1)：**\n    该器件与A1相邻，占据区域 $L \\le x \\le 2L$。\n    x坐标为 $x_{B1} = \\frac{L + 2L}{2} = \\frac{3L}{2}$。\n    y坐标为 $y_{B1} = 0$。\n    因此，B1的中心位于 $(\\frac{3L}{2}, 0)$。\n\n3.  **第二个'B'器件 (B2)：**\n    该器件与B1相邻，占据区域 $2L \\le x \\le 3L$。\n    x坐标为 $x_{B2} = \\frac{2L + 3L}{2} = \\frac{5L}{2}$。\n    y坐标为 $y_{B2} = 0$。\n    因此，B2的中心位于 $(\\frac{5L}{2}, 0)$。\n\n4.  **第二个'A'器件 (A2)：**\n    该器件与B2相邻，占据区域 $3L \\le x \\le 4L$。\n    x坐标为 $x_{A2} = \\frac{3L + 4L}{2} = \\frac{7L}{2}$。\n    y坐标为 $y_{A2} = 0$。\n    因此，A2的中心位于 $(\\frac{7L}{2}, 0)$。\n\n现在，我们可以计算'A'器件和'B'器件的总体质心。\n\n**'A'器件的质心， $(x_A, y_A)$：**\n'A'器件是A1和A2。它们的组合质心是它们各自中心坐标的平均值。\n$$x_A = \\frac{x_{A1} + x_{A2}}{2} = \\frac{\\frac{L}{2} + \\frac{7L}{2}}{2} = \\frac{\\frac{8L}{2}}{2} = \\frac{4L}{2} = 2L$$\n$$y_A = \\frac{y_{A1} + y_{A2}}{2} = \\frac{0 + 0}{2} = 0$$\n因此，'A'器件的质心是 $(x_A, y_A) = (2L, 0)$。\n\n**'B'器件的质心， $(x_B, y_B)$：**\n'B'器件是B1和B2。它们的组合质心是它们各自中心坐标的平均值。\n$$x_B = \\frac{x_{B1} + x_{B2}}{2} = \\frac{\\frac{3L}{2} + \\frac{5L}{2}}{2} = \\frac{\\frac{8L}{2}}{2} = \\frac{4L}{2} = 2L$$\n$$y_B = \\frac{y_{B1} + y_{B2}}{2} = \\frac{0 + 0}{2} = 0$$\n因此，'B'器件的质心是 $(x_B, y_B) = (2L, 0)$。\n\n两组器件的坐标是相同的，这就是共质心布局的原理。这确保了布局上器件属性的任何线性梯度都会同等地影响两个匹配的晶体管（A和B），从而最大限度地减少失配。\n\n最终答案应以 $2 \\times 2$ 矩阵的形式呈现。\n第一行是 $(x_A, y_A) = (2L, 0)$。\n第二行是 $(x_B, y_B) = (2L, 0)$。\n\n矩阵为：\n$$\n\\begin{pmatrix}\n2L & 0 \\\\\n2L & 0\n\\end{pmatrix}\n$$", "answer": "$$\\boxed{\\begin{pmatrix} 2L & 0 \\\\ 2L & 0 \\end{pmatrix}}$$", "id": "1291323"}, {"introduction": "验证了器件的几何中心重合后，我们来探讨其在实践中的巨大优势。本练习将模拟一个存在工艺梯度（具体为阈值电压 $V_{th}$ 呈二次函数变化）的真实场景，让你从数学上证明A-B-B-A结构如何巧妙地抵消了线性梯度（$k_1$）的影响，同时揭示其对于非线性梯度（$k_2$）的局限性。通过这个计算，你将深刻理解共质心技术为何能大幅提升匹配精度，以及其并非万能的原因。", "problem": "在高精度模拟集成电路的设计中，减轻元件之间的失配至关重要。考虑一对制造在硅片上的 NMOS 晶体管差分对 $M_A$ 和 $M_B$。为了最小化工艺梯度对其特性的影响，采用了一种称为 A-B-B-A 结构的一维共质心版图方案。\n\n该版图由沿 x 轴线性排列的四个晶体管“指”组成。第一个和第四个指是晶体管 $M_A$ 的部分，而第二个和第三个指是晶体管 $M_B$ 的部分。四个指中的每一个都具有相同的有源区宽度 $W$。任意两个相邻指的边缘之间保持着 $S$ 的均匀间距。\n\n某特定制造工艺导致阈值电压 $V_{th}$ 存在空间变化，该变化可以精确地用位置 $x$ 的二次函数来建模：\n$$V_{th}(x) = V_0 + k_1x + k_2x^2$$\n其中 $V_0$、$k_1$ 和 $k_2$ 是与工艺相关的常数。\n\n多指晶体管（如 $M_A$ 或 $M_B$）的有效阈值电压定义为其各个指的有效阈值电压的算术平均值。单个指的有效阈值电压是 $V_{th}(x)$ 在该指的物理宽度上的平均值。\n\n假设版图从第一个指（属于 $M_A$）的左边缘位于 $x=0$ 处开始，计算两个晶体管之间的残余阈值电压失配，定义为 $\\Delta V_{th} = V_{th,A} - V_{th,B}$。请用 $W$、$S$ 和任何相关工艺常数表示你的最终答案的符号表达式。", "solution": "设四个指沿 x 轴放置，相邻指之间的均匀间距为 $S$，宽度均为 $W$。当第一个指的左边缘在 $x=0$ 时，各指的左边缘位置 $a$ 分别为：\n- 指 1 (属于 $M_{A}$)：$a_{1}=0$，区间 $[0,W]$。\n- 指 2 (属于 $M_{B}$)：$a_{2}=W+S$，区间 $[W+S,2W+S]$。\n- 指 3 (属于 $M_{B}$)：$a_{3}=2W+2S$，区间 $[2W+2S,3W+2S]$。\n- 指 4 (属于 $M_{A}$)：$a_{4}=3W+3S$，区间 $[3W+3S,4W+3S]$。\n\n对于一个跨越 $x \\in [a,a+W]$ 的单个指，其有效阈值是其宽度上的平均值：\n$$\\bar{V}_{th}(a)=\\frac{1}{W}\\int_{a}^{a+W}\\left(V_{0}+k_{1}x+k_{2}x^{2}\\right)\\,dx.$$\n计算该积分可得，\n$$\\bar{V}_{th}(a)=V_{0}+k_{1}\\left(a+\\frac{W}{2}\\right)+k_{2}\\left(a^{2}+aW+\\frac{W^{2}}{3}\\right).$$\n\n因此，对于这四个指：\n$$\\bar{V}_{th}(a_{1})=V_{0}+\\frac{k_{1}}{2}W+\\frac{k_{2}}{3}W^{2},$$\n$$\\bar{V}_{th}(a_{2})=V_{0}+k_{1}\\left(W+S+\\frac{W}{2}\\right)+k_{2}\\left((W+S)^{2}+W(W+S)+\\frac{W^{2}}{3}\\right),$$\n$$\\bar{V}_{th}(a_{3})=V_{0}+k_{1}\\left(2W+2S+\\frac{W}{2}\\right)+k_{2}\\left((2W+2S)^{2}+W(2W+2S)+\\frac{W^{2}}{3}\\right),$$\n$$\\bar{V}_{th}(a_{4})=V_{0}+k_{1}\\left(3W+3S+\\frac{W}{2}\\right)+k_{2}\\left((3W+3S)^{2}+W(3W+3S)+\\frac{W^{2}}{3}\\right).$$\n\n每个多指器件的有效阈值是其两个指的平均值：\n$$V_{th,A}=\\frac{\\bar{V}_{th}(a_{1})+\\bar{V}_{th}(a_{4})}{2},\\qquad V_{th,B}=\\frac{\\bar{V}_{th}(a_{2})+\\bar{V}_{th}(a_{3})}{2}.$$\n\n合并 $V_{th,A}$ 的各项，\n$$V_{th,A}=V_{0}+k_{1}\\left(2W+\\frac{3}{2}S\\right)+k_{2}\\left(\\frac{1}{3}W^{2}+\\frac{9}{2}(W+S)^{2}+\\frac{3}{2}W(W+S)\\right).$$\n\n类似地，对于 $V_{th,B}$，\n$$V_{th,B}=V_{0}+k_{1}\\left(2W+\\frac{3}{2}S\\right)+k_{2}\\left(\\frac{1}{3}W^{2}+\\frac{5}{2}(W+S)^{2}+\\frac{3}{2}W(W+S)\\right).$$\n\n因此，残余失配为\n$$\\Delta V_{th}=V_{th,A}-V_{th,B}=k_{2}\\left[\\left(\\frac{9}{2}-\\frac{5}{2}\\right)(W+S)^{2}\\right]=2k_{2}(W+S)^{2}.$$\n由于共质心 ABBA 布局，常数和线性梯度的贡献相互抵消，只留下一个与二次曲率成正比的残余量。", "answer": "$$\\boxed{2k_{2}\\left(W+S\\right)^{2}}$$", "id": "1291333"}, {"introduction": "除了平缓的工艺梯度，实际版图设计还需面对边界效应这一挑战。本练习将探讨一个关键的实际问题：在没有“虚拟单元”(dummy devices)保护的情况下，版图边缘的器件特性会发生系统性变化。你将推导出一个没有虚拟单元的A-B-B-A差分对的输入失调电压，从而量化边缘效应对电路性能的影响，并体会到理论上的完美对称与实际工程实现之间的差距。", "problem": "一位模拟集成电路设计师正在设计一个由晶体管$M_A$和$M_B$组成的敏感NMOS差分对，它可作为高精度运算放大器的输入级。为了最小化随机失配，该设计师采用了共中心版图技术。具体来说，每个晶体管由两个相同的单元片段构成，这四个片段以`A B B A`的形式排成一个线性阵列。在这种布局中，晶体管$M_A$由两个外部片段并联而成，而晶体管$M_B$由两个内部片段并联而成。阵列的两端没有使用虚拟单元。\n\n由于与工艺相关的边缘效应（例如机械应力或刻蚀变化），阵列外围片段的电学特性与内部片段的电学特性存在系统性差异。已知对于这种特定工艺，两个最外层片段（`A`片段）的电流因子 $\\beta = \\mu_n C_{ox} (W/L)$，比内部片段（`B`片段）的要大一个微小比例 $\\epsilon$。也就是说，对于每个外部片段，$\\beta_A = \\beta_{unit}(1+\\epsilon)$；对于每个内部片段，$\\beta_B = \\beta_{unit}$，其中 $\\beta_{unit}$ 是内部单元片段的标称电流因子。假设所有片段的阈值电压 $V_{th}$ 均相同。\n\n该差分对由一个提供恒定电流 $I_{SS}$ 的尾电流源偏置。当施加一个合适的输入电压以使输出为零时，测得内部晶体管 $M_B$ 的过驱动电压为 $V_{OV,B}$。\n\n假设两个晶体管都工作在饱和区，请推导输入参考失调电压 $V_{OS} = V_{GS,A} - V_{GS,B}$ 关于 $V_{OV,B}$ 和 $\\epsilon$ 的精确闭式表达式。", "solution": "我们使用平方律表达式对每个工作在饱和区的长沟道NMOS片段进行建模：\n$$\nI_{D}=\\frac{1}{2}\\,\\beta\\,(V_{GS}-V_{th})^{2}=\\frac{1}{2}\\,\\beta\\,V_{OV}^{2},\n$$\n其中 $V_{OV}=V_{GS}-V_{th}$。每个组合晶体管是两个相同的单元片段的并联，因此其等效电流因子是各片段电流因子之和。\n\n根据版图和边缘效应，每个外部片段的电流因子为 $\\beta_{A,\\text{seg}}=\\beta_{unit}(1+\\epsilon)$，每个内部片段的为 $\\beta_{B,\\text{seg}}=\\beta_{unit}$。因此，等效电流因子为\n$$\n\\beta_{A}=\\beta_{A,1}+\\beta_{A,2}=2\\,\\beta_{unit}(1+\\epsilon),\\qquad\n\\beta_{B}=\\beta_{B,1}+\\beta_{B,2}=2\\,\\beta_{unit}.\n$$\n\n在负载匹配且输出为零的条件下，两边的漏极电流相等，因此每侧流过的电流为 $I_{D,A}=I_{D,B}=I_{SS}/2$。对每个组合器件使用饱和电流公式可得\n$$\nI_{D,A}=\\frac{1}{2}\\,\\beta_{A}\\,V_{OV,A}^{2}=\\beta_{unit}(1+\\epsilon)\\,V_{OV,A}^{2},\\qquad\nI_{D,B}=\\frac{1}{2}\\,\\beta_{B}\\,V_{OV,B}^{2}=\\beta_{unit}\\,V_{OV,B}^{2}.\n$$\n令 $I_{D,A}=I_{D,B}$ 可得\n$$\n\\beta_{unit}(1+\\epsilon)\\,V_{OV,A}^{2}=\\beta_{unit}\\,V_{OV,B}^{2}\n\\;\\;\\Longrightarrow\\;\\;\nV_{OV,A}=\\frac{V_{OV,B}}{\\sqrt{1+\\epsilon}}.\n$$\n\n输入参考失调定义为 $V_{OS}=V_{GS,A}-V_{GS,B}=(V_{th}+V_{OV,A})-(V_{th}+V_{OV,B})=V_{OV,A}-V_{OV,B}$。代入上述关系式，即可得到精确的闭式表达式\n$$\nV_{OS}=V_{OV,B}\\left((1+\\epsilon)^{-1/2}-1\\right).\n$$\n当 $\\epsilon>0$ 时，该表达式为负值，这反映了 $\\beta$ 值较高的一侧需要较小的栅极过驱动电压来导通相同的电流。", "answer": "$$\\boxed{V_{OV,B}\\left((1+\\epsilon)^{-1/2}-1\\right)}$$", "id": "1291312"}]}