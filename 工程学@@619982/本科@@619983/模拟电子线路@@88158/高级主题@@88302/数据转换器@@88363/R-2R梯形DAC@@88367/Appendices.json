{"hands_on_practices": [{"introduction": "掌握 R-2R DAC 的核心功能是学习本章内容的第一步。本练习将引导你完成一个基本但至关重要的计算：将一个给定的二进制数字输入转换为相应的模拟输出电压。通过这个实践，你将熟悉理想 R-2R DAC 在运算放大器反相配置下的工作原理，并为后续更复杂的分析打下坚实基础。[@problem_id:1327560]", "problem": "一个4位数字-模拟转换器（DAC）采用标准的R-2R梯形网络结构构建。该网络连接到一个配置为反相加法放大器的理想运算放大器。运算放大器的反馈电阻 $R_f$ 等于梯形网络的基础电阻 $R$。4位数字输入的每一位都由一个开关表示。数字“1”将R-2R梯形网络的相应输入端连接到一个稳定的参考电压 $V_{ref}$，而数字“0”则将其连接到地（0 V）。对于这个特定电路，参考电压为 $V_{ref} = 8.0$ V。\n\n当二进制输入字为 `1101` 时，确定运算放大器的模拟输出电压，其中最左边的位是最高有效位（MSB），最右边的位是最低有效位（LSB）。答案以伏特（V）为单位表示。", "solution": "对于一个带有负反馈的理想反相运算放大器，其反相输入端处于虚地，因此其电压为 $0$ V。输入偏置电流为零。设4位二进制字为 $b_{3}b_{2}b_{1}b_{0}$，其中 $b_{3}$ 为最高有效位（MSB），$b_{0}$ 为最低有效位（LSB）。\n\n在一个端接于虚地的R-2R梯形网络中，连接到参考电压 $V_{ref}$ 的每一位都会向求和节点（即运放的反相输入端）贡献一个二进制加权的电流。从梯形网络流入求和节点的总电流为：\n$$\nI_{\\text{in}} = \\frac{V_{ref}}{R} \\left( \\frac{b_3}{2} + \\frac{b_2}{4} + \\frac{b_1}{8} + \\frac{b_0}{16} \\right)\n$$\n在虚地节点处应用基尔霍夫电流定律（KCL）。流入节点的电流之和为零。流经反馈电阻的电流为 $I_{f} = \\frac{V_{out}}{R_{f}}$。因此：\n$$\nI_{\\text{in}} + I_f = 0 \\quad \\Longrightarrow \\quad I_{\\text{in}} + \\frac{V_{out}}{R_{f}} = 0 \\quad \\Longrightarrow \\quad V_{out} = - R_{f}\\,I_{\\text{in}}.\n$$\n将 $R_{f} = R$ 和 $I_{in}$ 的表达式代入，可得：\n$$\nV_{out} = -R \\cdot \\frac{V_{ref}}{R} \\left( \\frac{b_3}{2} + \\frac{b_2}{4} + \\frac{b_1}{8} + \\frac{b_0}{16} \\right) = -V_{ref} \\left( \\frac{b_3}{2} + \\frac{b_2}{4} + \\frac{b_1}{8} + \\frac{b_0}{16} \\right)\n$$\n对于输入字 `1101`，我们有 $b_3=1, b_2=1, b_1=0, b_0=1$。代入这些值：\n$$\nV_{out} = -V_{ref} \\left( \\frac{1}{2} + \\frac{1}{4} + \\frac{0}{8} + \\frac{1}{16} \\right) = -V_{ref} \\left( \\frac{8}{16} + \\frac{4}{16} + 0 + \\frac{1}{16} \\right) = -V_{ref} \\left( \\frac{13}{16} \\right).\n$$\n代入 $V_{ref} = 8.0$ V 可得：\n$$\nV_{out} = - 8.0 \\times \\frac{13}{16} = - \\frac{13}{2} = -6.5 \\text{ V}.\n$$", "answer": "$$\\boxed{-6.5}$$", "id": "1327560"}, {"introduction": "理想模型为了解电路提供了简洁的框架，但真实世界的电路常常会出现故障。这个练习模拟了一个常见的硬件问题：一个开关卡住，导致 DAC 的某一位始终处于“开启”状态。通过分析这个故障对输出电压 $V_{out}$ 的影响，你将学会如何从理想行为的偏离中诊断问题，加深对电路中每个部分贡献的理解。[@problem_id:1327525]", "problem": "考虑一个4位R-2R梯形网络数模转换器（DAC）。该DAC的输出端连接到一个理想运算放大器（op-amp）的反相输入端，此运放配置为反相放大器。运放的同相输入端接地。电阻网络使用值为$R$和$2R$的基础电阻。连接运放输出端和其反相输入端的反馈电阻设定为$R_f = 2R$。\n\n数字输入是一个4位字，表示为$B_3B_2B_1B_0$，其中$B_3$是最高有效位（MSB），$B_0$是最低有效位（LSB）。对于每一位$B_i$，当$B_i=1$时，一个开关将梯形网络中的相应节点连接到参考电压$V_{ref}$；当$B_i=0$时，连接到地（0 V）。\n\n已知该电路存在一个特定故障：对应于位$B_1$的开关发生故障。它永久地卡在“1”的位置，这意味着无论$B_1$的实际输入值是多少，它始终连接到参考电压$V_{ref}$。\n\n将数字输入码“0101”施加到DAC上。计算产生的模拟输出电压$V_{out}$。请用包含$V_{ref}$的解析表达式表示你的答案。", "solution": "由于运放是理想的，并配置为同相输入端接地的反相放大器，因此其反相输入节点是一个电压为0 V的虚地点。R-2R梯形网络是线性的，因此根据叠加原理，注入虚地的总电流是所有开关连接到$V_{ref}$的位所贡献电流的总和。\n\n对于一个正确端接的标准4位R-2R梯形网络，当位$B_{3}$（MSB）到$B_{0}$（LSB）连接到$V_{ref}$时，它们流入求和节点的电流分别由权重因子$\\frac{1}{2}$、$\\frac{1}{4}$、$\\frac{1}{8}$ 和 $\\frac{1}{16}$加权。因此，流入反相节点的总输入电流为\n$$\nI_{in}=\\frac{V_{ref}}{R}\\left(\\frac{B_{3}}{2}+\\frac{B_{2}}{4}+\\frac{B_{1}}{8}+\\frac{B_{0}}{16}\\right).\n$$\n反相运放通过以下公式将此电流转换为输出电压：\n$$\nV_{out}=-R_{f}I_{in}=-R_{f}\\frac{V_{ref}}{R}\\left(\\frac{B_{3}}{2}+\\frac{B_{2}}{4}+\\frac{B_{1}}{8}+\\frac{B_{0}}{16}\\right).\n$$\n给定$R_{f}=2R$，上式变为：\n$$\nV_{out}=-2\\,V_{ref}\\left(\\frac{B_{3}}{2}+\\frac{B_{2}}{4}+\\frac{B_{1}}{8}+\\frac{B_{0}}{16}\\right).\n$$\n施加的数字输入为$0101$，所以名义上$B_{3}=0$，$B_{2}=1$，$B_{1}=0$，$B_{0}=1$。然而，故障强制使$B_{1}$为$1$，无论其预设值为何。因此有效位为$B_{3}=0$，$B_{2}=1$，$B_{1}=1$，$B_{0}=1$。代入得，\n$$\nV_{out}=-2\\,V_{ref}\\left(0+\\frac{1}{4}+\\frac{1}{8}+\\frac{1}{16}\\right)\n=-2\\,V_{ref}\\left(\\frac{4}{16}+\\frac{2}{16}+\\frac{1}{16}\\right)\n=-2\\,V_{ref}\\left(\\frac{7}{16}\\right)\n=-\\frac{7}{8}V_{ref}.\n$$", "answer": "$$\\boxed{-\\frac{7}{8}V_{ref}}$$", "id": "1327525"}, {"introduction": "超越简单的功能故障，精确的模拟电路设计必须量化由元件不完美性引起的性能退化。本练习将介绍一个关键的性能指标——微分非线性 (DNL)，并探讨由电阻制造公差引起的 DNL 误差。完成此练习将使你能够评估 DAC 在“主要代码跃迁”处的表现，这是衡量其精度的重要实践技能。[@problem_id:1327546]", "problem": "分析一个4位电压模式R-2R梯形数模转换器（DAC）的非理想特性。该梯形网络的构造如下：\n\n一个阻值为 $2R$ 的终端电阻接地。该电阻的顶端定义为节点 $N_0$，对应最低有效位（LSB）。在节点 $N_0$ 处，一个阻值为 $2R$ 的并联电阻连接到代表LSB的电压源，该电压源提供 $b_0 V_{\\text{ref}}$ 的电压。一个串联电阻将节点 $N_0$ 连接到节点 $N_1$。\n\n在节点 $N_1$ 处，一个阻值为 $2R$ 的并联电阻连接到其对应的位源 $b_1 V_{\\text{ref}}$，一个串联电阻将节点 $N_1$ 连接到节点 $N_2$。该结构对节点 $N_2$（位 $b_2$）和节点 $N_3$（位 $b_3$，最高有效位或MSB）重复。DAC的输出电压 $V_{\\text{out}}$ 是末端节点 $N_3$ 的电压。\n\n在理想的DAC中，所有串联电阻的阻值都为 $R$。然而，在这个特定的器件中，出现了一个制造缺陷。除了连接MSB节点（$N_3$）与相邻节点（$N_2$）的串联电阻外，所有电阻都是理想的。这个有缺陷的电阻的阻值为 $R' = R(1+\\epsilon)$，其中 $\\epsilon = 0.01$ 代表+1%的误差。\n\n计算从数字输入‘0111’到‘1000’的主要码转换的微分非线性（DNL），以LSB为单位表示。将最终答案四舍五入到四位有效数字。", "solution": "将码k处的DNL定义为 $\\mathrm{DNL}_{k}=\\frac{V_{\\text{out}}(k+1)-V_{\\text{out}}(k)}{V_{\\text{LSB,ideal}}}-1$，对于一个4位DAC，有 $V_{\\text{LSB,ideal}}=\\frac{V_{\\text{ref}}}{2^{4}}=\\frac{V_{\\text{ref}}}{16}$。我们需要从码0111到1000的跳变，即 $\\Delta V = V_{\\text{out}}(1000)-V_{\\text{out}}(0111)$。\n\n根据线性性质，可写出 $V_{\\text{out}}=V_{\\text{ref}}\\sum_{i=0}^{3}w_{i}b_{i}$，其中 $w_{i}$ 是非理想梯形网络中的位权重。只有 $N_{2}$ 和 $N_{3}$ 之间的串联电阻是非理想的，其阻值为 $R'=R(1+\\epsilon)$。\n\n使用叠加定理和Thevenin变换计算权重。\n\n1) MSB权重 $w_{3}$ (仅 $b_{3}=1$):\n当较低位为0时，从 $N_{2}$ 看向地的等效电阻为 $Z_{N_{2}}=R$（标准R-2R网络在正确终端匹配下的特性）。因此，从 $N_{3}$ 向下的阻抗为 $Z_{\\text{down}}=R'+Z_{N_{2}}=R(1+\\epsilon)+R=R(2+\\epsilon)$。$N_{3}$ 节点是一个分压器，一端是连接到 $V_{\\text{ref}}$ 的 $2R$ 电阻，另一端是连接到地的 $Z_{\\text{down}}$ 阻抗，得到\n$$\nw_{3}=\\frac{V_{\\text{out}}}{V_{\\text{ref}}}=\\frac{Z_{\\text{down}}}{2R+Z_{\\text{down}}}=\\frac{2+\\epsilon}{4+\\epsilon}.\n$$\n\n2) 下一位权重 $w_{2}$ (仅 $b_{2}=1$):\n从 $N_2$ 到地（不包括到源的 $2R$ 支路），下方的梯形网络阻抗为 $R+R=2R$（到 $N_1$ 的串联 $R$ 以及从 $N_1$ 到地的等效阻抗 $Z_{N_1}=R$）。因此，当上行链路断开时，$N_{2}$ 处的Thevenin等效电路为\n$$\nV_{\\text{th},2}=\\frac{2R}{2R+2R}V_{\\text{ref}}=\\frac{V_{\\text{ref}}}{2},\\quad R_{\\text{th},2}=(2R)\\parallel(2R)=R.\n$$\n通过 $R'$ 连接到 $N_{3}$（该节点有一个到地的并联电阻 $2R$）可得\n$$\nw_{2}=\\frac{V_{\\text{out}}}{V_{\\text{ref}}}=\\frac{V_{\\text{th},2}}{V_{\\text{ref}}}\\cdot\\frac{2R}{R'+R+2R}=\\frac{1}{2}\\cdot\\frac{2R}{R'+3R}=\\frac{1}{4+\\epsilon}.\n$$\n\n3) 权重 $w_{1}$ (仅 $b_{1}=1$):\n逐步向上构建Thevenin等效电路。在 $N_{1}$ 处（下级网络到地阻抗为 $2R$），$V_{\\text{th},1}=\\frac{V_{\\text{ref}}}{2}$ 且 $R_{\\text{th},1}=R$。通过串联电阻 $R$ 到达 $N_{2}$，并考虑一个并联到地的 $2R$ 电阻，在 $N_2$ 处产生：\n$$\nV_{\\text{th},2}=\\frac{V_{\\text{th},1}}{2}=\\frac{V_{\\text{ref}}}{4},\\quad R_{\\text{th},2}=R.\n$$\n然后通过 $R'$ 到达 $N_{3}$，并考虑一个并联到地的 $2R$ 电阻：\n$$\nw_{1}=\\frac{V_{\\text{out}}}{V_{\\text{ref}}}=\\frac{V_{\\text{th},2}}{V_{\\text{ref}}}\\cdot\\frac{2R}{R'+R+2R}=\\frac{1}{4}\\cdot\\frac{2R}{R'+3R}=\\frac{1}{2(4+\\epsilon)}.\n$$\n\n4) 权重 $w_{0}$ (仅 $b_{0}=1$):\n类似地，每向上一级，Thevenin电压减半，而 $R_{\\text{th}}$ 保持为 $R$；经过三级到达 $N_{2}$ 后，得到 $V_{\\text{th},2}=\\frac{V_{\\text{ref}}}{8}$，$R_{\\text{th},2}=R$，因此\n$$\nw_{0}=\\frac{V_{\\text{out}}}{V_{\\text{ref}}}=\\frac{1}{8}\\cdot\\frac{2R}{R'+3R}=\\frac{1}{4(4+\\epsilon)}.\n$$\n\n因此，对于码 1000 和 0111，\n$$\nV_{\\text{out}}(1000)=V_{\\text{ref}}\\,w_{3},\\quad V_{\\text{out}}(0111)=V_{\\text{ref}}\\,(w_{2}+w_{1}+w_{0}),\n$$\n实际的阶跃电压是\n$$\n\\Delta V=V_{\\text{ref}}\\left[w_{3}-(w_{2}+w_{1}+w_{0})\\right].\n$$\n计算\n$$\nw_{2}+w_{1}+w_{0}=\\frac{1}{4+\\epsilon}\\left(1+\\frac{1}{2}+\\frac{1}{4}\\right)=\\frac{7}{4(4+\\epsilon)},\n$$\n所以\n$$\nw_{3}-(w_{2}+w_{1}+w_{0})=\\frac{2+\\epsilon}{4+\\epsilon}-\\frac{7}{4(4+\\epsilon)}=\\frac{4(2+\\epsilon)-7}{4(4+\\epsilon)}=\\frac{1+4\\epsilon}{4(4+\\epsilon)}.\n$$\n\n由于 $V_{\\text{LSB,ideal}}=\\frac{V_{\\text{ref}}}{16}$，该转换处的 DNL 为\n$$\n\\mathrm{DNL}=\\frac{\\Delta V}{V_{\\text{LSB,ideal}}}-1=16\\cdot\\frac{1+4\\epsilon}{4(4+\\epsilon)}-1=4\\cdot\\frac{1+4\\epsilon}{4+\\epsilon}-1=\\frac{4(1+4\\epsilon)-(4+\\epsilon)}{4+\\epsilon}=\\frac{15\\epsilon}{4+\\epsilon}.\n$$\n对于 $\\epsilon=0.01$，\n$$\n\\mathrm{DNL}=\\frac{15\\times 0.01}{4+0.01}=\\frac{0.15}{4.01}\\approx 0.03741\\ \\text{LSB}.\n$$", "answer": "$$\\boxed{0.03741}$$", "id": "1327546"}]}