{"hands_on_practices": [{"introduction": "为了真正理解积分饱和的负面影响，我们首先来分析一个没有反饱和措施的系统，以便直观地观察到问题所在。在第一个动手实践中 [@problem_id:1580921]，我们将模拟一个常见的场景：一个温控系统在经历一次大幅设定点变化后，其加热器进入饱和状态。你的任务是精确计算，在控制误差反向后，积分项仍然使加热器维持在饱和状态的时长，以此量化积分饱和对系统性能所造成的具体影响。", "problem": "一个热室的温度 $T(t)$（单位为摄氏度）由一个控制系统进行调节。该热室相对于环境的温度动态特性由以下一阶微分方程描述：\n$$ \\tau \\frac{d(T(t)-T_{amb})}{dt} + (T(t)-T_{amb}) = K_p u_{sat}(t) $$\n其中 $T_{amb} = 25$ °C 是恒定的环境温度，$\\tau = 200$ s 是热时间常数， $K_p = 1.0$ °C/W 是过程增益，而 $u_{sat}(t)$ 是加热器提供的功率（单位为瓦特）。\n\n一个比例-积分（PI）控制器被用来调节加热器功率。控制器的指令信号 $u_c(t)$ 按如下方式计算：\n$$ u_c(t) = K_c e(t) + x_I(t) $$\n其中 $e(t) = T_{sp}(t) - T(t)$ 是设定点 $T_{sp}(t)$ 与测量温度 $T(t)$ 之间的误差。控制器增益为 $K_c = 2.0$ W/°C。代表累积误差的积分状态 $x_I(t)$ 根据以下方程演变：\n$$ \\frac{dx_I}{dt} = \\frac{K_c}{T_i} e(t) $$\n其中积分时间常数为 $T_i = 50$ s。\n\n加热器是一个只能供热的电阻元件，并具有最大输出功率。因此，实际供应的功率 $u_{sat}(t)$ 与控制器指令的关系为 $u_{sat}(t) = \\max(0, \\min(u_c(t), U_{max}))$，其中 $U_{max} = 75$ W。\n\n控制序列如下：\n1.  初始时，对于 $t<0$，系统处于稳态，设定点等于环境温度，即 $T_{sp} = T_{amb}$。\n2.  在 $t=0$ 时，设定点阶跃上升至 $T_{sp} = 150$ °C。系统作出响应，加热器功率立即饱和于其最大值 $U_{max}$。\n3.  系统自行演变，直到热室温度 $T(t)$ 达到从其初始值到最大加热功率下新稳态温度总变化的 99.0%。设这个时间为 $t_1$。\n4.  恰好在时间 $t_1$ 时，设定点瞬时返回到 $T_{sp} = 25$ °C。尽管这会产生一个很大的负误差，但由于积分状态 $x_I(t)$ 中的巨大累积值，加热器在额外的一段时间内仍然饱和于 $U_{max}$。\n\n计算从时间 $t_1$ 开始，控制器指令 $u_c(t)$ 保持在饱和极限 $U_{max}$ 或以上的持续时间 $\\Delta t$。这段持续时间是控制器从其饱和状态“退绕”所需的时间。答案以秒为单位表示，并四舍五入到四位有效数字。", "solution": "令 $y(t) \\equiv T(t)-T_{amb}$，则被控对象动态特性为\n$$\n\\tau \\frac{dy}{dt}+y = K_{p}\\,u_{sat}(t).\n$$\n对于 $t<0$，$T_{sp}=T_{amb}$，在稳态下有 $y(0)=0$，$u_{sat}(0)=0$。根据 $e=T_{sp}-T$，$u_{c}=K_{c}e+x_{I}$，$\\dot{x}_{I}=(K_{c}/T_{i})e$，一个一致的稳态解应有 $e(0)=0$，$x_{I}(0)=0$。\n\n在 $t=0$ 时，$T_{sp}$ 阶跃至 $T_{sp,1}=150$，因此 $e(0^{+})=150-25=125$，$u_{c}(0^{+})=K_{c}e(0^{+})=2\\cdot 125=250\\geq U_{max}$，所以对于 $t\\in[0,t_{1}]$ 有 $u_{sat}=U_{max}$。在恒定输入 $u_{sat}=U_{max}$ 的情况下，被控对象的解为\n$$\ny(t)=y_{ss}\\bigl(1-\\exp(-t/\\tau)\\bigr),\\quad y_{ss}\\equiv K_{p}U_{max}.\n$$\n$y$ 达到总变化量的 0.99 所需的时间 $t_{1}$ 满足\n$$\ny(t_{1})=0.99\\,y_{ss}\\;\\Longrightarrow\\;1-\\exp(-t_{1}/\\tau)=0.99\\;\\Longrightarrow\\;\\exp(-t_{1}/\\tau)=0.01,\n$$\n所以\n$$\nt_{1}=\\tau\\ln(100).\n$$\n在 $t\\in[0,t_{1}]$ 期间，误差为\n$$\ne_{1}(t)=T_{sp,1}-T(t)=\\bigl(T_{sp,1}-T_{amb}\\bigr)-y(t)=\\bigl(T_{sp,1}-T_{amb}-y_{ss}\\bigr)+y_{ss}\\exp(-t/\\tau).\n$$\n在 $t_{1}$ 时的积分状态为\n$$\nx_{I}(t_{1})=x_{I}(0)+\\frac{K_{c}}{T_{i}}\\int_{0}^{t_{1}}e_{1}(t)\\,dt\n=\\frac{K_{c}}{T_{i}}\\left[\\bigl(T_{sp,1}-T_{amb}-y_{ss}\\bigr)t_{1}+y_{ss}\\tau\\bigl(1-\\exp(-t_{1}/\\tau)\\bigr)\\right].\n$$\n使用 $\\exp(-t_{1}/\\tau)=0.01$ 和 $1-\\exp(-t_{1}/\\tau)=0.99$，\n$$\nx_{I}(t_{1})=\\frac{K_{c}}{T_{i}}\\left[\\bigl(T_{sp,1}-T_{amb}-y_{ss}\\bigr)\\tau\\ln(100)+0.99\\,y_{ss}\\tau\\right].\n$$\n\n在 $t=t_{1}$ 时，设定点返回到 $T_{sp,2}=T_{amb}$，因此对于 $t\\geq t_{1}$，定义 $s\\equiv t-t_{1}$。当 $u_{c}\\geq U_{max}$ 时，执行器保持饱和于 $u_{sat}=U_{max}$，因此被控对象在恒定输入 $U_{max}$ 下继续演变：\n$$\ny(t)=y_{ss}-\\bigl(y_{ss}-y(t_{1})\\bigr)\\exp(-s/\\tau)=y_{ss}\\left[1-0.01\\,\\exp(-s/\\tau)\\right].\n$$\n因此，在新设定点 $T_{sp,2}=T_{amb}$ 下，\n$$\ne_{2}(s)=T_{sp,2}-T(t)= -\\,y(t)=-y_{ss}+0.01\\,y_{ss}\\exp(-s/\\tau).\n$$\n积分状态演变为\n$$\nx_{I}(t)=x_{I}(t_{1})+\\frac{K_{c}}{T_{i}}\\int_{0}^{s}e_{2}(\\xi)\\,d\\xi\n=x_{I}(t_{1})+\\frac{K_{c}}{T_{i}}\\left[-y_{ss}s+0.01\\,y_{ss}\\tau\\bigl(1-\\exp(-s/\\tau)\\bigr)\\right].\n$$\n因此，对于 $s\\geq 0$，在控制器高位饱和期间，控制指令为\n$$\nu_{c}(s)=K_{c}e_{2}(s)+x_{I}(t)\n=x_{I}(t_{1})-K_{c}y_{ss}+\\frac{K_{c}}{T_{i}}\\bigl(0.01\\,y_{ss}\\tau\\bigr)-\\frac{K_{c}}{T_{i}}y_{ss}\\,s\n+K_{c}\\cdot 0.01\\,y_{ss}\\left[1-\\frac{\\tau}{T_{i}}\\right]\\exp(-s/\\tau).\n$$\n退出饱和发生在第一个满足 $u_{c}(\\Delta t)=U_{max}$ 的时刻 $s=\\Delta t$。代入给定的数值 $K_{p}=1$，$U_{max}=75$，$\\tau=200$，$K_{c}=2$，$T_{i}=50$，$T_{amb}=25$，$T_{sp,1}=150$，我们有 $y_{ss}=75$ 和 $t_{1}=200\\ln(100)$。计算常数值，\n$$\nx_{I}(t_{1})=\\frac{2}{50}\\left[(125-75)\\cdot 200\\ln(100)+0.99\\cdot 75\\cdot 200\\right]\\approx 2436.0680742,\n$$\n控制指令信号简化为\n$$\nu_{c}(s)=2292.0680742-3\\,s-4.5\\,\\exp(-s/200).\n$$\n令 $u_{c}(\\Delta t)=U_{max}=75$ 得到标量方程\n$$\n3\\,\\Delta t+4.5\\,\\exp(-\\Delta t/200)=2217.0680742.\n$$\n解此方程得到\n$$\n\\Delta t\\approx 738.9854\\ \\text{s},\n$$\n四舍五入到四位有效数字后为\n$$\n\\Delta t=739.0\\ \\text{s}.\n$$", "answer": "$$\\boxed{739.0}$$", "id": "1580921"}, {"introduction": "在量化了积分饱和问题之后，我们现在转向一种经典的解决方案：反馈校正法 (back-calculation)。这个练习 [@problem_id:1580908] 将从一个更深入的视角出发，要求你使用状态空间方法来分析该系统。通过推导系统在饱和期间的闭环系统矩阵，你将清晰地看到反饱和方案是如何从根本上改变系统内部动态，从而防止积分状态发散，这是理解其稳定效能的关键一步。", "problem": "一个线性时不变对象由状态空间模型 $\\dot{\\mathbf{x}}(t) = A_p \\mathbf{x}(t) + B_p u(t)$ 和 $y(t) = C_p \\mathbf{x}(t)$ 描述，其中 $\\mathbf{x}(t)$ 是状态向量，$u(t)$ 是控制输入，$y(t)$ 是测量输出。对象矩阵由下式给出：\n$$\nA_p = \\begin{pmatrix} 0 & 1 \\\\ 0 & 0 \\end{pmatrix}, \\quad B_p = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}, \\quad C_p = \\begin{pmatrix} 1 & 0 \\end{pmatrix}\n$$\n该对象由一个比例-积分 (PI) 控制器进行控制，该控制器作用于误差信号 $e(t) = r(t) - y(t)$，其中参考信号 $r(t)$ 在所有时间 $t \\ge 0$ 内均为零。理想的、未饱和的控制信号表示为 $v(t)$，由 $v(t) = K_p e(t) + K_i \\sigma(t)$ 给出，其中 $K_p$ 和 $K_i$ 分别是正常的比例增益和积分增益，而 $\\sigma(t) = \\int_0^t e(\\tau)d\\tau$ 是积分器状态。\n\n连接到该对象的执行器会发生饱和，因此输入到对象的实际控制信号为 $u(t) = \\text{sat}(v(t))$。饱和函数定义为：当 $|v(t)| \\le U_{sat}$ 时，$u(t) = v(t)$；当 $|v(t)| > U_{sat}$ 时，$u(t) = U_{sat} \\cdot \\text{sgn}(v(t))$，其中 $U_{sat}$ 是一个正常数。\n\n为了抑制饱和期间的积分器饱和（windup）现象，采用了一种反演计算抗饱和方案。该方案将积分器状态的动态特性修改为：\n$$\n\\dot{\\sigma}(t) = e(t) + \\frac{1}{K_t}(u(t) - v(t))\n$$\n其中 $K_t$ 是一个正常的抗饱和时间常数。\n\n将整个闭环系统的增广状态向量视为 $\\mathbf{x}_{aug}(t) = \\begin{pmatrix} \\mathbf{x}(t) \\\\ \\sigma(t) \\end{pmatrix}$。该系统的动态特性可以写成 $\\dot{\\mathbf{x}}_{aug}(t) = f(\\mathbf{x}_{aug}(t))$ 的形式。当执行器饱和时（即 $|v(t)| > U_{sat}$），系统动态特性变为仿射的，由 $\\dot{\\mathbf{x}}_{aug}(t) = A_{cl,sat} \\mathbf{x}_{aug}(t) + \\mathbf{b}_{sat}$ 描述。\n\n确定闭环系统矩阵 $A_{cl,sat}$。请以 3x3 矩阵的形式，用给定参数表示你的答案。", "solution": "定义对象状态 $\\mathbf{x}(t) = \\begin{pmatrix} x_{1}(t) \\\\ x_{2}(t) \\end{pmatrix}$，其动态特性为\n$$\n\\dot{\\mathbf{x}}(t) = A_{p}\\mathbf{x}(t) + B_{p}u(t), \\quad y(t) = C_{p}\\mathbf{x}(t),\n$$\n其中\n$$\nA_{p} = \\begin{pmatrix} 0 & 1 \\\\ 0 & 0 \\end{pmatrix}, \\quad B_{p} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}, \\quad C_{p} = \\begin{pmatrix} 1 & 0 \\end{pmatrix}.\n$$\n因此，对象方程为\n$$\n\\dot{x}_{1}(t) = x_{2}(t), \\qquad \\dot{x}_{2}(t) = u(t), \\qquad y(t) = x_{1}(t).\n$$\n当参考信号 $r(t) = 0$ 时，误差为\n$$\ne(t) = r(t) - y(t) = -x_{1}(t).\n$$\n理想的 PI 控制信号为\n$$\nv(t) = K_{p}e(t) + K_{i}\\sigma(t) = -K_{p}x_{1}(t) + K_{i}\\sigma(t).\n$$\n饱和下的实际控制输入是 $u(t) = \\text{sat}(v(t))$。在饱和区，即 $|v(t)| > U_{sat}$ 时，输入 $u(t)$ 在每个区域内是恒定的（或为 $u(t) = U_{sat}$，或为 $u(t) = -U_{sat}$），因此闭环动态特性是仿射的。\n\n反演计算抗饱和方案将积分器动态特性修改为\n$$\n\\dot{\\sigma}(t) = e(t) + \\frac{1}{K_{t}}\\big(u(t) - v(t)\\big).\n$$\n代入 $e(t) = -x_{1}(t)$ 和 $v(t) = -K_{p}x_{1}(t) + K_{i}\\sigma(t)$ 可得\n$$\n\\dot{\\sigma}(t) = -x_{1}(t) + \\frac{1}{K_{t}}\\Big(u(t) + K_{p}x_{1}(t) - K_{i}\\sigma(t)\\Big)\n= \\Big(\\frac{K_{p}}{K_{t}} - 1\\Big)x_{1}(t) - \\frac{K_{i}}{K_{t}}\\sigma(t) + \\frac{1}{K_{t}}u(t).\n$$\n定义增广状态 $\\mathbf{x}_{aug}(t) = \\begin{pmatrix} x_{1}(t) \\\\ x_{2}(t) \\\\ \\sigma(t) \\end{pmatrix}$。饱和区内的增广动态特性为\n$$\n\\dot{x}_{1}(t) = x_{2}(t), \\qquad\n\\dot{x}_{2}(t) = u(t), \\qquad\n\\dot{\\sigma}(t) = \\Big(\\frac{K_{p}}{K_{t}} - 1\\Big)x_{1}(t) - \\frac{K_{i}}{K_{t}}\\sigma(t) + \\frac{1}{K_{t}}u(t).\n$$\n这具有仿射形式 $\\dot{\\mathbf{x}}_{aug}(t) = A_{cl,sat}\\mathbf{x}_{aug}(t) + \\mathbf{b}_{sat}$，其中与状态相乘的矩阵是\n$$\nA_{cl,sat} = \\begin{pmatrix}\n0 & 1 & 0 \\\\\n0 & 0 & 0 \\\\\n\\frac{K_{p}}{K_{t}} - 1 & 0 & -\\frac{K_{i}}{K_{t}}\n\\end{pmatrix}.\n$$\n（仿射项是 $\\mathbf{b}_{sat} = \\begin{pmatrix} 0 \\\\ u(t) \\\\ \\frac{1}{K_{t}}u(t) \\end{pmatrix}$，其中 $u(t) = \\pm U_{sat}$，具体取值取决于饱和区域，但题目只要求 $A_{cl,sat}$。）", "answer": "$$\\boxed{\\begin{pmatrix}0 & 1 & 0 \\\\ 0 & 0 & 0 \\\\ \\frac{K_{p}}{K_{t}} - 1 & 0 & -\\frac{K_{i}}{K_{t}}\\end{pmatrix}}$$", "id": "1580908"}, {"introduction": "除了在原有控制器上增加校正环节，我们有时也可以通过选择一种不同的控制器结构来解决积分饱和问题。这最后一个实践 [@problem_id:1580915] 将介绍数字PI控制器的速度（或增量）形式，这是一种因其内在的鲁棒性而在实践中被广泛应用的设计。通过分步计算，你将模拟控制器在几个时间步内的输出，亲身体验该算法如何利用执行器的*实际*输出值来计算下一步动作，从而在执行器饱和时也能自然地防止积分累积。", "problem": "在数字控制系统中，比例-积分 (PI) 控制器的增量式（或称速度式）形式因其内在的抗积分饱和特性而常用。本问题旨在分析此类控制器在执行器饱和情况下的行为。\n\n考虑一个采样周期为 $T$ 的数字控制回路。控制器在每个离散时间步 $k$ 根据当前误差 $e[k]$ 和上一时刻误差 $e[k-1]$ 计算其输出增量 $\\Delta u[k]$：\n$$\n\\Delta u[k] = K_p (e[k] - e[k-1]) + K_i T e[k]\n$$\n其中 $K_p$ 和 $K_i$ 分别是比例增益和积分增益。\n\n然后，控制器当前步的内部指令 $u_{\\text{internal}}[k]$ 通过将此增量加到上一步施加于执行器的*实际*指令 $u_{\\text{applied}}[k-1]$ 上来确定：\n$$\nu_{\\text{internal}}[k] = u_{\\text{applied}}[k-1] + \\Delta u[k]\n$$\n物理执行器具有饱和限制 $U_{\\min}$ 和 $U_{\\max}$。实际发送给执行器的指令 $u_{\\text{applied}}[k]$ 是被钳位在这些限值内的内部指令。\n\n给定以下参数和初始条件：\n- 比例增益, $K_p = 0.5$\n- 积分增益, $K_i = 1.2$\n- 采样周期, $T = 0.1 \\, \\text{s}$\n- 执行器限值: $U_{\\min} = -10.0 \\, \\text{V}$ 和 $U_{\\max} = 10.0 \\, \\text{V}$\n- $k=0$ 时刻的初始条件：$e[0] = 0$ 且 $u_{\\text{applied}}[0] = 0 \\, \\text{V}$\n\n假设系统在 $k=1, 2, 3, 4$ 时经历以下误差序列：\n- $e[1] = 15.0$\n- $e[2] = 15.0$\n- $e[3] = 15.0$\n- $e[4] = -5.0$\n\n计算在时间步 $k=4$ 时施加于执行器的指令值，即 $u_{\\text{applied}}[4]$。答案以伏特为单位，并四舍五入至三位有效数字。", "solution": "我们使用给定的增量式PI控制器（速度式）：\n$$\n\\Delta u[k] = K_{p}\\big(e[k]-e[k-1]\\big) + K_{i}T\\,e[k],\n$$\n内部指令由先前施加的指令构成（结构上即具有抗饱和特性）：\n$$\nu_{\\text{internal}}[k] = u_{\\text{applied}}[k-1] + \\Delta u[k],\n$$\n然后根据执行器限值进行饱和处理：\n$$\nu_{\\text{applied}}[k] = \\min\\!\\big(\\max(u_{\\text{internal}}[k],\\,U_{\\min}),\\,U_{\\max}\\big).\n$$\n给定 $K_{p}=0.5$，$K_{i}=1.2$，$T=0.1$，我们计算出 $K_{i}T=1.2\\times 0.1=0.12$。限值为 $U_{\\min}=-10$ 和 $U_{\\max}=10$。初始条件：$e[0]=0$ 和 $u_{\\text{applied}}[0]=0$。\n\n步骤 k=1，此时 $e[1]=15$：\n$$\n\\Delta u[1]=0.5\\big(15-0\\big)+0.12\\cdot 15=7.5+1.8=9.3,\n$$\n$$\nu_{\\text{internal}}[1]=0+9.3=9.3,\\quad u_{\\text{applied}}[1]=9.3 \\text{ (在限值内)}.\n$$\n\n步骤 k=2，此时 $e[2]=15$：\n$$\n\\Delta u[2]=0.5\\big(15-15\\big)+0.12\\cdot 15=0+1.8=1.8,\n$$\n$$\nu_{\\text{internal}}[2]=9.3+1.8=11.1,\\quad u_{\\text{applied}}[2]=10.0 \\text{ (在 }U_{\\max}\\text{ 处饱和)}.\n$$\n\n步骤 k=3，此时 $e[3]=15$：\n$$\n\\Delta u[3]=0.5\\big(15-15\\big)+0.12\\cdot 15=1.8,\n$$\n$$\nu_{\\text{internal}}[3]=10.0+1.8=11.8,\\quad u_{\\text{applied}}[3]=10.0 \\text{ (饱和)}.\n$$\n\n步骤 k=4，此时 $e[4]=-5$：\n$$\n\\Delta u[4]=0.5\\big(-5-15\\big)+0.12\\cdot(-5)=0.5\\cdot(-20)-0.6=-10-0.6=-10.6,\n$$\n$$\nu_{\\text{internal}}[4]=10.0+(-10.6)=-0.6,\\quad u_{\\text{applied}}[4]=-0.6 \\text{ (在限值内)}.\n$$\n\n因此，在 $k=4$ 时施加的指令为 $-0.6$ V。四舍五入至三位有效数字为：$-0.600$。", "answer": "$$\\boxed{-0.600}$$", "id": "1580915"}]}