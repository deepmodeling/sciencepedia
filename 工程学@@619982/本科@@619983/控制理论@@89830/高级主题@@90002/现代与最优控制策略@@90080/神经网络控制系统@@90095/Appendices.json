{"hands_on_practices": [{"introduction": "神经网络的核心是神经元，但即使是单个神经元也能构成一个简单而有效的非线性控制器。本练习将带你设计一个单神经元控制器来解决经典的液位控制问题。通过这个实践，你将亲手建立神经网络参数（权重 $w$ 和偏置 $b$）与关键控制性能指标（如稳态误差和控制器灵敏度）之间的直接联系。[@problem_id:1595357]", "problem": "一位工程师正在设计一个简单的神经控制器，用于调节储罐中的液位。一个具有恒定横截面积的储罐中，液位 $h(t)$ 的动态特性由以下微分方程决定：$A \\frac{dh}{dt} = q_{in}(t) - q_{out}(t)$，其中 $A$ 是横截面积，$q_{in}(t)$ 是流入速率，$q_{out}(t)$ 是流出速率。已知流出速率是液位的线性函数：$q_{out}(t) = K_{out}h(t)$，其中 $K_{out}$ 是一个正常数流出系数。\n\n流入速率 $q_{in}(t)$ 由一个单神经元控制器决定。该控制器以误差信号 $e(t) = h_{ref} - h(t)$ 作为输入，其中 $h_{ref}$ 是期望的恒定参考液位。控制器的输出（即设定的流入速率）由以下包含双曲正切激活函数的方程给出：\n$$q_{in}(t) = \\frac{q_{max}}{2} \\left[ 1 + \\tanh(w \\cdot e(t) + b) \\right]$$\n在这里，$q_{max}$ 是泵可能的最大流入速率，而 $w$ 和 $b$ 分别是神经元的可调权重和偏置。\n\n工程师的目标是选择权重 $w$ 和偏置 $b$，以在稳态工作条件下（当 $t \\to \\infty$ 时）满足两个特定的性能标准：\n1. 稳态液位 $h_{ss}$ 必须精确等于参考液位 $h_{ref}$，以确保零稳态误差。\n2. 在此稳态点，控制器对微小误差的灵敏度，定义为比例增益 $K_P = \\left. \\frac{dq_{in}}{de} \\right|_{e=0}$，必须等于一个指定的正常数 $G$。\n\n确定所需神经网络权重 $w$ 的解析表达式。用 $h_{ref}$、$K_{out}$、$q_{max}$ 和 $G$ 来表示你的答案。", "solution": "储罐的动态特性为 $A \\frac{dh}{dt} = q_{in}(t) - q_{out}(t)$，其中 $q_{out}(t) = K_{out} h(t)$。在稳态下，$\\frac{dh}{dt} = 0$，因此 $q_{in,ss} = q_{out,ss} = K_{out} h_{ss}$。第一个要求规定 $h_{ss} = h_{ref}$，因此\n$$\nq_{in}(e=0) = K_{out} h_{ref}.\n$$\n控制器为 $q_{in}(t) = \\frac{q_{max}}{2}\\left[1 + \\tanh(w e(t) + b)\\right]$，其中 $e(t) = h_{ref} - h(t)$。在稳态下，$e=0$，所以\n$$\n\\frac{q_{max}}{2}\\left[1 + \\tanh(b)\\right] = K_{out} h_{ref}\n\\quad \\Rightarrow \\quad\n\\tanh(b) = \\frac{2 K_{out} h_{ref}}{q_{max}} - 1.\n$$\n这要求 $0 < K_{out} h_{ref} < q_{max}$ 以保持 $|\\tanh(b)| < 1$。\n\n比例灵敏度为\n$$\nK_{P} = \\left.\\frac{dq_{in}}{de}\\right|_{e=0} = \\left.\\frac{q_{max}}{2}\\,\\frac{d}{de}\\tanh(w e + b)\\right|_{e=0} = \\frac{q_{max}}{2}\\,w\\,[1 - \\tanh^{2}(b)].\n$$\n设 $K_{P} = G$ 可得\n$$\n\\frac{q_{max}}{2}\\,w\\,[1 - \\tanh^{2}(b)] = G\n\\quad \\Rightarrow \\quad\nw = \\frac{2G}{q_{max}\\,[1 - \\tanh^{2}(b)]}.\n$$\n使用 $\\tanh(b) = \\frac{2 K_{out} h_{ref}}{q_{max}} - 1$，定义 $x = \\frac{2 K_{out} h_{ref}}{q_{max}}$，则 $1 - \\tanh^{2}(b) = 1 - (x - 1)^{2} = x(2 - x)$。因此\n$$\n1 - \\tanh^{2}(b) = \\frac{4 K_{out} h_{ref}\\,(q_{max} - K_{out} h_{ref})}{q_{max}^{2}}.\n$$\n代入 $w$ 的表达式可得\n$$\nw = \\frac{2G}{q_{max}} \\cdot \\frac{q_{max}^{2}}{4 K_{out} h_{ref}\\,(q_{max} - K_{out} h_{ref})}\n= \\frac{G\\,q_{max}}{2 K_{out} h_{ref}\\,(q_{max} - K_{out} h_{ref})}.\n$$\n只要 $0 < K_{out} h_{ref} < q_{max}$ 且 $G > 0$，此结果就能同时满足稳态零误差和指定的比例灵敏度。", "answer": "$$\\boxed{\\frac{G\\,q_{max}}{2\\,K_{out}\\,h_{ref}\\,\\left(q_{max}-K_{out}\\,h_{ref}\\right)}}$$", "id": "1595357"}, {"introduction": "神经网络控制器本质上是非线性的，这使得它们的分析比传统线性控制器更具挑战性。本练习将介绍一种强大的分析工具——线性化。你将学习如何通过计算神经网络在特定工作点 (operating point) 的雅可比矩阵，将其复杂的行为近似为一个简单的局部增益矩阵，从而为应用线性控制理论进行分析和设计打开大门。[@problem_id:1595344]", "problem": "在现代机器人技术中，神经网络常被用作非线性控制器。考虑一个简单的用于控制机械臂单个关节的前馈神经网络。该网络有两个输入：无量纲位置误差 $e_1$ 和无量纲速度误差 $e_2$。它产生一个单一输出 $u$，表示施加到关节上的校正力矩。\n\n该网络有一个包含两个神经元的隐藏层。隐藏层神经元的激活函数是双曲正切函数 $\\tanh(x)$。输出神经元具有线性激活函数（即其输出等于其输入）。\n\n网络内部的计算定义如下：\n首先，计算隐藏神经元的激活前的值 $z_1$ 和 $z_2$：\n$$z_1 = w_{11}e_1 + w_{12}e_2 + b_1$$\n$$z_2 = w_{21}e_1 + w_{22}e_2 + b_2$$\n\n接着，求得隐藏神经元的激活值 $a_1$ 和 $a_2$：\n$$a_1 = \\tanh(z_1)$$\n$$a_2 = \\tanh(z_2)$$\n\n最后，计算输出力矩 $u$：\n$$u = v_1 a_1 + v_2 a_2 + b_{\\text{out}}$$\n\n经过训练过程，网络参数（权重和偏置）已确定如下：\n- 输入到隐藏层的权重：$w_{11} = 1.2$，$w_{12} = -0.8$，$w_{21} = 0.5$，$w_{22} = 1.5$\n- 隐藏层偏置：$b_1 = 0.1$，$b_2 = -0.3$\n- 隐藏层到输出的权重：$v_1 = 2.0$，$v_2 = -1.0$\n- 输出偏置：$b_{\\text{out}} = 0.4$\n\n为了与经典控制方法进行分析和集成，需要将此非线性控制器在特定工作点附近进行线性化。确定局部增益矩阵 $K = \\begin{bmatrix} K_1 & K_2 \\end{bmatrix}$，该矩阵在工作点 $(e_{1,0}, e_{2,0}) = (0.5, -0.2)$ 附近将控制器的行为近似为 $\\delta u \\approx K_1 \\delta e_1 + K_2 \\delta e_2$。\n\n将答案表示为一个 $1 \\times 2$ 的行矩阵。将矩阵元素的数值四舍五入到三位有效数字。", "solution": "我们通过计算非线性映射 $u(e_{1},e_{2})$ 在工作点 $(e_{1,0},e_{2,0})=(0.5,-0.2)$ 处关于 $(e_{1},e_{2})$ 的雅可比矩阵来对其进行线性化。局部增益矩阵为 $K=\\begin{bmatrix}K_{1} & K_{2}\\end{bmatrix}$，其中\n$$\nK_{1}=\\left.\\frac{\\partial u}{\\partial e_{1}}\\right|_{(e_{1,0},e_{2,0})},\\quad\nK_{2}=\\left.\\frac{\\partial u}{\\partial e_{2}}\\right|_{(e_{1,0},e_{2,0})}.\n$$\n已知 $z_{1}=w_{11}e_{1}+w_{12}e_{2}+b_{1}$ 和 $z_{2}=w_{21}e_{1}+w_{22}e_{2}+b_{2}$，且 $a_{i}=\\tanh(z_{i})$以及 $u=v_{1}a_{1}+v_{2}a_{2}+b_{\\text{out}}$，根据链式法则和 $\\frac{d}{dz}\\tanh(z)=1-\\tanh^{2}(z)$ 可得\n$$\n\\frac{\\partial u}{\\partial e_{1}}=v_{1}\\bigl(1-\\tanh^{2}(z_{1})\\bigr)\\frac{\\partial z_{1}}{\\partial e_{1}}+v_{2}\\bigl(1-\\tanh^{2}(z_{2})\\bigr)\\frac{\\partial z_{2}}{\\partial e_{1}}\n= v_{1}\\bigl(1-\\tanh^{2}(z_{1})\\bigr)w_{11}+v_{2}\\bigl(1-\\tanh^{2}(z_{2})\\bigr)w_{21},\n$$\n$$\n\\frac{\\partial u}{\\partial e_{2}}=v_{1}\\bigl(1-\\tanh^{2}(z_{1})\\bigr)\\frac{\\partial z_{1}}{\\partial e_{2}}+v_{2}\\bigl(1-\\tanh^{2}(z_{2})\\bigr)\\frac{\\partial z_{2}}{\\partial e_{2}}\n= v_{1}\\bigl(1-\\tanh^{2}(z_{1})\\bigr)w_{12}+v_{2}\\bigl(1-\\tanh^{2}(z_{2})\\bigr)w_{22}.\n$$\n在点 $(e_{1,0},e_{2,0})=(0.5,-0.2)$ 处计算 $z_{1}$ 和 $z_2$ 的值：\n$$\nz_{1}=1.2\\cdot 0.5+(-0.8)\\cdot(-0.2)+0.1=0.86,\\qquad\nz_{2}=0.5\\cdot 0.5+1.5\\cdot(-0.2)-0.3=-0.35.\n$$\n使用 $\\tanh(x)=\\frac{\\exp(2x)-1}{\\exp(2x)+1}$，我们数值计算得到\n$$\n\\tanh(0.86)\\approx 0.6964\\;\\Rightarrow\\;1-\\tanh^{2}(0.86)\\approx 0.5150,\\qquad\n\\tanh(-0.35)\\approx -0.3364\\;\\Rightarrow\\;1-\\tanh^{2}(-0.35)\\approx 0.8869.\n$$\n代入参数 $v_{1}=2.0$、$v_{2}=-1.0$、$w_{11}=1.2$、$w_{12}=-0.8$、$w_{21}=0.5$、$w_{22}=1.5$：\n$$\nK_{1}=2.0\\cdot 0.5150\\cdot 1.2+(-1.0)\\cdot 0.8869\\cdot 0.5\\approx 1.236-0.4435\\approx 0.7926,\n$$\n$$\nK_{2}=2.0\\cdot 0.5150\\cdot(-0.8)+(-1.0)\\cdot 0.8869\\cdot 1.5\\approx -0.8240-1.3304\\approx -2.1543.\n$$\n将各项四舍五入到三位有效数字，得到\n$$\nK=\\begin{bmatrix}0.793 & -2.15\\end{bmatrix}.\n$$", "answer": "$$\\boxed{\\begin{pmatrix}0.793 & -2.15\\end{pmatrix}}$$", "id": "1595344"}, {"introduction": "一个优秀的控制器设计总是在多个相互竞争的目标之间寻求平衡，例如跟踪精度与控制成本。本练习将让你通过模拟一个磁悬浮系统来探索这一基本权衡。你将量化评估一个经由“正则化”训练的神经网络控制器的动态性能，从而深刻理解训练过程中的参数选择（如控制加权系数 $\\lambda$）如何直接影响系统的实际运行效果和能耗。[@problem_id:1595332]", "problem": "一个简化的单轴磁悬浮系统用于控制一个小铁磁体的垂直位置。该系统在其平衡悬浮高度附近的动力学已被线性化和离散化，得到以下状态空间模型：\n\n$$\nx_{k+1} = A x_k + B u_k\n$$\n\n其中，$k$ 是离散时间索引，状态向量 $x_k = [p_k, v_k]^T$ 表示与平衡点的位置（单位：毫米）和速度（单位：毫米/秒）的偏差，$u_k$ 是与电磁铁电流相关的无量纲控制输入。系统矩阵由下式给出：\n\n$$\nA = \\begin{pmatrix} 1.1 & 0.1 \\\\ 0 & 1 \\end{pmatrix}, \\quad B = \\begin{pmatrix} 0.05 \\\\ 1 \\end{pmatrix}\n$$\n\n一个神经网络被用作状态反馈控制器，它已被简化为 $u_k = K(x_{ref,k} - x_k)$ 形式的线性控制律，其中 $x_{ref,k}$ 是参考状态向量，$K$ 是代表训练后网络权重的 $1 \\times 2$ 增益矩阵。\n\n通过训练网络以最小化形式为 $J = \\sum (e_k^T Q e_k + \\lambda u_k^2)$ 的损失函数，开发了两个独立的控制器，控制器 A 和控制器 B。其中 $e_k=x_{ref,k}-x_k$ 是跟踪误差，$Q$ 是 $2 \\times 2$ 单位矩阵，$\\lambda$ 是惩罚控制力的正则化参数。控制器 A 用较高的 $\\lambda$ 值进行训练，而控制器 B 用较低的 $\\lambda$ 值进行训练。得到的增益矩阵为：\n\n-   控制器 A: $K_A = [0.118, 0.124]$\n-   控制器 B: $K_B = [1.25, 1.34]$\n\n您的任务是分析控制器 B 的性能。系统从平衡点静止开始，因此其初始状态为 $x_0 = [0, 0]^T$。它的任务是在前两个时间步中跟踪以下参考轨迹：\n\n-   $x_{ref,0} = [0, 0]^T$\n-   $x_{ref,1} = [1, 0]^T$\n-   $x_{ref,2} = [1, 0]^T$\n\n当系统使用控制器 B 时，计算位置跟踪误差平方和，定义为 $E_{p,B} = \\sum_{k=1}^{2} (p_{ref,k} - p_k)^2$，以及控制力平方和，定义为 $U_B = \\sum_{k=0}^{1} u_k^2$。将您的答案表示为一对值 $(E_{p,B}, U_B)$。在您的最终答案中，将两个值都四舍五入到三位有效数字。", "solution": "离散时间线性系统由 $x_{k+1}=A x_{k}+B u_{k}$ 给出，其中 $x_{k}=\\begin{pmatrix}p_{k}\\\\ v_{k}\\end{pmatrix}$，控制器为 $u_{k}=K(x_{ref,k}-x_{k})$。对于控制器 B，$K=\\begin{pmatrix}1.25 & 1.34\\end{pmatrix}$。初始状态为 $x_{0}=\\begin{pmatrix}0\\\\ 0\\end{pmatrix}$，参考值为 $x_{ref,0}=\\begin{pmatrix}0\\\\ 0\\end{pmatrix}$，$x_{ref,1}=\\begin{pmatrix}1\\\\ 0\\end{pmatrix}$，$x_{ref,2}=\\begin{pmatrix}1\\\\ 0\\end{pmatrix}$。\n\n在 $k=0$ 时，误差为 $e_{0}=x_{ref,0}-x_{0}=\\begin{pmatrix}0\\\\ 0\\end{pmatrix}$，所以\n$$\nu_{0}=K e_{0}=0.\n$$\n下一个状态是\n$$\nx_{1}=A x_{0}+B u_{0}=\\begin{pmatrix}1.1 & 0.1\\\\ 0 & 1\\end{pmatrix}\\begin{pmatrix}0\\\\ 0\\end{pmatrix}+\\begin{pmatrix}0.05\\\\ 1\\end{pmatrix}\\cdot 0=\\begin{pmatrix}0\\\\ 0\\end{pmatrix}.\n$$\n\n在 $k=1$ 时，误差为 $e_{1}=x_{ref,1}-x_{1}=\\begin{pmatrix}1\\\\ 0\\end{pmatrix}$，因此\n$$\nu_{1}=K e_{1}=1.25\\cdot 1+1.34\\cdot 0=\\frac{5}{4}.\n$$\n下一个状态是\n$$\nx_{2}=A x_{1}+B u_{1}=\\begin{pmatrix}1.1 & 0.1\\\\ 0 & 1\\end{pmatrix}\\begin{pmatrix}0\\\\ 0\\end{pmatrix}+\\begin{pmatrix}0.05\\\\ 1\\end{pmatrix}\\cdot \\frac{5}{4}=\\begin{pmatrix}0.05\\cdot \\frac{5}{4}\\\\ \\frac{5}{4}\\end{pmatrix}=\\begin{pmatrix}\\frac{1}{16}\\\\ \\frac{5}{4}\\end{pmatrix}.\n$$\n\n在 $k=1$ 到 $2$ 期间的位置跟踪误差平方和为\n$$\nE_{p,B}=\\sum_{k=1}^{2}\\left(p_{ref,k}-p_{k}\\right)^{2}=(1-0)^{2}+\\left(1-\\frac{1}{16}\\right)^{2}=1+\\left(\\frac{15}{16}\\right)^{2}=1+\\frac{225}{256}=\\frac{481}{256}.\n$$\n在 $k=0$ 到 $1$ 期间的控制力平方和为\n$$\nU_{B}=\\sum_{k=0}^{1}u_{k}^{2}=0^{2}+\\left(\\frac{5}{4}\\right)^{2}=\\frac{25}{16}.\n$$\n转换为小数并四舍五入到三位有效数字，得到\n$$\nE_{p,B}=\\frac{481}{256}\\approx 1.88,\\quad U_{B}=\\frac{25}{16}\\approx 1.56.\n$$", "answer": "$$\\boxed{(1.88, 1.56)}$$", "id": "1595332"}]}