{"hands_on_practices": [{"introduction": "扩展卡尔曼滤波器（EKF）的核心思想是在每个时间步对非线性模型进行局部线性化。这个练习将带你实践 EKF 中最基本也是最关键的一步：计算测量雅可比矩阵 $H_k$ [@problem_id:1574774]。这个矩阵本质上告诉了滤波器，状态估计的微小变化将如何影响预测的测量值，这是理解和实现 EKF 测量更新步骤的基石。", "problem": "一位工程师正在为一台工业交流电机开发一个实时健康监测系统。该系统使用扩展卡尔曼滤波器（EKF）来估计电机的关键电气参数，这些参数会因工作温度和材料退化等因素而改变。我们关注的两个参数是绕组电阻 $R$ 和绕组电感 $L$。\n\n系统的状态向量定义为 $x = \\begin{pmatrix} R \\\\ L \\end{pmatrix}$。在每个时间步，一个传感器提供单个测量值：电机电阻抗的幅值 $Z$。该测量是在一个已知的恒定角频率 $\\omega$ 下进行的。状态变量与测量值之间的物理关系由非线性函数 $h(x)$ 描述：\n$$Z = h(x) = \\sqrt{R^2 + (\\omega L)^2}$$\nEKF 的测量更新阶段需要围绕当前状态的最佳估计值 $\\hat{x} = \\begin{pmatrix} \\hat{R} \\\\ \\hat{L} \\end{pmatrix}$ 对该测量函数进行线性化。这种线性化由测量雅可比矩阵 $H$ 来表示。\n\n确定测量雅可比矩阵 $H$ 的符号表达式，其定义为 $H = \\frac{\\partial h}{\\partial x}\\bigg|_{x=\\hat{x}}$。你的答案应使用 $\\hat{R}$、$\\hat{L}$ 和 $\\omega$ 来表示。", "solution": "我们已知标量测量函数 $h(x)$，其状态为 $x=\\begin{pmatrix}R \\\\ L\\end{pmatrix}$：\n$$\nh(x)=\\sqrt{R^{2}+(\\omega L)^{2}}=(R^{2}+\\omega^{2}L^{2})^{\\frac{1}{2}}.\n$$\n测量雅可比矩阵 $H$ 是 $h$ 对 $R$ 和 $L$ 的偏导数所组成的行向量，并在 $x=\\hat{x}=\\begin{pmatrix}\\hat{R} \\\\ \\hat{L}\\end{pmatrix}$ 处取值。\n\n使用链式法则，\n$$\n\\frac{\\partial h}{\\partial R}=\\frac{1}{2}(R^{2}+\\omega^{2}L^{2})^{-\\frac{1}{2}}\\cdot 2R=\\frac{R}{\\sqrt{R^{2}+\\omega^{2}L^{2}}}.\n$$\n同样地，\n$$\n\\frac{\\partial h}{\\partial L}=\\frac{1}{2}(R^{2}+\\omega^{2}L^{2})^{-\\frac{1}{2}}\\cdot 2\\omega^{2}L=\\frac{\\omega^{2}L}{\\sqrt{R^{2}+\\omega^{2}L^{2}}}.\n$$\n在 $R=\\hat{R}$ 和 $L=\\hat{L}$ 处求值，雅可比矩阵变为\n$$\nH=\\begin{pmatrix}\n\\dfrac{\\hat{R}}{\\sqrt{\\hat{R}^{2}+\\omega^{2}\\hat{L}^{2}}} & \\dfrac{\\omega^{2}\\hat{L}}{\\sqrt{\\hat{R}^{2}+\\omega^{2}\\hat{L}^{2}}}\n\\end{pmatrix}.\n$$", "answer": "$$\\boxed{\\begin{pmatrix}\\dfrac{\\hat{R}}{\\sqrt{\\hat{R}^{2}+\\omega^{2}\\hat{L}^{2}}} & \\dfrac{\\omega^{2}\\hat{L}}{\\sqrt{\\hat{R}^{2}+\\omega^{2}\\hat{L}^{2}}}\\end{pmatrix}}$$", "id": "1574774"}, {"introduction": "掌握了如何计算雅可比矩阵之后，让我们来探究其在实际应用中的几何意义。这个练习将引导你进行一次思想实验，定性地分析一次精确的角度测量如何改变状态估计的不确定性椭圆 [@problem_id:1574759]。通过这个练习，你将直观地理解 EKF 是如何利用雅可比矩阵所代表的局部线性关系，来融合新的测量信息并降低特定方向上的不确定性的。", "problem": "一架自主无人机正悬停在一个静止位置，我们将其定义为二维笛卡尔坐标系的原点 $(0,0)$。它的任务是估计地面上一个静止目标的位置。目标的状态由向量 $x = [p_x, p_y]^T$ 表示。\n\n最初，无人机对目标位置的置信度由一个高斯分布描述，其均值为 $\\hat{x}_{k|k-1}$，协方差矩阵为 $P_{k|k-1}$。初始不确定性是各向同性的，意味着协方差矩阵的形式为 $P_{k|k-1} = \\sigma^2 I$，其中 $\\sigma^2$ 是一个正常数，而 $I$ 是 2x2 单位矩阵。这意味着初始的不确定性轮廓是一个圆形。\n\n然后，无人机使用其机载摄像头对目标的方位角进行一次高精度测量。测量函数为 $h(x) = \\arctan(p_y/p_x)$，测量噪声被建模为一个零均值高斯噪声，其方差非常小，为 $R_k = \\sigma_\\theta^2$。\n\n使用扩展卡尔曼滤波器（EKF）根据这次新测量来更新状态估计及其协方差，得到后验估计 $\\hat{x}_{k|k}$ 和后验协方差 $P_{k|k}$。后验协方差矩阵 $P_{k|k}$ 描述了新的不确定性，这可以在二维平面上可视化为一个椭圆。视线定义为连接无人机（在原点）与目标估计位置的直线。\n\n下列哪个陈述最准确地描述了此更新后的不确定性椭圆的方向？\n\nA. 椭圆的长轴（最长轴）垂直于视线方向。\n\nB. 椭圆仍然是一个圆形，但其半径小于初始不确定性。\n\nC. 椭圆的长轴（最长轴）沿着视线方向。\n\nD. 椭圆的方向与视线成45度角。\n\nE. 由于非线性测量，不确定性区域的形状不再是椭圆。", "solution": "设状态为 $x = [p_{x}, p_{y}]^{T}$，先验协方差为 $P_{k|k-1} = \\sigma^{2} I$。测量值为方位角 $\\theta = h(x) = \\arctan(p_{y}/p_{x})$，其噪声协方差为 $R_{k} = \\sigma_{\\theta}^{2}$。假设线性化点 $\\hat{x}_{k|k-1} = [\\hat{p}_{x}, \\hat{p}_{y}]^{T}$ 满足 $\\hat{p}_{x}^{2} + \\hat{p}_{y}^{2} > 0$，从而保证雅可比矩阵存在。\n\nEKF 使用在 $\\hat{x}_{k|k-1}$ 处计算的测量雅可比矩阵 $H = \\partial h/\\partial x$。利用 $\\arctan(p_{y}/p_{x})$ 关于 $p_{x}$ 和 $p_{y}$ 的导数，\n$$\nH = \\left[ \\frac{\\partial h}{\\partial p_{x}} \\;\\; \\frac{\\partial h}{\\partial p_{y}} \\right]\n= \\left[ -\\frac{\\hat{p}_{y}}{\\hat{p}_{x}^{2} + \\hat{p}_{y}^{2}} \\;\\; \\frac{\\hat{p}_{x}}{\\hat{p}_{x}^{2} + \\hat{p}_{y}^{2}} \\right].\n$$\n定义 $r^{2} = \\hat{p}_{x}^{2} + \\hat{p}_{y}^{2}$。则 $H = \\frac{1}{r^{2}}[-\\hat{p}_{y}, \\hat{p}_{x}]$。\n\n新息协方差为\n$$\nS = H P_{k|k-1} H^{T} + R_{k} = \\sigma^{2} H H^{T} + \\sigma_{\\theta}^{2}.\n$$\n由于 $H H^{T} = \\frac{\\hat{p}_{y}^{2} + \\hat{p}_{x}^{2}}{r^{4}} = \\frac{1}{r^{2}}$，我们得到\n$$\nS = \\frac{\\sigma^{2}}{r^{2}} + \\sigma_{\\theta}^{2}.\n$$\n卡尔曼增益为\n$$\nK = P_{k|k-1} H^{T} S^{-1} = \\sigma^{2} I \\, H^{T} S^{-1} = \\frac{\\sigma^{2}}{S} H^{T}.\n$$\n因此 $K$ 与 $H^{T} = \\frac{1}{r^{2}}[-\\hat{p}_{y}, \\hat{p}_{x}]^{T}$ 成正比，该向量与视线方向 $[\\hat{p}_{x}, \\hat{p}_{y}]^{T}$ 正交，因为 $[-\\hat{p}_{y}, \\hat{p}_{x}] \\cdot [\\hat{p}_{x}, \\hat{p}_{y}] = 0$。因此，状态更新主要发生在垂直于视线的方向上。\n\n对于标量测量，后验协方差为\n$$\nP_{k|k} = (I - K H) P_{k|k-1} = P_{k|k-1} - K H P_{k|k-1}.\n$$\n计算秩一项：\n$$\nK H P_{k|k-1} = \\left(\\frac{\\sigma^{2}}{S} H^{T}\\right) \\left(H \\sigma^{2}\\right) = \\frac{\\sigma^{4}}{S} \\left(H^{T} H\\right).\n$$\n注意到\n$$\nH^{T} H = \\frac{1}{r^{4}}\n\\begin{bmatrix}\n\\hat{p}_{y}^{2} & -\\hat{p}_{x}\\hat{p}_{y} \\\\\n-\\hat{p}_{x}\\hat{p}_{y} & \\hat{p}_{x}^{2}\n\\end{bmatrix}.\n$$\n引入与径向（视线）和切向（垂直）方向对齐的标准正交基：\n$$\nu_{r} = \\frac{1}{r} \\begin{bmatrix} \\hat{p}_{x} \\\\ \\hat{p}_{y} \\end{bmatrix}, \\quad\nu_{t} = \\frac{1}{r} \\begin{bmatrix} -\\hat{p}_{y} \\\\ \\hat{p}_{x} \\end{bmatrix}.\n$$\n那么 $H = \\frac{1}{r} u_{t}^{T}$ 且 $H^{T} H = \\frac{1}{r^{2}} u_{t} u_{t}^{T}$。因此，\n$$\nP_{k|k} = \\sigma^{2} I - \\frac{\\sigma^{4}}{S} \\cdot \\frac{1}{r^{2}} \\, u_{t} u_{t}^{T}.\n$$\n这表明后验协方差仅在 $u_{t}$（垂直于视线）方向上减小，而在 $u_{r}$（视线）方向上保持不变。具体来说，沿着这些主方向的后验方差是\n$$\n\\lambda_{r}^{+} = u_{r}^{T} P_{k|k} u_{r} = \\sigma^{2},\n\\qquad\n\\lambda_{t}^{+} = u_{t}^{T} P_{k|k} u_{t} = \\sigma^{2} - \\frac{\\sigma^{4}}{S} \\cdot \\frac{1}{r^{2}}.\n$$\n因为 $S = \\frac{\\sigma^{2}}{r^{2}} + \\sigma_{\\theta}^{2} > 0$，我们有 $\\lambda_{t}^{+} < \\sigma^{2}$，当 $\\sigma_{\\theta}^{2} \\to 0$ 时，极限情况为 $\\lambda_{t}^{+} \\to 0$。因此，最大的后验方差沿着视线方向，而最小的后验方差垂直于视线方向。因此，更新后的不确定性椭圆的长轴沿着视线方向。\n\n因此，最准确的陈述是长轴沿着视线方向。", "answer": "$$\\boxed{C}$$", "id": "1574759"}, {"introduction": "线性化是一种强大的近似工具，但它并非万无一失，在某些特定条件下甚至会失效。这个更具挑战性的练习将带你分析一种被称为“滤波器失明”的致命故障模式 [@problem_id:1574809]。在这种情况下，滤波器会完全忽略新的测量数据，导致其无法更新状态估计。你将通过逆向分析，将这一故障追溯到测量雅可比矩阵在特定状态下变为零的根本原因，从而深刻理解 EKF 在实际应用中可能遇到的陷阱。", "problem": "一个自主机器人在一个二维平面上导航。其在时间步 $k$ 的状态由向量 $\\mathbf{x}_k = [p_{x,k}, p_{y,k}]^T$ 表示，该向量包含其笛卡尔坐标。机器人的状态通过扩展卡尔曼滤波器（EKF）进行估计。\n\n该滤波器采用以下模型方程：\n1.  **预测模型**：使用一个简单的随机游走模型来对状态进行时间上的前向预测，其中过程转移矩阵是单位矩阵 $I$。\n    -   预测状态：$\\hat{\\mathbf{x}}_{k|k-1} = \\hat{\\mathbf{x}}_{k-1|k-1}$\n    -   预测协方差：$P_{k|k-1} = P_{k-1|k-1} + Q$，其中 $Q$ 是一个正定的过程噪声协方差矩阵。\n\n2.  **测量模型**：在每个时间步，传感器提供一个标量测量值 $z_k$，该值通过非线性函数 $h(\\mathbf{x}_k)$ 与机器人状态相关联：\n    -   $z_k = h(\\mathbf{x}_k) + v_k$，其中 $h(\\mathbf{x}_k) = (p_{x,k}^2 + p_{y,k}^2 - L^2)^2$。\n    -   常数参数给定为 $L = 5.0$ 米。\n    -   $v_k$ 是一个零均值的高斯测量噪声，其方差为 $R > 0$。\n\n3.  **更新步骤**：使用测量值 $z_k$ 来更新预测的状态和协方差：\n    -   测量雅可比矩阵：$H_k = \\frac{\\partial h}{\\partial \\mathbf{x}}|_{\\hat{\\mathbf{x}}_{k|k-1}}$\n    -   新息协方差：$S_k = H_k P_{k|k-1} H_k^T + R$\n    -   卡尔曼增益：$K_k = P_{k|k-1} H_k^T S_k^{-1}$\n    -   更新状态：$\\hat{\\mathbf{x}}_{k|k} = \\hat{\\mathbf{x}}_{k|k-1} + K_k (z_k - h(\\hat{\\mathbf{x}}_{k|k-1}))$\n    -   更新协方差：$P_{k|k} = (I - K_k H_k) P_{k|k-1}$\n\n一种被称为“状态估计器盲区”的严重故障模式被发现。在这种模式下，滤波器完全忽略新的测量数据，导致更新后的状态与预测状态完全相同，即 $\\hat{\\mathbf{x}}_{k|k} = \\hat{\\mathbf{x}}_{k|k-1}$。观察到这种故障的发生与测量值 $z_k$ 的大小无关，只要新息项 $z_k - h(\\hat{\\mathbf{x}}_{k|k-1})$ 非零即可。\n\n当预测的状态估计值 $\\hat{\\mathbf{x}}_{k|k-1}$ 位于 $p_x$ 轴的正半轴上时，会发生这种特定的故障，即其形式为 $\\hat{\\mathbf{x}}_{k|k-1} = [p_x, 0]^T$，其中 $p_x > 0$。\n\n假设预测误差协方差矩阵 $P_{k|k-1}$ 始终是正定的，请确定导致这种滤波器盲区的 $p_x$ 的具体值。以米为单位，将您的答案四舍五入到两位有效数字。", "solution": "问题要求的是，在预测状态估计值 $\\hat{\\mathbf{x}}_{k|k-1} = [p_x, 0]^T$ 中，导致扩展卡尔曼滤波器（EKF）出现“盲区”的 $p_x$ 的值。该条件的定义是：即使在测量新息非零的情况下，更新后的状态估计值也等于预测的状态估计值，即 $\\hat{\\mathbf{x}}_{k|k} = \\hat{\\mathbf{x}}_{k|k-1}$。\n\n我们从 EKF 的状态更新方程开始：\n$$\n\\hat{\\mathbf{x}}_{k|k} = \\hat{\\mathbf{x}}_{k|k-1} + K_k (z_k - h(\\hat{\\mathbf{x}}_{k|k-1}))\n$$\n滤波器盲区的条件是 $\\hat{\\mathbf{x}}_{k|k} = \\hat{\\mathbf{x}}_{k|k-1}$。将此代入更新方程可得：\n$$\n\\hat{\\mathbf{x}}_{k|k-1} = \\hat{\\mathbf{x}}_{k|k-1} + K_k (z_k - h(\\hat{\\mathbf{x}}_{k|k-1}))\n$$\n这可以简化为：\n$$\nK_k (z_k - h(\\hat{\\mathbf{x}}_{k|k-1})) = \\mathbf{0}\n$$\n问题指出，对于任何非零的测量新息，都会发生这种盲区，这意味着标量项 $(z_k - h(\\hat{\\mathbf{x}}_{k|k-1}))$ 是非零的。为了使该等式成立，卡尔曼增益向量 $K_k$ 必须是零向量，即 $K_k = \\mathbf{0}$。\n\n现在，我们来分析卡尔曼增益的方程：\n$$\nK_k = P_{k|k-1} H_k^T S_k^{-1}\n$$\n要使 $K_k$ 为零向量，必须有 $P_{k|k-1} H_k^T S_k^{-1} = \\mathbf{0}$。\n新息协方差 $S_k = H_k P_{k|k-1} H_k^T + R$。由于 $P_{k|k-1}$ 是正定的且 $R > 0$，因此 $S_k$ 是一个正标量，所以其逆 $S_k^{-1}$ 存在且非零。\n因此，卡尔曼增益为零的条件简化为：\n$$\nP_{k|k-1} H_k^T = \\mathbf{0}\n$$\n问题指出，预测协方差矩阵 $P_{k|k-1}$ 是正定的。根据定义，正定矩阵是可逆的。我们可以从左侧同时乘以 $P_{k|k-1}^{-1}$：\n$$\nP_{k|k-1}^{-1} (P_{k|k-1} H_k^T) = P_{k|k-1}^{-1} \\mathbf{0}\n$$\n$$\n(P_{k|k-1}^{-1} P_{k|k-1}) H_k^T = \\mathbf{0}\n$$\n$$\nI H_k^T = \\mathbf{0} \\implies H_k^T = \\mathbf{0}\n$$\n这意味着在预测状态 $\\hat{\\mathbf{x}}_{k|k-1}$ 处计算的测量雅可比矩阵 $H_k$ 必须是一个零行向量。\n\n测量函数由 $h(p_x, p_y) = (p_x^2 + p_y^2 - L^2)^2$ 给出。状态为 $\\mathbf{x} = [p_x, p_y]^T$。雅可比矩阵 $H$ 是一个 $1 \\times 2$ 的矩阵：\n$$\nH = \\begin{bmatrix} \\frac{\\partial h}{\\partial p_x} & \\frac{\\partial h}{\\partial p_y} \\end{bmatrix}\n$$\n我们使用链式法则来计算偏导数：\n$$\n\\frac{\\partial h}{\\partial p_x} = 2(p_x^2 + p_y^2 - L^2)^{1} \\cdot \\frac{\\partial}{\\partial p_x}(p_x^2 + p_y^2 - L^2) = 2(p_x^2 + p_y^2 - L^2)(2p_x) = 4p_x(p_x^2 + p_y^2 - L^2)\n$$\n$$\n\\frac{\\partial h}{\\partial p_y} = 2(p_x^2 + p_y^2 - L^2)^{1} \\cdot \\frac{\\partial}{\\partial p_y}(p_x^2 + p_y^2 - L^2) = 2(p_x^2 + p_y^2 - L^2)(2p_y) = 4p_y(p_x^2 + p_y^2 - L^2)\n$$\n所以，雅可比矩阵是：\n$$\nH = \\begin{bmatrix} 4p_x(p_x^2 + p_y^2 - L^2) & 4p_y(p_x^2 + p_y^2 - L^2) \\end{bmatrix}\n$$\n问题指出，当预测状态为 $\\hat{\\mathbf{x}}_{k|k-1} = [p_x, 0]^T$ 时，会发生滤波器盲区。我们必须在这个特定状态下计算雅可比矩阵 $H_k$。我们将 $\\hat{\\mathbf{x}}_{k|k-1}$ 的坐标代入偏导数的表达式中：\n$$\nH_k = \\begin{bmatrix} 4p_x(p_x^2 + 0^2 - L^2) & 4(0)(p_x^2 + 0^2 - L^2) \\end{bmatrix}\n$$\n$$\nH_k = \\begin{bmatrix} 4p_x(p_x^2 - L^2) & 0 \\end{bmatrix}\n$$\n为了实现滤波器盲区，我们需要 $H_k = \\mathbf{0} = \\begin{bmatrix} 0 & 0 \\end{bmatrix}$。第二个分量已经是零。第一个分量也必须是零：\n$$\n4p_x(p_x^2 - L^2) = 0\n$$\n问题指定我们要寻找一个 $p_x > 0$ 的解。这意味着 $4p_x$ 项非零。因此，要使乘积为零，另一项必须为零：\n$$\np_x^2 - L^2 = 0\n$$\n$$\np_x^2 = L^2\n$$\n对两边取平方根可得 $p_x = \\pm L$。由于问题指定 $p_x > 0$，我们必须选择正根：\n$$\np_x = L\n$$\n问题提供了值 $L=5.0$ 米。因此，$p_x$ 的临界值为 $5.0$ 米。\n\n题目要求答案保留两位有效数字。值 $5.0$ 有两位有效数字。\n\n因此，当预测状态位于 x 轴正半轴上，且距离原点的距离恰好等于参数 $L$ 时，滤波器会经历盲区。", "answer": "$$\\boxed{5.0}$$", "id": "1574809"}]}