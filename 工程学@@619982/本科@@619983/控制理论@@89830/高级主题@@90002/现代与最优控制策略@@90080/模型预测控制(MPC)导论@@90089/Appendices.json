{"hands_on_practices": [{"introduction": "模型预测控制 (MPC) 的核心在于其“预测”能力。在决定最佳控制动作之前，我们必须能够利用系统模型来预见未来的系统行为。这个练习将带你完成最基本的一步：给定一个初始状态和一系列控制输入，计算出系统未来的状态轨迹 [@problem_id:1583625]。这就像是为控制器的“决策”提供未来的“地图”，是整个MPC策略的基础。", "problem": "一位工程师正在为一个大型、隔热良好的室开发一种简单的开环控制策略，该室的热力学动态可以通过一个离散时间线性系统来建模。系统的状态是在时间步 $k$ 时，温度与期望设定点之间的偏差 $T_k$。系统的演化由以下方程描述：\n$$T_{k+1} = T_k + \\beta u_k$$\n其中 $u_k$ 是在时间步 $k$ 时加热元件的控制输入，而 $\\beta$ 是一个表示系统热增益的常数。\n\n测得的初始温度偏差为 $T_0 = 10.0$ 摄氏度。已知热增益为 $\\beta = 0.25$ 摄氏度/加热器单位。为了测试系统的响应，该工程师决定施加一个恒定的控制序列，其中在所有时间步中 $u_k = 8.0$ 加热器单位。\n\n作为设计更高级控制器（如模型预测控制器）的初步步骤，该工程师需要预测在此简单控制序列下系统的未来状态。计算预测的状态轨迹，该轨迹包含三个时间步预测时域内的温度偏差 $\\{T_1, T_2, T_3\\}$。\n\n提供轨迹的三个数值，单位为摄氏度。", "solution": "我们已知离散时间线性系统的更新方程\n$$T_{k+1} = T_k + \\beta u_k.$$\n通过重复代入，在时间步 $k$ 的状态可以写成初始条件与累积输入之和：\n$$T_k = T_0 + \\beta \\sum_{i=0}^{k-1} u_i.$$\n对于所有 $i$ 都有恒定输入 $u_i = u$ 的情况，该式简化为\n$$T_k = T_0 + k \\beta u.$$\n\n代入给定值 $T_0 = 10.0$, $\\beta = 0.25$ 和 $u = 8.0$，首先计算每步的增量：\n$$\\beta u = 0.25 \\times 8.0 = 2.0.$$\n因此，\n$$T_1 = 10.0 + 1 \\times 2.0 = 12.0,$$\n$$T_2 = 10.0 + 2 \\times 2.0 = 14.0,$$\n$$T_3 = 10.0 + 3 \\times 2.0 = 16.0.$$\n因此，预测的轨迹 $\\{T_1, T_2, T_3\\}$ 为 $\\{12.0, 14.0, 16.0\\}$。", "answer": "$$\\boxed{\\begin{pmatrix}12.0 & 14.0 & 16.0\\end{pmatrix}}$$", "id": "1583625"}, {"introduction": "仅仅能够预测未来是不够的；我们还需要一种方法来“选择”最优的未来。这就是MPC中“控制”或“优化”的部分所要解决的问题。这个练习引入了成本函数的概念，它量化了我们的控制目标，例如最小化误差和控制能耗 [@problem_id:1583584]。通过求解一个简单的优化问题，你将亲身体验MPC如何在一个预测时域内计算出当前时刻应施加的最佳控制输入。", "problem": "一个用于描述卫星电池充电状态（SoC）偏差的简化模型由以下离散时间线性系统给出：\n$$x_{k+1} = a x_k + b u_k$$\n其中，$x_k$ 是在时间步 $k$ 时，SoC相较于其标称值的偏差，单位为百分点；$u_k$ 是在时间区间 $[k, k+1)$ 内施加的控制作用（与充电/放电电流成正比），单位为控制单位。该系统的特征参数为 $a = 0.8$ 和 $b = 1.0$。\n\n为了调节SoC，采用了一种模型预测控制（MPC）策略。在当前时间步 $k=0$ 时，控制器在一个长度为 $N=2$ 个时间步的预测时域内求解一个优化问题。其目标是找到一个控制作用序列 $\\{u_0, u_1\\}$，以最小化成本函数 $J$。该函数惩罚控制努力以及终端状态与期望值零的偏差。成本函数定义为：\n$$J = p_w x_2^2 + \\sum_{j=0}^{1} r_w u_j^2$$\n此处，$x_2$ 是预测时域末端的预测状态偏差。权重因子给定为：控制努力的权重 $r_w = 1.0$，终端状态惩罚的权重 $p_w = 5.0$。\n\n给定初始SoC偏差为 $x_0 = 10.0$，确定MPC控制器将在时间步 $k=0$ 施加的最优初始控制作用 $u_0$。\n\n答案以控制单位表示，并四舍五入到三位有效数字。", "solution": "系统为 $x_{k+1} = a x_k + b u_k$，在预测时域 $N=2$ 上的成本由 $J = p_w x_2^2 + \\sum_{j=0}^{1} r_w u_j^2$ 给出。在 $k=0$ 且初始状态为 $x_0$ 时，预测的状态为\n$$\nx_1 = a x_0 + b u_0, \\quad x_2 = a x_1 + b u_1 = a^2 x_0 + a b u_0 + b u_1.\n$$\n成本函数变为\n$$\nJ = p_w(a^2 x_0 + a b u_0 + b u_1)^2 + r_w(u_0^2 + u_1^2).\n$$\n为使 $J$ 相对于 $u_0$ 和 $u_1$ 最小，将其偏导数设为零。首先，\n$$\n\\frac{\\partial J}{\\partial u_1} = 2 p_w x_2 \\frac{\\partial x_2}{\\partial u_1} + 2 r_w u_1 = 2 p_w x_2 b + 2 r_w u_1 = 0,\n$$\n这得到\n$$\nu_1 = - \\frac{p_w b}{r_w} x_2.\n$$\n由于 $x_2 = a^2 x_0 + a b u_0 + b u_1$，代入此 $u_1$ 表达式以求解用 $x_0$ 和 $u_0$ 表示的 $u_1$：\n$$\nu_1 = - \\frac{p_w b}{r_w} (a^2 x_0 + a b u_0 + b u_1)\n\\;\\Rightarrow\\;\nu_1 (1 + \\frac{p_w b^2}{r_w}) = - \\frac{p_w b}{r_w} (a^2 x_0 + a b u_0),\n$$\n因此\n$$\nu_1 = - \\frac{p_w b}{r_w + p_w b^2} (a^2 x_0 + a b u_0).\n$$\n这就得到了用 $x_0$ 和 $u_0$ 表示的 $x_2$：\n$$\nx_2 = a^2 x_0 + a b u_0 + b u_1\n= (1 - \\frac{p_w b^2}{r_w + p_w b^2})(a^2 x_0 + a b u_0)\n= \\frac{r_w}{r_w + p_w b^2} (a^2 x_0 + a b u_0).\n$$\n接着，\n$$\n\\frac{\\partial J}{\\partial u_0} = 2 p_w x_2 \\frac{\\partial x_2}{\\partial u_0} + 2 r_w u_0\n= 2 p_w x_2 (a b) + 2 r_w u_0 = 0,\n$$\n所以\n$$\nu_0 = - \\frac{p_w a b}{r_w} x_2.\n$$\n代入 $x_2$ 的表达式：\n$$\nu_0 = - \\frac{p_w a b}{r_w} \\cdot \\frac{r_w}{r_w + p_w b^2} (a^2 x_0 + a b u_0)\n= - \\frac{p_w a b}{r_w + p_w b^2} (a^2 x_0 + a b u_0).\n$$\n求解 $u_0$：\n$$\nu_0 (1 + \\frac{p_w a^2 b^2}{r_w + p_w b^2})\n= - \\frac{p_w a^3 b}{r_w + p_w b^2} x_0\n\\;\\Rightarrow\\;\nu_0 = - \\frac{p_w a^3 b}{r_w + p_w b^2 + p_w a^2 b^2} x_0.\n$$\n因此，最优的初始控制作用是\n$$\nu_0^{\\star} = - \\frac{p_w a^3 b}{r_w + p_w b^2 (1 + a^2)} x_0.\n$$\n代入 $a = 0.8$，$b = 1.0$，$p_w = 5.0$，$r_w = 1.0$ 以及 $x_0 = 10.0$：\n$$\na^3 = 0.512, \\quad 1 + a^2 = 1.64, \\quad r_w + p_w b^2 (1 + a^2) = 1.0 + 5.0 \\times 1.64 = 9.2,\n$$\n所以\n$$\nu_0^{\\star} = - \\frac{5.0 \\times 0.512 \\times 1.0}{9.2} \\times 10.0 = - 2.782608695\\ldots\n$$\n四舍五入到三位有效数字，\n$$\nu_0^{\\star} \\approx - 2.78.\n$$", "answer": "$$\\boxed{-2.78}$$", "id": "1583584"}, {"introduction": "理论计算和现实世界的表现之间需要一座桥梁，这就是控制器“调优”的艺术。在MPC中，成本函数中的权重因子，如状态误差权重 $Q$ 和控制输入权重 $R$，直接决定了控制器的行为特性。这个练习将帮助你从定性的角度理解这些权重如何影响系统的最终表现，例如，在自动驾驶的例子中，是追求极致的循迹精度还是更平顺舒适的驾乘体验 [@problem_id:1583614]。掌握这种权衡是成为一名优秀控制工程师的关键。", "problem": "一个汽车工程团队正在为一辆自动驾驶汽车开发车道保持辅助系统。该系统采用模型预测控制（MPC）策略来调节车辆相对于车道中心的横向位置。MPC的核心是一个成本函数 $J$，在每个时间步对其进行最小化，以确定最优的转向角。对于该系统，成本函数定义为：\n$$J = \\sum_{k=0}^{N-1} (x_k^T Q x_k + u_k^T R u_k)$$\n此处，$k$ 是在长度为 $N$ 的预测时域内的离散时间索引。项 $x_k$ 表示状态误差，主要是车辆与车道中心的横向偏差。项 $u_k$ 表示控制输入，即指令的转向角变化。为简化初始调试阶段， $Q$ 和 $R$ 是正标量权重因子。大的 $Q$ 会重度惩罚偏离车道中心的行为，而大的 $R$ 会重度惩罚大角度或快速的转向变化。\n\n该团队在一直线路段上进行了两次测试，分别命名为 Alpha 和 Beta，两次测试中权重 $Q$ 和 $R$ 的调整有所不同。\n\n**场景 Alpha：** 控制器进行频繁且激进的转向修正。观察者注意到驾乘体验有些颠簸，但数据显示车辆以非常高的精度沿中心线行驶，偏差很少超过几厘米。\n\n**场景 Beta：** 控制器进行平稳且柔和的转向调整。据报告，驾乘体验非常舒适。数据显示，在修正过程中，车辆被允许稍微偏离中心线更远一些，偏差有时会达到几十厘米，然后才被平缓地引导回来。\n\n根据这些观察结果，哪个场景可能在调校中使用了相对于状态误差权重 $Q$ 而言明显更大的输入权重 $R$？为什么？\n\nA. 场景 Alpha，因为实现高精度跟踪需要一个相对较大的 $R$ 值。\nB. 场景 Beta，因为一个相对较大的 $R$ 值会迫使控制器在修正时更加激进。\nC. 场景 Alpha，因为一个相对较大的 $R$ 值会惩罚状态误差，从而导致更关注跟踪性能。\nD. 场景 Beta，因为一个相对较大的 $R$ 值会惩罚控制输入，从而导致更平滑、更保守的动作。\nE. 结果与 $R$ 和 $Q$ 的比率无关，主要取决于预测时域 $N$。", "solution": "给定一个MPC阶段成本\n$$J=\\sum_{k=0}^{N-1}(x_k^T Q x_k+u_k^T R u_k),$$\n在此调试阶段，$Q>0$ 和 $R>0$ 是标量。优化器在通过施加控制 $u_k$ 来减小状态误差 $x_k$ 与惩罚 $u_k$ 的大小之间进行权衡。较大的 $Q$ 更侧重于减小 $|x_k|$，而较大的 $R$ 更侧重于保持 $|u_k|$ 较小。\n\n为了明确对 $Q$ 和 $R$ 的依赖关系，我们考虑一个线性预测模型 $x_{k+1}=Ax_k+Bu_k$ 的标准离散时间线性二次调节器结构。最优MPC律（对于无约束情况）的形式为\n$$u_k=-Kx_k,$$\n其中\n$$K=(R+B^T PB)^{-1}B^T PA,$$\n且 $P$ 是离散Riccati方程的唯一半正定解\n$$P=Q+A^T PA-A^T PB(R+B^T PB)^{-1}B^T PA.$$\n从这些表达式中，可以得出定性依赖关系如下：\n- 如果 $R$ 增加（$Q$ 固定），则 $(R+B^T PB)^{-1}$ 的数值减小，从而使 $K$ 减小。较小的 $K$ 意味着对于给定的 $|x_k|$，$|u_k|$ 会更小，这会导致更平滑、更保守的控制动作，并允许在进行强力修正前出现更大的瞬态 $|x_k|$。\n- 如果 $Q$ 增加（$R$ 固定），则 $P$ 增加，从而使 $K$ 增加。较大的 $K$ 意味着对于给定的 $x_k$，会有更激进的控制 $u_k$，从而更快地减小 $|x_k|$，但代价是更大和更频繁的控制努力。\n\n将这些影响与场景对应起来：\n- 场景 Alpha 显示出频繁、激进的转向和非常小的偏差，这与相对于 $Q$ 较小的 $R$ 相一致（即较大的 $K$ 和对 $x_k$ 的激进调节）。\n- 场景 Beta 显示出平滑、柔和的转向，并允许在修正前有较大的偏差，这与相对于 $Q$ 较大的 $R$ 相一致（即较小的 $K$ 和保守的控制努力）。\n\n因此，调校中输入权重 $R$ 相对于 $Q$ 明显更大的场景是场景 Beta，因为大的 $R$ 会惩罚控制输入，产生更平滑、更保守的动作，即使这意味着允许更大的临时状态偏差。\n\n选项 A、B 和 C 与 $R$ 和 $Q$ 在成本函数中的作用相矛盾：$R$ 惩罚的是输入而不是状态误差，且较大的 $R$ 不会迫使控制器进行激进修正。选项 E 是错误的，因为尽管预测时域 $N$ 会影响性能，但 $R$ 与 $Q$ 的比率直接决定了控制器的激进性和平滑度，正如 $K$ 对 $Q$ 和 $R$ 的依赖关系所示。", "answer": "$$\\boxed{D}$$", "id": "1583614"}]}