{"hands_on_practices": [{"introduction": "理论的掌握最终需要通过实践来巩固。本节的第一个练习将引导你完成一个基础但至关重要的推导：针对经典的 von Mises 塑性模型的相容弹塑性切线算子。这个练习的核心不仅仅是推导公式，更在于深入分析其谱特性，特别是其最小特征值。通过这个过程，你将揭示数学形式与物理现实之间的深刻联系——即切线算子的性质如何直接关系到材料的稳定性以及剪切带等局部化失效现象的萌生。[@problem_id:2547052]", "problem": "考虑三维小应变、率无关、关联 von Mises 弹塑性及线性各向同性硬化。弹性响应是各向同性的，体积模量为 $K$，剪切模量为 $G$，因此四阶弹性刚度为 $C^{e} = K\\,\\mathbf{I} \\otimes \\mathbf{I} + 2G\\,\\mathbb{I}_{\\mathrm{dev}}$，其中 $\\mathbf{I}$ 是二阶单位张量，$\\mathbb{I}_{\\mathrm{dev}}$ 是四阶偏量投影算子。总应变可加法分解为 $\\boldsymbol{\\varepsilon} = \\boldsymbol{\\varepsilon}^{e} + \\boldsymbol{\\varepsilon}^{p}$，Cauchy 应力为 $\\boldsymbol{\\sigma} = C^{e} : \\boldsymbol{\\varepsilon}^{e}$。von Mises 屈服函数为 $f(\\boldsymbol{\\sigma},\\kappa) = \\sqrt{\\frac{3}{2}}\\,\\|\\mathbf{s}\\| - \\sigma_{y0} - H'\\kappa$，其中 $\\mathbf{s} = \\mathrm{dev}(\\boldsymbol{\\sigma})$ 是应力偏量，$\\kappa$ 是累积等效塑性应变，$\\sigma_{y0}$ 是初始屈服应力，$H' \\ge 0$ 是线性各向同性硬化模量。塑性流动是关联的，因此 $\\mathrm{d}\\boldsymbol{\\varepsilon}^{p} = \\mathrm{d}\\lambda\\,\\partial f / \\partial \\boldsymbol{\\sigma}$，并且在塑性加载期间一致性条件成立。从这些基本定义和关系出发，推导适用于有限元法(FEM)中 Newton 方法的一致弹塑性切线算子 $C^{ep}$。将注意力限制在塑性加载状态和偏量子空间内，考虑 $C^{ep}$ 的偏量部分关于塑性流动方向 $\\mathbf{n} = \\partial f / \\partial \\boldsymbol{\\sigma}$ 及其正交补的谱分解。以闭式解形式，确定 $C^{ep}$ 偏量部分的最小特征值 $\\lambda_{\\min}(H',G)$，其为硬化模量 $H'$ 和剪切模量 $G$ 的函数。用文字讨论当 $H' \\to 0$（理想塑性极限）时，该特征值和椭圆性会发生什么变化，并解释其力学意义。最终答案仅提供 $\\lambda_{\\min}(H',G)$ 的解析表达式。以帕斯卡（Pascals）为单位表示您的最终答案，将 $H'$ 和 $G$ 视为以帕斯卡为单位。不需要数值近似或舍入。", "solution": "所述问题是计算塑性力学理论中一个标准的适定问题。它具有科学依据、客观，并为求解提供了所有必要的信息。因此，我们开始进行推导。\n\n在率无关塑性力学中，推导切线模量的基本出发点是塑性加载的卡鲁什-库恩-塔克（KKT）条件，具体来说是一致性条件，该条件规定在塑性状态期间屈服函数必须保持为零。\n$$ \\mathrm{d} f = 0 $$\n使用链式法则展开可得：\n$$ \\mathrm{d}f = \\frac{\\partial f}{\\partial \\boldsymbol{\\sigma}} : \\mathrm{d}\\boldsymbol{\\sigma} + \\frac{\\partial f}{\\partial \\kappa} \\mathrm{d}\\kappa = 0 $$\n我们将屈服函数对应力的梯度表示为 $\\mathbf{n}$：\n$$ \\mathbf{n} = \\frac{\\partial f}{\\partial \\boldsymbol{\\sigma}} = \\frac{\\partial}{\\partial \\boldsymbol{\\sigma}} \\left( \\sqrt{\\frac{3}{2}}\\,\\|\\mathbf{s}\\| - \\sigma_{y0} - H'\\kappa \\right) = \\sqrt{\\frac{3}{2}} \\frac{\\partial \\|\\mathbf{s}\\|}{\\partial \\boldsymbol{\\sigma}} $$\n应力偏量 $\\mathbf{s}$ 的范数对全应力张量 $\\boldsymbol{\\sigma}$ 的导数为 $\\frac{\\mathbf{s}}{\\|\\mathbf{s}\\|}$。因此，流动方向为：\n$$ \\mathbf{n} = \\sqrt{\\frac{3}{2}} \\frac{\\mathbf{s}}{\\|\\mathbf{s}\\|} $$\n该张量 $\\mathbf{n}$ 是偏量，即 $\\mathrm{tr}(\\mathbf{n})=0$。其范数的平方为 $\\mathbf{n}:\\mathbf{n} = \\frac{3}{2}$。\n\n屈服函数对硬化变量 $\\kappa$ 的导数为：\n$$ \\frac{\\partial f}{\\partial \\kappa} = -H' $$\n累积塑性应变增量 $\\mathrm{d}\\kappa$ 与塑性乘子增量 $\\mathrm{d}\\lambda$ 相关。对于标准的 von Mises 模型，此关系为 $\\mathrm{d}\\kappa = \\mathrm{d}\\lambda$。这是从功共轭原理推导出来的，其中 $\\mathrm{d}\\kappa = \\sqrt{\\frac{2}{3}} \\|\\mathrm{d}\\boldsymbol{\\varepsilon}^p\\|$。由于流动法则是 $\\mathrm{d}\\boldsymbol{\\varepsilon}^p = \\mathrm{d}\\lambda \\mathbf{n}$，我们有 $\\|\\mathrm{d}\\boldsymbol{\\varepsilon}^p\\| = \\mathrm{d}\\lambda \\|\\mathbf{n}\\| = \\mathrm{d}\\lambda \\sqrt{\\frac{3}{2}}$，这导致 $\\mathrm{d}\\kappa = \\sqrt{\\frac{2}{3}} \\left( \\mathrm{d}\\lambda \\sqrt{\\frac{3}{2}} \\right) = \\mathrm{d}\\lambda$。\n\n将这些代入一致性条件可得：\n$$ \\mathbf{n} : \\mathrm{d}\\boldsymbol{\\sigma} - H' \\mathrm{d}\\lambda = 0 \\implies \\mathbf{n} : \\mathrm{d}\\boldsymbol{\\sigma} = H' \\mathrm{d}\\lambda $$\n应力增量 $\\mathrm{d}\\boldsymbol{\\sigma}$ 通过 Hooke 定律和应变加法分解与总应变增量 $\\mathrm{d}\\boldsymbol{\\varepsilon}$ 相关：\n$$ \\mathrm{d}\\boldsymbol{\\sigma} = C^e : \\mathrm{d}\\boldsymbol{\\varepsilon}^e = C^e : (\\mathrm{d}\\boldsymbol{\\varepsilon} - \\mathrm{d}\\boldsymbol{\\varepsilon}^p) = C^e : (\\mathrm{d}\\boldsymbol{\\varepsilon} - \\mathrm{d}\\lambda \\mathbf{n}) $$\n现在我们将 $\\mathrm{d}\\boldsymbol{\\sigma}$ 的这个表达式代入一致性条件，以求解塑性乘子 $\\mathrm{d}\\lambda$：\n$$ \\mathbf{n} : \\left[ C^e : (\\mathrm{d}\\boldsymbol{\\varepsilon} - \\mathrm{d}\\lambda \\mathbf{n}) \\right] = H' \\mathrm{d}\\lambda $$\n$$ \\mathbf{n} : C^e : \\mathrm{d}\\boldsymbol{\\varepsilon} - \\mathrm{d}\\lambda (\\mathbf{n} : C^e : \\mathbf{n}) = H' \\mathrm{d}\\lambda $$\n$$ \\mathrm{d}\\lambda = \\frac{\\mathbf{n} : C^e : \\mathrm{d}\\boldsymbol{\\varepsilon}}{H' + \\mathbf{n} : C^e : \\mathbf{n}} $$\n为了简化项 $\\mathbf{n} : C^e : \\mathbf{n}$，我们使用给定的 $C^e = K\\,\\mathbf{I} \\otimes \\mathbf{I} + 2G\\,\\mathbb{I}_{\\mathrm{dev}}$ 形式以及 $\\mathbf{n}$ 是偏量这一事实。$C^e$ 对 $\\mathbf{n}$ 的作用为：\n$$ C^e : \\mathbf{n} = (K\\,\\mathbf{I} \\otimes \\mathbf{I} + 2G\\,\\mathbb{I}_{\\mathrm{dev}}) : \\mathbf{n} = K (\\mathbf{I} : \\mathbf{n})\\mathbf{I} + 2G (\\mathbb{I}_{\\mathrm{dev}} : \\mathbf{n}) $$\n由于 $\\mathrm{tr}(\\mathbf{n})=0$ 且 $\\mathbb{I}_{\\mathrm{dev}}$ 是到偏量空间的投影算子，这可以简化为：\n$$ C^e : \\mathbf{n} = 2G\\,\\mathbf{n} $$\n因此，分母项变为：\n$$ H' + \\mathbf{n} : C^e : \\mathbf{n} = H' + \\mathbf{n} : (2G\\,\\mathbf{n}) = H' + 2G\\,(\\mathbf{n} : \\mathbf{n}) = H' + 2G\\,\\left(\\frac{3}{2}\\right) = H' + 3G $$\n弹塑性切线算子 $C^{ep}$ 由 $\\mathrm{d}\\boldsymbol{\\sigma} = C^{ep} : \\mathrm{d}\\boldsymbol{\\varepsilon}$ 定义。我们通过将 $\\mathrm{d}\\lambda$ 的公式代回到 $\\mathrm{d}\\boldsymbol{\\sigma}$ 的关系式中来找到其表达式：\n$$ \\mathrm{d}\\boldsymbol{\\sigma} = C^e : \\mathrm{d}\\boldsymbol{\\varepsilon} - \\mathrm{d}\\lambda (C^e:\\mathbf{n}) = C^e : \\mathrm{d}\\boldsymbol{\\varepsilon} - \\frac{(C^e : \\mathbf{n}) \\otimes (\\mathbf{n} : C^e)}{H' + \\mathbf{n} : C^e : \\mathbf{n}} : \\mathrm{d}\\boldsymbol{\\varepsilon} $$\n$$ C^{ep} = C^e - \\frac{(C^e : \\mathbf{n}) \\otimes (C^e : \\mathbf{n})}{H' + 3G} $$\n使用 $C^e:\\mathbf{n} = 2G \\mathbf{n}$，这变为：\n$$ C^{ep} = C^e - \\frac{(2G\\mathbf{n}) \\otimes (2G\\mathbf{n})}{H' + 3G} = K\\,\\mathbf{I} \\otimes \\mathbf{I} + 2G\\,\\mathbb{I}_{\\mathrm{dev}} - \\frac{4G^2}{H' + 3G} \\mathbf{n} \\otimes \\mathbf{n} $$\n问题要求该算子偏量部分的特征值，我们将其表示为 $C^{ep}_{\\mathrm{dev}}$。该算子将偏应变增量 $\\mathrm{d}\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}$ 映射到偏应力增量 $\\mathrm{d}\\mathbf{s}$。注意到 $\\mathbf{I}\\otimes\\mathbf{I}$ 将偏量张量映射为零，而 $\\mathbb{I}_{\\mathrm{dev}}$ 在其上起单位算子的作用，我们得到：\n$$ C^{ep}_{\\mathrm{dev}} = 2G\\,\\mathbb{I}_{\\mathrm{dev}} - \\frac{4G^2}{H' + 3G} \\mathbf{n} \\otimes \\mathbf{n} $$\n为了找到特征值，我们求解特征值问题 $C^{ep}_{\\mathrm{dev}} : \\mathbf{v} = \\lambda \\mathbf{v}$，其中 $\\mathbf{v}$ 是一个非零偏量张量。\n$$ \\left( 2G\\,\\mathbb{I}_{\\mathrm{dev}} - \\frac{4G^2}{H' + 3G} \\mathbf{n} \\otimes \\mathbf{n} \\right) : \\mathbf{v} = \\lambda \\mathbf{v} $$\n$$ 2G\\mathbf{v} - \\frac{4G^2}{H' + 3G} (\\mathbf{n} : \\mathbf{v}) \\mathbf{n} = \\lambda \\mathbf{v} $$\n我们考虑特征向量 $\\mathbf{v}$ 的两种情况：\n\n情况1：特征向量 $\\mathbf{v}$ 平行于流动方向 $\\mathbf{n}$。设 $\\mathbf{v} = c\\mathbf{n}$，其中 $c$ 为某个非零标量。\n$$ 2G(c\\mathbf{n}) - \\frac{4G^2}{H' + 3G} (\\mathbf{n} : c\\mathbf{n}) \\mathbf{n} = \\lambda (c\\mathbf{n}) $$\n两边除以 $c$ 并使用 $\\mathbf{n} : \\mathbf{n} = \\frac{3}{2}$：\n$$ \\left( 2G - \\frac{4G^2}{H' + 3G} \\left(\\frac{3}{2}\\right) \\right) \\mathbf{n} = \\lambda \\mathbf{n} $$\n$$ \\lambda_1 = 2G - \\frac{6G^2}{H' + 3G} = \\frac{2G(H' + 3G) - 6G^2}{H' + 3G} = \\frac{2GH' + 6G^2 - 6G^2}{H' + 3G} = \\frac{2GH'}{H' + 3G} $$\n\n情况2：特征向量 $\\mathbf{v}$ 与流动方向 $\\mathbf{n}$ 正交（即，$\\mathbf{v}$ 位于偏量张量空间内与 $\\mathbf{n}$ 正交的超平面中）。此时，$\\mathbf{n} : \\mathbf{v} = 0$。特征值方程简化为：\n$$ 2G\\mathbf{v} - \\mathbf{0} = \\lambda \\mathbf{v} $$\n$$ \\lambda_2 = 2G $$\n该特征值的重数为4，对应于5维对称偏量张量空间中 $\\mathbf{n}$ 的正交补的维数。\n\n为了找到最小特征值，我们比较 $\\lambda_1$ 和 $\\lambda_2$。由于 $G > 0$ 且硬化模量 $H' \\ge 0$，我们有 $H' \\le H' + 3G$。因此，分数 $\\frac{H'}{H' + 3G} \\le 1$。所以，$\\lambda_1 = 2G \\left(\\frac{H'}{H' + 3G}\\right) \\le 2G = \\lambda_2$。最小特征值为 $\\lambda_{\\min} = \\lambda_1$。\n$$ \\lambda_{\\min}(H',G) = \\frac{2GH'}{H' + 3G} $$\n在理想塑性极限下，当 $H' \\to 0$ 时，最小特征值 $\\lambda_{\\min}$ 趋近于 $0$。切线算子 $C^{ep}$ 不再是正定的，而仅是半正定的。平衡控制方程的强椭圆性丧失是一个关键事件。其力学意义在于，材料在塑性流动方向 $\\mathbf{n}$上失去了所有刚度。这使得变形可以在恒定应力下发生，这正是理想塑性流动的定义。这一数学条件是应变局部化等物理现象（如剪切带的形成）的先决条件，而应变局部化可能导致材料失效。在使用有限元法(FEM)的数值模拟中，单元层面切线刚度矩阵的奇异性会导致严重的数值困难，并表明经典连续介质提法无法描述局部化后的行为。", "answer": "$$\n\\boxed{\\frac{2GH'}{H' + 3G}}\n$$", "id": "2547052"}, {"introduction": "在掌握了基础的关联塑性模型之后，我们将挑战一个更复杂的场景：非关联塑性。许多岩土材料（如土壤、岩石和混凝土）的塑性流动方向与屈服面法向并不一致，需要采用非关联流动法则来描述。这个练习要求你在非关联 Drucker-Prager 模型下，推导一个关键的物理量——算法体积模量 $K_{\\mathrm{alg}}$，它描述了材料在纯体积应变增量下的塑性响应。通过这个实践，你将学会如何将一致性切线算子的推导思想应用于更广泛、更现实的材料模型中。[@problem_id:2547037]", "problem": "给定一个服从线性弹性和非关联Drucker-Prager模型的小应变各向同性弹塑性实体。其弹性响应由体积模量 $K$ 和剪切模量 $G$ 表征。采用拉为正的符号约定，平均应力 $p$ 和von Mises等效应力 $q$ 定义为\n$$\np \\equiv \\frac{1}{3} \\operatorname{tr}(\\sigma), \n\\qquad \nq \\equiv \\sqrt{\\frac{3}{2}} \\, \\|s\\|,\n\\qquad \ns \\equiv \\sigma - p \\, \\mathbf{I},\n$$\n其中 $\\sigma$ 是Cauchy应力张量，$\\mathbf{I}$ 是二阶单位张量。\n\nDrucker-Prager屈服函数和塑性势函数分别为\n$$\nf(\\sigma,\\kappa) \\equiv q + \\alpha \\, p - k(\\kappa),\n\\qquad\ng(\\sigma) \\equiv q + \\beta \\, p,\n$$\n其中 $\\alpha$ 是摩擦参数，$\\beta$ 是剪胀参数，$k(\\kappa)$ 是关于硬化变量 $\\kappa$ 的硬化函数。考虑由下式定义的线性各向同性硬化\n$$\nk(\\kappa) = \\sigma_{y0} + H \\, \\kappa,\n$$\n其中 $\\sigma_{y0}$ 是初始屈服强度，$H \\ge 0$ 是常塑性模量。令硬化变量为累积等效塑性应变 $\\kappa \\equiv \\bar{\\varepsilon}^{p}$，其演化规律为\n$$\n\\mathrm{d}\\bar{\\varepsilon}^{p} = \\sqrt{\\frac{2}{3}} \\, \\|\\mathrm{d}\\varepsilon^{p}\\|,\n\\qquad\n\\mathrm{d}\\varepsilon^{p} = \\mathrm{d}\\lambda \\, \\frac{\\partial g}{\\partial \\sigma},\n$$\n其中 $\\mathrm{d}\\lambda \\ge 0$ 是塑性一致性参数。\n\n在率形式弹塑性框架下，利用一致性条件和一致（算法）线性化方法，计算算法体积模量 $K_{\\mathrm{alg}}$。该模量定义为：当施加的应变增量为纯体积形式时，在屈服面上塑性加载期间，$\\mathrm{d}p$ 与施加的体积应变增量 $\\mathrm{d}\\varepsilon_{v} \\equiv \\operatorname{tr}(\\mathrm{d}\\varepsilon)$ 之间的比例因子，\n$$\n\\mathrm{d}\\varepsilon = \\frac{1}{3} \\, \\mathrm{d}\\varepsilon_{v} \\, \\mathbf{I}.\n$$\n\n请用一个只包含 $K$、$G$、$\\alpha$、$\\beta$ 和 $H$ 的单个闭式解析表达式来表示您的答案。请勿代入具体数值，无需取整，最终表达式中请勿包含单位。", "solution": "该问题是连续介质力学和计算塑性力学中的一个适定问题，基于已确立的科学原理和Drucker-Prager模型的形式体系，因此是有效的。\n\n目标是计算经历塑性加载材料的算法体积模量 $K_{\\mathrm{alg}}$。该算法模量源于离散应力更新算法（返回映射）的一致线性化。给定一个特定的加载条件：纯体积应变增量 $\\mathrm{d}\\varepsilon = \\frac{1}{3} \\mathrm{d}\\varepsilon_{v} \\, \\mathbf{I}$。对于有限增量，即为 $\\Delta\\varepsilon = \\frac{1}{3} \\Delta\\varepsilon_{v} \\, \\mathbf{I}$。算法体积模量由关系式 $\\Delta p = K_{\\mathrm{alg}} \\Delta\\varepsilon_v$ 定义，其中 $\\Delta p$ 是平均应力的总增量。\n\n应力更新过程遵循弹性预测-塑性修正格式。设增量步开始时的状态为 $(\\sigma_n, \\kappa_n)$，该状态位于屈服面上，因此 $f(\\sigma_n, \\kappa_n) = 0$。\n\n首先，计算试探弹性应力 $\\sigma_{n+1}^{\\text{tr}}$：\n$$\n\\sigma_{n+1}^{\\text{tr}} = \\sigma_n + \\mathbf{C}^e : \\Delta\\varepsilon\n$$\n其中 $\\mathbf{C}^e$ 是各向同性弹性刚度张量，$\\mathbf{C}^e = 2G \\mathbf{P}_{\\text{sym}} + K \\mathbf{I} \\otimes \\mathbf{I}$。对于给定的纯体积应变增量 $\\Delta\\varepsilon = \\frac{1}{3}\\Delta\\varepsilon_v \\mathbf{I}$，试探应力增量是纯静水性质的：\n$$\n\\Delta\\sigma^{\\text{tr}} = \\mathbf{C}^e : \\left(\\frac{1}{3}\\Delta\\varepsilon_v \\mathbf{I}\\right) = (K \\mathbf{I} \\otimes \\mathbf{I}) : \\left(\\frac{1}{3}\\Delta\\varepsilon_v \\mathbf{I}\\right) = K \\Delta\\varepsilon_v \\mathbf{I}\n$$\n因此试探应力为 $\\sigma_{n+1}^{\\text{tr}} = \\sigma_n + K \\Delta\\varepsilon_v \\mathbf{I}$。试探应力的偏量部分保持不变，$s_{n+1}^{\\text{tr}} = s_n$，这意味着试探von Mises应力 $q_{n+1}^{\\text{tr}} = q_n$。试探平均应力为 $p_{n+1}^{\\text{tr}} = p_n + K \\Delta\\varepsilon_v$。\n\n对试探状态检查屈服条件：\n$$\nf^{\\text{tr}} = f(\\sigma_{n+1}^{\\text{tr}}, \\kappa_n) = q_{n+1}^{\\text{tr}} + \\alpha p_{n+1}^{\\text{tr}} - k(\\kappa_n) = q_n + \\alpha (p_n + K \\Delta\\varepsilon_v) - k(\\kappa_n)\n$$\n由于初始状态在屈服面上，所以 $q_n + \\alpha p_n - k(\\kappa_n) = 0$。因此，$f^{\\text{tr}} = \\alpha K \\Delta\\varepsilon_v$。如果 $f^{\\text{tr}} > 0$，则发生塑性加载。我们假设此条件成立。\n\n如果 $f^{\\text{tr}} > 0$，则需要进行塑性修正。最终应力 $\\sigma_{n+1}$ 是通过将试探应力返回到更新后的屈服面上获得的。更新方程如下：\n$$\n\\sigma_{n+1} = \\sigma_{n+1}^{\\text{tr}} - \\Delta\\varepsilon^p_c : \\mathbf{C}^e = \\sigma_{n+1}^{\\text{tr}} - \\Delta\\lambda \\, \\mathbf{C}^e : \\frac{\\partial g}{\\partial \\sigma}\\bigg|_{\\sigma_{n+1}}\n$$\n$$\n\\kappa_{n+1} = \\kappa_n + \\Delta\\kappa\n$$\n$$\nf(\\sigma_{n+1}, \\kappa_{n+1}) = 0\n$$\n塑性势函数 $g(\\sigma) = q + \\beta p$ 的梯度为 $\\frac{\\partial g}{\\partial \\sigma} = \\frac{\\partial q}{\\partial \\sigma} + \\beta \\frac{\\partial p}{\\partial \\sigma}$。由于 $\\frac{\\partial p}{\\partial \\sigma} = \\frac{1}{3}\\mathbf{I}$ 且 $\\frac{\\partial q}{\\partial \\sigma} = \\sqrt{\\frac{3}{2}} \\frac{s}{\\|s\\|} \\equiv \\sqrt{\\frac{3}{2}} \\mathbf{N}$，我们有：\n$$\n\\frac{\\partial g}{\\partial \\sigma} \\equiv \\mathbf{B} = \\sqrt{\\frac{3}{2}}\\mathbf{N} + \\frac{\\beta}{3}\\mathbf{I}\n$$\n弹性张量作用于 $\\mathbf{B}_{n+1}$ 的结果为：$\\mathbf{C}^e : \\mathbf{B}_{n+1} = 2G \\sqrt{\\frac{3}{2}}\\mathbf{N}_{n+1} + K \\beta \\mathbf{I}$。\n应力更新分解为偏量和体积两部分：\n$$\ns_{n+1} = s_{n+1}^{\\text{tr}} - \\Delta\\lambda \\, (2G \\sqrt{\\frac{3}{2}}\\mathbf{N}_{n+1}) = s_n - 3G \\Delta\\lambda \\mathbf{N}_{n+1}\n$$\n$$\np_{n+1} = p_{n+1}^{\\text{tr}} - \\Delta\\lambda \\, K \\beta = p_n + K\\Delta\\varepsilon_v - K\\beta\\Delta\\lambda\n$$\n从 $s_{n+1}$ 的方程可以看出，$s_{n+1}$ 必须与 $s_n$ 共轴，这意味着偏应力的方向在修正过程中不发生改变：$\\mathbf{N}_{n+1} = \\mathbf{N}_n \\equiv \\mathbf{N}$。这极大地简化了问题，因为 $\\mathbf{B}$ 在返回映射过程中变为常数。\nvon Mises应力 $q$ 的更新变为：\n$$\nq_{n+1} = \\sqrt{\\frac{3}{2}}\\|s_{n+1}\\| = \\sqrt{\\frac{3}{2}}(\\|s_n\\| - 3G\\Delta\\lambda) = q_n - 3G\\Delta\\lambda\n$$\n硬化变量 $\\kappa$ 通过 $\\Delta\\kappa = \\Delta\\bar{\\varepsilon}^p = \\sqrt{\\frac{2}{3}\\|\\Delta\\varepsilon^p\\|^2}$ 进行更新。塑性应变增量为 $\\Delta\\varepsilon^p = \\Delta\\lambda \\, \\mathbf{B}$。\n$$\n\\|\\mathbf{B}\\|^2 = \\mathbf{B}:\\mathbf{B} = \\left(\\sqrt{\\frac{3}{2}}\\mathbf{N} + \\frac{\\beta}{3}\\mathbf{I}\\right):\\left(\\sqrt{\\frac{3}{2}}\\mathbf{N} + \\frac{\\beta}{3}\\mathbf{I}\\right) = \\frac{3}{2}(\\mathbf{N}:\\mathbf{N}) + \\frac{\\beta^2}{9}(\\mathbf{I}:\\mathbf{I}) = \\frac{3}{2} + \\frac{\\beta^2}{3}\n$$\n因此，$\\Delta\\kappa = \\Delta\\lambda \\sqrt{\\frac{2}{3}\\left(\\frac{3}{2} + \\frac{\\beta^2}{3}\\right)} = \\Delta\\lambda \\sqrt{1 + \\frac{2\\beta^2}{9}}$。\n硬化函数的更新为 $k_{n+1} = k_n + H\\Delta\\kappa = k_n + H\\Delta\\lambda\\sqrt{1 + \\frac{2\\beta^2}{9}}$。\n\n最终状态必须满足一致性条件 $f(\\sigma_{n+1}, \\kappa_{n+1})=0$：\n$$\nq_{n+1} + \\alpha p_{n+1} - k_{n+1} = 0\n$$\n代入 $q_{n+1}$、$p_{n+1}$ 和 $k_{n+1}$ 的表达式：\n$$\n(q_n - 3G\\Delta\\lambda) + \\alpha(p_n + K\\Delta\\varepsilon_v - K\\beta\\Delta\\lambda) - \\left(k_n + H\\Delta\\lambda\\sqrt{1 + \\frac{2\\beta^2}{9}}\\right) = 0\n$$\n按 $\\Delta\\lambda$ 合并同类项，并利用 $q_n + \\alpha p_n - k_n = f(\\sigma_n, \\kappa_n) = 0$：\n$$\n\\alpha K \\Delta\\varepsilon_v - \\Delta\\lambda \\left( 3G + K\\alpha\\beta + H\\sqrt{1 + \\frac{2\\beta^2}{9}} \\right) = 0\n$$\n求解塑性乘子 $\\Delta\\lambda$：\n$$\n\\Delta\\lambda = \\frac{\\alpha K \\Delta\\varepsilon_v}{3G + K\\alpha\\beta + H\\sqrt{1 + \\frac{2\\beta^2}{9}}}\n$$\n平均应力增量为 $\\Delta p = p_{n+1} - p_n = K\\Delta\\varepsilon_v - K\\beta\\Delta\\lambda$。\n代入 $\\Delta\\lambda$ 的表达式：\n$$\n\\Delta p = K\\Delta\\varepsilon_v - K\\beta \\left( \\frac{\\alpha K \\Delta\\varepsilon_v}{3G + K\\alpha\\beta + H\\sqrt{1 + \\frac{2\\beta^2}{9}}} \\right)\n$$\n提取公因子 $\\Delta\\varepsilon_v$：\n$$\n\\Delta p = \\left( K - \\frac{K^2\\alpha\\beta}{3G + K\\alpha\\beta + H\\sqrt{1 + \\frac{2\\beta^2}{9}}} \\right) \\Delta\\varepsilon_v\n$$\n根据定义，$K_{\\mathrm{alg}} = \\frac{\\Delta p}{\\Delta\\varepsilon_v}$。因此，算法体积模量为：\n$$\nK_{\\mathrm{alg}} = K - \\frac{K^2\\alpha\\beta}{3G + K\\alpha\\beta + H\\sqrt{1 + \\frac{2\\beta^2}{9}}}\n$$\n该表达式以所需参数 $K$、$G$、$\\alpha$、$\\beta$ 和 $H$ 表示。", "answer": "$$\n\\boxed{\nK - \\frac{K^{2} \\alpha \\beta}{3G + K \\alpha \\beta + H \\sqrt{1 + \\frac{2 \\beta^{2}}{9}}}\n}\n$$", "id": "2547037"}, {"introduction": "理论推导和代码实现是相辅相成的，但我们如何确信编写的复杂本构关系代码是正确的？本节的最后一个练习将带你实践验证用户自定义材料（UMAT）开发的黄金准则：通过有限差分扰动进行切线算子检验。你将设计并实现一个数值测试，用数值方法计算的切线算子来验证解析推导的一致性切线算子。这项技能对于任何严肃的计算力学开发者来说都是不可或缺的，它确保了有限元模型在全局 Newton 迭代中的二次收敛性和计算结果的可靠性。[@problem_id:2547062]", "problem": "设计并实现一个独立的程序，构建一个有限差分扰动测试，以数值方式验证一个已编码的、针对小应变、关联、各向同性、率无关且具有线性各向同性硬化弹塑性模型的一致弹塑性切线算子。目标是验证一致弹塑性切线算子 $C^{ep}$ 在给定容差范围内，对每个独立的对称应变分量 $(k,l)$，都满足方向导数的定义\n$$\nC^{ep}_{ijkl} \\approx \\frac{\\sigma_{ij}(\\varepsilon + \\delta\\,\\Delta\\varepsilon^{(kl)}) - \\sigma_{ij}(\\varepsilon)}{\\delta}\n$$\n其中 $\\Delta\\varepsilon^{(kl)}$ 是对称扰动方向，对应于对称应变张量的 $(k,l)$ 分量上的单位扰动。\n\n材料模型建立在三维空间中，且基于小应变假设。使用以下基本且被广泛接受的事实：\n\n- 运动学：无穷小应变张量为 $\\varepsilon = \\tfrac{1}{2}(\\nabla u + \\nabla u^{T})$，其迹为 $\\mathrm{tr}(\\varepsilon)$，偏量部分为 $\\mathrm{dev}(\\varepsilon) = \\varepsilon - \\tfrac{1}{3}\\mathrm{tr}(\\varepsilon)\\,I$，其中 $I$ 是二阶单位张量。\n- 各向同性线弹性：体积模量 $K = \\dfrac{E}{3(1-2\\nu)}$，剪切模量 $\\mu = \\dfrac{E}{2(1+\\nu)}$，以及用四阶张量表示的弹性刚度 $C^{e} = K\\,I\\otimes I + 2\\mu\\,I^{\\mathrm{dev}}$，其中 $I^{\\mathrm{dev}}$ 是四阶偏量投影算子。\n- 基于偏应力 $s$ 的 Frobenius 范数的 von Mises 型屈服函数：定义 $q = \\|s\\| = \\sqrt{s:s}$ 和屈服函数 $f(s,\\alpha) = q - (\\sigma_{y0} + H\\,\\alpha)$，其中 $\\sigma_{y0}$ 是初始屈服应力， $H$ 是线性各向同性硬化模量。内变量 $\\alpha$ 是累积塑性应变，其增量为 $\\Delta \\alpha = \\Delta \\gamma$，其中 $\\Delta \\gamma$ 是塑性乘子增量。\n- 关联流动法则和标准返回映射算法：在一个从初始无应力状态（$\\alpha_{n} = 0$）开始的增量步中，构建试探偏应力 $s^{\\mathrm{tr}} = 2\\mu\\,\\mathrm{dev}(\\varepsilon)$，其范数 $r = \\|s^{\\mathrm{tr}}\\|$，以及 $c = \\sigma_{y0} + H\\,\\alpha_{n} = \\sigma_{y0}$。如果 $r \\le c$，则响应为弹性的。如果 $r > c$，则发生塑性修正，采用径向返回：定义单位法向量 $n = s^{\\mathrm{tr}}/r$，塑性乘子 $\\Delta \\gamma = \\dfrac{r - c}{2\\mu + H}$，以及修正后的偏应力 $s = s^{\\mathrm{tr}} - 2\\mu\\,\\Delta \\gamma\\,n$。Cauchy 应力为 $\\sigma = K\\,\\mathrm{tr}(\\varepsilon)\\,I + s$。\n\n你的任务是：\n\n- 实现一个函数，对于给定的对称应变张量 $\\varepsilon$，返回 Cauchy 应力张量 $\\sigma(\\varepsilon)$ 和一致弹塑性切线算子 $C^{ep}(\\varepsilon)$。该算子通过对上述返回映射方程在收敛应力状态附近进行线性化得到。\n- 实现一个有限差分（前向差分）扰动程序，通过扰动对称应变张量的 $(k,l)$ 分量来近似每一列 $C^{ep}_{ij\\,kl}$。扰动必须保持对称性：对于 $k=l$，设置 $\\Delta\\varepsilon^{(kk)}_{kk} = \\delta$；对于 $k\\ne l$，设置 $\\Delta\\varepsilon^{(kl)}_{kl} = \\Delta\\varepsilon^{(kl)}_{lk} = \\delta/2$，且所有其他分量为零，使得\n$$\n\\frac{\\sigma_{ij}(\\varepsilon + \\delta\\,\\Delta\\varepsilon^{(kl)}) - \\sigma_{ij}(\\varepsilon)}{\\delta} \\approx C^{ep}_{ij\\,kl}.\n$$\n- 通过为每个测试用例计算在所有独立的 $(k,l)$ 上的最大相对 Frobenius 范数误差来量化验证过程：\n$$\n\\mathrm{err} = \\max_{k\\le l} \\frac{\\left\\| \\frac{\\sigma(\\varepsilon + \\delta\\,\\Delta\\varepsilon^{(kl)}) - \\sigma(\\varepsilon)}{\\delta} - C^{ep}:\\Delta\\varepsilon^{(kl)} \\right\\|_F}{\\max\\left(\\left\\|C^{ep}:\\Delta\\varepsilon^{(kl)}\\right\\|_F,\\,1\\right)}.\n$$\n如果 $\\mathrm{err} \\le \\tau$，则宣布该测试用例通过，其中 $\\tau$ 是为该用例指定的容差。\n\n程序必须以基不变的方式实现所有四阶张量运算，使用标准的 Kronecker delta、对称四阶单位张量 $I^{\\mathrm{sym}}$、体积投影算子 $I^{\\mathrm{vol}} = \\tfrac{1}{3}I\\otimes I$ 和偏量投影算子 $I^{\\mathrm{dev}} = I^{\\mathrm{sym}} - I^{\\mathrm{vol}}$，并且必须生成单行输出，该输出汇总了所提供测试套件的通过/失败布尔值。\n\n使用以下参数值的测试套件，该套件旨在覆盖典型的弹性状态、位于塑性区深处的塑性状态以及静水压弹性状态。所有数值都是无量纲但一致的；最终输出是布尔值，因此无单位。\n\n- 所有测试通用的材料参数：杨氏模量 $E = 2.1\\times 10^{5}$，泊松比 $\\nu = 0.3$，初始屈服应力 $\\sigma_{y0} = 250$，硬化模量 $H = 1000$。\n- 有限差分的扰动幅度：$\\delta = 10^{-8}$。\n- 容差：\n    - 弹性区容差 $\\tau_{\\mathrm{el}} = 10^{-7}$。\n    - 塑性区容差 $\\tau_{\\mathrm{pl}} = 10^{-6}$。\n    - 静水压弹性容差 $\\tau_{\\mathrm{hy}} = 10^{-9}$。\n\n- 测试用例（每个都是一个对称应变张量 $\\varepsilon$）：\n    - 用例 A（弹性，偏-体混合）：\n      $\n      \\varepsilon =\n      \\begin{bmatrix}\n      1\\times 10^{-5} & 2\\times 10^{-6} & -1\\times 10^{-6} \\\\\n      2\\times 10^{-6} & -5\\times 10^{-6} & 0 \\\\\n      -1\\times 10^{-6} & 0 & 0\n      \\end{bmatrix}\n      $\n      容差为 $\\tau = \\tau_{\\mathrm{el}}$。\n    - 用例 B（塑性，塑性区深处）：\n      $\n      \\varepsilon =\n      \\begin{bmatrix}\n      5\\times 10^{-3} & 2\\times 10^{-3} & -1\\times 10^{-3} \\\\\n      2\\times 10^{-3} & -3\\times 10^{-3} & 5\\times 10^{-4} \\\\\n      -1\\times 10^{-3} & 5\\times 10^{-4} & -2\\times 10^{-3}\n      \\end{bmatrix}\n      $\n      容差为 $\\tau = \\tau_{\\mathrm{pl}}$。\n    - 用例 C（纯静水压弹性）：\n      $\n      \\varepsilon =\n      \\begin{bmatrix}\n      1\\times 10^{-3} & 0 & 0 \\\\\n      0 & 1\\times 10^{-3} & 0 \\\\\n      0 & 0 & 1\\times 10^{-3}\n      \\end{bmatrix}\n      $\n      容差为 $\\tau = \\tau_{\\mathrm{hy}}$。\n\n程序要求：\n\n- 程序必须为每个测试用例计算由上述误差度量和容差定义的通过/失败布尔结果。\n- 你的程序应生成单行输出，其中包含按测试用例 A、B、C 顺序排列的结果，格式为方括号内以逗号分隔的列表（例如：“[True,True,False]”）。\n- 不允许用户输入；所有数据必须嵌入程序中。\n\n注：所有数学推导和实现都必须遵守张量的小对称性和大对称性。对非对角线分量的扰动必须在两个对称位置上拆分为 $\\delta/2$，以表示对 $k\\ne l$ 的单个独立分量 $\\varepsilon_{kl}$ 的单位扰动。", "solution": "任务是设计并实现一个数值测试，以验证一个已编码的、针对具有线性各向同性硬化的小应变 $J_2$ 塑性模型的一致弹塑性切线算子 $C^{ep}$ 的正确性。该验证基于切线算子作为应力张量 $\\sigma$ 相对于应变张量 $\\varepsilon$ 的方向导数的定义，并使用前向有限差分格式进行近似。\n\n首先定义本构模型。总应变 $\\varepsilon$ 被加法分解为弹性部分 $\\varepsilon^e$ 和塑性部分 $\\varepsilon^p$。该模型以率无关的增量形式定义。对于给定的总应变 $\\varepsilon$（相对于初始无应力状态），确定应力 $\\sigma$ 和一致切线算子 $C^{ep}$。\n\n基本关系如下：\n- **弹性定律**：对于各向同性材料，应力通过胡克定律与弹性应变相关。将应力和应变分解为体积和偏量部分会很方便。应力的体积部分（压力 $p$）通过体积模量 $K = \\frac{E}{3(1-2\\nu)}$ 与体积应变（$\\mathrm{tr}(\\varepsilon)$）相关。偏应力 $s$ 通过剪切模量 $\\mu = \\frac{E}{2(1+\\nu)}$ 与偏弹性应变 $\\mathrm{dev}(\\varepsilon^e)$ 相关。总 Cauchy 应力为 $\\sigma = K\\,\\mathrm{tr}(\\varepsilon^e)I + 2\\mu\\,\\mathrm{dev}(\\varepsilon^e)$。由于假设塑性流动是体积不变的，即 $\\mathrm{tr}(\\varepsilon^p)=0$，这意味着 $\\mathrm{tr}(\\varepsilon^e) = \\mathrm{tr}(\\varepsilon)$。因此，$\\sigma = K\\,\\mathrm{tr}(\\varepsilon)I + s$，其中 $s = 2\\mu\\,\\mathrm{dev}(\\varepsilon^e)$。\n\n- **屈服准则**：当 von Mises 屈服函数 $f(\\sigma, \\alpha)$ 达到零时，发生塑性变形。该函数定义为 $f(s, \\alpha) = q - (\\sigma_{y0} + H\\alpha)$，其中 $q = \\|s\\|_F = \\sqrt{s:s}$ 是偏应力的 Frobenius 范数，$\\sigma_{y0}$ 是初始屈服应力， $H$ 是线性各向同性硬化模量，$\\alpha$ 是累积塑性应变。\n\n- **流动法则与返回映射**：关联流动法则规定塑性应变的增量垂直于屈服面。对于 von Mises 准则，这意味着偏应力和塑性应变率是共轴的。状态更新使用标准的径向返回映射算法执行。\n1.  计算试探弹性偏应力：$s^{\\mathrm{tr}} = 2\\mu\\,\\mathrm{dev}(\\varepsilon)$。\n2.  评估试探屈服函数：$f^{\\mathrm{tr}} = \\|s^{\\mathrm{tr}}\\| - \\sigma_y$，其中 $\\sigma_y = \\sigma_{y0} + H\\alpha_n$。由于问题指定了从原始状态开始的增量，因此 $\\alpha_n=0$，所以 $\\sigma_y = \\sigma_{y0}$。\n3.  如果 $f^{\\mathrm{tr}} \\le 0$，则该步为弹性的。状态更新为 $s = s^{\\mathrm{tr}}$，不发生塑性应变（$\\Delta\\alpha=0$）。\n4.  如果 $f^{\\mathrm{tr}} > 0$，则发生塑性流动。塑性乘子增量 $\\Delta\\gamma$ 计算为 $\\Delta\\gamma = \\frac{f^{\\mathrm{tr}}}{2\\mu + H}$。偏应力通过径向路径返回到屈服面上：$s = s^{\\mathrm{tr}} - 2\\mu\\Delta\\gamma n$，其中 $n = s^{\\mathrm{tr}}/\\|s^{\\mathrm{tr}}\\|$ 是单位法线方向。累积塑性应变更新为：$\\alpha = \\alpha_n + \\Delta\\gamma = \\Delta\\gamma$。\n\n一致切线算子 $C^{ep} = \\frac{d\\sigma}{d\\varepsilon}$ 是通过对此返回映射算法进行解析线性化得到的。$C^{ep}$ 的形式取决于该步是弹性的还是塑性的。\n- **弹性切线**：如果状态是弹性的，应力与应变线性相关，$\\sigma = C^e : \\varepsilon$，其中 $C^e$ 是四阶弹性刚度张量。切线算子就是 $C^{ep} = C^e = K(I \\otimes I) + 2\\mu I^{\\mathrm{dev}}$。这里，$I$ 是二阶单位张量，$I \\otimes I$ 是体积投影算子（由 1/3 缩放），$I^{\\mathrm{dev}} = I^{\\mathrm{sym}} - \\frac{1}{3}I \\otimes I$ 是偏量投影算子，其中 $I^{\\mathrm{sym}}_{ijkl} = \\frac{1}{2}(\\delta_{ik}\\delta_{jl} + \\delta_{il}\\delta_{jk})$。\n\n- **弹塑性切线**：如果状态是塑性的，径向返回算法的线性化会产生一致切线。推导过程包括对返回映射方程中的所有变量应用链式法则。得到的算子是：\n$$ C^{ep} = K(I \\otimes I) + 2\\mu(1-\\beta)I^{\\mathrm{dev}} - 2\\mu\\gamma_c(n \\otimes n) $$\n其中 $r = \\|s^{\\mathrm{tr}}\\|$，$n=s^{\\mathrm{tr}}/r$，系数 $\\beta$ 和 $\\gamma_c$ 由以下公式给出：\n$$ \\beta = \\frac{2\\mu\\Delta\\gamma}{r} $$\n$$ \\gamma_c = \\frac{2\\mu}{2\\mu+H} - \\beta $$\n这种形式确保了其所设计的 Newton-Raphson 求解器具有二次收敛性。\n\n数值验证，或称扰动测试，其结构如下：\n1.  对于给定的应变张量 $\\varepsilon$，使用上述材料模型逻辑计算基准应力 $\\sigma(\\varepsilon)$ 和解析切线算子 $C^{ep}(\\varepsilon)$。\n2.  定义一组六个线性无关的对称扰动方向张量 $\\{V^{(p)}\\}_{p=1}^6$。这些方向对应于 Voigt 标记法框架下应变张量独立分量的单位扰动。例如，对 $\\varepsilon_{11}$ 的扰动对应于在 (1,1) 分量上为 1 的 $V^{(1)}$。对 $\\varepsilon_{12}$ 的扰动对应于在 (1,2) 和 (2,1) 分量上均为 0.5 的 $V^{(4)}$。\n3.  对于每个扰动方向 $V^{(p)}$，执行以下操作：\n    a.  计算扰动后的应变 $\\varepsilon' = \\varepsilon + \\delta V^{(p)}$，其中 $\\delta$ 是一个小数（例如 $10^{-8}$）。\n    b.  通过重新运行完整的材料模型，计算扰动状态下的应力 $\\sigma' = \\sigma(\\varepsilon')$。\n    c.  计算方向导数的数值近似值：$D_{\\mathrm{num}}^{(p)} = \\frac{\\sigma' - \\sigma}{\\delta}$。\n    d.  使用一致切线算子计算解析方向导数：$D_{\\mathrm{ana}}^{(p)} = C^{ep} : V^{(p)}$。\n    e.  计算数值结果和解析结果之间的相对误差：\n        $$ \\mathrm{err}^{(p)} = \\frac{\\|D_{\\mathrm{num}}^{(p)} - D_{\\mathrm{ana}}^{(p)}\\|_F}{\\max(\\|D_{\\mathrm{ana}}^{(p)}\\|_F, 1.0)} $$\n        分母中的下限值 1.0 可防止除以零，并在解析导数很小时提供绝对误差的度量。\n4.  测试用例的总体误差是在所有六个扰动方向上发现的最大误差，$\\mathrm{err} = \\max_{p} \\mathrm{err}^{(p)}$。\n5.  将此误差与指定的容差 $\\tau$ 进行比较。如果 $\\mathrm{err} \\le \\tau$，则测试通过。\n\n实现使用 `numpy` 进行所有张量表示和运算。二阶张量表示为 $3 \\times 3$ 数组，四阶张量表示为 $3 \\times 3 \\times 3 \\times 3$ 数组。张量缩并（点积、外积）通过使用 `numpy.einsum` 得以优雅地处理。程序遍历提供的测试用例，每个用例都带有一个特定的应变张量和容差，并为每个用例报告一个通过/失败的布尔结果。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the finite-difference perturbation test for the\n    consistent elastoplastic tangent operator.\n    \"\"\"\n    \n    # Material parameters (common to all tests)\n    E = 2.1e5\n    NU = 0.3\n    SIGMA_Y0 = 250.0\n    H = 1000.0\n    \n    # Numerical parameters\n    DELTA = 1e-8\n    \n    # Test cases: (strain_tensor, tolerance)\n    TOL_EL = 1e-7\n    TOL_PL = 1e-6\n    TOL_HY = 1e-9\n    \n    test_cases = [\n        (np.array([\n            [1e-5, 2e-6, -1e-6],\n            [2e-6, -5e-6, 0.0],\n            [-1e-6, 0.0, 0.0]\n        ]), TOL_EL, \"Elastic\"),\n        (np.array([\n            [5e-3, 2e-3, -1e-3],\n            [2e-3, -3e-3, 5e-4],\n            [-1e-3, 5e-4, -2e-3]\n        ]), TOL_PL, \"Plastic\"),\n        (np.array([\n            [1e-3, 0.0, 0.0],\n            [0.0, 1e-3, 0.0],\n            [0.0, 0.0, 1e-3]\n        ]), TOL_HY, \"Hydrostatic Elastic\"),\n    ]\n\n    # Pre-compute derived material properties and constant tensors\n    K_bulk = E / (3.0 * (1.0 - 2.0 * NU))\n    MU_shear = E / (2.0 * (1.0 + NU))\n\n    I = np.eye(3)\n    # Note: np.einsum is used for basis-agnostic tensor algebra\n    I_dyad_I = np.einsum('ij,kl->ijkl', I, I)\n    \n    # Symmetric fourth-order identity tensor I_sym\n    delta = np.eye(3)\n    I_sym = 0.5 * (np.einsum('ik,jl', delta, delta) + np.einsum('il,jk', delta, delta))\n    \n    # Deviatoric projection tensor\n    I_dev = I_sym - (1.0/3.0) * I_dyad_I\n\n    def get_stress_and_tangent(epsilon):\n        \"\"\"\n        Computes Cauchy stress and consistent tangent for small-strain J2 plasticity.\n        \"\"\"\n        tr_eps = np.trace(epsilon)\n        dev_eps = epsilon - (tr_eps / 3.0) * I\n        \n        s_tr = 2.0 * MU_shear * dev_eps\n        r_tr = np.linalg.norm(s_tr)\n        \n        # Machine precision epsilon for safe division\n        machine_eps = 1e-12 \n\n        # Yield condition check\n        yield_check = r_tr - SIGMA_Y0\n        \n        if yield_check <= 0.0 or r_tr < machine_eps:\n            # Elastic case\n            sigma = K_bulk * tr_eps * I + s_tr\n            C_ep = K_bulk * I_dyad_I + 2.0 * MU_shear * I_dev\n        else:\n            # Plastic case (radial return)\n            n_dir = s_tr / r_tr\n            delta_gamma = yield_check / (2.0 * MU_shear + H)\n            \n            s = s_tr - 2.0 * MU_shear * delta_gamma * n_dir\n            sigma = K_bulk * tr_eps * I + s\n            \n            # Consistent elastoplastic tangent\n            beta = 2.0 * MU_shear * delta_gamma / r_tr\n            gamma_c = (2.0 * MU_shear / (2.0 * MU_shear + H)) - beta\n            \n            n_dyad_n = np.einsum('ij,kl->ijkl', n_dir, n_dir)\n            \n            C_ep = (K_bulk * I_dyad_I + \n                    2.0 * MU_shear * (1.0 - beta) * I_dev - \n                    2.0 * MU_shear * gamma_c * n_dyad_n)\n            \n        return sigma, C_ep\n\n    # Perturbation directions corresponding to Voigt basis\n    perturb_dirs = []\n    # Diagonal components\n    for i in range(3):\n        v = np.zeros((3, 3))\n        v[i, i] = 1.0\n        perturb_dirs.append(v)\n    # Off-diagonal components\n    for i, j in [(0, 1), (0, 2), (1, 2)]:\n        v = np.zeros((3, 3))\n        v[i, j] = 0.5\n        v[j, i] = 0.5\n        perturb_dirs.append(v)\n\n    results = []\n    for epsilon_base, tolerance, _ in test_cases:\n        sigma_base, C_ep_base = get_stress_and_tangent(epsilon_base)\n        \n        max_err = 0.0\n        for v_dir in perturb_dirs:\n            # Perturb strain\n            epsilon_pert = epsilon_base + DELTA * v_dir\n            \n            # Get perturbed stress\n            sigma_pert, _ = get_stress_and_tangent(epsilon_pert)\n            \n            # Numerical directional derivative (Forward Difference)\n            D_num = (sigma_pert - sigma_base) / DELTA\n            \n            # Analytical directional derivative\n            D_ana = np.einsum('ijkl,kl->ij', C_ep_base, v_dir)\n            \n            # Error calculation\n            numerator = np.linalg.norm(D_num - D_ana)\n            denominator = max(np.linalg.norm(D_ana), 1.0)\n            \n            err = numerator / denominator\n            if err > max_err:\n                max_err = err\n        \n        results.append(max_err <= tolerance)\n        \n    print(f\"[{','.join(map(str, [r.lower() if isinstance(r, bool) else r for r in results]))}]\")\n\nsolve()\n```", "id": "2547062"}]}