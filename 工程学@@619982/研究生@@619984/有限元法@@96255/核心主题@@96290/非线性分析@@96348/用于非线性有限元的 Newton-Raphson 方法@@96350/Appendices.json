{"hands_on_practices": [{"introduction": "在实现求解非线性有限元问题的任何代码之前，首要任务是确保我们对基本构件——单元的内力向量 $f_{\\mathrm{int}}$ 和切向刚度矩阵 $K_T$ ——的正确性有十足的信心。一个微小的编程错误可能导致整个求解过程发散，并且极难调试。本练习将指导您实施一个至关重要的单元测试，即“切线一致性检验” (tangent consistency test)，它通过有限差分法来验证解析切线矩阵的正确性，这是保证牛顿-拉夫逊方法二次收敛速度和稳健性的基石。[@problem_id:2583316]", "problem": "考虑一个具有线性形函数和非线性本构律的单个两节点一维杆有限元。假设所有量均为无量纲。设节点位移向量为 $u \\in \\mathbb{R}^2$，单元长度为 $L > 0$，横截面积为 $A > 0$。该单元的格林-拉格朗日应变简化为恒定的工程应变 $\\varepsilon = B u$，其中应变-位移矩阵为常数 $B = \\left[-\\frac{1}{L}, \\frac{1}{L}\\right]$。柯西应力由一个光滑的非线性定律 $\\sigma(\\varepsilon) = E\\,\\varepsilon + \\alpha\\,\\varepsilon^3$ 建模，其中 $E > 0$ 是线性刚度参数，$\\alpha \\ge 0$ 控制非线性程度。根据虚功原理，内力向量由 $f_{\\mathrm{int}}(u) = \\int_{0}^{L} B^T \\sigma(\\varepsilon)\\, A\\, \\mathrm{d}x$ 给出，残差为 $R(u) = f_{\\mathrm{int}}(u) - f_{\\mathrm{ext}}$，其中 $f_{\\mathrm{ext}}\\in\\mathbb{R}^2$ 是外部节点荷载向量。求解 $R(u)=0$ 的牛顿-拉夫逊方法使用一致切线（雅可比矩阵）$K_T(u) = \\frac{\\partial R}{\\partial u}(u)$。\n\n您的任务是编写一个程序，实现一个单元测试，通过在随机扰动方向上对 $R(u)$ 进行中心有限差分方向导数计算，来验证切线 $K_T(u)$ 的一致性。该测试必须使用可复现的随机方向和理论上合理的步长。具体而言：\n\n- 从以上定义出发，仅利用两节点线性单元的 $B$ 为常数、$\\varepsilon = B u$、$f_{\\mathrm{int}}(u) = \\int_{0}^{L} B^T \\sigma(\\varepsilon)\\, A\\, \\mathrm{d}x$ 和 $\\sigma(\\varepsilon) = E\\,\\varepsilon + \\alpha\\,\\varepsilon^3$ 这些事实，推导 $R(u)$ 和 $K_T(u)$ 关于 $E$、$\\alpha$、$A$、$L$ 和 $u$ 的表达式。\n- 实现一个形式为\n$$\n\\frac{R(u + h\\,p) - R(u - h\\,p)}{2\\,h} \\approx K_T(u)\\,p,\n$$\n的中心有限差分检验，其中 $p \\in \\mathbb{R}^2$ 是一个使用固定种子生成的随机单位向量（方向），$h > 0$ 是根据浮点误差分析选择的步长。使用相对误差\n$$\ne = \\frac{\\left\\| \\frac{R(u + h\\,p) - R(u - h\\,p)}{2\\,h} - K_T(u)\\,p \\right\\|_2}{\\max\\left(1,\\;\\left\\| K_T(u)\\,p \\right\\|_2\\right)}\n$$\n并当 $e \\le \\text{rtol}$ 时，判定测试通过，其中 $\\text{rtol}$ 是指定的相对容差。\n- 基于标准的中心差分截断误差与舍入误差的权衡来选择 $h$，并根据浮点机器精度 $\\varepsilon_{\\mathrm{mach}}$ 和残差的预期曲率尺度，论证您对 $h$ 和 $\\text{rtol}$ 的选择。\n\n假设所有量均为无量纲，如果出现任何角度，则默认为弧度（此处未使用角度）。使用以下测试套件（每个案例提供 $(E,\\alpha,A,L,u,f_{\\mathrm{ext}})$），其中所有数值均为无量纲：\n\n- 案例 A（线性理想情况）：$E = 100$, $\\alpha = 0$, $A = 1$, $L = 1$, $u = [\\,0.2,\\,0.8\\,]^T$, $f_{\\mathrm{ext}} = [\\,0,\\,0\\,]^T$。\n- 案例 B（中等非线性）：$E = 200$, $\\alpha = 50$, $A = 2$, $L = 3$, $u = [\\,0.01,\\,0.03\\,]^T$, $f_{\\mathrm{ext}} = [\\,1,\\,-1\\,]^T$。\n- 案例 C（强非线性及更大应变幅值）：$E = 10$, $\\alpha = 2000$, $A = 0.8$, $L = 1.5$, $u = [\\,0.3,\\,-0.2\\,]^T$, $f_{\\mathrm{ext}} = [\\,-0.5,\\,0.2\\,]^T$。\n- 案例 D（零位移）：$E = 150$, $\\alpha = 500$, $A = 1.2$, $L = 2.5$, $u = [\\,0,\\,0\\,]^T$, $f_{\\mathrm{ext}} = [\\,0,\\,0\\,]^T$。\n\n使用固定的随机种子，以使每次运行的随机方向 $p$ 相同。对所有案例使用单一的相对容差 $\\text{rtol}$，并通过分析证明其合理性。您的程序必须为每个案例输出一个布尔结果，以表明测试是否通过。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表的结果（例如，\"[True,False,True,True]\"）。", "solution": "我们从单个两节点一维杆单元的虚功原理开始。应变-位移矩阵为常数 $B = \\left[-\\frac{1}{L}, \\frac{1}{L}\\right]$，因此应变为 $\\varepsilon = B u$。本构律为 $\\sigma(\\varepsilon) = E\\,\\varepsilon + \\alpha\\,\\varepsilon^3$。内力由虚功表达式得出\n$$\nf_{\\mathrm{int}}(u) \\equiv \\int_0^L B^T\\,\\sigma(\\varepsilon)\\,A\\,\\mathrm{d}x.\n$$\n对于线性两节点单元，$B$ 和 $\\varepsilon$ 在整个单元上是常数，因此积分简化为\n$$\nf_{\\mathrm{int}}(u) = B^T\\,\\sigma(\\varepsilon)\\,A\\, \\int_0^L \\mathrm{d}x = B^T\\,\\sigma(\\varepsilon)\\,A\\,L.\n$$\n因此，残差为\n$$\nR(u) = f_{\\mathrm{int}}(u) - f_{\\mathrm{ext}} = B^T\\,\\sigma(Bu)\\,A\\,L - f_{\\mathrm{ext}}.\n$$\n为了构建一致切线，我们将 $R(u)$ 对 $u$ 求导。注意到 $R(u)$ 仅通过 $\\sigma(Bu)$ 依赖于 $u$，我们应用链式法则：\n$$\nK_T(u) \\equiv \\frac{\\partial R}{\\partial u}(u) = B^T\\,\\frac{\\mathrm{d}\\sigma}{\\mathrm{d}\\varepsilon}\\bigg|_{\\varepsilon=Bu}\\,B\\,A\\,L.\n$$\n由于 $\\sigma(\\varepsilon) = E\\,\\varepsilon + \\alpha\\,\\varepsilon^3$，其导数为\n$$\n\\frac{\\mathrm{d}\\sigma}{\\mathrm{d}\\varepsilon} = E + 3\\,\\alpha\\,\\varepsilon^2.\n$$\n因此，$2\\times 2$ 的切线矩阵为\n$$\nK_T(u) = \\left(E + 3\\,\\alpha\\,(Bu)^2\\right)\\,A\\,L\\,\\left(B^T B\\right).\n$$\n当 $B = \\left[-\\frac{1}{L}, \\frac{1}{L}\\right]$ 时，我们有\n$$\nB^T B = \n\\begin{bmatrix}\n\\frac{1}{L^2} & -\\frac{1}{L^2} \\\\\n-\\frac{1}{L^2} & \\frac{1}{L^2}\n\\end{bmatrix},\n$$\n因此明确地\n$$\nK_T(u) = \\left(E + 3\\,\\alpha\\,\\varepsilon^2\\right)\\,A\\,\\frac{1}{L}\\,\n\\begin{bmatrix}\n1 & -1\\\\\n-1 & 1\n\\end{bmatrix},\n\\quad \\text{with} \\quad \\varepsilon = \\frac{u_2 - u_1}{L}.\n$$\n\n为了验证 $K_T(u)$ 的一致性，我们将其与 $R(u)$ 的中心有限差分方向导数进行比较。对于单位方向 $p \\in \\mathbb{R}^2$ 和步长 $h > 0$，中心差分近似为\n$$\nD_h R(u; p) \\equiv \\frac{R(u + h\\,p) - R(u - h\\,p)}{2\\,h}.\n$$\n根据 $R$ 在 $u$ 处的泰勒展开，可以证明中心差分公式消去了偶数阶误差项，其截断误差为二阶：\n$$\nD_h R(u; p) = K_T(u)\\,p + \\mathcal{O}(h^2).\n$$\n在浮点运算中，相减抵消和舍入会引入一个阶为 $\\mathcal{O}\\!\\left(\\frac{\\varepsilon_{\\mathrm{mach}}}{h}\\right)$ 的额外误差项，其中 $\\varepsilon_{\\mathrm{mach}}$ 是机器精度。因此，总误差的行为类似于\n$$\n\\|D_h R(u; p) - K_T(u)\\,p\\|_2 \\approx C_1\\,h^2 + C_2\\,\\frac{\\varepsilon_{\\mathrm{mach}}}{h},\n$$\n其中 $C_1$ 和 $C_2$ 是由高阶导数和量级决定的、与问题相关的常数。权衡这些误差项，建议选择 $h$ 的量级为 $h \\sim \\varepsilon_{\\mathrm{mach}}^{1/3}$，并附加一个反映 $\\|u\\|_2$ 的比例因子。因此我们选择\n$$\nh = \\varepsilon_{\\mathrm{mach}}^{1/3}\\,\\max\\!\\left(1,\\;\\|u\\|_2\\right),\n$$\n这可以在不同位移量级的案例中同时控制截断误差和舍入误差。\n\n我们衡量一个相对误差\n$$\ne = \\frac{\\left\\| D_h R(u;p) - K_T(u)\\,p \\right\\|_2}{\\max\\left(1,\\;\\left\\| K_T(u)\\,p \\right\\|_2\\right)},\n$$\n如果 $e \\le \\text{rtol}$，则判定测试通过。对于双精度浮点数，$\\varepsilon_{\\mathrm{mach}} \\approx 2.22\\times 10^{-16}$，因此 $\\varepsilon_{\\mathrm{mach}}^{1/3} \\approx 6\\times 10^{-6}$。在纯线性情况下，中心差分在精确算术中是精确的，观测到的误差受限于舍入误差，通常在 $\\mathcal{O}(10^{-11})$ 或更小。在非线性情况下，截断项与 $h^2$ 和一个由高阶导数决定的曲率量级成比例。此处 $\\sigma''(\\varepsilon) = 6\\,\\alpha\\,\\varepsilon$，因此对于中等应变和高达 $2000$ 的 $\\alpha$ 值，当 $h \\approx 6\\times 10^{-6}$ 时，截断误差贡献的保守界限相对而言在 $10^{-7}$ 到 $10^{-8}$ 之间，具体取决于 $K_T(u)\\,p$ 的量级。为确保在所提供的测试套件中（包括具有较大 $|\\varepsilon|$ 的强非线性情况）的稳健性，我们设定一个单一的容差\n$$\n\\text{rtol} = 10^{-6},\n$$\n该容差可以轻松地容纳最坏情况下的截断误差估计，同时又足够严格以检测不一致性。\n\n程序中实现的算法步骤：\n- 对于每个测试案例，解析 $(E,\\alpha,A,L,u,f_{\\mathrm{ext}})$。\n- 定义 $B = \\left[-\\frac{1}{L}, \\frac{1}{L}\\right]$，计算 $\\varepsilon = B u$，计算 $\\sigma(\\varepsilon) = E\\,\\varepsilon + \\alpha\\,\\varepsilon^3$，然后计算 $R(u) = B^T\\,\\sigma(\\varepsilon)\\,A\\,L - f_{\\mathrm{ext}}$。\n- 计算 $K_T(u) = B^T\\,(E + 3\\,\\alpha\\,\\varepsilon^2)\\,B\\,A\\,L$。\n- 使用固定种子生成一个可复现的随机方向 $p$，并将其归一化为单位长度。\n- 选择 $h = \\varepsilon_{\\mathrm{mach}}^{1/3}\\,\\max(1,\\|u\\|_2)$。\n- 计算 $D_h R(u;p)$ 和相对误差 $e$，并检查 $e \\le \\text{rtol}$。\n- 对每个案例，在单行中的一个方括号列表里输出一个布尔值。\n\n最终输出是类似“[True,True,True,True]”的单行文本。此单元测试设计通过一个精度控制的有限差分检验来验证牛顿-拉夫逊一致切线 $K_T(u)$，该检验的容差基于浮点限制和截断误差分析，具有合理的理论依据。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef residual(u, E, alpha, A, L, f_ext):\n    \"\"\"\n    Compute residual R(u) = f_int(u) - f_ext for a 2-node 1D bar element\n    with nonlinear constitutive law sigma = E*eps + alpha*eps^3.\n    \"\"\"\n    # B = [-1/L, 1/L]\n    B = np.array([-1.0 / L, 1.0 / L])\n    eps = float(B @ u)\n    sigma = E * eps + alpha * (eps ** 3)\n    f_int = (A * L) * (B[:, None] * sigma)  # B^T * sigma * A * L; shape (2,1)\n    # Convert to 1D array and subtract external load\n    return f_int.ravel() - f_ext\n\ndef tangent(u, E, alpha, A, L):\n    \"\"\"\n    Compute consistent tangent K_T(u) = B^T * (d sigma/d eps) * B * A * L\n    where d sigma/d eps = E + 3*alpha*eps^2.\n    \"\"\"\n    B = np.array([-1.0 / L, 1.0 / L])\n    eps = float(B @ u)\n    dsig = E + 3.0 * alpha * (eps ** 2)\n    K = (A * L) * dsig * np.outer(B, B)\n    return K\n\ndef central_diff_check(u, params, rng, rtol):\n    \"\"\"\n    Perform central difference directional derivative check:\n    (R(u+h p) - R(u-h p))/(2h) ~ K(u) p\n    Returns True if relative error <= rtol.\n    \"\"\"\n    E, alpha, A, L, f_ext = params\n    # Random direction p, normalized\n    p = rng.standard_normal(size=2)\n    nrm = np.linalg.norm(p)\n    if nrm == 0.0:\n        p = np.array([1.0, 0.0])\n    else:\n        p = p / nrm\n\n    # Step size selection: h = eps^(1/3) * max(1, ||u||)\n    eps_mach = np.finfo(float).eps\n    h_base = eps_mach ** (1.0 / 3.0)\n    scale = max(1.0, float(np.linalg.norm(u)))\n    h = h_base * scale\n\n    Ru_ph = residual(u + h * p, E, alpha, A, L, f_ext)\n    Ru_mh = residual(u - h * p, E, alpha, A, L, f_ext)\n    cd = (Ru_ph - Ru_mh) / (2.0 * h)\n\n    K = tangent(u, E, alpha, A, L)\n    Kp = K @ p\n\n    num = np.linalg.norm(cd - Kp)\n    den = max(1.0, np.linalg.norm(Kp))\n    rel_err = num / den\n    return rel_err <= rtol\n\ndef solve():\n    # Define test cases as specified in the problem statement.\n    # Each case: (E, alpha, A, L, u, f_ext)\n    test_cases = [\n        (100.0, 0.0, 1.0, 1.0, np.array([0.2, 0.8]), np.array([0.0, 0.0])),            # Case A\n        (200.0, 50.0, 2.0, 3.0, np.array([0.01, 0.03]), np.array([1.0, -1.0])),         # Case B\n        (10.0, 2000.0, 0.8, 1.5, np.array([0.3, -0.2]), np.array([-0.5, 0.2])),         # Case C\n        (150.0, 500.0, 1.2, 2.5, np.array([0.0, 0.0]), np.array([0.0, 0.0])),           # Case D\n    ]\n\n    # Relative tolerance justified by truncation and roundoff analysis.\n    rtol = 1e-6\n\n    # Fixed random seed for reproducibility.\n    rng = np.random.default_rng(123456)\n\n    results = []\n    for (E, alpha, A, L, u, f_ext) in test_cases:\n        params = (E, alpha, A, L, f_ext)\n        ok = central_diff_check(u, params, rng, rtol)\n        results.append(ok)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2583316"}, {"introduction": "有了经过验证的残差和切向刚度矩阵，我们就可以将它们应用于先进的求解算法中。标准的牛顿-拉夫逊方法在遇到极限点（如突跃或回弹屈曲）时可能会失效，因为在这些点上切向刚度矩阵是奇异的。弧长法是一种强大的路径跟踪技术，它将位移和载荷因子都视为变量，从而能够追踪这些复杂的平衡路径。本练习将让您亲手实践弧长法核心的单步校正计算，深入理解其如何通过一个约束方程来同时求解位移和载荷的增量。[@problem_id:2583322]", "problem": "一个两杆桁架被建模为两个平行、共轴的轴向弹簧，它们连接一个刚性基座和一个具有单个广义位移自由度 $u$（向下为正）的顶部节点。在小位移运动学假设下，每根杆 $i \\in \\{1,2\\}$ 遵循非线性轴向力-伸长关系 $N_i(a_i) = k_i a_i + \\beta_i a_i^3$。因此，对于此单自由度构型，有 $a_1 = a_2 = u$，且组集后的节点内力为 $f_{\\mathrm{int}}(u) = \\sum_{i=1}^{2} N_i(u)$。外荷载通过一个标量荷载因子 $\\lambda$ 乘以一个固定的参考荷载 $\\hat{P}$ 来施加，即 $f_{\\mathrm{ext}} = \\lambda \\hat{P}$。\n\n你将需要在一个Crisfield型球面弧长法中执行一次牛顿-拉夫逊校正迭代。请使用以下数据：\n- 本构参数：$k_1 = 2$， $k_2 = 1$， $\\beta_1 = 1$， $\\beta_2 = 0$。\n- 参考荷载：$\\hat{P} = 5$。\n- 在荷载步 $n \\to n+1$ 的当前迭代值：$(u_k,\\lambda_k) = (1.0,\\,0.5)$。\n- 上一荷载步的最后收敛状态：$(u_n,\\lambda_n) = (0.7,\\,0.4)$。\n- 弧长参数：半径 $\\Delta s = 0.6$ 和荷载缩放 $\\alpha = 2$。\n\n从虚功原理及其有限元残差 $R(u,\\lambda) = f_{\\mathrm{int}}(u) - \\lambda \\hat{P}$ 出发，并采用球面弧长约束\n$$\ng(\\Delta u,\\Delta \\lambda) \\equiv \\Delta u^2 + \\alpha^2 \\Delta \\lambda^2 - \\Delta s^2 = 0,\n$$\n其中 $\\Delta u = u - u_n$ 且 $\\Delta \\lambda = \\lambda - \\lambda_n$，在围绕 $(u_k,\\lambda_k)$ 的这一次校正迭代中执行以下操作：\n- 推导平衡方程的牛顿-拉夫逊线性化，以获得校正量 $(\\delta u,\\delta \\lambda)$ 与残差 $R(u_k,\\lambda_k)$ 之间的关系。\n- 围绕 $(\\Delta u_k,\\Delta \\lambda_k) = (u_k - u_n,\\lambda_k - \\lambda_n)$ 对弧长约束进行线性化，以获得关于 $(\\delta u,\\delta \\lambda)$ 的线性关系。\n- 组集生成的关于 $(\\delta u,\\delta \\lambda)$ 的 $2 \\times 2$ 线性系统并求解。\n\n将荷载因子的标量校正量 $\\delta \\lambda$ 作为你的最终答案。请提供精确值，不要四舍五入。由于 $\\lambda$ 是无量纲的，因此不需要单位。", "solution": "校正迭代旨在寻求一个从当前迭代值 $(u_k, \\lambda_k)$ 到新迭代值 $(u_{k+1}, \\lambda_{k+1}) = (u_k + \\delta u, \\lambda_k + \\delta \\lambda)$ 的更新量 $(\\delta u, \\delta \\lambda)$。该更新量通过对由平衡方程和弧长约束方程组成的非线性方程组进行线性化来确定。\n\n首先，我们根据给定的参数和本构关系建立系统的具体方程。\n每根杆的力为 $N_1(u) = k_1 u + \\beta_1 u^3$ 和 $N_2(u) = k_2 u + \\beta_2 u^3$。代入参数 $(k_1, k_2, \\beta_1, \\beta_2) = (2, 1, 1, 0)$，我们得到：\n$N_1(u) = 2u + u^3$\n$N_2(u) = u$\n总内力是两力之和：\n$f_{\\mathrm{int}}(u) = N_1(u) + N_2(u) = (2u + u^3) + u = 3u + u^3$。\n\n平衡残差为 $R(u,\\lambda) = f_{\\mathrm{int}}(u) - \\lambda \\hat{P}$。使用 $\\hat{P} = 5$，可得：\n$R(u,\\lambda) = 3u + u^3 - 5\\lambda$。\n\n牛顿-拉夫逊方法将平衡条件 $R(u_{k+1}, \\lambda_{k+1}) = 0$ 在当前迭代值 $(u_k, \\lambda_k)$ 附近进行线性化：\n$R(u_k + \\delta u, \\lambda_k + \\delta \\lambda) \\approx R(u_k, \\lambda_k) + \\frac{\\partial R}{\\partial u}\\bigg|_{(u_k, \\lambda_k)} \\delta u + \\frac{\\partial R}{\\partial \\lambda}\\bigg|_{(u_k, \\lambda_k)} \\delta \\lambda = 0$。\n这可以写成 $K_{T,k} \\delta u - \\hat{P} \\delta \\lambda = -R_k$, 其中 $K_{T,k}$ 是在 $u_k$ 处的切线刚度，而 $R_k$ 是在 $(u_k, \\lambda_k)$ 处的残差。\n\n我们在当前迭代值 $(u_k, \\lambda_k) = (1.0, 0.5)$ 处计算必要的项：\n切线刚度是内力的导数：$K_T(u) = \\frac{d f_{\\mathrm{int}}}{du} = \\frac{d}{du}(3u + u^3) = 3 + 3u^2$。\n在 $u_k=1.0$ 处，刚度为 $K_{T,k} = 3 + 3(1.0)^2 = 6$。\n当前迭代值的残差为：$R_k = R(1.0, 0.5) = 3(1.0) + (1.0)^3 - 5(0.5) = 3 + 1 - 2.5 = 1.5$。\n关于 $\\lambda$ 的导数是 $-\\hat{P} = -5$。\n代入这些值，得到线性化的平衡方程：\n$6 \\delta u - 5 \\delta \\lambda = -1.5$  (1)\n\n接下来，我们对弧长约束方程 $g(\\Delta u,\\Delta \\lambda) = 0$ 进行线性化。相对于上一步收敛状态 $(u_n, \\lambda_n)$ 的总增量为 $\\Delta u_{k+1} = (u_k - u_n) + \\delta u = \\Delta u_k + \\delta u$ 和 $\\Delta \\lambda_{k+1} = (\\lambda_k - \\lambda_n) + \\delta \\lambda = \\Delta \\lambda_k + \\delta \\lambda$。约束方程变为：\n$g(u_{k+1}, \\lambda_{k+1}) = (\\Delta u_k + \\delta u)^2 + \\alpha^2 (\\Delta \\lambda_k + \\delta \\lambda)^2 - \\Delta s^2 = 0$。\n我们围绕 $(\\delta u, \\delta \\lambda)=(0,0)$ 对该方程进行线性化，得到 $g_k + \\frac{\\partial g}{\\partial (\\delta u)}\\big|_k \\delta u + \\frac{\\partial g}{\\partial (\\delta \\lambda)}\\big|_k \\delta \\lambda = 0$。\n\n我们计算线性化所需的各项：\n当前总增量为：\n$\\Delta u_k = u_k - u_n = 1.0 - 0.7 = 0.3$。\n$\\Delta \\lambda_k = \\lambda_k - \\lambda_n = 0.5 - 0.4 = 0.1$。\n约束方程在当前迭代点的值为：\n$g_k = (\\Delta u_k)^2 + \\alpha^2 (\\Delta \\lambda_k)^2 - \\Delta s^2 = (0.3)^2 + (2)^2 (0.1)^2 - (0.6)^2 = 0.09 + 4(0.01) - 0.36 = 0.13 - 0.36 = -0.23$。\n偏导数为：\n$\\frac{\\partial g}{\\partial (\\delta u)}\\big|_k = 2(\\Delta u_k + \\delta u)|_{\\delta u=0} = 2\\Delta u_k = 2(0.3) = 0.6$。\n$\\frac{\\partial g}{\\partial (\\delta \\lambda)}\\big|_k = 2\\alpha^2(\\Delta \\lambda_k + \\delta \\lambda)|_{\\delta \\lambda=0} = 2\\alpha^2\\Delta \\lambda_k = 2(2)^2(0.1) = 0.8$。\n线性化的约束方程为 $0.6 \\delta u + 0.8 \\delta \\lambda = -g_k$，即：\n$0.6 \\delta u + 0.8 \\delta \\lambda = 0.23$  (2)\n\n现在我们求解关于 $(\\delta u, \\delta \\lambda)$ 的 $2 \\times 2$ 线性方程组：\n1. $6 \\delta u - 5 \\delta \\lambda = -1.5$\n2. $0.6 \\delta u + 0.8 \\delta \\lambda = 0.23$\n\n将方程(2)乘以10，得到 $6 \\delta u + 8 \\delta \\lambda = 2.3$。\n用这个新方程减去方程(1)：\n$(6 \\delta u + 8 \\delta \\lambda) - (6 \\delta u - 5 \\delta \\lambda) = 2.3 - (-1.5)$\n$13 \\delta \\lambda = 3.8$\n求解 $\\delta \\lambda$：\n$\\delta \\lambda = \\frac{3.8}{13} = \\frac{38}{130} = \\frac{19}{65}$。", "answer": "$$\\boxed{\\frac{19}{65}}$$", "id": "2583322"}, {"introduction": "非线性分析的现实是，收敛过程并非总是一帆风顺的。求解器常常因为“停滞”——即残差下降缓慢——而提前终止计算，但这可能是一个具有误导性的信号。本诊断练习挑战您像一位经验丰富的分析师一样，超越简单的残差下降率，深入分析更深层次的度量，例如残差向量 $R(u_k)$ 与位移更新向量 $\\Delta u_k$ 之间的夹角。通过这种方式，您将学会如何判断求解器是真正陷入困境，还是正处于找到正确方向并即将加速收敛的关键时刻，从而磨练出宝贵的调试和问题解读能力。[@problem_id:2583291]", "problem": "您正在求解一个非线性有限元平衡问题，即寻找一个位移向量 $u \\in \\mathbb{R}^n$，使得残差 $R(u) = f_{\\mathrm{int}}(u) - f_{\\mathrm{ext}}$ 满足 $R(u) = 0$，其中 $f_{\\mathrm{int}}(u)$ 是内力向量，$f_{\\mathrm{ext}}$ 是外荷载向量。Newton-Raphson (NR) 方法通过求解线性化系统 $K_T(u_k)\\,\\Delta u_k = -R(u_k)$，然后进行更新 $u_{k+1} = u_k + \\Delta u_k$ 来更新 $u_k$，其中 $K_T(u_k)$ 是切线刚度矩阵。假设在所报告的迭代步中，$K_T(u_k)$ 是对称正定的，并且没有采用线性搜索或信赖域全局化策略。\n\n一个代码由于“停滞”规则而提前终止：如果相对残差在连续两次迭代中的减小量均小于 $20\\%$，则程序停止。在某次运行中，终止发生在 $k=2$。在 $k=0,1,2$ 处测得的量为：\n- 在 $k=0$ 处：$\\|R(u_0)\\| = 10.0$，$\\|\\Delta u_0\\| = 0.90$，$R(u_0)^{\\mathsf T}\\Delta u_0 = -1.70$。\n- 在 $k=1$ 处：$\\|R(u_1)\\| = 8.50$，$\\|\\Delta u_1\\| = 0.70$，$R(u_1)^{\\mathsf T}\\Delta u_1 = -4.165$。\n- 在 $k=2$ 处：$\\|R(u_2)\\| = 7.40$，$\\|\\Delta u_2\\| = 0.78$，$R(u_2)^{\\mathsf T}\\Delta u_2 = -5.68$。\n\n考虑 $\\|R(u_k)\\|$ 的下降率以及 $R(u_k)$ 和 $\\Delta u_k$ 之间的夹角 $\\phi_k$（定义为 $\\cos \\phi_k = \\dfrac{R(u_k)^{\\mathsf T}\\Delta u_k}{\\|R(u_k)\\|\\,\\|\\Delta u_k\\|}$）。严格依据这些数据以及 Newton-Raphson 方法应用于具有对称正定切线刚度的非线性有限元问题时的基本原理特性，哪一种诊断最为合理？\n\nA. 在 $k=2$ 处终止为时过早：尽管目前为止残差下降缓慢，但夹角越来越钝且 $\\cos \\phi_2$ 接近 $-1$ 表明 Newton 步越来越接近与 $R(u_k)$ 反平行；预计再进行一次迭代会使 $\\|R(u_k)\\|$ 有大幅下降。\n\nB. 在 $k=2$ 处终止并不过早：负的 $R(u_k)^{\\mathsf T}\\Delta u_k$ 最多只保证单调线性下降，因此继续迭代不会显著改善收敛性。\n\nC. 在 $k=2$ 处终止并不过早：由于对所有 $k$ 都有 $R(u_k)^{\\mathsf T}\\Delta u_k < 0$，迭代步会朝着与 $R(u_k)$ 相反的方向移动，这预示着发散；算法应当停止。\n\nD. 在 $k=2$ 处终止因停滞而合理：夹角对于 Newton-Raphson 方法是无关紧要的，因为 Newton 步不是残差范数的下降方向，所以只应考虑残差的下降情况。", "solution": "为了做出合理的诊断，我们需要分步分析给定的数据及其物理和数学含义。\n\n**1. 验证终止条件**\n\n首先，我们检查代码是否确实按照规定的“停滞”规则终止。该规则为：如果相对残差在连续两次迭代中的减小量均小于 20%，则停止。\n- **从 $k=0$ 到 $k=1$**：相对残差减小量为 $1 - \\frac{\\|R(u_1)\\|}{\\|R(u_0)\\|} = 1 - \\frac{8.50}{10.0} = 0.15$，即 15%。这小于 20%。\n- **从 $k=1$ 到 $k=2$**：相对残差减小量为 $1 - \\frac{\\|R(u_2)\\|}{\\|R(u_1)\\|} = 1 - \\frac{7.40}{8.50} \\approx 0.129$，即约 12.9%。这也小于 20%。\n由于连续两次迭代的残差减小量都小于 20%，代码在 $k=2$ 之后终止是符合规则的。现在的问题是，这个规则是否做出了明智的决定。\n\n**2. 分析关键诊断指标：夹角**\n\n残差 $R(u_k)$ 与牛顿步 $\\Delta u_k$ 之间的夹角 $\\phi_k$ 能揭示搜索方向的质量。我们计算每次迭代的 $\\cos \\phi_k$。\n- **在 $k=0$ 处**：\n  $$ \\cos \\phi_0 = \\frac{R(u_0)^{\\mathsf T}\\Delta u_0}{\\|R(u_0)\\|\\,\\|\\Delta u_0\\|} = \\frac{-1.70}{10.0 \\times 0.90} = \\frac{-1.70}{9.0} \\approx -0.189 $$\n- **在 $k=1$ 处**：\n  $$ \\cos \\phi_1 = \\frac{R(u_1)^{\\mathsf T}\\Delta u_1}{\\|R(u_1)\\|\\,\\|\\Delta u_1\\|} = \\frac{-4.165}{8.50 \\times 0.70} = \\frac{-4.165}{5.95} = -0.7 $$\n- **在 $k=2$ 处**：\n  $$ \\cos \\phi_2 = \\frac{R(u_2)^{\\mathsf T}\\Delta u_2}{\\|R(u_2)\\|\\,\\|\\Delta u_2\\|} = \\frac{-5.68}{7.40 \\times 0.78} = \\frac{-5.68}{5.772} \\approx -0.984 $$\n\n**3. 解读趋势**\n\n计算结果显示了一个非常强烈的趋势：$\\cos \\phi_k$ 的值从一个较小的负数 $(-0.189)$ 迅速增长到接近 $-1$ 的值 $(-0.984)$。\n- $\\cos \\phi_k = -1$ 意味着夹角 $\\phi_k = 180^\\circ$，即向量 $\\Delta u_k$ 与 $R(u_k)$ 完全反平行。\n- 在保守系统中，残差 $R(u)$ 是势能 $\\Pi(u)$ 的梯度，即 $R(u) = \\nabla \\Pi(u)$。势能的“最速下降方向”是梯度的反方向，即 $-R(u)$。\n- 我们的牛顿步 $\\Delta u_k$ 正在变得与最速下降方向 $-R(u_k)$ 越来越对齐。这表明，尽管最初的迭代（$k=0$）方向不佳，导致收敛缓慢，但算法正在迅速地修正搜索方向，使其变得接近最优。\n\n一个与最速下降方向高度对齐的牛顿步，预示着求解器已经找到了一个非常好的前进方向，很可能即将进入二次收敛区域，从而在下一步迭代中实现残差的大幅下降。因此，仅根据前两次迭代的缓慢下降就判定“停滞”并终止计算，忽略了这一关键的积极信号，是为时过早的。\n\n**4. 评估选项**\n\n- **A. 在 $k=2$ 处终止为时过早...** 该选项正确地指出了夹角越来越钝（$\\cos\\phi_k \\to -1$）的趋势，正确地将其解读为牛顿步与残差反向平行，并据此预测下一次迭代会有大幅的残差下降。这个诊断与我们的分析完全吻合。\n\n- **B. 在 $k=2$ 处终止并不过早...** 该选项错误地声称负的内积最多只保证线性收敛。牛顿法以其二次收敛而闻名。$R(u_k)^{\\mathsf T}\\Delta u_k < 0$ 是保证牛顿步是势能下降方向的条件（由于 $K_T$ 是对称正定的），它是收敛的前提，而非对收敛速度的限制。\n\n- **C. 在 $k=2$ 处终止并不过早...** 该选项严重误解了下降方向的含义。$R(u_k)^{\\mathsf T}\\Delta u_k < 0$ 表示 $\\Delta u_k$ 与 $R(u_k)$ 的夹角大于 $90^\\circ$，这意味着该步骤正在朝向势能减小的方向移动，这是趋于收敛的标志，而非发散。\n\n- **D. 在 $k=2$ 处终止因停滞而合理...** 该选项包含一个关键错误，即声称牛顿步不是残差范数的下降方向。事实上，牛顿步是残差范数的平方 $g(u) = \\frac{1}{2}\\|R(u)\\|^2$ 的一个下降方向。夹角是衡量该下降方向质量的重要指标，因此它绝非无关紧要。\n\n**结论**\n\n最合理的诊断是选项A。尽管残差范数下降缓慢，但指示搜索方向质量的夹角正在迅速改善，预示着即将到来的快速收敛。基于简单停滞规则的终止是过早的。", "answer": "$$\\boxed{A}$$", "id": "2583291"}]}