{"hands_on_practices": [{"introduction": "在应用模态叠加法之前，我们必须首先确定系统的固有动力特性，即其自然频率和模态振型。本练习提供了求解广义特征值问题的直接、上手实践，这是模态分析的数学核心。通过解决一个简单的二自由度系统，您可以巩固对这些基本属性如何计算及其物理意义的理解 [@problem_id:2578908]。", "problem": "考虑一个在线性、无阻尼、双自由度（DOF）力学系统，该系统在有限元法（FEM）框架内建模。设广义坐标为节点位移 $q_{1}(t)$ 和 $q_{2}(t)$，并集合成向量 $\\mathbf{q}(t) = \\begin{pmatrix} q_{1}(t) \\\\ q_{2}(t) \\end{pmatrix}$。运动方程由应用于广义坐标的 Newton 第二定律导出。对称正定的质量矩阵和刚度矩阵由下式给出：\n$$\nM = \\begin{pmatrix} 3 & 1 \\\\ 1 & 2 \\end{pmatrix} \\ \\text{kg}, \n\\qquad\nK = \\begin{pmatrix} 5000 & -1500 \\\\ -1500 & 2500 \\end{pmatrix} \\ \\text{N/m}.\n$$\n从第一性原理出发，建立该系统自由振动的控制方程，并推导相关的广义特征值问题，用以确定无阻尼固有圆频率及其振型。然后，显式求解该二自由度系统的特征值问题，以获得两个固有频率及其对应的质量归一化振型。对变形模式进行物理解释，指明哪种模式主要是同相振动，哪种是反相振动，并解释耦合项如何影响这些模式。\n\n答案要求：最终答案仅报告较低的固有圆频率。以弧度/秒为单位表示，并四舍五入至四位有效数字。", "solution": "用户提出了一个线性结构动力学问题。首要的强制步骤是对问题陈述进行严格验证。\n\n### 第1步：提取已知条件\n问题陈述逐字提供了以下信息：\n- 系统类型：线性、无阻尼、双自由度（$2$-DOF）。\n- 建模框架：有限元法（FEM）。\n- 广义坐标向量：$\\mathbf{q}(t) = \\begin{pmatrix} q_{1}(t) \\\\ q_{2}(t) \\end{pmatrix}$。\n- 质量矩阵：$M = \\begin{pmatrix} 3 & 1 \\\\ 1 & 2 \\end{pmatrix} \\ \\text{kg}$。题目说明其为对称正定矩阵。\n- 刚度矩阵：$K = \\begin{pmatrix} 5000 & -1500 \\\\ -1500 & 2500 \\end{pmatrix} \\ \\text{N/m}$。题目说明其为对称矩阵。\n\n### 第2步：使用提取的已知条件进行验证\n根据所需标准对问题进行评估。\n1.  **科学依据**：该问题植根于经典力学，特别是保守系统微振动理论，这是物理学和工程学中的一个基本课题。控制方程 $M\\ddot{\\mathbf{q}} + K\\mathbf{q} = \\mathbf{0}$ 是一个标准表示法。必须检查矩阵是否具有所述属性。\n    - 质量矩阵 $M$ 是对称的。其主子式为 $\\det(3) = 3 > 0$ 和 $\\det(M) = (3)(2) - (1)(1) = 5 > 0$。因此，$M$ 是正定的。\n    - 刚度矩阵 $K$ 是对称的。其主子式为 $\\det(5000) = 5000 > 0$ 和 $\\det(K) = (5000)(2500) - (-1500)^2 = 12,500,000 - 2,250,000 = 10,250,000 > 0$。因此，$K$ 也是正定的。\n    矩阵的性质与稳定、无源机械系统的物理现实相符。该问题是科学上合理的。\n2.  **适定性**：对于具有对称正定质量（$M$）和刚度（$K$）矩阵的系统，线性代数和机械振动理论保证存在一组实的正固有频率和一组对应的 M-正交振型。存在唯一解。该问题是适定的。\n3.  **客观性**：该问题使用机械工程领域的精确、标准术语进行陈述。它没有歧义和主观论断。\n4.  **完整性和一致性**：确定固有频率和振型所需的所有数据（$M$ 和 $K$ 矩阵）均已提供。单位在物理上是一致的。该问题是自洽的。\n\n### 第3步：结论和行动\n该问题在科学上合理、适定、客观且完整。它是结构动力学中一个标准的、有效的问题。将提供解答。\n\n---\n\n线性系统自由、无阻尼振动的控制方程由 Lagrange's equations 给出，在此背景下，其形式为矩阵形式的 Newton 第二定律：\n$$\nM\\ddot{\\mathbf{q}}(t) + K\\mathbf{q}(t) = \\mathbf{0}\n$$\n其中 $M$ 是质量矩阵，$K$ 是刚度矩阵，$\\mathbf{q}(t)$ 是广义位移向量。\n\n为求固有频率和振型，我们假设同步谐波运动的形式为：\n$$\n\\mathbf{q}(t) = \\mathbf{\\phi} e^{i\\omega t}\n$$\n其中 $\\mathbf{\\phi}$ 是不随时间变化的振型向量（幅值向量），$\\omega$ 是固有圆频率，且 $i = \\sqrt{-1}$。将此假设解对时间求两次导数，得到：\n$$\n\\ddot{\\mathbf{q}}(t) = -\\omega^2 \\mathbf{\\phi} e^{i\\omega t}\n$$\n将假设解及其二阶导数代入运动方程，得到：\n$$\n-M\\omega^2 \\mathbf{\\phi} e^{i\\omega t} + K \\mathbf{\\phi} e^{i\\omega t} = \\mathbf{0}\n$$\n由于项 $e^{i\\omega t}$ 永远不为零，我们可以用它来除以整个方程，从而得到广义特征值问题：\n$$\n(K - \\omega^2 M) \\mathbf{\\phi} = \\mathbf{0}\n$$\n为了得到振型 $\\mathbf{\\phi}$ 不为零向量的非平凡解，系数矩阵的行列式必须为零：\n$$\n\\det(K - \\omega^2 M) = 0\n$$\n令 $\\lambda = \\omega^2$。方程变为关于 $\\lambda$ 的特征方程：\n$$\n\\det(K - \\lambda M) = 0\n$$\n代入给定的矩阵 $M$ 和 $K$：\n$$\n\\det\\left(\\begin{pmatrix} 5000 & -1500 \\\\ -1500 & 2500 \\end{pmatrix} - \\lambda \\begin{pmatrix} 3 & 1 \\\\ 1 & 2 \\end{pmatrix}\\right) = 0\n$$\n$$\n\\det\\begin{pmatrix} 5000 - 3\\lambda & -1500 - \\lambda \\\\ -1500 - \\lambda & 2500 - 2\\lambda \\end{pmatrix} = 0\n$$\n计算行列式得到特征多项式：\n$$\n(5000 - 3\\lambda)(2500 - 2\\lambda) - (-1500 - \\lambda)^2 = 0\n$$\n$$\n(12,500,000 - 10,000\\lambda - 7,500\\lambda + 6\\lambda^2) - (2,250,000 + 3,000\\lambda + \\lambda^2) = 0\n$$\n$$\n6\\lambda^2 - 17,500\\lambda + 12,500,000 - \\lambda^2 - 3,000\\lambda - 2,250,000 = 0\n$$\n合并同类项，得到关于 $\\lambda$ 的二次方程：\n$$\n5\\lambda^2 - 20,500\\lambda + 10,250,000 = 0\n$$\n两边同除以 $5$ 以简化方程：\n$$\n\\lambda^2 - 4100\\lambda + 2,050,000 = 0\n$$\n我们使用二次公式 $\\lambda = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 求解该二次方程以得到特征值 $\\lambda_1$ 和 $\\lambda_2$：\n$$\n\\lambda = \\frac{4100 \\pm \\sqrt{(-4100)^2 - 4(1)(2,050,000)}}{2} = \\frac{4100 \\pm \\sqrt{16,810,000 - 8,200,000}}{2}\n$$\n$$\n\\lambda = \\frac{4100 \\pm \\sqrt{8,610,000}}{2}\n$$\n两个特征值为：\n$$\n\\lambda_1 = \\frac{4100 - \\sqrt{8,610,000}}{2} \\approx \\frac{4100 - 2934.28}{2} \\approx 582.86 \\, (\\text{rad/s})^2\n$$\n$$\n\\lambda_2 = \\frac{4100 + \\sqrt{8,610,000}}{2} \\approx \\frac{4100 + 2934.28}{2} \\approx 3517.14 \\, (\\text{rad/s})^2\n$$\n固有圆频率是特征值的平方根，即 $\\omega = \\sqrt{\\lambda}$。\n较低的固有频率是：\n$$\n\\omega_1 = \\sqrt{\\lambda_1} = \\sqrt{\\frac{4100 - \\sqrt{8,610,000}}{2}} \\approx 24.142 \\, \\text{rad/s}\n$$\n较高的固有频率是：\n$$\n\\omega_2 = \\sqrt{\\lambda_2} = \\sqrt{\\frac{4100 + \\sqrt{8,610,000}}{2}} \\approx 59.305 \\, \\text{rad/s}\n$$\n接下来，我们通过对每个特征值求解 $(K - \\lambda_i M)\\mathbf{\\phi}_i = \\mathbf{0}$ 来找到相应的特征向量（振型）$\\mathbf{\\phi}_i$。\n对于 $\\lambda_1 \\approx 582.86$，方程组为：\n$$\n\\begin{pmatrix} 5000 - 3(\\lambda_1) & -1500 - \\lambda_1 \\\\ -1500 - \\lambda_1 & 2500 - 2(\\lambda_1) \\end{pmatrix} \\begin{pmatrix} \\phi_{11} \\\\ \\phi_{21} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n使用第一行：$(5000 - 3(582.86))\\phi_{11} - (1500 + 582.86)\\phi_{21} = 0$，简化为 $3251.42\\phi_{11} - 2082.86\\phi_{21} = 0$。各分量的比率为 $\\frac{\\phi_{21}}{\\phi_{11}} = \\frac{3251.42}{2082.86} \\approx 1.561$。第一振型为 $\\mathbf{\\phi}_1 \\propto \\begin{pmatrix} 1 \\\\ 1.561 \\end{pmatrix}$。\n\n对于 $\\lambda_2 \\approx 3517.14$，方程组为：\n$$\n\\begin{pmatrix} 5000 - 3(\\lambda_2) & -1500 - \\lambda_2 \\\\ -1500 - \\lambda_2 & 2500 - 2(\\lambda_2) \\end{pmatrix} \\begin{pmatrix} \\phi_{12} \\\\ \\phi_{22} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n使用第一行：$(5000 - 3(3517.14))\\phi_{12} - (1500 + 3517.14)\\phi_{22} = 0$，得到 $-5551.42\\phi_{12} - 5017.14\\phi_{22} = 0$。比率为 $\\frac{\\phi_{22}}{\\phi_{12}} = -\\frac{5551.42}{5017.14} \\approx -1.106$。第二振型为 $\\mathbf{\\phi}_2 \\propto \\begin{pmatrix} 1 \\\\ -1.106 \\end{pmatrix}$。\n\n为了获得质量归一化振型 $\\mathbf{\\hat{\\phi}}_i$，我们施加条件 $\\mathbf{\\hat{\\phi}}_i^T M \\mathbf{\\hat{\\phi}}_i = 1$。令 $\\mathbf{\\hat{\\phi}}_i = c_i \\mathbf{\\phi}_i$。则 $c_i = (\\mathbf{\\phi}_i^T M \\mathbf{\\phi}_i)^{-1/2}$。\n对于 $\\mathbf{\\phi}_1 = \\begin{pmatrix} 1 \\\\ 1.561 \\end{pmatrix}$：$c_1 = (3(1)^2 + 2(1)(1)(1.561) + 2(1.561)^2)^{-1/2} \\approx 0.3016$。\n$\\mathbf{\\hat{\\phi}}_1 \\approx \\begin{pmatrix} 0.3016 \\\\ 0.4708 \\end{pmatrix}$。\n对于 $\\mathbf{\\phi}_2 = \\begin{pmatrix} 1 \\\\ -1.106 \\end{pmatrix}$：$c_2 = (3(1)^2 + 2(1)(1)(-1.106) + 2(-1.106)^2)^{-1/2} \\approx 0.5560$。\n$\\mathbf{\\hat{\\phi}}_2 \\approx \\begin{pmatrix} 0.5560 \\\\ -0.6150 \\end{pmatrix}$。\n\n**物理解释：**\n1.  **第一模式（较低频率，$\\omega_1 \\approx 24.14$ rad/s）：** 振型 $\\mathbf{\\hat{\\phi}}_1$ 的分量符号相同。这意味着两个自由度 $q_1$ 和 $q_2$ 在任何时刻都朝同一方向运动。这是**同相**模式。幅值比显示，第二个坐标的运动幅度约是第一个坐标的 $1.561$ 倍。该模式代表一种集体的、能量较低的运动。\n2.  **第二模式（较高频率，$\\omega_2 \\approx 59.31$ rad/s）：** 振型 $\\mathbf{\\hat{\\phi}}_2$ 的分量符号相反。这意味着 $q_1$ 和 $q_2$ 在任何时刻都朝相反方向运动。这是**反相**模式。它代表一种能量较高的、分量相互反向运动的差分运动。\n\n**耦合的影响：** 非对角项 $m_{12}=1$ 和 $k_{12}=-1500$ 分别代表惯性耦合和弹性耦合。如果没有这些项，系统将解耦为两个独立的单自由度振子。耦合有两个主要作用：\n- 它混合了运动，确保没有任何一种模式只涉及单一坐标的运动。这些模式是“纯粹的”单坐标运动的组合。\n- 它“分裂”了固有频率。一个无耦合系统的频率应为 $\\sqrt{k_{11}/m_{11}} \\approx 40.8$ rad/s 和 $\\sqrt{k_{22}/m_{22}} \\approx 35.4$ rad/s。耦合作用使得一个频率（同相模式, $\\omega_1$）变得比无耦合频率更低，而另一个（反相模式, $\\omega_2$）变得更高。这是耦合振子系统中的一个普遍现象。\n\n问题要求的是较低的固有圆频率 $\\omega_1$，并四舍五入至四位有效数字。\n$$\n\\omega_1 = \\sqrt{\\frac{4100 - \\sqrt{8,610,000}}{2}} \\approx 24.14249 \\, \\text{rad/s}\n$$\n四舍五入到 $4$ 位有效数字得到 $24.14$。", "answer": "$$\n\\boxed{24.14}\n$$", "id": "2578908"}, {"introduction": "在学习了如何寻找模态之后，下一步是应用它们来求解结构在外部载荷下的动力响应。本练习模拟了一个真实的工程场景，其中为提高效率，仅使用模态的一个子集。这个编程实践使您能够实现模态叠加分析的完整工作流程，从计算模态到积分模态方程，再到重构物理响应 [@problem_id:2578825]。", "problem": "考虑一个具有 $5$ 个平移自由度的一维链，其半离散线性动力学通过有限元法 (FEM) 得到。其控制初值问题是一个二阶常微分方程组\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{C}\\,\\dot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}(t) = \\mathbf{f}(t),\n$$\n其初始条件为\n$$\n\\mathbf{u}(0) = \\mathbf{0}, \\quad \\dot{\\mathbf{u}}(0) = \\mathbf{0}.\n$$\n所有物理量必须使用国际单位制 (SI) 表示：质量单位为千克 (kg)，刚度单位为牛顿/米 (N/m)，时间单位为秒 (s)，力单位为牛顿 (N)，阻尼单位为牛顿·秒/米 (N·s/m)。三角函数中出现的任何角度都必须以弧度为单位。\n\n设质量矩阵为对角矩阵，其集中质量相等，\n$$\n\\mathbf{M} = m\\,\\mathbf{I}_5,\\quad m = 1.0,\n$$\n设刚度矩阵为对称三对角矩阵，对应于两端固定于墙上的最近邻链，\n$$\n\\mathbf{K} = k\\,\\mathrm{tridiag}([-1,2,-1]) \\in \\mathbb{R}^{5 \\times 5},\\quad k = 1000.0,\n$$\n即对角元为 $2k$，第一亚对角线和第一超对角线元素为 $-k$，所有其他元素为零。设粘性阻尼矩阵为 Rayleigh 形式，\n$$\n\\mathbf{C} = \\alpha\\,\\mathbf{M} + \\beta\\,\\mathbf{K},\n$$\n其系数 $\\alpha$ 和 $\\beta$ 在每个测试用例中指定。外载荷是一个幅值为 $F_0$ 的集中瞬态半正弦脉冲，作用于单个自由度，\n$$\n\\mathbf{f}(t) = \n\\begin{cases}\nF_0 \\,\\sin\\!\\left(\\dfrac{\\pi t}{T}\\right)\\,\\mathbf{e}_j, & 0 \\le t \\le T,\\\n$$6pt]\n\\mathbf{0}, & t > T,\n\\end{cases}\n$$\n其中 $F_0 = 1.0$，单位向量 $\\mathbf{e}_j \\in \\mathbb{R}^5$ 在索引 $j$ 处为 $1$，其余位置为零，$T$ 为脉冲持续时间。$\\sin(\\cdot)$ 中的角度以弧度为单位。\n\n任务 A (直接积分法)。从 Newton 第二定律和标准时间离散化原理出发，使用一种针对线性系统的一致、无条件稳定、二阶精度的方法，在从 $t_0 = 0$ 到 $t_{N} = t_{\\mathrm{end}}$ 的均匀网格 $t_n = n\\,\\Delta t$ 上，对耦合系统的位移时程 $\\mathbf{u}(t)$ 进行数值积分。初始加速度必须根据 $t = 0$ 时的运动方程计算。\n\n任务 B (振型叠加法)。从无阻尼自由振动的广义特征值问题出发，\n$$\n\\mathbf{K}\\,\\boldsymbol{\\phi}_i = \\omega_i^2\\,\\mathbf{M}\\,\\boldsymbol{\\phi}_i,\n$$\n计算前三个振型 $\\{\\omega_i,\\boldsymbol{\\phi}_i\\}$，$i \\in \\{1,2,3\\}$，并缩放特征向量使其质量归一化，以满足 $\\boldsymbol{\\Phi}^\\mathsf{T}\\mathbf{M}\\,\\boldsymbol{\\Phi} = \\mathbf{I}$，其中 $\\boldsymbol{\\Phi} = [\\boldsymbol{\\phi}_1\\,\\boldsymbol{\\phi}_2\\,\\boldsymbol{\\phi}_3]$。仅使用这三个振型，为振型坐标 $q_i(t)$ 建立解耦的标量振型方程，推导与给定 Rayleigh 阻尼一致的等效标量阻尼，并在与任务 A 相同的时间网格上对这些标量方程进行数值积分。使用前三个振型，通过振型叠加重构近似物理响应，\n$$\n\\mathbf{u}_{\\mathrm{modal}}(t) = \\sum_{i=1}^{3} \\boldsymbol{\\phi}_i\\,q_i(t).\n$$\n\n任务 C (比较指标)。对于每个测试用例，计算无量纲差异\n$$\nr = \\frac{\\max_{0 \\le n \\le N} \\left\\lVert \\mathbf{u}_{\\mathrm{modal}}(t_n) - \\mathbf{u}(t_n) \\right\\rVert_\\infty}{\\max_{0 \\le n \\le N} \\left\\lVert \\mathbf{u}(t_n) \\right\\rVert_\\infty},\n$$\n其中 $\\lVert \\cdot \\rVert_\\infty$ 是最大绝对分量范数。如果分母为零，则定义 $r=0$。\n\n测试套件。使用以下三个用例，每个用例都有其自己的脉冲持续时间 $T$、结束时间 $t_{\\mathrm{end}}$、载荷索引 $j$ (基于 1 的索引)、Rayleigh 系数 $(\\alpha,\\beta)$ 和时间步长 $\\Delta t$：\n\n- 用例 1：$T = 1.0$ s, $t_{\\mathrm{end}} = 3.0$ s, $j = 3$, $\\alpha = 0.02$ s$^{-1}$, $\\beta = 0.0002$ s, $\\Delta t = 0.001$ s。\n- 用例 2：$T = 0.05$ s, $t_{\\mathrm{end}} = 0.5$ s, $j = 1$, $\\alpha = 0.0$ s$^{-1}$, $\\beta = 0.0$ s, $\\Delta t = 0.0001$ s。\n- 用例 3：$T = 0.05$ s, $t_{\\mathrm{end}} = 0.5$ s, $j = 5$, $\\alpha = 0.5$ s$^{-1}$, $\\beta = 0.002$ s, $\\Delta t = 0.0001$ s。\n\n对最终程序输出的要求。您的程序必须：\n- 如上所述，实现直接时间积分法和仅限前三个振型的振型叠加法。\n- 对任何三角函数参数使用弧度。\n- 生成单行输出，其中包含三个用例的三个差异值，形式为用方括号括起的逗号分隔列表，例如 $[r_1,r_2,r_3]$，每个 $r_i$ 打印为小数点后精确到六位的小数。", "solution": "该问题要求分析一个 $5$ 自由度 ($DOF$) 的线性动力系统，这是结构力学中由有限元法推导出的一个标准模型。我们被要求使用两种不同的方法——直接时间积分法和振型叠加法——计算系统对瞬态载荷的响应，然后量化两种所得解之间的差异。\n\n系统的控制运动方程由以下矩阵微分方程给出：\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{C}\\,\\dot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}}(t) = \\mathbf{f}(t)\n$$\n在静止初始条件 $\\mathbf{u}(0) = \\mathbf{0}$ 和 $\\dot{\\mathbf{u}}(0) = \\mathbf{0}$ 下。矩阵 $\\mathbf{M}$、$\\mathbf{C}$ 和 $\\mathbf{K}$ 分别代表系统的质量、阻尼和刚度特性。$\\mathbf{u}(t)$ 是随时间变化的位移向量，$\\mathbf{f}(t)$ 是外力向量。\n\n系统矩阵具体如下：\n- 质量矩阵: $\\mathbf{M} = m\\,\\mathbf{I}_5$，其中 $m=1.0\\,\\mathrm{kg}$。这是一个对角（集中）质量矩阵。\n- 刚度矩阵: $\\mathbf{K} = k\\,\\mathrm{tridiag}([-1,2,-1])$，其中 $k=1000.0\\,\\mathrm{N/m}$。这代表一个由弹簧连接的质量链，两端固定。\n- 阻尼矩阵: $\\mathbf{C} = \\alpha\\,\\mathbf{M} + \\beta\\,\\mathbf{K}$，称为 Rayleigh 阻尼。系数 $\\alpha$ 和 $\\beta$ 在每个测试用例中提供。\n\n对问题陈述的验证证实了其科学上的合理性、适定性，并且所有必要的数据都已提供。我们可以开始求解。\n\n任务 A：完整系统的直接时间积分\n\n为了对耦合方程组进行数值积分，我们必须采用一种时间步进算法。问题指定使用一种针对线性系统的一致、无条件稳定且二阶精度的方法。参数为 $\\gamma = 1/2$ 和 $\\beta = 1/4$ 的 Newmark-$\\beta$ 法（通常称为平均加速度法或梯形法则）满足这些标准。\n\nNewmark 方法的关系式为：\n$$\n\\mathbf{u}_{n+1} = \\mathbf{u}_n + \\Delta t\\, \\dot{\\mathbf{u}}_n + \\frac{(\\Delta t)^2}{2} \\left[ (1-2\\beta) \\ddot{\\mathbf{u}}_n + 2\\beta \\ddot{\\mathbf{u}}_{n+1} \\right]\n$$\n$$\n\\dot{\\mathbf{u}}_{n+1} = \\dot{\\mathbf{u}}_n + \\Delta t \\left[ (1-\\gamma) \\ddot{\\mathbf{u}}_n + \\gamma \\ddot{\\mathbf{u}}_{n+1} \\right]\n$$\n其中下标 $n$ 表示时间 $t_n = n\\,\\Delta t$ 时的值。对于 $\\gamma = 1/2$ 和 $\\beta = 1/4$，这些关系式可以简化。我们可以重排这些关系式，用未知位移 $\\mathbf{u}_{n+1}$ 和第 $n$ 步的已知量来表示 $\\dot{\\mathbf{u}}_{n+1}$ 和 $\\ddot{\\mathbf{u}}_{n+1}$：\n$$\n\\ddot{\\mathbf{u}}_{n+1} = \\frac{4}{(\\Delta t)^2}(\\mathbf{u}_{n+1} - \\mathbf{u}_n) - \\frac{4}{\\Delta t}\\dot{\\mathbf{u}}_n - \\ddot{\\mathbf{u}}_n\n$$\n$$\n\\dot{\\mathbf{u}}_{n+1} = \\frac{2}{\\Delta t}(\\mathbf{u}_{n+1} - \\mathbf{u}_n) - \\dot{\\mathbf{u}}_n\n$$\n将这些表达式代入 $t_{n+1}$ 时刻的运动方程 $\\mathbf{M}\\,\\ddot{\\mathbf{u}}_{n+1} + \\mathbf{C}\\,\\dot{\\mathbf{u}}_{n+1} + \\mathbf{K}\\,\\mathbf{u}_{n+1} = \\mathbf{f}_{n+1}$，并重排各项，得到关于 $\\mathbf{u}_{n+1}$ 的线性系统：\n$$\n\\hat{\\mathbf{K}}\\,\\mathbf{u}_{n+1} = \\hat{\\mathbf{f}}_{n+1}\n$$\n其中等效刚度矩阵 $\\hat{\\mathbf{K}}$ 由下式给出：\n$$\n\\hat{\\mathbf{K}} = \\left( \\frac{4}{(\\Delta t)^2}\\mathbf{M} + \\frac{2}{\\Delta t}\\mathbf{C} + \\mathbf{K} \\right)\n$$\n而等效力向量 $\\hat{\\mathbf{f}}_{n+1}$ 为：\n$$\n\\hat{\\mathbf{f}}_{n+1} = \\mathbf{f}_{n+1} + \\left(\\frac{4}{(\\Delta t)^2}\\mathbf{M} + \\frac{2}{\\Delta t}\\mathbf{C}\\right) \\mathbf{u}_n + \\left(\\frac{4}{\\Delta t}\\mathbf{M} + \\mathbf{C}\\right) \\dot{\\mathbf{u}}_n + \\mathbf{M}\\, \\ddot{\\mathbf{u}}_n\n$$\n由于对于给定的时间步长 $\\Delta t$，$\\hat{\\mathbf{K}}$ 是恒定的，因此可以一次性计算和分解。在每个时间步，我们计算 $\\hat{\\mathbf{f}}_{n+1}$，求解 $\\mathbf{u}_{n+1}$，然后更新速度 $\\dot{\\mathbf{u}}_{n+1}$ 和加速度 $\\ddot{\\mathbf{u}}_{n+1}$。\n初始加速度 $\\ddot{\\mathbf{u}}(0)$ 由 $t=0$ 时的运动方程得出：$\\mathbf{M}\\,\\ddot{\\mathbf{u}}(0) + \\mathbf{C}\\,\\dot{\\mathbf{u}}(0) + \\mathbf{K}\\,\\mathbf{u}}(0) = \\mathbf{f}(0)$。鉴于 $\\mathbf{u}(0)=\\mathbf{0}$，$\\dot{\\mathbf{u}}(0)=\\mathbf{0}$，且 $\\mathbf{f}(0) = \\mathbf{0}$ (因为 $\\sin(0)=0$)，我们得到 $\\mathbf{M}\\,\\ddot{\\mathbf{u}}(0) = \\mathbf{0}$。由于 $\\mathbf{M}$ 可逆，$\\ddot{\\mathbf{u}}(0) = \\mathbf{0}$。\n\n任务 B：振型叠加法\n\n该方法依赖于将耦合的物理坐标 $\\mathbf{u}(t)$ 转换为一组解耦的振型坐标 $q_i(t)$。这是通过使用无阻尼自由振动系统的特征向量（振型）来实现的。\n首先，我们求解广义特征值问题：\n$$\n\\mathbf{K}\\,\\boldsymbol{\\phi}_i = \\omega_i^2\\,\\mathbf{M}\\,\\boldsymbol{\\phi}_i\n$$\n这会得到一组自然频率 $\\omega_i$ 和相应的振型向量 $\\boldsymbol{\\phi}_i$。我们被指示仅使用前三个振型 ($i \\in \\{1,2,3\\}$)。特征向量必须进行质量归一化，以使 $\\boldsymbol{\\phi}_i^\\mathsf{T} \\mathbf{M} \\boldsymbol{\\phi}_j = \\delta_{ij}$，其中 $\\delta_{ij}$ 是 Kronecker delta。令 $\\boldsymbol{\\Phi} = [\\boldsymbol{\\phi}_1, \\boldsymbol{\\phi}_2, \\boldsymbol{\\phi}_3]$ 为前三个归一化振型组成的矩阵。\n\n物理位移被近似为这些振型的线性组合：\n$$\n\\mathbf{u}_{\\mathrm{modal}}(t) = \\boldsymbol{\\Phi}\\,\\mathbf{q}(t) = \\sum_{i=1}^{3} \\boldsymbol{\\phi}_i\\, q_i(t)\n$$\n将此代入原始运动方程，并前乘 $\\boldsymbol{\\Phi}^\\mathsf{T}$，得到振型坐标下的系统：\n$$\n(\\boldsymbol{\\Phi}^\\mathsf{T} \\mathbf{M} \\boldsymbol{\\Phi})\\,\\ddot{\\mathbf{q}}(t) + (\\boldsymbol{\\Phi}^\\mathsf{T} \\mathbf{C} \\boldsymbol{\\Phi})\\,\\dot{\\mathbf{q}}(t) + (\\boldsymbol{\\Phi}^\\mathsf{T} \\mathbf{K} \\boldsymbol{\\Phi})\\,\\mathbf{q}(t) = \\boldsymbol{\\Phi}^\\mathsf{T} \\mathbf{f}(t)\n$$\n由于特征向量的正交性，振型质量矩阵和振型刚度矩阵是对角的：\n$$\n\\mathbf{M}^* = \\boldsymbol{\\Phi}^\\mathsf{T} \\mathbf{M} \\boldsymbol{\\Phi} = \\mathbf{I} \\quad \\text{(通过归一化)}\n$$\n$$\n\\mathbf{K}^* = \\boldsymbol{\\Phi}^\\mathsf{T} \\mathbf{K} \\boldsymbol{\\Phi} = \\mathrm{diag}(\\omega_1^2, \\omega_2^2, \\omega_3^2)\n$$\n对于 Rayleigh 阻尼，振型阻尼矩阵也是对角的：\n$$\n\\mathbf{C}^* = \\boldsymbol{\\Phi}^\\mathsf{T} (\\alpha\\mathbf{M} + \\beta\\mathbf{K}) \\boldsymbol{\\Phi} = \\alpha(\\boldsymbol{\\Phi}^\\mathsf{T}\\mathbf{M}\\boldsymbol{\\Phi}) + \\beta(\\boldsymbol{\\Phi}^\\mathsf{T}\\mathbf{K}\\boldsymbol{\\Phi}) = \\alpha\\mathbf{I} + \\beta\\mathbf{K}^* = \\mathrm{diag}(\\alpha+\\beta\\omega_1^2, \\alpha+\\beta\\omega_2^2, \\alpha+\\beta\\omega_3^2)\n$$\n这就得到了一组三个独立的标量方程，每个振型 $i \\in \\{1,2,3\\}$ 一个：\n$$\n\\ddot{q}_i(t) + (2\\zeta_i\\omega_i)\\,\\dot{q}_i(t) + \\omega_i^2\\, q_i(t) = p_i(t)\n$$\n其中振型阻尼项为 $2\\zeta_i\\omega_i = \\alpha + \\beta\\omega_i^2$，振型力为 $p_i(t) = \\boldsymbol{\\phi}_i^\\mathsf{T}\\mathbf{f}(t)$。振型坐标的初始条件是 $q_i(0)=0$ 和 $\\dot{q}_i(0)=0$。\n这些标量二阶常微分方程中的每一个都使用与任务 A 中相同的 Newmark-$\\beta$ 方案进行积分。然后，使用得到的振型位移时程 $q_i(t_n)$ 来重构近似的物理位移 $\\mathbf{u}_{\\mathrm{modal}}(t_n)$。\n\n任务 C：比较指标\n\n来自直接积分的“精确”数值解 $\\mathbf{u}(t_n)$ 与来自振型叠加的近似解 $\\mathbf{u}_{\\mathrm{modal}}(t_n)$ 之间的差异由无量纲比率 $r$ 来衡量：\n$$\nr = \\frac{\\max_{0 \\le n \\le N} \\left\\lVert \\mathbf{u}_{\\mathrm{modal}}(t_n) - \\mathbf{u}(t_n) \\right\\rVert_\\infty}{\\max_{0 \\le n \\le N} \\left\\lVert \\mathbf{u}(t_n) \\right\\rVert_\\infty}\n$$\n其中 $\\lVert\\mathbf{v}\\rVert_\\infty = \\max_j |v_j|$ 是向量 $\\mathbf{v}$ 的最大绝对分量。该指标量化了振型解相对于系统最大响应的最大误差，为给定载荷和系统参数下三振型近似的准确性提供了度量。\n\n计算过程包括为每个测试用例实现两种积分方案，存储位移向量 $\\mathbf{u}(t_n)$ 和 $\\mathbf{u}_{\\mathrm{modal}}(t_n)$ 的完整时程，并最终计算比率 $r$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Solves the structural dynamics problem using direct integration and modal superposition,\n    then computes the discrepancy between the two methods for three test cases.\n    \"\"\"\n    \n    # Define physical constants\n    M_val = 1.0  # kg\n    K_val = 1000.0  # N/m\n    F0 = 1.0  # N\n    dof = 5\n\n    # Define system matrices\n    M = M_val * np.identity(dof)\n    K = np.zeros((dof, dof))\n    for i in range(dof):\n        K[i, i] = 2.0 * K_val\n        if i > 0:\n            K[i, i-1] = -1.0 * K_val\n        if i  dof - 1:\n            K[i, i+1] = -1.0 * K_val\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (T, t_end, j_one_based, alpha, beta, dt)\n        (1.0, 3.0, 3, 0.02, 0.0002, 0.001),\n        (0.05, 0.5, 1, 0.0, 0.0, 0.0001),\n        (0.05, 0.5, 5, 0.5, 0.002, 0.0001),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        T, t_end, j_one_based, alpha, beta, dt = case\n        \n        # Convert 1-based index to 0-based\n        j_idx = j_one_based - 1\n        \n        # Damping matrix for the current case\n        C = alpha * M + beta * K\n        \n        # Time steps\n        time_steps = np.arange(0, t_end + dt, dt)\n        num_steps = len(time_steps)\n\n        # Force vector definition\n        e_j = np.zeros(dof)\n        e_j[j_idx] = 1.0\n\n        def get_force(t):\n            if 0 = t = T:\n                return F0 * np.sin(np.pi * t / T) * e_j\n            return np.zeros(dof)\n\n        # --- Task A: Direct Integration (Newmark-beta method) ---\n        gamma = 0.5\n        beta_nm = 0.25\n        \n        u = np.zeros(dof)\n        u_dot = np.zeros(dof)\n        # Initial acceleration from EOM at t=0\n        # M*u_ddot(0) + C*u_dot(0) + K*u(0) = f(0)\n        # Since u(0)=0, u_dot(0)=0, f(0)=0, then M*u_ddot(0)=0 => u_ddot(0)=0\n        u_ddot = np.zeros(dof)\n\n        u_history = np.zeros((num_steps, dof))\n        \n        K_hat = (1 / (beta_nm * dt**2)) * M + (gamma / (beta_nm * dt)) * C + K\n\n        for i in range(num_steps - 1):\n            t_next = time_steps[i+1]\n            f_next = get_force(t_next)\n            \n            f_hat = f_next + M @ ( (1/(beta_nm*dt**2))*u + (1/(beta_nm*dt))*u_dot + (1/(2*beta_nm) - 1)*u_ddot ) \\\n                         + C @ ( (gamma/(beta_nm*dt))*u + (gamma/beta_nm - 1)*u_dot + dt/2*(gamma/beta_nm - 2)*u_ddot )\n            \n            u_next = np.linalg.solve(K_hat, f_hat)\n            u_ddot_next = (1/(beta_nm*dt**2)) * (u_next - u - dt*u_dot) - (1/(2*beta_nm) - 1)*u_ddot\n            u_dot_next = u_dot + dt*((1-gamma)*u_ddot + gamma*u_ddot_next)\n\n            u, u_dot, u_ddot = u_next, u_dot_next, u_ddot_next\n            u_history[i+1, :] = u\n\n        # --- Task B: Modal Superposition ---\n        num_modes = 3\n        \n        # Solve generalized eigenvalue problem: K*phi = omega^2*M*phi\n        eigvals, eigvecs = eigh(K, M)\n        \n        omega_sq = eigvals[:num_modes]\n        omega = np.sqrt(omega_sq)\n        \n        # Mass normalize eigenvectors\n        phi_raw = eigvecs[:, :num_modes]\n        modal_masses = np.einsum('ji,jk,ki->i', phi_raw, M, phi_raw)\n        phi = phi_raw / np.sqrt(modal_masses)\n\n        # Modal damping\n        c_modal = alpha + beta * omega_sq\n        \n        q = np.zeros(num_modes)\n        q_dot = np.zeros(num_modes)\n        q_ddot = np.zeros(num_modes) # Initial modal acceleration is zero\n        \n        u_modal_history = np.zeros((num_steps, dof))\n        \n        k_hat_modal = (1 / (beta_nm * dt**2)) + (gamma / (beta_nm * dt)) * c_modal + omega_sq\n\n        for i in range(num_steps - 1):\n            t_next = time_steps[i+1]\n            f_next = get_force(t_next)\n            p_next = phi.T @ f_next\n            \n            p_hat = p_next + (1/(beta_nm*dt**2))*q + (1/(beta_nm*dt))*q_dot + (1/(2*beta_nm) - 1)*q_ddot \\\n                         + c_modal * ( (gamma/(beta_nm*dt))*q + (gamma/beta_nm-1)*q_dot + dt/2*(gamma/beta_nm - 2)*q_ddot )\n            \n            q_next = p_hat / k_hat_modal\n            q_ddot_next = (1/(beta_nm*dt**2))*(q_next - q - dt*q_dot) - (1/(2*beta_nm) - 1)*q_ddot\n            q_dot_next = q_dot + dt*((1-gamma)*q_ddot + gamma*q_ddot_next)\n            \n            q, q_dot, q_ddot = q_next, q_dot_next, q_ddot_next\n            u_modal_history[i+1, :] = phi @ q\n\n        # --- Task C: Comparison Metric ---\n        diff_history = u_modal_history - u_history\n        \n        # Infinity norm at each time step\n        inf_norm_diff = np.max(np.abs(diff_history), axis=1)\n        inf_norm_u = np.max(np.abs(u_history), axis=1)\n        \n        numerator = np.max(inf_norm_diff)\n        denominator = np.max(inf_norm_u)\n\n        if denominator == 0.0:\n            r = 0.0\n        else:\n            r = numerator / denominator\n            \n        results.append(r)\n        \n    # Final print statement in the exact required format.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2578825"}, {"introduction": "正如在前面的练习中所见，截断模态可能导致误差，尤其是在预测静态行为和反力时。这个高级实践介绍了一种强大的技术——模态加速度法 (Mode Acceleration Method, MAM)，该方法旨在纠正这些缺陷。通过实施和比较标准的模态位移法 (Mode Displacement Method, MDM) 与更复杂的 MAM，您将亲眼看到，即使只使用少量模态，包含静态校正项也能显著提高预测的准确性 [@problem_id:2578761]。", "problem": "给定一个由结构动力学问题的有限元法 (FEM) 半离散化得到的线性时不变二阶系统，其控制方程为如下矩阵常微分方程\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{x}}(t) + \\mathbf{C}\\,\\dot{\\mathbf{x}}(t) + \\mathbf{K}\\,\\mathbf{x}(t) = \\mathbf{f}(t),\n$$\n初始条件为\n$$\n\\mathbf{x}(0) = \\mathbf{0},\\quad \\dot{\\mathbf{x}}(0) = \\mathbf{0}.\n$$\n其中，$\\mathbf{M}\\in\\mathbb{R}^{n\\times n}$ 是对称正定质量矩阵，$\\mathbf{K}\\in\\mathbb{R}^{n\\times n}$ 是对称正定刚度矩阵，$\\mathbf{C}\\in\\mathbb{R}^{n\\times n}$ 是阻尼矩阵，假定为 $\\mathbf{C} = \\alpha\\,\\mathbf{M} + \\beta\\,\\mathbf{K}$ 的 Rayleigh 阻尼形式，$\\mathbf{f}(t)$ 是阶跃荷载 $\\mathbf{f}(t) = \\mathbf{f}_0\\,H(t)$，其中 $H(t)$ 是 Heaviside 阶跃函数，$\\mathbf{f}_0\\in\\mathbb{R}^{n}$ 是一个恒定荷载向量，$t$ 是时间，单位为秒。\n\n任务是比较两种用于预测阶跃荷载下物理位移响应和支座反力的振型叠加截断策略：\n- 振型位移法 (MDM): 保留 $r$ 个振型，并仅从保留的振型位移中重构物理位移。\n- 振型加速度法 (MAM): 为振型动力学保留 $r$ 个振型，但通过使用刚度矩阵进行静态修正，强制残余荷载达到平衡，从而增广物理位移的重构。\n\n您必须：\n1. 从上述基本控制方程和 Rayleigh 阻尼的定义出发，通过求解广义特征值问题\n$$\n\\mathbf{K}\\,\\boldsymbol{\\phi}_j = \\omega_j^2\\,\\mathbf{M}\\,\\boldsymbol{\\phi}_j,\\quad j=1,\\dots,n,\n$$\n推导出振型方程，其质量归一化为 $\\boldsymbol{\\phi}_i^{\\top}\\mathbf{M}\\,\\boldsymbol{\\phi}_j = \\delta_{ij}$。记 $\\boldsymbol{\\Phi} = [\\boldsymbol{\\phi}_1,\\dots,\\boldsymbol{\\phi}_n]$，$\\boldsymbol{\\Omega}^2 = \\mathrm{diag}(\\omega_1^2,\\dots,\\omega_n^2)$，并写出阶跃荷载下广义坐标 $\\mathbf{q}(t)$ 的解耦振型方程。\n2. 精确定义仅使用前 $r$ 个振型的 MDM 和 MAM 物理位移重构，确保 MAM 修正是通过在每个时间 $t$ 强制物理坐标系中残余荷载的静态平衡来获得的。除了是阶跃荷载外，不要假定荷载有任何特殊结构；从第一性原理推导表达式。\n3. 对于一个具有平移自由度 $\\mathbf{x}(t) = [x_1(t), x_2(t), x_3(t)]^\\top$ (单位：米) 的三自由度链式系统，采用以下刚度拓扑：刚度为 $k_1$ 的弹簧将 $x_1$ 连接到地面，刚度为 $k_2$ 的弹簧连接 $x_1$ 和 $x_2$，刚度为 $k_3$ 的弹簧连接 $x_2$ 和 $x_3$。相应的刚度矩阵是\n$$\n\\mathbf{K} = \\begin{bmatrix}\nk_1 + k_2  -k_2  0\\\\\n-k_2  k_2 + k_3  -k_3\\\\\n0  -k_3  k_3\n\\end{bmatrix}.\n$$\n底部反力定义为接地弹簧中的弹性力，即 $R_\\text{base}(t) = k_1\\,x_1(t)$，单位为牛顿。\n4. 通过在两个选定的圆频率 $\\omega_a$ 和 $\\omega_b$ 处强制施加目标振型阻尼比 $\\zeta(\\omega_a)=\\zeta_a$ 和 $\\zeta(\\omega_b)=\\zeta_b$ L来标定 Rayleigh 阻尼系数 $\\alpha$ 和 $\\beta$，并使用质量归一化振型的恒等式\n$$\n\\zeta_j \\equiv \\frac{\\boldsymbol{\\phi}_j^{\\top}\\mathbf{C}\\,\\boldsymbol{\\phi}_j}{2\\,\\omega_j} = \\frac{\\alpha}{2\\,\\omega_j} + \\frac{\\beta\\,\\omega_j}{2}.\n$$\n对于下述每个测试案例，使用 $\\omega_a=\\omega_1$、$\\omega_b=\\omega_3$ 以及指定的目标值 $\\zeta_a$ 和 $\\zeta_b$。\n5. 使用一个对于线性系统无条件稳定且二阶精确的振型空间时间积分方案 (例如 Newmark 平均加速度法) 来计算保留的广义坐标的时程，这适用于 MDM 和 MAM 重构，以及使用所有 $n$ 个振型的参考解。由于质量归一化，振型质量必须为 1。时间单位为秒，力单位为牛顿，质量单位为千克，刚度单位为牛顿/米。对于所有情况，初始条件均为零。Heaviside 阶跃在 $t=0^+$ 时施加。\n6. 对于每个测试案例，计算：\n   - 顶部自由度 $x_3(t)$ 的峰值绝对位移（单位：米）。\n   - 底部反力 $R_\\text{base}(t)$ 的峰值绝对值（单位：牛顿）。\n   对于这两个量，计算 MDM 和 MAM 相对于使用所有 $n$ 个振型的全振型参考解的绝对相对误差：\n$$\n\\varepsilon = \\left|\\frac{\\text{approximate peak}}{\\text{reference peak}} - 1\\right|.\n$$\n将这些误差表示为小数（而非百分比），并四舍五入到六位小数。\n\n实现一个程序，对以下测试套件执行上述操作。在每个案例中，指定质量矩阵 $\\mathbf{M}$（对角阵）、刚度参数 $(k_1,k_2,k_3)$、阶跃荷载向量 $\\mathbf{f}_0$、保留振型数 $r$、在 $(\\omega_1,\\omega_3)$ 处的 Rayleigh 阻尼目标 $(\\zeta_a,\\zeta_b)$、最终时间 $T_\\text{end}$（单位：秒）以及均匀时间步长 $\\Delta t$（单位：秒）。\n\n测试套件：\n- 案例 A (基准，轻阻尼，一阶振型截断)：\n  - $\\mathbf{M} = \\mathrm{diag}([1000, 1200, 800])$，单位：千克。\n  - $(k_1,k_2,k_3) = (2.0\\times 10^6, 1.5\\times 10^6, 1.0\\times 10^6)$，单位：牛顿/米。\n  - $\\mathbf{f}_0 = [0, 0, 10000]^\\top$，单位：牛顿。\n  - $r = 1$。\n  - $(\\zeta_a, \\zeta_b) = (0.02, 0.02)$。\n  - $T_\\text{end} = 1.2$ 秒，$\\Delta t = 5.0\\times 10^{-4}$ 秒。\n- 案例 B (较硬系统，一阶振型截断)：\n  - $\\mathbf{M} = \\mathrm{diag}([1000, 1200, 800])$，单位：千克。\n  - $(k_1,k_2,k_3) = (5.0\\times 10^6, 5.0\\times 10^6, 5.0\\times 10^6)$，单位：牛顿/米。\n  - $\\mathbf{f}_0 = [5000, 0, 0]^\\top$，单位：牛顿。\n  - $r = 1$。\n  - $(\\zeta_a, \\zeta_b) = (0.02, 0.02)$。\n  - $T_\\text{end} = 0.6$ 秒，$\\Delta t = 2.0\\times 10^{-4}$ 秒。\n- 案例 C (无阻尼，二阶振型截断)：\n  - $\\mathbf{M} = \\mathrm{diag}([1000, 1200, 800])$，单位：千克。\n  - $(k_1,k_2,k_3) = (2.5\\times 10^6, 1.8\\times 10^6, 1.2\\times 10^6)$，单位：牛顿/米。\n  - $\\mathbf{f}_0 = [0, 8000, 0]^\\top$，单位：牛顿。\n  - $r = 2$。\n  - $(\\zeta_a, \\zeta_b) = (0.0, 0.0)$，即 $\\alpha=\\beta=0$。\n  - $T_\\text{end} = 1.0$ 秒，$\\Delta t = 4.0\\times 10^{-4}$ 秒。\n\n您的程序必须：\n- 对于每个案例，组集 $\\mathbf{M}$ 和 $\\mathbf{K}$，计算全套质量归一化振型，确定 Rayleigh 阻尼的 $\\alpha$和 $\\beta$（案例C除外，其中 $\\alpha=\\beta=0$），组集 $\\mathbf{C}$，并使用一致的 Newmark 平均加速度法，根据给定的 $\\Delta t$ 和 $T_\\text{end}$，对保留振型集和全振型集积分求解解耦的振型方程。\n- 仅使用保留的振型重构 MDM 和 MAM 的物理位移时程，并使用所有振型计算参考物理位移。\n- 计算 MDM、MAM 和参考解各自的 $x_3(t)$ 峰值绝对值（单位：米）和 $R_\\text{base}(t)=k_1 x_1(t)$ 峰值绝对值（单位：牛顿），然后按规定计算绝对相对误差，四舍五入到六位小数。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按顺序包含案例 A、B、C 的以下结果：$x_3$ 处的 MDM 位移误差、$x_3$ 处的 MAM 位移误差、MDM 底部反力误差、MAM 底部反力误差。所有值都必须是四舍五入到六位小数的小数。例如，输出格式必须是\n$$\n[\\varepsilon^\\text{A}_\\text{MDM,disp},\\varepsilon^\\text{A}_\\text{MAM,disp},\\varepsilon^\\text{A}_\\text{MDM,rxn},\\varepsilon^\\text{A}_\\text{MAM,rxn},\\varepsilon^\\text{B}_\\text{MDM,disp},\\dots,\\varepsilon^\\text{C}_\\text{MAM,rxn}]\n$$\n列表包含恰好 12 个条目，且无额外文本。", "solution": "所提出的问题是结构动力学领域一个标准的、适定的问题。所有提供的数据、方程和条件在科学上都是合理的、一致的，并且足以得到唯一解。该问题是有效的。\n\n任务是分析一个线性时不变结构系统，并比较两种振型截断方法：振型位移法 (MDM) 和振型加速度法 (MAM)。该系统由二阶矩阵常微分方程控制：\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{x}}(t) + \\mathbf{C}\\,\\dot{\\mathbf{x}}(t) + \\mathbf{K}\\,\\mathbf{x}}(t) = \\mathbf{f}(t)\n$$\n初始条件为 $\\mathbf{x}(0) = \\mathbf{0}$ 和 $\\dot{\\mathbf{x}}(0) = \\mathbf{0}$。矩阵 $\\mathbf{M}$ 和 $\\mathbf{K}$ 分别是还为对称正定的质量矩阵和刚度矩阵。阻尼矩阵 $\\mathbf{C}$ 假定为 Rayleigh 形式，即 $\\mathbf{C} = \\alpha\\,\\mathbf{M} + \\beta\\,\\mathbf{K}$。外部荷载为阶跃函数 $\\mathbf{f}(t) = \\mathbf{f}_0\\,H(t)$。\n\n**1. 解耦振型方程的推导**\n\n振型分析的核心是将耦合的物理坐标系 $\\mathbf{x}(t)$ 转换为一组非耦合的广义（或振型）坐标系 $\\mathbf{q}(t)$。这通过求解无阻尼自由振动的广义特征值问题来实现：\n$$\n\\mathbf{K}\\,\\boldsymbol{\\phi}_j = \\omega_j^2\\,\\mathbf{M}\\,\\boldsymbol{\\phi}_j, \\quad j=1,\\dots,n\n$$\n其中 $\\omega_j$ 是自振圆频率，$\\boldsymbol{\\phi}_j$ 是对应的振型。振型向量关于 $\\mathbf{M}$ 和 $\\mathbf{K}$ 都是正交的。我们强制进行质量归一化，使得：\n$$\n\\boldsymbol{\\phi}_i^{\\top}\\mathbf{M}\\,\\boldsymbol{\\phi}_j = \\delta_{ij} \\quad (\\text{振型质量为单位1})\n$$\n$$\n\\boldsymbol{\\phi}_i^{\\top}\\mathbf{K}\\,\\boldsymbol{\\phi}_j = \\omega_j^2 \\delta_{ij} \\quad (\\text{振型刚度为 } \\omega_j^2)\n$$\n令 $\\boldsymbol{\\Phi} = [\\boldsymbol{\\phi}_1, \\dots, \\boldsymbol{\\phi}_n]$ 为振型矩阵，$\\boldsymbol{\\Omega}^2 = \\mathrm{diag}(\\omega_1^2, \\dots, \\omega_n^2)$ 为频率平方的对角矩阵。坐标变换定义为 $\\mathbf{x}(t) = \\boldsymbol{\\Phi}\\,\\mathbf{q}(t)$。将此代入控制方程：\n$$\n\\mathbf{M}\\,\\boldsymbol{\\Phi}\\,\\ddot{\\mathbf{q}}(t) + \\mathbf{C}\\,\\boldsymbol{\\Phi}\\,\\dot{\\mathbf{q}}(t) + \\mathbf{K}\\,\\boldsymbol{\\Phi}\\,\\mathbf{q}(t) = \\mathbf{f}(t)\n$$\n用 $\\boldsymbol{\\Phi}^{\\top}$ 左乘并应用正交性，可得：\n$$\n\\boldsymbol{\\Phi}^{\\top}\\mathbf{M}\\,\\boldsymbol{\\Phi}\\,\\ddot{\\mathbf{q}}(t) + \\boldsymbol{\\Phi}^{\\top}\\mathbf{C}\\,\\boldsymbol{\\Phi}\\,\\dot{\\mathbf{q}}(t) + \\boldsymbol{\\Phi}^{\\top}\\mathbf{K}\\,\\boldsymbol{\\Phi}\\,\\mathbf{q}(t) = \\boldsymbol{\\Phi}^{\\top}\\mathbf{f}(t)\n$$\n$$\n\\mathbf{I}\\,\\ddot{\\mathbf{q}}(t) + \\mathbf{\\hat{C}}\\,\\dot{\\mathbf{q}}(t) + \\boldsymbol{\\Omega}^2\\,\\mathbf{q}(t) = \\boldsymbol{\\Phi}^{\\top}\\mathbf{f}(t)\n$$\n其中 $\\mathbf{\\hat{C}} = \\boldsymbol{\\Phi}^{\\top}\\mathbf{C}\\,\\boldsymbol{\\Phi}$ 是振型阻尼矩阵。对于 Rayleigh 阻尼，$\\mathbf{C} = \\alpha\\,\\mathbf{M} + \\beta\\,\\mathbf{K}$，振型阻尼矩阵变为对角阵：\n$$\n\\mathbf{\\hat{C}} = \\boldsymbol{\\Phi}^{\\top}(\\alpha\\,\\mathbf{M} + \\beta\\,\\mathbf{K})\\boldsymbol{\\Phi} = \\alpha\\,\\boldsymbol{\\Phi}^{\\top}\\mathbf{M}\\,\\boldsymbol{\\Phi} + \\beta\\,\\boldsymbol{\\Phi}^{\\top}\\mathbf{K}\\,\\boldsymbol{\\Phi} = \\alpha\\,\\mathbf{I} + \\beta\\,\\boldsymbol{\\Omega}^2\n$$\n这得到了一组 $n$ 个解耦的单自由度 (SDOF) 方程。对于第 $j$ 个振型，其方程为：\n$$\n\\ddot{q}_j(t) + (\\alpha + \\beta\\,\\omega_j^2)\\,\\dot{q}_j(t) + \\omega_j^2\\,q_j(t) = \\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}(t)\n$$\n其中 $(\\alpha + \\beta\\,\\omega_j^2)$ 项等价于 $2\\zeta_j\\omega_j$，此处 $\\zeta_j$ 是第 $j$ 个振型的振型阻尼比。因此，$\\zeta_j = \\frac{\\alpha}{2\\omega_j} + \\frac{\\beta\\omega_j}{2}$。对于指定的阶跃荷载，每个振型坐标的方程变为：\n$$\n\\ddot{q}_j(t) + 2\\zeta_j\\omega_j\\,\\dot{q}_j(t) + \\omega_j^2\\,q_j(t) = \\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}_0, \\quad \\text{for } t > 0\n$$\n初始条件变换为 $\\mathbf{q}(0) = \\boldsymbol{\\Phi}^{-1}\\mathbf{x}(0) = \\mathbf{0}$ 和 $\\dot{\\mathbf{q}}(0) = \\boldsymbol{\\Phi}^{-1}\\dot{\\mathbf{x}}(0) = \\mathbf{0}$。\n\n**2. 振型位移法 (MDM) 与振型加速度法 (MAM) 的对比**\n\n当使用一个包含 $r  n$ 个振型（通常是频率最低的那些）的简化集时，我们寻求 $\\mathbf{x}(t)$ 的一个近似解。\n\n**振型位移法 (MDM):** 此方法直接截断位移的振型级数展开。近似的物理位移仅由保留的 $r$ 个振型坐标重构：\n$$\n\\mathbf{x}_\\text{MDM}(t) = \\sum_{j=1}^r \\boldsymbol{\\phi}_j q_j(t) = \\boldsymbol{\\Phi}_r \\mathbf{q}_r(t)\n$$\n其中 $\\boldsymbol{\\Phi}_r = [\\boldsymbol{\\phi}_1, \\dots, \\boldsymbol{\\phi}_r]$ 且 $\\mathbf{q}_r(t) = [q_1(t), \\dots, q_r(t)]^\\top$。振型坐标 $q_j(t)$ (对于 $j=1, \\dots, r$) 是通过对各自的 SDOF 方程进行积分得到的。\n\n**振型加速度法 (MAM):** 此方法通过包含对被截断的高阶振型贡献的静态修正，提供了一个改进的近似。我们首先重写控制方程以静态方式表达位移：\n$$\n\\mathbf{x}(t) = \\mathbf{K}^{-1}[\\mathbf{f}(t) - \\mathbf{M}\\,\\ddot{\\mathbf{x}}(t) - \\mathbf{C}\\,\\dot{\\mathbf{x}}(t)]\n$$\n其中 $\\mathbf{K}^{-1}\\mathbf{f}(t)$ 是伪静态响应。其他项代表由惯性力和阻尼力引起的动力修正。MAM 的关键思想是仅使用保留的 $r$ 个振型来近似这些动力。\n$$\n\\ddot{\\mathbf{x}}(t) \\approx \\sum_{j=1}^r \\boldsymbol{\\phi}_j \\ddot{q}_j(t), \\quad \\dot{\\mathbf{x}}(t) \\approx \\sum_{j=1}^r \\boldsymbol{\\phi}_j \\dot{q}_j(t)\n$$\n代入这些近似和振型运动方程 $\\ddot{q}_j = p_j(t) - c_j\\dot{q}_j - k_j q_j$ (其中 $p_j(t) = \\boldsymbol{\\phi}_j^\\top \\mathbf{f}(t)$, $c_j=2\\zeta_j\\omega_j$, $k_j=\\omega_j^2$)，我们可以推导出一个更方便的形式。一个更清晰的推导是观察到完整位移为 $\\mathbf{x}(t) = \\sum_{j=1}^n \\boldsymbol{\\phi}_j q_j(t)$。我们将其分为保留部分和截断部分：\n$$\n\\mathbf{x}(t) = \\sum_{j=1}^r \\boldsymbol{\\phi}_j q_j(t) + \\sum_{j=r+1}^n \\boldsymbol{\\phi}_j q_j(t)\n$$\nMAM 用高频截断振型 ($j  r$) 的静态响应来近似它们的贡献。从振型方程出发，忽略高频振型的惯性项和阻尼项，得到 $\\omega_j^2 q_j(t) \\approx \\boldsymbol{\\phi}_j^\\top \\mathbf{f}(t)$，因此 $q_j(t) \\approx \\frac{\\boldsymbol{\\phi}_j^\\top \\mathbf{f}(t)}{\\omega_j^2}$。因此，MAM 位移为：\n$$\n\\mathbf{x}_\\text{MAM}(t) \\approx \\sum_{j=1}^r \\boldsymbol{\\phi}_j q_j(t) + \\sum_{j=r+1}^n \\boldsymbol{\\phi}_j \\frac{\\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}(t)}{\\omega_j^2}\n$$\n第二项是截断振型的静态响应。这可以表示为总静态响应与保留振型静态响应之差：\n$$\n\\sum_{j=r+1}^n \\boldsymbol{\\phi}_j \\frac{\\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}(t)}{\\omega_j^2} = \\mathbf{K}^{-1}\\mathbf{f}(t) - \\sum_{j=1}^r \\boldsymbol{\\phi}_j \\frac{\\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}(t)}{\\omega_j^2}\n$$\n将其代回，我们得到阶跃荷载 $\\mathbf{f}(t) = \\mathbf{f}_0 H(t)$ 下 MAM 位移的最终表达式：\n$$\n\\mathbf{x}_\\text{MAM}(t) = \\mathbf{K}^{-1}\\mathbf{f}_0 + \\sum_{j=1}^r \\boldsymbol{\\phi}_j \\left( q_j(t) - \\frac{\\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}_0}{\\omega_j^2} \\right)\n$$\n此处，$q_j(t)$ 是第 $j$ 个振型坐标的完整动力解，减去的项是其静态分量。这种公式用高阶振型的静态响应代替其动态响应，这通常是一个显著的改进，尤其是在恢复内力和反力方面。\n\n**3. 数值积分**\n\nSDOF 振型方程使用 Newmark 平均加速度法进行数值积分。对于此方法，参数为 $\\gamma = 1/2$ 和 $\\beta_{NM} = 1/4$。它对于线性系统是无条件稳定的，并且具有二阶精度。在每个时间步 $t_{i+1} = t_i + \\Delta t$，对于每个振型 $j$，给定 $(q_{j,i}, \\dot{q}_{j,i}, \\ddot{q}_{j,i})$，我们求解 $(q_{j,i+1}, \\dot{q}_{j,i+1}, \\ddot{q}_{j,i+1})$。在初始条件 $q_j(0)=0, \\dot{q}_j(0)=0$ 下，初始加速度为 $\\ddot{q}_j(0) = \\boldsymbol{\\phi}_j^\\top\\mathbf{f}_0$。对每个时间步进行更新，直到达到 $T_\\text{end}$。\n\n**4. 关注量与误差度量**\n\n对于每种重构方法（MDM、MAM）和全振型参考解，我们计算物理位移 $\\mathbf{x}(t)$ 的时程。由此，我们提取两个量：\n- 顶部自由度的位移，$x_3(t)$。\n- 底部反力，$R_\\text{base}(t) = k_1 x_1(t)$。\n\n对于每个量，我们找到其在整个时程中的峰值绝对值。然后，计算近似方法（MDM 或 MAM）相对于参考解（使用所有 $n$ 个振型）的绝对相对误差 $\\varepsilon$：\n$$\n\\varepsilon = \\left|\\frac{\\text{approximate peak}}{\\text{reference peak}} - 1\\right|\n$$\n以下程序为指定的测试套件实现了此过程。", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for MDM vs. MAM comparison.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"M_diag\": [1000.0, 1200.0, 800.0],\n            \"k_vals\": (2.0e6, 1.5e6, 1.0e6),\n            \"f0\": np.array([0.0, 0.0, 10000.0]),\n            \"r\": 1,\n            \"zetas\": (0.02, 0.02),\n            \"Tend\": 1.2,\n            \"dt\": 5.0e-4,\n        },\n        {\n            \"name\": \"Case B\",\n            \"M_diag\": [1000.0, 1200.0, 800.0],\n            \"k_vals\": (5.0e6, 5.0e6, 5.0e6),\n            \"f0\": np.array([5000.0, 0.0, 0.0]),\n            \"r\": 1,\n            \"zetas\": (0.02, 0.02),\n            \"Tend\": 0.6,\n            \"dt\": 2.0e-4,\n        },\n        {\n            \"name\": \"Case C\",\n            \"M_diag\": [1000.0, 1200.0, 800.0],\n            \"k_vals\": (2.5e6, 1.8e6, 1.2e6),\n            \"f0\": np.array([0.0, 8000.0, 0.0]),\n            \"r\": 2,\n            \"zetas\": (0.0, 0.0),\n            \"Tend\": 1.0,\n            \"dt\": 4.0e-4,\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        results = _solve_case(**case)\n        all_results.extend(results)\n\n    # Format the final output as specified.\n    print(f\"[{','.join([f'{r:.6f}' for r in all_results])}]\")\n\n\ndef _solve_case(name, M_diag, k_vals, f0, r, zetas, Tend, dt):\n    \"\"\"\n    Solves a single test case for the modal analysis comparison.\n    \"\"\"\n    n = len(M_diag)\n    M = np.diag(M_diag)\n    k1, k2, k3 = k_vals\n    K = np.array([\n        [k1 + k2, -k2, 0],\n        [-k2, k2 + k3, -k3],\n        [0, -k3, k3]\n    ])\n\n    # 1. Solve the generalized eigenvalue problem K*phi = omega^2*M*phi\n    eigvals, eigvecs = eigh(K, M)\n    omega = np.sqrt(eigvals)\n    \n    # 2. Mass-normalize the eigenvectors\n    Phi = np.zeros_like(eigvecs)\n    for j in range(n):\n        phi_j_un = eigvecs[:, j]\n        norm_factor = np.sqrt(phi_j_un.T @ M @ phi_j_un)\n        Phi[:, j] = phi_j_un / norm_factor\n\n    # 3. Determine Rayleigh damping coefficients alpha and beta\n    zeta_a, zeta_b = zetas\n    if zeta_a == 0.0 and zeta_b == 0.0:\n        alpha, beta = 0.0, 0.0\n    else:\n        # Calibrate using modes 1 and 3 (indices 0 and 2)\n        omega_a, omega_b = omega[0], omega[2]\n        A = np.array([[1, omega_a**2], [1, omega_b**2]])\n        b_vec = np.array([2 * zeta_a * omega_a, 2 * zeta_b * omega_b])\n        alpha, beta = np.linalg.solve(A, b_vec)\n    \n    # 4. Calculate modal damping ratios and modal forces\n    modal_zeta = (alpha / (2 * omega)) + (beta * omega / 2)\n    modal_forces = Phi.T @ f0\n\n    # 5. Time integration using Newmark's average-acceleration method\n    time_steps = np.arange(0, Tend + dt/2, dt)\n    num_steps = len(time_steps)\n    \n    q = np.zeros((n, num_steps))\n    q_dot = np.zeros((n, num_steps))\n    q_ddot = np.zeros((n, num_steps))\n\n    # Initial conditions: q(0) = 0, q_dot(0) = 0\n    # From EOM at t=0+: M*q_ddot + C*q_dot + K*q = F => 1*q_ddot(0) = p\n    q_ddot[:, 0] = modal_forces\n\n    gamma_nm, beta_nm = 0.5, 0.25\n\n    for j in range(n):\n        c_j = 2 * modal_zeta[j] * omega[j]\n        k_j = omega[j]**2\n        p_j = modal_forces[j]\n        \n        # Pre-calculate constant denominator for acceleration update\n        denom = 1 + c_j * gamma_nm * dt + k_j * beta_nm * dt**2\n        \n        for i in range(num_steps - 1):\n            # Predictors (for average acceleration method)\n            q_pred = q[j, i] + dt * q_dot[j, i] + (dt**2 / 4) * q_ddot[j, i]\n            q_dot_pred = q_dot[j, i] + (dt / 2) * q_ddot[j, i]\n            \n            # Solve for acceleration at t_{i+1}\n            q_ddot[j, i+1] = (p_j - c_j * q_dot_pred - k_j * q_pred) / denom\n            \n            # Correctors\n            q_dot[j, i+1] = q_dot_pred + gamma_nm * dt * q_ddot[j, i+1]\n            q[j, i+1] = q_pred + beta_nm * dt**2 * q_ddot[j, i+1]\n\n    # 6. Reconstruct physical responses\n    # Reference solution (all modes)\n    x_ref = Phi @ q\n\n    # MDM solution (r modes)\n    Phi_r = Phi[:, :r]\n    q_r = q[:r, :]\n    x_mdm = Phi_r @ q_r\n\n    # MAM solution (r modes)\n    K_inv_f0 = np.linalg.solve(K, f0).reshape(-1, 1)\n    mam_dynamic_part = np.zeros((n, num_steps))\n    for j in range(r):\n        q_j_static = modal_forces[j] / omega[j]**2\n        mam_dynamic_part += Phi[:, j:j+1] @ (q_r[j:j+1, :] - q_j_static)\n    x_mam = K_inv_f0 + mam_dynamic_part\n\n    # 7. Calculate peak values and relative errors\n    # Peak displacement at x3 (DOF 3, index 2)\n    peak_x3_ref = np.max(np.abs(x_ref[2, :]))\n    peak_x3_mdm = np.max(np.abs(x_mdm[2, :]))\n    peak_x3_mam = np.max(np.abs(x_mam[2, :]))\n\n    err_disp_mdm = abs(peak_x3_mdm / peak_x3_ref - 1)\n    err_disp_mam = abs(peak_x3_mam / peak_x3_ref - 1)\n\n    # Peak base reaction R_base = k1 * x1 (DOF 1, index 0)\n    R_ref = k1 * x_ref[0, :]\n    R_mdm = k1 * x_mdm[0, :]\n    R_mam = k1 * x_mam[0, :]\n\n    peak_R_ref = np.max(np.abs(R_ref))\n    peak_R_mdm = np.max(np.abs(R_mdm))\n    peak_R_mam = np.max(np.abs(R_mam))\n\n    err_rxn_mdm = abs(peak_R_mdm / peak_R_ref - 1)\n    err_rxn_mam = abs(peak_R_mam / peak_R_ref - 1)\n\n    return [err_disp_mdm, err_disp_mam, err_rxn_mdm, err_rxn_mam]\n\nif __name__ == '__main__':\n    solve()\n```", "id": "2578761"}]}