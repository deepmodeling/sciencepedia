{"hands_on_practices": [{"introduction": "我们从最简单的非平凡情况——标量系统开始。这个练习 [@problem_id:2700966] 将强化贝尔曼最优性原理（Bellman optimality principle）与离散代数里卡蒂方程（DARE）之间的联系。通过一步步地进行代数推导，我们将看到最优成本矩阵 $P$ 和反馈增益 $K$ 是如何从成本函数的最小化过程中产生的。", "problem": "考虑由递推公式 $x_{k+1} = A x_{k} + B u_{k}$ 描述的离散时间、单输入、单状态线性系统，其中 $A = \\begin{bmatrix}0.9\\end{bmatrix}$ 且 $B = \\begin{bmatrix}1\\end{bmatrix}$。性能指标为无穷时域二次型代价函数\n$$\nJ(x_{0}, \\{u_{k}\\}) = \\sum_{k=0}^{\\infty} \\left( x_{k}^{\\top} Q x_{k} + 2 x_{k}^{\\top} N u_{k} + u_{k}^{\\top} R u_{k} \\right),\n$$\n其中 $Q = \\begin{bmatrix}1\\end{bmatrix}$，$R = \\begin{bmatrix}2\\end{bmatrix}$，$N = 0$。假设离散时间线性二次调节器（LQR）的标准基本假设成立，即 $(A,B)$ 是可镇定的，$(A,Q^{1/2})$ 是可检测的。仅使用 Bellman 最优性原理和价值函数的二次型拟设作为你的基本出发点。\n\n1. 从 Bellman 最优性原理出发，并假设一个二次型价值函数 $V(x) = x^{\\top} P x$，其中 $P$ 为未知的对称矩阵。通过对 $u$ 进行显式最小化并进行系数匹配，推导出 $P$ 必须满足的不动点方程。\n\n2. 将你的结果应用于给定的标量数据，并确定 $P$ 的所有实数解。选择唯一的半正定解，该解能产生一个镇定反馈律。\n\n3. 使用从最小化步骤中获得的最优反馈律，计算与所选 $P$ 对应的 $u_{k} = -K x_{k}$ 中的标量状态反馈增益 $K$。\n\n请以 $P$ 和 $K$ 的精确闭式表达式给出你的最终答案；不要进行数值近似。将最终答案表示为单个行向量中的一个数对。不要求也不允许进行四舍五入。", "solution": "所述问题是离散时间最优控制理论中的一个标准练习。该问题是自洽的、数学上一致的，并且科学地基于线性二次调节器（LQR）的原理。在给定的可镇定性和可检测性假设下，该问题是适定的，这些假设保证了唯一的、半正定的、镇定解的存在性。因此，该问题是有效的，并将按要求进行求解。\n\n解答过程如问题陈述中所指定，分为三个部分。\n\n第1部分：$P$ 的不动点方程的推导\n\n此问题的基础是应用于无穷时域、离散时间 LQR 问题的 Bellman 最优性原理。最优价值函数 $V(x) = \\min_{\\{u_k\\}} J(x, \\{u_k\\})$ 必须满足 Bellman 方程：\n$$\nV(x_{k}) = \\min_{u_{k}} \\left\\{ x_{k}^{\\top} Q x_{k} + u_{k}^{\\top} R u_{k} + V(x_{k+1}) \\right\\}\n$$\n其中未来代价项使用了状态转移 $x_{k+1} = A x_{k} + B u_{k}$。注意，问题设定了交叉项权重 $N=0$。我们假设价值函数具有一个时不变二次型形式 $V(x) = x^{\\top} P x$，其中 $P$ 是一个待定的对称半正定矩阵。将此拟设代入 Bellman 方程得到：\n$$\nx_{k}^{\\top} P x_{k} = \\min_{u_{k}} \\left\\{ x_{k}^{\\top} Q x_{k} + u_{k}^{\\top} R u_{k} + (A x_{k} + B u_{k})^{\\top} P (A x_{k} + B u_{k}) \\right\\}\n$$\n为清晰起见，我们省略时间下标 $k$。展开右侧的二次项得到：\n$$\n(A x + B u)^{\\top} P (A x + B u) = x^{\\top}A^{\\top}PAx + 2x^{\\top}A^{\\top}PBu + u^{\\top}B^{\\top}PBu\n$$\n关于 $u$ 待最小化的表达式为：\n$$\n\\mathcal{H}(x, u) = x^{\\top} Q x + u^{\\top} R u + x^{\\top}A^{\\top}PAx + 2x^{\\top}A^{\\top}PBu + u^{\\top}B^{\\top}PBu\n$$\n为了找到最优控制 $u^*$，我们计算 $\\mathcal{H}$ 关于 $u$ 的梯度，并令其为零。\n$$\n\\nabla_{u} \\mathcal{H}(x, u) = 2Ru + 2B^{\\top}PAx = 0\n$$\n这得到 $Ru = -B^{\\top}PAx$。二阶导数 $\\nabla_{uu}^{2} \\mathcal{H}(x, u) = 2(R + B^{\\top}PB)$ 是正定的，因为 $R$ 是正定的（这里，$R=2>0$）而 $B^{\\top}PB$ 是半正定的。因此，该解是一个最小值点。最优控制为：\n$$\nu^*(x) = -(R + B^{\\top}PB)^{-1}B^{\\top}PAx\n$$\n将此最优控制 $u^*$ 代回 Bellman 方程：\n$$\nx^{\\top} P x = x^{\\top}Qx + (u^*)^{\\top}Ru^* + (Ax+Bu^*)^{\\top}P(Ax+Bu^*)\n$$\n经过代数处理后，右侧得以化简。一个有效的方法是将 $u^*$ 代入 $\\mathcal{H}(x, u)$ 的表达式中：\n$$\nx^{\\top} P x = x^{\\top}(Q+A^{\\top}PA)x + 2x^{\\top}A^{\\top}PB u^* + (u^*)^{\\top}(R+B^{\\top}PB)u^*\n$$\n代入 $u^*=-(R+B^{\\top}PB)^{-1}B^{\\top}PAx$：\n$$\nx^{\\top}Px = x^{\\top}(Q+A^{\\top}PA)x - 2x^{\\top}A^{\\top}PB(R+B^{\\top}PB)^{-1}B^{\\top}PAx + x^{\\top}A^{\\top}PB(R+B^{\\top}PB)^{-1}(R+B^{\\top}PB)(R+B^{\\top}PB)^{-1}B^{\\top}PAx\n$$\n化简得：\n$$\nx^{\\top}Px = x^{\\top}(Q+A^{\\top}PA)x - x^{\\top}A^{\\top}PB(R+B^{\\top}PB)^{-1}B^{\\top}PAx\n$$\n由于该等式必须对任意状态 $x$ 成立，我们可以令矩阵系数相等，从而得到离散代数里卡蒂方程 (DARE)：\n$$\nP = A^{\\top}PA + Q - A^{\\top}PB(R+B^{\\top}PB)^{-1}B^{\\top}PA\n$$\n这就是所要求的 $P$ 的不动点方程。\n\n第2部分：标量情况下 $P$ 的求解\n\n现在，我们将这个一般性结果应用于给定的标量数据：$A=0.9$, $B=1$, $Q=1$, $R=2$。矩阵 $P$ 也是一个标量。\n$$\nP = (0.9)P(0.9) + 1 - (0.9)P(1)(2 + (1)P(1))^{-1}(1)P(0.9)\n$$\n$$\nP = 0.81P + 1 - \\frac{0.81P^2}{2+P}\n$$\n为了求解 $P$，我们整理该方程：\n$$\nP - 0.81P - 1 = -\\frac{0.81P^2}{2+P}\n$$\n$$\n0.19P - 1 = -\\frac{0.81P^2}{2+P}\n$$\n$$\n(0.19P - 1)(2+P) = -0.81P^2\n$$\n$$\n0.38P + 0.19P^2 - 2 - P = -0.81P^2\n$$\n$$\nP^2 - 0.62P - 2 = 0\n$$\n这是一个关于 $P$ 的二次方程。为了找到精确解，我们使用分数进行计算。设 $0.62 = \\frac{31}{50}$。\n$$\nP^2 - \\frac{31}{50}P - 2 = 0\n$$\n$$\n50P^2 - 31P - 100 = 0\n$$\n使用二次求根公式，$P = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$：\n$$\nP = \\frac{31 \\pm \\sqrt{(-31)^2 - 4(50)(-100)}}{2(50)}\n$$\n$$\nP = \\frac{31 \\pm \\sqrt{961 + 20000}}{100}\n$$\n$$\nP = \\frac{31 \\pm \\sqrt{20961}}{100}\n$$\n两个实数根是 $P_1 = \\frac{31 + \\sqrt{20961}}{100}$ 和 $P_2 = \\frac{31 - \\sqrt{20961}}{100}$。由于 $\\sqrt{20961} \\approx 144.78$，我们有 $P_1 > 0$ 且 $P_2  0$。LQR 理论在给定的 $(A,B)$ 可镇定性和 $(A, Q^{1/2})$ 可检测性假设下，保证了 DARE 存在唯一的对称半正定解 $P \\ge 0$，并且该解能产生一个镇定反馈律。因此，我们必须选择正根。\n$$\nP = \\frac{31 + \\sqrt{20961}}{100}\n$$\n\n第3部分：反馈增益 $K$ 的计算\n\n最优控制由 $u_k = -K x_k$ 给出。根据第1部分，最优控制律的形式为 $u^*(x) = -(R+B^{\\top}PB)^{-1}B^{\\top}PAx$。通过比较这两个表达式，我们确定状态反馈增益矩阵 $K$ 为：\n$$\nK = (R + B^{\\top}PB)^{-1}B^{\\top}PA\n$$\n代入标量值：\n$$\nK = (2 + (1)^2 P)^{-1} (1) P (0.9) = \\frac{0.9P}{2+P}\n$$\n现在，我们代入在第2部分中求得的 $P$ 的值：\n$$\nP = \\frac{31 + \\sqrt{20961}}{100}\n$$\n$2+P$ 项为：\n$$\n2+P = 2 + \\frac{31 + \\sqrt{20961}}{100} = \\frac{200 + 31 + \\sqrt{20961}}{100} = \\frac{231 + \\sqrt{20961}}{100}\n$$\n$K$ 的表达式变为：\n$$\nK = \\frac{0.9 \\left(\\frac{31 + \\sqrt{20961}}{100}\\right)}{\\left(\\frac{231 + \\sqrt{20961}}{100}\\right)} = \\frac{0.9(31 + \\sqrt{20961})}{231 + \\sqrt{20961}}\n$$\n为简化起见，我们将分母有理化，并将 $0.9$ 写成 $\\frac{9}{10}$：\n$$\nK = \\frac{9}{10} \\frac{(31 + \\sqrt{20961})}{(231 + \\sqrt{20961})} \\times \\frac{(231 - \\sqrt{20961})}{(231 - \\sqrt{20961})}\n$$\n分母变为 $10 \\times (231^2 - 20961) = 10 \\times (53361 - 20961) = 10 \\times 32400 = 324000$。\n分子变为 $9 \\times [31 \\times 231 - 31\\sqrt{20961} + 231\\sqrt{20961} - 20961] = 9 \\times [7161 - 20961 + 200\\sqrt{20961}] = 9 \\times [-13800 + 200\\sqrt{20961}]$。\n$$\nK = \\frac{9(-13800 + 200\\sqrt{20961})}{324000} = \\frac{-124200 + 1800\\sqrt{20961}}{324000}\n$$\n分子和分母同除以 $1800$：\n$$\nK = \\frac{-69 + \\sqrt{20961}}{180}\n$$\n这就是最优状态反馈增益的最终精确表达式。\n\n最终答案由数对 $(P, K)$ 组成。\n$P = \\frac{31 + \\sqrt{20961}}{100}$\n$K = \\frac{-69 + \\sqrt{20961}}{180}$", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{31 + \\sqrt{20961}}{100}  \\frac{-69 + \\sqrt{20961}}{180} \\end{pmatrix}}\n$$", "id": "2700966"}, {"introduction": "在尝试求解 DARE 之前，确定一个能使系统稳定的解是否存在至关重要。这个实践 [@problem_id:2701007] 将我们的重点从计算转向概念分析，引入了能稳性（stabilizability）和能检测性（detectability）这两个基本前提条件。我们将使用 Popov-Hautus-Belevitch（PBH）测试来诊断一个不稳定系统是否可以通过反馈控制来镇定。", "problem": "考虑由下式定义的离散时间线性时不变系统和二次性能指标\n$$\nx_{k+1} = A x_{k} + B u_{k}, \\quad \\ell(x_{k},u_{k}) = x_{k}^{\\top} Q x_{k} + 2 x_{k}^{\\top} N u_{k} + u_{k}^{\\top} R u_{k},\n$$\n其中\n$$\nA=\\begin{bmatrix}1  0\\\\ 0  1.2\\end{bmatrix}, \\quad B=\\begin{bmatrix}1\\\\ 0\\end{bmatrix}, \\quad Q=I, \\quad R=1, \\quad N=0,\n$$\n以及无穷时域成本\n$$\nJ(x_{0}, \\{u_{k}\\}) = \\sum_{k=0}^{\\infty} \\ell(x_{k},u_{k}).\n$$\n如果一个对称矩阵 $P$ 是无穷时域线性二次调节器 (LQR) 问题的值函数的海森矩阵，并且对应的最优闭环矩阵的谱半径严格小于 $1$，那么该矩阵 $P$ 被称为此问题的离散时间代数里卡蒂方程 (DARE) 的一个稳定化解。仅使用关于离散时间LQR的能稳性和能检性的核心定义和公认事实，判断对于给定的数据，是否存在这样一个稳定化解。通过分析矩阵 $A$ 的模不小于 $1$ 的特征值的能控性以及矩阵对 $(A,Q^{1/2})$ 的能检性来证明你的结论。\n\n为了提供一个具体的数值结果，定义\n$$\ns := \\max\\left\\{\\,|\\lambda| \\;:\\; \\lambda \\in \\sigma(A),\\ \\mathrm{rank}\\!\\begin{bmatrix}\\lambda I - A  B\\end{bmatrix}  2 \\,\\right\\},\n$$\n并约定空集的上确界等于 $0$。报告 $s$ 的值作为你的最终答案。无需四舍五入，答案无单位。", "solution": "该问题要求分析一个给定的线性时不变系统的离散时间代数里卡蒂方程 (DARE) 是否存在稳定化解。DARE 存在唯一的半正定稳定化解 $P$ 取决于系统矩阵的两个基本性质：矩阵对 $(A, B)$ 的能稳性和矩阵对 $(A, C)$ 的能检性，其中状态权重矩阵 $Q$ 分解为 $Q=C^{\\top}C$。\n\n让我们针对给定系统分析这两个条件。系统矩阵为：\n$$ A=\\begin{bmatrix}1  0\\\\ 0  1.2\\end{bmatrix}, \\quad B=\\begin{bmatrix}1\\\\ 0\\end{bmatrix}, \\quad Q=I = \\begin{bmatrix}1  0\\\\ 0  1\\end{bmatrix} $$\n\n首先，我们讨论矩阵对 $(A, B)$ 的能稳性。一个离散时间系统是能稳的，当且仅当其所有不稳定模态都是能控的。如果矩阵 $A$ 的某个特征值 $\\lambda$ 的模 $|\\lambda| \\ge 1$，则对应的模态被认为是不稳定的。特定模态的能控性可以通过 Popov-Hautus-Belevitch (PBH) 检验来判断。一个特征值 $\\lambda$ 是能控的，当且仅当矩阵 $[\\lambda I - A \\quad B]$ 具有行满秩，对于一个 $n$ 维状态空间，秩为 $n$。在本问题中，状态维度为 $n=2$。\n\n由于 $A$ 是一个对角矩阵，其特征值即为其对角线元素。特征值为 $\\lambda_1 = 1$ 和 $\\lambda_2 = 1.2$。由于这两个特征值都满足条件 $|\\lambda| \\ge 1$，我们必须检验它们的能控性。\n\n对于特征值 $\\lambda_1 = 1$：\n我们构建 PBH 检验矩阵：\n$$ \\begin{bmatrix} \\lambda_1 I - A  B \\end{bmatrix} = \\begin{bmatrix} 1 \\cdot I - A  B \\end{bmatrix} = \\begin{bmatrix} 1\\begin{bmatrix}10\\\\01\\end{bmatrix} - \\begin{bmatrix}1  0\\\\ 0  1.2\\end{bmatrix}  \\begin{bmatrix}1\\\\ 0\\end{bmatrix} \\end{bmatrix} $$\n$$ = \\begin{bmatrix} 0  0  1 \\\\ 0  -0.2  0 \\end{bmatrix} $$\n这个 $2 \\times 3$ 矩阵的秩为 $2$，因为第二列和第三列是线性无关的。因此，秩等于状态维度 $n=2$。这意味着对应于特征值 $\\lambda_1 = 1$ 的模态是能控的。\n\n对于特征值 $\\lambda_2 = 1.2$：\n我们构建 PBH 检验矩阵：\n$$ \\begin{bmatrix} \\lambda_2 I - A  B \\end{bmatrix} = \\begin{bmatrix} 1.2 \\cdot I - A  B \\end{bmatrix} = \\begin{bmatrix} 1.2\\begin{bmatrix}10\\\\01\\end{bmatrix} - \\begin{bmatrix}1  0\\\\ 0  1.2\\end{bmatrix}  \\begin{bmatrix}1\\\\ 0\\end{bmatrix} \\end{bmatrix} $$\n$$ = \\begin{bmatrix} 0.2  0  1 \\\\ 0  0  0 \\end{bmatrix} $$\n这个 $2 \\times 3$ 矩阵的秩为 $1$，因为第二行完全由零组成。该秩小于状态维度 $n=2$。这意味着对应于特征值 $\\lambda_2 = 1.2$ 的模态是不能控的。\n\n由于系统有一个不能控的不稳定特征值 $\\lambda_2 = 1.2$，所以矩阵对 $(A, B)$ 不是能稳的。此条件的失效足以断定 DARE 的稳定化解不存在。\n\n为了完整性，我们也验证能检性条件。如果一个系统的所有不可观模态都是稳定的（即，对应的特征值 $\\lambda$ 满足 $|\\lambda|  1$），则该系统是能检的。矩阵对 $(A, C)$ 是能检的，当且仅当矩阵对 $(A^\\top, C^\\top)$ 是能稳的。等价地，根据 PBH 检验的对偶形式，能检性要求对于每一个模 $|\\lambda| \\ge 1$ 的特征值 $\\lambda$，矩阵 $\\begin{bmatrix} A - \\lambda I \\\\ C \\end{bmatrix}$ 具有列满秩（即秩为 $n=2$）。\n给定 $Q=I$。我们可以选择 $C = Q^{1/2} = I^{1/2} = I$。因此我们检验矩阵对 $(A, I)$ 的能检性。\n对于任意复数 $\\lambda$，检验矩阵为：\n$$ \\begin{bmatrix} A - \\lambda I \\\\ I \\end{bmatrix} = \\begin{bmatrix} 1-\\lambda  0 \\\\ 0  1.2-\\lambda \\\\ 1  0 \\\\ 0  1 \\end{bmatrix} $$\n这是一个 $4 \\times 2$ 的矩阵。该矩阵的秩由其两列的线性无关性决定。底部两行构成了单位矩阵 $I$，这保证了对于任何 $\\lambda$ 值，这两列总是线性无关的。因此，该矩阵的秩恒为 $2$。这意味着没有不可观的特征值。该系统是能观的，这是一个比能检性更强的条件。所以能检性条件是满足的。\n\n然而，DARE 稳定化解的存在需要同时满足能稳性和能检性。由于能稳性条件不满足，我们得出结论：对于给定的问题，不存在这样的稳定化解。\n\n问题的最后一部分要求计算 $s$ 的值：\n$$ s := \\max\\left\\{\\,|\\lambda| \\;:\\; \\lambda \\in \\sigma(A),\\ \\mathrm{rank}\\!\\begin{bmatrix}\\lambda I - A  B\\end{bmatrix}  2 \\,\\right\\} $$\n这个量 $s$ 是 $A$ 的所有不能控特征值的模的最大值。根据我们的 PBH 检验：\n- 对于 $\\lambda_1 = 1$，$\\mathrm{rank}\\!\\begin{bmatrix}\\lambda_1 I - A  B\\end{bmatrix} = 2$。此特征值不在此集合中。\n- 对于 $\\lambda_2 = 1.2$，$\\mathrm{rank}\\!\\begin{bmatrix}\\lambda_2 I - A  B\\end{bmatrix} = 1  2$。此特征值在此集合中。\n\n满足秩条件的特征值集合为 $\\{1.2\\}$。对应的模的集合为 $\\{|1.2|\\} = \\{1.2\\}$。此集合的最大元素是 $1.2$。\n因此，$s = 1.2$。", "answer": "$$\n\\boxed{1.2}\n$$", "id": "2701007"}, {"introduction": "控制器设计的最终测试是观察其实际效果。这最后一个实践 [@problem_id:2701019] 将我们从纸笔上的理论带到计算仿真中。我们将实现 LQR 控制器，通过检查闭环特征值来数值验证其镇定特性，并观察状态及其相关的李雅普诺夫函数 $V_k = x_k^{\\top} P x_k$ 的衰减，从而确认理论保证在实际环境中是成立的。", "problem": "考虑离散时间线性时不变（LTI）系统，其状态更新为 $x_{k+1} = A x_k + B u_k$，以及无穷时域二次性能指标 $J = \\sum_{k=0}^{\\infty} \\left( x_k^{\\top} Q x_k + 2 x_k^{\\top} N u_k + u_k^{\\top} R u_k \\right)$，其中 $A \\in \\mathbb{R}^{n \\times n}$，$B \\in \\mathbb{R}^{n \\times m}$，$Q \\in \\mathbb{R}^{n \\times n}$ 是半正定的，$R \\in \\mathbb{R}^{m \\times m}$ 是正定的，且 $N \\in \\mathbb{R}^{n \\times m}$。线性二次调节器（LQR）问题旨在寻找一个静态状态反馈控制律 $u_k = -K x_k$ 来最小化 $J$。闭环矩阵为 $A_{\\text{cl}} = A - B K$。最优反馈增益 $K$ 由离散时间代数里卡蒂方程（DARE）的对称解 $P \\succeq 0$ 构建。您的任务是设计一个仿真实验，以验证在最优增益下状态和李雅普诺夫函数的衰减特性。\n\n您的程序必须为每个指定的测试用例 $(A,B,Q,R,N,x_0)$，从基本原理和最优控制的标准定义出发，执行以下操作：\n- 通过求解与给定 $(A,B,Q,R,N)$ 相关联的离散时间代数里卡蒂方程（DARE），计算最优状态反馈增益 $K$。\n- 构建闭环矩阵 $A_{\\text{cl}} = A - B K$ 并评估其谱半径（其特征值的最大绝对值）。\n- 从给定的初始条件 $x_0$ 开始，模拟 $k = 0,1,\\dots,T-1$ 的闭环轨迹 $x_{k+1} = A_{\\text{cl}} x_k$，其中 $T$ 是固定的并在下面指定。\n- 沿着轨迹计算欧几里得范数 $\\lVert x_k \\rVert_2$ 和二次李雅普诺夫序列 $V_k = x_k^{\\top} P x_k$。\n- 对每个测试用例，报告：\n  1) 一个布尔值，指示 $A_{\\text{cl}}$ 的谱半径是否严格小于 $1$。\n  2) 一个布尔值，指示序列 $V_k$ 是否在机器容差范围内单调不增，即对于所有 $k$，$V_{k+1} \\le V_k + \\varepsilon$ 成立，其中固定的 $\\varepsilon$ 在下面指定。\n  3) 一个浮点数，等于比值 $\\lVert x_T \\rVert_2 / \\lVert x_0 \\rVert_2$，四舍五入到六位小数。\n\n使用以下固定的时域和容差：$T = 200$ 和 $\\varepsilon = 10^{-10}$。\n\n测试套件。请精确实现以下四个测试用例。每个用例指定了 $(A,B,Q,R,N,x_0)$。\n\n用例 $1$（基准，单输入，严格开环不稳定但可镇定）：\n$$\nA_1 = \\begin{bmatrix} 1.2  0.1 \\\\ 0.0  0.95 \\end{bmatrix},\\quad\nB_1 = \\begin{bmatrix} 1.0 \\\\ 0.5 \\end{bmatrix},\\quad\nQ_1 = \\begin{bmatrix} 1.0  0.0 \\\\ 0.0  1.0 \\end{bmatrix},\\quad\nR_1 = \\begin{bmatrix} 1.0 \\end{bmatrix},\\quad\nN_1 = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix},\\quad\nx_{0,1} = \\begin{bmatrix} 3.0 \\\\ -1.0 \\end{bmatrix}.\n$$\n\n用例 $2$（接近边界，具有临界开环模态，单输入）：\n$$\nA_2 = \\begin{bmatrix} 1.0  0.2 \\\\ 0.0  0.9 \\end{bmatrix},\\quad\nB_2 = \\begin{bmatrix} 1.0 \\\\ 0.1 \\end{bmatrix},\\quad\nQ_2 = \\begin{bmatrix} 1.0  0.0 \\\\ 0.0  1.0 \\end{bmatrix},\\quad\nR_2 = \\begin{bmatrix} 0.1 \\end{bmatrix},\\quad\nN_2 = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix},\\quad\nx_{0,2} = \\begin{bmatrix} 1.0 \\\\ 2.0 \\end{bmatrix}.\n$$\n\n用例 $3$（多输入，带非零交叉权重，严格开环不稳定但完全驱动）：\n$$\nA_3 = \\begin{bmatrix} 1.1  0.3 \\\\ 0.0  0.8 \\end{bmatrix},\\quad\nB_3 = \\begin{bmatrix} 1.0  0.0 \\\\ 0.0  1.0 \\end{bmatrix},\\quad\nQ_3 = \\begin{bmatrix} 2.0  0.5 \\\\ 0.5  1.0 \\end{bmatrix},\\quad\nR_3 = \\begin{bmatrix} 0.5  0.1 \\\\ 0.1  0.3 \\end{bmatrix},\\quad\nN_3 = \\begin{bmatrix} 0.1  -0.05 \\\\ 0.0  0.02 \\end{bmatrix},\\quad\nx_{0,3} = \\begin{bmatrix} 2.0 \\\\ -2.0 \\end{bmatrix}.\n$$\n\n用例 $4$（单输入，控制惩罚 $R$ 较小，两个不稳定模态但可镇定）：\n$$\nA_4 = \\begin{bmatrix} 1.05  0.5 \\\\ 0.0  1.02 \\end{bmatrix},\\quad\nB_4 = \\begin{bmatrix} 0.0 \\\\ 1.0 \\end{bmatrix},\\quad\nQ_4 = \\begin{bmatrix} 1.0  0.0 \\\\ 0.0  1.0 \\end{bmatrix},\\quad\nR_4 = \\begin{bmatrix} 0.01 \\end{bmatrix},\\quad\nN_4 = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix},\\quad\nx_{0,4} = \\begin{bmatrix} 1.0 \\\\ 1.0 \\end{bmatrix}.\n$$\n\n最终输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例贡献一个包含三个元素 $[b_1, b_2, r]$ 的子列表，其中 $b_1$ 和 $b_2$ 为布尔值，$r$ 为四舍五入后的浮点数。例如，输出应如下所示：\n$[\\,[\\text{True},\\text{True},0.000001],[\\text{True},\\text{True},0.123456],\\dots\\,]$。\n不应打印任何额外文本。", "solution": "所提出的问题是优化控制理论中的一个标准练习，具体涉及离散时间线性二次调节器（LQR）。对问题陈述的评估证实了其有效性。它具有科学依据，是适定的、客观的，并包含了唯一解所需的所有必要信息。对于所有给定的测试用例，离散时间代数里卡蒂方程（DARE）的唯一镇定解的存在条件（即可镇定性和可检测性）都得到了满足。因此，我将基于既定原则进行严谨的求解。\n\n系统的动力学由离散时间线性时不变（LTI）状态方程描述：\n$$\nx_{k+1} = A x_k + B u_k\n$$\n其中 $x_k \\in \\mathbb{R}^n$ 是状态向量，$u_k \\in \\mathbb{R}^m$ 是时间步 $k$ 的控制输入向量。目标是找到一个状态反馈控制律 $u_k = -K x_k$，以最小化无穷时域二次代价函数：\n$$\nJ = \\sum_{k=0}^{\\infty} \\left( x_k^{\\top} Q x_k + 2 x_k^{\\top} N u_k + u_k^{\\top} R u_k \\right)\n$$\n此处，$Q \\succeq 0$ 和 $R \\succ 0$ 分别是状态和控制输入的权重矩阵，而 $N$ 是交叉权重矩阵。项 $2x_k^\\top N u_k$ 使标准的LQR提法复杂化。可以通过变量替换来处理此问题。求和内的项可以写成二次型：\n$$\n\\begin{bmatrix} x_k \\\\ u_k \\end{bmatrix}^{\\top}\n\\begin{bmatrix} Q  N \\\\ N^{\\top}  R \\end{bmatrix}\n\\begin{bmatrix} x_k \\\\ u_k \\end{bmatrix}\n$$\n为使任何轨迹的代价都有下界，该分块矩阵必须是半正定的。所有提供的测试用例都满足此条件。\n\n此LQR问题的解可通过动态规划找到。从状态 $x$ 出发的最优未来成本（或价值函数）由 $V(x) = x^{\\top} P x$ 给出，其中 $P$ 是离散时间代数里卡蒂方程（DARE）的唯一对称半正定解：\n$$\nP = A^{\\top} P A - (A^{\\top} P B + N)(R + B^{\\top} P B)^{-1}(B^{\\top} P A + N^{\\top}) + Q\n$$\n如果系统对 $(A, B)$ 是可镇定的，并且与代价函数相关的系统对 $(Q_{eff}, A_{eff})$ 是可检测的（其中 $A_{eff}$ 和 $Q_{eff}$ 是在通过变量替换消除交叉项 $N$ 后的等效系统矩阵），则保证存在这样一个镇定解 $P$。在给定的用例中，由于满足了更直接的条件，即 $(A,B)$ 的可镇定性以及与代价函数相对应的可检测性，因此存在唯一的镇定解，并且可以进行数值计算。\n\n一旦找到Riccati解 $P$，最优状态反馈增益矩阵 $K$ 由下式给出：\n$$\nK = (R + B^{\\top} P B)^{-1}(B^{\\top} P A + N^{\\top})\n$$\n控制律则为 $u_k = -K x_k$。这导致闭环系统：\n$$\nx_{k+1} = (A - B K) x_k = A_{\\text{cl}} x_k\n$$\n该闭环系统的稳定性由矩阵 $A_{\\text{cl}}$ 的特征值确定。当且仅当 $A_{\\text{cl}}$ 的谱半径（记为 $\\rho(A_{\\text{cl}})$）严格小于 $1$ 时，系统是渐近稳定的。谱半径是 $A_{\\text{cl}}$ 的特征值的最大模。\n\n此外，二次型 $V_k = x_k^{\\top} P x_k$ 可作为闭环系统的离散时间李雅普诺夫函数。该函数沿系统轨迹的变化由最优性下的贝尔曼方程给出：\n$$\n\\Delta V_k = V_{k+1} - V_k = - (x_k^{\\top} Q x_k + 2 x_k^{\\top} N u_k + u_k^{\\top} R u_k)\n$$\n代入 $u_k = -Kx_k$：\n$$\n\\Delta V_k = -x_k^{\\top} (Q - N K - K^{\\top} N^{\\top} + K^{\\top} R K) x_k\n$$\n矩阵 $Q - N K - K^{\\top} N^{\\top} + K^{\\top} R K$ 是最优策略下的有效阶段成本，并且保证是半正定的。因此，$\\Delta V_k \\le 0$，这意味着序列 $V_k$ 是单调不增的。这一性质证实了闭环系统的稳定性，因为状态被驱动到原点，在原点处 $V(x)=0$。\n\n以下过程为每个测试用例实施这些原则来解决问题：\n1. 为每个用例定义系统矩阵 $(A, B)$ 和代价矩阵 $(Q, R, N)$。\n2. 使用标准数值库函数（该函数可处理交叉项 $N$）数值求解DARE，得到对称半正定矩阵 $P$。\n3. 使用 $P$ 的定义计算最优反馈增益 $K$。\n4. 构建闭环矩阵 $A_{\\text{cl}} = A - B K$。\n5. 计算 $A_{\\text{cl}}$ 的特征值并确定其谱半径 $\\rho(A_{\\text{cl}})$。第一个要求的输出是 $\\rho(A_{\\text{cl}})  1$ 的布尔结果。\n6. 从给定的初始状态 $x_0$ 开始，模拟闭环系统 $T=200$ 步，以生成状态轨迹 $x_0, x_1, \\dots, x_T$。\n7. 计算 $k=0, \\dots, T$ 的李雅普诺夫序列 $V_k = x_k^{\\top} P x_k$。\n8. 验证对于所有 $k = 0, \\dots, T-1$，在给定容差 $\\varepsilon=10^{-10}$ 下，$V_{k+1} \\le V_k + \\varepsilon$ 是否成立。第二个要求的输出是此检查的布尔结果。\n9. 计算欧几里得范数 $\\lVert x_T \\rVert_2$ 和 $\\lVert x_0 \\rVert_2$。第三个要求的输出是比值 $\\lVert x_T \\rVert_2 / \\lVert x_0 \\rVert_2$，四舍五入到六位小数。\n10. 整理并按指定格式输出结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_discrete_are\n\ndef solve():\n    \"\"\"\n    Solves the LQR problem for the given test cases and performs the required analysis.\n    \"\"\"\n    \n    # Simulation parameters\n    T = 200\n    epsilon = 1e-10\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"A\": np.array([[1.2, 0.1], [0.0, 0.95]]),\n            \"B\": np.array([[1.0], [0.5]]),\n            \"Q\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"R\": np.array([[1.0]]),\n            \"N\": np.array([[0.0], [0.0]]),\n            \"x0\": np.array([[3.0], [-1.0]]),\n        },\n        {\n            \"A\": np.array([[1.0, 0.2], [0.0, 0.9]]),\n            \"B\": np.array([[1.0], [0.1]]),\n            \"Q\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"R\": np.array([[0.1]]),\n            \"N\": np.array([[0.0], [0.0]]),\n            \"x0\": np.array([[1.0], [2.0]]),\n        },\n        {\n            \"A\": np.array([[1.1, 0.3], [0.0, 0.8]]),\n            \"B\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"Q\": np.array([[2.0, 0.5], [0.5, 1.0]]),\n            \"R\": np.array([[0.5, 0.1], [0.1, 0.3]]),\n            \"N\": np.array([[0.1, -0.05], [0.0, 0.02]]),\n            \"x0\": np.array([[2.0], [-2.0]]),\n        },\n        {\n            \"A\": np.array([[1.05, 0.5], [0.0, 1.02]]),\n            \"B\": np.array([[0.0], [1.0]]),\n            \"Q\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"R\": np.array([[0.01]]),\n            \"N\": np.array([[0.0], [0.0]]),\n            \"x0\": np.array([[1.0], [1.0]]),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        A, B, Q, R, N, x0 = case[\"A\"], case[\"B\"], case[\"Q\"], case[\"R\"], case[\"N\"], case[\"x0\"]\n\n        # 1. Solve the Discrete-time Algebraic Riccati Equation (DARE)\n        # SciPy's s parameter corresponds to the cross-term N\n        P = solve_discrete_are(A, B, Q, R, s=N)\n\n        # 2. Compute the optimal feedback gain K\n        K_inv_term = R + B.T @ P @ B\n        K_mult_term = B.T @ P @ A + N.T\n        K = np.linalg.inv(K_inv_term) @ K_mult_term\n\n        # 3. Form the closed-loop matrix A_cl and check its stability\n        A_cl = A - B @ K\n        eigenvalues = np.linalg.eigvals(A_cl)\n        spectral_radius = np.max(np.abs(eigenvalues))\n        is_stable = bool(spectral_radius  1.0)\n\n        # 4. Simulate the closed-loop trajectory and compute Lyapunov sequence\n        x_k = x0\n        V_seq = [x_k.T @ P @ x_k]\n        \n        x_traj = [x0]\n        for _ in range(T):\n            x_k = A_cl @ x_k\n            x_traj.append(x_k)\n            V_seq.append(x_k.T @ P @ x_k)\n        \n        # 5. Check if the Lyapunov sequence is monotonically nonincreasing\n        is_monotonic = True\n        # V_seq are 1x1 matrices, so use .item()\n        for k in range(T):\n            if V_seq[k+1].item() > V_seq[k].item() + epsilon:\n                is_monotonic = False\n                break\n        \n        # 6. Compute the ratio of final to initial state norms\n        norm_x0 = np.linalg.norm(x0)\n        norm_xT = np.linalg.norm(x_traj[T])\n        \n        if norm_x0 == 0:\n            ratio = 0.0\n        else:\n            ratio = norm_xT / norm_x0\n            \n        ratio_rounded = round(ratio, 6)\n\n        results.append([is_stable, is_monotonic, ratio_rounded])\n\n    # Final print statement in the exact required format.\n    # The default str() representation of a list includes spaces, which is acceptable.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2701019"}]}