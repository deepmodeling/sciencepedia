## 引言
[模型预测控制](@article_id:334376)（MPC）是一种功能强大的先进控制方法，它通过在每个时间步在线求解一个有限时域优化问题，来系统性地处理[多变量系统](@article_id:323195)的输入和[状态约束](@article_id:335313)。这种“向前看”并进行优化的能力，使其在机器人、自动驾驶、[过程控制](@article_id:334881)等领域取得了巨大成功。然而，这种策略的背后潜藏着一个深刻的理论问题：一个只考虑有限未来的控制器，如何能保证整个系统在长期运行中既不会违反约束（可行性），又能最终收敛到[期望](@article_id:311378)的目标（稳定性）？

本文将深入探讨为解决此问题而发展的核心理论，即[MPC的稳定性](@article_id:351686)和可行性保证。我们将揭示，MPC并非短视的，而是通过精巧的数学构造，将有限时域的决策与无限时域的性能联系起来。文章的第一部分将剖析保证递推可行性和渐进稳定性的两大基石：**终端[不变集](@article_id:338919)**和**终端代价李雅普诺夫函数**。读者将理解它们如何共同作用，为MPC提供“永不出错”和“持续向好”的双重承诺。接着，文章的第二部分将展示这些理论如何扩展到更复杂的现实场景，包括如何处理[模型不确定性](@article_id:329244)、[通信延迟](@article_id:324512)、经济目标优化，以及如何将MPC应用于大规模[分布式系统](@article_id:331910)中。通过这次学习，您将建立对MPC稳定运行内在机理的深刻认识。

让我们从最核心的原理出发，探索MPC是如何在一个充满约束的世界里，既能灵活决策，又能保证长治久安。

## 原理与机制

在上一章中，我们领略了[模型预测控制](@article_id:334376)（MPC）如何像一位深谋远虑的棋手，通过预演未来，在充满束缚的现实世界中走出精妙的舞步。但你或许会好奇：这位棋手是如何确保自己不会“算尽一步，满盘皆输”的呢？它只向前看有限的 $N$ 步，又如何能保证长远的成功，而不是被眼前的“最优”决策引入死胡同？

这一章，我们将深入MPC的心脏，揭示其稳定运行的两大基石：**递推可行性 (Recursive Feasibility)** 和 **渐进稳定性 (Asymptotic Stability)**。我们将看到，MPC的设计者们如何通过一系列精妙绝伦的构思，将一个有限视界的问题，转化为一个具有无限生命力的解决方案，这其中蕴含的数学之美，足以令人拍案叫绝。

### 永不“死机”的承诺：递推可行性

想象一下，你正在驾驶一辆能够自动规划路线的未来汽车。在每个路口，它都会规划出接下来一公里（对应于视界 $N$）的最佳路径。这个规划过程，就是MPC中的优化问题求解 [@problem_id:2746588]。现在，一个至关重要的问题摆在面前：当汽车按照这个“最佳”路径行驶了100米后，到达一个新的位置，它是否还能为接下来的**又一个**一公里找到一条可行的路径？如果不能，汽车就会“死机”，停在路中间不知所措。

这个“在下一步总能找到解”的保证，就是 **递推可行性** [@problem_id:2746593]。它承诺，只要控制器在当前时刻能够找到一个满足所有约束（如道路边界、禁止驶入区域）的计划，那么在执行了该计划的第一步之后，它必然能在新的状态下再次找到一个可行的计划。周而复始，永不中断。

这听起来像是一个不可能的承诺。一个有限步的规划，如何能给予无限未来的保证？

### 终点即是港湾：[终端集](@article_id:343296)与[不变性](@article_id:300612)

答案就藏在一个绝妙的设计中：为每一次规划的终点，指定一个“安全区”，我们称之为 **[终端集](@article_id:343296) (Terminal Set)** $\mathcal{X}_f$。MPC的优化问题被施加了一个额外的约束：在 $N$ 步预测的最后一步，系统的状态 $x_N$ 必须位于这个 $\mathcal{X}_f$ 之内。

那么，什么样的区域才能称得上是“安全”的呢？它必须具备一种叫做 **[不变性](@article_id:300612) (Invariance)** 的特质 [@problem_id:2746570]。

想象一条湍急的河流，河中有一些平静的漩涡。一旦你的小船进入了某个漩涡，你总有办法通过巧妙地划桨，让小船继续留在这个漩涡里，而不会被[急流](@article_id:370613)冲走。这个漩涡，就是一个 **控制[不变集](@article_id:338919) (Control Invariant Set)**。数学上讲，对于一个集合 $\mathcal{S}$，如果对于其中任意一点 $x$，你总能找到一个允许的控制 $u$，使得系统的下一步状态 $x^+ = Ax + Bu$ 仍然位于 $\mathcal{S}$ 内，那么 $\mathcal{S}$ 就是一个控制[不变集](@article_id:338919)。

MPC的[终端集](@article_id:343296) $\mathcal{X}_f$ 正是这样一个“漩涡”。当MPC制定一个 $N$ 步计划时，它被迫将预测的终点 $x_N$ 导航至这个安全的港湾。现在，让我们看看递推可行性的魔法是如何发生的 [@problem_id:2746593]：

1.  在 $k$ 时刻，MPC找到了一个最优的 $N$ 步计划： $\{u_0^\star, u_1^\star, \dots, u_{N-1}^\star\}$。
2.  控制器执行第一步 $u_0^\star$，系统状态变为 $x_1^\star$。
3.  在 $k+1$ 时刻，控制器需要为新状态 $x_1^\star$ 制定一个新的 $N$ 步计划。它如何保证一定能找到呢？
4.  它利用了前一个计划的“遗产”：将旧计划的“尾巴” $\{u_1^\star, \dots, u_{N-1}^\star\}$ 作为新计划的前 $N-1$ 步。这 $N-1$ 步的轨迹和控制自然是可行的，因为它们是刚被验证过的最优计划的一部分。
5.  现在只剩下最后一步。经过这 $N-1$ 步后，预测状态恰好是旧计划的终点 $x_N^\star$。由于 $x_N^\star$ 位于“安全港湾” $\mathcal{X}_f$ 内，根据不变性的定义，我们保证能找到一个控制 $u_{new}$，使得系统的再下一步仍然位于 $\mathcal{X}_f$ 内。
6.  于是，一个新的、完全可行的 $N$ 步计划 $\{u_1^\star, \dots, u_{N-1}^\star, u_{new}\}$ 就被构造出来了！

既然存在一个可行的计划，那么优化器至少可以从这个计划出发去寻找一个更优的解。可行性因此得到了保证。这个巧妙的“移位-追加 (shift-and-append)”策略，将有限的视界与无限的运行时间完美地连接起来。

### 建造安全的港湾

这个“安全港湾” $\mathcal{X}_f$ 听起来很棒，但它不是凭空出现的。在工程实践中，我们需要亲手设计和建造它。这本身就是一个充满智慧的优化过程 [@problem_id:2746612]。

通常，我们会选择一个简单的几何形状，比如一个椭球 $x^\top P x \le \alpha$，作为[终端集](@article_id:343296)。同时，我们也会在“港湾”内部指定一套简单的驾驶规则——一个线性的终端[反馈控制](@article_id:335749)器 $u=Kx$。建造这个港湾，意味着我们要找到一个尽可能大的椭球（即最大化 $\alpha$），同时满足一系列现实世界的约束：

1.  **[状态约束](@article_id:335313)**：整个[椭球](@article_id:345137) $\mathcal{X}_f$ 必须位于系统允许的活动范围 $\mathcal{X}$ 之内（例如，机器臂不能穿墙）。
2.  **输入约束**：在[椭球](@article_id:345137)内的任何位置 $x$，根据“港湾驾驶规则” $u=Kx$ 计算出的控制量，都不能超过执行器的物理极限 $\mathcal{U}$（例如，电机扭矩不能无限大）。
3.  **不变性约束**：在椭球内的任何位置 $x$，执行 $u=Kx$ 后，下一步的状态 $x^+ = (A+BK)x$ 必须仍然落在这个[椭球](@article_id:345137)内。

将这些几何约束转化为代数语言，是一个非常优雅的过程。例如，要保证一个[线性约束](@article_id:641259) $|c^\top x| \le c_{max}$ 在整个[椭球](@article_id:345137)上都成立，我们只需要计算 $c^\top x$ 在这个椭球上的最大值，并确保它不超过 $c_{max}$。这个最大值有一个漂亮的解析解：
$$ \max_{x^\top P x \le \alpha} |c^\top x| = \sqrt{\alpha} \sqrt{c^\top P^{-1} c} $$
通过求解一系列这样由约束转化而来的不等式，我们就能计算出能建造的最大“安全港湾”的尺寸 $\alpha$。这充分体现了理论指导实践的工程之美。

### 不只求存，更求精进：稳定性与[Lyapunov函数](@article_id:337681)

到目前为止，我们只确保了MPC控制器不会“死机”。但这还不够。一个好的控制器不仅要能一直运行下去，更要能完成它的任务，比如将一个倒立摆稳定在垂直位置，或者让化工厂的温度精确地保持在[设定值](@article_id:314834)。这就是 **稳定性 (Stability)** 问题。

稳定性的核心思想是“取得进展”。我们需要一个“进度条”，来衡量系统距离它的最终目标还有多远。在控制理论中，这个“进度条”就是大名鼎鼎的 **Lyapunov函数**。一个Lyapunov函数 $V(x)$ 是一个标量函数，它在目标状态（比如原点）处取值为零，在其他任何地方都为正。而要[证明系统](@article_id:316679)是稳定的，我们只需证明，随着系统的演化，这个函数值 $V(x)$ 会持续不断地减小，最终收敛到零。

### 神圣的契约：终端成本与Lyapunov递减

MPC如何保证这个“进度条”一定下降呢？它依赖于第二个、也是更深层次的精妙设计：将终端成本 $V_f$ 设定为一个特殊的Lyapunov函数，我们称之为 **控制[Lyapunov函数](@article_id:337681) (Control Lyapunov Function, CLF)** [@problem_id:2746605]。

这个 $V_f$ 不仅仅是一个惩罚项，它还附带了一份“神圣的契约”。这份契约规定：在“安全港湾” $\mathcal{X}_f$ 内部，只要你遵循那套简单的“港湾驾驶规则” $u = \kappa_f(x)$，那么 $V_f$ 这个“局部进度条”的下降量，将至少等于你为这一步付出的代价 $\ell(x, \kappa_f(x))$。用数学语言表达，就是这个关键的不等式：
$$ V_f(f(x, \kappa_f(x))) - V_f(x) \le -\ell(x, \kappa_f(x)) \quad \forall x \in \mathcal{X}_f $$
这份契约保证了在安全区内的每一步操作都是“物有所值”的，每付出一分成本，都至少能换来一分的“进展”。

### 从局部到全局的魔法：价值函数本身就是Lyapunov函数

最令人拍案叫绝的部分来了。MPC如何将这份在“安全港湾”这个小局部区域签订的契约，推广成整个系统在任何时刻都必须遵守的“宇宙法则”呢？

答案是：MPC在每个时刻计算出的那个最优总成本，即 **价值函数 (Value Function)** $V_N(x)$，它本身就变成了整个[闭环系统](@article_id:334469)的全局[Lyapunov函数](@article_id:337681)！[@problem_id:2746594]

这个证明的逻辑如同一首优雅的诗篇：
1.  在 $k$ 时刻，系统状态为 $x_k$，MPC算出的最优成本是 $V_N(x_k)$。
2.  在 $k+1$ 时刻，系统到达新状态 $x_{k+1}$。我们知道，此时存在一个可行的“移位-追加”计划。这个计划的成本是多少呢？它约等于 $V_N(x_k)$ 减去刚刚花费掉的第一步成本 $\ell(x_k, u_k)$，再加上终端发生的一点变化。
3.  而终端的这点变化，恰好被我们那份“神圣的契约”所约束！契约保证了终端的“成本-进展”核算是“盈利”的。
4.  综合起来，我们发现这个构造出来的可行计划的总成本，要小于 $V_N(x_k) - \ell(x_k, u_k)$。
5.  在 $k+1$ 时刻，真正的最优成本 $V_N(x_{k+1})$ 只会比任何一个可行计划的成本更低。

于是，我们得到了MPC[稳定性理论](@article_id:310376)中最核心、最美妙的不等式：
$$ V_N(x_{k+1}) - V_N(x_k) \le -\ell(x_k, u_k) $$
这个不等式告诉我们：全局的“进度条” $V_N(x)$ 在每一步的减少量，至少等于这一步付出的即时成本 $\ell(x_k, u_k)$。只要系统还没有到达目标（此时 $\ell > 0$），进度条就必然会下降。这意味着，MPC控制器在它的每一步生命中，不仅活着（可行性），而且还在朝着目标坚定地前进（稳定性）。

这就是MPC稳定运行的核心奥秘，一个由 **不变[终端集](@article_id:343296)** 保证“不死”，由 **CLF终端成本** 保证“向前”的双重保险机制 [@problem_id:2746599]。

### 设计的“黄金标准”与视界的真正作用

在实际设计中，[终端集](@article_id:343296)和终端成本的选择大有学问。存在一个“黄金标准”的选择——将终端成本 $V_f$ 选为与系统和[成本函数](@article_id:299129)相关的 **[Riccati方程](@article_id:323654)** 的解 [@problem_id:2746567]。这样的选择相当于获得了一份在整个[状态空间](@article_id:323449)都成立的“神圣契约”，从而允许我们构建出理论上最大的“安全港湾”，赋予MPC最大的运行疆域。

最后，让我们重新审视视界 $N$ 的作用。我们可以把所有理论上能被控制到目标点的状态集合看作一个巨大的“可控域” $\mathcal{X}_\infty$。而MPC在视界为 $N$ 时真正能够稳定控制的区域 $\mathcal{X}_N$，其实是这个终极可控域的一个内部近似 [@problem_id:2746607]。$N$ 越大，这个近似就越精确，MPC的能力就越强。$N$ 就如同我们探索未知世界的望远镜的倍率，倍率越高，我们能看到的、能到达的地方就越远。

通过这一系列的精巧构造，MPC这位有限视界的棋手，最终获得了驾驭无限时间长河的智慧与力量。