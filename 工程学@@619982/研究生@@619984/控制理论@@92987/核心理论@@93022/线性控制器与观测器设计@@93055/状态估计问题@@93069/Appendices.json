{"hands_on_practices": [{"introduction": "在设计状态观测器时，我们面临两种主要的设计哲学：一种是确定性的，旨在强制观测器误差动态具有特定的期望行为（如快速收敛）；另一种是随机性的，旨在在存在噪声的情况下最小化估计误差。本练习将引导您探索这两种方法[@problem_id:2748160]。您将首先通过极点配置技术，为给定的系统确定性地设计一个观测器增益 $L$，以实现特定的误差动态。然后，您将通过求解相关的Riccati方程，计算出随机最优的卡尔曼增益$L_{\\mathrm{KF}}$，并深入对比这两种设计思路的根本差异和适用场景。", "problem": "考虑一个连续时间线性时不变系统，其状态空间矩阵为 $A \\in \\mathbb{R}^{n \\times n}$ 和 $C \\in \\mathbb{R}^{m \\times n}$。在静态输出注入增益 $L \\in \\mathbb{R}^{n \\times m}$ 下，状态观测器误差动态由矩阵 $A - L C$ 控制。\n\n第 1 部分。仅从可观测性和可控性的定义以及波波夫-贝列维奇-霍特斯(Popov–Belevitch–Hautus)检验出发，推导为什么对于任何可观测对 $(A,C)$ 和任何根严格位于开放左半平面的首一多项式 $p(\\lambda) = \\lambda^{n} + \\alpha_{n-1} \\lambda^{n-1} + \\cdots + \\alpha_{1} \\lambda + \\alpha_{0}$，都存在一个输出注入矩阵 $L$，使得 $A - L C$ 的特征多项式等于 $p(\\lambda)$。您的推导必须从第一性原理和基本定义出发，不得引用现成的公式。\n\n第 2 部分。具体到二阶系统，其矩阵为\n$$\nA = \\begin{pmatrix} 0  1 \\\\ 0  0 \\end{pmatrix}, \\quad C = \\begin{pmatrix} 1  0 \\end{pmatrix}.\n$$\n选择 $A - L C$ 的期望特征值为 $\\lambda_{1} = -2$ 和 $\\lambda_{2} = -5$。通过直接计算 $A - L C$ 的特征多项式并进行系数匹配，显式地确定实现这些特征值的 $L = \\begin{pmatrix} \\ell_{1} \\\\ \\ell_{2} \\end{pmatrix}$ 的各项元素。\n\n第 3 部分。对于第 2 部分中的同一系统，考虑随机状态空间模型\n$$\n\\dot{x}(t) = A x(t) + w(t), \\quad y(t) = C x(t) + v(t),\n$$\n其中 $w(t)$ 是零均值白高斯过程噪声，$v(t)$ 是测量噪声，两者相互独立，其协方差为 $\\mathbb{E}[w(t) w(\\tau)^{\\top}] = Q \\delta(t - \\tau)$ 和 $\\mathbb{E}[v(t) v(\\tau)] = R \\delta(t - \\tau)$，其中\n$$\nQ = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}, \\quad R = 1.\n$$\n求解误差协方差 $P \\in \\mathbb{R}^{2 \\times 2}$ 的连续时间代数黎卡提(Riccati)方程，并计算稳态卡尔曼滤波器增益 $L_{\\mathrm{KF}} \\in \\mathbb{R}^{2 \\times 1}$，公式为 $L_{\\mathrm{KF}} = P C^{\\top} R^{-1}$。然后，用文字对比第 2 部分中的特征值配置增益与此处推导的稳态卡尔曼增益在概念基础上的差异。\n\n答案规范：将您的最终答案以行矩阵的形式报告，其中包含四个元素 $\\ell_{1}$、$\\ell_{2}$、$k_{1}$、$k_{2}$，其中 $L = \\begin{pmatrix} \\ell_{1} \\\\ \\ell_{2} \\end{pmatrix}$ 是第 2 部分的特征值配置增益，$L_{\\mathrm{KF}} = \\begin{pmatrix} k_{1} \\\\ k_{2} \\end{pmatrix}$ 是第 3 部分的卡尔曼增益。请提供精确值，不要四舍五入。", "solution": "该问题经过验证，被认为是适定的、科学上合理的且内部一致的。这是线性系统理论和最优估计中的一个标准问题。我们将开始解答。\n\n第 1 部分：观测器极点配置的推导\n目标是证明对于一个可观测对 $(A,C)$（其中 $A \\in \\mathbb{R}^{n \\times n}$ 且 $C \\in \\mathbb{R}^{m \\times n}$），总可以找到一个输出注入增益 $L \\in \\mathbb{R}^{n \\times m}$，使得观测器误差动态矩阵 $A-LC$ 的特征多项式与任何指定的 $n$ 次首一多项式 $p(\\lambda)$ 相匹配。此性质被称为观测器的极点配置或极点分配。推导将依赖于控制理论中的对偶性原理。\n\n观测器的极点是矩阵 $A-LC$ 的特征值。$A-LC$ 的特征多项式由 $\\det(\\lambda I - (A-LC))$ 给出。行列式的一个基本性质是，对于任何方阵 $M$，都有 $\\det(M) = \\det(M^{\\top})$。因此，$A-LC$ 的特征值与其转置 $(A-LC)^{\\top} = A^{\\top} - C^{\\top}L^{\\top}$ 的特征值相同。\n\n让我们定义一个“对偶”系统。对于由矩阵 $(A, C)$ 控制的原系统，我们定义一个对偶系统，其状态矩阵为 $A' = A^{\\top}$，输入矩阵为 $B' = C^{\\top}$。我们还为此对偶系统定义一个状态反馈增益 $K' = L^{\\top}$。该对偶系统在状态反馈下的闭环矩阵为 $A' - B'K' = A^{\\top} - C^{\\top}L^{\\top}$。\n\n从这个构造中可以明显看出，寻找一个观测器增益 $L$ 以将 $A-LC$ 的特征值配置在期望位置的问题，在数学上等价于寻找一个状态反馈增益 $K' = L^{\\top}$ 以将 $A^{\\top} - C^{\\top}L^{\\top}$ 的特征值配置在相同位置的问题。后者是针对系统 $(A', B') = (A^{\\top}, C^{\\top})$ 的标准状态反馈极点配置问题。\n\n控制理论的一条基石定理论述，通过状态反馈进行任意极点配置的充要条件是系统是可控的。因此，如果我们能证明对偶系统 $(A^{\\top}, C^{\\top})$ 是可控的，那么我们总能找到一个增益 $K'$（从而也找到了 $L$）来实现任何期望的特征多项式。原系统的可观测性与对偶系统的可控性之间的联系是通过波波夫-贝列维奇-霍特斯(Popov–Belevitch–Hautus, PBH)检验建立的。\n\n可观测性的PBH检验表明，对 $(A, C)$ 是可观测的，当且仅当对于所有复数 $\\lambda \\in \\mathbb{C}$，矩阵\n$$\n\\begin{pmatrix} A - \\lambda I \\\\ C \\end{pmatrix}\n$$\n具有满列秩 $n$。\n\n问题陈述中假定对 $(A,C)$ 是可观测的。因此，对于任何 $\\lambda \\in \\mathbb{C}$，\n$$\n\\mathrm{rank} \\begin{pmatrix} A - \\lambda I \\\\ C \\end{pmatrix} = n.\n$$\n由于一个矩阵的秩等于其转置的秩，我们有\n$$\n\\mathrm{rank} \\left( \\begin{pmatrix} A - \\lambda I \\\\ C \\end{pmatrix}^{\\top} \\right) = \\mathrm{rank} \\begin{pmatrix} (A - \\lambda I)^{\\top}  C^{\\top} \\end{pmatrix} = \\mathrm{rank} \\begin{pmatrix} A^{\\top} - \\lambda I  C^{\\top} \\end{pmatrix} = n.\n$$\n这最后一个条件，$\\mathrm{rank} \\begin{pmatrix} A^{\\top} - \\lambda I  C^{\\top} \\end{pmatrix} = n$ 对于所有 $\\lambda \\in \\mathbb{C}$ 成立，正是不折不扣的对 $(A^{\\top}, C^{\\top})$ 可控性的PBH检验。\n\n因此，如果对 $(A,C)$ 是可观测的，则对 $(A^{\\top}, C^{\\top})$ 是可控的。根据状态反馈极点配置定理，对于一个可控系统，可以找到一个增益矩阵 $K'$，将闭环系统 $A^{\\top}-C^{\\top}K'$ 的特征值分配到任何期望的位置集合。这些位置是指定的首一多项式 $p(\\lambda)$ 的根。通过设置 $K'=L^{\\top}$，我们找到了将观测器动态矩阵 $A-LC$ 的极点配置在这些相同位置的观测器增益 $L$。要求 $p(\\lambda)$ 的根位于开放左半平面确保了观测器的稳定性，这是实际的目标。推导至此完成。\n\n第 2 部分：特征值配置增益的计算\n给定系统矩阵为\n$$\nA = \\begin{pmatrix} 0  1 \\\\ 0  0 \\end{pmatrix}, \\quad C = \\begin{pmatrix} 1  0 \\end{pmatrix}.\n$$\n输出注入增益为 $L = \\begin{pmatrix} \\ell_{1} \\\\ \\ell_{2} \\end{pmatrix}$。矩阵 $A-LC$ 计算如下：\n$$\nA - LC = \\begin{pmatrix} 0  1 \\\\ 0  0 \\end{pmatrix} - \\begin{pmatrix} \\ell_{1} \\\\ \\ell_{2} \\end{pmatrix} \\begin{pmatrix} 1  0 \\end{pmatrix} = \\begin{pmatrix} 0  1 \\\\ 0  0 \\end{pmatrix} - \\begin{pmatrix} \\ell_{1}  0 \\\\ \\ell_{2}  0 \\end{pmatrix} = \\begin{pmatrix} -\\ell_{1}  1 \\\\ -\\ell_{2}  0 \\end{pmatrix}.\n$$\n$A-LC$ 的特征多项式为\n$$\n\\det(\\lambda I - (A-LC)) = \\det \\begin{pmatrix} \\lambda + \\ell_{1}  -1 \\\\ \\ell_{2}  \\lambda \\end{pmatrix} = \\lambda(\\lambda + \\ell_{1}) - (-1)(\\ell_{2}) = \\lambda^{2} + \\ell_{1}\\lambda + \\ell_{2}.\n$$\n期望的特征值为 $\\lambda_{1} = -2$ 和 $\\lambda_{2} = -5$。期望的特征多项式为\n$$\np(\\lambda) = (\\lambda - \\lambda_{1})(\\lambda - \\lambda_{2}) = (\\lambda + 2)(\\lambda + 5) = \\lambda^{2} + 7\\lambda + 10.\n$$\n通过匹配计算出的和期望的特征多项式的系数，我们得到：\n$$\n\\ell_{1} = 7, \\quad \\ell_{2} = 10.\n$$\n因此，所需的增益矩阵为 $L = \\begin{pmatrix} 7 \\\\ 10 \\end{pmatrix}$。\n\n第 3 部分：稳态卡尔曼增益的计算与概念对比\n给定过程噪声和测量噪声的协方差强度为 $Q=I$ 和 $R=1$。稳态卡尔曼滤波器增益 $L_{\\mathrm{KF}}$ 由 $L_{\\mathrm{KF}} = PC^{\\top}R^{-1}$ 给出，其中 $P$ 是连续时间代数黎卡提方程（CARE）的对称正定解：\n$$\nAP + PA^{\\top} - PC^{\\top}R^{-1}CP + Q = 0.\n$$\n设 $P = \\begin{pmatrix} p_{11}  p_{12} \\\\ p_{12}  p_{22} \\end{pmatrix}$。代入给定的矩阵 $A, C, Q, R$。计算方程的各项：\n$AP + PA^{\\top} = \\begin{pmatrix} 0  1 \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} p_{11}  p_{12} \\\\ p_{12}  p_{22} \\end{pmatrix} + \\begin{pmatrix} p_{11}  p_{12} \\\\ p_{12}  p_{22} \\end{pmatrix} \\begin{pmatrix} 0  0 \\\\ 1  0 \\end{pmatrix} = \\begin{pmatrix} p_{12}  p_{22} \\\\ 0  0 \\end{pmatrix} + \\begin{pmatrix} p_{12}  0 \\\\ p_{22}  0 \\end{pmatrix} = \\begin{pmatrix} 2p_{12}  p_{22} \\\\ p_{22}  0 \\end{pmatrix}$.\n$PC^{\\top}R^{-1}CP = \\begin{pmatrix} p_{11} \\\\ p_{12} \\end{pmatrix} (1) \\begin{pmatrix} p_{11}  p_{12} \\end{pmatrix} = \\begin{pmatrix} p_{11}^{2}  p_{11}p_{12} \\\\ p_{11}p_{12}  p_{12}^{2} \\end{pmatrix}$.\n将这些项代入CARE，得到：\n$$\n\\begin{pmatrix} 2p_{12}  p_{22} \\\\ p_{22}  0 \\end{pmatrix} - \\begin{pmatrix} p_{11}^{2}  p_{11}p_{12} \\\\ p_{11}p_{12}  p_{12}^{2} \\end{pmatrix} + \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ 0  0 \\end{pmatrix}.\n$$\n这个矩阵方程产生了一个关于 $P$ 的元素代数方程组：\n1. $2p_{12} - p_{11}^{2} + 1 = 0$\n2. $p_{22} - p_{11}p_{12} = 0$\n3. $-p_{12}^{2} + 1 = 0$\n\n从方程($3$)中，我们得到 $p_{12}^{2} = 1$，即 $p_{12} = \\pm 1$。为了保证稳定性，卡尔曼滤波器误差动态矩阵 $A - L_{\\mathrm{KF}}C = \\begin{pmatrix} -k_{1}  1 \\\\ -k_{2}  0 \\end{pmatrix}$（其中 $k_1=p_{11}, k_2=p_{12}$）的特征值必须位于开放左半平面。其特征多项式为 $\\lambda^{2} + k_{1}\\lambda + k_{2} = 0$。对于稳定的根，劳斯-赫尔维茨(Routh-Hurwitz)稳定性判据要求所有系数都为正。因此，我们必须有 $k_{1}=p_{11} > 0$ 和 $k_{2}=p_{12} > 0$。所以我们必须选择 $p_{12} = 1$。\n\n将 $p_{12}=1$ 代入方程($1$)：\n$$\n2(1) - p_{11}^{2} + 1 = 0 \\implies p_{11}^{2} = 3.\n$$\n由于我们需要 $p_{11} > 0$，我们有 $p_{11} = \\sqrt{3}$。\n\n将 $p_{11}=\\sqrt{3}$ 和 $p_{12}=1$ 代入方程($2$)：\n$$\np_{22} - (\\sqrt{3})(1) = 0 \\implies p_{22} = \\sqrt{3}.\n$$\n稳态误差协方差为 $P = \\begin{pmatrix} \\sqrt{3}  1 \\\\ 1  \\sqrt{3} \\end{pmatrix}$。我们验证该矩阵是正定的：$p_{11}=\\sqrt{3} > 0$ 且 $\\det(P) = (\\sqrt{3})(\\sqrt{3}) - 1^{2} = 3-1=2>0$。\n\n于是，稳态卡尔曼增益 $L_{\\mathrm{KF}}$ 为：\n$$\nL_{\\mathrm{KF}} = PC^{\\top}R^{-1} = \\begin{pmatrix} \\sqrt{3}  1 \\\\ 1  \\sqrt{3} \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} (1) = \\begin{pmatrix} \\sqrt{3} \\\\ 1 \\end{pmatrix}.\n$$\n设 $L_{\\mathrm{KF}} = \\begin{pmatrix} k_{1} \\\\ k_{2} \\end{pmatrix}$，我们有 $k_{1} = \\sqrt{3}$ 和 $k_{2} = 1$。\n\n概念对比：\n第 2 部分中的特征值配置增益 $L$ 是确定性地选择的，旨在为观测器误差实现一个任意的、用户指定的动态响应。极点的选择（这里是 $-2$ 和 $-5$）由设计指标（如期望的调节时间或阻尼）决定，但在其他方面是任意的。这种方法完全忽略了系统的任何随机方面，例如过程噪声或测量噪声。\n\n与此形成鲜明对比的是，第 3 部分中的稳态卡尔曼增益 $L_{\\mathrm{KF}}$ 不是任意的。它是根据系统的统计特性（即过程噪声协方差 $Q$ 和测量噪声协方差 $R$）唯一确定的最优增益，该增益最小化了状态估计误差的方差。由此产生的观测器极点不是由设计者直接指定的，而是这种优化的结果。卡尔曼滤波器通过系统地平衡对系统模型的置信度和对测量的置信度，在均方意义上提供了最佳估计。极点配置方法强制实现一种期望的行为，而卡尔曼滤波器则从系统潜在的随机现实中推导出一种最优行为。", "answer": "$$\n\\boxed{\\begin{pmatrix} 7  10  \\sqrt{3}  1 \\end{pmatrix}}\n$$", "id": "2748160"}, {"introduction": "卡尔曼滤波器的最优性严格依赖于对系统模型，特别是噪声统计特性的精确了解。然而，在现实世界中，模型参数往往是不完美的。这个练习将带您直面这一挑战，探讨当滤波器的设计模型与系统真实情况不匹配时会发生什么[@problem_id:2748176]。通过分析一个实际测量噪声方差是滤波器假设值两倍的场景，您将从第一性原理出发，定量地推导出估计误差的稳态偏差和方差，从而深刻理解模型失配对滤波器性能的实际影响。", "problem": "考虑标量、离散时间、时不变的状态空间模型\n$x_{k+1} = x_{k} + w_{k}$ 和 $y_{k} = x_{k} + v_{k}$，其中 $\\{w_{k}\\}$ 和 $\\{v_{k}\\}$ 是相互独立的零均值高斯白噪声序列，其真实方差为 $\\mathbb{E}[w_{k}^{2}] = Q$ 和 $\\mathbb{E}[v_{k}^{2}] = 2R$，对于固定的标量 $Q0$ 和 $R0$。我们实现了一个稳态卡尔曼滤波器 (KF)，其动态特性和过程噪声方差建模正确（它使用了正确的 $Q$），但测量噪声方差不匹配：它是在测量噪声方差等于 $R$ 而非真实值 $2R$ 的假设下设计的。该滤波器使用与噪声无关的无偏估计进行初始化。\n\n请仅使用线性估计的基本原理，即卡尔曼滤波器更新作为关于假设统计量的线性最小方差估计器的定义、估计误差及其传播的定义，以及独立零均值随机变量在线性变换下的期望和方差的标准性质，推导由该不匹配的稳态KF产生的估计误差 $e_{k} \\triangleq x_{k} - \\hat{x}_{k|k}$ 的稳态偏差和稳态方差。请用 $Q$ 和 $R$ 的纯闭式形式表示您的最终答案。请将这两个量以单行向量 $[\\,\\text{偏差}\\ \\ \\text{方差}\\,]$ 的形式提供。无需进行数值计算，也无需四舍五入。", "solution": "该问题要求推导一个带有不匹配卡尔曼滤波器的标量系统的估计误差的稳态偏差和方差。该滤波器是基于不正确的测量噪声方差设计的。\n\n系统由状态方程和测量方程描述：\n$$x_{k+1} = x_{k} + w_{k}$$\n$$y_{k} = x_{k} + v_{k}$$\n过程噪声 $\\{w_k\\}$ 和测量噪声 $\\{v_k\\}$ 是相互独立的零均值高斯白噪声序列，其真实方差为 $\\mathbb{E}[w_{k}^{2}] = Q$ 和 $\\mathbb{E}[v_{k}^{2}] = 2R$。\n\n卡尔曼滤波器是基于以下假设参数设计的：\n状态转移矩阵 $A=1$。\n观测矩阵 $C=1$。\n假设的过程噪声方差 $Q_{assumed} = Q$。\n假设的测量噪声方差 $R_{assumed} = R$。\n\n首先，我们确定这个不匹配滤波器使用的稳态卡尔曼增益 $K_{ss}$。该增益是根据滤波器的内部（假设）模型计算的。我们记假设的稳态后验误差方差为 $P_a$，其代数Riccati方程 (DARE) 为：\n$P_{k+1} = (A P_k A^T + Q) - A P_k C^T (C P_k C^T + R_{assumed})^{-1} C P_k A^T$.\n在稳态下，$P_a$ 满足 $P_a = (P_a+Q) - (P_a+Q)^2(P_a+Q+R)^{-1}$。\n这导出了关于 $P_a$ 的二次方程：\n$$P_{a}(P_{a}+Q+R) = R(P_{a}+Q)$$\n$$P_{a}^2 + P_{a}Q + P_{a}R = P_{a}R + QR$$\n$$P_{a}^2 + Q P_{a} - QR = 0$$\n求解 $P_a$（其必须为非负值）：\n$$P_{a} = \\frac{-Q + \\sqrt{Q^2 - 4(1)(-QR)}}{2} = \\frac{-Q + \\sqrt{Q^2 + 4QR}}{2}$$\n稳态卡尔曼增益 $K_{ss}$ 由下式给出：\n$$K_{ss} = \\frac{P_{a}+Q}{P_{a}+Q+R}$$\n我们知道 $P_a = R K_{ss}$，代入关于 $P_a$ 的方程得到 $R^2 K_{ss}^2 + QRK_{ss} - QR = 0$。由于 $R>0$，我们可以除以 $R$ 得到：\n$$R K_{ss}^2 + QK_{ss} - Q = 0$$\n\n接下来，我们分析真实估计误差 $e_k \\triangleq x_k - \\hat{x}_{k|k}$ 的传播。滤波器使用增益 $K_{ss}$ 进行操作。\n状态估计通过以下方式更新：\n$$\\hat{x}_{k|k} = \\hat{x}_{k|k-1} + K_{ss}(y_k - \\hat{x}_{k|k-1})$$\n当 $A=1$ 时，预测为 $\\hat{x}_{k|k-1} = \\hat{x}_{k-1|k-1}$。\n代入真实测量值 $y_k = x_k + v_k$：\n$$\\hat{x}_{k|k} = \\hat{x}_{k-1|k-1} + K_{ss}(x_k + v_k - \\hat{x}_{k-1|k-1})$$\n误差为 $e_k = x_k - \\hat{x}_{k|k}$：\n$$e_k = x_k - [\\hat{x}_{k-1|k-1} + K_{ss}(x_k + v_k - \\hat{x}_{k-1|k-1})]$$\n$$e_k = (1-K_{ss})(x_k - \\hat{x}_{k-1|k-1}) - K_{ss}v_k$$\n使用真实的状态动态方程 $x_k = x_{k-1} + w_{k-1}$：\n$$e_k = (1-K_{ss})(x_{k-1} + w_{k-1} - \\hat{x}_{k-1|k-1}) - K_{ss}v_k$$\n$$e_k = (1-K_{ss})(e_{k-1} + w_{k-1}) - K_{ss}v_k$$\n这就是真实估计误差的递推式。\n\n稳态偏差为 $b_{ss} = \\lim_{k\\to\\infty} \\mathbb{E}[e_k]$。对误差递推式取期望：\n$$\\mathbb{E}[e_k] = (1-K_{ss})\\mathbb{E}[e_{k-1}] + (1-K_{ss})\\mathbb{E}[w_{k-1}] - K_{ss}\\mathbb{E}[v_k]$$\n因为 $w_k$ 和 $v_k$ 是零均值的，所以 $\\mathbb{E}[w_{k-1}]=0$ 且 $\\mathbb{E}[v_k]=0$。\n$$b_k = (1-K_{ss})b_{k-1}$$\n滤波器使用无偏估计进行初始化，因此 $b_0 = \\mathbb{E}[e_0] = 0$。由此可知，对于所有 $k \\ge 0$，$b_k=0$。因此，稳态偏差为 $0$。\n\n由于偏差为零，稳态方差为 $P_{ss}^{true} = \\lim_{k\\to\\infty} \\mathbb{E}[e_k^2]$。我们将误差递推式平方并取期望：\n$$P_k^{true} = \\mathbb{E}[e_k^2] = \\mathbb{E}[((1-K_{ss})e_{k-1} + (1-K_{ss})w_{k-1} - K_{ss}v_k)^2]$$\n噪声项 $w_{k-1}$ 和 $v_k$ 相互独立，且与过去的误差 $e_{k-1}$ 无关。因此，交叉乘积项的期望为零。\n$$P_k^{true} = (1-K_{ss})^2\\mathbb{E}[e_{k-1}^2] + (1-K_{ss})^2\\mathbb{E}[w_{k-1}^2] + K_{ss}^2\\mathbb{E}[v_k^2]$$\n代入真实方差 $\\mathbb{E}[w_{k-1}^2] = Q$ 和 $\\mathbb{E}[v_k^2] = 2R$：\n$$P_k^{true} = (1-K_{ss})^2 P_{k-1}^{true} + (1-K_{ss})^2 Q + 2R K_{ss}^2$$\n在稳态下，$P_k^{true} = P_{k-1}^{true} = P_{ss}^{true}$：\n$$P_{ss}^{true} = (1-K_{ss})^2 P_{ss}^{true} + (1-K_{ss})^2 Q + 2R K_{ss}^2$$\n$$P_{ss}^{true}(1 - (1-K_{ss})^2) = (1-K_{ss})^2 Q + 2R K_{ss}^2$$\n$$P_{ss}^{true}(K_{ss}(2-K_{ss})) = (1-K_{ss})^2 Q + 2R K_{ss}^2$$\n$$P_{ss}^{true} = \\frac{(1-K_{ss})^2 Q + 2R K_{ss}^2}{K_{ss}(2-K_{ss})}$$\n这是一个有效的稳态方差表达式。为了得到一个关于 $Q$ 和 $R$ 的封闭形式，我们必须代入 $K_{ss}$ 的表达式，即 $R K_{ss}^2 + QK_{ss} - Q = 0$ 的解 $K_{ss} = \\frac{-Q+\\sqrt{Q^2+4QR}}{2R}$。\n令 $S = \\sqrt{Q^2+4QR}$，则 $K_{ss} = \\frac{-Q+S}{2R}$。将此代入上式可得最终结果。虽然代数过程繁琐，但它是直接的。一个更简洁的中间形式是 $P_{ss}^{true} = R \\frac{K_{ss}(3-K_{ss})}{2-K_{ss}}$，代入 $K_{ss}$ 后得到：\n$$ P_{ss}^{true} = \\frac{(-Q+S)(6R+Q-S)}{2(4R+Q-S)} $$\n其中 $S = \\sqrt{Q^2+4QR}$。\n\n最终结果是一个包含稳态偏差和方差的行向量。\n偏差：$0$。\n方差：$\\frac{(-Q+\\sqrt{Q^2+4QR})(6R+Q-\\sqrt{Q^2+4QR})}{2(4R+Q-\\sqrt{Q^2+4QR})}$。", "answer": "$$\n\\boxed{\\begin{pmatrix} 0  \\frac{(-Q+\\sqrt{Q^2+4QR})(Q+6R-\\sqrt{Q^2+4QR})}{2(Q+4R-\\sqrt{Q^2+4QR})} \\end{pmatrix}}\n$$", "id": "2748176"}, {"introduction": "将物理系统普遍采用的连续时间模型，转化为数字计算机能够执行的离散时间形式，是实现现代控制与估计算法的关键一步。本练习将指导您实现Van Loan方法，这是一种数值上稳定且精确的标准化技术，用于计算连续时间系统对应的离散时间状态转移矩阵 $\\Phi$ 和过程噪声协方差 $Q_d$ [@problem_id:2748131]。通过编写代码并在一系列测试用例上进行验证，您将亲手搭建起连接理论模型与实际数字实现的桥梁，这是任何有志于在实践中应用卡尔曼滤波器的工程师或研究者的必备技能。", "problem": "给定一个连续时间线性时不变随机系统，应在伊腾微积分（Itô calculus）的意义下进行解释，由状态方程 $\\,\\dot{x}(t) = A x(t) + G\\,w(t)\\,$ 描述，其中 $\\,x(t) \\in \\mathbb{R}^{n}\\,$, $\\,A \\in \\mathbb{R}^{n \\times n}\\,$, $\\,G \\in \\mathbb{R}^{n \\times m}\\,$, 且 $\\,w(t)\\,$ 是一个零均值高斯白噪声（GWN）过程，其谱密度为 $\\,Q_{c} \\in \\mathbb{R}^{m \\times m}\\,$. 在一个均匀采样周期 $\\,h  0\\,$ 内，其精确离散时间模型为 $\\,x_{k+1} = \\Phi x_{k} + v_{k}\\,$，其中 $\\,\\Phi \\in \\mathbb{R}^{n \\times n}\\,$ 是状态转移矩阵，$\\,v_{k}\\,$ 是一个零均值离散时间过程噪声，其协方差为 $\\,Q_{d} \\in \\mathbb{R}^{n \\times n}\\,$. 根据线性系统的随机积分定义，$\\,\\Phi = \\exp(A h)\\,$ 且 $\\,Q_{d} = \\int_{0}^{h} \\exp(A \\tau)\\,S\\,\\exp(A^{\\top} \\tau)\\,d\\tau\\,$，其中 $\\,S \\triangleq G Q_{c} G^{\\top}\\,$. 你的任务是实现 Van Loan 方法，该方法通过单个分块矩阵指数计算 $\\,\\Phi\\,$ 和 $\\,Q_{d}\\,$. 你不能依赖任何未经基本原理推导而直接给出 $\\,Q_{d}\\,$ 的公式，并且必须构造 Van Loan 方法所隐含的相应分块矩阵，并从其指数中提取所需的分块。然后，你的程序必须将实现结果与已知的解析结果或高精度数值参考进行验证。\n\n实现一个程序，该程序：\n- 对每个测试系统，构造并计算所需的分块矩阵指数，以获得 $\\,(\\Phi, Q_{d})\\,$.\n- 在适用情况下，将 $\\,\\Phi\\,$ 与 $\\,\\exp(A h)\\,$ 进行验证；将 $\\,Q_{d}\\,$ 与闭式解析表达式（若有）或其定义积分 $\\,\\int_{0}^{h} \\exp(A \\tau)\\,S\\,\\exp(A^{\\top} \\tau)\\,d\\tau\\,$ 的高精度数值积分结果进行验证。\n- 对于每个测试用例，报告两个布尔值：一个用于 $\\,\\Phi\\,$ 的一致性，一个用于 $\\,Q_{d}\\,$ 的一致性。判断依据是相对 Frobenius 范数误差是否低于指定容差。矩阵 $\\,X\\,$ 相对于 $\\,Y\\,$ 的相对误差必须按 $\\,\\|X-Y\\|_{F} / \\max(1,\\|Y\\|_{F})\\,$ 计算，其中 $\\,\\|\\cdot\\|_{F}\\,$ 是 Frobenius 范数。\n\n使用以下测试套件。在下述所有项目中，所有数字均为实数且量纲一致。无需物理单位。\n\n- 测试 $\\,1\\,$ (一般稳定的 $\\,2 \\times 2\\,$ 系统):\n  - $\\,A = \\begin{bmatrix} -1  2 \\\\ -3  -4 \\end{bmatrix}\\,$,\n  - $\\,G = I_{2}\\,$,\n  - $\\,Q_{c} = \\operatorname{diag}(0.5,\\,2.0)\\,$,\n  - $\\,h = 0.1\\,$.\n  - 将 $\\,\\Phi\\,$ 与 $\\,\\exp(A h)\\,$ 进行验证，将 $\\,Q_{d}\\,$ 与其定义积分的数值积分结果进行验证。\n\n- 测试 $\\,2\\,$ (纯积分器边界情况，$\\,A = 0\\,$):\n  - $\\,A = 0_{3 \\times 3}\\,$,\n  - $\\,G = \\begin{bmatrix} 1.0  0.0 \\\\ 0.5  1.0 \\\\ 0.0  -1.0 \\end{bmatrix}\\,$,\n  - $\\,Q_{c} = \\operatorname{diag}(0.3,\\,0.7)\\,$,\n  - $\\,h = 10^{-6}\\,$.\n  - 将 $\\,\\Phi\\,$ 与 $\\,I_{3}\\,$ 进行验证，将 $\\,Q_{d}\\,$ 与 $\\,h\\,G Q_{c} G^{\\top}\\,$ 进行验证。\n\n- 测试 $\\,3\\,$ (带不稳定漂移的标量解析校验):\n  - $\\,A = [\\,0.7\\,]\\,$,\n  - $\\,G = [\\,1.0\\,]\\,$,\n  - $\\,Q_{c} = [\\,0.3\\,]\\,$,\n  - $\\,h = 0.3\\,$.\n  - 将 $\\,\\Phi\\,$ 与 $\\,\\exp(0.7 \\cdot 0.3)\\,$ 进行验证，将 $\\,Q_{d}\\,$ 与解析表达式 $\\,Q_{d} = 0.3\\,\\dfrac{\\exp(2\\cdot 0.7 \\cdot 0.3) - 1}{2\\cdot 0.7}\\,$ 进行验证。\n\n- 测试 $\\,4\\,$ (振荡的 $\\,2 \\times 2\\,$ 系统):\n  - $\\,A = \\begin{bmatrix} 0  \\omega \\\\ -\\omega  0 \\end{bmatrix}\\,$，其中 $\\,\\omega = 20.0\\,$,\n  - $\\,G = \\begin{bmatrix} 1.0  0.0 \\\\ 0.0  0.1 \\end{bmatrix}\\,$,\n  - $\\,Q_{c} = \\operatorname{diag}(1.0,\\,9.0)\\,$,\n  - $\\,h = 0.05\\,$.\n  - 将 $\\,\\Phi\\,$ 与 $\\,\\exp(A h)\\,$ 进行验证，将 $\\,Q_{d}\\,$ 与其定义积分的数值积分结果进行验证。\n\n容差:\n- 对于 $\\,\\Phi\\,$ 的比较：如果相对 Frobenius 范数误差小于 $\\,5 \\times 10^{-13}\\,$，则判为通过。\n- 对于 $\\,Q_{d}\\,$ 的比较：如果相对 Frobenius 范数误差小于 $\\,10^{-10}\\,$，则判为通过。\n\n你的程序必须生成单行输出，其中包含按此确切顺序排列的 $\\,8\\,$ 个测试布尔结果：\n$[\\text{测试 1: } \\Phi \\text{ ok}, \\text{测试 1: } Q_{d} \\text{ ok}, \\text{测试 2: } \\Phi \\text{ ok}, \\text{测试 2: } Q_{d} \\text{ ok}, \\text{测试 3: } \\Phi \\text{ ok}, \\text{测试 3: } Q_{d} \\text{ ok}, \\text{测试 4: } \\Phi \\text{ ok}, \\text{测试 4: } Q_{d} \\text{ ok}]$.\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[\\,\\text{true},\\text{false},\\dots\\,]$，使用 Python 布尔值的大小写格式）。", "solution": "该问题要求计算一个连续时间线性时不变（LTI）随机系统的精确离散时间等效模型。在数字控制和状态估计领域，尤其是在实现卡尔曼滤波器时，这个过程是基础性的。\n\n首先，我们必须严谨地建立理论基础。该连续时间系统由以下 Itô 随机微分方程描述：\n$$\n\\dot{x}(t) = A x(t) + G w(t)\n$$\n其中 $x(t) \\in \\mathbb{R}^{n}$ 是状态向量，$A \\in \\mathbb{R}^{n \\times n}$ 是动态矩阵，$G \\in \\mathbb{R}^{n \\times m}$ 是噪声输入矩阵，$w(t)$ 是一个 $m$ 维连续时间零均值高斯白噪声向量，其谱密度矩阵为 $Q_{c} \\in \\mathbb{R}^{m \\times m}$。该噪声过程的协方差形式上表示为 $E[w(t) w(\\tau)^T] = Q_{c} \\delta(t-\\tau)$，其中 $\\delta(\\cdot)$ 是狄拉克δ函数。\n\n在从初始时间 $t_k$ 到终止时间 $t_{k+1} = t_k + h$、时长为 $h  0$ 的时间间隔内，此线性随机微分方程的解为：\n$$\nx(t_{k+1}) = e^{Ah} x(t_k) + \\int_{t_k}^{t_{k+1}} e^{A(t_{k+1}-\\tau)} G w(\\tau) d\\tau\n$$\n通过将状态离散化为 $x_k \\triangleq x(t_k)$，我们得到精确的离散时间模型：\n$$\nx_{k+1} = \\Phi x_k + v_k\n$$\n由此，我们确定状态转移矩阵 $\\Phi$ 和离散时间过程噪声 $v_k$：\n$$\n\\Phi = e^{Ah}\n$$\n$$\nv_k = \\int_{0}^{h} e^{A(h-\\sigma)} G w(t_k+\\sigma) d\\sigma\n$$\n离散过程噪声 $v_k$ 是一个零均值高斯随机向量。我们要求解的是其协方差矩阵 $Q_d = E[v_k v_k^T]$。代入 $v_k$ 的表达式并利用白噪声的性质，可以得到其协方差为：\n$$\nQ_d = \\int_{0}^{h} e^{A\\tau} (G Q_c G^T) e^{A^T\\tau} d\\tau\n$$\n我们定义常数矩阵 $S \\triangleq G Q_c G^T \\in \\mathbb{R}^{n \\times n}$。现在的问题就变成了计算 $\\Phi = e^{Ah}$ 和 $Q_d = \\int_{0}^{h} e^{A\\tau} S e^{A^T\\tau} d\\tau$。\n\n直接对 $Q_d$ 的积分进行数值积分是可行的，但计算量很大，并且如果 $h$ 发生变化，就必须在每个时间步长重新计算。Van Loan 方法提供了一种更优雅且数值上更稳健的解法，通过单个矩阵指数来同时计算 $\\Phi$ 和 $Q_d$。\n\n该方法涉及构造一个更大的 $2n \\times 2n$ 分块矩阵。考虑矩阵 $M$ 定义如下：\n$$\nM = \\begin{bmatrix} A  S \\\\ 0  -A^T \\end{bmatrix}\n$$\n我们将计算 $Mh$ 的指数，记为 $E = \\exp(Mh)$。令 $E(t) = \\exp(Mt)$。该矩阵是矩阵微分方程 $\\frac{d}{dt}E(t) = M E(t)$ 在初始条件 $E(0) = I_{2n}$ 下的解。我们将 $E(t)$ 划分为 $n \\times n$ 的分块：\n$$\nE(t) = \\begin{bmatrix} \\mathcal{E}_{11}(t)  \\mathcal{E}_{12}(t) \\\\ \\mathcal{E}_{21}(t)  \\mathcal{E}_{22}(t) \\end{bmatrix}\n$$\n针对这些分块的微分方程组变为：\n$$\n\\frac{d}{dt} \\begin{bmatrix} \\mathcal{E}_{11}  \\mathcal{E}_{12} \\\\ \\mathcal{E}_{21}  \\mathcal{E}_{22} \\end{bmatrix} = \\begin{bmatrix} A  S \\\\ 0  -A^T \\end{bmatrix} \\begin{bmatrix} \\mathcal{E}_{11}  \\mathcal{E}_{12} \\\\ \\mathcal{E}_{21}  \\mathcal{E}_{22} \\end{bmatrix}\n$$\n初始条件为 $\\mathcal{E}_{11}(0) = I_n$, $\\mathcal{E}_{22}(0) = I_n$, 以及 $\\mathcal{E}_{12}(0) = \\mathcal{E}_{21}(0) = 0$。\n\n从底行开始向上求解该分块方程组：\n1.  $\\dot{\\mathcal{E}}_{21}(t) = -A^T \\mathcal{E}_{21}(t)$。在初始条件 $\\mathcal{E}_{21}(0) = 0$ 下，唯一解是 $\\mathcal{E}_{21}(t) = 0$ 对所有 $t$ 成立。\n2.  $\\dot{\\mathcal{E}}_{22}(t) = -A^T \\mathcal{E}_{22}(t)$。在初始条件 $\\mathcal{E}_{22}(0) = I_n$ 下，解为 $\\mathcal{E}_{22}(t) = e^{-A^T t}$。\n3.  $\\dot{\\mathcal{E}}_{11}(t) = A \\mathcal{E}_{11}(t) + S \\mathcal{E}_{21}(t)$。由于 $\\mathcal{E}_{21}(t) = 0$，这变为 $\\dot{\\mathcal{E}}_{11}(t) = A \\mathcal{E}_{11}(t)$。在初始条件 $\\mathcal{E}_{11}(0) = I_n$ 下，解为 $\\mathcal{E}_{11}(t) = e^{At}$。\n4.  $\\dot{\\mathcal{E}}_{12}(t) = A \\mathcal{E}_{12}(t) + S \\mathcal{E}_{22}(t)$。代入 $\\mathcal{E}_{22}(t)$ 的解，我们得到一个非齐次线性常微分方程（ODE）：$\\dot{\\mathcal{E}}_{12}(t) = A \\mathcal{E}_{12}(t) + S e^{-A^T t}$。在初始条件 $\\mathcal{E}_{12}(0) = 0$ 下，通过常数变易法得到的解是 $\\mathcal{E}_{12}(t) = e^{At} \\int_0^t e^{-A\\tau} S e^{-A^T\\tau} d\\tau$。\n\n将这些解在 $t=h$ 处求值，我们得到 $E = \\exp(Mh)$ 的各个分块：\n$$\n\\mathcal{E}_{11}(h) = e^{Ah} = \\Phi\n$$\n$$\n\\mathcal{E}_{12}(h) = e^{Ah} \\int_0^h e^{-A\\tau} S e^{-A^T\\tau} d\\tau\n$$\n右下角分块为 $\\mathcal{E}_{22}(h) = e^{-A^T h} = (e^{A^T h})^{-1} = (\\Phi^T)^{-1}$。左上角分块 $\\mathcal{E}_{11}(h)$ 正是状态转移矩阵 $\\Phi$。右上角分块 $\\mathcal{E}_{12}(h)$ 本身并非 $Q_d$，但与之密切相关。让我们用 $\\Phi^T = e^{A^T h}$ 右乘 $\\mathcal{E}_{12}(h)$：\n$$\n\\mathcal{E}_{12}(h) \\Phi^T = \\left( e^{Ah} \\int_0^h e^{-A\\tau} S e^{-A^T\\tau} d\\tau \\right) e^{A^T h} = \\int_0^h e^{A(h-\\tau)} S e^{-A^T\\tau} e^{A^T h} d\\tau\n$$\n$$\n= \\int_0^h e^{A(h-\\tau)} S e^{A^T(h-\\tau)} d\\tau\n$$\n通过变量代换 $\\sigma = h-\\tau$，其中 $d\\sigma = -d\\tau$，且 $\\tau$ 的积分上下限 $[0, h]$ 对于 $\\sigma$ 变为 $[h, 0]$：\n$$\n= \\int_h^0 e^{A\\sigma} S e^{A^T\\sigma} (-d\\sigma) = \\int_0^h e^{A\\sigma} S e^{A^T\\sigma} d\\sigma = Q_d\n$$\n此推导证实了该方法的正确性。算法如下：\n1.  给定 $A, G, Q_c, h$，计算 $S = G Q_c G^T$。\n2.  构造 $2n \\times 2n$ 矩阵 $M = \\begin{bmatrix} A  S \\\\ 0  -A^T \\end{bmatrix}$。\n3.  使用可靠的矩阵指数算法计算 $E = \\exp(Mh)$。\n4.  提取分块：$\\Phi = E[1:n, 1:n]$ 并令 $\\mathcal{E}_{12} = E[1:n, n+1:2n]$。\n5.  按 $Q_d = \\mathcal{E}_{12} \\Phi^T$ 计算离散噪声协方差。\n\n实现此过程后，将与参考计算进行验证。验证使用解析表达式（若存在）或对 $Q_d$ 的定义积分进行高精度数值积分。比较基于相对 Frobenius 范数误差：$\\epsilon(X, Y) = \\|X-Y\\|_F / \\max(1, \\|Y\\|_F)$。", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import expm\nfrom scipy.integrate import quad_vec\n\ndef solve():\n    \"\"\"\n    Implements and validates Van Loan's method for discretizing a continuous-time\n    LTI stochastic system.\n    \"\"\"\n\n    # --- Test Case Definitions ---\n    # ω for Test 4\n    omega = 20.0\n    \n    test_cases = [\n        {\n            \"id\": 1,\n            \"A\": np.array([[-1.0, 2.0], [-3.0, -4.0]]),\n            \"G\": np.identity(2),\n            \"Qc\": np.diag([0.5, 2.0]),\n            \"h\": 0.1,\n            \"ref_type\": \"quadrature\"\n        },\n        {\n            \"id\": 2,\n            \"A\": np.zeros((3, 3)),\n            \"G\": np.array([[1.0, 0.0], [0.5, 1.0], [0.0, -1.0]]),\n            \"Qc\": np.diag([0.3, 0.7]),\n            \"h\": 1e-6,\n            \"ref_type\": \"analytic_A0\"\n        },\n        {\n            \"id\": 3,\n            \"A\": np.array([[0.7]]),\n            \"G\": np.array([[1.0]]),\n            \"Qc\": np.array([[0.3]]),\n            \"h\": 0.3,\n            \"ref_type\": \"analytic_scalar\"\n        },\n        {\n            \"id\": 4,\n            \"A\": np.array([[0.0, omega], [-omega, 0.0]]),\n            \"G\": np.array([[1.0, 0.0], [0.0, 0.1]]),\n            \"Qc\": np.diag([1.0, 9.0]),\n            \"h\": 0.05,\n            \"ref_type\": \"quadrature\"\n        }\n    ]\n\n    phi_tol = 5e-13\n    qd_tol = 1e-10\n    results = []\n\n    def relative_frobenius_error(X, Y):\n        \"\"\"Computes the relative Frobenius norm error.\"\"\"\n        norm_Y = np.linalg.norm(Y, 'fro')\n        norm_diff = np.linalg.norm(X - Y, 'fro')\n        return norm_diff / max(1.0, norm_Y)\n\n    for case in test_cases:\n        A, G, Qc, h = case[\"A\"], case[\"G\"], case[\"Qc\"], case[\"h\"]\n        n = A.shape[0]\n\n        # --- Van Loan's Method ---\n        # 1. Compute S = G * Qc * G^T\n        S = G @ Qc @ G.T\n\n        # 2. Construct the 2n x 2n matrix M\n        M = np.block([\n            [A, S],\n            [np.zeros((n, n)), -A.T]\n        ])\n\n        # 3. Compute the matrix exponential E = exp(M*h)\n        E = expm(M * h)\n\n        # 4. Extract Phi\n        phi_vl = E[:n, :n]\n\n        # 5. Extract the intermediate block and compute Qd\n        E12 = E[:n, n:]\n        qd_vl = E12 @ phi_vl.T\n        \n        # Symmetrize Qd to enforce theoretical property and improve numerical stability\n        qd_vl = (qd_vl + qd_vl.T) / 2.0\n\n        # --- Reference Calculation ---\n        if case[\"ref_type\"] == \"quadrature\":\n            phi_ref = expm(A * h)\n            \n            # Integrand function for Qd\n            def integrand(tau):\n                mat = expm(A * tau) @ S @ expm(A.T * tau)\n                return mat.flatten()\n\n            # Integrate from 0 to h\n            integral_flat, _ = quad_vec(integrand, 0, h, epsabs=1e-14, epsrel=1e-14)\n            qd_ref = integral_flat.reshape((n, n))\n\n        elif case[\"ref_type\"] == \"analytic_A0\":\n            phi_ref = np.identity(n)\n            qd_ref = S * h\n\n        elif case[\"ref_type\"] == \"analytic_scalar\":\n            a = A[0, 0]\n            phi_ref = np.array([[np.exp(a * h)]])\n            # For a != 0\n            if np.abs(a) > 1e-9:\n                qd_ref = S * (np.exp(2 * a * h) - 1) / (2 * a)\n            else: # Taylor expansion for a -> 0\n                qd_ref = S * h * (1 + a*h + (2/3)*(a*h)**2)\n\n        # --- Validation ---\n        phi_err = relative_frobenius_error(phi_vl, phi_ref)\n        qd_err = relative_frobenius_error(qd_vl, qd_ref)\n\n        phi_ok = phi_err  phi_tol\n        qd_ok = qd_err  qd_tol\n\n        results.extend([phi_ok, qd_ok])\n    \n    # --- Final Output Formatting ---\n    # The problem asks for lowercase boolean strings.\n    print(f\"[{','.join(str(b).lower() for b in results)}]\")\n\nsolve()\n```", "id": "2748131"}]}