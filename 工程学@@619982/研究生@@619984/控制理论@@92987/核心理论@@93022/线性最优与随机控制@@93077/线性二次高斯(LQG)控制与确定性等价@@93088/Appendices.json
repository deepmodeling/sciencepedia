{"hands_on_practices": [{"introduction": "线性二次高斯（LQG）控制的核心在于将最优估计与最优控制相结合。我们的第一个实践练习将重点关注后者：线性二次调节器（LQR）的设计。通过手工解析求解一个离散时间代数Riccati方程（DARE），你将不仅仅是得到一个反馈增益 $K$，更重要的是能深刻理解最优控制律的内在结构，这是使用数值求解器时常常被忽略的宝贵洞见。[@problem_id:2719578]", "problem": "考虑一个离散时间线性时不变系统，其状态更新方程为 $x_{k+1} = A x_{k} + B u_{k}$，无限时域二次型代价函数为 $J = \\sum_{k=0}^{\\infty} \\left( x_{k}^{\\mathsf{T}} Q x_{k} + u_{k}^{\\mathsf{T}} R u_{k} \\right)$，其中\n$$\nA = \\begin{bmatrix} 1 & 1 \\\\ 0 & 1 \\end{bmatrix},\\quad\nB = \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix},\\quad\nQ = I_{2},\\quad\nR = 1.\n$$\n从无限时域离散时间线性二次调节器（LQR）问题的动态规划表述的最优性原理出发，设稳态值函数为二次型 $V(x) = x^{\\mathsf{T}} P x$，其中 $P = P^{\\mathsf{T}} \\succeq 0$。推导 $P$ 必须满足的矩阵关系式，并解析求解最优状态反馈增益 $K$，使得最优控制为 $u_{k} = - K x_{k}$。然后，通过刻画其特征值来验证闭环矩阵 $A - B K$ 是 Schur 稳定的。最后，根据确定性等价原理，简要解释在线性二次高斯（LQG）控制器中如何将相同的增益 $K$ 与状态估计结合使用。将最终答案表示为精确的行向量 $K$，使用根式表示，不要近似或四舍五入。", "solution": "该问题要求推导和求解一个离散时间无限时域线性二次调节器（LQR）问题，然后进行稳定性分析，并从概念上解释其与线性二次高斯（LQG）控制的联系。\n\n**步骤 1：问题验证**\n\n问题陈述给出了以下已知条件：一个离散时间线性时不变系统和一个代价函数。\n- 状态更新方程：$x_{k+1} = A x_{k} + B u_{k}$\n- 无限时域二次型代价：$J = \\sum_{k=0}^{\\infty} \\left( x_{k}^{\\mathsf{T}} Q x_{k} + u_{k}^{\\mathsf{T}} R u_{k} \\right)$\n- 系统矩阵：\n$$\nA = \\begin{bmatrix} 1 & 1 \\\\ 0 & 1 \\end{bmatrix},\\quad\nB = \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix},\\quad\nQ = I_{2} = \\begin{bmatrix} 1 & 0 \\\\ 0 & 1 \\end{bmatrix},\\quad\nR = 1\n$$\n- 值函数假设为 $V(x) = x^{\\mathsf{T}} P x$ 的形式，其中 $P = P^{\\mathsf{T}} \\succeq 0$。\n- 最优控制律的形式为 $u_k = -K x_k$。\n\n该问题在控制理论中有科学依据，是适定的，且表述客观。系统对 $(A, B)$ 的能控性矩阵为 $\\mathcal{C} = \\begin{bmatrix} B & AB \\end{bmatrix} = \\begin{bmatrix} 0 & 1 \\\\ 1 & 1 \\end{bmatrix}$，其行列式为 $-1$，因此是满秩的。这意味着该系统是能控的，这是能稳性的一个充分条件。系统对 $(A, \\sqrt{Q}) = (A, I)$ 是能观的，因为能观性矩阵 $\\mathcal{O} = \\begin{bmatrix} I \\\\ A^{\\mathsf{T}} \\end{bmatrix}$ 是列满秩的。由于 $Q \\succeq 0$ 且 $R > 0$，并且系统是能稳和能检测的，因此相关的代数 Riccati 方程存在唯一的、半正定的稳定解 $P$。该问题是有效的。\n\n**步骤 2：离散代数 Riccati 方程（DARE）的推导**\n\n根据最优性原理，可得到无限时域值函数 $V(x)$ 的 Bellman 方程：\n$$ V(x) = \\min_{u} \\left\\{ x^{\\mathsf{T}} Q x + u^{\\mathsf{T}} R u + V(Ax + Bu) \\right\\} $$\n代入二次型值函数 $V(x) = x^{\\mathsf{T}} P x$：\n$$ x^{\\mathsf{T}} P x = \\min_{u} \\left\\{ x^{\\mathsf{T}} Q x + u^{\\mathsf{T}} R u + (Ax + Bu)^{\\mathsf{T}} P (Ax + Bu) \\right\\} $$\n为了找到最优控制 $u$，我们对花括号中的项进行最小化。我们求其关于 $u$ 的导数并令其为零。\n$$ \\frac{\\partial}{\\partial u} \\left( u^{\\mathsf{T}} R u + 2u^{\\mathsf{T}}B^{\\mathsf{T}}PAx + u^{\\mathsf{T}}B^{\\mathsf{T}}PBu \\right) = 2Ru + 2B^{\\mathsf{T}}PAx = 0 $$\n求解在时间步 $k$ 的最优控制 $u_k^*$：\n$$ u_{k}^* = -(R + B^{\\mathsf{T}} P B)^{-1} B^{\\mathsf{T}} P A x_{k} $$\n这给出了最优状态反馈增益矩阵 $K = (R + B^{\\mathsf{T}} P B)^{-1} B^{\\mathsf{T}} P A$。将 $u_k^* = -K x_k$ 代回 Bellman 方程得到：\n$$ x^{\\mathsf{T}} P x = x^{\\mathsf{T}} Q x + (-Kx)^{\\mathsf{T}} R (-Kx) + (A-BK)x^{\\mathsf{T}} P (A-BK)x $$\n由于该式对所有 $x$ 都必须成立，我们得到关系式 $P = Q + K^{\\mathsf{T}} R K + (A-BK)^{\\mathsf{T}} P (A-BK)$。将 $u^*$ 代回到最小化的表达式中，可以得到一个更直接的形式，即离散代数 Riccati 方程（DARE）：\n$$ P = Q + A^{\\mathsf{T}} P A - A^{\\mathsf{T}} P B (R + B^{\\mathsf{T}} P B)^{-1} B^{\\mathsf{T}} P A $$\n\n**步骤 3：求解 DARE 得到 P**\n\n设 $P = \\begin{bmatrix} p_{11} & p_{12} \\\\ p_{12} & p_{22} \\end{bmatrix}$ 为对称半正定解。我们计算 DARE 中的各项：\n- $A^{\\mathsf{T}} P A = \\begin{bmatrix} 1 & 0 \\\\ 1 & 1 \\end{bmatrix} \\begin{bmatrix} p_{11} & p_{12} \\\\ p_{12} & p_{22} \\end{bmatrix} \\begin{bmatrix} 1 & 1 \\\\ 0 & 1 \\end{bmatrix} = \\begin{bmatrix} p_{11} & p_{11}+p_{12} \\\\ p_{11}+p_{12} & p_{11}+2p_{12}+p_{22} \\end{bmatrix}$\n- $B^{\\mathsf{T}} P B = \\begin{bmatrix} 0 & 1 \\end{bmatrix} \\begin{bmatrix} p_{11} & p_{12} \\\\ p_{12} & p_{22} \\end{bmatrix} \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix} = p_{22}$\n- $A^{\\mathsf{T}} P B = \\begin{bmatrix} 1 & 0 \\\\ 1 & 1 \\end{bmatrix} \\begin{bmatrix} p_{11} & p_{12} \\\\ p_{12} & p_{22} \\end{bmatrix} \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix} = \\begin{bmatrix} p_{12} \\\\ p_{12}+p_{22} \\end{bmatrix}$\n- 修正项为 $\\frac{1}{1+p_{22}} (A^{\\mathsf{T}} P B)(B^{\\mathsf{T}} P A) = \\frac{1}{1+p_{22}} \\begin{bmatrix} p_{12}^2 & p_{12}(p_{12}+p_{22}) \\\\ p_{12}(p_{12}+p_{22}) & (p_{12}+p_{22})^2 \\end{bmatrix}$\n\n将这些代入 DARE $P = Q + A^{\\mathsf{T}}PA - (\\text{修正项})$，得到一个包含三个非线性方程的方程组：\n1. ($1,1$) 项：$p_{11} = 1 + p_{11} - \\frac{p_{12}^2}{1+p_{22}} \\implies p_{12}^2 = 1+p_{22}$。\n2. ($1,2$) 项：$p_{12} = 0 + p_{11}+p_{12} - \\frac{p_{12}(p_{12}+p_{22})}{1+p_{22}} \\implies p_{11} = \\frac{p_{12}(p_{12}+p_{22})}{1+p_{22}}$。\n3. ($2,2$) 项：$p_{22} = 1 + p_{11}+2p_{12}+p_{22} - \\frac{(p_{12}+p_{22})^2}{1+p_{22}} \\implies 0 = 1+p_{11}+2p_{12} - \\frac{(p_{12}+p_{22})^2}{1+p_{22}}$。\n\n使用 (1) 式的 $p_{12}^2 = 1+p_{22}$，我们简化 (2) 式：$p_{11} = \\frac{p_{12}(p_{12} + p_{12}^2-1)}{p_{12}^2} = 1+p_{12}-\\frac{1}{p_{12}}$。对于 $P \\succeq 0$，需要 $p_{22} \\ge 0$，因此 $p_{12}^2 \\ge 1$。\n将此代入 (3) 式：\n$0 = 1 + (1+p_{12}-\\frac{1}{p_{12}}) + 2p_{12} - \\frac{(p_{12}+p_{12}^2-1)^2}{p_{12}^2} = 2+3p_{12}-\\frac{1}{p_{12}} - (p_{12}+1-\\frac{1}{p_{12}})^2$\n令 $z=p_{12}$。$0 = 2+3z-\\frac{1}{z} - (z^2+1+\\frac{1}{z^2}+2z-2-\\frac{2}{z}) = 3+z+\\frac{1}{z}-z^2-1-\\frac{1}{z^2}$。\n两边乘以 $-z^2$ 得到四次方程：$z^4 - z^3 - 3z^2 - z + 1 = 0$。\n这是一个倒数方程。两边除以 $z^2$：$(z^2+\\frac{1}{z^2}) - (z+\\frac{1}{z}) - 3 = 0$。\n设 $w = z+\\frac{1}{z}$。那么 $w^2-2 = z^2+\\frac{1}{z^2}$。方程变为 $(w^2-2) - w - 3 = 0 \\implies w^2-w-5=0$。\n$w$ 的解为 $w = \\frac{1 \\pm \\sqrt{1 - 4(1)(-5)}}{2} = \\frac{1 \\pm \\sqrt{21}}{2}$。\n对于一个稳定解，闭环特征值必须在单位圆盘内。这对应于正定解 $P$，它要求恰当地选择 $p_{12}=z$。我们需要 $p_{11} > 0$ 和 $p_{22} \\ge 0$。\n我们得到 $p_{11}=1+z-1/z$。由于 $w=z+1/z$，则 $z-1/z = \\pm\\sqrt{w^2-4}$。所以 $p_{11}=1\\pm\\sqrt{w^2-4}$。\n`P` 必须是正定的。条件 $p_{22} = z^2-1 \\ge 0$ 意味着 $|z| \\ge 1$。若 $|z| \\ge 1$，则 $|w| = |z+1/z| \\ge | |z|-|1/z| | \\ge 0$，但要使 $z^2-wz+1=0$ 有实数根，我们需要 $|w| \\ge 2$。\n$w_1 = (1+\\sqrt{21})/2 \\approx 2.79 > 2$。$w_2 = (1-\\sqrt{21})/2 \\approx -1.79$，$|w_2|<2$。\n这意味着我们必须选择 $w_1 = (1+\\sqrt{21})/2$，它能产生 $z$ 的实数根。$z$ 的解必须满足 $|z| \\ge 1$。由 $z+1/z=w_1$ 得出的 $z$ 的两个根是 $z_a>1$ 和 $z_b=1/z_a<1$。所以我们必须选择较大的根 $p_{12} = z_a > 1$。\n此外，$p_{11}=1+z-1/z = 1+(z+1/z)-2/z = 1+w-2/z > 1+2-2/1 > 0$。关于 $p_{11}$ 的条件得到满足。\n\n**步骤 4：计算最优增益 K**\n\n最优增益为 $K = (R + B^{\\mathsf{T}} P B)^{-1} B^{\\mathsf{T}} P A = \\frac{1}{1+p_{22}} [p_{12}, p_{12}+p_{22}]$。\n使用 $1+p_{22} = p_{12}^2$，我们有 $K = \\frac{1}{p_{12}^2}[p_{12}, p_{12}+p_{12}^2-1] = [\\frac{1}{p_{12}}, 1+\\frac{1}{p_{12}}-\\frac{1}{p_{12}^2}]$。\n令 $k_1 = 1/p_{12}$ 且 $k_2 = 1+1/p_{12}-1/p_{12}^2 = 1+k_1-k_1^2$。\n因为 $p_{12}$ 是 $z^2-w_1 z+1=0$ 的较大根，所以 $k_1=1/p_{12}$ 是较小根。\n$k_1 = \\frac{w_1 - \\sqrt{w_1^2-4}}{2}$，其中 $w_1 = \\frac{1+\\sqrt{21}}{2}$。\n$w_1^2-4 = (\\frac{1+\\sqrt{21}}{2})^2 - 4 = \\frac{1+2\\sqrt{21}+21}{4}-4 = \\frac{22+2\\sqrt{21}-16}{4} = \\frac{6+2\\sqrt{21}}{4} = \\frac{3+\\sqrt{21}}{2}$。\n所以，$k_1 = \\frac{\\frac{1+\\sqrt{21}}{2} - \\sqrt{\\frac{3+\\sqrt{21}}{2}}}{2} = \\frac{1+\\sqrt{21} - \\sqrt{2(3+\\sqrt{21})}}{4} = \\frac{1+\\sqrt{21} - \\sqrt{6+2\\sqrt{21}}}{4}$。\n现在我们求 $k_2 = 1+k_1-k_1^2$。由 $k_1^2-w_1 k_1+1=0$，我们有 $k_1^2=w_1 k_1-1$。\n$k_2 = 1+k_1-(w_1 k_1-1) = 2+(1-w_1)k_1$。\n$1-w_1 = 1-\\frac{1+\\sqrt{21}}{2} = \\frac{1-\\sqrt{21}}{2}$。\n$k_2 = 2+\\frac{1-\\sqrt{21}}{2}k_1 = 2+\\frac{1-\\sqrt{21}}{2}\\left(\\frac{1+\\sqrt{21}-\\sqrt{6+2\\sqrt{21}}}{4}\\right) = 2+\\frac{1-21-(1-\\sqrt{21})\\sqrt{6+2\\sqrt{21}}}{8}$。\n$k_2 = 2 - \\frac{20}{8} - \\frac{1-\\sqrt{21}}{8}\\sqrt{6+2\\sqrt{21}} = -\\frac{1}{2} + \\frac{\\sqrt{21}-1}{8}\\sqrt{6+2\\sqrt{21}}$。\n所以，$K = \\begin{bmatrix} k_1 & k_2 \\end{bmatrix}$。\n\n**步骤 5：稳定性验证**\n\n闭环系统矩阵为 $A_{cl} = A - BK = \\begin{bmatrix} 1 & 1 \\\\ 0 & 1 \\end{bmatrix} - \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix} \\begin{bmatrix} k_1 & k_2 \\end{bmatrix} = \\begin{bmatrix} 1 & 1 \\\\ -k_1 & 1-k_2 \\end{bmatrix}$。\n特征多项式为 $\\det(\\lambda I - A_{cl}) = 0$：\n$\\det \\begin{bmatrix} \\lambda-1 & -1 \\\\ k_1 & \\lambda-(1-k_2) \\end{bmatrix} = (\\lambda-1)(\\lambda-1+k_2) + k_1 = 0$。\n$\\lambda^2 + (k_2-2)\\lambda + (1-k_2+k_1) = 0$。\n使用关系式 $k_2-2=(1-w_1)k_1$ 和 $1-k_2+k_1 = k_1^2$，该多项式变为：\n$\\lambda^2 + (1-w_1)k_1 \\lambda + k_1^2 = 0$。\n根为 $\\lambda = \\frac{-(1-w_1)k_1 \\pm \\sqrt{(1-w_1)^2k_1^2 - 4k_1^2}}{2} = \\frac{k_1}{2} \\left( -(1-w_1) \\pm \\sqrt{(1-w_1)^2 - 4} \\right)$。\n平方根下的项为 $(1-w_1)^2-4 = (\\frac{1-\\sqrt{21}}{2})^2-4 = \\frac{1-2\\sqrt{21}+21}{4}-4 = \\frac{22-2\\sqrt{21}-16}{4} = \\frac{6-2\\sqrt{21}}{4} = \\frac{3-\\sqrt{21}}{2} < 0$。\n根是共轭复数。根的模的平方是：\n$|\\lambda|^2 = \\left( \\frac{k_1(w_1-1)}{2} \\right)^2 + \\left( \\frac{k_1\\sqrt{4-(w_1-1)^2}}{2} \\right)^2 = \\frac{k_1^2}{4} \\left( (w_1-1)^2 + 4-(w_1-1)^2 \\right) = k_1^2$。\n所以，$|\\lambda| = |k_1|$。由于 $p_{12} > 1$，我们有 $0 < k_1 = 1/p_{12} < 1$。闭环系统的特征值严格位于单位圆内，这证实了 $A-BK$ 是 Schur 稳定的。\n\n**步骤 6：确定性等价原理**\n\n线性二次高斯（LQG）控制问题将 LQR 框架扩展到受高斯噪声影响的系统。对于一个由 $x_{k+1} = Ax_k + Bu_k + w_k$ 和 $y_k = Cx_k + v_k$ 描述的系统，其中 $w_k$ 和 $v_k$ 是零均值高斯白噪声过程，其目标是最小化相同二次型代价泛函的期望值。\nLQG 问题的解著名地分离为一个最优状态估计问题和一个最优控制问题。这被称为**分离原理**。\n首先，设计一个 Kalman 滤波器，以根据测量历史产生状态的最优估计 $\\hat{x}_k$。\n然后，**确定性等价原理**指出，最优控制律是通过在确定性 LQR 控制律中，简单地用此状态估计 $\\hat{x}_k$ 代替真实（且未知）的状态 $x_k$ 来获得的。\n因此，LQG 控制器将是 $u_k = -K \\hat{x}_k$，使用的正是本问题中推导出的同一个增益矩阵 $K$。控制器（$K$）和观测器（Kalman 滤波器）的设计是相互独立的。这一特性是现代控制理论的基石，但它特别适用于具有高斯噪声和二次型代价的线性系统。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1+\\sqrt{21} - \\sqrt{6+2\\sqrt{21}}}{4} & -\\frac{1}{2} + \\frac{\\sqrt{21}-1}{8}\\sqrt{6+2\\sqrt{21}} \\end{pmatrix}}\n$$", "id": "2719578"}, {"introduction": "获得了最优控制器后，我们需要为其提供一个准确的状态估计，这正是卡尔曼滤波器的用武之地。这个练习将引导你从最基本的预测和更新步骤出发，为一个简单的标量系统推导出稳态卡尔曼滤波器。这种自下而上的方法能够清晰地揭示滤波器是如何在模型预测和新测量值之间进行最优权衡的，从而为置信度等价原则提供坚实的估计基础。[@problem_id:2719584]", "problem": "考虑一个标量、时不变的随机线性系统，该系统出现在确定性等价原则下的线性二次高斯（LQG）控制中：\n- 状态动力学：$x_{t+1} = a\\,x_t + w_t$，\n- 测量：$y_t = x_t + v_t$，\n其中 $\\{w_t\\}$ 和 $\\{v_t\\}$ 是相互独立、零均值的高斯白噪声序列，其方差分别为 $\\sigma_w^2$ 和 $\\sigma_v^2$。假设 $a \\in \\mathbb{R}\\setminus\\{0\\}$，$\\sigma_w^2 > 0$ 及 $\\sigma_v^2 > 0$。令 $L$ 表示用于从 $y_t$ 估计 $x_t$ 的稳态 Kalman 增益，令 $P$ 表示稳态后验估计误差方差，即 $P = \\lim_{t\\to\\infty} \\mathbb{E}\\big[(x_t - \\hat{x}_{t|t})^2\\big]$，并假设该极限存在。仅使用线性高斯系统的线性最小二乘估计的核心原理，不引用任何已解的代数 Riccati 方程公式，推导并求解稳态不动点方程，以获得 $P$ 和 $L$ 关于 $a$、$\\sigma_w^2$ 和 $\\sigma_v^2$ 的精确闭式表达式。请以精确解析形式（无近似）给出您的最终表达式。无需四舍五入，不涉及物理单位。将您的最终答案以数对 $(P, L)$ 的形式报告。", "solution": "对问题陈述进行验证。\n\n逐字提取给定条件：\n- 状态动力学：$x_{t+1} = a\\,x_t + w_t$。\n- 测量：$y_t = x_t + v_t$。\n- 噪声：$\\{w_t\\}$ 和 $\\{v_t\\}$ 是相互独立、零均值的高斯白噪声序列，其方差为 $\\mathbb{E}[w_t^2] = \\sigma_w^2$ 和 $\\mathbb{E}[v_t^2] = \\sigma_v^2$。\n- 参数：$a \\in \\mathbb{R}\\setminus\\{0\\}$，$\\sigma_w^2 > 0$ 及 $\\sigma_v^2 > 0$。\n- 定义：$L$ 是稳态 Kalman 增益，$P = \\lim_{t\\to\\infty} \\mathbb{E}\\big[(x_t - \\hat{x}_{t|t})^2\\big]$ 是稳态后验估计误差方差。\n- 假设：$P$ 的极限存在。\n- 目标：从核心原理出发，推导并求解稳态不动点方程，得到 $P$ 和 $L$ 关于 $a$、$\\sigma_w^2$ 和 $\\sigma_v^2$ 的表达式。\n\n验证结论：问题有效。它在科学上基于随机估计理论（Kalman 滤波）的既定原理。该问题是适定的，因为给定的条件（以及存在性假设）保证了唯一、稳定且有意义的稳态解。问题陈述客观、完整，不包含任何矛盾或科学上不成立的前提。\n\n解答过程通过从 Kalman 滤波器的基本原理推导稳态代数 Riccati 方程来进行。\n\n令 $\\hat{x}_{t|t-1}$ 为基于截至时刻 $t-1$ 的测量的时刻 $t$ 的*先验*状态估计，其误差方差为 $P_{t|t-1} = \\mathbb{E}[(x_t - \\hat{x}_{t|t-1})^2]$。\n令 $\\hat{x}_{t|t}$ 为基于截至时刻 $t$ 的测量的时刻 $t$ 的*后验*状态估计，其误差方差为 $P_{t|t} = \\mathbb{E}[(x_t - \\hat{x}_{t|t})^2]$。\n\nKalman 滤波器包含一个两步递归过程：时间更新（预测）和测量更新（校正）。\n\n$1$. 时间更新：\n状态根据 $x_{t+1} = a x_t + w_t$ 传播。预测状态是条件期望 $\\hat{x}_{t+1|t} = \\mathbb{E}[a x_t + w_t | Y_t] = a \\hat{x}_{t|t}$，其中 $Y_t$ 代表截至时刻 $t$ 的测量集合。过程噪声 $w_t$ 独立于过去的信息且均值为零。\n$t+1$ 时刻的*先验*误差方差为：\n$$P_{t+1|t} = \\mathbb{E}[(x_{t+1} - \\hat{x}_{t+1|t})^2] = \\mathbb{E}[(a x_t + w_t - a \\hat{x}_{t|t})^2]$$\n$$P_{t+1|t} = \\mathbb{E}[(a(x_t - \\hat{x}_{t|t}) + w_t)^2] = a^2 \\mathbb{E}[(x_t - \\hat{x}_{t|t})^2] + 2a \\mathbb{E}[(x_t - \\hat{x}_{t|t})w_t] + \\mathbb{E}[w_t^2]$$\n由于时刻 $t$ 的估计误差 $e_{t|t} = x_t - \\hat{x}_{t|t}$ 与未来的噪声 $w_t$ 不相关，交叉项为零。因此，我们得到误差方差的时间更新方程：\n$$P_{t+1|t} = a^2 P_{t|t} + \\sigma_w^2$$\n\n$2$. 测量更新：\n在时刻 $t$，我们有方差为 $P_{t|t-1}$ 的*先验*估计 $\\hat{x}_{t|t-1}$ 和一个新的测量值 $y_t = x_t + v_t$。测量误差 $v_t$ 的方差为 $\\sigma_v^2$。最优线性最小二乘估计结合了这两个信息源。对于高斯分布，后验精度是先验精度之和。精度是方差的倒数。\n$$\\frac{1}{P_{t|t}} = \\frac{1}{P_{t|t-1}} + \\frac{1}{\\sigma_v^2}$$\n这就给出了误差方差的测量更新方程：\n$$P_{t|t} = \\left( \\frac{1}{P_{t|t-1}} + \\frac{1}{\\sigma_v^2} \\right)^{-1} = \\frac{P_{t|t-1} \\sigma_v^2}{P_{t|t-1} + \\sigma_v^2}$$\nKalman 增益 $L_t$ 由 $L_t = \\frac{P_{t|t-1}}{P_{t|t-1} + \\sigma_v^2}$ 给出。由此，我们还得到关系式 $P_{t|t} = L_t \\sigma_v^2$。\n\n$3$. 稳态分析：\n在稳态下，方差变为常数。令 $P = \\lim_{t\\to\\infty} P_{t|t}$ 且 $P^- = \\lim_{t\\to\\infty} P_{t|t-1}$。更新方程变成一个代数方程组：\n$$(1) \\quad P^- = a^2 P + \\sigma_w^2$$\n$$(2) \\quad P = \\frac{P^- \\sigma_v^2}{P^- + \\sigma_v^2}$$\n我们将 (1) 代入 (2) 以获得关于稳态后验方差 $P$ 的单个方程：\n$$P = \\frac{(a^2 P + \\sigma_w^2) \\sigma_v^2}{(a^2 P + \\sigma_w^2) + \\sigma_v^2}$$\n两边同乘以分母得到：\n$$P(a^2 P + \\sigma_w^2 + \\sigma_v^2) = (a^2 P + \\sigma_w^2) \\sigma_v^2$$\n$$a^2 P^2 + P\\sigma_w^2 + P\\sigma_v^2 = a^2 P\\sigma_v^2 + \\sigma_w^2\\sigma_v^2$$\n整理各项，得到该系统的离散代数 Riccati 方程：\n$$a^2 P^2 + (\\sigma_w^2 + \\sigma_v^2 - a^2\\sigma_v^2) P - \\sigma_w^2\\sigma_v^2 = 0$$\n$$a^2 P^2 + (\\sigma_w^2 + (1-a^2)\\sigma_v^2) P - \\sigma_w^2\\sigma_v^2 = 0$$\n\n$4$. 求解 Riccati 方程：\n这是一个关于 $P$ 的二次方程，形式为 $A_0 P^2 + B_0 P + C_0 = 0$，其系数为：\n$A_0 = a^2$\n$B_0 = \\sigma_w^2 + (1-a^2)\\sigma_v^2$\n$C_0 = -\\sigma_w^2\\sigma_v^2$\n$P$ 的解由二次公式给出：\n$$P = \\frac{-B_0 \\pm \\sqrt{B_0^2 - 4A_0C_0}}{2A_0}$$\n判别式为 $\\Delta = B_0^2 - 4(a^2)(-\\sigma_w^2\\sigma_v^2) = (\\sigma_w^2 + (1-a^2)\\sigma_v^2)^2 + 4a^2\\sigma_w^2\\sigma_v^2$。因为 $a \\neq 0$、$\\sigma_w^2 > 0$ 且 $\\sigma_v^2 > 0$，我们有 $\\Delta > 0$。\n由于 $P$ 代表方差，它必须是非负的。分母 $2a^2$ 是正的。项 $\\sqrt{\\Delta} = \\sqrt{B_0^2 + 4a^2\\sigma_w^2\\sigma_v^2} > |B_0|$。因此，分子 $-B_0 - \\sqrt{\\Delta}$ 总是负的。为确保 $P \\ge 0$，我们必须选择正根：\n$$P = \\frac{-(\\sigma_w^2 + (1-a^2)\\sigma_v^2) + \\sqrt{(\\sigma_w^2 + (1-a^2)\\sigma_v^2)^2 + 4a^2\\sigma_w^2\\sigma_v^2}}{2a^2}$$\n为简化此表达式的表示，我们可以对分子进行有理化：\n$$P = \\frac{-B_0 + \\sqrt{\\Delta}}{2A_0} \\times \\frac{-B_0 - \\sqrt{\\Delta}}{-B_0 - \\sqrt{\\Delta}} = \\frac{B_0^2 - \\Delta}{2A_0(-B_0 - \\sqrt{\\Delta})} = \\frac{-4A_0C_0}{2A_0(-B_0 - \\sqrt{\\Delta})} = \\frac{-2C_0}{-B_0 - \\sqrt{\\Delta}} = \\frac{2C_0}{B_0 + \\sqrt{\\Delta}}$$\n将系数代回：\n$$P = \\frac{2\\sigma_w^2\\sigma_v^2}{(\\sigma_w^2 + (1-a^2)\\sigma_v^2) + \\sqrt{(\\sigma_w^2 + (1-a^2)\\sigma_v^2)^2 + 4a^2\\sigma_w^2\\sigma_v^2}}$$\n\n$5$. 求 Kalman 增益 $L$：\n稳态增益 $L$ 与 $P$ 的关系为 $P = L \\sigma_v^2$。因此，$L = P/\\sigma_v^2$。\n$$L = \\frac{P}{\\sigma_v^2} = \\frac{2\\sigma_w^2}{(\\sigma_w^2 + (1-a^2)\\sigma_v^2) + \\sqrt{(\\sigma_w^2 + (1-a^2)\\sigma_v^2)^2 + 4a^2\\sigma_w^2\\sigma_v^2}}$$\n\n最终结果为数对 $(P, L)$。", "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{2\\sigma_w^2\\sigma_v^2}{(\\sigma_w^2 + (1-a^2)\\sigma_v^2) + \\sqrt{(\\sigma_w^2 + (1-a^2)\\sigma_v^2)^2 + 4a^2\\sigma_w^2\\sigma_v^2}} & \\frac{2\\sigma_w^2}{(\\sigma_w^2 + (1-a^2)\\sigma_v^2) + \\sqrt{(\\sigma_w^2 + (1-a^2)\\sigma_v^2)^2 + 4a^2\\sigma_w^2\\sigma_v^2}} \\end{pmatrix} } $$", "id": "2719584"}, {"introduction": "理论的深度最终要在实践中得到检验。对于大多数实际系统，代数Riccati方程过于复杂，无法手动求解。本练习旨在弥合解析理论与计算实践之间的鸿沟，你将运用数值工具为更复杂的系统设计LQR控制器和卡尔曼滤波器。这个练习强调了工程设计流程中的一个关键环节：验证所设计的闭环系统 $A-BK$ 和估计器动态 $A-LC$ 确实是稳定的，这也是对分离原理的直接检验。[@problem_id:2719583]", "problem": "考虑一个离散时间线性时不变系统，其状态更新和带噪声的测量由 $x_{k+1} = A x_k + B u_k + w_k$ 和 $y_k = C x_k + v_k$ 给出，其中 $x_k \\in \\mathbb{R}^n$，$u_k \\in \\mathbb{R}^m$，$y_k \\in \\mathbb{R}^p$。过程噪声 $w_k$ 和测量噪声 $v_k$ 是零均值、独立的高斯序列，其协方差分别为 $W \\succeq 0$ 和 $V \\succ 0$。对于具有二次性能指标 $J = \\sum_{k=0}^{\\infty} \\left( x_k^\\top Q x_k + u_k^\\top R u_k \\right)$ 的无限时域线性二次高斯（LQG）控制问题，其中 $Q \\succeq 0$ 且 $R \\succ 0$，确定性等价原理指出，最优控制器是状态反馈律 $u_k = -K \\hat{x}_k$，其中 $\\hat{x}_k$ 是由稳态卡尔曼滤波器生成的状态估计。控制器增益 $K$ 由用于控制问题的离散时间代数黎卡提方程（ARE）的稳定解 $P \\succeq 0$ 构建，而稳态卡尔曼滤波器增益 $L$ 由用于估计问题的对偶离散时间ARE的稳定解 $S \\succeq 0$ 构建。在标准的能稳性和能检测性假设下，闭环矩阵 $A - B K$ 必须是舒尔稳定的（所有特征值都严格位于单位圆内），并且估计误差动态矩阵 $A - L C$ 也必须是舒尔稳定的。您的任务是数值计算这些稳定解，并对每个解验证其舒尔特性。\n\n仅使用数学上可靠的事实作为出发点：离散时间系统的定义、二次成本、离散时间代数黎卡提方程的稳定解，以及线性二次高斯（LQG）框架中线性二次调节器（LQR）和稳态卡尔曼滤波器的定义。除明确给出的结构外，不要假设任何特殊结构。\n\n实现一个程序，对下面的每个测试用例执行以下步骤：\n- 数值计算用于控制问题的离散时间代数黎卡提方程的稳定解 $P$，并构建状态反馈增益 $K$。\n- 数值计算用于估计问题的对偶离散时间代数黎卡提方程的稳定解 $S$，并构建稳态卡尔曼增益 $L$。\n- 验证 $A - B K$ 的所有特征值的模都严格小于 $1$。\n- 验证 $A - L C$ 的所有特征值的模都严格小于 $1$。\n\n程序必须使用一个小的数值容差 $0 < \\varepsilon \\ll 1$ 来实现严格不等式，如果对于相关特征值 $\\{\\lambda_i\\}$ 满足 $\\max_i |\\lambda_i| < 1 - \\varepsilon$，则宣告稳定。\n\n测试套件：\n为以下三种情况提供结果。所有矩阵和标量均为实值。\n\n- 案例 $1$（不稳定的 $2 \\times 2$ 系统，单输入，单输出）：\n  - $A_1 = \\begin{bmatrix} 1.2 & 0.5 \\\\ 0 & 1.1 \\end{bmatrix}$，\n    $B_1 = \\begin{bmatrix} 1.0 \\\\ 0.3 \\end{bmatrix}$，\n    $Q_1 = \\begin{bmatrix} 1.0 & 0 \\\\ 0 & 1.0 \\end{bmatrix}$，\n    $R_1 = \\begin{bmatrix} 0.5 \\end{bmatrix}$，\n    $C_1 = \\begin{bmatrix} 1.0 & 0.0 \\end{bmatrix}$，\n    $W_1 = 0.1 \\cdot I_2$，\n    $V_1 = \\begin{bmatrix} 0.5 \\end{bmatrix}$。\n\n- 案例 $2$（不稳定的 $3 \\times 3$ 系统，全输入，全状态测量）：\n  - $A_2 = \\begin{bmatrix} 1.1 & 0.2 & 0.0 \\\\ 0.0 & 1.05 & 0.3 \\\\ 0.1 & 0.0 & 1.2 \\end{bmatrix}$，\n    $B_2 = I_3$，\n    $Q_2 = \\mathrm{diag}(2.0, 1.0, 3.0)$，\n    $R_2 = 0.8 \\cdot I_3$，\n    $C_2 = I_3$，\n    $W_2 = 0.05 \\cdot I_3$，\n    $V_2 = 0.2 \\cdot I_3$。\n\n- 案例 $3$（接近临界不稳定的 $2 \\times 2$ 系统，单输入，全状态测量）：\n  - $A_3 = \\begin{bmatrix} 1.000001 & 0.01 \\\\ 0.0 & 1.000001 \\end{bmatrix}$，\n    $B_3 = \\begin{bmatrix} 0.0 \\\\ 1.0 \\end{bmatrix}$，\n    $Q_3 = \\mathrm{diag}(0.0001, 1.0)$，\n    $R_3 = \\begin{bmatrix} 0.1 \\end{bmatrix}$，\n    $C_3 = I_2$，\n    $W_3 = 0.0001 \\cdot I_2$，\n    $V_3 = 0.001 \\cdot I_2$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。该列表必须按以下顺序包含六个布尔值：\n- 前三个条目：对于案例 $1$、$2$、$3$，$A - B K$ 的所有特征值是否都严格位于单位圆内。\n- 后三个条目：对于案例 $1$、$2$、$3$，$A - L C$ 的所有特征值是否都严格位于单位圆内。\n\n例如，输出应类似于 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5,\\text{result}_6]$，其中每个 $\\text{result}_i$ 是 $\\text{True}$ 或 $\\text{False}$。\n\n不涉及物理单位或角度单位，因此不需要单位转换。所有计算都必须进行数值计算，并采取适当的条件保障措施。输出必须是确定性的，并且不含随机性，可复现。", "solution": "所给出的问题是现代控制理论中的一个标准练习，特别是在离散时间线性时不变（LTI）系统的线性二次高斯（LQG）控制领域。在进行数值求解之前，必须建立计算所依据的理论基础。该问题在科学上是合理的、适定的，并包含了获得唯一解所需的所有必要信息。\n\n系统由以下状态空间方程描述：\n$$x_{k+1} = A x_k + B u_k + w_k$$\n$$y_k = C x_k + v_k$$\n其中 $w_k$ 和 $v_k$ 是独立的零均值高斯白噪声过程，其协方差矩阵分别为 $W \\succeq 0$ 和 $V \\succ 0$。\n\n目标是设计一个控制器，以最小化无限时域二次成本函数：\n$$J = \\sum_{k=0}^{\\infty} \\left( x_k^\\top Q x_k + u_k^\\top R u_k \\right)$$\n其中加权矩阵 $Q \\succeq 0$ 且 $R \\succ 0$。\n\nLQG 框架在确定性等价原理下，将问题分解为两个独立的部分：一个最优状态反馈控制器（线性二次调节器或 LQR）和一个最优状态估计器（卡尔曼滤波器）。\n\n首先，我们假设状态完全可用，设计 LQR 控制器。最优控制律是线性状态反馈 $u_k = -K x_k$。增益矩阵 $K$ 由用于控制的离散时间代数黎卡提方程（DARE）的唯一的、稳定的、半正定解 $P$ 决定：\n$$P = A^\\top P A - (A^\\top P B)(R + B^\\top P B)^{-1}(B^\\top P A) + Q$$\n如果系统对 $(A, B)$ 是能稳的，且系统对 $(A, \\sqrt{Q})$ 是能检测的，则保证存在这样一个稳定解 $P \\succeq 0$。最优反馈增益则计算如下：\n$$K = (R + B^\\top P B)^{-1} B^\\top P A$$\n得到的闭环系统动态 $x_{k+1} = (A - B K) x_k$ 保证是稳定的。也就是说，矩阵 $A - B K$ 是舒尔稳定的，即其所有特征值都严格位于复平面的单位圆内。\n\n其次，我们设计一个状态估计器。由于状态 $x_k$ 不是直接测量的，而是通过带噪声的测量 $y_k$ 观测到的，我们使用一个稳态卡尔曼滤波器来生成状态的最优估计 $\\hat{x}_k$。该滤波器的设计与 LQR 问题是对偶的。稳态预测误差协方差 $S$ 是用于估计的 DARE 的唯一的、稳定的、半正定解：\n$$S = A S A^\\top - A S C^\\top (V + C S C^\\top)^{-1} C S A^\\top + W$$\n如果系统对 $(A, \\sqrt{W})$ 是能稳的，且系统对 $(A, C)$ 是能检测的，则保证存在这样一个稳定解 $S \\succeq 0$。\n\n问题指定了按如下方式构建增益矩阵 $L$：\n$$L = S C^\\top (V + C S C^\\top)^{-1}$$\n这个增益 $L$ 被称为卡尔曼校正增益。标准卡尔曼滤波理论指出，矩阵 $A(I - LC)$（等价于 $A - L_p C$，其中 $L_p = AL$ 是预测器增益）的特征值决定了误差动态，并且严格位于单位圆内。然而，问题要求我们验证矩阵 $A - LC$ 的舒尔稳定性。该矩阵出现在形式为 $\\hat{x}_{k+1} = A\\hat{x}_k + Bu_k + L(y_k - C\\hat{x}_k)$ 的龙伯格式观测器的动态中，其误差动态由 $e_{k+1} = (A - LC)e_k$ 描述。我们将按指令进行数值验证。\n\n任务是为三个不同的测试用例数值求解 $P$ 和 $S$，计算相应的增益 $K$ 和 $L$，然后验证矩阵 $A - B K$ 和 $A - L C$ 的舒尔稳定性。稳定性检查通过计算各个矩阵的特征值 $\\{\\lambda_i\\}$ 并确保对于一个小的容差 $\\varepsilon > 0$，有 $\\max_i |\\lambda_i| < 1 - \\varepsilon$ 来执行。我们将使用 $\\varepsilon = 10^{-9}$。所有提供的测试用例都满足所需的能稳性和能检测性条件，从而确保黎卡提方程的稳定解存在。\n\n每个测试用例的计算步骤如下：\n1.  使用给定的矩阵 $A$、$B$、$Q$ 和 $R$，求解控制 DARE 以得到 $P$。\n2.  计算控制增益 $K$ 并验证矩阵 $A - B K$ 是否为舒尔稳定。\n3.  通过应用对偶原理求解估计 DARE 以得到 $S$，即代入 $A \\to A^\\top$、$B \\to C^\\top$、$Q \\to W$ 和 $R \\to V$ 来求解控制 DARE。\n4.  计算滤波器增益 $L$ 并验证矩阵 $A - L C$ 是否为舒尔稳定。\n5.  这些验证的结果（布尔值）被收集并以要求的格式呈现。", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_discrete_are\n\ndef solve():\n    \"\"\"\n    Solves for LQR and Kalman gains for given systems and verifies\n    the stability of the resulting closed-loop and observer dynamics.\n    \"\"\"\n    epsilon = 1e-9\n\n    # Case 1 (unstable 2x2 system, single input, single output)\n    A1 = np.array([[1.2, 0.5], [0, 1.1]])\n    B1 = np.array([[1.0], [0.3]])\n    Q1 = np.array([[1.0, 0], [0, 1.0]])\n    R1 = np.array([[0.5]])\n    C1 = np.array([[1.0, 0.0]])\n    W1 = 0.1 * np.identity(2)\n    V1 = np.array([[0.5]])\n\n    # Case 2 (unstable 3x3 system, full input, full state measurement)\n    A2 = np.array([[1.1, 0.2, 0.0], [0.0, 1.05, 0.3], [0.1, 0.0, 1.2]])\n    B2 = np.identity(3)\n    Q2 = np.diag([2.0, 1.0, 3.0])\n    R2 = 0.8 * np.identity(3)\n    C2 = np.identity(3)\n    W2 = 0.05 * np.identity(3)\n    V2 = 0.2 * np.identity(3)\n\n    # Case 3 (nearly marginally unstable 2x2 system, single input, full state measurement)\n    A3 = np.array([[1.000001, 0.01], [0.0, 1.000001]])\n    B3 = np.array([[0.0], [1.0]])\n    Q3 = np.diag([0.0001, 1.0])\n    R3 = np.array([[0.1]])\n    C3 = np.identity(2)\n    W3 = 0.0001 * np.identity(2)\n    V3 = 0.001 * np.identity(2)\n\n    test_cases = [\n        (A1, B1, Q1, R1, C1, W1, V1),\n        (A2, B2, Q2, R2, C2, W2, V2),\n        (A3, B3, Q3, R3, C3, W3, V3)\n    ]\n\n    k_stability_results = []\n    l_stability_results = []\n\n    for A, B, Q, R, C, W, V in test_cases:\n        # --- LQR Controller Analysis ---\n        # Solve the discrete-time Algebraic Riccati Equation for P\n        P = solve_discrete_are(A, B, Q, R)\n\n        # Compute the LQR gain K\n        inv_term_K = np.linalg.inv(R + B.T @ P @ B)\n        K = inv_term_K @ (B.T @ P @ A)\n        \n        # Form the closed-loop matrix A - BK\n        A_cl = A - B @ K\n        \n        # Check if A - BK is Schur stable\n        eigs_K = np.linalg.eigvals(A_cl)\n        is_stable_K = np.max(np.abs(eigs_K))  1.0 - epsilon\n        k_stability_results.append(is_stable_K)\n\n        # --- Kalman Filter Analysis ---\n        # Solve the dual DARE for S\n        # This is done by solving for A.T, C.T, W, V\n        S = solve_discrete_are(A.T, C.T, W, V)\n        \n        # Compute the Kalman gain L\n        inv_term_L = np.linalg.inv(V + C @ S @ C.T)\n        L = (S @ C.T) @ inv_term_L\n        \n        # Form the estimator dynamics matrix A - LC\n        A_est = A - L @ C\n        \n        # Check if A - LC is Schur stable\n        eigs_L = np.linalg.eigvals(A_est)\n        is_stable_L = np.max(np.abs(eigs_L))  1.0 - epsilon\n        l_stability_results.append(is_stable_L)\n        \n    final_results = k_stability_results + l_stability_results\n    \n    print(f\"[{','.join(str(r) for r in final_results).replace('True', 'True').replace('False', 'False')}]\")\n```", "id": "2719583"}]}