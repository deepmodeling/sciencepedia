{"hands_on_practices": [{"introduction": "直接求解复杂结构的控制微分方程通常很困难。最小势能原理不仅为我们提供了理论基础，还引出了一系列强大的近似方法，其中 Rayleigh-Ritz 方法是核心技术之一。本练习将引导你将该方法应用于一个经典的悬臂梁问题，通过构造势能泛函并针对近似位移场中的待定系数进行最小化，从而获得结构的近似解。这个过程将加深你对能量最小化如何转化为具体求解步骤的理解。", "problem": "一根长度为 $L$、常数抗弯刚度为 $E I$ 的细长、等截面、线性弹性 Euler–Bernoulli 梁，其在 $x=0$ 处被固定，在 $x=L$ 处为自由端。一个大小为 $P$ 的静态集中荷载在 $x=L$ 处垂直向下作用。假设小挠度且线性化运动学有效。使用最小势能原理和 Rayleigh–Ritz 降阶模型，通过双参数容许形式来近似横向挠度场 $w(x)$\n$$\nw(x)=a\\,\\phi_{1}(x)+b\\,\\phi_{2}(x), \\quad \\phi_{1}(x)=\\left(\\frac{x}{L}\\right)^{2}, \\quad \\phi_{2}(x)=\\left(\\frac{x}{L}\\right)^{3},\n$$\n该形式对于任意系数 $a$ 和 $b$ 均满足在固定端的本质边界条件 $w(0)=0$ 和 $w'(0)=0$。\n\n从弯曲应变能和外力功的基本定义出发，构建总势能泛函，强制其对于系数 $a$ 和 $b$ 的驻定性，并确定由此得到的端点挠度 $w(L)$ 的 Rayleigh–Ritz 近似解。\n\n请以 $P$、$E$、$I$ 和 $L$ 的闭式解析表达式形式给出最终答案。不要计算任何数值，最终表达式中也不要包含单位。", "solution": "**求解推导**\n最小势能原理指出，对于处于稳定平衡状态的保守系统，其总势能 $\\Pi$ 对于容许的运动学变分是驻定的。总势能是内部应变能 $U$ 和外荷载势能 $W_{ext}$ 的和。\n$$\n\\Pi = U + W_{ext}\n$$\n在小挠度假设下，Euler-Bernoulli 梁的应变能 $U$ 由下式给出：\n$$\nU = \\frac{1}{2} \\int_{0}^{L} EI [w''(x)]^2 dx\n$$\n其中 $w''(x)$ 是梁的曲率。作用在 $x=L$ 处的外部集中荷载 $P$ 的势能为：\n$$\nW_{ext} = -P w(L)\n$$\n近似挠度场由 $w(x) = a\\left(\\frac{x}{L}\\right)^2 + b\\left(\\frac{x}{L}\\right)^3$ 给出。我们首先计算其二阶导数 $w''(x)$：\n$$\nw'(x) = \\frac{d}{dx}\\left[a\\frac{x^2}{L^2} + b\\frac{x^3}{L^3}\\right] = a\\frac{2x}{L^2} + b\\frac{3x^2}{L^3}\n$$\n$$\nw''(x) = \\frac{d}{dx}\\left[a\\frac{2x}{L^2} + b\\frac{3x^2}{L^3}\\right] = a\\frac{2}{L^2} + b\\frac{6x}{L^3}\n$$\n现在，我们将 $w''(x)$ 代入应变能 $U$ 的表达式中：\n$$\nU = \\frac{1}{2} \\int_{0}^{L} EI \\left( \\frac{2a}{L^2} + \\frac{6bx}{L^3} \\right)^2 dx\n$$\n展开被积函数：\n$$\nU = \\frac{EI}{2} \\int_{0}^{L} \\left( \\frac{4a^2}{L^4} + \\frac{24abx}{L^5} + \\frac{36b^2x^2}{L^6} \\right) dx\n$$\n对 $x$ 在 $0$ 到 $L$ 的区间上进行积分：\n$$\nU = \\frac{EI}{2} \\left[ \\frac{4a^2x}{L^4} + \\frac{24abx^2}{2L^5} + \\frac{36b^2x^3}{3L^6} \\right]_{0}^{L}\n$$\n$$\nU = \\frac{EI}{2} \\left( \\frac{4a^2L}{L^4} + \\frac{12abL^2}{L^5} + \\frac{12b^2L^3}{L^6} \\right) = \\frac{EI}{2L^3} (4a^2 + 12ab + 12b^2)\n$$\n$$\nU = \\frac{EI}{L^3} (2a^2 + 6ab + 6b^2)\n$$\n接下来，我们确定外荷载的势能。端点 $x=L$ 处的挠度为：\n$$\nw(L) = a\\left(\\frac{L}{L}\\right)^2 + b\\left(\\frac{L}{L}\\right)^3 = a+b\n$$\n因此，荷载的势能为：\n$$\nW_{ext} = -P w(L) = -P(a+b)\n$$\n总势能 $\\Pi$ 是未知系数 $a$ 和 $b$ 的函数：\n$$\n\\Pi(a,b) = U + W_{ext} = \\frac{EI}{L^3} (2a^2 + 6ab + 6b^2) - P(a+b)\n$$\n为了求出 $a$ 和 $b$ 的平衡值，我们通过对 $\\Pi$ 分别求关于 $a$ 和 $b$ 的偏导数并令其为零来强制执行驻定条件：\n$$\n\\frac{\\partial \\Pi}{\\partial a} = \\frac{EI}{L^3}(4a + 6b) - P = 0 \\quad \\implies \\quad 4a + 6b = \\frac{PL^3}{EI}\n$$\n$$\n\\frac{\\partial \\Pi}{\\partial b} = \\frac{EI}{L^3}(6a + 12b) - P = 0 \\quad \\implies \\quad 6a + 12b = \\frac{PL^3}{EI}\n$$\n这给了我们一个关于 $a$ 和 $b$ 的二元一次方程组：\n1. $4a + 6b = \\frac{PL^3}{EI}$\n2. $6a + 12b = \\frac{PL^3}{EI}$\n\n为了解这个方程组，我们可以将第一个方程乘以 $2$：\n3. $8a + 12b = \\frac{2PL^3}{EI}$\n\n从这个新方程 (3) 中减去第二个方程，可以消去 $b$：\n$$\n(8a + 12b) - (6a + 12b) = \\frac{2PL^3}{EI} - \\frac{PL^3}{EI}\n$$\n$$\n2a = \\frac{PL^3}{EI} \\quad \\implies \\quad a = \\frac{PL^3}{2EI}\n$$\n将 $a$ 的这个结果代回第一个方程中：\n$$\n4\\left(\\frac{PL^3}{2EI}\\right) + 6b = \\frac{PL^3}{EI}\n$$\n$$\n\\frac{2PL^3}{EI} + 6b = \\frac{PL^3}{EI}\n$$\n$$\n6b = \\frac{PL^3}{EI} - \\frac{2PL^3}{EI} = -\\frac{PL^3}{EI}\n$$\n$$\nb = -\\frac{PL^3}{6EI}\n$$\n问题要求的是端点挠度 $w(L)$，它由 $w(L) = a+b$ 给出。\n$$\nw(L) = \\frac{PL^3}{2EI} + \\left(-\\frac{PL^3}{6EI}\\right) = \\frac{3PL^3 - PL^3}{6EI} = \\frac{2PL^3}{6EI}\n$$\n$$\nw(L) = \\frac{PL^3}{3EI}\n$$\n这个结果是自由端受点荷载的悬臂梁端点挠度的精确解。所选择的试函数能够表示精确的挠度分布，因此 Rayleigh-Ritz 法正确地确定了精确的系数。", "answer": "$$\\boxed{\\frac{P L^{3}}{3 E I}}$$", "id": "2675671"}, {"introduction": "最小势能原理不仅能确定平衡构型，更能揭示其稳定性。一个平衡点是稳定的（局部极小值）还是不稳定的，取决于势能的二阶变分。本练习将通过经典的欧拉屈曲问题，让你深入探索稳定性的概念。你将分析在不同轴向压力 $P$ 下，直杆构型的势能二阶变分如何从正定变为半正定，从而理解失稳和分岔现象的能量判据。", "problem": "一根长度为$L$、具有恒定抗弯刚度$E I$的初始笔直、细长、棱柱形弹性柱，其在$x=0$和$x=L$处为铰接（简支）支座。该柱承受一个保守的、与构型无关的轴向压缩恒定死荷载$P$，该荷载作用于两端，并沿未变形柱的轴线施加。允许存在微小横向挠度$w(x)$，且标准的小斜坡近似有效。假设柱的弯曲能为线性弹性的，并使用几何精确的弧长来计算端部缩短，且一致地线性化到适当的阶数。\n\n仅使用弹性力学和功能平衡的基本定义、驻定势能原理以及二次变分稳定性判据，判断下列陈述哪些是正确的。选择所有适用的选项。\n\nA. 对于所述的恒定死荷载问题，对于所有$P \\ge 0$，笔直构型$w(x)\\equiv 0$都是总势能的一个驻点，但它是一个严格局部极小值点当且仅当$P<P_{\\mathrm{cr}}$，其中$P_{\\mathrm{cr}}=\\dfrac{\\pi^2 E I}{L^2}$。\n\nB. 在$w\\equiv 0$处的总势能的二次变分为$$\\delta^2 \\Pi[0;\\eta]=\\displaystyle \\int_0^L \\big(E I\\,\\eta''(x)^2+P\\,\\eta'(x)^2\\big)\\,dx$$（对于所有容许变分$\\eta$），因此对于所有$P>0$它都是正定的，且笔直构型总是稳定的。\n\nC. 当$P=P_{\\mathrm{cr}}$时，在$w\\equiv 0$处的二次变分是半正定的，具有一个由$\\eta(x)=\\sin\\!\\big(\\dfrac{\\pi x}{L}\\big)$张成的一维零空间，这表明此时为中性稳定和一个分岔点。\n\nD. 如果轴向荷载改为一个大小相同但为$P$的跟随力（始终与变形后的轴线相切），那么可以保证存在一个标量总势能泛函，并且同样的驻定性和二次变分结论将保持不变。\n\nE. 如果不指定恒定死荷载$P$，而是指定总端部缩短$\\Delta=\\Delta_0$，并通过拉格朗日乘子法，在满足此约束的条件下最小化内部应变能来寻求平衡态，那么该乘子等于平衡时的轴向力，并且二次变分稳定性检验会在相同的临界值$P_{\\mathrm{cr}}=\\dfrac{\\pi^2 E I}{L^2}$处检测到屈曲的开始。", "solution": "**总势能泛函的推导**\n\n总势能$\\Pi$是内部应变能$U$和外荷载势能$\\Omega$之和。\n$$ \\Pi[w] = U[w] + \\Omega[w] $$\n在小斜坡近似下，曲率$\\kappa \\approx w''(x)$，由弯曲引起的内部应变能为：\n$$ U[w] = \\frac{1}{2} \\int_0^L EI (\\kappa(x))^2 dx = \\frac{1}{2} \\int_0^L EI (w''(x))^2 dx $$\n外加恒定死荷载$P$的势能是$\\Omega[w] = -P \\Delta$，其中$\\Delta$是由于弯曲引起的柱的轴向缩短。功是由力$P$在该距离上所做的。缩短量$\\Delta$是变形后曲线的弧长与初始长度$L$之差。对于小斜坡，弧长$s$近似为：\n$$ s = \\int_0^L \\sqrt{1 + (w'(x))^2} dx \\approx \\int_0^L \\left(1 + \\frac{1}{2}(w'(x))^2\\right) dx = L + \\frac{1}{2} \\int_0^L (w'(x))^2 dx $$\n因此，缩短量为$\\Delta = s - L = \\frac{1}{2} \\int_0^L (w'(x))^2 dx$。\n荷载的势能为：\n$$ \\Omega[w] = -\\frac{P}{2} \\int_0^L (w'(x))^2 dx $$\n将这些合并，总势能泛函为：\n$$ \\Pi[w] = \\frac{1}{2} \\int_0^L \\left( EI (w''(x))^2 - P (w'(x))^2 \\right) dx $$\n平衡构型是$\\Pi$的驻点，这意味着对于所有容许变分$\\eta$（由于铰接支座，$\\eta(0)=\\eta(L)=0$），一阶变分$\\delta \\Pi[w; \\eta]$必须为零。如果一个构型对应于$\\Pi$的局部最小值，则该构型是稳定的，这通过二阶变分$\\delta^2 \\Pi$来检验。\n\n平凡构型$w(x) \\equiv 0$总是一个平衡态，因为$\\Pi[0] = 0$，并且$\\Pi$的欧拉-拉格朗日方程$EI w'''' + P w'' = 0$被平凡地满足。\n\n平凡状态的稳定性由在$w \\equiv 0$处计算的$\\Pi$的二次变分的符号决定：\n$$ \\delta^2 \\Pi[0; \\eta] = \\frac{d^2}{d\\epsilon^2} \\Pi[\\epsilon\\eta] \\Big|_{\\epsilon=0} = \\int_0^L \\left( EI (\\eta''(x))^2 - P (\\eta'(x))^2 \\right) dx $$\n如果对于所有容许的$\\eta \\not\\equiv 0$，$\\delta^2 \\Pi[0; \\eta] > 0$，则平凡状态是稳定的（一个严格局部极小值点）。\n\n**选项评估**\n\n**选项 A：** “对于所述的恒定死荷载问题，对于所有$P \\ge 0$，笔直构型$w(x)\\equiv 0$都是总势能的一个驻点，但它是一个严格局部极小值点当且仅当$P<P_{\\mathrm{cr}}$，其中$P_{\\mathrm{cr}}=\\dfrac{\\pi^2 E I}{L^2}$。”\n\n如前所述，$w(x) \\equiv 0$总是一个驻点。为了检验是否为极小值点，我们分析$\\delta^2 \\Pi[0; \\eta]$的符号。我们可以将任何容许变分$\\eta(x)$展开为傅里叶正弦级数：$\\eta(x) = \\sum_{n=1}^\\infty a_n \\sin(\\frac{n\\pi x}{L})$。将此代入$\\delta^2 \\Pi$的表达式并使用正交关系，得到：\n$$ \\delta^2 \\Pi[0; \\eta] = \\frac{L}{2} \\sum_{n=1}^\\infty a_n^2 \\left( EI \\left(\\frac{n\\pi}{L}\\right)^4 - P \\left(\\frac{n\\pi}{L}\\right)^2 \\right) = \\frac{L}{2} \\sum_{n=1}^\\infty a_n^2 \\left(\\frac{n\\pi}{L}\\right)^2 \\left( EI \\left(\\frac{n\\pi}{L}\\right)^2 - P \\right) $$\n为了使$\\delta^2 \\Pi$对于任何系数$a_n$（不全为零）的选择都为正，括号中的项必须对所有$n \\ge 1$都为正。该项在$n=1$时最小。因此，我们需要：\n$$ EI \\left(\\frac{\\pi}{L}\\right)^2 - P > 0 \\implies P < \\frac{\\pi^2 EI}{L^2} $$\n令$P_{\\mathrm{cr}} = \\frac{\\pi^2 EI}{L^2}$，笔直构型成为严格局部极小值点的条件是$P < P_{\\mathrm{cr}}$。这是一个“当且仅当”的条件。如果$P \\ge P_{\\mathrm{cr}}$，二次变分不是正定的，因此它不是严格局部极小值点。该陈述完全正确。\n**结论：正确**\n\n**选项 B：** “在$w\\equiv 0$处的总势能的二次变分为$\\delta^2 \\Pi[0;\\eta]=\\displaystyle \\int_0^L \\big(E I\\,\\eta''(x)^2+P\\,\\eta'(x)^2\\big)\\,dx$（对于所有容许变分$\\eta$），因此对于所有$P>0$它都是正定的，且笔直构型总是稳定的。”\n\n我们的推导表明，二次变分是$\\delta^2 \\Pi[0; \\eta] = \\int_0^L \\left( EI (\\eta'')^2 - P (\\eta')^2 \\right) dx$。该陈述错误地将含$P$的项的符号表示为正。压缩荷载$P$会降低系统相对于横向挠度的刚度，因此应为负号。给定的公式是错误的。如果该公式正确，对于$P>0$，被积函数将是非负项之和，使得泛函正定，从而错误地暗示柱在压缩下总是稳定的。\n**结论：错误**\n\n**选项 C：** “当$P=P_{\\mathrm{cr}}$时，在$w\\equiv 0$处的二次变分是半正定的，具有一个由$\\eta(x)=\\sin\\!\\big(\\dfrac{\\pi x}{L}\\big)$张成的一维零空间，这表明此时为中性稳定和一个分岔点。”\n\n当$P = P_{\\mathrm{cr}} = \\frac{\\pi^2 EI}{L^2}$时，二次变分的表达式变为：\n$$ \\delta^2 \\Pi[0; \\eta] = \\frac{L}{2} \\sum_{n=1}^\\infty a_n^2 \\left(\\frac{n\\pi}{L}\\right)^2 \\left( EI \\left(\\frac{n\\pi}{L}\\right)^2 - \\frac{\\pi^2 EI}{L^2} \\right) = \\frac{L}{2} \\frac{\\pi^2 EI}{L^2} \\sum_{n=1}^\\infty a_n^2 \\left(\\frac{n\\pi}{L}\\right)^2 (n^2 - 1) $$\n对于$n=1$，项$(n^2 - 1)$为零。对于所有$n>1$，$(n^2 - 1) > 0$。因此，对于任何变分，$\\delta^2 \\Pi[0; \\eta] \\ge 0$，使其成为半正定的。等式$\\delta^2 \\Pi = 0$成立当且仅当对于所有$n>1$， $a_n=0$。这意味着零空间（使得$\\delta^2 \\Pi = 0$的变分集合）由形如$\\eta(x) = a_1 \\sin(\\frac{\\pi x}{L})$的函数组成。这是一个由$\\sin(\\frac{\\pi x}{L})$张成的一维空间。此条件表示中性稳定，并且是静态分岔点的数学标志，在该点上出现了一条新的、非平凡的平衡路径（屈曲形状）。\n**结论：正确**\n\n**选项 D：** “如果轴向荷载改为一个大小相同但为$P$的跟随力（始终与变形后的轴线相切），那么可以保证存在一个标量总势能泛函，并且同样的驻定性和二次变分结论将保持不变。”\n\n存在标量势能泛函的一个基本要求是所有外力都必须是保守的。根据定义，跟随力会根据物体的构型（变形）改变其方向。这种与构型相关的力是非保守的。因此，对于跟随力问题，不存在标量总势能。驻定势能原理和相关的二次变分稳定性检验是不适用的。此类系统的稳定性必须通过非保守方法进行研究，例如动力学形式的虚功原理（拉格朗日运动方程）。由此产生的稳定性问题（Beck问题）会得到不同的临界荷载（$P_{cr} \\approx 20.05 EI/L^2$）和不同的失稳机制（颤振），而不是静态分岔。\n**结论：错误**\n\n**选项 E：** “如果不指定恒定死荷载$P$，而是指定总端部缩短$\\Delta=\\Delta_0$，并通过拉格朗日乘子法，在满足此约束的条件下最小化内部应变能来寻求平衡态，那么该乘子等于平衡时的轴向力，并且二次变分稳定性检验会在相同的临界值$P_{\\mathrm{cr}}=\\dfrac{\\pi^2 E I}{L^2}$处检测到屈曲的开始。”\n\n这描述了从荷载控制问题到到位移控制问题的转换。问题变为：在约束$g[w] \\equiv \\frac{1}{2} \\int_0^L (w'(x))^2 dx - \\Delta_0 = 0$下，求$U[w]$的驻点。我们构建增广泛函（拉格朗日量）$L[w, \\lambda] = U[w] - \\lambda g[w]$。\n$$ L[w, \\lambda] = \\frac{1}{2} \\int_0^L EI (w''(x))^2 dx - \\lambda \\left( \\frac{1}{2} \\int_0^L (w'(x))^2 dx - \\Delta_0 \\right) $$\n将关于$w$的一阶变分设为零，即$\\delta_w L = 0$，得到欧拉-拉格朗日方程：$EI w'''' + \\lambda w'' = 0$。将此与荷载控制情况下的平衡方程（$EI w'''' + P w'' = 0$）进行比较，我们将拉格朗日乘子$\\lambda$等同于轴向力$P$。这是一个普遍的结果：乘子是与约束共轭的广义力。\n当平凡解不再是应变能的约束极小值时，稳定性丧失。这发生在拉格朗日量的二次变分$\\delta^2 L = \\int_0^L (EI (\\eta'')^2 - \\lambda (\\eta')^2) dx$不再对所有与（线性化）约束兼容的容许变分$\\eta$为正时。临界条件是当$\\delta^2 L$对于某个非平凡的$\\eta$首次变为零时。这导出了关于$\\lambda$的特征值问题：$\\lambda = \\min_{\\eta} \\frac{\\int_0^L EI (\\eta'')^2 dx}{\\int_0^L (\\eta')^2 dx}$。对于第一阶模态形状$\\eta(x) = \\sin(\\frac{\\pi x}{L})$，可以获得最小值，得到$\\lambda_{\\mathrm{cr}} = \\frac{\\pi^2 EI}{L^2}$。由于$\\lambda=P$，临界荷载与荷载控制情况下的临界荷载相同。对于保守系统，这种等价性是预料之中的。\n**结论：正确**", "answer": "$$\\boxed{ACE}$$", "id": "2675668"}, {"introduction": "将能量最小化思想推广到现代计算力学中，可以解决许多包含不等式约束的复杂问题，例如接触。当一个物体与刚性障碍物接触时，其位移受到单边约束，即 $u(L) \\le g$。本练习旨在演示如何将这一物理约束转化为一个带不等式约束的势能最小化问题，并引出其在离散化后所对应的卡鲁什-库恩-塔克 (KKT) 条件。通过编写代码解决这个问题，你将亲身体验变分原理如何为复杂的非线性问题（如接触）的数值求解提供坚实的理论基础。", "problem": "给定一根长度为 $L$、横截面积恒为 $A$、杨氏模量为 $E$ 的一维线弹性杆。该杆的左端（$x=0$）被固定，右端（$x=L$）承受一个集中的轴向力 $P$。右端可能与一个刚性挡块发生无摩擦的单边接触，该挡块与杆的固定构型之间存在一个间隙 $g$，这施加了单边运动学约束 $u(L) \\le g$，其中 $u(x)$ 是沿杆的轴向位移场。假设小应变、小位移和线弹性行为。\n\n根据最小势能原理，在所有运动学容许场中，真实的位移场 $u(x)$ 使总势能最小化。设应变能密度为 $W(\\varepsilon) = \\tfrac{1}{2} E \\varepsilon^2$，应变为 $\\varepsilon = du/dx$，外力势为 $-P\\,u(L)$。在存在 $x=L$ 处的单边约束时，最小化是在所有满足 $u(0)=0$ 和 $u(L)\\le g$ 的 $u(x)$ 上进行的。这会导出一个变分不等式以及相关的带有非负接触乘子的 Karush–Kuhn–Tucker (KKT) 条件。\n\n任务：使用 $N$ 个均匀的双节点轴向有限元对杆进行离散化，节点位移为 $\\{u_i\\}_{i=0}^{N}$，其中 $u_0 = 0$ 是固定的。使用线性形函数和单元长度 $h=L/N$ 组装全局刚度矩阵 $K \\in \\mathbb{R}^{(N+1)\\times(N+1)}$，每个单元刚度为 $k_e = \\dfrac{EA}{h}\\begin{bmatrix}1 & -1\\\\ -1 & 1\\end{bmatrix}$。设全局力向量为 $f \\in \\mathbb{R}^{N+1}$，其中 $f_N = P$，其余元素为零。将离散总势能定义为\n$$\n\\Pi(u) = \\tfrac{1}{2}\\,u^\\top K u - f^\\top u,\n$$\n其中 $u = (u_0,\\dots,u_N)^\\top$，容许性要求 $u_0 = 0$ 和 $u_N \\le g$。\n\n对于每个指定的测试用例，您的程序必须计算一个三元组，包括：\n- 以米为单位的杆端位移 $u_N$，\n- 指示单边约束是否激活的布尔接触状态（如果 $u_N$ 因接触反力而被强制等于 $g$，则为 true；否则为 false），以及\n- 以牛顿为单位的接触反力 $\\,\\lambda\\,$，定义为 KKT 条件中与不等式 $u_N \\le g$ 相关的非负拉格朗日乘子。使用符号约定，其中平衡条件为 $K u - f + \\lambda e_N = 0$，其中 $e_N$ 是对应于杆端自由度的标准单位向量。在此约定下，反力由收敛的位移计算得出，即 $\\lambda = f_N - (K u)_N$，并且在接触激活时必须满足 $\\lambda \\ge 0$，在接触未激活时 $\\lambda = 0$。\n\n您的算法必须基于以下基本原理：\n- 线性运动学 $\\varepsilon = du/dx$ 和 Hooke 定律 $\\sigma = E \\varepsilon$，\n- 最小势能原理，导出凸二次最小化问题，\n- 单边接触建模为不等式约束 $u_N \\le g$，带有非负乘子 $\\lambda$，这意味着互补条件 $u_N \\le g$、$\\lambda \\ge 0$ 和 $\\lambda\\,(u_N - g) = 0$。\n\n不要在您的实现中使用任何预先推导的快捷公式；相反，应组装 $K$ 和 $f$，施加 $u_0=0$ 约束，并使用数学上可靠的方法（例如，一个小型活动集检查方法，该方法首先求解无约束的简化系统，测试 $u_N$ 处的不等式，如果违反，则强制 $u_N = g$ 并重新计算状态和反力）来解决在杆端带有单边约束的凸二次规划问题。\n\n数值说明：\n- 所有输入和输出均采用国际单位制 (SI)：$L$ 的单位是米， $A$ 的单位是平方米，$E$ 的单位是帕斯卡，$P$ 和 $\\lambda$ 的单位是牛顿，$g$ 和位移的单位是米。\n- 将杆端位移（单位：米）和接触反力（单位：牛顿）表示为浮点数。接触状态必须是布尔值。\n- 不包括角度。本问题不涉及百分比。\n- 在比较不等式 $u_N \\le g$ 以判断接触是否激活时，使用数值公差 $\\,\\tau = 10^{-12}\\,$。\n\n测试套件：\n为以下四种情况提供解决方案，每种情况以元组 $(E, A, L, N, P, g)$ 的形式给出：\n1. $(7.0\\times 10^{10},\\, 1.0\\times 10^{-4},\\, 2.0,\\, 5,\\, 3.0\\times 10^{3},\\, 1.0\\times 10^{-2})$,\n2. $(7.0\\times 10^{10},\\, 1.0\\times 10^{-4},\\, 2.0,\\, 5,\\, 3.0\\times 10^{3},\\, 1.0\\times 10^{-4})$,\n3. $(7.0\\times 10^{10},\\, 1.0\\times 10^{-4},\\, 2.0,\\, 5,\\, 3.0\\times 10^{3},\\, 8.571428571428572\\times 10^{-4})$,\n4. $(7.0\\times 10^{10},\\, 1.0\\times 10^{-4},\\, 2.0,\\, 5,\\, 0.0,\\, 1.0\\times 10^{-4})$.\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个逗号分隔的四个结果列表，与测试套件的顺序相同，并用方括号括起来。每个结果本身必须是一个列表，顺序为 $[u_N,\\, \\text{contact\\_active},\\, \\lambda]$。例如，输出格式必须类似于\n\"[ [u1,True,lambda1],[u2,False,lambda2],[u3,True,lambda3],[u4,False,lambda4] ]\"\n但用实际的数值和布尔值代替占位符。", "solution": "用户提供的问题是计算固体力学中的一个适定场景，具体涉及带有单边接触约束的一维线弹性杆。该问题具有科学依据，内部一致，并包含获得唯一解所需的所有必要信息。因此，该问题被认定为有效，并将提供完整的解答。\n\n如问题陈述中所述，求解方法遵循有限元法 (FEM) 并结合活动集策略来处理单边接触约束。最小势能原理为该方法提供了理论基础。离散系统的总势能 $\\Pi(u)$ 是节点位移 $u$ 的一个二次函数，必须在运动学约束 $u_0=0$ 和 $u_N \\le g$ 的条件下将其最小化。\n\n首先，我们将长度为 $L$ 的杆离散化为 $N$ 个均匀的线性有限元。每个单元的长度为 $h=L/N$。这产生一个包含 $N+1$ 个节点的系统，节点索引从 $0$ 到 $N$，对应的轴向位移为 $u_0, u_1, \\dots, u_N$。双节点杆单元的单元刚度矩阵 $k_e$ 由下式给出：\n$$\nk_e = \\frac{EA}{h}\\begin{bmatrix} 1 & -1 \\\\ -1 & 1 \\end{bmatrix}\n$$\n其中 $E$ 是杨氏模量，$A$ 是横截面积。通过遍历所有单元并将其贡献累加到相应的全局自由度上，来组装全局刚度矩阵 $K \\in \\mathbb{R}^{(N+1)\\times(N+1)}$。\n\n全局外力向量 $f \\in \\mathbb{R}^{N+1}$ 是通过考虑施加在杆尖端（节点 $N$）的集中力 $P$ 来构建的。这会得到一个除了 $f_N = P$ 外所有分量均为零的向量。\n\n本质边界条件 $u_0=0$ 通过对方程组进行分区来处理。我们将自由度分为已知（或指定的）和未知。初始时，只有 $u_0$ 是已知的。方程组 $Ku=f$ 被简化为一个只涉及未知位移 $u_1, \\dots, u_N$ 的更小的系统。设 $u_R = [u_1, \\dots, u_N]^T$ 为自由位移向量。简化后的系统为 $K_{RR} u_R = f_R$，其中 $K_{RR}$ 是 $K$ 中对应于自由自由度（DOFs）的子矩阵，$f_R$ 是 $f$ 中对应的子向量。\n\n问题的核心是杆尖端节点的单边接触约束 $u_N \\le g$。这个不等式通过一个简单而稳健的活动集方法来管理，该方法包括两个主要阶段：\n\n1.  **试探步骤（假设无接触）：** 首先，我们假设约束未激活（$\\lambda=0$）来求解问题。求解简化的线性系统 $K_{RR} u_R = f_R$ 得到 $u_R$。这给出了一个试探位移场，包括我们记为 $u_N^{\\text{unc}}$ 的杆端位移。然后我们检查这个试探解相对于接触约束是否运动学容许。使用指定的公差 $\\tau = 10^{-12}$，我们测试是否满足 $u_N^{\\text{unc}} \\le g + \\tau$。\n\n2.  **判别与修正（如有必要）：**\n    -   **如果 $u_N^{\\text{unc}} \\le g + \\tau$：** 试探解有效。约束未激活。最终杆端位移为 $u_N = u_N^{\\text{unc}}$，接触状态为 `False`，接触反力 $\\lambda$ 为零，这符合互补条件 $\\lambda(u_N-g)=0$（当 $u_N < g$ 时，或 $u_N=g$ 但没有强制反力时）。\n    -   **如果 $u_N^{\\text{unc}} > g + \\tau$：** 试探解违反了约束。这意味着接触被激活，约束必须作为等式 $u_N = g$ 来强制执行。然后用两个指定位移（$u_0=0$ 和 $u_N=g$）重新求解问题。此时未知位移是 $u_1, \\dots, u_{N-1}$。通过对 $K$ 和 $f$ 进行分区，形成一个新的、更小的线性系统来求解这些内部位移。该系统的右侧包含一个项，用于解释在节点 $N$ 处指定非零位移 $g$ 的影响。一旦知道了完整的位移向量 $u$（其中 $u_0=0$ 且 $u_N=g$），最终结果是：杆端位移为 $u_N=g$，接触状态为 `True`。然后计算接触反力 $\\lambda$。它是在强制位移为 $u_N=g$ 的同时维持平衡所需的力。根据节点 $N$ 处的平衡方程 $(K u)_N = f_N - \\lambda$，反力计算如下：\n        $$\n        \\lambda = f_N - (K u)_N\n        $$\n        该值必须为非负，这一点由仅在无约束位移会超过间隙时才激活接触约束的逻辑所保证。\n\n此过程正确地实现了该约束优化问题的 Karush-Kuhn-Tucker (KKT) 条件，并为每个测试用例提供了所需的输出。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases and print the results.\n    \"\"\"\n    # Test suite from the problem statement\n    # Each case is a tuple: (E, A, L, N, P, g)\n    test_cases = [\n        (7.0e10, 1.0e-4, 2.0, 5, 3.0e3, 1.0e-2),\n        (7.0e10, 1.0e-4, 2.0, 5, 3.0e3, 1.0e-4),\n        (7.0e10, 1.0e-4, 2.0, 5, 3.0e3, 8.571428571428572e-4),\n        (7.0e10, 1.0e-4, 2.0, 5, 0.0, 1.0e-4),\n    ]\n\n    results_as_strings = []\n    for case in test_cases:\n        u_N, contact_active, lambda_val = solve_case(*case)\n        # Format each result as '[u_N,contact_status,lambda]'\n        results_as_strings.append(f\"[{u_N},{str(contact_active)},{lambda_val}]\")\n    \n    # Final print statement in the exact required format\n    print(f\"[{','.join(results_as_strings)}]\")\n\ndef solve_case(E, A, L, N, P, g):\n    \"\"\"\n    Solves the 1D bar problem with a unilateral contact constraint for a single test case.\n\n    Args:\n        E (float): Young's modulus [Pa]\n        A (float): Cross-sectional area [m^2]\n        L (float): Length of the bar [m]\n        N (int): Number of finite elements\n        P (float): Applied axial force at the tip [N]\n        g (float): Gap to the rigid stop [m]\n\n    Returns:\n        tuple: A triplet containing:\n            - u_N (float): Tip displacement [m]\n            - contact_active (bool): True if contact is active, False otherwise\n            - lambda_val (float): Contact reaction force [N]\n    \"\"\"\n    num_nodes = N + 1\n    h = L / N\n    tau = 1e-12  # Numerical tolerance for contact check\n\n    # 1. Assemble global stiffness matrix K and force vector f\n    k_e_val = E * A / h\n    k_e = k_e_val * np.array([[1, -1], [-1, 1]])\n    \n    K = np.zeros((num_nodes, num_nodes))\n    for i in range(N):\n        # Add element stiffness matrix to global matrix\n        K[i:i+2, i:i+2] += k_e\n\n    f = np.zeros(num_nodes)\n    f[N] = P\n\n    # 2. Trial step: Solve unconstrained problem (assuming no contact)\n    # The system is reduced by applying the constraint u_0 = 0.\n    # We solve for DOFs 1 to N.\n    dofs_free = np.arange(1, num_nodes)\n    K_red = K[np.ix_(dofs_free, dofs_free)]\n    f_red = f[dofs_free]\n    \n    u_R = np.linalg.solve(K_red, f_red)\n    u_N_unc = u_R[-1]\n\n    # 3. Check contact condition\n    if u_N_unc = g + tau:\n        # Case: Contact is NOT active\n        u_N = u_N_unc\n        contact_active = False\n        lambda_val = 0.0\n    else:\n        # Case: Contact IS active\n        u_N = g\n        contact_active = True\n        \n        # Re-solve for internal DOFs u_1, ..., u_{N-1}\n        # with u_0 = 0 and u_N = g set as knowns.\n        dofs_internal = np.arange(1, N) # DOFs from 1 to N-1\n        \n        # Partition K for internal DOFs\n        K_internal = K[np.ix_(dofs_internal, dofs_internal)]\n        \n        # Calculate effective force vector considering the prescribed displacement u_N = g.\n        # The contribution from u_0 is zero.\n        f_effective = f[dofs_internal] - K[dofs_internal, N] * g\n        \n        u_internal = np.linalg.solve(K_internal, f_effective)\n        \n        # Assemble the full displacement vector\n        u_full = np.zeros(num_nodes)\n        u_full[dofs_internal] = u_internal\n        u_full[N] = g\n        \n        # Calculate the contact reaction lambda = f_N - (K*u)_N\n        internal_force_at_N = K[N, :] @ u_full\n        lambda_val = f[N] - internal_force_at_N\n\n    return u_N, contact_active, lambda_val\n\nsolve()\n\n```", "id": "2675683"}]}