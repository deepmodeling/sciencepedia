{"hands_on_practices": [{"introduction": "群延迟 $\\tau_g(\\omega)$ 是衡量滤波器相位失真的关键性能指标。线性相位 FIR 滤波器由于其脉冲响应的对称性，具有恒定的群延迟，这对于保持信号波形至关重要。相比之下，IIR 滤波器的群延迟本质上是频率相关的，尤其是在其极点频率附近会表现出显著的变化。本练习 [@problem_id:2859340] 将引导您从第一性原理出发，通过推导来量化这一根本差异，从而加深您对区分这两类滤波器相位特性的理解。", "problem": "考虑用于信号处理和系统建模的两个因果、线性时不变离散时间系统：\n\n1) 一个长度为 $N \\in \\mathbb{N}$ 的实系数有限冲激响应 (FIR) 滤波器，其冲激响应 $h[n] = h[N-1-n]$ 在 $n \\in \\{0,1,\\dots,N-1\\}$ 上是对称的，因此其频率响应 $H_{\\mathrm{FIR}}(\\mathrm{e}^{\\mathrm{j}\\omega})$ 具有线性相位。\n\n2) 一个实系数二阶无限冲激响应 (IIR) 滤波器，其复共轭极点 $p_{1,2} = r \\mathrm{e}^{\\pm \\mathrm{j}\\theta}$ 严格位于单位圆内，其中 $0<r<1$ 且 $\\theta \\in (0,\\pi)$，且其分子增益为1，因此其传递函数为\n$$\nH_{\\mathrm{IIR}}(z) \\;=\\; \\frac{1}{1 - 2 r \\cos(\\theta)\\, z^{-1} + r^2 z^{-2}} \\, .\n$$\n\n角度 $\\omega$ 和 $\\theta$ 应以弧度为单位。群延迟 $\\tau_g(\\omega)$ 根据基本原理定义为频率响应的展开相位 $\\phi(\\omega)$ 的负导数，即\n$$\n\\tau_g(\\omega) \\;=\\; - \\frac{\\mathrm{d}\\phi(\\omega)}{\\mathrm{d}\\omega} \\, ,\n$$\n其中 $H(\\mathrm{e}^{\\mathrm{j}\\omega}) = |H(\\mathrm{e}^{\\mathrm{j}\\omega})| \\,\\mathrm{e}^{\\mathrm{j}\\phi(\\omega)}$。\n\n任务：\n- 从群延迟的定义和实对称 FIR 滤波器的基本性质出发，推导 (1) 中滤波器的 $\\tau_{g,\\mathrm{FIR}}(\\omega)$ 表达式。\n- 从群延迟的定义和分母的极点因式分解出发，推导 (2) 中滤波器的 $\\tau_{g,\\mathrm{IIR}}(\\omega)$，使其为 $\\omega$、$r$ 和 $\\theta$ 的显式函数，不得使用任何预先记下的“捷径”延迟公式。\n- 然后，为凸显频率依赖性，令 $\\omega=\\theta$ 计算 IIR 群延迟在极点角处的值，并构造差值\n$$\n\\Delta \\tau \\;\\triangleq\\; \\tau_{g,\\mathrm{IIR}}(\\omega=\\theta) \\;-\\; \\tau_{g,\\mathrm{FIR}}(\\omega) \\, .\n$$\n\n提供一个用 $N$、$r$ 和 $\\theta$ 表示的 $\\Delta \\tau$ 的单一闭式解析表达式。无需进行数值计算或四舍五入。最终的方框答案中不要包含单位。", "solution": "问题陈述具有科学依据、适定且客观。所有参数和定义均为数字信号处理领域的标准。该问题是有效的。我们开始进行推导。\n\n首先，我们推导指定的有限冲激响应 (FIR) 滤波器的群延迟 $\\tau_{g,\\mathrm{FIR}}(\\omega)$。\n频率响应 $H_{\\mathrm{FIR}}(\\mathrm{e}^{\\mathrm{j}\\omega})$ 是实对称冲激响应 $h[n]$ 的离散时间傅里叶变换，其中 $h[n] = h[N-1-n]$，对于 $n \\in \\{0, 1, \\dots, N-1\\}$。\n$$ H_{\\mathrm{FIR}}(\\mathrm{e}^{\\mathrm{j}\\omega}) = \\sum_{n=0}^{N-1} h[n] \\mathrm{e}^{-\\mathrm{j}\\omega n} $$\n通过提出对应于滤波器中点 $\\frac{N-1}{2}$ 的一个因子，该表达式可重写为：\n$$ H_{\\mathrm{FIR}}(\\mathrm{e}^{\\mathrm{j}\\omega}) = \\mathrm{e}^{-\\mathrm{j}\\omega \\frac{N-1}{2}} \\sum_{n=0}^{N-1} h[n] \\mathrm{e}^{-\\mathrm{j}\\omega(n - \\frac{N-1}{2})} $$\n令求和项表示为 $A(\\omega)$。我们将证明 $A(\\omega)$ 是一个实值函数。\n$$ A(\\omega) = \\sum_{n=0}^{N-1} h[n] \\mathrm{e}^{-\\mathrm{j}\\omega(n - \\frac{N-1}{2})} $$\n$A(\\omega)$ 的复共轭是：\n$$ A^*(\\omega) = \\left( \\sum_{n=0}^{N-1} h[n] \\mathrm{e}^{-\\mathrm{j}\\omega(n - \\frac{N-1}{2})} \\right)^* = \\sum_{n=0}^{N-1} h^*[n] \\mathrm{e}^{\\mathrm{j}\\omega(n - \\frac{N-1}{2})} $$\n由于系数 $h[n]$ 是实数，所以 $h^*[n] = h[n]$。\n$$ A^*(\\omega) = \\sum_{n=0}^{N-1} h[n] \\mathrm{e}^{\\mathrm{j}\\omega(n - \\frac{N-1}{2})} $$\n现在，我们在 $A(\\omega)$ 的求和中进行变量替换，令 $k=N-1-n$。当 $n$ 从 $0$ 变化到 $N-1$ 时，$k$ 也从 $N-1$ 变化到 $0$。我们使用对称性 $h[n]=h[k]$。\n$$ A(\\omega) = \\sum_{k=0}^{N-1} h[k] \\mathrm{e}^{-\\mathrm{j}\\omega(N-1-k - \\frac{N-1}{2})} = \\sum_{k=0}^{N-1} h[k] \\mathrm{e}^{-\\mathrm{j}\\omega(\\frac{N-1}{2} - k)} = \\sum_{k=0}^{N-1} h[k] \\mathrm{e}^{\\mathrm{j}\\omega(k - \\frac{N-1}{2})} $$\n此表达式与 $A^*(\\omega)$ 的表达式相同，因此 $A(\\omega)=A^*(\\omega)$，这证明了 $A(\\omega)$ 是实数。\n频率响应为 $H_{\\mathrm{FIR}}(\\mathrm{e}^{\\mathrm{j}\\omega}) = A(\\omega) \\mathrm{e}^{-\\mathrm{j}\\omega \\frac{N-1}{2}}$。\n$H_{\\mathrm{FIR}}(\\mathrm{e}^{\\mathrm{j}\\omega})$ 的相位是此表达式的相位。$A(\\omega)$ 是实数，所以当 $A(\\omega)>0$ 时其相位为 $0$，当 $A(\\omega)<0$ 时其相位为 $\\pi$。在计算群延迟时考虑展开相位，这些 $\\pi$ 的跳变可以忽略。因此，相位主要由线性项决定。\n因此，展开相位为 $\\phi_{\\mathrm{FIR}}(\\omega) = -\\omega \\frac{N-1}{2}$。\n群延迟定义为 $\\tau_g(\\omega) = -\\frac{\\mathrm{d}\\phi(\\omega)}{\\mathrm{d}\\omega}$。\n$$ \\tau_{g,\\mathrm{FIR}}(\\omega) = -\\frac{\\mathrm{d}}{\\mathrm{d}\\omega} \\left(-\\omega \\frac{N-1}{2}\\right) = \\frac{N-1}{2} $$\n该 FIR 滤波器的群延迟是常数。\n\n其次，我们推导指定的无限冲激响应 (IIR) 滤波器的群延迟 $\\tau_{g,\\mathrm{IIR}}(\\omega)$。\n传递函数为 $H_{\\mathrm{IIR}}(z) = \\frac{1}{1 - 2 r \\cos(\\theta)\\, z^{-1} + r^2 z^{-2}}$。根据极点 $p_1 = r\\mathrm{e}^{\\mathrm{j}\\theta}$ 和 $p_2 = r\\mathrm{e}^{-\\mathrm{j}\\theta}$，分母多项式 $D(z)$ 可被因式分解为：\n$$ D(z) = (1 - p_1 z^{-1})(1 - p_2 z^{-1}) $$\n因此，$H_{\\mathrm{IIR}}(z) = H_1(z)H_2(z)$，其中 $H_k(z) = (1-p_k z^{-1})^{-1}$。$H_{\\mathrm{IIR}}$ 的相位是 $H_1$ 和 $H_2$ 相位的和。因此，总群延迟是各个一阶节的群延迟之和。\n让我们推导一个具有单个极点 $p = r_p \\mathrm{e}^{\\mathrm{j}\\theta_p}$ 的通用一阶节的群延迟：\n$H(\\mathrm{e}^{\\mathrm{j}\\omega}) = (1 - p \\mathrm{e}^{-\\mathrm{j}\\omega})^{-1}$。\n相位是 $\\phi(\\omega) = -\\arg(1 - p \\mathrm{e}^{-\\mathrm{j}\\omega}) = -\\arg(1 - r_p \\mathrm{e}^{\\mathrm{j}(\\theta_p-\\omega)})$。\n设复数为 $C = 1 - r_p\\cos(\\theta_p-\\omega) - \\mathrm{j}r_p\\sin(\\theta_p-\\omega)$。\n$\\phi(\\omega) = -\\arctan\\left(\\frac{-r_p\\sin(\\theta_p-\\omega)}{1 - r_p\\cos(\\theta_p-\\omega)}\\right) = \\arctan\\left(\\frac{r_p\\sin(\\theta_p-\\omega)}{1 - r_p\\cos(\\theta_p-\\omega)}\\right)$。\n令 $u = \\theta_p - \\omega$，则 $\\frac{\\mathrm{d}u}{\\mathrm{d}\\omega} = -1$。\n$\\phi(\\omega) = \\arctan\\left(\\frac{r_p\\sin u}{1-r_p\\cos u}\\right)$。\n导数为 $\\frac{\\mathrm{d}\\phi}{\\mathrm{d}\\omega} = \\frac{\\mathrm{d}\\phi}{\\mathrm{d}u}\\frac{\\mathrm{d}u}{\\mathrm{d}\\omega} = -\\frac{\\mathrm{d}}{\\mathrm{d}u}\\arctan\\left(\\frac{r_p\\sin u}{1-r_p\\cos u}\\right)$。\n$$ \\frac{\\mathrm{d}\\phi}{\\mathrm{d}u} = \\frac{1}{1 + \\left(\\frac{r_p\\sin u}{1-r_p\\cos u}\\right)^2} \\frac{r_p\\cos u(1-r_p\\cos u) - r_p\\sin u(r_p\\sin u)}{(1-r_p\\cos u)^2} $$\n$$ = \\frac{(1-r_p\\cos u)^2}{(1-r_p\\cos u)^2 + r_p^2\\sin^2 u} \\frac{r_p\\cos u - r_p^2}{(1-r_p\\cos u)^2} $$\n$$ = \\frac{r_p\\cos u - r_p^2}{1-2r_p\\cos u + r_p^2\\cos^2 u + r_p^2\\sin^2 u} = \\frac{r_p\\cos u - r_p^2}{1-2r_p\\cos u + r_p^2} $$\n该节的群延迟为 $\\tau_g(\\omega) = -\\frac{\\mathrm{d}\\phi}{\\mathrm{d}\\omega} = -(-\\frac{\\mathrm{d}\\phi}{\\mathrm{d}u}) = \\frac{\\mathrm{d}\\phi}{\\mathrm{d}u} = \\frac{r_p\\cos(\\theta_p-\\omega) - r_p^2}{1-2r_p\\cos(\\theta_p-\\omega) + r_p^2}$。\n\n总的 IIR 群延迟是极点 $p_1$ ($r_p=r, \\theta_p=\\theta$) 和 $p_2$ ($r_p=r, \\theta_p=-\\theta$) 延迟之和：\n$$ \\tau_{g,\\mathrm{IIR}}(\\omega) = \\frac{r\\cos(\\theta-\\omega) - r^2}{1-2r\\cos(\\theta-\\omega) + r^2} + \\frac{r\\cos(-\\theta-\\omega) - r^2}{1-2r\\cos(-\\theta-\\omega) + r^2} $$\n使用 $\\cos(-x)=\\cos(x)$，我们得到 IIR 群延迟的一般表达式：\n$$ \\tau_{g,\\mathrm{IIR}}(\\omega) = \\frac{r\\cos(\\theta-\\omega) - r^2}{1-2r\\cos(\\theta-\\omega) + r^2} + \\frac{r\\cos(\\theta+\\omega) - r^2}{1-2r\\cos(\\theta+\\omega) + r^2} $$\n\n第三，我们计算当 $\\omega=\\theta$ 时 IIR 滤波器的群延迟。\n第一项变为：\n$$ \\frac{r\\cos(\\theta-\\theta) - r^2}{1-2r\\cos(\\theta-\\theta) + r^2} = \\frac{r\\cos(0) - r^2}{1-2r\\cos(0) + r^2} = \\frac{r-r^2}{1-2r+r^2} = \\frac{r(1-r)}{(1-r)^2} = \\frac{r}{1-r} $$\n第二项变为：\n$$ \\frac{r\\cos(\\theta+\\theta) - r^2}{1-2r\\cos(\\theta+\\theta) + r^2} = \\frac{r\\cos(2\\theta) - r^2}{1-2r\\cos(2\\theta) + r^2} $$\n两项之和给出在指定频率下的 IIR 群延迟：\n$$ \\tau_{g,\\mathrm{IIR}}(\\omega=\\theta) = \\frac{r}{1-r} + \\frac{r\\cos(2\\theta) - r^2}{1 - 2r\\cos(2\\theta) + r^2} $$\n\n最后，我们计算差值 $\\Delta \\tau = \\tau_{g,\\mathrm{IIR}}(\\omega=\\theta) - \\tau_{g,\\mathrm{FIR}}(\\omega)$。\nFIR 群延迟是常数，等于 $\\frac{N-1}{2}$。\n$$ \\Delta \\tau = \\frac{r}{1-r} + \\frac{r\\cos(2\\theta) - r^2}{1 - 2r\\cos(2\\theta) + r^2} - \\frac{N-1}{2} $$\n这就是用给定参数 $N$、$r$ 和 $\\theta$ 表示的最终闭式表达式。", "answer": "$$\n\\boxed{\\frac{r}{1-r} + \\frac{r\\cos(2\\theta) - r^2}{1 - 2r\\cos(2\\theta) + r^2} - \\frac{N-1}{2}}\n$$", "id": "2859340"}, {"introduction": "除了频率响应，滤波器的实用性还取决于其稳定性。FIR 滤波器因其结构而天生稳定，但 IIR 滤波器的稳定性则严格依赖于其极点位置是否维持在单位圆内。这使得 IIR 滤波器在实现过程中，对系数的量化误差非常敏感。本练习 [@problem_id:2859321] 提供了一个具体的稳健性分析实践，要求您计算能使一个稳定 IIR 滤波器变为临界稳定的最小系数扰动，从而量化其“稳定裕度”，并突显 FIR 设计在这一方面的关键优势。", "problem": "考虑一个离散时间线性时不变系统，其传递函数为\n$$H(z)=\\frac{1+0.5\\,z^{-1}}{1-1.2\\,z^{-1}+0.36\\,z^{-2}}.$$\n请使用第一性原理，通过在复 $z$ 平面上定位其分母多项式的极点，来判断该无限冲激响应（IIR）滤波器的稳定性，并根据极点半径解释其稳定性。然后，通过对前向多项式\n$$A(z)=z^{2}+a_{1}z+a_{0},$$\n进行扰动，来对 IIR 分母中的系数不确定性进行建模，其标称值为 $a_{1}=-1.2$ 和 $a_{0}=0.36$，扰动为一个加性矢量扰动 $\\Delta=\\begin{pmatrix}\\Delta a_{1}\\\\ \\Delta a_{0}\\end{pmatrix}$。使用由 Jury 条件中的等式所刻画的二阶多项式的离散时间 Schur 稳定性边界（单位圆边界），确定一个能使该 IIR 滤波器达到临界稳定（即，将一个极点置于 $|z|=1$ 上）的最小欧几里得范数 $\\|\\Delta\\|_{2}$ 的扰动。请给出这个最小范数的精确值。\n\n在您的推理中，请将此 IIR 滤波器稳定性对分母系数扰动的敏感性，与一个具有相同分子式的有限冲激响应（FIR）滤波器\n$$H_{\\mathrm{FIR}}(z)=1+0.5\\,z^{-1},$$\n进行对比，并指出为何 FIR 滤波器的稳定性不受此类扰动的影响。您的最终答案必须是一个实数或一个封闭形式的解析表达式，不带单位。请勿四舍五入；给出精确值。", "solution": "该问题陈述已经过严格验证，并被确定为有效。它在科学上基于数字信号处理的原理，问题提法得当且客观。我们将提供一个完整的解答。\n\n分析始于由以下传递函数定义的无限冲激响应（IIR）滤波器：\n$$H(z)=\\frac{1+0.5\\,z^{-1}}{1-1.2\\,z^{-1}+0.36\\,z^{-2}}$$\n一个线性时不变（LTI）系统的稳定性取决于其传递函数在复 $z$ 平面中极点的位置。极点是分母多项式的根。令分母为零可得：\n$$1-1.2\\,z^{-1}+0.36\\,z^{-2} = 0$$\n为求极点，我们将上式乘以 $z^2$，得到以 $z$ 的正幂表示的特征多项式：\n$$z^{2}-1.2\\,z+0.36 = 0$$\n这是一个完全平方：\n$$(z-0.6)^{2} = 0$$\n该系统在 $z=0.6$ 处有一个二重极点。对于一个离散时间系统，要使其稳定，其所有极点都必须严格位于单位圆内部，即极点的模必须小于 $1$。该极点的模为 $|0.6|=0.6$，小于 $1$。因此，该标称 IIR 滤波器是稳定的。\n\n接下来，我们分析该滤波器在系数扰动下的稳定性。分母由前向多项式 $A(z)=z^{2}+a_{1}z+a_{0}$ 表示，其标称系数为 $a_{1}=-1.2$ 和 $a_{0}=0.36$。引入一个扰动 $\\Delta=\\begin{pmatrix}\\Delta a_{1} & \\Delta a_{0}\\end{pmatrix}^{T}$，得到扰动后的多项式 $A_p(z)=z^{2}+(a_{1}+\\Delta a_{1})z+(a_{0}+\\Delta a_{0})$。设扰动后的系数为 $a'_{1}=a_{1}+\\Delta a_{1}$ 和 $a'_{0}=a_{0}+\\Delta a_{0}$。\n\n对于一个二阶多项式 $P(z)=z^{2}+c_{1}z+c_{0}$，要使其所有根都位于单位圆内部，必须满足 Jury 稳定性条件：\n$1.$ $P(1) > 0 \\implies 1+c_{1}+c_{0} > 0$\n$2.$ $P(-1) > 0 \\implies 1-c_{1}+c_{0} > 0$\n$3.$ $|c_{0}| < 1$\n\n当这些不等式中的任何一个变为等式时，滤波器达到临界稳定。这定义了系数空间 $(c_1, c_0)$ 中的稳定性边界。\n边界为：\n$1.$ $1+c_{1}+c_{0} = 0$，对应于 $z=1$ 处的一个极点。\n$2.$ $1-c_{1}+c_{0} = 0$，对应于 $z=-1$ 处的一个极点。\n$3.$ $c_{0} = 1$ (对于 $|c_1| \\leq 2$)，对应于单位圆上的一对共轭复数极点。\n$4.$ $c_{0} = -1$，也对应于临界稳定，但我们将发现它不是最近的边界。\n\n问题在于求出扰动矢量的最小欧几里得范数 $\\|\\Delta\\|_{2}=\\sqrt{(\\Delta a_{1})^{2}+(\\Delta a_{0})^{2}}$，该扰动能将标称系数点 $(a_{1}, a_{0}) = (-1.2, 0.36)$ 移动到这些边界之一上。这等价于求点 $P_{\\mathrm{nom}}=(-1.2, 0.36)$ 到由以下直线集合定义的稳定性边界的最小几何距离：\n$L_1: a'_{0} = -a'_{1}-1$\n$L_2: a'_{0} = a'_{1}-1$\n$L_3: a'_{0} = 1$\n\n我们计算点 $(x_0, y_0) = (-1.2, 0.36)$ 到这些直线的每一条的距离。点 $(x_0, y_0)$ 到直线 $Ax+By+C=0$ 的距离由公式 $d = \\frac{|Ax_{0}+By_{0}+C|}{\\sqrt{A^{2}+B^{2}}}$ 给出。\n\n到直线 $L_1$ ($a'_{1}+a'_{0}+1=0$) 的距离：\n$$d_1 = \\frac{|(-1.2) + (0.36) + 1|}{\\sqrt{1^{2}+1^{2}}} = \\frac{|0.16|}{\\sqrt{2}} = \\frac{0.16}{\\sqrt{2}}$$\n\n到直线 $L_2$ ($a'_{1}-a'_{0}-1=0$) 的距离：\n$$d_2 = \\frac{|(-1.2) - (0.36) - 1|}{\\sqrt{1^{2}+(-1)^{2}}} = \\frac{|-2.56|}{\\sqrt{2}} = \\frac{2.56}{\\sqrt{2}}$$\n\n到直线 $L_3$ ($a'_{0}-1=0$) 的距离：\n$$d_3 = \\frac{|(0.36) - 1|}{\\sqrt{0^{2}+1^{2}}} = |-0.64| = 0.64$$\n此直线上的接触点将是 $(-1.2, 1)$，这满足约束条件 $|a'_1|=|-1.2| \\leq 2$。\n\n比较这三个距离：\n$d_1 = \\frac{0.16}{\\sqrt{2}} \\approx \\frac{0.16}{1.414} \\approx 0.113$\n$d_2 = \\frac{2.56}{\\sqrt{2}} \\approx \\frac{2.56}{1.414} \\approx 1.810$\n$d_3 = 0.64$\n\n最小的距离是 $d_1$。我们以精确值的形式给出这个最小范数。\n标称系数为 $a_{1}=-1.2 = -\\frac{6}{5}$ 和 $a_{0}=0.36 = \\frac{9}{25}$。\n直线 $L_1$ 是 $a'_{1}+a'_{0}+1=0$。距离为：\n$$\\|\\Delta\\|_{2, \\min} = \\frac{|-\\frac{6}{5} + \\frac{9}{25} + 1|}{\\sqrt{2}} = \\frac{|-\\frac{30}{25} + \\frac{9}{25} + \\frac{25}{25}|}{\\sqrt{2}} = \\frac{|\\frac{4}{25}|}{\\sqrt{2}} = \\frac{4}{25\\sqrt{2}} = \\frac{2\\sqrt{2}}{25}$$\n\n最后，我们将这种敏感性与有限冲激响应（FIR）滤波器 $H_{\\mathrm{FIR}}(z)=1+0.5\\,z^{-1}$ 的情况进行对比。一个长度为 $N$ 的 FIR 滤波器的传递函数具有以下形式：\n$$H(z) = \\sum_{k=0}^{N-1} b_k z^{-k}$$\n通过将分子和分母同乘以 $z^{N-1}$，可将其写成有理函数的形式：\n$$H(z) = \\frac{\\sum_{k=0}^{N-1} b_k z^{N-1-k}}{z^{N-1}}$$\n分母是 $z^{N-1}$，这意味着有 $N-1$ 个极点，全部位于 $z$ 平面的原点（$z=0$）处。由于 $|0| < 1$，无论滤波器系数 $b_k$ 的值如何，所有极点都严格位于单位圆内部。因此，一个因果 FIR 滤波器总是稳定的。系数扰动（例如由量化引起的扰动）会影响分子多项式，从而改变滤波器零点的位置，但不会改变其极点的位置。由于稳定性仅是极点位置的函数，FIR 滤波器的稳定性由其结构内在保证，并且对其系数的扰动完全不敏感。这是 FIR 滤波器相对于 IIR 滤波器的根本优势，正如我们的计算所示，后者可能因微小的系数变化而变得不稳定。", "answer": "$$\\boxed{\\frac{2\\sqrt{2}}{25}}$$", "id": "2859321"}, {"introduction": "IIR 滤波器因其在实现陡峭幅度响应方面的高效率而备受青睐，但这通常以非线性相位（即非恒定群延迟）为代价，构成了一个经典的工程权衡。这个高级实践 [@problem_id:2859268] 直面这一问题，提出了一个真实的设计挑战：使用级联的 IIR 全通滤波器来均衡巴特沃斯 IIR 滤波器的群延迟。通过这个动手编程项目，您将实现一个基于优化的解决方案来平坦化通带群延迟，展示如何弥补 IIR 滤波器的核心缺陷，并获得与更高阶的线性相位 FIR 滤波器相媲美的性能。", "problem": "构建一个离散时间的设计-测量实验，以比较针对低阶Butterworth低通幅度响应的群延迟均衡的无限冲激响应 (IIR) 和有限冲激响应 (FIR) 方法。仅从以下基础出发：(i) 由其传递函数 $H(z)$ 定义的线性时不变 (LTI) 离散时间系统，(ii) 频率响应 $H(\\mathrm{e}^{j\\omega})$，其中角频率 $\\omega$ 的单位为弧度/采样点，(iii) 由 $\\tau(\\omega) = -\\dfrac{d}{d\\omega}\\arg H(\\mathrm{e}^{j\\omega})$ 定义的群延迟，单位为采样点，(iv) 全通特性 $|H_{\\mathrm{ap}}(\\mathrm{e}^{j\\omega})|=1$ 以及级联下的相位和群延迟的可加性，以及 (v) 由阶数和截止频率定义的经典数字Butterworth低通滤波器的幅度原型。除这些基础外，不假设任何额外公式。\n\n您的任务是实现一个程序，对下述每个测试用例执行以下步骤：\n\n1. 设计一个阶数为 $N_{\\mathrm{B}}$、归一化截止频率为 $f_{\\mathrm{c}}$（归一化使 $f_{\\mathrm{c}} \\in (0,1)$ 对应于数字角截止频率 $\\omega_{\\mathrm{c}} = \\pi f_{\\mathrm{c}}$）的因果数字Butterworth低通滤波器。使用传递函数形式 $H_{\\mathrm{B}}(z)=\\dfrac{B_{\\mathrm{B}}(z^{-1})}{A_{\\mathrm{B}}(z^{-1})}$。\n\n2. 将一个实系数IIR全通均衡器参数化为 $K$ 个一阶全通节的级联，每个节的传递函数为\n$H_k(z) = \\dfrac{a_k + z^{-1}}{1 + a_k z^{-1}}$，并带有稳定性约束 $|a_k|<1$。整体均衡器为 $H_{\\mathrm{ap}}(z) = \\prod_{k=1}^{K} H_k(z) = \\dfrac{B_{\\mathrm{ap}}(z^{-1})}{A_{\\mathrm{ap}}(z^{-1})}$。\n\n3. 将均衡后的系统定义为级联 $H_{\\mathrm{eq}}(z) = H_{\\mathrm{B}}(z) H_{\\mathrm{ap}}(z) = \\dfrac{B_{\\mathrm{B}}(z^{-1}) B_{\\mathrm{ap}}(z^{-1})}{A_{\\mathrm{B}}(z^{-1}) A_{\\mathrm{ap}}(z^{-1})}$，根据全通特性，该系统保持了幅度 $|H_{\\mathrm{eq}}(\\mathrm{e}^{j\\omega})| = |H_{\\mathrm{B}}(\\mathrm{e}^{j\\omega})|$。\n\n4. 在一个密集的通带网格 $\\omega \\in [\\omega_{\\min}, \\omega_{\\mathrm{p}}]$ 上（其中 $\\omega_{\\mathrm{p}} = \\pi f_{\\mathrm{c}}$，并有一个小的排除裕度使得 $\\omega_{\\min} > 0$ 且网格的顶端严格小于 $\\omega_{\\mathrm{p}}$），计算 $H_{\\mathrm{B}}$ 的群延迟 $\\tau_{\\mathrm{B}}(\\omega)$、$H_{\\mathrm{eq}}$ 的群延迟 $\\tau_{\\mathrm{eq}}(\\omega)$，以及一个线性相位FIR低通比较器 $H_{\\mathrm{FIR}}(z)$ 的群延迟 $\\tau_{\\mathrm{FIR}}(\\omega)$。该比较器具有指定的奇数长度 $N_{\\mathrm{FIR}}$，并通过标准窗函数法在相同的截止频率 $f_{\\mathrm{c}}$ 下设计。角度单位为弧度。\n\n5. 通过求解约束最小化问题来选择均衡器参数 $\\{a_k\\}_{k=1}^{K}$\n$$\n\\min_{\\{a_k\\}} \\; \\int_{0}^{\\omega_{\\mathrm{p}}} \\left(\\tau_{\\mathrm{eq}}(\\omega) - \\bar{\\tau}_{\\mathrm{eq}}\\right)^2 \\, d\\omega\n\\quad \\text{约束条件为} \\quad \\text{对所有 } k \\text{ 有 } |a_k|<1,\n$$\n其中 $\\bar{\\tau}_{\\mathrm{eq}}$ 是 $\\tau_{\\mathrm{eq}}(\\omega)$ 在通带内的均值。此标准旨在以最小二乘意义上围绕其自身的最佳常数参考值，寻求最大平坦的群延迟，而无需预先指定该常数。\n\n6. 将三种系统中每个系统的残余群延迟纹波量化为通带网格上的峰峰值变化，即\n$$\n\\Delta\\tau_{\\mathrm{B}} = \\max_{\\omega \\in \\mathcal{W}}\\tau_{\\mathrm{B}}(\\omega) - \\min_{\\omega \\in \\mathcal{W}}\\tau_{\\mathrm{B}}(\\omega), \\quad\n\\Delta\\tau_{\\mathrm{eq}} = \\max_{\\omega \\in \\mathcal{W}}\\tau_{\\mathrm{eq}}(\\omega) - \\min_{\\omega \\in \\mathcal{W}}\\tau_{\\mathrm{eq}}(\\omega), \\quad\n\\Delta\\tau_{\\mathrm{FIR}} = \\max_{\\omega \\in \\mathcal{W}}\\tau_{\\mathrm{FIR}}(\\omega) - \\min_{\\omega \\in \\mathcal{W}}\\tau_{\\mathrm{FIR}}(\\omega),\n$$\n其中 $\\mathcal{W}$ 是在 $\\left(0,\\omega_{\\mathrm{p}}\\right)$ 内选择的网格。\n\n为保证数值可复现性，请强制执行以下实现细节：\n- 在 $\\omega_{\\min}$ 和 $\\omega_{\\max}$ 之间使用一个包含 $N_{\\omega}$ 个点的均匀网格，其中 $\\omega_{\\min} = 10^{-4}\\pi$，$\\omega_{\\max} = 0.98 \\,\\omega_{\\mathrm{p}}$，且 $N_{\\omega} = 1024$。\n- 将每个 $a_k$ 约束为 $|a_k| \\le r_{\\max}$，其中 $r_{\\max} = 0.98$。\n- 使用上述定义测量群延迟，单位为采样点。角度必须为弧度，不使用物理单位。\n- 对于FIR比较器，使用奇数长度 $N_{\\mathrm{FIR}}$ 的汉明窗设计。对称线性相位FIR在精确算术下具有完全恒定的群延迟 $\\left(N_{\\mathrm{FIR}}-1\\right)/2$；数值计算可能会引入可忽略的偏差。\n\n测试套件：\n为以下参数集提供结果：\n- 情况 1：$N_{\\mathrm{B}}=4$，$f_{\\mathrm{c}}=0.30$，$K=3$，$N_{\\mathrm{FIR}}=63$。\n- 情况 2：$N_{\\mathrm{B}}=2$，$f_{\\mathrm{c}}=0.20$，$K=2$，$N_{\\mathrm{FIR}}=63$。\n- 情况 3：$N_{\\mathrm{B}}=4$，$f_{\\mathrm{c}}=0.45$，$K=3$，$N_{\\mathrm{FIR}}=127$。\n\n要求的最终输出：\n您的程序应生成单行输出，包含三个测试用例的结果列表，每个用例由一个三元素列表 $[\\Delta\\tau_{\\mathrm{B}}, \\Delta\\tau_{\\mathrm{eq}}, \\Delta\\tau_{\\mathrm{FIR}}]$ 表示，其中包含以采样点为单位的浮点数。整体输出必须是单一一行，形式为\n[[r11,r12,r13],[r21,r22,r23],[r31,r32,r33]]\n所有条目均格式化为十进制数字。不应打印任何额外文本。", "solution": "所提出的问题是数字信号处理领域中一个适定且科学严谨的练习，特别是在滤波器设计和均衡领域。它要求比较三种低通滤波器的群延迟特性：一个标准的IIR Butterworth滤波器，同一个经过全通节级联均衡的滤波器，以及一个作为基准的线性相位FIR滤波器。该问题是有效的，因为它基于LTI系统的基本原理，提供了明确的目标，并为可复现的数值实验指定了所有必要的参数和约束。我们将着手解决。\n\n问题的核心是设计一个IIR全通均衡器，以平坦化IIR Butterworth滤波器通带内非恒定的群延迟。性能通过峰峰值群延迟变化（纹波）来衡量，并与未经均衡的IIR滤波器和线性相位FIR滤波器进行比较。线性相位FIR滤波器是一个理想的基准，因为它的群延迟本质上是恒定的，尽管这是以更高的计算复杂度（阶数）为代价的。\n\n对于每个提供的参数集，将系统地执行解决方案。\n\n**步骤 1：系统定义和频率网格**\n对于由Butterworth阶数 $N_{\\mathrm{B}}$、归一化截止频率 $f_{\\mathrm{c}}$、全通节数量 $K$ 和FIR滤波器长度 $N_{\\mathrm{FIR}}$ 定义的每个测试用例，我们首先建立分析域。数字角截止频率为 $\\omega_{\\mathrm{c}} = \\pi f_{\\mathrm{c}}$。通带分析网格 $\\mathcal{W}$ 是一组 $N_{\\omega} = 1024$ 个从 $\\omega_{\\min} = 10^{-4}\\pi$ 到 $\\omega_{\\max} = 0.98 \\, \\omega_{\\mathrm{p}}$ 均匀间隔的角频率，其中我们取 $\\omega_{\\mathrm{p}} = \\omega_{\\mathrm{c}}$。\n\n**步骤 2：Butterworth低通滤波器设计与分析**\n设计一个阶数为 $N_{\\mathrm{B}}$、截止频率为 $f_{\\mathrm{c}}$ 的因果数字Butterworth低通滤波器。使用标准的库函数（这些函数体现了模拟原型的双线性变换）来获得传递函数 $H_{\\mathrm{B}}(z) = \\frac{B_{\\mathrm{B}}(z^{-1})}{A_{\\mathrm{B}}(z^{-1})}$ 的系数。分子多项式 $B_{\\mathrm{B}}(z^{-1})$ 和分母多项式 $A_{\\mathrm{B}}(z^{-1})$ 的系数存储为数组，我们称之为 $b_{\\mathrm{B}}$ 和 $a_{\\mathrm{B}}$。\n\n该滤波器的群延迟 $\\tau_{\\mathrm{B}}(\\omega)$ 在网格 $\\mathcal{W}$ 上根据其定义关系 $\\tau(\\omega) = -\\frac{d}{d\\omega}\\arg H(e^{j\\omega})$ 进行计算。该表达式的数值计算提供了以采样点为单位的 $\\tau_{\\mathrm{B}}(\\omega)$。\n\n**步骤 3：线性相位FIR滤波器设计与分析**\n为了进行比较，使用汉明窗的窗函数法设计一个线性相位FIR低通滤波器。该滤波器具有奇数长度 $N_{\\mathrm{FIR}}$ 和相同的截止频率 $f_{\\mathrm{c}}$。其传递函数为 $H_{\\mathrm{FIR}}(z) = B_{\\mathrm{FIR}}(z^{-1})$。对于一个奇数长度为 $N_{\\mathrm{FIR}}$ 的对称FIR滤波器，理论上其群延迟在所有频率上都是恒定的，等于 $(N_{\\mathrm{FIR}}-1)/2$ 个采样点。我们将在网格 $\\mathcal{W}$ 上数值计算其群延迟 $\\tau_{\\mathrm{FIR}}(\\omega)$，以测量其实际性能，同时考虑到任何微小的数值偏差。\n\n**步骤 4：通过优化设计全通均衡器**\nIIR全通均衡器是 $K$ 个一阶节的级联：\n$$\nH_{\\mathrm{ap}}(z) = \\prod_{k=1}^{K} H_k(z) = \\prod_{k=1}^{K} \\frac{a_k + z^{-1}}{1 + a_k z^{-1}}\n$$\n系数 $\\{a_k\\}_{k=1}^{K}$ 是实数，并且必须满足稳定性条件 $|a_k| < 1$。均衡器的传递函数是 $H_{\\mathrm{ap}}(z) = \\frac{B_{\\mathrm{ap}}(z^{-1})}{A_{\\mathrm{ap}}(z^{-1})}$，其中分子和分母多项式的系数是通过对一阶节的系数进行逐次卷积得到的。\n\n均衡后的系统是 $H_{\\mathrm{eq}}(z) = H_{\\mathrm{B}}(z) H_{\\mathrm{ap}}(z)$。其传递函数系数 $b_{\\mathrm{eq}}$ 和 $a_{\\mathrm{eq}}$ 是通过对Butterworth滤波器和全通均衡器的系数进行卷积得到的：\n$$\nb_{\\mathrm{eq}} = b_{\\mathrm{B}} * b_{\\mathrm{ap}} \\quad \\text{和} \\quad a_{\\mathrm{eq}} = a_{\\mathrm{B}} * a_{\\mathrm{ap}}\n$$\n均衡后系统的群延迟 $\\tau_{\\mathrm{eq}}(\\omega)$ 是原始Butterworth滤波器和全通均衡器群延迟之和：$\\tau_{\\mathrm{eq}}(\\omega) = \\tau_{\\mathrm{B}}(\\omega) + \\tau_{\\mathrm{ap}}(\\omega)$。\n\n最佳参数 $\\{a_k\\}$ 是通过在通带网格 $\\mathcal{W}$ 上最小化群延迟 $\\tau_{\\mathrm{eq}}(\\omega)$ 的方差来找到的。这对应于求解约束优化问题：\n$$\n\\min_{\\{a_k\\}} \\left( \\frac{1}{N_\\omega} \\sum_{\\omega_i \\in \\mathcal{W}} (\\tau_{\\mathrm{eq}}(\\omega_i) - \\bar{\\tau}_{\\mathrm{eq}})^2 \\right) \\quad \\text{约束条件为} \\quad |a_k| \\le r_{\\max} = 0.98\n$$\n其中 $\\bar{\\tau}_{\\mathrm{eq}}$ 是 $\\tau_{\\mathrm{eq}}(\\omega)$ 在网格 $\\mathcal{W}$ 上的均值。采用数值优化算法（如处理边界约束的L-BFGS-B）来找到系数向量 $a_k$。零向量是用于优化的合适初始猜测值。\n\n**步骤 5：性能评估**\n一旦确定了最优的 $\\{a_k\\}$，就计算最终的均衡后群延迟 $\\tau_{\\mathrm{eq}}(\\omega)$。所有三个滤波器的性能都通过通带网格 $\\mathcal{W}$ 上的峰峰值群延迟纹波来量化：\n$$\n\\Delta\\tau = \\max_{\\omega \\in \\mathcal{W}}\\tau(\\omega) - \\min_{\\omega \\in \\mathcal{W}}\\tau(\\omega)\n$$\n这个值将为原始Butterworth滤波器（$\\Delta\\tau_{\\mathrm{B}}$）、均衡后的Butterworth滤波器（$\\Delta\\tau_{\\mathrm{eq}}$）和线性相位FIR滤波器（$\\Delta\\tau_{\\mathrm{FIR}}$）分别计算。这三个值构成一个测试用例的结果。对测试套件中提供的每个参数集重复整个过程。\n\n提供的Python代码实现了这个设计-测量实验，并遵循了所有指定的数值细节。", "answer": "```python\nimport numpy as np\nfrom scipy.signal import butter, firwin, group_delay\nfrom scipy.optimize import minimize\n\ndef calculate_ripples_for_case(N_B, f_c, K, N_FIR):\n    \"\"\"\n    Performs the design-and-measure experiment for a single test case.\n    \n    Args:\n        N_B (int): Order of the Butterworth filter.\n        f_c (float): Normalized cutoff frequency.\n        K (int): Number of first-order allpass sections in the equalizer.\n        N_FIR (int): Length of the FIR comparator filter.\n\n    Returns:\n        tuple: A tuple containing the group delay ripples (delta_tau_B, \n               delta_tau_eq, delta_tau_FIR) in samples.\n    \"\"\"\n    # Numerical implementation details from the problem statement\n    N_omega = 1024\n    r_max = 0.98\n\n    # Define the frequency grid (passband grid W)\n    omega_c = np.pi * f_c\n    omega_min = 1e-4 * np.pi\n    omega_max = 0.98 * omega_c\n    omega_grid, step = np.linspace(omega_min, omega_max, N_omega, retstep=True)\n\n    # Step 1: Design the causal digital Butterworth low-pass filter\n    # The 'f_c' for scipy.signal.butter is normalized to the Nyquist frequency,\n    # which matches the problem's definition of f_c.\n    b_B, a_B = butter(N_B, f_c, btype='low', analog=False)\n\n    # Step 4 (part 1): Compute group delay for the Butterworth filter\n    _, tau_B = group_delay((b_B, a_B), w=omega_grid)\n\n    # Step 4 (part 2): Design the linear-phase FIR comparator\n    # An odd length N_FIR ensures it can be a Type I (symmetric) linear-phase filter.\n    b_FIR = firwin(N_FIR, f_c, window='hamming')\n    # Denominator for an FIR filter is implicitly [1.0]\n    _, tau_FIR = group_delay((b_FIR, [1.0]), w=omega_grid)\n\n    # Step 5: Optimize the IIR allpass equalizer coefficients {a_k}\n    def objective_function(a_k_vec):\n        # Construct the allpass equalizer transfer function from coefficients a_k\n        b_ap = np.array([1.0])\n        a_ap = np.array([1.0])\n        for a_k in a_k_vec:\n            b_ap = np.convolve(b_ap, [a_k, 1.0])\n            a_ap = np.convolve(a_ap, [1.0, a_k])\n        \n        # Construct the total equalized system transfer function\n        b_eq = np.convolve(b_B, b_ap)\n        a_eq = np.convolve(a_B, a_ap)\n        \n        # Calculate group delay of the equalized system over the grid\n        _, tau_eq = group_delay((b_eq, a_eq), w=omega_grid)\n        \n        # The cost is the variance of the group delay, which is proportional to\n        # the integral of the squared deviation from the mean.\n        return np.var(tau_eq)\n\n    # Initial guess for a_k coefficients is all zeros\n    initial_guess_ak = np.zeros(K)\n    # Bounds for the coefficients: |a_k| <= r_max for stability\n    bounds_ak = [(-r_max, r_max)] * K\n\n    # Perform the constrained minimization\n    opt_result = minimize(\n        objective_function,\n        initial_guess_ak,\n        method='L-BFGS-B',\n        bounds=bounds_ak,\n    )\n\n    # Get the optimized a_k coefficients\n    a_k_opt = opt_result.x\n    \n    # Recalculate the equalized system's properties with optimal coefficients\n    b_ap_opt = np.array([1.0])\n    a_ap_opt = np.array([1.0])\n    for a_k in a_k_opt:\n        b_ap_opt = np.convolve(b_ap_opt, [a_k, 1.0])\n        a_ap_opt = np.convolve(a_ap_opt, [1.0, a_k])\n    \n    b_eq_opt = np.convolve(b_B, b_ap_opt)\n    a_eq_opt = np.convolve(a_B, a_ap_opt)\n    \n    _, tau_eq_opt = group_delay((b_eq_opt, a_eq_opt), w=omega_grid)\n\n    # Step 6: Quantify residual group-delay ripple for all three systems\n    delta_tau_B = np.max(tau_B) - np.min(tau_B)\n    delta_tau_eq = np.max(tau_eq_opt) - np.min(tau_eq_opt)\n    delta_tau_FIR = np.max(tau_FIR) - np.min(tau_FIR)\n\n    return delta_tau_B, delta_tau_eq, delta_tau_FIR\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple is (N_B, f_c, K, N_FIR)\n    test_cases = [\n        (4, 0.30, 3, 63),\n        (2, 0.20, 2, 63),\n        (4, 0.45, 3, 127),\n    ]\n\n    results = []\n    for case in test_cases:\n        # Calculate the result for one case.\n        result_tuple = calculate_ripples_for_case(*case)\n        results.append(list(result_tuple))\n\n    # Final print statement in the exact required format.\n    case_strs = [f\"[{','.join(map(str, r))}]\" for r in results]\n    final_output = f\"[{','.join(case_strs)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "2859268"}]}