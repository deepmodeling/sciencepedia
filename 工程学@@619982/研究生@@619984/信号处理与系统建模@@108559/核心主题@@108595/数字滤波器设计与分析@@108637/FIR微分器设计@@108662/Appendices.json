{"hands_on_practices": [{"introduction": "一个理想微分器的基本功能是响应变化而非恒定值。因此，对于常数输入，任何有效的数字微分器都应输出零。本练习将引导你从卷积的基本定义出发，推导出实现此功能的 FIR 滤波器系数必须满足的根本条件，并将其与频率响应在直流（DC）处的行为联系起来。通过验证常见的反对称 FIR 结构自动满足此条件，你将加深对滤波器结构与功能之间内在联系的理解。", "problem": "考虑一个实系数、长度为$N$的有限冲激响应 (FIR) 微分器，它被实现为一个线性时不变 (LTI) 系统，其冲激响应为$\\{h[n]\\}_{n=0}^{N-1}$，其中 $N \\in \\mathbb{N}$ 且对所有 $n \\in \\{0,1,\\ldots,N-1\\}$ 都有 $h[n] \\in \\mathbb{R}$。设输入为一个常数序列 $x[n] = C$（对所有整数 $n$ 成立），其中 $C \\in \\mathbb{R}$ 是一个任意但固定的常数。从LTI卷积和离散时间傅里叶变换 (DTFT) 的基本定义出发，推导当输入 $x[n]$ 为常数时，输出 $y[n]$ 对所有 $n$ 恒为零的条件。证明此条件的必要性和充分性。然后，对于关于中点反对称的FIR系数集，即对所有 $n \\in \\{0,1,\\ldots,N-1\\}$ 满足 $h[n] = -h[N-1-n]$ 的系数集，验证此条件。您的验证必须明确地讨论 $N$ 为偶数和 $N$ 为奇数两种情况（包括 $N$ 为奇数时中心抽头的值）。您可以引用 $h[n]$ 在角频率 $\\omega$（单位：弧度/采样点）下的DTFT为 $H(\\exp(j\\omega)) = \\sum_{n=0}^{N-1} h[n] \\exp(-j\\omega n)$ 这一事实，但您必须从基本定义出发，论证其与系统对常数输入响应之间的关系。\n\n作为最终答案，请提供一个以$\\{h[n]\\}$表示的最简解析表达式，该表达式的值必须为零，以保证对常数输入的输出恰好为零。不要将最终答案表示为方程或不等式；仅提供表达式本身。无需进行数值四舍五入。", "solution": "所述问题具有科学依据、适定且完整。它涉及线性时不变 (LTI) 系统，特别是有限冲激响应 (FIR) 滤波器的基本性质，这是信号处理领域的核心课题。该问题可形式化，并需要从基本定义进行严格推导。因此，该问题是有效的，我们着手求解。\n\n设该系统为一个LTI系统，其特征由有限长度的冲激响应 $\\{h[n]\\}_{n=0}^{N-1}$ 描述，其中对所有 $n \\in \\{0, 1, \\ldots, N-1\\}$ 都有 $h[n] \\in \\mathbb{R}$。对于输入 $x[n]$，该系统的输出 $y[n]$ 由离散时间卷积和给出：\n$$y[n] = \\sum_{k=-\\infty}^{\\infty} h[k] x[n-k]$$\n鉴于冲激响应的长度为有限值 $N$，它仅在 $k \\in \\{0, 1, \\ldots, N-1\\}$ 时非零。卷积和可简化为：\n$$y[n] = \\sum_{k=0}^{N-1} h[k] x[n-k]$$\n输入被指定为一个常数序列，$x[n] = C$（对所有整数 $n$ 成立），其中 $C \\in \\mathbb{R}$ 是一个任意的固定常数。将此代入卷积方程，我们得到对任意 $n$ 和 $k$ 值，都有 $x[n-k] = C$。这得出：\n$$y[n] = \\sum_{k=0}^{N-1} h[k] C$$\n由于常数 $C$ 不依赖于求和指标 $k$，可以将其从求和中提出：\n$$y[n] = C \\left( \\sum_{k=0}^{N-1} h[k] \\right)$$\n问题要求输出 $y[n]$ 对所有 $n$ 恒为零。这意味着 $y[n] = 0$。该方程变为：\n$$C \\left( \\sum_{k=0}^{N-1} h[k] \\right) = 0$$\n此方程必须对常数 $C$ 的任何任意选择都成立。如果我们选择任意 $C \\neq 0$，要使乘积为零，唯一的方法是另一项为零。因此，冲激响应系数必须满足的条件是：\n$$\\sum_{k=0}^{N-1} h[k] = 0$$\n\n我们必须证明此条件的必要性和充分性。\n充分性：假设 $\\sum_{k=0}^{N-1} h[k] = 0$。那么，对于任何输入 $x[n] = C$，输出为 $y[n] = C \\left( \\sum_{k=0}^{N-1} h[k] \\right) = C \\cdot 0 = 0$（对所有 $n$ 成立）。因此，该条件足以保证对任何常数输入的输出为零。\n必要性：假设对于任何常数输入 $x[n] = C$，输出 $y[n]$ 恒为零。这意味着关系式 $C \\left( \\sum_{k=0}^{N-1} h[k] \\right) = 0$ 必须对任何 $C \\in \\mathbb{R}$ 成立。让我们选择一个特定的非零常数，例如 $C=1$。在这种情况下，方程变为 $1 \\cdot \\left( \\sum_{k=0}^{N-1} h[k] \\right) = 0$，这直接意味着 $\\sum_{k=0}^{N-1} h[k] = 0$。因此，该条件是必要的。\n\n现在，我们将此条件与离散时间傅里叶变换 (DTFT) 联系起来。冲激响应 $h[n]$ 的DTFT定义了系统的频率响应，$H(\\exp(j\\omega)) = \\sum_{n=0}^{N-1} h[n] \\exp(-j\\omega n)$。形式为 $\\exp(j\\omega n)$ 的复指数是LTI系统的特征函数。对于输入 $x[n] = A \\exp(j\\omega_{0} n)$，输出为 $y[n] = A H(\\exp(j\\omega_{0})) \\exp(j\\omega_{0} n)$。\n常数输入 $x[n] = C$ 可以看作是频率为零（$\\omega=0$）且幅度为 $C$ 的复指数，即 $x[n] = C \\cdot \\exp(j \\cdot 0 \\cdot n)$。根据特征函数性质，输出为：\n$$y[n] = C \\cdot H(\\exp(j \\cdot 0)) \\cdot \\exp(j \\cdot 0 \\cdot n) = C \\cdot H(\\exp(j0))$$\n$H(\\exp(j0))$ 这一项是系统在 $\\omega=0$ 处的频率响应，即直流增益。根据DTFT的定义：\n$$H(\\exp(j0)) = \\sum_{n=0}^{N-1} h[n] \\exp(-j \\cdot 0 \\cdot n) = \\sum_{n=0}^{N-1} h[n] \\cdot 1 = \\sum_{n=0}^{N-1} h[n]$$\n因此，输出为 $y[n] = C \\sum_{n=0}^{N-1} h[n]$，这与通过直接卷积得到的结果相同。对于任何 $C \\neq 0$，要使 $y[n]$ 恒为零，条件是直流增益必须为零：$H(\\exp(j0)) = 0$，这恰好是条件 $\\sum_{n=0}^{N-1} h[n] = 0$。一个理想的微分器其频率响应必须与 $j\\omega$ 成正比，在 $\\omega=0$ 时为零。我们推导出的条件对一个实际的FIR微分器强制执行了这一要求。\n\n最后，我们必须为一个具有反对称系数的FIR滤波器验证这个条件，即对 $n \\in \\{0, 1, \\ldots, N-1\\}$ 满足 $h[n] = -h[N-1-n]$。我们必须计算和式 $S = \\sum_{n=0}^{N-1} h[n]$ 并证明其为零。我们考虑滤波器长度 $N$ 的两种情况。\n\n情况1：$N$ 为偶数。设 $N=2M$，其中 $M \\ge 1$ 为某个整数。和式为 $S = \\sum_{n=0}^{2M-1} h[n]$。我们可以将和式分为两半：\n$$S = \\sum_{n=0}^{M-1} h[n] + \\sum_{n=M}^{2M-1} h[n]$$\n利用反对称性质 $h[n] = -h[N-1-n] = -h[2M-1-n]$，我们重写第二个求和项：\n$$\\sum_{n=M}^{2M-1} h[n] = \\sum_{n=M}^{2M-1} (-h[2M-1-n])$$\n让我们进行指标变换，令 $k = 2M-1-n$。当 $n$ 的范围从 $M$ 到 $2M-1$ 时，指标 $k$ 的范围从 $M-1$ 递减到 $0$。求和变为：\n$$\\sum_{k=0}^{M-1} (-h[k]) = -\\sum_{k=0}^{M-1} h[k]$$\n将此代回 $S$ 的表达式中：\n$$S = \\left(\\sum_{n=0}^{M-1} h[n]\\right) + \\left(-\\sum_{n=0}^{M-1} h[n]\\right) = 0$$\n对于任何偶数长度 $N$，此条件均成立。\n\n情况2：$N$ 为奇数。设 $N=2M+1$，其中 $M \\ge 0$ 为某个整数。求和指标 $n$ 的范围从 $0$ 到 $2M$。对称中心在 $n=M$ 处。我们首先检查中心系数 $h[M]$ 的值。在 $n=M$ 处使用反对称条件 $h[n] = -h[N-1-n]$：\n$$h[M] = -h[(2M+1)-1-M] = -h[M]$$\n这意味着 $2h[M] = 0$，即 $h[M]=0$。一个奇数长度的反对称FIR滤波器的中心抽头必须为零。现在我们计算和式 $S = \\sum_{n=0}^{2M} h[n]$：\n$$S = \\left(\\sum_{n=0}^{M-1} h[n]\\right) + h[M] + \\left(\\sum_{n=M+1}^{2M} h[n]\\right)$$\n因为 $h[M]=0$，这简化为：\n$$S = \\sum_{n=0}^{M-1} h[n] + \\sum_{n=M+1}^{2M} h[n]$$\n将反对称性质 $h[n] = -h[N-1-n] = -h[2M-n]$ 应用于第二个和式：\n$$\\sum_{n=M+1}^{2M} h[n] = \\sum_{n=M+1}^{2M} (-h[2M-n])$$\n让我们进行指标变换，令 $k=2M-n$。当 $n$ 的范围从 $M+1$ 到 $2M$ 时，指标 $k$ 的范围从 $M-1$ 递减到 $0$。求和变为：\n$$\\sum_{k=0}^{M-1} (-h[k]) = -\\sum_{k=0}^{M-1} h[k]$$\n将此代回 $S$ 的表达式中：\n$$S = \\left(\\sum_{n=0}^{M-1} h[n]\\right) + \\left(-\\sum_{n=0}^{M-1} h[n]\\right) = 0$$\n对于任何奇数长度 $N$，此条件也成立。\n\n在 $N$ 为偶数和奇数的两种情况下，反对称性质都能确保冲激响应系数之和为零。因此，任何具有反对称系数的FIR滤波器对于常数输入都将产生零输出。其值必须为零的最简解析表达式是滤波器系数之和。", "answer": "$$\\boxed{\\sum_{n=0}^{N-1} h[n]}$$", "id": "2864215"}, {"introduction": "在确保了直流响应为零之后，下一步是精确校准微分器在低频区域的行为。理想的离散时间微分器在零频率附近的响应应与角频率 $\\omega$ 成正比，即 $H(\\omega) \\sim j\\omega$。本练习要求你运用泰勒级数展开这一强大的分析工具，来推导一个关键的归一化因子 $\\alpha$，确保任意给定的 FIR 滤波器原型在缩放后能够满足这一单位斜率的理想特性。这个过程对于确保滤波器在低频信号上提供准确的导数估计至关重要。", "problem": "考虑一个实系数有限冲激响应（FIR；Finite Impulse Response）滤波器原型，其抽头为 $\\{g[n]\\}_{n=0}^{N-1}$，设计用于在零频率附近近似一个离散时间微分器，其中 $N \\in \\mathbb{N}$ 且 $N \\geq 2$。假设该原型具有零直流（DC）增益，即 $\\sum_{n=0}^{N-1} g[n] = 0$，并且其离散时间傅里叶变换（DTFT；Discrete-Time Fourier Transform）表现出奇对称的低频响应，从而在其小角度展开中包含一个线性项。定义一个缩放滤波器 $h[n] = \\alpha\\, g[n]$，其中 $\\alpha \\in \\mathbb{R}$ 为实标量，其DTFT记为\n$$\nH(\\omega) \\triangleq \\sum_{n=0}^{N-1} h[n] \\exp(-j \\omega n), \\quad \\omega \\in \\mathbb{R},\n$$\n其中 $\\omega$ 以弧度为单位。\n\n仅从上述DTFT定义和复指数在小 $\\omega$ 下的泰勒展开出发，推导实标量 $\\alpha$ 的解析表达式，该表达式用于归一化该微分器，使得在极限 $\\omega \\to 0$ 时，复频率响应满足 $H(\\omega) \\sim j \\omega$（即零频率附近的单位斜率理想微分器行为）。请以关于原型抽头 $\\{g[n]\\}$ 和 $N$ 的单个闭式表达式的形式给出您的最终答案。不需要进行数值计算，也不应进行四舍五入。全文中的角度均以弧度表示。", "solution": "该问题要求推导一个有限冲激响应（FIR）滤波器原型 $\\{g[n]\\}_{n=0}^{N-1}$ 的缩放因子 $\\alpha$，使得缩放后的滤波器 $h[n] = \\alpha g[n]$ 在 $\\omega$ 接近 $0$ 的频率处近似于理想微分器。目标行为由渐近关系 $H(\\omega) \\sim j \\omega$（当 $\\omega \\to 0$ 时）指定，其中 $H(\\omega)$ 是 $h[n]$ 的离散时间傅里叶变换（DTFT）。\n\n分析从缩放后滤波器的冲激响应 $h[n]$ 的DTFT定义开始：\n$$\nH(\\omega) = \\sum_{n=0}^{N-1} h[n] \\exp(-j \\omega n)\n$$\n代入关系式 $h[n] = \\alpha g[n]$，其中 $\\alpha \\in \\mathbb{R}$ 是我们所求的实数缩放因子，得到：\n$$\nH(\\omega) = \\sum_{n=0}^{N-1} (\\alpha g[n]) \\exp(-j \\omega n) = \\alpha \\sum_{n=0}^{N-1} g[n] \\exp(-j \\omega n)\n$$\n当 $\\omega \\to 0$ 时，$H(\\omega) \\sim j \\omega$ 的条件关系到 $H(\\omega)$ 在 $\\omega = 0$ 附近的具体行为。这表明需要使用其在 $\\omega = 0$ 附近的泰勒级数展开来分析该函数。我们对小 $\\omega$ 情况下的复指数项 $\\exp(-j \\omega n)$ 进行展开：\n$$\n\\exp(-j \\omega n) = 1 - j\\omega n + \\frac{(-j\\omega n)^2}{2!} + \\frac{(-j\\omega n)^3}{3!} + \\dots = 1 - j\\omega n - \\frac{\\omega^2 n^2}{2} + j\\frac{\\omega^3 n^3}{6} + O(\\omega^4)\n$$\n将此展开式代入 $H(\\omega)$ 的表达式中：\n$$\nH(\\omega) = \\alpha \\sum_{n=0}^{N-1} g[n] \\left( 1 - j\\omega n - \\frac{\\omega^2 n^2}{2} + \\dots \\right)\n$$\n我们可以将求和分配到级数的各个项上：\n$$\nH(\\omega) = \\alpha \\left( \\sum_{n=0}^{N-1} g[n] - j\\omega \\sum_{n=0}^{N-1} n g[n] - \\frac{\\omega^2}{2} \\sum_{n=0}^{N-1} n^2 g[n] + \\dots \\right)\n$$\n题目陈述为滤波器原型提供了一个关键条件：它具有零直流（DC）增益。在数学上，这表示为：\n$$\n\\sum_{n=0}^{N-1} g[n] = 0\n$$\n这个条件意味着 $H(\\omega)$ 展开式中的第一项为零。因此，表达式简化为：\n$$\nH(\\omega) = \\alpha \\left( -j\\omega \\sum_{n=0}^{N-1} n g[n] - \\frac{\\omega^2}{2} \\sum_{n=0}^{N-1} n^2 g[n] + \\dots \\right)\n$$\n对于小 $\\omega$（即当 $\\omega \\to 0$ 时），展开式中的主导项是 $\\omega$ 的最低次幂项。假设线性项的系数不为零（题目前提已暗示该滤波器包含线性项），我们得到以下渐近行为：\n$$\nH(\\omega) \\sim -j \\alpha \\omega \\sum_{n=0}^{N-1} n g[n]\n$$\n题目要求此行为与零频率附近的理想微分器行为相匹配，即 $H(\\omega) \\sim j \\omega$。我们令两个渐近表达式相等：\n$$\n-j \\alpha \\omega \\sum_{n=0}^{N-1} n g[n] \\sim j \\omega\n$$\n为使此等价关系对所有小的非零 $\\omega$ 成立，两边 $j\\omega$ 项的系数必须相等。这给出了方程：\n$$\n- \\alpha \\sum_{n=0}^{N-1} n g[n] = 1\n$$\n对该方程求解缩放因子 $\\alpha$，即可得到所求的表达式。为了使 $\\alpha$ 有明确定义，求和项 $\\sum_{n=0}^{N-1} n g[n]$ 必须不为零，这个条件对于任何实际的微分器设计都是成立的。$\\alpha$ 的解为：\n$$\n\\alpha = - \\frac{1}{\\sum_{n=0}^{N-1} n g[n]}\n$$\n该表达式给出了归一化常数 $\\alpha$，它完全由原型滤波器抽头值 $\\{g[n]\\}$ 和滤波器长度 $N$（因为求和的上限是 $N-1$）来表示。", "answer": "$$\n\\boxed{- \\frac{1}{\\sum_{n=0}^{N-1} n g[n]}}\n$$", "id": "2864240"}, {"introduction": "理论上的理想特性必须在现实世界的设计约束下实现。在 FIR 滤波器设计中，最核心的权衡之一在于滤波器长度 $N$ 与其性能指标（如通带误差和阻带衰减）之间的关系。本练习将理论与工程实践相结合，要求你将抽象的性能规格（如最大相对误差 $\\delta_p$ 和阻带衰减 $\\delta_s$）转化为一个具体的、可计算的滤波器初始长度 $N$。通过推导并实现一个基于经典经验公式的估算程序，你将掌握将高级设计目标转化为初步设计参数的关键技能。", "problem": "您的任务是设计一个有原则的算法流程，用于计算满足联合通带相对误差和阻带幅度约束的有限脉冲响应 (FIR) 微分器的滤波器长度的初始估计值。考虑一个实系数、线性相位、反对称的有限脉冲响应 (FIR) 微分器（III 型），其理想频率响应幅度与频率成正比。期望的幅度响应定义为在通带区间上 $\\lvert H_d(\\omega) \\rvert = \\omega$，在阻带区间上 $\\lvert H_d(\\omega) \\rvert = 0$。所有角频率的单位均为弧度/采样点，并且在您的推导和实现中，任何对角度的引用都必须使用弧度单位。\n\n从离散时间傅里叶变换行为的基本定义以及有限脉冲响应滤波器的标准加窗近似原理（特别是过渡带宽度和衰减如何共同控制所需长度）出发，推导出一个可计算的流程，将以下形式的联合规格转换为初始长度估计值：\n- 在 $\\omega \\in [\\omega_\\ell,\\omega_p]$ 上的通带相对误差界：\n  $$\\max_{\\omega \\in [\\omega_\\ell,\\omega_p]} \\frac{\\lvert H(\\omega) - j\\omega \\rvert}{\\omega} \\le \\delta_p,$$\n  其中 $\\omega_\\ell  0$ 是一个严格大于零的下界，以避免相对误差在零点处的病态问题。\n- 在 $\\omega \\in [\\omega_s,\\pi]$ 上的阻带幅度界：\n  $$\\max_{\\omega \\in [\\omega_s,\\pi]} \\lvert H(\\omega) \\rvert \\le \\delta_s.$$\n\n您的推导必须：\n- 从过渡带宽度与可实现的有限脉冲响应滤波器长度之间的基本关系，以及旁瓣衰减与容许波纹之间的联系开始，这两者都源于加窗近似理论和等波纹优化论证。具体来说，您必须基于以下事实进行推理：更窄的过渡带需要更长的滤波器，更严格的幅度约束会增加所需长度。这些事实已通过窗函数设计文献中经过充分检验且被广泛接受的近似方法形式化。\n- 将相对通带规格转换为绝对幅度约束，以便能与阻带幅度界直接比较，然后确定哪个约束在初始阶数估计中起主导作用。\n- 给出初始长度估计值 $N_0$ 关于衰减度量和过渡带宽度的显式解析表达式，然后通过将 $N_0$ 映射到不小于 $N_0$ 的最近奇数，来施加 III 型反对称微分器的结构性要求。\n\n将得到的流程实现为一个程序，对于下方的每个测试用例，该程序计算一个单一整数 $N$，其值等于大于或等于所推导出的实数值初始长度估计的最小奇数。如果该实数值估计已为奇数，则原样返回；如果为偶数，则加 1；如果为非整数，则向上取整，若结果为偶数，再加 1。\n\n角度单位要求：所有角度都必须以弧度为单位。本问题中除弧度外没有其他物理单位。\n\n测试套件（每个用例是一个 5元组 $(\\omega_\\ell,\\omega_p,\\omega_s,\\delta_p,\\delta_s)$，其中 $0  \\omega_\\ell  \\omega_p  \\omega_s \\le \\pi$ 且 $0  \\delta_p  1, 0  \\delta_s  1$）：\n- 用例 1： $(0.05\\pi,\\;0.6\\pi,\\;0.7\\pi,\\;0.01,\\;0.001)$\n- 用例 2： $(0.1\\pi,\\;0.8\\pi,\\;0.9\\pi,\\;0.001,\\;0.01)$\n- 用例 3： $(0.05\\pi,\\;0.5\\pi,\\;0.8\\pi,\\;0.00191,\\;0.002)$\n- 用例 4： $(0.05\\pi,\\;0.4\\pi,\\;0.405\\pi,\\;0.005,\\;0.0003)$\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的结果顺序与上述用例的顺序相同（例如，$[n_1,n_2,n_3,n_4]$）。每个 $n_k$ 都必须是整数。不允许任何其他输出。", "solution": "所提出的问题是关于有限脉冲响应 (FIR) 数字滤波器设计（特别是 III 型微分器）的一个有效且适定的练习。它要求基于标准的频域规格，推导并实现一个算法流程，以提供滤波器长度 $N$ 的初始估计值。该问题在科学上基于数字信号处理的既定原理，并包含了获得唯一解所需的所有信息。我们将进行严格的推导。\n\n目标是设计一个实系数、线性相位、反对称的 FIR 微分器。此类微分器的理想频率响应为 $H_d(\\omega) = j\\omega$，其中 $\\omega$ 是角频率，单位为弧度/采样点。其幅度响应为 $|H_d(\\omega)| = \\omega$，相位为常数 $\\pi/2$。与此理想情况对应的脉冲响应是非因果且无限长的，由 $h_d(n) = \\frac{\\cos(\\pi n)}{n}$（对于 $n \\neq 0$）和 $h_d(0) = 0$ 给出。\n\n一个实用的 FIR 滤波器必须具有有限长度 $N$。为了保持线性相位并近似理想微分器的反对称性，其脉冲响应 $h(n)$ 必须满足 $h(n) = -h(N-1-n)$，其中 $n \\in [0, N-1]$。这个约束意味着中心抽头 $h((N-1)/2) = 0$。如果 $N$ 是一个奇数（III 型滤波器），这个条件会自然满足，因为脉冲响应仅在整数索引处有定义。为此，本问题正确地强制要求使用奇数长度。\n\n从频域规格设计 FIR 滤波器涉及在滤波器长度 $N$、频带间过渡的陡峭程度（过渡带宽度）以及指定频带内近似的准确度（波纹）之间进行权衡。源自对基于窗函数的设计方法和最优等波纹设计方法的大量研究而得出的、已被广泛认可的经验公式量化了这种关系。我们的任务是将这些通用原理应用于给定的微分器问题的特定约束。\n\n提供的规格如下：\n1. 通带相对误差界：\n$$ \\max_{\\omega \\in [\\omega_\\ell,\\omega_p]} \\frac{| H(\\omega) - j\\omega |}{\\omega} \\le \\delta_p $$\n2. 阻带幅度界：\n$$ \\max_{\\omega \\in [\\omega_s,\\pi]} | H(\\omega) | \\le \\delta_s $$\n\n让我们分析这些约束，以提取长度估算公式所需的参数。基本参数是过渡带宽度 $\\Delta\\omega$ 和一个单一的控制性波纹值 $\\delta$。\n\n过渡带位于通带边缘 $\\omega_p$ 和阻带边缘 $\\omega_s$ 之间。因此，该带宽为：\n$$ \\Delta\\omega = \\omega_s - \\omega_p $$\n较小的 $\\Delta\\omega$ 意味着更陡峭的过渡，并需要更长的滤波器。\n\n接下来，我们必须将两个波纹规格统一为一个单一的控制参数。阻带约束给出了一个绝对波纹幅度 $\\delta_s$。通带约束是一个相对误差。我们将其转换为一个等效的绝对误差约束：\n$$ | H(\\omega) - j\\omega | \\le \\delta_p \\omega, \\quad \\text{for } \\omega \\in [\\omega_\\ell, \\omega_p] $$\n这建立了一个随频率线性变化的绝对误差界。为了估算所需的总滤波器长度，通常会考虑通带内的最大绝对偏差点，该点出现在频带上边缘 $\\omega_p$ 处。因此，有效绝对通带波纹 $\\delta'_p$ 定义为：\n$$ \\delta'_p = \\delta_p \\omega_p $$\n滤波器设计必须同时满足有效通带约束 $\\delta'_p$ 和阻带约束 $\\delta_s$。一种最优设计方法，例如 Parks-McClellan 算法，将受这两个约束中更严格的那一个的限制。因此，我们将控制性波纹 $\\delta$ 定义为这两个值的最小值：\n$$ \\delta = \\min(\\delta'_p, \\delta_s) = \\min(\\delta_p \\omega_p, \\delta_s) $$\n\n根据这个控制性波纹 $\\delta$，我们计算所需的最小衰减 $A_s$（单位为分贝，dB）：\n$$ A_s = -20 \\log_{10}(\\delta) $$\n衰减 $A_s$ 和过渡带宽度 $\\Delta\\omega$ 是决定滤波器长度的两个关键参数。\n\n存在许多经验公式可用于估算 FIR 滤波器长度。我们选用 Kaiser 广为引用的公式，该公式为使用加窗法和最优法设计的滤波器提供了一个可靠的初始估计。它将滤波器长度与衰减和过渡带宽度稳健地联系起来：\n$$ N_0 \\approx \\frac{A_s - C_1}{C_2 \\Delta\\omega} $$\n常数 $C_1$ 和 $C_2$ 是通过经验推导的。该公式一个常见且经过充分验证的形式是：\n$$ N_0 = \\frac{A_s - 8}{2.285 \\Delta\\omega} $$\n此处，$N_0$ 是实数值的初始长度估计。该公式源于 Kaiser 窗的特性，而 Kaiser 窗本身是离散扁长球状序列（时频集中问题的最优解）的一个近似。它为长度估计提供了一个优秀的、有原则的出发点。\n\n最后，我们必须强制执行滤波器的结构性要求，即它必须是 III 型，这意味着其长度 $N$ 必须是一个正奇数。推导出的估计值 $N_0$ 是一个实数。所需的长度 $N$ 是大于或等于 $N_0$ 的最小奇数。这通过以下流程确定：\n1. 计算 $N_0$ 的向上取整值：$N_{ceil} = \\lceil N_0 \\rceil$。\n2. 如果 $N_{ceil}$ 是奇数，则最终长度为 $N = N_{ceil}$。\n3. 如果 $N_{ceil}$ 是偶数，则最终长度为 $N = N_{ceil} + 1$。\n\n总结来说，完整的算法流程如下：\n1. 给定输入参数 $(\\omega_\\ell, \\omega_p, \\omega_s, \\delta_p, \\delta_s)$。\n2. 计算过渡带宽度：$\\Delta\\omega = \\omega_s - \\omega_p$。\n3. 计算有效绝对通带波纹：$\\delta'_p = \\delta_p \\omega_p$。\n4. 确定控制性波纹：$\\delta = \\min(\\delta'_p, \\delta_s)$。\n5. 计算所需的衰减（单位为分贝）：$A_s = -20 \\log_{10}(\\delta)$。\n6. 使用 Kaiser 公式计算初始实数值长度估计：$N_0 = \\frac{A_s - 8}{2.285 \\Delta\\omega}$。\n7. 通过找到大于或等于 $N_0$ 的最小奇数来计算最终整数长度 $N$。\n\n该流程在科学上是合理的，直接从 FIR 滤波器设计的基本原理推导而来，并为获取所需的长度估计值提供了一种可计算的方法。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes an initial estimate for the length of a Type III FIR differentiator\n    based on frequency-domain specifications.\n    \"\"\"\n\n    # Test suite:\n    # Each case is a 5-tuple (omega_l, omega_p, omega_s, delta_p, delta_s)\n    test_cases = [\n        (0.05 * np.pi, 0.6 * np.pi, 0.7 * np.pi, 0.01, 0.001),\n        (0.1 * np.pi, 0.8 * np.pi, 0.9 * np.pi, 0.001, 0.01),\n        (0.05 * np.pi, 0.5 * np.pi, 0.8 * np.pi, 0.00191, 0.002),\n        (0.05 * np.pi, 0.4 * np.pi, 0.405 * np.pi, 0.005, 0.0003),\n    ]\n\n    results = []\n    for case in test_cases:\n        omega_l, omega_p, omega_s, delta_p, delta_s = case\n\n        # Step 1: Calculate the transition width (rad/sample).\n        # Frequency specifications are already in radians.\n        delta_omega = omega_s - omega_p\n\n        # Step 2: Convert relative passband error to an effective absolute error.\n        # The maximum absolute deviation is used for estimation, occurring at omega_p.\n        delta_p_abs = delta_p * omega_p\n\n        # Step 3: Determine the controlling ripple.\n        # The design is limited by the more stringent of the two ripple specifications.\n        delta = np.min([delta_p_abs, delta_s])\n\n        # Step 4: Calculate the required stopband attenuation in decibels (dB).\n        # A_s = -20 * log10(delta)\n        A_s = -20.0 * np.log10(delta)\n\n        # Step 5: Calculate the initial real-valued length estimate using Kaiser's formula.\n        # N0 ~ (A_s - 8) / (2.285 * delta_omega)\n        # This formula is widely used for initial estimates in FIR filter design.\n        N0 = (A_s - 8.0) / (2.285 * delta_omega)\n\n        # Step 6: Determine the final filter length N.\n        # N must be the smallest odd integer greater than or equal to the estimate N0,\n        # as required for a Type III FIR filter.\n        n_ceil = int(np.ceil(N0))\n        if n_ceil % 2 == 0:\n            N = n_ceil + 1\n        else:\n            N = n_ceil\n        results.append(N)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "2864252"}]}