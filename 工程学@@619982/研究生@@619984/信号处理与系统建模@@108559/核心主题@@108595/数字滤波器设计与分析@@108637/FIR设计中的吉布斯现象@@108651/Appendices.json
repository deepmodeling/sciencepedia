{"hands_on_practices": [{"introduction": "第一个练习将我们带回基本原理。通过从数学上推导理想滤波器在截断（等同于矩形窗）后的频率响应，你将揭示时域中的这种截断如何不可避免地在频域中产生振荡纹波。这个基础练习阐明了吉布斯现象的数学根源。[@problem_id:2912668]", "problem": "考虑一个理想离散时间低通滤波器，其单位增益，截止频率为 $\\,\\omega_c \\in (0,\\pi)\\,$，脉冲响应为 $\\,h_d[n] = \\frac{\\sin(\\omega_c n)}{\\pi n}\\,$（当 $\\,n \\neq 0\\,$ 时）以及 $\\,h_d[0] = \\frac{\\omega_c}{\\pi}\\,$. 通过关于原点的矩形截断，构建一个对称的、长度为 $N$（$N$ 为奇数）的有限脉冲响应：\n- 令 $\\,N = 2M+1\\,$，其中 $\\,M \\in \\mathbb{N}\\,$.\n- 定义 $\\,h_N[n] = h_d[n]\\,$（当 $\\,n \\in \\{-M,-M+1,\\dots,0,\\dots,M-1,M\\}\\,$ 时），其他情况下 $\\,h_N[n] = 0\\,$.\n\n仅使用离散时间傅里叶变换 (DTFT)、理想低通频率响应和矩形窗的定义，推导 $\\,h_N[n]\\,$ 的 DTFT $\\,H_N(\\omega)\\,$，并将其简化为关于 $\\,\\omega\\,$ 和 $\\,N\\,$ 的实余弦级数。然后，通过将 $\\,H_N(\\omega)\\,$ 解释为理想矩形频率响应的有限傅里叶级数近似，表示出：\n- 通带偏差 $\\,\\Delta_p(\\omega;N) := H_N(\\omega) - 1\\,$（对于 $\\,|\\omega| < \\omega_c\\,$），以及\n- 阻带幅度 $\\,E_s(\\omega;N) := |H_N(\\omega)|\\,$（对于 $\\,|\\omega| > \\omega_c\\,$），\n\n用 $\\,N\\,$ 和 $\\,\\omega\\,$ 明确表示它们，并说明在远离过渡边沿 $\\,\\pm \\omega_c\\,$ 处它们对 $\\,N\\,$ 和 $\\,\\omega\\,$ 的领头阶依赖关系，同时评论在 $\\,\\omega = \\pm \\omega_c\\,$ 处的吉布斯现象。角度必须以弧度为单位。将您推导出的 $\\,H_N(\\omega)\\,$ 的单一闭式表达式作为最终答案报告。不需要进行数值四舍五入。", "solution": "问题陈述需进行验证。\n\n步骤 1：提取已知条件\n- 理想离散时间低通滤波器脉冲响应：$h_d[n] = \\frac{\\sin(\\omega_c n)}{\\pi n}$（当 $n \\neq 0$ 时）以及 $h_d[0] = \\frac{\\omega_c}{\\pi}$。\n- 截止频率：$\\omega_c \\in (0,\\pi)$。\n- 滤波器增益：单位增益 ($1$)。\n- 有限脉冲响应 (FIR) 滤波器长度：$N$，其中 $N$ 为奇数。\n- $N$ 和 $M$ 之间的关系：$N = 2M+1$，其中 $M \\in \\mathbb{N}$。\n- FIR 脉冲响应定义：$h_N[n] = h_d[n]$（当 $n \\in \\{-M, \\dots, M\\}$ 时）以及 $h_N[n]=0$（其他情况）。\n\n步骤 2：使用提取的已知条件进行验证\n- **科学依据充分：** 该问题是数字信号处理中一个关于使用窗函数法设计 FIR 滤波器的标准练习。理想低通滤波器、其脉冲响应（一个 sinc 函数）以及通过矩形窗进行截断的过程都是该领域中基本且正确的概念。所要求的分析涉及到吉布斯现象，这是一个公认的数学和物理效应。该问题在科学上是合理的。\n- **适定性：** 该问题陈述清晰。它要求推导截断滤波器的频率响应，分析其与理想情况的偏差，并对吉布斯现象进行评论。所有必需的信息都已提供，足以推导出唯一且有意义的解。\n- **客观性：** 该问题使用精确的数学语言表述，没有任何主观性或歧义。\n\n步骤 3：结论与行动\n该问题是有效的。将构建一个严谨的解。\n\n有限脉冲响应滤波器 $h_N[n]$ 的频率响应 $H_N(\\omega)$ 由其离散时间傅里叶变换 (DTFT) 给出：\n$$H_N(\\omega) = \\sum_{n=-\\infty}^{\\infty} h_N[n] \\exp(-j\\omega n)$$\n根据定义，$h_N[n]$ 仅在 $|n| \\le M$（其中 $N=2M+1$）时非零。因此，求和是在一个有限范围内进行的：\n$$H_N(\\omega) = \\sum_{n=-M}^{M} h_N[n] \\exp(-j\\omega n)$$\n在此范围内代入定义 $h_N[n] = h_d[n]$，我们得到：\n$$H_N(\\omega) = \\sum_{n=-M}^{M} h_d[n] \\exp(-j\\omega n)$$\n我们将 $n=0$ 项从和式中分离出来：\n$$H_N(\\omega) = h_d[0] + \\sum_{n=-M, n \\neq 0}^{M} h_d[n] \\exp(-j\\omega n)$$\n代入给定的 $h_d[n]$ 表达式：\n$$H_N(\\omega) = \\frac{\\omega_c}{\\pi} + \\sum_{n=-M, n \\neq 0}^{M} \\frac{\\sin(\\omega_c n)}{\\pi n} \\exp(-j\\omega n)$$\n我们可以将求和分解为正索引和负索引部分：\n$$H_N(\\omega) = \\frac{\\omega_c}{\\pi} + \\sum_{n=1}^{M} \\frac{\\sin(\\omega_c n)}{\\pi n} \\exp(-j\\omega n) + \\sum_{n=-M}^{-1} \\frac{\\sin(\\omega_c n)}{\\pi n} \\exp(-j\\omega n)$$\n在第二个求和中，令 $k = -n$。当 $n$ 从 $-M$ 变化到 $-1$ 时，$k$ 从 $M$ 变化到 $1$：\n$$\\sum_{k=1}^{M} \\frac{\\sin(\\omega_c (-k))}{\\pi (-k)} \\exp(-j\\omega (-k)) = \\sum_{k=1}^{M} \\frac{-\\sin(\\omega_c k)}{-\\pi k} \\exp(j\\omega k) = \\sum_{k=1}^{M} \\frac{\\sin(\\omega_c k)}{\\pi k} \\exp(j\\omega k)$$\n将虚拟索引 $k$ 替换为 $n$ 并代回：\n$$H_N(\\omega) = \\frac{\\omega_c}{\\pi} + \\sum_{n=1}^{M} \\frac{\\sin(\\omega_c n)}{\\pi n} \\exp(-j\\omega n) + \\sum_{n=1}^{M} \\frac{\\sin(\\omega_c n)}{\\pi n} \\exp(j\\omega n)$$\n提取公因式：\n$$H_N(\\omega) = \\frac{\\omega_c}{\\pi} + \\sum_{n=1}^{M} \\frac{\\sin(\\omega_c n)}{\\pi n} (\\exp(-j\\omega n) + \\exp(j\\omega n))$$\n使用欧拉公式 $\\exp(j\\theta) + \\exp(-j\\theta) = 2\\cos(\\theta)$，我们得到 $H_N(\\omega)$ 的简化实余弦级数表达式：\n$$H_N(\\omega) = \\frac{\\omega_c}{\\pi} + \\frac{2}{\\pi} \\sum_{n=1}^{M} \\frac{\\sin(\\omega_c n) \\cos(\\omega n)}{n}$$\n由于 $M = (N-1)/2$，用 $N$ 表示的表达式为：\n$$H_N(\\omega) = \\frac{\\omega_c}{\\pi} + \\frac{2}{\\pi} \\sum_{n=1}^{(N-1)/2} \\frac{\\sin(\\omega_c n) \\cos(\\omega n)}{n}$$\n此函数是理想频率响应 $H_d(\\omega)$（一个周期性矩形波）的截断傅里叶级数。\n\n接下来，我们分析滤波器的性能。理想响应在 $|\\omega| < \\omega_c$ 时为 $H_d(\\omega)=1$，在 $\\omega_c < |\\omega| \\le \\pi$ 时为 $H_d(\\omega)=0$。\n\n对于 $|\\omega| < \\omega_c$ 的通带偏差为 $\\Delta_p(\\omega;N) = H_N(\\omega) - 1$。\n$$\\Delta_p(\\omega;N) = \\left( \\frac{\\omega_c}{\\pi} + \\frac{2}{\\pi} \\sum_{n=1}^{M} \\frac{\\sin(\\omega_c n) \\cos(\\omega n)}{n} \\right) - 1$$\n此偏差代表了截断理想响应的无穷傅里叶级数所产生的误差。在此区域内，无穷级数收敛于 $1$。因此，误差项是级数的尾部：\n$$\\Delta_p(\\omega;N) = - \\frac{2}{\\pi} \\sum_{n=M+1}^{\\infty} \\frac{\\sin(\\omega_c n) \\cos(\\omega n)}{n}$$\n远离过渡边沿（即，对于 $|\\omega_c - |\\omega|| \\gg 2\\pi/N$），此偏差的幅度以 $O(1/N)$ 的速度衰减。\n\n对于 $|\\omega| > \\omega_c$ 的阻带幅度为 $E_s(\\omega;N) = |H_N(\\omega)|$。\n$$E_s(\\omega;N) = \\left| \\frac{\\omega_c}{\\pi} + \\frac{2}{\\pi} \\sum_{n=1}^{M} \\frac{\\sin(\\omega_c n) \\cos(\\omega n)}{n} \\right|$$\n这代表了泄漏到阻带中的能量。在此区域内，无穷级数收敛于 $0$。因此，$H_N(\\omega)$ 本身就是误差。远离过渡边沿，这些阻带波纹的幅度也以 $O(1/N)$ 的速度衰减。\n\n最后，我们讨论吉布斯现象。在 $n=M$ 处截断傅里叶级数会导致特征性振荡，特别是在 $\\omega = \\pm \\omega_c$ 的不连续点附近。理想矩形频率响应与矩形窗的类 sinc 谱的卷积导致了这些振荡。随着 $N$ 的增加，滤波器的过渡带变窄，波纹向不连续点处更加压缩。然而，与不连续点相邻的第一个波纹的幅度不会减小。这就是吉布斯现象。在通带中，频率响应会过冲目标值 $1$，达到约 $1.09$ 的峰值。在阻带中，它会下冲目标值 $0$，达到约 $-0.09$ 的最小值。这种过冲/下冲的幅度，大约是不连续点处跳跃高度的 $9\\%$，是一个与滤波器长度 $N$ 无关的常数。该现象说明了傅里叶级数在跳跃不连续点处的非一致收敛性。", "answer": "$$\\boxed{\\frac{\\omega_c}{\\pi} + \\frac{2}{\\pi} \\sum_{n=1}^{(N-1)/2} \\frac{\\sin(\\omega_c n) \\cos(\\omega n)}{n}}$$", "id": "2912668"}, {"introduction": "这个练习将我们从纯理论带到实际仿真，让你亲眼“看到”吉布斯现象。你将设计滤波器并将其应用于阶跃函数输入，从而在视觉上和数量上测量产生的过冲和振铃。更重要的是，通过比较基本的矩形窗和更复杂的汉明窗，你将亲身体验窗函数如何作为缓解这些不必要伪影的强大工具。[@problem_id:2436691]", "problem": "设计一系列线性相位有限脉冲响应 (FIR) 低通滤波器，将每个滤波器应用于一个离散时间单位阶跃输入，并量化出现在阶跃不连续点附近的波纹。任务是使用直接从第一性原理计算的、定义明确的度量指标，来形式化并测量 Gibbs 现象。请使用以下定义和要求。\n\n设采样频率为 $f_s$ 赫兹，滤波器长度（抽头数）为 $N$ 个采样点，截止频率为 $f_c$ 赫兹。考虑一个幅度为 $A=1$ 的离散时间单位阶跃输入 $u[n]$，其定义为 $n0$ 时 $u[n]=0$，$n \\ge 0$ 时 $u[n]=1$。实现一个长度为 $L$ 个采样点的有限长度序列，通过在索引 $n_0=\\lfloor L/2 \\rfloor$ 处放置一个单阶跃来近似 $u[n]$，使得 $0 \\le n  n_0$ 时 $x[n]=0$，$n_0 \\le n \\le L-1$ 时 $x[n]=1$。使用 $L=32768$ 个采样点和 $A=1$（无量纲）。不涉及角度。\n\n对于下方的每个测试用例，使用标准的窗函数 sinc 方法和指定的窗函数，设计一个长度为 $N$ 的因果、实数、线性相位 FIR 低通滤波器 $h[n]$，以近似截止频率为 $f_c$ 的理想低通响应。用 $y[n]=(x*h)[n]$ 表示离散时间卷积。设稳态值为 $y_{\\mathrm{ss}}=\\sum_{k=0}^{N-1} h[k] \\cdot A$，这是单位阶跃输入在瞬态响应结束后的输出值。\n\n定义以下直接从 $y[n]$ 计算的定量度量：\n- 过冲率 $r_{\\mathrm{over}}=\\max\\left(0,\\dfrac{\\max_{n\\in\\mathcal{I}} y[n]-y_{\\mathrm{ss}}}{y_{\\mathrm{ss}}}\\right)$，其中分析索引集为 $\\mathcal{I}=\\{n_0,n_0+1,\\dots,n_0+4N-1\\}$，并截断至有效输出索引范围。\n- 下冲率 $r_{\\mathrm{under}}=\\max\\left(0,\\dfrac{y_{\\mathrm{ss}}-\\min_{n\\in\\mathcal{I}} y[n]}{y_{\\mathrm{ss}}}\\right)$。\n- 波纹过零计数 $Z$，定义为当 $n$ 以递增方式扫描时，序列 $w[n]=y[n]-y_{\\mathrm{ss}}$（对于 $n\\in\\mathcal{I}$）的符号变化次数，并忽略任何 $w[n]$ 精确为零的索引；也就是说，$Z$ 是 $w[n]$ 的符号与 $\\mathcal{I}$ 中紧邻的前一个非零符号样本不同的索引计数。\n\n所有频率必须以赫兹为单位进行解释和使用。输出度量 $r_{\\mathrm{over}}$ 和 $r_{\\mathrm{under}}$ 必须以小数形式报告（不带百分号），$Z$ 必须为整数。\n\n测试套件（每一项都是一个独立的测试用例）：\n- 用例 1：$N=129$，$f_s=1000$ 赫兹，$f_c=100$ 赫兹，窗函数类型 \"hamming\"。\n- 用例 2：$N=129$，$f_s=1000$ 赫兹，$f_c=100$ 赫兹，窗函数类型 \"boxcar\" (矩形)。\n- 用例 3：$N=513$，$f_s=1000$ 赫兹，$f_c=100$ 赫兹，窗函数类型 \"boxcar\" (矩形)。\n- 用例 4：$N=129$，$f_s=1000$ 赫兹，$f_c=225$ 赫兹，窗函数类型 \"boxcar\" (矩形)。\n- 用例 5：$N=31$，$f_s=1000$ 赫兹，$f_c=100$ 赫兹，窗函数类型 \"boxcar\" (矩形)。\n\n程序输入：无。程序操作：根据每个用例的陈述实现定义，使用 $L=32768$ 和 $n_0=\\lfloor L/2 \\rfloor$ 定义 $x[n]$，通过离散时间卷积计算 $y[n]=(x*h)[n]$，然后按定义计算 $r_{\\mathrm{over}}$、$r_{\\mathrm{under}}$ 和 $Z$。\n\n最终输出格式：您的程序应生成单行文本，其中包含一个顶级列表，每个测试用例对应一个子列表，并按上述顺序排列。每个子列表必须为 $[r_{\\mathrm{over}},r_{\\mathrm{under}},Z]$ 的形式。两个比率必须四舍五入到恰好 $6$ 位小数，$Z$ 必须为整数。该行除逗号、方括号、数字和小数点外，不得包含任何多余字符或空格。例如，一个包含两个用例的语法有效输出应如下所示：$[[0.012345,0.006789,42],[0.000000,0.000000,0]]$。", "solution": "所述问题已经过严格验证，并被证实是有效的。它在科学上基于数字信号处理的既定原理，特别是有限脉冲响应 (FIR) 滤波器的设计和对其瞬态行为的分析。该问题是适定的，提供了为每个测试用例计算出唯一且有意义的解所需的所有定义、参数和约束。其语言客观、精确，没有歧义。所有关于信号、滤波器和度量指标的定义都是形式化的，并且可在计算上实现。\n\n任务是使用窗函数 sinc 方法设计一组线性相位 FIR 低通滤波器，并量化在其阶跃响应中观察到的 Gibbs 现象。当信号从其截断的频率分量集合中重建时，Gibbs 现象表现为在阶跃不连续点附近出现持续的过冲和下冲（波纹）。这正是一个理想阶跃输入通过一个实际的、非理想低通滤波器时所发生的情况。\n\n设计和分析将分三个阶段进行：1) FIR 滤波器设计，2) 系统响应计算，以及 3) 度量指标评估。\n\n**1. 通过窗函数 sinc 方法设计线性相位 FIR 滤波器**\n\n一个理想的低通滤波器具有矩形频率响应，对于低于截止频率 $f_c$ 的频率，其响应为 1，高于该频率则为零。其在离散时间域中对应的脉冲响应 $h_{ideal}[n]$ 是通过离散时间傅里叶逆变换 (DTFT) 获得的。对于归一化截止频率 $\\omega_c = 2\\pi f_c / f_s$，理想脉冲响应是一个 sinc 函数：\n$$h_{ideal}[n] = \\frac{\\sin(\\omega_c n)}{\\pi n} \\quad \\text{for } n \\neq 0$$\n在 $n=0$ 处，该表达式的极限是 $h_{ideal}[0] = \\omega_c / \\pi = 2 f_c / f_s$。该脉冲响应是非因果的（它在 $n  0$ 时存在）并且具有无限长度，这使其在物理上不可实现。\n\n要创建一个长度为 $N$ 的实用 FIR 滤波器，我们必须截断 $h_{ideal}[n]$。简单的截断等效于将 $h_{ideal}[n]$ 乘以一个矩形窗（指定为 \"boxcar\"）。这种在时域中的突兀截断会在频域中导致显著的波纹（Gibbs 现象的频谱表现）。为减轻此效应，会应用一个更平滑的窗函数 $w[n]$，例如 Hamming 窗。加窗后的脉冲响应为：\n$$h_{w}[n] = h_{ideal}[n] \\cdot w[n]$$\n对于一个长度为 $N$ 的滤波器，其中在所有测试用例中 $N$ 都被指定为奇数，此操作在一个关于零点对称的区间上执行，通常是 $n \\in \\{-(N-1)/2, \\dots, (N-1)/2\\}$。得到的滤波器 $h_w[n]$ 是非因果的，但具有零相位。\n\n为使滤波器具有因果性，其脉冲响应被平移 $M = (N-1)/2$ 个采样点。最终的因果、线性相位 FIR 滤波器 $h[n]$ 的系数为：\n$$h[n] = h_{w}[n - M] \\quad \\text{for } n \\in \\{0, 1, \\dots, N-1\\}$$\n这 $M$ 个采样点的延迟确保了滤波器在物理上是可实现的，并且因为原始未平移的脉冲响应是对称的，所以因果滤波器的相位响应是线性的。\n\n最后，对滤波器系数进行归一化，以确保在直流（零频率）处有单位增益，即 $\\sum_{k=0}^{N-1} h[k] = 1$。这保证了对单位幅度阶跃输入的稳态响应为 1，即 $y_{\\mathrm{ss}} = A \\sum_{k=0}^{N-1} h[k] = 1 \\cdot 1 = 1$。这种归一化为量化过冲和下冲提供了一个稳定的基准。`scipy.signal.firwin` 函数为这整个窗函数 sinc 设计过程提供了一个权威实现。\n\n**2. 系统对阶跃输入的响应**\n\n输入信号 $x[n]$ 是一个离散时间单位阶跃的有限长度近似，定义在 $L = 32768$ 个采样点上。阶跃发生在索引 $n_0 = \\lfloor L/2 \\rfloor = 16384$ 处。因此，$n  n_0$ 时 $x[n] = 0$，$n \\ge n_0$ 时 $x[n] = 1$。\n\n输出信号 $y[n]$ 是输入信号 $x[n]$ 与滤波器脉冲响应 $h[n]$ 进行离散时间卷积的结果：\n$$y[n] = (x * h)[n] = \\sum_{k=0}^{N-1} h[k] x[n-k]$$\n生成的输出序列 $y[n]$ 的长度为 $L + N - 1$。卷积运算有效地将滤波器应用于输入信号。\n\n**3. 波纹的定量分析**\n\n问题要求计算三个度量指标来量化滤波器阶跃响应中的 Gibbs 现象。这些度量是在分析索引集 $\\mathcal{I}=\\{n_0, n_0+1, \\dots, n_0+4N-1\\}$ 上计算的，该集合专注于紧随阶跃不连续点之后的、瞬态现象最显著的区域。\n\n- **稳态值 ($y_{\\mathrm{ss}}$)**：根据定义和我们的滤波器归一化，$y_{\\mathrm{ss}} = \\sum_{k=0}^{N-1} h[k] \\cdot A = 1.0$，其中 $A=1$。\n\n- **过冲率 ($r_{\\mathrm{over}}$)**：该度量指标测量的是与稳态值的最大正偏差，并以稳态值本身进行归一化。\n$$r_{\\mathrm{over}} = \\max\\left(0, \\frac{\\max_{n \\in \\mathcal{I}} y[n] - y_{\\mathrm{ss}}}{y_{\\mathrm{ss}}}\\right)$$\n\n- **下冲率 ($r_{\\mathrm{under}}$)**：该度量指标测量的是最大负偏差（低于阶跃前的基线或阶跃后的初始波纹波谷），也进行归一化。\n$$r_{\\mathrm{under}} = \\max\\left(0, \\frac{y_{\\mathrm{ss}} - \\min_{n \\in \\mathcal{I}} y[n]}{y_{\\mathrm{ss}}}\\right)$$\n\n- **波纹过零计数 ($Z$)**：该度量指标计算波纹波形 $w[n] = y[n] - y_{\\mathrm{ss}}$ 在分析区间 $\\mathcal{I}$ 内穿过稳态值的次数。它是通过在移除 $w[n]$ 精确为零的任何样本后，计算序列 $w[n]$ 中的符号变化次数来得到的。这给出了波纹频率的一个指示。\n\n实现将为每个测试用例系统地执行这些步骤，从而提供滤波器性能的定量比较，并清晰地展示 Gibbs 现象。例如，比较用例 1 (Hamming) 和用例 2 (boxcar) 将展示 Hamming 窗优越的波纹抑制能力。比较用例 2、3 和 5（均为 boxcar）将显示滤波器长度 $N$ 如何影响过渡带陡峭度和波纹特性。具体来说，boxcar 窗的过冲预计约为阶跃高度的 9%，且与 $N$ 无关，这说明了 Gibbs 现象的一个基本属性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.signal import firwin, get_window\n\ndef solve():\n    \"\"\"\n    Designs FIR filters, computes their step response, and quantifies Gibbs phenomenon.\n    \"\"\"\n    # Define problem constants\n    L = 32768\n    A = 1.0\n    n_0 = L // 2\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, fs, fc, window_type)\n        (129, 1000, 100, \"hamming\"),\n        (129, 1000, 100, \"boxcar\"),\n        (513, 1000, 100, \"boxcar\"),\n        (129, 1000, 225, \"boxcar\"),\n        (31, 1000, 100, \"boxcar\"),\n    ]\n\n    results = []\n    \n    # Generate the discrete-time step input signal x[n]\n    x = np.zeros(L)\n    x[n_0:] = A\n\n    for case in test_cases:\n        N, fs, fc, window_type = case\n\n        # --- 1. FIR Filter Design (Windowed-Sinc Method) ---\n        # The firwin function implements the windowed-sinc method.\n        # It requires the cutoff frequency to be normalized by the Nyquist frequency.\n        nyquist_freq = fs / 2.0\n        normalized_cutoff = fc / nyquist_freq\n        \n        # Design the causal, linear-phase FIR filter.\n        # firwin automatically normalizes the filter for unity gain at DC.\n        h = firwin(N, normalized_cutoff, window=window_type, pass_zero='lowpass')\n\n        # --- 2. System Response Computation ---\n        # Convolve the input signal x[n] with the filter impulse response h[n]\n        y = np.convolve(x, h, mode='full')\n\n        # --- 3. Metric Computation ---\n        # The analysis index set is I = {n_0, n_0+1, ..., n_0 + 4N - 1}\n        # The problem statement guarantees this is within the valid output range.\n        analysis_start = n_0\n        analysis_end = n_0 + 4 * N\n        y_analysis = y[analysis_start:analysis_end]\n        \n        # Calculate the steady-state value. Since A=1 and firwin normalizes\n        # the filter, y_ss = sum(h), which is approximately 1.0.\n        y_ss = np.sum(h) * A\n\n        # Calculate overshoot ratio\n        y_max = np.max(y_analysis)\n        r_over = np.maximum(0.0, (y_max - y_ss) / y_ss)\n\n        # Calculate undershoot ratio\n        y_min = np.min(y_analysis)\n        r_under = np.maximum(0.0, (y_ss - y_min) / y_ss)\n        \n        # Calculate ripple zero-crossing count Z\n        # w[n] = y[n] - y_ss\n        w = y_analysis - y_ss\n        \n        # Ignore indices where w[n] is exactly zero, as per problem definition\n        w_nonzero = w[w != 0]\n        \n        # Count sign changes\n        signs = np.sign(w_nonzero)\n        sign_changes = signs[:-1] * signs[1:]\n        Z = np.sum(sign_changes  0)\n\n        # Append formatted results\n        results.append([\n            round(r_over, 6),\n            round(r_under, 6), \n            int(Z)\n        ])\n    \n    # Format the results into the required string format\n    # Example: [[0.012345,0.006789,42],[0.000000,0.000000,0]]\n    result_str = str(results).replace(\" \", \"\")\n\n    # Final print statement in the exact required format.\n    print(result_str)\n\nsolve()\n```", "id": "2436691"}, {"introduction": "最后一个练习将我们的理解提升到一个真正的工程设计挑战。你将不再仅仅是观察或缓解纹波，而是学习使用参数化的凯撒窗来精确控制它们。本练习专注于量化管理纹波衰减与滤波器过渡带锐度之间的基本权衡，使你能够设计出满足特定性能指标的滤波器，例如在给定滤波器长度$N$下实现所需阻带衰减$A_s$。[@problem_id:2912694]", "problem": "您的任务是将有限冲激响应窗函数设计中由吉布斯现象引起的边缘行为与凯塞窗的实际设计参数联系起来。请从加窗理想响应的离散时间傅里叶变换的基本定义、截断会在不连续点附近引起振荡行为的概念，以及参数化窗会改变主瓣宽度和旁瓣衰减之间权衡这一事实出发。利用凯塞窗已知的结构特性（其形状参数控制通带/阻带波纹与过渡带宽之间的权衡），以及从零阶第一类修正贝塞尔函数导出的标准渐近关系，来获得一个从期望的阻带衰减到凯塞窗参数的可计算映射，以及一个关于过渡带宽和长度的近似关系。\n\n对于每个给定的测试用例，您的程序必须执行以下操作：\n- 给定固定的有限冲激响应长度 $N$ 和目标阻带衰减 $A_s$（以分贝为单位），计算在凯塞窗模型下能实现指定阻带衰减的凯塞窗参数 $\\beta$。\n- 推断出近似的过渡带宽 $\\Delta \\omega$（以弧度/采样点为单位），该宽度需与凯塞窗设计框架保持一致，并考虑到滤波器阶数为 $M = N - 1$。\n\n角度单位必须是弧度/采样点。所有结果必须四舍五入到六位小数。\n\n测试套件：\n- 案例1（常规路径，高衰减）：$(N, A_s) = (51, 60)$。\n- 案例2（中等衰减）：$(N, A_s) = (101, 30)$。\n- 案例3（低衰减区域）：$(N, A_s) = (64, 15)$。\n- 案例4（$A_s = 21$ 的边界条件）：$(N, A_s) = (256, 21)$。\n- 案例5（$A_s = 50$ 的边界条件）：$(N, A_s) = (33, 50)$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素本身是一个双元素列表 $[\\beta, \\Delta \\omega]$，对应一个测试用例，并且 $\\beta$ 和 $\\Delta \\omega$ 都四舍五入到六位小数。例如：$[[\\beta_1,\\Delta\\omega_1],[\\beta_2,\\Delta\\omega_2],\\ldots]$。\n\n注意：\n- 将 $A_s$ 视为非负实数（单位为分贝），$N$ 视为正整数且 $N \\geq 2$，以使滤波器阶数 $M = N - 1$ 不为零。\n- $\\Delta \\omega$ 的推断必须反映在归一化数字频率域中，标准凯塞窗设计关系里滤波器阶数、阻带衰减和过渡带宽三者之间的关系。", "solution": "首先将对所述问题进行严格验证。\n\n**步骤1：提取已知条件**\n\n从问题陈述中逐字提取的已知条件如下：\n-   **任务：** 将有限冲激响应（FIR）窗函数设计中的吉布斯现象与凯塞窗的实际设计参数联系起来。\n-   **输入参数：** 对于每个测试用例，给定一个固定的 FIR 长度 $N$ 和一个目标阻带衰减 $A_s$（单位：分贝）。\n-   **输出参数：** 对于每个测试用例，给定凯塞窗参数 $\\beta$ 和近似过渡带宽 $\\Delta \\omega$（单位：弧度/采样点）。\n-   **约束条件：** 滤波器阶数为 $M = N - 1$。\n-   **约束条件：** $A_s$ 是一个非负实数。$N$ 是一个正整数且 $N \\ge 2$。\n-   **约束条件：** 所有结果必须四舍五入到六位小数。\n-   **框架：** 使用凯塞窗已知的结构特性和标准渐近关系。\n-   **测试套件：**\n    -   案例1：$(N, A_s) = (51, 60)$\n    -   案例2：$(N, A_s) = (101, 30)$\n    -   案例3：$(N, A_s) = (64, 15)$\n    -   案例4：$(N, A_s) = (256, 21)$\n    -   案例5：$(N, A_s) = (33, 50)$\n\n**步骤2：使用提取的已知条件进行验证**\n\n根据指定标准对问题进行验证。\n\n-   **科学基础：** 该问题牢固地植根于数字信号处理（DSP）学科。吉布斯现象、使用窗函数的 FIR 滤波器设计以及凯塞窗都是该领域的经典主题。窗函数参数（$\\beta$, $N$）与滤波器性能指标（$A_s$, $\\Delta \\omega$）之间的关系，是基于 J.F. Kaiser 通过分析窗函数（涉及修正的贝塞尔函数 $I_0(x)$）的频谱特性而得出的行之有效的经验公式。该问题在科学上是合理的。\n-   **适定性：** 问题提供了足够的信息来为每个测试用例确定唯一的解。输入（$N$, $A_s$）定义清晰，所需的输出（$\\beta$, $\\Delta \\omega$）可以使用凯塞窗设计方法中的标准、无歧义的公式直接计算。对于所有给定的测试用例，都存在唯一且稳定的解。\n-   **客观性：** 问题以精确、客观的语言陈述。诸如“阻带衰减”、“过渡带宽”和“凯塞窗参数”等术语在 DSP 的背景下具有明确的定义。问题不含主观论断或观点。\n\n该问题未表现出任何列出的缺陷。它并非科学上不合理、不可形式化、不完整或不切实际。它具有良好的适定性和客观性。\n\n**步骤3：结论与行动**\n\n该问题是**有效的**。现在将提供一个完整的、论证充分的解决方案。\n\n---\n\n目标是为给定的有限冲激响应（FIR）滤波器长度 $N$ 和期望的阻带衰减 $A_s$ 计算凯塞窗参数 $\\beta$ 及相关的过渡带宽 $\\Delta \\omega$。此任务展示了 FIR 滤波器设计中的核心权衡，而这些权衡是吉布斯现象的直接后果。\n\n当通过窗函数法设计 FIR 滤波器时，我们从一个理想的、无限长的冲激响应开始，例如低通滤波器的 sinc 函数 $h_d[n]$。为使其变得实用，必须将其截断为有限长度 $N$。这种截断等效于乘以一个长度为 $N$ 的矩形窗。在频域中，这对应于理想频率响应 $H_d(e^{j\\omega})$ 与矩形窗的傅里叶变换进行卷积。理想频率响应中的急剧不连续点（例如，在通带边缘）与矩形窗的类 sinc 频谱进行卷积，导致在通带和阻带中都产生波纹。这种在不连续点附近的振荡伪影被称为吉布斯现象。该现象的一个关键特性是，随着滤波器长度 $N$ 的增加，波纹的峰值幅度不会减小；它仅仅是被压缩到更靠近不连续点的位置。\n\n为了控制这种行为，我们采用非矩形窗来对冲激响应进行锥削，以减小截断的突兀性。凯塞窗是为此目的而广泛使用的一种参数化窗，因为它提供了一个可调节的形状参数 $\\beta$，该参数控制了窗函数频谱的主瓣宽度与旁瓣衰减之间的权衡。更大的 $\\beta$ 会带来更高的旁瓣衰减（即更低的阻带波纹，或更高的 $A_s$），但代价是主瓣更宽（即过渡带更宽，$\\Delta \\omega$）。\n\n长度为 $N$ 的凯塞窗由滤波器阶数 $M=N-1$ 和参数 $\\beta$ 定义为：\n$$ w[n] = \\frac{I_0\\left(\\beta \\sqrt{1 - \\left(\\frac{2n - M}{M}\\right)^2}\\right)}{I_0(\\beta)}, \\quad 0 \\le n \\le M $$\n其中 $I_0(\\cdot)$ 是零阶第一类修正贝塞尔函数。\n\nJames Kaiser 开发了一套高精度的经验公式，将滤波器规格（$A_s$, $\\Delta\\omega$）与所需的窗参数（$N$, $\\beta$）联系起来。\n\n首先，参数 $\\beta$ 可以由阻带衰减 $A_s$（以正分贝表示）确定。该关系是分段的：\n$$ \\beta = \\begin{cases} 0  \\text{若 } A_s  21 \\\\ 0.5842(A_s - 21)^{0.4} + 0.07886(A_s - 21)  \\text{若 } 21 \\le A_s \\le 50 \\\\ 0.1102(A_s - 8.7)  \\text{若 } A_s  50 \\end{cases} $$\n$A_s  21$ dB 的值对应于矩形窗（$\\beta=0$），因为这是简单截断所能提供的大致衰减。\n\n其次，滤波器阶数 $M = N-1$ 与 $A_s$ 和归一化过渡带宽 $\\Delta\\omega$（单位：弧度/采样点）通过以下公式相关联：\n$$ M \\approx \\frac{A_s - 8}{2.285 \\Delta \\omega} $$\n该公式通常在 $A_s  21$ 时有效。问题陈述要求我们根据给定的 $N$ 和 $A_s$ 推断过渡带宽 $\\Delta\\omega$。通过重新整理这个表达式，我们得到 $\\Delta \\omega$ 的计算公式：\n$$ \\Delta \\omega \\approx \\frac{A_s - 8}{2.285 M} = \\frac{A_s - 8}{2.285 (N-1)} $$\n我们将在所有测试用例中应用此公式，因为它反映了凯塞窗设计框架的特性，即使在 $\\beta$ 变为零的区域也是如此。如果分子 $A_s - 8  0$ 得到负值，则表示所提供的规格无法实现，但给定的测试用例在物理上是有意义的。注意，分子中的常数有时被引用为 $7.95$，但 $8$ 是一个常用且可接受的近似值。\n\n我们继续将这些公式应用于给定的测试用例。\n\n**案例1：** $(N, A_s) = (51, 60)$\n阶数为 $M = 51 - 1 = 50$。衰减 $A_s = 60$ dB 大于 $50$。\n$$ \\beta = 0.1102(60 - 8.7) = 0.1102(51.3) = 5.65326 $$\n$$ \\Delta \\omega = \\frac{60 - 8}{2.285(50)} = \\frac{52}{114.25} \\approx 0.455142232 \\ldots $$\n四舍五入到六位小数，$\\beta = 5.653260$ 且 $\\Delta \\omega = 0.455142$。\n\n**案例2：** $(N, A_s) = (101, 30)$\n阶数为 $M = 101 - 1 = 100$。衰减 $A_s = 30$ dB 介于 $21$ 和 $50$ 之间。\n$$ \\beta = 0.5842(30 - 21)^{0.4} + 0.07886(30 - 21) = 0.5842(9^{0.4}) + 0.07886(9) \\approx 2.1166934 \\ldots $$\n$$ \\Delta \\omega = \\frac{30 - 8}{2.285(100)} = \\frac{22}{228.5} \\approx 0.096280087 \\ldots $$\n四舍五入到六位小数，$\\beta = 2.116693$ 且 $\\Delta \\omega = 0.096280$。\n\n**案例3：** $(N, A_s) = (64, 15)$\n阶数为 $M = 64 - 1 = 63$。衰减 $A_s = 15$ dB 小于 $21$。\n$$ \\beta = 0 $$\n$$ \\Delta \\omega = \\frac{15 - 8}{2.285(63)} = \\frac{7}{143.955} \\approx 0.048626237 \\ldots $$\n四舍五入到六位小数，$\\beta = 0.000000$ 且 $\\Delta \\omega = 0.048626$。\n\n**案例4：** $(N, A_s) = (256, 21)$\n阶数为 $M = 256 - 1 = 255$。衰减 $A_s = 21$ dB 位于较低两个区域的边界上。适用于 $21 \\le A_s \\le 50$ 范围的公式。\n$$ \\beta = 0.5842(21 - 21)^{0.4} + 0.07886(21 - 21) = 0 $$\n$$ \\Delta \\omega = \\frac{21 - 8}{2.285(255)} = \\frac{13}{582.675} \\approx 0.022310330 \\ldots $$\n四舍五入到六位小数，$\\beta = 0.000000$ 且 $\\Delta \\omega = 0.022310$。\n\n**案例5：** $(N, A_s) = (33, 50)$\n阶数为 $M = 33 - 1 = 32$。衰减 $A_s = 50$ dB 位于较高两个区域的边界上。适用于 $21 \\le A_s \\le 50$ 范围的公式。\n$$ \\beta = 0.5842(50 - 21)^{0.4} + 0.07886(50 - 21) = 0.5842(29^{0.4}) + 0.07886(29) \\approx 4.5629402 \\ldots $$\n$$ \\Delta \\omega = \\frac{50 - 8}{2.285(32)} = \\frac{42}{73.12} \\approx 0.574405087 \\ldots $$\n四舍五入到六位小数，$\\beta = 4.562940$ 且 $\\Delta \\omega = 0.574405$。\n\n计算现已完成。最终结果将按要求格式化成程序。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes Kaiser window parameter beta and transition width delta_omega\n    for given FIR filter length N and stopband attenuation As.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (51, 60),   # Case 1 (happy path, high attenuation)\n        (101, 30),  # Case 2 (mid-range attenuation)\n        (64, 15),   # Case 3 (low attenuation region)\n        (256, 21),  # Case 4 (boundary condition at As = 21)\n        (33, 50),   # Case 5 (boundary condition at As = 50)\n    ]\n\n    results = []\n    for case in test_cases:\n        N, As = case\n        \n        # Ensure As is a float for calculations\n        As = float(As)\n\n        # 1. Compute the Kaiser parameter beta based on stopband attenuation As.\n        # The relationship is a piecewise empirical formula.\n        beta = 0.0\n        if As > 50.0:\n            beta = 0.1102 * (As - 8.7)\n        elif As >= 21.0: # This branch includes As = 50 and As = 21\n            beta = 0.5842 * np.power(As - 21.0, 0.4) + 0.07886 * (As - 21.0)\n        else: # As  21.0\n            beta = 0.0\n\n        # Filter order M is N - 1.\n        M = float(N - 1)\n\n        # 2. Infer the approximate transition width delta_omega.\n        # This relationship is derived from the formula relating M, As, and delta_omega.\n        # The formula is generally valid for As > 21, but we apply it as per the\n        # general Kaiser design framework.\n        if M > 0:\n            delta_omega_numerator = As - 8.0\n            # Handle cases where As  8, although not in the test suite.\n            # A negative transition width is not physical. We clamp to 0.\n            if delta_omega_numerator  0:\n                delta_omega_numerator = 0.0\n                \n            delta_omega = delta_omega_numerator / (2.285 * M)\n        else: # Should not happen with N >= 2 as per problem statement.\n            delta_omega = 0.0\n\n        # Round results to six decimal places.\n        beta_rounded = np.round(beta, 6)\n        delta_omega_rounded = np.round(delta_omega, 6)\n        \n        results.append([beta_rounded, delta_omega_rounded])\n\n    # Format the final output string to match the required format without extra spaces.\n    # Correct format: [[beta1,delta_omega1],[beta2,delta_omega2],...]\n    result_strings = []\n    for res in results:\n        # Format each inner list to ensure no space after the comma\n        result_strings.append(f\"[{res[0]:.6f},{res[1]:.6f}]\")\n    \n    final_output = f\"[{','.join(result_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "2912694"}]}