{"hands_on_practices": [{"introduction": "本次练习将理论与实践相结合，引导您完成一个经典的巴特沃斯低通滤波器设计过程。您将学习如何将关键性能指标——例如通带衰减 $A_p$ 和阻带衰减 $A_s$——直接转化为滤波器的核心参数：阶数 $n$ 和截止频率 $\\Omega_c$。通过这个过程，您不仅能掌握从需求到设计的基本流程，还能深入理解滤波器阶数必须为整数这一实际约束对最终性能余量的影响 [@problem_id:2871002]。", "problem": "需要设计一个连续时间、线性时不变 (LTI) 低通滤波器，其设计基于一个归一化巴特沃斯原型，该原型具有通带边沿角频率 $\\Omega_{p} = 1$、未知的阶数 $n \\in \\mathbb{N}$ 和截止频率 $\\Omega_{c} > 0$。技术规格以通带和阻带衰减的分贝 (dB) 值给出：在 $\\Omega=\\Omega_{p}$ 处，衰减不得超过 $A_{p}$；在阻带频率 $\\Omega=\\Omega_{s}$ 处，衰减必须至少为 $A_{s}$。巴特沃斯幅度平方响应定义为\n$$\n|H(j\\Omega)|^{2} \\;=\\; \\frac{1}{1 + \\left(\\frac{\\Omega}{\\Omega_{c}}\\right)^{2n}} \\, ,\n$$\n衰减定义为\n$$\nA(\\Omega) \\;=\\; -20 \\log_{10}\\big(|H(j\\Omega)|\\big) \\, .\n$$\n\n(a) 从这些定义出发，推导实值阶数 $n^{\\star}$ 和截止频率 $\\Omega_{c}$ 关于 $A_{p}$、$A_{s}$ 和 $\\Omega_{s}$ 的显式表达式，这些表达式需要同时满足在通带边沿 $\\Omega=\\Omega_{p}$ 处的等式条件和在阻带频率 $\\Omega=\\Omega_{s}$ 处的不等式条件。\n\n(b) 通过选择最小整数 $n=\\lceil n^{\\star}\\rceil$ 来施加整数阶约束，并重新选择 $\\Omega_{c}$，使得在通带边沿 $\\Omega=\\Omega_{p}$ 处的衰减恰好等于 $A_{p}$。利用此整数阶 $n$，量化在 $\\Omega=\\Omega_{s}$ 处实现的阻带衰减，并由此得出由整数取整引起的裕度。\n\n使用具体技术规格 $A_{p}=1$ (dB)、$A_{s}=50$ (dB) 和 $\\Omega_{s}=2.5$。您的最终答案必须是在 $\\Omega=\\Omega_{s}$ 处实现的阻带衰减，以分贝 (dB) 表示，并四舍五入到四位有效数字。", "solution": "我们从巴特沃斯原型幅度平方响应的定义开始，\n$$\n|H(j\\Omega)|^{2} \\;=\\; \\frac{1}{1 + \\left(\\frac{\\Omega}{\\Omega_{c}}\\right)^{2n}} \\, ,\n$$\n以及以分贝为单位的衰减，\n$$\nA(\\Omega) \\;=\\; -20 \\log_{10}\\big(|H(j\\Omega)|\\big) \\, .\n$$\n代入幅度表达式可得\n$$\nA(\\Omega) \\;=\\; -20 \\log_{10}\\!\\left(\\frac{1}{\\sqrt{1+\\left(\\frac{\\Omega}{\\Omega_{c}}\\right)^{2n}}}\\right)\n\\;=\\; 20 \\log_{10}\\!\\left(\\sqrt{1+\\left(\\frac{\\Omega}{\\Omega_{c}}\\right)^{2n}}\\right)\n\\;=\\; 10 \\log_{10}\\!\\left(1+\\left(\\frac{\\Omega}{\\Omega_{c}}\\right)^{2n}\\right).\n$$\n\n在通带边沿 $\\Omega=\\Omega_{p}$ 处，规格要求衰减不超过 $A_{p}$。为获得最紧凑的设计，我们在 $\\Omega=\\Omega_{p}$ 处施加等式条件，可得\n$$\nA(\\Omega_{p}) \\;=\\; A_{p}\n\\;\\;\\Longrightarrow\\;\\;\n10 \\log_{10}\\!\\left(1+\\left(\\frac{\\Omega_{p}}{\\Omega_{c}}\\right)^{2n}\\right) \\;=\\; A_{p}.\n$$\n定义标准波纹参数\n$$\n\\varepsilon^{2} \\;\\triangleq\\; 10^{A_{p}/10} - 1,\n$$\n当 $A_{p}>0$ 时，该参数为严格正值。于是，通带边沿等式给出\n$$\n\\left(\\frac{\\Omega_{p}}{\\Omega_{c}}\\right)^{2n} \\;=\\; \\varepsilon^{2}\n\\;\\;\\Longrightarrow\\;\\;\n\\Omega_{c} \\;=\\; \\Omega_{p}\\,\\varepsilon^{-1/n}.\n$$\n在归一化选择 $\\Omega_{p}=1$ 的情况下，此式可简化为\n$$\n\\Omega_{c} \\;=\\; \\varepsilon^{-1/n}.\n$$\n\n在阻带频率 $\\Omega=\\Omega_{s}$ 处，规格为 $A(\\Omega_{s}) \\ge A_{s}$。代入由通带决定的关系式，我们得到\n$$\nA(\\Omega_{s})\n\\;=\\;\n10 \\log_{10}\\!\\left(1+\\left(\\frac{\\Omega_{s}}{\\Omega_{c}}\\right)^{2n}\\right)\n\\;=\\;\n10 \\log_{10}\\!\\left(1+\\Omega_{s}^{2n}\\left(\\frac{1}{\\Omega_{c}}\\right)^{2n}\\right)\n\\;=\\;\n10 \\log_{10}\\!\\left(1+\\varepsilon^{2}\\,\\Omega_{s}^{2n}\\right).\n$$\n因此，阻带不等式 $A(\\Omega_{s}) \\ge A_{s}$ 等价于\n$$\n10 \\log_{10}\\!\\left(1+\\varepsilon^{2}\\,\\Omega_{s}^{2n}\\right) \\;\\ge\\; A_{s}\n\\;\\;\\Longleftrightarrow\\;\\;\n1+\\varepsilon^{2}\\,\\Omega_{s}^{2n} \\;\\ge\\; 10^{A_{s}/10}\n\\;\\;\\Longleftrightarrow\\;\\;\n\\varepsilon^{2}\\,\\Omega_{s}^{2n} \\;\\ge\\; 10^{A_{s}/10} - 1.\n$$\n求解实值阶数可得\n$$\nn^{\\star}\n\\;=\\;\n\\frac{\\ln\\!\\left(\\frac{10^{A_{s}/10}-1}{\\varepsilon^{2}}\\right)}{2\\,\\ln(\\Omega_{s})}\n\\;=\\;\n\\frac{\\ln\\!\\left(10^{A_{s}/10}-1\\right) - \\ln\\!\\left(10^{A_{p}/10}-1\\right)}{2\\,\\ln(\\Omega_{s})}.\n$$\n这就完成了 (a) 部分：对于任何给定的 $A_{p}$、$A_{s}$ 和 $\\Omega_{s}$（其中 $\\Omega_{p}=1$），我们有\n$$\nn^{\\star} \\;=\\; \\frac{\\ln\\!\\left(\\frac{10^{A_{s}/10}-1}{10^{A_{p}/10}-1}\\right)}{2\\,\\ln(\\Omega_{s})},\n\\qquad\n\\Omega_{c} \\;=\\; \\varepsilon^{-1/n},\\;\\;\\text{with}\\;\\; \\varepsilon^{2}=10^{A_{p}/10}-1.\n$$\n\n对于 (b) 部分，可实现的阶数是最小整数 $n=\\lceil n^{\\star}\\rceil$。然后我们根据通带等式重新选择 $\\Omega_{c}$，使得 $A(\\Omega_{p})=A_{p}$ 精确成立：\n$$\n\\Omega_{c} \\;=\\; \\varepsilon^{-1/n}\n\\;\\;=\\;\\; \\left(10^{A_{p}/10}-1\\right)^{-1/(2n)}.\n$$\n通过这种整数阶设计，在 $\\Omega=\\Omega_{s}$ 处实现的阻带衰减为\n$$\nA_{\\text{real}}(\\Omega_{s})\n\\;=\\;\n10 \\log_{10}\\!\\left(1+\\varepsilon^{2}\\,\\Omega_{s}^{2n}\\right),\n$$\n由于 $n$ 被向上取整，该值通常会超过 $A_{s}$。\n\n现在我们代入具体数值规格 $A_{p}=1$ (dB)、$A_{s}=50$ (dB) 和 $\\Omega_{s}=2.5$，其中 $\\Omega_{p}=1$。\n\n计算波纹参数：\n$$\n\\varepsilon^{2} \\;=\\; 10^{A_{p}/10}-1 \\;=\\; 10^{0.1}-1 \\;=\\; 1.2589254117941673 - 1 \\;=\\; 0.2589254117941673.\n$$\n计算实值阶数：\n$$\nn^{\\star}\n\\;=\\;\n\\frac{\\ln\\!\\left(10^{50/10}-1\\right) - \\ln\\!\\left(10^{1/10}-1\\right)}{2\\,\\ln(2.5)}\n\\;=\\;\n\\frac{\\ln(99999) - \\ln(0.2589254117941673)}{2\\,\\ln(2.5)}.\n$$\n数值上，\n$$\n\\ln(99999) \\approx 11.512915464920230,\\quad\n\\ln(0.2589254117941673) \\approx -1.351215541995,\n$$\n所以\n$$\nn^{\\star} \\;\\approx\\; \\frac{11.512915464920230 - (-1.351215541995)}{2\\times 0.916290731874155} \\;\\approx\\; \\frac{12.864131006915}{1.83258146374831} \\;\\approx\\; 7.01968.\n$$\n因此，最小整数阶为\n$$\nn \\;=\\; \\lceil n^{\\star}\\rceil \\;=\\; 8.\n$$\n使用此 $n$ 重新选择截止频率以满足通带等式：\n$$\n\\Omega_{c} \\;=\\; \\left(10^{A_{p}/10}-1\\right)^{-1/(2n)} \\;=\\; \\left(0.2589254117941673\\right)^{-1/16}.\n$$\n使用 $\\ln\\!\\left(0.2589254117941673\\right)\\approx -1.351215541995$，我们得到\n$$\n\\ln(\\Omega_{c}) \\;=\\; -\\frac{1}{16}\\,\\ln\\!\\left(0.2589254117941673\\right) \\;\\approx\\; 0.0844509713747,\n\\quad\\Rightarrow\\quad\n\\Omega_{c} \\;\\approx\\; \\exp(0.0844509713747) \\;\\approx\\; 1.08806.\n$$\n\n最后，计算当 $n=8$ 时，在 $\\Omega_{s}=2.5$ 处实现的阻带衰减：\n$$\nA_{\\text{real}}(2.5)\n\\;=\\;\n10 \\log_{10}\\!\\left(1+\\varepsilon^{2}\\,(2.5)^{2n}\\right)\n\\;=\\;\n10 \\log_{10}\\!\\left(1+\\big(10^{0.1}-1\\big)\\,(2.5)^{16}\\right).\n$$\n注意到 $(2.5)^{16} = \\left(\\frac{5}{2}\\right)^{16} = \\frac{10^{16}}{2^{32}} \\approx 2{,}328{,}306.4365386963$。因此\n$$\n\\varepsilon^{2}\\,(2.5)^{16}\n\\;\\approx\\;\n\\left(0.2589254117941673\\right)\\times 2{,}328{,}306.4365386963\n\\;\\approx\\;\n602{,}857.705,\n$$\n因此\n$$\nA_{\\text{real}}(2.5)\n\\;\\approx\\;\n10 \\log_{10}\\!\\left(1+602{,}857.705\\right)\n\\;=\\;\n10 \\log_{10}\\!\\left(602{,}858.705\\right)\n\\;\\approx\\;\n50 + 10 \\log_{10}(6.02858705)\n\\;\\approx\\;\n57.802.\n$$\n四舍五入到四位有效数字，实现的阻带衰减为 $57.80$ (dB)。\n\n该值超过了指定的 $A_{s}=50$ (dB)，这是因为将 $n$ 从 $n^{\\star}\\approx 7.01968$ 向上取整到 $n=8$ 所致，这说明了整数阶向上取整带来的裕度。", "answer": "$$\\boxed{57.80}$$", "id": "2871002"}, {"introduction": "在数字滤波器设计中，一个核心目标是“用最小的代价满足性能要求”。本次练习聚焦于如何系统性地确定满足给定通带波纹 $\\delta_p$ 和阻带衰减 $\\delta_s$ 规格的最优等波纹 FIR 滤波器的最低阶数 $N$。您将设计一个迭代算法，该算法通过逐步增加滤波器阶数并利用雷米兹（Remez）交换算法，来自动寻找最经济高效的设计方案，从而将设计过程从反复试错转变为一个可证明收敛的确定性流程 [@problem_id:2888670]。", "problem": "设计并分析一个用于最优等波纹线性相位有限冲激响应 (FIR) 滤波器综合的迭代过程。该过程使用 Remez 交换算法，通过增加滤波器阶数来满足指定的通带和阻带波纹约束。此任务包含两部分：算法构建和终止性证明。\n\n设期望响应为单过渡带类型（低通或高通），其理想幅度响应为分段常数。我们处理 I 型线性相位 FIR 滤波器，其长度为奇数，因此滤波器阶数由 $N = L - 1$ 给出，其中 $L$ 是抽头数且 $L$ 为奇数。设归一化数字频率为 $f \\in [0, 1]$，其中 $1$ 表示奈奎斯特频率，并设 FIR 的离散时间傅里叶变换幅度为 $A(f) \\triangleq \\lvert H(\\mathrm{e}^{\\mathrm{j}\\omega}) \\rvert$，其中 $\\omega = \\pi f$（以弧度为单位）。定义通带波纹约束为 $\\delta_p > 0$，使得\n$$\n\\sup_{f \\in \\mathcal{P}} \\lvert A(f) - 1 \\rvert \\le \\delta_p,\n$$\n并定义阻带泄漏约束为 $\\delta_s > 0$，使得\n$$\n\\sup_{f \\in \\mathcal{S}} \\lvert A(f) \\rvert \\le \\delta_s,\n$$\n其中 $\\mathcal{P}$ 和 $\\mathcal{S}$ 分别表示通带和阻带频率集。\n\n第 1 部分 (算法)。从逼近理论和线性系统的一个有效基本原理——即在紧集上对分段常数期望幅度和非负频带权重使用 Chebyshev (minimax) 逼近范式——出发，开发一个算法，该算法：\n- 固定滤波器类型（低通或高通）、通带边缘 $f_p \\in (0, 1)$、阻带边缘 $f_s \\in (0, 1)$（其中 $0 < f_p < f_s < 1$）以及正波纹值 $\\delta_p, \\delta_s$。\n- 对于奇数长度 $L = 3, 5, 7, \\dots$，调用加权等波纹 Remez 设计，为选定的 $L$ 和固定的频带权重生成系数，以最小化 $\\mathcal{P} \\cup \\mathcal{S}$ 上的最大加权误差。对于每个 $L$，评估上述定义中的幅度约束是否满足（通过 $\\omega = \\pi f$ 将角度解释为弧度）。若不满足，则增加 $L$ 并重复。若满足，则返回满足两个约束的最小阶数 $N = L - 1$。\n- 使用密集的均匀频率网格来验证不等式，在 $f \\in [0, 1]$ 上至少包含 $M = 16384$ 个点。\n\n第 2 部分 (终止性证明)。证明：如果对于指定的 $(f_p, f_s)$ 和滤波器类型，存在一个有限阶 I 型线性相位 FIR 滤波器满足给定的 $(\\delta_p, \\delta_s)$ 约束，那么第 1 部分的迭代过程将在有限步内终止，并得到满足约束的最小阶数 $N$。\n\n您的程序应实现第 1 部分的算法，并为以下每个测试规范计算最小阶数 $N$（一个整数）。频率是归一化的（$1$ 是奈奎斯特频率），角度需通过 $\\omega = \\pi f$ 解释为弧度。不涉及物理单位；仅报告整数。\n\n测试套件：\n- 案例 A (低通)：$f_p = 0.2$, $f_s = 0.3$, $\\delta_p = 0.01$, $\\delta_s = 0.0015$。\n- 案例 B (高通)：$f_s = 0.35$, $f_p = 0.5$, $\\delta_p = 0.005$, $\\delta_s = 0.002$。\n- 案例 C (低通)：$f_p = 0.25$, $f_s = 0.38$, $\\delta_p = 0.02$, $\\delta_s = 0.01$。\n- 案例 D (高通)：$f_s = 0.25$, $f_p = 0.4$, $\\delta_p = 0.008$, $\\delta_s = 0.004$。\n\n每个案例的接受准则：\n- 对于低通滤波器：验证 $\\sup_{f \\in [0, f_p]} \\lvert A(f) - 1 \\rvert \\le \\delta_p$ 且 $\\sup_{f \\in [f_s, 1]} \\lvert A(f) \\rvert \\le \\delta_s$。\n- 对于高通滤波器：验证 $\\sup_{f \\in [f_p, 1]} \\lvert A(f) - 1 \\rvert \\le \\delta_p$ 且 $\\sup_{f \\in [0, f_s]} \\lvert A(f) \\rvert \\le \\delta_s$。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个逗号分隔的列表，用方括号括起来，按 A、B、C、D 的顺序排列结果，例如 $[N_A,N_B,N_C,N_D]$，其中每个 $N_\\cdot$ 是为该案例找到的最小阶数。\n- 不得有任何额外输出，也不得有任何外部输入。\n\n重要提示：请勿使用或假设任何未经证明的最小阶数公式。算法必须基于上述基本原理推导和证明。所有角度均以弧度为单位；在指定的输出格式中，仅报告每个案例的整数 $N$。", "solution": "该问题陈述已经过严格验证，并被确定为有效。它在科学上基于成熟的数字信号处理和 Chebyshev 逼近理论，问题设定良好，具有清晰客观的标准，并且没有内部矛盾或造成困难的歧义。该问题构成了一个标准的、尽管不平凡的最优滤波器设计练习。因此，我们可以着手进行形式化求解。\n\n按照要求，解答分为两部分：算法构建和终止性证明。\n\n**第 1 部分：算法构建**\n\n设计一个最优等波纹线性相位有限冲激响应 (FIR) 滤波器，本质上是一个最佳一致逼近问题。对于一个长度为奇数 $L = N+1 = 2k+1$ 的 I 型 FIR 滤波器，其幅度响应 $A(\\omega)$ 是一个实值偶函数，其中 $\\omega = \\pi f$ 是归一化角频率（弧度），$f \\in [0, 1]$ 是归一化频率（$f=1$ 为奈奎斯特频率）。它可以表示为一个三角多项式：\n$$A(\\omega) = \\sum_{n=0}^{k} a_n \\cos(n\\omega)$$\n通过代换 $x = \\cos(\\omega)$，此表达式变为关于变量 $x$ 的 $k$ 次标准多项式。因此，设计问题转化为找到一个多项式 $P_k(x)$，使其在对应于通带和阻带的不相交区间集合上最佳地逼近期望响应 $D(x)$。\n\n“最佳”逼近的概念是在 Chebyshev (或 minimax) 意义下的，其目标是最小化最大加权误差。目标函数是：\n$$ \\min_{P_k} \\left\\{ \\max_{x \\in \\text{Bands}} |W(x) [D(x) - P_k(x)]| \\right\\} $$\n此处，$D(x)$ 是期望的分段常数响应（通带为 1，阻带为 0），$W(x)$ 是一个正权重函数。Parks-McClellan 算法是 Remez 交换算法在该特定问题上的应用，它提供了唯一的多项式解。\n\n问题为通带波纹 $\\delta_p$ 和阻带衰减 $\\delta_s$ 指定了独立的约束。设给定滤波器设计实现的波纹为 $\\delta'_p$ 和 $\\delta'_s$。若 $\\delta'_p \\le \\delta_p$ 且 $\\delta'_s \\le \\delta_s$，则设计成功。Remez 算法最小化单个最大加权误差，我们将其表示为 $\\delta_{minimax}$。实际波纹与此误差的关系为 $\\delta'_p = \\delta_{minimax}/W_p$ 和 $\\delta'_s = \\delta_{minimax}/W_s$，其中 $W_p$ 和 $W_s$ 分别是通带和阻带的权重。为了构建一个能最优地平衡这两个约束的滤波器，必须设置权重以使相对于规范的相对误差相等。这通过将权重之比设置为期望波纹之比的倒数来实现：\n$$ \\frac{W_p}{W_s} = \\frac{\\delta_s}{\\delta_p} $$\n一个方便的选择是 $W_p = \\delta_s$ 和 $W_s = \\delta_p$，或任何具有此比例的组合，例如 $W_p = \\delta_s/\\delta_p$ 和 $W_s = 1$。使用这样的权重，得到的等波纹滤波器将具有满足 $\\delta'_p / \\delta'_s = \\delta_p / \\delta_s$ 的实际波纹。那么，接受性检查就简化为验证 $\\delta'_p \\le \\delta_p$ 是否成立（这会自动意味着 $\\delta'_s \\le \\delta_s$）。\n\n问题的核心是找到满足规范的最小滤波器阶数 $N$。这通过系统性的迭代搜索来完成。\n\n算法流程如下：\n1. 初始化滤波器阶数 $N=2$（对应长度 $L=3$）。后续测试的阶数为 $N=4, 6, 8, \\dots$，以保持 I 型滤波器的结构（奇数长度）。\n2. 对于给定的偶数阶 $N=2k$：\n   a. 定义频带、期望响应和权重。对于通带边缘为 $f_p$、阻带边缘为 $f_s$ 的低通滤波器，频带为 $[0, f_p]$ 和 $[f_s, 1]$。在这些频带上的期望响应分别为 $1$ 和 $0$。权重设置为 $W_p = \\delta_s/\\delta_p$ 和 $W_s = 1$。对于高通滤波器，频带为 $[0, f_s]$（阻带）和 $[f_p, 1]$（通带），期望响应为 $0$ 和 $1$，权重为 $W_s=1$ 和 $W_p=\\delta_s/\\delta_p$。\n   b. 使用 Remez 算法（例如，在 `scipy.signal.remez` 中实现的）计算长度为 $L=N+1$ 的滤波器脉冲响应系数 $h[n]$。\n   c. 在归一化频率范围 $f \\in [0, 1]$ 上，于一个包含 $M=16384$ 个点的密集频率网格上计算滤波器的幅度响应 $A(f)$。\n   d. 通过计算实现的最大波纹来验证约束：\n      i. 通带波纹：$\\delta_p' = \\sup_{f \\in \\mathcal{P}} \\lvert A(f) - 1 \\rvert$。\n      ii. 阻带波纹：$\\delta_s' = \\sup_{f \\in \\mathcal{S}} \\lvert A(f) \\rvert$。\n   e. 如果 $\\delta_p' \\le \\delta_p$ 且 $\\delta_s' \\le \\delta_s$，则当前阶数 $N$ 是满足标准的最小阶数，因为搜索是从最小可能阶数顺序进行的。算法终止并返回此值 $N$。\n   f. 如果约束未满足，则增加阶数，$N \\to N+2$，并从步骤 2a 重复该过程。\n\n**第 2 部分：终止性证明**\n\n证明迭代过程保证在有限步内终止，是基于最佳多项式逼近的基本性质。\n\n**前提**：我们已知存在至少一个某有限阶（比如 $N_{sol}$）的 I 型线性相位 FIR 滤波器，它对于指定的频带边缘 $(f_p, f_s)$ 满足给定的波纹约束 $(\\delta_p, \\delta_s)$。设 $N_{min}^*$ 是存在解的最小此类偶数阶。\n\n**逼近误差的单调性**：对于一个固定的逼近问题（即固定的频带、期望函数和权重函数），可实现的最小加权逼近误差 $\\delta_{minimax}$ 是多项式次数 $k$（对应于滤波器阶数 $N=2k$）的单调非增函数。对于在具有非零过渡带 ($f_s - f_p > 0$) 的不相交区间上的逼近，此关系是严格单调的：\n$$ \\delta_{minimax}(k+1) < \\delta_{minimax}(k) $$\n此性质确保增加滤波器阶数总能获得更好的逼近，从而导致可实现的波纹严格减小。\n\n**终止性论证**：\n1. 算法测试一个单调递增的偶数阶数序列 $N_i = 2i$，其中 $i=1, 2, 3, \\dots$。\n2. 对于每个阶数 $N_i$，算法构建在 minimax 意义下具有规定权重比的最优滤波器。设得到的通带和阻带波纹为 $\\delta_p'(N_i)$ 和 $\\delta_s'(N_i)$。\n3. 由于严格单调性，随着 $i$ 的增加，实现的波纹序列 $\\{\\delta_p'(N_i)\\}$ 和 $\\{\\delta_s'(N_i)\\}$ 是严格递减的。此外，已知当 $N_i \\to \\infty$ 时，$\\delta_p'(N_i) \\to 0$ 和 $\\delta_s'(N_i) \\to 0$。\n4. 根据我们的初始前提，对于有限阶 $N_{min}^*$ 存在一个解。我们的算法为阶数 $N_{min}^*$ 设计的滤波器，根据定义，是 Parks-McClellan 意义下的最优滤波器。它的性能必须至少与任何其他同阶任意滤波器的性能一样好（通常会更好）。因此，我们的算法为阶数 $N_{min}^*$ 设计的滤波器保证满足规范 $(\\delta_p, \\delta_s)$。\n5. 算法的搜索从 $N=2$ 开始，并按顺序遍历所有偶数。测试的阶数序列 $\\{2, 4, 6, \\dots\\}$ 是无界的，因此最终将达到阶数 $N_{min}^*$。\n6. 在测试阶数 $N_{min}^*$ 时，算法将发现约束得到满足并终止。由于搜索是按阶数顺序和单调进行的，它终止的第一个阶数保证是所需的最小偶数阶。\n\n因此，在存在有限阶解的前提下，该算法保证在有限步骤内找到最小阶解。", "answer": "[38,32,20,24]", "id": "2888670"}, {"introduction": "理论上完美的滤波器设计在付诸实践时会面临硬件限制，其中最主要的就是系数的有限精度量化。本练习将带您从确定性的理论设计领域进入随机性的实现分析领域。您将运用蒙特卡洛（Monte Carlo）模拟方法，通过编写程序来评估量化误差对 FIR 滤波器性能的统计影响，并估算设计在实际部署中违反性能规格（如通带或阻带纹波超标）的概率，最终为设计的可靠性提供一个量化的置信区间 [@problem_id:2871028]。", "problem": "给定一个固定的基本线性时不变 (LTI) 离散时间低通滤波器，它被实现为抽头长度为 $M$ 的有限冲激响应 (FIR) 滤波器，通过对理想冲激响应加窗并归一化至单位直流 (DC) 增益而设计。对于一个冲激响应为 $\\{h[n]\\}_{n=0}^{M-1}$ 的滤波器，其在归一化频率 $f \\in [0, \\tfrac{1}{2}]$ (单位：周期/采样点) 上的离散时间频率响应由傅里叶级数定义为\n$$\nH(f) \\triangleq \\sum_{n=0}^{M-1} h[n] \\, e^{-j 2 \\pi f n}.\n$$\n滤波器设计规范由通带范围 $[0, f_p]$ 和阻带范围 $[f_s, \\tfrac{1}{2}]$ 以及通带波纹和阻带幅度的容差给出。具体来说，通带波纹规范要求对于所有 $f \\in [0, f_p]$，\n$$\n\\bigl|\\,|H(f)| - 1\\,\\bigr| \\le \\delta_p,\n$$\n而阻带衰减规范要求对于所有 $f \\in [f_s, \\tfrac{1}{2}]$，\n$$\n|H(f)| \\le \\delta_s.\n$$\n考虑一种实现方式，其中每个系数都受到量化误差的影响，该误差被建模为独立同分布的随机变量。对于一个固定的位深度 $b \\in \\mathbb{N}$，定义量化步长 $\\Delta = 2^{-b}$。将量化后的系数建模为\n$$\nh_q[n] \\triangleq h_0[n] + \\varepsilon[n], \\quad \\varepsilon[n] \\sim \\mathcal{U}\\!\\left(-\\tfrac{\\Delta}{2}, \\tfrac{\\Delta}{2}\\right), \\quad \\text{independent over } n,\n$$\n其中 $\\{h_0[n]\\}_{n=0}^{M-1}$ 是未量化的基础设计。设 $H_q(f)$ 是根据 $\\{h_q[n]\\}$ 使用与上述相同的定义计算出的相应频率响应。\n\n对于一个量化实例，如果其通带波纹超出容差，即\n$$\n\\max_{f \\in [0, f_p]} \\bigl|\\,|H_q(f)| - 1\\,\\bigr| > \\delta_p,\n$$\n或其阻带幅度超出容差，即\n$$\n\\max_{f \\in [f_s, \\tfrac{1}{2}]} |H_q(f)| > \\delta_s.\n$$\n则发生规范违例事件。\n我们将使用蒙特卡罗 (MC) 仿真来估计规范违例的概率，并用二项比例置信区间来量化估算器的不确定度。\n\n从以下基本原理出发：\n- 离散时间 LTI 系统的频率响应定义。\n- 蒙特卡罗原理，即从一个分布中独立抽样可以通过相对频率来估计事件概率。\n- 二项分布模型：如果 $X$ 是 $N$ 次独立试验中的违例次数，则 $X \\sim \\operatorname{Binomial}(N, p)$，其中 $p$ 是（未知的）违例概率。\n- Wilson 得分区间，它是通过对二项分布的正态近似进行反推得到的，为概率 $p$ 提供了一个置信水平为 $c \\in (0,1)$ 的双边置信区间，其 z-值为 $z_{1-\\alpha/2}$，其中 $\\alpha = 1 - c$。\n\n你的任务是编写一个完整、可运行的程序，该程序：\n1. 通过使用 Hamming 窗对理想冲激响应进行加窗，并将其归一化至单位 DC 增益，构建一个长度为 $M = 31$ 的基本 FIR 低通滤波器。使用截止频率为 $f_c = 0.20$ 周期/采样点的理想低通滤波器：\n   - 加窗前的理想冲激响应：\n     $$\n     h_{\\text{ideal}}[n] \\triangleq 2 f_c \\, \\operatorname{sinc}\\!\\bigl(2 f_c (n - \\tfrac{M-1}{2})\\bigr), \\quad n = 0,1,\\dots,M-1,\n     $$\n     其中 $\\operatorname{sinc}(x) \\triangleq \\dfrac{\\sin(\\pi x)}{\\pi x}$ 对于 $x \\neq 0$ 且 $\\operatorname{sinc}(0) \\triangleq 1$。\n   - Hamming 窗：\n     $$\n     w[n] \\triangleq 0.54 - 0.46 \\cos\\!\\left(\\dfrac{2 \\pi n}{M-1}\\right).\n     $$\n   - 加窗后的响应 $h_w[n] \\triangleq h_{\\text{ideal}}[n] \\, w[n]$ 和归一化后的基本系数 $h_0[n] \\triangleq \\dfrac{h_w[n]}{\\sum_{k=0}^{M-1} h_w[k]}$。\n2. 通过长度为 $N_{\\text{fft}} = 2048$ 的离散傅里叶变换，将频率轴在密集的均匀网格上离散化，使得被评估的频率集合为 $\\{ f_k \\triangleq \\tfrac{k}{N_{\\text{fft}}} : k = 0,1,\\dots,\\tfrac{N_{\\text{fft}}}{2} \\}$。\n3. 对于每次蒙特卡罗试验，为所有 $n$ 抽取独立的量化误差 $\\varepsilon[n] \\sim \\mathcal{U}(-\\tfrac{\\Delta}{2}, \\tfrac{\\Delta}{2})$，构成 $h_q[n] = h_0[n] + \\varepsilon[n]$，在网格上计算 $H_q(f_k)$，如果上述通带或阻带不等式任一被破坏，则记录一次违例。\n4. 重复 $N$ 次试验，并计算蒙特卡罗估计 $\\hat{p} \\triangleq \\dfrac{X}{N}$，其中 $X$ 是总违例次数。构建置信水平为 $c = 0.95$、z-值 $z \\approx 1.959964$ 的双边 Wilson 得分置信区间，公式如下：\n   $$\n   \\hat{p}_\\text{W} \\pm \\text{half\\_width}, \\quad \\hat{p}_\\text{W} \\triangleq \\dfrac{\\hat{p} + \\dfrac{z^2}{2N}}{1 + \\dfrac{z^2}{N}}, \\quad \\text{half\\_width} \\triangleq \\dfrac{z}{1 + \\dfrac{z^2}{N}} \\sqrt{\\dfrac{\\hat{p}(1-\\hat{p})}{N} + \\dfrac{z^2}{4 N^2}}.\n   $$\n   将区间边界裁剪到单位区间 $[0,1]$ 内。\n\n使用以下规范\n- 通带边缘 $f_p = 0.18$，\n- 阻带边缘 $f_s = 0.22$，\n- 通带波纹容差 $\\delta_p = 0.02$，\n- 阻带幅度容差 $\\delta_s = 0.003$。\n\n角度单位是无量纲的归一化频率，单位为周期/采样点。不涉及物理单位。置信水平为 $c = 0.95$。\n\n测试套件。您的程序必须对以下四个测试用例运行蒙特卡罗估算器，每个用例指定为一个对偶 $(N, b)$，其中 $N$ 是蒙特卡罗试验的次数，$b$ 是定义 $\\Delta = 2^{-b}$ 的小數位数：\n- 用例 1: $(N, b) = (50, 10)$，\n- 用例 2: $(N, b) = (1000, 12)$，\n- 用例 3: $(N, b) = (1000, 8)$，\n- 用例 4: $(N, b) = (1000, 6)$。\n\n对于每个用例，输出三元组 $[\\hat{p}, \\text{CI}_{\\text{low}}, \\text{CI}_{\\text{high}}]$，其中 $\\hat{p}$ 是估计的违例概率，$\\text{CI}_{\\text{low}}$ 和 $\\text{CI}_{\\text{high}}$ 分别是 Wilson 区间的下界和上界。所有三个值都必须是四舍五入到六位小数的实数。\n\n最终输出格式。您的程序应生成单行输出，包含一个长度为 4 的 JSON 数组，其中第 $i$ 个元素是与上面给出的第 $i$ 个用例相对应的三元列表。例如，一个可接受的格式是\n$[[0.0,0.0,0.07],[0.01,0.004,0.02],[0.2,0.18,0.22],[0.6,0.57,0.63]]$，\n但其中的实际数字需替换为指定测试用例的计算值，并且每个浮点数都四舍五入到六位小数。", "solution": "该问题要求分析有限冲激响应 (FIR) 滤波器在系数量化影响下的性能。解决方案涉及三个阶段：首先，使用窗函数法设计一个基准低通 FIR 滤波器；其次，进行蒙特卡罗仿真，以估计由量化噪声导致的性能规范违例概率；第三，计算此概率估计的统计置信区间。整个过程基于数字信号处理和统计估计理论的基本原理。\n\n首先，我们解决基础滤波器的设计问题。问题指定了一个长度为 $M=31$ 的线性相位 FIR 滤波器。这种滤波器是对称的，其设计始于一个理想低通滤波器的冲激响应，该响应是非因果且无限长的。截止频率为 $f_c$ 的低通滤波器的理想冲激响应由 sinc 函数给出：\n$$\nh_{\\text{ideal, raw}}[n] = 2 f_c \\operatorname{sinc}(2 f_c n), \\quad n \\in \\mathbb{Z}\n$$\n其中 $\\operatorname{sinc}(x) \\triangleq \\frac{\\sin(\\pi x)}{\\pi x}$。为了使该响应有限且因果，我们应用两种操作：截断和时移。一个长度为 $M$ 的对称滤波器以 $\\frac{M-1}{2}$ 为中心。因此，我们将理想响应移动这个量并选择 $M$ 个采样点：\n$$\nh_{\\text{ideal}}[n] \\triangleq 2 f_c \\operatorname{sinc}\\left(2 f_c \\left(n - \\frac{M-1}{2}\\right)\\right), \\quad n=0, 1, \\dots, M-1\n$$\n对于给定的参数 $M=31$ 和 $f_c=0.20$，中心位于 $\\frac{31-1}{2}=15$。突然截断冲激响应（即使用矩形窗）会导致吉布斯现象，表现为频响在频带边缘附近出现大的波纹。为了缓解这种情况，我们将理想响应乘以一个在其两端平滑地衰减至零的窗函数。问题指定了 Hamming 窗：\n$$\nw[n] \\triangleq 0.54 - 0.46 \\cos\\left(\\frac{2 \\pi n}{M-1}\\right), \\quad n=0, 1, \\dots, M-1\n$$\n加窗后的冲激响应为 $h_w[n] = h_{\\text{ideal}}[n] \\cdot w[n]$。最后，滤波器必须具有单位直流增益，意味着其在频率 $f=0$ 处的频率响应为 $H(0)=1$。频率响应为 $H(f) = \\sum_{n=0}^{M-1} h[n] e^{-j 2 \\pi f n}$，因此直流增益为 $H(0) = \\sum_{n=0}^{M-1} h[n]$。为强制单位直流增益，我们对系数进行归一化：\n$$\nh_0[n] \\triangleq \\frac{h_w[n]}{\\sum_{k=0}^{M-1} h_w[k]}\n$$\n这些归一化系数 $\\{h_0[n]\\}$ 构成了未量化的基础滤波器设计。\n\n其次，我们对量化效应进行建模并评估性能。系数被量化为具有 $b$ 个小数位的定点表示。量化步长为 $\\Delta = 2^{-b}$。我们将每个系数的量化误差建模为一个从均匀分布 $\\mathcal{U}(-\\Delta/2, \\Delta/2)$ 中抽取的独立随机变量 $\\varepsilon[n]$。因此，量化后的系数为 $h_q[n] = h_0[n] + \\varepsilon[n]$。量化滤波器的频率响应 $H_q(f)$ 是一个随机函数。\n\n如果此响应的幅度 $|H_q(f)|$ 未能满足通带 $[0, f_p]$ 或阻带 $[f_s, 1/2]$ 的标准，则发生规范违例。\n- 通带违例：$\\max_{f \\in [0, f_p]} \\bigl|\\,|H_q(f)| - 1\\,\\bigr| > \\delta_p$\n- 阻带违例：$\\max_{f \\in [f_s, 1/2]} |H_q(f)| > \\delta_s$\n其中 $f_p=0.18$，$f_s=0.22$，$\\delta_p=0.02$，以及 $\\delta_s=0.003$。\n\n由于随机误差和最大值操作的复杂相互作用，解析计算此类违例的概率是难以处理的。因此，我们采用蒙特卡罗仿真。对于给定的试验次数 $N$，我们在每次试验中执行以下步骤：\n1. 生成一组 $M=31$ 个独立的量化误差 $\\{\\varepsilon[n]\\}_{n=0}^{M-1}$。\n2. 构成量化系数 $h_q[n] = h_0[n] + \\varepsilon[n]$。\n3. 使用长度为 $N_{\\text{fft}}=2048$ 的快速傅里叶变换 (FFT)，在密集的频率网格 $f_k = k/N_{\\text{fft}}$（其中 $k=0, \\dots, N_{\\text{fft}}/2$）上计算离散频率响应 $H_q(f_k)$。\n4. 检查此网格上的通带或阻带规范是否被违反。\n如果发生违例，我们进行计数。在 $N$ 次试验后，如果记录到 $X$ 次违例，则估计的违例概率为 $\\hat{p} = X/N$。\n\n第三，我们量化估计值 $\\hat{p}$ 的不确定度。每次试验都是一个独立的伯努利试验，其成功（违例）概率 $p$ 是未知的。违例次数 $X$ 服从二项分布，$X \\sim \\operatorname{Binomial}(N, p)$。为了构建 $p$ 的置信区间，我们使用 Wilson 得分区间，它比更简单的方法更可靠，尤其是在 $p$ 接近 0 或 1 时。对于置信水平 $c=0.95$，对应的 z-分数为 $z = z_{1-(1-c)/2} \\approx 1.959964$。该区间以 $\\hat{p}_{\\text{W}}$ 为中心，半宽度如下：\n$$\n\\hat{p}_{\\text{W}} = \\frac{\\hat{p} + \\frac{z^2}{2N}}{1 + \\frac{z^2}{N}}, \\quad \\text{half\\_width} = \\frac{z}{1 + \\frac{z^2}{N}} \\sqrt{\\frac{\\hat{p}(1-\\hat{p})}{N} + \\frac{z^2}{4 N^2}}\n$$\n置信区间的下界和上界分别为 $\\text{CI}_{\\text{low}} = \\hat{p}_{\\text{W}} - \\text{half\\_width}$ 和 $\\text{CI}_{\\text{high}} = \\hat{p}_{\\text{W}} + \\text{half\\_width}$，并裁剪到区间 $[0, 1]$ 内。\n\n此过程将针对四个测试用例执行，每个用例由一对 $(N, b)$ 定义：$(50, 10)$、$(1000, 12)$、$(1000, 8)$ 和 $(1000, 6)$。每个用例的最终输出包括三元组 $[\\hat{p}, \\text{CI}_{\\text{low}}, \\text{CI}_{\\text{high}}]$，并四舍五入到六位小数。", "answer": "[[0.040000,0.004868,0.132898],[0.000000,0.000000,0.003676],[0.990000,0.982046,0.994646],[1.000000,0.996324,1.000000]]", "id": "2871028"}]}