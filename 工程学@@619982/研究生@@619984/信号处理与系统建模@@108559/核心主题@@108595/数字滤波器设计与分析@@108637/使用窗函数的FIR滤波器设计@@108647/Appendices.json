{"hands_on_practices": [{"introduction": "本练习将引导您完成FIR滤波器设计的基本流程。我们将从一个常见的场景开始：将以赫兹（Hz）为单位的通带和阻带频率等实际滤波器规格，转换为数字信号处理中使用的归一化角频率。通过应用成熟的Kaiser窗设计公式，您将学习如何计算满足特定纹波和过渡带宽约束所需的最小滤波器长度（$L$），这是任何数字信号处理工程师的核心技能。[@problem_id:2871821]", "problem": "您会获得几个低通滤波器设计任务的规格（以赫兹为单位）。您的目标是：将边缘频率转换为归一化的角频率（单位为弧度/样本），然后使用窗函数法确定满足给定波纹约束的最小奇数长度线性相位有限脉冲响应（FIR）低通滤波器。使用Kaiser窗函数法使设计具有确定性。\n\n使用的基本原理：\n- 将赫兹映射到归一化角频率（弧度/样本）的离散时间角频率定义：$$\\omega = 2\\pi \\frac{f}{f_{\\mathrm{s}}}.$$\n- 理想低通滤波器的频率响应，及其作为矩形频率响应的离散时间傅里叶逆变换的时域脉冲响应。\n- 经过充分检验的、基于Kaiser窗函数的设计准则，这些准则将容许波纹和过渡带宽与最小滤波器阶数联系起来。\n\n设计要求：\n- 对于每个测试用例，使用公式 $$\\omega = 2\\pi \\frac{f}{f_{\\mathrm{s}}}$$ 将通带边缘频率和阻带边缘频率从赫兹转换为归一化角频率（单位为弧度/样本）。将通带边缘频率记为 $\\omega_{\\mathrm{p}}$，阻带边缘频率记为 $\\omega_{\\mathrm{s}}$。以弧度/样本为单位报告这些值。\n- 使用Kaiser窗函数法设计一个实数、因果、线性相位的低通FIR（有限脉冲响应）滤波器。滤波器长度 $L$ 是抽头数，滤波器阶数为 $L-1$。\n- 通带波纹容差以线性绝对偏差 $\\delta_{\\mathrm{p}}$ 给出，阻带波纹容差以线性绝对偏差 $\\delta_{\\mathrm{s}}$ 给出。为保证同时满足两个约束，应使用更严格的容差 $\\delta = \\min(\\delta_{\\mathrm{p}}, \\delta_{\\mathrm{s}})$。\n- 设过渡带宽为 $\\Delta \\omega = \\omega_{\\mathrm{s}} - \\omega_{\\mathrm{p}}$，理想截止频率为中点 $\\omega_{\\mathrm{c}} = \\frac{\\omega_{\\mathrm{p}} + \\omega_{\\mathrm{s}}}{2}$。确定最小奇数长度 $L$，使得经过Kaiser窗函数加权的滤波器设计在过渡带宽为 $\\Delta \\omega$ 的情况下满足波纹容差 $\\delta$。\n- 强制要求 $L$ 必须为奇数（这样群延迟 $\\frac{L-1}{2}$ 才为整数）；如果计算出的最小长度是偶数，则将其加 $1$。\n\n单位和数值说明：\n- 以弧度/样本为单位报告 $\\omega_{\\mathrm{p}}$ 和 $\\omega_{\\mathrm{s}}$，并精确到小数点后 $12$ 位。\n- 将 $L$ 报告为整数。\n- 角度单位必须是弧度/样本。\n\n测试套件（每个项目为 $[f_{\\mathrm{s}} \\text{（单位：Hz）}, f_{\\mathrm{pass}} \\text{（单位：Hz）}, f_{\\mathrm{stop}} \\text{（单位：Hz）}, \\delta_{\\mathrm{p}}, \\delta_{\\mathrm{s}}]$）：\n- $$[48000,\\ 5000,\\ 7000,\\ 0.01,\\ 0.001]$$\n- $$[48000,\\ 18000,\\ 19000,\\ 0.005,\\ 0.005]$$\n- $$[44100,\\ 4000,\\ 8000,\\ 0.001,\\ 10^{-5}]$$\n- $$[96000,\\ 20000,\\ 47500,\\ 0.01,\\ 0.01]$$\n\n输出格式：\n- 您的程序应生成单行输出，将所有测试用例的结果聚合为一个列表的列表，其中不含任何空格。\n- 对每个测试用例，输出一个列表，其中包含 $\\omega_{\\mathrm{p}}$（精确到小数点后 $12$ 位）、$\\omega_{\\mathrm{s}}$（精确到小数点后 $12$ 位）和 $L$（一个整数）。\n- 因此，最终输出必须是形如\n  $$[[\\omega_{\\mathrm{p},1},\\omega_{\\mathrm{s},1},L_{1}],[\\omega_{\\mathrm{p},2},\\omega_{\\mathrm{s},2},L_{2}],\\ldots]$$\n  的单行文本，其中每个 $\\omega_{\\mathrm{p},k}$ 和 $\\omega_{\\mathrm{s},k}$ 都是小数点后恰好有 $12$ 位的小数，每个 $L_{k}$ 都是整数，并且该行中没有任何空格。", "solution": "所给出的问题陈述是数字信号处理领域的一项标准任务：使用Kaiser窗函数法设计一个有限脉冲响应（FIR）低通滤波器，以满足特定的频域规格。该问题具有科学依据，提法明确，并且所有提供的参数都是一致且足以得出一个唯一解。因此，该问题是有效的，我们将着手解决它。\n\n使用窗函数法设计线性相位FIR滤波器涉及用一个合适的窗函数截断所需滤波器的理想脉冲响应。选择Kaiser窗是因为它在其傅里叶变换的主瓣宽度（控制滤波器的过渡带宽）和旁瓣电平（控制通带和阻带波纹）之间提供了极佳的折衷。设计过程是确定性的，依赖于将滤波器规格与所需窗口参数联系起来的既定经验公式。\n\n确定最小奇数滤波器长度 $L$ 的步骤如下：\n\n1.  **归一化频率**：必须将给定的模拟频率规格转换为归一化的离散时间角频率，记为 $\\omega$，单位为弧度/样本。转换公式为：\n    $$ \\omega = 2\\pi \\frac{f}{f_s} $$\n    其中 $f$ 是以赫兹（Hz）为单位的频率，$f_s$ 是以赫兹为单位的采样频率。我们计算归一化的通带边缘频率 $\\omega_p$ 和阻带边缘频率 $\\omega_s$。\n\n2.  **确定设计规格**：滤波器的性能由其过渡带宽 $\\Delta\\omega$ 和最大容许波纹 $\\delta$ 来表征。\n    - 过渡带宽是阻带和通带边缘频率之差：$\\Delta\\omega = \\omega_s - \\omega_p$。\n    - 波纹规格必须同时满足通带（$\\delta_p$）和阻带（$\\delta_s$）的约束。因此，我们选择两者中更严格的一个：$\\delta = \\min(\\delta_p, \\delta_s)$。\n\n3.  **计算所需衰减**：波纹 $\\delta$ 通常以分贝（dB）表示为最小阻带衰减 $A$：\n    $$ A = -20 \\log_{10}(\\delta) $$\n\n4.  **估计最小滤波器阶数**：由Kaiser建立的一个经验公式将衰减 $A$ 和过渡带宽 $\\Delta\\omega$ 与所需的最小滤波器阶数 $N = L-1$ 联系起来：\n    $$ N \\ge \\frac{A - 8}{2.285 \\Delta\\omega} $$\n    由于阶数 $N$ 必须是整数，我们对此公式的结果取上整，以找到所需的最小整数阶数。\n    $$ N_{\\text{min}} = \\left\\lceil \\frac{A - 8}{2.285 \\Delta\\omega} \\right\\rceil $$\n\n5.  **确定滤波器长度并强制执行奇数长度约束**：滤波器长度 $L$ 由 $L = N_{\\text{min}} + 1$ 给出。问题规定滤波器长度必须为奇数，这确保了滤波器为I型线性相位，具有 $(L-1)/2$ 个样本的整数群延迟。如果计算出的长度 $L$ 为偶数，则必须将其加 1 以满足此约束。\n\n我们现在将此过程应用于每个测试用例。\n\n**测试用例 1：**\n- 规格：$f_s = 48000$ Hz, $f_{\\text{pass}} = 5000$ Hz, $f_{\\text{stop}} = 7000$ Hz, $\\delta_p = 0.01$, $\\delta_s = 0.001$。\n- 归一化频率：\n  - $\\omega_p = 2\\pi \\frac{5000}{48000} = \\frac{5\\pi}{24} \\approx 0.654498469498$ 弧度/样本。\n  - $\\omega_s = 2\\pi \\frac{7000}{48000} = \\frac{7\\pi}{24} \\approx 0.916297857297$ 弧度/样本。\n- 设计参数：\n  - $\\Delta\\omega = \\omega_s - \\omega_p = \\frac{2\\pi}{24} = \\frac{\\pi}{12}$ 弧度/样本。\n  - $\\delta = \\min(0.01, 0.001) = 0.001$。\n  - $A = -20 \\log_{10}(0.001) = 60$ dB。\n- 滤波器阶数和长度：\n  - $N_{\\text{min}} = \\lceil \\frac{60 - 8}{2.285 \\cdot (\\pi/12)} \\rceil = \\lceil 86.924 \\rceil = 87$。\n  - $L = 87 + 1 = 88$。\n  - $L$ 为偶数，因此我们必须设置 $L = 88 + 1 = 89$。\n- 结果：$\\omega_p = 0.654498469498$，$\\omega_s = 0.916297857297$，$L = 89$。\n\n**测试用例 2：**\n- 规格：$f_s = 48000$ Hz, $f_{\\text{pass}} = 18000$ Hz, $f_{\\text{stop}} = 19000$ Hz, $\\delta_p = 0.005$, $\\delta_s = 0.005$。\n- 归一化频率：\n  - $\\omega_p = 2\\pi \\frac{18000}{48000} = \\frac{3\\pi}{4} \\approx 2.356194490192$ 弧度/样本。\n  - $\\omega_s = 2\\pi \\frac{19000}{48000} = \\frac{19\\pi}{24} \\approx 2.487094336173$ 弧度/样本。\n- 设计参数：\n  - $\\Delta\\omega = \\omega_s - \\omega_p = \\frac{\\pi}{24}$ 弧度/样本。\n  - $\\delta = \\min(0.005, 0.005) = 0.005$。\n  - $A = -20 \\log_{10}(0.005) \\approx 46.0206$ dB。\n- 滤波器阶数和长度：\n  - $N_{\\text{min}} = \\lceil \\frac{46.0206 - 8}{2.285 \\cdot (\\pi/24)} \\rceil = \\lceil \\frac{38.0206}{0.29911} \\rceil = \\lceil 127.108 \\rceil = 128$。\n  - $L = 128 + 1 = 129$。\n  - $L$ 为奇数，因此长度正确。\n- 结果：$\\omega_p = 2.356194490192$，$\\omega_s = 2.487094336173$，$L = 129$。\n\n**测试用例 3：**\n- 规格：$f_s = 44100$ Hz, $f_{\\text{pass}} = 4000$ Hz, $f_{\\text{stop}} = 8000$ Hz, $\\delta_p = 0.001$, $\\delta_s = 10^{-5}$。\n- 归一化频率：\n  - $\\omega_p = 2\\pi \\frac{4000}{44100} = \\frac{80\\pi}{441} \\approx 0.569865615700$ 弧度/样本。\n  - $\\omega_s = 2\\pi \\frac{8000}{44100} = \\frac{160\\pi}{441} \\approx 1.139731231400$ 弧度/样本。\n- 设计参数：\n  - $\\Delta\\omega = \\omega_s - \\omega_p = \\frac{80\\pi}{441}$ 弧度/样本。\n  - $\\delta = \\min(0.001, 10^{-5}) = 10^{-5}$。\n  - $A = -20 \\log_{10}(10^{-5}) = 100$ dB。\n- 滤波器阶数和长度：\n  - $N_{\\text{min}} = \\lceil \\frac{100 - 8}{2.285 \\cdot (80\\pi/441)} \\rceil = \\lceil \\frac{92}{1.30214} \\rceil = \\lceil 70.653 \\rceil = 71$。\n  - $L = 71 + 1 = 72$。\n  - $L$ 为偶数，因此我们必须设置 $L = 72 + 1 = 73$。\n- 结果：$\\omega_p = 0.569865615700$，$\\omega_s = 1.139731231400$，$L = 73$。\n\n**测试用例 4：**\n- 规格：$f_s = 96000$ Hz, $f_{\\text{pass}} = 20000$ Hz, $f_{\\text{stop}} = 47500$ Hz, $\\delta_p = 0.01$, $\\delta_s = 0.01$。\n- 归一化频率：\n  - $\\omega_p = 2\\pi \\frac{20000}{96000} = \\frac{5\\pi}{12} \\approx 1.308996938996$ 弧度/样本。\n  - $\\omega_s = 2\\pi \\frac{47500}{96000} = \\frac{95\\pi}{96} \\approx 3.108643110252$ 弧度/样本。\n- 设计参数：\n  - $\\Delta\\omega = \\omega_s - \\omega_p = \\frac{95\\pi}{96} - \\frac{40\\pi}{96} = \\frac{55\\pi}{96}$ 弧度/样本。\n  - $\\delta = \\min(0.01, 0.01) = 0.01$。\n  - $A = -20 \\log_{10}(0.01) = 40$ dB。\n- 滤波器阶数和长度：\n  - $N_{\\text{min}} = \\lceil \\frac{40 - 8}{2.285 \\cdot (55\\pi/96)} \\rceil = \\lceil \\frac{32}{4.11218} \\rceil = \\lceil 7.782 \\rceil = 8$。\n  - $L = 8 + 1 = 9$。\n  - $L$ 为奇数，因此长度正确。\n- 结果：$\\omega_p = 1.308996938996$，$\\omega_s = 3.108643110252$，$L = 9$。\n\n所有计算现已完成。以下代码将实现此逻辑以生成所需的输出。", "answer": "```python\nimport numpy as np\n\n# This problem requires libraries numpy versions 1.23.5 and scipy versions 1.11.4.\n# The calculation can be completed with numpy alone.\n\ndef solve():\n    \"\"\"\n    Calculates the minimum odd-length FIR filter for given lowpass specifications\n    using the Kaiser window design method.\n    \"\"\"\n    \n    # Test cases: [f_s, f_pass, f_stop, delta_p, delta_s]\n    # f_s:         Sampling frequency in Hz\n    # f_pass:      Passband edge frequency in Hz\n    # f_stop:      Stopband edge frequency in Hz\n    # delta_p:     Passband ripple (linear)\n    # delta_s:     Stopband ripple (linear)\n    test_cases = [\n        [48000, 5000, 7000, 0.01, 0.001],\n        [48000, 18000, 19000, 0.005, 0.005],\n        [44100, 4000, 8000, 0.001, 1e-5],\n        [96000, 20000, 47500, 0.01, 0.01],\n    ]\n\n    results = []\n    for case in test_cases:\n        f_s, f_pass, f_stop, delta_p, delta_s = case\n\n        # Step 1: Convert frequencies to normalized angular frequency (rad/sample)\n        omega_p = 2 * np.pi * f_pass / f_s\n        omega_s = 2 * np.pi * f_stop / f_s\n\n        # Step 2: Determine design parameters\n        # Transition width in rad/sample\n        delta_omega = omega_s - omega_p\n        \n        # Use the stricter ripple constraint\n        delta = min(delta_p, delta_s)\n\n        # Step 3: Calculate required attenuation in dB\n        A = -20 * np.log10(delta)\n\n        # Step 4: Estimate minimum filter order N using Kaiser's formula\n        # N >= (A - 8) / (2.285 * delta_omega)\n        # Note: Using 8.0 as per Oppenheim  Schafer, for consistency with the derivation.\n        # This is a well-established approximation.\n        if delta_omega == 0:\n            # Avoid division by zero, although not expected in these test cases\n            N_min_float = float('inf')\n        else:\n            N_min_float = (A - 8.0) / (2.285 * delta_omega)\n        \n        N = np.ceil(N_min_float)\n        \n        # Step 5: Determine filter length L and enforce the odd-length constraint\n        L = int(N + 1)\n        if L % 2 == 0:\n            L += 1\n            \n        # Store results with required rounding\n        results.append([omega_p, omega_s, L])\n\n    # Format the final output string exactly as specified in the problem\n    formatted_cases = []\n    for case in results:\n        # Format omega_p and omega_s to exactly 12 decimal places\n        # L is an integer\n        formatted_case = f\"[{case[0]:.12f},{case[1]:.12f},{case[2]}]\"\n        formatted_cases.append(formatted_case)\n    \n    # Final output is a single line, a list of lists, with no spaces.\n    final_output = f\"[{','.join(formatted_cases)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "2871821"}, {"introduction": "除了满足频率响应规格，实用滤波器的幅度也必须根据其应用进行正确缩放。本实践深入探讨了通带增益和等效噪声带宽（$B_{e}$）这两个关键概念，探索了不同归一化策略（例如，单位面积与单位能量）如何影响这些特性。理解这种关系对于将滤波器正确集成到更大型的信号处理系统中并准确解释其输出至关重要。[@problem_id:2871841]", "problem": "一个有限长实值冲激响应 $h[n]$, $0 \\leq n \\leq N-1$，其离散时间频率响应为 $H(\\omega) = \\sum_{n=0}^{N-1} h[n] \\exp(-j \\omega n)$，其中 $\\omega$ 是角频率，单位为弧度/样本。其在直流 (DC) 处的通带增益等于 $H(0)=\\sum_{n=0}^{N-1} h[n]$。等效噪声带宽 (ENBW) 定义为\n$$B_{e} \\triangleq \\frac{\\frac{1}{2\\pi}\\int_{-\\pi}^{\\pi} |H(\\omega)|^{2} \\, d\\omega}{|H(0)|^{2}}.$$\n考虑一个 $N$ 阶零相位低通平滑器，实现为一个缩放窗 $h[n] = \\alpha \\, w[n]$，其中 $w[n]$ 是未归一化的 $N$ 点 Hann 窗\n$$w[n] = \\frac{1}{2} - \\frac{1}{2}\\cos\\!\\left(\\frac{2\\pi n}{N-1}\\right), \\quad 0 \\leq n \\leq N-1.$$\n从基本原理和上述定义出发，完成以下任务：\n- 推导标量 $\\alpha$ 的变化如何影响 $H(0)$ 和 $B_{e}$。解释为什么将 $w[n]$ 归一化为单位面积与归一化为单位能量会以根本上不同的方式改变通带增益和 ENBW。\n- 计算 $\\sum_{n=0}^{N-1} w[n]$ 和 $\\sum_{n=0}^{N-1} w^{2}[n]$ 的闭式表达式，用 $N$ 表示。\n- 对于 $N=51$ 的特定情况，使用这些结果来确定从 Hann 窗的单位能量归一化开始，为实现指定的直流通带增益目标 $G_{0} = 1$ 所需的缩放因子 $\\alpha$。将您的答案四舍五入到六位有效数字。将最终答案表示为一个无量纲标量。", "solution": "对问题陈述进行验证。\n\n**步骤 1：提取已知条件**\n- 冲激响应：$h[n]$，实值，对于 $0 \\leq n \\leq N-1$。\n- 离散时间频率响应 (DTFT)：$H(\\omega) = \\sum_{n=0}^{N-1} h[n] \\exp(-j \\omega n)$。\n- 直流增益：$H(0)=\\sum_{n=0}^{N-1} h[n]$。\n- 等效噪声带宽 (ENBW)：$B_{e} \\triangleq \\frac{\\frac{1}{2\\pi}\\int_{-\\pi}^{\\pi} |H(\\omega)|^{2} \\, d\\omega}{|H(0)|^{2}}$。\n- 滤波器实现：$h[n] = \\alpha \\, w[n]$，其中 $\\alpha$ 是一个标量。\n- 未归一化的 Hann 窗：$w[n] = \\frac{1}{2} - \\frac{1}{2}\\cos(\\frac{2\\pi n}{N-1})$, 对于 $0 \\leq n \\leq N-1$。\n- 任务：\n    1. 推导 $\\alpha$ 对 $H(0)$ 和 $B_{e}$ 的影响。\n    2. 解释单位面积归一化与单位能量归一化对通带增益和 ENBW 的不同影响。\n    3. 计算 $\\sum_{n=0}^{N-1} w[n]$ 和 $\\sum_{n=0}^{N-1} w^{2}[n]$ 的闭式表达式。\n    4. 对于 $N=51$，当从单位能量归一化的 Hann 窗开始时，确定实现直流增益目标 $G_{0} = 1$ 所需的 $\\alpha$。答案应四舍五入到六位有效数字。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据**：该问题是数字信号处理领域的标准问题。所有定义，包括 DTFT、ENBW 和 Hann 窗，都是正确且基本的概念。该问题在科学上是合理的。\n- **适定性**：问题陈述清晰，包含了进行所需推导和计算的所有必要信息。存在唯一解。\n- **客观性**：语言技术性强、精确，没有主观或含糊的术语。\n- **结论**：该问题被视为有效。术语“零相位”是对称线性相位滤波器的常用约定，不影响严谨求解，因为 ENBW 的计算仅依赖于幅度响应 $|H(\\omega)|$。\n\n**步骤 3：进行求解**\n\n**第 1 部分：缩放因子 $\\alpha$ 的影响**\n\n冲激响应由 $h[n] = \\alpha \\, w[n]$ 给出。\n直流增益是 $H(0)$，定义为：\n$$H(0) = \\sum_{n=0}^{N-1} h[n] = \\sum_{n=0}^{N-1} \\alpha \\, w[n] = \\alpha \\sum_{n=0}^{N-1} w[n]$$\n直流增益 $H(0)$ 与缩放因子 $\\alpha$ 成正比。\n\n等效噪声带宽 $B_e$ 定义为：\n$$B_{e} = \\frac{\\frac{1}{2\\pi}\\int_{-\\pi}^{\\pi} |H(\\omega)|^{2} \\, d\\omega}{|H(0)|^{2}}$$\n根据离散时间信号的 Parseval 定理，频域中的能量等于时域中的能量：\n$$\\frac{1}{2\\pi}\\int_{-\\pi}^{\\pi} |H(\\omega)|^{2} \\, d\\omega = \\sum_{n=0}^{N-1} |h[n]|^2$$\n由于 $h[n]$ 是实值，因此 $|h[n]|^2 = h[n]^2$。代入 $h[n] = \\alpha \\, w[n]$：\n$$\\sum_{n=0}^{N-1} h[n]^2 = \\sum_{n=0}^{N-1} (\\alpha \\, w[n])^2 = \\alpha^2 \\sum_{n=0}^{N-1} w[n]^2$$\n$B_e$ 表达式的分母是 $|H(0)|^2$：\n$$|H(0)|^2 = \\left( \\alpha \\sum_{n=0}^{N-1} w[n] \\right)^2 = \\alpha^2 \\left( \\sum_{n=0}^{N-1} w[n] \\right)^2$$\n将这些表达式代回 $B_e$ 的定义：\n$$B_{e} = \\frac{\\alpha^2 \\sum_{n=0}^{N-1} w[n]^2}{\\alpha^2 \\left( \\sum_{n=0}^{N-1} w[n] \\right)^2} = \\frac{\\sum_{n=0}^{N-1} w[n]^2}{\\left( \\sum_{n=0}^{N-1} w[n] \\right)^2}$$\n缩放因子 $\\alpha$ 完全消去。因此，等效噪声带宽 $B_e$ 与 $\\alpha$ 无关。\n\n**第 2 部分：归一化方案的比较**\n\n如上所示，ENBW 是窗形状的属性，而非其尺度的属性。任何缩放，包括归一化到单位面积或单位能量，都不会改变 ENBW。归一化方案之间的根本区别在于它们对直流通带增益 $H(0)$ 的影响。\n\n设 $S_1 = \\sum_{n=0}^{N-1} w[n]$ 和 $S_2 = \\sum_{n=0}^{N-1} w[n]^2$ 分别是未归一化窗的和与平方和。未归一化窗形状的 ENBW 是 $B_e = S_2 / S_1^2$。\n\n1.  **单位面积归一化**：此方案创建一个新窗 $w_A[n]$，使其系数和为 $1$。\n    $$w_A[n] = \\frac{w[n]}{S_1} \\implies \\sum_{n=0}^{N-1} w_A[n] = 1$$\n    如果我们构建一个滤波器 $h[n] = w_A[n]$，根据定义其直流增益为 $H(0) = \\sum h[n] = 1$。这种归一化直接将直流增益设为单位 1。后续的缩放 $h[n] = \\alpha w_A[n]$ 会导致直流增益恰好为 $\\alpha$。ENBW 保持不变，为 $B_e = \\frac{\\sum w_A[n]^2}{(\\sum w_A[n])^2} = \\frac{S_2/S_1^2}{1^2} = S_2/S_1^2$。\n\n2.  **单位能量归一化**：此方案创建一个新窗 $w_E[n]$，使其系数的平方和为 $1$。\n    $$w_E[n] = \\frac{w[n]}{\\sqrt{S_2}} \\implies \\sum_{n=0}^{N-1} w_E[n]^2 = 1$$\n    如果我们构建一个滤波器 $h[n] = w_E[n]$，其直流增益是一个派生属性：\n    $$H(0) = \\sum_{n=0}^{N-1} w_E[n] = \\frac{1}{\\sqrt{S_2}} \\sum_{n=0}^{N-1} w[n] = \\frac{S_1}{\\sqrt{S_2}}$$\n    此增益通常不为 1；它取决于窗的形状。后续的缩放 $h[n] = \\alpha w_E[n]$ 会导致直流增益为 $\\alpha S_1 / \\sqrt{S_2}$。ENBW 保持不变，为 $B_e = \\frac{\\sum w_E[n]^2}{(\\sum w_E[n])^2} = \\frac{1}{(S_1/\\sqrt{S_2})^2} = S_2/S_1^2$。\n\n总之，归一化会改变 ENBW 的说法是不正确的；ENBW 对缩放是不变的。根本区别在于对通带增益的处理。单位面积归一化固有地将直流增益设置为 $1$，使增益控制变得简单。单位能量归一化设置了滤波器的总能量，直流增益由此成为一个取决于窗形状因子 $S_1/\\sqrt{S_2}$ 的属性。\n\n**第 3 部分：求和的闭式表达式**\n\n首先，我们计算 $S_1 = \\sum_{n=0}^{N-1} w[n]$：\n$$S_1 = \\sum_{n=0}^{N-1} \\left( \\frac{1}{2} - \\frac{1}{2}\\cos\\left(\\frac{2\\pi n}{N-1}\\right) \\right) = \\frac{N}{2} - \\frac{1}{2} \\sum_{n=0}^{N-1} \\cos\\left(\\frac{2\\pi n}{N-1}\\right)$$\n我们通过考虑复指数求和来评估余弦和。设 $M=N-1$。对于 $N2$，有 $M1$。\n$$\\sum_{n=0}^{N-1} \\cos\\left(\\frac{2\\pi n}{N-1}\\right) = \\text{Re}\\left\\{ \\sum_{n=0}^{M} \\left(\\exp\\left(j\\frac{2\\pi}{M}\\right)\\right)^n \\right\\}$$\n这是一个几何级数。设 $r = \\exp(j\\frac{2\\pi}{M})$。因为 $M1$，所以 $r \\neq 1$。$M+1=N$ 项的和是 $\\frac{1-r^{N}}{1-r}$。\n$$r^N = r^{M+1} = \\exp\\left(j\\frac{2\\pi(M+1)}{M}\\right) = \\exp\\left(j\\left(2\\pi + \\frac{2\\pi}{M}\\right)\\right) = \\exp\\left(j\\frac{2\\pi}{M}\\right) = r$$\n因此，和为 $\\frac{1-r}{1-r}=1$。实部为 $1$。这对 $N2$ 成立。对于 $N=2$，和为 $\\cos(0)+\\cos(2\\pi)=2$。我们关心的情况是 $N=51$，所以我们使用 $N2$ 的结果继续。\n$$S_1 = \\frac{N}{2} - \\frac{1}{2}(1) = \\frac{N-1}{2}$$\n接下来，我们计算 $S_2 = \\sum_{n=0}^{N-1} w^2[n]$：\n$$w^2[n] = \\left( \\frac{1}{2}\\left(1 - \\cos\\left(\\frac{2\\pi n}{N-1}\\right)\\right) \\right)^2 = \\frac{1}{4}\\left(1 - 2\\cos\\left(\\frac{2\\pi n}{N-1}\\right) + \\cos^2\\left(\\frac{2\\pi n}{N-1}\\right)\\right)$$\n使用恒等式 $\\cos^2(\\theta) = \\frac{1}{2}(1 + \\cos(2\\theta))$：\n$$w^2[n] = \\frac{1}{4}\\left(1 - 2\\cos\\left(\\frac{2\\pi n}{N-1}\\right) + \\frac{1}{2} + \\frac{1}{2}\\cos\\left(\\frac{4\\pi n}{N-1}\\right)\\right) = \\frac{1}{4}\\left(\\frac{3}{2} - 2\\cos\\left(\\frac{2\\pi n}{N-1}\\right) + \\frac{1}{2}\\cos\\left(\\frac{4\\pi n}{N-1}\\right)\\right)$$\n从 $n=0$ 到 $N-1$ 求和：\n$$S_2 = \\frac{1}{4}\\left(\\frac{3N}{2} - 2\\sum_{n=0}^{N-1}\\cos\\left(\\frac{2\\pi n}{N-1}\\right) + \\frac{1}{2}\\sum_{n=0}^{N-1}\\cos\\left(\\frac{4\\pi n}{N-1}\\right)\\right)$$\n对于 $N3$，使用与之前相同的几何级数逻辑，两个余弦和的计算结果都为 $1$。\n$$S_2 = \\frac{1}{4}\\left(\\frac{3N}{2} - 2(1) + \\frac{1}{2}(1)\\right) = \\frac{1}{4}\\left(\\frac{3N}{2} - \\frac{3}{2}\\right) = \\frac{3}{8}(N-1)$$\n\n**第 4 部分：缩放因子 $\\alpha$ 的计算**\n\n我们从一个单位能量归一化的 Hann 窗 $w_E[n]$ 开始。\n$$w_E[n] = \\frac{w[n]}{\\sqrt{\\sum_{k=0}^{N-1} w^2[k]}} = \\frac{w[n]}{\\sqrt{S_2}}$$\n滤波器是 $h[n] = \\alpha \\, w_E[n]$。要求直流增益为 $G_0 = H(0) = 1$。\n$$H(0) = \\sum_{n=0}^{N-1} h[n] = \\alpha \\sum_{n=0}^{N-1} w_E[n] = \\frac{\\alpha}{\\sqrt{S_2}} \\sum_{n=0}^{N-1} w[n] = \\frac{\\alpha S_1}{\\sqrt{S_2}} = 1$$\n求解 $\\alpha$：\n$$\\alpha = \\frac{\\sqrt{S_2}}{S_1}$$\n代入 $N3$ 时 $S_1$ 和 $S_2$ 的表达式：\n$$\\alpha = \\frac{\\sqrt{\\frac{3}{8}(N-1)}}{\\frac{N-1}{2}} = \\frac{\\sqrt{3(N-1)}}{\\sqrt{8}} \\cdot \\frac{2}{N-1} = \\frac{2\\sqrt{3(N-1)}}{2\\sqrt{2}(N-1)} = \\frac{\\sqrt{3}}{\\sqrt{2(N-1)}} = \\sqrt{\\frac{3}{2(N-1)}}$$\n对于 $N=51$ 的具体情况：\n$$\\alpha = \\sqrt{\\frac{3}{2(51-1)}} = \\sqrt{\\frac{3}{2(50)}} = \\sqrt{\\frac{3}{100}} = \\frac{\\sqrt{3}}{10}$$\n其数值为 $\\sqrt{3} / 10 \\approx 0.17320508...$。四舍五入到六位有效数字得到 $0.173205$。", "answer": "$$\n\\boxed{0.173205}\n$$", "id": "2871841"}, {"introduction": "理论公式在用代码实现时，尤其是在有限精度运算的约束下，有时会具有欺骗性。这个高级练习解决了一个关键的实际问题：由于灾难性抵消，在计算窄带滤波器的理想脉冲响应时出现的数值不稳定性。您将学习如何利用三角恒等式和 $\\operatorname{sinc}(\\cdot)$ 函数，将标准表达式在分析上重构为数值上稳健的形式，这是开发可靠信号处理软件的一项至关重要的技能。[@problem_id:2871850]", "problem": "您正在使用窗函数法设计一个线性相位有限冲激响应（FIR）滤波器。设理想频率响应为一个偶实值单位增益带通滤波器，定义为 $H_{d}(\\exp(j\\omega))=1$（对于 $\\omega\\in[\\omega_{1},\\omega_{2}]\\cup[-\\omega_{2},-\\omega_{1}]$）及 $H_{d}(\\exp(j\\omega))=0$（对于其他情况），其中 $0\\omega_{1}\\omega_{2}\\pi$。设滤波器长度 $N$ 为奇数，并用 $M=(N-1)/2$ 表示对称中心。待加窗的中心化理想冲激响应 $h_{d}[n]$ 定义为 $H_{d}(\\exp(j\\omega))$ 关于时间索引偏移 $m=n-M$ 的离散时间傅里叶逆变换（DTFT），从而使得期望的冲激响应关于 $m=0$ 为偶对称。假设通带参数化为 $\\omega_{1}=\\omega_{0}-\\Delta/2$ 和 $\\omega_{2}=\\omega_{0}+\\Delta/2$，其中 $0\\Delta\\ll 1$ 且 $0\\omega_{0}\\pi-\\Delta/2$（一个以 $\\omega_{0}$ 为中心的窄带）。所有角度均以弧度为单位。\n\n仅从 DTFT 逆变换公式和给定的 $H_{d}(\\exp(j\\omega))$ 出发，完成以下任务：\n\n1. 推导 $h_{d}[n]$ 关于 $m=n-M$、$\\omega_{0}$ 和 $\\Delta$ 的闭式表达式。仔细分析当 $\\Delta$ 很小时，$m=0$ 和 $|m|$ 很小情况下的行为，并解释如果通过直接减去两个几乎相等的 $\\sin(\\cdot)$ 项来计算该表达式时，数值抵消的来源。然后，使用三角恒等式和 L’Hospital 法则将 $h_{d}[n]$ 改写成对所有整数 $m$（包括 $m=0$）都有效的数值稳定形式。定义 $\\operatorname{sinc}(x)$ 为 $\\sin(x)/x$，并使用 $\\operatorname{sinc}(\\cdot)$ 函数表示 $h_{d}[n]$，使得该公式在 $\\Delta|m|$ 很小时不会遭受灾难性抵消的影响。\n\n2. 使用您得到的稳定表达式，计算极限\n$$\nR(\\omega_{0})=\\lim_{\\Delta\\to 0^{+}}\\frac{h_{d}[M+1]}{h_{d}[M]}。\n$$\n请给出仅含 $\\omega_{0}$ 的单个、精确的闭式表达式作为最终答案。不需要数值近似或四舍五入。角度以弧度表示。", "solution": "该问题陈述科学严谨、定义明确、客观且内部一致。它提出了数字信号处理理论中的一个标准任务：推导带通滤波器的理想冲激响应并分析其性质。该问题是有效的，并且可以通过直接、严谨的方法求解。\n\n我们从基本原理开始分析。所求的冲激响应 $h_d[n]$ 被指定为关于对称中心 $M=(N-1)/2$ 偶对称。这意味着我们正在设计一个零相位滤波器，其冲激响应是索引 $m=n-M$ 的函数，然后应用一个对应于 $M$ 个样本延迟的线性相移以确保因果性。我们将此零相位冲激响应表示为 $h_{d,c}[m]$。根据离散时间傅里叶逆变换（DTFT）的定义，$h_{d,c}[m]$ 由下式给出：\n$$\nh_{d,c}[m] = \\frac{1}{2\\pi} \\int_{-\\pi}^{\\pi} H_d(\\exp(j\\omega)) \\exp(j\\omega m) \\, d\\omega\n$$\n其中 $m = n-M$。问题陈述理想频率响应 $H_d(\\exp(j\\omega))$ 是一个单位增益带通滤波器，在 $\\omega \\in [\\omega_1, \\omega_2] \\cup [-\\omega_2, -\\omega_1]$ 区间上等于 $1$，在其他地方等于 $0$。将此代入积分，我们得到：\n$$\nh_{d,c}[m] = \\frac{1}{2\\pi} \\left( \\int_{-\\omega_2}^{-\\omega_1} \\exp(j\\omega m) \\, d\\omega + \\int_{\\omega_1}^{\\omega_2} \\exp(j\\omega m) \\, d\\omega \\right)\n$$\n我们必须计算这个积分。解取决于 $m$ 是否为零。\n\n情况 1：$m \\neq 0$。\n指数函数的积分是直接的：\n$$\nh_{d,c}[m] = \\frac{1}{2\\pi} \\left( \\left[ \\frac{\\exp(j\\omega m)}{jm} \\right]_{-\\omega_2}^{-\\omega_1} + \\left[ \\frac{\\exp(j\\omega m)}{jm} \\right]_{\\omega_1}^{\\omega_2} \\right)\n$$\n$$\nh_{d,c}[m] = \\frac{1}{2\\pi jm} \\left( (\\exp(-j\\omega_1 m) - \\exp(-j\\omega_2 m)) + (\\exp(j\\omega_2 m) - \\exp(j\\omega_1 m)) \\right)\n$$\n重排各项以组合复指数：\n$$\nh_{d,c}[m] = \\frac{1}{2\\pi jm} \\left( (\\exp(j\\omega_2 m) - \\exp(-j\\omega_2 m)) - (\\exp(j\\omega_1 m) - \\exp(-j\\omega_1 m)) \\right)\n$$\n使用欧拉公式 $\\sin(x) = \\frac{\\exp(jx) - \\exp(-jx)}{2j}$，我们简化表达式：\n$$\nh_{d,c}[m] = \\frac{1}{2\\pi jm} \\left( 2j\\sin(\\omega_2 m) - 2j\\sin(\\omega_1 m) \\right)\n$$\n$$\nh_{d,c}[m] = \\frac{1}{\\pi m} (\\sin(\\omega_2 m) - \\sin(\\omega_1 m))\n$$\n\n情况 2：$m = 0$。\n在这种情况下，被积函数 $\\exp(j\\omega m)$ 变为 $\\exp(0)=1$。积分为：\n$$\nh_{d,c}[0] = \\frac{1}{2\\pi} \\left( \\int_{-\\omega_2}^{-\\omega_1} 1 \\, d\\omega + \\int_{\\omega_1}^{\\omega_2} 1 \\, d\\omega \\right)\n$$\n$$\nh_{d,c}[0] = \\frac{1}{2\\pi} \\left( (-\\omega_1 - (-\\omega_2)) + (\\omega_2 - \\omega_1) \\right) = \\frac{1}{2\\pi} (\\omega_2 - \\omega_1 + \\omega_2 - \\omega_1)\n$$\n$$\nh_{d,c}[0] = \\frac{2(\\omega_2 - \\omega_1)}{2\\pi} = \\frac{\\omega_2 - \\omega_1}{\\pi}\n$$\n现在，我们代入给定的参数化 $\\omega_1 = \\omega_0 - \\Delta/2$ 和 $\\omega_2 = \\omega_0 + \\Delta/2$。带宽 $\\omega_2 - \\omega_1$ 就是 $\\Delta$。\n因此，对于 $m=0$，我们有 $h_{d,c}[0] = \\Delta/\\pi$。\n对于 $m \\neq 0$，代入参数化得到：\n$$\nh_{d,c}[m] = \\frac{1}{\\pi m} \\left( \\sin\\left(\\left(\\omega_0 + \\frac{\\Delta}{2}\\right)m\\right) - \\sin\\left(\\left(\\omega_0 - \\frac{\\Delta}{2}\\right)m\\right) \\right)\n$$\n这个对 $m \\neq 0$ 有效的表达式，连同 $h_{d,c}[0]=\\Delta/\\pi$，构成了理想冲激响应的闭式表达式。\n\n我们被要求分析数值抵消的来源。当带宽 $\\Delta$ 非常小（$\\Delta \\ll 1$）时，频率 $\\omega_1$ 和 $\\omega_2$ 非常接近。因此，对于任何给定的 $m$，两个正弦函数的参数 $(\\omega_0 + \\Delta/2)m$ 和 $(\\omega_0 - \\Delta/2)m$ 也非常接近。在有限精度算术中，直接计算两个几乎相等的数 $\\sin((\\omega_0 + \\Delta/2)m)$ 和 $\\sin((\\omega_0 - \\Delta/2)m)$ 的差值会导致有效数字的损失。这种现象被称为灾难性抵消，会严重降低结果的数值精度。\n\n为了获得数值稳定的形式，我们应用三角函数积化和差恒等式：$\\sin(A) - \\sin(B) = 2\\cos\\left(\\frac{A+B}{2}\\right)\\sin\\left(\\frac{A-B}{2}\\right)$。\n令 $A = (\\omega_0 + \\Delta/2)m$ 和 $B = (\\omega_0 - \\Delta/2)m$。则：\n$$\n\\frac{A+B}{2} = \\frac{(\\omega_0 + \\Delta/2)m + (\\omega_0 - \\Delta/2)m}{2} = \\omega_0 m\n$$\n$$\n\\frac{A-B}{2} = \\frac{(\\omega_0 + \\Delta/2)m - (\\omega_0 - \\Delta/2)m}{2} = \\frac{\\Delta m}{2}\n$$\n将这些代入 $m \\neq 0$ 时的 $h_{d,c}[m]$ 表达式中：\n$$\nh_{d,c}[m] = \\frac{1}{\\pi m} \\left( 2\\cos(\\omega_0 m) \\sin\\left(\\frac{\\Delta m}{2}\\right) \\right)\n$$\n$$\nh_{d,c}[m] = \\frac{2}{\\pi} \\cos(\\omega_0 m) \\frac{\\sin(\\Delta m/2)}{m}\n$$\n这种形式用乘法代替了减法，因此数值上是稳定的。为了使用 $\\operatorname{sinc}(x) = \\sin(x)/x$ 函数来表示，我们重排各项：\n$$\nh_{d,c}[m] = \\frac{2}{\\pi} \\cos(\\omega_0 m) \\left(\\frac{\\Delta}{2}\\right) \\frac{\\sin(\\Delta m/2)}{\\Delta m/2}\n$$\n$$\nh_{d,c}[m] = \\frac{\\Delta}{\\pi} \\cos(\\omega_0 m) \\operatorname{sinc}\\left(\\frac{\\Delta m}{2}\\right)\n$$\n这就是稳定的表达式。为了验证它对所有整数 $m$（包括 $m=0$）都有效，我们可以取 $m \\to 0$ 的极限。正如问题所指出的，这涉及到 L'Hospital 法则，该法则已内含在 sinc 函数原点的定义中。利用 $\\lim_{x\\to 0} \\operatorname{sinc}(x) = 1$ 这一事实：\n$$\n\\lim_{m\\to 0} h_{d,c}[m] = \\lim_{m\\to 0} \\frac{\\Delta}{\\pi} \\cos(\\omega_0 m) \\operatorname{sinc}\\left(\\frac{\\Delta m}{2}\\right) = \\frac{\\Delta}{\\pi} \\cos(0) \\cdot 1 = \\frac{\\Delta}{\\pi}\n$$\n这个极限与我们直接为 $h_{d,c}[0]$ 计算的值相匹配。因此，表达式 $h_d[n] = \\frac{\\Delta}{\\pi} \\cos(\\omega_0 (n-M)) \\operatorname{sinc}\\left(\\frac{\\Delta (n-M)}{2}\\right)$ 对所有整数 $n$ 都是数值稳定且正确的。这结束了问题的第一部分。\n\n对于第二部分，我们必须计算极限 $R(\\omega_0) = \\lim_{\\Delta \\to 0^+} \\frac{h_d[M+1]}{h_d[M]}$。\n使用我们得到的 $h_{d,c}[m]$ 的稳定表达式，我们计算分子和分母。\n分母是 $h_d[M] = h_{d,c}[0]$：\n$$\nh_d[M] = \\frac{\\Delta}{\\pi}\n$$\n分子是 $h_d[M+1] = h_{d,c}[1]$（因为 $m=n-M=(M+1)-M=1$）：\n$$\nh_d[M+1] = \\frac{\\Delta}{\\pi} \\cos(\\omega_0 \\cdot 1) \\operatorname{sinc}\\left(\\frac{\\Delta \\cdot 1}{2}\\right) = \\frac{\\Delta}{\\pi} \\cos(\\omega_0) \\operatorname{sinc}\\left(\\frac{\\Delta}{2}\\right)\n$$\n现在，我们构造比率并取极限：\n$$\nR(\\omega_0) = \\lim_{\\Delta \\to 0^+} \\frac{\\frac{\\Delta}{\\pi} \\cos(\\omega_0) \\operatorname{sinc}(\\frac{\\Delta}{2})}{\\frac{\\Delta}{\\pi}}\n$$\n我们消去项 $\\Delta/\\pi$：\n$$\nR(\\omega_0) = \\lim_{\\Delta \\to 0^+} \\cos(\\omega_0) \\operatorname{sinc}\\left(\\frac{\\Delta}{2}\\right)\n$$\n由于 $\\cos(\\omega_0)$ 与 $\\Delta$ 无关，我们可以将其移到极限符号外：\n$$\nR(\\omega_0) = \\cos(\\omega_0) \\lim_{\\Delta \\to 0^+} \\operatorname{sinc}\\left(\\frac{\\Delta}{2}\\right)\n$$\n当 $\\Delta \\to 0^+$ 时，sinc 函数的参数 $\\Delta/2 \\to 0$。根据定义，$\\lim_{x \\to 0} \\operatorname{sinc}(x) = 1$。因此：\n$$\nR(\\omega_0) = \\cos(\\omega_0) \\cdot 1 = \\cos(\\omega_0)\n$$\n这就是极限的最终精确表达式。", "answer": "$$\n\\boxed{\\cos(\\omega_{0})}\n$$", "id": "2871850"}]}