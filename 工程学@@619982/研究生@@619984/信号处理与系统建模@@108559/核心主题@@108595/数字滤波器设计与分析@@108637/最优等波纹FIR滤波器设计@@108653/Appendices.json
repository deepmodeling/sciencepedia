{"hands_on_practices": [{"introduction": "在实际的滤波器设计中，性能指标通常使用分贝（dB）来描述，例如通带波纹和阻带衰减。然而，等波纹滤波器设计的核心——Parks-McClellan算法，是基于一个处理线性误差量（$\\delta_p$ 和 $\\delta_s$）的加权最小最大化优化问题。本练习旨在搭建起从高级规范到算法底层参数之间的桥梁，指导你如何将标准的分贝指标转换为设计算法所需的线性波纹值和权重比率。[@problem_id:2888701]", "problem": "需要通过对期望幅度响应的加权极小化极大（切比雪夫）逼近来设计一个线性相位最优等波纹有限脉冲响应（FIR）低通滤波器。该期望幅度响应在通带内为1，在阻带内为0。技术指标以分贝（dB）为单位给出：通带波纹至多为 $A_{p} = 0.25$ dB，最小阻带衰减为 $A_{s} = 60$ dB。\n\n从基本定义出发，按以下步骤进行：\n- 使用幅度比的分贝定义，即对于幅度比 $r$，其分贝值为 $20 \\log_{10}(r)$，通过将通带偏差建模为处于 $1 - \\delta_{p}$ 和 $1 + \\delta_{p}$ 之间，推导由 $A_{p}$ 所决定的线性通带波纹 $\\delta_{p}$。\n- 使用相同的分贝定义，通过将最大阻带幅度建模为相对于单位1的 $\\delta_{s}$，推导由 $A_{s}$ 所决定的线性阻带波纹 $\\delta_{s}$。\n- 使用针对具有恒定带权重的两个不相交频带的加权极小化极大准则的定义，推导出使通带和阻带中的最大加权误差相等所需的权重比 $w_{s}/w_{p}$。\n\n计算在给定 $A_{p}$ 和 $A_{s}$ 下 $w_{s}/w_{p}$ 的数值，并将答案四舍五入到四位有效数字。将最终答案表示为一个无单位的无量纲数。", "solution": "该题目陈述已经过验证，具有科学依据、提法恰当且客观。它代表了数字信号处理领域中的一个标准问题。因此，我们可以进行正式求解。\n\n该问题要求基于给定的分贝技术指标，为一个最优等波纹低通滤波器设计推导并计算权重比 $w_s/w_p$。解答过程按照要求从基本原理出发。\n\n首先，我们根据以分贝为单位的通带波纹指标 $A_p$ 来确定线性通带波纹 $\\delta_p$。题目陈述指出，通带内的期望幅度响应为1，而实际滤波器的幅度响应（记为 $|H(\\omega)|$）发生偏离，其范围被界定在 $1 - \\delta_p$ 和 $1 + \\delta_p$ 之间。分贝值 $A_p$ 是针对幅度比 $r$ 定义的，即 $20 \\log_{10}(r)$。对于通带波纹，该比值取自通带内的最大幅度和最小幅度。\n因此，通带波纹 $A_p$ 由下式给出：\n$$ A_p = 20 \\log_{10}\\left(\\frac{1 + \\delta_p}{1 - \\delta_p}\\right) $$\n给定 $A_p = 0.25 \\, \\text{dB}$。我们求解 $\\delta_p$：\n$$ \\frac{A_p}{20} = \\log_{10}\\left(\\frac{1 + \\delta_p}{1 - \\delta_p}\\right) $$\n对两边取以10为底的指数，得到：\n$$ 10^{A_p/20} = \\frac{1 + \\delta_p}{1 - \\delta_p} $$\n为了分离出 $\\delta_p$，我们可以重新整理方程。令 $K = 10^{A_p/20}$。\n$$ K(1 - \\delta_p) = 1 + \\delta_p $$\n$$ K - K\\delta_p = 1 + \\delta_p $$\n$$ K - 1 = \\delta_p (1 + K) $$\n$$ \\delta_p = \\frac{K - 1}{K + 1} = \\frac{10^{A_p/20} - 1}{10^{A_p/20} + 1} $$\n\n接下来，我们根据最小阻带衰减 $A_s$ 来确定线性阻带波纹 $\\delta_s$。阻带内的期望响应为0。滤波器在阻带内的最大幅度记为 $\\delta_s$。阻带衰减 $A_s$ 是通带内的单位参考电平与此最大阻带电平之比，以分贝表示。\n$$ A_s = 20 \\log_{10}\\left(\\frac{1}{\\delta_s}\\right) $$\n给定 $A_s = 60 \\, \\text{dB}$。我们求解 $\\delta_s$：\n$$ A_s = -20 \\log_{10}(\\delta_s) $$\n$$ \\frac{A_s}{-20} = \\log_{10}(\\delta_s) $$\n对两边取以10为底的指数，得到：\n$$ \\delta_s = 10^{-A_s/20} $$\n\n该设计基于加权极小化极大准则，这是等波纹滤波器的基础。其目标是在所有指定频带上最小化最大加权逼近误差 $|E(\\omega)| = |W(\\omega)[H_d(\\omega) - H(\\omega)]|$。其中，$H_d(\\omega)$ 是理想期望响应，$W(\\omega)$ 是一个分段常数加权函数。对于一个最优滤波器，所有频带内的最大加权误差是相等的。\n在通带中，期望响应为 $H_d(\\omega) = 1$，权重为 $w_p$。最大绝对误差为 $|1 - |H(\\omega)||_{\\max} = \\delta_p$。最大加权误差为 $w_p \\delta_p$。\n在阻带中，期望响应为 $H_d(\\omega) = 0$，权重为 $w_s$。最大绝对误差为 $|0 - |H(\\omega)||_{\\max} = \\delta_s$。最大加权误差为 $w_s \\delta_s$。\n等波纹条件要求这些最大加权误差相等：\n$$ w_p \\delta_p = w_s \\delta_s $$\n根据这个等式，我们推导出阻带权重与通带权重之比的要求：\n$$ \\frac{w_s}{w_p} = \\frac{\\delta_p}{\\delta_s} $$\n\n现在，我们将 $\\delta_p$ 和 $\\delta_s$ 的表达式代入此比率：\n$$ \\frac{w_s}{w_p} = \\frac{1}{10^{-A_s/20}} \\left( \\frac{10^{A_p/20} - 1}{10^{A_p/20} + 1} \\right) $$\n给定数值 $A_p = 0.25$ 和 $A_s = 60$。\n首先，我们计算线性波纹：\n对于通带：\n$$ \\delta_p = \\frac{10^{0.25/20} - 1}{10^{0.25/20} + 1} = \\frac{10^{0.0125} - 1}{10^{0.0125} + 1} $$\n$10^{0.0125} \\approx 1.02919311$。\n$$ \\delta_p \\approx \\frac{1.02919311 - 1}{1.02919311 + 1} = \\frac{0.02919311}{2.02919311} \\approx 0.01438685 $$\n对于阻带：\n$$ \\delta_s = 10^{-60/20} = 10^{-3} = 0.001 $$\n最后，我们计算权重比：\n$$ \\frac{w_s}{w_p} = \\frac{\\delta_p}{\\delta_s} \\approx \\frac{0.01438685}{0.001} = 14.38685 $$\n问题要求将答案四舍五入到四位有效数字。第五位有效数字是6，所以我们将第四位数字向上取整。\n$$ \\frac{w_s}{w_p} \\approx 14.39 $$\n这是一个无量纲的量，因为它是两个权重的比值。", "answer": "$$\n\\boxed{14.39}\n$$", "id": "2888701"}, {"introduction": "设置好优化问题后，一个关键的实际问题是：我们应该选择多大的滤波器阶数 $N$？本练习将探讨一个被广泛使用的经验公式，它为 $N$ 提供了一个出色的初始估计值。理解这个源自加窗方法启发式的公式，可以避免对所需滤波器复杂度的盲目搜索，从而节省大量的设计时间。[@problem_id:2888722]", "problem": "您准备运行Parks–McClellan (PM) 算法来设计一个线性相位有限脉冲响应 (FIR) 等波纹滤波器。在运行该算法之前，您需要一个阶数估计值来初始化迭代求解器。从以下基本原理出发：\n- 理想的低通脉冲响应是砖墙谱的离散时间傅里叶逆变换 (DTFT)，而实际的FIR设计通常是通过对理想脉冲响应施加一个时限窗来构建的。\n- 过渡带宽度主要由窗函数的DTFT的主瓣宽度决定，该宽度与滤波器长度成反比。\n- 对于一个给定的窗函数族，其远端旁瓣电平为可实现的均匀波纹幅度设定了一个近似上界，该波纹幅度 $\\delta$ 通过 $A=-20\\log_{10}(\\delta)$ 与分贝衰减相关联。\n- Kaiser窗（离散扁长球状序列的一种近似）通过一个控制贝塞尔函数轮廓的形状参数，参数化了主瓣宽度与旁瓣衰减之间的权衡，从而得出了用于过渡带宽和衰减的经验校准常数。\n\n设设计目标为：\n- 通带边缘位于归一化角频率 $\\,\\omega_{p}\\,$，阻带边缘位于 $\\,\\omega_{s}\\,$，过渡带宽度为 $\\,\\Delta\\omega=\\omega_{s}-\\omega_{p}\\,$。\n- 通带波纹为 $\\,\\delta_{p}\\,$，阻带波纹为 $\\,\\delta_{s}\\,$，并定义 $\\,A=-20\\log_{10}\\!\\big(\\min(\\delta_{p},\\delta_{s})\\big)\\,$。\n\n选择一个选项，该选项能正确解释一个广泛使用的、用于初始FIR长度的经验阶数估计是如何从加窗sinc函数的观点并结合Kaiser窗校准得出的，陈述了阶数对 $\\,A\\,$ 和 $\\,\\Delta\\omega\\,$ 的正确函数依赖关系，并准确描述了这种估计在何种情况下以及为何对于多频带等波纹设计会受到限制或需要调整。\n\nA. 该估计通过使用 $\\,\\Delta\\omega\\approx \\dfrac{2.285\\pi}{N}\\,$ 将Kaiser窗的主瓣宽度等同于过渡带宽度，并取 $\\,A=-20\\log_{10}\\!\\big(\\min(\\delta_{p},\\delta_{s})\\big)\\,$ 得出。它是一个上界，因为等波纹滤波器总是比加窗设计的滤波器需要更多的抽头数。对于多频带滤波器，用所有过渡带宽度的平均值替换 $\\,\\Delta\\omega\\,$ 以保持准确性。\n\nB. 该估计是通过注意到过渡带宽度以一个经Kaiser校准的比例常数与 $\\,\\Delta\\omega\\propto \\dfrac{1}{N}\\,$ 成比例，并且波纹幅度基于窗的旁瓣电平遵循 $\\,A=-20\\log_{10}\\!\\big(\\min(\\delta_{p},\\delta_{s})\\big)\\,$ 这一事实得出的。这产生了一个形式为 $\\,N\\approx \\dfrac{A-8}{2.285\\,\\Delta\\omega}\\,$ 的经验关系，该关系通常比Parks–McClellan等波纹设计所需的阶数高估 $\\,10\\%\\,$ 到 $\\,20\\%\\,$，因此可以作为一个安全的初始猜测。对于多频带设计，使用所有频带中最小的过渡带宽度和最严格的波纹目标可以提供一个保守的起点，但该估计忽略了频带权重分配和紧密间隔的过渡带之间的耦合效应，因此可能低估或高估阶数，并可能需要迭代调整。\n\nC. 常数 $\\,2.285\\,$ 源于Parks–McClellan方法的交错定理，这使得该估计对于等波纹滤波器是精确的。因此，当 $\\,\\Delta\\omega\\,$ 被选为多频带规范中所有过渡带宽度的最小值时，无论频带权重如何，该估计都是精确的。\n\nD. 该估计使用矩形窗主瓣宽度 $\\,\\Delta\\omega\\approx \\dfrac{4\\pi}{N}\\,$ 以及 $\\,A=-10\\log_{10}(\\delta_{p}+\\delta_{s})\\,$。它系统性地低估了Parks–McClellan的阶数，并且随着频带数量的增加而变得更加准确。\n\nE. 该估计通过Parseval定理将群延迟色散与通带波纹等同起来，从而在 $\\,N\\approx \\dfrac{A}{2.285\\,\\Delta\\omega}\\,$ 中得到一个普适常数。在多频带场景中，用所有过渡带宽度的几何平均值替换 $\\,\\Delta\\omega\\,$ 会产生一个保守的估计。", "solution": "问题陈述在数字信号处理领域内提出了一个有效且定义明确的问题。它在科学上基于有限脉冲响应 (FIR) 滤波器设计理论，没有矛盾或模糊之处，并且所有术语都是该领域的标准术语。我将继续进行推导和分析。\n\n该问题要求解释线性相位FIR滤波器的经验阶数估计，特别是从加窗sinc方法并结合Kaiser窗校准推导出的公式，及其与最优Parks–McClellan (PM) 等波纹设计的关系。\n\n线性相位FIR滤波器的设计可以通过截断和加窗理想脉冲响应来实现。对于一个截止频率为 $\\omega_c$ 的低通滤波器，其理想脉冲响应是一个sinc函数：\n$$ h_d[n] = \\frac{\\sin(\\omega_c n)}{\\pi n} $$\n该响应是无限长且非因果的。为了创建一个长度为 $N$ 的实用FIR滤波器，我们将 $h_d[n]$ 与一个长度为 $N$ 的有限长度窗函数 $w[n]$ 相乘。所得滤波器的频率响应 $H(e^{j\\omega})$ 是理想砖墙频率响应 $H_d(e^{j\\omega})$ 与窗函数的离散时间傅里叶变换 (DTFT) $W(e^{j\\omega})$ 的圆周卷积。\n\n这种卷积有两个主要影响：\n$1$. 砖墙滤波器的尖锐不连续性被展宽，形成一个非零宽度的过渡带。这个过渡带的宽度 $\\Delta\\omega$ 由 $W(e^{j\\omega})$ 的主瓣宽度决定。对于长度为 $N$ 的窗函数，主瓣宽度与 $N$ 成反比，即 $\\Delta\\omega \\propto \\frac{1}{N}$。\n$2$. 通带和阻带中的波纹是由 $W(e^{j\\omega})$ 的旁瓣引起的。峰值波纹幅度 $\\delta = \\min(\\delta_p, \\delta_s)$ 由窗函数频谱的峰值旁瓣电平决定。以分贝为单位的阻带衰减 $A$ 通过给定的定义与此波纹相关联：\n$$ A = -20\\log_{10}(\\delta) $$\n\nKaiser窗是一个近最优的窗函数族，它在主瓣宽度和旁瓣电平之间提供了一个由单个参数 $\\beta$ 控制的灵活权衡。通过广泛的经验研究，Kaiser 建立了一些公式，将滤波器指标 $(A, \\Delta\\omega)$ 直接与所需的滤波器长度 $N$ 联系起来。这些公式是：\n对于给定的衰减 $A$，所需的 $\\beta$ 大约为：\n$$ \\beta \\approx \\begin{cases} 0.1102(A - 8.7) & A > 50 \\\\ 0.5842(A - 21)^{0.4} + 0.07886(A - 21) & 21 \\le A \\le 50 \\\\ 0 & A < 21 \\end{cases} $$\n对于给定的 $\\beta$（或 $A$），滤波器长度 $N$ 和过渡带宽度 $\\Delta\\omega$ 之间的关系由下式给出：\n$$ N \\approx \\frac{D(\\beta)}{\\Delta\\omega} \\quad \\text{或} \\quad (N-1)\\Delta\\omega \\approx D(\\beta) $$\n其中 $D(\\beta)$ 是一个依赖于 $\\beta$ 的因子。Kaiser 发现量 $A-8$ 与 $(N-1)\\Delta\\omega$ 大致成正比。这导出了著名的关于滤波器长度 $N$ 的单一经验公式：\n$$ N \\approx \\frac{A - 8}{2.285 \\Delta\\omega} $$\n请注意，一些资料使用 $7.95$ 代替 $8$，并且可能包含一个 $+1$ 项，但所给出的形式是用于估计的最常见的形式。此公式提供了使用 **Kaiser窗方法** 进行设计时所需的滤波器长度。\n\nParks–McClellan算法基于Remez交换算法和交错定理，在切比雪夫意义下设计了一个**最优**的FIR滤波器。“最优”意味着对于给定的滤波器长度 $N$，它可以实现最小可能的峰值误差 $\\delta$；或者反过来说，对于给定的指标 $(\\delta_p, \\delta_s, \\omega_p, \\omega_s)$，它可以找到具有最小可能长度 $N$ 的滤波器。\n\n由于Kaiser窗设计是次优的，它所需的长度 $N_{Kaiser}$ 将大于或等于最优PM算法在相同指标下所需的长度 $N_{PM}$：$N_{Kaiser} \\ge N_{PM}$。因此，Kaiser公式提供了对所需PM滤波器长度的**高估**。这使得它成为PM算法的一个非常有用和安全的起点，因为PM算法需要一个滤波器阶数 ($N-1$) 的初始猜测。这种高估通常是适度的，常在 $10\\%$ 到 $20\\%$ 的范围内，因为Kaiser窗是数学上最优的离散扁长球状序列的一个非常好的近似。\n\n对于具有多个过渡带的多频带滤波器设计（例如，带通或带阻滤波器），设计受限于最严格的指标。阶数估计公式必须使用最窄的过渡带宽度 $\\Delta\\omega_{\\min}$ 和最高的所需衰减 $A_{\\max} = -20\\log_{10}(\\min(\\delta_i))$，其中最小值是在所有频带的波纹指标中取。然而，这个简单的估计有其局限性。PM算法允许对不同频带的误差进行加权，这是基于窗函数的公式所无法体现的特性。此外，如果过渡带彼此靠得很近，它们的频谱特性可能会发生耦合，可能导致需要比估计值更高或更低的阶数。这意味着该估计是一个很好的初始猜测，但可能需要迭代优化。\n\n基于这些基础，我们来评估给出的选项。\n\n**A.** **不正确**。公式 $\\Delta\\omega\\approx \\frac{2.285\\pi}{N}$ 是不正确的；它缺少对衰减 A 的依赖性。认为等波纹滤波器需要*更多*抽头数的推理在事实上是错误的；作为最优设计，它们需要*更少*或相等的抽头数。在多频带设计中使用平均过渡带宽度也是不正确的；最窄的过渡带是限制因素。\n\n**B.** **正确**。该选项正确地陈述了概念基础（$\\Delta\\omega \\propto 1/N$，A 来自旁瓣），提供了正确的经验公式（$N \\approx \\frac{A-8}{2.285\\Delta\\omega}$），准确地描述了其与最优PM设计的关系（它是一个高估值，因此是一个安全的初始猜测），并正确地描述了多频带设计的启发式方法（使用 $\\Delta\\omega_{\\min}$ 和 $A_{\\max}$）以及这种方法的微妙局限性（忽略权重和频带耦合）。\n\n**C.** **不正确**。常数 $2.285$ 来自于*Kaiser窗*的经验校准，而非*交错定理*。该估计是对最优PM滤波器的一个近似，并非精确值。关于不论频带权重如何估计都精确的说法是错误的，因为权重直接影响最终的最优解。\n\n**D.** **不正确**。问题指定的是Kaiser窗校准，而不是矩形窗。矩形窗提供一个固定的、约为 21 dB 的较差衰减，不适合作为通用估计器的基础。衰减的公式是不正确的；它应该是 $-20\\log_{10}(\\delta)$。基于次优窗的估计会高估而不是低估所需的最优阶数。\n\n**E.** **不正确**。所提供的物理推理是不合逻辑的。线性相位FIR滤波器具有恒定的群延迟，因此没有色散可以用来等同。Parseval定理关联的是能量，在此上下文中不适用。该公式缺少了关键的 \"$-8$\" 项。在多频带设计中使用几何平均值是一种不正确的启发式方法。\n\n因此，选项B是唯一一个在其所有科学声明、公式和描述中都正确的选项。", "answer": "$$\\boxed{B}$$", "id": "2888722"}, {"introduction": "最后的这项实践将前面的概念综合成一个完整、自动化的设计流程。它要求学习者设计并实现一个迭代算法，系统地找出满足给定指标的绝对最小滤波器阶数。这是实践设计的巅峰，实现了从单一计算到稳健的程序化解决方案的跨越。[@problem_id:2888670]", "problem": "设计并分析一个迭代过程，用于最优等波纹线性相位有限脉冲响应 (FIR) 滤波器合成。该过程使用 Remez 交换算法，通过增加滤波器阶数来满足指定的通带和阻带波纹约束。此任务包含两部分：算法构建和终止性证明。\n\n设期望响应为单过渡带类型（低通或高通），具有分段常数的理想幅度响应。使用 I 型线性相位 FIR 滤波器，其长度为奇数，因此滤波器阶数由 $N = L - 1$ 给出，其中 $L$ 是抽头数且 $L$ 为奇数。设归一化数字频率为 $f \\in [0, 1]$，其中 $1$ 表示奈奎斯特频率，设 FIR 的离散时间傅里叶变换幅度为 $A(f) \\triangleq \\lvert H(\\mathrm{e}^{\\mathrm{j}\\omega}) \\rvert$，其中 $\\omega = \\pi f$ (以弧度为单位)。定义通带波纹约束为 $\\delta_p > 0$，使得\n$$\n\\sup_{f \\in \\mathcal{P}} \\lvert A(f) - 1 \\rvert \\le \\delta_p,\n$$\n定义阻带泄漏约束为 $\\delta_s > 0$，使得\n$$\n\\sup_{f \\in \\mathcal{S}} \\lvert A(f) \\rvert \\le \\delta_s,\n$$\n其中 $\\mathcal{P}$ 和 $\\mathcal{S}$ 分别表示通带和阻带频率集。\n\n第 1 部分 (算法)。从逼近理论和线性系统的有效基本原理——即在紧集上的 Chebyshev (极小化极大) 逼近范式，其具有分段常数的期望幅度和非负的频带权重——出发，开发一个算法，该算法：\n- 固定滤波器类型（低通或高通）、通带边沿频率 $f_p \\in (0, 1)$、阻带边沿频率 $f_s \\in (0, 1)$（其中 $0 < f_p < f_s < 1$）以及正波纹值 $\\delta_p, \\delta_s$。\n- 对于奇数长度 $L = 3, 5, 7, \\dots$，调用加权等波纹 Remez 设计来生成系数，以在选定的 $L$ 和固定的频带权重下，最小化 $\\mathcal{P} \\cup \\mathcal{S}$ 上的最大加权误差。对于每个 $L$，评估上述定义中的幅度约束是否得到满足（通过 $\\omega = \\pi f$ 将角度解释为弧度）。若不满足，则增加 $L$ 并重复。若满足，则返回满足两个约束的最小阶数 $N = L - 1$。\n- 使用密集的均匀频率网格来验证不等式，在 $f \\in [0, 1]$ 上至少取 $M = 16384$ 个点。\n\n第 2 部分 (终止性)。证明如果存在一个有限阶的 I 型线性相位 FIR 滤波器，对于指定的 $(f_p, f_s)$ 和滤波器类型，满足给定的 $(\\delta_p, \\delta_s)$ 约束，那么第 1 部分中的迭代过程将在有限步内终止，并得到满足约束的最小阶数 $N$。\n\n您的程序应实现第 1 部分的算法，并为以下每个测试规范计算最小阶数 $N$ (一个整数)。频率是归一化的 ($1$ 是奈奎斯特频率)，角度应通过 $\\omega = \\pi f$ 解释为弧度。不涉及物理单位；仅报告整数。\n\n测试套件：\n- 情况 A (低通): $f_p = 0.2$, $f_s = 0.3$, $\\delta_p = 0.01$, $\\delta_s = 0.0015$。\n- 情况 B (高通): $f_s = 0.35$, $f_p = 0.5$, $\\delta_p = 0.005$, $\\delta_s = 0.002$。\n- 情况 C (低通): $f_p = 0.25$, $f_s = 0.38$, $\\delta_p = 0.02$, $\\delta_s = 0.01$。\n- 情况 D (高通): $f_s = 0.25$, $f_p = 0.4$, $\\delta_p = 0.008$, $\\delta_s = 0.004$。\n\n每种情况的接受准则：\n- 对于低通：验证 $\\sup_{f \\in [0, f_p]} \\lvert A(f) - 1 \\rvert \\le \\delta_p$ 和 $\\sup_{f \\in [f_s, 1]} \\lvert A(f) \\rvert \\le \\delta_s$。\n- 对于高通：验证 $\\sup_{f \\in [f_p, 1]} \\lvert A(f) - 1 \\rvert \\le \\delta_p$ 和 $\\sup_{f \\in [0, f_s]} \\lvert A(f) \\rvert \\le \\delta_s$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，顺序为 A, B, C, D，例如 $[N_A,N_B,N_C,N_D]$，其中每个 $N_\\cdot$ 是为该情况找到的最小阶数。\n- 不得有任何额外输出，也不得有任何外部输入。\n\n重要提示：不要使用或假设任何未经证明的最小阶数公式。算法必须基于上述基本原理推导和论证。所有角度均以弧度为单位；在指定的输出格式中，仅为每种情况报告整数 $N$。", "solution": "问题陈述已经过严格验证，并被确定为有效。它在科学上基于成熟的数字信号处理和 Chebyshev 逼近理论，问题设定良好，具有清晰客观的标准，并且没有内部矛盾或严重歧义。该问题是优化滤波器设计中一个标准但并非无足轻重的练习。因此，我们可以着手进行形式化求解。\n\n按照要求，解答分为两部分：算法构建和终止性证明。\n\n**第 1 部分：算法构建**\n\n设计最优等波纹线性相位有限脉冲响应 (FIR) 滤波器本质上是一个最佳一致逼近问题。对于长度为奇数 $L = N+1 = 2k+1$ 的 I 型 FIR 滤波器，其幅度响应 $A(\\omega)$ 是一个实值偶函数，其中 $\\omega = \\pi f$ 是以弧度为单位的归一化角频率，$f \\in [0, 1]$ 是归一化频率，且 $f=1$ 为奈奎斯特频率。它可以表示为一个三角多项式：\n$$A(\\omega) = \\sum_{n=0}^{k} a_n \\cos(n\\omega)$$\n通过代入 $x = \\cos(\\omega)$，此表达式变为一个关于变量 $x$ 的 $k$ 次标准多项式。因此，设计问题转化为寻找多项式 $P_k(x)$，该多项式在一组对应于通带和阻带的不相交区间上最佳地逼近期望响应 $D(x)$。\n\n“最佳”逼近是在 Chebyshev（或极小化极大）意义下的，即寻求最小化最大加权误差。目标函数为：\n$$ \\min_{P_k} \\left\\{ \\max_{x \\in \\text{Bands}} |W(x) [D(x) - P_k(x)]| \\right\\} $$\n此处，$D(x)$ 是期望的分段常数响应（在通带为 $1$，在阻带为 $0$），$W(x)$ 是一个正权重函数。Parks-McClellan 算法是 Remez 交换算法在此特定问题上的应用，它能提供唯一的多项式解。\n\n问题对通带波纹 $\\delta_p$ 和阻带衰减 $\\delta_s$ 规定了独立的约束。设给定滤波器设计所达到的波纹为 $\\delta'_p$ 和 $\\delta'_s$。如果 $\\delta'_p \\le \\delta_p$ 且 $\\delta'_s \\le \\delta_s$，则设计成功。Remez 算法最小化的是单个最大加权误差，我们将其表示为 $\\delta_{minimax}$。实际波纹与此误差的关系为 $\\delta'_p = \\delta_{minimax}/W_p$ 和 $\\delta'_s = \\delta_{minimax}/W_s$，其中 $W_p$ 和 $W_s$ 分别是通带和阻带中的权重。为了构建一个能最优地平衡这两个约束的滤波器，必须设置权重以使相对于规范的相对误差相等。这可以通过将权重比率设置为期望波纹比率的倒数来实现：\n$$ \\frac{W_p}{W_s} = \\frac{\\delta_s}{\\delta_p} $$\n一个方便的选择是 $W_p = \\delta_s$ 和 $W_s = \\delta_p$，或任何具有此比率的组合，例如 $W_p = \\delta_s/\\delta_p$ 和 $W_s = 1$。使用这样的权重，得到的等波纹滤波器将具有满足 $\\delta'_p / \\delta'_s = \\delta_p / \\delta_s$ 的实际波纹。那么，接受性检查就简化为验证 $\\delta'_p \\le \\delta_p$ 是否成立（这会自动意味着 $\\delta'_s \\le \\delta_s$）。\n\n问题的核心是找到满足规范的最小滤波器阶数 $N$。这通过系统性的迭代搜索来完成。\n\n算法流程如下：\n1. 初始化滤波器阶数 $N=2$（对应长度 $L=3$）。后续测试的阶数为 $N=4, 6, 8, \\dots$，以保持 I 型滤波器的结构（奇数长度）。\n2. 对于给定的偶数阶 $N=2k$：\n   a. 定义频带、期望响应和权重。对于通带边沿为 $f_p$ 和阻带边沿为 $f_s$ 的低通滤波器，频带为 $[0, f_p]$ 和 $[f_s, 1]$。在这些频带上的期望响应分别为 $1$ 和 $0$。权重设置为 $W_p = \\delta_s/\\delta_p$ 和 $W_s = 1$。对于高通滤波器，频带为 $[0, f_s]$（阻带）和 $[f_p, 1]$（通带），期望响应为 $0$ 和 $1$，权重为 $W_s=1$ 和 $W_p=\\delta_s/\\delta_p$。\n   b. 使用 Remez 算法（例如 `scipy.signal.remez` 中实现的）计算长度为 $L = N+1$ 的滤波器脉冲响应系数 $h[n]$。\n   c. 在归一化频率范围 $f \\in [0, 1]$ 上，使用一个包含 $M=16384$ 个点的密集频率网格计算滤波器的幅度响应 $A(f)$。\n   d. 通过计算达到的最大波纹来验证约束：\n      i. 通带波纹：$\\delta_p' = \\sup_{f \\in \\mathcal{P}} \\lvert A(f) - 1 \\rvert$。\n      ii. 阻带波纹：$\\delta_s' = \\sup_{f \\in \\mathcal{S}} \\lvert A(f) \\rvert$。\n   e. 如果 $\\delta_p' \\le \\delta_p$ 且 $\\delta_s' \\le \\delta_s$，则当前阶数 $N$ 是满足标准的最小阶数，因为搜索是从最小可能阶数顺序进行的。算法终止并返回此 $N$ 值。\n   f. 如果约束未满足，则增加阶数，$N \\to N+2$，并从步骤 2a 重复该过程。\n\n**第 2 部分：终止性证明**\n\n迭代过程保证在有限步内终止的证明基于最佳多项式逼近的基本性质。\n\n**前提**：我们已知存在至少一个某有限阶（比如 $N_{sol}$）的 I 型线性相位 FIR 滤波器，它对于指定的频带边沿 $(f_p, f_s)$ 满足给定的波纹约束 $(\\delta_p, \\delta_s)$。令 $N_{min}^*$ 为存在解的最小偶数阶。\n\n**逼近误差的单调性**：对于一个固定的逼近问题（即固定的频带、期望函数和权重函数），可实现的最小加权逼近误差 $\\delta_{minimax}$ 是多项式次数 $k$（对应于滤波器阶数 $N=2k$）的单调非增函数。对于在具有非零过渡带（$f_s - f_p > 0$）的不相交区间上的逼近，此关系是严格单调的：\n$$ \\delta_{minimax}(k+1) < \\delta_{minimax}(k) $$\n此性质确保增加滤波器阶数总能获得更好的逼近，从而得到严格更小的可实现波纹。\n\n**终止性论证**：\n1. 算法测试一个单调递增的偶数阶序列 $N_i = 2i$，其中 $i=1, 2, 3, \\dots$。\n2. 对于每个阶数 $N_i$，算法在极小化极大意义下使用规定的权重比构建最优滤波器。令得到的通带和阻带波纹为 $\\delta_p'(N_i)$ 和 $\\delta_s'(N_i)$。\n3. 由于严格单调性，所达到的波纹序列 $\\{\\delta_p'(N_i)\\}$ 和 $\\{\\delta_s'(N_i)\\}$ 随着 $i$ 的增加而严格递减。此外，已知当 $N_i \\to \\infty$ 时，$\\delta_p'(N_i) \\to 0$ 且 $\\delta_s'(N_i) \\to 0$。\n4. 根据我们的初始前提，在有限阶 $N_{min}^*$ 时存在一个解。我们的算法为阶数 $N_{min}^*$ 设计的滤波器，根据定义，是 Parks-McClellan 意义下的最优滤波器。它的性能必须至少与同阶的任何其他任意滤波器一样好（通常会更好）。因此，我们的算法为阶数 $N_{min}^*$ 设计的滤波器保证能满足规范 $(\\delta_p, \\delta_s)$。\n5. 算法的搜索从 $N=2$ 开始，并按顺序遍历所有偶数。测试的阶数序列 $\\{2, 4, 6, \\dots\\}$ 是无界的，因此最终会达到阶数 $N_{min}^*$。\n6. 在测试阶数 $N_{min}^*$ 时，算法会发现约束被满足并终止。因为搜索是按阶数顺序和单调进行的，所以它终止时找到的第一个阶数保证是所需的最小偶数阶。\n\n因此，在存在有限阶解的前提下，该算法保证在有限步内找到最小阶解。", "answer": "```python\nimport numpy as np\nfrom scipy.signal import remez, freqz\n\ndef solve():\n    \"\"\"\n    Designs optimal equiripple FIR filters for given specifications\n    and finds the minimal order required.\n    \"\"\"\n    # Test cases defined in the problem statement.\n    # Format: (filter_type, passband_edge, stopband_edge, passband_ripple, stopband_ripple)\n    # For high-pass filters, passband_edge > stopband_edge.\n    test_cases = [\n        ('low-pass', 0.2, 0.3, 0.01, 0.0015),\n        ('high-pass', 0.5, 0.35, 0.005, 0.002),\n        ('low-pass', 0.25, 0.38, 0.02, 0.01),\n        ('high-pass', 0.4, 0.25, 0.008, 0.004),\n    ]\n\n    results = []\n    \n    # Grid density for filter response verification, as specified.\n    M = 16384\n    # The sampling frequency is set to 2, so the Nyquist frequency is 1.\n    # This aligns the frequency specifications directly with the `remez` and `freqz` conventions.\n    SAMPLING_FREQ = 2.0\n\n    for case in test_cases:\n        filter_type, fp, fs, dp, ds = case\n        \n        # Iteratively find the minimal order N, starting from N=2 and incrementing by 2.\n        # This ensures we are always designing a Type I filter (odd length L=N+1).\n        # A reasonable upper bound is set to prevent an infinite loop.\n        for N in range(2, 200, 2):\n            L = N + 1  # Filter length (number of taps)\n            \n            # Set up parameters for the Remez algorithm based on filter type.\n            # The weights are chosen to balance the passband and stopband ripple\n            # according to their specifications. Wp/Ws = ds/dp.\n            if filter_type == 'low-pass':\n                bands = [0, fp, fs, SAMPLING_FREQ / 2.0]\n                desired = [1, 0]\n                weights = [ds / dp, 1]\n            else:  # high-pass\n                bands = [0, fs, fp, SAMPLING_FREQ / 2.0]\n                desired = [0, 1]\n                weights = [1, ds / dp]\n\n            try:\n                # Design the filter using the Remez exchange algorithm.\n                h = remez(L, bands, desired, weight=weights, fs=SAMPLING_FREQ)\n            except ValueError:\n                # remez may fail for orders that are too low for the given specs.\n                # In such cases, we proceed to the next higher order.\n                continue\n\n            # Verify the designed filter's performance against the specifications.\n            # Calculate the frequency response on the dense grid.\n            f_eval, H_eval = freqz(h, worN=M, fs=SAMPLING_FREQ)\n            A = np.abs(H_eval)\n\n            # Define passband and stopband masks for verification.\n            if filter_type == 'low-pass':\n                passband_mask = f_eval <= fp\n                stopband_mask = f_eval >= fs\n            else:  # high-pass\n                stopband_mask = f_eval <= fs\n                passband_mask = f_eval >= fp\n\n            # Calculate the actual maximum ripples in each band.\n            # A small epsilon is added to handle potential floating point inaccuracies at band edges.\n            passband_ripple = np.max(np.abs(A[passband_mask] - 1)) if np.any(passband_mask) else 0.0\n            stopband_ripple = np.max(A[stopband_mask]) if np.any(stopband_mask) else 0.0\n\n            # Check if both ripple constraints are satisfied.\n            if passband_ripple <= dp and stopband_ripple <= ds:\n                results.append(N)\n                break  # Minimal order found, proceed to the next test case.\n        else:\n            # This block would execute if the loop completes without finding a solution.\n            # For the given problem constraints, this is not expected.\n            # We add a placeholder for robustness.\n            results.append(-1) # Indicates failure to find a solution within the search range.\n\n    # Print the final results in the specified single-line format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2888670"}]}