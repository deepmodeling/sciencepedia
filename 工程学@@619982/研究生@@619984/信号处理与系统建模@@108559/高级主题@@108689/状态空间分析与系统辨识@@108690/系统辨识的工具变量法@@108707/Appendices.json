{"hands_on_practices": [{"introduction": "理论的价值在于实践。在深入探讨工具变量法的具体计算之前，我们必须首先回答一个根本问题：我们的实验数据是否足以唯一地确定模型参数？这个问题引出了可辨识性 (identifiability) 的核心概念。这个练习将通过一个精心设计的思想实验，揭示当输入信号缺乏“持续激励” (persistent excitation) 时会发生什么，从而帮助你深入理解为什么实验设计是系统辨识成功的基石 [@problem_id:2878418]。", "problem": "考虑一个单输入单输出线性时不变系统，其辨识模型为二阶有限脉冲响应结构。测量方程为\n$$\ny(t) \\;=\\; b_{1}\\,u(t-1) \\;+\\; b_{2}\\,u(t-2) \\;+\\; v(t),\n$$\n其中 $u(t)$ 是一个确定性输入，$v(t)$ 是与所有过去输入不相关的零均值扰动，而 $\\theta \\triangleq \\begin{pmatrix} b_{1} & b_{2} \\end{pmatrix}^{\\top}$ 是待辨识的未知参数矢量。定义回归量\n$$\n\\varphi(t) \\;\\triangleq\\; \\begin{pmatrix} u(t-1) & u(t-2) \\end{pmatrix},\n$$\n使得 $y(t) = \\varphi(t)\\,\\theta + v(t)$。为避免由 $v(t)$ 引起的内生性，使用工具变量法，其工具变量矢量为\n$$\nz(t) \\;\\triangleq\\; \\begin{pmatrix} u(t-2) & u(t-3) \\end{pmatrix},\n$$\n和堆叠数据矩阵\n$$\n\\Phi \\;\\triangleq\\; \\begin{pmatrix} \\varphi(3)^{\\top} \\\\ \\varphi(4)^{\\top} \\\\ \\varphi(5)^{\\top} \\\\ \\varphi(6)^{\\top} \\end{pmatrix} \\in \\mathbb{R}^{4 \\times 2}, \n\\qquad\nZ \\;\\triangleq\\; \\begin{pmatrix} z(3)^{\\top} \\\\ z(4)^{\\top} \\\\ z(5)^{\\top} \\\\ z(6)^{\\top} \\end{pmatrix} \\in \\mathbb{R}^{4 \\times 2}.\n$$\n在实验条件 $u(t) \\equiv c$（对于所有整数 $t \\leq 6$，其中 $c$ 为已知非零常数 $c = 3$）下，采集时间 $t \\in \\{3,4,5,6\\}$ 的数据。工具变量法正规方程为\n$$\n\\big(Z^{\\top}\\Phi\\big)\\,\\theta \\;=\\; Z^{\\top} y,\n$$\n并且 $\\theta$ 的可辨识性要求 $Z^{\\top}\\Phi$ 具有满列秩。\n\n仅从上述回归形式和工具变量构造出发，并利用给定的激励，显式地构建 $Z^{\\top}\\Phi$，确定其秩，并根据 $Z^{\\top}\\Phi$ 的零空间来刻画从此实验中不可辨识的参数组合集合。然后，遵循以下约定报告一个能够量化地标识不可辨识方向的矢量：提供张成 $\\operatorname{Null}(Z^{\\top}\\Phi)$ 的、第一个分量为正的唯一单位范数矢量 $v \\in \\mathbb{R}^{2}$。\n\n你的最终答案必须是写成单个 $1 \\times 2$ 矩阵的行矢量 $v^{\\top}$。无需四舍五入，也不涉及单位。", "solution": "所述问题有效。它在科学上合理、适定且客观，呈现了系统辨识中的一个标准情景。所有必要信息均已提供，任务是在特定实验条件下对参数可辨识性进行具体分析。\n\n目标是刻画参数矢量 $\\theta = \\begin{pmatrix} b_{1} & b_{2} \\end{pmatrix}^{\\top}$ 的不可辨识方向。在工具变量估计的背景下，可辨识性要求矩阵 $Z^{\\top}\\Phi$ 具有满列秩。若此条件不满足，则该矩阵是秩亏的，其零空间 $\\operatorname{Null}(Z^{\\top}\\Phi)$ 定义了实验无法检测到的参数变化子空间。此零空间中的任何矢量都代表一种参数组合，该组合在观测到的工具变量法正规方程中不产生任何变化。任务是为此零空间找到一个特定的基矢量。\n\n首先，我们必须根据给定的输入信号构建数据矩阵 $\\Phi$ 和 $Z$。问题指定，对于所有相关时间 $t \\leq 6$，输入 $u(t)$ 是一个常数，$u(t) = c = 3$。\n\n回归量矢量为 $\\varphi(t) = \\begin{pmatrix} u(t-1) & u(t-2) \\end{pmatrix}$。给定常数输入，对于数据矩阵中使用的任何 $t$，我们有 $\\varphi(t) = \\begin{pmatrix} 3 & 3 \\end{pmatrix}$。在 $t \\in \\{3,4,5,6\\}$ 上定义的堆叠回归量矩阵 $\\Phi$ 为：\n$$\n\\Phi = \\begin{pmatrix} \\varphi(3)^{\\top} \\\\ \\varphi(4)^{\\top} \\\\ \\varphi(5)^{\\top} \\\\ \\varphi(6)^{\\top} \\end{pmatrix} = \\begin{pmatrix} u(2) & u(1) \\\\ u(3) & u(2) \\\\ u(4) & u(3) \\\\ u(5) & u(4) \\end{pmatrix} = \\begin{pmatrix} 3 & 3 \\\\ 3 & 3 \\\\ 3 & 3 \\\\ 3 & 3 \\end{pmatrix}.\n$$\n\n工具变量矢量为 $z(t) = \\begin{pmatrix} u(t-2) & u(t-3) \\end{pmatrix}$。同样地，在常数输入下，对于任何 $t$，我们有 $z(t) = \\begin{pmatrix} 3 & 3 \\end{pmatrix}$。堆叠的工具变量矩阵 $Z$ 为：\n$$\nZ = \\begin{pmatrix} z(3)^{\\top} \\\\ z(4)^{\\top} \\\\ z(5)^{\\top} \\\\ z(6)^{\\top} \\end{pmatrix} = \\begin{pmatrix} u(1) & u(0) \\\\ u(2) & u(1) \\\\ u(3) & u(2) \\\\ u(4) & u(3) \\end{pmatrix} = \\begin{pmatrix} 3 & 3 \\\\ 3 & 3 \\\\ 3 & 3 \\\\ 3 & 3 \\end{pmatrix}.\n$$\n\n接下来，我们计算矩阵乘积 $Z^{\\top}\\Phi$。$Z$ 的转置是：\n$$\nZ^{\\top} = \\begin{pmatrix} 3 & 3 & 3 & 3 \\\\ 3 & 3 & 3 & 3 \\end{pmatrix}.\n$$\n那么乘积为：\n$$\nZ^{\\top}\\Phi = \\begin{pmatrix} 3 & 3 & 3 & 3 \\\\ 3 & 3 & 3 & 3 \\end{pmatrix} \\begin{pmatrix} 3 & 3 \\\\ 3 & 3 \\\\ 3 & 3 \\\\ 3 & 3 \\end{pmatrix}.\n$$\n执行矩阵乘法：位置 $(1,1)$ 处的元素是 $(3)(3)+(3)(3)+(3)(3)+(3)(3) = 4 \\times 9 = 36$。由于矩阵的结构，所得乘积的所有元素都相同。\n$$\nZ^{\\top}\\Phi = \\begin{pmatrix} 36 & 36 \\\\ 36 & 36 \\end{pmatrix}.\n$$\n\n现在我们确定这个矩阵的秩。一个 $2 \\times 2$ 矩阵在秩为 $2$ 时具有满列秩。通过观察可知，该矩阵的列是线性相关的（具体来说，第二列与第一列相同），因此可以确定 $Z^{\\top}\\Phi$ 的秩。其行列式为 $\\det(Z^{\\top}\\Phi) = (36)(36) - (36)(36) = 0$。由于该矩阵非零且奇异，其秩为 $1$。这不是满列秩，这证实了参数矢量 $\\theta$ 在此实验设置下是不可辨识的。\n\n不可辨识的方向由 $Z^{\\top}\\Phi$ 的零空间给出。我们寻找一个矢量 $v = \\begin{pmatrix} v_1 \\\\ v_2 \\end{pmatrix}$，使得 $(Z^{\\top}\\Phi)v=0$。\n$$\n\\begin{pmatrix} 36 & 36 \\\\ 36 & 36 \\end{pmatrix} \\begin{pmatrix} v_1 \\\\ v_2 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}.\n$$\n这个矩阵方程可以简化为单个线性方程 $36v_1 + 36v_2 = 0$，化简后得到 $v_1 + v_2 = 0$，即 $v_1 = -v_2$。因此，零空间中的任何矢量都具有 $\\begin{pmatrix} -v_2 \\\\ v_2 \\end{pmatrix} = v_2 \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}$ 的形式，其中 $v_2$ 是某个标量。该零空间是由矢量 $\\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}$ 张成的 $\\mathbb{R}^2$ 的一维子空间。\n\n问题要求一个特定的矢量：张成此零空间的、第一个分量为正的唯一单位范数矢量 $v$。我们当前的张成矢量 $\\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}$ 的第一个分量为负。为了得到一个第一个分量为正的张成矢量，我们可以乘以任何负标量。乘以 $-1$ 得到矢量 $w = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。\n\n最后，我们将 $w$ 归一化为单位范数。其范数为 $\\|w\\| = \\sqrt{1^2 + (-1)^2} = \\sqrt{2}$。所需的单位范数矢量 $v$ 是：\n$$\nv = \\frac{w}{\\|w\\|} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{\\sqrt{2}} \\\\ -\\frac{1}{\\sqrt{2}} \\end{pmatrix}.\n$$\n将分母有理化得到：\n$$\nv = \\begin{pmatrix} \\frac{\\sqrt{2}}{2} \\\\ -\\frac{\\sqrt{2}}{2} \\end{pmatrix}.\n$$\n此矢量满足所有条件：它张成 $\\operatorname{Null}(Z^{\\top}\\Phi)$，其第一个分量为正，且具有单位范数。问题要求的是行矢量 $v^{\\top}$。\n$$\nv^{\\top} = \\begin{pmatrix} \\frac{\\sqrt{2}}{2} & -\\frac{\\sqrt{2}}{2} \\end{pmatrix}.\n$$\n该矢量量化地标识了参数空间 $\\{b_1, b_2\\}$ 中的不可辨识方向。参数矢量 $\\theta$ 沿此方向的任何变化都无法检测。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\sqrt{2}}{2} & -\\frac{\\sqrt{2}}{2} \\end{pmatrix}}\n$$", "id": "2878418"}, {"introduction": "在确保模型参数可辨识之后，我们便可以着手计算参数估计值。工具变量 (IV) 估计可以从不同角度理解，其中最经典的是几何投影和两阶段最小二乘 (2SLS) 算法。这个练习旨在通过一个具体的数值示例，将这两种看似不同的观点联系起来，让你亲手验证它们在代数上的等价性 [@problem_id:2878432]。通过运用 QR 分解等线性代数工具，你将清晰地看到 IV 方法如何通过将有偏的回归量投影到“干净”的工具变量空间中来消除内生性，从而加深对 IV 估计器工作原理的直观理解。", "problem": "考虑一个离散时间、有限样本系统辨识问题的线性回归形式，其中可能存在内生回归量：对于样本索引 $k \\in \\{1,\\dots,n\\}$，测量输出 $y_k$ 和回归量行向量 $\\varphi_k^{\\top}$ 满足 $y_k = \\varphi_k^{\\top}\\theta + v_k$，其中扰动项 $v_k$ 可能与 $\\varphi_k$ 的分量相关，但存在一个工具变量向量 $z_k$ 使得 $\\mathbb{E}[z_k v_k] = 0$ 且 $\\mathbb{E}[z_k \\varphi_k^{\\top}]$ 满列秩。将 $n$ 个样本收集成堆叠的向量和矩阵，得到 $y \\in \\mathbb{R}^{n}$，$\\Phi \\in \\mathbb{R}^{n \\times p}$， $Z \\in \\mathbb{R}^{n \\times m}$，以及未知参数 $\\theta \\in \\mathbb{R}^{p}$。工具变量（IV）法和两阶段最小二乘（2SLS）法都基于将回归量投影到工具变量空间以消除内生性。\n\n给定一个具体的数据集，其中 $n=4$, $p=2$, $m=2$：\n$$\n\\Phi=\\begin{bmatrix}\n1 & 2\\\\\n2 & 1\\\\\n1 & 1\\\\\n0 & 1\n\\end{bmatrix},\\quad\nZ=\\begin{bmatrix}\n1 & 0\\\\\n1 & 0\\\\\n0 & 1\\\\\n0 & 1\n\\end{bmatrix},\\quad\ny=\\begin{bmatrix}\n5\\\\\n4\\\\\n3\\\\\n2\n\\end{bmatrix}.\n$$\n仅使用正交投影算子和正交三角（QR）分解的定义及线性代数性质，按以下步骤进行：\n\n1) 计算 $Z$ 的QR分解，将关联的到 $Z$ 的列空间上的正交投影算子写作 $P_Z$，并通过 $P_Z = QQ^{\\top}$ 从 $Q$ 因子显式地构造 $P_Z$。\n\n2) 利用工具变量原理（即工具变量强制残差与工具变量空间正交），在工具变量空间中建立正规方程组，并使用投影算子 $P_Z$ 为该数据集获得一个显式的估计量 $\\hat{\\theta}_{\\mathrm{IV}}$。\n\n3) 分别地，执行两阶段最小二乘法：首先将回归量投影到工具变量空间以获得拟合回归量，然后通过普通最小二乘法将 $y$ 对这些拟合回归量进行回归。推导出最终的估计量 $\\hat{\\theta}_{\\mathrm{2SLS}}$。\n\n4) 仅使用正交投影算子的性质和 $Q$ 的标准正交性，证明对于满列秩的 $Z$，有 $\\hat{\\theta}_{\\mathrm{IV}}=\\hat{\\theta}_{\\mathrm{2SLS}}$，并数值验证对于给定数据它们是相合的。\n\n将最终的估计量向量 $\\hat{\\theta}_{\\mathrm{IV}}$ 以单个 $1\\times 2$ 行向量的形式报告。无需四舍五入。", "solution": "所述问题科学严谨、适定、客观，且包含求解所需的全部数据。这是线性系统辨识理论中的一个标准练习。因此，我们按要求分四部分进行求解。\n\n给定的数据是回归量矩阵 $\\Phi$、工具变量矩阵 $Z$ 和输出向量 $y$：\n$$\n\\Phi=\\begin{bmatrix}\n1 & 2\\\\\n2 & 1\\\\\n1 & 1\\\\\n0 & 1\n\\end{bmatrix},\\quad\nZ=\\begin{bmatrix}\n1 & 0\\\\\n1 & 0\\\\\n0 & 1\\\\\n0 & 1\n\\end{bmatrix},\\quad\ny=\\begin{bmatrix}\n5\\\\\n4\\\\\n3\\\\\n2\n\\end{bmatrix}\n$$\n维度为 $n=4$, $p=2$ 和 $m=2$。\n\n首先，我们计算工具变量矩阵 $Z$ 的正交三角（QR）分解。$Z$ 的列，记为 $z_1$ 和 $z_2$，是：\n$$\nz_1 = \\begin{bmatrix} 1 \\\\ 1 \\\\ 0 \\\\ 0 \\end{bmatrix}, \\quad z_2 = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 1 \\end{bmatrix}\n$$\n我们观察到这些列已经正交，因为它们的内积是 $z_1^{\\top}z_2 = 1 \\cdot 0 + 1 \\cdot 0 + 0 \\cdot 1 + 0 \\cdot 1 = 0$。因此，施密特正交化过程简化为单位化。平方范数分别为 $\\|z_1\\|^2 = 1^2+1^2 = 2$ 和 $\\|z_2\\|^2 = 1^2+1^2 = 2$。\n$Z$ 的列空间的一组标准正交基由矩阵 $Q$ 的列给出：\n$$\nq_1 = \\frac{z_1}{\\|z_1\\|} = \\frac{1}{\\sqrt{2}}\\begin{bmatrix} 1 \\\\ 1 \\\\ 0 \\\\ 0 \\end{bmatrix}, \\quad q_2 = \\frac{z_2}{\\|z_2\\|} = \\frac{1}{\\sqrt{2}}\\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 1 \\end{bmatrix}\n$$\n$$\nQ = \\frac{1}{\\sqrt{2}}\\begin{bmatrix} 1 & 0 \\\\ 1 & 0 \\\\ 0 & 1 \\\\ 0 & 1 \\end{bmatrix}\n$$\n上三角矩阵 $R$ 通过 $R = Q^{\\top}Z$ 求得：\n$$\nR = \\frac{1}{\\sqrt{2}}\\begin{bmatrix} 1 & 1 & 0 & 0 \\\\ 0 & 0 & 1 & 1 \\end{bmatrix} \\begin{bmatrix} 1 & 0 \\\\ 1 & 0 \\\\ 0 & 1 \\\\ 0 & 1 \\end{bmatrix} = \\frac{1}{\\sqrt{2}}\\begin{bmatrix} 2 & 0 \\\\ 0 & 2 \\end{bmatrix} = \\begin{bmatrix} \\sqrt{2} & 0 \\\\ 0 & \\sqrt{2} \\end{bmatrix}\n$$\n到 $Z$ 的列空间上的正交投影算子 $P_Z$ 由 $Q$ 构造，即 $P_Z = QQ^{\\top}$：\n$$\nP_Z = \\left(\\frac{1}{\\sqrt{2}}\\begin{bmatrix} 1 & 0 \\\\ 1 & 0 \\\\ 0 & 1 \\\\ 0 & 1 \\end{bmatrix}\\right) \\left(\\frac{1}{\\sqrt{2}}\\begin{bmatrix} 1 & 1 & 0 & 0 \\\\ 0 & 0 & 1 & 1 \\end{bmatrix}\\right) = \\frac{1}{2}\\begin{bmatrix} 1 & 1 & 0 & 0 \\\\ 1 & 1 & 0 & 0 \\\\ 0 & 0 & 1 & 1 \\\\ 0 & 0 & 1 & 1 \\end{bmatrix}\n$$\n\n第二，我们推导工具变量（IV）估计量 $\\hat{\\theta}_{\\mathrm{IV}}$。IV 原理要求残差 $y-\\Phi\\hat{\\theta}$ 与工具变量张成的空间正交。这表示为 $Z^{\\top}(y-\\Phi\\hat{\\theta}_{\\mathrm{IV}}) = 0$。该条件等价于要求残差在 $Z$ 的列空间上的投影为零：$P_Z(y-\\Phi\\hat{\\theta}_{\\mathrm{IV}}) = 0$。这导出了方程组 $P_Z \\Phi \\hat{\\theta}_{\\mathrm{IV}} = P_Z y$。$\\hat{\\theta}_{\\mathrm{IV}}$ 的最小二乘解是 $\\hat{\\theta}_{\\mathrm{IV}} = ((P_Z\\Phi)^{\\top} P_Z\\Phi)^{-1} (P_Z\\Phi)^{\\top} P_Z y$。因为 $P_Z$ 是一个正交投影算子，所以它是对称的（$P_Z^{\\top}=P_Z$）和幂等的（$P_Z^2=P_Z$）。表达式简化为：\n$$\n\\hat{\\theta}_{\\mathrm{IV}} = (\\Phi^{\\top}P_Z\\Phi)^{-1} \\Phi^{\\top}P_Z y\n$$\n我们计算所需的矩阵：\n$$\nP_Z \\Phi = \\frac{1}{2}\\begin{bmatrix} 1 & 1 & 0 & 0 \\\\ 1 & 1 & 0 & 0 \\\\ 0 & 0 & 1 & 1 \\\\ 0 & 0 & 1 & 1 \\end{bmatrix} \\begin{bmatrix} 1 & 2\\\\ 2 & 1\\\\ 1 & 1\\\\ 0 & 1 \\end{bmatrix} = \\frac{1}{2}\\begin{bmatrix} 3 & 3 \\\\ 3 & 3 \\\\ 1 & 2 \\\\ 1 & 2 \\end{bmatrix}\n$$\n$$\nP_Z y = \\frac{1}{2}\\begin{bmatrix} 1 & 1 & 0 & 0 \\\\ 1 & 1 & 0 & 0 \\\\ 0 & 0 & 1 & 1 \\\\ 0 & 0 & 1 & 1 \\end{bmatrix} \\begin{bmatrix} 5\\\\ 4\\\\ 3\\\\ 2 \\end{bmatrix} = \\frac{1}{2}\\begin{bmatrix} 9 \\\\ 9 \\\\ 5 \\\\ 5 \\end{bmatrix}\n$$\n接下来，我们构造与 $\\Phi^{\\top}$ 的乘积：\n$$\n\\Phi^{\\top}P_Z \\Phi = \\begin{bmatrix} 1 & 2 & 1 & 0 \\\\ 2 & 1 & 1 & 1 \\end{bmatrix} \\left(\\frac{1}{2}\\begin{bmatrix} 3 & 3 \\\\ 3 & 3 \\\\ 1 & 2 \\\\ 1 & 2 \\end{bmatrix}\\right) = \\frac{1}{2}\\begin{bmatrix} 3+6+1 & 3+6+2 \\\\ 6+3+1+1 & 6+3+2+2 \\end{bmatrix} = \\frac{1}{2}\\begin{bmatrix} 10 & 11 \\\\ 11 & 13 \\end{bmatrix}\n$$\n$$\n\\Phi^{\\top}P_Z y = \\begin{bmatrix} 1 & 2 & 1 & 0 \\\\ 2 & 1 & 1 & 1 \\end{bmatrix} \\left(\\frac{1}{2}\\begin{bmatrix} 9 \\\\ 9 \\\\ 5 \\\\ 5 \\end{bmatrix}\\right) = \\frac{1}{2}\\begin{bmatrix} 9+18+5 \\\\ 18+9+5+5 \\end{bmatrix} = \\frac{1}{2}\\begin{bmatrix} 32 \\\\ 37 \\end{bmatrix}\n$$\n现在，我们求解 $\\hat{\\theta}_{\\mathrm{IV}}$：\n$$\n\\hat{\\theta}_{\\mathrm{IV}} = \\left(\\frac{1}{2}\\begin{bmatrix} 10 & 11 \\\\ 11 & 13 \\end{bmatrix}\\right)^{-1} \\left(\\frac{1}{2}\\begin{bmatrix} 32 \\\\ 37 \\end{bmatrix}\\right) = \\begin{bmatrix} 10 & 11 \\\\ 11 & 13 \\end{bmatrix}^{-1} \\begin{bmatrix} 32 \\\\ 37 \\end{bmatrix}\n$$\n该矩阵的行列式是 $10 \\cdot 13 - 11 \\cdot 11 = 130 - 121 = 9$。其逆矩阵是 $\\frac{1}{9}\\begin{bmatrix} 13 & -11 \\\\ -11 & 10 \\end{bmatrix}$。\n$$\n\\hat{\\theta}_{\\mathrm{IV}} = \\frac{1}{9}\\begin{bmatrix} 13 & -11 \\\\ -11 & 10 \\end{bmatrix} \\begin{bmatrix} 32 \\\\ 37 \\end{bmatrix} = \\frac{1}{9}\\begin{bmatrix} 13 \\cdot 32 - 11 \\cdot 37 \\\\ -11 \\cdot 32 + 10 \\cdot 37 \\end{bmatrix} = \\frac{1}{9}\\begin{bmatrix} 416 - 407 \\\\ -352 + 370 \\end{bmatrix} = \\frac{1}{9}\\begin{bmatrix} 9 \\\\ 18 \\end{bmatrix} = \\begin{bmatrix} 1 \\\\ 2 \\end{bmatrix}\n$$\n\n第三，我们推导两阶段最小二乘（2SLS）估计量 $\\hat{\\theta}_{\\mathrm{2SLS}}$。\n在第一阶段，可能存在内生性的回归量 $\\Phi$ 被投影到工具变量空间。拟合回归量为 $\\hat{\\Phi} = P_Z \\Phi$。我们已经计算过这个矩阵：\n$$\n\\hat{\\Phi} = \\frac{1}{2}\\begin{bmatrix} 3 & 3 \\\\ 3 & 3 \\\\ 1 & 2 \\\\ 1 & 2 \\end{bmatrix}\n$$\n在第二阶段，使用普通最小二乘法（OLS）将输出 $y$ 对拟合回归量 $\\hat{\\Phi}$ 进行回归：\n$$\n\\hat{\\theta}_{\\mathrm{2SLS}} = (\\hat{\\Phi}^{\\top}\\hat{\\Phi})^{-1}\\hat{\\Phi}^{\\top}y\n$$\n我们计算其组成部分：\n$$\n\\hat{\\Phi}^{\\top}\\hat{\\Phi} = (P_Z\\Phi)^{\\top}(P_Z\\Phi) = \\Phi^{\\top}P_Z^{\\top}P_Z\\Phi = \\Phi^{\\top}P_Z\\Phi = \\frac{1}{2}\\begin{bmatrix} 10 & 11 \\\\ 11 & 13 \\end{bmatrix}\n$$\n$$\n\\hat{\\Phi}^{\\top}y = (P_Z\\Phi)^{\\top}y = \\Phi^{\\top}P_Z^{\\top}y = \\Phi^{\\top}P_Z y = \\frac{1}{2}\\begin{bmatrix} 32 \\\\ 37 \\end{bmatrix}\n$$\n$\\hat{\\Phi}^{\\top}\\hat{\\Phi}$ 和 $\\hat{\\Phi}^{\\top}y$ 的表达式与为IV估计量计算的表达式相同。因此，最终的估计量必然相同：\n$$\n\\hat{\\theta}_{\\mathrm{2SLS}} = \\left(\\frac{1}{2}\\begin{bmatrix} 10 & 11 \\\\ 11 & 13 \\end{bmatrix}\\right)^{-1} \\left(\\frac{1}{2}\\begin{bmatrix} 32 \\\\ 37 \\end{bmatrix}\\right) = \\begin{bmatrix} 1 \\\\ 2 \\end{bmatrix}\n$$\n\n第四，我们证明一般等价关系 $\\hat{\\theta}_{\\mathrm{IV}}=\\hat{\\theta}_{\\mathrm{2SLS}}$ 并进行数值验证。\n2SLS 估计量定义为 $\\hat{\\theta}_{\\mathrm{2SLS}} = (\\hat{\\Phi}^{\\top}\\hat{\\Phi})^{-1}\\hat{\\Phi}^{\\top}y$，其中 $\\hat{\\Phi}=P_Z\\Phi$。使用 $P_Z=QQ^{\\top}$ 和性质 $Q^{\\top}Q=I_m$：\n$$\n\\hat{\\Phi}^{\\top}\\hat{\\Phi} = (QQ^{\\top}\\Phi)^{\\top}(QQ^{\\top}\\Phi) = \\Phi^{\\top}QQ^{\\top}QQ^{\\top}\\Phi = \\Phi^{\\top}Q(Q^{\\top}Q)Q^{\\top}\\Phi = \\Phi^{\\top}Q I_m Q^{\\top}\\Phi = (Q^{\\top}\\Phi)^{\\top}(Q^{\\top}\\Phi)\n$$\n以及\n$$\n\\hat{\\Phi}^{\\top}y = (QQ^{\\top}\\Phi)^{\\top}y = \\Phi^{\\top}QQ^{\\top}y = (Q^{\\top}\\Phi)^{\\top}(Q^{\\top}y)\n$$\n将这些代入 2SLS 公式中得到：\n$$\n\\hat{\\theta}_{\\mathrm{2SLS}} = [(Q^{\\top}\\Phi)^{\\top}(Q^{\\top}\\Phi)]^{-1} (Q^{\\top}\\Phi)^{\\top}(Q^{\\top}y)\n$$\n这是变换后模型 $Q^{\\top}y = (Q^{\\top}\\Phi)\\theta + Q^{\\top}v$ 中 $\\theta$ 的 OLS 解。\n\nIV 估计量 $\\hat{\\theta}_{\\mathrm{IV}}$ 源于正交性条件 $Z^{\\top}(y-\\Phi\\hat{\\theta})=0$。由于 $Q$ 的列构成了 $Z$ 的列空间的一组标准正交基，这等价于 $Q^{\\top}(y-\\Phi\\hat{\\theta})=0$，从而得到方程组 $Q^{\\top}\\Phi\\hat{\\theta}_{\\mathrm{IV}}=Q^{\\top}y$。\n\n在恰好辨识的情况下，即工具变量数量 $m$ 等于参数数量 $p$ 时，矩阵 $Q^{\\top}\\Phi$ 是方阵（$p \\times p$），并且在工具变量相关的假设下是可逆的。唯一解为：\n$$\n\\hat{\\theta}_{\\mathrm{IV}} = (Q^{\\top}\\Phi)^{-1}Q^{\\top}y\n$$\n在同样的情况下（$m=p$），2SLS 表达式得以简化，因为 $(Q^{\\top}\\Phi)$ 是方阵且可逆：\n$$\n\\hat{\\theta}_{\\mathrm{2SLS}} = [(Q^{\\top}\\Phi)^{\\top}(Q^{\\top}\\Phi)]^{-1} (Q^{\\top}\\Phi)^{\\top}(Q^{\\top}y) = (Q^{\\top}\\Phi)^{-1}((Q^{\\top}\\Phi)^{\\top})^{-1}(Q^{\\top}\\Phi)^{\\top}(Q^{\\top}y) = (Q^{\\top}\\Phi)^{-1}Q^{\\top}y\n$$\n因此，我们证明了当 $m=p$ 时，$\\hat{\\theta}_{\\mathrm{IV}} = \\hat{\\theta}_{\\mathrm{2SLS}}$。\n所提供的数据集具有 $m=p=2$，因此该等价关系成立。我们的数值计算证实了这一点，因为我们得到 $\\hat{\\theta}_{\\mathrm{IV}} = \\hat{\\theta}_{\\mathrm{2SLS}} = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$。\n\n最终的估计量向量以 $1 \\times 2$ 行向量的形式报告。", "answer": "$$\n\\boxed{\\begin{pmatrix} 1 & 2 \\end{pmatrix}}\n$$", "id": "2878432"}, {"introduction": "获得参数估计值并非系统辨识的终点，而是一个新的起点——模型验证。工具变量法的有效性完全依赖于其核心假设，尤其是工具变量的外生性 (exogeneity)，即它与系统中的真实扰动不相关。这个练习将带你实践模型验证的关键一步：通过检验估计残差与工具变量之间的相关性来评估外生性假设是否成立 [@problem_id:2878466]。你将学习构建并计算一个综合性的检验统计量，这种方法将抽象的统计假设转化为一个具体的、可量化的诊断工具，是任何严谨的建模者都必须掌握的技能。", "problem": "考虑一个通过工具变量法估计的单输入单输出线性时不变系统，其产生了一个残差序列 $\\{\\hat{e}(t)\\}_{t=1}^{T}$ 和一个工具变量序列 $\\{z(t)\\}_{t=1}^{T}$。在模型设定正确且工具变量外生的条件下，一个基本的正交性条件表明，对于所有非负整数 $\\ell$，都有 $\\mathbb{E}[\\hat{e}(t) z(t-\\ell)] = 0$。您的任务是使用一个跨越多个滞后的残差-工具变量相关性检验来验证此条件。\n\n从正交性条件 $\\mathbb{E}[\\hat{e}(t) z(t-\\ell)] = 0$ 出发，并且仅使用随机过程的期望、协方差和相关性的核心定义，构建一个检验统计量。该统计量对于给定的有限正整数 $L$，能够汇总在滞后 $\\ell=0, 1, \\dots, L$ 上反对这些矩条件的样本证据。您的构建应该是无量纲的，并且应能被证明是检验所有这些矩条件同时成立的原假设的一个样本模拟。\n\n然后，对于 $T=12$ 和 $L=3$，假设残差和工具变量已经被去均值，使得 $\\frac{1}{T}\\sum_{t=1}^{T}\\hat{e}(t) = 0$ 且 $\\frac{1}{T}\\sum_{t=1}^{T}z(t) = 0$，并从数据中计算出以下样本能量和交叉和汇总值：\n$$\n\\sum_{t=1}^{T}\\hat{e}(t)^{2} = 24,\\quad \\sum_{t=1}^{T}z(t)^{2} = 36,\n$$\n$$\n\\sum_{t=1}^{T} \\hat{e}(t) z(t) = 2,\\quad \\sum_{t=2}^{T} \\hat{e}(t) z(t-1) = -1,\\quad \\sum_{t=3}^{T} \\hat{e}(t) z(t-2) = 0,\\quad \\sum_{t=4}^{T} \\hat{e}(t) z(t-3) = 1.\n$$\n使用您构建的统计量，为这些数据计算其数值。以一个等于您在 $L=3$ 时的检验统计量值的标量形式提供最终答案。如果您选择提供数值近似值，请将答案四舍五入到四位有效数字；否则，请给出精确值。", "solution": "对于一个设定正确且工具变量有效的模型，其工具变量正交性条件是，对于所有 $\\ell \\geq 0$，都有 $\\mathbb{E}[\\hat{e}(t) z(t-\\ell)] = 0$。这个条件表明，在 $t-\\ell$ 时刻的工具变量与在 $t$ 时刻的估计后残差不相关。为了对此进行经验性评估，可以用其样本模拟来代替总体期望，并进行归一化，以获得可在不同尺度上比较的无量纲量。\n\n量化两个零均值序列 $\\{x(t)\\}$ 和 $\\{y(t)\\}$ 之间线性关系强度的一种标准方法是滞后 $\\ell$ 阶的样本互相关：\n$$\n\\hat{\\rho}_{xy}(\\ell) \\triangleq \\frac{\\sum_{t=\\ell+1}^{T} x(t)\\, y(t-\\ell)}{\\left(\\sum_{t=1}^{T} x(t)^{2}\\right)^{1/2}\\left(\\sum_{t=1}^{T} y(t)^{2}\\right)^{1/2}}.\n$$\n当 $x(t) = \\hat{e}(t)$ 和 $y(t) = z(t)$ 且两个序列都已去均值时，$\\hat{\\rho}_{\\hat{e}z}(\\ell)$ 是 $\\hat{e}(t)$ 和 $z(t-\\ell)$ 之间样本相关性的一个无量纲度量。在工具变量外生性的原假设下，对于每个非负滞后 $\\ell$，$\\hat{\\rho}_{\\hat{e}z}(\\ell)$ 都应接近于零。\n\n为了同时汇总跨越多个滞后的、偏离零的程度，可以使用一个定义如下的综合性统计量：\n$$\nQ_{L} \\triangleq T \\sum_{\\ell=0}^{L} \\hat{\\rho}_{\\hat{e}z}(\\ell)^{2}.\n$$\n该统计量是无量纲、非负的，并且随着样本互相关集合偏离零的程度增大而增大。在标准的正则性条件下以及 $T$ 很大时，在工具变量外生性的原假设下，$Q_{L}$ 具有自由度为 $L+1$ 的渐近卡方分布，这证明了其可以作为跨滞后的全局检验。\n\n我们现在根据提供的汇总数据计算 $Q_{3}$。首先，计算共同的归一化项：\n$$\nD \\triangleq \\left(\\sum_{t=1}^{T} \\hat{e}(t)^{2}\\right)^{1/2}\\left(\\sum_{t=1}^{T} z(t)^{2}\\right)^{1/2} = \\left(24\\right)^{1/2}\\left(36\\right)^{1/2} = \\sqrt{24 \\cdot 36} = \\sqrt{864} = 12\\sqrt{6}.\n$$\n对于每个滞后 $\\ell \\in \\{0,1,2,3\\}$，使用给定的重叠交叉和：\n- 对于 $\\ell = 0$，\n$$\n\\hat{\\rho}_{\\hat{e}z}(0) = \\frac{\\sum_{t=1}^{T} \\hat{e}(t) z(t)}{D} = \\frac{2}{12\\sqrt{6}}.\n$$\n- 对于 $\\ell = 1$，\n$$\n\\hat{\\rho}_{\\hat{e}z}(1) = \\frac{\\sum_{t=2}^{T} \\hat{e}(t) z(t-1)}{D} = \\frac{-1}{12\\sqrt{6}}.\n$$\n- 对于 $\\ell = 2$，\n$$\n\\hat{\\rho}_{\\hat{e}z}(2) = \\frac{\\sum_{t=3}^{T} \\hat{e}(t) z(t-2)}{D} = \\frac{0}{12\\sqrt{6}} = 0.\n$$\n- 对于 $\\ell = 3$，\n$$\n\\hat{\\rho}_{\\hat{e}z}(3) = \\frac{\\sum_{t=4}^{T} \\hat{e}(t) z(t-3)}{D} = \\frac{1}{12\\sqrt{6}}.\n$$\n\n计算样本互相关的平方和：\n$$\n\\sum_{\\ell=0}^{3} \\hat{\\rho}_{\\hat{e}z}(\\ell)^{2} = \\left(\\frac{2}{12\\sqrt{6}}\\right)^{2} + \\left(\\frac{-1}{12\\sqrt{6}}\\right)^{2} + 0^{2} + \\left(\\frac{1}{12\\sqrt{6}}\\right)^{2}.\n$$\n逐项计算，\n$$\n\\left(\\frac{2}{12\\sqrt{6}}\\right)^{2} = \\frac{4}{(12)^{2}\\cdot 6} = \\frac{4}{864},\\quad \\left(\\frac{-1}{12\\sqrt{6}}\\right)^{2} = \\frac{1}{864},\\quad \\left(\\frac{1}{12\\sqrt{6}}\\right)^{2} = \\frac{1}{864}.\n$$\n因此，\n$$\n\\sum_{\\ell=0}^{3} \\hat{\\rho}_{\\hat{e}z}(\\ell)^{2} = \\frac{4 + 1 + 1}{864} = \\frac{6}{864} = \\frac{1}{144}.\n$$\n\n最后，乘以 $T=12$ 来获得检验统计量：\n$$\nQ_{3} = T \\sum_{\\ell=0}^{3} \\hat{\\rho}_{\\hat{e}z}(\\ell)^{2} = 12 \\cdot \\frac{1}{144} = \\frac{1}{12}.\n$$\n这是一个精确值，所以不需要四舍五入。", "answer": "$$\\boxed{\\frac{1}{12}}$$", "id": "2878466"}]}