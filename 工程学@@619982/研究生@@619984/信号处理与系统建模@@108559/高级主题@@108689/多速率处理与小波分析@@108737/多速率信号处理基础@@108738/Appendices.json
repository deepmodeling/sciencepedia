{"hands_on_practices": [{"introduction": "在多速率信号处理中，降采样（或抽取）是实现数据压缩和降低计算负荷的基本工具。然而，过度的降采样会导致频谱混叠，造成不可逆的信息丢失。本练习将引导你从基本原理出发，推导在不进行预滤波的情况下，为保证信号无混叠所需满足的条件，从而确定一个带限宽义平稳过程所能允许的最大整数抽取因子 $[@problem_id:2874149]$。这个推导为你理解抗混叠设计的理论基石提供了坚实的数学基础。", "id": "2874149", "problem": "考虑一个实值广义平稳 (WSS) 离散时间随机过程 $x[n]$，其功率谱密度为 $S_{x}(\\mathrm{e}^{\\mathrm{j}\\omega})$，支撑集在 $|\\omega| \\le \\omega_{p}$ 上，其中 $\\omega_{p} \\in (0,\\pi)$ 是一个已知的通带边缘，单位为弧度/样本。定义抽取过程 $y[n] = x[Mn]$，其中 $M$ 为正整数。在本题中，“无任何预滤波的无混叠”意为，当表示为由抽取操作产生的 $S_{x}(\\mathrm{e}^{\\mathrm{j}\\omega})$ 的移位和频率伸缩副本之和时，$y[n]$ 的功率谱密度在主频率区间 $[-\\pi,\\pi)$ 上不包含重叠的谱副本。\n\n仅从 WSS 过程的基本定义（自相关及其作为功率谱密度的离散时间傅里叶变换）和周期性离散时间指数的傅里叶级数的标准性质出发，推导为避免 $y[n]$ 中出现混叠，$M$ 所需满足的充要条件，并确定使 $y[n]$ 在无任何预滤波情况下无混叠的最大整数 $M$。将最终答案表示为关于 $\\omega_{p}$ 的单个闭式表达式（无需单位）。", "solution": "我们从实值广义平稳 (WSS) 离散时间随机过程的定义开始。令 $r_{x}[m] = \\mathbb{E}\\{x[n]\\;x[n-m]\\}$ 表示自相关序列，由于平稳性，它仅取决于时延 $m$。功率谱密度 (PSD) 定义为自相关的离散时间傅里叶变换，\n$$\nS_{x}(\\mathrm{e}^{\\mathrm{j}\\omega}) = \\sum_{m=-\\infty}^{\\infty} r_{x}[m]\\,\\mathrm{e}^{-\\mathrm{j}\\omega m},\n$$\n并且是 $\\omega$ 的 $2\\pi$ 周期函数。带限假设为，当 $|\\omega| > \\omega_{p}$ 时，$S_{x}(\\mathrm{e}^{\\mathrm{j}\\omega}) = 0$，其中 $\\omega_{p} \\in (0,\\pi)$。\n\n考虑抽取过程 $y[n] = x[Mn]$，其中整数 $M \\ge 1$。其自相关为\n$$\nr_{y}[m] \\triangleq \\mathbb{E}\\{y[n]\\;y[n-m]\\} = \\mathbb{E}\\{x[Mn]\\;x[M(n-m)]\\} = r_{x}[M m].\n$$\n根据定义，$y[n]$ 的功率谱密度为\n$$\nS_{y}(\\mathrm{e}^{\\mathrm{j}\\omega}) = \\sum_{m=-\\infty}^{\\infty} r_{y}[m]\\,\\mathrm{e}^{-\\mathrm{j}\\omega m} = \\sum_{m=-\\infty}^{\\infty} r_{x}[M m]\\,\\mathrm{e}^{-\\mathrm{j}\\omega m}.\n$$\n为了将 $S_{y}(\\mathrm{e}^{\\mathrm{j}\\omega})$ 与 $S_{x}(\\mathrm{e}^{\\mathrm{j}\\omega})$ 相关联，我们使用一个标准恒等式，它通过周期性指数和来分离出序列中每隔 $M$ 个的样本\n$$\n\\frac{1}{M}\\sum_{k=0}^{M-1} \\mathrm{e}^{\\mathrm{j}\\frac{2\\pi k}{M} n} =\n\\begin{cases}\n1, & n \\text{ 是 } M \\text{ 的倍数},\\\\\n0, & \\text{其它情况}.\n\\end{cases}\n$$\n从 $S_{y}$ 的级数出发，插入此恒等式以仅选择 $M$ 的倍数的索引：\n$$\n\\sum_{m=-\\infty}^{\\infty} r_{x}[M m]\\,\\mathrm{e}^{-\\mathrm{j}\\omega m}\n= \\sum_{n=-\\infty}^{\\infty} r_{x}[n]\\,\\mathrm{e}^{-\\mathrm{j}\\frac{\\omega}{M} n}\\cdot \\frac{1}{M}\\sum_{k=0}^{M-1} \\mathrm{e}^{\\mathrm{j}\\frac{2\\pi k}{M} n}.\n$$\n交换求和顺序可得\n$$\nS_{y}(\\mathrm{e}^{\\mathrm{j}\\omega}) = \\frac{1}{M}\\sum_{k=0}^{M-1}\\sum_{n=-\\infty}^{\\infty} r_{x}[n]\\,\\exp\\!\\left(-\\mathrm{j}\\left(\\frac{\\omega - 2\\pi k}{M}\\right) n\\right)\n= \\frac{1}{M}\\sum_{k=0}^{M-1} S_{x}\\!\\left(\\mathrm{e}^{\\mathrm{j}\\frac{\\omega - 2\\pi k}{M}}\\right).\n$$\n这是功率谱密度域中抽取的基本混叠关系。它表明 $S_{y}(\\mathrm{e}^{\\mathrm{j}\\omega})$ 是原始 $S_{x}$ 的 $M$ 个副本之和，每个副本在频率上被压缩了 $M$ 倍，并移动了 $2\\pi$ 的倍数，然后折叠到主区间上。\n\n因为 $S_{x}(\\mathrm{e}^{\\mathrm{j}\\Omega})$ 的支撑集在 $|\\Omega| \\le \\omega_{p}$ 上，所以第 $k$ 项\n$$\nS_{x}\\!\\left(\\mathrm{e}^{\\mathrm{j}\\frac{\\omega - 2\\pi k}{M}}\\right)\n$$\n非零当且仅当\n$$\n\\left|\\frac{\\omega - 2\\pi k}{M}\\right| \\le \\omega_{p}\n\\quad\\Longleftrightarrow\\quad\n|\\omega - 2\\pi k| \\le M\\,\\omega_{p}.\n$$\n因此，在实数轴上，第 $k$ 个副本贡献的支撑集是区间\n$$\n\\left[2\\pi k - M\\,\\omega_{p},\\; 2\\pi k + M\\,\\omega_{p}\\right],\n$$\n其宽度为 $2 M \\omega_{p}$，中心在 $2\\pi k$。当这些区间以 $2\\pi$ 为周期折叠到主区间 $[-\\pi,\\pi)$ 上时，当且仅当相邻的副本发生重叠时，才会出现混叠，这恰好发生在\n$$\nM\\,\\omega_{p} > \\pi.\n$$\n因此，避免混叠的充要条件是\n$$\nM\\,\\omega_{p} \\le \\pi.\n$$\n给定 $\\omega_{p} \\in (0,\\pi)$，满足此不等式的最大整数 $M$ 是\n$$\nM_{\\max} = \\left\\lfloor \\frac{\\pi}{\\omega_{p}} \\right\\rfloor.\n$$\n这实现了无重叠条件，其中 $M\\,\\omega_{p} = \\pi$ 的情况会产生仅在端点处接触的相邻副本（没有正测度的重叠），这在指定的意义上是无混叠的。", "answer": "$$\\boxed{\\left\\lfloor \\dfrac{\\pi}{\\omega_{p}} \\right\\rfloor}$$"}, {"introduction": "与降采样相对应，升采样和插值是提高信号采样率的关键步骤，广泛应用于信号重建和波形合成。本练习通过一个具体的正弦输入信号，让你亲手分析“补零”升采样后产生的频谱镜像，并观察一个简单的线性插值滤波器如何抑制这些不需要的镜像分量 $[@problem_id:2874155]$。通过这个实践，你将对插值滤波器的作用——即从升采样信号的多个频谱副本中恢复出原始基带信号——建立起直观而深刻的理解。", "id": "2874155", "problem": "考虑离散时间信号 $x[n] = \\cos(\\omega_{0} n)$，其中 $0 < \\omega_{0} < \\pi$ 是以弧度为单位的角频率。该信号通过在连续采样点之间插入 $L-1$ 个零点进行因子为 $L \\geq 2$ 的整数上采样，得到 $u[n]$，然后通过一个实现线性插值的零相位有限冲激响应 (FIR) 插值器 $h[n]$ 进行滤波。该插值器定义为\n$$\nh[n] =\n\\begin{cases}\n1 - \\frac{|n|}{L}, & |n| < L,\\\\\n0, & \\text{否则},\n\\end{cases}\n$$\n这是一个长度为 $2L-1$ 的实偶对称核。假设一个理想化的零相位实现（关于 $n=0$ 的非因果对称）。令 $y[n]$ 表示该上采样-滤波链的输出。角度单位为弧度。\n\n仅从上采样、线性时不变 (LTI) 滤波以及离散时间傅里叶变换 (DTFT) 的定义出发，推导 $y[n]$ 作为余弦实数叠加的完整闭式表达式。您的推导必须明确指出：\n- 上采样操作产生的离散时间输出频率，以及\n- 经过给定 $h[n]$ 线性插值后的相应幅度，\n\n所有这些都应表示为 $\\omega_{0}$ 和 $L$ 的函数。将最终答案表示为 $y[n]$ 的单个解析表达式，该表达式明确给出了输出频率集及其幅度。不需要进行数值近似。您的答案应以弧度表示。", "solution": "所陈述的问题是有效的。它在科学上基于数字信号处理的原理，问题设定良好，具有唯一且稳定的解，并使用精确的数学语言进行了客观的表述。所有必要的信息都已提供，且没有内部矛盾。因此，我们可以进行形式化推导。\n\n该问题要求推导输入信号 $x[n] = \\cos(\\omega_{0} n)$ 经过上采样和滤波后得到的输出信号 $y[n]$。推导将在频域中进行，并按要求利用离散时间傅里叶变换 (DTFT)。过程如下：首先，我们找到上采样信号 $u[n]$ 作为离散时间正弦波之和的表示。其次，我们确定线性插值器 $h[n]$ 的频率响应。最后，我们利用“正弦信号通过线性时不变 (LTI) 系统时，会根据系统在该正弦波频率处的频率响应而被缩放和相移”这一特性，将这些结果结合起来。\n\n设输入信号为 $x[n] = \\cos(\\omega_{0} n)$，其中 $0 < \\omega_0 < \\pi$。通过在 $x[n]$ 的连续采样点之间插入 $L-1$ 个零点，进行因子为 $L$ 的上采样。得到的信号 $u[n]$ 定义为：\n$$\nu[n] =\n\\begin{cases}\nx[n/L] = \\cos(\\omega_{0} n/L), & \\text{如果 } n \\text{ 是 } L \\text{ 的倍数}, \\\\\n0, & \\text{否则}.\n\\end{cases}\n$$\n该信号可以使用一个冲激串更紧凑地表示。函数 $\\frac{1}{L}\\sum_{k=0}^{L-1} e^{j(2\\pi k/L)n}$ 在 $n$ 是 $L$ 的倍数时值为 $1$，否则为 $0$。因此，我们可以将 $u[n]$ 写为乘积形式：\n$$\nu[n] = \\cos(\\omega_{0}n/L) \\left( \\frac{1}{L} \\sum_{k=0}^{L-1} e^{j \\frac{2\\pi k}{L} n} \\right)\n$$\n使用欧拉恒等式 (Euler's identity)，$\\cos(\\theta) = \\frac{1}{2}(e^{j\\theta} + e^{-j\\theta})$，我们展开此表达式：\n$$\nu[n] = \\frac{1}{2L} \\left( e^{j\\frac{\\omega_{0}}{L}n} + e^{-j\\frac{\\omega_{0}}{L}n} \\right) \\sum_{k=0}^{L-1} e^{j \\frac{2\\pi k}{L} n} = \\frac{1}{2L} \\sum_{k=0}^{L-1} \\left( e^{j\\left(\\frac{\\omega_{0}+2\\pi k}{L}\\right)n} + e^{j\\left(\\frac{2\\pi k-\\omega_{0}}{L}\\right)n} \\right)\n$$\n我们可以通过令 $m = L-k$（其中 $k \\in \\{1, \\dots, L-1\\}$）来重新排列求和中的第二项。复指数变为 $e^{j\\left(\\frac{2\\pi(L-m)-\\omega_{0}}{L}\\right)n} = e^{j\\left(2\\pi - \\frac{\\omega_{0}+2\\pi m}{L}\\right)n} = e^{-j\\left(\\frac{\\omega_{0}+2\\pi m}{L}\\right)n}$。对 $k$ 从 $0$ 到 $L-1$ 的求和等价于对 $m$ 从 $0$ 到 $L-1$ 的求和。因此，表达式简化为：\n$$\nu[n] = \\frac{1}{L} \\sum_{k=0}^{L-1} \\frac{1}{2} \\left( e^{j\\left(\\frac{\\omega_{0}+2\\pi k}{L}\\right)n} + e^{-j\\left(\\frac{\\omega_{0}+2\\pi k}{L}\\right)n} \\right) = \\frac{1}{L} \\sum_{k=0}^{L-1} \\cos\\left( \\left(\\frac{\\omega_{0}+2\\pi k}{L}\\right) n \\right)\n$$\n这表明上采样信号 $u[n]$ 是 $L$ 个余弦的叠加。上采样操作产生的频率被明确确定为：\n$$\n\\Omega_k = \\frac{\\omega_{0}+2\\pi k}{L}, \\quad \\text{其中 } k \\in \\{0, 1, \\dots, L-1\\}\n$$\n接下来，我们确定 FIR 插值器 $h[n]$ 的频率响应 $H(e^{j\\omega})$。冲激响应是一个三角脉冲，定义为 $h[n] = 1 - \\frac{|n|}{L}$，其中 $|n|<L$。这可以写成 $h[n] = \\frac{1}{L}(L-|n|)$。一个已知的结论是，形式为 $L-|n|$（其中 $|n|<L$）的离散时间三角脉冲是两个长度为 $L$ 的矩形脉冲的卷积。令 $r[n] = 1$ 当 $n \\in \\{0, \\dots, L-1\\}$ 时，否则为 $0$。卷积 $(r*r[-n])[n]$ 的结果恰好是 $L-|n|$，其中 $|n|<L$。\n$r[n]$ 的 DTFT 是 $R(e^{j\\omega}) = \\sum_{n=0}^{L-1} e^{-j\\omega n} = e^{-j\\omega(L-1)/2} \\frac{\\sin(\\omega L/2)}{\\sin(\\omega/2)}$。\n$r[-n]$ 的 DTFT 是 $R(e^{-j\\omega}) = R^*(e^{j\\omega})$，因为 $r[n]$ 是实数。\n根据 DTFT 的卷积特性，$(r*r[-n])[n]$ 的变换是 $R(e^{j\\omega})R^*(e^{j\\omega}) = |R(e^{j\\omega})|^2$。\n$$\n\\text{DTFT}\\{L-|n|\\} = \\left| e^{-j\\omega(L-1)/2} \\frac{\\sin(\\omega L/2)}{\\sin(\\omega/2)} \\right|^2 = \\left( \\frac{\\sin(\\omega L/2)}{\\sin(\\omega/2)} \\right)^2\n$$\n由于 $h[n] = \\frac{1}{L}(L-|n|)$，其频率响应是：\n$$\nH(e^{j\\omega}) = \\frac{1}{L} \\left( \\frac{\\sin(\\omega L/2)}{\\sin(\\omega/2)} \\right)^2\n$$\n输出信号 $y[n]$ 是卷积 $y[n] = (h*u)[n]$。根据卷积的线性性质，我们有：\n$$\ny[n] = h[n] * \\left( \\frac{1}{L} \\sum_{k=0}^{L-1} \\cos(\\Omega_k n) \\right) = \\frac{1}{L} \\sum_{k=0}^{L-1} (h * \\cos(\\Omega_k n))[n]\n$$\n冲激响应为 $h[n]$ 的 LTI 系统对正弦输入 $\\cos(\\Omega_k n)$ 的响应由 $|H(e^{j\\Omega_k})|\\cos(\\Omega_k n + \\angle H(e^{j\\Omega_k}))$ 给出。滤波器 $h[n]$ 是实偶对称的，所以其 DTFT, $H(e^{j\\omega})$，也是实偶对称的。因此，相位 $\\angle H(e^{j\\Omega_k})$ 总是 $0$ 或 $\\pi$。由于 $H(e^{j\\omega})$ 是一个平方量，它是非负的，所以相位为 $0$。对 $\\cos(\\Omega_k n)$ 的响应就是 $H(e^{j\\Omega_k}) \\cos(\\Omega_k n)$。\n将此代入 $y[n]$ 的表达式：\n$$\ny[n] = \\frac{1}{L} \\sum_{k=0}^{L-1} H(e^{j\\Omega_k}) \\cos(\\Omega_k n)\n$$\n我们现在通过代入 $\\omega = \\Omega_k = \\frac{\\omega_{0}+2\\pi k}{L}$ 来计算 $H(e^{j\\Omega_k})$：\n$$\nH(e^{j\\Omega_k}) = \\frac{1}{L} \\left( \\frac{\\sin(\\Omega_k L/2)}{\\sin(\\Omega_k/2)} \\right)^2 = \\frac{1}{L} \\left( \\frac{\\sin\\left(\\frac{(\\omega_{0}+2\\pi k)}{L} \\frac{L}{2}\\right)}{\\sin\\left(\\frac{\\omega_{0}+2\\pi k}{2L}\\right)} \\right)^2 = \\frac{1}{L} \\left( \\frac{\\sin\\left(\\frac{\\omega_{0}}{2} + k\\pi\\right)}{\\sin\\left(\\frac{\\omega_{0}+2\\pi k}{2L}\\right)} \\right)^2\n$$\n由于 $\\sin(\\theta + k\\pi) = (-1)^k \\sin(\\theta)$，分子项变为 $(\\sin(\\frac{\\omega_{0}}{2} + k\\pi))^2 = ((-1)^k \\sin(\\frac{\\omega_{0}}{2}))^2 = \\sin^2(\\frac{\\omega_{0}}{2})$。\n因此，在每个频率 $\\Omega_k$ 处的滤波器增益为：\n$$\nH(e^{j\\Omega_k}) = \\frac{1}{L} \\frac{\\sin^2(\\omega_{0}/2)}{\\sin^2\\left(\\frac{\\omega_{0}+2\\pi k}{2L}\\right)}\n$$\n输出信号 $y[n]$ 中余弦分量的幅度由 $\\frac{1}{L}H(e^{j\\Omega_k})$ 给出。它们是：\n$$\nA_k = \\frac{1}{L^2} \\frac{\\sin^2(\\omega_{0}/2)}{\\sin^2\\left(\\frac{\\omega_{0}+2\\pi k}{2L}\\right)}\n$$\n最后，将幅度代回求和式中，得到输出信号 $y[n]$ 的完整闭式表达式：\n$$\ny[n] = \\sum_{k=0}^{L-1} \\left( \\frac{1}{L^2} \\frac{\\sin^2(\\omega_{0}/2)}{\\sin^2\\left(\\frac{\\omega_{0}+2\\pi k}{2L}\\right)} \\right) \\cos\\left( \\left(\\frac{\\omega_{0}+2\\pi k}{L}\\right) n \\right)\n$$\n此表达式按要求将输出表示为 $L$ 个余弦的实数叠加，并明确指出了频率 $\\Omega_k$ 及其对应的幅度 $A_k$。", "answer": "$$\\boxed{y[n] = \\sum_{k=0}^{L-1} \\left( \\frac{1}{L^2} \\frac{\\sin^2(\\omega_{0}/2)}{\\sin^2\\left(\\frac{\\omega_{0}+2\\pi k}{2L}\\right)} \\right) \\cos\\left( \\left(\\frac{\\omega_{0}+2\\pi k}{L}\\right) n \\right)}$$"}, {"introduction": "现在，让我们将理论知识应用于一个真实的工程设计挑战：构建一个异步采样率转换器 (SRC)。这类转换器是现代数字音频和通信系统的核心部件，能够处理采样率之间存在非有理数比例的转换。本练习要求你编写一个程序，根据给定的性能指标（如通带波纹和过渡带宽），综合运用滤波器设计、误差预算和多相结构等知识，来确定FIR滤波器的长度 $N$ 和多相表的大小 $P$，并最终计算出所需的内存 $[@problem_id:2874140]$。这项实践将理论与实际代码实现联系起来，全面考验你解决复杂系统设计问题的能力。", "id": "2874140", "problem": "设计并分析一个通过带有动态多相表的加窗 sinc 有限脉冲响应 (FIR) 核函数实现的异步采样率转换 (SRC) 级。该 SRC 将采样率为 $f_{\\mathrm{i}}$ (单位 Hz) 的输入离散时间信号映射到采样率为 $f_{\\mathrm{o}}$ (单位 Hz) 的输出，其比率 $r = f_{\\mathrm{o}}/f_{\\mathrm{i}}$ 通常为无理数。该核函数是理想带限插值的一个截断和加窗近似。动态多相结构使用一个分数延迟相位的查找表，以在重采样引起的瞬时分数延迟处对核函数进行求值。目标是：(i) 确定满足指定通带波纹所需的最小滤波器长度 $N$，(ii) 确定满足指定的最大总通带幅度误差预算所需的最小存储分数延迟相位数 $P$，以及 (iii) 计算存储系数表和输入状态缓冲区所需的总内存。\n\n从适用于多速率信号处理和线性时不变 FIR 滤波器设计的第一性原理出发：\n\n- 理想带限插值的特征是 sinc 核函数，实际实现通过对 sinc 函数进行截断和加窗得到的有限长度 FIR 滤波器来近似它。\n- 为避免异步重采样中的混叠和镜像，基带必须被限制在一个对输入和输出采样率都有效的公共通带内。\n- 经典的窗函数设计将可实现的阻带衰减与窗函数参数和所需的过渡带宽联系起来，从而与最小 FIR 长度联系起来。\n- 有限相位表密度对分数延迟的量化会引入额外的通带幅度偏差，该偏差必须保持在未被通带波纹占用的剩余误差预算之内。\n\n您的程序必须实现基于这些原理推导出的以下逻辑：\n\n1. 确定阻带边缘 $\\,\\Omega_{\\mathrm{s}}$，单位为弧度/采样点，并归一化到输入采样网格。证明异步转换的公共基带约束意味着 $\\,\\Omega_{\\mathrm{s}} = \\pi \\,\\min(1, r)$，并选择一个通带边缘 $\\,\\Omega_{\\mathrm{p}} = \\Omega_{\\mathrm{s}} - \\Delta\\omega$，其中 $\\,\\Delta\\omega$ 是非负的过渡带宽，单位为弧度。所有角度单位必须是弧度。\n\n2. 给定一个通带波纹规范 $\\,\\delta_{\\mathrm{p}}$（无量纲，使用小数形式，而非百分比）和一个过渡带宽 $\\,\\Delta\\omega$，推导 FIR 长度 $N$ 的下界，以便加窗 sinc 低通滤波器能够达到指定的波纹。使用一个经过充分测试的窗函数设计框架，将阻带衰减与 $\\,\\delta_{\\mathrm{p}}$ 和 $\\,\\Delta\\omega$ 联系起来，并由此推导出最小整数 $N$。选择 $N$ 为满足该下界的最小奇数。\n\n3. 给定一个最大总通带幅度误差预算 $\\,\\delta_{\\max}$（无量纲），在考虑通带波纹后，将剩余的误差分配给相位表量化，即 $\\,\\delta_{\\mathrm{phase}} = \\delta_{\\max} - \\delta_{\\mathrm{p}}$。使用复指数的小角度界来给出由分数延迟量化（从 $P$ 个均匀分布在一个采样点延迟内的相位中进行最近邻选择）引起的通带幅度偏差的上限。推导一个关于 $P$ 的充分下界，以保证在 $[0,\\Omega_{\\mathrm{p}}]$ 上引起的偏差不超过 $\\,\\delta_{\\mathrm{phase}}$，然后选择 $P$ 为满足该界限且 $P \\ge 1$ 的最小整数。\n\n4. 假设系数和样本均使用 $32$ 位浮点存储。按如下方式计算总内存（以字节为单位）：\n$$\nM = P \\, N \\, B_{\\mathrm{c}} + N \\, B_{\\mathrm{s}},\n$$\n其中每个系数 $B_{\\mathrm{c}} = 4$ 字节，每个状态样本 $B_{\\mathrm{s}} = 4$ 字节，并且只保留一个长度为 $N$ 的输入延迟线。如果因为 $\\,\\Delta\\omega \\ge \\Omega_{\\mathrm{s}}$ 或 $\\,\\delta_{\\mathrm{phase}} \\le 0$ 导致规范不可行，则为该测试用例返回整数 $-1$。\n\n所有角度单位必须是弧度。内存必须以整数形式表示，单位为字节。所有波纹和误差预算必须是小数（例如，$0.001$）而不是百分比。\n\n将您的解决方案实现为一个完整的、可运行的程序，将上述设计应用于以下测试套件。每个测试用例是一个元组 $(f_{\\mathrm{i}}, f_{\\mathrm{o}}, \\mathrm{tw}, \\delta_{\\mathrm{p}}, \\delta_{\\max})$，其中 $\\mathrm{tw}$ 是表示为 $\\pi$ 的分数的过渡带宽，因此 $\\Delta\\omega = \\pi \\,\\mathrm{tw}$：\n\n- 测试 1 (正常路径下采样): $(48000, 44100, 0.05, 0.001, 0.002)$\n- 测试 2 (正常路径上采样): $(44100, 96000, 0.10, 0.0005, 0.0012)$\n- 测试 3 (不可行误差预算边界): $(48000, 48000, 0.02, 0.0001, 0.0001)$\n- 测试 4 (窄过渡带的大幅度下采样): $(192000, 8000, 0.01, 0.002, 0.005)$\n- 测试 5 (不可行的过渡带宽): $(22050, 11025, 0.60, 0.001, 0.002)$\n\n您的程序必须打印一行，其中包含测试套件的结果，格式为方括号括起来的逗号分隔列表（例如，$[m_1,m_2,m_3,m_4,m_5]$），其中每个 $m_k$ 是测试 $k$ 的总内存（以字节为单位的整数），如果不可行则为 $-1$。", "solution": "对提供的问题进行严格验证。\n\n### 步骤 1：提取已知条件\n- **输入信号速率**: $f_{\\mathrm{i}}$，单位 Hz。\n- **输出信号速率**: $f_{\\mathrm{o}}$，单位 Hz。\n- **重采样比率**: $r = f_{\\mathrm{o}}/f_{\\mathrm{i}}$。\n- **核心技术**: 使用带有动态多相表的加窗 sinc 有限脉冲响应 (FIR) 核函数实现的异步采样率转换 (SRC)。\n- **滤波器长度**: $N$，待确定。\n- **多相相位数量**: $P$，待确定。\n- **通带波纹规范**: $\\delta_{\\mathrm{p}}$ (无量纲)。\n- **最大总通带幅度误差**: $\\delta_{\\max}$ (无量纲)。\n- **过渡带宽**: $\\Delta\\omega$，单位为弧度/采样点，由分数参数 $\\mathrm{tw}$ 导出，即 $\\Delta\\omega = \\pi \\cdot \\mathrm{tw}$。\n- **阻带边缘频率**: $\\Omega_{\\mathrm{s}} = \\pi \\min(1, r)$ 弧度/采样点，归一化到输入采样网格。\n- **通带边缘频率**: $\\Omega_{\\mathrm{p}} = \\Omega_{\\mathrm{s}} - \\Delta\\omega$ 弧度/采样点。\n- **滤波器长度约束**: $N$ 必须是满足设计要求的最小奇整数。\n- **相位量化误差预算**: $\\delta_{\\mathrm{phase}} = \\delta_{\\max} - \\delta_{\\mathrm{p}}$。\n- **相位表大小约束**: $P$ 必须是满足误差预算 $\\delta_{\\mathrm{phase}}$ 且 $P \\ge 1$ 的最小整数。\n- **存储**: $B_{\\mathrm{c}} = 4$ 字节（32 位浮点系数）；$B_{\\mathrm{s}} = 4$ 字节（32 位浮点状态样本）。\n- **总内存计算**: $M = P \\cdot N \\cdot B_{\\mathrm{c}} + N \\cdot B_{\\mathrm{s}}$。\n- **不可行条件**: 如果 $\\Delta\\omega \\ge \\Omega_{\\mathrm{s}}$ 或 $\\delta_{\\mathrm{phase}} \\le 0$，则设计不可行。在这种情况下，输出为 $-1$。\n\n### 步骤 2：验证\n该问题在数字信号处理，特别是多速率系统和 FIR 滤波器设计的既定原理上具有科学依据。sinc 插值、加窗方法、多相结构和误差预算等概念都是标准的，并得到了准确的表述。该问题是适定的，提供了一条从一组输入到唯一输出的清晰、确定性的路径。它以客观、技术性的语言表述。 “使用经过充分测试的窗函数设计框架”的要求被解释为采用标准的经验公式，其中 Kaiser 窗设计方程是一个合适且行业标准的选择。相位表大小的推导由使用小角度近似的提示引导，这指向了对相位量化误差的标准分析。该问题是自洽、一致且可形式化的。\n\n### 步骤 3：结论\n问题被认定为 **有效**。将根据概述的原理开发完整的解决方案。\n\n### 解法推导\n解法是按照问题陈述中指定的步骤顺序推导出来的。\n\n**1. 通带和阻带边缘频率**\n\n异步采样率转换的基础是将离散时间输入信号视为某个底层连续时间带限信号的样本，然后以新的输出速率对该信号进行重采样。为了防止重采样时发生混叠，信号的带宽必须限制在*输入和输出*采样网格两者奈奎斯特频率的最小值以下。\n输入奈奎斯特频率是 $\\pi$ 弧度/输入采样点。输出奈奎斯特频率，当映射回输入网格时，是 $\\pi \\cdot (f_{\\mathrm{o}}/f_{\\mathrm{i}}) = \\pi r$ 弧度/输入采样点。因此，必须用一个截止频率低于这两个奈奎斯特频率最小值的低通滤波器对信号进行滤波。这决定了所需的抗混叠/抗镜像滤波器的阻带边缘 $\\Omega_{\\mathrm{s}}$，归一化到输入采样率 $f_{\\mathrm{i}}$：\n$$\n\\Omega_{\\mathrm{s}} = \\min(\\pi, \\pi r) = \\pi \\min(1, r)\n$$\n滤波器的通带必须在向阻带过渡之前结束。给定一个指定的过渡带宽 $\\Delta\\omega$，通带边缘频率 $\\Omega_{\\mathrm{p}}$ 为：\n$$\n\\Omega_{\\mathrm{p}} = \\Omega_{\\mathrm{s}} - \\Delta\\omega\n$$\n一个物理上有意义的滤波器需要一个非负的过渡区，因此 $\\Delta\\omega < \\Omega_{\\mathrm{s}}$。如果 $\\Delta\\omega \\ge \\Omega_{\\mathrm{s}}$，通带宽度将为零或负，这是一个不可行的规范。\n\n**2. FIR 滤波器长度 $N$**\n\nFIR 滤波器近似于理想矩形低通响应。问题指定了加窗 sinc 设计。滤波器长度 $N$ 主要由过渡带的锐度 $\\Delta\\omega$ 和所需的阻带衰减 $A$ 决定。通带波纹规范 $\\delta_{\\mathrm{p}}$ 用于确定 $A$。对于通过加窗法设计的线性相位 FIR 滤波器，一个合理的近似是通带波纹和阻带波纹相等：$\\delta_{\\mathrm{s}} \\approx \\delta_{\\mathrm{p}}$。阻带衰减（以分贝为单位）定义为：\n$$\nA = -20 \\log_{10}(\\delta_{\\mathrm{p}})\n$$\n我们采用 Kaiser 窗的经验公式，该公式提供了滤波器长度 $N$、过渡带宽 $\\Delta\\omega$ 和衰减 $A$ 之间的关系。所需的滤波器阶数 $M=N-1$ 由下式给出：\n$$\nM \\approx \\frac{A - 8}{2.285 \\Delta\\omega}\n$$\n因此，所需的滤波器长度 $N = M+1$ 为：\n$$\nN \\ge \\frac{A - 8}{2.285 \\Delta\\omega} + 1\n$$\n问题要求 $N$ 是满足此边界的最小*奇*整数。这确保了滤波器是一个具有整数样本延迟的 I 型线性相位滤波器。我们计算 $N$ 的浮点下界，取其上限以找到最小整数长度，如果结果是偶数，则增加到下一个奇数。\n\n**3. 多相表大小 $P$**\n\n总通带幅度误差预算 $\\delta_{\\max}$ 在滤波器的固有通带波纹 $\\delta_{\\mathrm{p}}$ 和由量化分数延迟引入的误差之间分配。为延迟量化剩余的预算为：\n$$\n\\delta_{\\mathrm{phase}} = \\delta_{\\max} - \\delta_{\\mathrm{p}}\n$$\n如果 $\\delta_{\\mathrm{phase}} \\le 0$，则仅滤波器的波纹就耗尽了整个误差预算，使得该规范不可行。\n\n一个有 $P$ 个条目的多相表将连续的分数延迟 $\\tau \\in [0, 1)$ 量化为集合 $\\{0, 1/P, \\dots, (P-1)/P\\}$ 中的最近值。分数延迟的最大误差是 $\\Delta\\tau_{\\max} = 1/(2P)$ 个采样点。这个时域误差扰动了理想的分数延迟滤波器响应 $e^{-j\\omega\\tau}$。引入的相对误差是 $e^{-j\\omega\\Delta\\tau} - 1$。假设目标通带幅度为 1，该复数误差项的幅度可以很好地近似其导致的通带幅度偏差：\n$$\n\\text{Error}(\\omega, \\Delta\\tau) = |e^{-j\\omega\\Delta\\tau} - 1| = \\sqrt{(\\cos(\\omega\\Delta\\tau) - 1)^2 + \\sin^2(\\omega\\Delta\\tau)} = 2|\\sin(\\omega\\Delta\\tau/2)|\n$$\n这个误差在通带边缘 $\\omega = \\Omega_{\\mathrm{p}}$ 和最大延迟误差 $|\\Delta\\tau| = 1/(2P)$ 处最大化。为了满足规范，我们必须确保这个最大误差不超过 $\\delta_{\\mathrm{phase}}$：\n$$\n2\\sin\\left(\\frac{\\Omega_{\\mathrm{p}}}{4P}\\right) \\le \\delta_{\\mathrm{phase}}\n$$\n对于 $x \\ge 0$，使用不等式 $\\sin(x) \\le x$，我们推导出一个更易于求解的充分条件：\n$$\n2\\left(\\frac{\\Omega_{\\mathrm{p}}}{4P}\\right) \\le \\delta_{\\mathrm{phase}} \\implies \\frac{\\Omega_{\\mathrm{p}}}{2P} \\le \\delta_{\\mathrm{phase}}\n$$\n由此，我们得到 $P$ 的一个下界：\n$$\nP \\ge \\frac{\\Omega_{\\mathrm{p}}}{2 \\cdot \\delta_{\\mathrm{phase}}}\n$$\n问题要求选择满足此界限且 $P \\ge 1$ 的最小整数。因此，我们计算这个下界的上限，并确保它至少为 $1$。\n\n**4. 总内存 $M$**\n\n总内存是系数表和输入信号状态缓冲区（延迟线）的内存之和。\n- 系数表为 $P$ 个分数相位中的每一个存储 $N$ 个系数。每个系数 $B_{\\mathrm{c}}=4$ 字节，这部分内存为 $P \\cdot N \\cdot B_{\\mathrm{c}}$ 字节。\n- 输入状态缓冲区必须保存 $N$ 个输入样本的历史记录才能计算一个输出样本。每个样本 $B_{\\mathrm{s}}=4$ 字节，这部分内存为 $N \\cdot B_{\\mathrm{s}}$ 字节。\n\n因此，总内存（以字节为单位）为：\n$$\nM = P \\cdot N \\cdot B_{\\mathrm{c}} + N \\cdot B_{\\mathrm{s}} = (P \\cdot B_{\\mathrm{c}} + B_{\\mathrm{s}}) \\cdot N\n$$\n这为每个有效的测试用例提供了最终的整数结果。如果在任何阶段发现一个用例不可行，其结果为 $-1$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Designs an asynchronous SRC stage and calculates the required memory.\n\n    The function implements the logic derived from first principles of multirate\n    signal processing and FIR filter design to determine the minimum filter length N\n    and polyphase table size P, and from them, the total memory M.\n    \"\"\"\n\n    # Test cases: (f_i, f_o, tw, delta_p, delta_max)\n    # f_i, f_o: input/output sampling rates in Hz\n    # tw: transition width as a fraction of pi\n    # delta_p: passband ripple (dimensionless)\n    # delta_max: total passband magnitude error budget (dimensionless)\n    test_cases = [\n        (48000, 44100, 0.05, 0.001, 0.002),\n        (44100, 96000, 0.10, 0.0005, 0.0012),\n        (48000, 48000, 0.02, 0.0001, 0.0001),\n        (192000, 8000, 0.01, 0.002, 0.005),\n        (22050, 11025, 0.60, 0.001, 0.002),\n    ]\n\n    results = []\n    \n    # Storage size in bytes for 32-bit floats\n    B_c = 4  # Bytes per coefficient\n    B_s = 4  # Bytes per state-sample\n\n    for case in test_cases:\n        f_i, f_o, tw, delta_p, delta_max = case\n\n        # Step 1: Determine stopband and passband edges\n        r = f_o / f_i\n        delta_omega = np.pi * tw\n        Omega_s = np.pi * min(1, r)\n\n        # Infeasibility Check 1: Non-positive passband width\n        if delta_omega >= Omega_s:\n            results.append(-1)\n            continue\n            \n        Omega_p = Omega_s - delta_omega\n\n        # Step 3 (part 1): Determine phase quantization error budget\n        delta_phase = delta_max - delta_p\n        \n        # Infeasibility Check 2: Non-positive error budget for phase quantization\n        if delta_phase <= 0:\n            results.append(-1)\n            continue\n\n        # Step 2: Determine FIR filter length N using Kaiser window formula\n        # Stopband attenuation in dB\n        A = -20 * np.log10(delta_p)\n        \n        # Kaiser window empirical formula for filter length N\n        # N >= (A - 8) / (2.285 * delta_omega) + 1\n        # The formula applies for A > 8. All test cases satisfy this.\n        n_float = (A - 8) / (2.285 * delta_omega) + 1\n        \n        # N must be the smallest odd integer satisfying the bound\n        N = int(np.ceil(n_float))\n        if N % 2 == 0:\n            N += 1\n\n        # Step 3 (part 2): Determine polyphase table size P\n        # Lower bound for P from passband magnitude error constraint\n        # P >= Omega_p / (2 * delta_phase)\n        p_float = Omega_p / (2 * delta_phase)\n        \n        # P must be the smallest integer >= 1 satisfying the bound\n        P = int(np.ceil(p_float))\n        if P < 1:\n            P = 1\n\n        # Step 4: Compute total memory M\n        M = P * N * B_c + N * B_s\n        results.append(int(M))\n\n    # Print the final results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"}]}