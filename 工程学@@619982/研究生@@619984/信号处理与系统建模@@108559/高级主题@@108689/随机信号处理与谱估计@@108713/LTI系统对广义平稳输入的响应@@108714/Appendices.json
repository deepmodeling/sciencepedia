{"hands_on_practices": [{"introduction": "本练习将引导你从第一性原理出发，进行一项基础性的推导。你将证明线性时不变系统的频率响应 $H(\\omega)$ 如何塑造白噪声输入的功率谱密度，从而得出关键关系 $S_y(\\omega) = \\sigma_w^2 |H(\\omega)|^2$。完成此练习将巩固你对这一核心原理的理解，并演示如何通过对所得频谱进行积分来计算总输出功率。[@problem_id:2901260]", "problem": "考虑一个连续时间线性时不变系统，其冲激响应为 $h(t)$，频率响应为 $H(\\omega)$，由傅里叶变换约定定义：\n$$\nH(\\omega) \\triangleq \\int_{-\\infty}^{\\infty} h(t)\\,\\exp(-j\\omega t)\\,dt,\\quad\nh(t) \\triangleq \\frac{1}{2\\pi}\\int_{-\\infty}^{\\infty} H(\\omega)\\,\\exp(j\\omega t)\\,d\\omega.\n$$\n设该系统严格稳定且为真系统，其\n$$\nH(\\omega)=\\frac{1}{\\bigl(1+j\\,\\omega/\\omega_{1}\\bigr)\\bigl(1+j\\,\\omega/\\omega_{2}\\bigr)},\n$$\n其中 $\\omega_{1}>0$ 和 $\\omega_{2}>0$ 是不同的实数常数。输入 $w(t)$ 是一个零均值广义平稳过程，其功率谱密度对于所有实数 $\\omega$ 均为常数 $S_{w}(\\omega)=\\sigma_{w}^{2}$，其中 $\\sigma_{w}^{2}>0$。输出为 $y(t)=(h*w)(t)$。\n\n仅使用自相关 $R_{x}(\\tau)\\triangleq \\mathbb{E}\\{x(t)\\,x(t+\\tau)\\}$、功率谱密度 $S_{x}(\\omega)\\triangleq \\int_{-\\infty}^{\\infty} R_{x}(\\tau)\\,\\exp(-j\\omega\\tau)\\,d\\tau$ 的定义、上述傅里叶变换约定以及线性时不变性，完成以下任务：\n\n- 从第一性原理出发，推导用 $H(\\omega)$ 和 $\\sigma_{w}^{2}$ 表示的 $S_{y}(\\omega)$ 的表达式，不引用已有的滤波定理。\n- 然后，通过对 $\\lvert H(\\omega)\\rvert^{2}$ 进行直接积分来计算\n$$\n\\sigma_{y}^{2}=\\frac{1}{2\\pi}\\int_{-\\infty}^{\\infty} S_{y}(\\omega)\\,d\\omega\n$$\n从而精确计算输出方差 $\\sigma_{y}^{2}\\triangleq R_{y}(0)$。将最终答案表示为用 $\\sigma_{w}^{2}$、$\\omega_{1}$ 和 $\\omega_{2}$ 表示的闭式解析表达式。", "solution": "解答按要求分为两部分进行。\n\n第1部分：输出功率谱密度 $S_{y}(\\omega)$ 的推导。\n\nLTI系统的输出 $y(t)$ 是冲激响应 $h(t)$ 和输入信号 $w(t)$ 的卷积：\n$$\ny(t) = (h*w)(t) = \\int_{-\\infty}^{\\infty} h(\\alpha)\\,w(t-\\alpha)\\,d\\alpha\n$$\n输出过程 $y(t)$ 的自相关定义为 $R_{y}(\\tau) \\triangleq \\mathbb{E}\\{y(t)\\,y(t+\\tau)\\}$。我们将卷积积分代入 $y(t)$ 和 $y(t+\\tau)$：\n$$\ny(t+\\tau) = \\int_{-\\infty}^{\\infty} h(\\beta)\\,w(t+\\tau-\\beta)\\,d\\beta\n$$\n那么，自相关为：\n$$\nR_{y}(\\tau) = \\mathbb{E}\\left\\{ \\left( \\int_{-\\infty}^{\\infty} h(\\alpha)\\,w(t-\\alpha)\\,d\\alpha \\right) \\left( \\int_{-\\infty}^{\\infty} h(\\beta)\\,w(t+\\tau-\\beta)\\,d\\beta \\right) \\right\\}\n$$\n假设冲激响应 $h(t)$ 是确定性的，我们可以将期望算子移到积分内部：\n$$\nR_{y}(\\tau) = \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} h(\\alpha)\\,h(\\beta)\\,\\mathbb{E}\\{w(t-\\alpha)\\,w(t+\\tau-\\beta)\\}\\,d\\alpha\\,d\\beta\n$$\n期望项是输入过程 $w(t)$ 的自相关，该过程是广义平稳的。因此，其自相关仅取决于时间差 $(t+\\tau-\\beta) - (t-\\alpha) = \\tau - \\beta + \\alpha$。\n$$\n\\mathbb{E}\\{w(t-\\alpha)\\,w(t+\\tau-\\beta)\\} = R_{w}(\\tau - \\beta + \\alpha)\n$$\n将此代入 $R_{y}(\\tau)$ 的表达式中：\n$$\nR_{y}(\\tau) = \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} h(\\alpha)\\,h(\\beta)\\,R_{w}(\\tau - \\beta + \\alpha)\\,d\\alpha\\,d\\beta\n$$\n输出功率谱密度 $S_{y}(\\omega)$ 是 $R_{y}(\\tau)$ 的傅里叶变换：\n$$\nS_{y}(\\omega) = \\int_{-\\infty}^{\\infty} R_{y}(\\tau)\\,\\exp(-j\\omega\\tau)\\,d\\tau = \\int_{-\\infty}^{\\infty} \\left( \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} h(\\alpha)\\,h(\\beta)\\,R_{w}(\\tau - \\beta + \\alpha)\\,d\\alpha\\,d\\beta \\right) \\exp(-j\\omega\\tau)\\,d\\tau\n$$\n我们交换积分顺序：\n$$\nS_{y}(\\omega) = \\int_{-\\infty}^{\\infty} h(\\alpha) \\int_{-\\infty}^{\\infty} h(\\beta) \\left( \\int_{-\\infty}^{\\infty} R_{w}(\\tau - \\beta + \\alpha)\\,\\exp(-j\\omega\\tau)\\,d\\tau \\right) d\\beta\\,d\\alpha\n$$\n让我们分析最内层积分。我们进行变量替换 $u = \\tau - \\beta + \\alpha$，这意味着 $\\tau = u + \\beta - \\alpha$。\n$$\n\\int_{-\\infty}^{\\infty} R_{w}(u)\\,\\exp(-j\\omega(u+\\beta-\\alpha))\\,du = \\exp(j\\omega\\alpha)\\,\\exp(-j\\omega\\beta) \\int_{-\\infty}^{\\infty} R_{w}(u)\\,\\exp(-j\\omega u)\\,du\n$$\n右边的积分是输入功率谱密度 $S_{w}(\\omega)$ 的定义。因此，该表达式变为 $\\exp(j\\omega\\alpha)\\,\\exp(-j\\omega\\beta)\\,S_{w}(\\omega)$。\n将此代回 $S_{y}(\\omega)$ 的表达式：\n$$\nS_{y}(\\omega) = \\int_{-\\infty}^{\\infty} h(\\alpha) \\int_{-\\infty}^{\\infty} h(\\beta) \\, \\exp(j\\omega\\alpha)\\,\\exp(-j\\omega\\beta)\\,S_{w}(\\omega) \\,d\\beta\\,d\\alpha\n$$\n我们可以将与积分变量无关的项提取出来：\n$$\nS_{y}(\\omega) = S_{w}(\\omega) \\left( \\int_{-\\infty}^{\\infty} h(\\alpha)\\,\\exp(j\\omega\\alpha)\\,d\\alpha \\right) \\left( \\int_{-\\infty}^{\\infty} h(\\beta)\\,\\exp(-j\\omega\\beta)\\,d\\beta \\right)\n$$\n第二个积分是频率响应 $H(\\omega)$ 的定义。第一个积分是 $\\int_{-\\infty}^{\\infty} h(\\alpha)\\,\\exp(-j(-\\omega)\\alpha)\\,d\\alpha = H(-\\omega)$。\n因此，我们得到一般关系：\n$$\nS_{y}(\\omega) = S_{w}(\\omega)\\,H(-\\omega)\\,H(\\omega)\n$$\n对于一个物理系统，其冲激响应 $h(t)$ 是实值的。对于实函数，其傅里叶变换具有共轭对称性，即 $H(-\\omega) = H^{*}(\\omega)$，其中星号表示复共轭。因此，$H(-\\omega)H(\\omega) = H^{*}(\\omega)H(\\omega) = |H(\\omega)|^{2}$。\n输入被给定为白噪声，其 $S_{w}(\\omega) = \\sigma_{w}^{2}$。输出的功率谱密度为：\n$$\nS_{y}(\\omega) = \\sigma_{w}^{2}\\,|H(\\omega)|^{2}\n$$\n这完成了问题的第一部分。\n\n第2部分：输出方差 $\\sigma_{y}^{2}$ 的计算。\n\n输出方差由 $\\sigma_{y}^{2} = R_{y}(0)$ 给出。利用自相关函数的傅里叶逆变换关系 $R_{y}(\\tau) = \\frac{1}{2\\pi}\\int_{-\\infty}^{\\infty} S_{y}(\\omega)\\,\\exp(j\\omega\\tau)\\,d\\omega$，我们令 $\\tau=0$：\n$$\n\\sigma_{y}^{2} = R_{y}(0) = \\frac{1}{2\\pi}\\int_{-\\infty}^{\\infty} S_{y}(\\omega)\\,d\\omega\n$$\n代入推导出的 $S_{y}(\\omega)$ 表达式：\n$$\n\\sigma_{y}^{2} = \\frac{1}{2\\pi}\\int_{-\\infty}^{\\infty} \\sigma_{w}^{2}\\,|H(\\omega)|^{2}\\,d\\omega = \\frac{\\sigma_{w}^{2}}{2\\pi}\\int_{-\\infty}^{\\infty} |H(\\omega)|^{2}\\,d\\omega\n$$\n我们现在必须从给定的 $H(\\omega)$ 计算 $|H(\\omega)|^{2}$：\n$$\nH(\\omega) = \\frac{1}{\\bigl(1+j\\,\\omega/\\omega_{1}\\bigr)\\bigl(1+j\\,\\omega/\\omega_{2}\\bigr)}\n$$\n$$\n|H(\\omega)|^{2} = H(\\omega)H^{*}(\\omega) = \\frac{1}{\\bigl(1+j\\,\\omega/\\omega_{1}\\bigr)\\bigl(1+j\\,\\omega/\\omega_{2}\\bigr)} \\cdot \\frac{1}{\\bigl(1-j\\,\\omega/\\omega_{1}\\bigr)\\bigl(1-j\\,\\omega/\\omega_{2}\\bigr)}\n$$\n$$\n|H(\\omega)|^{2} = \\frac{1}{\\left(1 + \\frac{\\omega^{2}}{\\omega_{1}^{2}}\\right)\\left(1 + \\frac{\\omega^{2}}{\\omega_{2}^{2}}\\right)} = \\frac{\\omega_{1}^{2}\\omega_{2}^{2}}{(\\omega_{1}^{2}+\\omega^{2})(\\omega_{2}^{2}+\\omega^{2})}\n$$\n需要计算的积分是 $I = \\int_{-\\infty}^{\\infty} \\frac{\\omega_{1}^{2}\\omega_{2}^{2}}{(\\omega_{1}^{2}+\\omega^{2})(\\omega_{2}^{2}+\\omega^{2})}\\,d\\omega$。我们对被积函数关于变量 $\\omega^2$ 进行部分分式分解。设被积函数为 $f(\\omega)$。\n$$\nf(\\omega) = \\frac{\\omega_{1}^{2}\\omega_{2}^{2}}{(\\omega_{1}^{2}+\\omega^{2})(\\omega_{2}^{2}+\\omega^{2})} = \\frac{A}{\\omega_{1}^{2}+\\omega^{2}} + \\frac{B}{\\omega_{2}^{2}+\\omega^{2}}\n$$\n乘以公分母得到：\n$$\n\\omega_{1}^{2}\\omega_{2}^{2} = A(\\omega_{2}^{2}+\\omega^{2}) + B(\\omega_{1}^{2}+\\omega^{2}) = (A+B)\\omega^{2} + (A\\omega_{2}^{2}+B\\omega_{1}^{2})\n$$\n通过比较 $\\omega^{2}$ 幂次的系数，我们得到一个线性方程组：\n1. $A+B = 0 \\implies B = -A$\n2. $A\\omega_{2}^{2}+B\\omega_{1}^{2} = \\omega_{1}^{2}\\omega_{2}^{2}$\n将 $B=-A$ 代入第二个方程：\n$A\\omega_{2}^{2}-A\\omega_{1}^{2} = \\omega_{1}^{2}\\omega_{2}^{2} \\implies A(\\omega_{2}^{2}-\\omega_{1}^{2}) = \\omega_{1}^{2}\\omega_{2}^{2}$。\n由于 $\\omega_{1}$ 和 $\\omega_{2}$ 是不同的，所以 $\\omega_{1}^{2} \\neq \\omega_{2}^{2}$。\n$$\nA = \\frac{\\omega_{1}^{2}\\omega_{2}^{2}}{\\omega_{2}^{2}-\\omega_{1}^{2}} \\quad \\text{和} \\quad B = -A = \\frac{\\omega_{1}^{2}\\omega_{2}^{2}}{\\omega_{1}^{2}-\\omega_{2}^{2}}\n$$\n积分 $I$ 现在是：\n$$\nI = \\int_{-\\infty}^{\\infty} \\left( \\frac{\\omega_{1}^{2}\\omega_{2}^{2}}{\\omega_{2}^{2}-\\omega_{1}^{2}} \\frac{1}{\\omega_{1}^{2}+\\omega^{2}} + \\frac{\\omega_{1}^{2}\\omega_{2}^{2}}{\\omega_{1}^{2}-\\omega_{2}^{2}} \\frac{1}{\\omega_{2}^{2}+\\omega^{2}} \\right) d\\omega\n$$\n我们使用标准积分公式 $\\int_{-\\infty}^{\\infty} \\frac{dx}{a^{2}+x^{2}} = \\left[\\frac{1}{a}\\arctan\\left(\\frac{x}{a}\\right)\\right]_{-\\infty}^{\\infty} = \\frac{1}{a}(\\frac{\\pi}{2} - (-\\frac{\\pi}{2})) = \\frac{\\pi}{a}$，对于 $a>0$。\n此处，$\\omega_{1}>0$ 且 $\\omega_{2}>0$。\n$$\nI = \\frac{\\omega_{1}^{2}\\omega_{2}^{2}}{\\omega_{2}^{2}-\\omega_{1}^{2}} \\left( \\frac{\\pi}{\\omega_{1}} \\right) + \\frac{\\omega_{1}^{2}\\omega_{2}^{2}}{\\omega_{1}^{2}-\\omega_{2}^{2}} \\left( \\frac{\\pi}{\\omega_{2}} \\right)\n$$\n$$\nI = \\frac{\\pi\\omega_{1}^{2}\\omega_{2}^{2}}{\\omega_{1}^{2}-\\omega_{2}^{2}} \\left( \\frac{1}{\\omega_{2}} - \\frac{1}{\\omega_{1}} \\right) = \\frac{\\pi\\omega_{1}^{2}\\omega_{2}^{2}}{(\\omega_{1}-\\omega_{2})(\\omega_{1}+\\omega_{2})} \\left( \\frac{\\omega_{1}-\\omega_{2}}{\\omega_{1}\\omega_{2}} \\right)\n$$\n消去公因子 $(\\omega_{1}-\\omega_{2})$ 和 $\\omega_{1}\\omega_{2}$：\n$$\nI = \\frac{\\pi\\omega_{1}\\omega_{2}}{\\omega_{1}+\\omega_{2}}\n$$\n最后，我们将此结果代入输出方差 $\\sigma_{y}^{2}$ 的表达式中：\n$$\n\\sigma_{y}^{2} = \\frac{\\sigma_{w}^{2}}{2\\pi} I = \\frac{\\sigma_{w}^{2}}{2\\pi} \\left( \\frac{\\pi\\omega_{1}\\omega_{2}}{\\omega_{1}+\\omega_{2}} \\right)\n$$\n这简化为最终的闭式表达式：\n$$\n\\sigma_{y}^{2} = \\frac{\\sigma_{w}^{2}\\omega_{1}\\omega_{2}}{2(\\omega_{1}+\\omega_{2})}\n$$\n该表达式即为所求的精确输出方差。", "answer": "$$\n\\boxed{\\frac{\\sigma_{w}^{2}\\omega_{1}\\omega_{2}}{2(\\omega_{1}+\\omega_{2})}}\n$$", "id": "2901260"}, {"introduction": "在上一练习分析的基础上，本练习将过渡到系统综合的实践任务。你将设计一个LTI滤波器，将给定的输入功率谱转换为一个期望的输出功率谱，这一过程称为谱整形。本练习将介绍强大的谱分解方法，并阐明确保所得滤波器具有因果性、稳定性和最小相位特性的极端重要性，以及这种滤波器存在的条件。[@problem_id:2901273]", "problem": "考虑一个连续时间宽平稳 (WSS) 随机过程 $x(t)$，其双边功率谱密度 $S_{x}(\\omega)$ 由下式给出\n$$\nS_{x}(\\omega) \\;=\\; \\frac{N_{0}\\,\\omega^{2}}{\\left(\\omega^{2}+1\\right)\\left(\\omega^{2}+9\\right)},\n$$\n其中 $N_{0}>0$ 是一个常数。该信号通过一个频率响应为 $H(\\omega)$ 的实、线性时不变 (LTI)、因果、稳定滤波器，产生输出 $y(t)$。设计目标是使输出为宽平稳过程，其双边功率谱密度为\n$$\nS_{y}(\\omega) \\;=\\; \\frac{N_{0}\\,\\omega^{2}}{\\left(\\omega^{2}+4\\right)\\left(\\omega^{2}+16\\right)}.\n$$\n\n从自相关和维纳-辛钦定理（该定理指出功率谱密度是自相关函数的傅里叶变换）的定义出发，推导连接LTI系统输入和输出功率谱密度的关系，并利用该关系设计一个实有理、因果、稳定、最小相位的 $H(\\omega)$，以在输入为具有上述 $S_{x}(\\omega)$ 的 $x(t)$ 时，实现所述的 $S_{y}(\\omega)$。请明确给出 $H(\\omega)$。\n\n然后，假设期望的输出功率谱密度变为\n$$\n\\widetilde{S}_{y}(\\omega) \\;=\\; \\frac{N_{0}}{\\left(\\omega^{2}+4\\right)\\left(\\omega^{2}+16\\right)}.\n$$\n请使用基本原理讨论，是否存在任何具有有界频率响应幅值的LTI滤波器，能够从相同的输入 $S_{x}(\\omega)$ 实现 $\\widetilde{S}_{y}(\\omega)$，并阐明一个涉及 $S_{x}(\\omega)$ 和 $\\widetilde{S}_{y}(\\omega)$ 零点的必要可行性条件。你的最终答案必须是对应于原始目标 $S_{y}(\\omega)$ 所设计的 $H(\\omega)$ 的单一闭式表达式。不需要四舍五入，最终答案中也不应包含物理单位。", "solution": "分析按问题陈述的要求分三部分进行。首先，我们建立LTI系统输入和输出功率谱密度之间的基本关系。其次，我们利用此关系设计指定的滤波器 $H(\\omega)$。第三，我们分析实现替代输出PSD $\\widetilde{S}_{y}(\\omega)$ 的可行性。\n\n对于输入 $x(t)$，一个冲激响应为 $h(t)$ 的LTI系统的输出 $y(t)$ 由卷积积分给出：\n$$y(t) = \\int_{-\\infty}^{\\infty} h(\\alpha) x(t-\\alpha) \\,d\\alpha$$\n输出过程的自相关函数 $R_{y}(\\tau)$ 定义为 $R_{y}(\\tau) = E[y(t+\\tau)y^{*}(t)]$。由于滤波器是实的，冲激响应 $h(t)$ 也是实的，因此不需要复共轭。\n$$R_{y}(\\tau) = E\\left[ \\left( \\int_{-\\infty}^{\\infty} h(\\alpha) x(t+\\tau-\\alpha) \\,d\\alpha \\right) \\left( \\int_{-\\infty}^{\\infty} h(\\beta) x(t-\\beta) \\,d\\beta \\right) \\right]$$\n假设随机积分适当地收敛，我们可以交换期望和积分的顺序：\n$$R_{y}(\\tau) = \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} h(\\alpha) h(\\beta) E[x(t+\\tau-\\alpha)x(t-\\beta)] \\,d\\alpha \\,d\\beta$$\n期望项是输入过程的自相关 $R_{x}(\\tau - \\alpha + \\beta)$，因为 $x(t)$ 是宽平稳的。\n$$R_{y}(\\tau) = \\int_{-\\infty}^{\\infty} h(\\beta) \\left( \\int_{-\\infty}^{\\infty} h(\\alpha) R_{x}((\\tau+\\beta)-\\alpha) \\,d\\alpha \\right) \\,d\\beta$$\n内部积分是 $h(\\tau)$ 和 $R_{x}(\\tau)$ 的卷积，在 $\\tau+\\beta$ 处求值。设 $g(\\tau) = (h * R_{x})(\\tau) = \\int_{-\\infty}^{\\infty} h(\\alpha) R_{x}(\\tau-\\alpha) \\,d\\alpha$。那么：\n$$R_{y}(\\tau) = \\int_{-\\infty}^{\\infty} h(\\beta) g(\\tau+\\beta) \\,d\\beta$$\n这是 $g(\\tau)$ 与 $h(-\\tau)$ 的卷积。因此，$R_{y}(\\tau) = (h(-\\tau) * g(\\tau)) = (h(-\\tau) * (h(\\tau) * R_{x}(\\tau)))$。利用卷积的结合律，我们得到：\n$$R_{y}(\\tau) = (h(\\tau) * h(-\\tau)) * R_{x}(\\tau)$$\n维纳-辛钦定理指出，功率谱密度是自相关函数的傅里叶变换。对上式取傅里叶变换并使用卷积定理，我们得到：\n$$S_{y}(\\omega) = \\mathcal{F}\\{h(\\tau) * h(-\\tau)\\} \\cdot \\mathcal{F}\\{R_{x}(\\tau)\\}$$\n$R_{x}(\\tau)$ 的傅里叶变换是 $S_{x}(\\omega)$。$h(\\tau)$ 的傅里叶变换是 $H(\\omega)$。$h(-\\tau)$ 的傅里叶变换是 $H(-\\omega)$。对于实冲激响应 $h(t)$，频率响应具有共轭对称性，即 $H(-\\omega) = H^{*}(\\omega)$。因此：\n$$\\mathcal{F}\\{h(\\tau) * h(-\\tau)\\} = H(\\omega) H(-\\omega) = H(\\omega) H^{*}(\\omega) = |H(\\omega)|^{2}$$\n这就建立了所需的关系：\n$$S_{y}(\\omega) = |H(\\omega)|^{2} S_{x}(\\omega)$$\n由此，我们可以确定滤波器频率响应的幅值平方：\n$$|H(\\omega)|^{2} = \\frac{S_{y}(\\omega)}{S_{x}(\\omega)}$$\n代入给定的 $S_{x}(\\omega)$ 和 $S_{y}(\\omega)$ 表达式：\n$$|H(\\omega)|^{2} = \\frac{\\frac{N_{0}\\,\\omega^{2}}{\\left(\\omega^{2}+4\\right)\\left(\\omega^{2}+16\\right)}}{\\frac{N_{0}\\,\\omega^{2}}{\\left(\\omega^{2}+1\\right)\\left(\\omega^{2}+9\\right)}} = \\frac{\\left(\\omega^{2}+1\\right)\\left(\\omega^{2}+9\\right)}{\\left(\\omega^{2}+4\\right)\\left(\\omega^{2}+16\\right)}$$\n注意因子 $N_{0}\\omega^2$ 被消去，这在 $\\omega \\neq 0$ 时成立。在 $\\omega=0$ 处的值可以通过取极限得到，其值为有限。\n\n为求得 $H(\\omega)$，我们进行谱分解。我们通过替换 $s = j\\omega$（因此 $\\omega^2 = -s^2$）将频率响应 $H(\\omega)$ 与传递函数 $H(s)$ 联系起来。幅值平方响应由 $H(s)H(-s)$ 给出。\n$$H(s)H(-s) = \\frac{\\left(-s^{2}+1\\right)\\left(-s^{2}+9\\right)}{\\left(-s^{2}+4\\right)\\left(-s^{2}+16\\right)} = \\frac{\\left(s^{2}-1\\right)\\left(s^{2}-9\\right)}{\\left(s^{2}-4\\right)\\left(s^{2}-16\\right)}$$\n$$H(s)H(-s) = \\frac{(s-1)(s+1)(s-3)(s+3)}{(s-2)(s+2)(s-4)(s+4)}$$\n$H(s)H(-s)$ 的极点和零点关于 $j\\omega$ 轴对称分布。\n-   极点位于 $s = \\pm 2, \\pm 4$。\n-   零点位于 $s = \\pm 1, \\pm 3$。\n\n滤波器必须是因果和稳定的，这要求其所有极点都位于s平面的严格左半平面 (LHP)。因此，$H(s)$ 的极点必须在 $s = -2$ 和 $s = -4$。\n滤波器还必须是最小相位的，这要求其所有零点都位于LHP。因此，$H(s)$ 的零点必须在 $s = -1$ 和 $s = -3$。\n通过组合这些LHP中的极点和零点，我们构造出传递函数 $H(s)$：\n$$H(s) = K \\frac{(s+1)(s+3)}{(s+2)(s+4)}$$\n其中 $K$ 是一个常数。乘积 $H(s)H(-s)$ 变为 $K^2 \\frac{(s+1)(s-1)(s+3)(s-3)}{(s+2)(s-2)(s+4)(s-4)}$，如果 $K^2 = 1$，这与推导出的表达式相匹配。我们选择 $K=1$ 以获得正的直流增益（$H(0) = 3/8 > 0$）。\n$$H(s) = \\frac{(s+1)(s+3)}{(s+2)(s+4)}$$\n频率响应 $H(\\omega)$ 通过代入 $s = j\\omega$ 获得：\n$$H(\\omega) = \\frac{(j\\omega+1)(j\\omega+3)}{(j\\omega+2)(j\\omega+4)}$$\n这就是所要求的实有理、因果、稳定和最小相位滤波器的明确表达式。\n\n最后，我们考虑实现替代输出PSD的可行性：\n$$\\widetilde{S}_{y}(\\omega) = \\frac{N_{0}}{\\left(\\omega^{2}+4\\right)\\left(\\omega^{2}+16\\right)}$$\n所要求的幅值平方响应将是：\n$$|H(\\omega)|^{2} = \\frac{\\widetilde{S}_{y}(\\omega)}{S_{x}(\\omega)} = \\frac{\\frac{N_{0}}{\\left(\\omega^{2}+4\\right)\\left(\\omega^{2}+16\\right)}}{\\frac{N_{0}\\,\\omega^{2}}{\\left(\\omega^{2}+1\\right)\\left(\\omega^{2}+9\\right)}} = \\frac{\\left(\\omega^{2}+1\\right)\\left(\\omega^{2}+9\\right)}{\\omega^{2}\\left(\\omega^{2}+4\\right)\\left(\\omega^{2}+16\\right)}$$\n我们研究 $|H(\\omega)|^{2}$ 在 $\\omega \\to 0$ 时的行为：\n$$\\lim_{\\omega \\to 0} |H(\\omega)|^{2} = \\lim_{\\omega \\to 0} \\frac{(1)(9)}{\\omega^{2}(4)(16)} = \\lim_{\\omega \\to 0} \\frac{9}{64\\omega^{2}} = \\infty$$\n由于当 $\\omega \\to 0$ 时 $|H(\\omega)|$ 无界，因此不存在具有有界频率响应幅值的LTI滤波器能够实现此转换。\n\n其基本原理可以表述为一个必要的可行性条件。关系 $S_{y}(\\omega) = |H(\\omega)|^{2} S_{x}(\\omega)$ 意味着，如果一个滤波器的频率响应是有界的，即对于所有 $\\omega$ 都有 $|H(\\omega)| \\leq M < \\infty$，那么在输入PSD为零的任何频率 $\\omega_0$ 处（$S_{x}(\\omega_0) = 0$），输出PSD也必须为零（$S_{y}(\\omega_0) = M^2 \\cdot 0 = 0$）。\n用形式化的术语来说，一个有界响应LTI滤波器能将输入PSD $S_x(\\omega)$ 转换为输出PSD $S_y(\\omega)$ 的一个必要条件是，$S_y(\\omega)$ 的零点集合必须是 $S_x(\\omega)$ 的零点集合的超集。\n在这个具体案例中，输入PSD $S_{x}(\\omega)$ 在 $\\omega=0$ 处有一个二阶零点，这由 $\\omega^2$ 项证明。然而，期望的替代输出PSD $\\widetilde{S}_{y}(\\omega)$ 在 $\\omega=0$ 处不为零：$\\widetilde{S}_{y}(0) = N_{0}/64 > 0$。滤波器将需要在输入不含有任何能量的频率上创造能量，这对于在该频率具有有限增益的LTI系统来说是不可能的。因此，这样的滤波器不存在。", "answer": "$$\n\\boxed{\\frac{(j\\omega+1)(j\\omega+3)}{(j\\omega+2)(j\\omega+4)}}\n$$", "id": "2901273"}, {"introduction": "最后的这个练习旨在弥合解析理论与计算实现之间的鸿沟，这是任何从业工程师或科学家都必须迈出的关键一步。你将实现一个算法，根据测量的输入和输出谱来估计系统的频率响应，并直面当输入谱中存在接近零的值时进行谱除法所带来的数值不稳定性问题。通过比较朴素方法与稳健的正则化估计器，你将获得设计能够应对真实世界数据不完美性的算法的实用见解。[@problem_id:2901279]", "problem": "给定一个场景，涉及一个线性时不变 (LTI) 系统对一个宽平稳 (WSS) 输入的响应。设输入过程为 $x(t)$，其功率谱密度 (PSD) 为 $S_{x}(\\omega)$；系统的冲激响应为 $h(t)$，其频率响应为 $H(\\omega)$；输出过程为 $y(t)$，其功率谱密度为 $S_{y}(\\omega)$。从第一性原理出发，利用自相关的定义以及自相关与功率谱密度之间的傅里叶变换关系，推导在 $S_{x}(\\omega)$ 严格为正的频率上，频率响应幅值 $|H(\\omega)|$ 关于 $S_{x}(\\omega)$ 和 $S_{y}(\\omega)$ 的表达式。然后，设计一个数值稳定的算法来估计 $|H(\\omega)|$，以应对当 $S_{x}(\\omega)$ 包含可能在谱除法过程中引起数值不稳定性的深陷波（非常小的值）的情况。\n\n您的程序必须实现以下任务：\n\n- 从自相关和线性时不变性的定义出发，通过基于第一性原理的路径，推导并论证一种从 $S_{x}(\\omega)$ 和 $S_{y}(\\omega)$ 估计 $|H(\\omega)|$ 的方法，不依赖任何未声明的假设。当 $S_{x}(\\omega)$ 具有深陷波时，提供清晰的稳定性论证。\n- 在一个公共角频率网格 $\\omega \\in [-\\Omega_{\\max}, \\Omega_{\\max}]$（包含 $N$ 个均匀间隔的采样点）上实现两种估计器：\n  - 一种基于直接谱除法的朴素估计器。\n  - 一种正则化估计器，通过在分母中添加一个稳定项来避免不稳定性，并可选择性地在频率上对结果进行平滑处理。\n- 使用以下合成案例测试套件。在每个案例中，构建 $S_{x}(\\omega)$ 和一个真实的非负幅值 $|H_{\\text{true}}(\\omega)|$；然后，以与 WSS 输入和 LTI 系统输出相关的基本定义相一致的方式生成 $S_{y}(\\omega)$。频率单位为弧度/秒；不需要其他物理单位，也不需要进行其他单位转换。角频率网格由 $N = 4096$ 和 $\\Omega_{\\max} = 50$ 定义。\n\n  设 $\\omega$ 表示在 $[-\\Omega_{\\max}, \\Omega_{\\max}]$ 区间内 $N$ 个等距采样的向量。\n\n  通用构建模块：\n  - 平滑输入谱基线：\n    $$S_{x,\\text{base}}(\\omega) = 1 + 0.5\\cos\\!\\left(\\frac{\\omega}{5}\\right) + 0.25\\,e^{-(\\omega/20)^2}.$$\n  - 二阶低通幅值：\n    $$|H_{\\text{LP}}(\\omega)| = \\frac{1}{\\sqrt{1 + (\\omega/10)^4}}.$$\n  - 高斯带通幅值：\n    $$|H_{\\text{BP}}(\\omega)| = \\exp\\!\\left(-\\frac{(|\\omega| - 15)^2}{2\\cdot 3^2}\\right).$$\n  - 深度为 $\\delta \\in (0,1)$、中心位于 $\\omega_n$、宽度为 $\\sigma_n$ 的高斯陷波乘子：\n    $$N(\\omega;\\omega_n,\\sigma_n,\\delta) = 1 - (1 - \\delta)\\exp\\!\\left(-\\frac{(\\omega - \\omega_n)^2}{2\\sigma_n^2}\\right).$$\n\n  测试案例：\n  - 案例 A（理想情况）：$S_{x}^{(A)}(\\omega) = S_{x,\\text{base}}(\\omega)$ 且 $|H_{\\text{true}}^{(A)}(\\omega)| = |H_{\\text{LP}}(\\omega)|$。相应地构建 $S_{y}^{(A)}(\\omega)$。\n  - 案例 B（深陷波）：$S_{x}^{(B)}(\\omega) = S_{x,\\text{base}}(\\omega)\\cdot N(\\omega; 10, 0.2, 10^{-10})$ 且 $|H_{\\text{true}}^{(B)}(\\omega)| = |H_{\\text{LP}}(\\omega)|$。相应地构建 $S_{y}^{(B)}(\\omega)$。\n  - 案例 C（含噪声的谱估计）：$S_{x}^{(C)}(\\omega) = S_{x,\\text{base}}(\\omega)$ 且 $|H_{\\text{true}}^{(C)}(\\omega)| = |H_{\\text{BP}}(\\omega)|$。相应地构建 $S_{y}^{(C)}(\\omega)$，然后添加一个人为的非负扰动，该扰动通过添加一个平滑的、非负的噪声基底来模拟有限样本谱估计的可变性，其总尺度如下文所述。\n  - 案例 D（某频率处为零）：$S_{x}^{(D)}(\\omega) = \\omega^2 \\exp\\!\\left(-(\\omega/30)^2\\right)$ 且 $|H_{\\text{true}}^{(D)}(\\omega)| = |H_{\\text{LP}}(\\omega)|$。相应地构建 $S_{y}^{(D)}(\\omega)$。\n\n- 为保证可比性需实现的估计器细节：\n  - 朴素估计器：对于任何具有谱 $(S_x(\\omega), S_y(\\omega))$ 的案例，定义在 $S_x(\\omega)$ 严格为正处的朴素估计，并忽略（不计入任何误差度量）$S_x(\\omega)$ 非正的频率样本。\n  - 正则化估计器：在分母中使用加性稳定项，其中\n    $$\\varepsilon = \\epsilon_{\\text{rel}}\\cdot \\operatorname{median}_{\\omega} \\left\\{ S_x(\\omega) \\right\\},$$\n    并使用分母为 $S_x(\\omega) + \\varepsilon$ 的谱除法进行估计。对各案例使用以下相对稳定值：\n    - 案例 B：$\\epsilon_{\\text{rel}} = 10^{-3}$。\n    - 案例 C：$\\epsilon_{\\text{rel}} = 5\\times 10^{-3}$，并对估计的幅值应用频域平滑，使用长度为奇数 $L = 41$ 个样本的中心移动平均。\n    - 案例 D：$\\epsilon_{\\text{rel}} = 10^{-2}$。\n  - 案例 B 和案例 D 不需要平滑。仅对案例 C，使用指定的移动平均长度 $L$ 对正则化估计进行平滑处理。\n\n- 案例 C 的噪声构建：\n  - 构建理想的 $S_{y}^{(C)}(\\omega)$ 后，添加非负扰动\n    $$\\nu(\\omega) = \\alpha\\cdot \\operatorname{median}_{\\omega}\\{S_{y}^{(C)}(\\omega)\\}\\cdot u(\\omega),$$\n    其中 $u(\\omega)$ 是通过对一个长度为 $N$ 的零均值、单位方差高斯序列取绝对值，然后与一个归一化为单位和的对称长度为 21 的移动平均核进行卷积得到的。使用 $\\alpha = 0.2$ 和一个固定的随机种子以确保可复现性。\n\n- 需要报告的误差度量：\n  - 令 $\\widehat{|H|}_{\\text{naive}}(\\omega)$ 表示朴素估计，$\\widehat{|H|}_{\\text{reg}}(\\omega)$ 表示正则化（如果适用，则平滑后）的估计。\n  - 对于任何具有真实幅值 $|H_{\\text{true}}(\\omega)|$ 的案例，在估计值有定义且为有限值的频率集合上计算均方根误差 (RMSE)：\n    $$\\operatorname{RMSE} = \\sqrt{\\frac{1}{M}\\sum_{k=1}^{M}\\left(\\widehat{|H|}(\\omega_k) - |H_{\\text{true}}(\\omega_k)|\\right)^2}.$$\n\n- 必需的输出：\n  - 按此顺序计算以下浮点值：\n    $$\n    \\begin{aligned}\n    r_1 &:= \\text{案例 A 中 } \\widehat{|H|}_{\\text{naive}} \\text{ 的 RMSE},\\\\\n    r_2 &:= \\text{案例 B 中 } \\widehat{|H|}_{\\text{naive}} \\text{ 的 RMSE},\\\\\n    r_3 &:= \\text{案例 B 中 } \\widehat{|H|}_{\\text{reg}} \\text{ 的 RMSE},\\\\\n    r_4 &:= \\text{案例 C 中 } \\widehat{|H|}_{\\text{reg}} \\text{ 的 RMSE},\\\\\n    r_5 &:= \\text{案例 D 中 } \\widehat{|H|}_{\\text{reg}} \\text{ 的 RMSE}。\n    \\end{aligned}\n    $$\n  - 您的程序应生成单行输出，包含以逗号分隔并用方括号括起来的结果（例如，$[r_1,r_2,r_3,r_4,r_5]$）。\n\n实现约束：\n\n- 使用 $N = 4096$，$\\Omega_{\\max} = 50$。\n- 频率单位为弧度/秒；所有输出均为无量纲。\n- 案例 C 中噪声的随机种子必须固定，以确保结果可复现。\n\n注意：程序必须是自包含的，不得读取输入，也不得访问外部文件或网络。它必须仅使用指定的语言和库。最终结果必须是按所要求的确切格式打印的数值浮点数。", "solution": "该问题要求推导线性时不变 (LTI) 系统频率响应幅值 $|H(\\omega)|$ 的估计器，并随后通过数值实现来比较朴素估计器和正则化估计器在不同条件下的表现。该问题提法明确且科学上合理，涉及信号处理中的一个基本概念。我们将从第一性原理开始推导，然后分析数值算法。\n\n首先，我们建立 LTI 系统输入和输出功率谱密度 (PSD) 之间的关系。对于输入信号 $x(t)$，具有冲激响应 $h(t)$ 的 LTI 系统的输出信号 $y(t)$ 由卷积积分给出：\n$$\ny(t) = (h * x)(t) = \\int_{-\\infty}^{\\infty} h(\\alpha) x(t-\\alpha) d\\alpha\n$$\n输入 $x(t)$ 是一个宽平稳 (WSS) 随机过程，其自相关函数为 $R_{xx}(\\tau) = E[x(t)x(t+\\tau)]$。输出过程 $y(t)$ 也将是宽平稳的。其自相关函数 $R_{yy}(\\tau)$ 定义为：\n$$\nR_{yy}(\\tau) = E[y(t)y(t+\\tau)]\n$$\n代入 $y(t)$ 和 $y(t+\\tau)$ 的卷积积分表达式：\n$$\nR_{yy}(\\tau) = E\\left[ \\left( \\int_{-\\infty}^{\\infty} h(\\alpha) x(t-\\alpha) d\\alpha \\right) \\left( \\int_{-\\infty}^{\\infty} h(\\beta) x(t+\\tau-\\beta) d\\beta \\right) \\right]\n$$\n根据期望算子的线性性质，我们可以将其移入积分内部：\n$$\nR_{yy}(\\tau) = \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} h(\\alpha) h(\\beta) E[x(t-\\alpha)x(t+\\tau-\\beta)] d\\alpha d\\beta\n$$\n期望项是 $x(t)$ 在时间延迟为 $(t+\\tau-\\beta) - (t-\\alpha) = \\tau - \\beta + \\alpha$ 时的自相关。因此，$E[x(t-\\alpha)x(t+\\tau-\\beta)] = R_{xx}(\\tau - \\beta + \\alpha)$。\n$$\nR_{yy}(\\tau) = \\int_{-\\infty}^{\\infty} h(\\beta) \\left( \\int_{-\\infty}^{\\infty} h(\\alpha) R_{xx}(\\tau + \\alpha - \\beta) d\\alpha \\right) d\\beta\n$$\n这个表达式表示一系列卷积。设 $g(t) = h(-t)$。内部积分等价于 $(h*R_{xx})(\\tau-\\beta)$。然后，外部积分是此结果与 $g(\\beta) = h(-\\beta)$ 的卷积。因此，我们可以用卷积运算来表示这种关系：\n$$\nR_{yy}(\\tau) = h(\\tau) * R_{xx}(\\tau) * h(-\\tau)\n$$\n为了找到 PSD 之间的关系，我们对等式两边应用傅里叶变换，记为 $\\mathcal{F}\\{\\cdot\\}$。功率谱密度定义为自相关函数的傅里叶变换，所以 $S_x(\\omega) = \\mathcal{F}\\{R_{xx}(\\tau)\\}$ 且 $S_y(\\omega) = \\mathcal{F}\\{R_{yy}(\\tau)\\}$。根据卷积定理（时域卷积对应于频域相乘），我们得到：\n$$\nS_y(\\omega) = \\mathcal{F}\\{h(\\tau)\\} \\cdot \\mathcal{F}\\{R_{xx}(\\tau)\\} \\cdot \\mathcal{F}\\{h(-\\tau)\\}\n$$\n冲激响应的傅里叶变换是频率响应，$H(\\omega) = \\mathcal{F}\\{h(\\tau)\\}$。傅里叶变换的时间反转性质指出 $\\mathcal{F}\\{h(-\\tau)\\} = H^*(\\omega)$，其中 $H^*(\\omega)$ 是 $H(\\omega)$ 的复共轭。代入这些关系，我们得到基本结果：\n$$\nS_y(\\omega) = H(\\omega) S_x(\\omega) H^*(\\omega) = |H(\\omega)|^2 S_x(\\omega)\n$$\n这就是用于 LTI 系统的维纳-辛钦定理。从此方程，我们可以推导出频率响应幅值 $|H(\\omega)|$ 的表达式。只要输入功率谱密度 $S_x(\\omega)$ 严格为正，我们就可以重新整理方程：\n$$\n|H(\\omega)|^2 = \\frac{S_y(\\omega)}{S_x(\\omega)}\n$$\n由于 $|H(\\omega)|$ 必须为非负量，且 PSD $S_x(\\omega)$ 和 $S_y(\\omega)$ 均为非负性质，我们可以对两边取平方根以获得所需的估计器：\n$$\n|H(\\omega)| = \\sqrt{\\frac{S_y(\\omega)}{S_x(\\omega)}}, \\quad \\text{对于 } S_x(\\omega) > 0\n$$\n这构成了“朴素”估计器。其有效性仅限于输入信号中存在功率的频率。\n\n此朴素估计器的数值不稳定性恰好出现在 $S_x(\\omega)$ 接近零的频率处或其附近。在任何实际场景中，测量或估计的 PSD 都受噪声和有限精度误差的影响。我们将测量的输出 PSD 建模为 $\\hat{S}_y(\\omega) = S_y(\\omega) + \\nu(\\omega)$，其中 $\\nu(\\omega)$ 是一个非负噪声项。朴素估计变为：\n$$\n\\widehat{|H|}(\\omega) = \\sqrt{\\frac{|H(\\omega)|^2 S_x(\\omega) + \\nu(\\omega)}{S_x(\\omega)}} = \\sqrt{|H(\\omega)|^2 + \\frac{\\nu(\\omega)}{S_x(\\omega)}}\n$$\n当 $S_x(\\omega) \\to 0$ 时，项 $\\nu(\\omega)/S_x(\\omega)$ 会发散，导致估计值 $\\widehat{|H|}(\\omega)$ 急剧增大。对于输入谱“深陷波”内的频率，这是灾难性的。\n\n为了缓解这个问题，我们引入了正则化估计器。其原理是通过添加一个小的正常数 $\\varepsilon$ 来防止分母达到零或非常小的值。$|H(\\omega)|^2$ 的正则化估计器为：\n$$\n\\widehat{|H|^2}_{\\text{reg}}(\\omega) = \\frac{S_y(\\omega)}{S_x(\\omega) + \\varepsilon}\n$$\n相应的幅值估计为 $\\widehat{|H|}_{\\text{reg}}(\\omega) = \\sqrt{\\widehat{|H|^2}_{\\text{reg}}(\\omega)}$。在存在噪声的情况下，这变为：\n$$\n\\widehat{|H|}_{\\text{reg}}(\\omega) = \\sqrt{\\frac{|H(\\omega)|^2 S_x(\\omega) + \\nu(\\omega)}{S_x(\\omega) + \\varepsilon}}\n$$\n现在，当 $S_x(\\omega) \\to 0$ 时，估计值接近于 $\\sqrt{\\nu(\\omega)/\\varepsilon}$，这是一个有限值。这种正则化引入了偏差，因为估计值系统性地小于真实值，尤其是在 $S_x(\\omega)$ 很小时。然而，它极大地减少了方差并避免了灾难性的失败，这是一个经典的偏差-方差权衡的例子。$\\varepsilon$ 的选择至关重要：如果太大，会引入过多的偏差；如果太小，则无法稳定除法。问题建议采用数据驱动的选择 $\\varepsilon = \\epsilon_{\\text{rel}} \\cdot \\operatorname{median}_{\\omega}\\{S_x(\\omega)\\}$，这将正则化强度与输入信号的总功率相匹配。\n\n对于谱估计中存在显著噪声的情况（如案例 C），正则化估计虽然稳定，但仍然会充满噪声。在频域应用低通滤波器（如移动平均）可以通过平滑由噪声引起的高频波动来进一步改善估计。如果真实的 $|H(\\omega)|$ 相对于噪声变化是平滑的，那么这样做是合理的。\n\n实现将按以下步骤进行：\n1.  定义从 $-\\Omega_{\\max}$ 到 $\\Omega_{\\max}$ 的频率网格 $\\omega$，包含 $N$ 个点。\n2.  对每个测试案例（A、B、C、D），使用提供的公式构建真实的 $|H_{\\text{true}}(\\omega)|$ 和输入谱 $S_x(\\omega)$。\n3.  计算理想的输出谱 $S_y(\\omega) = |H_{\\text{true}}(\\omega)|^2 S_x(\\omega)$。\n4.  对于案例 C，生成指定的非负噪声项 $\\nu(\\omega)$ 并将其加到 $S_y(\\omega)$ 上。\n5.  实现朴素估计器。仅在 $S_x(\\omega) > 0$ 的频率上计算其估计值 $\\widehat{|H|}_{\\text{naive}}(\\omega)$。在此有效域上计算与 $|H_{\\text{true}}(\\omega)|$ 的均方根误差 (RMSE)。\n6.  实现正则化估计器。根据指定的 $\\epsilon_{\\text{rel}}$ 和 $S_x(\\omega)$ 的中位数计算稳定项 $\\varepsilon$。在所有频率上计算估计值 $\\widehat{|H|}_{\\text{reg}}(\\omega)$。对于案例 C，额外应用一个长度为 $L=41$ 的移动平均滤波器。\n7.  在所有频率上计算正则化估计器与 $|H_{\\text{true}}(\\omega)|$ 的 RMSE。\n8.  最终输出将是一个包含五个特定 RMSE 值的列表，按要求为：$\\text{RMSE}_{\\text{naive,A}}$、$\\text{RMSE}_{\\text{naive,B}}$、$\\text{RMSE}_{\\text{reg,B}}$、$\\text{RMSE}_{\\text{reg,C}}$ 和 $\\text{RMSE}_{\\text{reg,D}}$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the LTI system identification problem by deriving and implementing\n    estimators for the magnitude of the frequency response.\n    \"\"\"\n    #\n    # === Problem Parameters ===\n    #\n    N = 4096\n    Omega_max = 50.0\n    # Fixed random seed for reproducibility of noise in Case C\n    RANDOM_SEED = 42\n\n    #\n    # === Frequency Grid ===\n    #\n    omega = np.linspace(-Omega_max, Omega_max, N)\n\n    #\n    # === Common Building Blocks ===\n    #\n    def S_x_base(w):\n        return 1.0 + 0.5 * np.cos(w / 5.0) + 0.25 * np.exp(-(w / 20.0)**2)\n\n    def H_LP(w):\n        return 1.0 / np.sqrt(1.0 + (w / 10.0)**4)\n\n    def H_BP(w):\n        return np.exp(-((np.abs(w) - 15.0)**2) / (2.0 * 3.0**2))\n\n    def notch_multiplier(w, w_n, sigma_n, delta):\n        return 1.0 - (1.0 - delta) * np.exp(-((w - w_n)**2) / (2.0 * sigma_n**2))\n\n    #\n    # === Error Metric ===\n    #\n    def calculate_rmse(h_est, h_true, mask):\n        \"\"\"\n        Calculates Root-Mean-Square Error on a masked subset of frequencies.\n        Args:\n            h_est: Estimated magnitude response.\n            h_true: True magnitude response.\n            mask: A boolean array indicating which frequency samples to include.\n        Returns:\n            The RMSE value.\n        \"\"\"\n        if not np.any(mask):\n            return np.nan # Avoid division by zero if mask is all False\n        \n        valid_est = h_est[mask]\n        valid_true = h_true[mask]\n        \n        # Filter out any non-finite values that might arise\n        finite_mask = np.isfinite(valid_est)  np.isfinite(valid_true)\n        if not np.any(finite_mask):\n            return np.nan\n        \n        return np.sqrt(np.mean((valid_est[finite_mask] - valid_true[finite_mask])**2))\n\n    #\n    # === Estimator Functions ===\n    #\n    def naive_estimator(Sx, Sy):\n        \"\"\"Calculates the naive estimate |H(w)| = sqrt(Sy(w) / Sx(w)).\"\"\"\n        mask = Sx > 0\n        h_hat = np.full_like(Sx, np.nan)\n        h_hat[mask] = np.sqrt(Sy[mask] / Sx[mask])\n        return h_hat, mask\n\n    def regularized_estimator(Sx, Sy, eps_rel, smooth_len=0):\n        \"\"\"Calculates the regularized estimate for |H(w)|.\"\"\"\n        epsilon = eps_rel * np.median(Sx)\n        h_hat_sq = Sy / (Sx + epsilon)\n        h_hat = np.sqrt(h_hat_sq)\n        \n        if smooth_len > 0:\n            if smooth_len % 2 == 0:\n                raise ValueError(\"Smoothing length must be odd.\")\n            kernel = np.ones(smooth_len) / smooth_len\n            h_hat = np.convolve(h_hat, kernel, mode='same')\n            \n        return h_hat\n\n    results = []\n\n    #\n    # === Case A: Happy Path ===\n    #\n    H_true_A = H_LP(omega)\n    Sx_A = S_x_base(omega)\n    Sy_A = H_true_A**2 * Sx_A\n    \n    H_naive_A, mask_A = naive_estimator(Sx_A, Sy_A)\n    r1 = calculate_rmse(H_naive_A, H_true_A, mask_A)\n    results.append(r1)\n\n    #\n    # === Case B: Deep Notch ===\n    #\n    H_true_B = H_LP(omega)\n    Sx_B = S_x_base(omega) * notch_multiplier(omega, w_n=10.0, sigma_n=0.2, delta=1e-10)\n    Sy_B = H_true_B**2 * Sx_B\n    \n    # Naive estimator\n    H_naive_B, mask_B = naive_estimator(Sx_B, Sy_B)\n    r2 = calculate_rmse(H_naive_B, H_true_B, mask_B)\n    results.append(r2)\n\n    # Regularized estimator\n    eps_rel_B = 1e-3\n    H_reg_B = regularized_estimator(Sx_B, Sy_B, eps_rel_B)\n    r3 = calculate_rmse(H_reg_B, H_true_B, np.ones_like(omega, dtype=bool))\n    results.append(r3)\n\n    #\n    # === Case C: Noisy Spectral Estimate ===\n    #\n    H_true_C = H_BP(omega)\n    Sx_C = S_x_base(omega)\n    Sy_ideal_C = H_true_C**2 * Sx_C\n\n    # Generate non-negative noise\n    alpha = 0.2\n    noise_smooth_len = 21\n    rng = np.random.default_rng(RANDOM_SEED)\n    \n    raw_noise = rng.standard_normal(N)\n    u_omega = np.abs(raw_noise)\n    \n    noise_kernel = np.ones(noise_smooth_len) / noise_smooth_len\n    smoothed_u = np.convolve(u_omega, noise_kernel, mode='same')\n    \n    median_Sy_C = np.median(Sy_ideal_C)\n    nu = alpha * median_Sy_C * smoothed_u\n    Sy_noisy_C = Sy_ideal_C + nu\n\n    # Regularized and smoothed estimator\n    eps_rel_C = 5e-3\n    smooth_len_C = 41\n    H_reg_C = regularized_estimator(Sx_C, Sy_noisy_C, eps_rel_C, smooth_len=smooth_len_C)\n    r4 = calculate_rmse(H_reg_C, H_true_C, np.ones_like(omega, dtype=bool))\n    results.append(r4)\n\n    #\n    # === Case D: Zero at a Frequency ===\n    #\n    H_true_D = H_LP(omega)\n    Sx_D = omega**2 * np.exp(-(omega/30.0)**2)\n    Sy_D = H_true_D**2 * Sx_D\n    \n    # Regularized estimator\n    eps_rel_D = 1e-2\n    H_reg_D = regularized_estimator(Sx_D, Sy_D, eps_rel_D)\n    r5 = calculate_rmse(H_reg_D, H_true_D, np.ones_like(omega, dtype=bool))\n    results.append(r5)\n\n    #\n    # === Final Output ===\n    #\n    print(f\"[{','.join(f'{r:.7g}' for r in results)}]\")\n\nsolve()\n```", "id": "2901279"}]}