{"hands_on_practices": [{"introduction": "局域密度近似（LDA）是密度泛函理论中历史最悠久、概念最基础的近似之一。它通过一个巧妙的类比，将非均匀电子系统在某一点的性质与具有相同密度的均匀电子气联系起来。通过这个练习[@problem_id:2813517]，你将从均匀电子气的基本物理出发，亲手推导并实现LDA交换能泛函，从而将抽象的理论转化为具体的数值计算。", "problem": "您需要实现一个程序，该程序针对给定的一组一维电子数密度分布，计算仅交换的局域密度近似（LDA）能量以及在空间中点处的相应 Kohn–Sham 交换势。目标是从均匀电子气的基本描述出发，推导出 LDA 交换能量密度及其泛函导数，然后将此泛函离散化，并将其应用于所提供的密度分布。\n\n从以下基本原理和经过充分检验的事实出发：\n- 在密度泛函理论 (DFT) 中，Hohenberg–Kohn 定理保证了存在一个关于电子数密度 $n(\\mathbf{r})$ 的普适泛函。在 Kohn–Sham (KS) 方法中，交换相关部分可以通过使用均匀电子气作为局域参考系来近似。\n- 对于自旋非极化的均匀电子气（均匀密度为 $n$），费米波矢为 $k_{\\mathrm{F}} = (3\\pi^{2} n)^{1/3}$，并且在该模型下可以精确计算 Hartree–Fock 交换能。\n\n任务：\n1) 推导自旋非极化电子气的仅交换 LDA 能量密度，将其表示为局域密度 $n$ 的函数，然后通过对 $n$ 求泛函导数来获得相应的 Kohn–Sham 交换势。\n2) 在一维空间 $x \\in [0,L]$ 上构建一个包含 $N$ 个点、间距为 $\\Delta x = L/(N-1)$ 的均匀网格上的数值积分方法，以近似计算任务 1 中针对非均匀密度 $n(x) \\ge 0$ 的交换能泛函。假设单位横截面积，以使一维积分具有正确的体积量纲。\n3) 使用 Hartree 原子单位 (a.u.) 实现计算，其中玻尔半径 $a_0$ 是长度单位，Hartree 是能量单位。您必须以 Hartree 表示能量，以 Hartree 表示势。计算中不涉及角度量。\n4) 对于每个给定的测试用例，计算：\n   - 总交换能 $E_{\\mathrm{x}}$（以 Hartree 为单位）。\n   - 在空间中点 $x = L/2$ 处计算的交换势 $v_{\\mathrm{x}}$（以 Hartree 为单位）。\n   使用梯形法则进行积分。如果在任何地方 $n=0$，请以一致且无奇点的方式处理。\n\n测试套件（请精确使用这些参数值）：\n- 用例 1 (高斯包):\n  - 域长度 $L = 20\\,a_0$，网格大小 $N = 10001$。\n  - 密度 $n(x) = n_0 \\exp\\!\\left(-\\dfrac{(x - L/2)^2}{2\\sigma^2}\\right)$，其中 $n_0 = 0.020\\,a_0^{-3}$ 且 $\\sigma = 2.000\\,a_0$。\n- 用例 2 (平顶板):\n  - 域长度 $L = 20\\,a_0$，网格大小 $N = 10001$。\n  - 密度 $n(x) = n_{\\mathrm{c}}$（对于 $x \\in [0.4L,\\,0.6L]$）且在其他地方 $n(x) = 0$，其中 $n_{\\mathrm{c}} = 0.030\\,a_0^{-3}$。\n- 用例 3 (指数衰减):\n  - 域长度 $L = 20\\,a_0$，网格大小 $N = 10001$。\n  - 密度 $n(x) = n_0 \\exp(-x/\\alpha)$，其中 $n_0 = 0.040\\,a_0^{-3}$ 且 $\\alpha = 3.000\\,a_0$。\n- 用例 4 (真空):\n  - 域长度 $L = 20\\,a_0$，网格大小 $N = 10001$。\n  - 对所有 $x$，密度 $n(x) = 0$。\n\n数值与输出要求：\n- 全程使用 Hartree 原子单位。以 Hartree 表示 $E_{\\mathrm{x}}$，以 Hartree 表示 $v_{\\mathrm{x}}$。\n- 对每个用例，使用均匀网格梯形法则计算数组 $\\{E_{\\mathrm{x}}, v_{\\mathrm{x}}(L/2)\\}$。\n- 您的程序必须输出单行，其中包含一个扁平列表，按顺序包含八个结果：$[E_{\\mathrm{x}}^{(1)}, v_{\\mathrm{x}}^{(1)}, E_{\\mathrm{x}}^{(2)}, v_{\\mathrm{x}}^{(2)}, E_{\\mathrm{x}}^{(3)}, v_{\\mathrm{x}}^{(3)}, E_{\\mathrm{x}}^{(4)}, v_{\\mathrm{x}}^{(4)}]$，其中上标表示用例编号。每个数字必须四舍五入到恰好 10 位小数。输出必须是包含在方括号内的逗号分隔列表，不得有任何其他文本。\n\n您的任务是生成一个完整的、可运行的程序，执行此计算并以上述确切格式打印结果。程序无需用户输入，也不应读取任何外部数据。实现语言和库在最终答案规范中有所限制。", "solution": "所提出的问题是计算电子结构理论中的一个标准练习，具体涉及密度泛函理论（DFT）框架下的局域密度近似（LDA）。该问题在科学上是合理的，在算法上是明确定义的，并包含了获得唯一解所需的所有信息。因此，该问题被视为有效，我将着手解决。\n\n核心任务是为几个一维电子密度分布 $n(x)$ 计算交换能泛函 $E_{\\mathrm{x}}[n]$ 和相应的交换势 $v_{\\mathrm{x}}(\\mathbf{r})$。我们从必要的理论推导开始。\n\n**步骤 1：推导 LDA 交换能量密度和势**\n\n局域密度近似（LDA）基于均匀电子气（HEG）的性质，这是一个电子数密度 $n$ 恒定的模型系统。对于自旋非极化的 HEG，可以使用 Hartree-Fock 方法精确计算单个粒子的交换能 $\\epsilon_{\\mathrm{x}}$。在 Hartree 原子单位（$\\hbar = m_e = e = 4\\pi\\epsilon_0 = 1$）中，该能量由下式给出：\n$$\n\\epsilon_{\\mathrm{x}}(n) = -\\frac{3}{4\\pi} k_{\\mathrm{F}}(n)\n$$\n其中 $k_{\\mathrm{F}}$ 是费米波矢。对于三维 HEG，$k_{\\mathrm{F}}$ 通过以下关系与密度 $n$ 相关：\n$$\nk_{\\mathrm{F}}(n) = (3\\pi^2 n)^{1/3}\n$$\n交换能量密度 $\\varepsilon_{\\mathrm{x}}$ 是单位体积的交换能。它通过将单个粒子的能量乘以单位体积内的粒子数（即密度 $n$）得到：\n$$\n\\varepsilon_{\\mathrm{x}}(n) = n \\cdot \\epsilon_{\\mathrm{x}}(n) = n \\left(-\\frac{3}{4\\pi} k_{\\mathrm{F}}(n)\\right)\n$$\n代入 $k_{\\mathrm{F}}(n)$ 的表达式，我们得到 HEG 的交换能量密度：\n$$\n\\varepsilon_{\\mathrm{x}}(n) = -\\frac{3n}{4\\pi} (3\\pi^2 n)^{1/3} = -\\frac{3}{4\\pi} (3\\pi^2)^{1/3} n^{1+1/3} = -\\frac{3}{4\\pi} (3\\pi^2)^{1/3} n^{4/3}\n$$\n该表达式可以简化为标准形式 $\\varepsilon_{\\mathrm{x}}(n) = C_{\\mathrm{x}} n^{4/3}$，其中 $C_{\\mathrm{x}}$ 是 Slater 交换常数：\n$$\nC_{\\mathrm{x}} = -\\frac{3}{4\\pi} (3\\pi^2)^{1/3} = -\\frac{3}{4} \\left(\\frac{3}{\\pi}\\right)^{1/3}\n$$\n在 LDA 中，我们通过对具有相同密度的均匀系统的局域能量密度进行积分，来近似一个密度为 $n(\\mathbf{r})$ 的非均匀系统的总交换能：\n$$\nE_{\\mathrm{x}}^{\\mathrm{LDA}}[n] = \\int \\varepsilon_{\\mathrm{x}}(n(\\mathbf{r})) \\, d^3\\mathbf{r} = \\int C_{\\mathrm{x}} [n(\\mathbf{r})]^{4/3} \\, d^3\\mathbf{r}\n$$\n相应的 Kohn-Sham 交换势 $v_{\\mathrm{x}}(\\mathbf{r})$ 是交换能泛函对密度的泛函导数：\n$$\nv_{\\mathrm{x}}(\\mathbf{r}) = \\frac{\\delta E_{\\mathrm{x}}^{\\mathrm{LDA}}[n]}{\\delta n(\\mathbf{r})}\n$$\n对于形式为 $E[n] = \\int f(n(\\mathbf{r})) \\, d^3\\mathbf{r}$ 的局域泛函，其泛函导数就是被积函数对其自变量的普通导数：$\\frac{df(n)}{dn}$。因此，交换势是密度的局域函数：\n$$\nv_{\\mathrm{x}}(n(\\mathbf{r})) = \\frac{d\\varepsilon_{\\mathrm{x}}(n)}{dn} \\bigg|_{n=n(\\mathbf{r})} = \\frac{d}{dn} (C_{\\mathrm{x}} n^{4/3}) \\bigg|_{n=n(\\mathbf{r})} = \\frac{4}{3} C_{\\mathrm{x}} [n(\\mathbf{r})]^{1/3}\n$$\n值得注意的是，对于任何密度 $n \\ge 0$，$\\varepsilon_{\\mathrm{x}}(n)$ 和 $v_{\\mathrm{x}}(n)$ 都是良定义的。如果 $n=0$，则 $\\varepsilon_{\\mathrm{x}}(0)=0$ 且 $v_{\\mathrm{x}}(0)=0$。这确保了在真空区域不会出现奇点。\n\n**步骤 2：数值实现**\n\n问题在一维空间维度 $x$ 上的定义域 $[0, L]$ 内定义。根据要求，我们假设单位横截面积，因此体积元 $d^3\\mathbf{r}$ 变为 $dx$。总交换能为：\n$$\nE_{\\mathrm{x}}[n] = \\int_0^L C_{\\mathrm{x}} [n(x)]^{4/3} \\, dx\n$$\n该积分将在一个包含 $N$ 个点的均匀网格上进行数值计算，其中 $x_i = i \\cdot \\Delta x$，$i=0, 1, \\ldots, N-1$，网格间距为 $\\Delta x = L/(N-1)$。我们将使用梯形法则进行数值积分：\n$$\n\\int_0^L f(x) \\, dx \\approx \\Delta x \\left( \\frac{f(x_0) + f(x_{N-1})}{2} + \\sum_{i=1}^{N-2} f(x_i) \\right)\n$$\n要积分的函数是沿网格的交换能量密度，$f(x_i) = C_{\\mathrm{x}} [n(x_i)]^{4/3}$。\n\n交换势 $v_{\\mathrm{x}}(x)$ 在空间中点 $x = L/2$ 处进行计算。鉴于 $N=10001$ 是一个奇数，定义域的中点恰好与一个网格点重合。该中点的索引为 $i_{\\mathrm{mid}} = (N-1)/2 = 5000$。势的计算如下：\n$$\nv_{\\mathrm{x}}(L/2) = \\frac{4}{3} C_{\\mathrm{x}} [n(x_{i_{\\mathrm{mid}}})]^{1/3}\n$$\n\n**步骤 3：应用于测试用例**\n\n现在，我们将使用提供的参数，把这些公式应用于四个指定的密度分布。所有计算均在 Hartree 原子单位下进行。常数 $C_{\\mathrm{x}}$ 只需计算一次。参数为 $L=20\\,a_0$ 和 $N=10001$。\n\n-   **用例 1 (高斯包)：**\n    -   密度：$n(x) = n_0 \\exp\\left(-\\frac{(x - L/2)^2}{2\\sigma^2}\\right)$，其中 $n_0 = 0.020\\,a_0^{-3}$ 且 $\\sigma = 2.000\\,a_0$。\n    -   在网格上生成密度分布。对每个网格点 $i$ 计算被积函数 $C_{\\mathrm{x}}[n(x_i)]^{4/3}$。使用梯形法则求得 $E_{\\mathrm{x}}$。\n    -   在 $x = L/2$ 处计算势，此处 $n(L/2) = n_0 = 0.020$。因此，$v_{\\mathrm{x}}(L/2) = \\frac{4}{3} C_{\\mathrm{x}} (0.020)^{1/3}$。\n\n-   **用例 2 (平顶板)：**\n    -   密度：$n(x) = n_{\\mathrm{c}} = 0.030\\,a_0^{-3}$（对于 $x \\in [0.4L, 0.6L]$ 即 $[8, 12]$）且在其他地方 $n(x) = 0$。\n    -   构建分段密度分布。被积函数仅在区域 $[8, 12]$ 内非零。通过梯形法则计算 $E_{\\mathrm{x}}$。\n    -   中点 $x=L/2=10$ 位于板内，因此 $n(L/2) = n_{\\mathrm{c}} = 0.030$。势为 $v_{\\mathrm{x}}(L/2) = \\frac{4}{3} C_{\\mathrm{x}} (0.030)^{1/3}$。\n\n-   **用例 3 (指数衰减)：**\n    -   密度：$n(x) = n_0 \\exp(-x/\\alpha)$，其中 $n_0 = 0.040\\,a_0^{-3}$ 且 $\\alpha = 3.000\\,a_0$。\n    -   生成密度分布。通过对 $C_{\\mathrm{x}}[n(x_i)]^{4/3}$ 进行数值积分来计算 $E_{\\mathrm{x}}$。\n    -   根据中点密度 $n(L/2) = n(10) = 0.040 \\exp(-10/3)$ 来计算势。则，$v_{\\mathrm{x}}(L/2) = \\frac{4}{3} C_{\\mathrm{x}} [n(10)]^{1/3}$。\n\n-   **用例 4 (真空)：**\n    -   密度：对所有 $x$，$n(x) = 0$。\n    -   这是一个平凡用例。由于密度处处为零，被积函数也为零。因此，总交换能 $E_{\\mathrm{x}}$ 精确为 $0$。\n    -   中点处的密度为 $n(L/2) = 0$，因此交换势 $v_{\\mathrm{x}}(L/2)$ 也为 $0$。\n\n以下程序精确地实现了此过程。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the LDA exchange energy and potential for given 1D density profiles.\n    \"\"\"\n    # Define physical constants and simulation parameters in Hartree atomic units.\n    L = 20.0  # Domain length in a_0\n    N = 10001  # Number of grid points\n    \n    # Slater exchange constant C_x = -(3/4)*(3/pi)^(1/3)\n    C_x = -(3.0 / 4.0) * (3.0 / np.pi)**(1.0 / 3.0)\n\n    # Define the spatial grid\n    x_grid = np.linspace(0, L, N)\n    \n    # Midpoint index for potential evaluation\n    mid_idx = (N - 1) // 2\n    if x_grid[mid_idx] != L / 2.0:\n        # This should not happen for odd N\n        raise ValueError(\"Midpoint is not on the grid.\")\n\n    # Define test cases\n    test_cases = [\n        # Case 1: Gaussian bump\n        {'type': 'gaussian', 'n0': 0.020, 'sigma': 2.000},\n        # Case 2: Top-hat slab\n        {'type': 'tophat', 'nc': 0.030, 'xmin_frac': 0.4, 'xmax_frac': 0.6},\n        # Case 3: Exponential decay\n        {'type': 'exponential', 'n0': 0.040, 'alpha': 3.000},\n        # Case 4: Vacuum\n        {'type': 'vacuum'},\n    ]\n\n    results = []\n\n    for params in test_cases:\n        case_type = params['type']\n        n_x = np.zeros_like(x_grid)\n\n        if case_type == 'gaussian':\n            n0 = params['n0']\n            sigma = params['sigma']\n            L_half = L / 2.0\n            n_x = n0 * np.exp(-((x_grid - L_half)**2) / (2 * sigma**2))\n        \n        elif case_type == 'tophat':\n            nc = params['nc']\n            xmin = params['xmin_frac'] * L\n            xmax = params['xmax_frac'] * L\n            mask = (x_grid >= xmin) & (x_grid <= xmax)\n            n_x[mask] = nc\n\n        elif case_type == 'exponential':\n            n0 = params['n0']\n            alpha = params['alpha']\n            n_x = n0 * np.exp(-x_grid / alpha)\n\n        elif case_type == 'vacuum':\n            # n_x is already an array of zeros\n            pass\n        \n        # Calculate total exchange energy E_x using the trapezoidal rule\n        # Integrand is C_x * n(x)^(4/3)\n        # We need to be careful with n=0 to avoid warnings, although n**(4/3) is 0.\n        # np.power handles this correctly.\n        integrand = C_x * np.power(n_x, 4.0 / 3.0)\n        E_x = np.trapz(integrand, x_grid)\n\n        # Calculate exchange potential v_x at the midpoint x = L/2\n        # v_x(n) = (4/3) * C_x * n^(1/3)\n        n_mid = n_x[mid_idx]\n        v_x_mid = (4.0 / 3.0) * C_x * np.power(n_mid, 1.0 / 3.0)\n\n        # Append results, rounded to 10 decimal places\n        results.append(round(E_x, 10))\n        results.append(round(v_x_mid, 10))\n\n    # Format output as a single comma-separated list in brackets\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```", "id": "2813517"}, {"introduction": "在材料模拟中，准确计算原子间的作用力对于结构优化、分子动力学和声子谱分析至关重要。当使用依赖于原子位置的基组（如原子轨道）时，仅凭Hellmann–Feynman定理计算的力是不完备的，必须考虑基组随原子移动带来的额外贡献，即所谓的Pulay力。本练习[@problem_id:2813514]旨在通过一个简明的矩阵模型，让你深入理解Pulay力的来源并掌握其计算方法，这是任何实际DFT计算中都不可或缺的一环。", "problem": "在密度泛函理论 (DFT) 框架下的 Born–Oppenheimer 凝聚态物质和分子模拟中，原子核上的力源于电子基态能量相对于原子核坐标的导数。当电子态在一个有限的、依赖于位置且可能非正交的基组中表示时，力会获得一个由基组依赖性产生的贡献项（Pulay 效应）。从基态在非正交基组中满足归一化约束的 Rayleigh 商驻点的变分表征出发，推导力的分解，将其分为源于哈密顿量显式参数依赖性的项和源于基组重叠参数依赖性的项。然后，实现所推导的表达式，为提供的测试套件计算力。\n\n基本依据和假设：\n- 使用应用于有限基组表示的不含时薛定谔方程的 Rayleigh–Ritz 变分原理。设哈密顿矩阵用 $H(R)$ 表示，重叠矩阵用 $S(R)$ 表示，二者均为对称矩阵且依赖于一个标量核坐标 $R$（Born–Oppenheimer 近似，考虑单个电子态）。\n- 基态系数矢量 $c$ 和能量 $\\varepsilon$ 满足广义本征值问题 $H(R)\\,c=\\varepsilon\\,S(R)\\,c$ 及约束条件 $c^{\\mathsf{T}}S(R)\\,c=1$。\n- 使用原子单位；能量单位为 Hartree，长度单位为 Bohr。力必须以 Hartree 每 Bohr 为单位报告。\n\n计算任务：\n1. 对每个提供的测试用例，求解对称广义本征值问题 $H\\,c=\\varepsilon\\,S\\,c$，得到最低本征值 $\\varepsilon$ 及其关联的本征矢量 $c$，$c$ 需经 $S$ 归一化，使得 $c^{\\mathsf{T}}S\\,c=1$。\n2. 从第一性原理出发，推导核坐标 $R$ 上的力 $F=-\\mathrm{d}\\varepsilon/\\mathrm{d}R$，并将其分解为来自 $H$ 的显式 $R$ 依赖性的贡献（Hellmann–Feynman 部分）和来自 $S$ 的 $R$ 依赖性的贡献（Pulay 部分）。\n3. 实现推导出的表达式，为每个测试用例计算：\n   - 总力 $F$ (单位 Hartree 每 Bohr)。\n   - Pulay 贡献项 $F_{\\mathrm{Pulay}}$ (单位 Hartree 每 Bohr)。\n4. 您的程序应输出单行，包含一个逗号分隔的列表，其中按以下顺序包含六个浮点数：\n   $[F^{(1)},F_{\\mathrm{Pulay}}^{(1)},F^{(2)},F_{\\mathrm{Pulay}}^{(2)},F^{(3)},F_{\\mathrm{Pulay}}^{(3)}]$,\n   其中上标表示测试用例索引。每个数字必须四舍五入到小数点后恰好六位。每个数字的单位是 Hartree 每 Bohr。\n\n测试套件（所有矩阵均为实对称的 $2\\times 2$ 矩阵；导数是相对于单个标量坐标 $R$ 计算的）：\n\n- 用例 1（具有非零重叠导数的非正交基组）：\n  $$\n  S^{(1)}=\\begin{bmatrix}1.0 & 0.3 \\\\ 0.3 & 1.0\\end{bmatrix}, \\quad H^{(1)}=\\begin{bmatrix}-1.0 & -0.2 \\\\ -0.2 & -0.5\\end{bmatrix}, \\quad \\frac{\\partial S^{(1)}}{\\partial R}=\\begin{bmatrix}0.0 & -0.1 \\\\ -0.1 & 0.0\\end{bmatrix}, \\quad \\frac{\\partial H^{(1)}}{\\partial R}=\\begin{bmatrix}0.05 & 0.15 \\\\ 0.15 & 0.02\\end{bmatrix}.\n  $$\n\n- 用例 2（正交基组；预计没有来自重叠的 Pulay 效应）：\n  $$\n  S^{(2)}=\\begin{bmatrix}1.0 & 0.0 \\\\ 0.0 & 1.0\\end{bmatrix}, \\quad H^{(2)}=\\begin{bmatrix}-1.2 & -0.1 \\\\ -0.1 & -0.8\\end{bmatrix}, \\quad \\frac{\\partial S^{(2)}}{\\partial R}=\\begin{bmatrix}0.0 & 0.0 \\\\ 0.0 & 0.0\\end{bmatrix}, \\quad \\frac{\\partial H^{(2)}}{\\partial R}=\\begin{bmatrix}0.03 & 0.0 \\\\ 0.0 & -0.02\\end{bmatrix}.\n  $$\n\n- 用例 3（强重叠基组；预计有显著的 Pulay 贡献）：\n  $$\n  S^{(3)}=\\begin{bmatrix}1.0 & 0.9 \\\\ 0.9 & 1.0\\end{bmatrix}, \\quad H^{(3)}=\\begin{bmatrix}-0.7 & -0.6 \\\\ -0.6 & -0.7\\end{bmatrix}, \\quad \\frac{\\partial S^{(3)}}{\\partial R}=\\begin{bmatrix}0.0 & -0.3 \\\\ -0.3 & 0.0\\end{bmatrix}, \\quad \\frac{\\partial H^{(3)}}{\\partial R}=\\begin{bmatrix}0.0 & 0.25 \\\\ 0.25 & 0.0\\end{bmatrix}.\n  $$\n\n数值和输出要求：\n- 对每个用例，使用最低本征值 $\\varepsilon$ 及其关联的本征矢量 $c$。\n- 力必须以 Hartree 每 Bohr 表示。\n- 最终输出必须是单行，包含用方括号括起来的逗号分隔列表，格式完全如下：\n  $[F^{(1)},F_{\\mathrm{Pulay}}^{(1)},F^{(2)},F_{\\mathrm{Pulay}}^{(2)},F^{(3)},F_{\\mathrm{Pulay}}^{(3)}]$,\n  每个值四舍五入到小数点后六位。", "solution": "该问题要求在 Born-Oppenheimer 近似下，当电子态使用有限的、非正交且依赖于位置的基组描述时，推导原子核上力的表达式。随后，必须实现此推导出的表达式，为一组给定的测试用例计算力。\n\n首先，对问题陈述进行验证。\n已知条件如下：\n- 一个基于 Rayleigh–Ritz 变分原理的模型，用于广义本征值问题 $H(R)\\,c=\\varepsilon\\,S(R)\\,c$。\n- 哈密顿矩阵 $H(R)$ 和重叠矩阵 $S(R)$ 是对称的，并依赖于一个标量核坐标 $R$。\n- 基态系数矢量 $c$ 的归一化条件是 $c^{\\mathsf{T}}S(R)\\,c=1$。\n- 力 $F$ 定义为 $F = -\\mathrm{d}\\varepsilon/\\mathrm{d}R$。\n- 提供了三个测试用例，每个用例包含 $H$、$S$、$\\partial H / \\partial R$ 和 $\\partial S / \\partial R$ 的 $2 \\times 2$ 矩阵。\n- 要求输出一个包含计算出的总力和 Pulay 贡献项的特定列表。\n\n该问题具有科学依据，因为它涉及计算材料物理学中的一个基本概念——Pulay力。该问题提法恰当，提供了所有必要的矩阵和明确的目标。它客观、无歧义，且其各组成部分内部一致（例如，重叠矩阵是正定的）。因此，该问题被视为有效，并将提供解答。\n\n力的推导始于基态能量本征值 $\\varepsilon$ 的表达式，该表达式从广义本征值方程 $H c = \\varepsilon S c$ 获得。用 $c^{\\mathsf{T}}$ 左乘，我们得到 $c^{\\mathsf{T}}H c = \\varepsilon c^{\\mathsf{T}}S c$。根据归一化条件 $c^{\\mathsf{T}}S c = 1$，能量即为 $\\varepsilon = c^{\\mathsf{T}}H c$。\n\n沿坐标 $R$ 作用在原子核上的力 $F$ 是能量的负梯度，即 $F = -\\mathrm{d}\\varepsilon/\\mathrm{d}R$。我们必须计算 $\\varepsilon$ 关于 $R$ 的全导数。所有量 $H$、$S$ 和本征矢量 $c$ 都是 $R$ 的函数。\n从 $\\varepsilon(R) = c(R)^{\\mathsf{T}}H(R)c(R)$ 出发，并应用微分的乘法法则：\n$$\n\\frac{\\mathrm{d}\\varepsilon}{\\mathrm{d}R} = \\frac{\\mathrm{d}}{\\mathrm{d}R} \\left( c^{\\mathsf{T}}H c \\right) = \\left(\\frac{\\mathrm{d}c^{\\mathsf{T}}}{\\mathrm{d}R}\\right)H c + c^{\\mathsf{T}}\\left(\\frac{\\partial H}{\\partial R}\\right)c + c^{\\mathsf{T}}H\\left(\\frac{\\mathrm{d}c}{\\mathrm{d}R}\\right)\n$$\n此处，$\\partial H / \\partial R$ 表示哈密顿矩阵元对 $R$ 的导数矩阵，这在问题中已给出。涉及 $\\mathrm{d}c/\\mathrm{d}R$ 的项解释了基组系数的变化。\n\n我们利用 $c$ 是一个本征矢量这一事实，因此有 $Hc = \\varepsilon S c$。由于 $H$ 和 $S$ 是对称的，转置关系 $c^{\\mathsf{T}}H = \\varepsilon c^{\\mathsf{T}}S$ 也成立。将这些代入导数表达式中：\n$$\n\\frac{\\mathrm{d}\\varepsilon}{\\mathrm{d}R} = \\varepsilon \\left(\\frac{\\mathrm{d}c^{\\mathsf{T}}}{\\mathrm{d}R}\\right)S c + c^{\\mathsf{T}}\\left(\\frac{\\partial H}{\\partial R}\\right)c + \\varepsilon c^{\\mathsf{T}}S\\left(\\frac{\\mathrm{d}c}{\\mathrm{d}R}\\right)\n$$\n我们可以提出因子 $\\varepsilon$ 并将包含 $c$ 导数的项组合在一起：\n$$\n\\frac{\\mathrm{d}\\varepsilon}{\\mathrm{d}R} = c^{\\mathsf{T}}\\left(\\frac{\\partial H}{\\partial R}\\right)c + \\varepsilon \\left[ \\left(\\frac{\\mathrm{d}c^{\\mathsf{T}}}{\\mathrm{d}R}\\right)S c + c^{\\mathsf{T}}S\\left(\\frac{\\mathrm{d}c}{\\mathrm{d}R}\\right) \\right]\n$$\n为了计算方括号中的项，我们对归一化条件 $c^{\\mathsf{T}}S c = 1$ 关于 $R$ 求导：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}R}\\left(c^{\\mathsf{T}}S c\\right) = \\left(\\frac{\\mathrm{d}c^{\\mathsf{T}}}{\\mathrm{d}R}\\right)S c + c^{\\mathsf{T}}\\left(\\frac{\\partial S}{\\partial R}\\right)c + c^{\\mathsf{T}}S\\left(\\frac{\\mathrm{d}c}{\\mathrm{d}R}\\right) = 0\n$$\n这直接给出了我们所需项的表达式：\n$$\n\\left(\\frac{\\mathrm{d}c^{\\mathsf{T}}}{\\mathrm{d}R}\\right)S c + c^{\\mathsf{T}}S\\left(\\frac{\\mathrm{d}c}{\\mathrm{d}R}\\right) = -c^{\\mathsf{T}}\\left(\\frac{\\partial S}{\\partial R}\\right)c\n$$\n将此代回 $\\mathrm{d}\\varepsilon/\\mathrm{d}R$ 的表达式中：\n$$\n\\frac{\\mathrm{d}\\varepsilon}{\\mathrm{d}R} = c^{\\mathsf{T}}\\left(\\frac{\\partial H}{\\partial R}\\right)c + \\varepsilon \\left[ -c^{\\mathsf{T}}\\left(\\frac{\\partial S}{\\partial R}\\right)c \\right] = c^{\\mathsf{T}}\\left(\\frac{\\partial H}{\\partial R}\\right)c - \\varepsilon c^{\\mathsf{T}}\\left(\\frac{\\partial S}{\\partial R}\\right)c\n$$\n这个结果是 Hellmann-Feynman 定理在非正交、依赖于参数的基组上的推广形式。总力 $F$ 则为：\n$$\nF = -\\frac{\\mathrm{d}\\varepsilon}{\\mathrm{d}R} = -c^{\\mathsf{T}}\\left(\\frac{\\partial H}{\\partial R}\\right)c + \\varepsilon c^{\\mathsf{T}}\\left(\\frac{\\partial S}{\\partial R}\\right)c\n$$\n这个表达式自然地分解为两部分：\n1. Hellmann-Feynman 项，源于哈密顿量对核坐标的显式依赖性：$F_{\\mathrm{HF}} = -c^{\\mathsf{T}} (\\partial H / \\partial R) c$。\n2. Pulay 项，源于基组对核坐标的依赖性，通过重叠矩阵的导数体现：$F_{\\mathrm{Pulay}} = \\varepsilon c^{\\mathsf{T}} (\\partial S / \\partial R) c$。\n\n总力是两项之和 $F = F_{\\mathrm{HF}} + F_{\\mathrm{Pulay}}$。问题要求计算总力 $F$ 和 Pulay 贡献项 $F_{\\mathrm{Pulay}}$。\n\n每个测试用例的计算步骤如下：\n1. 根据给定数据构建矩阵 $H$、$S$、$\\partial H / \\partial R$ 和 $\\partial S / \\partial R$。\n2. 求解对称广义本征值问题 $H c = \\varepsilon S c$，找到所有本征值和对应的本征矢量。我们关心的是最低本征值 $\\varepsilon$ 及其关联的本征矢量 $c$。`scipy.linalg.eigh` 函数适用于此任务，因为它按升序返回本征值，并返回经过 $S$ 归一化的本征矢量（$c^{\\mathsf{T}} S c = 1$）。\n3. 计算二次型 $T_H = c^{\\mathsf{T}} (\\partial H / \\partial R) c$。\n4. 计算二次型 $T_S = c^{\\mathsf{T}} (\\partial S / \\partial R) c$。\n5. Pulay 力是 $F_{\\mathrm{Pulay}} = \\varepsilon \\cdot T_S$。\n6. 总力是 $F = -T_H + F_{\\mathrm{Pulay}}$。\n7. 为所有三个测试用例计算这些值，并按要求格式化。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating total and Pulay forces for three test cases\n    in a non-orthogonal basis framework.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1\n        {\n            \"S\": np.array([[1.0, 0.3], [0.3, 1.0]]),\n            \"H\": np.array([[-1.0, -0.2], [-0.2, -0.5]]),\n            \"dSdR\": np.array([[0.0, -0.1], [-0.1, 0.0]]),\n            \"dHdR\": np.array([[0.05, 0.15], [0.15, 0.02]]),\n        },\n        # Case 2\n        {\n            \"S\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"H\": np.array([[-1.2, -0.1], [-0.1, -0.8]]),\n            \"dSdR\": np.array([[0.0, 0.0], [0.0, 0.0]]),\n            \"dHdR\": np.array([[0.03, 0.0], [0.0, -0.02]]),\n        },\n        # Case 3\n        {\n            \"S\": np.array([[1.0, 0.9], [0.9, 1.0]]),\n            \"H\": np.array([[-0.7, -0.6], [-0.6, -0.7]]),\n            \"dSdR\": np.array([[0.0, -0.3], [-0.3, 0.0]]),\n            \"dHdR\": np.array([[0.0, 0.25], [0.25, 0.0]]),\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        H = case[\"H\"]\n        S = case[\"S\"]\n        dHdR = case[\"dHdR\"]\n        dSdR = case[\"dSdR\"]\n\n        # 1. Solve the symmetric generalized eigenvalue problem Hc = eSc.\n        #    scipy.linalg.eigh returns eigenvalues in ascending order and S-normalized\n        #    eigenvectors, i.e., c.T @ S @ c = 1.\n        eigenvalues, eigenvectors = eigh(H, S)\n\n        # 2. Extract the lowest eigenvalue (ground state energy) and its eigenvector.\n        ground_state_energy = eigenvalues[0]\n        ground_state_vector = eigenvectors[:, 0]\n\n        # 3. Calculate the Hellmann-Feynman and Pulay components.\n        #    The quadratic form c.T @ (dH/dR) @ c\n        term_H = ground_state_vector.T @ dHdR @ ground_state_vector\n        #    The quadratic form c.T @ (dS/dR) @ c\n        term_S = ground_state_vector.T @ dSdR @ ground_state_vector\n\n        # 4. Calculate the Pulay force and the total force.\n        #    F_Pulay = energy * c.T @ (dS/dR) @ c\n        #    F_total = - c.T @ (dH/dR) @ c + F_Pulay\n        F_pulay = ground_state_energy * term_S\n        F_total = -term_H + F_pulay\n\n        results.extend([F_total, F_pulay])\n\n    # Final print statement in the exact required format.\n    # Each value is rounded to six digits after the decimal point.\n    formatted_results = [f\"{val:.6f}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2813514"}, {"introduction": "在固态物理学中，我们通常使用周期性边界条件下的超胞模型来研究点缺陷。然而，当缺陷带有电荷时，这种设置会引入缺陷与其周期性镜像以及中性背景电荷之间虚假的静电相互作用，导致计算的形成能严重依赖于超胞的大小。这个练习[@problem_id:2813515]将指导你推导并应用针对这种有限尺寸效应的主要修正方案，确保你能从计算结果中提取出物理上可靠的缺陷形成能。", "problem": "您的任务是形式化并实现前导的有限尺寸静电修正项，该修正是为在三维周期性边界条件和均匀中性化背景下计算的局域带电缺陷而设，常用于材料的密度泛函理论计算中。目标是从基本静电学和周期性边界条件出发，推导出一个实用的近似公式，该公式可以量化形成能如何依赖于超胞尺寸和介电屏蔽。然后，您的程序必须为一组给定的参数值测试套件评估此修正项。\n\n从以下基本依据开始：\n- 线性、均匀、各向同性介电介质中的泊松方程：$\\nabla \\cdot \\left( \\epsilon \\nabla \\phi(\\mathbf{r}) \\right) = - \\rho(\\mathbf{r})$，其中 $\\epsilon = \\epsilon_0 \\epsilon_r$ 是介电常数，$\\epsilon_0$ 是真空介电常数，$\\epsilon_r$ 是相对介电常数，$\\phi$ 是静电势，$\\rho$ 是电荷密度。\n- 电荷分布在其自身势场中的静电能：$E = \\dfrac{1}{2} \\int \\rho(\\mathbf{r}) \\, \\phi(\\mathbf{r}) \\, d^3 r$。\n- 对于具有净电荷的周期性系统，为确保周期性泊松问题是适定的，必须引入均匀中性化背景。\n- 由总电荷为 $q$ 且二阶径向矩为 $Q$（二阶矩张量的迹）的局域电荷分布产生的势的远场多极展开：对于足够大的 $r$，$\\phi(\\mathbf{r})$ 允许按 $r$ 的逆幂次展开，从单极和四极贡献开始。\n\n基于这些依据以及边长为 $L$ 的简单立方晶格中的周期性镜像结构，推导嵌入在相对介电常数为 $\\epsilon_r$ 的均匀介电质中的、净电荷为 $q$（以元电荷为单位）的局域类点缺陷的形成能的前导有限尺寸修正项。假设超胞为边长 $L$ 的立方体且具有立方对称性。在此设置下，缺陷与其镜像及中性化背景之间的周期性静电相互作用能产生一个修正项，该修正项可以表示为 $L^{-1}$ 的幂级数，其中前导项的标度为 $L^{-1}$，次前导项的标度为 $L^{-3}$。您的推导应明确指出简单立方晶格的无量纲晶格求和常数的出现，以及局域电荷分布的二阶径向矩 $Q$ 的作用。\n\n为使数值实现明确无误，请使用以下精确的建模约定：\n- 将超胞视为边长为 $L$（单位为埃，即 $1\\,\\text{Å} = 10^{-10}\\,\\text{m}$）的简单立方体。\n- 净电荷 $q$ 以元电荷 $e$ 为单位给出，因此物理电荷为 $q e$。\n- 二阶径向矩 $Q$（有时表示为与此修正相关的类四极矩二阶矩的迹）以 $e \\cdot \\text{Å}^2$ 为单位给出，即其数值是系数，使得物理矩为 $Q \\cdot e \\cdot \\text{Å}^2$。\n- 使用简单立方晶格的埃瓦尔德晶格求和常数值 $\\alpha_{\\mathrm{sc}} = 2.837297$（无量纲）。\n- 在国际单位制中使用物理常数：真空介电常数 $\\epsilon_0$、库仑常数 $k_e = \\dfrac{1}{4\\pi \\epsilon_0}$ 和元电荷 $e$。您必须以电子伏特为单位计算能量。\n\n您的任务是：\n1. 从基本原理出发，推导立方晶胞的前导修正项的显式公式 $E_{\\mathrm{corr}}(L, q, \\epsilon_r, Q)$，保留 $L^{-1}$ 和 $L^{-3}$ 的贡献，并指明其对简单立方晶格求和常数及 $Q$ 的依赖关系。将结果表示为以电子伏特为单位的函数，变量为 $L$（单位为埃）、$q$（无量纲）、$\\epsilon_r$（无量纲）和 $Q$（单位为 $e \\cdot \\text{Å}^2$）。\n2. 使用您推导的表达式实现一个程序，为以下测试套件计算 $E_{\\mathrm{corr}}$。所有输入均遵循上述指定的单位，您必须以电子伏特为单位输出每个修正能量，并四舍五入到六位小数。\n   - 测试用例 1（正常情况）：$L = 10$, $q = 1$, $\\epsilon_r = 12$, $Q = 5$。\n   - 测试用例 2（中性边缘情况）：$L = 10$, $q = 0$, $\\epsilon_r = 12$, $Q = 100$。\n   - 测试用例 3（小晶胞，较高电荷量）：$L = 5$, $q = -2$, $\\epsilon_r = 4$, $Q = -10$。\n   - 测试用例 4（大晶胞，真空）：$L = 30$, $q = 1$, $\\epsilon_r = 1$, $Q = 0$。\n   - 测试用例 5（高介电屏蔽）：$L = 12$, $q = 1$, $\\epsilon_r = 100$, $Q = 20$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，例如 $[x_1,x_2,x_3,x_4,x_5]$，其中每个 $x_i$ 是对应测试用例的 $E_{\\mathrm{corr}}$ 的浮点值（以电子伏特为单位），并按要求四舍五入到六位小数。\n\n程序不应从标准输入读取任何内容；您的程序必须完全自包含，并在运行时产生指定的输出。", "solution": "该问题陈述已经过严格验证，被认为是科学上可靠、适定、客观和完整的。它代表了计算材料物理学中一个关于修正带电缺陷的密度泛函理论计算中有限尺寸误差的标准问题。因此，我们可以继续进行推导和求解。\n\n任务是推导并实现周期性重复超胞中局域带电缺陷的前导静电能修正项。该修正项解释了缺陷与其周期性镜像以及中性化背景电荷之间的伪相互作用，这对于在超胞中保持电荷中性并确保泊松问题适定是必要的。\n\n设超胞为边长为 $L$ 的简单立方体。该缺陷被建模为一个局域电荷分布 $\\rho_{\\mathrm{def}}(\\mathbf{r})$，其总电荷为 $q_{phys} = qe$，其中 $q$ 是无量纲电荷数，$e$ 是元电荷。系统嵌入在相对介电常数为 $\\epsilon_r$ 的均匀、各向同性介电介质中。静电势 $\\phi(\\mathbf{r})$ 和电荷密度 $\\rho(\\mathbf{r})$ 通过泊松方程关联：\n$$\n\\nabla \\cdot \\left( \\epsilon_0 \\epsilon_r \\nabla \\phi(\\mathbf{r}) \\right) = - \\rho(\\mathbf{r})\n$$\n其中 $\\epsilon_0$ 是真空介电常数。\n\n为了在周期性边界条件下处理净电荷 $q$，引入了一个均匀的中性化背景电荷密度 $\\rho_b = -qe/L^3$。模拟晶胞中的总电荷密度为 $\\rho_{\\mathrm{tot}}(\\mathbf{r}) = \\rho_{\\mathrm{def}}(\\mathbf{r}) + \\rho_b$。能量修正的参考标准是无限大介质中的孤立缺陷。修正能 $E_{\\mathrm{corr}}$ 是周期性系统的静电能与孤立缺陷能量之间的差值。这个差值恰好是中心晶胞中的缺陷与其周期性镜像及背景电荷之间的伪相互作用能。遵循 Makov、Payne 及其他人的标准形式，该能量可以表示为超胞长度 $L$ 的逆幂级数展开。我们将推导前两个主导项，它们的标度分别为 $L^{-1}$ 和 $L^{-3}$。\n\n修正能 $E_{\\mathrm{corr}}$ 由两个主要贡献项之和给出：\n$E_{\\mathrm{corr}} = E_{MM} + E_{MQ}$\n\n1.  **单极-单极项 ($E_{MM} \\propto L^{-1}$):**\n    该项源于缺陷的净电荷（单极）与其周期性镜像晶格及中性化背景之间的静电相互作用。对于这个前导项，我们将缺陷的电荷分布 $\\rho_{\\mathrm{def}}$ 建模为电荷为 $qe$ 的点单极。均匀中性化背景中点电荷 $qe$ 的周期性晶格的能量被称为马德隆能。对于简单立方晶格，每个晶胞的该能量为：\n    $$\n    E_{MM} = \\frac{(qe)^2 \\alpha_{\\mathrm{sc}}}{2(4\\pi\\epsilon_0\\epsilon_r)L} = \\frac{k_e (qe)^2 \\alpha_{\\mathrm{sc}}}{2 \\epsilon_r L}\n    $$\n    这里，$k_e = (4\\pi\\epsilon_0)^{-1}$ 是库仑常数，$\\alpha_{\\mathrm{sc}}$ 是具有中性化背景的简单立方晶格的无量纲马德隆常数，给定值为 $\\alpha_{\\mathrm{sc}} = 2.837297$。对于带电缺陷 ($q \\neq 0$)，该项始终为正，表示一种排斥性相互作用能，它会人为地增加计算出的形成能。\n\n2.  **单极-四极项 ($E_{MQ} \\propto L^{-3}$):**\n    该项考虑了镜像电荷的单极矩与中心晶胞中缺陷电荷分布的四极矩之间的相互作用。由于假定超胞具有立方对称性，偶极相互作用项消失。多极展开中的下一个非零项涉及电荷分布的二阶矩。遵循已建立的 Makov-Payne 修正方案，在国际单位制中，该项为：\n    $$\n    E_{MQ} = \\frac{qe M_{2,phys}}{6 \\epsilon_0 \\epsilon_r L^3}\n    $$\n    其中 $M_{2,phys}$ 是缺陷诱导电荷密度的二阶径向矩，定义为：\n    $$\n    M_{2,phys} = \\int_{\\text{cell}} r^2 \\rho_{\\mathrm{def}}(\\mathbf{r}) d^3r\n    $$\n    问题以 $e \\cdot \\text{Å}^2$ 为单位提供了该矩的数值，表示为 $Q$。这意味着物理量 $M_{2,phys}$ 由下式给出：\n    $$\n    M_{2,phys} = Q \\cdot e \\cdot (1\\,\\text{Å})^2 = Q \\cdot e \\cdot (10^{-10} \\text{ m})^2\n    $$\n    将此代入 $E_{MQ}$ 的表达式并使用 $k_e = (4\\pi\\epsilon_0)^{-1}$：\n    $$\n    E_{MQ} = \\frac{2\\pi k_e (qe) (Q e (1\\,\\text{Å})^2)}{3 \\epsilon_r L^3} = \\frac{2\\pi k_e e^2 qQ (10^{-20} \\text{ m}^2)}{3 \\epsilon_r L^3}\n    $$\n\n**用于实现的最终公式：**\n为了创建一个用于实现的实用公式，我们必须将能量转换为电子伏特 (eV)，并将所有长度以埃 (Å) 表示，以与问题的输入单位保持一致。以电子伏特为单位的能量可通过将以焦耳为单位的能量除以元电荷 $e$ 得到。\n\n对于 $L^{-1}$ 项：\n$$\nE_{MM} [\\text{eV}] = \\frac{E_{MM}[\\text{J}]}{e} = \\frac{k_e q^2 e \\alpha_{\\mathrm{sc}}}{2 \\epsilon_r L}\n$$\n使用方便的常数组合 $k_e e^2 \\approx 14.399645 \\text{ eV} \\cdot \\text{Å}$，我们可以写出 $k_e e = (k_e e^2)/e$。设 $L_{\\text{Å}}$ 为以埃为单位的长度数值，因此 $L = L_{\\text{Å}} \\times 10^{-10}$ m。\n$$\nE_{MM} [\\text{eV}] = \\frac{\\alpha_{\\mathrm{sc}} q^2}{2 \\epsilon_r L_{\\text{Å}}} \\cdot \\frac{k_e e^2}{e \\cdot 10^{-10} \\text{ m}} = \\frac{\\alpha_{\\mathrm{sc}} q^2}{2 \\epsilon_r L_{\\text{Å}}} \\cdot (14.399645 \\text{ eV} \\cdot \\text{Å}) \\cdot \\frac{1}{1\\,\\text{Å}} = \\frac{14.399645 \\cdot \\alpha_{\\mathrm{sc}}}{2} \\frac{q^2}{\\epsilon_r L_{\\text{Å}}}\n$$\n我们定义系数 $C_1 = (14.399645 \\times 2.837297)/2 \\approx 20.427847$。\n$$\nE_{MM} [\\text{eV}] = C_1 \\frac{q^2}{\\epsilon_r L_{\\text{Å}}}\n$$\n\n对于 $L^{-3}$ 项：\n$$\nE_{MQ} [\\text{eV}] = \\frac{E_{MQ}[\\text{J}]}{e} = \\frac{1}{e} \\frac{2\\pi k_e e^2 qQ (10^{-20} \\text{ m}^2)}{3 \\epsilon_r (L_{\\text{Å}} \\times 10^{-10} \\text{ m})^3} = \\frac{2\\pi (k_e e^2) qQ 10^{-20}}{3e \\epsilon_r L_{\\text{Å}}^3 10^{-30}} = \\frac{2\\pi (k_e e^2/e) qQ 10^{10}}{3 \\epsilon_r L_{\\text{Å}}^3}\n$$\n量 $(k_e e^2/e)$ 是 $14.399645 \\text{ eV} \\cdot \\text{Å} / e$。这不是一个实用的常数。让我们回到包含 $\\epsilon_0$ 的表达式：\n$$\nE_{MQ} [\\text{J}] = \\frac{q Q e^2 (10^{-20} \\text{ m}^2)}{6 \\epsilon_0 \\epsilon_r (L_{\\text{Å}} \\times 10^{-10} \\text{ m})^3} = \\frac{q Q e^2 10^{10}}{6 \\epsilon_0 \\epsilon_r L_{\\text{Å}}^3}\n$$\n$$\nE_{MQ} [\\text{eV}] = \\frac{E_{MQ}[\\text{J}]}{e} = \\left(\\frac{e \\cdot 10^{10}}{6 \\epsilon_0}\\right) \\frac{qQ}{\\epsilon_r L_{\\text{Å}}^3}\n$$\n前置因子是一个可以由基本常数计算得出的常数：\n$C_2 = \\frac{e \\cdot 10^{10}}{6 \\epsilon_0} \\approx \\frac{(1.602176634 \\times 10^{-19} \\text{ C}) \\cdot 10^{10}}{6 \\cdot (8.8541878128 \\times 10^{-12} \\text{ F/m})} \\approx 30.15843 \\text{ V}$。由于电荷为 $e$ 的能量（以 eV 计）在数值上等于电势（以伏特计），因此这给出了以 eV 为单位的能量。\n$$\nE_{MQ} [\\text{eV}] = C_2 \\frac{qQ}{\\epsilon_r L_{\\text{Å}}^3}\n$$\n\n需要实现的总修正能量为：\n$$\nE_{\\mathrm{corr}}(L, q, \\epsilon_r, Q) [\\text{eV}] = 20.427847 \\frac{q^2}{\\epsilon_r L} + 30.15843 \\frac{qQ}{\\epsilon_r L^3}\n$$\n其中 $L$ 的单位是 Å，$q$ 是无量纲的，$\\epsilon_r$ 是无量纲的，$Q$ 以 $e \\cdot \\text{Å}^2$ 为单位给出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.constants import e, epsilon_0\n\ndef solve():\n    \"\"\"\n    Calculates the leading-order electrostatic correction for a localized charged defect\n    in a periodic supercell based on the Makov-Payne scheme.\n\n    The correction formula used is E_corr = E_MM + E_MQ, where:\n    E_MM is the monopole-monopole interaction term (L^-1 scaling).\n    E_MQ is the monopole-quadrupole interaction term (L^-3 scaling).\n\n    The final expression in practical units (eV, Å) is:\n    E_corr [eV] = C1 * (q^2 / (epsilon_r * L)) + C2 * (q * Q / (epsilon_r * L^3))\n    \"\"\"\n\n    # --- Define Constants ---\n\n    # Simple cubic lattice Ewald constant (dimensionless)\n    alpha_sc = 2.837297\n\n    # Coulomb constant * e^2 in units of eV·Å\n    # This is a convenient constant for calculations in solid-state physics.\n    # (1 / (4 * pi * epsilon_0)) * e^2, converted to eV·Å\n    k_e_e2_eV_A = 14.39964552\n\n    # Prefactor for the L^-1 monopole-monopole term\n    # C1 = (alpha_sc / 2) * k_e_e2_eV_A\n    C1 = (alpha_sc * k_e_e2_eV_A) / 2.0\n    # C1 ≈ 20.427847\n\n    # Prefactor for the L^-3 monopole-quadrupole term\n    # Derived from (e * 10^10) / (6 * epsilon_0), which gives a result in Volts.\n    # Since energy in eV of a charge e is numerically equal to potential in Volts,\n    # this prefactor can be used directly.\n    C2 = (e * 1e10) / (6.0 * epsilon_0)\n    # C2 ≈ 30.15843\n\n    # Define the test cases from the problem statement.\n    # Each tuple is (L, q, epsilon_r, Q)\n    # L: supercell edge length in Ångström\n    # q: net charge in units of elementary charge e (dimensionless)\n    # epsilon_r: relative dielectric constant (dimensionless)\n    # Q: second radial moment in units of e·Å^2\n    test_cases = [\n        (10, 1, 12, 5),    # Test case 1\n        (10, 0, 12, 100),  # Test case 2\n        (5, -2, 4, -10),   # Test case 3\n        (30, 1, 1, 0),     # Test case 4\n        (12, 1, 100, 20),  # Test case 5\n    ]\n\n    results = []\n    for L, q, epsilon_r, Q in test_cases:\n        # Avoid division by zero if L or epsilon_r are zero, though not in test cases.\n        if L == 0 or epsilon_r == 0:\n            # Physically, L cannot be 0. epsilon_r=0 is also unphysical.\n            # The energy would diverge. We can represent this as infinity.\n            results.append(np.inf)\n            continue\n            \n        # If the defect is neutral (q=0), the electrostatic correction is zero.\n        if q == 0:\n            results.append(0.0)\n            continue\n\n        # Calculate the L^-1 term (monopole-monopole)\n        e_mm = C1 * (q**2) / (epsilon_r * L)\n\n        # Calculate the L^-3 term (monopole-quadrupole)\n        e_mq = C2 * (q * Q) / (epsilon_r * L**3)\n        \n        # Total correction is the sum of the two terms\n        e_corr = e_mm + e_mq\n        \n        # Round the result to six decimal places as required.\n        # np.round is used for robust rounding.\n        results.append(np.round(e_corr, 6))\n\n    # Format the final output as a comma-separated list in square brackets.\n    # The map ensures all numbers are converted to strings before joining.\n    # The format specifier ensures 6 decimal places.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2813515"}]}