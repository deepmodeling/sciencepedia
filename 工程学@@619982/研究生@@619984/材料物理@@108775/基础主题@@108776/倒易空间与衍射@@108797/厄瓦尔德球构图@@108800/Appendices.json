{"hands_on_practices": [{"introduction": "本练习将抽象的埃瓦尔德球概念与一个具体的实验结果——粉末衍射中的德拜-谢乐环——联系起来。通过从第一性原理出发，您将推导衍射环半径 $R$ 与晶格参数 $a$ 和入射波长 $\\lambda$ 之间的精确关系。这个实践旨在加强您将倒易空间中的矢量关系（[@problem_id:2820326]）转化为可测量的真实空间数据的能力。", "problem": "一束波长为 $\\lambda$ 的单色X射线照射一种立方晶体的细粉末。粉末样品安装在原点，一个平坦的二维探测器放置在样品下游距离为 $L$ 的位置，垂直于入射光束（透射几何）。考虑一个晶格参数为 $a$ 的体心立方（BCC）晶体。探测器上第一个可观测到的德拜-謝乐环对应于最低衍射角的允许晶面族。请仅使用Ewald球构图（波矢大小 $|\\mathbf{k}|=|\\mathbf{k}'|=2\\pi/\\lambda$，弹性散射使得 $\\mathbf{k}'-\\mathbf{k}=\\mathbf{G}_{hkl}$）以及射线与平面相交的几何关系，且不使用任何小角度近似，推导出立方晶格中普遍允许的 $\\{hkl\\}$ 晶面族在探测器上形成的环半径 $R$ 的表达式，该表达式应以 $\\lambda$、$a$、$L$ 以及 $h,k,l$ 表示。然后，应用体心立方选择定则，确定BCC晶格的最低衍射角允许晶面族，并计算相应的 $R$ 的数值。所用参数如下：\n- 波长 $\\lambda=0.500\\,\\text{\\AA}$，\n- 晶格参数 $a=2.8665\\,\\text{\\AA}$，\n- 探测器距离 $L=400.0\\,\\text{mm}$。\n将半径的最终数值结果四舍五入到四位有效数字，并以 $\\text{mm}$ 为单位表示。在最终答案中只陈述半径的数值。", "solution": "基本出发点是波矢大小为 $|\\mathbf{k}|=|\\mathbf{k}'|=2\\pi/\\lambda$ 的波的弹性散射的Ewald球构图。当散射矢量等于一个倒易晶格矢量 $\\mathbf{q}=\\mathbf{k}'-\\mathbf{k}=\\mathbf{G}_{hkl}$ 时，发生衍射。对于弹性散射，$\\mathbf{k}$ 和 $\\mathbf{k}'$ 之间的夹角是 $2\\theta$，其中 $\\theta$ 是布拉格角。根据矢量几何，两个大小相等为 $k$、夹角为 $2\\theta$ 的矢量之差的模长为\n$$\n|\\mathbf{q}|=\\sqrt{k^{2}+k^{2}-2k^{2}\\cos(2\\theta)}=2k\\sin\\theta\n$$\n因此，\n$$\n|\\mathbf{G}_{hkl}|=2k\\sin\\theta=\\frac{4\\pi}{\\lambda}\\sin\\theta\n$$\n对于晶格参数为 $a$ 的立方晶格，其倒易晶格也是立方的，参数为 $2\\pi/a$，$\\mathbf{G}_{hkl}$ 的大小为\n$$\n|\\mathbf{G}_{hkl}|=\\frac{2\\pi}{a}\\sqrt{h^{2}+k^{2}+l^{2}}\n$$\n令两个表达式相等，得到\n$$\n\\frac{2\\pi}{a}\\sqrt{h^{2}+k^{2}+l^{2}}=\\frac{4\\pi}{\\lambda}\\sin\\theta \\;\\;\\Longrightarrow\\;\\; \\sin\\theta=\\frac{\\lambda}{2a}\\sqrt{h^{2}+k^{2}+l^{2}}\n$$\n等价地，使用立方晶体的晶面间距\n$$\nd_{hkl}=\\frac{a}{\\sqrt{h^{2}+k^{2}+l^{2}}}\n$$\n可以得到一级布拉格关系式，\n$$\n\\sin\\theta=\\frac{\\lambda}{2d_{hkl}}\n$$\n接下来，我们将散射角与平面探测器上的环半径联系起来。衍射射线围绕入射光束轴形成一个半角为 $2\\theta$ 的圆锥体。一个偏转角为 $2\\theta$ 的射线与距离轴 $L$ 处垂直于轴的平面相交，其径向距离为\n$$\nR=L\\tan(2\\theta)\n$$\n这个关系可以从基本的直角三角形几何得出：到平面的轴向距离为 $L$，横向偏移为 $R$，且 $\\tan(2\\theta)=R/L$。\n\n结合这些关系，可以得到立方晶体中来自 $\\{hkl\\}$ 晶面族的环半径的一般表达式：\n$$\nR_{hkl}=L\\,\\tan\\!\\Big(2\\,\\arcsin\\!\\Big(\\frac{\\lambda}{2a}\\sqrt{h^{2}+k^{2}+l^{2}}\\Big)\\Big)\n$$\n\n对于体心立方（BCC）晶格，结构因子给出的选择定则是，只有当 $h+k+l$ 为偶数时才会发生反射。最低角度的环对应于满足 $h+k+l$ 为偶数的最小非零 $\\sqrt{h^{2}+k^{2}+l^{2}}$。$(100)$ 晶面族有 $h^{2}+k^{2}+l^{2}=1$，但 $h+k+l=1$ 是奇数，所以是禁戒的。下一个是 $(110)$, 其 $h^{2}+k^{2}+l^{2}=2$ 且 $h+k+l=2$ 为偶数，这是允许的。因此，第一个可观测到的环来自 $\\{110\\}$ 晶面族。\n\n现在我们使用给定的参数 $\\lambda=0.500\\,\\text{\\AA}$、$a=2.8665\\,\\text{\\AA}$ 和 $L=400.0\\,\\text{mm}$ 来数值计算 $R_{110}$。\n\n计算反正弦函数的参数：\n$$\n\\frac{\\lambda}{2a}\\sqrt{h^{2}+k^{2}+l^{2}}=\\frac{0.500}{2\\times 2.8665}\\sqrt{2}\n$$\n首先，$2a=2\\times 2.8665=5.7330$，所以\n$$\n\\frac{0.500}{5.7330}=0.087207\\ldots\n$$\n然后，$\\sqrt{2}=1.41421356\\ldots$，得到\n$$\n\\frac{\\lambda}{2a}\\sqrt{2}=0.087207\\ldots\\times 1.41421356\\ldots=0.123386\\ldots\n$$\n因此，\n$$\n\\theta=\\arcsin(0.123386\\ldots)\\approx 0.123730\\ldots\\ \\text{rad},\n$$\n所以\n$$\n2\\theta\\approx 0.247460\\ldots\\ \\text{rad},\\quad \\tan(2\\theta)\\approx 0.252431\\ldots\n$$\n最后，\n$$\nR_{110}=L\\tan(2\\theta)=400.0\\times 0.252431\\ldots=100.972\\ldots\n$$\n四舍五入到四位有效数字并以 $\\text{mm}$ 表示，环半径为 $101.0\\,\\text{mm}$。", "answer": "$$\\boxed{101.0}$$", "id": "2820326"}, {"introduction": "当我们从X射线转向电子衍射时，尤其是在透射电子显微镜（TEM）中，新的物理效应变得至关重要。本练习探讨了高速电子的相对论效应对埃瓦尔德球半径的影响，这是一个在精确标定衍射花样时不可忽略的因素。通过计算，您将量化非相对论模型与相对论修正模型之间的差异（[@problem_id:2820252]），从而深刻理解在现代材料表征中考虑完整物理图像的重要性。", "problem": "动能为 $T$ 的电子束被用于在透射电子显微镜 (TEM) 中收集衍射图样。在构建用于电子衍射的埃瓦尔德球时，可以使用非相对论性的德布罗意波长或经过相对论修正的波长。在倒易空间的晶体学惯例中（倒易矢量不含因子 $2\\pi$），埃瓦尔德球的半径为 $R = 1/\\lambda$，其中 $\\lambda$ 是电子的德布罗意波长。\n\n仅从基本关系式 $p = h/\\lambda$ (德布罗意关系)、$T = p^{2}/(2m_{e})$ (非相对论性动能) 以及狭义相对论的能量-动量关系 $(pc)^{2} = E^{2} - (m_{e}c^{2})^{2}$（其中 $E = T + m_{e}c^{2}$）出发，完成以下任务：\n\n1. 推导相对论修正波长 $\\lambda_{\\mathrm{rel}}(T)$ 和非相对论性波长 $\\lambda_{\\mathrm{nr}}(T)$ 的显式表达式。\n2. 使用晶体学中的埃瓦尔德球半径 $R = 1/\\lambda$，将由相对论修正引起的半径分数变化表示为\n$$\n\\delta \\equiv \\frac{R_{\\mathrm{rel}} - R_{\\mathrm{nr}}}{R_{\\mathrm{nr}}}\n$$\n3. 对于动能为 $T = 200\\,\\mathrm{keV}$ 的电子，数值计算 $\\delta$ 的值。\n\n将 $\\delta$ 的最终值以无量纲小数的形式报告，并四舍五入到四位有效数字。\n\n根据需要使用以下常数：$h = 6.62607015\\times 10^{-34}\\,\\mathrm{J\\,s}$，$m_{e} = 9.1093837015\\times 10^{-31}\\,\\mathrm{kg}$，$c = 2.99792458\\times 10^{8}\\,\\mathrm{m\\,s^{-1}}$，$e = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$，以及 $m_{e}c^{2} = 511\\,\\mathrm{keV}$。所有中间推理过程均用符号表示；仅在最后对 $\\delta$ 进行数值计算时才使用数字。最终答案必须是方框中的一个无单位的数字。", "solution": "所述问题具有科学依据、内容自洽且提法明确。我们将着手进行推导和计算。\n\n第一个任务是推导非相对论性波长 $\\lambda_{\\mathrm{nr}}(T)$ 和相对论修正波长 $\\lambda_{\\mathrm{rel}}(T)$ 的表达式。\n\n对于非相对论情况，动能 $T$ 与动量 $p_{\\mathrm{nr}}$ 的关系为 $T = \\frac{p_{\\mathrm{nr}}^{2}}{2m_{e}}$。解出动量可得：\n$$p_{\\mathrm{nr}} = \\sqrt{2m_{e}T}$$\n使用德布罗意关系 $\\lambda = \\frac{h}{p}$，我们得到非相对论性波长：\n$$\\lambda_{\\mathrm{nr}}(T) = \\frac{h}{p_{\\mathrm{nr}}} = \\frac{h}{\\sqrt{2m_{e}T}}$$\n\n对于相对论情况，我们使用能量-动量关系 $(p_{\\mathrm{rel}}c)^{2} = E^{2} - (m_{e}c^{2})^{2}$，其中总能量为 $E = T + m_{e}c^{2}$。将 $E$ 的表达式代入该关系式中得到：\n$$(p_{\\mathrm{rel}}c)^{2} = (T + m_{e}c^{2})^{2} - (m_{e}c^{2})^{2}$$\n展开平方项并化简：\n$$(p_{\\mathrm{rel}}c)^{2} = T^{2} + 2Tm_{e}c^{2} + (m_{e}c^{2})^{2} - (m_{e}c^{2})^{2} = T^{2} + 2Tm_{e}c^{2} = T(T + 2m_{e}c^{2})$$\n解出相对论动量 $p_{\\mathrm{rel}}$：\n$$p_{\\mathrm{rel}} = \\frac{\\sqrt{T(T + 2m_{e}c^{2})}}{c}$$\n于是，相对论波长 $\\lambda_{\\mathrm{rel}}$ 由德布罗意关系给出：\n$$\\lambda_{\\mathrm{rel}}(T) = \\frac{h}{p_{\\mathrm{rel}}} = \\frac{hc}{\\sqrt{T(T + 2m_{e}c^{2})}}$$\n\n第二个任务是推导埃瓦尔德球半径的分数变化 $\\delta$ 的表达式。其定义如下：\n$$\\delta \\equiv \\frac{R_{\\mathrm{rel}} - R_{\\mathrm{nr}}}{R_{\\mathrm{nr}}}$$\n使用关系式 $R = 1/\\lambda$，我们可以用波长来表示 $\\delta$：\n$$\\delta = \\frac{1/\\lambda_{\\mathrm{rel}} - 1/\\lambda_{\\mathrm{nr}}}{1/\\lambda_{\\mathrm{nr}}} = \\frac{\\lambda_{\\mathrm{nr}}}{\\lambda_{\\mathrm{rel}}} - 1$$\n波长之比等于相应动量的反比：\n$$\\frac{\\lambda_{\\mathrm{nr}}}{\\lambda_{\\mathrm{rel}}} = \\frac{h/p_{\\mathrm{nr}}}{h/p_{\\mathrm{rel}}} = \\frac{p_{\\mathrm{rel}}}{p_{\\mathrm{nr}}}$$\n代入推导出的 $p_{\\mathrm{rel}}$ 和 $p_{\\mathrm{nr}}$ 的表达式：\n$$\\frac{p_{\\mathrm{rel}}}{p_{\\mathrm{nr}}} = \\frac{\\frac{\\sqrt{T(T + 2m_{e}c^{2})}}{c}}{\\sqrt{2m_{e}T}} = \\frac{1}{c}\\sqrt{\\frac{T(T + 2m_{e}c^{2})}{2m_{e}T}} = \\sqrt{\\frac{T + 2m_{e}c^{2}}{2m_{e}c^{2}}}$$\n进一步化简该表达式：\n$$\\frac{p_{\\mathrm{rel}}}{p_{\\mathrm{nr}}} = \\sqrt{\\frac{T}{2m_{e}c^{2}} + 1}$$\n因此，分数变化 $\\delta$ 由下式给出：\n$$\\delta = \\sqrt{1 + \\frac{T}{2m_{e}c^{2}}} - 1$$\n\n第三个任务是对于电子动能 $T = 200\\,\\mathrm{keV}$ 的情况，数值计算 $\\delta$。给定电子的静止质量能为 $m_{e}c^{2} = 511\\,\\mathrm{keV}$。将这些值代入我们关于 $\\delta$ 的表达式中：\n$$\\delta = \\sqrt{1 + \\frac{200\\,\\mathrm{keV}}{2 \\times 511\\,\\mathrm{keV}}} - 1 = \\sqrt{1 + \\frac{100}{511}} - 1$$\n我们进行数值计算：\n$$\\delta = \\sqrt{\\frac{511 + 100}{511}} - 1 = \\sqrt{\\frac{611}{511}} - 1$$\n$$\\delta \\approx \\sqrt{1.195694716} - 1 \\approx 1.093478265 - 1 = 0.093478265$$\n按要求将结果四舍五入到四位有效数字：\n$$\\delta \\approx 0.09348$$\n这个结果表明，对于一个 $200\\,\\mathrm{keV}$ 的电子，埃瓦尔德球半径的非相对论近似值与真实值相差约 $9.35\\%$。", "answer": "$$\\boxed{0.09348}$$", "id": "2820252"}, {"introduction": "最后一个练习要求您将之前所学的所有概念综合起来，构建一个计算模型来预测劳厄衍射图样。与使用单色辐射的衍射不同，劳厄法使用连续谱的X射线，这为衍射条件带来了新的维度。您将需要编写一个算法，对给定的晶体取向和光谱范围，系统地找出所有满足布拉格定律和背反射几何条件的衍射斑点（[@problem_id:2820258]），这是从理论知识迈向现代计算衍射学的重要一步。", "problem": "给定一个晶格常数为 $a$（以埃, $\\text{\\AA}$ 为单位）的简单立方晶体，一个在实验室坐标系下的单位入射束方向 $\\mathbf{s}_0$，一个由 $3\\times 3$ 旋转矩阵 $\\mathbf{R}$（该矩阵将晶体坐标系中的矢量映射到实验室坐标系中）给出的晶体取向，以及一个多色光束的光谱范围 $[\\lambda_{\\min},\\lambda_{\\max}]$（以 $\\text{\\AA}$ 为单位）。您必须确定在一个有界搜索集中，哪些整数密勒指数 $(h,k,l)$ 会产生劳厄背反射，并以列表 $[h,k,l]$ 的形式报告它们。\n\n基本原理与约束条件：\n1. 在劳厄几何中使用弹性运动学衍射。入射波矢和衍射波矢满足 $\\mathbf{k}' - \\mathbf{k}_0 = \\mathbf{G}$ 和 $\\lvert \\mathbf{k}' \\rvert = \\lvert \\mathbf{k}_0 \\rvert$，其中 $\\mathbf{k}_0 = \\dfrac{2\\pi}{\\lambda}\\mathbf{s}_0$，$\\lambda$ 是波长。\n2. 对于简单立方晶格，在晶体坐标系中，密勒指数为 $(h,k,l)$ 的倒格子矢量是 $\\mathbf{G}_{\\text{crystal}} = h\\mathbf{b}_1 + k\\mathbf{b}_2 + l\\mathbf{b}_3$，其中 $\\mathbf{b}_1 = \\dfrac{2\\pi}{a}\\hat{\\mathbf{x}}$，$\\mathbf{b}_2 = \\dfrac{2\\pi}{a}\\hat{\\mathbf{y}}$，$\\mathbf{b}_3 = \\dfrac{2\\pi}{a}\\hat{\\mathbf{z}}$。在实验室坐标系中的矢量是 $\\mathbf{G} = \\mathbf{R}\\mathbf{G}_{\\text{crystal}}$。\n3. 弹性散射条件意味着埃瓦尔德球条件 $(\\mathbf{k}_0 + \\mathbf{G})\\cdot(\\mathbf{k}_0 + \\mathbf{G}) = \\mathbf{k}_0\\cdot\\mathbf{k}_0$，这产生了一个关联 $\\lambda$ 和 $\\mathbf{G}$ 的标量方程。求解此方程得到 $\\lambda$，可以确定给定的 $(h,k,l)$ 是否被激发以及所需的波长。\n4. 背反射的定义是衍射束出现在相对于 $\\mathbf{s}_0$ 的背半球中，即 $\\mathbf{s}_0\\cdot \\mathbf{k}' < 0$。\n\n您的程序必须：\n- 枚举所有满足 $-H \\le h,k,l \\le H$ 且 $(h,k,l) \\ne (0,0,0)$ 的整数三元组 $(h,k,l)$。对每一个三元组，计算 $\\mathbf{G}$，然后计算所需的波长 $\\lambda$（如果为实数且为正），接着检查是否满足 $\\lambda \\in [\\lambda_{\\min},\\lambda_{\\max}]$。如果满足，则计算该 $\\lambda$ 对应的 $\\mathbf{k}' = \\mathbf{k}_0 + \\mathbf{G}$，并且当且仅当 $\\mathbf{s}_0\\cdot \\mathbf{k}' < 0$ 时，接受 $(h,k,l)$。\n- 在 $\\mathbb{R}^3$ 中使用欧几里得内积。\n- 所有长度均以 $\\text{\\AA}$ 为单位处理，角度通过给定的旋转矩阵隐式处理。入射束方向 $\\mathbf{s}_0$ 必须是单位矢量。\n- 为确保数值稳健性，当 $\\mathbf{s}_0\\cdot \\mathbf{G}$ 在 $10^{-12}$ 的容差范围内为零时，应拒绝该情况，因为在这种极限下没有有限的 $\\lambda$ 能满足埃瓦尔德条件。此外，处理背反射检查 $\\mathbf{s}_0\\cdot \\mathbf{k}' < 0$ 时，应使用严格不等式并设置 $10^{-12}$ 的容差。\n\n您必须实现的推导起点：\n- 满足 $\\mathbf{k}'-\\mathbf{k}_0=\\mathbf{G}$ 和 $\\lvert \\mathbf{k}'\\rvert = \\lvert \\mathbf{k}_0\\rvert$ 的弹性散射。\n- 简单立方晶格的倒易空间定义。\n\n对每个 $(h,k,l)$ 需要实现的算法步骤：\n- 计算 $\\mathbf{G} = \\mathbf{R}\\left(\\dfrac{2\\pi}{a}[h,k,l]^T\\right)$。\n- 通过 $(\\mathbf{k}_0+\\mathbf{G})^2=\\mathbf{k}_0^2$ 和 $\\mathbf{k}_0=\\dfrac{2\\pi}{\\lambda}\\mathbf{s}_0$ 所蕴含的埃瓦尔德条件求解 $\\lambda$，若 $\\mathbf{s}_0\\cdot \\mathbf{G} \\ne 0$，则会得到唯一的 $\\lambda$。\n- 检查 $\\lambda \\in [\\lambda_{\\min},\\lambda_{\\max}]$，然后计算 $\\mathbf{k}'$ 并验证 $\\mathbf{s}_0\\cdot \\mathbf{k}' < 0$。\n\n报告格式：\n- 对于每个测试用例，将接受的 $(h,k,l)$ 作为整数三元组列表 $[h,k,l]$ 输出，并按 $(h,k,l)$ 的升序字典序排序。\n- 最终输出必须是单行，包含一个列表，每个元素对应一个测试用例，格式必须完全符合：一个由方括号括起来的逗号分隔列表，其中每个测试用例的结果本身就是一个包含 $[h,k,l]$ 项的列表（例如，`[[[h1,k1,l1],[h2,k2,l2]],[],[[...]],...]`）。\n\n使用以下测试套件。$a$、$\\lambda_{\\min}$ 和 $\\lambda_{\\max}$ 的单位是 $\\text{\\AA}$。所有用例的入射方向均为 $\\mathbf{s}_0=[0,0,1]^T$。搜索边界为所列出的 $H$。\n\n- 测试用例 1 (一般情况)：\n  - $a = 3.6$\n  - $\\mathbf{R} = \\begin{bmatrix}1&0&0\\\\0&1&0\\\\0&0&1\\end{bmatrix}$\n  - $[\\lambda_{\\min},\\lambda_{\\max}] = [0.5, 2.5]$\n  - $H = 3$\n- 测试用例 2 (倾斜晶体)：\n  - $a = 3.6$\n  - $\\mathbf{R} = \\begin{bmatrix}1&0&0\\\\0&\\cos\\theta&-\\sin\\theta\\\\0&\\sin\\theta&\\cos\\theta\\end{bmatrix}$ 其中 $\\theta = 35^\\circ$，由数值 $\\cos\\theta \\approx 0.8191520442889918$ 和 $\\sin\\theta \\approx 0.5735764363510462$ 表示\n  - $[\\lambda_{\\min},\\lambda_{\\max}] = [0.8, 2.2]$\n  - $H = 3$\n- 测试用例 3 (窄光谱，可能无解)：\n  - $a = 3.6$\n  - $\\mathbf{R} = \\begin{bmatrix}\\cos\\phi&0&\\sin\\phi\\\\0&1&0\\\\-\\sin\\phi&0&\\cos\\phi\\end{bmatrix}$ 其中 $\\phi = 60^\\circ$，由数值 $\\cos\\phi = 0.5$ 和 $\\sin\\phi \\approx 0.8660254037844386$ 表示\n  - $[\\lambda_{\\min},\\lambda_{\\max}] = [0.5, 0.6]$\n  - $H = 3$\n- 测试用例 4 (边界波长恰好等于某些反射所需的值)：\n  - $a = 3.6$\n  - $\\mathbf{R} = \\begin{bmatrix}1&0&0\\\\0&1&0\\\\0&0&1\\end{bmatrix}$\n  - $[\\lambda_{\\min},\\lambda_{\\max}] = [2.4, 2.4]$\n  - $H = 3$\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个条目对应一个测试用例，并且其本身是按字典序排列的 $[h,k,l]$ 三元组列表。角度隐含在数值旋转矩阵中；输入无需角度单位。所有物理量都必须以 $\\text{\\AA}$ 为单位处理，且程序不得要求任何用户交互。", "solution": "所述问题是有效的。这是计算材料物理学中一个定义明确的练习，其基础是成熟的X射线运动学衍射理论原理。所有必要的参数都已提供，目标明确。我们将进行严格的推导和算法实现。\n\n该问题要求我们对于给定的晶体结构、取向和多色X射线源，确定由密勒指数 $(h,k,l)$ 索引的哪些倒格点会产生劳厄背反射。其物理基础是 von Laue 的相长干涉条件和弹性散射中的能量守恒。\n\n衍射的基本方程是劳厄条件，它指出散射波的波矢变化必须等于一个倒格子矢量 $\\mathbf{G}$：\n$$ \\mathbf{k}' - \\mathbf{k}_0 = \\mathbf{G} $$\n此处，$\\mathbf{k}_0$ 是入射波矢，$\\mathbf{k}'$ 是衍射波矢。对于弹性散射，光子的能量是守恒的，这意味着其波长 $\\lambda$ 以及其波矢的模长保持不变：\n$$ |\\mathbf{k}'| = |\\mathbf{k}_0| = \\frac{2\\pi}{\\lambda} $$\n将 $\\mathbf{k}' = \\mathbf{k}_0 + \\mathbf{G}$ 代入弹性散射条件，得到埃瓦尔德球方程：\n$$ (\\mathbf{k}_0 + \\mathbf{G}) \\cdot (\\mathbf{k}_0 + \\mathbf{G}) = \\mathbf{k}_0 \\cdot \\mathbf{k}_0 $$\n展开点积，我们得到：\n$$ |\\mathbf{k}_0|^2 + 2\\mathbf{k}_0 \\cdot \\mathbf{G} + |\\mathbf{G}|^2 = |\\mathbf{k}_0|^2 $$\n这简化为关于 $\\mathbf{k}_0$ 和 $\\mathbf{G}$ 的一个条件：\n$$ 2\\mathbf{k}_0 \\cdot \\mathbf{G} + |\\mathbf{G}|^2 = 0 $$\n入射波矢 $\\mathbf{k}_0$ 由其方向（单位矢量 $\\mathbf{s}_0$）和波长 $\\lambda$ 定义：$\\mathbf{k}_0 = \\frac{2\\pi}{\\lambda}\\mathbf{s}_0$。将其代入埃瓦尔德球方程，我们就可以求解出对于给定的倒格子矢量 $\\mathbf{G}$，能够激发一个衍射斑的特定波长 $\\lambda$：\n$$ 2\\left(\\frac{2\\pi}{\\lambda}\\mathbf{s}_0\\right) \\cdot \\mathbf{G} + |\\mathbf{G}|^2 = 0 $$\n$$ \\frac{4\\pi}{\\lambda}(\\mathbf{s}_0 \\cdot \\mathbf{G}) = -|\\mathbf{G}|^2 $$\n求解 $\\lambda$ 可得：\n$$ \\lambda = -\\frac{4\\pi(\\mathbf{s}_0 \\cdot \\mathbf{G})}{|\\mathbf{G}|^2} $$\n为了得到有物理意义的解，波长 $\\lambda$ 必须是实数且为正。由于 $|\\mathbf{G}|^2$ 总是非负的（对于 $(h,k,l) \\neq (0,0,0)$ 严格为正），这意味着我们必须有 $\\mathbf{s}_0 \\cdot \\mathbf{G} < 0$。问题还要求我们拒绝 $\\mathbf{s}_0 \\cdot \\mathbf{G}$ 在数值上接近零的情况，特别是 $|\\mathbf{s}_0 \\cdot \\mathbf{G}| \\le 10^{-12}$，以避免除以一个很小的数。\n\n倒格子矢量 $\\mathbf{G}$ 取决于密勒指数 $(h,k,l)$、晶体结构及其取向。对于给定的晶格常数为 $a$ 的简单立方晶格，其在晶体坐标系中的倒格子基矢为 $\\mathbf{b}_1 = \\frac{2\\pi}{a}\\hat{\\mathbf{x}}$，$\\mathbf{b}_2 = \\frac{2\\pi}{a}\\hat{\\mathbf{y}}$ 和 $\\mathbf{b}_3 = \\frac{2\\pi}{a}\\hat{\\mathbf{z}}$。在晶体坐标系中，指数为 $(h,k,l)$ 的倒格子矢量是：\n$$ \\mathbf{G}_{\\text{crystal}} = h\\mathbf{b}_1 + k\\mathbf{b}_2 + l\\mathbf{b}_3 = \\frac{2\\pi}{a} \\begin{pmatrix} h \\\\ k \\\\ l \\end{pmatrix} $$\n为了得到在实验室坐标系中的矢量，我们应用给定的旋转矩阵 $\\mathbf{R}$：\n$$ \\mathbf{G} = \\mathbf{R} \\mathbf{G}_{\\text{crystal}} = \\frac{2\\pi}{a} \\mathbf{R} \\begin{pmatrix} h \\\\ k \\\\ l \\end{pmatrix} $$\n$\\mathbf{G}$ 的模长的平方为 $|\\mathbf{G}|^2 = \\mathbf{G} \\cdot \\mathbf{G}$。由于 $\\mathbf{R}$ 是一个旋转矩阵，它是正交的（$\\mathbf{R}^T\\mathbf{R} = \\mathbf{I}$），因此它保持矢量长度不变。所以，$|\\mathbf{G}|^2 = |\\mathbf{G}_{\\text{crystal}}|^2 = (\\frac{2\\pi}{a})^2(h^2+k^2+l^2)$。\n\n最后一个条件是背反射。衍射束必须出现在与入射束方向 $\\mathbf{s}_0$ 相反的半球中。在数学上，这表示为：\n$$ \\mathbf{s}_0 \\cdot \\mathbf{k}' < 0 $$\n利用 $\\mathbf{k}' = \\mathbf{k}_0 + \\mathbf{G} = \\frac{2\\pi}{\\lambda}\\mathbf{s}_0 + \\mathbf{G}$ 以及 $\\mathbf{s}_0$ 是单位矢量（$|\\mathbf{s}_0|=1$）这一事实，该条件变为：\n$$ \\mathbf{s}_0 \\cdot \\left(\\frac{2\\pi}{\\lambda}\\mathbf{s}_0 + \\mathbf{G}\\right) = \\frac{2\\pi}{\\lambda}(\\mathbf{s}_0 \\cdot \\mathbf{s}_0) + \\mathbf{s}_0 \\cdot \\mathbf{G} = \\frac{2\\pi}{\\lambda} + \\mathbf{s}_0 \\cdot \\mathbf{G} < 0 $$\n检查此不等式时必须使用 $10^{-12}$ 的数值容差，即 $\\frac{2\\pi}{\\lambda} + \\mathbf{s}_0 \\cdot \\mathbf{G} < -10^{-12}$。\n\n每个测试用例的完整算法如下：\n1. 初始化一个空列表，用于存放有效的密勒指数。\n2. 遍历所有满足 $h,k,l \\in [-H, H]$ 的整数三元组 $(h,k,l)$，排除平凡情况 $(0,0,0)$。\n3. 对每个三元组 $(h,k,l)$，构造矢量 $\\mathbf{g}_{hkl} = [h,k,l]^T$。\n4. 计算实验室坐标系中的倒格子矢量：$\\mathbf{G} = \\frac{2\\pi}{a} \\mathbf{R}\\mathbf{g}_{hkl}$。\n5. 计算点积 $S_G = \\mathbf{s}_0 \\cdot \\mathbf{G}$。\n6. 验证 $|S_G| > 10^{-12}$。如果不满足，则拒绝此三元组。\n7. 计算模长的平方 $G2 = \\mathbf{G} \\cdot \\mathbf{G}$。\n8. 计算所需波长 $\\lambda = -4\\pi S_G / G2$。\n9. 检查该波长是否在指定的光谱范围内：$\\lambda \\in [\\lambda_{\\min}, \\lambda_{\\max}]$。请注意，要使 $\\lambda$ 为正，隐含要求 $S_G < 0$。\n10. 如果波长在范围内，检查背反射条件：$\\frac{2\\pi}{\\lambda} + S_G < -10^{-12}$。\n11. 如果所有条件都满足，则三元组 $(h,k,l)$ 是一个有效的背反射，并将其添加到列表中。\n12. 检查完所有三元组后，按字典序对有效指数列表进行排序。\n此过程将应用于每个测试用例，以生成最终结果。", "answer": "```python\nimport numpy as np\n\ndef list_to_string_no_spaces(data):\n    \"\"\"\n    Recursively converts a list to a string representation without spaces,\n    as implicitly required by the problem's output format example.\n    \"\"\"\n    if isinstance(data, list):\n        return f\"[{','.join([list_to_string_no_spaces(x) for x in data])}]\"\n    return str(data)\n\ndef find_reflections(a, R, lambda_min, lambda_max, H, s0):\n    \"\"\"\n    Finds Miller indices (h,k,l) that produce Laue back-reflections.\n\n    Args:\n        a (float): Lattice parameter in Angstroms.\n        R (np.ndarray): 3x3 rotation matrix.\n        lambda_min (float): Minimum wavelength in Angstroms.\n        lambda_max (float): Maximum wavelength in Angstroms.\n        H (int): Search bound for Miller indices.\n        s0 (np.ndarray): Unit vector for incident beam direction.\n\n    Returns:\n        list: A sorted list of [h,k,l] triplets that satisfy the conditions.\n    \"\"\"\n    valid_hkl = []\n    tol = 1e-12\n\n    # Iterate through all Miller indices within the search bound H\n    for h in range(-H, H + 1):\n        for k in range(-H, H + 1):\n            for l in range(-H, H + 1):\n                # Exclude the (0,0,0) reflection\n                if h == 0 and k == 0 and l == 0:\n                    continue\n\n                g_crystal = np.array([h, k, l], dtype=np.float64)\n\n                # 1. Compute reciprocal lattice vector G in the lab frame\n                G = (2 * np.pi / a) * (R @ g_crystal)\n\n                # 2. Compute the dot product s0 . G\n                s0_dot_G = np.dot(s0, G)\n\n                # 3. Apply numerical stability check\n                if abs(s0_dot_G) <= tol:\n                    continue\n\n                # 4. Compute G squared\n                G_squared = np.dot(G, G)\n\n                # 5. Solve for wavelength lambda\n                lamb = -4 * np.pi * s0_dot_G / G_squared\n                \n                # 6. Check if lambda is within the specified spectral range.\n                # A positive lambda implies s0_dot_G must be negative.\n                if not (lambda_min <= lamb <= lambda_max):\n                    continue\n                \n                # 7. Check the back-reflection condition\n                s0_dot_k_prime = (2 * np.pi / lamb) + s0_dot_G\n                if s0_dot_k_prime < -tol:\n                    valid_hkl.append([h, k, l])\n\n    # 8. Sort the results lexicographically\n    valid_hkl.sort()\n    return valid_hkl\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    s0 = np.array([0, 0, 1], dtype=np.float64)\n    \n    # Define test cases from the problem statement\n    test_cases = [\n        {\n            \"a\": 3.6,\n            \"R\": np.identity(3, dtype=np.float64),\n            \"lambda_range\": [0.5, 2.5],\n            \"H\": 3\n        },\n        {\n            \"a\": 3.6,\n            \"R\": np.array([\n                [1, 0, 0],\n                [0, 0.8191520442889918, -0.5735764363510462],\n                [0, 0.5735764363510462, 0.8191520442889918]\n            ], dtype=np.float64),\n            \"lambda_range\": [0.8, 2.2],\n            \"H\": 3\n        },\n        {\n            \"a\": 3.6,\n            \"R\": np.array([\n                [0.5, 0, 0.8660254037844386],\n                [0, 1, 0],\n                [-0.8660254037844386, 0, 0.5]\n            ], dtype=np.float64),\n            \"lambda_range\": [0.5, 0.6],\n            \"H\": 3\n        },\n        {\n            \"a\": 3.6,\n            \"R\": np.identity(3, dtype=np.float64),\n            \"lambda_range\": [2.4, 2.4],\n            \"H\": 3\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = find_reflections(\n            case[\"a\"],\n            case[\"R\"],\n            case[\"lambda_range\"][0],\n            case[\"lambda_range\"][1],\n            case[\"H\"],\n            s0\n        )\n        results.append(result)\n\n    # Format the final output string to remove spaces inside lists\n    final_output_string = list_to_string_no_spaces(results)\n    print(final_output_string)\n\nsolve()\n```", "id": "2820258"}]}