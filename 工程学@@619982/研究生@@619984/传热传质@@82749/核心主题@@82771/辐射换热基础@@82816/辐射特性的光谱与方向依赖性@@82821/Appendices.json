{"hands_on_practices": [{"introduction": "真实世界中的辐射探测器（如辐射计）所测量的信号，并非来自单一方向，而是其视场内所有方向辐射强度的积分。本练习旨在帮助你将这一概念形式化。通过从一个给定的、具有各向异性的方向光谱发射率模型出发，你将推导出一个圆锥形视场探测器所测量的“表观”发射率[@problem_id:2524153]。这项实践将巩固你对辐射强度、立体角积分等基本定义的理解，并锻炼你在球坐标系下处理复杂积分的分析能力。", "problem": "一个温度为 $T$ 的不透明等温固体表面，其热辐射同时表现出光谱依赖性和方向依赖性。在每个波长 $\\lambda$ 处，其辐射亮度意义上的方向光谱发射率（即方向光谱强度发射率）由以下模型描述：\n$$\n\\varepsilon^{I}_{\\lambda}(\\theta,\\phi) \\;=\\; \\varepsilon_{0}(\\lambda)\\,\\bigl[1 + a(\\lambda)\\,\\cos^{2}\\theta\\bigr]\\,\\bigl[1 + b\\,\\cos(2\\phi)\\,\\sin^{2}\\theta\\bigr],\n$$\n其中，$(\\theta,\\phi)$ 分别是相对于表面法线和一固定面内参考方向测量的极角和方位角，$\\varepsilon_{0}(\\lambda)\\in[0,1]$ 是一个基线光谱因子，$a(\\lambda)$ 是极向的有界光谱各向异性系数，$b$ 是一个有界的方位角各向异性系数。假设参数满足对于所有 $\\theta\\in[0,\\pi/2]$ 和 $\\phi\\in[0,2\\pi)$，都有 $0 \\le \\varepsilon^{I}_{\\lambda}(\\theta,\\phi) \\le 1$。\n\n请仅从光谱强度、光谱发射功率、黑体辐射和立体角积分的基本定义出发，为一个理想的窄带辐射计所测量的锥场表观光谱发射率 $\\varepsilon_{app,\\lambda}(\\theta_{c})$ 推导一个闭式解析表达式。该辐射计的中心波长为 $\\lambda$，它收集从表面发出、并位于围绕表面法线、半角为 $\\theta_{c}$ 的正圆锥视场内的所有辐射通量。探测器的信号正比于其收集立体角内的辐射出射度，即光谱强度在该锥形立体角上按余弦投影因子加权的积分。将表观光谱发射率定义为该信号与从同温度 $T$ 的黑体获得的相应信号之比。取立体角元为 $\\mathrm{d}\\Omega = \\sin\\theta\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$。将最终答案表示为 $\\varepsilon_{0}(\\lambda)$、$a(\\lambda)$、$b$ 和 $\\theta_{c}$ 的简化函数，其中 $\\theta_{c}$ 以弧度为单位。最终答案必须是单个闭式解析表达式。不要提供中间结果。", "solution": "问题陈述已经过验证，被认为具有科学依据、问题适定且客观。这是一个辐射传热领域的规范性问题，内容自洽，没有矛盾或歧义。它要求从基本定义和给定的数学模型出发推导一个物理量，这是理论物理和工程学中的标准步骤。因此，下面将给出解答。\n\n该问题要求推导锥场表观光谱发射率 $\\varepsilon_{app,\\lambda}(\\theta_{c})$。根据定义，它是探测器从给定表面收集的辐射通量与在相同锥形视场内从相同温度 $T$ 的黑体收集的通量之比。\n\n探测器收集的辐射通量（或“信号”）正比于锥形辐射出射度，即光谱强度 $I_{\\lambda,e}$ 在收集立体角 $\\Omega_c$ 上按极角余弦 $\\cos\\theta$ 加权的积分。对于给定表面，收集到的通量 $S_{\\lambda}$ 正比于\n$$\nS_{\\lambda} \\propto \\int_{\\Omega_c} I_{\\lambda,e}(\\theta, \\phi) \\cos\\theta \\, \\mathrm{d}\\Omega\n$$\n发射体的光谱强度定义为其方向光谱发射率 $\\varepsilon^{I}_{\\lambda}(\\theta,\\phi)$ 与同温度下黑体光谱强度 $I_{b,\\lambda}(T)$ 的乘积。黑体强度是各向同性的（与方向无关）。\n$$\nI_{\\lambda,e}(\\theta, \\phi) = \\varepsilon^{I}_{\\lambda}(\\theta,\\phi) \\, I_{b,\\lambda}(T)\n$$\n因此，来自表面的信号正比于\n$$\nS_{\\lambda} \\propto I_{b,\\lambda}(T) \\int_{\\Omega_c} \\varepsilon^{I}_{\\lambda}(\\theta,\\phi) \\cos\\theta \\, \\mathrm{d}\\Omega\n$$\n对于黑体表面，发射率为1，即 $\\varepsilon^{I}_{\\lambda}(\\theta,\\phi) = 1$。因此，来自黑体的信号 $S_{b,\\lambda}$ 正比于\n$$\nS_{b,\\lambda} \\propto I_{b,\\lambda}(T) \\int_{\\Omega_c} (1) \\cos\\theta \\, \\mathrm{d}\\Omega\n$$\n表观光谱发射率 $\\varepsilon_{app,\\lambda}(\\theta_{c})$ 是这两个信号的比值。比例常数和黑体强度 $I_{b,\\lambda}(T)$ 会被消去。\n$$\n\\varepsilon_{app,\\lambda}(\\theta_{c}) = \\frac{ S_{\\lambda} }{ S_{b,\\lambda} } = \\frac{\\int_{\\Omega_c} \\varepsilon^{I}_{\\lambda}(\\theta,\\phi) \\cos\\theta \\, \\mathrm{d}\\Omega}{\\int_{\\Omega_c} \\cos\\theta \\, \\mathrm{d}\\Omega}\n$$\n积分在半角为 $\\theta_c$ 的正圆锥区域上进行。立体角元给定为 $\\mathrm{d}\\Omega = \\sin\\theta\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$。积分限为 $\\theta \\in [0, \\theta_c]$ 和 $\\phi \\in [0, 2\\pi]$。\n\n首先，我们计算分母中的积分，记为 $D$。\n$$\nD = \\int_{0}^{2\\pi} \\int_{0}^{\\theta_c} \\cos\\theta \\sin\\theta \\, \\mathrm{d}\\theta \\, \\mathrm{d}\\phi\n$$\n关于 $\\phi$ 的积分结果为 $2\\pi$。关于 $\\theta$ 的积分为\n$$\n\\int_{0}^{\\theta_c} \\sin\\theta \\cos\\theta \\, \\mathrm{d}\\theta = \\frac{1}{2} \\int_{0}^{\\theta_c} \\sin(2\\theta) \\, \\mathrm{d}\\theta = \\frac{1}{2} \\left[ -\\frac{\\cos(2\\theta)}{2} \\right]_{0}^{\\theta_c} = \\frac{1}{4} (1 - \\cos(2\\theta_c)) = \\frac{1}{4} (1 - (1 - 2\\sin^2\\theta_c)) = \\frac{1}{2}\\sin^2\\theta_c\n$$\n或者，使用换元法 $u=\\sin\\theta$, $\\mathrm{d}u=\\cos\\theta\\,\\mathrm{d}\\theta$：\n$$\n\\int_{0}^{\\sin\\theta_c} u\\,\\mathrm{d}u = \\left[\\frac{u^2}{2}\\right]_{0}^{\\sin\\theta_c} = \\frac{1}{2}\\sin^2\\theta_c\n$$\n因此，分母为 $D = 2\\pi \\cdot \\frac{1}{2}\\sin^2\\theta_c = \\pi\\sin^2\\theta_c$。\n\n接下来，我们计算分子中的积分，记为 $N$。\n$$\nN = \\int_{0}^{2\\pi} \\int_{0}^{\\theta_c} \\varepsilon^{I}_{\\lambda}(\\theta,\\phi) \\cos\\theta \\sin\\theta \\, \\mathrm{d}\\theta \\, \\mathrm{d}\\phi\n$$\n代入给定的 $\\varepsilon^{I}_{\\lambda}(\\theta,\\phi)$ 表达式：\n$$\nN = \\int_{0}^{2\\pi} \\int_{0}^{\\theta_c} \\varepsilon_{0}(\\lambda)\\,\\bigl[1 + a(\\lambda)\\,\\cos^{2}\\theta\\bigr]\\,\\bigl[1 + b\\,\\cos(2\\phi)\\,\\sin^{2}\\theta\\bigr] \\cos\\theta \\sin\\theta \\, \\mathrm{d}\\theta \\, \\mathrm{d}\\phi\n$$\n我们展开被积函数：\n$$\n\\varepsilon^{I}_{\\lambda}(\\theta,\\phi) = \\varepsilon_{0}(\\lambda) \\left[ 1 + a(\\lambda)\\cos^2\\theta + b\\cos(2\\phi)\\sin^2\\theta + a(\\lambda)b\\cos(2\\phi)\\sin^2\\theta\\cos^2\\theta \\right]\n$$\n积分 $N$ 可以分成四项。我们可以将常数 $\\varepsilon_{0}(\\lambda)$ 提到积分外面。\n$$\nN = \\varepsilon_{0}(\\lambda) \\int_{0}^{2\\pi} \\int_{0}^{\\theta_c} \\left( \\sin\\theta\\cos\\theta + a(\\lambda)\\sin\\theta\\cos^3\\theta + b\\cos(2\\phi)\\sin^3\\theta\\cos\\theta + a(\\lambda)b\\cos(2\\phi)\\sin^3\\theta\\cos^3\\theta \\right) \\mathrm{d}\\theta\\,\\mathrm{d}\\phi\n$$\n对于任何包含 $\\cos(2\\phi)$ 的项，其在 $\\phi$ 上从 $0$ 到 $2\\pi$ 的积分为零：\n$$\n\\int_{0}^{2\\pi} \\cos(2\\phi) \\, \\mathrm{d}\\phi = \\left[ \\frac{1}{2}\\sin(2\\phi) \\right]_{0}^{2\\pi} = 0\n$$\n因此，被积函数的第三项和第四项对总积分的贡献为零。由于积分域的轴对称性，方位角各向异性系数 $b$ 不会出现在最终结果中。$N$ 的表达式简化为：\n$$\nN = \\varepsilon_{0}(\\lambda) \\int_{0}^{2\\pi} \\int_{0}^{\\theta_c} \\left( \\sin\\theta\\cos\\theta + a(\\lambda)\\sin\\theta\\cos^3\\theta \\right) \\mathrm{d}\\theta\\,\\mathrm{d}\\phi\n$$\n这是两个积分的和。第一部分是：\n$$\nI_1 = \\varepsilon_{0}(\\lambda) \\int_{0}^{2\\pi} \\int_{0}^{\\theta_c} \\sin\\theta\\cos\\theta \\, \\mathrm{d}\\theta\\,\\mathrm{d}\\phi = \\varepsilon_{0}(\\lambda) \\cdot (\\pi\\sin^2\\theta_c)\n$$\n第二部分是：\n$$\nI_2 = \\varepsilon_{0}(\\lambda) a(\\lambda) \\int_{0}^{2\\pi} \\int_{0}^{\\theta_c} \\sin\\theta\\cos^3\\theta \\, \\mathrm{d}\\theta\\,\\mathrm{d}\\phi\n$$\n关于 $\\phi$ 的积分是 $2\\pi$。关于 $\\theta$ 的积分通过换元 $u=\\cos\\theta$，$ \\mathrm{d}u=-\\sin\\theta\\,\\mathrm{d}\\theta$ 求解：\n$$\n\\int_{0}^{\\theta_c} \\sin\\theta\\cos^3\\theta\\,\\mathrm{d}\\theta = \\int_{\\cos(0)}^{\\cos(\\theta_c)} -u^3\\,\\mathrm{d}u = -\\left[\\frac{u^4}{4}\\right]_{1}^{\\cos\\theta_c} = -\\left(\\frac{\\cos^4\\theta_c}{4} - \\frac{1}{4}\\right) = \\frac{1}{4}(1-\\cos^4\\theta_c)\n$$\n所以，$I_2 = \\varepsilon_{0}(\\lambda) a(\\lambda) \\cdot 2\\pi \\cdot \\frac{1}{4}(1-\\cos^4\\theta_c) = \\varepsilon_{0}(\\lambda) \\frac{\\pi a(\\lambda)}{2}(1-\\cos^4\\theta_c)$。\n分子为 $N = I_1 + I_2 = \\varepsilon_{0}(\\lambda)\\pi\\sin^2\\theta_c + \\varepsilon_{0}(\\lambda) \\frac{\\pi a(\\lambda)}{2}(1-\\cos^4\\theta_c)$。\n\n现在我们计算比值 $\\varepsilon_{app,\\lambda}(\\theta_{c}) = N/D$：\n$$\n\\varepsilon_{app,\\lambda}(\\theta_{c}) = \\frac{\\varepsilon_{0}(\\lambda)\\pi\\sin^2\\theta_c + \\varepsilon_{0}(\\lambda) \\frac{\\pi a(\\lambda)}{2}(1-\\cos^4\\theta_c)}{\\pi\\sin^2\\theta_c}\n$$\n消去 $\\pi$ 并提出公因子 $\\varepsilon_{0}(\\lambda)$：\n$$\n\\varepsilon_{app,\\lambda}(\\theta_{c}) = \\varepsilon_{0}(\\lambda) \\left( \\frac{\\sin^2\\theta_c}{\\sin^2\\theta_c} + \\frac{a(\\lambda)}{2} \\frac{1-\\cos^4\\theta_c}{\\sin^2\\theta_c} \\right) = \\varepsilon_{0}(\\lambda) \\left( 1 + \\frac{a(\\lambda)}{2} \\frac{1-\\cos^4\\theta_c}{\\sin^2\\theta_c} \\right)\n$$\n我们使用恒等式 $1-\\cos^4\\theta_c = (1-\\cos^2\\theta_c)(1+\\cos^2\\theta_c) = \\sin^2\\theta_c(1+\\cos^2\\theta_c)$ 来简化分数。\n$$\n\\frac{1-\\cos^4\\theta_c}{\\sin^2\\theta_c} = \\frac{\\sin^2\\theta_c(1+\\cos^2\\theta_c)}{\\sin^2\\theta_c} = 1+\\cos^2\\theta_c\n$$\n将此代回 $\\varepsilon_{app,\\lambda}(\\theta_{c})$ 的表达式，便得到最终的闭式结果。\n$$\n\\varepsilon_{app,\\lambda}(\\theta_{c}) = \\varepsilon_{0}(\\lambda) \\left[ 1 + \\frac{a(\\lambda)}{2} (1 + \\cos^2\\theta_c) \\right]\n$$\n这就是所要求的关于 $\\varepsilon_{0}(\\lambda)$、$a(\\lambda)$ 和 $\\theta_{c}$ 的简化函数。", "answer": "$$\n\\boxed{\\varepsilon_{0}(\\lambda) \\left[1 + \\frac{a(\\lambda)}{2} \\left(1 + \\cos^{2}\\theta_{c}\\right)\\right]}\n$$", "id": "2524153"}, {"introduction": "在辐射传热的工程应用中，我们常常需要用数学模型来描述表面的反射特性，而双向反射分布函数（BRDF）是描述这一特性的最基本物理量。然而，这些解析模型通常包含必须通过实验测量来确定的未知参数。本练习将引导你从一个给定的BRDF模型出发，推导其与可测量的方向-半球反射率之间的关系，并利用该关系通过一个实验数据点来标定模型中的关键系数[@problem_id:2524141]。这个过程完美地体现了理论模型与实验实践相结合解决工程问题的核心思想。", "problem": "波长为 $\\lambda$ 的双向散射分布函数 (BSDF) 由双向反射分布函数 (BRDF) $f_{r,\\lambda}$ 和双向透射分布函数 (BTDF) $f_{t,\\lambda}$ 组成。对于一个不透明、非自发光、宏观光滑但微观粗糙的表面，BTDF 为零，因此 BSDF 简化为 BRDF。考虑以下方位各向异性、互易的光谱 BRDF 模型：\n$$\nf_{r,\\lambda}\\!\\left(\\theta_{i},\\phi_{i}\\rightarrow\\theta_{o},\\phi_{o}\\right)\n=\nA(\\lambda)\\,\\big(\\cos\\theta_{i}\\cos\\theta_{o}\\big)^{n}\\,g\\!\\left(\\phi_{o}-\\phi_{i}\\right),\n\\quad 0\\le \\theta_{o}\\le \\frac{\\pi}{2},\n$$\n当 $\\theta_{o}>\\frac{\\pi}{2}$ 时，$f_{r,\\lambda}=0$，其中 $g(\\Delta\\phi)=(1+b\\cos\\Delta\\phi)/(2\\pi)$ 且 $|b|\\le 1$，$n> -1$ 是一个给定的指数。角度 $\\theta$ 是从表面法线测量的，$\\phi$ 是围绕法线的方位角。函数 $g$ 经过归一化，使得 $\\int_{0}^{2\\pi} g(\\Delta\\phi)\\,d\\Delta\\phi=1$。振幅 $A(\\lambda)$ 的单位是 $\\mathrm{sr}^{-1}$。\n\n一束波长为 $\\lambda_{0}=1.55\\,\\mu\\mathrm{m}$ 的准直单色光束从方向 $(\\theta_{i},\\phi_{i})=(60^{\\circ},0)$ 入射到该表面，在该入射条件下测得的光谱方向-半球反射率为 $\\rho_{\\lambda_{0}}(\\theta_{i}=60^{\\circ})=0.2$。在 $\\lambda_{0}$ 波长下，表面参数为 $n=1$ 和 $b=\\tfrac{1}{2}$。\n\n仅使用基本辐射度学定义和 BSDF 形式体系，推导由给定 BRDF 所隐含的光谱方向-半球反射率 $\\rho_{\\lambda}(\\theta_{i})$ 的表达式，并用它来确定 $A(\\lambda_{0})$ 的数值。以 $\\mathrm{sr}^{-1}$ 为单位表示您的最终答案，并将结果四舍五入到四位有效数字。在任何积分中，角度都应以弧度处理；给定的 $60^{\\circ}$ 可以通过 $\\cos 60^{\\circ}=\\tfrac{1}{2}$ 使用。", "solution": "我们已对问题陈述进行了评估，认为其科学上合理、提法明确且内部一致。这是一个辐射传热领域的标准问题，可以从基本定义出发求解。我们可以开始求解。\n\n第一步是根据光谱方向-半球反射率 $\\rho_{\\lambda}(\\theta_{i}, \\phi_{i})$ 的基本定义，从双向反射分布函数 (BRDF) $f_{r,\\lambda}$ 推导其表达式。反射率是反射辐射亮度在出射方向半球上的积分，它与BRDF的关系如下：\n$$\n\\rho_{\\lambda}(\\theta_{i}, \\phi_{i}) = \\int_{\\Omega_{o}} f_{r,\\lambda}(\\theta_{i}, \\phi_{i} \\rightarrow \\theta_{o}, \\phi_{o}) \\cos\\theta_{o} d\\Omega_{o}\n$$\n这里，$\\Omega_{o}$ 代表反射半球。在球坐标中，微分立体角为 $d\\Omega_{o} = \\sin\\theta_{o} d\\theta_{o} d\\phi_{o}$。积分在极角 $\\theta_{o}$ 从 $0$ 到 $\\frac{\\pi}{2}$ 和方位角 $\\phi_{o}$ 从 $0$ 到 $2\\pi$ 的范围内进行。明确的积分形式是：\n$$\n\\rho_{\\lambda}(\\theta_{i}, \\phi_{i}) = \\int_{0}^{2\\pi} \\int_{0}^{\\pi/2} f_{r,\\lambda}(\\theta_{i}, \\phi_{i} \\rightarrow \\theta_{o}, \\phi_{o}) \\cos\\theta_{o} \\sin\\theta_{o} d\\theta_{o} d\\phi_{o}\n$$\n我们现在将给定的 BRDF 模型代入此积分。该模型为：\n$$\nf_{r,\\lambda}(\\theta_{i},\\phi_{i}\\rightarrow\\theta_{o},\\phi_{o}) = A(\\lambda)\\,(\\cos\\theta_{i}\\cos\\theta_{o})^{n}\\,g(\\phi_{o}-\\phi_{i})\n$$\n其中 $g(\\Delta\\phi) = \\frac{1+b\\cos\\Delta\\phi}{2\\pi}$。代入后得到：\n$$\n\\rho_{\\lambda}(\\theta_{i}, \\phi_{i}) = \\int_{0}^{2\\pi} \\int_{0}^{\\pi/2} \\left[ A(\\lambda)(\\cos\\theta_{i}\\cos\\theta_{o})^{n}\\frac{1+b\\cos(\\phi_{o}-\\phi_{i})}{2\\pi} \\right] \\cos\\theta_{o} \\sin\\theta_{o} d\\theta_{o} d\\phi_{o}\n$$\n积分中的变量是可分离的。我们可以将依赖于 $\\theta_{o}$ 和 $\\phi_{o}$ 的项分组，并将常数和依赖于 $\\theta_{i}$ 的项提出：\n$$\n\\rho_{\\lambda}(\\theta_{i}, \\phi_{i}) = A(\\lambda)(\\cos\\theta_{i})^{n} \\left[ \\int_{0}^{2\\pi} \\frac{1+b\\cos(\\phi_{o}-\\phi_{i})}{2\\pi} d\\phi_{o} \\right] \\left[ \\int_{0}^{\\pi/2} (\\cos\\theta_{o})^{n} \\cos\\theta_{o} \\sin\\theta_{o} d\\theta_{o} \\right]\n$$\n我们分别计算这两个积分。\n\n首先，考虑方位角积分。问题陈述中说明 $\\int_{0}^{2\\pi} g(\\Delta\\phi)\\,d\\Delta\\phi=1$。让我们验证这个归一化。令 $\\Delta\\phi = \\phi_{o}-\\phi_{i}$。当 $\\phi_{o}$ 从 $0$ 到 $2\\pi$ 变化时，$\\Delta\\phi$ 覆盖一个长度为 $2\\pi$ 的区间。由于被积函数是周期性的，因此在任何这样的区间上的积分都相同。\n$$\n\\int_{0}^{2\\pi} g(\\phi_{o}-\\phi_{i}) d\\phi_{o} = \\int_{0}^{2\\pi} \\frac{1+b\\cos(\\phi_{o}-\\phi_{i})}{2\\pi} d\\phi_{o} = \\frac{1}{2\\pi} \\left[ \\phi_{o} + \\frac{\\sin(\\phi_{o}-\\phi_{i})}{1} \\right]_{0}^{2\\pi} = \\frac{1}{2\\pi} (2\\pi) = 1\n$$\n因此，方位角积分等于 $1$。这个结果表明反射率 $\\rho_{\\lambda}$ 与入方位角 $\\phi_i$ 无关，可以写成 $\\rho_{\\lambda}(\\theta_{i})$。\n\n其次，我们计算极角积分：\n$$\nI_{\\theta} = \\int_{0}^{\\pi/2} (\\cos\\theta_{o})^{n+1} \\sin\\theta_{o} d\\theta_{o}\n$$\n我们使用换元法，令 $u = \\cos\\theta_{o}$，则 $du = -\\sin\\theta_{o} d\\theta_{o}$。积分上下限相应改变：当 $\\theta_{o}=0$ 时，$u=1$；当 $\\theta_{o}=\\frac{\\pi}{2}$ 时，$u=0$。\n$$\nI_{\\theta} = \\int_{1}^{0} u^{n+1} (-du) = \\int_{0}^{1} u^{n+1} du\n$$\n这是一个标准的幂函数积分，当 $n+1 > -1$ 或 $n > -2$ 时有效。问题条件 $n > -1$ 满足此要求。\n$$\nI_{\\theta} = \\left[ \\frac{u^{n+2}}{n+2} \\right]_{0}^{1} = \\frac{1^{n+2}}{n+2} - \\frac{0^{n+2}}{n+2} = \\frac{1}{n+2}\n$$\n结合两个积分的结果，我们得到光谱方向-半球反射率的解析表达式：\n$$\n\\rho_{\\lambda}(\\theta_{i}) = A(\\lambda)(\\cos\\theta_{i})^{n} \\cdot (1) \\cdot \\left(\\frac{1}{n+2}\\right) = \\frac{A(\\lambda)}{n+2} (\\cos\\theta_{i})^{n}\n$$\n至此，任务的第一部分完成。\n\n现在，我们使用给定的数据来计算 $A(\\lambda_{0})$ 的数值。数据是在波长 $\\lambda_{0}=1.55\\,\\mu\\mathrm{m}$ 下的：\n入射角: $\\theta_{i} = 60^{\\circ}$\n测得的反射率: $\\rho_{\\lambda_{0}}(60^{\\circ}) = 0.2$\n表面指数: $n = 1$\n给定 $\\cos(60^{\\circ})=\\frac{1}{2}$。参数 $b=\\frac{1}{2}$ 影响反射能量的分布，但不影响总的半球反射率。\n\n将这些值代入推导出的 $\\rho_{\\lambda}(\\theta_{i})$ 表达式：\n$$\n0.2 = \\frac{A(\\lambda_{0})}{1+2} \\left( \\cos(60^{\\circ}) \\right)^{1}\n$$\n$$\n0.2 = \\frac{A(\\lambda_{0})}{3} \\left( \\frac{1}{2} \\right)\n$$\n$$\n0.2 = \\frac{A(\\lambda_{0})}{6}\n$$\n求解 $A(\\lambda_{0})$ 得：\n$$\nA(\\lambda_{0}) = 6 \\times 0.2 = 1.2\n$$\n问题要求答案保留四位有效数字。因此，我们将结果表示为 $1.200$。给定的 $A(\\lambda)$ 的单位是 $\\mathrm{sr}^{-1}$。", "answer": "$$\n\\boxed{1.200}\n$$", "id": "2524141"}, {"introduction": "前述练习中我们使用了给定的辐射特性模型，但一个更深层次的问题是：这些模型本身从何而来？本综合练习将带你深入探索从物理原理出发构建高级辐射模型的全过程。我们将以微面元理论（microfacet theory）为基础，该理论将宏观表面的反射行为与微观尺度的几何形貌及材料的光学性质（菲涅尔方程）联系起来。你需要推导一个现代物理BRDF模型的几个核心组成部分——包括著名的 Trowbridge-Reitz (GGX) 分布和 Smith 阴影遮蔽函数——并最终通过编程实现对该模型的数值计算[@problem_id:2524138]。这项实践融合了物理光学、数学推导与计算科学，是掌握现代热辐射模拟与计算机图形学中前沿方法的关键一步。", "problem": "一个宏观平坦但微观粗糙、不透明、各向同性的金属表面被建模为镜面微面元的随机集合。宏观双向反射分布函数（BRDF），记作 $f_r(\\lambda, \\boldsymbol{\\omega}_i, \\boldsymbol{\\omega}_o)$，取决于波长 $\\lambda$ 和两个单位方向 $\\boldsymbol{\\omega}_i$（入射）与 $\\boldsymbol{\\omega}_o$（出射），这两个方向都位于相对于宏观表面单位法线 $\\boldsymbol{n}$ 的上半球内。BRDF 由以下基本辐射度学关系定义\n$$\n\\mathrm{d}L_o(\\lambda, \\boldsymbol{\\omega}_o) \\;=\\; f_r(\\lambda,\\boldsymbol{\\omega}_i,\\boldsymbol{\\omega}_o)\\, L_i(\\lambda,\\boldsymbol{\\omega}_i)\\, (\\boldsymbol{n}\\cdot \\boldsymbol{\\omega}_i)\\, \\mathrm{d}\\omega_i,\n$$\n其中 $L$ 表示辐射率，$\\boldsymbol{n}\\cdot \\boldsymbol{\\omega}_i = \\cos\\theta_i \\ge 0$，$\\mathrm{d}\\omega_i$ 是微分立体角。假定能量守恒、互易性和微观表面镜面反射性成立。\n\n微观几何结构由上半球 $\\Omega^+$ 内微面元单位法线 $\\boldsymbol{m}$ 的各向同性 Trowbridge–Reitz（也称为广义高斯或 GGX）法线分布函数（NDF）表征：\n$$\nD(\\boldsymbol{m};\\alpha)\\; \\propto\\; \\left( \\left(\\boldsymbol{n}\\cdot\\boldsymbol{m}\\right)^2\\left(\\alpha^2 - 1\\right) + 1 \\right)^{-2},\n$$\n其中 $\\alpha>0$ 是一个粗糙度参数。NDF 必须满足投影面积度量的归一化约束，\n$$\n\\int_{\\Omega^+} D(\\boldsymbol{m};\\alpha)\\, (\\boldsymbol{n}\\cdot \\boldsymbol{m})\\, \\mathrm{d}\\omega_m \\;=\\; 1.\n$$\n自遮挡和遮蔽由可分离的 Smith 模型 $G(\\boldsymbol{\\omega}_i,\\boldsymbol{\\omega}_o,\\alpha) = G_1(\\boldsymbol{\\omega}_i,\\alpha)\\, G_1(\\boldsymbol{\\omega}_o,\\alpha)$ 描述，其中 $G_1$ 是一条来自给定方向的光线不与表面高度场相交的概率。\n\n光谱依赖性通过每个微面元的菲涅尔反射率产生，该微面元被建模为相对于真空具有复折射率 $\\tilde{n}(\\lambda) = n(\\lambda) + i\\,k(\\lambda)$ 的完美导体。根据电磁边界条件（麦克斯韦方程组），对于入射角 $\\theta$ 下的 s 偏振和 p 偏振，其复振幅菲涅尔反射系数为\n$$\nr_s(\\theta,\\lambda) \\,=\\, \\frac{\\cos\\theta - \\sqrt{\\tilde{n}(\\lambda)^2 - \\sin^2\\theta}}{\\cos\\theta + \\sqrt{\\tilde{n}(\\lambda)^2 - \\sin^2\\theta}},\\qquad\nr_p(\\theta,\\lambda) \\,=\\, \\frac{\\tilde{n}(\\lambda)^2 \\cos\\theta - \\sqrt{\\tilde{n}(\\lambda)^2 - \\sin^2\\theta}}{\\tilde{n}(\\lambda)^2 \\cos\\theta + \\sqrt{\\tilde{n}(\\lambda)^2 - \\sin^2\\theta}},\n$$\n并且非偏振微面元光谱反射率为\n$$\nF(\\theta,\\lambda) \\,=\\, \\tfrac{1}{2}\\left(\\lvert r_s\\rvert^2 + \\lvert r_p\\rvert^2\\right).\n$$\n\n任务：\n1) 从 BRDF 定义和微面元集合图像出发，其中只有法线 $\\boldsymbol{m}$ 满足镜面反射条件的微面元才有贡献，推导出微面元 BRDF $f_r(\\lambda,\\boldsymbol{\\omega}_i,\\boldsymbol{\\omega}_o)$。表达式需由微面元半矢量 $\\boldsymbol{h} = (\\boldsymbol{\\omega}_i + \\boldsymbol{\\omega}_o)/\\lVert \\boldsymbol{\\omega}_i + \\boldsymbol{\\omega}_o\\rVert$、在 $\\boldsymbol{m}=\\boldsymbol{h}$ 处取值的归一化 NDF $D(\\boldsymbol{m};\\alpha)$、在入射角 $\\theta_m$（$\\boldsymbol{\\omega}_i$ 和 $\\boldsymbol{h}$ 之间的夹角）处取值的菲涅尔反射率 $F(\\theta_m,\\lambda)$，以及 Smith 遮挡-遮蔽函数 $G(\\boldsymbol{\\omega}_i,\\boldsymbol{\\omega}_o,\\alpha)$ 表示。您的推导必须从可见微面元的集合平均开始，并应用 $\\boldsymbol{m}$ 空间与方向空间之间的投影面积雅可比行列式。不要先验地假设任何目标表达式。\n\n2) 确定归一化常数，将成比例的 Trowbridge–Reitz 表达式转换为一个有效的、满足上述投影面积归一化约束的 NDF $D(\\boldsymbol{m};\\alpha)$。\n\n3) 使用 Smith 函数的可分离性假设以及 Trowbridge–Reitz 模型所基于的微面元斜率分布的定义，推导出 $G_1(\\boldsymbol{\\omega},\\alpha)$ 的一个以 $\\mu=\\boldsymbol{n}\\cdot\\boldsymbol{\\omega}=\\cos\\theta$ 和 $\\alpha$ 表示的闭式表达式。\n\n4) 实现一个程序，为以下测试套件数值计算最终的 BRDF $f_r(\\lambda,\\boldsymbol{\\omega}_i,\\boldsymbol{\\omega}_o)$。使用宏观表面法线 $\\boldsymbol{n}=(0,0,1)^\\top$，并根据球坐标约定 $\\boldsymbol{\\omega}=(\\sin\\theta\\cos\\varphi,\\sin\\theta\\sin\\varphi,\\cos\\theta)$ 使用天顶角 $\\theta$ 和方位角 $\\varphi$ 对方向进行参数化。入射方向的方位角固定为 $\\varphi_i=0$，出射方位角为 $\\varphi_o=\\Delta\\varphi$。角度必须以弧度为单位。波长必须以纳米为单位，BRDF 必须以球面度分之一（sr⁻¹）报告。对于每种情况，返回浮点数形式的标量 BRDF 值。\n\n测试套件案例（每个案例指定为 $[\\lambda\\,[\\mathrm{nm}],\\, n(\\lambda),\\, k(\\lambda),\\, \\alpha,\\, \\theta_i\\, [\\mathrm{rad}],\\, \\theta_o\\, [\\mathrm{rad}],\\, \\Delta\\varphi\\, [\\mathrm{rad}]]$）：\n- 案例 A: $[550,\\; 0.14,\\; 3.98,\\; 0.05,\\; 0.34906585,\\; 0.34906585,\\; \\pi]$。\n- 案例 B: $[800,\\; 0.17,\\; 5.25,\\; 0.50,\\; 0.34906585,\\; 0.34906585,\\; \\pi]$。\n- 案例 C: $[550,\\; 0.14,\\; 3.98,\\; 0.10,\\; 1.39626340,\\; 1.39626340,\\; \\pi]$。\n- 案例 D: $[550,\\; 0.14,\\; 3.98,\\; 0.30,\\; 0.52359878,\\; 1.04719755,\\; \\tfrac{\\pi}{2}]$。\n\n实现要求：\n- 使用从任务 1-3 推导出的表达式。\n- 在微面元级别上，使用导体模型和给定的 $n(\\lambda)$ 和 $k(\\lambda)$（针对每个 $\\lambda$）来处理菲涅尔反射率。\n- 确保数值鲁棒性，在 $\\boldsymbol{n}\\cdot\\boldsymbol{\\omega}_i \\le 0$ 或 $\\boldsymbol{n}\\cdot\\boldsymbol{\\omega}_o \\le 0$ 或 $\\lVert \\boldsymbol{\\omega}_i + \\boldsymbol{\\omega}_o\\rVert = 0$ 的情况下返回 0。\n- 最终答案以球面度分之一（sr⁻¹）表示，为四舍五入到六位小数的浮点数。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含案例 A-D 的四个 BRDF 值，格式为方括号内以逗号分隔的列表，顺序与案例相同（例如，$[v_A,v_B,v_C,v_D]$），每个 $v_\\cdot$ 值四舍五入到六位小数，无额外文本。内部计算中角度必须以弧度处理。波长单位 $[\\mathrm{nm}]$ 仅作为选择 $n(\\lambda)$ 和 $k(\\lambda)$ 的参数，除了菲涅尔系数外，不直接进入计算。\n\n约束与说明：\n- 假定宏观表面不发射辐射，其上的介质为真空。\n- BRDF 必须是互易且非负的。\n- 所有三角函数必须使用以弧度为单位的角度。", "solution": "该问题陈述已经过严格验证，被认为是科学上合理、适定且客观的。它提出了一个物理光学和辐射传输领域的标准问题，尽管内容全面，但具体涉及粗糙表面反射的微面元理论。所有提供的定义、常数和函数形式在相关文献中都是标准的。各项任务是顺序的、逻辑一致的，并能导向一个唯一的、可验证的解。因此，我将着手进行推导和求解。\n\n该问题需要一个由四部分组成的解：双向反射分布函数（BRDF）的推导、法线分布函数（NDF）的归一化、遮挡-遮蔽函数的推导，最后是数值实现。\n\n第一个任务是推导微面元 BRDF，记作 $f_r(\\lambda,\\boldsymbol{\\omega}_i,\\boldsymbol{\\omega}_o)$。BRDF 由反射辐射率 $L_o$ 和入射辐射率 $L_i$ 之间的关系定义：\n$$\n\\mathrm{d}L_o(\\lambda, \\boldsymbol{\\omega}_o) = f_r(\\lambda,\\boldsymbol{\\omega}_i,\\boldsymbol{\\omega}_o)\\, L_i(\\lambda,\\boldsymbol{\\omega}_i)\\, \\mathrm{d}E_i\n$$\n其中 $\\mathrm{d}E_i = L_i(\\lambda,\\boldsymbol{\\omega}_i)\\, (\\boldsymbol{n}\\cdot \\boldsymbol{\\omega}_i)\\, \\mathrm{d}\\omega_i$ 是宏观表面上的微分辐照度。\n从宏观表面的一个微分面积 $\\mathrm{d}A$ 反射到微分立体角 $\\mathrm{d}\\omega_o$ 的反射辐射率是总反射功率 $\\mathrm{d}\\Phi_o$ 除以投影面积和立体角：\n$$\nL_o(\\boldsymbol{\\omega}_o) = \\frac{\\mathrm{d}\\Phi_o}{\\mathrm{d}A\\, (\\boldsymbol{n}\\cdot \\boldsymbol{\\omega}_o)\\, \\mathrm{d}\\omega_o}\n$$\n总反射功率 $\\mathrm{d}\\Phi_o$ 是对所有可见的、镜面反射的微面元的积分。一个法线为 $\\boldsymbol{m}$ 的微面元只有当其朝向半矢量 $\\boldsymbol{h} = (\\boldsymbol{\\omega}_i + \\boldsymbol{\\omega}_o)/\\lVert \\boldsymbol{\\omega}_i + \\boldsymbol{\\omega}_o\\rVert$ 时，才对从 $\\boldsymbol{\\omega}_i$ 到 $\\boldsymbol{\\omega}_o$ 的反射有贡献。入射到面积 $\\mathrm{d}A$ 内的活动微面元集合上的微分功率为\n$$\n\\mathrm{d}\\Phi_i = L_i(\\boldsymbol{\\omega}_i) \\mathrm{d}\\omega_i \\cdot (\\text{活动微面元的投影面积}) = L_i(\\boldsymbol{\\omega}_i) \\mathrm{d}\\omega_i \\cdot [D(\\boldsymbol{h};\\alpha) (\\boldsymbol{n}\\cdot\\boldsymbol{h}) \\mathrm{d}\\omega_m \\mathrm{d}A] \\cdot \\frac{(\\boldsymbol{\\omega}_i \\cdot \\boldsymbol{h})}{(\\boldsymbol{n}\\cdot\\boldsymbol{h})}\n$$\n项 $D(\\boldsymbol{h};\\alpha) (\\boldsymbol{n}\\cdot\\boldsymbol{h}) \\mathrm{d}\\omega_m \\mathrm{d}A$ 是法线在 $\\boldsymbol{h}$ 附近的 $\\mathrm{d}\\omega_m$ 内的微面元的总面积，最后一个因子校正了该面积相对于入射方向 $\\boldsymbol{\\omega}_i$ 的投影。反射功率是该入射功率乘以菲涅尔反射率 $F$ 和遮挡-遮蔽项 $G$：\n$$\n\\mathrm{d}\\Phi_o = L_i(\\boldsymbol{\\omega}_i) \\mathrm{d}\\omega_i \\cdot D(\\boldsymbol{h};\\alpha) (\\boldsymbol{\\omega}_i \\cdot \\boldsymbol{h}) F(\\theta_m,\\lambda) G(\\boldsymbol{\\omega}_i,\\boldsymbol{\\omega}_o,\\alpha) \\mathrm{d}A \\mathrm{d}\\omega_m\n$$\n其中 $\\theta_m$ 是 $\\boldsymbol{\\omega}_i$ 和 $\\boldsymbol{h}$ 之间的夹角。对于镜面反射，关联微面元法线立体角 $\\mathrm{d}\\omega_m$ 与出射立体角 $\\mathrm{d}\\omega_o$ 的雅可比行列式为 $\\mathrm{d}\\omega_m/\\mathrm{d}\\omega_o = 1 / (4(\\boldsymbol{\\omega}_o \\cdot \\boldsymbol{h}))$。将此代入 $\\mathrm{d}\\Phi_o$ 的表达式中得到：\n$$\n\\mathrm{d}\\Phi_o = L_i(\\boldsymbol{\\omega}_i) \\mathrm{d}\\omega_i \\cdot \\frac{D(\\boldsymbol{h}) F(\\theta_m) G(\\boldsymbol{\\omega}_i,\\boldsymbol{\\omega}_o) (\\boldsymbol{\\omega}_i \\cdot \\boldsymbol{h})}{4(\\boldsymbol{\\omega}_o \\cdot \\boldsymbol{h})} \\mathrm{d}A \\mathrm{d}\\omega_o\n$$\n使用镜面反射条件 $(\\boldsymbol{\\omega}_i \\cdot \\boldsymbol{h}) = (\\boldsymbol{\\omega}_o \\cdot \\boldsymbol{h})$，我们得到反射辐射率：\n$$\nL_o(\\boldsymbol{\\omega}_o) = \\frac{\\mathrm{d}\\Phi_o}{\\mathrm{d}A\\, (\\boldsymbol{n}\\cdot \\boldsymbol{\\omega}_o)\\, \\mathrm{d}\\omega_o} = L_i(\\boldsymbol{\\omega}_i) \\mathrm{d}\\omega_i \\frac{D(\\boldsymbol{h}) F(\\theta_m) G(\\boldsymbol{\\omega}_i,\\boldsymbol{\\omega}_o)}{4(\\boldsymbol{n}\\cdot \\boldsymbol{\\omega}_o)}\n$$\n将其与定义 $L_o = f_r L_i (\\boldsymbol{n}\\cdot \\boldsymbol{\\omega}_i) \\mathrm{d}\\omega_i$ 进行比较，我们确定BRDF为：\n$$\nf_r(\\lambda,\\boldsymbol{\\omega}_i,\\boldsymbol{\\omega}_o) = \\frac{D(\\boldsymbol{h};\\alpha) F(\\theta_m,\\lambda) G(\\boldsymbol{\\omega}_i,\\boldsymbol{\\omega}_o,\\alpha)}{4 (\\boldsymbol{n}\\cdot \\boldsymbol{\\omega}_i) (\\boldsymbol{n}\\cdot \\boldsymbol{\\omega}_o)}\n$$\n这就是所要求的表达式，即 Cook-Torrance 微面元模型 BRDF。\n\n第二个任务是找到 Trowbridge-Reitz NDF 的归一化常数，$D(\\boldsymbol{m};\\alpha) = C \\cdot \\left( (\\boldsymbol{n}\\cdot\\boldsymbol{m})^2(\\alpha^2 - 1) + 1 \\right)^{-2}$，在约束条件 $\\int_{\\Omega^+} D(\\boldsymbol{m};\\alpha)\\, (\\boldsymbol{n}\\cdot \\boldsymbol{m})\\, \\mathrm{d}\\omega_m = 1$ 下。我们必须求解 $C$。积分为：\n$$\nI = \\int_{\\Omega^+} \\left( (\\boldsymbol{n}\\cdot\\boldsymbol{m})^2(\\alpha^2 - 1) + 1 \\right)^{-2} (\\boldsymbol{n}\\cdot \\boldsymbol{m})\\, \\mathrm{d}\\omega_m\n$$\n我们将 $\\boldsymbol{n}$ 与z轴对齐，因此 $\\boldsymbol{n}=(0,0,1)$。在球坐标中，$\\boldsymbol{m}=(\\sin\\theta_m\\cos\\varphi_m, \\sin\\theta_m\\sin\\varphi_m, \\cos\\theta_m)$，所以 $\\boldsymbol{n}\\cdot\\boldsymbol{m} = \\cos\\theta_m$。积分是在上半球 $\\Omega^+$ 上进行的，这意味着 $\\theta_m \\in [0, \\pi/2]$ 且 $\\varphi_m \\in [0, 2\\pi]$。微分立体角为 $\\mathrm{d}\\omega_m = \\sin\\theta_m \\mathrm{d}\\theta_m \\mathrm{d}\\varphi_m$。\n$$\nI = \\int_0^{2\\pi} \\mathrm{d}\\varphi_m \\int_0^{\\pi/2} \\frac{\\cos\\theta_m \\sin\\theta_m}{(\\cos^2\\theta_m(\\alpha^2 - 1) + 1)^2} \\mathrm{d}\\theta_m\n$$\n对 $\\varphi_m$ 的积分得出 $2\\pi$。对于对 $\\theta_m$ 的积分，令 $u = \\cos^2\\theta_m$。则 $\\mathrm{d}u = -2\\cos\\theta_m\\sin\\theta_m \\mathrm{d}\\theta_m$。积分限从 $1$（当 $\\theta_m=0$ 时）变为 $0$（当 $\\theta_m=\\pi/2$ 时）。\n$$\nI = 2\\pi \\int_1^0 \\frac{1}{(u(\\alpha^2-1)+1)^2} \\frac{-\\mathrm{d}u}{2} = \\pi \\int_0^1 \\frac{1}{(u(\\alpha^2-1)+1)^2} \\mathrm{d}u\n$$\n令 $a = \\alpha^2-1$。积分变为 $\\int (au+1)^{-2} \\mathrm{d}u = -\\frac{1}{a(au+1)}$。\n$$\nI = \\pi \\left[ -\\frac{1}{a(au+1)} \\right]_0^1 = -\\frac{\\pi}{a} \\left( \\frac{1}{a+1} - \\frac{1}{1} \\right) = -\\frac{\\pi}{\\alpha^2-1} \\left( \\frac{1}{\\alpha^2} - 1 \\right) = -\\frac{\\pi}{\\alpha^2-1} \\frac{1-\\alpha^2}{\\alpha^2} = \\frac{\\pi}{\\alpha^2}\n$$\n归一化常数为 $C = 1/I = \\alpha^2/\\pi$。因此，归一化的 NDF 为：\n$$\nD(\\boldsymbol{m};\\alpha) = \\frac{\\alpha^2}{\\pi} \\frac{1}{\\left((\\boldsymbol{n}\\cdot\\boldsymbol{m})^2(\\alpha^2 - 1) + 1\\right)^2}\n$$\n\n第三个任务是推导 Smith 遮挡-遮蔽函数 $G_1(\\boldsymbol{\\omega},\\alpha)$。函数 $G_1(\\boldsymbol{\\omega})$ 表示方向为 $\\boldsymbol{\\omega}$ 的光线不被表面遮挡的概率。对于高斯高度分布，Smith 证明了 $G_1(\\boldsymbol{\\omega}) = (1+\\Lambda(\\boldsymbol{\\omega}))^{-1}$。函数 $\\Lambda(\\boldsymbol{\\omega})$ 取决于微观表面的斜率分布。对于各向同性的 Trowbridge-Reitz (GGX) NDF，相应的函数 $\\Lambda$ 具有闭式解。它取决于宏观表面法线 $\\boldsymbol{n}$ 与方向 $\\boldsymbol{\\omega}$ 之间的夹角 $\\theta$。令 $\\mu = \\cos\\theta = \\boldsymbol{n}\\cdot\\boldsymbol{\\omega}$。GGX 的函数 $\\Lambda$ 为：\n$$\n\\Lambda(\\mu, \\alpha) = \\frac{-1 + \\sqrt{1 + \\alpha^2 \\tan^2\\theta}}{2} = \\frac{-1 + \\sqrt{1 + \\alpha^2 \\frac{1-\\mu^2}{\\mu^2}}}{2}\n$$\n将此代入 $G_1$ 的表达式中：\n$$\nG_1(\\mu, \\alpha) = \\frac{1}{1 + \\Lambda(\\mu, \\alpha)} = \\frac{1}{1 + \\frac{-1 + \\sqrt{1 + \\alpha^2 (1-\\mu^2)/\\mu^2}}{2}} = \\frac{2}{1 + \\sqrt{1 + \\alpha^2 \\frac{1-\\mu^2}{\\mu^2}}}\n$$\n这就是所要求的、用于 Trowbridge-Reitz NDF 的 Smith 遮挡-遮蔽函数的闭式表达式。\n\n第四个任务是数值实现。以下 Python 函数根据推导出的表达式来计算 $f_r$。\n```python\nimport numpy as np\n\ndef calculate_brdf(_lambda, n, k, alpha, theta_i, theta_o, delta_phi):\n    \"\"\"\n    Calculates the BRDF value for a single set of parameters.\n    \"\"\"\n    # Macrosurface normal\n    n_vec = np.array([0.0, 0.0, 1.0])\n\n    # Incident and outgoing direction vectors\n    cos_theta_i = np.cos(theta_i)\n    sin_theta_i = np.sin(theta_i)\n    cos_theta_o = np.cos(theta_o)\n    sin_theta_o = np.sin(theta_o)\n\n    # Check for grazing angles as per problem requirements.\n    if cos_theta_i = 0 or cos_theta_o = 0:\n        return 0.0\n\n    wi = np.array([sin_theta_i, 0.0, cos_theta_i])\n    wo = np.array([sin_theta_o * np.cos(delta_phi),\n                   sin_theta_o * np.sin(delta_phi),\n                   cos_theta_o])\n\n    # Half-vector\n    h_unnormalized = wi + wo\n    norm_h_unnormalized = np.linalg.norm(h_unnormalized)\n\n    # Check if wi and wo are opposite\n    if norm_h_unnormalized == 0.0:\n        return 0.0\n\n    h = h_unnormalized / norm_h_unnormalized\n\n    # ------- Component calculations for the BRDF formula -------\n    \n    # 1. NDF (D term)\n    cos_theta_h = np.dot(n_vec, h)\n    if cos_theta_h = 0:  # Microfacet normal points away from macrosurface normal\n        return 0.0\n    \n    alpha2 = alpha * alpha\n    denominator_d = (cos_theta_h**2 * (alpha2 - 1) + 1)**2\n    D = alpha2 / (np.pi * denominator_d)\n\n    # 2. Smith Shadowing-Masking (G term)\n    def g1_smith_ggx(cos_theta, alpha_val):\n        # tan_theta^2 = (1-cos_theta^2)/cos_theta^2\n        if cos_theta == 0: return 0.0\n        tan2_theta = (1.0 - cos_theta**2) / cos_theta**2\n        return 2.0 / (1.0 + np.sqrt(1.0 + alpha_val**2 * tan2_theta))\n\n    G1_i = g1_smith_ggx(cos_theta_i, alpha)\n    G1_o = g1_smith_ggx(cos_theta_o, alpha)\n    G = G1_i * G1_o\n\n    # 3. Fresnel Reflectance (F term)\n    cos_theta_m = np.dot(wi, h)\n    if cos_theta_m = 0: # Should not happen if grazing angles are checked\n        return 0.0\n\n    n_tilde = n + 1j * k\n    n_tilde2 = n_tilde**2\n    sin2_theta_m = 1.0 - cos_theta_m**2\n\n    # Using complex arithmetic for Fresnel equations for a conductor\n    sqrt_term = np.sqrt(n_tilde2 - sin2_theta_m)\n    \n    # s-polarization\n    rs_num = cos_theta_m - sqrt_term\n    rs_den = cos_theta_m + sqrt_term\n    rs = rs_num / rs_den\n\n    # p-polarization\n    rp_num = n_tilde2 * cos_theta_m - sqrt_term\n    rp_den = n_tilde2 * cos_theta_m + sqrt_term\n    rp = rp_num / rp_den\n\n    F = 0.5 * (np.abs(rs)**2 + np.abs(rp)**2)\n\n    # ------- Final BRDF calculation -------\n    \n    denominator_brdf = 4 * cos_theta_i * cos_theta_o\n    if denominator_brdf == 0:\n        return 0.0\n\n    brdf = (D * G * F) / denominator_brdf\n    \n    return brdf\n```", "answer": "$$\n\\boxed{[218.423719, 1.493926, 153.250552, 0.121516]}\n$$", "id": "2524138"}]}