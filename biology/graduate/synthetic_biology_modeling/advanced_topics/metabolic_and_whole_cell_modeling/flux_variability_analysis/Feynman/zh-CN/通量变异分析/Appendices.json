{
    "hands_on_practices": [
        {
            "introduction": "要掌握通量变异性分析（FVA），第一步是理解其数学核心并将其转化为可执行的代码。本练习旨在通过直接应用其定义来构建一个基本的FVA程序。您将为给定反应设置并求解两个独立的线性规划（LP）问题，以确定在维持系统最优目标的前提下，其通量的最小和最大可能值。这个过程将帮助您巩固对FVA基本原理的理解，并为更复杂的应用打下坚实基础。",
            "id": "3913845",
            "problem": "您的任务是在已知的最优目标值下，对几个小型的稳态代谢网络中指定反应进行通量变异性分析（Flux Variability Analysis, FVA）。必须直接使用以下的建模假设和定义作为基本基础：稳态质量平衡、通量的线性边界和线性目标优化。请使用以下原理和定义来设计您的程序。\n\n基本基础：\n- 代谢网络的稳态质量平衡表示为 $S v = 0$，其中 $S \\in \\mathbb{R}^{m \\times n}$ 是化学计量矩阵，$v \\in \\mathbb{R}^n$ 是反应通量向量，$m$ 和 $n$ 分别是代谢物和反应的数量。\n- 通量边界为 $l \\le v \\le u$，其中 $l \\in \\mathbb{R}^n$ 和 $u \\in \\mathbb{R}^n$ 分别是下界和上界。\n- 通量平衡分析（Flux Balance Analysis, FBA）使用线性目标 $c^\\top v$ 来寻找最优值 $z^\\star$。\n- 对反应 $i$ 进行的通量变异性分析（Flux Variability Analysis, FVA）计算了在所有满足相同稳态和边界约束、并且通过最优性切割 $c^\\top v \\ge z^\\star - \\varepsilon$ 达到最优目标（在指定容差范围内）的通量向量 $v$ 中，反应通量 $v_i$ 的最小值和最大值，其中 $\\varepsilon  0$ 是一个小的标量容差。\n\n您的程序必须：\n- 对于每个测试用例，通过求解两个线性规划（LP）问题来计算单个反应 $i$ 的 FVA 范围：\n  1. 在约束条件 $S v = 0$、$l \\le v \\le u$ 和 $-c^\\top v \\le -(z^\\star - \\varepsilon)$ 下，最小化 $v_i$。\n  2. 在相同的约束条件下，最大化 $v_i$（通过在相同约束条件下最小化 $-v_i$ 来实现）。\n- 在两个 LP 问题中使用相同且一致的求解器设置，以确保应用相同的最优性切割。\n- 报告反应 $i$ 的最小和最大通量值，单位为毫摩尔每克干重每小时（$\\text{mmol}\\,\\text{gDW}^{-1}\\,\\text{h}^{-1}$），并四舍五入到 $6$ 位小数。\n\n角度单位不适用。通量采用分数或小数格式；不包括百分号。\n\n测试套件：\n反应使用从零开始的索引。对于每个测试用例，数据以 $(S, l, u, c, i, z^\\star, \\varepsilon)$ 的形式给出。\n\n- 测试用例 1（由单一摄取限制生长的两个生物质流失途径）：\n  - $S = \\begin{bmatrix} 1  -1  0  -1 \\\\ 0  1  -1  0 \\end{bmatrix}$，\n  - $l = [0, 0, 0, 0]$，\n  - $u = [10, 1000, 1000, 1000]$，\n  - $c = [0, 0, 1, 1]$，\n  - $i = 1$，\n  - $z^\\star = 10$，\n  - $\\varepsilon = 1 \\times 10^{-7}$。\n  此案例由于存在两条可替代的生物质生产途径而表现出多个最优解，其中 $c^\\top v$ 受摄取边界的限制。\n\n- 测试用例 2（带有内部循环的备选最优解）：\n  - $S = \\begin{bmatrix} 1  -1  1  0 \\\\ 0  1  -1  -1 \\end{bmatrix}$，\n  - $l = [0, 0, 0, 0]$，\n  - $u = [5, 1005, 1000, 1000]$，\n  - $c = [0, 0, 0, 1]$，\n  - $i = 1$，\n  - $z^\\star = 5$，\n  - $\\varepsilon = 1 \\times 10^{-8}$。\n  此案例允许代谢物之间发生内部循环，在保持最优目标的同时，在一个非目标反应中产生很大的变异性。\n\n- 测试用例 3（由于代谢物不平衡而导致的阻塞反应）：\n  - $S = \\begin{bmatrix} 1  -1  0  0 \\\\ 0  1  -1  -1 \\\\ 0  0  0  1 \\end{bmatrix}$，\n  - $l = [0, 0, 0, 0]$，\n  - $u = [3, 1000, 1000, 1000]$，\n  - $c = [0, 0, 1, 0]$，\n  - $i = 3$，\n  - $z^\\star = 3$，\n  - $\\varepsilon = 1 \\times 10^{-9}$。\n  代谢物 $C$ 没有汇（sink）；因此其生产反应在稳态下被阻塞。\n\n- 测试用例 4（紧密边界产生分数最优生长的唯一最优解）：\n  - $S = \\begin{bmatrix} 1  -1 \\end{bmatrix}$，\n  - $l = [0, 0]$，\n  - $u = [2.5, 1000]$，\n  - $c = [0, 1]$，\n  - $i = 0$，\n  - $z^\\star = 2.5$，\n  - $\\varepsilon = 1 \\times 10^{-12}$。\n  单一的摄取边界将唯一的目标值固定为一个分数。\n\n求解器设置要求：\n- 在所有 LP 问题中使用单一的线性规划方法，该方法能可靠地支持等式约束和边界约束。\n- 在最小化和最大化 LP 问题中，对原始可行性、对偶可行性和最优性应用相同的容差，以确保最优性切割 $c^\\top v \\ge z^\\star - \\varepsilon$ 被一致地执行。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含结果，格式为方括号括起来的逗号分隔列表，每个测试用例表示为一个包含两个浮点数的列表，四舍五入到 $6$ 位小数，例如 $[[x_1,y_1],[x_2,y_2],\\dots]$。在此问题中，该行必须采用 $[[\\text{min}_1,\\text{max}_1],[\\text{min}_2,\\text{max}_2],[\\text{min}_3,\\text{max}_3],[\\text{min}_4,\\text{max}_4]]$ 的格式，其中每个 $\\text{min}_k$ 和 $\\text{max}_k$ 的单位为 $\\text{mmol}\\,\\text{gDW}^{-1}\\,\\text{h}^{-1}$，并四舍五入到 $6$ 位小数。",
            "solution": "推导过程源于基于约束的代谢建模中使用的标准稳态和优化原理。通量平衡分析（FBA）模型指定了化学计量矩阵 $S \\in \\mathbb{R}^{m \\times n}$、通量向量 $v \\in \\mathbb{R}^n$ 以及边界 $l \\le v \\le u$。稳态意味着 $S v = 0$，这强制要求对于每种代谢物，其产生通量和消耗通量之和为零。使用目标函数 $c^\\top v$ 来定义一个生理学相关的目标（例如生长速率），并求解一个线性规划（LP）问题来找到最优目标值 $z^\\star$。\n\n通量变异性分析（FVA）刻画了在所有满足 $S v = 0$ 和边界 $l \\le v \\le u$ 条件，同时达到相同最优目标值（在容差范围内）的通量向量 $v$ 中，每个反应通量 $v_i$ 的允许范围。形式上，对于给定的反应索引 $i$，FVA 求解两个 LP 问题：\n\n$$\n\\begin{aligned}\n\\min_{v \\in \\mathbb{R}^n} \\quad  v_i \\\\\n\\text{s.t.} \\quad  S v = 0, \\\\\n l \\le v \\le u, \\\\\n c^\\top v \\ge z^\\star - \\varepsilon,\n\\end{aligned}\n$$\n\n和\n\n$$\n\\begin{aligned}\n\\max_{v \\in \\mathbb{R}^n} \\quad  v_i \\\\\n\\text{s.t.} \\quad  S v = 0, \\\\\n l \\le v \\le u, \\\\\n c^\\top v \\ge z^\\star - \\varepsilon,\n\\end{aligned}\n$$\n\n其中最优性切割 $c^\\top v \\ge z^\\star - \\varepsilon$ 强制只考虑那些相对于目标是近最优的通量向量。在实践中，当使用只支持最小化的求解器时，可以通过在相同约束条件下最小化 $-v_i$ 来实现最大化。不等式 $c^\\top v \\ge z^\\star - \\varepsilon$ 可以编码为标准 LP 形式 $-c^\\top v \\le -(z^\\star - \\varepsilon)$。\n\n算法设计：\n- 对于每个测试用例，设置 $A_{\\text{eq}} = S$ 和 $b_{\\text{eq}} = 0$，以及由 $l$ 和 $u$ 给出的边界。\n- 将最优性切割设置为单个不等式 $A_{\\text{ub}} = -c^\\top$ 和 $b_{\\text{ub}} = -(z^\\star - \\varepsilon)$。\n- 要计算 $v_i$ 的最小值，最小化目标向量 $f = e_i$，其中 $e_i$ 是 $\\mathbb{R}^n$ 中的第 $i$ 个标准基向量。\n- 要计算 $v_i$ 的最大值，最小化 $f = -e_i$，然后对最优目标值取负。\n- 在两个 LP 问题中都使用单一的、鲁棒的 LP 方法，并采用相同的求解器设置，以便一致地应用相同的最优性切割和容差。对于内点法或混合求解器的合适设置包括启用预处理（presolve），并将原始和对偶可行性容差（以及最优性容差）设置为相同的小值（例如 $10^{-9}$），以确保在多次求解中一致地执行等式和不等式约束。\n\n测试套件的解释和预期结果：\n- 测试用例 1：\n  约束条件为 $S v = 0$，其中 $S = \\begin{bmatrix} 1  -1  0  -1 \\\\ 0  1  -1  0 \\end{bmatrix}$，边界为 $l = [0, 0, 0, 0]$，$u = [10, 1000, 1000, 1000]$，目标为 $c = [0, 0, 1, 1]$，且 $z^\\star = 10$。从 $S v = 0$ 可得 $v_3 = v_2$ 和 $v_1 = v_2 + v_4$。目标函数为 $c^\\top v = v_3 + v_4 = v_2 + v_4 = v_1$，受限于 $v_1 \\le 10$，因此 $z^\\star = 10$。在最优性切割 $c^\\top v \\ge 10 - \\varepsilon$ 下，可行集具有 $v_1 \\approx 10$，$v_2$ 可以与 $v_4$ 自由变化，同时保持 $v_2 + v_4 = 10$。因此，$v_2 \\in [0, 10]$。反应 $i = 1$（第二个反应）的 FVA 范围是 $[0, 10]$。\n- 测试用例 2：\n  当 $S = \\begin{bmatrix} 1  -1  1  0 \\\\ 0  1  -1  -1 \\end{bmatrix}$，$l = [0, 0, 0, 0]$，$u = [5, 1005, 1000, 1000]$，$c = [0, 0, 0, 1]$ 且 $z^\\star = 5$ 时，质量平衡给出 $v_3 = v_2 - v_1$ 和 $v_4 = v_2 - v_3 = v_1$。因此，目标 $c^\\top v = v_4 = v_1$ 受限于 $v_1 \\le 5$，得到 $z^\\star = 5$。在切割 $c^\\top v \\ge 5 - \\varepsilon$ 下，我们有 $v_1 \\approx 5$。$v_3$ 的边界得出 $0 \\le v_3 = v_2 - 5 \\le 1000$，所以 $v_2 \\in [5, 1005]$。反应 $i = 1$（第二个反应）的 FVA 范围是 $[5, 1005]$。\n- 测试用例 3：\n  当 $S = \\begin{bmatrix} 1  -1  0  0 \\\\ 0  1  -1  -1 \\\\ 0  0  0  1 \\end{bmatrix}$，$l = [0, 0, 0, 0]$，$u = [3, 1000, 1000, 1000]$，$c = [0, 0, 1, 0]$ 且 $z^\\star = 3$ 时，由于代谢物 $C$ 没有汇，C 行意味着在稳态下 $v_4 = 1 \\cdot v_4 = 0$。目标是 $c^\\top v = v_3 = v_2$，并且从 A 行可知 $v_1 = v_2$，因此摄取边界 $v_1 \\le 3$ 强制 $z^\\star = 3$。在最优性切割 $c^\\top v \\ge 3 - \\varepsilon$ 下，$v_4$ 仍然被 C 行阻塞，从而精确地得到 $v_4 = 0$。反应 $i = 3$ 的 FVA 范围是 $[0, 0]$。\n- 测试用例 4：\n  当 $S = \\begin{bmatrix} 1  -1 \\end{bmatrix}$，$l = [0, 0]$，$u = [2.5, 1000]$，$c = [0, 1]$ 且 $z^\\star = 2.5$ 时，从稳态我们得到 $v_2 = v_1$，且目标是 $c^\\top v = v_2$。边界 $v_1 \\le 2.5$ 强制 $z^\\star = 2.5$，而最优性切割 $c^\\top v \\ge 2.5 - \\varepsilon$ 强制 $v_2 \\approx 2.5$ 和 $v_1 \\approx 2.5$。因此，反应 $i = 0$（第一个反应）的 FVA 范围是 $[2.5, 2.5]$。\n\n求解器设置和一致的最优性切割：\n为确保每个测试用例的两个 LP 问题之间的一致性，请使用单一的 LP 方法，并对原始可行性、对偶可行性和最优性使用相同的容差。启用预处理（presolve）有助于识别冗余约束并对问题进行缩放。例如，将原始可行性容差和对偶可行性容差都设置为 $10^{-9}$，同时将最优性容差也设置为 $10^{-9}$，可以确保不等式 $-c^\\top v \\le -(z^\\star - \\varepsilon)$ 在最小化和最大化问题中都得到统一的执行。在两个 LP 求解中使用相同的求解器和相同的选项，可以保证对最优性切割和等式约束的任何数值处理都是相同的，从而避免因数值容差或预处理行为不同而产生的差异。\n\n实现说明：\n- 将最优性切割编码为 $A_{\\text{ub}} = -c^\\top$ 和 $b_{\\text{ub}} = -(z^\\star - \\varepsilon)$。\n- 最小化 $e_i^\\top v$ 以获得 $\\min v_i$。最小化 $-e_i^\\top v$ 并对所得最优值取负以获得 $\\max v_i$。\n- 对反应使用从零开始的索引。\n- 返回每对 $[\\min v_i, \\max v_i]$，四舍五入到 $6$ 位小数，单位为 $\\text{mmol}\\,\\text{gDW}^{-1}\\,\\text{h}^{-1}$。\n\n基于以上推导，预期的最终输出为：\n- 测试用例 1：$[0.000000, 10.000000]$，\n- 测试用例 2：$[5.000000, 1005.000000]$，\n- 测试用例 3：$[0.000000, 0.000000]$，\n- 测试用例 4：$[2.500000, 2.500000]$。\n\n程序将通过使用一致的求解器设置求解相应的 LP 问题来计算这些值，并打印出格式为 $[[0.000000,10.000000],[5.000000,1005.000000],[0.000000,0.000000],[2.500000,2.500000]]$ 的单行结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef fva_range(S, lb, ub, c, i, z_star, opt_tol):\n    \"\"\"\n    Compute FVA min and max for reaction i under the optimality cut c^T v = z_star - opt_tol.\n    Uses two LP solves with identical solver settings to ensure consistency.\n    \"\"\"\n    S = np.array(S, dtype=float)\n    lb = np.array(lb, dtype=float)\n    ub = np.array(ub, dtype=float)\n    c = np.array(c, dtype=float)\n    n = S.shape[1]\n\n    # Equality constraints: S v = 0\n    A_eq = S\n    b_eq = np.zeros(S.shape[0], dtype=float)\n\n    # Optimality cut: -c^T v = -(z_star - opt_tol)\n    A_ub = -c.reshape(1, -1)\n    b_ub = np.array([-(z_star - opt_tol)], dtype=float)\n\n    # Bounds as list of tuples\n    bounds = [(float(lb[j]), float(ub[j])) for j in range(n)]\n\n    # Objective vectors\n    e_i = np.zeros(n, dtype=float)\n    e_i[i] = 1.0\n\n    # Common solver options to ensure consistent use of the optimality cut\n    options = {\n        \"presolve\": True,\n        \"dual_feasibility_tolerance\": 1e-9,\n        \"primal_feasibility_tolerance\": 1e-9,\n        \"ipm_optimality_tolerance\": 1e-9,\n    }\n\n    # Minimize v_i\n    res_min = linprog(\n        c=e_i,\n        A_ub=A_ub,\n        b_ub=b_ub,\n        A_eq=A_eq,\n        b_eq=b_eq,\n        bounds=bounds,\n        method=\"highs\",\n        options=options,\n    )\n    if not res_min.success:\n        min_val = float(\"nan\")\n    else:\n        min_val = res_min.fun\n\n    # Maximize v_i by minimizing -v_i\n    res_max = linprog(\n        c=-e_i,\n        A_ub=A_ub,\n        b_ub=b_ub,\n        A_eq=A_eq,\n        b_eq=b_eq,\n        bounds=bounds,\n        method=\"highs\",\n        options=options,\n    )\n    if not res_max.success:\n        max_val = float(\"nan\")\n    else:\n        max_val = -res_max.fun\n\n    # Numerical guard: clamp within bounds and round to 6 decimals\n    if not np.isnan(min_val):\n        min_val = max(min_val, lb[i] - 1e-9)\n        min_val = min(min_val, ub[i] + 1e-9)\n    if not np.isnan(max_val):\n        max_val = max(max_val, lb[i] - 1e-9)\n        max_val = min(max_val, ub[i] + 1e-9)\n\n    # Round to 6 decimal places as required\n    min_val = float(f\"{min_val:.6f}\") if not np.isnan(min_val) else min_val\n    max_val = float(f\"{max_val:.6f}\") if not np.isnan(max_val) else max_val\n\n    return [min_val, max_val]\n\ndef solve():\n    # Define the test cases from the problem statement: (S, l, u, c, i, z_star, epsilon)\n    test_cases = [\n        # Test case 1\n        (\n            [[1, -1, 0, -1],\n             [0,  1, -1,  0]],\n            [0, 0, 0, 0],\n            [10, 1000, 1000, 1000],\n            [0, 0, 1, 1],\n            1,\n            10.0,\n            1e-7,\n        ),\n        # Test case 2\n        (\n            [[1, -1,  1,  0],\n             [0,  1, -1, -1]],\n            [0, 0, 0, 0],\n            [5, 1005, 1000, 1000],\n            [0, 0, 0, 1],\n            1,\n            5.0,\n            1e-8,\n        ),\n        # Test case 3\n        (\n            [[1, -1, 0, 0],\n             [0,  1, -1, -1],\n             [0,  0, 0, 1]],\n            [0, 0, 0, 0],\n            [3, 1000, 1000, 1000],\n            [0, 0, 1, 0],\n            3,\n            3.0,\n            1e-9,\n        ),\n        # Test case 4\n        (\n            [[1, -1]],\n            [0, 0],\n            [2.5, 1000],\n            [0, 1],\n            0,\n            2.5,\n            1e-12,\n        ),\n    ]\n\n    results = []\n    for S, l, u, c, i, z_star, eps in test_cases:\n        r = fva_range(S, l, u, c, i, z_star, eps)\n        results.append(r)\n\n    # Format results as a single line: [[min1,max1],[min2,max2],...]\n    pair_strings = []\n    for pair in results:\n        # Ensure fixed 6-decimal formatting in the output string\n        a, b = pair\n        sa = f\"{a:.6f}\" if not np.isnan(a) else \"nan\"\n        sb = f\"{b:.6f}\" if not np.isnan(b) else \"nan\"\n        pair_strings.append(f\"[{sa},{sb}]\")\n\n    print(f\"[{','.join(pair_strings)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "通量变异性源于代谢网络固有的冗余性，这可能导致存在多个等效的最优解，即“替代最优”（alternative optima）。本练习将引导您从计算转向分析推导，深入探究通量变异的几何本质。通过手动分析一个小型网络，您将揭示不同通量组合如何能够达成相同的最优目标值，并理解这正是通量变异区间存在的原因。",
            "id": "3913850",
            "problem": "考虑一个合成构建体的最小约束代谢模型，该模型具有两种内代谢物 $X$ 和 $Y$，以及四个反应：$R_1$（摄取）、$R_5$（生物质形成）、$R_6$（$X \\to Y$）和 $R_7$（$Y \\to X$）。设通量向量为 $v = (v_1, v_5, v_6, v_7)^{\\top}$，按 $(R_1, R_5, R_6, R_7)$ 的顺序排列。内部质量平衡通过稳态约束 $S v = 0$ 强制执行，其中关于代谢物 $(X, Y)$ 的化学计量矩阵 $S$ 为\n$$\nS \\;=\\; \\begin{pmatrix}\n1  -1  -1  1 \\\\\n0  0  1  -1\n\\end{pmatrix}.\n$$\n所有反应都是不可逆的，具有以下边界：$0 \\leq v_1 \\leq 10$，$0 \\leq v_5 \\leq 100$，$0 \\leq v_6 \\leq 8$ 和 $0 \\leq v_7 \\leq 8$。目标函数是最大化生物质形成，即最大化 $c^{\\top} v$，其中 $c = (0, 1, 0, 0)^{\\top}$。通量变异性分析（FVA）的定义是，在目标值保持其最大值的约束下，确定每个反应 $i$ 在可行集上 $v_i$ 的最小值和最大值。\n\n仅从稳态质量平衡 $S v = 0$、线性通量边界和线性目标 $c^{\\top} v$ 的原理出发，并且不使用任何快捷公式，完成以下任务：\n- 推导由 $S v = 0$ 得出的 $v_1$、$v_5$、$v_6$ 和 $v_7$ 之间的关系。\n- 解释为什么最优目标值 $z^{*}$ 可以通过多个不同的通量向量（多重最优解）实现，并构建两个明确、不同的可行通量向量，它们在满足所有约束的同时都能达到相同的最优值 $z^{*}$。\n- 在目标保持在 $z^{*}$ 的附加约束下，对反应 $R_6$ 进行通量变异性分析（FVA），并计算 $v_6$ 的 FVA 区间宽度，该宽度定义为在最优条件下其最大可行值与最小可行值之差。\n\n将您的最终数值答案（区间宽度）以 $\\mathrm{mmol}\\ \\mathrm{gDW}^{-1}\\ \\mathrm{h}^{-1}$ 为单位表示，其中 $\\mathrm{gDW}$ 表示克干重。如果需要四舍五入，请将答案保留四位有效数字；如果数值是精确的，则无需四舍五入。",
            "solution": "首先根据指定标准对问题进行验证。\n\n### 第1步：提取已知条件\n- **代谢物**：两种内代谢物，$X$ 和 $Y$。\n- **反应**：四个反应，$R_1$（摄取）、$R_5$（生物质形成）、$R_6$（$X \\to Y$）和 $R_7$（$Y \\to X$）。\n- **通量向量**：$v = (v_1, v_5, v_6, v_7)^{\\top}$，对应于反应 $(R_1, R_5, R_6, R_7)$。\n- **化学计量矩阵**：关于代谢物 $(X, Y)$ 的化学计量矩阵 $S$ 如下所示\n$$ S = \\begin{pmatrix} 1  -1  -1  1 \\\\ 0  0  1  -1 \\end{pmatrix}. $$\n- **稳态约束**：$S v = 0$。\n- **通量边界**：\n    - $0 \\leq v_1 \\leq 10$\n    - $0 \\leq v_5 \\leq 100$\n    - $0 \\leq v_6 \\leq 8$\n    - $0 \\leq v_7 \\leq 8$\n- **目标函数**：最大化 $z = c^{\\top} v$，其中 $c = (0, 1, 0, 0)^{\\top}$，这等同于最大化 $v_5$。\n- **FVA 定义**：在目标值保持其最大值 $z^*$ 的附加约束下，确定每个 $v_i$ 在可行集上的最小值和最大值。\n- **最终输出要求**：$v_6$ 的 FVA 区间宽度，以 $\\mathrm{mmol}\\ \\mathrm{gDW}^{-1}\\ \\mathrm{h}^{-1}$ 为单位表示。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，是基于约束的代谢建模的标准应用，特别是通量平衡分析（FBA）和通量变异性分析（FVA）。其数学公式基于线性规划，这是一个成熟且严谨的框架。该问题是适定的，提供了化学计量矩阵、通量边界和一个线性目标函数，这些定义了一个有界可行空间，从而保证了解的存在性。该问题是客观的，并使用精确的数学语言。问题设置中没有科学或事实上的不健全之处，没有矛盾，也没有未定义的术语。虽然问题陈述为最终答案指定了单位，而这些单位在已知条件中并未定义（问题是用无量纲量来表述的），但这只是对最终输出格式的说明，并非问题内部逻辑或维度一致性的缺陷。因此，可以推导出有效的解。\n\n### 第3步：结论与行动\n问题有效。现在开始求解过程。\n\n按照要求，解分为三个部分推导。\n\n首先，我们从稳态质量平衡条件 $S v = 0$ 中推导通量 $v_1$、$v_5$、$v_6$ 和 $v_7$ 之间的关系。写出矩阵-向量乘积，得到一个由两个线性方程组成的方程组：\n$$ \\begin{pmatrix} 1  -1  -1  1 \\\\ 0  0  1  -1 \\end{pmatrix} \\begin{pmatrix} v_1 \\\\ v_5 \\\\ v_6 \\\\ v_7 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} $$\n该方程组的第二行立即得出方程：\n$$ (0)v_1 + (0)v_5 + (1)v_6 + (-1)v_7 = 0 \\implies v_6 - v_7 = 0 \\implies v_6 = v_7 $$\n这表明在稳态下，代谢物 $X$ 和 $Y$ 之间的正向和反向反应必须承载相同的通量，如果 $v_6 = v_7  0$，则形成一个无效循环。\n该方程组的第一行给出方程：\n$$ (1)v_1 + (-1)v_5 + (-1)v_6 + (1)v_7 = 0 \\implies v_1 - v_5 - v_6 + v_7 = 0 $$\n将结果 $v_6 = v_7$ 代入此方程，得到：\n$$ v_1 - v_5 - v_6 + v_6 = 0 \\implies v_1 - v_5 = 0 \\implies v_1 = v_5 $$\n这个关系表明，在稳态下，外部底物的摄取速率 ($v_1$) 必须等于生物质形成速率 ($v_5$) 。因此，这些关系是 $v_1 = v_5$ 和 $v_6 = v_7$。\n\n其次，我们确定最优目标值 $z^*$ 并解释多重最优解的存在性。目标是最大化 $z = v_5$。可行空间由稳态关系和通量边界定义。我们有关系 $v_1 = v_5$。通量 $v_1$ 的边界为 $0 \\leq v_1 \\leq 10$。将 $v_1$ 替换为 $v_5$ 代入此不等式，我们得到对 $v_5$ 的约束：$0 \\leq v_5 \\leq 10$。还有一个对 $v_5$ 的显式边界，$0 \\leq v_5 \\leq 100$。$v_5$ 的可行范围是这两个范围的交集，即 $[0, 10]$。因此，$v_5$ 的最大值为 $10$。最优目标值为 $z^{*} = 10$。\n\n存在多重最优解，因为目标函数 $z = v_5$ 的值完全由 $v_1$ 决定，并且与通量 $v_6$ 和 $v_7$ 无关。任何满足 $v_1 = v_5 = z^* = 10$ 并同时遵守对 $v_6$ 和 $v_7$ 约束的通量向量 $v = (v_1, v_5, v_6, v_7)^{\\top}$ 都是一个最优解。对 $v_6$ 和 $v_7$ 的约束是 $v_6 = v_7$，$0 \\leq v_6 \\leq 8$ 和 $0 \\leq v_7 \\leq 8$。这些约束结合起来得到 $0 \\leq v_6 \\leq 8$（其中 $v_7$ 等于 $v_6$）。由于 $v_6$ 可以在区间 $[0, 8]$ 内取任何实数值，因此存在无限多个不同的通量向量可以达到最优目标值。两个这样的明确、不同的可行通量向量是：\n1.  令 $v_6 = 0$。则 $v_7 = 0$。通量向量为 $v^{(1)} = (10, 10, 0, 0)^{\\top}$。该向量满足 $S v^{(1)} = 0$ 和所有通量边界，并给出目标值 $v_5 = 10$。\n2.  令 $v_6 = 8$。则 $v_7 = 8$。通量向量为 $v^{(2)} = (10, 10, 8, 8)^{\\top}$。该向量也满足 $S v^{(2)} = 0$ 和所有通量边界，并给出目标值 $v_5 = 10$。\n\n第三，我们对反应 $R_6$ 进行通量变异性分析（FVA）并计算其区间的宽度。对 $v_6$ 进行 FVA 需要在满足原始约束以及目标函数保持其最大值（即 $v_5 = z^* = 10$）这一新约束的条件下，找到 $v_6$ 的最小和最大可能值。\nFVA 的完整约束集是：\n1.  $v_1 = v_5$\n2.  $v_6 = v_7$\n3.  $0 \\leq v_1 \\leq 10$\n4.  $0 \\leq v_5 \\leq 100$\n5.  $0 \\leq v_6 \\leq 8$\n6.  $0 \\leq v_7 \\leq 8$\n7.  $v_5 = 10$\n根据约束7，我们有 $v_5 = 10$。根据约束1，可得 $v_1 = 10$。这些值与约束3和4一致。剩下的约束适用于 $v_6$ 和 $v_7$。根据约束2，我们有 $v_6=v_7$。独立边界是 $0 \\leq v_6 \\leq 8$（约束5）和 $0 \\leq v_7 \\leq 8$（约束6）。将 $v_7=v_6$ 代入 $v_7$ 的边界，得到 $0 \\leq v_6 \\leq 8$，这与 $v_6$ 的原始边界相同。因此，在最优生物质形成的条件下，通量 $v_6$ 可以在其允许范围内取任何可行值。\n求 $v_6$ 最小值的 FVA 问题是在这些约束下最小化 $v_6$。最小值显然是 $v_{6, \\min} = 0$。\n求 $v_6$ 最大值的 FVA 问题是在这些约束下最大化 $v_6$。最大值显然是 $v_{6, \\max} = 8$。\n$v_6$ 的 FVA 区间是 $[0, 8]$。\n该区间的宽度是最大值与最小值之差：\n$$ \\text{宽度} = v_{6, \\max} - v_{6, \\min} = 8 - 0 = 8 $$\n该问题是用无量纲数表述的。根据说明，我们将指定的单位附加到这个最终数值结果上。$v_6$ 的 FVA 区间宽度为 $8\\ \\mathrm{mmol}\\ \\mathrm{gDW}^{-1}\\ \\mathrm{h}^{-1}$。",
            "answer": "$$\n\\boxed{8}\n$$"
        },
        {
            "introduction": "通量变异性分析不仅是一个理论概念，更是在系统生物学和合成生物学中用于指导实验设计的强大预测工具。本练习将FVA应用于一个实际研究场景：通过模拟基因敲除来识别“合成致死”的反应对。您将通过观察关键代谢途径中通量变异区间的“坍缩”，来预测联合干预如何重塑网络的稳态行为，从而体会FVA在功能基因组学和代谢工程中的应用价值。",
            "id": "3913859",
            "problem": "给定一个最小代谢网络，旨在表示一个适用于流变异性分析 (FVA) 的简化生物质合成模块。流变异性分析 (FVA) 的定义是，在稳定状态可行域内，同时强制目标在指定水平上，计算一个流变量的可行最小值和最大值。基因-蛋白质-反应 (GPR) 映射提供了基因、蛋白质和反应之间的对应关系，但对于此问题，您将通过直接将反应流约束为零来模拟基因干预。\n\n基本原理：\n- 内部代谢物的稳态质量平衡由一个化学计量矩阵和净生成速率为零的条件所捕捉。\n- 线性规划在线性等式约束（用于稳态）和边界约束（用于反应不可逆性和容量）下求解。\n- 流变异性分析将目标反应设定为一个固定值，然后为每个感兴趣的反应求解两个线性规划问题，以获得可行的最小值和最大值。\n\n网络规格：\n- 内部代谢物：$A$、$B$、$C$、$P$。\n- 反应（括号内为索引）：\n  - $(0)$ $R_1$：外部摄取 $\\rightarrow A$，边界 $0 \\le v_0 \\le 10$。\n  - $(1)$ $R_2$：$A \\rightarrow B$，边界 $0 \\le v_1 \\le 1000$。\n  - $(2)$ $R_3$：$A \\rightarrow C$，边界 $0 \\le v_2 \\le 1000$。\n  - $(3)$ $R_4$：$B \\rightarrow P$，边界 $0 \\le v_3 \\le 1000$。\n  - $(4)$ $R_5$：$C \\rightarrow P$，边界 $0 \\le v_4 \\le 1000$。\n  - $(5)$ $R_6$：$P \\rightarrow$ 生物质流出，边界 $0 \\le v_5 \\le 1000$，在最优生长计算中待最大化的目标。\n- 内部代谢物按 $(A,B,C,P)$ 排序，反应按 $(R_1,\\dots,R_6)$ 排序的化学计量矩阵 $S \\in \\mathbb{R}^{4 \\times 6}$：\n  - $A$ 对应的行：$(+1,-1,-1,0,0,0)$，\n  - $B$ 对应的行：$(0,+1,0,-1,0,0)$，\n  - $C$ 对应的行：$(0,0,+1,0,-1,0)$，\n  - $P$ 对应的行：$(0,0,0,+1,+1,-1)$。\n- 通过 FVA 监控的生物质相关反应：$R_4$ 和 $R_5$（索引为 $3$ 和 $4$）。\n\n在此背景下合成致死的定义：如果两个反应单独删除都不会消除获得严格正最优生物质流的能力，但它们共同作用时，在稳态和边界约束下将最优生物质流降至零，则称这两个反应删除是合成致死的。\n\n针对每次干预（成对反应删除）的计算任务：\n1. 通过最大化 $v_5$ 计算最优生物质流 $v_5^\\star$，约束条件为稳态约束 $S v = 0$ 和所有 $j$ 的边界 $0 \\le v_j \\le U_j$，其中任何被删除的反应其边界都固定为 $v_j = 0$。\n2. 通过在稳态约束中加入等式约束 $v_5 = v_5^\\star$ 来在强制的最优生物质水平上执行流变异性分析 (FVA)，然后，对于每个生物质相关反应 $R_4$ 和 $R_5$，在这些约束下计算可行的最小值和最大值 $(v_3^{\\min}, v_3^{\\max})$ 和 $(v_4^{\\min}, v_4^{\\max})$。\n3. 将反应 $R_i$ 的 FVA 范围塌陷定义为条件 $v_i^{\\max} - v_i^{\\min} \\le \\varepsilon$，容差为 $\\varepsilon = 10^{-7}$。判断 $R_4$ 和 $R_5$ 是否都表现出范围塌陷。\n\n解释要求：根据通路冗余和 GPR 启发的干预效应，解释组合删除如何改变可行空间，并导致生物质相关反应的 FVA 范围保持不变或塌陷。\n\n测试套件：\n- 使用以下五个干预案例，每个案例都由反应索引的有序对指定删除。哨兵值 $\\mathrm{None}$ 表示该位置没有删除。\n  - 案例 1：$(\\mathrm{None}, \\mathrm{None})$。\n  - 案例 2：$(1, \\mathrm{None})$。\n  - 案例 3：$(1, 2)$。\n  - 案例 4：$(1, 4)$。\n  - 案例 5：$(4, \\mathrm{None})$。\n对于每个案例，通过将相应反应流的边界设置为 $v_j = 0$ 来强制执行删除。\n\n输出规格：\n- 对于上面列出的每个案例，输出一个布尔值，指示在强制的最优生物质约束下，$R_4$ 和 $R_5$ 的 FVA 范围是否都塌陷。您的程序应生成一行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，`[result1,result2,result3,result4,result5]`）。\n\n所有流都是抽象的稳态流；输出中不需要进行物理单位转换，因为要求的答案是布尔值。",
            "solution": "问题陈述具有科学依据、问题明确、客观且完整。它描述了合成生物学和代谢工程领域的一项标准计算任务，具体来说是流平衡分析 (FBA) 和流变异性分析 (FVA) 在一个简化代谢网络上的应用。网络、约束和计算目标都得到了明确定义，从而可以得到唯一且可验证的解。因此，该问题是有效的。\n\n该解决方案需要为每个指定的干预案例执行一个两阶段的计算过程，两个阶段都使用线性规划 (LP) 实现。一个 LP 问题旨在在满足线性等式和不等式约束的条件下，优化一个线性目标函数。其一般形式为：\n$$\n\\begin{align*}\n\\text{minimize} \\quad  c^T v \\\\\n\\text{subject to} \\quad  A_{eq} v = b_{eq} \\\\\n lb \\le v \\le ub\n\\end{align*}\n$$\n其中 $v$ 是变量（流）向量，$c$ 是目标向量，$A_{eq}$ 是等式约束矩阵，$b_{eq}$ 是对应的右侧向量，$lb$ 和 $ub$ 分别是变量的下界和上界。\n\n代谢网络由化学计量矩阵 $S$ 定义。稳态假设施加了质量平衡约束 $S v = 0$，其中 $v = [v_0, v_1, v_2, v_3, v_4, v_5]^T$ 是反应流向量。在 LP 公式中，这对应于 $A_{eq} = S$ 和 $b_{eq} = 0$。反应边界提供了向量 $lb$ 和 $ub$。\n\n**网络结构与通路分析**\n\n在详细说明计算之前，我们先分析网络的拓扑结构。营养物流通过 $R_1$ （摄取外部底物，生成 $A$）进入系统，最大速率为 $v_0 = 10$。代谢物 $A$ 是一个前体，可以通过两条平行通路转化为代谢物 $P$：\n1.  **通路 B：** $A \\xrightarrow{R_2} B \\xrightarrow{R_4} P$。流通过质量平衡耦合：$v_1 = v_3$。\n2.  **通路 C：** $A \\xrightarrow{R_3} C \\xrightarrow{R_5} P$。流通过质量平衡耦合：$v_2 = v_4$。\n\n代谢物 $P$ 是生物质的前体，由反应 $R_6$ 排出。$P$ 的稳态条件是 $v_3 + v_4 - v_5 = 0$，这意味着 $v_5 = v_3 + v_4$。$A$ 的稳态条件是 $v_0 - v_1 - v_2 = 0$，这意味着 $v_0 = v_1 + v_2$。将这些与通路耦合（$v_1=v_3$, $v_2=v_4$）相结合，我们发现 $v_5 = v_3+v_4 = v_1+v_2 = v_0$。这个基本关系 $v_5 = v_0$ 决定了最大可能的生物质生产速率受限于最大摄取速率，即 $v_5^{\\text{max}} = v_0^{\\text{max}} = 10$。这种代谢结构表现出冗余性：只要 $v_3+v_4=10$，生物质目标就达到最大，从而允许在通路 B 和通路 C 之间进行灵活的权衡。\n\n**计算阶段**\n\n对于每个干预案例（由一组反应删除定义）：\n\n**阶段 1：最优生物质计算 (FBA)**\n第一步是计算最大可能的生物质流 $v_5^\\star$。这是一个典型的 FBA 问题。我们求解以下 LP：\n$$\n\\begin{align*}\nv_5^\\star = \\max_{v} \\quad  v_5 \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n lb' \\le v \\le ub'\n\\end{align*}\n$$\n边界 $lb'$ 和 $ub'$ 是基本边界，根据案例中指定的任何反应删除进行修改。对于被删除的反应 $R_j$，其流 $v_{j-1}$ 通过将其下界和上界都设置为 0 来约束为零。\n\n**阶段 2：流变异性分析 (FVA)**\n找到最优生物质流 $v_5^\\star$ 后，我们添加一个约束，将生物质生产固定在此最优水平：$v_5 = v_5^\\star$。这将可行流空间限制在关于生物质生产的最优解上。\n对于每个感兴趣的目标反应 $R_i$（这里是 $R_4$ 和 $R_5$，对应于流 $v_3$ 和 $v_4$），我们接着求解两个 LP 问题以找到其可行的最小和最大流：\n$$\n\\begin{align*}\nv_i^{\\min} = \\min_{v} \\quad  v_i \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n v_5 = v_5^\\star \\\\\n lb' \\le v \\le ub'\n\\end{align*}\n$$\n$$\n\\begin{align*}\nv_i^{\\max} = \\max_{v} \\quad  v_i \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n v_5 = v_5^\\star \\\\\n lb' \\le v \\le ub'\n\\end{align*}\n$$\n如果 $v_i^{\\max} - v_i^{\\min} \\le \\varepsilon$（给定容差 $\\varepsilon = 10^{-7}$），则认为反应 $R_i$ 的范围“塌陷”。当且仅当 $R_4$ 和 $R_5$ 的范围都塌陷时，该案例的最终布尔结果为真。\n\n**测试案例分析**\n\n1.  **案例 1（无删除）：** $v_5^\\star = 10$。FVA 在 $v_5 = 10$ 和 $v_3 + v_4 = 10$ 的约束下执行。只要 $v_3$ 和 $v_4$ 的和为 10，它们之间的任何流分布都是可能的（例如，$(v_3, v_4) = (10, 0)$ 或 $(0, 10)$ 或 $(5, 5)$）。因此，$v_3^{\\min}=0, v_3^{\\max}=10$ 且 $v_4^{\\min}=0, v_4^{\\max}=10$。两者范围均未塌陷。**结果：False。**\n\n2.  **案例 2（删除 $R_2$）：** 删除 $R_2$ 会设置 $v_1=0$，这意味着 $v_3=0$。整个通路 B 被关闭。要产生生物质，所有流必须通过通路 C。因此 $v_5 = v_4$。最优生物质仍为 $v_5^\\star = 10$，因为通路 C 可以承载全部流（$v_2 = v_4 = v_5 = v_0 = 10$）。在 $v_5=10$ 的约束下，流分布是唯一确定的：$v_3=0$ 和 $v_4=10$。$v_3$ 和 $v_4$ 的范围都塌陷为单点（分别为 $[0,0]$ 和 $[10,10]$）。**结果：True。**\n\n3.  **案例 3（删除 $R_2, R_3$）：** 删除 $R_2$ ($v_1=0$) 和 $R_3$ ($v_2=0$) 会阻断从代谢物 $A$ 出发的两条平行通路。这意味着 $v_3 = v_1 = 0$ 和 $v_4 = v_2 = 0$。因此，$v_5 = v_3 + v_4 = 0$。最优生物质是 $v_5^\\star = 0$。这是一个合成致死对。在 $v_5^\\star=0$ 时，唯一可行的解是 $v=0$。$v_3$ 和 $v_4$ 的范围因此为 $[0,0]$。两者都塌陷。**结果：True。**\n\n4.  **案例 4（删除 $R_2, R_5$）：** 删除 $R_2$ ($v_1=0$) 会关闭通路 B，因此 $v_3=0$。删除 $R_5$ ($v_4=0$) 会关闭通路 C。由于通往 $P$ 的两条通路都被阻断，所以 $v_5 = v_3+v_4 = 0$。这是另一个合成致死对。最优生物质是 $v_5^\\star = 0$。与案例 3 一样，所有流都必须为零，所以 $v_3$ 和 $v_4$ 的范围塌陷。**结果：True。**\n\n5.  **案例 5（删除 $R_5$）：** 此案例与案例 2 对称。删除 $R_5$ 会设置 $v_4=0$，关闭通路 C。所有流必须通过通路 B。最优生物质是 $v_5^\\star = 10$。在此最优条件下，流是唯一确定的：$v_4=0$ 和 $v_3=10$。$v_3$ 和 $v_4$ 的范围都塌陷。**结果：True。**\n\n实现将遵循此逻辑，使用 `scipy.optimize.linprog` 为每个案例求解所需的 LP 问题。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the Flux Variability Analysis problem for a given metabolic network\n    under different gene knockout conditions.\n    \"\"\"\n    \n    # Stoichiometric matrix S for metabolites (A, B, C, P) and reactions (R1-R6)\n    S = np.array([\n        [1, -1, -1,  0,  0,  0],  # A\n        [0,  1,  0, -1,  0,  0],  # B\n        [0,  0,  1,  0, -1,  0],  # C\n        [0,  0,  0,  1,  1, -1]   # P\n    ])\n    \n    num_reactions = S.shape[1]\n\n    # Base bounds for all reactions v0 to v5\n    base_lb = np.array([0, 0, 0, 0, 0, 0], dtype=float)\n    base_ub = np.array([10, 1000, 1000, 1000, 1000, 1000], dtype=float)\n    \n    # Reactions to monitor with FVA (indices 3 and 4 for R4 and R5)\n    fva_targets = [3, 4]\n    \n    # Numerical tolerance for range collapse\n    epsilon = 1e-7\n\n    # Test cases: tuples of reaction indices to delete (None for no deletion)\n    # Indices correspond to v0, v1, ..., v5\n    test_cases = [\n        (None, None),  # Case 1\n        (1, None),     # Case 2: delete R2\n        (1, 2),        # Case 3: delete R2, R3\n        (1, 4),        # Case 4: delete R2, R5\n        (4, None)      # Case 5: delete R5\n    ]\n\n    final_results = []\n\n    for deletions in test_cases:\n        # 1. SETUP for the current case\n        current_lb = base_lb.copy()\n        current_ub = base_ub.copy()\n        \n        for del_idx in deletions:\n            if del_idx is not None:\n                current_lb[del_idx] = 0.0\n                current_ub[del_idx] = 0.0\n        \n        bounds = list(zip(current_lb, current_ub))\n        \n        # 2. FBA: Compute optimal biomass flux (v5_star)\n        # We maximize v5, which is equivalent to minimizing -v5.\n        c_fba = np.zeros(num_reactions)\n        c_fba[5] = -1.0\n        \n        res_fba = linprog(\n            c=c_fba,\n            A_eq=S,\n            b_eq=np.zeros(S.shape[0]),\n            bounds=bounds,\n            method='highs'\n        )\n\n        if not res_fba.success:\n            # Handle infeasible cases (e.g., lethal knockouts)\n            v5_star = 0.0\n        else:\n            v5_star = -res_fba.fun\n        \n        # Clamp near-zero values to zero to avoid floating point issues\n        if v5_star  epsilon:\n            v5_star = 0.0\n            \n        # 3. FVA: Compute min/max for target fluxes with v5 fixed at v5_star\n        fva_bounds = list(zip(current_lb, current_ub))\n        fva_bounds[5] = (v5_star, v5_star) # Enforce optimal biomass\n        \n        collapsed_flags = []\n        for target_idx in fva_targets:\n            # Minimize target flux\n            c_fva_min = np.zeros(num_reactions)\n            c_fva_min[target_idx] = 1.0\n            res_min = linprog(\n                c=c_fva_min,\n                A_eq=S,\n                b_eq=np.zeros(S.shape[0]),\n                bounds=fva_bounds,\n                method='highs'\n            )\n            v_min = res_min.fun if res_min.success else 0.0\n            \n            # Maximize target flux (by minimizing its negative)\n            c_fva_max = np.zeros(num_reactions)\n            c_fva_max[target_idx] = -1.0\n            res_max = linprog(\n                c=c_fva_max,\n                A_eq=S,\n                b_eq=np.zeros(S.shape[0]),\n                bounds=fva_bounds,\n                method='highs'\n            )\n            v_max = -res_max.fun if res_max.success else 0.0\n\n            # Check if the range has collapsed\n            is_collapsed = (v_max - v_min) = epsilon\n            collapsed_flags.append(is_collapsed)\n            \n        # 4. Final boolean result for the case (both must collapse)\n        final_results.append(all(collapsed_flags))\n\n    # Format the output as specified\n    print(f\"[{','.join(map(str, final_results))}]\".replace(\"True\", \"true\").replace(\"False\", \"false\"))\n\nsolve()\n```"
        }
    ]
}