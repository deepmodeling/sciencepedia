{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of any metabolic model is the stoichiometric matrix, $S$. This exercise provides practice in the fundamental skill of translating a set of biochemical reactions into this precise mathematical representation, which is the essential first step for all subsequent analyses like Flux Balance Analysis. By systematically encoding reactants and products, you will build the foundational data structure that enables quantitative prediction of metabolic capabilities.",
            "id": "1445692",
            "problem": "In systems biology, metabolic networks are often represented mathematically to analyze their properties. Consider a simplified, hypothetical linear metabolic pathway within a cell. This pathway is responsible for converting an external nutrient, A, into a valuable product, D, via two intermediate compounds, B and C. The entire process is described by the following three irreversible biochemical reactions, denoted R1, R2, and R3:\n\nReaction R1: $A \\rightarrow B$\nReaction R2: $2B \\rightarrow C$\nReaction R3: $C \\rightarrow D$\n\nYour task is to construct the stoichiometric matrix, $S$, for this metabolic network. The matrix must be organized such that its rows correspond to the metabolites in the order A, B, C, D, and its columns correspond to the reactions in the order R1, R2, R3. Follow the standard convention where the stoichiometric coefficient for a consumed metabolite (a reactant) is negative, and for a produced metabolite (a product) is positive.",
            "solution": "We define the stoichiometric matrix $S$ such that $S_{i,j}$ is the stoichiometric coefficient of metabolite $i$ in reaction $j$, with negative values for consumed reactants and positive values for produced products. The rows are ordered as $A$, $B$, $C$, $D$, and the columns as $\\text{R1}$, $\\text{R2}$, $\\text{R3}$.\n\nFor reaction $\\text{R1}$, which converts $A$ to $B$, one unit of $A$ is consumed and one unit of $B$ is produced:\n$$\nS_{\\text{A},\\text{R1}}=-1,\\quad S_{\\text{B},\\text{R1}}=1,\\quad S_{\\text{C},\\text{R1}}=0,\\quad S_{\\text{D},\\text{R1}}=0.\n$$\n\nFor reaction $\\text{R2}$, which converts $2B$ to $C$, two units of $B$ are consumed and one unit of $C$ is produced:\n$$\nS_{\\text{A},\\text{R2}}=0,\\quad S_{\\text{B},\\text{R2}}=-2,\\quad S_{\\text{C},\\text{R2}}=1,\\quad S_{\\text{D},\\text{R2}}=0.\n$$\n\nFor reaction $\\text{R3}$, which converts $C$ to $D$, one unit of $C$ is consumed and one unit of $D$ is produced:\n$$\nS_{\\text{A},\\text{R3}}=0,\\quad S_{\\text{B},\\text{R3}}=0,\\quad S_{\\text{C},\\text{R3}}=-1,\\quad S_{\\text{D},\\text{R3}}=1.\n$$\n\nAssembling these entries with rows $(A,B,C,D)$ and columns $(\\text{R1},\\text{R2},\\text{R3})$ gives\n$$\nS=\\begin{pmatrix}\n-1  0  0 \\\\\n1  -2  0 \\\\\n0  1  -1 \\\\\n0  0  1\n\\end{pmatrix}.\n$$",
            "answer": "$$\\boxed{\\begin{pmatrix}-1  0  0 \\\\ 1  -2  0 \\\\ 0  1  -1 \\\\ 0  0  1\\end{pmatrix}}$$"
        },
        {
            "introduction": "A metabolic model needs a biologically relevant objective to predict cellular behavior, most commonly the maximization of growth. This practice guides you through the critical process of constructing a biomass pseudo-reaction, which mathematically defines growth by accounting for the precursor metabolites and energy required to synthesize cellular components . Mastering this allows you to derive a key component of genome-scale models directly from experimental data on a cell's macromolecular composition.",
            "id": "3917830",
            "problem": "A synthetic bacterium, denoted SynBact-X, is being modeled for Flux Balance Analysis (FBA), and requires a biomass pseudo-reaction that consumes precursor metabolites to produce $1$ gram of dry biomass. The biomass composition is described by macromolecular dry-weight fractions: protein $0.55$, ribonucleic acid (RNA) $0.20$, deoxyribonucleic acid (DNA) $0.03$, lipid $0.12$, cell wall polysaccharide $0.08$, and soluble pools (cofactors and ions) $0.02$. The following assumptions are adopted for reconstruction:\n\n- The biomass pseudo-reaction produces a single abstract product $Biomass$, where the stoichiometric coefficients of consumed precursors are defined as moles of each precursor required per gram dry weight of biomass.\n- The average residue molecular masses for incorporated macromolecular units are: amino acid residue $110$ $\\mathrm{g \\, mol^{-1}}$, ribonucleotide residue $330$ $\\mathrm{g \\, mol^{-1}}$, and deoxyribonucleotide residue $310$ $\\mathrm{g \\, mol^{-1}}$. Lipids and cell wall polysaccharides are treated as separate precursor pools whose energetic polymerization costs are neglected for this calculation.\n- The energetic cost of macromolecular polymerization is counted in adenosine triphosphate (ATP) equivalents: protein incorporation consumes $4$ ATP equivalents per amino acid residue, RNA polymerization consumes $1$ ATP equivalent per ribonucleotide residue, and DNA polymerization consumes $1$ ATP equivalent per deoxyribonucleotide residue. Here, “ATP equivalent” means any high-energy phosphate hydrolysis counted equivalently to ATP; thus, guanosine triphosphate (GTP) hydrolysis during translation is counted toward ATP equivalents.\n\nStarting from the law of conservation of mass and standard stoichiometric definitions, construct the biomass composition entries for protein, RNA, and DNA as moles of incorporated residues per gram dry weight, and from these derive the stoichiometric biomass reaction that consumes the precursor pools $AA\\_{\\mathrm{pool}}$ (amino acid pool), $NTP$ (ribonucleoside triphosphates), and $dNTP$ (deoxyribonucleoside triphosphates), together with the net ATP consumption required for polymerization. Then, compute the net ATP consumption coefficient of the biomass reaction as a single scalar equal to the millimoles of ATP equivalents consumed per gram dry weight.\n\nExpress the final ATP demand in millimoles per gram dry weight. Round your final answer to four significant figures.",
            "solution": "The problem is well-posed, scientifically grounded, and provides all necessary information for a unique solution. The data are internally consistent and physically realistic for a bacterial system. We proceed with the solution.\n\nThe fundamental task is to construct a portion of the biomass pseudo-reaction for a synthetic bacterium, focusing on the consumption of macromolecular precursors and the associated energetic cost in terms of adenosine triphosphate (ATP) equivalents. The goal is to determine the stoichiometric coefficient for ATP consumption per gram of dry weight (gDW) of biomass produced.\n\nThe stoichiometric coefficient, $\\nu_i$, for a given precursor metabolite $i$ in the biomass reaction is defined as the number of moles of that metabolite required to synthesize $1$ gram of dry biomass. This is derived from the principle of mass conservation. For a macromolecule, the molar quantity of its constituent monomeric units (residues) incorporated into $1$ gDW of biomass is calculated by dividing the mass fraction of the macromolecule ($w_i$, in units of $\\mathrm{g / gDW}$) by the average molecular mass of its incorporated residue ($M_i$, in units of $\\mathrm{g / mol}$).\n\nThe formula for the molar requirement of each residue type is:\n$$ \\nu_i = \\frac{w_i}{M_{i, \\text{residue}}} $$\n\nWe are given the following data:\nMass fractions:\n- Protein ($w_{prot}$): $0.55 \\, \\mathrm{g/gDW}$\n- RNA ($w_{RNA}$): $0.20 \\, \\mathrm{g/gDW}$\n- DNA ($w_{DNA}$): $0.03 \\, \\mathrm{g/gDW}$\n\nAverage residue molecular masses:\n- Amino acid residue ($M_{AA}$): $110 \\, \\mathrm{g \\, mol^{-1}}$\n- Ribonucleotide residue ($M_{NTP}$): $330 \\, \\mathrm{g \\, mol^{-1}}$\n- Deoxyribonucleotide residue ($M_{dNTP}$): $310 \\, \\mathrm{g \\, mol^{-1}}$\n\nFirst, we calculate the moles of each type of residue required to produce $1$ gDW of biomass. These values represent the stoichiometric coefficients for the precursor pools consumed in the biomass reaction.\n\nFor the amino acid pool ($AA_{\\mathrm{pool}}$) consumed for protein synthesis:\n$$ \\nu_{AA} = \\frac{w_{prot}}{M_{AA}} = \\frac{0.55 \\, \\mathrm{g/gDW}}{110 \\, \\mathrm{g \\, mol^{-1}}} = 0.005 \\, \\mathrm{mol/gDW} $$\n\nFor the ribonucleoside triphosphate pool ($NTP$) consumed for RNA synthesis:\n$$ \\nu_{NTP} = \\frac{w_{RNA}}{M_{NTP}} = \\frac{0.20 \\, \\mathrm{g/gDW}}{330 \\, \\mathrm{g \\, mol^{-1}}} = \\frac{2}{3300} \\, \\mathrm{mol/gDW} \\approx 6.06 \\times 10^{-4} \\, \\mathrm{mol/gDW} $$\n\nFor the deoxyribonucleoside triphosphate pool ($dNTP$) consumed for DNA synthesis:\n$$ \\nu_{dNTP} = \\frac{w_{DNA}}{M_{dNTP}} = \\frac{0.03 \\, \\mathrm{g/gDW}}{310 \\, \\mathrm{g \\, mol^{-1}}} = \\frac{3}{31000} \\, \\mathrm{mol/gDW} \\approx 9.68 \\times 10^{-5} \\, \\mathrm{mol/gDW} $$\n\nThe portion of the biomass pseudo-reaction concerning these precursors is:\n$$ \\nu_{AA} \\, AA_{\\mathrm{pool}} + \\nu_{NTP} \\, NTP + \\nu_{dNTP} \\, dNTP + \\dots \\rightarrow 1 \\, \\text{Biomass} $$\nNote that in a formal stoichiometric matrix for FBA, these coefficients for reactants would be negative.\n\nNext, we calculate the energetic cost of polymerization for each macromolecule, measured in moles of ATP equivalents consumed per gDW of biomass. The total ATP consumption, $\\nu_{ATP, \\text{total}}$, is the sum of the ATP consumed for protein, RNA, and DNA synthesis.\n\nThe energetic costs per residue incorporation are given as:\n- Protein synthesis ($E_{prot}$): $4 \\, \\mathrm{mol \\, ATP / mol \\, AA \\, residue}$\n- RNA synthesis ($E_{RNA}$): $1 \\, \\mathrm{mol \\, ATP / mol \\, NTP \\, residue}$\n- DNA synthesis ($E_{DNA}$): $1 \\, \\mathrm{mol \\, ATP / mol \\, dNTP \\, residue}$\n\nThe ATP consumption for each macromolecular synthesis is the product of the moles of residues and the energetic cost per residue:\n$$ \\nu_{ATP, i} = \\nu_i \\times E_i $$\n\nATP for protein synthesis:\n$$ \\nu_{ATP, prot} = \\nu_{AA} \\times E_{prot} = 0.005 \\, \\mathrm{mol/gDW} \\times 4 = 0.02 \\, \\mathrm{mol \\, ATP/gDW} $$\n\nATP for RNA synthesis:\n$$ \\nu_{ATP, RNA} = \\nu_{NTP} \\times E_{RNA} = \\frac{0.20}{330} \\, \\mathrm{mol/gDW} \\times 1 = \\frac{0.20}{330} \\, \\mathrm{mol \\, ATP/gDW} $$\n\nATP for DNA synthesis:\n$$ \\nu_{ATP, DNA} = \\nu_{dNTP} \\times E_{DNA} = \\frac{0.03}{310} \\, \\mathrm{mol/gDW} \\times 1 = \\frac{0.03}{310} \\, \\mathrm{mol \\, ATP/gDW} $$\n\nThe total net ATP consumption in moles per gDW is the sum of these components:\n$$ \\nu_{ATP, \\text{total}} = \\nu_{ATP, prot} + \\nu_{ATP, RNA} + \\nu_{ATP, DNA} $$\n$$ \\nu_{ATP, \\text{total}} = 0.02 + \\frac{0.20}{330} + \\frac{0.03}{310} \\, \\mathrm{mol/gDW} $$\n\nNow, we compute the numerical value:\n$$ \\frac{0.20}{330} \\approx 0.00060606 \\, \\mathrm{mol/gDW} $$\n$$ \\frac{0.03}{310} \\approx 0.00009677 \\, \\mathrm{mol/gDW} $$\n$$ \\nu_{ATP, \\text{total}} \\approx 0.02 + 0.00060606 + 0.00009677 = 0.02070283 \\, \\mathrm{mol/gDW} $$\n\nThe problem requires the final answer expressed in millimoles per gram dry weight ($\\mathrm{mmol/gDW}$). We convert the total ATP consumption from moles to millimoles by multiplying by $1000$:\n$$ C_{ATP} = \\nu_{ATP, \\text{total}} \\times 1000 \\, \\mathrm{mmol/mol} $$\n$$ C_{ATP} = \\left( 0.02 + \\frac{0.20}{330} + \\frac{0.03}{310} \\right) \\times 1000 \\, \\mathrm{mmol/gDW} $$\n$$ C_{ATP} \\approx 0.02070283 \\times 1000 = 20.70283 \\, \\mathrm{mmol/gDW} $$\n\nFinally, we round the result to four significant figures. The fifth significant figure is $2$, so we round down.\n$$ C_{ATP} \\approx 20.70 \\, \\mathrm{mmol/gDW} $$\nThis value represents the net ATP consumption coefficient for the biomass reaction.",
            "answer": "$$\\boxed{20.70}$$"
        },
        {
            "introduction": "Initial metabolic reconstructions from genomic data are often incomplete, containing \"gaps\" that prevent the model from simulating known biological functions. This capstone exercise simulates the realistic task of \"gap-filling,\" where you will use Flux Balance Analysis (FBA) to test candidate reactions and integrate mock genomic evidence to identify the most plausible missing metabolic links . This practice demonstrates how a model can be used not only for simulation but also as a powerful tool for hypothesis generation and network discovery.",
            "id": "3917890",
            "problem": "You are given a metabolic network reconstruction task formulated in purely mathematical terms. The network contains a hole: a missing internal reaction that must convert an intermediate into a target metabolite to enable production. You must select candidate reactions from a provided database, verify whether each candidate can fill the gap under the steady-state and mass conservation constraints, and assess genomic evidence for each candidate using normalized alignment scores. Your solution must implement Flux Balance Analysis (FBA), following the steady-state assumption and linear programming.\n\nFundamental base and core definitions:\n- Under the steady-state assumption for intracellular metabolites, the flux vector $\\mathbf{v}$ satisfies the mass conservation law represented by a stoichiometric matrix $\\mathbf{S} \\in \\mathbb{R}^{m \\times n}$ through the equality $$\\mathbf{S}\\mathbf{v} = \\mathbf{0}.$$\n- Reaction flux bounds are given by lower bounds $\\mathbf{l}$ and upper bounds $\\mathbf{u}$, defining $$\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}.$$\n- The objective is to maximize the secretion flux of the target metabolite by optimizing a linear objective $$\\max_{\\mathbf{v}} \\; c^\\top \\mathbf{v} \\quad \\text{subject to} \\quad \\mathbf{S}\\mathbf{v} = \\mathbf{0}, \\; \\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}.$$\n\nNetwork specification:\n- Metabolites (internal): $m_1, m_2, m_3, m_4$.\n- Known reactions (columns of $\\mathbf{S}_0$):\n  1. Uptake reaction $R_1$: $\\emptyset \\rightarrow m_1$.\n  2. Conversion reaction $R_2$: $m_1 \\rightarrow m_2$.\n  3. Secretion sink $R_{\\text{out}}$: $m_3 \\rightarrow \\emptyset$.\n\nThe stoichiometric matrix for the known reactions $\\mathbf{S}_0 \\in \\mathbb{R}^{4 \\times 3}$ is:\n$$\n\\mathbf{S}_0 =\n\\begin{bmatrix}\n+1  -1  0 \\\\\n0  +1  0 \\\\\n0  0  -1 \\\\\n0  0  0\n\\end{bmatrix}.\n$$\nRows correspond to $[m_1, m_2, m_3, m_4]$, and columns correspond to $[R_1, R_2, R_{\\text{out}}]$.\n\nCandidate reaction database:\n- Candidate $1$: $s^{(1)} = [0, -1, +1, 0]^\\top$, representing $m_2 \\rightarrow m_3$.\n- Candidate $2$: $s^{(2)} = [0, -1, +1, +1]^\\top$, representing $m_2 \\rightarrow m_3 + m_4$.\n- Candidate $3$: $s^{(3)} = [0, -1, 0, +1]^\\top$, representing $m_2 \\rightarrow m_4$.\n\nGenomic evidence specification:\n- Each candidate has a list of alignment bit-scores and a maximum per-hit bit-score used for normalization. For candidate $k$, with bit-scores $\\{s_i^{(k)}\\}_{i=1}^{n_k}$ and per-hit maximum $s_{\\max}^{(k)}$, define the normalized evidence score as\n$$\nE^{(k)} = \\frac{\\sum_{i=1}^{n_k} s_i^{(k)}}{n_k \\cdot s_{\\max}^{(k)}} \\in [0,1].\n$$\nProvided values:\n- Candidate $1$: scores $[45.0, 38.0]$, $s_{\\max}^{(1)} = 50.0$.\n- Candidate $2$: scores $[30.0]$, $s_{\\max}^{(2)} = 60.0$.\n- Candidate $3$: scores $[48.0]$, $s_{\\max}^{(3)} = 50.0$.\n\nFBA setup per test case:\n- Decision variables are ordered as $\\mathbf{v} = [v_1, v_2, v_{\\text{out}}, v_c]^\\top$, corresponding to $[R_1, R_2, R_{\\text{out}}, \\text{candidate}]$.\n- Bounds: $v_1 \\in [0, b_u]$, $v_2 \\in [0, U]$, $v_{\\text{out}} \\in [0, U]$, $v_c \\in [0, U]$, where $U$ is a sufficiently large upper bound and $b_u$ is the uptake capacity for $R_1$.\n- Objective: maximize $v_{\\text{out}}$.\n\nGap-filling viability criterion:\n- A candidate is considered viable if the optimal $v_{\\text{out}}$ is strictly greater than $\\epsilon$, where $\\epsilon = 10^{-9}$.\n\nReporting and selection:\n- For each test case, include only those candidates that satisfy both viability (optimal $v_{\\text{out}}  \\epsilon$) and genomic evidence ($E^{(k)} \\ge T$), where $T$ is the evidence threshold for the test case.\n- Rank the passing candidates within each test case by the composite score $$r^{(k)} = v_{\\text{out}}^{(k)} \\cdot E^{(k)},$$ in descending order. If multiple candidates tie, break ties by increasing candidate index.\n- Report the list of candidate indices (integers) in their ranked order for each test case.\n\nTest suite:\n- Use the following parameter sets $(b_u, T)$:\n  1. $(10.0, 0.6)$.\n  2. $(0.5, 0.6)$.\n  3. $(10.0, 0.9)$.\n  4. $(0.0, 0.6)$.\nSet the large upper bound to $U = 100.0$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of lists, one per test case, each list containing the selected candidate indices. The line must be in the exact format $$[\\,[\\text{case1}],\\,[\\text{case2}],\\,[\\text{case3}],\\,[\\text{case4}]\\,],$$ for example, $$[[1],[1],[],[]].$$ No additional text should be printed.",
            "solution": "The problem statement is subjected to validation against the established criteria.\n\n### Step 1: Extract Givens\n\n- **Fundamental Definitions:**\n    - Steady-state mass conservation: $\\mathbf{S}\\mathbf{v} = \\mathbf{0}$, for stoichiometric matrix $\\mathbf{S} \\in \\mathbb{R}^{m \\times n}$ and flux vector $\\mathbf{v}$.\n    - Flux bounds: $\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}$.\n    - Linear programming objective for Flux Balance Analysis (FBA): $\\max_{\\mathbf{v}} \\; c^\\top \\mathbf{v}$.\n\n- **Network Specification:**\n    - Internal metabolites: $m_1, m_2, m_3, m_4$.\n    - Known reactions: $R_1: \\emptyset \\rightarrow m_1$, $R_2: m_1 \\rightarrow m_2$, $R_{\\text{out}}: m_3 \\rightarrow \\emptyset$.\n    - Stoichiometric matrix for known reactions:\n    $$\n    \\mathbf{S}_0 =\n    \\begin{bmatrix}\n    +1  -1  0 \\\\\n    0  +1  0 \\\\\n    0  0  -1 \\\\\n    0  0  0\n    \\end{bmatrix}\n    $$\n    - Metabolite order for rows: $[m_1, m_2, m_3, m_4]$.\n    - Reaction order for columns: $[R_1, R_2, R_{\\text{out}}]$.\n\n- **Candidate Reactions Database:**\n    - Candidate $1$: $s^{(1)} = [0, -1, +1, 0]^\\top$ ($m_2 \\rightarrow m_3$).\n    - Candidate $2$: $s^{(2)} = [0, -1, +1, +1]^\\top$ ($m_2 \\rightarrow m_3 + m_4$).\n    - Candidate $3$: $s^{(3)} = [0, -1, 0, +1]^\\top$ ($m_2 \\rightarrow m_4$).\n\n- **Genomic Evidence:**\n    - Normalized evidence score formula: $E^{(k)} = \\frac{\\sum_{i=1}^{n_k} s_i^{(k)}}{n_k \\cdot s_{\\max}^{(k)}}$.\n    - Candidate $1$ data: scores $[45.0, 38.0]$, $s_{\\max}^{(1)} = 50.0$.\n    - Candidate $2$ data: scores $[30.0]$, $s_{\\max}^{(2)} = 60.0$.\n    - Candidate $3$ data: scores $[48.0]$, $s_{\\max}^{(3)} = 50.0$.\n\n- **FBA Setup:**\n    - Flux vector: $\\mathbf{v} = [v_1, v_2, v_{\\text{out}}, v_c]^\\top$.\n    - Upper bound for unregulated reactions: $U = 100.0$.\n    - Flux bounds: $v_1 \\in [0, b_u]$, $v_2 \\in [0, U]$, $v_{\\text{out}} \\in [0, U]$, $v_c \\in [0, U]$.\n    - Objective function: maximize $v_{\\text{out}}$.\n\n- **Selection Criteria:**\n    - Viability criterion: Optimal $v_{\\text{out}}  \\epsilon$, where $\\epsilon = 10^{-9}$.\n    - Genomic evidence criterion: $E^{(k)} \\ge T$, where $T$ is a test-case specific threshold.\n    - Ranking score: $r^{(k)} = v_{\\text{out}}^{(k)} \\cdot E^{(k)}$, in descending order. Tie-breaking by increasing candidate index.\n\n- **Test Suite:**\n    - Parameter sets $(b_u, T)$: $(10.0, 0.6)$, $(0.5, 0.6)$, $(10.0, 0.9)$, $(0.0, 0.6)$.\n\n### Step 2: Validate Using Extracted Givens\n\nThe problem is assessed for validity:\n- **Scientifically Grounded:** The problem is firmly rooted in the principles of metabolic network analysis, specifically Flux Balance Analysis (FBA), which is a cornerstone of systems biology and synthetic biology modeling. The use of stoichiometric matrices, steady-state assumptions, and linear programming is standard practice.\n- **Well-Posed:** The problem is well-posed. For each candidate reaction and test case, it defines a standard linear programming problem with a clear objective function, equality constraints, and inequality constraints (bounds). All required parameters and matrices are explicitly provided. This structure guarantees that a unique optimal objective value exists.\n- **Objective:** The problem is stated in precise, mathematical language, free from ambiguity or subjective claims.\n- The problem does not violate any of the invalidity criteria. It is self-contained, computationally solvable, and directly relevant to the specified topic.\n\n### Step 3: Verdict and Action\n\nThe problem is **valid**. A solution will be provided.\n\n### Solution\n\nThe task is to identify viable gap-filling reactions for a metabolic network by combining Flux Balance Analysis (FBA) with genomic evidence. The process involves two main stages: pre-calculation of constant values and iterative FBA for each test case.\n\n**1. Genomic Evidence Score Calculation**\n\nFirst, the normalized genomic evidence score $E^{(k)}$ is calculated for each candidate reaction $k$. These scores are constant across all test cases.\n\n- **Candidate 1:**\n$$E^{(1)} = \\frac{45.0 + 38.0}{2 \\cdot 50.0} = \\frac{83.0}{100.0} = 0.83$$\n- **Candidate 2:**\n$$E^{(2)} = \\frac{30.0}{1 \\cdot 60.0} = \\frac{30.0}{60.0} = 0.50$$\n- **Candidate 3:**\n$$E^{(3)} = \\frac{48.0}{1 \\cdot 50.0} = \\frac{48.0}{50.0} = 0.96$$\n\n**2. Flux Balance Analysis Formulation and Viability Assessment**\n\nFor each candidate, an FBA model is constructed to determine its viability, i.e., whether it enables the production of the target metabolite $m_3$. The model for candidate $k$ is:\n$$ \\max v_{\\text{out}} $$\nsubject to:\n$$ \\mathbf{S}^{(k)}\\mathbf{v} = \\mathbf{0} $$\n$$ \\mathbf{l}^{(k)} \\le \\mathbf{v} \\le \\mathbf{u}^{(k)} $$\n\nHere, $\\mathbf{v} = [v_1, v_2, v_{\\text{out}}, v_c]^\\top$. The full stoichiometric matrix $\\mathbf{S}^{(k)}$ is formed by augmenting the base matrix $\\mathbf{S}_0$ with the candidate's stoichiometric vector $s^{(k)}$: $\\mathbf{S}^{(k)} = [\\mathbf{S}_0 \\mid s^{(k)}]$.\n\n- **Analysis of Candidate 1 ($m_2 \\rightarrow m_3$):**\nThe stoichiometric vector is $s^{(1)} = [0, -1, 1, 0]^\\top$. The full matrix is:\n$$ \\mathbf{S}^{(1)} = \\begin{bmatrix} 1  -1  0  0 \\\\ 0  1  0  -1 \\\\ 0  0  -1  1 \\\\ 0  0  0  0 \\end{bmatrix} $$\nThe steady-state condition $\\mathbf{S}^{(1)}\\mathbf{v} = \\mathbf{0}$ yields the following system of equations:\n1. $v_1 - v_2 = 0 \\implies v_1 = v_2$\n2. $v_2 - v_c = 0 \\implies v_2 = v_c$\n3. $-v_{\\text{out}} + v_c = 0 \\implies v_{\\text{out}} = v_c$\n4. $0 = 0$ (The mass balance for $m_4$ is trivially satisfied).\nCombining these, we get $v_1 = v_2 = v_c = v_{\\text{out}}$. To maximize $v_{\\text{out}}$, we must maximize $v_1$. The flux bounds are $0 \\le v_1 \\le b_u$ and $0 \\le v_i \\le U$ for $i \\in \\{2, \\text{out}, c\\}$, where $U=100.0$. The limiting constraint is the uptake flux $v_1$. Therefore, the optimal output flux is $v_{\\text{out,opt}}^{(1)} = b_u$. This candidate is viable as long as $b_u  \\epsilon$.\n\n- **Analysis of Candidate 2 ($m_2 \\rightarrow m_3 + m_4$):**\nThe stoichiometric vector is $s^{(2)} = [0, -1, 1, 1]^\\top$. The full matrix is:\n$$ \\mathbf{S}^{(2)} = \\begin{bmatrix} 1  -1  0  0 \\\\ 0  1  0  -1 \\\\ 0  0  -1  1 \\\\ 0  0  0  1 \\end{bmatrix} $$\nThe steady-state condition $\\mathbf{S}^{(2)}\\mathbf{v} = \\mathbf{0}$ yields:\n1. $v_1 - v_2 = 0$\n2. $v_2 - v_c = 0$\n3. $-v_{\\text{out}} + v_c = 0$\n4. $v_c = 0$\nThe fourth equation, corresponding to the mass balance of $m_4$, forces the candidate flux $v_c$ to be $0$. This is because $m_4$ is produced by reaction $v_c$ but is not consumed by any reaction in the network. For the concentration of $m_4$ to be at steady state, its net production must be zero. This requirement propagates through the system, forcing all fluxes to zero: $v_c = v_{\\text{out}} = v_2 = v_1 = 0$.\nThus, $v_{\\text{out,opt}}^{(2)} = 0$. This candidate is never viable.\n\n- **Analysis of Candidate 3 ($m_2 \\rightarrow m_4$):**\nThe stoichiometric vector is $s^{(3)} = [0, -1, 0, 1]^\\top$. The full matrix is:\n$$ \\mathbf{S}^{(3)} = \\begin{bmatrix} 1  -1  0  0 \\\\ 0  1  0  -1 \\\\ 0  0  -1  0 \\\\ 0  0  0  1 \\end{bmatrix} $$\nThe steady-state condition $\\mathbf{S}^{(3)}\\mathbf{v} = \\mathbf{0}$ yields:\n1. $v_1 - v_2 = 0$\n2. $v_2 - v_c = 0$\n3. $-v_{\\text{out}} = 0 \\implies v_{\\text{out}} = 0$\n4. $v_c = 0$\nSimilar to candidate 2, the production of the dead-end metabolite $m_4$ forces $v_c=0$, and consequently all other fluxes are $0$. Critically, the third equation for metabolite $m_3$ shows that $v_{\\text{out}}$ must be $0$ regardless, as this candidate reaction does not produce $m_3$.\nThus, $v_{\\text{out,opt}}^{(3)} = 0$. This candidate is never viable.\n\n**3. Test Case Evaluation**\n\nOnly candidate $1$ has the potential to be selected. We now apply the criteria for each test case $(b_u, T)$.\n\n- **Test Case 1: $(b_u, T) = (10.0, 0.6)$**\n  - Candidate $1$:\n    - Viability: $v_{\\text{out,opt}}^{(1)} = b_u = 10.0  \\epsilon$. (Pass)\n    - Evidence: $E^{(1)} = 0.83 \\ge T=0.6$. (Pass)\n    - - Selected. Composite score $r^{(1)} = 10.0 \\cdot 0.83 = 8.3$.\n  - Candidates $2$ and $3$: Not viable. (Fail)\n  - Result: The only selected candidate is $1$. Ranked list: $[1]$.\n\n- **Test Case 2: $(b_u, T) = (0.5, 0.6)$**\n  - Candidate $1$:\n    - Viability: $v_{\\text{out,opt}}^{(1)} = b_u = 0.5  \\epsilon$. (Pass)\n    - Evidence: $E^{(1)} = 0.83 \\ge T=0.6$. (Pass)\n    - - Selected. Composite score $r^{(1)} = 0.5 \\cdot 0.83 = 0.415$.\n  - Candidates $2$ and $3$: Not viable. (Fail)\n  - Result: The only selected candidate is $1$. Ranked list: $[1]$.\n\n- **Test Case 3: $(b_u, T) = (10.0, 0.9)$**\n  - Candidate $1$:\n    - Viability: $v_{\\text{out,opt}}^{(1)} = b_u = 10.0  \\epsilon$. (Pass)\n    - Evidence: $E^{(1)} = 0.83 \\ge T=0.9$. (Fail)\n    - - Not selected.\n  - Candidates $2$ and $3$: Not viable. (Fail)\n  - Result: No candidates are selected. Ranked list: [].\n\n- **Test Case 4: $(b_u, T) = (0.0, 0.6)$**\n  - Candidate $1$:\n    - Viability: $v_{\\text{out,opt}}^{(1)} = b_u = 0.0$. Not strictly greater than $\\epsilon$. (Fail)\n    - - Not selected.\n  - Candidates $2$ and $3$: Not viable. (Fail)\n  - Result: No candidates are selected. Ranked list: [].\n\nSummary of results:\n- Case 1: $[1]$\n- Case 2: $[1]$\n- Case 3: $[]$\n- Case 4: $[]$\n\n```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the metabolic network gap-filling problem by combining Flux Balance Analysis (FBA)\n    with genomic evidence scores for a set of test cases.\n    \"\"\"\n    \n    # --- Problem Definition ---\n\n    # Base stoichiometric matrix S0\n    S0 = np.array([\n        [1.0, -1.0, 0.0],\n        [0.0, 1.0, 0.0],\n        [0.0, 0.0, -1.0],\n        [0.0, 0.0, 0.0]\n    ])\n\n    # Candidate reaction stoichiometric vectors\n    s_candidates = {\n        1: np.array([0.0, -1.0, 1.0, 0.0]),\n        2: np.array([0.0, -1.0, 1.0, 1.0]),\n        3: np.array([0.0, -1.0, 0.0, 1.0])\n    }\n\n    # Genomic evidence data\n    genomic_data = {\n        1: {'scores': [45.0, 38.0], 's_max': 50.0},\n        2: {'scores': [30.0], 's_max': 60.0},\n        3: {'scores': [48.0], 's_max': 50.0}\n    }\n\n    # FBA and selection parameters\n    U = 100.0\n    epsilon = 1e-9\n\n    # Test cases: (b_u, T)\n    test_cases = [\n        (10.0, 0.6),\n        (0.5, 0.6),\n        (10.0, 0.9),\n        (0.0, 0.6)\n    ]\n\n    # --- Pre-computation ---\n\n    # Calculate normalized genomic evidence scores (E_k)\n    evidence_scores = {}\n    for k, data in genomic_data.items():\n        sum_scores = sum(data['scores'])\n        n_k = len(data['scores'])\n        s_max_k = data['s_max']\n        evidence_scores[k] = sum_scores / (n_k * s_max_k)\n\n    # --- Main Loop ---\n\n    all_results = []\n    for b_u, T in test_cases:\n        passing_candidates = []\n        \n        for k, s_k in s_candidates.items():\n            # 1. Construct the full stoichiometric matrix S_k\n            S_k = np.hstack((S0, s_k.reshape(-1, 1)))\n            \n            # 2. Set up the Linear Programming problem for FBA\n            # Objective: maximize v_out, which is the 3rd flux (index 2).\n            # linprog minimizes, so we minimize -v_out.\n            c = np.array([0.0, 0.0, -1.0, 0.0])\n            \n            # Equality constraints: S_k * v = 0\n            A_eq = S_k\n            b_eq = np.zeros(S_k.shape[0])\n            \n            # Bounds for fluxes [v1, v2, v_out, v_c]\n            bounds = [\n                (0, b_u),  # v1 uptake\n                (0, U),    # v2\n                (0, U),    # v_out\n                (0, U)     # v_c candidate\n            ]\n            \n            # 3. Solve the LP\n            res = linprog(c, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n            \n            # The optimal objective value is -v_out_opt\n            v_out_opt = -res.fun if res.success and res.fun is not None else 0.0\n            \n            # 4. Apply selection criteria\n            # Criterion 1: Viability\n            is_viable = v_out_opt > epsilon\n            \n            # Criterion 2: Genomic evidence\n            E_k = evidence_scores[k]\n            has_evidence = E_k >= T\n            \n            if is_viable and has_evidence:\n                passing_candidates.append({\n                    'index': k,\n                    'v_out': v_out_opt,\n                    'E_k': E_k\n                })\n        \n        # 5. Rank the passing candidates\n        # Sort by composite score r = v_out * E_k (descending),\n        # then by candidate index (ascending) as a tie-breaker.\n        passing_candidates.sort(key=lambda x: (-x['v_out'] * x['E_k'], x['index']))\n        \n        ranked_indices = [c['index'] for c in passing_candidates]\n        all_results.append(ranked_indices)\n\n    # --- Final Output ---\n    \n    # Format the final output string exactly as required\n    result_str = f\"[{','.join(map(str, all_results))}]\"\n    print(result_str)\n\nsolve()\n```",
            "answer": "[[1],[1],[],[]]"
        }
    ]
}