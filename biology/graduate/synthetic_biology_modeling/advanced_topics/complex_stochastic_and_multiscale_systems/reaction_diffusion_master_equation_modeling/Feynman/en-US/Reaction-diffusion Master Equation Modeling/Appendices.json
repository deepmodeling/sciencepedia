{
    "hands_on_practices": [
        {
            "introduction": "Before simulating complex reaction-diffusion systems, it's essential to grasp the underlying mathematical foundation. This exercise builds the generator matrix, the heart of the Reaction-Diffusion Master Equation (RDME), from first principles for a simple diffusion process. By analytically solving for the matrix's eigenvalues, you will forge a direct link between the microscopic hopping rates of individual molecules and the macroscopic relaxation timescale of the entire system, providing a clear view of how collective behavior emerges from elementary events. ",
            "id": "3929346",
            "problem": "Consider a Reaction-Diffusion Master Equation (RDME) model for a single chemical species undergoing diffusion between two spatial voxels labeled $1$ and $2$. The system is closed and contains a fixed total of $N$ molecules, so the state is fully specified by the number $n \\in \\{0,1,\\dots,N\\}$ of molecules in voxel $1$ (with $N-n$ molecules in voxel $2$). Each molecule in voxel $1$ hops to voxel $2$ with rate $\\eta_{1}$ (per molecule), and each molecule in voxel $2$ hops to voxel $1$ with rate $\\eta_{2}$ (per molecule). Assume molecules do not interact and there are no other reactions.\n\nStarting from the definition of the Reaction-Diffusion Master Equation (RDME) as a Continuous-Time Markov Chain (CTMC) with generator $Q$ such that $\\frac{d}{dt}\\boldsymbol{p}(t) = Q \\boldsymbol{p}(t)$ for the state probability vector $\\boldsymbol{p}(t)$, do the following:\n\n1. Explicitly construct the $(N+1)\\times(N+1)$ generator matrix $Q$ in terms of $N$, $\\eta_{1}$, and $\\eta_{2}$. Your construction must follow from the fundamental Markov jump process definition of RDME propensities for unimolecular diffusion events and must identify all nonzero entries $Q_{i,j}$ for $i,j \\in \\{0,1,\\dots,N\\}$.\n\n2. Compute the full set of eigenvalues of $Q$ symbolically and explain the reasoning from first principles, including how independence of molecules leads to the spectrum.\n\n3. Identify the relaxation times to equilibrium associated with each nonzero eigenvalue mode and determine the slowest relaxation time (the largest time scale among these modes). Express the slowest relaxation time in seconds. Do not substitute numerical values; give a closed-form expression.\n\nYour final answer must be the single closed-form expression for the slowest relaxation time in seconds. No approximation or rounding is required.",
            "solution": "We begin from the foundational definition of the Reaction-Diffusion Master Equation (RDME) as a Continuous-Time Markov Chain (CTMC). For a CTMC on a finite state space, the law of mass action at the mesoscopic level prescribes that unimolecular diffusion events are modeled as Markov jumps. The generator $Q$ encodes transition rates such that, for the probability vector $\\boldsymbol{p}(t)$ over states, the master equation is $\\frac{d}{dt}\\boldsymbol{p}(t) = Q \\boldsymbol{p}(t)$.\n\nIn this system with two voxels and one species, the state can be represented as the integer $n \\in \\{0,1,\\dots,N\\}$ denoting the number of molecules in voxel $1$; the number in voxel $2$ is then $N-n$. Molecules in voxel $1$ hop to voxel $2$ with rate $\\eta_{1}$ per molecule, and molecules in voxel $2$ hop to voxel $1$ with rate $\\eta_{2}$ per molecule. Because molecules do not interact and only undergo diffusion, each molecule acts independently with its own two-state (voxel $1$ or voxel $2$) Markov dynamics.\n\nStep 1 (constructing $Q$): The RDME propensities for the birth-death chain in $n$ arise from unimolecular events:\n\n- A molecule in voxel $1$ hopping to voxel $2$ reduces $n$ by $1$, i.e., $n \\mapsto n-1$. The total rate for this transition from state $n$ is $\\eta_{1} \\times n$, because there are $n$ molecules in voxel $1$ and each hops with rate $\\eta_{1}$.\n\n- A molecule in voxel $2$ hopping to voxel $1$ increases $n$ by $1$, i.e., $n \\mapsto n+1$. The total rate for this transition from state $n$ is $\\eta_{2} \\times (N-n)$, because there are $N-n$ molecules in voxel $2$.\n\nThus, the generator $Q$ is tridiagonal with off-diagonal entries\n$$\nQ_{n,n-1} = \\eta_{1} \\, n \\quad \\text{for } n=1,2,\\dots,N,\n$$\n$$\nQ_{n,n+1} = \\eta_{2} \\, (N-n) \\quad \\text{for } n=0,1,\\dots,N-1,\n$$\nand zero otherwise for off-diagonals. The diagonal entries are the negative total exit rates from each state $n$:\n$$\nQ_{n,n} = -\\big( \\eta_{1} \\, n + \\eta_{2} \\, (N-n) \\big) \\quad \\text{for } n=0,1,\\dots,N,\n$$\nwith the convention that terms outside the state space vanish, i.e., there are no transitions from $n=0$ to $n=-1$ or from $n=N$ to $n=N+1$. This fully specifies the $(N+1)\\times(N+1)$ generator matrix $Q$.\n\nStep 2 (computing eigenvalues of $Q$): We appeal to fundamental principles of independent aggregation of identical two-state CTMCs. Consider one molecule as a two-state CTMC with states \"voxel $1$\" and \"voxel $2$\", transitioning from voxel $1$ to voxel $2$ with rate $\\eta_{1}$ and from voxel $2$ to voxel $1$ with rate $\\eta_{2}$. The single-molecule generator $G$ on the two-state space is\n$$\nG = \\begin{pmatrix}\n-\\eta_{1} & \\eta_{1} \\\\\n\\eta_{2} & -\\eta_{2}\n\\end{pmatrix}.\n$$\nThe eigenvalues of $G$ are obtained by solving $\\det(G - \\lambda I) = 0$:\n$$\n\\det \\begin{pmatrix}\n-\\eta_{1} - \\lambda & \\eta_{1} \\\\\n\\eta_{2} & -\\eta_{2} - \\lambda\n\\end{pmatrix}\n= (\\eta_{1} + \\lambda)(\\eta_{2} + \\lambda) - \\eta_{1}\\eta_{2}\n= \\lambda(\\eta_{1} + \\eta_{2} + \\lambda).\n$$\nThus, the eigenvalues of the single-molecule process are\n$$\n\\lambda^{(1)}_{0} = 0, \\quad \\lambda^{(1)}_{1} = -(\\eta_{1} + \\eta_{2}).\n$$\n\nNow, with $N$ independent molecules, the joint process on $\\{0,1\\}^{N}$ is the $N$-fold independent product of these two-state CTMCs. The number $n$ of molecules in voxel $1$ is a lumped variable that counts how many of the $N$ independent two-state variables are in state \"voxel $1$\". The spectrum of the generator on the product space is the set of all sums of single-molecule nonzero eigenvalues taken over independent coordinates. Because each molecule contributes either $0$ or $-(\\eta_{1} + \\eta_{2})$ to a mode’s decay rate, any eigenvalue of the $N$-molecule generator must be of the form\n$$\n\\lambda_{m} = - m \\, (\\eta_{1} + \\eta_{2}), \\quad m \\in \\{0,1,\\dots,N\\}.\n$$\nRigorous justification uses either representation theory for product chains, or explicit construction via orthogonal polynomials (Krawtchouk polynomials) for the birth-death chain generated by $Q$, but the core from first principles is the independence of $N$ identical two-state CTMCs and the fact that the generator of the aggregate is the sum of independent generators. Therefore, the eigenvalues of $Q$ are exactly\n$$\n\\left\\{ \\lambda_{m} = - m \\, (\\eta_{1} + \\eta_{2}) \\, \\big| \\, m=0,1,\\dots,N \\right\\}.\n$$\nThe multiplicity of the eigenvalue $\\lambda_{m}$ on the full product space is $\\binom{N}{m}$, and upon lumping to the birth-death chain in $n$, one obtains a complete set of $N+1$ eigenvalues with the same values $\\lambda_{m}$, $m=0,\\dots,N$.\n\nStep 3 (relaxation times to equilibrium): For a CTMC with generator $Q$, the solution to $\\frac{d}{dt}\\boldsymbol{p}(t) = Q \\boldsymbol{p}(t)$ can be decomposed into modes that decay as $\\exp(\\lambda_{m} t)$, where $\\lambda_{m}$ are the eigenvalues of $Q$. The relaxation time (time constant) associated with a mode of eigenvalue $\\lambda_{m} \\neq 0$ is\n$$\n\\tau_{m} = \\frac{1}{|\\lambda_{m}|}.\n$$\nUsing $\\lambda_{m} = - m \\, (\\eta_{1} + \\eta_{2})$ for $m=1,2,\\dots,N$, the set of relaxation times is\n$$\n\\tau_{m} = \\frac{1}{m \\, (\\eta_{1} + \\eta_{2})}, \\quad m=1,2,\\dots,N.\n$$\nThe slowest relaxation time (largest time constant) corresponds to the smallest nonzero decay rate, i.e., $m=1$, and is therefore\n$$\n\\tau_{\\text{slow}} = \\frac{1}{\\eta_{1} + \\eta_{2}}.\n$$\nBy dimensional analysis, $\\eta_{1}$ and $\\eta_{2}$ are rates with units of $\\text{s}^{-1}$, so $\\tau_{\\text{slow}}$ has units of seconds. As required, we express the slowest relaxation time in seconds as the closed-form symbolic expression $\\frac{1}{\\eta_{1} + \\eta_{2}}$ without numerical substitution.",
            "answer": "$$\\boxed{\\frac{1}{\\eta_{1}+\\eta_{2}}}$$"
        },
        {
            "introduction": "While the generator matrix provides a complete theoretical description, its size makes direct analysis intractable for most real-world systems. Instead, we rely on stochastic simulation algorithms like the Next Subvolume Method (NSM). This practice demystifies the NSM by guiding you through one complete step—from calculating propensities for reactions and diffusion to selecting the next event and updating the system state. Completing this exercise  will build a concrete intuition for the computational mechanics that drive spatio-temporal simulations.",
            "id": "3929327",
            "problem": "Consider a well-mixed reaction-diffusion system modeled by the Reaction-Diffusion Master Equation (RDME) in a one-dimensional lattice with $2$ voxels, labeled $V_{1}$ and $V_{2}$, each of volume $\\Omega = 1.0 \\times 10^{-18}\\ \\mathrm{m}^{3}$, and zero-flux boundary conditions. There are two molecular species, $A$ and $B$. Within each voxel, a single bimolecular reaction occurs: $A + B \\rightarrow \\varnothing$, with macroscopic second-order rate constant $k = 5.0 \\times 10^{-20}\\ \\mathrm{m}^{3}\\ \\mathrm{s}^{-1}$. The stochastic mass-action propensity for this reaction in voxel $V_{\\ell}$ is $a_{r,\\ell} = \\dfrac{k}{\\Omega} N_{A,\\ell} N_{B,\\ell}$, where $N_{A,\\ell}$ and $N_{B,\\ell}$ are the molecule counts of species $A$ and $B$ in voxel $V_{\\ell}$. Both species diffuse between neighboring voxels with per-molecule jump rates $d_{A} = 2.0\\ \\mathrm{s}^{-1}$ and $d_{B} = 1.0\\ \\mathrm{s}^{-1}$, respectively. With zero-flux boundaries and only two voxels, each molecule in $V_{1}$ can jump only to $V_{2}$ and vice versa.\n\nAt time $t = 0$, the copy numbers are:\n- $N_{A,1}(0) = 3$, $N_{B,1}(0) = 4$,\n- $N_{A,2}(0) = 2$, $N_{B,2}(0) = 1$.\n\nPerform one simulation step of the Next Subvolume Method (NSM), where the Next Subvolume Method (NSM) samples independent next-event times for each voxel from exponential waiting times with rates equal to the sum of all reaction and outgoing diffusion propensities in that voxel, selects the voxel with the earliest event, and then selects which channel within that voxel fires with probability proportional to its propensity. Use the following independent uniform random variates on $(0,1)$:\n- For voxel $V_{1}$ next-event time: $r_{1} = 0.2$,\n- For voxel $V_{2}$ next-event time: $r_{2} = 0.6$,\n- For event-channel selection within the selected voxel: $r_{\\mathrm{sel}} = 0.65$.\n\nExplicitly compute:\n- The initial propensities in each voxel for the reaction and each outgoing diffusion channel, and their voxel-wise sums,\n- The two candidate next-event times (one per voxel),\n- The selected voxel and the specific event (reaction or which species diffuses and in which direction),\n- The updated state after the event and the updated propensities in any affected voxels.\n\nReport as your final answer the time increment $\\Delta t$ of this NSM step in seconds. Round your answer to four significant figures. Express the time in seconds.",
            "solution": "The problem is valid. It presents a clearly defined scenario within the standard framework of the Reaction-Diffusion Master Equation (RDME) and asks for the execution of one step of the Next Subvolume Method (NSM), a correct and well-established simulation algorithm for such systems. All necessary parameters, initial conditions, and random variates are provided, making the problem self-contained, consistent, and solvable.\n\nWe proceed with the single step of the Next Subvolume Method as requested.\n\n### Step 1: Compute Initial Propensities\n\nThe state of the system is given by the copy numbers of species $A$ and $B$ in each of the two voxels, $\\mathbf{N}(t) = (N_{A,1}(t), N_{B,1}(t), N_{A,2}(t), N_{B,2}(t))$.\nAt time $t=0$, the initial state is $\\mathbf{N}(0) = (3, 4, 2, 1)$.\n\nThe stochastic rate constant for the reaction $A + B \\rightarrow \\varnothing$ is derived from the macroscopic rate constant $k = 5.0 \\times 10^{-20}\\ \\mathrm{m}^{3}\\ \\mathrm{s}^{-1}$ and the voxel volume $\\Omega = 1.0 \\times 10^{-18}\\ \\mathrm{m}^{3}$:\n$$\nk_{r} = \\frac{k}{\\Omega} = \\frac{5.0 \\times 10^{-20}\\ \\mathrm{m}^{3}\\ \\mathrm{s}^{-1}}{1.0 \\times 10^{-18}\\ \\mathrm{m}^{3}} = 0.05\\ \\mathrm{s}^{-1}\n$$\nThe per-molecule diffusion rates are given as $d_{A} = 2.0\\ \\mathrm{s}^{-1}$ and $d_{B} = 1.0\\ \\mathrm{s}^{-1}$.\n\nWe compute the propensities for all possible events (reaction and outgoing diffusion) in each voxel.\n\n**For Voxel $V_{1}$ (with $N_{A,1}=3, N_{B,1}=4$):**\n- Reaction propensity ($A+B \\rightarrow \\varnothing$):\n  $a_{r,1} = k_{r} N_{A,1} N_{B,1} = (0.05\\ \\mathrm{s}^{-1})(3)(4) = 0.6\\ \\mathrm{s}^{-1}$\n- Diffusion of A from $V_1$ to $V_2$:\n  $a_{d,A,1 \\to 2} = d_{A} N_{A,1} = (2.0\\ \\mathrm{s}^{-1})(3) = 6.0\\ \\mathrm{s}^{-1}$\n- Diffusion of B from $V_1$ to $V_2$:\n  $a_{d,B,1 \\to 2} = d_{B} N_{B,1} = (1.0\\ \\mathrm{s}^{-1})(4) = 4.0\\ \\mathrm{s}^{-1}$\n\nThe sum of propensities for voxel $V_{1}$ is:\n$$\na_{\\mathrm{tot},1} = a_{r,1} + a_{d,A,1 \\to 2} + a_{d,B,1 \\to 2} = 0.6 + 6.0 + 4.0 = 10.6\\ \\mathrm{s}^{-1}\n$$\n\n**For Voxel $V_{2}$ (with $N_{A,2}=2, N_{B,2}=1$):**\n- Reaction propensity ($A+B \\rightarrow \\varnothing$):\n  $a_{r,2} = k_{r} N_{A,2} N_{B,2} = (0.05\\ \\mathrm{s}^{-1})(2)(1) = 0.1\\ \\mathrm{s}^{-1}$\n- Diffusion of A from $V_2$ to $V_1$:\n  $a_{d,A,2 \\to 1} = d_{A} N_{A,2} = (2.0\\ \\mathrm{s}^{-1})(2) = 4.0\\ \\mathrm{s}^{-1}$\n- Diffusion of B from $V_2$ to $V_1$:\n  $a_{d,B,2 \\to 1} = d_{B} N_{B,2} = (1.0\\ \\mathrm{s}^{-1})(1) = 1.0\\ \\mathrm{s}^{-1}$\n\nThe sum of propensities for voxel $V_{2}$ is:\n$$\na_{\\mathrm{tot},2} = a_{r,2} + a_{d,A,2 \\to 1} + a_{d,B,2 \\to 1} = 0.1 + 4.0 + 1.0 = 5.1\\ \\mathrm{s}^{-1}\n$$\n\n### Step 2: Generate Candidate Next-Event Times\n\nThe NSM algorithm samples a candidate next-event time $\\tau_{\\ell}$ for each voxel $\\ell$ from an exponential distribution with rate $a_{\\mathrm{tot},\\ell}$. Using the inversion method with the provided uniform random variates $r_{\\ell} \\in (0,1)$, the time is calculated as $\\tau_{\\ell} = \\frac{1}{a_{\\mathrm{tot},\\ell}}\\ln\\left(\\frac{1}{r_{\\ell}}\\right)$.\n\n- For $V_{1}$, with $r_{1} = 0.2$ and $a_{\\mathrm{tot},1} = 10.6\\ \\mathrm{s}^{-1}$:\n$$\n\\tau_1 = \\frac{1}{10.6\\ \\mathrm{s}^{-1}} \\ln\\left(\\frac{1}{0.2}\\right) = \\frac{\\ln(5)}{10.6}\\ \\mathrm{s} \\approx 0.15183\\ \\mathrm{s}\n$$\n- For $V_{2}$, with $r_{2} = 0.6$ and $a_{\\mathrm{tot},2} = 5.1\\ \\mathrm{s}^{-1}$:\n$$\n\\tau_2 = \\frac{1}{5.1\\ \\mathrm{s}^{-1}} \\ln\\left(\\frac{1}{0.6}\\right) = \\frac{\\ln(5/3)}{5.1}\\ \\mathrm{s} \\approx 0.10016\\ \\mathrm{s}\n$$\n\n### Step 3: Select Voxel and Event\n\nThe algorithm selects the voxel with the minimum candidate time.\n$$\n\\Delta t = \\min(\\tau_1, \\tau_2) = \\min(0.15183\\ \\mathrm{s}, 0.10016\\ \\mathrm{s}) = \\tau_2 \\approx 0.10016\\ \\mathrm{s}\n$$\nThe next event will occur at time $t = \\Delta t$ in voxel $V_{2}$. The final answer required is this time increment, $\\Delta t$.\n\nNext, we determine which specific event occurs within $V_{2}$ by using the random variate $r_{\\mathrm{sel}} = 0.65$. We check which propensity interval the value $r_{\\mathrm{sel}} \\times a_{\\mathrm{tot},2}$ falls into.\n$$\nr_{\\mathrm{sel}} \\times a_{\\mathrm{tot},2} = 0.65 \\times 5.1 = 3.315\n$$\nThe propensity intervals for $V_2$ are constructed by ordering the channels: reaction, diffusion of A, diffusion of B.\n1. Reaction ($a_{r,2} = 0.1$): Interval $[0, 0.1)$\n2. Diffusion of A ($a_{d,A,2 \\to 1} = 4.0$): Interval $[0.1, 0.1+4.0) = [0.1, 4.1)$\n3. Diffusion of B ($a_{d,B,2 \\to 1} = 1.0$): Interval $[4.1, 4.1+1.0) = [4.1, 5.1)$\n\nSince $3.315$ is in the interval $[0.1, 4.1)$, the selected event is the diffusion of a molecule of species A from voxel $V_{2}$ to voxel $V_{1}$.\n\n### Step 4: Update System State and Propensities\n\nThe selected event is $A_{V_2} \\rightarrow A_{V_1}$. The state change is:\n- $N_{A,1}$ increases by $1$.\n- $N_{A,2}$ decreases by $1$.\n- All other copy numbers remain unchanged.\n\nThe new state $\\mathbf{N}'$ is:\n$N'_{A,1} = N_{A,1} + 1 = 3 + 1 = 4$\n$N'_{B,1} = N_{B,1} = 4$\n$N'_{A,2} = N_{A,2} - 1 = 2 - 1 = 1$\n$N'_{B,2} = N_{B,2} = 1$\nSo, the new state vector is $\\mathbf{N}' = (4, 4, 1, 1)$.\n\nThe propensities in both voxels must be recalculated based on this new state.\n**Updated Propensities for Voxel $V_{1}$:**\n$a'_{r,1} = k_{r} N'_{A,1} N'_{B,1} = (0.05)(4)(4) = 0.8\\ \\mathrm{s}^{-1}$\n$a'_{d,A,1 \\to 2} = d_{A} N'_{A,1} = (2.0)(4) = 8.0\\ \\mathrm{s}^{-1}$\n$a'_{d,B,1 \\to 2} = d_{B} N'_{B,1} = (1.0)(4) = 4.0\\ \\mathrm{s}^{-1}$\n$a'_{\\mathrm{tot},1} = 0.8 + 8.0 + 4.0 = 12.8\\ \\mathrm{s}^{-1}$\n\n**Updated Propensities for Voxel $V_{2}$:**\n$a'_{r,2} = k_{r} N'_{A,2} N'_{B,2} = (0.05)(1)(1) = 0.05\\ \\mathrm{s}^{-1}$\n$a'_{d,A,2 \\to 1} = d_{A} N'_{A,2} = (2.0)(1) = 2.0\\ \\mathrm{s}^{-1}$\n$a'_{d,B,2 \\to 1} = d_{B} N'_{B,2} = (1.0)(1) = 1.0\\ \\mathrm{s}^{-1}$\n$a'_{\\mathrm{tot},2} = 0.05 + 2.0 + 1.0 = 3.05\\ \\mathrm{s}^{-1}$\n\n### Final Answer Calculation\n\nThe problem asks for the time increment $\\Delta t$ of this NSM step, which is $\\tau_2$.\n$$\n\\Delta t = \\tau_2 = \\frac{\\ln(5/3)}{5.1}\\ \\mathrm{s} \\approx 0.10016188\\ \\mathrm{s}\n$$\nRounding to four significant figures, we get:\n$$\n\\Delta t \\approx 0.1002\\ \\mathrm{s}\n$$",
            "answer": "$$\\boxed{0.1002}$$"
        },
        {
            "introduction": "A mastery of modeling lies not just in implementing algorithms, but in critically evaluating their validity. The RDME is a discrete approximation of a continuous physical reality, and this exercise highlights a critical pitfall in that translation. By examining an intentionally flawed model , you will discover how a naive discretization can lead to the paradoxical result where refining the simulation grid worsens the accuracy. This practice is designed to develop the crucial skill of scrutinizing model assumptions to ensure your simulations are physically meaningful and convergent.",
            "id": "3929349",
            "problem": "You are modeling ligand binding to a single spherical receptor embedded in a three-dimensional cytosolic volume using the Reaction-Diffusion Master Equation (RDME). Your goal is to construct a counterexample showing that a naive discretization can invert the expected convergence behavior: decreasing the voxel size increases the predicted steady-state binding rate relative to the continuum Smoluchowski prediction. You will quantify the discretization-induced error.\n\nFundamental base:\n- The Reaction-Diffusion Master Equation (RDME) models spatial stochastic chemical kinetics by partitioning space into voxels of edge length $h$ and treating diffusion as nearest-neighbor hopping with rate proportional to $D/h^2$, and reactions as voxel-local propensities.\n- The Smoluchowski theory gives the continuum diffusion-limited steady-state rate constant for a perfect absorbing spherical target of radius $a$ in three dimensions as $k_{\\mathrm{Smol}} = 4 \\pi D a$.\n\nScenario:\n- Consider a cubic domain of side length $L$ (units: micrometers, $\\mu\\mathrm{m}$) with a single spherical receptor centered at the origin of physical radius $a$ (units: $\\mu\\mathrm{m}$).\n- The cytosolic ligand concentration is maintained at a spatially uniform value $c_\\infty$ (units: $\\mu\\mathrm{m}^{-3}$). Treat $c_\\infty$ as a constant background concentration field.\n- Discretize space on a uniform cubic lattice of voxels of edge length $h$ (units: $\\mu\\mathrm{m}$), with voxel centers at positions $(i h, j h, k h)$ for integers $i,j,k$ and the origin at $(0,0,0)$.\n- Represent the receptor as the union of all voxels whose centers lie inside the sphere of radius $a$ (that is, count voxels with center-to-origin distance less than or equal to $a$). Let $N(h)$ be the number of such reactive voxels. The reactive volume is $V_{\\mathrm{reactive}}(h) = N(h) h^3$ (units: $\\mu\\mathrm{m}^3$).\n- Naively implement binding in the RDME as a first-order voxel-local decay with per-voxel reaction rate $\\lambda_v(h) = \\beta D / h$ (units: $\\mathrm{s}^{-1}$), where $D$ is the diffusion coefficient (units: $\\mu\\mathrm{m}^2/\\mathrm{s}$) and $\\beta$ is a dimensionless constant. This scaling $\\lambda_v(h) \\propto 1/h$ wrongly treats a surface-absorbing process as a volumetric decay and does not include the correct geometrical factor. This mis-specification is intentional to construct the counterexample.\n- Under the assumption of a uniform background concentration $c_\\infty$, the RDME-predicted steady-state binding rate (consumption flux) for this naive scheme is\n$$F_{\\mathrm{RDME}}(h) = \\lambda_v(h)\\, c_\\infty\\, V_{\\mathrm{reactive}}(h),$$\nwith units $\\mathrm{s}^{-1}$.\n- The continuum Smoluchowski prediction for a perfect absorber gives the steady-state binding rate\n$$F_{\\mathrm{Smol}} = \\left(4\\pi D a\\right) c_\\infty,$$\nwith units $\\mathrm{s}^{-1}$.\n\nTask:\n- For each test case, compute $N(h)$ by counting integer triples $(i,j,k)$ such that $\\sqrt{(i h)^2 + (j h)^2 + (k h)^2} \\le a$. Then compute $V_{\\mathrm{reactive}}(h) = N(h) h^3$, $\\lambda_v(h) = \\beta D / h$, $F_{\\mathrm{RDME}}(h)$, and $F_{\\mathrm{Smol}}$.\n- Quantify the discretization-induced error as the relative error\n$$\\varepsilon(h) = \\frac{F_{\\mathrm{RDME}}(h)}{F_{\\mathrm{Smol}}} - 1,$$\nwhich is dimensionless and should be reported as a decimal number.\n\nParameters and units:\n- Diffusion coefficient $D$ in $\\mu\\mathrm{m}^2/\\mathrm{s}$.\n- Receptor radius $a$ in $\\mu\\mathrm{m}$.\n- Bulk concentration $c_\\infty$ in $\\mu\\mathrm{m}^{-3}$.\n- Domain side length $L$ in $\\mu\\mathrm{m}$ (note: $L$ is provided for physical context; the counting procedure for $N(h)$ is local around the origin and does not require enumerating the entire domain as long as $L \\gg a$).\n- Dimensionless scaling constant $\\beta$.\n- Voxel sizes $h$ in $\\mu\\mathrm{m}$.\n\nTest suite:\nUse the following parameter values to exercise different regimes:\n- $D = 10\\,\\mu\\mathrm{m}^2/\\mathrm{s}$,\n- $a = 1\\,\\mu\\mathrm{m}$,\n- $c_\\infty = 1\\,\\mu\\mathrm{m}^{-3}$,\n- $L = 10\\,\\mu\\mathrm{m}$,\n- $\\beta = 1$,\n- Voxel sizes $h$:\n    1. $h = 1.0\\,\\mu\\mathrm{m}$ (coarse discretization, boundary case),\n    2. $h = 0.5\\,\\mu\\mathrm{m}$ (moderate discretization, happy path),\n    3. $h = 0.25\\,\\mu\\mathrm{m}$ (refined discretization),\n    4. $h = 0.125\\,\\mu\\mathrm{m}$ (fine discretization, significant edge case illustrating growth of error).\n\nRequired outputs:\n- For each test case, compute $\\varepsilon(h)$ as defined above and express each answer as a decimal number (dimensionless).\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\").\n\nScientific realism notes:\n- The mis-specified scaling $\\lambda_v(h) = \\beta D / h$ is not a correct boundary reaction mapping; it is used here to demonstrate how a naive voxel-based implementation can artificially boost binding rates as the mesh is refined. You must base your computation on the definitions above without correcting this scaling.",
            "solution": "The problem requires the calculation of the discretization-induced relative error, $\\varepsilon(h)$, for a naive Reaction-Diffusion Master Equation (RDME) model of ligand binding to a spherical receptor. The error quantification will demonstrate how an incorrect model specification can lead to a paradoxical increase in the predicted binding rate as the spatial discretization is refined.\n\nFirst, we establish the mathematical expressions for the quantities of interest, adhering strictly to the provided definitions.\nThe steady-state binding rate predicted by the naive RDME model is given by:\n$$ F_{\\mathrm{RDME}}(h) = \\lambda_v(h)\\, c_\\infty\\, V_{\\mathrm{reactive}}(h) $$\nThe per-voxel reaction rate is $\\lambda_v(h) = \\beta D / h$, and the total volume of reactive voxels is $V_{\\mathrm{reactive}}(h) = N(h) h^3$. Substituting these into the rate equation gives:\n$$ F_{\\mathrm{RDME}}(h) = \\left(\\frac{\\beta D}{h}\\right) c_\\infty \\left(N(h) h^3\\right) = \\beta D c_\\infty N(h) h^2 $$\nHere, $D$ is the diffusion coefficient, $\\beta$ is a dimensionless constant, $c_\\infty$ is the bulk ligand concentration, $h$ is the voxel edge length, and $N(h)$ is the number of reactive voxels.\n\nThe continuum Smoluchowski theory provides the reference steady-state binding rate for a perfect absorber of radius $a$:\n$$ F_{\\mathrm{Smol}} = (4\\pi D a) c_\\infty $$\nThe discretization-induced relative error, $\\varepsilon(h)$, compares the RDME prediction to the continuum reference:\n$$ \\varepsilon(h) = \\frac{F_{\\mathrm{RDME}}(h)}{F_{\\mathrm{Smol}}} - 1 $$\nSubstituting the expressions for $F_{\\mathrm{RDME}}(h)$ and $F_{\\mathrm{Smol}}$:\n$$ \\varepsilon(h) = \\frac{\\beta D c_\\infty N(h) h^2}{4\\pi D a c_\\infty} - 1 $$\nThe terms for the diffusion coefficient, $D$, and the bulk concentration, $c_\\infty$, cancel out. This greatly simplifies the expression for the error, making it independent of these two parameters:\n$$ \\varepsilon(h) = \\frac{\\beta N(h) h^2}{4\\pi a} - 1 $$\nThe central task is to compute $N(h)$, which is the number of voxels whose centers fall within the spherical receptor of radius $a$. A voxel centered at $(ih, jh, kh)$ is counted if its center's distance from the origin is less than or equal to $a$:\n$$ \\sqrt{(ih)^2 + (jh)^2 + (kh)^2} \\le a $$\nThis inequality can be simplified by factoring out $h$ and squaring both sides:\n$$ i^2 + j^2 + k^2 \\le \\left(\\frac{a}{h}\\right)^2 $$\nTo find $N(h)$, we must enumerate and count all integer triples $(i, j, k)$ that satisfy this condition. The search space for the integers $i, j, k$ is bounded, as $|i|$, $|j|$, and $|k|$ cannot exceed $R = a/h$. The algorithm involves iterating through all integer coordinates $(i, j, k)$ within a cube of side length $2 \\lfloor a/h \\rfloor$ centered at the origin and checking if they lie inside a sphere of radius $R = a/h$.\n\nThe problem specifies the parameters: $a = 1\\,\\mu\\mathrm{m}$ and $\\beta = 1$. The error formula for our specific test cases becomes:\n$$ \\varepsilon(h) = \\frac{N(h) h^2}{4\\pi} - 1 $$\nWe now apply this framework to each of the four test cases for the voxel size $h$.\n\n**Case 1: $h = 1.0\\,\\mu\\mathrm{m}$**\nThe ratio $a/h = 1/1.0 = 1$. We need to count integer triples $(i,j,k)$ such that $i^2+j^2+k^2 \\le 1^2 = 1$.\nThe triples satisfying this are:\n- $(0,0,0)$: sum of squares is $0$. ($1$ point)\n- Permutations of $(\\pm 1,0,0)$: sum of squares is $1$. ($6$ points)\nTotal count: $N(1.0) = 1 + 6 = 7$.\nThe error is:\n$$ \\varepsilon(1.0) = \\frac{7 \\cdot (1.0)^2}{4\\pi} - 1 = \\frac{7}{4\\pi} - 1 \\approx 0.557324 - 1 = -0.442676 $$\n\n**Case 2: $h = 0.5\\,\\mu\\mathrm{m}$**\nThe ratio $a/h = 1/0.5 = 2$. We need to count integer triples $(i,j,k)$ such that $i^2+j^2+k^2 \\le 2^2 = 4$.\nThe sums of squares of integers up to $4$ are:\n- $0$: $(0,0,0)$ ($1$ point)\n- $1$: Permutations of $(\\pm 1,0,0)$ ($6$ points)\n- $2$: Permutations of $(\\pm 1,\\pm 1,0)$ ($12$ points)\n- $3$: $(\\pm 1,\\pm 1,\\pm 1)$ ($8$ points)\n- $4$: Permutations of $(\\pm 2,0,0)$ ($6$ points)\nTotal count: $N(0.5) = 1 + 6 + 12 + 8 + 6 = 33$.\nThe error is:\n$$ \\varepsilon(0.5) = \\frac{33 \\cdot (0.5)^2}{4\\pi} - 1 = \\frac{33 \\cdot 0.25}{4\\pi} - 1 = \\frac{8.25}{4\\pi} - 1 \\approx 0.656514 - 1 = -0.343486 $$\n\n**Case 3: $h = 0.25\\,\\mu\\mathrm{m}$**\nThe ratio $a/h = 1/0.25 = 4$. We need to count integer triples $(i,j,k)$ such that $i^2+j^2+k^2 \\le 4^2 = 16$.\nEnumerating these points computationally yields $N(0.25) = 257$.\nThe error is:\n$$ \\varepsilon(0.25) = \\frac{257 \\cdot (0.25)^2}{4\\pi} - 1 = \\frac{257 \\cdot 0.0625}{4\\pi} - 1 = \\frac{16.0625}{4\\pi} - 1 \\approx 1.27830 - 1 = 0.27830 $$\n\n**Case 4: $h = 0.125\\,\\mu\\mathrm{m}$**\nThe ratio $a/h = 1/0.125 = 8$. We need to count integer triples $(i,j,k)$ such that $i^2+j^2+k^2 \\le 8^2 = 64$.\nEnumerating these points computationally yields $N(0.125) = 2089$.\nThe error is:\n$$ \\varepsilon(0.125) = \\frac{2089 \\cdot (0.125)^2}{4\\pi} - 1 = \\frac{2089 \\cdot 0.015625}{4\\pi} - 1 = \\frac{32.640625}{4\\pi} - 1 \\approx 2.59762 - 1 = 1.59762 $$\n\nThe results demonstrate the counterintuitive behavior. As the voxel size $h$ decreases from $1.0$ to $0.125$, the relative error $\\varepsilon(h)$ increases from approximately $-0.44$ to $+1.60$. This shows that for this naive model, refining the mesh does not improve accuracy but instead causes the predicted rate to diverge from the correct continuum limit. The cause is the mis-specified reaction rate $\\lambda_v(h) = \\beta D/h$, which, when combined with the reactive volume $V_{\\mathrm{reactive}}(h) \\approx \\frac{4}{3}\\pi a^3$, leads to an overall binding rate $F_{\\mathrm{RDME}}(h)$ that scales asymptotically as $1/h$, causing divergence as $h \\to 0$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the discretization-induced error for a naive RDME model\n    of ligand binding to a spherical receptor for several voxel sizes.\n    \"\"\"\n\n    # Define the fixed parameters from the problem statement.\n    a = 1.0  # Receptor radius in micrometers.\n    beta = 1.0  # Dimensionless scaling constant.\n    # Note: D and c_infinity cancel out in the relative error calculation.\n\n    # Define the test cases for voxel size h.\n    test_h_values = [1.0, 0.5, 0.25, 0.125]\n\n    results = []\n    for h in test_h_values:\n        # Step 1: Calculate N(h), the number of reactive voxels.\n        # This is the number of integer points (i, j, k) such that\n        # i^2 + j^2 + k^2 <= (a/h)^2.\n        \n        # Determine the search radius in grid units.\n        R = a / h\n        R_squared = R**2\n        \n        # The maximum integer coordinate to check.\n        max_idx = int(np.floor(R))\n        \n        N_h = 0\n        # Iterate over a cube that bounds the sphere of radius R.\n        for i in range(-max_idx, max_idx + 1):\n            for j in range(-max_idx, max_idx + 1):\n                # Optimization: if i^2 + j^2 is already too large, no k will satisfy the condition.\n                if i**2 + j**2 > R_squared:\n                    continue\n                for k in range(-max_idx, max_idx + 1):\n                    if i**2 + j**2 + k**2 <= R_squared:\n                        N_h += 1\n\n        # Step 2: Calculate the discretization-induced relative error epsilon(h).\n        # The formula derived is: epsilon(h) = (beta * N(h) * h^2) / (4 * pi * a) - 1.\n        \n        # F_RDME is proportional to (beta * D * c_inf * N_h * h^2)\n        # F_Smol is proportional to (4 * pi * D * a * c_inf)\n        # Dividing them, D and c_inf cancel out.\n        f_rdme_factor = beta * N_h * h**2\n        f_smol_factor = 4 * np.pi * a\n        \n        error = (f_rdme_factor / f_smol_factor) - 1.0\n        results.append(error)\n\n    # Print the final results in the specified format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}