{
    "hands_on_practices": [
        {
            "introduction": "我们从最基本的分子相互作用模型开始。这个练习旨在从第一性原理出发，推导单个配体与单个受体结合位点的平衡结合曲线。通过应用质量作用定律，您将得到描述非协同结合过程的方程，这在数学上等同于希尔系数 $n=1$ 的希尔函数。掌握这个基础模型至关重要，因为它为我们理解更复杂的协同效应和“超敏”响应提供了基准和参照点 。",
            "id": "3909776",
            "problem": "一个合成基因线路利用DNA上的单个操纵子位点，通过配体与转录调节子的结合来控制表达。考虑一个自由浓度为 $L$ 的配体与调节子上单个结合位点的平衡结合，其结合反应的解离常数为 $K_{d}$。将位点的分数占据率 $\\theta$ 定义为在平衡状态下与配体结合的调节子蛋白所占的比例。从质量作用定律和解离常数的定义出发，推导一个用 $L$ 和 $K_{d}$ 表示 $\\theta$ 的表达式，该表达式对应于希尔形式的非协同极限，然后对 $K_{d} = 10^{-7}\\ \\text{M}$ 和 $L = 2 \\times 10^{-7}\\ \\text{M}$ 进行求值。最后，使用你推导的表达式确定在此条件下该位点是否处于半饱和状态。\n\n将你的最终数值结果 $\\theta$ 表示为单个最简分数。最终答案中不要包含任何单位。",
            "solution": "题目要求推导单个配体与调节子蛋白结合的分数占据率 $\\theta$，然后进行数值计算，并判断系统是否处于半饱和状态。\n\n首先，我们验证题目的有效性。\n**第一步：提取已知条件**\n- 系统：配体与带单个结合位点的转录调节子结合。\n- 自由配体浓度：$L$。\n- 解离常数：$K_d$。\n- 分数占据率的定义：$\\theta$ 是平衡状态下与配体结合的调节子蛋白所占的比例。\n- 要求的推导依据：质量作用定律和 $K_d$ 的定义。\n- 数值：$K_d = 10^{-7}\\ \\text{M}$，$L = 2 \\times 10^{-7}\\ \\text{M}$。\n- 最终输出要求：$\\theta$ 为单个最简分数。\n\n**第二步：使用提取的已知条件进行验证**\n该问题具有科学依据，描述了一个典型的配体-受体结合平衡，这是生物化学和分子生物学中的一个基本概念。所有术语（$L$、$K_d$、$\\theta$）都是标准且定义明确的。该问题是适定的，因为它为得到唯一解提供了所有必要信息。所给数值对于生物系统是物理上现实的。该问题是客观的，没有歧义。因此，该问题被认为是有效的。\n\n现在，我们开始解题。\n\n令 $R$ 表示自由的调节子蛋白，$L$ 表示自由的配体，$RL$ 表示配体结合的调节子复合物。平衡时的结合反应为：\n$$R + L \\rightleftharpoons RL$$\n\n根据质量作用定律，解离常数 $K_d$ 定义为反应物平衡浓度的乘积与产物平衡浓度的比值：\n$$K_d = \\frac{[R][L]}{[RL]}$$\n其中 $[R]$、$[L]$ 和 $[RL]$ 分别是自由调节子、自由配体和复合物的摩尔浓度。题目陈述将 $L$ 定义为自由配体浓度，因此我们可以用 $L$ 代替 $[L]$。\n\n分数占据率 $\\theta$ 定义为与配体结合的调节子浓度与调节子总浓度的比值。调节子的总浓度 $[R]_{total}$ 是自由形式和结合形式浓度的总和：\n$$[R]_{total} = [R] + [RL]$$\n因此，分数占据率 $\\theta$ 为：\n$$\\theta = \\frac{[RL]}{[R]_{total}} = \\frac{[RL]}{[R] + [RL]}$$\n\n为了用 $L$ 和 $K_d$ 表示 $\\theta$，我们必须从 $\\theta$ 的方程中消去 $[R]$ 和 $[RL]$。根据 $K_d$ 的定义，我们可以将自由调节子的浓度 $[R]$ 表示为：\n$$[R] = K_d \\frac{[RL]}{L}$$\n\n将这个 $[R]$ 的表达式代入 $\\theta$ 方程的分母中：\n$$\\theta = \\frac{[RL]}{\\left( K_d \\frac{[RL]}{L} \\right) + [RL]}$$\n\n项 $[RL]$ 是分子和分母中所有项的公因式，因此可以提取出来并约掉：\n$$\\theta = \\frac{[RL]}{[RL] \\left( \\frac{K_d}{L} + 1 \\right)} = \\frac{1}{\\frac{K_d}{L} + 1}$$\n\n为了得到更常规的形式，我们可以将分子和分母同时乘以 $L$：\n$$\\theta = \\frac{L}{L\\left(\\frac{K_d}{L} + 1\\right)} = \\frac{L}{K_d + L}$$\n\n这个表达式代表了单个非协同结合位点的分数占据率。它是希尔方程 $\\theta = \\frac{L^n}{K^n + L^n}$ 在希尔系数 $n=1$ 时的特例。在这个非协同极限下，解离常数 $K_d$ 等于产生半饱和时的配体浓度。\n\n接下来，我们使用给定的数值计算 $\\theta$：$K_d = 10^{-7}\\ \\text{M}$ 和 $L = 2 \\times 10^{-7}\\ \\text{M}$。\n$$\\theta = \\frac{2 \\times 10^{-7}}{10^{-7} + 2 \\times 10^{-7}}$$\n我们可以从分母中提取出 $10^{-7}$：\n$$\\theta = \\frac{2 \\times 10^{-7}}{(1 + 2) \\times 10^{-7}} = \\frac{2 \\times 10^{-7}}{3 \\times 10^{-7}}$$\n分子和分母中的项 $10^{-7}$相互抵消，剩下：\n$$\\theta = \\frac{2}{3}$$\n这就是题目所要求的最简分数。\n\n最后，我们必须确定该位点是否处于半饱和状态。半饱和定义为分数占据率 $\\theta$ 等于 $0.5$ 或 $\\frac{1}{2}$ 的条件。\n我们计算出的值为 $\\theta = \\frac{2}{3}$。\n由于 $\\frac{2}{3} \\neq \\frac{1}{2}$，因此在该条件下，该位点未处于半饱和状态。半饱和发生在配体浓度 $L$ 等于解离常数 $K_d$ 时。此处，$L = 2K_d$，因此浓度是达到半饱和所需浓度的两倍，导致占据率大于 $\\frac{1}{2}$。",
            "answer": "$$\\boxed{\\frac{2}{3}}$$"
        },
        {
            "introduction": "在许多生物系统中，分子开关的行为远比简单的非协同结合要陡峭。这个练习将引导您探索一种经典的协同作用模型——“全或无”协同结合模型，其中多个配体分子作为一个整体与受体结合。通过推导这种情况下的一般希尔函数，您将深入理解希尔系数 $n$ 如何量化协同性，并赋予系统“超敏性”（ultrasensitivity）。分析响应曲线的对称性和陡峭度将揭示这些分子开关在对数浓度尺度上的优雅数学特性 。",
            "id": "3909783",
            "problem": "在合成基因回路中，一个转录调节因子通过一簇$n$个相同的位点与启动子结合，这些位点的作用方式是强协同、一致的：只有当所有$n$个位点都被占据时，转录才被激活，而中间的半结合状态对激活的贡献可以忽略不计。假设系统处于热力学平衡状态并遵循质量作用定律。设游离调节因子的浓度为$L$，并设启动子在平衡时有两种主要的微观状态：未结合态($S_0$)和完全结合态($S_n$)。为一致性转变$S_0 + nL \\rightleftharpoons S_n$定义一个表观解离常数$K$，使得$[S_0]$、$[S_n]$和$L$之间的平衡关系受质量作用定律支配。\n\n从这些前提和基本的平衡统计力学（结合多项式/配分函数推理）或等效的质量作用平衡出发，推导启动子的分数激活度$f(L)$作为$L$、$K$和$n$的函数。然后，对于一个$n=3$且表观解离常数$K=50\\ \\mathrm{nM}$的调节因子，计算当$L\\in\\{10, 50, 200\\}\\ \\mathrm{nM}$时$f(L)$的值。将$f(L)$的数值表示为无量纲小数，并四舍五入到四位有效数字。\n\n最后，根据你的推导，解释激活曲线在$L=K$附近的陡峭程度，并讨论当浓度在对数标度上考虑时，激活曲线围绕$L=K$的对称性。你的解释必须从第一性原理出发进行论证，而不是通过援引记忆的公式。",
            "solution": "该问题要求推导启动子的分数激活度，对特定参数进行数值计算，并解释所得函数的性质。整个过程按规定分为三个部分进行。\n\n首先，必须确认问题陈述的有效性。\n\n**步骤1：提取已知条件**\n- 一个转录调节因子通过$n$个相同位点与启动子结合。\n- 结合是强协同且一致的。\n- 只有当所有$n$个位点都被占据时（状态$S_n$），转录才被激活。\n- 中间的半结合状态贡献可以忽略不计。\n- 系统处于热力学平衡状态，并遵循质量作用定律。\n- $L$是游离调节因子的浓度。\n- 存在两种主要的微观状态：未结合态（$S_0$）和完全结合态（$S_n$）。\n- 为一致性转变$S_0 + nL \\rightleftharpoons S_n$定义了一个表观解离常数$K$。\n- 任务是推导分数激活度$f(L)$。\n- 对于$n=3$和$K=50\\ \\mathrm{nM}$，计算在$L \\in \\{10, 50, 200\\}\\ \\mathrm{nM}$时$f(L)$的值。\n- $f(L)$的数值结果应四舍五入到四位有效数字。\n- 最后的任务是根据推导解释激活曲线的陡峭程度和对称性。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题有科学依据，描述了协同结合的一个标准模型，即希尔模型在无限协同性（一致性、全或无机制）下的极限情况。这是系统生物学和合成生物学中用于模拟转录开关的常见简化方法。问题是适定的，提供了推导唯一解所需的所有参数和定义。语言客观而精确。所选参数对于生物分子相互作用而言是物理上现实的。问题是自洽且内部一致的，没有违反科学原理或逻辑矛盾之处。它不属于任何无效类别。\n\n**步骤3：结论与行动**\n问题是有效的。将提供完整解答。\n\n**分数激活度 $f(L)$ 的推导**\n\n问题指定了一个一致性结合模型，其中启动子$S$可以处于两种主要状态之一：未结合态$S_0$，或被$n$个配体$L$完全结合，记为$S_n$。平衡反应为：\n$$S_0 + nL \\rightleftharpoons S_n$$\n根据质量作用定律，该反应的解离常数，我们称之为$K_D$，可以写成：\n$$K_D = \\frac{[S_0][L]^n}{[S_n]}$$\n其中$[...]$表示浓度。这个$K_D$的单位是浓度的$n$次方。问题定义了一个“表观解离常数”$K$，其单位是浓度（从给定的值$K=50\\ \\mathrm{nM}$可以看出）。这是标准做法，其中$K$代表分数饱和度为一半时的配体浓度。让我们将$K_D$与此参数$K$联系起来。\n\n从质量作用方程中，我们可以表达两种状态的浓度之比：\n$$\\frac{[S_n]}{[S_0]} = \\frac{[L]^n}{K_D}$$\n分数激活度$f(L)$是处于激活态$S_n$的启动子所占的比例。由于中间状态可以忽略不计，启动子的总浓度为$[S]_{total} = [S_0] + [S_n]$。\n$$f(L) = \\frac{[S_n]}{[S]_{total}} = \\frac{[S_n]}{[S_0] + [S_n]}$$\n为了简化此表达式，我们将分子和分母同时除以$[S_0]$：\n$$f(L) = \\frac{[S_n]/[S_0]}{1 + [S_n]/[S_0]}$$\n代入浓度之比的表达式：\n$$f(L) = \\frac{[L]^n/K_D}{1 + [L]^n/K_D} = \\frac{[L]^n}{K_D + [L]^n}$$\n现在，我们使用表观解离常数$K$的定义，即当$L=K$时$f(L) = 1/2$。\n$$f(L=K) = \\frac{K^n}{K_D + K^n} = \\frac{1}{2}$$\n解出$K_D$：\n$$2K^n = K_D + K^n$$\n$$K_D = K^n$$\n这证实了宏观解离常数$K_D$（单位为浓度$^n$）与表观解离常数$K$（单位为浓度）之间的关系。将$K^n$代入$f(L)$的方程中替换$K_D$，得到最终形式，即希尔函数：\n$$f(L) = \\frac{L^n}{K^n + L^n}$$\n\n**数值计算**\n\n给定参数$n=3$和$K=50\\ \\mathrm{nM}$，激活函数为：\n$$f(L) = \\frac{L^3}{(50)^3 + L^3}$$\n我们计算该函数在指定$L$浓度下的值。注意，由于$L$和$K$的单位相同，单位相互抵消，$f(L)$是无量纲的。\n\n1.  当 $L = 10\\ \\mathrm{nM}$ 时：\n    $$f(10) = \\frac{10^3}{50^3 + 10^3} = \\frac{1000}{125000 + 1000} = \\frac{1000}{126000} = \\frac{1}{126} \\approx 0.0079365...$$\n    四舍五入到四位有效数字，$f(10) \\approx 0.007937$。\n\n2.  当 $L = 50\\ \\mathrm{nM}$ 时：\n    $$f(50) = \\frac{50^3}{50^3 + 50^3} = \\frac{50^3}{2 \\times 50^3} = \\frac{1}{2} = 0.5$$\n    这与$K$的定义要求一致。用四位有效数字表示，即为$0.5000$。\n\n3.  当 $L = 200\\ \\mathrm{nM}$ 时：\n    $$f(200) = \\frac{200^3}{50^3 + 200^3} = \\frac{(4 \\times 50)^3}{50^3 + (4 \\times 50)^3} = \\frac{4^3 \\times 50^3}{50^3(1 + 4^3)} = \\frac{64}{1 + 64} = \\frac{64}{65} \\approx 0.984615...$$\n    四舍五入到四位有效数字，$f(200) \\approx 0.9846$。\n\n**曲线陡峭程度和对称性的解释**\n\n**陡峭程度：** 响应的陡峭程度表征了其对配体浓度变化的敏感性。一个常用且有用的敏感性度量是激活曲线在半对数图上的斜率，即$df/d(\\ln L)$。这个量是无量纲的。\n使用链式法则，$\\frac{df}{d(\\ln L)} = \\frac{df}{dL} \\frac{dL}{d(\\ln L)} = L \\frac{df}{dL}$。\n首先，我们使用商法则求$f(L)$对$L$的导数：\n$$f(L) = \\frac{L^n}{K^n + L^n}$$\n$$\\frac{df}{dL} = \\frac{(nL^{n-1})(K^n + L^n) - (L^n)(nL^{n-1})}{(K^n + L^n)^2} = \\frac{nK^nL^{n-1}}{(K^n + L^n)^2}$$\n现在，我们求对数标度下的敏感性：\n$$\\frac{df}{d(\\ln L)} = L \\left( \\frac{nK^nL^{n-1}}{(K^n + L^n)^2} \\right) = \\frac{nK^nL^n}{(K^n + L^n)^2}$$\n陡峭程度通常在曲线的中点，$L=K$处进行评估，此处斜率最大。\n$$\\left. \\frac{df}{d(\\ln L)} \\right|_{L=K} = \\frac{nK^nK^n}{(K^n + K^n)^2} = \\frac{nK^{2n}}{(2K^n)^2} = \\frac{nK^{2n}}{4K^{2n}} = \\frac{n}{4}$$\n这个结果表明，激活曲线在中点的陡峭程度与希尔系数$n$成正比。更大的$n$意味着更强的协同性，并导致更具开关性质的响应，即“超敏”响应。这意味着在$K$附近配体浓度的微小变化可以引起启动子激活度的巨大变化。\n\n**对称性：** 为了在对数浓度标度上分析曲线的对称性，我们定义一个新变量$x = \\ln(L/K)$。这意味着$L = K\\exp(x)$。曲线的中点，$L=K$，现在对应于$x=0$。我们将此代入函数$f(L)$：\n$$f(L(x)) = \\frac{(K\\exp(x))^n}{K^n + (K\\exp(x))^n} = \\frac{K^n\\exp(nx)}{K^n(1 + \\exp(nx))} = \\frac{\\exp(nx)}{1 + \\exp(nx)}$$\n我们称这个新函数为$g(x)$。为了检查其是否关于点$(x=0, f=1/2)$呈点对称，我们考察$g(x) + g(-x)$的和：\n$$g(-x) = \\frac{\\exp(-nx)}{1 + \\exp(-nx)}$$\n为了简化$g(-x)$，我们将分子和分母同乘以$\\exp(nx)$：\n$$g(-x) = \\frac{\\exp(-nx)\\exp(nx)}{(1 + \\exp(-nx))\\exp(nx)} = \\frac{1}{\\exp(nx) + 1}$$\n现在，我们计算它们的和：\n$$g(x) + g(-x) = \\frac{\\exp(nx)}{1 + \\exp(nx)} + \\frac{1}{1 + \\exp(nx)} = \\frac{\\exp(nx) + 1}{1 + \\exp(nx)} = 1$$\n关系式$g(x) + g(-x) = 1$表明该函数关于点$(0, 1/2)$呈点对称。用原始变量表示，这意味着$f(L)$对$\\log(L)$的图像关于点$(\\log(K), 1/2)$对称。这种对称性意味着，相对于$K$的给定倍数变化（例如，乘以一个因子$c$）所产生的响应，与逆向的倍数变化（除以$c$）所产生的响应是互补的。即，对于任何$c > 0$，都有$f(cK) + f(K/c) = 1$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.007937  0.5000  0.9846 \\end{pmatrix}}$$"
        },
        {
            "introduction": "理论模型与复杂的生物现实之间常常存在差距。虽然协同结合的“全或无”模型是一个有用的简化，但真实世界中的结合过程通常是顺序发生的。此练习要求您首先推导一个更符合物理化学实际的两站点顺序结合模型（阿代尔模型）的精确解。然后，您将使用这个精确解生成的数据来拟合一个更简洁的“有效”希尔模型。这个过程不仅能让您掌握如何用现象学模型来近似更复杂的机理，还能揭示希尔参数 $n$ 和 $K$ 如何作为描述潜在动力学过程的宏观有效参数而出现，这对于分析真实的实验数据至关重要 。",
            "id": "2744319",
            "problem": "您需要从第一性原理出发，推导并实现一个拥有两个配体结合位点的单一受体的平衡分数位点占据率。该受体按顺序结合一种配体，遵循质量作用定律。请在巨正则系综中使用受体状态的结合多项式进行研究，并假设宏观逐步解离常数。然后，使用您推导出的精确平衡表达式，校准一个有效的 Hill 模型，该模型能够在广泛的配体浓度范围内近似精确的占据率。\n\n假设与定义：\n- 受体有两个等效的物理位点，它们以宏观逐步解离常数 $K_{d1}$ 和 $K_{d2}$ 顺序结合配体。这些常数由平衡状态下未结合配体的受体、单配体结合的受体和双配体结合的受体之间的质量作用平衡定义。\n- 设游离配体浓度为 $L$，单位为纳摩尔 (nM)。\n- 分数位点占据率 $Y(L)$ 是每个受体上结合配体的期望数量除以 $2$，是无量纲的。\n- 待拟合的有效 Hill 模型是双参数族 $Y_{\\mathrm{Hill}}(L) = \\dfrac{L^{n}}{K^{n} + L^{n}}$，其中 $n$ (无量纲) 是 Hill 指数，$K$ (单位为 nM) 是 Hill 模型的半饱和常数。\n\n任务 A (推导与精确计算)：\n- 从质量作用定律和顺序结合的宏观逐步解离常数定义出发，推导出 $Y(L)$ 作为 $L$、$K_{d1}$ 和 $K_{d2}$ 的函数的精确表达式，不假设非协同性。您的推导必须从允许的受体状态构建的结合多项式开始，并且 $Y(L)$ 必须作为由位点数归一化的期望占据率来获得。\n- 实现您推导出的精确 $Y(L)$。\n\n任务 B (有效 Hill 拟合)：\n- 使用非线性最小二乘法，将 $Y_{\\mathrm{Hill}}(L)$ 的参数 $n$ 和 $K$ 拟合到在跨越六个数量级的对数间隔的 $L$ 值网格上计算的精确 $Y(L)$。使用一个从 $10^{-3}$ nM 到 $10^{3}$ nM 的 $L$ 值拟合网格，在 $400$ 个对数间隔点上采样。目标是最小化在该网格上精确 $Y(L)$ 和 $Y_{\\mathrm{Hill}}(L)$ 之间的未加权的残差平方和。\n- 约束拟合的参数范围为 $n \\in [0.1, 4.0]$ 和 $K \\in [10^{-6}, 10^{6}]$ nM。选择合理的初始猜测值。\n\n使用的参数值：\n- $K_{d1} = 10$ nM。\n- $K_{d2} = 2$ nM。\n\n测试套件：\n- 计算以下五个配体浓度（单位均为 nM）下的精确 $Y(L)$：$L \\in \\{0, 0.01, 2, 10, 1000\\}$。\n- 按照上述规定拟合有效 Hill 模型，以获得估计值 $\\hat{n}$ 和 $\\hat{K}$。\n- 程序必须返回一个包含这些结果的浮点数列表：$[Y(0), Y(0.01), Y(2), Y(10), Y(1000), \\hat{n}, \\hat{K}]$。\n\n单位与格式：\n- 所有浓度 $L$、$K_{d1}$、$K_{d2}$ 以及拟合的 $\\hat{K}$ 均使用纳摩尔 (nM) 为单位。分数占据率 $Y(L)$ 和 $\\hat{n}$ 是无量纲的。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个值四舍五入到六位小数，例如：$[x_1,x_2,x_3,x_4,x_5,x_6,x_7]$，其中每个 $x_i$ 是一个小数点后有六位数字的十进制表示，不附加单位。\n\n科学真实性与约束：\n- 您的推导必须严格基于质量作用定律和宏观逐步解离常数的定义。除非从您使用这些参数的推导中可以得出，否则不要假设独立结合。\n- 在实现和拟合过程中，确保在指定的 $L$ 值范围内的数值稳定性。",
            "solution": "问题陈述已经过评估并被认为是有效的。它在科学上基于化学平衡和统计力学的原理，问题设定良好，目标明确，并提供了一套完整且一致的数据和定义。该问题是生物物理化学中的一个标准练习，并且可以按所述方式解决。\n\n按照要求，解决方案分两部分进行：首先，推导精确的分数位点占据率；其次，拟合有效 Hill 模型的数值程序。\n\n**A 部分：精确分数位点占据率 $Y(L)$ 的推导**\n\n该系统包含一个受体 $R$，该受体有两个相同的配体 $L$ 结合位点。结合是顺序的，意味着配体一个接一个地结合。受体的状态有未结合配体的（$R$）、单配体结合的（$RL$）和双配体结合的（$RL_2$）。这些状态之间的平衡由质量作用定律和宏观逐步解离常数 $K_{d1}$ 与 $K_{d2}$ 决定。\n\n第一个平衡反应是第一个配体的结合：\n$$R + L \\rightleftharpoons RL$$\n此步骤的宏观解离常数定义为：\n$$K_{d1} = \\frac{[R][L]}{[RL]} \\quad (1)$$\n其中 $[R]$、$[L]$ 和 $[RL]$ 分别是未结合配体的受体、游离配体和单配体结合的受体的平衡浓度。\n\n第二个平衡反应是第二个配体的结合：\n$$RL + L \\rightleftharpoons RL_2$$\n这第二步的宏观解离常数为：\n$$K_{d2} = \\frac{[RL][L]}{[RL_2]} \\quad (2)$$\n其中 $[RL_2]$ 是双配体结合的受体的平衡浓度。\n\n为了确定分数占据率，我们首先描述受体状态的相对布居。使用结合多项式可以方便地做到这一点，这是该系统巨正则系综处理方法的核心。我们将已结合配体的状态浓度 $[RL]$ 和 $[RL_2]$ 用未结合配体的受体浓度 $[R]$ 和游离配体浓度 $L$ 来表示。\n\n从方程 $(1)$：\n$$[RL] = \\frac{[R]L}{K_{d1}}$$\n从方程 $(2)$：\n$$[RL_2] = \\frac{[RL]L}{K_{d2}}$$\n将 $[RL]$ 的表达式代入 $[RL_2]$ 的方程中：\n$$[RL_2] = \\left(\\frac{[R]L}{K_{d1}}\\right) \\frac{L}{K_{d2}} = \\frac{[R]L^2}{K_{d1}K_{d2}}$$\n\n所有受体物种的总浓度 $[R]_{\\text{total}}$ 是各个状态浓度的总和：\n$$[R]_{\\text{total}} = [R] + [RL] + [RL_2] = [R] + \\frac{[R]L}{K_{d1}} + \\frac{[R]L^2}{K_{d1}K_{d2}}$$\n提出因子 $[R]$ 后得到：\n$$[R]_{\\text{total}} = [R] \\left( 1 + \\frac{L}{K_{d1}} + \\frac{L^2}{K_{d1}K_{d2}} \\right)$$\n括号中的项即为结合多项式 $P(L)$：\n$$P(L) = 1 + \\frac{L}{K_{d1}} + \\frac{L^2}{K_{d1}K_{d2}}$$\n\n每个受体结合的配体平均数 $\\langle \\nu \\rangle$ 是结合配体数量的统计期望值。其计算方法是将每种状态（$0$、$1$ 或 $2$）下结合的配体数乘以观察到该状态的概率，然后求和。一个状态的概率是其浓度除以总受体浓度。\n$$\\langle \\nu \\rangle = \\frac{(0 \\cdot [R]) + (1 \\cdot [RL]) + (2 \\cdot [RL_2])}{[R]_{\\text{total}}}$$\n代入 $[RL]$、$[RL_2]$ 和 $[R]_{\\text{total}}$ 的表达式：\n$$\\langle \\nu \\rangle = \\frac{ \\frac{[R]L}{K_{d1}} + 2 \\frac{[R]L^2}{K_{d1}K_{d2}} }{ [R] \\left( 1 + \\frac{L}{K_{d1}} + \\frac{L^2}{K_{d1}K_{d2}} \\right) }$$\n$[R]$ 项被消去，剩下的表达式只依赖于 $L$ 和解离常数：\n$$\\langle \\nu \\rangle = \\frac{ \\frac{L}{K_{d1}} + \\frac{2L^2}{K_{d1}K_{d2}} }{ 1 + \\frac{L}{K_{d1}} + \\frac{L^2}{K_{d1}K_{d2}} }$$\n这个表达式也可以通过关系式 $\\langle \\nu \\rangle = L \\frac{d}{dL} \\ln(P(L))$ 从结合多项式推导得出。\n\n问题将分数位点占据率 $Y(L)$ 定义为每个受体结合的配体平均数除以总位点数，即 $N=2$。\n$$Y(L) = \\frac{\\langle \\nu \\rangle}{N} = \\frac{\\langle \\nu \\rangle}{2}$$\n代入 $\\langle \\nu \\rangle$ 的表达式：\n$$Y(L) = \\frac{1}{2} \\left( \\frac{ \\frac{L}{K_{d1}} + \\frac{2L^2}{K_{d1}K_{d2}} }{ 1 + \\frac{L}{K_{d1}} + \\frac{L^2}{K_{d1}K_{d2}} } \\right) = \\frac{ \\frac{L}{2K_{d1}} + \\frac{L^2}{K_{d1}K_{d2}} }{ 1 + \\frac{L}{K_{d1}} + \\frac{L^2}{K_{d1}K_{d2}} }$$\n这就是分数位点占据率的最终精确表达式。为了便于实现，在数值上更有利的方法是通过将分子和分母同乘以 $K_{d1}K_{d2}$ 来消去分母：\n$$Y(L) = \\frac{ \\frac{L K_{d2}}{2} + L^2 }{ K_{d1}K_{d2} + L K_{d2} + L^2 }$$\n给定参数值 $K_{d1} = 10\\,\\text{nM}$ 和 $K_{d2} = 2\\,\\text{nM}$：\n$$Y(L) = \\frac{ L + L^2 }{ 20 + 2L + L^2 }$$\n\n**B 部分：拟合有效 Hill 模型**\n\n任务是将在上面推导出的精确占据率函数 $Y(L)$ 拟合到双参数 Hill 方程 $Y_{\\text{Hill}}(L)$。\n$$Y_{\\text{Hill}}(L) = \\frac{L^n}{K^n + L^n}$$\n这里，$n$ 是 Hill 指数，$K$ 是有效半饱和常数。拟合过程在指定的配体浓度网格上使用非线性最小二乘法进行。\n\n1.  **数据生成**：生成一个包含 400 个配体浓度 $L_i$ 的网格，浓度范围从 $10^{-3}\\,\\text{nM}$到 $10^{3}\\,\\text{nM}$，呈对数间隔分布。对于每个 $L_i$，使用推导出的公式（其中 $K_{d1} = 10$，$K_{d2} = 2$）计算精确的分数占据率 $Y_i = Y(L_i)$。\n2.  **非线性最小二乘法**：目标是找到参数 $\\hat{n}$ 和 $\\hat{K}$，以最小化精确模型与 Hill 近似模型之间的残差平方和 (SSR)：\n    $$\\text{SSR}(n, K) = \\sum_{i=1}^{400} \\left( Y_i - Y_{\\text{Hill}}(L_i; n, K) \\right)^2$$\n    此优化受约束条件 $n \\in [0.1, 4.0]$ 和 $K \\in [10^{-6}, 10^{6}]$ 的限制。\n3.  **初始猜测值**：迭代优化算法需要为参数 $(n, K)$ 提供合理的初始猜测值 ($p_0$)。\n    -   由于 $K_{d1}  K_{d2}$，协同性为正，因此我们预期 $n  1$。初始猜测值 $n_0=1.5$ 是合适的。\n    -   参数 $K$ 是 $Y_{\\text{Hill}}(L)$ 等于 $0.5$ 时的配体浓度。精确半饱和浓度（$Y(L) = 0.5$）为 $L_{0.5} = \\sqrt{K_{d1}K_{d2}} = \\sqrt{10 \\cdot 2} = \\sqrt{20} \\approx 4.47\\,\\text{nM}$。这是一个极好的初始猜测值，$K_0=4.5$。\n\n实现将使用 `scipy.optimize.curve_fit` 来执行此约束非线性回归。\n\n最后，程序将计算在特定配体浓度 $L \\in \\{0, 0.01, 2, 10, 1000\\}\\,\\text{nM}$ 下的精确占据率 $Y(L)$，并附加拟合参数 $\\hat{n}$ 和 $\\hat{K}$，以生成最终的输出列表。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import curve_fit\n\ndef solve():\n    \"\"\"\n    Derives and implements the exact fractional occupancy for a two-site receptor,\n    then fits an effective Hill model to the exact curve.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    # Macroscopic stepwise dissociation constants in nM.\n    Kd1 = 10.0\n    Kd2 = 2.0\n\n    # Ligand concentrations for test suite evaluation in nM.\n    L_test = [0.0, 0.01, 2.0, 10.0, 1000.0]\n\n    # --- Task A: Exact Fractional Occupancy ---\n\n    def Y_exact(L, k1, k2):\n        \"\"\"\n        Calculates the exact fractional site occupancy for a two-site receptor.\n\n        Args:\n            L (float or np.ndarray): Free ligand concentration(s) in nM.\n            k1 (float): First macroscopic dissociation constant in nM.\n            k2 (float): Second macroscopic dissociation constant in nM.\n\n        Returns:\n            float or np.ndarray: The fractional site occupancy (dimensionless).\n        \"\"\"\n        # Derived from first principles: Y(L) = (L/(2*k1) + L^2/(k1*k2)) / (1 + L/k1 + L^2/(k1*k2))\n        # Numerically stable form: Y(L) = (L*k2/2 + L^2) / (k1*k2 + L*k2 + L^2)\n        # Using Kd1=10, Kd2=2: Y(L) = (L + L^2) / (20 + 2L + L^2)\n        \n        # Handle the L=0 case to avoid 0/0 or precision issues, although the formula is robust.\n        L = np.asarray(L)\n        # The numerator of the rational function\n        numerator = L * k2 / 2.0 + L**2\n        # The denominator of the rational function\n        denominator = (k1 * k2) + (k2 * L) + L**2\n        \n        # Create an output array of zeros\n        occupancy = np.zeros_like(L, dtype=float)\n        # Avoid division by zero, though denominator is always positive for L=0\n        non_zero_denom = denominator != 0\n        occupancy[non_zero_denom] = numerator[non_zero_denom] / denominator[non_zero_denom]\n        \n        # If L was a scalar, return a scalar\n        if occupancy.ndim == 0:\n            return float(occupancy)\n        return occupancy\n\n    # Calculate exact occupancies for the test suite\n    Y_test_values = [Y_exact(l, Kd1, Kd2) for l in L_test]\n\n    # --- Task B: Effective Hill Model Fit ---\n\n    def Y_hill(L, n, K):\n        \"\"\"\n        The two-parameter Hill equation for fractional occupancy.\n\n        Args:\n            L (float or np.ndarray): Free ligand concentration(s) in nM.\n            n (float): Hill coefficient (dimensionless).\n            K (float): Half-saturation constant in nM.\n\n        Returns:\n            float or np.ndarray: The approximate fractional occupancy.\n        \"\"\"\n        # To avoid overflow with large L and n, reformulate as 1 / (1 + (K/L)^n)\n        # However, for L=0, (K/L) is inf. So, we use the standard form and handle L=0.\n        L = np.asarray(L)\n        kn = K**n\n        ln = L**n\n        # Pre-allocate result array\n        occupancy = np.zeros_like(L, dtype=float)\n        # Calculate where denominator is non-zero\n        denom = kn + ln\n        non_zero_denom = denom != 0\n        occupancy[non_zero_denom] = ln[non_zero_denom] / denom[non_zero_denom]\n        \n        return occupancy\n        \n\n    # 1. Generate data for fitting\n    # Grid of L values: 400 points, log-spaced from 10^-3 to 10^3 nM.\n    L_grid = np.logspace(-3, 3, 400)\n    # Corresponding exact Y values\n    Y_data = Y_exact(L_grid, Kd1, Kd2)\n\n    # 2. Perform nonlinear least squares fitting\n    # Initial guesses: n_0=1.5 (positive cooperativity), K_0=sqrt(Kd1*Kd2)\n    p0 = [1.5, np.sqrt(Kd1 * Kd2)]\n    # Bounds for parameters: n in [0.1, 4.0], K in [1e-6, 1e6]\n    bounds = ([0.1, 1e-6], [4.0, 1e6])\n\n    # Use scipy.optimize.curve_fit\n    try:\n        popt, _ = curve_fit(Y_hill, L_grid, Y_data, p0=p0, bounds=bounds)\n        n_fit, K_fit = popt\n    except RuntimeError:\n        # Fallback in case the optimization fails, though it is not expected here\n        n_fit, K_fit = np.nan, np.nan\n\n    # --- Assemble and Format Final Output ---\n    # Aggregate results: [Y(0), Y(0.01), Y(2), Y(10), Y(1000), n_hat, K_hat]\n    results = Y_test_values + [n_fit, K_fit]\n\n    # Format the output string with 6 decimal places for each value\n    formatted_results = [f\"{val:.6f}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}