{
    "hands_on_practices": [
        {
            "introduction": "Our journey into hands-on stoichiometric modeling begins with the most fundamental tool: the stoichiometric matrix, denoted as $S$. This matrix provides a compact and powerful mathematical representation of a metabolic network, translating reaction diagrams into a format suitable for computation. This first exercise  will guide you through constructing an $S$ matrix for a simple pathway, a core skill for any systems biologist.",
            "id": "1461756",
            "problem": "In the study of metabolic networks, the stoichiometry of a system of reactions can be compactly represented by a stoichiometric matrix. Consider a simplified biochemical pathway within a cell involving five distinct molecular species: $S_1$, $S_2$, $S_3$, $S_4$, and $S_5$. The interconversion of these species is governed by four irreversible, enzyme-catalyzed reactions with rates denoted by $v_1, v_2, v_3$, and $v_4$. The reactions are as follows:\n\n1.  $S_1 \\xrightarrow{v_1} S_2$\n2.  $S_2 \\xrightarrow{v_2} S_3$\n3.  $S_2 \\xrightarrow{v_3} S_4$\n4.  $S_3 + S_4 \\xrightarrow{v_4} S_5$\n\nYour task is to construct the stoichiometric matrix, $N$, for this system. The matrix must be constructed according to the standard convention where each row corresponds to a chemical species and each column corresponds to a reaction. The species should be ordered from $S_1$ to $S_5$ in the rows, and the reactions should be ordered by their index from $v_1$ to $v_4$ in the columns. The entries of the matrix, $N_{ij}$, represent the net change in the quantity of species $i$ for each single turnover of reaction $j$. Reactants are consumed (represented by a negative stoichiometric coefficient) and products are formed (represented by a positive stoichiometric coefficient).",
            "solution": "We use the standard stoichiometric convention: rows correspond to species ordered as $S_{1},S_{2},S_{3},S_{4},S_{5}$ and columns correspond to reactions ordered as $v_{1},v_{2},v_{3},v_{4}$. Each entry $N_{ij}$ is the net change in species $i$ resulting from one occurrence of reaction $j$: reactants contribute negative coefficients and products contribute positive coefficients.\n\nProcess each reaction to determine its column:\n- Reaction $v_{1}: S_{1} \\to S_{2}$. Net changes: $S_{1}:-1$, $S_{2}:+1$, others $0$. Thus the $v_{1}$ column is $(-1,\\,1,\\,0,\\,0,\\,0)^{\\top}$.\n- Reaction $v_{2}: S_{2} \\to S_{3}$. Net changes: $S_{2}:-1$, $S_{3}:+1$, others $0$. Thus the $v_{2}$ column is $(0,\\,-1,\\,1,\\,0,\\,0)^{\\top}$.\n- Reaction $v_{3}: S_{2} \\to S_{4}$. Net changes: $S_{2}:-1$, $S_{4}:+1$, others $0$. Thus the $v_{3}$ column is $(0,\\,-1,\\,0,\\,1,\\,0)^{\\top}$.\n- Reaction $v_{4}: S_{3}+S_{4} \\to S_{5}$. Net changes: $S_{3}:-1$, $S_{4}:-1$, $S_{5}:+1$, others $0$. Thus the $v_{4}$ column is $(0,\\,0,\\,-1,\\,-1,\\,1)^{\\top}$.\n\nStacking these columns in order yields the stoichiometric matrix $N$:\n$$\nN=\\begin{pmatrix}\n-1  0  0  0\\\\\n1  -1  -1  0\\\\\n0  1  0  -1\\\\\n0  0  1  -1\\\\\n0  0  0  1\n\\end{pmatrix}.\n$$\nEach entry $N_{ij}$ reflects the net stoichiometric change of species $i$ per unit flux of reaction $j$ as required.",
            "answer": "$$\\boxed{\\begin{pmatrix}\n-1  0  0  0\\\\\n1  -1  -1  0\\\\\n0  1  0  -1\\\\\n0  0  1  -1\\\\\n0  0  0  1\n\\end{pmatrix}}$$"
        },
        {
            "introduction": "While constructing a basic stoichiometric matrix is essential, real biological systems demand greater detail. This next practice  challenges you to develop a fully balanced stoichiometric equation for a major metabolic process, yeast fermentation. You will need to account not only for the primary substrates and products but also for elemental balance, charge conservation at a specific pH, and the cycling of crucial cofactors like NAD$^+$, demonstrating the precision required for realistic biochemical modeling.",
            "id": "3933466",
            "problem": "In anaerobic conditions, baker’s yeast converts glucose into ethanol and carbon dioxide through a pathway that includes glycolysis and ethanolic fermentation. Construct the overall, balanced stoichiometric equation for this conversion at the power of hydrogen (pH) $7$ using the following explicit chemical species in their dominant protonation states at pH $7$: glucose, ethanol, carbon dioxide, water, proton, adenosine triphosphate ($ATP^{4-}$), adenosine diphosphate ($ADP^{3-}$), inorganic phosphate (Pi, taken as $\\mathrm{HPO_4^{2-}}$), and nicotinamide adenine dinucleotide in its oxidized and reduced forms (NAD$^{+}$ and NADH). Impose the following modeling constraints that are standard in stoichiometric metabolic network analysis:\n- Conservation of each element involved, at minimum carbon ($\\mathrm{C}$), hydrogen ($\\mathrm{H}$), oxygen ($\\mathrm{O}$), and phosphorus ($\\mathrm{P}$), across the reaction.\n- Overall charge balance at pH $7$, with $ATP^{4-}$, $ADP^{3-}$, $\\mathrm{HPO_4^{2-}}$, NAD$^{+}$, NADH (neutral), $\\mathrm{H_2O}$ (neutral), ethanol (neutral), carbon dioxide (neutral), glucose (neutral), and $\\mathrm{H^{+}}$ carrying charge $+1$.\n- Nicotinamide adenine dinucleotide (NAD) serves as a redox cofactor and must have zero net stoichiometric change in the overall reaction (that is, its oxidized and reduced forms cancel in the net equation).\n- No internal intermediates such as pyruvate or acetaldehyde may appear in the overall reaction.\n\nDemonstrate that, after fixing the stoichiometric coefficient of glucose to $1$, the remaining coefficients are uniquely determined up to an overall scalar multiple. Then, from your balanced equation, determine the net number of adenosine triphosphate molecules produced per molecule of glucose.\n\nReport the final requested quantity as a pure number per mole of glucose. Provide an exact integer; no rounding is needed. Do not include units in your final answer.",
            "solution": "The appropriate fundamental bases are the laws of conservation of mass (elemental balance for $\\mathrm{C}$, $\\mathrm{H}$, $\\mathrm{O}$, and $\\mathrm{P}$), conservation of charge, and the catalytic cycling of redox cofactors in steady state. At pH $7$, we use the dominant protonation states: ATP$^{4-}$, ADP$^{3-}$, $\\mathrm{HPO_4^{2-}}$, NAD$^{+}$ (charge $+1$), NADH (neutral), $\\mathrm{H^{+}}$ (charge $+1$), and neutral glucose, ethanol, carbon dioxide, and water. We require that nicotinamide adenine dinucleotide (NAD) appears with zero net stoichiometric coefficient.\n\nRather than guess an overall equation, we derive it from well-established biochemical steps that are individually element- and charge-balanced at pH $7$, and then eliminate internal intermediates and cofactors. These steps are:\n- Glycolysis from glucose to pyruvate, including adenosine triphosphate (ATP), adenosine diphosphate (ADP), inorganic phosphate (Pi as $\\mathrm{HPO_4^{2-}}$), and nicotinamide adenine dinucleotide (NAD):\n$$\n\\mathrm{glucose} + 2\\,\\mathrm{ADP}^{3-} + 2\\,\\mathrm{HPO_4}^{2-} + 2\\,\\mathrm{NAD}^{+} \\;\\to\\; 2\\,\\mathrm{pyruvate}^{-} + 2\\,\\mathrm{ATP}^{4-} + 2\\,\\mathrm{NADH} + 2\\,\\mathrm{H}^{+} + 2\\,\\mathrm{H_2O}.\n$$\nOne can verify charge balance: left total charge is $-6 + (-4) + (+2) = -8$, right total charge is $2\\,(-1) + 2\\,(-4) + 2\\,(+1) = -2 - 8 + 2 = -8$.\n\n- Pyruvate decarboxylation to acetaldehyde via pyruvate decarboxylase:\n$$\n\\mathrm{pyruvate}^{-} + \\mathrm{H}^{+} \\;\\to\\; \\mathrm{acetaldehyde} + \\mathrm{CO_2},\n$$\nwhich is both element- and charge-balanced (left charge $-1 + 1 = 0$, right charge $0$).\n\n- Reduction of acetaldehyde to ethanol via alcohol dehydrogenase:\n$$\n\\mathrm{acetaldehyde} + \\mathrm{NADH} + \\mathrm{H}^{+} \\;\\to\\; \\mathrm{ethanol} + \\mathrm{NAD}^{+},\n$$\nalso element- and charge-balanced (left charge $+1$, right charge $+1$).\n\nTo convert the two pyruvate molecules produced in glycolysis, we take two copies of each fermentation step. Summing all three reactions and canceling intermediates ($\\mathrm{pyruvate}^{-}$ and acetaldehyde) and cofactors (NAD$^{+}$/NADH) yields the overall reaction. Proceed explicitly:\n\nSum of glycolysis and twice the fermentation steps:\n- Start with\n$$\n\\mathrm{glucose} + 2\\,\\mathrm{ADP}^{3-} + 2\\,\\mathrm{HPO_4}^{2-} + 2\\,\\mathrm{NAD}^{+} \\;\\to\\; 2\\,\\mathrm{pyruvate}^{-} + 2\\,\\mathrm{ATP}^{4-} + 2\\,\\mathrm{NADH} + 2\\,\\mathrm{H}^{+} + 2\\,\\mathrm{H_2O}.\n$$\n- Add $2$ times\n$$\n\\mathrm{pyruvate}^{-} + \\mathrm{H}^{+} \\;\\to\\; \\mathrm{acetaldehyde} + \\mathrm{CO_2},\n$$\nwhich gives\n$$\n2\\,\\mathrm{pyruvate}^{-} + 2\\,\\mathrm{H}^{+} \\;\\to\\; 2\\,\\mathrm{acetaldehyde} + 2\\,\\mathrm{CO_2}.\n$$\n- Add $2$ times\n$$\n\\mathrm{acetaldehyde} + \\mathrm{NADH} + \\mathrm{H}^{+} \\;\\to\\; \\mathrm{ethanol} + \\mathrm{NAD}^{+},\n$$\nwhich gives\n$$\n2\\,\\mathrm{acetaldehyde} + 2\\,\\mathrm{NADH} + 2\\,\\mathrm{H}^{+} \\;\\to\\; 2\\,\\mathrm{ethanol} + 2\\,\\mathrm{NAD}^{+}.\n$$\n\nWhen these three are summed, $2\\,\\mathrm{pyruvate}^{-}$, $2\\,\\mathrm{acetaldehyde}$, $2\\,\\mathrm{NADH}$, and $2\\,\\mathrm{NAD}^{+}$ cancel pairwise across the arrow. The $2\\,\\mathrm{H}^{+}$ produced in glycolysis cancels with $2$ of the $4\\,\\mathrm{H}^{+}$ consumed in the fermentation steps, leaving a net consumption of $2\\,\\mathrm{H}^{+}$ on the left. The overall, balanced reaction at pH $7$ is therefore\n$$\n\\mathrm{glucose} + 2\\,\\mathrm{ADP}^{3-} + 2\\,\\mathrm{HPO_4}^{2-} + 2\\,\\mathrm{H}^{+} \\;\\to\\; 2\\,\\mathrm{ethanol} + 2\\,\\mathrm{CO_2} + 2\\,\\mathrm{ATP}^{4-} + 2\\,\\mathrm{H_2O}.\n$$\n\nThis equation is element-balanced for $\\mathrm{C}$, $\\mathrm{H}$, $\\mathrm{O}$, and $\\mathrm{P}$ by construction from element-balanced steps, and it is charge-balanced at pH $7$:\n- Left charge: $2\\,(-3) + 2\\,(-2) + 2\\,(+1) = -6 - 4 + 2 = -8$.\n- Right charge: $2\\,(-4) = -8$.\nAll other species are neutral.\n\nNext, we justify uniqueness up to scalar multiplication. Consider the vector of stoichiometric coefficients for the species ordered as\n$$\n(\\mathrm{glucose},\\ \\mathrm{ADP}^{3-},\\ \\mathrm{HPO_4}^{2-},\\ \\mathrm{H}^{+},\\ \\mathrm{ethanol},\\ \\mathrm{CO_2},\\ \\mathrm{ATP}^{4-},\\ \\mathrm{H_2O},\\ \\mathrm{NAD}^{+},\\ \\mathrm{NADH}).\n$$\nLet this vector be denoted by $v \\in \\mathbb{R}^{10}$. The constraints are:\n- Conservation of $\\mathrm{C}$, $\\mathrm{H}$, $\\mathrm{O}$, and $\\mathrm{P}$ gives $4$ independent linear equations on $v$.\n- Charge balance at pH $7$ gives $1$ linear equation on $v$.\n- Cofactor cycling of nicotinamide adenine dinucleotide imposes $1$ linear equation, namely the stoichiometric coefficient of NAD$^{+}$ equals that of NADH (so the net is zero).\n- Exclusion of internal intermediates from the net reaction space is enforced by selecting only the external species listed; the internal steps are not variables in $v$ and thus do not introduce additional degrees of freedom in the overall reaction vector.\n- Fixing the scale by setting the stoichiometric coefficient of glucose to $1$ removes the trivial scalar degree of freedom.\n\nEquivalently, one may view the overall reaction vector as a linear combination of the three independently balanced, well-tested pathway steps used above (glycolysis, pyruvate decarboxylation, alcohol dehydrogenase). Requiring elimination of pyruvate and acetaldehyde and of the net NAD cofactor change imposes exactly $3$ independent linear constraints on the $3$-dimensional space spanned by these steps, leaving a one-dimensional solution space consisting of all scalar multiples of a single net reaction vector. Fixing the glucose coefficient to $1$ determines a unique representative of this one-dimensional subspace. Therefore, the solution is unique up to scalar multiplication.\n\nFrom the balanced overall reaction derived above, the coefficient of ATP$^{4-}$ on the product side is $2$ per $1$ glucose on the reactant side. Thus, the net number of adenosine triphosphate molecules produced per molecule (or per mole) of glucose is $2$.\n\nNo rounding is required; the value is an exact integer, and it is reported as a pure number per mole of glucose.",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "With an understanding of how to construct and balance stoichiometric relationships, we can now explore their system-level implications. The steady-state assumption ($S v = 0$) forms the basis of powerful computational techniques like Flux Balance Analysis (FBA). This final practice  is a computational exercise where you will use linear programming to analyze the feasible flux space of a network, revealing how stoichiometric constraints and reaction bounds define the metabolic capabilities of a cell.",
            "id": "3933398",
            "problem": "You are modeling a minimal biochemical pathway in the context of synthetic biology and steady-state stoichiometric analysis. The foundational principle is steady-state mass conservation: for each internal metabolite, the time derivative of its concentration equals the sum of incoming and outgoing fluxes weighted by stoichiometric coefficients. Under the steady-state assumption, this derivative is zero, yielding the linear constraint $S v = 0$, where $S$ is the stoichiometric matrix and $v$ is the flux vector. The feasible flux set subject to bounds is the flux cone $\\mathcal{C} = \\{ v \\in \\mathbb{R}^n \\mid S v = 0, v_{\\min} \\le v \\le v_{\\max} \\}$, where $v_{\\min}$ and $v_{\\max}$ encode irreversibility and capacity limits. Irreversibility constraints are modeled by $v_i \\ge 0$ in forward-only reactions, which carve the cone by intersecting with half-spaces and restrict allowable directions of flux.\n\nStarting from the fundamental steady-state balance $S v = 0$ and bound constraints $v_{\\min} \\le v \\le v_{\\max}$, write a program that:\n- Computes the nullspace dimension $d$ of the equality constraint $S v = 0$ as $d = n - \\operatorname{rank}(S)$.\n- Tests feasibility of the constrained steady-state system under the provided bound constraints.\n- Computes, for each reaction $i$, the minimum and maximum feasible flux values by solving two linear programs: $\\min v_i$ and $\\max v_i$ subject to $S v = 0$ and $v_{\\min} \\le v \\le v_{\\max}$. If a minimum is unbounded below, return $-\\infty$; if a maximum is unbounded above, return $+\\infty$. If the overall system is infeasible, return $\\mathrm{nan}$ for all flux bounds. Use Linear Programming (LP) to perform these computations.\n- Aggregates the results for each test case into a single output line as specified below.\n\nToy network definition:\n- Internal metabolites: $X_1$, $X_2$.\n- Reactions (columns of $S$) in order $[v_1, v_2, v_3, v_4]$:\n  - $v_1$: external uptake producing $X_1$, stoichiometry $+1$ for $X_1$.\n  - $v_2$: conversion $X_1 \\rightarrow X_2$, stoichiometry $-1$ for $X_1$, $+1$ for $X_2$.\n  - $v_3$: $X_2$ to a sink, stoichiometry $-1$ for $X_2$.\n  - $v_4$: $X_1$ to a sink, stoichiometry $-1$ for $X_1$.\n- Stoichiometric matrix $S \\in \\mathbb{R}^{2 \\times 4}$:\n$$\nS = \\begin{bmatrix}\n1  -1  0  -1 \\\\\n0  1  -1  0\n\\end{bmatrix}.\n$$\nThis encodes the steady-state balance equations $v_1 - v_2 - v_4 = 0$ and $v_2 - v_3 = 0$.\n\nInterpretation of bounds:\n- An entry of $v_{\\min,i} = 0$ models irreversibility in the forward direction for reaction $i$.\n- An entry of $v_{\\max,i} = +\\infty$ models no capacity limit on reaction $i$.\n- A fixed reaction flux of $0$ is modeled by $v_{\\min,i} = 0$ and $v_{\\max,i} = 0$.\n- In code, you may represent $+\\infty$ and $-\\infty$ using programming-language constructs that denote unbounded bounds, while the mathematical interpretation is $+\\infty$ and $-\\infty$.\n\nTest suite of bound configurations, all applied to the same $S$:\n1. Case $1$ (pure cone carved only by irreversibility): \n   $v_{\\min} = [0, -\\infty, 0, 0]$, $v_{\\max} = [+\\infty, +\\infty, +\\infty, +\\infty]$.\n2. Case $2$ (capacity limit on uptake):\n   $v_{\\min} = [0, -\\infty, 0, 0]$, $v_{\\max} = [10, +\\infty, +\\infty, +\\infty]$.\n3. Case $3$ (irreversible conversion and bounded sink, blocked branch):\n   $v_{\\min} = [0, 0, 0, 0]$, $v_{\\max} = [5, +\\infty, 2, 0]$.\n4. Case $4$ (infeasible due to conflicting bounds):\n   $v_{\\min} = [1, 0, 0, 0]$, $v_{\\max} = [+\\infty, +\\infty, 0, 0]$.\n\nYour program must, for each case, return a list containing:\n- A boolean feasibility flag.\n- The integer nullspace dimension $d$.\n- A list of $4$ floats giving the minimum feasible flux for $[v_1, v_2, v_3, v_4]$ in that order.\n- A list of $4$ floats giving the maximum feasible flux for $[v_1, v_2, v_3, v_4]$ in that order.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is itself a list of the form $[\\text{feasible}, d, [\\min\\ v_1, \\min\\ v_2, \\min\\ v_3, \\min\\ v_4], [\\max\\ v_1, \\max\\ v_2, \\max\\ v_3, \\max\\ v_4]]$.\n- Use the exact reaction order $[v_1, v_2, v_3, v_4]$.\n- If a case is infeasible, set all minimum and maximum flux entries to $\\mathrm{nan}$. If a minimum or maximum is unbounded, use $-\\infty$ or $+\\infty$ respectively.",
            "solution": "The fundamental principle is the conservation of mass for each internal metabolite under steady-state conditions. For a system with $m$ metabolites and $n$ reactions (fluxes), this is expressed by the linear system of equations:\n$$ S v = 0 $$\nwhere $S \\in \\mathbb{R}^{m \\times n}$ is the stoichiometric matrix and $v \\in \\mathbb{R}^n$ is the vector of reaction fluxes. The rows of $S$ correspond to metabolites, and the columns correspond to reactions. The entry $S_{ij}$ is the stoichiometric coefficient of metabolite $i$ in reaction $j$. A positive coefficient indicates production, and a negative coefficient indicates consumption.\n\nThe set of all flux vectors $v$ that satisfy $S v = 0$ forms a vector subspace known as the nullspace of $S$, denoted $\\operatorname{Null}(S)$. The dimension of this nullspace, $d$, represents the number of independent degrees of freedom in the flux distribution. It is calculated as:\n$$ d = \\operatorname{dim}(\\operatorname{Null}(S)) = n - \\operatorname{rank}(S) $$\nwhere $n$ is the number of reactions (columns of $S$) and $\\operatorname{rank}(S)$ is the rank of the stoichiometric matrix. For the given matrix $S \\in \\mathbb{R}^{2 \\times 4}$, the number of reactions is $n=4$. The two rows of $S$ are linearly independent, so $\\operatorname{rank}(S) = 2$. Thus, the nullspace dimension is $d = 4 - 2 = 2$.\n\nIn addition to the steady-state constraint, biological and environmental factors impose further constraints on the fluxes. These are typically represented as lower and upper bounds on each individual flux $v_i$:\n$$ v_{\\min} \\le v \\le v_{\\max} $$\nA common constraint is irreversibility, where a reaction can only proceed in the forward direction, modeled by $v_i \\ge 0$. Other bounds might represent limited nutrient uptake rates or fixed efflux rates. The complete set of feasible steady-state flux vectors is a convex polytope defined by the intersection of the nullspace $\\operatorname{Null}(S)$ and the hyperrectangle defined by the bounds:\n$$ \\mathcal{C} = \\{ v \\in \\mathbb{R}^n \\mid S v = 0, v_{\\min} \\le v \\le v_{\\max} \\} $$\n\nThe core of this problem is to perform Flux Variability Analysis (FVA). FVA determines the range of possible values for each flux $v_i$ within the feasible set $\\mathcal{C}$. This is achieved by solving a pair of Linear Programming (LP) problems for each flux $v_i$:\n1.  **Minimization**:\n    - Objective: $\\min v_i$\n    - Constraints:\n        - $S v = 0$\n        - $v_{\\min} \\le v \\le v_{\\max}$\n\n2.  **Maximization**:\n    - Objective: $\\max v_i$ (which is equivalent to $\\min -v_i$)\n    - Constraints:\n        - $S v = 0$\n        - $v_{\\min} \\le v \\le v_{\\max}$\n\nThe algorithmic procedure to solve the problem for each test case is as follows:\n\n1.  **Setup**: Define the stoichiometric matrix $S$, the equality constraint vector $b_{eq} = 0$, and the bound vectors $v_{\\min}$ and $v_{\\max}$ for the specific case.\n\n2.  **Feasibility Check**: Before running FVA, we must determine if the feasible set $\\mathcal{C}$ is empty. This is done by solving a single LP with a trivial objective function (e.g., $\\min 0^T v$) subject to the constraints $S v = 0$ and $v_{\\min} \\le v \\le v_{\\max}$. If the LP solver reports the problem as infeasible, the entire system is infeasible. In this case, the minimum and maximum for all fluxes are undefined, represented as $\\mathrm{nan}$.\n\n3.  **Flux Variability Analysis**: If the system is feasible, we iterate through each reaction $v_i$ for $i=1, \\dots, 4$.\n    a.  To find the minimum flux $\\min v_i$, we solve the LP with an objective vector $c$ that has a $1$ at position $i$ and $0$s elsewhere. If the LP is reported as unbounded, the minimum is $-\\infty$. Otherwise, the optimal value of the objective function is $\\min v_i$.\n    b.  To find the maximum flux $\\max v_i$, we solve the LP with an objective vector $c$ that has a $-1$ at position $i$ and $0$s elsewhere. This minimizes $-v_i$. The maximum flux is then the negative of the optimal objective function value. If this LP is reported as unbounded, it means $-v_i$ can go to $-\\infty$, so $v_i$ can go to $+\\infty$.\n\n4.  **Aggregation**: The results—feasibility status, nullspace dimension, and the lists of minimum and maximum fluxes—are collected for each case and formatted as specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve_case(S, v_min, v_max):\n    \"\"\"\n    Analyzes a metabolic model for feasibility and flux variability.\n\n    Args:\n        S (np.ndarray): The stoichiometric matrix (m x n).\n        v_min (np.ndarray): The lower bounds for fluxes (n,).\n        v_max (np.ndarray): The upper bounds for fluxes (n,).\n\n    Returns:\n        tuple: A tuple containing:\n            - bool: Feasibility of the system.\n            - list: Minimum possible fluxes for each reaction.\n            - list: Maximum possible fluxes for each reaction.\n    \"\"\"\n    m, n = S.shape\n    b_eq = np.zeros(m)\n    \n    # SciPy's linprog uses None for unbounded variables\n    bounds = []\n    for lo, hi in zip(v_min, v_max):\n        lo_bound = lo if lo != -np.inf else None\n        hi_bound = hi if hi != np.inf else None\n        bounds.append((lo_bound, hi_bound))\n\n    # 1. Check for feasibility by solving an LP with a zero objective function\n    c_feasibility = np.zeros(n)\n    res_feasibility = linprog(c_feasibility, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n\n    if not res_feasibility.success and res_feasibility.status == 2:  # Status 2 means infeasible\n        return False, [np.nan] * n, [np.nan] * n\n\n    # 2. If feasible, perform Flux Variability Analysis (FVA)\n    min_fluxes = [0.0] * n\n    max_fluxes = [0.0] * n\n\n    for i in range(n):\n        # Minimize v_i\n        c_min = np.zeros(n)\n        c_min[i] = 1\n        res_min = linprog(c_min, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n        if res_min.status == 3:  # Status 3 means unbounded\n            min_fluxes[i] = -np.inf\n        else:\n            min_fluxes[i] = res_min.fun\n\n        # Maximize v_i (by minimizing -v_i)\n        c_max = np.zeros(n)\n        c_max[i] = -1\n        res_max = linprog(c_max, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n        if res_max.status == 3: # Status 3 means unbounded\n            max_fluxes[i] = np.inf\n        else:\n            max_fluxes[i] = -res_max.fun\n\n    return True, min_fluxes, max_fluxes\n\ndef solve():\n    \"\"\"\n    Main function to define the problem, run test cases, and print results.\n    \"\"\"\n    # Define the stoichiometric matrix\n    S = np.array([\n        [1, -1, 0, -1],\n        [0, 1, -1, 0]\n    ], dtype=float)\n\n    # Compute nullspace dimension: d = n - rank(S)\n    n = S.shape[1]\n    rank_S = np.linalg.matrix_rank(S)\n    d = n - rank_S\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1\n        (np.array([0, -np.inf, 0, 0]), np.array([np.inf, np.inf, np.inf, np.inf])),\n        # Case 2\n        (np.array([0, -np.inf, 0, 0]), np.array([10, np.inf, np.inf, np.inf])),\n        # Case 3\n        (np.array([0, 0, 0, 0]), np.array([5, np.inf, 2, 0])),\n        # Case 4\n        (np.array([1, 0, 0, 0]), np.array([np.inf, np.inf, 0, 0])),\n    ]\n\n    all_results = []\n    for v_min, v_max in test_cases:\n        feasible, min_fluxes, max_fluxes = solve_case(S, v_min, v_max)\n        \n        # Round floating point numbers for consistent output\n        # Keep inf/nan as is\n        min_f = [round(f, 6) if np.isfinite(f) else f for f in min_fluxes]\n        max_f = [round(f, 6) if np.isfinite(f) else f for f in max_fluxes]\n\n        all_results.append([feasible, d, min_f, max_f])\n\n    # Final print statement in the exact required format.\n    # The map(str, ...) will correctly handle boolean, int, and list representations,\n    # including nan, inf, and -inf from numpy.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}