{
    "hands_on_practices": [
        {
            "introduction": "生物过程，如转录和翻译，不可避免地会引入时间延迟。这个练习将探讨这些延迟如何破坏负反馈系统的稳定性，并运用奈奎斯特判据来精确确定稳定性的边界 。这项实践对于理解生物学中反馈控制的基本限制至关重要。",
            "id": "3923012",
            "problem": "一个合成基因电路通过积分负反馈实现稳态，例如在对偶积分反馈（AIF）中，该机制通过对误差进行时间积分，从而稳健地将输出浓度驱动至一个设定点。考虑在稳态设定点附近，该电路的线性时不变（LTI）近似，其中受控的分子浓度为 $x(t)$，执行器指令为 $u(t)$。为了捕捉包含转录-翻译延迟的核心稳态积分作用，闭环动力学被建模为一个迟滞型延迟微分方程（DDE）：\n$$\n\\frac{d x(t)}{d t} = u(t), \\quad u(t) = -k\\,x(t-\\tau),\n$$\n其中 $k>0$ 是环路增益，$\\tau>0$ 是由传感、转录、翻译和处理过程产生的总反馈延迟。假设环路为单位负反馈，没有开环不稳定极点，并且线性化在工作点邻域内有效。\n\n从线性时不变（LTI）系统的频域分析第一性原理和拉普拉斯变换的定义出发，使用奈奎斯特稳定性判据，确定最大允许环路增益 $k_{\\max}$ 作为延迟 $\\tau$ 的显式函数，以使闭环系统保持稳定。您的最终答案必须是关于 $\\tau$ 的单个符号表达式。无需进行数值取整。最终答案以无单位形式表示。",
            "solution": "目标是确定给定闭环系统保持稳定时的最大允许环路增益 $k_{\\max}$。该系统由以下线性时不变（LTI）迟滞型延迟微分方程（DDE）描述：\n$$\n\\frac{d x(t)}{d t} = u(t), \\quad u(t) = -k\\,x(t-\\tau)\n$$\n其中 $k>0$ 且 $\\tau>0$。我们将使用基于拉普拉斯变换和频域分析原理的奈奎斯特稳定性判据。\n\n首先，我们推导系统的特征方程。我们将执行器指令 $u(t)$ 的表达式代入浓度 $x(t)$ 的动态方程中：\n$$\n\\frac{d x(t)}{d t} = -k\\,x(t-\\tau)\n$$\n为了分析这个LTI系统的稳定性，我们应用拉普拉斯变换。令 $X(s) = \\mathcal{L}\\{x(t)\\}$。利用微分性质 $\\mathcal{L}\\{\\frac{dx}{dt}\\} = sX(s) - x(0)$ 和时延性质 $\\mathcal{L}\\{x(t-\\tau)\\} = e^{-s\\tau}X(s)$，并假设在传递函数分析中初始条件为零（即 $x(0)=0$），变换后的方程为：\n$$\nsX(s) = -k e^{-s\\tau} X(s)\n$$\n重新整理各项以得到特征方程：\n$$\n(s + k e^{-s\\tau}) X(s) = 0\n$$\n对于非平凡解（$X(s) \\neq 0$），括号中的项必须为零。这给出了闭环系统的特征方程：\n$$\ns + k e^{-s\\tau} = 0\n$$\n此方程的根是闭环系统的极点。系统稳定的充要条件是所有根都具有负实部。\n\n为了应用奈奎斯特稳定性判据，我们首先确定开环传递函数 $L(s)$。对于单位负反馈系统，特征方程的标准形式是 $1 + L(s) = 0$。我们可以将我们的特征方程写成这种形式：\n$$\n1 + \\frac{k e^{-s\\tau}}{s} = 0\n$$\n因此，开环传递函数为：\n$$\nL(s) = \\frac{k e^{-s\\tau}}{s}\n$$\n奈奎斯特稳定性判据将闭环系统的稳定性与开环系统的频率响应联系起来。该判据由公式 $Z = P + N$ 给出，其中：\n- $Z$ 是闭环系统不稳定（右半平面）极点的数量。为了系统稳定，我们要求 $Z=0$。\n- $P$ 是开环系统 $L(s)$ 不稳定（右半平面）极点的数量。\n- $N$ 是 $L(s)$ 的奈奎斯特围线对临界点 $-1+j0$ 的顺时针环绕次数。\n\n开环传递函数 $L(s)$ 在 $s=0$ 处有一个单极点。该极点位于虚轴上，而不是在右半平面。因此，开环不稳定极点的数量为 $P=0$。\n为了系统稳定（$Z=0$），奈奎斯特判据简化为 $N=0$。这意味着 $L(s)$ 的奈奎斯特图不能环绕点 $-1+j0$。\n\n为了绘制奈奎斯特图，我们通过令 $s=j\\omega$ 来计算 $L(s)$ 沿虚轴的值，其中 $\\omega$ 是角频率。\n$$\nL(j\\omega) = \\frac{k e^{-j\\omega\\tau}}{j\\omega}\n$$\n我们分析 $L(j\\omega)$ 的幅值和相位：\n幅值为：\n$$\n|L(j\\omega)| = \\left| \\frac{k e^{-j\\omega\\tau}}{j\\omega} \\right| = \\frac{|k| |e^{-j\\omega\\tau}|}{|j\\omega|} = \\frac{k}{\\omega} \\quad (\\text{因为 } k>0 \\text{ 且对于 } \\omega>0)\n$$\n相角为：\n$$\n\\angle L(j\\omega) = \\angle(k) + \\angle(e^{-j\\omega\\tau}) - \\angle(j\\omega) = 0 - \\omega\\tau - \\frac{\\pi}{2} \\quad (\\text{弧度})\n$$\n当奈奎斯特图穿过临界点 $-1+j0$ 时，系统处于不稳定边缘，即临界稳定。在这一点上，幅值为 $1$，相位为 $-\\pi$（或 $-\\pi$ 的任何奇数倍）。\n我们首先找到相位交越频率 $\\omega_{pc}$，这是 $L(j\\omega)$ 的相位等于 $-\\pi$ 时的频率。\n$$\n\\angle L(j\\omega_{pc}) = -\\omega_{pc}\\tau - \\frac{\\pi}{2} = -\\pi\n$$\n求解 $\\omega_{pc}$：\n$$\n-\\omega_{pc}\\tau = -\\pi + \\frac{\\pi}{2} = -\\frac{\\pi}{2}\n$$\n$$\n\\omega_{pc} = \\frac{\\pi}{2\\tau}\n$$\n这是奈奎斯特图穿过负实轴的最低正频率。\n\n接下来，我们计算在该频率下 $L(j\\omega)$ 的幅值：\n$$\n|L(j\\omega_{pc})| = \\frac{k}{\\omega_{pc}} = \\frac{k}{\\frac{\\pi}{2\\tau}} = \\frac{2k\\tau}{\\pi}\n$$\n为了使系统临界稳定，该幅值必须恰好等于 $1$。这个条件定义了最大允许环路增益 $k_{\\max}$。\n$$\n|L(j\\omega_{pc})| = 1\n$$\n$$\n\\frac{2k_{\\max}\\tau}{\\pi} = 1\n$$\n求解 $k_{\\max}$：\n$$\nk_{\\max} = \\frac{\\pi}{2\\tau}\n$$\n对于任何增益 $k  k_{\\max}$，幅值 $|L(j\\omega_{pc})|$ 将小于 $1$，这意味着奈奎斯特图将在 $0$ 和 $-1$ 之间穿过负实轴。在这种情况下，对点 $-1+j0$ 的环绕次数 $N$ 为零，闭环系统是稳定的。如果 $k > k_{\\max}$，幅值将大于 $1$，点 $-1+j0$ 将被环绕，系统将变得不稳定。\n\n因此，为保证稳定性，最大允许环路增益为 $k_{\\max} = \\frac{\\pi}{2\\tau}$。",
            "answer": "$$\\boxed{\\frac{\\pi}{2\\tau}}$$"
        },
        {
            "introduction": "在掌握了线性系统的稳定性后，我们将转向更真实的非线性世界。此问题使用了希尔函数，这是模拟协同调控的标准模型 。通过分析系统的零斜线，我们可以严格确定这种常见的负反馈基序是否会导致像双稳态这样的复杂行为，还是能够可靠地确保单一的稳态设定点。",
            "id": "3923020",
            "problem": "考虑一个合成生物学回路中的单基因自调控模块，其中蛋白质浓度 $x(t)$ 通过协同的希尔(Hill)型阻遏对其自身的转录进行负反馈。假设在充分混合条件下，系统动力学是确定性的。$x(t)$ 的质量平衡由以下常微分方程建模：\n$$\n\\frac{dx}{dt} \\;=\\; \\frac{\\alpha}{1 + \\left(\\frac{x}{K}\\right)^{n}} \\;-\\; \\delta x,\n$$\n其中 $\\alpha  0$ 是最大合成速率， $K  0$ 是阻遏阈值（常被称为解离常数）， $n \\geq 1$ 是代表阻遏中协同性的希尔系数， $\\delta  0$ 是由稀释和降解引起的一级损失速率。希尔阻遏函数被广泛用于模拟协同结合，并且对于 $n \\geq 1$，它是 $x$ 的一个递减函数。\n\n使用零增长线条件 $\\frac{dx}{dt} = 0$ 以及一个基于质量平衡、希尔函数单调性和一级损失特性的斜率论证，判断该系统是否能表现出多稳态（超过一个稳定稳态）或仅表现出单稳态体内平衡（恰好一个稳定稳态）。具体来说，通过检查差值函数 $f(x) = p(x) - \\ell(x)$ 在 $x \\geq 0$ 上的导数符号，分析生成曲线\n$$\np(x) \\;=\\; \\frac{\\alpha}{1 + \\left(\\frac{x}{K}\\right)^{n}}\n$$\n与损失曲线\n$$\n\\ell(x) \\;=\\; \\delta x,\n$$\n的交点数量。你的分析必须从给定的模型和基本性质（质量平衡、希尔阻遏的单调性和线性损失）出发，不得引用任何特定的快捷公式。\n\n将你的最终答案报告为模型在所有正参数值 $\\alpha$、$K$、$n \\geq 1$ 和 $\\delta$ 下所容许的不同稳态的最大可能数量 $N_{\\mathrm{ss}}$（即在参数空间上，方程 $p(x) = \\ell(x)$ 在 $x \\geq 0$ 上的解的数量的上确界）。无需四舍五入。将最终答案表示为一个不带单位的数字。",
            "solution": "系统的稳态（用 $x^*$ 表示）是变化率为零时的非负浓度 $x$。这就是零增长线条件 $\\frac{dx}{dt} = 0$。根据给定的常微分方程，该条件为：\n$$\n\\frac{\\alpha}{1 + \\left(\\frac{x^*}{K}\\right)^{n}} - \\delta x^* = 0\n$$\n这个方程可以改写为生成速率和损失速率之间的等式：\n$$\np(x^*) = \\ell(x^*)\n$$\n其中生成曲线为 $p(x) = \\frac{\\alpha}{1 + (x/K)^n}$，损失曲线为 $\\ell(x) = \\delta x$。不同稳态的数量 $N_{\\mathrm{ss}}$ 是该方程非负解的数量。\n\n为了确定解的数量，我们遵循指定的方法，分析函数 $f(x) = p(x) - \\ell(x)$ 在 $x \\geq 0$ 上的行为。稳态是方程 $f(x) = 0$ 的根。\n$$\nf(x) = \\frac{\\alpha}{1 + \\left(\\frac{x}{K}\\right)^{n}} - \\delta x\n$$\n我们分析 $f(x)$ 在其物理定义域 $x \\geq 0$ 上的性质。\n\n首先，我们在边界 $x=0$ 处计算 $f(x)$ 的值：\n$$\nf(0) = \\frac{\\alpha}{1 + \\left(\\frac{0}{K}\\right)^{n}} - \\delta(0) = \\frac{\\alpha}{1} - 0 = \\alpha\n$$\n鉴于最大合成速率 $\\alpha  0$，我们有 $f(0)  0$。\n\n接着，我们考察当 $x \\to \\infty$ 时 $f(x)$ 的渐近行为：\n$$\n\\lim_{x\\to\\infty} f(x) = \\lim_{x\\to\\infty} \\left( \\frac{\\alpha}{1 + \\left(\\frac{x}{K}\\right)^{n}} - \\delta x \\right)\n$$\n当 $x \\to \\infty$ 时，由于 $K0$ 且 $n \\geq 1$，项 $(x/K)^n \\to \\infty$。因此，第一项的分母 $1 + (x/K)^n \\to \\infty$，导致该分数趋近于 $0$。第二项 $-\\delta x$ 趋近于 $-\\infty$，因为损失速率 $\\delta  0$。\n$$\n\\lim_{x\\to\\infty} f(x) = 0 - \\infty = -\\infty\n$$\n由于 $f(x)$ 是 $x \\geq 0$ 上的连续函数，并且它从一个正值 $f(0) = \\alpha$ 过渡到负无穷大，根据介值定理，必然存在至少一个根 $x^*  0$ 使得 $f(x^*) = 0$。\n\n为了确定该根的唯一性，我们通过计算其导数 $f'(x)$ 来分析 $f(x)$ 的单调性。一个严格单调函数最多只能穿过坐标轴一次。\n$$\nf'(x) = \\frac{d}{dx}f(x) = \\frac{d}{dx} \\left( p(x) - \\ell(x) \\right) = p'(x) - \\ell'(x)\n$$\n损失曲线 $\\ell(x) = \\delta x$ 的导数是一个常数：\n$$\n\\ell'(x) = \\delta\n$$\n生成曲线 $p(x) = \\alpha \\left(1 + K^{-n}x^n\\right)^{-1}$ 的导数可使用链式法则求得：\n$$\np'(x) = \\alpha (-1) \\left(1 + K^{-n}x^n\\right)^{-2} \\cdot \\frac{d}{dx}\\left(1 + K^{-n}x^n\\right)\n$$\n$$\np'(x) = -\\alpha \\left(1 + \\left(\\frac{x}{K}\\right)^n\\right)^{-2} \\cdot \\left(n K^{-n} x^{n-1}\\right)\n$$\n$$\np'(x) = - \\frac{\\alpha n K^{-n} x^{n-1}}{\\left(1 + (x/K)^n\\right)^2} = - \\frac{\\alpha n x^{n-1}}{K^n \\left(1 + (x/K)^n\\right)^2}\n$$\n给定参数 $\\alpha  0$、$K  0$ 和 $n \\geq 1$。对于任何 $x  0$，$p'(x)$ 表达式中的所有项均为正，因此 $p'(x)$ 严格为负。对于 $x=0$，如果 $n1$，则 $p'(0)=0$；如果 $n=1$，则 $p'(0) = -\\alpha/K  0$。在所有 $x \\geq 0$ 的情况下，生成函数的导数都是非正的，即 $p'(x) \\leq 0$。这是负反馈（阻遏）的直接结果，即 $x$ 的增加导致其自身生成的减少。\n\n现在我们组合出 $f(x)$ 的导数：\n$$\nf'(x) = p'(x) - \\delta\n$$\n我们已经确定对于所有 $x \\geq 0$，$p'(x) \\leq 0$。我们还知道 $\\delta  0$。因此，$f'(x)$ 是一个非正项和一个严格为负的项之和：\n$$\nf'(x) = (\\text{非正值}) - (\\text{正值})  0\n$$\n因此，对于所有 $x \\geq 0$，$f'(x)$ 严格为负。这证明了 $f(x)$ 在其整个定义域上是一个严格单调递减的函数。\n\n总结如下：\n1. 对于 $x \\geq 0$，$f(x)$ 是连续的。\n2. $f(0)  0$。\n3. $\\lim_{x\\to\\infty} f(x) = -\\infty$。\n4. 对于所有 $x \\geq 0$，$f(x)$ 是严格单调递减的。\n\n一个从正值开始并趋于负无穷大的连续、严格递减的函数，必然且仅穿过水平轴一次。这意味着方程 $f(x) = 0$ 存在一个唯一的解 $x^*  0$。\n\n这个结论对所有有效的参数值（$\\alpha0, K0, n\\geq1, \\delta0$）都成立。因此，该系统只能表现出单稳态体内平衡；它总是恰好拥有一个稳态。不同稳态的最大可能数量 $N_{\\mathrm{ss}}$ 是 $1$。无法表现出多稳态是这种典范负反馈结构的一个标志，因为单调递减的生成函数只能与单调递增的线性损失函数相交于一点。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "本章的最后一个练习将我们的重点从分析现有系统转向设计新系统。线性二次调节器 (LQR) 提供了一个强大的框架，用于设计一个最优的反馈控制器，以平衡性能（维持设定点）和成本（控制‘努力’）。这个练习不仅要求推导 LQR 的核心方程，还需要通过编程实现数值求解，从而将控制理论与计算合成生物学联系起来。",
            "id": "3923025",
            "problem": "您正在为一个合成基因回路在固定稳态工作点附近的稳态进行建模。设状态向量 $x \\in \\mathbb{R}^n$ 表示分子物种浓度与稳态的偏差，设 $u \\in \\mathbb{R}^m$ 为一个控制驱动（例如，诱导型转录驱动），该驱动作为负反馈施加，以维持稳态。工作点附近的线性化动态模型被建模为一个连续时间线性时不变系统\n$$\n\\dot{x}(t) = A x(t) + B u(t),\n$$\n其中 $A \\in \\mathbb{R}^{n \\times n}$ 和 $B \\in \\mathbb{R}^{n \\times m}$ 是已知的常数矩阵，通过生物物理模型的线性化得到。设计目标是在无限时间范围内，最小化偏离稳态的偏差和控制努力。\n\n通过定义一个无限时间范围上的二次代价泛函，来构建线性二次调节器（LQR）问题。该泛函包含一个状态加权矩阵 $Q \\in \\mathbb{R}^{n \\times n}$ 和一个控制加权矩阵 $R \\in \\mathbb{R}^{m \\times m}$，其中 $Q$ 是对称半正定矩阵，$R$ 是对称正定矩阵。从 Hamilton–Jacobi–Bellman 原理（也称为动态规划最优性原理）出发，推导值函数的代数最优性条件，并得到以 $A, B, Q, R$ 表示的最优静态状态反馈律 $u(t) = -K x(t)$。明确说明保证唯一稳定解存在的任何标准假设。\n\n然后，实现一个程序，对每个提供的测试用例，通过求解您推导出的相应代数方程来计算最优状态反馈增益 $K$。对于数值报告，对每个测试用例，返回按行优先顺序展平并四舍五入到 $6$ 位小数的 $K$ 的元素。\n\n测试套件：\n- 案例 1（标量，开环弱不稳定基因产物）：\n  $$\n  A = \\begin{bmatrix} 0.1 \\end{bmatrix}, \\quad\n  B = \\begin{bmatrix} 1.0 \\end{bmatrix}, \\quad\n  Q = \\begin{bmatrix} 1.0 \\end{bmatrix}, \\quad\n  R = \\begin{bmatrix} 0.5 \\end{bmatrix}.\n  $$\n- 案例 2（双状态转录-翻译，驱动作用于转录）：\n  $$\n  A = \\begin{bmatrix} -0.3  0.0 \\\\ 2.0  -0.4 \\end{bmatrix}, \\quad\n  B = \\begin{bmatrix} 1.0 \\\\ 0.0 \\end{bmatrix}, \\quad\n  Q = \\begin{bmatrix} 10.0  0.0 \\\\ 0.0  1.0 \\end{bmatrix}, \\quad\n  R = \\begin{bmatrix} 0.2 \\end{bmatrix}.\n  $$\n- 案例 3（双状态交叉耦合蛋白质模块，单输入）：\n  $$\n  A = \\begin{bmatrix} 0.05  0.2 \\\\ -0.3  -0.1 \\end{bmatrix}, \\quad\n  B = \\begin{bmatrix} 0.5 \\\\ 0.1 \\end{bmatrix}, \\quad\n  Q = \\begin{bmatrix} 5.0  0.0 \\\\ 0.0  2.0 \\end{bmatrix}, \\quad\n  R = \\begin{bmatrix} 1.0 \\end{bmatrix}.\n  $$\n- 案例 4（标量，控制惩罚小）：\n  $$\n  A = \\begin{bmatrix} -0.05 \\end{bmatrix}, \\quad\n  B = \\begin{bmatrix} 0.2 \\end{bmatrix}, \\quad\n  Q = \\begin{bmatrix} 0.1 \\end{bmatrix}, \\quad\n  R = \\begin{bmatrix} 0.001 \\end{bmatrix}.\n  $$\n- 案例 5（双状态，双输入模块，具有对角占优的驱动通道）：\n  $$\n  A = \\begin{bmatrix} -0.2  1.0 \\\\ -1.5  -0.3 \\end{bmatrix}, \\quad\n  B = \\begin{bmatrix} 1.0  0.0 \\\\ 0.0  0.5 \\end{bmatrix}, \\quad\n  Q = \\begin{bmatrix} 2.0  0.2 \\\\ 0.2  3.0 \\end{bmatrix}, \\quad\n  R = \\begin{bmatrix} 1.0  0.1 \\\\ 0.1  2.0 \\end{bmatrix}.\n  $$\n\n您的程序应计算每个案例的 $K$，并生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素本身是一个用方括号括起来的逗号分隔列表，包含按行优先顺序排列并四舍五入到 $6$ 位小数的 $K$ 的元素，例如 $[ \\text{res}1, \\text{res}2, \\text{res}3 ]$ 应显示为 $[\\text{res}1,\\text{res}2,\\text{res}3]$，无空格。此问题中无需报告物理单位。每个案例的最终输出必须是浮点数列表。",
            "solution": "该问题要求从 Hamilton-Jacobi-Bellman (HJB) 原理出发，使用线性二次调节器 (LQR) 框架，为连续时间线性时不变 (LTI) 系统推导最优状态反馈控制器。该公式是优化控制理论的核心，并广泛应用于工程和科学领域，包括用于实现稳态的合成基因回路建模。\n\n系统动力学由以下线性常微分方程给出：\n$$\n\\dot{x}(t) = A x(t) + B u(t)\n$$\n其中 $x(t) \\in \\mathbb{R}^n$ 是表示偏离稳态的状态向量，$u(t) \\in \\mathbb{R}^m$ 是控制输入，$A \\in \\mathbb{R}^{n \\times n}$ 是系统矩阵，$B \\in \\mathbb{R}^{n \\times m}$ 是输入矩阵。\n\n目标是找到一个控制律 $u(t)$，使得无限时间范围上的二次代价泛函 $J$ 最小化：\n$$\nJ = \\int_{0}^{\\infty} \\left( x(t)^T Q x(t) + u(t)^T R u(t) \\right) dt\n$$\n此处，$Q \\in \\mathbb{R}^{n \\times n}$ 是一个对称半正定状态加权矩阵 ($Q = Q^T \\ge 0$)，$R \\in \\mathbb{R}^{m \\times m}$ 是一个对称正定控制加权矩阵 ($R = R^T  0$)。项 $x^T Q x$ 惩罚偏离平衡状态 $x=0$ 的偏差，而项 $u^T R u$ 惩罚控制努力。\n\n我们使用动态规划原理进行推导。最优未来成本（optimal cost-to-go），或称值函数 $V(x)$，定义为从时间 $t=0$ 的状态 $x$ 出发可实现的最小成本。对于无限时间范围上的时不变系统，$V$ 仅依赖于状态 $x$：\n$$\nV(x) = \\min_{u(\\cdot)} \\int_{0}^{\\infty} \\left( x(\\tau)^T Q x(\\tau) + u(\\tau)^T R u(\\tau) \\right) d\\tau\n$$\nHamilton-Jacobi-Bellman (HJB) 方程为最优性提供了必要条件。对于无限时间范围的 LQR 问题，稳态 HJB 方程为：\n$$\n0 = \\min_{u} \\left\\{ L(x, u) + \\nabla V(x)^T \\dot{x} \\right\\}\n$$\n其中 $L(x, u) = x^T Q x + u^T R u$ 是瞬时成本，$\\nabla V(x)$ 是值函数关于 $x$ 的梯度。代入系统动力学，我们得到：\n$$\n0 = \\min_{u} \\left\\{ x^T Q x + u^T R u + \\nabla V(x)^T (A x + B u) \\right\\}\n$$\n最小化括号内的表达式是系统的哈密顿量。为了找到最优控制 $u^*(t)$，我们找到使该哈密顿量最小化的 $u$。\n\n我们为值函数假设一个二次形式，$V(x) = x^T P x$，其中 $P \\in \\mathbb{R}^{n \\times n}$ 是一个待确定的对称正定矩阵。该值函数的梯度为 $\\nabla V(x) = 2 P x$。将此代入 HJB 方程，得到：\n$$\n0 = \\min_{u} \\left\\{ x^T Q x + u^T R u + (2 P x)^T (A x + B u) \\right\\}\n$$\n$$\n0 = \\min_{u} \\left\\{ x^T Q x + u^T R u + 2 x^T P A x + 2 x^T P B u \\right\\}\n$$\n为了找到使该表达式最小化的控制 $u$，我们对 $u$ 求导并令结果为零。由于 $R$ 是对称的，$u^T R u$ 的导数是 $2 R u$，$2 x^T P B u$ 的导数是 $2 B^T P x$。\n$$\n\\frac{\\partial}{\\partial u} \\left( u^T R u + 2 x^T P B u \\right) = 2 R u + 2 B^T P x = 0\n$$\n求解最优控制 $u^*$：\n$$\nu^*(x) = -R^{-1} B^T P x\n$$\n$R^{-1}$ 的存在性由 $R$ 的正定性保证。此结果表明最优控制是一个线性静态状态反馈律，$u(t) = -K x(t)$，其中最优反馈增益矩阵由下式给出：\n$$\nK = R^{-1} B^T P\n$$\n现在我们将最优控制 $u^*$ 代回最小化的 HJB 方程中：\n$$\n0 = x^T Q x + (-R^{-1} B^T P x)^T R (-R^{-1} B^T P x) + 2 x^T P A x + 2 x^T P B (-R^{-1} B^T P x)\n$$\n利用属性 $(XYZ)^T = Z^T Y^T X^T$ 以及 $R$ 和 $P$ 是对称的 ($R=R^T, P=P^T$)，我们简化这些项：\n$$\n0 = x^T Q x + (x^T P B R^{-1}) R (R^{-1} B^T P x) + x^T(P A + A^T P)x - 2 x^T P B R^{-1} B^T P x\n$$\n$$\n0 = x^T Q x + x^T P B R^{-1} B^T P x + x^T(A^T P + P A)x - 2 x^T P B R^{-1} B^T P x\n$$\n合并各项，我们得到：\n$$\n0 = x^T \\left( A^T P + P A - P B R^{-1} B^T P + Q \\right) x\n$$\n该方程必须对任意状态向量 $x \\in \\mathbb{R}^n$ 成立。这只有当括号内的矩阵表达式为零矩阵时才可能。这为我们提供了 $P$ 的代数最优性条件：\n$$\nA^T P + P A - P B R^{-1} B^T P + Q = 0\n$$\n这就是连续时间代数 Riccati 方程 (CARE)。\n\n为了使 CARE 存在唯一的、对称的、半正定的解 $P$，从而使闭环系统 $\\dot{x} = (A - B K)x$ 渐近稳定，需要两个标准假设：\n1.  对 $(A, B)$ 必须是可镇定的。这意味着系统的任何不稳定模式（$A$ 的具有非负实部的特征值）都必须是可控的。\n2.  对 $(C, A)$（其中 $C$ 满足 $Q = C^T C$，例如 $C=Q^{1/2}$）必须是可检测的。这意味着系统的任何不可观测模式必须是内蕴稳定的（具有负实部的特征值）。\n\n如果满足这些条件，CARE 将有唯一的稳定解 $P \\ge 0$。数值计算过程是求解 CARE 得到矩阵 $P$，然后使用推导出的公式 $K = R^{-1} B^T P$ 计算最优增益矩阵 $K$。标准的数值库提供了求解 CARE 的稳健求解器。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_continuous_are\n\ndef solve():\n    \"\"\"\n    Computes the optimal LQR gain K for a set of test cases.\n\n    For each case, the function solves the Continuous-time Algebraic Riccati Equation (CARE)\n    A'P + PA - PBR^{-1}B'P + Q = 0 for the matrix P.\n    Then, it computes the optimal feedback gain K = R^{-1}B'P.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: scalar, open-loop weakly unstable\n        (np.array([[0.1]]), np.array([[1.0]]), np.array([[1.0]]), np.array([[0.5]])),\n        \n        # Case 2: two-state transcription-translation\n        (np.array([[-0.3, 0.0], [2.0, -0.4]]), np.array([[1.0], [0.0]]), \n         np.array([[10.0, 0.0], [0.0, 1.0]]), np.array([[0.2]])),\n        \n        # Case 3: two-state cross-coupled module\n        (np.array([[0.05, 0.2], [-0.3, -0.1]]), np.array([[0.5], [0.1]]), \n         np.array([[5.0, 0.0], [0.0, 2.0]]), np.array([[1.0]])),\n        \n        # Case 4: scalar with small control penalty\n        (np.array([[-0.05]]), np.array([[0.2]]), np.array([[0.1]]), np.array([[0.001]])),\n\n        # Case 5: two-state, two-input module\n        (np.array([[-0.2, 1.0], [-1.5, -0.3]]), np.array([[1.0, 0.0], [0.0, 0.5]]), \n         np.array([[2.0, 0.2], [0.2, 3.0]]), np.array([[1.0, 0.1], [0.1, 2.0]]))\n    ]\n\n    results = []\n    for A, B, Q, R in test_cases:\n        # Solve the Continuous-time Algebraic Riccati Equation for P\n        # A.T @ P + P @ A - P @ B @ np.linalg.inv(R) @ B.T @ P + Q = 0\n        P = solve_continuous_are(A, B, Q, R)\n        \n        # Calculate the optimal feedback gain K\n        # K = R^{-1} * B^T * P\n        R_inv = np.linalg.inv(R)\n        K = R_inv @ B.T @ P\n        \n        # Flatten the K matrix in row-major order\n        k_flat = K.flatten().tolist()\n        \n        # Round the values to 6 decimal places\n        k_rounded = [round(val, 6) for val in k_flat]\n        \n        # Format the list as a string \"[v1,v2,...]\"\n        result_str = f\"[{','.join(map(str, k_rounded))}]\"\n        results.append(result_str)\n\n    # Final print statement in the exact required format.\n    # e.g., [[k_11,k_12],[k_21,k_22],...]\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}