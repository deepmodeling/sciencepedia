{
    "hands_on_practices": [
        {
            "introduction": "我们从探索稳态系统最基本的属性开始：建立并维持一个稳定设定点的能力。这项练习  将引导你对一个典型的单基因负反馈回路进行零增长线分析。通过图形化和解析性地比较生产速率和清除速率，你将严谨地证明为何这种架构能够内在地确保一个独特且稳定的稳态，这构成了生物鲁棒性调节的基石。",
            "id": "3923020",
            "problem": "考虑一个合成生物回路中的单基因自调控模块，其中蛋白质浓度 $x(t)$ 通过协同的希尔型抑制对其自身的转录进行负反馈。假设在充分混合条件下和确定性动力学。$x(t)$ 的质量平衡由以下常微分方程建模\n$$\n\\frac{dx}{dt} = \\frac{\\alpha}{1 + \\left(\\frac{x}{K}\\right)^{n}} - \\delta x,\n$$\n其中 $\\alpha > 0$ 是最大合成速率， $K > 0$ 是抑制阈值（通常称为解离常数）， $n \\geq 1$ 是代表抑制协同性的希尔系数， $\\delta > 0$ 是由稀释和降解引起的一阶损失速率。希尔抑制函数被广泛用于模拟协同结合，并且当 $n \\geq 1$ 时，它是 $x$ 的递减函数。\n\n使用零斜线条件 $\\frac{dx}{dt} = 0$ 以及基于质量平衡、希尔函数的单调性和一阶损失特性的斜率论证，确定该系统是否能表现出多稳态（超过一个稳定稳态）或只能表现出单稳态动态平衡（只有一个稳定稳态）。具体来说，通过检查差值函数 $f(x) = p(x) - \\ell(x)$ 在 $x \\geq 0$ 上的导数符号，分析生产曲线\n$$\np(x) = \\frac{\\alpha}{1 + \\left(\\frac{x}{K}\\right)^{n}}\n$$\n与损失曲线\n$$\n\\ell(x) = \\delta x,\n$$\n的交点数量。您的分析必须从给定的模型和基本属性（质量平衡、希尔抑制的单调性和线性损失）开始，不得引用任何特定的快捷公式。\n\n将您的最终答案报告为模型在所有正参数值 $\\alpha$、 $K$、 $n \\geq 1$ 和 $\\delta$ 下所允许的不同稳态的最大可能数量 $N_{\\mathrm{ss}}$（即在参数空间上，方程 $p(x) = \\ell(x)$ 在 $x \\geq 0$ 上的解的数量的上确界）。无需四舍五入。请将您的最终答案表示为一个不带单位的单一数字。",
            "solution": "所述问题具有科学依据，提法恰当且客观。它代表了合成生物学中分析负自调控下动态平衡的一个典型模型。所有参数和条件都已明确定义，从而可以进行严谨的数学分析。因此，该问题是有效的。\n\n系统的稳态（用 $x^*$ 表示）是变化率为零的非负浓度 $x$。这就是零斜线条件 $\\frac{dx}{dt} = 0$。根据给定的常微分方程，此条件为：\n$$\n\\frac{\\alpha}{1 + \\left(\\frac{x^*}{K}\\right)^{n}} - \\delta x^* = 0\n$$\n该方程可以重写为生产速率和损失速率之间的等式：\n$$\np(x^*) = \\ell(x^*)\n$$\n其中生产曲线为 $p(x) = \\frac{\\alpha}{1 + (x/K)^n}$，损失曲线为 $\\ell(x) = \\delta x$。不同稳态的数量 $N_{\\mathrm{ss}}$ 是此方程的非负解的数量。\n\n为了确定解的数量，我们遵循指定的方法，分析函数 $f(x) = p(x) - \\ell(x)$ 在 $x \\geq 0$ 上的行为。稳态是方程 $f(x) = 0$ 的根。\n$$\nf(x) = \\frac{\\alpha}{1 + \\left(\\frac{x}{K}\\right)^{n}} - \\delta x\n$$\n我们在其物理定义域 $x \\geq 0$ 上分析 $f(x)$ 的性质。\n\n首先，我们计算 $f(x)$ 在边界 $x=0$ 处的值：\n$$\nf(0) = \\frac{\\alpha}{1 + \\left(\\frac{0}{K}\\right)^{n}} - \\delta(0) = \\frac{\\alpha}{1} - 0 = \\alpha\n$$\n鉴于最大合成速率 $\\alpha > 0$，我们有 $f(0) > 0$。\n\n接下来，我们考察 $f(x)$ 在 $x \\to \\infty$ 时的渐近行为：\n$$\n\\lim_{x\\to\\infty} f(x) = \\lim_{x\\to\\infty} \\left( \\frac{\\alpha}{1 + \\left(\\frac{x}{K}\\right)^{n}} - \\delta x \\right)\n$$\n当 $x \\to \\infty$ 时，由于 $K>0$ 且 $n \\geq 1$，项 $(x/K)^n \\to \\infty$。因此，第一项的分母 $1 + (x/K)^n \\to \\infty$，导致该分数趋近于 $0$。第二项 $-\\delta x$ 趋近于 $-\\infty$，因为损失速率 $\\delta > 0$。\n$$\n\\lim_{x\\to\\infty} f(x) = 0 - \\infty = -\\infty\n$$\n由于 $f(x)$ 在 $x \\geq 0$ 上是连续函数，并且它从一个正值 $f(0) = \\alpha$ 过渡到负无穷大，根据介值定理，保证存在至少一个根 $x^* > 0$ 使得 $f(x^*) = 0$。\n\n为了确定这个根的唯一性，我们通过计算其导数 $f'(x)$ 来分析 $f(x)$ 的单调性。一个严格单调的函数最多只能与坐标轴相交一次。\n$$\nf'(x) = \\frac{d}{dx}f(x) = \\frac{d}{dx} \\left( p(x) - \\ell(x) \\right) = p'(x) - \\ell'(x)\n$$\n损失曲线 $\\ell(x) = \\delta x$ 的导数是一个常数：\n$$\n\\ell'(x) = \\delta\n$$\n生产曲线 $p(x) = \\alpha \\left(1 + K^{-n}x^n\\right)^{-1}$ 的导数可以使用链式法则求得：\n$$\np'(x) = \\alpha (-1) \\left(1 + K^{-n}x^n\\right)^{-2} \\cdot \\frac{d}{dx}\\left(1 + K^{-n}x^n\\right)\n$$\n$$\np'(x) = -\\alpha \\left(1 + \\left(\\frac{x}{K}\\right)^n\\right)^{-2} \\cdot \\left(n K^{-n} x^{n-1}\\right)\n$$\n$$\np'(x) = - \\frac{\\alpha n K^{-n} x^{n-1}}{\\left(1 + (x/K)^n\\right)^2} = - \\frac{\\alpha n x^{n-1}}{K^n \\left(1 + (x/K)^n\\right)^2}\n$$\n给定参数 $\\alpha > 0$、$K > 0$ 和 $n \\geq 1$。对于任何 $x > 0$，$p'(x)$ 表达式中的所有项均为正，因此 $p'(x)$ 严格为负。对于 $x=0$，如果 $n>1$，则 $p'(0)=0$；如果 $n=1$，则 $p'(0) = -\\alpha/K  0$。在所有 $x \\geq 0$ 的情况下，生产函数的导数都是非正的，即 $p'(x) \\leq 0$。这是负反馈（抑制）的直接结果，即 $x$ 的增加导致其自身产量的减少。\n\n现在我们整合 $f(x)$ 的导数：\n$$\nf'(x) = p'(x) - \\delta\n$$\n我们已经确定对于所有 $x \\geq 0$，$p'(x) \\leq 0$。我们还已知 $\\delta  0$。因此，$f'(x)$ 是一个非正项和一个严格为负的项之和：\n$$\nf'(x) = (\\text{非正值}) - (\\text{正值})  0\n$$\n因此，对于所有 $x \\geq 0$，$f'(x)$ 严格为负。这证明了 $f(x)$ 在其整个定义域上是一个严格单调递减的函数。\n\n总结如下：\n1. $f(x)$ 在 $x \\geq 0$ 上是连续的。\n2. $f(0)  0$。\n3. $\\lim_{x\\to\\infty} f(x) = -\\infty$。\n4. 对于所有 $x \\geq 0$，$f(x)$ 都是严格单调递减的。\n\n一个从正值开始并趋向于负无穷大的连续、严格递减函数，必须且只能与横轴相交一次。这意味着方程 $f(x) = 0$ 存在唯一的解 $x^*  0$。\n\n这个结论对所有有效的参数值（$\\alpha0, K0, n\\geq1, \\delta0$）都成立。因此，该系统只能表现出单稳态动态平衡；它总是只有一个稳态。不同稳态的最大可能数量 $N_{\\mathrm{ss}}$ 是 $1$。无法表现出多稳态是这种典型负反馈结构的一个标志，因为单调递减的生产函数只能与单调递增的线性损失函数在一个点相交。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "在建立了稳定设定点的基础之上，我们现在来解决一个关键的现实挑战：时间延迟。这项练习  使用强大的奈奎斯特稳定性判据来分析转录和翻译中的内在延迟如何破坏一个稳态系统的稳定性，从而导致振荡。通过推导稳定性的边界，你将揭示反馈增益与系统鲁棒性之间的基本权衡，这是合成回路设计和自然生物调控中的一个关键约束。",
            "id": "3923012",
            "problem": "一个合成基因电路通过积分负反馈实现稳态，例如在对抗性积分反馈（AIF）中，通过对误差进行时间积分，从而鲁棒地将输出浓度驱动至一个设定点。考虑该电路在稳态设定点附近的线性时不变（LTI）近似，其中受控分子浓度为 $x(t)$，执行器指令为 $u(t)$。为了捕捉具有转录-翻译延迟的核心稳态积分作用，闭环动力学被建模为一个延迟微分方程（DDE）：\n$$\n\\frac{d x(t)}{d t} = u(t), \\quad u(t) = -k\\,x(t-\\tau),\n$$\n其中 $k0$ 是环路增益，$\\tau0$ 是由感知、转录、翻译和处理引起的总反馈延迟。假设环路周围是单位负反馈，没有开环不稳定极点，并且线性化在工作点邻域内有效。\n\n从频域分析 LTI 系统的基本原理和拉普拉斯变换的定义出发，使用奈奎斯特稳定性判据，确定最大允许环路增益 $k_{\\max}$ 作为延迟 $\\tau$ 的显式函数，以使闭环系统保持稳定。您的最终答案必须是关于 $\\tau$ 的单一符号表达式。无需进行数值四舍五入。最终答案表示时无需单位。",
            "solution": "目标是确定给定闭环系统保持稳定时的最大允许环路增益 $k_{\\max}$。该系统由以下线性时不变（LTI）延迟微分方程（DDE）描述：\n$$\n\\frac{d x(t)}{d t} = u(t), \\quad u(t) = -k\\,x(t-\\tau)\n$$\n其中 $k0$ 且 $\\tau0$。我们将使用基于拉普拉斯变换和频域分析原理的奈奎斯特稳定性判据。\n\n首先，我们推导系统的特征方程。我们将执行器指令 $u(t)$ 的表达式代入浓度 $x(t)$ 的动态方程中：\n$$\n\\frac{d x(t)}{d t} = -k\\,x(t-\\tau)\n$$\n为分析此 LTI 系统的稳定性，我们应用拉普拉斯变换。令 $X(s) = \\mathcal{L}\\{x(t)\\}$。使用微分性质 $\\mathcal{L}\\{\\frac{dx}{dt}\\} = sX(s) - x(0)$ 和时延性质 $\\mathcal{L}\\{x(t-\\tau)\\} = e^{-s\\tau}X(s)$，并假设用于传递函数分析的初始条件为零（即 $x(0)=0$），变换后的方程为：\n$$\nsX(s) = -k e^{-s\\tau} X(s)\n$$\n整理各项以得到特征方程，我们有：\n$$\n(s + k e^{-s\\tau}) X(s) = 0\n$$\n对于非平凡解（$X(s) \\neq 0$），括号中的项必须为零。这就得到了闭环系统的特征方程：\n$$\ns + k e^{-s\\tau} = 0\n$$\n该方程的根是闭环系统的极点。系统稳定的充要条件是所有根的实部均为负。\n\n为应用奈奎斯特稳定性判据，我们首先确定开环传递函数 $L(s)$。单位负反馈系统的特征方程标准形式为 $1 + L(s) = 0$。我们可以将我们的特征方程写成这种形式：\n$$\n1 + \\frac{k e^{-s\\tau}}{s} = 0\n$$\n因此，开环传递函数为：\n$$\nL(s) = \\frac{k e^{-s\\tau}}{s}\n$$\n奈奎斯特稳定性判据将闭环系统的稳定性与开环系统的频率响应联系起来。该判据由公式 $Z = P + N$ 给出，其中：\n- $Z$ 是闭环系统不稳定（右半平面）极点的数量。为保证稳定性，我们需要 $Z=0$。\n- $P$ 是开环系统 $L(s)$ 不稳定（右半平面）极点的数量。\n- $N$ 是 $L(s)$ 的奈奎斯特等高线顺时针环绕临界点 $-1+j0$ 的圈数。\n\n开环传递函数 $L(s)$ 在 $s=0$ 处有一个单极点。这个极点位于虚轴上，而不是在右半平面。因此，开环不稳定极点的数量为 $P=0$。\n为了稳定性（$Z=0$），奈奎斯特判据简化为 $N=0$。这意味着 $L(s)$ 的奈奎斯特图必不能环绕点 $-1+j0$。\n\n为了构建奈奎斯特图，我们通过令 $s=j\\omega$ 来计算 $L(s)$ 沿虚轴的值，其中 $\\omega$ 是角频率。\n$$\nL(j\\omega) = \\frac{k e^{-j\\omega\\tau}}{j\\omega}\n$$\n我们分析 $L(j\\omega)$ 的幅值和相位：\n幅值为：\n$$\n|L(j\\omega)| = \\left| \\frac{k e^{-j\\omega\\tau}}{j\\omega} \\right| = \\frac{|k| |e^{-j\\omega\\tau}|}{|j\\omega|} = \\frac{k}{\\omega} \\quad (\\text{因为 } k0 \\text{ 且对于 } \\omega0)\n$$\n相角为：\n$$\n\\angle L(j\\omega) = \\angle(k) + \\angle(e^{-j\\omega\\tau}) - \\angle(j\\omega) = 0 - \\omega\\tau - \\frac{\\pi}{2} \\quad (\\text{弧度})\n$$\n当奈奎斯特图通过临界点 $-1+j0$ 时，系统处于不稳定边缘，即临界稳定。在此点，幅值为 $1$，相位为 $-\\pi$（或 $-\\pi$ 的任意奇数倍）。\n我们首先找到相位穿越频率 $\\omega_{pc}$，即 $L(j\\omega)$ 的相位等于 $-\\pi$ 时的频率。\n$$\n\\angle L(j\\omega_{pc}) = -\\omega_{pc}\\tau - \\frac{\\pi}{2} = -\\pi\n$$\n求解 $\\omega_{pc}$：\n$$\n-\\omega_{pc}\\tau = -\\pi + \\frac{\\pi}{2} = -\\frac{\\pi}{2}\n$$\n$$\n\\omega_{pc} = \\frac{\\pi}{2\\tau}\n$$\n这是奈奎斯特图穿过负实轴的最低正频率。\n\n接下来，我们计算在该频率下 $L(j\\omega)$ 的幅值：\n$$\n|L(j\\omega_{pc})| = \\frac{k}{\\omega_{pc}} = \\frac{k}{\\frac{\\pi}{2\\tau}} = \\frac{2k\\tau}{\\pi}\n$$\n为使系统临界稳定，此幅值必须恰好等于 $1$。这个条件定义了最大允许环路增益 $k_{\\max}$。\n$$\n|L(j\\omega_{pc})| = 1\n$$\n$$\n\\frac{2k_{\\max}\\tau}{\\pi} = 1\n$$\n求解 $k_{\\max}$：\n$$\nk_{\\max} = \\frac{\\pi}{2\\tau}\n$$\n对于任何增益 $k  k_{\\max}$，幅值 $|L(j\\omega_{pc})|$ 将小于 $1$，这意味着奈奎斯特图将在 $0$ 和 $-1$ 之间穿过负实轴。在这种情况下，对点 $-1+j0$ 的环绕圈数 $N$ 为零，闭环系统是稳定的。如果 $k  k_{\\max}$，幅值将大于 $1$，点 $-1+j0$ 将被环绕，系统将不稳定。\n\n因此，为保证稳定性，最大允许环路增益为 $k_{\\max} = \\frac{\\pi}{2\\tau}$。",
            "answer": "$$\\boxed{\\frac{\\pi}{2\\tau}}$$"
        },
        {
            "introduction": "我们最后的练习将从分析现有系统转向新系统的系统性设计。这项练习  引入了线性二次调节器（LQR）框架——最优控制理论的基石——用于工程化设计一个稳态基因回路。你将学习如何构建一个平衡状态偏差和控制成本的性能目标函数，并由此推导出最优反馈控制器，从而为设计高性能的合成生物系统提供一种强有力的方法论。",
            "id": "3923025",
            "problem": "您正在为一个合成基因回路在固定稳态工作点附近的稳态进行建模。设分子种类浓度与稳态的偏差由状态向量 $x \\in \\mathbb{R}^n$ 表示，并设 $u \\in \\mathbb{R}^m$ 是一个控制驱动（例如，可诱导的转录驱动），它作为负反馈施加以维持稳态。工作点附近的线性化动力学被建模为一个连续时间线性时不变系统\n$$\n\\dot{x}(t) = A x(t) + B u(t),\n$$\n其中 $A \\in \\mathbb{R}^{n \\times n}$ 和 $B \\in \\mathbb{R}^{n \\times m}$ 是从生物物理模型的线性化中获得的已知常数矩阵。设计目标是在无限时间范围内最小化偏离稳态的程度和控制代价。\n\n通过定义一个在无限时间范围内的二次代价泛函，来构建线性二次调节器（LQR）问题。该泛函包含一个状态权重矩阵 $Q \\in \\mathbb{R}^{n \\times n}$ 和一个控制权重矩阵 $R \\in \\mathbb{R}^{m \\times m}$，其中 $Q$ 是对称半正定矩阵，$R$ 是对称正定矩阵。从哈密顿-雅可比-贝尔曼原理（也称为动态规划最优性原理）出发，推导价值函数的代数最优性条件，并以 $A, B, Q, R$ 的形式得到最优静态状态反馈律 $u(t) = -K x(t)$。明确说明保证唯一稳定解存在的任何标准假设。\n\n然后，实现一个程序，针对每个提供的测试用例，通过求解您推导出的相应代数方程来计算最优状态反馈增益 $K$。对于数值报告，针对每个测试用例，返回按行主序展平并四舍五入到 $6$ 位小数的 $K$ 的条目。\n\n测试套件：\n- 案例 $1$ (标量，开环弱不稳定基因产物): \n  $$\n  A = \\begin{bmatrix} 0.1 \\end{bmatrix}, \\quad\n  B = \\begin{bmatrix} 1.0 \\end{bmatrix}, \\quad\n  Q = \\begin{bmatrix} 1.0 \\end{bmatrix}, \\quad\n  R = \\begin{bmatrix} 0.5 \\end{bmatrix}.\n  $$\n- 案例 $2$ (双态转录-翻译，作用于转录):\n  $$\n  A = \\begin{bmatrix} -0.3  0.0 \\\\ 2.0  -0.4 \\end{bmatrix}, \\quad\n  B = \\begin{bmatrix} 1.0 \\\\ 0.0 \\end{bmatrix}, \\quad\n  Q = \\begin{bmatrix} 10.0  0.0 \\\\ 0.0  1.0 \\end{bmatrix}, \\quad\n  R = \\begin{bmatrix} 0.2 \\end{bmatrix}.\n  $$\n- 案例 $3$ (双态交叉耦合蛋白质模块，单输入):\n  $$\n  A = \\begin{bmatrix} 0.05  0.2 \\\\ -0.3  -0.1 \\end{bmatrix}, \\quad\n  B = \\begin{bmatrix} 0.5 \\\\ 0.1 \\end{bmatrix}, \\quad\n  Q = \\begin{bmatrix} 5.0  0.0 \\\\ 0.0  2.0 \\end{bmatrix}, \\quad\n  R = \\begin{bmatrix} 1.0 \\end{bmatrix}.\n  $$\n- 案例 $4$ (标量，小控制惩罚):\n  $$\n  A = \\begin{bmatrix} -0.05 \\end{bmatrix}, \\quad\n  B = \\begin{bmatrix} 0.2 \\end{bmatrix}, \\quad\n  Q = \\begin{bmatrix} 0.1 \\end{bmatrix}, \\quad\n  R = \\begin{bmatrix} 0.001 \\end{bmatrix}.\n  $$\n- 案例 $5$ (双态双输入模块，具有对角占优的驱动通道):\n  $$\n  A = \\begin{bmatrix} -0.2  1.0 \\\\ -1.5  -0.3 \\end{bmatrix}, \\quad\n  B = \\begin{bmatrix} 1.0  0.0 \\\\ 0.0  0.5 \\end{bmatrix}, \\quad\n  Q = \\begin{bmatrix} 2.0  0.2 \\\\ 0.2  3.0 \\end{bmatrix}, \\quad\n  R = \\begin{bmatrix} 1.0  0.1 \\\\ 0.1  2.0 \\end{bmatrix}.\n  $$\n\n您的程序应计算每个案例的 $K$，并生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。列表中的每个元素本身也是一个由方括号括起来的逗号分隔列表，包含按行主序排列并四舍五入到 $6$ 位小数的 $K$ 的条目。例如，$[ \\text{res}1, \\text{res}2, \\text{res}3 ]$ 应显示为 $[\\text{res}1,\\text{res}2,\\text{res}3]$，没有空格。此问题中无需报告物理单位。每个案例的最终输出必须是浮点数列表。",
            "solution": "该问题要求从哈密頓-雅可比-贝尔曼（HJB）原理出发，使用线性二次调节器（LQR）框架，为连续时间线性时不变（LTI）系统推导最优状态反馈控制器。该公式是优化控制理论的核心，并广泛应用于工程和科学领域，包括为实现稳态而对合成基因回路进行建模。\n\n系统动力学由以下线性常微分方程给出：\n$$\n\\dot{x}(t) = A x(t) + B u(t)\n$$\n其中 $x(t) \\in \\mathbb{R}^n$ 是表示偏离稳态的状态向量，$u(t) \\in \\mathbb{R}^m$ 是控制输入，$A \\in \\mathbb{R}^{n \\times n}$ 是系统矩阵，$B \\in \\mathbb{R}^{n \\times m}$ 是输入矩阵。\n\n目标是找到一个控制律 $u(t)$，以最小化无限时间范围内的二次代价泛函 $J$：\n$$\nJ = \\int_{0}^{\\infty} \\left( x(t)^T Q x(t) + u(t)^T R u(t) \\right) dt\n$$\n这里，$Q \\in \\mathbb{R}^{n \\times n}$ 是一个对称半正定状态权重矩阵 ($Q = Q^T \\ge 0$)，$R \\in \\mathbb{R}^{m \\times m}$ 是一个对称正定控制权重矩阵 ($R = R^T  0$)。项 $x^T Q x$ 惩罰偏离平衡态 $x=0$ 的行为，而 $u^T R u$ 惩罰控制代价。\n\n我们使用动态规划原理进行推导。最优未来成本（cost-to-go），或称价值函数 $V(x)$，定义为从时间 $t=0$ 时的状态 $x$ 出发可实现的最小成本。对于无限时间范围内的时不变系统，$V$ 仅取决于状态 $x$：\n$$\nV(x) = \\min_{u(\\cdot)} \\int_{0}^{\\infty} \\left( x(\\tau)^T Q x(\\tau) + u(\\tau)^T R u(\\tau) \\right) d\\tau\n$$\n哈密顿-雅可比-贝尔曼（HJB）方程为最优性提供了必要条件。对于无限时间范围的 LQR 问题，稳态 HJB 方程为：\n$$\n0 = \\min_{u} \\left\\{ L(x, u) + \\nabla V(x)^T \\dot{x} \\right\\}\n$$\n其中 $L(x, u) = x^T Q x + u^T R u$ 是瞬时成本，$\\nabla V(x)$ 是价值函数关于 $x$ 的梯度。代入系统动力学，我们得到：\n$$\n0 = \\min_{u} \\left\\{ x^T Q x + u^T R u + \\nabla V(x)^T (A x + B u) \\right\\}\n$$\n最小化括号内的表达式是系统的哈密顿量。为了找到最优控制 $u^*(t)$，我们需找到使该哈密顿量最小化的 $u$。\n\n让我们为价值函数假设一个二次形式，$V(x) = x^T P x$，其中 $P \\in \\mathbb{R}^{n \\times n}$ 是一个待确定的对称正定矩阵。该价值函数的梯度为 $\\nabla V(x) = 2 P x$。将其代入 HJB 方程可得：\n$$\n0 = \\min_{u} \\left\\{ x^T Q x + u^T R u + (2 P x)^T (A x + B u) \\right\\}\n$$\n$$\n0 = \\min_{u} \\left\\{ x^T Q x + u^T R u + 2 x^T P A x + 2 x^T P B u \\right\\}\n$$\n为了找到使此表达式最小化的控制 $u$，我们对 $u$ 求导并令结果为零。由于 $R$ 是对称的，$u^T R u$ 的导数是 $2 R u$，$2 x^T P B u$ 的导数是 $2 B^T P x$。\n$$\n\\frac{\\partial}{\\partial u} \\left( u^T R u + 2 x^T P B u \\right) = 2 R u + 2 B^T P x = 0\n$$\n求解最优控制 $u^*$：\n$$\nu^*(x) = -R^{-1} B^T P x\n$$\n$R^{-1}$ 的存在性由 $R$ 的正定性保证。此结果表明，最优控制是一个线性静态状态反馈律，$u(t) = -K x(t)$，其中最优反馈增益矩阵由下式给出：\n$$\nK = R^{-1} B^T P\n$$\n现在我们将最优控制 $u^*$ 代回到最小化的 HJB 方程中：\n$$\n0 = x^T Q x + (-R^{-1} B^T P x)^T R (-R^{-1} B^T P x) + 2 x^T P A x + 2 x^T P B (-R^{-1} B^T P x)\n$$\n利用属性 $(XYZ)^T = Z^T Y^T X^T$ 以及 $R$ 和 $P$ 是对称的（$R=R^T, P=P^T$），我们简化这些项：\n$$\n0 = x^T Q x + (x^T P B R^{-1}) R (R^{-1} B^T P x) + x^T(P A + A^T P)x - 2 x^T P B R^{-1} B^T P x\n$$\n$$\n0 = x^T Q x + x^T P B R^{-1} B^T P x + x^T(A^T P + P A)x - 2 x^T P B R^{-1} B^T P x\n$$\n合并各项，我们得到：\n$$\n0 = x^T \\left( A^T P + P A - P B R^{-1} B^T P + Q \\right) x\n$$\n该方程必须对任何状态向量 $x \\in \\mathbb{R}^n$ 都成立。这只在括号内的矩阵表达式为零矩阵时才可能。这给出了 $P$ 的代数最优性条件：\n$$\nA^T P + P A - P B R^{-1} B^T P + Q = 0\n$$\n这就是连续时间代数黎卡提方程（CARE）。\n\n为了使 CARE 存在唯一的对称半正定解 $P$，从而使得闭环系统 $\\dot{x} = (A - B K)x$ 是渐近稳定的，需要两个标准假设：\n1.  对 $(A, B)$ 必须是可镇定的。这意味着系统的任何不稳定模式（$A$ 的具有非负实部的特征值）都必须是可控的。\n2.  对 $(C, A)$（其中 $C$ 满足 $Q = C^T C$，例如 $C=Q^{1/2}$）必须是可检测的。这意味着系统的任何不可观测模式都必须是内禀稳定的（具有负实部的特征值）。\n\n如果满足这些条件，CARE 就有一个唯一的镇定解 $P \\ge 0$。数值计算过程是求解 CARE 得到矩阵 $P$，然后使用推导出的公式 $K = R^{-1} B^T P$ 计算最优增益矩阵 $K$。标准的数值库为 CARE 提供了鲁棒的求解器。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_continuous_are\n\ndef solve():\n    \"\"\"\n    Computes the optimal LQR gain K for a set of test cases.\n\n    For each case, the function solves the Continuous-time Algebraic Riccati Equation (CARE)\n    A'P + PA - PBR^{-1}B'P + Q = 0 for the matrix P.\n    Then, it computes the optimal feedback gain K = R^{-1}B'P.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: scalar, open-loop weakly unstable\n        (np.array([[0.1]]), np.array([[1.0]]), np.array([[1.0]]), np.array([[0.5]])),\n        \n        # Case 2: two-state transcription-translation\n        (np.array([[-0.3, 0.0], [2.0, -0.4]]), np.array([[1.0], [0.0]]), \n         np.array([[10.0, 0.0], [0.0, 1.0]]), np.array([[0.2]])),\n        \n        # Case 3: two-state cross-coupled module\n        (np.array([[0.05, 0.2], [-0.3, -0.1]]), np.array([[0.5], [0.1]]), \n         np.array([[5.0, 0.0], [0.0, 2.0]]), np.array([[1.0]])),\n        \n        # Case 4: scalar with small control penalty\n        (np.array([[-0.05]]), np.array([[0.2]]), np.array([[0.1]]), np.array([[0.001]])),\n\n        # Case 5: two-state, two-input module\n        (np.array([[-0.2, 1.0], [-1.5, -0.3]]), np.array([[1.0, 0.0], [0.0, 0.5]]), \n         np.array([[2.0, 0.2], [0.2, 3.0]]), np.array([[1.0, 0.1], [0.1, 2.0]]))\n    ]\n\n    results = []\n    for A, B, Q, R in test_cases:\n        # Solve the Continuous-time Algebraic Riccati Equation for P\n        # A.T @ P + P @ A - P @ B @ np.linalg.inv(R) @ B.T @ P + Q = 0\n        P = solve_continuous_are(A, B, Q, R)\n        \n        # Calculate the optimal feedback gain K\n        # K = R^{-1} * B^T * P\n        R_inv = np.linalg.inv(R)\n        K = R_inv @ B.T @ P\n        \n        # Flatten the K matrix in row-major order\n        k_flat = K.flatten().tolist()\n        \n        # Round the values to 6 decimal places\n        k_rounded = [round(val, 6) for val in k_flat]\n        \n        # Format the list as a string \"[v1,v2,...]\"\n        result_str = f\"[{','.join(map(str, k_rounded))}]\"\n        results.append(result_str)\n\n    # Final print statement in the exact required format.\n    # e.g., [[k_11,k_12],[k_21,k_22],...]\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}