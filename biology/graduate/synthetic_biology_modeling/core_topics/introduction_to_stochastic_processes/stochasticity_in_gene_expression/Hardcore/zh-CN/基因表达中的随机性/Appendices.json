{
    "hands_on_practices": [
        {
            "introduction": "本练习旨在挑战你从转录爆发式合成和降解这些底层的随机过程中，直接推导出作为 $mRNA$ 计数基石模型的负二项分布。掌握这一涉及化学主方程和概率生成函数的推导过程，将使你对微观动力学事件如何塑造宏观群体异质性有更深刻的理解。",
            "id": "3932900",
            "problem": "考虑一个稳态条件下单个细胞中信使核糖核酸（mRNA）生成的脉冲式转录模型。转录脉冲以速率 $k_{b}$（单位时间内的脉冲数）作为齐次泊松过程启动。在一次脉冲中，转录本是顺序生成的：每次潜在的转录本生成尝试以速率 $k_{s}$ 发生，而脉冲以速率 $k_{t}$ 终止。由于指数等待时间的无记忆性，每次脉冲中生成的转录本数量 $B$ 服从 $\\{0,1,2,\\dots\\}$ 上的几何分布，该分布由每一步中继续与终止之间的竞争决定。每个 mRNA 分子以一级动力学独立降解，速率为 $\\gamma$。\n\n从随机化学动力学的第一性原理出发（包括具有批量到达的生灭过程的化学主方程（CME）、齐次泊松过程的定义和性质，以及离散随机变量的概率生成函数），推导该模型中 mRNA 数量 $N$ 的稳态概率质量函数。以闭合形式表达该分布，并根据动力学速率 $k_{b}$、$k_{s}$、$k_{t}$ 和 $\\gamma$ 明确地确定其参数。您的最终答案必须是 $P(N=n)$ 作为 $n$ 和动力学速率的函数的单一闭合形式解析表达式。不需要进行数值计算或四舍五入，最终表达式中也不应包含单位。",
            "solution": "我们对一个具有两种机制的 mRNA 数量过程进行建模：脉冲式合成和一级降解。脉冲根据速率为 $k_{b}$ 的齐次泊松过程到达，每次脉冲瞬时将 mRNA 数量增加一个随机整数 $B \\in \\{0,1,2,\\dots\\}$。在脉冲之间，现存的 $n$ 个分子中的每一个都以速率 $\\gamma$ 独立降解，这产生标准的线性死亡动力学。\n\n首先，我们描述脉冲大小的分布。在一次脉冲中，系统反复面临两个独立的指数事件之间的竞争：以速率 $k_{s}$ 生成下一个转录本，或以速率 $k_{t}$ 终止脉冲。在每一步，先于下一个转录本而终止的概率是\n$$\np \\equiv \\frac{k_{t}}{k_{s} + k_{t}},\n$$\n而继续（即，再生成一个转录本并再次尝试）的概率是\n$$\n1 - p = \\frac{k_{s}}{k_{s} + k_{t}}.\n$$\n因为每一步都是无记忆且同分布的，所以一次脉冲中生成的转录本数量 $B$ 服从参数为 $p$ 的 $\\{0,1,2,\\dots\\}$ 上的几何分布，即，\n$$\n\\Pr(B = m) = p \\,(1-p)^{m}, \\quad m = 0,1,2,\\dots,\n$$\n其均值为 $\\mathbb{E}[B] = \\frac{1-p}{p} = \\frac{k_{s}}{k_{t}}$。$B$ 的概率生成函数（pgf）是\n$$\nF_{B}(z) \\equiv \\mathbb{E}[z^{B}] = \\sum_{m=0}^{\\infty} p\\,(1-p)^{m} z^{m} = \\frac{p}{1 - (1-p) z}, \\quad |(1-p)z|  1.\n$$\n\n接下来，我们写出在时间 $t$ 有 $n$ 个 mRNA 分子的概率 $P_{n}(t)$ 的化学主方程（CME）。对于每个分子以速率 $\\gamma$ 进行的一级降解，以及以速率 $k_{b}$ 到达、每次增加 $m$ 个分子（$m$ 的分布如上所述）的脉冲，CME为\n$$\n\\frac{d}{dt} P_{n}(t) = \\gamma \\big[(n+1) P_{n+1}(t) - n P_{n}(t)\\big] + k_{b} \\left[\\sum_{m=0}^{n} \\Pr(B=m)\\, P_{n-m}(t) - P_{n}(t)\\right].\n$$\n将 $N(t)$ 的 pgf 定义为 $G(z,t) \\equiv \\sum_{n=0}^{\\infty} P_{n}(t) z^{n}$。将 CME 乘以 $z^{n}$ 并对 $n \\geq 0$ 求和。使用线性死亡过程和批量迁入过程的生成函数的标准恒等式，我们得到\n$$\n\\frac{\\partial}{\\partial t} G(z,t) = \\gamma (1 - z)\\, \\frac{\\partial}{\\partial z} G(z,t) + k_{b} \\big( F_{B}(z) - 1 \\big) G(z,t).\n$$\n在稳态下，$\\frac{\\partial}{\\partial t} G(z,t) = 0$，因此稳态 pgf $G(z)$ 满足\n$$\n\\gamma (1 - z)\\, \\frac{d}{dz} G(z) + k_{b} \\big( F_{B}(z) - 1 \\big) G(z) = 0.\n$$\n代入 $F_{B}(z) = \\frac{p}{1 - (1-p)z}$ 并整理得：\n$$\n\\frac{d}{dz} \\ln G(z) = - \\frac{k_{b}}{\\gamma} \\frac{F_{B}(z) - 1}{1 - z} = - \\frac{k_{b}}{\\gamma} \\frac{\\frac{p}{1 - (1-p)z} - 1}{1 - z}.\n$$\n显式地计算该比率：\n$$\n\\frac{F_{B}(z) - 1}{1 - z} = \\frac{\\frac{p}{1 - (1-p)z} - 1}{1 - z} = \\frac{p - \\big(1 - (1-p)z\\big)}{(1 - (1-p)z)(1 - z)} = \\frac{(1-p)(z - 1)}{(1 - (1-p)z)(1 - z)} = - \\frac{1 - p}{1 - (1-p) z}.\n$$\n因此，\n$$\n\\frac{d}{dz} \\ln G(z) = \\frac{k_{b}}{\\gamma} \\frac{1 - p}{1 - (1-p) z}.\n$$\n从 $z=1$（根据归一化条件 $G(1)=1$）积分到一个通用的 $z$：\n$$\n\\ln G(z) - \\ln G(1) = \\frac{k_{b}}{\\gamma} \\int_{1}^{z} \\frac{1 - p}{1 - (1-p) u}\\, du = \\frac{k_{b}}{\\gamma} \\Big[ - \\ln\\big(1 - (1-p) z\\big) + \\ln\\big(1 - (1-p)\\cdot 1\\big) \\Big].\n$$\n注意 $1 - (1-p) = p$，因此\n$$\n\\ln G(z) = \\frac{k_{b}}{\\gamma} \\ln \\left( \\frac{p}{1 - (1-p) z} \\right),\n$$\n所以\n$$\nG(z) = \\left( \\frac{p}{1 - (1-p) z} \\right)^{\\frac{k_{b}}{\\gamma}}.\n$$\n这是形状参数为 $r \\equiv \\frac{k_{b}}{\\gamma}$、成功概率为 $p$ 的负二项分布的 pgf。为了提取概率质量函数，写出\n$$\nG(z) = p^{r} \\big[ 1 - (1-p) z \\big]^{-r}.\n$$\n使用广义二项级数 $(1 - x)^{-r} = \\sum_{n=0}^{\\infty} \\frac{\\Gamma(n + r)}{\\Gamma(r)\\, n!} x^{n}$ (对于 $|x|  1$) ，$z^{n}$ 的系数得出\n$$\nP(N = n) = \\frac{\\Gamma(n + r)}{\\Gamma(r)\\, n!} (1 - p)^{n} p^{r}, \\quad n = 0,1,2,\\dots,\n$$\n其中 $r = \\frac{k_{b}}{\\gamma}$ 且 $p = \\frac{k_{t}}{k_{s} + k_{t}}$ (因此 $1 - p = \\frac{k_{s}}{k_{s} + k_{t}}$)。这就将稳态的负二项 mRNA 数量分布完全用动力学速率 $k_{b}$、$k_{s}$、$k_{t}$ 和 $\\gamma$ 表达出来了。\n\n总之，闭合形式的解析表达式是\n$$\nP(N = n) = \\frac{\\Gamma\\!\\left(n + \\frac{k_{b}}{\\gamma}\\right)}{\\Gamma\\!\\left(\\frac{k_{b}}{\\gamma}\\right)\\, n!} \\left( \\frac{k_{s}}{k_{s} + k_{t}} \\right)^{n} \\left( \\frac{k_{t}}{k_{s} + k_{t}} \\right)^{\\frac{k_{b}}{\\gamma}}.\n$$",
            "answer": "$$\\boxed{\\frac{\\Gamma\\!\\left(n + \\frac{k_{b}}{\\gamma}\\right)}{\\Gamma\\!\\left(\\frac{k_{b}}{\\gamma}\\right)\\, n!}\\left(\\frac{k_{s}}{k_{s}+k_{t}}\\right)^{n}\\left(\\frac{k_{t}}{k_{s}+k_{t}}\\right)^{\\frac{k_{b}}{\\gamma}}}$$"
        },
        {
            "introduction": "虽然像负二项分布这样的解析解非常强大，但它们通常仅限于稳态下的简单模型。为了研究更复杂的网络或瞬态动力学，我们需要数值模拟。本练习聚焦于 Gillespie 随机模拟算法 (SSA)，这是化学反应网络精确模拟的黄金标准。通过一个简单的生灭过程，你将巩固对该算法为何有效的理解，特别是下一个反应事件的等待时间以及发生哪个反应的选择是如何从第一性原理中确定的，这为你模拟任何随机生物化学系统奠定了基础。",
            "id": "3932935",
            "problem": "考虑一个单蛋白种类的基因表达的充分混合单细胞模型，其中分子数量是一个随机过程 $X(t) \\in \\mathbb{N}_0$。该生化网络包含两个反应通道：一个速率常数为 $k  0$ 的零级合成反应 $\\varnothing \\to X$，以及一个速率常数为 $\\gamma  0$ 的一级降解反应 $X \\to \\varnothing$。在质量作用定律以及固定体积和充分混合条件的假设下，当目前状态为 $x$ 时，反应倾向函数分别为：合成反应 $a_1(x) = k$ 和降解反应 $a_2(x) = \\gamma x$。该系统被建模为一个由化学主方程（CME）控制的连续时间马尔可夫链（CTMC）。你需要从这些第一性原理出发，确定用于模拟 $X(t)$ 样本路径的 Gillespie 直接法的正确算法步骤，并利用马尔可夫性质和反应风险率的解释，来论证下一次反应事件等待时间的分布。\n\n对于这个生灭过程，哪个选项正确地概述了 Gillespie 直接法的步骤，并为下一次反应的等待时间分布和下一次反应通道的选择提供了正确的第一性原理证明？\n\nA. 在每次迭代中，给定当前状态 $x$，计算 $a_1(x) = k$ 和 $a_2(x) = \\gamma x$，以及它们的总和 $a_0(x) = a_1(x) + a_2(x)$。抽取一个均匀分布的随机变量 $U_1 \\in (0,1)$，并将等待时间 $\\tau$ 设为 $\\tau = \\frac{1}{a_0(x)} \\ln\\!\\left(\\frac{1}{U_1}\\right)$，从而从一个速率为 $a_0(x)$ 的指数分布中抽样 $\\tau$。抽取第二个均匀分布的随机变量 $U_2 \\in (0,1)$，并选择反应 $j \\in \\{1,2\\}$，使其成为满足 $\\sum_{i=1}^{j} a_i(x) \\ge U_2 a_0(x)$ 的最小索引；用 $\\nu_1 = +1$ 和 $\\nu_2 = -1$ 通过 $x \\leftarrow x + \\nu_j$ 更新状态，并将时间推进 $\\tau$。证明：以反应之间 $x$ 固定为条件，根据 CME 和质量作用倾向函数，任何反应在无穷小区间 $[t, t+\\mathrm{d}t)$ 内发生的总风险率为 $a_0(x)\\,\\mathrm{d}t + o(\\mathrm{d}t)$。直到时间 $\\tau$ 没有事件发生的生存概率 $S(\\tau)$ 服从 $\\frac{\\mathrm{d}}{\\mathrm{d}\\tau} S(\\tau) = -a_0(x) S(\\tau)$ 且 $S(0) = 1$，得出 $S(\\tau) = \\exp(-a_0(x)\\tau)$，即 $\\tau \\sim \\mathrm{Exp}(a_0(x))$。下一个反应是通道 $j$ 的概率等于 $a_j(x)/a_0(x)$，通过累积倾向函数规则实现。\n\nB. 在每次迭代中，计算 $a_1(x)$ 和 $a_2(x)$ 并设 $a_0(x) = a_1(x) + a_2(x)$。从均值为 $\\mu = \\frac{1}{a_0(x)}$、方差为 $\\sigma^2 = \\frac{1}{a_0(x)}$ 的高斯分布中抽取等待时间 $\\tau$，并引用中心极限定理来近似事件间隔时间。确定性地选择具有较大倾向函数的通道作为下一个反应，即如果 $k  \\gamma x$ 则选择合成，否则选择降解。证明：因为许多小的随机波动对时间有贡献，所以正态近似是合适的，并且最可能的通道应该发生。\n\nC. 在每次迭代中，计算 $a_1(x)$ 和 $a_2(x)$，但将等待时间 $\\tau$ 视为以速率 $\\gamma x$ 呈指数分布，因为降解取决于 $x$，因此主导了时间尺度。通过抽取 $U_2 \\in (0,1)$ 来选择下一个反应通道，如果 $U_2 \\le k$ 则选择合成，否则选择降解，因为合成是一个恒定速率过程。证明：降解通道中的状态依赖性决定了整体时间尺度。\n\nD. 在每次迭代中，计算 $a_1(x)$ 和 $a_2(x)$，并将组合速率定义为乘积 $a_1(x)\\,a_2(x) = k\\,\\gamma x$。从速率为 $k\\,\\gamma x$ 的指数分布中抽取等待时间 $\\tau$，因为竞争的独立风险率是相乘的。使用与 $a_j(x)^2$ 成比例的概率选择下一个反应，即以概率 $\\frac{k^2}{k^2 + (\\gamma x)^2}$ 选择合成，否则选择降解。证明：通道的独立性意味着风险率相乘和权重平方。\n\nE. 在每次迭代中，将总风险率视为时间依赖的，因为系统在演化，并定义 $a_0(x(t)) = k + \\gamma x(t)$。通过求解 $\\int_{t}^{t+\\tau} a_0(x(s))\\,\\mathrm{d}s = -\\ln(U_1)$（其中 $U_1 \\in (0,1)$）来抽取 $\\tau$，承认其非平稳性。然后以概率 $a_j(x(t+\\tau))/a_0(x(t+\\tau))$ 选择下一个反应通道。证明：由于 $x(t)$ 连续变化，必须对风险率进行时间积分以获得下一个事件的时间。",
            "solution": "必须首先评估问题陈述的有效性。\n\n### 第 1 步：提取已知信息\n- **模型：** 一个单蛋白种类的充分混合单细胞模型。\n- **状态变量：** 蛋白质分子数量，$X(t)$，一个在非负整数 $\\mathbb{N}_0$ 上的随机过程。\n- **反应通道：**\n    1.  合成：$\\varnothing \\xrightarrow{k} X$。这是一个速率常数为 $k  0$ 的零级反应。\n    2.  降解：$X \\xrightarrow{\\gamma} \\varnothing$。这是一个速率常数为 $\\gamma  0$ 的一级反应。\n- **假设与框架：**\n    - 质量作用定律，固定体积，充分混合条件。\n    - 对于一个有 $x$ 个分子的状态，其倾向函数为：\n        - 合成倾向函数：$a_1(x) = k$。\n        - 降解倾向函数：$a_2(x) = \\gamma x$。\n    - 该系统被建模为一个由化学主方程（CME）描述的连续时间马尔可夫链（CTMC）。\n- **目标：** 确定 Gillespie 直接法算法的正确描述及其用于模拟 $X(t)$ 样本路径的第一性原理证明。该证明必须解释下一次反应等待时间的分布以及选择哪个反应发生的方法。\n\n### 第 2 步：使用提取的已知信息进行验证\n- **科学依据：** 该问题描述了一个经典的生灭过程，这是随机化学动力学、系统生物学和合成生物学中一个基础且广泛使用的模型。所涉及的反应、速率定律和倾向函数是非调控基因表达的标准表示。其理论框架（CTMC, CME）对于此类问题是正确且公认的。该问题在科学上是合理的。\n- **适定性：** 该问题是适定的。它要求从一组选项中确定正确的算法和证明。鉴于 Gillespie 随机模拟算法（SSA）的标准定义和推导，基于已建立的理论，存在一个唯一的正确答案。\n- **客观性：** 语言正式、精确、无歧义。它使用了该领域的标准术语，不含任何主观或基于观点的内容。\n\n### 第 3 步：结论与行动\n问题陈述是有效的。它在科学上合理、适定且客观。它提供了从第一性原理推导 Gillespie 算法和评估给定选项所需的所有必要信息。我现在将进行求解推导和选项分析。\n\n### 推导与求解\nGillespie 直接法是用于充分混合化学反应系统的精确随机模拟算法。它基于从 CME 的严格推导。其核心思想是在每一步确定两个量：到下一次反应发生的时间（$\\tau$）和该反应的索引（$j$）。\n\n**1. 等待时间 $\\tau$ 的分布**\n假设系统在时间 $t$ 处于状态 $x$。反应通道 $j$ 的倾向函数 $a_j(x)$ 的定义是，$a_j(x)\\,\\mathrm{d}t$ 是反应 $j$ 在无穷小时间区间 $[t, t+\\mathrm{d}t)$ 内发生的概率。所考虑的系统有两个反应通道，其倾向函数为 $a_1(x) = k$ 和 $a_2(x) = \\gamma x$。\n\n这两个反应通道被视为独立的竞争性泊松过程。在 $[t, t+\\mathrm{d}t)$ 内发生*任何*反应的概率是各个概率的总和（因为两个或更多事件发生的概率是 $(\\mathrm{d}t)^2$ 或更高阶的无穷小，因此可以忽略）。令 $a_0(x)$ 为总倾向函数：\n$$a_0(x) = \\sum_{j=1}^{2} a_j(x) = k + \\gamma x$$\n所以，$a_0(x)\\,\\mathrm{d}t$ 是在 $[t, t+\\mathrm{d}t)$ 内发生任何反应的概率。\n\n等待时间 $\\tau$ 是到第一个反应事件发生的时间。设 $P(\\tau, x)$ 为给定状态为 $x$ 时此等待时间的概率密度函数。Gillespie 方法的关键洞见在于，在两次反应之间，状态 $x$ 是恒定的。因此，总倾向函数 $a_0(x)$ 在此等待期间也是恒定的。因此，等待下一个事件的过程是一个速率为 $a_0(x)$ 的齐次泊松过程。\n\n齐次泊松过程的等待时间的概率分布是指数分布。这可以从第一性原理推导。设 $S(\\tau')$ 是到时间 $\\tau'$ 为止没有反应发生的生存概率。系统在区间 $[\\tau', \\tau'+\\mathrm{d}\\tau')$ 内继续存在的概率是 $(1 - a_0(x)\\,\\mathrm{d}\\tau')$。因此，$S(\\tau'+\\mathrm{d}\\tau') = S(\\tau')(1 - a_0(x)\\,\\mathrm{d}\\tau')$。整理并取极限 $\\mathrm{d}\\tau' \\to 0$ 可得微分方程：\n$$\\frac{\\mathrm{d}S(\\tau')}{\\mathrm{d}\\tau'} = -a_0(x) S(\\tau')$$\n在初始条件 $S(0) = 1$ 下，解为 $S(\\tau') = \\exp(-a_0(x)\\tau')$。那么 $\\tau$ 的概率密度函数是 $p(\\tau) = -\\frac{\\mathrm{d}S(\\tau)}{\\mathrm{d}\\tau} = a_0(x)\\exp(-a_0(x)\\tau)$。这证实了 $\\tau$ 是一个速率参数为 $a_0(x)$ 的指数分布：$\\tau \\sim \\mathrm{Exp}(a_0(x))$。\n\n为了使用逆变换采样生成 $\\tau$ 的一个样本，我们将一个均匀随机数 $U_1 \\in (0,1)$ 等于累积分布函数 $F(\\tau) = 1 - \\exp(-a_0(x)\\tau)$。求解 $\\tau$ 可得：\n$$U_1 = 1 - \\exp(-a_0(x)\\tau) \\implies \\exp(-a_0(x)\\tau) = 1 - U_1 \\implies \\tau = -\\frac{1}{a_0(x)}\\ln(1-U_1)$$\n由于 $1-U_1$ 也在 $(0,1)$ 上均匀分布，这等价于 $\\tau = \\frac{1}{a_0(x)}\\ln(\\frac{1}{U_1})$。\n\n**2. 下一个反应 $j$ 的选择**\n假定在时间 $t+\\tau$ 发生了一个反应，我们必须确定是哪个反应。发生的反应是 $j$ 的概率与其对总风险率的贡献成正比。这个条件概率，$P(j | \\text{反应发生})$，是：\n$$P(j) = \\frac{a_j(x)\\,\\mathrm{d}t}{a_0(x)\\,\\mathrm{d}t} = \\frac{a_j(x)}{a_0(x)}$$\n因此，反应 1（合成）被选择的概率为 $p_1 = \\frac{a_1(x)}{a_0(x)} = \\frac{k}{k+\\gamma x}$，而反应 2（降解）被选择的概率为 $p_2 = \\frac{a_2(x)}{a_0(x)} = \\frac{\\gamma x}{k+\\gamma x}$。\n\n实现此选择的一个标准方法是生成第二个均匀随机数 $U_2 \\in (0,1)$，并找到最小的整数 $j$ 使得 $\\sum_{i=1}^{j} p_i \\ge U_2$，这等价于找到最小的 $j$ 使得 $\\sum_{i=1}^{j} a_i(x) \\ge U_2 a_0(x)$。\n\n**3. 状态和时间更新**\n一旦选择了等待时间 $\\tau$ 和反应索引 $j$，系统状态将根据反应 $j$ 的化学计量关系进行更新，时间则推进 $\\tau$。对于我们的系统，状态变化向量为 $\\nu_1 = +1$ 和 $\\nu_2 = -1$。\n- 如果 $j=1$, $x \\leftarrow x+1$。\n- 如果 $j=2$, $x \\leftarrow x-1$。\n两种情况下，$t \\leftarrow t+\\tau$。\n\n### 选项评估\n\n**A. 在每次迭代中，给定当前状态 $x$，计算 $a_1(x) = k$ 和 $a_2(x) = \\gamma x$，以及它们的总和 $a_0(x) = a_1(x) + a_2(x)$。抽取一个均匀分布的随机变量 $U_1 \\in (0,1)$，并将等待时间 $\\tau$ 设为 $\\tau = \\frac{1}{a_0(x)} \\ln\\!\\left(\\frac{1}{U_1}\\right)$，从而从一个速率为 $a_0(x)$ 的指数分布中抽样 $\\tau$。抽取第二个均匀分布的随机变量 $U_2 \\in (0,1)$，并选择反应 $j \\in \\{1,2\\}$，使其成为满足 $\\sum_{i=1}^{j} a_i(x) \\ge U_2 a_0(x)$ 的最小索引；用 $\\nu_1 = +1$ 和 $\\nu_2 = -1$ 通过 $x \\leftarrow x + \\nu_j$ 更新状态，并将时间推进 $\\tau$。证明：以反应之间 $x$ 固定为条件，根据 CME 和质量作用倾向函数，任何反应在无穷小区间 $[t, t+\\mathrm{d}t)$ 内发生的总风险率为 $a_0(x)\\,\\mathrm{d}t + o(\\mathrm{d}t)$。直到时间 $\\tau$ 没有事件发生的生存概率 $S(\\tau)$ 服从 $\\frac{\\mathrm{d}}{\\mathrm{d}\\tau} S(\\tau) = -a_0(x) S(\\tau)$ 且 $S(0) = 1$，得出 $S(\\tau) = \\exp(-a_0(x)\\tau)$，即 $\\tau \\sim \\mathrm{Exp}(a_0(x))$。下一个反应是通道 $j$ 的概率等于 $a_j(x)/a_0(x)$，通过累积倾向函数规则实现。**\n该选项与推导出的算法及其证明完全匹配。算法步骤是正确的，包括倾向函数的计算、指数等待时间的生成以及反应的概率选择。其证明正确地指出了总风险率，从生存概率微分方程正确地推导出等待时间的指数分布，并正确地陈述了选择下一个反应的概率。**正确**。\n\n**B. 在每次迭代中，计算 $a_1(x)$ 和 $a_2(x)$ 并设 $a_0(x) = a_1(x) + a_2(x)$。从均值为 $\\mu = \\frac{1}{a_0(x)}$、方差为 $\\sigma^2 = \\frac{1}{a_0(x)}$ 的高斯分布中抽取等待时间 $\\tau$，并引用中心极限定理来近似事件间隔时间。确定性地选择具有较大倾向函数的通道作为下一个反应，即如果 $k  \\gamma x$ 则选择合成，否则选择降解。证明：因为许多小的随机波动对时间有贡献，所以正态近似是合适的，并且最可能的通道应该发生。**\n该选项因多个原因而错误。等待时间是指数分布，而非正态分布。指数分布的方差是 $(\\frac{1}{a_0(x)})^2$，而不是 $\\frac{1}{a_0(x)}$。高斯分布在物理上不合适，因为它在负数上有支撑域。反应的选择是随机的，而非确定性的。其证明引用了中心极限定理，而这是扩散近似（例如，化学朗之万方程）的基础，不是精确的 Gillespie 方法。**错误**。\n\n**C. 在每次迭代中，计算 $a_1(x)$ 和 $a_2(x)$，但将等待时间 $\\tau$ 视为以速率 $\\gamma x$ 呈指数分布，因为降解取决于 $x$，因此主导了时间尺度。通过抽取 $U_2 \\in (0,1)$ 来选择下一个反应通道，如果 $U_2 \\le k$ 则选择合成，否则选择降解，因为合成是一个恒定速率过程。证明：降解通道中的状态依赖性决定了整体时间尺度。**\n这是错误的。指数等待时间的速率是所有倾向函数的总和，$a_0(x) = k + \\gamma x$，而不仅仅是其中之一。两个过程都对确定*下一个*事件何时发生有贡献。选择规则也是错误的；它应该基于归一化概率 $k/(k+\\gamma x)$，而不仅仅是 $k$。**错误**。\n\n**D. 在每次迭代中，计算 $a_1(x)$ 和 $a_2(x)$，并将组合速率定义为乘积 $a_1(x)\\,a_2(x) = k\\,\\gamma x$。从速率为 $k\\,\\gamma x$ 的指数分布中抽取等待时间 $\\tau$，因为竞争的独立风险率是相乘的。使用与 $a_j(x)^2$ 成比例的概率选择下一个反应，即以概率 $\\frac{k^2}{k^2 + (\\gamma x)^2}$ 选择合成，否则选择降解。证明：通道的独立性意味着风险率相乘和权重平方。**\n这是完全错误的。对于竞争的独立泊松过程，总速率是各个速率的和，而不是积。选择概率与倾向函数 $a_j(x)$ 成正比，而不是它们的平方。其证明完全是对基本概率论的错误陈述。**错误**。\n\n**E. 在每次迭代中，将总风险率视为时间依赖的，因为系统在演化，并定义 $a_0(x(t)) = k + \\gamma x(t)$。通过求解 $\\int_{t}^{t+\\tau} a_0(x(s))\\,\\mathrm{d}s = -\\ln(U_1)$（其中 $U_1 \\in (0,1)$）来抽取 $\\tau$，承认其非平稳性。然后以概率 $a_j(x(t+\\tau))/a_0(x(t+\\tau))$ 选择下一个反应通道。证明：由于 $x(t)$ 连续变化，必须对风险率进行时间积分以获得下一个事件的时间。**\n该选项误解了 CTMC 模型的本质。状态 $X(t)$ 是一个跳跃过程；它是分段常数，而不是连续变化的。Gillespie 算法的核心在于倾向函数 $a_0(x)$ 在事件之间是恒定的，这把问题简化为一个齐次泊松过程。这里描述的积分形式是用于非齐次泊松过程的，并且在此处被错误地应用，因为在模拟下一个事件之前无法知道 $st$ 时的 $x(s)$。整个前提都是有缺陷的。**错误**。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "任何模型的最终检验标准是其解释实验数据的能力。对于建模者而言，一项关键技能是从测量中估计模型参数并量化这些估计的不确定性。最后一个练习将让你扮演数据科学家的角色，分析单细胞谱系数据，开发并实现一种方法来推断一个关键生物学参数——细胞分裂时分子的分配不对称性。这涉及到推导最大似然估计量和构建精确的置信区间，从而将理论模型与定量生物学发现联系起来。",
            "id": "3932921",
            "problem": "考虑一个基于细胞谱系的随机基因表达模型，其中单个细胞谱系通过连续的分裂被追踪。设 $X(t)$ 表示在追踪的细胞中于时间 $t$ 的报告蛋白的分子拷贝数。在两次分裂之间，$X(t)$ 作为一个连续时间生滅过程演化，代表合成和降解，其合成速率为 $k_s$，降解速率为 $k_d$。在离散的分裂时间 $t = T_i$，被追踪的细胞分裂成两个子细胞，母细胞分裂前的分子数记为 $N_i = X(T_i^{-})$。分裂后，立即任意选择一个子细胞继续该谱系。分子根据独立的伯努利试验分配到被追踪的子细胞中：$N_i$ 个分子中的每一个都以概率 $r \\in (0,1)$ 独立地最终进入被追踪的子细胞中，我们称之为分配参数。因此，在给定 $N_i$ 的条件下，被追踪子细胞分裂后瞬时的分子数 $Y_i = X(T_i^{+})$ 服从二项随机变量的分布。\n\n假设延时单细胞测量为谱系中的每个分裂事件提供了由分裂前分子数和分裂后被追踪子细胞的瞬时分子数组成的数对 $(N_i, Y_i)$。假定在给定 $N_i$ 的条件下，不同分裂事件中的分配过程是独立同分布的，且具有相同的参数 $r$。\n\n任务：\n1. 从分裂时独立伯努利试验的定义出发，推导在给定观测序列 $\\{(N_i, Y_i)\\}_{i=1}^m$ 的情况下 $r$ 的似然函数，并从中获得表示为观测计数值函数的 $r$ 的最大似然估计量。论证为何分裂间的生滅动态不影响分裂时刻给定 $N_i$ 时 $Y_i$ 的条件分布。\n2. 使用基于反演二项分布的精确方法（不依赖正态近似），为 $r$ 构建一个置信水平为 $1 - \\alpha$（其中 $\\alpha = 0.05$）的双侧置信区间。明確说明如何处理总成功次数等于 $0$ 或等于总试验次数的边界情况。\n\n您的程序必须为以下测试套件实现这些任务。对于每个测试用例，您将获得一个分裂前计数值列表 $[N_1,\\dots,N_m]$ 和一个相应的分裂后被追踪子细胞计数值列表 $[Y_1,\\dots,Y_m]$：\n\n- 测试用例1（一般情况）：$[104,87,96,110]$ 和 $[58,46,51,62]$。\n- 测试用例2（接近对称）：$[50,50,50,50,50]$ 和 $[25,26,24,22,28]$。\n- 测试用例3（不对称分配）：$[60,55,70]$ 和 $[10,9,12]$。\n- 测试用例4（零边界）：$[3,2,1]$ 和 $[0,0,0]$。\n- 测试用例5（一边界）：$[4,3,1,2]$ 和 $[4,3,1,2]$。\n- 测试用例6（大计数值）：$[1000,1200,900,800]$ 和 $[550,660,495,440]$。\n\n对于每个测试用例：\n- 计算最大似然估计 $\\hat r$。\n- 计算置信水平为 $1 - \\alpha$（$\\alpha = 0.05$）的双侧精确置信区间的下限和上限 $(r_{\\text{L}}, r_{\\text{U}})$。\n- 将每个数值结果四舍五入到六位小数。\n\n最终输出格式：\n您的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表，其中每个测试用例的结果是列表 $[\\hat r, r_{\\text{L}}, r_{\\text{U}}]$。例如，输出必须看起来像 $[[\\hat r_1, r_{\\text{L},1}, r_{\\text{U},1}],[\\hat r_2, r_{\\text{L},2}, r_{\\text{U},2}],\\dots]$，不含空格。",
            "solution": "问题陈述已经过验证，被认为是合理的。它在科学上基于随机基因表达的标准模型，数学上是适定的、客观的，并包含了推导唯一且有意义解所需的所有信息。\n\n任务是就一个基于细胞谱系的基因表达模型中的分配参数 $r$ 进行统计推断。这包括两部分：首先，推导 $r$ 的最大似然估计量（MLE），其次，构建 $r$ 的精确置信区间。\n\n**1. 分配参数 $r$ 的最大似然估计量（MLE）**\n\n问题陈述指出，在每次分裂 $i$ 中，一个含有 $N_i$ 个分子的母细胞将其分配给一个被追踪的子细胞，使得每个分子以概率 $r$ 被独立继承。这是 $N_i$ 次伯努利试验序列的定义，其中“成功”是指一个分子最终进入被追踪的子细胞。因此，总成功次数 $Y_i$ 在试验次数 $N_i$ 的条件下服从二项分布。其概率质量函数（PMF）为：\n$$P(Y_i = y_i | N_i = n_i, r) = \\binom{n_i}{y_i} r^{y_i} (1-r)^{n_i-y_i}$$\n其中 $\\binom{n_i}{y_i}$ 是二项式系数。\n\n我们给定一个包含 $m$ 个独立观测值的序列 $\\{(N_i, Y_i)\\}_{i=1}^m$。不同分裂事件中分配过程的独立性允许我们将给定观测数据时参数 $r$ 的总似然写为各个条件概率的乘积：\n$$L(r; \\{ (N_i, Y_i) \\}) = P(\\{Y_i\\} | \\{N_i\\}, r) = \\prod_{i=1}^{m} P(Y_i | N_i, r)$$\n代入二项分布的PMF，我们得到：\n$$L(r) = \\prod_{i=1}^{m} \\binom{N_i}{Y_i} r^{Y_i} (1-r)^{N_i-Y_i}$$\n为了找到MLE $\\hat{r}$，我们最大化此似然函数。在计算上，最大化对数似然函数 $\\ell(r) = \\ln L(r)$ 更为简单，因为对数是单调函数。\n$$\\ell(r) = \\ln\\left( \\prod_{i=1}^{m} \\binom{N_i}{Y_i} r^{Y_i} (1-r)^{N_i-Y_i} \\right) = \\sum_{i=1}^{m} \\ln\\left( \\binom{N_i}{Y_i} r^{Y_i} (1-r)^{N_i-Y_i} \\right)$$\n$$\\ell(r) = \\sum_{i=1}^{m} \\left( \\ln\\binom{N_i}{Y_i} + Y_i \\ln r + (N_i - Y_i) \\ln(1-r) \\right)$$\n为求最大值，我们计算 $\\ell(r)$ 对 $r$ 的导数并令其为零：\n$$\\frac{d\\ell(r)}{dr} = \\sum_{i=1}^{m} \\left( \\frac{Y_i}{r} - \\frac{N_i - Y_i}{1-r} \\right) = 0$$\n$$\\frac{1}{r} \\sum_{i=1}^{m} Y_i - \\frac{1}{1-r} \\sum_{i=1}^{m} (N_i - Y_i) = 0$$\n令 $Y_{\\text{tot}} = \\sum_{i=1}^{m} Y_i$ 为分裂后在被追踪的子细胞中观测到的分子总数，$N_{\\text{tot}} = \\sum_{i=1}^{m} N_i$ 为分裂前母细胞中的分子总数。方程变为：\n$$\\frac{Y_{\\text{tot}}}{\\hat{r}} = \\frac{N_{\\text{tot}} - Y_{\\text{tot}}}{1-\\hat{r}}$$\n解出 $\\hat{r}$：\n$$Y_{\\text{tot}}(1-\\hat{r}) = \\hat{r}(N_{\\text{tot}} - Y_{\\text{tot}})$$\n$$Y_{\\text{tot}} - Y_{\\text{tot}}\\hat{r} = N_{\\text{tot}}\\hat{r} - Y_{\\text{tot}}\\hat{r}$$\n$$Y_{\\text{tot}} = N_{\\text{tot}}\\hat{r}$$\n因此，$r$ 的最大似然估计量为：\n$$\\hat{r} = \\frac{\\sum_{i=1}^{m} Y_i}{\\sum_{i=1}^{m} N_i} = \\frac{Y_{\\text{tot}}}{N_{\\text{tot}}}$$\n这个结果是直观的：分配概率的最佳估计是总观测成功次数与总试验次数的比率。\n\n控制分裂间蛋白质数量 $X(t)$ 的生灭动态（合成速率 $k_s$，降解速率 $k_d$）决定了 $N_i$ 的概率分布。然而，任务是基于条件概率 $P(Y_i | N_i, r)$ 来找到 $r$ 的MLE。根据条件概率的定义，我们在分裂前计数值已知为 $N_i$ 的条件下分析系统。导致此状态的随机过程对于后续独立的物理分配过程是无关的。分配机制被定义为仅依赖于分裂时刻存在的分子数 $N_i$ 和参数 $r$。因此，分裂间的动态不影响给定观测对 $(N_i, Y_i)$ 时 $r$ 的条件似然。\n\n**2. $r$ 的精确双侧置信区间**\n\n二项分布的一个关键特性是，对于固定的成功概率，它具有可加性。由于每个 $Y_i \\sim \\text{Binomial}(N_i, r)$ 且分裂是独立的，它们的和 $Y_{\\text{tot}} = \\sum_{i=1}^m Y_i$ 也服从二项分布，其参数等于试验次数之和及相同的成功概率：\n$$Y_{\\text{tot}} \\sim \\text{Binomial}(N_{\\text{tot}}, r)$$\n其中 $N_{\\text{tot}} = \\sum_{i=1}^m N_i$。因此，给定观测集 $\\{ (N_i, Y_i) \\}_{i=1}^m$ 的情况下为 $r$ 寻找置信区间的问题，等价于为单个具有 $N_{\\text{tot}}$ 次试验和 $Y_{\\text{tot}}$ 次观测成功的二项实验的成功概率 $r$ 寻找置信区间。\n\n问题要求使用一种精确方法，即 Clopper-Pearson 区间。此方法基于反演两个单侧假设检验。对于给定的试验次数 $n = N_{\\text{tot}}$ 和成功次数 $k = Y_{\\text{tot}}$，一个 $1-\\alpha$ 置信区间 $[r_{\\text{L}}, r_{\\text{U}}]$ 的构建方式如下：\n下界 $r_{\\text{L}}$ 是使得观测到 $k$ 次或更多成功的概率为 $\\alpha/2$ 的 $r$ 值：\n$$P(X \\ge k | r = r_{\\text{L}}) = \\sum_{j=k}^{n} \\binom{n}{j} r_{\\text{L}}^j (1-r_{\\text{L}})^{n-j} = \\frac{\\alpha}{2}$$\n上界 $r_{\\text{U}}$ 是使得观测到 $k$ 次或更少成功的概率为 $\\alpha/2$ 的 $r$ 值：\n$$P(X \\le k | r = r_{\\text{U}}) = \\sum_{j=0}^{k} \\binom{n}{j} r_{\\text{U}}^j (1-r_{\\text{U}})^{n-j} = \\frac{\\alpha}{2}$$\n这些方程可以数值求解。二项累积分布函数（CDF）与正则化不完全贝塔函数之间存在直接关系，这简化了计算。上下界由贝塔分布的分位数给出：\n$r_{\\text{L}}$ 是参数为 $(k, n-k+1)$ 的贝塔分布的 $\\alpha/2$ 分位数：\n$$r_{\\text{L}} = \\text{Beta}(\\alpha/2; k, n-k+1)$$\n$r_{\\text{U}}$ 是参数为 $(k+1, n-k)$ 的贝塔分布的 $1-\\alpha/2$ 分位数：\n$$r_{\\text{U}} = \\text{Beta}(1-\\alpha/2; k+1, n-k)$$\n其中 $\\text{Beta}(q; a, b)$ 表示形状参数为 $a$ 和 $b$ 的贝塔分布的第 $q$ 个分位数（逆CDF）。指定的置信水平是 $1-\\alpha = 0.95$，所以 $\\alpha=0.05$ 且 $\\alpha/2 = 0.025$。\n\n边界情况必须正确处理：\n- 如果 $k = 0$（没有成功，例如测试用例4），则MLE为 $\\hat{r}=0$。下界自然是 $r_{\\text{L}} = 0$。上界通过求解 $P(X \\le 0 | r=r_{\\text{U}}) = (1-r_{\\text{U}})^n = \\alpha/2$ 得到，即 $r_{\\text{U}} = 1 - (\\alpha/2)^{1/n}$。这对应于 $\\text{Beta}(1-\\alpha/2; 1, n)$。\n- 如果 $k = n$（所有试验都成功，例如测试用例5），则MLE为 $\\hat{r}=1$。上界自然是 $r_{\\text{U}} = 1$。下界通过求解 $P(X \\ge n | r=r_{\\text{L}}) = r_{\\text{L}}^n = \\alpha/2$ 得到，即 $r_{\\text{L}} = (\\alpha/2)^{1/n}$。这对应于 $\\text{Beta}(\\alpha/2; n, 1)$。\n\n每个测试用例的计算过程是首先计算 $N_{\\text{tot}} = \\sum N_i$ 和 $Y_{\\text{tot}} = \\sum Y_i$，然后计算 $\\hat{r} = Y_{\\text{tot}}/N_{\\text{tot}}$，最后使用贝塔分布的分位数（其中 $n = N_{\\text{tot}}$，$k = Y_{\\text{tot}}$）计算 $r_{\\text{L}}$ 和 $r_{\\text{U}}$，同时遵守边界条件。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import beta\n\ndef solve():\n    \"\"\"\n    Solves the stochastic gene expression partitioning problem for multiple test cases.\n\n    For each case, it calculates the Maximum Likelihood Estimate (MLE) of the partitioning\n    parameter r and its 95% exact confidence interval (Clopper-Pearson).\n    \"\"\"\n\n    test_cases = [\n        # Test Case 1 (general case)\n        {'N': [104, 87, 96, 110], 'Y': [58, 46, 51, 62]},\n        # Test Case 2 (near symmetry)\n        {'N': [50, 50, 50, 50, 50], 'Y': [25, 26, 24, 22, 28]},\n        # Test Case 3 (asymmetric partitioning)\n        {'N': [60, 55, 70], 'Y': [10, 9, 12]},\n        # Test Case 4 (boundary at zero)\n        {'N': [3, 2, 1], 'Y': [0, 0, 0]},\n        # Test Case 5 (boundary at one)\n        {'N': [4, 3, 1, 2], 'Y': [4, 3, 1, 2]},\n        # Test Case 6 (large counts)\n        {'N': [1000, 1200, 900, 800], 'Y': [550, 660, 495, 440]},\n    ]\n\n    results = []\n    alpha = 0.05\n\n    for case in test_cases:\n        N_list = case['N']\n        Y_list = case['Y']\n\n        # Calculate total pre-division and post-division counts\n        N_tot = np.sum(N_list)\n        Y_tot = np.sum(Y_list)\n\n        # Task 1: Calculate the Maximum Likelihood Estimator (MLE)\n        if N_tot == 0:\n            # Handle the undefined case, although not expected from test data\n            r_hat = np.nan\n        else:\n            r_hat = Y_tot / N_tot\n\n        # Task 2: Calculate the exact (Clopper-Pearson) confidence interval\n        n = N_tot\n        k = Y_tot\n        \n        r_L = 0.0\n        r_U = 1.0\n\n        if n  0: # Proceed only if there are trials\n            # Lower bound\n            if k == 0:\n                r_L = 0.0\n            else:\n                # r_L is the alpha/2 quantile of Beta(k, n-k+1)\n                r_L = beta.ppf(alpha / 2, k, n - k + 1)\n            \n            # Upper bound\n            if k == n:\n                r_U = 1.0\n            else:\n                # r_U is the 1-alpha/2 quantile of Beta(k+1, n-k)\n                r_U = beta.ppf(1 - alpha / 2, k + 1, n - k)\n        else: # Case where N_tot is 0\n            r_L = np.nan\n            r_U = np.nan\n\n        # Format results to six decimal places\n        # Using f-string formatting ensures trailing zeros and rounding\n        formatted_r_hat = f\"{r_hat:.6f}\"\n        formatted_r_L = f\"{r_L:.6f}\"\n        formatted_r_U = f\"{r_U:.6f}\"\n\n        results.append(f\"[{formatted_r_hat},{formatted_r_L},{formatted_r_U}]\")\n    \n    # Final print statement in the exact required format\n    print(f\"[[{formatted_r_hat_1},{formatted_r_L_1},{formatted_r_U_1}],[{formatted_r_hat_2},{formatted_r_L_2},{formatted_r_U_2}],[{formatted_r_hat_3},{formatted_r_L_3},{formatted_r_U_3}],[{formatted_r_hat_4},{formatted_r_L_4},{formatted_r_U_4}],[{formatted_r_hat_5},{formatted_r_L_5},{formatted_r_U_5}],[{formatted_r_hat_6},{formatted_r_L_6},{formatted_r_U_6}]]\")\n\nsolve()\n```"
        }
    ]
}