{
    "hands_on_practices": [
        {
            "introduction": "第一个练习将处理经典的生灭过程，这是基因表达的一个基本模型。通过从化学主方程推导精确的方差，并将其与线性噪声近似的结果进行比较，你将从第一性原理的层面理解LNA所近似的内容及其威力所在，尤其是在线性系统中 。这项实践巩固了微观随机描述与宏观近似之间的联系。",
            "id": "3936470",
            "problem": "考虑一个单物种随机生物化学反应系统，该系统模拟一个合成基因产物，其拷贝数为 $X(t) \\in \\{0,1,2,\\dots\\}$。该系统包含一个零级合成反应 $\\varnothing \\rightarrow X$，其速率常数为 $\\alpha$（单位：分子/单位时间），以及一个一级衰变反应 $X \\rightarrow \\varnothing$，其速率常数为 $\\gamma$（单位：1/单位时间）。其介观动力学由化学主方程（CME）控制，宏观平均场动力学由确定性速率方程描述。\n\n仅使用随机化学动力学的基本定义和定律，完成以下任务：\n\n1. 从生灭过程的稳态CME出发，推导精确的稳态分布，并计算分子计数的精确稳态方差 $\\mathrm{Var}[X]$（用 $\\alpha$ 和 $\\gamma$ 表示）。你的推导应从主方程和概率归一化出发，不得调用针对此特定分布的黑箱公式。\n\n2. 从确定性速率方程 $\\mathrm{d}\\phi/\\mathrm{d}t=\\alpha-\\gamma \\phi$ 及其稳态 $\\phi^{\\ast}$ 出发，围绕 $\\phi^{\\ast}$ 进行线性化，并推导涨落变量的线性噪声近似（LNA）（首次使用时写全称Linear Noise Approximation）方程。根据这些方程，计算LNA预测的稳态方差，并说明其与第1部分得到的精确稳态方差的比较。你的推导应从宏观速率方程开始，构建涨落的线性化随机动力学，并求解稳态方差，不得假设任何已知的“捷径”方差公式。\n\n3. 基于关于线性噪声近似假设的第一性原理推断，简要解释在何种合成生物反应网络的建模条件下，LNA无法复现精确的稳态方差或产生定性上不正确的分布特征，即使在某些线性情况下它能复现前两个矩。\n\n请将你的最终答案表示为精确稳态方差 $\\mathrm{Var}[X]$ 关于 $\\alpha$ 和 $\\gamma$ 的单一闭式解析表达式。不需要数值近似或四舍五入。方差以分子计数表示。",
            "solution": "在尝试任何解答之前，所提供的问题陈述都经过了验证。\n\n### 步骤1：提取给定信息\n-   **系统**：一个单物种随机生物化学反应系统。\n-   **物种**：分子计数 $X(t)$，状态空间为 $X(t) \\in \\{0, 1, 2, \\dots\\}$。\n-   **反应与速率**：\n    1.  合成（零级）：$\\varnothing \\rightarrow X$，速率常数为 $\\alpha$（分子/单位时间）。\n    2.  衰变（一级）：$X \\rightarrow \\varnothing$，速率常数为 $\\gamma$（1/单位时间）。\n-   **动力学**：\n    -   介观：化学主方程（CME）。\n    -   宏观：确定性速率方程 $\\mathrm{d}\\phi/\\mathrm{d}t = \\alpha - \\gamma \\phi$。\n-   **任务**：\n    1.  从稳态CME出发，推导精确的稳态分布 $P_n$，并计算精确的稳态方差 $\\mathrm{Var}[X]$。推导必须从第一性原理出发。\n    2.  从确定性速率方程出发，推导涨落的线性噪声近似（LNA）（写全称为Linear Noise Approximation），并计算LNA预测的稳态方差。\n    3.  解释在何种条件下，LNA无法为方差或分布特征提供准确结果。\n-   **要求输出**：关于 $\\alpha$ 和 $\\gamma$ 的精确稳态方差 $\\mathrm{Var}[X]$ 的单一表达式。\n\n### 步骤2：使用提取的信息进行验证\n根据验证标准对问题进行评估。\n-   **科学依据**：该问题描述了一个生灭过程，这是随机化学动力学中的一个典型模型。化学主方程、确定性速率方程和线性噪声近似是用于建模此类系统的基础且成熟的理论框架。其前提具有科学合理性。\n-   **适定性**：问题定义清晰，所有必要的参数（$\\alpha$, $\\gamma$）和反应通道均已指定。它要求进行具体的、循序渐进的推导，以得到一个可计算的确定量。预计方差存在唯一且稳定的解。\n-   **客观性**：问题以精确的技术语言陈述，没有歧义或主观内容。\n-   **完整性与一致性**：问题陈述是自洽且内部一致的。所描述的反应与给定的确定性速率方程直接对应。没有缺失或矛盾的数据。\n-   **现实性与可行性**：该模型是组成型基因表达的标准且物理上合理的表示，这是合成生物学中常见的模体。\n-   **其他缺陷**：该问题是一个标准的、基础的推导，旨在检验对第一性原理的理解。它并非无关紧要、不适定或无法验证。\n\n### 步骤3：结论与行动\n该问题被判定为**有效**。将提供完整解答。\n\n### 解答\n\n该问题探讨了一个简单基因表达模型的随机动力学，将化学主方程（CME）的精确解与线性噪声近似（LNA）的近似解进行比较。\n\n**1. 从化学主方程推导精确稳态方差**\n\n该系统是一个生灭过程，状态变量 $n \\in \\{0, 1, 2, \\dots\\}$ 代表物种 $X$ 的分子数。反应如下：\n-   生成：$\\varnothing \\xrightarrow{\\alpha} X$ （倾向 $w_b = \\alpha$）\n-   消亡：$X \\xrightarrow{\\gamma} \\varnothing$ （倾向 $w_d(n) = \\gamma n$）\n\n设 $P(n, t)$ 为在时间 $t$ 有 $n$ 个分子的概率。该系统的CME为：\n$$ \\frac{dP(n,t)}{dt} = \\alpha P(n-1,t) + \\gamma (n+1) P(n+1,t) - (\\alpha + \\gamma n) P(n,t) \\quad \\text{for } n \\geq 1 $$\n$$ \\frac{dP(0,t)}{dt} = \\gamma P(1,t) - \\alpha P(0,t) $$\n在稳态下，对所有 $n$ 都有 $\\frac{dP(n,t)}{dt} = 0$。设 $P_n$ 表示稳态概率 $P(n, t \\to \\infty)$。稳态CME成为一组代数方程。一个更简单的方法是使用一维系统的细致平衡原理，该原理指出在稳态下，任何两个相邻状态之间的净通量必须为零。从状态 $n-1$ 到 $n$ 的通量（生成）必须等于从状态 $n$ 到 $n-1$ 的通量（消亡）。\n$$ \\text{通量}(n-1 \\to n) = \\alpha P_{n-1} $$\n$$ \\text{通量}(n \\to n-1) = \\gamma n P_n $$\n令两者相等，得到递推关系：\n$$ \\alpha P_{n-1} = \\gamma n P_n $$\n这可以重新排列以用 $P_{n-1}$ 表示 $P_n$：\n$$ P_n = \\frac{\\alpha}{n \\gamma} P_{n-1} $$\n我们可以通过迭代求解此关系：\n$$ P_1 = \\frac{\\alpha}{1 \\cdot \\gamma} P_0 $$\n$$ P_2 = \\frac{\\alpha}{2 \\gamma} P_1 = \\frac{\\alpha}{2 \\gamma} \\left(\\frac{\\alpha}{1 \\cdot \\gamma} P_0\\right) = \\frac{1}{2!} \\left(\\frac{\\alpha}{\\gamma}\\right)^2 P_0 $$\n通过归纳法，其一般形式为：\n$$ P_n = \\frac{1}{n!} \\left(\\frac{\\alpha}{\\gamma}\\right)^n P_0 $$\n为求得 $P_0$，我们使用归一化条件 $\\sum_{n=0}^{\\infty} P_n = 1$：\n$$ \\sum_{n=0}^{\\infty} \\frac{1}{n!} \\left(\\frac{\\alpha}{\\gamma}\\right)^n P_0 = 1 $$\n$$ P_0 \\sum_{n=0}^{\\infty} \\frac{(\\alpha/\\gamma)^n}{n!} = 1 $$\n该和式是指数函数的泰勒级数，$\\sum_{k=0}^{\\infty} x^k/k! = \\exp(x)$。因此：\n$$ P_0 \\exp\\left(\\frac{\\alpha}{\\gamma}\\right) = 1 \\implies P_0 = \\exp\\left(-\\frac{\\alpha}{\\gamma}\\right) $$\n将此结果代回 $P_n$ 的表达式，我们得到精确的稳态分布：\n$$ P_n = \\frac{(\\alpha/\\gamma)^n}{n!} \\exp\\left(-\\frac{\\alpha}{\\gamma}\\right) $$\n这是一个参数为 $\\lambda = \\alpha/\\gamma$ 的泊松分布。\n\n对于参数为 $\\lambda$ 的泊松分布，其均值和方差均等于 $\\lambda$。我们从第一性原理证实这一点。\n均值为 $\\langle X \\rangle = \\sum_{n=0}^{\\infty} n P_n = \\lambda = \\alpha/\\gamma$。\n方差为 $\\mathrm{Var}[X] = \\langle X^2 \\rangle - \\langle X \\rangle^2$。我们计算二阶矩 $\\langle X^2 \\rangle$：\n$$ \\langle X^2 \\rangle = \\langle X(X-1) + X \\rangle = \\langle X(X-1) \\rangle + \\langle X \\rangle $$\n$$ \\langle X(X-1) \\rangle = \\sum_{n=0}^{\\infty} n(n-1) P_n = \\exp(-\\lambda) \\sum_{n=2}^{\\infty} n(n-1) \\frac{\\lambda^n}{n!} = \\exp(-\\lambda) \\sum_{n=2}^{\\infty} \\frac{\\lambda^n}{(n-2)!} $$\n令 $k=n-2$。则 $n=k+2$：\n$$ \\langle X(X-1) \\rangle = \\exp(-\\lambda) \\sum_{k=0}^{\\infty} \\frac{\\lambda^{k+2}}{k!} = \\lambda^2 \\exp(-\\lambda) \\sum_{k=0}^{\\infty} \\frac{\\lambda^k}{k!} = \\lambda^2 \\exp(-\\lambda) \\exp(\\lambda) = \\lambda^2 $$\n因此，$\\langle X^2 \\rangle = \\lambda^2 + \\lambda$。精确的稳态方差为：\n$$ \\mathrm{Var}[X] = (\\lambda^2 + \\lambda) - \\lambda^2 = \\lambda = \\frac{\\alpha}{\\gamma} $$\n\n**2. 从线性噪声近似推导稳态方差**\n\n线性噪声近似（LNA）将系统动力学在宏观、确定性轨迹周围线性化。我们从平均浓度 $\\phi(t)$ 的宏观速率方程开始：\n$$ \\frac{d\\phi}{dt} = \\alpha - \\gamma \\phi $$\n通过令 $\\frac{d\\phi}{dt} = 0$ 来找到稳态 $\\phi^{\\ast}$：\n$$ \\alpha - \\gamma \\phi^{\\ast} = 0 \\implies \\phi^{\\ast} = \\frac{\\alpha}{\\gamma} $$\nLNA描述了涨落变量 $\\epsilon(t) = X(t) - \\phi^{\\ast}$ 的动力学，其中 $X(t)$ 是随机分子数。$\\epsilon(t)$ 的演化由一个线性随机微分方程（一个Ornstein-Uhlenbeck过程）近似：\n$$ \\frac{d\\epsilon}{dt} = J \\epsilon + \\sqrt{D} \\xi(t) $$\n其中 $\\xi(t)$ 是高斯白噪声过程。矩阵 $J$ 是确定性速率函数的雅可比矩阵，而 $D$ 是扩散矩阵。\n对于这个单变量系统：\n确定性速率函数为 $F(\\phi) = \\alpha - \\gamma\\phi$。\n雅可比矩阵是一个标量 $J = \\frac{dF}{d\\phi}\\bigg|_{\\phi=\\phi^{\\ast}} = -\\gamma$。\n\n扩散矩阵 $D$ 由 $D = S \\cdot \\text{diag}(W(\\phi^{\\ast})) \\cdot S^T$ 给出，其中 $S$ 是化学计量矩阵，$W(\\phi^{\\ast})$ 是在稳态下计算的反应倾向向量。\n对于反应 $[\\varnothing \\to X, X \\to \\varnothing]$，化学计量矩阵为 $S = \\begin{pmatrix} 1  -1 \\end{pmatrix}$。\n倾向向量为 $W(\\phi) = \\begin{pmatrix} \\alpha \\\\ \\gamma\\phi \\end{pmatrix}$。\n在稳态 $\\phi^{\\ast} = \\alpha/\\gamma$ 下计算：\n$$ W(\\phi^{\\ast}) = \\begin{pmatrix} \\alpha \\\\ \\gamma(\\alpha/\\gamma) \\end{pmatrix} = \\begin{pmatrix} \\alpha \\\\ \\alpha \\end{pmatrix} $$\n在这种情况下，扩散项 $D$ 是一个标量：\n$$ D = \\begin{pmatrix} 1  -1 \\end{pmatrix} \\begin{pmatrix} \\alpha  0 \\\\ 0  \\alpha \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} \\alpha  -\\alpha \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = (1)(\\alpha)(1) + (-1)(\\alpha)(-1) = 2\\alpha $$\n涨落 $\\epsilon$ 的LNA方程为：\n$$ \\frac{d\\epsilon}{dt} = -\\gamma \\epsilon(t) + \\sqrt{2\\alpha} \\xi(t) $$\n涨落的方差 $\\Sigma = \\mathrm{Var}[\\epsilon] = \\langle \\epsilon^2 \\rangle$ 根据连续时间李雅普诺夫方程演化：\n$$ \\frac{d\\Sigma}{dt} = J\\Sigma + \\Sigma J^T + D $$\n在稳态下，$\\frac{d\\Sigma}{dt} = 0$，因此我们求解代数李雅普诺夫方程：\n$$ J\\Sigma + \\Sigma J^T + D = 0 $$\n代入标量值 $J=-\\gamma$, $\\Sigma = \\sigma^2_{\\epsilon}$ 和 $D=2\\alpha$：\n$$ (-\\gamma)\\sigma^2_{\\epsilon} + \\sigma^2_{\\epsilon}(-\\gamma) + 2\\alpha = 0 $$\n$$ -2\\gamma\\sigma^2_{\\epsilon} = -2\\alpha $$\n$$ \\sigma^2_{\\epsilon} = \\frac{\\alpha}{\\gamma} $$\nLNA预测的方差 $\\mathrm{Var}[X]_{\\text{LNA}}$ 即为 $\\sigma^2_{\\epsilon}$。\n$$ \\mathrm{Var}[X]_{\\text{LNA}} = \\frac{\\alpha}{\\gamma} $$\n在这个特殊情况下，LNA对稳态方差的计算结果与从CME推导出的精确结果完全相同。这是所有反应倾向至多是物种浓度的线性函数这类系统的一个特殊性质。\n\n**3. 线性噪声近似的局限性**\n\nLNA本质上是一种基于系统大小展开的近似方法，其基础是假设涨落相对于均值很小。它将系统动力学线性化，因此将涨落的稳态分布近似为高斯分布。在以下几种情况下，LNA会失效或产生定性上不正确的结果：\n-   **分子数低**：LNA是一种连续近似，它假设分子数量很大。当分子数很低时（例如，如果 $\\alpha/\\gamma \\ll 10$），化学物种的离散性变得至关重要。真实的分布（例如泊松分布）是离散且偏斜的，而LNA预测的是一个连续、对称的高斯分布。LNA还可能不符合物理实际地预测负分子数存在非零概率。\n-   **非线性反应动力学**：LNA将倾向函数线性化。如果系统包含非线性反应（例如，二聚化反应 $2X \\to Y$，其倾向与 $X(X-1)$ 成正比），这种线性化就是一种近似。这类非线性会导致真实概率分布中出现非高斯特征，如偏度或重尾，而LNA无法捕捉这些特征。\n-   **多峰性**：在能够产生双稳态或多稳态的系统中（例如，基因触发开关），确定性动力学具有多个稳定稳态。真实的稳态概率分布是多峰的，其峰值位于这些稳态附近。LNA是通过围绕单个确定性状态进行线性化来构建的。因此，它预测一个单峰高斯分布，并且在结构上无法描述状态空间的全局多峰性质或噪声诱导的稳态间跃迁。\n-   **接近分岔点**：在确定性模型的参数空间中，当接近一个分岔点时，雅可比矩阵 $J$ 的一个或多个特征值会趋近于零。动力学中的线性项变弱，而LNA忽略的高阶非线性项变得占主导地位。当特征值趋近于零时，LNA形式上会预测方差发散，这标志着该近似方法的失效。\n\n总而言之，尽管LNA对于线性生灭过程能够精确地复现前两个矩，但这只是一个特例。对于大多数合成生物回路而言——它们通常具有非线性反馈和关键调控因子的低拷贝数——LNA是一种有用但可能不准确的近似方法。",
            "answer": "$$ \\boxed{\\frac{\\alpha}{\\gamma}} $$"
        },
        {
            "introduction": "真实的生物网络很少是线性的；像二聚化这样的非线性相互作用非常普遍。这个问题聚焦于如何将LNA框架应用于这类非线性反应 。正确构建雅可比矩阵是LNA的基石，这个练习将提高你线性化非线性速率定律的能力，这是对复杂合成回路中的噪声进行建模的一项关键技能。",
            "id": "3936455",
            "problem": "考虑一个合成基因线路模块，其中转录因子 $X$ 通过反应 $2X \\to Y$ 同源二聚化形成复合物 $Y$。假设此单一反应的宏观速率定律为 $a(x) = k x^2$，其中 $x$ 表示 $X$ 的浓度，$k$ 是一个正速率常数。设物种排序为 $[X, Y]$，化学计量矩阵用 $S$ 表示，其单一列对应于此反应。在线性噪声近似 (LNA) 下，我们根据化学计量和反应速率构建确定性漂移，然后构建该漂移相对于状态的雅可比矩阵 $J$。\n\n对于该网络，哪个选项正确地指定了 $S$ 的单一反应列，并正确地描述了 $a(x)$ 中的非线性如何进入雅可比矩阵 $J$？\n\nA. $S$ 的列为 $\\begin{bmatrix} -2 \\\\ 1 \\end{bmatrix}$，雅可比矩阵通过 $a(x)$ 的导数而依赖于状态，得到 $J = \\begin{bmatrix} -4 k x  0 \\\\ 2 k x  0 \\end{bmatrix}$。\n\nB. $S$ 的列为 $\\begin{bmatrix} -1 \\\\ 1 \\end{bmatrix}$，雅可比矩阵为 $J = \\begin{bmatrix} -2 k x  0 \\\\ 2 k x  0 \\end{bmatrix}$。\n\nC. $S$ 的列为 $\\begin{bmatrix} -2 \\\\ 1 \\end{bmatrix}$，雅可比矩阵不依赖于状态，因为非线性没有进入 $J$，得到 $J = \\begin{bmatrix} -2 k  0 \\\\ k  0 \\end{bmatrix}$。\n\nD. $S$ 的列为 $\\begin{bmatrix} -2 \\\\ 1 \\end{bmatrix}$，雅可比矩阵的元素与 $a(x)$ 成正比，得到 $J = \\begin{bmatrix} -k x^2  0 \\\\ k x^2  0 \\end{bmatrix}$。\n\nE. $S$ 的列为 $\\begin{bmatrix} -2 \\\\ 1 \\end{bmatrix}$，雅可比矩阵为 $J = \\begin{bmatrix} -4 k  0 \\\\ 2 k  0 \\end{bmatrix}$，因为 $a(x)$ 相对于 $x$ 的导数是常数。",
            "solution": "用户要求对一个关于合成生物学建模背景下的线性噪声近似（LNA）问题进行精确分析。该过程从对问题陈述的正式验证开始。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n- **反应：** 转录因子 $X$ 通过反应 $2X \\to Y$ 同源二聚化形成复合物 $Y$。\n- **物种：** 物种为 $X$ 和 $Y$。\n- **状态向量排序：** 物种排序为 $[X, Y]$。\n- **宏观速率定律：** 单一反应的速率为 $a(x) = k x^2$，其中 $x$ 是物种 $X$ 的浓度，$k$ 是一个正常数速率常数。\n- **待求量：** 问题要求确定化学计量矩阵 $S$ 的单列和确定性漂移的雅可比矩阵 $J$，并描述 $a(x)$ 的非线性如何影响 $J$。\n\n**步骤2：使用提取的已知条件进行验证**\n对问题陈述进行严格的有效性检查。\n\n- **科学依据：** 该问题在科学上是合理的。它描述了一个标准的二聚化反应 $2X \\to Y$，这是生物化学和分子生物学中的一个基本过程。宏观速率定律 $a(x)=kx^2$ 与该二级反应的质量作用定律一致。化学计量矩阵、确定性漂移和雅可比矩阵的概念是化学动力学和系统生物学中使用的标准、明确定义的数学工具，特别是在推导线性噪声近似时。\n- **适定性：** 该问题是适定的。所提供的信息（反应方程、物种排序和速率定律）对于唯一确定化学计量矩阵列和雅可比矩阵是必要且充分的。\n- **客观性：** 该问题以精确、客观且无歧义的数学和科学术语陈述。\n\n**步骤3：结论与行动**\n问题陈述没有科学缺陷、歧义或矛盾。这是一个来自化学动力学和系统生物学领域的有效、适定的问题。因此，我将继续推导解答。\n\n### 解答推导\n\n解答需要确定给定系统的化学计量矩阵 $S$ 和雅可比矩阵 $J$。\n\n**1. 化学计量矩阵 ($S$)**\n\n系统的状态向量表示物种的浓度，按 $[X, Y]$ 排序。我们用 $\\mathbf{c} = \\begin{bmatrix} x \\\\ y \\end{bmatrix}$ 表示该向量。化学计量矩阵 $S$ 描述了每个反应中各物种的分子数（或在宏观视角下的浓度）的净变化。对于单一反应 $2X \\to Y$：\n- 物种 $X$ 的分子数减少 $2$。\n- 物种 $Y$ 的分子数增加 $1$。\n\n因此，构成化学计量矩阵 $S$ 单列的变化向量为：\n$$ S = \\begin{bmatrix} -2 \\\\ 1 \\end{bmatrix} $$\n\n**2. 确定性漂移和雅可比矩阵 ($J$)**\n\n线性噪声近似是在确定性（宏观）速率方程解周围的线性化。确定性漂移向量 $F(\\mathbf{c})$ 描述了浓度的变化率。它通过化学计量矩阵与反应速率向量的乘积计算得出。这里，只有一个反应，其速率为 $a(x) = kx^2$。\n\n$$ \\frac{d\\mathbf{c}}{dt} = F(\\mathbf{c}) = S \\cdot a(x) $$\n代入 $S$ 和 $a(x)$ 的表达式：\n$$ F(\\mathbf{c}) = \\begin{bmatrix} -2 \\\\ 1 \\end{bmatrix} (k x^2) = \\begin{bmatrix} -2 k x^2 \\\\ k x^2 \\end{bmatrix} $$\n漂移向量的两个分量是 $F_x(x,y) = -2 k x^2$ 和 $F_y(x,y) = k x^2$。\n\n雅可比矩阵 $J$ 是漂移向量 $F(\\mathbf{c})$ 关于状态变量 $x$ 和 $y$ 的所有一阶偏导数组成的矩阵。\n$$ J = \\frac{\\partial F}{\\partial \\mathbf{c}} = \\begin{bmatrix} \\frac{\\partial F_x}{\\partial x} & \\frac{\\partial F_x}{\\partial y} \\\\ \\frac{\\partial F_y}{\\partial x} & \\frac{\\partial F_y}{\\partial y} \\end{bmatrix} $$\n我们计算每个元素：\n- $\\frac{\\partial F_x}{\\partial x} = \\frac{\\partial}{\\partial x}(-2 k x^2) = -2k \\cdot (2x) = -4 k x$\n- $\\frac{\\partial F_x}{\\partial y} = \\frac{\\partial}{\\partial y}(-2 k x^2) = 0$\n- $\\frac{\\partial F_y}{\\partial x} = \\frac{\\partial}{\\partial x}(k x^2) = k \\cdot (2x) = 2 k x$\n- $\\frac{\\partial F_y}{\\partial y} = \\frac{\\partial}{\\partial y}(k x^2) = 0$\n\n将这些元素组合起来，得到雅可比矩阵：\n$$ J = \\begin{bmatrix} -4 k x & 0 \\\\ 2 k x & 0 \\end{bmatrix} $$\n\n雅可比矩阵 $J$ 的元素显然依赖于状态变量 $x$。这种状态依赖性是因为漂移 $F(\\mathbf{c})$ 是 $x$ 的非线性函数。具体来说，速率定律 $a(x) = k x^2$ 的非线性通过其导数 $\\frac{da}{dx} = 2kx$ 进入雅可比矩阵。雅可比矩阵可以更一般地表示为 $J = S \\frac{\\partial a}{\\partial \\mathbf{c}}$，在本例中即为 $J = \\begin{bmatrix} -2 \\\\ 1 \\end{bmatrix} \\begin{bmatrix} \\frac{da}{dx} & \\frac{da}{dy} \\end{bmatrix} = \\begin{bmatrix} -2 \\\\ 1 \\end{bmatrix} \\begin{bmatrix} 2kx & 0 \\end{bmatrix} = \\begin{bmatrix} -4kx & 0 \\\\ 2kx & 0 \\end{bmatrix}$。\n\n### 逐项分析\n\n**A. $S$ 的列为 $\\begin{bmatrix} -2 \\\\ 1 \\end{bmatrix}$，雅可比矩阵通过 $a(x)$ 的导数而依赖于状态，得到 $J = \\begin{bmatrix} -4 k x  0 \\\\ 2 k x  0 \\end{bmatrix}$。**\n- $S$ 的列被正确地确定为 $\\begin{bmatrix} -2 \\\\ 1 \\end{bmatrix}$。\n- 雅可比矩阵 $J$ 被正确地计算为 $\\begin{bmatrix} -4 k x & 0 \\\\ 2 k x & 0 \\end{bmatrix}$。\n- 描述是正确的：雅可比矩阵是状态依赖的，并且这种依赖性源于非线性速率函数 $a(x)$ 的导数。\n- **结论：正确。**\n\n**B. $S$ 的列为 $\\begin{bmatrix} -1 \\\\ 1 \\end{bmatrix}$，雅可比矩阵为 $J = \\begin{bmatrix} -2 k x  0 \\\\ 2 k x  0 \\end{bmatrix}$。**\n- $S$ 的列为 $\\begin{bmatrix} -1 \\\\ 1 \\end{bmatrix}$，这是不正确的。反应 $2X \\to Y$ 的化学计量要求物种 $X$ 的变化量为 $-2$。\n- **结论：不正确。**\n\n**C. $S$ 的列为 $\\begin{bmatrix} -2 \\\\ 1 \\end{bmatrix}$，雅可比矩阵不依赖于状态，因为非线性没有进入 $J$，得到 $J = \\begin{bmatrix} -2 k  0 \\\\ k  0 \\end{bmatrix}$。**\n- $S$ 的列是正确的。\n- 声称雅可比矩阵不依赖于状态是不正确的。根据推导，$J$ 依赖于 $x$。所给出的矩阵 $J = \\begin{bmatrix} -2 k  0 \\\\ k  0 \\end{bmatrix}$ 也是不正确的。这似乎是把速率定律误认为是一个线性函数，但它不是。\n- **结论：不正确。**\n\n**D. $S$ 的列为 $\\begin{bmatrix} -2 \\\\ 1 \\end{bmatrix}$，雅可比矩阵的元素与 $a(x)$ 成正比，得到 $J = \\begin{bmatrix} -k x^2  0 \\\\ k x^2  0 \\end{bmatrix}$。**\n- $S$ 的列是正确的。\n- 所提出的雅可比矩阵是不正确的。它与漂移向量 $F(\\mathbf{c})$ 成正比，而不是雅可比矩阵 $J$。雅可比矩阵涉及漂移的导数，而不是漂移本身。关于雅可比矩阵元素与 $a(x) = kx^2$ 成正比的说法是错误的；它们与其导数 $\\frac{da}{dx} = 2kx$ 成正比。\n- **结论：不正确。**\n\n**E. $S$ 的列为 $\\begin{bmatrix} -2 \\\\ 1 \\end{bmatrix}$，雅可比矩阵为 $J = \\begin{bmatrix} -4 k  0 \\\\ 2 k  0 \\end{bmatrix}$，因为 $a(x)$ 相对于 $x$ 的导数是常数。**\n- $S$ 的列是正确的。\n- 推理存在根本性缺陷。$a(x)=kx^2$ 的导数是 $\\frac{da}{dx}=2kx$，它是 $x$ 的函数，不是常数。因此，所提出的雅可比矩阵是不正确的，因为它假设了一个常数导数。\n- **结论：不正确。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "最后的这个实践从理论走向计算，指导你完成一个针对具有守恒定律的网络的完整LNA分析流程。这些守恒量，例如蛋白质的总量，在封闭的生物化学系统中很常见。处理守恒定律需要将系统动力学投影到一个降维空间上，这是有效应用LNA的关键一步 。通过实施这整个工作流程，你将把理论概念转化为一个实用的计算工具，为分析真实的生物模型做好准备。",
            "id": "3936475",
            "problem": "考虑一个在介观尺度上建模的充分混合化学反应网络，其中状态是分子数量向量 $x \\in \\mathbb{R}_{\\ge 0}^{n}$，动力学由化学计量矩阵为 $S \\in \\mathbb{R}^{n \\times m}$ 的反应产生。每个反应 $j$ 都有一个质量作用倾向函数 $a_j(x)$，其速率常数为 $k_j \\ge 0$，反应物化学计量指数收集在一个矩阵 $R \\in \\mathbb{R}_{\\ge 0}^{n \\times m}$ 中，其中 $R_{i j}$ 表示反应 $j$ 消耗的物种 $i$ 的分子数。确定性平均场动力学由 $f(x) = S a(x)$ 给出，其中 $a(x) = \\left(a_1(x), \\dots, a_m(x)\\right)^\\top$，并且与化学主方程及其系统尺寸展开相一致。在应用线性噪声近似（LNA）之前，必须通过将动力学投影到一个移除了守恒组合的降维空间来处理守恒定律。\n\n从化学主方程和质量作用动力学的基本原理出发，为每个提供的测试用例实现以下步骤：\n1. 给定 $S$，计算 $S^\\top$ 零空间的基，以识别物种的守恒线性组合。设 $C \\in \\mathbb{R}^{n \\times \\ell}$ 是一个矩阵，其列构成 $\\mathrm{Null}(S^\\top)$ 的一个标准正交基。守恒量满足 $C^\\top x = \\text{constant}$。\n2. 如果提供了目标守恒总量向量 $x_{\\text{goal}} \\in \\mathbb{R}^n$，则设 $b = C^\\top x_{\\text{goal}} \\in \\mathbb{R}^\\ell$ 并选择一个满足守恒约束的特定状态 $x_0 = C b$。为与 $C$ 的列正交的子空间（即 $C^\\top V = 0$）构建一个标准正交基 $V \\in \\mathbb{R}^{n \\times r}$，其中 $r = n - \\ell$。通过 $x = x_0 + V y$ 将状态参数化，其中 $y \\in \\mathbb{R}^r$ 是降维坐标。\n3. 在降维坐标中，通过求解 $V^\\top f(x_0 + V y) = 0$ 来找到关于 $y$ 的稳态。如果没有守恒定律（即 $\\ell = 0$），则直接求解 $f(x) = 0$ 来找到关于 $x$ 的稳态。\n4. 在稳态 $x^\\star$ 处，计算雅可比矩阵 $J = \\frac{\\partial f}{\\partial x}\\big|_{x^\\star}$ 和扩散矩阵 $D = S \\,\\mathrm{diag}\\big(a(x^\\star)\\big)\\, S^\\top$，这两者都由线性噪声近似（LNA）所基于的系统尺寸展开所隐含。将它们投影到降维坐标：$J_{\\text{red}} = V^\\top J V$ 和 $D_{\\text{red}} = V^\\top D V$。\n5. 从降维空间中由 LNA 隐含的连续时间李雅普诺夫方程求解降维坐标下的稳态协方差 $\\Sigma_y$，并重构物种空间协方差 $\\Sigma_x = V \\Sigma_y V^\\top$。如果 $r = 0$，根据定义设置 $\\Sigma_x = 0$。\n6. 为每个测试用例报告以下可量化的输出：\n   - 整数形式的守恒定律数量 $\\ell$。\n   - 在 $10^{-10}$ 容差下的 $\\Sigma_x$ 的整数形式数值秩。\n   - 浮点数形式的协方差中守恒性的最大绝对违背量，定义为 $\\max\\big|C^\\top \\Sigma_x\\big|$（如果 $\\ell = 0$ 则使用 $0.0$）。\n   - 浮点数形式的 $\\Sigma_x$ 的迹。\n   - 浮点数形式的稳态物种总和，$\\sum_i x_i^\\star$。\n\n您必须根据质量作用动力学的基本定义，一致地实现质量作用倾向函数 $a_j(x) = k_j \\prod_{i=1}^n x_i^{R_{i j}}$ 及其偏导数。所有计算都是无量纲的。\n\n您的程序必须处理以下测试套件，该套件旨在覆盖各种场景：\n\n- 测试用例 1（具有一个守恒定律的可逆转换）：\n  - 物种数 $n = 2$，反应数 $m = 2$。\n  - 化学计量矩阵 $S = \\begin{bmatrix} -1  1 \\\\ 1  -1 \\end{bmatrix}$。\n  - 反应物指数 $R = \\begin{bmatrix} 1  0 \\\\ 0  1 \\end{bmatrix}$。\n  - 速率常数 $k = \\begin{bmatrix} 3.0 \\\\ 1.0 \\end{bmatrix}$。\n  - 由 $x_{\\text{goal}} = \\begin{bmatrix} 100.0 \\\\ 0.0 \\end{bmatrix}$ 编码的目标守恒总量（这通过投影 $b = C^\\top x_{\\text{goal}}$ 强制执行 $x_1 + x_2 = 100.0$）。\n\n- 测试用例 2（生灭过程，无守恒定律）：\n  - 物种数 $n = 1$，反应数 $m = 2$。\n  - 化学计量矩阵 $S = \\begin{bmatrix} 1  -1 \\end{bmatrix}$。\n  - 反应物指数 $R = \\begin{bmatrix} 0  1 \\end{bmatrix}$。\n  - 速率常数 $k = \\begin{bmatrix} 20.0 \\\\ 0.5 \\end{bmatrix}$。\n  - 未提供 $x_{\\text{goal}}$。\n\n- 测试用例 3（具有两个守恒定律的两个独立可逆转换）：\n  - 物种数 $n = 4$，反应数 $m = 4$。\n  - 化学计量矩阵 $S = \\begin{bmatrix}\n      -1  1  0  0 \\\\\n      1  -1  0  0 \\\\\n      0  0  -1  1 \\\\\n      0  0  1  -1\n    \\end{bmatrix}$。\n  - 反应物指数 $R = \\begin{bmatrix}\n      1  0  0  0 \\\\\n      0  1  0  0 \\\\\n      0  0  1  0 \\\\\n      0  0  0  1\n    \\end{bmatrix}$。\n  - 速率常数 $k = \\begin{bmatrix} 2.0 \\\\ 1.0 \\\\ 4.0 \\\\ 1.0 \\end{bmatrix}$。\n  - 由 $x_{\\text{goal}} = \\begin{bmatrix} 50.0 \\\\ 0.0 \\\\ 20.0 \\\\ 0.0 \\end{bmatrix}$ 编码的目标守恒总量（这强制执行 $x_1 + x_2 = 50.0$ 和 $x_3 + x_4 = 20.0$）。\n\n- 测试用例 4（无反应，完全约束的状态）：\n  - 物种数 $n = 2$，反应数 $m = 0$。\n  - 化学计量矩阵 $S$ 是 $2 \\times 0$ 的空矩阵。\n  - 反应物指数 $R$ 是 $2 \\times 0$ 的空矩阵。\n  - 速率常数 $k$ 是空向量。\n  - 由 $x_{\\text{goal}} = \\begin{bmatrix} 3.0 \\\\ 7.0 \\end{bmatrix}$ 编码的目标守恒总量。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一个测试用例，并且本身是按上述顺序排列的五个值的列表（例如，$\\left[ [\\ell, \\mathrm{rank}, \\mathrm{viol}, \\mathrm{trace}, \\mathrm{sum}], \\dots \\right]$）。不应打印任何其他文本。",
            "solution": "化学主方程（CME）描述了充分混合反应系统中分子数量的随机时间演化。对于大系统尺寸，van Kampen 系统尺寸展开提供了一种有原则的近似方法，它将状态分解为确定性部分和随机涨落。确定性部分遵循平均场常微分方程 $d x / d t = f(x)$，其中 $f(x) = S a(x)$，$a(x)$ 收集了所有反应的倾向函数。在质量作用动力学下，反应 $j$ 的倾向函数为 $a_j(x) = k_j \\prod_{i=1}^n x_i^{R_{i j}}$，这与每个反应物根据其反应分子数乘法贡献的基本定义相一致。\n\n化学反应网络中的守恒定律源于在化学计量下保持不变的物种线性组合，即存在非零向量 $c \\in \\mathbbR^n$ 使得 $c^\\top S = 0^\\top$。所有此类 $c$ 的集合构成了 $S$ 的左零空间，等效于 $S^\\top$ 的零空间。设 $C \\in \\mathbb{R}^{n \\times \\ell}$ 是 $\\mathrm{Null}(S^\\top)$ 的一个标准正交基，其中 $\\ell$ 是独立守恒定律的数量。对于确定性动力学的任何轨迹 $x(t)$，$C^\\top x(t)$ 是一个常数，因为 $\\frac{d}{d t}\\left(C^\\top x\\right) = C^\\top \\frac{d x}{d t} = C^\\top S a(x) = 0$。\n\n为了正确应用线性噪声近似（LNA），必须在线性化之前移除这些守恒方向，否则确定性雅可比矩阵将是奇异的，协方差方程将是不适定的。这通过在满足守恒约束的仿射子空间内参数化状态来完成。如果提供了期望的守恒总量向量 $x_{\\text{goal}} \\in \\mathbb{R}^n$，则定义 $b = C^\\top x_{\\text{goal}} \\in \\mathbb{R}^\\ell$ 并选择 $C^\\top x = b$ 的任意一个特解 $x_0$。因为 $C$ 是标准正交的，一个最小范数的选择是 $x_0 = C b$。然后构建一个 $V \\in \\mathbb{R}^{n \\times r}$，作为与 $C$ 的列正交的子空间的标准正交基，其中 $r = n - \\ell$。这确保了 $C^\\top V = 0$，并且每个满足约束的状态都可以写成 $x = x_0 + V y$ 的形式，其中 $y \\in \\mathbb{R}^r$是一些降维坐标。\n\n在 $y$ 中的降维动力学通过投影完整向量场获得：定义 $g(y) = V^\\top f(x_0 + V y)$。降维坐标下的稳态满足 $g(y^\\star) = 0$，从而得到 $x^\\star = x_0 + V y^\\star$。如果没有守恒定律（即 $\\ell = 0$），则 $V$ 是单位矩阵，直接求解 $f(x^\\star) = 0$。\n\n线性噪声近似（LNA）从第一性原理出发，描述了围绕确定性稳态的涨落的协方差。具体来说，在系统尺寸展开下对 CME 进行线性化，会产生一个涨落 $\\eta$ 的高斯过程，其漂移由雅可比矩阵 $J = \\frac{\\partial f}{\\partial x}\\big|_{x^\\star}$ 给出，扩散与反应散粒噪声成正比，由 $D = S \\,\\mathrm{diag}\\big(a(x^\\star)\\big)\\, S^\\top$ 概括。$J$ 和 $D$ 都源自系统的基本属性：$f$ 捕捉了平均场流，而 $D$ 则编码了由每个通道中的泊松激发产生的内在反应噪声。在降维坐标中，漂移和扩散矩阵变为 $J_{\\text{red}} = V^\\top J V$ 和 $D_{\\text{red}} = V^\\top D V$。降维坐标下的稳态协方差 $\\Sigma_y$ 求解由线性高斯动力学隐含的连续时间李雅普诺夫方程：\n$$\nJ_{\\text{red}} \\Sigma_y + \\Sigma_y J_{\\text{red}}^\\top + D_{\\text{red}} = 0,\n$$\n当 $J_{\\text{red}}$ 是赫尔维茨矩阵（所有特征值都具有负实部）时，该方程有唯一的半正定解，这一点由 $x^\\star$ 附近降维确定性动力学的稳定性保证。物种空间协方差重构为\n$$\n\\Sigma_x = V \\Sigma_y V^\\top,\n$$\n它自动与守恒约束一致，因为 $\\Sigma_x$ 的支撑集仅在由 $V$ 张成的子空间内，并且 $C^\\top V = 0$ 意味着 $C^\\top \\Sigma_x = 0$。\n\n对于质量作用动力学，从第一性原理计算雅可比矩阵 $J$ 的过程是通过对倾向函数进行微分。向量场为 $f(x) = S a(x)$，因此雅可比矩阵为\n$$\nJ = \\frac{\\partial f}{\\partial x} = S \\frac{\\partial a}{\\partial x}.\n$$\n每个倾向函数分量的偏导数为\n$$\n\\frac{\\partial a_j}{\\partial x_i}(x) = \n\\begin{cases}\nk_j R_{i j} \\, x_i^{R_{i j} - 1} \\prod\\limits_{\\ell \\ne i} x_\\ell^{R_{\\ell j}},  \\text{if } R_{i j} > 0, \\\\\n0,  \\text{if } R_{i j} = 0,\n\\end{cases}\n$$\n这直接来自于对质量作用单项式 $k_j \\prod_{\\ell} x_\\ell^{R_{\\ell j}}$ 关于 $x_i$ 求导。\n\n因此，要实现的算法步骤如下：\n- 从 $S^\\top$ 的零空间计算 $C$ 并确定 $\\ell$。\n- 构建 $V$ 作为 $C$ 的列的正交补的标准正交基；如果 $\\ell = 0$，则将 $V$ 设置为单位矩阵。\n- 如果提供了 $x_{\\text{goal}}$，则计算 $b = C^\\top x_{\\text{goal}}$ 并设置 $x_0 = C b$；否则设置 $x_0 = 0$。\n- 使用鲁棒的非线性求解器求解 $V^\\top f(x_0 + V y) = 0$ 得到 $y^\\star$（或当 $\\ell = 0$ 时直接求解 $f(x^\\star) = 0$），然后设置 $x^\\star = x_0 + V y^\\star$。\n- 计算 $a(x^\\star)$、$\\frac{\\partial a}{\\partial x}(x^\\star)$、$J = S \\frac{\\partial a}{\\partial x}$ 和 $D = S \\,\\mathrm{diag}(a(x^\\star))\\, S^\\top$。\n- 投影到降维坐标并求解李雅普诺夫方程得到 $\\Sigma_y$，然后重构 $\\Sigma_x$。\n- 报告五个输出：$\\ell$、在 $10^{-10}$ 容差下的 $\\Sigma_x$ 的数值秩、$\\max |C^\\top \\Sigma_x|$（如果 $\\ell = 0$ 则为 $0.0$）、$\\mathrm{trace}(\\Sigma_x)$ 和 $\\sum_i x_i^\\star$。\n\n提供的测试套件考察了几个方面：\n- 一个具有一个守恒定律的可逆双物种系统，用于确认检测到 $\\ell = 1$、正确的投影以及非平凡的协方差秩等于降维维度。\n- 一个没有守恒定律的生灭过程，用于确认 $\\ell = 0$，投影简化为单位矩阵，并且李雅普诺夫方程可在全空间求解。\n- 具有两个守恒定律的两个独立可逆对，用于确认多约束处理和块结构投影。\n- 一个没有反应的系统，产生 $\\ell = n$ 和 $r = 0$，用于确认协方差是零矩阵，并且稳态恰好是受约束的 $x_0$。\n\n最终程序遵循这些步骤，并以指定的单行格式输出每个案例所要求的诊断信息。",
            "answer": "```python\nimport numpy as np\nfrom numpy.linalg import svd\nfrom scipy import linalg, optimize\n\ndef nullspace(A, rtol=1e-12):\n    \"\"\"\n    Compute an orthonormal basis for the nullspace of A using SVD.\n    Returns matrix whose columns span Null(A).\n    \"\"\"\n    # SVD of A\n    U, s, Vh = linalg.svd(A, full_matrices=True)\n    # Determine tolerance relative to largest singular value\n    tol = rtol * (s[0] if s.size > 0 else 1.0)\n    # Nullspace corresponds to singular values ~ 0; rows of Vh with s = tol\n    if s.size == 0:\n        # A has shape (0, n): full nullspace of R^n\n        # Vh is identity of size n\n        n = A.shape[1]\n        return np.eye(n)\n    rank = np.sum(s > tol)\n    # Vh is (k x n), where k = number of singular vectors = n if full_matrices\n    # Nullspace basis consists of rows of Vh corresponding to zero singular values\n    ns = Vh[rank:].conj().T\n    return ns\n\ndef mass_action_propensity(x, k, R):\n    \"\"\"\n    Compute mass-action propensities a_j(x) = k_j * prod_i x_i^{R_{i j}}.\n    \"\"\"\n    if R.size == 0:\n        return np.zeros((0,), dtype=float)\n    x = np.asarray(x, dtype=float)\n    k = np.asarray(k, dtype=float)\n    n, m = R.shape\n    a = np.zeros(m, dtype=float)\n    for j in range(m):\n        # product over species\n        prod = 1.0\n        for i in range(n):\n            exp = R[i, j]\n            if exp == 0:\n                continue\n            prod *= x[i] ** exp\n        a[j] = k[j] * prod\n    return a\n\ndef dpropensity_dx(x, k, R):\n    \"\"\"\n    Compute the Jacobian of propensities: G[j, i] = d a_j / d x_i.\n    For mass-action: if R_{i j} > 0:\n        d/dx_i ( k_j * prod_l x_l^{R_{l j}} ) = k_j * R_{i j} * x_i^{R_{i j} - 1} * prod_{l != i} x_l^{R_{l j}}\n    else:\n        0\n    Returns G of shape (m, n).\n    \"\"\"\n    if R.size == 0:\n        return np.zeros((0, len(x)), dtype=float)\n    x = np.asarray(x, dtype=float)\n    k = np.asarray(k, dtype=float)\n    n, m = R.shape\n    G = np.zeros((m, n), dtype=float)\n    # Precompute full monomials to speed up\n    # For each reaction j, compute prod_l x_l^{R_{l j}}\n    monomials = np.ones(m, dtype=float)\n    for j in range(m):\n        prod = 1.0\n        for i in range(n):\n            exp = R[i, j]\n            if exp == 0:\n                continue\n            prod *= x[i] ** exp\n        monomials[j] = prod\n    for j in range(m):\n        for i in range(n):\n            exp = R[i, j]\n            if exp > 0:\n                # Replace one factor x_i^{exp} with exp * x_i^{exp - 1}\n                if x[i] == 0 and exp - 1 < 0:\n                    # Avoid invalid derivative at zero with negative exponent; in mass-action,\n                    # this case corresponds to zero propensity and zero derivative.\n                    term = 0.0\n                else:\n                    # monomials[j] includes x_i^{exp}; divide out x_i^{exp} then multiply exp*x_i^{exp-1}\n                    base = monomials[j] / (x[i] ** exp if x[i] != 0 else (0.0 if exp > 0 else 1.0))\n                    term = k[j] * exp * (x[i] ** (exp - 1)) * base\n                G[j, i] = term\n            else:\n                G[j, i] = 0.0\n    return G\n\ndef steady_state_reduced(S, R, k, C, V, x0):\n    \"\"\"\n    Solve for steady state in reduced coordinates: find y such that V^T f(x0 + V y) = 0.\n    If V has zero columns (r = 0), return x = x0.\n    \"\"\"\n    n, m = S.shape\n    r = V.shape[1] if V.size > 0 else 0\n    if r == 0:\n        return x0.copy()\n    # Define reduced vector field\n    def g(y):\n        x = x0 + V @ y\n        a = mass_action_propensity(x, k, R)\n        f = S @ a\n        return V.T @ f\n    y0 = np.zeros(r, dtype=float)\n    sol = optimize.root(g, y0, method='hybr')\n    if not sol.success:\n        # Try another method\n        sol = optimize.root(g, y0, method='lm')\n    ystar = sol.x\n    xstar = x0 + V @ ystar\n    return xstar\n\ndef lna_covariance(S, R, k, xstar, V):\n    \"\"\"\n    Compute LNA steady-state covariance in species space:\n    J = S * d a / d x; D = S diag(a) S^T.\n    Project: J_red = V^T J V; D_red = V^T D V.\n    Solve Lyapunov: J_red Sigma_y + Sigma_y J_red^T + D_red = 0.\n    Reconstruct Sigma_x = V Sigma_y V^T.\n    \"\"\"\n    n, m = S.shape\n    r = V.shape[1] if V.size > 0 else 0\n    if r == 0:\n        return np.zeros((n, n), dtype=float)\n    a = mass_action_propensity(xstar, k, R)\n    G = dpropensity_dx(xstar, k, R)  # shape (m, n)\n    J = S @ G  # shape (n, n)\n    D = S @ np.diag(a) @ S.T  # shape (n, n)\n    J_red = V.T @ J @ V\n    D_red = V.T @ D @ V\n    # Solve continuous Lyapunov: A X + X A^T + Q = 0 -> X = solve_continuous_lyapunov(A, -Q)\n    Sigma_y = linalg.solve_continuous_lyapunov(J_red, -D_red)\n    Sigma_x = V @ Sigma_y @ V.T\n    return Sigma_x\n\ndef numerical_rank(M, tol=1e-10):\n    \"\"\"\n    Numerical rank based on SVD with tolerance relative to maximum singular value.\n    \"\"\"\n    if M.size == 0:\n        return 0\n    s = svd(M, compute_uv=False)\n    smax = s.max() if s.size > 0 else 0.0\n    thr = tol * (smax if smax > 0 else 1.0)\n    return int(np.sum(s > thr))\n\ndef solve():\n    # Define test cases as tuples: (S, R, k, x_goal)\n    # Case 1: reversible A -> B with one conservation law\n    S1 = np.array([[-1.0, 1.0],\n                   [ 1.0,-1.0]], dtype=float)\n    R1 = np.array([[1.0, 0.0],\n                   [0.0, 1.0]], dtype=float)\n    k1 = np.array([3.0, 1.0], dtype=float)\n    x_goal1 = np.array([100.0, 0.0], dtype=float)\n\n    # Case 2: birth-death, no conservation law\n    S2 = np.array([[1.0, -1.0]], dtype=float)  # n=1, m=2\n    R2 = np.array([[0.0, 1.0]], dtype=float)\n    k2 = np.array([20.0, 0.5], dtype=float)\n    x_goal2 = None\n\n    # Case 3: two independent reversible pairs with two conservation laws\n    S3 = np.array([[-1.0,  1.0,  0.0,  0.0],\n                   [ 1.0, -1.0,  0.0,  0.0],\n                   [ 0.0,  0.0, -1.0,  1.0],\n                   [ 0.0,  0.0,  1.0, -1.0]], dtype=float)\n    R3 = np.array([[1.0, 0.0, 0.0, 0.0],\n                   [0.0, 1.0, 0.0, 0.0],\n                   [0.0, 0.0, 1.0, 0.0],\n                   [0.0, 0.0, 0.0, 1.0]], dtype=float)\n    k3 = np.array([2.0, 1.0, 4.0, 1.0], dtype=float)\n    x_goal3 = np.array([50.0, 0.0, 20.0, 0.0], dtype=float)\n\n    # Case 4: no reactions, fully constrained\n    S4 = np.zeros((2, 0), dtype=float)\n    R4 = np.zeros((2, 0), dtype=float)\n    k4 = np.zeros((0,), dtype=float)\n    x_goal4 = np.array([3.0, 7.0], dtype=float)\n\n    test_cases = [\n        (S1, R1, k1, x_goal1),\n        (S2, R2, k2, x_goal2),\n        (S3, R3, k3, x_goal3),\n        (S4, R4, k4, x_goal4),\n    ]\n\n    results = []\n    for (S, R, k, x_goal) in test_cases:\n        n, m = S.shape\n        # Compute conservation basis C as Null(S^T)\n        C = nullspace(S.T, rtol=1e-12)\n        ell = C.shape[1]\n        # Compute V as Null(C^T) if ell > 0, else identity\n        if ell > 0:\n            V = nullspace(C.T, rtol=1e-12)\n        else:\n            V = np.eye(n)\n\n        # Particular solution x0 satisfying constraints\n        if ell > 0:\n            if x_goal is None:\n                # If constraints exist but no goal provided, set b = 0 (default totals)\n                b = np.zeros(ell, dtype=float)\n            else:\n                b = C.T @ x_goal\n            x0 = C @ b\n        else:\n            x0 = np.zeros(n, dtype=float)\n\n        # Steady state in reduced coordinates\n        xstar = steady_state_reduced(S, R, k, C, V, x0)\n\n        # LNA covariance\n        Sigma_x = lna_covariance(S, R, k, xstar, V)\n\n        # Numerical rank\n        rank_cov = numerical_rank(Sigma_x, tol=1e-10)\n\n        # Conservation violation in covariance\n        if ell > 0:\n            viol = np.max(np.abs(C.T @ Sigma_x))\n        else:\n            viol = 0.0\n\n        # Trace of covariance\n        trace_cov = float(np.trace(Sigma_x))\n\n        # Sum of steady-state species\n        sum_x = float(np.sum(xstar))\n\n        results.append([int(ell), int(rank_cov), float(viol), float(trace_cov), float(sum_x)])\n\n    # Final output: single line with list of per-case results\n    print(str(results))\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}