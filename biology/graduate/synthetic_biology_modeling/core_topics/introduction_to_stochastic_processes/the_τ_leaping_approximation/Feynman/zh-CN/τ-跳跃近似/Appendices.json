{
    "hands_on_practices": [
        {
            "introduction": "在模拟完整的随机轨迹之前，理解单个τ跳跃的统计特性至关重要。此练习将引导您从τ跳跃的核心假设出发，推导物种种群数量变化的基本均值和方差，为整个τ跳跃方法奠定坚实的统计学基石。通过这项练习，您将深入理解在每个时间步长$τ$内，系统状态的随机演化是如何被数学描述的 。",
            "id": "3938145",
            "problem": "考虑一个具有 $M$ 个反应通道的合成生物学反应网络，其索引为 $i \\in \\{1,\\dots,M\\}$。令 $x \\in \\mathbb{N}^{S}$ 表示在时间 $t$ 的当前分子数量状态，并令 $x_s$ 表示某个固定物种 $s \\in \\{1,\\dots,S\\}$ 的数量。每个反应 $i$ 都有一个倾向（风险）函数 $a_i(x)$ 和一个化学计量变化向量 $\\nu_i \\in \\mathbb{Z}^{S}$，其中条目 $\\nu_{si} \\in \\mathbb{Z}$ 表示当反应 $i$ 发生一次时，物种 $s$ 所产生的净变化。假设在化学主方程 (CME) 框架和 $\\tau$-跳跃近似下：对于一个长度为 $\\tau  0$ 的跳跃区间，如果该区间足够小，以至于所有 $a_i(x)$ 在 $[t, t+\\tau]$ 上都近似保持恒定，那么在 $[t, t+\\tau]$ 期间每个反应 $i$ 的发生次数 $K_i$ 可以被建模为参数为 $a_i(x)\\,\\tau$ 的独立泊松随机变量。\n\n定义物种 $s$ 在该跳跃内的数量净变化为 $\\Delta x_s := \\sum_{i=1}^{M} \\nu_{si}\\,K_i$，因此 $x_s(t+\\tau) = x_s(t) + \\Delta x_s$。仅从 CME 的短时行为和 $\\tau$-跳跃近似出发，通过推导其特征函数 $\\phi_s(\\theta) = \\mathbb{E}\\!\\left[\\exp\\!\\left(i\\,\\theta\\,\\Delta x_s\\right)\\middle|x\\right]$ 的一个闭式表达式来计算 $\\Delta x_s$ 的分布，然后推导出均值 $\\mathbb{E}[\\Delta x_s\\,|\\,x]$ 和方差 $\\operatorname{Var}[\\Delta x_s\\,|\\,x]$，用 $\\{\\nu_{si}\\}_{i=1}^{M}$、$\\{a_i(x)\\}_{i=1}^{M}$ 和 $\\tau$ 来表示。将您的最终答案表示为一个单一的解析表达式，该表达式以行矩阵的形式，依次包含 $\\Delta x_s$ 的特征函数、其均值和其方差。不需要进行数值计算或四舍五入。",
            "solution": "问题陈述已经过验证，被认为是有效的。它具有科学依据，问题提出得当且内容自洽，代表了随机化学动力学领域的一个标准推导。我们现在可以开始求解。\n\n目标是在 $\\tau$-跳跃近似下，找到物种数量净变化 $\\Delta x_s$ 在单个时间步长 $\\tau$ 内的特征函数、均值和方差。物种 $s$ 的净变化定义为每个反应通道 $i$ 的反应发生次数 $K_i$ 的加权和：\n$$\n\\Delta x_s = \\sum_{i=1}^{M} \\nu_{si}\\,K_i\n$$\n其中 $\\nu_{si}$ 是反应 $i$ 引起的物种 $s$ 的化学计量变化，而 $M$ 是反应通道的总数。\n\n根据 $\\tau$-跳跃近似，对于一个足够小的时间步长 $\\tau$，当倾向函数 $a_i(x)$ 近似为常数时，每个反应 $i \\in \\{1,\\dots,M\\}$ 的发生次数 $K_i$ 是一个独立的泊松随机变量，其参数为 $\\lambda_i = a_i(x)\\,\\tau$。也就是说，对于所有的 $i$，$K_i \\sim \\text{Poisson}(a_i(x)\\,\\tau)$，并且随机变量集合 $\\{K_1, K_2, \\dots, K_M\\}$ 是相互独立的。所有的期望都以时间 $t$ 的状态 $x$ 为条件。\n\n**1. 特征函数 $\\phi_s(\\theta)$ 的推导**\n\n随机变量 $\\Delta x_s$ 的特征函数定义为 $\\phi_s(\\theta) = \\mathbb{E}[\\exp(i\\,\\theta\\,\\Delta x_s)|x]$。代入 $\\Delta x_s$ 的表达式：\n$$\n\\phi_s(\\theta) = \\mathbb{E}\\left[\\exp\\left(i\\,\\theta\\,\\sum_{j=1}^{M} \\nu_{sj}\\,K_j\\right)\\middle|x\\right]\n$$\n使用性质 $\\exp(\\sum_j A_j) = \\prod_j \\exp(A_j)$，我们可以将表达式重写为：\n$$\n\\phi_s(\\theta) = \\mathbb{E}\\left[\\prod_{j=1}^{M} \\exp(i\\,\\theta\\,\\nu_{sj}\\,K_j)\\middle|x\\right]\n$$\n$\\tau$-跳跃法的一个关键假设是随机变量 $K_j$ 是独立的。独立随机变量乘积的期望等于它们各自期望的乘积。因此：\n$$\n\\phi_s(\\theta) = \\prod_{j=1}^{M} \\mathbb{E}\\left[\\exp(i\\,\\theta\\,\\nu_{sj}\\,K_j)\\middle|x\\right]\n$$\n每一项 $\\mathbb{E}[\\exp(i\\,\\theta\\,\\nu_{sj}\\,K_j)|x]$ 是缩放后的随机变量 $\\nu_{sj}K_j$ 的特征函数。令 $\\phi_{K_j}(u) = \\mathbb{E}[\\exp(i\\,u\\,K_j)|x]$ 为 $K_j$ 的特征函数。那么 $\\mathbb{E}[\\exp(i\\,(\\theta\\nu_{sj})\\,K_j)|x] = \\phi_{K_j}(\\theta\\nu_{sj})$。\n\n对于一个泊松随机变量 $K \\sim \\text{Poisson}(\\lambda)$，其特征函数为 $\\phi_K(u) = \\exp(\\lambda(\\exp(i\\,u) - 1))$。在我们的情况中，$K_j \\sim \\text{Poisson}(a_j(x)\\tau)$，所以 $\\lambda_j = a_j(x)\\tau$。$K_j$ 的特征函数为：\n$$\n\\phi_{K_j}(u) = \\exp\\left(a_j(x)\\tau(\\exp(i\\,u)-1)\\right)\n$$\n在 $u = \\theta\\nu_{sj}$ 处求值，我们得到：\n$$\n\\mathbb{E}\\left[\\exp(i\\,\\theta\\,\\nu_{sj}\\,K_j)\\middle|x\\right] = \\phi_{K_j}(\\theta\\nu_{sj}) = \\exp\\left(a_j(x)\\tau(\\exp(i\\,\\theta\\,\\nu_{sj})-1)\\right)\n$$\n将此代回 $\\phi_s(\\theta)$ 的乘积中：\n$$\n\\phi_s(\\theta) = \\prod_{j=1}^{M} \\exp\\left(a_j(x)\\tau(\\exp(i\\,\\theta\\,\\nu_{sj})-1)\\right)\n$$\n最后，使用性质 $\\prod_j \\exp(A_j) = \\exp(\\sum_j A_j)$，我们得到特征函数的闭式表达式：\n$$\n\\phi_s(\\theta) = \\exp\\left(\\sum_{j=1}^{M} a_j(x)\\tau(\\exp(i\\,\\theta\\,\\nu_{sj})-1)\\right) = \\exp\\left(\\tau\\sum_{j=1}^{M} a_j(x)\\left(\\exp(i\\,\\theta\\,\\nu_{sj})-1\\right)\\right)\n$$\n为与问题陈述的索引保持一致，我们使用 $i$：\n$$\n\\phi_s(\\theta) = \\exp\\left(\\tau \\sum_{i=1}^{M} a_i(x)(\\exp(i\\,\\theta\\,\\nu_{si})-1)\\right)\n$$\n\n**2. 均值和方差的推导**\n\n$\\Delta x_s$ 的均值和方差可以从其特征函数推导出来。一个更直接的方法是使用累积量生成函数 $C_s(\\theta) = \\ln(\\phi_s(\\theta))$。第 $n$ 阶累积量 $\\kappa_n$ 由 $\\kappa_n = (i^{-n}) \\frac{d^nC_s(\\theta)}{d\\theta^n}\\big|_{\\theta=0}$ 给出。第一阶累积量 $\\kappa_1$ 是均值，第二阶累积量 $\\kappa_2$ 是方差。\n\n$\\Delta x_s$ 的累积量生成函数为：\n$$\nC_s(\\theta) = \\ln(\\phi_s(\\theta)) = \\tau \\sum_{i=1}^{M} a_i(x)(\\exp(i\\,\\theta\\,\\nu_{si})-1)\n$$\n\n**均值 $\\mathbb{E}[\\Delta x_s|x]$：**\n均值是第一阶累积量 $\\kappa_1$。我们计算 $C_s(\\theta)$ 相对于 $\\theta$ 的一阶导数：\n$$\n\\frac{dC_s(\\theta)}{d\\theta} = \\frac{d}{d\\theta}\\left[\\tau \\sum_{i=1}^{M} a_i(x)(\\exp(i\\,\\theta\\,\\nu_{si})-1)\\right] = \\tau \\sum_{i=1}^{M} a_i(x)(i\\,\\nu_{si}\\,\\exp(i\\,\\theta\\,\\nu_{si}))\n$$\n在 $\\theta=0$ 处求值：\n$$\n\\frac{dC_s(\\theta)}{d\\theta}\\bigg|_{\\theta=0} = \\tau \\sum_{i=1}^{M} a_i(x)(i\\,\\nu_{si}\\,\\exp(0)) = i\\,\\tau \\sum_{i=1}^{M} a_i(x)\\nu_{si}\n$$\n那么均值为：\n$$\n\\mathbb{E}[\\Delta x_s|x] = \\kappa_1 = \\frac{1}{i} \\left(\\frac{dC_s(\\theta)}{d\\theta}\\bigg|_{\\theta=0}\\right) = \\frac{1}{i} \\left(i\\,\\tau \\sum_{i=1}^{M} a_i(x)\\nu_{si}\\right) = \\tau \\sum_{i=1}^{M} a_i(x)\\nu_{si}\n$$\n\n**方差 $\\operatorname{Var}[\\Delta x_s|x]$：**\n方差是第二阶累积量 $\\kappa_2$。我们计算 $C_s(\\theta)$ 的二阶导数：\n$$\n\\frac{d^2C_s(\\theta)}{d\\theta^2} = \\frac{d}{d\\theta}\\left[i\\,\\tau \\sum_{i=1}^{M} a_i(x)\\nu_{si}\\,\\exp(i\\,\\theta\\,\\nu_{si})\\right] = i\\,\\tau \\sum_{i=1}^{M} a_i(x)\\nu_{si}\\,(i\\,\\nu_{si}\\,\\exp(i\\,\\theta\\,\\nu_{si}))\n$$\n$$\n\\frac{d^2C_s(\\theta)}{d\\theta^2} = i^2\\,\\tau \\sum_{i=1}^{M} a_i(x)\\nu_{si}^2\\,\\exp(i\\,\\theta\\,\\nu_{si}) = -\\tau \\sum_{i=1}^{M} a_i(x)\\nu_{si}^2\\,\\exp(i\\,\\theta\\,\\nu_{si})\n$$\n在 $\\theta=0$ 处求值：\n$$\n\\frac{d^2C_s(\\theta)}{d\\theta^2}\\bigg|_{\\theta=0} = -\\tau \\sum_{i=1}^{M} a_i(x)\\nu_{si}^2\\,\\exp(0) = -\\tau \\sum_{i=1}^{M} a_i(x)\\nu_{si}^2\n$$\n那么方差为：\n$$\n\\operatorname{Var}[\\Delta x_s|x] = \\kappa_2 = \\frac{1}{i^2} \\left(\\frac{d^2C_s(\\theta)}{d\\theta^2}\\bigg|_{\\theta=0}\\right) = -1 \\left(-\\tau \\sum_{i=1}^{M} a_i(x)\\nu_{si}^2\\right) = \\tau \\sum_{i=1}^{M} a_i(x)\\nu_{si}^2\n$$\n\n这些结果与使用期望和方差的线性性质的推导一致。具体来说，$\\mathbb{E}[\\Delta x_s|x] = \\sum_i \\nu_{si}\\mathbb{E}[K_i|x] = \\sum_i \\nu_{si}(a_i(x)\\tau)$，并且由于独立性，$\\operatorname{Var}[\\Delta x_s|x] = \\sum_i \\operatorname{Var}[\\nu_{si}K_i|x] = \\sum_i \\nu_{si}^2\\operatorname{Var}[K_i|x] = \\sum_i \\nu_{si}^2(a_i(x)\\tau)$。\n\n所需的三个表达式是：\n1. 特征函数：$\\phi_s(\\theta) = \\exp\\left(\\tau \\sum_{i=1}^{M} a_i(x)(\\exp(i\\,\\theta\\,\\nu_{si})-1)\\right)$\n2. 均值：$\\mathbb{E}[\\Delta x_s|x] = \\tau \\sum_{i=1}^{M} a_i(x)\\nu_{si}$\n3. 方差：$\\operatorname{Var}[\\Delta x_s|x] = \\tau \\sum_{i=1}^{M} a_i(x)\\nu_{si}^2$\n我们现在将以要求的最终格式呈现这些内容。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\exp\\left(\\tau\\sum_{i=1}^{M} a_i(x)(\\exp(i\\,\\theta\\,\\nu_{si})-1)\\right)  \\tau\\sum_{i=1}^{M} a_i(x)\\nu_{si}  \\tau\\sum_{i=1}^{M} a_i(x)\\nu_{si}^{2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "τ跳跃近似的准确性关键取决于时间步长$τ$的大小，一个过大的$τ$会违背倾向性函数近似恒定的核心假设。这项练习提供了一个具体的例子，展示如何通过对倾向性函数相对变化的限制来推导$τ$的表达式，这是自适应τ跳跃算法中的一项关键技术。这项推导将帮助您理解如何在保证模拟精度的前提下，动态地选择最优的时间步长 。",
            "id": "3938166",
            "problem": "在一个合成生物学回路的单基因表达模型中，蛋白质种类 $X$ 的分子数作为一个连续时间、离散状态的马尔可夫过程演化，该过程由化学主方程（CME）下的两个反应通道控制：一个零级合成反应，其倾向函数为 $a_{1}(x)=c_{s}$，化学计量数为 $\\nu_{1}=+1$；以及一个一级降解反应，其倾向函数为 $a_{2}(x)=c_{d}\\,x$，化学计量数为 $\\nu_{2}=-1$。其中，$x$ 是当前分子数，$c_{s}0$ 是合成速率常数，$c_{d}0$ 是降解速率常数。假设时间单位为分钟，则 $c_{s}$ 的单位为分子/分钟，$c_{d}$ 的单位为/分钟，$x$ 的单位为分子。\n\n使用 $\\tau$-跳跃近似，施加跳跃条件，即在一个时长为 $\\tau$ 的跳跃内，每个倾向函数的相对变化的绝对值受一个小的参数 $\\epsilon$ 限制。为此，通过在当前状态下进行一阶泰勒展开来线性化倾向向量，并将状态增量替换为该跳跃下的期望值。使用关于 $x$ 的雅可比矩阵来形式化此界限。取 $\\epsilon=0.03$。\n\n仅根据这些原理，推导在当前状态 $x$ 下，基于雅可比矩阵的界限所允许的最大 $\\tau$ 的闭式表达式。将最终结果表示为关于 $c_{s}$、$c_{d}$ 和 $x$ 的简化符号函数，并代入 $\\epsilon$ 的数值。以分钟为单位表示 $\\tau$，但最终的方框答案中不要包含单位。如果出现任何特殊情况，请在推导中明确说明，但最终答案需提供一个单一的闭式表达式。",
            "solution": "用户提供了一个问题陈述，在尝试解答之前需要进行验证。\n\n### 步骤1：提取已知条件\n-   **系统**：一个针对蛋白质种类 $X$ 的单基因表达模型。\n-   **动力学**：作为一个连续时间、离散状态的马尔可夫过程，受化学主方程 (CME) 控制。\n-   **反应1（合成）**：零级反应，倾向函数 $a_{1}(x)=c_{s}$，化学计量数 $\\nu_{1}=+1$。\n-   **反应2（降解）**：一级反应，倾向函数 $a_{2}(x)=c_{d}\\,x$，化学计量数 $\\nu_{2}=-1$。\n-   **变量与常数**：\n    -   $x$：种类 $X$ 的当前分子数。\n    -   $c_{s}$：合成速率常数，$c_{s}  0$。\n    -   $c_{d}$：降解速率常数，$c_{d}  0$。\n-   **假设与方法**：\n    -   模拟使用 $\\tau$-跳跃近似。\n    -   跳跃时长 $\\tau$ 受跳跃条件约束：每个倾向函数大小的相对变化量受 $\\epsilon$ 限制。\n    -   **约束公式**：$|a_j(x(t+\\tau)) - a_j(x(t))| / a_j(x(t)) \\le \\epsilon$。\n    -   **线性化**：倾向函数的变化量 $a_j(x(t+\\tau)) - a_j(x(t))$，使用在当前状态 $x(t)$ 下的一阶泰勒展开进行近似。\n    -   **状态增量近似**：泰勒展开中的状态增量 $\\Delta x$ 被替换为在跳跃 $\\tau$ 期间的期望值 $E[\\Delta x]$。\n    -   **雅可比矩阵**：关于 $x$ 的倾向向量的雅可比矩阵被用来形式化线性化界限。\n-   **参数值**：$\\epsilon = 0.03$。\n-   **目标**：推导允许的最大 $\\tau$ 作为 $c_{s}$、$c_{d}$ 和 $x$ 的函数的闭式表达式。\n\n### 步骤2：使用提取的已知条件进行验证\n1.  **科学基础**：该问题描述了一个经典的生灭过程，这是随机化学动力学和系统生物学中的一个基本模型。$\\tau$-跳跃算法是一种标准的、科学上已确立的方法，用于近似此类系统的随机模拟算法 (SSA)。所描述的基于限制倾向函数相对变化的时间步长选择准则是一种已知且有效的技术。该问题牢固地植根于计算生物学和应用数学的原理。\n2.  **适定性**：该问题清晰地定义了模型、模拟方法、要使用的特定时间步长选择规则变体以及期望的输出。所有必要的参数和关系都已提供。这种结构允许推导出唯一的解析表达式。\n3.  **客观性**：该问题以精确的数学术语陈述，没有任何主观或模糊的语言。\n\n问题陈述是自洽的、科学上合理的，并且在数学上是适定的。没有矛盾、关键信息缺失或伪科学的主张。\n\n### 步骤3：结论与行动\n该问题是**有效的**。将提供详细的解决方案。\n\n### $\\tau$-跳跃时间步长的推导\n\n该系统由单一物种 $X$ 组成，其分子数为 $x$。系统的状态是标量 $x$。存在两个反应通道，其倾向函数为：\n1.  合成：$a_{1}(x) = c_{s}$，化学计量数为 $\\nu_{1} = +1$。\n2.  降解：$a_{2}(x) = c_{d}x$，化学计量数为 $\\nu_{2} = -1$。\n\n问题陈述指出，必须选择时间步长 $\\tau$，以使每个倾向函数的相对变化受一个小的参数 $\\epsilon$ 限制。对于每个反应 $j \\in \\{1, 2\\}$，此条件为：\n$$\n\\frac{| a_{j}(x(t+\\tau)) - a_{j}(x(t)) |}{a_{j}(x(t))} \\le \\epsilon\n$$\n其中 $x(t)$ 是跳跃开始时的状态。我们将 $x(t)$ 记为 $x$。跳跃结束时的状态是 $x(t+\\tau) = x + \\Delta x$，其中 $\\Delta x$ 是在时间间隔 $\\tau$ 内分子数的变化量。\n\n问题要求使用关于状态 $x$ 的一阶泰勒展开来线性化倾向函数的变化量 $a_{j}(x + \\Delta x) - a_{j}(x)$：\n$$\na_{j}(x + \\Delta x) - a_{j}(x) \\approx \\frac{\\partial a_{j}(x)}{\\partial x} \\Delta x\n$$\n倾向函数关于 $x$ 的偏导数构成了倾向向量的雅可比矩阵。对于我们的系统：\n$$\n\\frac{\\partial a_{1}(x)}{\\partial x} = \\frac{\\partial}{\\partial x}(c_{s}) = 0\n$$\n$$\n\\frac{\\partial a_{2}(x)}{\\partial x} = \\frac{\\partial}{\\partial x}(c_{d}x) = c_{d}\n$$\n接下来，问题要求将随机状态增量 $\\Delta x$ 替换为其期望值 $E[\\Delta x]$。在 $\\tau$-跳跃框架中，反应 $j$ 在 $[t, t+\\tau]$ 内发生的次数是一个泊松随机变量 $K_j \\sim \\text{Poisson}(a_j(x)\\tau)$。其期望值为 $E[K_j] = a_j(x)\\tau$。$x$ 的总期望变化量是每个反应的期望变化量之和：\n$$\nE[\\Delta x] = \\sum_{j=1}^{2} \\nu_{j} E[K_{j}] = \\sum_{j=1}^{2} \\nu_{j} a_{j}(x) \\tau\n$$\n代入给定值：\n$$\nE[\\Delta x] = (\\nu_{1}a_{1}(x) + \\nu_{2}a_{2}(x))\\tau = ((+1)c_{s} + (-1)c_{d}x)\\tau = (c_{s} - c_{d}x)\\tau\n$$\n现在我们将线性化的倾向函数变化量（其中 $\\Delta x$ 已被 $E[\\Delta x]$ 替换）代回跳跃条件不等式：\n$$\n\\frac{|\\frac{\\partial a_{j}(x)}{\\partial x} E[\\Delta x]|}{a_{j}(x)} \\le \\epsilon\n$$\n$$\n\\frac{|\\frac{\\partial a_{j}(x)}{\\partial x} (c_{s} - c_{d}x)\\tau|}{a_{j}(x)} \\le \\epsilon\n$$\n我们必须对两个反应都满足此条件，以找到对整个系统都有效的单个最大 $\\tau$。\n\n**对于反应 1 ($j=1$):**\n$$\n\\frac{|0 \\cdot (c_{s} - c_{d}x)\\tau|}{c_{s}} \\le \\epsilon \\implies \\frac{0}{c_{s}} \\le \\epsilon \\implies 0 \\le \\epsilon\n$$\n由于 $\\epsilon = 0.03  0$，此条件始终满足，并且不对 $\\tau$ 施加上限。\n\n**对于反应 2 ($j=2$):**\n$$\n\\frac{|c_{d} \\cdot (c_{s} - c_{d}x)\\tau|}{c_{d}x} \\le \\epsilon\n$$\n由于 $c_{d}  0$ 且我们考虑 $x \\ge 0$，我们可以简化此表达式。对于 $x  0$：\n$$\n\\frac{c_{d} |(c_{s} - c_{d}x)\\tau|}{c_{d}x} \\le \\epsilon\n$$\n$$\n\\frac{|c_{s} - c_{d}x| \\tau}{x} \\le \\epsilon\n$$\n由于 $\\tau$ 必须为非负数，并且我们正在寻找可能的最大 $\\tau$，我们求解 $\\tau$：\n$$\n\\tau \\le \\frac{\\epsilon x}{|c_{s} - c_{d}x|}\n$$\n总时间步长 $\\tau$ 必须满足最严格的约束，在本例中该约束仅由反应 2 提供。因此，在此特定准则下，$\\tau$ 的最大允许值为：\n$$\n\\tau = \\frac{\\epsilon x}{|c_{s} - c_{d}x|}\n$$\n我们现在分析此表达式的特殊情况。\n-   **情况 1: $x = 0$**。倾向函数 $a_{2}(0)=0$，因此相对变化在形式上是未定义的。然而，我们推导的公式给出 $\\tau = \\frac{\\epsilon \\cdot 0}{|c_s - 0|} = 0$。这是一个合理的结果；任何合成事件（$x=0 \\to x=1$）都会导致降解倾向函数产生无限大的相对变化（从 $0$ 变为 $c_d$），因此时间步长必须缩减到零以维持跳跃条件。\n-   **情况 2: $c_{s} - c_{d}x = 0$**，这发生在 $x = c_{s}/c_{d}$ 时。这是系统的确定性稳态。在此状态下，分子数的期望净变化为零，$E[\\Delta x] = 0$。因此，对所有反应的倾向函数变化的线性化估计也为零。对于任何 $\\tau$ 值，跳跃条件都得到满足，这意味着 $\\tau \\to \\infty$。我们的公式通过分母为零反映了这一点。实际的实现会把 $\\tau$ 上限设为一个预定义的最大值，但仅根据问题中阐述的原理，其界限是无限的。\n\n问题要求一个单一的闭式表达式。推导出的公式满足此目的，并需理解其在这些特定点的行为。最后，我们代入给定的值 $\\epsilon=0.03$：\n$$\n\\tau = \\frac{0.03 x}{|c_{s} - c_{d}x|}\n$$\n这就是以分钟为单位的最大允许时间步长 $\\tau$ 的最终符号表达式。",
            "answer": "$$\n\\boxed{\\frac{0.03 x}{|c_{s} - c_{d}x|}}\n$$"
        },
        {
            "introduction": "理论的最终目的是应用于实践，模拟复杂的生物系统。这项练习要求您构建一个用于模拟经典合成生物学回路——基因拨动开关——的τ跳跃模拟器。您需要为生产和降解反应实现正确的统计抽样方法，并分析$τ$的选择如何影响对关键系统行为，即噪声诱导的状态切换时间的估计 。",
            "id": "3938161",
            "problem": "考虑一个合成基因双稳态开关的随机模型，该模型包含两种相互抑制对方产生的蛋白质种类 $X$ 和 $Y$。其动力学通过化学主方程（CME）来描述，被建模为一个连续时间、离散状态的马尔可夫过程。假设反应通道及其状态依赖的倾向函数如下：\n- X的产生：$\\varnothing \\rightarrow X$，倾向函数为 $a_{1}(x,y) = b_{x} + \\dfrac{\\alpha_{x}}{1 + \\left(\\dfrac{y}{K}\\right)^{n}}$。\n- Y的产生：$\\varnothing \\rightarrow Y$，倾向函数为 $a_{2}(x,y) = b_{y} + \\dfrac{\\alpha_{y}}{1 + \\left(\\dfrac{x}{K}\\right)^{n}}$。\n- X的降解：$X \\rightarrow \\varnothing$，倾向函数为 $a_{3}(x,y) = \\delta_{x}\\,x$。\n- Y的降解：$Y \\rightarrow \\varnothing$，倾向函数为 $a_{4}(x,y) = \\delta_{y}\\,y$。\n\n此处，$x$ 和 $y$ 分别表示 $X$ 和 $Y$ 的分子数。参数 $b_{x}$ 和 $b_{y}$ 是基础产生速率，$\\alpha_{x}$ 和 $\\alpha_{y}$ 是最大调控产生速率，$K$ 是抑制阈值，$n$ 是希尔系数，$\\delta_{x}$ 和 $\\delta_{y}$ 是一阶降解速率常数。所有速率的单位均为 $\\text{min}^{-1}$，时间单位为分钟。\n\n以CME为基本出发点，推导在该系统下τ-跳跃近似法有效的条件，并指明在时间间隔 $\\tau$ 内每个反应通道的反应发生次数所遵循的统计定律。根据第一性原理，解释为什么跳跃条件必须限制倾向函数和物种计数的改变。对于一阶降解反应（消耗单个分子），请论证一种在跳跃过程中能确保物种计数非负性的方法。\n\n然后，设计并实现一个模拟器，使用固定大小的τ-跳跃来估计从X高/Y低吸引盆切换到Y高/X低吸引盆的平均首达切换时间。使用以下科学上合理且自洽的参数集：\n- $\\alpha_{x} = \\alpha_{y} = 50$,\n- $b_{x} = b_{y} = 0.2$,\n- $K = 80$,\n- $n = 4$,\n- $\\delta_{x} = \\delta_{y} = 1$.\n\n每条轨迹的初始状态为 $(x_{0},y_{0}) = (120,2)$，当 $y \\geq 100$ 且 $x \\leq 20$ 时，认为发生了一次切换。如果一条轨迹在时间达到 $T_{\\max} = 200$ 分钟时仍未切换，则在计算样本均值时将其切换时间视为 $200$，并在您的解决方案中明确说明此种删失（censoring）的影响。\n\n您的程序必须对以下每个固定的跳跃步长 $\\tau$ 使用 $N = 60$ 条独立轨迹来估计平均切换时间（单位：分钟）：\n- $\\tau = 0.005$,\n- $\\tau = 0.050$,\n- $\\tau = 0.200$,\n- $\\tau = 0.800$.\n\n模拟器在每次跳跃中必须对反应次数使用统计上可靠的抽样方法：\n- 对于产生反应，当倾向函数在跳跃期间近似保持恒定时，使用与τ-跳跃近似法一致的分布。\n- 对于降解反应，使用一种能够防止消耗分子数超过当前计数的分布。\n\n将每次测试的最终平均切换时间以分钟为单位表示为浮点数。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的结果顺序与上述 $\\tau$ 值相对应。每个浮点数必须四舍五入到三位小数。例如，输出格式必须与 $[\\text{result}_{1},\\text{result}_{2},\\text{result}_{3},\\text{result}_{4}]$ 完全一致。\n\n测试套件和答案规范：\n- 为四个 $\\tau$ 值 $\\tau \\in \\{0.005, 0.050, 0.200, 0.800\\}$ 提供结果。\n- 每个 $\\tau$ 使用 $N = 60$ 条轨迹。\n- 使用 $T_{\\max} = 200$ 分钟进行删失。\n- 初始条件 $(x_{0},y_{0}) = (120,2)$。\n- 切换条件：$y \\geq 100$ 且 $x \\leq 20$。\n\n您的程序必须实现以上要求，并按指定格式打印单行输出。不应打印任何其他文本。",
            "solution": "问题陈述经过了仔细验证，被确定为具有科学依据、问题明确且客观。它提出了计算系统生物学中的一个标准问题：使用近似方法模拟随机基因开关模型，以估计一个关键的动力学特性。所有参数、条件和目标都得到了清晰的定义，构成了一个有效的先验任务。\n\n该问题涉及使用τ-跳跃近似法来模拟合成基因双稳态开关——一个系统生物学中的典型基序。系统状态由分子数向量 $\\mathbf{x}(t) = [x(t), y(t)]^T$ 给出，其中 $x$ 和 $y$ 分别是蛋白质种类 $X$ 和 $Y$ 的数量。系统的时间演化根本上由化学主方程（CME）控制，这是一组线性常微分方程，描述了系统在时间 $t$ 处于状态 $\\mathbf{x}$ 的概率 $P(\\mathbf{x}, t)$。\n\nτ-跳跃算法是一种近似方法，旨在加速随机模拟，其速度超越了Gillespie提出的精确随机模拟算法（SSA）的能力。SSA模拟每一个单独的反应事件，这对于具有大分子数或快速反应速率的系统来说，计算成本可能高得令人望而却步。相比之下，τ-跳跃将模拟时间推进一个预选的时间间隔 $\\tau$，并在此跳跃内触发多个反应。\n\n### τ-跳跃近似法及其有效性\n\nτ-跳跃的基本假设是**跳跃条件**：在时间间隔 $[t, t+\\tau)$ 内，每个反应通道 $j$ 的倾向函数 $a_j(\\mathbf{x}(t'))$ 必须保持近似恒定，即对于 $t' \\in [t, t+\\tau)$，$a_j(\\mathbf{x}(t')) \\approx a_j(\\mathbf{x}(t))$。\n\n如果此条件成立，则反应 $j$ 在时间间隔 $\\tau$ 内的触发过程可以建模为速率为 $\\lambda_j = a_j(\\mathbf{x}(t))$ 的齐次泊松过程。因此，在跳跃期间反应通道 $j$ 发生的次数（记为 $k_j$）是一个从泊松分布中抽样的随机变量：\n$$k_j \\sim \\text{Pois}(a_j(\\mathbf{x}(t))\\tau)$$\n这构成了控制那些倾向函数不依赖于被消耗物种的反应通道（例如本问题中的产生反应）的反应发生次数的统计定律。\n\n跳跃条件的有效性取决于跳跃期间状态向量 $\\mathbf{x}$ 的变化。状态根据以下公式更新：\n$$\\mathbf{x}(t+\\tau) = \\mathbf{x}(t) + \\sum_{j=1}^{M} k_j \\mathbf{v}_j$$\n其中 $M$ 是反应通道的数量，$\\mathbf{v}_j$ 是反应 $j$ 的状态改变向量。倾向函数会因为状态 $\\mathbf{x}$ 的改变而改变。为确保跳跃条件成立，由所有反应触发引起的任何倾向函数 $a_i$ 的变化必须相对于其自身的值要小。使用一阶近似，倾向函数 $a_i$ 的变化为 $\\Delta a_i \\approx \\nabla a_i \\cdot \\Delta \\mathbf{x} = \\nabla a_i \\cdot \\sum_j k_j \\mathbf{v}_j$。跳跃条件要求限制这一变化，例如，可以要求其期望的相对变化很小：\n$$ \\left| \\sum_{j=1}^{M} \\frac{\\partial a_i}{\\partial \\mathbf{x}} \\mathbf{v}_j \\mathbb{E}[k_j] \\right| = \\left| \\sum_{j=1}^{M} \\frac{\\partial a_i}{\\partial \\mathbf{x}} \\mathbf{v}_j (a_j(\\mathbf{x})\\tau) \\right| \\ll a_i(\\mathbf{x}) $$\n对于所有的 $i=1, \\dots, M$。在自适应算法中，会选择 $\\tau$ 以满足给定容差 $\\epsilon$ 的这一约束。在本问题中，我们使用固定的 $\\tau$，因此承认对于较大的 $\\tau$ 值，此条件可能会被违反，从而给模拟带来不准确性。限制这些变化至关重要，因为 $k_j$ 的泊松分布是在假设事件发生率为常数的情况下推导出来的。如果倾向函数发生显著变化，其底层过程将不再是齐次泊松过程，近似就会失效，导致系统动力学不正确。\n\n### 降解反应的非负性约束\n\n对于一阶降解反应，例如倾向函数为 $a_3(x,y) = \\delta_x x$ 的反应 $X \\rightarrow \\varnothing$，标准的泊松近似 $k_3 \\sim \\text{Pois}(\\delta_x x \\tau)$ 可能会产生一个大于 $x$ 的样本 $k_3$，这在物理上是不可能的，因为它会导致负的分子数。出现这种假象是因为泊松模型隐含地假设了有放回抽样；在整个跳跃过程中，倾向函数被保持在其初始值，忽略了每个反应的分子都被消耗掉并且不能再反应这一事实。\n\n一个在物理上更精确的方法是将该过程建模为*无*放回抽样。对于单个 $X$ 物种分子，在时间间隔 $\\tau$ 内不发生降解的概率是 $e^{-\\delta_x \\tau}$。这是通过求解微分方程 $dP_{\\text{survival}}/dt = -\\delta_x P_{\\text{survival}}$ 得出的，其解为 $P_{\\text{survival}}(t) = e^{-\\delta_x t}$。因此，单个分子在 $\\tau$ 时间内*确实*发生降解的概率是 $p_x = 1 - e^{-\\delta_x \\tau}$。\n\n给定一个由 $x$ 个相同且独立的分子组成的群体，降解的分子数 $k_3$ 是在 $x$ 次独立伯努利试验中“成功”（即降解）的次数。这恰好可以用二项分布来描述：\n$$k_3 \\sim \\text{Bin}(x, p_x) \\quad \\text{其中} \\quad p_x = 1 - e^{-\\delta_x \\tau}$$\n同理，对于Y的降解：\n$$k_4 \\sim \\text{Bin}(y, p_y) \\quad \\text{其中} \\quad p_y = 1 - e^{-\\delta_y \\tau}$$\n这种二项分布的公式自然地确保了 $k_3 \\le x$ 和 $k_4 \\le y$，从而严格防止了物种计数出现负值，并为τ-跳跃框架内的单分子消耗反应提供了一个更忠实的物理模型。\n\n### 平均首达时间的模拟\n\n任务是估计系统从X高Y低状态切换到X低Y高状态的平均首达时间（MFPT）。模拟过程如下：\n1.  将系统状态初始化为 $(x_0, y_0) = (120, 2)$，时间 $t=0$。\n2.  对于固定的跳跃步长 $\\tau$，按时间步进。在从 $t$ 到 $t+\\tau$ 的每一步中：\n    a. 根据时间 $t$ 时的状态 $(x,y)$ 计算产生反应的倾向函数 $a_1, a_2$ 和降解反应的倾向函数 $a_3, a_4$。\n    b. 从泊松分布中抽样产生事件的次数 $k_1$ 和 $k_2$：$k_1 \\sim \\text{Pois}(a_1 \\tau)$ 和 $k_2 \\sim \\text{Pois}(a_2 \\tau)$。\n    c. 从二项分布中抽样降解事件的次数 $k_3$ 和 $k_4$：$k_3 \\sim \\text{Bin}(x, 1 - e^{-\\delta_x \\tau})$ 和 $k_4 \\sim \\text{Bin}(y, 1 - e^{-\\delta_y \\tau})$。\n    d. 更新状态：$x_{\\text{new}} = x + k_1 - k_3$ 和 $y_{\\text{new}} = y + k_2 - k_4$。\n    e. 更新时间：$t_{\\text{new}} = t + \\tau$。\n3.  每步之后，检查是否满足切换条件（$y \\ge 100$ 且 $x \\le 20$）。如果满足，则将该轨迹的首达时间记录为 $t_{\\text{new}}$，并终止该轨迹的模拟。\n4.  如果模拟时间 $t$ 达到或超过 $T_{\\max} = 200$ 分钟而切换仍未发生，则终止该轨迹。其切换时间被记录为 $200$。这是一种右删失形式。这种删失的影响是，计算出的样本均值是真实MFPT的一个下界。如果被删失的轨迹占很大一部分，那么真实的MFPT可能会远大于估计值。\n5.  对每个给定的 $\\tau$ 值，重复此过程 $N=60$ 条独立轨迹。这 $N$ 个记录的切换时间的平均值即为最终估计值。\n\n该过程对每个指定的 $\\tau \\in \\{0.005, 0.050, 0.200, 0.800\\}$ 执行，并报告得出的平均切换时间。随着 $\\tau$ 的增大，计算速度会提高，但因违反跳跃条件而产生的误差也预期会增加，这可能会影响MFPT估计的准确性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a tau-leaping simulator to estimate the mean first-passage time \n    for a genetic toggle switch model.\n    \"\"\"\n\n    # --- Model Parameters ---\n    alpha_x = 50.0\n    alpha_y = 50.0\n    b_x = 0.2\n    b_y = 0.2\n    K = 80.0\n    n = 4.0\n    delta_x = 1.0\n    delta_y = 1.0\n\n    # --- Simulation Conditions ---\n    x0, y0 = 120, 2\n    y_thresh, x_thresh = 100, 20\n    Tmax = 200.0\n    N = 60  # Number of trajectories per tau\n\n    # --- Test Suite ---\n    tau_values = [0.005, 0.050, 0.200, 0.800]\n\n    # --- Propensity Functions ---\n    def a1(x, y):\n        # Production of X\n        return b_x + alpha_x / (1.0 + (y / K)**n)\n\n    def a2(x, y):\n        # Production of Y\n        return b_y + alpha_y / (1.0 + (x / K)**n)\n        \n    # Note: Degradation propensities a3 and a4 are handled directly\n    # within the Binomial sampling logic.\n\n    mean_switching_times = []\n\n    for tau in tau_values:\n        trajectory_times = []\n        for _ in range(N):\n            # --- Initialize Trajectory ---\n            x, y = float(x0), float(y0)\n            t = 0.0\n            switching_time = Tmax # Default to censored time\n\n            # --- Time-stepping Loop ---\n            while t  Tmax:\n                # Ensure state variables are non-negative integers for sampling\n                # (though they are floats from updates, they represent counts)\n                x_int, y_int = int(round(x)), int(round(y))\n\n                # --- Calculate Propensities ---\n                prop_a1 = a1(x, y)\n                prop_a2 = a2(x, y)\n                \n                # --- Sample Reaction Firings ---\n                # Production (Poisson)\n                k1 = np.random.poisson(prop_a1 * tau)\n                k2 = np.random.poisson(prop_a2 * tau)\n                \n                # Degradation (Binomial to ensure non-negativity)\n                # Probability of decay for a single molecule in time tau\n                p_decay_x = 1.0 - np.exp(-delta_x * tau)\n                p_decay_y = 1.0 - np.exp(-delta_y * tau)\n                \n                k3 = np.random.binomial(x_int, p_decay_x)\n                k4 = np.random.binomial(y_int, p_decay_y)\n                \n                # --- Update State and Time ---\n                x_new = x + k1 - k3\n                y_new = y + k2 - k4\n                t_new = t + tau\n\n                # --- Check for Switching Condition ---\n                if y_new >= y_thresh and x_new = x_thresh:\n                    switching_time = t_new\n                    break  # Exit time-stepping loop for this trajectory\n\n                # --- Prepare for Next Iteration ---\n                x, y, t = x_new, y_new, t_new\n\n            trajectory_times.append(switching_time)\n        \n        # --- Calculate and store mean switching time for this tau ---\n        mean_time = np.mean(trajectory_times)\n        mean_switching_times.append(mean_time)\n\n    # --- Final Print ---\n    # The final print statement in the exact required format.\n    print(f\"[{','.join(f'{t:.3f}' for t in mean_switching_times)}]\")\n\nsolve()\n```"
        }
    ]
}