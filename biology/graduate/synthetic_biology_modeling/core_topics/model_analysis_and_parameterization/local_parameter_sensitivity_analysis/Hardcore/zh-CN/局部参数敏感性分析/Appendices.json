{
    "hands_on_practices": [
        {
            "introduction": "掌握局部参数敏感性分析的第一步是理解如何推导敏感性方程。本练习将通过一个基础的单指数衰减模型，引导您实践从原始动力学方程出发，利用微分和链式法则，推导出状态变量关于模型参数（衰减速率和初始条件）的敏感性所遵循的常微分方程。这不仅是理论上的基础，也是后续进行更复杂数值分析的出发点 。",
            "id": "4385596",
            "problem": "在一个短寿命生物分子的单指数衰减药代动力学模型中，浓度 $x(t)$ 遵循常微分方程 (ODE) $dx/dt=-k\\,x$，以及特定于患者的初始条件 $x(0)=x_{0}(p)$。此处，$k>0$ 是一级消除速率常数，$x_{0}(p)$ 是由患者协变量 $p$ 决定的基线浓度。对于局部参数敏感性分析，将 $k$ 和 $x_{0}$ 视为独立参数。\n\n使用局部敏感性的定义 $S_{x,\\theta}(t)=\\partial x(t)/\\partial \\theta$（对于参数 $\\theta$），并从微分的基本运算和应用于状态ODE的链式法则出发，执行以下操作：\n\n1. 分别对状态ODE关于 $k$ 和 $x_{0}$ 求导，推导出 $S_{x,k}(t)$ 和 $S_{x,x_{0}}(t)$ 的敏感性ODE和初始条件。\n2. 求解这些敏感性ODE，以获得用 $t$、$k$ 和 $x_{0}$ 表示的 $S_{x,k}(t)$ 和 $S_{x,x_{0}}(t)$ 的闭式表达式。\n\n请以精确解析表达式的形式提供最终答案。不要进行近似计算，也不要包含单位。将两种敏感性一起表示为单个行矩阵 $\\bigl[S_{x,k}(t)\\;\\;S_{x,x_{0}}(t)\\bigr]$。",
            "solution": "该问题要求推导和求解单指数衰减模型的敏感性方程。该模型由浓度 $x(t)$ 的常微分方程 (ODE) 描述：\n$$\n\\frac{dx}{dt} = -k\\,x\n$$\n初始条件为：\n$$\nx(0) = x_{0}\n$$\n敏感性分析的参数是消除速率常数 $k$ 和初始浓度 $x_{0}$。状态 $x(t)$ 相对于通用参数 $\\theta$ 的局部敏感性定义为 $S_{x,\\theta}(t) = \\frac{\\partial x(t)}{\\partial \\theta}$。\n\n首先，我们求解状态ODE。这是一个可分离的一阶线性ODE。\n$$\n\\frac{dx}{x} = -k\\,dt\n$$\n对两边积分得到 $\\ln(x) = -kt + C$，其中 $C$ 是积分常数。取指数得到 $x(t) = \\exp(-kt+C) = A \\exp(-kt)$，其中 $A = \\exp(C)$。应用初始条件 $x(0) = x_{0}$，我们得到 $A = x_{0}$。\n因此，状态方程的解是：\n$$\nx(t) = x_{0} \\exp(-kt)\n$$\n这个 $x(t)$ 的表达式将用于推导敏感性方程。\n\n**1. 关于 $k$ 的敏感性的推导与求解**\n\n令 $S_{x,k}(t) = \\frac{\\partial x(t)}{\\partial k}$。为了找到控制 $S_{x,k}(t)$ 的ODE，我们对状态ODE关于 $k$ 求导。我们可以交换关于 $t$ 和 $k$ 的微分顺序：\n$$\n\\frac{d}{dt} S_{x,k}(t) = \\frac{d}{dt}\\left(\\frac{\\partial x}{\\partial k}\\right) = \\frac{\\partial}{\\partial k}\\left(\\frac{dx}{dt}\\right)\n$$\n将此应用于状态ODE的右侧，使用乘法法则：\n$$\n\\frac{\\partial}{\\partial k}(-k\\,x) = -\\left(\\frac{\\partial k}{\\partial k} \\cdot x + k \\cdot \\frac{\\partial x}{\\partial k}\\right) = -(1 \\cdot x + k \\cdot S_{x,k})\n$$\n令结果相等，得到 $S_{x,k}(t)$ 的敏感性ODE：\n$$\n\\frac{d S_{x,k}}{dt} = -x - k S_{x,k}\n$$\n代入 $x(t) = x_{0} \\exp(-kt)$ 的解：\n$$\n\\frac{d S_{x,k}}{dt} + k S_{x,k} = -x_{0} \\exp(-kt)\n$$\n$S_{x,k}(t)$ 的初始条件通过对状态初始条件 $x(0) = x_{0}$ 关于 $k$ 求导得到。由于 $x_{0}$ 被视为独立于 $k$ 的参数：\n$$\nS_{x,k}(0) = \\frac{\\partial x(0)}{\\partial k} = \\frac{\\partial x_{0}}{\\partial k} = 0\n$$\n我们使用积分因子 $I(t) = \\exp\\left(\\int k \\, dt\\right) = \\exp(kt)$ 求解这个一阶线性非齐次ODE。将ODE乘以 $I(t)$：\n$$\n\\exp(kt)\\frac{d S_{x,k}}{dt} + k\\exp(kt) S_{x,k} = -x_{0} \\exp(-kt) \\exp(kt)\n$$\n左侧简化为一个乘积的导数：\n$$\n\\frac{d}{dt}\\left(S_{x,k}(t) \\exp(kt)\\right) = -x_{0}\n$$\n关于 $t$ 积分：\n$$\nS_{x,k}(t) \\exp(kt) = \\int -x_{0} \\, dt = -x_{0}t + C_{1}\n$$\n其中 $C_{1}$ 是积分常数。求解 $S_{x,k}(t)$：\n$$\nS_{x,k}(t) = (-x_{0}t + C_{1}) \\exp(-kt)\n$$\n应用初始条件 $S_{x,k}(0) = 0$：\n$$\n0 = (-x_{0} \\cdot 0 + C_{1}) \\exp(0) \\implies C_{1} = 0\n$$\n因此，关于 $k$ 的敏感性的解是：\n$$\nS_{x,k}(t) = -x_{0} t \\exp(-kt)\n$$\n\n**2. 关于 $x_0$ 的敏感性的推导与求解**\n\n令 $S_{x,x_{0}}(t) = \\frac{\\partial x(t)}{\\partial x_{0}}$。遵循相同的步骤，我们对状态ODE关于 $x_{0}$ 求导：\n$$\n\\frac{d}{dt} S_{x,x_{0}}(t) = \\frac{d}{dt}\\left(\\frac{\\partial x}{\\partial x_{0}}\\right) = \\frac{\\partial}{\\partial x_{0}}\\left(\\frac{dx}{dt}\\right)\n$$\n将其应用于右侧：\n$$\n\\frac{\\partial}{\\partial x_{0}}(-k\\,x) = -k \\frac{\\partial x}{\\partial x_{0}} = -k S_{x,x_{0}}\n$$\n这得到了敏感性ODE：\n$$\n\\frac{d S_{x,x_{0}}}{dt} = -k S_{x,x_{0}}\n$$\n初始条件通过对 $x(0) = x_{0}$ 关于 $x_{0}$ 求导得到：\n$$\nS_{x,x_{0}}(0) = \\frac{\\partial x(0)}{\\partial x_{0}} = \\frac{\\partial x_{0}}{\\partial x_{0}} = 1\n$$\n$S_{x,x_{0}}(t)$ 的ODE是一个简单的指数衰减方程。其解为：\n$$\nS_{x,x_{0}}(t) = S_{x,x_{0}}(0) \\exp(-kt)\n$$\n代入初始条件 $S_{x,x_{0}}(0) = 1$：\n$$\nS_{x,x_{0}}(t) = \\exp(-kt)\n$$\n问题要求最终答案以行矩阵 $\\bigl[S_{x,k}(t)\\;\\;S_{x,x_{0}}(t)\\bigr]$ 的形式呈现。根据我们的推导，结果是：\n$$\n\\begin{pmatrix} -x_{0} t \\exp(-kt)  \\exp(-kt) \\end{pmatrix}\n$$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -x_{0} t \\exp(-kt)  \\exp(-kt) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在现实世界中，大多数生物系统模型由于其非线性复杂性，无法求得解析解，因此数值计算成为敏感性分析不可或缺的工具。本练习将指导您为一个典型的基因自抑制回路模型，通过构建一个包含原始状态和所有参数敏感性的增广常微分方程系统，来数值求解归一化的对数敏感性指数 。通过这个实践，您将掌握在无法获得解析解时，如何量化模型输出对各参数变化的相对重要性。",
            "id": "3917162",
            "problem": "考虑一个最小的合成基因线路，其中单个蛋白质通过与启动子的协同结合来抑制其自身的转录。分子种类为信使核糖核酸（mRNA）和蛋白质，分别表示为 $m(t)$ 和 $P(t)$。在分子生物学中心法则（脱氧核糖核酸到核糖核酸到蛋白质）以及生产和一级降解的质量作用动力学假设下，$m(t)$ 和 $P(t)$ 的时间演化由以下常微分方程组建模：\n$$\n\\frac{dm}{dt} = \\frac{\\alpha}{1 + \\left(\\frac{P}{K}\\right)^n} - \\delta_m \\, m,\n\\qquad\n\\frac{dP}{dt} = \\beta \\, m - \\delta_p \\, P,\n$$\n其中 $\\alpha$ 是最大转录速率，$K$ 是抑制作用的解离常数，$n$ 是希尔系数，$\\delta_m$ 是 mRNA 降解速率，$\\beta$ 是翻译速率，$\\delta_p$ 是蛋白质降解速率。所有参数均为严格正数。\n\n要求您从初始条件 $m(0)=0$ 和 $P(0)=0$ 开始，对固定最终时间 $T$ 时的蛋白质浓度进行局部参数敏感性分析。对于参数 $\\theta$，将 $P(t)$ 关于 $\\theta$ 的局部敏感性定义为偏导数 $\\frac{\\partial P(t)}{\\partial \\theta}$。将时间 $t$ 时的归一化对数局部敏感性指数定义为\n$$\nS_\\theta(t) = \\frac{\\theta}{P(t)} \\, \\frac{\\partial P(t)}{\\partial \\theta},\n$$\n该指数是无量纲的。计算六个参数 $\\theta \\in \\{\\alpha, K, n, \\delta_m, \\beta, \\delta_p\\}$ 的 $S_\\theta(T)$。\n\n您的程序必须使用与上述动力学模型一致的原理来数值计算这些敏感性，而不假设 $m(t)$ 或 $P(t)$ 存在解析闭式解。\n\n所有时间必须以秒为单位表示。分子数量必须以分子为单位处理。归一化敏感性指数 $S_\\theta(T)$ 是无量纲的，应作为浮点数返回。\n\n使用 $T = 1000$ 秒。使用以下参数集测试套件，每个测试用例以有序元组 $(\\alpha, K, n, \\delta_m, \\beta, \\delta_p)$ 的形式提供，单位为 $(\\text{分子}\\cdot \\text{s}^{-1}, \\text{分子}, \\text{无量纲}, \\text{s}^{-1}, \\text{s}^{-1}, \\text{s}^{-1})$：\n- 测试用例 1 (一般协同抑制): $(50, 1000, 2, 0.2, 2, 0.05)$。\n- 测试用例 2 (弱协同性和大解离常数): $(50, 10000, 1, 0.2, 2, 0.05)$。\n- 测试用例 3 (强协同性和慢降解): $(200, 500, 4, 0.05, 2, 0.01)$。\n- 测试用例 4 (几乎无抑制的转录，非常大的 $K$): $(50, 1000000, 2, 0.2, 2, 0.05)$。\n\n对于每个测试用例，计算并输出包含六个归一化敏感性的列表 $[S_\\alpha(T), S_K(T), S_n(T), S_{\\delta_m}(T), S_\\beta(T), S_{\\delta_p}(T)]$。\n\n您的程序应生成单行输出，其中包含所有测试用例的聚合结果，格式为方括号内包含的逗号分隔列表，其中每个元素对应一个测试用例，并且本身是一个包含六个浮点值的逗号分隔列表。例如，输出格式必须为\n$$\n[\\,[S_\\alpha,S_K,S_n,S_{\\delta_m},S_\\beta,S_{\\delta_p}]_{\\text{case 1}},\\,[\\cdots]_{\\text{case 2}},\\,[\\cdots]_{\\text{case 3}},\\,[\\cdots]_{\\text{case 4}}\\,],\n$$\n以单行形式打印，并带有方括号和逗号。",
            "solution": "用户提供了一个来自合成生物学建模领域的有效且适定的问题陈述。任务是为一个遗传自抑制线路的标准模型执行局部参数敏感性分析。所有必要的参数、初始条件和定义都已提供，且问题具有科学依据。\n\n该问题要求计算最终时间 $T$ 时蛋白质浓度 $P(t)$ 的归一化对数局部敏感性指数 $S_\\theta(T)$。该系统由以下常微分方程（ODEs）描述：\n$$\n\\frac{dm}{dt} = \\frac{\\alpha}{1 + \\left(\\frac{P}{K}\\right)^n} - \\delta_m \\, m\n$$\n$$\n\\frac{dP}{dt} = \\beta \\, m - \\delta_p \\, P\n$$\n初始条件为 $m(0) = 0$ 和 $P(0) = 0$。参数 $\\theta$ 包括 $\\alpha, K, n, \\delta_m, \\beta, \\delta_p$。敏感性指数定义为：\n$$\nS_\\theta(t) = \\frac{\\theta}{P(t)} \\, \\frac{\\partial P(t)}{\\partial \\theta}\n$$\n由于通常无法获得 $P(t)$ 的解析解，我们必须数值计算 $P(T)$ 和原始敏感性 $\\frac{\\partial P(T)}{\\partial \\theta}$。与问题约束条件一致的标准方法是前向敏感性分析或直接微分法。这涉及用描述敏感性自身时间演化的附加常微分方程来增广原始常微分方程组。\n\n令状态向量为 $\\mathbf{x}(t) = [m(t), P(t)]^T$。该常微分方程组可以写作 $\\frac{d\\mathbf{x}}{dt} = \\mathbf{f}(\\mathbf{x}, \\boldsymbol{\\theta})$，其中 $\\boldsymbol{\\theta}$ 是参数向量。状态向量关于参数 $\\theta$ 的敏感性是 $\\mathbf{s}_\\theta(t) = \\frac{\\partial \\mathbf{x}(t)}{\\partial \\theta}$。对系统动力学关于 $\\theta$ 求导，得到敏感性方程：\n$$\n\\frac{d\\mathbf{s}_\\theta}{dt} = \\frac{d}{dt}\\left(\\frac{\\partial \\mathbf{x}}{\\partial \\theta}\\right) = \\frac{\\partial}{\\partial \\theta}\\left(\\frac{d\\mathbf{x}}{dt}\\right) = \\frac{\\partial}{\\partial \\theta}\\mathbf{f}(\\mathbf{x}, \\boldsymbol{\\theta})\n$$\n应用链式法则，得到一个关于敏感性的线性非齐次常微分方程组：\n$$\n\\frac{d\\mathbf{s}_\\theta}{dt} = \\frac{\\partial \\mathbf{f}}{\\partial \\mathbf{x}} \\mathbf{s}_\\theta + \\frac{\\partial \\mathbf{f}}{\\partial \\theta}\n$$\n此处，$\\frac{\\partial \\mathbf{f}}{\\partial \\mathbf{x}}$ 是原始系统的雅可比矩阵 $\\mathbf{J}$，而 $\\frac{\\partial \\mathbf{f}}{\\partial \\theta}$ 是一个强迫项，表示动力学对参数 $\\theta$ 的直接依赖性。\n\n该系统的雅可比矩阵为：\n$$\n\\mathbf{J} = \\begin{pmatrix} \\frac{\\partial (dm/dt)}{\\partial m}  \\frac{\\partial (dm/dt)}{\\partial P} \\\\ \\frac{\\partial (dP/dt)}{\\partial m}  \\frac{\\partial (dP/dt)}{\\partial P} \\end{pmatrix} = \\begin{pmatrix} -\\delta_m  -\\frac{\\alpha n P^{n-1}}{K^n \\left(1 + (P/K)^n\\right)^2} \\\\ \\beta  -\\delta_p \\end{pmatrix}\n$$\n强迫项 $\\frac{\\partial \\mathbf{f}}{\\partial \\theta} = \\left[ \\frac{\\partial(dm/dt)}{\\partial \\theta}, \\frac{\\partial(dP/dt)}{\\partial \\theta} \\right]^T$ 必须对 6 个参数中的每一个进行推导：\n\n1.  对于 $\\theta = \\alpha$：$\\frac{\\partial \\mathbf{f}}{\\partial \\alpha} = \\left[ \\frac{1}{1 + (P/K)^n}, \\, 0 \\right]^T$\n2.  对于 $\\theta = K$：$\\frac{\\partial \\mathbf{f}}{\\partial K} = \\left[ \\frac{\\alpha n P^n}{K^{n+1}\\left(1 + (P/K)^n\\right)^2}, \\, 0 \\right]^T$\n3.  对于 $\\theta = n$：$\\frac{\\partial \\mathbf{f}}{\\partial n} = \\left[ -\\frac{\\alpha (P/K)^n \\ln(P/K)}{\\left(1+(P/K)^n\\right)^2}, \\, 0 \\right]^T$。如果 $P=0$，此项为 $0$。\n4.  对于 $\\theta = \\delta_m$：$\\frac{\\partial \\mathbf{f}}{\\partial \\delta_m} = \\left[ -m, \\, 0 \\right]^T$\n5.  对于 $\\theta = \\beta$：$\\frac{\\partial \\mathbf{f}}{\\partial \\beta} = \\left[ 0, \\, m \\right]^T$\n6.  对于 $\\theta = \\delta_p$：$\\frac{\\partial \\mathbf{f}}{\\partial \\delta_p} = \\left[ 0, \\, -P \\right]^T$\n\n我们构建一个包含 $2 + 6 \\times 2 = 14$ 个常微分方程的增广系统。此增广系统的状态向量是 $\\mathbf{y}(t) = [m, P, s_{m,\\alpha}, s_{P,\\alpha}, s_{m,K}, s_{P,K}, \\dots, s_{m,\\delta_p}, s_{P,\\delta_p}]^T$，其中 $s_{m,\\theta} = \\partial m / \\partial \\theta$ 且 $s_{P,\\theta} = \\partial P / \\partial \\theta$。原始状态的初始条件是 $m(0)=0$ 和 $P(0)=0$。由于初始状态不依赖于参数，因此初始敏感性全为零：对于所有 $\\theta$，$\\mathbf{s}_\\theta(0) = \\mathbf{0}$。因此，增广系统的初始条件是 $\\mathbf{y}(0) = \\mathbf{0}$。\n\n每个测试用例的步骤如下：\n1.  使用给定的参数集 $(\\alpha, K, n, \\delta_m, \\beta, \\delta_p)$ 定义包含 14 个常微分方程的增广系统。\n2.  从初始条件 $\\mathbf{y}(0) = \\mathbf{0}$ 开始，将该系统从 $t=0$ 数值积分到最终时间 $T=1000$ 秒。\n3.  从 $t=T$ 时的解中，提取蛋白质浓度 $P(T)$ 和 6 个原始蛋白质敏感性 $\\frac{\\partial P(T)}{\\partial \\theta}$。\n4.  对于每个参数 $\\theta$，计算归一化敏感性指数 $S_\\theta(T) = \\frac{\\theta}{P(T)} \\frac{\\partial P(T)}{\\partial \\theta}$。\n5.  将 6 个敏感性指数收集到当前测试用例的列表中。\n\n对所有四个测试用例重复此过程，并将结果聚合成一个列表的列表作为最终输出。实现将使用 `scipy.integrate.solve_ivp` 进行数值积分。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Computes local parameter sensitivities for a genetic autorepressor circuit model.\n    \"\"\"\n\n    # Final time for integration.\n    T = 1000.0\n\n    # Define the test cases from the problem statement.\n    # Each tuple is (alpha, K, n, delta_m, beta, delta_p).\n    test_cases = [\n        (50.0, 1000.0, 2.0, 0.2, 2.0, 0.05),\n        (50.0, 10000.0, 1.0, 0.2, 2.0, 0.05),\n        (200.0, 500.0, 4.0, 0.05, 2.0, 0.01),\n        (50.0, 1000000.0, 2.0, 0.2, 2.0, 0.05),\n    ]\n\n    all_results = []\n    for params_tuple in test_cases:\n        alpha, K, n, delta_m, beta, delta_p = params_tuple\n\n        def augmented_odes(t, y):\n            \"\"\"\n            Defines the augmented system of 14 ODEs for states and sensitivities.\n            State vector y layout:\n            y[0]: m (mRNA)\n            y[1]: P (Protein)\n            y[2], y[3]: sensitivities to alpha (s_m_alpha, s_P_alpha)\n            y[4], y[5]: sensitivities to K (s_m_K, s_P_K)\n            y[6], y[7]: sensitivities to n (s_m_n, s_P_n)\n            y[8], y[9]: sensitivities to delta_m (s_m_dm, s_P_dm)\n            y[10], y[11]: sensitivities to beta (s_m_beta, s_P_beta)\n            y[12], y[13]: sensitivities to delta_p (s_m_dp, s_P_dp)\n            \"\"\"\n            # Unpack states\n            m, P = y[0], y[1]\n\n            # --- Pre-calculate common terms for efficiency ---\n            # Clamp P to be non-negative to avoid domain errors.\n            P_eff = max(0.0, P)\n\n            ratio_P_K = P_eff / K if K > 0 else 0.0\n            \n            try:\n                pow_ratio_P_K = ratio_P_K**n\n            except (ValueError, OverflowError):\n                pow_ratio_P_K = float('inf')\n                \n            denom = 1.0 + pow_ratio_P_K\n            repression_term = 1.0 / denom if denom > 0 else 0.0\n\n            # --- Original ODEs for m and P ---\n            dm_dt = alpha * repression_term - delta_m * m\n            dP_dt = beta * m - delta_p * P\n\n            # --- Jacobian elements ---\n            # J = [[J11, J12], [J21, J22]]\n            J11 = -delta_m\n            J21 = beta\n            J22 = -delta_p\n            if P_eff > 0 and denom > 0:\n                J12 = -alpha * n * pow_ratio_P_K / (K * ratio_P_K * denom**2)\n            else:\n                J12 = 0.0\n\n            # --- Forcing terms (derivatives of f with respect to parameters) ---\n            # dfm_d(theta)\n            dfm_dalpha = repression_term\n            \n            if P_eff > 0 and K > 0 and denom > 0:\n                dfm_dK = alpha * n * pow_ratio_P_K / (K * denom**2)\n            else:\n                dfm_dK = 0.0\n            \n            if P_eff > 0 and K > 0 and ratio_P_K != 1.0 and denom > 0:\n                log_ratio = np.log(ratio_P_K)\n                dfm_dn = -alpha * pow_ratio_P_K * log_ratio / (denom**2)\n            else:\n                dfm_dn = 0.0\n\n            dfm_ddm = -m\n            # dfp_d(theta)\n            dfp_dbeta = m\n            dfp_ddp = -P_eff\n\n            # --- ODEs for sensitivities s' = J*s + F_theta ---\n            derivatives = np.zeros(14)\n            derivatives[0] = dm_dt\n            derivatives[1] = dP_dt\n            \n            # Sensitivity pairs [ds_m/dt, ds_P/dt]\n            sens_pairs = [\n                # (forcing_m, forcing_p) for each parameter\n                (dfm_dalpha, 0.0),          # alpha\n                (dfm_dK, 0.0),              # K\n                (dfm_dn, 0.0),              # n\n                (dfm_ddm, 0.0),             # delta_m\n                (0.0, dfp_dbeta),           # beta\n                (0.0, dfp_ddp),             # delta_p\n            ]\n\n            for i, (fm_force, fp_force) in enumerate(sens_pairs):\n                idx = 2 + 2 * i\n                s_m, s_P = y[idx], y[idx + 1]\n                derivatives[idx] = J11 * s_m + J12 * s_P + fm_force\n                derivatives[idx + 1] = J21 * s_m + J22 * s_P + fp_force\n\n            return derivatives\n\n        # Initial conditions: m(0)=0, P(0)=0, all sensitivities are 0.\n        y0 = np.zeros(14)\n\n        # Integrate the augmented ODE system.\n        solution = solve_ivp(\n            augmented_odes,\n            (0, T),\n            y0,\n            method='RK45',\n            t_eval=[T],\n            rtol=1e-8,\n            atol=1e-10\n        )\n\n        # Extract results at time T.\n        final_state = solution.y[:, -1]\n        P_T = final_state[1]\n\n        # Raw sensitivities of P(T) wrt each parameter\n        # dP/d(alpha, K, n, delta_m, beta, delta_p)\n        raw_sensitivities = [\n            final_state[3], final_state[5], final_state[7],\n            final_state[9], final_state[11], final_state[13]\n        ]\n        \n        # Calculate normalized sensitivity indices: S_theta = (theta/P) * (dP/dtheta)\n        s_indices = []\n        if P_T > 1e-9: # Avoid division by zero\n            params = [alpha, K, n, delta_m, beta, delta_p]\n            for i in range(6):\n                S_theta = (params[i] / P_T) * raw_sensitivities[i]\n                s_indices.append(S_theta)\n        else:\n            s_indices = [0.0] * 6 # P is near zero, sensitivities are ill-defined or zero.\n\n        all_results.append(s_indices)\n\n    # Format the output string as per requirements.\n    case_strings = []\n    for res in all_results:\n        case_strings.append(f\"[{','.join(map(str, res))}]\")\n    \n    # Print the final single-line output.\n    print(f\"[{','.join(case_strings)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "参数敏感性分析不仅适用于分析系统的瞬态动力学，同样可以深刻揭示系统稳态对参数变化的响应。本练习以经典的 Levins 集合种群模型为例，要求您计算其平衡点关于关键生态学参数（定殖率 $c$ 和灭绝率 $e$）的一阶和二阶敏感性。通过构建和分析梯度向量及 Hessian 矩阵，您将学会如何评估参数变化的非线性效应和交互作用，例如收益递减和协同效应 。",
            "id": "3893396",
            "problem": "考虑一个空间显式异质种群，其中被占据生境斑块的比例（记为 $p(t)$）根据 Levins 异质种群模型演化，其形式为一个常微分方程 (ODE)：\n$$\\frac{dp}{dt} = c\\,p\\,(1-p) - e\\,p,$$ \n其中 $c>0$ 是定殖率，$e>0$ 是局域灭绝率。假设参数值满足 $c>e$，从而存在一个正的内部平衡点。将被占据斑块的内部平衡比例 $p^{*}$ 视为参数的函数，记为 $p^{*}(c,e)$。\n\n仅使用上述基础模型以及平衡点分析和局域参数敏感性的标准方法，完成以下任务：\n1. 在 $c>e>0$ 的条件下，确定作为 $c$ 和 $e$ 函数的内部平衡点 $p^{*}$。\n2. 计算 $p^{*}(c,e)$ 关于 $(c,e)$ 的梯度向量和 Hessian 矩阵。\n3. 构建 $p^{*}(c+\\delta c, e+\\delta e)$ 在 $(c,e)$ 点的二阶泰勒近似，保留 $\\delta c$ 和 $\\delta e$ 的直至二阶的项。\n4. 简要解释 Hessian 矩阵各项的符号如何影响 $p^{*}(c,e)$ 关于 $c$ 和 $e$ 的局部曲率，以及这对定殖率和灭绝率同时发生微小变化所带来的后果。\n\n将您的最终答案表示为 $p^{*}(c+\\delta c, e+\\delta e)$ 的二阶近似的单一闭式解析表达式，用 $c$、$e$、$\\delta c$ 和 $\\delta e$ 来表示。无需进行数值计算。最终表达式中请勿包含任何单位。",
            "solution": "该问题是有效的，因为它科学地基于已确立的生态建模原则（Levins 模型），其提法是适定的，具有充分且一致的条件（$c>e>0$），并以客观、正式的语言表述。我们着手进行解答。\n\n分析过程按问题陈述的要求分为四个部分。\n\n**第一部分：确定内部平衡点**\n\n被占据斑块比例 $p(t)$ 的演化由以下常微分方程 (ODE) 给出：\n$$ \\frac{dp}{dt} = c\\,p\\,(1-p) - e\\,p $$\n平衡状态（记为 $p^{*}$）通过将变化率设为零（$\\frac{dp}{dt} = 0$）来求得：\n$$ c\\,p^{*}\\,(1-p^{*}) - e\\,p^{*} = 0 $$\n我们可以从表达式中提出公因子 $p^{*}$：\n$$ p^{*} \\left[ c\\,(1-p^{*}) - e \\right] = 0 $$\n该方程得出两种可能的平衡解：\n1. 平凡平衡点：$p^{*} = 0$。这对应于整个异质种群的灭绝。\n2. 内部平衡点，通过将方括号中的项设为零来求得：\n$$ c\\,(1-p^{*}) - e = 0 $$\n解出 $p^{*}$：\n$$ c - c\\,p^{*} - e = 0 $$\n$$ c - e = c\\,p^{*} $$\n$$ p^{*} = \\frac{c - e}{c} = 1 - \\frac{e}{c} $$\n问题指定了条件 $c > e > 0$。这确保了 $c-e > 0$ 且 $c > 0$，因此 $p^{*} > 0$。同时，由于 $e/c  1$，我们有 $p^{*}  1$。因此，内部平衡点 $p^{*} \\in (0, 1)$ 是有物理意义的，代表了异质种群持续存在的一种状态。我们定义函数 $p^{*}(c,e) = 1 - \\frac{e}{c}$。\n\n**第二部分：梯度向量和 Hessian 矩阵**\n\n我们现在计算 $p^{*}(c, e) = 1 - e\\,c^{-1}$ 关于参数 $c$ 和 $e$ 的一阶和二阶偏导数。\n\n一阶偏导数是：\n$$ \\frac{\\partial p^{*}}{\\partial c} = \\frac{\\partial}{\\partial c} \\left( 1 - e\\,c^{-1} \\right) = -e(-1)c^{-2} = \\frac{e}{c^2} $$\n$$ \\frac{\\partial p^{*}}{\\partial e} = \\frac{\\partial}{\\partial e} \\left( 1 - \\frac{e}{c} \\right) = -\\frac{1}{c} $$\n因此，$p^{*}(c,e)$ 的梯度向量是：\n$$ \\nabla p^{*}(c, e) = \\begin{pmatrix} \\frac{\\partial p^{*}}{\\partial c} \\\\ \\frac{\\partial p^{*}}{\\partial e} \\end{pmatrix} = \\begin{pmatrix} \\frac{e}{c^2} \\\\ -\\frac{1}{c} \\end{pmatrix} $$\n\n二阶偏导数是：\n$$ \\frac{\\partial^2 p^{*}}{\\partial c^2} = \\frac{\\partial}{\\partial c} \\left( \\frac{e}{c^2} \\right) = \\frac{\\partial}{\\partial c} (e\\,c^{-2}) = e(-2)c^{-3} = -\\frac{2e}{c^3} $$\n$$ \\frac{\\partial^2 p^{*}}{\\partial e^2} = \\frac{\\partial}{\\partial e} \\left( -\\frac{1}{c} \\right) = 0 $$\n$$ \\frac{\\partial^2 p^{*}}{\\partial c \\partial e} = \\frac{\\partial}{\\partial c} \\left( \\frac{\\partial p^{*}}{\\partial e} \\right) = \\frac{\\partial}{\\partial c} \\left( -\\frac{1}{c} \\right) = \\frac{\\partial}{\\partial c} (-c^{-1}) = -(-1)c^{-2} = \\frac{1}{c^2} $$\n根据克莱罗定理，我们确认 $\\frac{\\partial^2 p^{*}}{\\partial e \\partial c} = \\frac{\\partial^2 p^{*}}{\\partial c \\partial e}$。\n$p^{*}(c,e)$ 的 Hessian 矩阵是：\n$$ H_{p^{*}}(c, e) = \\begin{pmatrix} \\frac{\\partial^2 p^{*}}{\\partial c^2}  \\frac{\\partial^2 p^{*}}{\\partial c \\partial e} \\\\ \\frac{\\partial^2 p^{*}}{\\partial e \\partial c}  \\frac{\\partial^2 p^{*}}{\\partial e^2} \\end{pmatrix} = \\begin{pmatrix} -\\frac{2e}{c^3}  \\frac{1}{c^2} \\\\ \\frac{1}{c^2}  0 \\end{pmatrix} $$\n\n**第三部分：二阶泰勒近似**\n\n对于点 $(x_0, y_0)$ 附近的小扰动 $(\\delta x, \\delta y)$，函数 $f(x,y)$ 的二阶泰勒近似由下式给出：\n$$ f(x_0 + \\delta x, y_0 + \\delta y) \\approx f(x_0, y_0) + \\frac{\\partial f}{\\partial x}\\delta x + \\frac{\\partial f}{\\partial y}\\delta y + \\frac{1}{2} \\left[ \\frac{\\partial^2 f}{\\partial x^2}(\\delta x)^2 + 2\\frac{\\partial^2 f}{\\partial x \\partial y}(\\delta x)(\\delta y) + \\frac{\\partial^2 f}{\\partial y^2}(\\delta y)^2 \\right] $$\n将此公式应用于我们的函数 $p^{*}(c,e)$，考虑其在点 $(c,e)$ 附近的扰动 $(\\delta c, \\delta e)$：\n$$ p^{*}(c + \\delta c, e + \\delta e) \\approx p^{*}(c,e) + \\frac{\\partial p^{*}}{\\partial c}\\delta c + \\frac{\\partial p^{*}}{\\partial e}\\delta e + \\frac{1}{2} \\left[ \\frac{\\partial^2 p^{*}}{\\partial c^2}(\\delta c)^2 + 2\\frac{\\partial^2 p^{*}}{\\partial c \\partial e}(\\delta c)(\\delta e) + \\frac{\\partial^2 p^{*}}{\\partial e^2}(\\delta e)^2 \\right] $$\n代入前面部分计算出的函数及其导数：\n$$ p^{*}(c + \\delta c, e + \\delta e) \\approx \\left(1 - \\frac{e}{c}\\right) + \\left(\\frac{e}{c^2}\\right)\\delta c + \\left(-\\frac{1}{c}\\right)\\delta e + \\frac{1}{2} \\left[ \\left(-\\frac{2e}{c^3}\\right)(\\delta c)^2 + 2\\left(\\frac{1}{c^2}\\right)(\\delta c)(\\delta e) + (0)(\\delta e)^2 \\right] $$\n化简该表达式得到最终的近似式：\n$$ p^{*}(c + \\delta c, e + \\delta e) \\approx 1 - \\frac{e}{c} + \\frac{e}{c^2}\\delta c - \\frac{1}{c}\\delta e - \\frac{e}{c^3}(\\delta c)^2 + \\frac{1}{c^2}(\\delta c)(\\delta e) $$\n\n**第四部分：Hessian 矩阵项的解释**\n\nHessian 矩阵的各项揭示了平衡曲面 $p^{*}(c,e)$ 的局部曲率。\n- 项 $\\frac{\\partial^2 p^{*}}{\\partial c^2} = -\\frac{2e}{c^3}$ 是负的（因为 $c>0, e>0$）。这表明 $p^{*}$ 是关于 $c$ 的凹函数。从生态学角度看，这代表了边际收益递减：增加定殖率 $c$ 始终会提高平衡占据率 $p^{*}$，但随着 $c$ 的增大，$p^{*}$ 的边际增益会减小。\n- 项 $\\frac{\\partial^2 p^{*}}{\\partial e^2} = 0$ 表明（在 $c$ 固定的情况下）$p^{*}$ 与 $e$ 之间的关系是线性的。不存在边际收益递减或递增；灭绝率 $e$ 每增加一个单位，都会导致 $p^{*}$ 发生一个等于 $\\frac{1}{c}$ 的恒定减少量。\n- 混合偏导数 $\\frac{\\partial^2 p^{*}}{\\partial c \\partial e} = \\frac{1}{c^2}$ 是正的。这一项量化了两个参数之间的相互作用。其为正值意味着 $\\frac{\\partial}{\\partial c} \\left( \\frac{\\partial p^{*}}{\\partial e} \\right) > 0$。由于 $\\frac{\\partial p^{*}}{\\partial e} = -\\frac{1}{c}$ 是占据率对灭绝率的敏感度，这意味着增加定殖率 $c$ 会使系统对灭绝更具鲁棒性（即，它减弱了 $e$ 的负面影响）。正的混合偏导数也在泰勒展开式中产生了相互作用项 $\\frac{1}{c^2}(\\delta c)(\\delta e)$，这表明 $c$ 和 $e$ 同时变化的综合效应并不仅仅是相加的。例如，如果定殖率下降（$\\delta c  0$）而灭绝率上升（$\\delta e > 0$），则相互作用项为负，从而加剧了斑块占据率的下降，其程度超出了线性预测。这种协同的负面效应是二阶分析得出的一个关键见解。\n\n最终答案是在第三部分中推导出的二阶近似式。",
            "answer": "$$ \\boxed{1 - \\frac{e}{c} + \\frac{e}{c^2}\\delta c - \\frac{1}{c}\\delta e - \\frac{e}{c^3}(\\delta c)^2 + \\frac{1}{c^2}(\\delta c)(\\delta e)} $$"
        }
    ]
}