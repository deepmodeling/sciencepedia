{
    "hands_on_practices": [
        {
            "introduction": "许多生物体的生命周期包含不同的阶段，例如幼年、亚成年和成年。种群预测矩阵（如 Leslie 矩阵）是模拟这些阶段结构种群动态的基础工具。本练习将指导您完成三项核心生命史指标的推导与计算：长期种群增长率 $\\lambda$、稳定阶段分布 $\\mathbf{w}$，以及繁殖价值向量 $\\mathbf{v}$。掌握这些计算是进行定量生命史分析的关键，也为理解更复杂的演化问题奠定了基础。",
            "id": "2728442",
            "problem": "一个脊椎动物物种表现出三个离散的生活史阶段，这些阶段体现了生存与繁殖之间的权衡：幼体（阶段 $1$）、亚成体（阶段 $2$）和成体（阶段 $3$）。阶段 $2$ 和 $3$ 的个体进行繁殖，其繁殖力为 $F=[0,\\,1.2,\\,1.5]$，而阶段间的存活转移率由 $P=[0.5,\\,0.6,\\,0.7]$ 给出。假设一个具有 Leslie–Lefkovitch 结构的离散时间线性投影：投影矩阵 $\\mathbf{A}$ 的第一行是繁殖力，次对角线上是存活转移率，最后一个阶段存在存留率，即：\n$$\n\\mathbf{A} \\;=\\; \\begin{pmatrix}\n0 & 1.2 & 1.5 \\\\\n0.5 & 0 & 0 \\\\\n0 & 0.6 & 0.7\n\\end{pmatrix}.\n$$\n仅从以下标准定义出发：(i) $\\mathbf{A}$ 的主特征值 $\\lambda$ 是长期倍增种群增长率，(ii) 稳定年龄（阶段）分布 $\\mathbf{w}$ 是与 $\\lambda$ 相关联的 $\\mathbf{A}$ 的右特征向量，并归一化使得 $\\sum_i w_i = 1$，以及 (iii) 繁殖价值向量 $\\mathbf{v}$ 是与 $\\lambda$ 相关联的左特征向量，并归一化使得 $\\mathbf{v}^{\\top}\\mathbf{w} = 1$，完成以下任务：\n\n1. 推导 $\\mathbf{A}$ 的特征多项式并计算主特征值 $\\lambda$。\n2. 以符号形式推导相应的稳定年龄分布 $\\mathbf{w}$（相差一个标量因子），然后将其归一化，使得各分量之和为 $1$。\n3. 以符号形式推导相应的繁殖价值向量 $\\mathbf{v}$（相差一个标量因子），然后将其归一化，使得 $\\mathbf{v}^{\\top}\\mathbf{w} = 1$。\n\n报告你的最终数值答案为 $\\lambda$ 的值，无单位，四舍五入到四位有效数字。你必须按照描述对 $\\mathbf{w}$ 和 $\\mathbf{v}$ 进行推导，但最终数值答案只需报告 $\\lambda$。",
            "solution": "问题陈述经评估有效。这是一个在数学种群生物学中定义明确的适定问题，其基础是生活史理论和线性代数的既定原则。所有数据均已提供，且定义标准、明确。我们开始求解。\n\n该问题要求针对一个由投影矩阵 $\\mathbf{A}$ 控制的、分为三个阶段的种群，推导其主特征值 $\\lambda$、稳定阶段分布 $\\mathbf{w}$ 和繁殖价值向量 $\\mathbf{v}$。\n\n给定的投影矩阵为：\n$$\n\\mathbf{A} = \\begin{pmatrix}\n0 & 1.2 & 1.5 \\\\\n0.5 & 0 & 0 \\\\\n0 & 0.6 & 0.7\n\\end{pmatrix}\n$$\n\n**1. 特征多项式与主特征值 $\\lambda$ 的推导**\n\n矩阵 $\\mathbf{A}$ 的特征值 $\\lambda$ 是特征方程 $\\det(\\mathbf{A} - \\lambda\\mathbf{I}) = 0$ 的根，其中 $\\mathbf{I}$ 是单位矩阵。\n\n特征行列式为：\n$$\n\\det(\\mathbf{A} - \\lambda\\mathbf{I}) = \\begin{vmatrix}\n-\\lambda & 1.2 & 1.5 \\\\\n0.5 & -\\lambda & 0 \\\\\n0 & 0.6 & 0.7-\\lambda\n\\end{vmatrix} = 0\n$$\n\n我们沿第一列展开行列式：\n$$\n(-\\lambda) \\begin{vmatrix} -\\lambda & 0 \\\\ 0.6 & 0.7-\\lambda \\end{vmatrix} - (0.5) \\begin{vmatrix} 1.2 & 1.5 \\\\ 0.6 & 0.7-\\lambda \\end{vmatrix} + (0) \\begin{vmatrix} 1.2 & 1.5 \\\\ -\\lambda & 0 \\end{vmatrix} = 0\n$$\n$$\n(-\\lambda) \\left( (-\\lambda)(0.7-\\lambda) - (0)(0.6) \\right) - (0.5) \\left( (1.2)(0.7-\\lambda) - (1.5)(0.6) \\right) = 0\n$$\n$$\n(-\\lambda)(-\\lambda(0.7-\\lambda)) - (0.5)(0.84 - 1.2\\lambda - 0.9) = 0\n$$\n$$\n\\lambda^2(0.7-\\lambda) - (0.5)(-0.06 - 1.2\\lambda) = 0\n$$\n$$\n0.7\\lambda^2 - \\lambda^3 + 0.03 + 0.6\\lambda = 0\n$$\n乘以 $-1$ 并重新整理各项，得到标准形式的特征多项式：\n$$\n\\lambda^3 - 0.7\\lambda^2 - 0.6\\lambda - 0.03 = 0\n$$\n这就是该阶段结构模型的 Euler-Lotka 方程。主特征值 $\\lambda$ 是长期种群增长率。根据关于非负、不可约、本原矩阵的 Perron-Frobenius 定理，存在一个唯一的、单重的、正实数特征值，其模大于所有其他特征值的模。矩阵 $\\mathbf{A}$ 是本原矩阵，因为它是不可约的，并且主对角线上有正元素（$a_{33} = 0.7 > 0$）。这个正实根就是主特征值 $\\lambda$。\n\n必须求解这个三次方程的根。数值解法得出一个正实根和两个共轭复根。这个正实根是：\n$$\n\\lambda \\approx 1.214436\n$$\n按最终答案要求，四舍五入到四位有效数字，得到 $\\lambda = 1.214$。\n\n**2. 稳定阶段分布 $\\mathbf{w}$ 的推导**\n\n稳定阶段分布 $\\mathbf{w}$ 是对应于主特征值 $\\lambda$ 的右特征向量，满足 $\\mathbf{A}\\mathbf{w} = \\lambda\\mathbf{w}$，即 $(\\mathbf{A} - \\lambda\\mathbf{I})\\mathbf{w} = \\mathbf{0}$。我们将其写成一个线性方程组：\n$$\n\\begin{pmatrix}\n-\\lambda & 1.2 & 1.5 \\\\\n0.5 & -\\lambda & 0 \\\\\n0 & 0.6 & 0.7-\\lambda\n\\end{pmatrix}\n\\begin{pmatrix} w_1 \\\\ w_2 \\\\ w_3 \\end{pmatrix}\n=\n\\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n这得到以下方程组：\n1.  $-\\lambda w_1 + 1.2 w_2 + 1.5 w_3 = 0$\n2.  $0.5 w_1 - \\lambda w_2 = 0$\n3.  $0.6 w_2 + (0.7-\\lambda) w_3 = 0$\n\n从方程(2)中，我们将 $w_2$ 用 $w_1$ 表示：\n$$ w_2 = \\frac{0.5}{\\lambda} w_1 $$\n从方程(3)中，我们将 $w_3$ 用 $w_2$ 表示：\n$$ w_3 = -\\frac{0.6}{0.7-\\lambda} w_2 = \\frac{0.6}{\\lambda-0.7} w_2 $$\n代入 $w_2$ 的表达式：\n$$ w_3 = \\frac{0.6}{\\lambda-0.7} \\left( \\frac{0.5}{\\lambda} w_1 \\right) = \\frac{0.3}{\\lambda(\\lambda-0.7)} w_1 $$\n因此，特征向量 $\\mathbf{w}$ 与一个向量成比例，我们可以设 $w_1=1$ 来定义其未归一化的形式 $\\mathbf{w}'$：\n$$\n\\mathbf{w}' = \\begin{pmatrix} 1 \\\\ \\frac{0.5}{\\lambda} \\\\ \\frac{0.3}{\\lambda(\\lambda-0.7)} \\end{pmatrix}\n$$\n问题要求进行归一化，使得各分量之和为 $1$，即 $\\sum_i w_i = 1$。令 $S_w = 1 + \\frac{0.5}{\\lambda} + \\frac{0.3}{\\lambda(\\lambda-0.7)}$。归一化后的向量为 $\\mathbf{w} = \\frac{1}{S_w}\\mathbf{w}'$。\n$$\n\\mathbf{w} = \\frac{1}{1 + \\frac{0.5}{\\lambda} + \\frac{0.3}{\\lambda(\\lambda-0.7)}} \\begin{pmatrix} 1 \\\\ \\frac{0.5}{\\lambda} \\\\ \\frac{0.3}{\\lambda(\\lambda-0.7)} \\end{pmatrix}\n$$\n\n**3. 繁殖价值向量 $\\mathbf{v}$ 的推导**\n\n繁殖价值向量 $\\mathbf{v}$ 是与 $\\lambda$ 对应的左特征向量，满足 $\\mathbf{v}^{\\top}\\mathbf{A} = \\lambda\\mathbf{v}^{\\top}$。这等价于 $\\mathbf{A}^{\\top}\\mathbf{v} = \\lambda\\mathbf{v}$，即 $(\\mathbf{A}^{\\top} - \\lambda\\mathbf{I})\\mathbf{v} = \\mathbf{0}$。\n\n$\\mathbf{A}$ 的转置矩阵为：\n$$\n\\mathbf{A}^{\\top} = \\begin{pmatrix}\n0 & 0.5 & 0 \\\\\n1.2 & 0 & 0.6 \\\\\n1.5 & 0 & 0.7\n\\end{pmatrix}\n$$\n方程组为：\n$$\n\\begin{pmatrix}\n-\\lambda & 0.5 & 0 \\\\\n1.2 & -\\lambda & 0.6 \\\\\n1.5 & 0 & 0.7-\\lambda\n\\end{pmatrix}\n\\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{pmatrix}\n=\n\\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n1.  $-\\lambda v_1 + 0.5 v_2 = 0$\n2.  $1.2 v_1 - \\lambda v_2 + 0.6 v_3 = 0$\n3.  $1.5 v_1 + (0.7-\\lambda) v_3 = 0$\n\n从方程(1)中，我们将 $v_2$ 用 $v_1$ 表示：\n$$ v_2 = \\frac{\\lambda}{0.5} v_1 = 2\\lambda v_1 $$\n从方程(3)中，我们将 $v_3$ 用 $v_1$ 表示：\n$$ v_3 = -\\frac{1.5}{0.7-\\lambda} v_1 = \\frac{1.5}{\\lambda-0.7} v_1 $$\n按照惯例，我们设 $v_1=1$ 来获得未归一化的繁殖价值向量 $\\mathbf{v}'$：\n$$\n\\mathbf{v}' = \\begin{pmatrix} 1 \\\\ 2\\lambda \\\\ \\frac{1.5}{\\lambda-0.7} \\end{pmatrix}\n$$\n问题要求归一化，使得 $\\mathbf{v}^{\\top}\\mathbf{w} = 1$。令 $\\mathbf{v} = k\\mathbf{v}'$，其中 $k$ 为某个标量。该条件变为 $k\\mathbf{v}'^{\\top}\\mathbf{w} = 1$，因此归一化常数为 $k = (\\mathbf{v}'^{\\top}\\mathbf{w})^{-1}$。\n\n点积 $\\mathbf{v}'^{\\top}\\mathbf{w}$ 为：\n$$\n\\mathbf{v}'^{\\top}\\mathbf{w} = \\begin{pmatrix} 1 & 2\\lambda & \\frac{1.5}{\\lambda-0.7} \\end{pmatrix} \\left( \\frac{1}{S_w} \\begin{pmatrix} 1 \\\\ \\frac{0.5}{\\lambda} \\\\ \\frac{0.3}{\\lambda(\\lambda-0.7)} \\end{pmatrix} \\right)\n$$\n$$\n= \\frac{1}{S_w} \\left( 1\\cdot 1 + 2\\lambda \\cdot \\frac{0.5}{\\lambda} + \\frac{1.5}{\\lambda-0.7} \\cdot \\frac{0.3}{\\lambda(\\lambda-0.7)} \\right)\n$$\n$$\n= \\frac{1}{S_w} \\left( 1 + 1 + \\frac{0.45}{\\lambda(\\lambda-0.7)^2} \\right) = \\frac{1}{S_w} \\left( 2 + \\frac{0.45}{\\lambda(\\lambda-0.7)^2} \\right)\n$$\n因此，归一化常数为 $k = \\frac{S_w}{2 + \\frac{0.45}{\\lambda(\\lambda-0.7)^2}}$。\n完全归一化后的繁殖价值向量为 $\\mathbf{v} = k\\mathbf{v}'$：\n$$\n\\mathbf{v} = \\frac{1 + \\frac{0.5}{\\lambda} + \\frac{0.3}{\\lambda(\\lambda-0.7)}}{2 + \\frac{0.45}{\\lambda(\\lambda-0.7)^2}} \\begin{pmatrix} 1 \\\\ 2\\lambda \\\\ \\frac{1.5}{\\lambda-0.7} \\end{pmatrix}\n$$\n至此完成了所要求的推导。最终的数值答案是 $\\lambda$ 的值四舍五入到四位有效数字。",
            "answer": "$$\n\\boxed{1.214}\n$$"
        },
        {
            "introduction": "生命史理论的一个核心权衡是如何在整个生命周期中分配资源。本练习将向您揭示，生物体繁殖的“时间”对其适合度的影响，可能与它一生中产生的后代“总数”同样重要。您将通过求解 Euler-Lotka 方程，比较两种具有相同净生殖率 ($R_0$) 但繁殖时间表不同的策略，从而具体理解为何自然选择通常偏爱在增长种群中更早繁殖的策略。",
            "id": "2728454",
            "problem": "您需要实现并应用一种数值方法，来比较具有相同净增殖率的两组生活史策略的内禀增长率。请在一个仅考虑雌性、离散年龄结构、以年为单位的年龄组背景下进行计算。设 $x \\in \\{0,1,2,\\dots,\\omega\\}$ 表示年龄（单位：年），$s_x$ 表示从年龄 $x$ 存活到年龄 $x+1$ 的概率，存活率 $l_x$ 定义为 $l_0 = 1$ 和 $l_{x+1} = l_x s_x$。设 $m_x$ 表示一个在年龄 $x$ 时存活的雌性个体在该确切年龄时产下的雌性后代的期望数量。净增殖率 (NRR) $R_0$ 定义为 $R_0 = \\sum_{x=0}^{\\omega} l_x m_x$。内禀增长率 $r$（单位：每年）被定义为求解离散年龄连续时间指数增长的欧拉-洛特卡平衡方程的唯一实数解：\n$$\n\\sum_{x=0}^{\\omega} l_x m_x e^{-r x} = 1,\n$$\n其中 $x$ 的单位是年，$r$ 的单位是每年。\n\n对于下方的每个测试用例，都通过一个共同的存活概况 $\\{s_x\\}_{x=0}^{\\omega-1}$、一个共同的目标 $R_0$ 以及两个不相交的繁殖年龄集合来指定两种策略：一个“早期”策略 $E$ 和一个“晚期”策略 $L$。对于每种策略 $S \\in \\{E,L\\}$，定义在年龄 $x \\in S$ 时 $m_x^{(S)}$ 的值相等，在其他年龄时为零，其共同值的选取要满足 $\\sum_{x \\in S} l_x m_x^{(S)} = R_0$。也就是说，对于 $S \\in \\{E,L\\}$ 和 $x \\in S$，\n$$\nm_x^{(S)} = \\frac{R_0}{\\sum_{a \\in S} l_a},\n$$\n且对于 $x \\notin S$，$m_x^{(S)} = 0$。\n\n任务：\n- 对于每个测试用例，根据 $s_x$ 计算 $l_x$，按上述方法构建 $m_x^{(E)}$ 和 $m_x^{(L)}$，然后通过求解每个策略的欧拉-洛特卡方程来计算 $r_E$ 和 $r_L$。\n- 报告 $r_E$ 和 $r_L$（单位：每年），并四舍五入到六位小数。\n- 同时报告一个指示符，四舍五入到整数，如果 $r_E > r_L$ 则为 $1$，否则为 $0$。\n- 您的程序应生成单行输出，其中包含一个由列表组成的列表，格式为逗号分隔，每个内部列表为 [$r_E$, $r_L$, 指示符]。例如，一个包含两个用例的输出应如下所示：$[[0.123456,0.012345,1],[0.000000,0.000000,0]]$。\n\n使用以下测试套件。在每个用例中，$s_x$ 以有序列表形式给出，对应于 $x \\in \\{0,\\dots,\\omega-1\\}$，年龄单位为年，$R_0$ 无量纲：\n- 用例 A：\n  - $s_x = [\\,0.7,\\,0.8,\\,0.8,\\,0.75\\,]$ （因此 $\\omega = 4$，年龄范围为 $0$ 到 $4$）。\n  - $R_0 = 1.6$。\n  - $E = \\{\\,1,\\,2\\,\\}$ 和 $L = \\{\\,3,\\,4\\,\\}$。\n- 用例 B：\n  - $s_x = [\\,0.4,\\,0.9,\\,0.95,\\,0.95\\,]$。\n  - $R_0 = 1.2$。\n  - $E = \\{\\,1\\,\\}$ 和 $L = \\{\\,4\\,\\}$。\n- 用例 C：\n  - $s_x = [\\,0.95,\\,0.95,\\,0.95,\\,0.95,\\,0.95,\\,0.95,\\,0.95,\\,0.95,\\,0.95\\,]$ （因此 $\\omega = 9$，年龄范围为 $0$ 到 $9$）。\n  - $R_0 = 1.05$。\n  - $E = \\{\\,2,\\,3\\,\\}$ 和 $L = \\{\\,8,\\,9\\,\\}$。\n- 用例 D（边界条件）：\n  - $s_x = [\\,0.5,\\,0.9,\\,0.9\\,]$。\n  - $R_0 = 1.0$。\n  - $E = \\{\\,1,\\,2\\,\\}$ 和 $L = \\{\\,3\\,\\}$。\n\n角度单位不适用。所有报告的 $r$ 值必须以每年为单位表示，并按要求四舍五入到六位小数。最终的单行输出必须是包含四个内部列表的列表，严格按照上述 A、B、C、D 的顺序排列。",
            "solution": "我们对问题陈述进行了严格评估，并认定其有效。该问题在科学上植根于成熟的人口统计学理论，特别是使用年龄结构模型的生活史理论。问题是适定的，为确定每个用例的唯一解提供了充分且一致的信息。通过离散时间欧拉-洛特卡方程定义的存活率 ($l_x$)、生育率 ($m_x$)、净增殖率 ($R_0$) 以及内禀增长率 ($r$) 都是标准且在数学上合理的。问题是客观的，没有歧义。因此，我们可以进行严谨的解析求解。\n\n问题的核心是找到内禀增长率 $r$，即欧拉-洛特卡方程的唯一实根：\n$$\n\\sum_{x=0}^{\\omega} l_x m_x e^{-r x} = 1\n$$\n这必须在两种不同的繁殖策略下完成，即一个“早期”策略 $E$ 和一个“晚期”策略 $L$，并满足两者产生相同净增殖率 $R_0$ 的约束条件。\n\n对每个测试用例执行以下求解步骤：\n\n1.  **计算存活率列表 ($l_x$)**：\n    存活率列表 $\\{l_x\\}$ 表示从出生（年龄 $0$）到年龄组 $x$ 开始时的存活概率，它是根据所提供的特定年龄存活概率 $\\{s_x\\}$ 计算得出的。我们从存活到年龄 $0$ 是确定的这一公理开始，因此 $l_0 = 1$。对于所有后续年龄 $x \\in \\{0, 1, \\dots, \\omega-1\\}$，存活率通过递推关系计算：\n    $$\n    l_{x+1} = l_x s_x\n    $$\n    这将生成一个从年龄 $0$ 到最大年龄 $\\omega$ 的完整存活率值向量。\n\n2.  **构建生育率列表 ($m_x^{(S)}$)**：\n    对于每种繁殖策略 $S \\in \\{E, L\\}$，生育率 $m_x^{(S)}$ 被定义为：在所有年龄 $x \\in S$ 时为一个常数（我们称之为 $m_S$），而在所有年龄 $x \\notin S$ 时为零。这个常数 $m_S$ 由必须达到净增殖率 $R_0$ 这一约束条件确定。$R_0$ 的定义是 $\\sum_{x=0}^{\\omega} l_x m_x$。对于策略 $S$，这变为：\n    $$\n    R_0 = \\sum_{x \\in S} l_x m_S = m_S \\sum_{x \\in S} l_x\n    $$\n    由此，我们解出该常数生育率值：\n    $$\n    m_S = \\frac{R_0}{\\sum_{a \\in S} l_a}\n    $$\n    此公式分别应用于早期年龄集 $E$ 和晚期年龄集 $L$，以构建两个各自的生育率列表，即 $\\{m_x^{(E)}\\}$ 和 $\\{m_x^{(L)}\\}$。\n\n3.  **求解内禀增长率 ($r$)**：\n    在确定存活率 ($l_x$) 和生育率 ($m_x^{(S)}$) 列表后，我们必须求解欧拉-洛特卡方程以得到内禀增长率 $r_S$。将 $m_x^{(S)}$ 的表达式代入方程中得到：\n    $$\n    \\sum_{x \\in S} l_x \\left( \\frac{R_0}{\\sum_{a \\in S} l_a} \\right) e^{-r_S x} = 1\n    $$\n    整理后，问题变为找到函数 $g_S(r)$ 的根 $r_S$：\n    $$\n    g_S(r) = R_0 \\sum_{x \\in S} l_x e^{-r x} - \\sum_{a \\in S} l_a = 0\n    $$\n    函数 $g_S(r)$ 相对于 $r$ 是单调递减的，因为其导数 $g_S'(r) = -R_0 \\sum_{x \\in S} x l_x e^{-r x}$对于任何非平凡的策略都是严格为负的。这种单调性保证了存在唯一的实根。\n    我们注意到 $g_S(0) = R_0 \\sum_{x \\in S} l_x - \\sum_{a \\in S} l_a = (R_0 - 1) \\sum_{a \\in S} l_a$。\n    -   如果 $R_0 > 1$，则 $g_S(0) > 0$。当 $r \\to \\infty$时，$g_S(r) \\to -\\sum l_a < 0$。因此，存在一个唯一的正根 $r_S$。\n    -   如果 $R_0 < 1$，则 $g_S(0) < 0$。当 $r \\to -\\infty$时，$g_S(r) \\to \\infty$。因此，存在一个唯一的负根 $r_S$。\n    -   如果 $R_0 = 1$，则 $g_S(0) = 0$，这立即得出解 $r_S = 0$。\n\n    对于 $R_0 \\neq 1$ 的情况，需要使用数值求根算法。二分法，或更高效的 Brent 方法，适用于在指定区间内找到这个良态单调函数的根。对 $g_S(0)$ 的分析为选择合适的搜索区间提供了信息，例如对于 $R_0 > 1$ 选择 $[0, A]$，对于 $R_0 < 1$ 选择 $[-A, 0]$，其中 $A$ 是一个足够大的正常数。\n\n4.  **最终比较与报告**：\n    在为每个测试用例计算出 $r_E$ 和 $r_L$ 后，对这些值进行比较。设置一个指示符变量，如果 $r_E > r_L$ 则为 $1$，否则为 $0$。将 $r_E$ 和 $r_L$ 的值四舍五入到六位小数，并将结果编译成指定的列表的列表格式以供输出。对所有提供的测试用例重复此过程。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Implements and applies a numerical method to compare intrinsic rates of increase \n    for pairs of life-history schedules sharing the same net reproductive rate.\n    \"\"\"\n    test_cases = [\n        {\n            # Case A\n            \"s_x\": [0.7, 0.8, 0.8, 0.75],\n            \"R0\": 1.6,\n            \"E\": {1, 2},\n            \"L\": {3, 4}\n        },\n        {\n            # Case B\n            \"s_x\": [0.4, 0.9, 0.95, 0.95],\n            \"R0\": 1.2,\n            \"E\": {1},\n            \"L\": {4}\n        },\n        {\n            # Case C\n            \"s_x\": [0.95] * 9,\n            \"R0\": 1.05,\n            \"E\": {2, 3},\n            \"L\": {8, 9}\n        },\n        {\n            # Case D (boundary condition)\n            \"s_x\": [0.5, 0.9, 0.9],\n            \"R0\": 1.0,\n            \"E\": {1, 2},\n            \"L\": {3}\n        }\n    ]\n\n    # This list will store the string-formatted result for each case\n    all_results_str = []\n\n    for case in test_cases:\n        s_x_list = case[\"s_x\"]\n        R0 = case[\"R0\"]\n        E = case[\"E\"]\n        L = case[\"L\"]\n        \n        omega = len(s_x_list)\n        s_x = np.array(s_x_list)\n        \n        # 1. Compute survivorship schedule l_x\n        l_x = np.zeros(omega + 1)\n        l_x[0] = 1.0\n        for x in range(omega):\n            l_x[x+1] = l_x[x] * s_x[x]\n\n        def calculate_r(schedule_ages, R0_val, lx_vals):\n            \"\"\"\n            Calculates the intrinsic rate of increase 'r' for a given schedule.\n            \n            Args:\n                schedule_ages (set): The set of ages for reproduction.\n                R0_val (float): The net reproductive rate.\n                lx_vals (np.ndarray): The survivorship schedule.\n\n            Returns:\n                float: The intrinsic rate of increase, r.\n            \"\"\"\n            # Handle boundary case where R_0 = 1, which implies r = 0\n            if np.isclose(R0_val, 1.0):\n                return 0.0\n\n            ages = np.array(list(schedule_ages))\n            sum_l = np.sum(lx_vals[ages])\n\n            # Define the function whose root we need to find, based on the Euler-Lotka equation:\n            # g(r) = R0 * sum(l_x * exp(-r*x)) - sum(l_x) = 0\n            def euler_lotka_func(r):\n                return R0_val * np.sum(lx_vals[ages] * np.exp(-r * ages)) - sum_l\n\n            # Find the root numerically using Brent's method\n            # The search interval is determined by whether R0 > 1 (r > 0) or R0  1 (r  0)\n            if R0_val > 1.0:\n                # For R0 > 1, r is positive. g(0) is positive, and g(r) decreases.\n                # A sufficiently large upper bound ensures the function becomes negative.\n                bracket = [0.0, 10.0]\n            else: # R0_val  1.0\n                # For R0  1, r is negative. g(0) is negative, and g(r) increases as r becomes more negative.\n                bracket = [-10.0, 0.0]\n            \n            try:\n                # Use a tight tolerance for high accuracy before rounding\n                r_val = brentq(euler_lotka_func, bracket[0], bracket[1], xtol=1e-12, rtol=1e-12)\n            except ValueError:\n                # This should not happen for a valid problem setup\n                r_val = np.nan\n                \n            return r_val\n\n        # 2. Compute r_E and r_L for the early and late schedules\n        r_E = calculate_r(E, R0, l_x)\n        r_L = calculate_r(L, R0, l_x)\n        \n        # 3. Compute the indicator\n        # Note: Direct comparison is safe here as we are not checking for equality\n        indicator = 1 if r_E > r_L else 0\n        \n        # 4. Format results as a string and append to the list\n        case_result_str = f\"[{r_E:.6f},{r_L:.6f},{indicator}]\"\n        all_results_str.append(case_result_str)\n\n    # 5. Print the final combined output in the specified single-line format\n    print(f\"[{','.join(all_results_str)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "自然选择作用于生命史性状，但并非所有性状对适合度的影响都相同。扰动分析，特别是弹性分析 (elasticity analysis)，可以量化存活率或繁殖力等生命率的微小变化对种群增长率 ($\\lambda$) 的相对影响。在本练习中，您将应用弹性分析来预测在不同生命史策略下，哪些性状会受到最强的选择压力，从而学会如何利用矩阵模型的输出来构建和检验关于生命史演化方向的假说。",
            "id": "2728457",
            "problem": "考虑一个具有三个离散阶段的阶段结构种群：幼年个体 ($1$)、亚成年个体 ($2$) 和成年个体 ($3$)。假设低密度下的动态是密度无关的，因此长期人均增长率（适应度代理）由阶段结构种群投影矩阵的主特征值 $\\,\\lambda\\,$ 给出。生命率参数化如下：在一个时间步内，幼年个体有概率 $g_{1}$ 保持为幼年个体，或有概率 $m_{1}$ 发育为亚成年个体；亚成年个体有概率 $g_{2}$ 保持为亚成年个体，或有概率 $m_{2}$ 发育为成年个体；成年个体有概率 $g_{3}$ 存活并保持为成年个体；成年个体产生 $F$ 个新生个体进入幼年阶段。\n\n两种生活史在幼年存活率和成年繁殖力方面有所不同，但保留了相同的亚成年和成年阶段转换：\n- 生活史 $1$：$g_{1} = 0.05$, $m_{1} = 0.30$, $g_{2} = 0.30$, $m_{2} = 0.50$, $g_{3} = 0.60$, $F = 6$。\n- 生活史 $2$：$g_{1} = 0.40$, $m_{1} = 0.30$, $g_{2} = 0.30$, $m_{2} = 0.50$, $g_{3} = 0.60$, $F = 2$。\n\n因此，种群投影矩阵为\n$$\n\\mathbf{A}_{1} \\;=\\; \n\\begin{pmatrix}\n0.05  0  6 \\\\\n0.30  0.30  0 \\\\\n0  0.50  0.60\n\\end{pmatrix},\n\\qquad\n\\mathbf{A}_{2} \\;=\\; \n\\begin{pmatrix}\n0.40  0  2 \\\\\n0.30  0.30  0 \\\\\n0  0.50  0.60\n\\end{pmatrix}.\n$$\n\n从结构化种群理论的核心定义出发，对每种生活史执行以下操作：\n1. 计算主特征值 $\\,\\lambda\\,$ 及其相关的右特征向量 $\\,\\mathbf{w}\\,$（稳定阶段分布）和左特征向量 $\\,\\mathbf{v}\\,$（繁殖价值向量），仅在评估敏感度需要时进行归一化。\n2. 使用弹性作为 $\\,\\lambda\\,$ 对生命率（矩阵元素）成比例变化的比例敏感度的正式定义，计算 $\\,\\lambda\\,$ 对成年繁殖力 $F$（即元素 $a_{13}$）和对幼年个体停滞率 $g_{1}$（即元素 $a_{11}$）的弹性。对每种生活史，将这些弹性表示为 $e_{F}$ 和 $e_{g_{1}}$。\n3. 根据弹性，预测对于每种生活史，在低密度下哪种生命率变化（$F$ 的小比例增加与 $g_{1}$ 的小比例增加相比）最受自然选择的青睐，其标准假设是当成本以比例尺度衡量时，自然选择会沿着最大弹性的方向最快地增加 $\\,\\lambda\\,$。\n\n最后，报告单个数值\n$$\nR \\;=\\; \\frac{e_{F}^{(1)}}{e_{g_{1}}^{(1)}},\n$$\n其中上标 $(1)$ 表示生活史 $1$。将您报告的 $R$ 值四舍五入到四位有效数字。将最终答案表示为无单位的纯数。",
            "solution": "该问题要求使用阶段结构种群投影矩阵对两种生活史进行分析。此分析的核心依赖于这些矩阵的特征值和特征向量的性质。\n\n设 $\\mathbf{A}$ 为一个种群投影矩阵，其中元素 $a_{ij}$ 表示在一个时间步内，阶段 $j$ 的个体对阶段 $i$ 的人均贡献。长期的、密度无关的种群动态由主特征值 $\\lambda$ 及其对应的右特征向量 $\\mathbf{w}$ 和左特征向量 $\\mathbf{v}$ 描述。\n$$ \\mathbf{A} \\mathbf{w} = \\lambda \\mathbf{w} \\quad \\text{与} \\quad \\mathbf{v}^T \\mathbf{A} = \\lambda \\mathbf{v}^T $$\n在这里，$\\lambda$ 是渐近种群增长率，$\\mathbf{w}$ 是稳定阶段分布（每个阶段个体的比例丰度），$\\mathbf{v}$ 是繁殖价值向量（每个阶段的个体对未来种群增长的相对贡献）。\n\n种群增长率 $\\lambda$ 对矩阵元素 $a_{ij}$ 变化的敏感度由下式给出\n$$ s_{ij} = \\frac{\\partial \\lambda}{\\partial a_{ij}} = \\frac{v_i w_j}{\\langle \\mathbf{v}, \\mathbf{w} \\rangle} $$\n其中 $\\langle \\mathbf{v}, \\mathbf{w} \\rangle = \\sum_k v_k w_k$ 是左、右特征向量的标量积。弹性 $e_{ij}$ 是比例敏感度，它衡量 $\\lambda$ 对 $a_{ij}$ 成比例变化的比例变化：\n$$ e_{ij} = \\frac{a_{ij}}{\\lambda} \\frac{\\partial \\lambda}{\\partial a_{ij}} = \\frac{a_{ij}}{\\lambda} \\frac{v_i w_j}{\\langle \\mathbf{v}, \\mathbf{w} \\rangle} $$\n弹性用于评估不同生命率对种群增长的相对重要性。低密度下的自然选择将最强烈地倾向于具有最高弹性的生命率的变化。\n\n该三阶段系统的种群投影矩阵的一般形式为\n$$ \\mathbf{A} = \\begin{pmatrix} g_1  0  F \\\\ m_1  g_2  0 \\\\ 0  m_2  g_3 \\end{pmatrix} $$\n特征方程为 $\\det(\\mathbf{A} - \\lambda \\mathbf{I}) = 0$，展开后为：\n$$ (g_1 - \\lambda)(g_2 - \\lambda)(g_3 - \\lambda) + F m_1 m_2 = 0 $$\n$$ (\\lambda - g_1)(\\lambda - g_2)(\\lambda - g_3) = F m_1 m_2 $$\n\n我们现在将此框架应用于每种生活史。\n\n**生活史 1 的分析**\n矩阵为\n$$ \\mathbf{A}_{1} = \\begin{pmatrix} 0.05  0  6 \\\\ 0.30  0.30  0 \\\\ 0  0.50  0.60 \\end{pmatrix} $$\n参数为 $g_1 = 0.05$, $m_1 = 0.30$, $g_2 = 0.30$, $m_2 = 0.50$, $g_3 = 0.60$ 以及 $F = 6$。特征方程为\n$$ (\\lambda - 0.05)(\\lambda - 0.30)(\\lambda - 0.60) = (6)(0.30)(0.50) = 0.9 $$\n$$ \\lambda^3 - 0.95\\lambda^2 + 0.225\\lambda - 0.909 = 0 $$\n对此三次方程进行数值求解，得到主根（最大的正实根）为 $\\lambda_1 \\approx 1.30896$。\n\n为求右特征向量 $\\mathbf{w}^{(1)}$，我们求解 $(\\mathbf{A}_1 - \\lambda_1 \\mathbf{I})\\mathbf{w}^{(1)} = \\mathbf{0}$。我们设 $w_1 = 1$：\n根据第二行：$0.30 w_1 + (0.30 - \\lambda_1) w_2 = 0 \\implies w_2 = \\frac{0.30}{\\lambda_1 - 0.30} w_1 = \\frac{0.30}{1.30896 - 0.30} \\approx 0.29734$。\n根据第三行：$0.50 w_2 + (0.60 - \\lambda_1) w_3 = 0 \\implies w_3 = \\frac{0.50}{\\lambda_1 - 0.60} w_2 = \\frac{0.50}{1.30896 - 0.60} (0.29734) \\approx 0.20969$。\n所以，$\\mathbf{w}^{(1)} \\propto \\begin{pmatrix} 1 \\\\ 0.29734 \\\\ 0.20969 \\end{pmatrix}$。\n\n为求左特征向量 $\\mathbf{v}^{(1)}$，我们求解 $\\mathbf{v}^{(1)T}(\\mathbf{A}_1 - \\lambda_1 \\mathbf{I}) = \\mathbf{0}^T$。我们设 $v_1=1$：\n根据第一列：$(0.05 - \\lambda_1) v_1 + 0.30 v_2 = 0 \\implies v_2 = \\frac{\\lambda_1 - 0.05}{0.30} v_1 = \\frac{1.30896 - 0.05}{0.30} \\approx 4.19653$。\n根据第二列：$(0.30 - \\lambda_1) v_2 + 0.50 v_3 = 0 \\implies v_3 = \\frac{\\lambda_1 - 0.30}{0.50} v_2 = \\frac{1.30896 - 0.30}{0.50} (4.19653) \\approx 8.46823$。\n所以，$\\mathbf{v}^{(1)T} \\propto \\begin{pmatrix} 1  4.19653  8.46823 \\end{pmatrix}$。\n\n标量积为：\n$$ \\langle \\mathbf{v}^{(1)}, \\mathbf{w}^{(1)} \\rangle = (1)(1) + (4.19653)(0.29734) + (8.46823)(0.20969) \\approx 1 + 1.24783 + 1.77573 \\approx 4.02359 $$\n\n弹性为：\n$e_{F}^{(1)} = e_{13}^{(1)} = \\frac{a_{13}^{(1)}}{\\lambda_1} \\frac{v_1^{(1)} w_3^{(1)}}{\\langle \\mathbf{v}^{(1)}, \\mathbf{w}^{(1)} \\rangle} = \\frac{6}{1.30896} \\frac{(1)(0.20969)}{4.02359} \\approx 4.5835 \\times 0.05212 \\approx 0.23891$。\n$e_{g_1}^{(1)} = e_{11}^{(1)} = \\frac{a_{11}^{(1)}}{\\lambda_1} \\frac{v_1^{(1)} w_1^{(1)}}{\\langle \\mathbf{v}^{(1)}, \\mathbf{w}^{(1)} \\rangle} = \\frac{0.05}{1.30896} \\frac{(1)(1)}{4.02359} \\approx 0.03819 \\times 0.24853 \\approx 0.009492$。\n\n由于 $e_{F}^{(1)} (0.23891)  e_{g_1}^{(1)} (0.009492)$，与幼年个体停滞率 $g_1$ 的同样比例增加相比，成年繁殖力 $F$ 的小比例增加将更受自然选择的青睐。\n\n**生活史 2 的分析**\n矩阵为\n$$ \\mathbf{A}_{2} = \\begin{pmatrix} 0.40  0  2 \\\\ 0.30  0.30  0 \\\\ 0  0.50  0.60 \\end{pmatrix} $$\n特征方程为 $(\\lambda - 0.40)(\\lambda - 0.30)(\\lambda - 0.60) = (2)(0.30)(0.50) = 0.3$。\n$$ \\lambda^3 - 1.3\\lambda^2 + 0.54\\lambda - 0.372 = 0 $$\n主特征值为 $\\lambda_2 \\approx 1.11538$。遵循与生活史 1 类似的计算：\n$\\mathbf{w}^{(2)} \\propto \\begin{pmatrix} 1 \\\\ 0.3680 \\\\ 0.3570 \\end{pmatrix}$，$\\mathbf{v}^{(2)T} \\propto \\begin{pmatrix} 1  2.3846  3.8893 \\end{pmatrix}$。\n标量积为 $\\langle \\mathbf{v}^{(2)}, \\mathbf{w}^{(2)} \\rangle \\approx 3.2657$。\n弹性为：\n$e_{F}^{(2)} = e_{13}^{(2)} = \\frac{2}{1.11538} \\frac{(1)(0.3570)}{3.2657} \\approx 0.1962$。\n$e_{g_1}^{(2)} = e_{11}^{(2)} = \\frac{0.40}{1.11538} \\frac{(1)(1)}{3.2657} \\approx 0.1098$。\n由于 $e_{F}^{(2)} (0.1962)  e_{g_1}^{(2)} (0.1098)$，自然选择同样会更强烈地倾向于繁殖力 $F$ 的比例增加。\n\n**R 的最终计算**\n问题要求计算比率 $R = \\frac{e_{F}^{(1)}}{e_{g_{1}}^{(1)}} = \\frac{e_{13}^{(1)}}{e_{11}^{(1)}}$。\n使用弹性的定义：\n$$ R = \\frac{\\frac{a_{13}^{(1)}}{\\lambda_1} \\frac{v_1^{(1)} w_3^{(1)}}{\\langle \\mathbf{v}^{(1)}, \\mathbf{w}^{(1)} \\rangle}}{\\frac{a_{11}^{(1)}}{\\lambda_1} \\frac{v_1^{(1)} w_1^{(1)}}{\\langle \\mathbf{v}^{(1)}, \\mathbf{w}^{(1)} \\rangle}} = \\frac{a_{13}^{(1)}}{a_{11}^{(1)}} \\frac{w_3^{(1)}}{w_1^{(1)}} = \\frac{F_1}{g_1^{(1)}} \\frac{w_3^{(1)}}{w_1^{(1)}} $$\n此表达式避免了计算左特征向量 $\\mathbf{v}$ 和标量积。从特征向量方程 $\\mathbf{A}_1 \\mathbf{w}^{(1)} = \\lambda_1 \\mathbf{w}^{(1)}$ 的第一行得出：\n$$ a_{11}^{(1)} w_1^{(1)} + a_{13}^{(1)} w_3^{(1)} = \\lambda_1 w_1^{(1)} \\implies F_1 w_3^{(1)} = (\\lambda_1 - g_1^{(1)}) w_1^{(1)} $$\n将此代入 R 的表达式中：\n$$ R = \\frac{1}{g_1^{(1)}} \\left( F_1 \\frac{w_3^{(1)}}{w_1^{(1)}} \\right) = \\frac{1}{g_1^{(1)}} (\\lambda_1 - g_1^{(1)}) = \\frac{\\lambda_1 - g_1^{(1)}}{g_1^{(1)}} $$\n这提供了一种更直接、更稳健的计算 $R$ 的方法，仅使用主特征值 $\\lambda_1$ 和参数 $g_1^{(1)}$。\n使用精确计算的值 $\\lambda_1 \\approx 1.30896$：\n$$ R = \\frac{1.30896 - 0.05}{0.05} = \\frac{1.25896}{0.05} = 25.1792 $$\n四舍五入到四位有效数字，结果是 $25.18$。\n该值与完整弹性计算得出的比率一致：$R \\approx \\frac{0.23891}{0.009492} \\approx 25.17$。",
            "answer": "$$ \\boxed{25.18} $$"
        }
    ]
}