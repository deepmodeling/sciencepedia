{
    "hands_on_practices": [
        {
            "introduction": "理解连锁不平衡（LD）如何随时间衰减是群体遗传学的基石。本练习将引导你从第一性原理出发，通过严格考虑随机交配和减数分裂过程，推导出描述连锁不平衡衰减的核心动力学方程。通过这个基础练习 ，你将亲自验证重组是如何以几何级数的方式逐步侵蚀等位基因间的非随机关联的。",
            "id": "2699687",
            "problem": "在一个有效无限大、随机交配、世代离散且不重叠的种群中，考虑两个二等位基因座，记为 $A/a$ 和 $B/b$。假设没有选择、没有突变、没有迁移。设第 $t$ 代的四种配子（单倍型）频率为 $x_{AB,t}$、$x_{Ab,t}$、$x_{aB,t}$ 和 $x_{ab,t}$，它们的和为 $1$。定义边缘等位基因频率为 $p_{A,t} = x_{AB,t} + x_{Ab,t}$ 和 $p_{B,t} = x_{AB,t} + x_{aB,t}$，并定义连锁不平衡（LD）为 $D_t = x_{AB,t} - p_{A,t} p_{B,t}$。两个基因座之间的重组率是一个常数 $r \\in [0,1/2]$。\n\n仅使用以上定义和假设，通过明确计算在随机交配下形成的每种二倍体基因型产生的重组和非重组配子，从第一性原理推导关联 $D_{t+1}$ 与 $D_t$ 和 $r$ 的单代递推关系。然后，将你的结果特化到非连锁情况 $r = 0.5$，并展示从 $D_t$ 到 $D_{t+1}$ 的映射关系。\n\n最后，从一个任意非零的 $D_0$ 开始，确定所需的最小整数代数 $t$，使得连锁不平衡的绝对值减少了其初始值的 $0.99$ 以上，即 $|D_t| < 0.01\\,|D_0|$。报告这个最小整数。",
            "solution": "所述问题是理论群体遗传学中的一个基本练习。它具有科学依据、问题良定、客观，并包含了获得唯一解所需的所有信息。这些定义和假设是推导连锁不平衡衰减的标准。因此，该问题是有效的，我将着手解答。\n\n该问题要求三个不同的结果：首先，推导连锁不平衡 $D$ 的单代递推关系；其次，将此递推关系特化到非连锁基因座的情况；第三，计算在非连锁条件下，连锁不平衡衰减超过指定量所需的代数。\n\n让我们从推导 $D_t$ 的递推关系开始。\n第 $t$ 代的连锁不平衡定义为 $D_t = x_{AB,t} - p_{A,t} p_{B,t}$。为了找到 $D_t$ 的递推关系，我们必须找到 $D_{t+1}$ 的表达式。这需要找到第 $t+1$ 代中 $AB$ 配子的频率 $x_{AB, t+1}$，以及第 $t+1$ 代的等位基因频率 $p_{A, t+1}$ 和 $p_{B, t+1}$。\n\n第 $t+1$ 代的配子是由第 $t+1$ 代的二倍体个体产生的，这些个体由第 $t$ 代的配子随机结合形成。任何二倍体基因型的频率是形成它的两个配子频率的乘积。我们必须系统地计算所有可能的亲本基因型对 $AB$ 配子的产生。基因座之间的重组率为 $r$。\n\n第 $t+1$ 代 $AB$ 配子的频率，记为 $x_{AB,t+1}$，是第 $t+1$ 代中所有二倍体基因型贡献的总和。能够产生 $AB$ 配子的相关基因型有：\n$1$. 基因型 $AB/AB$：频率为 $x_{AB,t}^2$。只产生 $AB$ 配子。\n$2$. 基因型 $AB/Ab$：频率为 $2x_{AB,t}x_{Ab,t}$。等比例产生 $AB$ 和 $Ab$ 配子，所以 $AB$ 配子的比例是 $1/2$。\n$3$. 基因型 $AB/aB$：频率为 $2x_{AB,t}x_{aB,t}$。等比例产生 $AB$ 和 $aB$ 配子，所以 $AB$ 配子的比例是 $1/2$。\n$4$. 基因型 $AB/ab$（连锁相双杂合子）：频率为 $2x_{AB,t}x_{ab,t}$。以 $1-r$ 的概率产生非重组配子（$AB$、$ab$），以 $r$ 的概率产生重组配子（$Ab$、$aB$）。产生的 $AB$ 配子比例为 $(1-r)/2$。\n$5$. 基因型 $Ab/aB$（相斥相双杂合子）：频率为 $2x_{Ab,t}x_{aB,t}$。以 $1-r$ 的概率产生非重组配子（$Ab$、$aB$），以 $r$ 的概率产生重组配子（$AB$、$ab$）。产生的 $AB$ 配子比例为 $r/2$。\n\n将这些基因型对第 $t+1$ 代配子库的贡献相加：\n$$x_{AB,t+1} = (x_{AB,t}^2)(1) + (2x_{AB,t}x_{Ab,t})\\left(\\frac{1}{2}\\right) + (2x_{AB,t}x_{aB,t})\\left(\\frac{1}{2}\\right) + (2x_{AB,t}x_{ab,t})\\left(\\frac{1-r}{2}\\right) + (2x_{Ab,t}x_{aB,t})\\left(\\frac{r}{2}\\right)$$\n$$x_{AB,t+1} = x_{AB,t}^2 + x_{AB,t}x_{Ab,t} + x_{AB,t}x_{aB,t} + (1-r)x_{AB,t}x_{ab,t} + r x_{Ab,t}x_{aB,t}$$\n为简化，我们加上并减去项 $r x_{AB,t}x_{ab,t}$：\n$$x_{AB,t+1} = x_{AB,t}^2 + x_{AB,t}x_{Ab,t} + x_{AB,t}x_{aB,t} + x_{AB,t}x_{ab,t} - r x_{AB,t}x_{ab,t} + r x_{Ab,t}x_{aB,t}$$\n我们可以从前四项中提取公因式 $x_{AB,t}$：\n$$x_{AB,t+1} = x_{AB,t}(x_{AB,t} + x_{Ab,t} + x_{aB,t} + x_{ab,t}) - r(x_{AB,t}x_{ab,t} - x_{Ab,t}x_{aB,t})$$\n所有配子频率之和为 $1$，所以 $x_{AB,t} + x_{Ab,t} + x_{aB,t} + x_{ab,t} = 1$。项 $x_{AB,t}x_{ab,t} - x_{Ab,t}x_{aB,t}$ 是在随机交配下成立的连锁不平衡的另一种定义。可以证明它等于 $D_t = x_{AB,t} - p_{A,t}p_{B,t}$。因此，我们有：\n$$x_{AB,t+1} = x_{AB,t} - r D_t$$\n接下来，我们必须确定等位基因频率 $p_{A,t+1}$ 和 $p_{B,t+1}$。在没有选择、突变和迁移的情况下，等位基因频率预期是恒定的。我们将证明这一点。\n第 $t+1$ 代等位基因 $A$ 的频率是 $p_{A,t+1} = x_{AB,t+1} + x_{Ab,t+1}$。我们通过与 $x_{AB,t+1}$ 的对称性推导 $x_{Ab,t+1}$ 的递推关系。重组分解 $AB/ab$ 基因型形成 $Ab$，并使 $Ab/aB$ 基因型不形成 $Ab$。对于重组单倍型，$D_t$ 项的符号是相反的。\n$$x_{Ab,t+1} = x_{Ab,t} + r D_t$$\n类似地，$x_{aB,t+1} = x_{aB,t} + r D_t$ 和 $x_{ab,t+1} = x_{ab,t} - r D_t$。\n现在，我们计算 $p_{A,t+1}$：\n$$p_{A,t+1} = x_{AB,t+1} + x_{Ab,t+1} = (x_{AB,t} - r D_t) + (x_{Ab,t} + r D_t) = x_{AB,t} + x_{Ab,t} = p_{A,t}$$\n以及 $p_{B,t+1}$：\n$$p_{B,t+1} = x_{AB,t+1} + x_{aB,t+1} = (x_{AB,t} - r D_t) + (x_{aB,t} + r D_t) = x_{AB,t} + x_{aB,t} = p_{B,t}$$\n等位基因频率在各代中保持不变。令 $p_A = p_{A,t}$ 和 $p_B = p_{B,t}$ 对所有 $t$ 成立。\n\n现在我们可以写出 $D_{t+1}$ 的表达式：\n$$D_{t+1} = x_{AB,t+1} - p_{A,t+1}p_{B,t+1}$$\n代入我们的结果：\n$$D_{t+1} = (x_{AB,t} - r D_t) - p_A p_B = (x_{AB,t} - p_A p_B) - r D_t$$\n认识到 $D_t = x_{AB,t} - p_A p_B$，我们得到连锁不平衡的单代递推关系：\n$$D_{t+1} = D_t - r D_t = (1-r)D_t$$\n这是第一个要求的结果。\n\n对于第二部分，我们将此结果特化到非连锁基因座的情况，此时 $r=1/2 = 0.5$。\n$$D_{t+1} = (1 - 0.5)D_t = 0.5 D_t$$\n从 $D_t$ 到 $D_{t+1}$ 的映射关系是减少一半。这表明对于非连锁基因座，连锁不平衡在每一代随机交配后减半。\n\n对于第三部分，我们必须找到使连锁不平衡的量值减少超过 $99\\%$ 所需的最小整数代数 $t$。这意味着对于一个任意的初始非零不平衡 $D_0$，我们需要 $|D_t| < 0.01 |D_0|$。该情况被指定为非连锁，所以我们使用递推关系 $D_{t+1} = 0.5 D_t$。\n这是一个一阶线性齐次递推关系。其解是一个等比数列：\n$$D_t = (0.5)^t D_0$$\n我们应用这个条件：\n$$|D_0 (0.5)^t| < 0.01 |D_0|$$\n因为 $D_0$ 非零，我们可以除以 $|D_0|$：\n$$(0.5)^t < 0.01$$\n$$(\\frac{1}{2})^t < \\frac{1}{100}$$\n$$2^{-t} < 10^{-2}$$\n为解出 $t$，我们对两边取自然对数。\n$$\\ln(2^{-t}) < \\ln(10^{-2})$$\n$$-t \\ln(2) < -2 \\ln(10)$$\n乘以 $-1$ 会使不等号反向：\n$$t \\ln(2) > 2 \\ln(10)$$\n$$t > \\frac{2 \\ln(10)}{\\ln(2)}$$\n或者，从 $2^t > 100$，我们可以用以 2 为底的对数表示：$t > \\log_2(100)$。\n我们知道 $2^6 = 64$ 和 $2^7 = 128$。\n由于 $64 < 100 < 128$，显然 $6 < \\log_2(100) < 7$。\n具体值为 $\\log_2(100) = \\frac{\\ln(100)}{\\ln(2)} = \\frac{2\\ln(10)}{\\ln(2)} \\approx \\frac{2 \\times 2.3026}{0.6931} \\approx 6.6439$。\n问题要求满足不等式 $t > 6.6439$ 的最小整数 $t$。大于此值的最小整数是 $7$。\n因此，对于非连锁基因座，连锁不平衡衰减到其初始值的 1% 以下至少需要 $7$ 代。\n检验：\n当 $t=6$ 时：$|D_6|/|D_0| = (0.5)^6 = 1/64 = 0.015625$，不小于 $0.01$。\n当 $t=7$ 时：$|D_7|/|D_0| = (0.5)^7 = 1/128 = 0.0078125$，小于 $0.01$。\n最小整数代数确实是 $7$。",
            "answer": "$$\\boxed{7}$$"
        },
        {
            "introduction": "在掌握了连锁不平衡的时间衰减规律后，下一个关键步骤是将其与基因组的物理结构联系起来。本练习不再将重组率 $r$ 视为一个抽象常数，而是将其建模为染色体上物理距离的函数。你将使用经典的 Haldane 作图函数 ，将交叉事件的发生率与可观测的重组率联系起来，从而学习如何预测连锁不平衡沿染色体的空间分布模式。",
            "id": "2699675",
            "problem": "考虑一个大的、随机交配的二倍体群体，该群体有两个双等位基因座，在一个染色体上相隔物理距离 $x$。假设没有选择、没有突变、也没有遗传漂变。设两个基因座在第 $t=0$ 代的初始连锁不平衡 (LD) 为 $D_0$，而在第 $t$ 代且分离距离为 $x$ 时的 LD 用 $D(x,t)$ 表示。重组以每碱基恒定的交换率 $\\rho$（每次减数分裂中每碱基的交换次数）沿染色体发生。交换被假设为遵循无干涉的泊松过程，因此两个基因座之间的重组率 $r(x)$ 作为物理距离 $x$ 的函数，由 Haldane 作图函数给出。该函数是图距 $d(x)$（单位为摩根）的函数，其中 $d(x)=\\rho x$。\n\n从重组在随机交配下如何重塑单倍型频率的第一性原理出发，并利用 Haldane 函数将物理距离与重组率联系起来，推导一个闭式解析表达式，用于计算经过 $t$ 代后由条件 $D(x_{1/2},t)=D_0/2$ 隐式定义的 LD 半距离 $x_{1/2}(t)$。请用 $\\rho$ 和 $t$ 表示你的最终答案。不要使用近似值，也不要代入数值。无需四舍五入。给出 $x_{1/2}(t)$ 的最终表达式，不带单位。",
            "solution": "所述问题具有科学依据，提法明确且客观。它基于群体遗传学中的经典模型，并包含了获得唯一解所需的所有信息。因此，我们将进行推导。\n\n第一性原理是在一个大的、随机交配的、且没有其他演化力作用的群体中，连锁不平衡 ($LD$) 会因重组而衰减。设 $D_t$ 为第 $t$ 代的连锁不平衡，$r$ 为两个基因座之间的重组率。下一代（$D_{t+1}$）的 LD 值通过以下递推关系与其当前值相关联：\n$$D_{t+1} = (1-r)D_t$$\n这个关系之所以成立，是因为双杂合子产生的配子中有 $r$ 的比例是重组的，这打破了等位基因的非随机关联。从 $t=0$ 时的初始状态 $D_0$ 开始，解这个跨越 $t$ 代的递推关系，得到：\n$$D_t = (1-r)^t D_0$$\n问题指明，重组率 $r$ 是基因座间物理距离 $x$ 的函数，而 LD 是距离 $x$ 和时间 $t$ 的函数。因此，我们将方程写为：\n$$D(x,t) = (1-r(x))^t D_0$$\n第二个原理是将重组率 $r(x)$ 与物理距离 $x$ 联系起来。问题陈述，交换以每碱基 $\\rho$ 的速率发生，并遵循泊松过程。相距为 $x$ 的两个基因座之间的平均交换次数是图距 $d(x)$，由 $d(x) = \\rho x$ 给出。问题要求使用 Haldane 作图函数，该函数将图距 $d$ 与重组率 $r$ 联系起来。该函数是通过注意到如果基因座之间发生奇数次交换，就会产生重组配子而推导出来的。对于均值为 $d$ 的泊松过程，发生恰好 $k$ 次交换的概率是 $P(k) = \\frac{d^k e^{-d}}{k!}$。重组率是所有奇数 $k$ 的概率之和：\n$$r(d) = \\sum_{k=0}^{\\infty} P(2k+1) = e^{-d} \\sum_{k=0}^{\\infty} \\frac{d^{2k+1}}{(2k+1)!} = e^{-d} \\sinh(d)$$\n利用双曲正弦的定义 $\\sinh(d) = \\frac{e^d - e^{-d}}{2}$，我们得到 Haldane 函数：\n$$r(d) = e^{-d} \\left( \\frac{e^d - e^{-d}}{2} \\right) = \\frac{1 - e^{-2d}}{2}$$\n将 $d(x) = \\rho x$ 代入此表达式，得到重组率作为物理距离 $x$ 的函数：\n$$r(x) = \\frac{1}{2} (1 - \\exp(-2\\rho x))$$\n现在，我们将这个 $r(x)$ 的表达式代回到 LD 衰减的方程中：\n$$D(x,t) = \\left( 1 - \\frac{1}{2}(1 - \\exp(-2\\rho x)) \\right)^t D_0$$\n化简括号内的项得到：\n$$1 - \\frac{1}{2} + \\frac{1}{2}\\exp(-2\\rho x) = \\frac{1}{2} + \\frac{1}{2}\\exp(-2\\rho x) = \\frac{1}{2}(1 + \\exp(-2\\rho x))$$\n因此，LD 作为距离和时间的函数的表达式为：\n$$D(x,t) = \\left( \\frac{1}{2}(1 + \\exp(-2\\rho x)) \\right)^t D_0$$\n问题要求的是 LD 半距离 $x_{1/2}(t)$，它由条件 $D(x_{1/2}(t), t) = \\frac{D_0}{2}$ 隐式定义。我们使用推导出的表达式建立这个方程：\n$$\\frac{D_0}{2} = \\left( \\frac{1}{2}(1 + \\exp(-2\\rho x_{1/2}(t))) \\right)^t D_0$$\n假设 $D_0 \\neq 0$，我们可以将两边同除以 $D_0$：\n$$\\frac{1}{2} = \\left( \\frac{1}{2}(1 + \\exp(-2\\rho x_{1/2}(t))) \\right)^t$$\n为了解出 $x_{1/2}(t)$，我们首先对两边取 $t$ 次方根（其中 $t>0$）：\n$$\\left(\\frac{1}{2}\\right)^{1/t} = \\frac{1}{2}(1 + \\exp(-2\\rho x_{1/2}(t)))$$\n两边乘以 $2$：\n$$2 \\cdot \\left(\\frac{1}{2}\\right)^{1/t} = 1 + \\exp(-2\\rho x_{1/2}(t))$$\n化简左侧：\n$$2^{1} \\cdot 2^{-1/t} = 2^{1 - 1/t} = 1 + \\exp(-2\\rho x_{1/2}(t))$$\n分离指数项：\n$$\\exp(-2\\rho x_{1/2}(t)) = 2^{1 - 1/t} - 1$$\n为了使 $x_{1/2}(t)$ 存在实数解，对数的参数必须为正，即要求 $2^{1-1/t} > 1$，这意味着 $1 - \\frac{1}{t} > 0$，或 $t>1$。这在生物学上是合理的，因为需要超过一代的重组才能将 LD 减半。\n对两边取自然对数：\n$$-2\\rho x_{1/2}(t) = \\ln\\left(2^{1 - 1/t} - 1\\right)$$\n最后，我们将两边除以 $-2\\rho$ 来解出 $x_{1/2}(t)$：\n$$x_{1/2}(t) = -\\frac{1}{2\\rho} \\ln\\left(2^{1 - 1/t} - 1\\right)$$\n这就是所要求的 LD 半距离作为交换率 $\\rho$ 和代数 $t$ 的函数的闭式解析表达式。",
            "answer": "$$\\boxed{-\\frac{1}{2\\rho} \\ln\\left(2^{1 - \\frac{1}{t}} - 1\\right)}$$"
        },
        {
            "introduction": "本章的最后一个练习将理论模型与实际数据分析相结合，这是现代群体基因组学研究的核心任务。真实的连锁不平衡衰减曲线通常比仅由交叉解释的理论曲线更为复杂，尤其是在短距离上。本练习  将指导你建立一个更精细的双组分模型，该模型同时考虑了交叉和基因转换，并要求你将其应用于模拟的经验数据，以估计这些关键的重组参数，这正是群体遗传学家在研究中经常面临的挑战。",
            "id": "2699672",
            "problem": "给定三条标准化的连锁不平衡随物理距离变化的经验曲线。每条曲线都由一组以碱基对为单位的距离和测得的标准化连锁不平衡值表示。假设在一个随机交配的种群中，在相关时间尺度内没有选择或漂变效应，并且每代两个基因座之间的重组源于两种独立的机制：交换和基因转换。将交换视为沿基因组均匀分布，具有单位碱基交换率；将基因转换视为一个沿基因组均匀起始的过程，具有单位碱基起始率，并产生长度独立同分布的交换片段，其片段长度服从已知平均值的指数分布。使用以下基本事实作为基础：\n- 根据定义，在一个大的中性种群中，由每代重组概率分隔的两个基因座之间的连锁不平衡（LD）会随世代呈乘法衰减，满足一阶线性递归形式 $D_{t+1} = (1 - c) D_t$，其中 $D_t$ 是第 $t$ 代等位基因状态的协方差，$c$ 是每代中两个基因座因重组而被分离到不同遗传背景上的概率。\n- 对于在一代内独立发生的稀有事件，无事件发生的概率是各自无事件发生概率的乘积，这意味着组合的分离风险在每代中近似为各组分风险之和（一阶近似）。\n- 标准化LD曲线是在已知的有效世代数后，LD与其初始值的比率，即 $y(d) = D_t(d)/D_0(d)$。在稀有事件近似下，这个标准化的LD是聚合的每代重组风险在已知时间尺度上积分的指数函数。\n\n您的任务：\n1) 从上述基础和既定假设出发，推导一个由两个分量组成的表达式，用于表示相距物理距离 $d$ 的两个基因座之间的聚合每代重组风险。该表达式应使用单位碱基交换率 $r$、单位碱基基因转换起始率 $g$ 和已知的平均基因转换片段长度 $\\ell$ 来表示。解释为什么当每代概率很小时，交换和基因转换对此风险的贡献是可加的，并说明这如何导出在已知的有效时间尺度 $s$ 之后标准化LD $y(d)$ 的指数形式。\n\n2) 使用您推导出的模型，实现一个非线性最小二乘估计器，用于在约束条件 $g \\ge 0$ 和 $r \\ge 0$ 下，根据距离数组 $d_i$（单位：碱基对）、观测到的标准化LD值 $y_i$（无量纲）、已知的有效时间尺度 $s$（单位：世代）和已知的平均基因转换片段长度 $\\ell$（单位：碱基对）来估计两个未知参数 $(g, r)$。目标函数应为原始尺度上观测值 $y_i$ 与模型预测值 $\\hat{y}(d_i; g, r)$ 之间偏差的平方和。\n\n3) 将您的估计器应用于以下测试套件。每个测试用例提供 $(s, \\ell, \\{d_i\\}, \\{y_i\\})$ 如下。单位：距离 $d_i$ 以碱基对为单位，平均片段长度 $\\ell$ 以碱基对为单位，时间尺度 $s$ 以世代为单位。以“事件数/碱基/代”为单位报告估计值 $(\\hat{g}, \\hat{r})$。您必须以十进制浮点数形式返回值；不要打印任何百分号。\n\n测试用例1（具有短程陡峭性的双分量模型）：\n- $s = 10000.0$\n- $\\ell = 300.0$\n- $d = [0.0, 25.0, 50.0, 100.0, 200.0, 500.0, 1000.0, 2000.0, 5000.0, 10000.0]$\n- $y = [1.000000, 0.996367, 0.992798, 0.985834, 0.972492, 0.935681, 0.880097, 0.780800, 0.544571, 0.298568]$\n\n测试用例2（仅交换的边界情况）：\n- $s = 10000.0$\n- $\\ell = 500.0$\n- $d = [0.0, 1000.0, 2000.0, 5000.0, 10000.0, 20000.0]$\n- $y = [1.000000, 0.904837, 0.818731, 0.606531, 0.367879, 0.135335]$\n\n测试用例3（具有极短片段的双分量模型）：\n- $s = 8000.0$\n- $\\ell = 100.0$\n- $d = [0.0, 10.0, 20.0, 50.0, 100.0, 200.0, 500.0, 1000.0, 2000.0]$\n- $y = [1.000000, 0.998535, 0.997176, 0.993614, 0.988986, 0.982468, 0.969364, 0.950096, 0.912822]$\n\n您的程序必须通过最小化观测值 $y$ 与您的模型之间的残差平方和来为每个测试用例计算 $(\\hat{g}, \\hat{r})$。所有输出必须以“事件数/碱基/代”为单位，并使用科学记数法四舍五入到三位有效数字。\n\n最终输出格式：\n您的程序应生成单行输出，包含一个由列表组成的列表，格式为：[[g1,r1],[g2,r2],[g3,r3]]，其中每个数字都以包含三位有效数字的科学记数法打印（例如，3.50e-08）。不应打印任何其他文本。",
            "solution": "问题陈述已经过验证，被认为是科学上合理的、定义明确的且内部一致的。它提出了一个群体遗传学中的标准问题：从连锁不平衡数据中估计重组参数。其底层的物理模型基于减数分裂重组及其对遗传连锁影响的既定原则。我们将继续进行推导和求解。\n\n**任务1：连锁不平衡衰减模型的推导**\n\n两个双等位基因座之间的连锁不平衡（LD）的衰减由递推关系 $D_{t+1} = (1 - c) D_t$ 描述，其中 $D_t$ 是第 $t$ 代的LD系数，$c$ 是基因座之间每代的总重组率。经过 $s$ 代后，LD变为 $D_s = (1 - c)^s D_0$，其中 $D_0$ 是初始LD。标准化的LD，$y(d)$，是 $D_s/D_0$ 的比值。\n$$\ny(d) = \\frac{D_s(d)}{D_0(d)} = (1 - c(d))^s\n$$\n在这里，重组率 $c$ 是基因座之间物理距离 $d$ 的函数。对于小的 $c(d)$（这对于短物理距离上的每代重组率是一个有效假设），我们可以使用近似 $(1 - c(d)) \\approx e^{-c(d)}$。这得到：\n$$\ny(d) \\approx (e^{-c(d)})^s = e^{-s \\cdot c(d)}\n$$\n问题陈述指出，重组是两个独立过程的结果：交换（CO）和基因转换（GC）。至少发生一次重组事件的总概率是 $c(d) = c_{CO}(d) + c_{GC}(d) - c_{CO}(d)c_{GC}(d)$。由于这些在每代、每碱基对尺度上都是稀有事件，与线性项相比，乘积项 $c_{CO}(d)c_{GC}(d)$ 可以忽略不计。因此，总重组概率可以很好地近似为各个概率之和：\n$$\nc(d) \\approx c_{CO}(d) + c_{GC}(d)\n$$\n这等价于总重组风险是各独立过程风险之和的陈述。令 $h(d)$ 为总风险率，使得 $c(d) \\approx h(d) = h_{CO}(d) + h_{GC}(d)$。\n\n首先，我们对交换分量 $h_{CO}(d)$ 进行建模。假设交换以均匀的速率 $r$（单位：每碱基对每代）发生。对于相距距离 $d$ 的两个基因座，该区间内预期的交换次数是 $r \\cdot d$。假设交换是一个泊松过程，那么零次交换的概率是 $e^{-rd}$，至少一次交换的概率是 $1 - e^{-rd}$。风险是事件之间指数等待距离的参数，即率参数本身，因此对总风险的贡献是：\n$$\nh_{CO}(d) = r \\cdot d\n$$\n\n其次，我们对基因转换分量 $h_{GC}(d)$ 进行建模。基因转换事件由一个起始位置和一个片段长度 $L$ 表征。起始以均匀速率 $g$（单位：每碱基对每代）发生，片段长度从平均值为 $\\ell$ 的指数分布中抽取，其概率密度函数为 $f(L) = (1/\\ell)e^{-L/\\ell}$（对于 $L \\ge 0$）。如果一个基因转换片段覆盖了一个基因座但没有覆盖另一个，它就会导致这两个基因座之间发生重组。\n\n假设两个基因座位于位置 $0$ 和 $d$。我们计算基因转换片段分离这两个基因座的速率。这可以通过两种互斥的方式发生：\n1. 一个片段覆盖了位置 $0$ 的基因座，但没有覆盖位置 $d$ 的基因座。\n2. 一个片段覆盖了位置 $d$ 的基因座，但没有覆盖位置 $0$ 的基因座。\n\n对于情况1，考虑一个在位置 $x \\le 0$ 起始的片段。要使其覆盖位置 $0$ 的基因座，其长度 $L$ 必须至少为 $-x$。要使其不覆盖位置 $d$ 的基因座，其长度 $L$ 必须小于 $d-x$。通过对所有可能的起始点 $x \\le 0$ 和所有相关的片段长度 $L$ 进行积分，可以求得速率：\n$$\n\\text{Rate}_1 = \\int_{-\\infty}^{0} g \\left( \\int_{-x}^{d-x} \\frac{1}{\\ell} e^{-L/\\ell} dL \\right) dx\n$$\n内部积分计算为 $[-e^{-L/\\ell}]_{-x}^{d-x} = e^{-(-x)/\\ell} - e^{-(d-x)/\\ell} = e^{x/\\ell} - e^{-(d-x)/\\ell}$。\n将此代入外部积分：\n$$\n\\text{Rate}_1 = g \\int_{-\\infty}^{0} (e^{x/\\ell} - e^{-(d-x)/\\ell}) dx = g \\left[ \\ell e^{x/\\ell} - \\ell e^{-(d-x)/\\ell} \\right]_{-\\infty}^{0}\n$$\n$$\n\\text{Rate}_1 = g \\left( (\\ell e^0 - \\ell e^{-d/\\ell}) - (0 - 0) \\right) = g\\ell(1 - e^{-d/\\ell})\n$$\n根据对称性，情况2（一个片段覆盖位置 $d$ 的基因座但未覆盖位置 $0$ 的基因座）的速率是相同的。这可以通过将原点置于 $d$ 并考虑第二个基因座位于 $-d$ 来进行概念化。\n因此，由基因转换引起的总重组风险是这两个速率之和：\n$$\nh_{GC}(d) = \\text{Rate}_1 + \\text{Rate}_2 = 2g\\ell(1 - e^{-d/\\ell})\n$$\n总重组风险 $c(d)$ 是交换和基因转换风险之和：\n$$\nc(d) \\approx h(d) = h_{CO}(d) + h_{GC}(d) = rd + 2g\\ell(1 - e^{-d/\\ell})\n$$\n将此代入标准化LD的表达式，我们得到最终模型：\n$$\ny(d) = \\exp\\left[-s \\left( rd + 2g\\ell(1-e^{-d/\\ell}) \\right)\\right]\n$$\n至此，任务1的推导完成。\n\n**任务2：非线性最小二乘估计器**\n\n目标是从经验数据中估计未知参数 $g$（基因转换起始率）和 $r$（交换率）。数据由 $N$ 对物理距离和观测到的标准化LD值 $\\{ (d_i, y_i) \\}_{i=1}^N$ 组成。我们已知有效时间尺度 $s$ 和平均基因转换片段长度 $\\ell$。\n\n我们基于上述推导定义一个模型函数 $\\hat{y}(d_i; g, r)$：\n$$\n\\hat{y}(d_i; g, r) = \\exp\\left[-s \\left( r d_i + 2g\\ell(1-e^{-d_i/\\ell}) \\right)\\right]\n$$\n必须通过最小化观测值 $y_i$ 和模型预测值 $\\hat{y}(d_i; g, r)$ 之间的残差平方和（SSR）来估计参数 $(g, r)$。目标函数 $S(g,r)$ 是：\n$$\nS(g,r) = \\sum_{i=1}^{N} \\left[ y_i - \\hat{y}(d_i; g, r) \\right]^2\n$$\n这是一个非线性最小二乘问题。最小化必须在速率不能为负的物理约束下进行：\n$$\ng \\ge 0, \\quad r \\ge 0\n$$\n我们将采用一种数值优化算法，特别是L-BFGS-B方法，该方法适用于此类有界约束的非线性问题。该算法需要参数 $(g,r)$ 的初始猜测值。根据典型的生物学数值，以“事件数/碱基/代”为单位的 $(10^{-8}, 10^{-8})$ 作为 $(g, r)$ 的初始猜测值是一个合理的起点。\n\n**任务3：应用于测试套件**\n\n将把实现的估计器应用于提供的三个测试用例。对于每个用例，将使用给定的数据集 $(s, \\ell, \\{d_i\\}, \\{y_i\\})$。将执行任务2中描述的优化过程，以找到最小化SSR的最优值 $(\\hat{g}, \\hat{r})$。每个测试用例的结果将以包含三位有效数字的科学记数法报告。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Solves the problem of estimating recombination parameters from LD data.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"s\": 10000.0,\n            \"ell\": 300.0,\n            \"d\": np.array([0.0, 25.0, 50.0, 100.0, 200.0, 500.0, 1000.0, 2000.0, 5000.0, 10000.0]),\n            \"y\": np.array([1.000000, 0.996367, 0.992798, 0.985834, 0.972492, 0.935681, 0.880097, 0.780800, 0.544571, 0.298568]),\n        },\n        {\n            \"s\": 10000.0,\n            \"ell\": 500.0,\n            \"d\": np.array([0.0, 1000.0, 2000.0, 5000.0, 10000.0, 20000.0]),\n            \"y\": np.array([1.000000, 0.904837, 0.818731, 0.606531, 0.367879, 0.135335]),\n        },\n        {\n            \"s\": 8000.0,\n            \"ell\": 100.0,\n            \"d\": np.array([0.0, 10.0, 20.0, 50.0, 100.0, 200.0, 500.0, 1000.0, 2000.0]),\n            \"y\": np.array([1.000000, 0.998535, 0.997176, 0.993614, 0.988986, 0.982468, 0.969364, 0.950096, 0.912822]),\n        }\n    ]\n\n    results = []\n\n    # Model function for normalized LD\n    def model_y(params, d, s, ell):\n        \"\"\"\n        Calculates predicted normalized LD based on the derived model.\n        params: tuple (g, r)\n            g: gene conversion initiation rate per base\n            r: crossover rate per base\n        d: array of distances in base pairs\n        s: effective timescale in generations\n        ell: mean gene conversion tract length in base pairs\n        \"\"\"\n        g, r = params\n        # Avoid division by zero if ell is zero, although problem constraints have ell > 0.\n        d_over_ell = np.divide(d, ell, out=np.zeros_like(d, dtype=float), where=ell!=0)\n        recombination_hazard = r * d + 2 * g * ell * (1 - np.exp(-d_over_ell))\n        return np.exp(-s * recombination_hazard)\n\n    # Objective function: Sum of Squared Residuals\n    def objective_ssr(params, d_obs, y_obs, s, ell):\n        \"\"\"\n        Calculates the sum of squared residuals between observed and predicted y.\n        \"\"\"\n        y_pred = model_y(params, d_obs, s, ell)\n        return np.sum((y_obs - y_pred)**2)\n\n    for case in test_cases:\n        s = case[\"s\"]\n        ell = case[\"ell\"]\n        d_obs = case[\"d\"]\n        y_obs = case[\"y\"]\n\n        # Initial guess for parameters (g, r)\n        initial_guess = (1e-8, 1e-8)\n\n        # Parameter bounds (g >= 0, r >= 0)\n        bounds = [(0, None), (0, None)]\n\n        # Perform non-linear least squares optimization\n        result = minimize(\n            fun=objective_ssr,\n            x0=initial_guess,\n            args=(d_obs, y_obs, s, ell),\n            method='L-BFGS-B',\n            bounds=bounds\n        )\n\n        g_hat, r_hat = result.x\n        results.append(f\"[{g_hat:.2e},{r_hat:.2e}]\")\n        \n    # Final print statement in the exact required format.\n    print(f\"[[{results[0][1:-1]}],[{results[1][1:-1]}],[{results[2][1:-1]}]]\")\n\nsolve()\n```"
        }
    ]
}