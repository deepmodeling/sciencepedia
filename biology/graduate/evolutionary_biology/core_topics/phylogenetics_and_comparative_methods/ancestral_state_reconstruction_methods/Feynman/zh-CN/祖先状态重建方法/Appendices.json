{
    "hands_on_practices": [
        {
            "introduction": "祖先状态重建中最经典的方法之一是简约法，它将奥卡姆剃刀原理应用于演化问题——即偏好需要最少演化改变的解释。Fitch算法是实现这一原则的基础算法，专门用于推断无序离散性状的祖先状态。这个练习将引导你亲手计算在给定谱系树上的最小变化次数，这是掌握简约法这一核心技能的基础实践 。",
            "id": "2691502",
            "problem": "给定一个Newick格式的全分叉有根系统发育树 $((A,B),(C,D))$ 和一个单一的二态形态学特征，其观察到的尖端状态为 $A=0, B=1, C=1, D=1$。使用最大简约法（MP）标准，特别是针对无序二态特征的Fitch简约法，确定每个内部节点可能的祖先状态集，并计算在整个树上所需的状态变化的最小次数。请将最小变化次数作为最终数值答案。不假设任何转换偏差或速率异质性。无需四舍五入。",
            "solution": "所提供的问题在科学上是合理的、定义明确且客观的。提供了求解所需的所有数据，并且问题要求应用进化生物学中一个标准且定义明确的算法。因此，该问题有效，并将提供解答。\n\n目标是应用Fitch最大简约算法，来确定在给定的系统发育树上一个二态特征状态变化的最小次数。系统发育树为 $((A,B),(C,D))$，尖端的特征状态为 $A=0$、$B=1$、$C=1$ 和 $D=1$。\n\n首先，我们必须定义拓扑结构并一致地标记节点。设尖端为 $A$、$B$、$C$ 和 $D$。设作为 $A$ 和 $B$ 最近共同祖先的内部节点为 $N_1$。设作为 $C$ 和 $D$ 最近共同祖先的内部节点为 $N_2$。树的根节点是 $N_1$ 和 $N_2$ 的最近共同祖先，记为 $N_R$。任何节点 $k$ 的状态由一个可能的特征状态集 $S_k$ 表示。\n\n给定的尖端状态是：\n$$S_A = \\{0\\}$$\n$$S_B = \\{1\\}$$\n$$S_C = \\{1\\}$$\n$$S_D = \\{1\\}$$\n\nFitch算法分两个阶段进行。阶段1是从叶尖到根节点的自下而上遍历，它确定所有内部节点的初步状态集，并计算总简约分数（最小变化次数）。阶段2是从根节点到叶尖的自上而下遍历，它解决状态集中的任何模糊性，以描绘出最简约重构(MPRs)的集合。\n\n**阶段1：自下而上遍历**\n\n确定一个祖先节点 $k$ （其两个直接后代为 $i$ 和 $j$）的状态集 $S_k$ 的规则如下：\n1. 如果后代状态集的交集非空，$S_i \\cap S_j \\neq \\emptyset$，则 $S_k = S_i \\cap S_j$。这个分支上的变化次数为 $0$。\n2. 如果后代状态集的交集为空，$S_i \\cap S_j = \\emptyset$，则 $S_k = S_i \\cup S_j$。这个分支上的变化次数为 $1$。\n\n总简约分数是所有内部节点上变化次数的总和。\n\n设 $L$ 为总变化次数。初始时，$L=0$。\n\n我们从朝向尖端的节点向上至根节点进行处理。\n\n**步骤1：确定节点 $N_1$ 的状态集。**\n节点 $N_1$ 是节点 $A$ 和 $B$ 的父节点。\n状态集为 $S_A = \\{0\\}$ 和 $S_B = \\{1\\}$。\n交集是 $S_A \\cap S_B = \\{0\\} \\cap \\{1\\} = \\emptyset$。\n由于交集为空，我们使用并集规则。$N_1$ 的状态集为 $S_{N_1} = S_A \\cup S_B = \\{0, 1\\}$。\n这表示需要一次特征状态变化。我们将总分增加：$L = L + 1 = 1$。\n\n**步骤2：确定节点 $N_2$ 的状态集。**\n节点 $N_2$ 是节点 $C$ 和 $D$ 的父节点。\n状态集为 $S_C = \\{1\\}$ 和 $S_D = \\{1\\}$。\n交集是 $S_C \\cap S_D = \\{1\\} \\cap \\{1\\} = \\{1\\}$。\n由于交集非空，我们使用交集规则。$N_2$ 的状态集为 $S_{N_2} = S_C \\cap S_D = \\{1\\}$。\n不需要变化。分数保持为 $L=1$。\n\n**步骤3：确定根节点 $N_R$ 的状态集。**\n节点 $N_R$ 是节点 $N_1$ 和 $N_2$ 的父节点。\n状态集为 $S_{N_1} = \\{0, 1\\}$ 和 $S_{N_2} = \\{1\\}$。\n交集是 $S_{N_1} \\cap S_{N_2} = \\{0, 1\\} \\cap \\{1\\} = \\{1\\}$。\n由于交集非空，我们使用交集规则。$N_R$ 的状态集为 $S_{N_R} = S_{N_1} \\cap S_{N_2} = \\{1\\}$。\n不需要变化。分数保持为 $L=1$。\n\n自下而上的遍历完成。在整个树上所需状态变化的最小次数为 $L=1$。\n\n_为完整起见，我们讨论可能的祖先状态集。_\n初步状态集为 $S_{N_1} = \\{0, 1\\}$，$S_{N_2} = \\{1\\}$ 和 $S_{N_R} = \\{1\\}$。节点 $N_1$ 的状态集是模糊的。为了确定在任何最简约重构（MPR）中每个节点上可能存在的实际状态集，我们必须确保任何赋值都与 $L=1$ 的最小总分一致。\n\n根节点 $N_R$ 的状态明确为 $\\{1\\}$。节点 $N_2$ 的状态明确为 $\\{1\\}$。\n我们必须检查节点 $N_1$ 的模糊性。其初步状态集为 $\\{0, 1\\}$。\n- 如果我们将状态 $1$ 赋给节点 $N_1$：状态变化发生在通往分类单元 $A$ 的分支上 ($1 \\to 0$)。所有其他分支没有变化 ($N_R(1) \\to N_1(1)$, $N_1(1) \\to B(1)$, $N_R(1) \\to N_2(1)$ 等)。总变化次数为 $1$。这种重构是最简约的。\n- 如果我们将状态 $0$ 赋给节点 $N_1$：状态变化发生在通往分类单元 $B$ 的分支上 ($0 \\to 1$)。此外，由于根节点 $N_R$ 的状态必须是 $1$，因此在连接 $N_R$ 和 $N_1$ 的分支上也必须发生一次变化 ($1 \\to 0$)。这种重构需要2次变化。由于 $2 > 1$，这不是一个最简约的重构。\n\n因此，只有一个最简约重构。在这种重构中，$N_1$ 的状态必须是 $1$。内部节点可能的祖先状态集是：\n- 节点 $N_1$: $\\{1\\}$\n- 节点 $N_2$: $\\{1\\}$\n- 根节点 $N_R$: $\\{1\\}$\n唯一的演化事件是在通往分类单元 $A$ 的分支上，状态从 $1$ 变为 $0$。\n\n然而，问题要求的是所需状态变化的最小次数，这在Fitch算法的第一阶段已经计算出来。\n\n最终结果是简约分数 $L$。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "与简约法的确定性逻辑不同，最大似然法提供了一个强大的概率框架来重建祖先状态。该方法将性状演化建模为一个在谱系树上运行的连续时间马尔可夫过程，并计算在给定祖先状态下观察到数据的概率。本练习将带你实践Felsenstein的“剪枝算法”（pruning algorithm），通过从下至上计算条件似然性，这是现代系统发育学中所有基于模型方法的核心 。",
            "id": "2691564",
            "problem": "考虑一个在固定的四分类单元系统发育树上进化的二元性状，其拓扑结构为 $((A,B),(C,D))$。从内部节点到末端的所有四个悬垂分支的长度均为 $0.1$。连接两个内部节点的内部分支长度为 $0.4$，根节点位于其中点，因此从根节点到每个内部节点的两个分支长度均为 $0.2$。该性状根据双状态马尔可夫 $k$-状态（Mk）模型进行进化，在本例中，这是一个在状态空间 $\\{0,1\\}$ 上的连续时间马尔可夫链（CTMC），其瞬时速率矩阵为\n$$\nQ \\;=\\; \\begin{pmatrix}\n-q & q\\\\\nq & -q\n\\end{pmatrix},\n$$\n其中 $q=2$。该对称模型的平稳分布为 $(\\tfrac{1}{2},\\tfrac{1}{2})$。观察到的末端状态为 $A=0, B=1, C=1, D=1$。\n\n从树上的CTMC的基本原理和剪枝算法（树上的动态规划）出发，完成以下任务：\n- 推导双状态对称CTMC的转移概率矩阵 $P(t)=\\exp(Qt)$，并用 $q$ 和 $t$ 表示其元素。\n- 使用这些转移概率，计算紧邻 $(A,B)$ 和 $(C,D)$ 的祖先的两个内部节点的条件似然向量。\n- 使用从根节点到内部节点的两个长度为 $0.2$ 的分支，将这些条件似然传播到根节点，并在假设根节点处为平稳先验 $(\\tfrac{1}{2},\\tfrac{1}{2})$ 的情况下，计算给定数据时根节点处于状态 $1$ 的后验概率。\n\n仅报告最终的后验概率，以十进制表示并四舍五入到四位有效数字。不需要单位。",
            "solution": "该问题是有效的，因为它科学地基于系统发育树上的连续时间马尔可夫链原理，这是计算演化生物学中的一种标准方法。该问题提法恰当、客观，并包含计算出唯一解所需的所有必要信息。\n\n设二元性状的状态空间为 $S = \\{0, 1\\}$。其进化由瞬时速率矩阵决定：\n$$\nQ = \\begin{pmatrix} -q & q \\\\ q & -q \\end{pmatrix}\n$$\n其中速率参数为 $q=2$。\n\n首先，我们推导转移概率矩阵 $P(t) = \\exp(Qt)$。矩阵 $Q$ 可写作 $Q = q \\begin{pmatrix} -1 & 1 \\\\ 1 & -1 \\end{pmatrix}$。我们求解 $Q$ 的特征值和特征向量。特征方程为 $\\det(Q - \\lambda I) = 0$：\n$$\n(-q - \\lambda)^2 - q^2 = 0 \\implies \\lambda^2 + 2q\\lambda = 0 \\implies \\lambda(\\lambda + 2q) = 0\n$$\n特征值为 $\\lambda_1 = 0$ 和 $\\lambda_2 = -2q$。对应的特征向量为 $v_1 = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$ 和 $v_2 = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。\n特征向量矩阵为 $V = \\begin{pmatrix} 1 & 1 \\\\ 1 & -1 \\end{pmatrix}$，其逆矩阵为 $V^{-1} = \\frac{1}{2} \\begin{pmatrix} 1 & 1 \\\\ 1 & -1 \\end{pmatrix}$。\n转移矩阵由 $P(t) = V \\exp(Dt) V^{-1}$ 给出，其中 $D$ 是特征值的对角矩阵：\n$$\nP(t) = \\begin{pmatrix} 1 & 1 \\\\ 1 & -1 \\end{pmatrix} \\begin{pmatrix} \\exp(0 \\cdot t) & 0 \\\\ 0 & \\exp(-2qt) \\end{pmatrix} \\frac{1}{2} \\begin{pmatrix} 1 & 1 \\\\ 1 & -1 \\end{pmatrix}\n$$\n$$\nP(t) = \\frac{1}{2} \\begin{pmatrix} 1 & \\exp(-2qt) \\\\ 1 & -\\exp(-2qt) \\end{pmatrix} \\begin{pmatrix} 1 & 1 \\\\ 1 & -1 \\end{pmatrix} = \\frac{1}{2} \\begin{pmatrix} 1 + \\exp(-2qt) & 1 - \\exp(-2qt) \\\\ 1 - \\exp(-2qt) & 1 + \\exp(-2qt) \\end{pmatrix}\n$$\n转移矩阵的元素为：\n$P_{00}(t) = P_{11}(t) = \\frac{1}{2}(1 + \\exp(-2qt))$（在时间 $t$ 内保持同一状态的概率）。\n$P_{01}(t) = P_{10}(t) = \\frac{1}{2}(1 - \\exp(-2qt))$（在时间 $t$ 内改变状态的概率）。\n\n接下来，我们应用 Felsenstein 的剪枝算法。设末端 $A$ 和 $B$ 的祖先内部节点为 $N_{AB}$，末端 $C$ 和 $D$ 的祖先节点为 $N_{CD}$。树的根节点是 $N_R$。对于一个节点 $u$，其条件似然向量 $L_u$ 是一个向量 $[L_u(0), L_u(1)]^T$，其中 $L_u(i)$ 是在给定节点 $u$ 处于状态 $i$ 的条件下，由 $u$ 所延伸出的子树中观察到数据的概率。\n\n对于末端，似然向量由观察到的状态决定：$A=0, B=1, C=1, D=1$。\n$L_A = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$，$L_B = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$，$L_C = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$，$L_D = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$。\n\n所有悬垂分支的长度均为 $t_p = 0.1$。我们计算节点 $N_{AB}$ 处的条件似然：\n$L_{N_{AB}}(i) = \\left( \\sum_{j \\in S} P_{ij}(t_p) L_A(j) \\right) \\times \\left( \\sum_{k \\in S} P_{ik}(t_p) L_B(k) \\right)$。\n$L_{N_{AB}}(0) = (P_{00}(t_p) \\cdot 1 + P_{01}(t_p) \\cdot 0) \\times (P_{00}(t_p) \\cdot 0 + P_{01}(t_p) \\cdot 1) = P_{00}(t_p) P_{01}(t_p)$。\n$L_{N_{AB}}(1) = (P_{10}(t_p) \\cdot 1 + P_{11}(t_p) \\cdot 0) \\times (P_{10}(t_p) \\cdot 0 + P_{11}(t_p) \\cdot 1) = P_{10}(t_p) P_{11}(t_p)$。\n由于 $P_{00}=P_{11}$ 且 $P_{01}=P_{10}$，我们有 $L_{N_{AB}}(0) = L_{N_{AB}}(1) = P_{00}(t_p) P_{01}(t_p)$。\n\n类似地，对于节点 $N_{CD}$：\n$L_{N_{CD}}(i) = \\left( \\sum_{j \\in S} P_{ij}(t_p) L_C(j) \\right) \\times \\left( \\sum_{k \\in S} P_{ik}(t_p) L_D(k) \\right)$。\n$L_{N_{CD}}(0) = (P_{01}(t_p))^2$。\n$L_{N_{CD}}(1) = (P_{11}(t_p))^2$。\n\n现在，我们将这些似然传播到根节点 $N_R$。从根节点到 $N_{AB}$ 和 $N_{CD}$ 的分支长度均为 $t_r = 0.2$。根节点的条件似然为：\n$L_{N_R}(i) = \\left( \\sum_{j \\in S} P_{ij}(t_r) L_{N_{AB}}(j) \\right) \\times \\left( \\sum_{k \\in S} P_{ik}(t_r) L_{N_{CD}}(k) \\right)$。\n\n对于 $i=0$：\n$L_{N_R}(0) = [P_{00}(t_r)L_{N_{AB}}(0) + P_{01}(t_r)L_{N_{AB}}(1)] \\times [P_{00}(t_r)L_{N_{CD}}(0) + P_{01}(t_r)L_{N_{CD}}(1)]$。\n代入 $L_{N_{AB}}(0)=L_{N_{AB}}(1)$，第一项变为 $(P_{00}(t_r) + P_{01}(t_r))L_{N_{AB}}(0)$。由于 $P_{00}(t_r) + P_{01}(t_r) = 1$，此项简化为 $L_{N_{AB}}(0)$。\n$L_{N_R}(0) = P_{00}(t_p)P_{01}(t_p) \\times [P_{00}(t_r)(P_{01}(t_p))^2 + P_{01}(t_r)(P_{11}(t_p))^2]$。\n\n对于 $i=1$：\n$L_{N_R}(1) = [P_{10}(t_r)L_{N_{AB}}(0) + P_{11}(t_r)L_{N_{AB}}(1)] \\times [P_{10}(t_r)L_{N_{CD}}(0) + P_{11}(t_r)L_{N_{CD}}(1)]$。\n第一项同样简化为 $L_{N_{AB}}(1)$。\n$L_{N_R}(1) = P_{10}(t_p)P_{11}(t_p) \\times [P_{10}(t_r)(P_{01}(t_p))^2 + P_{11}(t_r)(P_{11}(t_p))^2]$。\n\n数据的总似然为 $P(D) = \\sum_{i \\in S} \\pi_i L_{N_R}(i)$，其中 $\\pi = (\\frac{1}{2}, \\frac{1}{2})$ 是根节点的平稳分布。根节点处于状态 $1$ 的后验概率为：\n$$\nP(\\text{root}=1|D) = \\frac{\\pi_1 L_{N_R}(1)}{\\pi_0 L_{N_R}(0) + \\pi_1 L_{N_R}(1)} = \\frac{L_{N_R}(1)}{L_{N_R}(0) + L_{N_R}(1)}\n$$\n公因子 $P_{00}(t_p)P_{01}(t_p)$（因为 $P_{00}=P_{11}, P_{01}=P_{10}$）在分子和分母中被消去。设 $p_s = P_{11}(t_p)$，$p_d = P_{01}(t_p)$，$p'_s = P_{11}(t_r)$，以及 $p'_d = P_{01}(t_r)$。\n$$\nP(\\text{root}=1|D) = \\frac{p'_d(p_d)^2 + p'_s(p_s)^2}{[p'_s(p_d)^2 + p'_d(p_s)^2] + [p'_d(p_d)^2 + p'_s(p_s)^2]}\n$$\n分母简化为 $(p'_s+p'_d)(p_d)^2 + (p'_d+p'_s)(p_s)^2 = (p_d)^2 + (p_s)^2$。\n$$\nP(\\text{root}=1|D) = \\frac{p'_d(p_d)^2 + p'_s(p_s)^2}{(p_d)^2 + (p_s)^2}\n$$\n我们有 $q=2$。对于 $t_p=0.1$，$2qt_p=0.4$。对于 $t_r=0.2$，$2qt_r=0.8$。\n$p_s = P_{11}(0.1) = \\frac{1}{2}(1 + \\exp(-0.4))$。\n$p_d = P_{01}(0.1) = \\frac{1}{2}(1 - \\exp(-0.4))$。\n$p'_s = P_{11}(0.2) = \\frac{1}{2}(1 + \\exp(-0.8))$。\n$p'_d = P_{01}(0.2) = \\frac{1}{2}(1 - \\exp(-0.8))$。\n\n我们来计算分母： $(p_d)^2 + (p_s)^2 = \\frac{1}{4}(1-\\exp(-0.4))^2 + \\frac{1}{4}(1+\\exp(-0.4))^2 = \\frac{1}{4}(1 - 2\\exp(-0.4) + \\exp(-0.8) + 1 + 2\\exp(-0.4) + \\exp(-0.8)) = \\frac{1}{2}(1+\\exp(-0.8)) = p'_s$。\n后验概率变为：\n$$\nP(\\text{root}=1|D) = \\frac{p'_d (p_d)^2 + p'_s (p_s)^2}{p'_s}\n$$\n代入概率的表达式：\n设 $u = \\exp(-0.4)$，则 $u^2 = \\exp(-0.8)$。\n$p_s = \\frac{1}{2}(1+u)$，$p_d = \\frac{1}{2}(1-u)$，$p'_s = \\frac{1}{2}(1+u^2)$，$p'_d = \\frac{1}{2}(1-u^2)$。\n分子： $\\frac{1}{2}(1-u^2)\\frac{1}{4}(1-u)^2 + \\frac{1}{2}(1+u^2)\\frac{1}{4}(1+u)^2$\n$= \\frac{1}{8}[(1-u^2)(1-2u+u^2) + (1+u^2)(1+2u+u^2)]$\n$= \\frac{1}{8}[(1-2u+u^2 - u^2+2u^3-u^4) + (1+2u+u^2 + u^2+2u^3+u^4)]$\n$= \\frac{1}{8}[1-2u+2u^3-u^4 + 1+2u+2u^2+2u^3+u^4] = \\frac{1}{8}[2+2u^2+4u^3] = \\frac{1}{4}(1+u^2+2u^3)$。\n所以，$P(\\text{root}=1|D) = \\frac{\\frac{1}{4}(1+u^2+2u^3)}{\\frac{1}{2}(1+u^2)} = \\frac{1}{2}\\frac{1+u^2+2u^3}{1+u^2} = \\frac{1}{2}\\frac{1+\\exp(-0.8)+2\\exp(-1.2)}{1+\\exp(-0.8)}$。\n数值计算：\n$\\exp(-0.8) \\approx 0.449329$\n$\\exp(-1.2) \\approx 0.301194$\n$P(\\text{root}=1|D) \\approx \\frac{1}{2} \\frac{1+0.449329+2(0.301194)}{1+0.449329} = \\frac{1}{2} \\frac{1.449329+0.602388}{1.449329} = \\frac{1}{2} \\frac{2.051717}{1.449329} \\approx \\frac{1}{2}(1.415635) \\approx 0.7078175$。\n四舍五入到四位有效数字，后验概率为 $0.7078$。",
            "answer": "$$\\boxed{0.7078}$$"
        },
        {
            "introduction": "在掌握了似然法的基础后，我们可以探讨更高级的建模挑战，例如“确认偏误”（ascertainment bias）。当我们的数据收集过程只包含了可变位点时，这种偏误就会出现，从而系统性地扭曲推断结果。这个练习将通过一个具体的案例，量化忽略这种偏误所带来的影响，并介绍如何使用Mkv模型进行校正，从而让你更深入地理解系统发育模型背后的假设及其重要性 。",
            "id": "2691509",
            "problem": "考虑一个有根、平衡、超度量的 $4$ 分类单元树，其包含两条长度为 $t$ 的内部枝和四条长度为 $t$ 的末端枝。设根节点分裂为两个内部节点，每个内部节点下辖两个末端分类单元。观察到一个二态形态特征，其叶节点状态为 $(0,0,1,1)$，即左侧分支中的两个分类单元处于状态 $0$，右侧分支中的两个分类单元处于状态 $1$。假设一个连续时间、双状态、时间异质性的马尔可夫过程，其瞬时速率矩阵为\n$$\nQ \\;=\\; \\begin{pmatrix}\n- a & a \\\\\nb & - b\n\\end{pmatrix},\n$$\n其中 $a>0$ 是从状态 $0$ 变为状态 $1$ 的瞬时速率，而 $b>0$ 是从状态 $1$ 变为状态 $0$ 的瞬时速率。假设根节点状态的先验概率等于该过程的稳态分布，即 $\\pi_0 = \\frac{b}{a+b}$ 和 $\\pi_1 = \\frac{a}{a+b}$。该特征通过排除恒定位点进行了判选，因此数据集中仅包含可变特征，这与仅含可变位点的马尔可夫k状态判选模型（Mkv）中的情况相同。\n\n在 $t$ 很小的短枝情形下进行计算，并仅保留至 $t$ 的一阶项（忽略 $\\mathcal{O}(t^2)$ 及更高阶项）。仅使用连续时间马尔可夫链的标准性质，即对于很小的 $t$，转移概率满足 $P_{ii}(t) = 1 - q_i t + \\mathcal{O}(t^2)$ 和 $P_{ij}(t) = q_{ij} t + \\mathcal{O}(t^2)$（对于 $i \\neq j$），其中 $q_i = -Q_{ii}$。\n\na) 在忽略判选的未校正分析下（即，使用双状态过程下的无条件似然），推导在每个固定根状态下观察到模式 $(0,0,1,1)$ 的主阶似然。然后，使用贝叶斯法则和给定的根节点先验概率，计算根状态为0的后验概率，记为 $P_{\\text{noMkv}}(R{=}0 \\mid \\text{data})$，精确到 $t$ 的一阶。\n\nb) 推导在每个固定根状态下位点是可变的概率，$P(\\text{variable} \\mid R{=}0)$ 和 $P(\\text{variable} \\mid R{=}1)$，精确到 $t$ 的一阶。然后使用这些量计算经过Mkv校正的根状态为0的后验概率，\n$$\nP_{\\text{Mkv}}(R{=}0 \\mid \\text{data}, \\text{variable}) \\;\\propto\\; \\pi_0 \\,\\frac{P(\\text{data} \\mid R{=}0)}{P(\\text{variable} \\mid R{=}0)},\n$$\n（在两个根状态间进行归一化），精确到 $t$ 的一阶。\n\nc) 将未使用Mkv模型所导致的偏倚定义为\n$$\n\\Delta \\;=\\; P_{\\text{noMkv}}(R{=}0 \\mid \\text{data}) \\;-\\; P_{\\text{Mkv}}(R{=}0 \\mid \\text{data}, \\text{variable}).\n$$\n以 $a$ 和 $b$ 的闭式形式计算 $\\Delta$（精确到 $t$ 的一阶）。给出最终答案，形式为关于 $a$ 和 $b$ 的单个简化解析表达式。",
            "solution": "所给问题是计算演化生物学中一个有效且适定的问题。它在科学上基于应用于系统发育学的连续时间马尔可夫链理论，并探讨了判选偏倚这一重要问题。所有必要信息都已提供，并且问题的结构适于在指定的小时间近似下进行解析求解。我现在开始解答。\n\n该问题要求我们分析在一个 $4$ 分类单元树上，判选偏倚对二态特征的祖先状态重建的影响。该树是一个有根、平衡、超度量的树，所有枝长均为 $t$。我们记根节点为 $R$，它分裂为两个内部节点 $N_1$ 和 $N_2$。节点 $N_1$ 是两个末端分类单元 $T_1$ 和 $T_2$ 的父节点。节点 $N_2$ 是分类单元 $T_3$ 和 $T_4$ 的父节点。在叶节点观察到的状态为 $(0,0,1,1)$，即左侧分支 $\\{T_1, T_2\\}$ 处于状态0，右侧分支 $\\{T_3, T_4\\}$ 处于状态1。\n\n该特征在一个双状态马尔可夫过程下演化，其速率矩阵为：\n$$\nQ = \\begin{pmatrix} -a & a \\\\ b & -b \\end{pmatrix}\n$$\n对于一个小的时间间隔 $t$，其转移概率（精确到一阶）由下式给出：\n$P_{00}(t) = 1 - at + \\mathcal{O}(t^2)$\n$P_{01}(t) = at + \\mathcal{O}(t^2)$\n$P_{11}(t) = 1 - bt + \\mathcal{O}(t^2)$\n$P_{10}(t) = bt + \\mathcal{O}(t^2)$\n\n根状态的先验概率由稳态分布给出：$\\pi_0 = P(R{=}0) = \\frac{b}{a+b}$ 和 $\\pi_1 = P(R{=}1) = \\frac{a}{a+b}$。\n\na) 未校正的根状态后验概率\n\n首先，我们计算在每个可能的根状态 $s \\in \\{0,1\\}$ 下，观察到数据 $D=(0,0,1,1)$ 的似然，我们将其记为 $L_s = P(D \\mid R{=}s)$。我们使用 Felsenstein 的剪枝算法。令 $L_{N_1}(i)$ 为在节点 $N_1$ 处于状态 $i$ 的条件下，左子树（数据为 $(0,0)$）的条件似然。\n$$\nL_{N_1}(i) = P(T_1{=}0, T_2{=}0 \\mid N_1{=}i) = (P_{i0}(t))^2\n$$\n精确到 $t$ 的一阶：\n$L_{N_1}(0) = (P_{00}(t))^2 = (1-at)^2 = 1 - 2at + \\mathcal{O}(t^2)$\n$L_{N_1}(1) = (P_{10}(t))^2 = (bt)^2 = \\mathcal{O}(t^2)$\n\n类似地，令 $L_{N_2}(j)$ 为在节点 $N_2$ 处于状态 $j$ 的条件下，右子树（数据为 $(1,1)$）的条件似然。\n$$\nL_{N_2}(j) = P(T_3{=}1, T_4{=}1 \\mid N_2{=}j) = (P_{j1}(t))^2\n$$\n精确到 $t$ 的一阶：\n$L_{N_2}(0) = (P_{01}(t))^2 = (at)^2 = \\mathcal{O}(t^2)$\n$L_{N_2}(1) = (P_{11}(t))^2 = (1-bt)^2 = 1 - 2bt + \\mathcal{O}(t^2)$\n\n假定根状态为 $s$ 的总似然是：\n$$\nL_s = \\left( \\sum_{i \\in \\{0,1\\}} P_{si}(t) L_{N_1}(i) \\right) \\left( \\sum_{j \\in \\{0,1\\}} P_{sj}(t) L_{N_2}(j) \\right)\n$$\n对于根状态 $s=0$：\n$$\nL_0 = (P_{00}(t)L_{N_1}(0) + P_{01}(t)L_{N_1}(1))(P_{00}(t)L_{N_2}(0) + P_{01}(t)L_{N_2}(1))\n$$\n代入一阶表达式并忽略 $\\mathcal{O}(t^2)$ 及更高阶的项：\n$$\nL_0 \\approx \\left( (1-at)(1-2at) + (at)\\mathcal{O}(t^2) \\right) \\left( (1-at)\\mathcal{O}(t^2) + (at)(1-2bt) \\right)\n$$\n$$\nL_0 \\approx (1 - 3at)(at) + \\mathcal{O}(t^2) = at + \\mathcal{O}(t^2)\n$$\n对于根状态 $s=1$：\n$$\nL_1 = (P_{10}(t)L_{N_1}(0) + P_{11}(t)L_{N_1}(1))(P_{10}(t)L_{N_2}(0) + P_{11}(t)L_{N_2}(1))\n$$\n$$\nL_1 \\approx \\left( (bt)(1-2at) + (1-bt)\\mathcal{O}(t^2) \\right) \\left( (bt)\\mathcal{O}(t^2) + (1-bt)(1-2bt) \\right)\n$$\n$$\nL_1 \\approx (bt)(1 - 3bt) + \\mathcal{O}(t^2) = bt + \\mathcal{O}(t^2)\n$$\n因此，精确到一阶，似然值为 $L_0 = at$ 和 $L_1 = bt$。\n\n未校正的后验概率 $P_{\\text{noMkv}}(R{=}0 \\mid D)$ 可以通过贝叶斯法则求得：\n$$\nP_{\\text{noMkv}}(R{=}0 \\mid D) = \\frac{L_0 \\pi_0}{L_0 \\pi_0 + L_1 \\pi_1} = \\frac{(at) \\frac{b}{a+b}}{(at) \\frac{b}{a+b} + (bt) \\frac{a}{a+b}} = \\frac{\\frac{abt}{a+b}}{\\frac{abt}{a+b} + \\frac{abt}{a+b}} = \\frac{1}{2}\n$$\n\nb) Mkv校正的根状态后验概率\n\nMkv模型通过以位点是可变的为条件来校正判选偏倚。Mkv后验概率由下式给出：\n$$\nP_{\\text{Mkv}}(R{=}0 \\mid D, \\text{variable}) \\propto \\pi_0 \\frac{P(D \\mid R{=}0)}{P(\\text{variable} \\mid R{=}0)}\n$$\n我们有 $P(D \\mid R{=}s) = L_s$。我们需要计算 $P(\\text{variable} \\mid R{=}s)$。一个位点是可变的，如果它不是恒定的（即，不全是0或不全是1）。\n$$\nP(\\text{variable} \\mid R{=}s) = 1 - P(\\text{all } 0 \\mid R{=}s) - P(\\text{all } 1 \\mid R{=}s)\n$$\n让我们计算在根状态为 $s$ 的条件下，恒定模式 $(0,0,0,0)$ 的概率，记为 $L_s^{\\text{all0}}$。这是一个似然计算，其中两个子树的数据都是 $(0,0)$。\n$L_0^{\\text{all0}} = [P_{00}(t)L_{N_1}(0) + P_{01}(t)L_{N_1}(1)]^2 \\approx [(1-at)(1-2at)]^2 = (1-3at)^2 \\approx 1-6at$。\n$L_1^{\\text{all0}} = [P_{10}(t)L_{N_1}(0) + P_{11}(t)L_{N_1}(1)]^2 \\approx [(bt)(1-2at)]^2 = (bt)^2 = \\mathcal{O}(t^2)$。\n\n现在计算恒定模式 $(1,1,1,1)$ 的概率，记为 $L_s^{\\text{all1}}$。两个子树的数据都是 $(1,1)$。\n$L_0^{\\text{all1}} = [P_{00}(t)L_{N_2}(0) + P_{01}(t)L_{N_2}(1)]^2 \\approx [(at)(1-2bt)]^2 = (at)^2 = \\mathcal{O}(t^2)$。\n$L_1^{\\text{all1}} = [P_{10}(t)L_{N_2}(0) + P_{11}(t)L_{N_2}(1)]^2 \\approx [(1-bt)(1-2bt)]^2 = (1-3bt)^2 \\approx 1-6bt$。\n\n因此，精确到 $t$ 的一阶：\n$P(\\text{variable} \\mid R{=}0) = 1 - L_0^{\\text{all0}} - L_0^{\\text{all1}} \\approx 1 - (1 - 6at) - \\mathcal{O}(t^2) = 6at$。\n$P(\\text{variable} \\mid R{=}1) = 1 - L_1^{\\text{all0}} - L_1^{\\text{all1}} \\approx 1 - \\mathcal{O}(t^2) - (1 - 6bt) = 6bt$。\n\n现在我们计算Mkv后验概率。Mkv似然为：\n$L_0^{\\text{Mkv}} = \\frac{L_0}{P(\\text{variable} \\mid R{=}0)} = \\frac{at}{6at} = \\frac{1}{6}$\n$L_1^{\\text{Mkv}} = \\frac{L_1}{P(\\text{variable} \\mid R{=}1)} = \\frac{bt}{6bt} = \\frac{1}{6}$\n\n经Mkv校正的 $R=0$ 的后验概率是：\n$$\nP_{\\text{Mkv}}(R{=}0 \\mid D, \\text{variable}) = \\frac{L_0^{\\text{Mkv}} \\pi_0}{L_0^{\\text{Mkv}} \\pi_0 + L_1^{\\text{Mkv}} \\pi_1} = \\frac{(\\frac{1}{6}) \\frac{b}{a+b}}{(\\frac{1}{6}) \\frac{b}{a+b} + (\\frac{1}{6}) \\frac{a}{a+b}} = \\frac{\\frac{b}{a+b}}{\\frac{b+a}{a+b}} = \\frac{b}{a+b}\n$$\n\nc) 忽略Mkv校正引起的偏倚\n\n偏倚 $\\Delta$ 定义为未校正和校正后的根状态为0的后验概率之差。\n$$\n\\Delta = P_{\\text{noMkv}}(R{=}0 \\mid D) - P_{\\text{Mkv}}(R{=}0 \\mid D, \\text{variable})\n$$\n代入(a)和(b)部分的结果：\n$$\n\\Delta = \\frac{1}{2} - \\frac{b}{a+b}\n$$\n为了简化，我们通分：\n$$\n\\Delta = \\frac{a+b}{2(a+b)} - \\frac{2b}{2(a+b)} = \\frac{a+b-2b}{2(a+b)} = \\frac{a-b}{2(a+b)}\n$$\n这个表达式代表了因未能校正判选偏倚而引起的偏倚。如果 $a>b$，偏倚为正；如果 $a<b$，偏倚为负；如果 $a=b$，偏倚为零。这表明相对于Mkv校正的结果（该结果恢复了先验概率），未校正的分析偏向于 $1/2$。",
            "answer": "$$\n\\boxed{\\frac{a-b}{2(a+b)}}\n$$"
        }
    ]
}