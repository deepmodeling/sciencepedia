{
    "hands_on_practices": [
        {
            "introduction": "演化并非总能朝着选择所偏好的方向前进，因为可用的遗传变异塑造了演化阻力最小的路径。本练习将 G 矩阵的抽象特征结构与一个具体的可测量量——最大演化响应——联系起来。通过计算，你将直观地理解为何 G 矩阵的最大特征值 $\\lambda_{\\text{max}}$ 及其对应的特征向量被认为是最大遗传方差的方向，即所谓的 $g_{\\text{max}}$。",
            "id": "2758130",
            "problem": "一个生物体表现出 $3$ 个定量性状。其加性遗传方差-协方差（G）矩阵被估计为\n$$\n\\mathbf{G} \\;=\\; \\begin{pmatrix}\n2 & 1 & 1 \\\\\n1 & 2 & 1 \\\\\n1 & 1 & 2\n\\end{pmatrix}.\n$$\n假设在一个短期、弱选择机制下，每代平均性状向量的变化量由加性遗传方差-协方差结构介导的对定向选择的线性响应给出。表型选择梯度被约束为具有固定的欧几里得范数 $b>0$，但其方向 $\\hat{\\mathbf{s}}$ 可以在 $\\|\\hat{\\mathbf{s}}\\|=1$ 的约束下自由选择。\n\n将在一个世代中，沿 $\\hat{\\mathbf{s}}$ 方向的单位选择强度下的定向响应定义为响应向量在 $\\hat{\\mathbf{s}}$ 上的标量投影除以 $b$。对于给定的 $\\mathbf{G}$，确定在所有单位方向 $\\hat{\\mathbf{s}}$ 上，此单位选择强度下的定向响应的最大可能值。\n\n请用精确的实数表示最终答案。无需四舍五入。",
            "solution": "对问题陈述进行验证。\n\n逐字提取给定条件：\n- 一个生物体表现出 $3$ 个定量性状。\n- 加性遗传方差-协方差（G）矩阵为 $\\mathbf{G} = \\begin{pmatrix} 2 & 1 & 1 \\\\ 1 & 2 & 1 \\\\ 1 & 1 & 2 \\end{pmatrix}$。\n- 选择机制是短期的和弱的。\n- 每代平均性状向量的变化量为 $\\Delta \\bar{\\mathbf{z}} = \\mathbf{G}\\boldsymbol{\\beta}$。\n- 表型选择梯度为 $\\boldsymbol{\\beta}$，被约束为具有固定的欧几里得范数 $b>0$ 和一个自由选择的方向 $\\hat{\\mathbf{s}}$，使得 $\\|\\hat{\\mathbf{s}}\\|=1$。\n- 需要最大化的量是“在一个世代中，沿 $\\hat{\\mathbf{s}}$ 方向的单位选择强度下的定向响应”，定义为响应向量在 $\\hat{\\mathbf{s}}$ 上的标量投影除以 $b$。\n\n验证结论：\n该问题具有科学依据。控制方程 $\\Delta \\bar{\\mathbf{z}} = \\mathbf{G} \\boldsymbol{\\beta}$ 是标准的多变量育种家方程，是进化数量遗传学中的一个基本概念。给定的 $\\mathbf{G}$ 矩阵是对称的。要成为一个有效的协方差矩阵，它还必须是正定的。$\\mathbf{G}$ 的特征值（我们将计算）是 $4$、$1$ 和 $1$。由于所有特征值都为正，所以 $\\mathbf{G}$ 是正定的。该问题是适定的，因为它要求一个连续函数（一个二次型）在一个紧集（单位球面）上的最大值，这个最大值保证存在。该问题是客观的，并包含获得唯一解所需的所有必要信息。该问题被宣布为有效。\n\n解：\n在定向选择下，平均性状向量的变化量 $\\Delta \\bar{\\mathbf{z}}$ 由多变量育种家方程给出：\n$$ \\Delta \\bar{\\mathbf{z}} = \\mathbf{G} \\boldsymbol{\\beta} $$\n选择梯度 $\\boldsymbol{\\beta}$ 被指定为具有大小 $b > 0$ 和由单位向量 $\\hat{\\mathbf{s}}$ 给出的方向：\n$$ \\boldsymbol{\\beta} = b \\hat{\\mathbf{s}} $$\n其中 $\\hat{\\mathbf{s}}$ 是 $\\mathbb{R}^3$ 中的一个列向量，满足 $\\|\\hat{\\mathbf{s}}\\| = \\sqrt{\\hat{\\mathbf{s}}^T \\hat{\\mathbf{s}}} = 1$。\n\n将 $\\boldsymbol{\\beta}$ 的表达式代入育种家方程，得到响应向量：\n$$ \\Delta \\bar{\\mathbf{z}} = \\mathbf{G} (b \\hat{\\mathbf{s}}) = b (\\mathbf{G} \\hat{\\mathbf{s}}) $$\n问题将“沿 $\\hat{\\mathbf{s}}$ 方向的单位选择强度下的定向响应”定义为响应向量 $\\Delta \\bar{\\mathbf{z}}$ 在选择方向 $\\hat{\\mathbf{s}}$ 上的标量投影，再除以选择强度 $b$。\n\n向量 $\\mathbf{u}$ 在单位向量 $\\mathbf{v}$ 上的标量投影由它们的点积 $\\mathbf{u} \\cdot \\mathbf{v}$ 给出。在矩阵表示法中，对于列向量 $\\mathbf{u}$ 和 $\\mathbf{v}$，其中 $\\mathbf{v}$ 是单位向量，这表示为 $\\mathbf{v}^T \\mathbf{u}$。\n因此，$\\Delta \\bar{\\mathbf{z}}$ 在 $\\hat{\\mathbf{s}}$ 上的标量投影是 $\\hat{\\mathbf{s}}^T (\\Delta \\bar{\\mathbf{z}})$。\n因此，需要最大化的量，我们称之为 $R(\\hat{\\mathbf{s}})$，是：\n$$ R(\\hat{\\mathbf{s}}) = \\frac{\\hat{\\mathbf{s}}^T (\\Delta \\bar{\\mathbf{z}})}{b} $$\n代入 $\\Delta \\bar{\\mathbf{z}}$ 的表达式：\n$$ R(\\hat{\\mathbf{s}}) = \\frac{\\hat{\\mathbf{s}}^T (b \\mathbf{G} \\hat{\\mathbf{s}})}{b} = \\hat{\\mathbf{s}}^T \\mathbf{G} \\hat{\\mathbf{s}} $$\n这个量 $\\hat{\\mathbf{s}}^T \\mathbf{G} \\hat{\\mathbf{s}}$ 代表了向量 $\\hat{\\mathbf{s}}$ 方向上的加性遗传方差，也称为在 $\\hat{\\mathbf{s}}$ 方向上的可进化性。\n\n问题现在简化为在约束条件 $\\hat{\\mathbf{s}}$ 是单位向量，即 $\\|\\hat{\\mathbf{s}}\\| = 1$（或 $\\hat{\\mathbf{s}}^T \\hat{\\mathbf{s}} = 1$）下，求函数 $R(\\hat{\\mathbf{s}}) = \\hat{\\mathbf{s}}^T \\mathbf{G} \\hat{\\mathbf{s}}$ 的最大值。\n表达式 $\\frac{\\hat{\\mathbf{s}}^T \\mathbf{G} \\hat{\\mathbf{s}}}{\\hat{\\mathbf{s}}^T \\hat{\\mathbf{s}}}$ 是矩阵 $\\mathbf{G}$ 的瑞利商。由于 $\\hat{\\mathbf{s}}^T \\hat{\\mathbf{s}} = 1$，我们实际上是在最大化瑞利商本身。\n对于任何实对称矩阵，其瑞利商的最大值是其最大特征值 $\\lambda_{\\text{max}}$。当 $\\hat{\\mathbf{s}}$ 是对应于 $\\lambda_{\\text{max}}$ 的单位特征向量时，达到此最大值。\n\n任务是求矩阵 $\\mathbf{G}$ 的特征值：\n$$ \\mathbf{G} \\;=\\; \\begin{pmatrix} 2 & 1 & 1 \\\\ 1 & 2 & 1 \\\\ 1 & 1 & 2 \\end{pmatrix} $$\n特征值 $\\lambda$ 是特征方程 $\\det(\\mathbf{G} - \\lambda I) = 0$ 的根，其中 $I$ 是 $3 \\times 3$ 的单位矩阵。\n$$ \\det \\begin{pmatrix} 2-\\lambda & 1 & 1 \\\\ 1 & 2-\\lambda & 1 \\\\ 1 & 1 & 2-\\lambda \\end{pmatrix} = 0 $$\n一个更有效的方法是识别 $\\mathbf{G}$ 的结构。我们可以将 $\\mathbf{G}$ 表示为两个更简单矩阵的和：\n$$ \\mathbf{G} = I + J $$\n其中 $I = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix}$ 是单位矩阵，而 $J = \\begin{pmatrix} 1 & 1 & 1 \\\\ 1 & 1 & 1 \\\\ 1 & 1 & 1 \\end{pmatrix}$ 是全一矩阵。\n\n大小为 $n \\times n$ 的秩为 $1$ 的矩阵 $J$ 的特征值是 $n$（重数为 $1$）和 $0$（重数为 $n-1$）。对于 $n=3$， $J$ 的特征值为 $\\{3, 0, 0\\}$。\n设 $\\mathbf{v}$ 是 $J$ 的一个特征向量，其特征值为 $\\mu_J$。那么 $J\\mathbf{v} = \\mu_J \\mathbf{v}$。\n考虑 $\\mathbf{G}$ 在这个特征向量 $\\mathbf{v}$ 上的作用：\n$$ \\mathbf{G}\\mathbf{v} = (I+J)\\mathbf{v} = I\\mathbf{v} + J\\mathbf{v} = \\mathbf{v} + \\mu_J \\mathbf{v} = (1+\\mu_J)\\mathbf{v} $$\n这表明 $\\mathbf{v}$ 也是 $\\mathbf{G}$ 的一个特征向量，其特征值为 $\\lambda_G = 1 + \\mu_J$。\n因此，$\\mathbf{G}$ 的特征值可以通过将 $J$ 的每个特征值加 $1$ 来得到。\n$\\mathbf{G}$ 的特征值是：\n$$ \\lambda_1 = 1 + 3 = 4 $$\n$$ \\lambda_2 = 1 + 0 = 1 $$\n$$ \\lambda_3 = 1 + 0 = 1 $$\n$\\mathbf{G}$ 的特征值集合是 $\\{4, 1, 1\\}$。\n\n单位选择强度下的定向响应的最大值 $R(\\hat{\\mathbf{s}}) = \\hat{\\mathbf{s}}^T \\mathbf{G} \\hat{\\mathbf{s}}$ 是 $\\mathbf{G}$ 的最大特征值。\n$$ \\max_{\\|\\hat{\\mathbf{s}}\\|=1} R(\\hat{\\mathbf{s}}) = \\lambda_{\\text{max}}(\\mathbf{G}) = 4 $$\n当选择方向 $\\hat{\\mathbf{s}}$ 与对应于特征值 $\\lambda=4$ 的特征向量对齐时，达到此最大响应。该特征向量与 $(1, 1, 1)^T$ 成正比，代表对所有三个性状进行等量增加的选择。\n\n最大可能值是一个精确的实数。",
            "answer": "$$\n\\boxed{4}\n$$"
        },
        {
            "introduction": "当某些性状组合的遗传变异完全缺失时，种群便面临着绝对的演化约束。本练习模拟了一个由发育模块化导致的“降秩”G 矩阵，这意味着性状空间中的某些维度不存在遗传方差。你将计算并发现，演化响应被严格限制在由模块向量定义的遗传子空间内，这清晰地展示了 G 矩阵的内部结构如何使种群偏离选择梯度所指向的最优路径。",
            "id": "2758135",
            "problem": "一个种群表现出$5$个数量性状，这些性状完全受加性遗传控制。发育模块化意味着遗传变异局限于两个潜在模块，在性状空间中由列向量 $\\mathbf{v}_{1}$ 和 $\\mathbf{v}_{2}$ 表示，因此遗传方差-协方差（G）矩阵等于\n$$\n\\mathbf{G} \\;=\\; \\mathbf{v}_{1}\\mathbf{v}_{1}^{\\top} \\;+\\; \\mathbf{v}_{2}\\mathbf{v}_{2}^{\\top}.\n$$\n这两个模块向量是\n$$\n\\mathbf{v}_{1} \\;=\\; \\begin{pmatrix} 2 \\\\ 0 \\\\ 1 \\\\ -1 \\\\ 0 \\end{pmatrix}, \\qquad\n\\mathbf{v}_{2} \\;=\\; \\begin{pmatrix} 0 \\\\ 1 \\\\ 1 \\\\ 0 \\\\ -1 \\end{pmatrix}.\n$$\n定向选择作用于这些性状，具有恒定的表型选择梯度\n$$\n\\boldsymbol{\\beta} \\;=\\; \\begin{pmatrix} 0.5 \\\\ -0.2 \\\\ 0.3 \\\\ 0.0 \\\\ 0.4 \\end{pmatrix}.\n$$\n假设在弱选择和恒定加性遗传结构下，满足短期进化响应的标准多变量数量遗传学条件。确定平均性状向量预期单代变化的欧几里得范数。将答案四舍五入至四位有效数字，并以无单位的纯数形式报告。",
            "solution": "所述问题具有科学依据、提法严谨且客观。为求得唯一解所需的所有数据和条件均已提供。该问题是数量遗传学中多变量育种家方程的直接应用，该方程是进化论的基石。因此，该问题适合进行分析。\n\n平均性状向量的预期单代变化（记作 $\\Delta \\bar{\\mathbf{z}}$）由多变量育种家方程决定：\n$$\n\\Delta \\bar{\\mathbf{z}} = \\mathbf{G}\\boldsymbol{\\beta}\n$$\n其中 $\\mathbf{G}$ 是加性遗传方差-协方差矩阵，$\\boldsymbol{\\beta}$ 是选择梯度。\n\n问题指明，该种群有$5$个性状，$\\mathbf{G}$矩阵由两个发育模块 $\\mathbf{v}_{1}$ 和 $\\mathbf{v}_{2}$ 构建，因此：\n$$\n\\mathbf{G} = \\mathbf{v}_{1}\\mathbf{v}_{1}^{\\top} + \\mathbf{v}_{2}\\mathbf{v}_{2}^{\\top}\n$$\n模块向量和选择梯度如下所示：\n$$\n\\mathbf{v}_{1} = \\begin{pmatrix} 2 \\\\ 0 \\\\ 1 \\\\ -1 \\\\ 0 \\end{pmatrix}, \\quad\n\\mathbf{v}_{2} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 1 \\\\ 0 \\\\ -1 \\end{pmatrix}, \\quad\n\\boldsymbol{\\beta} = \\begin{pmatrix} 0.5 \\\\ -0.2 \\\\ 0.3 \\\\ 0.0 \\\\ 0.4 \\end{pmatrix}\n$$\n为了求解进化响应 $\\Delta \\bar{\\mathbf{z}}$，我们将 $\\mathbf{G}$ 的表达式代入育种家方程：\n$$\n\\Delta \\bar{\\mathbf{z}} = (\\mathbf{v}_{1}\\mathbf{v}_{1}^{\\top} + \\mathbf{v}_{2}\\mathbf{v}_{2}^{\\top})\\boldsymbol{\\beta}\n$$\n根据矩阵乘法的结合律，上式可以重写为：\n$$\n\\Delta \\bar{\\mathbf{z}} = \\mathbf{v}_{1}(\\mathbf{v}_{1}^{\\top}\\boldsymbol{\\beta}) + \\mathbf{v}_{2}(\\mathbf{v}_{2}^{\\top}\\boldsymbol{\\beta})\n$$\n这种形式在计算上更有效率，因为它避免了显式构造 $5 \\times 5$ 的 $\\mathbf{G}$ 矩阵。它也揭示了选择响应被约束在由模块向量 $\\mathbf{v}_{1}$ 和 $\\mathbf{v}_{2}$ 所张成的子空间内。\n\n首先，我们计算选择梯度 $\\boldsymbol{\\beta}$ 在模块向量 $\\mathbf{v}_{1}$ 和 $\\mathbf{v}_{2}$ 上的标量投影。\n\n在 $\\mathbf{v}_{1}$ 上的投影为：\n$$\n\\mathbf{v}_{1}^{\\top}\\boldsymbol{\\beta} = \\begin{pmatrix} 2 & 0 & 1 & -1 & 0 \\end{pmatrix} \\begin{pmatrix} 0.5 \\\\ -0.2 \\\\ 0.3 \\\\ 0.0 \\\\ 0.4 \\end{pmatrix} = (2)(0.5) + (0)(-0.2) + (1)(0.3) + (-1)(0.0) + (0)(0.4) = 1.0 + 0 + 0.3 - 0 + 0 = 1.3\n$$\n在 $\\mathbf{v}_{2}$ 上的投影为：\n$$\n\\mathbf{v}_{2}^{\\top}\\boldsymbol{\\beta} = \\begin{pmatrix} 0 & 1 & 1 & 0 & -1 \\end{pmatrix} \\begin{pmatrix} 0.5 \\\\ -0.2 \\\\ 0.3 \\\\ 0.0 \\\\ 0.4 \\end{pmatrix} = (0)(0.5) + (1)(-0.2) + (1)(0.3) + (0)(0.0) + (-1)(0.4) = 0 - 0.2 + 0.3 - 0 - 0.4 = -0.3\n$$\n现在，我们用这些标量系数将 $\\mathbf{v}_{1}$ 和 $\\mathbf{v}_{2}$ 进行线性组合，以此构建响应向量 $\\Delta \\bar{\\mathbf{z}}$：\n$$\n\\Delta \\bar{\\mathbf{z}} = \\mathbf{v}_{1}(1.3) + \\mathbf{v}_{2}(-0.3) = 1.3 \\begin{pmatrix} 2 \\\\ 0 \\\\ 1 \\\\ -1 \\\\ 0 \\end{pmatrix} - 0.3 \\begin{pmatrix} 0 \\\\ 1 \\\\ 1 \\\\ 0 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 2.6 \\\\ 0 \\\\ 1.3 \\\\ -1.3 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ -0.3 \\\\ -0.3 \\\\ 0 \\\\ 0.3 \\end{pmatrix} = \\begin{pmatrix} 2.6 \\\\ -0.3 \\\\ 1.0 \\\\ -1.3 \\\\ 0.3 \\end{pmatrix}\n$$\n最后一步是计算响应向量 $\\Delta \\bar{\\mathbf{z}}$ 的欧几里得范数，记作 $\\|\\Delta \\bar{\\mathbf{z}}\\|$。范数是其各分量平方和的平方根：\n$$\n\\|\\Delta \\bar{\\mathbf{z}}\\| = \\sqrt{(2.6)^{2} + (-0.3)^{2} + (1.0)^{2} + (-1.3)^{2} + (0.3)^{2}}\n$$\n我们计算各分量的平方：\n$$\n(2.6)^{2} = 6.76 \\\\\n(-0.3)^{2} = 0.09 \\\\\n(1.0)^{2} = 1.00 \\\\\n(-1.3)^{2} = 1.69 \\\\\n(0.3)^{2} = 0.09\n$$\n将这些值相加：\n$$\n\\|\\Delta \\bar{\\mathbf{z}}\\|^{2} = 6.76 + 0.09 + 1.00 + 1.69 + 0.09 = 9.63\n$$\n因此，欧几里得范数为：\n$$\n\\|\\Delta \\bar{\\mathbf{z}}\\| = \\sqrt{9.63} \\approx 3.10322416\n$$\n按要求将结果四舍五入至四位有效数字，得到 $3.103$。",
            "answer": "$$\\boxed{3.103}$$"
        },
        {
            "introduction": "为了全面评估 G 矩阵的约束效应，我们需要一个超越单一指标的定量工具箱。这项综合性练习要求你编写一个程序，用以计算描述 G 矩阵与选择梯度 $\\boldsymbol{\\beta}$ 相互作用的一系列关键指标。这些指标包括沿选择方向的可演化性、响应向量的大小及其与选择方向的夹角，这让你能够从多个维度量化遗传约束的强度和性质。",
            "id": "2758140",
            "problem": "设计并实现一个程序，给定一个对称的加性遗传方差-协方差矩阵 $\\mathbf{G}$ 和一个方向性选择梯度向量 $\\boldsymbol{\\beta}$，在演化数量遗传学的多变量育种家框架下，量化可演化性（evolvability）和约束（constraint）。您必须使用的基本依据是广为接受的 Lande 多变量育种家方程，该方程指出，预期的每代性状均值响应是加性遗传方差-协方差矩阵与选择梯度的乘积。具体来说，起点是：预期的性状均值响应是向量 $\\Delta \\mathbf{z}$，由 $\\mathbf{G}$ 和 $\\boldsymbol{\\beta}$ 得出，且加性遗传方差-协方差（简写为 $\\mathbf{G}$）是对称且半正定的。您必须从这些基础以及关于协方差、线性代数和向量几何的一般知识中推导出所有要求的量，而不使用任何预先指定的快捷公式。\n\n您的程序必须为每个测试用例计算以下五个量化可演化性和约束的量：\n\n1.  沿选择方向的可演化性，其概念定义为在与 $\\boldsymbol{\\beta}$ 平行的单位方向上可用的加性遗传方差。这是加性遗传值在与 $\\boldsymbol{\\beta}$ 平行的单位向量上的投影的方差。\n\n2.  选择方向上的条件可演化性，其概念定义为：在加性遗传协方差下，为实现沿 $\\boldsymbol{\\beta}$ 单位方向的单位响应而映射所需选择时获得的曲率的倒数，这等价于获得该方向上单位响应所需的最小选择强度。如果 $\\mathbf{G}$ 不可逆，请使用 Moore–Penrose 伪逆，以确保只要该方向不完全在 $\\mathbf{G}$ 的零空间中，该量就是良定的。\n\n3.  根据 Lande 多变量育种家方程计算的响应向量的模 $\\|\\Delta \\mathbf{z}\\|_2$。这必须仅从 $\\mathbf{G}$ 和 $\\boldsymbol{\\beta}$ 计算得出。\n\n4.  响应向量 $\\Delta \\mathbf{z}$ 与选择梯度向量 $\\boldsymbol{\\beta}$ 之间的夹角，以弧度为单位。该夹角必须使用欧几里得内积和欧几里得范数计算。\n\n5.  单位选择方向与 $\\mathbf{G}$ 的主特征向量（对应于最大特征值的特征向量）之间对齐角的余弦平方值。这量化了选择与最大加性遗传方差方向的对齐程度。\n\n所有计算必须以纯数学和算法术语表示。夹角必须以弧度报告。报告所有浮点输出，四舍五入到 $6$ 位小数。\n\n您的程序必须处理以下测试套件。每个案例提供 $\\mathbf{G}$ 和 $\\boldsymbol{\\beta}$。在每个案例中，$\\mathbf{G}$ 是对称且半正定的，并且 $\\boldsymbol{\\beta} \\neq 0$。\n\n- 案例 1 (理想情况, $3 \\times 3$):\n  $$\n  \\mathbf{G} = \\begin{bmatrix}\n  0.8 & 0.2 & 0.1 \\\\\n  0.2 & 0.5 & 0.05 \\\\\n  0.1 & 0.05 & 0.3\n  \\end{bmatrix},\\quad\n  \\boldsymbol{\\beta} = \\begin{bmatrix} 0.4 \\\\ -0.2 \\\\ 0.1 \\end{bmatrix}.\n  $$\n\n- 案例 2 (近奇异轴, $3 \\times 3$):\n  $$\n  \\mathbf{G} = \\begin{bmatrix}\n  10^{-6} & 0 & 0 \\\\\n  0 & 0.4 & 0.2 \\\\\n  0 & 0.2 & 0.2\n  \\end{bmatrix},\\quad\n  \\boldsymbol{\\beta} = \\begin{bmatrix} 1 \\\\ 0 \\\\ 0 \\end{bmatrix}.\n  $$\n\n- 案例 3 (对角结构, $2 \\times 2$):\n  $$\n  \\mathbf{G} = \\begin{bmatrix}\n  0.5 & 0 \\\\\n  0 & 0.1\n  \\end{bmatrix},\\quad\n  \\boldsymbol{\\beta} = \\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix}.\n  $$\n\n- 案例 4 (具有主导子空间的强协方差, $3 \\times 3$):\n  $$\n  \\mathbf{G} = \\begin{bmatrix}\n  1.0 & 0.9 & 0 \\\\\n  0.9 & 1.0 & 0 \\\\\n  0 & 0 & 0.1\n  \\end{bmatrix},\\quad\n  \\boldsymbol{\\beta} = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\end{bmatrix}.\n  $$\n\n您的程序必须输出单行，其中包含一个列表，每个测试用例一个条目，并保持上面给出的案例顺序。每个条目本身必须是一个包含五个浮点数的列表，顺序如下：\n\n$[$ 沿选择方向的可演化性, 条件可演化性, 响应模长 $\\|\\Delta \\mathbf{z}\\|_2$, $\\Delta \\mathbf{z}$ 与 $\\boldsymbol{\\beta}$ 之间的夹角（弧度）, 与主特征向量的对齐余弦平方值 $]$,\n\n全部四舍五入到 $6$ 位小数。最终输出必须是单行，格式完全一致（无空格）：\n\n$[ [x_{11},x_{12},x_{13},x_{14},x_{15}], [x_{21},x_{22},x_{23},x_{24},x_{25}], [x_{31},x_{32},x_{33},x_{34},x_{35}], [x_{41},x_{42},x_{43},x_{44},x_{45}] ]$\n\n作为一个用方括号括起来的逗号分隔列表。将每个 $x_{ij}$ 替换为您为案例 $i$ 和量 $j$ 计算并四舍五入的浮点数。",
            "solution": "该问题要求基于基础的 Lande 多变量育种家方程 $\\Delta \\mathbf{z} = \\mathbf{G} \\boldsymbol{\\beta}$ 计算可演化性和约束的五个定量指标。在这里，$\\Delta \\mathbf{z}$ 是性状均值的演化响应向量，$\\mathbf{G}$ 是对称、半正定的加性遗传方差-协方差矩阵，而 $\\boldsymbol{\\beta}$ 是方向性选择梯度向量。每个指标的推导必须基于应用于演化理论的线性代数和统计学第一性原理。\n\n我们获得了几个测试用例的矩阵 $\\mathbf{G}$ 和向量 $\\boldsymbol{\\beta}$。所有矩阵 $\\mathbf{G}$ 都被说明为对称且半正定的，并且 $\\boldsymbol{\\beta} \\neq 0$。\n\n首先，让我们建立选择方向上的单位向量，这对所要求的几个量都至关重要。该向量记为 $\\hat{\\boldsymbol{\\beta}}$，计算如下：\n$$ \\hat{\\boldsymbol{\\beta}} = \\frac{\\boldsymbol{\\beta}}{\\|\\boldsymbol{\\beta}\\|_2} $$\n其中 $\\|\\boldsymbol{\\beta}\\|_2 = \\sqrt{\\boldsymbol{\\beta}^T \\boldsymbol{\\beta}}$ 是 $\\boldsymbol{\\beta}$ 的欧几里得范数。\n\n我们现在将推导所要求的五个量的表达式。\n\n**1. 沿选择方向的可演化性**\n\n该量在概念上定义为选择方向上的加性遗传方差。设 $\\mathbf{a}$ 为性状的加性遗传值随机向量，其协方差矩阵为 $\\text{cov}(\\mathbf{a}) = \\mathbf{G}$。$\\mathbf{a}$ 在选择单位方向 $\\hat{\\boldsymbol{\\beta}}$ 上的投影是一个标量随机变量 $p_{a}$，由点积给出：\n$$ p_a = \\mathbf{a}^T \\hat{\\boldsymbol{\\beta}} $$\n我们要求的是这个投影值的方差。使用随机向量线性变换的方差标准公式 $V(\\mathbf{C}^T \\mathbf{X}) = \\mathbf{C}^T \\text{cov}(\\mathbf{X}) \\mathbf{C}$，我们可以代入 $\\mathbf{X}=\\mathbf{a}$ 和 $\\mathbf{C}=\\hat{\\boldsymbol{\\beta}}$：\n$$ V(p_a) = \\hat{\\boldsymbol{\\beta}}^T \\text{cov}(\\mathbf{a}) \\hat{\\boldsymbol{\\beta}} = \\hat{\\boldsymbol{\\beta}}^T \\mathbf{G} \\hat{\\boldsymbol{\\beta}} $$\n代入 $\\hat{\\boldsymbol{\\beta}}$ 的表达式，我们得到沿选择方向的可演化性的公式，我们将其表示为 $e(\\boldsymbol{\\beta})$：\n$$ e(\\boldsymbol{\\beta}) = \\left( \\frac{\\boldsymbol{\\beta}}{\\|\\boldsymbol{\\beta}\\|_2} \\right)^T \\mathbf{G} \\left( \\frac{\\boldsymbol{\\beta}}{\\|\\boldsymbol{\\beta}\\|_2} \\right) = \\frac{\\boldsymbol{\\beta}^T \\mathbf{G} \\boldsymbol{\\beta}}{\\boldsymbol{\\beta}^T \\boldsymbol{\\beta}} $$\n该表达式是矩阵 $\\mathbf{G}$ 对向量 $\\boldsymbol{\\beta}$ 的瑞利商（Rayleigh quotient）。\n\n**2. 选择方向上的条件可演化性**\n\n该量被描述为与“获得该方向上单位响应所需的最小选择强度”相关。数量遗传学中的一个标准解释是根据选择成本来定义它。要实现特定的响应向量 $\\boldsymbol{\\delta}$，所需的选择梯度为 $\\boldsymbol{\\beta}_{\\text{req}} = \\mathbf{G}^+ \\boldsymbol{\\delta}$，其中 $\\mathbf{G}^+$是 $\\mathbf{G}$ 的 Moore-Penrose 伪逆。为了在 $\\hat{\\boldsymbol{\\beta}}$ 方向上实现单位大小的响应，我们设 $\\boldsymbol{\\delta} = \\hat{\\boldsymbol{\\beta}}$。这种选择的“成本”可以通过它所引起的适应度方差来衡量，由 $\\boldsymbol{\\beta}_{\\text{req}}^T \\mathbf{G} \\boldsymbol{\\beta}_{\\text{req}}$ 给出。\n让我们计算这个成本：\n$$ \\text{Cost} = (\\mathbf{G}^+ \\hat{\\boldsymbol{\\beta}})^T \\mathbf{G} (\\mathbf{G}^+ \\hat{\\boldsymbol{\\beta}}) = \\hat{\\boldsymbol{\\beta}}^T (\\mathbf{G}^+)^T \\mathbf{G} \\mathbf{G}^+ \\hat{\\boldsymbol{\\beta}} $$\n使用性质 $(\\mathbf{G}^+)^T = ((\\mathbf{G})^T)^+ = \\mathbf{G}^+$（因为 $\\mathbf{G}$ 是对称的）和 $\\mathbf{G}^+ \\mathbf{G} \\mathbf{G}^+ = \\mathbf{G}^+$，这可以简化为：\n$$ \\text{Cost} = \\hat{\\boldsymbol{\\beta}}^T \\mathbf{G}^+ \\hat{\\boldsymbol{\\beta}} $$\n条件可演化性，记为 $c(\\boldsymbol{\\beta})$，定义为此成本的倒数。\n$$ c(\\boldsymbol{\\beta}) = \\frac{1}{\\hat{\\boldsymbol{\\beta}}^T \\mathbf{G}^+ \\hat{\\boldsymbol{\\beta}}} = \\frac{1}{\\left( \\frac{\\boldsymbol{\\beta}}{\\|\\boldsymbol{\\beta}\\|_2} \\right)^T \\mathbf{G}^+ \\left( \\frac{\\boldsymbol{\\beta}}{\\|\\boldsymbol{\\beta}\\|_2} \\right)} = \\frac{\\boldsymbol{\\beta}^T \\boldsymbol{\\beta}}{\\boldsymbol{\\beta}^T \\mathbf{G}^+ \\boldsymbol{\\beta}} $$\n根据问题要求使用伪逆，即使在 $\\mathbf{G}$ 是奇异的情况下，这个公式也是稳健且良定的。\n\n**3. 响应向量的模, $\\|\\Delta \\mathbf{z}\\|_2$**\n\n这是 Lande 方程的直接应用。首先，我们计算响应向量 $\\Delta \\mathbf{z}$：\n$$ \\Delta \\mathbf{z} = \\mathbf{G} \\boldsymbol{\\beta} $$\n然后，我们计算其欧几里得范数：\n$$ \\|\\Delta \\mathbf{z}\\|_2 = \\sqrt{ (\\Delta \\mathbf{z})^T (\\Delta \\mathbf{z}) } = \\sqrt{ (\\mathbf{G}\\boldsymbol{\\beta})^T (\\mathbf{G}\\boldsymbol{\\beta}) } = \\sqrt{ \\boldsymbol{\\beta}^T \\mathbf{G}^T \\mathbf{G} \\boldsymbol{\\beta} } $$\n由于 $\\mathbf{G}$ 是对称的（$\\mathbf{G}^T = \\mathbf{G}$），这等价于 $\\sqrt{\\boldsymbol{\\beta}^T \\mathbf{G}^2 \\boldsymbol{\\beta}}$。在计算上，最直接的方法是先计算向量 $\\Delta \\mathbf{z} = \\mathbf{G}\\boldsymbol{\\beta}$，然后求其范数。\n\n**4. 响应向量 $\\Delta \\mathbf{z}$ 与选择梯度 $\\boldsymbol{\\beta}$ 之间的夹角**\n\n两个非零向量 $\\mathbf{u}$ 和 $\\mathbf{v}$ 之间的夹角 $\\theta$ 由欧几里得内积推导的公式给出：\n$$ \\cos(\\theta) = \\frac{\\mathbf{u}^T \\mathbf{v}}{\\|\\mathbf{u}\\|_2 \\|\\mathbf{v}\\|_2} $$\n在我们的情况下，$\\mathbf{u} = \\Delta \\mathbf{z} = \\mathbf{G}\\boldsymbol{\\beta}$ 和 $\\mathbf{v} = \\boldsymbol{\\beta}$。因此，夹角是：\n$$ \\theta = \\arccos\\left( \\frac{(\\mathbf{G}\\boldsymbol{\\beta})^T \\boldsymbol{\\beta}}{\\|\\mathbf{G}\\boldsymbol{\\beta}\\|_2 \\|\\boldsymbol{\\beta}\\|_2} \\right) = \\arccos\\left( \\frac{\\boldsymbol{\\beta}^T \\mathbf{G} \\boldsymbol{\\beta}}{\\|\\mathbf{G}\\boldsymbol{\\beta}\\|_2 \\|\\boldsymbol{\\beta}\\|_2} \\right) $$\n$\\theta$ 的值量化了演化响应与选择方向对齐的程度。$\\theta = 0$ 的值表示完全对齐，而 $\\theta > 0$ 表示遗传相关（$\\mathbf{G}$ 的非对角元素）导致种群向不同于选择所偏好的方向演化。由于 $\\mathbf{G}$ 是半正定的，$\\boldsymbol{\\beta}^T \\mathbf{G} \\boldsymbol{\\beta} \\geq 0$，因此夹角 $\\theta$ 的范围将在 $[0, \\pi/2]$ 弧度内。\n\n**5. 与主特征向量对齐角的余弦平方值**\n\n该指标评估选择方向与最大遗传方差方向的对齐程度。$\\mathbf{G}$ 的特征向量代表遗传变异的主轴，相应的特征值代表沿这些轴的方差量。\n计算该值的步骤如下：\n1.  对对称矩阵 $\\mathbf{G}$ 进行特征分解，以找到其特征值 $\\lambda_i$ 和相应的特征向量 $\\mathbf{v}_i$。\n2.  确定主特征向量 $\\mathbf{v}_{\\text{max}}$，即对应于最大特征值 $\\lambda_{\\text{max}}$ 的特征向量。该向量代表最大加性遗传方差的方向（$g_{max}$）。我们假设它被归一化为单位长度，即 $\\|\\mathbf{v}_{\\text{max}}\\|_2 = 1$。\n3.  将选择梯度向量归一化，得到单位选择方向, $\\hat{\\boldsymbol{\\beta}} = \\boldsymbol{\\beta} / \\|\\boldsymbol{\\beta}\\|_2$。\n4.  $\\mathbf{v}_{\\text{max}}$ 和 $\\hat{\\boldsymbol{\\beta}}$ 之间夹角 $\\phi$ 的余弦是它们的点积：$\\cos(\\phi) = \\mathbf{v}_{\\text{max}}^T \\hat{\\boldsymbol{\\beta}}$。\n5.  所要求的量是此余弦的平方：\n$$ (\\cos(\\phi))^2 = (\\mathbf{v}_{\\text{max}}^T \\hat{\\boldsymbol{\\beta}})^2 $$\n这个值范围从 $0$到 $1$，用于衡量对齐程度。值为 $1$ 表示选择作用于最大遗传方差的方向，而值为 $0$ 表示其作用方向与该方向正交。\n\n这五个推导出的公式构成了计算实现的基础。每个公式都将针对给定的测试用例进行计算。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem for all test cases and prints the formatted output.\n    \"\"\"\n    test_cases = [\n        {\n            \"G\": np.array([\n                [0.8, 0.2, 0.1],\n                [0.2, 0.5, 0.05],\n                [0.1, 0.05, 0.3]\n            ]),\n            \"beta\": np.array([0.4, -0.2, 0.1])\n        },\n        {\n            \"G\": np.array([\n                [1e-6, 0, 0],\n                [0, 0.4, 0.2],\n                [0, 0.2, 0.2]\n            ]),\n            \"beta\": np.array([1, 0, 0])\n        },\n        {\n            \"G\": np.array([\n                [0.5, 0],\n                [0, 0.1]\n            ]),\n            \"beta\": np.array([1, 1])\n        },\n        {\n            \"G\": np.array([\n                [1.0, 0.9, 0],\n                [0.9, 1.0, 0],\n                [0, 0, 0.1]\n            ]),\n            \"beta\": np.array([0, 0, 1])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        G = case[\"G\"]\n        beta = case[\"beta\"]\n        \n        # --- 1. Evolvability along the direction of selection ---\n        # Formula: (beta.T @ G @ beta) / (beta.T @ beta)\n        beta_T_beta = beta.T @ beta\n        beta_T_G_beta = beta.T @ G @ beta\n        evolvability = beta_T_G_beta / beta_T_beta\n\n        # --- 2. Conditional evolvability in the direction of selection ---\n        # Formula: (beta.T @ beta) / (beta.T @ G+ @ beta)\n        G_pinv = np.linalg.pinv(G)\n        beta_T_G_pinv_beta = beta.T @ G_pinv @ beta\n        # Handle the case where beta is in the null space of G+\n        if np.isclose(beta_T_G_pinv_beta, 0):\n            conditional_evolvability = np.inf\n        else:\n            conditional_evolvability = beta_T_beta / beta_T_G_pinv_beta\n\n        # --- 3. Magnitude of the response vector ---\n        # Formula: ||G @ beta||\n        delta_z = G @ beta\n        response_magnitude = np.linalg.norm(delta_z)\n\n        # --- 4. Angle between response vector and selection gradient ---\n        # Formula: arccos((delta_z.T @ beta) / (||delta_z|| * ||beta||))\n        beta_norm = np.linalg.norm(beta)\n        # Note: (G @ beta).T @ beta is the same as beta.T @ G @ beta since G is symmetric\n        cos_theta_numerator = beta_T_G_beta\n        cos_theta_denominator = response_magnitude * beta_norm\n        \n        # Clip to handle potential floating point inaccuracies leading to values just outside [-1, 1]\n        if np.isclose(cos_theta_denominator, 0):\n            # If beta or delta_z is a zero vector, angle is undefined.\n            # Problem statement says beta != 0. If delta_z is 0, angle is 0.\n            angle = 0.0\n        else:\n            cos_theta = np.clip(cos_theta_numerator / cos_theta_denominator, -1.0, 1.0)\n            angle = np.arccos(cos_theta)\n        \n        # --- 5. Squared cosine of alignment with the leading eigenvector ---\n        # Formula: (v_max.T @ beta_hat)^2\n        # Use eigh for symmetric matrices; it returns eigenvalues in ascending order.\n        eigenvalues, eigenvectors = np.linalg.eigh(G)\n        leading_eigenvector = eigenvectors[:, -1]\n        beta_unit = beta / beta_norm\n        dot_product_alignment = leading_eigenvector.T @ beta_unit\n        sq_cos_alignment = dot_product_alignment**2\n\n        # Collect and round results\n        case_results = [\n            evolvability,\n            conditional_evolvability,\n            response_magnitude,\n            angle,\n            sq_cos_alignment\n        ]\n        \n        results.append(case_results)\n\n    # Format the final output string according to the spec (no spaces)\n    output_parts = []\n    for res_list in results:\n        # Round each value to 6 decimal places before converting to string\n        inner_str = f\"[{','.join([f'{round(val, 6):.6f}' for val in res_list])}]\"\n        output_parts.append(inner_str)\n    \n    final_output = f\"[{','.join(output_parts)}]\"\n    print(final_output)\n\nsolve()\n\n```"
        }
    ]
}