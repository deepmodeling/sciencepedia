{
    "hands_on_practices": [
        {
            "introduction": "要理解物种形成，就需要量化阻止种群间基因流动的各种障碍。本练习提供了一个基础性的动手实践，教你如何使用一个标准的乘法框架，来计算从交配行为到杂种生存能力等不同生殖障碍的强度。通过解决这个问题 ，你将学会如何剖析原始实验数据，以确定生殖隔离的累积强度，并识别出贡献最显著的隔离阶段。",
            "id": "2839957",
            "problem": "一项比较杂交实验量化了两个物种间相对于同种基线的合子前和合子后生殖屏障的强度。请使用以下基本定义。\n\n1.  在特定阶段的生殖隔离（Reproductive Isolation, RI）定义为，该阶段的种间过渡概率相对于同种基线过渡概率的比例性减少。如果 $p_{\\mathrm{H},i}$ 是（在到达阶段 $i$ 的条件下）通过阶段 $i$ 的种间概率，而 $p_{\\mathrm{C},i}$ 是相应的同种基线概率，那么阶段 $i$ 的隔离组分是 $I_i = 1 - \\dfrac{p_{\\mathrm{H},i}}{p_{\\mathrm{C},i}}$。\n2.  跨阶段的累积生殖隔离以乘积形式定义为 $I_{\\mathrm{total}} = 1 - \\prod_{i} (1 - I_i)$，这等同于1减去所有阶段的种间与同种过渡概率比率的乘积。\n\n您获得了来自标准化分析的以下计数数据：\n\n- 异种（种间）系列：交配尝试 $100$ 次，交尾 $60$ 次，受精 $10$ 次，存活后代 $4$ 个。\n- 同种基线系列：交配尝试 $100$ 次，交尾 $95$ 次，受精 $90$ 次，存活后代 $85$ 个。\n\n请定义四个阶段，并使用上述框架计算它们的隔离组分：\n- 交配（相遇/机会）：从基线机会到交配尝试。\n- 交尾（交配前行为/机械性）：从尝试到交尾。\n- 配子（交尾后合子前）：从交尾到受精。\n- 内在生存能力（合子后）：从受精到存活后代。\n\n然后使用乘积框架计算累积隔离 $I_{\\mathrm{total}}$。\n\n仅报告累积隔离 $I_{\\mathrm{total}}$，结果为无单位小数，并四舍五入到四位有效数字。",
            "solution": "问题陈述科学合理，逻辑一致，并为得出唯一解提供了充分信息。量化生殖隔离 ($RI$) 的框架是演化遗传学领域的标准方法。我们将着手进行计算。\n\n问题定义了繁殖过程中的四个离散阶段，并要求计算各阶段的生殖隔离和累积生殖隔离。设下标 $H$ 表示异种杂交，下标 $C$ 表示同种杂交。每个阶段过渡的计数数据如下：\n\n- 异种系列：\n  - 初始交配尝试次数：$N_{\\mathrm{attempts, H}} = 100$\n  - 交尾次数：$N_{\\mathrm{copulations, H}} = 60$\n  - 受精次数：$N_{\\mathrm{fertilizations, H}} = 10$\n  - 存活后代数：$N_{\\mathrm{offspring, H}} = 4$\n\n- 同种系列：\n  - 初始交配尝试次数：$N_{\\mathrm{attempts, C}} = 100$\n  - 交尾次数：$N_{\\mathrm{copulations, C}} = 95$\n  - 受精次数：$N_{\\mathrm{fertilizations, C}} = 90$\n  - 存活后代数：$N_{\\mathrm{offspring, C}} = 85$\n\n给定阶段 $i$ 的过渡概率 $p_i$ 是成功完成该阶段的个体数与进入该阶段的个体数之比。\n\n定义的四个阶段是：\n1.  **交配 ($I_1$)**：从基线机会到交配尝试。\n2.  **交尾 ($I_2$)**：从尝试到交尾。\n3.  **配子 ($I_3$)**：从交尾到受精。\n4.  **内在生存能力 ($I_4$)**：从受精到存活后代。\n\n我们首先计算每个阶段 $i$ 的条件过渡概率（$p_{\\mathrm{H},i}$ 和 $p_{\\mathrm{C},i}$）。\n\n**阶段1：交配**\n问题将此阶段定义为从“基线机会”到“交配尝试”的过渡。两个系列的交配尝试次数均为 $100$。设未说明的基线机会数量为 $N_{opp}$。由于两个实验系列的初始条件相同，因此概率为 $p_{\\mathrm{H},1} = \\frac{100}{N_{opp}}$ 和 $p_{\\mathrm{C},1} = \\frac{100}{N_{opp}}$。比率 $\\frac{p_{\\mathrm{H},1}}{p_{\\mathrm{C},1}} = 1$。隔离组分为 $I_1 = 1 - \\frac{p_{\\mathrm{H},1}}{p_{\\mathrm{C},1}} = 1 - 1 = 0$。这表明在此阶段没有隔离，符合对照实验设计的预期。\n\n**阶段2：交尾**\n这是在有交配尝试的情况下，成功交尾的概率。\n$$ p_{\\mathrm{H},2} = \\frac{N_{\\mathrm{copulations, H}}}{N_{\\mathrm{attempts, H}}} = \\frac{60}{100} = 0.6 $$\n$$ p_{\\mathrm{C},2} = \\frac{N_{\\mathrm{copulations, C}}}{N_{\\mathrm{attempts, C}}} = \\frac{95}{100} = 0.95 $$\n\n**阶段3：配子**\n这是在成功交尾的情况下，成功受精的概率。\n$$ p_{\\mathrm{H},3} = \\frac{N_{\\mathrm{fertilizations, H}}}{N_{\\mathrm{copulations, H}}} = \\frac{10}{60} = \\frac{1}{6} $$\n$$ p_{\\mathrm{C},3} = \\frac{N_{\\mathrm{fertilizations, C}}}{N_{\\mathrm{copulations, C}}} = \\frac{90}{95} = \\frac{18}{19} $$\n\n**阶段4：内在生存能力**\n这是在成功受精的情况下，产生存活后代的概率。\n$$ p_{\\mathrm{H},4} = \\frac{N_{\\mathrm{offspring, H}}}{N_{\\mathrm{fertilizations, H}}} = \\frac{4}{10} = 0.4 $$\n$$ p_{\\mathrm{C},4} = \\frac{N_{\\mathrm{offspring, C}}}{N_{\\mathrm{fertilizations, C}}} = \\frac{85}{90} = \\frac{17}{18} $$\n\n累积生殖隔离 $I_{\\mathrm{total}}$ 定义为：\n$$ I_{\\mathrm{total}} = 1 - \\prod_{i=1}^{4} (1 - I_i) $$\n其中 $I_i = 1 - \\frac{p_{\\mathrm{H},i}}{p_{\\mathrm{C},i}}$。这意味着 $(1 - I_i) = \\frac{p_{\\mathrm{H},i}}{p_{\\mathrm{C},i}}$。\n因此，累积隔离的公式可以表示为：\n$$ I_{\\mathrm{total}} = 1 - \\left( \\frac{p_{\\mathrm{H},1}}{p_{\\mathrm{C},1}} \\times \\frac{p_{\\mathrm{H},2}}{p_{\\mathrm{C},2}} \\times \\frac{p_{\\mathrm{H},3}}{p_{\\mathrm{C},3}} \\times \\frac{p_{\\mathrm{H},4}}{p_{\\mathrm{C},4}} \\right) $$\n条件概率比率的乘积等同于跨所有阶段的总成功概率的比率。设 $P_H$ 和 $P_C$ 是从一个基线机会产生存活后代的总概率。\n$$ P_{\\mathrm{H}} = p_{\\mathrm{H},1} \\times p_{\\mathrm{H},2} \\times p_{\\mathrm{H},3} \\times p_{\\mathrm{H},4} = \\frac{100}{N_{opp}} \\times \\frac{60}{100} \\times \\frac{10}{60} \\times \\frac{4}{10} = \\frac{4}{N_{opp}} $$\n$$ P_{\\mathrm{C}} = p_{\\mathrm{C},1} \\times p_{\\mathrm{C},2} \\times p_{\\mathrm{C},3} \\times p_{\\mathrm{C},4} = \\frac{100}{N_{opp}} \\times \\frac{95}{100} \\times \\frac{90}{95} \\times \\frac{85}{90} = \\frac{85}{N_{opp}} $$\n$I_{\\mathrm{total}}$ 方程式中的乘积项简化为：\n$$ \\prod_{i=1}^{4} (1 - I_i) = \\frac{P_H}{P_C} = \\frac{4/N_{opp}}{85/N_{opp}} = \\frac{4}{85} $$\n这个结果也可以通过直接计算最终存活后代数量的比值来得到，因为两个系列的初始机会数量是相同的。\n\n现在我们计算 $I_{\\mathrm{total}}$ 的最终值：\n$$ I_{\\mathrm{total}} = 1 - \\frac{4}{85} = \\frac{85 - 4}{85} = \\frac{81}{85} $$\n将此分数转换为小数得出：\n$$ I_{\\mathrm{total}} = 0.952941176... $$\n问题要求答案四舍五入到四位有效数字。第五位有效数字是 $4$，因此我们不对第四位进行进位。\n$$ I_{\\mathrm{total}} \\approx 0.9529 $$\n该值表示相对于同种基线，异种杂交的繁殖成功率降低了 $95.29\\%$。",
            "answer": "$$\\boxed{0.9529}$$"
        },
        {
            "introduction": "合子后隔离通常源于在异域种群中分化的基因之间发生的负面上位性相互作用，这一概念在Dobzhansky-Muller不相容性（DMI）模型中被形式化。本题要求你推导一个经典的隐性-隐性 DMI 在不同杂交世代（$F_1$、$F_2$ 和回交）中的预期适合度后果。通过完成此练习 ，你将具体理解杂种不育性是如何从特定的基因型组合中产生的，以及为何其效应在早期杂交世代中常常被掩盖。",
            "id": "2733099",
            "problem": "考虑一个二倍体生物，其拥有两个双等位基因座，等位基因分别记为 $A/a$ 和 $B/b$。两个异域亲本种群在这些基因座上固定了不同的衍生等位基因：种群 $P_{1}$ 固定为 $A A b b$，种群 $P_{2}$ 固定为 $a a B B$。假设遵循标准的孟德尔减数分裂，在指定情况下进行随机交配。同时假设，除了一种在两个基因座上均表现为隐性效应的双基因座Dobzhansky–Muller不相容性（DMI）外，不存在其他生存力选择。“隐性-隐性DMI”指的是，该不相容性仅在对两个衍生等位基因 $A$ 和 $B$ 均为纯合的个体中使相对适合度降低一个分数 $s$，即基因型 $A A B B$ 的相对适合度为 $1 - s$，而所有其他基因型的相对适合度为 $1$。这两个基因座位于同一条染色体上，它们之间的重组率为 $r \\in [0,1/2]$。\n\n将亲本种群杂交以产生 $F_{1}$ 代杂交体，然后通过 $F_{1}$ 个体间的随机交配产生 $F_{2}$ 代。此外，通过将 $F_{1}$ 个体与每个亲本种群（$F_{1} \\times P_{1}$ 和 $F_{1} \\times P_{2}$）交配，产生两种回交。在上述假设下，并忽略所有其他演化力，推导以下四种杂交类型的期望平均相对适合度：$F_{1}$、$F_{2}$、与 $P_{1}$ 的回交、与 $P_{2}$ 的回交，将其表示为 $s$ 和 $r$ 的函数。\n\n将最终答案表示为按 $\\big(F_{1}, F_{2}, \\text{backcross to } P_{1}, \\text{backcross to } P_{2}\\big)$ 顺序排列的单行矩阵。不要四舍五入。在表达式中仅使用符号 $s$ 和 $r$ 以及有理数。\n\n最后，简要解释您推导出的模式是否与这些杂交类型中隐性-隐性DMI的经验预期一致，但不要将此解释包含在您的最终数值答案中。",
            "solution": "经评估，该问题陈述是有效的。其科学基础在于种群遗传学与演化遗传学的原理，特别是关于合子后隔离的Dobzhansky–Muller模型。该问题提法恰当、客观且自洽，所有必要的参数和条件均已明确定义。陈述中没有矛盾、歧义或事实性错误。因此，将推导其解。\n\n目标是求出四种杂交类型的期望平均相对适合度 $\\bar{w}$。一个种群的平均相对适合度，由各种基因型的适合度按其频率加权求和得出：$\\bar{w} = \\sum_{i} f_{i} w_{i}$。\n问题指定了一种隐性-隐性Dobzhansky–Muller不相容性（DMI），其中只有基因型 $A A B B$ 的相对适合度降低，为 $w_{AABB} = 1 - s$。所有其他基因型的相对适合度均为_1_。因此，平均适合度可以计算为：\n$$ \\bar{w} = (1 - f(A A B B)) \\times 1 + f(A A B B) \\times (1 - s) = 1 - f(A A B B) + f(A A B B) - s \\cdot f(A A B B) $$\n$$ \\bar{w} = 1 - s \\cdot f(A A B B) $$\n因此，问题简化为在每个指定世代中，求出基因型 $A A B B$ 的期望频率 $f(A A B B)$。亲本种群为基因型是 $A A b b$ 的 $P_{1}$ 和基因型是 $a a B B$ 的 $P_{2}$。\n\n首先，我们考虑 $F_{1}$ 代。该代是通过两个亲本种群杂交产生的：$P_{1}(A A b b) \\times P_{2}(a a B B)$。$P_{1}$ 亲本只产生 $A b$ 配子，$P_{2}$ 亲本只产生 $a B$ 配子。因此，$F_{1}$ 代的所有个体都将是 $A a B b$ 基因型。所以基因型 $A A B B$ 的频率为 $f_{F1}(A A B B) = 0$。$F_{1}$ 代的平均相对适合度为：\n$$ \\bar{w}_{F1} = 1 - s \\cdot f_{F1}(A A B B) = 1 - s \\cdot 0 = 1 $$\n\n其次，我们分析 $F_{2}$ 代，它通过 $F_{1}$ 个体的随机交配产生：$F_{1}(A a B b) \\times F_{1}(A a B b)$。$F_{1}$ 个体在两个基因座上均为杂合，且等位基因处于相斥相（或反式），因为它们的基因型是由 $A b$ 和 $a B$ 配子形成的。因此，染色体排布为 $A b / a B$。两个基因座间的重组率为 $r$。一个 $F_{1}$ 个体产生四种类型的配子，其频率如下：\n- 亲本型配子：$f(A b) = \\frac{1-r}{2}$ 和 $f(a B) = \\frac{1-r}{2}$。\n- 重组型配子：$f(A B) = \\frac{r}{2}$ 和 $f(a b) = \\frac{r}{2}$。\n不相容的基因型 $A A B B$ 是由两个 $A B$ 配子融合形成的。在随机交配下，该基因型的期望频率是配子频率的乘积：\n$$ f_{F2}(A A B B) = f(A B) \\times f(A B) = \\left(\\frac{r}{2}\\right) \\left(\\frac{r}{2}\\right) = \\frac{r^{2}}{4} $$\n$F_{2}$ 代的平均相对适合度为：\n$$ \\bar{w}_{F2} = 1 - s \\cdot f_{F2}(A A B B) = 1 - s \\frac{r^{2}}{4} $$\n\n第三，我们考察与亲本 $P_{1}$ 的回交（BC1），即杂交 $F_{1}(A a B b) \\times P_{1}(A A b b)$。要产生基因型为 $A A B B$ 的后代，它必须从每个亲本那里都继承 $B$ 等位基因。$P_{1}$ 亲本的基因型为 $A A b b$，只能产生 $A b$ 配子。它不能提供 $B$ 等位基因。因此，不可能形成 $B B$ 纯合子，从而也不可能形成 $A A B B$ 基因型。基因型 $A A B B$ 的频率为 $f_{BC1}(A A B B) = 0$。平均相对适合度为：\n$$ \\bar{w}_{BC1} = 1 - s \\cdot f_{BC1}(A A B B) = 1 - s \\cdot 0 = 1 $$\n\n第四，我们考察与亲本 $P_{2}$ 的回交（BC2），即杂交 $F_{1}(A a B b) \\times P_{2}(a a B B)$。要产生基因型为 $A A B B$ 的后代，后代必须为 $A$ 等位基因的纯合子。这需要从每个亲本那里都继承一个 $A$ 等位基因。$P_{2}$ 亲本的基因型为 $a a B B$，只能产生 $a B$ 配子。它不能提供 $A$ 等位基因。因此，不可能形成 $A A$ 纯合子，从而也不可能形成 $A A B B$ 基因型。基因型 $A A B B$ 的频率为 $f_{BC2}(A A B B) = 0$。平均相对适合度为：\n$$ \\bar{w}_{BC2} = 1 - s \\cdot f_{BC2}(A A B B) = 1 - s \\cdot 0 = 1 $$\n\n总之，四种杂交的期望平均相对适合度为 $(\\bar{w}_{F1}, \\bar{w}_{F2}, \\bar{w}_{BC1}, \\bar{w}_{BC2})$。\n\n最后，关于解释，所推导出的适合度模式——在$F_{1}$代或回交世代中没有降低，但在$F_{2}$代中有所降低——是隐性-隐性DMI的典型特征。$F_{1}$代因杂合性而受到保护。回交世代受到保护，因为每个亲本种群在两个基因座中的一个上为祖先等位基因的纯合体，这阻止了双衍生纯合基因型（$A A B B$）的形成。适合度崩溃仅发生在$F_{2}$代，在这一代中，重组可以产生 $A B$ 配子，这些配子随后可以结合形成不相容的 $A A B B$ 基因型。这种崩溃的严重程度取决于重组率 $r$，对于非连锁基因座（$r=1/2$）时最严重，而对于完全连锁基因座（$r=0$）时则不存在。这种理论模式是此类遗传不相容性的基准预期，并且与物种形成遗传学中的经验性发现相符。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 1 & 1 - \\frac{s r^{2}}{4} & 1 & 1 \\end{pmatrix} } $$"
        },
        {
            "introduction": "基因调控的演化是物种形成的主要驱动力，而调控不相容性是DMI的一个关键类别。这个实践练习介绍了一种强大的现代技术，它利用杂交体的等位基因特异性表达数据来区分$\\textit{cis}$- 和$\\textit{trans}$-调控分化。通过实施所提供的分析框架 ，你将学会如何解读基因组数据，以对调控演化的模式进行分类，并识别潜在的杂种表达异常——这是生殖隔离的直接成因。",
            "id": "2733077",
            "problem": "给定一组基因座的简化核糖核酸测序（RNA-seq）读数计数摘要，每个基因座都在两个亲本物种中以及在其第一代杂交体中作为等位基因特异性计数进行了测量。目标是利用等位基因特异性表达，将调控差异分为顺式调控、反式调控或两者兼有，并标记出可能导致生殖隔离的潜在调控不相容性。\n\n基本原理和假设：\n- 基因表达受与基因连锁的顺式作用元件和诸如可扩散转录因子等反式作用因子的共同调控。在F1代杂交体中，一个基因座的两个等位基因处于一个共同的反式环境中；因此，它们在杂交体内部等位基因特异性表达的任何一致性差异都反映了顺式调控差异。亲本物种间总表达量的差异，如果不能由杂交体中等位基因特异性表达的差异来解释，则反映了反式调控差异。\n- 在以2为底的对数尺度上处理比率和差异，以使倍数变化（fold changes）具有可加性。为避免任何计数为零时出现未定义的比率，在计算任何比率或对数之前，为每个计数值添加一个伪计数 $p = 0.5$。\n\n每个测试基因座的输入：\n- 亲本总数：$E_1$（物种1），$E_2$（物种2）。\n- 杂交体等位基因特异性计数：$H_1$（来自物种1等位基因的读数），$H_2$（来自物种2等位基因的读数）。\n\n操作阈值：\n- 效应检测阈值 $\\tau = 0.32$（以2为底的对数尺度上，约等于$1.25$倍的变化）。绝对值低于 $\\tau$ 的效应被视为可忽略不计。\n- 强补偿标记阈值 $\\tau_c = 0.8$（以2为底的对数尺度上，约等于$1.74$倍的变化），用于顺式和反式效应方向相反的情况。\n- 杂交体错误表达阈值 $\\theta = 0.58$（以2为底的对数尺度上，约等于与亲本中间值$1.5$倍的偏差）。\n\n需要实现的任务：\n- 在以2为底的对数尺度上，从$E_1$和$E_2$推导亲本间的种间表达差异，从$H_1$和$H_2$推导杂交体内部的等位基因表达差异，并将反式组分推断为不能被杂交体内部等位基因差异所解释的种间差异量。使用上述概念基础和杂交体的共享反式环境特性来论证你的分解方法。\n- 根据以下规则对每个基因座的调控差异进行分类：\n  - 如果顺式和反式效应均未达到$\\tau$，输出代码 $0$（无可检测的差异）。\n  - 如果只有顺式效应达到$\\tau$，输出代码 $1$（仅顺式）。\n  - 如果只有反式效应达到$\\tau$，输出代码 $2$（仅反式）。\n  - 如果两者都达到$\\tau$且符号相同，输出代码 $3$（两者兼有，增强型）。\n  - 如果两者都达到$\\tau$且符号相反，输出代码 $4$（两者兼有，补偿型）。\n- 使用二进制指示符 $r \\in \\{0,1\\}$ 标记每个基因座的潜在调控不相容性：\n  - 如果顺式和反式效应都达到$\\tau_c$且符号相反（强补偿性差异），或者杂交体总表达量与亲本中间值的偏差在以2为底的对数尺度上至少为$\\theta$，则设置 $r = 1$。\n  - 否则设置 $r = 0$。\n- 杂交体总数和亲本中间值的定义：\n  - 杂交体总数 $H_T = H_1 + H_2$。\n  - 亲本中间值 $M = (E_1 + E_2)/2$。\n\n测试套件：\n为以下基因座提供输出，每个基因座以整数计数的元组 $(E_1,E_2,H_1,H_2)$ 形式给出：\n- 案例1：$(200,100,120,60)$。\n- 案例2：$(100,200,80,80)$。\n- 案例3：$(400,100,150,50)$。\n- 案例4：$(180,120,40,160)$。\n- 案例5：$(100,100,50,50)$。\n- 案例6：$(0,100,0,50)$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。每个结果都是一个双元素列表 $[c,r]$，其中 $c$ 是分类代码，$r$ 是相应测试用例的不相容性标志，顺序与上面列出的顺序相同。例如，总体输出必须类似于 $[[c_1,r_1],[c_2,r_2],\\dots]$，且仅包含整数条目。",
            "solution": "该问题要求基于对一个基因在两个亲本物种及其F1代杂交体中表达水平的定量分析，对其调控差异进行分类。该方法论基于既有的基因调控原理，这些原理为剖析表达差异的遗传基础提供了形式化框架。整个分析将在以2为底的对数尺度上进行，因为这能正确地线性化调控元件的乘法效应，并使倍数变化（fold-changes）的分布趋于正态化。\n\n首先，必须建立理论基础。基因的表达水平（此处通过RNA-seq读数计数来衡量），是由与基因DNA序列物理连锁的*顺式*作用调控元件（如启动子、增强子）和可在细胞内扩散的*反式*作用调控因子（如转录因子）的综合效应所决定的。我们可以将表达水平 $E$ 建模为顺式调控等位基因的贡献 $C$ 和反式调控环境的贡献 $T$ 的乘积。对于物种1和物种2这两个物种，它们各自的表达水平 $E_1$ 和 $E_2$ 由以下公式给出：\n$$E_1 = C_1 \\cdot T_1$$\n$$E_2 = C_2 \\cdot T_2$$\n在第一代（F1）杂交生物体中，来自两个亲本物种的等位基因（其特异性读数计数分别表示为 $H_1$ 和 $H_2$）在一个共同的细胞环境中共同表达。这个共享环境拥有一套单一、统一的*反式*作用因子 $T_H$。因此，杂交体中的等位基因特异性表达水平为：\n$$H_1 = C_1 \\cdot T_H$$\n$$H_2 = C_2 \\cdot T_H$$\n杂交体中的这种共享*反式*环境是能够分离*顺式*和*反式*效应的关键特征。为了在计数数据为零时避免奇点并稳定方差，在进行任何对数转换或比率计算之前，将一个伪计数 $p=0.5$ 添加到所有原始计数（$E_1, E_2, H_1, H_2$）中。让带撇的变量表示这些经过伪计数调整的值（例如，$E'_1 = E_1 + p$）。\n\n我们现在推导代表调控效应的量。所有计算都在 $\\log_2$ 尺度上进行。\n\n1.  **顺式调控差异 ($D_{cis}$)**：杂交体内部两个等位基因之间的表达差异完全是由于它们连锁的*顺式*调控元件的差异造成的，因为*反式*环境 $T_H$ 对两者是相同的。因此，杂交体中等位基因特异性表达的 $\\log_2$ 比率可以分离出*顺式*效应：\n    $$D_{cis} = \\log_2\\left(\\frac{H'_1}{H'_2}\\right) = \\log_2\\left(\\frac{C_1 \\cdot T_H}{C_2 \\cdot T_H}\\right) = \\log_2\\left(\\frac{C_1}{C_2}\\right)$$\n    操作公式为：\n    $$D_{cis} = \\log_2\\left(\\frac{H_1 + p}{H_2 + p}\\right)$$\n\n2.  **反式调控差异 ($D_{trans}$)**：亲本物种之间的总表达差异 $D_{total}$ 是*顺式*和*反式*效应的总和：\n    $$D_{total} = \\log_2\\left(\\frac{E'_1}{E'_2}\\right) = \\log_2\\left(\\frac{C_1 \\cdot T_1}{C_2 \\cdot T_2}\\right) = \\log_2\\left(\\frac{C_1}{C_2}\\right) + \\log_2\\left(\\frac{T_1}{T_2}\\right) = D_{cis} + \\log_2\\left(\\frac{T_1}{T_2}\\right)$$\n    *反式*调控差异定义为物种*反式*环境之间的差异，即 $\\log_2(T_1/T_2)$。通过重排上述方程，我们可以将此*反式*效应推断为总种间差异中不能被*顺式*效应解释的部分：\n    $$D_{trans} = D_{total} - D_{cis} = \\log_2\\left(\\frac{E_1 + p}{E_2 + p}\\right) - \\log_2\\left(\\frac{H_1 + p}{H_2 + p}\\right)$$\n\n有了这些定义，我们开始进行算法分类。对于每个以元组 $(E_1, E_2, H_1, H_2)$ 形式给出的基因座，我们执行以下步骤：\n\nI. **计算效应**：使用上述公式和伪计数 $p=0.5$ 计算 $D_{cis}$ 和 $D_{trans}$。\n\nII. **分类差异**：将 $D_{cis}$ 和 $D_{trans}$ 的绝对值与效应检测阈值 $\\tau = 0.32$ 进行比较。根据以下逻辑分配分类代码 $c$：\n    - 如果 $|D_{cis}| < \\tau$ 且 $|D_{trans}| < \\tau$，则 $c=0$（无显著差异）。\n    - 如果 $|D_{cis}| \\ge \\tau$ 且 $|D_{trans}| < \\tau$，则 $c=1$（仅*顺式*差异）。\n    - 如果 $|D_{cis}| < \\tau$ 且 $|D_{trans}| \\ge \\tau$，则 $c=2$（仅*反式*差异）。\n    - 如果 $|D_{cis}| \\ge \\tau$ 且 $|D_{trans}| \\ge \\tau$：\n        - 如果 $D_{cis}$ 和 $D_{trans}$ 符号相同（$D_{cis} \\cdot D_{trans} \\ge 0$），则 $c=3$（两种效应，增强型）。\n        - 如果 $D_{cis}$ 和 $D_{trans}$ 符号相反（$D_{cis} \\cdot D_{trans} < 0$），则 $c=4$（两种效应，补偿型）。\n\nIII. **标记潜在不相容性**：如果基因座显示出调控不相容性的迹象（这可能导致生殖隔离），则将二进制标志 $r \\in \\{0, 1\\}$ 设置为 1。该标志基于两个条件进行设置：\n    1.  **强补偿性差异**：当大幅度的*顺式*和*反式*效应向相反方向演化时会发生这种情况。这种模式可以在亲本物种中维持保守的表达水平，但在杂交体中，由于亲本的*顺式*和*反式*元件不匹配，可能会导致错误表达。满足条件为：$|D_{cis}| \\ge \\tau_c$ 且 $|D_{trans}| \\ge \\tau_c$ 并且它们的符号相反，其中 $\\tau_c=0.8$。\n    2.  **杂交体错误表达**：这是对杂交体中异常表达的直接观察。通过将杂交体总表达量 $H_T = H_1 + H_2$ 与亲本中间表达水平 $M = (E_1 + E_2) / 2$ 进行比较来量化。如果 $\\log_2$ 比率显著偏离零，则认为表达是错误的。满足条件为：$|\\log_2((H_T + p) / (M + p))| \\ge \\theta$，其中 $\\theta=0.58$。\n\n如果满足这两个条件中的任何一个，则不相容性标志设置为 $r=1$；否则，保持 $r=0$。这个过程提供了一种系统性的、基于生物学原理的方法，用于从等位基因特异性表达数据分析基因调控的演化。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes RNA-seq count data to classify regulatory divergence and flag potential\n    incompatibilities according to the problem specification.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (200, 100, 120, 60),  # Case 1\n        (100, 200, 80, 80),   # Case 2\n        (400, 100, 150, 50),  # Case 3\n        (180, 120, 40, 160),  # Case 4\n        (100, 100, 50, 50),   # Case 5\n        (0, 100, 0, 50),     # Case 6\n    ]\n\n    # Operational parameters\n    p = 0.5      # Pseudocount\n    tau = 0.32   # Effect detection threshold\n    tau_c = 0.8  # Strong compensatory flag threshold\n    theta = 0.58 # Hybrid misexpression threshold\n\n    results = []\n    for case in test_cases:\n        E1, E2, H1, H2 = case\n\n        # Add pseudocounts to all raw counts\n        E1_p = E1 + p\n        E2_p = E2 + p\n        H1_p = H1 + p\n        H2_p = H2 + p\n\n        # 1. Calculate cis- and trans-regulatory effects\n        # Cis-effect from allele-specific expression in hybrid\n        d_cis = np.log2(H1_p / H2_p)\n        \n        # Total effect from parental expression\n        d_total = np.log2(E1_p / E2_p)\n        \n        # Trans-effect is inferred\n        d_trans = d_total - d_cis\n\n        # 2. Classify regulatory divergence\n        abs_cis = abs(d_cis)\n        abs_trans = abs(d_trans)\n\n        cis_is_significant = abs_cis >= tau\n        trans_is_significant = abs_trans >= tau\n\n        c = -1 # Classification code\n        if not cis_is_significant and not trans_is_significant:\n            c = 0  # No detectable divergence\n        elif cis_is_significant and not trans_is_significant:\n            c = 1  # Cis-only\n        elif not cis_is_significant and trans_is_significant:\n            c = 2  # Trans-only\n        else:  # Both are significant\n            if d_cis * d_trans >= 0:\n                c = 3  # Both, reinforcing\n            else:\n                c = 4  # Both, compensatory\n\n        # 3. Flag for potential regulatory incompatibility\n        r = 0  # Incompatibility flag\n\n        # Condition 1: Strong compensatory divergence\n        is_strong_compensatory = (\n            abs_cis >= tau_c and\n            abs_trans >= tau_c and\n            d_cis * d_trans  0\n        )\n\n        # Condition 2: Hybrid misexpression\n        HT = H1 + H2\n        M = (E1 + E2) / 2\n        \n        # Denominator M+p is always > 0 for non-negative counts E1, E2 and p > 0.\n        # Numerator HT+p is also always > 0.\n        misexpression_index = np.log2((HT + p) / (M + p))\n        \n        is_misexpressed = abs(misexpression_index) >= theta\n        \n        if is_strong_compensatory or is_misexpressed:\n            r = 1\n\n        results.append([c, r])\n\n    # Final print statement in the exact required format.\n    # The map converts each sublist [c,r] to its string representation.\n    # The outer join then puts them together with commas.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}