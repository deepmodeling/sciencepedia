{
    "hands_on_practices": [
        {
            "introduction": "To identify genomic islands of divergence, we first need a robust way to quantify the degree of genetic differentiation between populations. This exercise establishes that foundation by having you work with the most fundamental measures of sequence variation: within-population diversity ($\\pi$) and between-population absolute divergence ($d_{XY}$). By starting from these basic definitions, you will derive and calculate the Fixation Index ($F_{ST}$), a cornerstone statistic in population genetics that measures *relative* differentiation, providing a hands-on understanding of what this crucial value represents .",
            "id": "2718661",
            "problem": "In the study of genomic islands of divergence, a central goal is to quantify how much of the nucleotide variation observed across a genomic window reflects differentiation between populations versus polymorphism maintained within populations. Consider two populations sampled at a nonrecombining genomic window under the infinite-sites mutation model with low per-site mutation rate and no sequencing error. Let $d_{XY}$ denote the mean number of nucleotide differences per site between one sequence drawn at random from population $X$ and one sequence drawn at random from population $Y$ (absolute divergence). Let $\\pi_{i}$ denote the mean number of nucleotide differences per site between two sequences drawn at random from population $i \\in \\{1,2\\}$ (within-population nucleotide diversity), and let $\\bar{\\pi}$ be the across-population average of within-population diversity defined by $\\bar{\\pi} = (\\pi_{1} + \\pi_{2})/2$. Define the net molecular divergence as $D_{a} = d_{XY} - \\bar{\\pi}$, which removes the contribution of segregating variation shared across the populations, and define the Fixation Index (F_ST) at this window as the fraction of the total per-site between-population divergence attributable to net divergence, that is, the ratio of the between-population component to the total.\n \nStarting from these definitions and without invoking any additional summary-statistic formulas, derive an expression for $F_{ST}$ in terms of $d_{XY}$ and $\\bar{\\pi}$. Then, for a particular genomic window with $\\pi_{1} = 0.008$, $\\pi_{2} = 0.004$, and $d_{XY} = 0.012$, compute $F_{ST}$ and state the value. Provide the exact value (do not round). Finally, briefly interpret what the magnitude of this $F_{ST}$ implies about differentiation at this window in the context of genomic islands of divergence. Your final numerical answer must be only the value of $F_{ST}$, which is dimensionless.",
            "solution": "The problem as stated is scientifically grounded, well-posed, and contains all necessary definitions and data for a unique solution. The definitions of nucleotide diversity ($\\pi$), absolute divergence ($d_{XY}$), net divergence ($D_a$), and the Fixation Index ($F_{ST}$) are standard in the field of population genetics. The problem is therefore deemed valid and a solution will be provided.\n\nThe problem requires a three-part answer: first, a derivation of the formula for $F_{ST}$; second, a numerical calculation of $F_{ST}$ for the given data; and third, a brief interpretation of the result.\n\nFirst, we derive the expression for $F_{ST}$. The problem defines $F_{ST}$ as \"the ratio of the between-population component to the total\". It further specifies that the \"between-population component\" is the net molecular divergence, $D_a$, and that the \"total\" component is the total per-site between-population divergence. This total divergence is precisely what is defined as $d_{XY}$, the mean number of differences between a sequence from population $X$ and a sequence from population $Y$. Therefore, the mathematical expression for $F_{ST}$ is the ratio of the net divergence to the absolute divergence:\n$$F_{ST} = \\frac{D_a}{d_{XY}}$$\nThe problem also provides the definition for the net molecular divergence, $D_a$, as:\n$$D_a = d_{XY} - \\bar{\\pi}$$\nwhere $\\bar{\\pi}$ is the average within-population nucleotide diversity. By substituting the expression for $D_a$ into the formula for $F_{ST}$, we derive the final expression for $F_{ST}$ in terms of the given quantities $d_{XY}$ and $\\bar{\\pi}$:\n$$F_{ST} = \\frac{d_{XY} - \\bar{\\pi}}{d_{XY}}$$\nThis can be equivalently written as $F_{ST} = 1 - \\frac{\\bar{\\pi}}{d_{XY}}$, which represents the proportion of total divergence ($d_{XY}$) that is not accounted for by the average within-population diversity ($\\bar{\\pi}$).\n\nSecond, we compute the numerical value of $F_{ST}$. The provided data are:\nWithin-population diversity for population $1$: $\\pi_{1} = 0.008$\nWithin-population diversity for population $2$: $\\pi_{2} = 0.004$\nAbsolute divergence between populations $1$ and $2$: $d_{XY} = 0.012$\n\nWe begin by calculating the average within-population diversity, $\\bar{\\pi}$, using its definition:\n$$\\bar{\\pi} = \\frac{\\pi_{1} + \\pi_{2}}{2} = \\frac{0.008 + 0.004}{2} = \\frac{0.012}{2} = 0.006$$\nNow, we substitute the numerical values of $d_{XY}$ and the calculated $\\bar{\\pi}$ into our derived formula for $F_{ST}$:\n$$F_{ST} = \\frac{d_{XY} - \\bar{\\pi}}{d_{XY}} = \\frac{0.012 - 0.006}{0.012} = \\frac{0.006}{0.012}$$\nThis simplifies to the exact value:\n$$F_{ST} = 0.5$$\n\nThird, we interpret the magnitude of this $F_{ST}$ value. The Fixation Index, $F_{ST}$, measures the degree of genetic differentiation between populations, with a theoretical range from $0$ (no differentiation) to $1$ (complete differentiation, where populations are fixed for different alleles). An $F_{ST}$ value of $0.5$ indicates that exactly half ($50\\%$) of the total nucleotide divergence observed between these two populations at this genomic window is due to net divergence—that is, nucleotide substitutions that have become fixed or are at high frequency differences between them. The other half is attributable to polymorphism that is still segregating within the populations. In the search for genomic islands of divergence, an $F_{ST}$ of $0.5$ is a high value, signifying substantial differentiation. It suggests that this particular genomic window is experiencing forces such as divergent natural selection or severely restricted gene flow, which drive the populations apart genetically, far more than the average region in the genome (the \"genomic sea\").",
            "answer": "$$\\boxed{0.5}$$"
        },
        {
            "introduction": "After mastering the calculation of $F_{ST}$, the next critical step is interpretation. A peak in $F_{ST}$ is often flagged as a candidate \"genomic island,\" but is it always a sign of a true barrier to gene flow? This practice presents a classic and vital scenario where relative differentiation ($F_{ST}$) is high but absolute divergence ($d_{XY}$) is not. You will use your understanding of population genetic principles to diagnose the underlying evolutionary process, learning to distinguish a genuine barrier from confounding effects like background selection, a crucial skill for avoiding common pitfalls in genomic scans .",
            "id": "2718691",
            "problem": "Two populations $X$ and $Y$ of a single species have been sampled and sequenced, yielding whole-chromosome summaries of pairwise divergence and diversity in non-overlapping windows. Across the entire chromosome, the absolute sequence divergence between populations, $d_{XY}$, is approximately constant at $0.012$ differences per site. However, in a focal window of size $200\\,\\mathrm{kb}$, the fixation index $F_{ST}$ is elevated to $0.35$, whereas the chromosome-wide median $F_{ST}$ is $0.12$. Within-population nucleotide diversity in the focal window is reduced relative to the chromosomal background (e.g., $\\pi_X \\approx 0.0012$, $\\pi_Y \\approx 0.0010$ in the focal window versus genome-wide medians $\\pi_X \\approx 0.0045$, $\\pi_Y \\approx 0.0044$). Assume a roughly uniform neutral mutation rate $\\mu$ along the chromosome and that windows are sufficiently large to estimate summary statistics with low sampling variance.\n\nUsing only foundational definitions from population genetics (e.g., the definition of $F_{ST}$ as a ratio of within- and total heterozygosity, the interpretation of $d_{XY}$ as absolute between-population divergence, and the qualitative effects of gene flow and linked selection on these quantities), decide whether the focal window provides evidence for a true localized barrier to gene flow. Select the single best-supported inference and its justification.\n\nA. The focal window constitutes a true barrier to gene flow, because a high $F_{ST}$ directly indicates restricted migration, and the constancy of $d_{XY}$ is irrelevant to detecting barriers.\n\nB. The focal window does not support a true barrier to gene flow; the elevated $F_{ST}$ with constant $d_{XY}$ is best explained by reduced within-population diversity (e.g., linked selection in low recombination) inflating relative differentiation, whereas a true barrier should elevate $d_{XY}$ above background.\n\nC. The focal window constitutes a true barrier to gene flow, because constant $d_{XY}$ confirms a uniform mutation rate, so a high $F_{ST}$ must arise from selection against migrants rather than other processes.\n\nD. The data are insufficient to evaluate barrier status; without explicit recombination maps one cannot interpret patterns in $F_{ST}$ or $d_{XY}$, even if $d_{XY}$ is constant.\n\nE. The focal window does not support a true barrier to gene flow, because background selection would be expected to decrease $F_{ST}$, so the focal $F_{ST}$ peak most likely reflects a technical artifact rather than a biological process.",
            "solution": "The problem statement must first be rigorously validated.\n\n### Step 1: Extract Givens\n- Populations: Two populations, $X$ and $Y$, of a single species.\n- Data: Whole-chromosome summaries of pairwise divergence and diversity in non-overlapping windows.\n- Absolute divergence: $d_{XY}$ is approximately constant at $0.012$ differences per site across the entire chromosome.\n- Focal window size: $200\\,\\mathrm{kb}$.\n- Focal window fixation index: $F_{ST} = 0.35$.\n- Chromosome-wide median fixation index: $F_{ST} = 0.12$.\n- Focal window nucleotide diversity: $\\pi_X \\approx 0.0012$, $\\pi_Y \\approx 0.0010$.\n- Genome-wide median nucleotide diversity: $\\pi_X \\approx 0.0045$, $\\pi_Y \\approx 0.0044$.\n- Assumption 1: Roughly uniform neutral mutation rate $\\mu$ along the chromosome.\n- Assumption 2: Windows are sufficiently large for low sampling variance.\n- Question: Decide whether the focal window provides evidence for a true localized barrier to gene flow.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is well-defined and scientifically grounded in the field of population genomics. The provided statistics—absolute divergence ($d_{XY}$), nucleotide diversity ($\\pi$), and the fixation index ($F_{ST}$)—are standard measures used to infer evolutionary processes. The values themselves are realistic for many diverging populations. The scenario described, a \"genomic island\" of high relative differentiation ($F_{ST}$) coupled with specific patterns in absolute divergence ($d_{XY}$) and within-population diversity ($\\pi$), is a canonical topic of research and theoretical modeling in evolutionary biology. The problem requires interpretation of these patterns based on foundational definitions, which is a standard scientific exercise. The problem is self-contained, its premises are factually sound within the context of population genetics models, and it is free of ambiguity or contradiction.\n\n### Step 3: Verdict and Action\nThe problem statement is valid. I will proceed to a full solution.\n\n### Derivation\nThe core of the problem is to distinguish between two main hypotheses that can generate a \"genomic island of divergence\" (a region of elevated $F_{ST}$):\n1.  A true, localized barrier to gene flow (e.g., due to a locus involved in reproductive isolation).\n2.  The effect of linked selection (either positive or background selection) in a region of the genome, often associated with low recombination.\n\nTo evaluate these hypotheses, we must consider the precise definitions and expected behaviors of the key summary statistics.\n\n-   **Absolute Divergence ($d_{XY}$)**: This statistic measures the average number of nucleotide differences between a pair of sequences, one randomly chosen from population $X$ and one from population $Y$. In a simple model, $d_{XY}$ is proportional to the average time to the most recent common ancestor ($T_{MRCA}$) for such a pair of sequences. A true, locus-specific barrier to gene flow would mean that migrant alleles at this specific locus are selected against, reducing the effective rate of gene exchange locally. This would cause the lineages sampled from the two populations at this locus to remain separate for a longer time, increasing their $T_{MRCA}$ relative to the rest of the genome where gene flow is higher. Consequently, a true barrier to gene flow is expected to produce a distinct **peak** in $d_{XY}$ at the barrier locus. The problem states that $d_{XY}$ is approximately constant across the chromosome. This evidence directly contradicts the prediction for a true localized barrier.\n\n-   **Within-Population Diversity ($\\pi$)**: This measures the average number of nucleotide differences between a pair of sequences sampled from the *same* population. It is sensitive to local forces that affect the entire genealogy within that population, most notably selection. A selective sweep (strong positive selection for a new beneficial mutation) or background selection (purifying selection against recurrent deleterious mutations) will reduce the effective population size experienced by linked neutral sites, thereby purging variation and causing a local **trough** in $\\pi$. The data show that $\\pi_X$ and $\\pi_Y$ are indeed strongly reduced in the focal window (e.g., from $\\approx 0.0045$ to $\\approx 0.0012$).\n\n-   **Fixation Index ($F_{ST}$)**: This is a measure of *relative* differentiation. A common and intuitive definition relates it to the other statistics: $F_{ST} = 1 - \\pi_S / \\pi_T$, where $\\pi_S$ is the average within-population diversity (here, $(\\pi_X+\\pi_Y)/2$) and $\\pi_T$ is the total diversity, which incorporates both within- and between-population differences. A useful approximation in many scenarios is given by $F_{ST} \\approx 1 - \\pi_S/d_{XY}$. This ratio structure is critical. An increase in $F_{ST}$ can be caused either by an increase in between-population differentiation (increasing $d_{XY}$) or by a decrease in within-population diversity ($\\pi_S$).\n\n### Synthesis\nThe data present a clear picture:\n1.  $d_{XY}$ is constant, which argues *against* a true, localized barrier to gene flow elevating the local between-population coalescent time.\n2.  $\\pi_X$ and $\\pi_Y$ are strongly reduced, which points towards the action of linked selection reducing diversity within each population.\n3.  $F_{ST}$ is elevated.\n\nCombining these observations through the lens of the equation $F_{ST} \\approx 1 - \\pi_S/d_{XY}$: the numerator of the fraction, $\\pi_S$, has decreased substantially in the focal window, while the denominator, $d_{XY}$, has remained constant. A simple mathematical consequence of decreasing the numerator in a fraction being subtracted from $1$ is an increase in the final value. Thus, the elevated $F_{ST}$ is not an indicator of a true barrier but is an arithmetic artifact of the reduced local diversity ($\\pi_S$) caused by linked selection. This pattern is the classic signature of a \"false\" genomic island generated by processes other than reduced gene flow.\n\n### Option-by-Option Analysis\n\n**A. The focal window constitutes a true barrier to gene flow, because a high $F_{ST}$ directly indicates restricted migration, and the constancy of $d_{XY}$ is irrelevant to detecting barriers.**\nThis statement is fundamentally incorrect. A high $F_{ST}$ is a measure of relative differentiation and can be inflated by reduced within-population diversity, so it does not \"directly indicate\" restricted migration. Furthermore, the behavior of absolute divergence, $d_{XY}$, is critically important for distinguishing between a true barrier (which should elevate $d_{XY}$) and other phenomena. Claiming its constancy is irrelevant demonstrates a severe misunderstanding of the underlying theory.\n**Verdict: Incorrect.**\n\n**B. The focal window does not support a true barrier to gene flow; the elevated $F_{ST}$ with constant $d_{XY}$ is best explained by reduced within-population diversity (e.g., linked selection in low recombination) inflating relative differentiation, whereas a true barrier should elevate $d_{XY}$ above background.**\nThis statement is entirely correct and represents the consensus scientific interpretation of such data patterns. It correctly negates the \"true barrier\" hypothesis. It accurately identifies the causal chain: linked selection reduces within-population diversity ($\\pi_S$), which in turn inflates the relative measure $F_{ST}$ when absolute divergence ($d_{XY}$) is constant. It also correctly states the key prediction for a true barrier—an elevated $d_{XY}$.\n**Verdict: Correct.**\n\n**C. The focal window constitutes a true barrier to gene flow, because constant $d_{XY}$ confirms a uniform mutation rate, so a high $F_{ST}$ must arise from selection against migrants rather than other processes.**\nThis constitutes flawed reasoning. While constant $d_{XY}$ is consistent with the assumption of a uniform mutation rate, it does not force the conclusion of a barrier. In fact, as argued above, it argues against one. The assertion that a high $F_{ST}$ *must* arise from selection against migrants is a non sequitur, as it entirely ignores the more parsimonious and well-supported alternative explanation involving linked selection and reduced local diversity.\n**Verdict: Incorrect.**\n\n**D. The data are insufficient to evaluate barrier status; without explicit recombination maps one cannot interpret patterns in $F_{ST}$ or $d_{XY}$, even if $d_{XY}$ is constant.**\nThis position is excessively nihilistic and incorrect. While a recombination map provides complementary evidence (the linked selection hypothesis predicts the focal window should lie in a region of low recombination), its absence does not render the primary data ($d_{XY}$, $\\pi$, $F_{ST}$) uninterpretable. The specific combination of observed statistics is highly informative and provides strong evidence to distinguish between the primary competing hypotheses.\n**Verdict: Incorrect.**\n\n**E. The focal window does not support a true barrier to gene flow, because background selection would be expected to decrease $F_{ST}$, so the focal $F_{ST}$ peak most likely reflects a technical artifact rather than a biological process.**\nThis statement contains a critical factual error. Background selection, by reducing local within-population diversity ($\\pi_S$), is expected to *increase* $F_{ST}$, not decrease it. Since the premise of the argument is wrong, the conclusion is unsound. The observed pattern is not a technical artifact but a well-documented biological phenomenon resulting from the interplay of selection, mutation, and drift.\n**Verdict: Incorrect.**",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "This final practice synthesizes the concepts from the previous exercises into a complete, real-world analytical workflow. Having learned to calculate differentiation metrics and to critically evaluate their meaning, you will now construct a computational pipeline to systematically detect genomic islands across a chromosome. This exercise guides you through the process of building a statistical model that explicitly accounts for confounding variables like recombination rate and background selection, allowing you to move beyond simple peak-calling to a principled, hypothesis-driven identification of regions showing significant differentiation .",
            "id": "2718644",
            "problem": "You are given the task of formalizing a principled computational workflow to detect genomic islands of divergence while accounting for recombination rate variation, background selection, and multiple testing. A genomic island of divergence is defined here as a maximal contiguous set of genomic windows whose between-population differentiation exceeds the neutral expectation given local recombination rate and background selection, after controlling the false discovery rate using the Benjamini–Hochberg procedure.\n\nFundamental base and core definitions to be used:\n- The fixation index (FST) is a measure of between-population genetic differentiation across genomic windows. Under a neutral model with linked selection, the expected value and variance of window-level differentiation depend on effective population size and recombination rate. Background selection lowers effective population size and can elevate differentiation in low recombination regions even in the absence of positive selection.\n- In a statistical model, let the observed per-window differentiation be denoted by $y_i$ for window index $i \\in \\{0,1,\\ldots,N-1\\}$. Let the local recombination rate be $r_i > 0$, and the background selection index be $B_i \\in (0,1]$, where lower $B_i$ indicates stronger background selection.\n- Ordinary least squares (OLS) regression provides a baseline estimate $\\hat{\\mu}_i$ of the expected differentiation conditional on covariates. A heteroskedastic variance function $\\sigma_i^2$ depending on $r_i$ and $B_i$ can be estimated by regressing squared residuals on covariates with nonnegativity constraints. Standardized residuals $z_i = (y_i - \\hat{\\mu}_i)/\\hat{\\sigma}_i$ can be used to compute two-sided $p$-values under a standard normal model for null deviations.\n- The Benjamini–Hochberg (BH) procedure controls the false discovery rate (FDR). Given $m$ hypotheses with $p$-values $\\{p_i\\}_{i=1}^m$, sort them in ascending order $p_{(1)} \\le \\cdots \\le p_{(m)}$ and define $k^\\star = \\max\\{k: p_{(k)} \\le \\alpha \\cdot k / m\\}$. Mark as discoveries all hypotheses with $p_i \\le p_{(k^\\star)}$, or none if no such $k$ exists.\n- Define an island as any maximal run of consecutive discoveries with run length at least $L_{\\min}$.\n\nYour program must implement the following workflow:\n1. Model fitting for expectation: Fit an OLS model of $y$ on the design matrix $X$ with columns\n   - $x_{i,0} = 1$,\n   - $x_{i,1} = \\log(r_i + c)$,\n   - $x_{i,2} = 1/(r_i + c)$,\n   - $x_{i,3} = 1 - B_i$,\n   - $x_{i,4} = (1 - B_i)^2$,\n   where $c > 0$ is a small constant and $\\log$ is the natural logarithm. Obtain $\\hat{\\mu}_i = X_i \\hat{\\beta}$.\n2. Variance modeling for heteroskedasticity: Fit a nonnegative least squares regression of squared residuals $e_i^2 = (y_i - \\hat{\\mu}_i)^2$ on the variance design $Z$ with columns\n   - $z_{i,0} = 1$,\n   - $z_{i,1} = 1/(r_i + c)$,\n   - $z_{i,2} = 1 - B_i$,\n   to obtain nonnegative coefficients $\\hat{\\gamma} \\ge 0$. Define $\\hat{\\sigma}_i^2 = \\max(Z_i \\hat{\\gamma}, \\varepsilon)$ with $\\varepsilon = 10^{-6}$ and $\\hat{\\sigma}_i = \\sqrt{\\hat{\\sigma}_i^2}$.\n3. Standardized testing and multiple-testing control: Compute two-sided $p$-values $p_i = 2 \\cdot (1 - \\Phi(|z_i|))$, where $z_i = e_i / \\hat{\\sigma}_i$ and $\\Phi$ is the standard normal cumulative distribution function. Apply the Benjamini–Hochberg procedure at a specified FDR level $\\alpha$ across all windows in the dataset to classify significant windows.\n4. Island calling: Identify maximal contiguous runs of significant windows and retain only those with run length at least $L_{\\min}$. Count the number of retained islands.\n\nAngle units and physical units are not applicable. All probabilities must be expressed as decimals (for example, $0.1$ for ten percent).\n\nTest suite and data generation:\n- Use zero-based inclusive window indexing for intervals.\n- For each test case, generate synthetic data from a neutral baseline with heteroskedastic Gaussian noise, then superimpose selection-induced shifts in specified intervals. The generation is as follows. For $i \\in \\{0,\\ldots,N-1\\}$:\n  - Draw $r_i \\sim \\text{Gamma}(k,\\theta)$ and truncate by clipping to $[r_{\\min}, r_{\\max}]$: $r_i \\leftarrow \\min(\\max(r_i, r_{\\min}), r_{\\max})$.\n  - Draw $B_i \\sim \\text{Beta}(a,b)$ and lower-bound by clipping at $B_{\\min}$: $B_i \\leftarrow \\max(B_i, B_{\\min})$.\n  - Compute the baseline mean\n    $$\\mu_i = A_0 + A_1 \\log(r_i + c) + \\frac{A_2}{r_i + c} + A_3 (1 - B_i) + A_4 (1 - B_i)^2.$$\n  - Compute the variance\n    $$\\sigma_i^2 = v_0 + \\frac{v_1}{r_i + c} + v_2 (1 - B_i).$$\n  - Draw $\\varepsilon_i \\sim \\mathcal{N}(0, \\sigma_i^2)$ and set $y_i \\leftarrow \\mu_i + \\varepsilon_i$.\n  - For each specified island interval $[s_j, e_j]$, adjust $y_i \\leftarrow y_i + \\Delta$ for all $i \\in \\{s_j,\\ldots,e_j\\}$.\n\nShared parameters across all test cases:\n- Shape $k = 2.0$, scale $\\theta = 1.0$, recombination truncation $r_{\\min} = 0.2$, $r_{\\max} = 5.0$.\n- Beta parameters $a = 2.0$, $b = 5.0$, lower bound $B_{\\min} = 0.2$.\n- Constant $c = 0.05$.\n- Baseline coefficients $A_0 = 0.10$, $A_1 = -0.015$, $A_2 = 0.040$, $A_3 = 0.120$, $A_4 = 0.080$.\n- Variance coefficients $v_0 = 0.0001$, $v_1 = 0.0005$, $v_2 = 0.0004$.\n- Discovery parameters $L_{\\min} = 4$, $\\alpha = 0.10$.\n- Selection shift $\\Delta = 0.12$.\n\nTest cases:\n- Case A (happy path): $N = 400$, random seed $s = 12345$, island intervals $\\{[50,62],[180,195],[320,330]\\}$.\n- Case B (null control): $N = 300$, random seed $s = 7$, island intervals $\\emptyset$.\n- Case C (edge case for minimal length): $N = 500$, random seed $s = 2023$, island intervals $\\{[100,110],[250,252],[400,430]\\}$.\n\nRequired final output format:\n- Your program must produce a single line of output containing a list with three integers in order for Cases A, B, and C, respectively. Each integer is the number of detected islands (maximal contiguous runs of discoveries of length at least $L_{\\min}$). The line must be a comma-separated list enclosed in square brackets, for example, $[3,0,2]$.",
            "solution": "The problem statement has been subjected to rigorous validation and is deemed valid. It is scientifically grounded in the principles of evolutionary and population genetics, is mathematically and algorithmically well-posed, and is presented with objective, unambiguous language. All necessary parameters and definitions are provided to construct a unique and verifiable solution. We may therefore proceed with the formal derivation and implementation of the specified computational workflow.\n\nThe core task is to identify genomic regions, termed \"islands of divergence,\" where genetic differentiation between populations, measured by the fixation index $F_{ST}$, is significantly elevated. This elevation is a potential sign of localized positive selection. A critical challenge in genomics is that other evolutionary processes, such as background selection and variation in recombination rate, can create patterns of differentiation that mimic positive selection. The proposed methodology is a principled statistical approach designed to account for these confounding factors.\n\nThe workflow proceeds in four stages:\n1.  Establishment of a null model for expected differentiation.\n2.  Modeling of observation variance (heteroskedasticity).\n3.  Statistical testing with correction for multiple comparisons.\n4.  Identification of significant islands.\n\nThis will be applied to synthetic data generated according to a specified process, which serves as the ground truth for evaluating the method's performance.\n\nFirst, we must specify the data generation process. For each genomic window $i \\in \\{0, 1, \\ldots, N-1\\}$, we generate predictor variables and the response variable $y_i$.\n- The local recombination rate, $r_i$, is drawn from a Gamma distribution, $r_i \\sim \\text{Gamma}(k, \\theta)$, and then truncated to the interval $[r_{\\min}, r_{\\max}]$.\n- The background selection coefficient, $B_i$, is drawn from a Beta distribution, $B_i \\sim \\text{Beta}(a, b)$, and lower-bounded by $B_{\\min}$.\n- The true expected differentiation, $\\mu_i$, under the null model is a function of these covariates:\n$$ \\mu_i = A_0 + A_1 \\log(r_i + c) + \\frac{A_2}{r_i + c} + A_3 (1 - B_i) + A_4 (1 - B_i)^2 $$\n- The true variance, $\\sigma_i^2$, is also dependent on covariates, reflecting heteroskedasticity:\n$$ \\sigma_i^2 = v_0 + \\frac{v_1}{r_i + c} + v_2 (1 - B_i) $$\n- The baseline observed differentiation is then drawn from a normal distribution, $y_i = \\mu_i + \\varepsilon_i$, where $\\varepsilon_i \\sim \\mathcal{N}(0, \\sigma_i^2)$.\n- Finally, to simulate islands of divergence, a fixed effect $\\Delta$ is added to $y_i$ for all windows $i$ located within predefined selected intervals $[s_j, e_j]$.\n\nWith the synthetic data $(y_i, r_i, B_i)$ prepared, we begin the analysis.\n\n1.  **Modeling Expected Differentiation with Ordinary Least Squares (OLS):**\n    The first step is to estimate the expected differentiation, $\\hat{\\mu}_i$, conditional on the local genomic context. We use OLS to fit a linear model. The response variable is the vector $\\mathbf{y}$ of observed differentiation values. The design matrix $X$ is constructed with $N$ rows and $5$ columns, where row $i$ is $[1, \\log(r_i+c), 1/(r_i+c), 1-B_i, (1-B_i)^2]$. The model is $\\mathbf{y} = X\\beta + \\mathbf{e}$. The OLS estimate for the coefficient vector $\\beta$ is $\\hat{\\beta} = (X^T X)^{-1} X^T \\mathbf{y}$. This is numerically computed using a standard least-squares algorithm. The fitted values, $\\hat{\\boldsymbol{\\mu}} = X\\hat{\\beta}$, represent the estimated expected differentiation under the null model of background effects. The residuals are $\\mathbf{e} = \\mathbf{y} - \\hat{\\boldsymbol{\\mu}}$.\n\n2.  **Modeling Heteroskedasticity with Nonnegative Least Squares (NNLS):**\n    The variance of differentiation is not constant across the genome. We model this heteroskedasticity by regressing the squared residuals, $e_i^2$, on a set of covariates. The variance design matrix $Z$ is constructed with $N$ rows and $3$ columns, where row $i$ is $[1, 1/(r_i+c), 1-B_i]$. We fit the model $\\mathbf{e}^2 = Z\\gamma$. To ensure the predicted variance is non-negative, the coefficient vector $\\gamma$ must be constrained such that $\\gamma_j \\ge 0$ for all $j$. This is a Nonnegative Least Squares (NNLS) problem. The estimated variance for window $i$ is $\\hat{\\sigma}_i^2 = Z_i \\hat{\\gamma}$. A floor value $\\varepsilon = 10^{-6}$ is applied to prevent numerical issues, so $\\hat{\\sigma}_i^2 = \\max(Z_i \\hat{\\gamma}, \\varepsilon)$. The estimated standard deviation is $\\hat{\\sigma}_i = \\sqrt{\\hat{\\sigma}_i^2}$.\n\n3.  **Standardized Testing and Multiple Testing Correction:**\n    With estimates for both mean and variance, we can now compute standardized test statistics. For each window $i$, the standardized residual is $z_i = e_i / \\hat{\\sigma}_i = (y_i - \\hat{\\mu}_i) / \\hat{\\sigma}_i$. Under the null hypothesis that window $i$ is not under selection, $z_i$ is assumed to follow a standard normal distribution, $\\mathcal{N}(0, 1)$. We compute a two-sided p-value, $p_i$, which is the probability of observing a deviation from the null model at least as large as $|z_i|$:\n    $$ p_i = 2 \\cdot P(Z > |z_i|) = 2 \\cdot (1 - \\Phi(|z_i|)) $$\n    where $\\Phi$ is the cumulative distribution function of the standard normal distribution.\n    Since we are performing $N$ simultaneous tests, we must correct for multiple comparisons to control the rate of false discoveries. The Benjamini–Hochberg (BH) procedure is applied at a specified False Discovery Rate (FDR) level $\\alpha$. The p-values $\\{p_i\\}_{i=0}^{N-1}$ are sorted in ascending order: $p_{(1)} \\le p_{(2)} \\le \\cdots \\le p_{(N)}$. We find the largest integer $k^\\star$ such that $p_{(k^\\star)} \\le \\frac{\\alpha \\cdot k^\\star}{N}$. All windows with an original p-value $p_i \\le p_{(k^\\star)}$ are classified as significant \"discoveries.\" If no such $k^\\star$ exists, no windows are deemed significant.\n\n4.  **Island Calling:**\n    The final step is to group the significant windows into islands of divergence. An island is defined as a maximal contiguous run of significant windows. We iterate through the boolean vector of discoveries, identify all such contiguous blocks, and calculate their lengths. Only those blocks with a length greater than or equal to a minimum threshold, $L_{\\min}$, are retained and counted as valid islands of divergence. The total count of these valid islands is the final output for each test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import nnls\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Main function to run the complete workflow for all test cases and print the results.\n    \"\"\"\n    # Shared parameters across all test cases\n    shared_params = {\n        'k': 2.0, 'theta': 1.0, 'r_min': 0.2, 'r_max': 5.0,\n        'a': 2.0, 'b': 5.0, 'B_min': 0.2,\n        'c': 0.05,\n        'A0': 0.10, 'A1': -0.015, 'A2': 0.040, 'A3': 0.120, 'A4': 0.080,\n        'v0': 0.0001, 'v1': 0.0005, 'v2': 0.0004,\n        'L_min': 4, 'alpha': 0.10,\n        'delta': 0.12,\n        'epsilon': 1e-6\n    }\n\n    # Test case definitions\n    test_cases = [\n        {'N': 400, 'seed': 12345, 'islands': [(50, 62), (180, 195), (320, 330)]},\n        {'N': 300, 'seed': 7, 'islands': []},\n        {'N': 500, 'seed': 2023, 'islands': [(100, 110), (250, 252), (400, 430)]},\n    ]\n\n    results = []\n    for case in test_cases:\n        params = {**shared_params, **case}\n        num_islands = process_case(params)\n        results.append(num_islands)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef generate_data(p):\n    \"\"\"\n    Generates synthetic data for a single test case according to the problem specification.\n    \"\"\"\n    np.random.seed(p['seed'])\n    N = p['N']\n\n    # Generate r_i and B_i\n    r = np.random.gamma(p['k'], p['theta'], size=N)\n    r = np.clip(r, p['r_min'], p['r_max'])\n\n    B = np.random.beta(p['a'], p['b'], size=N)\n    B = np.maximum(B, p['B_min'])\n\n    # Compute true mean and variance\n    log_r_c = np.log(r + p['c'])\n    inv_r_c = 1.0 / (r + p['c'])\n    one_minus_B = 1.0 - B\n    \n    mu = (p['A0'] + p['A1'] * log_r_c + p['A2'] * inv_r_c +\n          p['A3'] * one_minus_B + p['A4'] * one_minus_B**2)\n    \n    sigma_sq = p['v0'] + p['v1'] * inv_r_c + p['v2'] * one_minus_B\n    sigma = np.sqrt(sigma_sq)\n\n    # Generate baseline y_i and add selection shifts\n    y = np.random.normal(mu, sigma)\n    for start, end in p['islands']:\n        y[start:end+1] += p['delta']\n        \n    return y, r, B\n\ndef process_case(p):\n    \"\"\"\n    Executes the full analysis pipeline for a single test case.\n    \"\"\"\n    y, r, B = generate_data(p)\n    N = p['N']\n    c = p['c']\n\n    # 1. Model fitting for expectation (OLS)\n    log_r_c = np.log(r + c)\n    inv_r_c = 1.0 / (r + c)\n    one_minus_B = 1.0 - B\n    \n    X = np.vstack([np.ones(N), log_r_c, inv_r_c, one_minus_B, one_minus_B**2]).T\n    beta_hat, _, _, _ = np.linalg.lstsq(X, y, rcond=None)\n    mu_hat = X @ beta_hat\n    residuals = y - mu_hat\n    \n    # 2. Variance modeling for heteroskedasticity (NNLS)\n    Z = np.vstack([np.ones(N), inv_r_c, one_minus_B]).T\n    gamma_hat, _ = nnls(Z, residuals**2)\n    sigma_sq_hat = np.maximum(Z @ gamma_hat, p['epsilon'])\n    sigma_hat = np.sqrt(sigma_sq_hat)\n    \n    # 3. Standardized testing and multiple-testing control (Benjamini-Hochberg)\n    z_scores = residuals / sigma_hat\n    p_values = 2 * norm.sf(np.abs(z_scores))\n\n    sorted_indices = np.argsort(p_values)\n    sorted_p_values = p_values[sorted_indices]\n    \n    k_div_m = np.arange(1, N + 1) / N\n    bh_thresholds = p['alpha'] * k_div_m\n    \n    is_significant_sorted = sorted_p_values = bh_thresholds\n    \n    discoveries = np.zeros(N, dtype=bool)\n    if np.any(is_significant_sorted):\n        k_star_idx = np.where(is_significant_sorted)[0].max()\n        p_value_threshold = sorted_p_values[k_star_idx]\n        discoveries = p_values = p_value_threshold\n\n    # 4. Island calling\n    if not np.any(discoveries):\n        return 0\n    \n    # Use diff to find starts and ends of contiguous runs of True\n    padded_discoveries = np.concatenate(([False], discoveries, [False]))\n    diffs = np.diff(padded_discoveries.astype(int))\n    starts = np.where(diffs == 1)[0]\n    ends = np.where(diffs == -1)[0]\n    \n    lengths = ends - starts\n    \n    num_islands = np.sum(lengths >= p['L_min'])\n    \n    return num_islands\n\nsolve()\n```"
        }
    ]
}