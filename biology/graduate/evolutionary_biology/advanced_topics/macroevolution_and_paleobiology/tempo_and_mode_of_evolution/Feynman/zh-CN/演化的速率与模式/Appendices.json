{
    "hands_on_practices": [
        {
            "introduction": "在量化演化速率时，研究人员根据时间尺度和性状的性质采用了不同的度量标准。霍尔丹（haldane）和达尔文（darwin）是两个核心的速率单位，前者衡量每代之内以表型标准差为单位的变化，后者则衡量在百万年尺度上的相对变化。这项练习旨在通过从第一性原理出发，推导这两个速率单位之间的转换公式，从而巩固对它们各自定义和假设的理解，这是比较不同演化研究并精确解读其结果的一项基本技能。",
            "id": "2755300",
            "problem": "某个谱系上测得的定量形态性状 $z(t)$ 是严格为正的，并且在所关注的时间窗口内，其表型标准差 $\\sigma_{z}$ 和平均值 $\\bar{z}$ 近似恒定。假设以每代表型标准差单位衡量的进化变化（即霍尔丹速率）在该时间窗口内近似恒定，等于 $H$。设 $n$ 表示代际时间（世代数），$t$ 表示以年为单位的年代时间。代际时长（年/代）为 $g$，因此 $t = g\\,n$。\n\n仅使用以下核心速率定义：\n\n- 霍尔丹速率定义为 $H = \\frac{1}{\\sigma_{z}} \\frac{d z}{d n}$。\n- 达尔文速率定义为每百万年的瞬时相对变化率， $D = \\frac{d \\ln z}{d T_{\\mathrm{Myr}}}$，其中 $T_{\\mathrm{Myr}}$ 以百万年为单位计量时间。等效地，当 $t$ 以年为单位时， $D = 10^{6} \\frac{d \\ln z}{d t}$。\n\n从这些定义以及 $t$ 和 $n$ 之间的关系出发，推导在性状均值 $\\bar{z}$ 处评估的达尔文速率 $D$ 的一个闭式表达式，该表达式是 $H$、$g$、$\\bar{z}$ 和 $\\sigma_{z}$ 的函数。您的答案必须是单一的解析表达式。最终速率以达尔文（每百万年）为单位表示。最终答案中不要提供中间步骤。",
            "solution": "在尝试求解之前，该问题首先需要进行严格的验证。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n\n问题陈述中提供的明确信息如下：\n- 定量形态性状 $z(t)$ 严格为正，$z(t)  0$。\n- 表型标准差 $\\sigma_z$ 近似恒定。\n- 性状均值 $\\bar{z}$ 近似恒定。\n- 霍尔丹速率 $H = \\frac{1}{\\sigma_{z}} \\frac{d z}{d n}$ 近似恒定。\n- 代际时间用 $n$ 表示。\n- 以年为单位的年代时间用 $t$ 表示。\n- 以年/代为单位的代际时长是一个常数 $g$。\n- 年代时间与代际时间的关系是 $t = g\\,n$。\n- 达尔文速率定义为 $D = 10^{6} \\frac{d \\ln z}{d t}$，其中 $t$ 的单位是年。\n\n目标是推导在性状均值 $\\bar{z}$ 处评估的达尔文速率 $D$ 的一个闭式表达式，该表达式是 $H$、$g$、$\\bar{z}$ 和 $\\sigma_z$ 的函数。\n\n**步骤2：使用提取的已知条件进行验证**\n\n依据所需标准对问题进行评估：\n\n- **科学依据充分：** 该问题牢固地植根于定量进化生物学。霍尔丹速率和达尔文速率的概念是量化表型进化速度的标准度量。所提供的定义是这些概念在科学文献中使用的正确表述。该问题是关联不同进化速率度量的一个标准练习。\n- **问题定义明确：** 该问题提供了从霍尔丹速率推导达尔文速率表达式所需的所有定义和关系。陈述中存在一个潜在的模糊之处，即均值 $\\bar{z}$ “近似恒定”，而变化率 $H$ 也恒定（这意味着 $z$ 随时间线性变化）。然而，“在性状均值 $\\bar{z}$ 处评估……”这一指令阐明了其意图：计算在性状值为 $z=\\bar{z}$ 的特定点上的瞬时达尔文速率。这是动态系统分析中的一个标准且定义明确的任务。它将 $\\bar{z}$ 视为用于计算的性状的一个特定的代表性值。这种解释解决了表面上的矛盾。\n- **客观性：** 该问题以精确的数学语言陈述，不含主观或非科学内容。\n\n该问题未违反任何无效性标准。这是一个基于既定科学原理的、形式化的、可解的问题。\n\n**步骤3：结论与行动**\n\n该问题被判定为**有效**。将进行求解。\n\n### 解题推导\n\n目标是找到达尔文速率 $D$ 关于霍尔丹速率 $H$ 和其他给定参数的表达式。\n\n达尔文速率的定义如下：\n$$D = 10^{6} \\frac{d \\ln z}{d t}$$\n此处，$t$ 是以年为单位计量的时间。\n\n使用链式法则进行微分，$\\frac{d \\ln z}{d t}$ 项可以展开为：\n$$\\frac{d \\ln z}{d t} = \\frac{d \\ln z}{d z} \\cdot \\frac{d z}{d t}$$\n自然对数函数 $\\ln(z)$ 对 $z$ 的导数是 $\\frac{1}{z}$。因此：\n$$\\frac{d \\ln z}{d t} = \\frac{1}{z} \\frac{d z}{d t}$$\n\n接下来，我们必须将关于年代时间的变化率 $\\frac{d z}{d t}$ 与关于代际时间的变化率 $\\frac{d z}{d n}$ 联系起来。$t$ 和 $n$ 之间的关系为 $t = g\\,n$。由于代际时长 $g$ 是一个常数，我们可以对 $t$ 关于 $n$ 求导得到 $\\frac{d t}{d n} = g$。再次使用链式法则：\n$$\\frac{d z}{d t} = \\frac{d z}{d n} \\cdot \\frac{d n}{d t}$$\n因为 $\\frac{d n}{d t} = \\left(\\frac{d t}{d n}\\right)^{-1} = \\frac{1}{g}$，我们有：\n$$\\frac{d z}{d t} = \\frac{1}{g} \\frac{d z}{d n}$$\n\n现在，我们使用霍尔丹速率 $H$ 的定义：\n$$H = \\frac{1}{\\sigma_z} \\frac{d z}{d n}$$\n重新整理此方程以求解 $\\frac{d z}{d n}$，得到：\n$$\\frac{d z}{d n} = H \\sigma_z$$\n\n将这个 $\\frac{d z}{d n}$ 的表达式代回到 $\\frac{d z}{d t}$ 的方程中：\n$$\\frac{d z}{d t} = \\frac{H \\sigma_z}{g}$$\n\n现在我们将此结果代回到 $\\frac{d \\ln z}{d t}$ 的表达式中：\n$$\\frac{d \\ln z}{d t} = \\frac{1}{z} \\left(\\frac{H \\sigma_z}{g}\\right) = \\frac{H \\sigma_z}{g z}$$\n\n最后，我们将其代入达尔文速率 $D$ 的定义中：\n$$D = 10^{6} \\left(\\frac{H \\sigma_z}{g z}\\right)$$\n这个表达式给出了作为性状值 $z$ 函数的达尔文速率。问题要求在性状均值 $z = \\bar{z}$ 处评估此速率。进行代入：\n$$D = 10^{6} \\frac{H \\sigma_z}{g \\bar{z}}$$\n\n这就是达尔文速率作为给定参数函数的最终闭式表达式。该表达式可以重组为 $D = 10^6 \\frac{H}{g} \\frac{\\sigma_z}{\\bar{z}}$，这表明达尔文速率取决于每年的霍尔丹速率（$H/g$）乘以变异系数（$\\sigma_z/\\bar{z}$）。",
            "answer": "$$\\boxed{10^{6} \\frac{H \\sigma_z}{g \\bar{z}}}$$"
        },
        {
            "introduction": "系统发育渐进论和间断平衡论之间的核心争论，可以通过数学模型进行精确的检验。这项练习将探索两种代表性模型：布朗运动（Brownian motion, $BM$），它描述了无约束的、渐进的性状演化；以及奥恩斯坦-乌伦贝克（Ornstein-Uhlenbeck, $OU$）过程，它模拟了围绕一个最优值的受约束演化（即停滞）。通过推导这两种随机过程下性状方差随时间演变的动态，你将亲身体会渐进论和停滞在宏观尺度上如何留下截然不同的数学印记，从而深刻理解模型行为与演化模式之间的联系。",
            "id": "2755285",
            "problem": "在宏观进化性状建模中，考虑沿着一个谱系的单个数量性状，其起始时间为 $t=0$，初始条件为 $X_{0}=Y_{0}=\\theta=0$。针对进化的速率和模式，提出了两种经典的随机模型。模型A是无偏随机游走，等同于布朗运动，其随机微分方程为 $dX_{t}=\\sigma_{B}\\,dW_{t}$，其中 $W_{t}$ 是标准维纳过程，$\\sigma_{B}0$ 是一个恒定的扩散参数。模型B是 Ornstein–Uhlenbeck (OU) 过程，其随机微分方程为 $dY_{t}=-\\alpha\\left(Y_{t}-\\theta\\right)\\,dt+\\sigma_{O}\\,dW_{t}$，其中 $\\alpha0$ 是向长期均值 $\\theta$ 吸引的强度，$\\sigma_{O}0$ 是扩散参数。\n\n从这些定义和维纳过程的标准性质（独立、平稳的高斯增量，均值为 $0$，方差与 $dt$ 成正比）出发，完成以下任务：\n\n1) 在不借助任何预先记忆的公式的情况下，分别推导模型A和模型B下方差 $\\operatorname{Var}[X_{t}]$ 和 $\\operatorname{Var}[Y_{t}]$ 随时间变化的函数。明确写出二阶矩服从的常微分方程（如果有）并求解。\n\n2) 利用你对模型B的结果，将 $t_{0.95}$ 定义为OU方差达到其长期稳态值 $0.95$ 倍时的时间。用 $\\alpha$ 解析求解 $t_{0.95}$。\n\n3) 定义诊断比率\n$$\nQ \\equiv \\frac{\\operatorname{Var}[X_{t_{0.95}}]}{\\lim_{t\\to\\infty}\\operatorname{Var}[Y_{t}]}\\,,\n$$\n该比率比较了当OU过程有效达到稳态时，无偏随机游走已经扩散了多远。在 $\\alpha=0.2$，$\\sigma_{B}=\\sigma_{O}=0.1$ 的情况下，计算 $Q$ 的值。将你的最终答案 $Q$ 四舍五入到四位有效数字。\n\n4) 结合你的方差结果，用文字简要解释 $\\operatorname{Var}[X_{t}]$ 和 $\\operatorname{Var}[Y_{t}]$ 随时间变化的鲜明对比，如何为宏观进化时间序列中的停滞与连续扩散提供诊断依据。你的解释不应涉及任何数值计算。\n\n最终答案仅提供 $Q$ 的数值（四舍五入到四位有效数字）。$Q$ 是无量纲的，因此不需要单位。",
            "solution": "题中所述问题在数学和科学上是合理的、适定的，并包含了唯一解所需的所有信息。我们将按要求进行推导。\n\n任务分为 $4$ 个部分。我们按顺序处理。\n\n1) 推导方差 $\\operatorname{Var}[X_{t}]$ 和 $\\operatorname{Var}[Y_{t}]$。\n\n对于模型A（布朗运动），随机微分方程 (SDE) 为 $dX_{t}=\\sigma_{B}\\,dW_{t}$，初始条件为 $X_{0}=0$。过程 $X_t$ 是一个缩放的维纳过程。其均值为 $\\operatorname{E}[X_{t}]=\\operatorname{E}[\\sigma_{B}W_{t}]=\\sigma_{B}\\operatorname{E}[W_{t}]=0$。因此，方差等于二阶矩，$\\operatorname{Var}[X_{t}] = \\operatorname{E}[X_{t}^2]$。\n令 $V_X(t) = \\operatorname{E}[X_{t}^2]$。为求 $V_X(t)$ 的常微分方程 (ODE)，我们对函数 $f(X_{t}) = X_{t}^2$ 应用 Itô's lemma。其微分为 $d(X_{t}^2) = 2X_{t}\\,dX_{t} + \\frac{1}{2}(2)(dX_{t})^2$。\n使用 SDE $dX_{t}=\\sigma_{B}\\,dW_{t}$ 和维纳过程的二次变分 $(dW_t)^2 = dt$，我们得到 $(dX_t)^2 = (\\sigma_B dW_t)^2 = \\sigma_B^2 dt$。\n将这些代入 Itô 微分：\n$$d(X_{t}^2) = 2X_{t}(\\sigma_{B}\\,dW_{t}) + \\sigma_{B}^2\\,dt$$\n对两边取期望，注意到随机积分项的期望为零，即 $\\operatorname{E}[X_{t}\\,dW_{t}]=0$。这得到：\n$$d\\operatorname{E}[X_{t}^2] = \\sigma_{B}^2\\,dt$$\n这就是二阶矩 $V_X(t) = \\operatorname{E}[X_t^2]$ 的 ODE：\n$$\\frac{dV_X}{dt} = \\sigma_{B}^2$$\n从 $s=0$到 $s=t$ 积分，并使用初始条件 $V_X(0) = \\operatorname{E}[X_{0}^2] = 0^2 = 0$，我们发现：\n$$V_X(t) - V_X(0) = \\int_0^t \\sigma_{B}^2 \\,ds \\implies V_X(t) = \\sigma_{B}^2 t$$\n因此，模型A的方差为 $\\operatorname{Var}[X_{t}] = \\sigma_{B}^2 t$。\n\n对于模型B (Ornstein–Uhlenbeck 过程)，SDE 为 $dY_{t}=-\\alpha(Y_{t}-\\theta)\\,dt+\\sigma_{O}\\,dW_{t}$。在给定条件 $\\theta=0$ 和 $Y_{0}=0$ 下，SDE 简化为 $dY_{t}=-\\alpha Y_{t}\\,dt+\\sigma_{O}\\,dW_{t}$。\n首先，我们求均值 $\\mu_Y(t) = \\operatorname{E}[Y_{t}]$。对 SDE 取期望得到 $d\\operatorname{E}[Y_{t}] = -\\alpha\\operatorname{E}[Y_{t}]\\,dt$，或 $\\frac{d\\mu_Y}{dt} = -\\alpha\\mu_Y$。由于 $\\mu_Y(0) = \\operatorname{E}[Y_0] = 0$，解为 $\\mu_Y(t) = 0$ 对所有 $t$ 成立。\n因此，方差为 $\\operatorname{Var}[Y_{t}] = \\operatorname{E}[Y_{t}^2]$。令 $V_Y(t) = \\operatorname{E}[Y_{t}^2]$。\n对 $f(Y_{t}) = Y_{t}^2$ 应用 Itô's lemma：$d(Y_{t}^2) = 2Y_{t}\\,dY_{t} + (dY_{t})^2$。\n二次变分为 $(dY_{t})^2 = (-\\alpha Y_{t}\\,dt+\\sigma_{O}\\,dW_{t})^2 = \\sigma_{O}^2(dW_t)^2 = \\sigma_{O}^2\\,dt$，因为包含 $dt^2$ 和 $dt\\,dW_t$ 的项是低阶项。\n代入 Itô 微分：\n$$d(Y_{t}^2) = 2Y_{t}(-\\alpha Y_{t}\\,dt+\\sigma_{O}\\,dW_{t}) + \\sigma_{O}^2\\,dt = -2\\alpha Y_{t}^2\\,dt + 2\\sigma_{O}Y_{t}\\,dW_{t} + \\sigma_{O}^2\\,dt$$\n取期望得到 $V_Y(t)$ 的 ODE：\n$$d\\operatorname{E}[Y_{t}^2] = -2\\alpha\\operatorname{E}[Y_{t}^2]\\,dt + \\sigma_{O}^2\\,dt \\implies \\frac{dV_Y}{dt} = -2\\alpha V_Y + \\sigma_{O}^2$$\n这是一个一阶线性 ODE。我们使用积分因子 $I(t) = \\exp(\\int 2\\alpha\\,dt) = \\exp(2\\alpha t)$ 来求解。将重新排列的 ODE $\\frac{dV_Y}{dt} + 2\\alpha V_Y = \\sigma_{O}^2$ 乘以 $I(t)$ 得到：\n$$\\frac{d}{dt}(V_Y(t)\\exp(2\\alpha t)) = \\sigma_{O}^2\\exp(2\\alpha t)$$\n从 $s=0$到 $s=t$ 积分，并使用初始条件 $V_Y(0) = \\operatorname{E}[Y_{0}^2] = 0$：\n$$V_Y(t)\\exp(2\\alpha t) - V_Y(0)\\exp(0) = \\int_0^t \\sigma_{O}^2\\exp(2\\alpha s)\\,ds = \\sigma_{O}^2 \\left[ \\frac{\\exp(2\\alpha s)}{2\\alpha} \\right]_0^t = \\frac{\\sigma_{O}^2}{2\\alpha} (\\exp(2\\alpha t) - 1)$$\n求解 $V_Y(t)$：\n$$V_Y(t) = \\frac{\\sigma_{O}^2}{2\\alpha} (1 - \\exp(-2\\alpha t))$$\n这是 OU 过程方差 $\\operatorname{Var}[Y_t]$ 的表达式。\n\n2) $t_{0.95}$ 的解析解。\n\nOU 过程的长期稳态方差为 $\\lim_{t\\to\\infty} \\operatorname{Var}[Y_{t}]$。\n$$\\lim_{t\\to\\infty} \\frac{\\sigma_{O}^2}{2\\alpha} (1 - \\exp(-2\\alpha t)) = \\frac{\\sigma_{O}^2}{2\\alpha}$$\n时间 $t_{0.95}$ 由条件 $\\operatorname{Var}[Y_{t_{0.95}}] = 0.95 \\times \\lim_{t\\to\\infty} \\operatorname{Var}[Y_{t}]$ 定义。\n$$\\frac{\\sigma_{O}^2}{2\\alpha} (1 - \\exp(-2\\alpha t_{0.95})) = 0.95 \\cdot \\frac{\\sigma_{O}^2}{2\\alpha}$$\n$$(1 - \\exp(-2\\alpha t_{0.95})) = 0.95$$\n$$\\exp(-2\\alpha t_{0.95}) = 1 - 0.95 = 0.05$$\n$$-2\\alpha t_{0.95} = \\ln(0.05)$$\n$$t_{0.95} = -\\frac{\\ln(0.05)}{2\\alpha} = \\frac{\\ln(1/0.05)}{2\\alpha} = \\frac{\\ln(20)}{2\\alpha}$$\n\n3) 诊断比率 $Q$ 的计算。\n\n该比率定义为：\n$$Q \\equiv \\frac{\\operatorname{Var}[X_{t_{0.95}}]}{\\lim_{t\\to\\infty}\\operatorname{Var}[Y_{t}]}$$\n代入之前推导出的表达式：\n分子：$\\operatorname{Var}[X_{t_{0.95}}] = \\sigma_{B}^2 t_{0.95} = \\sigma_{B}^2 \\frac{\\ln(20)}{2\\alpha}$。\n分母：$\\lim_{t\\to\\infty}\\operatorname{Var}[Y_{t}] = \\frac{\\sigma_{O}^2}{2\\alpha}$。\n因此，比率 $Q$ 为：\n$$Q = \\frac{\\sigma_{B}^2 \\frac{\\ln(20)}{2\\alpha}}{\\frac{\\sigma_{O}^2}{2\\alpha}} = \\frac{\\sigma_{B}^2}{\\sigma_{O}^2}\\ln(20)$$\n现在我们代入给定的数值：$\\alpha=0.2$，$\\sigma_{B}=0.1$，$\\sigma_{O}=0.1$。\n$$Q = \\left(\\frac{0.1}{0.1}\\right)^2 \\ln(20) = 1^2 \\ln(20) = \\ln(20)$$\n$\\ln(20)$ 的数值约为 $2.995732...$\n四舍五入到四位有效数字，我们得到 $Q = 2.996$。\n\n4) 解释诊断效用。\n\n方差随时间的不同表现为区分两种基本进化模式提供了有力的诊断依据。\n在模型A（布朗运动）下，方差 $\\operatorname{Var}[X_{t}] = \\sigma_B^2 t$ 随时间推移线性且无界地增加。这一数学性质反映了性状连续、无方向扩散或“随机游走”的生物学情景。与祖先状态的期望差异会无限增长。该模型是谱系渐变论的定量表示，其中进化变化是缓慢、连续和累积的。\n在模型B（Ornstein-Uhlenbeck）下，方差 $\\operatorname{Var}[Y_{t}] = \\frac{\\sigma_O^2}{2\\alpha}(1 - \\exp(-2\\alpha t))$ 最初增加，但渐近地趋于一个有限的稳态值 $\\frac{\\sigma_O^2}{2\\alpha}$。这种数学上的有界性反映了一个生物过程，其中性状受到约束，通常是通过稳定性选择围绕一个最优值 $\\theta$ 展开。虽然存在随机波动，但有一个强度为 $\\alpha$ 的“恢复力”阻止性状无限偏离。方差达到平台期标志着该过程已达到统计平衡。这种受约束的波动模式是停滞的特征，而停滞是进化论中点断平衡模型的核心组成部分。\n因此，一个显示方差随时间线性增加的古生物学时间序列，是扩散性、类布朗运动过程的证据。相反，一个方差稳定在平台期的时间序列，则是受约束的、类OU过程的证据，表明存在停滞。",
            "answer": "$$\\boxed{2.996}$$"
        },
        {
            "introduction": "将理论模型应用于真实数据是科学研究的核心环节。这项练习将引导你扮演一位古生物学家，面对一系列化石记录中的性状测量数据，并从头开始构建一个统计检验。你的任务是实施一个似然比检验（Likelihood Ratio Test），以判断观测到的演化序列更符合一个恒定的渐进速率模型，还是一个速率可变的模型（这可能反映了间断事件）。通过这个实践，你将把前面学到的关于演化速率和模型的抽象概念，转化为分析真实世界数据的强大工具，体验从数据中推断演化节律的完整过程。",
            "id": "2755226",
            "problem": "构建一个程序，该程序使用基本统计学原理和霍尔丹速率的标准定义，来操作化对离散化时间上的进化速率的推断。该程序必须接收一个数量性状在连续时间点上的重复测量值，这些测量值定义了$k$个具有已知代际时间的连续时间区间，然后估计每个区间特定的霍尔丹速率，并通过使用似然比检验（LRT）比较一个恒定速率模型与一个区间特定速率模型，来检验区间之间的速率异质性。解决方案必须基于以下基础，从第一性原理导出和实现：\n\n- 霍尔丹速率定义为每代性状均值的变化，以种群内表型标准差为单位进行衡量。\n- 中心极限定理证明了样本均值的抽样分布可近似为高斯分布，其方差等于时间点内的表型方差除以样本量。\n- 多个时间点的合并组内表型方差通过所有时间点的无偏合并方差来估计。\n- 对于独立观测，高斯似然在对数似然中是可加的。\n- 似然比检验通过最大化对数似然值的两倍差来比较嵌套模型，且其渐近服从卡方分布，自由度等于自由参数数量之差。\n\n对于每个测试用例，您将获得：\n- 跨越$k+1$个连续时间点的性状样本均值序列，表示为 $\\{ \\bar{z}_0, \\bar{z}_1, \\ldots, \\bar{z}_k \\}$。\n- 相应的时间点内样本标准差序列，表示为 $\\{ s_0, s_1, \\ldots, s_k \\}$。\n- 相应的样本量序列，表示为 $\\{ n_0, n_1, \\ldots, n_k \\}$。\n- 每个区间的代数序列，表示为 $\\{ g_0, g_1, \\ldots, g_{k-1} \\}$。\n\n为每个测试用例实现以下步骤，且完全从上述原理出发：\n\n1) 根据 $\\{ s_j \\}$ 和 $\\{ n_j \\}$，使用跨所有时间点计算的无偏合并方差来估计合并的时间点内表型标准差 $S$，然后取其平方根。\n\n2) 对于每个区间 $i \\in \\{0,1,\\ldots,k-1\\}$，通过用合并标准差 $S$ 和代数 $g_i$ 对观察到的样本均值变化进行标准化，来计算区间特定的霍尔丹速率估计值 $h_i$。\n\n3) 仅使用样本均值中的抽样不确定性来量化每个 $h_i$ 的观察方差。利用时间点 $j$ 的样本均值抽样方差为 $s_j^2 / n_j$ 这一事实，并假设时间点之间相互独立。将此不确定性传播到差值 $\\bar{z}_{i+1} - \\bar{z}_i$，并由此传播到 $h_i$。\n\n4) 为观察到的 $\\{ h_i \\}$ 指定具有已知方差的高斯似然：\n   - 在零假设（恒定速率；谱系渐变论）下，所有区间共享一个共同的真实速率 $r$，因此 $h_i$ 是具有共同均值 $r$ 和已知方差的独立高斯观测值。\n   - 在备择假设（速率异质性；与间断性动态一致）下，每个区间都有其自己的均值 $r_i$。\n\n5) 最大化两个似然函数以获得最大似然估计（通过推导，而非假设），并计算似然比统计量，其定义为最大化对数似然值的两倍差。在正则性条件下，该统计量渐近服从 $\\chi^2$ 分布，自由度等于 $k-1$。计算相应的尾部概率（十进制小数，而非百分比），解释为拒绝恒定速率模型而支持速率异质性模型的 $p$ 值。\n\n您的程序必须将上述方法应用于以下测试套件。每个测试用例由四元组 $(\\{\\bar{z}_j\\}, \\{s_j\\}, \\{n_j\\}, \\{g_i\\})$ 完全指定。下述所有数值均按原样使用：\n\n- 测试用例 A（近似恒定的霍尔丹速率；$k=4$）：\n  - 性状均值：$\\{ 10.0, 10.2, 10.4, 10.6, 10.8 \\}$\n  - 标准差：$\\{ 1.0, 1.0, 1.0, 1.0, 1.0 \\}$\n  - 样本量：$\\{ 50, 50, 50, 50, 50 \\}$\n  - 每个区间的代数：$\\{ 5, 5, 5, 5 \\}$\n\n- 测试用例 B（一次间断性跳跃；$k=3$）：\n  - 性状均值：$\\{ 10.0, 10.0, 12.0, 12.0 \\}$\n  - 标准差：$\\{ 1.0, 1.0, 1.0, 1.0 \\}$\n  - 样本量：$\\{ 50, 50, 50, 50 \\}$\n  - 每个区间的代数：$\\{ 10, 1, 10 \\}$\n\n- 测试用例 C（异方差抽样；最小自由度；$k=2$）：\n  - 性状均值：$\\{ 10.0, 10.5, 11.0 \\}$\n  - 标准差：$\\{ 1.0, 2.0, 1.0 \\}$\n  - 样本量：$\\{ 100, 5, 100 \\}$\n  - 每个区间的代数：$\\{ 10, 10 \\}$\n\n最终输出格式：\n- 对于每个测试用例，输出一个列表，按顺序包含所有区间特定的霍尔丹速率，后跟似然比统计量和相应的上尾 $\\chi^2$ $p$ 值。将所有报告的数字四舍五入到恰好六位小数。\n- 将三个针对各测试用例的列表聚合到一个列表中，并将其作为单行打印，例如：\n  - $[ [h_{A,0}, h_{A,1}, h_{A,2}, h_{A,3}, \\mathrm{LR}_A, p_A], [h_{B,0}, h_{B,1}, h_{B,2}, \\mathrm{LR}_B, p_B], [h_{C,0}, h_{C,1}, \\mathrm{LR}_C, p_C] ]$\n- 确保程序仅产生一行此格式的输出，数字四舍五入到六位小数，且无附加文本。",
            "solution": "此问题具有科学依据，提法明确，客观，并包含了唯一解所需的所有必要信息。这是定量进化生物学中的一个有效问题。我现在将提供完整的推导和解答。\n\n此问题要求使用一个统计检验来区分两种进化模式：谱系渐变论（建模为恒定的变化速率），以及一种与间断平衡论一致的模式（建模为跨时间区间的可变变化速率）。分析基于在离散时间点上对一个种群进行的一系列性状测量。该方法的核心是应用于进化速率嵌套高斯模型的似然比检验（LRT）。推导过程按要求从第一性原理开始。\n\n假设在不同的时间点上有一系列 $k+1$ 个性状测量值，索引为 $j=0, 1, \\ldots, k$。这些测量值定义了 $k$ 个连续的区间，索引为 $i=0, 1, \\ldots, k-1$。对于每个时间点 $j$，我们已知样本均值 $\\bar{z}_j$、样本标准差 $s_j$ 和样本量 $n_j$。对于每个区间 $i$，我们已知其以代为单位的持续时间 $g_i$。\n\n步骤1：估计合并的种群内标准差 $S$。\nhaldane是一种标准化速率，因此我们必须首先估计标准化单位，即共同的种群内表型标准差 $\\sigma$。我们通过合并所有 $k+1$ 个时间点的样本方差来估计此值。无偏合并方差 $S_p^2$ 是各个样本方差 $s_j^2$ 的加权平均，权重由自由度 $(n_j-1)$ 决定：\n$$ S_p^2 = \\frac{\\sum_{j=0}^{k} (n_j-1)s_j^2}{\\sum_{j=0}^{k} (n_j-1)} $$\n合并标准差 $S$ 是合并方差的平方根：\n$$ S = \\sqrt{S_p^2} $$\n这个 $S$ 值将作为我们对潜在表型标准差的最佳估计，并将用于标准化所有性状均值的变化。\n\n步骤2：计算区间特定的霍尔丹速率估计值 $h_i$。\n霍尔丹速率定义为每代性状均值的变化，以种群内标准差为单位。对于区间 $i$（即测量点 $i$ 和 $i+1$ 之间的时间），观察到的样本均值变化为 $\\Delta \\bar{z}_i = \\bar{z}_{i+1} - \\bar{z}_i$。此变化发生在 $g_i$ 代之内。因此，该区间的估计霍尔丹速率 $h_i$ 为：\n$$ h_i = \\frac{\\bar{z}_{i+1} - \\bar{z}_i}{S \\cdot g_i} $$\n对每个区间 $i \\in \\{0, 1, \\ldots, k-1\\}$ 进行此计算，得到一组观察到的速率 $\\{h_0, h_1, \\ldots, h_{k-1}\\}$。\n\n步骤3：量化每个霍尔丹速率估计值的观察方差 $\\sigma_{h_i}^2$。\n每个估计值 $h_i$ 都受抽样误差的影响，因为均值 $\\bar{z}_i$ 和 $\\bar{z}_{i+1}$ 本身就是估计值。根据中心极限定理，样本均值 $\\bar{z}_j$ 的抽样分布近似为高斯分布，其方差为 $\\sigma_j^2/n_j$，其中 $\\sigma_j^2$ 是时间点 $j$ 的真实性状方差。我们用 $s_j^2/n_j$ 来估计 $\\mathrm{Var}(\\bar{z}_j)$。鉴于不同时间点的样本是独立的，两个均值之差的方差是它们方差的和：\n$$ \\mathrm{Var}(\\bar{z}_{i+1} - \\bar{z}_i) = \\mathrm{Var}(\\bar{z}_{i+1}) + \\mathrm{Var}(\\bar{z}_i) \\approx \\frac{s_{i+1}^2}{n_{i+1}} + \\frac{s_i^2}{n_i} $$\n使用标准误差传播，通过将 $S$ 和 $g_i$ 视为常数，可以导出霍尔丹速率估计值 $h_i$ 的方差：\n$$ \\sigma_{h_i}^2 \\equiv \\mathrm{Var}(h_i) = \\mathrm{Var}\\left(\\frac{\\bar{z}_{i+1} - \\bar{z}_i}{S \\cdot g_i}\\right) = \\frac{1}{(S \\cdot g_i)^2} \\mathrm{Var}(\\bar{z}_{i+1} - \\bar{z}_i) $$\n代入差值的估计方差，得到：\n$$ \\sigma_{h_i}^2 = \\frac{1}{(S \\cdot g_i)^2} \\left(\\frac{s_{i+1}^2}{n_{i+1}} + \\frac{s_i^2}{n_i}\\right) $$\n对于后续的似然分析，这些观察方差 $\\{\\sigma_{h_0}^2, \\sigma_{h_1}^2, \\ldots, \\sigma_{h_{k-1}}^2\\}$ 被视为已知。\n\n步骤4：指定并最大化高斯似然。\n我们将每个观察到的霍尔丹速率 $h_i$ 建模为来自高斯分布 $h_i \\sim \\mathcal{N}(r_i, \\sigma_{h_i}^2)$ 的独立抽样，其中 $r_i$ 是区间 $i$ 的真实（但未知）霍尔丹速率。观察到集合 $\\{h_i\\}$ 的对数似然是各个对数似然的总和：\n$$ \\ln L(\\{h_i\\} | \\{r_i\\}) = C - \\frac{1}{2}\\sum_{i=0}^{k-1}\\frac{(h_i - r_i)^2}{\\sigma_{h_i}^2} $$\n其中 $C = -\\frac{k}{2}\\ln(2\\pi) - \\frac{1}{2}\\sum_{i=0}^{k-1}\\ln(\\sigma_{h_i}^2)$ 是一个不依赖于参数 $\\{r_i\\}$ 的常数。\n\n零假设 ($H_0$)：恒定速率（谱系渐变论）。所有区间的真实速率相同，即对所有 $i$ 都有 $r_i = r$。此模型有一个自由参数 $r$。为了找到最大似然估计（MLE） $\\hat{r}$，我们将对数似然关于 $r$ 的导数设为零来最大化它：\n$$ \\frac{\\partial \\ln L}{\\partial r} = \\sum_{i=0}^{k-1}\\frac{h_i - r}{\\sigma_{h_i}^2} = 0 \\implies \\hat{r} = \\frac{\\sum_{i=0}^{k-1} (h_i / \\sigma_{h_i}^2)}{\\sum_{i=0}^{k-1} (1 / \\sigma_{h_i}^2)} $$\nMLE $\\hat{r}$ 是观察速率 $\\{h_i\\}$ 的逆方差加权平均。在 $H_0$ 下最大化的对数似然为 $\\ln \\hat{L}_{null} = C - \\frac{1}{2}\\sum_{i=0}^{k-1}\\frac{(h_i - \\hat{r})^2}{\\sigma_{h_i}^2}$。\n\n备择假设 ($H_A$)：可变速率。每个区间都有其自己的速率 $r_i$。此模型有 $k$ 个自由参数 $\\{r_0, \\ldots, r_{k-1}\\}$。为了找到 MLEs $\\{\\hat{r}_i\\}$，我们分别对每个 $r_j$ 最大化对数似然。对于每个 $j$，$\\frac{\\partial \\ln L}{\\partial r_j} = \\frac{h_j - r_j}{\\sigma_{h_j}^2} = 0$，这得出 $\\hat{r}_j = h_j$。每个区间速率的 MLE 就是该区间的观察速率。\n在 $H_A$ 下最大化的对数似然为 $\\ln \\hat{L}_{alt} = C - \\frac{1}{2}\\sum_{i=0}^{k-1}\\frac{(h_i - h_i)^2}{\\sigma_{h_i}^2} = C$。\n\n步骤5：似然比检验。\nLRT 统计量比较了这两个嵌套模型（$H_0$ 嵌套在 $H_A$ 内）的拟合优度。该统计量定义为它们最大化对数似然值的两倍差：\n$$ \\mathrm{LR} = 2 (\\ln \\hat{L}_{alt} - \\ln \\hat{L}_{null}) = 2 \\left( C - \\left(C - \\frac{1}{2}\\sum_{i=0}^{k-1}\\frac{(h_i - \\hat{r})^2}{\\sigma_{h_i}^2}\\right) \\right) = \\sum_{i=0}^{k-1}\\frac{(h_i - \\hat{r})^2}{\\sigma_{h_i}^2} $$\n该统计量是观察速率与最佳拟合恒定速率之间偏差平方的加权和。在零假设下，该统计量渐近服从卡方（$\\chi^2$）随机变量分布。该分布的自由度（$df$）是模型之间自由参数数量的差：$df = k - 1$。\n$p$ 值是在假设 $H_0$ 为真的情况下，观察到至少与计算出的 LR 统计量一样大的概率。这由 $\\chi^2_{df}$ 分布的上尾概率给出：$p = P(\\chi^2_{k-1} \\ge \\mathrm{LR})$。一个小的 $p$ 值（例如，$0.05$）提供了拒绝恒定速率模型而支持速率异质性模型的证据。\n\n至此，所需统计程序的推导完成。实现将对每个测试用例精确地遵循这些步骤。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import chi2\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis on all test cases and print the final result.\n    \"\"\"\n    test_cases = [\n        # Test case A: Approximately constant haldane rates\n        {\n            \"means\": [10.0, 10.2, 10.4, 10.6, 10.8],\n            \"sds\": [1.0, 1.0, 1.0, 1.0, 1.0],\n            \"sizes\": [50, 50, 50, 50, 50],\n            \"gens\": [5, 5, 5, 5],\n        },\n        # Test case B: One punctuated jump\n        {\n            \"means\": [10.0, 10.0, 12.0, 12.0],\n            \"sds\": [1.0, 1.0, 1.0, 1.0],\n            \"sizes\": [50, 50, 50, 50],\n            \"gens\": [10, 1, 10],\n        },\n        # Test case C: Heteroscedastic sampling\n        {\n            \"means\": [10.0, 10.5, 11.0],\n            \"sds\": [1.0, 2.0, 1.0],\n            \"sizes\": [100, 5, 100],\n            \"gens\": [10, 10],\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result_list = process_case(case)\n        all_results.append(result_list)\n\n    # The final output must be a single line representing the list of lists.\n    # The str() conversion of a list automatically handles the formatting.\n    # The template's join(map(str,...)) correctly builds this string representation.\n    # Example: str([[1, 2], [3, 4]]) -> \"[[1, 2], [3, 4]]\"\n    # join map: '[' + ','.join(['[1, 2]', '[3, 4]']) + ']' -> '[[1, 2],[3, 4]]'\n    # The output is slightly different (no spaces), but both are valid Python representations.\n    # The template's proposal is more robust.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\n\ndef process_case(case):\n    \"\"\"\n    Analyzes a single test case according to the derived steps.\n    \n    Args:\n        case (dict): A dictionary containing 'means', 'sds', 'sizes', and 'gens'.\n        \n    Returns:\n        list: A list containing calculated haldane rates, the LR statistic, \n              and the p-value, with all numbers rounded to six decimal places.\n    \"\"\"\n    z = np.array(case[\"means\"])\n    s = np.array(case[\"sds\"])\n    n = np.array(case[\"sizes\"])\n    g = np.array(case[\"gens\"])\n\n    k = len(g)  # Number of intervals\n    \n    # --- Step 1: Estimate pooled within-time phenotypic standard deviation S ---\n    s_sq = s**2\n    numerator = np.sum((n - 1) * s_sq)\n    denominator = np.sum(n - 1)\n    S_p_sq = numerator / denominator\n    S = np.sqrt(S_p_sq)\n    \n    # --- Step 2: Compute interval-specific haldane estimates h_i ---\n    h = np.zeros(k)\n    for i in range(k):\n        delta_z = z[i+1] - z[i]\n        h[i] = delta_z / (S * g[i])\n        \n    # --- Step 3: Quantify the observation variance of each h_i ---\n    var_h = np.zeros(k)\n    for i in range(k):\n        var_delta_z = (s_sq[i+1] / n[i+1]) + (s_sq[i] / n[i])\n        var_h[i] = var_delta_z / (S * g[i])**2\n        \n    # --- Step 4: Maximize likelihood under the constant-rate model (H0) ---\n    # The MLE is the inverse-variance weighted mean of the h_i.\n    weights = 1.0 / var_h\n    r_hat = np.sum(weights * h) / np.sum(weights)\n\n    # --- Step 5: Compute the Likelihood Ratio (LR) statistic ---\n    # LR = sum( w_i * (h_i - r_hat)^2 )\n    lr_statistic = np.sum(weights * (h - r_hat)**2)\n    \n    # --- Step 6: Compute the p-value ---\n    # Degrees of freedom is k (params in H_A) - 1 (param in H_0)\n    df = k - 1\n    # The p-value is the upper-tail probability of the chi-square distribution.\n    # For df=0, chi2.sf is 0 for LR>0 and 1 for LR=0\n    if df > 0:\n        p_value = chi2.sf(lr_statistic, df)\n    else: # Edge case, e.g., k=1 interval\n        p_value = 1.0 if np.isclose(lr_statistic, 0) else 0.0\n\n    # --- Prepare final output for this case ---\n    results_raw = list(h) + [lr_statistic, p_value]\n    results_rounded = [round(val, 6) for val in results_raw]\n    \n    return results_rounded\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}