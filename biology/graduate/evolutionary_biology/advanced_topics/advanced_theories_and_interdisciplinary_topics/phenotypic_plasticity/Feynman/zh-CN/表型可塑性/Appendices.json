{
    "hands_on_practices": [
        {
            "introduction": "在研究表型可塑性时，最基础的任务便是从实验数据中对其进行量化。本练习将引导你使用最小二乘法，从两个环境下的表型观测值出发，推导并计算线性反应规范的截距 $a$ 和斜率 $b$。掌握这一过程能让你将抽象的统计方法与具体的生物学解释联系起来，为后续更深入的可塑性分析奠定坚实的基础。",
            "id": "2741824",
            "problem": "测定单个基因型在两种热环境下的一个数量性状，其表型由一个线性反应范式建模。设环境变量定义为与$25$摄氏度基线温度的偏差（单位：摄氏度），因此$E = 0$对应于$25$摄氏度。该基因型的观测数据为：在环境$E_1 = -5$（即$20$摄氏度）下，表型为$z_1 = 6.4$毫克；在环境$E_2 = +5$（即$30$摄氏度）下，表型为$z_2 = 5.2$毫克。假设线性反应范式为\n$$\nz(E) = a + b E + \\varepsilon,\n$$\n其中$a$和$b$是基因型特异性参数，$\\varepsilon$是均值为零的残差。从线性回归和最小二乘法原理的定义出发，利用这两个观测值推导最小二乘估计值$\\hat{a}$和$\\hat{b}$，计算它们的数值，并就表型可塑性方面解释$\\hat{a}$和$\\hat{b}$的生物学意义。$\\hat{a}$的单位为毫克，$\\hat{b}$的单位为毫克/摄氏度。按$a$和$b$的顺序报告最终的数值估计，使用精确小数值，不要四舍五入。",
            "solution": "对所述问题进行验证。\n\n**步骤1：提取已知条件**\n- 表型模型：线性反应范式，$z(E) = a + b E + \\varepsilon$。\n- 环境变量$E$：与$25$摄氏度基线温度的偏差（单位：摄氏度）。$E=0$对应于$25^\\circ\\text{C}$。\n- 观测值1：在$E_1 = -5$时，表型为$z_1 = 6.4$毫克。\n- 观测值2：在$E_2 = 5$时，表型为$z_2 = 5.2$毫克。\n- 参数$a$和$b$是基因型特异性的。\n- 残差$\\varepsilon$的均值为零。\n- 任务：从第一性原理出发推导最小二乘估计值$\\hat{a}$和$\\hat{b}$，计算其数值，并解释其生物学意义。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据，它利用了数量遗传学中标准的线性反应范式模型来描述表型可塑性。这是一个适定问题；对于两个数据点，存在一个能完美拟合它们的唯一线性函数，而最小二乘法将得出这个唯一解。所给数据对于确定该线性模型的两个参数是完整且一致的。这些数值是符合实际的。该问题是客观且可形式化的。\n\n**步骤3：结论与行动**\n此问题有效。将提供完整的推导和解答。\n\n最小二乘法原理指出，参数$a$和$b$的估计值（记作$\\hat{a}$和$\\hat{b}$）是使残差平方和$S$最小化的值。对于一个观测值$(E_i, z_i)$，其残差为$\\varepsilon_i = z_i - (a + b E_i)$。对于给定的两个观测值，其残差平方和为：\n$$\nS(a, b) = \\sum_{i=1}^{2} \\left[z_i - (a + b E_i)\\right]^2 = \\left[z_1 - (a + b E_1)\\right]^2 + \\left[z_2 - (a + b E_2)\\right]^2\n$$\n为求此函数的最小值，我们必须计算其关于$a$和$b$的偏导数，并令它们为零。这将得到一个由两个线性方程组成的方程组，称为正规方程组。\n\n首先，求关于$a$的偏导数：\n$$\n\\frac{\\partial S}{\\partial a} = \\frac{\\partial}{\\partial a} \\left( [z_1 - a - b E_1]^2 + [z_2 - a - b E_2]^2 \\right) = 2(z_1 - a - b E_1)(-1) + 2(z_2 - a - b E_2)(-1)\n$$\n令$\\frac{\\partial S}{\\partial a} = 0$：\n$$\n-2(z_1 - \\hat{a} - \\hat{b} E_1) - 2(z_2 - \\hat{a} - \\hat{b} E_2) = 0\n$$\n$$\n(z_1 + z_2) - 2\\hat{a} - \\hat{b}(E_1 + E_2) = 0\n$$\n$$\n2\\hat{a} + \\hat{b}(E_1 + E_2) = z_1 + z_2 \\quad \\quad (1)\n$$\n\n其次，求关于$b$的偏导数：\n$$\n\\frac{\\partial S}{\\partial b} = \\frac{\\partial}{\\partial b} \\left( [z_1 - a - b E_1]^2 + [z_2 - a - b E_2]^2 \\right) = 2(z_1 - a - b E_1)(-E_1) + 2(z_2 - a - b E_2)(-E_2)\n$$\n令$\\frac{\\partial S}{\\partial b} = 0$:\n$$\n-2E_1(z_1 - \\hat{a} - \\hat{b} E_1) - 2E_2(z_2 - \\hat{a} - \\hat{b} E_2) = 0\n$$\n$$\n-E_1z_1 + \\hat{a}E_1 + \\hat{b}E_1^2 - E_2z_2 + \\hat{a}E_2 + \\hat{b}E_2^2 = 0\n$$\n$$\n\\hat{a}(E_1 + E_2) + \\hat{b}(E_1^2 + E_2^2) = E_1z_1 + E_2z_2 \\quad \\quad (2)\n$$\n\n现在我们求解正规方程组(1)和(2)，以得到$\\hat{a}$和$\\hat{b}$。我们代入给定的环境值：$E_1 = -5$和$E_2 = 5$。\n由于环境关于零对称，可以得到一个显著的简化：\n$$\nE_1 + E_2 = -5 + 5 = 0\n$$\n将此代入方程(1)：\n$$\n2\\hat{a} + \\hat{b}(0) = z_1 + z_2 \\implies 2\\hat{a} = z_1 + z_2\n$$\n这给出了截距的估计量：\n$$\n\\hat{a} = \\frac{z_1 + z_2}{2}\n$$\n估计量$\\hat{a}$就是观测表型的算术平均值。这是实验设计的一个直接结果，其中环境变量的均值$\\bar{E} = (E_1+E_2)/2$为零。\n\n接下来，我们将$E_1+E_2=0$代入方程(2)：\n$$\n\\hat{a}(0) + \\hat{b}(E_1^2 + E_2^2) = E_1z_1 + E_2z_2 \\implies \\hat{b}(E_1^2 + E_2^2) = E_1z_1 + E_2z_2\n$$\n这给出了斜率的估计量：\n$$\n\\hat{b} = \\frac{E_1z_1 + E_2z_2}{E_1^2 + E_2^2}\n$$\n一个有用的验证是证明这等价于穿过两点的直线的标准斜率公式，即$\\frac{z_2 - z_1}{E_2 - E_1}$。因为$E_1 = -E_2$，令$E_2 = E_0 = 5$。则$E_1 = -E_0 = -5$。\n$$\n\\hat{b} = \\frac{(-E_0)z_1 + E_0 z_2}{(-E_0)^2 + E_0^2} = \\frac{E_0(z_2 - z_1)}{2E_0^2} = \\frac{z_2 - z_1}{2E_0}\n$$\n并且由于$E_2 - E_1 = E_0 - (-E_0) = 2E_0$，该公式确实是相同的。因此，从最小二乘法原理的推导得到了证实。\n\n现在我们使用给定数据计算数值：$z_1 = 6.4$和$z_2 = 5.2$。\n$$\n\\hat{a} = \\frac{6.4 + 5.2}{2} = \\frac{11.6}{2} = 5.8\n$$\n$$\n\\hat{b} = \\frac{z_2 - z_1}{E_2 - E_1} = \\frac{5.2 - 6.4}{5 - (-5)} = \\frac{-1.2}{10} = -0.12\n$$\n\n这些参数的生物学解释如下：\n- $\\hat{a}$：这是反应范式的截距，即当环境变量$E$为零时的预测表型值。在本问题中，$E=0$对应于$25$摄氏度的基线温度。因此，$\\hat{a} = 5.8$毫克是该基因型在$25^\\circ \\text{C}$下发育时的估计质量。它代表了研究中中心或参考环境下的表型。\n\n- $\\hat{b}$：这是反应范式的斜率。它量化了表型对环境变化的敏感度，而这正是表型可塑性的定义。$\\hat{b} = -0.12$毫克/摄氏度的值表示，温度从基线每升高$1^\\circ \\text{C}$，表型（质量）预计将减少$0.12$毫克。$\\hat{b}$不为零的事实表明该基因型对该性状具有表型可塑性。负号指明了这种可塑性的方向——质量随温度升高而降低，这是许多变温动物中一种称为“温度-体型法则”的常见模式。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 5.8 & -0.12 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "一旦我们能够描述反应规范，下一个关键问题便是理解它是如何演化的。本实践深入演化理论的核心，探讨作用于表型的选择如何转化为对反应规范参数（$a$ 和 $b$）的定向选择。通过推导选择梯度，你将揭示环境变异、最适表型与可塑性演化轨迹之间的定量联系。",
            "id": "2741888",
            "problem": "考虑一个种群，其标量表型在标量环境中的表达遵循线性反应范式。在环境 $E$ 中表达的表型为 $z(E)=a+bE$，其中 $a$ 是反应范式截距，$b$ 是反应范式斜率。生存力选择是稳定选择，并以依赖于环境的最适表型 $z^{*}(E)=\\alpha+\\beta E$ 为中心。在环境 $E$ 中的绝对适合度是围绕最适值的高斯稳定化选择，其宽度参数为 $V_{s}>0$，因此\n$$\nW(E; a,b)=W_{0}\\exp\\!\\left(-\\frac{\\left[z(E)-z^{*}(E)\\right]^{2}}{2V_{s}}\\right),\n$$\n其中 $W_{0}>0$ 是一个恒定的基线适合度。\n\n假设在每一代中，每个个体都会经历一个从某个分布中抽取的单一环境值 $E$，该分布独立于基因型，具有有限的均值 $\\mu_{E}$ 和方差 $\\sigma_{E}^{2}$。令马尔萨斯（对数）适合度为 $m(E; a,b)=\\ln W(E; a,b)$。将反应范式参数上的方向性选择梯度定义为期望马尔萨斯适合度相对于这些参数的梯度，并在当前的 $(a,b)$ 处进行评估：\n$$\n\\nabla_{(a,b)}\\,\\mathbb{E}\\!\\left[m(E; a,b)\\right]=\\left(\\frac{\\partial}{\\partial a}\\mathbb{E}[m(E; a,b)],\\ \\frac{\\partial}{\\partial b}\\mathbb{E}[m(E; a,b)]\\right),\n$$\n其中期望是关于环境分布计算的。\n\n请推导这个双分量方向性选择梯度的闭式表达式，用 $a$、$b$、$\\alpha$、$\\beta$、$\\mu_{E}$、$\\sigma_{E}^{2}$ 和 $V_{s}$ 表示。将最终结果表示为一个 $1\\times 2$ 的行矩阵。不需要进行数值计算，答案也不带单位。",
            "solution": "所述问题具有科学依据，提法恰当，且无矛盾或歧义。它代表了进化数量遗传学领域的一项标准计算。因此，我们可以着手进行推导。\n\n目标是计算反应范式参数 $(a, b)$ 上的方向性选择梯度，该梯度定义为期望马尔萨斯适合度的梯度：\n$$\n\\nabla_{(a,b)}\\,\\mathbb{E}\\!\\left[m(E; a,b)\\right]=\\left(\\frac{\\partial}{\\partial a}\\mathbb{E}[m(E; a,b)],\\ \\frac{\\partial}{\\partial b}\\mathbb{E}[m(E; a,b)]\\right)\n$$\n马尔萨斯适合度 $m(E; a, b)$ 是绝对适合度 $W(E; a, b)$ 的自然对数。首先，我们写出 $m(E; a, b)$ 的表达式。\n给定绝对适合度函数：\n$$\nW(E; a,b)=W_{0}\\exp\\!\\left(-\\frac{\\left[z(E)-z^{*}(E)\\right]^{2}}{2V_{s}}\\right)\n$$\n马尔萨斯适合度为：\n$$\nm(E; a,b) = \\ln\\left(W(E; a,b)\\right) = \\ln\\left(W_{0}\\exp\\!\\left(-\\frac{\\left[z(E)-z^{*}(E)\\right]^{2}}{2V_{s}}\\right)\\right)\n$$\n$$\nm(E; a,b) = \\ln(W_{0}) - \\frac{\\left[z(E)-z^{*}(E)\\right]^{2}}{2V_{s}}\n$$\n通过代入反应范式 $z(E) = a+bE$ 和最适表型 $z^{*}(E) = \\alpha+\\beta E$ 的表达式，可以得到与最适表型的偏差：\n$$\nz(E) - z^{*}(E) = (a+bE) - (\\alpha+\\beta E) = (a-\\alpha) + (b-\\beta)E\n$$\n将此式代入马尔萨斯适合度表达式中，得到：\n$$\nm(E; a,b) = \\ln(W_{0}) - \\frac{1}{2V_{s}}\\left[(a-\\alpha) + (b-\\beta)E\\right]^{2}\n$$\n为了求得选择梯度，我们必须计算期望马尔萨斯适合度 $\\mathbb{E}[m(E; a, b)]$ 关于 $a$ 和 $b$ 的偏导数。因为期望是线性算子，且关于 $a$ 和 $b$ 的偏导数也是线性算子，所以我们可以交换求期望和求导的顺序。这简化了计算过程。我们首先求出 $m(E; a, b)$ 关于 $a$ 和 $b$ 的偏导数，然后对所得表达式在环境 $E$ 的分布上求期望。\n\n$m(E; a, b)$ 关于 $a$ 的偏导数为：\n$$\n\\frac{\\partial m}{\\partial a} = \\frac{\\partial}{\\partial a}\\left(\\ln(W_{0}) - \\frac{1}{2V_{s}}\\left[(a-\\alpha) + (b-\\beta)E\\right]^{2}\\right)\n$$\n使用链式法则：\n$$\n\\frac{\\partial m}{\\partial a} = - \\frac{1}{2V_{s}} \\cdot 2 \\left[(a-\\alpha) + (b-\\beta)E\\right] \\cdot \\frac{\\partial}{\\partial a}\\left(a-\\alpha\\right)\n$$\n$$\n\\frac{\\partial m}{\\partial a} = - \\frac{1}{V_{s}} \\left[(a-\\alpha) + (b-\\beta)E\\right]\n$$\n$m(E; a, b)$ 关于 $b$ 的偏导数为：\n$$\n\\frac{\\partial m}{\\partial b} = \\frac{\\partial}{\\partial b}\\left(\\ln(W_{0}) - \\frac{1}{2V_{s}}\\left[(a-\\alpha) + (b-\\beta)E\\right]^{2}\\right)\n$$\n使用链式法则：\n$$\n\\frac{\\partial m}{\\partial b} = - \\frac{1}{2V_{s}} \\cdot 2 \\left[(a-\\alpha) + (b-\\beta)E\\right] \\cdot \\frac{\\partial}{\\partial b}\\left((b-\\beta)E\\right)\n$$\n$$\n\\frac{\\partial m}{\\partial b} = - \\frac{1}{V_{s}} \\left[(a-\\alpha) + (b-\\beta)E\\right] \\cdot E\n$$\n$$\n\\frac{\\partial m}{\\partial b} = - \\frac{1}{V_{s}} \\left[(a-\\alpha)E + (b-\\beta)E^{2}\\right]\n$$\n现在，我们计算这些偏导数的期望。项 $a, b, \\alpha, \\beta, V_s$ 相对于环境分布是常数。给定 $\\mathbb{E}[E] = \\mu_{E}$ 和 $\\text{Var}(E) = \\sigma_{E}^{2}$，这意味着 $\\mathbb{E}[E^2] = \\text{Var}(E) + (\\mathbb{E}[E])^{2} = \\sigma_{E}^{2} + \\mu_{E}^{2}$。\n\n选择梯度的第一个分量是：\n$$\n\\frac{\\partial}{\\partial a}\\mathbb{E}[m(E; a,b)] = \\mathbb{E}\\left[\\frac{\\partial m}{\\partial a}\\right] = \\mathbb{E}\\left[- \\frac{1}{V_{s}} \\left((a-\\alpha) + (b-\\beta)E\\right)\\right]\n$$\n$$\n= - \\frac{1}{V_{s}} \\left(\\mathbb{E}[a-\\alpha] + \\mathbb{E}[(b-\\beta)E]\\right) = - \\frac{1}{V_{s}} \\left((a-\\alpha) + (b-\\beta)\\mathbb{E}[E]\\right)\n$$\n$$\n= - \\frac{1}{V_{s}} \\left[(a-\\alpha) + (b-\\beta)\\mu_{E}\\right]\n$$\n选择梯度的第二个分量是：\n$$\n\\frac{\\partial}{\\partial b}\\mathbb{E}[m(E; a,b)] = \\mathbb{E}\\left[\\frac{\\partial m}{\\partial b}\\right] = \\mathbb{E}\\left[- \\frac{1}{V_{s}} \\left((a-\\alpha)E + (b-\\beta)E^{2}\\right)\\right]\n$$\n$$\n= - \\frac{1}{V_{s}} \\left(\\mathbb{E}[(a-\\alpha)E] + \\mathbb{E}[(b-\\beta)E^{2}]\\right) = - \\frac{1}{V_{s}} \\left((a-\\alpha)\\mathbb{E}[E] + (b-\\beta)\\mathbb{E}[E^{2}]\\right)\n$$\n$$\n= - \\frac{1}{V_{s}} \\left[(a-\\alpha)\\mu_{E} + (b-\\beta)(\\sigma_{E}^{2} + \\mu_{E}^{2})\\right]\n$$\n第二个分量的这个表达式可以重新整理，以揭示其与第一个分量的关系：\n$$\n- \\frac{1}{V_{s}} \\left[(a-\\alpha)\\mu_{E} + (b-\\beta)\\mu_{E}^{2} + (b-\\beta)\\sigma_{E}^{2}\\right] = - \\frac{1}{V_{s}} \\left[\\mu_{E}\\left((a-\\alpha) + (b-\\beta)\\mu_{E}\\right) + (b-\\beta)\\sigma_{E}^{2}\\right]\n$$\n方向性选择梯度是包含这两个分量的 $1 \\times 2$ 行矩阵：\n$$\n\\nabla_{(a,b)}\\,\\mathbb{E}[m] = \\begin{pmatrix} - \\frac{1}{V_{s}} \\left[(a-\\alpha) + (b-\\beta)\\mu_{E}\\right] & - \\frac{1}{V_{s}} \\left[(a-\\alpha)\\mu_{E} + (b-\\beta)(\\sigma_{E}^{2} + \\mu_{E}^{2})\\right] \\end{pmatrix}\n$$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} - \\frac{1}{V_{s}} \\left[ (a - \\alpha) + (b - \\beta)\\mu_{E} \\right] & - \\frac{1}{V_{s}} \\left[ (a - \\alpha)\\mu_{E} + (b - \\beta)(\\sigma_{E}^{2} + \\mu_{E}^{2}) \\right] \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "现实世界中的反应规范通常是非线性的，其具体形状是演化的产物。这项高级实践将挑战你对一个二次反应规范的演化进行建模，其中同时考虑了稳定化选择和可塑性的代价。你将首先推导出平衡条件，然后通过编程求解，探索不同的环境分布（从简单高斯分布到复杂双峰分布）如何决定反应规范的最优曲率 $c$。这项练习连接了分析理论与计算生物学，旨在让你对复杂性状的适应性塑造获得深刻见解。",
            "id": "2741861",
            "problem": "要求您形式化并分析一个表型可塑性模型，其中一个基因型在环境梯度上表达非线性反应范式。在环境 $e$ 中表达的表型由二次反应范式 $z(e) = a + b e + c e^2$ 给出，其中 $a$、$b$ 和 $c$ 分别是截距、斜率和曲率。依赖于环境的最优表型是 $\\phi(e) = \\phi_0 + \\phi_1 e + \\phi_2 e^2$。生存力选择通过稳定选择作用于 $z(e)$ 和 $\\phi(e)$ 之间的偏差，其选择宽度为 $\\sigma_s$，同时维持 $a$、$b$ 和 $c$ 会产生相应的成本。\n\n使用的基本基础和假设：\n- 自然选择增加平均 Malthusian 适应度。假设基因型足够稀有，突变步长足够小，以至于在相关的时间尺度上，常驻反应范式参数 $(a,b,c)$ 通过最大化期望对数适应度 $\\mathbb{E}_e[\\ln W(e)]$ 来演化。\n- 在环境 $e$ 中的瞬时适应度为\n$$\nW(e) = \\exp\\!\\left(-\\frac{(z(e) - \\phi(e))^2}{2\\sigma_s^2}\\right)\\,\\exp\\!\\left(-\\kappa_a a^2 - \\kappa_b b^2 - \\kappa_c c^2\\right),\n$$\n其中 $\\sigma_s > 0$ 且 $\\kappa_a,\\kappa_b,\\kappa_c \\ge 0$。\n- 环境变量 $e$ 是一个实值随机变量，每一代都从一个固定的分布中独立抽取，其直至4阶的原点矩都存在，即对于 $k \\in \\{1,2,3,4\\}$，$m_k = \\mathbb{E}[e^k]$ 存在。\n\n您的任务：\n- 仅从上述定义和在所述假设下演化会最大化 $\\mathbb{E}_e[\\ln W(e)]$ 这一原理出发，推导出一阶条件。这些条件用环境矩 $m_1, m_2, m_3, m_4$、选择宽度 $\\sigma_s$、成本系数 $\\kappa_a,\\kappa_b,\\kappa_c$ 以及最优表型系数 $\\phi_0,\\phi_1,\\phi_2$ 来刻画平稳值 $(a^\\star,b^\\star,c^\\star)$。\n- 使用这些一阶条件，设计一个算法，在给定 $(m_1,\\dots,m_4)$、$(\\phi_0,\\phi_1,\\phi_2)$、$(\\kappa_a,\\kappa_b,\\kappa_c)$ 和 $\\sigma_s$ 的情况下，返回平稳曲率 $c^\\star$。\n\n答案必须是一个完整的、可运行的程序，为下述每个测试用例计算 $c^\\star$。没有物理单位；所有量纲均为无量纲。不涉及角度。您的程序必须为指定的分布实现确切的环境原点矩 $m_k = \\mathbb{E}[e^k]$。\n\n- 测试用例 1 (理想情况):\n  - 环境：均值为 $0$、方差为 $1$ 的高斯分布，记作 $\\mathcal{N}(0,1)$。\n  - 参数：$(\\phi_0,\\phi_1,\\phi_2) = (0, 1, 0.2)$, $(\\kappa_a,\\kappa_b,\\kappa_c) = (0.01, 0.01, 0.01)$, $\\sigma_s = 0.5$。\n- 测试用例 2 (不同的分布宽度和尾部):\n  - 环境：在 $[-1,1]$ 上的均匀分布。\n  - 参数：$(\\phi_0,\\phi_1,\\phi_2) = (0, 1, 0.2)$, $(\\kappa_a,\\kappa_b,\\kappa_c) = (0.01, 0.01, 0.01)$, $\\sigma_s = 0.5$。\n- 测试用例 3 (双峰性):\n  - 环境：对称双峰混合分布 $\\tfrac{1}{2}\\mathcal{N}(-1, 0.2^2) + \\tfrac{1}{2}\\mathcal{N}(1, 0.2^2)$。\n  - 参数：$(\\phi_0,\\phi_1,\\phi_2) = (0, 0, 0.2)$, $(\\kappa_a,\\kappa_b,\\kappa_c) = (0.01, 0.01, 0.01)$, $\\sigma_s = 0.5$。\n- 测试用例 4 (边界条件：极窄的环境):\n  - 环境：均值为 $0$、方差为 $0.1^2$ 的高斯分布，即 $\\mathcal{N}(0, 0.01)$。\n  - 参数：$(\\phi_0,\\phi_1,\\phi_2) = (0, 1, 0.2)$, $(\\kappa_a,\\kappa_b,\\kappa_c) = (0.01, 0.01, 0.01)$, $\\sigma_s = 0.5$。\n- 测试用例 5 (边界条件：非常高的曲率成本和符号相反的最优曲率):\n  - 环境：均值为 $0$、方差为 $1$ 的高斯分布，记作 $\\mathcal{N}(0,1)$。\n  - 参数：$(\\phi_0,\\phi_1,\\phi_2) = (0, 1, -0.3)$, $(\\kappa_a,\\kappa_b,\\kappa_c) = (0.01, 0.01, 5.0)$, $\\sigma_s = 0.5$。\n\n您的程序要使用的环境原点矩：\n- 如果 $e \\sim \\mathcal{N}(\\mu,\\sigma^2)$，则 $m_1 = \\mu$, $m_2 = \\mu^2 + \\sigma^2$, $m_3 = \\mu^3 + 3\\mu\\sigma^2$, $m_4 = \\mu^4 + 6\\mu^2\\sigma^2 + 3\\sigma^4$。\n- 如果 $e \\sim \\text{Uniform}[L,U]$，则 $m_k = \\dfrac{U^{k+1} - L^{k+1}}{(k+1)(U-L)}$ 对于 $k \\in \\{1,2,3,4\\}$。\n- 如果 $e$ 是对称混合分布 $\\tfrac{1}{2}\\mathcal{N}(-\\mu,\\sigma^2) + \\tfrac{1}{2}\\mathcal{N}(\\mu,\\sigma^2)$，则 $m_1 = 0$, $m_2 = \\mu^2 + \\sigma^2$, $m_3 = 0$, $m_4 = \\mu^4 + 6\\mu^2\\sigma^2 + 3\\sigma^4$。\n\n最终输出规范：\n- 对于上述每个测试用例，按顺序计算平稳曲率 $c^\\star$ 作为一个浮点数。\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表，结果括在方括号中，例如 $[x_1,x_2,x_3,x_4,x_5]$，其中每个 $x_i$ 是测试用例 $i$ 的 $c^\\star$，四舍五入到恰好 $6$ 位小数。",
            "solution": "问题陈述有效。它在科学上基于表型可塑性理论，问题定义良好、客观，并为获得唯一解提供了所有必要信息。我将开始进行推导和求解。\n\n任务是找到反应范式参数的平稳值 $(a^\\star, b^\\star, c^\\star)$，以最大化期望对数适应度 $\\mathbb{E}_e[\\ln W(e)]$。\n\n在环境 $e$ 中的适应度函数由下式给出：\n$$W(e) = \\exp\\!\\left(-\\frac{(z(e) - \\phi(e))^2}{2\\sigma_s^2}\\right)\\,\\exp\\!\\left(-\\kappa_a a^2 - \\kappa_b b^2 - \\kappa_c c^2\\right)$$\n其中反应范式为 $z(e) = a + b e + c e^2$，最优表型为 $\\phi(e) = \\phi_0 + \\phi_1 e + \\phi_2 e^2$。参数 $\\kappa_a, \\kappa_b, \\kappa_c \\ge 0$ 表示可塑性成本，$\\sigma_s > 0$ 定义了稳定选择的强度。\n\n适应度的对数是：\n$$ \\ln W(e) = -\\frac{(z(e) - \\phi(e))^2}{2\\sigma_s^2} - \\kappa_a a^2 - \\kappa_b b^2 - \\kappa_c c^2 $$\n我们必须最大化该量在环境 $e$ 的分布上的期望值，记为 $F(a, b, c) = \\mathbb{E}_e[\\ln W(e)]$。根据期望的线性性质：\n$$ F(a,b,c) = \\mathbb{E}_e\\left[ -\\frac{(z(e) - \\phi(e))^2}{2\\sigma_s^2} \\right] - \\mathbb{E}_e\\left[\\kappa_a a^2 + \\kappa_b b^2 + \\kappa_c c^2\\right] $$\n成本参数和反应范式参数相对于 $e$ 是常数，因此成本项的期望就是其本身。\n$$ F(a,b,c) = -\\frac{1}{2\\sigma_s^2} \\mathbb{E}_e\\left[ (z(e) - \\phi(e))^2 \\right] - \\kappa_a a^2 - \\kappa_b b^2 - \\kappa_c c^2 $$\n令表型与最优值之间的偏差为 $\\Delta(e) = z(e) - \\phi(e)$。代入 $z(e)$ 和 $\\phi(e)$ 的多项式，我们得到：\n$$ \\Delta(e) = (a - \\phi_0) + (b - \\phi_1)e + (c - \\phi_2)e^2 $$\n我们展开偏差的平方项：\n$$ \\Delta(e)^2 = \\left((a - \\phi_0) + (b - \\phi_1)e + (c - \\phi_2)e^2\\right)^2 $$\n$$ \\Delta(e)^2 = (a - \\phi_0)^2 + (b - \\phi_1)^2 e^2 + (c - \\phi_2)^2 e^4 + 2(a - \\phi_0)(b - \\phi_1)e + 2(a - \\phi_0)(c - \\phi_2)e^2 + 2(b - \\phi_1)(c - \\phi_2)e^3 $$\n现在，我们对 $\\Delta(e)^2$ 在 $e$ 的分布上取期望。使用原点矩的定义 $m_k = \\mathbb{E}[e^k]$，并注意到 $m_0 = \\mathbb{E}[e^0] = 1$：\n$$ \\mathbb{E}_e[\\Delta(e)^2] = (a-\\phi_0)^2 m_0 + (b-\\phi_1)^2 m_2 + (c-\\phi_2)^2 m_4 + 2(a-\\phi_0)(b-\\phi_1)m_1 + 2(a-\\phi_0)(c-\\phi_2)m_2 + 2(b-\\phi_1)(c-\\phi_2)m_3 $$\n将此代回 $F(a,b,c)$ 的表达式中：\n$$ F(a,b,c) = -\\frac{1}{2\\sigma_s^2} \\left[ (a-\\phi_0)^2 + \\dots \\right] - \\kappa_a a^2 - \\kappa_b b^2 - \\kappa_c c^2 $$\n为了找到平稳点 $(a^\\star, b^\\star, c^\\star)$，我们将 $F(a, b, c)$ 对 $a$、$b$ 和 $c$ 的偏导数设为零。\n\n关于 $a$ 的偏导数是：\n$$ \\frac{\\partial F}{\\partial a} = -\\frac{1}{2\\sigma_s^2} \\left[ 2(a-\\phi_0) + 2(b-\\phi_1)m_1 + 2(c-\\phi_2)m_2 \\right] - 2\\kappa_a a = 0 $$\n乘以 $-\\sigma_s^2$ 并为平稳值重新整理，得到第一个一阶条件：\n$$ (a^\\star-\\phi_0) + (b^\\star-\\phi_1)m_1 + (c^\\star-\\phi_2)m_2 + 2\\sigma_s^2 \\kappa_a a^\\star = 0 $$\n$$ a^\\star(1 + 2\\sigma_s^2 \\kappa_a) + b^\\star m_1 + c^\\star m_2 = \\phi_0 + \\phi_1 m_1 + \\phi_2 m_2 $$\n\n关于 $b$ 的偏导数是：\n$$ \\frac{\\partial F}{\\partial b} = -\\frac{1}{2\\sigma_s^2} \\left[ 2(b-\\phi_1)m_2 + 2(a-\\phi_0)m_1 + 2(c-\\phi_2)m_3 \\right] - 2\\kappa_b b = 0 $$\n重新整理得到第二个条件：\n$$ (a^\\star-\\phi_0)m_1 + (b^\\star-\\phi_1)m_2 + (c^\\star-\\phi_2)m_3 + 2\\sigma_s^2 \\kappa_b b^\\star = 0 $$\n$$ a^\\star m_1 + b^\\star(m_2 + 2\\sigma_s^2 \\kappa_b) + c^\\star m_3 = \\phi_0 m_1 + \\phi_1 m_2 + \\phi_2 m_3 $$\n\n关于 $c$ 的偏导数是：\n$$ \\frac{\\partial F}{\\partial c} = -\\frac{1}{2\\sigma_s^2} \\left[ 2(c-\\phi_2)m_4 + 2(a-\\phi_0)m_2 + 2(b-\\phi_1)m_3 \\right] - 2\\kappa_c c = 0 $$\n重新整理得到第三个条件：\n$$ (a^\\star-\\phi_0)m_2 + (b^\\star-\\phi_1)m_3 + (c^\\star-\\phi_2)m_4 + 2\\sigma_s^2 \\kappa_c c^\\star = 0 $$\n$$ a^\\star m_2 + b^\\star m_3 + c^\\star(m_4 + 2\\sigma_s^2 \\kappa_c) = \\phi_0 m_2 + \\phi_1 m_3 + \\phi_2 m_4 $$\n\n这三个关于 $(a^\\star, b^\\star, c^\\star)$ 的线性方程可以写成矩阵形式 $\\mathbf{M} \\mathbf{x} = \\mathbf{v}$，其中 $\\mathbf{x} = [a^\\star, b^\\star, c^\\star]^T$。系数矩阵 $\\mathbf{M}$ 是：\n$$\n\\mathbf{M} = \\begin{pmatrix}\n1 + 2\\sigma_s^2 \\kappa_a & m_1 & m_2 \\\\\nm_1 & m_2 + 2\\sigma_s^2 \\kappa_b & m_3 \\\\\nm_2 & m_3 & m_4 + 2\\sigma_s^2 \\kappa_c\n\\end{pmatrix}\n$$\n右侧的向量 $\\mathbf{v}$ 是：\n$$\n\\mathbf{v} = \\begin{pmatrix}\n\\phi_0 + \\phi_1 m_1 + \\phi_2 m_2 \\\\\n\\phi_0 m_1 + \\phi_1 m_2 + \\phi_2 m_3 \\\\\n\\phi_0 m_2 + \\phi_1 m_3 + \\phi_2 m_4\n\\end{pmatrix}\n$$\n矩阵 $\\mathbf{M}$ 是对称的。由于矩矩阵是 Gram 矩阵，因此是半正定的，并且成本矩阵是对角矩阵，其对角线元素非负（对于测试用例是严格为正），所以 $\\mathbf{M}$ 是正定的，因此是可逆的，这保证了唯一解的存在。\n\n找到 $c^\\star$ 的算法如下：\n1. 对于每个测试用例，计算环境矩 $m_1, m_2, m_3, m_4$。\n2. 使用推导出的公式构建 $3 \\times 3$ 矩阵 $\\mathbf{M}$ 和 $3 \\times 1$ 向量 $\\mathbf{v}$。\n3. 求解线性系统 $\\mathbf{M} \\mathbf{x} = \\mathbf{v}$，得到平稳参数向量 $\\mathbf{x} = [a^\\star, b^\\star, c^\\star]^T$。\n4. 结果是解向量的第三个分量 $c^\\star$。\n这就构成了计算求解的完整理论基础。",
            "answer": "```python\nimport numpy as np\n\ndef get_gaussian_moments(mu, sigma_sq):\n    \"\"\"\n    Calculates the first four raw moments for a Gaussian distribution \n    N(mu, sigma_sq).\n    \"\"\"\n    m1 = mu\n    m2 = mu**2 + sigma_sq\n    m3 = mu**3 + 3 * mu * sigma_sq\n    m4 = mu**4 + 6 * mu**2 * sigma_sq + 3 * sigma_sq**2\n    return m1, m2, m3, m4\n\ndef get_uniform_moments(L, U):\n    \"\"\"\n    Calculates the first four raw moments for a Uniform distribution on [L, U].\n    \"\"\"\n    moments = []\n    for k in range(1, 5):\n        if abs(U - L) < 1e-12: # Handles the case of a point mass\n            mk = L**k\n        else:\n            mk = (U**(k + 1) - L**(k + 1)) / ((k + 1) * (U - L))\n        moments.append(mk)\n    return tuple(moments)\n\ndef get_bimodal_gaussian_moments(mu, sigma_sq):\n    \"\"\"\n    Calculates the first four raw moments for a symmetric bimodal Gaussian \n    mixture distribution 0.5*N(-mu, sigma_sq) + 0.5*N(mu, sigma_sq).\n    \"\"\"\n    m1 = 0.0\n    m2 = mu**2 + sigma_sq\n    m3 = 0.0\n    m4 = mu**4 + 6 * mu**2 * sigma_sq + 3 * sigma_sq**2\n    return m1, m2, m3, m4\n\ndef solve_for_c_star(phi, kappa, sigma_s, moments):\n    \"\"\"\n    Solves the linear system for the stationary reaction norm parameters \n    and returns the curvature c_star.\n    \"\"\"\n    phi0, phi1, phi2 = phi\n    kappa_a, kappa_b, kappa_c = kappa\n    m1, m2, m3, m4 = moments\n    m0 = 1.0\n    \n    sigma_s_sq = sigma_s**2\n\n    # Construct the matrix M based on the first-order conditions\n    M = np.array([\n        [m0 + 2 * sigma_s_sq * kappa_a, m1, m2],\n        [m1, m2 + 2 * sigma_s_sq * kappa_b, m3],\n        [m2, m3, m4 + 2 * sigma_s_sq * kappa_c]\n    ], dtype=np.float64)\n\n    # Construct the vector v based on the first-order conditions\n    v = np.array([\n        phi0 * m0 + phi1 * m1 + phi2 * m2,\n        phi0 * m1 + phi1 * m2 + phi2 * m3,\n        phi0 * m2 + phi1 * m3 + phi2 * m4\n    ], dtype=np.float64)\n\n    # Solve the system M * x = v for x = [a_star, b_star, c_star]\n    try:\n        x = np.linalg.solve(M, v)\n        c_star = x[2]\n        return c_star\n    except np.linalg.LinAlgError:\n        # This case is not expected given the problem's constraints\n        return np.nan\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # Test case 1 (happy path)\n        {'phi': (0.0, 1.0, 0.2), 'kappa': (0.01, 0.01, 0.01), 'sigma_s': 0.5, 'env': ('gaussian', {'mu': 0.0, 'sigma_sq': 1.0})},\n        # Test case 2 (different spread and tails)\n        {'phi': (0.0, 1.0, 0.2), 'kappa': (0.01, 0.01, 0.01), 'sigma_s': 0.5, 'env': ('uniform', {'L': -1.0, 'U': 1.0})},\n        # Test case 3 (bimodality)\n        {'phi': (0.0, 0.0, 0.2), 'kappa': (0.01, 0.01, 0.01), 'sigma_s': 0.5, 'env': ('bimodal', {'mu': 1.0, 'sigma_sq': 0.2**2})},\n        # Test case 4 (boundary condition: extremely narrow environment)\n        {'phi': (0.0, 1.0, 0.2), 'kappa': (0.01, 0.01, 0.01), 'sigma_s': 0.5, 'env': ('gaussian', {'mu': 0.0, 'sigma_sq': 0.1**2})},\n        # Test case 5 (boundary condition: very high curvature cost)\n        {'phi': (0.0, 1.0, -0.3), 'kappa': (0.01, 0.01, 5.0), 'sigma_s': 0.5, 'env': ('gaussian', {'mu': 0.0, 'sigma_sq': 1.0})},\n    ]\n\n    results = []\n    for case in test_cases:\n        env_type, env_params = case['env']\n        \n        if env_type == 'gaussian':\n            moments = get_gaussian_moments(**env_params)\n        elif env_type == 'uniform':\n            moments = get_uniform_moments(**env_params)\n        elif env_type == 'bimodal':\n            moments = get_bimodal_gaussian_moments(**env_params)\n        else:\n            # Should not be reached with the defined test cases\n            raise ValueError(f\"Unknown environment type: {env_type}\")\n            \n        c_star = solve_for_c_star(case['phi'], case['kappa'], case['sigma_s'], moments)\n        results.append(c_star)\n        \n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```"
        }
    ]
}