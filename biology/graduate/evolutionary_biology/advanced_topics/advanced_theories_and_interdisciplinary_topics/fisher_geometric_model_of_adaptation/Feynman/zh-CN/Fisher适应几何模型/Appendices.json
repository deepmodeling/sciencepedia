{
    "hands_on_practices": [
        {
            "introduction": "Fisher几何模型的一个核心预测是新突变的适合度效应分布（DFE）。本练习将指导你计算该分布的两个基本统计量：平均值和方差。理解这些一阶和二阶矩对于掌握随机突变在适应性景观中的即时演化命运至关重要，是分析该模型的关键第一步。",
            "id": "2713201",
            "problem": "考虑Fisher的适应性几何模型（FGM），其中表型是一个$n$维向量$\\mathbf{z} \\in \\mathbb{R}^{n}$，最优表型位于原点，马尔萨斯适应度是到最优点距离的二次函数。不失一般性，采用一种曲率缩放，使得马尔萨斯适应度由$m(\\mathbf{z}) = - \\frac{1}{2}\\|\\mathbf{z}\\|^{2}$给出。设固有基因型距离最优点为$r = \\|\\mathbf{z}\\|$。一个新的突变增加了一个表型步长$\\Delta$，该步长是各向同性的（方向在$\\mathbb{R}^{n}$的单位球面上均匀分布），且具有固定大小$\\|\\Delta\\| = \\sqrt{\\mu_{2}}$，其中$\\mu_{2}$表示步长分布的二阶矩。将单个突变的选择系数$s$定义为马尔萨斯适应度的变化量，$s = m(\\mathbf{z} + \\Delta) - m(\\mathbf{z})$。\n\n计算在突变方向的各向同性分布下，$s$的均值和方差，并表示为$r$、$n$和$\\mu_{2}$的函数。将最终结果表示为一个没有单位的行矩阵$\\big(\\mathbb{E}[s]\\ \\ \\mathrm{Var}(s)\\big)$。不需要进行数值舍入；请提供精确的解析表达式。",
            "solution": "该问题陈述经核实具有科学依据、提法恰当、客观且内容完整。这是理论进化生物学中关于Fisher几何模型的一个标准问题。我们将进行推导。\n\n选择系数$s$被定义为由突变$\\Delta$引起的马尔萨斯适应度的变化。马尔萨斯适应度函数由$m(\\mathbf{z}) = - \\frac{1}{2}\\|\\mathbf{z}\\|^{2}$给出。固有表型是$\\mathbf{z}$，突变表型是$\\mathbf{z} + \\Delta$。因此，选择系数为：\n$$\ns = m(\\mathbf{z} + \\Delta) - m(\\mathbf{z})\n$$\n代入适应度函数，我们得到：\n$$\ns = - \\frac{1}{2}\\|\\mathbf{z} + \\Delta\\|^{2} - \\left( - \\frac{1}{2}\\|\\mathbf{z}\\|^{2} \\right)\n$$\n我们展开平方范数项$\\|\\mathbf{z} + \\Delta\\|^{2} = (\\mathbf{z} + \\Delta) \\cdot (\\mathbf{z} + \\Delta) = \\|\\mathbf{z}\\|^{2} + 2(\\mathbf{z} \\cdot \\Delta) + \\|\\Delta\\|^{2}$。\n$$\ns = - \\frac{1}{2} \\left( \\|\\mathbf{z}\\|^{2} + 2(\\mathbf{z} \\cdot \\Delta) + \\|\\Delta\\|^{2} \\right) + \\frac{1}{2}\\|\\mathbf{z}\\|^{2}\n$$\n$$\ns = - \\frac{1}{2}\\|\\mathbf{z}\\|^{2} - (\\mathbf{z} \\cdot \\Delta) - \\frac{1}{2}\\|\\Delta\\|^{2} + \\frac{1}{2}\\|\\mathbf{z}\\|^{2}\n$$\n这可以简化为：\n$$\ns = -(\\mathbf{z} \\cdot \\Delta) - \\frac{1}{2}\\|\\Delta\\|^{2}\n$$\n问题陈述指出，突变步长的大小是固定的，$\\|\\Delta\\| = \\sqrt{\\mu_{2}}$，这意味着$\\|\\Delta\\|^{2} = \\mu_{2}$。固有表型距离最优点为$r$，因此$\\|\\mathbf{z}\\| = r$。$s$的表达式变为：\n$$\ns = -(\\mathbf{z} \\cdot \\Delta) - \\frac{1}{2}\\mu_{2}\n$$\n题目要求我们计算选择系数在突变方向的各向同性分布下的均值$\\mathbb{E}[s]$和方差$\\mathrm{Var}(s)$。在此计算中，向量$\\mathbf{z}$是固定的，而$\\Delta$是随机变量。\n\n首先，我们计算$s$的均值。根据期望算子的线性性质：\n$$\n\\mathbb{E}[s] = \\mathbb{E}\\left[-(\\mathbf{z} \\cdot \\Delta) - \\frac{1}{2}\\mu_{2}\\right] = -\\mathbb{E}[\\mathbf{z} \\cdot \\Delta] - \\mathbb{E}\\left[\\frac{1}{2}\\mu_{2}\\right]\n$$\n由于$\\mathbf{z}$是一个固定向量，我们可以写出$\\mathbb{E}[\\mathbf{z} \\cdot \\Delta] = \\mathbf{z} \\cdot \\mathbb{E}[\\Delta]$。突变步长$\\Delta$的大小固定为$\\sqrt{\\mu_{2}}$，其方向在$\\mathbb{R}^{n}$的单位球面上均匀分布。设$\\mathbf{u}$是一个在单位球面$S^{n-1}$上均匀分布的随机向量。那么$\\Delta = \\sqrt{\\mu_{2}} \\mathbf{u}$。$\\Delta$的期望为：\n$$\n\\mathbb{E}[\\Delta] = \\mathbb{E}[\\sqrt{\\mu_{2}}\\mathbf{u}] = \\sqrt{\\mu_{2}}\\mathbb{E}[\\mathbf{u}]\n$$\n由于球面上均匀分布的对称性，向量$\\mathbf{u}$的期望值是零向量，即$\\mathbb{E}[\\mathbf{u}] = \\mathbf{0}$。因此，$\\mathbb{E}[\\Delta] = \\mathbf{0}$。\n由此可得$\\mathbb{E}[\\mathbf{z} \\cdot \\Delta] = \\mathbf{z} \\cdot \\mathbf{0} = 0$。项$\\frac{1}{2}\\mu_{2}$是一个常数。因此，平均选择系数为：\n$$\n\\mathbb{E}[s] = -0 - \\frac{1}{2}\\mu_{2} = - \\frac{1}{2}\\mu_{2}\n$$\n接下来，我们计算$s$的方差。方差定义为$\\mathrm{Var}(s) = \\mathbb{E}[s^2] - (\\mathbb{E}[s])^2$。或者，我们使用性质：对于任意随机变量$X$和常数$a, b$，有$\\mathrm{Var}(aX+b) = a^2\\mathrm{Var}(X)$。\n$$\n\\mathrm{Var}(s) = \\mathrm{Var}\\left(-(\\mathbf{z} \\cdot \\Delta) - \\frac{1}{2}\\mu_{2}\\right) = \\mathrm{Var}(-(\\mathbf{z} \\cdot \\Delta)) = (-1)^{2} \\mathrm{Var}(\\mathbf{z} \\cdot \\Delta) = \\mathrm{Var}(\\mathbf{z} \\cdot \\Delta)\n$$\n随机变量$\\mathbf{z} \\cdot \\Delta$的方差由下式给出：\n$$\n\\mathrm{Var}(\\mathbf{z} \\cdot \\Delta) = \\mathbb{E}\\left[(\\mathbf{z} \\cdot \\Delta)^2\\right] - \\left(\\mathbb{E}[\\mathbf{z} \\cdot \\Delta]\\right)^2\n$$\n由于我们已经确定$\\mathbb{E}[\\mathbf{z} \\cdot \\Delta] = 0$，方差简化为二阶矩：\n$$\n\\mathrm{Var}(s) = \\mathbb{E}\\left[(\\mathbf{z} \\cdot \\Delta)^2\\right]\n$$\n为了计算这个期望，我们考虑二次型$(\\mathbf{z} \\cdot \\Delta)^2 = (\\mathbf{z}^T \\Delta)^2 = (\\mathbf{z}^T \\Delta)(\\Delta^T \\mathbf{z}) = \\mathbf{z}^T (\\Delta \\Delta^T) \\mathbf{z}$。\n取期望：\n$$\n\\mathbb{E}\\left[(\\mathbf{z} \\cdot \\Delta)^2\\right] = \\mathbb{E}\\left[\\mathbf{z}^T (\\Delta \\Delta^T) \\mathbf{z}\\right] = \\mathbf{z}^T \\mathbb{E}[\\Delta \\Delta^T] \\mathbf{z}\n$$\n矩阵$\\mathbb{E}[\\Delta \\Delta^T]$是向量$\\Delta$的二阶矩矩阵。由于$\\Delta$是各向同性的，该矩阵必须与单位矩阵$\\mathbf{I}$成正比，即$\\mathbb{E}[\\Delta \\Delta^T] = c\\mathbf{I}$，其中$c$为某个标量。我们可以通过取该矩阵的迹来确定$c$：\n$$\n\\mathrm{Tr}(\\mathbb{E}[\\Delta \\Delta^T]) = \\mathbb{E}[\\mathrm{Tr}(\\Delta \\Delta^T)]\n$$\n$\\Delta \\Delta^T$的迹是$\\mathrm{Tr}(\\Delta \\Delta^T) = \\Delta^T \\Delta = \\|\\Delta\\|^2 = \\mu_{2}$。\n因此，$\\mathbb{E}[\\mathrm{Tr}(\\Delta \\Delta^T)] = \\mathbb{E}[\\mu_{2}] = \\mu_{2}$，因为$\\mu_{2}$是一个常数。\n$c\\mathbf{I}$的迹是$\\mathrm{Tr}(c\\mathbf{I}) = nc$。\n将迹的两个表达式联立，得到$nc = \\mu_{2}$，这意味着$c = \\frac{\\mu_{2}}{n}$。\n因此，$\\mathbb{E}[\\Delta \\Delta^T] = \\frac{\\mu_{2}}{n} \\mathbf{I}$。\n将此代回方差的表达式中：\n$$\n\\mathrm{Var}(s) = \\mathbf{z}^T \\left(\\frac{\\mu_{2}}{n} \\mathbf{I}\\right) \\mathbf{z} = \\frac{\\mu_{2}}{n} (\\mathbf{z}^T \\mathbf{z}) = \\frac{\\mu_{2}}{n} \\|\\mathbf{z}\\|^2\n$$\n考虑到$\\|\\mathbf{z}\\| = r$，我们最终得到选择系数的方差：\n$$\n\\mathrm{Var}(s) = \\frac{\\mu_{2}r^2}{n}\n$$\n所以，$s$的均值和方差分别为$\\mathbb{E}[s] = -\\frac{1}{2}\\mu_{2}$和$\\mathrm{Var}(s) = \\frac{\\mu_{2}r^2}{n}$。最终结果以行矩阵的形式呈现。",
            "answer": "$$\\boxed{\\begin{pmatrix} -\\frac{\\mu_{2}}{2}  \\frac{r^{2}\\mu_{2}}{n} \\end{pmatrix}}$$"
        },
        {
            "introduction": "在了解了随机突变的统计特性之后，一个自然的问题是：哪种突变最能有效驱动适应过程？本练习将探讨最佳突变大小的概念，你将推导出一个平衡巨大收益潜力和有害风险的理想突变效应值。这个练习揭示了FGM中一个核心的权衡关系，并展示了如何通过优化来预测适应的动态。",
            "id": "2713211",
            "problem": "考虑Fisher的几何适应模型，其中生物体的表型由一个$n$维性状向量$\\mathbf{z} \\in \\mathbb{R}^{n}$表示，其单一表型最适点位于原点。假设马尔萨斯适应度（对数适应度）是二次的，$f(\\mathbf{z}) = -\\|\\mathbf{z}\\|^{2}/2$，因此具有表型效应$\\mathbf{m}$的突变的选择系数为$s = f(\\mathbf{z}+\\mathbf{m}) - f(\\mathbf{z})$。设当前表型距离最适点的距离为$r = \\|\\mathbf{z}\\|$，并考虑大小固定为$a = \\|\\mathbf{m}\\|$且方向在$(n-1)$维球面上均匀随机的突变。对于一个固定的$a$，将每个随机突变的预期适应度增益定义为$E[s \\mid a] P_{b}(a)$，其中$P_{b}(a)$是突变为有益的概率，$E[s \\mid a]$是在有益条件下的平均选择系数。\n\n1. 从上述定义和关于$(n-1)$维球面上均匀随机方向的基本事实出发，通过对$\\mathbf{m}$和$\\mathbf{z}$之间夹角的余弦进行积分，推导$E[s \\mid a] P_{b}(a)$关于$n$、$r$和$a$的积分表达式。仅使用以下事实：$s = -\\mathbf{z}\\!\\cdot\\!\\mathbf{m} - a^{2}/2$，$\\mathbf{z}\\!\\cdot\\!\\mathbf{m} = r a \\cos\\psi$（其中$\\psi$是$\\mathbf{z}$和$\\mathbf{m}$之间的夹角），以及对于$\\mathbb{R}^{n}$中均匀随机的方向，$u = \\cos\\psi$的边际密度在$[-1,1]$上正比于$(1-u^{2})^{(n-3)/2}$。不要假设$E[s \\mid a] P_{b}(a)$的任何目标公式。\n\n2. 从你的积分表达式中证明，$E[s \\mid a] P_{b}(a)$的最大化因子$a^{\\ast}$必须与$r$线性相关，即$a^{\\ast} = c_{n}\\, r$，其中系数$c_{n}$仅依赖于$n$。\n\n3. 特殊化到$n = 3$的情况。通过求解最大值的一阶条件，精确计算$a^{\\ast}$作为$r$的函数。将你的关于$a^{\\ast}$的最终结果以$r$的闭式表达式形式给出。不需要数值近似。没有物理单位。最终答案必须是单一的解析表达式。如果你选择检查任何中间数值，请将这些检查结果四舍五入到四位有效数字，但最终答案必须是精确的。\n\n在你的推导过程中，简要解释优化子对$r$的依赖性通常是如何产生的，以及为什么它是线性的。",
            "solution": "所述问题在科学上是合理的，在数学上是适定的。它在Fisher的几何适应模型（演化生物学中的一个基本概念）框架内，提供了一个标准的推导和分析。所有必要的定义和数学事实都已提供，问题没有矛盾或含糊之处。因此，我们开始解答。\n\n问题要求对Fisher几何模型中突变带来的预期适应度增益进行三部分分析。马尔萨斯适应度由$f(\\mathbf{z}) = -\\|\\mathbf{z}\\|^{2}/2$给出，其中$\\mathbf{z} \\in \\mathbb{R}^{n}$是表型，最适点在原点。一个表型效应为$\\mathbf{m}$的突变将表型从$\\mathbf{z}$变为$\\mathbf{z}+\\mathbf{m}$。这种突变的选择系数是：\n$$ s = f(\\mathbf{z}+\\mathbf{m}) - f(\\mathbf{z}) = -\\frac{1}{2}\\|\\mathbf{z}+\\mathbf{m}\\|^{2} - \\left(-\\frac{1}{2}\\|\\mathbf{z}\\|^{2}\\right) $$\n$$ s = -\\frac{1}{2}(\\mathbf{z}\\cdot\\mathbf{z} + 2\\mathbf{z}\\cdot\\mathbf{m} + \\mathbf{m}\\cdot\\mathbf{m}) + \\frac{1}{2}\\mathbf{z}\\cdot\\mathbf{z} = -\\mathbf{z}\\cdot\\mathbf{m} - \\frac{1}{2}\\|\\mathbf{m}\\|^{2} $$\n设$r = \\|\\mathbf{z}\\|$为当前表型与最适点之间的距离，$a = \\|\\mathbf{m}\\|$为突变的大小。设$\\psi$为向量$\\mathbf{z}$和$\\mathbf{m}$之间的夹角。点积可以写成$\\mathbf{z}\\cdot\\mathbf{m} = \\|\\mathbf{z}\\|\\|\\mathbf{m}\\|\\cos\\psi = ra\\cos\\psi$。那么选择系数是夹角$\\psi$的函数：\n$$ s(\\psi) = -ra\\cos\\psi - \\frac{a^{2}}{2} $$\n突变$\\mathbf{m}$的方向被假定在$(n-1)$维球面上均匀随机。这意味着$u = \\cos\\psi$有一个特定的概率分布。问题给出了$u$在区间$[-1, 1]$上的边际概率密度函数(PDF)：\n$$ p(u) = C_{n} (1-u^{2})^{(n-3)/2} $$\n其中$C_{n} = \\frac{\\Gamma(n/2)}{\\sqrt{\\pi}\\Gamma((n-1)/2)}$是归一化常数。\n\n我们感兴趣的量是预期适应度增益，定义为$E[s \\mid a] P_{b}(a)$。这是选择系数在其为正的条件下的期望值，乘以其为正的概率。这个乘积等价于$\\max(0, s)$的期望，我们将其记为$G(a, r, n)$。\n$$ G(a, r, n) = E[\\max(0, s)] = \\int_{-1}^{1} \\max(0, s(u)) p(u) du $$\n\n如果$s(u)  0$，则突变是有益的。使用$s$关于$u$的表达式：\n$$ -rau - \\frac{a^{2}}{2}  0 \\implies -rau  \\frac{a^{2}}{2} $$\n由于$r  0$且$a  0$，这个不等式简化为：\n$$ u  -\\frac{a}{2r} $$\n要有益突变成为可能，$u$的上界必须大于其定义域的下界，即$-a/(2r)  -1$，这意味着$a  2r$。如果$a \\geq 2r$，则没有突变可以是有益的，预期增益为0。\n\n**1. 积分表达式的推导**\n\n我们现在可以通过在突变有益的$u$的范围内对$s(u) p(u)$进行积分，来写出$G(a, r, n)$的表达式。\n$$ G(a, r, n) = \\int_{-1}^{-a/(2r)} s(u) p(u) du $$\n代入$s(u)$和$p(u)$的表达式：\n$$ G(a, r, n) = \\int_{-1}^{-a/(2r)} \\left(-rau - \\frac{a^{2}}{2}\\right) C_{n} (1-u^{2})^{(n-3)/2} du $$\n提出常数并代入$C_n$的表达式，我们得到所需的预期适应度增益的积分表达式：\n$$ G(a, r, n) = \\frac{\\Gamma(n/2)}{\\sqrt{\\pi}\\Gamma(\\frac{n-1}{2})} \\int_{-1}^{-a/(2r)} \\left(-rau - \\frac{a^{2}}{2}\\right) (1-u^{2})^{\\frac{n-3}{2}} du $$\n该积分对$0 \\le a  2r$有定义。对于$a \\ge 2r$，$G(a, r, n) = 0$。\n\n**2. 最优突变大小$a^{\\ast}$的缩放关系**\n\n为了找到使$G(a, r, n)$最大化的最优突变大小$a^{\\ast}$，我们必须分析$G$如何依赖于$a$和$r$。让我们引入一个无量纲变量$x = a/r$，它表示突变大小相对于与最适点距离的比值。我们可以通过代入$a = xr$来重写$G$的表达式：\n$$ G(xr, r, n) = C_{n} \\int_{-1}^{-(xr)/(2r)} \\left(-r(xr)u - \\frac{(xr)^{2}}{2}\\right) (1-u^{2})^{(n-3)/2} du $$\n$$ G(xr, r, n) = C_{n} r^{2} \\int_{-1}^{-x/2} \\left(-xu - \\frac{x^{2}}{2}\\right) (1-u^{2})^{(n-3)/2} du $$\n我们可以定义一个仅依赖于相对突变大小$x$和维度$n$的函数$H(x, n)$：\n$$ H(x, n) = C_{n} \\int_{-1}^{-x/2} \\left(-xu - \\frac{x^{2}}{2}\\right) (1-u^{2})^{(n-3)/2} du $$\n然后，预期增益可以表示为$G(a, r, n) = r^{2} H(a/r, n)$。\n\n为了找到最优突变大小$a^{\\ast}$，我们将$G$关于$a$的偏导数设为零：\n$$ \\frac{\\partial G}{\\partial a} = \\frac{\\partial}{\\partial a} \\left[ r^{2} H(a/r, n) \\right] = r^{2} \\cdot \\frac{d H(x, n)}{d x} \\cdot \\frac{\\partial x}{\\partial a} \\quad \\text{其中 } x = a/r $$\n由于$\\partial x/\\partial a = 1/r$，这变为：\n$$ \\frac{\\partial G}{\\partial a} = r^{2} \\cdot H'(x, n) \\cdot \\frac{1}{r} = r H'(a/r, n) $$\n对于$r  0$，条件$\\frac{\\partial G}{\\partial a} = 0$等价于$H'(a/r, n) = 0$。这个方程的解，我们称之为$x^{\\ast}$，将仅依赖于参数$n$，因为$H'$只是$x$和$n$的函数。\n$$ x^{\\ast} = c_{n} $$\n回代$x = a/r$，我们发现最优值$a^{\\ast}$满足：\n$$ \\frac{a^{\\ast}}{r} = c_{n} \\implies a^{\\ast} = c_{n} r $$\n这证明了最优突变大小$a^{\\ast}$与到最适点的距离$r$呈线性关系。这种线性关系的原因是二次适应度景观的自相似或尺度不变的几何特性。在距离$r$的点周围的适应度曲面形状，与在将所有空间维度按因子$\\lambda$缩放后，距离$\\lambda r$的点周围的形状是相同的。因此，只要突变大小按相同因子缩放，突变大小的优化问题在离最适点所有距离处在几何上都是相同的。这意味着最优的突变大小与距离之比$a^{\\ast}/r$必须是一个仅依赖于空间维度$n$而并非距离$r$本身的常数。\n\n**3. $n=3$时$a^{\\ast}$的计算**\n\n对于三维情况，$n=3$，$u$的概率密度函数中的指数变为$(3-3)/2 = 0$。\n概率密度函数简化为$p(u) = C_{3}(1-u^{2})^{0} = C_{3}$。为了找到常数，我们进行归一化：\n$$ \\int_{-1}^{1} C_{3} du = 2C_{3} = 1 \\implies C_{3} = \\frac{1}{2} $$\n因此对于$n=3$，夹角的余弦在$[-1, 1]$上均匀分布。预期增益是：\n$$ G(a, r, 3) = \\int_{-1}^{-a/(2r)} \\left(-rau - \\frac{a^{2}}{2}\\right) \\frac{1}{2} du $$\n这个积分是初等的：\n$$ G(a, r, 3) = \\frac{1}{2} \\left[ -ra\\frac{u^{2}}{2} - \\frac{a^{2}}{2}u \\right]_{-1}^{-a/(2r)} $$\n$$ G(a, r, 3) = \\frac{1}{4} \\left[ -rau^{2} - a^{2}u \\right]_{-1}^{-a/(2r)} $$\n在积分上下限处求值：\n$$ G(a, r, 3) = \\frac{1}{4} \\left( \\left[-ra\\left(-\\frac{a}{2r}\\right)^{2} - a^{2}\\left(-\\frac{a}{2r}\\right)\\right] - \\left[-ra(-1)^{2} - a^{2}(-1)\\right] \\right) $$\n$$ G(a, r, 3) = \\frac{1}{4} \\left( \\left[-ra\\frac{a^{2}}{4r^{2}} + \\frac{a^{3}}{2r}\\right] - \\left[-ra + a^{2}\\right] \\right) $$\n$$ G(a, r, 3) = \\frac{1}{4} \\left( -\\frac{a^{3}}{4r} + \\frac{2a^{3}}{4r} + ra - a^{2} \\right) = \\frac{1}{4} \\left( \\frac{a^{3}}{4r} - a^{2} + ra \\right) $$\n为了找到最优的$a$，我们对$a$求导并将结果设为零：\n$$ \\frac{\\partial G}{\\partial a} = \\frac{1}{4} \\left( \\frac{3a^{2}}{4r} - 2a + r \\right) = 0 $$\n$$ \\frac{3a^{2}}{4r} - 2a + r = 0 $$\n乘以$4r$得到一个关于$a$的二次方程：\n$$ 3a^{2} - 8ra + 4r^{2} = 0 $$\n使用二次公式，$a = \\frac{-b \\pm \\sqrt{b^{2}-4ac}}{2a_{q}}$（其中$a_{q}=3$，$b=-8r$，$c=4r^2$）：\n$$ a = \\frac{8r \\pm \\sqrt{(-8r)^{2} - 4(3)(4r^{2})}}{2(3)} = \\frac{8r \\pm \\sqrt{64r^{2} - 48r^{2}}}{6} $$\n$$ a = \\frac{8r \\pm \\sqrt{16r^{2}}}{6} = \\frac{8r \\pm 4r}{6} $$\n这会产生两个可能的$a^{\\ast}$解：\n$$ a_{1} = \\frac{8r + 4r}{6} = \\frac{12r}{6} = 2r $$\n$$ a_{2} = \\frac{8r - 4r}{6} = \\frac{4r}{6} = \\frac{2}{3}r $$\n为了确定哪个是最大值，我们检查二阶导数：\n$$ \\frac{\\partial^{2} G}{\\partial a^{2}} = \\frac{1}{4} \\left( \\frac{6a}{4r} - 2 \\right) = \\frac{1}{4} \\left( \\frac{3a}{2r} - 2 \\right) $$\n在$a_{1} = 2r$处，二阶导数为$\\frac{1}{4}(\\frac{3(2r)}{2r} - 2) = \\frac{1}{4}(3-2) = \\frac{1}{4}  0$，表明是一个局部最小值。\n在$a_{2} = \\frac{2}{3}r$处，二阶导数为$\\frac{1}{4}(\\frac{3(2r/3)}{2r} - 2) = \\frac{1}{4}(1-2) = -\\frac{1}{4}  0$，表明是一个局部最大值。\n$a$的有效定义域是$[0, 2r]$。我们发现$G(0,r,3)=0$且$G(2r,r,3)=0$。由于对于$a \\in (0, 2r)$有$G(a,r,3)  0$，在$a = \\frac{2}{3}r$处的局部最大值是该区间内的全局最大值。\n因此，对于$n=3$的情况，最优突变大小为$a^{\\ast} = \\frac{2}{3}r$。",
            "answer": "$$\\boxed{\\frac{2}{3}r}$$"
        },
        {
            "introduction": "理论模型的最终价值在于其与观测数据的联系。本练习将理论付诸实践，要求你编写一个程序，使用从FGM导出的理论DFE来反推模型的关键参数。通过这个计算实践，你将模拟演化生物学家的工作，从（模拟的）实验数据中推断生物体的复杂性（$n$）和其适应状态（$r$），从而将抽象模型转化为可检验的科学工具。",
            "id": "2713195",
            "problem": "您的任务是为 Fisher 适应性几何模型实现一个基于似然的推断过程，使用 Fisher 适应度效应几何分布作为生成模型。请从第一性原理出发，将表型建模为高维欧几里得空间中的一个点，将适应度建模为与最适点距离的一个平滑球对称函数，并假设突变步骤是各向同性的小效应。然后，推导新突变所诱导的适应度效应分布，并用它来计算观测到的适应度效应的似然。\n\n假设以下基本设置和定义：\n- 表型是一个 $n$ 维向量，最适点位于原点。驻留基因型的表型位移与最适点相距的欧几里得范数为 $r \\ge 0$。\n- 一次新突变会增加一个各向同性效应向量 $\\mathbf{X}$，其坐标是均值为 $0$、方差为 $1$ 的独立同分布高斯随机变量。因此，$\\mathbf{X} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{I}_n)$。\n- 适应度是与最适点平方距离的一个平滑球对称函数，其曲率是固定的，用以设定选择系数的尺度。使用小效应近似，通过 $s = - \\Delta$ 将新突变的选择系数 $s$ 与平方距离的变化量 $\\Delta$ 相关联，其中\n$$\n\\Delta = \\lVert \\mathbf{z} + \\mathbf{X} \\rVert^2 - \\lVert \\mathbf{z} \\rVert^2 = \\lVert \\mathbf{X} \\rVert^2 + 2 \\, r \\, X_1,\n$$\n此处通过旋转坐标系，使 $\\mathbf{z}$ 位于第一个坐标轴上，满足 $\\lVert \\mathbf{z} \\rVert = r$，且 $X_1$ 是 $\\mathbf{X}$ 的第一个坐标。\n- 定义非中心性参数 $\\delta = r^2$ 和随机变量\n$$\nT = \\sum_{i=1}^n (X_i + \\mu_i)^2,\n$$\n其中 $\\mu_1 = r$ 且对于 $i  1$ 有 $\\mu_i = 0$。那么，$T$ 服从自由度为 $n$、非中心性参数为 $\\delta$ 的非中心卡方分布，记作 $T \\sim \\chi^2_n(\\delta)$。我们有以下恒等式\n$$\n\\Delta = T - \\delta, \\quad \\text{so} \\quad s = - \\Delta = \\delta - T.\n$$\n- 因此，对于任何满足 $\\delta = r^2$ 的候选对 $(r, n)$，每个观测到的选择系数 $s$ 都决定了 $T = \\delta - s$。由于 $T$ 的支撑集为 $[0, \\infty)$，任何导致 $T  0$ 的观测值在该候选对下的似然为零。\n\n您的程序必须实现以下基于似然的推断任务：\n- 对于每个观测到的选择系数数据集 $\\{s_i\\}_{i=1}^m$，将数据视为来自通过 $s = \\delta - T$ 由非中心卡方分布 $T \\sim \\chi^2_n(\\delta)$ 所诱导的 Fisher 适应度效应几何分布的独立同分布抽样。\n- 候选对 $(r, n)$ 的似然函数是在各 $T_i = \\delta - s_i$ 处求值的非中心卡方密度的连乘积：\n$$\n\\mathcal{L}(r, n \\mid \\{s_i\\}) = \\prod_{i=1}^m f_{\\chi^2_n(\\delta)}(T_i), \\quad \\delta = r^2,\n$$\n并约定如果任何 $T_i  0$，则 $\\mathcal{L}(r, n \\mid \\{s_i\\}) = 0$。\n- 在下面定义的固定搜索网格上，计算最大似然对 $(\\hat{r}, \\hat{n})$。当多个配对在数值容差范围内达到相同的最大似然时，通过选择最小的 $\\hat{r}$，然后选择最小的 $\\hat{n}$ 来打破平局。\n\n使用以下固定的候选网格：\n- 维度网格: $n \\in \\{1, 2, 3, 4, 5, 6\\}$。\n- 距离网格: $r \\in \\{0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0\\}$。\n\n测试集：\n- Dataset A: $\\{s_i\\} = \\{-1.0, -3.0, -5.0\\}$。\n- Dataset B: $\\{s_i\\} = \\{3.8, -2.0, -6.0\\}$。\n- Dataset C: $\\{s_i\\} = \\{0.8, -2.0, -6.0\\}$。\n\n对于每个数据集，您的程序必须：\n- 对所有网格对评估对数似然 $\\log \\mathcal{L}(r, n \\mid \\{s_i\\})$，将任何零密度视为贡献负无穷大的对数似然，从而排除该对。\n- 使用指定的平局打破规则，返回最大化似然的对 $(\\hat{r}, \\hat{n})$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个数据集的结果表示为一个双元素列表 $[\\hat{r}, \\hat{n}]$。例如，总体输出必须具有 $[[\\hat{r}_A,\\hat{n}_A],[\\hat{r}_B,\\hat{n}_B],[\\hat{r}_C,\\hat{n}_C]]$ 的确切形式，不插入任何空格。",
            "solution": "我们从 Fisher 几何模型的核心几何与概率结构开始。表型是 $n$ 维欧几里得空间中的点，适应度随着与最适点平方距离的增加而平滑下降。设驻留基因型位于一个位移向量 $\\mathbf{z}$ 处，其欧几里得范数为 $r = \\lVert \\mathbf{z} \\rVert$。在假设每个性状轴上的效应是独立同分布的零均值高斯效应的前提下，一次新突变会增加一个各向同性的效应向量 $\\mathbf{X} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{I}_n)$。\n\n在小效应极限下，基于距离的适应度函数可以局部地用一个二次型来近似，其曲率设定了尺度。我们固定此曲率，使得选择系数 $s$ 等于平方距离变化的负值，即 $s = -\\Delta$。这是一种标准且方便的归一化方法，它使 $s$ 成为无量纲量，并且在不同的曲率参数化之间可以直接比较。\n\n旋转坐标系，使 $\\mathbf{z}$ 位于第一个坐标轴上，即 $\\mathbf{z} = (r, 0, \\ldots, 0)$，则增加 $\\mathbf{X}$ 后平方距离的变化为\n$$\n\\Delta = \\lVert \\mathbf{z} + \\mathbf{X} \\rVert^2 - \\lVert \\mathbf{z} \\rVert^2\n= (r + X_1)^2 + \\sum_{i=2}^n X_i^2 - r^2 = X_1^2 + 2 r X_1 + \\sum_{i=2}^n X_i^2.\n$$\n定义平移后的变量 $Y_1 = X_1 + r$ 和 $Y_i = X_i$（对于 $i \\ge 2$）。那么\n$$\nT \\equiv \\sum_{i=1}^n Y_i^2 = (X_1 + r)^2 + \\sum_{i=2}^n X_i^2.\n$$\n根据关于非零均值独立高斯随机变量平方和的标准结果，$T$ 服从自由度为 $n$、非中心性参数为 $\\delta = r^2$ 的非中心卡方分布，记作 $T \\sim \\chi^2_n(\\delta)$。此外，\n$$\n\\Delta = T - \\delta \\quad \\Longrightarrow \\quad s = -\\Delta = \\delta - T.\n$$\n因此，在以 $(r, n)$ 为条件下，选择系数 $s$ 是 $T$ 经过平移和符号翻转后的版本，其一一变换由 $T = \\delta - s$ 给出，雅可比行列式的大小为 $\\lvert \\mathrm{d}T / \\mathrm{d}s \\rvert = 1$。因为 $T$ 的支撑集为 $[0, \\infty)$，所以在 $(r, n)$ 条件下 $s$ 的支撑集为 $(-\\infty, \\delta]$，即 $s \\le r^2$。\n\n给定一个观测集 $\\{s_i\\}_{i=1}^m$，观测值之间的独立性意味着候选对 $(r, n)$ 的似然函数是在各 $T_i = \\delta - s_i$ 处求值的相应密度的连乘积：\n$$\n\\mathcal{L}(r, n \\mid \\{s_i\\}) = \\prod_{i=1}^m f_{\\chi^2_n(\\delta)}(T_i),\n$$\n并约定任何 $T_i  0$ 都会产生零似然。等价地，对数似然函数为\n$$\n\\log \\mathcal{L}(r, n \\mid \\{s_i\\}) = \\sum_{i=1}^m \\log f_{\\chi^2_n(\\delta)}(\\delta - s_i),\n$$\n并约定如果任何密度为零，则对数似然为负无穷大。从 $s$ 到 $T$ 的变换的雅可比行列式大小为 1，不对对数似然产生额外项。\n\n这就在参数 $(r, n)$ 和可观测的选择系数 $\\{s_i\\}$ 之间建立了一个显式的、基于似然的联系。为了进行推断，我们采用一个离散网格以保证计算上的易处理性和可识别性：\n- 距离网格是 $r \\in \\{0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0\\}$，意味着 $\\delta = r^2 \\in \\{0.0, 0.25, 1.0, 2.25, 4.0, 6.25, 9.0\\}$。\n- 维度网格是 $n \\in \\{1, 2, 3, 4, 5, 6\\}$。\n\n对于每个数据集，我们在此网格上计算对数似然，并选择最大化该值的配对 $(\\hat{r}, \\hat{n})$。因为连续密度可能导致数值上无法区分的最大值，我们施加一个确定性的平局打破规则：在对数似然值处于一个很小容差范围内的配对中，选择最小的 $\\hat{r}$；如果仍然平局，则选择最小的 $\\hat{n}$。\n\n边界情况和约束被自然地处理：\n- 对于一个候选的 $r$，如果任何观测值满足 $s_i  r^2$，那么 $T_i = \\delta - s_i  0$，该候选的似然值为零。\n- 任何有益观测值 $s_i  0$ 的存在会立即排除 $r = 0$，因为在 $r=0$ 时，支撑集为 $s \\le 0$。\n\n每个数据集的算法步骤：\n- 对于距离网格中的每个 $r$：\n  - 计算 $\\delta = r^2$。\n  - 将每个 $s_i$ 变换为 $T_i = \\delta - s_i$；如果任何 $T_i  0$，则指定对数似然为负无穷大并跳过。\n  - 否则，对于维度网格中的每个 $n$，将非中心卡方密度 $f_{\\chi^2_n(\\delta)}(T_i)$ 的对数对所有 $i$ 求和。\n- 选择最大化对数似然的 $(\\hat{r}, \\hat{n})$，并使用指定的规则打破平局。\n\n现在我们将此方法应用于指定的测试集：\n- 数据集 A：$\\{-1.0, -3.0, -5.0\\}$。所有条目均为非正数，因此 $r = 0$ 不会被支撑集排除，并且将具有竞争力；跨越不同 $n$ 值的形状将决定 $\\hat{n}$。\n- 数据集 B：$\\{3.8, -2.0, -6.0\\}$。由于 $s_{\\max} = 3.8$，所有满足 $r^2  3.8$ 的 $r$（即 $r \\in \\{0.0, 0.5, 1.0, 1.5\\}$）都会因支撑集而被排除；这将似然集中在较大的 $r$ 上，而 $n$ 由变换后的 $T$ 值处的密度形状决定。\n- 数据集 C：$\\{0.8, -2.0, -6.0\\}$。此处 $s_{\\max} = 0.8$ 仅排除了满足 $r^2  0.8$ 的 $r$，即 $r \\in \\{0.0, 0.5\\}$，同样将似然集中在允许的 $r$ 上。\n\n程序使用非中心卡方概率密度函数计算对数似然，并为每个数据集以指定的单行列表格式返回最大化似然的 $(\\hat{r}, \\hat{n})$。",
            "answer": "```python\n# Fisher's geometric model: likelihood-based inference of r and n from observed DFEs\n# Execution environment: Python 3.12, numpy 1.23.5, scipy 1.11.4\nimport numpy as np\nfrom scipy.stats import ncx2\n\ndef log_likelihood_for_dataset(s_vals, r, n, tol=1e-300):\n    \"\"\"\n    Compute the log-likelihood for one dataset under candidate (r, n).\n    Transformation: s = delta - T = T = delta - s, where delta = r^2.\n    If any T  0, the likelihood is zero (log-likelihood = -inf).\n    \"\"\"\n    delta = r * r\n    T = delta - np.array(s_vals, dtype=float)\n    if np.any(T  0):\n        return -np.inf\n    # Evaluate pdf; if any zero or negative due to underflow, treat as zero-likelihood\n    pdf_vals = ncx2.pdf(T, df=int(n), nc=delta)\n    if np.any(pdf_vals = 0.0) or np.any(~np.isfinite(pdf_vals)):\n        return -np.inf\n    return float(np.sum(np.log(pdf_vals)))\n\ndef infer_mle_pair(s_vals, r_grid, n_grid, tie_tol=1e-12):\n    \"\"\"\n    Grid search for MLE (r, n) maximizing the log-likelihood for the given dataset.\n    Tie-breaking: smallest r, then smallest n, when log-likelihoods are within tie_tol.\n    \"\"\"\n    best_ll = -np.inf\n    best_r = None\n    best_n = None\n    for r in r_grid:\n        delta = r * r\n        # Quick support check: if any s_i  delta then T_i  0, zero likelihood for this r (for all n)\n        if np.any(np.array(s_vals)  delta):\n            continue\n        for n in n_grid:\n            ll = log_likelihood_for_dataset(s_vals, r, n)\n            if ll  best_ll + tie_tol:\n                best_ll = ll\n                best_r = r\n                best_n = int(n)\n            elif abs(ll - best_ll) = tie_tol:\n                # Tie-break by smallest r, then smallest n\n                if best_r is None or r  best_r or (r == best_r and int(n)  best_n):\n                    best_r = r\n                    best_n = int(n)\n    # In degenerate case where all candidates have -inf (should not happen for provided datasets),\n    # fall back to smallest r, n.\n    if best_r is None:\n        best_r = float(r_grid[0])\n        best_n = int(n_grid[0])\n    return [float(best_r), int(best_n)]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Dataset A, B, C:\n    datasets = [\n        [-1.0, -3.0, -5.0],   # A\n        [3.8, -2.0, -6.0],    # B\n        [0.8, -2.0, -6.0],    # C\n    ]\n    # Candidate grids\n    r_grid = np.array([0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0], dtype=float)\n    n_grid = np.array([1, 2, 3, 4, 5, 6], dtype=int)\n\n    results = []\n    for s_vals in datasets:\n        mle_pair = infer_mle_pair(s_vals, r_grid, n_grid)\n        results.append(mle_pair)\n    \n    # Format according to the specific request in the problem statement\n    # [[r_A,n_A],[r_B,n_B],[r_C,n_C]] with one decimal for r and no spaces.\n    out_fixed = \"[\" + \",\".join([f\"[{r:.1f},{n}]\" for r, n in results]) + \"]\"\n    print(out_fixed)\n\n# The following code block is for direct execution to generate the output.\n# According to the problem spec, the final XML answer should contain the Python code.\n# The code itself, when run, will produce the result: [[2.0,2],[2.0,1],[1.0,4]]\n# I will put the provided python code inside the answer tag as it seems to be the expected format.\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}