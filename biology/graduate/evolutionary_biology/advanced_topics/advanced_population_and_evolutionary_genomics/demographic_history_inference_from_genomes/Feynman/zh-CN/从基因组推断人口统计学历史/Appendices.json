{
    "hands_on_practices": [
        {
            "introduction": "本练习从群体遗传学的基本原理出发，旨在阐明一个核心挑战：如何从遗传多样性数据中推断有效的种群数量。首先，我们将推导在稳定种群大小这一理想化假设下，核苷酸多样性 ($\\pi$) 与有效种群数量 ($N_e$) 之间的经典关系。然后，我们将通过一个双阶段（two-epoch）非平衡模型，从数学上揭示为何这种简单的关系在种群历史发生动态变化时会失效，从而强调开发更复杂推断方法（如 PSMC 和贝叶斯天际线图）的必要性。",
            "id": "2700391",
            "problem": "一个二倍体的随机交配群体，在一个常染色体位点上进行中性演化，遵循无限位点突变模型，每个位点每代的突变率为 $\\mu$。假设以 Wright–Fisher 模型为基本基础，对大群体规模采用溯祖近似，并通过全基因组取样，从而能够很好地估计 $\\pi$（核苷酸多样性）。\n\n从溯祖理论的第一性原理出发：\n- 对于一个恒定大小的群体，两个谱系的最近共同祖先的期望时间为 $E[T_{2}] = 2N_{e}$ 代。\n- 在无限位点模型下，每个位点的两两差异期望数等于 $2\\mu E[T_{2}]$。\n\n1) 利用这些原理，推导在群体动态平衡状态下，常染色体的 $\\pi$、$N_{e}$ 和 $\\mu$ 之间的标准关系式。然后，使用测量值 $\\pi = 2.7 \\times 10^{-3}$ 和 $\\mu = 1.5 \\times 10^{-8}$，在平衡假设下计算 $N_{e}$ 的点估计值。\n\n2) 接下来，考虑一个非平衡、两阶段的群体历史，其中群体大小从现在到过去 $\\tau$ 代为 $N_{1}$，在 $\\tau$ 之前为 $N_{2}$。使用两个谱系溯祖时间的溯祖风险率 $\\lambda(t) = \\frac{1}{2N_{e}(t)}$ 和生存函数 $S(t) = \\exp\\!\\left(-\\int_{0}^{t}\\lambda(s)\\,ds\\right)$，推导一个用 $\\mu$、$N_{1}$、$N_{2}$ 和 $\\tau$ 表示 $\\pi$ 的表达式。使用这个表达式，分析解释为什么基于平衡假设从 $\\pi$ 到 $N_{e}$ 的映射在非平衡群体动态下会失效，并将你的解释与贝叶斯天际线图 (Bayesian Skyline Plot) 和两两序列马尔可夫溯祖模型 (Pairwise Sequentially Markovian Coalescent, PSMC) 试图推断 $N_{e}(t)$ 的目标联系起来。\n\n将第 (1) 部分的数值答案报告为二倍体个体数量，四舍五入到四位有效数字。最终答案中不要包含单位。",
            "solution": "此问题将按要求分两部分解答。首先，必须对问题陈述进行严格验证。\n\n**问题验证**\n\n步骤 1：提取已知条件。\n-   模型：二倍体、随机交配群体。\n-   演化动态：中性演化的常染色体位点。\n-   突变模型：无限位点模型，每个位点每代的突变率为 $\\mu$。\n-   群体模型：Wright–Fisher 模型，对大群体规模采用溯祖近似。\n-   数据：核苷酸多样性 $\\pi$ 通过全基因组取样得到很好的估计。\n-   针对恒定群体大小的既定原理：两个谱系的最近共同祖先的期望时间为 $E[T_{2}] = 2N_{e}$ 代。\n-   针对突变累积的既定原理：每个位点的两两差异期望数 $\\pi$ 等于 $2\\mu E[T_{2}]$。\n-   第 1 部分数值：$\\pi = 2.7 \\times 10^{-3}$ 和 $\\mu = 1.5 \\times 10^{-8}$。\n-   第 2 部分群体动态模型：一个两阶段历史，群体大小从现在到 $\\tau$ 代前为 $N_{1}$，在 $\\tau$ 之前为 $N_{2}$。\n-   第 2 部分数学工具：溯祖风险率 $\\lambda(t) = \\frac{1}{2N_{e}(t)}$ 和生存函数 $S(t) = \\exp\\!\\left(-\\int_{0}^{t}\\lambda(s)\\,ds\\right)$。\n\n步骤 2：使用提取的已知条件进行验证。\n-   问题具有**科学基础**。所有模型（Wright-Fisher、无限位点、溯祖过程）和原理在该领域都是基础且公认的。所提供的 $\\pi$ 和 $\\mu$ 值在生物学上是合理的。\n-   问题是**适定的**。它提供了足够的信息来推导所需的表达式并计算数值答案。问题明确无歧义。\n-   问题是**客观的**。语言技术性强且精确，没有主观或不科学的论断。\n-   问题与指定主题——*从基因组推断群体历史*以及提到的方法（贝叶斯天际线图，PSMC）直接且精确相关。\n-   问题既不浅显也非故作高深；它考验了对概要统计量如何与潜在的群体动态过程相关联，以及为什么在非平衡情景下需要更复杂方法的根本性理解。\n\n步骤 3：结论与行动。\n问题陈述有效。将提供解答。\n\n**解答**\n\n**第 1 部分：平衡群体动态**\n核苷酸多样性 $\\pi$ 定义为从群体中随机抽取的两个序列之间每个位点的平均成对差异数。问题陈述中给出，该量由以下表达式给出：\n$$ \\pi = 2\\mu E[T_{2}] $$\n其中 $\\mu$ 是每个位点每代的突变率，而 $E[T_{2}]$ 是一对谱系的最近共同祖先（TMRCA）的期望时间。\n\n在群体动态平衡、大小恒定的二倍体群体假设下，期望 TMRCA 如下给出：\n$$ E[T_{2}] = 2N_{e} $$\n其中 $N_{e}$ 是有效群体大小。\n\n将此 $E[T_{2}]$ 的表达式代入 $\\pi$ 的方程，得到二倍体常染色体位点的标准关系式：\n$$ \\pi = 2\\mu (2N_{e}) = 4N_{e}\\mu $$\n这个方程将可观测的遗传多样性（$\\pi$）与有效群体大小（$N_{e}$）和突变率（$\\mu$）这两个基本的演化参数联系起来。\n\n为了计算 $N_{e}$ 的点估计值，我们重排此公式：\n$$ N_{e} = \\frac{\\pi}{4\\mu} $$\n使用给定的值 $\\pi = 2.7 \\times 10^{-3}$ 和 $\\mu = 1.5 \\times 10^{-8}$：\n$$ N_{e} = \\frac{2.7 \\times 10^{-3}}{4 \\times (1.5 \\times 10^{-8})} = \\frac{2.7 \\times 10^{-3}}{6.0 \\times 10^{-8}} = 0.45 \\times 10^{5} = 45000 $$\n二倍体个体数量为 $45000$。四舍五入到四位有效数字得到 $4.500 \\times 10^{4}$。\n\n**第 2 部分：非平衡群体动态**\n对于一个大小随时间变化的群体 $N_{e}(t)$，简单的关系式 $E[T_{2}] = 2N_{e}$ 不再成立。我们必须使用为溯祖时间 $T_{2}$ 提供的生存函数，从第一性原理计算 $E[T_{2}]$。一个非负随机变量的期望值是其生存函数的积分：\n$$ E[T_{2}] = \\int_{0}^{\\infty} S(t) \\,dt = \\int_{0}^{\\infty} P(T_2 > t) \\,dt $$\n其中生存函数为 $S(t) = \\exp\\!\\left(-\\int_{0}^{t}\\lambda(s)\\,ds\\right)$，溯祖风险率为 $\\lambda(s) = \\frac{1}{2N_{e}(s)}$。\n\n指定的两阶段群体动态模型具有分段恒定的群体大小：\n$$ N_{e}(t) = \\begin{cases} N_{1} & \\text{if } 0 \\le t < \\tau \\\\ N_{2} & \\text{if } t \\ge \\tau \\end{cases} $$\n$E[T_{2}]$ 的积分必须在时间点 $\\tau$ 处分开：\n$$ E[T_{2}] = \\int_{0}^{\\tau} S(t) \\,dt + \\int_{\\tau}^{\\infty} S(t) \\,dt $$\n对于第一个区间 $0 \\le t < \\tau$，溯祖率是恒定的，$\\lambda(s) = \\frac{1}{2N_{1}}$。生存函数为 $S(t) = \\exp\\!\\left(-\\int_{0}^{t}\\frac{1}{2N_{1}}\\,ds\\right) = \\exp\\!\\left(-\\frac{t}{2N_{1}}\\right)$。第一个积分是：\n$$ \\int_{0}^{\\tau} \\exp\\!\\left(-\\frac{t}{2N_{1}}\\right) \\,dt = \\left[-2N_{1}\\exp\\!\\left(-\\frac{t}{2N_{1}}\\right)\\right]_{0}^{\\tau} = -2N_{1}\\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right) - (-2N_{1}) = 2N_{1}\\left(1 - \\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right)\\right) $$\n对于第二个区间 $t \\ge \\tau$，我们首先计算累积风险 $\\int_{0}^{t}\\lambda(s)\\,ds$：\n$$ \\int_{0}^{t}\\lambda(s)\\,ds = \\int_{0}^{\\tau}\\frac{1}{2N_{1}}\\,ds + \\int_{\\tau}^{t}\\frac{1}{2N_{2}}\\,ds = \\frac{\\tau}{2N_{1}} + \\frac{t-\\tau}{2N_{2}} $$\n当 $t \\ge \\tau$ 时，生存函数为 $S(t) = \\exp\\!\\left(-\\left(\\frac{\\tau}{2N_{1}} + \\frac{t-\\tau}{2N_{2}}\\right)\\right)$。第二个积分是：\n$$ \\int_{\\tau}^{\\infty} \\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right) \\exp\\!\\left(-\\frac{t-\\tau}{2N_{2}}\\right) \\,dt $$\n我们可以将常数项 $\\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right)$ 提取出来，并进行变量替换 $u = t - \\tau$, $du = dt$：\n$$ \\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right) \\int_{0}^{\\infty} \\exp\\!\\left(-\\frac{u}{2N_{2}}\\right) \\,du = \\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right) \\left[ -2N_{2}\\exp\\!\\left(-\\frac{u}{2N_{2}}\\right) \\right]_{0}^{\\infty} = 2N_{2}\\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right) $$\n将两部分结合起来，得到总的期望 TMRCA：\n$$ E[T_{2}] = 2N_{1}\\left(1 - \\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right)\\right) + 2N_{2}\\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right) $$\n最后，核苷酸多样性 $\\pi$ 的表达式为 $2\\mu E[T_{2}]$：\n$$ \\pi = 4\\mu \\left( N_{1}\\left(1 - \\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right)\\right) + N_{2}\\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right) \\right) $$\n\n这个结果解释了为什么基于平衡的映射会失败。如果测量一个单一的 $\\pi$ 值，并使用 $N_{e, inferred} = \\frac{\\pi}{4\\mu}$ 来简单地计算有效群体大小，结果是：\n$$ N_{e, inferred} = N_{1}\\left(1 - \\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right)\\right) + N_{2}\\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right) $$\n这个推断出的大小既不等于当前的大小 $N_{1}$，也不等于祖先大小 $N_{2}$（除非 $N_{1} = N_{2}$）。相反，它是抽样谱系历史上群体大小的加权平均值，其中权重与每个阶段发生溯祖的概率有关。单一的概要统计量 $\\pi$，即溯祖时间分布的均值，没有足够的信息来解开 $N_{1}$、$N_{2}$ 和 $\\tau$ 这三个参数。它将群体大小的时间变化平均化了。\n\n诸如贝叶斯天际线图 (Bayesian Skyline Plot, BSP) 和两两序列马尔可夫溯祖模型 (Pairwise Sequentially Markovian Coalescent, PSMC) 等方法是专门为解决这个问题而设计的。它们不依赖于像 $\\pi$ 这样的单一概要统计量，而是利用基因组上遗传变异模式所反映的溯祖时间的完整分布。例如，PSMC 将单个二倍体基因组中杂合与纯合区块的序列建模为一个隐马尔可夫模型，其中隐藏状态是不同基因组片段的溯祖时间。通过估计这些时间的分布，PSMC 推断出随时间变化的溯祖率 $\\lambda(t) = \\frac{1}{2N_{e}(t)}$，从而将有效群体大小 $N_{e}(t)$ 的历史轨迹重构为一个分段常数函数。BSP 使用贝叶斯 MCMC 来抽样与遗传数据兼容的谱系树，从中导出 $N_{e}(t)$ 的后验分布。从本质上讲，这些方法剖析基因组中包含的信息，以估计不同历史时期的群体大小，而不是将其全部压缩成一个信息量不足的单一平均值。",
            "answer": "$$\\boxed{4.500 \\times 10^{4}}$$"
        },
        {
            "introduction": "在利用 PSMC 等方法从单个基因组推断出动态的人口历史后，一个关键的后续步骤是量化该推断的不确定性。区块自助法（block bootstrap）是实现这一目标的标准技术，但其有效性取决于对区块大小、重组率和局部最近共同祖先时间（TMRCA）之间相互作用的深刻理解。本练习旨在通过基本原理的推理，帮助您掌握如何正确设计自助法分析方案，以确保生成的伪样本（pseudo-replicates）既能保留基因组内部的连锁信息，又能作为近似独立的单元，从而获得可靠的置信区间。",
            "id": "2700366",
            "problem": "您计划使用成对顺序马尔可夫溯祖模型 (Pairwise Sequentially Markovian Coalescent, PSMC) 从单个二倍体基因组中推断过去的有效种群大小。为了量化推断轨迹中的不确定性，您考虑对基因组进行区块自助法 (block bootstrap)。假设存在以下源自包含重组的溯祖理论的基本事实：沿着每个谱系，重组断裂点在基因组上以每碱基每代为 $r$ 的速率发生，这是一个泊松过程；在某个基因组位置，所采样单倍型对的最近共同祖先时间 (TMRCA) 为 $T$ 代；沿着 $2$ 条长度各为 $T$ 代的独立祖先谱系，重组的总机会与总分支长度 $2T$ 成正比。仅使用这些基本原理，推断由重组引起的基因组上的依赖结构，以及应如何设计区块自助法，以在保留区块内依赖性的同时，使不同的重抽样区块作为单元近似独立。\n\n哪些陈述正确地定义了用于 PSMC 的区块自助法，并正确地描述了自助法区块大小应如何与重组和局部 TMRCA 片段长度相关联，以产生近似独立的自助法重抽样副本？\n\n- A. 在 PSMC 区块自助法中，我们在整个基因组中有放回地重抽样单个分离位点，忽略它们的位置，以创建伪副本。当区块大小等于平均重组间距离 $1/r$ 时，可实现重抽样样本的近似独立性。\n\n- B. 在 PSMC 区块自助法中，我们将基因组划分为连续的窗口，并有放回地重抽样这些窗口以形成伪基因组，从而保留区块内的连锁和 TMRCA 自相关性。为了实现重抽样区块间的近似独立性，区块长度 $L_B$ 的选择应远大于共享相同局部 TMRCA 的片段的典型长度，该长度与重组率和分支长度均成反比；具体而言，对于感兴趣的 $T$ 值范围，$L_B \\gg 1/(2 r T)$，例如 $L_B \\gg \\max_{T \\in \\mathcal{T}} \\{ 1/(2 r T) \\}$。\n\n- C. 一种实用的 PSMC 自助法是从每个位点的拟合分布中独立地重抽样其隐状态后验概率；因为这些是后验概率，所以无论重组率或 TMRCA 片段长度如何，独立性都成立，因此区块大小无关紧要。\n\n- D. 为了近似 PSMC 的独立同分布观测值，应最小化区块大小，使得 $L_B \\ll 1/(2 r T)$；较小的区块更独立，因为重组会迅速解耦邻近位点，从而减少连锁引起的依赖性。\n\n- E. 对于重组率 $r$ 较低的物种，需要更长的区块来捕获区块内的依赖性并使区块成为近似独立的单元；因此，自助法区块大小应大致与 $1/r$ 成比例增加（在其他所有条件，包括相关的 $T$ 值范围，都相同的情况下）。",
            "solution": "问题陈述具有科学依据、提法严谨且客观。它提供了溯祖理论中必要的公理，从而可以进行严格的推导。因此，我将开始推导过程。\n\n成对顺序马尔可夫溯祖 (PSMC) 模型通过单个二倍体基因组上最近共同祖先时间 (TMRCA) 的分布来推断有效种群大小历史 $N_e(t)$。沿着两条单倍体染色体的 TMRCA 序列是相关的。这种自相关性是 PSMC 提取信息的信号。TMRCA 保持恒定或高度相关的物理距离，由两个谱系祖先中的重组事件决定。\n\n问题提供了量化此相关长度所需的基本原理。\n$1$. 沿着每个谱系，重组以每碱基每代为 $r$ 的速率发生，这是一个泊松过程。\n$2$. 对于一对谱系，有两条追溯时间的祖先路径。因此，在某个基因组片段上发生重组事件并可能改变这对谱系的局部树拓扑结构的总速率与 $2r$ 成正比。\n$3$. 此类重组事件可能发生的总时间是局部 TMRCA，即 $T$ 代。两个采样序列的祖先历史中的总分支长度是 $2T$。\n\n因此，破坏两个谱系间共享祖先关系的重组事件速率，与每碱基速率 ($2r$) 和时间长度 ($T$) 的乘积成正比。这种“祖先重组”事件在基因组上的发生率为每碱基 $\\lambda = 2rT$。这些事件定义了 TMRCA 发生变化的点。由于重组是一个泊松过程，连续祖先重组事件之间的距离呈指数分布，其均值为 $1/\\lambda = 1/(2rT)$。这个距离 $1/(2rT)$ 代表了基因组上 TMRCA 自相关的特征长度尺度。比此长度短的片段极有可能共享相同的 TMRCA，而远长于此长度的片段则可能具有不同的 TMRCA，可以被认为是近似独立的。\n\n区块自助法是一种用于评估依赖性数据（如基因组序列）分析中不确定性的统计方法。其过程包括：\n$1$. 将完整序列划分为长度为 $L_B$ 的连续、不重叠的区块。\n$2$. 有放回地重抽样这些区块，以创建一个与原始基因组总长度相同的新伪基因组。\n$3$. 对每个伪基因组运行 PSMC 分析，以构建推断出的人口历史分布。\n\n为使此过程有效，必须满足关于区块大小 $L_B$ 的两个条件：\na) 区块必须足够大，以保留数据内部的基本依赖结构。在此背景下，它们必须足够长，以包含关于 TMRCA 变化的有效信息。\nb) 区块本身必须是近似独立的单元。当区块长度 $L_B$ 远大于数据的自相关长度时，即可实现此目标。\n\n根据我们的推导，自相关长度为 $\\approx 1/(2rT)$。因此，一个有效的区块自助法要求选择的区块大小 $L_B$ 满足 $L_B \\gg 1/(2rT)$，其中 $T$ 是与推断相关的 TMRCA 值范围。对于较小的 $T$ 值，TMRCA 的自相关性最长（即相关性延伸到更长的物理距离）。为了确保相邻区块去相关，$L_B$ 必须远大于最长的相关长度尺度，这对应于最小的相关 $T$ 值。\n\n基于此基础，我现在将评估每个陈述。\n\n- **A. 在 PSMC 区块自助法中，我们在整个基因组中有放回地重抽样单个分离位点，忽略它们的位置，以创建伪副本。当区块大小等于平均重组间距离 $1/r$ 时，可实现重抽样样本的近似独立性。**\n该陈述存在根本性错误。重抽样单个分离位点并忽略其位置不是区块自助法；这是一种简单的基于位点的自助法，它完全破坏了连锁信息和杂合性的空间排列，而这正是 PSMC 所利用的信号。第二部分也是错误的。TMRCA 相关性的特征长度尺度不是 $1/r$，而是 $1/(2rT)$。此外，将区块大小设置得*等于*相关长度并不能确保区块间的独立性；区块大小必须大一个数量级。\n**结论：错误。**\n\n- **B. 在 PSMC 区块自助法中，我们将基因组划分为连续的窗口，并有放回地重抽样这些窗口以形成伪基因组，从而保留区块内的连锁和 TMRCA 自相关性。为了实现重抽样区块间的近似独立性，区块长度 $L_B$ 的选择应远大于共享相同局部 TMRCA 的片段的典型长度，该长度与重组率和分支长度均成反比；具体而言，对于感兴趣的 $T$ 值范围，$L_B \\gg 1/(2 r T)$，例如 $L_B \\gg \\max_{T \\in \\mathcal{T}} \\{ 1/(2 r T) \\}$。**\n该陈述是对 PSMC 区块自助法方法的精确和正确描述。它正确地指出了重抽样连续区块以保留区块内依赖性的过程。它正确地指出，为实现区块间的独立性，区块长度 $L_B$ 必须远大于 TMRCA 自相关长度。关键是，它正确地将此长度尺度确定为与 $1/(2rT)$ 成正比。示例条件 $L_B \\gg \\max_{T \\in \\mathcal{T}} \\{ 1/(2 r T) \\}$ 在逻辑上也是合理的，因为它通过要求区块大小远大于最长的预期相关长度（发生在集合 $\\mathcal{T}$ 中的最小 $T$ 值处）来确保区块的独立性。\n**结论：正确。**\n\n- **C. 一种实用的 PSMC 自助法是从每个位点的拟合分布中独立地重抽样其隐状态后验概率；因为这些是后验概率，所以无论重组率或 TMRCA 片段长度如何，独立性都成立，因此区块大小无关紧要。**\n该陈述是错误的。虽然从后验分布中重抽样是一种有效的参数或半参数自助法形式，但其关键错误在于独立性的假设。相邻位点的隐 TMRCA 状态的后验概率*并非*独立的；由于遗传连锁，它们高度相关，并且这种相关性由 PSMC 的隐马尔可夫模型结构明确建模。通过独立重抽样位点来忽略这种相关性将导致无效的不确定性估计。因此，区块大小无关紧要的断言是错误的。\n**结论：错误。**\n\n- **D. 为了近似 PSMC 的独立同分布观测值，应最小化区块大小，使得 $L_B \\ll 1/(2 r T)$；较小的区块更独立，因为重组会迅速解耦邻近位点，从而减少连锁引起的依赖性。**\n该陈述的逻辑是颠倒的。区块自助法的目标不是使区块内的观测值独立同分布 (i.i.d.)，而是使区块本身成为可重抽样的近似独立同分布单元。这要求区块大小远*大于*相关长度，而不是小于。区块大小 $L_B \\ll 1/(2rT)$ 意味着区块比 TMRCA 相关的距离短得多。重抽样这样的区块会破坏 PSMC 所分析的依赖结构，并导致对变异的低估。\n**结论：错误。**\n\n- **E. 对于重组率 $r$ 较低的物种，需要更长的区块来捕获区块内的依赖性并使区块成为近似独立的单元；因此，自助法区块大小应大致与 $1/r$ 成比例增加（在其他所有条件，包括相关的 $T$ 值范围，都相同的情况下）。**\n该陈述是上述原理的正确推论。相关长度是 $1/(2rT)$。此长度与重组率 $r$ 成反比。如果 $r$ 较低，则相关长度增加。为了维持区块大小 $L_B$ 必须远大于相关长度的条件（即 $L_B \\gg 1/(2rT)$），$L_B$ 必须相应地增大。关于所需区块大小与 $1/r$ 成比例增加的陈述是这一关系的直接且正确的结论。\n**结论：正确。**",
            "answer": "$$\\boxed{BE}$$"
        },
        {
            "introduction": "继上一练习对区块自助法（block bootstrap）的概念性探讨之后，本练习将带您进入实际操作层面，处理自助法分析产生的输出数据。通过一个编程实践，您将学习如何从一系列有效种群数量的自助法复制（bootstrap replicates）中计算样本方差，并构建置信区间。此练习特别强调了对数变换的应用，这是一种在群体遗传学中处理不确定性的标准做法，因为它能恰当地处理种群规模估计中固有的乘性误差，从而将理论知识转化为可靠的统计结果。",
            "id": "2700401",
            "problem": "给定您由群体统计推断方法（如贝叶斯天空图（BSP）或成对顺序马尔可夫溯祖（PSMC））生成的，某个时间区间内的有效种群大小的自助法重复估计值。在基于溯祖理论的推断中，有效种群大小表示为 $N_e$，通过自助法重抽样产生的重复样本 $\\{\\hat N_e^{(r)}\\}_{r=1}^R$ 可近似于在固定时间区间内估计量的抽样分布。您将为每个时间区间实现以下两项任务，这些任务基于基本的统计学定义，并由种群大小估计量中的乘性不确定性证明其合理性：\n\n- 使用自助法重复样本，根据方差的标准定义，计算原始尺度上的无偏样本方差。\n- 在对数尺度上构建名义覆盖率为 $0.95$ 的双边置信带以捕捉乘性不确定性，然后将该置信带映射回原始尺度。\n\n基本原理：\n- 自助法重复样本通过在相同的数据生成过程下进行有放回的重抽样，来近似估计量的抽样分布。\n- 对于单变量样本 $\\{x_r\\}_{r=1}^R$ 的无偏样本方差为 $s^2=\\frac{1}{R-1}\\sum_{r=1}^R (x_r-\\bar x)^2$，其中 $\\bar x=\\frac{1}{R}\\sum_{r=1}^R x_r$ 且 $R\\ge 2$。\n- 对于乘性噪声 $X=\\theta\\cdot\\eta$，对数变换 $Y=\\log X$ 将乘性偏差转换为加性偏差；如果 $Y$ 近似服从正态分布，则对数尺度上一个近似的双边 $(1-\\alpha)$ 置信带为 $\\bar Y \\pm z_{1-\\alpha/2}\\, s_Y$，其中 $\\bar Y$ 和 $s_Y$ 是 $\\{Y_r\\}_{r=1}^R$ 的样本均值和样本标准差，而 $z_{q}$ 是标准正态分布的 $q$-分位数。映射回原始尺度得到 $\\left[\\exp(\\bar Y - z_{1-\\alpha/2}\\, s_Y),\\, \\exp(\\bar Y + z_{1-\\alpha/2}\\, s_Y)\\right]$。\n\n形式上，对于每个具有严格为正的自助法重复样本 $\\{\\hat N_e^{(r)}\\}_{r=1}^R$ 的时间区间：\n- 计算原始尺度上的无偏样本方差，\n$$\ns_{\\text{orig}}^2 \\;=\\; \\frac{1}{R-1}\\sum_{r=1}^R \\left(\\hat N_e^{(r)} - \\bar N_e\\right)^2,\\quad\n\\bar N_e \\;=\\; \\frac{1}{R}\\sum_{r=1}^R \\hat N_e^{(r)}.\n$$\n- 定义 $Y_r=\\log \\hat N_e^{(r)}$ 对于 $r=1,\\dots,R$，并计算\n$$\n\\bar Y \\;=\\; \\frac{1}{R}\\sum_{r=1}^R Y_r,\\qquad\ns_Y \\;=\\; \\sqrt{\\frac{1}{R-1}\\sum_{r=1}^R \\left(Y_r-\\bar Y\\right)^2}.\n$$\n当 $\\alpha=0.05$ 时，令 $z_{1-\\alpha/2}$ 表示在 $1-\\alpha/2=0.975$ 处的标准正态分位数。映射回原始尺度的对数置信带为\n$$\n\\left[L, U\\right] \\;=\\; \\left[\\exp\\!\\left(\\bar Y - z_{0.975}\\, s_Y\\right),\\ \\exp\\!\\left(\\bar Y + z_{0.975}\\, s_Y\\right)\\right].\n$$\n\n您的程序必须为以下测试用例集中的每个时间区间实现这些计算，每个时间区间表示为严格为正的实数列表 $\\{\\hat N_e^{(r)}\\}_{r=1}^R$：\n- 情况 1（典型的中等变异性）：$[10000.0,\\, 12000.0,\\, 11000.0,\\, 10500.0,\\, 11500.0]$。\n- 情况 2（相同的重复样本；零方差的边界情况）：$[5000.0,\\, 5000.0,\\, 5000.0,\\, 5000.0]$。\n- 情况 3（最小重复样本数 $R=2$；大跨度）：$[10000.0,\\, 40000.0]$。\n- 情况 4（强烈的乘性离散）：$[10000.0,\\, 20000.0,\\, 40000.0,\\, 80000.0,\\, 160000.0]$。\n\n要求：\n- 对于每种情况，使用自然对数计算上述定义的 $s_{\\text{orig}}^2$, $L$ 和 $U$。\n- 使用除数为 $R-1$ 的无偏方差和标准差。\n- 对置信带使用标准正态分位数 $z_{0.975}$。\n- 将报告的每个数字四舍五入到 $6$ 位小数。\n- 最终输出格式：您的程序应生成单行内容，其中包含一个用方括号括起来的、以逗号分隔的结果列表，每个测试用例对应一个结果。每个结果本身必须是按 $[s_{\\text{orig}}^2, L, U]$ 顺序排列的包含三个浮点数的列表。例如，整体输出必须类似于\n$[[v_1,\\ell_1,u_1],[v_2,\\ell_2,u_2],[v_3,\\ell_3,u_3],[v_4,\\ell_4,u_4]]$\n且不含多余空格。",
            "solution": "问题陈述已经过评估并被确定为有效。它在科学上基于已建立的统计学和群体遗传学原理，问题定义良好、规范清晰完整，并且表述客观。因此，我们将着手推导解决方案。\n\n任务是为每组给定的有效种群大小的自助法重复样本 $\\{\\hat N_e^{(r)}\\}_{r=1}^R$ 计算两个统计摘要。这些重复样本是针对单个时间区间的。计算将针对 4 个独立的测试用例进行。\n\n第一个量是重复样本在原始尺度上的无偏样本方差。对于一组 $R$ 个重复样本，此值使用以下公式计算：\n$$\ns_{\\text{orig}}^2 = \\frac{1}{R-1}\\sum_{r=1}^R \\left(\\hat N_e^{(r)} - \\bar N_e\\right)^2\n$$\n其中 $\\bar N_e$ 是样本均值，$\\bar N_e = \\frac{1}{R}\\sum_{r=1}^R \\hat N_e^{(r)}$。此计算仅在 $R \\ge 2$ 时有定义，所有测试用例都满足此条件。\n\n第二个任务是构建一个名义覆盖率为 $0.95$ 的双边置信带。这基于一个假设，即 $\\hat N_e$ 中的不确定性是乘性的，这在该领域是一个常见且合理的模型。对数变换 $Y_r = \\log \\hat N_e^{(r)}$ 将乘性噪声转换为加性正态形式。我们使用自然对数作为 $\\log$ 函数。在这个经过对数变换的尺度上，我们计算样本均值 $\\bar Y$ 和无偏样本标准差 $s_Y$：\n$$\n\\bar Y = \\frac{1}{R}\\sum_{r=1}^R Y_r, \\qquad s_Y = \\sqrt{\\frac{1}{R-1}\\sum_{r=1}^R \\left(Y_r - \\bar Y\\right)^2}\n$$\n对数尺度上均值的 $(1-\\alpha)$ 置信区间由 $\\bar Y \\pm z_{1-\\alpha/2} s_Y$ 给出。对于 $0.95$ 的置信水平，$\\alpha = 0.05$，因此我们需要标准正态分布的 $1 - 0.05/2 = 0.975$ 分位数，记为 $z_{0.975}$。该值约为 $z_{0.975} \\approx 1.959964$。\n\n置信区间的下限（$L$）和上限（$U$）通过对对数尺度区间的端点取指数来得到：\n$$\nL = \\exp(\\bar Y - z_{0.975}\\, s_Y)\n$$\n$$\nU = \\exp(\\bar Y + z_{0.975}\\, s_Y)\n$$\n这会在原始尺度上产生一个非对称置信区间 $[L, U]$，它正确地反映了不确定性的乘性性质。\n\n每个测试用例的实现将按以下步骤进行：\n1. 将输入的重复样本列表转换为数值数组。设重复样本的数量为 $R$。\n2. 使用提供的公式计算无偏样本方差 $s_{\\text{orig}}^2$，采用的除数为 $R-1$。\n3. 使用自然对数对重复样本进行变换，因为所有提供的值都严格为正。\n4. 计算对数变换后数据的均值 $\\bar Y$ 和无偏样本标准差 $s_Y$。如果所有重复样本都相同，$s_Y$ 将正确地为 $0$。\n5. 从标准正态分布逆累积分布函数的高精度实现中获取分位数 $z_{0.975}$。\n6. 通过在对数尺度上构建区间，然后应用指数函数将其转换回原始尺度，来计算置信限 $L$ 和 $U$。\n7. 按照要求，将 $s_{\\text{orig}}^2$、$L$ 和 $U$ 的最终值四舍五入到 6 位小数。\n\n此程序将应用于问题陈述中提供的所有 4 个测试用例，以生成最终输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Computes variance and log-normal confidence intervals for bootstrap replicates\n    of effective population size.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (typical moderate variability)\n        [10000.0, 12000.0, 11000.0, 10500.0, 11500.0],\n        # Case 2 (identical replicates; boundary for zero variance)\n        [5000.0, 5000.0, 5000.0, 5000.0],\n        # Case 3 (minimal replicates R=2; large spread)\n        [10000.0, 40000.0],\n        # Case 4 (strong multiplicative spread)\n        [10000.0, 20000.0, 40000.0, 80000.0, 160000.0]\n    ]\n\n    results = []\n    \n    # Set nominal coverage and find the corresponding z-score for a two-sided interval.\n    # For a 95% confidence interval, alpha = 0.05.\n    alpha = 0.05\n    z_score = norm.ppf(1 - alpha / 2)\n\n    for case_data in test_cases:\n        # Use float64 for better precision in numerical computations.\n        replicates = np.array(case_data, dtype=np.float64)\n        R = len(replicates)\n        \n        # The problem statement ensures R >= 2, so ddof=1 is always valid.\n        \n        # Task 1: Compute the unbiased sample variance on the original scale.\n        # np.var with ddof=1 uses a divisor of (R-1).\n        s_orig_sq = np.var(replicates, ddof=1)\n        \n        # Task 2: Construct a log-normal confidence band.\n        # The problem guarantees strictly positive replicates, so log is safe.\n        log_replicates = np.log(replicates)\n        \n        # Compute the sample mean and sample standard deviation on the log scale.\n        # np.std with ddof=1 uses a divisor of (R-1).\n        y_bar = np.mean(log_replicates)\n        s_y = np.std(log_replicates, ddof=1)\n        \n        # If all replicates are identical, s_y will be 0. The subsequent\n        # calculations handle this correctly, yielding a zero-width CI.\n        \n        # Calculate the margin of error on the log scale.\n        margin_of_error = z_score * s_y\n        \n        # Construct the confidence interval on the log scale.\n        log_lower = y_bar - margin_of_error\n        log_upper = y_bar + margin_of_error\n        \n        # Map the interval back to the original scale by exponentiation.\n        L = np.exp(log_lower)\n        U = np.exp(log_upper)\n        \n        # Append the rounded results for the current case.\n        results.append([\n            round(s_orig_sq, 6),\n            round(L, 6),\n            round(U, 6)\n        ])\n\n    # Final print statement must produce a single-line string representation\n    # of the list of lists, with no spaces, as specified.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}