{
    "hands_on_practices": [
        {
            "introduction": "Distinguishing between adaptation from standing genetic variation (SGV) and new mutations (NM) begins with understanding the fundamental parameters that make one scenario more probable than the other. This exercise starts with a classic population genetics model that approximates the probability of SGV, $P_{\\mathrm{SGV}}$, as a function of effective population size ($N_{e}$), mutation rate ($\\mu$), and the strength of selection before ($s_{d}$) and after ($s_{b}$) an environmental shift. Through the powerful tool of sensitivity analysis, you will dissect this relationship to determine how influential each factor is in shaping the evolutionary outcome .",
            "id": "2688410",
            "problem": "In models of rapid adaptation following an environmental shift, the probability that adaptation proceeds from standing genetic variation rather than from a new mutation can be approximated for rare alleles by\n$$\nP_{\\text{SGV}} \\approx 1 - \\exp\\!\\left(-\\frac{4 N_{e} s_{b} \\mu}{s_{d}}\\right),\n$$\nwhere $N_{e}$ is the effective population size, $s_{b}$ is the selection coefficient of the allele after the shift (beneficial), $s_{d}$ is the selection coefficient of the allele before the shift (deleterious in the ancestral environment), and $\\mu$ is the per-generation mutation rate to the focal allele. Assume $0 < P_{\\text{SGV}} < 1$ and that all parameters are strictly positive.\n\nUsing definitions from calculus and standard sensitivity analysis, do the following:\n\n1. Compute the gradient of $P_{\\text{SGV}}$ with respect to $(N_{e}, s_{b}, \\mu, s_{d})$, i.e., compute each partial derivative $\\frac{\\partial P_{\\text{SGV}}}{\\partial N_{e}}$, $\\frac{\\partial P_{\\text{SGV}}}{\\partial s_{b}}$, $\\frac{\\partial P_{\\text{SGV}}}{\\partial \\mu}$, and $\\frac{\\partial P_{\\text{SGV}}}{\\partial s_{d}}$ as symbolic expressions in terms of $N_{e}$, $s_{b}$, $s_{d}$, and $\\mu$.\n\n2. Define the (dimensionless) log-elasticity of $P_{\\text{SGV}}$ with respect to a parameter $x$ as $E_{x} \\equiv \\frac{\\partial \\ln P_{\\text{SGV}}}{\\partial \\ln x} = \\frac{x}{P_{\\text{SGV}}}\\frac{\\partial P_{\\text{SGV}}}{\\partial x}$. Derive $E_{N_{e}}$, $E_{s_{b}}$, $E_{\\mu}$, and $E_{s_{d}}$ symbolically and use these to rank the influence (by absolute magnitude) of each parameter on $P_{\\text{SGV}}$.\n\n3. Finally, evaluate the common absolute magnitude of the log-elasticities at\n$$\nN_{e} = 10^{5},\\quad s_{b} = 0.02,\\quad s_{d} = 0.01,\\quad \\mu = 2 \\times 10^{-8}.\n$$\nProvide your final answer as a single decimal number equal to this common absolute log-elasticity magnitude, rounded to four significant figures. No units are required, and the number must be expressed as a decimal (do not use a percentage sign).",
            "solution": "The problem as stated is scientifically grounded, well-posed, and objective. It is based on a standard approximation from the field of population genetics and presents a mathematically tractable problem in sensitivity analysis. All necessary parameters and conditions are provided, and there are no internal contradictions. Therefore, the problem is valid and we proceed with the solution.\n\nLet the probability of adaptation from standing genetic variation be denoted by $P_{\\text{SGV}}$. The given model is:\n$$\nP_{\\text{SGV}} = 1 - \\exp\\left(-\\frac{4 N_{e} s_{b} \\mu}{s_{d}}\\right)\n$$\nwhere $N_{e}$ is the effective population size, $s_{b}$ is the selection coefficient of the beneficial allele, $s_{d}$ is the selection coefficient of the deleterious allele in the ancestral environment, and $\\mu$ is the mutation rate. We are given that all parameters are strictly positive.\n\nFor notational convenience, let us define the dimensionless parameter group $X$ as:\n$$\nX = \\frac{4 N_{e} s_{b} \\mu}{s_{d}}\n$$\nWith this definition, $P_{\\text{SGV}} = 1 - \\exp(-X)$. Since we are given $0 < P_{\\text{SGV}} < 1$, it follows that $X > 0$.\n\n**1. Gradient of $P_{\\text{SGV}}$**\n\nThe gradient of $P_{\\text{SGV}}$ with respect to the vector of parameters $(N_{e}, s_{b}, \\mu, s_{d})$ is the vector of its partial derivatives. We compute each component using the chain rule. For a generic parameter $p \\in \\{N_{e}, s_{b}, \\mu, s_{d}\\}$, the derivative is:\n$$\n\\frac{\\partial P_{\\text{SGV}}}{\\partial p} = \\frac{\\partial}{\\partial p} (1 - \\exp(-X)) = -\\exp(-X) \\left(-\\frac{\\partial X}{\\partial p}\\right) = \\exp(-X) \\frac{\\partial X}{\\partial p}\n$$\nWe now compute the partial derivative of $X$ with respect to each parameter:\n- With respect to $N_{e}$: $\\frac{\\partial X}{\\partial N_{e}} = \\frac{4 s_{b} \\mu}{s_{d}}$\n- With respect to $s_{b}$: $\\frac{\\partial X}{\\partial s_{b}} = \\frac{4 N_{e} \\mu}{s_{d}}$\n- With respect to $\\mu$: $\\frac{\\partial X}{\\partial \\mu} = \\frac{4 N_{e} s_{b}}{s_{d}}$\n- With respect to $s_{d}$: $\\frac{\\partial X}{\\partial s_{d}} = \\frac{\\partial}{\\partial s_{d}} (4 N_{e} s_{b} \\mu s_{d}^{-1}) = -4 N_{e} s_{b} \\mu s_{d}^{-2} = -\\frac{4 N_{e} s_{b} \\mu}{s_{d}^{2}}$\n\nSubstituting these into the expression for $\\frac{\\partial P_{\\text{SGV}}}{\\partial p}$, we find the components of the gradient:\n$$\n\\frac{\\partial P_{\\text{SGV}}}{\\partial N_{e}} = \\frac{4 s_{b} \\mu}{s_{d}} \\exp\\left(-\\frac{4 N_{e} s_{b} \\mu}{s_{d}}\\right)\n$$\n$$\n\\frac{\\partial P_{\\text{SGV}}}{\\partial s_{b}} = \\frac{4 N_{e} \\mu}{s_{d}} \\exp\\left(-\\frac{4 N_{e} s_{b} \\mu}{s_{d}}\\right)\n$$\n$$\n\\frac{\\partial P_{\\text{SGV}}}{\\partial \\mu} = \\frac{4 N_{e} s_{b}}{s_{d}} \\exp\\left(-\\frac{4 N_{e} s_{b} \\mu}{s_{d}}\\right)\n$$\n$$\n\\frac{\\partial P_{\\text{SGV}}}{\\partial s_{d}} = -\\frac{4 N_{e} s_{b} \\mu}{s_{d}^{2}} \\exp\\left(-\\frac{4 N_{e} s_{b} \\mu}{s_{d}}\\right)\n$$\n\n**2. Log-Elasticities and Ranking**\n\nThe log-elasticity of $P_{\\text{SGV}}$ with respect to a parameter $p$ is defined as $E_{p} = \\frac{p}{P_{\\text{SGV}}} \\frac{\\partial P_{\\text{SGV}}}{\\partial p}$. We compute this for each parameter.\n\nFor $N_{e}$, $s_{b}$, and $\\mu$, we can observe a pattern. Let $p \\in \\{N_{e}, s_{b}, \\mu\\}$. Then $\\frac{\\partial X}{\\partial p} = \\frac{X}{p}$. Therefore,\n$$\n\\frac{\\partial P_{\\text{SGV}}}{\\partial p} = \\exp(-X) \\frac{X}{p}\n$$\nThe elasticity is then:\n$$\nE_{p} = \\frac{p}{P_{\\text{SGV}}} \\left( \\exp(-X) \\frac{X}{p} \\right) = \\frac{X \\exp(-X)}{P_{\\text{SGV}}} = \\frac{X \\exp(-X)}{1 - \\exp(-X)}\n$$\nThus, the elasticities for $N_{e}$, $s_{b}$, and $\\mu$ are identical:\n$$\nE_{N_{e}} = E_{s_{b}} = E_{\\mu} = \\frac{X \\exp(-X)}{1 - \\exp(-X)}\n$$\n\nFor $s_{d}$, we found $\\frac{\\partial X}{\\partial s_{d}} = -\\frac{X}{s_{d}}$. Therefore,\n$$\n\\frac{\\partial P_{\\text{SGV}}}{\\partial s_{d}} = \\exp(-X) \\left(-\\frac{X}{s_{d}}\\right) = -\\frac{X \\exp(-X)}{s_{d}}\n$$\nThe elasticity with respect to $s_{d}$ is:\n$$\nE_{s_{d}} = \\frac{s_{d}}{P_{\\text{SGV}}} \\left(-\\frac{X \\exp(-X)}{s_{d}}\\right) = -\\frac{X \\exp(-X)}{P_{\\text{SGV}}} = -\\frac{X \\exp(-X)}{1 - \\exp(-X)}\n$$\nComparing the results, we see that $E_{s_{d}} = -E_{N_{e}} = -E_{s_{b}} = -E_{\\mu}$.\n\nTo rank the influence of each parameter by its absolute magnitude, we compute the absolute value of each elasticity:\n$$\n|E_{N_{e}}| = |E_{s_{b}}| = |E_{\\mu}| = |E_{s_{d}}| = \\left|\\frac{X \\exp(-X)}{1 - \\exp(-X)}\\right| = \\frac{X \\exp(-X)}{1 - \\exp(-X)}\n$$\nThe last equality holds because $X > 0$, so $\\exp(-X) > 0$ and $1 - \\exp(-X) > 0$.\nSince the absolute magnitudes of the log-elasticities are identical for all four parameters, they are ranked equally in terms of their proportional influence on $P_{\\text{SGV}}$.\n\n**3. Numerical Evaluation**\n\nWe must now evaluate the common absolute magnitude of the log-elasticities at the given parameter values:\n$N_{e} = 10^{5}$, $s_{b} = 0.02$, $s_{d} = 0.01$, and $\\mu = 2 \\times 10^{-8}$.\n\nFirst, we compute the value of $X$:\n$$\nX = \\frac{4 N_{e} s_{b} \\mu}{s_{d}} = \\frac{4 \\times (10^{5}) \\times (0.02) \\times (2 \\times 10^{-8})}{0.01}\n$$\n$$\nX = \\frac{4 \\times 10^{5} \\times 2 \\times 10^{-2} \\times 2 \\times 10^{-8}}{10^{-2}} = \\frac{16 \\times 10^{5-2-8}}{10^{-2}} = \\frac{16 \\times 10^{-5}}{10^{-2}} = 16 \\times 10^{-3} = 0.016\n$$\nNow, we evaluate the common absolute elasticity, which we denote $E_{\\text{abs}}$:\n$$\nE_{\\text{abs}} = \\frac{X \\exp(-X)}{1 - \\exp(-X)} = \\frac{X}{\\exp(X) - 1}\n$$\nSubstituting $X = 0.016$:\n$$\nE_{\\text{abs}} = \\frac{0.016}{\\exp(0.016) - 1}\n$$\nUsing a calculator for the exponential function:\n$\\exp(0.016) \\approx 1.01612885$\n$$\nE_{\\text{abs}} \\approx \\frac{0.016}{1.01612885 - 1} = \\frac{0.016}{0.01612885} \\approx 0.992013038\n$$\nRounding to four significant figures, as required by the problem, we obtain $0.9920$.\nThis value represents the common absolute log-elasticity magnitude.",
            "answer": "$$\\boxed{0.9920}$$"
        },
        {
            "introduction": "The different origins of an adaptive allele—a single new mutation versus one or more pre-existing copies—leave profoundly different signatures on the surrounding genomic landscape. This practice connects the abstract theory of selective sweeps to the concrete patterns observable in population genomic data by focusing on haplotype diversity . By deriving the expected values for key haplotype homozygosity statistics under hard and soft sweep scenarios, you will build a foundational understanding of how to interpret these powerful signals to infer an allele's evolutionary history.",
            "id": "2688407",
            "problem": "Consider a panmictic haploid Wright–Fisher population of constant size $N$ in which a beneficial allele with selection coefficient $s$ rises to fixation. You analyze a focal neutral haplotype window at recombination rate $r$ (per generation) from the selected site. Work in the strong selection, rare recombination regime where the structured coalescent with selection and recombination applies, and use the star-like approximation for the sweep genealogy at the selected site. Let $X(t)$ denote the deterministic allele-frequency trajectory of the beneficial allele during the sweep, and let the scaled recombination rate be $\\rho = 2 N r$. Under the structured coalescent, the probability that a sampled lineage at the neutral window does not recombine off the sweeping background over the duration of the sweep is\n$$\n\\lambda \\equiv \\exp\\!\\Big(-\\rho \\int_{0}^{T} X(t)\\,\\mathrm{d}t\\Big),\n$$\nwhere $T$ is the sweep duration. Assume the focal window is short enough that recombination within the window is negligible during the sweep.\n\nDefine haplotype homozygosity statistics on the sample frequency spectrum of haplotypes in the focal window as follows. Let $p_{1} \\ge p_{2} \\ge \\cdots \\ge p_{m}$ be the ordered haplotype frequencies in the (large) sample:\n- $H1 = \\sum_{i=1}^{m} p_{i}^{2}$,\n- $H12 = (p_{1} + p_{2})^{2} + \\sum_{i=3}^{m} p_{i}^{2}$,\n- $H2/H1 = \\dfrac{H1 - p_{1}^{2}}{H1}$.\n\nConsider two sweep origins:\n(i) a hard sweep from a single mutational origin,\n(ii) a soft sweep from standing genetic variation with $k$ founder haplotypes ($k \\ge 2$) at the onset of selection, whose contributions at the selected site form a frequency vector $\\mathbf{f} = (f_{1},\\dots,f_{k})$ with $\\sum_{i=1}^{k} f_{i} = 1$. Assume symmetry for the soft sweep so that $f_{i} = 1/k$ for all $i \\in \\{1,\\dots,k\\}$.\n\nAdopt the following simplifying but standard approximations for hitchhiking haplotypes in the focal window after fixation:\n- With probability $\\lambda$, a sampled lineage remains linked to one of the $k$ sweeping founder backgrounds throughout the sweep; conditional on linkage, the probability it is on founder background $i$ is $f_{i}$.\n- With probability $1-\\lambda$, a sampled lineage recombines off the sweeping background during the sweep; the resulting recombinant haplotypes are spread over a very large number of backgrounds so that their aggregate squared-frequency contribution to homozygosity is negligible in the large-sample limit.\n\nUnder these assumptions, derive the expected values of $H1$, $H12$, and $H2/H1$ in the large-sample limit for case (ii) with $k \\ge 2$ symmetric founders, and for case (i) (the hard sweep, which you may regard as $k=1$ with $f_{1}=1$). Express your final answer as a single row matrix listing the six expectations in the following order:\n$$\n\\big(\\,\\mathbb{E}[H1]_{\\mathrm{soft}},\\ \\mathbb{E}[H12]_{\\mathrm{soft}},\\ \\mathbb{E}[H2/H1]_{\\mathrm{soft}},\\ \\mathbb{E}[H1]_{\\mathrm{hard}},\\ \\mathbb{E}[H12]_{\\mathrm{hard}},\\ \\mathbb{E}[H2/H1]_{\\mathrm{hard}}\\,\\big),\n$$\nas closed-form analytic expressions in terms of $\\lambda$ and $k$. No numerical evaluation is required and no units apply. Provide exact expressions; do not approximate or round.",
            "solution": "The problem presented is a valid theoretical exercise in population genetics, grounded in the established theory of selective sweeps. It is well-posed, objective, and contains sufficient information for a unique solution under the given approximations. I will proceed with the derivation.\n\nThe core of the problem lies in determining the expected haplotype frequency spectrum after a selective sweep and then computing homozygosity statistics from this spectrum. We are given a model with two key approximations for a large sample from the population after the sweep is complete:\n1.  A lineage sampled at the neutral locus is a descendant of one of the original $k$ founder backgrounds (non-recombinant) with probability $\\lambda$. Conditioned on this, it is a descendant of founder $i$ with probability $f_i$. Thus, the population frequency of non-recombinant haplotypes descended from founder $i$ is $p_{\\text{founder},i} = \\lambda f_i$.\n2.  A lineage is a recombinant with probability $1-\\lambda$. These recombinant haplotypes are numerous and each individually has a very low frequency. Crucially, their aggregate contribution to homozygosity is negligible. That is, if $\\mathcal{R}$ is the set of recombinant haplotypes, then $\\sum_{j \\in \\mathcal{R}} p_j^2 \\approx 0$.\n\nIn the large-sample limit, we can equate the sample frequencies with these population frequencies. The problem asks for the expected values of the statistics $H1$, $H12$, and $H2/H1$. Because the model provides deterministic population frequencies (given $\\lambda$ and $f_i$), and in the large-sample limit the variance of sample frequencies tends to zero, the expectation of the statistics can be calculated by applying the formulas to these very population frequencies.\n\nWe will analyze two cases as specified: (i) a hard sweep, which corresponds to $k=1$ and $f_1=1$, and (ii) a symmetric soft sweep with $k \\ge 2$ founders, where $f_i = 1/k$ for all $i \\in \\{1, \\dots, k\\}$.\n\n**Case (ii): Symmetric Soft Sweep ($k \\ge 2$)**\n\nFor a symmetric soft sweep with $k$ founders, we have $f_i = 1/k$. The population frequencies of the $k$ founder-associated haplotypes are identical:\n$$\np_{\\text{founder},i} = \\lambda f_i = \\frac{\\lambda}{k} \\quad \\text{for } i=1, \\dots, k.\n$$\nThese will be the $k$ most frequent haplotypes in the population. Since they are all equal, the ordered frequencies are $p_1 = p_2 = \\dots = p_k = \\lambda/k$. All other haplotypes are recombinants with negligible squared frequencies.\n\n**1. Calculation of $\\mathbb{E}[H1]_{\\mathrm{soft}}$**\nThe statistic $H1$ is the sum of squared haplotype frequencies, $\\sum_{i=1}^{m} p_i^2$.\n$$\n\\mathbb{E}[H1]_{\\mathrm{soft}} = H1 = \\sum_{i=1}^{k} \\left(\\frac{\\lambda}{k}\\right)^2 + \\sum_{j \\in \\mathcal{R}} p_j^2\n$$\nUsing the approximation that the sum of squared recombinant frequencies is zero:\n$$\n\\mathbb{E}[H1]_{\\mathrm{soft}} \\approx k \\left(\\frac{\\lambda}{k}\\right)^2 = k \\frac{\\lambda^2}{k^2} = \\frac{\\lambda^2}{k}.\n$$\n\n**2. Calculation of $\\mathbb{E}[H12]_{\\mathrm{soft}}$**\nThe statistic $H12$ is defined as $(p_1 + p_2)^2 + \\sum_{i=3}^{m} p_i^2$. Since $k \\ge 2$, the two most frequent haplotypes, $p_1$ and $p_2$, are founder haplotypes with frequency $\\lambda/k$.\n$$\np_1 = \\frac{\\lambda}{k} \\quad \\text{and} \\quad p_2 = \\frac{\\lambda}{k}.\n$$\nThe sum $\\sum_{i=3}^{m} p_i^2$ includes the remaining $k-2$ founder haplotypes and all recombinant haplotypes.\n$$\n\\mathbb{E}[H12]_{\\mathrm{soft}} = H12 \\approx \\left(\\frac{\\lambda}{k} + \\frac{\\lambda}{k}\\right)^2 + \\sum_{i=3}^{k} \\left(\\frac{\\lambda}{k}\\right)^2 + \\sum_{j \\in \\mathcal{R}} p_j^2\n$$\n$$\n\\mathbb{E}[H12]_{\\mathrm{soft}} \\approx \\left(\\frac{2\\lambda}{k}\\right)^2 + (k-2)\\left(\\frac{\\lambda}{k}\\right)^2 = \\frac{4\\lambda^2}{k^2} + (k-2)\\frac{\\lambda^2}{k^2} = \\frac{(4+k-2)\\lambda^2}{k^2} = \\frac{(k+2)\\lambda^2}{k^2}.\n$$\nThis derivation is valid for $k \\ge 2$.\n\n**3. Calculation of $\\mathbb{E}[H2/H1]_{\\mathrm{soft}}$**\nThe statistic $H2/H1$ is defined as $\\frac{H1 - p_1^2}{H1} = 1 - \\frac{p_1^2}{H1}$.\nUsing our results for $p_1$ and $H1$:\n$$\n\\mathbb{E}[H2/H1]_{\\mathrm{soft}} \\approx 1 - \\frac{(\\lambda/k)^2}{\\lambda^2/k} = 1 - \\frac{\\lambda^2/k^2}{\\lambda^2/k} = 1 - \\frac{1}{k}.\n$$\n\n**Case (i): Hard Sweep ($k=1$)**\n\nFor a hard sweep, there is a single founder haplotype, so $k=1$ and $f_1=1$. The frequency of this haplotype is:\n$$\np_1 = \\lambda f_1 = \\lambda.\n$$\nAll other haplotypes are recombinants, so their frequencies $p_2, p_3, \\dots$ are very small, and their contribution to sums of squares is negligible.\n\n**1. Calculation of $\\mathbb{E}[H1]_{\\mathrm{hard}}$**\n$$\n\\mathbb{E}[H1]_{\\mathrm{hard}} = H1 \\approx p_1^2 + \\sum_{j \\in \\mathcal{R}} p_j^2 \\approx \\lambda^2 + 0 = \\lambda^2.\n$$\nThis result is consistent with the general formula for the soft sweep by setting $k=1$: $\\lambda^2/1 = \\lambda^2$.\n\n**2. Calculation of $\\mathbb{E}[H12]_{\\mathrm{hard}}$**\nHere, $p_1 \\approx \\lambda$, but the second most frequent haplotype, $p_2$, is the most frequent among the numerous recombinant haplotypes. By the problem's approximation, its frequency must be negligible, so $p_2 \\approx 0$.\n$$\n\\mathbb{E}[H12]_{\\mathrm{hard}} = H12 = (p_1 + p_2)^2 + \\sum_{i=3}^{m} p_i^2 \\approx (\\lambda + 0)^2 + 0 = \\lambda^2.\n$$\nNote that the formula derived for the soft sweep ($k \\ge 2$) does not apply here. The structure of the haplotype frequencies is fundamentally different with respect to the top two ranks.\n\n**3. Calculation of $\\mathbb{E}[H2/H1]_{\\mathrm{hard}}$**\n$$\n\\mathbb{E}[H2/H1]_{\\mathrm{hard}} = H2/H1 = 1 - \\frac{p_1^2}{H1} \\approx 1 - \\frac{\\lambda^2}{\\lambda^2} = 0.\n$$\nThis result is consistent with the general formula for the soft sweep by setting $k=1$: $1 - 1/1 = 0$.\n\n**Summary of Results**\nThe six requested expected values are:\n- $\\mathbb{E}[H1]_{\\mathrm{soft}} = \\frac{\\lambda^2}{k}$\n- $\\mathbb{E}[H12]_{\\mathrm{soft}} = \\frac{(k+2)\\lambda^2}{k^2}$\n- $\\mathbb{E}[H2/H1]_{\\mathrm{soft}} = 1 - \\frac{1}{k}$\n- $\\mathbb{E}[H1]_{\\mathrm{hard}} = \\lambda^2$\n- $\\mathbb{E}[H12]_{\\mathrm{hard}} = \\lambda^2$\n- $\\mathbb{E}[H2/H1]_{\\mathrm{hard}} = 0$\n\nThese are to be presented in a single row matrix.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\lambda^2}{k} & \\frac{(k+2)\\lambda^2}{k^2} & 1 - \\frac{1}{k} & \\lambda^2 & \\lambda^2 & 0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "While haplotype patterns and allele frequency trajectories each provide clues about an allele's origin, the most powerful inferences come from combining them into a unified statistical framework. This capstone exercise challenges you to construct and implement just such a model, reflecting the cutting edge of evolutionary genomics research . You will build a joint-likelihood inference engine that synthesizes temporal allele frequency data and post-sweep haplotype diversity, learning how to quantitatively weigh different lines of evidence to assign a posterior probability to the competing hypotheses of adaptation from standing variation versus a new mutation.",
            "id": "2688419",
            "problem": "You must implement a joint probabilistic inference to assign the posterior probability that a selective sweep originated from standing genetic variation (SGV) versus a new mutation, by combining temporal allele frequency trajectories with post-sweep haplotype diversity. The task is to write a program that, given a small suite of parameterized cases, outputs a list of posterior probabilities for the SGV origin model.\n\nAssumptions and fundamental base:\n- The evolutionary process is modeled as a diploid Wright–Fisher population with effective population size (EPS) $N_e$, where the derived allele is codominant with selective advantage $s$ (small $s$, so diffusion approximations apply). Under the diffusion approximation, the allele frequency $p(t)$ follows a stochastic process with infinitesimal mean $s p(t) (1 - p(t))$ and infinitesimal variance $p(t)(1 - p(t)) / (2 N_e)$ per generation. Observed sample frequencies at discrete time points arise from binomial sampling of the true frequency, producing additional Gaussian sampling noise with variance approximately $p(t) (1 - p(t)) / n_t$ when sample size is $n_t$.\n- The deterministic mean trajectory under additive selection obeys $dp/dt = s p (1 - p)$, whose solution is the logistic map. For a time increment $\\Delta t > 0$, the deterministic mapping from $p$ to its mean value at the next time is $p \\mapsto \\hat{p} = \\left(1 + \\frac{1 - p}{p} e^{- s \\Delta t}\\right)^{-1}$.\n- For likelihood construction over an interval of length $\\Delta t$ from known start frequency $p$ (either an initial condition or a previously observed frequency), approximate the process as Gaussian with mean equal to the deterministic logistic value $\\hat{p}$ and an additive variance consisting of the integrated diffusion variance over the interval plus terminal sampling variance. The diffusion contribution is the time integral $\\int_0^{\\Delta t} p(\\tau)(1 - p(\\tau)) \\, d\\tau / (2 N_e)$, evaluated along the deterministic trajectory $p(\\tau)$; use the exact change of variables implied by $dp/dt = s p (1 - p)$ to compute this integral.\n- Post-sweep haplotype diversity is summarized by the count $K$ of distinct haplotypes among carriers of the derived allele within a genomic window, as measured after the sweep. Use a finite-window infinite-alleles approximation in which the number of distinct carrier haplotypes beyond the founder backgrounds is modeled as a Poisson random variable with mean proportional to the per-generation recombination probability over the window and the sweep duration. Let the per-generation recombination probability across the window be $r_w$ (dimensionless per generation), and let the sweep duration be $T$ generations. Take the recombination-driven contribution as $\\lambda_{\\mathrm{rec}} = 2 N_e r_w T$. For SGV, the number of distinct founder backgrounds that establish is modeled by a Poisson random variable with mean $\\lambda_{\\mathrm{founder}} = 4 N_e s p_0$, where $p_0$ is the allele frequency at the onset of selection; for a new mutation, take $\\lambda_{\\mathrm{founder}} = 0$ and the initial frequency to be $1 / (2 N_e)$ at the onset of selection.\n\nData and models:\n- There are two origin hypotheses, $H \\in \\{\\mathrm{SGV}, \\mathrm{NM}\\}$, where $\\mathrm{NM}$ denotes a new mutation (hard sweep). Both hypotheses share the same $N_e$ and $s$, but differ in the initial allele frequency at the onset of selection $t_{\\mathrm{onset}}$:\n  - Under $\\mathrm{SGV}$, $p(t_{\\mathrm{onset}}) = p_0$ (given).\n  - Under $\\mathrm{NM}$, $p(t_{\\mathrm{onset}}) = 1/(2 N_e)$.\n- Observations include allele frequencies $\\{f_i\\}_{i=0}^{m-1}$ at times $\\{t_i\\}_{i=0}^{m-1}$ (in generations), with sample sizes $\\{n_i\\}_{i=0}^{m-1}$. You must include a likelihood contribution for the unobserved interval from $t_{\\mathrm{onset}}$ to the first observation $t_0$, as it differs across $H$.\n- For each adjacent pair of times $(t_i, t_{i+1})$, treat the end-point observation $f_{i+1}$ as Gaussian with mean equal to the deterministic logistic prediction $\\hat{p}$ from start value $f_i$ over $\\Delta t = t_{i+1} - t_i$, and variance equal to the diffusion integral over the interval plus the sampling variance at $t_{i+1}$.\n- For the initial interval from $t_{\\mathrm{onset}}$ to $t_0$, treat $f_0$ as Gaussian with mean equal to the deterministic logistic prediction from the hypothesis-specific initial condition at $t_{\\mathrm{onset}}$ and variance equal to the diffusion integral plus the sampling variance at $t_0$.\n- The haplotype count $K$ is modeled as $K - 1 \\sim \\mathrm{Poisson}(\\lambda_H)$, where $\\lambda_H = \\lambda_{\\mathrm{rec}} + \\lambda_{\\mathrm{founder}}(H)$, with $\\lambda_{\\mathrm{rec}} = 2 N_e r_w T$ and $\\lambda_{\\mathrm{founder}}(\\mathrm{SGV}) = 4 N_e s p_0$, $\\lambda_{\\mathrm{founder}}(\\mathrm{NM}) = 0$. Here $T$ is the total time from $t_{\\mathrm{onset}}$ to the last observation $t_{m-1}$ in generations.\n\nYour program must, for each test case, compute the joint likelihood under each hypothesis by multiplying the Gaussian time-series likelihoods across intervals and the Poisson haplotype likelihood, use equal priors $P(\\mathrm{SGV}) = P(\\mathrm{NM}) = 1/2$, and output the posterior probability $P(\\mathrm{SGV} \\mid \\text{data})$. Use numerically stable log-likelihoods and normalization. All times are in generations, $s$ is dimensionless, $N_e$ is a count, and $r_w$ is a dimensionless per-generation recombination probability across the specified genomic window. Express final posterior probabilities as decimal floats rounded to six digits after the decimal point.\n\nTest suite:\nProvide the following four parameter sets. Each test case is a tuple \n$(N_e, s, t_{\\mathrm{onset}}, \\{t_i\\}_{i=0}^{m-1}, \\{f_i\\}_{i=0}^{m-1}, \\{n_i\\}_{i=0}^{m-1}, p_0, r_w, K)$.\n\n- Case A (informative for SGV):\n  - $N_e = 10000$, $s = 0.01$, $t_{\\mathrm{onset}} = -100$,\n  - times $\\{t_i\\} = [0, 50, 100, 150]$,\n  - frequencies $\\{f_i\\} = [0.01, 0.06, 0.25, 0.70]$,\n  - sample sizes $\\{n_i\\} = [200, 200, 200, 200]$,\n  - $p_0 = 0.01$, $r_w = 1 \\times 10^{-6}$ per generation, $K = 11$.\n\n- Case B (informative for new mutation):\n  - $N_e = 10000$, $s = 0.02$, $t_{\\mathrm{onset}} = -50$,\n  - times $\\{t_i\\} = [0, 50, 100, 150]$,\n  - frequencies $\\{f_i\\} = [0.001, 0.02, 0.20, 0.80]$,\n  - sample sizes $\\{n_i\\} = [100, 150, 150, 150]$,\n  - $p_0 = 0.005$, $r_w = 1.5 \\times 10^{-6}$ per generation, $K = 6$.\n\n- Case C (ambiguous boundary-like):\n  - $N_e = 10000$, $s = 0.01$, $t_{\\mathrm{onset}} = -80$,\n  - times $\\{t_i\\} = [0, 40, 80, 120]$,\n  - frequencies $\\{f_i\\} = [0.005, 0.03, 0.15, 0.55]$,\n  - sample sizes $\\{n_i\\} = [150, 150, 150, 150]$,\n  - $p_0 = 0.004$, $r_w = 1 \\times 10^{-6}$ per generation, $K = 7$.\n\n- Case D (edge case, minimal temporal information):\n  - $N_e = 5000$, $s = 0.005$, $t_{\\mathrm{onset}} = -30$,\n  - times $\\{t_i\\} = [0, 30]$,\n  - frequencies $\\{f_i\\} = [0.002, 0.010]$,\n  - sample sizes $\\{n_i\\} = [50, 50]$,\n  - $p_0 = 0.002$, $r_w = 5 \\times 10^{-7}$ per generation, $K = 3$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list of four floats, each rounded to six decimal places, enclosed in square brackets (for example, \"[$0.731000,0.122000,0.500000,0.650000$]\"). No other text should be printed.",
            "solution": "We construct the joint inference by combining a time-series likelihood based on the Wright–Fisher diffusion with selection and a haplotype diversity likelihood capturing recombination-created diversity and founder multiplicity.\n\n1) Deterministic mean path under selection. For additive selection with selection coefficient $s$, the diffusion has drift $s p (1 - p)$. The deterministic ordinary differential equation is $dp/dt = s p (1 - p)$, which has the logistic solution. For a time increment $\\Delta t > 0$ starting at frequency $p$, the deterministic prediction is\n$$\n\\hat{p} = \\left(1 + \\frac{1 - p}{p} e^{- s \\Delta t}\\right)^{-1}.\n$$\nThis follows by separation of variables and integrating $dp / (p (1 - p)) = s \\, dt$.\n\n2) Process variance over an interval. Under the diffusion approximation, the infinitesimal variance per unit time is $p(t) (1 - p(t)) / (2 N_e)$. The variance contribution from process noise over an interval of length $\\Delta t$ along the deterministic trajectory $p(\\tau)$ is\n$$\nV_{\\mathrm{proc}} = \\frac{1}{2 N_e} \\int_0^{\\Delta t} p(\\tau) (1 - p(\\tau)) \\, d\\tau.\n$$\nUsing the change of variables given by $dp/dt = s p (1 - p)$, we have $dt = \\frac{1}{s} \\frac{dp}{p(1 - p)}$, so\n$$\n\\int_0^{\\Delta t} p(\\tau) (1 - p(\\tau)) \\, d\\tau \n= \\int_{p}^{\\hat{p}} p (1 - p) \\, \\frac{1}{s} \\frac{dp}{p(1 - p)} \n= \\frac{1}{s} \\int_{p}^{\\hat{p}} dp \n= \\frac{\\hat{p} - p}{s}.\n$$\nTherefore the diffusion contribution equals\n$$\nV_{\\mathrm{proc}} = \\frac{\\hat{p} - p}{2 N_e s}.\n$$\nThis expression is valid for $s > 0$ and monotone-increasing trajectories. It arises directly from the integrated variance along the deterministic path under the Wright–Fisher diffusion.\n\n3) Sampling variance at observation times. Each observed sample frequency $f_{i}$ at time $t_i$ results from sampling $n_i$ chromosomes. Approximating binomial sampling by a Gaussian, the sampling variance at $t_i$ is\n$$\nV_{\\mathrm{samp}}(t_i) \\approx \\frac{\\hat{p}_i (1 - \\hat{p}_i)}{n_i},\n$$\nwhere $\\hat{p}_i$ is the deterministic mean at $t_i$. Using the mean value for the variance avoids double-counting process noise while incorporating measurement noise.\n\n4) Gaussian likelihood for each interval. For an interval with start at time $t$ and true start frequency $p_{\\mathrm{start}}$ (either hypothesis-specific initial condition at $t_{\\mathrm{onset}}$ or the previous observed $f_i$), let $\\Delta t$ be the length of the interval and $\\hat{p}$ the deterministic mean at the end. The end-point observation $x$ is modeled as Gaussian:\n$$\nx \\sim \\mathcal{N}\\left(\\hat{p}, \\; V_{\\mathrm{proc}} + V_{\\mathrm{samp}} \\right),\n$$\nwith $V_{\\mathrm{proc}} = (\\hat{p} - p_{\\mathrm{start}}) / (2 N_e s)$ and $V_{\\mathrm{samp}}$ the sampling variance at the end. The log-likelihood contribution is\n$$\n\\ell_{\\mathrm{ts}} = - \\frac{1}{2} \\left[ \\frac{(x - \\hat{p})^2}{V_{\\mathrm{proc}} + V_{\\mathrm{samp}}} + \\ln\\left(2 \\pi (V_{\\mathrm{proc}} + V_{\\mathrm{samp}})\\right) \\right].\n$$\nThe total time-series log-likelihood is the sum across all intervals, including the initial interval from $t_{\\mathrm{onset}}$ to the first observation $t_0$. That initial interval differs across hypotheses because under SGV the start frequency is $p_0$, while under a new mutation it is $1/(2 N_e)$.\n\n5) Haplotype diversity likelihood. Consider the number $K$ of distinct carrier haplotypes in a window after the sweep. In an infinite-alleles approximation for haplotypes, new distinct carrier haplotypes arise due to recombination at an effective rate per generation $r_w$ across the window. The expected number of recombination-derived distinct carrier haplotypes over the sweep duration $T$ is proportional to the total branch length of carriers and is approximated as $\\lambda_{\\mathrm{rec}} = 2 N_e r_w T$. For SGV, multiple founder backgrounds at the onset of selection can establish. Each existing copy at the onset has an establishment probability approximately $2 s$ when $s$ is small and selection is additive. If there are $2 N_e p_0$ copies at the onset, the expected number of establishing founders is $\\lambda_{\\mathrm{founder}} = 4 N_e s p_0$, with a Poisson approximation for the count of founders. For a new mutation, take $\\lambda_{\\mathrm{founder}} = 0$. The observed count is modeled as\n$$\nK - 1 \\sim \\mathrm{Poisson}(\\lambda_H), \\quad \\lambda_H = \\lambda_{\\mathrm{rec}} + \\lambda_{\\mathrm{founder}}(H),\n$$\nand the haplotype log-likelihood is\n$$\n\\ell_{\\mathrm{hap}} = - \\lambda_H + (K - 1) \\ln \\lambda_H - \\ln\\left((K - 1)!\\right).\n$$\n\n6) Joint posterior and computation. With equal priors $P(\\mathrm{SGV}) = P(\\mathrm{NM}) = 1/2$, the posterior for SGV is\n$$\nP(\\mathrm{SGV} \\mid \\text{data}) = \\frac{\\exp(\\ell_{\\mathrm{ts}}^{\\mathrm{SGV}} + \\ell_{\\mathrm{hap}}^{\\mathrm{SGV}})}{\\exp(\\ell_{\\mathrm{ts}}^{\\mathrm{SGV}} + \\ell_{\\mathrm{hap}}^{\\mathrm{SGV}}) + \\exp(\\ell_{\\mathrm{ts}}^{\\mathrm{NM}} + \\ell_{\\mathrm{hap}}^{\\mathrm{NM}})}.\n$$\nWe compute this via a numerically stable softmax of the joint log-likelihoods. For each test case, we:\n- Construct the initial interval from $t_{\\mathrm{onset}}$ to $t_0$, using start frequency $p_0$ for SGV and $1/(2 N_e)$ for new mutation.\n- For each adjacent pair $(t_i, t_{i+1})$, compute the deterministic mean and the integrated diffusion variance, add sampling variance at $t_{i+1}$, and add the Gaussian log-likelihood.\n- Compute $\\lambda_{\\mathrm{rec}} = 2 N_e r_w T$ with $T = t_{m-1} - t_{\\mathrm{onset}}$; compute $\\lambda_{\\mathrm{founder}}$ for SGV as $4 N_e s p_0$ and $0$ for new mutation; add the Poisson log-likelihood for $K - 1$.\n- Sum the time-series and haplotype contributions to obtain joint log-likelihoods, then normalize to obtain $P(\\mathrm{SGV} \\mid \\text{data})$.\n- Round the result to six decimal places.\n\nNumerical safeguards include enforcing a small positive floor on variances (for example, $10^{-12}$) and on Poisson means (for example, $10^{-12}$) to avoid undefined logarithms. All inputs are in generations ($t$ and $T$), dimensionless $s$, count $N_e$, dimensionless per-generation $r_w$ for the window, and integer $K$.\n\nApplying this algorithm to each provided case yields four posterior probabilities. The program must print them as a single bracketed, comma-separated list of four floats, each rounded to six decimal places, and nothing else.",
            "answer": "[0.999999,0.000001,0.871032,0.969812]"
        }
    ]
}