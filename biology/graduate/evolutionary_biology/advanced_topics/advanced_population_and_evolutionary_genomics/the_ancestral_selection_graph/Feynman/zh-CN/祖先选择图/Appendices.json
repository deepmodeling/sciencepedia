{
    "hands_on_practices": [
        {
            "introduction": "祖先选择图 (ASG) 的一个核心优势是它与前向时间等位基因频率模型的严格对偶关系。本练习旨在通过实践来巩固这一关键联系。你将从经典的 Wright-Fisher 扩散模型的漂移项出发，推导出在后向时间 ASG 中由选择引起的分枝事件的总速率，从而亲身体验如何将前向时间的选择效应转化为后向时间的谱系分枝过程 。",
            "id": "2756036",
            "problem": "考虑一个根据莱特-费希尔模型演化的大型、随机交配的二倍体种群，该种群有两个等位基因$A$和$a$。相对生存力由$w_{AA} = 1 + \\sigma$、$w_{Aa} = 1 + h \\sigma$和$w_{aa} = 1$给出，其中$0 \\leq h \\leq \\tfrac{1}{2}$（无超显性），$\\sigma$是扩散时间尺度上的弱选择系数。令$X_{t}$表示等位基因$A$在时间$t$的频率。在弱选择标度下，$X_{t}$的扩散生成元的漂移项为$m(x) = \\sigma x(1-x)\\big[h + (1-2h)x\\big]$，方差项为$\\tfrac{1}{2}x(1-x)$。\n\n该模型的祖先选择图（ASG）是一个关于祖先配子世系的向后时间分支-溯祖合并结构。在未定型的向后图中，选择表现为增加潜在祖先世系的分支事件。假设标准的对偶构造，其中漂移项的每个多项式分量$x^{r}(1-x)$对应一个向后事件，该事件对$r$个现存的祖先配子世系进行抽样，并提出$r$个额外的潜在祖先世系，其发生速率等于该多项式的系数乘以每组无序$r$元组的世系。\n\n从扩散漂移项$m(x)$出发，并仅使用上述基础对偶解释，推导当存在$k$个祖先配子世系时，二倍体ASG中由选择引起的分支事件发生的总瞬时速率。用$h$、$\\sigma$和$k$表示您的答案，形式为一个闭式表达式。不需要数值近似，也不需要单位。您的最终答案必须是单一的解析表达式。",
            "solution": "该问题是有效的。它在科学上基于群体遗传学的既定理论，特别是关于莱特-费希尔模型、扩散近似和对偶祖先选择图（ASG）的理论。该问题是适定的、客观的，并包含通过严谨数学推理得出唯一解所需的所有必要信息。所用术语和参数均为该领域的标准。\n\n目标是推导具有$k$个现存祖先配子世系的二倍体祖先选择图中，由选择引起的分支事件的总瞬时速率。推导必须根据指定的对偶原理，从所给定的主导扩散过程的漂移项出发。\n\n等位基因$A$的频率$X_t$的正向时间演化由一个扩散过程描述，其漂移系数为$m(x)$，方差项为$\\frac{1}{2}x(1-x)$。捕获自然选择效应的漂移项由下式给出：\n$$m(x) = \\sigma x(1-x)\\big[h + (1-2h)x\\big]$$\n其中$\\sigma$是选择系数，$h$是显性参数。\n\n问题陈述了正向扩散与向后时间ASG之间的基础对偶原理：漂移项$m(x)$中形式为$c_r x^r(1-x)$的多项式分量对应一个向后时间事件，该事件对$r$个祖先世系进行抽样，并且该事件对每组无序$r$元组世系以速率$c_r$发生。为了求得分支的总速率，我们必须首先将漂移多项式$m(x)$分解为多项式基$\\{x^r(1-x)\\}_{r \\in \\mathbb{N}}$。\n\n展开$m(x)$的表达式：\n$$m(x) = \\sigma \\big( hx(1-x) + (1-2h)x^2(1-x) \\big)$$\n这个分解揭示了两个不同的多项式分量：\n$$m(x) = h\\sigma \\cdot x(1-x) + (1-2h)\\sigma \\cdot x^2(1-x)$$\n\n我们分别分析每个分量，以确定在具有$k$个祖先世系的ASG中相应的事件类型及其速率。\n\n1.  第一个分量是$h\\sigma \\cdot x(1-x)$。这对应于$r=1$的情况。系数为$c_1 = h\\sigma$。根据对偶原理，这会产生选择单个祖先世系的事件（$r=1$）。对于每组无序1元组世系，此类事件的速率为$c_1$。从$k$个世系集合中选择一个无序1元组世系的方法数是$\\binom{k}{1} = k$。\n    因此，这些“一元”分支事件的总速率$R_1(k)$为：\n    $$R_1(k) = c_1 \\binom{k}{1} = h\\sigma k$$\n\n2.  第二个分量是$(1-2h)\\sigma \\cdot x^2(1-x)$。这对应于$r=2$的情况。系数为$c_2 = (1-2h)\\sigma$。这会产生选择一对祖先世系的事件（$r=2$）。对于每组无序2元组世系，此类事件的速率为$c_2$。从$k$个世系集合中选择一个无序2元组世系的方法数是$\\binom{k}{2} = \\frac{k(k-1)}{2}$。\n    因此，这些“二元”分支事件的总速率$R_2(k)$为：\n    $$R_2(k) = c_2 \\binom{k}{2} = (1-2h)\\sigma \\frac{k(k-1)}{2}$$\n    问题要求的是由选择引起的分支的总瞬时速率。这是从漂移项推导出的所有类型分支事件的速率之和。设此总速率为$R(k)$。\n    $$R(k) = R_1(k) + R_2(k)$$\n    $$R(k) = h\\sigma k + (1-2h)\\sigma \\frac{k(k-1)}{2}$$\n\n为了得到简化的闭式表达式，我们合并这些项：\n$$R(k) = \\sigma \\left( hk + (1-2h)\\frac{k^2-k}{2} \\right)$$\n$$R(k) = \\frac{\\sigma}{2} \\left( 2hk + (1-2h)(k^2-k) \\right)$$\n$$R(k) = \\frac{\\sigma}{2} \\left( 2hk + k^2 - k - 2hk^2 + 2hk \\right)$$\n按$k$的幂次合并项：\n$$R(k) = \\frac{\\sigma}{2} \\left( (1-2h)k^2 + (4h-1)k \\right)$$\n\n这个表达式表示当存在$k$个共存的祖先世系时，在祖先选择图中由选择驱动的分支事件发生的总速率。它正确地包含了来自基因选择效应（与$k$成正比）和显性效应（与$k^2$成正比）的速率。",
            "answer": "$$\\boxed{\\frac{\\sigma}{2} \\left( (1-2h)k^2 + (4h-1)k \\right)}$$"
        },
        {
            "introduction": "真实的演化过程很少只在单个位点上独立发生，连锁和重组是塑造基因组变异的关键因素。本练习将基础的 ASG 模型扩展到包含重组的祖先重组-选择图 (ARSG)。通过从第一性原理出发，你将推导在后向时间中由重组事件导致的谱系分裂速率，这对于理解选择如何与连锁的遗传背景相互作用至关重要 。",
            "id": "2756063",
            "problem": "考虑一个普查规模恒定为$N$的泛交二倍体Wright–Fisher群体，该群体在两个连锁的基因座上演化：一个 biallelic 的受选择基因座$\\mathcal{S}$，其基因选择系数为$s$；以及一个 biallelic 的中性基因座$\\mathcal{L}$。$\\mathcal{S}$和$\\mathcal{L}$之间每代（每次减数分裂）的重组分数为$r$，其中$0<r<\\tfrac{1}{2}$。时间将以$2N$代为单位的溯祖单位来衡量。在标准的扩散极限下进行分析，即当$N \\to \\infty$，$s \\to 0$，$r \\to 0$时，$Ns$和$Nr$为有限值。其祖先过程由祖先重组选择图（ARSG）表示，该图结合了当时间回溯时由选择所引起的分支结构，以及由重组所引起的祖先物质的分裂。\n\n从Wright–Fisher繁殖机制和减数分裂中重组的定义出发，根据第一性原理推导：当过程回溯时间，且时间以溯祖单位标度时，一个同时携带基因座$\\mathcal{S}$和$\\mathcal{L}$祖先物质的单一祖先世系，因重组而分裂成两个世系的瞬时速率（风险率）。您的推导必须明确论证在扩散标度下从离散世代到连续时间的过渡，并且不得假设任何已有的带重组的溯祖速率公式。请用$N$和$r$表示您的最终速率。\n\n此外，请使用ARSG的构建方法，简要解释重组事件如何与选择诱导的分支事件相互作用，从而塑造沿染色体的局部谱系镶嵌模式。该解释不计入数值结果，数值结果必须以单一闭式解析表达式给出。请提供以溯祖时间单位表示的、每个世系由重组引起的分裂速率的最终表达式。无需四舍五入，最终表达式中不应包含单位。",
            "solution": "问题要求推导一个携带两个连锁基因座$\\mathcal{S}$和$\\mathcal{L}$遗传物质的单一祖先世系，因重组而分裂成两个独立世系的瞬时速率。推导必须基于Wright-Fisher模型的第一性原理，并且速率必须以溯祖时间单位表示。\n\n首先，我们验证问题陈述的有效性。\n该问题设定在理论群体遗传学的标准框架内，使用了二倍体Wright-Fisher模型、溯祖理论和祖先重组选择图（ARSG）。所有参数（$N$、$s$、$r$）和概念（泛交、基因选择、重组、扩散极限、溯祖时间）在该领域都是明确且标准的。问题具体、客观且有科学依据。它要求在一个形式化模型内进行数学推导，这是一个定义明确的问题。其中没有矛盾、歧义或事实错误。因此，该问题被认定为**有效的**。\n\n我们现在从第一性原理开始推导。\n\n让我们考虑时间逐代回溯的过程。我们正在追踪在$t$代的一个单一祖先世系，它代表一个包含受选择基因座$\\mathcal{S}$和中性基因座$\\mathcal{L}$的染色体片段。这个染色体片段是从$t-1$代的一个亲本那里遗传下来的。\n\n这个亲本是一个二倍体生物，有两条同源染色体。将该祖先片段传递给$t$代子代的配子，是在这个亲本的减数分裂过程中产生的。重组分数$r$被定义为在减数分裂期间产生的配子相对于这两个基因座是重组类型的概率。也就是说，对于一次给定的减数分裂，一个配子携带的染色体在$\\mathcal{S}$和$\\mathcal{L}$基因座上同时含有来自亲本两条同源染色体的遗传物质的概率为$r$。\n\n当我们将世系从第$t$代回溯到第$t-1$代时，我们实质上是在追溯形成它的配子的来源。\n对于$\\mathcal{S}$和$\\mathcal{L}$基因座的祖先物质，有两种可能性：\n1.  **无重组：** 以$1-r$的概率，该配子是非重组的。在这种情况下，包含$\\mathcal{S}$和$\\mathcal{L}$的整个片段是从亲本两条同源染色体中的一条遗传下来的。回溯来看，在$t$代的单一祖先世系在$t-1$代仍然是一个单一祖先世系。\n2.  **重组：** 以$r$的概率，该配子是重组的。这意味着在减数分裂期间，基因座$\\mathcal{S}$和$\\mathcal{L}$之间发生了交换事件。结果是，配子染色体上$\\mathcal{S}$基因座的等位基因来自亲本的一条同源染色体，而$\\mathcal{L}$基因座的等位基因来自另一条。回溯来看，我们在$t$代的单一世系在$t-1$代有两个不同的亲本来源：一个用于$\\mathcal{S}$基因座，一个用于$\\mathcal{L}$基因座。因此，该世系分裂成两个。\n\n因此，一个携带两个基因座的单一世系，在单个回溯世代步骤中因重组而分裂的概率恰好是$r$。我们称这个概率为$P_{\\text{split, gen}} = r$。\n\n问题要求的是以溯祖单位度量的连续时间中的瞬时速率。从离散世代过程到连续时间过程的过渡是通过指定的扩散极限实现的，其中$N \\to \\infty$和$r \\to 0$，$Nr$的乘积保持有限。\n\n在此极限下，任何单个世代中发生分裂的概率$r$都非常小。世系分裂的过程可以被模型化为一个泊松过程。设$R_{\\text{split}}$为以溯祖时间单位计的瞬时分裂速率。一个溯祖时间单位对应于一个大小为$N$的二倍体群体中的$2N$个世代。\n\n为了找到连续时间速率，我们考虑在一个小时间间隔内发生事件的概率。设$\\Delta \\tau$为一个小的连续溯祖时间间隔。这对应于$\\Delta t = (2N)\\Delta \\tau$个世代。由于$r$很小，在这个短时间间隔内发生多于一次分裂事件的概率可以忽略不计（数量级为$r^2$或更小），而至少发生一次分裂的概率约等于世代数乘以每代的概率：\n$$ P(\\text{在}\\Delta \\tau\\text{内分裂}) \\approx \\Delta t \\times P_{\\text{split, gen}} = (2N \\Delta \\tau) \\times r $$\n瞬时速率$R_{\\text{split}}$定义为单位时间内事件概率在时间间隔趋于零时的极限：\n$$ R_{\\text{split}} = \\lim_{\\Delta \\tau \\to 0} \\frac{P(\\text{在}\\Delta \\tau\\text{内分裂})}{\\Delta \\tau} $$\n代入我们对概率的表达式：\n$$ R_{\\text{split}} = \\lim_{\\Delta \\tau \\to 0} \\frac{(2N \\Delta \\tau) r}{\\Delta \\tau} = 2Nr $$\n这个推导的正式性由二项过程向泊松过程的收敛性所保证。一个世系在$\\tau$个溯祖单位（即$t=2N\\tau$个世代）内的分裂次数服从二项分布$B(t,r)$。当$N \\to \\infty$且$r = \\frac{R_{\\text{split}}}{2N}$时，世代数$t = 2N\\tau \\to \\infty$且概率$r \\to 0$。事件的期望次数为$t \\times r = (2N\\tau) \\times \\frac{R_{\\text{split}}}{2N} = R_{\\text{split}}\\tau$。当$n \\to \\infty$，$p_n \\to 0$，且$np_n \\to \\lambda$时，一系列二项分布$B(n, p_n)$收敛于均值为$\\lambda$的泊松分布。在我们的情况下，这意味着在一个时间间隔$\\tau$内的分裂次数服从均值为$R_{\\text{split}}\\tau$的泊松分布。这对应于一个常数速率为$R_{\\text{split}} = 2Nr$的泊松过程。保持$Nr$为有限的扩散标度确保了这个速率是一个定义明确的有限常数。\n\n最后，我们简要解释在ARSG中重组与选择的相互作用。\n祖先重组选择图（ARSG）是一个描述样本完整祖先史的结构，包括溯祖合并、突变、重组和选择诱导的分支事件。\n- **重组事件**（对所讨论的基因座，每个世系的发生速率为$2Nr$）导致祖先世系分裂。这使得染色体的不同片段可以有不同的谱系历史。因此，基因座$\\mathcal{L}$的谱系可以与基因座$\\mathcal{S}$的谱系解耦。\n- **选择诱导的分支事件**（对于一个有利等位基因，发生速率与选择系数成正比，为$2Ns$）导致携带受选择等位基因的世系在回溯时间时分支成多个后代世系。这导致携带该有利等位基因的世系快速溯祖合并，这种现象被称为选择性清除，它极大地缩短了受选择基因座周围区域到达最近共同祖先的时间（TMRCA）。\n\n这两种过程之间的**相互作用**塑造了局部谱系的“镶嵌”模式。靠近受选择基因座$\\mathcal{S}$（小的$r$）的地方，相对于选择和溯祖合并，重组不频繁。因此，附近中性基因座$\\mathcal{L}$的谱系很可能受到$\\mathcal{S}$处选择性清除的严重影响，表现出同样缩短的TMRCA和较低的遗传多样性。离$\\mathcal{S}$较远（较大的$r$）的地方，重组在样本的历史中更可能已发生。一个重组事件可以将$\\mathcal{L}$基因座的祖先转移到一个不受选择影响的不同遗传背景上。这个“逃逸”的世系随后按照标准的中性溯祖过程演化，不受$\\mathcal{S}$处清除事件的干扰。因此，一个遥远基因座$\\mathcal{L}$的局部谱系将更像一个具有更古老TMRCA的中性谱系。因此，重组打破了遗传“搭便车”效应，而这种打破的尺度由重组率与选择强度的比率决定。",
            "answer": "$$\\boxed{2Nr}$$"
        },
        {
            "introduction": "祖先选择图描绘的是一个包含了所有“潜在”祖先的复杂结构。为了得到样本的“真实”谱系树，我们必须根据等位基因类型来裁决分枝事件，并“修剪”掉非祖先的支系。本练习是一个计算实践，它要求你设计并实现这一关键的修剪算法，将抽象的图结构转化为具体的谱系，这是在任何基于 ASG 的模拟或推断研究中都不可或缺的一步 。",
            "id": "2756026",
            "problem": "您的任务是，在一个带选择的双类型单倍体模型中，为祖先选择图（Ancestral Selection Graph, ASG）形式化并实现一个剪枝算法。ASG 是一个时间回溯的分支-合并过程，它编码了潜在的祖先，其中分支事件对应于选择性繁殖。为了获得样本的实现世系，必须通过在图上分配类型并剪除非祖先分支，将潜在祖先解析为实际祖先。\n\n基本原理：\n- 种群由两种类型组成，编码为 $\\{0,1\\}$，其中类型 $1$ 相比类型 $0$ 具有选择优势。\n- 在 ASG 中，当时间回溯时，谱系会经历合并事件（二元合并）和分支事件（分裂成两个潜在的亲本：一个连续谱系和一个传入谱系）。\n- 分支事件中的实现祖先由一个基于事件发生时类型的确定性规则决定：如果至少有一个潜在亲本是优势类型 $1$，则优势类型成为祖先；如果类型相同，则连续谱系成为祖先。如果两者都是类型 $0$，则连续谱系成为祖先。\n\n您的程序必须实现以下算法问题。\n\n使用的输入和定义：\n- 在回溯时间 $t=0$ 时，样本大小为 $n$，谱系被标记为 $\\{0,1,\\dots,n-1\\}$，每个谱系 $i \\in \\{0,\\dots,n-1\\}$ 具有初始类型 $\\tau_i \\in \\{0,1\\}$。\n- 一个事件列表，按回溯时间（实数）的非递减顺序严格排序，如果两个事件时间相同，则必须按所给顺序处理。每个事件是以下之一：\n  - 合并：$\\texttt{['coal', t, i, j, k]}$，表示在时间 $t$，标识符为 $i$ 和 $j$ 的两个活跃谱系合并成一个标识符为 $k$ 的新谱系。\n  - 分支：$\\texttt{['branch', t, child, c, inc, type\\_c, type\\_inc]}$，表示在时间 $t$，标识符为 $child$ 的活跃谱系被两个潜在亲本替代：一个标识符为 $c$、类型为 $\\tau_c = \\texttt{type\\_c} \\in \\{0,1\\}$ 的连续谱系，以及一个标识符为 $inc$、类型为 $\\tau_{inc} = \\texttt{type\\_inc} \\in \\{0,1\\}$ 的传入谱系。在此事件时间，立即通过确定性规则选择实现祖先：如果 $\\tau_c \\ge \\tau_{inc}$，则祖先是 $c$，否则祖先是 $inc$。非祖先分支在此时从活跃谱系集合中被剪除。\n  - 突变：$\\texttt{['mut', t, i, new\\_type]}$，表示在时间 $t$，标识符为 $i$ 的活跃谱系其类型瞬间变为 $\\texttt{new\\_type} \\in \\{0,1\\}$。突变会影响未来的事件，但不会追溯性地改变已经做出的过去解析。\n- 活跃谱系集合随着时间的增加逐个事件更新。合并事件总是贡献两条实现世系边 $(k \\to i)$ 和 $(k \\to j)$。分支事件贡献一条实现世系边 $(\\text{chosen\\_parent} \\to child)$ 并立即剪除未被选择的亲本。\n\n您的任务：\n1. 设计并实现一个剪枝算法，该算法在给定 $(n,\\{\\tau_i\\}_{i=0}^{n-1})$ 和事件列表的情况下，生成实现世系。该世系表示为一个有向边列表，每条边表示为 $[parent, child]$ 整数对。算法必须按顺序处理事件，维护活跃谱系集合及其当前类型，在每次分支时应用确定性祖先规则，并相应地记录实现世系边。最后，返回按子代升序、然后按亲代升序进行字典序排序的实现世系边列表。\n2. 根据 $n$（样本大小）和 $m$（事件数量）对您的算法进行复杂度分析。您的分析应以大O表示法说明作为 $n$ 和 $m$ 函数的时间复杂度和空间复杂度。\n\n测试套件：\n实现您的程序，使其能在以下四种情况下运行。对于每种情况，程序必须构建实现世系，并按规定格式输出排序后的边列表。\n\n- 情况 A：\n  - 初始样本：$n = 3$，初始类型 $(\\tau_0,\\tau_1,\\tau_2) = (0,0,1)$。\n  - 事件（按顺序）：\n    - $\\texttt{['coal', 1.0, 0, 1, 3]}$。\n    - $\\texttt{['coal', 2.0, 2, 3, 4]}$。\n\n- 情况 B：\n  - 初始样本：$n = 1$，初始类型 $(\\tau_0) = (0)$。\n  - 事件（按顺序）：\n    - $\\texttt{['branch', 0.5, 0, 1, 2, 0, 1]}$。\n\n- 情况 C：\n  - 初始样本：$n = 1$，初始类型 $(\\tau_0) = (1)$。\n  - 事件（按顺序）：\n    - $\\texttt{['branch', 0.3, 0, 1, 2, 1, 1]}$。\n\n- 情况 D：\n  - 初始样本：$n = 2$，初始类型 $(\\tau_0,\\tau_1) = (0,1)$。\n  - 事件（按顺序）：\n    - $\\texttt{['branch', 0.2, 0, 2, 3, 0, 1]}$。\n    - $\\texttt{['branch', 0.4, 1, 4, 5, 1, 0]}$。\n    - $\\texttt{['mut', 0.5, 3, 0]}$。\n    - $\\texttt{['coal', 0.9, 3, 4, 6]}$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含四个情况的结果，结果是一个用方括号括起来的逗号分隔列表。每个情况的输出本身是一个实现世系边列表，每条边是一个双元素列表 $[parent, child]$。在每个情况内部，边必须按子代升序、然后按亲代升序排序。例如，包含两个情况的输出看起来像 $\\texttt{[[[p\\_1,c\\_1],[p\\_2,c\\_2]],[[p\\_3,c\\_3]]]}$。\n\n答案类型：\n- 对每个情况，结果是一个整数列表的列表。总输出是这些列表的列表。\n\n您的实现必须是完全确定性的，并且不得使用任何随机性。不涉及物理单位。不涉及角度。不涉及百分比。",
            "solution": "经评估，问题陈述是有效的。它在科学上基于祖先选择图（ASG）理论，问题定义良好，具有清晰、确定性的规则集，并且完全客观。解决问题所需的所有必要信息均已提供。因此，我们可以着手进行正式求解。\n\n任务是为 ASG 实现一个剪枝算法，以确定样本的实现世系。该算法必须模拟 ASG 在时间上的回溯演化，处理一系列离散事件——合并、分支和突变——并应用确定性规则来解析选择性分支事件。\n\n为实现此目标，设计了一个事件驱动的模拟算法。系统的状态在每一步都得到维护，并根据正在处理的事件进行更新。核心状态变量是：\n1. 活跃谱系集合，记为 $A$。如果一个谱系是初始样本的潜在祖先，并且尚未合并或被剪除，则该谱系是“活跃的”。\n2. 谱系类型映射，记为 $\\tau$。此映射为每个已定义类型的谱系存储其类型，类型为 $0$ 或 $1$。类型 $1$ 具有选择优势。\n3. 实现世系边列表，记为 $E$。每条边是一个有向对 $[p, c]$，表示谱系 $p$ 是谱系 $c$ 的亲代。\n\n模拟过程如下：\n\n**步骤 1：初始化**\n在回溯时间 $t=0$ 时，系统根据大小为 $n$ 的样本进行初始化。\n- 活跃谱系集合初始化为样本个体集合：$A = \\{0, 1, \\dots, n-1\\}$。\n- 谱系类型映射 $\\tau$ 用样本个体的初始类型填充：对于每个 $i \\in \\{0, 1, \\dots, n-1\\}$，$\\tau[i] = \\tau_i$。\n- 边列表 $E$ 初始化为空列表。\n\n**步骤 2：事件处理循环**\n算法遍历有序的事件列表。对于每个事件，根据事件类型更新状态变量（$A$、$\\tau$、$E$）。\n\n- **合并事件: `['coal', t, i, j, k]`**\n  在时间 $t$，两个活跃谱系 $i$ 和 $j$ 合并成一个单一的祖先谱系 $k$。\n  1. 谱系 $i$ 和 $j$ 不再活跃。它们从集合 $A$ 中移除：$A \\leftarrow A \\setminus \\{i, j\\}$。\n  2. 新的祖先谱系 $k$ 变为活跃状态。它被添加到集合 $A$ 中：$A \\leftarrow A \\cup \\{k\\}$。\n  3. 代表此次合并的两条边被添加到世系中：$E \\leftarrow E \\cup \\{[k, i], [k, j]\\}$。\n  问题陈述不要求为新谱系 $k$ 分配类型，因为所提供的测试用例表明，这类谱系不会作为“子代”谱系参与后续依赖类型的分支事件。\n\n- **分支事件: `['branch', t, child, c, inc, type_c, type_inc]`**\n  在时间 $t$，一个活跃谱系 `child` 被发现源于一个选择性事件，从而产生两个潜在的祖先：一个类型为 $\\tau_c = \\texttt{type\\_c}$ 的连续谱系 $c$ 和一个类型为 $\\tau_{inc} = \\texttt{type\\_inc}$ 的传入谱系 $inc$。\n  1. 谱系 `child` 从活跃集合中移除：$A \\leftarrow A \\setminus \\{\\text{child}\\}$。\n  2. 实现祖先由确定性规则决定：如果 $\\tau_c \\ge \\tau_{inc}$，则祖先是谱系 $c$，否则是谱系 $inc$。\n  3. 设被选中的谱系为 $\\text{parent}_{\\text{chosen}}$，其类型为 $\\tau_{\\text{chosen}}$。\n  4. 一条从被选中的亲本到子代的边被添加到世系中：$E \\leftarrow E \\cup \\{[\\text{parent}_{\\text{chosen}}, \\text{child}]\\}$。\n  5. 被选中的亲本成为一个活跃谱系：$A \\leftarrow A \\cup \\{\\text{parent}_{\\text{chosen}}\\}$。\n  6. 新活跃谱系的类型被记录下来以备未来事件使用：$\\tau[\\text{parent}_{\\text{chosen}}] \\leftarrow \\tau_{\\text{chosen}}$。非祖先分支被剪除，永不进入活跃谱系集合。\n\n- **突变事件: `['mut', t, i, new_type]`**\n  在时间 $t$，一个活跃谱系 $i$ 发生突变，改变其类型。\n  1. 映射 $\\tau$ 中谱系 $i$ 的类型被更新为 $\\texttt{new\\_type}$：$\\tau[i] \\leftarrow \\texttt{new\\_type}$。\n  这一变化会影响任何涉及谱系 $i$ 或其后代的后续分支事件的解析，但不会改变在更早时间已经发生的解析。\n\n**步骤 3：最终化**\n处理完列表中的所有事件后，边列表 $E$ 代表了完整的实现世系。\n- 列表 $E$ 按字典序排序。主排序键是子代标识符（对中的第二个元素），次排序键是亲代标识符（第一个元素）。\n\n**复杂度分析**\n设 $n$ 为初始样本大小，$m$ 为输入列表中的事件总数。\n\n- **时间复杂度：**\n  - 初始化：填充活跃谱系集合 $A$ 和类型映射 $\\tau$ 需要 $O(n)$ 时间。\n  - 事件处理：模拟过程包括对 $m$ 个事件的单次循环。对于每个事件，操作涉及在基于哈希的数据结构（用于 $A$ 的哈希集和用于 $\\tau$ 的哈希映射）上进行查找、插入和删除，平均情况下需要 $O(1)$ 时间。因此，处理所有事件需要 $O(m)$ 时间。\n  - 最终化：$E$ 中的边数最多为 $2m$（每次合并两条，每次分支一条）。对这个边列表进行排序需要 $O(m \\log m)$ 时间。\n  - 总时间复杂度由初始化设置和最终排序主导，得出 $O(n + m \\log m)$。\n\n- **空间复杂度：**\n  - 活跃谱系集合 $A$ 的最大大小为 $n$。其空间为 $O(n)$。\n  - 类型映射 $\\tau$ 为每个创建的不同谱系标识符存储一个条目。这类谱系的数量上限为 $n$ 加上来自合并的新谱系（每个事件 1 个）和分支的新谱系（每个事件 2 个），总计为 $O(n+m)$ 个谱系。因此，$\\tau$ 的空间复杂度为 $O(n+m)$。\n  - 边列表 $E$ 存储 $O(m)$ 条边。其空间为 $O(m)$。\n  - 总空间复杂度是这些部分的总和，即 $O(n+m)$。",
            "answer": "```\n[[[3,0],[3,1],[4,2],[4,3]],[[2,0]],[[1,0]],[[3,0],[4,1],[6,3],[6,4]]]\n```"
        }
    ]
}