{
    "hands_on_practices": [
        {
            "introduction": "多物种溯祖（MSC）模型的核心是在物种树的每个分支内发生的中性溯祖过程。本练习将让你从基本原理出发，即两个谱系在任何一代中合并的概率，通过模拟这一过程来加深你的直观理解。通过亲手实现溯祖模拟，你将能更好地掌握基因谱系是如何在时间长河中随机形成的。",
            "id": "2726286",
            "problem": "你的任务是在经典的恒定大小 Wright–Fisher 模型下，为一个大小为 $n=5$ 的样本，在恒定的二倍体有效种群大小 $N_e$ 条件下，实现一个中性溯祖谱系的模拟。该模拟代表了多物种溯祖 (MSC) 框架所假设的分支内过程，MSC 是用于研究不完全谱系分选的标准模型。你的程序必须通过从第一性原理正确推导出当存在 $k$ 个祖先谱系（$k$ 从 5 递减到 2）时的等待时间分布，来模拟溯祖间隔。该模拟需在两种可能的时间尺度下进行：代，以及按 $2N_e$ 缩放的溯祖时间单位。你的推导必须仅基于核心定义和经过充分检验的事实：在恒定大小的二倍体种群中溯祖过程的定义、中性条件下的每对谱系溯祖率，以及独立指数等待时间最小值的分布特性。在推导过程中，请勿使用任何预设或简化的公式。\n\n你的程序必须：\n- 为 $n=5$ 的样本，在恒定 $N_e$ 条件下，实现一个通用的溯祖间隔模拟器，其中 $k$ 从 5 递减到 2。\n- 支持两种时间单位选项：\n  - $u=\\text{\"gen\"}$：以代为单位计算时间。\n  - $u=\\text{\"coal\"}$：以溯祖单位计算时间，其中一个溯祖单位等于 $2N_e$ 代。\n- 使用指定的伪随机种子以确保可复现性。\n- 对于每个测试用例，返回一个包含 4 个浮点数的列表，对应于以所请求单位 $u$ 表示的模拟溯祖间隔 $(T_5,T_4,T_3,T_2)$。\n\n在推导和实现中必须满足的科学和数学要求：\n- 从以下基础出发：\n  - 在一个恒定大小的二倍体 Wright–Fisher 种群中，每一对无序祖先谱系都以一个由 $N_e$ 决定的恒定速率（每代）发生溯祖。\n  - 当存在 $k$ 个谱系时，共有 $\\binom{k}{2}$ 对无序谱系对。\n  - 独立指数等待时间的最小值服从指数分布，且哪个事件最先发生与该最小值的大小无关。\n- 以此为基础，推导出当存在 $k$ 个谱系时每个溯祖间隔 $T_k$ 的分布。明确指出以代和以溯祖单位计的速率参数，并阐明这些单位之间的换算关系。根据你推导的分布，给出每种尺度下 $T_k$ 的期望值。\n- 将你的推导转化为一个正确的模拟算法，该算法使用为所选单位 $u$ 选择的适当速率来为 $k=5,4,3,2$ 抽样 $T_k$。\n- 通过将所有参数保持在合理的生物学范围内并遵循中性溯祖假设，来确保科学真实性。\n\n测试套件：\n你的程序必须在内部按所列顺序运行以下测试用例（不要请求用户输入），并将结果汇总到如下指定的单个输出行中。每个测试用例是一个元组 $(n,N_e,u,\\text{seed})$，其中所有用例的 $n=5$：\n- 用例 1： $(5,\\,10000,\\,\\text{\"coal\"},\\,12345)$。\n- 用例 2： $(5,\\,50000,\\,\\text{\"gen\"},\\,20231102)$。\n- 用例 3： $(5,\\,500,\\,\\text{\"gen\"},\\,42)$。\n- 用例 4： $(5,\\,10000,\\,\\text{\"gen\"},\\,0)$。\n\n单位：\n- 当 $u=\\text{\"gen\"}$ 时，以代为单位报告时间。\n- 当 $u=\\text{\"coal\"}$ 时，以溯祖单位报告时间，其中一个单位等于 $2N_e$ 代。\n\n答案类型和最终输出格式：\n- 对于每个测试用例，返回一个包含 4 个浮点数 $(T_5,T_4,T_3,T_2)$ 的列表。\n- 你的程序应产生单行输出，其中包含一个以逗号分隔的列表形式的结果，该列表被方括号括起，其中每个元素是对应一个测试用例的四个浮点数的列表。例如，一个有效的输出形状是：[[t51,t41,t31,t21],[t52,t42,t32,t22],[t53,t43,t33,t23],[t54,t44,t34,t24]]。\n- 浮点数可以以标准的未舍入形式打印。\n\n你的解决方案必须包括：\n- 从上述基础出发，对溯祖间隔分布进行的有原则的推导。\n- 清晰的算法步骤描述。\n- 执行模拟并为指定的测试套件生成所需单行输出的完整程序。",
            "solution": "该问题要求在中性 Wright-Fisher 模型下，针对一个大小为 $n=5$ 的谱系样本，在恒定的二倍体有效种群大小 $N_e$ 条件下，推导并模拟溯祖等待时间。推导必须从第一性原理出发，模拟必须是可复现的，并支持以代和溯祖单位两种时间单位。\n\n首先，我们应推导溯祖间隔时间 $T_k$ 的分布，即 $k$ 个祖先谱系中任意两个发生溯祖的等待时间。\n\n基本假设如下：\n$1$. 我们考虑一个由 $N_e$ 个个体组成的恒定大小二倍体种群，这对应于每一代中有 $2N_e$ 个基因拷贝。\n$2$. 我们向后追溯一个 $k$ 谱系样本的祖先。\n$3$. 在中性 Wright-Fisher 模型下，第 $t+1$ 代中的每个谱系都从第 $t$ 代的 $2N_e$ 个基因拷贝中一致随机地选择其亲本。\n\n考虑两个特定的谱系。它们在前一代中选择同一个亲本基因拷贝的概率是 $1/(2N_e)$。它们不选择同一个亲本的概率是 $1 - 1/(2N_e)$。因此，溯祖事件是每一代中的一个伯努利试验。直到第一次成功（溯祖）的时间服从成功概率为 $p = 1/(2N_e)$ 的几何分布。对于较大的有效种群大小 $N_e$（这是溯祖理论中的一个标准假设），这个离散时间的几何过程可以很好地被一个连续时间的指数等待过程近似。这个指数过程的速率 $\\lambda_{\\text{pair}}$ 等于事件在单个时间步内发生的概率。因此，单对谱系的溯祖速率为：\n$$ \\lambda_{\\text{pair}} = \\frac{1}{2N_e} \\text{ 每代} $$\n这对特定谱系发生溯祖的等待时间是一个服从此速率的指数随机变量。\n\n现在，考虑有 $k$ 个不同祖先谱系的情况。当这些谱系中的任何一对找到共同祖先时，就会发生溯祖事件。不同、无序的谱系对数量由二项式系数给出：\n$$ \\binom{k}{2} = \\frac{k(k-1)}{2} $$\n这 $\\binom{k}{2}$ 对中的每一对都代表了一个独立的溯祖事件机会。直到*下一个*溯祖事件发生的时间 $T_k$，是这 $\\binom{k}{2}$ 对中每一对等待时间的最小值。指数分布的一个基本性质指出，一组独立指数随机变量的最小值本身也是一个指数随机变量，其速率是个体速率之和。\n\n由于每对谱系以每代 $\\lambda_{\\text{pair}} = 1/(2N_e)$ 的速率发生溯祖，因此任意一对发生溯祖的总速率 $\\lambda_k$ 是所有谱系对速率的总和：\n$$ \\lambda_k^{\\text{gen}} = \\binom{k}{2} \\times \\lambda_{\\text{pair}} = \\frac{k(k-1)}{2} \\times \\frac{1}{2N_e} = \\frac{k(k-1)}{4N_e} \\text{ 每代} $$\n因此，以代为单位测量的溯祖间隔时间 $T_k$ 是一个速率为 $\\lambda_k^{\\text{gen}}$ 的指数随机变量：\n$$ T_k(\\text{gen}) \\sim \\text{Exp}\\left(\\frac{k(k-1)}{4N_e}\\right) $$\n以代为单位的期望等待时间是速率的倒数：\n$$ E[T_k(\\text{gen})] = \\frac{1}{\\lambda_k^{\\text{gen}}} = \\frac{4N_e}{k(k-1)} $$\n\n接下来，我们推导以溯祖时间单位计的分布。一个溯祖时间单位定义为 $2N_e$ 代。设 $t_{\\text{gen}}$ 是以代为单位的时间， $t_{\\text{coal}}$ 是以溯祖单位的时间。它们的关系是：\n$$ t_{\\text{coal}} = \\frac{t_{\\text{gen}}}{2N_e} $$\n如果一个随机变量 $X$ 服从速率为 $\\lambda$ 的指数分布，那么经过缩放的随机变量 $Y = cX$ 服从速率为 $\\lambda/c$ 的指数分布。为了将速率从代转换为溯祖单位，我们使用缩放因子 $c = 1/(2N_e)$。新的速率 $\\lambda_k^{\\text{coal}}$ 是：\n$$ \\lambda_k^{\\text{coal}} = \\lambda_k^{\\text{gen}} \\times (2N_e) = \\left(\\frac{k(k-1)}{4N_e}\\right) \\times (2N_e) = \\frac{k(k-1)}{2} = \\binom{k}{2} $$\n因此，当时间以溯祖单位测量时，溯祖间隔时间 $T_k$ 服从一个与种群大小无关的速率的指数分布：\n$$ T_k(\\text{coal}) \\sim \\text{Exp}\\left(\\binom{k}{2}\\right) $$\n以溯祖单位计的期望等待时间是：\n$$ E[T_k(\\text{coal})] = \\frac{1}{\\lambda_k^{\\text{coal}}} = \\frac{1}{\\binom{k}{2}} = \\frac{2}{k(k-1)} $$\n\n模拟算法流程如下。对于由 $(n, N_e, u, \\text{seed})$ 指定的每个测试用例：\n$1$. 使用提供的 `seed` 初始化伪随机数生成器，以确保可复现性。\n$2$. 模拟按时间向后迭代，从 $k=n$ 递减到 $k=2$。对于本问题， $n=5$，因此循环对 $k \\in \\{5, 4, 3, 2\\}$ 运行。\n$3$. 在每次迭代 $k$ 中，根据指定的时间单位 $u$ 计算速率参数 $\\lambda_k$：\n    - 如果 $u = \\text{\"gen\"}$，速率为 $\\lambda_k^{\\text{gen}} = \\frac{k(k-1)}{4N_e}$。\n    - 如果 $u = \\text{\"coal\"}$，速率为 $\\lambda_k^{\\text{coal}} = \\binom{k}{2} = \\frac{k(k-1)}{2}$。\n$4$. 从具有计算出的速率 $\\lambda_k$ 的指数分布中抽取一个随机变量 $T_k$。这可以通过逆变换采样法实现，即对于一个均匀随机变量 $U \\sim \\text{Uniform(0,1)}$，$T_k = -\\ln(U) / \\lambda_k$。在实践中，我们使用一个实现此方法的库函数，例如 `numpy.random.exponential`，它接受一个尺度参数 $\\beta = 1/\\lambda_k$。\n$5$. 存储模拟出的时间 $T_k$。循环完成后，结果是一个包含四个时间间隔的列表：$(T_5, T_4, T_3, T_2)$。\n$6$. 对所有测试用例重复此过程，并将结果汇总成一个格式化的输出字符串。",
            "answer": "```python\nimport numpy as np\n\ndef simulate_coalescent_intervals(n, Ne, unit, seed):\n    \"\"\"\n    Simulates intercoalescent intervals for a sample of size n.\n\n    Args:\n        n (int): The initial sample size.\n        Ne (int): The diploid effective population size.\n        unit (str): The time unit, either \"gen\" (generations) or \"coal\" (coalescent units).\n        seed (int): The seed for the pseudorandom number generator.\n\n    Returns:\n        list[float]: A list of simulated intercoalescent intervals [T_n, T_{n-1}, ..., T_2].\n    \"\"\"\n    # 1. Initialize the pseudorandom number generator with the given seed.\n    rng = np.random.default_rng(seed)\n    \n    intervals = []\n    \n    # 2. Loop for k from n down to 2.\n    for k in range(n, 1, -1):\n        # 3. Calculate the rate parameter lambda_k.\n        num_pairs = k * (k - 1) / 2\n        \n        if unit == \"gen\":\n            # For time in generations, the rate is k(k-1) / (4*Ne).\n            if Ne <= 0:\n                raise ValueError(\"Effective population size Ne must be positive.\")\n            rate = num_pairs / (2 * Ne)\n        elif unit == \"coal\":\n            # For time in coalescent units, the rate is kC2.\n            rate = num_pairs\n        else:\n            raise ValueError(\"Unit must be 'gen' or 'coal'.\")\n            \n        # The scale parameter for numpy's exponential is 1/rate.\n        scale = 1.0 / rate\n        \n        # 4. Draw a random variate from the exponential distribution.\n        t_k = rng.exponential(scale)\n        \n        # 5. Store the simulated time.\n        intervals.append(t_k)\n        \n    return intervals\n\ndef solve():\n    \"\"\"\n    Runs the simulation for a predefined set of test cases and prints the results.\n    \"\"\"\n    # Define the test suite as specified in the problem statement.\n    # Each case is a tuple: (n, Ne, unit, seed)\n    test_cases = [\n        (5, 10000, \"coal\", 12345),\n        (5, 50000, \"gen\", 20231102),\n        (5, 500, \"gen\", 42),\n        (5, 10000, \"gen\", 0)\n    ]\n\n    # Aggregate results from all test cases.\n    all_results = []\n    for n, Ne, unit, seed in test_cases:\n        result = simulate_coalescent_intervals(n, Ne, unit, seed)\n        all_results.append(result)\n\n    # Format the final output string as per the problem requirements.\n    # The format is [[t51,t41,t31,t21],[t52,t42,t32,t22],...].\n    # str() on a list of lists creates spaces, which must be removed.\n    final_output = str(all_results).replace(\" \", \"\")\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了溯祖过程的随机性之后，我们可以探索其最著名的后果：不完全谱系分选（ILS），它导致基因树拓扑与物种树拓扑不一致。本练习将这一抽象概念具体化，首先要求你构建一个展示这种不一致性的数据集，然后推导在特定物种分化时间 $T$ 下发生这种情况的精确概率。这个过程将理论与可观测的数据直接联系起来。",
            "id": "2726274",
            "problem": "考虑一个包含三个物种 $A$、$B$ 和 $C$ 的有根物种树，其物种树拓扑为 $(A,B)\\mid C$。假设每个物种抽样一个单倍体谱系，所有分支上的有效种群大小恒定且相等，位点内无重组，位点间自由重组。设将 $A$ 和 $B$ 的祖先种群与 $C$ 分开的内部分支长度为 $T$ 溯祖单位，其中时间已通过相应的有效种群大小进行了缩放，使得 $k$ 个谱系间的溯祖等待时间服从速率为 $\\binom{k}{2}$ 的指数分布。\n\n任务：\n1) 构建一个跨物种 $A$、$B$ 和 $C$ 的最小三位点数据集（每个位点一个短比对序列），使得当独立分析每个位点时，每个位点都支持三种可能拓扑 $(A,B)\\mid C$、$(A,C)\\mid B$ 和 $(B,C)\\mid A$ 中不同的一个有根基因树拓扑。您的数据集在标准突变模型（例如，无穷位点模型）下应是科学上合理的，并应通过指明支持每个位点推断出的基因树的简约性信息位点来证明其合理性。\n2) 使用多物种溯祖模型 (Multispecies Coalescent, MSC) 下的不完全谱系分流，从机理上解释一个内部分支长度为 $T$ 的单一潜在物种树 $(A,B)\\mid C$ 如何能在三个独立的位点上产生三种不同的有根基因树。\n3) 从溯祖理论的第一性原理（溯祖等待时间呈指数分布，以及当三个谱系存在于同一祖先种群中时配对间的对称性）出发，推导出一个闭式解析表达式，表示在3个独立位点上，观察到三种有根拓扑每种都恰好出现一次的概率。您的最终答案必须是一个只含 $T$ 的简化解析表达式，不带任何数值近似或单位。不要使用任何预先记下的快捷公式；请从上面给出的基本溯祖假设出发进行推导。",
            "solution": "我们首先在无穷位点模型下构建一个明确、合理的三位点数据集，该数据集在三个位点上产生三种不同的有根基因树。然后我们解释为什么在具有不完全谱系分流的多物种溯祖模型 (Multispecies Coalescent, MSC) 下，这种不一致性是预料之中的。最后，我们从第一性原理出发，推导出三个独立位点恰好一次性产生所有三种不同有根拓扑的概率，作为内部分支长度 $T$ （以溯祖单位计）的函数。\n\n步骤1：构建最小数据集。\n在无穷位点模型下，一个将衍生状态置于支撑一对分类单元分支上的双等位基因位点，为该分类单元对作为一个支系提供了简约性支持。对于三个分类单元，每个位点一个信息性双等位基因位点就足够了。因此，我们可以提出以下比对序列，其中 $0$ 表示祖先状态，$1$ 表示衍生状态：\n\n- 位点 $1$：$(A,B)\\mid C$\n  - 位点模式：$A=1,\\ B=1,\\ C=0$。这一个简约性信息位点支持 $(A,B)\\mid C$。\n\n- 位点 $2$：$(A,C)\\mid B$\n  - 位点模式：$A=1,\\ B=0,\\ C=1$。这支持 $(A,C)\\mid B$。\n\n- 位点 $3$：$(B,C)\\mid A$\n  - 位点模式：$A=0,\\ B=1,\\ C=1$。这支持 $(B,C)\\mid A$。\n\n每个位点都只有一个简约性信息位点，与三种可能的有根基因树之一相一致，并且三个位点共同实现了所有三种拓扑。\n\n步骤2：为什么在MSC下，不一致的基因树与单一物种树是一致的。\n考虑内部分支长度为 $T$ （以溯祖单位计）的物种树 $(A,B)\\mid C$。从 $A$、$B$ 和 $C$ 各抽样一个谱系。在 $A$ 和 $B$ 的祖先内部分支上，$A$ 和 $B$ 这两个谱系可以在到达 $A$、$B$ 和 $C$ 的共同祖先种群之前发生溯祖。如果 $A$ 和 $B$ 在此内部分支上发生溯祖，那么该位点的基因树必定是 $(A,B)\\mid C$。如果它们未在该内部分支上发生溯祖，那么 $A$、$B$ 和 $C$ 三个谱系将同时进入更深层的祖先种群；根据3个谱系溯祖的可交换性和对称性，第一个溯祖事件以 $1/3$ 的概率将任意一对组合在一起。因此，在内部分支上未能发生溯祖的条件下，三种拓扑 $(A,B)\\mid C$、$(A,C)\\mid B$ 和 $(B,C)\\mid A$ 各以 $1/3$ 的概率出现。所以，即使物种树是 $(A,B)\\mid C$，由于不完全谱系分流，不一致的基因树 $(A,C)\\mid B$ 和 $(B,C)\\mid A$ 仍会以非零概率出现，尤其是在 $T$ 很小时。\n\n步骤3：推导在三个位点上观察到所有三种拓扑的概率。\n我们仅使用基本的溯祖假设：\n\n- 在一个分支上，如果同一群体中存在 $k$ 个谱系，那么到下一次溯祖事件的等待时间服从速率为 $\\binom{k}{2}$ 的指数分布。\n- 如果三个谱系同时进入同一群体，由于可交换性，第一次溯祖事件以相等的概率 $1/3$ 将任意一对组合在一起。\n\n设 $T$ 为 $A$ 和 $B$ 的祖先内部分支（也是所有三个物种共同祖先的后代分支）的长度（以溯祖单位计）。\n\n对单个位点而言：\n- 谱系 $A$ 和 $B$ 在长度为 $T$ 的内部分支上不发生溯祖的概率是 $\\exp(-\\binom{2}{2} T) = \\exp(-T)$，因为该分支上有 $k=2$ 个谱系（$A$ 和 $B$），溯祖速率为 $\\binom{2}{2}=1$。\n- 以互补概率 $1-\\exp(-T)$，$A$ 和 $B$ 在内部分支上发生溯祖，产生基因树 $(A,B)\\mid C$。\n- 如果 $A$ 和 $B$ 未能在内部分支上发生溯祖（概率为 $\\exp(-T)$），那么 $A$、$B$ 和 $C$ 三个谱系一起进入祖先种群。第一次溯祖事件涉及三对中的任何一对，概率均为 $1/3$。因此，在内部分支上未能发生溯祖的条件下，三种有根基因树拓扑中的每一种都以 $1/3$ 的概率发生。\n\n因此，令 $p$ 表示单个位点上基因树与物种树 $(A,B)\\mid C$ 一致的概率，令 $q$ 表示每个不一致拓扑 $(A,C)\\mid B$ 或 $(B,C)\\mid A$ 的概率，我们有\n$$\np = \\left(1 - \\exp(-T)\\right) + \\exp(-T)\\cdot \\frac{1}{3}\n= 1 - \\frac{2}{3}\\exp(-T),\n$$\n$$\nq = \\exp(-T)\\cdot \\frac{1}{3} = \\frac{1}{3}\\exp(-T).\n$$\n\n对于3个独立的位点（位点间自由重组），要计算观察到三种拓扑各出现一次的概率，需要考虑包含一个 $(A,B)\\mid C$、一个 $(A,C)\\mid B$ 和一个 $(B,C)\\mid A$ 的拓扑在各位点上的有序分配。对于一个特定的排序，其概率是 $p\\cdot q\\cdot q$。这三类拓扑在3个位点上有 $3! = 6$ 种不同的排列。因此，总概率是\n$$\n6\\,p\\,q^{2} = 6\\left(1 - \\frac{2}{3}\\exp(-T)\\right)\\left(\\frac{1}{3}\\exp(-T)\\right)^{2}.\n$$\n我们可以简化这个表达式：\n$$\n6\\left(1 - \\frac{2}{3}\\exp(-T)\\right)\\left(\\frac{1}{9}\\exp(-2T)\\right)\n= \\frac{6}{9}\\exp(-2T)\\left(1 - \\frac{2}{3}\\exp(-T)\\right)\n= \\frac{2}{3}\\exp(-2T) - \\frac{4}{9}\\exp(-3T).\n$$\n\n两种形式都是有效的、只含 T 的闭式表达式。根据其构建过程，这个概率量化了在多物种溯祖模型下，一个单一物种树如何在三个非连锁位点上产生三种不同的有根基因树，这与步骤1中的示例数据集是一致的。\n\n因此，所要求的作为 $T$ 的函数的概率是\n$$\n\\frac{2}{3}\\exp(-2T)\\left(1 - \\frac{2}{3}\\exp(-T)\\right),\n$$\n或者等价地，\n$$\n\\frac{2}{3}\\exp(-2T) - \\frac{4}{9}\\exp(-3T).\n$$",
            "answer": "$$\\boxed{\\frac{2}{3}\\exp(-2T)-\\frac{4}{9}\\exp(-3T)}$$"
        },
        {
            "introduction": "最后一个练习将深入探讨溯祖理论中最令人惊讶也最重要的发现之一。虽然我们直觉上可能认为与物种树匹配的基因树是最常见的，但事实并非总是如此，尤其是在具有短内部分支的物种树中。这个问题将引导你推导一个“异常基因树”情景，从而强化你的理解：系统发育基因组学推断必须仔细考虑其背后的随机过程。",
            "id": "2726298",
            "problem": "考虑一个有根的四分类单元物种树，其叶尖标记为 $A$、$B$、$C$和$D$，拓扑结构为 $(((A,B),C),D)$。假设所有分支上的有效种群大小恒定，且时间以合并单位度量。支持分支 $(A,B)$ 的内部支长度为 $t_{1}=0$，支持分支 $((A,B),C)$ 并将其与 $D$ 分开的内部支长度为 $t_{2}=0.2$。根分支（所有四个谱系的祖先分支）的长度实际上是无限的。不存在迁移或种群大小变化。\n\n仅使用多物种合并模型 (MSC) 的定义性属性：(i) 当一个种群中存在 $k$ 个谱系时，到下一个合并事件的等待时间服从速率为 $\\binom{k}{2}$ 的指数分布，以及 (ii) 在一个合并事件发生的条件下，每一对无序谱系合并的概率相等，完成以下任务：\n\n1. 从第一性原理推导，在长度为 $t_{2}$ 的祖先分支 $((A,B),C)$ 中演化的三个谱系 $(A,B,C)$，在时间 $t_{2}$ 内发生 $0$、$1$ 或 $2$ 次合并事件的概率。\n\n2. 利用种群内谱系的可交换性和指数等待时间的无记忆性，以 $t_{2}$ 的函数形式，用闭合形式表示与物种树匹配的有根基因树拓扑 $(((A,B),C),D)$ 的概率，以及平衡有根基因树拓扑 $((A,C),(B,D))$ 的概率。\n\n3. 计算当 $t_{2}=0.2$ 时这些表达式的值。确定在此物种树的 MSC 模型下，哪种有根基因树拓扑最可能出现，并说明最可能的拓扑是否是异常的（即不等于物种树拓扑）。\n\n将此模型下最大基因树拓扑概率的数值作为最终答案报告，以小数形式表示并四舍五入到四位有效数字。无需单位。",
            "solution": "该问题要求在多物种合并 (MSC) 模型下，针对一个特定的四分类单元物种树和一组分支长度，推导和计算基因树的概率。对问题陈述的验证证实了其具有科学依据、是良定的和客观的。所有参数和条件都已给出，并且该问题是合并理论的一个标准应用。我们可以开始求解。\n\n物种树为 $(((A,B),C),D)$。支持 $(A,B)$ 分支的内部支长度为 $t_{1} = 0$。支持 $((A,B),C)$ 分支的内部支长度为 $t_{2} = 0.2$。时间以合并单位度量。我们逆时间追溯分类单元 $A$、$B$、$C$ 和 $D$ 的谱系。\n\n由于条件 $t_{1}=0$，谱系 A 和 B 不在其专属的祖先种群中停留任何时间。它们与谱系 C 同时立即进入 $((A,B),C)$ 分支的祖先种群。因此，在持续时间为 $t_{2}$ 的时间区间开始时，存在 $k=3$ 个谱系：$A$、$B$ 和 $C$ 的祖先。\n\n第1部分：在长度为 $t_{2}$ 的分支中发生合并事件的概率。\n当有 $k=3$ 个谱系时，到第一个合并事件的等待时间 $T_1$ 服从速率为 $\\lambda_{1} = \\binom{3}{2} = 3$ 的指数分布。\n\n在时间区间 $t_{2}$ 内发生零次合并事件的概率是该等待时间超过 $t_{2}$ 的概率：\n$$P(0 \\text{ 次事件}) = P(T_{1} > t_{2}) = \\exp(-\\lambda_{1} t_{2}) = \\exp(-3t_{2})$$\n\n对于 $3$ 个谱系，最多可能发生两次合并事件来解析它们的祖源关系。第一次事件后，剩下 $k=2$ 个谱系。第二次事件的等待时间 $T_2$ 服从速率为 $\\lambda_{2} = \\binom{2}{2} = 1$ 的指数分布。两次事件发生的总时间为 $S = T_1 + T_2$。由于 $T_1$ 和 $T_2$ 是速率不同的独立指数随机变量，$S$ 服从亚指数分布。\n\n在 $t_{2}$ 内发生两次合并事件的概率是 $P(S \\le t_{2})$。$S$ 的累积分布函数由下式给出：\n$$P(S \\le t) = 1 - \\frac{\\lambda_{1}}{\\lambda_{1}-\\lambda_{2}}\\exp(-\\lambda_{2}t) + \\frac{\\lambda_{2}}{\\lambda_{1}-\\lambda_{2}}\\exp(-\\lambda_{1}t)$$\n代入 $\\lambda_{1} = 3$ 和 $\\lambda_{2} = 1$：\n$$P(2 \\text{ 次事件}) = P(S \\le t_{2}) = 1 - \\frac{3}{3-1}\\exp(-t_{2}) + \\frac{1}{3-1}\\exp(-3t_{2}) = 1 - \\frac{3}{2}\\exp(-t_{2}) + \\frac{1}{2}\\exp(-3t_{2})$$\n\n恰好发生一次合并事件的概率是剩余的概率，因为总概率必须为 $1$：\n$$P(1 \\text{ 次事件}) = 1 - P(0 \\text{ 次事件}) - P(2 \\text{ 次事件})$$\n$$P(1 \\text{ 次事件}) = 1 - \\exp(-3t_{2}) - \\left(1 - \\frac{3}{2}\\exp(-t_{2}) + \\frac{1}{2}\\exp(-3t_{2})\\right)$$\n$$P(1 \\text{ 次事件}) = \\frac{3}{2}\\exp(-t_{2}) - \\frac{3}{2}\\exp(-3t_{2})$$\n\n第2部分：基因树拓扑 `(((A,B),C),D)` 和 `((A,C),(B,D))` 的概率。\n我们通过将产生某一给定基因树拓扑的所有合并历史的概率相加，来计算该拓扑的概率。这涉及到考虑在长度为 $t_{2}$ 的分支中发生的事件数量（$0$、$1$ 或 $2$）。\n\n匹配的基因树 $g_{match} = (((A,B),C),D)$ 的概率：\n情况1：在时间 $t_{2}$ 内发生 $0$ 次事件。三个谱系 $A, B, C$ 和谱系 $D$ 进入根种群。我们有 $k=4$ 个谱系。要形成 $g_{match}$，第一次合并必须是 $(A,B)$。共有 $\\binom{4}{2}=6$ 种可能的配对，因此 $P(\\text{第一次配对是 } (A,B)) = \\frac{1}{6}$。然后，对于 $3$ 个谱系 $((AB), C, D)$，下一次合并必须是 $((AB),C)$。共有 $\\binom{3}{2}=3$ 种配对，因此 $P(\\text{第二次配对是 } ((AB),C)) = \\frac{1}{3}$。最后的合并是确定的。此历史的概率为 $P(0 \\text{ 次事件}) \\times \\frac{1}{6} \\times \\frac{1}{3} = \\frac{1}{18}P(0 \\text{ 次事件})$。\n\n情况2：在时间 $t_{2}$ 内发生 $1$ 次事件。在谱系 $A, B, C$ 中，有 $\\binom{3}{2}=3$ 种配对。对于 $g_{match}$，合并必须是 $(A,B)$，概率为 $\\frac{1}{3}$。这使得谱系 $(AB)$ 和 $C$ 与谱系 $D$ 一同进入根种群。在这 $k=3$ 个谱系中，下一次合并必须是 $((AB),C)$，概率为 $\\frac{1}{3}$。此历史的概率为 $P(1 \\text{ 次事件}) \\times \\frac{1}{3} \\times \\frac{1}{3} = \\frac{1}{9}P(1 \\text{ 次事件})$。\n\n情况3：在时间 $t_{2}$ 内发生 $2$ 次事件。三个谱系 $A, B, C$ 完全合并。对于 $g_{match}$，第一次合并必须是 $(A,B)$，概率为 $\\frac{1}{3}$。第二次则确定为 $((AB),C)$。谱系 $(ABC)$ 与 $D$ 一同进入根种群，然后它们合并。此历史的概率为 $P(2 \\text{ 次事件}) \\times \\frac{1}{3}$。\n\n将这些路径的概率相加，得到总概率 $P(g_{match})$：\n$$P(g_{match}) = \\frac{1}{18}P(0 \\text{ 次事件}) + \\frac{1}{9}P(1 \\text{ 次事件}) + \\frac{1}{3}P(2 \\text{ 次事件})$$\n$$P(g_{match}) = \\frac{1}{18}\\exp(-3t_{2}) + \\frac{1}{9}\\left(\\frac{3}{2}\\exp(-t_{2}) - \\frac{3}{2}\\exp(-3t_{2})\\right) + \\frac{1}{3}\\left(1 - \\frac{3}{2}\\exp(-t_{2}) + \\frac{1}{2}\\exp(-3t_{2})\\right)$$\n$$P(g_{match}) = \\frac{1}{18}\\exp(-3t_{2}) + \\frac{1}{6}\\exp(-t_{2}) - \\frac{1}{6}\\exp(-3t_{2}) + \\frac{1}{3} - \\frac{1}{2}\\exp(-t_{2}) + \\frac{1}{6}\\exp(-3t_{2})$$\n$$P(g_{match}) = \\frac{1}{3} - \\frac{1}{3}\\exp(-t_{2}) + \\frac{1}{18}\\exp(-3t_{2})$$\n\n平衡基因树 $g_{bal} = ((A,C),(B,D))$ 的概率：\n情况1：在时间 $t_{2}$ 内发生 $0$ 次事件。四个谱系 $(A, B, C, D)$ 进入根种群。要形成 $g_{bal}$，必须发生 $(A,C)$ 和 $(B,D)$ 两次合并。从 $k=4$ 个谱系中，第一次合并是 $(A,C)$ 的概率为 $1/\\binom{4}{2}=1/6$，之后从 $k=3$ 个谱系中，$(B,D)$ 合并的概率为 $1/\\binom{3}{2}=1/3$。此序列的概率是 $1/18$。对称地，先 $(B,D)$ 合并再 $(A,C)$ 合并的概率也是 $1/18$。因此，该历史的总概率为 $P(0 \\text{ 次事件}) \\times (\\frac{1}{18} + \\frac{1}{18}) = \\frac{1}{9}P(0 \\text{ 次事件})$。\n\n情况2：在时间 $t_{2}$ 内发生 $1$ 次事件。该事件必须是 $(A,C)$，概率为 $\\frac{1}{3}$。谱系 $(AC), B, D$ 进入根种群。下一次合并必须是 $(B,D)$，概率为 $\\frac{1}{3}$。此历史的概率为 $P(1 \\text{ 次事件}) \\times \\frac{1}{3} \\times \\frac{1}{3} = \\frac{1}{9}P(1 \\text{ 次事件})$。\n\n情况3：在时间 $t_{2}$ 内发生 $2$ 次事件。谱系 $A,B,C$ 完全合并。产生的谱系 $(ABC)$ 和谱系 $D$ 进入根种群。它们的合并总是产生一种拓扑，其中 $D$ 是 $(A,B,C)$ 的外群，这不可能是 $g_{bal}$。此历史的概率为 $0$。\n\n将这些路径的概率相加，得到总概率 $P(g_{bal})$：\n$$P(g_{bal}) = \\frac{1}{9}P(0 \\text{ 次事件}) + \\frac{1}{9}P(1 \\text{ 次事件}) + 0$$\n$$P(g_{bal}) = \\frac{1}{9} \\left( \\exp(-3t_{2}) + \\frac{3}{2}\\exp(-t_{2}) - \\frac{3}{2}\\exp(-3t_{2}) \\right)$$\n$$P(g_{bal}) = \\frac{1}{9} \\left( \\frac{3}{2}\\exp(-t_{2}) - \\frac{1}{2}\\exp(-3t_{2}) \\right)$$\n$$P(g_{bal}) = \\frac{1}{6}\\exp(-t_{2}) - \\frac{1}{18}\\exp(-3t_{2})$$\n\n第3部分：在 $t_{2}=0.2$ 时的计算和最可能拓扑的确定。\n我们代入 $t_{2}=0.2$：\n$$P(g_{match}) = \\frac{1}{3} - \\frac{1}{3}\\exp(-0.2) + \\frac{1}{18}\\exp(-0.6) \\approx 0.333333 - 0.333333(0.818731) + 0.055556(0.548812) \\approx 0.090913$$\n$$P(g_{bal}) = \\frac{1}{6}\\exp(-0.2) - \\frac{1}{18}\\exp(-0.6) \\approx 0.166667(0.818731) - 0.055556(0.548812) \\approx 0.105966$$\n平衡拓扑 $g_{bal}$ 的概率大于匹配拓扑 $g_{match}$ 的概率。\n\n为了确定最可能的拓扑，我们必须确定在 $15$ 种可能的有根四分类单元基因树中，哪一种的概率最高。因为 $t_1=0$，谱系 $A,B,C$ 在持续时间为 $t_2$ 的祖先种群中是可交换的。这意味着概率上存在对称性。\n三种以 $D$ 为外群的梳状拓扑，`(((A,B),C),D)`、`(((A,C),B),D)` 和 `(((B,C),A),D)`，其概率必然相等。因此，它们的概率为 $P(g_{match}) \\approx 0.0909$。\n三种平衡拓扑是 `((A,B),(C,D))`、`((A,C),(B,D))` 和 `((A,D),(B,C))`。\n拓扑 `((A,C),(B,D))` 的概率是 $P(g_{bal}) \\approx 0.1060$。\n拓扑 `((A,B),(C,D))` 的概率也由 $\\frac{1}{9}(P(\\text{0 次事件}) + P(\\text{1 次事件}))$ 给出，因为其推导要求在 $(A,B,C)$ 种群中的一次合并为 $(A,B)$ 且随后在根部发生 $(C,D)$ 的合并，或者 $(A,B)$ 和 $(C,D)$ 在根部形成。因此，其概率等于 $P(g_{bal}) \\approx 0.1060$。\n拓扑 `((A,D),(B,C))` 的概率要求在 $t_2$ 时间间隔内不发生合并事件，之后配对 $(A,D)$ 和 $(B,C)$ 在根部形成。其概率为 $\\frac{1}{9}P(0 \\text{ 次事件}) = \\frac{1}{9}\\exp(-3t_2) = \\frac{1}{9}\\exp(-0.6) \\approx 0.0610$。\n其他梳状拓扑，例如以 $D$ 以外的分类单元为外群的拓扑，其概率会更低。例如，$P((((A,B),D),C)) = \\frac{1}{6}\\exp(-t_2) - \\frac{1}{9}\\exp(-3t_2) \\approx 0.16667(0.8187) - 0.11111(0.5488) \\approx 0.0755$。\n\n比较计算出的概率：\n$P(((A,C),(B,D))) = P(((A,B),(C,D))) \\approx 0.1060$\n$P((((A,B),C),D)) = P((((A,C),B),D)) = P((((B,C),A),D)) \\approx 0.0909$\n$P((((A,D),(B,C))) \\approx 0.0610$\n其他拓扑的概率更低。\n\n最大基因树概率约为 $0.105966$，由两种平衡拓扑共享。由于该概率大于物种树拓扑的概率 ($0.090913$)，因此最可能的有根基因树拓扑是异常的。最大概率四舍五入到四位有效数字为 $0.1060$。",
            "answer": "$$\\boxed{0.1060}$$"
        }
    ]
}