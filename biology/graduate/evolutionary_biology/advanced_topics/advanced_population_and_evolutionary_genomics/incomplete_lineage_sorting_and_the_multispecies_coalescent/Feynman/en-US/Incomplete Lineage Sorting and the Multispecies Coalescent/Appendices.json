{
    "hands_on_practices": [
        {
            "introduction": "The Multispecies Coalescent (MSC) model is built upon the fundamental process of lineage coalescence within a single population. This exercise challenges you to derive the distributions of waiting times between coalescent events from first principles and implement a simulation . By building this simulator, you will gain a foundational, hands-on understanding of how population size and time interact to shape the random process of gene lineage history, which is the engine driving incomplete lineage sorting.",
            "id": "2726286",
            "problem": "You are to implement a simulation of a neutral coalescent genealogy for a sample of size $n=5$ under a constant diploid effective population size $N_e$ within the classical constant-size Wright–Fisher model. This simulation represents the within-branch process assumed by the Multispecies Coalescent (MSC) framework, which is the standard model used to study incomplete lineage sorting. Your program must simulate the intercoalescent intervals by correctly deriving, from first principles, the waiting-time distribution when there are $k$ ancestral lineages, for $k$ decreasing from $5$ to $2$, under two possible time scalings: generations, and coalescent time units scaled by $2N_e$. You must base your derivation only on core definitions and well-tested facts: the definition of the coalescent process in a constant-size diploid population, the per-pair coalescence rate under neutrality, and the distributional property of the minimum of independent exponential waiting times. Do not use any pre-packaged or shortcut formulas in your derivation.\n\nYour program must:\n- Implement a general simulator for the intercoalescent intervals for $n=5$, stepping $k$ from $5$ down to $2$, under a constant $N_e$.\n- Support two time-unit options:\n  - $u=\\text{\"gen\"}$: time measured in generations.\n  - $u=\\text{\"coal\"}$: time measured in coalescent units, where one coalescent unit equals $2N_e$ generations.\n- Use a specified pseudorandom seed to ensure reproducibility.\n- Return, for each test case, a list of $4$ floating-point numbers corresponding to the simulated intercoalescent intervals $(T_5,T_4,T_3,T_2)$ in the requested unit $u$.\n\nScientific and mathematical requirements you must satisfy in your derivation and implementation:\n- Begin from the following foundational base:\n  - In a constant-size diploid Wright–Fisher population, each unordered pair of ancestral lineages coalesces at a constant rate per generation determined by $N_e$.\n  - When there are $k$ lineages, there are $\\binom{k}{2}$ unordered pairs.\n  - The minimum of independent exponential waiting times is exponential, and the identity of the minimum is independent of that minimum.\n- From this base, derive the distribution of each intercoalescent interval $T_k$ while there are $k$ lineages. Explicitly identify the rate parameter in generations and in coalescent units, clarifying the scaling between these units. Provide the expectation of $T_k$ under each scaling based on your derived distribution.\n- Translate your derivation into a correct simulation algorithm that draws $T_k$ for $k=5,4,3,2$, using the appropriate rate for the chosen unit $u$.\n- Ensure scientific realism by keeping all parameters within plausible biological ranges and by adhering to the neutral coalescent assumptions.\n\nTest suite:\nYour program must run the following test cases internally (do not request user input), in the order listed, and aggregate the results into a single output line as specified below. Each test case is a tuple $(n,N_e,u,\\text{seed})$, where $n=5$ for all cases:\n- Case $1$: $(5,\\,10000,\\,\\text{\"coal\"},\\,12345)$.\n- Case $2$: $(5,\\,50000,\\,\\text{\"gen\"},\\,20231102)$.\n- Case $3$: $(5,\\,500,\\,\\text{\"gen\"},\\,42)$.\n- Case $4$: $(5,\\,10000,\\,\\text{\"gen\"},\\,0)$.\n\nUnits:\n- When $u=\\text{\"gen\"}$, report times in generations.\n- When $u=\\text{\"coal\"}$, report times in coalescent units, where one unit equals $2N_e$ generations.\n\nAnswer type and final output format:\n- For each test case, return a list of $4$ floating-point numbers $(T_5,T_4,T_3,T_2)$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is the list of four floats for a test case. For example, a valid output shape is: [[t51,t41,t31,t21],[t52,t42,t32,t22],[t53,t43,t33,t23],[t54,t44,t34,t24]].\n- Floats may be printed in standard unrounded form.\n\nYour solution must include:\n- A principled derivation of the intercoalescent distributions from the foundational base above.\n- A clear description of the algorithmic steps.\n- The complete program that executes the simulation and produces the required single-line output for the specified test suite.",
            "solution": "The problem requires the derivation and simulation of intercoalescent waiting times for a sample of $n=5$ lineages under the neutral Wright-Fisher model with a constant diploid effective population size $N_e$. The derivation must proceed from first principles, and the simulation must be reproducible, supporting time units of both generations and coalescent units.\n\nFirst, we shall derive the distribution of the intercoalescent time $T_k$, which is the waiting time for any two of $k$ ancestral lineages to coalesce.\n\nThe foundational assumptions are as follows:\n$1$. We consider a constant-size diploid population of $N_e$ individuals, which corresponds to $2N_e$ gene copies in each generation.\n$2$. We trace the ancestry of a sample of $k$ lineages backward in time.\n$3$. Under the neutral Wright-Fisher model, each lineage in generation $t+1$ chooses its parent from generation $t$ uniformly at random from the $2N_e$ gene copies.\n\nConsider two specific lineages. The probability that they choose the same parental gene copy in the preceding generation is $1/(2N_e)$. The probability that they do not is $1 - 1/(2N_e)$. The event of coalescence is therefore a Bernoulli trial in each generation. The time until the first success (coalescence) follows a geometric distribution with success probability $p = 1/(2N_e)$. For a large effective population size $N_e$, which is a standard assumption in coalescent theory, this discrete-time geometric process is well-approximated by a continuous-time exponential waiting process. The rate of this exponential process, $\\lambda_{\\text{pair}}$, is equal to the probability of the event occurring in a single time step. Thus, the rate of coalescence for a single pair of lineages is:\n$$ \\lambda_{\\text{pair}} = \\frac{1}{2N_e} \\text{ per generation} $$\nThe waiting time for this specific pair to coalesce is an exponential random variable with this rate.\n\nNow, consider the case with $k$ distinct ancestral lineages. A coalescence event occurs when any pair of these lineages finds a common ancestor. The number of distinct, unordered pairs of lineages is given by the binomial coefficient:\n$$ \\binom{k}{2} = \\frac{k(k-1)}{2} $$\nEach of these $\\binom{k}{2}$ pairs represents an independent opportunity for a coalescence event. The total time until the *next* coalescence event, $T_k$, is the minimum of the waiting times for each of the $\\binom{k}{2}$ pairs. A fundamental property of exponential distributions states that the minimum of a set of independent exponential random variables is itself an exponential random variable. Its rate is the sum of the individual rates.\n\nSince each pair coalesces at a rate of $\\lambda_{\\text{pair}} = 1/(2N_e)$ per generation, the total rate of coalescence for any pair, $\\lambda_k$, is the sum of the rates of all pairs:\n$$ \\lambda_k^{\\text{gen}} = \\binom{k}{2} \\times \\lambda_{\\text{pair}} = \\frac{k(k-1)}{2} \\times \\frac{1}{2N_e} = \\frac{k(k-1)}{4N_e} \\text{ per generation} $$\nTherefore, the intercoalescent time $T_k$ measured in generations is an exponential random variable with rate $\\lambda_k^{\\text{gen}}$:\n$$ T_k(\\text{gen}) \\sim \\text{Exp}\\left(\\frac{k(k-1)}{4N_e}\\right) $$\nThe expected waiting time in generations is the reciprocal of the rate:\n$$ E[T_k(\\text{gen})] = \\frac{1}{\\lambda_k^{\\text{gen}}} = \\frac{4N_e}{k(k-1)} $$\n\nNext, we derive the distribution in coalescent time units. One coalescent time unit is defined as $2N_e$ generations. Let $t_{\\text{gen}}$ be time in generations and $t_{\\text{coal}}$ be time in coalescent units. The relationship is:\n$$ t_{\\text{coal}} = \\frac{t_{\\text{gen}}}{2N_e} $$\nIf a random variable $X$ has an exponential distribution with rate $\\lambda$, the scaled random variable $Y = cX$ has an exponential distribution with rate $\\lambda/c$. To convert the rate from generations to coalescent units, we use the scaling factor $c = 1/(2N_e)$. The new rate, $\\lambda_k^{\\text{coal}}$, is:\n$$ \\lambda_k^{\\text{coal}} = \\lambda_k^{\\text{gen}} \\times (2N_e) = \\left(\\frac{k(k-1)}{4N_e}\\right) \\times (2N_e) = \\frac{k(k-1)}{2} = \\binom{k}{2} $$\nThus, when time is measured in coalescent units, the intercoalescent time $T_k$ follows an exponential distribution with a rate that is independent of population size:\n$$ T_k(\\text{coal}) \\sim \\text{Exp}\\left(\\binom{k}{2}\\right) $$\nThe expected waiting time in coalescent units is:\n$$ E[T_k(\\text{coal})] = \\frac{1}{\\lambda_k^{\\text{coal}}} = \\frac{1}{\\binom{k}{2}} = \\frac{2}{k(k-1)} $$\n\nThe simulation algorithm proceeds as follows. For each test case specified by $(n, N_e, u, \\text{seed})$:\n$1$. A pseudorandom number generator is initialized with the provided `seed` to ensure reproducibility.\n$2$. The simulation iterates backward in time, from $k=n$ down to $k=2$. For this problem, $n=5$, so the loop runs for $k \\in \\{5, 4, 3, 2\\}$.\n$3$. In each iteration $k$, the rate parameter $\\lambda_k$ is calculated according to the specified time unit $u$:\n    - If $u = \\text{\"gen\"}$, the rate is $\\lambda_k^{\\text{gen}} = \\frac{k(k-1)}{4N_e}$.\n    - If $u = \\text{\"coal\"}$, the rate is $\\lambda_k^{\\text{coal}} = \\binom{k}{2} = \\frac{k(k-1)}{2}$.\n$4$. A random variate $T_k$ is drawn from the exponential distribution with the calculated rate $\\lambda_k$. This is achieved using the inverse transform sampling method, where $T_k = -\\ln(U) / \\lambda_k$ for a uniform random variable $U \\sim \\text{Uniform(0,1)}$. In practice, we use a library function that implements this, such as `numpy.random.exponential`, which takes a scale parameter $\\beta = 1/\\lambda_k$.\n$5$. The simulated time $T_k$ is stored. After the loop completes, the result is a list of four time intervals: $(T_5, T_4, T_3, T_2)$.\n$6$. This procedure is repeated for all test cases, and the results are aggregated into a single formatted output string.",
            "answer": "```python\nimport numpy as np\n\ndef simulate_coalescent_intervals(n, Ne, unit, seed):\n    \"\"\"\n    Simulates intercoalescent intervals for a sample of size n.\n\n    Args:\n        n (int): The initial sample size.\n        Ne (int): The diploid effective population size.\n        unit (str): The time unit, either \"gen\" (generations) or \"coal\" (coalescent units).\n        seed (int): The seed for the pseudorandom number generator.\n\n    Returns:\n        list[float]: A list of simulated intercoalescent intervals [T_n, T_{n-1}, ..., T_2].\n    \"\"\"\n    # 1. Initialize the pseudorandom number generator with the given seed.\n    rng = np.random.default_rng(seed)\n    \n    intervals = []\n    \n    # 2. Loop for k from n down to 2.\n    for k in range(n, 1, -1):\n        # 3. Calculate the rate parameter lambda_k.\n        num_pairs = k * (k - 1) / 2\n        \n        if unit == \"gen\":\n            # For time in generations, the rate is kC2 / (2*Ne) for haploids.\n            # For diploids, the rate is k(k-1)/(4Ne).\n            if Ne = 0:\n                raise ValueError(\"Effective population size Ne must be positive.\")\n            rate = num_pairs / (2 * Ne)\n        elif unit == \"coal\":\n            # For time in coalescent units, the rate is kC2.\n            rate = num_pairs\n        else:\n            raise ValueError(\"Unit must be 'gen' or 'coal'.\")\n            \n        # The scale parameter for numpy's exponential is 1/rate.\n        scale = 1.0 / rate\n        \n        # 4. Draw a random variate from the exponential distribution.\n        t_k = rng.exponential(scale)\n        \n        # 5. Store the simulated time.\n        intervals.append(t_k)\n        \n    return intervals\n\ndef solve():\n    \"\"\"\n    Runs the simulation for a predefined set of test cases and prints the results.\n    \"\"\"\n    # Define the test suite as specified in the problem statement.\n    # Each case is a tuple: (n, Ne, unit, seed)\n    test_cases = [\n        (5, 10000, \"coal\", 12345),\n        (5, 50000, \"gen\", 20231102),\n        (5, 500, \"gen\", 42),\n        (5, 10000, \"gen\", 0)\n    ]\n\n    # Aggregate results from all test cases.\n    all_results = []\n    for n, Ne, unit, seed in test_cases:\n        result = simulate_coalescent_intervals(n, Ne, unit, seed)\n        all_results.append(result)\n\n    # Format the final output string as per the problem requirements.\n    # The format is [[t51,t41,t31,t21],[t52,t42,t32,t22],...].\n    # str() on a list of lists creates spaces, which must be removed.\n    final_output = str(all_results).replace(\" \", \"\")\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "A central concept in phylogenomics is that individual gene genealogies often conflict with the overall species tree they evolved within. This practice explores how Incomplete Lineage Sorting (ILS), a direct consequence of the coalescent process, naturally generates this discordance . You will connect the abstract theory of ILS to concrete data and derive the exact probability of this phenomenon, solidifying your grasp of the core MSC model for the classic three-taxon case.",
            "id": "2726274",
            "problem": "Consider a rooted species tree with three species labeled $A$, $B$, and $C$, where the species tree topology is $(A,B)\\mid C$. Assume one sampled haploid lineage per species, constant and equal effective population sizes on all branches, no recombination within a locus, and free recombination among loci. Let the length of the internal branch that separates the ancestral population of $A$ and $B$ from $C$ be $T$ coalescent units, where time is scaled by the appropriate effective population size so that the waiting time to coalescence among $k$ lineages is exponentially distributed with rate $\\binom{k}{2}$.\n\nTask:\n1) Construct a minimal three-locus dataset (one short alignment per locus) across species $A$, $B$, and $C$ such that, when each locus is analyzed independently, each locus supports a different rooted gene tree topology among the three possible topologies $(A,B)\\mid C$, $(A,C)\\mid B$, and $(B,C)\\mid A$. Your dataset should be scientifically plausible under a standard mutation model (for example, the infinite-sites model) and should be justified by indicating which parsimony-informative site(s) support each locus’s inferred gene tree.\n2) Explain mechanistically, using incomplete lineage sorting under the Multispecies Coalescent (MSC; Multispecies Coalescent), how a single underlying species tree $(A,B)\\mid C$ with internal branch length $T$ can generate three different rooted gene trees across three independent loci.\n3) Starting from first principles of the coalescent (exponential waiting times for coalescence and symmetry among pairs when three lineages are present in the same ancestral population), derive a closed-form analytic expression for the probability that, across $3$ independent loci, you observe exactly one instance of each of the three rooted topologies. Your final answer must be a single simplified analytic expression in terms of $T$ only, with no numerical approximation or units. Do not use any pre-memorized shortcut formulas; derive what you need from the fundamental coalescent assumptions given above.",
            "solution": "We first construct an explicit, plausible three-locus dataset under the infinite-sites model that yields three different rooted gene trees across the three loci. Then we explain why such discordance is expected under the Multispecies Coalescent (MSC; Multispecies Coalescent) with incomplete lineage sorting. Finally, we derive from first principles the probability that three independent loci produce all three distinct rooted topologies exactly once, as a function of the internal branch length $T$ (in coalescent units).\n\nStep 1: Constructing a minimal dataset.\nUnder the infinite-sites model, a single biallelic site that places the derived state on the branch subtending a pair of taxa provides parsimony support for that pair as a clade. For three taxa, one informative biallelic site per locus suffices. We can therefore propose the following alignments, where $0$ denotes the ancestral state and $1$ the derived state:\n\n- Locus $1$: $(A,B)\\mid C$\n  - Site pattern: $A=1,\\ B=1,\\ C=0$. This single parsimony-informative site supports $(A,B)\\mid C$.\n\n- Locus $2$: $(A,C)\\mid B$\n  - Site pattern: $A=1,\\ B=0,\\ C=1$. This supports $(A,C)\\mid B$.\n\n- Locus $3$: $(B,C)\\mid A$\n  - Site pattern: $A=0,\\ B=1,\\ C=1$. This supports $(B,C)\\mid A$.\n\nEach locus has exactly one parsimony-informative site consistent with one of the three possible rooted gene trees, and the three loci collectively realize all three topologies.\n\nStep 2: Why discordant gene trees are consistent with a single species tree under the MSC.\nConsider the species tree $(A,B)\\mid C$ with internal branch length $T$ (in coalescent units). Sample one lineage from each of $A$, $B$, and $C$. On the internal branch ancestral to $A$ and $B$, the two lineages $A$ and $B$ can coalesce before the ancestral population common to $A$, $B$, and $C$ is reached. If $A$ and $B$ coalesce on this internal branch, then the gene tree at that locus must be $(A,B)\\mid C$. If they fail to coalesce on this internal branch, then all three lineages $A$, $B$, and $C$ enter the deeper ancestral population simultaneously; by exchangeability and symmetry of the coalescent with $3$ lineages, the first coalescent event picks each pair with probability $1/3$. Consequently, conditional on failing to coalesce on the internal branch, each of the three topologies $(A,B)\\mid C$, $(A,C)\\mid B$, and $(B,C)\\mid A$ occurs with probability $1/3$. Therefore, even when the species tree is $(A,B)\\mid C$, discordant gene trees $(A,C)\\mid B$ and $(B,C)\\mid A$ will arise with nonzero probability due to incomplete lineage sorting, especially when $T$ is small.\n\nStep 3: Deriving the probability of observing all three topologies across three loci.\nWe use only the fundamental coalescent assumptions:\n\n- Along a branch where there are $k$ lineages present in the same population, the waiting time to the next coalescent event is exponential with rate $\\binom{k}{2}$.\n- If three lineages enter the same population at the same time, the first coalescent event groups each pair with equal probability $1/3$, due to exchangeability.\n\nLet $T$ be the length (in coalescent units) of the internal branch ancestral to $A$ and $B$ and descendant of the common ancestor of all three species.\n\nFor a single locus:\n- The probability that lineages $A$ and $B$ do not coalesce on the internal branch of length $T$ is $\\exp(-\\binom{2}{2} T) = \\exp(-T)$, because there are $k=2$ lineages ($A$ and $B$) along that branch and the coalescent rate is $\\binom{2}{2}=1$.\n- With the complementary probability $1-\\exp(-T)$, $A$ and $B$ do coalesce on the internal branch, yielding gene tree $(A,B)\\mid C$.\n- If $A$ and $B$ fail to coalesce on the internal branch (probability $\\exp(-T)$), then the three lineages $A$, $B$, and $C$ enter the ancestral population together. The first coalescent event involves any of the three pairs with equal probability $1/3$. Hence, conditional on failure to coalesce on the internal branch, each of the three rooted gene tree topologies occurs with probability $1/3$.\n\nTherefore, letting $p$ denote the per-locus probability that the gene tree agrees with the species tree $(A,B)\\mid C$, and $q$ the per-locus probability of each discordant topology $(A,C)\\mid B$ or $(B,C)\\mid A$, we have\n$$\np = \\left(1 - \\exp(-T)\\right) + \\exp(-T)\\cdot \\frac{1}{3}\n= 1 - \\frac{2}{3}\\exp(-T),\n$$\n$$\nq = \\exp(-T)\\cdot \\frac{1}{3} = \\frac{1}{3}\\exp(-T).\n$$\n\nAcross $3$ independent loci (free recombination among loci), the probability that we observe exactly one instance of each of the three topologies equals the probability of any ordered assignment of topologies across the loci that contains one $(A,B)\\mid C$, one $(A,C)\\mid B$, and one $(B,C)\\mid A$. For a specific ordering, the probability is $p\\cdot q\\cdot q$. There are $3! = 6$ distinct permutations of these three categories across $3$ loci. Hence, the total probability is\n$$\n6\\,p\\,q^{2} = 6\\left(1 - \\frac{2}{3}\\exp(-T)\\right)\\left(\\frac{1}{3}\\exp(-T)\\right)^{2}.\n$$\nWe can simplify this expression:\n$$\n6\\left(1 - \\frac{2}{3}\\exp(-T)\\right)\\left(\\frac{1}{9}\\exp(-2T)\\right)\n= \\frac{6}{9}\\exp(-2T)\\left(1 - \\frac{2}{3}\\exp(-T)\\right)\n= \\frac{2}{3}\\exp(-2T) - \\frac{4}{9}\\exp(-3T).\n$$\n\nEither form is a valid closed-form expression in terms of $T$. By construction, this probability quantifies how a single species tree under the Multispecies Coalescent can produce three different rooted gene trees across three unlinked loci, consistent with the example dataset in Step $1$.\n\nThus, the required probability as a function of $T$ is\n$$\n\\frac{2}{3}\\exp(-2T)\\left(1 - \\frac{2}{3}\\exp(-T)\\right),\n$$\nequivalently,\n$$\n\\frac{2}{3}\\exp(-2T) - \\frac{4}{9}\\exp(-3T).\n$$",
            "answer": "$$\\boxed{\\frac{2}{3}\\exp(-2T)-\\frac{4}{9}\\exp(-3T)}$$"
        },
        {
            "introduction": "While intuition might suggest that the most common gene tree should match the species tree, the MSC model reveals surprising exceptions. This advanced exercise guides you through the \"anomaly zone,\" a region of parameter space where the species tree topology is not the most probable gene tree topology . By deriving gene tree probabilities from first principles for a specific four-taxon case, you will uncover this critical result and deepen your understanding of the complexities of phylogenetic inference under ILS.",
            "id": "2726298",
            "problem": "Consider a rooted four-taxon species tree with labeled tips $A$, $B$, $C$, and $D$ and topology $(((A,B),C),D)$. Assume a constant effective population size on all branches and that times are measured in coalescent units. The internal branch subtending the clade $(A,B)$ has length $t_{1}=0$, and the internal branch subtending the clade $((A,B),C)$ and separating it from $D$ has length $t_{2}=0.2$. The root branch (ancestral to all four lineages) is effectively of infinite length. There is no migration or population size change.\n\nUsing only the defining properties of the multispecies coalescent (MSC): (i) when $k$ lineages are present in a population, the waiting time to the next coalescent event is exponential with rate $\\binom{k}{2}$, and (ii) conditional on a coalescent event, each unordered pair of lineages is equally likely to coalesce, do the following:\n\n1. Derive from first principles the probabilities that among the three lineages $(A,B,C)$ evolving in the ancestral $((A,B),C)$ branch of length $t_{2}$ there are $0$, $1$, or $2$ coalescent events before time $t_{2}$ elapses.\n\n2. Using exchangeability of lineages within a population and the memoryless property of exponential waiting times, express in closed form the probability of the rooted gene tree topology that matches the species tree, namely $(((A,B),C),D)$, and the probability of the balanced rooted gene tree topology $((A,C),(B,D))$, each as functions of $t_{2}$.\n\n3. Evaluate these expressions at $t_{2}=0.2$. Determine which rooted gene tree topology is most probable under the MSC for this species tree, and state whether the most probable topology is anomalous (i.e., not equal to the species tree topology).\n\nReport as your final answer the numerical value of the maximum gene tree topology probability under this model, expressed as a decimal and rounded to four significant figures. No units are required.",
            "solution": "The problem requires the derivation and evaluation of gene tree probabilities under the multispecies coalescent (MSC) model for a specific four-taxon species tree and a set of branch lengths. The validation of the problem statement confirms that it is scientifically grounded, well-posed, and objective. All parameters and conditions are provided, and the problem is a standard application of coalescent theory. We may proceed with the solution.\n\nThe species tree is $(((A,B),C),D)$. The internal branch subtending the $(A,B)$ clade has length $t_{1} = 0$. The internal branch subtending the $((A,B),C)$ clade has length $t_{2} = 0.2$. Times are measured in coalescent units. We trace the lineages of taxa $A$, $B$, $C$, and $D$ backwards in time.\n\nDue to the condition $t_{1}=0$, lineages A and B do not spend any time in an exclusive ancestral population. They immediately enter the population ancestral to the $((A,B),C)$ clade at the same time as lineage C. Therefore, at the beginning of the time interval of duration $t_{2}$, there are $k=3$ lineages present: the ancestors of $A$, $B$, and $C$.\n\nPart 1: Probabilities of coalescent events in the branch of length $t_{2}$.\nWith $k=3$ lineages, the waiting time $T_1$ to the first coalescent event follows an exponential distribution with rate $\\lambda_{1} = \\binom{3}{2} = 3$.\n\nThe probability of zero coalescent events occurring within the time interval $t_{2}$ is the probability that this waiting time exceeds $t_{2}$:\n$$P(0 \\text{ events}) = P(T_{1} > t_{2}) = \\exp(-\\lambda_{1} t_{2}) = \\exp(-3t_{2})$$\n\nWith $3$ lineages, a maximum of two coalescent events can occur to resolve their ancestry. After the first event, $k=2$ lineages remain. The waiting time $T_2$ for the second event is exponential with rate $\\lambda_{2} = \\binom{2}{2} = 1$. The total time for two events to occur is $S = T_1 + T_2$. Since $T_1$ and $T_2$ are independent exponential random variables with different rates, $S$ follows a hypoexponential distribution.\n\nThe probability of two coalescent events occurring within $t_{2}$ is $P(S \\le t_{2})$. The cumulative distribution function for $S$ is given by:\n$$P(S \\le t) = 1 - \\frac{\\lambda_{1}}{\\lambda_{1}-\\lambda_{2}}\\exp(-\\lambda_{2}t) + \\frac{\\lambda_{2}}{\\lambda_{1}-\\lambda_{2}}\\exp(-\\lambda_{1}t)$$\nSubstituting $\\lambda_{1} = 3$ and $\\lambda_{2} = 1$:\n$$P(2 \\text{ events}) = P(S \\le t_{2}) = 1 - \\frac{3}{3-1}\\exp(-t_{2}) + \\frac{1}{3-1}\\exp(-3t_{2}) = 1 - \\frac{3}{2}\\exp(-t_{2}) + \\frac{1}{2}\\exp(-3t_{2})$$\n\nThe probability of exactly one coalescent event is the remaining probability, as the total probability must sum to $1$:\n$$P(1 \\text{ event}) = 1 - P(0 \\text{ events}) - P(2 \\text{ events})$$\n$$P(1 \\text{ event}) = 1 - \\exp(-3t_{2}) - \\left(1 - \\frac{3}{2}\\exp(-t_{2}) + \\frac{1}{2}\\exp(-3t_{2})\\right)$$\n$$P(1 \\text{ event}) = \\frac{3}{2}\\exp(-t_{2}) - \\frac{3}{2}\\exp(-3t_{2})$$\n\nPart 2: Probabilities of gene tree topologies $g_{\\text{match}} = (((A,B),C),D)$ and $g_{\\text{bal}} = ((A,C),(B,D))$.\nWe calculate the probability of a given gene tree topology by summing the probabilities of all coalescent histories that produce it. This involves considering the number of events ($0$, $1$, or $2$) that occur in the branch of length $t_{2}$.\n\nProbability of the matching gene tree, $g_{\\text{match}} = (((A,B),C),D)$:\nCase 1: $0$ events in time $t_{2}$. The three lineages $A, B, C$ and lineage $D$ enter the root population. We have $k=4$ lineages. To form $g_{\\text{match}}$, the first coalescence must be $(A,B)$. There are $\\binom{4}{2}=6$ possible pairs, so $P(\\text{first pair is } (A,B)) = \\frac{1}{6}$. Then, with $3$ lineages $((AB), C, D)$, the next coalescence must be $((AB),C)$. There are $\\binom{3}{2}=3$ pairs, so $P(\\text{second pair is } ((AB),C)) = \\frac{1}{3}$. The final coalescence is determined. The probability for this history is $P(0 \\text{ events}) \\times \\frac{1}{6} \\times \\frac{1}{3} = \\frac{1}{18}P(0 \\text{ events})$.\n\nCase 2: $1$ event in time $t_{2}$. Among lineages $A, B, C$, there are $\\binom{3}{2}=3$ pairs. For $g_{\\text{match}}$, the coalescence must be $(A,B)$, with probability $\\frac{1}{3}$. This leaves lineages $(AB)$ and $C$ to enter the root population with lineage $D$. Among these $k=3$ lineages, the next coalescence must be $((AB),C)$, with probability $\\frac{1}{3}$. The probability for this history is $P(1 \\text{ event}) \\times \\frac{1}{3} \\times \\frac{1}{3} = \\frac{1}{9}P(1 \\text{ event})$.\n\nCase 3: $2$ events in time $t_{2}$. The three lineages $A, B, C$ fully coalesce. For $g_{\\text{match}}$, the first coalescence must be $(A,B)$, with probability $\\frac{1}{3}$. The second is then fixed as $((AB),C)$. The lineage $(ABC)$ enters the root with $D$, and they coalesce. The probability for this history is $P(2 \\text{ events}) \\times \\frac{1}{3}$.\n\nSumming these paths gives the total probability $P(g_{\\text{match}})$:\n$$P(g_{\\text{match}}) = \\frac{1}{18}P(0 \\text{ events}) + \\frac{1}{9}P(1 \\text{ event}) + \\frac{1}{3}P(2 \\text{ events})$$\n$$P(g_{\\text{match}}) = \\frac{1}{18}\\exp(-3t_{2}) + \\frac{1}{9}\\left(\\frac{3}{2}\\exp(-t_{2}) - \\frac{3}{2}\\exp(-3t_{2})\\right) + \\frac{1}{3}\\left(1 - \\frac{3}{2}\\exp(-t_{2}) + \\frac{1}{2}\\exp(-3t_{2})\\right)$$\n$$P(g_{\\text{match}}) = \\frac{1}{18}\\exp(-3t_{2}) + \\frac{1}{6}\\exp(-t_{2}) - \\frac{1}{6}\\exp(-3t_{2}) + \\frac{1}{3} - \\frac{1}{2}\\exp(-t_{2}) + \\frac{1}{6}\\exp(-3t_{2})$$\n$$P(g_{\\text{match}}) = \\frac{1}{3} - \\frac{1}{3}\\exp(-t_{2}) + \\frac{1}{18}\\exp(-3t_{2})$$\n\nProbability of the balanced gene tree, $g_{\\text{bal}} = ((A,C),(B,D))$:\nCase 1: $0$ events in time $t_{2}$. With $k=4$ lineages $(A, B, C, D)$ in the root population, we need a first coalescence of either $(A,C)$ or $(B,D)$. The probability is $\\frac{2}{6} = \\frac{1}{3}$. Assume it is $(A,C)$. The remaining lineages are $((AC), B, D)$. The next coalescence must be $(B,D)$, with probability $\\frac{1}{3}$. The probability for this history is $P(0 \\text{ events}) \\times \\frac{1}{3} \\times \\frac{1}{3} = \\frac{1}{9}P(0 \\text{ events})$.\n\nCase 2: $1$ event in time $t_{2}$. The event must be $(A,C)$, with probability $\\frac{1}{3}$. The lineages $(AC), B, D$ enter the root population. The next coalescence must be $(B,D)$, with probability $\\frac{1}{3}$. The probability for this history is $P(1 \\text{ event}) \\times \\frac{1}{3} \\times \\frac{1}{3} = \\frac{1}{9}P(1 \\text{ event})$.\n\nCase 3: $2$ events in time $t_{2}$. The lineages $A,B,C$ fully coalesce. The resulting lineage $(ABC)$ and lineage $D$ enter the root. Their coalescence always produces a topology where $D$ is the outgroup to $(A,B,C)$, which cannot be $g_{\\text{bal}}$. The probability for this history is $0$.\n\nSumming these paths gives the total probability $P(g_{\\text{bal}})$:\n$$P(g_{\\text{bal}}) = \\frac{1}{9}P(0 \\text{ events}) + \\frac{1}{9}P(1 \\text{ event}) + 0$$\n$$P(g_{\\text{bal}}) = \\frac{1}{9} \\left( \\exp(-3t_{2}) + \\frac{3}{2}\\exp(-t_{2}) - \\frac{3}{2}\\exp(-3t_{2}) \\right)$$\n$$P(g_{\\text{bal}}) = \\frac{1}{9} \\left( \\frac{3}{2}\\exp(-t_{2}) - \\frac{1}{2}\\exp(-3t_{2}) \\right)$$\n$$P(g_{\\text{bal}}) = \\frac{1}{6}\\exp(-t_{2}) - \\frac{1}{18}\\exp(-3t_{2})$$\n\nPart 3: Evaluation at $t_{2}=0.2$ and determination of the most probable topology.\nWe substitute $t_{2}=0.2$:\n$$P(g_{\\text{match}}) = \\frac{1}{3} - \\frac{1}{3}\\exp(-0.2) + \\frac{1}{18}\\exp(-0.6) \\approx 0.333333 - 0.333333(0.818731) + 0.055556(0.548812) \\approx 0.090913$$\n$$P(g_{\\text{bal}}) = \\frac{1}{6}\\exp(-0.2) - \\frac{1}{18}\\exp(-0.6) \\approx 0.166667(0.818731) - 0.055556(0.548812) \\approx 0.105966$$\nThe probability of the balanced topology $g_{\\text{bal}}$ is greater than the probability of the matching topology $g_{\\text{match}}$.\n\nTo determine the most probable topology, we must identify which of the $15$ possible rooted four-taxon gene trees has the highest probability. Because $t_1=0$, the lineages $A,B,C$ are exchangeable in the ancestral population of duration $t_2$. This implies symmetries in the probabilities.\nThe three pectinate topologies with $D$ as the outgroup, `(((A,B),C),D)`, `(((A,C),B),D)`, and `(((B,C),A),D)`, must have equal probability. Thus, their probability is $P(g_{match}) \\approx 0.0909$.\nThe three balanced topologies are `((A,B),(C,D))`, `((A,C),(B,D))`, and `((A,D),(B,C))`.\nThe probability of `((A,C),(B,D))` is $P(g_{bal}) \\approx 0.1060$.\nThe probability of `((A,B),(C,D))` is also given by $\\frac{1}{9}(P(0 \\text{ events}) + P(1 \\text{ event}))$, since its derivation requires one coalescence in the $(A,B,C)$ population to be $(A,B)$ and a subsequent coalescence of $(C,D)$ in the root, or for $(A,B)$ and $(C,D)$ to form in the root. Its probability is therefore equal to $P(g_{bal}) \\approx 0.1060$.\nThe probability of `((A,D),(B,C))` requires that no specified pairs coalesce in the $t_2$ interval, and that the pairs $(A,D)$ and $(B,C)$ form in the root. Its probability is $\\frac{1}{9}P(0 \\text{ events}) = \\frac{1}{9}\\exp(-3t_2) = \\frac{1}{9}\\exp(-0.6) \\approx 0.0610$.\nOther pectinate topologies, such as those with an outgroup other than $D$, will have lower probabilities. For example, $P((((A,B),D),C)) = \\frac{1}{6}\\exp(-t_2) - \\frac{1}{9}\\exp(-3t_2) \\approx 0.16667(0.8187) - 0.11111(0.5488) \\approx 0.0755$.\n\nComparing the calculated probabilities:\n$P(((A,C),(B,D))) = P(((A,B),(C,D))) \\approx 0.1060$\n$P((((A,B),C),D)) = P((((A,C),B),D)) = P((((B,C),A),D)) \\approx 0.0909$\n$P((((A,D),(B,C))) \\approx 0.0610$\nOther topologies have even lower probabilities.\n\nThe maximum gene tree probability is approximately $0.105966$, shared by two balanced topologies. Since this probability is greater than the probability of the species tree topology ($0.090913$), the most probable rooted gene tree topology is anomalous. The maximum probability, rounded to four significant figures, is $0.1060$.",
            "answer": "$$\\boxed{0.1060}$$"
        }
    ]
}