{
    "hands_on_practices": [
        {
            "introduction": "计算一个新突变等位基因最终在种群中固定的概率是演化遗传学的核心问题之一。本练习将指导您从后向 Kolmogorov 方程出发，推导出选择和显性共同作用下的固定概率公式。通过这个实践，您将学会如何将抽象的扩散理论应用于预测等位基因的演化命运，这是理解自然选择效力的关键一步。",
            "id": "2700919",
            "problem": "一个有效种群大小为 $N_e$ 的恒定二倍体随机交配种群，遵循带选择的赖特-费舍尔模型。两个等位基因 $A$ 和 $a$ 在单个基因座上分离。各基因型的相对生存力为 $w_{aa}=1$、$w_{Aa}=1+h\\,s$ 和 $w_{AA}=1+s$，其中 $s>0$ 和 $0 \\leq h \\leq 1$ 是常数。种群中出现了一个等位基因 $A$ 的拷贝，因此其初始频率为 $x_0=1/(2N_e)$。假设选择足够弱，使得扩散近似成立。\n\n使用扩散近似，其生成元 $L$ 作用于等位基因频率 $x$ 的足够光滑函数 $f$ 的方式为\n$$\nL f(x) \\equiv a(x)\\,f'(x) + \\frac{1}{2}\\,b(x)\\,f''(x),\n$$\n其中每代的漂移和扩散系数是经过充分检验的表达式\n$$\na(x)=s\\,x(1-x)\\big[h+(1-2h)\\,x\\big],\\qquad b(x)=\\frac{x(1-x)}{2N_e}.\n$$\n从固定概率 $u(x)$ 的向后 Kolmogorov 方程出发，该方程满足 $L u(x)=0$ 以及边界条件 $u(0)=0$ 和 $u(1)=1$，推导出 $u(x)$ 的求积形式的闭式解，然后特化到加性效应情况 $h=\\tfrac{1}{2}$ 以获得一个显式表达式。对于参数 $N_e=5000$、$s=0.01$、$h=\\tfrac{1}{2}$ 和 $x_0=\\tfrac{1}{2N_e}$，计算固定概率 $u(x_0)$。以小数形式表示你的答案，并四舍五入到五位有效数字。",
            "solution": "问题陈述已根据所需标准进行验证。\n提取已知条件如下：\n- 种群模型：二倍体，随机交配，恒定有效种群大小 $N_e$，带选择的赖特-费舍尔动态。\n- 等位基因：单个基因座上的 $A$ 和 $a$。\n- 相对生存力：$w_{aa}=1$，$w_{Aa}=1+h\\,s$，$w_{AA}=1+s$。\n- 参数：$s>0$，$0 \\leq h \\leq 1$。\n- 初始条件：等位基因 $A$ 的频率为 $x_0 = 1/(2N_e)$。\n- 近似：弱选择，扩散近似有效。\n- 扩散生成元：$L f(x) = a(x)f'(x) + \\frac{1}{2}b(x)f''(x)$。\n- 漂移系数：$a(x) = s\\,x(1-x)\\big[h+(1-2h)\\,x\\big]$。\n- 扩散系数：$b(x) = \\frac{x(1-x)}{2N_e}$。\n- 固定概率 $u(x)$ 满足向后 Kolmogorov 方程 $L u(x) = 0$，边界条件为 $u(0)=0$ 和 $u(1)=1$。\n- 用于评估的具体数值参数：$N_e=5000$，$s=0.01$，$h=1/2$，$x_0=1/(2N_e)$。\n\n验证结论：该问题在科学上基于已建立的群体遗传学理论（赖特-费舍尔模型，扩散近似），在数学上是适定的（一个带有两个边界条件的二阶常微分方程，存在唯一解），并且是客观和自洽的。所有提供的信息都是一致的，参数也是现实的。该问题是有效的。我们进行推导。\n\n从初始频率 $x$ 开始，等位基因 $A$ 的固定概率 $u(x)$ 由向后 Kolmogorov 方程 $L u(x) = 0$ 的解给出，并受边界条件 $u(0)=0$（如果等位基因不存在，则必然丢失）和 $u(1)=1$（如果该等位基因是唯一存在的，则必然固定）的约束。\n方程为：\n$$a(x) u'(x) + \\frac{1}{2}b(x) u''(x) = 0$$\n这是一个二阶线性常微分方程。我们可以通过设 $v(x) = u'(x)$ 来对其降阶，从而得到一个关于 $v(x)$ 的一阶可分离方程：\n$$\\frac{1}{2}b(x) v'(x) = -a(x) v(x)$$\n$$\\frac{v'(x)}{v(x)} = -\\frac{2a(x)}{b(x)}$$\n我们定义一个函数 $\\Psi(x) = \\exp\\left(-\\int \\frac{2a(y)}{b(y)} dy\\right)$。对 $v(x)$ 的方程积分得到 $\\ln(v(x)) = -\\int \\frac{2a(x)}{b(x)} dx + C_0$，这意味着 $v(x) = C_1 \\Psi(x)$，其中 $C_1$ 是某个常数。\n首先，我们计算比率 $\\frac{2a(x)}{b(x)}$:\n$$\\frac{2a(x)}{b(x)} = \\frac{2 s\\,x(1-x)\\big[h+(1-2h)\\,x\\big]}{\\frac{x(1-x)}{2N_e}} = 4N_e s \\big[h+(1-2h)\\,x\\big]$$\n让我们对此项关于等位基因频率（我们用哑变量 $y$ 表示）进行积分：\n$$\\int \\frac{2a(y)}{b(y)} dy = \\int 4N_e s \\big[h+(1-2h)\\,y\\big] dy = 4N_e s \\left(hy + (1-2h)\\frac{y^2}{2}\\right)$$\n我们可以将积分常数设为零，因为它将被吸收到乘法常数 $C_1$ 中。\n因此，$u'(x) = v(x) = C_1 \\exp\\left(-4N_e s \\left(hx + (1-2h)\\frac{x^2}{2}\\right)\\right)$。\n为了求得 $u(x)$，我们将 $u'(y)$ 从 $0$ 积分到 $x$：\n$$u(x) - u(0) = \\int_0^x u'(y) dy$$\n由于 $u(0)=0$，我们有：\n$$u(x) = C_1 \\int_0^x \\exp\\left(-4N_e s \\left(hy + (1-2h)\\frac{y^2}{2}\\right)\\right) dy$$\n为了确定常数 $C_1$，我们应用第二个边界条件 $u(1)=1$：\n$$1 = u(1) = C_1 \\int_0^1 \\exp\\left(-4N_e s \\left(hy + (1-2h)\\frac{y^2}{2}\\right)\\right) dy$$\n这给出 $C_1 = \\left( \\int_0^1 \\exp\\left(-4N_e s \\left(hy + (1-2h)\\frac{y^2}{2}\\right)\\right) dy \\right)^{-1}$。\n将 $C_1$ 代回，我们得到固定概率的求积形式的闭式通解，这就是 Kimura 的著名公式：\n$$u(x) = \\frac{\\int_0^x \\exp\\left(-4N_e s \\left(hy + (1-2h)\\frac{y^2}{2}\\right)\\right) dy}{\\int_0^1 \\exp\\left(-4N_e s \\left(hy + (1-2h)\\frac{y^2}{2}\\right)\\right) dy}$$\n\n接下来，我们特化到加性效应情况，其中显性系数 $h=1/2$。当 $h=1/2$ 时，项 $(1-2h)$ 变为 $1-2(1/2)=0$。被积函数中的指数部分大大简化：\n$$-4N_e s \\left(\\frac{1}{2}y + (0)\\frac{y^2}{2}\\right) = -2N_e s y$$\n$u(x)$ 的表达式变为：\n$$u(x) = \\frac{\\int_0^x \\exp(-2N_e s y) dy}{\\int_0^1 \\exp(-2N_e s y) dy}$$\n这些是初等积分。令 $\\gamma = 2N_e s$。\n分子是 $\\int_0^x \\exp(-\\gamma y) dy = \\left[-\\frac{1}{\\gamma}\\exp(-\\gamma y)\\right]_0^x = -\\frac{1}{\\gamma}(\\exp(-\\gamma x) - 1) = \\frac{1 - \\exp(-\\gamma x)}{\\gamma}$。\n分母是 $\\int_0^1 \\exp(-\\gamma y) dy = \\left[-\\frac{1}{\\gamma}\\exp(-\\gamma y)\\right]_0^1 = -\\frac{1}{\\gamma}(\\exp(-\\gamma) - 1) = \\frac{1 - \\exp(-\\gamma)}{\\gamma}$。\n分子除以分母，$\\gamma$ 项被消去，我们得到加性效应情况下固定概率的显式表达式：\n$$u(x) = \\frac{1 - \\exp(-2N_e s x)}{1 - \\exp(-2N_e s)}$$\n\n最后，我们对初始频率 $x_0 = 1/(2N_e)$ 和给定参数 $N_e=5000$ 及 $s=0.01$ 计算此表达式的值。\n将 $x = x_0 = 1/(2N_e)$ 代入 $u(x)$ 的公式中：\n$$u(x_0) = \\frac{1 - \\exp\\left(-2N_e s \\frac{1}{2N_e}\\right)}{1 - \\exp(-2N_e s)} = \\frac{1 - \\exp(-s)}{1 - \\exp(-2N_e s)}$$\n现在，我们代入数值 $s=0.01$ 和 $N_e=5000$：\n$$u(x_0) = \\frac{1 - \\exp(-0.01)}{1 - \\exp(-2 \\times 5000 \\times 0.01)} = \\frac{1 - \\exp(-0.01)}{1 - \\exp(-100)}$$\n我们计算各项的值：\n分子是 $1 - \\exp(-0.01) \\approx 1 - 0.9900498337 = 0.0099501663$。\n分母中的项 $\\exp(-100)$ 极小，约为 $3.72 \\times 10^{-44}$。\n因此，在所有实际应用中，以及在很多位小数的精度下，分母 $1 - \\exp(-100)$ 等于 $1$。\n因此，固定概率为：\n$$u(x_0) \\approx 1 - \\exp(-0.01) \\approx 0.0099501663$$\n问题要求答案四舍五入到五位有效数字。第一个非零数字是第一位有效数字。这个数是 $0.0099501663...$。前五位有效数字是 $9, 9, 5, 0, 1$。第六位有效数字是 $6$，它大于或等于 $5$，所以我们将第五位数字向上舍入。数字 $1$ 变为 $2$。\n四舍五入后的小数值为 $0.0099502$。",
            "answer": "$$\\boxed{0.0099502}$$"
        },
        {
            "introduction": "在确定了一个等位基因的命运之后，一个自然而然的问题是：这个过程需要多长时间？本练习探讨了演化时间尺度的两个重要方面：等位基因从种群中丢失或固定的无条件平均时间，以及在已知其最终会固定的条件下，到达固定所需的条件平均时间。您将运用随机过程中的条件化等高级技巧，来解决这个在理论和应用上都至关重要的问题。",
            "id": "2700930",
            "problem": "考虑一个随机交配、有效种群大小恒为 $N$ 的群体中，一个没有突变、没有显性的双等位基因座的赖特-费舍尔（Wright-Fisher, WF）扩散近似。令 $X_{t} \\in [0,1]$ 表示在（连续）时间 $t$（以代为单位）时，等位基因 $A$ 的频率。在中性（无选择）条件下，作用于二次连续可微检验函数 $f$ 的柯尔莫哥洛夫后向算子为\n$$\n\\mathcal{L} f(x) \\;=\\; \\frac{x(1-x)}{4N}\\, f^{\\prime\\prime}(x),\n$$\n在 $x=0$ 和 $x=1$ 处有吸收边界。\n\n从这个算子和一维扩散过程吸收时间的基本定义出发，完成以下任务：\n\n1) 推导无条件平均吸收时间 $T(x)$ 所满足的常微分方程，$T(x)$ 是指从 $X_{0}=x$ 开始的 $X_{t}$ 到达任一边界 $\\{0,1\\}$ 的期望时间，并在适当的边界条件下求解该方程。\n\n2) 令 $u(x)$ 为从 $x$ 开始时等位基因 $A$ 的固定概率，并使用马尔可夫过程的条件化原理（使用 $h=u$ 的 Doob h-变换）来构建以最终在 $x=1$ 处固定为条件的后向算子。根据这个变换后的算子，推导以固定为条件的平均固定时间 $T_{\\mathrm{fix}\\mid \\mathrm{fix}}(x)$ 所满足的微分方程，并在适当的边界和正则性条件下求解，以获得一个闭式表达式。\n\n3) 在 $N = 1.0 \\times 10^{5}$ 和初始等位基因频率 $x_{0} = 0.01$ 的条件下，计算这两个表达式的值，并报告这两个数值（无条件平均吸收时间和以固定为条件的平均固定时间），单位为代。答案保留四位有效数字。\n\n你的最终答案必须是按顺序排列的一对数字 $(T(x_{0}),\\, T_{\\mathrm{fix}\\mid \\mathrm{fix}}(x_{0}))$。",
            "solution": "根据既定的科学和数学严谨性原则，对所述问题进行验证。\n\n逐字提取给定条件：\n-   模型：赖特-费舍尔（WF）扩散近似，针对单个双等位基因座。\n-   种群：随机交配，有效种群大小恒为 $N$。\n-   遗传参数：无突变，无显性，无选择（中性）。\n-   状态变量：$X_{t} \\in [0,1]$ 是连续时间 $t$（以代为单位）的等位基因频率。\n-   算子：柯尔莫哥洛夫后向算子为 $\\mathcal{L} f(x) = \\frac{x(1-x)}{4N}\\, f^{\\prime\\prime}(x)$。\n-   边界：在 $x=0$ 和 $x=1$ 处为吸收边界。\n-   待求量：\n    1.  无条件平均吸收时间, $T(x)$。\n    2.  以固定为条件的平均固定时间, $T_{\\mathrm{fix}\\mid \\mathrm{fix}}(x)$。\n-   数值计算参数：$N = 1.0 \\times 10^{5}$，初始频率 $x_{0} = 0.01$。\n\n验证评估：\n该问题具有科学依据，是群体遗传学领域的一个经典问题，基于 Sewall Wright 和 Motoo Kimura 发展的扩散理论。当时间以代为单位测量时，所给出的柯尔莫哥洛夫算子对于中性过程是正确的。该问题是适定的、客观的，并且包含足够的信息以获得唯一解。平均吸收时间和条件固定时间的概念是标准的，可以使用给定的算子和随机过程的基本理论来求解。该问题没有逻辑矛盾、事实错误和歧义。\n\n验证结论：该问题有效。我们继续进行推导和求解。\n\n第1部分：无条件平均吸收时间, $T(x)$\n\n对于从 $x$ 开始的一维扩散过程，其无条件平均吸收时间 $T(x)$ 由 Dynkin 公式决定，该公式导出一个常微分方程（ODE）：\n$$\n\\mathcal{L} T(x) = -1\n$$\n代入给定的算子 $\\mathcal{L}$，我们有：\n$$\n\\frac{x(1-x)}{4N} T^{\\prime\\prime}(x) = -1\n$$\n其中 $T^{\\prime\\prime}(x)$ 是 $T(x)$ 关于 $x$ 的二阶导数。该方程在 $x \\in (0,1)$ 内有效。\n整理后，我们得到：\n$$\nT^{\\prime\\prime}(x) = -\\frac{4N}{x(1-x)}\n$$\n$x=0$ 和 $x=1$ 处的边界是吸收边界。如果过程从吸收边界开始，吸收时间为 $0$。因此，边界条件是：\n$$\nT(0) = 0 \\quad \\text{and} \\quad T(1) = 0\n$$\n我们对 $T^{\\prime\\prime}(x)$ 关于 $x$ 积分一次。使用部分分式分解 $\\frac{1}{x(1-x)} = \\frac{1}{x} + \\frac{1}{1-x}$：\n$$\nT^{\\prime}(x) = \\int -\\frac{4N}{x(1-x)} dx = -4N \\int \\left(\\frac{1}{x} + \\frac{1}{1-x}\\right) dx = -4N \\left(\\ln(x) - \\ln(1-x)\\right) + C_1\n$$\n进行第二次积分：\n$$\nT(x) = \\int \\left(-4N(\\ln(x) - \\ln(1-x)) + C_1\\right) dx\n$$\n使用标准积分 $\\int \\ln(u) du = u \\ln(u) - u$，我们发现：\n$$\nT(x) = -4N \\left[ (x\\ln(x) - x) - (-(1-x)\\ln(1-x) - x) \\right] + C_1 x + C_2\n$$\n$$\nT(x) = -4N \\left( x\\ln(x) + (1-x)\\ln(1-x) \\right) + C_1 x + C_2\n$$\n为了确定常数 $C_1$ 和 $C_2$，我们应用边界条件。我们使用极限 $\\lim_{u\\to 0^+} u\\ln(u) = 0$。\n在 $x=0$ 处：\n$$\n\\lim_{x\\to 0^+} T(x) = -4N \\left( 0 + 1\\ln(1) \\right) + C_1(0) + C_2 = C_2\n$$\n由 $T(0)=0$ 可得 $C_2=0$。\n在 $x=1$ 处：\n$$\n\\lim_{x\\to 1^-} T(x) = -4N \\left( 1\\ln(1) + 0 \\right) + C_1(1) + C_2 = C_1 + C_2\n$$\n由 $T(1)=0$ 和 $C_2=0$ 可得 $C_1=0$。\n因此，无条件平均吸收时间是：\n$$\nT(x) = -4N \\left( x \\ln(x) + (1-x)\\ln(1-x) \\right)\n$$\n\n第2部分：以固定为条件的平均固定时间, $T_{\\mathrm{fix}\\mid \\mathrm{fix}}(x)$\n\n首先，我们确定固定概率 $u(x)$，它满足方程 $\\mathcal{L} u(x) = 0$ 以及边界条件 $u(0)=0$（丢失）和 $u(1)=1$（固定）。\n$$\n\\frac{x(1-x)}{4N} u^{\\prime\\prime}(x) = 0\n$$\n对于 $x \\in (0,1)$，这意味着 $u^{\\prime\\prime}(x)=0$。积分两次得到 $u(x) = C_1 x + C_2$。\n应用边界条件：$u(0)=0 \\implies C_2=0$，以及 $u(1)=1 \\implies C_1=1$。\n因此，固定概率为 $u(x)=x$。\n\n为了找到以固定为条件的动力学，我们使用 Doob h-变换，其中 $h(x) = u(x) = x$。作用于检验函数 $f(x)$ 的条件化过程的后向算子 $\\mathcal{L}^*$ 由下式给出：\n$$\n\\mathcal{L}^* f(x) = \\frac{1}{u(x)} \\mathcal{L} (u(x)f(x))\n$$\n我们来计算 $\\mathcal{L}(x f(x))$：\n$g(x) = x f(x)$ 的二阶导数是 $g^{\\prime\\prime}(x) = \\frac{d}{dx} (f(x) + xf^{\\prime}(x)) = 2f^{\\prime}(x) + xf^{\\prime\\prime}(x)$。\n$$\n\\mathcal{L}(x f(x)) = \\frac{x(1-x)}{4N} (2f^{\\prime}(x) + xf^{\\prime\\prime}(x))\n$$\n将此代入 $\\mathcal{L}^*$ 的表达式中：\n$$\n\\mathcal{L}^* f(x) = \\frac{1}{x} \\left[ \\frac{x(1-x)}{4N} (2f^{\\prime}(x) + xf^{\\prime\\prime}(x)) \\right] = \\frac{x(1-x)}{4N} f^{\\prime\\prime}(x) + \\frac{1-x}{2N} f^{\\prime}(x)\n$$\n以最终固定为条件的平均固定时间 $T_{\\mathrm{fix}\\mid \\mathrm{fix}}(x)$ 满足 $\\mathcal{L}^* T_{\\mathrm{fix}\\mid \\mathrm{fix}}(x) = -1$。\n$$\n\\frac{x(1-x)}{4N} T_{\\mathrm{fix}\\mid \\mathrm{fix}}^{\\prime\\prime}(x) + \\frac{1-x}{2N} T_{\\mathrm{fix}\\mid \\mathrm{fix}}^{\\prime}(x) = -1\n$$\n对于 $x \\in (0,1)$，我们可以乘以 $\\frac{4N}{1-x}$：\n$$\nx T_{\\mathrm{fix}\\mid \\mathrm{fix}}^{\\prime\\prime}(x) + 2 T_{\\mathrm{fix}\\mid \\mathrm{fix}}^{\\prime}(x) = -\\frac{4N}{1-x}\n$$\n这是一个关于 $v(x) = T_{\\mathrm{fix}\\mid \\mathrm{fix}}^{\\prime}(x)$ 的一阶线性常微分方程。左侧可以写成 $(x^2 v(x))' / x$。使用积分因子法更直接。令 $v(x) = T_{\\mathrm{fix}\\mid \\mathrm{fix}}'(x)$。方程为 $v' + \\frac{2}{x} v = -\\frac{4N}{x(1-x)}$。积分因子是 $\\exp(\\int \\frac{2}{x} dx) = x^2$。乘以 $x^2$ 得到：\n$$\nx^2 v'(x) + 2x v(x) = \\frac{d}{dx}(x^2 v(x)) = -\\frac{4Nx}{1-x} = 4N - \\frac{4N}{1-x}\n$$\n关于 $x$ 积分：\n$$\nx^2 v(x) = 4Nx + 4N \\ln(1-x) + C_1\n$$\n$$\nv(x) = T_{\\mathrm{fix}\\mid \\mathrm{fix}}^{\\prime}(x) = \\frac{4N}{x} + \\frac{4N\\ln(1-x)}{x^2} + \\frac{C_1}{x^2}\n$$\n条件化过程在 $x=1$ 处被吸收，而 $x=0$ 处的边界变得不可达（反射）。平均时间 $T_{\\mathrm{fix}\\mid \\mathrm{fix}}(x)$ 在 $x \\to 0^+$ 时必须保持有限。如果 $C_1 \\neq 0$，导数中的 $C_1/x^2$ 项将导致 $T_{\\mathrm{fix}\\mid \\mathrm{fix}}(x)$ 在 $x=0$ 附近出现 $1/x$ 类型的发散。因此，正则性要求 $C_1=0$。\n所以，$T_{\\mathrm{fix}\\mid \\mathrm{fix}}^{\\prime}(x) = \\frac{4N}{x} + \\frac{4N\\ln(1-x)}{x^2}$。\n积分以求得 $T_{\\mathrm{fix}\\mid \\mathrm{fix}}(x)$：\n$$\nT_{\\mathrm{fix}\\mid \\mathrm{fix}}(x) = \\int \\left(\\frac{4N}{x} + \\frac{4N\\ln(1-x)}{x^2}\\right) dx = 4N \\ln(x) + 4N \\int \\frac{\\ln(1-x)}{x^2} dx + C_2\n$$\n第二个积分通过分部积分法求解：$\\int u dv = uv - \\int v du$。令 $u=\\ln(1-x)$ 和 $dv=x^{-2}dx$。则 $du = \\frac{-1}{1-x}dx$ 和 $v=-x^{-1}$。\n$$\n\\int \\frac{\\ln(1-x)}{x^2} dx = -\\frac{\\ln(1-x)}{x} - \\int \\frac{1}{x(1-x)} dx = -\\frac{\\ln(1-x)}{x} - \\ln(x) + \\ln(1-x)\n$$\n代回原式：\n$$\nT_{\\mathrm{fix}\\mid \\mathrm{fix}}(x) = 4N \\ln(x) + 4N \\left( -\\frac{\\ln(1-x)}{x} - \\ln(x) + \\ln(1-x) \\right) + C_2\n$$\n$$\nT_{\\mathrm{fix}\\mid \\mathrm{fix}}(x) = 4N \\left( -\\frac{\\ln(1-x)}{x} + \\ln(1-x) \\right) + C_2 = -4N \\frac{1-x}{x} \\ln(1-x) + C_2\n$$\n条件化过程的边界条件是在 $x=1$ 处吸收，所以 $T_{\\mathrm{fix}\\mid \\mathrm{fix}}(1)=0$。\n取极限 $x \\to 1^-$：\n$$\n\\lim_{x\\to 1^-} T_{\\mathrm{fix}\\mid \\mathrm{fix}}(x) = \\lim_{x\\to 1^-} \\left( -4N \\frac{1-x}{x} \\ln(1-x) \\right) + C_2 = 0 + C_2\n$$\n这意味着 $C_2=0$。\n以固定为条件的平均固定时间是：\n$$\nT_{\\mathrm{fix}\\mid \\mathrm{fix}}(x) = -4N \\frac{1-x}{x} \\ln(1-x)\n$$\n\n第3部分：数值计算\n\n给定 $N = 1.0 \\times 10^5$ 和 $x_0 = 0.01$。\n\n1) 无条件平均吸收时间 $T(x_0)$:\n$$\nT(0.01) = -4(1.0 \\times 10^5) \\left( 0.01 \\ln(0.01) + (1-0.01)\\ln(1-0.01) \\right)\n$$\n$$\nT(0.01) = -4.0 \\times 10^5 \\left( 0.01 \\ln(0.01) + 0.99 \\ln(0.99) \\right)\n$$\n使用计算器：$\\ln(0.01) \\approx -4.60517$ 和 $\\ln(0.99) \\approx -0.0100503$。\n$$\nT(0.01) \\approx -4.0 \\times 10^5 \\left( 0.01(-4.60517) + 0.99(-0.0100503) \\right)\n$$\n$$\nT(0.01) \\approx -4.0 \\times 10^5 \\left( -0.0460517 - 0.0099498 \\right) = -4.0 \\times 10^5(-0.0560015) \\approx 22400.6\n$$\n保留四位有效数字，$T(x_0) = 2.240 \\times 10^4$ 代。\n\n2) 以固定为条件的平均固定时间 $T_{\\mathrm{fix}\\mid \\mathrm{fix}}(x_0)$:\n$$\nT_{\\mathrm{fix}\\mid \\mathrm{fix}}(0.01) = -4(1.0 \\times 10^5) \\frac{1-0.01}{0.01} \\ln(1-0.01)\n$$\n$$\nT_{\\mathrm{fix}\\mid \\mathrm{fix}}(0.01) = -4.0 \\times 10^5 \\frac{0.99}{0.01} \\ln(0.99) = -4.0 \\times 10^5 \\times 99 \\times \\ln(0.99)\n$$\n$$\nT_{\\mathrm{fix}\\mid \\mathrm{fix}}(0.01) \\approx -4.0 \\times 10^5 \\times 99 \\times (-0.0100503) \\approx 397993.3\n$$\n保留四位有效数字，$T_{\\mathrm{fix}\\mid \\mathrm{fix}}(x_0) = 3.980 \\times 10^5$ 代。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 2.240 \\times 10^4 & 3.980 \\times 10^5 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "扩散理论的最终威力在于其能够连接理论模型与真实的遗传数据。本练习将带您进入现代群体遗传学推断的核心，您将从 Fokker-Planck 方程导出等位基因频率的稳态分布。基于此，您将构建位点频率谱（SFS）的似然函数，并实现一个数值优化过程来估计选择强度等关键演化参数，这完美展示了如何利用数学理论从基因组数据中“读取”演化历史。",
            "id": "2700942",
            "problem": "要求您基于扩散近似，为一个在基因选择和双向突变作用下演化的双等位基因座，实现一个基于赖特-费舍尔扩散的推断引擎。您的任务是，使用扩散过程的平稳分布，推导、实现并评估位点频率谱（SFS）的似然，然后为一组测试用例计算标度化选择参数的单参数最大似然估计（MLE）。\n\n从群体遗传学中以下标准的基本出发点开始：\n- 考虑一个有效大小为 $N$ 的群体，其中等位基因 $\\mathsf{1}$ 的频率 $x \\in (0,1)$ 的演化遵循赖特-费舍尔扩散模型，伴有基因选择系数 $s$ 以及双向突变率 $u$（从 $\\mathsf{1}$ 到 $\\mathsf{0}$）和 $v$（从 $\\mathsf{0}$ 到 $\\mathsf{1}$）。该扩散的无穷小均值和方差分别为 $m(x) = s\\,x(1-x) + v(1-x) - u x$ 和 $V(x) = \\frac{x(1-x)}{2N}$。\n- 平稳密度 $\\pi(x)$ 求解边界处概率通量为零的平稳 Fokker–Planck (FP) 方程。使用具有漂移 $m(x)$ 和方差 $V(x)$ 的一维扩散在零通量边界条件下的标准通解来获得 $\\pi(x)$。\n\n基于此，完成以下所有任务：\n1) 推导平稳密度（最多相差一个归一化常数），并用标度化参数 $\\alpha = 4 N v$、$\\beta = 4 N u$ 和 $\\kappa = 4 N s$ 表示。然后，对于从群体中抽取的规模为 $n$ 的样本，推导样本中等位基因 $\\mathsf{1}$ 的计数 $i \\in \\{0,1,\\dots,n\\}$ 的抽样分布的混合表示。抽样概率 $p_i(\\alpha,\\beta,\\kappa;n)$ 必须表示为二项抽样核乘以平稳密度在 $x \\in (0,1)$ 上的积分。您的推导过程必须有理有据，不得预设目标公式；推导应从 FP 平稳解的形式 $p(x) \\propto \\frac{1}{V(x)} \\exp\\left(\\int^x \\frac{2 m(y)}{V(y)} \\, dy\\right)$ 开始，通过代数变换进行。您可以引用经充分检验的特殊函数恒等式来计算积分，但必须证明其适用性。\n2) 为给定的 $(\\alpha,\\beta,\\kappa,n)$，实现对所有 $i \\in \\{0,1,\\dots,n\\}$ 的抽样概率 $p_i(\\alpha,\\beta,\\kappa;n)$ 的数值稳定计算，可通过以下任一方法：\n   - 使用积分 $\\int_0^1 x^{a-1} (1-x)^{b-1} e^{\\kappa x} \\, dx$ 以 Beta 函数和 Kummer 合流超几何函数表示的恒等式，结合精确的二项式系数进行计算，或\n   - 采用高精度数值积分，确保在 $x \\in (0,1)$ 范围内，所有相关积分的绝对精度至少达到 $10^{-10}$。\n   无论采用哪种方法，您的实现都必须在对数域中对乘法项进行操作以避免数值下溢和上溢，并通过对各 $i$ 的未归一化权重进行归一化，以获得一个总和为 $1$ 的有效离散概率向量。\n3) 给定观测到的 SFS 计数 $X_0,\\dots,X_n$，其中 $\\sum_{i=0}^n X_i = L$ 个位点，将对数似然 $\\ell(\\kappa)$ 定义为\n$$\n\\ell(\\kappa) \\;=\\; \\sum_{i=0}^{n} X_i \\,\\log p_i(\\alpha,\\beta,\\kappa;n),\n$$\n其中 $(\\alpha,\\beta,n)$ 是已知且固定的。实现一个稳健的一维数值优化算法，在闭区间 $[\\kappa_{\\min},\\kappa_{\\max}]$ 上找到最大化子 $\\widehat{\\kappa}$。您必须能处理任意非负整数计数，包括某些类别中为零的情况，并确保计算出的概率向量的所有项都严格为正，从而使 $\\ell(\\kappa)$ 有良好定义。报告 $\\widehat{\\kappa}$，四舍五入到六位小数。\n\n测试套件与答案规范：\n- 使用以下三个测试用例。在每个测试用例中，程序必须为指定的 $(n,\\alpha,\\beta)$ 和计数 $(X_0,\\dots,X_n)$ 计算最大似然估计 $\\widehat{\\kappa}$，搜索范围限制在区间 $[\\kappa_{\\min},\\kappa_{\\max}]$ 内。\n\n  - 测试用例 1：\n    - 样本大小：$n = 10$。\n    - 标度化突变参数：$\\alpha = 1.0$，$\\beta = 1.0$。\n    - 选择参数搜索边界：$\\kappa_{\\min} = -6.0$，$\\kappa_{\\max} = 6.0$。\n    - 观测计数向量 $(X_0,\\dots,X_{10})$：\n      $[\\,10,\\,10,\\,10,\\,10,\\,10,\\,10,\\,10,\\,10,\\,10,\\,10,\\,10\\,]$。\n\n  - 测试用例 2：\n    - 样本大小：$n = 10$。\n    - 标度化突变参数：$\\alpha = 1.0$，$\\beta = 1.0$。\n    - 选择参数搜索边界：$\\kappa_{\\min} = -6.0$，$\\kappa_{\\max} = 6.0$。\n    - 观测计数向量 $(X_0,\\dots,X_{10})$：\n      $[\\,2,\\,4,\\,6,\\,8,\\,10,\\,12,\\,14,\\,16,\\,18,\\,20,\\,22\\,]$。\n\n  - 测试用例 3：\n    - 样本大小：$n = 20$。\n    - 标度化突变参数：$\\alpha = 0.5$，$\\beta = 2.0$。\n    - 选择参数搜索边界：$\\kappa_{\\min} = -10.0$，$\\kappa_{\\max} = 10.0$。\n    - 观测计数向量 $(X_0,\\dots,X_{20})$：\n      $[\\,42,\\,40,\\,38,\\,36,\\,34,\\,32,\\,30,\\,28,\\,26,\\,24,\\,22,\\,20,\\,18,\\,16,\\,14,\\,12,\\,10,\\,8,\\,6,\\,4,\\,2\\,]$。\n\n- 您的程序必须实现上述数值稳定的计算，并按顺序为每个测试用例返回 MLE $\\widehat{\\kappa}$，该值应为实数，并四舍五入到六位小数。\n\n最终输出格式：\n- 您的程序应产生单行输出，其中包含用方括号括起来的逗号分隔的结果列表，例如：\n  $[\\,\\widehat{\\kappa}_1,\\,\\widehat{\\kappa}_2,\\,\\widehat{\\kappa}_3\\,]$，\n  其中每个 $\\widehat{\\kappa}_j$ 的小数点后精确打印六位数字。",
            "solution": "所提出的问题是计算群体遗传学中一个良置且有科学依据的任务。它要求推导 Wright-Fisher 扩散的平稳分布，随后计算位点频率谱（SFS）的似然，并为标度化选择参数 $\\kappa$ 实现一个最大似然估计（MLE）程序。我们将先进行系统性推导，然后描述其数值实现。\n\n此分析的基础是一维 Fokker-Planck 方程，该方程描述了等位基因频率概率密度函数 $p(x,t)$ 的演化。平稳分布 $\\pi(x)$ 是该方程在 $t \\to \\infty$ 时的解，此时 $\\frac{\\partial p}{\\partial t} = 0$。对于一个具有无穷小均值 $m(x)$ 和方差 $V(x)$ 的扩散过程，在 $x=0$ 和 $x=1$ 处具有零通量边界条件下的平稳解由下式给出：\n$$\n\\pi(x) = \\frac{C}{V(x)} \\exp\\left( \\int \\frac{2 m(x')}{V(x')} \\, dx' \\right)\n$$\n其中 $C$ 是一个归一化常数，确保 $\\int_0^1 \\pi(x) \\, dx = 1$。\n\n问题提供了具有基因选择和双向突变的双等位基因座的漂移和扩散系数：\n$$\nm(x) = s\\,x(1-x) + v(1-x) - u x\n$$\n$$\nV(x) = \\frac{x(1-x)}{2N}\n$$\n这里，$x$ 是等位基因 $\\mathsf{1}$ 的频率，$s$ 是选择系数，$u$ 和 $v$ 分别是从 $\\mathsf{1} \\to \\mathsf{0}$ 和 $\\mathsf{0} \\to \\mathsf{1}$ 的突变率，$N$ 是有效种群大小。\n\n首先，我们计算被积函数 $\\frac{2 m(x')}{V(x')}$：\n$$\n\\frac{2 m(x')}{V(x')} = \\frac{2 \\left( s\\,x'(1-x') + v(1-x') - u x' \\right)}{\\frac{x'(1-x')}{2N}} = 4N \\left( s + \\frac{v}{x'} - \\frac{u}{1-x'} \\right)\n$$\n引入标准的标度化参数 $\\kappa = 4Ns$、$\\alpha = 4Nv$ 和 $\\beta = 4Nu$，表达式变为：\n$$\n\\frac{2 m(x')}{V(x')} = \\kappa + \\frac{\\alpha}{x'} - \\frac{\\beta}{1-x'}\n$$\n接下来，我们对 $x'$ 进行不定积分：\n$$\n\\int \\left( \\kappa + \\frac{\\alpha}{x'} - \\frac{\\beta}{1-x'} \\right) dx' = \\kappa x' + \\alpha \\ln(x') + \\beta \\ln(1-x') + \\text{const.}\n$$\n将此结果代回 $\\pi(x)$ 的公式，并将常数吸收到主归一化常数 $C'$ 中，我们得到：\n$$\n\\pi(x) \\propto \\frac{1}{\\frac{x(1-x)}{2N}} \\exp\\left( \\kappa x + \\alpha \\ln x + \\beta \\ln(1-x) \\right)\n$$\n$$\n\\pi(x) \\propto \\frac{1}{x(1-x)} e^{\\kappa x} x^{\\alpha} (1-x)^{\\beta}\n$$\n这简化为此模型的著名平稳分布：\n$$\n\\pi(x) = C^{-1} x^{\\alpha-1} (1-x)^{\\beta-1} e^{\\kappa x}\n$$\n其中 $C = \\int_0^1 x'^{\\alpha-1} (1-x')^{\\beta-1} e^{\\kappa x'} \\, dx'$ 是归一化常数。\n\n给定从群体中抽取的规模为 $n$ 的样本，观察到等位基因 $\\mathsf{1}$ 的次数（记为 $i$）在给定群体频率 $x$ 的条件下遵循二项分布：\n$$\nP(i | x) = \\binom{n}{i} x^i (1-x)^{n-i}\n$$\n观察到 $i$ 个衍生等位基因的边缘概率 $p_i$ 是通过对所有可能的群体频率 $x$ 进行积分得到的，并以平稳分布 $\\pi(x)$ 进行加权：\n$$\np_i(\\alpha,\\beta,\\kappa;n) = \\int_0^1 P(i | x) \\pi(x) \\, dx = \\int_0^1 \\binom{n}{i} x^i (1-x)^{n-i} \\left( C^{-1} x^{\\alpha-1} (1-x)^{\\beta-1} e^{\\kappa x} \\right) \\, dx\n$$\n合并各项，我们得到抽样概率的混合表示：\n$$\np_i = C^{-1} \\binom{n}{i} \\int_0^1 x^{i+\\alpha-1} (1-x)^{n-i+\\beta-1} e^{\\kappa x} \\, dx\n$$\n概率 $p_i$ 的总和必须为 $1$。与其显式计算涉及特殊函数的归一化常数 $C$，我们可以定义未归一化的权重 $w_i$ 并对其进行数值归一化：\n$$\nw_i = \\binom{n}{i} \\int_0^1 x^{i+\\alpha-1} (1-x)^{n-i+\\beta-1} e^{\\kappa x} \\, dx\n$$\n然后，概率为 $p_i = w_i / \\sum_{j=0}^n w_j$。这种方法在数值上更为稳健。\n\n在实现中，积分将按照规定使用高精度数值积分计算。直接计算 $w_i$ 项容易出现数值下溢或上溢。因此，所有计算都在对数域中进行。\n未归一化权重的对数为：\n$$\n\\log w_i = \\log \\binom{n}{i} + \\log \\left( \\int_0^1 x^{i+\\alpha-1} (1-x)^{n-i+\\beta-1} e^{\\kappa x} \\, dx \\right)\n$$\n对数二项式系数 $\\log \\binom{n}{i}$ 使用 `gammaln` 函数计算以保持精度。积分使用 `scipy.integrate.quad` 以高精度容差计算。此方法对于在边界 $x=0$ 或 $x=1$ 处（当 $\\alpha<1$ 或 $\\beta<1$ 时）可能出现的可积奇点具有稳健性。\n\n一旦计算出对数权重向量 $[\\log w_0, \\dots, \\log w_n]$，就可以通过 log-sum-exp 技巧获得对数概率 $\\log p_i$，以防止归一化过程中的数值不稳定性：\n$$\n\\log p_i = \\log w_i - \\log\\left(\\sum_{j=0}^{n} e^{\\log w_j}\\right) = \\log w_i - \\left( L_{\\max} + \\log\\left(\\sum_{j=0}^{n} e^{\\log w_j - L_{\\max}}\\right) \\right)\n$$\n这里 $L_{\\max} = \\max_j(\\log w_j)$。\n\n对于给定的 $\\kappa$，观测到的 SFS 数据 $X = [X_0, \\dots, X_n]$ 的对数似然为：\n$$\n\\ell(\\kappa) = \\sum_{i=0}^{n} X_i \\log p_i(\\alpha,\\beta,\\kappa;n)\n$$\n我们的目标是找到最大似然估计 $\\widehat{\\kappa}$，它在指定区间 $[\\kappa_{\\min}, \\kappa_{\\max}]$ 上最大化该函数。这可以通过使用数值优化器最小化负对数似然 $-\\ell(\\kappa)$ 来实现。对于这个一维有界优化问题，使用 `scipy.optimize.minimize_scalar` 的 'bounded' 方法是合适的工具。\n\n最终算法如下：\n1. 对于每个测试用例，定义一个以 $\\kappa$ 为输入的目标函数 `neg_log_likelihood(kappa)`。\n2. 在此函数内部，使用上述基于数值积分的对数空间方法计算对数概率向量 $[\\log p_0, \\dots, \\log p_n]$。\n3. 计算负对数似然 $-\\sum_{i=0}^{n} X_i \\log p_i$ 并返回。\n4. 将此目标函数以及边界 $[\\kappa_{\\min}, \\kappa_{\\max}]$ 传递给 `scipy.optimize.minimize_scalar`。\n5. 优化器返回最小化该函数的值 $\\widehat{\\kappa}$，该值对应于 MLE。\n6. 按要求报告结果，四舍五入到六位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import gammaln\nfrom scipy.integrate import quad\nfrom scipy.optimize import minimize_scalar\n\ndef _calculate_log_sfs(kappa: float, n: int, alpha: float, beta: float) -> np.ndarray:\n    \"\"\"\n    Computes the logarithm of the site frequency spectrum (SFS) probabilities, log(p_i).\n    \n    This function calculates the probability p_i of observing i derived alleles in a sample\n    of size n, under the stationary distribution of a Wright-Fisher diffusion with\n    selection (kappa), and bidirectional mutation (alpha, beta).\n\n    The calculation is performed in log-space to maintain numerical stability.\n    The integral part of the formula is computed using high-accuracy numerical quadrature.\n    \"\"\"\n    # Precompute log binomial coefficients for all i from 0 to n\n    log_binom_coeffs = gammaln(n + 1) - gammaln(np.arange(n + 1) + 1) - gammaln(n - np.arange(n + 1) + 1)\n\n    log_unnorm_probs = np.zeros(n + 1)\n\n    for i in range(n + 1):\n        # Define exponents for the integrand\n        a = i + alpha\n        b = n - i + beta\n        \n        # The integrand is x^(a-1) * (1-x)^(b-1) * exp(kappa*x).\n        # We define it inside the loop to capture the current values of a, b, and kappa.\n        def integrand(x: float) -> float:\n            # The exponents a-1 and b-1 can be negative if alpha or beta are < 1,\n            # creating integrable singularities at x=0 or x=1. `quad` handles this.\n            return x**(a - 1) * (1 - x)**(b - 1) * np.exp(kappa * x)\n        \n        # Perform numerical integration with high precision.\n        # The problem requires at least 1e-10 absolute accuracy.\n        integral_val, _ = quad(integrand, 0, 1, epsabs=1e-12, epsrel=1e-12)\n        \n        # Safeguard against numerical underflow where integral becomes non-positive.\n        if integral_val <= 0:\n            log_unnorm_probs[i] = -np.inf\n        else:\n            log_unnorm_probs[i] = log_binom_coeffs[i] + np.log(integral_val)\n\n    # Normalize the probabilities using the log-sum-exp trick for stability\n    max_log_prob = np.max(log_unnorm_probs)\n    \n    # If all probabilities underflow to -inf, this would cause an error.\n    # Return uniform log-probabilities as a failsafe.\n    if not np.isfinite(max_log_prob):\n        return np.full(n + 1, -np.log(n + 1))\n        \n    log_shifted_probs = log_unnorm_probs - max_log_prob\n    log_norm_const = max_log_prob + np.log(np.sum(np.exp(log_shifted_probs)))\n    \n    log_sfs = log_unnorm_probs - log_norm_const\n    return log_sfs\n\ndef make_neg_log_likelihood(counts: list[int], n: int, alpha: float, beta: float):\n    \"\"\"\n    Factory function that creates the negative log-likelihood function for a given dataset.\n    This allows us to pass a simple one-parameter function to the optimizer.\n    \"\"\"\n    counts_arr = np.array(counts, dtype=float)\n    \n    # Memoization cache to store results for previously computed kappa values\n    memo = {}\n\n    def neg_log_likelihood(kappa: float) -> float:\n        if kappa in memo:\n            return memo[kappa]\n\n        # Calculate log probabilities of the SFS for the given kappa\n        log_p = _calculate_log_sfs(kappa, n, alpha, beta)\n        \n        # Calculate the log-likelihood as the dot product of counts and log-probabilities.\n        # This correctly handles cases where X_i = 0.\n        log_likelihood = np.dot(counts_arr, log_p)\n        \n        # The optimizer minimizes, so we return the negative log-likelihood.\n        # Handle cases where log-likelihood is -inf (i.e., probability is zero)\n        if not np.isfinite(log_likelihood):\n            result = np.inf\n        else:\n            result = -log_likelihood\n        \n        memo[kappa] = result\n        return result\n        \n    return neg_log_likelihood\n\ndef solve():\n    \"\"\"\n    Main function to run the test cases and compute MLE for kappa.\n    \"\"\"\n    test_cases = [\n        {\n            \"n\": 10, \"alpha\": 1.0, \"beta\": 1.0, \n            \"kappa_min\":-6.0, \"kappa_max\": 6.0,\n            \"counts\": [10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10]\n        },\n        {\n            \"n\": 10, \"alpha\": 1.0, \"beta\": 1.0,\n            \"kappa_min\": -6.0, \"kappa_max\": 6.0,\n            \"counts\": [2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22]\n        },\n        {\n            \"n\": 20, \"alpha\": 0.5, \"beta\": 2.0,\n            \"kappa_min\": -10.0, \"kappa_max\": 10.0,\n            \"counts\": [42, 40, 38, 36, 34, 32, 30, 28, 26, 24, 22, 20, 18, 16, 14, 12, 10, 8, 6, 4, 2]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # Create the objective function for the current test case\n        neg_log_lik = make_neg_log_likelihood(\n            counts=case[\"counts\"],\n            n=case[\"n\"],\n            alpha=case[\"alpha\"],\n            beta=case[\"beta\"]\n        )\n\n        # Find the minimum of the negative log-likelihood within the specified bounds\n        opt_result = minimize_scalar(\n            neg_log_lik,\n            bounds=(case[\"kappa_min\"], case[\"kappa_max\"]),\n            method='bounded'\n        )\n        \n        # The MLE kappa is the value that minimizes the function\n        kappa_mle = opt_result.x\n        results.append(kappa_mle)\n\n    # Format the final output as specified\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```"
        }
    ]
}