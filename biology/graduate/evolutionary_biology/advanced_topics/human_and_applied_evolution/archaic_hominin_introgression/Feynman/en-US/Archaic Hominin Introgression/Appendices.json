{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of studying archaic introgression is the use of allele frequency correlation statistics, such as $f$-statistics, to detect and quantify admixture events. This first practice  focuses on a common scenario: estimating the Neanderthal admixture proportion, $\\hat{\\alpha}$, using an $f_4$-ratio. You will apply the multivariate delta method to not only calculate the admixture fraction but also to properly estimate its standard error, a critical step for any robust statistical inference in genomics that accounts for uncertainty in both the numerator and denominator of the ratio.",
            "id": "2692273",
            "problem": "In a study of archaic hominin introgression, consider the four-population statistic $f_4(A,B;C,D)$ defined as the expected product of allele-frequency differences across loci, $f_4(A,B;C,D) = \\mathbb{E}\\left[(p_A - p_B)(p_C - p_D)\\right]$, where $p_X$ denotes the allele frequency in population $X$. For a Test population $T$, an Outgroup $O$, a Neanderthal reference $N$, a Denisovan reference $D$, and a modern human Reference $R$ known to lack Neanderthal ancestry, an $f_4$-ratio estimator of Neanderthal admixture proportion is defined as\n$$\n\\hat{\\alpha} \\equiv \\frac{\\widehat{f_4}(T,O;N,D)}{\\widehat{f_4}(R,O;N,D)} \\equiv \\frac{\\hat{f}_1}{\\hat{f}_2}.\n$$\nBlock jackknife (BJ) across large genomic segments was used to estimate the means and the $2 \\times 2$ covariance matrix of the vector $(\\hat{f}_1,\\hat{f}_2)^{\\top}$. The BJ estimates are:\n$$\n\\hat{f}_1 = 1.30 \\times 10^{-4}, \\qquad \\hat{f}_2 = 6.10 \\times 10^{-3},\n$$\nand\n$$\n\\widehat{\\Sigma} = \n\\begin{pmatrix}\n2.4 \\times 10^{-9} & -3.0 \\times 10^{-9} \\\\\n-3.0 \\times 10^{-9} & 1.3 \\times 10^{-7}\n\\end{pmatrix}.\n$$\nUsing first principles of error propagation for smooth functions of random variables, apply the multivariate delta method to compute the standard error $\\operatorname{se}(\\hat{\\alpha}) = \\sqrt{\\operatorname{Var}(\\hat{\\alpha})}$, explicitly accounting for the covariance between $\\hat{f}_1$ and $\\hat{f}_2$. You may treat $(\\hat{f}_1,\\hat{f}_2)^{\\top}$ as approximately jointly normal with mean $(\\hat{f}_1,\\hat{f}_2)^{\\top}$ and covariance $\\widehat{\\Sigma}$.\n\nReport only the standard error $\\operatorname{se}(\\hat{\\alpha})$ (dimensionless) as your final answer, rounded to three significant figures.",
            "solution": "The problem as stated is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. It is therefore deemed valid. The task is to compute the standard error of a ratio estimator using the multivariate delta method.\n\nLet the vector of statistics be $\\boldsymbol{\\theta} = (\\hat{f}_1, \\hat{f}_2)^{\\top}$. The estimator for the admixture proportion is a function of these statistics, $\\hat{\\alpha} = g(\\boldsymbol{\\theta}) = g(\\hat{f}_1, \\hat{f}_2) = \\frac{\\hat{f}_1}{\\hat{f}_2}$. The multivariate delta method provides a first-order approximation for the variance of a smooth function of random variables. If $\\boldsymbol{\\theta}$ is a random vector with mean $\\boldsymbol{\\mu}$ and covariance matrix $\\Sigma$, then the variance of $g(\\boldsymbol{\\theta})$ is approximated by:\n$$\n\\operatorname{Var}(g(\\boldsymbol{\\theta})) \\approx \\left[ \\nabla g(\\boldsymbol{\\mu}) \\right]^{\\top} \\Sigma \\left[ \\nabla g(\\boldsymbol{\\mu}) \\right]\n$$\nIn this problem, we use the estimated means and covariance matrix. The mean is approximated by the sample estimates $\\boldsymbol{\\mu} \\approx (\\hat{f}_1, \\hat{f}_2)^{\\top}$ and the covariance matrix is the given $\\widehat{\\Sigma}$.\n\nFirst, we compute the gradient of the function $g(x_1, x_2) = \\frac{x_1}{x_2}$. The partial derivatives are:\n$$\n\\frac{\\partial g}{\\partial x_1} = \\frac{1}{x_2}\n$$\n$$\n\\frac{\\partial g}{\\partial x_2} = -\\frac{x_1}{x_2^2}\n$$\nThe gradient vector, which we denote by $\\mathbf{J}$, is evaluated at the point $(\\hat{f}_1, \\hat{f}_2)$:\n$$\n\\mathbf{J} = \\nabla g(\\hat{f}_1, \\hat{f}_2) = \\begin{pmatrix} \\frac{1}{\\hat{f}_2} \\\\ -\\frac{\\hat{f}_1}{\\hat{f}_2^2} \\end{pmatrix}\n$$\nThe variance of $\\hat{\\alpha}$ is then given by the quadratic form:\n$$\n\\operatorname{Var}(\\hat{\\alpha}) \\approx \\mathbf{J}^{\\top} \\widehat{\\Sigma} \\mathbf{J} = \\begin{pmatrix} \\frac{1}{\\hat{f}_2} & -\\frac{\\hat{f}_1}{\\hat{f}_2^2} \\end{pmatrix} \\widehat{\\Sigma} \\begin{pmatrix} \\frac{1}{\\hat{f}_2} \\\\ -\\frac{\\hat{f}_1}{\\hat{f}_2^2} \\end{pmatrix}\n$$\nLet the elements of the covariance matrix be $\\widehat{\\Sigma} = \\begin{pmatrix} \\sigma_{11} & \\sigma_{12} \\\\ \\sigma_{21} & \\sigma_{22} \\end{pmatrix}$. Note that $\\sigma_{12} = \\sigma_{21}$. Expanding the matrix product gives the expression for the variance:\n$$\n\\operatorname{Var}(\\hat{\\alpha}) \\approx \\left(\\frac{1}{\\hat{f}_2}\\right)^2 \\sigma_{11} + 2 \\left(\\frac{1}{\\hat{f}_2}\\right) \\left(-\\frac{\\hat{f}_1}{\\hat{f}_2^2}\\right) \\sigma_{12} + \\left(-\\frac{\\hat{f}_1}{\\hat{f}_2^2}\\right)^2 \\sigma_{22}\n$$\nSimplifying this expression, we get:\n$$\n\\operatorname{Var}(\\hat{\\alpha}) \\approx \\frac{\\sigma_{11}}{\\hat{f}_2^2} - \\frac{2\\hat{f}_1\\sigma_{12}}{\\hat{f}_2^3} + \\frac{\\hat{f}_1^2\\sigma_{22}}{\\hat{f}_2^4}\n$$\nThis can be rewritten more compactly in terms of $\\hat{\\alpha} = \\hat{f}_1/\\hat{f}_2$:\n$$\n\\operatorname{Var}(\\hat{\\alpha}) \\approx \\frac{1}{\\hat{f}_2^2} \\left( \\sigma_{11} - 2\\hat{\\alpha}\\sigma_{12} + \\hat{\\alpha}^2\\sigma_{22} \\right)\n$$\nWe are given the following numerical values:\n$\\hat{f}_1 = 1.30 \\times 10^{-4}$\n$\\hat{f}_2 = 6.10 \\times 10^{-3}$\n$\\sigma_{11} = 2.4 \\times 10^{-9}$\n$\\sigma_{12} = -3.0 \\times 10^{-9}$\n$\\sigma_{22} = 1.3 \\times 10^{-7}$\n\nFirst, we calculate the estimated admixture proportion $\\hat{\\alpha}$:\n$$\n\\hat{\\alpha} = \\frac{\\hat{f}_1}{\\hat{f}_2} = \\frac{1.30 \\times 10^{-4}}{6.10 \\times 10^{-3}} = \\frac{1.30}{61.0} \\approx 0.021311475\n$$\nNow, substitute the values into the variance formula:\n$$\n\\operatorname{Var}(\\hat{\\alpha}) \\approx \\frac{1}{\\left(6.10 \\times 10^{-3}\\right)^2} \\left[ \\left(2.4 \\times 10^{-9}\\right) - 2\\left(\\frac{1.30}{61.0}\\right)\\left(-3.0 \\times 10^{-9}\\right) + \\left(\\frac{1.30}{61.0}\\right)^2\\left(1.3 \\times 10^{-7}\\right) \\right]\n$$\n$$\n\\operatorname{Var}(\\hat{\\alpha}) \\approx \\frac{1}{3.721 \\times 10^{-5}} \\left[ 2.4 \\times 10^{-9} + \\left(\\frac{7.8}{61.0}\\right) \\times 10^{-9} + \\left(\\frac{1.69}{3721}\\right)\\left(1.3 \\times 10^{-7}\\right) \\right]\n$$\nTo maintain precision, we factor out $10^{-9}$:\n$$\n\\operatorname{Var}(\\hat{\\alpha}) \\approx \\frac{10^{-9}}{3.721 \\times 10^{-5}} \\left[ 2.4 + \\frac{7.8}{61.0} + \\frac{1.69 \\times 130}{3721} \\right]\n$$\n$$\n\\operatorname{Var}(\\hat{\\alpha}) \\approx \\frac{10^{-4}}{3.721} \\left[ 2.4 + 0.1278688... + 0.0590432... \\right]\n$$\n$$\n\\operatorname{Var}(\\hat{\\alpha}) \\approx \\frac{10^{-4}}{3.721} \\left[ 2.586912... \\right] \\approx 0.695219... \\times 10^{-4} = 6.95219... \\times 10^{-5}\n$$\nThe standard error, $\\operatorname{se}(\\hat{\\alpha})$, is the square root of the variance:\n$$\n\\operatorname{se}(\\hat{\\alpha}) = \\sqrt{\\operatorname{Var}(\\hat{\\alpha})} \\approx \\sqrt{6.95219... \\times 10^{-5}} \\approx 0.00833798...\n$$\nRounding the result to three significant figures, as required, we obtain:\n$$\n\\operatorname{se}(\\hat{\\alpha}) \\approx 0.00834\n$$\nThis is expressed in scientific notation as $8.34 \\times 10^{-3}$.",
            "answer": "$$\n\\boxed{8.34 \\times 10^{-3}}\n$$"
        },
        {
            "introduction": "Once an introgression event is detected, a natural next question is *when* it occurred, which can be estimated by analyzing the lengths of introgressed genomic segments that are broken down by recombination over generations. This exercise  guides you through deriving and applying a fundamental model where the mean tract length, $\\bar{L}$, is used to estimate the time since admixture, $t_a$. This provides a powerful link between a simple mechanistic model of recombination and a deep-time evolutionary parameter, further sharpening your skills in statistical estimation and error propagation.",
            "id": "2692279",
            "problem": "A single-pulse archaic hominin introgression event occurred $t_a$ generations ago into an anatomically modern human population. After the admixture pulse, recombination breaks introgressed ancestry tracts each generation, and with a uniform per-base recombination rate $r$ (in $\\text{bp}^{-1}\\text{gen}^{-1}$), the lengths of introgressed tracts (measured in base pairs) can be modeled by a memoryless process along the chromosome. You are given an empirical estimate of the mean tract length $\\bar{L} = 70$ kb from a curated set of introgressed tracts inferred in present-day genomes, and a recombination rate $r = 1.0 \\times 10^{-8}$ per base pair per generation. A generation time of $29$ years is assumed. A block-bootstrap analysis of individuals and genomic regions yields an estimated variance of the sample mean tract length $\\text{Var}[\\bar{L}] = 4.9$ $(\\text{kb})^2$.\n\nUsing only foundational population-genetic reasoning about recombination breakpoints over $t_a$ generations after a single pulse of admixture, proceed as follows:\n\n- Derive an estimator for $t_a$ in generations in terms of $\\bar{L}$ and $r$, and compute its numerical value.\n- Convert the point estimate to years using the given generation time.\n- Using the delta method with the provided $\\text{Var}[\\bar{L}]$, compute an approximate $95\\%$ confidence interval (confidence interval (CI)) for $t_a$ in generations and convert that interval to years.\n\nAssume a single-pulse admixture model, spatially uniform recombination rate, and negligible gene conversion. Round all reported numerical values to three significant figures. Express the time estimates in generations and in years (state the units in your working), but note that only pure numbers will be checked for grading. For numerical computation, remember that $1$ kb $= 1000$ bp.",
            "solution": "The problem as stated is scientifically grounded, well-posed, and objective. It describes a standard simplified model used in population genetics to date admixture events based on the decay of ancestry tract lengths due to recombination. The provided parameters are realistic, and the required calculations are standard statistical procedures. We shall therefore proceed to the solution.\n\nThe foundational principle is that the lengths of introgressed chromosome tracts, originating from a single pulse of admixture $t_a$ generations ago, follow an exponential distribution. This arises from modeling recombination breakpoints as a Poisson process along the chromosome. Let $r$ be the uniform recombination rate per base pair per generation. Over $t_a$ generations, the cumulative rate of breakpoints that terminate an ancestry tract is $\\lambda = t_a r$.\n\nThe probability density function for the length $L$ of a tract is given by $f(L) = \\lambda \\exp(-\\lambda L)$. The expected value, or mean length, of tracts from this exponential distribution is $E[L] = \\frac{1}{\\lambda}$.\n\nBy substituting $\\lambda = t_a r$, we obtain the relationship between the mean tract length and the time since admixture:\n$$E[L] = \\frac{1}{t_a r}$$\nThe empirically measured mean tract length, $\\bar{L}$, serves as an estimator for the true population mean $E[L]$. Thus, we can write $\\bar{L} \\approx \\frac{1}{t_a r}$. From this relationship, we derive the estimator for the number of generations since admixture, $\\hat{t}_a$, as a function of the observable quantity $\\bar{L}$ and the fixed parameter $r$:\n$$\\hat{t}_a = \\frac{1}{r \\bar{L}}$$\nThis is the required estimator for $t_a$.\n\nWe now compute the point estimate for $t_a$. The given values are $\\bar{L} = 70$ kb and $r = 1.0 \\times 10^{-8} \\text{ bp}^{-1}\\text{gen}^{-1}$. For dimensional consistency, we must express $\\bar{L}$ in base pairs (bp), using the conversion $1 \\text{ kb} = 1000 \\text{ bp}$:\n$$\\bar{L} = 70 \\text{ kb} = 70 \\times 1000 \\text{ bp} = 7 \\times 10^4 \\text{ bp}$$\nSubstituting the numerical values into our estimator:\n$$\\hat{t}_a = \\frac{1}{(1.0 \\times 10^{-8} \\text{ bp}^{-1}\\text{gen}^{-1}) \\times (7 \\times 10^4 \\text{ bp})} = \\frac{1}{7 \\times 10^{-4}} \\text{ gen} \\approx 1428.57 \\text{ generations}$$\nRounding to three significant figures, the point estimate is $\\hat{t}_a \\approx 1.43 \\times 10^3$ generations.\n\nTo convert this time into years, we use the specified generation time of $29$ years:\n$$\\text{Time in years} = \\hat{t}_a \\times 29 \\text{ years/gen} \\approx 1428.57 \\times 29 \\approx 41428.5 \\text{ years}$$\nRounding to three significant figures, this corresponds to $4.14 \\times 10^4$ years.\n\nNext, we compute the $95\\%$ confidence interval for $t_a$ utilizing the delta method. The delta method approximates the variance of a function of a random variable. Our estimator, $\\hat{t}_a = g(\\bar{L}) = (r\\bar{L})^{-1}$, is a function of the random variable $\\bar{L}$. The variance of $g(\\bar{L})$ is approximated as $\\text{Var}[\\hat{t}_a] \\approx (g'(\\mu_{\\bar{L}}))^2 \\text{Var}[\\bar{L}]$, where we use the sample mean $\\bar{L}$ as an estimate for its expected value $\\mu_{\\bar{L}}$. The derivative of $g(\\bar{L})$ with respect to $\\bar{L}$ is:\n$$g'(\\bar{L}) = \\frac{d}{d\\bar{L}} \\left( \\frac{1}{r\\bar{L}} \\right) = -\\frac{1}{r\\bar{L}^2}$$\nThe variance of our estimator is therefore:\n$$\\text{Var}[\\hat{t}_a] \\approx \\left(-\\frac{1}{r\\bar{L}^2}\\right)^2 \\text{Var}[\\bar{L}] = \\frac{\\text{Var}[\\bar{L}]}{r^2\\bar{L}^4}$$\nThis expression can be rewritten in terms of the point estimate $\\hat{t}_a = \\frac{1}{r\\bar{L}}$:\n$$\\text{Var}[\\hat{t}_a] \\approx \\left(\\frac{1}{r\\bar{L}}\\right)^2 \\frac{\\text{Var}[\\bar{L}]}{\\bar{L}^2} = \\hat{t}_a^2 \\frac{\\text{Var}[\\bar{L}]}{\\bar{L}^2}$$\nWe are given $\\text{Var}[\\bar{L}] = 4.9 \\text{ (kb)}^2$. The squared coefficient of variation of $\\bar{L}$ is:\n$$\\frac{\\text{Var}[\\bar{L}]}{\\bar{L}^2} = \\frac{4.9 \\text{ (kb)}^2}{(70 \\text{ kb})^2} = \\frac{4.9}{4900} = 0.001$$\nThe variance of $\\hat{t}_a$ is then:\n$$\\text{Var}[\\hat{t}_a] \\approx (1428.57 \\text{ gen})^2 \\times 0.001 \\approx 2040.8 \\text{ gen}^2$$\nThe standard error (SE) of the estimate is the square root of its variance:\n$$SE(\\hat{t}_a) = \\sqrt{\\text{Var}[\\hat{t}_a]} \\approx \\sqrt{2040.8} \\approx 45.175 \\text{ generations}$$\nAn approximate $95\\%$ confidence interval is given by $\\hat{t}_a \\pm z_{0.025} \\times SE(\\hat{t}_a)$, where $z_{0.025} \\approx 1.96$ is the critical value from the standard normal distribution. The margin of error is $1.96 \\times 45.175 \\approx 88.543$ generations.\n\nThe $95\\%$ confidence interval for $t_a$ in generations is:\n$$[1428.57 - 88.543, \\quad 1428.57 + 88.543] = [1340.027, \\quad 1517.113] \\text{ generations}$$\nRounding the bounds to three significant figures, the interval is $[1.34 \\times 10^3, 1.52 \\times 10^3]$ generations.\n\nFinally, we convert this interval to years by multiplying the unrounded bounds by the generation time of $29$ years:\n$$\\text{Lower bound (years)}: 1340.027 \\times 29 \\approx 38860.8 \\text{ years}$$\n$$\\text{Upper bound (years)}: 1517.113 \\times 29 \\approx 43996.3 \\text{ years}$$\nRounding to three significant figures, the $95\\%$ confidence interval in years is $[3.89 \\times 10^4, 4.40 \\times 10^4]$ years.\n\nThe requested numerical results are the point estimate for admixture time in generations and years, and the corresponding $95\\%$ confidence interval bounds.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.43 \\times 10^3 & 4.14 \\times 10^4 & 1.34 \\times 10^3 & 1.52 \\times 10^3 & 3.89 \\times 10^4 & 4.40 \\times 10^4\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "A significant challenge in population genetics is that different demographic histories can sometimes produce identical statistical signatures, a phenomenon known as model mimicry. This advanced exercise  confronts this issue directly, demonstrating how a model of deep ancestral structure can be indistinguishable from a model of recent introgression when using only $f_4$-statistics. You will then explore how an orthogonal source of information—the decay of admixture linkage disequilibrium (LD) with genetic distance—can be used as a powerful auxiliary statistic to resolve this critical ambiguity.",
            "id": "2692318",
            "problem": "You are asked to formalize two alternative demographic models that can produce nearly indistinguishable signals under standard allele frequency correlation statistics, and to design a principled auxiliary statistic that can discriminate between them. Work in the diffusion limit of the Wright–Fisher model, adopting a Gaussian (Brownian) approximation for allele frequency drift along the edges of a demographic graph, with independent increments of variance equal to the drift length. Let a population’s allele frequency at a biallelic locus be modeled as a sum of independent Gaussian increments along the edges on the path from the root to the leaf. For a pulse admixture, assume linear mixing of parental allele frequency random variables at the admixture node.\n\nDefine the standard $f$-statistics (Reich et al.) in terms of allele frequencies $p_X$ as follows:\n- $f_2(X,Y) = \\mathbb{E}\\left[(p_X - p_Y)^2\\right]$,\n- $f_3(C;A,B) = \\mathbb{E}\\left[(p_C - p_A)(p_C - p_B)\\right]$,\n- $f_4(A,B;C,D) = \\mathbb{E}\\left[(p_A - p_B)(p_C - p_D)\\right]$.\n\nYou will consider four labeled populations: an outgroup $O$, an archaic hominin $N$, an African population $A$, and a non-African population $B$. Drift lengths are expressed in units in which variance accumulates additively along edges (e.g., $f_2$ drift units).\n\nModel I (introgression model): A symmetric modern human scaffold with a pulse of archaic introgression into $B$.\n- The root splits into lineages leading to $N$ and the modern human ancestor; the shared trunk has drift length $t_0$.\n- The lineage $N$ accumulates an additional unique drift $n_U$ to the present.\n- The modern human ancestor splits immediately into $A$ and $B$ (assume zero post-split shared drift for simplicity); $A$ accumulates drift $a$ to the present and $B$ accumulates drift $b$ to the present along its unadmixed path $B_{\\mathrm{main}}$.\n- A pulse of introgression from $N$ into $B$ of proportion $\\alpha$ occurs very recently, so that the present-day $B$ random variable is $p_B = (1-\\alpha) p_{B_{\\mathrm{main}}} + \\alpha p_N$.\n- The outgroup $O$ is independent with its own drift variance $o$ and zero covariance with others.\n\nModel S (deep structure model): A tree without introgression in which $B$ and $N$ share an additional internal branch not shared with $A$.\n- The root splits into two branches: one leading to $A$, and one leading to a clade containing $N$ and $B$. The shared trunk has drift length $t_0$.\n- On the branch leading to the $(N,B)$ clade, there is a short internal segment of drift $s_{\\mathrm{shared}}$ before splitting into $N$ and $B$; thereafter, $N$ continues with unique drift $n_U - s_{\\mathrm{shared}}$ to keep the total $N$ variance equal to that in Model I; $B$ continues with unique drift $b_S$ and $A$ with unique drift $a_S$.\n- The outgroup $O$ is as above.\n- To make the $f$-statistics closely match those in Model I while keeping all drifts nonnegative, choose $s_{\\mathrm{shared}} = \\alpha n_U$ and set $a_S = a - \\tfrac{1}{2} s_{\\mathrm{shared}}$ and $b_S = b - \\tfrac{1}{2} s_{\\mathrm{shared}}$.\n\nTasks:\n1) Using the Gaussian drift setup with linear admixture, derive the expected covariance matrix among $(O,N,A,B)$ under each model as a function of the drift parameters. Then use these covariance matrices and the definitions of $f$-statistics to compute the triplet of $f_4$-statistics for the quartets $(O,N;A,B)$, $(A,O;B,N)$, and $(A,B;O,N)$ under both Model I and Model S. Represent each triplet as a vector of three real numbers in the order specified.\n\n2) Compute the Euclidean norm of the difference between these two $f_4$ triplets (Model I minus Model S).\n\n3) Propose and formalize an auxiliary statistic based on two-locus admixture linkage disequilibrium (LD) decay. Use the following principle: under a single pulse of admixture $\\alpha$ at $t$ generations in the past, the expected covariance at genetic distance $d$ Morgans decays as $C(d) = A_0 \\exp(-2 r t d)$, where $r$ is the recombination rate per Morgan and $A_0$ is an amplitude. Under deep structure without a recent pulse, on the same genetic distance scale, model the expected covariance as $C(d) = B_0$ (approximately flat). Given two distances $d_1$ and $d_2$ with $d_2 > d_1$, estimate the pulse time by\n$$\n\\widehat{t} = -\\frac{\\ln\\left(\\frac{C(d_2)}{C(d_1)}\\right)}{2 r (d_2 - d_1)}.\n$$\nAdopt the convention that if $C(d_1) = C(d_2) = 0$, then $\\widehat{t} = 0$. For Model I, set $C(d) = \\alpha(1-\\alpha)\\exp(-2 r t d)$; for Model S, set $C(d) = B_0$ with constant $B_0 > 0$ (your estimate is independent of $B_0$). Report $\\widehat{t}$ for each model.\n\n4) Decision rule: output a boolean that is true if the auxiliary statistic discriminates the models, defined here as returning $\\widehat{t} > 0$ for Model I and $\\widehat{t} = 0$ for Model S up to numerical tolerance.\n\nTest suite and answer specification:\n- Use the following three parameter sets, each defining one test case. In all cases, use the quartets $(O,N;A,B)$, $(A,O;B,N)$, and $(A,B;O,N)$ in that order. Distances are in Morgans, and the recombination rate $r$ is per Morgan.\n    - Case $1$: $t_0 = 0.1$, $n_U = 0.06$, $a = 0.02$, $b = 0.02$, $\\alpha = 0.02$, $o = 0.2$, $d_1 = 0.01$, $d_2 = 0.05$, $r = 1.0$, $t = 120$.\n    - Case $2$: $t_0 = 0.1$, $n_U = 0.08$, $a = 0.03$, $b = 0.018$, $\\alpha = 0.005$, $o = 0.2$, $d_1 = 0.005$, $d_2 = 0.05$, $r = 1.0$, $t = 300$.\n    - Case $3$: $t_0 = 0.1$, $n_U = 0.05$, $a = 0.02$, $b = 0.02$, $\\alpha = 0.0$, $o = 0.2$, $d_1 = 0.01$, $d_2 = 0.05$, $r = 1.0$, $t = 200$.\n\n- Units and numerical reporting:\n    - All drift lengths ($t_0$, $n_U$, $a$, $b$, $o$) are in drift units producing variances additively; the auxiliary statistic requires $d_1$ and $d_2$ in Morgans and $r$ per Morgan, and $t$ in generations.\n    - Your program must compute, for each test case, a list $[ \\Delta, \\widehat{t}_{\\mathrm{I}}, \\widehat{t}_{\\mathrm{S}}, \\text{disc} ]$ where $\\Delta$ is the Euclidean norm of the difference between the two $f_4$ triplets (Model I minus Model S), $\\widehat{t}_{\\mathrm{I}}$ is the estimated time for Model I, $\\widehat{t}_{\\mathrm{S}}$ is the estimated time for Model S, and $\\text{disc}$ is the boolean defined above.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of the three per-case lists, with no spaces, enclosed in square brackets. For example, a valid shape is $[[x_{11},x_{12},x_{13},b_1],[x_{21},x_{22},x_{23},b_2],[x_{31},x_{32},x_{33},b_3]]$ where $x_{ij}$ are floats and $b_i$ are boolean literals.",
            "solution": "The problem requires us to formalize and distinguish between two demographic models for archaic introgression using population genetic statistics. The validation of the problem statement has confirmed its scientific soundness, consistency, and well-posed nature. We may proceed with the solution.\n\nThe allele frequency $p_X$ for a population $X$ is modeled as a sum of independent Gaussian increments starting from a root frequency, which we can set to $0$ without loss of generality for computing $f$-statistics. The covariance between allele frequencies of two populations, $\\text{Cov}(p_X, p_Y)$, is the total drift length on the shared path from the root to their most recent common ancestor. We denote this shared drift as $c(X,Y)$. The variance, $\\text{Var}(p_X) = c(X,X)$, is the total drift from the root to $X$. The $f$-statistics are defined in terms of expectations of products of allele frequency differences, which can be expressed using covariances. Specifically, $f_4(A,B;C,D) = \\mathbb{E}[(p_A - p_B)(p_C - p_D)] = c(A,C) - c(A,D) - c(B,C) + c(B,D)$.\n\n**Part 1: Covariance Matrices and $f_4$-statistics**\n\nFirst, we derive the covariance matrices for the allele frequencies of populations $(O, N, A, B)$ under each model. The outgroup $O$ splits at the root and is independent of all other populations, so $c(O,X)=0$ for any $X \\neq O$, and $\\text{Var}(p_O) = o$.\n\n**Model I: Introgression Model**\nThe demographic graph is $((N, (A, B_{\\text{main}})), O)$, with a recent admixture event creating population $B$. The allele frequency in population $B$ is given by $p_B = (1-\\alpha) p_{B_{\\mathrm{main}}} + \\alpha p_N$. We compute the covariances involving $p_B$ using the linearity of the covariance operator.\n\nThe basic covariances for the non-admixed populations are:\n- $\\text{Var}(p_N) = c(N,N) = t_0 + n_U$\n- $\\text{Var}(p_A) = c(A,A) = t_0 + a$\n- $\\text{Var}(p_{B_{\\mathrm{main}}}) = c(B_{\\mathrm{main}},B_{\\mathrm{main}}) = t_0 + b$\n- $c(N,A) = c(N,B_{\\mathrm{main}}) = c(A,B_{\\mathrm{main}}) = t_0$\n\nThe covariances for the admixed population $B$ are:\n- $\\text{Cov}(p_A, p_B) = \\text{Cov}(p_A, (1-\\alpha)p_{B_{\\mathrm{main}}} + \\alpha p_N) = (1-\\alpha)c(A, B_{\\mathrm{main}}) + \\alpha c(A,N) = (1-\\alpha)t_0 + \\alpha t_0 = t_0$.\n- $\\text{Cov}(p_N, p_B) = \\text{Cov}(p_N, (1-\\alpha)p_{B_{\\mathrm{main}}} + \\alpha p_N) = (1-\\alpha)c(N, B_{\\mathrm{main}}) + \\alpha \\text{Var}(p_N) = (1-\\alpha)t_0 + \\alpha(t_0+n_U) = t_0 + \\alpha n_U$.\n- Other covariances with $p_B$ are not required for the specified $f_4$ statistics.\n\n**Model S: Deep Structure Model**\nThe demographic graph is $((A, (N,B)), O)$. This is a simple tree model without admixture. The parameters are chosen to mimic Model I: $s_{\\mathrm{shared}} = \\alpha n_U$, $a_S = a - \\frac{1}{2}s_{\\mathrm{shared}}$, and $b_S = b - \\frac{1}{2}s_{\\mathrm{shared}}$.\n\nThe covariances are read directly from the tree structure:\n- $c(A,N) = t_0$\n- $c(A,B) = t_0$\n- $c(N,B) = t_0 + s_{\\mathrm{shared}} = t_0 + \\alpha n_U$\n\nNow, we compute the triplet of $f_4$-statistics for both models. The required quartets are $(O,N;A,B)$, $(A,O;B,N)$, and $(A,B;O,N)$.\n\n1.  $f_4(O,N;A,B) = c(O,A) - c(O,B) - c(N,A) + c(N,B)$:\n    - Model I: $0 - 0 - t_0 + (t_0 + \\alpha n_U) = \\alpha n_U$.\n    - Model S: $0 - 0 - t_0 + (t_0 + \\alpha n_U) = \\alpha n_U$.\n    The results are identical.\n\n2.  $f_4(A,O;B,N) = c(A,B) - c(A,N) - c(O,B) + c(O,N)$:\n    - Model I: $t_0 - t_0 - 0 + 0 = 0$.\n    - Model S: $t_0 - t_0 - 0 + 0 = 0$.\n    The results are identical.\n\n3.  $f_4(A,B;O,N) = c(A,O) - c(A,N) - c(B,O) + c(B,N)$:\n    - Model I: $0 - t_0 - 0 + (t_0 + \\alpha n_U) = \\alpha n_U$.\n    - Model S: $0 - t_0 - 0 + (t_0 + \\alpha n_U) = \\alpha n_U$.\n    The results are identical.\n\nFor both models, the $f_4$ statistic triplet is $(\\alpha n_U, 0, \\alpha n_U)$. This demonstrates that for this specific set of statistics, the two models are indistinguishable.\n\n**Part 2: Euclidean Norm of the Difference**\nThe vector of $f_4$ statistics for Model I is $\\mathbf{F_I} = (\\alpha n_U, 0, \\alpha n_U)$, and for Model S is $\\mathbf{F_S} = (\\alpha n_U, 0, \\alpha n_U)$. The difference vector is $\\mathbf{F_I} - \\mathbf{F_S} = (0, 0, 0)$.\nThe Euclidean norm of this difference, $\\Delta$, is:\n$$\n\\Delta = \\sqrt{0^2 + 0^2 + 0^2} = 0\n$$\n\n**Part 3: Auxiliary Statistic Based on LD Decay**\nThe proposed auxiliary statistic is an estimator for the admixture time $t$ based on the decay of linkage disequilibrium (LD) with genetic distance $d$.\n$$\n\\widehat{t} = -\\frac{\\ln\\left(\\frac{C(d_2)}{C(d_1)}\\right)}{2 r (d_2 - d_1)}\n$$\n- **For Model I (Introgression)**, the admixture LD is given by $C(d) = \\alpha(1-\\alpha)\\exp(-2rtd)$.\n  If $\\alpha \\in (0,1)$, the ratio of covariances is:\n  $$\n  \\frac{C(d_2)}{C(d_1)} = \\frac{\\alpha(1-\\alpha)\\exp(-2 r t d_2)}{\\alpha(1-\\alpha)\\exp(-2 r t d_1)} = \\exp(-2 r t (d_2 - d_1))\n  $$\n  Plugging this into the estimator for $\\widehat{t}_{\\mathrm{I}}$:\n  $$\n  \\widehat{t}_{\\mathrm{I}} = -\\frac{\\ln(\\exp(-2 r t (d_2 - d_1)))}{2 r (d_2 - d_1)} = -\\frac{-2 r t (d_2 - d_1)}{2 r (d_2 - d_1)} = t\n  $$\n  If $\\alpha=0$ or $\\alpha=1$, then $C(d)=0$, and by the problem's convention, $\\widehat{t}_{\\mathrm{I}} = 0$.\n\n- **For Model S (Deep Structure)**, there is no recent admixture pulse. The LD is modeled as a constant, $C(d) = B_0 > 0$.\n  The ratio of covariances is:\n  $$\n  \\frac{C(d_2)}{C(d_1)} = \\frac{B_0}{B_0} = 1\n  $$\n  Plugging this into the estimator for $\\widehat{t}_{\\mathrm{S}}$:\n  $$\n  \\widehat{t}_{\\mathrm{S}} = -\\frac{\\ln(1)}{2 r (d_2 - d_1)} = -\\frac{0}{2 r (d_2 - d_1)} = 0\n  $$\n\n**Part 4: Decision Rule and Test Case Evaluation**\nThe decision rule to discriminate between models is a boolean `disc` which is true if $\\widehat{t}_{\\mathrm{I}} > 0$ and $\\widehat{t}_{\\mathrm{S}} = 0$. Since $\\widehat{t}_{\\mathrm{S}}$ is always $0$, the rule simplifies to `disc` being true if and only if $\\widehat{t}_{\\mathrm{I}} > 0$. This occurs when there is genuine admixture ($\\alpha \\in (0,1)$) and the pulse time $t$ is positive.\n\nWe now apply these formulas to the test cases.\n\n**Case 1:** $\\alpha = 0.02$, $n_U = 0.06$, $t=120$.\n- $\\Delta = 0.0$.\n- $\\widehat{t}_{\\mathrm{I}} = t = 120.0$ (since $0 < 0.02 < 1$).\n- $\\widehat{t}_{\\mathrm{S}} = 0.0$.\n- `disc`: $(120.0 > 0) \\land (0.0 = 0)$ is True.\n- Result: $[0.0, 120.0, 0.0, \\text{True}]$\n\n**Case 2:** $\\alpha = 0.005$, $n_U = 0.08$, $t=300$.\n- $\\Delta = 0.0$.\n- $\\widehat{t}_{\\mathrm{I}} = t = 300.0$ (since $0 < 0.005 < 1$).\n- $\\widehat{t}_{\\mathrm{S}} = 0.0$.\n- `disc`: $(300.0 > 0) \\land (0.0 = 0)$ is True.\n- Result: $[0.0, 300.0, 0.0, \\text{True}]$\n\n**Case 3:** $\\alpha = 0.0$, $n_U = 0.05$, $t=200$.\n- $\\Delta = 0.0$.\n- $\\widehat{t}_{\\mathrm{I}} = 0.0$ (since $\\alpha = 0$).\n- $\\widehat{t}_{\\mathrm{S}} = 0.0$.\n- `disc`: $(0.0 > 0) \\land (0.0 = 0)$ is False.\n- Result: $[0.0, 0.0, 0.0, \\text{False}]$\n\nThe LD-based statistic successfully distinguishes Model I (with introgression) from Model S (deep structure), whereas the chosen set of $f_4$-statistics cannot.",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Solves the archaic introgression problem for the given test cases.\n    \"\"\"\n    \n    # Each tuple contains:\n    # (t0, n_U, a, b, alpha, o, d1, d2, r, t)\n    test_cases = [\n        # Case 1\n        (0.1, 0.06, 0.02, 0.02, 0.02, 0.2, 0.01, 0.05, 1.0, 120),\n        # Case 2\n        (0.1, 0.08, 0.03, 0.018, 0.005, 0.2, 0.005, 0.05, 1.0, 300),\n        # Case 3\n        (0.1, 0.05, 0.02, 0.02, 0.0, 0.2, 0.01, 0.05, 1.0, 200),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        t0, n_U, a, b, alpha, o, d1, d2, r, t = case\n\n        # Task 1 & 2: Compute f4 statistics and the norm of their difference.\n        # The f4 triplets for the quartets (O,N;A,B), (A,O;B,N), and (A,B;O,N)\n        # are calculated based on the covariance matrices derived from the models.\n        \n        # For Model I (Introgression), the f4 triplet is (alpha*n_U, 0, alpha*n_U).\n        f4_I_1 = alpha * n_U\n        f4_I_2 = 0.0\n        f4_I_3 = alpha * n_U\n        f4_triplet_I = np.array([f4_I_1, f4_I_2, f4_I_3])\n\n        # For Model S (Structure), the parameter s_shared = alpha * n_U is chosen\n        # to make f-statistics match. The f4 triplet is also (alpha*n_U, 0, alpha*n_U).\n        s_shared = alpha * n_U\n        f4_S_1 = s_shared\n        f4_S_2 = 0.0\n        f4_S_3 = s_shared\n        f4_triplet_S = np.array([f4_S_1, f4_S_2, f4_S_3])\n\n        # The Euclidean norm of the difference between the f4 triplets.\n        # Since the triplets are identical, the norm of the difference is 0.\n        delta = np.linalg.norm(f4_triplet_I - f4_triplet_S)\n\n        # Task 3: Compute the auxiliary statistic t_hat for both models.\n        # The formula is t_hat = -ln(C(d2)/C(d1)) / (2 * r * (d2 - d1)).\n\n        # For Model I (Introgression):\n        # C(d) = alpha * (1 - alpha) * exp(-2 * r * t * d)\n        # If alpha is 0 or 1, C(d) is 0, and t_hat is defined as 0.\n        # Otherwise, the formula simplifies to t_hat = t.\n        if 0.0 < alpha < 1.0:\n            t_hat_I = float(t)\n        else:\n            t_hat_I = 0.0\n\n        # For Model S (Structure):\n        # C(d) = B0 (constant). The ratio C(d2)/C(d1) is 1. ln(1) = 0.\n        # So, t_hat is always 0.\n        t_hat_S = 0.0\n\n        # Task 4: Apply the decision rule.\n        # The statistic discriminates if t_hat_I > 0 and t_hat_S = 0.\n        discriminates = (t_hat_I > 0) and (t_hat_S == 0)\n\n        results.append([delta, t_hat_I, t_hat_S, discriminates])\n\n    # Format the output as a string representation of a list of lists, with no spaces.\n    # e.g., [[0.0,120.0,0.0,True],[...],...]\n    output_str = str(results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}