{
    "hands_on_practices": [
        {
            "introduction": "跨物种多态性的一个核心标志是其等位基因的古老历史，其分化时间甚至早于物种的分化。这个练习将引导你完成一个基本但至关重要的计算，来验证这一标志。通过应用分子钟假说和Jukes-Cantor替换模型，你将从观测到的核酸序列差异中估算出等位基因的共祖时间，并将其与已知的物种分化时间进行比较，从而定量地评估跨物种多态性存在的证据。",
            "id": "2759487",
            "problem": "两个姐妹种 $\\mathrm{S_1}$ 和 $\\mathrm{S_2}$ 在 $T_{\\mathrm{spec}} = 2.5 \\times 10^{6}$ 年前发生分化。在一个据推测经历了平衡选择的非重组位点上，从这两个物种中采样的单倍型形成了两个跨物种共享的深层等位基因进化支。设代表这两个等位基因进化支的共有单倍型之间观测到的原始分歧度为每个位点 $d = 0.015$ 的差异（即，这两个进化支代表序列存在差异的核苷酸位点比例）。假设每位点每代的突变率为 $\\mu = 1.2 \\times 10^{-8}$，适用 Jukes–Cantor 核苷酸替换模型，且世代时间为每代 $g = 6$ 年。\n\n从含点突变的中性溯祖理论的第一性原理以及与 Jukes–Cantor 模型一致的有限位点校正出发，根据观测到的 $d$ 值估算以年为单位的等位基因最近共同祖先时间（time to the most recent common ancestor (TMRCA)），然后通过计算比率\n$$\nR \\equiv \\frac{T_{\\mathrm{allele}}}{T_{\\mathrm{spec}}}.\n$$\n将其与物种分化时间进行比较。\n若 $R > 1$，则与跨物种多态性的情况相符。\n\n$R$ 的数值是多少？请将最终答案表示为一个纯数（无单位），并四舍五入到四位有效数字。",
            "solution": "本题要求计算比率 $R \\equiv \\frac{T_{\\mathrm{allele}}}{T_{\\mathrm{spec}}}$，其中 $T_{\\mathrm{allele}}$ 是两个等位基因进化支的最近共同祖先时间（TMRCA），而 $T_{\\mathrm{spec}}$ 是物种分化时间。这是分子进化中用于检验跨物种多态性的一个标准流程。\n\n首先，有必要对问题陈述进行验证。\n给定的已知条件如下：\n物种分化时间 $T_{\\mathrm{spec}} = 2.5 \\times 10^{6}$ 年。\n观测到的原始分歧度（差异位点比例）$d = 0.015$。\n每位点每代突变率 $\\mu = 1.2 \\times 10^{-8}$。\n世代时间 $g = 6$ 年。\n题目使用 Jukes–Cantor 模型进行替换校正。\n该问题具有科学依据，表述清晰且客观。它提供了所有必要的参数，并使用了演化遗传学中的既定模型。所给数值在物理上和生物学上都是合理的。因此，问题是有效的，我们可以继续进行求解。\n\n第一步，将观测到的原始分歧度 $d$ 转换成每位点预期替换数 $K$ 的估计值。由于在同一核苷酸位点上发生的多次替换事件无法直接观测到，原始分歧度 $d$ 会低估真实的遗传距离。Jukes–Cantor 模型为这种多次击中提供了校正。公式如下：\n$$K = -\\frac{3}{4} \\ln \\left(1 - \\frac{4}{3}d\\right)$$\n代入给定值 $d = 0.015$：\n$$K = -\\frac{3}{4} \\ln \\left(1 - \\frac{4}{3}(0.015)\\right) = -\\frac{3}{4} \\ln (1 - 0.02) = -\\frac{3}{4} \\ln (0.98)$$\n\n第二步，将此遗传距离 $K$ 与分化时间关联起来。根据分子钟假说，两个同源序列之间每位点的预期替换数为 $K = 2 \\mu t$，其中 $\\mu$ 是每位点每代的突变率，而 $t$ 是自最近共同祖先以来的世代数。因子 $2$ 是因为突变在从共同祖先分化出来的两个谱系上是独立累积的。在我们的问题中，$t$ 对应于以世代数为单位的等位基因 TMRCA，我们将其表示为 $t_{\\mathrm{allele}}$。\n$$K = 2 \\mu t_{\\mathrm{allele}}$$\n我们可以解出 $t_{\\mathrm{allele}}$：\n$$t_{\\mathrm{allele}} = \\frac{K}{2\\mu}$$\n题目要求以年为单位的时间 $T_{\\mathrm{allele}}$。这可以通过将世代数乘以世代时间 $g$ 得到：\n$$T_{\\mathrm{allele}} = t_{\\mathrm{allele}} \\cdot g = \\frac{Kg}{2\\mu}$$\n\n现在，我们将从 Jukes-Cantor 模型推导出的 $K$ 的表达式代入 $T_{\\mathrm{allele}}$ 的方程中：\n$$T_{\\mathrm{allele}} = \\frac{\\left(-\\frac{3}{4} \\ln(0.98)\\right) g}{2\\mu}$$\n代入 $g$ 和 $\\mu$ 的数值：\n$$T_{\\mathrm{allele}} = \\frac{-\\frac{3}{4} \\ln(0.98) \\cdot 6}{2 \\cdot (1.2 \\times 10^{-8})} = \\frac{-4.5 \\ln(0.98)}{2.4 \\times 10^{-8}}$$\n\n最后一步是计算所需的比率 $R$：\n$$R = \\frac{T_{\\mathrm{allele}}}{T_{\\mathrm{spec}}}$$\n代入 $T_{\\mathrm{allele}}$ 的表达式和给定的 $T_{\\mathrm{spec}} = 2.5 \\times 10^{6}$：\n$$R = \\frac{\\frac{-4.5 \\ln(0.98)}{2.4 \\times 10^{-8}}}{2.5 \\times 10^{6}} = \\frac{-4.5 \\ln(0.98)}{(2.4 \\times 10^{-8}) \\cdot (2.5 \\times 10^{6})}$$\n我们简化分母：\n$$(2.4 \\times 10^{-8}) \\cdot (2.5 \\times 10^{6}) = (2.4 \\cdot 2.5) \\times 10^{-8+6} = 6.0 \\times 10^{-2} = 0.06$$\n因此，$R$ 的表达式为：\n$$R = \\frac{-4.5 \\ln(0.98)}{0.06}$$\n现在，我们计算其数值。\n$0.98$ 的自然对数约为 $\\ln(0.98) \\approx -0.0202027$。\n$$R \\approx \\frac{-4.5 \\times (-0.0202027)}{0.06} \\approx \\frac{0.09091215}{0.06} \\approx 1.5152025$$\n根据题目要求，将结果四舍五入到四位有效数字，我们得到：\n$$R \\approx 1.515$$\n该值大于 $1$，表明等位基因的估算分化时间早于物种的分化时间，这与这些等位基因是跨物种多态性的情况相符。",
            "answer": "$$\\boxed{1.515}$$"
        },
        {
            "introduction": "在真实的演化研究中，仅凭古老的等位基因年龄并不足以确立跨物种多态性，我们必须排除其他可能产生类似遗传模式的假说，其中最主要的就是基因渗入。这个练习模拟了一个复杂的演化遗传学场景，要求你综合运用多种现代基因组学证据——包括D统计量、基因树拓扑结构和共祖时间估计。通过权衡这些来自不同角度的证据，你将学习如何严谨地在跨物种多态性和基因渗入这两个关键假说之间做出判断。",
            "id": "2759485",
            "problem": "建立一个四分类单元检验，以研究在两个姐妹物种中观察到的共享功能性等位基因是反映了跨物种多态性（在物种形成事件中维持的古老平衡多态性）还是基因渗入（物种形成后的基因流）。分类单元的排列如下：具有共享等位基因的物种是 $P_1$ 和 $P_2$，一个亲缘关系较远的物种是 $P_3$，外群是 $O$。在焦点位点周围的基因组区域收集了独立的证据线索：\n\n1. 全基因组背景：滑动窗口检验得出 $D(P_1,P_2,P_3,O)$ 的平均值约等于 $0$，且在大多数窗口中 $|Z|  1.5$；$P_1$ 和 $P_2$ 之间基因混合的 $f_4$ 比率估计值接近 $0$，置信区间很窄。\n\n2. 焦点位点附近的局部信号：在以焦点多态性为中心的 $2$ 千碱基窗口内，有 $n = 35$ 个信息位点，估计的 $D \\approx 0.06$，标准误 $\\approx 0.07$ ($Z \\approx 0.86$)。在两侧紧邻的 $50$ 千碱基窗口中，$D \\approx 0.00 \\pm 0.01$，$f_4$ 比率的基因混合估计值 $\\hat{\\alpha} \\approx 0.00$，其 $95\\%$ 置信区间大约为 $[-0.02, 0.02]$。\n\n3. 基因树拓扑结构：在包含焦点多态性的 $500$ 碱基对片段中，单倍型跨物种按等位基因状态聚类（所有携带等位基因 $A$ 的 $P_1$ 和 $P_2$ 单倍型聚在一起，所有携带等位基因 $B$ 的 $P_1$ 和 $P_2$ 单倍型聚在一起）。在相邻的 $10$ 千碱基侧翼区域，基因谱系与物种树匹配，$P_1$ 是单系的，$P_2$ 也是单系的。\n\n4. 时间和单倍型长度证据：焦点位点上两个长期存在的等位基因支系的最近共同祖先时间估计为 $T_{\\text{MRCA}} \\approx 320$ 万年，其 $95\\%$ 置信区间为 $[250, 390]$ 万年，而 $P_1$–$P_2$ 的物种分化时间被定为 $T_S \\approx 110$ 万年，其 $95\\%$ 置信区间为 $[90, 130]$ 万年。在焦点区域内，$P_1$ 和 $P_2$ 中相同等位基因携带者之间共享的状态相同（IBS）的平均片段长度很短（约 $0.3$ 千碱基），没有长的共享单倍型。\n\n根据第一性原理，请制定一个决策规则，该规则使用位点模式统计（例如，$D$ 统计量或 $f_4$ 比率）和基因树拓扑结构，在这些数据下，为共享等位基因拒绝基因渗入假说而支持跨物种多态性假说。以下哪个选项最严谨地概括了这样一个规则？\n\nA. 如果在焦点位点侧翼的重组界定窗口中，$D$ 和 $f_4$ 比率估计值在检验 $P_1$–$P_2$ 基因流时与 $0$ 没有显著差异，焦点位点的谱系按等位基因状态跨物种分组，而相邻侧翼区域恢复为物种树，并且等位基因支系的 $T_{\\text{MRCA}}$ 超过 $T_S$，则拒绝基因渗入假说而支持跨物种多态性假说。在这些联合条件下，推断为古老的平衡多态性而非基因渗入。\n\nB. 只要任何跨越焦点位点的窗口产生非零的 $D$ 值，无论其符号、大小或统计显著性如何，就拒绝基因渗入假说而支持跨物种多态性假说，因为任何偏离 $0$ 的值都与无基因流的零假设不相容。\n\nC. 只要焦点位点的局部基因树混合了 $P_1$ 和 $P_2$ 的单倍型，即使侧翼的 $D$ 值显著不为零，也拒绝基因渗入假说而支持跨物种多态性假说，因为物种在支系内的混合必然反映了祖先多态性。\n\nD. 仅当 $D$ 值在焦点位点两侧显著不为零且符号相反时，才拒绝基因渗入假说而支持跨物种多态性假说，因为 $D$ 值在侧翼区域的符号翻转表明不完全谱系分选无法解释数据。\n\nE. 当 $P_1$ 和 $P_2$ 之间的 $f_4$ 比率基因混合估计值 $\\hat{\\alpha}$ 特别在焦点窗口中显著大于 $0$ 时，拒绝基因渗入假说而支持跨物种多态性假说，理由是局部的过度共享必然反映了古老的多态性而非近期的基因流。",
            "solution": "必须首先验证问题陈述的科学连贯性和逻辑一致性。\n\n**步骤 1：提取已知条件**\n\n该问题提供了关于一个四分类单元系统（物种 $P_1$、$P_2$、$P_3$ 和一个外群 $O$）的以下数据，其物种树拓扑为 $((P_1, P_2), P_3), O)$。$P_1$ 和 $P_2$ 是共享一个等位基因的姐妹物种。研究旨在探讨这种共享是由于跨物种多态性（TSP）还是基因渗入。\n\n1.  **全基因组背景**:\n    *   滑动窗口 $D(P_1,P_2,P_3,O)$ 的平均值约等于 $0$。\n    *   在大多数窗口中，Z-score 的绝对值 $|Z|$ 小于 $1.5$。\n    *   $P_1$ 和 $P_2$ 之间基因混合的 $f_4$ 比率估计值接近 $0$，置信区间很窄。\n\n2.  **局部信号**:\n    *   在以焦点多态性为中心的 $2$ 千碱基（kb）窗口内，有 $n = 35$ 个信息位点。\n    *   在此焦点窗口中，$D$-统计量的估计值为 $D \\approx 0.06$，标准误约等于 $0.07$，得出 Z-score 约为 $Z \\approx 0.86$。\n    *   在两个侧翼的 $50$ 千碱基（kb）窗口中，$D \\approx 0.00 \\pm 0.01$。\n    *   在这些相同的侧翼窗口中，$f_4$ 比率的基因混合估计值为 $\\hat{\\alpha} \\approx 0.00$，其 $95\\%$ 置信区间大约为 $[-0.02, 0.02]$。\n\n3.  **基因树拓扑结构**:\n    *   在包含焦点位点的 $500$ 碱基对（bp）片段中，$P_1$ 和 $P_2$ 的单倍型按等位基因状态聚类（例如，来自两个物种的等位基因 $A$ 形成一个支系，来自两个物种的等位基因 $B$ 形成另一个支系）。这是一种跨物种谱系。\n    *   在相邻的 $10$ 千碱基（kb）侧翼区域，基因谱系恢复为物种树的拓扑结构，$P_1$ 的单倍型形成一个单系群，$P_2$ 的单倍型形成另一个单系群。\n\n4.  **时间和单倍型长度证据**:\n    *   两个等位基因支系的最近共同祖先时间（$T_{\\text{MRCA}}$）估计为 $T_{\\text{MRCA}} \\approx 320$ 万年（Mya），其 $95\\%$ 置信区间为 $[250, 390]$ 万年。\n    *   $P_1$ 和 $P_2$ 之间的物种分化时间（$T_S$）被定为 $T_S \\approx 110$ 万年（Mya），其 $95\\%$ 置信区间为 $[90, 130]$ 万年。\n    *   $P_1$ 和 $P_2$ 中相同等位基因携带者之间共享的状态相同（IBS）的平均片段长度很短，约 $0.3$ 千碱基（kb）。\n\n**步骤 2：验证问题陈述**\n\n这个问题具有科学依据。它提出了进化基因组学中的一个经典场景：区分基因渗入和不完全谱系分选（ILS），特别是长期平衡选择导致跨物种多态性的情况。所引用的方法——$D$ 统计量（ABBA-BABA检验）、$f_4$ 比率、基因树拓扑分析、合并时间估计（$T_{\\text{MRCA}}$）以及单倍型片段长度分析——对于这个问题都是标准且适用的。提供的数据内部一致且合理。例如，全基因组背景显示没有大规模基因流的证据，从而正确地将问题聚焦于一个局部的基因组区域。局部数据在焦点位点及其侧翼之间呈现出清晰的对比，这是局部进化过程的预期模式。时间数据（$T_{\\text{MRCA}} > T_S$）是关键证据。这个问题提法得当、客观，并包含足够的信息来形成严谨的科学结论。\n\n**结论：该问题有效。**\n\n**解答推导**\n\n任务是制定一个决策规则，以拒绝基因渗入假说并支持跨物种多态性假说，使用的证据线索已提供。我们必须从第一性原理分析每种现象的预期特征。\n\n**跨物种多态性 (TSP)** 产生于祖先群体中存在的多态性通过平衡选择跨越物种形成事件得以维持。其特征性信号是：\n1.  **深层合并**: 多态性等位基因的共同祖先（$T_{\\text{MRCA}}$）必须早于物种形成事件（$T_S$）。因此，一个关键特征是 $T_{\\text{MRCA}} > T_S$。\n2.  **局部的谱系不一致性**: 在受选择的位点，基因树将与物种树不匹配。单倍型将按等位基因类型而非物种聚类。然而，由于重组，这种不一致的信号仅限于一个非常小的区域。在侧翼区域，谱系应恢复为物种树拓扑。\n3.  **侧翼区域无基因渗入信号**: 由于该模式并非由物种形成后的基因流引起，因此不应存在长的共享祖先片段。用于检验基因渗入的统计检验，如 $D$-统计量或 $f_4$-比率，在被选择位点周围的基因组区域应得出不显著的结果（即值接近 $0$）。\n4.  **短的共享单倍型**: 等位基因谱系已经分化了很长时间（自 $T_S$ 之前）。在这段漫长的时间里，重组作用会打破祖先的单倍型，只在受选择位点本身周围留下非常短的相同片段。\n\n**基因渗入** 是指物种分化后它们之间发生的遗传物质转移。其信号是：\n1.  **近期的合并**: 一个渗入的等位基因将在供体和受体谱系之间显示出比物种分化时间更近的合并时间。\n2.  **长的谱系不一致片段**: 基因渗入会转移一个 DNA 片段。虽然重组会随时间分解这个片段，但近期的基因渗入将导致一个相对较长的共享单倍型，以及一个相应较大的、基因树与物种树不一致的基因组窗口。\n3.  **显著的混合信号**: 由基因渗入导致的衍生等位基因的过度共享，将在渗入区域及其紧邻的侧翼产生一个统计上显著的非零 $D$-统计量或 $f_4$-比率，直到重组完全破坏连锁。\n\n**将这些原理应用于数据**\n所提供的数据与跨物种多态性的预期完全吻合，并与基因渗入的预期相矛盾。\n-   **时间证据**: $T_{\\text{MRCA}} \\approx 320$ 万年显著大于 $T_S \\approx 110$ 万年。这是支持TSP的最有力证据。\n-   **谱系证据**: 基因树在焦点位点是跨物种的，但在侧翼区域与物种树匹配。这使信号局部化，正如TSP所预期的。\n-   **混合统计**: 在侧翼区域，$D$-统计量和 $f_4$-比率约等于 $0$，且置信区间很窄。这为反对存在任何相当规模的渗入片段提供了强有力的证据。焦点窗口本身不显著的 $D$-统计量 ($Z \\approx 0.86$) 进一步反驳了基因渗入。\n-   **单倍型证据**: 共享的IBS片段非常短（约 $0.3$ kb），这与近期的基因渗入不一致，而与被数百万年的重组所侵蚀的古老共享多态性一致。\n\n因此，一个正确的决策规则必须整合这些观察结果。拒绝基因渗入而支持TSP的规则必须要求（1）位点周围的基因组背景缺乏基因渗入的统计证据，（2）基因树拓扑从位点处的跨物种结构转变为侧翼区域的物种一致结构，以及（3）等位基因的合并时间显著早于物种分化时间。\n\n**评估所提供的选项**\n\n**A. 如果在焦点位点侧翼的重组界定窗口中，$D$ 和 $f_4$ 比率估计值在检验 $P_1$–$P_2$ 基因流时与 $0$ 没有显著差异，焦点位点的谱系按等位基因状态跨物种分组，而相邻侧翼区域恢复为物种树，并且等位基因支系的 $T_{\\text{MRCA}}$ 超过 $T_S$，则拒绝基因渗入假说而支持跨物种多态性假说。在这些联合条件下，推断为古老的平衡多态性而非基因渗入。**\n这个选项正确地综合了多个关键的证据线索。它要求侧翼区域没有基因流信号（$D \\approx 0, f_4 \\approx 0$），存在特定的局部谱系不一致模式，以及决定性的时间标准（$T_{\\text{MRCA}} > T_S$）。这是一个全面且科学严谨的规则。\n**结论：正确。**\n\n**B. 只要任何跨越焦点位点的窗口产生非零的 $D$ 值，无论其符号、大小或统计显著性如何，就拒绝基因渗入假说而支持跨物种多态性假说，因为任何偏离 $0$ 的值都与无基因流的零假设不相容。**\n这个选项存在根本性缺陷。$D$-统计量是一个随机变量；由于随机性（例如，ILS、抽样误差），它预计会偏离 $0$。科学推断需要进行假设检验，以确定偏差是否具有统计显著性。忽略统计显著性是一个严重的错误。\n**结论：错误。**\n\n**C. 只要焦点位点的局部基因树混合了 $P_1$ 和 $P_2$ 的单倍型，即使侧翼的 $D$ 值显著不为零，也拒绝基因渗入假说而支持跨物种多态性假说，因为物种在支系内的混合必然反映了祖先多态性。**\n这个选项犯了两个错误。首先，一个混合的（跨物种的）基因树是TSP和基因渗入*共同*的特征；它本身无法区分两者。其次，“即使侧翼的 $D$ 值显著不为零”，它也反映了祖先多态性的断言恰恰是相反的。侧翼区域显著的 $D$ 统计量是支持基因渗入的强有力证据。\n**结论：错误。**\n\n**D. 仅当 $D$ 值在焦点位点两侧显著不为零且符号相反时，才拒绝基因渗入假说而支持跨物种多态性假说，因为 $D$ 值在侧翼区域的符号翻转表明不完全谱系分选无法解释数据。**\n这描述了一种特定的、复杂的模式，有时可能在平衡选择下出现，但它不是一个必要或普遍的特征。将其作为*唯一*条件（“仅当”）限制性太强。更基本的证据，如 $T_{\\text{MRCA}} > T_S$ 和侧翼区域的 $D$ 值为零，更为通用和有力。这个规则与所提供的数据不一致，因为数据中侧翼的 $D \\approx 0$。\n**结论：错误。**\n\n**E. 当 $P_1$ 和 $P_2$ 之间的 $f_4$ 比率基因混合估计值 $\\hat{\\alpha}$ 特别在焦点窗口中显著大于 $0$ 时，拒绝基因渗入假说而支持跨物种多态性假说，理由是局部的过度共享必然反映了古老的多态性而非近期的基因流。**\n这个选项从根本上误解了该统计量的含义。一个显著为正的混合估计值（$\\hat{\\alpha} > 0$）是由于基因渗入导致的过度等位基因共享的典型信号。声称这“必然反映了古老的多态性”与该统计量的目的和标准解释直接矛盾。\n**结论：错误。**\n\n基于此分析，只有选项 A 根据所提供的数据和既定的进化遗传学原理，制定了一个科学上正确且全面的决策规则。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "我们的演化推断质量高度依赖于我们从测序数据中提取遗传信息的准确性。然而，生物信息学分析流程本身可能引入系统性偏差，从而误导我们的结论。这个练习聚焦于一个常见陷阱：参考基因组偏向性，它会导致在高度多态性的位点错误地估计等位基因频率。通过构建一个数学模型并进行蒙特卡洛模拟，你将亲身体验这种技术偏差如何人为地制造出跨物种多态性的假象，并理解为何在进行群体基因组学分析时必须对数据处理流程保持警惕。",
            "id": "2759434",
            "problem": "给定一个读序比对流程（read-mapping pipeline）的数学抽象，该流程旨在最大限度地减少高度多态性位点上的参考偏好，以避免对跨物种多态性做出伪推断。在同一个双等位基因位点上对两个物种（索引为 $s \\in \\{1,2\\}$）进行抽样。对于物种 $s$，该位点上真实的备择等位基因频率为 $f_s \\in [0,1]$。在所有位点上，$f_1$ 和 $f_2$ 是相互独立的，并且各自服从参数为 $(a_s,b_s)$ 的贝塔分布（Beta distribution），记作 $f_s \\sim \\mathrm{Beta}(a_s,b_s)$，其中 $a_s0$ 且 $b_s0$。读序（read）的长度为 $L$ 个碱基对（bp），物种 $s$ 与线性参考序列之间的单位碱基差异率为 $\\mu_s \\in [0,1]$。对于一个有 $m$ 个错配的读序，其比对接受概率模型为 $\\exp(-\\alpha m)$，其中 $\\alpha \\ge 0$ 是一个罚分参数。假设对于来自物种 $s$ 的一个读序，与目标双等位基因位点无关的预期背景错配数为 $L \\mu_s$。携带参考等位基因的读序没有目标错配，而携带非参考等位基因的读序会额外产生一个正好为 1 的目标错配。\n\n考虑两种比对流程：\n\n- 单参考序列比对 (SR)：携带备择等位基因的读序会产生目标错配罚分，因此其预期错配数为 $L \\mu_s + 1$。携带参考等位基因的读序的预期错配数为 $L \\mu_s$。\n\n- 偏好最小化比对 (BM)：一个变异感知索引（例如，多单倍型或基于图的索引）通过在局部包含两个等位基因来消除目标错配罚分，因此两种等位基因的预期错配数均为 $L \\mu_s$。\n\n假设读序计数非常大，以至于读序计数比例收敛于其期望值。在这些假设下，对于物种 $s$，比对后观察到的备择等位基因读序的预期比例为\n$$\n\\widehat{f}_s \\;=\\; \\frac{f_s \\, \\exp\\!\\big(-\\alpha(L\\mu_s + \\delta)\\big)}{f_s \\, \\exp\\!\\big(-\\alpha(L\\mu_s + \\delta)\\big) + (1-f_s)\\, \\exp(-\\alpha L\\mu_s)},\n$$\n其中，在 SR 下 $\\delta = 1$，在 BM 下 $\\delta = 0$。在 BM 下，该式简化为 $\\widehat{f}_s = f_s$。\n\n定义将一个位点鉴定为跨物种多态性的决策规则如下：如果对于两个物种 $s \\in \\{1,2\\}$，观察到的备择等位基因频率都在闭区间 $[t, 1-t]$ 内（对于一个固定的阈值 $t \\in (0, 0.5]$），则将该位点鉴定为“共享多态性”。定义“真实共享多态性”为 $f_1$ 和 $f_2$ 都在 $[t, 1-t]$ 内的事件。“假阳性”是任何根据决策规则被鉴定为共享多态性但并非真实共享多态性的位点。\n\n您的任务是，对下面的每个测试用例，计算 SR 和 BM 下假阳性率之间的差异 $\\Delta$：\n$$\n\\Delta \\;=\\; \\mathrm{FPR}_{\\mathrm{SR}} \\;-\\; \\mathrm{FPR}_{\\mathrm{BM}},\n$$\n其中 $\\mathrm{FPR}_{\\mathrm{SR}}$ 和 $\\mathrm{FPR}_{\\mathrm{BM}}$ 分别是在 $N$ 个独立位点上估计的 SR 和 BM 下的假阳性率。使用一个蒙特卡洛估计器，该估计器按规定抽取 $N$ 个独立的 $(f_1,f_2)$ 对，并应用比对模型和决策规则。因为 BM 比对有 $\\widehat{f}_s = f_s$，任何在 BM 下的假阳性仅由抽样噪声引起，而大读序量假设排除了这种噪声；因此，在该模型下，BM 的预期假阳性率为零。尽管如此，为了方法学上的对称性，您必须为 SR 和 BM 一致地实现蒙特卡洛计算。\n\n最终输出必须是单行文本，包含一个 $\\Delta$ 值列表，每个测试用例一个，与测试套件的顺序相同，格式化为 Python 风格的小数列表，每个数值小数点后精确到六位，例如 $[\\;0.123456,0.000000\\;]$。\n\n将您的解决方案实现为一个完整的、可运行的程序，为每个测试用例执行以下步骤：\n- 抽取 $N$ 个独立的 $(f_1,f_2)$ 样本，其中 $f_s \\sim \\mathrm{Beta}(a_s,b_s)$。\n- 使用给定模型计算在 SR 和 BM 下观察到的备择等位基因频率。\n- 使用阈值 $t$ 应用决策规则，以确定在 SR 和 BM 下的鉴定结果。\n- 计算假阳性率，从而得出 $\\Delta$。\n\n您在实现中必须遵守的约束条件：\n- 使用向量化计算以确保数值稳定性和运行时效率。\n- 使用固定的随机种子以使结果具有确定性。\n\n测试套件：\n- Case 1 (正常路径)：\n  - $L = 100$, $\\alpha = 1.0$, $\\mu_1 = 0.02$, $\\mu_2 = 0.02$, $N = 200000$, $a_1 = 0.2$, $b_1 = 0.8$, $a_2 = 0.2$, $b_2 = 0.8$, $t = 0.2$。\n- Case 2 (边界情况：因 $\\alpha = 0$ 而无偏好)：\n  - $L = 150$, $\\alpha = 0.0$, $\\mu_1 = 0.05$, $\\mu_2 = 0.05$, $N = 200000$, $a_1 = 0.2$, $b_1 = 0.8$, $a_2 = 0.2$, $b_2 = 0.8$, $t = 0.2$。\n- Case 3 (极端情况：强偏好和高差异率)：\n  - $L = 150$, $\\alpha = 1.5$, $\\mu_1 = 0.10$, $\\mu_2 = 0.12$, $N = 200000$, $a_1 = 0.05$, $b_1 = 0.95$, $a_2 = 0.05$, $b_2 = 0.95$, $t = 0.15$。\n- Case 4 (覆盖大量真实多态性位点的情况)：\n  - $L = 100$, $\\alpha = 1.0$, $\\mu_1 = 0.02$, $\\mu_2 = 0.03$, $N = 200000$, $a_1 = 2.0$, $b_1 = 2.0$, $a_2 = 2.0$, $b_2 = 2.0$, $t = 0.2$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表，顺序与上述案例相同，每个值打印到小数点后六位（例如，$[0.001234,0.000000,0.012345,0.000678]$）。",
            "solution": "该问题陈述已经过严格验证，并被确定为有效的。它具有科学依据，定义明确且客观。它提出了一个简化但连贯的遗传测序中参考偏好的模型（这是生物信息学中的一个真实问题），并要求对两种不同分析流程下的假阳性率进行定量比较。为得到唯一的计算解所需的所有参数和定义均已提供。\n\n任务是计算用于检测跨物种多态性的单参考序列 (SR) 比对和偏好最小化 (BM) 比对流程之间假阳性率的差异，即 $\\Delta = \\mathrm{FPR}_{\\mathrm{SR}} - \\mathrm{FPR}_{\\mathrm{BM}}$。\n\n假阳性 (FP) 定义为被鉴定为“共享多态性”但并非“真实共享多态性”的位点。假阳性率是在大量 $N$ 个模拟位点中此类 FP 事件的比例。\n- 如果两个物种的真实等位基因频率 $f_1$ 和 $f_2$ 都落在区间 $[t, 1-t]$ 内，则该位点是**真实共享多态性**。\n- 如果观察到的等位基因频率 $\\widehat{f}_1$ 和 $\\widehat{f}_2$ 都落在区间 $[t, 1-t]$ 内，则该位点被**鉴定为共享多态性**。\n\n问题的核心在于物种 $s$ 的观察备择等位基因频率 $\\widehat{f}_s$ 的模型：\n$$\n\\widehat{f}_s = \\frac{f_s \\, \\exp\\!\\big(-\\alpha(L\\mu_s + \\delta)\\big)}{f_s \\, \\exp\\!\\big(-\\alpha(L\\mu_s + \\delta)\\big) + (1-f_s)\\, \\exp(-\\alpha L\\mu_s)}\n$$\n关键的第一步是简化这个表达式。通过从分子和分母中提出因子 $\\exp(-\\alpha L\\mu_s)$，我们得到了一个更简单的形式：\n$$\n\\widehat{f}_s = \\frac{f_s \\, \\exp(-\\alpha\\delta)}{f_s \\, \\exp(-\\alpha\\delta) + (1-f_s)}\n$$\n这个简化揭示了等位基因频率估计上的比对偏好仅取决于罚分参数 $\\alpha$ 和比对策略参数 $\\delta$，并且出乎意料地与读序长度 $L$ 和物种特异性差异率 $\\mu_s$ 无关。\n\n我们现在分析两种比对策略：\n\n1.  **偏好最小化 (BM) 比对**：对于此流程，$\\delta=0$。项 $\\exp(-\\alpha\\delta)$ 变为 $\\exp(0) = 1$。公式简化为：\n    $$\n    \\widehat{f}_{s, \\mathrm{BM}} = \\frac{f_s \\cdot 1}{f_s \\cdot 1 + (1-f_s)} = f_s\n    $$\n    在 BM 模型下，观察频率完全等于真实频率。因此，鉴定共享多态性的条件 $(\\widehat{f}_{1, \\mathrm{BM}} \\in [t, 1-t] \\land \\widehat{f}_{2, \\mathrm{BM}} \\in [t, 1-t])$ 与真实共享多态性的条件 $(f_1 \\in [t, 1-t] \\land f_2 \\in [t, 1-t])$ 完全相同。因此，逻辑上不可能出现假阳性，即一个位点被鉴定为共享多态性但实际上并非如此。因此，$\\mathrm{FPR}_{\\mathrm{BM}} = 0$。\n\n2.  **单参考序列 (SR) 比对**：对于此流程，$\\delta=1$。公式变为：\n    $$\n    \\widehat{f}_{s, \\mathrm{SR}} = \\frac{f_s \\, e^{-\\alpha}}{f_s \\, e^{-\\alpha} + (1-f_s)}\n    $$\n    对于任何非零罚分 $\\alpha  0$，项 $e^{-\\alpha}$ 小于 1。这导致了系统性的向下偏好，即观察频率总是小于真实频率，$\\widehat{f}_{s, \\mathrm{SR}}  f_s$。这是参考偏好的数学形式化。这种偏好可能导致非真实共享多态性的位点被错误分类。具体来说，一个真实频率 $f_s$ 高于多态性范围（即 $f_s  1-t$）的位点，其观察频率 $\\widehat{f}_{s, \\mathrm{SR}}$ 可能会被向下偏置到 $[t, 1-t]$ 范围内，如果这种情况同时发生在两个物种上，就可能产生一个假阳性鉴定。\n\n要计算的量是 $\\Delta = \\mathrm{FPR}_{\\mathrm{SR}} - \\mathrm{FPR}_{\\mathrm{BM}}$。既然我们已经确定 $\\mathrm{FPR}_{\\mathrm{BM}}=0$，任务就简化为计算 $\\Delta = \\mathrm{FPR}_{\\mathrm{SR}}$。\n\n蒙特卡洛模拟将按如下方式实现：\n\n1.  使用固定的随机种子以确保结果的确定性和可复现性。\n2.  对每个测试用例，我们通过从指定的贝塔分布（$f_s \\sim \\mathrm{Beta}(a_s, b_s)$）中抽样，生成 $N$ 对独立的真实等位基因频率 $(f_1, f_2)$。为提高效率，此操作使用向量化运算。\n3.  计算一个布尔掩码 `is_true_shared`，以识别真实共享多态性的位点集合，其中 $(f_1 \\in [t, 1-t]) \\land (f_2 \\in [t, 1-t])$。\n4.  使用上面推导的简化公式，为所有 $N$ 个位点计算 SR 比对下的观察频率 $\\widehat{f}_{1, \\mathrm{SR}}$ 和 $\\widehat{f}_{2, \\mathrm{SR}}$。这也是一个向量化操作。\n5.  计算一个布尔掩码 `is_called_sr`，以识别在 SR 下被鉴定为共享多态性的位点，其中 $(\\widehat{f}_{1, \\mathrm{SR}} \\in [t, 1-t]) \\land (\\widehat{f}_{2, \\mathrm{SR}} \\in [t, 1-t])$。\n6.  假阳性数 $N_{\\mathrm{FP}}$ 是 `is_called_sr` 为真且 `is_true_shared` 为假的位点计数。\n7.  假阳性率则为 $\\mathrm{FPR}_{\\mathrm{SR}} = N_{\\mathrm{FP}} / N$。\n8.  如前所述，$\\Delta = \\mathrm{FPR}_{\\mathrm{SR}}$。为遵循问题陈述中方法学对称性的要求，同样执行 $\\mathrm{FPR}_{\\mathrm{BM}}$ 的计算，这将得到 0，且不改变最终结果。\n\n对测试套件中的每组参数重复此过程。最终输出将是计算出的 $\\Delta$ 值的列表，格式化为小数点后六位。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the difference in false positive rates for detecting trans-species\n    polymorphism between Single-Reference (SR) and Bias-Minimized (BM)\n    mapping pipelines using a Monte Carlo simulation.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: happy path\n        {'L': 100, 'alpha': 1.0, 'mu1': 0.02, 'mu2': 0.02, 'N': 200000, 'a1': 0.2, 'b1': 0.8, 'a2': 0.2, 'b2': 0.8, 't': 0.2},\n        # Case 2: boundary (no bias because alpha = 0)\n        {'L': 150, 'alpha': 0.0, 'mu1': 0.05, 'mu2': 0.05, 'N': 200000, 'a1': 0.2, 'b1': 0.8, 'a2': 0.2, 'b2': 0.8, 't': 0.2},\n        # Case 3: edge (strong bias and divergence)\n        {'L': 150, 'alpha': 1.5, 'mu1': 0.10, 'mu2': 0.12, 'N': 200000, 'a1': 0.05, 'b1': 0.95, 'a2': 0.05, 'b2': 0.95, 't': 0.15},\n        # Case 4: coverage of many genuinely polymorphic loci\n        {'L': 100, 'alpha': 1.0, 'mu1': 0.02, 'mu2': 0.03, 'N': 200000, 'a1': 2.0, 'b1': 2.0, 'a2': 2.0, 'b2': 2.0, 't': 0.2},\n    ]\n\n    results = []\n    # Use a fixed random seed for reproducibility.\n    # The default_rng is the modern, preferred way to handle random number generation.\n    rng = np.random.default_rng(42)\n\n    for case in test_cases:\n        N = case['N']\n        a1, b1 = case['a1'], case['b1']\n        a2, b2 = case['a2'], case['b2']\n        t = case['t']\n        alpha = case['alpha']\n\n        # Step 1: Draw N independent samples of (f1, f2)\n        f1_samples = rng.beta(a1, b1, size=N)\n        f2_samples = rng.beta(a2, b2, size=N)\n\n        # Step 2: Determine true shared polymorphisms\n        is_true_shared = ((f1_samples = t)  (f1_samples = 1 - t))  \\\n                         ((f2_samples = t)  (f2_samples = 1 - t))\n\n        # --- Calculate FPR for Bias-Minimized (BM) mapping ---\n        # Under BM, delta=0, so f_hat_s = f_s.\n        f_hat_1_bm = f1_samples\n        f_hat_2_bm = f2_samples\n        \n        is_called_bm = ((f_hat_1_bm = t)  (f_hat_1_bm = 1 - t))  \\\n                       ((f_hat_2_bm = t)  (f_hat_2_bm = 1 - t))\n        \n        # A false positive is a locus that is called shared but is not truly shared.\n        # Since is_called_bm is logically identical to is_true_shared, this is always False.\n        fp_bm_count = np.sum(is_called_bm  ~is_true_shared)\n        fpr_bm = fp_bm_count / N\n\n        # --- Calculate FPR for Single-Reference (SR) mapping ---\n        # Under SR, delta=1. The formula for observed frequency simplifies to:\n        # f_hat_s = (f_s * exp(-alpha)) / (f_s * exp(-alpha) + (1 - f_s))\n        \n        if alpha == 0.0:\n            # If alpha is 0, there is no bias, so SR is identical to BM.\n            f_hat_1_sr = f1_samples\n            f_hat_2_sr = f2_samples\n        else:\n            exp_minus_alpha = np.exp(-alpha)\n            \n            # Vectorized calculation for f_hat_1_sr\n            numerator_1 = f1_samples * exp_minus_alpha\n            denominator_1 = numerator_1 + (1 - f1_samples)\n            f_hat_1_sr = numerator_1 / denominator_1\n            \n            # Vectorized calculation for f_hat_2_sr\n            numerator_2 = f2_samples * exp_minus_alpha\n            denominator_2 = numerator_2 + (1 - f2_samples)\n            f_hat_2_sr = numerator_2 / denominator_2\n\n        is_called_sr = ((f_hat_1_sr = t)  (f_hat_1_sr = 1 - t))  \\\n                       ((f_hat_2_sr = t)  (f_hat_2_sr = 1 - t))\n\n        fp_sr_count = np.sum(is_called_sr  ~is_true_shared)\n        fpr_sr = fp_sr_count / N\n\n        # Calculate the difference in FPRs\n        delta = fpr_sr - fpr_bm\n        results.append(delta)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f'{r:.6f}' for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}