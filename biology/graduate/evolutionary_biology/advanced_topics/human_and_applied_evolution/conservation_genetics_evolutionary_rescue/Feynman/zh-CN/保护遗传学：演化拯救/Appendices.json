{
    "hands_on_practices": [
        {
            "introduction": "本节的动手实践旨在将进化救援的理论知识转化为解决实际问题的定量建模能力。这些练习将引导你从适应性反应的遗传基础出发，逐步深入到救援过程的随机性，并最终将这些模型应用于保护决策。\n\n第一个练习聚焦于决定种群能否在环境突变后生存下来的核心要素：遗传潜力。我们将探索反应范数（reaction norm）的演化，这是一个连接基因型、表型和环境的关键概念。此练习要求你运用多变量育种者方程，在一个假设的情景中推导出为了避免灭绝，种群在表型可塑性上所需的最小遗传变异量。通过这个计算，你将具体地理解遗传变异（特别是演化出新的环境敏感度的能力）是如何直接转化为种群适应潜力的。",
            "id": "2698506",
            "problem": "一个受威胁的种群在第 $t=0$ 代时经历了一次从基线环境 $E_{0}=0$ 到新的恒定环境 $E_{1}\\neq 0$ 的突发环境变化。单个数量表型 $z$ 通过朝向依赖于环境的最适值 $z^{\\ast}(E)=\\kappa E$ 的高斯稳定选择来决定绝对适合度，因此个体绝对适合度为\n$$\nW(z,E) \\;=\\; \\exp\\!\\left(-\\frac{(z - z^{\\ast}(E))^{2}}{2\\,\\Omega^{2}}\\right).\n$$\n除了选择之外，该种群每代还经历密度无关的种群增殖 $R>1$，因此在平均表型下的每代种群增长倍率为 $\\lambda \\,=\\, R\\,\\bar W$，其中 $\\bar W$ 是平均绝对适合度。\n\n该表型的反应规范是线性的，$z(E) \\,=\\, a + b\\,E$，其中 $a$ 是截距，$b$ 是可塑性斜率。$(a,b)$ 的加性遗传（协）方差定义了遗传方差-协方差矩阵\n$$\n\\mathbf{G} \\;=\\; \\begin{pmatrix}\nG_{aa} & G_{ab} \\\\\nG_{ab} & G_{bb}\n\\end{pmatrix},\n$$\n其中 $G_{aa}>0$，$G_{ab}$ 为给定常数，$G_{bb}\\ge 0$ 待定。在 $t=0$ 时，平均反应规范参数为 $(\\bar a_{0},\\bar b_{0})=(a_{0},b_{0})$，这些都是常数。假设 Lande 方程（多变量育种者方程）在新环境中对一代有效：$\\Delta \\boldsymbol{\\mu} \\,=\\, \\mathbf{G}\\,\\boldsymbol{\\beta}$，其中 $\\boldsymbol{\\mu}=(a,b)^{\\top}$，$\\boldsymbol{\\beta}$ 是在 $E=E_{1}$ 时根据 $\\ln W$ 计算出的对 $(a,b)$ 的选择梯度。假设表型方差足够小，以至于选择作用下的平均动态可以由在平均表型处评估的 $\\ln W$ 的选择梯度精确捕捉。\n\n将新环境下的初始错配定义为 $\\delta \\,=\\, a_{0} + b_{0}E_{1} - \\kappa E_{1}$。经过一代的选择和遗传响应后，新的平均错配为 $\\delta'$，新的每代增长倍率为 $\\lambda_{1} = R\\,\\exp\\!\\left(-\\delta'^{2}/(2\\,\\Omega^{2})\\right)$。将（在这个单代时间尺度上的）进化拯救定义为 $\\lambda_{1}\\ge 1$。\n\n假设参数满足 $0 \\le \\sqrt{2\\ln R}\\,\\Omega/|\\delta| \\le 1$，并且可以选择 $\\mathbf{G}$，使其在环境 $E_{1}$ 中对表现出的表型的隐含加性遗传方差为非负。在这些假设下，导出可塑性斜率的最小加性遗传方差 $G_{bb}^{\\mathrm{crit}}$ 的一个闭式解析表达式，该表达式保证一代后 $\\lambda_{1}=1$（进化拯救的阈值），并用 $a_{0}$, $b_{0}$, $\\kappa$, $E_{1}$, $\\Omega^{2}$, $R$, $G_{aa}$, 和 $G_{ab}$ 表示。\n\n您的最终答案必须是单个闭式表达式。最终答案中不要包含单位。如果存在多个代数分支，请选择在所述假设 $0 \\le \\sqrt{2\\ln R}\\,\\Omega/|\\delta| \\le 1$ 下产生最小 $G_{bb}$ 的分支。",
            "solution": "问题要求解可塑性斜率的最小加性遗传方差，记为 $G_{bb}^{\\mathrm{crit}}$，它能使一个种群在新环境中经过一代后实现进化拯救。进化拯救的定义是种群的每代增长倍率至少为1，即 $\\lambda_{1} \\ge 1$。我们需要找到使 $\\lambda_1=1$ 的 $G_{bb}$ 的值。\n\n首先，我们建立拯救阈值的条件，即 $\\lambda_{1}=1$。每代增长倍率由 $\\lambda_{1} = R\\,\\exp\\left(-\\frac{\\delta'^{2}}{2\\,\\Omega^{2}}\\right)$ 给出，其中 $\\delta'$ 是经过一代选择后平均表型与最适值之间的错配。设 $\\lambda_1=1$：\n$$\nR\\,\\exp\\left(-\\frac{\\delta'^{2}}{2\\,\\Omega^{2}}\\right) = 1\n$$\n两边取自然对数：\n$$\n\\ln(R) - \\frac{\\delta'^{2}}{2\\,\\Omega^{2}} = 0\n$$\n$$\n\\delta'^{2} = 2\\,\\Omega^{2}\\ln(R)\n$$\n这意味着一代后的错配量必须是：\n$$\n|\\delta'| = \\Omega\\sqrt{2\\ln R}\n$$\n接下来，我们必须将新的错配 $\\delta'$ 与种群的初始状态联系起来。新的错配是 $\\delta' = \\bar{z}_{1} - z^{\\ast}(E_{1})$，其中 $\\bar{z}_{1}$ 是选择后在环境 $E_1$ 中的平均表型，而 $z^{\\ast}(E_{1}) = \\kappa E_1$ 是最适表型。平均表型根据多变量育种者方程（Lande 方程）演化，$\\Delta \\boldsymbol{\\mu} = \\mathbf{G}\\,\\boldsymbol{\\beta}$，其中 $\\boldsymbol{\\mu} = (a, b)^{\\top}$ 代表平均反应规范参数。新的平均性状向量是 $\\boldsymbol{\\mu}_1 = \\boldsymbol{\\mu}_0 + \\Delta\\boldsymbol{\\mu}$，其中 $\\boldsymbol{\\mu}_0 = (a_0, b_0)^{\\top}$。\n\n选择梯度 $\\boldsymbol{\\beta}$ 是个体适合度对数 $\\ln W$ 对性状 $(a, b)$ 的偏导数向量，在新环境 $E_{1}$ 中于平均性状值 $(a_0, b_0)$ 处求值。对数适合度函数是：\n$$\n\\ln W(a,b,E_{1}) = -\\frac{(z(E_1) - z^{\\ast}(E_1))^{2}}{2\\,\\Omega^{2}} = -\\frac{(a + bE_{1} - \\kappa E_{1})^{2}}{2\\,\\Omega^{2}}\n$$\n选择梯度的分量是：\n$$\n\\beta_{a} = \\left.\\frac{\\partial \\ln W}{\\partial a}\\right|_{(a_0,b_0)} = -\\frac{a_{0} + b_{0}E_{1} - \\kappa E_{1}}{\\Omega^{2}} = -\\frac{\\delta}{\\Omega^{2}}\n$$\n$$\n\\beta_{b} = \\left.\\frac{\\partial \\ln W}{\\partial b}\\right|_{(a_0,b_0)} = -\\frac{(a_{0} + b_{0}E_{1} - \\kappa E_{1})E_{1}}{\\Omega^{2}} = -\\frac{\\delta E_{1}}{\\Omega^{2}}\n$$\n这里，$\\delta = a_{0} + b_{0}E_{1} - \\kappa E_{1}$ 是初始错配。选择梯度向量为 $\\boldsymbol{\\beta} = -\\frac{\\delta}{\\Omega^{2}}\\begin{pmatrix} 1 \\\\ E_{1} \\end{pmatrix}$。\n\n平均反应规范参数的变化是：\n$$\n\\Delta \\boldsymbol{\\mu} = \\begin{pmatrix} \\Delta \\bar{a} \\\\ \\Delta \\bar{b} \\end{pmatrix} = \\mathbf{G}\\boldsymbol{\\beta} = \\begin{pmatrix} G_{aa} & G_{ab} \\\\ G_{ab} & G_{bb} \\end{pmatrix} \\left(-\\frac{\\delta}{\\Omega^{2}} \\begin{pmatrix} 1 \\\\ E_{1} \\end{pmatrix}\\right) = -\\frac{\\delta}{\\Omega^{2}} \\begin{pmatrix} G_{aa} + G_{ab}E_{1} \\\\ G_{ab} + G_{bb}E_{1} \\end{pmatrix}\n$$\n在环境 $E_{1}$ 中的新平均表型是 $\\bar{z}_{1} = \\bar{a}_{1} + \\bar{b}_{1}E_{1} = (a_0 + \\Delta \\bar{a}) + (b_0 + \\Delta \\bar{b})E_1$。\n新的错配是 $\\delta' = \\bar{z}_{1} - z^{\\ast}(E_{1}) = (a_{0} + b_{0}E_{1} - \\kappa E_{1}) + (\\Delta \\bar{a} + E_{1}\\Delta \\bar{b})$。也就是 $\\delta' = \\delta + \\Delta \\bar{z}$，其中 $\\Delta \\bar{z}$ 是平均表型的变化。\n$$\n\\Delta \\bar{z} = \\Delta \\bar{a} + E_{1}\\Delta \\bar{b} = -\\frac{\\delta}{\\Omega^{2}}(G_{aa} + G_{ab}E_{1}) - \\frac{\\delta}{\\Omega^{2}}(G_{ab} + G_{bb}E_{1})E_{1}\n$$\n$$\n\\Delta \\bar{z} = -\\frac{\\delta}{\\Omega^{2}} (G_{aa} + 2G_{ab}E_{1} + G_{bb}E_{1}^{2})\n$$\n项 $V_{A,z}(E_1) = G_{aa} + 2G_{ab}E_{1} + G_{bb}E_{1}^{2}$ 是在环境 $E_1$ 中表型 $z$ 的总加性遗传方差。因此，$\\Delta \\bar{z} = -\\frac{\\delta}{\\Omega^2}V_{A,z}(E_1)$。\n新的错配是：\n$$\n\\delta' = \\delta + \\Delta \\bar{z} = \\delta - \\frac{\\delta}{\\Omega^2}V_{A,z}(E_1) = \\delta\\left(1 - \\frac{V_{A,z}(E_1)}{\\Omega^2}\\right)\n$$\n现在我们使用拯救条件 $|\\delta'| = \\Omega\\sqrt{2\\ln R}$：\n$$\n|\\delta| \\left|1 - \\frac{V_{A,z}(E_1)}{\\Omega^2}\\right| = \\Omega\\sqrt{2\\ln R}\n$$\n重新整理得到：\n$$\n\\left|1 - \\frac{V_{A,z}(E_1)}{\\Omega^2}\\right| = \\frac{\\Omega\\sqrt{2\\ln R}}{|\\delta|}\n$$\n这个方程对于绝对值内的项有两个可能的解，对应两个代数分支：\n$$\n1 - \\frac{V_{A,z}(E_1)}{\\Omega^2} = \\frac{\\Omega\\sqrt{2\\ln R}}{|\\delta|} \\quad \\text{或} \\quad 1 - \\frac{V_{A,z}(E_1)}{\\Omega^2} = -\\frac{\\Omega\\sqrt{2\\ln R}}{|\\delta|}\n$$\n在每种情况下求解 $V_{A,z}(E_1)$：\n$$\nV_{A,z}(E_1) = \\Omega^2 \\left(1 - \\frac{\\Omega\\sqrt{2\\ln R}}{|\\delta|}\\right) \\quad \\text{或} \\quad V_{A,z}(E_1) = \\Omega^2 \\left(1 + \\frac{\\Omega\\sqrt{2\\ln R}}{|\\delta|}\\right)\n$$\n问题要求的是保证拯救的最小 $G_{bb}$。因为 $V_{A,z}(E_1) = G_{aa} + 2G_{ab}E_{1} + G_{bb}E_{1}^{2}$ 且 $E_1^2 > 0$，所以最小化 $G_{bb}$ 等价于最小化 $V_{A,z}(E_1)$。在假设 $0 \\le \\sqrt{2\\ln R}\\,\\Omega/|\\delta| \\le 1$ 的情况下，$V_{A,z}(E_1)$ 的两个可能值都是非负的。为了找到最小的 $G_{bb}$，我们必须为 $V_{A,z}(E_1)$ 选择较小的值，这对应于第一个分支：\n$$\nV_{A,z}(E_1) = \\Omega^2 \\left(1 - \\frac{\\Omega\\sqrt{2\\ln R}}{|\\delta|}\\right)\n$$\n代入 $V_{A,z}(E_1)$ 的表达式：\n$$\nG_{aa} + 2G_{ab}E_{1} + G_{bb}E_{1}^{2} = \\Omega^2 \\left(1 - \\frac{\\Omega\\sqrt{2\\ln R}}{|\\delta|}\\right)\n$$\n我们现在可以求解 $G_{bb}^{\\mathrm{crit}}$：\n$$\nG_{bb}^{\\mathrm{crit}} E_{1}^{2} = \\Omega^2 \\left(1 - \\frac{\\Omega\\sqrt{2\\ln R}}{|\\delta|}\\right) - G_{aa} - 2G_{ab}E_{1}\n$$\n由于 $E_1 \\neq 0$，我们可以除以 $E_1^2$：\n$$\nG_{bb}^{\\mathrm{crit}} = \\frac{1}{E_{1}^{2}} \\left[ \\Omega^2 \\left(1 - \\frac{\\Omega\\sqrt{2\\ln R}}{|\\delta|}\\right) - G_{aa} - 2G_{ab}E_{1} \\right]\n$$\n最后，代入定义 $|\\delta| = |a_{0} + b_{0}E_{1} - \\kappa E_{1}|$：\n$$\nG_{bb}^{\\mathrm{crit}} = \\frac{1}{E_{1}^{2}} \\left[ \\Omega^2 - \\frac{\\Omega^3\\sqrt{2\\ln R}}{|a_{0} + b_{0}E_{1} - \\kappa E_{1}|} - G_{aa} - 2G_{ab}E_{1} \\right]\n$$\n此表达式代表了在所有问题假设下，为达到一代后进化拯救的阈值，可塑性斜率所需的最小加性遗传方差。",
            "answer": "$$\n\\boxed{\\frac{1}{E_{1}^{2}} \\left[ \\Omega^{2} \\left(1 - \\frac{\\Omega\\sqrt{2\\ln R}}{|a_{0} + b_{0}E_{1} - \\kappa E_{1}|}\\right) - G_{aa} - 2G_{ab}E_{1} \\right]}\n$$"
        },
        {
            "introduction": "拥有遗传潜力是进化救援的先决条件，但救援本身是一个充满偶然性的随机过程。本次练习将带领你从第一性原理出发，构建一个模型来计算当适应性需要多个突变时，进化救援的总概率。在这个假设的微生物种群场景中，救援可以通过两条具有不同中间步骤和最终适应度的突变路径发生。你将学习如何结合种群动态和分支过程理论（branching process theory）来量化成功的可能性，并理解诸如适应性低谷等上位性效应是如何影响整个过程的。",
            "id": "2698500",
            "problem": "一个克隆微生物种群在时间 $t=0$ 时经历了一次突然的环境恶化，这使得祖先基因型（记为 $A_{0}$）适应不良。假设其遵循连续时间的出生-死亡动态过程，所有基因型的单位个体出生率固定为 $b=1$，且特定基因型的马尔萨斯参数 $r_{i}=b-d_{i}$ 由其死亡率 $d_{i}$ 决定。祖先基因型的 $r_{0}<0$，因此在没有演化拯救的情况下，种群数量会按 $N(t)=N_{0}\\exp(r_{0} t)$ 确定性地下降，并最终灭绝。突变发生在细胞分裂事件中。\n\n演化拯救需要两次突变，并表现出上位效应和路径依赖性，通过两条可选的突变路径产生具有不同增长率的不同拯救基因型：\n\n- 路径 $B$：$A_{0} \\xrightarrow{u_{b}} B \\xrightarrow{v_{b}} R^{(b)}$，其中中间体 $B$ 的 $r_{B}<0$，最终的拯救基因型 $R^{(b)}$ 的 $r_{R}^{(b)}>0$。\n- 路径 $C$：$A_{0} \\xrightarrow{u_{c}} C \\xrightarrow{v_{c}} R^{(c)}$，其中中间体 $C$ 的 $r_{C}<0$，最终的拯救基因型 $R^{(c)}$ 的 $r_{R}^{(c)}>0$。\n\n假设以下标准且经过充分检验的近似成立：(i) 新突变体出现遵循稀有突变、独立事件（泊松）近似；(ii) 在出生率为 $b=1$ 的线性出生-死亡过程中，一个具有 $r>0$ 的稀有超临界世系，其精确的定殖概率为 $p_{\\mathrm{est}}=r$；(iii) 一个具有 $r<0$ 和 $b=1$ 的稀有亚临界世系，在其整个世系生命周期内产生的预期总出生数等于 $E[X]=\\frac{1}{-r}$。\n\n参数值如下：\n- 初始种群大小 $N_{0}=1.2\\times 10^{11}$。\n- 祖先马尔萨斯参数 $r_{0}=-0.1$。\n- 第一步突变率 $u_{b}=2.0\\times 10^{-7}$ 和 $u_{c}=5.0\\times 10^{-8}$ 每次出生。\n- 中间体增长参数 $r_{B}=-0.02$ 和 $r_{C}=-0.05$。\n- 第二步突变率 $v_{b}=1.0\\times 10^{-6}$ 和 $v_{c}=1.5\\times 10^{-6}$ 每次出生。\n- 拯救基因型增长参数 $r_{R}^{(b)}=0.04$ 和 $r_{R}^{(c)}=0.02$。\n\n仅使用上述基本原理，忽略成功拯救世系间的密度依赖和克隆干扰，从第一性原理推导出演化拯救总概率 $P_{\\mathrm{rescue}}$ 的封闭形式表达式，该表达式应考虑到所描述的两步、上位效应和路径依赖结构。然后，使用给定的参数值计算 $P_{\\mathrm{rescue}}$。将最终数值答案报告为保留四位有效数字的小数。不要使用百分号。",
            "solution": "题目陈述已经过验证，被认为是科学合理的、定义明确的且客观的。它提供了一套自洽且一致的定义、参数以及来自演化理论的既定近似，从而能够得出一个严谨且唯一的解。我将开始推导。\n\n演化拯救的总概率 $P_{\\mathrm{rescue}}$ 是至少一个成功的拯救世系出现并定殖的概率。根据所提供的稀有独立事件近似，成功拯救世系的总数服从泊松分布。因此，拯救概率为 $P_{\\mathrm{rescue}} = 1 - P(\\text{无拯救})$。如果 $\\Lambda_{\\mathrm{rescue}}$ 是成功拯救世系的总预期数，那么没有拯救的概率是 $\\exp(-\\Lambda_{\\mathrm{rescue}})$。因此，问题简化为计算 $\\Lambda_{\\mathrm{rescue}}$。\n\n$$P_{\\mathrm{rescue}} = 1 - \\exp(-\\Lambda_{\\mathrm{rescue}})$$\n\n题目指明了两条独立的突变路径B和C，并明确指出要忽略克隆干扰。因此，成功拯救世系的总预期数是来自每条路径的预期数之和：\n\n$$\\Lambda_{\\mathrm{rescue}} = \\Lambda_{b} + \\Lambda_{c}$$\n\n在此，$\\Lambda_{b}$ 和 $\\Lambda_{c}$ 分别是从路径B和C产生的成功拯救世系的预期数。我们必须为每一个推导出一个表达式。\n\n考虑路径 B: $A_{0} \\xrightarrow{u_{b}} B \\xrightarrow{v_{b}} R^{(b)}$。\n在时间 $t$ 产生 B 型中间突变体的速率由祖先种群大小 $N(t)$、单位个体出生率 $b=1$ 和突变率 $u_{b}$ 的乘积给出。祖先种群数量按 $N(t) = N_{0}\\exp(r_{0} t)$ 确定性地下降。\n新 B 突变体出现的速率为：\n$$ \\text{Rate}_{A_{0}\\to B}(t) = N(t) \\cdot b \\cdot u_{b} = N_{0}u_{b}\\exp(r_{0}t) $$\n每个新形成的 B 突变体都会建立一个世系。这个世系是亚临界的，其马尔萨斯参数 $r_{B} < 0$。根据所提供的近似(iii)，这样一个亚临界世系在其整个生命周期内产生的预期总出生数是 $E[X_{B}] = \\frac{1}{-r_{B}}$。\n\nB 世系内的每次出生都有机会发生第二次突变，产生拯救基因型 $R^{(b)}$，其发生率为每次出生 $v_{b}$。因此，由单个 B 世系产生的 $R^{(b)}$ 突变体的预期数是：\n$$ E[N_{R^{(b)}} | \\text{1 B-lineage}] = v_{b} \\cdot E[X_{B}] = \\frac{v_{b}}{-r_{B}} $$\n拯救基因型 $R^{(b)}$ 是超临界的，其马尔萨斯参数 $r_{R}^{(b)} > 0$。根据近似(ii)，单个 $R^{(b)}$ 突变体建立一个成功的、增长的世系的概率是 $p_{\\mathrm{est}}^{(b)} = r_{R}^{(b)}$。\n\n结合这些结果，单个新 B 突变体产生一个成功拯救世系的概率是它产生的 $R^{(b)}$ 突变体的预期数乘以它们的定殖概率：\n$$ P(\\text{rescue} | \\text{1 B-mutant}) = E[N_{R^{(b)}} | \\text{1 B-lineage}] \\cdot p_{\\mathrm{est}}^{(b)} = \\frac{v_{b}}{-r_{B}} \\cdot r_{R}^{(b)} $$\n在时间 $t$ 通过路径 B 产生成功拯救世系的速率，记为 $\\lambda_{b}(t)$，是 B 突变体产生速率乘以每个突变体导致拯救的概率：\n$$ \\lambda_{b}(t) = \\text{Rate}_{A_{0}\\to B}(t) \\cdot P(\\text{rescue} | \\text{1 B-mutant}) = N_{0}u_{b}\\exp(r_{0}t) \\frac{v_{b}r_{R}^{(b)}}{-r_{B}} $$\n从路径 B 产生的成功拯救世系的总预期数 $\\Lambda_{b}$ 是该速率在所有时间（从 $t=0$ 到 $\\infty$）上的积分：\n$$ \\Lambda_{b} = \\int_{0}^{\\infty} \\lambda_{b}(t) \\,dt = \\int_{0}^{\\infty} N_{0}u_{b} \\frac{v_{b}r_{R}^{(b)}}{-r_{B}} \\exp(r_{0}t) \\,dt $$\n由于项 $N_{0}u_{b}\\frac{v_{b}r_{R}^{(b)}}{-r_{B}}$ 是常数，我们可以将其从积分中提出：\n$$ \\Lambda_{b} = N_{0}u_{b} \\frac{v_{b}r_{R}^{(b)}}{-r_{B}} \\int_{0}^{\\infty} \\exp(r_{0}t) \\,dt $$\n该积分的计算结果为：\n$$ \\int_{0}^{\\infty} \\exp(r_{0}t) \\,dt = \\left[ \\frac{1}{r_{0}}\\exp(r_{0}t) \\right]_{0}^{\\infty} = 0 - \\frac{1}{r_{0}} = \\frac{-1}{r_{0}} \\quad (\\text{因为 } r_{0} < 0) $$\n将此结果代回，得到 $\\Lambda_{b}$ 的表达式：\n$$ \\Lambda_{b} = N_{0}u_{b} \\frac{v_{b}r_{R}^{(b)}}{-r_{B}} \\left( \\frac{-1}{r_{0}} \\right) = \\frac{N_{0}u_{b}v_{b}r_{R}^{(b)}}{r_{0}r_{B}} $$\n根据相同的逻辑，从路径 C 产生的成功拯救世系的预期数表达式为：\n$$ \\Lambda_{c} = \\frac{N_{0}u_{c}v_{c}r_{R}^{(c)}}{r_{0}r_{C}} $$\n拯救世系的总预期数是这两项之和。因此，拯救总概率的封闭形式表达式为：\n$$ P_{\\mathrm{rescue}} = 1 - \\exp\\left( -\\left( \\frac{N_{0}u_{b}v_{b}r_{R}^{(b)}}{r_{0}r_{B}} + \\frac{N_{0}u_{c}v_{c}r_{R}^{(c)}}{r_{0}r_{C}} \\right) \\right) = 1 - \\exp\\left( -\\frac{N_{0}}{r_{0}}\\left( \\frac{u_{b}v_{b}r_{R}^{(b)}}{r_{B}} + \\frac{u_{c}v_{c}r_{R}^{(c)}}{r_{C}} \\right) \\right) $$\n现在，我们代入给定的参数值以获得数值结果。\n参数如下：\n$N_{0}=1.2\\times 10^{11}$，$r_{0}=-0.1$。\n对于路径B：$u_{b}=2.0\\times 10^{-7}$，$r_{B}=-0.02$，$v_{b}=1.0\\times 10^{-6}$，$r_{R}^{(b)}=0.04$。\n对于路径C：$u_{c}=5.0\\times 10^{-8}$，$r_{C}=-0.05$，$v_{c}=1.5\\times 10^{-6}$，$r_{R}^{(c)}=0.02$。\n\n首先，计算 $\\Lambda_{b}$：\n$$ \\Lambda_{b} = \\frac{(1.2\\times 10^{11})(2.0\\times 10^{-7})(1.0\\times 10^{-6})(0.04)}{(-0.1)(-0.02)} = \\frac{9.6 \\times 10^{-4}}{0.002} = 0.48 $$\n其次，计算 $\\Lambda_{c}$：\n$$ \\Lambda_{c} = \\frac{(1.2\\times 10^{11})(5.0\\times 10^{-8})(1.5\\times 10^{-6})(0.02)}{(-0.1)(-0.05)} = \\frac{1.8 \\times 10^{-4}}{0.005} = 0.036 $$\n成功拯救世系的总预期数是：\n$$ \\Lambda_{\\mathrm{rescue}} = \\Lambda_{b} + \\Lambda_{c} = 0.48 + 0.036 = 0.516 $$\n最后，拯救的总概率是：\n$$ P_{\\mathrm{rescue}} = 1 - \\exp(-\\Lambda_{\\mathrm{rescue}}) = 1 - \\exp(-0.516) \\approx 1 - 0.596899... \\approx 0.403100... $$\n四舍五入到四位有效数字，最终结果是 $0.4031$。",
            "answer": "$$\\boxed{0.4031}$$"
        },
        {
            "introduction": "保护遗传学模型的最终目标往往是为实际的管理决策提供科学依据。这项综合性练习将让你扮演一名保护管理者的角色，面对复杂的权衡和不确定性，设计最优的“辅助迁地”（translocation）策略。你需要通过建立一个效用函数，来平衡引入新个体可能带来的生物学收益（即增加进化救援概率）与潜在的生态风险（如遗传侵蚀）。此练习的一大挑战是在关键生物学参数存在不确定性的情况下，运用数值方法找到最优的管理方案，这体现了现代定量保护科学的核心思想。",
            "id": "2698503",
            "problem": "你的任务是设计一个程序，该程序使用一个根植于群体遗传学和分支过程理论且有原则的随机模型，以计算最优的保育迁地决策，从而在不确定性下最大化进化救援的概率。背景设定如下。\n\n在 $t=0$ 时刻，一个目标种群的普查规模为 $N_0$（个体），该种群正在经历导致确定性种群数量下降的环境变化，并且携带一个潜在的适应性等位基因 $A$。你可以在 $t=0$ 时刻引入 $m$ 个携带适应性等位基因 $A$ 的迁移个体。数量 $m$ 必须是一个非负整数，并受到预算的限制：每个迁移个体的成本为 $c_m$ 单位，总预算为 $B$，因此 $0 \\le m \\le \\left\\lfloor B/c_m \\right\\rfloor$。所有速率都是无量纲的代际量。\n\n基本原理和假设：\n- 野生型背景的平均每个体后代数为 $R_w = 1 - d$，其中 $d \\in (0,1)$ 代表种群数量下降的强度。适应性等位基因 $A$ 赋予一个加性优势 $s \\ge 0$，因此当其稀有时，平均每个体后代数为 $R_A(s) = 1 - d + s$。\n- 当稀有时，独立的 $A$ 基因谱系的早期动态可以被建模为一个后代数量服从泊松分布且均值为 $R_A(s)$ 的 Galton–Watson 分支过程。分支过程理论的一个经典结果指出，单个谱系的建立（不灭绝）概率在 $R_A(s) \\le 1$ 时为 $0$，在 $R_A(s) > 1$ 时为 $1 - 1/R_A(s)$。\n- 来自现存变异的初始 $A$ 谱系数量被建模为 $K \\sim \\mathrm{Binomial}(N_0, p_0)$，其中 $p_0$ 是未知的初始 $A$ 基因频率。$p_0$ 的不确定性由一个 Beta 先验分布表示，$p_0 \\sim \\mathrm{Beta}(a,b)$，其中 $a>0$ 且 $b>0$。\n- 选择优势 $s$ 的不确定性由一个有限区间上的 Beta 先验分布表示：$s \\in [0, s_{\\max}]$，其密度为 $f_S(s) = \\dfrac{1}{s_{\\max}} \\mathrm{BetaPDF}\\!\\left(\\dfrac{s}{s_{\\max}}; \\alpha_s, \\beta_s \\right)$，其中 $\\alpha_s>0$、$\\beta_s>0$，且 $\\mathrm{BetaPDF}$ 是在 $[0,1]$ 上的 Beta 概率密度函数。\n\n管理目标：\n- 设单个 $A$ 谱系的建立概率为 $p_{\\mathrm{est}}(s)$，由上述分支过程的事实确定。假设稀有时谱系之间相互独立，那么在给定 $K$ 个现存变异谱系和 $m$ 个迁移谱系的情况下，至少有一个谱系建立的概率为 $1 - (1 - p_{\\mathrm{est}}(s))^{K + m}$。\n- 你的目标是选择 $m$ 以最大化期望效用\n$$\nU(m) \\;=\\; \\mathbb{E}_S \\left[ \\, \\mathbb{E}_{p_0} \\left[ \\, \\mathbb{E}_{K \\,\\mid\\, p_0} \\left[ \\, 1 - (1 - p_{\\mathrm{est}}(S))^{K + m} \\, \\right] \\, \\right] \\, \\right] \\;-\\; \\lambda \\left( \\frac{m}{N_0} \\right)^2,\n$$\n其中 $\\lambda \\ge 0$ 是一个惩罚权重，用于模拟迁移个体带来的二次方基因淹没风险。若出现结果相同的情况，应选择较小的 $m$。所有期望值都是相对于所述的不确定性模型计算的。\n\n要求：\n- 你的推导必须仅基于所提供的基本事实（具有泊松后代均值 $R_A(s)$ 的 Galton–Watson 分支过程及其不灭绝概率；现存变异的二项抽样；指定的 Beta 先验分布）。\n- 你必须通过在 $[0,s_{\\max}]$ 上进行数值求积来计算关于 $s$ 的期望值，使用一个至少包含 $n=128$ 个节点的确定性规则。你的实现必须对以下所有测试用例都保持数值稳定。你可以假设所有随机变量和参数都是独立的，除非另有明确说明。\n- 你必须通过在 $R_A(s) \\le 1$ 时遵守 $p_{\\mathrm{est}}(s) = 0$ 的规则，并正确处理当所有 $s \\in [0,s_{\\max}]$ 都满足 $R_A(s) \\le 1$ 的情况，来确保科学上的真实性。\n- 所有速率（$d$、$s$、$p_0$）都是无量纲的代际量，不需要物理单位。输出必须是没有任何单位的整数。\n\n测试套件：\n对于下方的每一组参数，计算最优的 $m^\\star$ 以最大化 $U(m)$，约束条件为 $m \\in \\{0,1,2,\\ldots,\\left\\lfloor B/c_m \\right\\rfloor\\}$。\n\n- 情况 A (一般可行情况):\n  - $N_0 = 100$, $d = 0.05$, $s_{\\max} = 0.20$, $\\alpha_s = 2.0$, $\\beta_s = 5.0$.\n  - $a = 1.0$, $b = 99.0$.\n  - $B = 20$, $c_m = 1$, $\\lambda = 0.01$.\n\n- 情况 B (边界：零预算):\n  - $N_0 = 100$, $d = 0.05$, $s_{\\max} = 0.20$, $\\alpha_s = 2.0$, $\\beta_s = 5.0$.\n  - $a = 1.0$, $b = 99.0$.\n  - $B = 0$, $c_m = 1$, $\\lambda = 0.01$.\n\n- 情况 C (边缘：不可能建立):\n  - $N_0 = 200$, $d = 0.30$, $s_{\\max} = 0.20$, $\\alpha_s = 2.0$, $\\beta_s = 5.0$.\n  - $a = 1.0$, $b = 199.0$.\n  - $B = 50$, $c_m = 1$, $\\lambda = 0.001$.\n\n- 情况 D (权衡由惩罚项主导):\n  - $N_0 = 300$, $d = 0.08$, $s_{\\max} = 0.25$, $\\alpha_s = 2.5$, $\\beta_s = 3.5$.\n  - $a = 1.5$, $b = 298.5$.\n  - $B = 60$, $c_m = 5$, $\\lambda = 1.5$.\n\n最终输出格式：\n你的程序应生成单行输出，其中包含案例 A、B、C 和 D 的最优整数 $m^\\star$（按此顺序），以逗号分隔，并用方括号括起来，例如：“[mA,mB,mC,mD]”。",
            "solution": "所提出的问题是应用进化生物学领域，特别是保育遗传学范畴内的一个良定义的优化任务。它具有科学依据，数学上一致，且所有参数和目标都已明确定义。我将着手进行正式的解答推导。\n\n目标是找到能最大化效用函数 $U(m)$ 的引入迁移个体数量 $m$。$m$ 的允许值集合为不违反成本约束的非负整数集，即 $m \\in \\{0, 1, 2, \\ldots, \\lfloor B/c_m \\rfloor\\}$。效用函数由下式给出：\n$$\nU(m) = \\mathbb{E}_S \\left[ \\, \\mathbb{E}_{p_0} \\left[ \\, \\mathbb{E}_{K \\,\\mid\\, p_0} \\left[ \\, 1 - (1 - p_{\\mathrm{est}}(S))^{K + m} \\, \\right] \\, \\right] \\, \\right] - \\lambda \\left( \\frac{m}{N_0} \\right)^2\n$$\n该函数由两部分组成：代表进化救援总概率的生物学效益，以及代表与迁地相关风险的二次惩罚项。我们的任务是找到 $m^\\star = \\arg\\max_m U(m)$。\n\n首先，让我们简化期望项，我将其记为 $E_{\\text{bio}}(m)$。该期望是在三层不确定性上计算的：初始适应性等位基因数 $K$、其频率 $p_0$ 和选择系数 $s$。我们可以使用全期望定律来简化这个表达式。\n\n令 $q(s) = 1 - p_{\\mathrm{est}}(s)$ 为在给定选择系数 $s$ 的情况下，适应性等位基因 $A$ 的单个谱系灭绝的概率。期望内的表达式是至少有一个谱系建立的概率，$1 - q(s)^{K+m}$。\n\n最内层的期望是关于 $K$ 的，它服从二项分布，$K \\sim \\mathrm{Binomial}(N_0, p_0)$。\n$$\n\\mathbb{E}_{K \\,\\mid\\, p_0} \\left[ 1 - q(s)^{K+m} \\right] = 1 - \\mathbb{E}_{K \\,\\mid\\, p_0} \\left[ q(s)^{K+m} \\right] = 1 - q(s)^m \\mathbb{E}_{K \\,\\mid\\, p_0} \\left[ q(s)^K \\right]\n$$\n项 $\\mathbb{E}_{K \\,\\mid\\, p_0} [q(s)^K]$ 是二项分布 $\\mathrm{Binomial}(N_0, p_0)$ 的概率生成函数（PGF）在 $q(s)$ 处的值。$\\mathrm{Binomial}(n,p)$ 的 PGF 是 $G(z) = (1-p+pz)^n$。因此，\n$$\n\\mathbb{E}_{K \\,\\mid\\, p_0} \\left[ q(s)^K \\right] = (1 - p_0 + p_0 q(s))^{N_0} = (1 - p_0(1 - q(s)))^{N_0}\n$$\n回想起 $p_{\\mathrm{est}}(s) = 1 - q(s)$，这变成了 $(1 - p_0 p_{\\mathrm{est}}(s))^{N_0}$。\n\n下一层的期望是关于初始等位基因频率 $p_0$ 的，它服从 Beta 分布，$p_0 \\sim \\mathrm{Beta}(a,b)$。我们需要计算：\n$$\n\\mathbb{E}_{p_0} \\left[ (1 - p_0 p_{\\mathrm{est}}(s))^{N_0} \\right]\n$$\n这可以通过使用二项式定理展开该项来计算：\n$$\n(1 - p_0 p_{\\mathrm{est}}(s))^{N_0} = \\sum_{k=0}^{N_0} \\binom{N_0}{k} (-p_0 p_{\\mathrm{est}}(s))^k = \\sum_{k=0}^{N_0} \\binom{N_0}{k} (-1)^k (p_{\\mathrm{est}}(s))^k p_0^k\n$$\n对 $p_0$ 取期望：\n$$\n\\mathbb{E}_{p_0} \\left[ \\sum_{k=0}^{N_0} \\binom{N_0}{k} (-1)^k (p_{\\mathrm{est}}(s))^k p_0^k \\right] = \\sum_{k=0}^{N_0} \\binom{N_0}{k} (-1)^k (p_{\\mathrm{est}}(s))^k \\mathbb{E}_{p_0}[p_0^k]\n$$\n$\\mathrm{Beta}(a,b)$ 分布的 $k$ 阶矩由 $\\mathbb{E}[p_0^k] = \\frac{\\Gamma(a+k)\\Gamma(a+b)}{\\Gamma(a+b+k)\\Gamma(a)} = \\frac{a^{\\overline{k}}}{(a+b)^{\\overline{k}}}$ 给出，其中 $x^{\\overline{k}}$ 是上升阶乘。该表达式可被识别为高斯超几何函数 ${}_2F_1$ 的定义：\n$$\n\\sum_{k=0}^{N_0} \\frac{(-N_0)^{\\overline{k}} a^{\\overline{k}}}{(a+b)^{\\overline{k}}} \\frac{(p_{\\mathrm{est}}(s))^k}{k!} = {}_2F_1(-N_0, a; a+b; p_{\\mathrm{est}}(s))\n$$\n由于 $-N_0$ 是一个负整数，这是一个终止级数（$p_{\\mathrm{est}}(s)$ 的一个多项式）。\n\n综合这些结果，对于给定的 $s$ 和 $m$，总救援概率为：\n$$\n\\text{Benefit}(s, m) = 1 - (1 - p_{\\mathrm{est}}(s))^m \\cdot {}_2F_1(-N_0, a; a+b; p_{\\mathrm{est}}(s))\n$$\n建立概率 $p_{\\mathrm{est}}(s)$ 定义为：\n$$\np_{\\mathrm{est}}(s) = \\max\\left(0, 1 - \\frac{1}{R_A(s)}\\right) = \\max\\left(0, 1 - \\frac{1}{1-d+s}\\right)\n$$\n仅当 $1-d+s > 1$ 时，即 $s > d$ 时，这个概率才不为零。\n\n最后，我们对选择系数 $s$ 取期望，它在 $[0, s_{\\max}]$ 上服从一个缩放的 Beta 分布。\n$$\nE_{\\text{bio}}(m) = \\mathbb{E}_S[\\text{Benefit}(S, m)] = \\int_0^{s_{\\max}} \\text{Benefit}(s, m) f_S(s) ds\n$$\n其中 $f_S(s) = \\frac{1}{s_{\\max}} \\mathrm{BetaPDF}\\left(\\frac{s}{s_{\\max}}; \\alpha_s, \\beta_s\\right)$。\n\n这个积分没有简单的闭式解，必须进行数值求解。问题要求使用一个至少包含 $n=128$ 个节点的确定性求积法则。我们将使用高精度的 Gauss-Legendre 求积法。我们通过变量替换 $s(x) = \\frac{s_{\\max}}{2}(x+1)$（其中 $x \\in [-1, 1]$），将积分区间 $[0, s_{\\max}]$ 变换到标准求积区间 $[-1, 1]$。积分变为：\n$$\nE_{\\text{bio}}(m) = \\int_{-1}^{1} \\text{Benefit}(s(x), m) f_S(s(x)) \\frac{s_{\\max}}{2} dx \\approx \\frac{s_{\\max}}{2} \\sum_{i=1}^n w_i \\text{Benefit}(s(x_i), m) f_S(s(x_i))\n$$\n其中 $x_i$ 和 $w_i$ 是 $n$ 个点的标准 Gauss-Legendre 节点和权重。\n\n总体算法如下：\n1.  对于每个测试用例，确定所有参数：$N_0, d, s_{\\max}, \\alpha_s, \\beta_s, a, b, B, c_m, \\lambda$。\n2.  确定最大迁移个体数，$m_{\\max} = \\lfloor B/c_m \\rfloor$。\n3.  为一个 $n$ 点的 Gauss-Legendre 求积（$n \\ge 128$）预计算节点 $x_i$ 和权重 $w_i$。\n4.  初始化最优迁移个体数 $m^\\star = 0$ 和初始最大效用 $U_{\\max} = U(0)$。\n5.  从 $1$ 到 $m_{\\max}$ 迭代 $m$。对于每个 $m$：\n    a. 使用求积法则计算效用 $U(m)$ 以评估 $E_{\\text{bio}}(m)$。计算过程涉及在每个求积节点 $s_i$ 上评估 $p_{\\mathrm{est}}(s_i)$，然后计算超几何函数 ${}_2F_1$ 和完整的被积函数。\n    b. 如果 $U(m) > U_{\\max}$，则更新 $U_{\\max} = U(m)$ 和 $m^\\star = m$。严格不等式确保了在效用相同的情况下，按规定选择较小的 $m$ 来打破平局。\n6.  最终的 $m^\\star$ 是该测试用例的解。\n对测试套件中的每个用例都必须重复此过程。如果 $s_{\\max} \\le d$，则会出现一种特殊情况，此时 $p_{\\mathrm{est}}(s)$ 始终为零。在这种情况下，对于所有 $m$，都有 $E_{\\text{bio}}(m)=0$，效用函数简化为 $U(m) = -\\lambda (m/N_0)^2$，该函数在 $m=0$ 时取得最大值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import hyp2f1\nfrom scipy.stats import beta as beta_dist\n\ndef calculate_utility(m, N0, d, s_max, alpha_s, beta_s, a, b, lambda_, quad_nodes, quad_weights):\n    \"\"\"\n    Calculates the utility U(m) for a given number of migrants m.\n    \"\"\"\n    # 1. Penalty Term\n    penalty = lambda_ * (m / N0)**2\n\n    # 2. Biological Benefit Term (calculated via numerical quadrature)\n    \n    # Transform quadrature nodes from [-1, 1] to [0, s_max]\n    s_nodes = 0.5 * s_max * (quad_nodes + 1.0)\n    \n    # Corresponding transformed weights for the integral over [0, s_max]\n    s_weights = 0.5 * s_max * quad_weights\n\n    # Probability density function of s at the nodes\n    # The distribution of s is a scaled Beta distribution on [0, s_max]\n    s_pdf_vals = beta_dist.pdf(s_nodes / s_max, a=alpha_s, b=beta_s, loc=0, scale=1) / s_max\n    \n    # Calculate establishment probability p_est(s) at each node\n    p_est = np.zeros_like(s_nodes)\n    # The condition for non-zero establishment probability is s > d\n    rescue_possible_mask = s_nodes > d\n    \n    if np.any(rescue_possible_mask):\n        p_est[rescue_possible_mask] = 1.0 - 1.0 / (1.0 - d + s_nodes[rescue_possible_mask])\n\n    # Calculate the hypergeometric function term\n    # E[(1-p_est)^K] = 2F1(-N0, a; a+b; p_est)\n    hyp2f1_vals = np.ones_like(s_nodes)\n    if np.any(rescue_possible_mask):\n        # hyp2f1 is vectorized over its last argument\n        hyp2f1_vals[rescue_possible_mask] = hyp2f1(\n            -N0, a, a + b, p_est[rescue_possible_mask]\n        )\n\n    # Calculate the integrand: Benefit(s, m) = 1 - (1-p_est)^m * E[(1-p_est)^K]\n    integrand = 1.0 - (1.0 - p_est)**m * hyp2f1_vals\n\n    # Compute the integral via quadrature: E_bio = integral(Benefit(s,m) * f(s) ds)\n    # This is approximated by sum(weights * integrand_values * pdf_values)\n    bio_benefit = np.sum(s_weights * integrand * s_pdf_vals)\n\n    return bio_benefit - penalty\n\ndef solve_case(params):\n    \"\"\"\n    Solves for the optimal number of migrants m* for a single parameter set.\n    \"\"\"\n    N0, d, s_max, alpha_s, beta_s, a, b, B, c_m, lambda_ = params\n\n    # Maximum possible number of migrants based on budget\n    m_max = int(B // c_m)\n    \n    # Handle the edge case where evolutionary rescue is impossible\n    if s_max <= d:\n        # p_est(s) is always 0. The biological benefit is 0 for all m.\n        # Utility U(m) = -lambda * (m/N0)^2 is maximized at m=0.\n        return 0\n\n    best_m = 0\n    \n    # Set up Gauss-Legendre quadrature with n=256 nodes (more than the required 128)\n    num_nodes = 256\n    quad_nodes, quad_weights = np.polynomial.legendre.leggauss(num_nodes)\n\n    # Calculate utility for m=0 to establish a baseline\n    max_utility = calculate_utility(0, N0, d, s_max, alpha_s, beta_s, a, b, lambda_, quad_nodes, quad_weights)\n\n    # Iterate through all possible m values to find the optimum\n    for m in range(1, m_max + 1):\n        utility = calculate_utility(m, N0, d, s_max, alpha_s, beta_s, a, b, lambda_, quad_nodes, quad_weights)\n        \n        # Update best_m only if utility is strictly greater,\n        # which respects the tie-breaking rule (choose smaller m).\n        if utility > max_utility:\n            max_utility = utility\n            best_m = m\n            \n    return best_m\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final output.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: General feasible case\n        {'N0': 100, 'd': 0.05, 's_max': 0.20, 'alpha_s': 2.0, 'beta_s': 5.0, \n         'a': 1.0, 'b': 99.0, 'B': 20, 'c_m': 1, 'lambda_': 0.01},\n        # Case B: Boundary - zero budget\n        {'N0': 100, 'd': 0.05, 's_max': 0.20, 'alpha_s': 2.0, 'beta_s': 5.0, \n         'a': 1.0, 'b': 99.0, 'B': 0, 'c_m': 1, 'lambda_': 0.01},\n        # Case C: Edge - no possible establishment\n        {'N0': 200, 'd': 0.30, 's_max': 0.20, 'alpha_s': 2.0, 'beta_s': 5.0, \n         'a': 1.0, 'b': 199.0, 'B': 50, 'c_m': 1, 'lambda_': 0.001},\n        # Case D: Trade-off dominated by penalty\n        {'N0': 300, 'd': 0.08, 's_max': 0.25, 'alpha_s': 2.5, 'beta_s': 3.5, \n         'a': 1.5, 'b': 298.5, 'B': 60, 'c_m': 5, 'lambda_': 1.5},\n    ]\n\n    results = []\n    for case_params in test_cases:\n        params_tuple = tuple(case_params.values())\n        result = solve_case(params_tuple)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}