{
    "hands_on_practices": [
        {
            "introduction": "一个成功的“进化与重测序”（E&R）实验，其关键在于精心的实验设计，以确保我们有足够的统计功效（statistical power）来从遗传漂变和取样误差的背景噪音中检测出选择的信号。在投入大量时间与资源之前，进行先验的功效分析是至关重要的。本练习将指导您从第一性原理出发，推导计算所需重复群体数量（$R$）的解析表达式，它综合考虑了选择强度（$s$）、有效群体大小（$N_e$）、实验持续时间（$T$）以及测序深度（$C$）等关键参数。通过这个实践，您将深刻理解这些因素如何共同决定一个 E&R 实验的成败 。",
            "id": "2711888",
            "problem": "一项实验演化研究使用演化与重测序 (Evolve and Resequence, E&R) 设计，其中有 $R$ 个独立的重复群体，每个群体的有效群体大小 $N_{e}$ 恒定，所有群体均源自同一个基础群体。该基础群体中，一个焦点单核苷酸多态性 (SNP) 的初始衍生等位基因频率为 $p_{0}$。在一个二倍体 Wright–Fisher 群体中，每个重复群体在基因选择下演化 $T$ 个离散世代，该选择有利于衍生等位基因，选择系数为 $s$。在第 $0$ 代和第 $T$ 代，对每个重复群体进行混合全群体测序，每个位点的覆盖度为 $C$，并根据测序读数估计每个重复群体在这两个时间点的衍生等位基因频率。假设在不同时间点和不同重复群体之间，测序读数抽样是独立的，并遵循二项分布模型。\n\n您将设计一个单侧检验，用于检验原假设 $H_{0}: \\Delta = 0$ 与备择假设 $H_{1}: \\Delta > 0$，其中 $\\Delta$ 表示第 $T$ 代与第 $0$ 代之间的衍生等位基因频率变化。使用显著性水平为 $\\alpha$ 的 Wald $Z$ 检验。您的推导应基于以下经过充分检验的基础：\n\n-   对于无选择的 Wright–Fisher 漂变，其扩散近似给出了 $T$ 代后等位基因频率的方差为 $\\operatorname{Var}(p_{T}\\mid p_{0}) \\approx p_{0}(1-p_{0})\\left(1-\\exp\\!\\left(-\\frac{T}{2 N_{e}}\\right)\\right)$，您可以用此公式来近似遗传漂变对变化量 $\\Delta$ 的重复间方差贡献。\n-   在弱选择下，连续时间中基因选择的预期确定性轨迹满足 $\\frac{d p}{d t} = s\\,p(1-p)$，其解意味着 $T$ 代后的预期等位基因频率为 $p_{T} \\approx \\frac{1}{1 + \\left(\\frac{1-p_{0}}{p_{0}}\\right)\\exp(-s T)}$。\n-   覆盖度为 $C$ 的混合测序 (Pool-sequencing) 在每个时间点都能得到等位基因频率的无偏估计，其二项抽样方差为 $p(1-p)/C$，且在不同时间点和重复群体间是独立的。\n\n假设漂变和测序的贡献是独立的，所有重复群体也是独立的，并用正态分布来近似重复群体平均变化的抽样分布。请从第一性原理出发，推导出一个解析表达式，用于计算在备择假设 $H_{1}$ 下达到统计功效 $1-\\beta$ 所需的最小重复数 $R$。该表达式应以 $s$、$p_{0}$、$T$、$N_{e}$、$C$、$\\alpha$ 和 $\\beta$ 表示。然后，使用参数 $s = 0.02$、$p_{0} = 0.10$、$T = 30$、$N_{e} = 1000$、$C = 100$、$\\alpha = 0.05$ 和目标功效 $1-\\beta = 0.80$，计算满足此要求的最小整数 $R$。请将最终的 $R$ 以一个无单位的整数形式给出。如果需要中间数值近似，请至少保留 $4$ 位有效数字；最终的 $R$ 必须是满足标准的最小整数，不需要四舍五入。",
            "solution": "该问题要求推导上演化与重测序实验为达到期望的统计功效所需的最小重复数 $R$。该问题具有科学依据，提法明确，客观，并包含足够的信息以获得唯一解，因此是有效的。\n\n我们首先建立统计框架。假设检验关注的是衍生等位基因频率的平均变化量，即 $\\Delta = p_T - p_0$。原假设为 $H_0: \\Delta = 0$，单侧备择假设为 $H_1: \\Delta > 0$。我们使用基于 $R$ 个重复群体的平均估计频率变化（记为 $\\bar{\\hat{\\Delta}}$）的 Wald Z检验。\n\n令 $\\hat{p}_{i,0}$ 和 $\\hat{p}_{i,T}$ 分别为重复群体 $i$ 在第 $0$ 代和第 $T$ 代的估计等位基因频率。重复群体 $i$ 的估计变化量为 $\\hat{\\Delta}_i = \\hat{p}_{i,T} - \\hat{p}_{i,0}$。检验统计量基于所有 $R$ 个重复群体的这些估计值的平均值：\n$$ \\bar{\\hat{\\Delta}} = \\frac{1}{R} \\sum_{i=1}^{R} \\hat{\\Delta}_i $$\n根据中心极限定理，对于足够大的 $R$，$\\bar{\\hat{\\Delta}}$ 的抽样分布近似为正态分布。\n\nWald Z统计量由下式给出：\n$$ Z = \\frac{\\bar{\\hat{\\Delta}} - E[\\bar{\\hat{\\Delta}} | H_0]}{\\sqrt{\\operatorname{Var}(\\bar{\\hat{\\Delta}} | H_0)}} $$\n在原假设 $H_0$ 下，没有选择 ($s=0$)，因此预期的等位基因频率不会改变。于是，$E[p_T|H_0] = p_0$，预期的变化量为 $E[\\bar{\\hat{\\Delta}} | H_0] = 0$。\n\n为了构建检验并进行功效分析，我们必须确定在原假设 ($H_0$) 和备择假设 ($H_1$) 下 $\\bar{\\hat{\\Delta}}$ 的方差。平均估计值的方差为 $\\operatorname{Var}(\\bar{\\hat{\\Delta}}) = \\frac{1}{R} \\operatorname{Var}(\\hat{\\Delta}_i)$。我们必须首先求出单个重复群体的方差，$\\sigma_{\\hat{\\Delta}}^2 = \\operatorname{Var}(\\hat{\\Delta}_i)$。\n\n估计变化量 $\\hat{\\Delta}_i$ 的总方差来自两个独立的过程：$T$ 代内的遗传漂变和两个时间点的测序读数二项抽样。由于第 $0$ 代和第 $T$ 代的测序估计是独立的，我们有：\n$$ \\operatorname{Var}(\\hat{\\Delta}_i) = \\operatorname{Var}(\\hat{p}_{i,T} - \\hat{p}_{i,0}) = \\operatorname{Var}(\\hat{p}_{i,T}) + \\operatorname{Var}(\\hat{p}_{i,0}) $$\n初始频率 $p_0$ 是固定的，因此其估计量的方差完全来自测序：\n$$ \\operatorname{Var}(\\hat{p}_{i,0}) = \\frac{p_0(1-p_0)}{C} $$\n由于漂变，重复群体 $i$ 在第 $T$ 代的频率 $p_{i,T}$ 是一个随机变量。我们使用全方差定律来求 $\\operatorname{Var}(\\hat{p}_{i,T})$：\n$$ \\operatorname{Var}(\\hat{p}_{i,T}) = E[\\operatorname{Var}(\\hat{p}_{i,T} | p_{i,T})] + \\operatorname{Var}(E[\\hat{p}_{i,T} | p_{i,T}]) $$\n给定真实频率 $p_{i,T}$，测序估计量是无偏的，$E[\\hat{p}_{i,T} | p_{i,T}] = p_{i,T}$，其方差为 $\\operatorname{Var}(\\hat{p}_{i,T} | p_{i,T}) = \\frac{p_{i,T}(1-p_{i,T})}{C}$。\n$\\operatorname{Var}(\\hat{p}_{i,T})$ 的表达式变为：\n$$ \\operatorname{Var}(\\hat{p}_{i,T}) = E\\left[\\frac{p_{i,T}(1-p_{i,T})}{C}\\right] + \\operatorname{Var}(p_{i,T}) $$\n我们使用 $p_{i,T}$ 的期望值来近似第一项。令 $p_T^{\\text{exp}} = E[p_{i,T}]$。则 $E\\left[\\frac{p_{i,T}(1-p_{i,T})}{C}\\right] \\approx \\frac{p_T^{\\text{exp}}(1-p_T^{\\text{exp}})}{C}$。第二项 $\\operatorname{Var}(p_{i,T})$ 是由遗传漂变引起的方差，问题中给出为 $\\operatorname{Var}(p_T | p_0) \\approx p_0(1-p_0)\\left(1-\\exp\\left(-\\frac{T}{2N_e}\\right)\\right)$。\n\n因此，每个重复的总方差为：\n$$ \\sigma_{\\hat{\\Delta}}^2 = \\operatorname{Var}(\\hat{\\Delta}_i) \\approx p_0(1-p_0)\\left(1-\\exp\\left(-\\frac{T}{2N_e}\\right)\\right) + \\frac{p_T^{\\text{exp}}(1-p_T^{\\text{exp}})}{C} + \\frac{p_0(1-p_0)}{C} $$\n在 $H_0$ 下，$s=0$，所以 $p_T^{\\text{exp}} = p_0$。原假设下的方差 $\\sigma_0^2$ 简化为：\n$$ \\sigma_0^2 = p_0(1-p_0)\\left(1-\\exp\\left(-\\frac{T}{2N_e}\\right)\\right) + \\frac{2p_0(1-p_0)}{C} = p_0(1-p_0)\\left[1-\\exp\\left(-\\frac{T}{2N_e}\\right) + \\frac{2}{C}\\right] $$\n在 $H_1$ 下，选择系数 $s > 0$，预期频率为 $p_T^{\\text{exp}} \\approx \\frac{1}{1 + \\left(\\frac{1-p_0}{p_0}\\right)\\exp(-sT)}$。备择假设下的方差 $\\sigma_1^2$ 为：\n$$ \\sigma_1^2 = p_0(1-p_0)\\left(1-\\exp\\left(-\\frac{T}{2N_e}\\right)\\right) + \\frac{p_T^{\\text{exp}}(1-p_T^{\\text{exp}})}{C} + \\frac{p_0(1-p_0)}{C} $$\n备择假设下的预期变化量为 $\\mu_{\\Delta} = E[\\bar{\\hat{\\Delta}}|H_1] = p_T^{\\text{exp}} - p_0$。\n\n对于显著性水平为 $\\alpha$ 的单侧检验，如果 $Z > z_{\\alpha}$，我们拒绝 $H_0$，其中 $z_{\\alpha}$ 是标准正态分布的上$\\alpha$分位数。这等价于如果 $\\bar{\\hat{\\Delta}} > z_{\\alpha}\\sqrt{\\sigma_0^2/R}$ 就拒绝 $H_0$。\n\n统计功效 $1-\\beta$ 是在 $H_1$ 为真的条件下拒绝 $H_0$ 的概率：\n$$ 1-\\beta = P\\left(\\bar{\\hat{\\Delta}} > z_{\\alpha}\\sqrt{\\frac{\\sigma_0^2}{R}} \\;\\middle|\\; H_1\\right) $$\n在 $H_1$ 下，$\\bar{\\hat{\\Delta}} \\sim N(\\mu_{\\Delta}, \\sigma_1^2/R)$。我们对不等式进行标准化：\n$$ 1-\\beta = P\\left( \\frac{\\bar{\\hat{\\Delta}} - \\mu_{\\Delta}}{\\sqrt{\\sigma_1^2/R}} > \\frac{z_{\\alpha}\\sqrt{\\sigma_0^2/R} - \\mu_{\\Delta}}{\\sqrt{\\sigma_1^2/R}} \\right) $$\n左侧是一个标准正态变量。为了使概率为 $1-\\beta$，右侧的阈值必须是 $-z_{\\beta}$，其中 $z_{\\beta}$ 是上$\\beta$分位数。\n$$ -z_{\\beta} = \\frac{z_{\\alpha}\\sqrt{\\sigma_0^2} - \\mu_{\\Delta}\\sqrt{R}}{\\sqrt{\\sigma_1^2}} $$\n求解 $\\sqrt{R}$：\n$$ \\mu_{\\Delta}\\sqrt{R} = z_{\\alpha}\\sqrt{\\sigma_0^2} + z_{\\beta}\\sqrt{\\sigma_1^2} $$\n$$ \\sqrt{R} = \\frac{z_{\\alpha}\\sqrt{\\sigma_0^2} + z_{\\beta}\\sqrt{\\sigma_1^2}}{\\mu_{\\Delta}} $$\n这就得出了所需重复数的解析表达式：\n$$ R = \\left( \\frac{z_{\\alpha}\\sqrt{\\sigma_0^2} + z_{\\beta}\\sqrt{\\sigma_1^2}}{\\mu_{\\Delta}} \\right)^2 $$\n\n现在，我们使用给定的参数计算 $R$ 的数值：\n$s=0.02$，$p_0=0.10$，$T=30$，$N_e=1000$，$C=100$，$\\alpha=0.05$，$1-\\beta=0.80$。\n对应的分位数为 $z_{\\alpha} = z_{0.05} \\approx 1.6449$ 和 $z_{\\beta} = z_{0.20} \\approx 0.8416$。\n\n1.  计算 $H_1$ 下的预期频率和变化量：\n    $p_T^{\\text{exp}} = \\frac{1}{1 + \\left(\\frac{1-0.10}{0.10}\\right)\\exp(-0.02 \\times 30)} = \\frac{1}{1 + 9\\exp(-0.6)} \\approx \\frac{1}{1 + 9(0.54881)} \\approx 0.16837$。\n    $\\mu_{\\Delta} = p_T^{\\text{exp}} - p_0 \\approx 0.16837 - 0.10 = 0.06837$。\n\n2.  计算 $H_0$ 下的方差：\n    $\\frac{T}{2N_e} = \\frac{30}{2000} = 0.015$。\n    $\\sigma_0^2 = 0.1(0.9)\\left[1-\\exp(-0.015) + \\frac{2}{100}\\right] \\approx 0.09[1 - 0.98511 + 0.02] = 0.09[0.01489 + 0.02] = 0.09(0.03489) \\approx 0.0031401$。\n    $\\sqrt{\\sigma_0^2} \\approx 0.056037$。\n\n3.  计算 $H_1$ 下的方差：\n    漂变分量：$0.1(0.9)(1-\\exp(-0.015)) \\approx 0.0013401$。\n    $0$ 时刻的测序分量：$\\frac{0.1(0.9)}{100} = 0.0009$。\n    $T$ 时刻的测序分量：$\\frac{p_T^{\\text{exp}}(1-p_T^{\\text{exp}})}{C} \\approx \\frac{0.16837(1-0.16837)}{100} \\approx \\frac{0.14002}{100} = 0.0014002$。\n    $\\sigma_1^2 \\approx 0.0013401 + 0.0014002 + 0.0009 = 0.0036403$。\n    $\\sqrt{\\sigma_1^2} \\approx 0.060335$。\n\n4.  计算 $R$：\n    $R = \\left( \\frac{1.6449 \\times 0.056037 + 0.8416 \\times 0.060335}{0.06837} \\right)^2$\n    $R \\approx \\left( \\frac{0.092174 + 0.050786}{0.06837} \\right)^2 = \\left( \\frac{0.14296}{0.06837} \\right)^2 \\approx (2.0910)^2 \\approx 4.372$。\n\n由于重复数必须是整数，我们对该值取上取整以确保达到功效要求。\n$R = \\lceil 4.372 \\rceil = 5$。\n所需的最小整数重复数为 $5$。",
            "answer": "$$\n\\boxed{5}\n$$"
        },
        {
            "introduction": "在确定了实验所需的重复群体数量后，我们还必须决定对每个群体进行多深的测序。“混合样品测序”（Pool-Seq）是 E&R 研究中常用的方法，但其估计的等位基因频率方差有两个来源：一是在构建 DNA 池时对个体进行的生物学抽样，二是从池中对 DNA 片段进行的测序抽样。明智地分配测序资源，意味着需要理解增加测序深度（$C$）的回报在何处会递减。本练习将引导您剖析这两个方差来源，并定量地计算出一个最小测序深度，以确保由技术测序引入的“噪音”在总方差中只占一个较小的比例，从而帮助您在实验成本和数据质量之间做出权衡 。",
            "id": "2711938",
            "problem": "在一项使用混合测序（Pool-Seq）的演化与重测序实验中，一个由 $n$ 个二倍体个体组成的群体向一个样本池贡献了 $2n$ 条染色体。在一个真实等位基因频率为 $p$ 的目标基因座上，通过从群体中独立抽取 $2n$ 条染色体来构建该样本池。随后，测序生成了覆盖该基因座的 $C$ 个独立读段，每个读段从样本池中无偏倚、无重复地抽取一个等位基因。令 $\\hat{p}$ 表示基于携带目标等位基因的读段比例得到的等位基因频率估计量。假设两个阶段（样本池构建和测序）都可以很好地用二项抽样模型来建模，所有读段都是独立同分布的，并且没有额外的过度离散。\n\n仅使用以下基本原理：\n- 二项抽样模型及其方差 $p(1-p)$（按试验次数进行缩放）。\n- 全方差公式，$\\mathrm{Var}(Z) = \\mathbb{E}[\\mathrm{Var}(Z \\mid Y)] + \\mathrm{Var}(\\mathbb{E}[Z \\mid Y])$。\n\n将测序噪声对 $\\hat{p}$ 方差的贡献定义为对样本池随机性取平均后的读段条件抽样方差，并将 $\\hat{p}$ 的总方差定义为由有限样本池构建引起的方差与平均测序方差之和。对于 $p = 0.3$ 和 $n = 500$，计算最小测序覆盖度 $C$，使得由测序噪声导致的总方差比例严格小于 $0.2$。报告满足此约束条件的最小整数值 $C$。",
            "solution": "该问题要求我们在特定条件下确定最小测序覆盖度 $C$。我们必须首先验证问题陈述的有效性。\n\n**问题验证**\n\n步骤1：提取已知条件\n- 群体大小：$n$ 个二倍体个体，相当于 $2n$ 条染色体。\n- 目标基因座上的真实等位基因频率：$p$。\n- 样本池构建：独立抽取的 $2n$ 条染色体样本。\n- 测序：从样本池中抽取的 $C$ 个独立读段。\n- 等位基因频率的估计量：$\\hat{p}$，携带目标等位基因的读段比例。\n- 抽样模型：样本池构建和测序均采用二项抽样。\n- 原理1：二项方差是 $p(1-p)$ 按试验次数进行缩放。\n- 原理2：全方差公式，$\\mathrm{Var}(Z) = \\mathbb{E}[\\mathrm{Var}(Z \\mid Y)] + \\mathrm{Var}(\\mathbb{E}[Z \\mid Y])$。\n- 测序噪声方差的定义：对样本池随机性取平均后的读段条件抽样方差。\n- 总方差的定义：样本池构建方差与平均测序方差之和。\n- 数值：$p = 0.3$, $n = 500$。\n- 约束条件：由测序噪声导致的总方差比例必须严格小于 $0.2$。\n- 目标：找到满足该约束条件的最小整数 $C$。\n\n步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，描述了群体遗传学中一个标准且易于理解的 Pool-Seq 实验模型。使用二项抽样和全方差公式是处理此两阶段抽样过程的正确理论框架。问题提法得当，提供了得出唯一数学解所需的所有定义、变量和约束条件。该问题的语言客观精确，其前提条件没有矛盾、不完整或与事实不符之处。该问题需要对指定原理进行非平凡的应用，因此可以作为对理解能力的有效检验。\n\n步骤3：结论\n问题有效。我们开始求解。\n\n**解题过程**\n\n设 $p$ 为初始群体中的真实等位基因频率。通过抽取 $2n$ 条染色体创建一个DNA样本池。设 $p_{pool}$ 为代表该样本池中等位基因频率的随机变量。携带目标等位基因的染色体数量 $K_{pool}$ 服从二项分布，$K_{pool} \\sim \\mathrm{Binomial}(2n, p)$。样本池中的频率为 $p_{pool} = \\frac{K_{pool}}{2n}$。\n\n从这个样本池中，测序了 $C$ 个读段。设 $\\hat{p}$ 是基于这些读段的等位基因频率估计量。给定样本池中的等位基因频率 $p_{pool}$，携带目标等位基因的读段数量 $K_{reads}$ 服从二项分布，$K_{reads} \\sim \\mathrm{Binomial}(C, p_{pool})$。该估计量为 $\\hat{p} = \\frac{K_{reads}}{C}$。\n\n我们使用全方差公式来求解估计量 $\\hat{p}$ 的总方差：\n$$\n\\mathrm{Var}(\\hat{p}) = \\mathbb{E}[\\mathrm{Var}(\\hat{p} \\mid p_{pool})] + \\mathrm{Var}(\\mathbb{E}[\\hat{p} \\mid p_{pool}])\n$$\n问题将此方差定义为两个组成部分：\n1.  由有限样本池构建引起的方差，我们将证明它对应于 $\\mathrm{Var}(\\mathbb{E}[\\hat{p} \\mid p_{pool}])$，我们称之为 $V_{pool}$。\n2.  测序噪声的贡献，定义为 $\\mathbb{E}[\\mathrm{Var}(\\hat{p} \\mid p_{pool})]$，我们称之为 $V_{seq}$。\n\n首先，我们分析样本池构建方差项 $V_{pool}$。我们计算其内部期望：\n$$\n\\mathbb{E}[\\hat{p} \\mid p_{pool}] = \\mathbb{E}\\left[\\frac{K_{reads}}{C} \\mid p_{pool}\\right] = \\frac{1}{C}\\mathbb{E}[K_{reads} \\mid p_{pool}]\n$$\n由于 $K_{reads} \\sim \\mathrm{Binomial}(C, p_{pool})$，其期望为 $C p_{pool}$。\n$$\n\\mathbb{E}[\\hat{p} \\mid p_{pool}] = \\frac{1}{C}(C p_{pool}) = p_{pool}\n$$\n因此，该项的方差就是样本池频率本身的方差：\n$$\nV_{pool} = \\mathrm{Var}(\\mathbb{E}[\\hat{p} \\mid p_{pool}]) = \\mathrm{Var}(p_{pool}) = \\mathrm{Var}\\left(\\frac{K_{pool}}{2n}\\right) = \\frac{1}{(2n)^2} \\mathrm{Var}(K_{pool})\n$$\n由于 $K_{pool} \\sim \\mathrm{Binomial}(2n, p)$，其方差为 $2np(1-p)$。\n$$\nV_{pool} = \\frac{2np(1-p)}{(2n)^2} = \\frac{p(1-p)}{2n}\n$$\n\n接下来，我们分析测序噪声项 $V_{seq}$。我们计算其内部条件方差：\n$$\n\\mathrm{Var}(\\hat{p} \\mid p_{pool}) = \\mathrm{Var}\\left(\\frac{K_{reads}}{C} \\mid p_{pool}\\right) = \\frac{1}{C^2}\\mathrm{Var}(K_{reads} \\mid p_{pool})\n$$\n由于 $K_{reads} \\sim \\mathrm{Binomial}(C, p_{pool})$，其条件方差为 $C p_{pool}(1-p_{pool})$。\n$$\n\\mathrm{Var}(\\hat{p} \\mid p_{pool}) = \\frac{C p_{pool}(1-p_{pool})}{C^2} = \\frac{p_{pool}(1-p_{pool})}{C}\n$$\n现在，我们对该条件方差关于 $p_{pool}$ 的分布求期望：\n$$\nV_{seq} = \\mathbb{E}[\\mathrm{Var}(\\hat{p} \\mid p_{pool})] = \\mathbb{E}\\left[\\frac{p_{pool}(1-p_{pool})}{C}\\right] = \\frac{1}{C}\\mathbb{E}[p_{pool}(1-p_{pool})]\n$$\n为了计算 $\\mathbb{E}[p_{pool}(1-p_{pool})]$，我们首先求出 $p_{pool}$ 的矩。\n$p_{pool}$ 的期望是 $\\mathbb{E}[p_{pool}] = \\mathbb{E}[\\frac{K_{pool}}{2n}] = \\frac{2np}{2n} = p$。\n二阶矩 $\\mathbb{E}[p_{pool}^2]$ 可以通过其方差计算得出：$\\mathbb{E}[p_{pool}^2] = \\mathrm{Var}(p_{pool}) + (\\mathbb{E}[p_{pool}])^2 = \\frac{p(1-p)}{2n} + p^2$。\n所以，\n$$\n\\mathbb{E}[p_{pool}(1-p_{pool})] = \\mathbb{E}[p_{pool}] - \\mathbb{E}[p_{pool}^2] = p - \\left(\\frac{p(1-p)}{2n} + p^2\\right) = p - p^2 - \\frac{p(1-p)}{2n} = p(1-p)\\left(1 - \\frac{1}{2n}\\right)\n$$\n将此结果代入 $V_{seq}$ 的表达式中：\n$$\nV_{seq} = \\frac{p(1-p)}{C}\\left(1 - \\frac{1}{2n}\\right)\n$$\n总方差为 $V_{total} = V_{seq} + V_{pool}$。问题要求由测序噪声导致的总方差比例严格小于 $0.2$：\n$$\n\\frac{V_{seq}}{V_{total}} = \\frac{V_{seq}}{V_{seq} + V_{pool}} < 0.2\n$$\n代入 $V_{seq}$ 和 $V_{pool}$ 的表达式：\n$$\n\\frac{\\frac{p(1-p)}{C}\\left(1 - \\frac{1}{2n}\\right)}{\\frac{p(1-p)}{C}\\left(1 - \\frac{1}{2n}\\right) + \\frac{p(1-p)}{2n}} < 0.2\n$$\n$p(1-p)$ 项是一个公共因子，并且当 $p=0.3$ 时不为零。我们可以将其消去：\n$$\n\\frac{\\frac{1}{C}\\left(1 - \\frac{1}{2n}\\right)}{\\frac{1}{C}\\left(1 - \\frac{1}{2n}\\right) + \\frac{1}{2n}} < 0.2\n$$\n设分子为 $X = \\frac{1}{C}(1 - \\frac{1}{2n})$。不等式为 $\\frac{X}{X + \\frac{1}{2n}} < 0.2$。由于 $n$ 和 $C$ 均为正数，所有项也都是正数。我们可以整理该不等式：\n$$\nX < 0.2 \\left(X + \\frac{1}{2n}\\right)\n$$\n$$\n0.8 X < \\frac{0.2}{2n}\n$$\n$$\n4X < \\frac{1}{2n}\n$$\n现在将 $X$ 代回：\n$$\n4 \\frac{1}{C}\\left(1 - \\frac{1}{2n}\\right) < \\frac{1}{2n}\n$$\n$$\n\\frac{4}{C}\\left(\\frac{2n-1}{2n}\\right) < \\frac{1}{2n}\n$$\n由于 $C > 0$ 且 $n > 0$，我们可以在不等式两边同乘以 $2nC$ 而不改变不等号方向：\n$$\n4(2n - 1) < C\n$$\n给定 $n = 500$：\n$$\nC > 4(2 \\cdot 500 - 1)\n$$\n$$\nC > 4(1000 - 1)\n$$\n$$\nC > 4(999)\n$$\n$$\nC > 3996\n$$\n问题要求满足此严格不等式的最小整数值 $C$。大于 $3996$ 的最小整数是 $3997$。",
            "answer": "$$\n\\boxed{3997}\n$$"
        },
        {
            "introduction": "拥有设计良好的实验和高质量的数据后，E&R 方法的真正威力在于能够检验关于适应过程的复杂演化假说。例如，适应是由一个单一的、新的有益突变（硬扫描，hard sweep）驱动，还是由多个已存或新生的有益突变相互竞争（软扫描，soft sweep）所致？时间序列的等位基因频率数据为我们区分这些情景提供了可能。本练习将引导您运用基于模型选择的统计推断方法，使用贝叶斯信息准则（Bayesian Information Criterion, BIC）来形式化地比较和选择最能解释观测数据的演化模型。通过这个实践，您将学会如何利用时间序列数据，从简单的信号检测转向更深刻的演化机制推断 。",
            "id": "2711890",
            "problem": "在一个针对无性繁殖种群的演化与重测序（E&R）实验中，位于不同位置的两个单核苷酸变异（SNV），记为谱系标记 $A$ 和 $B$，标记了两个可能在不同单倍型上出现的相互竞争的有利谱系。在采样时间 $t_{i}$（其中 $i \\in \\{1,\\dots,T\\}$），短读长测序针对每个谱系标记 $\\ell \\in \\{A,B\\}$，在该基因座和时间点，从总共 $n_{i\\ell}$ 条读数中，得到支持该谱系特异性等位基因的读数计数为 $x_{i\\ell}$。假设在给定时间 $t_{i}$ 时谱系特异性等位基因的真实种群频率 $p_{i\\ell}$ 的条件下，读数计数 $x_{i\\ell}$ 满足 $x_{i\\ell} \\sim \\mathrm{Binomial}(n_{i\\ell},p_{i\\ell})$，并且在给定 $(p_{i\\ell})$ 的情况下，这些计数在 $(i,\\ell)$ 之间是独立的。\n\n对于一个大种群在恒定选择压力下适应性扫描的早期至中期阶段，假设每个谱系的等位基因频率遵循确定性的逻辑斯蒂轨迹，因此对数优势比随时间近似线性演化：$\\mathrm{logit}(p_{i\\ell}) = \\alpha_{\\ell} + s_{\\ell} t_{i}$，其中 $\\alpha_{\\ell} \\in \\mathbb{R}$ 是谱系特异性截距，而 $s_{\\ell} \\in \\mathbb{R}$ 是对数优势比尺度上的有效选择系数。\n\n考虑以下嵌套模型：\n- 模型 $\\mathcal{M}_{1}$ (单一扫描): 谱系 $A$ 是有利的，具有自由参数 $(\\alpha_{A}, s_{A})$；谱系 $B$ 在对数优势比尺度上非递增，即 $s_{B} = 0$，并具有自由截距 $\\alpha_{B}$。因此，$\\mathcal{M}_{1}$ 有 $k_{1} = 3$ 个自由参数。\n- 模型 $\\mathcal{M}_{2}$ (多重扫描): 两个谱系都可能是受益的，具有自由参数 $(\\alpha_{A}, s_{A}, \\alpha_{B}, s_{B})$。因此，$\\mathcal{M}_{2}$ 有 $k_{2} = 4$ 个自由参数。\n\n使用所述的二项抽样模型和对数优势比线性频率模型，提出一种有原则的方法，通过在 $\\mathcal{M}_{1}$ 和 $\\mathcal{M}_{2}$ 之间进行选择，来检测是否存在两个相互竞争的有利谱系。使用贝叶斯信息准则（BIC）将其形式化为一个明确的模型选择准则，其中独立观测值的数量为 $I = 2T$（在 $T$ 个时间点上，每个谱系各有一个二项观测值）。令 $\\widehat{p}_{i\\ell}^{(m)}$ 表示通过最大似然法获得的，在模型 $\\mathcal{M}_{m}$ 下，谱系 $\\ell$ 在时间 $t_{i}$ 的拟合概率。推导 BIC 差值 $\\Delta \\mathrm{BIC} \\equiv \\mathrm{BIC}(\\mathcal{M}_{2}) - \\mathrm{BIC}(\\mathcal{M}_{1})$ 的闭式解析表达式，该表达式用 $(x_{i\\ell}, n_{i\\ell})$、$(\\widehat{p}_{i\\ell}^{(1)}, \\widehat{p}_{i\\ell}^{(2)})$、$T$ 和标准函数表示，用于判断数据是否支持多重扫描情景而非单一扫描情景。您的最终答案必须是单个闭式表达式。不要报告任何中间值。不需要进行数值近似或四舍五入。使用自然对数表示对数。",
            "solution": "所述问题在科学上是合理的、定义明确且客观的。它提出了一个统计基因组学中的标准模型选择任务。我将开始推导。\n\n一个模型 $\\mathcal{M}$ 的贝叶斯信息准则（BIC）由以下公式给出：\n$$ \\mathrm{BIC}(\\mathcal{M}) = k \\ln(N) - 2 \\hat{\\mathcal{L}} $$\n其中 $k$ 是模型中自由参数的数量，$N$ 是独立观测值的总数，$\\hat{\\mathcal{L}}$ 是模型对数似然函数的最大化值。\n\n问题定义了两个嵌套模型 $\\mathcal{M}_{1}$ 和 $\\mathcal{M}_{2}$。\n对于模型 $\\mathcal{M}_{1}$（单一扫描），自由参数的数量为 $k_{1} = 3$，对应于 $(\\alpha_{A}, s_{A}, \\alpha_{B})$，并有约束条件 $s_{B} = 0$。\n对于模型 $\\mathcal{M}_{2}$（多重扫描），自由参数的数量为 $k_{2} = 4$，对应于 $(\\alpha_{A}, s_{A}, \\alpha_{B}, s_{B})$。\n独立观测值的总数给定为 $N = I = 2T$，因为在 $T$ 个时间点上，2 个谱系中的每一个都有一个二项观测值。\n\n使用这些定义，每个模型的 BIC 为：\n$$ \\mathrm{BIC}(\\mathcal{M}_{1}) = k_{1} \\ln(I) - 2 \\hat{\\mathcal{L}}_{1} = 3 \\ln(2T) - 2 \\hat{\\mathcal{L}}_{1} $$\n$$ \\mathrm{BIC}(\\mathcal{M}_{2}) = k_{2} \\ln(I) - 2 \\hat{\\mathcal{L}}_{2} = 4 \\ln(2T) - 2 \\hat{\\mathcal{L}}_{2} $$\n其中 $\\hat{\\mathcal{L}}_{m}$ 是模型 $\\mathcal{M}_{m}$ 下的最大化对数似然。\n\n问题要求计算差值 $\\Delta \\mathrm{BIC} \\equiv \\mathrm{BIC}(\\mathcal{M}_{2}) - \\mathrm{BIC}(\\mathcal{M}_{1})$。我们计算如下：\n$$ \\Delta \\mathrm{BIC} = (4 \\ln(2T) - 2 \\hat{\\mathcal{L}}_{2}) - (3 \\ln(2T) - 2 \\hat{\\mathcal{L}}_{1}) $$\n$$ \\Delta \\mathrm{BIC} = (4 - 3) \\ln(2T) - 2 (\\hat{\\mathcal{L}}_{2} - \\hat{\\mathcal{L}}_{1}) $$\n$$ \\Delta \\mathrm{BIC} = \\ln(2T) - 2 (\\hat{\\mathcal{L}}_{2} - \\hat{\\mathcal{L}}_{1}) $$\n\n为了完成这个表达式，我们必须求出最大化对数似然之间的差值。数据由在时间 $t_{i}$（其中 $i \\in \\{1, \\dots, T\\}$）下，谱系 $\\ell \\in \\{A, B\\}$ 的总共 $n_{i\\ell}$ 条读数中得到的读数计数 $x_{i\\ell}$ 组成。抽样模型给定为 $x_{i\\ell} \\sim \\mathrm{Binomial}(n_{i\\ell}, p_{i\\ell})$。单个观测值的概率质量函数为：\n$$ P(X_{i\\ell} = x_{i\\ell} | n_{i\\ell}, p_{i\\ell}) = \\binom{n_{i\\ell}}{x_{i\\ell}} p_{i\\ell}^{x_{i\\ell}} (1 - p_{i\\ell})^{n_{i\\ell} - x_{i\\ell}} $$\n这个单个观测值的对数似然为：\n$$ \\ln P(X_{i\\ell} = x_{i\\ell}) = \\ln\\binom{n_{i\\ell}}{x_{i\\ell}} + x_{i\\ell} \\ln(p_{i\\ell}) + (n_{i\\ell} - x_{i\\ell}) \\ln(1 - p_{i\\ell}) $$\n由于观测值在所有 $i$ 和 $\\ell$ 之间是独立的，总对数似然是所有 $2T$ 个观测值的总和：\n$$ \\mathcal{L} = \\sum_{i=1}^{T} \\sum_{\\ell \\in \\{A, B\\}} \\left[ \\ln\\binom{n_{i\\ell}}{x_{i\\ell}} + x_{i\\ell} \\ln(p_{i\\ell}) + (n_{i\\ell} - x_{i\\ell}) \\ln(1 - p_{i\\ell}) \\right] $$\n模型 $\\mathcal{M}_{m}$ 的最大化对数似然，记为 $\\hat{\\mathcal{L}}_{m}$，是通过代入由最大似然估计得到的拟合概率 $\\widehat{p}_{i\\ell}^{(m)}$ 来找到的：\n$$ \\hat{\\mathcal{L}}_{m} = \\sum_{i=1}^{T} \\sum_{\\ell \\in \\{A, B\\}} \\left[ \\ln\\binom{n_{i\\ell}}{x_{i\\ell}} + x_{i\\ell} \\ln(\\widehat{p}_{i\\ell}^{(m)}) + (n_{i\\ell} - x_{i\\ell}) \\ln(1 - \\widehat{p}_{i\\ell}^{(m)}) \\right] $$\n现在我们计算差值 $\\hat{\\mathcal{L}}_{2} - \\hat{\\mathcal{L}}_{1}$。项 $\\ln\\binom{n_{i\\ell}}{x_{i\\ell}}$ 相对于模型参数是一个常数，因此在差值计算中被抵消。\n$$ \\hat{\\mathcal{L}}_{2} - \\hat{\\mathcal{L}}_{1} = \\sum_{i=1}^{T} \\sum_{\\ell \\in \\{A, B\\}} \\left[ \\left( x_{i\\ell} \\ln(\\widehat{p}_{i\\ell}^{(2)}) + (n_{i\\ell} - x_{i\\ell}) \\ln(1 - \\widehat{p}_{i\\ell}^{(2)}) \\right) - \\left( x_{i\\ell} \\ln(\\widehat{p}_{i\\ell}^{(1)}) + (n_{i\\ell} - x_{i\\ell}) \\ln(1 - \\widehat{p}_{i\\ell}^{(1)}) \\right) \\right] $$\n按 $x_{i\\ell}$ 和 $(n_{i\\ell} - x_{i\\ell})$ 分组：\n$$ \\hat{\\mathcal{L}}_{2} - \\hat{\\mathcal{L}}_{1} = \\sum_{i=1}^{T} \\sum_{\\ell \\in \\{A, B\\}} \\left[ x_{i\\ell} \\left(\\ln(\\widehat{p}_{i\\ell}^{(2)}) - \\ln(\\widehat{p}_{i\\ell}^{(1)})\\right) + (n_{i\\ell} - x_{i\\ell}) \\left(\\ln(1 - \\widehat{p}_{i\\ell}^{(2)}) - \\ln(1 - \\widehat{p}_{i\\ell}^{(1)})\\right) \\right] $$\n使用对数恒等式 $\\ln(a) - \\ln(b) = \\ln(a/b)$，我们得到：\n$$ \\hat{\\mathcal{L}}_{2} - \\hat{\\mathcal{L}}_{1} = \\sum_{i=1}^{T} \\sum_{\\ell \\in \\{A, B\\}} \\left[ x_{i\\ell} \\ln\\left(\\frac{\\widehat{p}_{i\\ell}^{(2)}}{\\widehat{p}_{i\\ell}^{(1)}}\\right) + (n_{i\\ell} - x_{i\\ell}) \\ln\\left(\\frac{1 - \\widehat{p}_{i\\ell}^{(2)}}{1 - \\widehat{p}_{i\\ell}^{(1)}}\\right) \\right] $$\n最后，我们将这个对数似然差值的表达式代回到我们的 $\\Delta \\mathrm{BIC}$ 方程中：\n$$ \\Delta \\mathrm{BIC} = \\ln(2T) - 2 \\sum_{i=1}^{T} \\sum_{\\ell \\in \\{A, B\\}} \\left[ x_{i\\ell} \\ln\\left(\\frac{\\widehat{p}_{i\\ell}^{(2)}}{\\widehat{p}_{i\\ell}^{(1)}}\\right) + (n_{i\\ell} - x_{i\\ell}) \\ln\\left(\\frac{1 - \\widehat{p}_{i\\ell}^{(2)}}{1 - \\widehat{p}_{i\\ell}^{(1)}}\\right) \\right] $$\n这就是所要求的多重扫描模型和单一扫描模型之间 BIC 差值的闭式解析表达式。$\\Delta \\mathrm{BIC}$ 的负值将构成支持模型 $\\mathcal{M}_{2}$ 的统计证据。",
            "answer": "$$ \\boxed{ \\ln(2T) - 2 \\sum_{i=1}^{T} \\sum_{\\ell \\in \\{A, B\\}} \\left[ x_{i\\ell} \\ln\\left(\\frac{\\widehat{p}_{i\\ell}^{(2)}}{\\widehat{p}_{i\\ell}^{(1)}}\\right) + (n_{i\\ell} - x_{i\\ell}) \\ln\\left(\\frac{1 - \\widehat{p}_{i\\ell}^{(2)}}{1 - \\widehat{p}_{i\\ell}^{(1)}}\\right) \\right] } $$"
        }
    ]
}