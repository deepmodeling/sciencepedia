{
    "hands_on_practices": [
        {
            "introduction": "在群体遗传学中，一项基本任务是将可观测的遗传变异与潜在的人口统计学参数联系起来。本练习将探讨中性理论的一个核心关系，即核苷酸多样性 ($\\pi$)、突变率 ($\\mu$) 与有效种群大小 ($N_e$) 之间的关系。通过应用这一基本公式，您将能够从基因组数据中估算出长期的有效种群大小，并深入理解为何这一理论值通常与实际的普查种群大小有所不同。",
            "id": "2724541",
            "problem": "一个研究团队正在调查晚更新世时期一个解剖学意义上的现代人祖先群体的长期人口史。他们从常染色体上推定的中性基因间区获得了全基因组数据，并估计了全基因组范围内的核苷酸多样性（随机抽样的两个染色体之间每个位点的成对差异），记为 $\\pi$，其值为 $\\pi = 0.001$。独立的基于谱系的研究提供了一个每位点、每代的突变率 $\\mu = 1.25 \\times 10^{-8}$。\n\n假设一个泛交的、二倍体的群体处于突变-漂变平衡状态，具有恒定的长期有效群体大小，其中突变遵循无限位点模型，并且所分析位点的选择压力可以忽略不计。仅使用这些假设以及核苷酸多样性和有效群体大小的核心定义，推导出从 $\\pi$ 和 $\\mu$ 估算常染色体长期有效群体大小 $N_{e}$ 所需的关系式，计算其点估计值，并简要解释为何在人族谱系中，这样的 $N_{e}$ 可能与普查大小不同。\n\n提供您的 $N_{e}$ 数值估计，保留两位有效数字，并以个体数量为单位报告。您最终报告的答案必须是单个数字。",
            "solution": "问题陈述经过验证，被认为是有效的。这是一个群体遗传学中设定良好的问题，基于已建立的理论原理——即分子进化的中性理论和溯祖理论。唯一解所需的所有必要参数和假设均已提供，并且没有科学或逻辑上的矛盾。\n\n目标是根据全基因组核苷酸多样性 $\\pi$ 和每代突变率 $\\mu$ 来估算常染色体长期有效群体大小，记为 $N_e$。所提供的假设是一个处于突变-漂变平衡状态的泛交、二倍体群体，其 $N_e$ 恒定，遵循无限位点突变模型且无选择作用。\n\n核苷酸多样性 $\\pi$ 被定义为从一个群体中随机抽样的两个序列（染色体）之间每个位点的平均成对差异数。为了推导 $\\pi$、$N_e$ 和 $\\mu$ 之间的关系，我们考虑从当前有效大小为 $N_e$ 的二倍体群体中随机抽样的两个基因谱系。\n\n根据适用于二倍体群体的 Wright-Fisher 模型的溯祖理论，这两个谱系在前一代合并（即找到它们最近的共同祖先）的概率为 $\\frac{1}{2N_e}$。合并时间 $T_2$ 服从以此成功概率计算的几何分布。因此，这两个谱系到最近共同祖先的期望时间是该概率的倒数：\n$$E[T_2] = \\frac{1}{\\frac{1}{2N_e}} = 2N_e \\text{ 代}$$\n\n假设突变以每位点、每代 $\\mu$ 的速率发生。在无限位点模型下，每个新突变都发生在一个以前不是多态性的位点上。因此，两个序列之间的核苷酸差异数是自从它们从共同祖先分化以来，在两个谱系上累积的总突变数。\n\n分隔两个采样染色体的总时间是追溯到其共同祖先的两个分支长度之和。这个总分支长度是 $2T_2$。期望的总分支长度是 $E[2T_2] = 2 E[T_2] = 2(2N_e) = 4N_e$ 代。\n\n分隔两个谱系的每位点期望突变数是总突变机会（以代为单位的总期望分支长度）与每代突变率的乘积。根据定义，这个量就是核苷酸多样性 $\\pi$。\n$$\\pi = (2 \\mu) \\times E[T_2]$$\n或者，更直接地：\n$$\\pi = \\mu \\times E[\\text{total branch length}] = \\mu \\times (4N_e)$$\n因此，在这些假设下，基本关系是：\n$$\\pi = 4N_e\\mu$$\n\n现在我们可以求解有效群体大小 $N_e$：\n$$N_e = \\frac{\\pi}{4\\mu}$$\n\n问题提供了以下数值：\n核苷酸多样性，$\\pi = 0.001$。\n突变率，$\\mu = 1.25 \\times 10^{-8}$ 每位点每代。\n\n将这些值代入推导出的方程：\n$$N_e = \\frac{0.001}{4 \\times (1.25 \\times 10^{-8})}$$\n首先，我们计算分母：\n$$4 \\times 1.25 \\times 10^{-8} = 5.0 \\times 10^{-8}$$\n现在，我们进行除法运算：\n$$N_e = \\frac{10^{-3}}{5.0 \\times 10^{-8}} = \\frac{1}{5.0} \\times 10^{-3 - (-8)} = 0.2 \\times 10^5 = 20000$$\n题目要求将估计值保留两位有效数字。计算出的值恰好是 $20000$，可以表示为 $2.0 \\times 10^4$ 以表示两位有效数字。\n\n最后，需要简要解释为什么在人族谱系中，有效群体大小 ($N_e$) 会与普查大小 ($N_c$) 不同。有效群体大小是一个理想化的概念，代表了一个 Wright-Fisher 群体的大小，该群体将经历与实际群体相同程度的遗传漂变。在现实中，由于违反了理想模型的假设，$N_e$ 几乎总是小于普查大小 $N_c$（实际的个体数量）。对于人族谱系，关键因素包括：\n1. **繁殖成功率的差异：** 如果个体间的后代数量存在高方差，其中一些个体对下一代的贡献不成比例地大（例如，由于社会结构或性选择），遗传漂变会加速，$N_e$ 会减小。\n2. **性别比例不均：** 繁殖雄性与繁殖雌性的比例失衡会降低 $N_e$。有效大小对数量较少的性别的数量很敏感，如公式 $N_e = \\frac{4N_m N_f}{N_m + N_f}$ 所示。对于各种人族群体来说，一夫多妻或一妻多夫的交配制度是可能存在的，这会导致 $N_e < N_c$。\n3. **种群大小的波动：** 长期有效大小由群体大小随时间的调和平均数决定。该平均数受小种群规模时期（瓶颈）的严重影响。人族历史，特别是智人（*Homo sapiens*）的历史，以人口瓶颈为特征，例如与“走出非洲”迁徙相关的瓶颈，这将相对于任何给定时间的普查大小，极大地降低长期 $N_e$。",
            "answer": "$$\\boxed{2.0 \\times 10^4}$$"
        },
        {
            "introduction": "在确立了估算种群基本参数的方法后，我们可以进一步研究群体间的特定互动，例如基因流。Patterson的D统计量（或称ABBA-BABA检验）是检测古代基因渗入的强大工具，它通过检验姐妹群与一个外群共享衍生等位基因的不对称性来工作。本次实践将指导您完成计算D统计量及其显著性（Z-score）的关键步骤，这其中采用了块式刀切法（block-jackknife）来估计标准误，这是古基因组学研究中的一项标准技术。",
            "id": "2724590",
            "problem": "考虑一个应用于人族系统发育的四分类单元基因流检验，该检验使用ABBA–BABA框架：群体$P_1$是一个西非群体（Yoruba），群体$P_2$是一个欧洲群体，群体$P_3$是一个高覆盖度的Neanderthal基因组，而$O$是作为外群的Chimpanzee，用于确定衍生等位基因的方向。假设位点是双等位基因的，祖先状态的确定是正确的，并且通过将基因组划分为$20$个长度近似相等、不重叠的区块来解释连锁不平衡。在所有信息性位点中，全基因组范围内的位点模式计数为 $ABBA = 120$ 和 $BABA = 80$。提供给您的是按区块计算的“留一区块”刀切法贡献值，定义为 $v_i = \\left(D_{(i)} - \\bar{D}\\right)^2$，其中 $D_{(i)}$ 是Patterson D统计量的“留一区块”估计量，而$\\bar{D}$是这$20$个区块的$D_{(i)}$值的平均值。这$20$个$v_i$的值是：\n$$\n\\{\\,1.0 \\times 10^{-4},\\, 1.2 \\times 10^{-4},\\, 1.5 \\times 10^{-4},\\, 9.0 \\times 10^{-5},\\, 1.4 \\times 10^{-4},\\, 1.3 \\times 10^{-4},\\, 1.1 \\times 10^{-4},\\, 1.6 \\times 10^{-4},\\, 1.2 \\times 10^{-4},\\, 1.4 \\times 10^{-4},\\, 1.3 \\times 10^{-4},\\, 1.1 \\times 10^{-4},\\, 1.7 \\times 10^{-4},\\, 1.0 \\times 10^{-4},\\, 1.3 \\times 10^{-4},\\, 1.2 \\times 10^{-4},\\, 1.4 \\times 10^{-4},\\, 2.2 \\times 10^{-4},\\, 1.5 \\times 10^{-4},\\, 1.1 \\times 10^{-4}\\,\\}.\n$$\n从适用于此情景下进化推断的基本原理出发，根据计数计算全基因组的Patterson D统计量，使用这$20$个区块构建$D$的区块刀切法标准误，然后计算相应的双侧正态近似$Z$分数，以检验无过量等位基因共享（即无不对称基因流）的零假设。使用广泛接受的标准，即$|Z| \\ge 3$在此情景下表示具有统计显著性，并从生物学角度，就$P_2$和$P_3$相对于$P_1$的过量等位基因共享来解释结果。将$Z$分数四舍五入至四位有效数字作为您的最终数值答案报告。将$Z$分数表述为一个无量纲的量。",
            "solution": "对问题陈述进行验证。\n\n**步骤1：提取已知条件**\n- 群体：$P_1$ (Yoruba)，$P_2$ (欧洲人)，$P_3$ (Neanderthal)，$O$ (Chimpanzee 外群)。这定义的系统发育关系为 $((P_1, P_2), P_3), O$。\n- 检验框架：用于基因流检测的ABBA-BABA检验。\n- 假设：双等位基因位点，正确的祖先状态确定，通过将基因组划分为$n=20$个不重叠的区块来考虑连锁不平衡。\n- 全基因组位点模式计数：$C_{ABBA} = 120$ 和 $C_{BABA} = 80$。\n- 区块刀切法数据：区块数量为$n=20$。提供的“留一区块”贡献值为 $v_i = (D_{(i)} - \\bar{D})^2$，其中$i=1, \\dots, 20$。\n- $v_i$值的集合为 $\\{1.0 \\times 10^{-4}, 1.2 \\times 10^{-4}, 1.5 \\times 10^{-4}, 9.0 \\times 10^{-5}, 1.4 \\times 10^{-4}, 1.3 \\times 10^{-4}, 1.1 \\times 10^{-4}, 1.6 \\times 10^{-4}, 1.2 \\times 10^{-4}, 1.4 \\times 10^{-4}, 1.3 \\times 10^{-4}, 1.1 \\times 10^{-4}, 1.7 \\times 10^{-4}, 1.0 \\times 10^{-4}, 1.3 \\times 10^{-4}, 1.2 \\times 10^{-4}, 1.4 \\times 10^{-4}, 2.2 \\times 10^{-4}, 1.5 \\times 10^{-4}, 1.1 \\times 10^{-4}\\}$。请注意，$9.0 \\times 10^{-5}$可以写作$0.9 \\times 10^{-4}$。\n- 任务：计算全基因组的Patterson D统计量、区块刀切法标准误，以及用于检验无过量等位基因共享零假设的相应$Z$分数。\n- 显著性标准：$|Z| \\ge 3$。\n- 最终答案要求：报告四舍五入至四位有效数字的$Z$分数。\n\n**步骤2：使用提取的已知条件进行验证**\n根据验证标准对问题进行评估。\n- **科学性**：该问题在群体遗传学中有坚实的科学基础。Patterson D统计量（ABBA-BABA检验）是在人族和其他物种的系统发育中检测基因渗入的一种标准且广泛使用的方法。该群体配置是研究Neanderthal基因渗入到非非洲现代人群中的经典配置。\n- **良态性**：该问题是良态的。它提供了计算所需量（$D$统计量、标准误和$Z$分数）的所有必要数据（ABBA和BABA模式的计数、区块数量以及刀切法方差分量$v_i$）。目标明确，并能导出一个唯一的数值解。\n- **客观性**：该问题以精确、客观且无偏的科学语言陈述。\n- **完整性与一致性**：该问题是自洽且内部一致的。所提供的数据是充分的且没有矛盾。$v_i$的值均为非负数，这与平方项的预期相符。\n\n**步骤3：结论与行动**\n问题有效。将构建一个严谨的解答。\n\n**求解过程**\n该问题要求计算Patterson D统计量，使用区块刀切法程序计算其标准误，以及用于检验基因流的相应$Z$分数。\n\n零假设$H_0$假定了一个严格的分叉系统发育树 $((P_1, P_2), P_3), O$，且内群分支之间没有基因流。在此模型下，分选到$P_1$，$P_2$和$P_3$中的祖先多态性是谱系不一致的唯一来源。这个过程被称为不完全谱系分选（ILS），预计会以相等的频率产生衍生位点模式“ABBA”和“BABA”。在这里，“A”表示祖先等位基因（与外群$O$中相同），“B”表示衍生等位基因。“ABBA”模式的过量（即$P_2$和$P_3$共享衍生等位基因）表明它们之间存在基因流。相反，“BABA”模式的过量（即$P_1$和$P_3$共享衍生等位基因）则表明它们之间存在基因流。\n\nPatterson D统计量量化了这些位点模式计数的不对称性。其定义为：\n$$\nD = \\frac{\\sum_j (C_{ABBA,j} - C_{BABA,j})}{\\sum_j (C_{ABBA,j} + C_{BABA,j})}\n$$\n其中 $C_{ABBA,j}$ 和 $C_{BABA,j}$ 是位点$j$处位点模式的指示变量。对于全基因组计数，这可以简化为：\n$$\nD = \\frac{N_{ABBA} - N_{BABA}}{N_{ABBA} + N_{BABA}}\n$$\n其中 $N_{ABBA}$ 和 $N_{BABA}$ 分别是相应模式的总计数。\n\n使用所提供的数据，$N_{ABBA} = 120$ 和 $N_{BABA} = 80$，全基因组的$D$统计量为：\n$$\nD = \\frac{120 - 80}{120 + 80} = \\frac{40}{200} = 0.2\n$$\n$D$的正值表示“ABBA”位点的过量，表明群体$P_2$（欧洲人）和群体$P_3$（Neanderthal）之间存在过量的等位基因共享。\n\n为了评估这个值与零假设期望（$D=0$）的偏差是否具有统计显著性，我们必须计算该估计的标准误$SE_D$。题目指定了对$n=20$个区块使用区块刀切法程序。刀切法估计的标准误公式为：\n$$\nSE_D = \\sqrt{\\frac{n-1}{n} \\sum_{i=1}^{n} (D_{(i)} - \\bar{D})^2}\n$$\n其中$D_{(i)}$是移除第$i$个区块后计算出的$D$统计量，而$\\bar{D}$是这$n$个$D_{(i)}$值的平均值。题目直接提供了$v_i = (D_{(i)} - \\bar{D})^2$的值。因此，我们首先需要计算这些值的总和。\n给出的$v_i$值中，有一个是$9.0 \\times 10^{-5} = 0.9 \\times 10^{-4}$。$\\sum_{i=1}^{20} v_i$ 的总和为：\n$$\n\\sum_{i=1}^{20} v_i = (1.0 + 1.2 + 1.5 + 0.9 + 1.4 + 1.3 + 1.1 + 1.6 + 1.2 + 1.4 + 1.3 + 1.1 + 1.7 + 1.0 + 1.3 + 1.2 + 1.4 + 2.2 + 1.5 + 1.1) \\times 10^{-4}\n$$\n$$\n\\sum_{i=1}^{20} v_i = 26.4 \\times 10^{-4}\n$$\n现在，将这个总和代入$n=20$的标准误公式中：\n$$\nSE_D = \\sqrt{\\frac{20-1}{20} \\sum_{i=1}^{20} v_i} = \\sqrt{\\frac{19}{20} \\times (26.4 \\times 10^{-4})}\n$$\n$$\nSE_D = \\sqrt{0.95 \\times 26.4 \\times 10^{-4}} = \\sqrt{25.08 \\times 10^{-4}}\n$$\n$SE_D \\approx 5.0079936 \\times 10^{-2}$。\n\n最后，我们计算$Z$分数。用于检验零假设$H_0: D=0$的$Z$分数，是估计值与其标准误的比值，其假设是根据中心极限定理，估计量服从正态分布。\n$$\nZ = \\frac{D}{SE_D}\n$$\n代入计算出的值：\n$$\nZ = \\frac{0.2}{\\sqrt{25.08 \\times 10^{-4}}} \\approx \\frac{0.2}{0.050079936} \\approx 3.993615\n$$\n题目要求将$Z$分数四舍五入到四位有效数字。\n$$\nZ \\approx 3.994\n$$\n然后将这个$Z$值与显著性阈值进行比较。题目陈述$|Z| \\ge 3$表示具有统计显著性。由于$|3.994| = 3.994 \\ge 3$，因此可以高置信度地拒绝无基因流的零假设。\n\n其生物学解释是，相对于西非群体（$P_1$），欧洲群体（$P_2$）与Neanderthal群体（$P_3$）之间存在统计上显著的过量共享衍生等位基因。这一结果为Neanderthal向现代欧洲人祖先（在他们与现代西非人祖先分化之后）的基因混合（基因流）提供了有力证据。这与关于人类进化的既定科学共识是一致的。",
            "answer": "$$\n\\boxed{3.994}\n$$"
        },
        {
            "introduction": "仅仅检测到基因渗入的存在只是第一步，更深入的问题是理解其发生的模式：它是一次性的脉冲事件，还是一个持续的、长期的过程？连锁不平衡 (LD) 衰减的模式为我们提供了线索。本练习将引导您设计一个模拟研究，以区分这两种不同的人口历史情景。您将学习到，单次脉冲式渗入会产生一个简单的指数衰减曲线，而连续的基因流则会导致一个更复杂的衰减模式，通过模型拟合和量化失拟度，我们可以对这些情景进行区分。",
            "id": "2724604",
            "problem": "您的任务是设计并实现一个可复现的模拟研究，通过利用连锁不平衡（LD; Linkage Disequilibrium）随遗传距离的衰减特性，以算法方式区分单次脉冲式基因混合与持续性迁移。您的程序必须在每种人口统计学情景下，合成一条由基因混合诱导的LD衰减曲线，拟合一个能捕捉单次事件预期特征的简约模型，量化其失拟程度，然后分类判断该基础情景更符合单次脉冲还是持续性迁移。所有遗传距离都必须以摩根（Morgans）为单位的遗传图单位来处理，并且您模拟中的所有距离都必须以摩根表示。\n\n需要使用的基本原理：\n- 重组事件可以被建模为沿遗传图的泊松过程，两个相隔遗传距离$d$的中性位点跨代共同继承同一祖先来源片段的概率，是$d$和迁移祖先来源进入群体的时代分布的单调递减函数。\n- 在单代内贡献固定比例的单次脉冲式基因混合，会产生局域祖先来源的长程相关性，这种相关性受单一特征时间尺度的衰减控制（随$d$变化）；而跨多代的持续性迁移，则会产生来自多个进入时间的贡献的叠加，每个进入时间都贡献其自身的时间尺度，从而导致多种衰减的混合。\n\n您的任务：\n1. 从第一性原理出发，推导两种情景下由基因混合诱导的LD衰减信号随遗传距离$d$变化的预期函数形式：\n   - 发生在过去$t$代的单次脉冲式基因混合。\n   - 在$G$代内以恒定代际速率$m$进行的持续性迁移。\n   在这两种情况下，您将模拟的是预期的衰减曲线，并通过添加小的乘性对数正态噪声来模拟抽样噪声，同时保持值的正性。\n\n2. 实现一个模拟器，给定一个遗传距离网格$d \\in [0,0.5]$ 摩根，增量为$0.01$摩根，使用推导出的函数形式为每种情景生成一条带噪声的衰减曲线。噪声模型必须是乘性对数正态模型：对于每个$d$，将理想曲线值乘以$\\exp(\\epsilon)$，其中$\\epsilon$是一个均值为零、标准差为$0.004$（自然对数单位）的正态随机变量。使用固定的随机种子以确保精确的可复现性。\n\n3. 在对数空间中，通过普通最小二乘法拟合一个关于$d$的单指数模型，即通过线性回归（带截距）将模拟曲线的对数值$\\log$拟合为$d$的直线。计算整个$d$网格上残差在对数空间中的均方根误差（RMSE）。基于“单次脉冲产生单一特征时间尺度（在对数空间中是线性的），而持续性迁移产生多种时间尺度的混合（在对数空间中是非线性的）”这一概念预期，实施以下决策规则：如果RMSE超过阈值$0.008$，则分类为“持续性迁移”，否则分类为“单次脉冲”。将分类编码为整数：为“持续性迁移”输出$1$，为“单次脉冲”输出$0$。\n\n4. 测试套件。您的程序必须按照此确切顺序评估以下六个参数集，使用与上文定义的相同的距离网格和噪声模型：\n   - 情况 A（单次脉冲）：$t = 5$。\n   - 情况 B（单次脉冲）：$t = 40$。\n   - 情况 C（持续性迁移）：$m = 0.02, G = 50$。\n   - 情况 D（持续性迁移）：$m = 0.005, G = 200$。\n   - 情况 E（边界条件，塌缩为单代的持续性迁移）：$m = 0.3, G = 1$。\n   - 情况 F（持续性迁移）：$m = 0.05, G = 10$。\n\n5. 最终输出格式。您的程序应生成单行输出，包含情况 A–F 的六个整数分类，形式为逗号分隔的列表并用方括号括起（例如，“[0,1,1,0,0,1]”）。不允许有其他输出。\n\n注意：\n- 您不得假设任何外部文件或输入。所有值都必须嵌入在程序中。\n- 所有遗传距离均以摩根为单位。所需输出不涉及其他物理单位。\n- 每个测试用例的答案是如上所述的整数，最终输出必须按指定的单行格式汇总它们。",
            "solution": "所述问题经过了严格的验证。所有提供的数据、原理和约束都已逐字提取。该问题被发现其科学基础扎根于群体遗传学原理，特别是关于基因混合后连锁不平衡衰减的理论。问题阐述清晰，所有必要的参数以及用于模拟和分类的明确、客观的程序都已定义。问题没有矛盾、歧义和事实错误。它构成了一个有效且可形式化的科学问题。因此，提供解决方案是合理的。\n\n问题的核心是通过分析连锁不平衡（LD）衰减曲线的形状，来区分两种人口历史：单次基因混合脉冲和持续性迁移。其基本原理是，被建模为泊松过程的重组会随时间分解祖先染色体片段。这种分解的速率取决于基因混合发生以来的时间以及位点间的遗传距离$d$。\n\n**1. LD衰减模型的推导**\n\n我们推导预期的LD衰减信号（记为$L(d)$）作为遗传距离$d$（单位为摩根）的函数形式。\n\n**情景 A：单次脉冲式基因混合**\n\n考虑一个发生在过去$t$代的单次脉冲式基因混合事件。在该时间点，来自迁移群体的染色体片段被引入到混合群体中。对于两个遗传距离为$d$的位点，其祖先来源的相关性取决于连接它们的片段在脉冲事件后的$t$代中，没有被任何一次重组事件打破的概率。\n\n在单次减数分裂中，长度为$d$的片段不发生重组的概率是$e^{-d}$。在$t$个独立的减数分裂世代中，该片段保持完整的概率是$(e^{-d})^t = e^{-td}$。由基因混合诱导的LD信号与此存活概率成正比。因此，我们可以将衰减的函数形式写为：\n$$L_{\\text{pulse}}(d) = C_1 e^{-td}$$\n其中$C_1$是一个取决于混合比例的振幅常数。\n\n为了分析衰减的形状，我们可以将振幅归一化。对该函数取自然对数得到：\n$$\\log(L_{\\text{pulse}}(d)) = \\log(C_1) - td$$\n这个方程在$d$上是线性的，斜率为$-t$，截距为$\\log(C_1)$。这证实了单次脉冲事件导致简单指数衰减的前提，该衰减在对数空间中表现为一条直线。\n\n**情景 B：持续性迁移**\n\n考虑一个在过去$G$个世代（从过去第$g=1$代到第$g=G$代）以恒定速率$m$发生的持续性迁移过程。在不同时间进入群体的迁移片段将经历不同世代数的重组。一个在$g$代前进入的片段对LD信号的贡献，其衰减形式为$e^{-gd}$。\n\n总的LD信号是来自每个迁移世代贡献的叠加或加权和。设$w_g$为在第$g$代进入的片段对观测到的LD的相对贡献。总信号为：\n$$L_{\\text{continuous}}(d) = C_2 \\sum_{g=1}^{G} w_g e^{-gd}$$\n问题没有指定权重$w_g$。对于一个简化的“持续”流模型，一个合理且标准的假设是，迁移期内的每一代对迁移片段库的贡献是均等的。这对应于均匀权重，$w_g = 1/G$，其中$g \\in \\{1, 2, \\dots, G\\}$。模型变为：\n$$L_{\\text{continuous}}(d) = C_2 \\frac{1}{G} \\sum_{g=1}^{G} e^{-gd}$$\n这是一个具有不同衰减率的多个指数函数之和。得到的函数不是单一指数函数。其对数$\\log(L_{\\text{continuous}}(d))$不是$d$的线性函数。该和是一个几何级数，可以写成闭合形式：\n$$\\sum_{g=1}^{G} (e^{-d})^g = e^{-d} \\frac{1 - e^{-Gd}}{1 - e^{-d}}$$\n因此：\n$$L_{\\text{continuous}}(d) = C_2 \\frac{e^{-d}(1 - e^{-Gd})}{G(1 - e^{-d})}$$\n当将一个线性模型拟合到$\\log(L_{\\text{continuous}}(d))$时，其固有的曲率将导致显著的模型设定错误，这可以通过残差的均方根误差（RMSE）来量化。\n\n**2. 模拟与分类程序**\n\n分析将按以下算法步骤进行：\n\n1.  **定义网格**：建立一个遗传距离$d$的网格，范围从$0$到$0.5$摩根，增量为$0.01$摩根。这将产生$N=51$个数据点。\n\n2.  **模拟衰减曲线**：对于每个测试用例，使用相应的推导公式（单次脉冲或持续性迁移）和单位振幅（$C_1=C_2=1$）生成理想衰减曲线$L_{\\text{ideal}}(d)$。\n    -   单次脉冲: $L(d) = e^{-td}$\n    -   持续性迁移: $L(d) = \\frac{1}{G} \\sum_{g=1}^{G} e^{-gd}$\n    然后通过引入乘性对数正态噪声来生成带噪声的模拟曲线$L_{\\text{sim}}(d)$：\n    $$L_{\\text{sim}}(d_i) = L_{\\text{ideal}}(d_i) \\cdot \\exp(\\epsilon_i)$$\n    其中$\\epsilon_i$是从正态分布$\\mathcal{N}(0, \\sigma^2)$（$\\sigma = 0.004$）中抽取的独立样本。使用固定的随机种子以确保可复现性。\n\n3.  **执行线性回归**：对模拟数据进行对数转换，$z_i = \\log(L_{\\text{sim}}(d_i))$。执行普通最小二乘线性回归，将模型$z(d) = \\beta_0 + \\beta_1 d$拟合到转换后的数据点$(d_i, z_i)$。这将找到最佳拟合直线。\n\n4.  **量化拟合优度**：计算残差在对数空间中的均方根误差（RMSE）。残差为$r_i = z_i - (\\hat{\\beta}_0 + \\hat{\\beta}_1 d_i)$，其中$\\hat{\\beta}_0$和$\\hat{\\beta}_1$是估计的回归系数。RMSE为：\n    $$RMSE = \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} r_i^2}$$\n    对于真实的单脉冲情景，残差$r_i$仅由噪声项$\\epsilon_i$引起，因此RMSE预计接近$\\sigma = 0.004$。对于持续性迁移情景，残差还包括将直线拟合到曲线所产生的系统误差，导致RMSE显著增大。\n\n5.  **分类情景**：基于计算出的RMSE和预定义的阈值做出决策：\n    -   如果$RMSE > 0.008$：较大的误差表明存在非线性，这是持续性迁移的特征。该情况分类为“持续性迁移”（输出$1$）。\n    -   如果$RMSE \\leq 0.008$：较小的误差与线性一致，这是单次脉冲的特征。该情况分类为“单次脉冲”（输出$0$）。\n\n此程序将应用于六个指定的测试用例中的每一个，以确定其分类。持续性迁移在$G=1$代上的边界情况，预计其行为与$t=1$时的单次脉冲完全相同，这为模型的自洽性提供了一个关键的检验。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Designs and implements a simulation to distinguish single pulse from continuous migration\n    based on linkage disequilibrium decay, as specified in the problem statement.\n    \"\"\"\n    \n    # Define the six test cases as per the problem statement\n    test_cases = [\n        {'type': 'pulse', 'params': {'t': 5}, 'label': 'A'},\n        {'type': 'pulse', 'params': {'t': 40}, 'label': 'B'},\n        {'type': 'continuous', 'params': {'m': 0.02, 'G': 50}, 'label': 'C'},\n        {'type': 'continuous', 'params': {'m': 0.005, 'G': 200}, 'label': 'D'},\n        {'type': 'continuous', 'params': {'m': 0.3, 'G': 1}, 'label': 'E'},\n        {'type': 'continuous', 'params': {'m': 0.05, 'G': 10}, 'label': 'F'}\n    ]\n\n    # Global parameters for the simulation\n    d = np.arange(0.0, 0.501, 0.01) # Genetic distance grid from 0 to 0.5 Morgans\n    sigma_noise = 0.004 # Standard deviation of log-normal noise\n    rmse_threshold = 0.008 # Decision threshold for classification\n    \n    # Set a fixed random seed for reproducibility\n    np.random.seed(0)\n\n    results = []\n\n    for case in test_cases:\n        # 1. Generate the ideal LD decay curve\n        if case['type'] == 'pulse':\n            t = case['params']['t']\n            # Functional form for single pulse: L(d) = exp(-t*d)\n            y_ideal = np.exp(-t * d)\n        elif case['type'] == 'continuous':\n            G = case['params']['G']\n            # Parameter m is not used for the decay shape, only G matters.\n            # Functional form for continuous migration: L(d) = 1/G * sum_{g=1 to G} exp(-g*d)\n            # Vectorized implementation for efficiency:\n            g_gens = np.arange(1, G + 1).reshape(-1, 1) # Generations as a column vector\n            d_grid = d.reshape(1, -1)                  # Distances as a row vector\n            matrix_gd = g_gens @ d_grid                # Outer product g*d\n            exp_matrix = np.exp(-matrix_gd)\n            y_ideal = np.mean(exp_matrix, axis=0) # Average over generations\n        else:\n            # This path should not be reached with the given test cases\n            raise ValueError(f\"Unknown case type: {case['type']}\")\n\n        # 2. Add multiplicative log-normal noise\n        noise = np.random.normal(loc=0.0, scale=sigma_noise, size=len(d))\n        y_sim = y_ideal * np.exp(noise)\n\n        # 3. Fit a linear model in log space\n        log_y_sim = np.log(y_sim)\n        \n        # OLS linear regression (degree 1 polynomial fit)\n        # coeffs[0] is the slope, coeffs[1] is the intercept\n        coeffs = np.polyfit(d, log_y_sim, 1)\n        y_fit = coeffs[0] * d + coeffs[1]\n        \n        # 4. Compute RMSE of the residuals\n        residuals = log_y_sim - y_fit\n        rmse = np.sqrt(np.mean(residuals**2))\n\n        # 5. Classify based on the RMSE threshold\n        classification = 1 if rmse > rmse_threshold else 0\n        results.append(classification)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}