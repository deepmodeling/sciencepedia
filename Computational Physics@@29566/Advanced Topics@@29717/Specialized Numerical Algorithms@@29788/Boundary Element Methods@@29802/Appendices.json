{"hands_on_practices": [{"introduction": "This first exercise provides a direct, hands-on experience with the core mechanics of the Boundary Element Method. By modeling a simple two-conductor capacitor with just two elements, we will manually derive a $2 \\times 2$ linear system [@problem_id:2374801]. This practice is fundamental for understanding how the continuous physics described by an integral equation is transformed into a discrete algebraic problem that a computer can solve.", "problem": "Consider two identical, perfectly conducting, straight strips in two-dimensional electrostatics, embedded in a homogeneous medium of permittivity $\\varepsilon$. The strips are parallel to the $x$-axis, centered at $y=+h$ (upper strip) and $y=-h$ (lower strip), and each extends from $x=-a$ to $x=+a$. Assume invariance in the out-of-plane direction (per-unit-depth formulation).\n\nThe upper strip is held at potential $+V_{0}/2$ and the lower strip at potential $-V_{0}/2$, with $V_{0} > 0$. Model each strip as a single constant source element carrying an unknown uniform line charge density $\\lambda_{1}$ (upper) and $\\lambda_{2}$ (lower), and collocate the boundary condition at the center of each strip (at $x=0$ on each strip).\n\nUse the direct boundary element method with the free-space two-dimensional fundamental solution of the Laplace equation,\n$$\nG(\\mathbf{r}) \\;=\\; -\\frac{1}{2\\pi}\\,\\ln\\!\\left(\\frac{|\\mathbf{r}|}{L_{0}}\\right),\n$$\nwhere $L_{0} > 0$ is an arbitrary reference length introduced to render the logarithmâ€™s argument dimensionless. Write the two-by-two linear system for the nodal potentials at the collocation points in terms of the unknown line charge densities, evaluate the matrix entries analytically, solve for $\\lambda_{1}$ and $\\lambda_{2}$, and then compute the capacitance per unit out-of-plane depth,\n$$\nC' \\;=\\; \\frac{Q'}{V_{0}}, \\quad \\text{with} \\quad Q' \\;=\\; \\int_{-a}^{a} \\lambda_{1}\\,\\mathrm{d}x \\;=\\; 2a\\,\\lambda_{1}.\n$$\nProvide your final answer as a single closed-form analytic expression for $C'$ in terms of $\\varepsilon$, $a$, and $h$. Do not perform any numerical approximation or rounding. Express the capacitance per unit out-of-plane depth in farads per meter.", "solution": "The problem statement is subjected to validation prior to any attempt at a solution.\n\nStep 1: Extract Givens.\n- System: Two identical, perfectly conducting, straight strips in two-dimensional electrostatics.\n- Medium: Homogeneous with permittivity $\\varepsilon$.\n- Geometry: Strips are parallel to the $x$-axis. Upper strip centered at $y=+h$, lower strip at $y=-h$. Each extends from $x=-a$ to $x=+a$. System is invariant in the out-of-plane direction.\n- Boundary Conditions: Upper strip potential is $\\phi_1 = +V_{0}/2$. Lower strip potential is $\\phi_2 = -V_{0}/2$, with $V_{0} > 0$.\n- Model: Each strip is a single constant source element. Upper strip carries uniform line charge density $\\lambda_{1}$. Lower strip carries uniform line charge density $\\lambda_{2}$.\n- Method: Direct boundary element method (BEM) with collocation at the center of each strip. The center of the upper strip is $\\mathbf{r}_1 = (0, +h)$. The center of the lower strip is $\\mathbf{r}_2 = (0,-h)$.\n- Fundamental Solution: The 2D free-space Green's function for the Laplace equation is given as $G(\\mathbf{r}) = -\\frac{1}{2\\pi}\\,\\ln\\left(\\frac{|\\mathbf{r}|}{L_{0}}\\right)$, where $L_{0} > 0$ is a reference length.\n- Objective:\n  1. Formulate the $2 \\times 2$ linear system for nodal potentials.\n  2. Evaluate matrix entries analytically.\n  3. Solve for $\\lambda_{1}$ and $\\lambda_{2}$.\n  4. Compute capacitance per unit out-of-plane depth, $C' = Q'/V_{0}$, where the total charge per unit depth on the upper strip is $Q' = \\int_{-a}^{a} \\lambda_{1}\\,\\mathrm{d}x = 2a\\,\\lambda_{1}$.\n  5. The final answer for $C'$ must be a closed-form expression in terms of $\\varepsilon$, $a$, and $h$.\n\nStep 2: Validate Using Extracted Givens.\n- Scientific Grounding: The problem is formulated within the established framework of two-dimensional electrostatics and the Boundary Element Method. The provided fundamental solution is correct for the 2D Laplace equation, and its use for calculating potential from a source distribution is standard.\n- Well-Posedness: The problem is well-posed. It provides all necessary information (geometry, boundary conditions, physical properties, and a simplified model) to determine a unique value for the capacitance within the constraints of the specified model.\n- Objectivity: The problem is stated using precise, objective, and standard scientific terminology.\n- Flaw Checklist: The problem does not violate any of the invalidity criteria. It is scientifically sound, formalizable, complete, feasible, well-structured, and verifiable. The employed model (single constant element per strip) is a standard coarse-grid approximation in BEM.\n\nStep 3: Verdict and Action.\nThe problem is deemed valid. A rigorous solution will now be developed.\n\nThe potential $\\phi(\\mathbf{r})$ at a field point $\\mathbf{r}=(x,y)$ generated by a line charge distribution $\\lambda(\\mathbf{r}')$ along a contour $\\Gamma$ in a medium of permittivity $\\varepsilon$ is given by the single-layer potential integral:\n$$ \\phi(\\mathbf{r}) \\;=\\; \\int_{\\Gamma} \\frac{\\lambda(\\mathbf{r}')}{\\varepsilon} G(\\mathbf{r} - \\mathbf{r}') \\,\\mathrm{d}\\Gamma' $$\nIn this problem, the contour $\\Gamma$ is composed of two disjoint strips, $\\Gamma_1$ (upper) and $\\Gamma_2$ (lower). The charge densities are constant on each strip: $\\lambda(\\mathbf{r}')=\\lambda_1$ for $\\mathbf{r}' \\in \\Gamma_1$ and $\\lambda(\\mathbf{r}')=\\lambda_2$ for $\\mathbf{r}' \\in \\Gamma_2$.\nThe potential at any point $\\mathbf{r}$ is the superposition of the potentials from both strips:\n$$ \\phi(\\mathbf{r}) \\;=\\; \\frac{\\lambda_1}{\\varepsilon} \\int_{\\Gamma_1} G(\\mathbf{r} - \\mathbf{r}') \\,\\mathrm{d}x' + \\frac{\\lambda_2}{\\varepsilon} \\int_{\\Gamma_2} G(\\mathbf{r} - \\mathbf{r}') \\,\\mathrm{d}x' $$\nwhere $\\Gamma_1$ is the segment from $(-a, h)$ to $(a, h)$ and $\\Gamma_2$ is the segment from $(-a, -h)$ to $(a, -h)$.\n\nWe apply the given boundary conditions at the collocation points, which are the centers of the strips: $\\mathbf{r}_1=(0, h)$ for the upper strip and $\\mathbf{r}_2=(0, -h)$ for the lower strip.\n$$ \\phi(\\mathbf{r}_1) = +\\frac{V_0}{2} \\quad \\text{and} \\quad \\phi(\\mathbf{r}_2) = -\\frac{V_0}{2} $$\nThis leads to a $2 \\times 2$ system of linear equations for the unknown charge densities $\\lambda_1$ and $\\lambda_2$:\n$$ \\begin{pmatrix} M_{11} & M_{12} \\\\ M_{21} & M_{22} \\end{pmatrix} \\begin{pmatrix} \\lambda_1 \\\\ \\lambda_2 \\end{pmatrix} = \\begin{pmatrix} +V_0/2 \\\\ -V_0/2 \\end{pmatrix} $$\nThe matrix entries $M_{ij}$ represent the potential at collocation point $\\mathbf{r}_i$ due to a unit charge density on strip $j$, multiplied by $1/\\varepsilon$.\n$$ M_{ij} = \\frac{1}{\\varepsilon} \\int_{\\Gamma_j} G(\\mathbf{r}_i - \\mathbf{r}') \\,\\mathrm{d}x' $$\n\nWe now evaluate the matrix entries analytically.\nFor $M_{11}$, the potential at $\\mathbf{r}_1=(0,h)$ from a unit charge on $\\Gamma_1$:\n$$ M_{11} = \\frac{1}{\\varepsilon} \\int_{-a}^{a} G((0,h) - (x',h)) \\,\\mathrm{d}x' = \\frac{1}{\\varepsilon} \\int_{-a}^{a} -\\frac{1}{2\\pi} \\ln\\left(\\frac{|-x'|}{L_0}\\right) \\,\\mathrm{d}x' $$\n$$ M_{11} = -\\frac{1}{2\\pi\\varepsilon} \\cdot 2 \\int_{0}^{a} \\ln\\left(\\frac{x'}{L_0}\\right) \\,\\mathrm{d}x' = -\\frac{1}{\\pi\\varepsilon} \\left[ x'\\ln\\left(\\frac{x'}{L_0}\\right) - x' \\right]_0^a $$\nUsing the fact that $\\lim_{x' \\to 0^+} x'\\ln(x') = 0$, we get:\n$$ M_{11} = -\\frac{1}{\\pi\\varepsilon} \\left( a\\ln\\left(\\frac{a}{L_0}\\right) - a \\right) = -\\frac{a}{\\pi\\varepsilon} \\left(\\ln\\left(\\frac{a}{L_0}\\right) - 1\\right) $$\nBy symmetry of the geometry, $M_{22} = M_{11}$.\n\nFor $M_{12}$, the potential at $\\mathbf{r}_1=(0,h)$ from a unit charge on $\\Gamma_2$:\n$$ M_{12} = \\frac{1}{\\varepsilon} \\int_{-a}^{a} G((0,h) - (x',-h)) \\,\\mathrm{d}x' = \\frac{1}{\\varepsilon} \\int_{-a}^{a} -\\frac{1}{2\\pi} \\ln\\left(\\frac{\\sqrt{x'^2 + (2h)^2}}{L_0}\\right) \\,\\mathrm{d}x' $$\n$$ M_{12} = -\\frac{1}{2\\pi\\varepsilon} \\int_{-a}^{a} \\left(\\frac{1}{2}\\ln(x'^2 + 4h^2) - \\ln(L_0)\\right) \\,\\mathrm{d}x' $$\nThe integral of $\\ln(x^2+c^2)$ is $x\\ln(x^2+c^2) - 2x + 2c\\arctan(x/c)$.\n$$ \\int_{-a}^{a} \\ln(x'^2+4h^2) \\,\\mathrm{d}x' = \\left[ x'\\ln(x'^2+4h^2) - 2x' + 4h\\arctan\\left(\\frac{x'}{2h}\\right) \\right]_{-a}^{a} $$\n$$ = 2a\\ln(a^2+4h^2) - 4a + 8h\\arctan\\left(\\frac{a}{2h}\\right) $$\nSubstituting this back into the expression for $M_{12}$:\n$$ M_{12} = -\\frac{1}{2\\pi\\varepsilon} \\left[ \\frac{1}{2}\\left(2a\\ln(a^2+4h^2) - 4a + 8h\\arctan\\left(\\frac{a}{2h}\\right)\\right) - 2a\\ln(L_0) \\right] $$\n$$ M_{12} = -\\frac{a}{\\pi\\varepsilon} \\left[ \\frac{1}{2}\\ln(a^2+4h^2) - 1 + \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right) - \\ln(L_0) \\right] $$\n$$ M_{12} = -\\frac{a}{\\pi\\varepsilon} \\left[ \\ln\\left(\\frac{\\sqrt{a^2+4h^2}}{L_0}\\right) - 1 + \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right) \\right] $$\nBy symmetry, $M_{21} = M_{12}$.\n\nThe system of equations is:\n$$ M_{11} \\lambda_1 + M_{12} \\lambda_2 = +\\frac{V_0}{2} $$\n$$ M_{12} \\lambda_1 + M_{11} \\lambda_2 = -\\frac{V_0}{2} $$\nAdding these two equations gives $(M_{11}+M_{12})(\\lambda_1+\\lambda_2)=0$. Since $M_{11}+M_{12} \\neq 0$ for any physical geometry, we must have $\\lambda_2 = -\\lambda_1$.\nSubstituting this into the first equation:\n$$ (M_{11} - M_{12})\\lambda_1 = \\frac{V_0}{2} \\implies \\lambda_1 = \\frac{V_0}{2(M_{11} - M_{12})} $$\nWe compute the difference $M_{11}-M_{12}$:\n$$ M_{11} - M_{12} = -\\frac{a}{\\pi\\varepsilon} \\left[ \\left(\\ln\\left(\\frac{a}{L_0}\\right) - 1\\right) - \\left(\\ln\\left(\\frac{\\sqrt{a^2+4h^2}}{L_0}\\right) - 1 + \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right)\\right) \\right] $$\n$$ = -\\frac{a}{\\pi\\varepsilon} \\left[ \\ln(a) - \\ln(L_0) - \\ln(\\sqrt{a^2+4h^2}) + \\ln(L_0) - \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right) \\right] $$\nThe arbitrary length $L_0$ cancels out, as it must for a physical quantity.\n$$ M_{11} - M_{12} = -\\frac{a}{\\pi\\varepsilon} \\left[ \\ln\\left(\\frac{a}{\\sqrt{a^2+4h^2}}\\right) - \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right) \\right] $$\n$$ = \\frac{a}{\\pi\\varepsilon} \\left[ \\ln\\left(\\frac{\\sqrt{a^2+4h^2}}{a}\\right) + \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right) \\right] $$\n$$ = \\frac{a}{\\pi\\varepsilon} \\left[ \\frac{1}{2}\\ln\\left(1+\\frac{4h^2}{a^2}\\right) + \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right) \\right] $$\nNow we find $\\lambda_1$:\n$$ \\lambda_1 = \\frac{V_0}{2} \\left( \\frac{\\pi\\varepsilon}{a \\left[ \\frac{1}{2}\\ln\\left(1+\\frac{4h^2}{a^2}\\right) + \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right) \\right]} \\right) $$\nThe capacitance per unit depth is $C' = Q'/V_0 = 2a\\lambda_1/V_0$.\n$$ C' = \\frac{2a}{V_0} \\lambda_1 = \\frac{a}{V_0} \\frac{V_0 \\pi\\varepsilon}{a \\left[ \\frac{1}{2}\\ln\\left(1+\\frac{4h^2}{a^2}\\right) + \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right) \\right]} $$\n$$ C' = \\frac{\\pi\\varepsilon}{\\frac{1}{2}\\ln\\left(1+\\frac{4h^2}{a^2}\\right) + \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right)} $$\nMultiplying numerator and denominator by $2$ to simplify the expression yields the final result.\n$$ C' = \\frac{2\\pi\\varepsilon}{\\ln\\left(1+\\frac{4h^2}{a^2}\\right) + \\frac{4h}{a}\\arctan\\left(\\frac{a}{2h}\\right)} $$\nThis expression gives the capacitance per unit depth in Farads per meter, depending only on $\\varepsilon$, $a$, and $h$, as required.\nThe result can be verified in the limit of an ideal parallel-plate capacitor where $a \\gg h$. Let $z=2h/a \\ll 1$. The denominator becomes $\\ln(1+z^2) + 2z \\arctan(1/z) \\approx z^2 + 2z(\\pi/2 - z) = \\pi z - z^2 \\approx \\pi z = 2\\pi h/a$.\nThus, $C' \\approx \\frac{2\\pi\\varepsilon}{2\\pi h/a} = \\varepsilon\\frac{a}{h}$, which is the correct formula for capacitance per unit depth of two parallel plates of width $2a$ and separation $2h$, neglecting fringing fields. The obtained formula correctly includes the fringing effects within the approximations of the model.", "answer": "$$\n\\boxed{\\frac{2\\pi\\varepsilon}{\\ln\\left(1+\\frac{4h^2}{a^2}\\right) + \\frac{4h}{a}\\arctan\\left(\\frac{a}{2h}\\right)}}\n$$", "id": "2374801"}, {"introduction": "Building on the previous example, we now tackle a classic interior problem on a closed boundary, which introduces more geometric complexity. This exercise involves constructing and solving a $4 \\times 4$ BEM system for a Laplace problem on a unit square domain [@problem_id:2374819]. You will gain valuable practice in calculating the distinct types of matrix influence coefficientsâ€”self, adjacent, and oppositeâ€”that arise in typical BEM discretizations.", "problem": "Consider the interior boundary value problem for Laplaceâ€™s equation in two dimensions ($2$D) on the unit square domain $\\Omega = (0,1)\\times(0,1)$ with boundary $\\Gamma = \\partial\\Omega$. Let $u$ denote the potential, and let $q = \\partial u/\\partial n$ denote the outward normal flux. Use the direct boundary integral equation for the Laplace operator with the two-dimensional free-space Greenâ€™s function\n$$\nG(\\mathbf{x},\\mathbf{y}) \\;=\\; -\\frac{1}{2\\pi}\\,\\ln|\\mathbf{x}-\\mathbf{y}|\\;,\n$$\nand adopt the standard interior convention $c(\\mathbf{x}) = \\tfrac{1}{2}$ at smooth boundary points $\\mathbf{x}\\in\\Gamma$. Discretize the boundary with one straight constant-strength element per side (four elements total), with collocation at each elementâ€™s midpoint. Index the elements as follows:\n- $\\Gamma_{1}:\\ \\{(s,0)\\,|\\,0\\le s\\le 1\\}$ with outward normal $\\mathbf{n}_{1}=(0,-1)$,\n- $\\Gamma_{2}:\\ \\{(1,s)\\,|\\,0\\le s\\le 1\\}$ with outward normal $\\mathbf{n}_{2}=(1,0)$,\n- $\\Gamma_{3}:\\ \\{(s,1)\\,|\\,0\\le s\\le 1\\}$ with outward normal $\\mathbf{n}_{3}=(0,1)$,\n- $\\Gamma_{4}:\\ \\{(0,s)\\,|\\,0\\le s\\le 1\\}$ with outward normal $\\mathbf{n}_{4}=(-1,0)$,\nand collocation points\n$$\n\\mathbf{x}_{1}=(\\tfrac{1}{2},0),\\quad \\mathbf{x}_{2}=(1,\\tfrac{1}{2}),\\quad \\mathbf{x}_{3}=(\\tfrac{1}{2},1),\\quad \\mathbf{x}_{4}=(0,\\tfrac{1}{2}).\n$$\nImpose Dirichlet data\n$$\nu=0\\ \\text{on}\\ \\Gamma_{1}\\cup\\Gamma_{4},\\qquad u=1\\ \\text{on}\\ \\Gamma_{2}\\cup\\Gamma_{3}.\n$$\nWith piecewise-constant $u$ and $q$ per element and collocation at the midpoints, assemble the resulting $4\\times 4$ linear system from first principles by evaluating the required boundary integrals exactly. Then solve the system for the four unknown element-constant outward fluxes $\\{q_{j}\\}_{j=1}^{4}$. Use principal values of inverse trigonometric functions in radians, and express your final result exactly (no numerical rounding) as a row matrix $(q_{1}\\ q_{2}\\ q_{3}\\ q_{4})$.", "solution": "The problem posed is a well-defined boundary value problem for the two-dimensional Laplace equation, to be solved using a direct boundary element method. All required data, including the geometry, boundary conditions, and discretization scheme, are provided. The problem is scientifically grounded, self-contained, and objective. It is therefore deemed valid and a solution will be provided.\n\nThe direct boundary integral equation (BIE) for an interior potential problem governed by Laplace's equation is given by\n$$c(\\mathbf{x}) u(\\mathbf{x}) + \\int_{\\Gamma} u(\\mathbf{y}) \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_y} \\, d\\Gamma_y = \\int_{\\Gamma} q(\\mathbf{y}) G(\\mathbf{x}, \\mathbf{y}) \\, d\\Gamma_y$$\nwhere $\\mathbf{x}$ is a point on the boundary $\\Gamma$, $c(\\mathbf{x})$ is the solid angle coefficient, $u$ is the potential, $q = \\partial u/\\partial n$ is the normal flux, and $G(\\mathbf{x},\\mathbf{y})$ is the free-space Green's function. For this problem, $G(\\mathbf{x},\\mathbf{y}) = -\\frac{1}{2\\pi}\\ln|\\mathbf{x}-\\mathbf{y}|$. The normal derivative of the Green's function is $\\frac{\\partial G}{\\partial n_y} = \\nabla_y G \\cdot \\mathbf{n}_y = -\\frac{1}{2\\pi} \\frac{(\\mathbf{y}-\\mathbf{x})\\cdot\\mathbf{n}_y}{|\\mathbf{y}-\\mathbf{x}|^2}$.\n\nThe boundary $\\Gamma$ is discretized into four constant-strength elements $\\Gamma_j$, with $j=1,2,3,4$. The potential $u$ and flux $q$ are assumed to be piecewise constant, $u_j$ and $q_j$, on each element $\\Gamma_j$. Applying the BIE at the mid-point $\\mathbf{x}_i$ of each element $\\Gamma_i$ yields a system of linear algebraic equations. Since the collocation points are at the midpoints of straight line segments, they are smooth points on the boundary, so $c(\\mathbf{x}_i) = 1/2$ for all $i$. The discretized BIE is:\n$$\\frac{1}{2} u_i + \\sum_{j=1}^{4} u_j \\left( \\int_{\\Gamma_j} \\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y})}{\\partial n_y} \\, d\\Gamma_y \\right) = \\sum_{j=1}^{4} q_j \\left( \\int_{\\Gamma_j} G(\\mathbf{x}_i, \\mathbf{y}) \\, d\\Gamma_y \\right)$$\nThis can be written in matrix form as $(\\mathbf{H} + \\frac{1}{2}\\mathbf{I})\\mathbf{u} = \\mathbf{G}\\mathbf{q}$, where the matrix entries are given by:\n$$H_{ij} = \\int_{\\Gamma_j} \\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y})}{\\partial n_y} \\, d\\Gamma_y \\quad \\text{and} \\quad G_{ij} = \\int_{\\Gamma_j} G(\\mathbf{x}_i, \\mathbf{y}) \\, d\\Gamma_y$$\nThe knowns are the potentials on each element, given by the Dirichlet boundary conditions: $u_1 = 0$, $u_2 = 1$, $u_3 = 1$, $u_4 = 0$. The vector of potentials is $\\mathbf{u} = (0, 1, 1, 0)^T$. The unknowns are the fluxes $\\mathbf{q} = (q_1, q_2, q_3, q_4)^T$.\n\nWe must now evaluate the matrix coefficients $H_{ij}$ and $G_{ij}$.\nDue to the square geometry and the choice of collocation points, the matrices $\\mathbf{H}$ and $\\mathbf{G}$ will exhibit a symmetric structure. We will have diagonal elements ($i=j$), adjacent elements (e.g., $i=1, j=2$), and opposite elements ($i=1, j=3$).\n\nCalculation of $H_{ij}$:\nFor a straight element, the vector $\\mathbf{y}-\\mathbf{x}_i$ is tangential to the element $\\Gamma_i$ when $i=j$. The normal vector $\\mathbf{n}_i$ is orthogonal to the element. Thus, $(\\mathbf{y}-\\mathbf{x}_i) \\cdot \\mathbf{n}_i = 0$, which implies $H_{ii} = 0$ for all $i=1,2,3,4$.\nFor off-diagonal elements, we compute the integrals. Let's compute the first row ($i=1$, with $\\mathbf{x}_1 = (1/2, 0)$).\n$H_{12}$: Integration over $\\Gamma_2$, where $\\mathbf{y}=(1,s)$ for $s\\in[0,1]$ and $\\mathbf{n}_2=(1,0)$.\n$H_{12} = -\\frac{1}{2\\pi} \\int_0^1 \\frac{((1,s)-(1/2,0))\\cdot(1,0)}{|(1,s)-(1/2,0)|^2} ds = -\\frac{1}{2\\pi} \\int_0^1 \\frac{1/2}{(1/2)^2+s^2} ds = -\\frac{1}{4\\pi} \\left[2\\arctan(2s)\\right]_0^1 = -\\frac{\\arctan(2)}{2\\pi}$.\n$H_{14}$: Integration over $\\Gamma_4$, where $\\mathbf{y}=(0,s)$ for $s\\in[0,1]$ and $\\mathbf{n}_4=(-1,0)$.\n$H_{14} = -\\frac{1}{2\\pi} \\int_0^1 \\frac{((0,s)-(1/2,0))\\cdot(-1,0)}{|(0,s)-(1/2,0)|^2} ds = -\\frac{1}{2\\pi} \\int_0^1 \\frac{1/2}{(-1/2)^2+s^2} ds = H_{12} = -\\frac{\\arctan(2)}{2\\pi}$.\n$H_{13}$: Integration over $\\Gamma_3$, where $\\mathbf{y}=(s,1)$ for $s\\in[0,1]$ and $\\mathbf{n}_3=(0,1)$.\n$H_{13} = -\\frac{1}{2\\pi} \\int_0^1 \\frac{((s,1)-(1/2,0))\\cdot(0,1)}{|(s,1)-(1/2,0)|^2} ds = -\\frac{1}{2\\pi} \\int_0^1 \\frac{1}{(s-1/2)^2+1^2} ds = -\\frac{1}{2\\pi} \\left[\\arctan(s-1/2)\\right]_0^1 = -\\frac{1}{2\\pi}(\\arctan(1/2)-\\arctan(-1/2)) = -\\frac{\\arctan(1/2)}{\\pi}$.\nBy symmetry, let $h_a = H_{12} = H_{14} = H_{21} = \\dots = -\\frac{\\arctan(2)}{2\\pi}$ and $h_o = H_{13} = H_{31} = \\dots = -\\frac{\\arctan(1/2)}{\\pi}$.\nThe matrix $\\mathbf{H}$ is:\n$\\mathbf{H} = \\begin{pmatrix} 0 & h_a & h_o & h_a \\\\ h_a & 0 & h_a & h_o \\\\ h_o & h_a & 0 & h_a \\\\ h_a & h_o & h_a & 0 \\end{pmatrix}$.\nNote that the sum of each row is $2h_a+h_o = -\\frac{\\arctan(2)}{\\pi} - \\frac{\\arctan(1/2)}{\\pi} = -\\frac{1}{\\pi}(\\arctan(2)+\\arctan(1/2)) = -\\frac{1}{\\pi}(\\frac{\\pi}{2}) = -1/2$, which satisfies the sum rule $\\sum_j H_{ij} = -c(\\mathbf{x}_i)$.\n\nCalculation of $G_{ij}$:\nWe use the general integral formula: $\\int \\ln(t^2+c^2)dt = t\\ln(t^2+c^2) - 2t + 2c\\arctan(t/c)$.\n$G_{11}$: Integration over $\\Gamma_1$, where $\\mathbf{y}=(s,0)$ for $s\\in[0,1]$.\n$G_{11} = -\\frac{1}{2\\pi}\\int_0^1 \\ln|s-1/2| ds = -\\frac{1}{2\\pi} (2 \\int_0^{1/2} \\ln(t) dt) = -\\frac{1}{\\pi}[t\\ln t - t]_0^{1/2} = -\\frac{1}{\\pi}(\\frac{1}{2}\\ln(1/2)-\\frac{1}{2}) = \\frac{1+\\ln 2}{2\\pi}$.\n$G_{12}$: Integration over $\\Gamma_2$, $\\mathbf{y}=(1,s)$, $s\\in[0,1]$.\n$G_{12} = -\\frac{1}{2\\pi} \\int_0^1 \\ln\\sqrt{(1/2)^2+s^2} ds = -\\frac{1}{4\\pi}\\int_0^1 \\ln(s^2+(1/2)^2) ds = -\\frac{1}{4\\pi}[s\\ln(s^2+1/4)-2s+\\arctan(2s)]_0^1 = -\\frac{1}{4\\pi}(\\ln(5/4)-2+\\arctan(2)) = \\frac{2-\\ln(5/4)-\\arctan(2)}{4\\pi}$.\n$G_{13}$: Integration over $\\Gamma_3$, $\\mathbf{y}=(s,1)$, $s\\in[0,1]$.\n$G_{13} = -\\frac{1}{2\\pi} \\int_0^1 \\ln\\sqrt{(s-1/2)^2+1^2} ds = -\\frac{1}{4\\pi}\\int_{-1/2}^{1/2} \\ln(t^2+1) dt = -\\frac{2}{4\\pi}\\int_0^{1/2} \\ln(t^2+1) dt = -\\frac{1}{2\\pi}[t\\ln(t^2+1)-2t+2\\arctan(t)]_0^{1/2} = -\\frac{1}{2\\pi}(\\frac{1}{2}\\ln(5/4)-1+2\\arctan(1/2)) = \\frac{1-\\frac{1}{2}\\ln(5/4)-2\\arctan(1/2)}{2\\pi}$.\nBy symmetry, let $g_d = G_{11} = G_{22} = \\dots = \\frac{1+\\ln 2}{2\\pi}$, $g_a = G_{12} = G_{14} = \\dots = \\frac{2-\\ln(5/4)-\\arctan(2)}{4\\pi}$, and $g_o = G_{13} = G_{31} = \\dots = \\frac{2-\\ln(5/4)-4\\arctan(1/2)}{4\\pi}$.\nThe matrix $\\mathbf{G}$ is:\n$\\mathbf{G} = \\begin{pmatrix} g_d & g_a & g_o & g_a \\\\ g_a & g_d & g_a & g_o \\\\ g_o & g_a & g_d & g_a \\\\ g_a & g_o & g_a & g_d \\end{pmatrix}$.\n\nNow we assemble and solve the system $\\mathbf{G}\\mathbf{q}=\\mathbf{v}$, where $\\mathbf{v} = (\\mathbf{H} + \\frac{1}{2}\\mathbf{I})\\mathbf{u}$.\nWith $\\mathbf{u}=(0,1,1,0)^T$:\n$v_1 = \\frac{1}{2}u_1 + H_{12}u_2 + H_{13}u_3 + H_{14}u_4 = h_a(1) + h_o(1) = h_a+h_o$.\n$v_2 = H_{21}u_1 + \\frac{1}{2}u_2 + H_{23}u_3 + H_{24}u_4 = \\frac{1}{2}(1) + h_a(1) = 1/2+h_a$.\n$v_3 = H_{31}u_1 + H_{32}u_2 + \\frac{1}{2}u_3 + H_{34}u_4 = h_a(1) + \\frac{1}{2}(1) = 1/2+h_a$.\n$v_4 = H_{41}u_1 + H_{42}u_2 + H_{43}u_3 + \\frac{1}{2}u_4 = h_o(1) + h_a(1) = h_a+h_o$.\nSo, $\\mathbf{v} = (h_a+h_o, 1/2+h_a, 1/2+h_a, h_a+h_o)^T$.\n\nThe problem has reflectional symmetry about the line $y=x$. The boundary conditions respect this symmetry. Therefore, the solution for the fluxes must also be symmetric: $q_1=q_4$ and $q_2=q_3$. Let $q_1=q_4=A$ and $q_2=q_3=B$. The $4 \\times 4$ system reduces to a $2 \\times 2$ system:\n\\begin{align*} (g_d+g_a)A + (g_a+g_o)B &= h_a+h_o \\\\ (g_a+g_o)A + (g_d+g_a)B &= 1/2+h_a \\end{align*}\nSubtracting the two equations gives:\n$((g_d+g_a)-(g_a+g_o))A + ((g_a+g_o)-(g_d+g_a))B = (h_a+h_o)-(1/2+h_a)$\n$(g_d-g_o)A - (g_d-g_o)B = h_o-1/2$\n$(g_d-g_o)(A-B) = h_o-1/2$.\nAdding the two equations gives:\n$((g_d+g_a)+(g_a+g_o))(A+B) = (h_a+h_o) + (1/2+h_a)$\n$(g_d+2g_a+g_o)(A+B) = 1/2+2h_a+h_o$.\nSince $2h_a+h_o = -1/2$, the right side is $0$. The sum $g_d+2g_a+g_o$ is non-zero, hence we must have $A+B=0$, so $B=-A$. This is consistent with the physical requirement that the total flux out of the source-free domain is zero: $\\sum q_j L_j = q_1(1)+q_2(1)+q_3(1)+q_4(1) = A+B+B+A = 2(A+B)=0$.\nSubstituting $B=-A$ into the first equation of the $2 \\times 2$ system:\n$(g_d+g_a)A - (g_a+g_o)A = h_a+h_o$\n$(g_d-g_o)A = h_a+h_o \\implies A = \\frac{h_a+h_o}{g_d-g_o}$.\nWe compute the numerator and denominator.\n$h_a+h_o = -\\frac{\\arctan(2)}{2\\pi} - \\frac{\\arctan(1/2)}{\\pi} = -\\frac{1}{2\\pi}(\\arctan(2)+2\\arctan(1/2))$. Using the identity $\\arctan(2)+\\arctan(1/2)=\\pi/2$, so $\\arctan(2)=\\pi/2-\\arctan(1/2)$, we get:\n$h_a+h_o = -\\frac{1}{2\\pi}(\\pi/2 - \\arctan(1/2) + 2\\arctan(1/2)) = -\\frac{1}{2\\pi}(\\frac{\\pi}{2}+\\arctan(1/2))$.\nFor the denominator:\n$g_d=\\frac{1+\\ln 2}{2\\pi}$ and $g_o=\\frac{2-\\ln(5/4)-4\\arctan(1/2)}{4\\pi}=\\frac{1-\\frac{1}{2}(\\ln 5 - 2\\ln 2)-2\\arctan(1/2)}{2\\pi}$.\n$g_d-g_o = \\frac{1}{2\\pi}[(1+\\ln 2) - (1-\\frac{1}{2}\\ln 5 + \\ln 2-2\\arctan(1/2))] = \\frac{1}{2\\pi}(\\frac{1}{2}\\ln 5 + 2\\arctan(1/2))$.\nThus,\n$A = \\frac{-\\frac{1}{2\\pi}(\\frac{\\pi}{2}+\\arctan(1/2))}{\\frac{1}{2\\pi}(\\frac{1}{2}\\ln 5+2\\arctan(1/2))} = -\\frac{\\frac{\\pi}{2}+\\arctan(1/2)}{\\frac{1}{2}\\ln 5+2\\arctan(1/2)}$.\nThe fluxes are then:\n$q_1=q_4=A = -\\frac{\\pi/2+\\arctan(1/2)}{1/2\\ln 5+2\\arctan(1/2)}$\n$q_2=q_3=B=-A = \\frac{\\pi/2+\\arctan(1/2)}{1/2\\ln 5+2\\arctan(1/2)}$.\n\nThe final result is the row matrix $(q_1 \\ q_2 \\ q_3 \\ q_4)$.\nLet the constant $C = \\frac{\\frac{\\pi}{2}+\\arctan(\\frac{1}{2})}{\\frac{1}{2}\\ln 5+2\\arctan(\\frac{1}{2})} = \\frac{\\pi+2\\arctan(\\frac{1}{2})}{\\ln 5+4\\arctan(\\frac{1}{2})}$.\nThen $q_1 = -C$, $q_2 = C$, $q_3 = C$, $q_4 = -C$.\nThe final answer is presented below.", "answer": "$$ \\boxed{ \\begin{pmatrix} -\\frac{\\pi+2\\arctan(\\frac{1}{2})}{\\ln 5+4\\arctan(\\frac{1}{2})} & \\frac{\\pi+2\\arctan(\\frac{1}{2})}{\\ln 5+4\\arctan(\\frac{1}{2})} & \\frac{\\pi+2\\arctan(\\frac{1}{2})}{\\ln 5+4\\arctan(\\frac{1}{2})} & -\\frac{\\pi+2\\arctan(\\frac{1}{2})}{\\ln 5+4\\arctan(\\frac{1}{2})} \\end{pmatrix} } $$", "id": "2374819"}, {"introduction": "The previous exercises demonstrated the importance of evaluating boundary integrals. This final practice transitions from manual calculation to computational implementation by focusing on the most critical and challenging part of a 2D BEM code: the integration of the singular kernel [@problem_id:2377305]. You will derive the analytical formula for the logarithmic potential integral and implement it in a robust computer program, a crucial skill for developing your own BEM solvers.", "problem": "Consider the two-dimensional logarithmic kernel of the Laplace equation, defined as the scalar function $K(\\mathbf{x},\\mathbf{x}_0) = \\ln r$, where $r = \\|\\mathbf{x} - \\mathbf{x}_0\\|$ is the Euclidean distance between a source point $\\mathbf{x}$ and a field point $\\mathbf{x}_0$. For a straight-line constant element, let the element be the line segment $\\Gamma$ joining endpoints $\\mathbf{A} = (x_1, y_1)$ and $\\mathbf{B} = (x_2, y_2)$ in the plane, and let the field point be $\\mathbf{P} = (x_f, y_f)$. Define the line integral\n$$\nI(\\mathbf{A}, \\mathbf{B}, \\mathbf{P}) = \\int_{\\Gamma} \\ln\\!\\left(\\frac{\\|\\mathbf{x} - \\mathbf{P}\\|}{L_0}\\right)\\, d\\ell,\n$$\nwhere $d\\ell$ is the line element along $\\Gamma$, and $L_0$ is a fixed reference length introduced to render the logarithm argument dimensionless. All distances must be measured in meters, and use $L_0 = 1\\,\\mathrm{m}$. The quantity $I(\\mathbf{A}, \\mathbf{B}, \\mathbf{P})$ has units of meters.\n\nTasks:\n- Starting from first principles, derive a closed-form expression for $I(\\mathbf{A}, \\mathbf{B}, \\mathbf{P})$ valid for any non-degenerate straight segment $\\Gamma$ and for any field point $\\mathbf{P}$ in the plane, including the limiting case where the perpendicular distance from $\\mathbf{P}$ to the line of the segment is zero and the projection of $\\mathbf{P}$ onto the line lies within the segment.\n- Implement a program that evaluates $I(\\mathbf{A}, \\mathbf{B}, \\mathbf{P})$ using the derived closed-form expression for the following test suite, where all coordinates are in meters:\n  - Test $1$: $\\mathbf{A} = (0,0)$, $\\mathbf{B} = (1,0)$, $\\mathbf{P} = (0.3,0.4)$.\n  - Test $2$: $\\mathbf{A} = (0,0)$, $\\mathbf{B} = (1,0)$, $\\mathbf{P} = (0.3,0)$.\n  - Test $3$: $\\mathbf{A} = (0,0)$, $\\mathbf{B} = (1,0)$, $\\mathbf{P} = (0.3,10^{-12})$.\n  - Test $4$: $\\mathbf{A} = (0,0)$, $\\mathbf{B} = (1,0)$, $\\mathbf{P} = (-0.5,0)$.\n  - Test $5$: $\\mathbf{A} = (1,2)$, $\\mathbf{B} = (4,6)$, $\\mathbf{P} = (3,3)$.\n  - Test $6$: $\\mathbf{A} = (0,0)$, $\\mathbf{B} = (10^{-9},0)$, $\\mathbf{P} = (0,1)$.\n  - Test $7$: $\\mathbf{A} = (0,0)$, $\\mathbf{B} = (1,0)$, $\\mathbf{P} = (1,0)$.\n\nAngle units, when applicable in any intermediate expression (for example, an inverse tangent), must be in radians. The final numeric results must be expressed in meters.\n\nYour program must produce a single line of output containing the results for Tests $1$ through $7$ as a comma-separated list of decimal numbers with exactly $12$ digits after the decimal point, enclosed in square brackets. For example, the output format must be\n$[r_1,r_2,r_3,r_4,r_5,r_6,r_7]$\nwhere each $r_k$ is a float in meters corresponding to Test $k$, formatted to $12$ digits after the decimal point. No additional output is permitted.", "solution": "The problem is subjected to validation and is deemed valid. It is scientifically grounded, well-posed, and objective. The problem statement is complete, consistent, and formalizable. The integral is a standard element in two-dimensional potential theory and boundary element methods. The logarithmic singularity is integrable, ensuring the problem is well-posed even when the evaluation point lies on the integration path.\n\nThe problem requires the derivation and implementation of a closed-form solution for the integral:\n$$\nI(\\mathbf{A}, \\mathbf{B}, \\mathbf{P}) = \\int_{\\Gamma} \\ln\\!\\left(\\frac{\\|\\mathbf{x} - \\mathbf{P}\\|}{L_0}\\right)\\, d\\ell\n$$\nGiven the reference length $L_0=1$, the argument of the logarithm becomes dimensionless. Since $\\ln(1)=0$, we have $\\ln(\\|\\mathbf{x} - \\mathbf{P}\\|/L_0) = \\ln(\\|\\mathbf{x} - \\mathbf{P}\\|) - \\ln(L_0) = \\ln(\\|\\mathbf{x} - \\mathbf{P}\\|)$. Let $r = \\|\\mathbf{x} - \\mathbf{P}\\|$. The integral simplifies to:\n$$\nI = \\int_{\\Gamma} \\ln r \\, d\\ell\n$$\n\nTo solve this integral, we establish a local coordinate system $(\\xi, \\eta)$ for the line segment $\\Gamma$. Let the origin be at point $\\mathbf{A}$, and let the $\\xi$-axis be aligned with the vector from $\\mathbf{A}$ to $\\mathbf{B}$. The length of the segment is $L = \\|\\mathbf{B} - \\mathbf{A}\\|$. A point $\\mathbf{x}$ on the segment can be parameterized by $\\xi \\in [0, L]$. The line element is $d\\ell = d\\xi$.\n\nThe unit tangent vector along the segment is $\\mathbf{t} = (\\mathbf{B} - \\mathbf{A})/L$. The unit normal vector, rotated counter-clockwise from $\\mathbf{t}$, is $\\mathbf{n}$. The field point $\\mathbf{P}$ can be described in this local system by coordinates $(\\xi_p, \\eta_p)$, which are the projections of the vector $\\mathbf{P} - \\mathbf{A}$ onto the local axes:\n$$\n\\xi_p = (\\mathbf{P} - \\mathbf{A}) \\cdot \\mathbf{t}\n$$\n$$\n\\eta_p = (\\mathbf{P} - \\mathbf{A}) \\cdot \\mathbf{n}\n$$\nThe distance $r$ from a point $\\mathbf{x}(\\xi)$ on the segment (with local coordinates $(\\xi, 0)$) to the field point $\\mathbf{P}$ (with local coordinates $(\\xi_p, \\eta_p)$) is given by:\n$$\nr = \\sqrt{(\\xi - \\xi_p)^2 + \\eta_p^2}\n$$\nThe integral becomes:\n$$\nI = \\int_{0}^{L} \\ln \\sqrt{(\\xi - \\xi_p)^2 + \\eta_p^2} \\, d\\xi = \\frac{1}{2} \\int_{0}^{L} \\ln \\left( (\\xi - \\xi_p)^2 + \\eta_p^2 \\right) \\, d\\xi\n$$\n\nWe solve the indefinite integral $J(\\xi) = \\int \\ln \\left( (\\xi - \\xi_p)^2 + \\eta_p^2 \\right) \\, d\\xi$ using integration by parts, $\\int u \\, dv = uv - \\int v \\, du$. Let $u = \\ln((\\xi - \\xi_p)^2 + \\eta_p^2)$ and $dv = d\\xi$. We choose $v = \\xi - \\xi_p$ for convenience. Then $du = \\frac{2(\\xi - \\xi_p)}{(\\xi - \\xi_p)^2 + \\eta_p^2} d\\xi$.\n$$\nJ(\\xi) = (\\xi - \\xi_p) \\ln \\left( (\\xi - \\xi_p)^2 + \\eta_p^2 \\right) - \\int (\\xi - \\xi_p) \\frac{2(\\xi - \\xi_p)}{(\\xi - \\xi_p)^2 + \\eta_p^2} \\, d\\xi\n$$\nThe remaining integral is evaluated by substitution. Let $s = \\xi - \\xi_p$:\n$$\n\\int \\frac{2s^2}{s^2 + \\eta_p^2} \\, ds = \\int \\frac{2(s^2 + \\eta_p^2) - 2\\eta_p^2}{s^2 + \\eta_p^2} \\, ds = \\int \\left( 2 - \\frac{2\\eta_p^2}{s^2 + \\eta_p^2} \\right) ds\n$$\n$$\n= 2s - 2\\eta_p^2 \\int \\frac{1}{s^2 + \\eta_p^2} ds = 2s - 2\\eta_p \\arctan\\left(\\frac{s}{\\eta_p}\\right)\n$$\nThis holds for any sign of $\\eta_p \\neq 0$. Substituting back $s = \\xi - \\xi_p$:\n$$\nJ(\\xi) = (\\xi - \\xi_p) \\ln\\left( (\\xi - \\xi_p)^2 + \\eta_p^2 \\right) - 2(\\xi - \\xi_p) + 2\\eta_p \\arctan\\left(\\frac{\\xi - \\xi_p}{\\eta_p}\\right)\n$$\nThe definite integral is $I = \\frac{1}{2}[J(L) - J(0)]$. Let $R_A = \\|\\mathbf{P} - \\mathbf{A}\\| = \\sqrt{\\xi_p^2 + \\eta_p^2}$ and $R_B = \\|\\mathbf{P} - \\mathbf{B}\\| = \\sqrt{(L-\\xi_p)^2 + \\eta_p^2}$.\n$$\nJ(L) = (L-\\xi_p)\\ln(R_B^2) - 2(L-\\xi_p) + 2\\eta_p \\arctan\\left(\\frac{L-\\xi_p}{\\eta_p}\\right)\n$$\n$$\nJ(0) = (-\\xi_p)\\ln(R_A^2) - 2(-\\xi_p) + 2\\eta_p \\arctan\\left(\\frac{-\\xi_p}{\\eta_p}\\right)\n$$\nSubtracting and simplifying gives:\n$$\nI = (L - \\xi_p) \\ln R_B + \\xi_p \\ln R_A - L + \\eta_p \\left( \\arctan\\left(\\frac{L - \\xi_p}{\\eta_p}\\right) - \\arctan\\left(\\frac{-\\xi_p}{\\eta_p}\\right) \\right)\n$$\nUsing the identity $\\arctan(-x) = -\\arctan(x)$, the expression simplifies to:\n$$\nI = (L - \\xi_p) \\ln R_B + \\xi_p \\ln R_A - L + \\eta_p \\left( \\arctan\\left(\\frac{L - \\xi_p}{\\eta_p}\\right) + \\arctan\\left(\\frac{\\xi_p}{\\eta_p}\\right) \\right)\n$$\nThis expression is an even function of $\\eta_p$, since for $\\eta_p < 0$, the initial factor $\\eta_p$ is negative, but each $\\arctan$ term also flips sign, resulting in the same value. Thus, we can write the formula using $|\\eta_p|$ to emphasize this symmetry:\n$$\nI = (L - \\xi_p) \\ln R_B + \\xi_p \\ln R_A - L + |\\eta_p| \\left( \\arctan\\left(\\frac{L - \\xi_p}{|\\eta_p|}\\right) + \\arctan\\left(\\frac{\\xi_p}{|\\eta_p|}\\right) \\right)\n$$\n\nNow, consider the limiting case where $\\mathbf{P}$ lies on the line containing the segment $\\Gamma$, i.e., $\\eta_p = 0$. We evaluate the integral directly for this case:\n$$\nI = \\int_0^L \\ln|\\xi - \\xi_p| \\, d\\xi\n$$\nUsing the antiderivative of $\\ln|u|$, which is $u \\ln|u| - u$:\n$$\nI = \\left[ (\\xi - \\xi_p) \\ln|\\xi - \\xi_p| - (\\xi - \\xi_p) \\right]_0^L\n$$\n$$\n= \\left((L - \\xi_p)\\ln|L - \\xi_p| - (L - \\xi_p)\\right) - \\left((-\\xi_p)\\ln|-\\xi_p| - (-\\xi_p)\\right)\n$$\n$$\nI = (L - \\xi_p)\\ln|L - \\xi_p| + \\xi_p\\ln|\\xi_p| - L\n$$\nThis expression is also the limit of the general formula as $\\eta_p \\to 0$, since $\\lim_{y \\to 0} y \\arctan(K/y) = 0$. When implementing, care must be taken for the cases where the argument of the logarithm is zero (i.e., $\\xi_p=0$ or $\\xi_p=L$). In these cases, the term $x \\ln|x|$ must be evaluated as its limit, which is $0$.\n\nThe implementation will use these two formulae. A small numerical tolerance on $|\\eta_p|/L$ is used to select between the general formula and the numerically more stable collinear case formula.\nThe coordinates of $\\mathbf{P}$ in the local system are computed as:\n$L = \\sqrt{(x_2-x_1)^2 + (y_2-y_1)^2}$\n$\\xi_p = \\frac{(x_f-x_1)(x_2-x_1) + (y_f-y_1)(y_2-y_1)}{L}$\n$\\eta_p = \\frac{(y_f-y_1)(x_2-x_1) - (x_f-x_1)(y_2-y_1)}{L}$\nThe quantity $(y_f-y_1)(x_2-x_1) - (x_f-x_1)(y_2-y_1)$ is related to the 2D vector cross product and represents the signed area of the parallelogram formed by vectors $\\mathbf{P}-\\mathbf{A}$ and $\\mathbf{B}-\\mathbf{A}$.", "answer": "```python\nimport numpy as np\n\ndef _x_times_log_abs_x(x):\n    \"\"\"\n    Calculates x * log(|x|) with a safeguard for x=0.\n    The limit of x*log|x| as x approaches 0 is 0.\n    \"\"\"\n    if np.abs(x) < 1e-30:\n        return 0.0\n    return x * np.log(np.abs(x))\n\ndef calculate_integral(A_coords, B_coords, P_coords):\n    \"\"\"\n    Calculates the integral I = integral over Gamma of ln(r) dl,\n    where Gamma is the line segment from A to B and r is the distance from a point on Gamma to P.\n    \n    Args:\n        A_coords (tuple): Coordinates of point A (x1, y1).\n        B_coords (tuple): Coordinates of point B (x2, y2).\n        P_coords (tuple): Coordinates of field point P (xf, yf).\n\n    Returns:\n        float: The value of the integral.\n    \"\"\"\n    A = np.array(A_coords, dtype=np.float64)\n    B = np.array(B_coords, dtype=np.float64)\n    P = np.array(P_coords, dtype=np.float64)\n\n    vec_AB = B - A\n    L_sq = vec_AB.dot(vec_AB)\n\n    # If the segment is a point (degenerate), the integral is zero.\n    if L_sq < 1e-30:\n        return 0.0\n    \n    L = np.sqrt(L_sq)\n    vec_AP = P - A\n\n    # Project P onto the local coordinate system of the segment.\n    # xi_p is the coordinate along the segment.\n    xi_p = vec_AP.dot(vec_AB) / L\n    \n    # eta_p is the perpendicular distance from P to the line containing the segment.\n    # It is calculated using the 2D cross product equivalent.\n    # The sign convention here corresponds to a normal vector obtained by a\n    # counter-clockwise rotation of the tangent vector.\n    # However, the final formula is independent of the sign of eta_p.\n    cross_prod = vec_AP[0] * vec_AB[1] - vec_AP[1] * vec_AB[0]\n    eta_p = -cross_prod / L\n\n    # Check for collinearity using a relative tolerance.\n    # If P is on (or very close to) the line containing the segment.\n    if np.abs(eta_p) / L < 1e-15:\n        term1 = _x_times_log_abs_x(L - xi_p)\n        term2 = _x_times_log_abs_x(xi_p)\n        return term1 + term2 - L\n    else:\n        # General case where P is not on the line.\n        abs_eta_p = np.abs(eta_p)\n        \n        # Distances from P to endpoints A and B.\n        # Calculated using local coordinates for robustness.\n        R_A = np.sqrt(xi_p**2 + eta_p**2)\n        R_B = np.sqrt((L - xi_p)**2 + eta_p**2)\n\n        term_log_A = xi_p * np.log(R_A)\n        term_log_B = (L - xi_p) * np.log(R_B)\n        \n        # Arctangent term.\n        arg1 = (L - xi_p) / abs_eta_p\n        arg2 = xi_p / abs_eta_p\n        term_atan = abs_eta_p * (np.arctan(arg1) + np.arctan(arg2))\n        \n        return term_log_A + term_log_B - L + term_atan\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test cases and prints the results\n    in the required format.\n    \"\"\"\n    test_cases = [\n        # Test 1: General case\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (0.3, 0.4)},\n        # Test 2: P on the segment\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (0.3, 0.0)},\n        # Test 3: P very close to the segment\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (0.3, 1e-12)},\n        # Test 4: P on line extension\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (-0.5, 0.0)},\n        # Test 5: General segment and point\n        {'A': (1.0, 2.0), 'B': (4.0, 6.0), 'P': (3.0, 3.0)},\n        # Test 6: Very short segment\n        {'A': (0.0, 0.0), 'B': (1e-9, 0.0), 'P': (0.0, 1.0)},\n        # Test 7: P at an endpoint\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (1.0, 0.0)},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_integral(case['A'], case['B'], case['P'])\n        results.append(f\"{result:.12f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2377305"}]}