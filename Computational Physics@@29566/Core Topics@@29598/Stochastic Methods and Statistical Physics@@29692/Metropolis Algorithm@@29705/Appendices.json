{"hands_on_practices": [{"introduction": "The Metropolis algorithm is best understood by walking through its core steps. This first practice invites you to do just that using a classic 2x2 Ising model, a fundamental system in statistical physics. By manually calculating the energy change, $\\Delta E$, from a proposed spin flip and applying the acceptance rule, you will gain a concrete understanding of the algorithm's decision-making process at the microscopic level [@problem_id:2005989].", "problem": "Consider a simplified model of a magnetic material represented by a 2x2 square lattice of four classical spins. The spins are located at positions $(i,j)$ where $i,j \\in \\{1, 2\\}$, and are denoted as $s_{ij}$. Each spin can only point in one of two directions, represented by the values $s_{ij} = +1$ or $s_{ij} = -1$. The total energy of the system is given by the ferromagnetic Ising Hamiltonian:\n$$H = -J \\sum_{\\langle (ij), (kl) \\rangle} s_{ij} s_{kl}$$\nwhere the sum runs over all unique pairs of nearest-neighboring spins on the lattice, and $J$ is a positive coupling constant. The system is initially in the ferromagnetic ground state, where all four spins are aligned: $s_{11} = s_{12} = s_{21} = s_{22} = +1$.\n\nThe system evolves through a Monte Carlo simulation in contact with a heat bath at a fixed temperature $T$. The simulation proceeds in discrete steps. At each step, a single spin is chosen and an attempt is made to flip it (i.e., change its sign). The change in energy, $\\Delta E$, resulting from the proposed flip is calculated.\n- If $\\Delta E \\le 0$, the flip is always accepted.\n- If $\\Delta E > 0$, the flip is accepted with a probability $P = \\exp(-\\Delta E / (k_B T))$, where $k_B$ is the Boltzmann constant.\n\nTo make the process deterministic for this problem, the probabilistic decision is handled as follows: for the $k$-th move that requires such a decision, the move is accepted if and only if the calculated probability $P$ is greater than a provided comparison value $R_k$.\n\nThe system is at a temperature such that the thermal energy is given by $k_B T = \\frac{4J}{\\ln 2}$. Two steps of the simulation are performed according to the following sequence:\n1.  An attempt is made to flip the spin $s_{11}$. The comparison value for this step, if needed, is $R_1 = 0.4$.\n2.  Starting from the configuration resulting from the first step, an attempt is made to flip the spin $s_{22}$. The comparison value for this step, if needed, is $R_2 = 0.4$.\n\nCalculate the final energy of the system, $H_{\\text{final}}/J$, after these two steps. Your answer should be a single integer.", "solution": "We consider a 2x2 lattice with open boundary conditions so that the sum over unique nearest-neighbor pairs includes exactly the four bonds: $(11)-(12)$, $(11)-(21)$, $(12)-(22)$, and $(21)-(22)$. The Ising Hamiltonian is $H=-J\\sum_{\\langle (ij),(kl)\\rangle}s_{ij}s_{kl}$ with $J>0$. In the fully aligned initial state, each pair has $s_{ij}s_{kl}=+1$, hence the initial energy is\n$$\nH_{0}=-J\\,(1+1+1+1)=-4J.\n$$\n\nA single-spin flip at site $p$ changes only the bonds touching that site. The standard result for the energy change is\n$$\n\\Delta E=2J\\,s_{p}\\sum_{q\\in \\text{nn}(p)}s_{q},\n$$\nwhere the sum is over the nearest neighbors of $p$. The Metropolis acceptance probability for $\\Delta E>0$ is $P=\\exp\\!\\big(-\\Delta E/(k_{B}T)\\big)$, with the deterministic rule here: accept if and only if $P>R_{k}$.\n\nStep 1: Propose flipping $s_{11}$. Its neighbors are $s_{12}$ and $s_{21}$, both initially $+1$, and $s_{11}=+1$. Thus\n$$\n\\Delta E_{1}=2J\\,(+1)\\big[(+1)+(+1)\\big]=4J>0.\n$$\nWith $k_{B}T=\\frac{4J}{\\ln 2}$, the acceptance probability is\n$$\nP_{1}=\\exp\\!\\left(-\\frac{\\Delta E_{1}}{k_{B}T}\\right)=\\exp\\!\\left(-\\frac{4J}{4J/\\ln 2}\\right)=\\exp(-\\ln 2)=2^{-1}.\n$$\nSince $2^{-1}=0.5>R_{1}=0.4$, the flip is accepted. The new energy is\n$$\nH_{1}=H_{0}+\\Delta E_{1}=-4J+4J=0.\n$$\n\nStep 2: Starting from this configuration, propose flipping $s_{22}$. Its neighbors are $s_{12}=+1$ and $s_{21}=+1$, and $s_{22}=+1$, so\n$$\n\\Delta E_{2}=2J\\,(+1)\\big[(+1)+(+1)\\big]=4J>0.\n$$\nThe acceptance probability is the same as before,\n$$\nP_{2}=\\exp\\!\\left(-\\frac{4J}{4J/\\ln 2}\\right)=2^{-1}.\n$$\nSince $2^{-1}=0.5>R_{2}=0.4$, this flip is accepted. Therefore, the final energy is\n$$\nH_{\\text{final}}=H_{1}+\\Delta E_{2}=0+4J=4J,\n$$\nso\n$$\n\\frac{H_{\\text{final}}}{J}=4.\n$$", "answer": "$$\\boxed{4}$$", "id": "2005989"}, {"introduction": "Translating an algorithm from theory to functional code often reveals subtle but powerful efficiencies. This exercise challenges you to analyze a common and compact implementation of the Metropolis acceptance criterion. By critically examining how a single conditional statement handles both energy-increasing and energy-decreasing moves, you will deepen your understanding of the probabilistic logic that drives the simulation toward equilibrium [@problem_id:1964945].", "problem": "A student, Alex, is writing a Metropolis Monte Carlo simulation for a simple 2D lattice gas model. In this model, particles occupy sites on a grid, and the total energy $E$ of the system is calculated based on the interactions between neighboring particles. The goal of the simulation is to sample configurations from the canonical ensemble at a given temperature $T$.\n\nAlex's simulation proceeds in steps. At each step, a trial move is proposed (e.g., moving a single particle to a random adjacent empty site). Let the energy of the current configuration be $E_{old}$ and the energy of the proposed new configuration be $E_{new}$. The change in energy is $\\Delta E = E_{new} - E_{old}$.\n\nAlex implements the core acceptance/rejection logic with the following line of pseudo-code, where `rand()` is a function that returns a uniformly distributed random floating-point number from the interval $[0, 1)$. The move is accepted if the condition is true.\n\n`if rand()  exp(-ΔE / (k_B * T))`\n\nHere, $k_B$ is the Boltzmann constant. Alex runs the simulation and finds that the system seems to be reaching a reasonable equilibrium state. However, they are concerned because their code does not contain an explicit `if/else` structure to distinguish between moves that increase energy ($\\Delta E > 0$) and moves that decrease energy ($\\Delta E \\le 0$), which is how the algorithm was presented in their textbook.\n\nWhich of the following statements provides the most accurate analysis of Alex's implementation?\n\nA. The code is fundamentally flawed because it will never accept moves that lower the system's energy ($\\Delta E \\le 0$).\n\nB. The code is fundamentally flawed because it accepts all proposed moves, regardless of the energy change, preventing the system from reaching thermal equilibrium.\n\nC. The code functions correctly because for any move that lowers the energy ($\\Delta E \\le 0$), the term $\\exp(-\\Delta E / (k_B T))$ evaluates to a value greater than or equal to 1, ensuring the acceptance condition is always met.\n\nD. The code is only correct in the high-temperature limit ($k_B T \\gg |\\Delta E|$), where the exponential term can be approximated as 1, but it fails at low temperatures.\n\nE. The code is fundamentally flawed because it violates the principle of detailed balance by not explicitly handling the case where $\\Delta E \\le 0$ with an acceptance probability of 1.", "solution": "Let $\\beta$ denote the inverse temperature, $\\beta = \\frac{1}{k_{B}T}$. In the Metropolis algorithm with a symmetric proposal distribution, the acceptance probability that ensures sampling from the canonical ensemble and satisfies detailed balance is\n$$\nA(\\Delta E) = \\min\\!\\left(1,\\exp(-\\beta \\Delta E)\\right).\n$$\nAlex’s code accepts the move if a uniform random variate $r \\sim \\text{Uniform}[0,1)$ satisfies\n$$\nr  \\exp(-\\beta \\Delta E).\n$$\nThe acceptance probability realized by this rule is the probability, with respect to $r$, that the event $\\{r  \\exp(-\\beta \\Delta E)\\}$ occurs. Since $r$ is uniform on $[0,1)$,\n$$\nP(\\text{accept}) = \\int_{0}^{1} \\mathbf{1}\\{r  \\exp(-\\beta \\Delta E)\\} \\, dr.\n$$\nThis integral evaluates piecewise, depending on the value of $\\exp(-\\beta \\Delta E)$ relative to $1$:\n\n1) If $\\Delta E \\le 0$, then $-\\beta \\Delta E \\ge 0$, hence\n$$\n\\exp(-\\beta \\Delta E) \\ge 1.\n$$\nBecause $r \\in [0,1)$ and $\\exp(-\\beta \\Delta E) \\ge 1$, the inequality $r  \\exp(-\\beta \\Delta E)$ holds for all $r$ in $[0,1)$. Therefore,\n$$\nP(\\text{accept}) = 1 = \\min\\!\\left(1,\\exp(-\\beta \\Delta E)\\right).\n$$\nIn particular, when $\\Delta E = 0$, $\\exp(0) = 1$ and, since $r  1$ almost surely for $r \\in [0,1)$, acceptance occurs with probability $1$, as required.\n\n2) If $\\Delta E  0$, then $-\\beta \\Delta E  0$, hence\n$$\n\\exp(-\\beta \\Delta E)  1,\n$$\nand the event $\\{r  \\exp(-\\beta \\Delta E)\\}$ occurs with probability exactly $\\exp(-\\beta \\Delta E)$, because the length of the interval $\\{r \\in [0,1) : r  \\exp(-\\beta \\Delta E)\\}$ is $\\exp(-\\beta \\Delta E)$. Thus,\n$$\nP(\\text{accept}) = \\exp(-\\beta \\Delta E) = \\min\\!\\left(1,\\exp(-\\beta \\Delta E)\\right).\n$$\n\nCombining these cases,\n$$\nP(\\text{accept}) = \\min\\!\\left(1,\\exp(-\\beta \\Delta E)\\right),\n$$\nwhich is precisely the Metropolis acceptance rule that enforces detailed balance for a symmetric proposal. Therefore, Alex’s single-line condition implicitly implements the $\\min$ operation because $r$ is restricted to $[0,1)$. It accepts all energy-lowering or equal-energy moves with probability $1$ and accepts energy-increasing moves with probability $\\exp(-\\beta \\Delta E)$. Consequently:\n- It is not the case that energy-lowering moves are rejected (rejects A).\n- It does not accept all moves (rejects B).\n- It is not limited to the high-temperature regime (rejects D).\n- It does not violate detailed balance; the correct acceptance probability is realized (rejects E).\n\nHence, the most accurate statement is that the code functions correctly for all temperatures because $\\exp(-\\Delta E/(k_{B}T)) \\ge 1$ when $\\Delta E \\le 0$, ensuring acceptance, and yields the correct probabilistic acceptance when $\\Delta E > 0$.", "answer": "$$\\boxed{C}$$", "id": "1964945"}, {"introduction": "After mastering the mechanics of individual steps, it is crucial to understand the algorithm's ultimate purpose: to sample states according to the Boltzmann distribution, where the probability of a state $i$ is $P_i \\propto \\exp(-E_i / k_B T)$. This practice shifts the focus from the process to the outcome, asking you to calculate the equilibrium probability of a particle's location on a discrete energy landscape. This exercise solidifies the connection between the microscopic rules of the simulation and the macroscopic thermodynamic properties they produce [@problem_id:2005992].", "problem": "A computational model is used to study the behavior of a single classical particle trapped on a discrete energy landscape. The landscape consists of the eight vertices of a cube, labeled $v_1$ through $v_8$. Each vertex $i$ is associated with a specific, constant energy $E_i$. The set of energies for the vertices is given by:\n$\\{E_1, E_2, E_3, E_4, E_5, E_6, E_7, E_8\\} = \\{4.0, 7.0, 1.5, 5.0, 8.0, 3.0, 6.0, 2.5\\}$, in arbitrary units of energy, $\\epsilon$.\n\nThe particle's state is its current vertex. The system evolves using the Metropolis algorithm at a constant temperature. In each step of the simulation:\n1. A trial move is proposed by randomly selecting one of the three vertices adjacent to the particle's current location.\n2. The change in energy, $\\Delta E = E_{\\text{new}} - E_{\\text{old}}$, is calculated.\n3. If $\\Delta E \\le 0$, the move is always accepted.\n4. If $\\Delta E > 0$, the move is accepted with a probability $P_{\\text{accept}} = \\exp(-\\Delta E / (k_B T))$.\n\nThe system is simulated for a very large number of steps, allowing it to reach thermal equilibrium. The thermal energy of the system is maintained at $k_B T = 2.0 \\epsilon$.\n\nCalculate the probability of finding the particle at the vertex with the minimum energy once the system is in equilibrium. Express your answer as a decimal rounded to three significant figures.", "solution": "The Metropolis algorithm with a symmetric proposal on an undirected graph (each vertex of the cube has degree three and proposals are uniform over neighbors) satisfies detailed balance with respect to the Boltzmann distribution. Therefore, at equilibrium the probability of occupying vertex $i$ is\n$$\np_{i}=\\frac{\\exp\\!\\left(-\\frac{E_{i}}{k_{B}T}\\right)}{Z},\\quad Z=\\sum_{j=1}^{8}\\exp\\!\\left(-\\frac{E_{j}}{k_{B}T}\\right).\n$$\nThe minimum energy is $E_{\\min}=1.5\\,\\epsilon$ (at vertex $v_{3}$). With $k_{B}T=2.0\\,\\epsilon$, the dimensionless factors are $E_{i}/(k_{B}T)=E_{i}/2$, so\n$$\nZ=\\sum_{j=1}^{8}\\exp\\!\\left(-\\frac{E_{j}}{2}\\right)=\\exp(-2)+\\exp(-3.5)+\\exp(-0.75)+\\exp(-2.5)+\\exp(-4)+\\exp(-1.5)+\\exp(-3)+\\exp(-1.25).\n$$\nNumerically,\n$$\nZ\\approx 0.1353352832+0.0301973834+0.4723665527+0.0820849986+0.0183156389+0.2231301601+0.0497870684+0.2865047969\\approx 1.2977218823.\n$$\nThe equilibrium probability at the minimum-energy vertex is\n$$\np_{\\min}=\\frac{\\exp(-0.75)}{Z}\\approx \\frac{0.4723665527}{1.2977218823}\\approx 0.363997.\n$$\nRounded to three significant figures, this is $0.364$.", "answer": "$$\\boxed{0.364}$$", "id": "2005992"}]}