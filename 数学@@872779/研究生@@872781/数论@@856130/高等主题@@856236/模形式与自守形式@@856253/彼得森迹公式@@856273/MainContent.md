## 引言
彼得森迹公式（Petersson Trace Formula）是现代[解析数论](@entry_id:158402)与[自守形式](@entry_id:186448)理论中的一块基石，它在看似无关的数学领域之间建立了一座深刻的桥梁。长久以来，数学家们致力于理解[自守形式](@entry_id:186448)抽象的谱性质（如其傅里叶系数）与具体的算术对象（如经典的[指数和](@entry_id:199860)）之间的联系。彼得森迹公式正是解决这一问题的关键，它提供了一个精确的恒等式，将谱信息转化为可计算的算术量。

本文旨在系统性地剖析这一强大的工具。在“原理与机制”一章中，我们将深入其核心构造，揭示其谱侧与几何侧的对偶性，并解释克鲁斯特曼和与贝塞尔函数等关键部件的由来。接下来，在“应用与[交叉](@entry_id:147634)学科联系”中，我们将展示该公式如何被应用于解决数论中的前沿问题，例如计算L-函数矩、攻克亚凸性难题，乃至为[素数分布](@entry_id:183192)理论提供深刻见解。最后，“动手实践”部分将通过具体的计算问题，帮助读者将理论知识转化为实践能力。通过这三个章节的学习，读者将全面掌握彼得森迹公式的理论精髓与应用价值。

## 原理与机制

在本章中，我们将深入探讨彼得森迹公式 (Petersson Trace Formula) 的核心原理与内在机制。该公式在[解析数论](@entry_id:158402)与[自守形式](@entry_id:186448)理论中扮演着至关重要的角色，它在[谱理论](@entry_id:275351)（[自守形式](@entry_id:186448)的傅里叶系数）与几何/算术（克鲁斯特曼和）之间建立了一座深刻的桥梁。我们的讨论将从该公式的两个基本侧面——谱展开与几何展开——入手，逐步揭示其构造、关键组成部分及其在现代数学研究中的强大威力。

### 核心对偶性：谱展开与几何展开

彼得森迹公式的精髓在于它通过两种截然不同的方式计算同一个量，从而建立起一个深刻的恒等式。这个量是两个 **庞加莱级数 (Poincaré series)** 的 **彼得森[内积](@entry_id:158127) (Petersson inner product)**。对该[内积](@entry_id:158127)的计算，一方面可以从谱论的角度出发，通过将其投影到由 **[赫克本征形式](@entry_id:189280) (Hecke eigenforms)** 构成的标准正交基上进行展开；另一方面，则可以通过几何与算术的手段，利用所谓的“展开方法”(unfolding method) 将积分直接计算出来。这两种计算路径分别导出了公式的“谱侧”与“几何侧”。

-   **谱侧 (Spectral Side)**：通过在希尔伯特空间中的[基展开](@entry_id:746689)得到，表现为对模形式[傅里叶系数](@entry_id:144886)乘积的求和。它反映了自守谱的离散结构。

-   **几何侧 (Geometric Side)**：通过对定义积分进行一系列变换得到，表现为一个对角项与一个包含 **克鲁斯特曼和 (Kloosterman sums)** 和 **[贝塞尔函数](@entry_id:265752) (Bessel functions)** 的[无穷级数](@entry_id:143366)之和。它根植于相关李群的几何与算术结构。

将这两侧画上等号，便得到了彼得森迹公式。这一等式将看似抽象的谱信息（傅里叶系数的平均值）转化为了具体的、可分析的算术对象（[指数和](@entry_id:199860)），这正是该公式威力之所在 [@problem_id:3028742]。

### 谱展开：对本征形式的求和

我们首先考虑权为 $k$、水平为 $N$ 的全纯[尖点形式](@entry_id:189096)空间 $S_k(\Gamma_0(N))$。这是一个装备了彼得森[内积](@entry_id:158127)的有限维[复希尔伯特空间](@entry_id:185216)。彼得森[内积](@entry_id:158127)定义为：
$$
\langle f,g \rangle = \int_{\Gamma_0(N)\backslash \mathbb{H}} f(z)\,\overline{g(z)}\,y^{k}\,\frac{dx\,dy}{y^{2}}
$$
其中 $f, g \in S_k(\Gamma_0(N))$，$z=x+iy$ 位于复上半平面 $\mathbb{H}$。

这个空间存在一个由所有[赫克算子](@entry_id:181282) $T_n$（其中 $\gcd(n,N)=1$）的共同本征函数构成的标准正交基 $\mathcal{B}$。对于这个基中的每一个本征形式 $f$，其傅里叶展开为 $f(z) = \sum_{n \ge 1} a_f(n) e^{2\pi i n z}$。

为了构建迹公式，我们引入一个关键工具——庞加莱级数 $P_m(z)$。对于每个正整数 $m$，庞加莱级数 $P_m(z)$ 是一个权为 $k$ 的模形式，其构造精妙，使其具有如下的“再生性质”：对于空间 $S_k(\Gamma_0(N))$ 中的任意一个[尖点形式](@entry_id:189096) $f$，它们之间的[内积](@entry_id:158127)能够精确地提取出 $f$ 的第 $m$ 个傅里叶系数 $a_f(m)$（可能相差一个[标准化](@entry_id:637219)的常数）。更精确地说，通过展开方法可以[直接证明](@entry_id:141172)这个关键关系 [@problem_id:3024006]：
$$
\langle f, P_{m,k} \rangle = a_f(m) \frac{\Gamma(k-1)}{(4\pi m)^{k-1}}
$$
这个性质表明，庞加莱级数在希尔伯特空间中扮演了傅里叶系数泛函的对偶元素。

现在，我们可以从谱论的角度计算两个庞加莱级数 $P_m(z)$ 和 $P_n(z)$ 的[内积](@entry_id:158127)。我们将 $P_m(z)$ 在标准正交基 $\mathcal{B}$ 上展开：
$$
P_m(z) = \sum_{f \in \mathcal{B}} \frac{\langle P_m, f \rangle}{\langle f, f \rangle} f(z)
$$
由于 $\mathcal{B}$ 是[标准正交基](@entry_id:147779)，$\langle f,f \rangle=1$。于是，$\langle P_m, P_n \rangle$ 可以表示为：
$$
\langle P_m, P_n \rangle = \sum_{f \in \mathcal{B}} \langle P_m, f \rangle \overline{\langle P_n, f \rangle} = \sum_{f \in \mathcal{B}} \overline{\langle f, P_m \rangle} \langle f, P_n \rangle
$$
利用庞加莱级数的再生性质，并代入适当的[标准化](@entry_id:637219)因子，上式最终可以被表达为一个关于傅里叶系数的二次型和。例如，对于一个标准正交基，我们得到一个形如 $\sum_{f \in \mathcal{B}} a_f(m) \overline{a_f(n)}$ 的表达式，乘以一些依赖于 $m$、$n$、$k$ 的标准化常数。这就是彼得森迹公式的**谱侧**。

### 几何展开：展开方法与算术结构

现在，我们从另一个角度，即直接计算积分 $\langle P_m, P_n \rangle$ 来导出公式的**几何侧**。这主要通过“展开方法”实现，即将对 $\Gamma_0(N)$ 的一个基本区域的积分，转化为对一个更大的、更容易处理的区域（即[稳定子群](@entry_id:137216) $\Gamma_\infty$ 的基本区域）的积分。计算的最终结果是 $P_n(z)$ 的第 $m$ 个[傅里叶系数](@entry_id:144886)的表达式。这个表达式包含两个主要部分：一个对角项和一个无穷级数。

#### 克鲁斯特曼和的起源

级数项中出现的克鲁斯特曼和源于对群 $\mathrm{SL}_2(\mathbb{Z})$（或相关[同余子群](@entry_id:195720)）元素求和的几何结构。根据 **[布吕阿分解](@entry_id:137375) (Bruhat decomposition)**，群 $\mathrm{SL}_2(\mathbb{Z})$ 可以分解为两个不交的部分：
$$
\mathrm{SL}_2(\mathbb{Z}) = \Gamma_\infty \cup \Gamma_\infty w \Gamma_\infty
$$
其中 $\Gamma_\infty$ 是稳定无穷远[尖点](@entry_id:636792)（即平移矩阵）的抛物型[子群](@entry_id:146164)，而 $w = \begin{pmatrix} 0 & -1 \\ 1 & 0 \end{pmatrix}$ 是长外尔元 (long Weyl element)。

在展开方法的计算中，对群元素的求和相应地也分为两部分 [@problem_id:3028729]：
1.  对 $\Gamma_\infty$ 中元素的求和（对应矩阵 $\begin{pmatrix} a & b \\ c & d \end{pmatrix}$ 中 $c=0$ 的情况），通过[傅里叶变换](@entry_id:142120)的正交性，这部分贡献了对角项 $\delta_{m,n}$。
2.  对 **长外尔单元 (long Weyl cell)** $\Gamma_\infty w \Gamma_\infty$ 中元素的求和（对应 $c \neq 0$ 的情况），这部分贡献了非对角项。

为了计算非对角项，通常将求和按矩阵的左下角元素 $c$ 进行组织。对于固定的 $c \neq 0$，[行列式](@entry_id:142978)条件 $ad-bc=1$ 施加了一个关键的算术约束：$ad \equiv 1 \pmod c$。这意味着 $a$ 必须是 $d$ 模 $c$ 的乘法逆元。在对所有可能的 $d$（与 $c$ [互素](@entry_id:143119)）进行求和时，傅里叶模式 $e^{2\pi i m z}$ 和 $e^{2\pi i n z}$ 中的指数项相互作用，最终产生了一个形式为
$$
S(m,n;c) = \sum_{\substack{d \pmod c \\ \gcd(d,c)=1}} \exp\left(\frac{2\pi i}{c} (m d^{-1} + n d)\right)
$$
的[指数和](@entry_id:199860)。这正是经典的克鲁斯特曼和。其模数 $c$ 来自矩阵的几何结构，而其相位则直接反映了[行列式](@entry_id:142978)约束所蕴含的乘法逆元关系。

#### [贝塞尔函数](@entry_id:265752)核的起源

几何侧的另一个关键组成部分是贝塞尔函数 $J_{k-1}$。在经典推导中，它来自对某些[振荡积分](@entry_id:137059)的精确计算。然而，其更深层的起源在于[表示论](@entry_id:137998) [@problem_id:3028745]。

一个权为 $k$ 的全纯[尖点形式](@entry_id:189096)，在表示论的框架下，对应于[李群](@entry_id:137659) $\mathrm{SL}_2(\mathbb{R})$ 的一个最低权为 $k$ 的 **全纯离散[级数表示](@entry_id:175860) (holomorphic discrete series representation)** $D_k$。迹公式的几何侧可以看作是各个“位 (place)”上局部因子的乘积。对于阿基米德位（即实数位），其贡献由一个积分算子描述。对于全纯情况，这个[算子的核](@entry_id:272757)函数，在经过适当的[积分变换](@entry_id:186209)（一个 **[汉克尔变换](@entry_id:195170) (Hankel transform)**）后，被确定为[第一类贝塞尔函数](@entry_id:166421) $J_{k-1}$。阶数 $k-1$ 直接由[表示的权](@entry_id:204286) $k$ 决定。全纯性这一强加条件，排除了其他类型的[贝塞尔函数](@entry_id:265752)（如 $Y_\nu$ 或[修正贝塞尔函数](@entry_id:184177) $K_\nu$），精确地锁定了 $J_{k-1}$ 作为其核函数。

### 完整公式及其威力

综合谱侧和几何侧的计算，我们便得到了彼得森迹公式的完整形式。对于权为 $k$、水平为 $N$ 的标准正交赫克本征基 $\mathcal{B}$，公式的一般形式为 [@problem_id:3015367]：
$$
\sum_{f\in \mathcal{B}} \frac{a_f(m)\,\overline{a_f(n)}}{\langle f,f\rangle} = \delta_{m,n} + 2\pi i^{-k} \sum_{c\ge 1} \frac{S(m,n;cN)}{cN} J_{k-1}\left(\frac{4\pi \sqrt{mn}}{cN}\right)
$$
（这里的公式形式经过了标准化，实际表达式中的常数因子取决于具体的约定。）

这个公式的威力在于它将一个谱平均问题（左侧）转化为一个可以通过数论方法分析的算术和问题（右侧）。一个经典的应用是估计赫克[本征值](@entry_id:154894)的和性态 [@problem_id:3028742]。例如，考虑求和 $\sum_{f \in \mathcal{B}_k} \lambda_f(n)$，其中 $\lambda_f(n)$ 是[标准化](@entry_id:637219)的赫克[本征值](@entry_id:154894)。利用迹公式，这个谱和可以表示为一个关于克鲁斯特曼和的级数。通过使用 **[韦伊界](@entry_id:184775) (Weil bound)** 对克鲁斯特曼和进行估计，并结合[贝塞尔函数](@entry_id:265752)的[渐近性质](@entry_id:177569)，可以证明该和存在显著的“抵消”，得到非平凡的上界，例如：
$$
\sum_{f \in \mathcal{B}_k} \lambda_f(n) \ll_{k,\epsilon} n^{1/4+\epsilon}
$$
这比由维数给出的平凡界要强大得多，展示了迹公式在从谱信息中提取深刻算术性质方面的强大能力。

### 背景与进阶主题

#### 表示论观点

在现代[自守形式](@entry_id:186448)理论中，彼得森迹公式被置于[阿代尔](@entry_id:201496)[群表示论](@entry_id:141930)的宏大框架下理解。从这个角度看，[赫克算子](@entry_id:181282)对应于在 $p$-adic 位上与 **球函数 (spherical function)** 进行卷积。对于一个无分支的[自守表示](@entry_id:181931) $\pi = \otimes_v' \pi_v$，其在 $p$-adic 位上的局部表示 $\pi_p$ 拥有一个一维的 $K_p$-不动[向量空间](@entry_id:151108)（$K_p = \mathrm{GL}_2(\mathbb{Z}_p)$）。由于球函数是双 $K_p$-不变的，它在作用于这个一维空间时必然表现为一个标量乘子。这个标量正是该表示的赫克[本征值](@entry_id:154894) [@problem_id:3028707]。因此，谱侧出现的赫克[本征值](@entry_id:154894)，本质上是表示论中[卷积算子](@entry_id:747865)作用于不变子空间的结果。

#### 与相关迹公式的比较

为了更好地理解彼得森迹公式的独特性，我们可以将其与[自守形式](@entry_id:186448)理论中另外两个著名的迹公式进行比较。

-   **与[塞尔伯格迹公式](@entry_id:187042) (Selberg Trace Formula) 的比较** [@problem_id:3028710]：
    -   **作用空间与谱**：[塞尔伯格迹公式](@entry_id:187042)作用于更广泛的 $L^2(\Gamma\backslash G)$ 空间，其谱分解包含[离散谱](@entry_id:150970)（[尖点形式](@entry_id:189096)）和[连续谱](@entry_id:155477)（由艾森斯坦级数描述）。而彼得森迹公式仅限于有限维的全纯[尖点形式](@entry_id:189096)空间 $S_k(\Gamma)$，这是一个纯[离散谱](@entry_id:150970)的环境。
    -   **展开内容**：[塞尔伯格迹公式](@entry_id:187042)的谱侧是对[拉普拉斯算子](@entry_id:146319)[本征值](@entry_id:154894)（或更一般的 Casimir 算子[本征值](@entry_id:154894)）的函数求和；其几何侧是对群 $\Gamma$ 中 **共轭类** 的[轨道](@entry_id:137151)积分求和，这些项分别对应单位元、椭圆元、双曲元（与[闭测地线](@entry_id:190155)相关）和抛物元。相比之下，彼得森迹公式的谱侧是对傅里叶系数求和，几何侧是对矩阵元素（通过克鲁斯特曼和）求和。

-   **与库兹涅佐夫公式 (Kuznetsov Formula) 的比较** [@problem_id:3028713] [@problem_id:3028725]：
    -   **作用对象**：彼得森迹公式专用于 **全纯** 模形式，其对应的表示是离散[级数表示](@entry_id:175860)。而库兹涅佐夫公式则适用于 **非全纯** 的马斯形式 (Maass forms)，其对应的表示通常是主[级数表示](@entry_id:175860)，并由一个连续的谱参数 $r$ 刻画（拉普拉斯[本征值](@entry_id:154894)为 $\frac{1}{4}+r^2$）。
    -   **[检验函数](@entry_id:166589)与核函数**：由于马斯形式的谱参数是连续的，库兹涅佐夫公式的谱侧包含一个可自由选择的 **[检验函数](@entry_id:166589)** $h(r)$。其几何侧的贝塞尔核也相应地变为依赖于谱参数 $r$ 的 $J_{2ir}$ 和 $K_{2ir}$ 的[积分变换](@entry_id:186209)，而不是固定的 $J_{k-1}$。这反映了从离散参数（权 $k$）到连续参数（谱参数 $r$）的根本转变。

#### 权 $k=2$ 的特殊情况

当权的取值为 $k=2$ 时，彼得森迹公式的推导会遇到技术上的困难 [@problem_id:3028715]。这是因为权为 2 时，相关的积分不再绝对收敛，这与权为 2 的艾森斯坦级数的存在密切相关。这些艾森斯坦级数不像[尖点形式](@entry_id:189096)那样在[尖点](@entry_id:636792)处快速衰减，它们的存在会在展开方法的积分计算中产生不收敛的边界项。

为了处理这个难题，数学家们发展了两种主要策略：
1.  **截断方法 (Truncation Method)**：由塞尔伯格首创，该方法通过在一个截断的基本区域上进行积分来使所有计算合法化。计算结果会依赖于截断参数。通过分析其[渐近行为](@entry_id:160836)，并独立计算连续谱（艾森斯坦级数）的贡献，最终可以精确地减去边界项，从而分离出纯粹的[尖点](@entry_id:636792)谱迹公式。
2.  **投影方法 (Projection Method)**：另一种方法是直接在算子层面进行修正。通过将作用在整个[模形式空间](@entry_id:199790)上的算子，正交投影到[尖点形式](@entry_id:189096)[子空间](@entry_id:150286) $S_2(\Gamma)$ 上，可以构造一个从一开始就“消除了”艾森斯坦级数影响的[核函数](@entry_id:145324)。对这个投影后的算子求迹，便可直接得到无边界项的[尖点](@entry_id:636792)迹公式。

这两种方法殊途同归，都成功地将彼得森迹公式推广到了权为 2 的情形，这对于研究[椭圆曲线](@entry_id:152409)等重要课题至关重要。