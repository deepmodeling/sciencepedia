{"hands_on_practices": [{"introduction": "这个练习回归到最基本的情形：线性指数和。虽然这个和可以被看作一个简单的几何级数，但从基本原理出发推导其精确值并确定其为零的条件，能帮助我们深刻理解周期性与抵消现象。这个练习 [@problem_id:3014067] 展示了在一个完整的周期内，项如何精确地相互抵消，这是所有指数和估计方法（包括外尔差分法）的核心思想。", "problem": "设 $a$ 和 $q$ 为整数且 $q \\geq 1$，令 $N$ 为一个正整数。考虑指数和\n$$\nS(N;a,q) \\;=\\; \\sum_{n=1}^{N} \\exp\\!\\left(2\\pi i \\frac{a n}{q}\\right).\n$$\n从指数和的基本定义以及等比数列的基本性质出发，推导 $S(N;a,q)$ 的精确闭式表达式，不得引用任何现成的求和公式。用初等函数表示你的最终答案。然后，仅使用第一性原理（复指数的周期性和整数的整除性），在非平凡情况 $q \\nmid a$ 下，推导使 $S(N;a,q)=0$ 成立的关于 $N$ 的充要条件。最后，简要解释你所得到的和为零的条件如何反映了外尔差分法在线性相位的指数和分析中所利用的相消类型。\n\n你的最终方框答案必须是 $S(N;a,q)$ 在 $q \\nmid a$ 情况下的精确解析表达式。无需四舍五入。不要在最终的方框表达式内包含任何文字或条件。", "solution": "我们从该和的定义开始\n$$\nS(N;a,q) \\;=\\; \\sum_{n=1}^{N} \\exp\\!\\left(2\\pi i \\frac{a n}{q}\\right).\n$$\n令\n$$\nr \\;=\\; \\exp\\!\\left(2\\pi i \\frac{a}{q}\\right).\n$$\n那么 $S(N;a,q)$ 是一个有限等比数列\n$$\nS(N;a,q) \\;=\\; \\sum_{n=1}^{N} r^{n}.\n$$\n我们不引用任何现成的等比级数公式，而是直接推导它。考虑\n$$\n(1-r)\\,S(N;a,q) \\;=\\; \\sum_{n=1}^{N} r^{n} - \\sum_{n=1}^{N} r^{n+1}.\n$$\n右侧发生裂项相消：\n$$\n\\sum_{n=1}^{N} r^{n} - \\sum_{n=1}^{N} r^{n+1}\n\\;=\\;\nr + r^{2} + \\cdots + r^{N} \\;-\\; r^{2} - r^{3} - \\cdots - r^{N+1}\n\\;=\\; r - r^{N+1}.\n$$\n因此，\n$$\n(1-r)\\,S(N;a,q) \\;=\\; r - r^{N+1},\n$$\n当 $r \\neq 1$ 时，我们有\n$$\nS(N;a,q) \\;=\\; \\frac{r - r^{N+1}}{1 - r} \\;=\\; r\\,\\frac{1-r^{N}}{1-r}.\n$$\n现在我们用实值初等函数来表示这个表达式。记 $r=\\exp(i\\theta)$，其中 $\\theta = 2\\pi a/q$。那么\n$$\nS(N;a,q) \\;=\\; \\exp(i\\theta)\\,\\frac{1-\\exp(iN\\theta)}{1-\\exp(i\\theta)}.\n$$\n使用恒等式\n$$\n1-\\exp(i\\phi) \\;=\\; \\exp\\!\\left(\\frac{i\\phi}{2}\\right)\\left(\\exp\\!\\left(-\\frac{i\\phi}{2}\\right)-\\exp\\!\\left(\\frac{i\\phi}{2}\\right)\\right)\n\\;=\\; -2i\\,\\exp\\!\\left(\\frac{i\\phi}{2}\\right)\\sin\\!\\left(\\frac{\\phi}{2}\\right),\n$$\n将其应用于 $\\phi=N\\theta$ 和 $\\phi=\\theta$。那么\n$$\n\\frac{1-\\exp(iN\\theta)}{1-\\exp(i\\theta)}\n\\;=\\;\n\\frac{-2i\\,\\exp\\!\\left(\\frac{iN\\theta}{2}\\right)\\sin\\!\\left(\\frac{N\\theta}{2}\\right)}{-2i\\,\\exp\\!\\left(\\frac{i\\theta}{2}\\right)\\sin\\!\\left(\\frac{\\theta}{2}\\right)}\n\\;=\\;\n\\exp\\!\\left(\\frac{i(N\\theta-\\theta)}{2}\\right)\\,\\frac{\\sin\\!\\left(\\frac{N\\theta}{2}\\right)}{\\sin\\!\\left(\\frac{\\theta}{2}\\right)}.\n$$\n乘以 $\\exp(i\\theta)$ 得到\n$$\nS(N;a,q)\n\\;=\\;\n\\exp(i\\theta)\\,\\exp\\!\\left(\\frac{i(N\\theta-\\theta)}{2}\\right)\\,\\frac{\\sin\\!\\left(\\frac{N\\theta}{2}\\right)}{\\sin\\!\\left(\\frac{\\theta}{2}\\right)}\n\\;=\\;\n\\exp\\!\\left(\\frac{i(N+1)\\theta}{2}\\right)\\,\\frac{\\sin\\!\\left(\\frac{N\\theta}{2}\\right)}{\\sin\\!\\left(\\frac{\\theta}{2}\\right)}.\n$$\n代入 $\\theta=2\\pi a/q$ 给出精确的闭式形式\n$$\nS(N;a,q)\n\\;=\\;\n\\exp\\!\\left(\\pi i \\frac{a(N+1)}{q}\\right)\\,\\frac{\\sin\\!\\left(\\pi \\frac{aN}{q}\\right)}{\\sin\\!\\left(\\pi \\frac{a}{q}\\right)},\n$$\n前提是 $r \\neq 1$，即 $q \\nmid a$。在互补情况 $q \\mid a$ 下，我们有 $r=\\exp(2\\pi i \\cdot \\text{整数})=1$，因此根据定义，平凡地得到 $S(N;a,q)=N$。\n\n现在我们在非平凡情况 $q \\nmid a$ 下推导和为零的条件。从闭式形式可知，\n$$\nS(N;a,q)=0\n\\quad\\Longleftrightarrow\\quad\n\\sin\\!\\left(\\pi \\frac{aN}{q}\\right)=0,\n$$\n因为当 $q \\nmid a$ 时，分母 $\\sin\\!\\left(\\pi \\frac{a}{q}\\right)\\neq 0$。等式 $\\sin(\\pi x)=0$ 成立当且仅当 $x\\in\\mathbb{Z}$。因此，\n$$\n\\sin\\!\\left(\\pi \\frac{aN}{q}\\right)=0\n\\quad\\Longleftrightarrow\\quad\n\\frac{aN}{q}\\in\\mathbb{Z}\n\\quad\\Longleftrightarrow\\quad\nq \\mid aN.\n$$\n令 $d=\\gcd(a,q)$。那么 $aN$ 能被 $q$ 整除，当且仅当 $\\frac{q}{d}$ 整除 $N$。于是，\n$$\nS(N;a,q)=0\n\\quad\\Longleftrightarrow\\quad\n\\frac{q}{\\gcd(a,q)} \\mid N,\n\\qquad \\text{当 } q \\nmid a \\text{ 时}.\n$$\n这个条件展示了在线性相位 $\\exp(2\\pi i a n/q)$ 的一个完整周期上的精确相消，其周期长度为 $\\frac{q}{\\gcd(a,q)}$：对整数个周期求和得到零。这个相消原理是外尔差分法处理线性相位的基础：使用步长 $h=\\frac{q}{\\gcd(a,q)}$ 进行离散差分，得到\n$$\n\\exp\\!\\left(2\\pi i \\frac{a(n+h)}{q}\\right) - \\exp\\!\\left(2\\pi i \\frac{a n}{q}\\right)\n\\;=\\;\n\\exp\\!\\left(2\\pi i \\frac{a n}{q}\\right)\\left(\\exp\\!\\left(2\\pi i \\frac{a h}{q}\\right)-1\\right)\n\\;=\\; 0,\n$$\n因为 $\\exp\\!\\left(2\\pi i \\frac{a h}{q}\\right)=\\exp\\!\\left(2\\pi i \\frac{a}{\\gcd(a,q)}\\right)=1$。在此步长下离散差分的精确为零，反映了外尔差分法为获得线性相位指数和中的相消而利用的周期性结构。", "answer": "$$\\boxed{\\exp\\!\\left(\\pi i \\frac{a(N+1)}{q}\\right)\\,\\frac{\\sin\\!\\left(\\pi \\frac{aN}{q}\\right)}{\\sin\\!\\left(\\pi \\frac{a}{q}\\right)}}$$", "id": "3014067"}, {"introduction": "在掌握了线性情形后，我们进入二次指数和，即高斯和。这个问题 [@problem_id:3014046] 是外尔差分法威力的一个典型展示。通过对指数和的模长取平方，我们将估计一个二次相位和的问题，转化为处理一系列线性相位和，从而得到著名的“平方根抵消”界。", "problem": "设 $a$ 和 $q$ 为整数，且 $\\gcd(a,q)=1$。定义完全二次高斯和\n$$G(a,q) \\;=\\; \\sum_{n=0}^{q-1} \\exp\\!\\left(\\frac{2\\pi i\\, a n^{2}}{q}\\right).$$\n从模 $q$ 的加性特征的正交性、模素数幂的二次剩余结构以及中国剩余定理（CRT）出发，推导在 $q$ 为奇数情况下 $G(a,q)$ 的一个显式闭式表达式，并用雅可比符号 $\\left(\\frac{a}{q}\\right)$ 表示。然后，对二次相位 $\\frac{a n^{2}}{q}$ 应用外尔差分法（van der Corput 方法），得到其模 $|G(a,q)|$ 的一个精确的平方根律，该定律明确地依赖于 $q$ 的奇偶性。您的最终答案必须是一个单一的解析表达式，可能是分段的，并且除了指定该表达式所必需的不等式或方程外，不包含其他内容。如果您选择呈现多个部分（例如，显式求值和模的定律），请使用 LaTeX 的 pmatrix 环境将它们组织成一个单行矩阵。无需进行数值近似。", "solution": "问题要求对奇数 $q$ 的二次高斯和 $G(a,q)$ 进行显式求值，并使用外尔差分法确定任意整数 $q$ 的模 $|G(a,q)|$。给定 $\\gcd(a,q)=1$。高斯和定义为\n$$G(a,q) = \\sum_{n=0}^{q-1} \\exp\\left(\\frac{2\\pi i a n^{2}}{q}\\right).$$\n\n首先，我们推导当 $q$ 为奇正整数时 $G(a,q)$ 的闭式表达式。这个推导过程分两个主要步骤：将 $G(a,q)$ 与 $G(1,q)$ 关联起来，然后计算 $G(1,q)$。\n\n**第1步：对于奇数 $q$，$G(a,q)$ 与 $G(1,q)$ 之间的关系**\n\n我们将证明，对于任意奇整数 $q>0$ 和任意与 $q$ 互质的整数 $a$，以下关系成立：\n$$G(a,q) = \\left(\\frac{a}{q}\\right) G(1,q),$$\n其中 $\\left(\\frac{a}{q}\\right)$ 是雅可比符号。证明通过对 $q$ 的素因子个数进行归纳。\n\n基础情形：$q=p$，一个奇素数。\n同余方程 $x^2 \\equiv r \\pmod p$ 的解的个数是 $1 + \\left(\\frac{r}{p}\\right)$。我们可以通过将具有相同 $n^2 \\pmod p$ 值的项分组来重写 $G(a,p)$ 的和式：\n$$G(a,p) = \\sum_{n=0}^{p-1} \\exp\\left(\\frac{2\\pi i a n^2}{p}\\right) = \\sum_{r=0}^{p-1} \\left(1 + \\left(\\frac{r}{p}\\right)\\right) \\exp\\left(\\frac{2\\pi i a r}{p}\\right).$$\n这可以分为两个和：\n$$G(a,p) = \\sum_{r=0}^{p-1} \\exp\\left(\\frac{2\\pi i a r}{p}\\right) + \\sum_{r=0}^{p-1} \\left(\\frac{r}{p}\\right) \\exp\\left(\\frac{2\\pi i a r}{p}\\right).$$\n第一个和是关于模 $p$ 的一个完全剩余系。因为 $\\gcd(a,p)=1$，所以项 $ar$ 也构成一个完全剩余系。所有 $p$ 次单位根的和为零，所以 $\\sum_{r=0}^{p-1} \\exp\\left(\\frac{2\\pi i a r}{p}\\right) = 0$。\n第二个和是勒让德特征 $\\chi(r) = \\left(\\frac{r}{p}\\right)$ 的高斯和。我们将其记为 $\\tau(\\chi, a)$。通过变量代换 $s=ar$，即 $r=a^{-1}s$，其中 $a^{-1}$ 是 $a$ 模 $p$ 的乘法逆元，我们得到：\n$$\\sum_{r=0}^{p-1} \\left(\\frac{r}{p}\\right) \\exp\\left(\\frac{2\\pi i a r}{p}\\right) = \\sum_{s=0}^{p-1} \\left(\\frac{a^{-1}s}{p}\\right) \\exp\\left(\\frac{2\\pi i s}{p}\\right) = \\left(\\frac{a^{-1}}{p}\\right) \\sum_{s=0}^{p-1} \\left(\\frac{s}{p}\\right) \\exp\\left(\\frac{2\\pi i s}{p}\\right).$$\n因为 $\\left(\\frac{a^{-1}}{p}\\right) = \\left(\\frac{a}{p}\\right)$，这变成 $\\left(\\frac{a}{p}\\right) \\sum_{s=0}^{p-1} \\left(\\frac{s}{p}\\right) \\exp\\left(\\frac{2\\pi i s}{p}\\right)$。根据与上面相同的逻辑，这个最终的和恰好是 $G(1,p)$。因此，对于 $q=p$，我们已经证明了 $G(a,p) = \\left(\\frac{a}{p}\\right)G(1,p)$。\n\n归纳步骤：设 $q=q_1 q_2$，其中 $q_1, q_2 > 1$ 是互质的奇整数。假设公式对 $q_1$ 和 $q_2$ 成立。根据中国剩余定理，当 $n_1$ 和 $n_2$ 分别遍历模 $q_1$ 和模 $q_2$ 的完全剩余系时，$n=n_1q_2+n_2q_1$ 会遍历模 $q=q_1q_2$ 的一个完全剩余系。\n$$a n^2 = a(n_1q_2+n_2q_1)^2 = a n_1^2 q_2^2 + a n_2^2 q_1^2 + 2an_1n_2q_1q_2.$$\n除以 $q=q_1q_2$，我们得到 $\\frac{an^2}{q} = \\frac{an_1^2q_2}{q_1} + \\frac{an_2^2q_1}{q_2} + 2an_1n_2$。最后一项是整数。因此，\n$$G(a,q) = \\sum_{n_1=0}^{q_1-1} \\sum_{n_2=0}^{q_2-1} \\exp\\left(\\frac{2\\pi i a q_2 n_1^2}{q_1}\\right) \\exp\\left(\\frac{2\\pi i a q_1 n_2^2}{q_2}\\right) = G(aq_2, q_1) G(aq_1, q_2).$$\n根据归纳假设和雅可比符号的性质：\n$$G(aq_2, q_1) = \\left(\\frac{aq_2}{q_1}\\right) G(1,q_1) = \\left(\\frac{a}{q_1}\\right)\\left(\\frac{q_2}{q_1}\\right) G(1,q_1).$$\n$$G(aq_1, q_2) = \\left(\\frac{aq_1}{q_2}\\right) G(1,q_2) = \\left(\\frac{a}{q_2}\\right)\\left(\\frac{q_1}{q_2}\\right) G(1,q_2).$$\n将这两项相乘得到：\n$$G(a,q) = \\left(\\frac{a}{q_1}\\right)\\left(\\frac{a}{q_2}\\right) \\left(\\frac{q_2}{q_1}\\right)\\left(\\frac{q_1}{q_2}\\right) G(1,q_1)G(1,q_2) = \\left(\\frac{a}{q}\\right) \\left(\\left(\\frac{q_2}{q_1}\\right)\\left(\\frac{q_1}{q_2}\\right) G(1,q_1)G(1,q_2)\\right).$$\n根据相同的逻辑，将乘法公式应用于 $G(1,q)$：\n$$G(1,q) = G(q_2, q_1)G(q_1, q_2) = \\left(\\frac{q_2}{q_1}\\right)G(1,q_1) \\left(\\frac{q_1}{q_2}\\right)G(1,q_2).$$\n比较这两个表达式，我们看到 $G(a,q) = \\left(\\frac{a}{q}\\right)G(1,q)$。归纳完成。\n\n**第2步：对于奇数 $q$，计算 $G(1,q)$**\n\n由 Gauss 建立的一个经典结果是，对于一个奇素数 $p$，\n$$G(1,p) = \\begin{cases} \\sqrt{p}  & \\text{若 } p \\equiv 1 \\pmod 4 \\\\ i\\sqrt{p} & \\text{若 } p \\equiv 3 \\pmod 4 \\end{cases}.$$\n我们现在通过归纳将此结果推广到任意奇合数 $q$。设 $q=q_1q_2$ 且 $\\gcd(q_1,q_2)=1$。我们使用上面推导的公式：\n$$G(1,q) = \\left(\\frac{q_2}{q_1}\\right)\\left(\\frac{q_1}{q_2}\\right)G(1,q_1)G(1,q_2).$$\n根据二次互反律，对于互质的奇数 $q_1, q_2$，我们有 $\\left(\\frac{q_2}{q_1}\\right)\\left(\\frac{q_1}{q_2}\\right) = (-1)^{\\frac{q_1-1}{2}\\frac{q_2-1}{2}}$。\n让我们假设该公式对 $q_1, q_2$ 成立。\n如果 $q_1 \\equiv 1 \\pmod 4$，那么 $\\frac{q_1-1}{2}$ 是偶数，所以互反因子是 $1$。则 $G(1,q)=G(1,q_1)G(1,q_2)$。由于 $G(1,q_1)=\\sqrt{q_1}$，我们得到 $G(1,q)=\\sqrt{q_1}G(1,q_2)$。因为 $q=q_1q_2 \\equiv q_2 \\pmod 4$，这种情况是一致的。\n如果 $q_1 \\equiv 3 \\pmod 4$ 且 $q_2 \\equiv 3 \\pmod 4$，那么 $\\frac{q_1-1}{2}$ 和 $\\frac{q_2-1}{2}$ 都是奇数，所以互反因子是 $-1$。并且 $q=q_1q_2 \\equiv 9 \\equiv 1 \\pmod 4$。\n$G(1,q) = (-1) G(1,q_1)G(1,q_2) = (-1)(i\\sqrt{q_1})(i\\sqrt{q_2}) = (-1)(i^2)\\sqrt{q_1q_2} = \\sqrt{q}$。这与 $q \\equiv 1 \\pmod 4$ 一致。\n对所有情况（$q_1, q_2 \\pmod 4$）进行系统性检查，确认了一般公式：\n$$G(1,q) = \\begin{cases} \\sqrt{q}  & \\text{若 } q \\equiv 1 \\pmod 4 \\\\ i\\sqrt{q} & \\text{若 } q \\equiv 3 \\pmod 4 \\end{cases}.$$\n结合这些结果，对于奇数 $q$，$G(a,q)$ 的显式公式是：\n$$G(a,q) = \\left(\\frac{a}{q}\\right) \\begin{cases} \\sqrt{q}  & \\text{若 } q \\equiv 1 \\pmod 4 \\\\ i\\sqrt{q} & \\text{若 } q \\equiv 3 \\pmod 4 \\end{cases}.$$\n\n**使用外尔差分法推导 $|G(a,q)|$**\n\n接下来，我们应用外尔差分法（也称为 van der Corput 方法）来求模 $|G(a,q)|$。我们考虑模的平方：\n$$|G(a,q)|^2 = \\left(\\sum_{n=0}^{q-1} \\exp\\left(\\frac{2\\pi i a n^2}{q}\\right)\\right) \\left(\\sum_{m=0}^{q-1} \\exp\\left(-\\frac{2\\pi i a m^2}{q}\\right)\\right) = \\sum_{n=0}^{q-1} \\sum_{m=0}^{q-1} \\exp\\left(\\frac{2\\pi i a (n^2-m^2)}{q}\\right).$$\n设 $n=m+h$，其中 $h$ 也遍历模 $q$ 的一个完全剩余系。\n$$|G(a,q)|^2 = \\sum_{m=0}^{q-1} \\sum_{h=0}^{q-1} \\exp\\left(\\frac{2\\pi i a ((m+h)^2 - m^2)}{q}\\right) = \\sum_{m=0}^{q-1} \\sum_{h=0}^{q-1} \\exp\\left(\\frac{2\\pi i a (2mh+h^2)}{q}\\right).$$\n我们可以交换求和顺序：\n$$|G(a,q)|^2 = \\sum_{h=0}^{q-1} \\exp\\left(\\frac{2\\pi i a h^2}{q}\\right) \\left(\\sum_{m=0}^{q-1} \\exp\\left(\\frac{2\\pi i (2ah)m}{q}\\right)\\right).$$\n内层的和是单位根的几何级数。如果 $2ah \\equiv 0 \\pmod q$，它等于 $q$，否则为 $0$。\n因为给定 $\\gcd(a,q)=1$，这个条件简化为 $2h \\equiv 0 \\pmod q$。我们根据 $q$ 的奇偶性来分析这个条件。\n\n情况1：$q$ 是奇数。\n因为 $\\gcd(2,q)=1$，同余式 $2h \\equiv 0 \\pmod q$ 意味着 $h \\equiv 0 \\pmod q$。在范围 $0 \\le h  q$ 内，唯一的解是 $h=0$。\n对于 $h=0$，内层的和是 $q$，外层的指数项是 $\\exp(0)=1$。对于 $h \\ne 0$ 的所有其他项都为零。\n因此，对于奇数 $q$：$$|G(a,q)|^2 = 1 \\cdot q = q \\implies |G(a,q)| = \\sqrt{q}.$$\n\n情况2：$q$ 是偶数。\n设 $q=2k$，其中 $k$ 是某个整数。同余式变为 $2h \\equiv 0 \\pmod{2k}$，这等价于 $h \\equiv 0 \\pmod k$。\n在范围 $0 \\le h  q=2k$ 内，$h$ 的解是 $h=0$ 和 $h=k=q/2$。\n$|G(a,q)|^2$ 的和有两个非零项：\n$$|G(a,q)|^2 = \\exp\\left(\\frac{2\\pi i a \\cdot 0^2}{q}\\right) \\cdot q + \\exp\\left(\\frac{2\\pi i a (q/2)^2}{q}\\right) \\cdot q$$\n$$|G(a,q)|^2 = q \\left(1 + \\exp\\left(\\frac{2\\pi i a q^2}{4q}\\right)\\right) = q \\left(1 + \\exp\\left(\\frac{\\pi i a q}{2}\\right)\\right).$$\n我们根据 $q \\pmod 4$ 的情况进一步分析。因为 $\\gcd(a,q)=1$ 且 $q$ 是偶数，所以 $a$ 必须是奇数。\n\n子情况 2a：$q \\equiv 2 \\pmod 4$。\n这意味着 $q = 4m+2$，其中 $m$ 是某个整数。那么 $q/2 = 2m+1$ 是奇数。\n$$|G(a,q)|^2 = q \\left(1 + \\exp\\left(\\frac{\\pi i a (4m+2)}{2}\\right)\\right) = q \\left(1 + \\exp(\\pi i a (2m+1))\\right).$$\n因为 $a$ 和 $2m+1$ 都是奇数，它们的乘积是奇数。因此 $\\exp(\\pi i \\cdot \\text{奇数}) = -1$。\n$$|G(a,q)|^2 = q(1-1) = 0 \\implies |G(a,q)| = 0.$$\n\n子情况 2b：$q \\equiv 0 \\pmod 4$。\n这意味着 $q=4m$，其中 $m$ 是某个整数。那么 $q/2 = 2m$ 是偶数。\n$$|G(a,q)|^2 = q \\left(1 + \\exp\\left(\\frac{\\pi i a (4m)}{2}\\right)\\right) = q \\left(1 + \\exp(2\\pi i am)\\right).$$\n因为 $am$ 是整数，所以 $\\exp(2\\pi i am) = 1$。\n$$|G(a,q)|^2 = q(1+1) = 2q \\implies |G(a,q)| = \\sqrt{2q}.$$\n\n总之，模 $|G(a,q)|$ 的精确平方根律是：\n$$|G(a,q)| = \\begin{cases} \\sqrt{q}  \\text{若 } q \\text{ 是奇数} \\\\ 0  \\text{若 } q \\equiv 2 \\pmod 4 \\\\ \\sqrt{2q}  \\text{若 } q \\equiv 0 \\pmod 4 \\end{cases}.$$\n\n按照要求组合最终答案，我们将奇数 $q$ 的求值与一般模的定律结合起来。\n对于奇数 $q$，设 $\\epsilon_q = 1$ 如果 $q \\equiv 1 \\pmod 4$，且 $\\epsilon_q = i$ 如果 $q \\equiv 3 \\pmod 4$。显式求值为 $G(a,q) = \\left(\\frac{a}{q}\\right) \\epsilon_q \\sqrt{q}$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nG(a,q) = \\left(\\frac{a}{q}\\right)\\sqrt{q} \\begin{cases} 1  \\text{若 } q \\equiv 1 \\pmod{4} \\\\ i  \\text{若 } q \\equiv 3 \\pmod{4} \\end{cases} \\quad (\\text{对奇数 } q) \\\\\n\\\\\n|G(a,q)| = \\begin{cases} \\sqrt{q}  \\text{若 } q \\text{ 是奇数} \\\\ 0  \\text{若 } q \\equiv 2 \\pmod{4} \\\\ \\sqrt{2q}  \\text{若 } q \\equiv 0 \\pmod{4} \\end{cases}\n\\end{pmatrix}\n}\n$$", "id": "3014046"}, {"introduction": "处理更高次的指数和是外尔差分法的主要目标。这个练习 [@problem_id:536214] 让我们预演了处理三次外尔和的关键一步。直接对一个三次和应用外尔差分法，会产生一个关于二次指数和的均值，而本题正是要求计算这样一个均值。完成这个计算，有助于我们熟悉在更高级应用中出现的表达式类型。", "problem": "在指数和的分析中，特别是在使用外尔差分法为形如 $S = \\sum_{n \\in A} \\exp(2\\pi i P(n))$ 的和式定界的背景下，一个关键步骤是应用柯西-施瓦茨不等式。对于一个三次多项式 $P(n) = \\alpha n^3 + \\dots$，这个过程通常会引导到对二次多项式和的研究。\n\n考虑一个集合 $A \\subseteq \\{0, 1, \\dots, q-1\\}$，其中 $q$ 是一个素数。为三次外尔和 $S_A = \\sum_{n \\in A} \\exp(2\\pi i n^3/q)$ 定界涉及为形如 $|S_A|^2$ 的表达式定界，这在应用柯西-施瓦茨不等式和三角不等式之后，又会引导到考虑二次指数和平方的均值。\n\n你的任务是计算这样一个均值的具体实例。设 $q$ 是一个素数，满足 $q  3$。定义量 $K_q$ 如下：\n$$ K_q = \\frac{1}{q} \\sum_{h=0}^{q-1} \\left| \\sum_{n=0}^{q-1} \\exp\\left(\\frac{2\\pi i}{q} (3n^2h + 3nh^2)\\right) \\right|^2 $$\n该表达式表示一族二次指数和的模的平方在模q的完全剩余系上的平均值。\n\n为了解决这个问题，你可以使用以下事实：对于素数 $q2$ 和整数 $a, b$，$a \\not\\equiv 0 \\pmod q$，二次高斯和的绝对值由下式给出：\n$$ \\left| \\sum_{x=0}^{q-1} \\exp\\left(\\frac{2\\pi i}{q} (ax^2+bx)\\right) \\right| = \\sqrt{q} $$\n请确定 $K_q$ 的精确值，并以 $q$ 的闭式表达式表示。", "solution": "问题要求计算量 $K_q$ 的值，它对素数 $q3$ 定义如下：\n$$ K_q = \\frac{1}{q} \\sum_{h=0}^{q-1} \\left| \\sum_{n=0}^{q-1} \\exp\\left(\\frac{2\\pi i}{q} (3n^2h + 3nh^2)\\right) \\right|^2 $$\n\n我们用 $S_h$ 表示内层的和：\n$$ S_h = \\sum_{n=0}^{q-1} \\exp\\left(\\frac{2\\pi i}{q} (3n^2h + 3nh^2)\\right) $$\n因此，$K_q = \\frac{1}{q} \\sum_{h=0}^{q-1} |S_h|^2$。\n\n我们可以对 $h \\in \\{0, 1, \\dots, q-1\\}$ 中的每个值计算 $|S_h|^2$。我们区分 $h=0$ 和 $h \\neq 0$ 两种情况。\n\n情况1：$h=0$。\n当 $h=0$ 时，和式中的指数为 $0$。\n$$ S_0 = \\sum_{n=0}^{q-1} \\exp(0) = \\sum_{n=0}^{q-1} 1 = q $$\n因此，在 $K_q$ 的和式中，对应于 $h=0$ 的项是 $|S_0|^2 = q^2$。\n\n情况2：$h \\in \\{1, 2, \\dots, q-1\\}$。\n对于任意这样的 $h$，$S_h$ 是一个关于求和变量 $n$ 的二次指数和（或高斯和）。我们来确定其系数。二次高斯和的一般形式为 $\\sum_{n=0}^{q-1} \\exp\\left(\\frac{2\\pi i}{q} (an^2+bn)\\right)$。\n通过比较各项，我们得到：\n$a = 3h$\n$b = 3h^2$\n\n因为 $q$ 是一个素数且 $q3$，并且 $h \\in \\{1, 2, \\dots, q-1\\}$，所以 $3$ 和 $h$ 都不是 $q$ 的倍数。因此，它们的乘积 $a = 3h$ 也不是 $q$ 的倍数，即 $a \\not\\equiv 0 \\pmod q$。\n\n问题中给出了这种和的模的恒等式：\n$$ |S_h| = \\left| \\sum_{n=0}^{q-1} \\exp\\left(\\frac{2\\pi i}{q} (3hn^2+3h^2n)\\right) \\right| = \\sqrt{q} $$\n将其平方，我们得到：\n$$ |S_h|^2 = q $$\n这对所有 $h \\in \\{1, 2, \\dots, q-1\\}$ 都成立。\n\n现在，我们可以计算 $K_q$ 的完整和式：\n$$ K_q = \\frac{1}{q} \\sum_{h=0}^{q-1} |S_h|^2 = \\frac{1}{q} \\left( |S_0|^2 + \\sum_{h=1}^{q-1} |S_h|^2 \\right) $$\n代入我们找到的值：\n$$ K_q = \\frac{1}{q} \\left( q^2 + \\sum_{h=1}^{q-1} q \\right) $$\n和式 $\\sum_{h=1}^{q-1} q$ 有 $q-1$ 项，每一项都等于 $q$。所以这个和是 $(q-1)q$。\n$$ K_q = \\frac{1}{q} (q^2 + (q-1)q) $$\n我们来简化括号内的表达式：\n$$ q^2 + (q-1)q = q^2 + q^2 - q = 2q^2 - q $$\n将此结果代回 $K_q$ 的表达式中：\n$$ K_q = \\frac{1}{q} (2q^2 - q) $$\n从分子中提出因子 $q$ 得到：\n$$ K_q = \\frac{q(2q - 1)}{q} = 2q - 1 $$\n\n因此，$K_q$ 的精确值是 $2q-1$。\n这个结果也可以通过展开模的平方并交换求和次序来得到，这是一种更基本的方法，但也会导致相同的分类讨论。\n$$\n\\begin{aligned}\nqK_q = \\sum_{h=0}^{q-1} \\sum_{n=0}^{q-1} \\sum_{m=0}^{q-1} \\exp\\left(\\frac{2\\pi i}{q} [3(n^2-m^2)h + 3(n-m)h^2]\\right) \\\\\n= \\sum_{n,m=0}^{q-1} \\sum_{h=0}^{q-1} \\exp\\left(\\frac{2\\pi i}{q} [3(n-m)(n+m)h + 3(n-m)h^2]\\right)\n\\end{aligned}\n$$\n如果 $n=m$，内层关于 $h$ 的和是 $\\sum_{h=0}^{q-1} 1 = q$。有 $q$ 对这样的 $(n,n)$，所以贡献是 $q \\cdot q = q^2$。\n如果 $n \\ne m$，内层的和是关于 $h$ 的高斯和，其系数为 $a'=3(n-m)$ 和 $b'=3(n-m)(n+m)$。因为 $q3$ 且 $n \\ne m$，所以 $a' \\not\\equiv 0 \\pmod q$。该和的模为 $\\sqrt{q}$。为了得到所有 $|S_h|^2$ 的和，我们需要对这些高斯和求和，但我们已经通过先计算每个 $|S_h|^2$ 的值更直接地处理了这个问题。最终结果保持不变。", "answer": "$$ \\boxed{2q-1} $$", "id": "536214"}]}