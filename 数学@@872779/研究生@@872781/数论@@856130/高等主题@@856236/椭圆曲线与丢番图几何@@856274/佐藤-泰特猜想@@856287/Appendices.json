{"hands_on_practices": [{"introduction": "理论上的理解最好能通过亲手计算来巩固。这项练习将引导我们回到最基本的定义，通过在小的有限域上逐点计数，来计算椭圆曲线的弗罗贝尼乌斯迹 $a_p(E)$。通过这个过程，我们不仅能具体地感受 $a_p(E)$ 这些数值是如何产生的，还能亲手验证哈斯界 (Hasse bound) 这一重要理论。[@problem_id:3029366]", "problem": "设 $E$ 是定义在 $\\mathbb{Q}$ 上的椭圆曲线，其方程为 $E: y^2 = x^3 - x$。对于一个具有良好约化（good reduction）的素数 $p$（即 $p \\nmid \\Delta(E)$），Frobenius 迹 $a_p(E)$ 由关系式 $a_p(E) := p + 1 - \\#E(\\mathbb{F}_p)$ 定义，其中 $\\#E(\\mathbb{F}_p)$ 表示 $E$ 上的 $\\mathbb{F}_p$-有理点的个数。Sato-Tate 猜想关注的是当 $p$ 变化时，归一化量 $a_p(E)/(2\\sqrt{p})$ 的统计分布。对于 $\\mathbb{Q}$ 上的任意椭圆曲线，Hasse 界 $|a_p(E)| \\leq 2\\sqrt{p}$ 均成立。曲线 $E$ 具有被 $\\mathbb{Z}[i]$ 的复乘（Complex Multiplication, CM），因此其 Sato-Tate 行为是非典型的，但 Hasse 界仍然成立。\n\n从有限域上椭圆曲线的基本定义以及通过二次剩余进行点计数的方法出发，计算素数 $p \\in \\{3, 5, 7, 11, 13\\}$ 对应的 $a_p(E)$。对于 $E$ 来说，这些都是良好素数。通过计算 $y^2 = x^3 - x$ 的解 $(x,y) \\in \\mathbb{F}_p \\times \\mathbb{F}_p$ 的数量，并加上无穷远点，来明确地确定 $\\#E(\\mathbb{F}_p)$，然后计算 $a_p(E) = p + 1 - \\#E(\\mathbb{F}_p)$。对于这些素数中的每一个，数值上验证 Hasse 界 $|a_p(E)| \\leq 2\\sqrt{p}$ 成立。\n\n将你计算出的值以单行向量 $\\bigl(a_3(E), a_5(E), a_7(E), a_{11}(E), a_{13}(E)\\bigr)$ 的形式报告。", "solution": "问题是要求计算椭圆曲线 $E: y^2 = x^3 - x$ 在素数集合 $p \\in \\{3, 5, 7, 11, 13\\}$ 上对应的 Frobenius 迹 $a_p(E)$。\n\n首先，我们验证问题的陈述。曲线为 $E: y^2 = x^3 - x$。其判别式为 $\\Delta = -16(4A^3 + 27B^2)$，其中 $A=-1$ 且 $B=0$。因此，$\\Delta = -16(4(-1)^3) = 64 = 2^6$。坏约化（bad reduction）素数是 $\\Delta$ 的素因子，这里只有 $p=2$。给定集合 $\\{3, 5, 7, 11, 13\\}$ 中的所有素数都是良好约化素数。问题陈述在科学上是合理的、自洽的且适定的。我们可以开始求解。\n\n$E$ 上的 $\\mathbb{F}_p$-有理点个数，记为 $\\#E(\\mathbb{F}_p)$，是满足曲线方程的点对 $(x, y) \\in \\mathbb{F}_p \\times \\mathbb{F}_p$ 的数量，再加上无穷远点 $\\mathcal{O}$。对每个 $x \\in \\mathbb{F}_p$，我们计算 $f(x) = x^3 - x$ 的值。方程 $y^2 = f(x)$ 的解 $y$ 的个数取决于 $f(x)$ 是模 $p$ 的二次剩余、二次非剩余还是零。\n- 如果 $f(x) = 0$，则 $y$ 有一个解，即 $y=0$。\n- 如果 $f(x)$ 是模 $p$ 的非零二次剩余，则 $y$ 有两个解。\n- 如果 $f(x)$ 是模 $p$ 的二次非剩余，则 $y$ 没有解。\n\n仿射点的个数是对所有可能的 $x \\in \\mathbb{F}_p$ 值，$y$ 的解的个数之和。\n$\\#E(\\mathbb{F}_p) = 1 + (\\text{仿射点个数})$。\n然后 Frobenius 迹可计算为 $a_p(E) = p + 1 - \\#E(\\mathbb{F}_p)$。\n\n我们现在对每个指定的素数计算 $a_p(E)$。\n\n**情况1：$p=3$**\n我们在 $\\mathbb{F}_3 = \\{0, 1, 2\\}$ 中计算。\n$f(x) = x^3 - x$ 的值为：\n- $x=0: f(0)=0^3 - 0 = 0$。这给出了一个 $y$ 的解，$y=0$。点：$(0,0)$。\n- $x=1: f(1)=1^3 - 1 = 0$。这给出了一个 $y$ 的解，$y=0$。点：$(1,0)$。\n- $x=2: f(2)=2^3 - 2 = 8-2 = 6 \\equiv 0 \\pmod 3$。这给出了一个 $y$ 的解，$y=0$。点：$(2,0)$。\n仿射点的个数是 $1+1+1=3$。\n$\\#E(\\mathbb{F}_3) = 1 + 3 = 4$。\n$a_3(E) = 3 + 1 - \\#E(\\mathbb{F}_3) = 4 - 4 = 0$。\nHasse 界验证：$|a_3(E)| \\leq 2\\sqrt{3} \\implies 0 \\leq 2\\sqrt{3} \\approx 3.46$。此不等式成立。\n\n**情况2：$p=5$**\n我们在 $\\mathbb{F}_5 = \\{0, 1, 2, 3, 4\\}$ 中计算。二次剩余为 $\\{1^2, 2^2\\} \\pmod 5 = \\{1, 4\\}$。\n$f(x) = x^3 - x$ 的值为：\n- $x=0: f(0)=0$。一个 $y$ 的解：$(0,0)$。\n- $x=1: f(1)=0$。一个 $y$ 的解：$(1,0)$。\n- $x=2: f(2)=2^3 - 2 = 6 \\equiv 1 \\pmod 5$。二次剩余。两个 $y$ 的解：$y=\\pm 1 \\equiv 1, 4$。点：$(2,1), (2,4)$。\n- $x=3: f(3)=3^3 - 3 = 24 \\equiv 4 \\pmod 5$。二次剩余。两个 $y$ 的解：$y=\\pm 2 \\equiv 2, 3$。点：$(3,2), (3,3)$。\n- $x=4: f(4)=4^3 - 4 = 60 \\equiv 0 \\pmod 5$。一个 $y$ 的解：$(4,0)$。\n仿射点的个数是 $1+1+2+2+1=7$。\n$\\#E(\\mathbb{F}_5) = 1 + 7 = 8$。\n$a_5(E) = 5 + 1 - \\#E(\\mathbb{F}_5) = 6 - 8 = -2$。\nHasse 界验证：$|a_5(E)| \\leq 2\\sqrt{5} \\implies |-2| \\leq 2\\sqrt{5} \\implies 2 \\leq 2(2.236...) \\approx 4.47$。此不等式成立。\n\n**情况3：$p=7$**\n我们在 $\\mathbb{F}_7 = \\{0, ..., 6\\}$ 中计算。二次剩余为 $\\{1^2, 2^2, 3^2\\} \\pmod 7 = \\{1, 4, 2\\}$。\n$f(x) = x^3 - x$ 的值为：\n- $x=0: f(0)=0$。一个 $y$ 的解。\n- $x=1: f(1)=0$。一个 $y$ 的解。\n- $x=2: f(2)=2^3 - 2 = 6$。二次非剩余。零个解。\n- $x=3: f(3)=3^3 - 3 = 24 \\equiv 3 \\pmod 7$。二次非剩余。零个解。\n- $x=4: f(4)=4^3 - 4 = 60 \\equiv 4 \\pmod 7$。二次剩余。两个 $y$ 的解。\n- $x=5: f(5)=5^3 - 5 = 120 \\equiv 1 \\pmod 7$。二次剩余。两个 $y$ 的解。\n- $x=6: f(6)=6^3 - 6 = 210 \\equiv 0 \\pmod 7$。一个 $y$ 的解。\n仿射点的个数是 $1+1+0+0+2+2+1=7$。\n$\\#E(\\mathbb{F}_7) = 1 + 7 = 8$。\n$a_7(E) = 7 + 1 - \\#E(\\mathbb{F}_7) = 8 - 8 = 0$。\nHasse 界验证：$|a_7(E)| \\leq 2\\sqrt{7} \\implies 0 \\leq 2\\sqrt{7} \\approx 5.29$。此不等式成立。\n\n**情况4：$p=11$**\n我们在 $\\mathbb{F}_{11}$ 中计算。二次剩余为 $\\{1^2, 2^2, 3^2, 4^2, 5^2\\} \\pmod{11} = \\{1, 4, 9, 5, 3\\}$。\n$f(x) = x^3 - x$ 的值为：\n- $x=0: f(0)=0$。一个 $y$ 的解。\n- $x=1: f(1)=0$。一个 $y$ 的解。\n- $x=2: f(2)=6$。非剩余。零个解。\n- $x=3: f(3)=24 \\equiv 2$。非剩余。零个解。\n- $x=4: f(4)=60 \\equiv 5$。剩余。两个解。\n- $x=5: f(5)=120 \\equiv 10$。非剩余。零个解。\n- $x=6: f(6)=210 \\equiv 1$。剩余。两个解。\n- $x=7: f(7)=336 \\equiv 6$。非剩余。零个解。\n- $x=8: f(8)=504 \\equiv 9$。剩余。两个解。\n- $x=9: f(9)=720 \\equiv 5$。剩余。两个解。\n- $x=10: f(10)=990 \\equiv 0$。一个 $y$ 的解。\n仿射点的个数是 $1+1+0+0+2+0+2+0+2+2+1=11$。\n$\\#E(\\mathbb{F}_{11}) = 1 + 11 = 12$。\n$a_{11}(E) = 11 + 1 - \\#E(\\mathbb{F}_{11}) = 12 - 12 = 0$。\nHasse 界验证：$|a_{11}(E)| \\leq 2\\sqrt{11} \\implies 0 \\leq 2\\sqrt{11} \\approx 6.63$。此不等式成立。\n\n**情况5：$p=13$**\n我们在 $\\mathbb{F}_{13}$ 中计算。二次剩余为 $\\{1^2,...,6^2\\} \\pmod{13} = \\{1, 4, 9, 3, 12, 10\\}$。\n$f(x) = x^3 - x$ 的值为：\n- $x=0: f(0)=0$。一个解。\n- $x=1: f(1)=0$。一个解。\n- $x=2: f(2)=6$。非剩余。零个解。\n- $x=3: f(3)=24 \\equiv 11$。非剩余。零个解。\n- $x=4: f(4)=60 \\equiv 8$。非剩余。零个解。\n- $x=5: f(5)=120 \\equiv 3$。剩余。两个解。\n- $x=6: f(6)=210 \\equiv 2$。非剩余。零个解。\n- $x=7: f(7)=336 \\equiv 11$。非剩余。零个解。\n- $x=8: f(8)=504 \\equiv 10$。剩余。两个解。\n- $x=9: f(9)=720 \\equiv 5$。非剩余。零个解。\n- $x=10: f(10)=990 \\equiv 2$。非剩余。零个解。\n- $x=11: f(11)=1320 \\equiv 11$。非剩余。零个解。\n- $x=12: f(12)=(-1)^3 - (-1)=0$。一个解。\n仿射点的个数是 $1+1+0+0+0+2+0+0+2+0+0+0+1=7$。\n$\\#E(\\mathbb{F}_{13}) = 1 + 7 = 8$。\n$a_{13}(E) = 13 + 1 - \\#E(\\mathbb{F}_{13}) = 14 - 8 = 6$。\nHasse 界验证：$|a_{13}(E)| \\leq 2\\sqrt{13} \\implies |6| \\leq 2\\sqrt{13} \\implies 6 \\leq 2(3.605...) \\approx 7.21$。此不等式成立。\n\n计算出的值为：\n$a_3(E) = 0$\n$a_5(E) = -2$\n$a_7(E) = 0$\n$a_{11}(E) = 0$\n$a_{13}(E) = 6$\n\n最终结果是行向量 $(a_3(E), a_5(E), a_7(E), a_{11}(E), a_{13}(E))$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  -2  0  0  6\n\\end{pmatrix}\n}\n$$", "id": "3029366"}, {"introduction": "在上一项练习中，我们可能会注意到对于特定曲线 $y^2 = x^3 - x$，计算出的弗罗贝尼乌斯迹 $a_p(E)$ 值频繁地为零。这个现象并非偶然，而是具有复数乘法 (Complex Multiplication, CM) 的椭圆曲线的一个深刻特性。这项理论练习将揭示其背后的数学原理，运用切博塔廖夫密度定理 (Chebotarev density theorem) 来精确计算 $a_p = 0$ 的素数密度，从而阐明为什么CM曲线的统计行为与非CM曲线的佐藤-泰特分布有着本质区别。[@problem_id:3029344]", "problem": "设 $E/\\mathbf{Q}$ 是一条椭圆曲线，其具有由虚二次域 $K$ 的整环 $\\mathcal{O}_{K}$ 实现的复乘（CM）。记 $N$ 为 $E$ 的导子，对于每个不整除 $N$ 的有理素数 $p$，记 $a_{p} := p + 1 - |E(\\mathbf{F}_{p})|$，这是Frobenius自同态作用在第一\\'etale上同调群 $H^{1}_{\\mathrm{\\'et}}(E_{\\overline{\\mathbf{Q}}}, \\mathbf{Q}_{\\ell})$ 上的迹，其中 $\\ell \\neq p$ 为任意素数。考虑自然密度\n$$\nd := \\lim_{x \\to \\infty} \\frac{\\#\\{\\, p \\leq x \\text{ prime} : p \\nmid N \\text{ and } a_{p} = 0 \\,\\}}{\\#\\{\\, p \\leq x \\text{ prime} \\,\\}}.\n$$\n从关于CM椭圆曲线、K的Hecke (Gr\\\"ossen-)特征标以及扩张 $K/\\mathbf{Q}$ 的Chebotarev密度定理等基本事实出发，通过将条件 $a_{p} = 0$ 与 $p$ 在 $K/\\mathbf{Q}$ 中的分解行为联系起来，然后通过Chebotarev定理计算密度，来确定 $d$ 的精确值。请将最终答案表示为最简形式的单个有理数。无需四舍五入，也无需报告单位。", "solution": "问题要求计算自然密度 $d$，即对于一条具有由虚二次域 $K$ 的整环 $\\mathcal{O}_K$ 实现的复乘（CM）的椭圆曲线 $E/\\mathbf{Q}$，其Frobenius迹 $a_p$ 为零的有理素数 $p$ 的集合的自然密度。素数的集合被限制为那些 $E$ 具有好约化的素数，即 $p \\nmid N$，其中 $N$ 是 $E$ 的导子。\n\nFrobenius迹 $a_p$ 定义为 $a_p = p + 1 - \\#E(\\mathbf{F}_p)$，其中 $E(\\mathbf{F}_p)$ 是 $E$ 模 $p$ 约化后的点群。复乘理论中的一个基本结果（由Max Deuring得出）将 $a_p$ 的值与CM域 $K$ 的算术性质联系起来。\n\n对于 $E$ 具有好约化的素数 $p$，条件 $a_p = 0$ 等价于有限域 $\\mathbf{F}_p$ 上的约化曲线 $E_p := E \\pmod{p}$ 是超奇异的。\n\nDeuring的超奇异性判别法指出，对于一条由虚二次域 $K$ 中的一个序实现复乘的椭圆曲线，其在好约化素数 $p$ 处的约化 $E_p$ 是超奇异的，当且仅当素数 $p$ 在域 $K$ 中不分解。\n\n我们所考虑的素数 $p$ 不整除导子 $N$。CM椭圆曲线理论中的一个标准结果是，域 $K$ 的判别式的任何素因子都必须是导子 $N$ 的因子。因此，如果 $p \\nmid N$，那么 $p$ 在扩张 $K/\\mathbf{Q}$ 中是非分歧的。\n\n对于二次扩张 $K/\\mathbf{Q}$ 中的一个非分歧素数 $p$，其分解行为有两种可能：要么 $p$ 在 $\\mathcal{O}_K$ 中分解为两个不同的素理想，要么 $p$ 保持为素（即惰性）。因此，对于一个非分歧素数，$p$ 不分解的条件等价于 $p$ 在 $K$ 中是惰性的。\n\n综合这些事实，对于素数 $p \\nmid N$，条件 $a_p = 0$ 等价于 $p$ 在二次扩张 $K/\\mathbf{Q}$ 中是一个惰性素数。因此，问题化归为计算在 $K$ 中惰性的素数的密度。\n\n这个密度可以使用Chebotarev密度定理来确定。扩张 $K/\\mathbf{Q}$ 是一个Galois扩张，因为它是一个二次扩张。其次数为 $[K:\\mathbf{Q}] = 2$。相关的Galois群 $G := \\text{Gal}(K/\\mathbf{Q})$ 是一个2阶群，包含单位元 $e$ 和一个非平凡元 $\\sigma$，后者对应于复共轭。\n\nChebotarev密度定理指出，对于一个Galois群为 $G$ 的数域Galois扩张 $L/F$，F的非分歧素数 $\\mathfrak{p}$（其在 $G$ 中的Frobenius共轭类为给定的类 $C$）的集合具有等于 $|C|/|G|$ 的自然密度。\n\n在我们的情况中，$F = \\mathbf{Q}$ 且 $L = K$。群 $G$ 是阿贝尔群，所以每个共轭类都只包含一个元素。群 $G$ 有两个这样的类：$\\{e\\}$ 和 $\\{\\sigma\\}$。一个非分歧有理素数 $p$ 在 $K$ 中的分解行为由其Frobenius元 $\\text{Frob}_p \\in G$ 决定：\n- 素数 $p$ 在 $K$ 中分解，当且仅当其Frobenius元是单位元：$\\text{Frob}_p = e$。\n- 素数 $p$ 在 $K$ 中是惰性的，当且仅当其Frobenius元是非平凡元：$\\text{Frob}_p = \\sigma$。\n\n根据Chebotarev密度定理，惰性素数的密度就是使得 $\\text{Frob}_p = \\sigma$ 的素数 $p$ 的密度。该密度由以下公式给出：\n$$\n\\text{density of inert primes} = \\frac{|\\{\\sigma\\}|}{|G|} = \\frac{1}{2}\n$$\n类似地，分解素数的密度是 $\\frac{|\\{e\\}|}{|G|} = \\frac{1}{2}$。分歧素数构成一个有限集，因此密度为0。\n\n问题陈述 $E$ 定义在 $\\mathbf{Q}$ 上，且其CM环为整环 $\\mathcal{O}_K$。这意味着 $K$ 的Hilbert类域包含在 $\\mathbf{Q}(j(E))$ 中，而后者即是 $\\mathbf{Q}$。这只有在 $K$ 的类数 $h_K$为1时才可能。类数为1的虚二次域为 $K = \\mathbf{Q}(\\sqrt{-m})$，其中 $m \\in \\{1, 2, 3, 7, 11, 19, 43, 67, 163\\}$。然而，惰性素数密度的计算仅取决于扩张 $K/\\mathbf{Q}$ 的次数，对于任何虚二次域，该次数均为2。$K$ 的具体选择（从允许的列表中）不会改变结果。\n\n密度 $d$ 是使得 $a_p=0$ 的素数 $p$（不包括整除 $N$ 的有限集）的密度。这等价于在 $K$ 中惰性的素数的密度。因此，$d$ 的值为 $1/2$。", "answer": "$$\\boxed{\\frac{1}{2}}$$", "id": "3029344"}, {"introduction": "在理解了基本量的计算方法并辨析了CM曲线的特殊性之后，我们现在转向佐藤-泰特猜想的核心内容：非CM曲线的弗罗贝尼乌斯迹的统计分布。这项计算实践要求我们编写程序，为一条非CM椭圆曲线生成大量的 $a_p$ 值，并将它们归一化为角度 $\\theta_p$。通过绘制这些角度的经验分布直方图，我们可以直观地将经验数据与理论上的佐藤-泰特分布（即 $\\frac{2}{\\pi}\\sin^2\\theta$ 曲线）进行比较，从而“亲眼见证”这一深刻猜想的正确性。[@problem_id:3029369]", "problem": "您需要实现一个完整的、可运行的程序，该程序为有理数域 $\\mathbb{Q}$ 上的一个特定的非复数乘法（non-CM）椭圆曲线计算 Hecke 特征值 $a_p$ 的一个有限样本，使用经典的 Frobenius 迹范数化方法将它们范数化为角度 $\\theta_p \\in [0,\\pi]$，并实证地将其分布与 Sato-Tate 密度进行比较。该任务必须纯粹用数学术语来描述和解决，且必须从基本定义和经过充分检验的事实出发。\n\n待使用的基本定义和事实：\n- $\\mathbb{Q}$ 上的椭圆曲线 $E$ 可以由一个 $\\mathbb{Q}$ 上的短 Weierstrass 模型给出；当模一个好约化素数 $p$ 进行约化时，$E$ 在有限域 $\\mathbb{F}_p$ 上定义了一条非奇异曲线。\n- 对于一个好约化素数 $p$，定义 $N_p = \\#E(\\mathbb{F}_p)$，即约化曲线上 $\\mathbb{F}_p$-有理点的数量，包括无穷远点。Frobenius 迹为 $a_p = p + 1 - N_p$。\n- 根据 Hasse 界，我们有 $|a_p| \\leq 2\\sqrt{p}$，因此范数化 $a_p = 2\\sqrt{p}\\cos(\\theta_p)$ 定义了一个角度 $\\theta_p \\in [0,\\pi]$（角度必须以弧度表示）。\n- 对于 $\\mathbb{Q}$ 上的非复数乘法椭圆曲线，Sato-Tate 猜想（现已是定理）预测 $\\theta_p$ 在 $[0,\\pi]$ 上根据概率密度 $\\mu(\\theta) = \\frac{2}{\\pi}\\sin^2\\theta$ 分布。\n\n曲线规格：\n- 处理由 $y^2 + y = x^3 - x$ 给出的椭圆曲线 $E$，这是一条判别式为 $\\Delta = 37$ 的非复数乘法曲线。因此，坏约化素数是那些整除 $37$ 的素数，即 $p=37$。对于 $p \\neq 37$，约化是好的。当 $p$ 是一个好约化素数时，计算 $\\mathbb{F}_p$ 上的点数并计算 $a_p$。\n\n在 $\\mathbb{F}_p$ 上计数点：\n- 对于每个素数 $p \\neq 37$，计数 $y^2 + y \\equiv x^3 - x \\pmod{p}$ 的解 $(x,y) \\in \\mathbb{F}_p^2$，并加上无穷远点对应的 1，以得到 $N_p$。\n- 对于奇素数 $p$，对于任意固定的 $x \\in \\mathbb{F}_p$，关于 $y$ 的方程是首一二次方程 $y^2 + y - r \\equiv 0 \\pmod{p}$，其中 $r \\equiv x^3 - x \\pmod{p}$。其判别式为 $D_x \\equiv 1 + 4r \\pmod{p}$。满足该方程的 $y$ 的数量为：\n  - 2，如果 $D_x$ 是模 $p$ 的非零二次剩余，\n  - 1，如果 $D_x \\equiv 0 \\pmod{p}$，\n  - 0，如果 $D_x$ 是模 $p$ 的非二次剩余。\n- 对于 $p = 2$，通过暴力方法直接处理计数，因为二次剩余判则不以相同的方式适用。\n\n范数化和直方图：\n- 对于每个好素数 $p$，计算 $a_p$，然后以弧度为单位计算 $\\theta_p = \\arccos\\!\\left(\\frac{a_p}{2\\sqrt{p}}\\right)$。\n- 对于给定的区间（bin）数量 $B$，通过将 $[0,\\pi]$ 划分成 $B$ 个等宽的区间来形成一个经验直方图，并计算落入每个区间的 $\\theta_p$ 的比例。定义区间为 $[\\theta_i, \\theta_{i+1})$（对于 $i = 0,1,\\dots,B-2$）和 $[\\theta_{B-1}, \\theta_B]$（对于最后一个区间），其中 $\\theta_i = \\frac{i\\pi}{B}$。\n- 在 Sato-Tate 密度 $\\mu(\\theta) = \\frac{2}{\\pi}\\sin^2\\theta$ 下，一个区间 $[\\alpha,\\beta]$ 内的期望质量由下式给出：\n  $$\\int_{\\alpha}^{\\beta} \\frac{2}{\\pi}\\sin^2\\theta \\, d\\theta = \\frac{1}{\\pi}\\left(\\beta - \\alpha\\right) - \\frac{1}{2\\pi}\\left(\\sin(2\\beta) - \\sin(2\\alpha)\\right).$$\n\n待计算的度量指标：\n- 设 $n$ 是已处理的好素数的数量（即 $p \\leq N$ 的素数，不包括 $p=37$）。\n- 计算以下度量指标，以比较经验直方图比例 $e_i$ 和期望区间质量 $m_i$：\n  1. $\\ell^1$ 距离 $L_1 = \\sum_{i=1}^B |e_i - m_i|$。\n  2. 上确界范数 $L_\\infty = \\max_{i} |e_i - m_i|$。\n  3. Kolmogorov-Smirnov 型距离 $D_{\\mathrm{KS}} = \\max_{k} \\left| \\sum_{i=1}^{k} e_i - \\sum_{i=1}^{k} m_i \\right|$。\n  4. Pearson 卡方统计量 $\\chi^2 = \\sum_{i=1}^B \\frac{(o_i - n m_i)^2}{n m_i}$，其中 $o_i$ 是区间 $i$ 中的整数计数。\n\n测试套件：\n- 您的程序必须运行以下五个测试用例，每个用例由一对 $(N,B)$ 定义：\n  1. $(N,B) = (1000, 12)$\n  2. $(N,B) = (100, 8)$\n  3. $(N,B) = (10000, 20)$\n  4. $(N,B) = (50, 4)$\n  5. $(N,B) = (2000, 2)$\n- 对于每个测试用例，计算列表 $[n, L_1, L_\\infty, D_{\\mathrm{KS}}, \\chi^2]$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含五个按测试用例排列的结果列表，格式需完全一致：\n  - 一个单行的 Python 列表的列表的字符串表示，其中每个内部列表是按所提供顺序排列的一个测试用例的结果。例如，输出必须如下所示：\n  $$[ [n_1, L1_1, Linf_1, KS_1, chi2_1], [n_2, L1_2, Linf_2, KS_2, chi2_2], \\dots, [n_5, L1_5, Linf_5, KS_5, chi2_5] ]$$\n- 角度必须以弧度为单位，所有实数值量必须在列表中以 Python 浮点数形式打印。不得打印任何额外文本。", "solution": "问题要求对有理数域 $\\mathbb{Q}$ 上由方程 $y^2 + y = x^3 - x$ 给出的非复数乘法椭圆曲线 $E$ 的 Sato-Tate 猜想进行实证检验。该曲线的判别式为 $\\Delta = 37$，因此它在所有 $p \\neq 37$ 的素数处都有好约化。检验过程包括计算上限为 $N$ 的好素数的 Sato-Tate 角 $\\theta_p$ 的分布，并使用多种统计度量将此经验分布与理论上的 Sato-Tate 分布进行比较。\n\n首先，我们必须生成一个直到指定最大值 $N$ 的素数列表。Eratosthenes 筛法是实现此目的的高效算法。设这组素数为 $\\mathcal{P}_N = \\{p \\le N \\mid p \\text{ 是素数}\\}$。\n\n对于每个 $p \\in \\mathcal{P}_N$ 且 $p \\neq 37$ 的素数，我们计算曲线 $E$ 在有限域 $\\mathbb{F}_p$ 上的点数，记为 $N_p = \\#E(\\mathbb{F}_p)$。曲线模 $p$ 的方程为 $y^2 + y \\equiv x^3 - x \\pmod p$。总点数 $N_p$ 是满足同余式的仿射点 $(x, y) \\in \\mathbb{F}_p \\times \\mathbb{F}_p$ 的数量与无穷远点（计为1）之和。\n\n计数点的方法取决于素数 $p$：\n- 对于素数 $p=2$，方程变为 $y^2+y \\equiv x^3-x \\pmod 2$。由于对于任意 $z \\in \\mathbb{F}_2$ 和 $k \\ge 1$ 都有 $z^k \\equiv z \\pmod 2$，我们有 $x^3-x \\equiv x-x \\equiv 0 \\pmod 2$。方程简化为 $y^2+y \\equiv 0 \\pmod 2$。这对 $y=0$ 和 $y=1$ 都成立。因此，对于 $x \\in \\{0, 1\\}$ 的两个值中的每一个，都有两个 $y$ 的解。这给出了 $2 \\times 2 = 4$ 个仿射点。包括无穷远点在内，$N_2 = 4 + 1 = 5$。\n\n- 对于奇素数 $p \\neq 37$，我们可以对变量 $y$ 进行配方。方程 $y^2 + y - (x^3-x) \\equiv 0 \\pmod p$ 对于每个固定的 $x \\in \\mathbb{F}_p$ 都是一个关于 $y$ 的二次方程。$y$ 的解的数量由其判别式 $D_x = 1^2 - 4(1)(-(x^3-x)) = 1+4(x^3-x)$ 决定。$y$ 的解的数量由 $1 + \\left(\\frac{D_x}{p}\\right)$ 给出，其中 $\\left(\\frac{a}{p}\\right)$ 是 Legendre 符号。如果 $a$ 是模 $p$ 的非零二次剩余，则其值为 $1$；如果 $a$ 是二次非剩余，则为 $-1$；如果 $a \\equiv 0 \\pmod p$，则为 $0$。仿射点的总数通过对所有可能的 $x$ 值求和得到：\n$$ \\sum_{x \\in \\mathbb{F}_p} \\left(1 + \\left(\\frac{1+4(x^3-x)}{p}\\right)\\right) $$\n因此，曲线在 $\\mathbb{F}_p$ 上的总点数为：\n$$ N_p = 1 + \\sum_{x=0}^{p-1} \\left(1 + \\left(\\frac{1+4(x^3-x)}{p}\\right)\\right) $$\n\n一旦确定了 $N_p$，就可以计算 Frobenius 自同态的迹 $a_p$：\n$$ a_p = p + 1 - N_p $$\n根据 Hasse 定理，我们保证 $|a_p| \\le 2\\sqrt{p}$。这允许通过关系式将 $a_p$ 范数化为一个角度 $\\theta_p \\in [0, \\pi]$（以弧度为单位）：\n$$ a_p = 2\\sqrt{p}\\cos(\\theta_p) \\implies \\theta_p = \\arccos\\left(\\frac{a_p}{2\\sqrt{p}}\\right) $$\n对于像指定曲线这样的非复数乘法椭圆曲线，Sato-Tate 猜想（现已是定理）指出，角度 $\\theta_p$ 在 $[0, \\pi]$ 上根据概率密度函数 $\\mu(\\theta)$ 分布：\n$$ \\mu(\\theta) = \\frac{2}{\\pi}\\sin^2\\theta $$\n\n为了将计算出的 $\\theta_p$ 值的经验分布与理论上的 Sato-Tate 分布进行比较，我们构建一个直方图。区间 $[0, \\pi]$ 被划分为 $B$ 个等宽的区间（bin）。第 $i$ 个区间（对于 $i \\in \\{0, 1, \\dots, B-1\\}$）是 $[\\frac{i\\pi}{B}, \\frac{(i+1)\\pi}{B}]$。我们收集所有好素数 $p \\le N$ 的角度 $\\theta_p$，并设 $n$ 为这些角度的总数。落入第 $i$ 个区间的角度数量记为 $o_i$。第 $i$ 个区间的经验比例为 $e_i = o_i/n$。\n\n第 $i$ 个区间中角度的期望比例 $m_i$ 由 Sato-Tate 密度在该区间的间隔 $[\\alpha, \\beta]$ 上的积分给出：\n$$ m_i = \\int_{\\alpha_i}^{\\beta_i} \\frac{2}{\\pi}\\sin^2\\theta \\, d\\theta = \\int_{\\alpha_i}^{\\beta_i} \\frac{2}{\\pi}\\frac{1-\\cos(2\\theta)}{2} \\, d\\theta = \\frac{1}{\\pi} \\left[\\theta - \\frac{\\sin(2\\theta)}{2}\\right]_{\\alpha_i}^{\\beta_i} $$\n其中 $\\alpha_i = i\\pi/B$ 且 $\\beta_i = (i+1)\\pi/B$。这与所提供的公式相符。\n\n最后，我们计算四个统计度量来量化经验比例 $e_i$ 和期望比例 $m_i$ 之间的偏差：\n1.  $\\ell^1$ 距离：$L_1 = \\sum_{i=0}^{B-1} |e_i - m_i|$。\n2.  上确界范数：$L_\\infty = \\max_{0 \\le i  B} |e_i - m_i|$。\n3.  分箱数据的 Kolmogorov-Smirnov 型距离：$D_{\\mathrm{KS}} = \\max_{0 \\le k  B} \\left| \\sum_{i=0}^{k} e_i - \\sum_{i=0}^{k} m_i \\right|$。\n4.  Pearson 卡方统计量：$\\chi^2 = \\sum_{i=0}^{B-1} \\frac{(o_i - n m_i)^2}{n m_i}$。\n\n此过程对测试套件中提供的每一对 $(N, B)$ 执行，并收集每种情况的结果 $[n, L_1, L_\\infty, D_{\\mathrm{KS}}, \\chi^2]$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes statistical metrics related to the Sato-Tate conjecture for the\n    elliptic curve y^2 + y = x^3 - x.\n    \"\"\"\n    test_cases = [\n        (1000, 12),\n        (100, 8),\n        (10000, 20),\n        (50, 4),\n        (2000, 2),\n    ]\n\n    all_results = []\n\n    # Memoization for prime generation to avoid re-computation\n    _prime_cache = {}\n    def get_primes(n):\n        if n in _prime_cache:\n            return _prime_cache[n]\n        \n        sieve = np.ones(n + 1, dtype=bool)\n        sieve[0:2] = False\n        for i in range(2, int(np.sqrt(n)) + 1):\n            if sieve[i]:\n                sieve[i*i::i] = False\n        primes = np.nonzero(sieve)[0]\n        _prime_cache[n] = primes\n        return primes\n\n    def legendre_symbol(a, p):\n        \"\"\"Computes the Legendre symbol (a/p).\"\"\"\n        if a % p == 0:\n            return 0\n        ls = pow(a, (p - 1) // 2, p)\n        if ls == p - 1:\n            return -1\n        return ls\n\n    def count_points(p):\n        \"\"\"Counts the number of points on E(F_p).\"\"\"\n        if p == 2:\n            return 5\n        \n        # for odd p\n        # N_p = 1 + sum_{x in F_p} (1 + legendre(1 + 4(x^3-x), p))\n        # N_p = 1 + p + sum_{x in F_p} legendre(1 + 4(x^3-x), p)\n        num_points = 1 + p\n        s = 0\n        for x in range(p):\n            # Using Python's integers for precision before modulo\n            r = (pow(x, 3, p) - x) % p\n            d_x = (1 + 4 * r) % p\n            s += legendre_symbol(d_x, p)\n        num_points += s\n        return num_points\n\n    for N, B in test_cases:\n        primes = get_primes(N)\n        thetas = []\n\n        for p_int in primes:\n            p = int(p_int) # Convert from numpy int to python int\n            if p == 37:\n                continue\n\n            # Compute N_p, the number of points\n            Np = count_points(p)\n            \n            # Compute a_p, the trace of Frobenius\n            ap = p + 1 - Np\n            \n            # Compute the angle theta_p\n            # Hasse's bound |ap| = 2*sqrt(p) guarantees the arg is in [-1, 1]\n            arg = ap / (2 * np.sqrt(p))\n            # Clamp arg due to potential floating point inaccuracies\n            arg = np.clip(arg, -1.0, 1.0)\n            theta_p = np.arccos(arg)\n            thetas.append(theta_p)\n\n        n = len(thetas)\n        \n        # Empirical distribution\n        o, _ = np.histogram(thetas, bins=B, range=(0, np.pi))\n        e = o / n\n        \n        # Expected distribution\n        bin_edges = np.linspace(0, np.pi, B + 1)\n        m = np.zeros(B)\n        sato_tate_integral = lambda x: (x - 0.5 * np.sin(2*x)) / np.pi\n        for i in range(B):\n            alpha = bin_edges[i]\n            beta = bin_edges[i+1]\n            m[i] = sato_tate_integral(beta) - sato_tate_integral(alpha)\n            \n        # Compute metrics\n        abs_diff = np.abs(e - m)\n        L1 = np.sum(abs_diff)\n        L_inf = np.max(abs_diff) if abs_diff.size  0 else 0\n        \n        cum_e = np.cumsum(e)\n        cum_m = np.cumsum(m)\n        D_KS = np.max(np.abs(cum_e - cum_m)) if cum_e.size  0 else 0\n\n        # Pearson chi-square statistic\n        expected_counts = n * m\n        # Avoid division by zero if an expected count is zero\n        # (though unlikely for this continuous distribution)\n        chi2_terms = np.divide((o - expected_counts)**2, expected_counts, \n                               out=np.zeros_like(expected_counts, dtype=float), \n                               where=expected_counts!=0)\n        chi2 = np.sum(chi2_terms)\n\n        all_results.append([n, L1, L_inf, D_KS, chi2])\n\n    # Final print statement in the exact required format.\n    # The string representation of a list of lists.\n    print(str(all_results))\n\nsolve()\n\n```", "id": "3029369"}]}