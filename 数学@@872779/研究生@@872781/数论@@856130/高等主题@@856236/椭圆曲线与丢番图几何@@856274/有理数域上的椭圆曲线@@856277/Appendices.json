{"hands_on_practices": [{"introduction": "椭圆曲线的核心特征之一是其上的点构成一个阿贝尔群。这个群结构并非凭空而来，而是源于一个优美的几何构造：弦切法。本练习旨在通过第一性原理，将这个几何直觉转化为具体的代数公式，从而让你亲手推导出点加法和倍点运算的表达式[@problem_id:3013188]。完成这个推导将深刻揭示几何与代数之间的联系，并为你掌握椭圆曲线上的计算打下坚实基础。", "problem": "考虑定义在有理数域 $\\mathbb{Q}$ 上的椭圆曲线，其短 Weierstrass 形式为 $$E: y^{2} = x^{3} + a x + b,$$ 其中 $a,b \\in \\mathbb{Q}$ 且判别式 $\\Delta = -16\\left(4a^{3}+27b^{2}\\right)$ 非零，以确保曲线非奇异。$E(\\mathbb{Q})$ 上的群律由弦切构造几何定义：对于 $E$ 上的两个点 $P=(x_{1},y_{1})$ 和 $Q=(x_{2},y_{2})$，其中 $P \\neq Q$，过 $P$ 和 $Q$ 的直线与 $E$ 交于第三点 $R$，定义 $P+Q$ 为 $R$ 关于 $x$ 轴的反射点；对于 $P=Q$ 的情况，使用在 $P$ 点的切线代替割线。\n\n从这些定义和多项式交点的基本性质（包括关于三次多项式根的韦达定理）出发，在 $P \\neq Q$ 和 $P=Q$ 两种情况下，推导弦或切线的斜率以及群和 $P+Q$ 的坐标关于 $x_{1},y_{1},x_{2},y_{2},a,b$ 的显式有理表达式。你的推导必须从 $E$ 的隐式方程开始，并且只使用域运算和多项式恒等式；不要假设任何预先建立的加法或倍点公式。\n\n然后，将你推导出的表达式应用于特定曲线 $$E: y^{2} = x^{3} - 7 x + 10,$$ 以及其上的有理点 $$P=(2,2), \\quad Q=(3,4) \\in E(\\mathbb{Q}).$$ 计算 $P+Q$ 的 $x$ 坐标的精确值。你的最终答案应为一个精确的数字。无需四舍五入。", "solution": "该问题要求推导有理数域上椭圆曲线的群加法律，然后将其应用于一个特定的曲线和点。\n\n设定义在有理数域 $\\mathbb{Q}$ 上的椭圆曲线 $E$ 由以下短 Weierstrass 方程给出：\n$$E: y^{2} = x^{3} + a x + b$$\n其中 $a, b \\in \\mathbb{Q}$ 且判别式 $\\Delta = -16(4a^{3}+27b^{2}) \\neq 0$。设 $P=(x_{1}, y_{1})$ 和 $Q=(x_{2}, y_{2})$ 为 $E(\\mathbb{Q})$ 上的两个点。我们希望推导出和 $P+Q = (x_{3}, y_{3})$ 的坐标表达式。\n\n推导分为两种主要情况。\n\n**情况 1：点加法 ($P \\neq Q$)**\n\n设 $P=(x_{1}, y_{1})$ 和 $Q=(x_{2}, y_{2})$ 为曲线 $E$ 上的两个不同点。\n\n如果 $x_{1} = x_{2}$，那么由于 $P \\neq Q$，必有 $y_{1} = -y_{2}$。这两个点关于 $x$ 轴对称。穿过 $P$ 和 $Q$ 的直线是垂直线 $x=x_{1}$。这条线与曲线 $y^{2} = x^{3} + a x + b$ 的交点只有 $P$ 和 $Q$。在射影坐标系中，这条垂直线与曲线交于第三个点，即无穷远点，我们记作 $\\mathcal{O}$。根据定义，和 $P+Q$ 是这个第三点关于 $x$ 轴的反射点。由于 $\\mathcal{O}$ 是自身的反射，所以 $P+Q = \\mathcal{O}$。\n\n如果 $x_{1} \\neq x_{2}$，则穿过 $P$ 和 $Q$ 的直线 $L$ 不是垂直的。其方程为 $y = \\lambda x + \\nu$，其中斜率 $\\lambda$ 由下式给出：\n$$\\lambda = \\frac{y_{2} - y_{1}}{x_{2} - x_{1}}$$\n由于 $P$ 和 $Q$ 都在该直线上，我们有 $y_{1} = \\lambda x_{1} + \\nu$ 和 $y_{2} = \\lambda x_{2} + \\nu$。这意味着 $\\nu = y_{1} - \\lambda x_{1} = y_{2} - \\lambda x_{2}$。\n\n为了找到直线 $L$ 和曲线 $E$ 的交点，我们将 $y$ 的表达式代入曲线方程：\n$$(\\lambda x + \\nu)^{2} = x^{3} + a x + b$$\n展开左边并重新整理，得到一个关于 $x$ 的三次方程：\n$$\\lambda^{2} x^{2} + 2\\lambda\\nu x + \\nu^{2} = x^{3} + a x + b$$\n$$x^{3} - \\lambda^{2} x^{2} + (a - 2\\lambda\\nu) x + (b - \\nu^{2}) = 0$$\n这个三次多项式的根对应于直线 $L$ 和曲线 $E$ 交点的 $x$ 坐标。我们已经知道其中两个根：$x_{1}$ 和 $x_{2}$，即 $P$ 和 $Q$ 的 $x$ 坐标。设第三个交点为 $R=(x_{R}, y_{R})$，那么它的 $x$ 坐标 $x_{R}$ 就是该三次方程的第三个根。\n\n根据韦达定理，一个首一（monic）三次多项式 $x^{3}+cx^{2}+dx+e=0$ 的根之和为 $-c$。在我们的情况下，根之和为：\n$$x_{1} + x_{2} + x_{R} = -(-\\lambda^{2}) = \\lambda^{2}$$\n由此，我们可以解出 $x_{R}$：\n$$x_{R} = \\lambda^{2} - x_{1} - x_{2}$$\n点 $R$ 在直线 $L$ 上，所以其 $y$ 坐标为 $y_{R} = \\lambda x_{R} + \\nu$。\n\n和 $P+Q = (x_{3}, y_{3})$ 定义为 $R$ 关于 $x$ 轴的反射点。这意味着 $x_{3} = x_{R}$ 且 $y_{3} = -y_{R}$。\n因此，$P+Q$ 的坐标为：\n$$x_{3} = \\lambda^{2} - x_{1} - x_{2}$$\n$$y_{3} = -y_{R} = -(\\lambda x_{3} + \\nu) = -(\\lambda x_{3} + y_{1} - \\lambda x_{1}) = \\lambda(x_{1} - x_{3}) - y_{1}$$\n\n**情况 2：倍点运算 ($P = Q$)**\n\n设 $P=(x_{1}, y_{1})$。我们想要求出 $2P = P+P = (x_{3}, y_{3})$ 的坐标。\n\n如果 $y_{1} = 0$，点 $P$ 是一个 2-挠点。曲线在 $P$ 点的切线是一条垂直线 $x=x_{1}$。与第一种情况类似，第三个交点是无穷远点 $\\mathcal{O}$。因此，$2P = \\mathcal{O}$。\n\n如果 $y_{1} \\neq 0$，切线不是垂直的。我们通过对曲线方程 $y^{2} = x^{3} + a x + b$ 关于 $x$ 进行隐式微分来求其斜率 $\\lambda$：\n$$2y \\frac{dy}{dx} = 3x^{2} + a$$\n$$\\frac{dy}{dx} = \\frac{3x^{2} + a}{2y}$$\n在 $P(x_{1}, y_{1})$ 点的切线斜率为：\n$$\\lambda = \\frac{3x_{1}^{2} + a}{2y_{1}}$$\n切线方程为 $y = \\lambda x + \\nu$，其中 $\\nu = y_{1} - \\lambda x_{1}$。\n将其代入曲线方程得到与之前相同的三次方程：\n$$x^{3} - \\lambda^{2} x^{2} + (a - 2\\lambda\\nu) x + (b - \\nu^{2}) = 0$$\n由于该直线与曲线在 $P$ 点相切，因此 $x$ 坐标 $x_{1}$ 必须是这个三次方程的根，且重数至少为 2。设第三个交点为 $R=(x_{R}, y_{R})$。应用韦达定理求根之和：\n$$x_{1} + x_{1} + x_{R} = \\lambda^{2}$$\n$$2x_{1} + x_{R} = \\lambda^{2}$$\n解出 $x_{R}$：\n$$x_{R} = \\lambda^{2} - 2x_{1}$$\n点 $2P = (x_{3}, y_{3})$ 是 $R$ 关于 $x$ 轴的反射点，所以 $x_{3} = x_{R}$ 且 $y_{3} = -y_{R}$。\n$2P$ 的坐标为：\n$$x_{3} = \\lambda^{2} - 2x_{1}$$\n$$y_{3} = -y_{R} = -(\\lambda x_{3} + \\nu) = \\lambda(x_{1} - x_{3}) - y_{1}$$\n至此，显式有理表达式的推导完成。\n\n**对特定问题的应用**\n\n给定椭圆曲线 $E: y^{2} = x^{3} - 7 x + 10$ 和两个有理点 $P=(2,2)$ 和 $Q=(3,4)$。我们必须计算 $P+Q$ 的 $x$ 坐标。\n\n曲线的系数为 $a=-7$ 和 $b=10$。\n点为 $P=(x_{1}, y_{1}) = (2,2)$ 和 $Q=(x_{2}, y_{2}) = (3,4)$。\n由于 $P \\neq Q$ 且 $x_{1} \\neq x_{2}$，我们处于情况 1 的主要子情况。\n\n首先，我们计算穿过 $P$ 和 $Q$ 的直线的斜率 $\\lambda$：\n$$\\lambda = \\frac{y_{2} - y_{1}}{x_{2} - x_{1}} = \\frac{4 - 2}{3 - 2} = \\frac{2}{1} = 2$$\n接下来，我们使用推导出的和 $P+Q$ 的 $x$ 坐标公式，记为 $x_{3}$：\n$$x_{3} = \\lambda^{2} - x_{1} - x_{2}$$\n代入已知值：\n$$x_{3} = (2)^{2} - 2 - 3$$\n$$x_{3} = 4 - 2 - 3$$\n$$x_{3} = -1$$\n$P+Q$ 的 $x$ 坐标是 $-1$。\n（为了验证，y 坐标将是 $y_3 = \\lambda(x_1-x_3) - y_1 = 2(2 - (-1)) - 2 = 2(3) - 2 = 6 - 2 = 4$。所以 $P+Q = (-1, 4)$。我们检查 $(-1, 4)$ 是否在曲线上：$4^2 = 16$ 且 $(-1)^3 - 7(-1) + 10 = -1 + 7 + 10 = 16$。该点在曲线上，证实了计算结果。）\n\n所要求的值是 $P+Q$ 的 $x$ 坐标。", "answer": "$$\\boxed{-1}$$", "id": "3013188"}, {"introduction": "在数论中，我们通常希望使用对象的“最简”表示，例如最简分式。对于有理数域上的椭圆曲线，这个概念对应于寻找其全局最小积分模型和最小判别式。本练习将指导你通过分析判别式的素因子来确定一个给定的 Weierstrass 模型是否是最小的[@problem_id:3013124]。掌握这一技能至关重要，因为许多高级定理和数据库（如LMFDB）都以最小模型及其不变量为标准。", "problem": "设 $E$ 是定义在 $\\mathbb{Q}$ 上的椭圆曲线，其短整Weierstrass方程为 $y^{2} = x^{3} - 4x + 1$。一个容许整变量变换的形式为\n$x = u^{2} x' + r$ 和 $y = u^{3} y' + u^{2} s x' + t$，其中 $u, r, s, t \\in \\mathbb{Z}$ 且 $u = \\pm 1$；更一般地，可以使用 $u = p^{-1}$（其中 $p$ 为素数）的有理数缩放，前提是得到的Weierstrass方程仍具有整数系数。\n\n从Weierstrass方程不变量的基本定义及其在容许变量变换下的行为出发，通过分析整除判别式的素数，确定 $E$ 的一个全局最小整模型。然后计算 $E$ 的最小判别式。\n\n将您的最终答案表示为等于 $E$ 的最小判别式的单个精确整数。不需要四舍五入，也不涉及单位。您提供的推理应证明您得到的模型相对于容许整代换是最小的。", "solution": "用户提供了一条定义在有理数域 $\\mathbb{Q}$ 上的椭圆曲线 $E$，其方程为 $y^{2} = x^{3} - 4x + 1$。这是一个整Weierstrass模型。任务是找到 $E$ 的一个全局最小整模型并计算其最小判别式。\n\n给定的方程是短Weierstrass形式 $y^{2} = x^{3} + Ax + B$，其中整系数为 $A = -4$ 和 $B = 1$。Weierstrass方程的一般形式是 $y^{2} + a_{1}xy + a_{3}y = x^{3} + a_{2}x^{2} + a_{4}x + a_{6}$。对于给定的曲线，系数为 $a_{1} = 0$, $a_{2} = 0$, $a_{3} = 0$, $a_{4} = -4$, 和 $a_{6} = 1$。\n\n首先，我们计算该模型的标准不变量和判别式。对于短Weierstrass方程 $y^2 = x^3 + Ax + B$，判别式 $\\Delta$ 由以下公式给出：\n$$\n\\Delta = -16(4A^{3} + 27B^{2})\n$$\n代入给定的值 $A = -4$ 和 $B = 1$：\n$$\n\\Delta = -16(4(-4)^{3} + 27(1)^{2})\n$$\n$$\n\\Delta = -16(4(-64) + 27)\n$$\n$$\n\\Delta = -16(-256 + 27)\n$$\n$$\n\\Delta = -16(-229)\n$$\n$$\n\\Delta = 3664\n$$\n问题定义了两种变量变换。第一种是“容许整变量变换”，由 $x = u^{2}x' + r$ 和 $y = u^{3}y' + u^{2}sx' + t$ 给出，其中 $u, r, s, t \\in \\mathbb{Z}$ 且 $u = \\pm 1$。在这种变换下，新模型 $\\Delta'$ 的判别式与原判别式 $\\Delta$ 的关系为 $\\Delta' = u^{-12}\\Delta$。由于 $u = \\pm 1$，我们有 $u^{-12} = (\\pm 1)^{-12} = 1$，这意味着 $\\Delta' = \\Delta$。这表明判别式在这种受限的整变换类下是不变的。\n\n问题接着提到了一种更普遍的有理数缩放，其中 $u$ 可以是一个有理数。如果两条具有整Weierstrass模型的椭圆曲线通过形如 $x = u^{2}x' + r, y = u^{3}y' + u^{2}sx' + t$（其中 $u, r, s, t \\in \\mathbb{Q}$ 且 $u \\neq 0$）的变量变换相关联，则它们在 $\\mathbb{Q}$ 上是同构的。如果一条椭圆曲线有一个判别式为 $\\Delta$ 的整模型，那么任何其他同构的整模型都会有一个判别式 $\\Delta'$，使得对于某个 $v \\in \\mathbb{Q}^\\times$，有 $\\Delta = v^{12}\\Delta'$。\n\n全局最小整模型是在同一 $\\mathbb{Q}$-同构类中所有整模型中，其判别式 $\\Delta_{min}$ 绝对值最小的整模型。要使一个判别式为 $\\Delta$ 的模型能简化为一个判别式绝对值更小的模型，必须存在某个 $|v|  1$ 的 $v \\in \\mathbb{Q}$，使得 $\\Delta' = v^{-12}\\Delta$ 是另一个整模型的判别式。若记 $v = p$（其中 $p$ 为素数），这将意味着 $\\Delta' = p^{-12}\\Delta$。为了使 $\\Delta'$ 为整数，必须有 $p^{12}$ 整除 $\\Delta$。\n\n因此，一个整模型是最小的一个充分条件是：对于每一个素数 $p$，其判别式的 $p$-adic赋值 $v_p(\\Delta)$ 小于12。如果对所有素数 $p$ 都有 $v_p(\\Delta)  12$，那么就不存在素数 $p$ 使得 $p^{12}$ 整除 $\\Delta$。因此，不可能通过涉及以 $p$ 为尺度的变量变换来简化该模型。\n\n我们将此准则应用于我们计算出的判别式 $\\Delta = 3664$。我们首先求出 $\\Delta$ 的素数分解：\n$$\n3664 = 8 \\times 458 = 8 \\times 2 \\times 229 = 16 \\times 229 = 2^{4} \\times 229^{1}\n$$\n为了验证 $229$ 是一个素数，我们测试它是否能被小于等于 $\\sqrt{229} \\approx 15.1$ 的素数整除。这些素数是 $2, 3, 5, 7, 11, 13$。\n- $229$ 不能被 $2$ 或 $5$ 整除。\n- 各位数字之和为 $2+2+9=13$，所以它不能被 $3$ 整除。\n- $229 = 7 \\times 32 + 5$。\n- $229 = 11 \\times 20 + 9$。\n- $229 = 13 \\times 17 + 8$。\n因此，$229$ 是一个素数。\n\n现在我们来考察 $\\Delta = 2^{4} \\times 229^{1}$ 的 $p$-adic赋值：\n\\begin{itemize}\n    \\item 对于素数 $p=2$，赋值为 $v_{2}(\\Delta) = 4$。\n    \\item 对于素数 $p=229$，赋值为 $v_{229}(\\Delta) = 1$。\n    \\item 对于任何其他素数 $p$，赋值为 $v_{p}(\\Delta) = 0$。\n\\end{itemize}\n在每种情况下，我们都有 $v_p(\\Delta)  12$。这表明不存在素数 $p$ 使得 $p^{12}$ 整除 $\\Delta$。因此，不可能找到一个具有更小绝对值判别式的同构整模型。\n\n这证明了给定的整模型 $y^{2} = x^{3} - 4x + 1$ 是椭圆曲线 $E$ 的一个全局最小整模型。$E$ 的最小判别式就是这个模型的判别式。\n\n最小判别式 $\\Delta_{min} = 3664$。", "answer": "$$\n\\boxed{3664}\n$$", "id": "3013124"}, {"introduction": "现代数论的一个显著特点是理论猜想与计算证据之间的紧密互动。Sato-Tate 猜想（现已成为定理）是描述椭圆曲线算术统计性质的一个深刻结果。本练习将带你进入计算数论的前沿，通过编写程序来计算一个非CM椭圆曲线在不同素数下的 Frobenius 迹，并将其分布与 Sato-Tate 测度进行比较[@problem_id:3013166]。这个实践不仅能加深你对 Hasse 界和 Frobenius 迹的理解，还能让你体验作为一名理论数论学家如何利用数据来探索和验证深刻的数学思想。", "problem": "要求您编写一个完整的、可运行的程序，该程序针对若干有理数域上的椭圆曲线和指定的素数范围，计算其在好素数处的Frobenius系数，并将其归一化分布与Sato–Tate测度进行比较。\n\n从以下基础和定义开始。\n\n- 有理数域上的椭圆曲线，对于大于等于 $5$ 的素数，在变量替换后，可以表示为短Weierstrass范式 $E_{a,b} \\colon y^2 = x^3 + a x + b$，其中 $a$ 和 $b$ 为整数，且判别式 $\\Delta = -16\\left(4 a^3 + 27 b^2\\right)$ 非零。\n- 对于一个素数 $p \\ge 5$ 且 $p \\nmid \\Delta$，$E_{a,b}$ 模 $p$ 的约化是有限域 $\\mathbb{F}_p$ 上的椭圆曲线。定义 $\\#E(\\mathbb{F}_p)$ 为 $\\mathbb{F}_p$-有理点的数量，包括无穷远点。$p$ 处的Frobenius迹为 $a_p = p + 1 - \\#E(\\mathbb{F}_p)$，Hasse界表明 $\\lvert a_p \\rvert \\le 2 \\sqrt{p}$。\n- 对于奇素数 $p$，定义勒让德符号 $\\chi_p(r)$ 如下：如果 $r$ 是模 $p$ 的非零二次剩余，则 $\\chi_p(r) = 1$；如果 $r$ 是模 $p$ 的非二次剩余，则 $\\chi_p(r) = -1$；如果 $r \\equiv 0 \\pmod p$，则 $\\chi_p(0) = 0$。对于每个 $r \\in \\mathbb{F}_p$，同余式 $y^2 \\equiv r \\pmod p$ 在 $\\mathbb{F}_p$ 中恰好有 $1 + \\chi_p(r)$ 个解，这一基本事实使您无需显式枚举 $y$ 即可计算 $\\#E(\\mathbb{F}_p)$。\n- 对于没有复乘（CM）的曲线，Sato–Tate定理指出，归一化量 $t_p = a_p / (2 \\sqrt{p})$ 在区间 $[-1,1]$ 上关于Sato–Tate测度是均勻分布的，其概率密度函数为 $f_{\\mathrm{ST}}(t) = \\frac{2}{\\pi} \\sqrt{1 - t^2}$，$t \\in [-1,1]$。累积分布函数（CDF）是积分 $F_{\\mathrm{ST}}(t) = \\int_{-1}^t f_{\\mathrm{ST}}(u) \\, du$。您可以使用不定积分 $\\int \\sqrt{1-u^2} \\, du = \\frac{1}{2}\\left(u \\sqrt{1-u^2} + \\arcsin u\\right)$ 来计算 $F_{\\mathrm{ST}}(t)$ 的闭式解。\n\n您的程序必须为每个测试用例执行以下操作：\n\n1. 给定整数 $a$ 和 $b$、素数上限 $B \\ge 5$ 以及分组数量 $m \\ge 1$，考虑椭圆曲线 $E_{a,b} \\colon y^2 = x^3 + a x + b$。\n2. 生成所有满足 $5 \\le p \\le B$ 的素数 $p$。对于每个具有好约化（$p \\nmid \\Delta$）的此类素数，通过上述勒让德符号的方法计算 $a_p = p + 1 - \\#E(\\mathbb{F}_p)$，并形成归一化值 $t_p = a_p / (2 \\sqrt{p})$。\n3. 在区间 $[-1,1]$ 上构建一个具有 $m$ 个等宽分组的直方图，并从多重集 $\\{ t_p \\}$ 中统计观察到的相对频率。\n4. 计算：\n   - 使用 $F_{\\mathrm{ST}}$ 在每个分组上计算期望的组质量，即对于分组边界 $-1 = b_0  b_1  \\cdots  b_m = 1$，第 $i$ 组的期望质量为 $F_{\\mathrm{ST}}(b_i) - F_{\\mathrm{ST}}(b_{i-1})$，其中 $i = 1, \\dots, m$。\n   - 卡方统计量 $\\chi^2 = \\sum_{i=1}^m \\frac{(\\mathrm{Obs}_i - \\mathrm{Exp}_i)^2}{\\max(\\mathrm{Exp}_i, \\varepsilon)}$，其中 $\\mathrm{Obs}_i$ 和 $\\mathrm{Exp}_i$ 分别是观察到和期望的分组概率，$\\varepsilon$ 是一个小的正常数，用于避免在退化情况下除以零。\n   - 针对 $F_{\\mathrm{ST}}$ 和经验累积分布函数 $\\widehat{F}_n$ 的单样本柯尔莫哥洛夫-斯米尔诺夫统计量，即 $\\mathrm{KS} = \\sup_t \\lvert \\widehat{F}_n(t) - F_{\\mathrm{ST}}(t) \\rvert$，该统计量在排序后的样本 $\\{ t_p \\}$ 上使用每个观测值处的标准左右经验步长进行计算。\n   - 观察到和期望的分组概率之间的最大绝对偏差 $\\max_i \\lvert \\mathrm{Obs}_i - \\mathrm{Exp}_i \\rvert$。\n5. 对于每个测试用例，输出一个包含四个量的列表：所使用的好素数数量 $n$，后跟三个实值统计量，顺序为 $\\mathrm{KS}$、$\\chi^2$ 和最大绝对分组偏差，每个都表示为浮点数。\n\n使用以下固定的测试套件。\n\n- 情况1（非CM，典型范围）：$a = -1$, $b = 1$, $B = 5000$, $m = 25$。\n- 情况2（非CM，小样本边界）：$a = -1$, $b = 1$, $B = 200$, $m = 10$。\n- 情况3（CM诊断）：$a = 0$, $b = -1$, $B = 5000$, $m = 25$。\n- 情况4（非CM，不同系数）：$a = -2$, $b = 3$, $B = 4000$, $m = 20$。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个条目对应一个测试用例，并且本身是一个包含项目5中描述的四个量的列表，顺序相同。例如，包含两个用例的输出应类似于 `[[n_1, s_{1,1}, s_{1,2}, s_{1,3}],[n_2, s_{2,1}, s_{2,2}, s_{2,3}]]`。\n\n不需要用户输入；所有参数已在上方指定。所有角度均以弧度为单位，不涉及任何物理单位。所有数值结果必须表示为普通的浮点数或整数（视情况而定），不带百分号。程序必须是自包含的，并且不得从任何外部文件读取或向其写入。", "solution": "用户提供了一个明确定义的数论计算问题。该问题科学严谨、自成体系且算法明确。它要求通过比较经验数据与理论分布，对特定椭圆曲线的Sato–Tate定理进行数值验证。\n\n问题的核心是为一组素数 $p$ 和一条椭圆曲线 $E_{a,b}$ 计算归一化的Frobenius迹 $t_p$，然后对理论上的Sato–Tate分布进行拟合优度分析。该过程可以分解为以下几个不同的步骤，并将为每个指定的测试用例实施。\n\n首先，对于由参数 $a, b, B, m$ 定义的每个测试用例，我们必须确定椭圆曲线 $E_{a,b} \\colon y^2 = x^3 + a x + b$。计算判别式 $\\Delta = -16(4a^3 + 27b^2)$ 以识别坏约化素数。\n\n其次，生成所有满足 $5 \\le p \\le B$ 的素数 $p$ 的列表。Eratosthenes筛法是完成此任务的有效方法。\n\n第三，对于每个生成的素数 $p$，我们通过测试 $p$ 是否整除 $\\Delta$ 来检查它是否为好约化素数。如果 $p \\nmid \\Delta$，我们继续计算Frobenius迹 $a_p$。问题指定了一种基于勒让德符号 $\\chi_p(r)$ 的方法。曲线上在有限域 $\\mathbb{F}_p$ 上的点数为：\n$$ \\#E(\\mathbb{F}_p) = 1 + \\sum_{x=0}^{p-1} \\left(1 + \\chi_p(x^3 + ax + b)\\right) $$\n其中初始的 $1$ 表示无穷远点。这可以重写为：\n$$ \\#E(\\mathbb{F}_p) = 1 + p + \\sum_{x=0}^{p-1} \\chi_p(x^3 + ax + b) $$\nFrobenius迹定义为 $a_p = p + 1 - \\#E(\\mathbb{F}_p)$。代入 $\\#E(\\mathbb{F}_p)$ 的表达式，可以得到一个更直接计算 $a_p$ 的公式：\n$$ a_p = p + 1 - \\left(1 + p + \\sum_{x=0}^{p-1} \\chi_p(x^3 + ax + b)\\right) = - \\sum_{x=0}^{p-1} \\chi_p(x^3 + ax + b) $$\n对于素数 $p$，勒让德符号 $\\chi_p(r)$ 计算为 $r^{(p-1)/2} \\pmod p$。如果 $r$ 是二次剩余，结果为 $1$；如果 $r$ 是非二次剩余，结果为 $-1$（在模运算中表示为 $p-1$）；如果 $r \\equiv 0 \\pmod p$，结果为 $0$。计算出 $a_p$ 后，归一化的迹计算为 $t_p = a_p / (2\\sqrt{p})$。根据Hasse定理，该值保证在区间 $[-1, 1]$ 内。我们为所有好素数 $p \\le B$ 收集这些 $t_p$ 值。\n\n第四，我们对收集到的 $n$ 个 $t_p$ 值集合进行统计分析。\n1.  **直方图和观察概率**：将区间 $[-1, 1]$ 分为 $m$ 个等宽的分组，宽度为 $w = 2/m$。分组边界为 $b_i = -1 + i \\cdot w$，其中 $i \\in \\{0, 1, \\dots, m\\}$。将观察值 $\\{t_p\\}$ 进行分组，并将每个分组的计数除以值的总数 $n$，以获得观察概率 $\\mathrm{Obs}_i$。\n2.  **Sato–Tate CDF和期望概率**：对于非CM曲线，$t_p$ 值的理论分布是Sato–Tate分布，其概率密度函数为 $f_{\\mathrm{ST}}(t) = \\frac{2}{\\pi}\\sqrt{1-t^2}$，定义在 $[-1, 1]$ 上。累积分布函数（CDF）为 $F_{\\mathrm{ST}}(t) = \\int_{-1}^t f_{\\mathrm{ST}}(u) \\, du$。使用提供的原函数，其计算结果为：\n    $$ F_{\\mathrm{ST}}(t) = \\frac{1}{\\pi}\\left(t\\sqrt{1-t^2} + \\arcsin{t}\\right) + \\frac{1}{2} $$\n    第 $i$ 个分组 $[b_{i-1}, b_i]$ 的期望概率 $\\mathrm{Exp}_i$ 由 $F_{\\mathrm{ST}}(b_i) - F_{\\mathrm{ST}}(b_{i-1})$ 给出。\n3.  **统计量**：我们计算三个统计量来量化拟合优度：\n    -   类卡方统计量，如问题中所定义：$\\chi^2 = \\sum_{i=1}^m \\frac{(\\mathrm{Obs}_i - \\mathrm{Exp}_i)^2}{\\max(\\mathrm{Exp}_i, \\varepsilon)}$，其中 $\\varepsilon$ 是一个小常数（例如，$10^{-12}$），以防止除以零。\n    -   分组概率之间的最大绝对偏差：$\\max_i |\\mathrm{Obs}_i - \\mathrm{Exp}_i|$。\n    -   柯尔莫哥洛夫-斯米尔诺夫（KS）统计量，它测量经验CDF $\\widehat{F}_n(t)$ 和理论CDF $F_{\\mathrm{ST}}(t)$ 之间的最大差异。对于一个排序后的样本 $t_{(1)} \\le \\dots \\le t_{(n)}$，该统计量计算如下：\n        $$ \\mathrm{KS} = \\max_{i=1,\\dots,n} \\max\\left( \\left| \\frac{i}{n} - F_{\\mathrm{ST}}(t_{(i)}) \\right|, \\left| \\frac{i-1}{n} - F_{\\mathrm{ST}}(t_{(i)}) \\right| \\right) $$\n\n最后，对于每个测试用例，程序将输出一个包含四个值的列表：好素数的数量 $n$、KS统计量、$\\chi^2$统计量和最大绝对分组偏差。所有测试用例的结果被收集到一个列表的列表中，作为最终输出。情况 $a=0, b=-1$ 对应于一条具有复乘（CM）的曲线，Sato–Tate定理并不以所述形式适用于此。预计其统计结果会显示出较差的拟合度，这可以作为对实现和底层数论的诊断性测试。", "answer": "```python\nimport numpy as np\n# No other libraries outside the Python standard library are permitted.\n\ndef solve():\n    \"\"\"\n    Main solver function to process all test cases and print the final result.\n    \"\"\"\n    test_cases = [\n        # (a, b, B, m)\n        (-1, 1, 5000, 25),  # Case 1 (non-CM, typical)\n        (-1, 1, 200, 10),   # Case 2 (non-CM, small-sample)\n        (0, -1, 5000, 25),  # Case 3 (CM diagnostic)\n        (-2, 3, 4000, 20),  # Case 4 (non-CM, different coeffs)\n    ]\n\n    results = []\n    for a, b, B, m in test_cases:\n        result = analyze_curve(a, b, B, m)\n        results.append(result)\n\n    # The final print statement must match the required format exactly.\n    # The format is a string representation of a list of lists.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef analyze_curve(a, b, B, m):\n    \"\"\"\n    Performs the full analysis for a single elliptic curve.\n    \"\"\"\n    primes = sieve_of_eratosthenes(B)\n    delta = -16 * (4 * a**3 + 27 * b**2)\n    \n    t_p_values = []\n    \n    for p in primes:\n        if p  5:\n            continue\n        if delta % p == 0:\n            continue\n\n        # Calculate a_p = -sum_{x=0}^{p-1} (x^3 + ax + b | p)\n        a_p_sum = 0\n        for x in range(p):\n            r = (x**3 + a * x + b) % p\n            a_p_sum += legendre_symbol(r, p)\n        \n        a_p = -a_p_sum\n        \n        # Check Hasse bound for safety, although it's a theorem\n        if abs(a_p) > 2 * np.sqrt(p):\n            # This should not happen for a correct implementation\n            continue\n\n        t_p = a_p / (2 * np.sqrt(p))\n        t_p_values.append(t_p)\n\n    n = len(t_p_values)\n    if n == 0:\n        return [0, 0.0, 0.0, 0.0]\n\n    # --- Statistical Analysis ---\n    \n    # 1. Chi-square and Max Deviation\n    obs_counts, bin_edges = np.histogram(t_p_values, bins=m, range=(-1, 1))\n    obs_probs = obs_counts / n\n\n    exp_probs = np.zeros(m)\n    for i in range(m):\n        exp_probs[i] = sato_tate_cdf(bin_edges[i+1]) - sato_tate_cdf(bin_edges[i])\n    \n    # Small constant for chi-square denominator stability\n    epsilon = 1e-12\n    chi2_stat = np.sum(((obs_probs - exp_probs)**2) / np.maximum(exp_probs, epsilon))\n    \n    max_bin_dev = np.max(np.abs(obs_probs - exp_probs))\n\n    # 2. Kolmogorov-Smirnov Statistic\n    t_p_sorted = np.sort(t_p_values)\n    ks_stat = 0.0\n    for i in range(n):\n        t_val = t_p_sorted[i]\n        F_emp_left = i / n\n        F_emp_right = (i + 1) / n\n        F_st_val = sato_tate_cdf(t_val)\n        \n        ks_stat = max(ks_stat, abs(F_emp_right - F_st_val), abs(F_emp_left - F_st_val))\n\n    return [n, ks_stat, chi2_stat, max_bin_dev]\n\ndef sieve_of_eratosthenes(n_limit):\n    \"\"\"\n    Generates primes up to n_limit using the Sieve of Eratosthenes.\n    \"\"\"\n    primes = []\n    sieve = [True] * (n_limit + 1)\n    sieve[0] = sieve[1] = False\n    for p in range(2, int(np.sqrt(n_limit)) + 1):\n        if sieve[p]:\n            for multiple in range(p * p, n_limit + 1, p):\n                sieve[multiple] = False\n    for p in range(2, n_limit + 1):\n        if sieve[p]:\n            primes.append(p)\n    return primes\n\ndef legendre_symbol(a, p):\n    \"\"\"\n    Computes the Legendre symbol (a | p).\n    p must be an odd prime.\n    \"\"\"\n    ls = pow(a, (p - 1) // 2, p)\n    if ls == p - 1:\n        return -1\n    return ls\n\ndef sato_tate_cdf(t):\n    \"\"\"\n    Computes the Cumulative Distribution Function (CDF) of the Sato-Tate measure.\n    F_ST(t) = (1/pi) * (t*sqrt(1-t^2) + arcsin(t)) + 1/2\n    \"\"\"\n    if t = -1.0:\n        return 0.0\n    if t >= 1.0:\n        return 1.0\n    return (1/np.pi) * (t * np.sqrt(1 - t**2) + np.arcsin(t)) + 0.5\n\nif __name__ == '__main__':\n    solve()\n\n```", "id": "3013166"}]}