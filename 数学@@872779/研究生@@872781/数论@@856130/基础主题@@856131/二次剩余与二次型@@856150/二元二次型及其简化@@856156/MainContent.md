## 引言
[二元二次型](@entry_id:200380)，即形如 $ax^2 + bxy + cy^2$ 的表达式，是数论的基石之一，由拉格朗日和高斯等数学巨匠开创。尽管形式简洁，它们却引出了深刻的问题：我们如何将这些无穷的对象划分为有限个族群，以及一个给定的二次型究竟能表示哪些整数？本文旨在系统性地解答这些根本性挑战，带领读者深入[二元二次型](@entry_id:200380)的世界。我们将首先在“原理与机制”一章中，建立其核心代数框架，包括[等价关系](@entry_id:138275)和著名的高斯类[群结构](@entry_id:146855)。随后，“应用与交叉联系”一章将展示该理论的强大威力，将其与二次域的[理想类群](@entry_id:153974)、丢番图方程以及[模形式](@entry_id:160014)等现代领域联系起来。最后，“动手实践”部分将提供巩固这些概念的机会。这次探索将揭示一个古典的课题如何至今仍在现代数学中保持着其活力与核心地位。

## 原理与机制

本章旨在系统阐述[二元二次型](@entry_id:200380)的核心原理与机制。我们将从基本定义出发，探讨其在[等价关系](@entry_id:138275)下的[不变量](@entry_id:148850)，进而揭示这些数学对象所构成的深刻[代数结构](@entry_id:137052)——[类群](@entry_id:182524)。最后，我们将详细介绍高斯约化理论，它为我们提供了一种对二次型进行分类和计算的有效工具，并分别探讨正定与不定两种情形下的独特机制。

### [二元二次型](@entry_id:200380)的基本概念

一个整系数**[二元二次型](@entry_id:200380)** (binary quadratic form) 是一个形如 $f(x,y) = ax^2 + bxy + cy^2$ 的二元二次[齐次多项式](@entry_id:178156)，其中系数 $a, b, c$ 均为整数。为了方便，我们常将该型简记为 $[a,b,c]$。

在数论中，我们通常不关心单个二次型的性质，而是关心在某个变量代换群作用下的[等价类](@entry_id:156032)。最重要的代换群是**二阶[特殊线性群](@entry_id:139538)** $SL_2(\mathbb{Z})$，它由所有[行列式](@entry_id:142978)为 $1$ 的 $2 \times 2$ 整系数矩阵构成。对任意矩阵 $M=\begin{pmatrix}\alpha\beta \\ \gamma\delta\end{pmatrix} \in SL_2(\mathbb{Z})$，它作用于一个二次型 $f$ 的方式是进行变量代换：
$$
(M \cdot f)(x,y) = f(\alpha x+\beta y, \gamma x+\delta y)
$$
如果一个二次型 $f'$ 可以通过这种方式从 $f$ 得到，我们称 $f$ 与 $f'$ 是**[正常等价](@entry_id:635057)** (properly equivalent) 的。这种等价关系是一种真正的等价关系，它将所有具有相同[判别式](@entry_id:174614)的二次型划分为不相交的等价类。

在研究等价类时，寻找在此变换下保持不变的量至关重要。对于[二元二次型](@entry_id:200380)，存在几个基本的[不变量](@entry_id:148850) [@problem_id:3009147]。

第一个是**[判别式](@entry_id:174614)** (discriminant)。对于型 $[a,b,c]$，其判别式定义为 $D = b^2 - 4ac$。我们可以证明，若 $f'$ 与 $f$ [正常等价](@entry_id:635057)，则它们的判别式相等。这一性质可以通过[矩阵代数](@entry_id:153824)得到优雅的证明。将二次型 $f(x,y)$ 表示为矩阵形式 $\begin{pmatrix} x  y \end{pmatrix} F \begin{pmatrix} x \\ y \end{pmatrix}$，其中 $F = \begin{pmatrix} a  b/2 \\ b/2  c \end{pmatrix}$，其判别式 $D = -4 \det(F)$。变量代换 $\begin{pmatrix} x' \\ y' \end{pmatrix} = M \begin{pmatrix} x \\ y \end{pmatrix}$ 导致新的二次型矩阵变为 $F' = M^T F M$。因此，新的判别式 $D'$ 为：
$$
D' = -4 \det(M^T F M) = -4 \det(M^T) \det(F) \det(M) = -4 (\det M)^2 \det(F) = (\det M)^2 D
$$
由于 $M \in SL_2(\mathbb{Z})$，其[行列式](@entry_id:142978) $\det M = 1$，故 $D' = D$。[判别式](@entry_id:174614)在 $SL_2(\mathbb{Z})$ 作用下是严格[不变量](@entry_id:148850)。本文主要关注[判别式](@entry_id:174614) $D$ 非[平方数](@entry_id:635622)的情形，且满足 $D \equiv 0 \pmod{4}$ 或 $D \equiv 1 \pmod{4}$。

第二个[不变量](@entry_id:148850)是二次型的**[本原性](@entry_id:145479)** (primitivity)。一个二次型 $[a,b,c]$ 的**含量** (content) 定义为其系数的[最大公约数](@entry_id:142947) $\gcd(a,b,c)$。如果含量为 $1$，则称该二次型是**本原的** (primitive)。通过分析变换后新系数的表达式，可以证明新系数是原系数 $a,b,c$ 的整[线性组合](@entry_id:154743)，因此 $\gcd(a,b,c)$ 必然整除新系数的任意公因子。反之，由于 $M$ 的逆矩阵 $M^{-1}$ 也属于 $SL_2(\mathbb{Z})$，原系数也是新系数的整线性组合。这说明含量在 $SL_2(\mathbb{Z})$ 作用下保持不变。因此，一个二次型的[本原性](@entry_id:145479)也是一个[不变量](@entry_id:148850) [@problem_id:3009147]。

根据判别式 $D$ 的符号，我们可以对二次型进行基本分类：
-   若 $D  0$ 且 $a>0$，则该型被称为**正定的** (positive definite)。它只表示正值（除非 $x=y=0$）。
-   若 $D  0$ 且 $a0$，则该型被称为**负定的** (negative definite)。
-   若 $D > 0$，则该型被称为**不定的** (indefinite)。它既可以表示正值，也可以表示负值。例如，二次型 $f(x,y)=x^2+xy-y^2$ 的[判别式](@entry_id:174614)为 $D=1^2 - 4(1)(-1) = 5 > 0$。它是不定的，因为 $f(1,0)=1 > 0$ 而 $f(0,1)=-1  0$ [@problem_id:3009177]。

### [类群](@entry_id:182524)：一种[代数结构](@entry_id:137052)

高斯最伟大的发现之一是，对于一个给定的非平方判别式 $D$，所有本原二次型的[正常等价](@entry_id:635057)类集合上可以定义一个自然的[二元运算](@entry_id:152272)，即**[高斯复合](@entry_id:196619)** (Gauss composition)。这个运算赋予了该集合一个有限[阿贝尔群的结构](@entry_id:140745)，我们称之为判别式为 $D$ 的**[类群](@entry_id:182524)** (class group)，记作 $\mathrm{Cl}(D)$。

这个群的性质如下 [@problem_id:3009139] [@problem_id:3009172] [@problem_id:3009184]：
-   **群元素**：群的元素是判别式为 $D$ 的本原二次型的[正常等价](@entry_id:635057)类。
-   **单位元**：群的单位元是所谓的**主类** (principal class)，即包含**主型** (principal form) 的[等价类](@entry_id:156032)。主型是唯一能表示 $1$ 的[等价类](@entry_id:156032)中的代表元。对于给定的 $D$，主型可以统一地写成 $[1, b_0, c_0]$，其中 $b_0 \equiv D \pmod{2}$ 且 $c_0 = (b_0^2-D)/4$。例如，当 $D \equiv 0 \pmod 4$ 时，标准主型是 $[1, 0, -D/4]$；当 $D \equiv 1 \pmod 4$ 时，是 $[1, 1, (1-D)/4]$。
-   **逆元**：在类群中，一个由二次型 $[a,b,c]$ 代表的[等价类](@entry_id:156032)的逆元，是由其**相反形式** (opposite form) $[a,-b,c]$ 所代表的等价类。将一个类与其相反类复合，总会得到主类。
-   **阿贝尔性**：[高斯复合](@entry_id:196619)是可交换的，因此类群是一个阿贝尔群。

从现代观点看，[类群](@entry_id:182524)的存在性可以通过二次型与二次域中**理想类** (ideal classes) 的对应关系来理解。每个[判别式](@entry_id:174614)为 $D$ 的本原二次型等价类都与二次域 $\mathbb{Q}(\sqrt{D})$ 中某个[整环](@entry_id:155321)（序）$\mathcal{O}_D$ 的一个理想类[一一对应](@entry_id:143935)。具体来说，二次型 $[a,b,c]$ 对应于理想 $a\mathbb{Z} + \frac{-b+\sqrt{D}}{2}\mathbb{Z}$。[高斯复合](@entry_id:196619)运算正是在这种对应下理想类乘法的体现。这种联系为二次型理论提供了坚实的代[数基](@entry_id:634389)础 [@problem_id:3009172]。

值得注意的是，我们强调**[正常等价](@entry_id:635057)**的重要性。如果我们使用更宽泛的**非[正常等价](@entry_id:635057)** (improper equivalence)，即允许变量代换矩阵来自 $GL_2(\mathbb{Z})$（[行列式](@entry_id:142978)为 $\pm 1$），情况会发生改变。一个[行列式](@entry_id:142978)为 $-1$ 的变换，例如 $\begin{pmatrix} 1  0 \\ 0  -1 \end{pmatrix}$，会将二次型 $[a,b,c]$ 变换为其相反形式 $[a,-b,c]$。这意味着在 $GL_2(\mathbb{Z})$ 等价下，一个类和它的逆类被视为等同。这个更粗糙的[等价关系](@entry_id:138275)集合一般不再具有群结构，除非类群中的每个元素都是其自身的逆元（即群是2-挠的）。这凸显了 $SL_2(\mathbb{Z})$ 和[正常等价](@entry_id:635057)在构建类群时的核心地位 [@problem_id:3015029]。

最后，[类群](@entry_id:182524)中的一个重要子结构是**含糊类** (ambiguous classes) 构成的[子群](@entry_id:146164)。含糊类是指那些等于自身逆元的类，即满足 $[f] = [f]^{-1}$ 的类。在[阿贝尔群](@entry_id:150284)中，这些元素构成了2-[挠子群](@entry_id:139454)，因此它们在复合运算下是封闭的 [@problem_id:3009139]。

### 约化理论：寻找[典范代表元](@entry_id:197855)

为了具体地研究和计算[类群](@entry_id:182524)，我们需要一种在每个[等价类](@entry_id:156032)中选出一个标准或“最简单”代表元的方法。这个过程就是**约化理论** (reduction theory)。其具体形式取决于[判别式](@entry_id:174614) $D$ 的符号。

#### 正定情形 ($D  0$)

对于正定二次型，高斯给出了一个优美而完整的约化理论。一个本原正定二次型 $[a,b,c]$ 被称为是**约化的** (reduced)，如果其系数满足以下不等式：
$$
|b| \le a \le c
$$
并且，为了保证唯一性，当等号成立时（即 $|b|=a$ 或 $a=c$），附加约定 $b \ge 0$ [@problem_id:3009161]。

这个看似纯粹的代数条件有一个深刻的几何解释。我们可以将每个正定二次型 $f=[a,b,c]$ 唯一地与复数[上半平面](@entry_id:199119) $\mathbb{H}=\{z \in \mathbb{C} : \operatorname{Im}(z)>0\}$ 中的一个点联系起来，该点是方程 $az^2+bz+c=0$ 在上半平面的根：
$$
z = \frac{-b+\sqrt{D}}{2a}
$$
$SL_2(\mathbb{Z})$ 对二次型的作用，通过这种对应，转化为 $SL_2(\mathbb{Z})$ 在上半平面上的[分式线性变换](@entry_id:174812)作用 $z \mapsto \frac{\alpha z + \beta}{\gamma z + \delta}$。约化条件 $|b| \le a \le c$ 精确地对应于复数 $z$ 位于 $SL_2(\mathbb{Z})$ 作用的标准**基本区域** (fundamental domain) $\mathcal{F}$ 内，即：
$$
\mathcal{F} = \{z \in \mathbb{H} : |\operatorname{Re}(z)| \le \frac{1}{2}, |z| \ge 1\}
$$
其中，不等式 $|b| \le a$ 等价于 $|\operatorname{Re}(z)| = |-\frac{b}{2a}| \le \frac{1}{2}$，而不等式 $a \le c$ 等价于 $|z|^2 = \frac{c}{a} \ge 1$。边界上的附加条件 $b \ge 0$ 则是为了从被 $SL_2(\mathbb{Z})$ 变换粘合的[边界点](@entry_id:176493)中选出唯一的代表。

约化理论的一个基本定理是：每个正定二次型的[正常等价](@entry_id:635057)类中，存在且仅存在一个约化形式。因此，判别式为 $D$ 的本原正定二次型的类数 $h(D)$，就等于具有该[判别式](@entry_id:174614)的约化形式的个数。

这个[类数](@entry_id:156164) $h(D)$ 与数论中的一个深刻解析公式——**[狄利克雷类数公式](@entry_id:181220)** (Dirichlet's class number formula)——紧密相关 [@problem_id:3009150]。对于一个基本[判别式](@entry_id:174614) $D0$，该公式将[类数](@entry_id:156164)与一个$L$-函数在 $s=1$ 处的值联系起来：
$$
L(1, \chi_D) = \frac{2\pi h_K}{w\sqrt{|D|}}
$$
这里 $K=\mathbb{Q}(\sqrt{D})$ 是对应的[虚二次域](@entry_id:197298)，$h_K$ 是其理想类数（等于二次型的[类数](@entry_id:156164) $h(D)$），$\chi_D$ 是与 $K$ 相关的[狄利克雷特征](@entry_id:151586)，而 $w$ 是 $K$ 中[单位根](@entry_id:143302)的个数。这个量 $w$ 也与二次型理论直接相关，它等于主型 $[1,b_0,c_0]$ 的**自守群** (automorph group) 的阶数，即稳定化[子群](@entry_id:146164) $\mathrm{Stab}_{SL_2(\mathbb{Z})}(f)$ 的大小。对于大多数 $D0$，$w=2$。例外情况是 $D=-4$ 时（对应于型 $x^2+y^2$），$w=4$；以及 $D=-3$ 时（对应于型 $x^2+xy+y^2$），$w=6$。例如，我们可以直接计算出 $f(x,y)=x^2+xy+y^2$ 的稳定化[子群](@entry_id:146164)包含6个矩阵，因此其阶为 $6$ [@problem_id:3009183]。

#### 不定情形 ($D > 0$)

对于[不定二次型](@entry_id:191588)，约化理论更为复杂。每个等价类不再只包含一个约化形式，而是包含一个有限的**循环** (cycle) [@problem_id:3015022]。

一个本原[不定二次型](@entry_id:191588) $[a,b,c]$ 被认为是**约化的**，如果其系数满足：
$$
|\sqrt{D} - 2|a||  b  \sqrt{D}
$$
例如，对于型 $[1,1,-1]$, 其 $D=5$，我们有 $|\sqrt{5}-2| \approx 0.236  1  \sqrt{5} \approx 2.236$，因此它是约化的 [@problem_id:3009177]。

存在一个**约化算子** $R$，可以将一个约化形式映射到其[等价类](@entry_id:156032)中的下一个约化形式。重复应用此算子，我们就会遍历整个约化形式的循环。这个过程与方程 $at^2+bt+c=0$ 的根的**[连分数展开](@entry_id:636208)**密切相关。约化循[环的结构](@entry_id:150907)反映了[连分数展开](@entry_id:636208)的周期性。

与正定情形的有限自守群不同，[不定二次型](@entry_id:191588)的自守群是无限的。它由一个**基本自守** (fundamental automorph) 生成。这个基本自守矩阵可以通过求解相关的**佩尔型方程** (Pell-type equation) $t^2 - Du^2 = 4$ 的最小正整数解 $(t_1, u_1)$ 来构造。例如，对于[判别式](@entry_id:174614) $D=5$ 的型 $x^2+xy-y^2$，相关的[佩尔方程](@entry_id:136532)是 $t^2-5u^2=4$，其最小正解是 $(3,1)$。由此可以构造出基本自守矩阵 $M = \begin{pmatrix} 1  1 \\ 1  2 \end{pmatrix}$。这个矩阵的作用是将型的一个解 $(x,y)$ 变换为另一个解 $M\begin{pmatrix} x \\ y \end{pmatrix}$，从而生成无穷多个解 [@problem_id:3009177]。

最后，在不定情形下，主类内部的约化循环本身也具有丰富的结构，这被称为**主类基础结构** (infrastructure of the principal class)。粗略地说，[高斯复合](@entry_id:196619)在主循环上的作用近似于循环指标的加法。例如，若 $f_i$ 和 $f_j$ 是主循环中的两个约化形式，它们的复合再约化后得到的 $f_k$ 满足 $k \approx (i+j) \pmod m$，其中 $m$ 是循环的长度。这个精细的结构在现代[计算数论](@entry_id:199851)中有重要的应用 [@problem_id:3015022]。