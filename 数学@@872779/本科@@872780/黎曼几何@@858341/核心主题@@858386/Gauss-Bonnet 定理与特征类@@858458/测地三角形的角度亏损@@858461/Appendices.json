{"hands_on_practices": [{"introduction": "高斯-博内定理宏伟地将一个区域的总曲率与一个全局拓扑性质（角亏）联系起来。但这种联系在微观层面是如何产生的呢？本练习将引导你使用法坐标系，从第一性原理出发，推导出黎曼曲率张量如何直接导致一个无穷小测地三角形的角亏。这有助于从根本上建立起曲率导致几何偏离的直观理解。[@problem_id:3038090]", "problem": "设 $\\left(M,g\\right)$ 是一个二维黎曼流形，且 $p \\in M$。选择以 $p$ 为中心的正规坐标系 $\\left(x^{1},x^{2}\\right)$，使得 $g_{ij}(p)=\\delta_{ij}$ 并且 Christoffel 符号在 $p$ 点为零。在这些坐标系下，度量具有泰勒展开式\n$$\ng_{ij}(x)=\\delta_{ij}-\\frac{1}{3}R_{ikjl}(p)\\,x^{k}x^{l}+O\\!\\left(|x|^{3}\\right),\n$$\n其中 $R_{ikjl}$ 是黎曼曲率张量，且 $|x|^{2}=(x^{1})^{2}+(x^{2})^{2}$。考虑一个小的测地三角形 $T$，其顶点为 $p, q, r$。其中 $q$ 和 $r$ 位于坐标轴上：对于小的正参数 $a$ 和 $b$，$q$ 的坐标为 $(a,0)$，$r$ 的坐标为 $(0,b)$。$T$ 的每条边是连接相应顶点对的测地线段。定义 $T$ 的角亏为 $\\Delta(T)=\\alpha+\\beta+\\gamma-\\pi$，其中 $\\alpha,\\beta,\\gamma$ 分别是 $T$ 在顶点 $p,q,r$ 处的内角。\n\n从正规坐标系中 $g_{ij}$ 的展开式以及黎曼流形上角度和面积的基本定义出发，推导由曲率引起的 $\\Delta(T)$ 的第一个非平凡贡献项，到 $a$ 和 $b$ 的主阶。将你的最终答案以弧度表示，形式为一个关于 $p$ 点的高斯曲率 $K(p)$ 以及参数 $a$ 和 $b$ 的封闭解析表达式。不需要数值近似。", "solution": "问题要求基于度量张量在正规坐标系中的泰勒展开，求解小测地三角形 $T$ 的角亏 $\\Delta(T)$ 的主阶项。角亏定义为 $\\Delta(T) = \\alpha+\\beta+\\gamma-\\pi$，其中 $\\alpha$、$\\beta$ 和 $\\gamma$ 是三角形的内角。\n\n黎曼几何中的一个基本结果，高斯-博内定理（Gauss-Bonnet theorem），直接将测地三角形的角亏与高斯曲率 $K$ 在该三角形面积上的积分联系起来。对于二维流形上的一个测地三角形 $T$，该定理表述为：\n$$ \\alpha + \\beta + \\gamma - \\pi = \\iint_T K \\, dA $$\n其中 $dA$ 是流形上的面积元。因此，我们的任务是计算右侧积分关于小参数 $a$ 和 $b$ 的主阶项。\n\n计算过程分几步进行：\n1.  将高斯曲率 $K$ 和面积元 $dA$ 与度量张量 $g_{ij}$ 联系起来。\n2.  使用给定的 $g_{ij}$ 在正规坐标系中的泰勒展开，求出 $p$ 点附近 $K$ 和 $dA$ 的表达式。\n3.  近似计算在小测地三角形 $T$ 上的积分。\n\n设 $(x^1, x^2)$ 是以 $p$ 为中心的正规坐标系。三角形的顶点是位于 $(0,0)$ 的 $p$，位于 $(a,0)$ 的 $q$ 和位于 $(0,b)$ 的 $r$。\n\n首先，我们用 $p$ 点的黎曼张量分量来确定高斯曲率 $K(p)$。在二维情况下，黎曼张量的一般公式是 $R_{ikjl} = K(g_{il}g_{kj} - g_{ij}g_{kl})$。在 $p$ 点的正规坐标系中，我们有 $g_{ij}(p) = \\delta_{ij}$。计算 $p$ 点的分量 $R_{1212}$ 得到：\n$$ R_{1212}(p) = K(p) \\left( g_{11}(p)g_{22}(p) - g_{12}(p)g_{21}(p) \\right) = K(p) \\left( \\delta_{11}\\delta_{22} - \\delta_{12}\\delta_{21} \\right) = K(p)(1 \\cdot 1 - 0 \\cdot 0) = K(p) $$\n\n接下来，我们求面积元 $dA$。在局部坐标系中，$dA = \\sqrt{\\det(g_{ij})} \\, dx^1 dx^2$。我们需要使用给定的泰勒展开式来计算 $\\det(g_{ij})$：\n$$ g_{ij}(x) = \\delta_{ij} - \\frac{1}{3}R_{ikjl}(p) x^k x^l + O(|x|^3) $$\n度量张量的分量为：\n$g_{11}(x) = 1 - \\frac{1}{3}R_{1k1l}(p)x^k x^l + \\dots = 1 - \\frac{1}{3}R_{1212}(p)(x^2)^2 + \\dots = 1 - \\frac{1}{3}K(p)(x^2)^2 + O(|x|^3)$。\n$g_{22}(x) = 1 - \\frac{1}{3}R_{2k2l}(p)x^k x^l + \\dots = 1 - \\frac{1}{3}R_{2121}(p)(x^1)^2 + \\dots = 1 - \\frac{1}{3}K(p)(x^1)^2 + O(|x|^3)$。\n$g_{12}(x) = -\\frac{1}{3}R_{1k2l}(p)x^k x^l + \\dots = -\\frac{1}{3}(R_{1121}(x^1)^2 + (R_{1122}+R_{1221})x^1x^2 + R_{1222}(x^2)^2) + \\dots$。\n利用黎曼张量的对称性，$R_{1121}=0$，$R_{1222}=0$，以及 $R_{1122} + R_{1221} = -R_{1212} + R_{1212} = 0$。因此，$g_{12}(x) = O(|x|^3)$。\n\n度量的行列式为：\n$$ \\det(g(x)) = g_{11}(x)g_{22}(x) - (g_{12}(x))^2 $$\n$$ \\det(g(x)) = \\left(1 - \\frac{1}{3}K(p)(x^2)^2\\right)\\left(1 - \\frac{1}{3}K(p)(x^1)^2\\right) + O(|x|^4) $$\n$$ \\det(g(x)) = 1 - \\frac{1}{3}K(p)\\left((x^1)^2 + (x^2)^2\\right) + O(|x|^4) $$\n使用泰勒展开 $\\sqrt{1+u} \\approx 1 + u/2$ 求平方根：\n$$ \\sqrt{\\det(g(x))} = 1 - \\frac{1}{6}K(p)\\left((x^1)^2 + (x^2)^2\\right) + O(|x|^4) $$\n\n现在我们可以写出角亏的积分表达式：\n$$ \\Delta(T) = \\iint_T K(x) \\sqrt{\\det(g(x))} \\, dx^1 dx^2 $$\n积分区域是连接 $p,q,r$ 的测地线所围成的区域 $T$。由于 $a$ 和 $b$ 很小，该三角形很小且位于 $p$ 附近。为了进行主阶计算，我们可以做以下近似：\n1.  曲率 $K(x)$ 可以用其在 $p$ 点的值来近似，即 $K(x) \\approx K(p)$。修正项的阶为 $|x|$，积分后将产生 $a$ 和 $b$ 的高阶项。\n2.  面积元因子 $\\sqrt{\\det(g(x))}$ 可以近似为 $1$。修正项的阶为 $|x|^2$，这也会在最终结果中产生高阶项。\n3.  积分区域，即测地三角形 $T$，可以用坐标平面上顶点为 $(0,0)$、$(a,0)$ 和 $(0,b)$ 的欧几里得三角形 $T_E$ 来近似。这是因为在正规坐标系中，通过原点 $p$ 的测地线就是坐标轴，所以 $T$ 的两条边是直线段。第三条边，即从 $q$ 到 $r$ 的测地线，与直线的偏离量是 $a$ 和 $b$ 的高阶项，因此对积分面积的修正也是高阶的。\n\n结合这些近似，我们计算积分的主阶项：\n$$ \\Delta(T) \\approx \\iint_{T_E} K(p) \\cdot 1 \\, dx^1 dx^2 = K(p) \\iint_{T_E} dx^1 dx^2 $$\n积分 $\\iint_{T_E} dx^1 dx^2$ 就是欧几里得三角形 $T_E$ 的面积。该面积为：\n$$ \\text{Area}(T_E) = \\frac{1}{2} \\times \\text{底} \\times \\text{高} = \\frac{1}{2}ab $$\n因此，角亏的第一个非平凡贡献项，到 $a$ 和 $b$ 的主阶，是：\n$$ \\Delta(T) \\approx K(p) \\left(\\frac{1}{2}ab\\right) $$\n此项的阶为 $O(ab)$。任何修正，无论是来自被积函数 ($K(x)\\sqrt{\\det g}$) 的泰勒展开，还是来自积分区域的变形，都将涉及小参数 $a$ 和 $b$ 的更高次幂（例如，$O(a^3b)$, $O(ab^3)$），因此对于主阶结果可以忽略不计。\n最终的表达式是高斯-博内定理的局部形式，通常称为 Bertrand-Diguet-Puiseux 定理。", "answer": "$$\\boxed{\\frac{1}{2}K(p)ab}$$", "id": "3038090"}, {"introduction": "在建立了曲率与角亏之间的基本联系后，我们可以进一步探索它的内在属性。如果我们通过缩放度量来“放大”或“缩小”整个流形，角亏会发生什么变化？本练习将证明，角亏在二维情况下对于这种常数共形变换是保持不变的，这揭示了它是一个深刻的内蕴几何量。[@problem_id:3038109]", "problem": "设 $(M,g)$ 是一个光滑、有向的二维（2D）黎曼流形，并设 $\\Delta \\subset M$ 是一个测地三角形，其边是关于度量 $g$ 的测地线。记 $\\delta(g,\\Delta)$ 为角亏，其定义为 $\\delta(g,\\Delta) = \\alpha + \\beta + \\gamma - \\pi$，其中 $\\alpha$、$\\beta$ 和 $\\gamma$ 是 $\\Delta$ 的内角，以弧度为单位。考虑度量的常数缩放 $g \\mapsto g' = \\lambda^{2} g$，其中 $\\lambda  0$ 是一个固定的常数。对于这两个度量，区域 $\\Delta$ 是 $M$ 的同一个子集。仅使用 Levi-Civita 联络、黎曼曲率张量、高斯曲率以及面积元在度量常数缩放下的基本性质，确定比值\n$$\n\\frac{\\delta(g',\\Delta)}{\\delta(g,\\Delta)}.\n$$\n将您的最终答案表示为一个实数。全文中的角度均以弧度为单位。", "solution": "该问题要求一个测地三角形 $\\Delta$ 在两个不同度量 $g$ 和 $g' = \\lambda^2 g$ (其中 $\\lambda  0$ 是一个常数)下的角亏之比。对于一个度量 $h$ 和三角形 $\\Delta$，其角亏由 $\\delta(h, \\Delta) = \\alpha_h + \\beta_h + \\gamma_h - \\pi$ 给出，其中 $\\alpha_h, \\beta_h, \\gamma_h$ 是关于度量 $h$ 测量的内角。\n\n解决方案将使用测地三角形的 Gauss-Bonnet 定理来推导，该定理将角亏与高斯曲率在三角形内部的积分联系起来。该定理表述为：\n$$ \\delta(g, \\Delta) = \\iint_{\\Delta} K_g \\, dA_g $$\n其中 $K_g$ 是高斯曲率，$dA_g$ 是对应于度量 $g$ 的面积元。为了将此定理应用于缩放后的度量 $g'$，我们必须首先证明 $\\Delta$ 关于 $g'$ 也是一个测地三角形。\n\n一条曲线 $\\gamma(t)$ 如果满足测地线方程 $\\nabla_{\\dot{\\gamma}}\\dot{\\gamma} = 0$，则它是一条测地线，其中 $\\nabla$ 是 Levi-Civita 联络。在局部坐标 $\\{x^i\\}$ 中，该方程为 $\\ddot{x}^k + \\Gamma_{ij}^k \\dot{x}^i \\dot{x}^j = 0$，其中 $\\Gamma_{ij}^k$ 是联络的 Christoffel 符号。让我们来确定度量 $g'_{ij} = \\lambda^2 g_{ij}$ 的 Christoffel 符号 $\\Gamma'_{ij}{}^k$。其逆度量为 $g'^{ij} = \\lambda^{-2} g^{ij}$。\nChristoffel 符号由以下公式给出：\n$$ \\Gamma'_{ij}{}^k = \\frac{1}{2} g'^{kl} \\left( \\frac{\\partial g'_{jl}}{\\partial x^i} + \\frac{\\partial g'_{il}}{\\partial x^j} - \\frac{\\partial g'_{ij}}{\\partial x^l} \\right) $$\n由于 $\\lambda$ 是一个常数，其偏导数为零。\n$$ \\frac{\\partial g'_{jl}}{\\partial x^i} = \\frac{\\partial (\\lambda^2 g_{jl})}{\\partial x^i} = \\lambda^2 \\frac{\\partial g_{jl}}{\\partial x^i} $$\n将此代入 $\\Gamma'_{ij}{}^k$ 的公式中：\n$$ \\Gamma'_{ij}{}^k = \\frac{1}{2} (\\lambda^{-2} g^{kl}) \\left( \\lambda^2 \\frac{\\partial g_{jl}}{\\partial x^i} + \\lambda^2 \\frac{\\partial g_{il}}{\\partial x^j} - \\lambda^2 \\frac{\\partial g_{ij}}{\\partial x^l} \\right) $$\n$$ \\Gamma'_{ij}{}^k = \\frac{\\lambda^2}{\\lambda^2} \\cdot \\frac{1}{2} g^{kl} \\left( \\frac{\\partial g_{jl}}{\\partial x^i} + \\frac{\\partial g_{il}}{\\partial x^j} - \\frac{\\partial g_{ij}}{\\partial x^l} \\right) = \\Gamma_{ij}^k $$\nChristoffel 符号在度量的常数共形缩放下是不变的。由于测地线方程仅依赖于 Christoffel 符号，因此 $g$ 和 $g'$ 的未参数化测地线集合是相同的。因此，作为 $g$ 的测地线的 $\\Delta$ 的边，也同样是 $g'$ 的测地线。这证实了 $\\Delta$ 相对于 $g'$ 是一个测地三角形，我们可以对其应用 Gauss-Bonnet 定理。\n\n$g'$ 的角亏为：\n$$ \\delta(g', \\Delta) = \\iint_{\\Delta} K_{g'} \\, dA_{g'} $$\n我们需要找出高斯曲率 $K_{g'}$ 和面积元 $dA_{g'}$ 如何与 $K_g$ 和 $dA_g$ 相关。\n\n首先，我们来分析面积元。在一个二维流形中，使用局部坐标 $(x^1, x^2)$，面积元为 $dA_g = \\sqrt{\\det(g_{ij})} \\, dx^1 \\wedge dx^2$。对于度量 $g'$，其分量矩阵为 $[g'] = \\lambda^2 [g]$。其行列式为 $\\det(g'_{ij}) = \\det(\\lambda^2 g_{ij})$。由于维数是 2，$\\det(g'_{ij}) = (\\lambda^2)^2 \\det(g_{ij}) = \\lambda^4 \\det(g_{ij})$。\n新的面积元 $dA_{g'}$ 为：\n$$ dA_{g'} = \\sqrt{\\det(g'_{ij})} \\, dx^1 \\wedge dx^2 = \\sqrt{\\lambda^4 \\det(g_{ij})} \\, dx^1 \\wedge dx^2 = \\lambda^2 \\sqrt{\\det(g_{ij})} \\, dx^1 \\wedge dx^2 $$\n因此，我们有如下关系：\n$$ dA_{g'} = \\lambda^2 dA_g $$\n\n接下来，我们分析高斯曲率 $K_g$。高斯曲率可以用黎曼曲率张量来表示。(1,3) 型黎曼张量的分量由下式给出：\n$$ R^i{}_{jkl} = \\frac{\\partial \\Gamma^i_{jl}}{\\partial x^k} - \\frac{\\partial \\Gamma^i_{jk}}{\\partial x^l} + \\Gamma^p_{jl}\\Gamma^i_{pk} - \\Gamma^p_{jk}\\Gamma^i_{pl} $$\n由于我们发现 $\\Gamma'_{ij}{}^k = \\Gamma_{ij}{}^k$，等式右边的所有项对于两个度量都是相同的。因此，(1,3) 型黎曼张量也是不变的：\n$$ R'^i{}_{jkl} = R^i{}_{jkl} $$\n(0,4) 型黎曼张量通过降低第一个指标得到：$R_{ijkl} = g_{im} R^m{}_{jkl}$。对于度量 $g'$，这变为：\n$$ R'_{ijkl} = g'_{im} R'^m{}_{jkl} = (\\lambda^2 g_{im}) R^m{}_{jkl} = \\lambda^2 (g_{im} R^m{}_{jkl}) = \\lambda^2 R_{ijkl} $$\n二维流形的高斯曲率 $K$ 由黎曼张量的单个独立分量给出，例如 $K_g = \\frac{R_{1212}}{\\det(g)}$。对于度量 $g'$：\n$$ K_{g'} = \\frac{R'_{1212}}{\\det(g')} $$\n使用我们找到的关系式：$R'_{1212} = \\lambda^2 R_{1212}$ 和 $\\det(g') = \\lambda^4 \\det(g)$。\n$$ K_{g'} = \\frac{\\lambda^2 R_{1212}}{\\lambda^4 \\det(g)} = \\frac{1}{\\lambda^2} \\frac{R_{1212}}{\\det(g)} = \\lambda^{-2} K_g $$\n\n现在我们可以计算角亏 $\\delta(g', \\Delta)$：\n$$ \\delta(g', \\Delta) = \\iint_{\\Delta} K_{g'} \\, dA_{g'} $$\n代入 $K_{g'}$ 和 $dA_{g'}$ 的缩放关系：\n$$ \\delta(g', \\Delta) = \\iint_{\\Delta} (\\lambda^{-2} K_g) (\\lambda^2 dA_g) $$\n由于 $\\lambda$ 是常数，我们可以将 $\\lambda^{-2}$ 和 $\\lambda^2$ 提出来：\n$$ \\delta(g', \\Delta) = \\lambda^{-2} \\lambda^2 \\iint_{\\Delta} K_g \\, dA_g = 1 \\cdot \\iint_{\\Delta} K_g \\, dA_g $$\n根据 Gauss-Bonnet 定理，这个积分正是原始度量 $g$ 的角亏：\n$$ \\delta(g', \\Delta) = \\delta(g, \\Delta) $$\n角亏在度量的常数共形缩放下是不变的。\n\n问题要求比值 $\\frac{\\delta(g',\\Delta)}{\\delta(g,\\Delta)}$。假设三角形位于非零曲率区域，使得 $\\delta(g,\\Delta) \\neq 0$，则该比值为：\n$$ \\frac{\\delta(g',\\Delta)}{\\delta(g,\\Delta)} = \\frac{\\delta(g,\\Delta)}{\\delta(g,\\Delta)} = 1 $$\n\n另外，也可以证明角度本身是不变的。两切向量 $u, v$ 在某一点的夹角 $\\theta$ 定义为 $\\cos \\theta = \\frac{g(u,v)}{\\sqrt{g(u,u)g(v,v)}}$。对于缩放后的度量 $g' = \\lambda^2 g$，夹角 $\\theta'$ 为：\n$$ \\cos \\theta' = \\frac{g'(u,v)}{\\sqrt{g'(u,u)g'(v,v)}} = \\frac{\\lambda^2 g(u,v)}{\\sqrt{(\\lambda^2 g(u,u))(\\lambda^2 g(v,v))}} = \\frac{\\lambda^2 g(u,v)}{\\lambda^2 \\sqrt{g(u,u)g(v,v)}} = \\cos \\theta $$\n因此，角度 $\\alpha, \\beta, \\gamma$ 保持不变。由此直接得出 $\\delta(g', \\Delta) = \\alpha + \\beta + \\gamma - \\pi = \\delta(g, \\Delta)$，得到相同的比值。然而，问题明确要求使用涉及曲率和面积元的方法，这也是我们使用的主要方法。", "answer": "$$\n\\boxed{1}\n$$", "id": "3038109"}, {"introduction": "最后一个练习将理论与实际计算联系起来。基于基本关系式 $\\delta = \\int_{\\Delta} K dA$，你将设计并实现一个数值算法，用于估算球面上和双曲平面上等不同曲面中测地三角形的角亏。这个练习展示了如何将深刻的理论洞见转化为探索弯曲空间的强大计算工具。[@problem_id:3038073]", "problem": "你的任务是实现一个数值估计器，通过在二维黎曼流形上的一个测地三角形区域内对高斯曲率 $K$ 进行积分，来计算该三角形的角亏 $\\delta$。设计必须遵循基本原理：使用适用于测地三角形的高斯-博内定理以及从度量导出的局域面积元。避免使用捷径；通过对三角形进行网格划分并对各单元的贡献求和，来仔细构建估计器。\n\n基本核心定义：\n- 设 $(M,g)$ 是一个带有度量张量 $g$ 的二维黎曼流形。高斯曲率 $K$ 是由 $g$ 决定的内蕴曲率。曲面面积元 $dA$ 由 $g$ 决定。\n- 对于 $(M,g)$ 中一个具有测地边的测地三角形 $\\Delta$，高斯-博内定理表明其角亏 $\\delta$ 等于 $K$ 在 $\\Delta$ 上的面积分，即 $\\delta$ 等于 $\\int_{\\Delta} K\\,dA$，因为每条边的测地曲率均为零，只有内角对 $\\delta$ 有贡献。此关系是设计数值估计器的基本原则。\n- 该数值估计器必须通过用小单元网格覆盖三角形，在每个单元上近似 $K$ 和 $dA$，并对各贡献求和来近似 $\\delta$。\n\n算法要求：\n- 近似 $\\delta \\approx \\sum_{i} K(p_{i})\\,\\Delta A_{i}$，其中 $p_{i}$是单元 $i$ 中的一个代表点（例如，单元中点），$\\Delta A_{i}$ 是由度量导出的该单元的面积。\n\n你的程序必须为以下模型和测地三角形参数集实现此估计器。对于每种情况，使用指定的度量和面积元，并以弧度为单位生成角亏 $\\delta$。将区域离散化为均匀网格，并对每个单元使用中点采样。\n\n模型：\n1. 欧几里得平面，具有标准度量 $g = dx^{2} + dy^{2}$，其中高斯曲率为 $K = 0$，面积元为 $dA = dx\\,dy$。\n2. 半径为 $R$ 的球面，使用球坐标 $(\\theta,\\phi)$，其中 $\\theta \\in [0,\\pi]$ 是余纬，$\\phi \\in [0,2\\pi)$ 是经度。度量的面积元为 $dA = R^{2}\\sin\\theta\\,d\\theta\\,d\\phi$，高斯曲率为常数 $K = 1/R^{2}$。\n3. 庞加莱圆盘模型中的双曲平面，坐标 $(x,y)$ 位于单位圆盘 $x^{2}+y^{2}  1$ 内，度量为 $ds^{2} = \\frac{4(dx^{2}+dy^{2})}{(1 - x^{2} - y^{2})^{2}}$。面积元为 $dA = \\frac{4}{(1 - r^{2})^{2}}\\,dx\\,dy$，其中 $r^{2} = x^{2}+y^{2}$，高斯曲率为常数 $K = -1$。\n\n测地三角形和网格规格：\n- 情况 A（欧几里得平面，理想情况）：顶点为 $(0,0)$、$(1,0)$、$(0,1)$ 的三角形。该三角形由直线段界定，这些直线段是欧几里得平面中的测地线。在边界框 $[0,1]\\times[0,1]$ 上使用均匀矩形网格，如果单元的中点 $(x,y)$ 满足 $x \\ge 0$, $y \\ge 0$ 和 $x + y \\le 1$，则包含该单元。网格分辨率使用 $N_{x} = 400$ 和 $N_{y} = 400$。\n- 情况 B（半径为 $R=1$ 的球面，大的直角测地三角形）：由经线 $\\phi = 0$ 和 $\\phi = \\pi/2$ 以及赤道 $\\theta = \\pi/2$ 界定的球面楔。第三个顶点在北极 $\\theta=0$。所有三个边界都是大圆，因此是测地线。在球坐标中的矩形区域 $\\theta \\in [0,\\pi/2]$，$\\phi \\in [0,\\pi/2]$上进行积分。使用 $N_{\\theta} = 600$ 和 $N_{\\phi} = 600$。\n- 情况 C（半径为 $R=1$ 的球面，小的直角测地三角形）：由经线 $\\phi = 0$ 和 $\\phi = 0.3$ 以及赤道 $\\theta = \\pi/2$ 界定的球面楔。在矩形区域 $\\theta \\in [0,\\pi/2]$，$\\phi \\in [0,0.3]$上进行积分。使用 $N_{\\theta} = 600$ 和 $N_{\\phi} = 600$。\n- 情况 D（半径为 $R=2$ 的球面，中等大小的直角测地三角形）：由经线 $\\phi = 0$ 和 $\\phi = \\pi/3$ 以及赤道 $\\theta = \\pi/2$ 界定的球面楔。在矩形区域 $\\theta \\in [0,\\pi/2]$，$\\phi \\in [0,\\pi/3]$上进行积分。使用 $N_{\\theta} = 600$ 和 $N_{\\phi} = 600$。\n- 情况 E（庞加莱圆盘中的双曲平面，曲边测地三角形）：设两边是沿坐标轴 $x=0$ 和 $y=0$ 的直径；第三边是与单位圆正交的圆，其圆心为 $\\mathbf{c} = (1.2,1.2)$，半径 $r_{\\mathrm{circ}}$ 由正交性条件 $r_{\\mathrm{circ}}^{2} = \\|\\mathbf{c}\\|^{2} - 1$ 确定。该三角形的内部是满足 $x \\ge 0$，$y \\ge 0$，$(x - c_{x})^{2} + (y - c_{y})^{2} \\le r_{\\mathrm{circ}}^{2}$ 和 $x^{2} + y^{2}  1$ 的点集。在正方形 $[0,1]\\times[0,1]$ 上进行积分，网格分辨率为 $N_{x} = 500$，$N_{y} = 500$，但仅包含中点位于单位圆盘和指定测地三角形区域内的单元。使用庞加莱面积元和 $K=-1$。\n\n角度单位：\n- 以弧度为单位报告所有角亏 $\\delta$。\n\n最终输出格式：\n- 你的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，格式为 $[\\delta_{\\mathrm{A}},\\delta_{\\mathrm{B}},\\delta_{\\mathrm{C}},\\delta_{\\mathrm{D}},\\delta_{\\mathrm{E}}]$，其中每个条目都是一个浮点数。例如，一个有效的输出格式是“[0.0,1.5707963267948966,0.3,1.0471975511965976,-0.4123456789]”。\n\n测试套件覆盖说明：\n- 情况 A 验证零曲率的平坦情况。\n- 情况 B–D 验证具有不同角宽度和不同半径 $R$ 的球面楔的正恒定曲率和缩放情况。\n- 情况 C 作为具有小角亏的小面积边缘情况。\n- 情况 E 运用了负曲率和一个非平凡的测地边界（圆弧），在面积元非均匀的弯曲度量中检验估计器。\n\n你的实现必须是完全自包含的，并且不需要任何输入。在每个网格单元内使用中点采样。通过为每个模型使用正确的面积元和曲率，并逐个单元地对贡献求和，来确保科学真实性。所有计算出的 $\\delta$ 值都必须是弧度制的浮点数。", "solution": "该问题要求在一个二维黎曼流形 $(M, g)$ 上实现一个用于测地三角形 $\\Delta$ 的角亏 $\\delta$ 的数值估计器。该设计基于高斯-博内定理。\n\n**问题验证**\n\n**步骤 1：提取已知条件**\n\n- **基本原理**：对于一个二维黎曼流形上的测地三角形 $\\Delta$，其角亏 $\\delta$ 由高斯曲率 $K$ 在该三角形面积上的积分给出：$\\delta = \\int_{\\Delta} K \\, dA$。\n- **数值方法**：该积分将通过对单元网格求和来近似：$\\delta \\approx \\sum_{i} K(p_{i})\\,\\Delta A_{i}$，使用中点采样（$p_i$ 是单元中点）和每个单元由度量导出的面积 $\\Delta A_i$。\n\n- **模型 1：欧几里得平面**\n  - 度量：$g = dx^{2} + dy^{2}$\n  - 高斯曲率：$K = 0$\n  - 面积元：$dA = dx\\,dy$\n\n- **模型 2：球面**\n  - 坐标：$(\\theta, \\phi)$，其中 $\\theta \\in [0,\\pi]$ 且 $\\phi \\in [0,2\\pi)$\n  - 半径：$R$\n  - 高斯曲率：$K = 1/R^{2}$\n  - 面积元：$dA = R^{2}\\sin\\theta\\,d\\theta\\,d\\phi$\n\n- **模型 3：双曲平面（庞加莱圆盘）**\n  - 坐标：$(x,y)$，其中 $x^{2}+y^{2}  1$\n  - 度量：$ds^{2} = \\frac{4(dx^{2}+dy^{2})}{(1 - x^{2} - y^{2})^{2}}$\n  - 高斯曲率：$K = -1$\n  - 面积元：$dA = \\frac{4}{(1 - r^{2})^{2}}\\,dx\\,dy$，其中 $r^{2} = x^{2}+y^{2}$\n\n- **情况 A (欧几里得)**：\n  - 三角形顶点：$(0,0)$, $(1,0)$, $(0,1)$。\n  - 区域：$x \\ge 0$，$y \\ge 0$ 且 $x + y \\le 1$。\n  - 网格：在 $[0,1]\\times[0,1]$ 上的均匀网格，分辨率为 $N_{x} = 400$，$N_{y} = 400$。\n\n- **情况 B (球面)**：\n  - 半径：$R=1$。\n  - 三角形（球面楔）区域：$\\theta \\in [0,\\pi/2]$，$\\phi \\in [0,\\pi/2]$。\n  - 网格：$N_{\\theta} = 600$，$N_{\\phi} = 600$。\n\n- **情况 C (球面)**：\n  - 半径：$R=1$。\n  - 三角形（球面楔）区域：$\\theta \\in [0,\\pi/2]$，$\\phi \\in [0,0.3]$。\n  - 网格：$N_{\\theta} = 600$，$N_{\\phi} = 600$。\n\n- **情况 D (球面)**：\n  - 半径：$R=2$。\n  - 三角形（球面楔）区域：$\\theta \\in [0,\\pi/2]$，$\\phi \\in [0,\\pi/3]$。\n  - 网格：$N_{\\theta} = 600$，$N_{\\phi} = 600$。\n\n- **情况 E (双曲平面)**：\n  - 区域：$x \\ge 0$，$y \\ge 0$，$(x - c_{x})^{2} + (y - c_{y})^{2} \\le r_{\\mathrm{circ}}^{2}$，且 $x^{2} + y^{2}  1$。\n  - 测地圆圆心：$\\mathbf{c} = (1.2,1.2)$。\n  - 正交条件：$r_{\\mathrm{circ}}^{2} = \\|\\mathbf{c}\\|^{2} - 1$。\n  - 网格：在 $[0,1]\\times[0,1]$ 上的均匀网格，分辨率为 $N_{x} = 500$，$N_{y} = 500$。\n\n- **输出要求**：以弧度为单位的单行逗号分隔浮点数列表：$[\\delta_{\\mathrm{A}},\\delta_{\\mathrm{B}},\\delta_{\\mathrm{C}},\\delta_{\\mathrm{D}},\\delta_{\\mathrm{E}}]$。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据、是适定的且客观的。它基于微分几何的基本原理（高斯-博内定理）和标准数值方法（使用中点法则的黎曼和），提供了一个清晰、可形式化的任务。所有模型（欧几里得平面、球面、庞加莱圆盘）及其相关的曲率和面积元都是标准的，并且陈述正确。每种情况都提供了所有必要的数据，包括积分域的精确定义和数值网格的参数。该问题是自包含、一致的，并且没有任何说明中列出的使其无效的缺陷。\n\n**步骤 3：结论与行动**\n该问题是**有效的**。将开发一个解决方案。\n\n**解决方案推导**\n\n任务的核心是为五个不同情况数值计算积分 $\\delta = \\int_{\\Delta} K \\, dA$。我们将离散化积分域，并使用中点法则以黎曼和来近似该积分。\n\n数值近似的通用公式是：\n$$\n\\delta \\approx \\sum_{i} K(p_i) \\Delta A_i\n$$\n其中，和是对所有中点 $p_i$ 位于三角形 $\\Delta$ 内的单元 $i$ 进行的。$\\Delta A_i$ 是单元 $i$ 的面积。\n\n**情况 A：欧几里得平面**\n欧几里得平面的高斯曲率为 $K=0$。该三角形由顶点 $(0,0)$、$(1,0)$ 和 $(0,1)$ 定义。角亏由以下公式给出：\n$$\n\\delta_A = \\int_{\\Delta_A} 0 \\, dA = 0\n$$\n数值估计器也将得到 $0$，因为和中的每一项 $K(p_i)$ 都为 $0$。实现将平凡地计算此值，作为基线验证。\n\n**情况 B, C, D：半径为 $R$ 的球面**\n对于半径为 $R$ 的球面，高斯曲率为常数 $K = 1/R^2$，球坐标 $(\\theta, \\phi)$ 中的面积元为 $dA = R^2 \\sin\\theta \\, d\\theta \\, d\\phi$。乘积 $K \\, dA$ 大大简化：\n$$\nK \\, dA = \\left(\\frac{1}{R^2}\\right) (R^2 \\sin\\theta \\, d\\theta \\, d\\phi) = \\sin\\theta \\, d\\theta \\, d\\phi\n$$\n注意，结果与半径 $R$ 无关。角亏仅取决于三角形所对的立体角。\n指定的三角形是在 $(\\theta, \\phi)$ 坐标中由矩形区域定义的球面楔：$\\theta \\in [0, \\pi/2]$ 和 $\\phi \\in [0, \\phi_{max}]$。该积分是可分离的：\n$$\n\\delta = \\int_0^{\\phi_{max}} \\int_0^{\\pi/2} \\sin\\theta \\, d\\theta \\, d\\phi = \\left(\\int_0^{\\phi_{max}} d\\phi\\right) \\left(\\int_0^{\\pi/2} \\sin\\theta \\, d\\theta\\right) = \\phi_{max} [-\\cos\\theta]_0^{\\pi/2} = \\phi_{max}(0 - (-1)) = \\phi_{max}\n$$\n精确的角亏为：\n- 情况 B：$R=1$，$\\phi_{max} = \\pi/2$。$\\delta_B = \\pi/2$。\n- 情况 C：$R=1$，$\\phi_{max} = 0.3$。$\\delta_C = 0.3$。\n- 情况 D：$R=2$，$\\phi_{max} = \\pi/3$。$\\delta_D = \\pi/3$。\n\n这些情况的数值估计器将对 $(\\theta, \\phi)$ 空间中的网格进行求和。网格分辨率为 $N_\\theta$ 和 $N_\\phi$。单元尺寸为 $d\\theta = (\\pi/2)/N_\\theta$ 和 $d\\phi = \\phi_{max}/N_\\phi$。单元 $(i, j)$ 的中点是 $(\\theta_{m,i}, \\phi_{m,j})$，其中 $\\theta_{m,i} = (i+0.5)d\\theta$ 且 $\\phi_{m,j} = (j+0.5)d\\phi$。每个单元的贡献是 $K(p_{ij}) \\Delta A_{ij} = \\sin(\\theta_{m,i}) d\\theta d\\phi$。总角亏近似为：\n$$\n\\delta \\approx \\sum_{i=0}^{N_\\theta-1} \\sum_{j=0}^{N_\\phi-1} \\sin(\\theta_{m,i}) \\, d\\theta \\, d\\phi = (N_\\phi \\, d\\phi) \\left( \\sum_{i=0}^{N_\\theta-1} \\sin(\\theta_{m,i}) \\, d\\theta \\right) = \\phi_{max} \\sum_{i=0}^{N_\\theta-1} \\sin\\left(\\left(i+\\frac{1}{2}\\right)dtheta\\right) d\\theta\n$$\n此公式将针对情况 B、C 和 D 及其各自的参数进行实现。\n\n**情况 E：双曲平面（庞加莱圆盘）**\n高斯曲率为常数 $K = -1$。笛卡尔坐标 $(x,y)$ 中的面积元为 $dA = \\frac{4}{(1 - r^2)^2} \\, dx \\, dy$，其中 $r^2 = x^2+y^2$。角亏为 $\\delta_E = \\int_{\\Delta_E} K \\, dA = - \\int_{\\Delta_E} \\frac{4}{(1-r^2)^2} \\, dx \\, dy$。这等价于该三角形双曲面积的负值。\n\n积分域 $\\Delta_E$ 由点 $(x,y)$ 的四个条件定义：\n1. $x \\ge 0$\n2. $y \\ge 0$\n3. $(x - c_x)^2 + (y - c_y)^2 \\le r_{\\mathrm{circ}}^2$，其中 $c_x = 1.2$，$c_y = 1.2$，且 $r_{\\mathrm{circ}}^2 = c_x^2 + c_y^2 - 1 = 1.2^2 + 1.2^2 - 1 = 1.44 + 1.44 - 1 = 1.88$。\n4. $x^2 + y^2  1$（在庞加莱圆盘内部）。\n\n数值估计器将边界框 $[0,1] \\times [0,1]$ 网格化为 $N_x \\times N_y$ 个单元，其中 $N_x=500$ 且 $N_y=500$。单元尺寸为 $dx=1/N_x$ 和 $dy=1/N_y$。单元 $(i,j)$ 的中点为 $(x_{m,i}, y_{m,j})$，其中 $x_{m,i} = (i+0.5)dx$ 且 $y_{m,j} = (j+0.5)dy$。\n\n对于每个单元，我们检查其中心点 $(x_m, y_m)$ 是否满足在 $\\Delta_E$ 内的条件。如果满足，我们将其贡献加到总角亏中。以 $(x_m, y_m)$ 为中心的单个单元的贡献为：\n$$\n\\Delta \\delta = K(x_m, y_m) \\cdot \\Delta A = (-1) \\cdot \\frac{4}{(1 - (x_m^2 + y_m^2))^2} \\, dx \\, dy\n$$\n总角亏是所有有效单元贡献的总和：\n$$\n\\delta_E \\approx \\sum_{i,j \\text{ s.t. } p_{ij} \\in \\Delta_E} - \\frac{4}{(1 - (x_{m,i}^2 + y_{m,j}^2))^2} \\, dx \\, dy\n$$\n这将通过生成中点网格，创建一个布尔掩码来识别 $\\Delta_E$ 内部的点，计算每个网格点的贡献，并在掩码为真的地方对贡献求和来实现。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef _calculate_spherical_defect(R, phi_max, N_theta, N_phi):\n    \"\"\"\n    Calculates the angle defect of a spherical wedge using numerical integration.\n    The wedge is defined by theta in [0, pi/2] and phi in [0, phi_max].\n    \"\"\"\n    K = 1.0 / (R**2)\n    theta_max = np.pi / 2.0\n    \n    d_theta = theta_max / N_theta\n    d_phi = phi_max / N_phi\n\n    # Midpoint theta values\n    theta_midpoints = (np.arange(N_theta) + 0.5) * d_theta\n    \n    # K*dA = (1/R^2) * R^2*sin(theta)*d_theta*d_phi = sin(theta)*d_theta*d_phi\n    # We can sum over phi first, which is a simple multiplication by N_phi\n    # as the integrand does not depend on phi.\n    # Sum_j(sin(theta_m)*d_theta*d_phi) = N_phi * sin(theta_m) * d_theta * d_phi\n    # Then sum over theta.\n    \n    # Vectorized sum over all theta midpoints\n    # The term sin(theta_m) * d_theta approximates integral of sin(theta) d_theta\n    # The term phi_max approximates integral of d_phi\n    defect_sum = np.sum(np.sin(theta_midpoints)) * d_theta * phi_max\n    \n    return defect_sum\n\ndef _calculate_case_a():\n    \"\"\"Case A (Euclidean plane, happy path)\"\"\"\n    # Gaussian curvature K=0, so the integral of K*dA is 0.\n    return 0.0\n\ndef _calculate_case_b():\n    \"\"\"Case B (Sphere with R=1, large right-angled geodesic triangle)\"\"\"\n    R = 1.0\n    N_theta = 600\n    N_phi = 600\n    phi_max = np.pi / 2.0\n    return _calculate_spherical_defect(R, phi_max, N_theta, N_phi)\n\ndef _calculate_case_c():\n    \"\"\"Case C (Sphere with R=1, small right-angled geodesic triangle)\"\"\"\n    R = 1.0\n    N_theta = 600\n    N_phi = 600\n    phi_max = 0.3\n    return _calculate_spherical_defect(R, phi_max, N_theta, N_phi)\n\ndef _calculate_case_d():\n    \"\"\"Case D (Sphere with R=2, medium right-angled geodesic triangle)\"\"\"\n    R = 2.0\n    N_theta = 600\n    N_phi = 600\n    phi_max = np.pi / 3.0\n    return _calculate_spherical_defect(R, phi_max, N_theta, N_phi)\n\ndef _calculate_case_e():\n    \"\"\"Case E (Hyperbolic plane in the Poincaré disk)\"\"\"\n    Nx = 500\n    Ny = 500\n    \n    # Bounding box for integration\n    x_lim, y_lim = 1.0, 1.0\n    dx = x_lim / Nx\n    dy = y_lim / Ny\n    \n    # Parameters for the third geodesic boundary (a circular arc)\n    cx, cy = 1.2, 1.2\n    r_circ_sq = cx**2 + cy**2 - 1.0\n\n    # Create a mesh of midpoint coordinates for each cell\n    x_midpoints = (np.arange(Nx) + 0.5) * dx\n    y_midpoints = (np.arange(Ny) + 0.5) * dy\n    xx, yy = np.meshgrid(x_midpoints, y_midpoints, indexing='ij')\n\n    # Define the region of the geodesic triangle using boolean masks\n    # Condition 1: must be inside the Poincare disk\n    mask_disk = (xx**2 + yy**2)  1.0\n    # Condition 2: must be inside the region bounded by the orthogonal circle\n    mask_geodesic = ((xx - cx)**2 + (yy - cy)**2) = r_circ_sq\n    # Conditions x>=0 and y>=0 are handled by the mesh grid range from 0 to 1\n    \n    # Combine masks to find all valid cells\n    valid_mask = mask_disk  mask_geodesic\n\n    # Calculate contributions for all cells in the grid\n    K = -1.0\n    rr_sq = xx**2 + yy**2\n    \n    # Area element factor for each cell, dA = factor * dx * dy\n    # This avoids division by zero for points on the boundary r=1.\n    # The mask_disk ensures we only use points with r1.\n    area_element_factor = np.zeros_like(rr_sq)\n    # Calculate factor only for points inside the disk to avoid warnings\n    inside_disk_indices = rr_sq  1.0\n    area_element_factor[inside_disk_indices] = 4.0 / (1.0 - rr_sq[inside_disk_indices])**2\n    \n    # Cell contribution is K * dA\n    cell_contributions = K * area_element_factor * dx * dy\n    \n    # Sum contributions only from cells whose midpoints are in the triangle\n    total_defect = np.sum(cell_contributions[valid_mask])\n    \n    return total_defect\n\ndef solve():\n    \"\"\"\n    Main function to calculate the angle defect for all specified cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # The logic for each case is encapsulated in a helper function.\n    test_cases_solvers = [\n        _calculate_case_a,\n        _calculate_case_b,\n        _calculate_case_c,\n        _calculate_case_d,\n        _calculate_case_e,\n    ]\n\n    results = []\n    for solver_func in test_cases_solvers:\n        result = solver_func()\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3038073"}]}