{"hands_on_practices": [{"introduction": "在逻辑中，执行代入操作前，我们必须确保它不会意外地改变公式的原意。这个练习将带你回到第一性原理，通过一个典型的例子，练习如何判断一个代入是否“安全”。掌握“对……是自由的”(`free for`)这一核心概念是避免变量捕获的第一步。", "problem": "设 $\\mathcal{L}$ 是一个标准的一阶语言，其个体变量为 $x,y,z,\\dots$，一个一元函数符号 $f(\\cdot)$，一个二元谓词符号 $P(\\cdot,\\cdot)$，以及一个一元谓词符号 $Q(\\cdot)$。考虑公式 $\\varphi \\equiv \\exists y\\,\\big(P(x,y)\\land Q(y)\\big)$ 和项 $t \\equiv f(y)$。使用一阶逻辑中关于自由变量、约束变量、代换和变量捕获的基本定义，来判断项 $t$ 对于变量 $x$ 在公式 $\\varphi$ 中是否是自由的。你的推理必须从以下基本概念出发：\n\n- 项的自由变量：出现在项中的变量。\n- 公式中变量的自由出现和约束出现，以及量词的作用域。\n- 代换 $\\varphi[x:=t]$ 的概念，即用 $t$ 替换 $\\varphi$ 中所有 $x$ 的自由出现的操作。\n- 定义：如果将在 $\\varphi$ 中对 $x$ 进行代换 $\\varphi[x:=t]$ 时，没有在 $t$ 中自由出现的变量因此而变为约束变量，则称项 $t$ 对于变量 $x$ 在公式 $\\varphi$ 中是自由的。等价地，$\\varphi$ 中 $x$ 的任何自由出现都不在某个量词的作用域内，而该量词约束了一个在 $t$ 中自由出现的变量。\n\n通过明确分析量词的作用域、$\\varphi$ 中 $x$ 的自由出现的位置，并识别代换后潜在的变量捕获，来判定 $t$ 对于 $x$ 在 $\\varphi$ 中是否是自由的。\n\n答案规格：\n- 将你的判定结果报告为单个实数：如果 $t$ 对于 $x$ 在 $\\varphi$ 中是自由的，则写 $1$；如果 $t$ 对于 $x$ 在 $\\varphi$ 中不是自由的，则写 $0$。\n- 无需四舍五入。", "solution": "本题要求我们根据一阶逻辑中代换的基本定义，判断项 $t \\equiv f(y)$ 对于变量 $x$ 在公式 $\\varphi \\equiv \\exists y\\,\\big(P(x,y)\\land Q(y)\\big)$ 中是否是自由的。\n\n要使用的核心定义是：如果将项 $t$ 代换 $\\varphi$ 中所有 $x$ 的自由出现时，没有在 $t$ 中自由出现的变量因此变为约束变量，则称项 $t$ 对于变量 $x$ 在公式 $\\varphi$ 中是自由的。检查此条件的一个等价且更直接的方法是，验证对于 $\\varphi$ 中 $x$ 的每一个自由出现，它都不在量词 $\\forall z$ 或 $\\exists z$ 的作用域内，其中 $z$ 是一个在项 $t$ 中自由出现的变量。\n\n我们将通过系统地分析问题的各个组成部分来推进。\n\n1.  **分析项 $t$：**\n    给定的项是 $t \\equiv f(y)$。出现在该项中的变量集合是 $\\{y\\}$。由于项不包含量词，根据定义，出现在项中的任何变量都是自由变量。因此，$t$ 中的自由变量集合，记为 $\\text{FV}(t)$，是 $\\{y\\}$。\n\n2.  **分析公式 $\\varphi$：**\n    给定的公式是 $\\varphi \\equiv \\exists y\\,\\big(P(x,y)\\land Q(y)\\big)$。我们必须识别变量 $x$ 的自由出现以及量词的作用域。\n    -   该公式包含一个量词 $\\exists y$。该量词的作用域是其右侧的子公式，即 $\\big(P(x,y)\\land Q(y)\\big)$。\n    -   在此作用域内，变量 $y$ 出现在 $P(x,y)$ 和 $Q(y)$ 中。这些 $y$ 的出现被量词 $\\exists y$ 所约束。\n    -   变量 $x$ 在公式中出现一次，位于原子公式 $P(x,y)$ 内。$x$ 的这次出现没有被 $\\varphi$ 中的任何量词所约束（因为唯一的量词约束的是 $y$）。因此，$x$ 的这次出现在 $\\varphi$ 中是自由的。\n\n3.  **应用“对于……是自由的”条件：**\n    我们现在应用该定义。我们需要检查 $\\varphi$ 中 $x$ 的任何自由出现是否落入一个量词的作用域内，而该量词约束了存在于 $\\text{FV}(t)$ 中的变量。\n\n    -   **项 $t$ 中的自由变量**：从步骤1中，我们发现 $\\text{FV}(t) = \\{y\\}$。我们唯一需要关注的变量是 $y$。\n    -   **$\\varphi$ 中 $x$ 的自由出现**：从步骤2中，我们发现在子公式 $P(x,y)$ 中有一次 $x$ 的自由出现。\n    -   **量词作用域**：公式 $\\varphi$ 有一个量词 $\\exists y$，其作用域是 $\\big(P(x,y)\\land Q(y)\\big)$。\n\n    现在，我们检查关键条件：$x$ 的自由出现是否位于量词 $\\exists y$ 的作用域内？是的，包含自由 $x$ 的子公式 $P(x,y)$ 位于 $\\exists y$ 的作用域内。\n\n    接下来，这个量词 $\\exists y$ 是否约束了一个在项 $t$ 中自由的变量？该量词约束了变量 $y$。并且，正如我们所确定的，变量 $y$ 在项 $t \\equiv f(y)$ 中确实是自由的。\n\n    由于在 $\\varphi$ 中存在一次 $x$ 的自由出现（在 $P(x,y)$ 中），它位于一个量词（$\\exists y$）的作用域内，而该量词约束了一个在项 $t$ 中自由的变量（$y$），因此 $t$ 对于 $x$ 在 $\\varphi$ 中是自由的这一条件被违反了。\n\n4.  **演示变量捕获：**\n    为了使推理更具体，让我们观察一下如果我们执行代换 $\\varphi[x:=t]$ 会发生什么，这表示用项 $t \\equiv f(y)$ 替换 $\\varphi$ 中 $x$ 的自由出现。\n    原始公式是 $\\varphi \\equiv \\exists y\\,\\big(P(x,y)\\land Q(y)\\big)$。\n    用 $f(y)$ 代换 $x$ 得到新公式：\n    $$ \\exists y\\,\\big(P(f(y),y)\\land Q(y)\\big) $$\n    在这个新公式中，作为项 $f(y)$ 一部分的变量 $y$ 被置于量词 $\\exists y$ 的作用域内。这个在项 $t$ 中本是自由的 $y$ 被“捕获”了，现在被存在量词所约束。这种捕获改变了代换的预期含义。项 $t$ 本意是用来代换 $x$ 的，但它自己的变量 $y$ 的指代却被 $\\varphi$ 中的一个量词所劫持。\n\n    因此，由于发生了这种变量捕গরের，项 $t$ 对于 $x$ 在 $\\varphi$ 中不是自由的。\n\n5.  **结论：**\n    项 $t \\equiv f(y)$ 对于变量 $x$ 在公式 $\\varphi \\equiv \\exists y\\,\\big(P(x,y)\\land Q(y)\\big)$ 中不是自由的。根据题目要求，这对应于数值 $0$。", "answer": "$$\\boxed{0}$$", "id": "3053916"}, {"introduction": "当我们发现一个代入会引起变量捕获时，正确的做法是什么？这个练习将向你展示标准的解决方案：通过重命名（α-变换）量词绑定的变量来消除歧义。你将处理一个需要多次重命名的复杂情况，从而熟练掌握完整的避免捕获代入算法。", "problem": "本问题基于经典一阶逻辑（FOL），其标识包含一个二元函数符号 $f$ 和二元谓词符号 $A$ 和 $B$。考虑项 $t \\equiv f(y,z)$ 和公式 $\\varphi \\equiv \\forall z\\,\\bigl(A(x,z) \\rightarrow \\exists y\\,B(y,x)\\bigr)$。仅使用自由变量和约束变量、$\\alpha$-转换（约束变量的系统性重命名）以及避免捕获的替换的标准形式化定义，在 $\\varphi$ 中执行用 $t$ 替换 $x$ 的操作。提供完整的重命名细节以避免变量捕获，然后执行替换。通过从第一性原理直接分析，验证结果公式的自由变量集合。令 $N$ 表示在正确的避免捕获的替换之后，结果公式中不同自由变量的数量。将 $N$ 作为你的最终答案报告。", "solution": "问题要求我们在一个一阶逻辑中执行避免捕获的替换，并确定结果公式中自由变量的数量。\n\n首先，我们确定问题的给定组成部分。我们正在处理经典一阶逻辑。\n要替换的项是 $t \\equiv f(y,z)$。\n要进行替换的公式是 $\\varphi \\equiv \\forall z\\,\\bigl(A(x,z) \\rightarrow \\exists y\\,B(y,x)\\bigr)$。\n替换操作是将公式 $\\varphi$ 中的变量 $x$ 替换为项 $t$，记作 $\\varphi[t/x]$。\n\n避免捕获的替换 $\\psi[t/x]$ 的标准定义要求，对于项 $t$ 中存在的任何变量 $v$，$\\psi$ 中 $x$ 的任何自由出现都不能位于绑定 $v$ 的量词（即 $\\forall v$ 或 $\\exists v$）的作用域内。如果这种情况（称为“变量捕获”）将会发生，则必须首先通过 $\\alpha$-转换 将 $\\psi$ 中的约束变量 $v$ 重命名为一个新鲜变量。\n\n我们来分析替换 $\\varphi[t/x]$ 中变量捕获的可能性。\n项 $t \\equiv f(y,z)$ 中的变量集合是 $Var(t) = \\{y, z\\}$。\n公式 $\\varphi$ 中的自由变量集合是 $FV(\\varphi)$。变量 $x$ 在 $\\varphi$ 中不受任何量词约束，因此是自由的。变量 $z$ 被 $\\forall z$ 约束，变量 $y$ 被 $\\exists y$ 约束。因此，$FV(\\varphi) = \\{x\\}$。\n\n我们必须检查用 $t$ 替换 $x$ 是否会导致 $Var(t)$ 中的任何变量被 $\\varphi$ 中的量词捕获。\n$1$。变量 $z \\in Var(t)$。公式 $\\varphi$ 的形式为 $\\forall z\\,\\psi_1$，其中 $\\psi_1 \\equiv A(x,z) \\rightarrow \\exists y\\,B(y,x)$。变量 $x$ 在 $\\psi_1$ 中自由出现，而 $\\psi_1$ 在量词 $\\forall z$ 的作用域内。一个朴素的替换会将 $x$ 替换为 $f(y,z)$，导致来自项 $t$ 的 $z$ 被量词 $\\forall z$ 捕获。这是不允许的。\n$2$。变量 $y \\in Var(t)$。子公式 $\\exists y\\,B(y,x)$ 是 $\\varphi$ 的一部分。变量 $x$ 在该子公式中自由出现，而该子公式在量词 $\\exists y$ 的作用域内。一个朴素的替换会将 $x$ 替换为 $f(y,z)$，导致来自项 $t$ 的 $y$ 被量词 $\\exists y$ 捕获。这也是不允许的。\n\n为避免这两种变量捕获的情况，我们必须对 $\\varphi$ 执行 $\\alpha$-转换，以重命名约束变量 $z$ 和 $y$。我们选择新鲜变量 $z'$ 和 $y'$，它们不在 $\\varphi$ 或 $t$ 中自由出现。我们将 $z$ 重命名为 $z'$，将 $y$ 重命名为 $y'$。\n\n首先，我们在 $\\varphi$ 中重命名约束变量 $z$：\n$\\varphi' \\equiv \\forall z'\\,\\bigl((A(x,z) \\rightarrow \\exists y\\,B(y,x))[z'/z]\\bigr)$\n$\\varphi' \\equiv \\forall z'\\,\\bigl(A(x,z') \\rightarrow \\exists y\\,B(y,x)\\bigr)$\n公式 $\\varphi'$ 与 $\\varphi$ 是 $\\alpha$-等价的。\n\n接下来，我们在 $\\varphi'$ 中重命名约束变量 $y$。\n$\\varphi'' \\equiv \\forall z'\\,\\bigl(A(x,z') \\rightarrow (\\exists y\\,B(y,x))[y'/y]\\bigr)$\n$\\varphi'' \\equiv \\forall z'\\,\\bigl(A(x,z') \\rightarrow \\exists y'\\,(B(y,x)[y'/y])\\bigr)$\n$\\varphi'' \\equiv \\forall z'\\,\\bigl(A(x,z') \\rightarrow \\exists y'\\,B(y',x)\\bigr)$\n公式 $\\varphi''$ 与 $\\varphi$ 和 $\\varphi'$ 是 $\\alpha$-等价的。\n\n现在，可以执行替换 $\\varphi''[t/x]$ 而不会发生变量捕获。$\\varphi''$ 中的约束变量集合是 $\\{y', z'\\}$，它与 $Var(t) = \\{y, z\\}$ 不相交。我们将 $\\varphi''$ 中 $x$ 的每次自由出现都替换为 $t \\equiv f(y,z)$。\n$\\varphi_{res} \\equiv \\varphi''[f(y,z)/x] \\equiv \\left(\\forall z'\\,\\bigl(A(x,z') \\rightarrow \\exists y'\\,B(y',x)\\bigr)\\right)[f(y,z)/x]$\n$\\varphi_{res} \\equiv \\forall z'\\,\\bigl(A(x,z')[f(y,z)/x] \\rightarrow (\\exists y'\\,B(y',x))[f(y,z)/x]\\bigr)$\n$\\varphi_{res} \\equiv \\forall z'\\,\\bigl(A(f(y,z),z') \\rightarrow \\exists y'\\,B(y', f(y,z))\\bigr)$\n这就是经过正确的、避免捕获的替换后得到的结果公式。\n\n最后，我们必须通过从第一性原理直接分析来确定结果公式 $\\varphi_{res}$ 的自由变量集合。\n公式为 $\\varphi_{res} \\equiv \\forall z'\\,\\bigl(A(f(y,z),z') \\rightarrow \\exists y'\\,B(y',f(y,z))\\bigr)$。\n全称量化公式 $\\forall v\\,\\psi$ 中的自由变量集合是 $FV(\\psi) \\setminus \\{v\\}$。这里，$v=z'$。\n量词的主体是 $\\psi \\equiv A(f(y,z),z') \\rightarrow \\exists y'\\,B(y',f(y,z))$。\n蕴含式 $\\psi_1 \\rightarrow \\psi_2$ 中的自由变量集合是 $FV(\\psi_1) \\cup FV(\\psi_2)$。\n我们来找出前件 $\\psi_1 \\equiv A(f(y,z),z')$ 的自由变量。\n原子公式的自由变量是其项中的变量。这里的项是 $f(y,z)$ 和 $z'$。\n$Var(f(y,z)) = \\{y,z\\}$。\n$Var(z') = \\{z'\\}$。\n所以，$FV(A(f(y,z),z')) = \\{y, z, z'\\}$。\n\n接下来，我们找出后件 $\\psi_2 \\equiv \\exists y'\\,B(y',f(y,z))$ 的自由变量。\n存在量化公式 $\\exists v\\,\\chi$ 中的自由变量集合是 $FV(\\chi) \\setminus \\{v\\}$。这里，$v=y'$。\n量词的主体是 $\\chi \\equiv B(y',f(y,z))$。\n这个原子公式的自由变量是其项中的变量，即 $y'$ 和 $f(y,z)$。\n$Var(y') = \\{y'\\}$。\n$Var(f(y,z)) = \\{y,z\\}$。\n所以，$FV(B(y',f(y,z))) = \\{y', y, z\\}$。\n那么，$FV(\\exists y'\\,B(y',f(y,z))) = FV(B(y',f(y,z))) \\setminus \\{y'\\} = \\{y', y, z\\} \\setminus \\{y'\\} = \\{y, z\\}$。\n\n现在我们可以找到蕴含式 $\\psi$ 的自由变量：\n$FV(\\psi) = FV(A(f(y,z),z')) \\cup FV(\\exists y'\\,B(y',f(y,z)))$\n$FV(\\psi) = \\{y, z, z'\\} \\cup \\{y, z\\} = \\{y, z, z'\\}$。\n\n最后，我们找到整个公式 $\\varphi_{res}$ 的自由变量：\n$FV(\\varphi_{res}) = FV(\\forall z'\\,\\psi) = FV(\\psi) \\setminus \\{z'\\}$\n$FV(\\varphi_{res}) = \\{y, z, z'\\} \\setminus \\{z'\\} = \\{y, z\\}$。\n结果公式中的自由变量集合是 $\\{y, z\\}$。不同自由变量的数量是该集合的基数。\n因此，$N = |\\{y, z\\}| = 2$。", "answer": "$$ \\boxed{2} $$", "id": "3053962"}, {"introduction": "避免变量捕获的规则为何如此重要？它不仅仅是符号操作的技巧，更关乎逻辑的意义和真理。这个练习将句法（代入）与语义（真值）联系起来，通过将一个具体的数值代入公式并在我们熟悉的自然数结构中求值，你将亲眼见证代入是如何赋予带有自由变量的公式以确定意义的。", "problem": "考虑一阶语言 $\\mathcal{L} = \\{0, s, +, \\times, P\\}$，其中 $0$ 是一个常数符号，$s$ 是一个一元函数符号（意为后继），$+$ 和 $\\times$ 是二元函数符号（意为加法和乘法），而 $P$ 是一个一元谓词符号。设 $\\mathcal{N}$ 是一个以 $\\mathbb{N} = \\{0,1,2,\\dots\\}$ 为定义域的结构，它对这些符号的解释如下：$0^{\\mathcal{N}} = 0$，$s^{\\mathcal{N}}(n) = n+1$，$+^{\\mathcal{N}}$ 和 $\\times^{\\mathcal{N}}$ 是 $\\mathbb{N}$ 上的常规加法和乘法，并且 $P^{\\mathcal{N}}(n)$ 成立当且仅当 $n$ 是通常意义上的素数（即，$n \\geq 2$ 且 $n$ 的正因数仅有 $1$ 和 $n$）。\n\n定义含有一个自由变量 $x$ 的公式：\n$$\n\\varphi(x) \\;:=\\; \\exists y\\;\\Big(\\,\\forall x\\,(x \\times y = y \\times x)\\;\\wedge\\; (x = y + y)\\;\\wedge\\; P(y)\\,\\Big).\n$$\n令封闭项 $t$ 为 $s(s(s(s(s(s(0))))))$。\n\n仅使用自由变量和约束变量、避免捕获的代入以及一阶逻辑的塔斯基语义 (Tarskian semantics) 的核心定义，通过将 $t$ 代入 $\\varphi(x)$ 中所有且仅有的 $x$ 的自由出现，来构造封闭句子 $\\varphi[t/x]$，并确保没有发生变量捕获。然后，在结构 $\\mathcal{N}$ 中确定 $\\varphi[t/x]$ 的真值，该真值被编码为一个实数，其中 $1$ 表示真，$0$ 表示假。你的最终答案必须是这个单一的数字。", "solution": "我们从一阶逻辑的句法和语义的基本定义出发。在一个公式中，如果一个变量的出现不在约束该变量的量词的作用域内，则称其为自由的；否则它是被约束的。将项 $t$ 代入公式 $\\psi$ 中的变量 $x$（记为 $\\psi[t/x]$），是指将 $\\psi$ 中所有 $x$ 的自由出现替换为 $t$，而不改变 $x$ 的约束出现。当 $t$ 中的自由变量在替换后没有变成被约束的时，该代入是避免捕获的；当 $t$ 是一个封闭项时，它没有自由变量，因此不可能被捕获。\n\n步骤1：识别 $\\varphi(x)$ 中 $x$ 的自由出现和约束出现。该公式为\n$$\n\\varphi(x) \\;:=\\; \\exists y\\;\\Big(\\,\\forall x\\,(x \\times y = y \\times x)\\;\\wedge\\; (x = y + y)\\;\\wedge\\; P(y)\\,\\Big).\n$$\n存在两种 $x$ 的出现：\n- 在子公式 $\\forall x\\,(x \\times y = y \\times x)$ 中，变量 $x$ 被量词 $\\forall x$ 约束。\n- 在子公式 $(x = y + y)$ 中，$x$ 是自由的，因为它不在任何约束 $x$ 的量词的作用域内。\n\n因此，$\\varphi$ 中 $x$ 有一个自由出现，即在合取项 $(x = y + y)$ 中。\n\n步骤2：准备代入并避免捕获。封闭项是 $t = s(s(s(s(s(s(0))))))$。由于 $t$ 是封闭的，它没有自由变量，因此 $t$ 中的变量不可能被捕获。尽管如此，为了消除由于 $x$ 同时作为约束变量和自由变量符号的重复使用而可能产生的任何记法歧义，我们对内部的全称量词应用标准的$\\alpha$-转换（约束变量的重命名）。根据 $\\alpha$-等价的定义，重命名约束变量不改变其含义。因此，我们将 $\\varphi(x)$ 等价地重写为\n$$\n\\varphi(x) \\equiv \\exists y\\;\\Big(\\,\\forall z\\,(z \\times y = y \\times z)\\;\\wedge\\; (x = y + y)\\;\\wedge\\; P(y)\\,\\Big),\n$$\n其中 $z$ 是一个不同于 $x$ 和 $y$ 的变量。\n\n步骤3：执行代入。根据代入的定义，我们将 $(x = y + y)$ 中 $x$ 的自由出现替换为 $t$，而不改变约束出现（现在是 $z$）。因此，\n$$\n\\varphi[t/x] \\;=\\; \\exists y\\;\\Big(\\,\\forall z\\,(z \\times y = y \\times z)\\;\\wedge\\; (t = y + y)\\;\\wedge\\; P(y)\\,\\Big).\n$$\n没有发生捕获，因为 $t$ 是封闭的。\n\n步骤4：在 $\\mathcal{N}$ 中解释 $t$。在 $\\mathcal{N}$ 中，$s$ 是后继，$0$ 是 $0$，所以\n$$\nt^{\\mathcal{N}} \\;=\\; s^{\\mathcal{N}}(s^{\\mathcal{N}}(s^{\\mathcal{N}}(s^{\\mathcal{N}}(s^{\\mathcal{N}}(s^{\\mathcal{N}}(0^{\\mathcal{N}})))))) \\;=\\; 6.\n$$\n\n步骤5：通过塔斯基语义在 $\\mathcal{N}$ 中评估 $\\varphi[t/x]$ 的真值。该句子是\n$$\n\\exists y\\;\\Big(\\,\\forall z\\,(z \\times y = y \\times z)\\;\\wedge\\; (6 = y + y)\\;\\wedge\\; P(y)\\,\\Big).\n$$\n我们分析 $\\exists y$ 作用域内的每个合取项：\n- 对于任意固定的 $y \\in \\mathbb{N}$，陈述 $\\forall z\\,(z \\times y = y \\times z)$ 在 $\\mathcal{N}$ 中为真，因为 $\\mathbb{N}$ 上的乘法是可交换的；这是一个标准的算术事实。\n- 方程 $(6 = y + y)$ 断言 $y$ 是一个满足 $2y = 6$ 的数，因此在 $\\mathbb{N}$ 中 $y = 3$。\n- 谓词 $P(y)$断言 $y$ 是素数。数字 $3$ 是通常意义上的素数（其唯一的正因数是 $1$ 和 $3$）。\n\n因此，取 $y = 3$ 满足所有三个合取项：\n$$\n\\forall z\\,(z \\times 3 = 3 \\times z) \\text{ 为真}, \\quad 6 = 3 + 3 \\text{ 为真}, \\quad P(3) \\text{ 为真}。\n$$\n因此，该存在性陈述在 $\\mathcal{N}$ 中为真。\n\n步骤6：将真值进行数值编码。根据题目的要求，我们输出 $1$ 表示真，$0$ 表示假。由于 $\\mathcal{N} \\models \\varphi[t/x]$，编码后的真值为 $1$。\n\n这也展示了对可满足性的影响：开放公式 $\\varphi(x)$ 在 $\\mathcal{N}$ 中被满足，当且仅当 $x$ 等于某个素数 $y$ 的 $y+y$（即，那些是素数两倍的偶数）。将 $x$ 用封闭项 $t$ 实例化，得到封闭句子 $\\varphi[t/x]$，在本例中，它在 $\\mathcal{N}$ 中为真，因为 $t$ 表示 $6 = 2 \\cdot 3$，而 $3$ 是素数。", "answer": "$$\\boxed{1}$$", "id": "3053953"}]}