{"hands_on_practices": [{"introduction": "首个实践练习为我们整个主题奠定了基础。我们将通过一个经典场景：比较两个不同地区的选民投票率。通过计算两个比例之差的95%置信区间，你将学会如何将原始样本数据转化为一个有统计学意义的估计值，该估计值既能体现差异的大小，也包含我们对其的不确定性 [@problem_id:1907971]。", "problem": "一位政治学研究者正在调查两个相邻县（A县和B县）的选民参与情况。为了估计最近一次选举中投票率的差异，该研究者从每个县的官方记录中抽取了登记选民的随机样本。\n\n在A县的$n_A = 650$名登记选民的随机样本中，研究者发现有$x_A = 429$人投票。\n在B县的$n_B = 580$名登记选民的随机样本中，研究者发现有$x_B = 348$人投票。\n\n研究者旨在估计投票率真实比例的差异$p_A - p_B$，其中$p_A$是A县登记选民中投票的真实比例，$p_B$是B县的真实比例。\n\n构建$p_A - p_B$之差的95%置信区间。将你的最终答案表示为一个包含下限和上限的区间。将置信区间的两个界限四舍五入到四位有效数字。", "solution": "我们将真实的投票率比例表示为$p_{A}$和$p_{B}$，其样本估计值表示为$\\hat{p}_{A}$和$\\hat{p}_{B}$。根据样本数据，\n$$\n\\hat{p}_{A}=\\frac{x_{A}}{n_{A}}=\\frac{429}{650}=\\frac{33}{50}=0.66,\\quad \\hat{p}_{B}=\\frac{x_{B}}{n_{B}}=\\frac{348}{580}=\\frac{87}{145}=\\frac{3}{5}=0.6,\n$$\n所以差值的点估计为\n$$\n\\hat{p}_{A}-\\hat{p}_{B}=0.66-0.6=0.06.\n$$\n对于大的独立样本，$p_{A}-p_{B}$的$(1-\\alpha)$置信区间由下式给出\n$$\n(\\hat{p}_{A}-\\hat{p}_{B}) \\pm z_{1-\\alpha/2}\\sqrt{\\frac{\\hat{p}_{A}(1-\\hat{p}_{A})}{n_{A}}+\\frac{\\hat{p}_{B}(1-\\hat{p}_{B})}{n_{B}}}.\n$$\n当$\\alpha=0.05$时，$z_{1-\\alpha/2}=z_{0.975}\\approx 1.96$。精确计算标准误差项：\n$$\n\\hat{p}_{A}(1-\\hat{p}_{A})=\\frac{33}{50}\\cdot\\frac{17}{50}=\\frac{561}{2500},\\quad \\frac{\\hat{p}_{A}(1-\\hat{p}_{A})}{n_{A}}=\\frac{561}{2500\\cdot 650}=\\frac{561}{1,625,000},\n$$\n$$\n\\hat{p}_{B}(1-\\hat{p}_{B})=\\frac{3}{5}\\cdot\\frac{2}{5}=\\frac{6}{25},\\quad \\frac{\\hat{p}_{B}(1-\\hat{p}_{B})}{n_{B}}=\\frac{6}{25\\cdot 580}=\\frac{3}{7250}.\n$$\n因此，方差估计值为\n$$\n\\frac{561}{1,625,000}+\\frac{3}{7250}=\\frac{35,769}{47,125,000},\n$$\n所以标准误差为\n$$\n\\mathrm{SE}=\\sqrt{\\frac{35,769}{47,125,000}}\\approx 0.0275504.\n$$\n误差范围是\n$$\n\\mathrm{ME}=1.96\\times \\mathrm{SE}\\approx 1.96\\times 0.0275504\\approx 0.0539988.\n$$\n因此，$p_{A}-p_{B}$的$95\\%$置信区间为\n$$\n0.06\\pm 0.0539988 \\;\\Rightarrow\\; \\left(0.06-0.0539988,\\;0.06+0.0539988\\right)\\approx \\left(0.0060012,\\;0.1139988\\right).\n$$\n将两个界限四舍五入到四位有效数字，得到\n$$\n\\left(0.006001,\\;0.1140\\right).\n$$", "answer": "$$\\boxed{\\begin{pmatrix}0.006001  0.1140\\end{pmatrix}}$$", "id": "1907971"}, {"introduction": "这个练习将视角从数据分析转向研究规划。在进行A/B测试之前，一个关键问题是：“我们需要多少数据？” 本练习将指导你计算在给定的置信水平下，为达到特定的误差范围所需的最小样本量，这是设计强大而高效研究的一项基本技能 [@problem_id:1907997]。", "problem": "一家软件开发公司正在进行一项A/B测试，以比较其移动应用程序主要行动召唤按钮的两种新用户界面（UI）设计的用户参与度。设 $p_1$ 为使用设计A时点击按钮的用户的真实比例，$p_2$ 为使用设计B时点击按钮的用户的真实比例。该公司希望估计这些比例之间的差异 $p_1 - p_2$。他们计划使用两个独立且大小相等的随机用户样本进行此项测试。\n\n在98%的置信水平下，要将差异 $p_1 - p_2$ 的估计误差范围控制在最大0.03，则每个UI设计组所需的最小整数样本量 $n$ 是多少？由于这是一项初步研究，您应该对未知的比例 $p_1$ 和 $p_2$ 作出最保守的假设。", "solution": "我们想为两个独立比例的差异（每组样本量相等）求一个双侧置信区间。设 $\\hat{p}_{1}$ 和 $\\hat{p}_{2}$ 为样本比例，两组的样本大小均为 $n$。$p_{1}-p_{2}$ 的标准Wald $(1-\\alpha)$ 置信区间为\n$$\n(\\hat{p}_{1}-\\hat{p}_{2}) \\pm z_{1-\\alpha/2}\\,\\sqrt{\\frac{\\hat{p}_{1}(1-\\hat{p}_{1})}{n}+\\frac{\\hat{p}_{2}(1-\\hat{p}_{2})}{n}}.\n$$\n因此，误差范围为\n$$\n\\text{ME}=z_{1-\\alpha/2}\\,\\sqrt{\\frac{\\hat{p}_{1}(1-\\hat{p}_{1})}{n}+\\frac{\\hat{p}_{2}(1-\\hat{p}_{2})}{n}}.\n$$\n对于一项初步且保守的设计，我们通过设 $\\hat{p}_{1}=\\hat{p}_{2}=\\frac{1}{2}$ 来最大化方差项，因为当 $p=\\frac{1}{2}$ 时，$p(1-p)$ 取得最大值 $\\frac{1}{4}$。因此\n$$\n\\text{SE}_{\\max}=\\sqrt{\\frac{\\frac{1}{4}}{n}+\\frac{\\frac{1}{4}}{n}}=\\sqrt{\\frac{1}{2n}}.\n$$\n在置信水平为 $0.98$（因此 $\\alpha=0.02$ 且 $z_{1-\\alpha/2}=z_{0.99}$）下，施加所需的误差范围要求 $\\text{ME}\\leq 0.03$ 给出\n$$\nz_{0.99}\\,\\sqrt{\\frac{1}{2n}} \\leq 0.03.\n$$\n对 $n$ 求解，\n$$\n\\sqrt{\\frac{1}{2n}} \\leq \\frac{0.03}{z_{0.99}}\n\\quad\\Longrightarrow\\quad\n\\frac{1}{2n} \\leq \\left(\\frac{0.03}{z_{0.99}}\\right)^{2}\n\\quad\\Longrightarrow\\quad\nn \\geq \\frac{z_{0.99}^{2}}{2\\cdot 0.03^{2}}.\n$$\n使用 $z_{0.99}\\approx 2.3263$，我们得到\n$$\nn \\geq \\frac{(2.3263)^{2}}{2\\cdot (0.03)^{2}}\n= \\frac{5.411671}{0.0018}\n\\approx 3006.48.\n$$\n因此，每组的最小整数样本量为\n$$\nn=\\lceil 3006.48\\rceil=3007.\n$$", "answer": "$$\\boxed{3007}$$", "id": "1907997"}, {"introduction": "最后的这个练习探讨了实验设计中一个更高级也更实际的问题：资源优化。当你的总预算或样本量固定时，如何将其在两个组之间进行分配以获得最精确的结果？这个问题挑战了平分样本量的常见做法，并向你展示了如何确定最佳分配比例，以最小化置信区间的宽度 [@problem_id:1907982]。", "problem": "一个数据科学家团队正在比较两种专有机器学习（ML）分类算法的性能，我们称之为算法A和算法B。目标是估计它们真实准确率之间的差异 $p_A - p_B$，其中 $p_A$ 和 $p_B$ 分别表示算法A和算法B对从特定总体中随机选择的数据点进行正确分类的真实概率。\n\n该团队有固定的预算，允许使用总共 $N$ 个数据点进行测试。这 $N$ 个点必须划分为两个不相交的集合：一个大小为 $n_A$ 用于测试算法A，另一个大小为 $n_B$ 用于测试算法B，使得 $n_A + n_B = N$。团队的目标是选择样本量 $n_A$ 和 $n_B$ 的分配方式，以最小化 $p_A - p_B$ 差异的大样本置信区间的宽度。\n\n为了规划目的，该团队依赖于先前的初步研究，这些研究为准确率提供了估计值：算法A为 $\\tilde{p}_A$，算法B为 $\\tilde{p}_B$。一个标准的 $p_A - p_B$ 的大样本 $100(1-\\alpha)\\%$ 置信区间的宽度由 $W = 2z_{\\alpha/2}\\sqrt{\\frac{p_A(1-p_A)}{n_A} + \\frac{p_B(1-p_B)}{n_B}}$ 给出。为了实验设计的目的，此公式中未知的真实比例 $p_A$ 和 $p_B$ 被它们的先验估计值 $\\tilde{p}_A$ 和 $\\tilde{p}_B$ 所替代。\n\n假设 $N$ 足够大，使得 $n_A$ 和 $n_B$ 的最优选择为非零值，确定能够最小化置信区间宽度的最优分配比 $\\frac{n_A}{n_B}$。请用 $\\tilde{p}_A$ 和 $\\tilde{p}_B$ 的符号表达式来表示你的答案。", "solution": "目标是找到样本量 $n_A$ 和 $n_B$ 的分配，以最小化两个比例之差 $p_A - p_B$ 的置信区间宽度，并满足约束条件 $n_A + n_B = N$。\n\n置信区间的宽度 $W$ 是已知的。为了规划目的，我们使用先验估计值 $\\tilde{p}_A$ 和 $\\tilde{p}_B$ 来代替真实的比例 $p_A$ 和 $p_B$。宽度的表达式变为：\n$$ W(n_A, n_B) = 2z_{\\alpha/2}\\sqrt{\\frac{\\tilde{p}_A(1-\\tilde{p}_A)}{n_A} + \\frac{\\tilde{p}_B(1-\\tilde{p}_B)}{n_B}} $$\n最小化 $W$ 等价于最小化其平方 $W^2$，因为宽度总是非负的。由于 $z_{\\alpha/2}$ 是一个正常数，这也等价于最小化平方根下的项。我们将要最小化的函数定义为：\n$$ f(n_A, n_B) = \\frac{\\tilde{p}_A(1-\\tilde{p}_A)}{n_A} + \\frac{\\tilde{p}_B(1-\\tilde{p}_B)}{n_B} $$\n为了简化符号，我们将方差估计值记为 $\\sigma_A^2 = \\tilde{p}_A(1-\\tilde{p}_A)$ 和 $\\sigma_B^2 = \\tilde{p}_B(1-\\tilde{p}_B)$。需要最小化的函数是：\n$$ f(n_A, n_B) = \\frac{\\sigma_A^2}{n_A} + \\frac{\\sigma_B^2}{n_B} $$\n我们有约束条件 $n_A + n_B = N$，可以写成 $n_B = N - n_A$。我们可以将其代入函数 $f$，以用单个变量 $n_A$ 来表示它。\n$$ g(n_A) = f(n_A, N - n_A) = \\frac{\\sigma_A^2}{n_A} + \\frac{\\sigma_B^2}{N - n_A} $$\n为了找到使该函数最小化的 $n_A$ 值，我们对 $g(n_A)$ 关于 $n_A$ 求导，并令其为零。\n$$ \\frac{dg}{dn_A} = \\frac{d}{dn_A} \\left( \\frac{\\sigma_A^2}{n_A} + \\frac{\\sigma_B^2}{N - n_A} \\right) $$\n$$ \\frac{dg}{dn_A} = -\\frac{\\sigma_A^2}{n_A^2} - \\frac{\\sigma_B^2}{(N - n_A)^2} \\cdot (-1) = -\\frac{\\sigma_A^2}{n_A^2} + \\frac{\\sigma_B^2}{(N - n_A)^2} $$\n将导数设为零以找到临界点：\n$$ -\\frac{\\sigma_A^2}{n_A^2} + \\frac{\\sigma_B^2}{(N - n_A)^2} = 0 $$\n$$ \\frac{\\sigma_B^2}{(N - n_A)^2} = \\frac{\\sigma_A^2}{n_A^2} $$\n由于样本量和方差均为正，我们可以对两边取正平方根：\n$$ \\frac{\\sigma_B}{N - n_A} = \\frac{\\sigma_A}{n_A} $$\n现在，我们用 $N$、$\\sigma_A$ 和 $\\sigma_B$ 来求解 $n_A$。\n$$ n_A \\sigma_B = (N - n_A) \\sigma_A $$\n$$ n_A \\sigma_B = N \\sigma_A - n_A \\sigma_A $$\n$$ n_A \\sigma_A + n_A \\sigma_B = N \\sigma_A $$\n$$ n_A (\\sigma_A + \\sigma_B) = N \\sigma_A $$\n$$ n_A = N \\frac{\\sigma_A}{\\sigma_A + \\sigma_B} $$\n为了检验这是否对应于一个最小值，我们可以考察 $g(n_A)$ 的二阶导数：\n$$ \\frac{d^2g}{dn_A^2} = \\frac{d}{dn_A} \\left( -\\sigma_A^2 n_A^{-2} + \\sigma_B^2 (N - n_A)^{-2} \\right) = 2\\sigma_A^2 n_A^{-3} + 2\\sigma_B^2 (N - n_A)^{-3} = \\frac{2\\sigma_A^2}{n_A^3} + \\frac{2\\sigma_B^2}{(N-n_A)^3} $$\n由于 $n_A  0$，$n_B = N - n_A  0$，且方差估计值 $\\sigma_A^2, \\sigma_B^2$ 是非负的，所以二阶导数恒为正。这证实了我们的临界点对应一个最小值。\n\n现在我们求出 $n_B$ 相应的最优值：\n$$ n_B = N - n_A = N - N \\frac{\\sigma_A}{\\sigma_A + \\sigma_B} = N \\left( 1 - \\frac{\\sigma_A}{\\sigma_A + \\sigma_B} \\right) = N \\left( \\frac{\\sigma_A + \\sigma_B - \\sigma_A}{\\sigma_A + \\sigma_B} \\right) $$\n$$ n_B = N \\frac{\\sigma_B}{\\sigma_A + \\sigma_B} $$\n问题要求的是最优比率 $\\frac{n_A}{n_B}$。\n$$ \\frac{n_A}{n_B} = \\frac{N \\frac{\\sigma_A}{\\sigma_A + \\sigma_B}}{N \\frac{\\sigma_B}{\\sigma_A + \\sigma_B}} = \\frac{\\sigma_A}{\\sigma_B} $$\n最后，我们将 $\\sigma_A$ 和 $\\sigma_B$ 的原始表达式代回：\n$$ \\frac{n_A}{n_B} = \\frac{\\sqrt{\\tilde{p}_A(1-\\tilde{p}_A)}}{\\sqrt{\\tilde{p}_B(1-\\tilde{p}_B)}} $$\n这可以写成一个单一的平方根形式：\n$$ \\frac{n_A}{n_B} = \\sqrt{\\frac{\\tilde{p}_A(1-\\tilde{p}_A)}{\\tilde{p}_B(1-\\tilde{p}_B)}} $$\n这个结果表明，为了最小化置信区间宽度，总样本量 $N$ 应按照各自伯努利分布的标准差成比例地进行分配。", "answer": "$$ \\boxed{\\sqrt{\\frac{\\tilde{p}_A(1-\\tilde{p}_A)}{\\tilde{p}_B(1-\\tilde{p}_B)}}} $$", "id": "1907982"}]}