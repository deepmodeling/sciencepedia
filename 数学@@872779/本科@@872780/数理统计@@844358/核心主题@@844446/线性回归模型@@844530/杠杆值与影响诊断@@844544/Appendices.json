{"hands_on_practices": [{"introduction": "在回归分析中，杠杆值是衡量单个数据点对模型拟合值影响潜力的关键指标。这个基础练习将指导你从头开始，通过一个简单的三点数据集，亲手计算每个数据点的杠杆值。通过这个过程，你将掌握杠杆值计算的核心机制 [@problem_id:1930389]，并直观地理解预测变量的取值如何决定其潜在影响力。", "problem": "在线性回归的研究中，诊断工具对于识别强影响数据点至关重要。统计杠杆值就是这样一种工具。考虑一个形式为 $Y_i = \\beta_0 + \\beta_1 x_i + \\epsilon_i$ 的简单线性回归模型，其中 $\\beta_0$ 和 $\\beta_1$ 分别是截距和斜率参数，$\\epsilon_i$ 是独立的误差项。\n\n一个实验设计了三个观测值，对应的预测变量值为 $x_1 = -2$，$x_2 = 1$ 和 $x_3 = 4$。响应值 $y_i$ 未提供。第 $i$ 个数据点的杠杆值定义为帽子矩阵 $H$ 的第 $i$ 个对角线元素 $h_{ii}$。帽子矩阵由表达式 $H = X(X^T X)^{-1} X^T$ 定义，其中 $X$ 是模型的设计矩阵。对于该模型，设计矩阵 $X$ 是一个 $3 \\times 2$ 矩阵，其第一列全为1，第二列包含预测变量值 $x_i$。\n\n计算这三个给定数据点的杠杆值 $h_{11}$，$h_{22}$ 和 $h_{33}$。将您的答案表示为一个行向量，按顺序包含这三个值，并使用它们的精确分数形式。", "solution": "在带有截距的简单线性回归中，设计矩阵的行向量为 $x_{i}^{T} = \\begin{pmatrix} 1  x_{i} \\end{pmatrix}$。对于给定的 $x$ 值，设计矩阵为\n$$\nX = \\begin{pmatrix}\n1  -2 \\\\\n1  1 \\\\\n1  4\n\\end{pmatrix}.\n$$\n帽子矩阵为 $H = X(X^{T}X)^{-1}X^{T}$，杠杆值为对角线元素 $h_{ii} = x_{i}^{T}(X^{T}X)^{-1}x_{i}$。\n\n首先计算 $X^{T}X$：\n$$\nX^{T}X = \\begin{pmatrix}\n\\sum_{i=1}^{3} 1  \\sum_{i=1}^{3} x_{i} \\\\\n\\sum_{i=1}^{3} x_{i}  \\sum_{i=1}^{3} x_{i}^{2}\n\\end{pmatrix}\n= \\begin{pmatrix}\n3  (-2)+1+4 \\\\\n(-2)+1+4  (-2)^{2}+1^{2}+4^{2}\n\\end{pmatrix}\n= \\begin{pmatrix}\n3  3 \\\\\n3  21\n\\end{pmatrix}.\n$$\n一个 $2 \\times 2$ 矩阵 $\\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix}$ 的逆矩阵是 $\\frac{1}{ad-bc}\\begin{pmatrix} d  -b \\\\ -c  a \\end{pmatrix}$。因此\n$$\n(X^{T}X)^{-1} = \\frac{1}{3\\cdot 21 - 3\\cdot 3}\\begin{pmatrix} 21  -3 \\\\ -3  3 \\end{pmatrix}\n= \\frac{1}{54}\\begin{pmatrix} 21  -3 \\\\ -3  3 \\end{pmatrix}.\n$$\n现在为每个 $i$ 计算 $h_{ii} = x_{i}^{T}(X^{T}X)^{-1}x_{i}$。\n\n对于 $i=1$，有 $x_{1}=-2$，令 $v_{1}=\\begin{pmatrix} 1 \\\\ -2 \\end{pmatrix}$。则\n$$\n(X^{T}X)^{-1}v_{1} = \\frac{1}{54}\\begin{pmatrix} 21  -3 \\\\ -3  3 \\end{pmatrix}\\begin{pmatrix} 1 \\\\ -2 \\end{pmatrix}\n= \\frac{1}{54}\\begin{pmatrix} 21 + 6 \\\\ -3 - 6 \\end{pmatrix}\n= \\begin{pmatrix} \\frac{1}{2} \\\\ -\\frac{1}{6} \\end{pmatrix},\n$$\n所以\n$$\nh_{11} = v_{1}^{T}(X^{T}X)^{-1}v_{1} = \\begin{pmatrix} 1  -2 \\end{pmatrix}\\begin{pmatrix} \\frac{1}{2} \\\\ -\\frac{1}{6} \\end{pmatrix}\n= \\frac{1}{2} + \\frac{1}{3} = \\frac{5}{6}.\n$$\n\n对于 $i=2$，有 $x_{2}=1$，令 $v_{2}=\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。则\n$$\n(X^{T}X)^{-1}v_{2} = \\frac{1}{54}\\begin{pmatrix} 21  -3 \\\\ -3  3 \\end{pmatrix}\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}\n= \\frac{1}{54}\\begin{pmatrix} 18 \\\\ 0 \\end{pmatrix}\n= \\begin{pmatrix} \\frac{1}{3} \\\\ 0 \\end{pmatrix},\n$$\n所以\n$$\nh_{22} = v_{2}^{T}(X^{T}X)^{-1}v_{2} = \\begin{pmatrix} 1  1 \\end{pmatrix}\\begin{pmatrix} \\frac{1}{3} \\\\ 0 \\end{pmatrix}\n= \\frac{1}{3}.\n$$\n\n对于 $i=3$，有 $x_{3}=4$，令 $v_{3}=\\begin{pmatrix} 1 \\\\ 4 \\end{pmatrix}$。则\n$$\n(X^{T}X)^{-1}v_{3} = \\frac{1}{54}\\begin{pmatrix} 21  -3 \\\\ -3  3 \\end{pmatrix}\\begin{pmatrix} 1 \\\\ 4 \\end{pmatrix}\n= \\frac{1}{54}\\begin{pmatrix} 9 \\\\ 9 \\end{pmatrix}\n= \\begin{pmatrix} \\frac{1}{6} \\\\ \\frac{1}{6} \\end{pmatrix},\n$$\n所以\n$$\nh_{33} = v_{3}^{T}(X^{T}X)^{-1}v_{3} = \\begin{pmatrix} 1  4 \\end{pmatrix}\\begin{pmatrix} \\frac{1}{6} \\\\ \\frac{1}{6} \\end{pmatrix}\n= \\frac{1}{6} + \\frac{4}{6} = \\frac{5}{6}.\n$$\n\n作为检验，杠杆值之和等于 $H$ 的迹，即模型的秩 $p=2$，而确实 $\\frac{5}{6}+\\frac{1}{3}+\\frac{5}{6}=\\frac{12}{6}=2$。\n\n因此，按顺序排列的杠杆值为 $\\frac{5}{6}, \\frac{1}{3}, \\frac{5}{6}$。", "answer": "$$\\boxed{\\begin{pmatrix}\\frac{5}{6}  \\frac{1}{3}  \\frac{5}{6}\\end{pmatrix}}$$", "id": "1930389"}, {"introduction": "杠杆值的概念不仅限于具有连续预测变量的回归模型。本练习将其应用扩展到方差分析（ANOVA）的背景下，揭示实验设计（如组别样本量）如何决定杠杆值。你会发现，在这种情况下，杠杆值反映了数据结构本身的属性 [@problem_id:1930391]，这有助于加深你对模型设计矩阵 $X$ 普适性的理解。", "problem": "在统计建模中，杠杆值（leverage）的概念用于识别对回归模型的拟合值有很大影响的观测值。考虑一个比较两个独立组均值的单因素方差分析（ANOVA）模型。第一组有 $n_1$ 个观测值，第二组有 $n_2$ 个观测值。观测值 $y_{ij}$ 的模型由 $y_{ij} = \\mu_i + \\epsilon_{ij}$ 给出，其中 $i \\in \\{1, 2\\}$ 表示组别，$j \\in \\{1, \\dots, n_i\\}$ 是组内的观测索引，$\\mu_i$ 是第 $i$ 组的真实均值，$\\epsilon_{ij}$ 是均值为零的独立同分布随机误差。\n\n这个方差分析模型可以表示为 $Y = X\\beta + \\epsilon$ 形式的一般线性模型。在这个框架下，拟合值由 $\\hat{Y} = HY$ 给出，其中矩阵 $H = X(X'X)^{-1}X'$ 被称为帽子矩阵。整个数据集中第 $k$ 个观测值的杠杆值定义为该帽子矩阵的第 $k$ 个对角元素 $h_{kk}$。\n\n确定属于第一组的任何单个观测值的杠杆值的解析表达式。用 $n_1$ 和/或 $n_2$ 表示你的答案。", "solution": "我们将单因素两组方差分析以单元格均值形式写成一个一般线性模型：\n$$\nY = X\\beta + \\epsilon,\\quad \\beta = \\begin{pmatrix}\\mu_{1}\\\\ \\mu_{2}\\end{pmatrix},\n$$\n其中 $X$ 是一个 $(n_{1}+n_{2}) \\times 2$ 的设计矩阵，其前 $n_{1}$ 行等于 $(1,0)$（第1组），后 $n_{2}$ 行等于 $(0,1)$（第2组）。帽子矩阵是\n$$\nH = X\\left(X^{\\prime}X\\right)^{-1}X^{\\prime}.\n$$\n观测值 $k$ 的杠杆值是第 $k$ 个对角元素 $h_{kk}$，可以写成\n$$\nh_{kk} = x_{k}\\left(X^{\\prime}X\\right)^{-1}x_{k}^{\\prime},\n$$\n其中 $x_{k}$ 是 $X$ 的第 $k$ 行。对于单元格均值设计，\n$$\nX^{\\prime}X = \\begin{pmatrix} n_{1}  0 \\\\ 0  n_{2} \\end{pmatrix},\\quad \\left(X^{\\prime}X\\right)^{-1} = \\begin{pmatrix} \\frac{1}{n_{1}}  0 \\\\ 0  \\frac{1}{n_{2}} \\end{pmatrix}.\n$$\n对于第一组中的任何观测值，其对应的行是 $x_{k} = \\begin{pmatrix}1  0\\end{pmatrix}$。因此，\n$$\nh_{kk} = \\begin{pmatrix}1  0\\end{pmatrix}\n\\begin{pmatrix} \\frac{1}{n_{1}}  0 \\\\ 0  \\frac{1}{n_{2}} \\end{pmatrix}\n\\begin{pmatrix}1 \\\\ 0\\end{pmatrix}\n= \\begin{pmatrix}1  0\\end{pmatrix}\n\\begin{pmatrix} \\frac{1}{n_{1}} \\\\ 0 \\end{pmatrix}\n= \\frac{1}{n_{1}}.\n$$\n因此，第1组中每个观测值的杠杆值都等于 $\\frac{1}{n_{1}}$。", "answer": "$$\\boxed{\\frac{1}{n_{1}}}$$", "id": "1930391"}, {"introduction": "一个高杠杆点不一定就是“坏”点；其真实影响取决于它是否与数据的整体趋势一致。这个练习通过一个精心设计的思想实验，让你对比两个高杠杆点带来的不同后果。通过计算和比较斜率估计的标准误，你将定量地识别出能提高模型精度的“好”杠杆点和引入偏差的“坏”杠杆点 [@problem_id:1930386]，从而掌握影响诊断的精髓。", "problem": "在回归分析中，预测变量值远超其均值的数据点被称为高杠杆点。此类点可能对估计的回归模型产生不成比例的影响。它们的影响可能是有益的，即提高系数估计的精度；也可能是有害的，即引入显著的偏差。\n\n一位研究人员正在研究一种新材料的工作温度（$T$，单位任意）与电阻（$R$，单位任意）之间的关系。提出了一个形式为 $R = \\beta_0 + \\beta_1 T + \\epsilon$ 的简单线性模型。在标准操作条件下，收集了最初的一组四个测量值，我们称之为基础数据集 $D_0$：\n$$ D_0 = \\{ (1, 2.1), (2, 2.9), (3, 4.2), (4, 4.8) \\} $$\n\n为了探究该材料在更高温度下的性质，进行了两次额外的独立实验，每次实验产生一个高杠杆数据点：\n- A点：$(10, 11.1)$\n- B点：$(10, 5.0)$\n\n你的任务是分析这两个高杠杆点的影响。请考虑两个独立的数据集：\n1.  $D_A$，由基础数据集 $D_0$ 添加A点形成。\n2.  $D_B$，由基础数据集 $D_0$ 添加B点形成。\n\n对每个数据集（$D_A$ 和 $D_B$），拟合一个简单线性回归模型。令 $se(\\hat{\\beta}_{1,A})$ 为拟合数据集 $D_A$ 的模型估计的斜率系数的标准误，令 $se(\\hat{\\beta}_{1,B})$ 为拟合数据集 $D_B$ 的模型的标准误。\n\n计算比率 $R = \\frac{se(\\hat{\\beta}_{1,A})}{se(\\hat{\\beta}_{1,B})}$。将您的最终答案四舍五入到三位有效数字。", "solution": "我们用 $R=\\beta_{0}+\\beta_{1}T+\\epsilon$ 来建立 $R$ 对 $T$ 的模型。对于带截距的简单线性回归，对于数据集 $\\{(x_{i},y_{i})\\}_{i=1}^{n}$，定义中心化和为\n$$\nS_{xx}=\\sum_{i=1}^{n}(x_{i}-\\bar{x})^{2},\\quad S_{yy}=\\sum_{i=1}^{n}(y_{i}-\\bar{y})^{2},\\quad S_{xy}=\\sum_{i=1}^{n}(x_{i}-\\bar{x})(y_{i}-\\bar{y}),\n$$\n其中 $\\bar{x}=(\\sum x_{i})/n$ 且 $\\bar{y}=(\\sum y_{i})/n$。残差平方和为\n$$\n\\mathrm{SSE}=S_{yy}-\\frac{S_{xy}^{2}}{S_{xx}},\n$$\n斜率的标准误为\n$$\nse(\\hat{\\beta}_{1})=\\sqrt{\\frac{\\hat{\\sigma}^{2}}{S_{xx}}}=\\sqrt{\\frac{\\mathrm{SSE}/(n-2)}{S_{xx}}}.\n$$\n因此，对于具有相同 $n$ 和 $S_{xx}$ 的两个数据集，斜率标准误的比率简化为\n$$\nR=\\frac{se(\\hat{\\beta}_{1,A})}{se(\\hat{\\beta}_{1,B})}=\\sqrt{\\frac{\\mathrm{SSE}_{A}}{\\mathrm{SSE}_{B}}}.\n$$\n\n计算 $D_{0}=\\{(1,2.1),(2,2.9),(3,4.2),(4,4.8)\\}$ 的基础和：\n$$\n\\sum x=10,\\ \\sum y=14.0,\\ \\sum x^{2}=30,\\ \\sum y^{2}=53.5,\\ \\sum xy=39.7, \n$$\n$$\n\\bar{x}_{0}=2.5,\\ \\bar{y}_{0}=3.5,\\ S_{xx,0}=5,\\ S_{yy,0}=4.5,\\ S_{xy,0}=4.7.\n$$\n\n数据集 $D_{A}$ 添加了 $(10,11.1)$，因此 $n_{A}=5$ 且\n$$\n\\sum x=20,\\ \\sum y=25.1,\\ \\sum x^{2}=130,\\ \\sum y^{2}=176.71,\\ \\sum xy=150.7,\n$$\n$$\n\\bar{x}_{A}=4,\\ \\bar{y}_{A}=5.02.\n$$\n因此，\n$$\nS_{xx,A}=130-5\\cdot 4^{2}=50,\\quad S_{yy,A}=176.71-5\\cdot(5.02)^{2}=50.708,\n$$\n$$\nS_{xy,A}=150.7-5\\cdot 4\\cdot 5.02=50.3.\n$$\n于是\n$$\n\\mathrm{SSE}_{A}=S_{yy,A}-\\frac{S_{xy,A}^{2}}{S_{xx,A}}=50.708-\\frac{(50.3)^{2}}{50}=50.708-50.6018=0.1062.\n$$\n\n数据集 $D_{B}$ 添加了 $(10,5.0)$，因此 $n_{B}=5$ 且\n$$\n\\sum x=20,\\ \\sum y=19,\\ \\sum x^{2}=130,\\ \\sum y^{2}=78.5,\\ \\sum xy=89.7,\n$$\n$$\n\\bar{x}_{B}=4,\\ \\bar{y}_{B}=3.8.\n$$\n因此，\n$$\nS_{xx,B}=130-5\\cdot 4^{2}=50,\\quad S_{yy,B}=78.5-5\\cdot(3.8)^{2}=6.3,\n$$\n$$\nS_{xy,B}=89.7-5\\cdot 4\\cdot 3.8=13.7.\n$$\n于是\n$$\n\\mathrm{SSE}_{B}=S_{yy,B}-\\frac{S_{xy,B}^{2}}{S_{xx,B}}=6.3-\\frac{(13.7)^{2}}{50}=6.3-3.7538=2.5462.\n$$\n\n在 $S_{xx,A}=S_{xx,B}$ 和 $n_{A}=n_{B}$ 的情况下，标准误的比率为\n$$\nR=\\sqrt{\\frac{\\mathrm{SSE}_{A}}{\\mathrm{SSE}_{B}}}=\\sqrt{\\frac{0.1062}{2.5462}}\\approx 0.204228\\ldots\n$$\n四舍五入到三位有效数字， $R=0.204$。", "answer": "$$\\boxed{0.204}$$", "id": "1930386"}]}