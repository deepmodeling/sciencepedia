{"hands_on_practices": [{"introduction": "全期望定律的核心思想在于“分而治之”。这个练习 [@problem_id:1928925] 为我们提供了一个经典的两阶段实验场景，让我们能够直观地应用这一定律。通过首先对一个随机选择的事件（即选择了哪个箱子）进行条件化，我们可以将一个复杂的混合抽样问题分解为几个简单的、条件明确的超几何分布期望问题，最后再将这些条件期望加权平均，从而得到最终的全局期望。", "problem": "一家科技公司的质量控制部门将来自三个不同供应商的电子元件存放在三个独立的大箱子中。每个箱子中元件的构成如下：\n\n- 箱1包含50个次品和50个正品。\n- 箱2包含30个次品和90个正品。\n- 箱3包含80个次品和20个正品。\n\n一名检验员遵循一个两阶段抽样程序。首先，检验员随机选择三个箱子中的一个，每个箱子被选中的概率相等。其次，检验员从选中的箱子中不放回地抽取40个元件进行测试。\n\n计算检验员样本中次品的期望数量。将你的最终答案四舍五入到三位有效数字。", "solution": "设 $B \\in \\{1,2,3\\}$ 表示均匀随机选择的箱子，因此对每个 $i$ 有 $P(B=i)=\\frac{1}{3}$。设 $X$ 为大小为 $n=40$ 的样本中的次品数量。在选定箱子 $i$ 的条件下，样本遵循超几何分布模型，其总体大小为 $N_{i}$，次品数量为 $D_{i}$。根据超几何分布的一个标准性质（或通过使用指示变量的期望线性性质），可得\n$$\n\\mathbb{E}[X \\mid B=i]=n \\cdot \\frac{D_{i}}{N_{i}}.\n$$\n根据全期望定律，\n$$\n\\mathbb{E}[X]=\\sum_{i=1}^{3} P(B=i)\\,\\mathbb{E}[X \\mid B=i]=\\frac{1}{3}\\sum_{i=1}^{3} n \\cdot \\frac{D_{i}}{N_{i}}=\\frac{n}{3}\\left(\\frac{D_{1}}{N_{1}}+\\frac{D_{2}}{N_{2}}+\\frac{D_{3}}{N_{3}}\\right).\n$$\n根据题目数据，$(N_{1},D_{1})=(100,50)$，$(N_{2},D_{2})=(120,30)$，以及 $(N_{3},D_{3})=(100,80)$，且 $n=40$。代入得，\n$$\n\\mathbb{E}[X]=\\frac{40}{3}\\left(\\frac{50}{100}+\\frac{30}{120}+\\frac{80}{100}\\right)=\\frac{40}{3}\\left(\\frac{1}{2}+\\frac{1}{4}+\\frac{4}{5}\\right).\n$$\n计算括号内的和：\n$$\n\\frac{1}{2}+\\frac{1}{4}+\\frac{4}{5}=\\frac{10+5+16}{20}=\\frac{31}{20}.\n$$\n因此，\n$$\n\\mathbb{E}[X]=\\frac{40}{3}\\cdot \\frac{31}{20}=\\frac{2}{3}\\cdot 31=\\frac{62}{3}\\approx 20.666\\ldots\n$$\n四舍五入到三位有效数字得到 $20.7$。", "answer": "$$\\boxed{20.7}$$", "id": "1928925"}, {"introduction": "在许多现实世界的过程中，我们关心的结果取决于一个不确定的、但一旦发生就固定的“状态”。这个关于软件调试的练习 [@problem_id:1400529] 完美地诠释了这一点，其中总的调试时间取决于错误所在的具体函数位置。此练习展示了如何将全期望定律与期望的线性性质相结合，通过对错误位置 $K$ 进行条件化，我们可以优雅地计算出一个随机过程的总期望时间，即使过程中的每一步所花费的时间本身也是一个随机变量。", "problem": "一家软件公司正在调试一个由 $N$ 个不同函数组成的大型计算模块，这些函数的索引从 $1$ 到 $N$。可以肯定的是，一个关键的错误（bug）恰好位于这些函数中的一个。\n\n错误存在于函数 $i$ 中的概率与其复杂度成正比，该复杂度由一个正常数 $c_i$ 给出。调试团队采用一种顺序测试策略，他们按照函数的索引顺序进行测试，从函数1开始，然后是函数2，依此类推，直到找到错误为止。在测试了包含错误的函数之后，该过程立即停止。\n\n测试函数 $i$ 所需的时间，用随机变量 $S_i$ 表示，服从速率参数为已知的 $\\lambda_i > 0$ 的指数分布。所有函数的测试时间是相互独立的，并且它们也与错误的位置无关。\n\n推导找到错误所需的总时间的期望值 $E[T]$ 的符号表达式。您的最终表达式应以 $N$ 以及参数集 $\\{c_i\\}_{i=1}^N$ 和 $\\{\\lambda_i\\}_{i=1}^N$ 的形式给出。", "solution": "设 $K$ 表示包含错误的函数的（随机）索引。由于错误位于函数 $i$ 中的概率与 $c_i$ 成正比，总权重为 $C \\equiv \\sum_{k=1}^{N} c_{k}$，因此\n$$\n\\mathbb{P}(K=i)=\\frac{c_{i}}{C}, \\quad i=1,\\ldots,N.\n$$\n找到错误的总时间是直到并包括包含错误的那个函数为止的测试时间的总和：\n$$\nT=\\sum_{j=1}^{K} S_{j}.\n$$\n根据全期望定律，\n$$\n\\mathbb{E}[T]=\\mathbb{E}\\!\\left[\\mathbb{E}\\!\\left[T \\mid K\\right]\\right]=\\sum_{i=1}^{N} \\mathbb{P}(K=i)\\,\\mathbb{E}\\!\\left[\\sum_{j=1}^{i} S_{j}\\right].\n$$\n测试时间 $\\{S_{j}\\}_{j=1}^{N}$ 是相互独立的，且独立于 $K$，并且每个 $S_j$ 服从速率为 $\\lambda_j$ 的指数分布，所以\n$$\n\\mathbb{E}[S_{j}]=\\frac{1}{\\lambda_{j}}, \\quad j=1,\\ldots,N.\n$$\n因此，\n$$\n\\mathbb{E}[T]=\\sum_{i=1}^{N} \\frac{c_{i}}{C}\\sum_{j=1}^{i} \\frac{1}{\\lambda_{j}}.\n$$\n等价地，通过交换求和顺序，\n$$\n\\mathbb{E}[T]=\\frac{1}{C}\\sum_{j=1}^{N} \\frac{1}{\\lambda_{j}} \\sum_{i=j}^{N} c_{i}.\n$$\n两个表达式都是以 $N$、$\\{c_{i}\\}_{i=1}^{N}$ 和 $\\{\\lambda_{i}\\}_{i=1}^{N}$ 表示的有效封闭形式。", "answer": "$$\\boxed{\\frac{1}{\\sum_{k=1}^{N} c_{k}} \\sum_{i=1}^{N} c_{i} \\sum_{j=1}^{i} \\frac{1}{\\lambda_{j}}}$$", "id": "1400529"}, {"introduction": "全期望定律的威力不仅限于离散条件，也适用于连续条件，并且其思想可以推广到方差的分解。这个关于随机游走的练习 [@problem_id:1928914] 引入了一个分层模型的概念，其中模型的参数（向右走的概率 $p$）本身是一个从连续分布中抽取的随机变量。要解决这个问题，我们不仅需要对一个连续变量 $p$ 进行条件化，还需要应用相关的全方差定律，即 $\\text{Var}(Y) = \\mathbb{E}[\\text{Var}(Y|X)] + \\text{Var}(\\mathbb{E}[Y|X])$。这道题有力地展示了条件思想在处理更复杂随机模型中的强大通用性。", "problem": "一个粒子进行由 $N$ 个离散步组成的一维随机游走。在过程的最开始，通过从区间 $[0, 1]$ 上的连续均匀分布中抽取，选择一个向右移动的概率 $p$ 的单一值。这个相同的概率 $p$ 随后被用于所有 $N$ 步。在每一步中，粒子以概率 $p$ 移动 $+1$，或以概率 $1-p$ 移动 $-1$。设随机变量 $S_N$ 表示粒子在 $N$ 步后的最终位置，假设它从原点开始。\n\n求最终位置的方差 $\\text{Var}(S_N)$。将你的答案表示为 $N$ 的函数。", "solution": "设 $X_{i}$ 表示第 $i$ 步，其中 $X_{i}\\in\\{-1,+1\\}$。在随机选择的 $p\\in[0,1]$ 的条件下，各步是独立同分布的，其\n$$\n\\mathbb{E}[X_{i}\\,|\\,p]=(+1)p+(-1)(1-p)=2p-1,\n$$\n并且由于 $X_{i}^{2}=1$，\n$$\n\\operatorname{Var}(X_{i}\\,|\\,p)=\\mathbb{E}[X_{i}^{2}\\,|\\,p]-\\left(\\mathbb{E}[X_{i}\\,|\\,p]\\right)^{2}=1-(2p-1)^{2}=4p(1-p).\n$$\n$N$ 步后的位置是 $S_{N}=\\sum_{i=1}^{N}X_{i}$。在给定 $p$ 的条件下，\n$$\n\\mathbb{E}[S_{N}\\,|\\,p]=N(2p-1),\\qquad \\operatorname{Var}(S_{N}\\,|\\,p)=N\\cdot 4p(1-p)=4N\\,p(1-p).\n$$\n根据全方差公式，\n$$\n\\operatorname{Var}(S_{N})=\\mathbb{E}\\!\\left[\\operatorname{Var}(S_{N}\\,|\\,p)\\right]+\\operatorname{Var}\\!\\left(\\mathbb{E}[S_{N}\\,|\\,p]\\right).\n$$\n对于 $p\\sim\\operatorname{Unif}[0,1]$，计算\n$$\n\\mathbb{E}[p]=\\int_{0}^{1}p\\,dp=\\frac{1}{2},\\qquad \\mathbb{E}[p^{2}]=\\int_{0}^{1}p^{2}\\,dp=\\frac{1}{3},\n$$\n所以\n$$\n\\mathbb{E}[p(1-p)]=\\mathbb{E}[p]-\\mathbb{E}[p^{2}]=\\frac{1}{2}-\\frac{1}{3}=\\frac{1}{6}.\n$$\n因此\n$$\n\\mathbb{E}\\!\\left[\\operatorname{Var}(S_{N}\\,|\\,p)\\right]=\\mathbb{E}\\!\\left[4N\\,p(1-p)\\right]=4N\\cdot\\frac{1}{6}=\\frac{2N}{3}.\n$$\n对于第二项，\n$$\n\\operatorname{Var}\\!\\left(\\mathbb{E}[S_{N}\\,|\\,p]\\right)=\\operatorname{Var}\\!\\left(N(2p-1)\\right)=N^{2}\\operatorname{Var}(2p-1)=N^{2}\\cdot 4\\,\\operatorname{Var}(p),\n$$\n并且\n$$\n\\operatorname{Var}(p)=\\mathbb{E}[p^{2}]-(\\mathbb{E}[p])^{2}=\\frac{1}{3}-\\left(\\frac{1}{2}\\right)^{2}=\\frac{1}{12},\n$$\n所以\n$$\n\\operatorname{Var}\\!\\left(\\mathbb{E}[S_{N}\\,|\\,p]\\right)=N^{2}\\cdot 4\\cdot\\frac{1}{12}=\\frac{N^{2}}{3}.\n$$\n将这两部分贡献相加得到\n$$\n\\operatorname{Var}(S_{N})=\\frac{2N}{3}+\\frac{N^{2}}{3}=\\frac{N(N+2)}{3}.\n$$", "answer": "$$\\boxed{\\frac{N(N+2)}{3}}$$", "id": "1928914"}]}