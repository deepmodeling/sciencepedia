{"hands_on_practices": [{"introduction": "Metropolis-Hastings 算法最核心的部分是其接受概率的计算。这个练习将引导你直接计算一个离散目标分布的接受概率，从而巩固你对算法如何根据目标概率来决定接受或拒绝一个新提议的理解。这是掌握该算法的第一步 [@problem_id:1962612]。", "problem": "一位统计学家正在实施一个马尔可夫链蒙特卡洛 (MCMC) 模拟，以从一个目标概率分布中生成样本。所选择的目标分布是泊松分布，它模拟在固定的时间或空间间隔内发生的事件数 $k$。泊松分布的概率质量函数由下式给出：\n$$ P(k; \\lambda) = \\frac{\\lambda^k e^{-\\lambda}}{k!} $$\n其中 $\\lambda$ 是事件的平均发生率。对于本次特定的模拟，参数设置为 $\\lambda = 5$。\n\n该模拟使用带有对称提议分布的 Metropolis-Hastings 算法，这意味着从状态 $k_1$ 提议移动到状态 $k_2$ 的概率与从 $k_2$ 提议移动到 $k_1$ 的概率相同。\n\n假设链的当前状态是 $k=5$。然后算法提议移动到一个新状态 $k'=6$。\n\n计算这个从 $k=5$ 到 $k'=6$ 的提议移动的接受概率。将您的答案表示为四舍五入到三位有效数字的小数。", "solution": "在具有对称提议分布的 Metropolis-Hastings 算法中，从状态 $k$ 到 $k'$ 的提议移动的接受概率为\n$$\n\\alpha = \\min\\left(1, \\frac{\\pi(k')}{\\pi(k)}\\right),\n$$\n其中 $\\pi(\\cdot)$ 是目标概率质量函数。对于参数为 $\\lambda$ 的泊松分布，其概率质量函数 (PMF) 为\n$$\n\\pi(k) = \\frac{\\lambda^{k} \\exp(-\\lambda)}{k!}.\n$$\n因此，该比率简化为\n$$\n\\frac{\\pi(k')}{\\pi(k)} = \\frac{\\lambda^{k'} \\exp(-\\lambda) / k'!}{\\lambda^{k} \\exp(-\\lambda) / k!} = \\lambda^{k'-k} \\frac{k!}{k'!}.\n$$\n当 $k=5$，$k'=6$，且 $\\lambda=5$ 时，我们有 $k'-k=1$ 和 $6! = 6 \\cdot 5!$，所以\n$$\n\\frac{\\pi(6)}{\\pi(5)} = \\lambda \\cdot \\frac{5!}{6!} = \\lambda \\cdot \\frac{1}{6} = \\frac{5}{6}.\n$$\n因此，接受概率是\n$$\n\\alpha = \\min\\left(1, \\frac{5}{6}\\right) = \\frac{5}{6}.\n$$\n表示为四舍五入到三位有效数字的小数，即为 $0.833$。", "answer": "$$\\boxed{0.833}$$", "id": "1962612"}, {"introduction": "在掌握了核心计算之后，这个练习将展示算法的强大通用性。我们将看到 Metropolis 算法（Metropolis-Hastings 的一个特例）如何被巧妙地用于在一个几何形状复杂的区域内生成均匀分布的样本，而这对于直接采样方法来说是极具挑战性的。通过这个练习，你将能一步步追踪马尔可夫链在状态空间中的移动轨迹 [@problem_id:1962636]。", "problem": "一位数据科学家正在为一个系统建模，该系统的状态可以用二维空间中的一个点 $(x, y)$ 来描述。该系统的有效状态被限制在一个特定的区域 $\\mathcal{S} \\subset \\mathbb{R}^2$ 内。区域 $\\mathcal{S}$ 由以下不等式组定义：\n1. $y \\ge x^2$\n2. $x^2 + y^2 \\le 4$\n3. $x \\ge 0$\n\n为了探索这个状态空间，该科学家使用了Metropolis算法，这是Metropolis-Hastings算法在提议分布对称时的一个特例。目标是生成一个在区域 $\\mathcal{S}$ 内均匀分布的点序列。\n\n该算法以离散的时间步进行。设系统在第 $t$ 步的状态为 $P_t = (x_t, y_t)$。为了生成第 $t+1$ 步的状态，会提议一个新的候选状态 $P'_{t+1}$。然后根据Metropolis接受准则来接受或拒绝该候选状态。如果接受，则 $P_{t+1} = P'_{t+1}$。如果拒绝，状态不改变，即 $P_{t+1} = P_t$。\n\n系统的初始状态为 $P_0 = (1.0, 1.5)$。按顺序提议了五个候选状态序列：\n- $P'_1 = (1.1, 1.8)$\n- $P'_2 = (0.8, 1.7)$\n- $P'_3 = (0.6, 0.2)$\n- $P'_4 = (0.9, 1.9)$\n- $P'_5 = (0.7, 1.1)$\n\n确定在考虑了所有五个提议之后系统的状态坐标，记为 $P_5 = (x_5, y_5)$。", "solution": "我们的目标是区域 $\\mathcal{S}=\\{(x,y)\\in\\mathbb{R}^{2}: y\\ge x^{2},\\ x^{2}+y^{2}\\le 4,\\ x\\ge 0\\}$ 上的均匀分布。对于对称提议，Metropolis接受概率为\n$$\n\\alpha\\big(P_{t}\\to P'\\big)=\\min\\left(1,\\frac{\\pi(P')}{\\pi(P_{t})}\\right),\n$$\n其中 $\\pi$ 是目标密度。对于 $\\mathcal{S}$ 上的均匀目标分布，如果 $P\\in\\mathcal{S}$，则 $\\pi(P)=c>0$，否则 $\\pi(P)=0$。因此，\n- 如果 $P'\\in\\mathcal{S}$，则 $\\alpha=1$ (接受)，\n- 如果 $P'\\notin\\mathcal{S}$，则 $\\alpha=0$ (拒绝)。\n\n我们首先验证初始状态 $P_{0}=(1.0,1.5)$ 是否在 $\\mathcal{S}$ 中：\n$$\nx_{0}=1.0\\ge 0,\\quad y_{0}=1.5\\ge x_{0}^{2}=1.0,\\quad x_{0}^{2}+y_{0}^{2}=1.0+2.25=3.25\\le 4,\n$$\n所以 $P_{0}\\in\\mathcal{S}$。\n\n我们现在检查每个提议：\n\n1) $P'_{1}=(1.1,1.8)$:\n$$\nx=1.1\\ge 0,\\quad y=1.8\\ge x^{2}=1.21,\\quad x^{2}+y^{2}=1.21+3.24=4.45>4,\n$$\n所以 $P'_{1}\\notin\\mathcal{S}$，拒绝。因此 $P_{1}=P_{0}=(1.0,1.5)$。\n\n2) $P'_{2}=(0.8,1.7)$:\n$$\nx=0.8\\ge 0,\\quad y=1.7\\ge x^{2}=0.64,\\quad x^{2}+y^{2}=0.64+2.89=3.53\\le 4,\n$$\n所以 $P'_{2}\\in\\mathcal{S}$，接受。因此 $P_{2}=(0.8,1.7)$。\n\n3) $P'_{3}=(0.6,0.2)$:\n$$\nx=0.6\\ge 0,\\quad y=0.2\\ge x^{2}=0.36\\ \\text{是假的},\n$$\n所以 $P'_{3}\\notin\\mathcal{S}$，拒绝。因此 $P_{3}=P_{2}=(0.8,1.7)$。\n\n4) $P'_{4}=(0.9,1.9)$:\n$$\nx=0.9\\ge 0,\\quad y=1.9\\ge x^{2}=0.81,\\quad x^{2}+y^{2}=0.81+3.61=4.42>4,\n$$\n所以 $P'_{4}\\notin\\mathcal{S}$，拒绝。因此 $P_{4}=(0.8,1.7)$。\n\n5) $P'_{5}=(0.7,1.1)$:\n$$\nx=0.7\\ge 0,\\quad y=1.1\\ge x^{2}=0.49,\\quad x^{2}+y^{2}=0.49+1.21=1.70\\le 4,\n$$\n所以 $P'_{5}\\in\\mathcal{S}$，接受。因此 $P_{5}=(0.7,1.1)$。\n\n因此，在五个提议之后，状态为 $P_{5}=(0.7,1.1)$。", "answer": "$$\\boxed{\\begin{pmatrix}0.7  1.1\\end{pmatrix}}$$", "id": "1962636"}, {"introduction": "成功实现 MCMC 方法不仅需要编写算法本身，更关键的是对其进行监控和调优。最后一个练习将我们的重点转移到算法诊断上，探讨提议步长与接受率之间的重要关系。理解这种权衡是确保你的采样器能够高效探索整个目标分布的关键 [@problem_id:1962675]。", "problem": "一位数据科学家正在使用 Metropolis 算法（Metropolis-Hastings 算法的一个特例）从一维、连续且单峰的目标概率密度函数 $\\pi(x)$ 中生成样本。该算法的工作原理如下：在每一步 $t$，给定当前状态 $x_t$，从一个对称的提议分布 $q(x'|x_t) = q(x_t|x')$ 中提议一个新的候选状态 $x'$。在这种情况下，提议分布是一个以当前状态为中心的正态分布，$x' \\sim N(x_t, \\sigma^2)$，其中标准差 $\\sigma$ 是一个控制步长的调节参数。\n\n新状态 $x'$ 以概率 $\\alpha = \\min\\left(1, \\frac{\\pi(x')}{\\pi(x_t)}\\right)$ 被接受。如果被接受，下一个状态为 $x_{t+1} = x'$；否则，马尔可夫链保持在当前状态，$x_{t+1} = x_t$。\n\n在运行采样器大量迭代后，该数据科学家观察到接受率持续在 99.5% 左右。在马尔可夫链蒙特卡洛 (MCMC) 诊断的背景下，下列哪个陈述为这一观察提供了最准确且最可能的解释？\n\nA. 采样器表现最优，因为高接受率确保了生成的样本是目标分布的完美表示。\n\nB. 提议步长 $\\sigma$ 可能过大，导致采样器在目标分布的尾部提议状态，而这些状态几乎总是被拒绝。\n\nC. 采样器已成功收敛到平稳分布，并且后续样本可以被视为从 $\\pi(x)$ 中进行的独立抽取。\n\nD. 提议步长 $\\sigma$ 可能过小，导致采样器探索状态空间的速度非常缓慢且效率低下，尽管大多数步骤都被接受了。\n\nE. 目标分布 $\\pi(x)$ 必定近似均匀分布，这就是几乎每个提议的状态都被接受的原因。", "solution": "给定一个对称的提议分布 $q(x'|x_{t})=q(x_{t}|x')$，Metropolis 接受概率简化为\n$$\n\\alpha(x_{t},x')=\\min\\left(1,\\frac{\\pi(x')}{\\pi(x_{t})}\\right)=\\min\\left(1,\\exp\\left(\\ln\\pi(x')-\\ln\\pi(x_{t})\\right)\\right).\n$$\n令 $x'=x_{t}+\\epsilon$，其中 $\\epsilon\\sim N(0,\\sigma^{2})$。定义对数密度 $\\ell(x)=\\ln\\pi(x)$。对于可微的单峰分布 $\\pi$，在 $x_t$ 附近的泰勒展开给出\n$$\n\\ell(x_{t}+\\epsilon)-\\ell(x_{t})=\\ell'(x_{t})\\,\\epsilon+\\frac{1}{2}\\ell''(x_{t})\\,\\epsilon^{2}+o(\\epsilon^{2}).\n$$\n当 $\\sigma$ 很小时，$\\epsilon$ 通常是 $\\sigma$ 的量级，因此对数密度的变化很小：\n$$\n\\ell(x_{t}+\\epsilon)-\\ell(x_{t})=\\mathcal{O}(\\sigma)+\\mathcal{O}(\\sigma^{2}).\n$$\n因此 $\\exp\\left(\\ell(x_{t}+\\epsilon)-\\ell(x_{t})\\right)\\approx 1$，这意味着 $\\alpha(x_{t},x')\\approx 1$。因此，接近 0.995 的接受率是步长 $\\sigma$ 非常小的一个标志：大多数提议的移动在 $\\pi$ 上产生的变化可以忽略不计，因此它们几乎总是被接受。然而，链随后以大小为 $\\epsilon=\\mathcal{O}(\\sigma)$ 的增量移动，因此每次迭代对状态空间的探索都很慢，并且马尔可夫链表现出高自相关性和差的混合效率。\n\n考虑每个选项：\n- A 是不正确的，因为非常高的接受率并不意味着最优性能或完美表示；过高的接受率通常表示步长过小和探索效率低下。\n- B 是不正确的，因为过大的 $\\sigma$ 通常会将提议推向低密度区域，导致接受率低而不是高。\n- C 是不正确的，因为仅凭接受率无法确定收敛，并且即使在平稳状态下，随机游走 Metropolis 采样也不是独立的；在步长很小的情况下，它们是强自相关的。\n- D 是正确的：非常高的接受率强烈表明 $\\sigma$ 太小，尽管大多数提议都被接受，但这导致了缓慢的探索。\n- E 是不正确的，因为接近 1 的接受率并不要求 $\\pi$ 近似均匀；它可能仅仅因为 $\\sigma$ 非常小而产生。一个真正的均匀目标分布会对任何提议产生恰好为 1 的接受率，这在此处并未暗示。\n\n因此，最准确的解释是提议步长太小，尽管接受率高，但导致了低效的探索。", "answer": "$$\\boxed{D}$$", "id": "1962675"}]}