## 引言
[生存分析](@entry_id:163785)是统计学中一个至关重要的分支，它专注于分析从某个起始时间点到特定事件发生所经过的时间数据。无论是在评估新药疗效的[临床试验](@entry_id:174912)中，还是在预测工业组件可靠性的工程测试里，准确估计“生存”概率都是核心任务。然而，在现实世界的数据收集中，我们常常无法观测到所有研究对象的完整事件时间，这种现象被称为“删失”，它为数据分析带来了独特的挑战。简单地忽略或错误处理[删失数据](@entry_id:173222)，将导致对生存概率的严重偏倚。

为了应对这一挑战，统计学家Edward L. Kaplan和Paul Meier于1958年提出了[Kaplan-Meier估计量](@entry_id:178062)，这是一种强大而优雅的[非参数方法](@entry_id:138925)，现已成为[生存分析](@entry_id:163785)的基石。本文旨在为读者提供对[Kaplan-Meier估计量](@entry_id:178062)的全面理解。我们将从第一章“原理与机制”开始，深入剖析其数学构造、核心思想（乘积极限法）以及关键假设。随后，在第二章“应用与跨学科联系”中，我们将跨出理论的范畴，探索该方法如何在临床医学、工程学、遗传学乃至社会科学等多个领域解决实际问题。最后，在第三章“动手实践”中，您将通过一系列引导性练习，亲手计算和解读[Kaplan-Meier](@entry_id:169317)生存曲线，将理论知识转化为实践技能。

## 原理与机制

在[生存分析](@entry_id:163785)中，我们的核心目标是估计和解释从事件发生开始到某个特定事件发生所经过的时间，即“生存时间”。然而，由于研究期限、受试者失访等多种原因，我们往往无法观测到所有受试者的确切生存时间。这就引入了[生存数据分析](@entry_id:190868)中最核心的挑战之一：删失（censoring）。本章将深入探讨处理这[类数](@entry_id:156164)据的基石方法——[Kaplan-Meier估计量](@entry_id:178062)——的根本原理与运作机制。

### [生存数据](@entry_id:165675)及其挑战：删失

在典型的[生存分析](@entry_id:163785)研究中，例如一项评估新药疗效的[临床试验](@entry_id:174912)，我们关心的是患者从接受治疗到疾病复发的时间。然而，在研究结束时，一些患者可能仍然没有复发；另一些患者可能因为搬家、个人意愿等与疾病无关的原因退出了研究 [@problem_id:1961444]。在这些情况下，我们只知道他们的生存时间“至少”是他们最后一次被观测到的时间点，但确切的事件发生时间是未知的。这种不完整的观测被称为 **[右删失](@entry_id:164686) (right-censoring)**。它是 [Kaplan-Meier](@entry_id:169317) 方法设计用来处理的最常见的数据类型。

简单地忽略[删失数据](@entry_id:173222)会导致严重的偏倚，因为这样做会不成比例地移除那些“生存”时间较长的个体，从而低估真实的生存概率。同样，将删失时间当作事件时间处理也是错误的，因为它会人为地缩短生存时间，从而高估事件发生的风险。

为了正确处理这[类数](@entry_id:156164)据，我们必须为研究中的每一位受试者记录两个关键信息：首先是观测时长，其次是一个状态指标，用以表明在该观测时长的终点是发生了目标事件还是发生了删失 [@problem_id:1961464]。在数学上，对于第 $i$ 个受试者，我们观测到一对数据 $(T_i, \delta_i)$，其中：
- $T_i = \min(X_i, C_i)$ 是观测时间，即真实事件时间 $X_i$ 和删失时间 $C_i$ 中的较小者。
- $\delta_i = \mathbf{1}\{X_i \le C_i\}$ 是事件[指示变量](@entry_id:266428)，如果观测到事件发生（即 $X_i \le C_i$），则 $\delta_i = 1$；如果观测被删失（即 $X_i > C_i$），则 $\delta_i = 0$。

[Kaplan-Meier](@entry_id:169317) 方法正是利用这一数据结构，有效地整合了来自事件和删失观测中的全部信息。

### [Kaplan-Meier估计量](@entry_id:178062)的构建：乘积极限法

[Kaplan-Meier](@entry_id:169317) (KM) 估计量，又称 **乘积极限 (product-limit)** 估计量，提供了一种非参数的方法来估计生存函数 $S(t) = P(T > t)$。其核心思想是将生存到时间 $t$ 的概率分解为一系列[条件概率](@entry_id:151013)的乘积。生存过时间 $t$ 意味着必须先生存过第一个事件时间点 $t_{(1)}$，然后 given 生存过了 $t_{(1)}$，再生存过第二个事件时间点 $t_{(2)}$，以此类推，直到最后一个发生在 $t$ 之前的事件时间点。

KM 估计量的公式定义如下：

$$ \hat{S}(t) = \prod_{j: t_{(j)} \le t} \left(1 - \frac{d_j}{n_j}\right) $$

其中，该乘积包含了所有小于等于时间 $t$ 的 **唯一事件时间点** $t_{(j)}$。公式中的每个组成部分都有其精确的统计含义：

- $t_{(j)}$: 数据中观测到的第 $j$ 个独特的、按时间排序的 **事件** 发生时间。请注意，删失时间点不包含在此序列中。
- $d_j$: 在时间点 $t_{(j)}$ 观测到的事件发生数量（例如，复发或死亡的人数）。
- $n_j$: 在时间点 $t_{(j)}$ **之前瞬间** 的 **风险集 (risk set)** 大小。风险集是指在该时间点仍处于“有风险”状态的受试者数量，即他们既没有发生事件，也尚未被删失 [@problem_id:1961427] [@problem_id:1961445]。一个受试者若在时间 $t_0$ 发生事件或被删失，那么对于任何 $t_{(j)} > t_0$，他将不再属于风险集 $n_j$。

公式的核心部分是因子 $(1 - \frac{d_j}{n_j})$。这里的比率 $\frac{d_j}{n_j}$ 是在时间 $t_{(j)}$ 发生事件的[条件概率](@entry_id:151013)的估计，其条件是“个体已生存至 $t_{(j)}$ 之前”。这个比率在离散时间框架下可以被看作是 **[风险率](@entry_id:266388) (hazard rate)** 的估计。因此，$(1 - \frac{d_j}{n_j})$ 就相应地成为了在 $t_{(j)}$ **条件性生存 (conditional survival)** 概率的估计，即“已知一个个体生存至 $t_{(j)}$ 之前，他能成功生存过 $t_{(j)}$ 这个时间点的概率” [@problem_id:1961470]。

通过将这些在每个事件时间点的条件生存概率连乘起来，KM 估计量就构建出了生存至任意时间点 $t$ 的总生存概率的估计值。

### [Kaplan-Meier](@entry_id:169317)估计的性质与计算

#### 阶梯函数特性
[Kaplan-Meier](@entry_id:169317) 生存曲线最显著的特征是它是一个 **[阶梯函数](@entry_id:159192) (step function)**。它的值在两次连续的事件发生时间之间保持不变。生存概率的估计值 $\hat{S}(t)$ 仅在观测到 **事件** 的时间点 $t_{(j)}$ 才会发生向下的“跳跃”。在删失发生的时间点，$\hat{S}(t)$ 的值并不会改变，因为删失的个体并未提供事件发生的信息；他们只是从那一刻起不再对后续的风险集做出贡献。按照惯例，[Kaplan-Meier](@entry_id:169317) 曲线被定义为[右连续函数](@entry_id:149745)，即在跳跃点 $t_{(j)}$ 处的值等于跳跃后的值 [@problem_id:1961462]。

#### 计算示例
让我们通过一个实例来具体说明计算过程。假设一项研究中有8名患者，其观测时间（单位：月）和状态如下（\* 表示删失）：$10, 15^*, 9, 12, 15, 9^*, 18, 20^*$ [@problem_id:1961427]。

首先，我们按时间顺序整理所有观测时间，并找出唯一的事件时间：$t_{(1)}=9, t_{(2)}=10, t_{(3)}=12, t_{(4)}=15, t_{(5)}=18$。

接下来，我们为每个事件时间点构建计算表：

| 事件时间 $t_{(j)}$ | 风险集人数 $n_j$ | 事件数 $d_j$ | 条件生存概率 $(1 - \frac{d_j}{n_j})$ | [Kaplan-Meier](@entry_id:169317)估计 $\hat{S}(t_{(j)})$ |
| :--- | :--- | :--- | :--- | :--- |
| **$t_0=0$** | 8 | 0 | $1.0$ | $1.0$ |
| **$t_{(1)}=9$** | 8 | 1 | $1 - \frac{1}{8} = \frac{7}{8}$ | $1 \times \frac{7}{8} = 0.875$ |
| **$t_{(2)}=10$** | 6 | 1 | $1 - \frac{1}{6} = \frac{5}{6}$ | $\frac{7}{8} \times \frac{5}{6} \approx 0.729$ |
| **$t_{(3)}=12$** | 5 | 1 | $1 - \frac{1}{5} = \frac{4}{5}$ | $\frac{7}{8} \times \frac{5}{6} \times \frac{4}{5} = 0.583$ |
| **$t_{(4)}=15$** | 4 | 1 | $1 - \frac{1}{4} = \frac{3}{4}$ | $\frac{7}{8} \times \frac{5}{6} \times \frac{4}{5} \times \frac{3}{4} = 0.4375$ |
| **$t_{(5)}=18$** | 2 | 1 | $1 - \frac{1}{2} = \frac{1}{2}$ | $0.4375 \times \frac{1}{2} = 0.21875$ |

- **$t=9$**: 开始时所有8名患者都在风险集中 ($n_1=8$)。在第9个月，一名患者发生事件 ($d_1=1$)。另一名患者在同月被删失，但他/她对于计算 $t=9$ 时的风险是贡献了信息的，因此也被包含在 $n_1$ 中。
- **$t=10$**: 到了第10个月，之前发生事件和删失的患者已退出，风险集降至6人 ($n_2=6$)。一名患者发生事件 ($d_2=1$)。
- **$t=12$**: 风险集剩余5人 ($n_3=5$)，一名患者发生事件 ($d_3=1$)。
- **$t=15$**: 风险集剩余4人 ($n_4=4$)，一名患者发生事件 ($d_4=1$)。另一名患者在同月被删失。
- **$t=18$**: 经过第15个月的事件和删失，风险集剩余2人 ($n_5=2$)，一名患者发生事件 ($d_5=1$)。
- **$t > 18$**: 最后一个事件发生在18个月。之后，$\hat{S}(t)$ 保持在 $0.21875$ 直至最后一次观测时间（20个月），并在其后保持不变，尽管最后一次观测是删失。

#### 特殊情况：无[删失数据](@entry_id:173222)
当数据集中没有任何删失时，[Kaplan-Meier](@entry_id:169317) 估计量会简化为我们所熟悉的 **经验生存函数 (empirical survival function)** [@problem_id:1961419]。经验生存函数在时间 $t$ 的值就是简单地计算在时间 $t$ 仍然存活的个体数占总样本量的比例。

这个[等价关系](@entry_id:138275)可以通过KM公式的代数性质得到。在没有删失的情况下，风险集人数 $n_j$ 在一个事件时间点 $t_{(j)}$ 之后，恰好等于下一个事件时间点 $t_{(j+1)}$ 之前的风险集人数，即 $n_{j+1} = n_j - d_j$。因此，KM估计的乘积形式会发生“伸缩”：
$$ \hat{S}(t_{(k)}) = \prod_{j=1}^{k} \frac{n_j - d_j}{n_j} = \frac{n_1 - d_1}{n_1} \times \frac{n_2 - d_2}{n_2} \times \dots \times \frac{n_k - d_k}{n_k} = \frac{n_2}{n_1} \times \frac{n_3}{n_2} \times \dots \times \frac{n_k - d_k}{n_k} = \frac{n_k - d_k}{n_1} $$
这里，$n_1$是初始样本总数，$n_k - d_k$ 是在最后一个事件时间点 $t_{(k)}$ 之后仍然存活的个体数。这正是经验生存函数的定义。这个特性为K[M估计量](@entry_id:169257)提供了一个直观的校验基准。

### 关键假设与局限性

[Kaplan-Meier](@entry_id:169317) 估计量的有效性依赖于一个至关重要的假设：**非信息性删失 (non-informative censoring)**。

#### 非信息性删失
该假设要求个体的删失机制必须与其未来的生存结局 **统计独立**。换言之，一个被删失的个体，其真实的事件风险，应该与那些在同一时间点仍然留在研究中的个体是相同的。
- **合规示例**: 研究因固定日期结束而产生的删失（行政性删失），或患者因搬家等与健康无关原因失访，通常被认为是 **非信息性** 的 [@problem_id:1961472]。
- **违规示例**: 如果在一项关于某种严重疾病的临床试验中，病情迅速恶化的患者更倾向于退出研究以寻求姑息治疗，那么这种删失就是 **信息性 (informative)** 的。因为删失（退出研究）的决定与较差的预后（更短的生存时间）直接相关。在这种情况下，[Kaplan-Meier](@entry_id:169317) 估计量会系统性地高估生存率，因为它不成比例地保留了预后较好的患者在风险集中 [@problem_id:1961472]。

#### 其他数据类型的局限性
标准的[Kaplan-Meier](@entry_id:169317)方法是为精确观测的事件时间和右[删失数据](@entry_id:173222)设计的。当数据包含其他类型的删失时，其应用会受到限制。例如，对于 **[区间删失](@entry_id:636589) (interval-censored)** 数据——即我们只知道事件发生在某个时间区间 $(L, R]$ 内，但不知道确切时间点——标准的KM方法不再适用。

试图强行应用KM方法，比如将事件时间武断地定在区间的起点或终点，会产生不确定的结果。例如，假设一位患者在第6个月检查时无恙，但在第10个月检查时发现事件已发生，其事件时间在 $(6, 10]$ 区间内 [@problem_id:1961428]。如果我们假设事件发生在6个月后立刻发生，或假设它在10个月检查时才发生，我们会得到两条不同的KM曲线。这揭示了标准KM方法无法处理这种模糊性的局限性，此时需要使用如Turnbull estimator等为[区间删失](@entry_id:636589)数据设计的更高级方法。

理解[Kaplan-Meier估计量](@entry_id:178062)的这些原理、机制、假设和局限性，是进行严谨、可靠的[生存分析](@entry_id:163785)的第一步。