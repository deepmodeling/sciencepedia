{"hands_on_practices": [{"introduction": "双向方差分析模型通常用诸如 $\\mu$、$\\alpha_i$ 和 $\\beta_j$ 这样的参数来表示。然而，为了真正理解其数学基础并利用通用统计软件，将其转换为一般线性模型形式 $\\vec{Y} = X \\vec{\\beta} + \\vec{\\epsilon}$ 至关重要。本练习将指导您完成这一转换过程，通过构建设计矩阵 $X$ 来具体化模型的结构，这是连接理论与计算实践的关键一步 [@problem_id:1965175]。", "problem": "一个软件工程团队正在对一款新的网络应用程序进行性能分析。他们测量了该应用程序在不同条件下的响应时间。该实验设计了两个因子：因子A是云服务提供商，有 $I=3$ 个水平（`Provider 1`、`Provider 2`、`Provider 3`）；因子B是数据库引擎，有 $J=2$ 个水平（`Engine A`、`Engine B`）。对于 $I \\times J = 6$ 个处理组合中的每一个，团队收集了 $K=2$ 个独立的响应时间测量值。\n\n团队使用带交互项的双因素方差分析（ANOVA）模型对响应时间 $y_{ijk}$ 进行建模：\n$$y_{ijk} = \\mu + \\alpha_i + \\beta_j + (\\alpha\\beta)_{ij} + \\epsilon_{ijk}$$\n其中 $i \\in \\{1, 2, 3\\}$，$j \\in \\{1, 2\\}$，且 $k \\in \\{1, 2\\}$。这里，$\\mu$ 是总体平均响应时间，$\\alpha_i$ 是 `Provider i` 的主效应，$\\beta_j$ 是 `Engine j` 的主效应，$(\\alpha\\beta)_{ij}$ 是 `Provider i` 和 `Engine j` 之间的交互效应，而 $\\epsilon_{ijk}$ 代表随机误差。\n\n该模型可以表示为一般线性模型（GLM）的形式，$\\vec{Y} = X \\vec{\\beta} + \\vec{\\epsilon}$。为确保参数是唯一可识别的，我们施加了一个“设为零”（或角点）约束系统：将对应于每个因子最后一个水平的效应以及任何涉及它们的交互作用都设为零。具体来说，$\\alpha_3 = 0$ 和 $\\beta_2 = 0$，这意味着交互项 $(\\alpha\\beta)_{12}$、$(\\alpha\\beta)_{22}$、$(\\alpha\\beta)_{31}$ 和 $(\\alpha\\beta)_{32}$ 也为零。\n\n观测向量 $\\vec{Y}$ 是一个 $N \\times 1$ 的列向量（其中 $N = I \\times J \\times K$），它通过首先遍历重复索引 $k$，然后是引擎索引 $j$，最后是提供商索引 $i$ 的顺序堆叠观测值 $y_{ijk}$ 而成。即 $\\vec{Y} = [y_{111}, y_{112}, y_{121}, y_{122}, y_{211}, y_{212}, \\dots, y_{322}]^T$。\n\n你的任务是为这个特定的实验设置和参数化确定设计矩阵 $X$。", "solution": "我们从带交互作用的双因素方差分析模型开始\n$$y_{ijk}=\\mu+\\alpha_{i}+\\beta_{j}+(\\alpha\\beta)_{ij}+\\epsilon_{ijk},$$\n其中因子 $i\\in\\{1,2,3\\}$ 和 $j\\in\\{1,2\\}$，以及 $k\\in\\{1,2\\}$ 次重复。在角点约束 $\\alpha_{3}=0$ 和 $\\beta_{2}=0$ 下，涉及受约束水平的交互效应被设为零：$(\\alpha\\beta)_{12}=(\\alpha\\beta)_{22}=(\\alpha\\beta)_{31}=(\\alpha\\beta)_{32}=0$。因此自由参数为\n$$\\vec{\\beta}=\\begin{bmatrix}\\mu & \\alpha_{1} & \\alpha_{2} & \\beta_{1} & (\\alpha\\beta)_{11} & (\\alpha\\beta)_{21}\\end{bmatrix}^{T}.$$\n对于来自单元 $(i,j)$ 的一个观测值，设计矩阵 $X$ 的对应行具有指示这些效应是否存在的条目：\n$$[\\,1,\\ \\mathbb{I}\\{i=1\\},\\ \\mathbb{I}\\{i=2\\},\\ \\mathbb{I}\\{j=1\\},\\ \\mathbb{I}\\{i=1,j=1\\},\\ \\mathbb{I}\\{i=2,j=1\\}\\,].$$\n观测向量 $\\vec{Y}$ 按 $k$ 最快、$j$ 其次、$i$ 最后的顺序排列：$[y_{111},y_{112},y_{121},y_{122},y_{211},y_{212},y_{221},y_{222},y_{311},y_{312},y_{321},y_{322}]^{T}$。因此，$12\\times 6$ 的设计矩阵 $X$（其列的顺序与上面的 $\\vec{\\beta}$ 相同）为\n$$\\begin{pmatrix}\n1 & 1 & 0 & 1 & 1 & 0\\\\\n1 & 1 & 0 & 1 & 1 & 0\\\\\n1 & 1 & 0 & 0 & 0 & 0\\\\\n1 & 1 & 0 & 0 & 0 & 0\\\\\n1 & 0 & 1 & 1 & 0 & 1\\\\\n1 & 0 & 1 & 1 & 0 & 1\\\\\n1 & 0 & 1 & 0 & 0 & 0\\\\\n1 & 0 & 1 & 0 & 0 & 0\\\\\n1 & 0 & 0 & 1 & 0 & 0\\\\\n1 & 0 & 0 & 1 & 0 & 0\\\\\n1 & 0 & 0 & 0 & 0 & 0\\\\\n1 & 0 & 0 & 0 & 0 & 0\n\\end{pmatrix}.$$\n每对相同的连续行对应于每个 $(i,j)$ 单元内的两次重复。", "answer": "$$\\boxed{\\begin{pmatrix}\n1 & 1 & 0 & 1 & 1 & 0\\\\\n1 & 1 & 0 & 1 & 1 & 0\\\\\n1 & 1 & 0 & 0 & 0 & 0\\\\\n1 & 1 & 0 & 0 & 0 & 0\\\\\n1 & 0 & 1 & 1 & 0 & 1\\\\\n1 & 0 & 1 & 1 & 0 & 1\\\\\n1 & 0 & 1 & 0 & 0 & 0\\\\\n1 & 0 & 1 & 0 & 0 & 0\\\\\n1 & 0 & 0 & 1 & 0 & 0\\\\\n1 & 0 & 0 & 1 & 0 & 0\\\\\n1 & 0 & 0 & 0 & 0 & 0\\\\\n1 & 0 & 0 & 0 & 0 & 0\n\\end{pmatrix}}$$", "id": "1965175"}, {"introduction": "理解了模型结构之后，下一步就是将其应用于数据。本练习提供了一个关于环境科学的假设场景，旨在让您亲手实践双向方差分析的核心计算，特别是交互效应的检验 [@problem_id:1965185]。通过计算变异的各个组成部分，您将深入理解方差分析如何将总变异分解为由不同因子及其交互作用解释的部分，以及无法解释的随机误差部分。", "problem": "一位环境科学家正在研究水温和光照对某种藻类生长速率的影响。生长速率以毫克/升/天 (mg/L/day) 为单位进行测量。考虑了两种温度水平（因素A）：15°C和25°C。使用了三个光照水平（因素B）：低、中、高。对于每种 $2 \\times 3 = 6$ 的实验条件，准备了四个重复水样，并在设定时间后测量其藻类生长速率。收集到的数据如下：\n\n| | 低光照 | 中光照 | 高光照 |\n| :--- | :--- | :--- | :--- |\n| **15°C** | 4, 5, 5, 6 | 7, 8, 8, 9 | 10, 11, 11, 12 |\n| **25°C** | 6, 7, 7, 8 | 12, 13, 13, 14 | 18, 19, 19, 21 |\n\n假设双因素方差分析（ANOVA）的标准模型适用于这些数据，计算温度和光照之间交互作用的F统计量。将您的最终答案四舍五入到三位有效数字。", "solution": "设 $a=2$ (温度水平)，$b=3$ (光照水平)，$n=4$ (每个单元格的重复次数)。使用带有交互作用的双因素方差分析模型：\n$$\ny_{ijk}=\\mu+\\alpha_{i}+\\beta_{j}+(\\alpha\\beta)_{ij}+\\varepsilon_{ijk},\n$$\n其中 $i=1,\\ldots,a$, $j=1,\\ldots,b$, $k=1,\\ldots,n$。\n\n计算单元格均值 $\\bar{y}_{ij.}$，行均值 $\\bar{y}_{i..}$，列均值 $\\bar{y}_{.j.}$，以及总均值 $\\bar{y}_{...}$：\n- 单元格均值：\n$$\n\\bar{y}_{11.}=5,\\quad \\bar{y}_{12.}=8,\\quad \\bar{y}_{13.}=11,\\quad \\bar{y}_{21.}=7,\\quad \\bar{y}_{22.}=13,\\quad \\bar{y}_{23.}=\\frac{77}{4}.\n$$\n- 行均值：\n$$\n\\bar{y}_{1..}=\\frac{96}{12}=8,\\quad \\bar{y}_{2..}=\\frac{157}{12}.\n$$\n- 列均值：\n$$\n\\bar{y}_{.1.}=\\frac{48}{8}=6,\\quad \\bar{y}_{.2.}=\\frac{84}{8}=\\frac{21}{2},\\quad \\bar{y}_{.3.}=\\frac{121}{8}.\n$$\n- 总均值：\n$$\n\\bar{y}_{...}=\\frac{253}{24}.\n$$\n\n交互作用对比为 $d_{ij}=\\bar{y}_{ij.}-\\bar{y}_{i..}-\\bar{y}_{.j.}+\\bar{y}_{...}$：\n$$\nd_{11}=\\frac{37}{24},\\quad d_{12}=\\frac{1}{24},\\quad d_{13}=-\\frac{19}{12},\\quad d_{21}=-\\frac{37}{24},\\quad d_{22}=-\\frac{1}{24},\\quad d_{23}=\\frac{19}{12}.\n$$\n因此交互作用平方和为\n$$\nSS_{AB}=n\\sum_{i=1}^{a}\\sum_{j=1}^{b} d_{ij}^{2}\n=4\\left[2\\left(\\frac{37}{24}\\right)^{2}+2\\left(\\frac{1}{24}\\right)^{2}+2\\left(\\frac{19}{12}\\right)^{2}\\right]\n=4\\cdot\\frac{469}{48}=\\frac{469}{12}.\n$$\n交互作用自由度为\n$$\ndf_{AB}=(a-1)(b-1)=2,\n$$\n所以\n$$\nMS_{AB}=\\frac{SS_{AB}}{df_{AB}}=\\frac{\\frac{469}{12}}{2}=\\frac{469}{24}.\n$$\n\n误差平方和是单元格内平方和的总和：\n- 对于五个均值为整数的单元格，每个单元格内的平方和为 $2$。\n- 对于均值为 $\\frac{77}{4}$ 的 $(25\\,^{\\circ}\\text{C}, \\text{高光照})$ 单元格：\n$$\n(18-\\frac{77}{4})^{2}+(19-\\frac{77}{4})^{2}+(19-\\frac{77}{4})^{2}+(21-\\frac{77}{4})^{2}=\\frac{25}{16}+\\frac{1}{16}+\\frac{1}{16}+\\frac{49}{16}=\\frac{76}{16}=\\frac{19}{4}.\n$$\n因此\n$$\nSS_{E}=2+2+2+2+2+\\frac{19}{4}=\\frac{59}{4}.\n$$\n误差自由度为\n$$\ndf_{E}=ab(n-1)=2\\cdot 3\\cdot 3=18,\n$$\n所以\n$$\nMS_{E}=\\frac{SS_{E}}{df_{E}}=\\frac{\\frac{59}{4}}{18}=\\frac{59}{72}.\n$$\n\n因此，交互作用的F-统计量是\n$$\nF_{AB}=\\frac{MS_{AB}}{MS_{E}}=\\frac{\\frac{469}{24}}{\\frac{59}{72}}=\\frac{469}{24}\\cdot\\frac{72}{59}=\\frac{1407}{59}\\approx 23.847\\ldots\n$$\n四舍五入到三位有效数字，结果是 $23.8$。", "answer": "$$\\boxed{23.8}$$", "id": "1965185"}, {"introduction": "统计分析的最终目标是得出有意义的科学结论，而不仅仅是计算数字。当双向方差分析揭示出显著的交互效应时，对主效应的解释需要格外谨慎，这是一个常见的陷阱。本练习 [@problem_id:1964658] 挑战您批判性地思考这种情况：当一个因子的效应依赖于另一个因子的水平时，我们应该如何正确地解释结果，以及为什么对“平均”主效应进行比较可能会产生误导。", "problem": "一位农业科学家进行了一项实验，研究三种不同类型的肥料（F1、F2、F3）和两种不同类型的土壤（S1、S2）对作物产量的影响，产量以千克/小区（kg/plot）为单位进行测量。该实验采用完全随机设计，对于 $3 \\times 2 = 6$ 种处理组合中的每一种，都使用了10个小区。\n\n收集数据后，进行了双因素方差分析（ANOVA）。方差分析表的结果表明，在0.05的α水平下，肥料类型和土壤类型之间交互作用效应的F检验结果具有统计显著性。方差分析表中的均方误差（MSE）为25.0，自由度为54。\n\n分析师观察到以下肥料类型的单元格均值和边际均值：\n\n**单元格均值 (千克/小区):**\n- 肥料 F1，土壤 S1: 50.0\n- 肥料 F1，土壤 S2: 70.0\n- 肥料 F2，土壤 S1: 65.0\n- 肥料 F2，土壤 S2: 65.0\n- 肥料 F3，土壤 S1: 80.0\n- 肥料 F3，土壤 S2: 50.0\n\n**肥料类型的边际均值 (千克/小区):**\n- 肥料 F1: 60.0\n- 肥料 F2: 65.0\n- 肥料 F3: 65.0\n\n分析师忽略了显著的交互作用，继续使用Tukey的真实显著性差异（HSD）检验法对三种肥料类型的边际均值进行两两比较。基于此检验，分析师得出结论：F2和F3的平均产量在统计上是等价的，并且两者都显著高于F1的平均产量。\n\n下列哪项陈述对分析师针对三种肥料类型的边际均值进行的事后比较提出了最准确和最根本的批评？\n\nA. 分析师应该使用Bonferroni校正而不是Tukey HSD检验，因为在存在交互作用时，它能更好地控制族错误率。\n\nB. 该比较存在缺陷，因为显著的交互作用效应违反了Tukey HSD检验所需的方差齐性假设。\n\nC. 边际均值的比较在概念上具有误导性，因为显著交互作用的存在意味着肥料类型的效应取决于土壤类型，这使得肥料的“平均”效应变得不可解释。\n\nD. 分析师不能进行任何事后检验，因为交互作用的F检验是显著的，这使得任何进一步的两两比较都无效。\n\nE. Tukey HSD检验的计算应该使用F分布的临界值，而不是学生化极差分布的临界值，因为这是一个双因素实验。", "solution": "我们将肥料类型 ($i=1,2,3$)、土壤类型 ($j=1,2$) 和重复 ($k=1,\\dots,10$) 的双因素方差分析模型形式化为\n$$\nY_{ijk}=\\mu+\\alpha_{i}+\\beta_{j}+(\\alpha\\beta)_{ij}+\\varepsilon_{ijk},\n$$\n其中 $\\varepsilon_{ijk}\\sim\\text{i.i.d. }N(0,\\sigma^{2})$。对交互项的F检验结果具有统计显著性，意味着至少对于某些 $(i,j)$ 对，有 $(\\alpha\\beta)_{ij}\\neq 0$。这直接意味着肥料的效应取决于土壤，即不同肥料水平之间的差异在不同土壤类型上不是恒定的。\n\n肥料 $i$ 的边际均值是对所有土壤类型求平均：\n$$\n\\bar{Y}_{i\\cdot\\cdot}=\\mu+\\alpha_{i}+\\frac{1}{2}\\sum_{j=1}^{2}\\beta_{j}+\\frac{1}{2}\\sum_{j=1}^{2}(\\alpha\\beta)_{ij}.\n$$\n因为 $(\\alpha\\beta)_{ij}$ 非零且随 $j$ 变化，所以在对 $j$ 进行汇总时，数量 $\\alpha_{i}$ 不能与 $(\\alpha\\beta)_{ij}$ 分开解释。因此，跨 $i$ 比较 $\\bar{Y}_{i\\cdot\\cdot}$ 并不能估计一个单一、一致的肥料效应；它混淆了因土壤水平不同而异的效应。\n\n给定的单元格均值通过考察每种土壤内的简单效应明确地证明了这种依赖关系：\n- 在土壤 S1 中：$F2-F1=65.0-50.0=15.0$，$F3-F2=80.0-65.0=15.0$，$F3-F1=80.0-50.0=30.0$。\n- 在土壤 S2 中：$F2-F1=65.0-70.0=-5.0$，$F3-F2=50.0-65.0=-15.0$，$F3-F1=50.0-70.0=-20.0$。\n这些效应在不同土壤中方向相反（一种交叉交互作用）。因此，肥料的边际均值（60.0, 65.0, 65.0）是对相反效应的平均，在不以土壤为条件的情况下，对于描述肥料的效应是没有意义的。这使得在存在显著交互作用的情况下，对肥料边际均值进行事后比较在概念上具有误导性；应该转而比较简单效应（例如，每种土壤内的肥料效应）或使用针对交互作用定制的对比。\n\n现在评估各个选项：\n- A是错误的：根本问题不是族错误率控制方法的选择（Tukey 对比 Bonferroni），而是在交互作用下边际均值的可解释性。\n- B是错误的：显著的交互作用涉及的是均值结构，而不是方差齐性；它并不意味着违反了Tukey HSD检验所要求的等方差假设。\n- C是正确的：当交互作用显著时，肥料的效应取决于土壤，因此对土壤进行平均会产生一个不可解释的“平均”效应，并误导推断。\n- D是错误的：事后检验仍然是可能和适当的，但它们应该针对简单效应或交互作用对比，而不是边际主效应。\n- E是错误的：即使在多因素设计中比较均值时，Tukey HSD检验也使用学生化极差分布，而不是F分布。\n\n因此，最准确和最根本的批评是，当交互作用显著时，比较边际均值在概念上具有误导性。", "answer": "$$\\boxed{C}$$", "id": "1964658"}]}