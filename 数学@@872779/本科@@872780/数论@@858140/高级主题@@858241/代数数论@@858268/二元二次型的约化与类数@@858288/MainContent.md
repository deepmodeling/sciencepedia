## 引言
[二元二次型](@entry_id:200380)，即形如 $ax^2+bxy+cy^2$（其中a, b, c为整数）的多项式，是数论中最古老也最核心的研究对象之一。自Fermat以来，数学家们一直着迷于一个基本问题：一个给定的整数能被一个特定的二次型表示吗？为了系统地回答这个问题，我们必须首先解决一个更深层次的结构性问题：如何对无穷无尽的二次型进行分类，并将本质上“相同”的二次型归为一类？这一看似简单的问题，引出了数论中一个极其丰富和优美的理论，其巅峰之作便是Gauss的约化理论。

本文旨在系统地阐述二元[二次型的约化](@entry_id:636545)理论及其在计算类数中的应用，为读者构建一个从基本概念到深刻理论联系的完整知识框架。我们将填补从定义到应用的知识鸿沟，展示这些抽象概念如何转化为强大的计算工具，并揭示其在现代数学中的核心地位。

为实现这一目标，文章将分为三个核心部分：
在 **“原理与机制”** 一章中，我们将深入探讨二次型的基本[不变量](@entry_id:148850)——判别式，定义[等价关系](@entry_id:138275)，并详细介绍高斯为正定二次型建立的优美的约化理论。这将引导我们自然地走向数论中的核心概念之一：类数。
接下来，**“应用与交叉学科联系”** 一章将展示这些理论的强大威力。我们将学习如何利用约化算法实际计算[类数](@entry_id:156164)，探索二次型等价类如何构成一个称为“类群”的[代数结构](@entry_id:137052)，并揭示其与[代数数论](@entry_id:148067)中的理想类群、数的几何中的[格理论](@entry_id:147950)以及[解析数论](@entry_id:158402)之间惊人的深刻联系。
最后，在 **“动手实践”** 部分，读者将通过解决一系列精心设计的问题，将理论知识应用于具体计算，从而巩固和深化对二次型理论的理解。

## 原理与机制

在介绍性章节之后，我们现在深入探讨二次型理论的核心原理与机制。本章将系统阐述[二元二次型](@entry_id:200380)的分类、[等价关系](@entry_id:138275)、[高斯约化算法](@entry_id:635132)，以及[类数](@entry_id:156164)的概念。我们的目标是建立一个严谨的框架，不仅能够理解这些概念的定义，更能洞悉它们为何如此重要，以及它们如何相互关联，共同构成了数论中一个优美的分支。

### 二次型及其等价性

我们研究的核心对象是整系数[二元二次型](@entry_id:200380)。

一个 **整系数[二元二次型](@entry_id:200380) (integral binary quadratic form)** 是一个关于变量 $x$ 和 $y$ 的二次[齐次多项式](@entry_id:178156)，其形式为：
$$
f(x,y) = ax^2 + bxy + cy^2
$$
其中系数 $a, b, c$ 均为整数 ($\mathbb{Z}$)。

#### [判别式](@entry_id:174614)与二次型的分类

每个二次型都有一个基本的[不变量](@entry_id:148850)，称为 **判别式 (discriminant)**，定义为：
$$
D = b^2 - 4ac
$$
判别式 $D$ 的符号决定了二次型在实数域 $\mathbb{R}$ 上的基本性质。我们可以通过[配方法](@entry_id:265480)来理解这一点。假设 $a \neq 0$，我们有：
$$
f(x,y) = a\left(x + \frac{b}{2a}y\right)^2 + \frac{4ac - b^2}{4a}y^2 = \frac{1}{4a}\left((2ax+by)^2 - Dy^2\right)
$$
根据 $D$ 的符号，二次型可以被分类：

1.  **定型 (Definite Forms)**: 如果 $D  0$，由于 $y^2 \ge 0$ 且 $(2ax+by)^2 \ge 0$，表达式 $(2ax+by)^2 - Dy^2$ 仅在 $x=y=0$ 时为零。因此，$f(x,y)$ 的符号完全由系数 $a$ 的符号决定。
    *   若 $a > 0$，则 $f(x,y)$ 对所有非零整数对 $(x,y)$ 均取正值，称为 **正定 (positive definite)**。
    *   若 $a  0$，则 $f(x,y)$ 对所有非零整数对 $(x,y)$ 均取负值，称为 **负定 (negative definite)**。
    值得注意的是，当 $D  0$ 时，$b^2  4ac$。由于 $b^2 \ge 0$，这必然要求 $ac > 0$，意味着 $a$ 和 $c$ 同号。因此，[正定性](@entry_id:149643)的条件可以简化为 $D  0$ 且 $a > 0$。例如，二次型 $f_1(x,y) = x^2+xy+y^2$ 的判别式为 $D = 1^2 - 4(1)(1) = -3  0$，且 $a=1>0$，因此它是正定的。

2.  **[不定型](@entry_id:150990) (Indefinite Forms)**: 如果 $D > 0$，表达式 $(2ax+by)^2 - Dy^2$ 可以取正值、负值或零。因此，$f(x,y)$ 可以表示正整数和负整数，称为 **[不定型](@entry_id:150990)**。例如，二次型 $f_2(x,y) = x^2 - 3xy + y^2$ 的判别式为 $D = (-3)^2 - 4(1)(1) = 5 > 0$，因此它是[不定型](@entry_id:150990)的。

3.  **退化型 (Degenerate Forms)**: 如果 $D = 0$，则 $f(x,y) = \frac{1}{4a}(2ax+by)^2$。这意味着该二次型可以表示为某个线性表达式的平方（乘以一个有理常数）。它可以在非零点 $(x,y)$ 处取值为零。例如，$f_3(x,y) = x^2+2xy+y^2 = (x+y)^2$ 的判别式为 $D = 2^2 - 4(1)(1) = 0$，是退化型。

在数论中，判别式 $D$ 还有一个重要的性质：由于 $a, b, c$ 是整数，$D = b^2 - 4ac$ 模 $4$ 的余数必然是 $b^2$ 模 $4$ 的余数。一个整数的平方模 $4$ 只可能是 $0$ 或 $1$，因此任何二元[二次型的[判别](@entry_id:637247)式](@entry_id:174614) $D$ 必须满足 $D \equiv 0 \pmod{4}$ 或 $D \equiv 1 \pmod{4}$。

#### 等价性：何时应将两个二次型视为“相同”？

数论中的一个核心问题是：给定一个整数 $n$，一个二次型 $f(x,y)$ 能否表示它？即方程 $f(x,y) = n$ 是否有整数解 $(x,y)$？

这个问题引出了一个更深层次的结构性问题。考虑二次型 $f(x,y) = x^2+y^2$ 和 $g(x,y) = (x+y)^2 + (x-y)^2 = 2x^2+2y^2$。显然，$g$ 能表示的数都是偶数，而 $f$ 可以表示奇数（如 $1^2+2^2=5$）。这两个二次型表示的数集不同。

现在考虑另一个变换。如果我们对 $f(x,y)=x^2+y^2$ 进行变量代换，令 $x = \alpha x' + \beta y'$ 和 $y = \gamma x' + \delta y'$，其中 $\alpha, \beta, \gamma, \delta$ 是整数，会发生什么？如果这个变换是可逆的，即我们也能用整数系数把 $(x', y')$ 表示为 $(x, y)$ 的[线性组合](@entry_id:154743)，那么原坐标下的整数格点 $\mathbb{Z}^2$ 和新坐标下的整数格点之间就建立了一一对应。这意味着，新旧两个二次型所能表示的整数集合是完全相同的。

这种可逆的整系数线性变换由所谓的 **[幺模矩阵](@entry_id:148345) (unimodular matrices)** 描述，即[行列式](@entry_id:142978)为 $\pm 1$ 的整[系数矩阵](@entry_id:151473)。这些矩阵构成了 **[一般线性群](@entry_id:141275) (General Linear Group)** $\mathrm{GL}_2(\mathbb{Z})$。

一个矩阵 $M = \begin{pmatrix} \alpha  \beta \\ \gamma  \delta \end{pmatrix} \in \mathrm{GL}_2(\mathbb{Z})$ 作用于二次型 $f$，产生一个新的二次型 $g$：
$$
g(x,y) = f(\alpha x + \beta y, \gamma x + \delta y)
$$
我们称 $f$ 和 $g$ 是 **等价的 (equivalent)**。这个作用保持了[判别式](@entry_id:174614)不变，因为新[二次型的判别式](@entry_id:637247) $D_g$ 与原判别式 $D_f$ 的关系是 $D_g = (\det(M))^2 D_f$。由于 $\det(M) = \pm 1$，我们总有 $D_g = D_f$。

为了发展更精细的理论（特别是与理想类群的联系），Gauss 引入了 **[真等价](@entry_id:635057) (proper equivalence)** 的概念，它只考虑那些保持“定向”的变换，即[行列式](@entry_id:142978)为 $+1$ 的矩阵。这些矩阵构成了 **[特殊线性群](@entry_id:139538) (Special Linear Group)** $\mathrm{SL}_2(\mathbb{Z})$。

**定义**：两个二次型 $f$ 和 $g$ 如果存在一个矩阵 $M \in \mathrm{SL}_2(\mathbb{Z})$ 使得 $g(x,y) = f(\alpha x + \beta y, \gamma x + \delta y)$，则称它们是 **[真等价](@entry_id:635057)的**。所有相互[真等价](@entry_id:635057)的二次型构成一个 **[真等价](@entry_id:635057)类 (proper equivalence class)**。

#### 本原二次型与类数

如果一个二次型的系数 $a, b, c$ 的[最大公约数](@entry_id:142947)是 $1$，即 $\gcd(a,b,c)=1$，则称该二次型是 **本原的 (primitive)**。如果 $\gcd(a,b,c)=d > 1$，那么 $f(x,y) = d \cdot f'(x,y)$，其中 $f'(x,y)$ 是一个判别式为 $D/d^2$ 的本原二次型。因此，对二次型的研究可以基本归结为对本原二次型的研究。等价变换保持了[本原性](@entry_id:145479)，因为如果 $d$ 整除 $a,b,c$，那么它也必然整除新二次型的系数 $a',b',c'$。

这就引出了数论中的一个核心定义：

**定义**：对于一个给定的非平方整数[判别式](@entry_id:174614) $D$，所有判别式为 $D$ 的本原二次型的[真等价](@entry_id:635057)类的数量，被称为该判别式的 **[类数](@entry_id:156164) (class number)**，记为 $h(D)$。

类数 $h(D)$ 是一个有限的数，这是一个深刻的结论。为了证明这一点并实际计算[类数](@entry_id:156164)，我们需要引入 Gauss 的约化理论。

### 正定[二次型的约化](@entry_id:636545)

从现在开始，我们专注于 **正定二次型**，即[判别式](@entry_id:174614) $D  0$ 且 $a > 0$ 的情形。

一个[等价类](@entry_id:156032)中包含了无穷多个二次型，我们希望从中挑选出一个“最简单”的、具有标准形式的代表元。这个过程被称为 **约化 (reduction)**。

**定义**：一个正定二次型 $f(x,y)=ax^2+bxy+cy^2$ 被称为 **约化的 (reduced)**，如果其系数满足以下不等式：
$$
|b| \le a \le c
$$
并且，为了保证代表元的唯一性，我们补充边界条件：
$$
\text{如果 } |b|=a \text{ 或 } a=c, \text{ 则 } b \ge 0.
$$

这个定义的美妙之处在于它同时保证了两件重要的事情：存在性和唯一性。

**定理 (高斯约化)**：每一个正定二次型都与 **唯一一个** 约化二次型[真等价](@entry_id:635057)。

这意味着，每个[真等价](@entry_id:635057)类中都恰好含有一个满足上述条件的约化形式。因此，计算[类数](@entry_id:156164) $h(D)$ 的问题，就转化为了一个具体的计数问题：找出所有判别式为 $D$ 的本原约化正定二次型。

#### 约化形式的有限性

为什么对于一个给定的 $D  0$，只有有限个约化二次型呢？答案就藏在约化不等式中。

对于一个约化的正定二次型，我们有 $|b| \le a$ 和 $a \le c$。将其代入判别式方程：
$$
-D = 4ac - b^2
$$
因为 $c \ge a$，所以 $4ac \ge 4a^2$。又因为 $|b| \le a$，所以 $b^2 \le a^2$。结合起来，我们得到一个关键的不等式：
$$
-D = 4ac - b^2 \ge 4a^2 - a^2 = 3a^2
$$
由于 $a$ 是正整数，这给出了系数 $a$ 的一个[上界](@entry_id:274738)：
$$
a \le \sqrt{\frac{-D}{3}}
$$
这个简单的上界是整个理论的基石。它告诉我们，对于一个固定的判别式 $D$，满足约化条件的二次型的第一个系数 $a$ 的可能取值是有限的。

一旦 $a$ 的取值被限定在有限范围内，根据约化条件 $|b| \le a$，系数 $b$ 的可能取值也是有限的。最后，系数 $c$ 由 $a, b, D$ 唯一确定：
$$
c = \frac{b^2 - D}{4a}
$$
我们只需验证这样得到的 $c$ 是否为整数且满足 $c \ge a$ 即可。

因此，通过一个简单的算法，我们可以穷举出所有可能存在的约化形式，从而证明其有限性。这个事实，结合高斯约化定理，立即推导出对于任何 $D  0$，类数 $h(D)$ 都是有限的。

### 类数及其计算

既然我们知道 $h(D)$ 是有限的，并且等于[判别式](@entry_id:174614)为 $D$ 的本原约化正定二次型的数量，我们就可以通过系统地搜索来计算它。

#### 计算 $h(D)$ 的算法

对于给定的 $D  0$（且 $D \equiv 0, 1 \pmod{4}$）：

1.  确定系数 $a$ 的范围：$1 \le a \le \sqrt{-D/3}$。
2.  对每一个 $a$ 的可[能值](@entry_id:187992)，确定系数 $b$ 的范围：$|b| \le a$。同时，由于 $D = b^2 - 4ac$，我们有 $b^2 \equiv D \pmod{4a}$。一个更简单的必要条件是 $b$ 和 $D$ 具有相同的奇偶性，即 $b \equiv D \pmod 2$。
3.  对于每一个符合条件的 $(a,b)$ 对，计算 $c = \frac{b^2 - D}{4a}$。
4.  检查所得到的 $(a,b,c)$ 三元组是否满足所有约化条件：
    *   $c$ 是整数吗？
    *   $a \le c$ 吗？
    *   边界条件（如果 $|b|=a$ 或 $a=c$，是否 $b \ge 0$）满足吗？
5.  最后，对所有找到的约化形式，检查其是否为本原的（即 $\gcd(a,b,c)=1$）。
6.  所有满足条件的本原约化形式的数量就是类数 $h(D)$。

#### 示例：计算 $h(-23)$

让我们应用这个算法来计算判别式 $D=-23$ 的[类数](@entry_id:156164)。这是一个重要的例子，因为它将具体展示上述步骤。

1.  **确定 $a$ 的范围**：
    $a \le \sqrt{-(-23)/3} = \sqrt{23/3} \approx \sqrt{7.67} \approx 2.77$。
    因此，正整数 $a$ 的可能值为 $1$ 和 $2$。

2.  **情况 1: $a=1$**
    *   $b$ 的范围：$|b| \le 1$，所以 $b \in \{-1, 0, 1\}$。
    *   $D=-23$ 是奇数，所以 $b$ 也必须是奇数。因此 $b$ 只可能是 $1$ 或 $-1$。
    *   若 $b=1$：计算 $c = \frac{1^2 - (-23)}{4(1)} = \frac{24}{4} = 6$。
        得到形式 $(1, 1, 6)$。我们检查约化条件：$|1| \le 1 \le 6$。满足。边界条件 $|b|=a$ 成立，要求 $b \ge 0$，而 $b=1$，满足。$\gcd(1,1,6)=1$，是本原的。所以 $x^2+xy+6y^2$ 是一个约化形式。
    *   若 $b=-1$：计算 $c = \frac{(-1)^2 - (-23)}{4(1)} = \frac{24}{4} = 6$。
        得到形式 $(1, -1, 6)$。检查约化条件：$|-1| \le 1 \le 6$。满足。但边界条件 $|b|=a$ 成立，要求 $b \ge 0$，而 $b=-1$，不满足。因此这不是一个约化形式。

3.  **情况 2: $a=2$**
    *   $b$ 的范围：$|b| \le 2$，所以 $b \in \{-2, -1, 0, 1, 2\}$。
    *   $b$ 必须是奇数，所以 $b$ 只可能是 $1$ 或 $-1$。
    *   若 $b=1$：计算 $c = \frac{1^2 - (-23)}{4(2)} = \frac{24}{8} = 3$。
        得到形式 $(2, 1, 3)$。检查约化条件：$|1| \le 2 \le 3$。满足。边界条件不适用。$\gcd(2,1,3)=1$，是本原的。所以 $2x^2+xy+3y^2$ 是一个约化形式。
    *   若 $b=-1$：计算 $c = \frac{(-1)^2 - (-23)}{4(2)} = \frac{24}{8} = 3$。
        得到形式 $(2, -1, 3)$。检查约化条件：$|-1| \le 2 \le 3$。满足。边界条件不适用。$\gcd(2,-1,3)=1$，是本原的。所以 $2x^2-xy+3y^2$ 是一个约化形式。

我们找到了三个不同的本原约化正定二次型，它们的判别式都是 $-23$：
1.  $x^2+xy+6y^2$
2.  $2x^2+xy+3y^2$
3.  $2x^2-xy+3y^2$

因此，我们得出结论：判别式为 $-23$ 的类数是 $h(-23)=3$。

### 深入探讨：自同构与[理想类群](@entry_id:153974)

二次型理论的优美之处在于它与其他数学分支的深刻联系。

#### 二次型的[自同构](@entry_id:155390)

一个二次型 $Q$ 的 **（真）[自同构群](@entry_id:139672) (automorphism group)** 是 $\mathrm{SL}_2(\mathbb{Z})$ 中使其保持不变的矩阵集合：
$$
\operatorname{Aut}^+(Q) = \{ M \in \mathrm{SL}_2(\mathbb{Z}) \mid Q \text{ 在 } M \text{ 的作用下不变} \}
$$
对于任何二次型，$Q$ 在 $-I$ ([单位矩阵](@entry_id:156724)的负) 作用下总是不变的，因为 $Q(-x, -y) = Q(x,y)$。所以 $\operatorname{Aut}^+(Q)$ 至少包含 $\{\pm I\}$ 这两个元素。

通过分析与二次型相关的[二次方程](@entry_id:163234)根的变换，可以证明 $\operatorname{Aut}^+(Q)$ 的元素个数 $w$ 由一个简单的丢番图方程的解的个数决定：
$$
t^2 - Du^2 = 4
$$
其中 $t$ 是[自同构](@entry_id:155390)矩阵的迹。由于我们关注的是 $D  0$ 的情况，该方程变为 $t^2 + |D|u^2 = 4$。这是一个[椭圆方程](@entry_id:169190)，其整数解 $(t,u)$ 的个数是有限的。

*   **一般情况**：如果 $|D| > 4$，方程唯一的整数解是 $u=0, t=\pm 2$。这对应于[自同构群](@entry_id:139672) $\operatorname{Aut}^+(Q) = \{\pm I\}$，其阶为 $w=2$。
*   **特殊情况**：
    *   如果 $D=-4$，方程为 $t^2+4u^2=4$，有解 $(t,u) = (\pm 2, 0)$ 和 $(0, \pm 1)$。这给出了一个阶为 $w=4$ 的[自同构群](@entry_id:139672)。其约化形式是 $x^2+y^2$，[自同构群](@entry_id:139672)由旋转 $90^\circ$ 的矩阵 $\begin{pmatrix} 0  -1 \\ 1  0 \end{pmatrix}$ 生成。
    *   如果 $D=-3$，方程为 $t^2+3u^2=4$，有解 $(t,u) = (\pm 2, 0)$ 和 $(\pm 1, \pm 1)$。这给出了一个阶为 $w=6$ 的[自同构群](@entry_id:139672)。其约化形式是 $x^2+xy+y^2$，[自同构群](@entry_id:139672)由旋转 $60^\circ$ 的矩阵生成。

[自同构群](@entry_id:139672)的大小解释了为什么高斯约化中需要补充边界条件来确保唯一性。在几何上，这些特殊判别式对应于具有额外对称性的格点（正方形格和正六边形格）。

#### 与[理想类群](@entry_id:153974)的对应关系

二次型理论最深刻的联系之一是它与代数数论中 **[理想类群](@entry_id:153974) (ideal class group)** 的关系。对于一个判别式为 $D$ 的二次型，我们可以构造一个与之关联的 **二次域 (quadratic field)** $\mathbb{Q}(\sqrt{D})$。在这个域中，有一个[代数结构](@entry_id:137052)称为 **序 (order)** $\mathcal{O}_D$，其[判别式](@entry_id:174614)也恰好是 $D$。

一个惊人的结果是，判别式为 $D$ 的本原正定二次型的[真等价](@entry_id:635057)类集合，与序 $\mathcal{O}_D$ 的 **[理想类群](@entry_id:153974)** 之间存在一个自然的、保持群结构的[一一对应](@entry_id:143935)关系。

这个对应关系可以通过一个具体的映射来描述：给定一个本原二次型 $f(x,y) = ax^2+bxy+cy^2$，它对应于包含以下 $\mathbb{Z}$-模的理想类：
$$
I_f = a\mathbb{Z} + \frac{-b+\sqrt{D}}{2}\mathbb{Z}
$$
可以证明，当 $f$ 是本原的时，这个模 $I_f$ 是一个 $\mathcal{O}_D$ 的可逆理想。反之，任何 $\mathcal{O}_D$ 的理想类都对应一个二次型的[等价类](@entry_id:156032)。这个[理想的范数](@entry_id:155476)（可以理解为一种“大小”）等于系数 $a$。

这个对应关系是现代数论的基石之一。它意味着，我们对二次型所做的具体、[组合性](@entry_id:637804)的计算（如计算[类数](@entry_id:156164) $h(D)$），实际上是在揭示二次数域深层的[代数结构](@entry_id:137052)。例如，二次型的复合定律（由 Gauss 发现）正是在这种对应关系下理想的乘法运算的体现。通过这个视角，二次型理论从一系列巧妙的计算技巧，[升华](@entry_id:139006)为[代数数论](@entry_id:148067)宏伟画卷中不可或缺的一部分。