## 引言
将一个整数表示为两个平方之和，是数论中一个经典而迷人的问题。几个世纪以来，数学家们一直在探寻一个普适的法则，以判定哪些数字拥有这种特殊属性，并找出其具体的表示方法。传统整数论的方法虽然能提供一些线索，但缺乏一个能够解释其背后深层结构的统一理论。本文正是为了填补这一空白，通过引入一个强大的代数工具——[高斯整数环](@entry_id:149594)，为这一古老问题提供了完整而优美的解决方案。

在接下来的内容中，读者将踏上一段从理论到实践的探索之旅。在“原则与机制”一章中，我们将建立[高斯整数环](@entry_id:149594)的基本框架，理解范数、唯一分解等核心概念如何将平方和问题转化为代数问题。随后的“应用与跨学科联系”一章将展示这些理论的实际威力，学习如何判定、构造和计数平方和的表示，并探索其与几何学、计算理论的深刻联系。最后，通过“动手实践”环节，你将有机会亲自运用这些知识来解决具体问题，从而巩固所学。让我们一同走进[高斯整数](@entry_id:149548)的世界，揭示隐藏在平方和问题背后的代数之美。

## 原则与机制

将一个整数表示为两个平方和的问题，是数论中最经典和最优雅的问题之一。其完整的解决方案，巧妙地利用了我们熟悉的[整数环](@entry_id:181003) $\mathbb{Z}$ 的一个优美扩展——[高斯整数环](@entry_id:149594) $\mathbb{Z}[i]$。本章将深入探讨解决该问题所依赖的核心原则与机制，揭示[代数结构](@entry_id:137052)如何为算术问题提供深刻的洞见。

### [高斯整数环](@entry_id:149594)：一个新的视角

为了超越传统整数论的限制，我们引入**[高斯整数](@entry_id:149548) (Gaussian integers)** 的集合，记为 $\mathbb{Z}[i]$。它由所有形式为 $a+bi$ 的复数构成，其中 $a$ 和 $b$ 是整数，$i$ 是虚数单位，满足 $i^2=-1$。容易验证，高斯整数在复数的加法和乘法下构成一个环，称为**[高斯整数环](@entry_id:149594)**。

这个新结构的关键工具是**范数 (norm)** 函数 $N: \mathbb{Z}[i] \to \mathbb{Z}_{\ge 0}$，其定义为 $N(a+bi) = a^2+b^2$。几何上，一个[高斯整数的范数](@entry_id:155420)是它到复平面原点距离的平方。这个简单的函数建立了一座至关重要的桥梁：一个正整数 $n$ 能被写成两个整数的平方和，当且仅当它是一个[高斯整数的范数](@entry_id:155420)。
$$
n = a^2 + b^2 \iff n = N(a+bi)
$$
这个[等价关系](@entry_id:138275)将一个关于整数的丢番图方程问题，转化为了一个在[高斯整数环](@entry_id:149594)中寻找特定范数的元素的问题。

范数函数一个极其重要的性质是它的**乘法性**，即对于任意两个[高斯整数](@entry_id:149548) $z_1, z_2 \in \mathbb{Z}[i]$，我们有 $N(z_1z_2) = N(z_1)N(z_2)$。这个性质可以直接通过[复数乘法](@entry_id:167843)和共轭的定义来验证。设 $z_1 = a+bi$ 和 $z_2 = c+di$，我们知道 $N(z) = z\overline{z}$。因此：
$$
N(z_1)N(z_2) = (z_1\overline{z_1})(z_2\overline{z_2}) = (z_1z_2)(\overline{z_1z_2}) = N(z_1z_2)
$$
这个性质引出了一个直接的推论：两个可以表示为[两平方和](@entry_id:634766)的整数的乘积，本身也可以表示为[两平方和](@entry_id:634766)。这被称为**婆罗摩笈多－斐波那契恒等式 (Brahmagupta-Fibonacci identity)**。具体来说，如果我们有两个和 $n_1=a^2+b^2$ 和 $n_2=c^2+d^2$，我们可以将它们看作 $N(a+bi)$ 和 $N(c+di)$。它们的乘积是：
$$
n_1n_2 = N(a+bi)N(c+di) = N((a+bi)(c+di)) = N((ac-bd) + i(ad+bc)) = (ac-bd)^2 + (ad+bc)^2
$$
这个恒等式表明，能够表示为[两平方和](@entry_id:634766)的整数集合在乘法下是封闭的 [@problem_id:3089709]。这使我们能够将问题分解，只需研究素数及其幂次何时能表示为[两平方和](@entry_id:634766)。

### [高斯整数环](@entry_id:149594)中的[唯一分解](@entry_id:152313)

$\mathbb{Z}[i]$ 的威力不仅在于范数，更在于其优美的[代数结构](@entry_id:137052)。可以证明，$\mathbb{Z}[i]$ 是一个**[欧几里得整环](@entry_id:155029) (Euclidean Domain)**，这意味着我们可以在其中进行[带余除法](@entry_id:156013)。一个重要的推论是，任何[欧几里得整环](@entry_id:155029)都是一个**唯一分解环 (Unique Factorization Domain, UFD)**。这表明，类似于整数可以唯一地分解为素数的乘积，[高斯整数](@entry_id:149548)也可以唯一地分解为**[高斯素数](@entry_id:156770) (Gaussian primes)** 的乘积，直到因子的顺序和**单位 (units)** 的不同。

在深入分解之前，我们必须明确环中的基本元素：
- **单位 (Units)**：在环中具有乘法[逆元](@entry_id:140790)的元素。在[高斯整数环](@entry_id:149594)中，一个元素 $u=a+bi$ 是单位当且仅当其范数 $N(u)=1$。这要求 $a^2+b^2=1$，对于整数 $a,b$，只有四组解：$(\pm 1, 0)$ 和 $(0, \pm 1)$。因此，$\mathbb{Z}[i]$ 的单位只有四个：$\{1, -1, i, -i\}$ [@problem_id:3090015]。

- **相伴元 (Associates)**：如果两个高斯整数 $z_1, z_2$ 满足 $z_1=uz_2$，其中 $u$ 是一个单位，则它们互为相伴元。由于有四个单位，任何一个非零的[高斯整数](@entry_id:149548)都有四个不同的相伴元：$\{\pi, -\pi, i\pi, -i\pi\}$ [@problem_id:3090015]。这个“四倍”的对称性是解释平方和表示数量公式中因子 4 的来源 [@problem_id:3090029]。

- **[高斯素数](@entry_id:156770) (Gaussian Primes)**：一个非零、非单位的[高斯整数](@entry_id:149548) $\pi$，如果它的因子只能是其相伴元或单位，那么它就是不可约的。由于 $\mathbb{Z}[i]$ 是唯一分解环，这里的不可约元和素数是等价的。

唯一分解性质是解决问题的关键，因为它允许我们将整数 $n$ 在 $\mathbb{Z}$ 中的分解，与[高斯整数](@entry_id:149548) $\alpha$ (其中 $N(\alpha)=n$) 在 $\mathbb{Z}[i]$ 中的分解联系起来 [@problem_id:3090017]。

### 有理素数在[高斯整数环](@entry_id:149594)中的行为

理解了 $\mathbb{Z}[i]$ 的结构后，核心机制在于研究我们熟悉的**有理素数** (即 $\mathbb{Z}$ 中的素数 $2, 3, 5, \dots$) 在 $\mathbb{Z}[i]$ 中是如何分解的。它们的行为分为三种情况，这构成了整个理论的基石 [@problem_id:3089682]：

1.  **素数 2 (分歧, ramifies)**：素数 2 在 $\mathbb{Z}[i]$ 中不再是素数。它可以被分解为 $2 = (1+i)(1-i)$。注意到 $1-i = -i(1+i)$，所以 $1+i$ 和 $1-i$ 是相伴元。因此，我们可以写出 $2 = -i(1+i)^2$。这表明 2 是一个[高斯素数](@entry_id:156770) $(1+i)$ 的平方（乘上一个单位）。[高斯素数](@entry_id:156770) $1+i$ 的范数是 $N(1+i)=1^2+1^2=2$。这直接告诉我们 $2$ 是一个[两平方和](@entry_id:634766)：$2=1^2+1^2$ [@problem_id:3090033]。

2.  **形如 $p \equiv 1 \pmod{4}$ 的素数 (分裂, splits)**：所有形如 $4k+1$ 的有理素数在 $\mathbb{Z}[i]$ 中都变得可以分解。它们会分裂成一对互为共轭但非相伴的[高斯素数](@entry_id:156770) $\pi$ 和 $\overline{\pi}$ 的乘积：$p = \pi \overline{\pi}$。取范数可得 $N(p) = p^2 = N(\pi)N(\overline{\pi})$。由于 $\pi$ 和 $\overline{\pi}$ 都不是单位，它们的范数必须大于 1，因此 $N(\pi)=N(\overline{\pi})=p$。设 $\pi=a+bi$，那么 $p = N(a+bi) = a^2+b^2$。这表明所有形如 $4k+1$ 的素数都可以表示为两个平方的和 [@problem_id:3090038]。例如，$5=(2+i)(2-i)$，范数为 $N(2+i)=2^2+1^2=5$。

3.  **形如 $q \equiv 3 \pmod{4}$ 的素数 (惰性, inert)**：所有形如 $4k+3$ 的有理素数在 $\mathbb{Z}[i]$ 中保持其素数地位，它们是**惰性**的。这意味着它们在 $\mathbb{Z}[i]$ 中不可分解。因此，不存在范数为 $q$ 的高斯整数，因为如果存在 $N(a+bi)=q$，那么 $q$ 就可以分解为 $(a+bi)(a-bi)$，这与它的惰性矛盾。因此，任何形如 $4k+3$ 的素数都不能表示为两个平方的和 [@problem_id:3090038]。

这一分类不仅解释了哪些素数是[两平方和](@entry_id:634766)，也为我们提供了[高斯素数](@entry_id:156770)的完整列表（除去相伴元）：
- $1+i$ (范数为 2)
- 形如 $a+bi$ 的[高斯整数](@entry_id:149548)，其中 $a^2+b^2=p$ 且 $p \equiv 1 \pmod{4}$ 是有理素数。
- 形如 $q$ 的有理素数，其中 $q \equiv 3 \pmod{4}$。

### [费马平方和定理](@entry_id:198081)的证明

有了上述工具，我们现在可以完整地陈述并证明关于整数表示为[两平方和](@entry_id:634766)的[费马定理](@entry_id:140206)。

**定理 ([费马平方和定理](@entry_id:198081))**：一个正整数 $n$ 可以表示为两个整数的平方和，当且仅当在 $n$ 的[素数分解](@entry_id:198620)中，所有形如 $q \equiv 3 \pmod{4}$ 的素数因子都具有偶数次幂 [@problem_id:3081207] [@problem_id:3090028]。

**证明的必要性 (“only if” part)**：
假设 $n = a^2+b^2$。我们要证明对于任意素数 $q \equiv 3 \pmod{4}$，它在 $n$ 的素数分解中的指数 $v_q(n)$ 必须是偶数。
我们将 $n$ 看作 $N(a+bi) = (a+bi)(a-bi)$。根据前述分析，我们知道 $q$ 在 $\mathbb{Z}[i]$ 中是[惰性素数](@entry_id:196337)。由于 $\mathbb{Z}[i]$ 是[唯一分解](@entry_id:152313)环，素数 $q$ 满足[欧几里得引理](@entry_id:261512)：如果 $q$ 整除一个乘积，它必然整除其中一个因子。
因为 $q | n = (a+bi)(a-bi)$，所以 $q | (a+bi)$ 或者 $q | (a-bi)$。
如果 $q | (a+bi)$，那么存在高斯整数 $c+di$ 使得 $a+bi = q(c+di) = qc+qdi$。比较实部和虚部，我们得到 $a=qc$ 和 $b=qd$。这意味着 $q$ 同时整除 $a$ 和 $b$。
因此，$a^2$ 和 $b^2$ 都能被 $q^2$ 整除，所以 $n=a^2+b^2$ 也能被 $q^2$ 整除。
这表明，只要 $q|n$，那么必然有 $q^2|n$。我们可以将这个论证应用于 $n/q^2$，如此重复下去，直到 $q$ 不再是因子为止。这强制要求 $q$ 在 $n$ 的分解中的总指数必须是偶数。这一步的论证是[唯一分解](@entry_id:152313)性质最关键的应用之一 [@problem_id:3090017] [@problem_id:3089682]。

**证明的充分性 (“if” part)**：
假设 $n$ 的[素数分解](@entry_id:198620)为 $n=2^\alpha \prod p_i^{e_i} \prod q_j^{2f_j}$，其中 $p_i \equiv 1 \pmod{4}$，$q_j \equiv 3 \pmod{4}$。我们要证明 $n$ 是一个[两平方和](@entry_id:634766)。
利用范数的乘法性，我们只需证明 $n$ 的每一个素数幂因子都是一个范数（即一个[两平方和](@entry_id:634766)）即可。
- 对于因子 $2^\alpha$：我们知道 $2 = N(1+i)$，所以 $2^\alpha = N((1+i)^\alpha)$，它是一个范数 [@problem_id:3090030]。
- 对于因子 $p_i^{e_i}$：我们知道 $p_i$ 是一个范数（因为 $p_i \equiv 1 \pmod 4$），设 $p_i=N(\pi_i)$。那么 $p_i^{e_i} = N(\pi_i)^{e_i} = N(\pi_i^{e_i})$，它也是一个范数。
- 对于因子 $q_j^{2f_j}$：$q_j$ 本身不是范数，但 $q_j^2=N(q_j)$ 是一个范数。因此 $q_j^{2f_j} = (q_j^2)^{f_j} = N(q_j)^{f_j} = N(q_j^{f_j})$，它也是一个范数。

既然 $n$ 的所有因子都是范数，那么它们的乘积 $n$ 也必定是一个范数，因为范数是乘性的。
$n = N((1+i)^\alpha) \prod N(\pi_i^{e_i}) \prod N(q_j^{f_j}) = N\left( (1+i)^\alpha \prod \pi_i^{e_i} \prod q_j^{f_j} \right)$。
因此，$n$ 是一个[高斯整数的范数](@entry_id:155420)，故可以表示为两个平方的和 [@problem_id:3090028]。

### 构造与计数表示法

高斯整数的理论不仅提供了[存在性证明](@entry_id:267253)，还给出了构造和计数表示法的具体方法。

**构造表示法**
要找到 $n=a^2+b^2$ 的一个解，我们可以遵循充分性证明的思路：为 $n$ 的每个素数幂因子找到一个对应的高斯整数，然后将这些高斯整数相乘。乘积的实部和虚部就给出了 $a$ 和 $b$ 的一组解。
以 $n=130$ 为例 [@problem_id:3090018]。它的素数分解是 $130 = 2 \cdot 5 \cdot 13$。
- $2 = 1^2+1^2 = N(1+i)$
- $5 = 1^2+2^2 = N(1+2i)$ (我们也可以选择 $2+i$)
- $13 = 2^2+3^2 = N(2+3i)$ (我们也可以选择 $3+2i$)

现在我们把这些[高斯整数](@entry_id:149548)乘起来：
$$
(1+i)(1+2i)(2+3i) = (-1+3i)(2+3i) = (-2-9) + i(-3+6) = -11+3i
$$
这个结果的范数是 $N(-11+3i) = (-11)^2+3^2 = 121+9=130$。因此，我们找到了一个表示：$130 = (-11)^2+3^2$。如果我们在选择因子时做出不同选择（例如，使用 $2+i$ 代替 $1+2i$），我们可能会得到不同的表示，例如 $130 = 9^2+7^2$。

**计数表示法**
$r_2(n)$ 函数计算将 $n$ 表示为两个有序整数平方和的方法数（计算符号和顺序）。例如，$r_2(5)=8$，因为有 $(\pm 1, \pm 2)$ 和 $(\pm 2, \pm 1)$ 共八对。
$r_2(n)$ 的值等于范数为 $n$ 的[高斯整数](@entry_id:149548) $\alpha$ 的数量。通过分析 $\alpha$ 在 $\mathbb{Z}[i]$ 中的[唯一分解](@entry_id:152313)，我们可以推导出 $r_2(n)$ 的精确公式 [@problem_id:3090048]。

若 $n$ 的素数分解中有任何一个 $q \equiv 3 \pmod 4$ 的素数因子具有奇数次幂，则 $r_2(n)=0$。
否则，一个范数为 $n$ 的高斯整数 $\alpha$ 必须具有以下形式：
$$
\alpha = U \cdot (1+i)^{v_2(n)} \cdot \prod_{q_j} q_j^{v_{q_j}(n)/2} \cdot \prod_{p_i} \pi_i^{c_i} \overline{\pi_i}^{v_{p_i}(n)-c_i}
$$
其中 $v_p(n)$ 是 $p$ 在 $n$ 中的指数，$U$ 是四个单位之一，对于每个 $p_i \equiv 1 \pmod 4$ 的素数，指数 $c_i$ 可以取 $0, 1, \dots, v_{p_i}(n)$ 中的任意一个值。
因此，不同 $\alpha$ 的数量为：
- 4 种选择（来自单位 $U$）。
- $\prod (v_{p_i}(n)+1)$ 种选择（来自 $p_i$ 型素数的指数分配）。

综上，我们得到公式：
$$
r_2(n) = 4 \prod_{p \equiv 1 \pmod{4}} (1+v_p(n))
$$
其中该公式仅在所有 $v_q(n)$ (对于 $q \equiv 3 \pmod 4$) 均为偶数时适用，否则 $r_2(n)=0$ [@problem_id:3090048]。

这个公式可以被更优雅地写成一个涉及**[狄利克雷特征](@entry_id:151586) (Dirichlet character)** 的形式。令 $\chi$ 是模 4 的非主特征，定义为 $\chi(d)=1$ 如果 $d \equiv 1 \pmod 4$，$\chi(d)=-1$ 如果 $d \equiv 3 \pmod 4$，以及 $\chi(d)=0$ 如果 $d$ 是偶数。那么，可以证明对于所有 $n \ge 1$：
$$
r_2(n) = 4\sum_{d|n}\chi(d)
$$
这个公式简洁地包含了上述所有情况 [@problem_id:3090048]。例如，$n=2^k$ 的情况，除数是 $1, 2, 4, \dots, 2^k$。$\chi(1)=1$，而所有其他除数的 $\chi$ 值为 0。因此 $r_2(2^k) = 4\chi(1)=4$。这意味着对于任意 $k \ge 1$, $a^2+b^2=2^k$ 恰好有 4 个整数解。当 $k$ 为奇数时，它们是 $(\pm 2^{(k-1)/2}, \pm 2^{(k-1)/2}})$；当 $k$ 为偶数时，它们是 $(\pm 2^{k/2}, 0)$ 和 $(0, \pm 2^{k/2})$ [@problem_id:3090033]。

通过引入[高斯整数环](@entry_id:149594)，一个看似简单的算术问题展现了其背后深刻的[代数结构](@entry_id:137052)。范数、唯一分解以及有理素数的不同行为共同构成了解决问题的完整机制，这正是[代数数论](@entry_id:148067)魅力的完美体现。