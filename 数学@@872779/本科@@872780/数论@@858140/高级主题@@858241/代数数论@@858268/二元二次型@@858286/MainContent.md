## 引言
二元二次型是数论中最古老也最核心的研究对象之一，其理论由费马、拉格朗日、特别是高斯奠定，是连接初等数论与[代数数论](@entry_id:148067)的桥梁。乍看之下，$ax^2+bxy+cy^2$ 形式简单，但其背后关于整数表示的规律却异常复杂和深刻。如何系统地对这些二次型进行分类，并揭示它们所表示整数的内在规律，是数论长久以来试图解决的核心问题。

本文将带领读者深入探索二元二次型的优美世界。在“原理和机制”一章中，我们将学习二次型的基本定义、判别式、等价与约化理论，并最终理解其核心概念——类群。接下来，在“应用与交叉学科联系”中，我们将看到这些理论如何被应用于解决经典的整数表示问题、如何与代数数论中的理想类群建立深刻联系，并一窥其在几何与分析领域的延伸。最后，“动手实践”部分将提供具体问题，帮助读者巩固理论知识并将其付诸实践。

## 原理和机制

### 二次型的基本定义

数论中的二元二次型理论，其根源可追溯至费马、拉格朗日、勒让德和高斯的经典著作，研究的是整系数二元二次[齐次多项式](@entry_id:178156)。理解其基本原理和机制，是深入探索[代数数论](@entry_id:148067)的基石。

#### 代数形式及其记法

一个**整系数二元二次型** (integral binary quadratic form) 是一个关于变量 $x$ 和 $y$ 的函数 $Q(x,y)$，其形式为：
$$Q(x,y) = ax^2 + bxy + cy^2$$
其中系数 $a$、$b$、$c$ 均为整数 ($a, b, c \in \mathbb{Z}$) [@problem_id:3082304]。这个函数将整数格点 $\mathbb{Z}^2$ 上的每一对整数 $(x,y)$ 映射到一个整数。为了简洁地表示一个二次型，我们通常使用其系数构成的有序三元组 $[a,b,c]$。这个记法中的顺序至关重要，它明确地指定了 $a$ 是 $x^2$ 的系数，$b$ 是 $xy$ 的系数，$c$ 是 $y^2$ 的系数。例如，二次型 $f(x,y) = x^2 + 5y^2$ 记作 $[1,0,5]$，而二次型 $g(x,y) = 5x^2 + y^2$ 则记作 $[5,0,1]$。这两个二次型是截然不同的，因为它们表示的整数集合也不同。

#### [判别式](@entry_id:174614)与二次型的分类

对于一个二次型 $f(x,y) = ax^2 + bxy + cy^2$，其最重要的[不变量](@entry_id:148850)之一是**判别式** (discriminant)，定义为：
$$D = b^2 - 4ac$$
[判别式](@entry_id:174614) $D$ 的符号决定了二次型在[实数域](@entry_id:151347) $\mathbb{R}$ 上的基本性质，从而将其分为三类 [@problem_id:3089557]。我们可以通过[配方法](@entry_id:265480)来理解这一点。假设 $a \neq 0$，我们有：
$$f(x,y) = a\left(x + \frac{b}{2a}y\right)^2 + \frac{4ac - b^2}{4a}y^2 = \frac{1}{4a}\left((2ax+by)^2 - Dy^2\right)$$

1.  **定型 (Definite Forms)**: 当 $D  0$ 时，$-D > 0$。表达式 $(2ax+by)^2 - Dy^2$ 是两个平方项之和（乘以正常数），因此它总是非负的，并且仅当 $x=y=0$ 时取零。这意味着 $f(x,y)$ 的符号完全由系数 $a$ 的符号决定。此时，二次型被称为**定型**。
    *   如果 $a>0$，则 $f(x,y)$ 对所有非零整数对 $(x,y)$ 恒为正，称为**正定二次型** (positive definite form)。例如，$f_1(x,y) = x^2+xy+y^2$ 的[判别式](@entry_id:174614)为 $D = 1^2 - 4(1)(1) = -3  0$，且 $a=1>0$，因此它是正定的 [@problem_id:3089557]。
    *   如果 $a0$，则 $f(x,y)$ 恒为负，称为**负定二次型** (negative definite form)。值得注意的是，若 $D  0$，则 $b^2  4ac$，这意味着 $ac > 0$，所以 $a$ 和 $c$ 必须同号。

2.  **[不定型](@entry_id:150990) (Indefinite Forms)**: 当 $D > 0$ 时，表达式 $(2ax+by)^2 - Dy^2$ 可以取正值、负值或零。例如，当 $y=1$ 时，其值为 $(2ax+b)^2 - D$，我们可以通过改变 $x$ 的值使其取任意符号。因此，该二次型被称为**[不定型](@entry_id:150990)**。例如，$f_2(x,y) = x^2-3xy+y^2$ 的[判别式](@entry_id:174614)为 $D = (-3)^2 - 4(1)(1) = 5 > 0$，它是一个[不定型](@entry_id:150990)二次型 [@problem_id:3089557]。

3.  **退化型 (Degenerate Forms)**: 当 $D = 0$ 时，二次型可以写成 $f(x,y) = \frac{1}{4a}(2ax+by)^2$。这意味着二次型可以在非零点 $(x,y)$ 上取值为零（即满足 $2ax+by=0$ 的所有点）。这类二次型被称为**退化型**或**半定型**。例如，$f_3(x,y) = x^2+2xy+y^2 = (x+y)^2$ 的判别式为 $D = 2^2 - 4(1)(1) = 0$，它是一个退化型 [@problem_id:3089557]。

在二次型的研究中，我们主要关注非退化的情形，即 $D$ 不是一个[完全平方数](@entry_id:635622)。同时，可以证明任何[二次型的判别式](@entry_id:637247)模4必为0或1，即 $D \equiv 0, 1 \pmod{4}$。

#### [本原性](@entry_id:145479)与含量

另一个基本概念是二次型的**含量** (content)。对于二次型 $f(x,y) = ax^2 + bxy + cy^2$，其含量定义为其系数的最大公约数，即 $d = \gcd(a,b,c)$。如果一个二次型的含量 $d=1$，则称该二次型为**本原二次型** (primitive form) [@problem_id:3082339]。

含量有一个重要的性质：它等于该二次型所能表示的所有整数值的最大公约数。我们可以证明这一点：
一方面，由于 $d$ 是 $a,b,c$ 的公约数，对于任意整数 $m,n$，值 $f(m,n) = am^2 + bmn + cn^2$ 显然是 $d$ 的倍数。
另一方面，二次型可以表示其系数 $a$ 和 $c$（分别通过取 $(x,y)=(1,0)$ 和 $(x,y)=(0,1)$），并且可以表示 $a+b+c$（通过取 $(x,y)=(1,1)$）。因此，所有表示值的最大公约数必然整除 $a$, $c$ 和 $(a+b+c)-a-c = b$。这意味着它也必须整除 $d = \gcd(a,b,c)$。
综上，含量 $d$ 正是该二次型所表示的整数集合的[最大公约数](@entry_id:142947) [@problem_id:3082339]。

如果一个二次型的含量 $d > 1$，我们可以将其写作 $f(x,y) = d \cdot f_{\text{prim}}(x,y)$，其中 $f_{\text{prim}}(x,y) = (a/d)x^2 + (b/d)xy + (c/d)y^2$ 是一个本原二次型。需要注意的是，$f$ 和 $f_{\text{prim}}$ 的[判别式](@entry_id:174614)不同。若 $f$ 的[判别式](@entry_id:174614)为 $D$，则 $f_{\text{prim}}$ 的[判别式](@entry_id:174614)为 $D/d^2$。因此，为了系统地研究二次型，通常的做法是首先关注本原二次型。

一个常见的误解是，本原二次型必须能表示 $1$ 或 $-1$。虽然能表示 $\pm 1$ 的二次型一定是本原的（因为其表示值的最大公约数必然是1），但反之不成立。例如，正定二次型 $f(x,y) = 2x^2+2xy+3y^2$ 是本原的，因为 $\gcd(2,2,3)=1$。然而，通过[配方法](@entry_id:265480)可知 $f(x,y) = \frac{1}{2}((2x+y)^2+5y^2)$，其在整数上能取到的最小非零值为 $f(0,1)=3$。因此它无法表示 $\pm 1$ [@problem_id:3082339]。

### 等价与约化

二次型理论的核心思想之一是对其进行分类。仅仅通过判别式进行分类是不够的，因为具有相同判别式的二次型也可能表现出不同的性质。一个更精细的分类工具是**等价** (equivalence) 的概念。

#### [线性变换](@entry_id:149133)的作用

我们可以对二次型的变量 $(x,y)$ 进行一个可逆的整系数线性变换：
$$ \begin{pmatrix} x \\ y \end{pmatrix} \mapsto \begin{pmatrix} p  q \\ r  s \end{pmatrix} \begin{pmatrix} x' \\ y' \end{pmatrix} = \begin{pmatrix} px'+qy' \\ rx'+sy' \end{pmatrix} $$
其中 $p, q, r, s$ 均为整数。这个变换将一个二次型 $f(x,y)$ 转换为一个新的二次型 $g(x',y') = f(px'+qy', rx'+sy')$。为了使变换可逆且逆变换也具有整系数，变换矩阵 $M = \begin{pmatrix} p  q \\ r  s \end{pmatrix}$ 的[行列式](@entry_id:142978)必须是 $\pm 1$。所有这样的矩阵构成了一个群，称为**[一般线性群](@entry_id:141275)** $GL_2(\mathbb{Z})$。

#### 等价与[正常等价](@entry_id:635057)

如果两个二次型可以通过 $GL_2(\mathbb{Z})$ 中的某个矩阵相互转换，则称它们是**等价的**。一个更精细的概念是**[正常等价](@entry_id:635057)** (properly equivalent)，它要求变换[矩阵的[行列](@entry_id:148198)式](@entry_id:142978)必须为 $+1$。所有[行列式](@entry_id:142978)为 $+1$ 的矩阵构成了 $GL_2(\mathbb{Z})$ 的一个[子群](@entry_id:146164)，称为**[特殊线性群](@entry_id:139538)** $SL_2(\mathbb{Z})$ [@problem_id:3089549]。

在变量变换下，新二次型 $g(x',y')=a'(x')^2+b'x'y'+c'(y')^2$ 的系数可以通过代数展开得到：
$$ a' = ap^2 + bpr + cr^2 $$
$$ b' = 2apq + b(ps+qr) + 2crs $$
$$ c' = aq^2 + bqs + cs^2 $$
一个至关重要的事实是，[二次型的判别式](@entry_id:637247)在 $GL_2(\mathbb{Z})$ 变换下是**[不变量](@entry_id:148850)** [@problem_id:3089549]。也就是说，如果 $f$ 和 $g$ 等价，它们的判别式必然相同。同样，二次型的含量在 $GL_2(\mathbb{Z})$ 变换下也是[不变量](@entry_id:148850) [@problem_id:3082339]。

因此，数论学家的目标是将具有相同[判别式](@entry_id:174614)和含量的所有本原二次型，按照[正常等价](@entry_id:635057)关系划分成不同的**等价类** (equivalence classes)。

#### 正定[二次型的约化](@entry_id:636545)

为了给每个等价类找到一个唯一的、简单的“代表”，高斯引入了**约化** (reduction) 的概念。对于正定二次型 ($D0, a>0$)，一个二次型 $[a,b,c]$ 被称为是**约化的** (reduced)，如果其系数满足以下条件 [@problem_id:3083532]：
$$ |b| \le a \le c $$
并且，当等号成立时（即 $|b|=a$ 或 $a=c$），还需满足 $b \ge 0$。

这些看似武断的条件，其背后有深刻的几何和代数动机。约化过程本质上是在[等价类](@entry_id:156032)中寻找一个“最小”的代表。这个过程可以通过 $SL_2(\mathbb{Z})$ 的两个基本变换（生成元）来完成：
1.  **[剪切变换](@entry_id:151272) (Shear)**：由矩阵 $T_k = \begin{pmatrix} 1  k \\ 0  1 \end{pmatrix}$ ($k \in \mathbb{Z}$) 表示。它将二次型 $[a,b,c]$ 变换为 $[a, b+2ak, c']$。通过选择合适的整数 $k$，我们总可以使得新的中间系数 $b'$ 满足 $|b'| \le a$。
2.  **反演变换 (Inversion)**：由矩阵 $S = \begin{pmatrix} 0  -1 \\ 1  0 \end{pmatrix}$ 表示。它将二次型 $[a,b,c]$ 变换为 $[c, -b, a]$。如果经过第一步后，我们发现 $a>c$，我们就应用此变换，交换首末系数，然后再次进行[剪切变换](@entry_id:151272)。

这个过程保证会终止，因为每次应用 $S$ 变换后，首项系数 $a$ 会减小（或者在 $a=c$ 时保持不变），而正整数不能无限减小。最终，我们会得到一个同时满足 $|b| \le a$ 和 $a \le c$ 的二次型。附加的边界条件 $b \ge 0$ 是为了处理一些特殊情况，确保每个等价类只对应**唯一一个**约化形式。这个过程相当于在与二次型相关的复数[上半平面](@entry_id:199119)中，为其[轨道](@entry_id:137151)寻找一个[基本域](@entry_id:201756)内的唯一代表点 [@problem_id:3083532]。

### 类数与整数表示

#### [等价类](@entry_id:156032)的有限性

约化理论的一个惊人推论是：对于一个给定的负判别式 $D0$，只有**有限个**本原正定约化二次型。这可以通过约化条件推导出对系数的严格约束 [@problem_id:3083533]。

对于一个约化形式 $[a,b,c]$，我们有 $D = b^2 - 4ac$。由于 $D0$，可以写成 $-D = 4ac - b^2$。结合约化条件 $|b| \le a$ 和 $a \le c$，我们得到：
$$ -D = 4ac - b^2 \ge 4a(a) - a^2 = 3a^2 $$
这意味着 $a^2 \le -D/3$，从而得到 $a$ 的一个[上界](@entry_id:274738)：
$$ a \le \sqrt{\frac{-D}{3}} $$
由于 $a$ 是正整数，所以 $a$ 的可能取值是有限的。对于每个可能的 $a$，条件 $|b| \le a$ 意味着 $b$ 的可能取值也是有限的。而 $c$ 由 $a,b,D$ 唯一确定 ($c = (b^2-D)/(4a)$)。因此，我们只需在一个有限的集合中搜索，就可以找出所有满足条件的约化形式。

#### [类数](@entry_id:156164)

对于一个给定的[判别式](@entry_id:174614) $D0$，本原正定二次型的[正常等价](@entry_id:635057)类的数目是一个重要的[不变量](@entry_id:148850)，称为**类数** (class number)，记作 $h(D)$。由于每个[等价类](@entry_id:156032)中有且仅有一个约化形式，所以类数 $h(D)$ 就等于具有该判别式的本原正定约化形式的个数 [@problem_id:3082326]。

我们可以通过穷举所有满足条件的系数来计算类数。例如，我们来计算 $D=-20$ 的类数 $h(-20)$ [@problem_id:3082326]。
一个本原正定约化二次型 $[a,b,c]$ 必须满足 $b^2 - 4ac = -20$ 且 $|b| \le a \le c$。
1.  由 $a \le \sqrt{-(-20)/3} = \sqrt{20/3} \approx 2.58$，可知 $a$ 的可能值为 $1, 2$。
2.  由 $b^2 = 4ac-20$ 可知 $b^2$ 必须是偶数，所以 $b$ 必须是偶数。
3.  **当 $a=1$ 时**：$|b| \le 1$ 且 $b$ 为偶数，所以 $b=0$。此时 $c = (0^2 - (-20))/(4 \cdot 1) = 5$。我们得到三元组 $[1,0,5]$。它满足约化条件 $|0| \le 1 \le 5$，且是本原的 ($\gcd(1,0,5)=1$)。这是一个约化形式。
4.  **当 $a=2$ 时**：$|b| \le 2$ 且 $b$ 为偶数，所以 $b$ 的可[能值](@entry_id:187992)为 $0, \pm 2$。
    *   若 $b=0$, $c=(0^2+20)/8$ 不是整数。
    *   若 $b=2$, $c=(2^2+20)/8 = 3$。得到三元组 $[2,2,3]$。它满足约化条件 $|2| \le 2 \le 3$，边界条件 $|b|=a$ 要求 $b \ge 0$，这里 $b=2$ 满足。它也是本原的 ($\gcd(2,2,3)=1$)。这是一个约化形式。
    *   若 $b=-2$, $c=((-2)^2+20)/8 = 3$。得到三元组 $[2,-2,3]$。但它不满足边界条件 $b \ge 0$。

综上，[判别式](@entry_id:174614)为 $-20$ 的本原正定约化二次型只有两种：$[1,0,5]$ (即 $x^2+5y^2$) 和 $[2,2,3]$ (即 $2x^2+2xy+3y^2$)。因此，[类数](@entry_id:156164) $h(-20)=2$。

#### 二次型表示整数

二次型理论的一个核心问题是：一个给定的整数 $n$ 能否被某个二次型 $f(x,y)$ **表示**？即是否存在整数对 $(x,y)$ 使得 $f(x,y)=n$。如果存在这样的 $(x,y)$ 且 $\gcd(x,y)=1$，我们称这是一个**本原表示** (primitive representation) [@problem_id:3082318]。

这个问题与素数的性质密切相关。以著名的二次型 $f(x,y)=x^2+xy+y^2$（[判别式](@entry_id:174614) $D=-3$）为例，一个正整数 $n$ 能被它本原表示的充要条件是：$n$ 的素[因子分解](@entry_id:150389)中，不含任何形如 $p \equiv 2 \pmod{3}$ 的素数，且素数 $3$ 的指数最高为 $1$ [@problem_id:3082318]。例如，$7=2^2+2\cdot1+1^2$ 是一个本原表示，因为 $7 \equiv 1 \pmod{3}$。而 $5$ 无法被表示，因为它满足 $5 \equiv 2 \pmod{3}$。整数 $4$ 虽然满足 $4 \equiv 1 \pmod{3}$，但其素因子 $2 \equiv 2 \pmod{3}$，因此它不能被本原表示（尽管它可以被非本原表示，如 $4 = 2^2+2(0)+0^2$ 但 $\gcd(2,0) \ne 1$）。

### 型类的[群结构](@entry_id:146855)

到目前为止，我们已经看到具有相同[判别式](@entry_id:174614) $D0$ 的本原正定二次型的等价类集合是有限的。高斯更进一步，揭示了这个集合上存在一个自然的[二元运算](@entry_id:152272)，即**复合** (composition)，使其构成一个[有限阿贝尔群](@entry_id:136632)，称为**[类群](@entry_id:182524)** (class group)。

#### 与理想的对应关系

理解复合运算最现代、最清晰的方式是通过二次型与二次域中理想之间的深刻联系。给定一个非平方的[判别式](@entry_id:174614) $D$，我们可以构造一个二次[数域](@entry_id:155558) $K = \mathbb{Q}(\sqrt{D})$。在该[数域](@entry_id:155558)中，有一个唯一的**二次序** (quadratic order) $\mathcal{O}_D$，其判别式也为 $D$。

一个惊人的结果是，[判别式](@entry_id:174614)为 $D$ 的本原二次型的[正常等价](@entry_id:635057)类集合，与二次序 $\mathcal{O}_D$ 的**正常[理想类群](@entry_id:153974)** (proper ideal class group) 之间存在一个典范的双射 [@problem_id:3089558]。这个对应关系具体如下：
对于一个本原二次型 $f(x,y) = ax^2 + bxy + cy^2$，我们关联一个 $\mathbb{Z}$-模：
$$ I_f = a\mathbb{Z} + \frac{-b+\sqrt{D}}{2}\mathbb{Z} $$
可以证明，这个 $I_f$ 是 $\mathcal{O}_D$ 的一个可逆整理想 (proper ideal)，其范数 (norm) 等于 $a$。并且，如果两个二次型是[正常等价](@entry_id:635057)的，它们对应的理想就在同一个理想类中（即仅相差一个[主理想](@entry_id:152760)的乘积）。

#### 复合律与[类群](@entry_id:182524)

利用上述对应关系，我们可以定义二次型[等价类](@entry_id:156032)之间的复合运算 [@problem_id:3009172]。给定两个等价类 $[f_1]$ 和 $[f_2]$，它们分别对应于理想类 $[\mathfrak{a}_1]$ 和 $[\mathfrak{a}_2]$。它们的**复合** $[f_1] \star [f_2]$ 就被定义为对应于理想类乘积 $[\mathfrak{a}_1 \mathfrak{a}_2]$ 的那个二次型[等价类](@entry_id:156032)。

由于[理想类群](@entry_id:153974)本身是一个[阿贝尔群](@entry_id:150284)，这个复合运算自然地赋予了二次型[等价类](@entry_id:156032)集合 $\mathcal{C}_D$ 一个有限[阿贝尔群的结构](@entry_id:140745)：
*   **闭合性**：两个可逆理想的乘积仍然是可逆理想。
*   **[结合律](@entry_id:151180)和交换律**：直接继承自理想乘法的性质。
*   **单位元**：是对应于[主理想](@entry_id:152760)类（即 $\mathcal{O}_D$ 本身）的那个二次型类，称为**主型类** (principal class)。它由**主型** (principal form) 代表，即系数为 $[1,b,c]$ 的形式（其中 $b$ 根据 $D$ 的奇偶性确定）。
*   **[逆元](@entry_id:140790)**：对于一个二次型类 $[a,b,c]$，其[逆元](@entry_id:140790)是 $[a,-b,c]$ 所在的类。

这个由复合运算定义的群结构，是二次型理论的顶峰，它将二次型的算术性质与二次域的[代数结构](@entry_id:137052)紧密地联系在一起，为解决诸如整数表示等经典数论问题提供了强大的理论框架。