## 引言
整数的性质是数论研究的核心，其中一个古老而迷人的问题是：哪些整数可以被表示为若干个整数的平方之和？这个问题不仅自身充满数学之美，其解答更是揭示了代数、几何与分析之间深刻的内在联系。从古希腊的丢番图到近代的费马、欧拉和拉格朗日，无数数学家为之着迷，他们的探索构筑了现代数论的重要基石。本文旨在系统性地梳理整数的二平方和与[四平方和](@entry_id:203455)表示理论，解决“一个数能否以及如何表示为平方和”这一核心问题。

在接下来的内容中，我们将分三个章节展开探讨。在“原理与机制”一章中，我们将深入费马二平方和定理与拉格朗日[四平方和](@entry_id:203455)定理的细节，揭示高斯整数与[四元数](@entry_id:147023)作为其背后代数引擎的强大作用。随后，“应用与跨学科联系”一章将展示这些经典理论如何超越纯数学的范畴，在计算构造、几何格点分析乃至量子物理学的能级研究中找到用武之地。最后，“动手实践”部分将提供一系列精心设计的问题，引导你将理论知识转化为解决具体问题的计算能力。通过这一完整的学习路径，你将不仅掌握平方和理论的核心结论，更能体会到数学思想跨越领域的力量。

## 原理与机制

在本章中，我们将深入探讨整数表示为平方和问题的核心原理与代数机制。我们将从经典的二平方和问题入手，揭示其背后深刻的[代数结构](@entry_id:137052)，然后转向更为普适的[四平方和](@entry_id:203455)问题，并对两者进行比较。我们的目标不仅是陈述定理，更是理解这些定理为何成立，以及它们如何与更广泛的数学概念联系在一起。

### 二平方和表示：现象及其刻画

一个自然数 $n$ 何时能被写成两个整数的平方之和，即 $n = x^2 + y^2$？这个问题自古以来就吸引着数学家。通过对小整数的观察，我们可能会发现一些规律，但一个完整而精确的答案是由Fermat首先提出，后由Euler等人完善的。这个被称为**费马二平方和定理** (Fermat's theorem on sums of two squares) 的结论，为我们提供了一个清晰的判别标准。

该定理指出：一个正整数 $n$ 可以表示为两个整数的平方和，当且仅当在其素数[因子分解](@entry_id:150389)中，所有形如 $4k+3$ 的素数（即模 $4$ 余 $3$ 的素数）都以偶数次幂出现。

这个条件既是必要的也是充分的。例如，整数 $45$ 的素数分解是 $45 = 3^2 \cdot 5^1$。其中，唯一的 $4k+3$ 型素因子是 $3$，它的幂次是 $2$（偶数），因此 $45$ 可以表示为二平方和。事实也确实如此：$45 = 6^2 + 3^2$。类似地，$50 = 2 \cdot 5^2$，它没有形如 $4k+3$ 的素因子，因此也满足条件（可以认为所有这类素因子的幂次都是 $0$，是偶数），我们有 $50 = 7^2 + 1^2 = 5^2 + 5^2$。

相反，考虑整数 $21$。它的素数分解是 $21 = 3^1 \cdot 7^1$。素因子 $3$ 和 $7$ 都是 $4k+3$ 型，且它们的幂次都是 $1$（奇数）。根据定理， $21$ 无法表示为两个平方的和。同样，$33 = 3^1 \cdot 11^1$ 和 $147 = 3^1 \cdot 7^2$ 也因为存在奇数次幂的 $4k+3$ 型素因子（分别是 $3$ 和 $11$，以及 $3$）而无法表示为二平方和 [@problem_id:3089689]。

这个定理的**必要性**（即如果 $n=x^2+y^2$，那么其 $4k+3$ 型素因子的幂次必为偶数）可以通过初等的同余理论来证明。首先，任何整数的平方模 $4$ 的余数只可能是 $0$ 或 $1$。这是因为若 $x$ 是偶数 ($x=2m$)，则 $x^2 = 4m^2 \equiv 0 \pmod 4$；若 $x$ 是奇数 ($x=2m+1$)，则 $x^2 = 4m^2+4m+1 \equiv 1 \pmod 4$。因此，两个平方的和 $x^2+y^2$ 模 $4$ 的余数只可能是 $0+0=0$，$0+1=1$ 或 $1+1=2$。一个数 $n$ 如果满足 $n \equiv 3 \pmod 4$，它绝不可能是两个平方的和。

这个简单的观察是必要性证明的第一步。一个更强的论证如下：假设素数 $q \equiv 3 \pmod 4$ 整除 $n=x^2+y^2$。这意味着 $x^2+y^2 \equiv 0 \pmod q$，即 $x^2 \equiv -y^2 \pmod q$。如果 $q$ 不整除 $y$，那么 $y$ 在模 $q$ 意义下存在[逆元](@entry_id:140790) $y^{-1}$。我们可以得到 $(xy^{-1})^2 \equiv -1 \pmod q$。这说明 $-1$ 是模 $q$ 的二次剩余。然而，根据[二次互反律](@entry_id:183186)的推论，$-1$ 是模 $q$ 的二次剩余当且仅当 $q \equiv 1 \pmod 4$。这与我们的前提 $q \equiv 3 \pmod 4$ 矛盾。因此，最初的假设（$q$ 不整除 $y$）必定是错误的。所以 $q$ 必须整除 $y$。由于 $x^2 \equiv -y^2 \pmod q$，如果 $q|y$，那么 $y^2 \equiv 0 \pmod q$，从而 $x^2 \equiv 0 \pmod q$，这意味着 $q$ 也必须整除 $x$。

综上，如果一个形如 $4k+3$ 的素数 $q$ 整除 $n=x^2+y^2$，那么它必须同时整除 $x$ 和 $y$。这意味着 $x=qx'$，$y=qy'$，所以 $n = (qx')^2 + (qy')^2 = q^2(x'^2+y'^2)$。这表明 $q^2$ 整除 $n$，并且商 $n/q^2$ 也是一个二平方和。我们可以对 $n/q^2$ 重复此论证。这个过程揭示，在 $n$ 的[素数分解](@entry_id:198620)中，$q$ 的总幂次必须是偶数。这就是定理的必要性 [@problem_id:3089689]。

### 代数机制：高斯整数与乘性范数

要理解二平方和定理的“充分性”以及其更深层的结构，我们需要引入一个强大的工具：**高斯整数** (Gaussian integers)。[高斯整数环](@entry_id:149594)，记作 $\mathbb{Z}[i]$，是所有形如 $a+bi$ 的复数的集合，其中 $a$ 和 $b$ 是整数。这个集合在复数的加法和乘法下构成一个环。

二平方和问题与[高斯整数](@entry_id:149548)的联系通过**范数** (norm) 函数建立。对于一个[高斯整数](@entry_id:149548) $\alpha = a+bi$，其范数定义为：
$$ N(\alpha) = N(a+bi) = a^2+b^2 $$
范数 $N(\alpha)$ 就是[复数模](@entry_id:167344)的平方 $|a+bi|^2$。从定义可以看出，一个正整数 $n$ 是两个平方的和，当且仅当它是某个[高斯整数的范数](@entry_id:155420)。

[高斯整数的范数](@entry_id:155420)有一个至关重要的性质：它是**[乘性](@entry_id:187940)**的。也就是说，对于任意两个[高斯整数](@entry_id:149548) $\alpha$ 和 $\beta$，有 $N(\alpha\beta) = N(\alpha)N(\beta)$。这个性质源于[复数模](@entry_id:167344)的乘性 $|z_1z_2| = |z_1||z_2|$。

这个乘性性质直接导出了一个优美的恒等式，称为**婆罗摩笈多－斐波那契恒等式** (Brahmagupta-Fibonacci identity)。如果我们设 $\alpha = a+bi$ 和 $\beta = c+di$，那么它们的乘积是 $\alpha\beta = (ac-bd) + (ad+bc)i$。应用范数的乘性，我们得到：
$$ N(\alpha)N(\beta) = (a^2+b^2)(c^2+d^2) $$
$$ N(\alpha\beta) = (ac-bd)^2 + (ad+bc)^2 $$
因此，我们得到了恒等式：
$$ (a^2+b^2)(c^2+d^2) = (ac-bd)^2 + (ad+bc)^2 $$
这个恒等式明确地表明，两个“二平方和数”的乘积本身也是一个“二平方和数”。换言之，能够表示为二平方和的整数集合在乘法下是封闭的 [@problem_id:3089709] [@problem_id:3089697]。这个代数机制是理解二平方和问题的关键一步，它将一个数论问题转化为了一个代数环中的结构问题。

### 更深层的证明：$\mathbb{Z}[i]$的唯一因子分解

[高斯整数环](@entry_id:149594) $\mathbb{Z}[i]$ 不仅是一个环，它还是一个**唯一因子分解[整环](@entry_id:155321)** (Unique Factorization Domain, UFD)。这意味着环中每一个非零非单位元都可以被唯一地分解为不可约元（[高斯素数](@entry_id:156770)）的乘积，这种唯一性是在不考虑因子次序和乘以单位元（在 $\mathbb{Z}[i]$ 中为 $\pm 1, \pm i$）的意义下成立的。这个性质是证明费马二平方和定理“充分性”的基石 [@problem_id:3089718]。

为了利用这个性质，我们需要了解有理素数（即 $\mathbb{Z}$ 中的素数）在 $\mathbb{Z}[i]$ 中是如何分解的。存在三种情况 [@problem_id:3089682] [@problem_id:3089712]：

1.  **分歧 (Ramification)**：有理素数 $2$ 在 $\mathbb{Z}[i]$ 中不再是素数。我们有 $2 = (1+i)(1-i)$。因为 $1-i = -i(1+i)$，因子 $1+i$ 和 $1-i$ 是相伴的（只差一个单位元）。因此 $2 = -i(1+i)^2$，素数 $2$ 分解为一个[高斯素数](@entry_id:156770)的平方（除去单位元）。

2.  **分裂 (Splitting)**：所有形如 $p \equiv 1 \pmod 4$ 的有理素数在 $\mathbb{Z}[i]$ 中会分裂成两个互为共轭但不相伴的[高斯素数](@entry_id:156770)的乘积。即 $p = \pi \overline{\pi}$，其中 $\pi = a+bi$ 是一个[高斯素数](@entry_id:156770)，且 $N(\pi) = a^2+b^2 = p$。例如，$5 = (2+i)(2-i)$，$13 = (3+2i)(3-2i)$。

3.  **惯性 (Inertia)**：所有形如 $q \equiv 3 \pmod 4$ 的有理素数在 $\mathbb{Z}[i]$ 中保持为素数（即它们是惯性素数）。例如，$3, 7, 11$ 在 $\mathbb{Z}[i]$ 中都是素数。

现在，我们可以完整地证明[费马定理](@entry_id:140206)了。我们已经知道 $n$ 是二平方和等价于 $n = N(\alpha) = \alpha \overline{\alpha}$ 对于某个 $\alpha \in \mathbb{Z}[i]$ 成立。

考虑 $n$ 在 $\mathbb{Z}[i]$ 中的唯一[因子分解](@entry_id:150389)。如果 $n = \alpha \overline{\alpha}$，那么 $n$ 的每一个高斯素因子要么成对出现（$\pi$ 和 $\overline{\pi}$），要么是自身的共轭（即有理整数）。对于一个惯性素数 $q \equiv 3 \pmod 4$，我们有 $\overline{q} = q$。如果 $q$ 在 $\alpha$ 的分解中出现了 $k$ 次，那么它在 $\overline{\alpha}$ 的分解中也必须出现 $k$ 次。因此，在 $n = \alpha\overline{\alpha}$ 的分解中，$q$ 的总幂次必须是 $2k$，一个偶数。这就完整地证明了定理的**必要性** [@problem_id:3089682]。

对于**充分性**，假设 $n$ 的[素数分解](@entry_id:198620) $n = 2^k \prod p_i^{a_i} \prod q_j^{b_j}$ 中，所有的 $b_j$ 都是偶数。在 $\mathbb{Z}[i]$ 中，这个分解对应于：
$$ n = (-i(1+i)^2)^k \prod (\pi_i \overline{\pi_i})^{a_i} \prod q_j^{b_j} $$
由于每个 $b_j$ 都是偶数，我们可以写成 $b_j = 2c_j$。现在我们可以构造一个[高斯整数](@entry_id:149548) $\alpha$：
$$ \alpha = (1+i)^k \prod \pi_i^{a_i} \prod q_j^{c_j} $$
利用范数的乘性，计算 $\alpha$ 的范数：
$$ N(\alpha) = N(1+i)^k \prod N(\pi_i)^{a_i} \prod N(q_j)^{c_j} = 2^k \prod p_i^{a_i} \prod (q_j^2)^{c_j} = 2^k \prod p_i^{a_i} \prod q_j^{2c_j} = n $$
我们成功找到了一个范数为 $n$ 的[高斯整数](@entry_id:149548) $\alpha$，因此 $n$ 可以表示为二平方和 [@problem_id:3089682]。这个证明的优雅之处在于它完全依赖于 $\mathbb{Z}[i]$ 的[代数结构](@entry_id:137052)，特别是其唯一因子分解性质。

### 定量分析：表示的数量 $r_2(n)$

我们不仅可以问一个数能否表示为二平方和，还可以问有多少种不同的表示方法。我们用[算术函数](@entry_id:200701) $r_2(n)$ 表示将 $n$ 写成有序整数对 $(x,y)$ 平方和 $x^2+y^2=n$ 的方式总数（[计算顺序](@entry_id:749112)和符号，例如对 $n=5$，$(1,2), (2,1), (-1,2), (2,-1), (1,-2), (-2,1), (-1,-2), (-2,-1)$ 是 8 种不同的表示）。

借助[高斯整数环](@entry_id:149594)中理想的分解理论，可以推导出 $r_2(n)$ 的精确公式 [@problem_id:3089712]。
令 $n$ 的素数分解为 $n = 2^k \prod p_i^{a_i} \prod q_j^{b_j}$，其中 $p_i \equiv 1 \pmod 4$，$q_j \equiv 3 \pmod 4$。
- 如果存在任何一个 $b_j$ 是奇数，那么 $r_2(n) = 0$。
- 如果所有的 $b_j$ 都是偶数，那么 $r_2(n) = 4 \prod_i (a_i+1)$。

这个公式揭示了表示数量仅与 $4k+1$ 型素因子的幂次有关。因子 $4$ 来自于[高斯整数环](@entry_id:149594)的四个单位元 $(\pm 1, \pm i)$，它们可以乘以任何一个解 $\alpha=x+iy$ 得到新的解，而不改变其范数。

这个公式也让我们能够分析 $r_2(n)$ 在其参数被乘以一个[平方数](@entry_id:635622) $k^2$ 时的行为。容易证明，$r_2(k^2n)=0$ 当且仅当 $r_2(n)=0$，因为一个 $4k+3$ 型素数在 $n$ 中的幂次是奇数，当且仅当它在 $k^2n$ 中的幂次是奇数。当 $r_2(n) > 0$ 时，我们还可以得到一个精确的缩放关系 [@problem_id:3089713]：
$$ r_2(k^2 n) = r_2(n) \prod_{\substack{p \equiv 1 \pmod 4 \\ p|k}} \frac{v_p(n) + 2v_p(k) + 1}{v_p(n) + 1} $$
其中 $v_p(m)$ 表示素数 $p$ 在 $m$ 的分解中的幂次。这个关系表明 $r_2(n)$ 并不是一个简单的[乘性函数](@entry_id:168587)。

### [四平方和](@entry_id:203455)表示：一个普适性质

与二平方和问题形成鲜明对比的是[四平方和](@entry_id:203455)问题。Lagrange在1770年证明了一个惊人的定理：**所有正整数**都能表示为四个整数的平方和 [@problem_id:3089697]。这个定理被称为**拉格朗日[四平方和](@entry_id:203455)定理** (Lagrange's four-square theorem)。

这意味着，对于任何正整数 $n$，[算术函数](@entry_id:200701) $r_4(n)$（表示 $n$ 为四个有序整数平方和的方式数）总是非零的，即 $r_4(n) > 0$。这与 $r_2(n)$ 的行为截然不同，$r_2(n)$ 对无穷多个整数（如 $3, 6, 7, 11, 12, 14, ...$）都为零 [@problem_id:3089699]。例如，整数 $3$ 不能表示为两个平方和，但可以表示为四个平方和：$3=1^2+1^2+1^2+0^2$。同样，$27=5^2+1^2+1^2+0^2$，$75=5^2+5^2+5^2+0^2$。

与二平方和情况类似，能够表示为四个平方和的整数集合在乘法下也是封闭的。这源于**欧拉[四平方和](@entry_id:203455)恒等式** (Euler's four-square identity)，这是一个比[婆罗摩笈多-斐波那契恒等式](@entry_id:633896)更为复杂的代数恒等式。

### [四平方和](@entry_id:203455)的[代数结构](@entry_id:137052)：四元数

正如[高斯整数](@entry_id:149548)是二平方和问题的自然代数背景，[四平方和](@entry_id:203455)问题也有其对应的[代数结构](@entry_id:137052)——**[哈密顿四元数](@entry_id:153839)** (Hamiltonian quaternions)。[四元数](@entry_id:147023)是实数的一个四维扩展，一个四元数 $q$ 可以写成：
$$ q = a + bi + cj + dk $$
其中 $a,b,c,d$ 是实数，$i,j,k$ 是满足 $i^2 = j^2 = k^2 = ijk = -1$ 的基本单位。

[四元数乘法](@entry_id:154753)满足[结合律](@entry_id:151180)，但不满足交换律（例如，$ij = k$ 但 $ji = -k$）。这使得[四元数代数](@entry_id:196348) $\mathbb{H}$ 成为一个非交换的[除环](@entry_id:149568)。

类似于高斯整数，我们可以定义[四元数](@entry_id:147023)的范数：
$$ N(q) = a^2+b^2+c^2+d^2 $$
范数同样是[乘性](@entry_id:187940)的：$N(q_1q_2) = N(q_1)N(q_2)$。欧拉[四平方和](@entry_id:203455)恒等式正是这个范[数乘](@entry_id:155971)性性质的直接代数体现。因此，二平方和恒等式与[四平方和](@entry_id:203455)恒等式的根源都在于某个代数系统中的乘性范数，但它们的关键区别在于前者（高斯整数）是交换的，而后者（四元数）是[非交换](@entry_id:136599)的 [@problem_id:3089698]。

这个观点可以被推广。**Hurwitz定理**指出，包含乘性范数的赋范除代数只可能存在于维度 $1, 2, 4, 8$。这四个维度分别对应于实数 $\mathbb{R}$、复数 $\mathbb{C}$（其[子环](@entry_id:154194) $\mathbb{Z}[i]$ 解释了二平方和）、四元数 $\mathbb{H}$（其子环解释了[四平方和](@entry_id:203455)）和[八元数](@entry_id:184220) $\mathbb{O}$（它给出了一个八平方和恒等式）。这揭示了平方和问题与抽象代数之间深刻而美丽的联系 [@problem_id:3089698]。

### 定量与解析视角

对于[四平方和](@entry_id:203455)，Jacobi给出了一个计算表示数量 $r_4(n)$ 的优美公式。**雅可比[四平方和](@entry_id:203455)定理** (Jacobi's four-square theorem) 指出：
$$ r_4(n) = 8 \sum_{d|n, 4 \nmid d} d $$
也就是说，$r_4(n)$ 是 $n$ 的所有不被 $4$ 整除的因数之和的 $8$ 倍。如果 $n$ 是奇数，这简化为 $r_4(n) = 8\sigma(n)$，其中 $\sigma(n)$ 是 $n$ 的所有因数之和。如果 $n=2^k m$（$m$为奇数，$k \ge 1$），则 $r_4(n)=24\sigma(m)$。

$r_4(n)$ 的[缩放性质](@entry_id:273821)也比 $r_2(n)$ 简单。对于任意正整数 $n$ 和 $k$，总有 $r_4(k^2n) \ge r_4(n)$，等号成立的条件是 $k=1$，或者当 $n$ 是偶数时 $k$ 是 $2$ 的幂 [@problem_id:3089713]。

最后，我们可以从[解析数论](@entry_id:158402)的角度来看待这些问题。$r_2(n)$ 和 $r_4(n)$ 作为[算术函数](@entry_id:200701)，可以被编码到它们的**[狄利克雷级数](@entry_id:174701)** (Dirichlet series) [生成函数](@entry_id:146702)中：
$$ R_2(s) = \sum_{n=1}^\infty \frac{r_2(n)}{n^s}, \quad R_4(s) = \sum_{n=1}^\infty \frac{r_4(n)}{n^s} $$
利用 $r_2(n)$ 和 $r_4(n)$ 的[因数和公式](@entry_id:634768)，可以推导出这些级数与黎曼Zeta函数 $\zeta(s)$ 和[狄利克雷L函数](@entry_id:199760) $L(s,\chi)$ 的关系 [@problem_id:3089685]：
$$ R_2(s) = 4\zeta(s)L(s, \chi_4) $$
$$ R_4(s) = 8(1-4^{1-s})\zeta(s)\zeta(s-1) $$
其中 $\chi_4$ 是模 $4$ 的非主特征。这些恒等式将关于整数表示的离散计数问题，与[复分析](@entry_id:167282)中研究的核心对象联系起来，为我们从另一个维度理解平方和问题提供了有力的工具。