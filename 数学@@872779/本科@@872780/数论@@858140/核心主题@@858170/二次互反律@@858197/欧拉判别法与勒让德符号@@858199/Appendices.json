{"hands_on_practices": [{"introduction": "要真正掌握欧拉判别法，最好的方法就是将其与二次剩余的基本定义直接联系起来。这个练习 [@problem_id:3084854] 将指导你用两种方法计算勒让德符号 $(\\frac{2}{13})$：首先使用欧拉判别法进行计算，然后通过穷举模 $13$ 下的所有平方值来直接验证结果。这种双重验证方法不仅能巩固你对理论的理解，还能增强你解决问题的信心。", "problem": "设 $p$ 为一个奇素数，并令 $\\left(\\frac{a}{p}\\right)$ 表示勒让德符号，其为整数 $a$ 定义如下：若 $a$ 是模 $p$ 的二次剩余且 $p \\nmid a$，则 $\\left(\\frac{a}{p}\\right)=1$；若 $a$ 是模 $p$ 的二次非剩余且 $p \\nmid a$，则 $\\left(\\frac{a}{p}\\right)=-1$；若 $p \\mid a$，则 $\\left(\\frac{a}{p}\\right)=0$。仅利用乘法群 $\\left(\\mathbb{Z}/p\\mathbb{Z}\\right)^{\\times}$ 的结构和费马小定理，应用欧拉准则来确定勒让德符号 $\\left(\\frac{2}{13}\\right)$ 的值。然后，通过在 $\\mathbb{Z}/13\\mathbb{Z}$ 中进行显式计算，直接分析同余式 $x^{2}\\equiv 2 \\pmod{13}$ 的可解性来验证你的结论。将你的最终答案表示为 $\\left(\\frac{2}{13}\\right)$ 的单个值。", "solution": "这个问题提法得当且数学上是合理的。我们被要求用两种方法来确定勒让德符号 $\\left(\\frac{2}{13}\\right)$ 的值：欧拉准则和直接计算二次剩余。\n\n首先，我们应用欧拉准则。对于一个奇素数 $p$ 和一个整数 $a$ 使得 $p \\nmid a$，欧拉准则表明：\n$$\n\\left(\\frac{a}{p}\\right) \\equiv a^{(p-1)/2} \\pmod{p}\n$$\n在这个问题中，我们有 $p=13$ 和 $a=2$。因为 $13$ 是一个奇素数且 $13 \\nmid 2$，所以满足欧拉准则的条件。我们将这些值代入公式：\n$$\n\\left(\\frac{2}{13}\\right) \\equiv 2^{(13-1)/2} \\pmod{13}\n$$\n这可以简化为：\n$$\n\\left(\\frac{2}{13}\\right) \\equiv 2^{12/2} \\pmod{13}\n$$\n$$\n\\left(\\frac{2}{13}\\right) \\equiv 2^{6} \\pmod{13}\n$$\n现在，我们计算 $2^6$ 模 $13$ 的值。\n我们可以分步进行计算：\n$2^1 \\equiv 2 \\pmod{13}$\n$2^2 \\equiv 4 \\pmod{13}$\n$2^3 \\equiv 8 \\pmod{13}$\n$2^4 = 16 \\equiv 3 \\pmod{13}$\n$2^5 = 2 \\times 2^4 \\equiv 2 \\times 3 \\equiv 6 \\pmod{13}$\n$2^6 = 2 \\times 2^5 \\equiv 2 \\times 6 \\equiv 12 \\pmod{13}$\n另一种方法是，$2^6 = 64$。为了找到 $64$ 除以 $13$ 的余数，我们可以注意到 $13 \\times 4 = 52$，所以 $64 = 52 + 12$。因此，$64 \\equiv 12 \\pmod{13}$。\n由于 $12 \\equiv -1 \\pmod{13}$，我们得到：\n$$\n\\left(\\frac{2}{13}\\right) \\equiv -1 \\pmod{13}\n$$\n因为 $13 \\nmid 2$，勒让德符号 $\\left(\\frac{2}{13}\\right)$ 的值只能取自集合 $\\{-1, 1\\}$。由于 $1 \\not\\equiv -1 \\pmod{13}$，该同余式唯一地确定了该符号的值。因此，我们得出结论 $\\left(\\frac{2}{13}\\right) = -1$。这意味着 $2$ 是模 $13$ 的二次非剩余。\n\n其次，按照指示，我们通过直接检验同余式 $x^2 \\equiv 2 \\pmod{13}$ 的可解性来验证这个结论。这需要我们计算乘法群 $\\left(\\mathbb{Z}/13\\mathbb{Z}\\right)^{\\times}$ 中元素的平方。这些元素是 $\\{1, 2, \\dots, 12\\}$。我们只需要计算 $x$ 从 $1$ 到 $(13-1)/2 = 6$ 的平方，因为 $(13-k)^2 \\equiv (-k)^2 \\equiv k^2 \\pmod{13}$。\n这些平方是：\n$1^2 \\equiv 1 \\pmod{13}$\n$2^2 \\equiv 4 \\pmod{13}$\n$3^2 \\equiv 9 \\pmod{13}$\n$4^2 = 16 \\equiv 3 \\pmod{13}$\n$5^2 = 25 = 13 + 12 \\equiv 12 \\pmod{13}$\n$6^2 = 36 = 2 \\times 13 + 10 \\equiv 10 \\pmod{13}$\n模 $13$ 的非零二次剩余集合是这些计算出的值的集合：$\\{1, 3, 4, 9, 10, 12\\}$。\n整数 $2$ 不在这个集合中。因此，同余式 $x^2 \\equiv 2 \\pmod{13}$ 没有整数解 $x$。这证实了 $2$ 是模 $13$ 的二次非剩余。\n\n两种方法一致地导出了相同的结果。勒让德符号 $\\left(\\frac{2}{13}\\right)$ 的值为 $-1$。", "answer": "$$\n\\boxed{-1}\n$$", "id": "3084854"}, {"introduction": "勒让德符号仅定义在分母为奇素数时，当我们将其推广到合数分母（即雅可比符号）时，会出现一些微妙但重要的差异。这个练习 [@problem_id:3084835] 将引导你探索雅可比符号的一个关键特性：符号值为 $1$ 并不保证对应的数是二次剩余。这个现象揭示了“欧拉伪素数”的概念，并加深了我们对二次剩余检验复杂性的理解。", "problem": "设 $n=15$。对于每个满足 $1 \\leq a \\leq 14$ 且 $\\gcd(a,15)=1$ 的整数 $a$，计算雅可比符号 $\\left(\\frac{a}{15}\\right)$，并通过求解 $x^{2} \\equiv a \\pmod{15}$ 来判断 $a$ 是否为模 $15$ 的二次剩余。你的推理应从基本定义和经过验证的事实出发：奇素数的勒让德符号的定义，奇素数的欧拉判别法，雅可比符号对其分母的乘法性质，以及中国剩余定理 (CRT)。不要假设任何未从这些基础建立的性质。\n\n设 $F$ 为在此范围内（满足 $\\gcd(a,15)=1$）的 $a$ 的值的数量，使得 $\\left(\\frac{a}{15}\\right)=1$ 但 $a$ 不是模 $15$ 的二次剩余。请给出你的最终答案，即确切的整数 $F$。", "solution": "这个问题是有效的，因为它的数学表述是适定的，科学上基于数论，并且其前提是一致和完备的。\n\n问题要求计算集合 $S = \\{a \\in \\mathbb{Z} \\mid 1 \\leq a \\leq 14, \\gcd(a,15)=1\\}$ 中整数 $a$ 的数量，这些 $a$ 满足雅可比符号 $\\left(\\frac{a}{15}\\right)=1$ 但 $a$ 不是模 $15$ 的二次剩余。设这个数量为 $F$。\n\n首先，我们确定集合 $S$。在 $1$ 到 $14$ 之间与 $15$ 互质的整数 $a$ 是那些不能被 $3$ 或 $5$ 整除的数。这个集合是 $S = \\{1, 2, 4, 7, 8, 11, 13, 14\\}$。\n\n问题要求一个从基本原理出发的解法。我们从指定的定义和定理开始。\n设 $n=15$。由于 $15 = 3 \\times 5$，其中 $3$ 和 $5$ 是不同的奇素数，我们可以通过考虑模 $3$ 和模 $5$ 的性质来分析模 $15$ 的性质。\n\n1.  **雅可比符号**：对于一个整数 $a$ 和一个奇正整数 $n = p_1 p_2 \\dots p_k$（其中 $p_i$ 是素因子，不一定不同），雅可比符号定义为相应勒让德符号的乘积：\n    $$ \\left(\\frac{a}{n}\\right) = \\left(\\frac{a}{p_1}\\right) \\left(\\frac{a}{p_2}\\right) \\dots \\left(\\frac{a}{p_k}\\right) $$\n    对于 $n=15$，雅可比符号为 $\\left(\\frac{a}{15}\\right) = \\left(\\frac{a}{3}\\right)\\left(\\frac{a}{5}\\right)$。\n\n2.  **二次剩余与中国剩余定理 (CRT)**：如果同余方程 $x^2 \\equiv a \\pmod{15}$ 有解，则整数 $a$ 是模 $15$ 的二次剩余。根据中国剩余定理，这个同余方程等价于以下同余方程组：\n    $$\n    \\begin{cases}\n    x^2 \\equiv a \\pmod{3} \\\\\n    x^2 \\equiv a \\pmod{5}\n    \\end{cases}\n    $$\n    这个方程组对 $x$ 有解当且仅当每个单独的同余方程都有解。由于 $\\gcd(a,15)=1$，我们有 $\\gcd(a,3)=1$ 和 $\\gcd(a,5)=1$。对于素数 $p$，单个同余方程 $x^2 \\equiv a \\pmod{p}$ 有解当且仅当 $a$ 是模 $p$ 的二次剩余。这等价于勒让德符号 $\\left(\\frac{a}{p}\\right)=1$ 的条件。\n    因此，$a$ 是模 $15$ 的二次剩余当且仅当 $a$ 是模 $3$ 的二次剩余 并且 $a$ 是模 $5$ 的二次剩余。这意味着：\n    $$ \\left(\\frac{a}{3}\\right) = 1 \\quad \\text{and} \\quad \\left(\\frac{a}{5}\\right) = 1 $$\n\n3.  **欧拉判别法**：对于一个奇素数 $p$ 和一个不能被 $p$ 整除的整数 $a$，欧拉判别法指出：\n    $$ \\left(\\frac{a}{p}\\right) \\equiv a^{(p-1)/2} \\pmod{p} $$\n\n我们的任务是找到集合 $S$ 中满足以下条件的整数 $a$ 的数量：\n(i) $\\left(\\frac{a}{15}\\right) = 1$\n(ii) $a$ 不是模 $15$ 的二次剩余。\n\n根据条件 (i) 和雅可比符号的定义，我们有 $\\left(\\frac{a}{3}\\right)\\left(\\frac{a}{5}\\right) = 1$。此方程成立的条件是两个勒让德符号都为 $1$ 或者都为 $-1$。\n$$ \\left(\\left(\\frac{a}{3}\\right)=1 \\text{ and } \\left(\\frac{a}{5}\\right)=1\\right) \\quad \\text{or} \\quad \\left(\\left(\\frac{a}{3}\\right)=-1 \\text{ and } \\left(\\frac{a}{5}\\right)=-1\\right) $$\n根据条件 (ii) 和我们使用 CRT 的分析，$a$ 不是模 $15$ 的二次剩余意味着不是 $\\left(\\frac{a}{3}\\right)=1$ 和 $\\left(\\frac{a}{5}\\right)=1$ 同时成立的情况。\n\n结合这两个要求，一个整数 $a$ 满足两个条件的唯一可能是：\n$$ \\left(\\frac{a}{3}\\right) = -1 \\quad \\text{and} \\quad \\left(\\frac{a}{5}\\right) = -1 $$\n\n现在我们使用欧拉判别法将这些关于勒让德符号的条件转化为关于 $a$ 的同余关系。\n对于 $p=3$：\n$\\left(\\frac{a}{3}\\right) = -1 \\iff a^{(3-1)/2} \\equiv a^1 \\equiv -1 \\pmod{3}$。由于 $-1 \\equiv 2 \\pmod 3$，这等价于 $a \\equiv 2 \\pmod{3}$。\n\n对于 $p=5$：\n$\\left(\\frac{a}{5}\\right) = -1 \\iff a^{(5-1)/2} \\equiv a^2 \\equiv -1 \\pmod{5}$。模 $5$ 的二次剩余是 $1^2 \\equiv 1$ 和 $2^2 \\equiv 4$。不是二次剩余（非二次剩余）的整数是 $2$ 和 $3$。因此，这等价于 $a \\equiv 2 \\pmod{5}$ 或 $a \\equiv 3 \\pmod{5}$。\n\n我们必须找到集合 $S$ 中满足这些同余条件的整数 $a$。这导出了两个同余方程组：\n\n方程组 1：\n$$\n\\begin{cases}\na \\equiv 2 \\pmod{3} \\\\\na \\equiv 2 \\pmod{5}\n\\end{cases}\n$$\n根据 CRT，存在一个唯一的模 $3 \\times 5 = 15$ 的解。通过观察，解是 $a \\equiv 2 \\pmod{15}$。集合 $S$ 中满足这个条件的唯一整数是 $a=2$。\n对于 $a=2$，我们验证：$\\left(\\frac{2}{3}\\right) = -1$ 且 $\\left(\\frac{2}{5}\\right)=-1$。因此 $\\left(\\frac{2}{15}\\right)=(-1)(-1)=1$，并且由于 $\\left(\\frac{2}{3}\\right) \\neq 1$，$2$ 不是模 $15$ 的二次剩余。所以 $a=2$ 是满足条件的一个值。\n\n方程组 2：\n$$\n\\begin{cases}\na \\equiv 2 \\pmod{3} \\\\\na \\equiv 3 \\pmod{5}\n\\end{cases}\n$$\n由第一个同余式，存在整数 $k$ 使得 $a = 3k+2$。将此代入第二个同余式：\n$$ 3k+2 \\equiv 3 \\pmod{5} $$\n$$ 3k \\equiv 1 \\pmod{5} $$\n为了解出 $k$，我们乘以 $3$ 模 $5$ 的模逆元，即 $2$（因为 $3 \\times 2 = 6 \\equiv 1 \\pmod{5}$）：\n$$ 2 \\times (3k) \\equiv 2 \\times 1 \\pmod{5} $$\n$$ k \\equiv 2 \\pmod{5} $$\n所以 $k$ 可以写成 $k=5j+2$ 的形式，其中 $j$ 是某个整数。将此代回 $a$ 的表达式中：\n$$ a = 3(5j+2)+2 = 15j+6+2 = 15j+8 $$\n解是 $a \\equiv 8 \\pmod{15}$。集合 $S$ 中满足这个条件的唯一整数是 $a=8$。\n对于 $a=8$，我们验证：$8 \\equiv 2 \\pmod 3 \\implies \\left(\\frac{8}{3}\\right)=-1$。并且 $8 \\equiv 3 \\pmod 5 \\implies \\left(\\frac{8}{5}\\right)=-1$。因此 $\\left(\\frac{8}{15}\\right)=(-1)(-1)=1$，并且由于 $\\left(\\frac{8}{3}\\right) \\neq 1$，$8$ 不是模 $15$ 的二次剩余。所以 $a=8$ 是满足条件的第二个值。\n\n在指定范围内满足条件的整数是 $2$ 和 $8$。恰好有两个这样的整数。\n因此，数量 $F$ 为 $2$。", "answer": "$$\\boxed{2}$$", "id": "3084835"}, {"introduction": "将数论理论转化为高效的计算机算法是现代密码学和计算数论的基石。本练习 [@problem_id:3084857] 要求你设计并实现一个基于欧拉判别法的算法，用于计算勒让德符号，并特别关注其计算效率。你将应用重复平方法（或称二进制幂）来处理大数模幂运算，这是计算数论中一个不可或缺的核心技能。", "problem": "设 $p$ 是一个奇素数，$a$ 是任意整数。目标是从第一性原理出发，推导出一个使用重复平方算法计算 $a^{\\frac{p-1}{2}} \\bmod p$ 的算法，并根据二次剩余的定义，确定勒让德符号 (Legendre symbol) $\\left(\\frac{a}{p}\\right)$ 的值，其中 $\\left(\\frac{a}{p}\\right) \\in \\{-1,0,1\\}$。从以下基础概念开始：\n- 模 $p$ 的二次剩余的定义：如果存在一个整数 $x$ 使得 $x^2 \\equiv a \\pmod{p}$，则整数 $a$ 是模 $p$ 的二次剩余；否则 $a$ 是模 $p$ 的二次非剩余。\n- 勒让德符号的定义：如果 $p \\mid a$，则 $\\left(\\frac{a}{p}\\right) = 0$；如果 $a$ 是模 $p$ 的二次剩余且 $\\gcd(a,p)=1$（最大公约数 (GCD)），则 $\\left(\\frac{a}{p}\\right) = 1$；如果 $a$ 是模 $p$ 的二次非剩余，则 $\\left(\\frac{a}{p}\\right) = -1$。\n- 费马小定理 (Fermat's little theorem)：对于满足 $\\gcd(a,p)=1$ 的任意整数 $a$，$a^{p-1} \\equiv 1 \\pmod{p}$。\n\n仅使用这些事实，推导为什么计算 $a^{\\frac{p-1}{2}} \\bmod p$ 足以判断 $a$ 是否是模 $p$ 的二次剩余，从而确定 $\\left(\\frac{a}{p}\\right)$ 的值。设计一个基于重复平方（也称为二进制幂）的算法来计算 $a^{\\frac{p-1}{2}} \\bmod p$，并解释如何将输出映射到勒让德符号 $\\left(\\frac{a}{p}\\right)$ 的值。根据 $p$ 的比特长度，即 $\\log p$，分析算法的时间复杂度，明确给出模乘法的次数和整数乘法的成本模型。\n\n你的程序必须实现用于模幂运算的重复平方算法，不得依赖任何内置的模幂运算快捷方式。对于每个测试用例，程序必须：\n- 计算 $r \\equiv a^{\\frac{p-1}{2}} \\bmod p$。\n- 根据定义，使用计算出的 $r$ 和模 $p$ 的剩余类，输出勒让德符号值 $\\left(\\frac{a}{p}\\right)$。\n\n使用以下测试套件，它涵盖了一般情况、边界条件和重要的边缘情况：\n- $(p,a) = (\\,3,\\,2\\,)$,\n- $(p,a) = (\\,3,\\,0\\,)$,\n- $(p,a) = (\\,11,\\,5\\,)$,\n- $(p,a) = (\\,29,\\,7\\,)$,\n- $(p,a) = (\\,13,\\,-1\\,)$,\n- $(p,a) = (\\,101,\\,25\\,)$,\n- $(p,a) = (\\,29,\\,29\\,)$,\n- $(p,a) = (\\,1000000007,\\,2\\,)$.\n\n你的程序应该生成一行输出，其中包含上述测试用例的勒让德符号值，形式为方括号内用逗号分隔的整数列表，顺序与所列顺序相同（例如，$[1,0,-1]$）。不涉及物理单位或角度单位，所有输出均为整数。", "solution": "该问题是有效的，因为它在数论中有科学依据，问题阐述清晰且客观。它提供了一套自洽的定义和定理（二次剩余、勒让德符号、费马小定理），并要求推导欧拉准则 (Euler's criterion)，基于此准则设计算法，进行复杂度分析，并为一组给定的测试用例提供具体实现。所有组成部分在数学上都是严谨且可形式化的。\n\n### 理论推导与算法设计\n\n核心任务是为一个奇素数 $p$ 和一个整数 $a$ 计算勒让德符号 $\\left(\\frac{a}{p}\\right)$ 的方法提供理论依据并加以实现。问题要求基于勒让德符号的值与 $a^{\\frac{p-1}{2}}$ 模 $p$ 同余这一事实进行推导。这个关系被称为欧拉准则。\n\n我们将通过考虑 $\\left(\\frac{a}{p}\\right)$ 的三种可能值：$0$、$1$ 和 $-1$ 来推导该准则。\n\n**情况1：$\\left(\\frac{a}{p}\\right) = 0$**\n根据定义，$\\left(\\frac{a}{p}\\right) = 0$ 当且仅当 $p \\mid a$，这等价于 $a \\equiv 0 \\pmod{p}$。\n因为 $p$ 是一个奇素数，$p \\geq 3$，这意味着指数 $\\frac{p-1}{2}$ 是一个正整数。\n因此，如果 $a \\equiv 0 \\pmod{p}$，则 $a^{\\frac{p-1}{2}} \\equiv 0^{\\frac{p-1}{2}} \\equiv 0 \\pmod{p}$。\n在这种情况下，$\\left(\\frac{a}{p}\\right) = 0$ 且 $a^{\\frac{p-1}{2}} \\equiv 0 \\pmod{p}$。两者值匹配。\n\n**情况2：$\\left(\\frac{a}{p}\\right) = 1$**\n根据定义，$\\left(\\frac{a}{p}\\right) = 1$ 当且仅当 $a$ 是模 $p$ 的二次剩余且 $\\gcd(a,p)=1$。\n这意味着存在一个整数 $x$ 使得 $x^2 \\equiv a \\pmod{p}$。由于 $\\gcd(a,p)=1$，那么也必然有 $\\gcd(x,p)=1$（如果 $p \\mid x$，则 $p \\mid x^2$，这将意味着 $p \\mid a$）。\n根据费马小定理，由于 $\\gcd(x,p)=1$，我们有 $x^{p-1} \\equiv 1 \\pmod{p}$。\n现在我们将 $a$ 提升到 $\\frac{p-1}{2}$ 次幂模 $p$：\n$$\na^{\\frac{p-1}{2}} \\equiv (x^2)^{\\frac{p-1}{2}} \\equiv x^{2 \\cdot \\frac{p-1}{2}} \\equiv x^{p-1} \\pmod{p}\n$$\n代入 $x^{p-1} \\equiv 1 \\pmod{p}$，我们得到：\n$$\na^{\\frac{p-1}{2}} \\equiv 1 \\pmod{p}\n$$\n在这种情况下，$\\left(\\frac{a}{p}\\right) = 1$ 且 $a^{\\frac{p-1}{2}} \\equiv 1 \\pmod{p}$。两者值匹配。\n\n**情况3：$\\left(\\frac{a}{p}\\right) = -1$**\n根据定义，$\\left(\\frac{a}{p}\\right) = -1$ 当且仅当 $a$ 是模 $p$ 的二次非剩余。这意味着 $\\gcd(a,p)=1$。\n根据费马小定理，由于 $\\gcd(a,p)=1$，我们有 $a^{p-1} \\equiv 1 \\pmod{p}$。\n这可以重写为 $a^{p-1} - 1 \\equiv 0 \\pmod{p}$。\n将左侧因式分解为平方差形式，得到：\n$$\n(a^{\\frac{p-1}{2}} - 1)(a^{\\frac{p-1}{2}} + 1) \\equiv 0 \\pmod{p}\n$$\n由于 $p$ 是一个素数，这意味着 $a^{\\frac{p-1}{2}} - 1 \\equiv 0 \\pmod{p}$ 或 $a^{\\frac{p-1}{2}} + 1 \\equiv 0 \\pmod{p}$。\n这意味着 $a^{\\frac{p-1}{2}}$ 模 $p$ 的结果必须同余于 $1$ 或 $-1$。\n从情况2可知，如果 $a$ 是一个二次剩余，则 $a^{\\frac{p-1}{2}} \\equiv 1 \\pmod{p}$。二次剩余的集合是多项式同余方程 $X^{\\frac{p-1}{2}} - 1 \\equiv 0 \\pmod{p}$ 的根。根据关于多项式同余的拉格朗日定理 (Lagrange's theorem)，这个多项式模 $p$ 最多有 $\\frac{p-1}{2}$ 个根。根据群论中的一个已知结果（模 $p$ 的单位群 $\\mathbb{Z}_p^*$ 是循环群），恰好有 $\\frac{p-1}{2}$ 个二次剩余和 $\\frac{p-1}{2}$ 个二次非剩余。\n由于在这种情况下 $a$ 是一个二次非剩余，它不可能是 $X^{\\frac{p-1}{2}} - 1 \\equiv 0 \\pmod{p}$ 的根。因此，$a^{\\frac{p-1}{2}} \\equiv 1 \\pmod{p}$ 不成立。\n唯一剩下的可能性是：\n$$\na^{\\frac{p-1}{2}} \\equiv -1 \\pmod{p}\n$$\n在这种情况下，$\\left(\\frac{a}{p}\\right) = -1$ 且 $a^{\\frac{p-1}{2}} \\equiv -1 \\pmod{p}$。两者值匹配。\n\n**结论（欧拉准则）**\n综合所有三种情况，我们建立了以下关系：\n$$\n\\left(\\frac{a}{p}\\right) \\equiv a^{\\frac{p-1}{2}} \\pmod{p}\n$$\n其中，模 $p$ 幂运算的结果 $-1$ 被解释为 $p-1$。这为计算勒让德符号提供了一种直接的计算方法。\n\n### 模幂运算算法（重复平方）\n\n为了高效地计算 $r \\equiv a^{\\frac{p-1}{2}} \\pmod{p}$，我们使用重复平方（也称为二进制幂）的方法。该算法避免了在取模之前计算 $a^{\\frac{p-1}{2}}$ 这个非常大的中间值。\n\n设底数为 $b$，指数为 $e$，模为 $m$。我们想计算 $b^e \\pmod{m}$。该算法通过考虑指数 $e$ 的二进制表示 $e = \\sum_{i=0}^{k} c_i 2^i$（其中 $c_i \\in \\{0, 1\\}$）来进行。\n计算过程如下：\n1. 初始化一个结果变量为 $1$。\n2. 将底数 $b$ 对 $m$ 取模。\n3. 当指数 $e > 0$ 时进行迭代：\n   a. 如果当前指数 $e$ 是奇数（即，最后一位是 $1$），则将结果乘以当前底数（对 $m$ 取模）。\n   b. 将底数平方（对 $m$ 取模）。这为处理指数的下一位做准备（例如，从 $b^{2^i}$ 到 $b^{2^{i+1}}$）。\n   c. 将指数右移一位（等价于整数除以 $2$），从而有效地从最低有效位到最高有效位处理比特。\n\n对于我们的问题，$b=a$，$e=\\frac{p-1}{2}$，$m=p$。\n\n### 映射到勒让德符号\n\n最终算法如下：\n1. 给定 $a$ 和一个奇素数 $p$。首先，将 $a$ 对 $p$ 取模。让这个新值也为 $a$。即，$a \\leftarrow a \\pmod{p}$。\n2. 如果 $a=0$，则 $\\left(\\frac{a}{p}\\right)=0$。\n3. 如果 $a \\neq 0$，使用上述重复平方算法计算 $r = a^{\\frac{p-1}{2}} \\pmod{p}$。\n4. 根据推导：\n   - 如果 $r=1$，则 $\\left(\\frac{a}{p}\\right)=1$。\n   - 如果 $r=p-1$（即 $\\equiv -1 \\pmod{p}$），则 $\\left(\\frac{a}{p}\\right)=-1$。\n   - 对于素数模 $p$，$r$ 不可能有其他结果。\n\n### 复杂度分析\n\n设 $n = \\log_2 p$ 为素数 $p$ 的比特长度。指数为 $E = \\frac{p-1}{2}$，其比特长度也约为 $n$。\n\n1.  **模乘法次数**：重复平方算法的主循环迭代次数与指数 $E$ 的比特数相同。迭代次数为 $\\lfloor \\log_2 E \\rfloor + 1 \\approx n$。在循环内部，总会执行一次模平方运算。仅当指数对应的比特为 $1$ 时，才会执行一次模乘法。在最坏情况下（所有比特都为 $1$），大约有 $n$ 次平方和 $n$ 次乘法，总共 $2n$ 次模乘法。在最好情况下（只有一个比特为 $1$），有 $n$ 次平方和 $1$ 次乘法。因此，模乘法的次数为 $O(\\log p)$。\n\n2.  **整数运算成本**：乘法中涉及的数都小于 $p$，因此它们的比特长度最多为 $n = \\lceil \\log_2 p \\rceil$。设 $M(n)$ 为两个 $n$ 比特整数相乘的时间复杂度。\n    - 使用标准的“教科书式”乘法算法，$M(n) = O(n^2)$。\n    - 一次模乘法 $(x \\cdot y) \\pmod p$ 涉及一次整数乘法（成本为 $M(n)$）和一次带余数的整数除法，其成本相似，使用简单算法通常也为 $O(n^2)$。因此，一次模乘法的成本为 $O((\\log p)^2)$。\n\n3.  **总时间复杂度**：总时间复杂度是模乘法次数乘以每次乘法的成本。\n    $$\n    \\text{复杂度} = O(\\log p) \\times (\\text{单次模乘法成本})\n    $$\n    $$\n    \\text{复杂度} = O(\\log p) \\times O((\\log p)^2) = O((\\log p)^3)\n    $$\n    使用更快的整数乘法算法，如 Karatsuba 算法 ($M(n) = O(n^{\\log_2 3})$)，可以降低总复杂度。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the Legendre symbol for a series of test cases using Euler's criterion\n    and a custom implementation of the repeated squaring algorithm.\n    \"\"\"\n\n    def custom_mod_pow(base, exp, mod):\n        \"\"\"\n        Computes (base^exp) % mod using repeated squaring (binary exponentiation).\n        This implementation is required by the problem statement and does not use\n        the built-in pow(base, exp, mod) function.\n        \"\"\"\n        result = 1\n        base = base % mod\n        while exp > 0:\n            # If exponent is odd, multiply base with result\n            if exp % 2 == 1:\n                result = (result * base) % mod\n            # Exponent must be even now, so we can halve it\n            exp = exp // 2\n            # Square the base\n            base = (base * base) % mod\n        return result\n\n    def legendre_symbol(a, p):\n        \"\"\"\n        Computes the Legendre symbol (a/p) for an odd prime p.\n        (a/p) = 0 if p | a\n        (a/p) = 1 if a is a quadratic residue mod p and p does not divide a.\n        (a/p) = -1 if a is a quadratic non-residue mod p.\n        This is determined by computing a^((p-1)/2) mod p.\n        \"\"\"\n        # The problem statement guarantees p is an odd prime.\n        \n        # Reduce a modulo p. This handles large and negative inputs for a.\n        a = a % p\n        \n        # Case 1: (a/p) = 0 if a is a multiple of p\n        if a == 0:\n            return 0\n        \n        # Case 2  3: (a/p) is 1 or -1, determined by Euler's criterion.\n        exponent = (p - 1) // 2\n        result = custom_mod_pow(a, exponent, p)\n        \n        # According to the derived theory, the result must be 1 or p-1 (which is -1 mod p).\n        if result == 1:\n            return 1\n        else:\n            # The result must be p-1\n            return -1\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (3, 2),\n        (3, 0),\n        (11, 5),\n        (29, 7),\n        (13, -1),\n        (101, 25),\n        (29, 29),\n        (1000000007, 2),\n    ]\n\n    results = []\n    for p, a in test_cases:\n        # Main logic to calculate the result for one case goes here.\n        result = legendre_symbol(a, p)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3084857"}]}