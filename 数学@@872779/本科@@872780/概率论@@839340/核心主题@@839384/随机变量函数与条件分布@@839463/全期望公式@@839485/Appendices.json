{"hands_on_practices": [{"introduction": "这个练习将通过一个直观的游戏节目场景，介绍全期望定律最直接的应用。我们将学习如何通过对不同情况下的期望值进行加权平均，来计算一个随机变量的总体期望。这体现了将复杂问题 ([@problem_id:1928933]) 分解为简单部分处理的核心思想。", "problem": "一个游戏节目的参赛者面对三扇相同的门：1号门、2号门和3号门。每扇门后面都有一个现金奖励。任何一扇门后面的奖金价值是一个随机变量，但对过去节目的统计分析确定了每扇门后面的平均奖金金额。1号门后面的平均奖金是1000美元，2号门后面的平均奖金是5000美元，3号门后面的平均奖金是100美元。由于舞台设置，参赛者表现出一种已知的心理偏见：他们选择中间的门（2号门）的可能性是选择1号门的两倍。他们选择3号门的可能性与选择1号门的可能性相同。玩这个游戏的参赛者的总期望奖金是多少？以美元为单位表示你的最终答案，并四舍五入到三位有效数字。", "solution": "设 $D \\in \\{1,2,3\\}$ 表示选择的门，设 $X$ 为赢得的奖金。根据全期望定律，我们有\n$$\n\\mathbb{E}[X]=\\sum_{i=1}^{3}\\mathbb{E}[X \\mid D=i]\\,\\mathbb{P}(D=i).\n$$\n根据题目，每扇门后的平均奖金为 $\\mu_{1}=1000$，$\\mu_{2}=5000$，和 $\\mu_{3}=100$，所以 $\\mathbb{E}[X \\mid D=i]=\\mu_{i}$。\n\n设 $\\mathbb{P}(D=1)=p$。这种偏见意味着 $\\mathbb{P}(D=2)=2p$ 且 $\\mathbb{P}(D=3)=p$。使用归一化条件，\n$$\np+2p+p=1 \\;\\Rightarrow\\; 4p=1 \\;\\Rightarrow\\; p=\\frac{1}{4}.\n$$\n因此 $\\mathbb{P}(D=1)=\\frac{1}{4}$，$\\mathbb{P}(D=2)=\\frac{1}{2}$，且 $\\mathbb{P}(D=3)=\\frac{1}{4}$。所以，\n$$\n\\mathbb{E}[X]=\\frac{1}{4}\\cdot 1000+\\frac{1}{2}\\cdot 5000+\\frac{1}{4}\\cdot 100=250+2500+25=2775.\n$$\n四舍五入到三位有效数字得到\n$$\n2.78 \\times 10^{3}.\n$$", "answer": "$$\\boxed{2.78 \\times 10^{3}}$$", "id": "1928933"}, {"introduction": "在上一个练习的基础上，这个两阶段实验问题增加了问题的复杂度。第一阶段的结果将决定第二阶段的参数，这意味着我们的条件期望本身是一个随机变量的函数。通过解决这个问题 ([@problem_id:1400510])，你将练习如何计算这个函数的期望，这是掌握全期望定律的关键一步。", "problem": "一个两阶段概率游戏的定义如下。在第一阶段，掷一颗公正的六面骰子。设这次投掷的整数结果为 $N$。在第二阶段，将一枚公正的硬币抛掷 $N$ 次。设 $H$ 表示从这些抛掷中观察到的正面总数。玩家在该游戏中的得分 $S$ 计算为正面次数的平方，即 $S = H^2$。\n\n得分的期望值 $E[S]$ 是多少？", "solution": "设 $N$ 为骰子结果，它均匀分布在 $\\{1,2,3,4,5,6\\}$ 上，且 $\\Pr(N=n)=\\frac{1}{6}$。在 $N=n$ 的条件下，正面次数 $H$ 服从参数为 $(n, p)$ 的二项分布，其中 $p=\\frac{1}{2}$，即 $H \\mid N=n \\sim \\mathrm{Binomial}(n, \\frac{1}{2})$。得分为 $S=H^{2}$，所以我们要求 $E[S]=E[H^{2}]$。\n\n根据全期望公式，\n$$\nE[H^{2}]=E\\!\\left(E[H^{2}\\mid N]\\right).\n$$\n对于一个二项随机变量 $X\\sim \\mathrm{Binomial}(n,p)$，等式\n$$\nE[X^{2}]=\\operatorname{Var}(X)+\\left(E[X]\\right)^{2}=np(1-p)+n^{2}p^{2}\n$$\n成立。将 $p=\\frac{1}{2}$ 代入此式，对于每个固定的 $n$，我们得到：\n$$\nE[H^{2}\\mid N=n]=n\\cdot \\frac{1}{2}\\left(1-\\frac{1}{2}\\right)+n^{2}\\left(\\frac{1}{2}\\right)^{2}=\\frac{n}{4}+\\frac{n^{2}}{4}=\\frac{n+n^{2}}{4}.\n$$\n因此，\n$$\nE[S]=E[H^{2}]=E\\!\\left(\\frac{N+N^{2}}{4}\\right)=\\frac{1}{4}\\left(E[N]+E[N^{2}]\\right).\n$$\n因为 $N$ 在 $\\{1,2,3,4,5,6\\}$ 上均匀分布，\n$$\nE[N]=\\frac{1}{6}\\sum_{n=1}^{6} n=\\frac{1}{6}\\cdot \\frac{6\\cdot 7}{2}=\\frac{7}{2},\n$$\n且\n$$\nE[N^{2}]=\\frac{1}{6}\\sum_{n=1}^{6} n^{2}=\\frac{1}{6}\\cdot \\frac{6\\cdot 7\\cdot 13}{6}=\\frac{91}{6}.\n$$\n因此，\n$$\nE[S]=\\frac{1}{4}\\left(\\frac{7}{2}+\\frac{91}{6}\\right)=\\frac{1}{4}\\cdot \\frac{112}{6}=\\frac{112}{24}=\\frac{14}{3}.\n$$", "answer": "$$\\boxed{\\frac{14}{3}}$$", "id": "1400510"}, {"introduction": "最后一个练习将我们对条件作用的理解从期望推广到方差。我们将使用全方差定律——一个由全期望定律衍生而来的强大工具——来分析一个随机游走问题，其中连基本步的概率本身也是随机的。这个问题 ([@problem_id:1928914]) 突显了条件思想在处理多层次不确定性问题时的普适性和强大威力。", "problem": "一个粒子进行一维随机游走，总共包含 $N$ 个离散步。在过程的一开始，从区间 $[0, 1]$ 上的连续均匀分布中抽取一个值作为向右移动的概率 $p$。之后的所有 $N$ 步都使用这个相同的概率 $p$。在每一步中，粒子以概率 $p$ 移动 $+1$，或以概率 $1-p$ 移动 $-1$。设随机变量 $S_N$ 表示粒子经过 $N$ 步后的最终位置，假设其从原点出发。\n\n求最终位置的方差 $\\text{Var}(S_N)$。请将答案表示为 $N$ 的函数。", "solution": "设 $X_{i}$ 表示第 $i$ 步的移动，其中 $X_{i}\\in\\{-1,+1\\}$。在给定随机选择的 $p\\in[0,1]$ 的条件下，各步是独立同分布的，其期望为\n$$\n\\mathbb{E}[X_{i}\\,|\\,p]=(+1)p+(-1)(1-p)=2p-1,\n$$\n并且由于 $X_{i}^{2}=1$，\n$$\n\\operatorname{Var}(X_{i}\\,|\\,p)=\\mathbb{E}[X_{i}^{2}\\,|\\,p]-\\left(\\mathbb{E}[X_{i}\\,|\\,p]\\right)^{2}=1-(2p-1)^{2}=4p(1-p).\n$$\n$N$ 步后的位置是 $S_{N}=\\sum_{i=1}^{N}X_{i}$。在给定 $p$ 的条件下，\n$$\n\\mathbb{E}[S_{N}\\,|\\,p]=N(2p-1),\\qquad \\operatorname{Var}(S_{N}\\,|\\,p)=N\\cdot 4p(1-p)=4N\\,p(1-p).\n$$\n根据全方差公式，\n$$\n\\operatorname{Var}(S_{N})=\\mathbb{E}\\!\\left[\\operatorname{Var}(S_{N}\\,|\\,p)\\right]+\\operatorname{Var}\\!\\left(\\mathbb{E}[S_{N}\\,|\\,p]\\right).\n$$\n对于 $p\\sim\\operatorname{Unif}[0,1]$，我们计算\n$$\n\\mathbb{E}[p]=\\int_{0}^{1}p\\,dp=\\frac{1}{2},\\qquad \\mathbb{E}[p^{2}]=\\int_{0}^{1}p^{2}\\,dp=\\frac{1}{3},\n$$\n所以\n$$\n\\mathbb{E}[p(1-p)]=\\mathbb{E}[p]-\\mathbb{E}[p^{2}]=\\frac{1}{2}-\\frac{1}{3}=\\frac{1}{6}.\n$$\n因此\n$$\n\\mathbb{E}\\!\\left[\\operatorname{Var}(S_{N}\\,|\\,p)\\right]=\\mathbb{E}\\!\\left[4N\\,p(1-p)\\right]=4N\\cdot\\frac{1}{6}=\\frac{2N}{3}.\n$$\n对于第二项，\n$$\n\\operatorname{Var}\\!\\left(\\mathbb{E}[S_{N}\\,|\\,p]\\right)=\\operatorname{Var}\\!\\left(N(2p-1)\\right)=N^{2}\\operatorname{Var}(2p-1)=N^{2}\\cdot 4\\,\\operatorname{Var}(p),\n$$\n并且\n$$\n\\operatorname{Var}(p)=\\mathbb{E}[p^{2}]-(\\mathbb{E}[p])^{2}=\\frac{1}{3}-\\left(\\frac{1}{2}\\right)^{2}=\\frac{1}{12},\n$$\n所以\n$$\n\\operatorname{Var}\\!\\left(\\mathbb{E}[S_{N}\\,|\\,p]\\right)=N^{2}\\cdot 4\\cdot\\frac{1}{12}=\\frac{N^{2}}{3}.\n$$\n将这两项贡献相加，得到\n$$\n\\operatorname{Var}(S_{N})=\\frac{2N}{3}+\\frac{N^{2}}{3}=\\frac{N(N+2)}{3}.\n$$", "answer": "$$\\boxed{\\frac{N(N+2)}{3}}$$", "id": "1928914"}]}