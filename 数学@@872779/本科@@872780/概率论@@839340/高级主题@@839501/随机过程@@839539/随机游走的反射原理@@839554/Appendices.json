{"hands_on_practices": [{"introduction": "此练习探讨了一个经典问题，通常被称为“投票问题”，它是反射原理的一个直接而优美的应用。通过解决这个问题，你将学会如何利用反射原理，在已知随机游走起点和终点的情况下，计算其路径始终保持在特定边界之上的条件概率。这个练习不仅展示了理论的强大，其结果的简洁性也揭示了随机过程中深刻的对称性。[@problem_id:1405585]", "problem": "一个算法交易机器人分析一种波动性加密货币的价格。该机器人将价格变动建模为简单的对称随机游走。从我们设为 $0$ 的参考价格开始，在每分钟结束时，价格以相等的概率变化 +$1 或 -$1。\n\n该机器人被编程了一条特定的风险管理规则：只要资产价格严格保持在初始购买价格之上，它就会持有该资产。如果在购买后的任何一分钟，价格回到或低于初始价格，机器人会立即卖出该资产。\n\n假设机器人购买了该资产，并经过了 $2n$ 分钟的时间。观察到在这 $2n$ 分钟结束时，资产价格恰好比初始价格高出 $2k$ 美元，其中 $n$ 和 $k$ 是满足 $n \\ge k$ 的正整数。\n\n给定最终价格为 $2k$ 的观察结果，机器人在整个 $2n$ 分钟区间内*没有*卖出资产的概率是多少？请用 $n$ 和 $k$ 表示您的答案，形式为一个封闭形式的解析表达式。", "solution": "设 $\\{X_{t}\\}_{t=1}^{2n}$ 为独立同分布的步长，满足 $\\mathbb{P}(X_{t}=1)=\\mathbb{P}(X_{t}=-1)=\\frac{1}{2}$，并定义随机游走 $S_{0}=0$, $S_{t}=\\sum_{i=1}^{t}X_{i}$。机器人在 $2n$ 分钟内不卖出，当且仅当其路径在所有中间时刻都严格保持在初始价格之上，即\n$$\nS_{t}0 \\quad \\text{for all } t\\in\\{1,2,\\ldots,2n\\}.\n$$\n\n以观察到的最终值 $S_{2n}=2k$（其中 $n\\geq k\\geq 1$）为条件。令 $U$ 和 $D$ 分别表示 +$1$ 和 -$1$ 步长的总数。那么\n$$\nU-D=S_{2n}=2k,\\qquad U+D=2n \\;\\;\\Rightarrow\\;\\; U=n+k,\\; D=n-k.\n$$\n在此条件下，所有恰好有 $U=n+k$ 次上涨和 $D=n-k$ 次下跌的序列都是等可能的，其总数为\n$$\nN_{\\text{tot}}=\\binom{2n}{n+k}.\n$$\n\n令 $N_{+}$ 为在这类序列中，其部分和在所有时刻 $t=1,\\ldots,2n$ 都严格为正的序列数量。条件 $S_{t}0$ 对所有 $t$ 成立，等价于对于序列的每一个前缀，上涨的步数都严格多于下跌的步数，即对所有 $t$ 都有 $U_{t}D_{t}$。根据 Bertrand 的投票定理，在给定 $UD$ 的情况下，满足对所有 $t$ 都有 $U_{t}D_{t}$ 的序列数量为\n$$\nN_{+}=\\frac{U-D}{U+D}\\,N_{\\text{tot}}=\\frac{(n+k)-(n-k)}{(n+k)+(n-k)}\\,\\binom{2n}{n+k}=\\frac{2k}{2n}\\,\\binom{2n}{n+k}.\n$$\n因此，所求的条件概率为\n$$\n\\mathbb{P}\\!\\left(\\text{no sell during }2n\\ \\big|\\ S_{2n}=2k\\right)=\\frac{N_{+}}{N_{\\text{tot}}}=\\frac{2k}{2n}=\\frac{k}{n}.\n$$\n这是一个用 $n$ 和 $k$ 表示的封闭形式表达式。", "answer": "$$\\boxed{\\frac{k}{n}}$$", "id": "1405585"}, {"introduction": "掌握了路径形状的条件概率后，我们转向另一个核心概念：首达时间。这个练习要求你计算一个对称随机游走首次到达距原点特定距离的精确时间点的概率。这类问题在金融（例如，期权定价中的障碍突破）和物理学（例如，粒子扩散到吸收壁）等领域至关重要，它能帮助你熟练运用反射原理来处理关于“何时”发生的问题。[@problem_id:1405604]", "problem": "一个质点在整数集 $\\mathbb{Z}$ 上进行对称随机游走。它从原点开始，因此其初始位置为 $S_0=0$。在每个离散时间步，质点以 $1/2$ 的概率向右移动一个单位，或以 $1/2$ 的概率向左移动一个单位。设 $S_n$ 表示质点在 $n$ 步之后的位置。\n\n计算质点与原点的距离首次达到至少5个单位发生在第9步的概率。也就是说，求事件 $|S_9| \\ge 5$ 且对于所有满足 $1 \\le k  9$ 的整数 $k$ 都有 $|S_k|  5$ 的概率。\n\n请用最简分数表示你的答案。", "solution": "设 $T$ 表示与原点的距离首次达到至少 $5$ 的时间，即 $T=\\min\\{n\\geq 1:|S_{n}|\\geq 5\\}$。我们要计算 $\\Pr(T=9)$。\n\n首先观察到，如果 $|S_{9}| \\geq 7$，那么该游走必然在某个 $k9$ 的时刻经过了 $|S_{k}|=5$（因为步长为单位大小）。因此，事件 $\\{T=9\\}$ 要求 $|S_{9}|=5$。所以，\n$$\n\\Pr(T=9)=\\Pr(S_{9}=5,\\ \\max_{1\\leq k9}S_{k}\\leq 4)+\\Pr(S_{9}=-5,\\ \\min_{1\\leq k9}S_{k}\\geq -4).\n$$\n根据对称性，\n$$\n\\Pr(T=9)=2\\,\\Pr\\big(S_{9}=5,\\ \\max_{1\\leq k9}S_{k}\\leq 4\\big).\n$$\n\n为了计算 $\\Pr\\big(S_{9}=5,\\ \\max_{k9}S_{k}\\leq 4\\big)$，注意到 $S_{9}=5$ 需要 $7$ 次向右移动和 $2$ 次向左移动，所以在 $9$ 步内从 $0$ 到 $5$ 的路径总数为 $\\binom{9}{7}$。在这些路径中，首次在时间 $9$ 到达 $5$（即在时间 $8$ 之前一直保持 $\\leq 4$）的数量由投票定理（或反射原理）给出，为\n$$\n\\frac{5}{9}\\binom{9}{7}.\n$$\n因此，\n$$\n\\Pr\\big(S_{9}=5,\\ \\max_{k9}S_{k}\\leq 4\\big)=\\frac{\\frac{5}{9}\\binom{9}{7}}{2^{9}}.\n$$\n对于结束于 $-5$ 的对称情况，将其加倍可得\n$$\n\\Pr(T=9)=2\\cdot \\frac{\\frac{5}{9}\\binom{9}{7}}{2^{9}}=\\frac{10}{9}\\cdot \\frac{\\binom{9}{7}}{2^{9}}.\n$$\n因为 $\\binom{9}{7}=\\binom{9}{2}=36$，我们化简得：\n$$\n\\Pr(T=9)=\\frac{10}{9}\\cdot \\frac{36}{2^{9}}=\\frac{10\\cdot 4}{2^{9}}=\\frac{40}{512}=\\frac{5}{64}.\n$$\n该分数为最简形式。", "answer": "$$\\boxed{\\frac{5}{64}}$$", "id": "1405604"}, {"introduction": "本章的最后一个练习将挑战你应用反射原理来解决一个更高级的问题：计算条件期望。你将不仅是计算一个概率，而是要先推导出在给定终点条件下，随机游走路径最大值的完整概率分布。这个问题充分展示了反射原理的威力，它不仅能判断事件是否发生，还能对随机变量（如路径最大值）的统计特性进行精确的量化描述。[@problem_id:1405583]", "problem": "一个可编程的纳米粒子被限制在一条一维轨道上移动。从定义为 $x=0$ 的原点出发，它进行一系列共 $n$ 个离散的步进。每一步，它都会向正方向或负方向移动一个固定的距离 $L$，两种选择的概率相等，均为 $1/2$。\n\n设粒子在 $k$ 步之后的位置为 $x_k$。整个过程共包含 $n=10$ 步。在过程结束时，一次测量显示该纳米粒子位于最终位置 $x_{10} = 2L$。\n\n已知这个最终位置，纳米粒子在其运动过程中达到的最大正位置 $\\max_{0 \\le k \\le 10} \\{x_k\\}$ 的期望值是多少？将你的答案表示为一个乘以 $L$ 的单一分数形式。", "solution": "设 $S_{k}$ 为一个简单对称随机游走，满足 $S_{0}=0$，增量为 $\\pm 1$ 且概率均为 $1/2$，因此 $x_{k}=L S_{k}$。我们已知 $S_{10}=2$ (等价于 $x_{10}=2L$)。定义该随机游走的最大值为 $M=\\max_{0\\leq k \\leq 10} S_{k}$。所求的期望值为\n$$\n\\mathbb{E}\\!\\left[\\max_{0\\leq k\\leq 10} x_{k}\\,\\big|\\,x_{10}=2L\\right]\n= L\\,\\mathbb{E}\\!\\left[M\\,\\big|\\,S_{10}=2\\right].\n$$\n因此，我们只需计算 $\\mathbb{E}[M\\,|\\,S_{10}=2]$。\n\n在 $S_{10}=2$ 的条件下，该随机游走恰好有 6 次向上步和 4 次向下步，并且所有 $\\binom{10}{6}$ 种这样的序列都是等可能的。为了找到在 $S_{10}=2$ 条件下 $M$ 的分布，我们使用关于上边界的反射原理。对于整数 $m$，设 $N_{\\leq m}$ 表示从 0 到 2 的长度为 10 的路径中，最大值至多为 $m$ 的路径数量。根据反射原理，至少触及一次水平线 $m+1$ 的路径数，等于从反射后的起点 $(0, 2(m+1))$ 到终点 $(10,2)$ 的无限制路径数。因此\n$$\nN_{\\leq m}\n= \\binom{10}{\\frac{10+2}{2}} - \\binom{10}{\\frac{10+2 - 2(m+1)}{2}}\n= \\binom{10}{6} - \\binom{10}{5 - m},\n$$\n并约定如果 $k0$ 或 $k10$，则 $\\binom{10}{k}=0$。因此\n$$\n\\mathbb{P}(M \\leq m \\mid S_{10}=2)\n= \\frac{N_{\\leq m}}{\\binom{10}{6}}\n= 1 - \\frac{\\binom{10}{5 - m}}{\\binom{10}{6}}.\n$$\n因为 $S_{10}=2$，所以必然有 $M\\in\\{2,3,4,5,6\\}$。使用 $\\binom{10}{6}=210$ 以及 $\\binom{10}{3}=120$、$\\binom{10}{2}=45$、$\\binom{10}{1}=10$、$\\binom{10}{0}=1$ 这些值，计算当 $m=2,3,4,5,6$ 时 $\\mathbb{P}(M \\leq m \\mid S_{10}=2)$ 的值：\n$$\n\\mathbb{P}(M \\leq 2 \\mid S_{10}=2)=\\frac{210-120}{210}=\\frac{3}{7},\n$$\n$$\n\\mathbb{P}(M \\leq 3 \\mid S_{10}=2)=\\frac{210-45}{210}=\\frac{11}{14},\n$$\n$$\n\\mathbb{P}(M \\leq 4 \\mid S_{10}=2)=\\frac{210-10}{210}=\\frac{20}{21},\n$$\n$$\n\\mathbb{P}(M \\leq 5 \\mid S_{10}=2)=\\frac{210-1}{210}=\\frac{209}{210},\n$$\n$$\n\\mathbb{P}(M \\leq 6 \\mid S_{10}=2)=1.\n$$\n因此\n$$\n\\mathbb{P}(M=2 \\mid S_{10}=2)=\\frac{3}{7},\\quad\n\\mathbb{P}(M=3 \\mid S_{10}=2)=\\frac{11}{14}-\\frac{3}{7}=\\frac{5}{14},\n$$\n$$\n\\mathbb{P}(M=4 \\mid S_{10}=2)=\\frac{20}{21}-\\frac{11}{14}=\\frac{1}{6},\\quad\n\\mathbb{P}(M=5 \\mid S_{10}=2)=\\frac{209}{210}-\\frac{20}{21}=\\frac{3}{70},\n$$\n$$\n\\mathbb{P}(M=6 \\mid S_{10}=2)=1-\\frac{209}{210}=\\frac{1}{210}.\n$$\n因此\n$$\n\\mathbb{E}[M \\mid S_{10}=2]\n= 2\\cdot\\frac{3}{7}+3\\cdot\\frac{5}{14}+4\\cdot\\frac{1}{6}+5\\cdot\\frac{3}{70}+6\\cdot\\frac{1}{210}.\n$$\n将各项用公分母210表示：\n$$\n2\\cdot\\frac{3}{7}=\\frac{180}{210},\\quad\n3\\cdot\\frac{5}{14}=\\frac{225}{210},\\quad\n4\\cdot\\frac{1}{6}=\\frac{140}{210},\\quad\n5\\cdot\\frac{3}{70}=\\frac{45}{210},\\quad\n6\\cdot\\frac{1}{210}=\\frac{6}{210},\n$$\n所以\n$$\n\\mathbb{E}[M \\mid S_{10}=2]=\\frac{180+225+140+45+6}{210}=\\frac{596}{210}=\\frac{298}{105}.\n$$\n最后，\n$$\n\\mathbb{E}\\!\\left[\\max_{0\\leq k\\leq 10} x_{k}\\,\\big|\\,x_{10}=2L\\right]\n= L\\,\\mathbb{E}[M \\mid S_{10}=2] = \\frac{298}{105}\\,L.\n$$", "answer": "$$\\boxed{\\frac{298}{105}L}$$", "id": "1405583"}]}