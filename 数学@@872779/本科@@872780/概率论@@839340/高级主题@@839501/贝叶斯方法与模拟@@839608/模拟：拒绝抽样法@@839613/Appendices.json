{"hands_on_practices": [{"introduction": "要掌握拒绝采样法，我们从一个基础示例开始。这个练习要求你使用一个简单的均匀提议分布，从在统计学中常见的 Beta 分布中进行采样。这个练习 [@problem_id:1387131] 的核心是确定最优常数 $M$ 并计算总接受概率，后者直接衡量了采样器的效率。", "problem": "一位数据科学家正在实现一个拒绝采样算法，以生成服从特定目标分布的随机数。目标分布是参数为 $\\alpha = 2$ 和 $\\beta = 2$ 的 Beta 分布。这个目标分布的概率密度函数 (PDF) 记为 $f(x)$，由下式给出：\n$$f(x) = 6x(1-x) \\quad \\text{对于 } x \\in [0, 1]$$\n在其他情况下 $f(x) = 0$。\n\n对于提议分布，该数据科学家使用标准均匀分布 U(0, 1)。这个提议分布的概率密度函数记为 $g(x)$，为：\n$$g(x) = 1 \\quad \\text{对于 } x \\in [0, 1]$$\n在其他情况下 $g(x) = 0$。\n\n拒绝采样方法需要找到一个常数 $M$，使得不等式 $f(x) \\le M g(x)$ 对所有可能的 $x$ 值都成立。为了最大化采样过程的效率，选择 $M$ 的最小可能值。然后，该算法从提议分布 $g(x)$ 中生成一个样本 $Y$，并以概率 $\\frac{f(Y)}{M g(Y)}$ 接受它。\n\n计算从提议分布中抽取的样本被接受的整体理论概率。将您的答案表示为精确分数。", "solution": "我们需要找到最小的常数 $M$，使得对所有 $x$ 都有 $f(x) \\le M g(x)$。由于当 $x \\in [0,1]$ 时 $g(x)=1$，其他情况下 $g(x)=0$，该条件在 $[0,1]$ 上简化为 $f(x) \\le M$。因此，最小的可行 $M$ 值是 $f(x)$ 在 $[0,1]$ 上的上确界。\n\n计算 $f(x)=6x(1-x)=6(x - x^{2})$ 在 $[0,1]$ 上的最大值。求导：\n$$\nf'(x)=6(1-2x), \\quad f''(x)=-12.\n$$\n令 $f'(x)=0$ 得 $x=\\frac{1}{2}$。由于 $f''(x)0$，这是一个最大值。计算\n$$\nM=\\max_{x \\in [0,1]} f(x)=f\\!\\left(\\tfrac{1}{2}\\right)=6 \\cdot \\tfrac{1}{2} \\cdot \\left(1-\\tfrac{1}{2}\\right)=\\frac{3}{2}.\n$$\n\n给定 $Y \\sim g$，在 $Y=y$ 条件下的接受概率为 $\\frac{f(y)}{M g(y)}$。整体接受概率是在 $g$ 分布下的期望值：\n$$\n\\mathbb{P}(\\text{accept})=\\mathbb{E}_{g}\\!\\left[\\frac{f(Y)}{M g(Y)}\\right]=\\int_{0}^{1} \\frac{f(x)}{M g(x)} g(x) \\, dx=\\frac{1}{M} \\int_{0}^{1} f(x) \\, dx.\n$$\n由于 $f$ 是 $[0,1]$ 上的一个概率密度函数，所以 $\\int_{0}^{1} f(x) \\, dx=1$。为完整起见，我们验证一下：\n$$\n\\int_{0}^{1} 6x(1-x)\\,dx=6 \\int_{0}^{1} \\left(x - x^{2}\\right) dx=6 \\left(\\frac{1}{2}-\\frac{1}{3}\\right)=1.\n$$\n因此，\n$$\n\\mathbb{P}(\\text{accept})=\\frac{1}{M}=\\frac{1}{\\frac{3}{2}}=\\frac{2}{3}.\n$$", "answer": "$$\\boxed{\\frac{2}{3}}$$", "id": "1387131"}, {"introduction": "拒绝采样法是一种通用工具，其应用不仅限于连续分布。在本次实践中 [@problem_id:1387122]，我们将通过使用公平骰子模拟有偏骰子，来探索其在离散领域的应用。这个问题将帮助你理解如何将拒绝采样的核心原理应用于离散概率质量函数，并优化过程以实现最高效率。", "problem": "一次计算机模拟需要根据目标概率分布 $P$ 从集合 $\\{1, 2, 3\\}$ 中生成随机整数，其中 $P(X=1) = 0.5$，$P(X=2) = 0.3$ 且 $P(X=3) = 0.2$。唯一可用的随机数生成器是一个模拟公平六面骰子的函数，它以均匀概率返回集合 $\\{1, 2, 3, 4, 5, 6\\}$ 中的一个整数。\n\n一位工程师设计了以下两步流程来从目标分布 $P$ 中生成一个数：\n**步骤 1 (提议):** 使用公平六面骰子模拟器生成一个数 $y$。\n**步骤 2 (接受/拒绝):**\n- 如果 $y=1$，以概率 $c_1$ 接受此提议。\n- 如果 $y=2$，以概率 $c_2$ 接受此提议。\n- 如果 $y=3$，以概率 $c_3$ 接受此提议。\n- 如果 $y \\in \\{4, 5, 6\\}$，则总是拒绝此提议（接受概率为 0）。\n如果提议被接受，流程终止并返回 $y$ 的值。如果被拒绝，流程从步骤 1 重新开始。\n\n必须选择概率 $c_1, c_2, c_3$ 以满足两个条件：\n1. 被接受的数的分布必须与目标分布 $P$ 相匹配。\n2. 在单次运行两步流程中接受提议的总概率必须最大化。\n\n在这个最优配置的流程中，单次运行接受一个提议的总概率是多少？请将你的答案表示为最简分数形式。", "solution": "设提议分布为 $q(y)$，其中对于 $i\\in\\{1,2,3,4,5,6\\}$，有 $q(i)=\\frac{1}{6}$。设当 $y=i$ 时，接受概率为 $c_{i}$（对于 $i\\in\\{1,2,3\\}$），且对于 $i\\in\\{4,5,6\\}$，$c_{i}=0$。单次运行中接受的总概率为\n$$\nA=\\sum_{i=1}^{3} q(i)c_{i}=\\frac{1}{6}\\left(c_{1}+c_{2}+c_{3}\\right).\n$$\n条件 1 要求接受值的分布与目标 $P$ 相匹配，即对于 $i\\in\\{1,2,3\\}$，\n$$\nP_{i}=\\frac{q(i)c_{i}}{A} \\quad\\Longrightarrow\\quad c_{i}=\\frac{A P_{i}}{q(i)}.\n$$\n由于接受概率必须满足 $0\\leq c_{i}\\leq 1$，我们得到约束条件\n$$\n\\frac{A P_{i}}{q(i)}\\leq 1 \\quad\\Longrightarrow\\quad A\\leq \\frac{q(i)}{P_{i}} \\quad (i=1,2,3).\n$$\n因此，最大可行 $A$ 为\n$$\nA_{\\max}=\\min_{i\\in\\{1,2,3\\}} \\frac{q(i)}{P_{i}}.\n$$\n已知 $q(i)=\\frac{1}{6}$ 且 $P_{1}=\\frac{1}{2}$，$P_{2}=\\frac{3}{10}$，$P_{3}=\\frac{1}{5}$，\n$$\n\\frac{q(1)}{P_{1}}=\\frac{1/6}{1/2}=\\frac{1}{3},\\quad \\frac{q(2)}{P_{2}}=\\frac{1/6}{3/10}=\\frac{5}{9},\\quad \\frac{q(3)}{P_{3}}=\\frac{1/6}{1/5}=\\frac{5}{6}.\n$$\n因此\n$$\nA_{\\max}=\\min\\left\\{\\frac{1}{3},\\frac{5}{9},\\frac{5}{6}\\right\\}=\\frac{1}{3}.\n$$\n为完整起见，相应的接受概率为\n$$\nc_{i}=\\frac{A_{\\max} P_{i}}{q(i)}=6 A_{\\max} P_{i}=2 P_{i},\n$$\n得出 $c_{1}=1$，$c_{2}=\\frac{3}{5}$，$c_{3}=\\frac{2}{5}$，所有值均在 $[0,1]$ 范围内。因此，在最优配置下，单次运行的总体接受概率为 $\\frac{1}{3}$。", "answer": "$$\\boxed{\\frac{1}{3}}$$", "id": "1387122"}, {"introduction": "真正高效的采样通常不僅僅是应用一种方法，更需要对其进行优化。这个高级练习 [@problem_id:1387078] 深入探讨了设计最优采样器的实际问题。你的任务是为一个拉普拉斯提议分布找到完美的尺度参数，以便从高斯目标分布中进行采样，从而最大限度地减少被拒绝的样本并提高计算效率。", "problem": "一位工程师正在设计一个模拟，用于为一个物理模型从一个特定的目标分布中生成随机数。目标概率密度函数 (PDF)，记为 $f(x)$，是通过贝叶斯分析确定的。具体来说，$f(x)$ 是在给定一系列实验测量值的情况下，参数 $x$ 的后验分布。$x$ 的先验分布被假设为在整个实数线上是均匀的。测量值 $d_1, d_2, \\dots, d_n$ 是独立地从一个均值为 $x$、已知方差为 $\\tau^2$ 的高斯分布中抽取的。收集数据后，发现 $n=5$，方差为 $\\tau^2 = 2$，且测量值的总和恰好为零，即 $\\sum_{i=1}^{n} d_i = 0$。\n\n为了进行模拟，该工程师使用拒绝采样法。提议分布是一个可以被高效生成的拉普拉斯分布。该提议分布的PDF由 $g(x) = \\frac{1}{2b} \\exp\\left(-\\frac{|x|}{b}\\right)$ 给出，其中 $b0$ 是一个可调的尺度参数。\n\n当接受率最大化时，拒绝采样法的效率也达到最高。接受率与常数 $M = \\sup_{x \\in \\mathbb{R}} \\frac{f(x)}{g(x)}$ 成反比。为了优化模拟，工程师需要找到使这个常数 $M$ 最小化的参数 $b$ 的值。\n\n确定使模拟效率最大化的 $b$ 的精确最优值。请将最终答案表示为解析表达式。", "solution": "$x$ 的先验是在 $\\mathbb{R}$ 上的均匀分布，这是一个非正常先验。在已知方差为 $\\tau^{2}$ 和 $n$ 个独立的高斯测量值 $d_{i} \\sim \\mathcal{N}(x,\\tau^{2})$ 的情况下，似然函数为\n$$\nL(x) \\propto \\left(\\frac{1}{\\sqrt{2 \\pi \\tau^{2}}}\\right)^{n} \\exp\\left(-\\frac{1}{2 \\tau^{2}} \\sum_{i=1}^{n} (d_{i}-x)^{2}\\right).\n$$\n通过配方法，\n$$\n\\sum_{i=1}^{n} (d_{i}-x)^{2} = n(x-\\bar{d})^{2} + \\sum_{i=1}^{n} (d_{i}-\\bar{d})^{2},\n$$\n其中 $\\bar{d} = \\frac{1}{n} \\sum_{i=1}^{n} d_{i}$。在均匀先验下，后验分布与关于 $x$ 的似然函数成正比，因此\n$$\nf(x) = \\sqrt{\\frac{n}{2 \\pi \\tau^{2}}}\\,\\exp\\left(-\\frac{n(x-\\bar{d})^{2}}{2 \\tau^{2}}\\right).\n$$\n给定 $\\sum_{i=1}^{n} d_{i} = 0$ 和 $n=5$，我们有 $\\bar{d}=0$，所以\n$$\nf(x) = \\sqrt{\\frac{n}{2 \\pi \\tau^{2}}}\\,\\exp\\left(-\\frac{n x^{2}}{2 \\tau^{2}}\\right).\n$$\n\n提议密度是尺度为 $b0$ 的拉普拉斯分布：\n$$\ng(x) = \\frac{1}{2 b}\\,\\exp\\left(-\\frac{|x|}{b}\\right).\n$$\n拒绝常数为\n$$\nM(b) = \\sup_{x \\in \\mathbb{R}} \\frac{f(x)}{g(x)} = 2 b \\sqrt{\\frac{n}{2 \\pi \\tau^{2}}}\\, \\sup_{x \\in \\mathbb{R}} \\exp\\left(-\\frac{n x^{2}}{2 \\tau^{2}} + \\frac{|x|}{b}\\right).\n$$\n定义\n$$\n\\phi(x) = -\\frac{n x^{2}}{2 \\tau^{2}} + \\frac{|x|}{b}.\n$$\n根据对称性，我们在 $x \\geq 0$ 的范围内进行最大化。那么\n$$\n\\phi(x) = -a x^{2} + c x,\\quad a = \\frac{n}{2 \\tau^{2}},\\quad c = \\frac{1}{b}.\n$$\n这个凹二次函数在以下点达到其最大值\n$$\nx^{\\star} = \\frac{c}{2 a} = \\frac{\\tau^{2}}{n b},\n$$\n最大值为\n$$\n\\phi(x^{\\star}) = -a \\left(\\frac{\\tau^{2}}{n b}\\right)^{2} + c \\left(\\frac{\\tau^{2}}{n b}\\right) = -\\frac{\\tau^{2}}{2 n b^{2}} + \\frac{\\tau^{2}}{n b^{2}} = \\frac{\\tau^{2}}{2 n b^{2}}.\n$$\n因此，\n$$\nM(b) = 2 b \\sqrt{\\frac{n}{2 \\pi \\tau^{2}}}\\, \\exp\\left(\\frac{\\tau^{2}}{2 n b^{2}}\\right).\n$$\n为了在 $b0$ 的范围内最小化 $M(b)$，我们最小化\n$$\nm(b) = b \\exp\\left(\\frac{\\tau^{2}}{2 n b^{2}}\\right).\n$$\n考虑 $\\ln m(b) = \\ln b + \\frac{\\tau^{2}}{2 n b^{2}}$。对其求导并设为零：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} b} \\ln m(b) = \\frac{1}{b} - \\frac{\\tau^{2}}{n b^{3}} = 0 \\quad \\Longrightarrow \\quad b^{2} = \\frac{\\tau^{2}}{n}.\n$$\n这个临界点是一个全局最小值点，因为当 $b \\to 0^{+}$ 和 $b \\to \\infty$ 时，$m(b) \\to \\infty$。因此最优尺度为\n$$\nb^{\\star} = \\frac{\\tau}{\\sqrt{n}}.\n$$\n代入给定值 $\\tau^{2} = 2$ 和 $n=5$ 得\n$$\nb^{\\star} = \\sqrt{\\frac{2}{5}}.\n$$", "answer": "$$\\boxed{\\sqrt{\\frac{2}{5}}}$$", "id": "1387078"}]}