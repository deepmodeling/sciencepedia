{"hands_on_practices": [{"introduction": "This first practice serves as a foundational exercise to build a robust understanding of the Hellmann-Feynman theorem. We will begin by applying the theorem to a simple but non-trivial two-level quantum system, a ubiquitous model in chemistry and physics. By comparing the result with a direct analytical calculation, this exercise ([@problem_id:2814495]) allows for a concrete verification of the theorem and illuminates the conditions under which it holds, particularly the crucial requirement of non-degenerate energy levels.", "problem": "A parametric Hamiltonian $H(\\lambda)$ acting on a finite-dimensional Hilbert space has instantaneous eigenpairs $\\{E_{n}(\\lambda),\\,|\\psi_{n}(\\lambda)\\rangle\\}$ that satisfy the time-independent Schrödinger equation $H(\\lambda)\\,|\\psi_{n}(\\lambda)\\rangle=E_{n}(\\lambda)\\,|\\psi_{n}(\\lambda)\\rangle$ and the normalization condition $\\langle\\psi_{n}(\\lambda)|\\psi_{n}(\\lambda)\\rangle=1$. Assume that for a fixed eigenvalue label $n$, $E_{n}(\\lambda)$ is non-degenerate and the mapping $\\lambda\\mapsto H(\\lambda)$ is differentiable in an open interval of interest. \n\nStarting from these fundamental relations and without invoking any external theorems, first derive a general identity for the parametric energy derivative $dE_{n}(\\lambda)/d\\lambda$ in terms of $|\\psi_{n}(\\lambda)\\rangle$ and $\\partial H(\\lambda)/\\partial\\lambda$. Then, specialize to the $2$-level Hamiltonian\n$$\nH(\\lambda)=\\begin{pmatrix}\\Delta & \\lambda\\\\ \\lambda & -\\Delta\\end{pmatrix},\n$$\nwhere $\\Delta\\in\\mathbb{R}$ is a fixed parameter and $\\lambda\\in\\mathbb{R}$ is the control parameter, and compute $dE_{\\pm}(\\lambda)/d\\lambda$ for its two eigenvalues $E_{\\pm}(\\lambda)$. To make your computation explicit, you may construct the normalized eigenvectors of $H(\\lambda)$ and evaluate any inner products that appear. \n\nIndependently, diagonalize $H(\\lambda)$ analytically to obtain closed-form expressions for $E_{\\pm}(\\lambda)$ and differentiate them directly with respect to $\\lambda$. Compare with your previous result and briefly explain any conditions under which the identity you derived holds or may fail for this model.\n\nReport your final answer as the ordered pair $\\big(dE_{+}(\\lambda)/d\\lambda,\\,dE_{-}(\\lambda)/d\\lambda\\big)$ as a single closed-form analytic expression. No units are required. Do not round your answer.", "solution": "The problem posed is a standard exercise in quantum mechanical perturbation theory and is well-defined. It is scientifically grounded, self-contained, and objective. We shall proceed with its solution.\n\nFirst, we derive the general identity for the parametric derivative of an energy eigenvalue, which is known as the Hellmann-Feynman theorem. We begin with the time-independent Schrödinger equation for a non-degenerate eigenstate $|\\psi_{n}(\\lambda)\\rangle$:\n$$\nH(\\lambda)\\,|\\psi_{n}(\\lambda)\\rangle=E_{n}(\\lambda)\\,|\\psi_{n}(\\lambda)\\rangle\n$$\nThe energy eigenvalue $E_{n}(\\lambda)$ can be expressed as the expectation value of the Hamiltonian in this state, given the normalization condition $\\langle\\psi_{n}(\\lambda)|\\psi_{n}(\\lambda)\\rangle=1$:\n$$\nE_{n}(\\lambda) = \\langle\\psi_{n}(\\lambda)|H(\\lambda)|\\psi_{n}(\\lambda)\\rangle\n$$\nWe now differentiate this expression with respect to the parameter $\\lambda$, applying the product rule for differentiation:\n$$\n\\frac{dE_{n}(\\lambda)}{d\\lambda} = \\frac{d}{d\\lambda} \\Big( \\langle\\psi_{n}(\\lambda)|H(\\lambda)|\\psi_{n}(\\lambda)\\rangle \\Big)\n$$\n$$\n\\frac{dE_{n}(\\lambda)}{d\\lambda} = \\left(\\frac{d\\langle\\psi_{n}(\\lambda)|}{d\\lambda}\\right) H(\\lambda) |\\psi_{n}(\\lambda)\\rangle + \\langle\\psi_{n}(\\lambda)| \\left(\\frac{\\partial H(\\lambda)}{\\partial\\lambda}\\right) |\\psi_{n}(\\lambda)\\rangle + \\langle\\psi_{n}(\\lambda)| H(\\lambda) \\left(\\frac{d|\\psi_{n}(\\lambda)\\rangle}{d\\lambda}\\right)\n$$\nSince the Hamiltonian $H(\\lambda)$ is Hermitian, we can act with it on the bra vector or the ket vector. Using the Schrödinger equation, $H(\\lambda) |\\psi_{n}(\\lambda)\\rangle = E_n(\\lambda)|\\psi_{n}(\\lambda)\\rangle$ and its Hermitian conjugate $\\langle\\psi_{n}(\\lambda)| H(\\lambda) = \\langle\\psi_{n}(\\lambda)| E_n(\\lambda) = E_n(\\lambda)\\langle\\psi_{n}(\\lambda)|$. Substituting these into the expression gives:\n$$\n\\frac{dE_{n}(\\lambda)}{d\\lambda} = E_{n}(\\lambda) \\left(\\frac{d\\langle\\psi_{n}(\\lambda)|}{d\\lambda}\\right) |\\psi_{n}(\\lambda)\\rangle + \\left\\langle\\psi_{n}(\\lambda)\\left|\\frac{\\partial H(\\lambda)}{\\partial\\lambda}\\right|\\psi_{n}(\\lambda)\\right\\rangle + E_{n}(\\lambda) \\langle\\psi_{n}(\\lambda)| \\left(\\frac{d|\\psi_{n}(\\lambda)\\rangle}{d\\lambda}\\right)\n$$\nFactoring out the scalar energy eigenvalue $E_{n}(\\lambda)$:\n$$\n\\frac{dE_{n}(\\lambda)}{d\\lambda} = E_{n}(\\lambda) \\left[ \\left(\\frac{d\\langle\\psi_{n}(\\lambda)|}{d\\lambda}\\right) |\\psi_{n}(\\lambda)\\rangle + \\langle\\psi_{n}(\\lambda)| \\left(\\frac{d|\\psi_{n}(\\lambda)\\rangle}{d\\lambda}\\right) \\right] + \\left\\langle\\psi_{n}(\\lambda)\\left|\\frac{\\partial H(\\lambda)}{\\partial\\lambda}\\right|\\psi_{n}(\\lambda)\\right\\rangle\n$$\nThe term in the square brackets is precisely the derivative of the normalization condition:\n$$\n\\frac{d}{d\\lambda} \\langle\\psi_{n}(\\lambda)|\\psi_{n}(\\lambda)\\rangle = \\frac{d}{d\\lambda}(1) = 0\n$$\nThus, the first term vanishes, and we are left with the identity:\n$$\n\\frac{dE_{n}(\\lambda)}{d\\lambda} = \\left\\langle\\psi_{n}(\\lambda)\\left|\\frac{\\partial H(\\lambda)}{\\partial\\lambda}\\right|\\psi_{n}(\\lambda)\\right\\rangle\n$$\nThis is the Hellmann-Feynman theorem.\n\nNext, we specialize to the given $2$-level Hamiltonian:\n$$\nH(\\lambda) = \\begin{pmatrix} \\Delta & \\lambda \\\\ \\lambda & -\\Delta \\end{pmatrix}\n$$\nThe derivative of the Hamiltonian with respect to $\\lambda$ is trivial:\n$$\n\\frac{\\partial H(\\lambda)}{\\partial\\lambda} = \\begin{pmatrix} 0 & 1 \\\\ 1 & 0 \\end{pmatrix}\n$$\nTo apply the derived identity, we require the eigenvectors of $H(\\lambda)$. First, we find the eigenvalues $E_{\\pm}(\\lambda)$ from the characteristic equation $\\det(H(\\lambda) - E I) = 0$:\n$$\n(\\Delta - E)(-\\Delta - E) - \\lambda^{2} = 0 \\implies -(\\Delta^{2} - E^{2}) - \\lambda^{2} = 0 \\implies E^{2} = \\Delta^{2} + \\lambda^{2}\n$$\nThe two eigenvalues are $E_{+}(\\lambda) = \\sqrt{\\Delta^{2} + \\lambda^{2}}$ and $E_{-}(\\lambda) = -\\sqrt{\\Delta^{2} + \\lambda^{2}}$.\n\nNow we find the corresponding eigenvectors $|\\psi_{\\pm}(\\lambda)\\rangle = \\begin{pmatrix} a \\\\ b \\end{pmatrix}$. For a given eigenvalue $E$, the components satisfy $(\\Delta-E)a + \\lambda b = 0$. We can express the unnormalized eigenvector as $\\begin{pmatrix} \\lambda \\\\ E-\\Delta \\end{pmatrix}$.\nThe normalization constant $N$ is found from $N^{-2} = |\\lambda|^{2} + |E-\\Delta|^{2}$. Let's compute this normalization factor:\n$$\n|\\lambda|^{2} + |E_{\\pm}-\\Delta|^{2} = \\lambda^{2} + (E_{\\pm}-\\Delta)^{2} = \\lambda^{2} + E_{\\pm}^{2} - 2\\Delta E_{\\pm} + \\Delta^{2}\n$$\nSubstituting $E_{\\pm}^{2} = \\Delta^{2} + \\lambda^{2}$, we get:\n$$\n= (\\lambda^{2}+\\Delta^{2}) + E_{\\pm}^{2} - 2\\Delta E_{\\pm} = E_{\\pm}^{2} + E_{\\pm}^{2} - 2\\Delta E_{\\pm} = 2E_{\\pm}^{2} - 2\\Delta E_{\\pm} = 2E_{\\pm}(E_{\\pm}-\\Delta)\n$$\nThus, the normalized eigenvector is $|\\psi_{\\pm}(\\lambda)\\rangle = \\frac{1}{\\sqrt{2E_{\\pm}(E_{\\pm}-\\Delta)}} \\begin{pmatrix} \\lambda \\\\ E_{\\pm}-\\Delta \\end{pmatrix}$.\n\nWe now compute the expectation value $\\langle\\psi_{\\pm}|\\frac{\\partial H}{\\partial\\lambda}|\\psi_{\\pm}\\rangle$:\n$$\n\\frac{dE_{\\pm}}{d\\lambda} = \\frac{1}{2E_{\\pm}(E_{\\pm}-\\Delta)} \\begin{pmatrix} \\lambda & E_{\\pm}-\\Delta \\end{pmatrix} \\begin{pmatrix} 0 & 1 \\\\ 1 & 0 \\end{pmatrix} \\begin{pmatrix} \\lambda \\\\ E_{\\pm}-\\Delta \\end{pmatrix}\n$$\n$$\n= \\frac{1}{2E_{\\pm}(E_{\\pm}-\\Delta)} \\begin{pmatrix} \\lambda & E_{\\pm}-\\Delta \\end{pmatrix} \\begin{pmatrix} E_{\\pm}-\\Delta \\\\ \\lambda \\end{pmatrix}\n$$\n$$\n= \\frac{\\lambda(E_{\\pm}-\\Delta) + (E_{\\pm}-\\Delta)\\lambda}{2E_{\\pm}(E_{\\pm}-\\Delta)} = \\frac{2\\lambda(E_{\\pm}-\\Delta)}{2E_{\\pm}(E_{\\pm}-\\Delta)} = \\frac{\\lambda}{E_{\\pm}}\n$$\nSubstituting the expressions for $E_{\\pm}(\\lambda)$:\n$$\n\\frac{dE_{+}(\\lambda)}{d\\lambda} = \\frac{\\lambda}{E_{+}(\\lambda)} = \\frac{\\lambda}{\\sqrt{\\Delta^{2}+\\lambda^{2}}}\n$$\n$$\n\\frac{dE_{-}(\\lambda)}{d\\lambda} = \\frac{\\lambda}{E_{-}(\\lambda)} = \\frac{\\lambda}{-\\sqrt{\\Delta^{2}+\\lambda^{2}}} = -\\frac{\\lambda}{\\sqrt{\\Delta^{2}+\\lambda^{2}}}\n$$\nThis completes the calculation using the Hellmann-Feynman theorem.\n\nFor independent verification, we differentiate the eigenvalues directly.\n$$\nE_{\\pm}(\\lambda) = \\pm\\sqrt{\\Delta^{2} + \\lambda^{2}}\n$$\n$$\n\\frac{dE_{\\pm}(\\lambda)}{d\\lambda} = \\pm \\frac{1}{2\\sqrt{\\Delta^{2}+\\lambda^{2}}} \\cdot (2\\lambda) = \\pm \\frac{\\lambda}{\\sqrt{\\Delta^{2}+\\lambda^{2}}}\n$$\nThis confirms our previous result.\n\nFinally, we discuss the conditions for the validity of the Hellmann-Feynman theorem. The derivation assumes that the eigenstate $|\\psi_{n}(\\lambda)\\rangle$ is differentiable with respect to $\\lambda$. This condition can fail at points where eigenvalues become degenerate. For the given Hamiltonian, $E_{+}(\\lambda) = E_{-}(\\lambda)$ only if $\\sqrt{\\Delta^{2}+\\lambda^{2}} = -\\sqrt{\\Delta^{2}+\\lambda^{2}}$, which implies $\\Delta^{2}+\\lambda^{2} = 0$. Since $\\Delta$ and $\\lambda$ are real, this occurs only if $\\Delta=0$ and $\\lambda=0$.\nCase 1: $\\Delta \\neq 0$. The eigenvalues $E_{+}(\\lambda)$ and $E_{-}(\\lambda)$ are never equal for any real $\\lambda$. The spectrum is non-degenerate everywhere. The theorem is valid for all $\\lambda \\in \\mathbb{R}$.\nCase 2: $\\Delta = 0$. The Hamiltonian is $H(\\lambda) = \\lambda \\begin{pmatrix} 0 & 1 \\\\ 1 & 0 \\end{pmatrix}$, and the eigenvalues are $E_{\\pm}(\\lambda) = \\pm\\sqrt{\\lambda^{2}} = \\pm|\\lambda|$. At $\\lambda=0$, the eigenvalues become degenerate, $E_{+}(0) = E_{-}(0) = 0$. The function $|\\lambda|$ is not differentiable at $\\lambda=0$. Consequently, the left side of the Hellmann-Feynman identity, $dE_{\\pm}/d\\lambda$, is not defined at $\\lambda=0$. Thus, for $\\Delta = 0$, the theorem fails at the point of degeneracy $\\lambda=0$. For any $\\lambda \\neq 0$, the eigenvalues are non-degenerate, and the theorem holds.", "answer": "$$\n\\boxed{\\left(\\frac{\\lambda}{\\sqrt{\\Delta^{2} + \\lambda^{2}}}, -\\frac{\\lambda}{\\sqrt{\\Delta^{2} + \\lambda^{2}}}\\right)}\n$$", "id": "2814495"}, {"introduction": "One of the most powerful applications of the Hellmann-Feynman theorem is its ability to determine expectation values of physical observables without performing explicit integrations over wavefunctions. This practice ([@problem_id:1406901]) showcases this elegant shortcut by calculating the expectation value of the squared position, $\\langle x^2 \\rangle$, for the quantum harmonic oscillator. By treating the force constant $k$ as the parameter in the Hamiltonian, we will see how the energy's sensitivity to this parameter directly reveals a key structural property of the system.", "problem": "A particle of mass $m$ is described by the one-dimensional quantum harmonic oscillator Hamiltonian, $\\hat{H}(k) = -\\frac{\\hbar^2}{2m}\\frac{d^2}{dx^2} + \\frac{1}{2}kx^2$, where $k$ is the force constant and $\\hbar$ is the reduced Planck constant. It is a known result that the exact ground-state energy for this system is given by the expression $E_0(k) = \\frac{1}{2}\\hbar\\sqrt{\\frac{k}{m}}$. Since this is the exact energy, it is also the result that would be obtained from a perfectly optimized variational calculation.\n\nApply the Hellmann-Feynman theorem to this system, treating the force constant $k$ as a continuous parameter. Use the theorem to derive an expression for the expectation value of the squared position operator, $\\langle x^2 \\rangle$, for the particle in its ground state.\n\nProvide your answer as a symbolic expression in terms of $\\hbar$, $m$, and $k$.", "solution": "We treat $k$ as a continuous parameter in the Hamiltonian $\\hat{H}(k) = -\\frac{\\hbar^{2}}{2m}\\frac{d^{2}}{dx^{2}} + \\frac{1}{2}k x^{2}$. For the exact, normalized ground state $|\\psi_{0}(k) \\rangle$ with energy $E_{0}(k)$, the Hellmann-Feynman theorem states\n$$\n\\frac{dE_{0}}{dk} \\;=\\; \\left\\langle \\psi_{0}(k) \\middle| \\frac{\\partial \\hat{H}(k)}{\\partial k} \\middle| \\psi_{0}(k) \\right\\rangle.\n$$\nSince $\\frac{\\partial \\hat{H}(k)}{\\partial k} = \\frac{1}{2}x^{2}$, we obtain\n$$\n\\frac{dE_{0}}{dk} \\;=\\; \\frac{1}{2}\\langle x^{2} \\rangle,\n$$\nhence\n$$\n\\langle x^{2} \\rangle \\;=\\; 2\\,\\frac{dE_{0}}{dk}.\n$$\nUsing the exact ground-state energy $E_{0}(k) = \\frac{1}{2}\\hbar\\left(\\frac{k}{m}\\right)^{1/2}$, we differentiate with respect to $k$:\n$$\n\\frac{dE_{0}}{dk} \\;=\\; \\frac{1}{2}\\hbar \\cdot \\frac{1}{2}\\left(\\frac{k}{m}\\right)^{-1/2}\\cdot \\frac{1}{m} \\;=\\; \\frac{1}{4}\\hbar\\,m^{-1/2}k^{-1/2}.\n$$\nTherefore,\n$$\n\\langle x^{2} \\rangle \\;=\\; 2 \\times \\frac{1}{4}\\hbar\\,m^{-1/2}k^{-1/2} \\;=\\; \\frac{\\hbar}{2}\\,m^{-1/2}k^{-1/2} \\;=\\; \\frac{\\hbar}{2\\sqrt{m k}}.\n$$\nThis is the desired expectation value of $x^{2}$ in the ground state.", "answer": "$$\\boxed{\\frac{\\hbar}{2\\sqrt{m k}}}$$", "id": "1406901"}, {"introduction": "Bridging the gap between abstract theory and computational practice, this final exercise challenges you to implement and test Hellmann-Feynman forces within a simplified plane-wave framework. This task ([@problem_id:2814531]) mirrors the core logic used in modern electronic structure packages for geometry optimization and molecular dynamics. You will explore the critical concept of variational consistency, understanding why the numerical force must be the exact derivative of the numerical energy to ensure stable and correct simulations, a subtlety that is paramount in computational research.", "problem": "Design and implement a complete, runnable program that demonstrates, verifies, and stress-tests the implementation of forces from the Hellmann-Feynman theorem in a simplified one-dimensional plane-wave framework relevant to theoretical chemistry. Begin from the following fundamental base: the time-independent Schrödinger equation for an electronic Hamiltonian parametrized by a nuclear coordinate $R$, the variational principle for normalized eigenstates, and the definition of a plane-wave basis in a periodic supercell. Do not use or assume any pre-derived force expressions. Instead, derive what must be evaluated, why it is valid, and how it follows from these fundamentals. Your program should implement a minimal one-dimensional plane-wave model with a smooth local pseudopotential and assess variational consistency of Hellmann-Feynman forces under different numerical grid resolutions. Work entirely in atomic units (length in bohr, energy in hartree, force in hartree/bohr), and return the final results as booleans indicating whether specified numerical consistency checks pass within a given tolerance.\n\nYou must proceed under the following physically and numerically sound assumptions, stated here as part of the model definition that you will implement and test:\n\n- The electronic Hamiltonian depends on a single nuclear position $R$ in a periodic cell of length $L$, with a plane-wave basis $\\{|G\\rangle\\}$ at the $\\Gamma$ point. The kinetic operator is diagonal in the plane-wave basis with matrix elements $T_{GG'}=\\frac{1}{2}G^2 \\,\\delta_{GG'}$, where $G=\\frac{2\\pi}{L}n$ and $n\\in\\mathbb{Z}$ is restricted by a kinetic-energy cutoff $G_{\\text{cut}}$ via $|G| \\le G_{\\text{cut}}$.\n- The external local pseudopotential is a smooth, periodic Gaussian comb centered at $R$ with amplitude $V_0>0$ and width $\\sigma>0$,\n  $$V(x;R) = -V_0 \\sum_{m\\in\\mathbb{Z}} \\exp\\!\\left(-\\frac{(x-R-mL)^2}{2\\sigma^2}\\right),$$\n  which leads to absolutely convergent Fourier coefficients that decay as $\\exp(-\\sigma^2 q^2/2)$ for wavevector $q$.\n- In a plane-wave Discrete Fourier Transform (DFT in the numerical sense, not Density Functional Theory), the local potential matrix elements $V_{GG'}(R)$ can be constructed either exactly in reciprocal space using the analytical Fourier coefficients or approximately from a sampled real-space grid with $N$ points,\n  $$V_{GG'}(R) \\approx \\frac{L}{N}\\sum_{j=0}^{N-1} V(x_j;R)\\,e^{-i(G-G')x_j},\\quad x_j=\\frac{jL}{N},$$\n  which is subject to aliasing if the grid Nyquist wavenumber $G_{\\text{Nyq}}=\\pi N/L$ does not cover all significant Fourier components needed by the plane-wave Hamiltonian (in particular, the support up to $2G_{\\text{cut}}$ for differences $G-G'$ and the tail of the local potential Fourier spectrum). This captures the numerical grid considerations that control variational consistency in plane-wave implementations.\n\nYour program must implement the following, adhering strictly to the principle-based derivation and numerical construction:\n\n1. Construct the plane-wave basis $\\{G\\}$ from $L$ and $G_{\\text{cut}}$.\n2. Build the Hamiltonian matrix $H(R)=T+V(R)$ in two ways:\n   - A reciprocal-space route using the analytic Fourier representation of the periodic Gaussian comb, ensuring an alias-free construction for any cutoff used in $H(R)$.\n   - A real-space grid route by sampling $V(x;R)$ at $N$ grid points in the unit cell and assembling $V_{GG'}(R)$ via a discrete Fourier sum.\n3. Solve the Hermitian eigenproblem $H(R)|\\psi(R)\\rangle = E(R)|\\psi(R)\\rangle$ for the ground state energy $E(R)$ and normalized eigenvector coefficients $c_G(R)$ in the plane-wave basis.\n4. Compute the Hellmann-Feynman force defined as the negative derivative of the total electronic energy with respect to the nuclear coordinate $R$ evaluated using the derivative of the Hamiltonian with respect to $R$, i.e., using only the operator derivative and the normalized eigenvector at $R$. The basis must be treated as $R$-independent (consistent with plane waves at a fixed cell), so no Pulay terms arise in this model.\n5. Independently compute a finite-difference estimate of the energy derivative using a central difference,\n   $$\\frac{dE}{dR}\\bigg\\rvert_{R} \\approx \\frac{E(R+h)-E(R-h)}{2h},$$\n   with a small displacement $h$.\n6. For specified test cases, compare the Hellmann-Feynman force with the central-difference derivative using the same or different Hamiltonian construction routes to assess variational consistency under grid resolution changes. Return a boolean per case reporting whether the absolute difference is below a specified tolerance.\n\nAs part of your derivation and implementation plan, you must ensure the following conceptual coverage, even though your numerical model includes only the local potential:\n- Enumerate the terms that contribute to forces in a general plane-wave Kohn-Sham Density Functional Theory (DFT) code to demonstrate comprehension of completeness: the local pseudopotential, the separable nonlocal pseudopotential projectors, the Hartree energy contribution, the exchange-correlation energy contribution, and the ion-ion interaction (for example, via the Ewald summation). State where Pulay terms vanish when using a fixed plane-wave basis, and explain the role of augmentation terms in methods such as the Projector Augmented-Wave (PAW) method or ultrasoft pseudopotentials.\n- Explain the numerical grid considerations required to ensure that the energy and its derivative are consistent, including the need for the grid to represent Fourier components up to approximately $2G_{\\text{cut}}$ for operator products and any additional tail from the external potential spectrum. Connect this to common practical rules such as the density grid cutoff and the so-called $3/2$-rule heuristic for aliasing control.\n\nUse the parameter values below as a test suite. All inputs are atomic and dimensionless as described above, and angles are not used. Your code must internally set these and produce the outputs without any user input.\n\n- Cell length: $L=20$.\n- Plane-wave cutoff: $G_{\\text{cut}}=2.5$.\n- Gaussian pseudopotential parameters: $V_0=2.0$, $\\sigma=1.0$.\n- Nuclear position: $R_0=5.3$.\n- Central-difference step: $h=10^{-4}$.\n- Real-space grid sizes for tests:\n  - Case A (reference, reciprocal only): Hellmann-Feynman force and energy derivative both constructed from reciprocal-space Hamiltonians with no real-space sampling.\n  - Case B (grid, adequately resolved): Hellmann-Feynman force and energy derivative both constructed from real-space sampling with $N=128$, which should be adequate to represent differences up to roughly $2G_{\\text{cut}}$ and the Gaussian tail for $\\sigma=1.0$.\n  - Case C (mismatched, intentionally inconsistent): Hellmann-Feynman force constructed from a real-space grid with $N=32$ while the energy derivative is constructed from reciprocal space. This mismatch is expected to break variational consistency.\n  - Case D (grid, undersampled but internally consistent): Hellmann-Feynman force and energy derivative both constructed from a real-space grid with $N=32$. While the representation may be inaccurate, internal consistency should hold.\n\nNumerical acceptance criterion for each case:\n- Produce a boolean that is $ \\text{True}$ if $\\lvert F_{\\text{HF}} - \\frac{E(R+h)-E(R-h)}{2h} \\rvert < \\tau$, otherwise $ \\text{False}$, where $\\tau=10^{-5}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the order $[\\text{Case A},\\text{Case B},\\text{Case C},\\text{Case D}]$.\n\nThe final output must match this exact format, for example, $[\\text{True},\\text{True},\\text{False},\\text{True}]$ (the exact booleans must be determined by your computation).", "solution": "The problem presented is a valid, well-posed exercise in computational theoretical chemistry. It asks for a demonstration of the Hellmann-Feynman theorem and an analysis of its numerical-variational consistency within a simplified one-dimensional plane-wave model. All necessary physical parameters, mathematical definitions, and numerical constraints are provided, allowing for a unique and verifiable solution. The problem is scientifically grounded in quantum mechanics and standard numerical techniques of electronic structure theory. I will proceed with a full derivation and implementation.\n\nThe foundation of this analysis is the time-independent Schrödinger equation for an electronic system where the Hamiltonian, $H(\\lambda)$, depends on a parameter $\\lambda$. In our case, $\\lambda$ is the nuclear coordinate, which we denote by $R$. The equation is:\n$$ H(R) |\\psi(R)\\rangle = E(R) |\\psi(R)\\rangle $$\nwhere $|\\psi(R)\\rangle$ is an eigenstate with corresponding energy eigenvalue $E(R)$. We consider the ground state, for which the energy is a minimum, and the wavefunction is normalized, $\\langle \\psi(R) | \\psi(R) \\rangle = 1$.\n\nThe energy can be expressed as the expectation value of the Hamiltonian:\n$$ E(R) = \\langle \\psi(R) | H(R) | \\psi(R) \\rangle $$\nThe force on the nucleus at position $R$ is defined as the negative gradient of the total energy, $F(R) = -\\frac{dE(R)}{dR}$. To derive the Hellmann-Feynman theorem, we differentiate the energy expression with respect to $R$ using the product rule:\n$$ \\frac{dE}{dR} = \\left\\langle \\frac{d\\psi}{dR} \\right| H | \\psi \\rangle + \\left\\langle \\psi \\left| \\frac{\\partial H}{\\partial R} \\right| \\psi \\right\\rangle + \\left\\langle \\psi \\right| H \\left| \\frac{d\\psi}{dR} \\right\\rangle $$\nSince $|\\psi\\rangle$ is an eigenstate, $H|\\psi\\rangle = E|\\psi\\rangle$. The first term becomes $E\\langle \\frac{d\\psi}{dR} | \\psi \\rangle$. Using the hermiticity of the Hamiltonian, $H^\\dagger=H$, the last term becomes $\\langle H\\psi | \\frac{d\\psi}{dR} \\rangle = \\langle E\\psi | \\frac{d\\psi}{dR} \\rangle = E^* \\langle \\psi | \\frac{d\\psi}{dR} \\rangle$. Since energy eigenvalues of a Hermitian operator are real, $E^*=E$. The sum of the first and last terms is:\n$$ E \\left( \\left\\langle \\frac{d\\psi}{dR} | \\psi \\right\\rangle + \\left\\langle \\psi | \\frac{d\\psi}{dR} \\right\\rangle \\right) = E \\frac{d}{dR} \\langle \\psi | \\psi \\rangle $$\nBecause the wavefunction is normalized, $\\langle \\psi | \\psi \\rangle = 1$, its derivative is zero. Thus, these two terms cancel, yielding the Hellmann-Feynman theorem:\n$$ \\frac{dE}{dR} = \\left\\langle \\psi(R) \\left| \\frac{\\partial H(R)}{\\partial R} \\right| \\psi(R) \\right\\rangle $$\nThe force is therefore given by the expectation value of the Hamiltonian derivative:\n$$ F_{\\text{HF}}(R) = - \\left\\langle \\psi(R) \\left| \\frac{\\partial H(R)}{\\partial R} \\right| \\psi(R) \\right\\rangle $$\nThis theorem is valid provided $|\\psi(R)\\rangle$ is an exact eigenstate of $H(R)$. The variational principle ensures it also holds for wavefunctions obtained from a variational calculation, a cornerstone of methods like Hartree-Fock and Density Functional Theory (DFT).\n\nIn our plane-wave model, the Hamiltonian is $H(R) = T + V(R)$. The kinetic energy operator $T$ and the plane-wave basis functions $\\{|G\\rangle\\}$ are independent of the nuclear position $R$. The basis functions, given by $\\langle x | G \\rangle = (1/\\sqrt{L})e^{iGx}$, are fixed with respect to the simulation cell. Consequently, the only part of the Hamiltonian that depends on $R$ is the potential operator $V(R)$. The force expression simplifies to:\n$$ F_{\\text{HF}}(R) = - \\left\\langle \\psi(R) \\left| \\frac{\\partial V(R)}{\\partial R} \\right| \\psi(R) \\right\\rangle $$\n\nExpanding the ground state wavefunction $|\\psi\\rangle$ in the plane-wave basis, $|\\psi\\rangle = \\sum_G c_G |G\\rangle$, the force is computed in matrix form:\n$$ F_{\\text{HF}} = - \\sum_{G, G'} c_{G'}^* \\left\\langle G' \\left| \\frac{\\partial V(R)}{\\partial R} \\right| G \\right\\rangle c_G = - \\mathbf{c}^\\dagger \\left( \\frac{\\partial \\mathbf{V}}{\\partial R} \\right) \\mathbf{c} $$\nwhere $\\mathbf{c}$ is the column vector of coefficients $c_G$ and $\\frac{\\partial \\mathbf{V}}{\\partial R}$ is the matrix of the potential derivative operator.\n\nThe problem requires a broader conceptual discussion of forces in a complete plane-wave DFT calculation. The total force on an ion is the sum of several contributions:\n1.  **Local Pseudopotential**: The term corresponding to the one in this problem. It is the expectation value of the derivative of the local part of the pseudopotential.\n2.  **Nonlocal Pseudopotential**: Most modern pseudopotentials include nonlocal projectors. The force contribution involves the derivative of these projectors with respect to the atomic position.\n3.  **Hartree Potential**: The derivative of the classical electrostatic energy of the electrons. It depends on the derivative of the electron density with respect to the nuclear coordinate.\n4.  **Exchange-Correlation (XC)**: This force term arises from the derivative of the XC energy functional with respect to the nuclear positions, which also proceeds via the chain rule through the electron density and its gradient.\n5.  **Ion-Ion Interaction**: The direct classical Coulomb force between the nuclei, typically calculated via an Ewald sum for periodic systems.\n\nThe Hellmann-Feynman theorem, as derived, assumes the basis set is independent of the differentiation parameter $R$. In a plane-wave basis, the basis vectors are tied to the simulation cell, not the atoms, so they are indeed $R$-independent. This means there are no **Pulay forces** (also known as Pulay corrections). Pulay forces arise in methods that use atom-centered basis sets (like Gaussian-type orbitals), where the basis functions move with the atoms. These forces are correction terms that account for the variation of the basis set itself. In advanced methods like Projector-Augmented Wave (PAW), additional force terms arise from the derivative of augmentation charges localized on the atoms, which must be handled carefully.\n\nA critical aspect of numerical implementation is **variational consistency**. The Hellmann-Feynman theorem's validity relies on the wavefunction being an eigenstate of the *exact* Hamiltonian used. In a numerical calculation, if we use an approximate Hamiltonian $\\tilde{H}$ (e.g., constructed on a coarse real-space grid), the computed force $F_{\\text{HF}} = -\\langle \\tilde{\\psi} | \\partial \\tilde{H}/\\partial R | \\tilde{\\psi} \\rangle$ will only be consistent with the finite-difference force $F_{\\text{FD}} = -(\\tilde{E}(R+h)-\\tilde{E}(R-h))/(2h)$ if the *same* approximation scheme $\\tilde{H}$ is used for both calculations. Mismatching the schemes, for instance by using a coarse grid for $F_{\\text{HF}}$ and an exact formulation for $F_{\\text{FD}}$, breaks this variational consistency and leads to a discrepancy.\n\nThis consistency is primarily governed by the resolution of the real-space grid used to represent operators. A product of two basis functions, $\\langle G'|...|G \\rangle$, involves terms like $e^{-i(G-G')x}$. With a plane-wave cutoff $G_{\\text{cut}}$, the difference vector $G-G'$ can have a magnitude up to $2G_{\\text{cut}}$. For the potential matrix elements $\\langle G'|V|G\\rangle = \\int V(x) e^{-i(G-G')x} dx$, the grid must be fine enough to represent both the oscillations up to $2G_{\\text{cut}}$ and the Fourier components of the potential $V(x)$ without significant aliasing. The Nyquist frequency of the grid, $G_{\\text{Nyq}} = \\pi N/L$, must be larger than the maximum frequency content of the quantity being transformed. A common rule of thumb is to use a grid capable of representing densities, which involves frequencies up to $2G_{\\text{cut}}$. Sometimes, for potentials with sharp features, an even denser grid is needed. The \"$3/2$-rule\" is a heuristic used in some contexts to pad arrays before FFTs to completely eliminate aliasing for quadratic quantities. In this problem, we will test this principle directly.\n\nNow, we proceed to the implementation, which is structured into four test cases to verify these concepts.\n\n- **Case A** (Reference): Both force calculations use the analytic, alias-free reciprocal-space Hamiltonian. This is expected to be consistent.\n- **Case B** (Adequate Grid): Both calculations use a fine real-space grid ($N=128$), which is sufficient to represent the Hamiltonian accurately. Consistency is expected.\n- **Case C** (Mismatched): Hellmann-Feynman force uses a coarse grid ($N=32$), while the energy derivative uses the exact reciprocal-space Hamiltonian. Variational consistency is broken, and a mismatch is expected.\n- **Case D** (Consistent but Coarse): Both calculations use the same coarse grid ($N=32$). While the absolute results may be inaccurate, the two methods for calculating the force should be consistent with each other.\n\nThe implementation will construct the Hamiltonian matrices as per the problem definitions, solve the resulting eigenproblem for the ground state, and compute the forces for each case to validate these predictions.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to demonstrate and test the Hellmann-Feynman theorem.\n    \"\"\"\n    \n    # --- Model Parameters (atomic units) ---\n    L = 20.0       # Cell length\n    G_cut = 2.5    # Plane-wave kinetic energy cutoff\n    V0 = 2.0       # Pseudopotential amplitude\n    sigma = 1.0    # Pseudopotential width\n    R0 = 5.3       # Nuclear position\n    h = 1.0e-4     # Central-difference step\n    tau = 1.0e-5   # Tolerance for comparison\n\n    # --- Test Case Definitions ---\n    # (N_hf, N_fd): Grid points for Hellmann-Feynman and Finite-Difference calculations.\n    # None indicates using the exact reciprocal-space representation.\n    test_cases_params = [\n        ('Case A (reciprocal only)', None, None),\n        ('Case B (grid, adequately resolved)', 128, 128),\n        ('Case C (mismatched, inconsistent)', 32, None),\n        ('Case D (grid, undersampled but consistent)', 32, 32),\n    ]\n\n    # --- Generate Plane-Wave Basis ---\n    n_max = int(np.floor(G_cut * L / (2.0 * np.pi)))\n    G_vec = (2.0 * np.pi / L) * np.arange(-n_max, n_max + 1)\n    T_matrix = 0.5 * np.diag(G_vec**2)\n    \n    # --- Helper Functions ---\n\n    def _get_periodic_potential(x_grid, R):\n        \"\"\"Calculates V(x;R) on a grid, handling periodic images of the potential.\"\"\"\n        # Find the distance to the nearest periodic image of R for each x\n        dist = x_grid - R\n        dist_periodic = dist - L * np.round(dist / L)\n        return -V0 * np.exp(-dist_periodic**2 / (2.0 * sigma**2))\n\n    def _get_periodic_potential_derivative(x_grid, R):\n        \"\"\"Calculates dV(x;R)/dR on a grid.\"\"\"\n        dist = x_grid - R\n        dist_periodic = dist - L * np.round(dist / L)\n        V_val = -V0 * np.exp(-dist_periodic**2 / (2.0 * sigma**2))\n        # The operator dV/dR = -V'(x-R), where V' is derivative w.r.t argument.\n        # V'(y) = V(y) * (-y / sigma^2).\n        # So, dV/dR = -V(y) * (-y / sigma^2) = V(y) * (y / sigma^2)\n        # This function should compute dV/dR for the FT.\n        # d/dR [f(x-R)] = -f'(x-R)\n        # f'(y) = f(y) * (y/sigma^2)\n        # So dV/dR = -f(x-R) * (x-R)/sigma^2 = -V_val * dist_periodic/sigma^2\n        return -V_val * dist_periodic / sigma**2\n        \n    def build_hamiltonian(R, N):\n        \"\"\"Constructs the Hamiltonian matrix H(R) = T + V(R).\"\"\"\n        num_basis = len(G_vec)\n        V_matrix = np.zeros((num_basis, num_basis), dtype=np.complex128)\n        \n        # Create a mesh of q = G - G' vectors\n        G_prime_mesh, G_mesh = np.meshgrid(G_vec, G_vec)\n        q_mesh = G_mesh - G_prime_mesh\n        \n        if N is None: # Reciprocal-space route\n            # V_{GG'} is the FT of V(x;R) at q=G-G'\n            # FT of f(x-R) is F(q)exp(-iqR)\n            # FT of a single Gaussian -V0*exp(-x^2/2s^2) is -V0*sqrt(2pi)s*exp(-s^2q^2/2)\n            # The potential matrix elements V_{GG'} are L times the Fourier coefficients.\n            # In 1D, FT convention gives V(q)=Integral V(x)exp(-iqx)dx.\n            # So the matrix elements are directly the FT.\n            v_analytic = -V0 * np.sqrt(2.0 * np.pi) * sigma * np.exp(-1j * q_mesh * R) * \\\n                         np.exp(-0.5 * sigma**2 * q_mesh**2)\n            V_matrix = v_analytic\n        else: # Real-space grid route\n            x_grid = np.linspace(0, L, N, endpoint=False)\n            v_real = _get_periodic_potential(x_grid, R)\n            \n            # Using broadcasting for speed:\n            exp_term = np.exp(-1j * np.outer(q_mesh.flatten(), x_grid))\n            v_fourier = exp_term @ v_real\n            V_matrix = (L / N) * v_fourier.reshape(num_basis, num_basis)\n            \n        return T_matrix + V_matrix\n\n    def get_ground_state(H):\n        \"\"\"Solves the eigenproblem for the ground state.\"\"\"\n        eigvals, eigvecs = np.linalg.eigh(H)\n        ground_energy = eigvals[0]\n        ground_state_vec = eigvecs[:, 0]\n        return ground_energy, ground_state_vec\n\n    def compute_hf_force(R, c_vec, N):\n        \"\"\"Computes the Hellmann-Feynman force.\"\"\"\n        num_basis = len(G_vec)\n        dV_dR_matrix = np.zeros((num_basis, num_basis), dtype=np.complex128)\n        \n        G_prime_mesh, G_mesh = np.meshgrid(G_vec, G_vec)\n        q_mesh = G_mesh - G_prime_mesh\n        \n        if N is None: # Reciprocal-space route\n            # dV_{GG'}/dR = -i(G-G') * V_{GG'}\n            v_analytic = -V0 * np.sqrt(2.0 * np.pi) * sigma * np.exp(-1j * q_mesh * R) * \\\n                         np.exp(-0.5 * sigma**2 * q_mesh**2)\n            dV_dR_matrix = -1j * q_mesh * v_analytic\n        else: # Real-space grid route\n            x_grid = np.linspace(0, L, N, endpoint=False)\n            dv_dr_real = _get_periodic_potential_derivative(x_grid, R)\n            \n            exp_term = np.exp(-1j * np.outer(q_mesh.flatten(), x_grid))\n            dv_dr_fourier = exp_term @ dv_dr_real\n            dV_dR_matrix = (L / N) * dv_dr_fourier.reshape(num_basis, num_basis)\n\n        force = -np.vdot(c_vec, dV_dR_matrix @ c_vec)\n        return force.real\n\n    def run_case(N_hf, N_fd):\n        \"\"\"Runs a single test case comparing HF and FD forces.\"\"\"\n        # 1. Compute Hellmann-Feynman force at R0\n        H_hf = build_hamiltonian(R0, N_hf)\n        _, c0 = get_ground_state(H_hf)\n        f_hf = compute_hf_force(R0, c0, N_hf)\n        \n        # 2. Compute Finite Difference force around R0\n        H_plus = build_hamiltonian(R0 + h, N_fd)\n        E_plus, _ = get_ground_state(H_plus)\n        \n        H_minus = build_hamiltonian(R0 - h, N_fd)\n        E_minus, _ = get_ground_state(H_minus)\n        \n        f_fd = -(E_plus - E_minus) / (2.0 * h)\n        \n        # 3. Compare and return boolean\n        is_consistent = np.abs(f_hf - f_fd) < tau\n        return is_consistent\n\n    # --- Execute Test Cases ---\n    results = []\n    for _, N_hf, N_fd in test_cases_params:\n        result = run_case(N_hf, N_fd)\n        results.append(str(result))\n        \n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2814531"}]}