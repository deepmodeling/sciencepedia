{"hands_on_practices": [{"introduction": "Molecular dynamics simulations of bulk phases conventionally use Periodic Boundary Conditions (PBC) to minimize surface effects. This practice raises a critical data-handling challenge: distinguishing between the raw \"wrapped\" coordinates stored in a trajectory and the true, continuous \"unwrapped\" path of a particle. This exercise [@problem_id:2825806] hones your ability to discern which physical observables, such as the mean-squared displacement $ \\langle \\Delta r^2(t)\\rangle $, require a full unwrapped trajectory for correct calculation, and which, like the velocity autocorrelation function, can be computed without this post-processing step.", "problem": "A molecular dynamics trajectory of a single diffusing solute in a cubic box of edge length $L$ with Periodic Boundary Conditions (PBC) is saved at times $t_n = n\\,\\Delta t$ as two series: the wrapped positions $\\{ \\mathbf{r}_{\\mathrm{wrap}}(t_n) \\}$, where each Cartesian coordinate is reduced modulo $L$ into $[0,L)$ at every frame, and the instantaneous velocities $\\{ \\mathbf{v}(t_n) \\}$ produced by the integrator. You are asked to compute the mean-squared displacement $\\langle \\Delta r^2(t)\\rangle$ and the Velocity Autocorrelation Function (VACF). Your colleague proposes several claims about when unwrapped coordinates are essential and how to proceed if only wrapped positions are available.\n\nUsing only fundamental definitions of displacement, periodic imaging, and time autocorrelation, decide which of the following statements are correct. Select all that apply.\n\nA. For $\\langle \\Delta r^2(t)\\rangle$, it is sufficient to apply the minimum-image convention once to $\\mathbf{r}_{\\mathrm{wrap}}(t)-\\mathbf{r}_{\\mathrm{wrap}}(0)$; this yields the true displacement for all $t$ and therefore the correct mean-squared displacement without explicitly unwrapping.\n\nB. For $\\langle \\Delta r^2(t)\\rangle$ under PBC, one must reconstruct the continuous trajectory in the infinite tiling, either by explicit unwrapping (tracking integer box crossings) or by cumulatively summing frame-to-frame minimum-image displacements to obtain the net displacement; otherwise the result is systematically wrong at long times.\n\nC. The VACF can be computed directly from the stored velocities $\\mathbf{v}(t)$ without any unwrapping because imaging operations affect stored positions but not the instantaneous velocities that solve the equations of motion.\n\nD. If velocities are not stored, one can still compute a correct VACF without unwrapping by estimating $ \\mathbf{v}(t_n)\\approx\\big[\\mathbf{r}_{\\mathrm{wrap}}(t_{n+1})-\\mathbf{r}_{\\mathrm{wrap}}(t_n)\\big]_{\\mathrm{MIC}}/\\Delta t $, where $[\\cdot]_{\\mathrm{MIC}}$ denotes mapping each component of the difference into $(-L/2,L/2]$ at each step; for sufficiently small $\\Delta t$ this equals the true finite-difference velocity.\n\nE. It is acceptable to estimate velocities for the VACF by naive finite differences $ \\big(\\mathbf{r}_{\\mathrm{wrap}}(t+\\tau)-\\mathbf{r}_{\\mathrm{wrap}}(t)\\big)/\\tau $ over long lags $\\tau$ without any minimum-image mapping when the box is cubic; any errors from boundary crossings average out in the autocorrelation.", "solution": "The problem requires an evaluation of several procedural claims regarding the calculation of the mean-squared displacement, $\\langle \\Delta r^2(t)\\rangle$, and the velocity autocorrelation function, $C_{vv}(t)$, from a molecular dynamics trajectory generated with periodic boundary conditions (PBC). The core of the problem lies in the distinction between \"wrapped\" coordinates, confined to the primary simulation box, and \"unwrapped\" coordinates, which represent the true, continuous path of a particle through the infinite periodic tiling of space.\n\nFirst, let us establish the fundamental definitions.\n\nThe true displacement of the solute over a time interval $t$ starting at time $\\tau$ is given by the vector connecting its unwrapped positions:\n$$\n\\Delta \\mathbf{r}(t; \\tau) = \\mathbf{r}_{\\mathrm{unwrapped}}(t+\\tau) - \\mathbf{r}_{\\mathrm{unwrapped}}(\\tau)\n$$\nThe unwrapped position $\\mathbf{r}_{\\mathrm{unwrapped}}(t)$ tracks the continuous path, accumulating displacements across periodic boundaries. The wrapped position $\\mathbf{r}_{\\mathrm{wrap}}(t)$ is related by $\\mathbf{r}_{\\mathrm{unwrapped}}(t) = \\mathbf{r}_{\\mathrm{wrap}}(t) + L \\mathbf{n}(t)$, where $\\mathbf{n}(t)$ is an integer vector counting the number of times the particle has crossed the box boundaries in each Cartesian direction.\n\nThe mean-squared displacement (MSD) is the ensemble average of the squared magnitude of this true displacement:\n$$\n\\langle \\Delta r^2(t)\\rangle = \\left\\langle |\\Delta \\mathbf{r}(t; \\tau)|^2 \\right\\rangle_\\tau = \\left\\langle |\\mathbf{r}_{\\mathrm{unwrapped}}(t+\\tau) - \\mathbf{r}_{\\mathrm{unwrapped}}(\\tau)|^2 \\right\\rangle_\\tau\n$$\nwhere the average $\\langle \\cdot \\rangle_\\tau$ is over all possible time origins $\\tau$. For a diffusing particle in three dimensions, we expect $\\langle \\Delta r^2(t)\\rangle \\to 6Dt$ for long times $t$, where $D$ is the diffusion coefficient. This shows that the MSD must be an unbounded, growing function of time.\n\nThe velocity autocorrelation function (VACF) is defined as:\n$$\nC_{vv}(t) = \\langle \\mathbf{v}(\\tau) \\cdot \\mathbf{v}(t+\\tau) \\rangle_\\tau\n$$\nwhere $\\mathbf{v}(t)$ is the instantaneous velocity of the particle at time $t$.\n\nThe minimum-image convention (MIC) for a displacement vector $\\Delta\\mathbf{r} = \\mathbf{r}_2 - \\mathbf{r}_1$ in a cubic box of side $L$ yields a new vector $[\\Delta\\mathbf{r}]_{\\mathrm{MIC}}$ where each component $\\Delta r_i$ is mapped into the interval $[-L/2, L/2)$ by adding or subtracting integer multiples of $L$. This gives the shortest possible vector connecting particle $1$ to any periodic image of particle $2$.\n\nWith these definitions, we proceed to analyze each statement.\n\n**A. For $\\langle \\Delta r^2(t)\\rangle$, it is sufficient to apply the minimum-image convention once to $\\mathbf{r}_{\\mathrm{wrap}}(t)-\\mathbf{r}_{\\mathrm{wrap}}(0)$; this yields the true displacement for all $t$ and therefore the correct mean-squared displacement without explicitly unwrapping.**\n\nThis statement claims that the true displacement $\\Delta \\mathbf{r}(t; 0)$ is equal to $[\\mathbf{r}_{\\mathrm{wrap}}(t) - \\mathbf{r}_{\\mathrm{wrap}}(0)]_{\\mathrm{MIC}}$. This is incorrect for a general time $t$. The magnitude of the vector obtained via the MIC is bounded; specifically, its squared magnitude cannot exceed $(L/2)^2 + (L/2)^2 + (L/2)^2 = 3L^2/4$. However, the true mean-squared displacement for a diffusing particle must grow linearly with time and is not bounded. For any time $t$ long enough that the particle is likely to have diffused a distance greater than $L/2$ in any one direction, the MIC displacement will no longer equal the true displacement. The resulting MSD curve would be systematically underestimated and would artificially plateau at a value related to $L^2$, which is physically incorrect. This procedure is only valid for very short times.\nVerdict: **Incorrect**.\n\n**B. For $\\langle \\Delta r^2(t)\\rangle$ under PBC, one must reconstruct the continuous trajectory in the infinite tiling, either by explicit unwrapping (tracking integer box crossings) or by cumulatively summing frame-to-frame minimum-image displacements to obtain the net displacement; otherwise the result is systematically wrong at long times.**\n\nThis statement accurately describes the necessary procedure. To compute the true displacement $\\Delta \\mathbf{r}(t; \\tau)$, one must know the unwrapped coordinates. These can be obtained by post-processing the trajectory. A standard algorithm is to reconstruct the unwrapped path iteratively:\n$$\n\\mathbf{r}_{\\mathrm{unwrapped}}(t_{n+1}) = \\mathbf{r}_{\\mathrm{unwrapped}}(t_n) + [\\mathbf{r}_{\\mathrm{wrap}}(t_{n+1}) - \\mathbf{r}_{\\mathrm{wrap}}(t_n)]_{\\mathrm{MIC}}\n$$\nThis is equivalent to the \"cumulatively summing frame-to-frame minimum-image displacements\". This method is correct provided the simulation timestep $\\Delta t = t_{n+1}-t_n$ is small enough that the particle displacement in one step is less than $L/2$ in all dimensions. As established in the analysis of statement A, failure to reconstruct this continuous path leads to a systematically incorrect MSD at long times due to the artificial bounding of displacements.\nVerdict: **Correct**.\n\n**C. The VACF can be computed directly from the stored velocities $\\mathbf{v}(t)$ without any unwrapping because imaging operations affect stored positions but not the instantaneous velocities that solve the equations of motion.**\n\nThis statement is correct. In a standard MD simulation, forces on particles are computed based on the minimum-image distances. These forces are then used to update the velocities via an integrator (e.g., Velocity-Verlet). The position update may result in a coordinate value outside the primary box $[0,L)$. The PBC operation then maps this position back into the primary box, e.g., $x \\to x \\pmod L$. This is a discontinuous jump in the stored coordinate. However, the velocity vector $\\mathbf{v}(t)$, which represents the instantaneous rate of change of position, is not modified by this wrapping operation. A particle exiting one face of the box re-enters the opposite face with the exact same velocity vector. Therefore, the time series of velocities $\\{\\mathbf{v}(t_n)\\}$ stored by the simulation program represents the true, continuous velocity of the particle, and can be used directly to compute the VACF without any \"unwrapping\" procedure.\nVerdict: **Correct**.\n\n**D. If velocities are not stored, one can still compute a correct VACF without unwrapping by estimating $\\mathbf{v}(t_n)\\approx\\big[\\mathbf{r}_{\\mathrm{wrap}}(t_{n+1})-\\mathbf{r}_{\\mathrm{wrap}}(t_n)\\big]_{\\mathrm{MIC}}/\\Delta t$, where $[\\cdot]_{\\mathrm{MIC}}$ denotes mapping each component of the difference into $(-L/2,L/2]$ at each step; for sufficiently small $\\Delta t$ this equals the true finite-difference velocity.**\n\nThis statement proposes a method to approximate velocities from positions. The true finite-difference velocity is $\\mathbf{v}_{\\mathrm{FD}}(t_n) = (\\mathbf{r}_{\\mathrm{unwrapped}}(t_{n+1}) - \\mathbf{r}_{\\mathrm{unwrapped}}(t_n)) / \\Delta t$. The expression $[\\mathbf{r}_{\\mathrm{wrap}}(t_{n+1})-\\mathbf{r}_{\\mathrm{wrap}}(t_n)]_{\\mathrm{MIC}}$ gives the shortest vector connecting the wrapped positions between two consecutive frames. \"For sufficiently small $\\Delta t$\" implies that the true displacement in one timestep is less than $L/2$ in any dimension. Under this standard condition, the true displacement vector is identical to the minimum-image displacement vector:\n$$\n\\mathbf{r}_{\\mathrm{unwrapped}}(t_{n+1}) - \\mathbf{r}_{\\mathrm{unwrapped}}(t_n) = [\\mathbf{r}_{\\mathrm{wrap}}(t_{n+1}) - \\mathbf{r}_{\\mathrm{wrap}}(t_n)]_{\\mathrm{MIC}}\n$$\nTherefore, dividing by $\\Delta t$ yields the correct finite-difference approximation to the true instantaneous velocity. The VACF computed from this estimated velocity series will be correct. This procedure correctly circumvents the need for a full trajectory unwrapping by using local, frame-to-frame information.\nVerdict: **Correct**.\n\n**E. It is acceptable to estimate velocities for the VACF by naive finite differences $\\big(\\mathbf{r}_{\\mathrm{wrap}}(t+\\tau)-\\mathbf{r}_{\\mathrm{wrap}}(t)\\big)/\\tau$ over long lags $\\tau$ without any minimum-image mapping when the box is cubic; any errors from boundary crossings average out in the autocorrelation.**\n\nThis statement is fundamentally incorrect on multiple grounds. First, using the naive difference of wrapped positions $\\mathbf{r}_{\\mathrm{wrap}}(t+\\tau)-\\mathbf{r}_{\\mathrm{wrap}}(t)$ is incorrect. When a particle crosses a boundary, its wrapped coordinate changes discontinuously by approximately $\\pm L$. The naive difference will thus produce a very large, spurious displacement component (e.g., $x_2 \\approx 0, x_1 \\approx L \\implies x_2-x_1 \\approx -L$) that has no relation to the true velocity. The claim that these large, systematic errors will \"average out\" has no physical or mathematical basis; they will introduce severe artifacts and yield a meaningless VACF. Second, estimating an instantaneous velocity requires a very short time difference, ideally $\\tau = \\Delta t \\to 0$. Using a \"long lag $\\tau$\" calculates an average velocity over the interval, not the instantaneous velocity required for the VACF. The resulting correlation function would not be the VACF.\nVerdict: **Incorrect**.", "answer": "$$\\boxed{BCD}$$", "id": "2825806"}, {"introduction": "Beyond handling periodic boundaries, ensuring data integrity requires addressing other potential simulation artifacts. A common issue in finite-sized systems is a spurious drift of the center-of-mass (COM), which can contaminate correlation functions and lead to unphysical results. This practice [@problem_id:2825787] challenges you to select the rigorous procedure for removing this COM motion, thereby isolating the intrinsic thermal fluctuations that are the basis for calculating transport coefficients via the Green-Kubo formalism. Mastering this correction is essential for obtaining accurate physical predictions from your simulation data.", "problem": "A molecular dynamics (MD) simulation of a homogeneous fluid with periodic boundary conditions is performed at temperature $T$ and contains $N$ particles of masses $m_i$ and charges $q_i$ in a cubic box of volume $V$. You wish to compute time correlation functions such as the velocity autocorrelation function and current autocorrelation functions for transport coefficients via the Green–Kubo formalism. Due to finite-precision integration and weak coupling to a thermostat, the trajectory shows a slowly varying but nonzero total linear momentum, i.e., an instantaneous center-of-mass (COM) velocity $ v_{\\mathrm{CM}}(t) = P_{\\mathrm{tot}}(t)/M $ with $ M=\\sum_{i=1}^{N} m_i $, which induces a drift of the whole simulation cell under the periodic boundaries.\n\nSelect the procedure that, when applied to the stored trajectory before computing any velocity- or current-based correlation functions, removes center-of-mass motion and any net momentum so as to prevent spurious long-time tails and offsets in the correlations while preserving the physically meaningful fluctuations relevant for transport:\n\nA. For each saved time $t_n$, compute the instantaneous center-of-mass velocity $ v_{\\mathrm{CM}}(t_n) = \\left(\\sum_{i=1}^{N} m_i v_i(t_n)\\right) / M $ and replace all particle velocities by the peculiar velocities $ w_i(t_n) = v_i(t_n) - v_{\\mathrm{CM}}(t_n) $ before forming any velocity- or current-like observables; for any displacement-based estimators, also remove the center-of-mass displacement by using $ \\Delta r_i'(t) = \\left[r_i(t)-r_i(0)\\right] - \\left[R_{\\mathrm{CM}}(t)-R_{\\mathrm{CM}}(0)\\right] $ with $ R_{\\mathrm{CM}}(t) = \\left(\\sum_{i=1}^{N} m_i r_i(t)\\right)/M $.\n\nB. At $t=0$, rescale all velocities once so that $ \\sum_{i=1}^{N} m_i v_i(0)=0 $ and then compute correlation functions using the original saved velocities $v_i(t)$ thereafter; do not alter displacements.\n\nC. Compute correlation functions from the unmodified velocities and currents, then apply a time-domain window to the correlation function (for example, a Hann window) to damp long-time tails.\n\nD. Unwrap particle positions under periodic boundary conditions and estimate velocities by finite differences of these unwrapped positions; leave the net momentum unchanged, but compute charge current using $ w_i(t) = v_i(t) - v_{\\mathrm{CM}}(t) $ only for the charged species.\n\nE. Estimate the time-averaged center-of-mass velocity $ \\bar{v}_{\\mathrm{CM}} = \\left(1/T_{\\mathrm{traj}}\\right)\\int_{0}^{T_{\\mathrm{traj}}} v_{\\mathrm{CM}}(t)\\,dt $ over the full trajectory of duration $T_{\\mathrm{traj}}$, and subtract this constant drift from all particle velocities once to obtain $ v_i'(t) = v_i(t) - \\bar{v}_{\\mathrm{CM}} $; leave displacements unchanged.", "solution": "The problem requires identifying the correct procedure to remove artifacts from a spurious, slowly varying center-of-mass (COM) motion in a molecular dynamics (MD) trajectory before calculating time correlation functions for transport coefficients. The presence of a non-zero total momentum, $P_{\\mathrm{tot}}(t)$, and thus a non-zero COM velocity, $v_{\\mathrm{CM}}(t) = P_{\\mathrm{tot}}(t)/M$, is an unphysical artifact in a simulation of a homogeneous fluid under periodic boundary conditions, which should, on average, have no net flow. This artifact arises from numerical integration errors and momentum non-conserving thermostats.\n\nTo derive the correct procedure, we must analyze how this COM motion affects the quantities used in Green-Kubo and Einstein relations. The instantaneous velocity of a particle $i$, $v_i(t)$, can be decomposed into its peculiar velocity, $w_i(t)$, relative to the center of mass, and the velocity of the center of mass itself, $v_{\\mathrm{CM}}(t)$:\n$$v_i(t) = w_i(t) + v_{\\mathrm{CM}}(t)$$\nBy definition, the peculiar velocities satisfy $\\sum_{i=1}^{N} m_i w_i(t) = 0$ at all times. Physical transport properties in a homogeneous fluid arise from the thermal fluctuations of particles relative to each other, which are described by the peculiar velocities, $w_i(t)$. The COM velocity, $v_{\\mathrm{CM}}(t)$, represents a collective, non-thermal drift of the entire system and must be removed.\n\nConsider a generic velocity autocorrelation function $\\langle A(0) \\cdot A(t) \\rangle$, where $A$ is a velocity-based observable. Using the raw velocities $v_i(t)$ means we compute:\n$$\\langle (A_w(0) + A_{\\mathrm{CM}}(0)) \\cdot (A_w(t) + A_{\\mathrm{CM}}(t)) \\rangle = \\langle A_w(0) \\cdot A_w(t) \\rangle + \\langle A_{\\mathrm{CM}}(0) \\cdot A_{\\mathrm{CM}}(t) \\rangle + \\text{cross terms}$$\nwhere $A_w$ is the observable computed from peculiar velocities and $A_{\\mathrm{CM}}$ is its component due to COM motion. Assuming the random thermal motion is uncorrelated with the collective COM motion, the cross terms average to zero. The computed correlation function is the sum of the true physical correlation function, $\\langle A_w(0) \\cdot A_w(t) \\rangle$, and a spurious artifact term, $\\langle A_{\\mathrm{CM}}(0) \\cdot A_{\\mathrm{CM}}(t) \\rangle$. Since $v_{\\mathrm{CM}}(t)$ is described as \"slowly varying,\" its autocorrelation is long-lived, introducing a non-physical long-time tail or offset into the total correlation function. This will lead to an incorrect, typically overestimated, transport coefficient when integrated.\n\nThe correct approach is to calculate all velocity-dependent observables using the peculiar velocities $w_i(t)$. Since the problem states $v_{\\mathrm{CM}}(t)$ is \"slowly varying\" and not constant, the subtraction must be performed at each saved time step $t_n$ of the trajectory:\n$$w_i(t_n) = v_i(t_n) - v_{\\mathrm{CM}}(t_n) = v_i(t_n) - \\frac{\\sum_{j=1}^{N} m_j v_j(t_n)}{M}$$\nThis procedure guarantees that the system has zero total momentum at every frame used in the analysis.\n\nSimilar logic applies to displacement-based estimators, such as the mean-squared displacement (MSD) used in the Einstein relation for diffusion. The particle displacement $\\Delta r_i(t) = r_i(t) - r_i(0)$ also contains a contribution from the COM displacement $\\Delta R_{\\mathrm{CM}}(t) = R_{\\mathrm{CM}}(t) - R_{\\mathrm{CM}}(0)$. The MSD calculated with raw positions would be contaminated by the mean-squared displacement of the COM, $\\langle |\\Delta R_{\\mathrm{CM}}(t)|^2 \\rangle$. For a drifting system, this term often grows as $t^2$ (ballistic motion), which would overwhelm the physically relevant diffusive ($t^1$) behavior. Thus, the COM displacement must also be subtracted:\n$$\\Delta r_i'(t) = \\Delta r_i(t) - \\Delta R_{\\mathrm{CM}}(t) = [r_i(t) - r_i(0)] - [R_{\\mathrm{CM}}(t) - R_{\\mathrm{CM}}(0)]$$\n\nThis constitutes the complete and correct procedure. We now evaluate the given options against this derivation.\n\n**A. For each saved time $t_n$, compute the instantaneous center-of-mass velocity $v_{\\mathrm{CM}}(t_n) = \\left(\\sum_{i=1}^{N} m_i v_i(t_n)\\right) / M$ and replace all particle velocities by the peculiar velocities $w_i(t_n) = v_i(t_n) - v_{\\mathrm{CM}}(t_n)$ before forming any velocity- or current-like observables; for any displacement-based estimators, also remove the center-of-mass displacement by using $\\Delta r_i'(t) = \\left[r_i(t)-r_i(0)\\right] - \\left[R_{\\mathrm{CM}}(t)-R_{\\mathrm{CM}}(0)\\right]$ with $R_{\\mathrm{CM}}(t) = \\left(\\sum_{i=1}^{N} m_i r_i(t)\\right)/M$.**\nThis option precisely describes the procedure derived from first principles. It correctly subtracts the *instantaneous* COM velocity at each time step to obtain peculiar velocities for use in Green-Kubo calculations. It also correctly subtracts the COM displacement for use in Einstein-type relations. This method robustly removes the artifact of COM drift.\nVerdict: **Correct**.\n\n**B. At $t=0$, rescale all velocities once so that $\\sum_{i=1}^{N} m_i v_i(0)=0$ and then compute correlation functions using the original saved velocities $v_i(t)$ thereafter; do not alter displacements.**\nThis action is insufficient. While it zeros the momentum at $t=0$, the problem states that momentum drifts over time. The momentum will become non-zero again for $t  0$, and the artifact will persist in the correlation functions. This procedure fails to address the root cause of the problem throughout the trajectory.\nVerdict: **Incorrect**.\n\n**C. Compute correlation functions from the unmodified velocities and currents, then apply a time-domain window to the correlation function (for example, a Hann window) to damp long-time tails.**\nThis is an ad-hoc fix. The long-time tail is a systematic error, not random noise. Applying an arbitrary window function will modify the correlation function, and the resulting transport coefficient will depend on the choice and parameters of the window. This approach obscures the physical information and does not fundamentally correct the data. It is not a scientifically rigorous method for dealing with this specific artifact.\nVerdict: **Incorrect**.\n\n**D. Unwrap particle positions under periodic boundary conditions and estimate velocities by finite differences of these unwrapped positions; leave the net momentum unchanged, but compute charge current using $w_i(t) = v_i(t) - v_{\\mathrm{CM}}(t)$ only for the charged species.**\nThis procedure is flawed in multiple ways. Firstly, it inconsistently applies the correction—the COM drift affects all particles, not just charged ones, and thus contaminates all velocity-based correlation functions. Secondly, leaving the net momentum unchanged for some calculations while removing it for others is physically inconsistent. The artifact is global and must be removed globally.\nVerdict: **Incorrect**.\n\n**E. Estimate the time-averaged center-of-mass velocity $\\bar{v}_{\\mathrm{CM}} = \\left(1/T_{\\mathrm{traj}}\\right)\\int_{0}^{T_{\\mathrm{traj}}} v_{\\mathrm{CM}}(t)\\,dt$ over the full trajectory of duration $T_{\\mathrm{traj}}$, and subtract this constant drift from all particle velocities once to obtain $v_i'(t) = v_i(t) - \\bar{v}_{\\mathrm{CM}}$; leave displacements unchanged.**\nThis is an approximation that is only valid if $v_{\\mathrm{CM}}(t)$ is perfectly constant, which contradicts the problem statement that it is \"slowly varying\". Subtracting only the average velocity, $\\bar{v}_{\\mathrm{CM}}$, fails to remove the time-dependent fluctuations of the COM velocity, $\\delta v_{\\mathrm{CM}}(t) = v_{\\mathrm{CM}}(t) - \\bar{v}_{\\mathrm{CM}}$. An artifact term due to the autocorrelation of these fluctuations, $\\langle \\delta v_{\\mathrm{CM}}(0) \\cdot \\delta v_{\\mathrm{CM}}(t) \\rangle$, would remain. The proper procedure is to remove the full instantaneous COM velocity.\nVerdict: **Incorrect**.", "answer": "$$\\boxed{A}$$", "id": "2825787"}, {"introduction": "After learning how to correctly process trajectory data, we must confront a more fundamental question: is the time average from a single, long simulation a valid proxy for the true ensemble average? This exercise explores the concept of ergodicity, the cornerstone assumption that legitimizes this equivalence. By analyzing canonical examples of non-ergodic systems, you will develop a deeper understanding of when a single-trajectory calculation can be trusted and how to diagnose and address situations where ergodicity fails, ensuring that your computational results have a sound statistical mechanical basis [@problem_id:2825850].", "problem": "A classical Hamiltonian system consists of $2$ uncoupled harmonic oscillators with identical masses $m$ and distinct angular frequencies $\\omega_1 \\neq \\omega_2$:\n$$\nH(q_1,q_2,p_1,p_2)=\\frac{p_1^2}{2m}+\\frac{1}{2}m\\omega_1^2 q_1^2+\\frac{p_2^2}{2m}+\\frac{1}{2}m\\omega_2^2 q_2^2.\n$$\nYou perform a long microcanonical molecular dynamics trajectory at fixed total energy $E$ from a single initial condition, and you wish to estimate the velocity autocorrelation function of the first oscillator from this single trajectory and compare it to the microcanonical ensemble average at the same energy. Separately, consider a deeply supercooled glass-forming liquid where structural relaxation is so slow that the system exhibits aging over the observation window; you attempt to estimate a time correlation function from a single long trajectory by assuming time-translation invariance.\n\nWhich statements about the impact of ergodicity failure on correlation function estimates are correct? Select all that apply.\n\nA. For the integrable system of $2$ uncoupled oscillators at fixed total energy $E$, a long single-trajectory estimate of the velocity autocorrelation of the first oscillator generally depends on the initial partition of energy between modes and need not reproduce the microcanonical average that mixes over all partitions.\n\nB. Liouville’s theorem guarantees that a single trajectory of the integrable system will eventually visit all points on the constant-energy surface, so time-averaged correlation functions from one trajectory always converge to the microcanonical ensemble result.\n\nC. In a glassy system that ages, two-time correlation functions depend on the waiting time, so imposing time-translation invariance to estimate a stationary correlation from a single trajectory introduces a systematic bias that does not vanish by extending the trajectory length.\n\nD. Dividing a single trajectory into increasingly long blocks and averaging block-wise correlation estimates removes the bias associated with nonergodicity or aging.\n\nE. Averaging correlation functions over many independent trajectories initiated in different regions of phase space (e.g., different basins or invariant tori) can reduce or eliminate bias due to ergodicity breaking by better approximating the ensemble average at the desired thermodynamic state.", "solution": "The validity of the problem statement is hereby confirmed. The scenarios described—an integrable system of uncoupled oscillators and a non-equilibrium glassy system—are standard, well-defined models in statistical mechanics used to illustrate the failure of the ergodic hypothesis. The language is precise and the question is scientifically grounded and well-posed. We may proceed with the analysis.\n\nThe ergodic hypothesis posits that for a sufficiently long time $T$, the time average of an observable $A$ along a single trajectory is equal to the ensemble average of $A$ in the appropriate statistical ensemble. For an isolated system at constant energy $E$, this is the microcanonical ensemble.\n$$\n\\overline{A} = \\lim_{T \\to \\infty} \\frac{1}{T} \\int_0^T A(\\Gamma(t)) \\, dt = \\langle A \\rangle_{ME} = \\frac{\\int d\\Gamma \\, A(\\Gamma) \\, \\delta(H(\\Gamma) - E)}{\\int d\\Gamma \\, \\delta(H(\\Gamma) - E)}\n$$\nA system is ergodic if a single trajectory explores the entirety of the constant-energy hypersurface, visiting the neighborhood of every point. When a system is not ergodic, the time average depends on the initial conditions, as the trajectory is restricted to a submanifold of the energy surface.\n\nThe problem presents two distinct cases of ergodicity failure.\n\nCase $1$: The integrable system of $2$ uncoupled harmonic oscillators. The Hamiltonian is $H = H_1 + H_2$, with $H_1 = \\frac{p_1^2}{2m} + \\frac{1}{2}m\\omega_1^2 q_1^2$ and $H_2 = \\frac{p_2^2}{2m} + \\frac{1}{2}m\\omega_2^2 q_2^2$. Since the oscillators are uncoupled, not only is the total energy $E = H_1+H_2$ a constant of motion, but $H_1$ and $H_2$ are individually conserved. A single trajectory is launched with a specific initial partition of energy, $E_1$ and $E_2$, such that $E_1+E_2=E$. The trajectory is then confined to the surface defined by the two simultaneous conditions $H_1=E_1$ and $H_2=E_2$. This surface is a $2$-dimensional torus within the $3$-dimensional constant total energy surface defined by $H=E$. The trajectory does not explore other regions of the energy surface corresponding to different partitions of energy $(E'_1, E'_2)$. The system is therefore not ergodic.\n\nCase $2$: The supercooled glass-forming liquid. Such systems are characterized by a rugged potential energy landscape with a vast number of local minima separated by high energy barriers. Below the glass transition temperature, the system becomes kinetically arrested in one region of this landscape (a \"basin\" or \"metabasin\"). A single molecular dynamics trajectory will not sample other basins on any feasible simulation timescale. Furthermore, the system is not in equilibrium and its properties slowly evolve with time, a phenomenon known as aging. This means the system is not stationary; time-translation invariance is broken.\n\nWith this foundation, we evaluate each statement.\n\n**A. For the integrable system of $2$ uncoupled oscillators at fixed total energy $E$, a long single-trajectory estimate of the velocity autocorrelation of the first oscillator generally depends on the initial partition of energy between modes and need not reproduce the microcanonical average that mixes over all partitions.**\n\nThe velocity of the first oscillator is $v_1 = p_1/m$. The velocity autocorrelation function (VACF) is $C_{v_1v_1}(t) = \\langle v_1(0) v_1(t) \\rangle$. A time average calculated from a single trajectory is determined by the dynamics on a specific torus where the energy of the first oscillator is fixed at its initial value, $E_1$. For instance, the value of the VACF at time $t=0$ is $\\langle v_1^2 \\rangle = \\langle p_1^2/m^2 \\rangle$. For a harmonic oscillator, the average kinetic energy is half the total energy, so the time average is $\\overline{v_1^2} = E_1/m$. This value is determined by the initial energy partition. The microcanonical ensemble average, by contrast, averages over all possible partitions of $E$ between the two oscillators. The ensemble-averaged value $\\langle v_1^2 \\rangle_{ME}$ would be an average of $E'_1/m$ over all possible values of $E'_1$ from $0$ to $E$. Since the time average depends on the specific initial $E_1$, it is not equal to the microcanonical average. The statement is a direct and accurate consequence of the non-ergodicity of the system.\n\nVerdict: **Correct**.\n\n**B. Liouville’s theorem guarantees that a single trajectory of the integrable system will eventually visit all points on the constant-energy surface, so time-averaged correlation functions from one trajectory always converge to the microcanonical ensemble result.**\n\nThis statement is fundamentally flawed. Liouville’s theorem states that the density of states in phase space is conserved along a trajectory, implying that phase space volume is an invariant of Hamiltonian flow. It makes no claim about the trajectory's coverage of the energy surface. The property that a trajectory visits almost every point on the energy surface is the definition of ergodicity. As established, the system of $2$ uncoupled oscillators is not ergodic. A trajectory is confined to a lower-dimensional torus and does not explore the full constant-energy surface. Therefore, the premise of the statement is a misinterpretation of Liouville's theorem and is factually incorrect for this system. The conclusion, which is an assertion of the ergodic hypothesis, is consequently also false.\n\nVerdict: **Incorrect**.\n\n**C. In a glassy system that ages, two-time correlation functions depend on the waiting time, so imposing time-translation invariance to estimate a stationary correlation from a single trajectory introduces a systematic bias that does not vanish by extending the trajectory length.**\n\nAging implies that the system's statistical properties are changing with time. It is a non-stationary process. A two-time correlation function, $C(t_1, t_2)$, will depend on both time arguments, not just their difference $\\tau = t_2 - t_1$. It is common to express this as a dependence on a \"waiting time\" $t_w = t_1$ and a lag time $\\tau$. Assuming time-translation invariance (TTI) and computing a correlation function via a simple time average, $ C(\\tau) = \\frac{1}{T_{max}-\\tau} \\int_0^{T_{max}-\\tau} A(t') B(t'+\\tau) dt' $, improperly averages over different waiting times $t'$. As the system ages, its state at later times is different from its state at earlier times. Therefore, this averaging procedure conflates different physical states of the system. This introduces a systematic bias. Extending the trajectory length $T_{max}$ does not resolve this issue, as the aging process continues and the system never reaches a stationary equilibrium state over the extended time. The calculated average will itself depend on $T_{max}$.\n\nVerdict: **Correct**.\n\n**D. Dividing a single trajectory into increasingly long blocks and averaging block-wise correlation estimates removes the bias associated with nonergodicity or aging.**\n\nThis procedure, known as block averaging, is a method for estimating the statistical uncertainty of an average, under the assumption that the process is ergodic and stationary. It does not correct for a systematic failure of ergodicity or stationarity.\nFor the non-ergodic oscillator system, any block, regardless of its length, is still a segment of the same trajectory confined to the same invariant torus. The average over each block will converge to the same biased result (the average over that torus). Averaging these identical results does not yield the correct ensemble average.\nFor the aging glass, different blocks correspond to different epochs of the system's history. Block averages will systematically differ from one another because the system's properties are evolving. Averaging them together obscures this evolution and does not produce an unbiased estimate of any meaningful physical quantity. The method fails to address the underlying problem in both scenarios.\n\nVerdict: **Incorrect**.\n\n**E. Averaging correlation functions over many independent trajectories initiated in different regions of phase space (e.g., different basins or invariant tori) can reduce or eliminate bias due to ergodicity breaking by better approximating the ensemble average at the desired thermodynamic state.**\n\nThis is the standard and correct computational strategy to overcome ergodicity breaking. The core principle of ensemble averaging is to average over all possible microstates consistent with the macroscopic constraints. If a single trajectory cannot sample all relevant microstates, then one must explicitly do so by initiating multiple, independent trajectories. For the oscillator system, one would start trajectories with a representative distribution of initial energy partitions $(E_1, E_2)$ to sample the entire energy surface $H=E$. For the glassy system, starting trajectories from different initial configurations allows for the sampling of different basins in the energy landscape. By averaging the results from these many trajectories, one constructs an approximation to the true ensemble average, thereby mitigating or eliminating the bias that arises from a single non-ergodic trajectory.\n\nVerdict: **Correct**.", "answer": "$$\\boxed{ACE}$$", "id": "2825850"}]}