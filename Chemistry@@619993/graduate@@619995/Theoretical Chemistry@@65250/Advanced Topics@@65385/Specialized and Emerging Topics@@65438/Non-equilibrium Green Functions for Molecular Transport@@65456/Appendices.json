{"hands_on_practices": [{"introduction": "This first exercise explores the foundational model in quantum transport: a single molecular level coupled to metallic leads. This is the simplest possible quantum conductor, and understanding it is the key to mastering the NEGF formalism. By deriving the Local Density of States (LDOS), you will see precisely how coupling to a continuum of electrode states broadens a discrete energy level into a resonance, a hallmark of open quantum systems. Completing this calculation and verifying the sum rule reinforces the physical meaning of the Green's function and self-energy. [@problem_id:2790634]", "problem": "Consider a spinless, non-interacting molecular junction modeled as a single electronic level of on-site energy $\\varepsilon_{0}$ coupled to two metallic electrodes in the Wide Band Limit (WBL). In the Non-Equilibrium Green's Function (NEGF) formalism, denote the retarded Green's function by $G^{r}(E)$, and the retarded self-energies due to the left and right electrodes by $\\Sigma^{r}_{L}(E)$ and $\\Sigma^{r}_{R}(E)$, respectively. In the WBL, the real parts of the self-energies can be neglected and the imaginary parts are energy-independent, so that $\\Sigma^{r}_{\\alpha}(E) = - \\mathrm{i}\\,\\Gamma_{\\alpha}/2$ for $\\alpha \\in \\{L,R\\}$, where $\\Gamma_{\\alpha} > 0$ are constants. Define the total level broadening $\\Gamma \\equiv \\Gamma_{L} + \\Gamma_{R}$. The local density of states (LDOS) on the level is defined by $\\rho(E) \\equiv -\\frac{1}{\\pi}\\,\\mathrm{Im}\\,G^{r}(E)$.\n\nUsing only fundamental definitions and widely accepted results as starting points (for example, the definition of the retarded Greenâ€™s function and its Dyson equation, as well as the LDOS definition above), perform the following:\n\n- Derive $G^{r}(E)$ for this single-level system in terms of $E$, $\\varepsilon_{0}$, and $\\Gamma$ under the WBL assumptions stated.\n- From the LDOS definition, compute a closed-form analytic expression for $\\rho(E)$.\n- Verify explicitly the LDOS sum rule by evaluating $\\int_{-\\infty}^{\\infty} \\rho(E)\\,\\mathrm{d}E$ and showing it equals unity.\n\nExpress your final answer as a single closed-form expression for $\\rho(E)$. No numerical evaluation or rounding is required.", "solution": "The problem as stated is scientifically sound, well-posed, objective, and contains all necessary information for a rigorous solution. It is a standard model in the field of molecular electronics and its solution requires the application of fundamental principles of the non-equilibrium Green's function (NEGF) formalism. We shall proceed with the derivation.\n\nThe starting point is the Dyson equation for the retarded Green's function $G^{r}(E)$, which relates the full Green's function to that of the uncoupled molecular region, $g^{r}(E)$, and the self-energy, $\\Sigma^{r}(E)$, which describes the coupling to the electrodes. The equation is\n$$[G^{r}(E)]^{-1} = [g^{r}(E)]^{-1} - \\Sigma^{r}(E)$$\nFor the specified system, the uncoupled molecular region consists of a single electronic level with energy $\\varepsilon_{0}$. The Hamiltonian is a scalar $H_{M} = \\varepsilon_{0}$. The retarded Green's function for this uncoupled system is given by\n$$g^{r}(E) = (E - \\varepsilon_{0} + i\\eta)^{-1}$$\nwhere $\\eta$ is a positive infinitesimal quantity, ensuring the correct analytic properties. Therefore, the inverse is\n$$[g^{r}(E)]^{-1} = E - \\varepsilon_{0} + i\\eta$$\nThe total self-energy $\\Sigma^{r}(E)$ is the sum of the contributions from the left ($L$) and right ($R$) electrodes:\n$$\\Sigma^{r}(E) = \\Sigma^{r}_{L}(E) + \\Sigma^{r}_{R}(E)$$\nThe problem specifies the Wide Band Limit (WBL) approximation, where the self-energies are given as $\\Sigma^{r}_{\\alpha}(E) = - \\mathrm{i}\\,\\Gamma_{\\alpha}/2$ for $\\alpha \\in \\{L,R\\}$. The total self-energy is thus energy-independent:\n$$\\Sigma^{r}(E) = - \\frac{\\mathrm{i}\\,\\Gamma_{L}}{2} - \\frac{\\mathrm{i}\\,\\Gamma_{R}}{2} = - \\frac{\\mathrm{i}}{2}(\\Gamma_{L} + \\Gamma_{R})$$\nUsing the provided definition of the total level broadening, $\\Gamma \\equiv \\Gamma_{L} + \\Gamma_{R}$, we obtain\n$$\\Sigma^{r}(E) = - \\frac{\\mathrm{i}\\,\\Gamma}{2}$$\nSubstituting $[g^{r}(E)]^{-1}$ and $\\Sigma^{r}(E)$ into the Dyson equation gives\n$$[G^{r}(E)]^{-1} = (E - \\varepsilon_{0} + i\\eta) - \\left(- \\frac{\\mathrm{i}\\,\\Gamma}{2}\\right) = E - \\varepsilon_{0} + \\mathrm{i}\\left(\\eta + \\frac{\\Gamma}{2}\\right)$$\nSince $\\Gamma > 0$, the finite term $\\Gamma/2$ dominates the infinitesimal $\\eta$. We can therefore neglect $\\eta$ to obtain\n$$[G^{r}(E)]^{-1} = E - \\varepsilon_{0} + \\frac{\\mathrm{i}\\,\\Gamma}{2}$$\nInverting this expression yields the retarded Green's function for the coupled single-level system, which completes the first task:\n$$G^{r}(E) = \\frac{1}{E - \\varepsilon_{0} + \\mathrm{i}\\,\\frac{\\Gamma}{2}}$$\nNext, we compute the local density of states (LDOS), $\\rho(E)$, using its definition:\n$$\\rho(E) \\equiv -\\frac{1}{\\pi}\\,\\mathrm{Im}\\,G^{r}(E)$$\nTo find the imaginary part of $G^{r}(E)$, we multiply the numerator and denominator by the complex conjugate of the denominator:\n$$G^{r}(E) = \\frac{1}{E - \\varepsilon_{0} + \\mathrm{i}\\,\\frac{\\Gamma}{2}} \\times \\frac{E - \\varepsilon_{0} - \\mathrm{i}\\,\\frac{\\Gamma}{2}}{E - \\varepsilon_{0} - \\mathrm{i}\\,\\frac{\\Gamma}{2}} = \\frac{E - \\varepsilon_{0} - \\mathrm{i}\\,\\frac{\\Gamma}{2}}{(E - \\varepsilon_{0})^{2} + \\left(\\frac{\\Gamma}{2}\\right)^{2}}$$\nThe imaginary part of $G^{r}(E)$ is\n$$\\mathrm{Im}\\,G^{r}(E) = \\frac{-\\frac{\\Gamma}{2}}{(E - \\varepsilon_{0})^{2} + \\left(\\frac{\\Gamma}{2}\\right)^{2}}$$\nSubstituting this into the definition for $\\rho(E)$ provides the closed-form expression, completing the second task:\n$$\\rho(E) = -\\frac{1}{\\pi} \\left( \\frac{-\\frac{\\Gamma}{2}}{(E - \\varepsilon_{0})^{2} + \\left(\\frac{\\Gamma}{2}\\right)^{2}} \\right) = \\frac{1}{\\pi} \\frac{\\frac{\\Gamma}{2}}{(E - \\varepsilon_{0})^{2} + \\left(\\frac{\\Gamma}{2}\\right)^{2}}$$\nThis is a Lorentzian distribution centered at $E=\\varepsilon_{0}$ with a half-width at half-maximum (HWHM) of $\\Gamma/2$.\n\nFinally, we explicitly verify the LDOS sum rule by evaluating the integral $\\int_{-\\infty}^{\\infty} \\rho(E)\\,\\mathrm{d}E$.\n$$\\int_{-\\infty}^{\\infty} \\rho(E)\\,\\mathrm{d}E = \\int_{-\\infty}^{\\infty} \\frac{1}{\\pi} \\frac{\\frac{\\Gamma}{2}}{(E - \\varepsilon_{0})^{2} + \\left(\\frac{\\Gamma}{2}\\right)^{2}} \\,\\mathrm{d}E$$\nWe perform a change of variables. Let $u = E - \\varepsilon_{0}$, which implies $\\mathrm{d}u = \\mathrm{d}E$. The integration limits remain unchanged.\n$$\\int_{-\\infty}^{\\infty} \\rho(E)\\,\\mathrm{d}E = \\frac{1}{\\pi} \\int_{-\\infty}^{\\infty} \\frac{\\frac{\\Gamma}{2}}{u^{2} + \\left(\\frac{\\Gamma}{2}\\right)^{2}} \\,\\mathrm{d}u$$\nLet $a = \\Gamma/2$. The integral becomes\n$$\\frac{a}{\\pi} \\int_{-\\infty}^{\\infty} \\frac{1}{u^{2} + a^{2}} \\,\\mathrm{d}u$$\nThe standard antiderivative is $\\int \\frac{1}{u^{2} + a^{2}} \\,\\mathrm{d}u = \\frac{1}{a} \\arctan\\left(\\frac{u}{a}\\right)$. Evaluating the definite integral:\n$$\\frac{a}{\\pi} \\left[ \\frac{1}{a} \\arctan\\left(\\frac{u}{a}\\right) \\right]_{-\\infty}^{\\infty} = \\frac{1}{\\pi} \\left[ \\arctan\\left(\\frac{u}{a}\\right) \\right]_{-\\infty}^{\\infty}$$\nTaking the limits, we have\n$$\\frac{1}{\\pi} \\left( \\lim_{u \\to \\infty} \\arctan\\left(\\frac{u}{a}\\right) - \\lim_{u \\to -\\infty} \\arctan\\left(\\frac{u}{a}\\right) \\right) = \\frac{1}{\\pi} \\left( \\frac{\\pi}{2} - \\left(-\\frac{\\pi}{2}\\right) \\right) = \\frac{1}{\\pi} (\\pi) = 1$$\nThe sum rule is verified, which confirms that the total probability of finding the electron across all energies is normalized to $1$, as expected for a single-state system. All parts of the problem are now solved.", "answer": "$$\\boxed{\\frac{1}{\\pi} \\frac{\\frac{\\Gamma}{2}}{(E - \\varepsilon_{0})^{2} + \\left(\\frac{\\Gamma}{2}\\right)^{2}}}$$", "id": "2790634"}, {"introduction": "Building on the single-level model, we now advance to a system with internal structure: a two-site molecular dimer. This problem introduces the essential matrix representation of Hamiltonians and Green's functions, which is necessary for any realistic molecule. You will derive the transmission function $T(E)$ from first principles, revealing how quantum conductance is governed not only by the molecule's internal architecture (the hopping $t_c$) but also by the specifics of its connection to the electrodes, particularly the effect of asymmetric coupling ($\\Gamma_L \\neq \\Gamma_R$). [@problem_id:2790684]", "problem": "Consider a coherent molecular junction modeled by a $2$-site tight-binding device coupled to two metallic electrodes within the framework of Non-Equilibrium Green's Functions (NEGF). The device Hamiltonian in the site basis $\\{|1\\rangle,|2\\rangle\\}$ is\n$$\nH_{d}=\\begin{pmatrix}\n\\varepsilon_{1}  t_{c} \\\\\nt_{c}  \\varepsilon_{2}\n\\end{pmatrix},\n$$\nwith real inter-site hopping $t_{c}0$. The left lead couples only to site $\\lvert 1\\rangle$ with a level-width parameter $\\Gamma_{L}$, and the right lead couples only to site $\\lvert 2\\rangle$ with a level-width parameter $\\Gamma_{R}$. Assume the Wide-Band Limit (WBL) for both electrodes, with energy-independent level-widths and vanishing Lamb shifts (i.e., no real part of the self-energy).\n\nStarting from fundamental definitions of retarded Green's functions and the Landauer formalism within NEGF (do not assume any pre-derived specialized formula beyond these foundations), do the following:\n\n$1.$ Write the retarded self-energy matrices $\\Sigma^{r}_{L}$ and $\\Sigma^{r}_{R}$ for the left and right electrodes, respectively, as $2\\times 2$ matrices consistent with the stated couplings and the WBL.\n\n$2.$ Using these self-energies and the definition of the retarded Green's function $G^{r}(E)$, derive the exact energy-resolved transmission $T(E)$ for the $2$-site device in closed analytic form.\n\n$3.$ Specialize your result to the resonant dimer case $\\varepsilon_{1}=\\varepsilon_{2}=0$ with real $t_{c}$, and simplify $T(E)$ to a single closed-form expression in terms of $E$, $\\Gamma_{L}$, $\\Gamma_{R}$, and $t_{c}$.\n\nIn your derivation, explicitly identify where and how contact asymmetry (i.e., $\\Gamma_{L}\\neq \\Gamma_{R}$) enters the result and comment on its qualitative effect on $T(E)$ under the stated assumptions. For the final answer, report only the simplified expression for $T(E)$ in part $3$. The transmission is dimensionless; no units are required. No numerical evaluation is needed, and no rounding is required. Provide your final answer as an analytic expression only.", "solution": "The problem as stated is scientifically sound, self-contained, and well-posed within the established framework of non-equilibrium Green's functions for molecular transport. It presents a standard, solvable model. We may therefore proceed with the derivation.\n\nThe task is to derive the transmission function $T(E)$ for a $2$-site molecular device. We begin from the fundamental definitions of the retarded Green's function $G^{r}(E)$ and the Landauer formula for transmission within the NEGF formalism.\n\nThe retarded Green's function for the device region is given by the Dyson equation:\n$$\nG^{r}(E) = [ (E+i\\eta)I - H_{d} - \\Sigma^{r}(E) ]^{-1}\n$$\nwhere $\\eta$ is a positive infinitesimal, $I$ is the $2 \\times 2$ identity matrix, $H_{d}$ is the device Hamiltonian, and $\\Sigma^{r}(E)$ is the total retarded self-energy due to the coupling to the electrodes. The total self-energy is the sum of contributions from the left ($L$) and right ($R$) electrodes: $\\Sigma^{r}(E) = \\Sigma^{r}_{L}(E) + \\Sigma^{r}_{R}(E)$.\n\nThe transmission probability from the left to the right lead is given by the Landauer formula, which in the context of NEGF is expressed via the Caroli formula:\n$$\nT(E) = \\text{Tr}[\\Gamma_{L}(E) G^{r}(E) \\Gamma_{R}(E) G^{a}(E)]\n$$\nwhere $G^{a}(E) = [G^{r}(E)]^{\\dagger}$ is the advanced Green's function and $\\Gamma_{\\alpha}(E)$ are the level-width matrices for the leads, defined as $\\Gamma_{\\alpha}(E) = i[\\Sigma^{r}_{\\alpha}(E) - \\Sigma^{a}_{\\alpha}(E)]$.\n\nPart $1$: Retarded Self-Energies\nThe retarded self-energy for a lead $\\alpha$ can be written as $\\Sigma^{r}_{\\alpha}(E) = \\Lambda_{\\alpha}(E) - \\frac{i}{2}\\Gamma_{\\alpha}(E)$, where $\\Lambda_{\\alpha}(E)$ is the Lamb shift (real part) and $\\Gamma_{\\alpha}(E)$ is the level-width matrix (related to the imaginary part). The problem specifies the Wide-Band Limit (WBL), which has two consequences:\n$1$. The Lamb shift is zero: $\\Lambda_{\\alpha}(E) = 0$.\n$2$. The level-width matrix $\\Gamma_{\\alpha}(E)$ is independent of energy, $E$.\n\nThus, $\\Sigma^{r}_{\\alpha} = -\\frac{i}{2}\\Gamma_{\\alpha}$. The matrix $\\Gamma_{\\alpha}$ has elements $(\\Gamma_{\\alpha})_{ij}$ that depend on the coupling strengths between the device sites $i,j$ and the lead $\\alpha$.\nWe are given that the left lead ($L$) couples only to site $|1\\rangle$. This means the only non-zero element of the level-width matrix $\\Gamma_{L}$ is at the $(1,1)$ position. Its value is the given parameter $\\Gamma_{L}$.\nSimilarly, the right lead ($R$) couples only to site $|2\\rangle$, so the only non-zero element of $\\Gamma_{R}$ is $(\\Gamma_{R})_{22} = \\Gamma_{R}$.\nWriting these as $2 \\times 2$ matrices in the site basis $\\{|1\\rangle, |2\\rangle\\}$:\n$$\n\\Gamma_{L} = \\begin{pmatrix} \\Gamma_{L}  0 \\\\ 0  0 \\end{pmatrix}, \\quad \\Gamma_{R} = \\begin{pmatrix} 0  0 \\\\ 0  \\Gamma_{R} \\end{pmatrix}\n$$\nConsequently, the retarded self-energy matrices are:\n$$\n\\Sigma^{r}_{L} = -\\frac{i}{2}\\Gamma_{L} = \\begin{pmatrix} -i\\Gamma_{L}/2  0 \\\\ 0  0 \\end{pmatrix}\n$$\n$$\n\\Sigma^{r}_{R} = -\\frac{i}{2}\\Gamma_{R} = \\begin{pmatrix} 0  0 \\\\ 0  -i\\Gamma_{R}/2 \\end{pmatrix}\n$$\nThe total retarded self-energy is their sum:\n$$\n\\Sigma^{r} = \\Sigma^{r}_{L} + \\Sigma^{r}_{R} = \\begin{pmatrix} -i\\Gamma_{L}/2  0 \\\\ 0  -i\\Gamma_{R}/2 \\end{pmatrix}\n$$\n\nPart $2$: Derivation of the Transmission Function $T(E)$\nWe first compute the retarded Green's function $G^{r}(E)$. The matrix to be inverted is:\n$$\n[G^{r}(E)]^{-1} = EI - H_{d} - \\Sigma^{r} = E\\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} - \\begin{pmatrix} \\varepsilon_{1}  t_{c} \\\\ t_{c}  \\varepsilon_{2} \\end{pmatrix} - \\begin{pmatrix} -i\\Gamma_{L}/2  0 \\\\ 0  -i\\Gamma_{R}/2 \\end{pmatrix}\n$$\n$$\n[G^{r}(E)]^{-1} = \\begin{pmatrix} E - \\varepsilon_{1} + i\\Gamma_{L}/2  -t_{c} \\\\ -t_{c}  E - \\varepsilon_{2} + i\\Gamma_{R}/2 \\end{pmatrix}\n$$\nThe determinant of this matrix is:\n$$\n\\det([G^{r}(E)]^{-1}) = (E - \\varepsilon_{1} + i\\Gamma_{L}/2)(E - \\varepsilon_{2} + i\\Gamma_{R}/2) - t_{c}^{2}\n$$\nThe Green's function is the inverse:\n$$\nG^{r}(E) = \\frac{1}{\\det([G^{r}(E)]^{-1})} \\begin{pmatrix} E - \\varepsilon_{2} + i\\Gamma_{R}/2  t_{c} \\\\ t_{c}  E - \\varepsilon_{1} + i\\Gamma_{L}/2 \\end{pmatrix}\n$$\nNow we compute $T(E) = \\text{Tr}[\\Gamma_{L} G^{r} \\Gamma_{R} G^{a}]$. Because the lead coupling matrices $\\Gamma_{L}$ and $\\Gamma_{R}$ are diagonal and couple to distinct sites ($1$ and $2$ respectively), the trace simplifies. Let us show this explicitly. The sum is over indices $i,j,k,l$:\n$T(E) = \\sum_{i,j,k,l} (\\Gamma_{L})_{ij} (G^{r})_{jk} (\\Gamma_{R})_{kl} (G^{a})_{li}$.\nWith $(\\Gamma_{L})_{ij} = \\delta_{i1}\\delta_{j1}\\Gamma_{L}$ and $(\\Gamma_{R})_{kl} = \\delta_{k2}\\delta_{l2}\\Gamma_{R}$, the expression becomes:\n$$\nT(E) = \\Gamma_{L}\\Gamma_{R} (G^{r})_{12} (G^{a})_{21}\n$$\nSince $G^{a} = (G^{r})^{\\dagger}$, we have $(G^{a})_{21} = (G^{r}_{12})^{*}$. Therefore,\n$$\nT(E) = \\Gamma_{L}\\Gamma_{R} |G^{r}_{12}(E)|^{2}\n$$\nFrom our expression for $G^{r}(E)$, the required element is $G^{r}_{12}(E) = \\frac{t_{c}}{\\det([G^{r}(E)]^{-1})}$.\nSubstituting this into the expression for $T(E)$ yields the general result:\n$$\nT(E) = \\Gamma_{L}\\Gamma_{R} \\left| \\frac{t_{c}}{(E - \\varepsilon_{1} + i\\Gamma_{L}/2)(E - \\varepsilon_{2} + i\\Gamma_{R}/2) - t_{c}^{2}} \\right|^{2}\n$$\n$$\nT(E) = \\frac{\\Gamma_{L}\\Gamma_{R}t_{c}^{2}}{|(E - \\varepsilon_{1} + i\\Gamma_{L}/2)(E - \\varepsilon_{2} + i\\Gamma_{R}/2) - t_{c}^{2}|^{2}}\n$$\nThis is the closed analytic form for the energy-resolved transmission for the general $2$-site model.\n\nPart $3$: Specialization to the Resonant Dimer\nWe now set the on-site energies to zero, $\\varepsilon_{1} = \\varepsilon_{2} = 0$, as requested for the resonant dimer case. The denominator term inside the modulus becomes:\n$$\nD(E) = (E + i\\Gamma_{L}/2)(E + i\\Gamma_{R}/2) - t_{c}^{2}\n$$\n$$\nD(E) = E^{2} + iE\\frac{\\Gamma_{L}+\\Gamma_{R}}{2} - \\frac{\\Gamma_{L}\\Gamma_{R}}{4} - t_{c}^{2}\n$$\nGrouping real and imaginary parts:\n$$\nD(E) = \\left( E^{2} - t_{c}^{2} - \\frac{\\Gamma_{L}\\Gamma_{R}}{4} \\right) + i \\left( \\frac{E(\\Gamma_{L}+\\Gamma_{R})}{2} \\right)\n$$\nThe squared modulus is $|D(E)|^{2} = (\\text{Re}[D])^{2} + (\\text{Im}[D])^{2}$:\n$$\n|D(E)|^{2} = \\left( E^{2} - t_{c}^{2} - \\frac{\\Gamma_{L}\\Gamma_{R}}{4} \\right)^{2} + \\left( \\frac{E(\\Gamma_{L}+\\Gamma_{R})}{2} \\right)^{2}\n$$\nSubstituting this into our expression for $T(E)$, we obtain the final simplified form:\n$$\nT(E) = \\frac{\\Gamma_{L} \\Gamma_{R} t_{c}^{2}}{\\left( E^{2} - t_{c}^{2} - \\frac{\\Gamma_{L} \\Gamma_{R}}{4} \\right)^{2} + \\frac{E^{2}(\\Gamma_{L} + \\Gamma_{R})^{2}}{4}}\n$$\nThis is the required result for the resonant dimer.\n\nFinally, we comment on the effect of contact asymmetry ($\\Gamma_{L} \\neq \\Gamma_{R}$). The asymmetry enters the expression for $T(E)$ in both the numerator (as the product $\\Gamma_{L}\\Gamma_{R}$) and the denominator. A key insight comes from examining the peak transmission. The denominator is a sum of two squared terms and is always non-negative. For a given total coupling strength $\\Gamma_{tot} = \\Gamma_{L} + \\Gamma_{R}$, the numerator $\\Gamma_{L}\\Gamma_{R}$ is maximized when the coupling is symmetric, i.e., $\\Gamma_{L} = \\Gamma_{R} = \\Gamma_{tot}/2$. Any deviation from this symmetry (asymmetry) while keeping the total coupling fixed will reduce the value of the numerator. A more detailed analysis shows that the prefactor $\\frac{4\\Gamma_{L}\\Gamma_{R}}{(\\Gamma_{L}+\\Gamma_{R})^{2}}$ determines the maximum possible peak height, and this factor is unity only for symmetric coupling and less than unity otherwise. Thus, contact asymmetry acts as an impedance mismatch between the electrodes and the device, which suppresses the overall transmission magnitude compared to a symmetrically coupled junction with the same total broadening.", "answer": "$$\n\\boxed{\\frac{\\Gamma_{L} \\Gamma_{R} t_{c}^{2}}{\\left( E^{2} - t_{c}^{2} - \\frac{\\Gamma_{L} \\Gamma_{R}}{4} \\right)^{2} + \\frac{E^{2}(\\Gamma_{L} + \\Gamma_{R})^{2}}{4}}}\n$$", "id": "2790684"}, {"introduction": "This practice bridges the gap between elegant analytical theory and the practical realities of computational simulation. You will begin by deriving one of the most fundamental results in steady-state transportâ€”current conservation ($I_L + I_R = 0$)â€”directly from the NEGF framework. The main task, however, is a numerical one: to implement a code that calculates the terminal currents and to investigate why this exact law can be violated in a finite numerical calculation. This hands-on coding exercise provides critical insight into the numerical artifacts arising from finite energy grids, integration rules, and truncated integration windows, skills that are indispensable for performing and interpreting computational transport studies. [@problem_id:2790687]", "problem": "Consider a coherent two-terminal molecular junction modeled by a single molecular orbital coupled to two electrodes. The device is studied within the non-equilibrium Green's function (NEGF) framework. The molecular orbital has on-site energy $ \\varepsilon_0 $ and couples to the left and right electrodes via energy-dependent coupling (level-broadening) functions $ \\Gamma_L(E) $ and $ \\Gamma_R(E) $. Assume steady state and coherent transport, and use the continuity equation $ d\\langle \\hat{N} \\rangle/dt = 0 $ as the fundamental starting point, together with the definitions of the retarded Green's function $ G^r(E) $ and coupling functions $ \\Gamma_{\\alpha}(E) $ for electrode index $ \\alpha \\in \\{L,R\\} $. Use the standard assumption that the retarded self-energies have vanishing real parts, $ \\Sigma^r_{\\alpha}(E) = -\\tfrac{i}{2}\\Gamma_{\\alpha}(E) $, so that causality is preserved by $ G^r(E) $ and $ G^a(E) = [G^r(E)]^{\\dagger} $, and the spectral function $ A(E) = i\\left(G^r(E) - G^a(E)\\right) $ satisfies $ A(E) = |G^r(E)|^2 \\left[\\Gamma_L(E) + \\Gamma_R(E)\\right] $. The electrodes are characterized by the Fermiâ€“Dirac distributions $ f_{\\alpha}(E) = \\left[1 + \\exp\\left(\\tfrac{E - \\mu_{\\alpha}}{k_B T}\\right)\\right]^{-1} $ at temperature $ T $, with electrochemical potentials $ \\mu_L $ and $ \\mu_R $ set by a symmetrically applied bias $ V $, namely $ \\mu_L = E_F + \\tfrac{e V}{2} $ and $ \\mu_R = E_F - \\tfrac{e V}{2} $, where $ E_F $ is a reference Fermi energy. Here $ e $ is the elementary charge, $ h $ is Planck's constant, and $ k_B $ is Boltzmann's constant.\n\nStarting from these base definitions and conservation principles, derive the two-terminal current expressions in terms of the device Green's functions and couplings, and show from first principles that the steady-state currents satisfy $ I_L + I_R = 0 $. Then, implement a numerical verification on a finite energy grid using the derived expressions. You must:\n\n- Define $ \\Gamma_L(E) $ and $ \\Gamma_R(E) $ as smooth, positive functions of energy. For testability, use the following explicit choices (with background terms added to avoid vanishing couplings):\n  - A Gaussian for $ \\Gamma_L(E) $: $ \\Gamma_L(E) = \\Gamma_{L,0} \\exp\\!\\left(-\\dfrac{(E - E_{L,c})^2}{2 \\sigma_L^2}\\right) + \\Gamma_{L,\\mathrm{bg}} $.\n  - A Lorentzian for $ \\Gamma_R(E) $: $ \\Gamma_R(E) = \\Gamma_{R,0} \\dfrac{(\\gamma_R/2)^2}{(E - E_{R,c})^2 + (\\gamma_R/2)^2} + \\Gamma_{R,\\mathrm{bg}} $.\n- Use a single-level device Green's function $ G^r(E) $ and the corresponding transmission defined from the spectral structure and couplings. The working energy grid must be finite: $ E \\in [E_{\\min}, E_{\\max}] $ with a specified number of grid points $ N $.\n- Evaluate $ I_L $ and $ I_R $ numerically on the specified finite energy grid using numerical quadrature. To expose sources of numerical violation, compute $ I_L $ with one quadrature rule and $ I_R $ either with the same or a different quadrature rule, as specified in the test suite below.\n- Report the residual $ I_L + I_R $ for each test case. Express each current in amperes, so the residuals must be reported in amperes. All input energies are specified in electronvolts and must be internally converted to joules; temperatures are in kelvin; voltages are in volts. Angles are not involved. The final numerical outputs must be real numbers in amperes.\n\nTest suite. Implement the following parameter sets. Each test case defines:\n- Device and thermodynamic parameters: $ \\varepsilon_0 $ (in electronvolts), $ E_F $ (in electronvolts), $ T $ (in kelvin), $ V $ (in volts).\n- Coupling parameters for $ \\Gamma_L(E) $ (Gaussian): $ \\Gamma_{L,0} $ (in electronvolts), $ E_{L,c} $ (in electronvolts), $ \\sigma_L $ (in electronvolts), $ \\Gamma_{L,\\mathrm{bg}} $ (in electronvolts).\n- Coupling parameters for $ \\Gamma_R(E) $ (Lorentzian): $ \\Gamma_{R,0} $ (in electronvolts), $ E_{R,c} $ (in electronvolts), $ \\gamma_R $ (in electronvolts), $ \\Gamma_{R,\\mathrm{bg}} $ (in electronvolts).\n- Energy window and grid: $ E_{\\min} $ (in electronvolts), $ E_{\\max} $ (in electronvolts), $ N $ (integer grid size).\n- Quadrature rules for $ I_L $ and $ I_R $ chosen among: trapezoidal rule or midpoint rule. The midpoint rule should evaluate the integrand at cell midpoints with uniform spacing implied by the grid.\n\nProvide and use these five test cases:\n- Case $ 1 $ (dense grid, consistent quadrature): $ \\varepsilon_0 = 0.1 $, $ E_F = 0.0 $, $ T = 300 $, $ V = 0.1 $; $ \\Gamma_{L,0} = 0.2 $, $ E_{L,c} = 0.0 $, $ \\sigma_L = 0.5 $, $ \\Gamma_{L,\\mathrm{bg}} = 0.02 $; $ \\Gamma_{R,0} = 0.15 $, $ E_{R,c} = 0.05 $, $ \\gamma_R = 0.3 $, $ \\Gamma_{R,\\mathrm{bg}} = 0.02 $; $ E_{\\min} = -5.0 $, $ E_{\\max} = 5.0 $, $ N = 20001 $; use trapezoidal rule for both $ I_L $ and $ I_R $.\n- Case $ 2 $ (dense grid, inconsistent quadrature): $ \\varepsilon_0 = -0.2 $, $ E_F = 0.0 $, $ T = 300 $, $ V = 1.0 $; $ \\Gamma_{L,0} = 0.3 $, $ E_{L,c} = -0.1 $, $ \\sigma_L = 0.4 $, $ \\Gamma_{L,\\mathrm{bg}} = 0.01 $; $ \\Gamma_{R,0} = 0.05 $, $ E_{R,c} = 0.2 $, $ \\gamma_R = 0.2 $, $ \\Gamma_{R,\\mathrm{bg}} = 0.01 $; $ E_{\\min} = -6.0 $, $ E_{\\max} = 6.0 $, $ N = 20001 $; use trapezoidal rule for $ I_L $ and midpoint rule for $ I_R $.\n- Case $ 3 $ (coarse grid, inconsistent quadrature): $ \\varepsilon_0 = 0.0 $, $ E_F = 0.0 $, $ T = 300 $, $ V = 0.2 $; $ \\Gamma_{L,0} = 0.15 $, $ E_{L,c} = 0.0 $, $ \\sigma_L = 0.2 $, $ \\Gamma_{L,\\mathrm{bg}} = 0.005 $; $ \\Gamma_{R,0} = 0.15 $, $ E_{R,c} = 0.0 $, $ \\gamma_R = 0.25 $, $ \\Gamma_{R,\\mathrm{bg}} = 0.005 $; $ E_{\\min} = -2.0 $, $ E_{\\max} = 2.0 $, $ N = 401 $; use trapezoidal rule for $ I_L $ and midpoint rule for $ I_R $.\n- Case $ 4 $ (truncated window, inconsistent quadrature): $ \\varepsilon_0 = 0.0 $, $ E_F = 0.0 $, $ T = 50 $, $ V = 2.0 $; $ \\Gamma_{L,0} = 0.2 $, $ E_{L,c} = 0.0 $, $ \\sigma_L = 0.3 $, $ \\Gamma_{L,\\mathrm{bg}} = 0.01 $; $ \\Gamma_{R,0} = 0.2 $, $ E_{R,c} = 0.0 $, $ \\gamma_R = 0.3 $, $ \\Gamma_{R,\\mathrm{bg}} = 0.01 $; $ E_{\\min} = -1.0 $, $ E_{\\max} = 1.0 $, $ N = 2001 $; use trapezoidal rule for $ I_L $ and midpoint rule for $ I_R $.\n- Case $ 5 $ (sharp Fermi edges, very dense grid, consistent quadrature): $ \\varepsilon_0 = 0.05 $, $ E_F = 0.0 $, $ T = 1 $, $ V = 0.05 $; $ \\Gamma_{L,0} = 0.1 $, $ E_{L,c} = 0.0 $, $ \\sigma_L = 0.25 $, $ \\Gamma_{L,\\mathrm{bg}} = 0.005 $; $ \\Gamma_{R,0} = 0.1 $, $ E_{R,c} = 0.0 $, $ \\gamma_R = 0.25 $, $ \\Gamma_{R,\\mathrm{bg}} = 0.005 $; $ E_{\\min} = -2.0 $, $ E_{\\max} = 2.0 $, $ N = 40001 $; use trapezoidal rule for both $ I_L $ and $ I_R $.\n\nImplementation requirements:\n- Your program must compute $ I_L $ and $ I_R $ for each case on the specified finite grid and report the residual $ I_L + I_R $ for each case in amperes. Internally, convert all energies from electronvolts to joules and use $ e $ in coulombs, $ h $ in joule-seconds, and $ k_B $ in joules per kelvin.\n- The final output format must be a single line containing the results as a comma-separated list enclosed in square brackets, in the order of Cases $ 1 $ through $ 5 $, e.g., $ [r_1,r_2,r_3,r_4,r_5] $, where each $ r_i $ is a floating-point number in amperes.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $ [r_1,r_2,r_3,r_4,r_5] $).", "solution": "The problem requires a derivation of the terminal currents in a two-terminal molecular junction and a proof of current conservation, $I_L + I_R = 0$, from first principles within the non-equilibrium Green's function (NEGF) framework. Subsequently, a numerical verification must be implemented to demonstrate how this analytical conservation law can be numerically violated.\n\n### Theoretical Derivation\n\nWe begin from the fundamental principle of charge conservation. At steady state, the total number of electrons $ \\langle \\hat{N} \\rangle $ in the central molecular region is constant. The time evolution of $ \\langle \\hat{N} \\rangle $ is governed by the sum of currents flowing into the molecule from each electrode, indexed by $ \\alpha \\in \\{L, R\\} $. Thus, the continuity equation is:\n$$ \\frac{d\\langle \\hat{N} \\rangle}{dt} = \\frac{1}{e}\\left(I_L + I_R\\right) = 0 $$\nThis implies that analytically, $ I_L + I_R = 0 $, where $ I_{\\alpha} $ is the electrical current flowing from lead $ \\alpha $ into the molecule.\n\nTo derive expressions for $ I_L $ and $ I_R $, we use the Meir-Wingreen formula, a cornerstone of NEGF transport theory, which expresses the current from lead $ \\alpha $ as:\n$$ I_{\\alpha} = \\frac{ie}{\\hbar} \\int \\frac{dE}{2\\pi} \\text{Tr} \\left\\{ \\Gamma_{\\alpha}(E) \\left[ f_{\\alpha}(E) \\left( G^r(E) - G^a(E) \\right) + G^(E) \\right] \\right\\} $$\nFor a single-level system, the trace becomes a scalar product, and using $ h = 2\\pi\\hbar $:\n$$ I_{\\alpha} = \\frac{ie}{h} \\int dE \\, \\Gamma_{\\alpha}(E) \\left[ f_{\\alpha}(E) \\left( G^r(E) - G^a(E) \\right) + G^(E) \\right] $$\nWe require expressions for the Green's functions. The problem statement provides the relation for the spectral function $ A(E) = i\\left(G^r(E) - G^a(E)\\right) $, which means $ G^r(E) - G^a(E) = -iA(E) $.\n\nThe lesser Green's function $ G^(E) $ is determined by the lesser self-energy $ \\Sigma^(E) $ via the Keldysh equation:\n$$ G^(E) = G^r(E) \\Sigma^(E) G^a(E) $$\nThe total lesser self-energy is the sum of contributions from the leads, $ \\Sigma^(E) = \\Sigma_L^(E) + \\Sigma_R^(E) $. Each contribution is given by $ \\Sigma_{\\alpha}^(E) = i f_{\\alpha}(E) \\Gamma_{\\alpha}(E) $, where $ f_{\\alpha}(E) $ is the Fermi-Dirac distribution of lead $ \\alpha $. For a single-level device, $ G^r(E)G^a(E) = |G^r(E)|^2 $, so we have:\n$$ G^(E) = i |G^r(E)|^2 \\left( f_L(E)\\Gamma_L(E) + f_R(E)\\Gamma_R(E) \\right) $$\nSubstituting these relations into the Meir-Wingreen formula for $ I_{\\alpha} $, we obtain:\n$$ I_{\\alpha} = \\frac{ie}{h} \\int dE \\, \\Gamma_{\\alpha}(E) \\left[ f_{\\alpha}(E) (-iA(E)) + i |G^r(E)|^2 \\left( f_L(E)\\Gamma_L(E) + f_R(E)\\Gamma_R(E) \\right) \\right] $$\n$$ I_{\\alpha} = \\frac{e}{h} \\int dE \\, \\Gamma_{\\alpha}(E) \\left[ f_{\\alpha}(E) A(E) - |G^r(E)|^2 \\left( f_L(E)\\Gamma_L(E) + f_R(E)\\Gamma_R(E) \\right) \\right] $$\nThis gives distinct expressions for the current from each lead. The first term, $ \\propto f_{\\alpha} A $, represents the rate of electrons tunneling *from* lead $ \\alpha $ into the available states $ A(E) $ on the molecule. The second term, proportional to $ G^(E)/i $, represents the rate of electrons tunneling *out of* the occupied molecular states into lead $ \\alpha $.\n\nLet us denote the integrands for $ I_L $ and $ I_R $ by $ \\mathcal{J}_L(E) $ and $ \\mathcal{J}_R(E) $, respectively:\n$$ \\mathcal{J}_L(E) = \\Gamma_L(E) \\left[ f_L(E) A(E) - |G^r(E)|^2 \\left( f_L\\Gamma_L + f_R\\Gamma_R \\right) \\right] $$\n$$ \\mathcal{J}_R(E) = \\Gamma_R(E) \\left[ f_R(E) A(E) - |G^r(E)|^2 \\left( f_L\\Gamma_L + f_R\\Gamma_R \\right) \\right] $$\nTo prove that $ I_L + I_R = 0 $, we show that their integrands sum to zero at every energy $ E $.\n$$ \\mathcal{J}_L(E) + \\mathcal{J}_R(E) = A(E) \\left( f_L\\Gamma_L + f_R\\Gamma_R \\right) - \\left( \\Gamma_L + \\Gamma_R \\right) |G^r(E)|^2 \\left( f_L\\Gamma_L + f_R\\Gamma_R \\right) $$\nUsing the problem's provided relation $ A(E) = |G^r(E)|^2 (\\Gamma_L(E) + \\Gamma_R(E)) = |G^r(E)|^2 \\Gamma_{tot}(E) $, we substitute this into the first term:\n$$ \\mathcal{J}_L(E) + \\mathcal{J}_R(E) = |G^r(E)|^2 \\Gamma_{tot}(E) \\left( f_L\\Gamma_L + f_R\\Gamma_R \\right) - \\Gamma_{tot}(E) |G^r(E)|^2 \\left( f_L\\Gamma_L + f_R\\Gamma_R \\right) = 0 $$\nSince the sum of the integrands is identically zero for all $ E $, the sum of the integrals must also be zero:\n$$ I_L + I_R = \\frac{e}{h} \\int dE \\left( \\mathcal{J}_L(E) + \\mathcal{J}_R(E) \\right) = \\int 0 \\, dE = 0 $$\nThis completes the analytical proof based on the provided first principles.\n\n### Numerical Implementation\n\nThe numerical task is to calculate $ I_L $ and $ I_R $ by integrating the respective integrands $ \\mathcal{J}_L(E) $ and $ \\mathcal{J}_R(E) $ over a finite energy grid and compute the residual sum $ I_L + I_R $.\nAnalytically, $ \\mathcal{J}_L(E) + \\mathcal{J}_R(E) = 0 $. If we use the same linear quadrature operator $ Q(\\cdot) $ (e.g., trapezoidal rule) for both integrals, the numerical sum will also be zero up to machine precision, because linearity implies $ Q(\\mathcal{J}_L) + Q(\\mathcal{J}_R) = Q(\\mathcal{J}_L + \\mathcal{J}_R) = Q(0) = 0 $.\nHowever, the problem instructs us to use potentially *different* quadrature rules, $ Q_L $ and $ Q_R $, for each integral. In this case, the computed sum is $ Q_L(\\mathcal{J}_L) + Q_R(\\mathcal{J}_R) $. There is no mathematical guarantee that this sum will be zero. The resulting non-zero residual is a numerical artifact stemming from the different discretization errors of the two quadrature rules, not a violation of physical law.\n\nThe implementation proceeds as follows:\n1.  **Constants and Units**: Physical constants ($ e $, $ h $, $ k_B $) are defined in SI units. All input parameters given in electronvolts ($eV$) are converted to Joules ($J$) by multiplying by $ e $.\n2.  **Energy Grid**: A uniform energy grid $ E $ is created from $ E_{\\min} $ to $ E_{\\max} $ with $ N $ points.\n3.  **Functions**: For a given energy grid, we compute arrays for:\n    -   Coupling functions: $ \\Gamma_L(E) $ (Gaussian) and $ \\Gamma_R(E) $ (Lorentzian).\n    -   Fermi-Dirac distributions: $ f_L(E) $ and $ f_R(E) $ with chemical potentials $ \\mu_L = E_F + eV/2 $ and $ \\mu_R = E_F - eV/2 $.\n    -   Total broadening: $ \\Gamma_{tot}(E) = \\Gamma_L(E) + \\Gamma_R(E) $.\n    -   Retarded Green's function for a single level $ \\varepsilon_0 $: $ G^r(E) = [E - \\varepsilon_0 + i\\Gamma_{tot}(E)/2]^{-1} $.\n    -   Spectral function: $ A(E) = |G^r(E)|^2 \\Gamma_{tot}(E) $.\n    -   Lesser Green's function term: $ G^(E)/i = |G^r(E)|^2 (f_L(E)\\Gamma_L(E) + f_R(E)\\Gamma_R(E)) $.\n4.  **Integrands**: The integrands $ \\mathcal{J}_L(E) $ and $ \\mathcal{J}_R(E) $ are constructed as arrays over the energy grid.\n5.  **Quadrature**:\n    -   **Trapezoidal Rule**: Implemented using `numpy.trapz`, which computes the integral of a function given samples on a grid.\n    -   **Midpoint Rule**: Implemented by evaluating the integrand on a new grid of midpoints between the original grid points, then summing these values and multiplying by the energy step $ \\Delta E $.\n6.  **Current Calculation**: The currents $ I_L $ and $ I_R $ are computed by applying the specified quadrature rule to their respective integrands and multiplying by the prefactor $ e/h $. The residual $ I_L + I_R $ is then reported.\n\nThis procedure is repeated for each of the five test cases, which are designed to explore how grid density, integration window, and choice of quadrature rule affect the numerical conservation of current.", "answer": "```python\nimport numpy as np\n\n# Physical constants in SI units\nE_CHARGE = 1.602176634e-19  # Elementary charge in Coulombs\nH_PLANCK = 6.62607015e-34    # Planck's constant in J*s\nKB_BOLTZMANN = 1.380649e-23   # Boltzmann's constant in J/K\n\ndef solve():\n    \"\"\"\n    Main solver function to process test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1: dense grid, consistent quadrature\n        {\n            'params': {'eps0': 0.1, 'ef': 0.0, 'T': 300, 'V': 0.1},\n            'gamma_L': {'G0': 0.2, 'Ec': 0.0, 'sigma': 0.5, 'bg': 0.02},\n            'gamma_R': {'G0': 0.15, 'Ec': 0.05, 'gamma': 0.3, 'bg': 0.02},\n            'grid': {'Emin': -5.0, 'Emax': 5.0, 'N': 20001},\n            'quad': {'L': 'trapezoidal', 'R': 'trapezoidal'}\n        },\n        # Case 2: dense grid, inconsistent quadrature\n        {\n            'params': {'eps0': -0.2, 'ef': 0.0, 'T': 300, 'V': 1.0},\n            'gamma_L': {'G0': 0.3, 'Ec': -0.1, 'sigma': 0.4, 'bg': 0.01},\n            'gamma_R': {'G0': 0.05, 'Ec': 0.2, 'gamma': 0.2, 'bg': 0.01},\n            'grid': {'Emin': -6.0, 'Emax': 6.0, 'N': 20001},\n            'quad': {'L': 'trapezoidal', 'R': 'midpoint'}\n        },\n        # Case 3: coarse grid, inconsistent quadrature\n        {\n            'params': {'eps0': 0.0, 'ef': 0.0, 'T': 300, 'V': 0.2},\n            'gamma_L': {'G0': 0.15, 'Ec': 0.0, 'sigma': 0.2, 'bg': 0.005},\n            'gamma_R': {'G0': 0.15, 'Ec': 0.0, 'gamma': 0.25, 'bg': 0.005},\n            'grid': {'Emin': -2.0, 'Emax': 2.0, 'N': 401},\n            'quad': {'L': 'trapezoidal', 'R': 'midpoint'}\n        },\n        # Case 4: truncated window, inconsistent quadrature\n        {\n            'params': {'eps0': 0.0, 'ef': 0.0, 'T': 50, 'V': 2.0},\n            'gamma_L': {'G0': 0.2, 'Ec': 0.0, 'sigma': 0.3, 'bg': 0.01},\n            'gamma_R': {'G0': 0.2, 'Ec': 0.0, 'gamma': 0.3, 'bg': 0.01},\n            'grid': {'Emin': -1.0, 'Emax': 1.0, 'N': 2001},\n            'quad': {'L': 'trapezoidal', 'R': 'midpoint'}\n        },\n        # Case 5: sharp Fermi edges, very dense grid, consistent quadrature\n        {\n            'params': {'eps0': 0.05, 'ef': 0.0, 'T': 1, 'V': 0.05},\n            'gamma_L': {'G0': 0.1, 'Ec': 0.0, 'sigma': 0.25, 'bg': 0.005},\n            'gamma_R': {'G0': 0.1, 'Ec': 0.0, 'gamma': 0.25, 'bg': 0.005},\n            'grid': {'Emin': -2.0, 'Emax': 2.0, 'N': 40001},\n            'quad': {'L': 'trapezoidal', 'R': 'trapezoidal'}\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        residual = calculate_residual(case)\n        results.append(f\"{residual:.6e}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_residual(case):\n    \"\"\"\n    Calculates the residual current I_L + I_R for a given test case.\n    \"\"\"\n    # Unpack parameters and convert units from eV to Joules\n    p = {k: v * E_CHARGE for k, v in case['params'].items() if k not in ['T']}\n    p['T'] = case['params']['T']\n    \n    gl_p = {k: v * E_CHARGE for k, v in case['gamma_L'].items()}\n    gr_p = {k: v * E_CHARGE for k, v in case['gamma_R'].items()}\n\n    grid_p = {k: v for k, v in case['grid'].items()}\n    grid_p['Emin'] *= E_CHARGE\n    grid_p['Emax'] *= E_CHARGE\n    \n    # Define electrochemical potentials in Joules\n    mu_L = p['ef'] + p['V'] / 2\n    mu_R = p['ef'] - p['V'] / 2\n\n    kBT = KB_BOLTZMANN * p['T']\n\n    # Define energy grid for trapezoidal rule\n    E_grid, dE = np.linspace(grid_p['Emin'], grid_p['Emax'], grid_p['N'], retstep=True)\n    \n    # Define helper functions evaluated on a given energy grid\n    def fermi_dirac(E, mu, kBT):\n        # Add a small epsilon to kBT to avoid division by zero at T=0\n        arg = (E - mu) / (kBT + 1e-40)\n        # Prevent overflow for large positive arguments\n        return np.where(arg > 700, 0.0, 1.0 / (1.0 + np.exp(arg)))\n\n    def gamma_L_func(E, p_gl):\n        return p_gl['G0'] * np.exp(-((E - p_gl['Ec'])**2) / (2 * p_gl['sigma']**2)) + p_gl['bg']\n\n    def gamma_R_func(E, p_gr):\n        return p_gr['G0'] * ((p_gr['gamma']/2)**2) / ((E - p_gr['Ec'])**2 + (p_gr['gamma']/2)**2) + p_gr['bg']\n\n    def get_integrands(E, mu_L, mu_R, kBT, p_dev, p_gl, p_gr):\n        gamma_L = gamma_L_func(E, p_gl)\n        gamma_R = gamma_R_func(E, p_gr)\n        gamma_total = gamma_L + gamma_R\n        \n        G_r = 1.0 / (E - p_dev['eps0'] + 0.5j * gamma_total)\n        G_r_sq_mag = np.abs(G_r)**2\n        \n        A = G_r_sq_mag * gamma_total\n        \n        f_L = fermi_dirac(E, mu_L, kBT)\n        f_R = fermi_dirac(E, mu_R, kBT)\n        \n        # G^(E)/i\n        G_less_over_i = G_r_sq_mag * (f_L * gamma_L + f_R * gamma_R)\n        \n        integrand_L = gamma_L * (A * f_L - G_less_over_i)\n        integrand_R = gamma_R * (A * f_R - G_less_over_i)\n        \n        return integrand_L, integrand_R\n\n    # Calculate current I_L\n    if case['quad']['L'] == 'trapezoidal':\n        integrand_L, _ = get_integrands(E_grid, mu_L, mu_R, kBT, p, gl_p, gr_p)\n        integral_L = np.trapz(integrand_L, E_grid)\n    elif case['quad']['L'] == 'midpoint':\n        E_mid = 0.5 * (E_grid[:-1] + E_grid[1:])\n        integrand_L, _ = get_integrands(E_mid, mu_L, mu_R, kBT, p, gl_p, gr_p)\n        integral_L = np.sum(integrand_L) * dE\n    \n    I_L = (E_CHARGE / H_PLANCK) * integral_L\n\n    # Calculate current I_R\n    if case['quad']['R'] == 'trapezoidal':\n        _, integrand_R = get_integrands(E_grid, mu_L, mu_R, kBT, p, gl_p, gr_p)\n        integral_R = np.trapz(integrand_R, E_grid)\n    elif case['quad']['R'] == 'midpoint':\n        E_mid = 0.5 * (E_grid[:-1] + E_grid[1:])\n        _, integrand_R = get_integrands(E_mid, mu_L, mu_R, kBT, p, gl_p, gr_p)\n        integral_R = np.sum(integrand_R) * dE\n\n    I_R = (E_CHARGE / H_PLANCK) * integral_R\n    \n    return I_L + I_R\n\nsolve()\n```", "id": "2790687"}]}