{"hands_on_practices": [{"introduction": "Before diving into the complex machinery of modern Configuration Interaction methods, it is crucial to understand *why* they are necessary. Simpler, truncated methods like Configuration Interaction with Singles and Doubles ($CISD$) suffer from fundamental deficiencies, one of the most important being the lack of size consistency. This exercise [@problem_id:2803703] provides a hands-on derivation of this failure using a simple but powerful model, illustrating how truncated $CI$ methods can incorrectly predict an interaction energy between two non-interacting systems and highlighting the importance of methods like Full Configuration Interaction ($FCI$) that correctly describe system separability.", "problem": "Consider two identical, noninteracting, closed-shell fragments labeled $A$ and $B$. Each fragment is modeled in a minimal Hilbert space spanned by a Hartree–Fock (HF) reference determinant $\\lvert 0_{F} \\rangle$ and one doubly excited determinant $\\lvert 2_{F} \\rangle$ ($F \\in \\{A,B\\}$). Assume Brillouin’s theorem so that single excitations do not couple to the HF reference for each fragment. In this minimal model, the fragment Hamiltonian in the ordered basis $\\{\\lvert 0_{F} \\rangle,\\lvert 2_{F} \\rangle\\}$ has diagonal elements $E_{0}$ and $E_{2}$ and a nonzero off-diagonal coupling $K$, with an energy gap $\\Delta \\equiv E_{2}-E_{0} > 0$. Work in atomic units, and without loss of generality shift the zero of energy so that $E_{0}=0$, hence the fragment Hamiltonian is represented by the matrix \n$$\n\\begin{pmatrix} 0 & K \\\\ K & \\Delta \\end{pmatrix}\n$$\nThe total Hamiltonian for the dimer is additive, $H=H_{A}\\otimes I_{B}+I_{A}\\otimes H_{B}$, and there is no interaction between fragments.\n\nConfiguration Interaction with Singles and Doubles (CISD) on the dimer is defined here as the diagonalization of $H$ in the subspace spanned by the HF product reference $\\lvert 0_{A}0_{B} \\rangle$ and all determinants with up to two electrons excited relative to that reference. In this model, that CISD subspace is $\\{\\lvert 0_{A}0_{B} \\rangle,\\lvert 2_{A}0_{B} \\rangle,\\lvert 0_{A}2_{B} \\rangle\\}$ but excludes $\\lvert 2_{A}2_{B} \\rangle$. Full Configuration Interaction (FCI) includes all four product determinants. Full Configuration Interaction Quantum Monte Carlo (FCIQMC) is a projector Quantum Monte Carlo algorithm that in the infinite-sampling limit yields the exact FCI ground-state energy within a chosen one-particle basis.\n\nStarting from the above definitions and standard many-electron quantum mechanics, do the following:\n\n1. For a single fragment, analytically diagonalize the $2 \\times 2$ Hamiltonian to obtain its exact ground-state energy $E_{\\mathrm{mono}}(\\Delta,K)$.\n2. For the dimer, construct and diagonalize the $3 \\times 3$ CISD Hamiltonian in the basis $\\{\\lvert 0_{A}0_{B} \\rangle,\\lvert 2_{A}0_{B} \\rangle,\\lvert 0_{A}2_{B} \\rangle\\}$ to obtain the CISD ground-state energy $E_{\\mathrm{dimer}}^{\\mathrm{CISD}}(\\Delta,K)$.\n3. Using the definition of size consistency, form the size-consistency error $\\delta(\\Delta,K) \\equiv E_{\\mathrm{dimer}}^{\\mathrm{CISD}}(\\Delta,K) - 2E_{\\mathrm{mono}}(\\Delta,K)$.\n4. Argue, without further numerical diagonalization, what the exact FCI dimer ground-state energy must be in this noninteracting case, and explain briefly why an FCIQMC calculation would avoid the pathology found in step 3 in the limit of exact sampling.\n\nProvide your final answer as a single closed-form analytical expression for $\\delta(\\Delta,K)$ in terms of $\\Delta$ and $K$ (atomic units). Do not approximate or expand; give the exact expression.", "solution": "The posed problem is subject to validation. All givens are extracted verbatim.\n- Fragments: Two identical, noninteracting, closed-shell fragments $A$ and $B$.\n- Fragment Hilbert space: $\\{\\lvert 0_{F} \\rangle, \\lvert 2_{F} \\rangle\\}$ for $F \\in \\{A,B\\}$.\n- Fragment Hamiltonian ($E_0=0$): $H_F = \\begin{pmatrix} 0 & K \\\\ K & \\Delta \\end{pmatrix}$, with $\\Delta > 0$.\n- Total Hamiltonian: $H=H_{A}\\otimes I_{B}+I_{A}\\otimes H_{B}$.\n- CISD subspace for dimer: $\\{\\lvert 0_{A}0_{B} \\rangle,\\lvert 2_{A}0_{B} \\rangle,\\lvert 0_{A}2_{B} \\rangle\\}$.\n- FCI subspace for dimer: $\\{\\lvert 0_{A}0_{B} \\rangle,\\lvert 2_{A}0_{B} \\rangle,\\lvert 0_{A}2_{B} \\rangle, \\lvert 2_{A}2_{B} \\rangle\\}$.\n- FCIQMC properties: Yields exact FCI ground-state energy in the infinite-sampling limit.\n\nThe problem is scientifically grounded, well-posed, and objective. It is a standard pedagogical problem in theoretical chemistry used to illustrate the size-consistency failure of truncated Configuration Interaction (CI) methods. The model, while simplified, is built upon the rigorous mathematical framework of many-body quantum mechanics, including tensor product spaces and matrix diagonalization. It contains no scientific flaws, ambiguities, or contradictions. The problem is valid. The solution proceeds.\n\n1. Ground-state energy of a single fragment.\nThe Hamiltonian for a single fragment $F$ is a $2 \\times 2$ matrix:\n$$ H_F = \\begin{pmatrix} 0 & K \\\\ K & \\Delta \\end{pmatrix} $$\nThe energy eigenvalues $E$ are the roots of the characteristic equation $\\det(H_F - E I) = 0$.\n$$ \\det \\begin{pmatrix} -E & K \\\\ K & \\Delta - E \\end{pmatrix} = 0 $$\n$$ (-E)(\\Delta - E) - K^2 = 0 $$\n$$ E^2 - \\Delta E - K^2 = 0 $$\nThis quadratic equation is solved for $E$:\n$$ E = \\frac{\\Delta \\pm \\sqrt{(-\\Delta)^2 - 4(1)(-K^2)}}{2} = \\frac{\\Delta \\pm \\sqrt{\\Delta^2 + 4K^2}}{2} $$\nThe ground-state energy is the lower of the two eigenvalues. Given $\\Delta > 0$ and $K$ is a real coupling, $\\sqrt{\\Delta^2 + 4K^2} > \\Delta$. Thus, the ground-state energy is:\n$$ E_{\\mathrm{mono}}(\\Delta,K) = \\frac{\\Delta - \\sqrt{\\Delta^2 + 4K^2}}{2} $$\n\n2. CISD ground-state energy of the dimer.\nThe total Hamiltonian is $H = H_A \\otimes I_B + I_A \\otimes H_B$. The CISD Hamiltonian matrix is constructed in the specified truncated basis $\\{\\lvert 0_A 0_B \\rangle, \\lvert 2_A 0_B \\rangle, \\lvert 0_A 2_B \\rangle \\}$. The matrix elements $H_{ij} = \\langle \\phi_i | H | \\phi_j \\rangle$ are computed as follows:\n$H_{11} = \\langle 0_A 0_B | H | 0_A 0_B \\rangle = \\langle 0_A|H_A|0_A\\rangle + \\langle 0_B|H_B|0_B\\rangle = 0 + 0 = 0$.\n$H_{22} = \\langle 2_A 0_B | H | 2_A 0_B \\rangle = \\langle 2_A|H_A|2_A\\rangle + \\langle 0_B|H_B|0_B\\rangle = \\Delta + 0 = \\Delta$.\n$H_{33} = \\langle 0_A 2_B | H | 0_A 2_B \\rangle = \\langle 0_A|H_A|0_A\\rangle + \\langle 2_B|H_B|2_B\\rangle = 0 + \\Delta = \\Delta$.\n$H_{12} = \\langle 0_A 0_B | H | 2_A 0_B \\rangle = \\langle 0_A|H_A|2_A\\rangle\\langle 0_B|0_B\\rangle = K \\cdot 1 = K$.\n$H_{13} = \\langle 0_A 0_B | H | 0_A 2_B \\rangle = \\langle 0_A|0_A\\rangle\\langle 0_B|H_B|2_B\\rangle = 1 \\cdot K = K$.\n$H_{23} = \\langle 2_A 0_B | H | 0_A 2_B \\rangle = \\langle 2_A|H_A|0_A\\rangle\\langle 0_B|2_B\\rangle + \\langle 2_A|0_A\\rangle\\langle 0_B|H_B|2_B\\rangle = K \\cdot 0 + 0 \\cdot K = 0$.\nBy hermiticity, $H_{21}=K$, $H_{31}=K$, and $H_{32}=0$. The CISD Hamiltonian matrix is:\n$$ H^{\\mathrm{CISD}} = \\begin{pmatrix} 0 & K & K \\\\ K & \\Delta & 0 \\\\ K & 0 & \\Delta \\end{pmatrix} $$\nTo find the eigenvalues, solve $\\det(H^{\\mathrm{CISD}} - E I) = 0$:\n$$ \\det \\begin{pmatrix} -E & K & K \\\\ K & \\Delta - E & 0 \\\\ K & 0 & \\Delta - E \\end{pmatrix} = 0 $$\n$$ -E(\\Delta-E)^2 - K(K(\\Delta-E)) + K(-K(\\Delta-E)) = 0 $$\n$$ -E(\\Delta-E)^2 - 2K^2(\\Delta-E) = 0 $$\n$$ -(\\Delta-E)[E(\\Delta-E) + 2K^2] = 0 $$\nThis yields one root $E = \\Delta$, and the roots of the quadratic equation $E(\\Delta-E) + 2K^2 = 0$, which is $E^2 - \\Delta E - 2K^2 = 0$.\n$$ E = \\frac{\\Delta \\pm \\sqrt{(-\\Delta)^2 - 4(1)(-2K^2)}}{2} = \\frac{\\Delta \\pm \\sqrt{\\Delta^2 + 8K^2}}{2} $$\nThe three eigenvalues are $\\Delta$, $\\frac{\\Delta + \\sqrt{\\Delta^2 + 8K^2}}{2}$, and $\\frac{\\Delta - \\sqrt{\\Delta^2 + 8K^2}}{2}$. The ground-state energy is the lowest value:\n$$ E_{\\mathrm{dimer}}^{\\mathrm{CISD}}(\\Delta,K) = \\frac{\\Delta - \\sqrt{\\Delta^2 + 8K^2}}{2} $$\n\n3. Size-consistency error.\nThe error is defined as $\\delta(\\Delta,K) \\equiv E_{\\mathrm{dimer}}^{\\mathrm{CISD}} - 2E_{\\mathrm{mono}}$.\n$$ \\delta(\\Delta,K) = \\left( \\frac{\\Delta - \\sqrt{\\Delta^2 + 8K^2}}{2} \\right) - 2 \\left( \\frac{\\Delta - \\sqrt{\\Delta^2 + 4K^2}}{2} \\right) $$\n$$ \\delta(\\Delta,K) = \\frac{\\Delta - \\sqrt{\\Delta^2 + 8K^2}}{2} - (\\Delta - \\sqrt{\\Delta^2 + 4K^2}) $$\n$$ \\delta(\\Delta,K) = \\frac{\\Delta - \\sqrt{\\Delta^2 + 8K^2} - 2\\Delta + 2\\sqrt{\\Delta^2 + 4K^2}}{2} $$\n$$ \\delta(\\Delta,K) = \\frac{2\\sqrt{\\Delta^2 + 4K^2} - \\sqrt{\\Delta^2 + 8K^2} - \\Delta}{2} $$\nThis non-zero error for $K \\neq 0$ demonstrates the size-inconsistency of truncated CISD.\n\n4. FCI energy and FCIQMC.\nFor a system of two non-interacting fragments $A$ and $B$, the total Hamiltonian is $H = H_A + H_B$ (shorthand for $H_A \\otimes I_B + I_A \\otimes H_B$). The eigenvalues of $H$ are all possible sums of the eigenvalues of $H_A$ and $H_B$. The exact ground-state energy of the dimer is therefore the sum of the ground-state energies of the two fragments. This is the definition of size consistency, which FCI correctly reproduces.\n$$ E_{\\mathrm{dimer}}^{\\mathrm{FCI}} = E_{\\mathrm{mono}} + E_{\\mathrm{mono}} = 2E_{\\mathrm{mono}} = \\Delta - \\sqrt{\\Delta^2 + 4K^2} $$\nThe pathology of CISD arises from the truncation of the many-electron basis. The true ground state of the non-interacting dimer is the product of the fragment ground states. Each fragment ground state is a linear combination of $\\lvert 0_F \\rangle$ and $\\lvert 2_F \\rangle$. Their product thus contains a component of the form $\\lvert 2_A 2_B \\rangle$, which is a quadruple excitation with respect to the reference $\\lvert 0_A 0_B \\rangle$. The CISD method, by definition, excludes determinants with more than two excitations and thus cannot represent the true ground-state wavefunction. FCIQMC is a stochastic projector method that samples the full CI space. In the limit of exact sampling, it converges to the exact FCI ground-state energy. Therefore, FCIQMC would yield $E_{\\mathrm{dimer}}^{\\mathrm{FCI}} = 2E_{\\mathrm{mono}}$, and thus exhibits no size-consistency error. It avoids the pathology of truncated CISD by operating in the complete, untruncated (within the one-particle basis) many-electron space.", "answer": "$$\\boxed{\\frac{2\\sqrt{\\Delta^2 + 4K^2} - \\sqrt{\\Delta^2 + 8K^2} - \\Delta}{2}}$$", "id": "2803703"}, {"introduction": "The Full Configuration Interaction ($FCI$) space grows factorially with system size, making its exploration a monumental computational challenge. Efficiently representing and manipulating Slater determinants is therefore not a mere technicality but a critical component of any selected $CI$ ($SCI$) or Full $CI$ Quantum Monte Carlo ($FCIQMC$) implementation. This practice [@problem_id:2803686] delves into the bitstring representation of determinants and challenges you to derive algorithms for computing excitation levels and phase factors using fast, low-level bitwise operations, connecting the abstract algebra of quantum mechanics to the concrete logic of high-performance code.", "problem": "In Selected Configuration Interaction (SCI) and Full Configuration Interaction Quantum Monte Carlo (FCIQMC), Slater determinants are represented by occupation bitstrings. Consider a representation in which each spin sector uses two $64$-bit unsigned integers: a lower word encodes spin-orbitals with indices $0$ through $63$, and an upper word encodes indices $64$ through $127$. The bit at position $p$ in the appropriate word is $1$ if and only if spin-orbital $p$ is occupied.\n\nLet $\\lvert D \\rangle$ and $\\lvert D' \\rangle$ be two determinants in this representation, specified by the following hexadecimal words:\n- For the $\\alpha$-spin sector:\n  - $\\lvert D \\rangle$: lower word $= 0x100000000010002A$, upper word $= 0x0000000000000000$.\n  - $\\lvert D' \\rangle$: lower word $= 0x1000000002000122$, upper word $= 0x0000000000000000$.\n- For the $\\beta$-spin sector:\n  - $\\lvert D \\rangle$: lower word $= 0x0000000000000009$, upper word $= 0x0000000000000001$.\n  - $\\lvert D' \\rangle$: lower word $= 0x0000000000000009$, upper word $= 0x0000000000000001$.\n\nAssume standard spin-orbital ordering by increasing index within each spin sector, and that Slater determinants are built by ordered application of creation operators in increasing spin-orbital index. Assume the non-relativistic electronic Hamiltonian, so that non-zero off-diagonal matrix elements connect determinants differing by at most double excitations within a spin sector.\n\nTasks:\n1. Starting only from the definitions of Slater determinants and the notion that the excitation degree is the minimal number $k$ of electron excitations needed to transform $\\lvert D \\rangle$ into $\\lvert D' \\rangle$, derive an algorithm, expressed in terms of bitwise operations on the two-word encoding, to compute the excitation degree $\\nu(\\lvert D \\rangle,\\lvert D' \\rangle)$ efficiently. Your derivation must begin from these definitions and justify why the algorithm returns $\\nu$ without appealing to any unproven shortcut formulas.\n\n2. Using the antisymmetry of fermionic wavefunctions and the operator algebra of second quantization as your only starting point, derive an algorithm to compute the fermionic phase factor $\\phi(\\lvert D \\rangle \\to \\lvert D' \\rangle) \\in \\{+1,-1\\}$ for a same-spin double excitation. Adopt the convention that when the $\\alpha$-spin occupations of $\\lvert D \\rangle$ and $\\lvert D' \\rangle$ differ by removal at occupied indices $\\{i_{1},i_{2}\\}$ and addition at unoccupied indices $\\{a_{1},a_{2}\\}$, the mapping pairs the indices sorted increasingly, i.e., $i_{1} \\to a_{1}$ and $i_{2} \\to a_{2}$. Express your algorithm in terms of parity (modulo-$2$) of counts of occupied orbitals between indices, and show how to implement these counts using bit masks and population counts across the two $64$-bit words.\n\n3. Apply your derived algorithms to the given $\\lvert D \\rangle$ and $\\lvert D' \\rangle$ and compute $s = \\phi(\\lvert D \\rangle \\to \\lvert D' \\rangle) \\times \\nu(\\lvert D \\rangle,\\lvert D' \\rangle)$. Report $s$ as a single integer. No rounding is required and no units are to be reported.", "solution": "The problem is well-posed, scientifically grounded, and contains sufficient information for a unique solution. I will proceed with the derivation and calculation.\n\nThe problem is divided into three parts. First, the derivation of an algorithm to compute the excitation degree $\\nu$. Second, the derivation of an algorithm for the fermionic phase factor $\\phi$. Third, the application of these algorithms to the provided data.\n\n1. Derivation of the Excitation Degree Algorithm\n\nThe excitation degree $\\nu(\\lvert D \\rangle, \\lvert D' \\rangle)$ is defined as the minimum number of single-particle excitations required to transform determinant $\\lvert D \\rangle$ into determinant $\\lvert D' \\rangle$. A single-particle excitation moves an electron from an occupied spin-orbital $i$ to an unoccupied spin-orbital $a$. For the transformation to be possible, the number of electrons must be conserved between $\\lvert D \\rangle$ and $\\lvert D' \\rangle$.\n\nLet $O$ and $O'$ be the sets of occupied spin-orbital indices for determinants $\\lvert D \\rangle$ and $\\lvert D' \\rangle$, respectively. To transform $\\lvert D \\rangle$ into $\\lvert D' \\rangle$, we must:\n- Annihilate electrons from spin-orbitals that are occupied in $\\lvert D \\rangle$ but not in $\\lvert D' \\rangle$. The set of such orbitals is $O \\setminus O'$.\n- Create electrons in spin-orbitals that are occupied in $\\lvert D' \\rangle$ but not in $\\lvert D \\rangle$. The set of such orbitals is $O' \\setminus O$.\n\nThe number of annihilations required is $N_{annihilate} = |O \\setminus O'|$. The number of creations required is $N_{create} = |O' \\setminus O|$. Since each excitation consists of one annihilation and one creation, and the total number of electrons is conserved ($|O|=|O'|$), we must have $N_{annihilate} = N_{create}$. The excitation degree $\\nu$ is this number.\n$$ \\nu = |O \\setminus O'| = |O' \\setminus O| $$\nThe set of orbitals where the occupation differs between $\\lvert D \\rangle$ and $\\lvert D' \\rangle$ is the symmetric difference of the sets $O$ and $O'$, denoted $O \\Delta O'$.\n$$ O \\Delta O' = (O \\setminus O') \\cup (O' \\setminus O) $$\nThe size of the symmetric difference is $|O \\Delta O'| = |O \\setminus O'| + |O' \\setminus O| = \\nu + \\nu = 2\\nu$.\nTherefore, the excitation degree can be computed from the size of the symmetric difference:\n$$ \\nu = \\frac{1}{2} |O \\Delta O'| $$\nIn the bitstring representation, each determinant $\\lvert D \\rangle$ is represented by a series of words, where bit $p$ is $1$ if spin-orbital $p$ is in $O$, and $0$ otherwise. The symmetric difference of two sets of indices corresponds to the bitwise XOR ($\\oplus$) operation on their bitstring representations. Let $w_D$ and $w_{D'}$ be the bitstring words for a given spin sector. The bitstring representing the set $O \\Delta O'$ is $w_D \\oplus w_{D'}$.\n\nThe size of the set $O \\Delta O'$, $|O \\Delta O'|$, is the number of set bits in the resulting XOR bitstring. This is computed by the population count operation, $\\text{popcount}(\\cdot)$.\nThe algorithm for the excitation degree $\\nu_s$ within a single spin sector $s$ is therefore:\n$$ \\nu_s = \\frac{1}{2} \\text{popcount}(w_{D,s} \\oplus w_{D',s}) $$\nIn our case, each spin sector is represented by two $64$-bit words, a lower word ($L$) for indices $0-63$ and an upper word ($U$) for indices $64-127$. The algorithm for a spin sector $s \\in \\{\\alpha, \\beta\\}$ is:\n$$ \\nu_s = \\frac{1}{2} \\left[ \\text{popcount}(w_{D,s,L} \\oplus w_{D',s,L}) + \\text{popcount}(w_{D,s,U} \\oplus w_{D',s,U}) \\right] $$\nThe total excitation degree is the sum over spin sectors: $\\nu = \\nu_\\alpha + \\nu_\\beta$.\n\n2. Derivation of the Phase Factor Algorithm\n\nWe are asked to find the phase factor $\\phi$ associated with a same-spin double excitation from orbitals $\\{i_1, i_2\\}$ to $\\{a_1, a_2\\}$, with $i_1 < i_2$ and $a_1 < a_2$. The problem specifies a convention where the transformation is a sequence of two single excitations: $i_1 \\to a_1$ followed by $i_2 \\to a_2$. We must derive the phase of this sequential process from first principles.\n\nA Slater determinant with occupied spin-orbitals $p_1 < p_2 < \\dots < p_N$ is defined as $\\lvert D \\rangle = c_{p_1}^\\dagger c_{p_2}^\\dagger \\dots c_{p_N}^\\dagger \\lvert \\text{vac} \\rangle$. The fermionic creation ($c_p^\\dagger$) and annihilation ($c_p$) operators obey the anti-commutation relations: $\\{c_p, c_q\\} = 0$, $\\{c_p^\\dagger, c_q^\\dagger\\} = 0$, and $\\{c_p, c_q^\\dagger\\} = \\delta_{pq}$.\n\nLet's find the phase of a single excitation $i \\to a$. This corresponds to the action of the operator $c_a^\\dagger c_i$ on $\\lvert D \\rangle$.\nFirst, apply the annihilation operator $c_i$. Let $i$ be the $m$-th orbital in the sorted list of occupied orbitals $\\{p_1, \\dots, p_N\\}$. To move $c_i = c_{p_m}$ from the left of the product $c_{p_1}^\\dagger \\dots c_{p_N}^\\dagger$ to the position of $c_{p_m}^\\dagger$, it must anti-commute with the $m-1$ operators $c_{p_1}^\\dagger, \\dots, c_{p_{m-1}}^\\dagger$. This introduces a sign of $(-1)^{m-1}$.\n$$ c_i \\lvert D \\rangle = (-1)^{m-1} c_{p_1}^\\dagger \\dots c_{p_{m-1}}^\\dagger (c_{p_m} c_{p_m}^\\dagger) c_{p_{m+1}}^\\dagger \\dots c_{p_N}^\\dagger \\lvert \\text{vac} \\rangle $$\nSince $c_{p_m}$ acts on a state where orbital $p_m$ is occupied, the term $c_{p_m}c_{p_m}^\\dagger$ becomes $1-c_{p_m}^\\dagger c_{p_m}$, and applying this to the rest of the state (where $p_m$ is not occupied) results in $1$. The resulting state is $\\lvert D_{-i} \\rangle$, which is the determinant $\\lvert D \\rangle$ with orbital $i$ removed.\nThe number $m-1$ is the count of occupied orbitals in $\\lvert D \\rangle$ with an index less than $i$. Let's denote this $N_D(<i)$.\nSo, $c_i \\lvert D \\rangle = (-1)^{N_D(<i)} \\lvert D_{-i} \\rangle$.\n\nNext, apply the creation operator $c_a^\\dagger$ to $\\lvert D_{-i} \\rangle$. To obtain the canonically ordered determinant $\\lvert D_{-i+a} \\rangle$, we must insert $c_a^\\dagger$ into its correct sorted position in the product of creation operators for $\\lvert D_{-i} \\rangle$. This requires anti-commuting $c_a^\\dagger$ with all creation operators $c_p^\\dagger$ where $p < a$ and $p$ is occupied in $\\lvert D_{-i} \\rangle$. The phase is $(-1)^{N_{D-i}(<a)}$.\n$$ c_a^\\dagger \\lvert D_{-i} \\rangle = (-1)^{N_{D-i}(<a)} \\lvert D_{-i+a} \\rangle $$\nThe total transformation is $c_a^\\dagger c_i \\lvert D \\rangle = (-1)^{N_D(<i) + N_{D-i}(<a)} \\lvert D_{-i+a} \\rangle$. The exponent is the phase.\n$N_{D-i}(<a) = N_D(<a) - \\mathbb{I}(i < a)$, where $\\mathbb{I}$ is the indicator function. The phase exponent is $P(i,a) = N_D(<i) + N_D(<a) - \\mathbb{I}(i < a)$. This is equivalent to the parity of the number of occupied orbitals strictly between $i$ and $a$. Let this be $\\pi_D(i,a)$. The phase for $i \\to a$ is $(-1)^{\\pi_D(i,a)}$.\n\nFollowing the problem's convention for the double excitation:\nStep 1: Apply excitation $i_1 \\to a_1$ on $\\lvert D \\rangle$.\nThe state becomes $\\lvert D_{int} \\rangle$, and a phase $\\phi_1 = (-1)^{\\pi_D(i_1, a_1)}$ is accumulated. The occupied set of $\\lvert D_{int} \\rangle$ is $O_{int} = (O_D \\setminus \\{i_1\\}) \\cup \\{a_1\\}$.\n\nStep 2: Apply excitation $i_2 \\to a_2$ on $\\lvert D_{int} \\rangle$.\nThe final state is $\\lvert D' \\rangle$, and a phase $\\phi_2 = (-1)^{\\pi_{D_{int}}(i_2, a_2)}$ is accumulated.\nThe total phase is $\\phi = \\phi_1 \\phi_2 = (-1)^{\\pi_D(i_1, a_1) + \\pi_{D_{int}}(i_2, a_2)}$.\n\nThe term $\\pi_{D_{int}}(i_2, a_2)$ is the parity of occupied orbitals in $D_{int}$ between $i_2$ and $a_2$. This can be related to the occupations in $D$:\n$$ \\pi_{D_{int}}(i_2, a_2) = \\pi_D(i_2, a_2) - I(i_2, a_2, i_1) + I(i_2, a_2, a_1) $$\nwhere $I(x,y,z)$ is $1$ if $z$ lies strictly between $x$ and $y$, and $0$ otherwise.\nThe final exponent for the phase factor $\\phi = (-1)^P$ is:\n$$ P = \\left( \\pi_D(i_1, a_1) + \\pi_D(i_2, a_2) - I(i_2, a_2, i_1) + I(i_2, a_2, a_1) \\right) \\pmod 2 $$\nTo compute $\\pi_D(p,q)$, the parity of occupied orbitals between $p$ and $q$, we use bitwise operations. Let $p_{min} = \\min(p,q)$ and $p_{max} = \\max(p,q)$. We need to count the number of set bits in the bitstring representation of $\\lvert D \\rangle$ for indices in the range $[p_{min}+1, p_{max}-1]$. This is done by creating a bitmask for this range, performing a bitwise AND with the determinant's word(s), and then taking the population count of the result. For a range $[p_1, p_2]$ within a $64$-bit word, the mask is `((1ULL << (p2-p1+1)) - 1) << p1`. This method can be extended to handle ranges crossing the two-word boundary.\n\n3. Application and Calculation\n\nThe given determinants are specified by hexadecimal words.\nFor $\\lvert D \\rangle$:\n$w_{D,\\alpha,L} = 0x100000000010002A$, $w_{D,\\alpha,U} = 0x0$.\n$w_{D,\\beta,L} = 0x9$, $w_{D,\\beta,U} = 0x1$.\n\nFor $\\lvert D' \\rangle$:\n$w_{D',\\alpha,L} = 0x1000000002000122$, $w_{D',\\alpha,U} = 0x0$.\n$w_{D',\\beta,L} = 0x9$, $w_{D',\\beta,U} = 0x1$.\n\nFirst, compute the excitation degree $\\nu$.\nThe $\\beta$-spin words are identical for $\\lvert D \\rangle$ and $\\lvert D' \\rangle$, so $\\nu_\\beta = 0$.\nFor the $\\alpha$-spin sector, we compute the XOR of the lower words (the upper words are both $0$):\n$$ w_{D,\\alpha,L} \\oplus w_{D',\\alpha,L} = 0x100000000010002A \\oplus 0x1000000002000122 = 0x0000000002100108 $$\nWe find the population count of this result:\n$$ \\text{popcount}(0x02100108) = \\text{popcount}(2) + \\text{popcount}(1) + \\text{popcount}(1) + \\text{popcount}(8) = 1+1+1+1 = 4 $$\nThe excitation degree is $\\nu = \\nu_\\alpha = \\frac{1}{2} \\times 4 = 2$.\nThis confirms a double excitation within the $\\alpha$-spin sector.\n\nNext, compute the phase factor $\\phi$. We must identify the annihilated orbitals $\\{i_1, i_2\\}$ and created orbitals $\\{a_1, a_2\\}$. These correspond to the $4$ bits that are flipped, which are the set bits in the XOR result $0x02100108$.\nThe set bits are at indices corresponding to powers of $2$:\n$0x0...8 = 2^3 \\implies$ bit $3$.\n$0x0...100 = 16^2 = 2^8 \\implies$ bit $8$.\n$0x...100000 = 16^5 = 2^{20} \\implies$ bit $20$.\n$0x...2000000 = 2 \\times 16^6 = 2 \\times 2^{24} = 2^{25} \\implies$ bit $25$.\nThe set of flipped orbital indices is $\\{3, 8, 20, 25\\}$.\n\nTo determine which are annihilated and which are created, we check their occupation in $\\lvert D \\rangle$. The occupied $\\alpha$ spin-orbitals in $\\lvert D \\rangle$, from $w_{D,\\alpha,L} = 0x100000000010002A$, are $O_\\alpha(D) = \\{1, 3, 5, 20, 44, 60\\}$.\n- Annihilated orbitals (in $O_\\alpha(D)$ and in $\\{3, 8, 20, 25\\}$): $\\{3, 20\\}$.\n- Created orbitals (not in $O_\\alpha(D)$ and in $\\{3, 8, 20, 25\\}$): $\\{8, 25\\}$.\nSorted, these are $i_1=3, i_2=20$ and $a_1=8, a_2=25$.\nThe specified mapping is $i_1 \\to a_1$ and $i_2 \\to a_2$, so we have the transformations $3 \\to 8$ and $20 \\to 25$.\n\nNow we compute the phase exponent $P$ modulo $2$:\n$P = \\pi_D(3, 8) + \\pi_D(20, 25) - I(20, 25, 3) + I(20, 25, 8)$.\n- $\\pi_D(3, 8)$: Parity of occupied orbitals in $O_\\alpha(D) = \\{1, 3, 5, 20, 44, 60\\}$ between indices $3$ and $8$. The interval $(3,8)$ contains only one occupied orbital, $\\{5\\}$. So $\\pi_D(3,8) = 1$.\n- $\\pi_D(20, 25)$: Parity of occupied orbitals in $O_\\alpha(D)$ between indices $20$ and $25$. The interval $(20,25)$ contains no occupied orbitals. So $\\pi_D(20,25) = 0$.\n- $I(20, 25, 3)$: Is $3$ between $20$ and $25$? No. $I=0$.\n- $I(20, 25, 8)$: Is $8$ between $20$ and $25$? No. $I=0$.\nThe total exponent is $P = (1 + 0 - 0 + 0) \\pmod 2 = 1$.\nThe phase factor is $\\phi = (-1)^P = (-1)^1 = -1$.\n\nFinally, we compute the requested value $s = \\phi \\times \\nu$.\n$s = (-1) \\times 2 = -2$.", "answer": "$$\\boxed{-2}$$", "id": "2803686"}, {"introduction": "At the heart of the Full $CI$ Quantum Monte Carlo ($FCIQMC$) method is a simple set of stochastic rules that govern a population of 'walkers' exploring the vast determinant space. By simulating imaginary-time evolution, this population dynamically samples the ground-state wavefunction. To make this abstract process concrete, this exercise [@problem_id:2803677] provides a micro-simulation of a single $FCIQMC$ time step, allowing you to manually execute the core processes of spawning, death, and annihilation and see firsthand how they shape the walker distribution and the energy estimate.", "problem": "In a minimal Selected Configuration Interaction (Selected CI) subspace consisting of two Slater determinants $\\lvert D_{0} \\rangle$ and $\\lvert D_{1} \\rangle$, consider the imaginary-time stochastic projector dynamics of Full Configuration Interaction Quantum Monte Carlo (Full CI Quantum Monte Carlo, FCIQMC). The effective Hamiltonian matrix in this subspace has nonzero elements $H_{00}=-1.0$, $H_{11}=+0.5$, and $H_{01}=H_{10}=+0.2$, all in Hartree. The discrete time step is $\\delta \\tau = 0.1$ and the fixed population-control shift is $S=-0.8$ (both in Hartree units). \n\nAt the start of the step, the walker distribution is:\n- On $\\lvert D_{0} \\rangle$: $3$ positive and $1$ negative walkers.\n- On $\\lvert D_{1} \\rangle$: $1$ negative walker.\n\nAdopt the standard FCIQMC update for one time step with the following rules and order:\n- Spawning: For each walker on determinant $i$, select a connected determinant $j$ with probability $p_{\\mathrm{gen}}(j \\mid i)=1$ in this two-determinant model. Propose a spawn to $j$ with probability $p_{\\mathrm{s}}(j \\leftarrow i)=\\delta \\tau \\left| H_{ji} \\right|$. If a spawn occurs, the child’s sign is $s_{\\mathrm{child}}=-\\mathrm{sgn}(H_{ji})\\, s_{\\mathrm{parent}}$.\n- Death/Cloning: For each parent walker on determinant $i$, apply a diagonal event with probability $p_{\\mathrm{d}}(i)=\\delta \\tau \\left( H_{ii}-S \\right)$. If $p_{\\mathrm{d}}(i) \\ge 0$, the walker dies with probability $p_{\\mathrm{d}}(i)$. If $p_{\\mathrm{d}}(i)<0$, a clone is created with probability $-p_{\\mathrm{d}}(i)$ (same sign and determinant).\n- Annihilation: After completing spawning and death/cloning for the parents, sum all contributions (original survivors, spawned children, and clones) on each determinant and annihilate by cancelling opposite-signed walkers locally.\n\nUse the following independent uniform random numbers in $\\left[0,1\\right)$ to decide each Bernoulli event:\n- Spawning attempts from $\\lvert D_{0} \\rangle$ to $\\lvert D_{1} \\rangle$ for the four initial walkers in the sequence: positive-$a$ uses $0.4$, positive-$b$ uses $0.015$, positive-$c$ uses $0.8$, negative-$a$ uses $0.010$.\n- Spawning attempt from $\\lvert D_{1} \\rangle$ to $\\lvert D_{0} \\rangle$ for its initial walker: $0.70$.\n- Death/cloning on $\\lvert D_{0} \\rangle$ for the same four initial walkers in the same sequence: $0.010$, $0.50$, $0.50$, $0.30$.\n- Death on $\\lvert D_{1} \\rangle$ for its initial walker: $0.50$.\n\nTake the projected energy estimator with reference $\\lvert D_{0} \\rangle$ to be\n$$\nE_{\\mathrm{proj}} \\equiv \\frac{\\sum_{j \\in \\{0,1\\}} H_{0j} \\, N_{j}}{N_{0}},\n$$\nwhere $N_{j}$ is the signed walker count on $\\lvert D_{j} \\rangle$ after annihilation. Compute the change in the projected energy estimator over this one step,\n$$\n\\Delta E_{\\mathrm{proj}} \\equiv E_{\\mathrm{proj}}^{\\text{after}} - E_{\\mathrm{proj}}^{\\text{before}},\n$$\nand give your final answer as an exact value in Hartree (do not round). The final answer must be a single number.", "solution": "The problem statement is validated as scientifically grounded, well-posed, and objective. It provides a complete and consistent set of data and rules to execute a single, deterministic step of a standard Full Configuration Interaction Quantum Monte Carlo (FCIQMC) simulation. The problem is a direct and formalizable application of principles in theoretical chemistry. Therefore, a solution will be provided.\n\nThe objective is to compute the change in the projected energy, $\\Delta E_{\\mathrm{proj}} = E_{\\mathrm{proj}}^{\\text{after}} - E_{\\mathrm{proj}}^{\\text{before}}$, over one time step $\\delta \\tau = 0.1$.\n\nFirst, we establish the initial state and calculate the projected energy before the step, $E_{\\mathrm{proj}}^{\\text{before}}$.\nThe initial signed walker counts on the Slater determinants $\\lvert D_{0} \\rangle$ and $\\lvert D_{1} \\rangle$ are:\n- $N_{0}^{\\text{before}} = (+1) \\times 3 + (-1) \\times 1 = 2$\n- $N_{1}^{\\text{before}} = (+1) \\times 0 + (-1) \\times 1 = -1$\n\nThe projected energy estimator is defined as $E_{\\mathrm{proj}} \\equiv \\frac{\\sum_{j} H_{0j} \\, N_{j}}{N_{0}}$. The relevant Hamiltonian matrix elements are $H_{00}=-1.0$ and $H_{01}=+0.2$.\nThe initial projected energy is:\n$$\nE_{\\mathrm{proj}}^{\\text{before}} = \\frac{H_{00} N_{0}^{\\text{before}} + H_{01} N_{1}^{\\text{before}}}{N_{0}^{\\text{before}}} = \\frac{(-1.0)(2) + (0.2)(-1)}{2} = \\frac{-2.0 - 0.2}{2} = \\frac{-2.2}{2} = -1.1\n$$\n\nNext, we simulate one time step according to the specified rules, in the order of spawning, death/cloning, and annihilation.\n\nSpawning Step:\nA spawn from determinant $\\lvert D_{i} \\rangle$ to $\\lvert D_{j} \\rangle$ occurs with probability $p_{\\mathrm{s}}(j \\leftarrow i) = \\delta \\tau \\left| H_{ji} \\right|$. The sign of the spawned child is $s_{\\mathrm{child}} = -\\mathrm{sgn}(H_{ji}) s_{\\mathrm{parent}}$.\n\n- Spawning from $\\lvert D_{0} \\rangle$ to $\\lvert D_{1} \\rangle$:\n  The probability is $p_{\\mathrm{s}}(1 \\leftarrow 0) = \\delta \\tau \\left| H_{10} \\right| = (0.1) |+0.2| = 0.02$.\n  The sign rule is $s_{\\mathrm{child}} = -\\mathrm{sgn}(+0.2) s_{\\mathrm{parent}} = -s_{\\mathrm{parent}}$.\n  There are $4$ parent walkers on $\\lvert D_{0} \\rangle$: $3$ positive (p-a, p-b, p-c) and $1$ negative (n-a). We check each against its random number $u$.\n  1. Walker p-a ($u=0.4$): $0.4 \\ge 0.02$. No spawn.\n  2. Walker p-b ($u=0.015$): $0.015 < 0.02$. Spawn occurs. Parent is positive, so a negative child is created on $\\lvert D_{1} \\rangle$.\n  3. Walker p-c ($u=0.8$): $0.8 \\ge 0.02$. No spawn.\n  4. Walker n-a ($u=0.010$): $0.010 < 0.02$. Spawn occurs. Parent is negative, so a positive child is created on $\\lvert D_{1} \\rangle$.\n  In total, spawning from $\\lvert D_{0} \\rangle$ creates one positive and one negative walker on $\\lvert D_{1} \\rangle$.\n\n- Spawning from $\\lvert D_{1} \\rangle$ to $\\lvert D_{0} \\rangle$:\n  The probability is $p_{\\mathrm{s}}(0 \\leftarrow 1) = \\delta \\tau \\left| H_{01} \\right| = (0.1) |+0.2| = 0.02$.\n  The sign rule is $s_{\\mathrm{child}} = -\\mathrm{sgn}(+0.2) s_{\\mathrm{parent}} = -s_{\\mathrm{parent}}$.\n  There is $1$ negative parent walker on $\\lvert D_{1} \\rangle$.\n  1. Walker ($u=0.70$): $0.70 \\ge 0.02$. No spawn.\n  No walkers are spawned onto $\\lvert D_{0} \\rangle$.\n\nDeath/Cloning Step:\nThis is applied to the original parent walkers. The event probability is $p_{\\mathrm{d}}(i) = \\delta \\tau (H_{ii} - S)$, where $S = -0.8$.\n\n- On $\\lvert D_{0} \\rangle$:\n  The probability is $p_{\\mathrm{d}}(0) = (0.1) \\left( H_{00} - S \\right) = (0.1)(-1.0 - (-0.8)) = (0.1)(-0.2) = -0.02$.\n  Since $p_{\\mathrm{d}}(0) < 0$, cloning occurs with probability $-p_{\\mathrm{d}}(0) = 0.02$.\n  We check the $4$ parent walkers on $\\lvert D_{0} \\rangle$ against their random numbers $u$.\n  1. Walker p-a ($u=0.010$): $0.010 < 0.02$. Clone created. A new positive walker appears on $\\lvert D_{0} \\rangle$.\n  2. Walker p-b ($u=0.50$): $0.50 \\ge 0.02$. No clone.\n  3. Walker p-c ($u=0.50$): $0.50 \\ge 0.02$. No clone.\n  4. Walker n-a ($u=0.30$): $0.30 \\ge 0.02$. No clone.\n  The original $4$ walkers survive, and one positive clone is added to $\\lvert D_{0} \\rangle$.\n\n- On $\\lvert D_{1} \\rangle$:\n  The probability is $p_{\\mathrm{d}}(1) = (0.1) \\left( H_{11} - S \\right) = (0.1)(0.5 - (-0.8)) = (0.1)(1.3) = 0.13$.\n  Since $p_{\\mathrm{d}}(1) \\ge 0$, death occurs with probability $0.13$.\n  We check the $1$ negative parent walker on $\\lvert D_{1} \\rangle$ against its random number $u=0.50$.\n  1. Walker ($u=0.50$): $0.50 \\ge 0.13$. The walker survives.\n  The original negative walker on $\\lvert D_{1} \\rangle$ survives.\n\nAnnihilation Step:\nWe now sum all walkers (survivors, clones, spawned children) on each determinant and annihilate opposite-signed pairs.\n\n- On $\\lvert D_{0} \\rangle$:\n  - Original survivors: $3$ positive, $1$ negative.\n  - Spawned children: $0$.\n  - Clones: $1$ positive.\n  - Total before annihilation: $(3+1)$ positive, $1$ negative $= 4$ positive, $1$ negative.\n  - Annihilation: $4 - 1 = 3$ positive walkers remain.\n  - The final signed count is $N_{0}^{\\text{after}} = +3$.\n\n- On $\\lvert D_{1} \\rangle$:\n  - Original survivor: $1$ negative.\n  - Spawned children: $1$ positive, $1$ negative.\n  - Clones: $0$.\n  - Total before annihilation: $1$ positive, $(1+1)$ negative $= 1$ positive, $2$ negative.\n  - Annihilation: $2 - 1 = 1$ negative walker remains.\n  - The final signed count is $N_{1}^{\\text{after}} = -1$.\n\nFinally, we compute the projected energy after the step, $E_{\\mathrm{proj}}^{\\text{after}}$, and its change, $\\Delta E_{\\mathrm{proj}}$.\n$$\nE_{\\mathrm{proj}}^{\\text{after}} = \\frac{H_{00} N_{0}^{\\text{after}} + H_{01} N_{1}^{\\text{after}}}{N_{0}^{\\text{after}}} = \\frac{(-1.0)(3) + (0.2)(-1)}{3} = \\frac{-3.0 - 0.2}{3} = -\\frac{3.2}{3}\n$$\nThe change in projected energy is:\n$$\n\\Delta E_{\\mathrm{proj}} = E_{\\mathrm{proj}}^{\\text{after}} - E_{\\mathrm{proj}}^{\\text{before}} = \\left(-\\frac{3.2}{3}\\right) - (-1.1) = -\\frac{3.2}{3} + \\frac{1.1}{1}\n$$\nTo express this as an exact fraction:\n$$\n\\Delta E_{\\mathrm{proj}} = -\\frac{32}{30} + \\frac{11}{10} = -\\frac{32}{30} + \\frac{33}{30} = \\frac{33 - 32}{30} = \\frac{1}{30}\n$$\nThe change in the projected energy estimator over this one step is exactly $\\frac{1}{30}$ Hartree.", "answer": "$$\\boxed{\\frac{1}{30}}$$", "id": "2803677"}]}