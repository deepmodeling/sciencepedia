{"hands_on_practices": [{"introduction": "This problem provides a foundational exercise to build intuition for the core differences between the classical Rice-Ramsperger-Kassel (RRK) theory and the modern Rice-Ramsperger-Kassel-Marcus (RRKM) theory. By working through a simple, well-defined molecular model, you will directly compare the probability of reaction predicted by treating energy as a continuous variable versus counting discrete quantum states [@problem_id:2685989]. This hands-on calculation illuminates how the shift from a classical to a quantum statistical perspective fundamentally alters our description of unimolecular reactivity.", "problem": "A polyatomic molecule has separable harmonic vibrational modes with identical frequency $\\nu$. One mode corresponds to the reactive coordinate, and the remaining modes are nonreactive (bath modes). Consider a microcanonical ensemble in which the total vibrational energy above the zero-point level is $E = q\\,\\varepsilon$, where $\\varepsilon = h\\nu$ and $q$ is a nonnegative integer. The intrinsic barrier requires that the reactive mode have at least $E_{0} = q_{0}\\,\\varepsilon$, with $q_{0}$ a positive integer. Assume there are $s=4$ vibrational modes in total (one reactive and three bath modes), and take $q=12$ and $q_{0}=4$.\n\nUsing only fundamental definitions of the Rice–Ramsperger–Kassel (RRK) and Rice–Ramsperger–Kassel–Marcus (RRKM) theories:\n\n1) Under RRK, start from the microcanonical postulate that the energy is uniformly distributed over the continuous $(s-1)$-dimensional simplex of nonnegative mode energies summing to $E$. Compute the microcanonical probability $P_{\\mathrm{RRK}}(E)$ that the instantaneous energy in the reactive mode is at least $E_{0}$ for the specified $s$, $q$, and $q_{0}$.\n\n2) Under RRKM, treat the vibrational energy quanta explicitly. Let $g(E)$ denote the number of reactant quantum states with total quanta $q$ distributed among $s$ modes, and let $N^{\\ddagger}(E - E_{0})$ denote the number of transition-state quantum states with up to $q-q_{0}$ quanta distributed among the $s-1$ bath modes (the reactive mode is replaced by the reaction coordinate). Compute the microcanonical statistical factor\n$$\nP_{\\mathrm{RRKM}}(E) \\equiv \\frac{N^{\\ddagger}(E - E_{0})}{g(E)}\n$$\nby explicit state counting for the specified $s$, $q$, and $q_{0}$.\n\nReport the final quantity\n$$\nR \\equiv \\frac{P_{\\mathrm{RRKM}}(E)}{P_{\\mathrm{RRK}}(E)}\n$$\nas an exact fraction with no units. Do not round your answer.", "solution": "The problem statement is subjected to validation before a solution is attempted.\n\nThe givens extracted from the problem statement are:\n- A polyatomic molecule has separable harmonic vibrational modes with an identical frequency $\\nu$.\n- The energy quantum is $\\varepsilon = h\\nu$.\n- The total vibrational energy above the zero-point level is $E = q\\,\\varepsilon$.\n- The number of vibrational modes is $s=4$.\n- The total number of energy quanta is $q=12$.\n- The reactive mode is one of the $s$ modes. The remaining $s-1$ modes are bath modes.\n- The intrinsic barrier requires the reactive mode to have at least energy $E_{0} = q_{0}\\,\\varepsilon$.\n- The minimum number of quanta for reaction is $q_{0}=4$.\n- The RRK probability, $P_{\\mathrm{RRK}}(E)$, is defined based on a continuous uniform energy distribution over an $(s-1)$-dimensional simplex. It represents the probability that the reactive mode energy is at least $E_0$.\n- The RRKM statistical factor is defined as $P_{\\mathrm{RRKM}}(E) \\equiv \\frac{N^{\\ddagger}(E - E_{0})}{g(E)}$.\n- $g(E)$ is the number of reactant quantum states with $q$ quanta in $s$ modes.\n- $N^{\\ddagger}(E - E_{0})$ is the number of transition-state quantum states with up to $q-q_{0}$ quanta distributed among the $s-1$ bath modes.\nThe final quantity to be reported is the ratio $R \\equiv \\frac{P_{\\mathrm{RRKM}}(E)}{P_{\\mathrm{RRK}}(E)}$.\n\nThis problem is scientifically grounded, well-posed, and objective. It is a standard exercise in physical chemistry, applying the fundamental principles of RRK and RRKM theories. All definitions and numerical values are provided, rendering the problem self-contained and unambiguous. Therefore, the problem is valid and a solution will be provided.\n\nThe solution proceeds in three parts: first, the calculation of the classical RRK probability; second, the calculation of the quantum RRKM statistical factor; and third, the computation of their ratio.\n\nPart 1: Calculation of $P_{\\mathrm{RRK}}(E)$\n\nThe RRK theory, in its classical formulation, assumes that the total energy $E$ is distributed continuously among $s$ identical harmonic oscillators. The accessible phase space is an $(s-1)$-dimensional simplex defined by $\\sum_{i=1}^{s} E_i = E$ with $E_i \\ge 0$, where $E_i$ is the energy in the $i$-th oscillator. The volume (or more precisely, hyper-area) of this simplex is proportional to $E^{s-1}$.\n\nThe probability $P_{\\mathrm{RRK}}(E)$ that a specific oscillator (the reactive mode) has an energy of at least $E_0$ is the ratio of the volume of the favorable region of phase space to the total volume of phase space. The favorable region is where the reactive mode energy $E_r \\ge E_0$. This condition can be rewritten by defining a new variable $E'_r = E_r - E_0 \\ge 0$. The energy conservation equation becomes $(E'_r + E_0) + \\sum_{i=2}^{s} E_i = E$, which simplifies to $E'_r + \\sum_{i=2}^{s} E_i = E - E_0$. This describes a smaller simplex of total energy $E-E_0$. The volume of this smaller simplex is proportional to $(E - E_0)^{s-1}$.\n\nThe probability is the ratio of these volumes:\n$$\nP_{\\mathrm{RRK}}(E) = \\frac{(\\text{Volume for total energy } E-E_0)}{(\\text{Volume for total energy } E)} = \\left(\\frac{E - E_0}{E}\\right)^{s-1}\n$$\nThe problem specifies energy in terms of quanta: $E = q\\varepsilon$ and $E_0 = q_0\\varepsilon$. Substituting these into the formula:\n$$\nP_{\\mathrm{RRK}}(E) = \\left(\\frac{q\\varepsilon - q_0\\varepsilon}{q\\varepsilon}\\right)^{s-1} = \\left(\\frac{q - q_0}{q}\\right)^{s-1}\n$$\nUsing the given values $s=4$, $q=12$, and $q_0=4$:\n$$\nP_{\\mathrm{RRK}}(E) = \\left(\\frac{12 - 4}{12}\\right)^{4-1} = \\left(\\frac{8}{12}\\right)^{3} = \\left(\\frac{2}{3}\\right)^{3} = \\frac{8}{27}\n$$\n\nPart 2: Calculation of $P_{\\mathrm{RRKM}}(E)$\n\nThe RRKM theory uses a quantum mechanical approach, counting discrete vibrational states. The statistical factor is $P_{\\mathrm{RRKM}}(E) = \\frac{N^{\\ddagger}(E - E_{0})}{g(E)}$.\n\nFirst, we calculate $g(E)$, the total number of microstates for the reactant. This corresponds to the number of ways to distribute $q$ identical quanta of energy among $s$ distinguishable oscillators. This is a classic combinatorial problem, the solution of which is given by the multiset coefficient:\n$$\ng(E) = \\binom{q + s - 1}{s - 1}\n$$\nWith $q=12$ and $s=4$:\n$$\ng(E) = \\binom{12 + 4 - 1}{4 - 1} = \\binom{15}{3} = \\frac{15 \\times 14 \\times 13}{3 \\times 2 \\times 1} = 5 \\times 7 \\times 13 = 455\n$$\n\nNext, we calculate $N^{\\ddagger}(E - E_0)$, the sum of states for the activated complex. According to the problem definition, this is the total number of quantum states with up to $q-q_0$ quanta distributed among the $s-1$ nonreactive (bath) modes.\nThis is the sum of the number of ways to distribute $k$ quanta in $s-1$ modes, for $k$ ranging from $0$ to $q-q_0$.\nThe number of ways to distribute $k$ quanta in $s-1$ modes is $\\binom{k + (s-1) - 1}{(s-1)-1} = \\binom{k + s - 2}{s-2}$.\nSo, $N^{\\ddagger}(E - E_0)$ is the sum:\n$$\nN^{\\ddagger}(E - E_0) = \\sum_{k=0}^{q-q_0} \\binom{k + s - 2}{s - 2}\n$$\nUsing the hockey-stick identity, $\\sum_{i=r}^{n} \\binom{i}{r} = \\binom{n+1}{r+1}$, we can evaluate this sum. The result of the sum is:\n$$\nN^{\\ddagger}(E - E_0) = \\binom{(q-q_0) + (s-1)}{s-1} = \\binom{q - q_0 + s - 1}{s-1}\n$$\nWith $q=12$, $q_0=4$, and $s=4$:\nThe number of available quanta is $q-q_0 = 12-4=8$. The number of bath modes is $s-1=3$.\n$$\nN^{\\ddagger}(E - E_0) = \\binom{8 + 4 - 1}{4 - 1} = \\binom{11}{3} = \\frac{11 \\times 10 \\times 9}{3 \\times 2 \\times 1} = 11 \\times 5 \\times 3 = 165\n$$\nNow, we can compute the RRKM statistical factor:\n$$\nP_{\\mathrm{RRKM}}(E) = \\frac{N^{\\ddagger}(E - E_{0})}{g(E)} = \\frac{165}{455}\n$$\nThis fraction can be simplified by dividing the numerator and denominator by their greatest common divisor, which is $5$:\n$$\nP_{\\mathrm{RRKM}}(E) = \\frac{165 \\div 5}{455 \\div 5} = \\frac{33}{91}\n$$\n\nPart 3: Calculation of the Ratio $R$\n\nThe final step is to compute the ratio $R = \\frac{P_{\\mathrm{RRKM}}(E)}{P_{\\mathrm{RRK}}(E)}$.\n$$\nR = \\frac{33/91}{8/27} = \\frac{33}{91} \\times \\frac{27}{8} = \\frac{33 \\times 27}{91 \\times 8}\n$$\nThe numerator is $33 \\times 27 = 891$.\nThe denominator is $91 \\times 8 = 728$.\nThus, the ratio is:\n$$\nR = \\frac{891}{728}\n$$\nThe prime factorization of the numerator is $891 = 3^4 \\times 11$. The prime factorization of the denominator is $728 = 2^3 \\times 7 \\times 13$. There are no common factors, so the fraction is in its simplest form.", "answer": "$$\n\\boxed{\\frac{891}{728}}\n$$", "id": "2685989"}, {"introduction": "Calculating the vibrational density of states, $\\rho(E)$, is a crucial step in any practical application of RRKM theory, moving beyond simple textbook models. This computational exercise challenges you to implement a direct-count algorithm, a workhorse method in computational kinetics, to generate $\\rho(E)$ for a molecule with arbitrary vibrational frequencies [@problem_id:2685935]. By exploring the effect of energy binning, you will also gain valuable insight into the trade-offs between accuracy and computational efficiency inherent in numerical approaches to reaction dynamics.", "problem": "You are asked to implement a program that constructs the microcanonical vibrational density of states for a collection of independent quantum harmonic modes using a simple discretized convolution on a coarse energy grid, and to quantify the error introduced by the discretization as the energy bin width varies. The scientific context is unimolecular reaction rate theory, specifically the Rice–Ramsperger–Kassel–Marcus (RRKM) framework, where the microcanonical density of states, denoted by $\\rho(E)$, is a key quantity.\n\nFundamental base and definitions:\n- Consider $s$ independent quantum harmonic modes. In reduced units, each mode $k$ has an energy quantum $q_k$ expressed as an integer multiple of a reference unit $\\varepsilon$, which we set to $\\varepsilon = 1$ (dimensionless).\n- A microstate is specified by nonnegative integers $\\{n_k\\}_{k=1}^s$, with total energy $E = \\sum_{k=1}^s n_k q_k$ in units of $\\varepsilon$.\n- The exact microcanonical degeneracy at total energy $n$ (in units of $\\varepsilon$) is the number of integer solutions to $\\sum_{k=1}^s n_k q_k = n$. The exact fine-grid density on the unit grid is then the sequence $g[n]$ for $n = 0, 1, \\dots, N$, where $N = \\lfloor E_{\\max} \\rfloor$ and $g[n]$ counts the number of microstates with total energy exactly $n$.\n- Define a coarse energy bin width $\\Delta E$ (also in units of $\\varepsilon$). The coarse grid has bin indices $i = 0, 1, \\dots, M$ with $M = \\left\\lfloor \\frac{E_{\\max}}{\\Delta E} \\right\\rfloor$. The exact coarse-binned density per unit energy is\n$$\n\\rho_{\\mathrm{ref}}[i] = \\frac{1}{\\Delta E} \\sum_{n = i\\,\\Delta E}^{(i+1)\\,\\Delta E - 1} g[n],\n$$\nwhere bin boundaries and summations are over integers, and the last bin is included only if its upper bound does not exceed $E_{\\max}$.\n\nTask overview:\n1. Exact reference on the fine grid: Using only fundamental counting for independent harmonic modes, construct the exact fine-grid sequence $g[n]$ for $n = 0, 1, \\dots, N$ by mode-by-mode accumulation without closed-form shortcuts. Then aggregate to the coarse grid to obtain $\\rho_{\\mathrm{ref}}[i]$ as defined above.\n2. Simple discretized convolution on the coarse grid: Implement a coarse-grid approximation that builds $\\rho(E)$ mode-by-mode by discretized convolution:\n   - For each mode $k$ with quantum $q_k$, define its coarse-grid single-mode contribution vector $h^{(k)}[j]$ by placing unit mass for each occupancy $m \\in \\{0, 1, 2, \\dots\\}$ at the nearest coarse bin index computed by rounding $m q_k / \\Delta E$ to the nearest integer (use nearest-integer rounding with ties rounded up, i.e., $\\lfloor x + 0.5 \\rfloor$). Truncate occupancies so that $m q_k \\leq E_{\\max}$. Explicitly, for each allowable $m$, set $h^{(k)}[b_m] \\leftarrow h^{(k)}[b_m] + 1$ with $b_m = \\left\\lfloor \\frac{m q_k}{\\Delta E} + 0.5 \\right\\rfloor$.\n   - Starting from $G[i] = 0$ for all $i$ and $G[0]=1$, convolve $G$ with $h^{(1)}$, then with $h^{(2)}$, and so on through $h^{(s)}$, truncating to length $M+1$ after each convolution. The resulting $G[i]$ approximates the coarse-bin counts; define the coarse-grid approximate density per unit energy as $\\rho_{\\mathrm{conv}}[i] = G[i] / \\Delta E$.\n3. Error metric: Quantify the global discretization error for a given parameter set by the relative $\\ell_1$ error\n$$\n\\mathrm{err} = \\frac{\\sum_{i=0}^{M} \\left| \\rho_{\\mathrm{conv}}[i] - \\rho_{\\mathrm{ref}}[i] \\right|}{\\sum_{i=0}^{M} \\rho_{\\mathrm{ref}}[i]}.\n$$\n\nImplementation requirements:\n- All energies are in reduced units of the fundamental quantum $\\varepsilon$, which is dimensionless and set to $\\varepsilon = 1$. Therefore, $E_{\\max}$ and $\\Delta E$ are dimensionless integers.\n- You must implement the exact fine-grid reference $g[n]$ using only mode-by-mode accumulation based on the definition of counting integer solutions, and the simple discretized convolution on the coarse grid using the nearest-integer rounding rule $\\lfloor x + 0.5 \\rfloor$ for placing single-mode contributions.\n- Report the error $\\mathrm{err}$ as a floating-point number for each parameter set.\n\nTest suite:\nFor each test case, you are given a tuple $(\\{q_k\\}_{k=1}^s, E_{\\max}, \\Delta E)$. Use the following five cases:\n- Case $1$: $\\{q_k\\} = [3, 5, 7]$, $E_{\\max} = 120$, $\\Delta E = 1$.\n- Case $2$: $\\{q_k\\} = [3, 5, 7]$, $E_{\\max} = 120$, $\\Delta E = 4$.\n- Case $3$: $\\{q_k\\} = [3, 5, 7]$, $E_{\\max} = 120$, $\\Delta E = 9$.\n- Case $4$: $\\{q_k\\} = [4, 6]$, $E_{\\max} = 240$, $\\Delta E = 7$.\n- Case $5$: $\\{q_k\\} = [5]$, $E_{\\max} = 240$, $\\Delta E = 8$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The $i$-th entry must be the error $\\mathrm{err}$ for Case $i$, expressed as a floating-point number. For example, output of the form\n$[r_1,r_2,r_3,r_4,r_5]$\nwith each $r_i$ a float is required.", "solution": "The problem statement is validated as scientifically sound, well-posed, objective, and self-contained. It presents a standard computational task in physical chemistry, specifically in the context of unimolecular reaction rate theory (RRKM theory), which involves the calculation of the microcanonical vibrational density of states. The methodologies prescribed for the \"exact\" reference and the \"approximate\" convolution are standard, albeit simplified, numerical techniques. The problem is free from logical contradictions, factual errors, and ambiguities, given a reasonable interpretation of boundary conditions. Therefore, a solution is warranted.\n\nThe solution is structured into three main components as per the problem's requirements: first, the computation of an exact reference density of states on a coarse energy grid; second, the computation of an approximate density of states using a discretized convolution approach; and third, the quantification of the error between these two results.\n\n**1. Exact Reference Density of States ($\\rho_{\\mathrm{ref}}$)**\n\nThe fundamental quantity is the microcanonical degeneracy, $g[n]$, which represents the number of distinct quantum states (microstates) at a specific integer total energy $n$. For a system composed of $s$ independent harmonic modes with integer quanta $\\{q_k\\}_{k=1}^s$, $g[n]$ is the number of non-negative integer solutions $\\{n_k\\}$ to the Diophantine equation $\\sum_{k=1}^s n_k q_k = n$.\n\nWe compute $g[n]$ for the fine energy grid $n = 0, 1, \\dots, N$ (where $N = E_{\\max}$) using a dynamic programming approach. Let $g^{(j)}[n]$ be the degeneracy for a system of the first $j$ modes. When adding mode $j+1$ with quantum $q_{j+1}$, the new degeneracy $g^{(j+1)}[n]$ can be calculated from the previous one, $g^{(j)}[n]$, via the recurrence relation:\n$$\ng^{(j+1)}[n] = \\sum_{m=0}^{\\lfloor n/q_{j+1} \\rfloor} g^{(j)}[n - m \\cdot q_{j+1}]\n$$\nThis relation expresses that a state of total energy $n$ in the $(j+1)$-mode system is formed by combining a state of the $j$-mode system of energy $n - m \\cdot q_{j+1}$ with an excitation of $m$ quanta in mode $j+1$. This is equivalent to the recurrence $g^{(j+1)}[n] = g^{(j)}[n] + g^{(j+1)}[n - q_{j+1}]$, which is computationally efficient.\nThe algorithm proceeds as follows:\n- Initialize a one-dimensional array `g` of size $N+1$ representing the degeneracies, with $g[0]=1$ and $g[n>0]=0$. This corresponds to a system with zero modes.\n- For each mode $k$ with quantum $q_k$ in the set $\\{q_k\\}$:\n  - Update the array `g` in place. For each energy level $n$ from $q_k$ to $N$, the new degeneracy is given by $g[n] \\leftarrow g[n] + g[n - q_k]$. This correctly adds the contribution of the new mode across all energy levels.\n- After iterating through all $s$ modes, the array `g` contains the exact fine-grid degeneracies for the complete system.\n\nOnce the fine-grid degeneracies $g[n]$ are known, we construct the reference coarse-binned density per unit energy, $\\rho_{\\mathrm{ref}}[i]$. The energy range is divided into $M+1$ bins, where $M = \\lfloor E_{\\max} / \\Delta E \\rfloor$. For each bin $i \\in \\{0, 1, \\dots, M\\}$, we sum the degeneracies of all fine-grid energy levels that fall within it and normalize by the bin width $\\Delta E$:\n$$\n\\rho_{\\mathrm{ref}}[i] = \\frac{1}{\\Delta E} \\sum_{n = i \\cdot \\Delta E}^{\\min((i+1) \\cdot \\Delta E - 1, E_{\\max})} g[n]\n$$\nThe summation's upper limit is capped at $E_{\\max}$ to correctly handle the final bin.\n\n**2. Approximate Density of States via Discretized Convolution ($\\rho_{\\mathrm{conv}}$)**\n\nThis approach builds the coarse-binned density directly, bypassing the fine-grid calculation. The principle of convolution still applies, but it is performed on the coarse grid itself.\n\n- For each mode $k$, we define a coarse-grid single-mode contribution vector, $h^{(k)}$. This vector has length $M+1$. For each possible occupancy $m \\in \\{0, 1, 2, \\dots\\}$ such that the energy $E_m = m \\cdot q_k$ does not exceed $E_{\\max}$, we determine its corresponding coarse bin. The energy $E_m$ is placed into the nearest coarse bin, with the bin index $b_m$ calculated using the specified nearest-integer rounding rule:\n$$\nb_m = \\left\\lfloor \\frac{m \\cdot q_k}{\\Delta E} + 0.5 \\right\\rfloor\n$$\nA count of $1$ is added to the vector $h^{(k)}$ at this index: $h^{(k)}[b_m] \\leftarrow h^{(k)}[b_m] + 1$.\n\n- The total coarse-binned degeneracy count, $G[i]$, is obtained by iteratively convolving these single-mode contributions. We start with an identity vector $G$ of size $M+1$ ($G[0]=1$, $G[i>0]=0$). Then, for each mode $k$, we update $G$ by convolving it with $h^{(k)}$ and truncating the result to a length of $M+1$:\n$$\nG \\leftarrow \\left( G * h^{(k)} \\right)[0:M+1]\n$$\nwhere $*$ denotes discrete convolution.\n\n- After convolving with all $s$ modes, the resulting vector $G$ contains the approximate total counts in each coarse bin. The approximate density per unit energy, $\\rho_{\\mathrm{conv}}[i]$, is found by normalizing by the bin width:\n$$\n\\rho_{\\mathrm{conv}}[i] = \\frac{G[i]}{\\Delta E}\n$$\nThis method introduces a discretization error because the rounding process shifts the exact energy of each single-mode state to the center of the nearest bin before the states are combined.\n\n**3. Error Quantification**\n\nTo assess the accuracy of the approximate convolution method, we compute the relative $\\ell_1$ error between the approximate and reference densities. This metric quantifies the total deviation, normalized by the total integrated reference density:\n$$\n\\mathrm{err} = \\frac{\\sum_{i=0}^{M} \\left| \\rho_{\\mathrm{conv}}[i] - \\rho_{\\mathrm{ref}}[i] \\right|}{\\sum_{i=0}^{M} \\rho_{\\mathrm{ref}}[i]}\n$$\nA smaller value of $\\mathrm{err}$ indicates a better agreement between the two methods. For $\\Delta E=1$ and integer quanta, the two methods become identical, and the error is expected to be zero, as the rounding operation places each energy $m \\cdot q_k$ precisely at bin index $m \\cdot q_k$. As $\\Delta E$ increases, the discretization error introduced by rounding becomes more significant, and $\\mathrm{err}$ is expected to increase.\n\nThe implementation will follow these algorithms precisely for each test case provided.", "answer": "```python\nimport numpy as np\n\ndef calculate_error(q_k, E_max, Delta_E):\n    \"\"\"\n    Calculates the error between an exact and an approximate method for the\n    microcanonical vibrational density of states for a set of harmonic oscillators.\n\n    Args:\n        q_k (list of int): The vibrational quanta for each of the s modes.\n        E_max (int): The maximum energy for the calculation.\n        Delta_E (int): The width of the coarse energy bins.\n\n    Returns:\n        float: The relative l1 error between the two methods.\n    \"\"\"\n    # 1. PARAMETERS and INITIALIZATION\n    N = E_max\n    M = E_max // Delta_E\n    g_size = N + 1\n    G_size = M + 1\n\n    # 2. EXACT REFERENCE CALCULATION (rho_ref)\n\n    # 2a. Calculate fine-grid density g[n] using dynamic programming\n    g = np.zeros(g_size, dtype=np.int64)\n    g[0] = 1\n    for q in q_k:\n        # The recurrence g_new[n] = g_old[n] + g_new[n-q] can be implemented\n        # in-place by iterating n from q upwards.\n        for n in range(q, g_size):\n            g[n] += g[n - q]\n\n    # 2b. Aggregate g[n] to coarse bins to get rho_ref\n    rho_ref = np.zeros(G_size, dtype=np.float64)\n    for i in range(G_size):\n        n_start = i * Delta_E\n        # Sum g[n] over the bin, handling the final bin truncation at E_max\n        n_end = min((i + 1) * Delta_E, g_size)\n        bin_sum = np.sum(g[n_start:n_end])\n        rho_ref[i] = bin_sum / Delta_E\n\n    # 3. APPROXIMATE CONVOLUTION CALCULATION (rho_conv)\n    \n    # 3a. Start with an identity vector for convolution\n    G = np.zeros(G_size, dtype=np.int64)\n    G[0] = 1\n\n    # 3b. Convolve with each mode's contribution vector h_k\n    for q in q_k:\n        # Construct the single-mode contribution vector h_k\n        h_k = np.zeros(G_size, dtype=np.int64)\n        max_occupancy = E_max // q\n        for m in range(max_occupancy + 1):\n            energy = m * q\n            # Use specified rounding rule: floor(x + 0.5) for nearest-integer with ties up\n            bin_idx = int(np.floor(energy / Delta_E + 0.5))\n            if bin_idx < G_size:\n                h_k[bin_idx] += 1\n        \n        # Convolve and truncate to maintain size M+1\n        G = np.convolve(G, h_k)[:G_size]\n    \n    # 3c. Calculate approximate density rho_conv\n    rho_conv = G / float(Delta_E)\n    \n    # 4. ERROR CALCULATION\n    \n    numerator = np.sum(np.abs(rho_conv - rho_ref))\n    denominator = np.sum(rho_ref)\n    \n    # Avoid division by zero, though unlikely in this problem context\n    if denominator == 0:\n        return 0.0\n    \n    err = numerator / denominator\n    return err\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        ([3, 5, 7], 120, 1),\n        ([3, 5, 7], 120, 4),\n        ([3, 5, 7], 120, 9),\n        ([4, 6], 240, 7),\n        ([5], 240, 8),\n    ]\n\n    results = []\n    for case in test_cases:\n        q_k, E_max, Delta_E = case\n        err = calculate_error(q_k, E_max, Delta_E)\n        results.append(err)\n\n    # Format the final output as a comma-separated list in brackets.\n    print(f\"[{','.join(f'{r:.7f}' for r in results)}]\")\n\nsolve()\n```", "id": "2685935"}, {"introduction": "A common point of confusion is why thermal experiments often yield smooth, Arrhenius-like rate constants while the underlying microcanonical rate, $k(E)$, can exhibit rich quantum structure. This practice explores the mathematical reason for this discrepancy—the smoothing effect of Boltzmann averaging—which acts like a low-pass filter on the energy-resolved rate coefficient [@problem_id:2685884]. Furthermore, it connects theory to practice by examining realistic experimental techniques designed to overcome this averaging and directly probe the microcanonical dynamics of molecules.", "problem": "A polyatomic molecule exhibits pronounced non–Rice–Ramsperger–Kassel–Marcus (non-RRKM) behavior in its energy-resolved, microcanonical unimolecular rate constant $k(E)$, for example, step-like increases and oscillations just above the dissociation threshold. However, thermal experiments report a smooth, Arrhenius-like temperature-dependent rate constant $k(T)$ with no obvious structure. Which option best explains why canonical averaging can mask non-RRKM features that are evident in microcanonical $k(E)$, and also proposes an experimentally realistic protocol to recover energy-resolved rates $k(E)$?\n\nA. Canonical measurements yield $k(T)$ that is a Boltzmann-weighted average of $k(E)$ over a broad internal-energy distribution; the thermal kernel has width on the order of $k_{\\mathrm{B}}T$ (or larger when the density of states is high), so features in $k(E)$ on energy scales smaller than this width are smoothed out. To recover $k(E)$, prepare ions with sharply defined internal energy using Threshold Photoelectron–Photoion Coincidence (TPEPICO), then measure unimolecular dissociation time distributions under single-collision conditions while scanning the photon energy to map $k(E)$.\n\nB. Canonical averaging emphasizes the lowest-energy molecules, which exaggerates non-RRKM features. To recover $k(E)$, increase the bath pressure so that intramolecular vibrational energy redistribution (IVR) becomes very fast and measure high-pressure-limit kinetics.\n\nC. In the canonical ensemble the total energy is fixed, so $k(T)$ is identical to $k(E)$ at $E=\\langle E\\rangle$. To recover $k(E)$, use multiphoton infrared excitation to deposit a broad band of energies in a single experiment.\n\nD. Canonical averaging removes the dependence on the density of states, so any deviations from Rice–Ramsperger–Kassel–Marcus (RRKM) theory vanish. The only way to recover them is to fit steady-state thermal kinetics over a wide temperature range using a non-Arrhenius model.", "solution": "We begin from fundamental statistical-mechanical definitions. In the microcanonical picture of unimolecular reaction, the rate constant $k(E,J)$ at fixed total energy $E$ and total angular momentum $J$ can be written in Rice–Ramsperger–Kassel–Marcus (RRKM) theory as\n$$\nk_{\\mathrm{RRKM}}(E,J) = \\frac{N^{\\ddagger}(E-E_{0},J)}{h\\,\\rho(E,J)} \\,,\n$$\nwhere $N^{\\ddagger}(E-E_{0},J)$ is the sum of states of the transition-state dividing surface up to $E-E_{0}$, $\\rho(E,J)$ is the reactant density of states, $E_{0}$ is the threshold, and $h$ is Planck’s constant. In general (including non-RRKM systems), one can still define a true microcanonical rate $k(E)$ that reflects both the phase-space bottlenecks and any dynamical constraints such as incomplete intramolecular vibrational energy redistribution (IVR).\n\nThermal experiments at temperature $T$ probe a canonical ensemble. The canonical probability density of internal energies is\n$$\nP(E;T) = \\frac{\\rho(E)\\,e^{-\\beta E}}{Q(T)} \\,,\n$$\nwhere $\\beta = 1/(k_{\\mathrm{B}}T)$, $k_{\\mathrm{B}}$ is Boltzmann’s constant, and $Q(T) = \\int_{0}^{\\infty}\\rho(E)\\,e^{-\\beta E}\\,dE$ is the partition function (after coarse-graining over levels). For any energy-dependent observable $A(E)$, the canonical average is\n$$\n\\langle A \\rangle_{T} = \\int_{0}^{\\infty} A(E)\\,P(E;T)\\,dE \\,.\n$$\nThus, the thermal rate constant $k(T)$ measured in canonical conditions is\n$$\nk(T) = \\int_{0}^{\\infty} k(E)\\,P(E;T)\\,dE = \\frac{\\int_{0}^{\\infty} k(E)\\,\\rho(E)\\,e^{-\\beta E}\\,dE}{\\int_{0}^{\\infty} \\rho(E)\\,e^{-\\beta E}\\,dE} \\,.\n$$\nThis shows that $k(T)$ is a Boltzmann-weighted average (a Laplace transform ratio) of the microcanonical $k(E)$ with an energy kernel of effective width on the order of $k_{\\mathrm{B}}T$, broadened further by the rapidly increasing density of states $\\rho(E)$ for polyatomics.\n\nWhy does this mask non-RRKM features? Consider a simple illustration in which $k(E)$ has oscillations on an energy scale $\\Delta E$:\n$$\nk(E) = k_{0}\\left[1 + a\\cos(\\omega E)\\right], \\quad \\omega = \\frac{2\\pi}{\\Delta E}, \\quad |a|<1 \\,.\n$$\nNeglecting the slow variation of $\\rho(E)$ for the purpose of illustrating the smoothing, the relevant integral involves\n$$\n\\int_{0}^{\\infty} e^{-\\beta E}\\cos(\\omega E)\\,dE = \\operatorname{Re}\\int_{0}^{\\infty} e^{-(\\beta - i\\omega)E}\\,dE = \\frac{\\beta}{\\beta^{2}+\\omega^{2}} \\,.\n$$\nTherefore, the oscillation amplitude in the canonical average is suppressed by a factor\n$$\n\\frac{\\beta}{\\sqrt{\\beta^{2}+\\omega^{2}}} = \\frac{1}{\\sqrt{1+(\\omega/\\beta)^{2}}} = \\frac{1}{\\sqrt{1+\\left(\\frac{2\\pi k_{\\mathrm{B}}T}{\\Delta E}\\right)^{2}}} \\,.\n$$\nWhen the microcanonical structure varies on scales $\\Delta E \\ll k_{\\mathrm{B}}T$, the suppression factor is $\\ll 1$, and the oscillations are effectively washed out. In real polyatomics, the growth of $\\rho(E)$ with $E$ shifts weight toward higher energies while maintaining a broad kernel width, further smoothing narrow features such as step-like onsets at specific bottlenecks or mode-specific IVR thresholds. Consequently, $k(T)$ appears smooth and often Arrhenius-like even when $k(E)$ exhibits pronounced non-RRKM structure.\n\nHow can one recover energy-resolved $k(E)$ experimentally? The principle is to prepare a microcanonical ensemble with a narrow internal-energy spread $\\delta E \\ll \\Delta E$ and to measure time-dependent decay under single-collision (or collision-free) conditions so that the survival probability $S(t;E)$ obeys\n$$\nS(t;E) \\approx e^{-k(E)\\,t} \\,,\n$$\nfrom which $k(E)$ is obtained by fitting. A widely used, scientifically sound protocol for ions is Threshold Photoelectron–Photoion Coincidence (TPEPICO):\n\n- Energy selection: Photoionize a neutral at photon energy $h\\nu$ and detect only threshold photoelectrons with kinetic energy $\\approx 0$, so that by energy conservation the internal energy of the nascent ion is $E_{\\mathrm{int}} \\approx h\\nu - \\mathrm{IE}$, where $\\mathrm{IE}$ is the ionization energy. Gating on near-zero electron kinetic energy yields a narrow $E_{\\mathrm{int}}$ distribution.\n\n- Time-resolved kinetics: Under low-pressure, single-collision conditions, record the dissociation time distribution of the mass-selected parent ions to obtain $S(t;E_{\\mathrm{int}})$ and thus $k(E_{\\mathrm{int}})$.\n\n- Energy scan: Repeat while scanning $h\\nu$ to map $k(E)$ with microcanonical resolution. For neutrals, an analogous approach uses a supersonic beam to prepare cold molecules and a narrowband single-photon excitation to deposit a well-defined internal energy, followed by pump–probe detection of $S(t;E)$.\n\nOption-by-option analysis:\n\nA. This option correctly states that $k(T)$ is a Boltzmann-weighted average over $k(E)$ with a broad kernel of width $\\sim k_{\\mathrm{B}}T$ (broadened by $\\rho(E)$), which smooths features narrower than that scale. The proposed TPEPICO protocol is a realistic, established method to prepare ions with well-defined internal energy and to measure $k(E)$ via time-resolved unimolecular decay while scanning energy. Verdict — Correct.\n\nB. Canonical averaging does not “emphasize the lowest-energy molecules”; the weight is $\\rho(E)e^{-\\beta E}$, which often peaks away from the very lowest energies for large $\\rho(E)$. Increasing pressure accelerates IVR and drives systems toward the high-pressure limit, further masking non-RRKM effects and not providing microcanonical resolution. Verdict — Incorrect.\n\nC. In the canonical ensemble, the energy is not fixed; it is distributed according to $P(E;T)$. Thus $k(T)\\neq k(E=\\langle E\\rangle)$ in general. Multiphoton infrared excitation broadens the internal-energy distribution, which is counterproductive for resolving $k(E)$. Verdict — Incorrect.\n\nD. Canonical averaging does not remove dependence on $\\rho(E)$; it explicitly contains $\\rho(E)$ in the weighting. Fitting steady-state thermal kinetics over temperature still yields an average $k(T)$ and cannot, by itself, uniquely recover the microcanonical $k(E)$ or reveal fine non-RRKM structure. Verdict — Incorrect.", "answer": "$$\\boxed{A}$$", "id": "2685884"}]}