{"hands_on_practices": [{"introduction": "A central challenge in multireference perturbation theory is the \"intruder state\" problem, where near-degeneracies lead to vanishingly small energy denominators, $E_{0}^{(0)} - E_{I}^{(0)}$, causing the perturbative correction to diverge. This exercise [@problem_id:2654359] provides a simplified yet powerful model to explore this issue quantitatively. By modeling the external state spectrum as a continuous distribution, you will analytically calculate the second-order energy correction and directly observe how level-shifting techniques—both real and imaginary—tame these divergences and yield stable energies.", "problem": "A multireference perturbation theory model is defined as follows. A normalized zeroth-order reference state $\\lvert \\Psi_0 \\rangle$ with energy $E_0^{(0)}$ is coupled by a perturbation $\\hat{V}$ to an external space of $M$ configurations $\\{\\lvert \\mu \\rangle\\}$ with zeroth-order energies $E_{\\mu}^{(0)}$. Define the excitation energy denominators $\\Delta \\equiv E_{\\mu}^{(0)} - E_0^{(0)}$. In this model, the denominators $\\Delta$ are independent and identically distributed according to a uniform distribution on the interval $[a,b]$, and the coupling strengths are constant, $\\lvert\\langle \\Psi_0 \\lvert \\hat{V} \\rvert \\mu \\rangle\\rvert = v$ for all $\\mu$. Assume the continuum approximation (replace the discrete sum by an average over the given distribution multiplied by $M$) is valid.\n\nUse the second-order Rayleigh–Schrödinger expression for the energy correction in the multireference setting and the standard level-shift regularizations employed in practical multireference perturbation theory. Compute the second-order energy using:\n- no level shift,\n- a real level shift of magnitude $s$,\n- an imaginary level shift of magnitude $\\eta$, where the physically meaningful energy is the real part of the complex expression.\n\nParameters for this model are $M = 100$, $v = 0.010\\,E_h$, $a = 0.020\\,E_h$, $b = 0.800\\,E_h$, $s = 0.200\\,E_h$, and $\\eta = 0.200\\,E_h$.\n\nReport the three numerical energies in the order (no shift, real shift, imaginary shift). Round your answers to $4$ significant figures and express each energy in $E_h$.", "solution": "The problem statement will first be subjected to a rigorous validation process.\n\n### Step 1: Extract Givens\nThe verbatim givens are as follows:\n- A normalized zeroth-order reference state $\\lvert \\Psi_0 \\rangle$ with energy $E_0^{(0)}$.\n- An external space of $M$ configurations $\\{\\lvert \\mu \\rangle\\}$ with zeroth-order energies $E_{\\mu}^{(0)}$.\n- Perturbation coupling $\\hat{V}$.\n- Excitation energy denominators: $\\Delta \\equiv E_{\\mu}^{(0)} - E_0^{(0)}$.\n- Distribution of $\\Delta$: independent and identically distributed according to a uniform distribution on the interval $[a,b]$.\n- Constant coupling strength: $\\lvert\\langle \\Psi_0 \\lvert \\hat{V} \\rvert \\mu \\rangle\\rvert = v$ for all $\\mu$.\n- The continuum approximation is valid.\n- The energy correction is to be computed using the second-order Rayleigh–Schrödinger expression.\n- Three cases are to be considered for regularizing the denominators: no level shift, a real level shift $s$, and an imaginary level shift $\\eta$ (taking the real part of the final energy).\n- Parameters: $M = 100$, $v = 0.010\\,E_h$, $a = 0.020\\,E_h$, $b = 0.800\\,E_h$, $s = 0.200\\,E_h$, $\\eta = 0.200\\,E_h$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is analyzed against the required criteria.\n1.  **Scientific Grounding**: The problem describes a simplified model Hamiltonian used to study multireference perturbation theory, a standard and well-established method in quantum chemistry. The use of a uniform distribution for energy denominators and constant couplings is a common theoretical simplification to achieve analytical tractability. Level-shifting (with real or imaginary shifts) is a standard technique (e.g., in CASPT2) to handle near-degeneracies and improve convergence. The problem is scientifically sound.\n2.  **Well-Posedness**: The problem is well-posed. It provides a clear objective (compute three energy values) and all necessary parameters and physical assumptions (continuum approximation, uniform distribution) to derive a unique solution for each case.\n3.  **Objectivity**: The problem is stated using precise, objective, and formal scientific language, free from any subjectivity or ambiguity.\n4.  **Completeness and Consistency**: The provided data ($M$, $v$, $a$, $b$, $s$, $\\eta$) are complete and dimensionally consistent (all energies are in units of $E_h$). There are no contradictions.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. It is a well-posed, scientifically grounded problem from theoretical physical chemistry. A solution will be provided.\n\nThe second-order Rayleigh-Schrödinger perturbation theory (RSPT) energy correction for a reference state $\\lvert \\Psi_0 \\rangle$ is given by:\n$$ E^{(2)} = \\sum_{\\mu \\ne 0} \\frac{|\\langle \\Psi_0 | \\hat{V} | \\mu \\rangle|^2}{E_0^{(0)} - E_{\\mu}^{(0)}} $$\nUsing the provided definitions, where $\\Delta_\\mu = E_{\\mu}^{(0)} - E_0^{(0)}$ and $|\\langle \\Psi_0 | \\hat{V} | \\mu \\rangle| = v$, the expression becomes:\n$$ E^{(2)} = -\\sum_{\\mu=1}^{M} \\frac{v^2}{\\Delta_\\mu} $$\nThe problem stipulates the use of the continuum approximation. The summation over $M$ discrete states is replaced by an integral over the energy denominator distribution. The probability density function $P(\\Delta)$ for a uniform distribution on $[a,b]$ is $P(\\Delta) = \\frac{1}{b-a}$ for $\\Delta \\in [a,b]$ and $0$ otherwise. The sum is replaced as follows:\n$$ \\sum_{\\mu=1}^{M} f(\\Delta_\\mu) \\to M \\int_a^b f(\\Delta) P(\\Delta) d\\Delta = \\frac{M}{b-a} \\int_a^b f(\\Delta) d\\Delta $$\n\n**Case 1: No level shift**\nThe function to be integrated is $f(\\Delta) = -\\frac{v^2}{\\Delta}$. The second-order energy is:\n$$ E_{no\\_shift}^{(2)} = \\frac{M}{b-a} \\int_a^b \\left(-\\frac{v^2}{\\Delta}\\right) d\\Delta = -\\frac{M v^2}{b-a} \\int_a^b \\frac{1}{\\Delta} d\\Delta $$\nThe integral evaluates to $\\ln(\\Delta)$, so:\n$$ E_{no\\_shift}^{(2)} = -\\frac{M v^2}{b-a} [\\ln(\\Delta)]_a^b = -\\frac{M v^2}{b-a} \\ln\\left(\\frac{b}{a}\\right) $$\nSubstituting the given numerical values: $M=100$, $v=0.010$, $a=0.020$, $b=0.800$.\n$$ E_{no\\_shift}^{(2)} = -\\frac{100 \\times (0.010)^2}{0.800 - 0.020} \\ln\\left(\\frac{0.800}{0.020}\\right) = -\\frac{0.01}{0.780} \\ln(40) $$\n$$ E_{no\\_shift}^{(2)} \\approx -0.0128205 \\times 3.6888795 \\approx -0.0472933 \\, E_h $$\nRounded to $4$ significant figures, this is $-0.04729 \\, E_h$.\n\n**Case 2: Real level shift of magnitude $s$**\nThe denominator is shifted by a real value $s$. The function becomes $f(\\Delta) = -\\frac{v^2}{\\Delta + s}$.\n$$ E_{real\\_shift}^{(2)} = -\\frac{M v^2}{b-a} \\int_a^b \\frac{1}{\\Delta + s} d\\Delta $$\nThe integral evaluates to $\\ln(\\Delta + s)$:\n$$ E_{real\\_shift}^{(2)} = -\\frac{M v^2}{b-a} [\\ln(\\Delta + s)]_a^b = -\\frac{M v^2}{b-a} \\ln\\left(\\frac{b+s}{a+s}\\right) $$\nSubstituting the numerical values, with $s=0.200$:\n$$ E_{real\\_shift}^{(2)} = -\\frac{100 \\times (0.010)^2}{0.780} \\ln\\left(\\frac{0.800 + 0.200}{0.020 + 0.200}\\right) = -\\frac{0.01}{0.780} \\ln\\left(\\frac{1.000}{0.220}\\right) $$\n$$ E_{real\\_shift}^{(2)} \\approx -0.0128205 \\times \\ln(4.5454...) \\approx -0.0128205 \\times 1.5141278 \\approx -0.0194118 \\, E_h $$\nRounded to $4$ significant figures, this is $-0.01941 \\, E_h$.\n\n**Case 3: Imaginary level shift of magnitude $\\eta$**\nThe denominator is shifted by an imaginary value $i\\eta$. The complex energy is:\n$$ E_{complex}^{(2)} = -\\frac{M v^2}{b-a} \\int_a^b \\frac{1}{\\Delta + i\\eta} d\\Delta $$\nThe physically meaningful energy is the real part, $E_{imag\\_shift}^{(2)} = \\text{Re}(E_{complex}^{(2)})$. We take the real part of the integrand:\n$$ \\text{Re}\\left(\\frac{1}{\\Delta + i\\eta}\\right) = \\text{Re}\\left(\\frac{\\Delta - i\\eta}{(\\Delta + i\\eta)(\\Delta - i\\eta)}\\right) = \\frac{\\Delta}{\\Delta^2 + \\eta^2} $$\nThe energy is therefore:\n$$ E_{imag\\_shift}^{(2)} = -\\frac{M v^2}{b-a} \\int_a^b \\frac{\\Delta}{\\Delta^2 + \\eta^2} d\\Delta $$\nTo solve the integral, we use the substitution $u = \\Delta^2 + \\eta^2$, which gives $du = 2\\Delta d\\Delta$.\n$$ \\int \\frac{\\Delta}{\\Delta^2 + \\eta^2} d\\Delta = \\frac{1}{2} \\int \\frac{1}{u} du = \\frac{1}{2}\\ln(u) = \\frac{1}{2}\\ln(\\Delta^2 + \\eta^2) $$\nThe definite integral is:\n$$ \\int_a^b \\frac{\\Delta}{\\Delta^2 + \\eta^2} d\\Delta = \\frac{1}{2} [\\ln(\\Delta^2 + \\eta^2)]_a^b = \\frac{1}{2} \\ln\\left(\\frac{b^2 + \\eta^2}{a^2 + \\eta^2}\\right) $$\nThe energy correction is:\n$$ E_{imag\\_shift}^{(2)} = -\\frac{M v^2}{2(b-a)} \\ln\\left(\\frac{b^2 + \\eta^2}{a^2 + \\eta^2}\\right) $$\nSubstituting the numerical values, with $\\eta=0.200$:\n$$ E_{imag\\_shift}^{(2)} = -\\frac{100 \\times (0.010)^2}{2(0.780)} \\ln\\left(\\frac{(0.800)^2 + (0.200)^2}{(0.020)^2 + (0.200)^2}\\right) = -\\frac{0.01}{1.56} \\ln\\left(\\frac{0.64 + 0.04}{0.0004 + 0.04}\\right) $$\n$$ E_{imag\\_shift}^{(2)} = -\\frac{0.01}{1.56} \\ln\\left(\\frac{0.68}{0.0404}\\right) \\approx -0.006410256 \\times \\ln(16.83168...) $$\n$$ E_{imag\\_shift}^{(2)} \\approx -0.006410256 \\times 2.823226 \\approx -0.0180998 \\, E_h $$\nRounded to $4$ significant figures, this is $-0.01810 \\, E_h$.\n\nThe three requested energies, in the order (no shift, real shift, imaginary shift), rounded to four significant figures, are $-0.04729\\,E_h$, $-0.01941\\,E_h$, and $-0.01810\\,E_h$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-0.04729 & -0.01941 & -0.01810\n\\end{pmatrix}\n}\n$$", "id": "2654359"}, {"introduction": "The theoretical challenge of intruder states has tangible consequences in practical computations, often appearing as non-physical artifacts on potential energy surfaces. This diagnostic problem [@problem_id:2459118] presents a classic example: a \"bump\" on the CASPT2 potential energy curve for the dissociation of the dinitrogen molecule, a benchmark system for strong correlation. Your task is to apply your understanding of MRPT failure modes to identify the artifact's cause and select the appropriate computational remedy, a crucial skill for any practitioner in the field.", "problem": "A dissociation scan of the nitrogen molecule $\\text{N}_2$ along the bond length $R$ is performed with a Complete Active Space Self-Consistent Field (CASSCF) reference followed by Complete Active Space Second-Order Perturbation Theory (CASPT2). The CASSCF uses an active space of $6$ electrons in $6$ orbitals that comprises the valence $\\sigma$ and $\\pi$ bonding and antibonding orbitals, and it yields a smooth, monotonically decreasing ground-state potential energy curve toward the dissociation limit for the singlet state. In contrast, the CASPT2 correction produces a nonphysical local maximum (\"bump\") in the potential energy surface near a stretched geometry around $R \\approx 2.0\\,\\mathrm{\\AA}$. The active orbital occupations remain physically reasonable along the scan, and basis set convergence with respect to the valence correlation space has been verified at the same levels of theory.\n\nWhich option best identifies the likely physical cause of the CASPT2 \"bump\" and an appropriate remedy within the framework of multireference perturbation theory?\n\nA. Cause: Basis set superposition error due to bond stretching; Remedy: Apply counterpoise correction to the CASPT2 energies.\n\nB. Cause: Intruder states leading to near-zero denominators in the second-order correction; Remedy: Introduce an imaginary level shift or use N-Electron Valence State Second-Order Perturbation Theory (NEVPT2).\n\nC. Cause: Spin contamination of the reference due to unrestricted orbitals; Remedy: Apply spin-projection to the CASSCF reference.\n\nD. Cause: Root flipping from excited-state contamination in a state-averaged reference; Remedy: Reduce the number of averaged states or use a purely state-specific CASSCF.\n\nE. Cause: Overly large active space; Remedy: Remove the antibonding $\\pi_g^\\ast$ orbital from the active space to stabilize the perturbation expansion.", "solution": "The Complete Active Space Second-Order Perturbation Theory (CASPT2) correction is a second-order perturbative treatment applied to a Complete Active Space Self-Consistent Field (CASSCF) zeroth-order wavefunction. In second-order perturbation theory built on a multiconfigurational reference, the energy correction takes the form\n$$\nE^{(2)} \\;=\\; \\sum_{I} \\frac{\\left|\\langle \\Psi_0 \\vert \\hat{H} \\vert \\Psi_I \\rangle \\right|^2}{\\Delta_I} \\,,\n$$\nwhere $\\vert \\Psi_0 \\rangle$ is the reference state, $\\vert \\Psi_I \\rangle$ are orthogonal external configurations, and $\\Delta_I = E_0^{(0)} - E_I^{(0)}$ are energy denominators defined by the chosen zeroth-order Hamiltonian. A well-known failure mode of CASPT2 is the presence of intruder states: external configurations $\\vert \\Psi_I \\rangle$ with $E_I^{(0)} \\approx E_0^{(0)}$, so that $\\Delta_I \\to 0$ and the perturbative amplitudes become anomalously large. As the molecular geometry changes (e.g., upon bond stretching), Rydberg- or charge-transfer-like external configurations can approach quasidegeneracy with the reference, producing sharp, nonphysical features such as spikes or local maxima (\"bumps\") in the potential energy surface.\n\nA principled remedy is to regularize the denominators so that near-degeneracies do not dominate the correction. In CASPT2, this is commonly achieved by adding a shift to the denominators. A popular choice is the imaginary level shift, which effectively replaces $\\Delta_I$ by $\\Delta_I + i \\eta$ with $\\eta > 0$, damping the contribution of small $\\Delta_I$ without introducing discontinuities; the real part of the resulting $E^{(2)}$ is taken as the correlation energy. Alternatively, one can change the zeroth-order Hamiltonian via the Ionization Potential Electron Affinity (IPEA) shift or, more definitively, adopt N-Electron Valence State Second-Order Perturbation Theory (NEVPT2), which uses the Dyall Hamiltonian and yields strictly positive denominators by construction, thereby avoiding intruder states.\n\nWe now assess each option:\n\nA. The basis set superposition error (BSSE) is primarily an intermolecular effect in weakly bound complexes and is not typically the origin of sharp, nonphysical local maxima in intramolecular dissociation curves at the correlated level. Counterpoise correction is not standardly defined or effective for intramolecular bond stretches in this context, and the problem statement indicates that basis set convergence has already been verified. Verdict: Incorrect.\n\nB. Intruder states correspond to near-zero denominators $\\Delta_I$ in $E^{(2)}$, which can produce nonphysical features in the potential energy surface as a function of geometry. Introducing an imaginary level shift (or an appropriate real shift) regularizes small denominators, and switching to N-Electron Valence State Second-Order Perturbation Theory (NEVPT2) avoids intruders by construction. These are appropriate and widely accepted remedies. Verdict: Correct.\n\nC. CASSCF uses spin-adapted configuration state functions and yields an eigenfunction of $\\hat{S}^2$ for the targeted spin state; spin contamination is a concern for unrestricted single-determinant references, not for multiconfigurational spin-adapted references. Spin-projection is not applicable here. Verdict: Incorrect.\n\nD. Root flipping in state-averaged CASSCF can cause discontinuities if the targeted state identity changes along the scan. However, the setup specifies a smooth CASSCF potential and, moreover, identifies a state-specific treatment that already avoids root flipping. Reducing state averaging is therefore not the relevant remedy for the CASPT2-specific bump. Verdict: Incorrect.\n\nE. Removing essential valence antibonding orbitals such as $\\pi_g^\\ast$ from the active space would degrade the description of bond breaking and typically worsen, not improve, the behavior upon dissociation. An \"overly large\" active space is not the cause of intruder states; rather, too small or unbalanced active spaces can exacerbate problems, but the given active space is standard for $\\mathrm{N}_2$. Verdict: Incorrect.\n\nTherefore, the likely cause is intruder states in the CASPT2 expansion, and the appropriate remedy is to employ a level-shift strategy (e.g., an imaginary shift) or to use NEVPT2, which is intruder-state free by construction.", "answer": "$$\\boxed{B}$$", "id": "2459118"}, {"introduction": "While level-shifting can mitigate intruder states in CASPT2, more modern methods like N-Electron Valence State Perturbation Theory (NEVPT2) were designed to be intrinsically free of them. A deeper distinction between these methods lies in their formal properties, such as size-consistency. This computational experiment [@problem_id:2459090] allows you to explore this difference by testing whether the energy of a non-interacting dimer equals the sum of its monomers' energies. Using a carefully constructed toy model, you will demonstrate why NEVPT2 is rigorously size-consistent while standard CASPT2 is not.", "problem": "You will analyze size-consistency using a minimal, fully specified toy model that abstracts two well-known multireference second-order perturbation theories: Complete Active Space Second-Order Perturbation Theory (CASPT2) with a real level shift and N-Electron Valence State Perturbation Theory (NEVPT2). Consider two noninteracting fragments, labeled $A$ and $B$, whose zeroth-order model states are tensor products of their fragment model states. Each fragment $X \\in \\{A,B\\}$ has one external configuration characterized by an energy gap $\\Delta_X &gt; 0$ relative to its fragment model state and a real coupling amplitude $g_X$ between the model and external configuration. Assume the total Hamiltonian is strictly separable, so there are no inter-fragment couplings. Let $s \\ge 0$ denote a real level shift.\n\nFor the NEVPT2 abstraction (Epstein–Nesbet separable construction), define the fragment second-order corrections by\n$$\nE^{(2)}_{\\mathrm{NEV}}(X) = -\\frac{g_X^2}{\\Delta_X},\n$$\nand for the composite noninteracting dimer $AB$,\n$$\nE^{(2)}_{\\mathrm{NEV}}(AB) = -\\frac{g_A^2}{\\Delta_A} - \\frac{g_B^2}{\\Delta_B}.\n$$\nThis construction enforces strong separability by assigning distinct external spaces to $A$-only and $B$-only excitations.\n\nFor the CASPT2-with-level-shift abstraction (internally contracted, level-shifted construction), define the fragment second-order corrections by\n$$\nE^{(2)}_{\\mathrm{CAS}}(X;s) = -\\frac{g_X^2}{\\Delta_X + s}.\n$$\nFor the composite noninteracting dimer $AB$, model internal contraction at the level of a single external class that merges the $A$-only and $B$-only external configurations into one contracted external vector with total coupling $g_A + g_B$ and an effective averaged denominator. Define\n$$\n\\overline{\\Delta}_{AB}(s) = \\frac{\\Delta_A + \\Delta_B}{2} + s,\n\\quad\nE^{(2)}_{\\mathrm{CAS}}(AB;s) = -\\frac{(g_A + g_B)^2}{\\overline{\\Delta}_{AB}(s)}.\n$$\nThis construction models the non-separable effect of internal contraction combined with a global level shift applied to a merged excitation class.\n\nDefine size-consistency for a given method as the statement $E^{(2)}(\\mathrm{AB}) = E^{(2)}(\\mathrm{A}) + E^{(2)}(\\mathrm{B})$. For each parameter set below, evaluate whether size-consistency holds for NEVPT2 and for CASPT2-with-level-shift in the above abstractions, within an absolute tolerance of $\\tau = 1\\times 10^{-12}$. Your program should compute, for each test case, two boolean values:\n- the first indicates whether NEVPT2 is size-consistent,\n- the second indicates whether CASPT2-with-level-shift is size-consistent.\n\nUse the following test suite of parameter values $(\\Delta_A, g_A, \\Delta_B, g_B, s)$:\n1. $(0.8, 0.25, 1.1, 0.18, 0.2)$\n2. $(0.5, 0.3, 1.5, 0.1, 0.05)$\n3. $(0.7, 0.2, 2.0, 0.0, 0.3)$\n4. $(0.5, 0.3, 0.5, 0.3, 1000.0)$\n\nAll quantities are dimensionless. Angles do not appear. No percentages are used.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as\n$[\\text{NEV-1}, \\text{CAS-1}, \\text{NEV-2}, \\text{CAS-2}, \\text{NEV-3}, \\text{CAS-3}, \\text{NEV-4}, \\text{CAS-4}]$,\nwhere each entry is a boolean computed with the absolute tolerance $\\tau = 1\\times 10^{-12}$.", "solution": "The problem statement is subjected to validation and is found to be scientifically grounded, well-posed, and objective. It presents a valid theoretical exercise in computational chemistry, using simplified but sound models to investigate the property of size-consistency in multi-reference perturbation theory. The problem is self-contained and provides all necessary definitions and data for a unique solution. We may therefore proceed with a rigorous analysis.\n\nThe task is to assess the size-consistency of two abstract second-order perturbation theories, NEVPT2 and CASPT2, for a system of two non-interacting fragments, $A$ and $B$. Size-consistency requires that the energy of the composite system (dimer) is the sum of the energies of the individual fragments, i.e., $E^{(2)}(AB) = E^{(2)}(A) + E^{(2)}(B)$. We evaluate this condition for each model. The tolerance for numerical equality is given as $\\tau = 1 \\times 10^{-12}$.\n\nFirst, we analyze the N-Electron Valence State Perturbation Theory (NEVPT2) abstraction.\nThe second-order energy correction for a single fragment $X \\in \\{A, B\\}$ is given by:\n$$\nE^{(2)}_{\\mathrm{NEV}}(X) = -\\frac{g_X^2}{\\Delta_X}\n$$\nThe sum of the fragment energies is therefore:\n$$\nE^{(2)}_{\\mathrm{NEV}}(A) + E^{(2)}_{\\mathrm{NEV}}(B) = \\left(-\\frac{g_A^2}{\\Delta_A}\\right) + \\left(-\\frac{g_B^2}{\\Delta_B}\\right) = -\\frac{g_A^2}{\\Delta_A} - \\frac{g_B^2}{\\Delta_B}\n$$\nThe energy of the non-interacting dimer $AB$ is defined as:\n$$\nE^{(2)}_{\\mathrm{NEV}}(AB) = -\\frac{g_A^2}{\\Delta_A} - \\frac{g_B^2}{\\Delta_B}\n$$\nBy direct comparison, we see that the size-consistency condition\n$$\nE^{(2)}_{\\mathrm{NEV}}(AB) = E^{(2)}_{\\mathrm{NEV}}(A) + E^{(2)}_{\\mathrm{NEV}}(B)\n$$\nis satisfied exactly by definition. The model is constructed to be strictly separable, or \"strongly size-consistent\". The size-consistency error is analytically zero. Thus, for any set of parameters $(\\Delta_A, g_A, \\Delta_B, g_B, s)$ where $\\Delta_A, \\Delta_B > 0$, this model is size-consistent.\n\nNext, we analyze the Complete Active Space Second-Order Perturbation Theory with a real level shift (CASPT2) abstraction.\nThe second-order energy correction for a single fragment $X \\in \\{A, B\\}$ with a level shift $s \\ge 0$ is:\n$$\nE^{(2)}_{\\mathrm{CAS}}(X;s) = -\\frac{g_X^2}{\\Delta_X + s}\n$$\nThe sum of the fragment energies is:\n$$\nE^{(2)}_{\\mathrm{CAS}}(A;s) + E^{(2)}_{\\mathrm{CAS}}(B;s) = -\\frac{g_A^2}{\\Delta_A + s} - \\frac{g_B^2}{\\Delta_B + s}\n$$\nThe energy of the dimer $AB$ is defined using a model of internal contraction with an averaged denominator:\n$$\nE^{(2)}_{\\mathrm{CAS}}(AB;s) = -\\frac{(g_A + g_B)^2}{\\overline{\\Delta}_{AB}(s)} = -\\frac{(g_A + g_B)^2}{\\frac{\\Delta_A + \\Delta_B}{2} + s}\n$$\nThe size-consistency error, $\\delta E$, is the difference between the dimer energy and the sum of fragment energies:\n$$\n\\delta E = E^{(2)}_{\\mathrm{CAS}}(AB;s) - \\left( E^{(2)}_{\\mathrm{CAS}}(A;s) + E^{(2)}_{\\mathrm{CAS}}(B;s) \\right)\n$$\n$$\n\\delta E = \\left( \\frac{g_A^2}{\\Delta_A + s} + \\frac{g_B^2}{\\Delta_B + s} \\right) - \\frac{(g_A + g_B)^2}{\\frac{\\Delta_A + \\Delta_B}{2} + s}\n$$\nThis expression is not, in general, equal to zero. This model is therefore not generally size-consistent. The size-consistency error arises from two features of the model which mimic real CASPT2: the use of a single, averaged denominator for a merged excitation class, and the non-separable nature of the numerator due to internal contraction, modeled here as $(g_A + g_B)^2$. Size-consistency holds only if $|\\delta E| \\le \\tau$. We must evaluate this condition for each test case.\n\nCase 1: $(\\Delta_A, g_A, \\Delta_B, g_B, s) = (0.8, 0.25, 1.1, 0.18, 0.2)$\n- NEVPT2: Size-consistent by definition. Result: True.\n- CASPT2:\n  - $E^{(2)}_{\\mathrm{CAS}}(A;s) + E^{(2)}_{\\mathrm{CAS}}(B;s) = -\\frac{0.25^2}{0.8+0.2} - \\frac{0.18^2}{1.1+0.2} = -0.0625 - \\frac{0.0324}{1.3} \\approx -0.0874230769$\n  - $E^{(2)}_{\\mathrm{CAS}}(AB;s) = -\\frac{(0.25+0.18)^2}{\\frac{0.8+1.1}{2}+0.2} = -\\frac{0.43^2}{1.15} = -\\frac{0.1849}{1.15} \\approx -0.1607826087$\n  - $|\\delta E| \\approx |-0.1607826087 - (-0.0874230769)| \\approx 0.0733595318 \\gg \\tau$. Not size-consistent. Result: False.\n\nCase 2: $(\\Delta_A, g_A, \\Delta_B, g_B, s) = (0.5, 0.3, 1.5, 0.1, 0.05)$\n- NEVPT2: Size-consistent by definition. Result: True.\n- CASPT2:\n  - $E^{(2)}_{\\mathrm{CAS}}(A;s) + E^{(2)}_{\\mathrm{CAS}}(B;s) = -\\frac{0.3^2}{0.5+0.05} - \\frac{0.1^2}{1.5+0.05} = -\\frac{0.09}{0.55} - \\frac{0.01}{1.55} \\approx -0.1700879765$\n  - $E^{(2)}_{\\mathrm{CAS}}(AB;s) = -\\frac{(0.3+0.1)^2}{\\frac{0.5+1.5}{2}+0.05} = -\\frac{0.4^2}{1.05} = -\\frac{0.16}{1.05} \\approx -0.1523809524$\n  - $|\\delta E| \\approx |-0.1523809524 - (-0.1700879765)| \\approx 0.0177070241 \\gg \\tau$. Not size-consistent. Result: False.\n\nCase 3: $(\\Delta_A, g_A, \\Delta_B, g_B, s) = (0.7, 0.2, 2.0, 0.0, 0.3)$\n- NEVPT2: Size-consistent by definition. Result: True.\n- CASPT2: Here, $g_B=0$. The error becomes $\\delta E = g_A^2 \\left( \\frac{1}{\\Delta_A+s} - \\frac{1}{\\frac{\\Delta_A+\\Delta_B}{2}+s} \\right)$. This is non-zero unless $\\Delta_A = \\Delta_B$. Here, $\\Delta_A \\neq \\Delta_B$.\n  - $E^{(2)}_{\\mathrm{CAS}}(A;s) + E^{(2)}_{\\mathrm{CAS}}(B;s) = -\\frac{0.2^2}{0.7+0.3} - \\frac{0^2}{2.0+0.3} = -0.04$\n  - $E^{(2)}_{\\mathrm{CAS}}(AB;s) = -\\frac{(0.2+0)^2}{\\frac{0.7+2.0}{2}+0.3} = -\\frac{0.04}{1.65} \\approx -0.0242424242$\n  - $|\\delta E| \\approx |-0.0242424242 - (-0.04)| \\approx 0.0157575758 \\gg \\tau$. Not size-consistent. Result: False.\n\nCase 4: $(\\Delta_A, g_A, \\Delta_B, g_B, s) = (0.5, 0.3, 0.5, 0.3, 1000.0)$\n- NEVPT2: Size-consistent by definition. Result: True.\n- CASPT2: The shift $s$ is large. In the limit $s \\to \\infty$, the error approaches zero as $\\delta E \\approx -2g_A g_B / s$. For a finite but large $s$, the error is small but non-zero.\n  - $E^{(2)}_{\\mathrm{CAS}}(A;s) + E^{(2)}_{\\mathrm{CAS}}(B;s) = -2 \\frac{0.3^2}{0.5+1000} = -2 \\frac{0.09}{1000.5} \\approx -0.0001799100$\n  - $E^{(2)}_{\\mathrm{CAS}}(AB;s) = -\\frac{(0.3+0.3)^2}{\\frac{0.5+0.5}{2}+1000} = -\\frac{0.6^2}{1000.5} = -\\frac{0.36}{1000.5} \\approx -0.0003598201$\n  - $|\\delta E| \\approx |-0.0003598201 - (-0.0001799100)| \\approx 0.0001799101 \\gg \\tau$. Not size-consistent. Result: False.\n\nIn summary, the NEVPT2 abstraction is size-consistent for all test cases, while the CASPT2 abstraction is not size-consistent for any of the test cases, as the model inherently introduces a size-consistency error that does not vanish under the given conditions.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes the size-consistency of two abstract multireference perturbation\n    theory models (NEVPT2 and CASPT2) for a series of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (delta_A, g_A, delta_B, g_B, s)\n    test_cases = [\n        (0.8, 0.25, 1.1, 0.18, 0.2),\n        (0.5, 0.3, 1.5, 0.1, 0.05),\n        (0.7, 0.2, 2.0, 0.0, 0.3),\n        (0.5, 0.3, 0.5, 0.3, 1000.0),\n    ]\n\n    # Absolute tolerance for checking size-consistency\n    tau = 1.0e-12\n\n    results = []\n    for case in test_cases:\n        delta_A, g_A, delta_B, g_B, s = case\n\n        # --- NEVPT2 Validation ---\n        # The NEVPT2 abstraction defines the dimer energy as the exact sum of\n        # the fragment energies:\n        # E2_NEV(AB) = -g_A^2/delta_A - g_B^2/delta_B\n        # E2_NEV(A) + E2_NEV(B) = (-g_A^2/delta_A) + (-g_B^2/delta_B)\n        # These are analytically identical. The size-consistency error is zero.\n        # Therefore, the result for NEVPT2 is always True.\n        results.append(True)\n\n        # --- CASPT2-with-level-shift Validation ---\n        # Sum of fragment energies\n        E2_CAS_A = -g_A**2 / (delta_A + s)\n        if delta_B > 0: # Avoid division by zero if delta_B was 0, though problem states > 0\n            E2_CAS_B = -g_B**2 / (delta_B + s)\n        else:\n            E2_CAS_B = 0.0\n        \n        sum_E2_CAS = E2_CAS_A + E2_CAS_B\n\n        # Dimer energy\n        delta_AB_bar = (delta_A + delta_B) / 2.0 + s\n        E2_CAS_AB = -(g_A + g_B)**2 / delta_AB_bar\n\n        # Check for size-consistency\n        error_cas = abs(E2_CAS_AB - sum_E2_CAS)\n        is_cas_consistent = error_cas <= tau\n        results.append(is_cas_consistent)\n\n    # Final print statement in the exact required format.\n    # The map(str, ...) converts Python booleans (True, False) to strings.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2459090"}]}