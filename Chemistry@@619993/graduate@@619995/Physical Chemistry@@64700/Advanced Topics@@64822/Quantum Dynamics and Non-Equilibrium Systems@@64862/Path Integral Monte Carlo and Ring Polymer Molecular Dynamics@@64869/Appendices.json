{"hands_on_practices": [{"introduction": "The path integral formalism maps a quantum particle to a classical \"ring polymer,\" a set of beads connected by harmonic springs. The complex, coupled motion of these beads can be dramatically simplified by transforming into a basis of independent harmonic oscillators called normal modes. This fundamental exercise guides you through this transformation, which is essential for understanding the theoretical underpinnings of PIMC and RPMD and for developing efficient simulation algorithms [@problem_id:2659154].", "problem": "Consider a one-dimensional quantum harmonic oscillator of mass $m$ and angular frequency $\\omega$ at inverse temperature $\\beta = 1/(k_{B} T)$. In the imaginary-time path integral discretization with $P$ time slices (beads), which underlies Path Integral Monte Carlo (PIMC) and Ring Polymer Molecular Dynamics (RPMD), the corresponding classical isomorphic $P$-bead ring-polymer Hamiltonian is\n$$\nH_{P}(\\{q_{j},p_{j}\\}_{j=0}^{P-1}) \\;=\\; \\sum_{j=0}^{P-1} \\left[ \\frac{p_{j}^{2}}{2 m} \\;+\\; \\frac{1}{2} m \\omega^{2} q_{j}^{2} \\right] \\;+\\; \\frac{1}{2} m \\omega_{P}^{2} \\sum_{j=0}^{P-1} \\left(q_{j} - q_{j+1}\\right)^{2},\n$$\nwith periodic boundary condition $q_{P} \\equiv q_{0}$ and the ring-polymer frequency $\\omega_{P} = P/(\\beta \\hbar)$. Using only the above Hamiltonian and fundamental linear algebra facts about diagonalization of circulant matrices, do the following:\n\n1) Construct an orthonormal normal-mode transformation on the $P$-bead coordinates that diagonalizes the quadratic form in the positions. Write the decoupled normal-mode Hamiltonian in terms of canonically conjugate normal coordinates and momenta, and identify the effective angular frequency for each normal mode as a function of the mode index $k \\in \\{0,1,\\dots,P-1\\}$.\n\n2) Using the canonical ensemble at the physical inverse temperature $\\beta$, derive an analytical expression for the finite-temperature variance of each normal coordinate, $\\langle Q_{k}^{2} \\rangle$, in closed form.\n\nReport as your final answer a single closed-form expression for $\\langle Q_{k}^{2} \\rangle$ in terms of $k$, $P$, $\\beta$, $\\hbar$, $m$, and $\\omega$. Do not provide any numerical evaluation.", "solution": "The problem is well-posed and scientifically grounded. It constitutes a standard derivation in the theory of path integral simulations. We shall proceed with the solution.\n\nThe problem requires a two-step procedure: first, the diagonalization of the provided ring-polymer Hamiltonian via a normal-mode transformation, and second, the calculation of the canonical variance of the resulting normal-mode coordinates.\n\nThe ring-polymer Hamiltonian is given as:\n$$\nH_{P}(\\{q_{j},p_{j}\\}_{j=0}^{P-1}) \\;=\\; \\sum_{j=0}^{P-1} \\frac{p_{j}^{2}}{2 m} \\;+\\; V(\\{q_{j}\\}_{j=0}^{P-1})\n$$\nwhere the potential energy term is\n$$\nV(\\{q_{j}\\}) \\;=\\; \\sum_{j=0}^{P-1} \\left[ \\frac{1}{2} m \\omega^{2} q_{j}^{2} \\right] \\;+\\; \\frac{1}{2} m \\omega_{P}^{2} \\sum_{j=0}^{P-1} \\left(q_{j} - q_{j+1}\\right)^{2}\n$$\nwith the periodic boundary condition $q_{P} \\equiv q_{0}$ and $\\omega_{P} = P/(\\beta \\hbar)$.\n\nPart 1: Normal-Mode Transformation\n\nWe first focus on diagonalizing the potential energy $V(\\{q_{j}\\})$, which is a quadratic form in the bead positions $\\{q_{j}\\}$. Let us rewrite $V$ to identify the structure of its Hessian matrix. Expanding the second term:\n$$\n\\sum_{j=0}^{P-1} (q_{j} - q_{j+1})^{2} = \\sum_{j=0}^{P-1} (q_{j}^{2} - 2q_{j}q_{j+1} + q_{j+1}^{2}) = 2 \\sum_{j=0}^{P-1} q_{j}^{2} - 2 \\sum_{j=0}^{P-1} q_{j}q_{j+1}\n$$\nwhere we used the periodicity $q_P = q_0$ which implies $\\sum_{j=0}^{P-1} q_{j+1}^{2} = \\sum_{j=0}^{P-1} q_{j}^{2}$.\nSubstituting this back into the expression for $V$:\n$$\nV(\\{q_j\\}) = \\sum_{j=0}^{P-1} \\frac{1}{2} m \\omega^{2} q_{j}^{2} + \\frac{1}{2} m \\omega_{P}^{2} \\left( 2 \\sum_{j=0}^{P-1} q_j^2 - 2 \\sum_{j=0}^{P-1} q_j q_{j+1} \\right)\n$$\n$$\nV(\\{q_j\\}) = \\frac{1}{2} m \\sum_{j=0}^{P-1} \\left[ (\\omega^2 + 2\\omega_P^2) q_j^2 - 2\\omega_P^2 q_j q_{j+1} \\right]\n$$\nThis potential can be expressed in matrix form as $V = \\frac{1}{2} \\mathbf{q}^{T} \\mathbf{A} \\mathbf{q}$, where $\\mathbf{q} = (q_0, q_1, \\dots, q_{P-1})^T$ is the column vector of bead positions and $\\mathbf{A}$ is a $P \\times P$ symmetric matrix. The matrix elements of $\\frac{1}{m}\\mathbf{A}$ are given by:\n$$\n\\left(\\frac{1}{m}\\mathbf{A}\\right)_{ij} = (\\omega^2 + 2\\omega_P^2)\\delta_{ij} - \\omega_P^2(\\delta_{i, j-1} + \\delta_{i, j+1})\n$$\nwhere indices are taken modulo $P$. This is a circulant matrix. Any $P \\times P$ circulant matrix is diagonalized by the Discrete Fourier Transform (DFT). We introduce a set of normal-mode coordinates $\\{Q_{k}\\}$ through an orthonormal transformation $\\mathbf{q} = \\mathbf{T} \\mathbf{Q}$, where $\\mathbf{T}$ is the orthogonal matrix whose columns are the eigenvectors of $\\mathbf{A}$. The eigenvalues of a circulant matrix whose first row is $(c_0, c_1, \\dots, c_{P-1})$ are given by $\\lambda_{k} = \\sum_{j=0}^{P-1} c_j \\exp(i 2\\pi jk/P)$ for $k \\in \\{0, 1, \\dots, P-1\\}$.\nFor the matrix $\\frac{1}{m}\\mathbf{A}$, the first row is $(\\omega^2 + 2\\omega_P^2, -\\omega_P^2, 0, \\dots, 0, -\\omega_P^2)$. The eigenvalues, which we denote by $\\omega_k^2$, are:\n$$\n\\omega_k^2 = (\\omega^2 + 2\\omega_P^2) \\cdot \\exp(0) + (-\\omega_P^2) \\cdot \\exp\\left(\\frac{i 2\\pi k}{P}\\right) + (-\\omega_P^2) \\cdot \\exp\\left(\\frac{i 2\\pi (P-1) k}{P}\\right)\n$$\nUsing $\\exp(i 2\\pi (P-1) k/P) = \\exp(-i 2\\pi k/P)$, we simplify:\n$$\n\\omega_k^2 = \\omega^2 + 2\\omega_P^2 - \\omega_P^2 \\left( \\exp\\left(\\frac{i 2\\pi k}{P}\\right) + \\exp\\left(-\\frac{i 2\\pi k}{P}\\right) \\right)\n$$\n$$\n\\omega_k^2 = \\omega^2 + 2\\omega_P^2 - 2\\omega_P^2 \\cos\\left(\\frac{2\\pi k}{P}\\right) = \\omega^2 + 2\\omega_P^2 \\left(1 - \\cos\\left(\\frac{2\\pi k}{P}\\right)\\right)\n$$\nUsing the half-angle identity $1 - \\cos(2\\theta) = 2\\sin^2(\\theta)$, we obtain the eigenvalues:\n$$\n\\omega_k^2 = \\omega^2 + 4\\omega_P^2 \\sin^2\\left(\\frac{\\pi k}{P}\\right)\n$$\nThese quantities, $\\omega_k^2$, represent the squares of the effective angular frequencies of the normal modes. In the normal-mode basis, the potential energy is diagonal:\n$$\nV = \\frac{1}{2} \\sum_{k=0}^{P-1} m \\omega_k^2 Q_k^2\n$$\nThe kinetic energy term is $K = \\sum_{j=0}^{P-1} p_j^2 / (2m)$. Since the transformation $\\mathbf{q} = \\mathbf{T}\\mathbf{Q}$ is orthonormal ($\\mathbf{T}^T\\mathbf{T} = \\mathbf{I}$), it preserves the inner product. The transformation for momenta must be $\\mathbf{p} = \\mathbf{T}\\mathbf{P}$ to preserve canonical commutation relations, where $\\mathbf{P}$ is the vector of momenta conjugate to $\\mathbf{Q}$. Thus, the kinetic energy becomes:\n$$\nK = \\frac{1}{2m} \\mathbf{p}^T\\mathbf{p} = \\frac{1}{2m} (\\mathbf{T}\\mathbf{P})^T (\\mathbf{T}\\mathbf{P}) = \\frac{1}{2m} \\mathbf{P}^T \\mathbf{T}^T\\mathbf{T} \\mathbf{P} = \\frac{1}{2m} \\mathbf{P}^T\\mathbf{I}\\mathbf{P} = \\sum_{k=0}^{P-1} \\frac{P_k^2}{2m}\n$$\nThe total Hamiltonian in normal-mode coordinates $\\{Q_k, P_k\\}$ is a sum of $P$ independent harmonic oscillators:\n$$\nH_P = \\sum_{k=0}^{P-1} \\left( \\frac{P_k^2}{2m} + \\frac{1}{2}m\\omega_k^2 Q_k^2 \\right)\n$$\nThe effective angular frequency for mode $k$ is $\\omega_k = \\sqrt{\\omega^2 + 4\\omega_P^2 \\sin^2(\\frac{\\pi k}{P})}$.\n\nPart 2: Calculation of the Variance $\\langle Q_k^2 \\rangle$\n\nWe now compute the thermal average of $Q_k^2$ in the canonical ensemble for the classical isomorphic Hamiltonian $H_P$ at inverse temperature $\\beta$. The expectation value of an observable $A$ is given by\n$$\n\\langle A \\rangle = \\frac{\\int d\\mathbf{Q} d\\mathbf{P} \\, A \\, \\exp(-\\beta H_P)}{\\int d\\mathbf{Q} d\\mathbf{P} \\, \\exp(-\\beta H_P)}\n$$\nSince the Hamiltonian is separable, $H_P = \\sum_k H_k$, the calculation for $\\langle Q_k^2 \\rangle$ only involves the degrees of freedom of the $k$-th mode. All other integrals cancel.\n$$\n\\langle Q_k^2 \\rangle = \\frac{\\int dQ_k dP_k \\, Q_k^2 \\, \\exp\\left(-\\beta\\left[\\frac{P_k^2}{2m} + \\frac{1}{2}m\\omega_k^2 Q_k^2\\right]\\right)}{\\int dQ_k dP_k \\, \\exp\\left(-\\beta\\left[\\frac{P_k^2}{2m} + \\frac{1}{2}m\\omega_k^2 Q_k^2\\right]\\right)}\n$$\nThis is a standard problem in classical statistical mechanics. We can apply the equipartition theorem, which states that every quadratic degree of freedom in the Hamiltonian contributes an average energy of $\\frac{1}{2} k_B T = \\frac{1}{2\\beta}$.\nFor the potential energy term of the $k$-th mode, $V_k = \\frac{1}{2}m\\omega_k^2 Q_k^2$, the theorem gives:\n$$\n\\left\\langle \\frac{1}{2} m \\omega_k^2 Q_k^2 \\right\\rangle = \\frac{1}{2\\beta}\n$$\nSince $m$ and $\\omega_k$ are constants for a given mode, we can write:\n$$\n\\frac{1}{2} m \\omega_k^2 \\langle Q_k^2 \\rangle = \\frac{1}{2\\beta}\n$$\nSolving for the variance $\\langle Q_k^2 \\rangle$ yields:\n$$\n\\langle Q_k^2 \\rangle = \\frac{1}{\\beta m \\omega_k^2}\n$$\nSubstituting the expression for $\\omega_k^2$ from Part 1:\n$$\n\\langle Q_k^2 \\rangle = \\frac{1}{\\beta m \\left[ \\omega^2 + 4\\omega_P^2 \\sin^2\\left(\\frac{\\pi k}{P}\\right) \\right]}\n$$\nFinally, substituting $\\omega_P = P/(\\beta\\hbar)$:\n$$\n\\langle Q_k^2 \\rangle = \\frac{1}{\\beta m \\left[ \\omega^2 + 4\\left(\\frac{P}{\\beta\\hbar}\\right)^2 \\sin^2\\left(\\frac{\\pi k}{P}\\right) \\right]}\n$$\nThis expression can be rewritten as:\n$$\n\\langle Q_k^2 \\rangle = \\frac{1}{\\beta m \\omega^2 + \\frac{4m P^2}{\\beta\\hbar^2} \\sin^2\\left(\\frac{\\pi k}{P}\\right)}\n$$\nThis is the final analytical expression for the variance of the $k$-th normal coordinate of the ring polymer.", "answer": "$$\n\\boxed{\\frac{1}{\\beta m \\omega^2 + \\frac{4m P^2}{\\beta\\hbar^2} \\sin^2\\left(\\frac{\\pi k}{P}\\right)}}\n$$", "id": "2659154"}, {"introduction": "A core tenet of the path integral method is that it becomes exact in the limit of an infinite number of beads, $P \\to \\infty$. This exercise provides a concrete, hands-on opportunity to test this convergence by comparing the discretized path integral partition function to the exact quantum result for the harmonic oscillator. By implementing this comparison, you will directly observe and quantify the rate at which the PIMC approximation approaches quantum reality [@problem_id:2659206].", "problem": "Consider a one-dimensional quantum harmonic oscillator of mass $m$ and angular frequency $\\omega$ at inverse temperature $\\beta$. Work in reduced units where Planck’s constant divided by $2\\pi$ is set to $\\hbar = 1$ and Boltzmann’s constant is $k_{\\mathrm{B}} = 1$, so that all quantities are dimensionless. Your task is to derive, implement, and test a comparison between the exact quantum canonical partition function and its imaginary-time path integral discretization as a function of the Trotter number $P$.\n\nStart from the following fundamental bases:\n- The canonical partition function is $Z = \\mathrm{Tr}\\left[e^{-\\beta \\hat{H}}\\right]$ with Hamiltonian $\\hat{H} = \\frac{\\hat{p}^2}{2m} + \\frac{1}{2} m \\omega^2 \\hat{q}^2$.\n- The Trotter factorization and Feynman imaginary-time path integral representation express $Z$ as a limit of $P$-fold factorizations of imaginary-time evolution operators, which for finite $P$ yields a classical configuration integral over a $P$-bead ring polymer with nearest-neighbor harmonic springs and on-bead potential $V(q) = \\frac{1}{2} m \\omega^2 q^2$.\n- For a quadratic action, Gaussian integrals reduce to determinants of the quadratic form.\n\nRequirements:\n1) Derive the exact quantum partition function $Z_{\\mathrm{exact}}(\\beta,\\omega)$ for the one-dimensional harmonic oscillator in these units.\n2) From the discretized imaginary-time path integral with $P$ beads and primitive Trotter splitting, derive an explicit, computable expression $Z_P(\\beta,\\omega)$ in terms of a product over the ring-polymer normal modes for finite $P$ (this is the $P$-level Path Integral Monte Carlo (PIMC) target that true Monte Carlo sampling would estimate; here you will compute it deterministically via the equivalent Gaussian integral).\n3) For each specified test case below, compute $Z_{\\mathrm{exact}}(\\beta,\\omega)$ and $Z_P(\\beta,\\omega)$ for $P \\in \\{1,2,4,8,16,32,64\\}$. Use these to compute the absolute error $|Z_P - Z_{\\mathrm{exact}}|$ for each $P$.\n4) Quantify the convergence rate by fitting a power-law $|Z_P - Z_{\\mathrm{exact}}| \\approx C P^{-r}$ to the last four $P$ values $P \\in \\{8,16,32,64\\}$ using linear least squares on $\\log$-$\\log$ data to extract the exponent $r$.\n5) Implement the above as a complete program that produces the required outputs for the test suite.\n\nUse the following test suite of parameter sets (all dimensionless in the stated units $\\hbar = 1$, $k_{\\mathrm{B}}=1$):\n- Case $1$: $(\\beta,\\omega) = (0.5, 1.0)$.\n- Case $2$: $(\\beta,\\omega) = (1.0, 1.0)$.\n- Case $3$: $(\\beta,\\omega) = (3.0, 1.0)$.\n- Case $4$: $(\\beta,\\omega) = (1.0, 0.5)$.\n\nProgram input: None. All parameters are provided above.\n\nProgram outputs:\n- For each case, output a single float: the fitted convergence exponent $r$ from step $4$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the cases listed above, for example, $[r_1,r_2,r_3,r_4]$.\n- Each $r$ must be reported as a floating-point number. All outputs are unitless due to the choice $\\hbar = 1$, $k_{\\mathrm{B}}=1$.\n\nNumerical guidance and constraints:\n- For numerical stability, evaluate products for $Z_P(\\beta,\\omega)$ using logarithms of eigenmode contributions.\n- Angles used in trigonometric functions must be in radians.\n- No external input or randomness is allowed; your implementation must be deterministic and self-contained.", "solution": "The problem statement has been rigorously validated and is found to be scientifically sound, well-posed, and objective. It is a standard problem in statistical mechanics that admits a unique and verifiable solution. We now proceed with the derivation and implementation as requested. The analysis will be performed in reduced units where Planck's constant divided by $2\\pi$ is $\\hbar=1$ and Boltzmann's constant is $k_{\\mathrm{B}}=1$.\n\nFirst, we derive the exact quantum canonical partition function, $Z_{\\mathrm{exact}}$. The Hamiltonian for the one-dimensional quantum harmonic oscillator is given by $\\hat{H} = \\frac{\\hat{p}^2}{2m} + \\frac{1}{2} m \\omega^2 \\hat{q}^2$. The energy eigenvalues of this system are quantized and given by $E_n = \\hbar \\omega (n + \\frac{1}{2})$, where $n$ is a non-negative integer, $n=0, 1, 2, \\ldots$. In the specified reduced units where $\\hbar=1$, the energy levels are $E_n = \\omega(n + \\frac{1}{2})$. The canonical partition function $Z$ at an inverse temperature $\\beta = 1/(k_{\\mathrm{B}}T)$ is defined as the trace of the Boltzmann operator, $Z = \\mathrm{Tr}[e^{-\\beta \\hat{H}}]$. In the energy eigenbasis, this becomes a sum over all states:\n$$Z_{\\mathrm{exact}} = \\sum_{n=0}^{\\infty} e^{-\\beta E_n} = \\sum_{n=0}^{\\infty} e^{-\\beta \\omega (n + 1/2)}$$\nWe can factor out the ground state contribution and recognize the remaining sum as a geometric series:\n$$Z_{\\mathrm{exact}} = e^{-\\beta \\omega/2} \\sum_{n=0}^{\\infty} (e^{-\\beta \\omega})^n$$\nThe geometric series $\\sum_{n=0}^{\\infty} x^n$ converges to $1/(1-x)$ for $|x|<1$. Here, $x=e^{-\\beta\\omega}$, which is always less than $1$ for positive $\\beta$ and $\\omega$. Thus, the sum evaluates to $1/(1-e^{-\\beta\\omega})$. Substituting this back, we obtain:\n$$Z_{\\mathrm{exact}} = \\frac{e^{-\\beta \\omega/2}}{1 - e^{-\\beta \\omega}} = \\frac{1}{e^{\\beta \\omega/2} - e^{-\\beta \\omega/2}}$$\nThis expression is equivalent to the hyperbolic cosecant function:\n$$Z_{\\mathrm{exact}}(\\beta, \\omega) = \\frac{1}{2\\sinh(\\beta\\omega/2)}$$\nNote that this expression is independent of the mass $m$.\n\nNext, we derive the approximate partition function, $Z_P$, from the discretized imaginary-time path integral formulation. The partition function can be expressed as an integral over closed paths in imaginary time $\\tau \\in [0, \\beta\\hbar]$. Discretizing this time interval into $P$ steps of size $\\epsilon = \\beta/P$ and using the primitive Trotter factorization $e^{-\\beta \\hat{H}} \\approx (e^{-\\epsilon \\hat{V}} e^{-\\epsilon \\hat{T}})^P$ leads to the expression for $Z_P$:\n$$Z_P = \\mathrm{Tr}\\left[ \\left(e^{-\\frac{\\beta}{P}\\hat{T}} e^{-\\frac{\\beta}{P}\\hat{V}}\\right)^P \\right]$$\nInserting complete sets of position eigenstates between the operators results in a classical-like configuration integral over the positions $q_1, q_2, \\ldots, q_P$ of a cyclic polymer chain (a \"ring polymer\"). For a particle of mass $m$, the expression is:\n$$Z_P = \\left(\\frac{mP}{2\\pi\\beta\\hbar^2}\\right)^{P/2} \\int_{-\\infty}^{\\infty} \\! \\dots \\! \\int_{-\\infty}^{\\infty} d\\mathbf{q} \\exp\\left(-\\sum_{i=1}^{P} \\left[ \\frac{mP}{2\\beta\\hbar^2}(q_{i+1}-q_i)^2 + \\frac{\\beta}{P}V(q_i) \\right] \\right)$$\nwhere $q_{P+1} \\equiv q_1$ enforces the ring closure. In our reduced units ($\\hbar=1$) and for the harmonic potential $V(q) = \\frac{1}{2}m\\omega^2 q^2$, the argument of the exponential becomes:\n$$S(\\mathbf{q}) = \\sum_{i=1}^{P} \\left[ \\frac{mP}{2\\beta}(q_{i+1}-q_i)^2 + \\frac{\\beta m\\omega^2}{2P} q_i^2 \\right]$$\nThe integral is a multidimensional Gaussian integral. The term $S(\\mathbf{q})$ can be written as a quadratic form, $S(\\mathbf{q}) = \\frac{1}{2}\\mathbf{q}^T \\mathbf{A} \\mathbf{q}$, where $\\mathbf{q} = (q_1, \\ldots, q_P)^T$ and $\\mathbf{A}$ is a $P \\times P$ symmetric matrix. The elements of $\\mathbf{A}$ are found by expanding the sum:\n$$A_{ij} = m \\left[ \\left(\\frac{2P}{\\beta} + \\frac{\\beta\\omega^2}{P}\\right)\\delta_{ij} - \\frac{P}{\\beta}(\\delta_{i,j+1} + \\delta_{i,j-1}) \\right]$$\nwhere indices are taken modulo $P$. This is a circulant matrix.\nThe general formula for a $d$-dimensional Gaussian integral is $\\int d^d\\mathbf{x} \\exp(-\\frac{1}{2}\\mathbf{x}^T \\mathbf{M} \\mathbf{x}) = (2\\pi)^{d/2} (\\det \\mathbf{M})^{-1/2}$. Applying this to our integral for $Z_P$ gives:\n$$Z_P = \\left(\\frac{mP}{2\\pi\\beta}\\right)^{P/2} (2\\pi)^{P/2} (\\det \\mathbf{A})^{-1/2} = \\left(\\frac{mP}{\\beta}\\right)^{P/2} m^{-P/2} (\\det \\mathbf{A}')^{-1/2} = \\left(\\frac{P}{\\beta}\\right)^{P/2} (\\det \\mathbf{A}')^{-1/2}$$\nwhere $\\mathbf{A}' = \\mathbf{A}/m$. The mass $m$ cancels out, consistent with the exact result. The eigenvalues $\\lambda_k$ of the circulant matrix $\\mathbf{A}'$ are given by the discrete Fourier transform of its first row. For $k=0, 1, \\dots, P-1$:\n$$\\lambda_k = \\left(\\frac{2P}{\\beta} + \\frac{\\beta\\omega^2}{P}\\right) - \\frac{P}{\\beta}e^{2\\pi i k/P} - \\frac{P}{\\beta}e^{-2\\pi i k/P} = \\left(\\frac{2P}{\\beta} + \\frac{\\beta\\omega^2}{P}\\right) - \\frac{2P}{\\beta}\\cos\\left(\\frac{2\\pi k}{P}\\right)$$\nUsing the identity $1-\\cos(2\\theta) = 2\\sin^2(\\theta)$, this simplifies to:\n$$\\lambda_k = \\frac{2P}{\\beta} \\left(1 - \\cos\\left(\\frac{2\\pi k}{P}\\right)\\right) + \\frac{\\beta\\omega^2}{P} = \\frac{4P}{\\beta}\\sin^2\\left(\\frac{\\pi k}{P}\\right) + \\frac{\\beta\\omega^2}{P}$$\nThe determinant is the product of the eigenvalues, $\\det \\mathbf{A}' = \\prod_{k=0}^{P-1} \\lambda_k$. Substituting this into the expression for $Z_P$ yields the final computable formula:\n$$Z_P(\\beta, \\omega) = \\left(\\frac{P}{\\beta}\\right)^{P/2} \\left[ \\prod_{k=0}^{P-1} \\left( \\frac{4P}{\\beta}\\sin^2\\left(\\frac{\\pi k}{P}\\right) + \\frac{\\beta\\omega^2}{P} \\right) \\right]^{-1/2}$$\nFor numerical evaluation, especially for large $P$, it is more stable to compute the logarithm of $Z_P$:\n$$\\log Z_P = \\frac{P}{2} \\log\\left(\\frac{P}{\\beta}\\right) - \\frac{1}{2} \\sum_{k=0}^{P-1} \\log(\\lambda_k)$$\nThis expression is a direct consequence of the path integral formulation and represents the target value for a PIMC simulation.\n\nThe final requirement is to analyze the convergence of $Z_P$ to $Z_{\\mathrm{exact}}$ as $P$ increases. The primitive Trotter approximation introduces an error that scales with the number of beads $P$. We expect a power-law relationship for the absolute error:\n$$|Z_P - Z_{\\mathrm{exact}}| \\approx C P^{-r}$$\nwhere $C$ is a constant and $r$ is the convergence exponent. To determine $r$, we can perform a linear regression on the logarithm of this equation:\n$$\\log|Z_P - Z_{\\mathrm{exact}}| \\approx \\log C - r \\log P$$\nThis is a linear equation of the form $y = b + mx$, with $y = \\log|Z_P - Z_{\\mathrm{exact}}|$, $x = \\log P$, slope $m = -r$, and intercept $b = \\log C$. We will compute the errors for $P \\in \\{1, 2, 4, 8, 16, 32, 64\\}$, and use the last four data points ($P \\in \\{8, 16, 32, 64\\}$) to perform a linear least-squares fit and extract the slope $m$. The convergence exponent is then $r = -m$. For the primitive algorithm used here, theoretical considerations predict that $r=2$. The implementation will calculate this exponent for each test case.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of comparing the exact and path-integral discretized\n    partition functions for a quantum harmonic oscillator.\n    \"\"\"\n\n    # Test cases from the problem statement: (beta, omega)\n    test_cases = [\n        (0.5, 1.0),\n        (1.0, 1.0),\n        (3.0, 1.0),\n        (1.0, 0.5),\n    ]\n\n    # Trotter numbers for the analysis\n    P_values = np.array([1, 2, 4, 8, 16, 32, 64])\n\n    # List to store the final convergence exponents r for each test case\n    convergence_exponents = []\n\n    for beta, omega in test_cases:\n        # 1. Calculate the exact partition function Z_exact\n        # Z_exact = 1 / (2 * sinh(beta * omega / 2))\n        z_exact = 1.0 / (2.0 * np.sinh(beta * omega / 2.0))\n\n        errors = []\n        for P in P_values:\n            # 2. Calculate the discretized path integral partition function Z_P\n            # The formula is derived in the solution text. We compute its logarithm\n            # for numerical stability.\n            # log(Z_P) = (P/2)*log(P/beta) - (1/2)*sum_{k=0}^{P-1}log(lambda_k)\n            # lambda_k = (4P/beta)*sin^2(pi*k/P) + (beta*omega^2)/P\n\n            k_vals = np.arange(P)\n            sin_term = np.sin(np.pi * k_vals / P)**2\n            lambda_k = (4.0 * P / beta) * sin_term + (beta * omega**2 / P)\n            \n            # The logarithm of lambda_k can have -inf if lambda_k is 0,\n            # which does not happen for omega > 0.\n            log_lambda_k_sum = np.sum(np.log(lambda_k))\n\n            log_z_p = (P / 2.0) * np.log(P / beta) - 0.5 * log_lambda_k_sum\n            z_p = np.exp(log_z_p)\n\n            # 3. Compute the absolute error\n            error = np.abs(z_p - z_exact)\n            errors.append(error)\n\n        # 4. Fit the convergence rate r from the last four P values\n        # Model: error = C * P^(-r) => log(error) = log(C) - r * log(P)\n        # We perform a linear fit on log-log data.\n        \n        # Use last four points for the fit: P = {8, 16, 32, 64}\n        fit_P_values = P_values[-4:]\n        fit_errors = np.array(errors[-4:])\n        \n        log_P = np.log(fit_P_values)\n        log_error = np.log(fit_errors)\n\n        # Using numpy's polyfit to find the slope of the linear regression\n        # polyfit returns [slope, intercept] for degree 1\n        slope, _ = np.polyfit(log_P, log_error, 1)\n\n        # The convergence exponent r is the negative of the slope\n        r = -slope\n        convergence_exponents.append(r)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in convergence_exponents)}]\")\n\nsolve()\n```", "id": "2659206"}, {"introduction": "Beyond static properties like the partition function, path integral simulations are used to compute expectation values of physical observables such as kinetic energy. This exercise explores the derivation of the \"primitive\" kinetic energy estimator, which arises naturally from a thermodynamic identity involving the particle mass. Analyzing the variance of this estimator reveals a key practical challenge in path integral simulations and highlights why more sophisticated estimators are often necessary for efficient calculations [@problem_id:2659182].", "problem": "Consider a canonical quantum system of $N$ distinguishable particles in three spatial dimensions at inverse temperature $\\beta \\equiv 1/(k_{B} T)$. Using the primitive Trotter factorization of the Feynman configuration-space path integral, represent the canonical partition function with $P$ time slices (also called beads) as a classical ring-polymer integral in which each quantum particle $i$ is mapped to a closed polymer of $P$ replicas with harmonic nearest-neighbor springs of frequency $\\omega_{P} \\equiv P/(\\beta \\hbar)$. Start from the discretized action that yields the standard classical ring-polymer configurational weight with spring energy and replicated potential, and proceed from first principles as follows:\n\n1) By using the thermodynamic identity that expresses the quantum kinetic energy as a derivative of the partition function with respect to the mass parameters, derive the primitive estimator for the kinetic energy that is obtained directly from the discretized action in the primitive approximation. Your derivation must begin from the mass-derivative identity applied to the $P$-bead partition function and must clearly identify the contributions from the free-particle prefactor and from the ring-polymer spring term.\n\n2) Now specialize to the strictly free-particle case, with vanishing potential energy for all configurations, and identical masses $m_{i} \\equiv m$. Work at fixed $P$ and $\\beta$, and assume exchange effects are neglected. Using a normal-mode decomposition of the ring polymer, compute the exact variance of the primitive kinetic energy estimator at equilibrium under the ring-polymer measure. Your calculation must treat all internal normal modes explicitly and account for the centroid mode. Express your final result in closed form as a function of $N$, $P$, and $\\beta$ in three dimensions. Use units with $k_{B}=1$ so that temperature is measured in energy units, and report the variance in units of energy squared. Do not round your answer.", "solution": "The problem is inspected and found to be valid. It is scientifically grounded in the principles of quantum statistical mechanics and path integral simulations, well-posed, and contains all necessary information for a unique solution. I will proceed with the derivation and calculation.\n\nThe problem is divided into two parts. The first part requires the derivation of the primitive kinetic energy estimator from the path integral partition function. The second part requires the calculation of the variance of this estimator for a system of free particles.\n\nPart 1: Derivation of the Primitive Kinetic Energy Estimator\n\nThe canonical partition function for a quantum system of $N$ distinguishable particles at inverse temperature $\\beta$ can be expressed using the Feynman path integral. By applying a primitive Trotter factorization with $P$ time slices (beads), the partition function $Z$ is approximated by $Z_P$, which is isomorphic to the classical partition function of a system of $N$ ring polymers, each consisting of $P$ beads.\n\nFor a system with particle masses $m_i$, the $P$-bead partition function is given by:\n$$\nZ_P = \\left( \\prod_{i=1}^N \\left(\\frac{m_i P}{2\\pi\\beta\\hbar^2}\\right)^{3P/2} \\right) \\int \\left(\\prod_{i=1}^N \\prod_{s=1}^P d\\mathbf{r}_i^{(s)}\\right) \\exp\\left(-\\beta U_{poly}\\right)\n$$\nwhere $\\mathbf{r}_i^{(s)}$ is the position vector of the $s$-th bead of the $i$-th particle. The effective potential $U_{poly}$ of the classical ring-polymer system is:\n$$\nU_{poly} = \\sum_{s=1}^P \\left( \\sum_{i=1}^N \\frac{m_i \\omega_P^2}{2P} |\\mathbf{r}_i^{(s+1)} - \\mathbf{r}_i^{(s)}|^2 + \\frac{1}{P} V(\\{\\mathbf{r}_j^{(s')}\\}_{j,s'}) \\right)\n$$\nHere, the cyclic boundary condition $\\mathbf{r}_i^{(P+1)} = \\mathbf{r}_i^{(1)}$ applies, and the spring frequency is given as $\\omega_P = P/(\\beta\\hbar)$. The first term in $U_{poly}$ is the total spring potential energy, which we denote as $U_{spring}$. The second term is the replicated external potential.\n\nThe problem states to use the thermodynamic identity relating the quantum kinetic energy $\\langle K \\rangle$ to the derivative of the partition function with respect to mass. Assuming for simplicity that all particles have the same mass $m$, this identity is:\n$$\n\\langle K \\rangle = \\frac{1}{\\beta} \\frac{\\partial \\ln Z_P}{\\partial \\ln m} = \\frac{m}{\\beta} \\frac{\\partial \\ln Z_P}{\\partial m}\n$$\nWe take the logarithm of the partition function $Z_P$:\n$$\n\\ln Z_P = \\frac{3NP}{2} \\ln \\left(\\frac{m P}{2\\pi\\beta\\hbar^2}\\right) + \\ln \\int \\left(\\prod_{i,s} d\\mathbf{r}_i^{(s)}\\right) \\exp\\left(-\\beta U_{poly}(m, \\{\\mathbf{r}\\})\\right)\n$$\n$$\n\\ln Z_P = \\frac{3NP}{2} \\ln m + C + \\ln \\int d\\{\\mathbf{r}\\} \\exp\\left( -\\frac{m P}{2\\beta\\hbar^2} \\sum_{i,s} |\\mathbf{r}_i^{(s+1)} - \\mathbf{r}_i^{(s)}|^2 - \\frac{\\beta}{P} \\sum_s V(\\{\\mathbf{r}\\}_s) \\right)\n$$\nwhere $C$ is a term independent of mass $m$.\n\nNow, we apply the operator $\\frac{m}{\\beta} \\frac{\\partial}{\\partial m}$:\n$$\n\\langle K \\rangle = \\frac{m}{\\beta} \\frac{\\partial}{\\partial m} \\left( \\frac{3NP}{2} \\ln m \\right) + \\frac{m}{\\beta} \\frac{\\partial}{\\partial m} \\left( \\ln \\int d\\{\\mathbf{r}\\} \\exp(-\\beta U_{poly}) \\right)\n$$\nThe first term, arising from the free-particle prefactor, is:\n$$\n\\frac{m}{\\beta} \\left( \\frac{3NP}{2m} \\right) = \\frac{3NP}{2\\beta}\n$$\nThe second term is evaluated using the identity $\\frac{d}{dx} \\ln \\int f(y,x) dy = \\langle \\frac{1}{f}\\frac{\\partial f}{\\partial x} \\rangle$:\n$$\n\\frac{m}{\\beta} \\frac{\\int \\frac{\\partial}{\\partial m} \\exp(-\\beta U_{poly}) d\\{\\mathbf{r}\\}}{\\int \\exp(-\\beta U_{poly}) d\\{\\mathbf{r}\\}} = \\frac{m}{\\beta} \\left\\langle \\frac{\\partial}{\\partial m} (-\\beta U_{poly}) \\right\\rangle = -m \\left\\langle \\frac{\\partial U_{poly}}{\\partial m} \\right\\rangle\n$$\nThe derivative of the effective potential with respect to mass is:\n$$\n\\frac{\\partial U_{poly}}{\\partial m} = \\frac{\\partial}{\\partial m} \\left( \\sum_{i,s} \\frac{m \\omega_P^2}{2P} |\\mathbf{r}_i^{(s+1)} - \\mathbf{r}_i^{(s)}|^2 \\right) = \\sum_{i,s} \\frac{\\omega_P^2}{2P} |\\mathbf{r}_i^{(s+1)} - \\mathbf{r}_i^{(s)}|^2 = \\frac{1}{m} U_{spring}\n$$\nSubstituting this back, the second contribution to $\\langle K \\rangle$ is:\n$$\n-m \\left\\langle \\frac{1}{m} U_{spring} \\right\\rangle = -\\langle U_{spring} \\rangle = -\\left\\langle \\sum_{i=1}^N \\sum_{s=1}^P \\frac{m \\omega_P^2}{2P} |\\mathbf{r}_i^{(s+1)} - \\mathbf{r}_i^{(s)}|^2 \\right\\rangle\n$$\nCombining both contributions, we find the expectation value of the kinetic energy:\n$$\n\\langle K \\rangle = \\frac{3NP}{2\\beta} - \\left\\langle \\sum_{i=1}^N \\sum_{s=1}^P \\frac{m \\omega_P^2}{2P} |\\mathbf{r}_i^{(s+1)} - \\mathbf{r}_i^{(s)}|^2 \\right\\rangle\n$$\nThe primitive kinetic energy estimator, $\\hat{K}_{prim}$, is the function of the configuration $\\{\\mathbf{r}_i^{(s)}\\}$ whose expectation value equals $\\langle K \\rangle$. Therefore, the estimator is:\n$$\n\\hat{K}_{prim}(\\{\\mathbf{r}\\}) = \\frac{3NP}{2\\beta} - \\sum_{i=1}^N \\sum_{s=1}^P \\frac{m \\omega_P^2}{2P} |\\mathbf{r}_i^{(s+1)} - \\mathbf{r}_i^{(s)}|^2\n$$\nThis expression identifies the term from the free-particle prefactor ($\\frac{3NP}{2\\beta}$) and the term from the ring-polymer springs (the sum over squared bead differences).\n\nPart 2: Variance of the Estimator for Free Particles\n\nFor a system of free particles, the external potential $V$ is zero. The effective potential for the ring-polymer system is then just the spring potential, $U_{poly} = U_{spring}$. The estimator is $\\hat{K}_{prim} = \\frac{3NP}{2\\beta} - U_{spring}$. We need to compute its variance at equilibrium:\n$$\n\\text{Var}(\\hat{K}_{prim}) = \\text{Var}\\left(\\frac{3NP}{2\\beta} - U_{spring}\\right) = \\text{Var}(-U_{spring}) = \\text{Var}(U_{spring})\n$$\nThe variance calculation reduces to finding the variance of the total spring energy of the polymers, evaluated in the canonical ensemble defined by the potential $U_{spring}$. The partition function is $Z_P \\propto \\int d\\{\\mathbf{r}\\} \\exp(-\\beta U_{spring})$.\n\nTo compute this variance, we utilize a normal-mode decomposition of the polymer coordinates. For each particle $i$ and spatial dimension $\\alpha \\in \\{x,y,z\\}$, the set of bead coordinates $\\{r_{i\\alpha}^{(s)}\\}_{s=1}^P$ can be transformed into a set of normal-mode coordinates $\\{q_{i\\alpha,k}\\}_{k=0}^{P-1}$. The spring potential $U_{spring}$ diagonalizes in this basis:\n$$\nU_{spring} = \\sum_{i=1}^N \\sum_{\\alpha=x,y,z} \\sum_{s=1}^P \\frac{m\\omega_P^2}{2P} (r_{i\\alpha}^{(s+1)} - r_{i\\alpha}^{(s)})^2 = \\sum_{i,\\alpha} \\sum_{k=0}^{P-1} \\frac{1}{2} M_k \\omega_k^2 |q_{i\\alpha,k}|^2\n$$\nThe frequencies of the internal modes ($k=1, \\dots, P-1$) are $\\omega_k = 2\\omega_P \\sin(\\pi k/P)$, and their effective mass is $M_k=m/P$. The centroid mode, $k=0$, corresponds to the center-of-mass of the polymer. Its frequency is $\\omega_0=0$, reflecting the fact that for free particles, the centroid diffuses freely and does not contribute to the spring potential. Thus, the estimator $\\hat{K}_{prim}$ and its variance are independent of the centroid's motion.\n$$\nU_{spring} = \\sum_{i=1}^N \\sum_{\\alpha=x,y,z} \\sum_{k=1}^{P-1} \\frac{1}{2} m \\left(2 \\omega_P \\sin\\left(\\frac{\\pi k}{P}\\right)\\right)^2 |q'_{i\\alpha,k}|^2\n$$\nwhere $q'$ are mass-weighted normal modes.\nCrucially, the total spring potential $U_{spring}$ is a sum of quadratic terms in independent normal mode coordinates. The Boltzmann weight $\\exp(-\\beta U_{spring})$ is therefore a product of Gaussian distributions for each normal mode coordinate. This means that $U_{spring}$ is a sum of energies of independent classical harmonic oscillators at inverse temperature $\\beta$.\n\nWe must count the total number of such independent harmonic oscillator modes. For each of the $N$ particles, there are $3$ spatial dimensions. For each of these $3N$ independent polymers, there are $P-1$ internal normal modes. (For even $P$, one mode at $k=P/2$ is non-degenerate, while for $k<P/2$ they are doubly degenerate; for odd $P$, all $k>0$ modes are doubly degenerate. In either case, the total number of real internal degrees of freedom is $P-1$). Thus, the total number of independent quadratic degrees of freedom contributing to $U_{spring}$ is $M = 3N(P-1)$.\n\nLet $U_{spring} = \\sum_{j=1}^{M} u_j$, where each $u_j$ is the potential energy of one of these classical harmonic oscillator modes. According to the equipartition theorem, the average potential energy for a single classical harmonic oscillator at thermal equilibrium is $\\langle u_j \\rangle = \\frac{1}{2} k_B T = \\frac{1}{2\\beta}$ (with $k_B=1$).\nThe variance of the potential energy for a single classical harmonic oscillator is $\\text{Var}(u_j) = \\langle u_j^2 \\rangle - \\langle u_j \\rangle^2$. Using the Gaussian integral moments for the underlying coordinate, one finds $\\langle u_j \\rangle = \\frac{1}{2\\beta}$ and $\\langle u_j^2 \\rangle = \\frac{3}{4\\beta^2}$, which gives $\\text{Var}(u_j) = \\frac{3}{4\\beta^2} - (\\frac{1}{2\\beta})^2 = \\frac{1}{2\\beta^2}$.\n\nSince the normal modes are independent, the variance of the sum is the sum of the variances:\n$$\n\\text{Var}(U_{spring}) = \\text{Var}\\left(\\sum_{j=1}^{M} u_j\\right) = \\sum_{j=1}^{M} \\text{Var}(u_j)\n$$\nSubstituting $M = 3N(P-1)$ and $\\text{Var}(u_j) = \\frac{1}{2\\beta^2}$:\n$$\n\\text{Var}(\\hat{K}_{prim}) = \\text{Var}(U_{spring}) = \\sum_{j=1}^{3N(P-1)} \\frac{1}{2\\beta^2} = \\frac{3N(P-1)}{2\\beta^2}\n$$\nThe final result is obtained by summing the variance contributions from all $3N(P-1)$ independent internal modes of the ring polymers. The units are $1/\\beta^2$, which is energy squared, as required.", "answer": "$$\n\\boxed{\\frac{3N(P-1)}{2\\beta^2}}\n$$", "id": "2659182"}]}