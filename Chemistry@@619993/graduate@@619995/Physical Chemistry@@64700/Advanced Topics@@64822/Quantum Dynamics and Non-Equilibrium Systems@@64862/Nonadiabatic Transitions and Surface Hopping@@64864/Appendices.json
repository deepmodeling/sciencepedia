{"hands_on_practices": [{"introduction": "Understanding nonadiabatic transitions begins with a clear picture of the potential energy surfaces ($PESs$) involved. Where the Born-Oppenheimer approximation breaks down, typically at an 'avoided crossing', the adiabatic $PESs$ approach each other closely, and the nonadiabatic coupling that drives transitions becomes sharply peaked. This foundational exercise [@problem_id:2655278] walks you through the analysis of a classic two-state model, allowing you to derive the adiabatic surfaces and the derivative coupling from first principles.", "problem": "A diatomic molecule is modeled near an avoided crossing by a two-state diabatic electronic Hamiltonian that depends on a single nuclear coordinate $R$,\n$$\nH_{e}(R)=\\begin{pmatrix}\n\\alpha R & V\\\\\nV & -\\alpha R\n\\end{pmatrix},\n$$\nwhere $\\alpha$ and $V$ are real constants with the dimensions of energy per unit length and energy, respectively. Within the Born–Oppenheimer (BO) separation of electronic and nuclear motion, the adiabatic potential energy surfaces are defined as the eigenvalues of the electronic Hamiltonian at fixed $R$, and the corresponding adiabatic electronic states are the associated eigenvectors. Starting from the definition of adiabatic states as stationary solutions of the time-independent electronic Schrödinger equation at fixed $R$, and from the basic properties of Hermitian matrices and their eigenproblems:\n\n- Derive the analytic forms of the two adiabatic potential energy surfaces $E_{+}(R)$ and $E_{-}(R)$ by diagonalizing $H_{e}(R)$.\n- Define the adiabatic energy gap $\\Delta E(R)=E_{+}(R)-E_{-}(R)$ and determine the nuclear coordinate $R_{\\min}$ at which this gap is minimized. Compute the corresponding minimum value $\\Delta E_{\\min}$.\n- Using the adiabatic eigenvectors, introduce a mixing angle $\\theta(R)$ that parameterizes the adiabatic states in terms of the diabatic basis and express the nonadiabatic derivative coupling $d_{12}(R)=\\langle \\phi_{1}(R)|\\partial/\\partial R|\\phi_{2}(R)\\rangle$ in terms of $\\theta(R)$ and its derivative. Determine where $|d_{12}(R)|$ attains its maximum and extract from your expressions a characteristic length scale in $R$ that quantifies the spatial extent of the avoided crossing region.\n- Expand $E_{-}(R)$ to second order about $R=R_{\\min}$ to obtain the local curvature there, and interpret the sign of the curvature in terms of the local shape of the lower adiabatic surface.\n\nReport, as your final answer, the closed-form expression for the minimum adiabatic gap $\\Delta E_{\\min}$ in terms of $\\alpha$ and $V$. No numerical evaluation is required, and no units should be reported in the final answer.", "solution": "The problem as stated is scientifically grounded, well-posed, objective, and self-contained. It addresses fundamental concepts of nonadiabatic dynamics using a standard two-state model Hamiltonian. The problem is valid, and a full solution can be constructed.\n\nThe diabatic electronic Hamiltonian is given by\n$$\nH_{e}(R)=\\begin{pmatrix}\n\\alpha R & V\\\\\nV & -\\alpha R\n\\end{pmatrix}\n$$\nwhere $R$ is the nuclear coordinate, and $\\alpha$ and $V$ are real constants.\n\nThe adiabatic potential energy surfaces, which I denote $E_{\\pm}(R)$, are the eigenvalues of $H_{e}(R)$. To find these, we solve the characteristic equation $\\det(H_{e}(R) - E \\cdot I) = 0$, where $I$ is the $2 \\times 2$ identity matrix.\n$$\n\\det \\begin{pmatrix}\n\\alpha R - E & V\\\\\nV & -\\alpha R - E\n\\end{pmatrix} = 0\n$$\n$$\n(\\alpha R - E)(-\\alpha R - E) - V^2 = 0\n$$\n$$\n-(\\alpha R)^2 - \\alpha R E + \\alpha R E + E^2 - V^2 = 0\n$$\n$$\nE^2 = (\\alpha R)^2 + V^2\n$$\nThe two eigenvalues are therefore:\n$$\nE_{\\pm}(R) = \\pm \\sqrt{(\\alpha R)^2 + V^2}\n$$\nThese are the analytical forms of the two adiabatic potential energy surfaces. We define $E_{+}(R) = \\sqrt{(\\alpha R)^2 + V^2}$ as the upper surface and $E_{-}(R) = -\\sqrt{(\\alpha R)^2 + V^2}$ as the lower surface.\n\nNext, we define the adiabatic energy gap $\\Delta E(R)$ as the difference between the two surfaces:\n$$\n\\Delta E(R) = E_{+}(R) - E_{-}(R) = \\sqrt{(\\alpha R)^2 + V^2} - (-\\sqrt{(\\alpha R)^2 + V^2}) = 2\\sqrt{(\\alpha R)^2 + V^2}\n$$\nTo find the nuclear coordinate $R_{\\min}$ where this gap is minimized, we must find the minimum of the function $\\Delta E(R)$. This is equivalent to minimizing the expression under the square root, $f(R) = (\\alpha R)^2 + V^2$. We find the extremum by setting the first derivative with respect to $R$ to zero:\n$$\n\\frac{d f(R)}{dR} = \\frac{d}{dR}((\\alpha R)^2 + V^2) = 2\\alpha^2 R = 0\n$$\nThis condition is satisfied only at $R = 0$. The second derivative $\\frac{d^2 f(R)}{dR^2} = 2\\alpha^2$ is positive (assuming $\\alpha \\neq 0$), confirming that $R_{\\min} = 0$ is a minimum.\nThe minimum value of the adiabatic gap is found by substituting $R_{\\min} = 0$ into the expression for $\\Delta E(R)$:\n$$\n\\Delta E_{\\min} = \\Delta E(0) = 2\\sqrt{(\\alpha \\cdot 0)^2 + V^2} = 2\\sqrt{V^2} = 2|V|\n$$\nSince $V$ is a real constant, the absolute value is necessary for full mathematical rigor.\n\nNow, we introduce a mixing angle $\\theta(R)$ to parameterize the adiabatic states. The adiabatic states are the eigenvectors of $H_e(R)$. They are related to the diabatic basis states, $|d_1\\rangle = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$ and $|d_2\\rangle = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$, by a rotation. We define the adiabatic states as:\n$$\n|\\phi_1(R)\\rangle = |\\phi_-(R)\\rangle = \\begin{pmatrix} -\\sin(\\theta(R)) \\\\ \\cos(\\theta(R)) \\end{pmatrix}\n$$\n$$\n|\\phi_2(R)\\rangle = |\\phi_+(R)\\rangle = \\begin{pmatrix} \\cos(\\theta(R)) \\\\ \\sin(\\theta(R)) \\end{pmatrix}\n$$\nThis choice ensures the states are orthonormal. For these to be eigenvectors, the Hamiltonian represented in this basis must be diagonal. The condition for diagonalization is that the off-diagonal element of the transformed Hamiltonian $U^{\\dagger} H_e U$ is zero, where $U(R)$ is the rotation matrix whose columns are the eigenvectors. This leads to the relation:\n$$\n\\tan(2\\theta(R)) = \\frac{V}{\\alpha R}\n$$\nThe nonadiabatic derivative coupling is $d_{12}(R)=\\langle \\phi_{1}(R)|\\partial/\\partial R|\\phi_{2}(R)\\rangle$. We calculate the derivative of $|\\phi_2(R)\\rangle$:\n$$\n\\frac{\\partial}{\\partial R}|\\phi_2(R)\\rangle = \\frac{\\partial}{\\partial R}\\begin{pmatrix} \\cos(\\theta(R)) \\\\ \\sin(\\theta(R)) \\end{pmatrix} = \\frac{d\\theta}{dR} \\begin{pmatrix} -\\sin(\\theta(R)) \\\\ \\cos(\\theta(R)) \\end{pmatrix} = \\frac{d\\theta}{dR}|\\phi_1(R)\\rangle\n$$\nSubstituting this into the definition of the coupling:\n$$\nd_{12}(R) = \\left\\langle \\phi_1(R) \\middle| \\frac{d\\theta}{dR} \\middle| \\phi_1(R) \\right\\rangle = \\frac{d\\theta}{dR} \\langle \\phi_1(R) | \\phi_1(R) \\rangle = \\frac{d\\theta}{dR}\n$$\nTo find $\\frac{d\\theta}{dR}$, we differentiate $\\tan(2\\theta) = V/(\\alpha R)$ with respect to $R$:\n$$\n\\sec^2(2\\theta) \\cdot 2\\frac{d\\theta}{dR} = -\\frac{V}{\\alpha R^2}\n$$\n$$\n\\frac{d\\theta}{dR} = -\\frac{V}{2\\alpha R^2 \\sec^2(2\\theta)} = -\\frac{V \\cos^2(2\\theta)}{2\\alpha R^2}\n$$\nFrom the relation $\\tan(2\\theta) = V/(\\alpha R)$, we find $\\cos^2(2\\theta) = \\frac{(\\alpha R)^2}{(\\alpha R)^2+V^2}$. Substituting this gives:\n$$\nd_{12}(R) = -\\frac{V}{2\\alpha R^2} \\frac{(\\alpha R)^2}{(\\alpha R)^2+V^2} = -\\frac{V\\alpha}{2((\\alpha R)^2+V^2)}\n$$\nThe magnitude of the coupling is $|d_{12}(R)| = \\frac{|V\\alpha|}{2((\\alpha R)^2+V^2)}$. This function is a Lorentzian centered at $R=0$. Its maximum value occurs where the denominator is minimum, which is at $R=0$. The spatial extent of this coupling region is characterized by its width. The function drops to half its maximum value when $(\\alpha R)^2 = V^2$, or $|R| = |V/\\alpha|$. Thus, a characteristic length scale for the avoided crossing region is\n$$\nL = \\frac{|V|}{|\\alpha|}\n$$\nThis length scale, with dimensions of length, quantifies how rapidly the character of the adiabatic states changes from one diabatic state to the other.\n\nFinally, we expand $E_{-}(R) = -\\sqrt{(\\alpha R)^2 + V^2}$ to second order around $R_{\\min}=0$. This is a Taylor expansion.\n$$\nE_{-}(R) \\approx E_{-}(0) + \\left.\\frac{dE_{-}}{dR}\\right|_{R=0} R + \\frac{1}{2} \\left.\\frac{d^2E_{-}}{dR^2}\\right|_{R=0} R^2\n$$\nWe have $E_{-}(0) = -|V|$. The first derivative is:\n$$\n\\frac{dE_{-}}{dR} = -\\frac{1}{2}((\\alpha R)^2 + V^2)^{-1/2}(2\\alpha^2 R) = -\\frac{\\alpha^2 R}{\\sqrt{(\\alpha R)^2 + V^2}}\n$$\nAt $R=0$, $\\left.\\frac{dE_{-}}{dR}\\right|_{R=0} = 0$, as expected for an extremum. The second derivative is:\n$$\n\\frac{d^2E_{-}}{dR^2} = -\\alpha^2 \\frac{d}{dR} \\left( R ((\\alpha R)^2 + V^2)^{-1/2} \\right) = -\\alpha^2 \\left( \\frac{1}{\\sqrt{(\\alpha R)^2+V^2}} - \\frac{\\alpha^2 R^2}{((\\alpha R)^2+V^2)^{3/2}} \\right)\n$$\n$$\n\\frac{d^2E_{-}}{dR^2} = -\\alpha^2 \\frac{((\\alpha R)^2+V^2) - \\alpha^2 R^2}{((\\alpha R)^2+V^2)^{3/2}} = -\\frac{\\alpha^2 V^2}{((\\alpha R)^2+V^2)^{3/2}}\n$$\nThe local curvature at $R=0$ is the value of this second derivative at $R=0$:\n$$\n\\left.\\frac{d^2E_{-}}{dR^2}\\right|_{R=0} = -\\frac{\\alpha^2 V^2}{(V^2)^{3/2}} = -\\frac{\\alpha^2 V^2}{|V|^3} = -\\frac{\\alpha^2}{|V|}\n$$\nThe sign of the curvature is negative (as $\\alpha^2 \\ge 0$ and $|V|>0$). A negative curvature at a point with zero first derivative indicates a local maximum. Therefore, the lower adiabatic surface $E_{-}(R)$ has a barrier at the avoided crossing point $R=0$. This is a characteristic feature of this model, where the repulsion between the two energy levels pushes the lower level down less strongly at the crossing point than away from it, creating a local maximum.", "answer": "$$\n\\boxed{2|V|}\n$$", "id": "2655278"}, {"introduction": "After a nonadiabatic event is triggered, a surface hopping algorithm must update the nuclear momenta to reflect the change in potential energy while conserving total energy. This practice [@problem_id:2655257] focuses on this critical step, guiding you through the derivation of the momentum rescaling rule used in the popular Fewest-Switches Surface Hopping (FSSH) method. By working through the derivation, you will not only understand the mechanics of the hop but also uncover the conditions for a 'frustrated hop,' a physically important scenario where a proposed transition is energetically forbidden.", "problem": "Consider a system of $N$ coupled nuclear degrees of freedom in atomic units with a symmetric positive-definite mass matrix $M \\in \\mathbb{R}^{N \\times N}$ and nuclear momentum $p \\in \\mathbb{R}^{N}$ evolving on adiabatic electronic state $i$. At a geometry $R$, the system attempts a nonadiabatic transition (hop) to state $j$ with energy difference $\\Delta E = E_{j}(R) - E_{i}(R)$, where $E_{i}(R)$ and $E_{j}(R)$ are the adiabatic electronic energies. Let $d_{ij}(R) \\in \\mathbb{R}^{N}$ denote the nonadiabatic coupling vector at the hop point.\n\nAssume the following modeling principles of fewest-switches surface hopping: (i) total energy is conserved at the hop, (ii) only the component of the nuclear momentum along the nonadiabatic coupling direction is adjusted, and (iii) among all such adjustments that conserve energy, the one with the minimal change in momentum magnitude is selected. These principles imply an admissible update of the form $p' = p + \\alpha\\, M d_{ij}(R)$ for some scalar $\\alpha \\in \\mathbb{R}$, where $p'$ is the post-hop momentum.\n\nStarting only from the quadratic form of the kinetic energy $T(p) = \\tfrac{1}{2} p^{\\mathsf{T}} M^{-1} p$ and the energy conservation requirement $T(p') + E_{j}(R) = T(p) + E_{i}(R)$, derive the closed-form expression for $p'$ and the scalar discriminant whose sign determines whether a real-valued $\\alpha$ exists. A hop is said to be frustrated if no real-valued $\\alpha$ satisfies energy conservation under the stated admissibility.\n\nExpress your final answer as a pair consisting of the updated momentum $p'$ and the discriminant $D$ in terms of $M$, $p$, $d_{ij}(R)$, and $\\Delta E$. You may use the sign function $\\operatorname{sgn}(\\cdot)$ to encode the minimal-change choice. No numerical evaluation is required. Provide your result as a single symbolic expression.", "solution": "The problem requires the derivation of the updated nuclear momentum, $p'$, and an associated discriminant, $D$, under the principles of fewest-switches surface hopping. The derivation begins with the fundamental principle of total energy conservation.\n\nThe total energy before the hop is $E_{total} = T(p) + E_{i}(R)$ and after the hop is $E'_{total} = T(p') + E_{j}(R)$. The kinetic energies are given by the quadratic form $T(p) = \\frac{1}{2} p^{\\mathsf{T}} M^{-1} p$.\nPrinciple (i), conservation of total energy, requires $E_{total} = E'_{total}$:\n$$T(p) + E_{i}(R) = T(p') + E_{j}(R)$$\nRearranging this equation gives the change in kinetic energy:\n$$T(p') - T(p) = E_{i}(R) - E_{j}(R) = -\\Delta E$$\nSubstituting the definition of the kinetic energy function:\n$$\\frac{1}{2} (p')^{\\mathsf{T}} M^{-1} p' - \\frac{1}{2} p^{\\mathsf{T}} M^{-1} p = -\\Delta E$$\nPrinciple (ii) states that the updated momentum $p'$ has the form $p' = p + \\alpha M d_{ij}$ for some scalar $\\alpha \\in \\mathbb{R}$, where $d_{ij}$ is a shorthand for $d_{ij}(R)$. We substitute this expression for $p'$ into the energy conservation equation:\n$$\\frac{1}{2} (p + \\alpha M d_{ij})^{\\mathsf{T}} M^{-1} (p + \\alpha M d_{ij}) - \\frac{1}{2} p^{\\mathsf{T}} M^{-1} p = -\\Delta E$$\nWe expand the first term. Since the mass matrix $M$ is symmetric ($M^{\\mathsf{T}} = M$), we have:\n$$(p + \\alpha M d_{ij})^{\\mathsf{T}} M^{-1} (p + \\alpha M d_{ij}) = (p^{\\mathsf{T}} + \\alpha d_{ij}^{\\mathsf{T}} M^{\\mathsf{T}}) M^{-1} (p + \\alpha M d_{ij})$$\n$$= (p^{\\mathsf{T}} + \\alpha d_{ij}^{\\mathsf{T}} M) (M^{-1}p + \\alpha d_{ij})$$\n$$= p^{\\mathsf{T}} M^{-1} p + \\alpha p^{\\mathsf{T}} d_{ij} + \\alpha d_{ij}^{\\mathsf{T}} M M^{-1} p + \\alpha^2 d_{ij}^{\\mathsf{T}} M d_{ij}$$\nThe two middle terms are equal because $d_{ij}^{\\mathsf{T}} p = (p^{\\mathsf{T}} d_{ij})^{\\mathsf{T}}$, and since this is a scalar, it is equal to its transpose $p^{\\mathsf{T}} d_{ij}$. The expansion simplifies to:\n$$p^{\\mathsf{T}} M^{-1} p + 2\\alpha (p^{\\mathsf{T}} d_{ij}) + \\alpha^2 (d_{ij}^{\\mathsf{T}} M d_{ij})$$\nSubstituting this back into the energy equation:\n$$\\frac{1}{2} \\left[ p^{\\mathsf{T}} M^{-1} p + 2\\alpha (p^{\\mathsf{T}} d_{ij}) + \\alpha^2 (d_{ij}^{\\mathsf{T}} M d_{ij}) \\right] - \\frac{1}{2} p^{\\mathsf{T}} M^{-1} p = -\\Delta E$$\nThe $p^{\\mathsf{T}} M^{-1} p$ terms cancel:\n$$\\alpha (p^{\\mathsf{T}} d_{ij}) + \\frac{1}{2} \\alpha^2 (d_{ij}^{\\mathsf{T}} M d_{ij}) = -\\Delta E$$\nThis can be rearranged into a standard quadratic equation for $\\alpha$ of the form $A_q \\alpha^2 + B_q \\alpha + C_q = 0$:\n$$\\left( \\frac{1}{2} d_{ij}^{\\mathsf{T}} M d_{ij} \\right) \\alpha^2 + \\left( p^{\\mathsf{T}} d_{ij} \\right) \\alpha + \\Delta E = 0$$\nThe coefficients are:\n$A_q = \\frac{1}{2} d_{ij}^{\\mathsf{T}} M d_{ij}$\n$B_q = p^{\\mathsf{T}} d_{ij}$\n$C_q = \\Delta E$\n\nA real-valued solution for $\\alpha$ exists if and only if the discriminant of this quadratic equation is non-negative. This is the discriminant requested by the problem. Let us call it $D$.\n$$D = B_q^2 - 4 A_q C_q = (p^{\\mathsf{T}} d_{ij})^2 - 4 \\left( \\frac{1}{2} d_{ij}^{\\mathsf{T}} M d_{ij} \\right) (\\Delta E)$$\n$$D = (p^{\\mathsf{T}} d_{ij})^2 - 2 \\Delta E (d_{ij}^{\\mathsf{T}} M d_{ij})$$\nA hop is frustrated if $D < 0$, as no real $\\alpha$ can satisfy energy conservation.\nIf $D \\ge 0$, the solutions for $\\alpha$ are given by the quadratic formula:\n$$\\alpha = \\frac{-B_q \\pm \\sqrt{D}}{2 A_q} = \\frac{-(p^{\\mathsf{T}} d_{ij}) \\pm \\sqrt{(p^{\\mathsf{T}} d_{ij})^2 - 2 \\Delta E (d_{ij}^{\\mathsf{T}} M d_{ij})}}{d_{ij}^{\\mathsf{T}} M d_{ij}}$$\nPrinciple (iii) requires selecting the solution that corresponds to the minimal change in momentum magnitude. The change in momentum is $\\Delta p = p' - p = \\alpha M d_{ij}$. Its magnitude is determined by $|\\alpha|$, as $\\| \\Delta p \\| = \\| \\alpha M d_{ij} \\| = |\\alpha| \\cdot \\| M d_{ij} \\|$. To minimize the change, we must select the root $\\alpha$ with the smaller absolute value.\n\nLet the two roots be $\\alpha_1 = \\frac{-B_q + \\sqrt{D}}{2A_q}$ and $\\alpha_2 = \\frac{-B_q - \\sqrt{D}}{2A_q}$.\nWe analyze which root has a smaller magnitude by considering the sign of $B_q = p^{\\mathsf{T}} d_{ij}$.\nThe coefficient $A_q = \\frac{1}{2} d_{ij}^{\\mathsf{T}} M d_{ij}$ is strictly positive because $M$ is positive-definite and $d_{ij}$ is non-zero.\n- If $B_q > 0$, then $-B_q$ is negative. The numerator of $\\alpha_2$ is $-B_q - \\sqrt{D}$, which is a sum of two negative numbers (since $\\sqrt{D} \\ge 0$). The numerator of $\\alpha_1$ is $-B_q + \\sqrt{D}$, which represents a difference. Thus, $|-B_q + \\sqrt{D}| < |-B_q - \\sqrt{D}|$, which means $|\\alpha_1| < |\\alpha_2|$. The correct choice is $\\alpha_1$.\n- If $B_q < 0$, then $-B_q$ is positive. The numerator of $\\alpha_1$ is $-B_q + \\sqrt{D}$, a sum of two positive numbers. The numerator of $\\alpha_2$ is $-B_q - \\sqrt{D}$, a difference. Thus, $|-B_q - \\sqrt{D}| < |-B_q + \\sqrt{D}|$, and $|\\alpha_2| < |\\alpha_1|$. The correct choice is $\\alpha_2$.\n- If $B_q = 0$, the two roots are $\\alpha = \\pm \\frac{\\sqrt{D}}{2A_q}$, which have equal magnitude. The principle of minimal change is insufficient to yield a unique choice. However, the problem's allowance of the $\\operatorname{sgn}(\\cdot)$ function suggests adopting a convention.\n\nThe choice of root can be expressed compactly using the sign function, $\\operatorname{sgn}(B_q)$.\nThe chosen root has the form $\\frac{-B_q + \\operatorname{sgn}(B_q) \\sqrt{D}}{2 A_q}$.\n- If $B_q > 0$, $\\operatorname{sgn}(B_q)=1$, we get $\\frac{-B_q + \\sqrt{D}}{2A_q}$, which is $\\alpha_1$.\n- If $B_q < 0$, $\\operatorname{sgn}(B_q)=-1$, we get $\\frac{-B_q - \\sqrt{D}}{2A_q}$, which is $\\alpha_2$.\n- If $B_q = 0$, defining $\\operatorname{sgn}(0)=1$ provides a unique choice, $\\alpha = \\frac{\\sqrt{D}}{2A_q}$. This resolves the ambiguity.\n\nSo, the selected value of $\\alpha$ is:\n$$\\alpha = \\frac{-(p^{\\mathsf{T}} d_{ij}) + \\operatorname{sgn}(p^{\\mathsf{T}} d_{ij}) \\sqrt{(p^{\\mathsf{T}} d_{ij})^2 - 2 \\Delta E (d_{ij}^{\\mathsf{T}} M d_{ij})}}{d_{ij}^{\\mathsf{T}} M d_{ij}}$$\nFinally, we substitute this expression for $\\alpha$ into the form of $p'$ to obtain the final closed-form expression for the post-hop momentum:\n$$p' = p + \\left( \\frac{-(p^{\\mathsf{T}} d_{ij}) + \\operatorname{sgn}(p^{\\mathsf{T}} d_{ij}) \\sqrt{(p^{\\mathsf{T}} d_{ij})^2 - 2 \\Delta E (d_{ij}^{\\mathsf{T}} M d_{ij})}}{d_{ij}^{\\mathsf{T}} M d_{ij}} \\right) M d_{ij}$$\nThe two requested quantities are this expression for $p'$ and the discriminant $D$.", "answer": "$$ \\boxed{ \\begin{pmatrix} p + \\left( \\frac{-(p^{\\mathsf{T}} d_{ij}) + \\operatorname{sgn}(p^{\\mathsf{T}} d_{ij}) \\sqrt{(p^{\\mathsf{T}} d_{ij})^2 - 2 \\Delta E (d_{ij}^{\\mathsf{T}} M d_{ij})}}{d_{ij}^{\\mathsf{T}} M d_{ij}} \\right) M d_{ij} & (p^{\\mathsf{T}} d_{ij})^2 - 2 \\Delta E (d_{ij}^{\\mathsf{T}} M d_{ij}) \\end{pmatrix} } $$", "id": "2655257"}, {"introduction": "The ultimate test of any approximate method is comparison with exact quantum dynamics. This hands-on computational problem [@problem_id:2655262] tasks you with performing this comparison for the cornerstone Landau-Zener model. You will numerically integrate the time-dependent Schrödinger equation to find the exact nonadiabatic transition probability and compare it to the analytical prediction that underpins the Fewest-Switches Surface Hopping algorithm, gaining a practical understanding of how and when these simulation methods succeed.", "problem": "Consider a two-level Landau–Zener model in the diabatic representation, in which the time-dependent electronic Hamiltonian is given by\n$$\nH(t) = \\begin{pmatrix}\n\\frac{v\\,t}{2} & \\Delta\\\\\n\\Delta & -\\frac{v\\,t}{2}\n\\end{pmatrix},\n$$\nwhere $t$ is time, $\\Delta &gt; 0$ is a constant diabatic coupling, and $v &gt; 0$ is the sweep rate of the diabatic energy difference. Assume the reduced Planck constant is $ \\hbar = 1 $. The adiabatic eigenenergies are $ \\pm \\varepsilon(t) $ with $ \\varepsilon(t) = \\sqrt{\\Delta^2 + \\left(\\frac{v\\,t}{2}\\right)^2} $. For sufficiently large $|t|$, the adiabatic and diabatic bases coincide up to a phase, and the instantaneous adiabatic states are the eigenvectors of $H(t)$.\n\nStarting from first principles, use the Time-Dependent Schrödinger Equation (TDSE),\n$$\ni \\frac{d}{dt} \\Psi(t) = H(t)\\, \\Psi(t),\n$$\nto compute asymptotic electronic populations defined as follows: initialize the electronic state as the adiabatic ground state at a large negative time $t_0 \\ll 0$, propagate to a large positive time $t_f \\gg 0$, and project onto the adiabatic excited state at $t_f$. The squared modulus of this projection is the asymptotic excited-state adiabatic population. In the context of mixed quantum-classical methods with a prescribed classical trajectory $x(t)$ corresponding to the linear time dependence above, Ehrenfest dynamics predicts the same electronic evolution as the TDSE for this two-level model because the electronic amplitudes evolve under the same Hamiltonian along the given path. For Fewest Switches Surface Hopping (FSSH), for a single passage through an avoided crossing with no reflection and a constant sweep rate $v$, the asymptotic nonadiabatic transition probability between adiabatic states is, as a well-tested fact for this standard model,\n$$\nP_{\\mathrm{FSSH}} = \\exp\\left( -\\frac{2\\pi \\Delta^2}{v} \\right).\n$$\nYou must compute three quantities for each parameter set $(\\Delta, v)$:\n- $P_{\\mathrm{EH}}$: the asymptotic excited-state adiabatic population predicted by Ehrenfest dynamics, obtained by numerically integrating the TDSE from $t_0$ to $t_f$ with the initial condition being the instantaneous adiabatic ground state at $t_0$, and then projecting the final wavefunction onto the instantaneous adiabatic excited state at $t_f$.\n- $P_{\\mathrm{FSSH}}$: the Fewest Switches Surface Hopping prediction using the formula above.\n- $P_{\\mathrm{exact}}$: the exact quantum result obtained by numerically integrating the TDSE as described for $P_{\\mathrm{EH}}$.\n\nAdopt the following principled numerical protocol to ensure asymptotic conditions and accuracy without relying on shortcut formulas in the propagation itself:\n- Choose $t_0 = -T$ and $t_f = +T$ with $T$ sufficiently large so that $|v T| \\gg \\Delta$. A robust choice is $T = \\max(20, 40\\,\\Delta/v)$.\n- Integrate the TDSE in the diabatic basis using a high-accuracy time integrator with absolute and relative tolerances no worse than $10^{-10}$ and $10^{-8}$, respectively, ensuring the wavefunction norm remains within $10^{-8}$ of unity.\n- Define the initial condition $\\Psi(t_0)$ to be the adiabatic ground-state eigenvector of $H(t_0)$, and compute the final projection onto the adiabatic excited-state eigenvector of $H(t_f)$, taking the squared magnitude of the inner product as the population.\n\nAngles do not appear, and there are no physical units beyond the adopted convention $ \\hbar = 1 $, so no unit conversions are required. Express all probabilities as decimals rounded to six places.\n\nTest Suite:\nCompute the triplet $\\left(P_{\\mathrm{EH}}, P_{\\mathrm{FSSH}}, P_{\\mathrm{exact}}\\right)$ for each of the following parameter sets $(\\Delta, v)$:\n1. $(\\Delta, v) = (0.1, 1.0)$\n2. $(\\Delta, v) = (0.5, 1.0)$\n3. $(\\Delta, v) = (0.5, 0.2)$\n4. $(\\Delta, v) = (1.0, 5.0)$\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output the three rounded probabilities in the order $[P_{\\mathrm{EH}}, P_{\\mathrm{FSSH}}, P_{\\mathrm{exact}}]$, and concatenate all cases into a flat list in the order given above. For example, the output must look like\n\"[EH1,FSSH1,EXACT1,EH2,FSSH2,EXACT2,EH3,FSSH3,EXACT3,EH4,FSSH4,EXACT4]\"\nwith each entry rounded to six decimal places.", "solution": "The problem requires the calculation of the nonadiabatic transition probability for a two-level Landau-Zener system. The validity of the problem statement is first assessed.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n-   **Hamiltonian**: The time-dependent diabatic Hamiltonian is $H(t) = \\begin{pmatrix} \\frac{v\\,t}{2} & \\Delta\\\\ \\Delta & -\\frac{v\\,t}{2} \\end{pmatrix}$.\n-   **Parameters**: Diabatic coupling $\\Delta > 0$, sweep rate $v > 0$.\n-   **Constant**: Reduced Planck constant $\\hbar = 1$.\n-   **Adiabatic Energies**: $\\pm \\varepsilon(t)$, with $\\varepsilon(t) = \\sqrt{\\Delta^2 + \\left(\\frac{v\\,t}{2}\\right)^2}$.\n-   **Equation of Motion**: The Time-Dependent Schrödinger Equation (TDSE), $i \\frac{d}{dt} \\Psi(t) = H(t)\\, \\Psi(t)$.\n-   **Process**: The system is initialized in the adiabatic ground state at $t_0 \\ll 0$, propagated to $t_f \\gg 0$, and the final state is projected onto the adiabatic excited state at $t_f$. The squared modulus of this projection is the desired population.\n-   **Quantities to Compute**:\n    1.  $P_{\\mathrm{EH}}$: Asymptotic excited-state adiabatic population from Ehrenfest dynamics, which for this model is equivalent to a direct numerical solution of the TDSE.\n    2.  $P_{\\mathrm{FSSH}}$: The Fewest Switches Surface Hopping nonadiabatic transition probability, given by the analytical formula $P_{\\mathrm{FSSH}} = \\exp\\left( -\\frac{2\\pi \\Delta^2}{v} \\right)$.\n    3.  $P_{\\mathrm{exact}}$: The exact quantum result, defined as being obtained via the same numerical TDSE integration as for $P_{\\mathrm{EH}}$.\n-   **Numerical Protocol**:\n    -   Integration times: $t_0 = -T$, $t_f = +T$, where $T = \\max(20, 40\\,\\Delta/v)$.\n    -   Integrator tolerances: `atol` $\\le 10^{-10}$, `rtol` $\\le 10^{-8}$.\n    -   Initial condition: $\\Psi(t_0)$ is the instantaneous adiabatic ground-state eigenvector of $H(t_0)$.\n    -   Final observable: Population in the instantaneous adiabatic excited-state eigenvector of $H(t_f)$.\n-   **Test Suite**: $(\\Delta, v)$ pairs: $(0.1, 1.0)$, $(0.5, 1.0)$, $(0.5, 0.2)$, $(1.0, 5.0)$.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientific Grounding**: The problem is fundamentally sound. It is based on the Landau-Zener model, a cornerstone of nonadiabatic dynamics, and the TDSE, the principal equation of quantum mechanics. The formula for $P_{\\mathrm{FSSH}}$ is the well-known analytical Landau-Zener transition probability, which FSSH is known to reproduce for this model. The statement regarding the equivalence of Ehrenfest dynamics and the TDSE for the electronic subsystem with a prescribed path is correct.\n-   **Well-Posedness**: The problem is well-posed. It provides a clear initial state, a deterministic evolution equation, and a precise definition of the quantity to be measured. The numerical protocol specifies all necessary parameters for a unique and stable solution.\n-   **Objectivity**: The problem is stated in precise, objective, and standard scientific language.\n-   **Flaw Analysis**:\n    -   The problem states that $P_{\\mathrm{EH}}$ and $P_{\\mathrm{exact}}$ are to be computed a) from TDSE integration and b) are related to Ehrenfest and exact quantum dynamics, respectively. Given the pre-classical path, these two are indeed identical. This is not a logical flaw but a means to test the understanding that for this model, Ehrenfest's electronic equation of motion is the TDSE.\n    -   The problem correctly identifies the nonadiabatic transition probability (adiabatic ground state to adiabatic excited state) with the analytical Landau-Zener formula, which is labeled $P_{\\mathrm{FSSH}}$. This is consistent.\n    -   No other flaws such as incompleteness, contradiction, or infeasibility are present.\n\n**Step 3: Verdict and Action**\nThe problem is **valid**. A solution will be provided.\n\n### Solution Derivation\n\nThe central task is to solve the TDSE, $i \\frac{d\\Psi}{dt} = H(t)\\Psi$, for the state vector $\\Psi(t) = \\begin{pmatrix} c_1(t) \\\\ c_2(t) \\end{pmatrix}$. This can be formulated as a system of four real-valued first-order ordinary differential equations (ODEs) by decomposing the complex coefficients $c_k(t)$ into real and imaginary parts, $c_k(t) = c_{k,R}(t) + i c_{k,I}(t)$. The system to be integrated is:\n$$\n\\frac{d}{dt} \\begin{pmatrix} c_{1,R} \\\\ c_{1,I} \\\\ c_{2,R} \\\\ c_{2,I} \\end{pmatrix} = \\begin{pmatrix} 0 & \\frac{vt}{2} & 0 & \\Delta \\\\ -\\frac{vt}{2} & 0 & -\\Delta & 0 \\\\ 0 & \\Delta & 0 & -\\frac{vt}{2} \\\\ -\\Delta & 0 & \\frac{vt}{2} & 0 \\end{pmatrix} \\begin{pmatrix} c_{1,R} \\\\ c_{1,I} \\\\ c_{2,R} \\\\ c_{2,I} \\end{pmatrix}\n$$\nThis system is integrated from $t_0 = -T$ to $t_f = T$.\n\n**Initial and Final States**: The initial state $\\Psi(t_0)$ and the final projection state must be the instantaneous adiabatic eigenvectors of $H(t)$. A numerically stable representation for these eigenvectors is derived using a mixing angle formalism. The Hamiltonian can be written as $H(t) = \\varepsilon(t) (\\cos\\alpha(t)\\sigma_z + \\sin\\alpha(t)\\sigma_x)$ where $\\sigma_i$ are Pauli matrices, $\\cos\\alpha(t) = (vt/2)/\\varepsilon(t)$ and $\\sin\\alpha(t) = \\Delta/\\varepsilon(t)$. The normalized eigenvectors corresponding to eigenvalues $\\mp\\varepsilon(t)$ (ground/excited states) are:\n$$\n\\Psi_{GS}(t) = \\begin{pmatrix} -\\sin(\\alpha(t)/2) \\\\ \\cos(\\alpha(t)/2) \\end{pmatrix} \\quad , \\quad \\Psi_{ES}(t) = \\begin{pmatrix} \\cos(\\alpha(t)/2) \\\\ \\sin(\\alpha(t)/2) \\end{pmatrix}\n$$\nwhere $\\alpha(t) = \\arctan_2(\\Delta, vt/2)$ ensures the correct phase. The components $\\cos(\\alpha/2)$ and $\\sin(\\alpha/2)$ are computed robustly using half-angle identities.\n\n-   **Initial Condition**: The system starts in the adiabatic ground state at $t_0 = -T$. The initial state vector is $\\Psi(t_0) = \\Psi_{GS}(-T)$.\n-   **Numerical Integration**: We use a high-order adaptive-step integrator (DOP853, an 8th-order Dormand-Prince method) with strict tolerances (`rtol=1e-8`, `atol=1e-10`) to solve the ODE system, yielding the final state vector $\\Psi(t_f)$.\n-   **Final Projection**: The problem requires the population in the adiabatic excited state at $t_f=T$. This is calculated by projecting the final state $\\Psi(t_f)$ onto the target eigenvector $\\Psi_{ES}(T)$. The probability is the squared magnitude of this projection:\n    $$\n    P = \\left| \\langle \\Psi_{ES}(T) | \\Psi(T) \\rangle \\right|^2 = \\left| (\\Psi_{ES}(T))^\\dagger \\Psi(T) \\right|^2\n    $$\nThis numerically obtained probability gives both $P_{\\mathrm{EH}}$ and $P_{\\mathrm{exact}}$, as per the problem definition. $P_{\\mathrm{FSSH}}$ is computed independently from its analytical formula. The close agreement between the numerical and analytical results serves as a verification of the implementation.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases and print the results.\n    \"\"\"\n\n    def get_adiabatic_eigenvectors(t, delta, v):\n        \"\"\"\n        Computes the instantaneous adiabatic ground and excited state eigenvectors\n        of the Landau-Zener Hamiltonian for a given time t.\n\n        The method uses a numerically stable mixing angle representation.\n        The Hamiltonian is H(t) = (vt/2)sigma_z + delta*sigma_x.\n        We find the angle alpha such that cos(alpha) = (vt/2)/eps and sin(alpha) = delta/eps.\n        The eigenvectors of cos(alpha)sigma_z + sin(alpha)sigma_x are used.\n        \"\"\"\n        vt_half = v * t / 2.0\n        # Use np.hypot for stable calculation of the norm\n        epsilon = np.hypot(delta, vt_half)\n\n        # A small epsilon can lead to division by zero if delta and t are both zero.\n        if epsilon == 0.0:\n            # At t=0, delta=0, H is zero matrix. Any vector is an eigenvector.\n            # However, delta > 0 is a premise. This case is for robustness.\n            # At t=0, delta > 0, cos_alpha is 0.\n            return np.array([ -np.sqrt(0.5), np.sqrt(0.5)], dtype=complex), \\\n                   np.array([ np.sqrt(0.5), np.sqrt(0.5)], dtype=complex)\n\n        cos_alpha = vt_half / epsilon\n        \n        # Using half-angle identities for numerical stability.\n        # cos(alpha/2)^2 = (1+cos(alpha))/2\n        # sin(alpha/2)^2 = (1-cos(alpha))/2\n        # Since delta > 0, sin(alpha) = delta/epsilon is always non-negative.\n        # This implies alpha is in [0, pi], so alpha/2 is in [0, pi/2].\n        # Thus, sin(alpha/2) is always non-negative.\n        cos_half_alpha = np.sqrt((1.0 + cos_alpha) / 2.0)\n        sin_half_alpha = np.sqrt((1.0 - cos_alpha) / 2.0)\n        \n        psi_gs = np.array([-sin_half_alpha, cos_half_alpha], dtype=complex)\n        psi_es = np.array([cos_half_alpha, sin_half_alpha], dtype=complex)\n        \n        return psi_gs, psi_es\n\n    def calculate_probabilities(delta, v):\n        \"\"\"\n        Solves the TDSE for the Landau-Zener problem for a given (delta, v) pair.\n        Returns the triplet (P_EH, P_FSSH, P_exact).\n        \"\"\"\n        # 1. Set up integration time T according to the specified protocol.\n        T = max(20.0, 40.0 * delta / v)\n        t_span = [-T, T]\n\n        # 2. Define the RHS of the TDSE for a real-valued 4-component vector.\n        # The equation is d(psi)/dt = -i*H*psi.\n        # Let psi = c_R + i*c_I. Then d(c_R)/dt = H*c_I and d(c_I)/dt = -H*c_R.\n        def tdse_rhs(t, y, delta_p, v_p):\n            h11 = v_p * t / 2.0\n            h22 = -v_p * t / 2.0\n            h12 = delta_p\n            \n            c1r, c1i, c2r, c2i = y\n            \n            dc1r_dt = h11 * c1i + h12 * c2i\n            dc1i_dt = -h11 * c1r - h12 * c2r\n            dc2r_dt = h12 * c1i + h22 * c2i # H is symmetric, h21 = h12\n            dc2i_dt = -h12 * c1r - h22 * c2r\n        \n            return np.array([dc1r_dt, dc1i_dt, dc2r_dt, dc2i_dt])\n\n        # 3. Define the initial condition: Adiabatic ground state at t = -T.\n        psi_gs_initial, _ = get_adiabatic_eigenvectors(-T, delta, v)\n        # The initial state is real-valued in this representation.\n        y0 = np.array([psi_gs_initial[0].real, 0.0, psi_gs_initial[1].real, 0.0])\n\n        # 4. Integrate the TDSE using a high-accuracy solver.\n        sol = solve_ivp(\n            fun=tdse_rhs,\n            t_span=t_span,\n            y0=y0,\n            args=(delta, v),\n            method='DOP853',\n            rtol=1e-8,\n            atol=1e-10\n        )\n\n        # 5. Reconstruct the complex final wavefunction from the real vector.\n        y_final = sol.y[:, -1]\n        psi_final = np.array([y_final[0] + 1j * y_final[1], y_final[2] + 1j * y_final[3]])\n\n        # 6. Verify norm conservation as a sanity check.\n        norm_final = np.linalg.norm(psi_final)\n        if not np.isclose(norm_final, 1.0, atol=1e-8):\n            # This check is good practice but not expected to fail with these settings.\n            raise ValueError(f\"Wavefunction norm conservation failed: norm = {norm_final}\")\n\n        # 7. Define the target state: Adiabatic excited state at t = T.\n        _, psi_es_final = get_adiabatic_eigenvectors(T, delta, v)\n\n        # 8. Compute the projection and the resulting probability.\n        # P = |<psi_ES(T)|psi(T)>|^2\n        projection = np.vdot(psi_es_final, psi_final)\n        prob_exact = np.abs(projection)**2\n        # As per the problem, P_EH is computed identically to P_exact.\n        prob_eh = prob_exact\n\n        # 9. Compute P_FSSH from the analytical Landau-Zener formula.\n        prob_fssh = np.exp(-2.0 * np.pi * delta**2 / v)\n\n        return prob_eh, prob_fssh, prob_exact\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0.1, 1.0),\n        (0.5, 1.0),\n        (0.5, 0.2),\n        (1.0, 5.0)\n    ]\n\n    all_results = []\n    for delta_val, v_val in test_cases:\n        p_eh, p_fssh, p_exact = calculate_probabilities(delta_val, v_val)\n        all_results.extend([\n            round(p_eh, 6),\n            round(p_fssh, 6),\n            round(p_exact, 6)\n        ])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "2655262"}]}