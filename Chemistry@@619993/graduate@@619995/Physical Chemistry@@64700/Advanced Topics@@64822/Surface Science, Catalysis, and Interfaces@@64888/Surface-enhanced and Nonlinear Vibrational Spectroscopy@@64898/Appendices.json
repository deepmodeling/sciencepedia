{"hands_on_practices": [{"introduction": "Understanding how molecular-scale properties manifest in macroscopic measurements is a fundamental skill in spectroscopy. This practice explores the connection between the symmetry of a vibrational mode, its corresponding Raman polarizability derivative tensor $\\boldsymbol{\\alpha}'$, and the experimentally accessible depolarization ratio $\\rho$ [@problem_id:2670209]. By performing an orientational average for an isotropic sample, you will derive how the tensor's structure dictates the polarization of scattered light, providing a powerful tool for assigning spectral features.", "problem": "A molecule in an isotropic liquid exhibits a Raman-active vibrational mode described in its molecular principal-axis frame by the symmetric Raman polarizability derivative tensor\n$$\n\\boldsymbol{\\alpha}'_{\\text{mol}}=\n\\begin{pmatrix}\n1.3 & 0.2 & 0.0 \\\\\n0.2 & 0.9 & 0.1 \\\\\n0.0 & 0.1 & 0.8\n\\end{pmatrix},\n$$\nin arbitrary but consistent units. Consider $90^{\\circ}$ scattering in the laboratory frame where the incident laser (Light Amplification by Stimulated Emission of Radiation) beam propagates along the laboratory $z$-axis with linear polarization along the laboratory $y$-axis, and the scattered light is collected along the laboratory $x$-axis. The analyzer selects either polarization parallel to the incident polarization (laboratory $y$-axis) or perpendicular to it (laboratory $z$-axis). Assume a classical description of Raman scattering in which the induced dipole is $\\mathbf{p}=\\boldsymbol{\\alpha}'\\mathbf{E}_{\\text{inc}}$ and the Raman scattering amplitude into a given polarization $\\mathbf{e}_{s}$ is proportional to $\\mathbf{e}_{s}^{\\mathrm{T}}\\boldsymbol{\\alpha}'\\mathbf{e}_{i}$, where $\\mathbf{e}_{i}$ is the incident polarization unit vector. The sample is isotropic, so the measured intensities are orientational averages of the squared scattering amplitudes over all molecular orientations.\n\nStarting from these principles and without assuming any specialized shortcut formulas beyond isotropic orientational averaging of direction cosines, derive the depolarization ratio $\\rho$ defined by\n$$\n\\rho=\\frac{I_{\\perp}}{I_{\\parallel}},\n$$\nwhere $I_{\\parallel}$ is the orientationally averaged scattered intensity with the analyzer parallel to the incident polarization and $I_{\\perp}$ is that with the analyzer perpendicular to the incident polarization. Express your final numerical result for $\\rho$ as a reduced fraction. Then, briefly interpret what the computed value reveals about the mode symmetry in the context of Raman scattering for an isotropic ensemble and discuss how this connects to expectations in Surface-Enhanced Raman Scattering (SERS) when the ensemble of nanostructures is randomly oriented in the far field.\n\nYour final answer must be a single real number written as a reduced fraction with no units. No rounding is required.", "solution": "The problem requires the derivation of the depolarization ratio $\\rho$ for a molecule in an isotropic liquid, given its Raman polarizability derivative tensor $\\boldsymbol{\\alpha}'_{\\text{mol}}$ in the molecular frame. The derivation must be based on first principles, specifically the orientational averaging of the scattered intensity over all molecular orientations.\n\nFirst, we establish the relationship between the laboratory frame (denoted by uppercase indices $I, J, \\ldots \\in \\{X, Y, Z\\}$) and the molecular principal-axis frame (denoted by lowercase indices $k, l, \\ldots \\in \\{x, y, z\\}$). The Raman tensor in the laboratory frame, $\\boldsymbol{\\alpha}'_{\\text{lab}}$, is obtained by rotating the molecular-frame tensor, $\\boldsymbol{\\alpha}'_{\\text{mol}}$, using the transformation matrix $\\mathbf{R}$ that describes the orientation of the molecule:\n$$ \\boldsymbol{\\alpha}'_{\\text{lab}} = \\mathbf{R} \\boldsymbol{\\alpha}'_{\\text{mol}} \\mathbf{R}^{\\mathrm{T}} $$\nThe components are related by $(\\alpha'_{\\text{lab}})_{IJ} = \\sum_{k,l} R_{Ik} R_{Jl} (\\alpha'_{\\text{mol}})_{kl}$, where $R_{Ik}$ are the direction cosines between the laboratory $I$-axis and the molecular $k$-axis.\n\nAccording to the problem statement, the incident light propagates along the laboratory $z$-axis with polarization along the $y$-axis, so the incident polarization unit vector is $\\mathbf{e}_{i} = \\hat{\\mathbf{y}}$. The scattered light is observed at $90^{\\circ}$ along the $x$-axis. The analyzer is set either parallel to the incident polarization, $\\mathbf{e}_{s,\\parallel} = \\hat{\\mathbf{y}}$, or perpendicular, $\\mathbf{e}_{s,\\perp} = \\hat{\\mathbf{z}}$. The Raman scattering amplitude is proportional to $\\mathbf{e}_{s}^{\\mathrm{T}}\\boldsymbol{\\alpha}'_{\\text{lab}}\\mathbf{e}_{i}$. The corresponding scattered intensities, $I_{\\parallel}$ and $I_{\\perp}$, are proportional to the orientational average of the squared amplitudes:\n$$ I_{\\parallel} \\propto \\langle (\\mathbf{e}_{s,\\parallel}^{\\mathrm{T}} \\boldsymbol{\\alpha}'_{\\text{lab}} \\mathbf{e}_{i})^2 \\rangle = \\langle ((\\alpha'_{\\text{lab}})_{YY})^2 \\rangle $$\n$$ I_{\\perp} \\propto \\langle (\\mathbf{e}_{s,\\perp}^{\\mathrm{T}} \\boldsymbol{\\alpha}'_{\\text{lab}} \\mathbf{e}_{i})^2 \\rangle = \\langle ((\\alpha'_{\\text{lab}})_{ZY})^2 \\rangle $$\nThe angle brackets $\\langle \\dots \\rangle$ denote an isotropic orientational average. The depolarization ratio is $\\rho = I_{\\perp} / I_{\\parallel}$.\n\nTo perform the orientational averaging, we decompose the symmetric Raman tensor $\\boldsymbol{\\alpha}'$ into its irreducible components: an isotropic part (a scalar) and a symmetric traceless anisotropic part.\n$$ \\boldsymbol{\\alpha}' = \\alpha_{\\text{iso}} \\mathbf{I} + \\boldsymbol{\\beta} $$\nThe isotropic (or mean) polarizability derivative, $\\alpha_{\\text{iso}}$, is a rotational invariant given by:\n$$ \\alpha_{\\text{iso}} = \\frac{1}{3} \\text{Tr}(\\boldsymbol{\\alpha}') = \\frac{1}{3} (\\alpha'_{xx} + \\alpha'_{yy} + \\alpha'_{zz}) $$\nThe matrix $\\boldsymbol{\\beta}$ is the symmetric anisotropic part, with components $\\beta_{kl} = \\alpha'_{kl} - \\delta_{kl}\\alpha_{\\text{iso}}$. The trace of $\\boldsymbol{\\beta}$ is zero. The magnitude of the anisotropy is characterized by a second invariant, the anisotropy parameter $\\gamma^2$.\n\nThe scattered intensity is a sum of contributions from the isotropic and anisotropic parts. The cross-term in the squared amplitude averages to zero over an isotropic distribution, i.e., $\\langle 2 \\alpha_{\\text{iso}}(\\mathbf{e}_s \\cdot \\mathbf{e}_i)(\\mathbf{e}_s \\cdot \\boldsymbol{\\beta}_{\\text{lab}} \\cdot \\mathbf{e}_i) \\rangle = 0$.\nThus, the total scattered intensity is the sum of isotropic and anisotropic scattering intensities:\n$$ I_s \\propto \\alpha_{\\text{iso}}^2 (\\mathbf{e}_s \\cdot \\mathbf{e}_i)^2 + \\langle (\\mathbf{e}_s \\cdot \\boldsymbol{\\beta}_{\\text{lab}} \\cdot \\mathbf{e}_i)^2 \\rangle $$\nFor the parallel case, $\\mathbf{e}_{s,\\parallel} \\cdot \\mathbf{e}_{i} = \\hat{\\mathbf{y}} \\cdot \\hat{\\mathbf{y}} = 1$, and for the perpendicular case, $\\mathbf{e}_{s,\\perp} \\cdot \\mathbf{e}_{i} = \\hat{\\mathbf{z}} \\cdot \\hat{\\mathbf{y}} = 0$.\nThe orientational averaging of the anisotropic term yields results that are proportional to the invariant $\\gamma^2$. The fundamental results from the averaging of the fourth-rank tensor of direction cosines are:\n$$ \\langle ((\\alpha'_{\\text{lab}})_{II})^2 \\rangle \\propto 45\\alpha_{\\text{iso}}^2 + 4\\gamma^2 \\quad \\text{(for any axis } I) $$\n$$ \\langle ((\\alpha'_{\\text{lab}})_{IJ})^2 \\rangle \\propto 3\\gamma^2 \\quad \\text{(for any orthogonal axes } I, J) $$\nApplying these established results of isotropic averaging to our specific geometry:\n$$ I_{\\parallel} \\propto \\langle ((\\alpha'_{\\text{lab}})_{YY})^2 \\rangle \\propto 45\\alpha_{\\text{iso}}^2 + 4\\gamma^2 $$\n$$ I_{\\perp} \\propto \\langle ((\\alpha'_{\\text{lab}})_{ZY})^2 \\rangle \\propto 3\\gamma^2 $$\nThe depolarization ratio is therefore given by the well-known expression:\n$$ \\rho = \\frac{I_{\\perp}}{I_{\\parallel}} = \\frac{3\\gamma^2}{45\\alpha_{\\text{iso}}^2 + 4\\gamma^2} $$\nNow we compute the values of $\\alpha_{\\text{iso}}$ and $\\gamma^2$ for the given tensor:\n$$ \\boldsymbol{\\alpha}'_{\\text{mol}}= \\begin{pmatrix} 1.3 & 0.2 & 0.0 \\\\ 0.2 & 0.9 & 0.1 \\\\ 0.0 & 0.1 & 0.8 \\end{pmatrix} $$\nThe trace of the tensor is $\\text{Tr}(\\boldsymbol{\\alpha}'_{\\text{mol}}) = 1.3 + 0.9 + 0.8 = 3.0$.\nThe isotropic part is:\n$$ \\alpha_{\\text{iso}} = \\frac{1}{3}(3.0) = 1.0 $$\nTherefore, $45\\alpha_{\\text{iso}}^2 = 45(1.0)^2 = 45$.\nThe anisotropy invariant $\\gamma^2$ is defined as:\n$$ \\gamma^2 = \\frac{1}{2} \\left[ (\\alpha'_{xx}-\\alpha'_{yy})^2 + (\\alpha'_{yy}-\\alpha'_{zz})^2 + (\\alpha'_{zz}-\\alpha'_{xx})^2 \\right] + 3(\\alpha'_{xy}{}^2 + \\alpha'_{yz}{}^2 + \\alpha'_{zx}{}^2) $$\nSubstituting the values from the tensor:\n$$ \\gamma^2 = \\frac{1}{2} \\left[ (1.3 - 0.9)^2 + (0.9 - 0.8)^2 + (0.8 - 1.3)^2 \\right] + 3\\left[ (0.2)^2 + (0.1)^2 + (0.0)^2 \\right] $$\n$$ \\gamma^2 = \\frac{1}{2} \\left[ (0.4)^2 + (0.1)^2 + (-0.5)^2 \\right] + 3\\left[ 0.04 + 0.01 + 0 \\right] $$\n$$ \\gamma^2 = \\frac{1}{2} [0.16 + 0.01 + 0.25] + 3(0.05) $$\n$$ \\gamma^2 = \\frac{1}{2} (0.42) + 0.15 = 0.21 + 0.15 = 0.36 $$\nSo, we have $\\gamma^2 = 0.36$.\n\nNow, we substitute the values of $\\alpha_{\\text{iso}}^2$ and $\\gamma^2$ into the expression for $\\rho$:\n$$ \\rho = \\frac{3 \\times 0.36}{45 + 4 \\times 0.36} = \\frac{1.08}{45 + 1.44} = \\frac{1.08}{46.44} $$\nTo express this as a reduced fraction:\n$$ \\rho = \\frac{108}{4644} $$\nWe divide the numerator and denominator by their greatest common divisor. We can simplify by dividing by common factors.\nDividing by $108$: $4644 \\div 108 = 43$.\n$$ \\rho = \\frac{1}{43} $$\n\nInterpretation:\nThe value of the depolarization ratio provides information about the symmetry of the vibrational mode. For a mode to be Raman active, at least one component of the Raman tensor derivative $\\alpha'_{kl}$ must be non-zero.\n- For totally symmetric vibrations, the isotropic part $\\alpha_{\\text{iso}}$ is generally non-zero. For linearly polarized incident light, this results in a depolarization ratio in the range $0 \\le \\rho < \\frac{3}{4}$. Such modes are termed \"polarized\".\n- For non-totally symmetric vibrations, group theory dictates that the isotropic part must be zero, $\\alpha_{\\text{iso}}=0$. This leads to a depolarization ratio of $\\rho = \\frac{3\\gamma^2}{4\\gamma^2} = \\frac{3}{4}$. Such modes are termed \"depolarized\".\nIn our case, $\\rho = \\frac{1}{43}$. Since $0 \\le \\frac{1}{43} < \\frac{3}{4}$, the mode is polarized. This indicates that the vibrational mode is totally symmetric in the point group of the molecule. This is consistent with our calculation that $\\alpha_{\\text{iso}} = 1.0 \\ne 0$.\n\nConnection to SERS:\nIn Surface-Enhanced Raman Scattering (SERS), molecules are near plasmonic nanostructures. The enhancement arises primarily from the amplified local electromagnetic field. This field can be highly non-uniform, leading to SERS surface selection rules where modes with polarizability components perpendicular to the surface are preferentially enhanced. However, the problem specifies \"an ensemble of nanostructures... randomly oriented in the far field\". In such a scenario, any directional enhancement effects associated with a single nanostructure's geometry are averaged out over the entire ensemble. The system as a whole becomes macroscopically isotropic. Consequently, the orientational averaging formalism applied to the isotropic liquid case remains valid. The measured depolarization ratio for the SERS experiment, $\\rho_{\\text{SERS}}$, is therefore expected to be approximately the same as that in the solution, i.e., $\\rho_{\\text{SERS}} \\approx \\frac{1}{43}$. Observing this value would confirm that the mode remains totally symmetric upon adsorption, assuming the molecule-surface interaction does not drastically alter the Raman tensor components or introduce new selection rules not averaged out by the random orientation of the ensemble.", "answer": "$$\\boxed{\\frac{1}{43}}$$", "id": "2670209"}, {"introduction": "The central promise of SERS is its enormous signal amplification, which enables single-molecule detection. This exercise provides a quantitative look into the origins of this enhancement by having you calculate the differential SERS cross-section from first principles [@problem_id:2670255]. You will integrate key concepts including the local field enhancement factors, the role of the Raman tensor, and the thermal population of vibrational modes to quantify the expected signal in a realistic experimental geometry.", "problem": "A single molecule is chemisorbed on a nanostructured silver surface such that its molecular principal axes align with the laboratory axes $x$, $y$, and $z$, with the surface normal along $z$. Consider spontaneous Surface-Enhanced Raman Scattering (SERS) for one totally symmetric vibrational normal mode. The molecule’s nonresonant Raman polarizability derivative tensor (with respect to the normal coordinate) in the laboratory frame is diagonal with components $\\partial \\alpha_{xx}/\\partial Q = \\alpha'_{xx}$, $\\partial \\alpha_{yy}/\\partial Q = \\alpha'_{yy}$, and $\\partial \\alpha_{zz}/\\partial Q = \\alpha'_{zz}$. The incident optical field is a monochromatic plane wave of vacuum wavelength $\\lambda_{i}$ propagating along $+z$ with linear polarization along $x$. The detector is placed in the far field along $+y$ (a $90^{\\circ}$ scattering geometry), and a polarization analyzer selects the $x$-polarized component of the scattered field.\n\nAssume the following:\n- The local field enhancement factors at the molecule due to the plasmonic surface are $L(\\omega_{i})$ at the incident angular frequency $\\omega_{i}$ and $L(\\omega_{s})$ at the Stokes angular frequency $\\omega_{s}=\\omega_{i}-\\omega_{v}$, where $\\omega_{v}$ is the vibrational angular frequency. Treat the electromagnetic SERS enhancement in the usual multiplicative form, so that the scattered intensity is multiplied by $\\left|L(\\omega_{i})\\right|^{2}\\left|L(\\omega_{s})\\right|^{2}$.\n- The induced dipole is given by the linear-response form $p_{j}(t)=\\sum_{k}\\alpha_{jk}(Q(t))E_{k}(t)$ with $\\alpha_{jk}(Q)\\approx \\alpha_{jk}^{(0)}+(\\partial \\alpha_{jk}/\\partial Q)\\,Q$. The Stokes Raman dipole amplitude at $\\omega_{s}$ arises from the term linear in $Q$.\n- The far-field radiation of an oscillating point dipole and the definition of differential scattering cross section as the ratio of differential radiated power to incident intensity apply.\n- The vibrational mode is a quantum harmonic oscillator with reduced mass $\\mu$ in thermal equilibrium at temperature $T$. Use the thermal mean-square displacement $\\langle Q^{2}\\rangle=(\\bar{n}+1/2)\\,\\hbar/(\\mu \\omega_{v})$, where $\\bar{n}=\\left[\\exp\\!\\left(\\hbar \\omega_{v}/(k_{B}T)\\right)-1\\right]^{-1}$.\n\nStarting from these fundamental principles, derive an expression for the differential Raman scattering cross section $d\\sigma/d\\Omega$ collected along $+y$ with $x$-polarization analysis in terms of the given parameters, and then evaluate it numerically for the data below. You may treat the molecule as a single, fixed, oriented dipole emitter located sufficiently close to the metal that local-field factors $L(\\omega_{i})$ and $L(\\omega_{s})$ are applicable, but far enough that radiation can be treated using the dipole far-field. Ignore any chemical enhancement beyond the electromagnetic local fields.\n\nNumerical data:\n- $\\lambda_{i}=633\\,\\text{nm}$, so $\\omega_{i}=2\\pi c/\\lambda_{i}$.\n- Vibrational wavenumber $\\tilde{\\nu}=1000\\,\\text{cm}^{-1}$, so $\\omega_{v}=2\\pi c\\,\\tilde{\\nu}$ with $c$ expressed in $\\text{cm}\\,\\text{s}^{-1}$ for this conversion.\n- $\\alpha'_{xx}=1.00\\times 10^{-30}\\,\\text{C}\\,\\text{m}\\,\\text{V}^{-1}$, $\\alpha'_{yy}=2.00\\times 10^{-31}\\,\\text{C}\\,\\text{m}\\,\\text{V}^{-1}$, $\\alpha'_{zz}=1.00\\times 10^{-31}\\,\\text{C}\\,\\text{m}\\,\\text{V}^{-1}$.\n- $|L(\\omega_{i})|=20$, $|L(\\omega_{s})|=15$.\n- Temperature $T=300\\,\\text{K}$, reduced mass $\\mu=10\\,\\text{amu}$.\n- Use the constants $c=2.998\\times 10^{8}\\,\\text{m}\\,\\text{s}^{-1}$, $c=2.998\\times 10^{10}\\,\\text{cm}\\,\\text{s}^{-1}$ when converting $\\tilde{\\nu}$ to $\\omega_{v}$, $\\varepsilon_{0}=8.854\\times 10^{-12}\\,\\text{F}\\,\\text{m}^{-1}$, $\\hbar=1.055\\times 10^{-34}\\,\\text{J}\\,\\text{s}$, $k_{B}=1.381\\times 10^{-23}\\,\\text{J}\\,\\text{K}^{-1}$, $1\\,\\text{amu}=1.660\\times 10^{-27}\\,\\text{kg}$.\n\nCompute the final numerical value of $d\\sigma/d\\Omega$ and report it in $\\text{m}^{2}\\,\\text{sr}^{-1}$. Round your answer to three significant figures.", "solution": "The objective is to derive and calculate the differential Raman scattering cross section, denoted $d\\sigma/d\\Omega$, for a specific experimental geometry and then to compute its numerical value.\n\nThe differential scattering cross section is defined as the ratio of the time-averaged power $dP$ scattered into a solid angle $d\\Omega$ to the incident intensity $I_{i}$:\n$$\n\\frac{d\\sigma}{d\\Omega} = \\frac{1}{I_{i}} \\frac{dP}{d\\Omega}\n$$\nThe incident field is a plane wave propagating along the $+z$ axis, with linear polarization along the $x$ axis. Its electric field vector at the molecule's position (taken as the origin) can be written as $\\mathbf{E}_{i}(t) = \\mathbf{\\hat{x}} E_{0} \\cos(\\omega_{i}t)$, where $E_{0}$ is the field amplitude and $\\omega_{i}$ is the incident angular frequency. The incident intensity is given by $I_{i} = \\frac{1}{2} c \\varepsilon_{0} E_{0}^{2}$.\n\nDue to the plasmonic surface, the local electric field experienced by the molecule is enhanced. The local field is $\\mathbf{E}_{\\text{loc},i}(t) = L(\\omega_{i}) \\mathbf{E}_{i}(t) = \\mathbf{\\hat{x}} L(\\omega_{i}) E_{0} \\cos(\\omega_{i}t)$.\n\nThe induced dipole moment $\\mathbf{p}(t)$ is given by the linear response to this local field, modulated by the molecular vibration. The polarizability tensor $\\boldsymbol{\\alpha}$ is expanded to first order in the vibrational normal coordinate $Q$:\n$$\n\\mathbf{p}(t) = \\boldsymbol{\\alpha}(Q(t)) \\mathbf{E}_{\\text{loc},i}(t) \\approx \\left(\\boldsymbol{\\alpha}^{(0)} + \\frac{\\partial\\boldsymbol{\\alpha}}{\\partial Q} Q(t)\\right) \\mathbf{E}_{\\text{loc},i}(t)\n$$\nHere, $\\boldsymbol{\\alpha}' = \\partial\\boldsymbol{\\alpha}/\\partial Q$ is the Raman polarizability derivative tensor. The vibrational coordinate oscillates at frequency $\\omega_{v}$, which we can write as $Q(t) = Q_{\\text{amp}} \\cos(\\omega_{v}t + \\phi)$. The interaction of the oscillating field and oscillating polarizability gives rise to scattered components at frequencies $\\omega_{i} \\pm \\omega_{v}$. The Stokes component, at frequency $\\omega_{s} = \\omega_{i} - \\omega_{v}$, arises from the term $\\boldsymbol{\\alpha}' Q(t) \\mathbf{E}_{\\text{loc},i}(t)$:\n$$\n\\mathbf{p}_{\\text{Stokes}}(t) = \\boldsymbol{\\alpha}' Q(t) \\mathbf{E}_{\\text{loc},i}(t) = \\boldsymbol{\\alpha}' [Q_{\\text{amp}} \\cos(\\omega_{v}t)] [\\mathbf{\\hat{x}} L(\\omega_{i}) E_{0} \\cos(\\omega_{i}t)]\n$$\nUsing the trigonometric identity $\\cos A \\cos B = \\frac{1}{2}[\\cos(A-B) + \\cos(A+B)]$, we find the amplitude of the induced dipole oscillating at $\\omega_{s}$:\n$$\n\\mathbf{p}_{s,0} = \\frac{1}{2} L(\\omega_{i}) E_{0} Q_{\\text{amp}} (\\boldsymbol{\\alpha}' \\cdot \\mathbf{\\hat{x}})\n$$\nThis oscillating dipole radiates. The radiated field is itself enhanced by the plasmonic environment, characterized by the factor $L(\\omega_{s})$. The effective radiating dipole amplitude is thus $\\mathbf{p}_{s, \\text{eff}} = L(\\omega_{s}) \\mathbf{p}_{s,0}$.\n\nThe time-averaged power radiated per unit solid angle by a dipole with complex amplitude $\\mathbf{p}_{0}$ for a specific scattered polarization $\\mathbf{\\hat{e}}_{s}$ is given by:\n$$\n\\frac{dP}{d\\Omega} = \\frac{\\omega_{s}^{4}}{32\\pi^{2}\\varepsilon_{0}c^{3}} |\\mathbf{\\hat{e}}_{s}^{*} \\cdot \\mathbf{p}_{0}|^{2}\n$$\nThe problem instructs to use the thermal mean-square displacement $\\langle Q^{2} \\rangle$. The scattered power is proportional to the mean-squared amplitude of the oscillating dipole, which in this semiclassical picture is proportional to $\\langle Q^{2} \\rangle$. The differential cross section for normal Raman scattering in a specific geometry is:\n$$\n\\frac{d\\sigma_{\\text{Raman}}}{d\\Omega} = \\left(\\frac{\\omega_{s}}{c}\\right)^{4} \\frac{1}{(4\\pi\\varepsilon_{0})^{2}} |\\mathbf{\\hat{e}}_{s}^{*} \\cdot \\boldsymbol{\\alpha}' \\cdot \\mathbf{\\hat{e}}_{i}|^{2} \\langle Q^{2} \\rangle\n$$\nHere, $\\mathbf{\\hat{e}}_{i} = \\mathbf{\\hat{x}}$ is the incident polarization vector. The scattered light is detected along the $+y$ axis, and the analyzer selects the $x$-polarized component, so $\\mathbf{\\hat{e}}_{s} = \\mathbf{\\hat{x}}$. The tensor $\\boldsymbol{\\alpha}'$ is diagonal. The required matrix element is:\n$$\n\\mathbf{\\hat{x}} \\cdot \\boldsymbol{\\alpha}' \\cdot \\mathbf{\\hat{x}} = \\alpha'_{xx}\n$$\nThe SERS cross section is obtained by multiplying by the electromagnetic enhancement factor:\n$$\n\\frac{d\\sigma}{d\\Omega} = |L(\\omega_{i})|^{2} |L(\\omega_{s})|^{2} \\left(\\frac{\\omega_{s}}{c}\\right)^{4} \\frac{(\\alpha'_{xx})^{2}}{(4\\pi\\varepsilon_{0})^{2}} \\langle Q^{2} \\rangle\n$$\nSubstituting the given expression for $\\langle Q^{2} \\rangle$:\n$$\n\\frac{d\\sigma}{d\\Omega} =|L(\\omega_{i})|^{2} |L(\\omega_{s})|^{2} \\left(\\frac{\\omega_{s}}{c}\\right)^{4} \\frac{(\\alpha'_{xx})^{2}}{(4\\pi\\varepsilon_{0})^{2}} \\left( (\\bar{n}+\\frac{1}{2})\\frac{\\hbar}{\\mu\\omega_{v}} \\right)\n$$\nwith $\\bar{n} = [\\exp(\\hbar\\omega_{v}/(k_{B}T)) - 1]^{-1}$.\n\nNow, we compute the numerical value.\nFirst, calculate the frequencies:\n$\\lambda_{i} = 633\\,\\text{nm} = 633 \\times 10^{-9}\\,\\text{m}$.\n$\\omega_{i} = \\frac{2\\pi c}{\\lambda_{i}} = \\frac{2\\pi (2.998 \\times 10^{8}\\,\\text{m}\\,\\text{s}^{-1})}{633 \\times 10^{-9}\\,\\text{m}} \\approx 2.978 \\times 10^{15}\\,\\text{rad}\\,\\text{s}^{-1}$.\n$\\tilde{\\nu} = 1000\\,\\text{cm}^{-1}$.\n$\\omega_{v} = 2\\pi c \\tilde{\\nu} = 2\\pi (2.998 \\times 10^{10}\\,\\text{cm}\\,\\text{s}^{-1}) (1000\\,\\text{cm}^{-1}) \\approx 1.884 \\times 10^{14}\\,\\text{rad}\\,\\text{s}^{-1}$.\n$\\omega_{s} = \\omega_{i} - \\omega_{v} \\approx 2.978 \\times 10^{15} - 0.1884 \\times 10^{15} = 2.790 \\times 10^{15}\\,\\text{rad}\\,\\text{s}^{-1}$.\n\nNext, the thermal factor:\n$\\frac{\\hbar\\omega_{v}}{k_{B}T} = \\frac{(1.055 \\times 10^{-34}\\,\\text{J}\\,\\text{s})(1.884 \\times 10^{14}\\,\\text{s}^{-1})}{(1.381 \\times 10^{-23}\\,\\text{J}\\,\\text{K}^{-1})(300\\,\\text{K})} = \\frac{1.988 \\times 10^{-20}\\,\\text{J}}{4.143 \\times 10^{-21}\\,\\text{J}} \\approx 4.798$.\n$\\bar{n} = [\\exp(4.798) - 1]^{-1} \\approx [121.2 - 1]^{-1} \\approx 0.008319$.\n$\\bar{n} + \\frac{1}{2} \\approx 0.5083$.\n\nThe mean-square displacement $\\langle Q^{2} \\rangle$:\n$\\mu = 10\\,\\text{amu} = 10 \\times 1.660 \\times 10^{-27}\\,\\text{kg} = 1.660 \\times 10^{-26}\\,\\text{kg}$.\n$\\langle Q^{2} \\rangle = (0.5083) \\frac{1.055 \\times 10^{-34}\\,\\text{J}\\,\\text{s}}{(1.660 \\times 10^{-26}\\,\\text{kg})(1.884 \\times 10^{14}\\,\\text{s}^{-1})} \\approx 1.715 \\times 10^{-23}\\,\\text{m}^{2}$.\n\nAssemble the terms for the cross section:\nEnhancement factor: $|L(\\omega_{i})|^{2} |L(\\omega_{s})|^{2} = (20)^{2}(15)^{2} = 400 \\times 225 = 90000 = 9 \\times 10^{4}$.\nFrequency-dependent prefactor:\n$k_{s}^{4} = (\\omega_{s}/c)^{4} = (\\frac{2.790 \\times 10^{15}}{2.998 \\times 10^{8}})^{4} \\approx (9.306 \\times 10^{6})^{4} \\approx 7.477 \\times 10^{27}\\,\\text{m}^{-4}$.\nConstant factor: $\\frac{1}{(4\\pi\\varepsilon_{0})^{2}} = \\frac{1}{(4\\pi \\times 8.854 \\times 10^{-12})^{2}} \\approx 8.077 \\times 10^{19}\\,\\text{m}^{2}\\,\\text{F}^{-2}$.\nPolarizability derivative: $(\\alpha'_{xx})^{2} = (1.00 \\times 10^{-30}\\,\\text{C}\\,\\text{m}\\,\\text{V}^{-1})^{2} = 1.00 \\times 10^{-60}\\,\\text{C}^{2}\\,\\text{m}^{2}\\,\\text{V}^{-2}$.\n\nFinally, combine all numerical values:\n$\\frac{d\\sigma}{d\\Omega} = (9 \\times 10^{4}) \\times (7.477 \\times 10^{27}\\,\\text{m}^{-4}) \\times (8.077 \\times 10^{19}\\,\\text{m}^{2}\\,\\text{F}^{-2}) \\times (1.00 \\times 10^{-60}\\,\\text{C}^{2}\\,\\text{m}^{2}\\,\\text{V}^{-2}) \\times (1.715 \\times 10^{-23}\\,\\text{m}^{2})$.\nNoting that $1\\,\\text{F} = 1\\,\\text{C}\\,\\text{V}^{-1}$, the units simplify to $\\text{m}^{2}\\,\\text{sr}^{-1}$.\n$\\frac{d\\sigma}{d\\Omega} = (9 \\times 7.477 \\times 8.077 \\times 1.00 \\times 1.715) \\times 10^{(4+27+19-60-23)}\\,\\text{m}^{2}\\,\\text{sr}^{-1}$\n$\\frac{d\\sigma}{d\\Omega} = (932.1) \\times 10^{-33}\\,\\text{m}^{2}\\,\\text{sr}^{-1}$\n$\\frac{d\\sigma}{d\\Omega} = 9.321 \\times 10^{-31}\\,\\text{m}^{2}\\,\\text{sr}^{-1}$.\n\nRounding to three significant figures, the final result is $9.32 \\times 10^{-31}\\,\\text{m}^{2}\\,\\text{sr}^{-1}$.", "answer": "$$ \\boxed{9.32 \\times 10^{-31}} $$", "id": "2670255"}, {"introduction": "Nonlinear techniques like Sum-Frequency Generation (SFG) offer unique surface specificity, but extracting meaningful information requires sophisticated data acquisition and analysis. This advanced practice delves into heterodyne detection, a powerful method for measuring the full complex-valued nonlinear susceptibility, $\\chi^{(2)}$ [@problem_id:2670192]. Through a combination of analytical derivation and simulation, you will master the phase-cycling technique used to isolate the absorptive part of the spectrum and investigate how real-world experimental errors can impact the retrieved data.", "problem": "You are asked to derive and simulate a phase-cycling heterodyne detection scheme in Sum-Frequency Generation (SFG) spectroscopy that isolates the imaginary part of the second-order susceptibility, and to quantify how phase errors and local oscillator drift distort the retrieved spectra. Work entirely in the frequency domain and assume a single resonant mode with a nonresonant background. Use the following fundamental base and modeling assumptions without invoking any shortcut formulas.\n\nStart from these fundamental laws and core definitions:\n- In heterodyne-detected Sum-Frequency Generation (SFG), the macroscopic nonlinear polarization at the sum frequency is proportional to the second-order susceptibility, so that the radiated SFG field satisfies $E_{\\mathrm{sig}}(\\omega) \\propto \\chi^{(2)}(\\omega)$. This linear proportionality is a well-tested relation in second-order nonlinear optics.\n- In a heterodyne measurement with a local oscillator (LO) field of complex phasor $E_{\\mathrm{LO}} = |E_{\\mathrm{LO}}| e^{i \\phi}$, the detected intensity at a given LO phase satisfies $I(\\phi) = |E_{\\mathrm{LO}}|^{2} + |E_{\\mathrm{sig}}|^{2} + 2 \\mathrm{Re}\\{ E_{\\mathrm{sig}} E_{\\mathrm{LO}}^{*} \\}$. In the weak-signal limit, the term $|E_{\\mathrm{sig}}|^{2}$ can be neglected relative to $|E_{\\mathrm{LO}}|^{2}$ and the interference term.\n- The complex second-order susceptibility is the sum of a nonresonant background and a resonant term. Model the susceptibility as\n$$\n\\chi^{(2)}(\\omega) = \\chi_{\\mathrm{NR}} + \\frac{A}{\\omega_{0} - \\omega - i \\Gamma},\n$$\nwhere $\\chi_{\\mathrm{NR}}$ is a real constant, $A$ is a real positive amplitude, $\\omega_{0}$ is the resonance center, and $\\Gamma$ is the half-width at half-maximum (HWHM). The imaginary part of the resonant term is a Lorentzian function of $\\omega$.\n\nYour tasks are:\n1) Derive, from the above definitions only, a four-step phase-cycling scheme using LO phase steps of $\\phi_{k} \\in \\{0, \\pi/2, \\pi, 3\\pi/2\\}$ that algebraically isolates the imaginary part of $E_{\\mathrm{sig}}(\\omega)$, and therefore the imaginary part of $\\chi^{(2)}(\\omega)$ in the weak-signal limit. The derivation must show exactly how linear combinations of measured intensities $I(\\phi_{k})$ remove the LO power and the real part of the signal to leave only the imaginary part.\n2) Show analytically how a constant LO phase error $\\delta$ modifies the retrieved quadrature, and how a frequency-dependent LO phase drift $\\delta(\\omega)$ leads to a mixing of the real and imaginary parts in a frequency-dependent way.\n3) Implement a simulation to demonstrate the derived results, using the following fixed and test-varying parameters. All angles must be in radians, all frequencies must be in wavenumbers in $\\mathrm{cm}^{-1}$, and the final quantitative outputs must be dimensionless floats.\n\nFixed modeling parameters for the simulation:\n- Use $|E_{\\mathrm{LO}}| = 1$.\n- Neglect $|E_{\\mathrm{sig}}|^{2}$.\n- Use a single resonance with $\\chi_{\\mathrm{NR}} = 0.6$, $A = 2.0$, $\\omega_{0} = 3000~\\mathrm{cm}^{-1}$, and $\\Gamma = 10~\\mathrm{cm}^{-1}$.\n- Use a frequency grid $\\omega$ from $2800~\\mathrm{cm}^{-1}$ to $3200~\\mathrm{cm}^{-1}$ in steps of $1~\\mathrm{cm}^{-1}$.\n\nDefinition of the simulated intensity at each LO phase step:\n- For a nominal LO phase step $\\phi_{k} \\in \\{0, \\pi/2, \\pi, 3\\pi/2\\}$ and an LO phase error $\\delta(\\omega)$, the detected intensity shall be\n$$\nI(\\phi_{k}, \\omega) = |E_{\\mathrm{LO}}|^{2} + 2 \\mathrm{Re}\\{ E_{\\mathrm{sig}}(\\omega) e^{-i [\\phi_{k} + \\delta(\\omega)]} \\},\n$$\nwith $E_{\\mathrm{sig}}(\\omega) \\equiv \\chi^{(2)}(\\omega)$ for simulation purposes.\n\nPhase error and LO drift models:\n- Use $\\delta(\\omega) = \\delta_{0} + s \\, (\\omega - \\omega_{0})$, where $\\delta_{0}$ is a constant phase error and $s$ is a linear drift slope in $\\mathrm{rad}/(\\mathrm{cm}^{-1})$.\n\nData reduction target:\n- Using only the four simulated intensities $I(0,\\omega)$, $I(\\pi/2,\\omega)$, $I(\\pi,\\omega)$, and $I(3\\pi/2,\\omega)$, compute a retrieval of the imaginary part, denoted $\\widehat{\\mathrm{Im}\\,\\chi^{(2)}}(\\omega)$, by linearly combining the measured intensities according to your derived expressions. No external calibration should be used beyond the stated modeling assumptions. You must not fit any parameters.\n\nQuantitative evaluation:\n- For each test case, compute the normalized root-mean-square error (NRMSE) between the retrieved imaginary part and the true imaginary part,\n$$\n\\mathrm{NRMSE} = \\frac{\\sqrt{\\frac{1}{N}\\sum_{j=1}^{N}\\left[\\widehat{\\mathrm{Im}\\,\\chi^{(2)}}(\\omega_{j}) - \\mathrm{Im}\\,\\chi^{(2)}(\\omega_{j})\\right]^{2}}}{\\max_{j} \\mathrm{Im}\\,\\chi^{(2)}(\\omega_{j}) - \\min_{j} \\mathrm{Im}\\,\\chi^{(2)}(\\omega_{j})},\n$$\nwhere $N$ is the number of frequency points.\n\nTest suite:\n- Evaluate the NRMSE for the following five test cases $(\\delta_{0}, s)$:\n  - Case A (ideal): $(0, 0)$.\n  - Case B (constant phase error): $(\\pi/18, 0)$.\n  - Case C (moderate linear drift): $(0, 2\\times 10^{-3})$.\n  - Case D (constant error plus moderate drift): $(\\pi/18, 2\\times 10^{-3})$.\n  - Case E (strong linear drift): $(0, 10^{-2})$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order [Case A, Case B, Case C, Case D, Case E]. Each entry must be a float with exactly six digits after the decimal point. For example, a valid output format is \"[0.000001,0.123456,0.234567,0.345678,0.456789]\".", "solution": "We first connect the physical model to algebraic relations suitable for algorithmic implementation. In heterodyne-detected Sum-Frequency Generation (SFG), the signal field satisfies $E_{\\mathrm{sig}}(\\omega) \\propto \\chi^{(2)}(\\omega)$. For the simulation, we take the proportionality constant to be unity, so $E_{\\mathrm{sig}}(\\omega) \\equiv \\chi^{(2)}(\\omega)$. The detected intensity for a local oscillator (LO) of unit amplitude and controllable phase $\\phi$ is, in the weak-signal limit where $|E_{\\mathrm{sig}}|^{2}$ is negligible,\n$$\nI(\\phi,\\omega) = |E_{\\mathrm{LO}}|^{2} + 2 \\mathrm{Re}\\{ E_{\\mathrm{sig}}(\\omega) E_{\\mathrm{LO}}^{*} \\} \\approx 1 + 2 \\mathrm{Re}\\{ E_{\\mathrm{sig}}(\\omega) e^{-i \\phi} \\},\n$$\nwhere we used $|E_{\\mathrm{LO}}|=1$ and $E_{\\mathrm{LO}}^{*} = e^{-i \\phi}$.\n\nTo implement a four-step phase cycling, choose $\\phi_{k} \\in \\{0, \\pi/2, \\pi, 3\\pi/2\\}$. Denote $E_{\\mathrm{sig}}(\\omega) = a(\\omega) + i b(\\omega)$ with $a(\\omega) = \\mathrm{Re}\\,\\chi^{(2)}(\\omega)$ and $b(\\omega) = \\mathrm{Im}\\,\\chi^{(2)}(\\omega)$. The measured intensities at the four phases, with no phase error, are\n$$\nI(0,\\omega) = 1 + 2 \\mathrm{Re}\\{ a + i b \\} = 1 + 2 a,\n$$\n$$\nI(\\pi,\\omega) = 1 + 2 \\mathrm{Re}\\{ (a + i b) e^{-i \\pi} \\} = 1 + 2 \\mathrm{Re}\\{ -a - i b \\} = 1 - 2 a,\n$$\n$$\nI(\\pi/2,\\omega) = 1 + 2 \\mathrm{Re}\\{ (a + i b) e^{-i \\pi/2} \\} = 1 + 2 \\mathrm{Re}\\{ -i a + b \\} = 1 + 2 b,\n$$\n$$\nI(3\\pi/2,\\omega) = 1 + 2 \\mathrm{Re}\\{ (a + i b) e^{-i 3\\pi/2} \\} = 1 + 2 \\mathrm{Re}\\{ i a - b \\} = 1 - 2 b.\n$$\nForming the linear combinations\n$$\n\\widehat{a}(\\omega) = \\frac{I(0,\\omega) - I(\\pi,\\omega)}{4}, \\quad \\widehat{b}(\\omega) = \\frac{I(\\pi/2,\\omega) - I(3\\pi/2,\\omega)}{4},\n$$\nwe obtain\n$$\n\\widehat{a}(\\omega) = \\frac{(1 + 2 a) - (1 - 2 a)}{4} = a(\\omega), \\quad \\widehat{b}(\\omega) = \\frac{(1 + 2 b) - (1 - 2 b)}{4} = b(\\omega).\n$$\nThus, four-step phase cycling isolates each quadrature exactly under the weak-signal model, and in particular isolates the imaginary part of $E_{\\mathrm{sig}}(\\omega)$ and therefore the imaginary part of $\\chi^{(2)}(\\omega)$.\n\nNow consider a constant LO phase error $\\delta$. The actual LO phase at each step is $\\phi_{k} + \\delta$, and the intensity becomes\n$$\nI(\\phi_{k}+\\delta,\\omega) = 1 + 2 \\mathrm{Re}\\{ E_{\\mathrm{sig}}(\\omega) e^{-i (\\phi_{k} + \\delta)} \\}.\n$$\nDefine $E_{\\delta}(\\omega) \\equiv E_{\\mathrm{sig}}(\\omega) e^{-i \\delta} = [a(\\omega) + i b(\\omega)](\\cos \\delta - i \\sin \\delta) = [a \\cos \\delta + b \\sin \\delta] + i [b \\cos \\delta - a \\sin \\delta]$. The four measured intensities are identical in form to the ideal case but with $E_{\\mathrm{sig}}$ replaced by $E_{\\delta}$. Therefore, the same linear combinations yield\n$$\n\\widehat{a}_{\\delta}(\\omega) = \\mathrm{Re}\\,E_{\\delta}(\\omega) = a(\\omega) \\cos \\delta + b(\\omega) \\sin \\delta,\n$$\n$$\n\\widehat{b}_{\\delta}(\\omega) = \\mathrm{Im}\\,E_{\\delta}(\\omega) = b(\\omega) \\cos \\delta - a(\\omega) \\sin \\delta.\n$$\nHence a constant phase error $\\delta$ rotates the quadratures and mixes the real and imaginary parts. The retrieved imaginary part equals the true imaginary part only when $\\delta = 0$ modulo $2 \\pi$.\n\nFor a frequency-dependent LO phase drift $\\delta(\\omega)$, the same analysis holds pointwise in frequency, yielding\n$$\n\\widehat{b}_{\\delta}(\\omega) = b(\\omega) \\cos \\delta(\\omega) - a(\\omega) \\sin \\delta(\\omega).\n$$\nThis expression shows that a drift $\\delta(\\omega)$ introduces a frequency-dependent mixing between $a(\\omega)$ and $b(\\omega)$, distorting the lineshape in a predictable way.\n\nWe now specify the susceptibility model and the numerical procedure. The susceptibility is\n$$\n\\chi^{(2)}(\\omega) = \\chi_{\\mathrm{NR}} + \\frac{A}{\\omega_{0} - \\omega - i \\Gamma} = \\chi_{\\mathrm{NR}} + \\frac{A(\\omega_{0} - \\omega) + i A \\Gamma}{(\\omega_{0} - \\omega)^{2} + \\Gamma^{2}}.\n$$\nWith $\\chi_{\\mathrm{NR}} = 0.6$, $A = 2.0$, $\\omega_{0} = 3000~\\mathrm{cm}^{-1}$, and $\\Gamma = 10~\\mathrm{cm}^{-1}$, we compute\n$$\na(\\omega) = \\chi_{\\mathrm{NR}} + \\frac{A(\\omega_{0} - \\omega)}{(\\omega_{0} - \\omega)^{2} + \\Gamma^{2}}, \\quad b(\\omega) = \\frac{A \\Gamma}{(\\omega_{0} - \\omega)^{2} + \\Gamma^{2}}.\n$$\nWe discretize $\\omega$ uniformly from $2800~\\mathrm{cm}^{-1}$ to $3200~\\mathrm{cm}^{-1}$ in steps of $1~\\mathrm{cm}^{-1}$, and simulate the measured intensities with LO phase steps $\\phi_{k} \\in \\{0, \\pi/2, \\pi, 3\\pi/2\\}$ including a phase error $\\delta(\\omega) = \\delta_{0} + s (\\omega - \\omega_{0})$. For each test case $(\\delta_{0}, s)$ we compute the four intensities, form the four-step linear combination to retrieve $\\widehat{b}(\\omega)$, and evaluate the normalized root-mean-square error (NRMSE),\n$$\n\\mathrm{NRMSE} = \\frac{\\sqrt{\\frac{1}{N}\\sum_{j=1}^{N}\\left[\\widehat{b}(\\omega_{j}) - b(\\omega_{j})\\right]^{2}}}{\\max_{j} b(\\omega_{j}) - \\min_{j} b(\\omega_{j})}.\n$$\nIn the ideal case $(\\delta_{0}, s) = (0, 0)$, the derived algebra guarantees $\\widehat{b}(\\omega_{j}) = b(\\omega_{j})$ at every frequency $j$, so the numerator of $\\mathrm{NRMSE}$ is identically $0$ and $\\mathrm{NRMSE} = 0$. For nonzero $\\delta_{0}$ and/or nonzero $s$, the retrieval mixes $a(\\omega)$ into $\\widehat{b}(\\omega)$ via $\\widehat{b}(\\omega) = b(\\omega) \\cos \\delta(\\omega) - a(\\omega) \\sin \\delta(\\omega)$, inflating the NRMSE in a manner that increases with the magnitude of $\\delta(\\omega)$ and with the magnitude of $a(\\omega)$ relative to $b(\\omega)$.\n\nAlgorithmic design for the program:\n- Precompute $\\omega_{j}$ over the specified grid and evaluate $a(\\omega_{j})$ and $b(\\omega_{j})$ from the closed-form expressions above.\n- For each test case $(\\delta_{0}, s)$, compute $\\delta(\\omega_{j}) = \\delta_{0} + s (\\omega_{j} - \\omega_{0})$.\n- Compute four intensities $I(\\phi_{k} + \\delta(\\omega_{j}), \\omega_{j}) = 1 + 2 \\mathrm{Re}\\{ [a(\\omega_{j}) + i b(\\omega_{j})] e^{-i (\\phi_{k} + \\delta(\\omega_{j}))} \\}$ for $\\phi_{k} \\in \\{0, \\pi/2, \\pi, 3\\pi/2\\}$.\n- Retrieve $\\widehat{b}(\\omega_{j}) = \\left[I(\\pi/2 + \\delta(\\omega_{j}), \\omega_{j}) - I(3\\pi/2 + \\delta(\\omega_{j}), \\omega_{j})\\right]/4$ using the derived cycling combination.\n- Compute the $\\mathrm{NRMSE}$ between $\\widehat{b}(\\omega_{j})$ and the ground truth $b(\\omega_{j})$ across all $N$ frequencies.\n- Report the five $\\mathrm{NRMSE}$ values corresponding to the test suite in the specified order and format, with exactly six digits after the decimal point.\n\nThis approach strictly follows from the fundamental heterodyne interference expression, definitions of complex quadratures, and the specified susceptibility model, and it demonstrates quantitatively how phase cycling isolates the imaginary part and how phase errors and LO drift degrade the retrieval.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef chi2_model(omega, chi_nr=0.6, A=2.0, omega0=3000.0, gamma=10.0):\n    # Compute complex chi^(2)(omega) = chi_nr + A/(omega0 - omega - i*gamma)\n    denom = (omega0 - omega) - 1j * gamma\n    return chi_nr + A / denom\n\ndef simulate_intensities(chi, phases, delta):\n    # chi: complex array over frequency\n    # phases: list/array of phase steps (in radians)\n    # delta: array of phase errors per frequency (in radians)\n    # Returns list of intensity arrays for each phase\n    # Model: I = 1 + 2 * Re{ chi * exp(-i*(phi + delta)) }\n    intensities = []\n    for phi in phases:\n        exp_term = np.exp(-1j * (phi + delta))\n        I = 1.0 + 2.0 * np.real(chi * exp_term)\n        intensities.append(I)\n    return intensities\n\ndef retrieve_imag_from_4step(I0, I90, I180, I270):\n    # Four-step phase cycling retrieval of imaginary part:\n    # Im_est = (I(90 deg) - I(270 deg))/4\n    return (I90 - I270) / 4.0\n\ndef nrmse(yhat, ytrue):\n    diff = yhat - ytrue\n    mse = np.mean(diff**2)\n    rmse = np.sqrt(mse)\n    ptp = np.max(ytrue) - np.min(ytrue)\n    # Avoid division by zero; for non-trivial Lorentzian, ptp > 0.\n    if ptp == 0:\n        return 0.0\n    return rmse / ptp\n\ndef solve():\n    # Frequency grid in cm^-1\n    omega = np.arange(2800.0, 3200.0 + 1e-9, 1.0)\n    omega0 = 3000.0\n\n    # Model parameters\n    chi_nr = 0.6\n    A = 2.0\n    gamma = 10.0\n\n    # Compute chi^(2) and its true imaginary part\n    chi = chi2_model(omega, chi_nr=chi_nr, A=A, omega0=omega0, gamma=gamma)\n    b_true = np.imag(chi)\n\n    # Four-step phases: 0, pi/2, pi, 3pi/2\n    phases = np.array([0.0, 0.5*np.pi, np.pi, 1.5*np.pi])\n\n    # Test suite: (delta0, slope)\n    test_cases = [\n        (0.0, 0.0),                    # Case A: ideal\n        (np.pi/18.0, 0.0),             # Case B: constant phase error\n        (0.0, 2e-3),                   # Case C: moderate drift\n        (np.pi/18.0, 2e-3),            # Case D: error + drift\n        (0.0, 1e-2),                   # Case E: strong drift\n    ]\n\n    results = []\n    for delta0, slope in test_cases:\n        # Frequency-dependent LO phase error/drift\n        delta = delta0 + slope * (omega - omega0)\n\n        # Simulate intensities at 4 phase steps with drift/error included\n        I_list = simulate_intensities(chi, phases, delta)\n        I0, I90, I180, I270 = I_list[0], I_list[1], I_list[2], I_list[3]\n\n        # Retrieve imaginary part via four-step combination\n        b_hat = retrieve_imag_from_4step(I0, I90, I180, I270)\n\n        # Compute NRMSE between retrieved and true imaginary parts\n        err = nrmse(b_hat, b_true)\n        results.append(err)\n\n    # Format with exactly six digits after the decimal point\n    formatted = \"[\" + \",\".join(f\"{x:.6f}\" for x in results) + \"]\"\n    print(formatted)\n\nsolve()\n```", "id": "2670192"}]}