{"hands_on_practices": [{"introduction": "The foundation of integral screening lies in the ability to estimate an integral's magnitude without computing it fully. This practice explores the cornerstone of this approach: the Cauchy-Schwarz inequality. By applying this inequality to electron repulsion integrals, we can derive a rigorous upper bound, allowing us to make computationally inexpensive decisions about which integrals are negligible [@problem_id:2898934]. This exercise will give you hands-on experience using this bound to screen an integral quartet and quantify its maximum potential contribution to the Fock matrix.", "problem": "In building the Coulomb contribution to the Fock matrix in a restricted Hartree–Fock (RHF) procedure over a real Gaussian atomic orbital basis, consider the two-electron repulsion integral defined by\n$$(\\mu\\nu|\\lambda\\sigma) \\equiv \\iint \\varphi_{\\mu}(\\mathbf{r}_{1})\\,\\varphi_{\\nu}(\\mathbf{r}_{1})\\,\\frac{1}{r_{12}}\\,\\varphi_{\\lambda}(\\mathbf{r}_{2})\\,\\varphi_{\\sigma}(\\mathbf{r}_{2})\\,d\\mathbf{r}_{1}\\,d\\mathbf{r}_{2},$$\nwhere $r_{12} = |\\mathbf{r}_{1}-\\mathbf{r}_{2}|$ and $\\{\\varphi_{\\kappa}\\}$ are normalized basis functions. In integral screening, a common prescreening step is based on the Cauchy–Schwarz inequality applied to suitable $L^{2}$ inner products on functions of $(\\mathbf{r}_{1},\\mathbf{r}_{2})$.\n\nStarting from the definition above and the Cauchy–Schwarz inequality for square-integrable functions, derive a rigorous upper bound on $|(\\mu\\nu|\\lambda\\sigma)|$ in terms of $(\\mu\\nu|\\mu\\nu)$ and $(\\lambda\\sigma|\\lambda\\sigma)$. Then, using a user-specified screening threshold $\\tau0$, state a criterion under which the shell quartet $(\\mu\\nu,\\lambda\\sigma)$ can be skipped in the Coulomb build for the Fock element $F_{\\mu\\nu}$. If the quartet is not skipped, use your bound to determine the maximum possible magnitude of the Coulomb contribution to $F_{\\mu\\nu}$ arising from a single density matrix element $D_{\\lambda\\sigma}$.\n\nUse the following data:\n$$(\\mu\\nu|\\mu\\nu) = 0.80\\ \\text{Hartree},\\quad (\\lambda\\sigma|\\lambda\\sigma) = 0.45\\ \\text{Hartree},\\quad \\tau = 0.55\\ \\text{Hartree},\\quad D_{\\lambda\\sigma} = 0.18.$$\n\nReport a single numerical value for the maximum possible magnitude of the Coulomb contribution to $F_{\\mu\\nu}$ from the given $(\\mu\\nu,\\lambda\\sigma)$ quartet, in Hartree, using the convention that if the quartet is skipped the reported value is $0$. Round your answer to four significant figures and express the final energy in Hartree.", "solution": "The problem asks for three sequential results: first, the derivation of an upper bound for a two-electron repulsion integral (ERI); second, a criterion for screening this integral; and third, the calculation of a maximum contribution to the Coulomb matrix based on this screening.\n\nLet us begin with the definition of the two-electron repulsion integral:\n$$(\\mu\\nu|\\lambda\\sigma) \\equiv \\iint \\varphi_{\\mu}(\\mathbf{r}_{1})\\,\\varphi_{\\nu}(\\mathbf{r}_{1})\\,\\frac{1}{r_{12}}\\,\\varphi_{\\lambda}(\\mathbf{r}_{2})\\,\\varphi_{\\sigma}(\\mathbf{r}_{2})\\,d\\mathbf{r}_{1}\\,d\\mathbf{r}_{2}$$\nwhere $r_{12} = |\\mathbf{r}_{1}-\\mathbf{r}_{2}|$. We define the charge distributions (or basis function products) as $\\rho_{\\mu\\nu}(\\mathbf{r}) = \\varphi_{\\mu}(\\mathbf{r})\\varphi_{\\nu}(\\mathbf{r})$ and $\\rho_{\\lambda\\sigma}(\\mathbf{r}) = \\varphi_{\\lambda}(\\mathbf{r})\\varphi_{\\sigma}(\\mathbf{r})$. The integral can then be expressed more compactly:\n$$(\\mu\\nu|\\lambda\\sigma) = \\iint \\rho_{\\mu\\nu}(\\mathbf{r}_{1})\\,\\frac{1}{r_{12}}\\,\\rho_{\\lambda\\sigma}(\\mathbf{r}_{2})\\,d\\mathbf{r}_{1}\\,d\\mathbf{r}_{2}$$\nThis expression defines an inner product on the space of real, square-integrable functions. For any two such functions, $f(\\mathbf{r})$ and $g(\\mathbf{r})$, their inner product is given by:\n$$\\langle f|g \\rangle = \\iint f(\\mathbf{r}_{1})\\,\\frac{1}{r_{12}}\\,g(\\mathbf{r}_{2})\\,d\\mathbf{r}_{1}\\,d\\mathbf{r}_{2}$$\nThe operator corresponding to the kernel $\\frac{1}{r_{12}}$ is positive-definite, which ensures that this is a valid inner product. The Cauchy–Schwarz inequality for this inner product states that $|\\langle f|g \\rangle|^2 \\le \\langle f|f \\rangle \\langle g|g \\rangle$.\n\nBy setting $f = \\rho_{\\mu\\nu}$ and $g = \\rho_{\\lambda\\sigma}$, we can apply the Cauchy-Schwarz inequality directly to the ERI:\n$$|(\\mu\\nu|\\lambda\\sigma)|^2 = |\\langle \\rho_{\\mu\\nu}|\\rho_{\\lambda\\sigma} \\rangle|^2 \\le \\langle \\rho_{\\mu\\nu}|\\rho_{\\mu\\nu} \\rangle \\langle \\rho_{\\lambda\\sigma}|\\rho_{\\lambda\\sigma} \\rangle$$\nTranslating back to the standard ERI notation, we obtain:\n$$|(\\mu\\nu|\\lambda\\sigma)|^2 \\le (\\mu\\nu|\\mu\\nu)(\\lambda\\sigma|\\lambda\\sigma)$$\nTaking the square root of both sides yields the rigorous upper bound for the magnitude of the integral:\n$$|(\\mu\\nu|\\lambda\\sigma)| \\le \\sqrt{(\\mu\\nu|\\mu\\nu)(\\lambda\\sigma|\\lambda\\sigma)}$$\nThis is the widely used Schwarz inequality for electron repulsion integrals.\n\nNext, we establish the screening criterion. In a prescreening step, one seeks to avoid the computation of negligible integrals. A common criterion is to compare the derived upper bound to a specified threshold. Let $I_{max} = \\sqrt{(\\mu\\nu|\\mu\\nu)(\\lambda\\sigma|\\lambda\\sigma)}$. The problem provides a screening threshold $\\tau$. The quartet $(\\mu\\nu,\\lambda\\sigma)$ is deemed negligible and thus skipped if its maximum possible magnitude, $I_{max}$, is smaller than this threshold. The criterion is:\n$$\\text{Skip quartet if } \\sqrt{(\\mu\\nu|\\mu\\nu)(\\lambda\\sigma|\\lambda\\sigma)}  \\tau$$\n\nWe now apply this criterion using the provided data: $(\\mu\\nu|\\mu\\nu) = 0.80$ Hartree, $(\\lambda\\sigma|\\lambda\\sigma) = 0.45$ Hartree, and $\\tau = 0.55$ Hartree.\nFirst, we compute the upper bound $I_{max}$:\n$$I_{max} = \\sqrt{(0.80)(0.45)} = \\sqrt{0.36} = 0.60\\ \\text{Hartree}$$\nNow, we compare this bound to the threshold $\\tau$:\n$$0.60  0.55$$\nThis inequality is false. Therefore, based on the specified criterion and data, the integral quartet $(\\mu\\nu,\\lambda\\sigma)$ is **not** skipped.\n\nThe final task is to determine the maximum possible magnitude of the Coulomb contribution to the Fock matrix element $F_{\\mu\\nu}$ from this specific quartet. The Coulomb contribution from the density matrix element $D_{\\lambda\\sigma}$ is given by the term $C = D_{\\lambda\\sigma} (\\mu\\nu|\\lambda\\sigma)$. The magnitude of this contribution is $|C| = |D_{\\lambda\\sigma}| |(\\mu\\nu|\\lambda\\sigma)|$. The maximum possible magnitude, $|C|_{max}$, occurs when $|(\\mu\\nu|\\lambda\\sigma)|$ is at its upper bound, $I_{max}$:\n$$|C|_{max} = |D_{\\lambda\\sigma}| \\times I_{max}$$\nUsing the given value $D_{\\lambda\\sigma} = 0.18$ and our calculated value $I_{max} = 0.60$ Hartree:\n$$|C|_{max} = |0.18| \\times 0.60 = 0.18 \\times 0.60 = 0.108\\ \\text{Hartree}$$\nThe problem demands the answer be reported to four significant figures. Thus, we express $0.108$ as $0.1080$.\nIf the quartet had been skipped, the answer would be $0$. Since it was not, the calculated maximum contribution is the correct response.", "answer": "$$\\boxed{0.1080}$$", "id": "2898934"}, {"introduction": "While powerful, the Schwarz inequality must be applied with care, especially when dealing with modern contracted basis sets. A naive estimation based on individual primitive functions can severely underestimate the true integral value due to constructive interference effects. This exercise presents a carefully constructed scenario where such a naive approach fails, forcing you to diagnose the problem and identify a robust, multi-stage screening protocol that avoids this pitfall [@problem_id:2899009].", "problem": "Consider electron repulsion integrals (ERIs) in a Gaussian basis, defined for contracted Gaussian-type orbitals (CGTOs) as follows. Each contracted basis function is a linear combination of normalized primitives, $\\chi_{\\mu}(\\mathbf{r}) = \\sum_{p} c_{\\mu p} g_{\\mu p}(\\mathbf{r})$, and a general ERI is $(\\mu\\nu|\\lambda\\sigma) = \\iint \\chi_{\\mu}(\\mathbf{r}_1)\\chi_{\\nu}(\\mathbf{r}_1)\\frac{1}{r_{12}}\\chi_{\\lambda}(\\mathbf{r}_2)\\chi_{\\sigma}(\\mathbf{r}_2)\\,d\\mathbf{r}_1 d\\mathbf{r}_2$. By the Cauchy–Schwarz inequality (CSI), one has the bound $|(\\mu\\nu|\\lambda\\sigma)| \\le \\| \\mu\\nu \\| \\cdot \\| \\lambda\\sigma \\|$, where $\\| \\mu\\nu \\| \\equiv \\sqrt{(\\mu\\nu|\\mu\\nu)}$. In practice, integral screening often estimates $\\|\\mu\\nu\\|$ cheaply before deciding whether to compute $(\\mu\\nu|\\lambda\\sigma)$.\n\nYou are given a concrete shell-pair example designed to probe failure modes of a naive Schwarz screening that ignores contraction effects. Let there be two shell pairs, $AB$ and $CD$, each built from two primitives per shell, such that the contracted shell-pair “vectors” in the Coulomb metric can be expressed as linear combinations of two nearly parallel primitive product contributions,\n$\\mathbf{v}_{AB} = w_1 \\mathbf{v}_1 + w_2 \\mathbf{v}_2$ and $\\mathbf{v}_{CD} = u_1 \\mathbf{u}_1 + u_2 \\mathbf{u}_2$. Suppose the following explicit data hold:\n- For $AB$: $\\|\\mathbf{v}_1\\| = \\|\\mathbf{v}_2\\| = 10^{-2}$, $\\langle \\mathbf{v}_1,\\mathbf{v}_2 \\rangle = 0.99 \\times 10^{-4}$, and weights $w_1 = w_2 = 5$ arising from the contraction coefficients and normalization.\n- For $CD$: $\\|\\mathbf{u}_1\\| = \\|\\mathbf{u}_2\\| = 10^{-2}$, $\\langle \\mathbf{u}_1,\\mathbf{u}_2 \\rangle = 0.99 \\times 10^{-4}$, and weights $u_1 = u_2 = 5$.\n\nAssume further that the relative orientation of the contracted shell-pair vectors satisfies $\\langle \\mathbf{v}_{AB}, \\mathbf{v}_{CD} \\rangle = \\cos\\theta \\, \\|\\mathbf{v}_{AB}\\| \\, \\|\\mathbf{v}_{CD}\\|$ with $\\cos\\theta = 0.5$. A screening threshold $\\tau$ is used as follows: if an estimator $\\widehat{\\|\\mu\\nu\\|}$ is available, the code skips $(\\mu\\nu|\\lambda\\sigma)$ when $\\widehat{\\|\\mu\\nu\\|}\\,\\widehat{\\|\\lambda\\sigma\\|}  \\tau$. Take $\\tau = 10^{-3}$.\n\nA developer proposes a naive single-stage estimate that ignores contraction structure and takes $\\widehat{\\|AB\\|} = \\max_{i\\in\\{1,2\\}} \\|\\mathbf{v}_i\\|$ and similarly for $CD$. You are asked to analyze whether this naive screening can miss large ERIs in the concrete example above, and to select a robust multi-stage screening that would not miss them, using only fundamental inequalities (Cauchy–Schwarz and the triangle inequality) and definitions.\n\nWhich option below gives a correct diagnosis of the failure and a robust, safe multi-stage screening protocol that avoids missing the large ERIs in this example, while remaining computationally efficient?\n\nA. Use only the naive single-stage bound $\\widehat{\\|AB\\|} = \\max_{i} \\|\\mathbf{v}_i\\|$ and $\\widehat{\\|CD\\|} = \\max_{j} \\|\\mathbf{u}_j\\|$. Because each primitive norm is an upper bound for any contraction, this is guaranteed safe; the product $10^{-2}\\cdot 10^{-2} = 10^{-4}$ is below $\\tau$, so $(AB|CD)$ can be skipped.\n\nB. Use a two-stage contraction-aware Schwarz screening. Stage $1$: apply the triangle inequality to get the safe but cheap bound $\\widehat{\\|AB\\|}_{1} = \\sum_{i} |w_i| \\|\\mathbf{v}_i\\|$ and $\\widehat{\\|CD\\|}_{1} = \\sum_{j} |u_j| \\|\\mathbf{u}_j\\|$; if $\\widehat{\\|AB\\|}_{1}\\,\\widehat{\\|CD\\|}_{1}  \\tau$, safely skip. Otherwise, Stage $2$: compute the exact contracted shell-pair norms via the primitive Coulomb metric, $\\|AB\\|^2 = \\mathbf{w}^\\top \\mathbf{M}^{(AB)} \\mathbf{w}$ and $\\|CD\\|^2 = \\mathbf{u}^\\top \\mathbf{M}^{(CD)} \\mathbf{u}$ with $\\mathbf{M}^{(AB)}_{ij} = \\langle \\mathbf{v}_i,\\mathbf{v}_j\\rangle$ and similarly for $CD$, and then apply the contracted Schwarz bound to decide. For building the Fock matrix, add density-weighted screening $|P_{\\mu\\nu}|\\,\\| \\mu\\nu \\|$ to reduce work further.\n\nC. Replace the Coulomb-metric Schwarz bound by overlap-metric screening, estimating $\\|\\mu\\nu\\|$ by $\\|S_{\\mu\\nu}\\| \\equiv \\sqrt{\\langle \\chi_\\mu \\chi_\\nu, \\chi_\\mu \\chi_\\nu \\rangle_S}$, where $\\langle \\cdot,\\cdot \\rangle_S$ is the overlap inner product, because overlaps are cheaper. Since overlap decays faster with distance than Coulomb interactions, this will be even safer than Schwarz.\n\nD. Rely exclusively on center-to-center distance screening. Use a point-charge estimate $\\widehat{|(\\mu\\nu|\\lambda\\sigma)|} = 1/R_{\\text{min}}$, where $R_{\\text{min}}$ is the minimum inter-center distance among $\\{A,B\\}$ and $\\{C,D\\}$, ignoring contraction coefficients and exponents. This is a universal upper bound, so any integral with $\\widehat{|(\\mu\\nu|\\lambda\\sigma)|}  \\tau$ can be skipped safely.", "solution": "The problem describes a known, non-trivial complication in quantum chemical integral evaluation using a concrete, formalizable example. The task is to analyze the failure of a naive screening protocol and identify a robust alternative. We proceed with a rigorous analysis.\n\nFirst, we analyze the naive screening protocol. The estimator for the norm of the contracted shell-pair $AB$ is $\\widehat{\\|AB\\|} = \\max_{i} \\|\\mathbf{v}_i\\|$. Given $\\|\\mathbf{v}_1\\| = \\|\\mathbf{v}_2\\| = 10^{-2}$, this gives $\\widehat{\\|AB\\|} = 10^{-2}$. The data for shell-pair $CD$ is identical, so $\\widehat{\\|CD\\|} = \\max_{j} \\|\\mathbf{u}_j\\| = 10^{-2}$. The screening condition is based on the product of these estimators:\n$$ \\widehat{\\|AB\\|} \\cdot \\widehat{\\|CD\\|} = (10^{-2}) \\cdot (10^{-2}) = 10^{-4} $$\nThe given threshold is $\\tau = 10^{-3}$. Since $10^{-4}  10^{-3}$, this naive protocol would discard the integral $(AB|CD)$ without computation.\n\nNext, we must determine if this decision is correct by calculating an accurate value for the integral. The integral is defined as the inner product $(AB|CD) = \\langle \\mathbf{v}_{AB}, \\mathbf{v}_{CD} \\rangle$. We are given that $\\langle \\mathbf{v}_{AB}, \\mathbf{v}_{CD} \\rangle = 0.5 \\cdot \\|\\mathbf{v}_{AB}\\| \\cdot \\|\\mathbf{v}_{CD}\\|$. We must compute the exact norms of the contracted shell-pair vectors.\nFor $\\mathbf{v}_{AB}$:\n$$ \\|\\mathbf{v}_{AB}\\|^2 = \\langle w_1 \\mathbf{v}_1 + w_2 \\mathbf{v}_2, w_1 \\mathbf{v}_1 + w_2 \\mathbf{v}_2 \\rangle $$\n$$ \\|\\mathbf{v}_{AB}\\|^2 = w_1^2 \\|\\mathbf{v}_1\\|^2 + w_2^2 \\|\\mathbf{v}_2\\|^2 + 2 w_1 w_2 \\langle \\mathbf{v}_1, \\mathbf{v}_2 \\rangle $$\nSubstituting the provided data:\n$$ \\|\\mathbf{v}_{AB}\\|^2 = (5^2)(10^{-2})^2 + (5^2)(10^{-2})^2 + 2(5)(5)(0.99 \\times 10^{-4}) $$\n$$ \\|\\mathbf{v}_{AB}\\|^2 = 25 \\times 10^{-4} + 25 \\times 10^{-4} + 50 \\times 0.99 \\times 10^{-4} $$\n$$ \\|\\mathbf{v}_{AB}\\|^2 = 50 \\times 10^{-4} + 49.5 \\times 10^{-4} = 99.5 \\times 10^{-4} $$\nThe data for $\\mathbf{v}_{CD}$ is identical, so $\\|\\mathbf{v}_{CD}\\|^2 = 99.5 \\times 10^{-4}$.\nNow we calculate the value of the integral $(AB|CD)$:\n$$ (AB|CD) = 0.5 \\cdot \\|\\mathbf{v}_{AB}\\| \\cdot \\|\\mathbf{v}_{CD}\\| = 0.5 \\cdot \\sqrt{99.5 \\times 10^{-4}} \\cdot \\sqrt{99.5 \\times 10^{-4}} $$\n$$ (AB|CD) = 0.5 \\cdot (99.5 \\times 10^{-4}) = 49.75 \\times 10^{-4} = 4.975 \\times 10^{-3} $$\nThe magnitude of the integral is $|(AB|CD)| = 4.975 \\times 10^{-3}$. This value is greater than the screening threshold $\\tau = 10^{-3}$. The naive screening protocol, which estimated the contribution to be on the order of $10^{-4}$, has failed catastrophically and would have incorrectly discarded a numerically significant integral. The failure originates from the constructive interference between primitive product distributions ($\\mathbf{v}_1$ and $\\mathbf{v}_2$ are nearly parallel, as $\\langle \\mathbf{v}_1, \\mathbf{v}_2 \\rangle / (\\|\\mathbf{v}_1\\|\\|\\mathbf{v}_2\\|) = 0.99$) amplified by large contraction coefficients.\n\nWe now evaluate the given options.\n\nA. This option advocates for the naive screening, claiming it is \"guaranteed safe\" because \"each primitive norm is an upper bound for any contraction\". This premise is demonstrably false. We calculated the contracted norm $\\|\\mathbf{v}_{AB}\\| = \\sqrt{99.5 \\times 10^{-4}} \\approx 9.975 \\times 10^{-2}$, which is almost an order of magnitude larger than the primitive norms $\\|\\mathbf{v}_i\\| = 10^{-2}$. The conclusion to skip the integral is incorrect, as shown above.\nVerdict: **Incorrect**.\n\nB. This option proposes a two-stage screening protocol.\nStage $1$: A safe upper bound is established using the triangle inequality: $\\|\\mathbf{v}_{AB}\\| = \\|w_1 \\mathbf{v}_1 + w_2 \\mathbf{v}_2\\| \\le |w_1|\\|\\mathbf{v}_1\\| + |w_2|\\|\\mathbf{v}_2\\|$. This is a mathematically rigorous upper bound. Let us compute this estimator, $\\widehat{\\|AB\\|}_{1}$:\n$$ \\widehat{\\|AB\\|}_{1} = |5| \\cdot 10^{-2} + |5| \\cdot 10^{-2} = 10 \\times 10^{-2} = 10^{-1} $$\nSimilarly, $\\widehat{\\|CD\\|}_{1} = 10^{-1}$. The screening product is $\\widehat{\\|AB\\|}_{1} \\cdot \\widehat{\\|CD\\|}_{1} = 10^{-1} \\cdot 10^{-1} = 10^{-2}$.\nSince $10^{-2}  \\tau = 10^{-3}$, this first stage correctly prevents the integral from being skipped and mandates proceeding to the next stage.\nStage $2$: This stage involves computing the exact contracted norm squared, $\\|AB\\|^2 = \\mathbf{w}^\\top \\mathbf{M}^{(AB)} \\mathbf{w}$, where $\\mathbf{M}^{(AB)}_{ij} = \\langle \\mathbf{v}_i, \\mathbf{v}_j \\rangle$. This is precisely the calculation we performed to find $\\|\\mathbf{v}_{AB}\\|^2 = 99.5 \\times 10^{-4}$. The resulting Schwarz bound is $\\|\\mathbf{v}_{AB}\\| \\cdot \\|\\mathbf{v}_{CD}\\| = 99.5 \\times 10^{-4} \\approx 10^{-2}$. As this value is greater than $\\tau=10^{-3}$, the integral is correctly flagged for full computation. This two-stage protocol is both robust (it provides a mathematically guaranteed upper bound at each stage) and efficient (the expensive Stage $2$ is performed only when the cheap Stage $1$ indicates necessity). The final comment on density-weighted screening is an accurate description of further optimization in practical codes.\nVerdict: **Correct**.\n\nC. This option suggests replacing the Coulomb-metric Schwarz bound with an overlap-metric screening. The claim is that this is \"even safer\" because overlap supposedly decays faster than Coulomb interactions. This is fundamentally flawed. Safety in screening requires a rigorous upper bound. There is no general inequality that guarantees that the overlap norm $\\sqrt{\\int (\\chi_\\mu\\chi_\\nu)^2 d\\mathbf{r}}$ provides an upper bound for the Coulomb norm $\\sqrt{(\\mu\\nu|\\mu\\nu)}$. For diffuse functions, whose charge distributions are widespread, the overlap can be small while the long-range Coulomb interaction remains significant. This protocol is not guaranteed to be safe and relies on a physical heuristic rather than mathematical rigor.\nVerdict: **Incorrect**.\n\nD. This option proposes using a point-charge approximation, $\\widehat{|(\\mu\\nu|\\lambda\\sigma)|} = 1/R_{\\text{min}}$, and claims it is a \"universal upper bound\". This is patently false. The value of an ERI depends critically on the spatial extent and overlap of the four basis functions, which is dictated by their exponents and contraction coefficients, not just the distance between their centers. One can easily construct counterexamples. For instance, for two highly diffuse, overlapping charge distributions, the integral can be very large even for a large $R_{\\text{min}}$. Conversely, for four very compact functions, the integral might be negligible even for a small $R_{\\text{min}}$. This estimator is a crude approximation, not a rigorous bound, and is therefore unsafe for screening.\nVerdict: **Incorrect**.\n\nIn conclusion, only option B correctly diagnoses the failure of the naive method and proposes a mathematically sound, robust, and staged screening protocol that correctly handles the given case of constructive interference in contracted basis functions.", "answer": "$$\\boxed{B}$$", "id": "2899009"}, {"introduction": "Mastering a concept often means being able to implement it from scratch. This practice takes you deep into the algorithmic heart of Schwarz screening, challenging you to write a program that computes the necessary shell-pair bounds from first principles. You will implement the analytical formulas for electron repulsion integrals over contracted s-type Gaussians, including the numerical evaluation of the Boys function, to build a functional screening routine [@problem_id:2898970].", "problem": "Construct a complete, runnable program that, given a fixed set of contracted, normalized, Cartesian $s$-type Gaussian shells and a set of shell quartets with thresholds, computes a shell-pair bound $B_{IJ}$ for each shell pair $\\left(I,J\\right)$ and screens a shell quartet $\\left(I,J\\mid K,L\\right)$ if and only if $B_{IJ}\\,B_{KL}\\tau$. Your program must implement the computation from first principles, starting from the following accepted foundations.\n\nFoundational definitions and facts to use:\n- A primitive, normalized, $s$-type Gaussian centered at $\\mathbf{A}\\in\\mathbb{R}^{3}$ with exponent $\\alpha0$ is $\\phi\\left(\\mathbf{r};\\alpha,\\mathbf{A}\\right)=N\\left(\\alpha\\right)\\,\\exp\\left(-\\alpha\\left\\lVert\\mathbf{r}-\\mathbf{A}\\right\\rVert^{2}\\right)$, where $N\\left(\\alpha\\right)=\\left(\\dfrac{2\\alpha}{\\pi}\\right)^{3/4}$.\n- A contracted $s$-type shell $I$ is a linear combination $\\Phi_{I}\\left(\\mathbf{r}\\right)=\\sum_{a=1}^{n_{I}} d_{a}^{\\left(I\\right)}\\,\\phi\\left(\\mathbf{r};\\alpha_{a}^{\\left(I\\right)},\\mathbf{A}_{I}\\right)$ with real contraction coefficients $d_{a}^{\\left(I\\right)}$ and primitive exponents $\\alpha_{a}^{\\left(I\\right)}0$, all sharing the same center $\\mathbf{A}_{I}$.\n- The electron repulsion integral over two products of contracted shells is defined as $\\left(IJ\\mid KL\\right)=\\displaystyle\\iint \\dfrac{\\Phi_{I}\\left(\\mathbf{r}_{1}\\right)\\Phi_{J}\\left(\\mathbf{r}_{1}\\right)\\,\\Phi_{K}\\left(\\mathbf{r}_{2}\\right)\\Phi_{L}\\left(\\mathbf{r}_{2}\\right)}{\\left\\lVert\\mathbf{r}_{1}-\\mathbf{r}_{2}\\right\\rVert}\\,\\mathrm{d}\\mathbf{r}_{1}\\,\\mathrm{d}\\mathbf{r}_{2}$.\n- The Cauchy–Schwarz inequality implies the screening bound $\\left\\lvert\\left(IJ\\mid KL\\right)\\right\\rvert\\le \\sqrt{\\left(IJ\\mid IJ\\right)}\\,\\sqrt{\\left(KL\\mid KL\\right)}$. Define the shell-pair bound $B_{IJ}=\\sqrt{\\left(IJ\\mid IJ\\right)}$.\n- The Gaussian product theorem and well-tested one-dimensional integral reductions lead to closed forms for primitive $s$-type electron repulsion integrals in terms of the Boys function of order $0$, $F_{0}\\!\\left(T\\right)=\\dfrac{1}{2}\\sqrt{\\dfrac{\\pi}{T}}\\,\\mathrm{erf}\\!\\left(\\sqrt{T}\\right)$ for $T0$, with the continuous limit $F_{0}\\!\\left(0\\right)=1$. Your program must evaluate $F_{0}\\!\\left(T\\right)$ in a numerically stable manner for all $T\\ge 0$.\n\nAlgorithmic task:\n- Using only the foundational items above, derive and implement an algorithm to evaluate $\\left(IJ\\mid IJ\\right)$ exactly for contracted $s$-type shells by expansion into primitive integrals and numerical evaluation of the Boys function, and from it compute $B_{IJ}$. Then, for each quartet $\\left(I,J\\mid K,L\\right)$ with threshold $\\tau$, decide if it is screened by testing $B_{IJ}\\,B_{KL}\\tau$.\n\nInput embedded in this task (fixed test suite):\n- There are $4$ shells, indexed $0,1,2,3$, each an $s$-type contracted Gaussian shell with the following parameters:\n  - Shell $0$: center $\\mathbf{A}_{0}=\\left(0.0,0.0,0.0\\right)$, exponents $\\left[\\alpha\\right]=\\left[0.5,0.15\\right]$, coefficients $\\left[d\\right]=\\left[0.6,0.4\\right]$.\n  - Shell $1$: center $\\mathbf{A}_{1}=\\left(1.2,0.0,0.0\\right)$, exponents $\\left[\\alpha\\right]=\\left[0.9\\right]$, coefficients $\\left[d\\right]=\\left[1.0\\right]$.\n  - Shell $2$: center $\\mathbf{A}_{2}=\\left(0.0,2.0,0.0\\right)$, exponents $\\left[\\alpha\\right]=\\left[0.3,1.0\\right]$, coefficients $\\left[d\\right]=\\left[0.7,0.3\\right]$.\n  - Shell $3$: center $\\mathbf{A}_{3}=\\left(6.0,0.0,0.0\\right)$, exponents $\\left[\\alpha\\right]=\\left[0.2\\right]$, coefficients $\\left[d\\right]=\\left[1.0\\right]$.\n- Evaluate the following $5$ test quartets $\\left(I,J\\mid K,L\\right)$ with the given thresholds $\\tau$:\n  - Case $1$: $\\left(0,1\\mid 0,1\\right)$ with $\\tau=10^{-3}$.\n  - Case $2$: $\\left(0,3\\mid 1,3\\right)$ with $\\tau=10^{-6}$.\n  - Case $3$: $\\left(1,1\\mid 1,1\\right)$ with $\\tau=10^{-1}$.\n  - Case $4$: $\\left(0,2\\mid 0,2\\right)$ with $\\tau=10^{-3}$.\n  - Case $5$: $\\left(2,3\\mid 2,3\\right)$ with $\\tau=10^{-5}$.\n\nOutput requirement:\n- For each case, output a boolean indicating whether the quartet is screened, i.e., whether $B_{IJ}\\,B_{KL}\\tau$ evaluates to true.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with no spaces, in the order of the 5 cases above; for example, `[True,False,...]`.\n- No physical units are involved; all quantities are dimensionless.\n\nConstraints:\n- You must not hard-code any closed-form expression for contracted integrals beyond what follows from the foundational items. Compute contracted quantities by explicit summation over primitive contributions and evaluate $F_{0}\\!\\left(T\\right)$ numerically with careful handling of $T\\to 0$.\n- Assume all shells are $s$-type; angular momentum greater than zero is out of scope for this task.", "solution": "The core of the problem is to determine if a shell quartet of electron repulsion integrals, denoted $\\left(IJ\\mid KL\\right)$, can be neglected based on the Cauchy-Schwarz inequality. The screening condition is given by $B_{IJ}\\,B_{KL}\\tau$, where $\\tau$ is a numerical threshold and $B_{PQ}$ is the shell-pair bound defined as $B_{PQ} = \\sqrt{\\left(PQ\\mid PQ\\right)}$. To implement this screening procedure, we must first develop a method to compute the integral $\\left(IJ\\mid IJ\\right)$ for any pair of contracted $s$-type Gaussian shells, $I$ and $J$.\n\nA contracted $s$-type shell, $\\Phi_{I}$, is a linear combination of primitive $s$-type Gaussian functions, $\\phi_a^I$:\n$$ \\Phi_{I}\\left(\\mathbf{r}\\right)=\\sum_{a=1}^{n_{I}} d_{a}^{\\left(I\\right)}\\,\\phi\\left(\\mathbf{r};\\alpha_{a}^{\\left(I\\right)},\\mathbf{A}_{I}\\right) $$\nwhere $d_{a}^{\\left(I\\right)}$ are contraction coefficients, $\\alpha_{a}^{\\left(I\\right)}$ are exponents, and $\\mathbf{A}_{I}$ is the center of the shell. The primitive Gaussian $\\phi$ is normalized, with normalization constant $N\\left(\\alpha\\right)=\\left(\\frac{2\\alpha}{\\pi}\\right)^{3/4}$.\n\nThe two-electron repulsion integral $\\left(IJ\\mid IJ\\right)$ is defined over these contracted shells:\n$$ \\left(IJ\\mid IJ\\right)=\\iint \\dfrac{\\Phi_{I}\\left(\\mathbf{r}_{1}\\right)\\Phi_{J}\\left(\\mathbf{r}_{1}\\right)\\,\\Phi_{I}\\left(\\mathbf{r}_{2}\\right)\\Phi_{J}\\left(\\mathbf{r}_{2}\\right)}{\\left\\lVert\\mathbf{r}_{1}-\\mathbf{r}_{2}\\right\\rVert}\\,\\mathrm{d}\\mathbf{r}_{1}\\,\\mathrm{d}\\mathbf{r}_{2} $$\nBy substituting the linear expansions for $\\Phi_I$ and $\\Phi_J$, this integral becomes a sum over integrals of primitive Gaussians:\n$$ \\left(IJ\\mid IJ\\right) = \\sum_{a \\in I} \\sum_{b \\in J} \\sum_{c \\in I} \\sum_{d \\in J} d_{a}^{\\left(I\\right)} d_{b}^{\\left(J\\right)} d_{c}^{\\left(I\\right)} d_{d}^{\\left(J\\right)} \\left(\\phi_a^I \\phi_b^J \\mid \\phi_c^I \\phi_d^J\\right) $$\nwhere $\\left(\\phi_a^I \\phi_b^J \\mid \\phi_c^I \\phi_d^J\\right)$ is the primitive integral involving four Gaussians: $\\phi_a^I$ centered at $\\mathbf{A}_I$, $\\phi_b^J$ at $\\mathbf{A}_J$, $\\phi_c^I$ at $\\mathbf{A}_I$, and $\\phi_d^J$ at $\\mathbf{A}_J$.\n\nThe value of a primitive $s$-type ERI $\\left(\\phi_a \\phi_b \\mid \\phi_c \\phi_d\\right)$ with exponents $\\alpha_a, \\alpha_b, \\alpha_c, \\alpha_d$ and centers $\\mathbf{A}, \\mathbf{B}, \\mathbf{C}, \\mathbf{D}$ can be derived using the Gaussian product theorem. The product of two Gaussians is another Gaussian. This allows the six-dimensional integral to be reduced to a known form. The final analytical expression for normalized primitives is:\n$$ \\left(\\phi_a \\phi_b \\mid \\phi_c \\phi_d\\right) = N_a N_b N_c N_d \\frac{2\\pi^{5/2}}{p_{ab}p_{cd}\\sqrt{p_{ab}+p_{cd}}} \\exp\\left(-\\frac{\\alpha_a\\alpha_b}{p_{ab}}\\left\\lVert\\mathbf{A}-\\mathbf{B}\\right\\rVert^2 - \\frac{\\alpha_c\\alpha_d}{p_{cd}}\\left\\lVert\\mathbf{C}-\\mathbf{D}\\right\\rVert^2\\right) F_0\\left(T\\right) $$\nHere, the following definitions are used:\n- $p_{ab} = \\alpha_a + \\alpha_b$ and $p_{cd} = \\alpha_c + \\alpha_d$.\n- The new centers for the product Gaussians are $\\mathbf{P}_{ab} = \\frac{\\alpha_a\\mathbf{A} + \\alpha_b\\mathbf{B}}{p_{ab}}$ and $\\mathbf{P}_{cd} = \\frac{\\alpha_c\\mathbf{C} + \\alpha_d\\mathbf{D}}{p_{cd}}$.\n- The argument to the Boys function is $T = \\frac{p_{ab}p_{cd}}{p_{ab}+p_{cd}}\\left\\lVert\\mathbf{P}_{ab}-\\mathbf{P}_{cd}\\right\\rVert^2$.\n- $N_k = \\left(\\frac{2\\alpha_k}{\\pi}\\right)^{3/4}$ is the normalization constant for the primitive $\\phi_k$.\n\nThe Boys function of order $0$, $F_0\\left(T\\right)$, is given for $T  0$ as:\n$$ F_0\\left(T\\right) = \\frac{1}{2}\\sqrt{\\frac{\\pi}{T}}\\,\\mathrm{erf}\\left(\\sqrt{T}\\right) $$\nFor $T=0$, the limit is $F_0\\left(0\\right)=1$. Numerically, for small $T$, the direct formula is unstable. We use a Taylor series expansion of $F_0(T)$ around $T=0$:\n$$ F_0\\left(T\\right) = \\sum_{n=0}^{\\infty} \\frac{\\left(-T\\right)^n}{2n+1} = 1 - \\frac{T}{3} + \\frac{T^2}{5} - O\\left(T^3\\right) $$\nA small threshold on $T$ (e.g., $10^{-8}$) is used to switch between the series expansion and the exact formula involving the error function, $\\mathrm{erf}$.\n\nThe algorithm proceeds as follows:\n1. For each shell quartet $\\left(I,J\\mid K,L\\right)$ and threshold $\\tau$ from the test suite, identify the necessary shell pairs: $\\left(I,J\\right)$ and $\\left(K,L\\right)$.\n2. For each unique shell pair $\\left(P,Q\\right)$, compute the integral $\\left(PQ\\mid PQ\\right)$ by summing over all its constituent primitive integrals using the formula above. A cache is used to store and reuse the computed bound values $B_{PQ}$ to avoid redundant calculations.\n3. Compute the shell-pair bound $B_{PQ} = \\sqrt{\\left(PQ\\mid PQ\\right)}$.\n4. With the bounds $B_{IJ}$ and $B_{KL}$ computed, evaluate the screening condition $B_{IJ}B_{KL}  \\tau$.\n5. The boolean result of this comparison determines whether the quartet is screened. The results for all test cases are collected and formatted into the required output string.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import erf\n\ndef solve():\n    \"\"\"\n    Solves the integral screening problem for a fixed set of Gaussian shells and quartets.\n    \"\"\"\n\n    # Define shell data structure\n    # Shells are dictionaries with center (np.array), alphas (np.array), and coeffs (np.array)\n    shells = [\n        # Shell 0\n        {'center': np.array([0.0, 0.0, 0.0]), 'alphas': np.array([0.5, 0.15]), 'coeffs': np.array([0.6, 0.4])},\n        # Shell 1\n        {'center': np.array([1.2, 0.0, 0.0]), 'alphas': np.array([0.9]), 'coeffs': np.array([1.0])},\n        # Shell 2\n        {'center': np.array([0.0, 2.0, 0.0]), 'alphas': np.array([0.3, 1.0]), 'coeffs': np.array([0.7, 0.3])},\n        # Shell 3\n        {'center': np.array([6.0, 0.0, 0.0]), 'alphas': np.array([0.2]), 'coeffs': np.array([1.0])},\n    ]\n\n    # Test cases: (I, J, K, L, tau)\n    test_cases = [\n        (0, 1, 0, 1, 1e-3),\n        (0, 3, 1, 3, 1e-6),\n        (1, 1, 1, 1, 1e-1),\n        (0, 2, 0, 2, 1e-3),\n        (2, 3, 2, 3, 1e-5),\n    ]\n\n    def boys_F0(T):\n        \"\"\"\n        Computes the Boys function F_0(T) in a numerically stable manner.\n        \"\"\"\n        if T  1e-8:\n            return 1.0 - T/3.0 + T**2/5.0 - T**3/7.0 + T**4/9.0\n        else:\n            return 0.5 * np.sqrt(np.pi / T) * erf(np.sqrt(T))\n\n    # Vectorize the Boys function to apply it to NumPy arrays\n    vec_boys_F0 = np.vectorize(boys_F0)\n\n    def compute_B_IJ(shell_I, shell_J):\n        \"\"\"\n        Computes the shell-pair bound B_IJ = sqrt((IJ|IJ)).\n        This function is vectorized for efficiency and clarity.\n        \"\"\"\n        coeffs_I = shell_I['coeffs']\n        alphas_I = shell_I['alphas']\n        center_I = shell_I['center']\n\n        coeffs_J = shell_J['coeffs']\n        alphas_J = shell_J['alphas']\n        center_J = shell_J['center']\n\n        dist_sq_IJ = np.sum((center_I - center_J)**2)\n\n        # Expand primitive parameters into 4D arrays for vectorized computation\n        # Dimensions correspond to prims a, b, c, d\n        da = coeffs_I[:, None, None, None]\n        db = coeffs_J[None, :, None, None]\n        dc = coeffs_I[None, None, :, None]\n        dd = coeffs_J[None, None, None, :]\n        coeffs_prod = da * db * dc * dd\n        \n        aa = alphas_I[:, None, None, None]\n        ab = alphas_J[None, :, None, None]\n        ac = alphas_I[None, None, :, None]\n        ad = alphas_J[None, None, None, :]\n\n        # Compute arguments for the ERI formula\n        pab = aa + ab\n        pcd = ac + ad\n        \n        # Argument for Boys function\n        # T = [p_ab*p_cd / (p_ab+p_cd)] * ||P_ab - P_cd||^2\n        # ||P_ab - P_cd||^2 = [ (alpha_a*alpha_d - alpha_b*alpha_c) / (p_ab*p_cd) ]^2 * ||A_I - A_J||^2\n        T_factor = ((aa*ad - ab*ac)**2 / (pab * pcd * (pab + pcd)))\n        T = T_factor * dist_sq_IJ\n\n        # Handle T=0 case by avoiding division by zero\n        # This occurs when aa*ad - ab*ac = 0 or dist_sq_IJ = 0.\n        # np.nan_to_num will convert NaN from 0/0 to 0, which is correct for T.\n        T = np.nan_to_num(T)\n        f0_values = vec_boys_F0(T)\n\n        # Exponential prefactor\n        exp_term = np.exp(-(aa*ab/pab + ac*ad/pcd) * dist_sq_IJ)\n\n        # Normalization constants\n        N_a = (2 * aa / np.pi)**0.75\n        N_b = (2 * ab / np.pi)**0.75\n        N_c = (2 * ac / np.pi)**0.75\n        N_d = (2 * ad / np.pi)**0.75\n\n        # Constant part of the primitive integral formula\n        const_factor = (2 * np.pi**2.5) / (pab * pcd * np.sqrt(pab + pcd))\n        \n        # Combine all parts to get the primitive integrals\n        prim_integrals = N_a * N_b * N_c * N_d * const_factor * exp_term * f0_values\n        \n        # Sum over all primitive contributions\n        total_integral = np.sum(coeffs_prod * prim_integrals)\n\n        return np.sqrt(total_integral)\n\n    # Main logic\n    results = []\n    B_cache = {}\n\n    for I, J, K, L, tau in test_cases:\n        # Use sorted tuples as keys for commutativity, e.g., B_IJ = B_JI\n        pair1 = tuple(sorted((I, J)))\n        pair2 = tuple(sorted((K, L)))\n        \n        if pair1 not in B_cache:\n            B_cache[pair1] = compute_B_IJ(shells[pair1[0]], shells[pair1[1]])\n        \n        if pair2 not in B_cache:\n            B_cache[pair2] = compute_B_IJ(shells[pair2[0]], shells[pair2[1]])\n            \n        B_IJ = B_cache[pair1]\n        B_KL = B_cache[pair2]\n        \n        is_screened = B_IJ * B_KL  tau\n        results.append(is_screened)\n\n    # Format output as required: [True,False,...] with no spaces.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2898970"}]}