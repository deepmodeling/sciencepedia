{"hands_on_practices": [{"introduction": "A cornerstone of exact density functional theory is the complete cancellation of self-interaction; an electron does not interact with itself. However, many widely used approximate functionals, such as the Local Density Approximation (LDA) and Generalized Gradient Approximations (GGAs), are not self-interaction free, leading to significant errors in many chemical systems. This foundational exercise [@problem_id:2901403] provides a rigorous, analytical \"pen-and-paper\" practice to demonstrate this concept, using the simplest possible case of the hydrogen atom to quantify the residual self-interaction error and reveal a key limitation of these approximations.", "problem": "Consider a one-electron hydrogen atom in its nonrelativistic ground state within Kohn–Sham density functional theory (KS-DFT). The spatial orbital is the normalized hydrogenic $1s$ function and the electron is fully spin-polarized. Work in Hartree atomic units, so that the Bohr radius satisfies $a_0 = 1$, the electronic density is spherically symmetric and equals\n\n$$\nn(r) \\;=\\; \\frac{1}{\\pi}\\,\\exp(-2 r),\n$$\n\nand the system has exactly one electron.\n\nStarting from first principles and standard definitions, do the following:\n\n- Using the definition of the classical Hartree electrostatic energy,\n\n$$\nE_{\\mathrm{H}}[n] \\;=\\; \\frac{1}{2}\\int \\!\\! \\int \\frac{n(\\mathbf{r})\\,n(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\,d\\mathbf{r}\\,d\\mathbf{r}',\n$$\n\nand the Hartree–Fock exchange energy for a Slater determinant,\n\n$$\nE_{x}^{\\mathrm{HF}}[\\{\\varphi_i\\}] \\;=\\; -\\frac{1}{2}\\sum_{i,j}\\int \\!\\! \\int \\frac{\\varphi_i(\\mathbf{r})\\,\\varphi_j^{*}(\\mathbf{r})\\,\\varphi_j(\\mathbf{r}')\\,\\varphi_i^{*}(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\,d\\mathbf{r}\\,d\\mathbf{r}',\n$$\n\nverify from these definitions that for a one-electron system $E_{\\mathrm{H}} + E_{x}^{\\mathrm{exact}} = 0$, where $E_{x}^{\\mathrm{exact}}$ denotes the exact exchange energy functional evaluated on the given density.\n\n- Next, quantify the residual self-interaction error defined as $E_{\\mathrm{H}} + E_{x}^{\\mathrm{approx}}$ for two approximate exchange functionals:\n  1. The Local Density Approximation (LDA) exchange for spin-density functional theory,\n  \n$$\n  E_{x}^{\\mathrm{LDA}}[n_{\\uparrow},n_{\\downarrow}] \\;=\\; -\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}\\int \\left(n_{\\uparrow}^{4/3} + n_{\\downarrow}^{4/3}\\right)\\,d\\mathbf{r},\n  $$\n\n  evaluated for the fully spin-polarized hydrogen density $n_{\\uparrow} = n$, $n_{\\downarrow} = 0$.\n  2. The second-order gradient expansion (a Generalized Gradient Approximation (GGA) prototype) for exchange,\n  \n$$\n  E_{x}^{\\mathrm{GEA2}}[n] \\;=\\; -C_{x}\\int n(\\mathbf{r})^{4/3}\\left[1 + \\mu\\,s(\\mathbf{r})^{2}\\right]\\,d\\mathbf{r},\n  $$\n\n  where $C_{x} = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}$, $\\mu = \\frac{10}{81}$, the reduced gradient is $s(\\mathbf{r}) = \\frac{|\\nabla n(\\mathbf{r})|}{2 k_{F}(\\mathbf{r})\\,n(\\mathbf{r})}$, and the local Fermi wavevector is $k_{F}(\\mathbf{r}) = \\left(3\\pi^{2} n(\\mathbf{r})\\right)^{1/3}$.\n\nDerive analytic closed-form expressions for the two residual self-interaction errors,\n\n$$\n\\Delta_{\\mathrm{LDA}} \\;=\\; E_{\\mathrm{H}}[n] + E_{x}^{\\mathrm{LDA}}[n_{\\uparrow}=n,n_{\\downarrow}=0], \n\\quad\n\\Delta_{\\mathrm{GEA2}} \\;=\\; E_{\\mathrm{H}}[n] + E_{x}^{\\mathrm{GEA2}}[n],\n$$\n\nin terms of rational numbers and powers of $\\pi$ and $3$. Express the final answer as a row matrix $\\bigl[\\Delta_{\\mathrm{LDA}}\\;\\;\\Delta_{\\mathrm{GEA2}}\\bigr]$ and use Hartree ($\\mathrm{E_h}$) as the energy unit. No numerical rounding is required; provide exact expressions.", "solution": "The problem statement is scientifically grounded, well-posed, and objective. All provided definitions, constants, and physical quantities are standard within the framework of density functional theory, or are explicitly defined for the purpose of the problem. The task is a rigorous and verifiable calculation. Therefore, the problem is deemed valid and a full solution will be provided.\n\nThe problem requires a two-part analysis of self-interaction in a one-electron system, specifically the hydrogen atom in its ground state. All calculations are performed in Hartree atomic units ($e=m_e=\\hbar=1$, $a_0=1$).\n\nPart 1: Verification of Exact Self-Interaction Cancellation\n\nFor any one-electron system, the ground-state electron density $n(\\mathbf{r})$ is given by the square of the single occupied orbital $\\varphi_1(\\mathbf{r})$, such that $n(\\mathbf{r}) = |\\varphi_1(\\mathbf{r})|^2$. Since the hydrogen $1s$ orbital is a real function, we have $n(\\mathbf{r}) = \\varphi_1(\\mathbf{r})^2$.\n\nThe Hartree energy is defined as:\n$$\nE_{\\mathrm{H}}[n] = \\frac{1}{2}\\int \\!\\! \\int \\frac{n(\\mathbf{r})\\,n(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\,d\\mathbf{r}\\,d\\mathbf{r}'\n$$\nSubstituting $n(\\mathbf{r}) = \\varphi_1(\\mathbf{r})^2$, we get:\n$$\nE_{\\mathrm{H}}[n] = \\frac{1}{2}\\int \\!\\! \\int \\frac{\\varphi_1(\\mathbf{r})^2\\,\\varphi_1(\\mathbf{r}')^2}{|\\mathbf{r}-\\mathbf{r}'|}\\,d\\mathbf{r}\\,d\\mathbf{r}'\n$$\nThe exact exchange energy, $E_{x}^{\\mathrm{exact}}$, is given by the Hartree–Fock exchange expression evaluated on the exact Kohn–Sham orbitals. For a one-electron system, there is only one orbital, $\\varphi_1$. The summations over $i$ and $j$ in the definition of $E_{x}^{\\mathrm{HF}}$ each have only one term, $i=j=1$.\n$$\nE_{x}^{\\mathrm{exact}} = E_{x}^{\\mathrm{HF}}[\\{\\varphi_1\\}] = -\\frac{1}{2}\\int \\!\\! \\int \\frac{\\varphi_1(\\mathbf{r})\\,\\varphi_1^{*}(\\mathbf{r})\\,\\varphi_1(\\mathbf{r}')\\,\\varphi_1^{*}(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\,d\\mathbf{r}\\,d\\mathbf{r}'\n$$\nSince $\\varphi_1$ is real, $\\varphi_1^* = \\varphi_1$. The expression simplifies to:\n$$\nE_{x}^{\\mathrm{exact}} = -\\frac{1}{2}\\int \\!\\! \\int \\frac{\\varphi_1(\\mathbf{r})^2\\,\\varphi_1(\\mathbf{r}')^2}{|\\mathbf{r}-\\mathbf{r}'|}\\,d\\mathbf{r}\\,d\\mathbf{r}'\n$$\nComparing this with the expression for the Hartree energy, we see that:\n$$\nE_{x}^{\\mathrm{exact}} = -E_{\\mathrm{H}}[n]\n$$\nTherefore, for any one-electron system, the sum of the Hartree energy and the exact exchange energy is identically zero:\n$$\nE_{\\mathrm{H}}[n] + E_{x}^{\\mathrm{exact}} = 0\n$$\nThis demonstrates the exact cancellation of the self-interaction in the exact theory. Approximate functionals, however, do not typically satisfy this condition, leading to a residual self-interaction error.\n\nPart 2: Calculation of Residual Self-Interaction Errors\n\nWe must compute $\\Delta_{\\mathrm{LDA}} = E_{\\mathrm{H}}[n] + E_{x}^{\\mathrm{LDA}}[n]$ and $\\Delta_{\\mathrm{GEA2}} = E_{\\mathrm{H}}[n] + E_{x}^{\\mathrm{GEA2}}[n]$. The first step is to compute the Hartree energy $E_{\\mathrm{H}}$ for the given density, $n(r) = \\frac{1}{\\pi}\\exp(-2r)$.\n\nCalculation of the Hartree Energy, $E_{\\mathrm{H}}$\nThe Hartree energy is the electrostatic self-energy of the charge distribution $n(\\mathbf{r})$. It can be expressed as $E_{\\mathrm{H}} = \\frac{1}{2}\\int n(\\mathbf{r}) V_{\\mathrm{H}}(\\mathbf{r}) \\,d\\mathbf{r}$, where $V_{\\mathrm{H}}(\\mathbf{r})$ is the electrostatic potential generated by $n(\\mathbf{r})$. For a spherically symmetric density, the potential is:\n$$\nV_{\\mathrm{H}}(r) = \\frac{1}{r} \\int_0^r n(r') 4\\pi r'^2 dr' + \\int_r^\\infty \\frac{n(r') 4\\pi r'^2}{r'} dr'\n$$\nUsing $n(r) = \\frac{1}{\\pi}\\exp(-2r)$, the integrals yield $V_{\\mathrm{H}}(r) = \\frac{1}{r} - \\left(\\frac{1}{r}+1\\right)\\exp(-2r)$.\nNow we compute $E_{\\mathrm{H}}$:\n$$\nE_{\\mathrm{H}} = \\frac{1}{2} \\int_0^\\infty V_{\\mathrm{H}}(r) n(r) 4\\pi r^2 dr = \\frac{1}{2} \\int_0^\\infty \\left[\\frac{1}{r} - \\left(\\frac{1}{r}+1\\right)\\exp(-2r)\\right] \\left(\\frac{1}{\\pi}\\exp(-2r)\\right) 4\\pi r^2 dr\n$$\n$$\nE_{\\mathrm{H}} = 2 \\int_0^\\infty \\left[ r\\exp(-2r) - (r+r^2)\\exp(-4r) \\right] dr\n$$\nWe use the standard integral $\\int_0^\\infty x^k \\exp(-ax) dx = k!/a^{k+1}$:\n- $\\int_0^\\infty r\\exp(-2r) dr = 1!/2^2 = \\frac{1}{4}$\n- $\\int_0^\\infty r^2\\exp(-4r) dr = 2!/4^3 = \\frac{2}{64} = \\frac{1}{32}$\n- $\\int_0^\\infty r\\exp(-4r) dr = 1!/4^2 = \\frac{1}{16}$\nSubstituting these results:\n$$\nE_{\\mathrm{H}} = 2 \\left[ \\frac{1}{4} - \\left(\\frac{1}{16} + \\frac{1}{32}\\right) \\right] = 2 \\left[ \\frac{8}{32} - \\frac{2}{32} - \\frac{1}{32} \\right] = 2 \\left( \\frac{5}{32} \\right) = \\frac{5}{16}\n$$\n\nCalculation of the LDA Self-Interaction Error, $\\Delta_{\\mathrm{LDA}}$\nThe problem provides the LDA exchange energy functional for a spin-polarized system ($n_{\\uparrow}=n, n_{\\downarrow}=0$) as:\n$$\nE_{x}^{\\mathrm{LDA}}[n] = -\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}\\int n(\\mathbf{r})^{4/3}\\,d\\mathbf{r}\n$$\nWe compute the integral $\\int n(\\mathbf{r})^{4/3}\\,d\\mathbf{r}$:\n$$\n\\int n(r)^{4/3} 4\\pi r^2 dr = \\int_0^\\infty \\left(\\frac{1}{\\pi}\\exp(-2r)\\right)^{4/3} 4\\pi r^2 dr = 4\\pi \\pi^{-4/3} \\int_0^\\infty r^2 \\exp\\left(-\\frac{8}{3}r\\right) dr\n$$\n$$\n= 4\\pi^{-1/3} \\left( \\frac{2!}{(8/3)^3} \\right) = 4\\pi^{-1/3} \\left( \\frac{2}{512/27} \\right) = 4\\pi^{-1/3} \\left( \\frac{54}{512} \\right) = \\frac{27}{64}\\pi^{-1/3}\n$$\nNow we substitute this into the expression for $E_{x}^{\\mathrm{LDA}}$:\n$$\nE_{x}^{\\mathrm{LDA}} = -\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3} \\left(\\frac{27}{64}\\pi^{-1/3}\\right) = -\\frac{81 \\cdot 3^{1/3}}{256 \\pi^{2/3}} = -\\frac{3^{4} \\cdot 3^{1/3}}{256 \\pi^{2/3}} = -\\frac{3^{13/3}}{256 \\pi^{2/3}}\n$$\nThe residual self-interaction error for LDA is:\n$$\n\\Delta_{\\mathrm{LDA}} = E_{\\mathrm{H}} + E_{x}^{\\mathrm{LDA}} = \\frac{5}{16} - \\frac{3^{13/3}}{256 \\pi^{2/3}}\n$$\n\nCalculation of the GEA2 Self-Interaction Error, $\\Delta_{\\mathrm{GEA2}}$\nThe GEA2 exchange energy is given by:\n$$\nE_{x}^{\\mathrm{GEA2}}[n] = -C_{x}\\int n^{4/3}\\left[1 + \\mu\\,s^{2}\\right]\\,d\\mathbf{r} = E_{x}^{\\mathrm{LDA}} - C_x \\mu \\int n^{4/3}s^2\\,d\\mathbf{r}\n$$\nWe need to evaluate the gradient correction term. First, we find the reduced gradient $s$:\n$s = \\frac{|\\nabla n|}{2 k_F n}$, with $k_F = (3\\pi^2 n)^{1/3}$.\nFor the given density, $\\nabla n = \\frac{dn}{dr}\\hat{\\mathbf{r}} = -2 \\frac{1}{\\pi}\\exp(-2r) \\hat{\\mathbf{r}} = -2n\\hat{\\mathbf{r}}$, so $|\\nabla n| = 2n$.\n$$\ns = \\frac{2n}{2 (3\\pi^2 n)^{1/3} n} = \\frac{1}{(3\\pi^2 n)^{1/3}} \\implies s^2 = \\frac{1}{(3\\pi^2 n)^{2/3}} = \\frac{1}{3^{2/3}\\pi^{4/3}n^{2/3}}\n$$\nThe integrand of the correction term is $n^{4/3}s^2$:\n$$\nn^{4/3}s^2 = n^{4/3} \\frac{1}{3^{2/3}\\pi^{4/3}n^{2/3}} = \\frac{n^{2/3}}{3^{2/3}\\pi^{4/3}}\n$$\nThe gradient correction energy is:\n$$\n\\Delta E_{x}^{\\mathrm{GEA2}} = -C_x \\mu \\int \\frac{n^{2/3}}{3^{2/3}\\pi^{4/3}}\\,d\\mathbf{r} = -\\frac{C_x \\mu}{3^{2/3}\\pi^{4/3}} \\int n^{2/3}\\,d\\mathbf{r}\n$$\nWe compute the integral $\\int n^{2/3}\\,d\\mathbf{r}$:\n$$\n\\int n(r)^{2/3} 4\\pi r^2 dr = \\int_0^\\infty \\left(\\frac{1}{\\pi}\\exp(-2r)\\right)^{2/3} 4\\pi r^2 dr = 4\\pi \\pi^{-2/3} \\int_0^\\infty r^2 \\exp\\left(-\\frac{4}{3}r\\right) dr\n$$\n$$\n= 4\\pi^{1/3} \\left( \\frac{2!}{(4/3)^3} \\right) = 4\\pi^{1/3} \\left( \\frac{2}{64/27} \\right) = 4\\pi^{1/3} \\left( \\frac{54}{64} \\right) = \\frac{27}{8}\\pi^{1/3}\n$$\nSubstituting this back, along with $C_x = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}$ and $\\mu = \\frac{10}{81}$:\n$$\n\\Delta E_{x}^{\\mathrm{GEA2}} = -\\left(\\frac{3}{4}\\frac{3^{1/3}}{\\pi^{1/3}}\\right) \\left(\\frac{10}{81}\\right) \\frac{1}{3^{2/3}\\pi^{4/3}} \\left(\\frac{27}{8}\\pi^{1/3}\\right)\n$$\n$$\n= -\\frac{3 \\cdot 10 \\cdot 27}{4 \\cdot 81 \\cdot 8} \\frac{3^{1/3}}{3^{2/3}} \\frac{\\pi^{1/3}}{\\pi^{1/3}\\pi^{4/3}} = -\\frac{810}{2592} \\cdot 3^{-1/3} \\pi^{-4/3} = -\\frac{5 \\cdot 162}{16 \\cdot 162} \\cdot 3^{-1/3} \\pi^{-4/3} = -\\frac{5}{16} 3^{-1/3} \\pi^{-4/3}\n$$\nThe total GEA2 exchange energy is $E_{x}^{\\mathrm{GEA2}} = E_{x}^{\\mathrm{LDA}} + \\Delta E_{x}^{\\mathrm{GEA2}}$. The residual self-interaction error is:\n$$\n\\Delta_{\\mathrm{GEA2}} = E_{\\mathrm{H}} + E_{x}^{\\mathrm{GEA2}} = \\frac{5}{16} - \\frac{3^{13/3}}{256 \\pi^{2/3}} - \\frac{5}{16} 3^{-1/3} \\pi^{-4/3}\n$$\nThe final results are the expressions for $\\Delta_{\\mathrm{LDA}}$ and $\\Delta_{\\mathrm{GEA2}}$.", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{5}{16} - \\frac{3^{13/3}}{256 \\pi^{2/3}} & \\frac{5}{16} - \\frac{3^{13/3}}{256 \\pi^{2/3}} - \\frac{5 \\cdot 3^{-1/3}}{16 \\pi^{4/3}} \\end{pmatrix}}\n$$", "id": "2901403"}, {"introduction": "The Hohenberg-Kohn theorems form the theoretical bedrock of DFT, guaranteeing a unique mapping between the ground-state electron density and the external potential. This principle implies the existence of an exact Kohn–Sham potential, $v_s(x)$, capable of reproducing the exact density within a non-interacting framework. In this hands-on coding practice [@problem_id:2901327], you will transform this abstract theorem into a tangible algorithm by implementing a numerical potential inversion, directly constructing the KS potential from a target density and verifying the power and validity of this fundamental concept.", "problem": "You will implement and test a one-dimensional potential inversion in Kohn–Sham density functional theory for a closed-shell two-electron system. Work entirely in Hartree atomic units, where the electron mass, elementary charge, reduced Planck constant, and Coulomb constant are all equal to $1$. Your program should not read any input and must output a single line as specified below.\n\nStarting point and physical setting: In the Kohn–Sham (KS) non-interacting system for a spin-compensated two-electron ground state in one dimension, there is a single spatial orbital $\\,\\varphi(x)\\,$ that is doubly occupied by opposite spins. The electron density is $\\,n(x) = 2\\,|\\varphi(x)|^2\\,$ and the orbital satisfies the one-dimensional time-independent Schrödinger equation with an effective single-particle KS potential $\\,v_s(x)\\,$,\n$$\n-\\frac{1}{2}\\,\\frac{d^2 \\varphi(x)}{dx^2} + v_s(x)\\,\\varphi(x) = \\varepsilon\\,\\varphi(x),\n$$\nwhere $\\,\\varepsilon\\,$ is the orbital energy. The KS potential $\\,v_s(x)\\,$ is defined up to an additive constant, which does not affect $\\,\\varphi(x)\\,$.\n\nTask: You are given an exact target density profile $\\,n(x)\\,$ on a finite interval $[x_{\\min}, x_{\\max}]$. Your task is to:\n- Derive from first principles how to invert the one-dimensional KS equation in this closed-shell two-electron case to obtain a KS potential $\\,v_s(x)\\,$ that reproduces the given $\\,n(x)\\,$.\n- Implement the inversion numerically on a uniform grid using finite differences and Dirichlet boundary conditions $\\,\\varphi(x_{\\min}) = \\varphi(x_{\\max}) = 0\\,$. You must construct $\\,v_s(x)\\,$ from the density, then solve the resulting one-dimensional Schrödinger eigenproblem for the lowest-energy orbital and reconstruct the density $\\,\\tilde n(x) = 2\\,|\\tilde\\varphi(x)|^2\\,$. Normalize all orbitals with respect to the continuous inner product so that $\\,\\int_{x_{\\min}}^{x_{\\max}} |\\varphi(x)|^2\\,dx = 1\\,$.\n- Verify that the reconstructed density $\\,\\tilde n(x)\\,$ matches the input $\\,n(x)\\,$ within the specified tolerance using the relative $L^2$ error norm\n$$\n\\mathcal{E} = \\frac{\\left(\\int_{x_{\\min}}^{x_{\\max}} \\left[ \\tilde n(x) - n(x) \\right]^2 dx\\right)^{1/2}}{\\left(\\int_{x_{\\min}}^{x_{\\max}} n(x)^2 dx\\right)^{1/2}}.\n$$\n\nNumerical and algorithmic requirements:\n- Use a uniform grid with $\\,N\\,$ points on $[x_{\\min}, x_{\\max}]$ and grid spacing $\\,h = (x_{\\max} - x_{\\min})/(N-1)\\,$.\n- Use the standard second-order central finite-difference approximation for second derivatives on the interior grid points. Impose Dirichlet boundary conditions by excluding the endpoints from the eigenproblem.\n- Construct the Hamiltonian matrix for the interior points as a symmetric tridiagonal matrix representing the operator $-\\frac{1}{2}\\frac{d^2}{dx^2} + v_s(x)$.\n- Any overall additive constant in $\\,v_s(x)\\,$ is arbitrary; you may choose a convenient gauge (for example, set $\\,v_s(0)=0\\,$ if $\\,0 \\in [x_{\\min}, x_{\\max}]$, or subtract the value at the grid midpoint).\n\nTest suite and densities:\nImplement the following four test cases. In all cases, use the exact two-electron density $\\,n(x) = 2\\,|\\varphi(x)|^2\\,$ generated from a smooth, nodeless target orbital $\\,\\varphi(x)\\,$. The continuous normalization $\\,\\int |\\varphi(x)|^2 dx = 1\\,$ must be enforced numerically on the chosen grid before computing $\\,n(x)\\,$. For each case, report whether $\\,\\mathcal{E}\\,$ is less than or equal to the specified tolerance as a boolean.\n\n- Case $1$ (Gaussian, moderate width):\n  - Interval: $[x_{\\min}, x_{\\max}] = [-10, 10]$.\n  - Grid: $N = 1201$.\n  - Target orbital: $\\,\\varphi(x) \\propto \\exp\\!\\left(-\\frac{\\alpha x^2}{2}\\right)\\,$ with $\\,\\alpha = 1.0\\,$.\n  - Tolerance: $\\,1.5\\times 10^{-3}\\,$.\n\n- Case $2$ (Gaussian, narrow):\n  - Interval: $[x_{\\min}, x_{\\max}] = [-6, 6]$.\n  - Grid: $N = 1201$.\n  - Target orbital: $\\,\\varphi(x) \\propto \\exp\\!\\left(-\\frac{\\alpha x^2}{2}\\right)\\,$ with $\\,\\alpha = 2.5\\,$.\n  - Tolerance: $\\,2.0\\times 10^{-3}\\,$.\n\n- Case $3$ (hyperbolic secant, Pöschl–Teller-like):\n  - Interval: $[x_{\\min}, x_{\\max}] = [-15, 15]$.\n  - Grid: $N = 2001$.\n  - Target orbital: $\\,\\varphi(x) \\propto \\operatorname{sech}(b x)\\,$ with $\\,b = 0.8\\,$.\n  - Tolerance: $\\,2.0\\times 10^{-3}\\,$.\n\n- Case $4$ (Gaussian, very broad):\n  - Interval: $[x_{\\min}, x_{\\max}] = [-30, 30]$.\n  - Grid: $N = 2401$.\n  - Target orbital: $\\,\\varphi(x) \\propto \\exp\\!\\left(-\\frac{\\alpha x^2}{2}\\right)\\,$ with $\\,\\alpha = 0.15\\,$.\n  - Tolerance: $\\,3.0\\times 10^{-3}\\,$.\n\nImplementation guidance and constraints:\n- Build the inversion from the foundational Schrödinger equation above without introducing any model-specific shortcuts beyond standard finite differences and linear algebra. You must not hard-code any analytic potential forms.\n- For numerical stability in forming $\\,v_s(x)\\,$ from the given $\\,n(x)\\,$, you may regularize any divisions by very small orbital values by replacing denominators below a small positive threshold with the threshold itself; ensure the chosen threshold is sufficiently small not to corrupt the interior solution.\n- After constructing $\\,v_s(x)\\,$ on the interior grid, solve the tridiagonal eigenproblem to obtain the lowest-energy orbital and reconstruct the density. Normalize using the Riemann sum with spacing $\\,h\\,$ to approximate integrals (for example, $\\,\\sum_i |\\varphi(x_i)|^2 h \\approx 1\\,$).\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for the four cases in order. Each entry must be a boolean indicating whether the verification passed, for example, $[{\\tt True},{\\tt False},{\\tt True},{\\tt True}]$.\n\nAngle units are not involved. All physical quantities are in atomic units. No other outputs are permitted on stdout.", "solution": "The provided problem statement is subject to rigorous validation.\n\n**1. Problem Validation**\n\n- **Givens Extracted:** The system is a one-dimensional, two-electron, closed-shell system described by the Kohn–Sham (KS) equation $-\\frac{1}{2}\\,\\frac{d^2 \\varphi(x)}{dx^2} + v_s(x)\\,\\varphi(x) = \\varepsilon\\,\\varphi(x)$, with electron density $n(x) = 2\\,|\\varphi(x)|^2$. The task is to invert this equation on a finite interval $[x_{\\min}, x_{\\max}]$ with Dirichlet boundary conditions $\\varphi(x_{\\min})=\\varphi(x_{\\max})=0$, given a target density $n(x)$. Numerical implementation must use a finite-difference scheme on a uniform grid. Four test cases are provided with specific parameters and verification tolerances for the relative $L^2$ error norm\n$$\n\\mathcal{E} = \\frac{\\left(\\int_{x_{\\min}}^{x_{\\max}} \\left[ \\tilde n(x) - n(x) \\right]^2 dx\\right)^{1/2}}{\\left(\\int_{x_{\\min}}^{x_{\\max}} n(x)^2 dx\\right)^{1/2}}.\n$$\n- **Validation Verdict:** The problem is deemed **valid**. It is scientifically grounded in the principles of density functional theory, is mathematically well-posed, and is specified with complete objectivity and clarity. It presents a standard, non-trivial problem in computational quantum chemistry, free of contradictions, ambiguities, or factual errors. We may proceed to the solution.\n\n**2. Derivation of the Inversion Formula**\n\nThe objective is to determine the effective Kohn–Sham potential $v_s(x)$ that yields a given ground-state electron density $n(x)$. For a spin-compensated two-electron system, the density is produced by a single, doubly-occupied spatial orbital $\\varphi(x)$, such that $n(x) = 2|\\varphi(x)|^2$. In one dimension, the ground-state orbital of a real potential can be chosen to be real and non-negative, $\\varphi(x) \\ge 0$. Therefore, the orbital is uniquely determined by the density:\n$$\n\\varphi(x) = \\sqrt{\\frac{n(x)}{2}}\n$$\nThe Kohn–Sham equation is a time-independent Schrödinger equation for the single-particle orbital $\\varphi(x)$:\n$$\n-\\frac{1}{2}\\frac{d^2\\varphi(x)}{dx^2} + v_s(x)\\varphi(x) = \\varepsilon\\varphi(x)\n$$\nwhere $\\varepsilon$ is the orbital energy. Assuming $\\varphi(x) > 0$ in the interior of the domain, we can rearrange this equation to solve for $v_s(x)$:\n$$\nv_s(x)\\varphi(x) = \\varepsilon\\varphi(x) + \\frac{1}{2}\\frac{d^2\\varphi(x)}{dx^2}\n$$\n$$\nv_s(x) = \\varepsilon + \\frac{1}{2\\varphi(x)}\\frac{d^2\\varphi(x)}{dx^2}\n$$\nThe orbital energy $\\varepsilon$ is a constant. The potential $v_s(x)$ is defined only up to an arbitrary additive constant, as a shift $v_s(x) \\to v_s(x) + C$ merely shifts the energy eigenvalue $\\varepsilon \\to \\varepsilon + C$ without altering the orbital $\\varphi(x)$. Thus, we can disregard the constant $\\varepsilon$ and define the potential relative to a chosen reference. The operational formula for potential inversion is:\n$$\nv_s(x) = \\frac{1}{2\\varphi(x)}\\frac{d^2\\varphi(x)}{dx^2} + C'\n$$\nwhere $C'$ is a constant chosen to fix the gauge, and $\\varphi(x)$ is obtained directly from the target density $n(x)$.\n\n**3. Numerical Procedure**\n\nThe derivation is implemented numerically following a precise algorithmic sequence.\n\n- **Step 1: Grid and Target Data Generation**\nA uniform grid $x_i$ for $i=0, \\dots, N-1$ is established on the interval $[x_{\\min}, x_{\\max}]$ with spacing $h=(x_{\\max}-x_{\\min})/(N-1)$. For each test case, the analytic form of the target orbital, $\\varphi_{\\text{analytic}}(x)$, is evaluated on this grid. This discrete orbital is then normalized numerically to satisfy the continuous normalization condition, approximated by a Riemann sum:\n$$\nA = \\left( \\sum_{i=0}^{N-1} |\\varphi_{\\text{analytic}}(x_i)|^2 h \\right)^{-1/2}\n$$\nThe normalized target orbital on the grid is $\\varphi_{\\text{target}}(x_i) = A \\cdot \\varphi_{\\text{analytic}}(x_i)$, and the target density is $n_{\\text{target}}(x_i) = 2|\\varphi_{\\text{target}}(x_i)|^2$.\n\n- **Step 2: Potential Inversion**\nThe potential $v_s(x)$ is constructed on the interior grid points ($i=1, \\dots, N-2$). The term $\\varphi(x)$ in the inversion formula corresponds to $\\varphi_{\\text{target}}(x_i)$. The second derivative of $\\varphi_{\\text{target}}(x)$ is approximated using the second-order central finite difference formula:\n$$\n\\frac{d^2\\varphi_{\\text{target}}(x_i)}{dx^2} \\approx \\frac{\\varphi_{\\text{target}}(x_{i-1}) - 2\\varphi_{\\text{target}}(x_i) + \\varphi_{\\text{target}}(x_{i+1})}{h^2}\n$$\nThe potential is computed as:\n$$\nv_s(x_i) = \\frac{1}{2\\varphi_{\\text{target}}(x_i)} \\left( \\frac{\\varphi_{\\text{target}}(x_{i-1}) - 2\\varphi_{\\text{target}}(x_i) + \\varphi_{\\text{target}}(x_{i+1})}{h^2} \\right)\n$$\nTo prevent numerical instability where $\\varphi_{\\text{target}}(x_i)$ is close to zero (near the boundaries), the denominator is regularized by replacing values smaller than a threshold $\\delta > 0$ with $\\delta$. Finally, the potential is shifted by a constant to set its value at the grid midpoint to zero, fixing the gauge.\n\n- **Step 3: Eigenproblem Solution**\nWith the constructed potential $v_s(x_i)$ for the interior points, the discretized Kohn–Sham Hamiltonian matrix $H$ is formed. $H$ is an $(N-2) \\times (N-2)$ symmetric tridiagonal matrix corresponding to the operator $-\\frac{1}{2}\\frac{d^2}{dx^2} + v_s(x)$ with Dirichlet boundary conditions. Its elements are:\n$$\nH_{ij} = \\begin{cases} \\frac{1}{h^2} + v_s(x_i) & \\text{if } i=j \\\\ -\\frac{1}{2h^2} & \\text{if } |i-j|=1 \\\\ 0 & \\text{otherwise} \\end{cases}\n$$\nThe lowest eigenvalue and corresponding eigenvector of this matrix are computed using a specialized numerical linear algebra routine (`scipy.linalg.eigh_tridiagonal`). The resulting eigenvector contains the values of the reconstructed orbital, $\\tilde\\varphi_{\\text{vec}}$, at the interior grid points.\n\n- **Step 4: Verification and Error Calculation**\nThe computed eigenvector $\\tilde\\varphi_{\\text{vec}}$ is normalized to conform to the continuous integral representation:\n$$\n\\tilde\\varphi(x_i) = \\frac{\\tilde\\varphi_{\\text{vec}}[i-1]}{\\sqrt{h}} \\quad \\text{for } i=1, \\dots, N-2\n$$\nA full orbital vector $\\tilde\\varphi$ of size $N$ is formed, with $\\tilde\\varphi(x_0)=0$ and $\\tilde\\varphi(x_{N-1})=0$. Its sign is adjusted to be positive, matching the nodeless ground-state target orbital. The reconstructed density is then $\\tilde n(x_i) = 2|\\tilde\\varphi(x_i)|^2$.\nThe accuracy of the inversion is quantified by the relative $L^2$ error norm $\\mathcal{E}$, computed numerically:\n$$\n\\mathcal{E} = \\frac{\\left(\\sum_{i=0}^{N-1} [\\tilde n(x_i) - n_{\\text{target}}(x_i)]^2 h \\right)^{1/2}}{\\left(\\sum_{i=0}^{N-1} [n_{\\text{target}}(x_i)]^2 h \\right)^{1/2}}\n$$\nFor each test case, this error is compared against the specified tolerance to yield a boolean verification result.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh_tridiagonal\n\ndef _process_case(xmin, xmax, N, orbital_type, param, tolerance):\n    \"\"\"\n    Performs the potential inversion and verification for a single test case.\n    \"\"\"\n    # Step 1: Grid and Target Data Generation\n    x_grid = np.linspace(xmin, xmax, N)\n    h = x_grid[1] - x_grid[0]\n\n    # Generate unnormalized analytic orbital\n    if orbital_type == 'gaussian':\n        alpha = param\n        phi_unnormalized = np.exp(-alpha * x_grid**2 / 2.0)\n    elif orbital_type == 'sech':\n        b = param\n        # Use np.exp for potentially better performance/stability than a direct cosh call\n        phi_unnormalized = 2.0 / (np.exp(b * x_grid) + np.exp(-b * x_grid))\n    else:\n        # This branch should not be reached with the given valid problem statement.\n        raise ValueError(f\"Unknown orbital type: {orbital_type}\")\n\n    # Numerically normalize the target orbital using Riemann sum\n    # Integral(|phi|^2 dx) approx sum(|phi_i|^2 * h) = 1\n    norm_sq_integral = np.sum(phi_unnormalized**2) * h\n    phi_target = phi_unnormalized / np.sqrt(norm_sq_integral)\n\n    # Calculate target density\n    n_target = 2.0 * phi_target**2\n\n    # Step 2: Potential Inversion\n    # We invert the KS equation to find v_s from phi_target.\n    # The formula is v_s = (1/2) * (d^2(phi)/dx^2) / phi, up to a constant.\n    # We operate on the interior grid points where boundary conditions are not applied.\n    \n    # Second derivative of phi_target on the interior grid (size N-2)\n    d2_phi_target_interior = (phi_target[2:] - 2*phi_target[1:-1] + phi_target[:-2]) / h**2\n    phi_target_interior = phi_target[1:-1]\n    \n    # Regularize the denominator phi_target to avoid division by zero\n    regularization_threshold = 1e-10\n    phi_denom_reg = np.maximum(phi_target_interior, regularization_threshold)\n    \n    # Calculate potential on the interior grid\n    v_s_interior_raw = 0.5 * d2_phi_target_interior / phi_denom_reg\n    \n    # Fix the gauge by setting the potential at the grid midpoint to zero\n    mid_idx_interior = (N - 2) // 2\n    v_s_interior = v_s_interior_raw - v_s_interior_raw[mid_idx_interior]\n\n    # Step 3: Eigenproblem Solution\n    # Construct the tridiagonal Hamiltonian matrix for the interior grid.\n    # H = T + V, where T is kinetic energy and V is potential energy.\n    diag = 1.0 / h**2 + v_s_interior\n    offdiag = -1.0 / (2.0 * h**2) * np.ones(N - 3)\n    \n    # Solve the eigenproblem for the lowest eigenvalue (ground state)\n    eigenvalues, eigenvectors = eigh_tridiagonal(diag, offdiag, select='i', select_range=(0,0))\n    gs_eigenvector = eigenvectors[:, 0]\n    \n    # Step 4: Verification and Error Calculation\n    # Normalize the eigenvector for continuous inner product: integral(|phi|^2) = 1\n    # The solver returns an eigenvector where sum(vec_i^2) = 1.\n    # We must scale by 1/sqrt(h) to match the Riemann sum integral normalization.\n    phi_reconstructed_interior = gs_eigenvector / np.sqrt(h)\n\n    # Ensure the reconstructed orbital has a positive sign, matching the target.\n    if phi_reconstructed_interior[mid_idx_interior]  0:\n        phi_reconstructed_interior *= -1.0\n        \n    # Assemble the full reconstructed orbital with boundaries\n    phi_reconstructed = np.zeros(N)\n    phi_reconstructed[1:-1] = phi_reconstructed_interior\n    \n    # Reconstruct density\n    n_reconstructed = 2.0 * phi_reconstructed**2\n    \n    # Calculate the relative L2 error norm\n    numerator_sq_integral = np.sum((n_reconstructed - n_target)**2 * h)\n    denominator_sq_integral = np.sum(n_target**2 * h)\n    \n    # Handle the unlikely case of a zero-norm target density\n    if denominator_sq_integral  1e-20:\n        error = 0.0 if numerator_sq_integral  1e-20 else np.inf\n    else:\n        error = np.sqrt(numerator_sq_integral / denominator_sq_integral)\n        \n    # Return boolean result of the check\n    return error = tolerance\n\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (xmin, xmax, N, orbital_type, parameter, tolerance)\n        (-10.0, 10.0, 1201, 'gaussian', 1.0, 1.5e-3),  # Case 1\n        (-6.0, 6.0, 1201, 'gaussian', 2.5, 2.0e-3),   # Case 2\n        (-15.0, 15.0, 2001, 'sech', 0.8, 2.0e-3),      # Case 3\n        (-30.0, 30.0, 2401, 'gaussian', 0.15, 3.0e-3) # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters and process the case\n        xmin, xmax, N, orbital_type, param, tolerance = case\n        passed = _process_case(xmin, xmax, N, orbital_type, param, tolerance)\n        results.append(passed)\n\n    # Final print statement in the exact required format.\n    # Note: str(True) is 'True', str(False) is 'False' in Python.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2901327"}, {"introduction": "Predicting band gaps is a crucial application of DFT, yet it is plagued by a profound conceptual challenge: the Kohn–Sham eigenvalue gap is formally not the fundamental electronic gap due to the derivative discontinuity of the exchange-correlation functional. This advanced computational project [@problem_id:2901417] tackles this \"band gap problem\" head-on using a solvable many-body model as an exact benchmark. By implementing and comparing standard KS, generalized KS hybrid functionals, and empirical scissor corrections, you will gain critical insight into the limitations of DFT for excitation properties and the theoretical underpinnings of modern solutions.", "problem": "You are to design and implement a complete, reproducible benchmarking protocol for band gap prediction on a minimal, but nontrivial, lattice model that captures the conceptual differences between Kohn–Sham density functional theory (DFT), generalized Kohn–Sham hybrids, a posteriori scissor corrections, and the fundamental (charged excitation) gap. Your implementation must be a single, runnable program that computes all required quantities without user input. The protocol must be based on first principles and core definitions and must be expressed in purely mathematical and algorithmic terms.\n\nBase model and definitions:\n- Consider the two-site extended Hubbard dimer with spin, defined on two sites labeled by $i \\in \\{1,2\\}$ and spin labels $\\sigma \\in \\{\\uparrow,\\downarrow\\}$. The second-quantized Hamiltonian is\n$$\n\\hat{H} \\;=\\; -t \\sum_{\\sigma} \\left( \\hat{c}_{1\\sigma}^\\dagger \\hat{c}_{2\\sigma} + \\hat{c}_{2\\sigma}^\\dagger \\hat{c}_{1\\sigma} \\right)\n\\;+\\; \\frac{\\Delta}{2}\\left(\\hat{n}_{1}-\\hat{n}_{2}\\right)\n\\;+\\; U \\sum_{i=1}^{2} \\hat{n}_{i\\uparrow}\\hat{n}_{i\\downarrow}\n\\;+\\; V \\sum_{\\sigma,\\sigma'} \\hat{n}_{1\\sigma}\\hat{n}_{2\\sigma'} \\,,\n$$\nwhere $\\hat{n}_{i\\sigma} = \\hat{c}_{i\\sigma}^\\dagger \\hat{c}_{i\\sigma}$, $\\hat{n}_i = \\sum_{\\sigma}\\hat{n}_{i\\sigma}$, and $t$, $\\Delta$, $U$, $V$ are real parameters. All energies must be treated in electronvolts (eV).\n\n- The fundamental gap at particle number $N$ is defined by the ground-state total energies as\n$$\nE_{\\mathrm{g}}^{\\mathrm{fund}}(N) \\;=\\; \\left[ E_0(N+1) + E_0(N-1) - 2 E_0(N) \\right] \\,,\n$$\nwhere $E_0(M)$ is the exact ground-state energy of $\\hat{H}$ in the $M$-electron sector. This definition is your reference target.\n\n- The spin-restricted Kohn–Sham (KS) noninteracting reference system is defined to reproduce the interacting ground-state site densities under a mean-field closure using only Hartree terms (no explicit exchange–correlation), yielding a $2\\times 2$ one-electron Hamiltonian per spin\n$$\n\\mathbf{h}^{\\mathrm{KS}} \\;=\\; \\begin{pmatrix}\n\\varepsilon_1  -t \\\\\n-t  \\varepsilon_2\n\\end{pmatrix},\n\\quad\n\\varepsilon_1 \\;=\\; \\frac{\\Delta}{2} + U \\frac{n_1}{2} + V n_2, \\;\\;\n\\varepsilon_2 \\;=\\; -\\frac{\\Delta}{2} + U \\frac{n_2}{2} + V n_1 \\,,\n$$\nwhere $n_i$ are the total site occupations to be determined self-consistently at particle number $N=\\;2$ in the spin-unpolarized (closed-shell) solution. The Kohn–Sham band gap is the single-particle eigenvalue difference\n$$\nE_{\\mathrm{g}}^{\\mathrm{KS}} \\;=\\; \\varepsilon_{\\mathrm{LUMO}} - \\varepsilon_{\\mathrm{HOMO}} \\,.\n$$\n\n- The generalized Kohn–Sham hybrid includes a fraction $\\alpha$ of the Fock exchange arising from the intersite interaction $V$ via the Hartree–Fock decoupling of the density–density term, which, in the spin-restricted case, modifies the off-diagonal hopping by a nonlocal exchange contribution proportional to the bond order. Specifically,\n$$\n\\mathbf{h}^{\\mathrm{gKS}} \\;=\\; \\begin{pmatrix}\n\\varepsilon_1  -t_{\\mathrm{eff}} \\\\\n-t_{\\mathrm{eff}}  \\varepsilon_2\n\\end{pmatrix},\n\\quad\nt_{\\mathrm{eff}} \\;=\\; t + \\alpha V p \\,,\n$$\nwhere $p = \\langle \\hat{c}_{1\\sigma}^\\dagger \\hat{c}_{2\\sigma} \\rangle$ is the per-spin bond order obtained self-consistently alongside $n_1$ and $n_2$ at $N=\\;2$ in the same closed-shell manifold, and $\\varepsilon_1,\\varepsilon_2$ are as above. The hybrid band gap is the eigenvalue difference\n$$\nE_{\\mathrm{g}}^{\\mathrm{hyb}} \\;=\\; \\varepsilon_{\\mathrm{LUMO}}^{\\mathrm{gKS}} - \\varepsilon_{\\mathrm{HOMO}}^{\\mathrm{gKS}} \\,.\n$$\n\n- A scissor correction is defined here as an a posteriori constant shift applied to the predicted band gap of a given method, determined by calibrating on a single designated calibration case. For a method $X \\in \\{\\mathrm{KS}, \\mathrm{hyb}\\}$, define\n$$\n\\Delta_{\\mathrm{sc}}^{(X)} \\;=\\; E_{\\mathrm{g}}^{\\mathrm{fund}}(\\text{cal}) - E_{\\mathrm{g}}^{(X)}(\\text{cal}) \\,,\n$$\nand then, for any other case, the scissor-corrected gap prediction is\n$$\n\\widetilde{E}_{\\mathrm{g}}^{(X)} \\;=\\; E_{\\mathrm{g}}^{(X)} + \\Delta_{\\mathrm{sc}}^{(X)} \\,.\n$$\nYour program must use the first parameter set in the test suite as the calibration case.\n\nFundamental base to be used:\n- Use only the above Hamiltonian and the fundamental definitions of the ground-state energy, the fundamental gap, mean-field Hartree closure, and Hartree–Fock decoupling of a density–density interaction to construct the computational protocol. Do not assume any pre-tabulated density functionals. The self-consistent field must be derived from enforcing equality of input and output densities (and bond order, where applicable) for the chosen noninteracting one-body Hamiltonian.\n\nComputational tasks:\n- For each parameter set, compute $E_0(N)$ for $N \\in \\{1,2,3\\}$ exactly by numerically diagonalizing the many-body Hamiltonian in the corresponding particle-number sector. Then compute $E_{\\mathrm{g}}^{\\mathrm{fund}}(2)$ from the definition above. All diagonalizations must be mathematically exact within floating-point precision.\n- For $N=\\;2$, solve the spin-restricted self-consistent field for both $\\mathbf{h}^{\\mathrm{KS}}$ and $\\mathbf{h}^{\\mathrm{gKS}}$ to obtain $E_{\\mathrm{g}}^{\\mathrm{KS}}$ and $E_{\\mathrm{g}}^{\\mathrm{hyb}}$, respectively. Use a fixed hybrid mixing fraction $\\alpha = 0.25$ (dimensionless) and reasonable fixed-point mixing to ensure convergence from a symmetric initial guess.\n- Using the first parameter set as the calibration case, compute $\\Delta_{\\mathrm{sc}}^{(\\mathrm{KS})}$ and $\\Delta_{\\mathrm{sc}}^{(\\mathrm{hyb})}$ from the differences between $E_{\\mathrm{g}}^{\\mathrm{fund}}$ and the corresponding method’s uncorrected gap.\n- For all remaining parameter sets, report the absolute errors (in eV) of four predictors with respect to $E_{\\mathrm{g}}^{\\mathrm{fund}}$: the uncorrected Kohn–Sham gap, the uncorrected hybrid gap, the scissor-corrected Kohn–Sham gap, and the scissor-corrected hybrid gap.\n\nNumerical units and output:\n- All energies must be treated and reported in electronvolts (eV). The final reported errors must be floats in eV.\n- Angles do not appear; no angle units are required.\n\nTest suite:\n- Use the following parameter sets $(t, \\Delta, U, V)$, all in eV, at total particle number $N=\\;2$:\n    - Case $\\mathrm{A}$ (calibration): $(t, \\Delta, U, V) = (1.0, 0.5, 4.0, 1.0)$.\n    - Case $\\mathrm{B}$ (edge: no intersite exchange): $(t, \\Delta, U, V) = (1.0, 0.5, 4.0, 0.0)$.\n    - Case $\\mathrm{C}$ (large site asymmetry): $(t, \\Delta, U, V) = (1.0, 3.0, 4.0, 1.0)$.\n    - Case $\\mathrm{D}$ (weak correlation, symmetric): $(t, \\Delta, U, V) = (1.0, 0.0, 1.0, 0.2)$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the $12$ results as a comma-separated list enclosed in square brackets. The order must be\n$$\n\\left[\n\\begin{array}{l}\n\\text{B:}\\; |E_{\\mathrm{g}}^{\\mathrm{KS}} - E_{\\mathrm{g}}^{\\mathrm{fund}}|,\\; |E_{\\mathrm{g}}^{\\mathrm{hyb}} - E_{\\mathrm{g}}^{\\mathrm{fund}}|,\\; |\\widetilde{E}_{\\mathrm{g}}^{\\mathrm{KS}} - E_{\\mathrm{g}}^{\\mathrm{fund}}|,\\; |\\widetilde{E}_{\\mathrm{g}}^{\\mathrm{hyb}} - E_{\\mathrm{g}}^{\\mathrm{fund}}|, \\\\\n\\text{C:}\\; |E_{\\mathrm{g}}^{\\mathrm{KS}} - E_{\\mathrm{g}}^{\\mathrm{fund}}|,\\; |E_{\\mathrm{g}}^{\\mathrm{hyb}} - E_{\\mathrm{g}}^{\\mathrm{fund}}|,\\; |\\widetilde{E}_{\\mathrm{g}}^{\\mathrm{KS}} - E_{\\mathrm{g}}^{\\mathrm{fund}}|,\\; |\\widetilde{E}_{\\mathrm{g}}^{\\mathrm{hyb}} - E_{\\mathrm{g}}^{\\mathrm{fund}}|, \\\\\n\\text{D:}\\; |E_{\\mathrm{g}}^{\\mathrm{KS}} - E_{\\mathrm{g}}^{\\mathrm{fund}}|,\\; |E_{\\mathrm{g}}^{\\mathrm{hyb}} - E_{\\mathrm{g}}^{\\mathrm{fund}}|,\\; |\\widetilde{E}_{\\mathrm{g}}^{\\mathrm{KS}} - E_{\\mathrm{g}}^{\\mathrm{fund}}|,\\; |\\widetilde{E}_{\\mathrm{g}}^{\\mathrm{hyb}} - E_{\\mathrm{g}}^{\\mathrm{fund}}|\n\\end{array}\n\\right] \\,,\n$$\nnumerically as a single flat list of $12$ floats in eV, with no additional text.\n\nScientific realism and derivation mandate:\n- Begin from the Hamiltonian and gap definitions above. Derive the self-consistent one-body problems by enforcing equality of input and output one-body densities (and bond order in the hybrid case) for the noninteracting reference, at $N=\\;2$. Do not assume any pre-specified functional forms beyond Hartree and Hartree–Fock decouplings of the given density–density interactions. Ensure all numerical procedures are consistent and converged.\n\nYour final answer must be a complete, runnable program following the execution environment specified later.", "solution": "The problem statement is a valid and well-posed exercise in computational quantum chemistry. It is scientifically grounded in the established principles of many-body physics and density functional theory, using the extended Hubbard model as a non-trivial testbed. It is objective, self-contained, and all terms are rigorously defined. The computational tasks are feasible and directly address the core concepts of band gap prediction. We may therefore proceed with the derivation and solution.\n\nThe protocol requires comparing exact results with approximations derived from Kohn–Sham (KS) and generalized Kohn–Sham (gKS) theories. We shall first detail the procedure for obtaining the exact fundamental gap, which serves as our reference benchmark. Subsequently, we will derive the self-consistent field (SCF) equations for the KS and gKS methods. Finally, we will outline the full computational procedure for the benchmark.\n\n**1. Exact Fundamental Gap from Many-Body Hamiltonian**\n\nThe fundamental gap for a system with a ground state of $N$ particles is defined via the total ground state energies $E_0(M)$ for $M$ particles:\n$$\nE_{\\mathrm{g}}^{\\mathrm{fund}}(N) = E_0(N+1) + E_0(N-1) - 2 E_0(N)\n$$\nFor our target case of $N=2$, we must find the exact ground state energies for the $N=1$, $N=2$, and $N=3$ electron systems governed by the specified Hamiltonian, $\\hat{H}$. This is accomplished by constructing the full many-body Hamiltonian matrix in a basis of occupation number states and finding its lowest eigenvalue numerically. The basis is constructed from four spin-orbitals, $\\{|1\\uparrow\\rangle, |1\\downarrow\\rangle, |2\\uparrow\\rangle, |2\\downarrow\\rangle\\}$.\n\n**N=1 Electron Sector:**\nThe basis consists of $\\binom{4}{1}=4$ states. Due to spin degeneracy, we need only consider a single spin, for instance, spin-up. The basis is $\\{|1\\uparrow\\rangle, |2\\uparrow\\rangle\\}$. The Hamiltonian matrix is:\n$$\n\\mathbf{H}^{(1)} = \\begin{pmatrix} \\Delta/2  -t \\\\ -t  -\\Delta/2 \\end{pmatrix}\n$$\nThe ground state energy $E_0(1)$ is the lowest eigenvalue of $\\mathbf{H}^{(1)}$, which is $E_0(1) = -\\sqrt{(\\Delta/2)^2 + t^2}$.\n\n**N=3 Electron Sector:**\nThis sector is particle-hole symmetric to the $N=1$ sector. The basis has $\\binom{4}{3}=4$ states. Considering the subspace with total spin projection $S_z = +1/2$, the basis states can be written as $|1,1,1,0\\rangle$ and $|1,0,1,1\\rangle$ in the occupation number representation $(n_{1\\uparrow}, n_{1\\downarrow}, n_{2\\uparrow}, n_{2\\downarrow})$. The corresponding Hamiltonian matrix is:\n$$\n\\mathbf{H}^{(3)} = \\begin{pmatrix} U+2V+\\Delta/2  -t \\\\ -t  U+2V-\\Delta/2 \\end{pmatrix}\n$$\nThe ground state energy $E_0(3)$ is the lowest eigenvalue of $\\mathbf{H}^{(3)}$, which is $E_0(3) = U+2V - \\sqrt{(\\Delta/2)^2 + t^2}$. The $S_z=-1/2$ subspace yields the same spectrum.\n\n**N=2 Electron Sector:**\nThe basis consists of $\\binom{4}{2}=6$ states. The ground state of this system is typically a spin singlet ($S=0$). Construction of the Hamiltonian matrix in the singlet subspace, composed of the two ionic states (doublon on site $1$ or $2$) and the covalent singlet state, is a standard textbook procedure. Using the basis $\\{|D_1\\rangle, |D_2\\rangle, |S\\rangle\\}$, where $|D_1\\rangle$ is the doubly-occupied site $1$, $|D_2\\rangle$ is the doubly-occupied site $2$, and $|S\\rangle$ is the covalent singlet combination, the Hamiltonian matrix for the singlet sector is:\n$$\n\\mathbf{H}^{(2)}_{\\text{singlet}} = \\begin{pmatrix} U+\\Delta  0  \\sqrt{2}t \\\\ 0  U-\\Delta  \\sqrt{2}t \\\\ \\sqrt{2}t  \\sqrt{2}t  V \\end{pmatrix}\n$$\nThe ground state energy $E_0(2)$ is the minimum of the lowest eigenvalue of $\\mathbf{H}^{(2)}_{\\text{singlet}}$ and the energy of the lowest triplet state, which is simply $V$. For the parameters provided, the singlet ground state is always lower in energy.\n\nThe fundamental gap at $N=2$ is then computed by substituting the numerically obtained ground-state energies $E_0(1)$, $E_0(2)$, and $E_0(3)$ into the definition.\n\n**2. Self-Consistent Field (SCF) Methods**\n\nFor the $N=2$ system, we solve the spin-restricted SCF problem. Two electrons occupy the lowest-energy molecular orbital (the HOMO) of a non-interacting system described by a $2 \\times 2$ effective Hamiltonian $\\mathbf{h}$.\n\nThe one-electron Hamiltonian for a single spin is:\n$$\n\\mathbf{h} = \\begin{pmatrix} \\varepsilon_1  -t_{\\mathrm{eff}} \\\\ -t_{\\mathrm{eff}}  \\varepsilon_2 \\end{pmatrix}\n$$\nIts eigenvalues are $\\lambda_{\\pm} = \\frac{\\varepsilon_1+\\varepsilon_2}{2} \\pm \\sqrt{(\\frac{\\varepsilon_1-\\varepsilon_2}{2})^2 + t_{\\mathrm{eff}}^2}$. The occupied orbital (HOMO) corresponds to $\\lambda_-$, and the unoccupied orbital (LUMO) to $\\lambda_+$. The band gap is $E_{\\mathrm{g}} = \\lambda_+ - \\lambda_- = \\sqrt{(\\varepsilon_1-\\varepsilon_2)^2 + 4t_{\\mathrm{eff}}^2}$.\n\nThe normalized eigenvector $\\mathbf{c}_- = (c_{1-}, c_{2-})^T$ for the HOMO $\\lambda_-$ is used to compute the site densities $n_i$ and the per-spin bond order $p$:\n$$\nn_1 = 2 c_{1-}^2, \\quad n_2 = 2 c_{2-}^2, \\quad p = c_{1-} c_{2-}\n$$\nThe factor of $2$ for the densities arises from double occupancy of the HOMO in the spin-restricted formalism. These quantities must be consistent with the parameters of the Hamiltonian that produced them.\n\n**Kohn–Sham (KS) Method:**\nThe KS system is defined by a purely local potential. In this model, this corresponds to the Hartree potential. The effective hopping $t_{\\mathrm{eff}}$ is simply the bare hopping $t$. The on-site energies are:\n$$\n\\varepsilon_1^{\\mathrm{KS}} = \\frac{\\Delta}{2} + U \\frac{n_1}{2} + V n_2, \\quad \\varepsilon_2^{\\mathrm{KS}} = -\\frac{\\Delta}{2} + U \\frac{n_2}{2} + V n_1\n$$\nThe SCF procedure involves iterating the calculation of $(\\varepsilon_1, \\varepsilon_2)$ and $(n_1, n_2)$ until self-consistency is reached.\n\n**Generalized Kohn–Sham (gKS) Hybrid Method:**\nThe hybrid method includes a fraction $\\alpha$ of Fock exchange. For the intersite $V$ term, this modifies the off-diagonal hopping:\n$$\nt_{\\mathrm{eff}} = t + \\alpha V p\n$$\nThe on-site energies $\\varepsilon_i$ are identical to the KS case. The SCF procedure now iterates $(\\varepsilon_1, \\varepsilon_2, t_{\\mathrm{eff}})$ and $(n_1, n_2, p)$ to self-consistency. We use the specified fraction $\\alpha=0.25$.\n\nThe SCF algorithm for both methods is as follows:\n1.  Initialize with a guess for the densities (and bond order for gKS), e.g., $n_1=1, n_2=1, p=0.5$.\n2.  Construct the effective Hamiltonian $\\mathbf{h}$ using the current densities and bond order.\n3.  Diagonalize $\\mathbf{h}$ to find the HOMO eigenvector $\\mathbf{c}_-$.\n4.  Compute the output densities $n'_i$ and bond order $p'$ from $\\mathbf{c}_-$.\n5.  Check for convergence by comparing input and output quantities. If converged, exit.\n6.  Update the densities and bond order using a mixing scheme (e.g., linear mixing with parameter $\\beta$): $n_i \\leftarrow (1-\\beta)n_i + \\beta n'_i$. Return to step 2.\n\n**3. Scissor Correction**\n\nThe scissor correction is an a posteriori adjustment to the calculated gap. For a method $X \\in \\{\\mathrm{KS}, \\mathrm{hyb}\\}$, the correction $\\Delta_{\\mathrm{sc}}^{(X)}$ is calibrated on a single reference case (here, Case A):\n$$\n\\Delta_{\\mathrm{sc}}^{(X)} = E_{\\mathrm{g}}^{\\mathrm{fund}}(\\text{A}) - E_{\\mathrm{g}}^{(X)}(\\text{A})\n$$\nThis constant shift is then applied to the gap predicted by method $X$ for any other parameter set:\n$$\n\\widetilde{E}_{\\mathrm{g}}^{(X)} = E_{\\mathrm{g}}^{(X)} + \\Delta_{\\mathrm{sc}}^{(X)}\n$$\n\n**4. Benchmarking Protocol**\nThe full computational protocol is:\n1.  For the calibration case (Case A), compute $E_{\\mathrm{g}}^{\\mathrm{fund}}(\\text{A})$, $E_{\\mathrm{g}}^{\\mathrm{KS}}(\\text{A})$, and $E_{\\mathrm{g}}^{\\mathrm{hyb}}(\\text{A})$.\n2.  From these results, determine the two scissor corrections, $\\Delta_{\\mathrm{sc}}^{(\\mathrm{KS})}$ and $\\Delta_{\\mathrm{sc}}^{(\\mathrm{hyb})}$.\n3.  For each of the remaining test cases (B, C, D):\n    a. Compute the exact fundamental gap $E_{\\mathrm{g}}^{\\mathrm{fund}}$.\n    b. Compute the uncorrected gaps $E_{\\mathrm{g}}^{\\mathrm{KS}}$ and $E_{\\mathrm{g}}^{\\mathrm{hyb}}$ via SCF.\n    c. Apply the scissor corrections to obtain $\\widetilde{E}_{\\mathrm{g}}^{\\mathrm{KS}}$ and $\\widetilde{E}_{\\mathrm{g}}^{\\mathrm{hyb}}$.\n    d. Calculate the four required absolute errors with respect to the exact fundamental gap: $|E_{\\mathrm{g}}^{\\mathrm{KS}} - E_{\\mathrm{g}}^{\\mathrm{fund}}|$, $|E_{\\mathrm{g}}^{\\mathrm{hyb}} - E_{\\mathrm{g}}^{\\mathrm{fund}}|$, $|\\widetilde{E}_{\\mathrm{g}}^{\\mathrm{KS}} - E_{\\mathrm{g}}^{\\mathrm{fund}}|$, and $|\\widetilde{E}_{\\mathrm{g}}^{\\mathrm{hyb}} - E_{\\mathrm{g}}^{\\mathrm{fund}}|$.\n4.  Consolidate the $12$ error values from cases B, C, and D into a single list for the final output.\nThis procedure provides a rigorous, first-principles-based benchmark of the different gap prediction methodologies on a model system that captures essential correlation physics.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main function to execute the benchmarking protocol for band gap prediction.\n    \"\"\"\n\n    def get_fundamental_gap(params):\n        \"\"\"\n        Calculates the exact fundamental gap by diagonalizing the many-body Hamiltonian.\n        \"\"\"\n        t, delta, U, V = params\n\n        # N=1 electron sector\n        H1 = np.array([\n            [delta / 2.0, -t],\n            [-t, -delta / 2.0]\n        ])\n        eigvals1, _ = eigh(H1)\n        e0_1 = eigvals1[0]\n\n        # N=3 electron sector\n        H3 = np.array([\n            [U + 2 * V + delta / 2.0, -t],\n            [-t, U + 2 * V - delta / 2.0]\n        ])\n        eigvals3, _ = eigh(H3)\n        e0_3 = eigvals3[0]\n\n        # N=2 electron sector (singlet subspace)\n        # Note: The triplet energy is V. For the given parameters, the singlet\n        # ground state is always lower.\n        H2_singlet = np.array([\n            [U + delta, 0, np.sqrt(2) * t],\n            [0, U - delta, np.sqrt(2) * t],\n            [np.sqrt(2) * t, np.sqrt(2) * t, V]\n        ])\n        eigvals2, _ = eigh(H2_singlet)\n        e0_2 = eigvals2[0]\n\n        # Fundamental gap definition for N=2\n        fund_gap = e0_1 + e0_3 - 2 * e0_2\n        return fund_gap\n\n    def scf_solver(params, alpha, tol=1e-12, max_iter=200, mix_beta=0.5):\n        \"\"\"\n        Solves the self-consistent field equations for KS and gKS systems.\n        \"\"\"\n        t, delta, U, V = params\n\n        # Initial guess\n        n1, n2 = 1.0, 1.0\n        # Bond order p is only used in gKS (alpha > 0)\n        p = 0.5 \n\n        for _ in range(max_iter):\n            # Construct the 1-body effective Hamiltonian\n            e1 = delta / 2.0 + U * n1 / 2.0 + V * n2\n            e2 = -delta / 2.0 + U * n2 / 2.0 + V * n1\n            \n            t_eff = t\n            if alpha > 0:\n                t_eff = t + alpha * V * p\n\n            h_eff = np.array([\n                [e1, -t_eff],\n                [-t_eff, e2]\n            ])\n\n            # Diagonalize to find HOMO/LUMO\n            eigvals, eigvecs = eigh(h_eff)\n            homo_eigval, lumo_eigval = eigvals[0], eigvals[1]\n            homo_vec = eigvecs[:, 0]\n            \n            # Compute new densities and bond order from HOMO\n            c1, c2 = homo_vec[0], homo_vec[1]\n            n1_new = 2.0 * c1**2\n            n2_new = 2.0 * c2**2\n            p_new = c1 * c2\n\n            # Check for convergence\n            density_diff = abs(n1 - n1_new) + abs(n2 - n2_new)\n            bond_order_diff = abs(p - p_new) if alpha > 0 else 0.0\n            \n            if density_diff  tol and bond_order_diff  tol:\n                break\n\n            # Mix for next iteration\n            n1 = (1.0 - mix_beta) * n1 + mix_beta * n1_new\n            n2 = (1.0 - mix_beta) * n2 + mix_beta * n2_new\n            if alpha > 0:\n                p = (1.0 - mix_beta) * p + mix_beta * p_new\n\n        # The gap is the eigenvalue difference\n        gap = lumo_eigval - homo_eigval\n        return gap\n\n    # Define test cases from the problem statement.\n    # (t, delta, U, V) in eV\n    test_cases = {\n        'A': (1.0, 0.5, 4.0, 1.0),\n        'B': (1.0, 0.5, 4.0, 0.0),\n        'C': (1.0, 3.0, 4.0, 1.0),\n        'D': (1.0, 0.0, 1.0, 0.2),\n    }\n\n    # --- Calibration Step (Case A) ---\n    params_calib = test_cases['A']\n    alpha_hyb = 0.25\n\n    e_fund_calib = get_fundamental_gap(params_calib)\n    e_ks_calib = scf_solver(params_calib, alpha=0.0)\n    e_hyb_calib = scf_solver(params_calib, alpha=alpha_hyb)\n\n    # Compute scissor corrections\n    delta_sc_ks = e_fund_calib - e_ks_calib\n    delta_sc_hyb = e_fund_calib - e_hyb_calib\n\n    # --- Benchmarking Step (Cases B, C, D) ---\n    results = []\n    for case_name in ['B', 'C', 'D']:\n        params = test_cases[case_name]\n        \n        # 1. Exact fundamental gap\n        e_fund = get_fundamental_gap(params)\n\n        # 2. Uncorrected KS and hybrid gaps\n        e_ks = scf_solver(params, alpha=0.0)\n        e_hyb = scf_solver(params, alpha=alpha_hyb)\n\n        # 3. Scissor-corrected gaps\n        e_ks_sc = e_ks + delta_sc_ks\n        e_hyb_sc = e_hyb + delta_sc_hyb\n\n        # 4. Compute absolute errors\n        err_ks = abs(e_ks - e_fund)\n        err_hyb = abs(e_hyb - e_fund)\n        err_ks_sc = abs(e_ks_sc - e_fund)\n        err_hyb_sc = abs(e_hyb_sc - e_fund)\n        \n        results.extend([err_ks, err_hyb, err_ks_sc, err_hyb_sc])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```", "id": "2901417"}]}