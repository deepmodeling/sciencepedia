{"hands_on_practices": [{"introduction": "Before diving into calculations, it is crucial to distinguish between two common sources of error in quantum chemistry: those from an incomplete $N$-electron wavefunction model and those from an incomplete one-electron basis set. This exercise [@problem_id:2923590] untangles the concepts of size consistency, an intrinsic property of a method, from Basis Set Superposition Error (BSSE), a basis set artifact. By analyzing this conceptual scenario, you will clarify why truncated methods like Configuration Interaction with Singles and Doubles (CISD) are not size-consistent, even when basis set artifacts are completely removed.", "problem": "Consider two closed-shell fragments, denoted $A$ and $B$, placed at a center-of-mass separation $R$ so large that inter-fragment couplings are negligible, i.e., $R \\to \\infty$. In this limit, the exact molecular Hamiltonian separates as $H = H_A \\oplus H_B$, and the exact ground-state energy is additive, $E_{\\mathrm{exact}}(A \\cdots B) = E_{\\mathrm{exact}}(A) + E_{\\mathrm{exact}}(B)$. A computational method is called size consistent if, when applied in a common one-electron space to the noninteracting dimer $A \\cdots B$ and the monomers $A$ and $B$, it yields $E(A \\cdots B) = E(A) + E(B)$, and it is called size extensive if the total energy scales linearly with the number of noninteracting, identical fragments. Basis set superposition error (BSSE) arises when the dimer calculation effectively benefits from an enlarged one-electron space relative to separate monomers; the Boys–Bernardi counterpoise (CP) protocol seeks to remove BSSE by computing monomer energies in the full dimer one-electron basis via ghost functions, so that all energies are compared in the same one-electron space.\n\nYou will analyze methods in the following concrete scenario: perform supermolecular calculations on $A \\cdots B$ at $R \\to \\infty$ and monomer calculations on $A$ and $B$, all in the identical one-electron space given by the full dimer basis (i.e., with counterpoise). In this setup, BSSE is removed by construction. Let Configuration Interaction with Singles and Doubles (CISD), Coupled Cluster with Singles and Doubles (CCSD), and the Davidson size-extensivity correction to truncated Configuration Interaction (CI) be used as correlated methods. Assume closed-shell Restricted Hartree–Fock references for all systems to avoid spin and symmetry complications.\n\nWhich of the following statements are correct in this CP-corrected, $R \\to \\infty$ limit?\n\nA. Even after counterpoise correction, CISD can violate size consistency for $A \\cdots B$, i.e., one can find $E^{\\mathrm{CISD}}(A \\cdots B) \\neq E^{\\mathrm{CISD}}(A;\\mathrm{CP}) + E^{\\mathrm{CISD}}(B;\\mathrm{CP})$ because disconnected excitations are not represented.\n\nB. In the same setup, CCSD remains exactly size consistent, i.e., $E^{\\mathrm{CCSD}}(A \\cdots B) = E^{\\mathrm{CCSD}}(A;\\mathrm{CP}) + E^{\\mathrm{CCSD}}(B;\\mathrm{CP})$ at $R \\to \\infty$.\n\nC. Counterpoise correction by itself guarantees $E(A \\cdots B) = E(A;\\mathrm{CP}) + E(B;\\mathrm{CP})$ for any correlated method, hence it enforces size consistency irrespective of the wavefunction ansatz.\n\nD. Appending a Davidson size-extensivity correction to CISD makes the energy strictly size consistent for any pair of fragments at $R \\to \\infty$, so that $E^{\\mathrm{CISD+Dav}}(A \\cdots B) = E^{\\mathrm{CISD+Dav}}(A;\\mathrm{CP}) + E^{\\mathrm{CISD+Dav}}(B;\\mathrm{CP})$ holds exactly.\n\nSelect all that apply, and base your reasoning on first-principles definitions of separability, wavefunction factorization for noninteracting fragments, and the role of disconnected excitations versus one-electron basis completeness. Your answer should reflect a logically consistent construction of a case in which BSSE is corrected but size consistency still fails, or a proof that such failure cannot occur for a given method in this limit. No numerical data need be used; your argument should flow from the structure of the ansatz and the Hamiltonian separation at $R \\to \\infty$.", "solution": "The problem statement has been validated and is found to be scientifically grounded, well-posed, objective, and internally consistent. It poses a standard theoretical question in quantum chemistry concerning the properties of widely used electronic structure methods. The given definitions and the scenario are correct and provide a suitable basis for a rigorous analysis. We shall now proceed with the solution.\n\nThe fundamental principle governing this problem is the separability of the electronic wavefunction for a system composed of two non-interacting fragments, $A$ and $B$, at infinite separation ($R \\to \\infty$). In this limit, the exact Hamiltonian is a direct sum, $H = H_A \\oplus H_B$, where $H_A$ and $H_B$ operate exclusively on the electrons and nuclei of fragments $A$ and $B$, respectively. The exact ground-state wavefunction, $\\Psi_{\\mathrm{exact}}(A \\cdots B)$, must be an antisymmetrized product of the monomer wavefunctions, $\\Psi_{\\mathrm{exact}}(A)$ and $\\Psi_{\\mathrm{exact}}(B)$:\n$$\n\\Psi_{\\mathrm{exact}}(A \\cdots B) = \\mathcal{A} [ \\Psi_{\\mathrm{exact}}(A) \\Psi_{\\mathrm{exact}}(B) ]\n$$\nHere, $\\mathcal{A}$ is the antisymmetrizer. The consequence for the energy is strict additivity:\n$$\nE_{\\mathrm{exact}}(A \\cdots B) = E_{\\mathrm{exact}}(A) + E_{\\mathrm{exact}}(B)\n$$\nAn approximate method is size consistent if its energy also obeys this additivity. The problem specifies that all calculations (dimer and monomers) are performed in the identical, full dimer one-electron basis. This is the essence of the counterpoise (CP) correction. This setup eliminates the basis set superposition error (BSSE) from consideration, isolating the intrinsic behavior of the electronic structure method's N-electron ansatz. The reference for all correlated calculations is the Restricted Hartree-Fock (RHF) determinant, $\\Phi_0$. The RHF method itself is size consistent, meaning $E^{\\mathrm{RHF}}(A \\cdots B) = E^{\\mathrm{RHF}}(A;\\mathrm{CP}) + E^{\\mathrm{RHF}}(B;\\mathrm{CP})$ in this setup.\n\nWe now evaluate each statement.\n\n**Analysis of Statement A:**\nThis statement claims that Configuration Interaction with Singles and Doubles (CISD) can fail to be size consistent even after counterpoise correction. The CISD wavefunction is a linear expansion of the reference determinant ($\\Phi_0$) and all singly ($S$) and doubly ($D$) excited determinants:\n$$\n|\\Psi_{\\mathrm{CISD}}\\rangle = c_0 |\\Phi_0\\rangle + \\sum_{i \\in \\mathrm{occ}, a \\in \\mathrm{virt}} c_i^a |\\Phi_i^a\\rangle + \\sum_{i<j, a<b} c_{ij}^{ab} |\\Phi_{ij}^{ab}\\rangle\n$$\nFor two non-interacting fragments $A$ and $B$, the set of occupied and virtual orbitals partitions into those localized on $A$ and those on $B$. Excitations can therefore be classified as occurring entirely on $A$ (e.g., $S_A$, $D_A$) or entirely on $B$ (e.g., $S_B$, $D_B$).\nThe CISD trial wavefunction for the dimer $A \\cdots B$ includes determinants corresponding to single excitations on $A$ or $B$, and double excitations on $A$ or $B$. A double excitation can also be a simultaneous single excitation on $A$ and a single excitation on $B$ ($S_A S_B$).\nHowever, consider the product of the monomer CISD wavefunctions, which is the form the exact wavefunction takes:\n$$\n|\\Psi_{\\mathrm{CISD}}(A)\\rangle \\otimes |\\Psi_{\\mathrm{CISD}}(B)\\rangle = (c_0^A |\\Phi_0(A)\\rangle + |\\Psi_{S_A}\\rangle + |\\Psi_{D_A}\\rangle) \\otimes (c_0^B |\\Phi_0(B)\\rangle + |\\Psi_{S_B}\\rangle + |\\Psi_{D_B}\\rangle)\n$$\nWhen this product is expanded, it contains terms such as $|\\Psi_{D_A}\\rangle \\otimes |\\Psi_{D_B}\\rangle$. This term represents a simultaneous double excitation on fragment $A$ and a double excitation on fragment $B$. From the perspective of the supermolecule $A \\cdots B$, this is a quadruple ($Q$) excitation.\nThe CISD method, by definition, truncates the configuration expansion at double excitations. It does not include any triple ($T$) or quadruple ($Q$) excitation spaces. Therefore, the CISD wavefunction for the supersystem $A \\cdots B$ is fundamentally incapable of representing the correct separable form, as it omits the crucial disconnected product terms like $D_A D_B$. Because the variational space for the dimer is incomplete in this specific way, the resulting variational energy $E^{\\mathrm{CISD}}(A \\cdots B)$ is not equal to the sum of the monomer energies, $E^{\\mathrm{CISD}}(A;\\mathrm{CP}) + E^{\\mathrm{CISD}}(B;\\mathrm{CP})$. The method is not size consistent. The failure is intrinsic to the linear wavefunction ansatz and is unrelated to the one-electron basis, which the CP protocol has already corrected.\nVerdict for A: **Correct**.\n\n**Analysis of Statement B:**\nThis statement claims that Coupled Cluster with Singles and Doubles (CCSD) is exactly size consistent in the same setup. The CCSD wavefunction is defined by an exponential ansatz:\n$$\n|\\Psi_{\\mathrm{CCSD}}\\rangle = e^{\\hat{T}} |\\Phi_0\\rangle, \\quad \\text{where} \\quad \\hat{T} = \\hat{T}_1 + \\hat{T}_2\n$$\n$\\hat{T}_1$ and $\\hat{T}_2$ are the cluster operators that generate all single and double excitations, respectively. For non-interacting fragments $A$ and $B$, the excitation operators are separable: $\\hat{T}(A \\cdots B) = \\hat{T}(A) + \\hat{T}(B)$. Specifically, $\\hat{T}_1(A \\cdots B) = \\hat{T}_1(A) + \\hat{T}_1(B)$ and $\\hat{T}_2(A \\cdots B) = \\hat{T}_2(A) + \\hat{T}_2(B)$.\nThe cluster operators for different fragments, $\\hat{T}(A)$ and $\\hat{T}(B)$, act on distinct sets of electrons and orbitals and therefore commute: $[\\hat{T}(A), \\hat{T}(B)] = 0$. This allows the exponential operator for the supersystem to be factorized:\n$$\ne^{\\hat{T}(A \\cdots B)} = e^{\\hat{T}(A) + \\hat{T}(B)} = e^{\\hat{T}(A)} e^{\\hat{T}(B)}\n$$\nApplying this to the separable reference wavefunction $\\Phi_0(A \\cdots B) = \\mathcal{A}[\\Phi_0(A)\\Phi_0(B)]$ gives:\n$$\n|\\Psi_{\\mathrm{CCSD}}(A \\cdots B)\\rangle = e^{\\hat{T}(A)} e^{\\hat{T}(B)} \\mathcal{A}[\\Phi_0(A)\\Phi_0(B)] = \\mathcal{A}[ (e^{\\hat{T}(A)}|\\Phi_0(A)\\rangle) \\otimes (e^{\\hat{T}(B)}|\\Phi_0(B)\\rangle) ] = \\mathcal{A}[ |\\Psi_{\\mathrm{CCSD}}(A)\\rangle \\otimes |\\Psi_{\\mathrm{CCSD}}(B)\\rangle ]\n$$\nThe CCSD wavefunction for the supersystem correctly factorizes into the product of the monomer CCSD wavefunctions. The expansion of the exponential, $e^{\\hat{T}} = 1 + \\hat{T} + \\frac{1}{2!}\\hat{T}^2 + \\dots$, automatically includes disconnected higher excitations. For example, the term $\\frac{1}{2!}(\\hat{T}_2(A)+\\hat{T}_2(B))^2$ contains the term $\\hat{T}_2(A)\\hat{T}_2(B)$, which corresponds to the disconnected quadruple excitations ($D_A D_B$) that CISD lacks. Because the wavefunction is correctly separable, the energy equations also separate, leading to strict energy additivity: $E^{\\mathrm{CCSD}}(A \\cdots B) = E^{\\mathrm{CCSD}}(A;\\mathrm{CP}) + E^{\\mathrm{CCSD}}(B;\\mathrm{CP})$.\nVerdict for B: **Correct**.\n\n**Analysis of Statement C:**\nThis statement posits that counterpoise correction by itself enforces size consistency for *any* correlated method. As demonstrated in the analysis of statement A, this is false. The CISD method is not size consistent even when a CP-corrected protocol is used. The CP correction addresses artifacts of an incomplete *one-electron basis set*. Size consistency is a property of the *N-electron wavefunction ansatz*. A method with an intrinsically non-separable ansatz (like truncated CI) will not be made separable by using a complete one-electron basis.\nVerdict for C: **Incorrect**.\n\n**Analysis of Statement D:**\nThis statement claims that adding the Davidson correction to CISD makes the energy *strictly* size consistent. The Davidson correction is an *a posteriori* approximation designed to estimate the energy contribution of higher, primarily quadruple, excitations that are omitted in CISD. A common form of the correction is:\n$$\n\\Delta E_{\\mathrm{Dav}} = (1 - c_0^2)(E_{\\mathrm{CISD}} - E_{\\mathrm{RHF}})\n$$\nwhere $c_0$ is the coefficient of the RHF determinant in the normalized CISD wavefunction. The total energy is $E^{\\mathrm{CISD+Dav}} = E_{\\mathrm{CISD}} + \\Delta E_{\\mathrm{Dav}}$. For this to be strictly size consistent, we would require $E^{\\mathrm{CISD+Dav}}(A \\cdots B) = E^{\\mathrm{CISD+Dav}}(A;\\mathrm{CP}) + E^{\\mathrm{CISD+Dav}}(B;\\mathrm{CP})$. Let us check this condition.\nFor the supersystem:\n$E_{\\mathrm{super}} = E^{\\mathrm{CISD}}(AB) + (1-[c_0(AB)]^2)(E^{\\mathrm{CISD}}(AB) - E^{\\mathrm{RHF}}(AB))$\nFor the sum of monomers:\n$E_{\\mathrm{sum}} = E^{\\mathrm{CISD}}(A) + E^{\\mathrm{CISD}}(B) + (1-[c_0(A)]^2)(E^{\\mathrm{CISD}}(A) - E^{\\mathrm{RHF}}(A)) + (1-[c_0(B)]^2)(E^{\\mathrm{CISD}}(B) - E^{\\mathrm{RHF}}(B))$\nFor non-interacting systems, the coefficient of the reference state in the dimer CISD wavefunction is approximately the product of the monomer coefficients, $c_0(AB) \\approx c_0(A)c_0(B)$. We also know $E^{\\mathrm{RHF}}(AB) = E^{\\mathrm{RHF}}(A) + E^{\\mathrm{RHF}}(B)$ and $E^{\\mathrm{CISD}}(AB) \\neq E^{\\mathrm{CISD}}(A) + E^{\\mathrm{CISD}}(B)$.\nSubstituting these relations makes it immediately clear that $E_{\\mathrm{super}} \\neq E_{\\mathrm{sum}}$. The algebraic form of the correction does not lead to an exact cancellation of the size-consistency error. The Davidson correction is derived from perturbation theory arguments; it is an *estimate*, not a result of a rigorously separable theory. While it significantly *improves* the size-consistency and size-extensivity behavior of CISD, it does not make it *strictly* or *exactly* size consistent.\nVerdict for D: **Incorrect**.", "answer": "$$\\boxed{AB}$$", "id": "2923590"}, {"introduction": "Having established that truncated CI is not size-consistent, we now quantify this error using a concrete example. This practice [@problem_id:2923657] guides you through a classic pedagogical derivation of the CISD size-consistency error for a model system of two non-interacting Helium atoms. By constructing and diagonalizing the Hamiltonian matrices, you will see exactly how the variational space truncation—specifically the omission of disconnected quadruple excitations—leads to a non-additive total energy.", "problem": "Consider two helium atoms, labeled $A$ and $B$, separated by a very large distance so that the total electronic Hamiltonian decomposes exactly as $H = H_A + H_B$, and the one-electron orbital basis is fixed and strictly localized on each atom. Let the restricted Hartree–Fock reference for each monomer be $|0_X\\rangle$ with energy $\\langle 0_X|H_X|0_X\\rangle = E_{\\mathrm{ref}}$ for $X \\in \\{A,B\\}$. Model the dominant correlation on each monomer by a single doubly excited determinant $|D_X\\rangle$, so that in the monomer basis $\\{|0_X\\rangle, |D_X\\rangle\\}$ the Hamiltonian matrix elements are\n- $\\langle 0_X|H_X|0_X\\rangle = E_{\\mathrm{ref}}$,\n- $\\langle D_X|H_X|D_X\\rangle = E_{\\mathrm{ref}} + \\Delta$,\n- $\\langle 0_X|H_X|D_X\\rangle = \\langle D_X|H_X|0_X\\rangle = V$,\n\nwith $\\Delta > 0$ and $V \\in \\mathbb{R}$. Assume there are no other important excited determinants on each monomer and that there is no intermonomer coupling between $A$ and $B$ in the noninteracting limit.\n\nWithin Configuration Interaction with Singles and Doubles (CISD) for the dimer $\\mathrm{He}_2$ relative to the product reference $|0_A\\rangle \\otimes |0_B\\rangle$, only excitations of rank up to $2$ with respect to the dimer reference are retained. Therefore, in the dimer CISD space, the states $|D_A\\rangle \\otimes |0_B\\rangle$ and $|0_A\\rangle \\otimes |D_B\\rangle$ are included, while $|D_A\\rangle \\otimes |D_B\\rangle$ is excluded because it is a disconnected excitation of total rank $4$.\n\nUsing only the fundamental facts that additive noninteracting Hamiltonians imply product eigenstates and additive eigenvalues for exact theories, and that truncated Configuration Interaction omits disconnected excitations of high rank, do the following:\n\n- Derive the CISD ground-state correlation energy for a single monomer in this two-determinant model.\n- Construct the dimer CISD Hamiltonian in the basis $\\{|0_A 0_B\\rangle, |D_A 0_B\\rangle, |0_A D_B\\rangle\\}$, derive its lowest eigenvalue, and from it obtain the dimer CISD correlation energy in the noninteracting limit.\n- Compute the size-consistency error $\\Delta E = E_{\\mathrm{CISD}}(\\mathrm{He}_2) - 2 E_{\\mathrm{CISD}}(\\mathrm{He})$ in closed form, expressed in terms of $\\Delta$ and $V$.\n\nExplain succinctly the physical origin of the nonzero $\\Delta E$ in terms of disconnected excitations and the failure of size extensivity in truncated Configuration Interaction. Express the final answer for $\\Delta E$ in atomic units as a single closed-form analytic expression in terms of $\\Delta$ and $V$ only. Do not approximate or expand; give the exact analytic expression. If you choose to also present a series expansion for interpretation, that should appear only in your reasoning and not in your final answer.", "solution": "The problem as stated is subjected to validation.\n\n**Step 1: Extract Givens**\n- System: Two non-interacting helium atoms, $A$ and $B$, at a large separation.\n- Total Hamiltonian: $H = H_A + H_B$.\n- Monomer (X $\\in$ {A,B}) restricted Hartree-Fock (RHF) reference: $|0_X\\rangle$.\n- Monomer RHF energy: $\\langle 0_X|H_X|0_X\\rangle = E_{\\mathrm{ref}}$.\n- Monomer model space: $\\{|0_X\\rangle, |D_X\\rangle\\}$, where $|D_X\\rangle$ is a single doubly excited determinant.\n- Monomer Hamiltonian matrix elements:\n  - $H_{00} = \\langle 0_X|H_X|0_X\\rangle = E_{\\mathrm{ref}}$\n  - $H_{DD} = \\langle D_X|H_X|D_X\\rangle = E_{\\mathrm{ref}} + \\Delta$\n  - $H_{0D} = \\langle 0_X|H_X|D_X\\rangle = V$\n- Conditions: $\\Delta > 0$, $V \\in \\mathbb{R}$.\n- Dimer theory: Configuration Interaction with Singles and Doubles (CISD).\n- Dimer reference state: $|0_A 0_B\\rangle$.\n- Dimer CISD space: spanned by $\\{|0_A 0_B\\rangle, |D_A 0_B\\rangle, |0_A D_B\\rangle\\}$.\n- Excluded state from CISD: $|D_A D_B\\rangle$, a rank-$4$ excitation.\n- Task: Derive monomer and dimer CISD energies, compute the size-consistency error $\\Delta E = E_{\\mathrm{CISD}}(\\mathrm{He}_2) - 2 E_{\\mathrm{CISD}}(\\mathrm{He})$, and explain its origin.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is assessed against the required criteria.\n- **Scientifically Grounded:** The problem uses a well-established pedagogical model in quantum chemistry to demonstrate the size-consistency failure of truncated Configuration Interaction (CI) methods. All concepts—CI, CISD, disconnected excitations, size consistency, and size extensivity—are fundamental to electronic structure theory. The model, while simplified, is scientifically valid for its illustrative purpose.\n- **Well-Posed:** The problem is clearly defined. It provides all necessary matrix elements, specifies the basis sets for both the monomer and dimer calculations, and poses a precise mathematical question that leads to a unique analytical solution.\n- **Objective:** The language is formal, precise, and devoid of subjectivity or ambiguity.\n\n**Step 3: Verdict and Action**\nThe problem is determined to be **valid**. It is a standard, well-posed problem in theoretical chemistry. A full solution will be provided.\n\n**Solution Derivation**\n\nFirst, we determine the ground-state energy for a single monomer, designated as $X$, within the provided two-state model. This corresponds to a CI calculation with doubles (CID) for the monomer. The Hamiltonian matrix, $\\mathbf{H}_X$, in the basis $\\{|0_X\\rangle, |D_X\\rangle\\}$ is:\n$$\n\\mathbf{H}_X = \\begin{pmatrix} E_{\\mathrm{ref}} & V \\\\ V & E_{\\mathrm{ref}} + \\Delta \\end{pmatrix}\n$$\nTo find the eigenvalues $E$, we solve the secular equation $\\det(\\mathbf{H}_X - E\\mathbf{I}) = 0$. Let $\\epsilon = E - E_{\\mathrm{ref}}$, which represents the energy relative to the reference energy. The equation becomes:\n$$\n\\begin{vmatrix} -\\epsilon & V \\\\ V & \\Delta - \\epsilon \\end{vmatrix} = (-\\epsilon)(\\Delta - \\epsilon) - V^2 = \\epsilon^2 - \\Delta\\epsilon - V^2 = 0\n$$\nSolving this quadratic equation for $\\epsilon$ yields:\n$$\n\\epsilon = \\frac{\\Delta \\pm \\sqrt{(-\\Delta)^2 - 4(1)(-V^2)}}{2} = \\frac{\\Delta \\pm \\sqrt{\\Delta^2 + 4V^2}}{2}\n$$\nThe ground state corresponds to the lower energy, which is obtained by taking the negative sign, as $\\sqrt{\\Delta^2 + 4V^2} > \\Delta$. The ground-state energy of the monomer is therefore:\n$$\nE_{\\mathrm{CISD}}(\\mathrm{He}) = E_{\\mathrm{ref}} + \\frac{\\Delta - \\sqrt{\\Delta^2 + 4V^2}}{2}\n$$\nThe monomer correlation energy is $E_{\\mathrm{corr}}(\\mathrm{He}) = E_{\\mathrm{CISD}}(\\mathrm{He}) - E_{\\mathrm{ref}} = \\frac{1}{2}(\\Delta - \\sqrt{\\Delta^2 + 4V^2})$.\n\nNext, we construct the dimer CISD Hamiltonian, $\\mathbf{H}_{\\mathrm{dimer}}$, in the specified basis $\\{|\\Phi_0\\rangle, |\\Phi_1\\rangle, |\\Phi_2\\rangle\\}$, where $|\\Phi_0\\rangle = |0_A 0_B\\rangle$, $|\\Phi_1\\rangle = |D_A 0_B\\rangle$, and $|\\Phi_2\\rangle = |0_A D_B\\rangle$. The total Hamiltonian is $H = H_A + H_B$. The matrix elements are calculated as follows, using the facts that the monomer Hamiltonians act only on their respective states and that the basis functions are orthonormal (e.g., $\\langle 0_A|D_A\\rangle = 0$).\n\nThe diagonal elements are:\n$$\n\\langle \\Phi_0 | H | \\Phi_0 \\rangle = \\langle 0_A 0_B | H_A + H_B | 0_A 0_B \\rangle = \\langle 0_A | H_A | 0_A \\rangle + \\langle 0_B | H_B | 0_B \\rangle = E_{\\mathrm{ref}} + E_{\\mathrm{ref}} = 2E_{\\mathrm{ref}}\n$$\n$$\n\\langle \\Phi_1 | H | \\Phi_1 \\rangle = \\langle D_A 0_B | H_A + H_B | D_A 0_B \\rangle = \\langle D_A | H_A | D_A \\rangle + \\langle 0_B | H_B | 0_B \\rangle = (E_{\\mathrm{ref}} + \\Delta) + E_{\\mathrm{ref}} = 2E_{\\mathrm{ref}} + \\Delta\n$$\n$$\n\\langle \\Phi_2 | H | \\Phi_2 \\rangle = \\langle 0_A D_B | H_A + H_B | 0_A D_B \\rangle = \\langle 0_A | H_A | 0_A \\rangle + \\langle D_B | H_B | D_B \\rangle = E_{\\mathrm{ref}} + (E_{\\mathrm{ref}} + \\Delta) = 2E_{\\mathrm{ref}} + \\Delta\n$$\nThe off-diagonal elements are:\n$$\n\\langle \\Phi_0 | H | \\Phi_1 \\rangle = \\langle 0_A 0_B | H_A + H_B | D_A 0_B \\rangle = \\langle 0_A | H_A | D_A \\rangle \\langle 0_B | 0_B \\rangle = V\n$$\n$$\n\\langle \\Phi_0 | H | \\Phi_2 \\rangle = \\langle 0_A 0_B | H_A + H_B | 0_A D_B \\rangle = \\langle 0_A | 0_A \\rangle \\langle 0_B | H_B | D_B \\rangle = V\n$$\n$$\n\\langle \\Phi_1 | H | \\Phi_2 \\rangle = \\langle D_A 0_B | H_A + H_B | 0_A D_B \\rangle = \\langle D_A | H_A | 0_A \\rangle \\langle 0_B | D_B \\rangle + \\langle D_A | 0_A \\rangle \\langle 0_B | H_B | D_B \\rangle = V \\cdot 0 + 0 \\cdot V = 0\n$$\nThe resulting dimer CISD matrix is:\n$$\n\\mathbf{H}_{\\mathrm{dimer}} = \\begin{pmatrix} 2E_{\\mathrm{ref}} & V & V \\\\ V & 2E_{\\mathrm{ref}} + \\Delta & 0 \\\\ V & 0 & 2E_{\\mathrm{ref}} + \\Delta \\end{pmatrix}\n$$\nWe find the eigenvalues $E$ by solving the secular equation. Let $\\epsilon' = E - 2E_{\\mathrm{ref}}$:\n$$\n\\begin{vmatrix} -\\epsilon' & V & V \\\\ V & \\Delta - \\epsilon' & 0 \\\\ V & 0 & \\Delta - \\epsilon' \\end{vmatrix} = 0\n$$\nExpanding the determinant gives:\n$$\n-\\epsilon'(\\Delta - \\epsilon')^2 - V(V(\\Delta - \\epsilon')) + V(-V(\\Delta - \\epsilon')) = 0\n$$\n$$\n-\\epsilon'(\\Delta - \\epsilon')^2 - 2V^2(\\Delta - \\epsilon') = 0\n$$\n$$\n-(\\Delta - \\epsilon')[\\epsilon'(\\Delta - \\epsilon') + 2V^2] = 0\n$$\nThis yields one root from the first factor, $\\Delta - \\epsilon' = 0 \\implies \\epsilon' = \\Delta$, and a quadratic equation from the second factor: $(\\epsilon')^2 - \\Delta\\epsilon' - 2V^2 = 0$. The roots of the quadratic are:\n$$\n\\epsilon' = \\frac{\\Delta \\pm \\sqrt{(-\\Delta)^2 - 4(1)(-2V^2)}}{2} = \\frac{\\Delta \\pm \\sqrt{\\Delta^2 + 8V^2}}{2}\n$$\nThe lowest energy corresponds to the negative sign. Thus, the dimer CISD ground-state energy is:\n$$\nE_{\\mathrm{CISD}}(\\mathrm{He}_2) = 2E_{\\mathrm{ref}} + \\frac{\\Delta - \\sqrt{\\Delta^2 + 8V^2}}{2}\n$$\nNow, we compute the size-consistency error, $\\Delta E$:\n$$\n\\Delta E = E_{\\mathrm{CISD}}(\\mathrm{He}_2) - 2 E_{\\mathrm{CISD}}(\\mathrm{He})\n$$\n$$\n\\Delta E = \\left( 2E_{\\mathrm{ref}} + \\frac{\\Delta - \\sqrt{\\Delta^2 + 8V^2}}{2} \\right) - 2 \\left( E_{\\mathrm{ref}} + \\frac{\\Delta - \\sqrt{\\Delta^2 + 4V^2}}{2} \\right)\n$$\n$$\n\\Delta E = 2E_{\\mathrm{ref}} + \\frac{\\Delta}{2} - \\frac{\\sqrt{\\Delta^2 + 8V^2}}{2} - 2E_{\\mathrm{ref}} - (\\Delta - \\sqrt{\\Delta^2 + 4V^2})\n$$\n$$\n\\Delta E = \\frac{\\Delta}{2} - \\Delta - \\frac{\\sqrt{\\Delta^2 + 8V^2}}{2} + \\sqrt{\\Delta^2 + 4V^2} = -\\frac{\\Delta}{2} - \\frac{\\sqrt{\\Delta^2 + 8V^2}}{2} + \\sqrt{\\Delta^2 + 4V^2}\n$$\nThis is the closed-form expression for the size-consistency error.\n\nThe physical origin of this non-zero error lies in the failure of truncated CI methods to be size-extensive. A method is size-extensive if its energy scales linearly with the number of non-interacting particles. For a size-extensive (and thus size-consistent) method, the energy of the non-interacting dimer must be exactly twice the monomer energy, yielding $\\Delta E = 0$.\nThe exact ground-state wavefunction of the monomer is $|\\Psi_X\\rangle = c_0 |0_X\\rangle + c_D |D_X\\rangle$, where the coefficients $c_0$ and $c_D$ are determined by diagonalizing the $2\\times 2$ monomer Hamiltonian. For two non-interacting systems, the exact ground-state wavefunction of the dimer is the product of the monomer wavefunctions:\n$$\n|\\Psi_{\\mathrm{dimer}}\\rangle = |\\Psi_A\\rangle \\otimes |\\Psi_B\\rangle = (c_0 |0_A\\rangle + c_D |D_A\\rangle) \\otimes (c_0 |0_B\\rangle + c_D |D_B\\rangle)\n$$\n$$\n|\\Psi_{\\mathrm{dimer}}\\rangle = c_0^2 |0_A 0_B\\rangle + c_0 c_D |D_A 0_B\\rangle + c_0 c_D |0_A D_B\\rangle + c_D^2 |D_A D_B\\rangle\n$$\nThis exact wavefunction includes the reference, single excitations on each monomer (which are rank-$2$ excitations for the dimer), and a term $|D_A D_B\\rangle$. This last term represents simultaneous double excitations on both monomers. From the perspective of the dimer reference state $|0_A 0_B\\rangle$, this is a quadruple excitation (a disconnected excitation of rank $4$).\nThe CISD method, by definition, truncates the CI expansion to include only single and double excitations relative to the reference. Therefore, its basis for the dimer, $\\{|0_A 0_B\\rangle, |D_A 0_B\\rangle, |0_A D_B\\rangle\\}$, explicitly excludes the crucial $|D_A D_B\\rangle$ term. By forcing the coefficient of this term to be zero, the CISD method variationally seeks the best possible wavefunction within a flawed, incomplete space. This constraint prevents the dimer wavefunction from factorizing into the product of the monomer wavefunctions, and the resulting energy $E_{\\mathrm{CISD}}(\\mathrm{He}_2)$ is artificially high, failing to be the sum of the monomer energies. This failure to include contributions from higher-rank disconnected excitations is the fundamental reason for the size-inconsistency of truncated CI methods.", "answer": "$$\n\\boxed{\\sqrt{\\Delta^2 + 4V^2} - \\frac{\\Delta}{2} - \\frac{\\sqrt{\\Delta^2 + 8V^2}}{2}}\n$$", "id": "2923657"}, {"introduction": "The failure of size extensivity has direct consequences for chemically relevant properties. A key example is size intensivity: a local property, such as an electronic excitation energy on one molecule, should be independent of any non-interacting neighbors. This exercise [@problem_id:2923627] investigates this issue by having you model the size-intensivity error for an excitation energy calculated with Multi-Reference CI (MRCI) and its Davidson-corrected counterpart, MRCI+Q. Through this computational task, you will assess the practical impact of the size-extensivity error and evaluate the effectiveness of the '+Q' correction in restoring this crucial property.", "problem": "Consider a non-interacting dimer composed of two fragments, labeled fragment $A$ and fragment $B$. The Hamiltonian is separable, so that the exact energy of the dimer in any product state is the sum of the corresponding exact fragment energies. Let a local electronic excitation occur on fragment $A$, while fragment $B$ remains in its ground state. The goal is to assess the size intensivity of the excitation energy in two truncated methods used in multi-reference treatments: Multi-Reference Configuration Interaction (MRCI) without a size-extensivity correction, and MRCI with a Davidson-type correction (often denoted \"+Q\").\n\nUse the following definitions, which are standard in quantum chemistry for truncated configuration interaction models and their corrections:\n\n- For a fragment $X \\in \\{A,B\\}$ and an electronic state $s \\in \\{\\mathrm{g},\\mathrm{e}\\}$ (ground or excited), the reference energy is $E_{\\mathrm{ref}}^{X}(s)$ in Hartree, the MRCI correlation energy (without size-extensivity correction) is $E_{\\mathrm{corr}}^{X}(s)$ in Hartree, and the squared norm of the reference-space component in the MRCI wave function is $w^{X}(s)$, with $0 < w^{X}(s) \\le 1$. The uncorrected MRCI energy for a fragment state is\n$$\nE_{\\mathrm{CI}}^{X}(s) \\equiv E_{\\mathrm{ref}}^{X}(s) + E_{\\mathrm{corr}}^{X}(s).\n$$\n\n- The Davidson \"+Q\" corrected energy employed here is the so-called \"$A$-variant\" (also used in multi-reference selected Configuration Interaction literature), defined for any state by\n$$\nE_{+Q}^{X}(s) \\equiv E_{\\mathrm{ref}}^{X}(s) + E_{\\mathrm{corr}}^{X}(s) + \\frac{1 - w^{X}(s)}{w^{X}(s)}\\,E_{\\mathrm{corr}}^{X}(s) \\;=\\; E_{\\mathrm{ref}}^{X}(s) + \\frac{E_{\\mathrm{corr}}^{X}(s)}{w^{X}(s)}.\n$$\nAll energies are in Hartree.\n\n- For the non-interacting dimer in a product state $s$ on fragment $A$ and ground state $\\mathrm{g}$ on fragment $B$, the total reference energy is additive,\n$$\nE_{\\mathrm{ref}}^{AB}(s) \\equiv E_{\\mathrm{ref}}^{A}(s) + E_{\\mathrm{ref}}^{B}(\\mathrm{g}).\n$$\n\n- Truncated MRCI is not size-extensive, so its correlation energy for the dimer is not strictly additive. In this problem, model the non-additivity by the following explicit, state-resolved, positive “missing-disconnected” term:\n$$\n\\delta_{\\mathrm{CI}}(s;\\kappa) \\equiv \\kappa\\,\\bigl|E_{\\mathrm{corr}}^{A}(s)\\bigr|\\,\\bigl|E_{\\mathrm{corr}}^{B}(\\mathrm{g})\\bigr|\\,\\Bigl( \\bigl(1 - w^{A}(s)\\bigr) + \\bigl(1 - w^{B}(\\mathrm{g})\\bigr) \\Bigr),\n$$\nwhere $\\kappa$ is a given non-negative dimensionless parameter. The uncorrected MRCI correlation energy for the dimer is then\n$$\nE_{\\mathrm{corr}}^{AB,\\mathrm{CI}}(s) \\equiv E_{\\mathrm{corr}}^{A}(s) + E_{\\mathrm{corr}}^{B}(\\mathrm{g}) + \\delta_{\\mathrm{CI}}(s;\\kappa),\n$$\nand the uncorrected MRCI total energy is\n$$\nE_{\\mathrm{CI}}^{AB}(s) \\equiv E_{\\mathrm{ref}}^{AB}(s) + E_{\\mathrm{corr}}^{AB,\\mathrm{CI}}(s).\n$$\n\n- For the dimer’s Davidson-corrected energy, assume the product structure of the reference space implies a composite reference weight\n$$\nw^{AB}(s) \\equiv w^{A}(s)\\,w^{B}(\\mathrm{g}),\n$$\nand use the same $A$-variant Davidson formula applied to the dimer’s uncorrected MRCI correlation energy,\n$$\nE_{+Q}^{AB}(s) \\equiv E_{\\mathrm{ref}}^{AB}(s) + E_{\\mathrm{corr}}^{AB,\\mathrm{CI}}(s) + \\frac{1 - w^{AB}(s)}{w^{AB}(s)}\\,E_{\\mathrm{corr}}^{AB,\\mathrm{CI}}(s) \\;=\\; E_{\\mathrm{ref}}^{AB}(s) + \\frac{E_{\\mathrm{corr}}^{AB,\\mathrm{CI}}(s)}{w^{AB}(s)}.\n$$\n\nDefine the excitation energy on fragment $A$ computed in isolation by method $\\mathcal{M}\\in\\{\\mathrm{CI},+Q\\}$ as\n$$\n\\Delta E_{A}^{\\mathcal{M}} \\equiv E_{\\mathcal{M}}^{A}(\\mathrm{e}) - E_{\\mathcal{M}}^{A}(\\mathrm{g}),\n$$\nand the corresponding excitation energy of the dimer (local excitation on $A$, ground on $B$) as\n$$\n\\Delta E_{AB}^{\\mathcal{M}} \\equiv E_{\\mathcal{M}}^{AB}(\\mathrm{e}) - E_{\\mathcal{M}}^{AB}(\\mathrm{g}).\n$$\nDefine the size-intensivity error for method $\\mathcal{M}$ as\n$$\n\\varepsilon^{\\mathcal{M}} \\equiv \\Delta E_{AB}^{\\mathcal{M}} - \\Delta E_{A}^{\\mathcal{M}}.\n$$\nA perfectly size-intensive method yields $\\varepsilon^{\\mathcal{M}} = 0$. In all computations, energies are in Hartree, and you must report energy differences in Hartree.\n\nYour task is to implement a program that, for each test case below, computes the pair of excitation energy errors $(\\varepsilon^{\\mathrm{CI}}, \\varepsilon^{+Q})$, and, for a fixed tolerance $\\tau$, also reports two Boolean indicators of whether each method is size-intensive within tolerance, i.e., whether $\\lvert \\varepsilon^{\\mathrm{CI}} \\rvert \\le \\tau$ and whether $\\lvert \\varepsilon^{+Q} \\rvert \\le \\tau$. Use $\\tau = 10^{-12}$.\n\nTest suite. Each test case is a tuple of parameters $(\\kappa, E_{\\mathrm{ref}}^{A}(\\mathrm{g}), E_{\\mathrm{corr}}^{A}(\\mathrm{g}), w^{A}(\\mathrm{g}), E_{\\mathrm{ref}}^{A}(\\mathrm{e}), E_{\\mathrm{corr}}^{A}(\\mathrm{e}), w^{A}(\\mathrm{e}), E_{\\mathrm{ref}}^{B}(\\mathrm{g}), E_{\\mathrm{corr}}^{B}(\\mathrm{g}), w^{B}(\\mathrm{g}))$, with all energies in Hartree:\n\n- Case $1$ (happy path, moderate correlation in both fragments):\n  - $\\kappa = 0.05$,\n  - $E_{\\mathrm{ref}}^{A}(\\mathrm{g}) = -100.0$, $E_{\\mathrm{corr}}^{A}(\\mathrm{g}) = -0.200$, $w^{A}(\\mathrm{g}) = 0.92$,\n  - $E_{\\mathrm{ref}}^{A}(\\mathrm{e}) = -99.5$, $E_{\\mathrm{corr}}^{A}(\\mathrm{e}) = -0.150$, $w^{A}(\\mathrm{e}) = 0.90$,\n  - $E_{\\mathrm{ref}}^{B}(\\mathrm{g}) = -50.0$, $E_{\\mathrm{corr}}^{B}(\\mathrm{g}) = -0.120$, $w^{B}(\\mathrm{g}) = 0.93$.\n\n- Case $2$ (boundary, uncorrelated fragment $B$):\n  - $\\kappa = 0.08$,\n  - $E_{\\mathrm{ref}}^{A}(\\mathrm{g}) = -100.0$, $E_{\\mathrm{corr}}^{A}(\\mathrm{g}) = -0.200$, $w^{A}(\\mathrm{g}) = 0.92$,\n  - $E_{\\mathrm{ref}}^{A}(\\mathrm{e}) = -99.5$, $E_{\\mathrm{corr}}^{A}(\\mathrm{e}) = -0.150$, $w^{A}(\\mathrm{e}) = 0.90$,\n  - $E_{\\mathrm{ref}}^{B}(\\mathrm{g}) = -50.0$, $E_{\\mathrm{corr}}^{B}(\\mathrm{g}) = 0.0$, $w^{B}(\\mathrm{g}) = 1.0$.\n\n- Case $3$ (large, more strongly correlated fragment $B$):\n  - $\\kappa = 0.07$,\n  - $E_{\\mathrm{ref}}^{A}(\\mathrm{g}) = -100.0$, $E_{\\mathrm{corr}}^{A}(\\mathrm{g}) = -0.200$, $w^{A}(\\mathrm{g}) = 0.92$,\n  - $E_{\\mathrm{ref}}^{A}(\\mathrm{e}) = -99.5$, $E_{\\mathrm{corr}}^{A}(\\mathrm{e}) = -0.150$, $w^{A}(\\mathrm{e}) = 0.90$,\n  - $E_{\\mathrm{ref}}^{B}(\\mathrm{g}) = -200.0$, $E_{\\mathrm{corr}}^{B}(\\mathrm{g}) = -0.600$, $w^{B}(\\mathrm{g}) = 0.80$.\n\n- Case $4$ (edge, stronger multi-reference character in the excited state of fragment $A$):\n  - $\\kappa = 0.10$,\n  - $E_{\\mathrm{ref}}^{A}(\\mathrm{g}) = -100.0$, $E_{\\mathrm{corr}}^{A}(\\mathrm{g}) = -0.220$, $w^{A}(\\mathrm{g}) = 0.90$,\n  - $E_{\\mathrm{ref}}^{A}(\\mathrm{e}) = -99.4$, $E_{\\mathrm{corr}}^{A}(\\mathrm{e}) = -0.300$, $w^{A}(\\mathrm{e}) = 0.75$,\n  - $E_{\\mathrm{ref}}^{B}(\\mathrm{g}) = -120.0$, $E_{\\mathrm{corr}}^{B}(\\mathrm{g}) = -0.300$, $w^{B}(\\mathrm{g}) = 0.85$.\n\nProgram output specification. Your program should process the four cases above in order and produce a single line of output containing a list of four entries, one per case. Each entry must be a list with four elements:\n- the float $\\varepsilon^{\\mathrm{CI}}$ in Hartree,\n- the float $\\varepsilon^{+Q}$ in Hartree,\n- the Boolean indicator for $\\lvert \\varepsilon^{\\mathrm{CI}} \\rvert \\le \\tau$,\n- the Boolean indicator for $\\lvert \\varepsilon^{+Q} \\rvert \\le \\tau$.\n\nThe final printed line must therefore have the form\n$[ [\\varepsilon^{\\mathrm{CI}}_1,\\varepsilon^{+Q}_1,b^{\\mathrm{CI}}_1,b^{+Q}_1], [\\varepsilon^{\\mathrm{CI}}_2,\\varepsilon^{+Q}_2,b^{\\mathrm{CI}}_2,b^{+Q}_2], [\\varepsilon^{\\mathrm{CI}}_3,\\varepsilon^{+Q}_3,b^{\\mathrm{CI}}_3,b^{+Q}_3], [\\varepsilon^{\\mathrm{CI}}_4,\\varepsilon^{+Q}_4,b^{\\mathrm{CI}}_4,b^{+Q}_4] ]$, where the subscript indicates the case index. All energy quantities must be interpreted in Hartree. Angles are not used in this problem. No percentages appear in the output; all real-valued quantities are plain floats.", "solution": "The problem requires the calculation of the size-intensivity error for an electronic excitation energy, computed with two different quantum chemical methods: multi-reference configuration interaction (MRCI) and its Davidson-corrected variant (MRCI+Q). The error is to be evaluated for a model of a non-interacting dimer $AB$, where an excitation occurs on fragment $A$ while fragment $B$ remains in its ground state.\n\nThe size-intensivity error for a given method $\\mathcal{M} \\in \\{\\mathrm{CI}, +Q\\}$ is defined as the difference between the excitation energy computed for the dimer system and the excitation energy computed for the isolated fragment $A$:\n$$\n\\varepsilon^{\\mathcal{M}} \\equiv \\Delta E_{AB}^{\\mathcal{M}} - \\Delta E_{A}^{\\mathcal{M}}\n$$\nwhere $\\Delta E_{A}^{\\mathcal{M}} = E_{\\mathcal{M}}^{A}(\\mathrm{e}) - E_{\\mathcal{M}}^{A}(\\mathrm{g})$ and $\\Delta E_{AB}^{\\mathcal{M}} = E_{\\mathcal{M}}^{AB}(\\mathrm{e}) - E_{\\mathcal{M}}^{AB}(\\mathrm{g})$. A perfectly size-intensive method would yield $\\varepsilon^{\\mathcal{M}} = 0$.\n\nA direct calculation involving subtraction of total energies can be prone to floating-point cancellation errors. A more robust and elegant approach is to first simplify the expressions for the errors algebraically.\n\nFirst, let us derive the expression for the uncorrected MRCI error, $\\varepsilon^{\\mathrm{CI}}$.\nThe total MRCI energy for the dimer is given by:\n$$\nE_{\\mathrm{CI}}^{AB}(s) = E_{\\mathrm{ref}}^{AB}(s) + E_{\\mathrm{corr}}^{AB,\\mathrm{CI}}(s) = \\left( E_{\\mathrm{ref}}^{A}(s) + E_{\\mathrm{ref}}^{B}(\\mathrm{g}) \\right) + \\left( E_{\\mathrm{corr}}^{A}(s) + E_{\\mathrm{corr}}^{B}(\\mathrm{g}) + \\delta_{\\mathrm{CI}}(s;\\kappa) \\right)\n$$\nThe excitation energy in the dimer is therefore:\n$$\n\\Delta E_{AB}^{\\mathrm{CI}} = E_{\\mathrm{CI}}^{AB}(\\mathrm{e}) - E_{\\mathrm{CI}}^{AB}(\\mathrm{g})\n$$\n$$\n= \\left[ E_{\\mathrm{ref}}^{A}(\\mathrm{e}) - E_{\\mathrm{ref}}^{A}(\\mathrm{g}) \\right] + \\left[ E_{\\mathrm{corr}}^{A}(\\mathrm{e}) - E_{\\mathrm{corr}}^{A}(\\mathrm{g}) \\right] + \\left[ \\delta_{\\mathrm{CI}}(\\mathrm{e};\\kappa) - \\delta_{\\mathrm{CI}}(\\mathrm{g};\\kappa) \\right]\n$$\nThe excitation energy for the isolated fragment $A$ is:\n$$\n\\Delta E_{A}^{\\mathrm{CI}} = E_{\\mathrm{CI}}^{A}(\\mathrm{e}) - E_{\\mathrm{CI}}^{A}(\\mathrm{g}) = \\left[ E_{\\mathrm{ref}}^{A}(\\mathrm{e}) + E_{\\mathrm{corr}}^{A}(\\mathrm{e}) \\right] - \\left[ E_{\\mathrm{ref}}^{A}(\\mathrm{g}) + E_{\\mathrm{corr}}^{A}(\\mathrm{g}) \\right]\n$$\n$$\n= \\left[ E_{\\mathrm{ref}}^{A}(\\mathrm{e}) - E_{\\mathrm{ref}}^{A}(\\mathrm{g}) \\right] + \\left[ E_{\\mathrm{corr}}^{A}(\\mathrm{e}) - E_{\\mathrm{corr}}^{A}(\\mathrm{g}) \\right]\n$$\nSubtracting $\\Delta E_{A}^{\\mathrm{CI}}$ from $\\Delta E_{AB}^{\\mathrm{CI}}$ yields a remarkably simple expression for the error:\n$$\n\\varepsilon^{\\mathrm{CI}} = \\Delta E_{AB}^{\\mathrm{CI}} - \\Delta E_{A}^{\\mathrm{CI}} = \\delta_{\\mathrm{CI}}(\\mathrm{e};\\kappa) - \\delta_{\\mathrm{CI}}(\\mathrm{g};\\kappa)\n$$\nwhere $\\delta_{\\mathrm{CI}}(s;\\kappa) = \\kappa\\,\\bigl|E_{\\mathrm{corr}}^{A}(s)\\bigr|\\,\\bigl|E_{\\mathrm{corr}}^{B}(\\mathrm{g})\\bigr|\\,\\Bigl( (1 - w^{A}(s)) + (1 - w^{B}(\\mathrm{g})) \\Bigr)$.\n\nNext, we derive the expression for the Davidson-corrected error, $\\varepsilon^{+Q}$. It is useful to introduce the concept of the size-extensivity error for a state $s$, defined as the deviation from additivity for the total energy of the dimer:\n$$\n\\Delta E_{\\mathrm{sext}}^{\\mathcal{M}}(s) \\equiv E_{\\mathcal{M}}^{AB}(s) - \\left( E_{\\mathcal{M}}^{A}(s) + E_{\\mathcal{M}}^{B}(\\mathrm{g}) \\right)\n$$\nThe size-intensivity error can be expressed as the difference in size-extensivity errors between the excited and ground states:\n$$\n\\varepsilon^{\\mathcal{M}} = \\Delta E_{AB}^{\\mathcal{M}} - \\Delta E_{A}^{\\mathcal{M}} = \\left( E_{\\mathcal{M}}^{AB}(\\mathrm{e}) - E_{\\mathcal{M}}^{AB}(\\mathrm{g}) \\right) - \\left( E_{\\mathcal{M}}^{A}(\\mathrm{e}) - E_{\\mathcal{M}}^{A}(\\mathrm{g}) \\right)\n$$\n$$\n= \\left( E_{\\mathcal{M}}^{AB}(\\mathrm{e}) - E_{\\mathcal{M}}^{A}(\\mathrm{e}) - E_{\\mathcal{M}}^{B}(\\mathrm{g}) \\right) - \\left( E_{\\mathcal{M}}^{AB}(\\mathrm{g}) - E_{\\mathcal{M}}^{A}(\\mathrm{g}) - E_{\\mathcal{M}}^{B}(\\mathrm{g}) \\right) = \\Delta E_{\\mathrm{sext}}^{\\mathcal{M}}(\\mathrm{e}) - \\Delta E_{\\mathrm{sext}}^{\\mathcal{M}}(\\mathrm{g})\n$$\nWe now find the expression for $\\Delta E_{\\mathrm{sext}}^{+Q}(s)$:\n$$\n\\Delta E_{\\mathrm{sext}}^{+Q}(s) = E_{+Q}^{AB}(s) - \\left( E_{+Q}^{A}(s) + E_{+Q}^{B}(\\mathrm{g}) \\right)\n$$\n$$\n= \\left( E_{\\mathrm{ref}}^{AB}(s) + \\frac{E_{\\mathrm{corr}}^{AB,\\mathrm{CI}}(s)}{w^{AB}(s)} \\right) - \\left( E_{\\mathrm{ref}}^{A}(s) + \\frac{E_{\\mathrm{corr}}^{A}(s)}{w^{A}(s)} + E_{\\mathrm{ref}}^{B}(\\mathrm{g}) + \\frac{E_{\\mathrm{corr}}^{B}(\\mathrm{g})}{w^{B}(\\mathrm{g})} \\right)\n$$\nSince $E_{\\mathrm{ref}}^{AB}(s) = E_{\\mathrm{ref}}^{A}(s) + E_{\\mathrm{ref}}^{B}(\\mathrm{g})$, the reference energies cancel out. Substituting the definitions for $E_{\\mathrm{corr}}^{AB,\\mathrm{CI}}(s)$ and $w^{AB}(s)$:\n$$\n\\Delta E_{\\mathrm{sext}}^{+Q}(s) = \\frac{E_{\\mathrm{corr}}^{A}(s) + E_{\\mathrm{corr}}^{B}(\\mathrm{g}) + \\delta_{\\mathrm{CI}}(s;\\kappa)}{w^{A}(s) w^{B}(\\mathrm{g})} - \\frac{E_{\\mathrm{corr}}^{A}(s)}{w^{A}(s)} - \\frac{E_{\\mathrm{corr}}^{B}(\\mathrm{g})}{w^{B}(\\mathrm{g})}\n$$\nBringing to a common denominator $w^{A}(s)w^{B}(\\mathrm{g})$:\n$$\n\\Delta E_{\\mathrm{sext}}^{+Q}(s) = \\frac{1}{w^{A}(s)w^{B}(\\mathrm{g})} \\left[ (E_{\\mathrm{corr}}^{A}(s) + E_{\\mathrm{corr}}^{B}(\\mathrm{g}) + \\delta_{\\mathrm{CI}}(s;\\kappa)) - w^{B}(\\mathrm{g})E_{\\mathrm{corr}}^{A}(s) - w^{A}(s)E_{\\mathrm{corr}}^{B}(\\mathrm{g}) \\right]\n$$\n$$\n= \\frac{(1 - w^{B}(\\mathrm{g}))E_{\\mathrm{corr}}^{A}(s) + (1 - w^{A}(s))E_{\\mathrm{corr}}^{B}(\\mathrm{g}) + \\delta_{\\mathrm{CI}}(s;\\kappa)}{w^{A}(s) w^{B}(\\mathrm{g})}\n$$\nThe size-intensivity error $\\varepsilon^{+Q}$ is then computed as $\\Delta E_{\\mathrm{sext}}^{+Q}(\\mathrm{e}) - \\Delta E_{\\mathrm{sext}}^{+Q}(\\mathrm{g})$.\n\nThe algorithm implemented in the provided program proceeds as follows for each test case:\n1.  Read the input parameters: $\\kappa$, and the reference energies, correlation energies, and reference weights for the ground and excited states of fragment $A$ and the ground state of fragment $B$.\n2.  Calculate the non-additivity terms $\\delta_{\\mathrm{CI}}(\\mathrm{g};\\kappa)$ and $\\delta_{\\mathrm{CI}}(\\mathrm{e};\\kappa)$ using the provided formula.\n3.  Calculate the MRCI size-intensivity error using the simplified expression: $\\varepsilon^{\\mathrm{CI}} = \\delta_{\\mathrm{CI}}(\\mathrm{e};\\kappa) - \\delta_{\\mathrm{CI}}(\\mathrm{g};\\kappa)$.\n4.  Calculate the size-extensivity errors for the $+Q$ method for the ground state, $\\Delta E_{\\mathrm{sext}}^{+Q}(\\mathrm{g})$, and the excited state, $\\Delta E_{\\mathrm{sext}}^{+Q}(\\mathrm{e})$, using the derived analytical formula.\n5.  Calculate the MRCI+Q size-intensivity error by subtracting these two quantities: $\\varepsilon^{+Q} = \\Delta E_{\\mathrm{sext}}^{+Q}(\\mathrm{e}) - \\Delta E_{\\mathrm{sext}}^{+Q}(\\mathrm{g})$.\n6.  For both $\\varepsilon^{\\mathrm{CI}}$ and $\\varepsilon^{+Q}$, compare their absolute values to the tolerance $\\tau = 10^{-12}$ to determine the Boolean indicators of size intensivity.\n7.  Collect the four resulting values ($\\varepsilon^{\\mathrm{CI}}$, $\\varepsilon^{+Q}$, and the two Booleans) into a list for the current test case.\nThis procedure is repeated for all test cases, and the final results are formatted into a single list of lists. This approach is not only computationally efficient but also numerically superior to the direct subtraction of large energy values.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the size-intensivity problem for MRCI and MRCI+Q methods.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each tuple contains:\n    # (kappa, E_ref_A(g), E_corr_A(g), w_A(g), E_ref_A(e), E_corr_A(e), w_A(e),\n    #  E_ref_B(g), E_corr_B(g), w_B(g))\n    test_cases = [\n        # Case 1\n        (0.05, -100.0, -0.200, 0.92, -99.5, -0.150, 0.90, -50.0, -0.120, 0.93),\n        # Case 2\n        (0.08, -100.0, -0.200, 0.92, -99.5, -0.150, 0.90, -50.0, 0.0, 1.0),\n        # Case 3\n        (0.07, -100.0, -0.200, 0.92, -99.5, -0.150, 0.90, -200.0, -0.600, 0.80),\n        # Case 4\n        (0.10, -100.0, -0.220, 0.90, -99.4, -0.300, 0.75, -120.0, -0.300, 0.85),\n    ]\n\n    tau = 1e-12\n    all_results = []\n\n    for case in test_cases:\n        # Unpack parameters for clarity\n        (kappa, e_ref_A_g, e_corr_A_g, w_A_g, \n         e_ref_A_e, e_corr_A_e, w_A_e, \n         e_ref_B_g, e_corr_B_g, w_B_g) = case\n\n        # Define a helper function to compute delta_CI(s; kappa)\n        def calculate_delta_ci(e_corr_A_s, w_A_s):\n            if e_corr_B_g == 0.0:\n                return 0.0\n            return (kappa * abs(e_corr_A_s) * abs(e_corr_B_g) *\n                    ((1 - w_A_s) + (1 - w_B_g)))\n\n        # Calculate delta_CI for ground (g) and excited (e) states\n        delta_CI_g = calculate_delta_ci(e_corr_A_g, w_A_g)\n        delta_CI_e = calculate_delta_ci(e_corr_A_e, w_A_e)\n\n        # 1. Calculate the size-intensivity error for MRCI (epsilon^CI)\n        # epsilon^CI = delta_CI(e;kappa) - delta_CI(g;kappa)\n        err_ci = delta_CI_e - delta_CI_g\n\n        # 2. Calculate the size-intensivity error for MRCI+Q (epsilon^+Q)\n        # We use the formula epsilon^+Q = Delta_sext^+Q(e) - Delta_sext^+Q(g)\n        \n        # Helper function for the size-extensivity error Delta_sext^+Q(s)\n        def calculate_sext_error_q(e_corr_A_s, w_A_s, delta_CI_s):\n            # Handle potential division by zero, though problem constraints say w > 0\n            # For w_B_g = 1 (uncorrelated B), the numerator is simplified.\n            # Numerator: (1-w_B_g)*E_corr_A(s) + (1-w_A_s)*E_corr_B(g) + delta_CI(s)\n            # Denominator: w_A(s) * w_B(g)\n            \n            numerator = ((1 - w_B_g) * e_corr_A_s + \n                         (1 - w_A_s) * e_corr_B_g + \n                         delta_CI_s)\n            \n            denominator = w_A_s * w_B_g\n            \n            # Avoid division by zero, though not expected from problem statement (w>0)\n            if denominator == 0: return float('inf') \n            \n            return numerator / denominator\n\n        sext_err_q_g = calculate_sext_error_q(e_corr_A_g, w_A_g, delta_CI_g)\n        sext_err_q_e = calculate_sext_error_q(e_corr_A_e, w_A_e, delta_CI_e)\n        \n        err_pq = sext_err_q_e - sext_err_q_g\n        \n        # 3. Perform tolerance checks\n        is_intensive_ci = abs(err_ci) = tau\n        is_intensive_pq = abs(err_pq) = tau\n        \n        # 4. Store the results for this case\n        case_results = [err_ci, err_pq, is_intensive_ci, is_intensive_pq]\n        all_results.append(case_results)\n\n    # Final print statement in the exact required format.\n    # The string representation of Python lists and booleans matches the required format.\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```", "id": "2923627"}]}