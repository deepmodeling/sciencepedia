{"hands_on_practices": [{"introduction": "The gradient of the potential energy surface (PES) is the negative of the forces acting on the nuclei and is the fundamental quantity guiding all gradient-based geometry optimization algorithms. This exercise provides hands-on practice in computing this essential vector using the finite difference method, a powerful numerical technique for when analytical gradients are unavailable. By applying Richardson extrapolation, you will also learn how to systematically improve the accuracy of your numerical estimate, a crucial skill for robust computational work [@problem_id:2894227].", "problem": "In the Bornâ€“Oppenheimer (BO) approximation, the adiabatic electronic energy $E(q)$ of a molecule is an analytic function of a one-dimensional internal coordinate $q$ near a reference geometry $q=0$. Consider displacements $q=\\pm h$, $q=\\pm h/2$, and $q=\\pm h/4$ along a single mass-unweighted normal coordinate (in bohr). You performed high-accuracy electronic energy calculations at these displaced geometries and obtained the following total energies (in Hartree):\n- $E(+h) = -99.99982079201315556$, $E(-h) = -99.99985919198648889$ with $h = 0.02$ bohr,\n- $E\\!\\left(+\\frac{h}{2}\\right) = -99.99995009999950041$, $E\\!\\left(-\\frac{h}{2}\\right) = -99.99996989999949958$,\n- $E\\!\\left(+\\frac{h}{4}\\right) = -99.99998501249996876$, $E\\!\\left(-\\frac{h}{4}\\right) = -99.99999498749996874$.\n\nStarting only from the Taylor expansion of $E(q)$ about $q=0$ and the definition of a derivative, do the following:\n- Derive the central finite-difference estimator for the gradient $G(h)$ at $q=0$ using step size $h$, and its leading-order truncation error scaling in $h$.\n- Compute $G(h)$, $G(h/2)$, and $G(h/4)$ from the given energies.\n- Apply Richardson extrapolation to form two improved gradient estimates,\n  $$G_{1}=\\frac{4\\,G(h/2)-G(h)}{3}, \\qquad G_{2}=\\frac{4\\,G(h/4)-G(h/2)}{3},$$\n  and, assuming the error series of $G(h)$ is dominated by even powers of $h$, estimate the remaining truncation error in $G_{2}$ using $|G_{2}-G_{1}|/15$.\n- Report only the Richardson-extrapolated gradient $G_{2}$, rounded to ten significant figures. Express the gradient in Hartree per bohr.", "solution": "The central task is to determine the gradient of the electronic energy, $G(0) = E'(0)$, at the reference geometry $q=0$. The method will be based on a finite-difference approximation derived from the Taylor series expansion of the energy function $E(q)$.\n\nFirst, we establish the central finite-difference formula for the first derivative. The function $E(q)$ is stated to be analytic near $q=0$. We can therefore write its Taylor series expansion around this point:\n$$ E(q) = E(0) + E'(0)q + \\frac{1}{2!}E''(0)q^2 + \\frac{1}{3!}E'''(0)q^3 + \\frac{1}{4!}E''''(0)q^4 + \\frac{1}{5!}E^{(5)}(0)q^5 + O(q^6) $$\nLet us evaluate this expansion at the points $q=+h$ and $q=-h$:\n$$ E(+h) = E(0) + E'(0)h + \\frac{1}{2}E''(0)h^2 + \\frac{1}{6}E'''(0)h^3 + \\frac{1}{24}E''''(0)h^4 + \\frac{1}{120}E^{(5)}(0)h^5 + O(h^6) $$\n$$ E(-h) = E(0) - E'(0)h + \\frac{1}{2}E''(0)h^2 - \\frac{1}{6}E'''(0)h^3 + \\frac{1}{24}E''''(0)h^4 - \\frac{1}{120}E^{(5)}(0)h^5 + O(h^6) $$\nSubtracting the second expression from the first yields:\n$$ E(+h) - E(-h) = 2E'(0)h + \\frac{2}{6}E'''(0)h^3 + \\frac{2}{120}E^{(5)}(0)h^5 + O(h^7) $$\nSolving for the gradient $E'(0)$, we find:\n$$ E'(0) = \\frac{E(+h) - E(-h)}{2h} - \\frac{1}{6}E'''(0)h^2 - \\frac{1}{60}E^{(5)}(0)h^4 - O(h^6) $$\nThe central finite-difference estimator for the gradient, which we denote $G(h)$, is the first term on the right-hand side:\n$$ G(h) = \\frac{E(+h) - E(-h)}{2h} $$\nThe true gradient $G_{true} = E'(0)$ can be expressed in terms of the estimator $G(h)$ and its truncation error:\n$$ G_{true} = G(h) - \\frac{1}{6}E'''(0)h^2 - \\frac{1}{60}E^{(5)}(0)h^4 - \\dots $$\nThis shows that the truncation error of the estimator $G(h)$ can be written as a series in even powers of $h$:\n$$ G(h) = G_{true} + c_2 h^2 + c_4 h^4 + c_6 h^6 + \\dots $$\nwhere $c_2 = \\frac{1}{6}E'''(0)$, $c_4 = \\frac{1}{60}E^{(5)}(0)$, and so on. The leading-order truncation error is $c_2 h^2$, which scales as $O(h^2)$.\n\nNext, we compute the numerical values of the gradient estimators $G(h)$, $G(h/2)$, and $G(h/4)$ using the provided energy values and the step size $h = 0.02$ bohr. The units of the gradient will be Hartree/bohr.\n\nFor $s = h = 0.02$:\n$$ G(h) = \\frac{E(+h) - E(-h)}{2h} = \\frac{-99.99982079201315556 - (-99.99985919198648889)}{2 \\times 0.02} $$\n$$ G(h) = \\frac{0.00003839997333333333}{0.04} = 0.00095999933333333325 $$\n\nFor $s = h/2 = 0.01$:\n$$ G(h/2) = \\frac{E(+h/2) - E(-h/2)}{2(h/2)} = \\frac{-99.99995009999950041 - (-99.99996989999949958)}{0.02} $$\n$$ G(h/2) = \\frac{0.00001979999999917}{0.02} = 0.0009899999999585 $$\n\nFor $s = h/4 = 0.005$:\n$$ G(h/4) = \\frac{E(+h/4) - E(-h/4)}{2(h/4)} = \\frac{-99.99998501249996876 - (-99.99999498749996874)}{0.01} $$\n$$ G(h/4) = \\frac{0.00000997499999998}{0.01} = 0.000997499999998 $$\n\nNow, we apply Richardson extrapolation to improve these estimates. The error series is $G(s) = G_{true} + c_2 s^2 + c_4 s^4 + O(s^6)$. Let us consider two step sizes, $h$ and $h/2$:\n$$ G(h) = G_{true} + c_2 h^2 + c_4 h^4 + O(h^6) $$\n$$ G(h/2) = G_{true} + c_2 (h/2)^2 + c_4 (h/2)^4 + O(h^6) = G_{true} + \\frac{1}{4}c_2 h^2 + \\frac{1}{16}c_4 h^4 + O(h^6) $$\nTo eliminate the $O(h^2)$ term, we construct a linear combination. Multiplying the second equation by $4$ and subtracting the first gives:\n$$ 4G(h/2) - G(h) = 3G_{true} - \\frac{3}{4}c_4 h^4 + O(h^6) $$\nThe first extrapolated estimate, $G_1$, is then:\n$$ G_1 = \\frac{4G(h/2) - G(h)}{3} = G_{true} - \\frac{1}{4}c_4 h^4 + O(h^6) $$\nThis estimate has a leading error of order $O(h^4)$. Using our calculated values:\n$$ G_1 = \\frac{4(0.0009899999999585) - 0.00095999933333325}{3} $$\n$$ G_1 = \\frac{0.003959999999834 - 0.00095999933333325}{3} = \\frac{0.00300000066650075}{3} \\approx 0.0010000002221669 $$\n\nThe second extrapolated estimate, $G_2$, is formed in the same manner using step sizes $h/2$ and $h/4$:\n$$ G_2 = \\frac{4G(h/4) - G(h/2)}{3} $$\nThis cancels the $O((h/2)^2)$ error term, resulting in an estimate with a leading error of order $O((h/2)^4) = O(h^4/16)$.\n$$ G_2 = \\frac{4(0.000997499999998) - 0.0009899999999585}{3} $$\n$$ G_2 = \\frac{0.003989999999992 - 0.0009899999999585}{3} = \\frac{0.0030000000000335}{3} \\approx 0.0010000000000112 $$\n\nThe problem asks to estimate the remaining truncation error in $G_2$. Let $A(h)$ be the extrapolated value, so $G_1 = A(h)$ and $G_2 = A(h/2)$. We have shown that $A(s) = G_{true} + K_4 s^4 + O(s^6)$ for some constant $K_4 = -c_4/4$.\n$$ G_1 = G_{true} + K_4 h^4 + O(h^6) $$\n$$ G_2 = G_{true} + K_4 (h/2)^4 + O(h^6) = G_{true} + \\frac{1}{16}K_4 h^4 + O(h^6) $$\nSubtracting these two equations, we get $G_1 - G_2 \\approx \\frac{15}{16}K_4 h^4$.\nThe error in $G_2$ is $Err(G_2) = G_2 - G_{true} \\approx \\frac{1}{16}K_4 h^4$.\nFrom these, we can see that $Err(G_2) \\approx \\frac{1}{15}(G_1 - G_2)$. The magnitude of the error is therefore estimated as $|G_2 - G_1|/15$, confirming the formula provided in the problem statement. This provides a method to assess the accuracy of the extrapolation.\n\nThe final task is to report the Richardson-extrapolated gradient $G_2$, rounded to ten significant figures.\nThe calculated value is $G_2 \\approx 0.0010000000000112$. In scientific notation, this is $1.0000000000112 \\times 10^{-3}$.\nThe first ten significant figures are $1$, followed by nine $0$s. The eleventh significant figure is $0$, so when rounding, the tenth significant digit (a $0$) remains unchanged.\nThe final result is $1.000000000 \\times 10^{-3}$ Hartree/bohr.", "answer": "$$\n\\boxed{1.000000000 \\times 10^{-3}}\n$$", "id": "2894227"}, {"introduction": "While optimizations can be run in Cartesian coordinates, it is often far more efficient to use internal coordinates like bond lengths and angles, which more naturally describe molecular structure. This practice delves into the construction of the Wilson $B$-matrix, the mathematical tool that connects these two coordinate systems. You will derive its components from first principles and then explicitly compute it for a linear molecule, a scenario that requires special coordinate definitions to avoid singularities and ensure a stable optimization [@problem_id:2894221].", "problem": "Consider a triatomic molecule with atoms labeled $\\mathrm{A}$, $\\mathrm{B}$, and $\\mathrm{C}$ and Cartesian coordinates collected as $\\mathbf{x} = (x_{\\mathrm{A}}, y_{\\mathrm{A}}, z_{\\mathrm{A}}, x_{\\mathrm{B}}, y_{\\mathrm{B}}, z_{\\mathrm{B}}, x_{\\mathrm{C}}, y_{\\mathrm{C}}, z_{\\mathrm{C}})^{\\top}$. In internal coordinates, a common nonredundant choice for a nonlinear triatomic is the set $q = (r_{1}, r_{2}, \\theta)^{\\top}$, where $r_{1} = |\\mathbf{R}_{\\mathrm{B}} - \\mathbf{R}_{\\mathrm{A}}|$, $r_{2} = |\\mathbf{R}_{\\mathrm{C}} - \\mathbf{R}_{\\mathrm{B}}|$, and $\\theta$ is the bond angle $\\angle \\mathrm{ABC}$. Wilson's $B$-matrix is defined by $d\\mathbf{q} = B\\, d\\mathbf{x}$, with elements $B_{ij} = \\partial q_{i}/\\partial x_{j}$. \n\n1. Starting from the definitions $r_{ij} = |\\mathbf{R}_{j} - \\mathbf{R}_{i}|$ and $\\cos\\theta = \\hat{\\mathbf{u}} \\cdot \\hat{\\mathbf{v}}$ with $\\hat{\\mathbf{u}} = (\\mathbf{R}_{\\mathrm{A}} - \\mathbf{R}_{\\mathrm{B}})/r_{1}$ and $\\hat{\\mathbf{v}} = (\\mathbf{R}_{\\mathrm{C}} - \\mathbf{R}_{\\mathrm{B}})/r_{2}$, describe how to construct the Wilson $B$-matrix for $(r_{1}, r_{2}, \\theta)$ by computing gradients of internal coordinates with respect to Cartesian coordinates. Your outline should identify which geometric quantities are differentiated and the invariances that must be respected, without quoting any prepackaged final formulas.\n\n2. Now consider the special case of a linear equilibrium geometry along the $z$-axis with $\\mathbf{R}_{\\mathrm{B}} = (0,0,0)$, $\\mathbf{R}_{\\mathrm{A}} = (0,0,-r_{1})$, and $\\mathbf{R}_{\\mathrm{C}} = (0,0,+r_{2})$. In this case, the bond-angle coordinate $\\theta$ is singular. Replace $\\theta$ by two orthogonal small-angle bending coordinates about the $x$- and $y$-axes defined by\n$$\nq_{x} = \\frac{x_{\\mathrm{A}} - x_{\\mathrm{B}}}{r_{1}} + \\frac{x_{\\mathrm{C}} - x_{\\mathrm{B}}}{r_{2}}, \n\\qquad\nq_{y} = \\frac{y_{\\mathrm{A}} - y_{\\mathrm{B}}}{r_{1}} + \\frac{y_{\\mathrm{C}} - y_{\\mathrm{B}}}{r_{2}}.\n$$\nUsing these four internal coordinates $q = (r_{1}, r_{2}, q_{x}, q_{y})^{\\top}$, compute the Wilson $B$-matrix explicitly at the stated linear geometry. Order the Cartesian variables as $(x_{\\mathrm{A}}, y_{\\mathrm{A}}, z_{\\mathrm{A}}, x_{\\mathrm{B}}, y_{\\mathrm{B}}, z_{\\mathrm{B}}, x_{\\mathrm{C}}, y_{\\mathrm{C}}, z_{\\mathrm{C}})$ and express your final $B$ in terms of $r_{1}$ and $r_{2}$ only. Your final answer must be the single matrix expression for $B$ as a symbolic analytic expression. Do not include units.", "solution": "Part 1: Construction of the Wilson $B$-matrix for a nonlinear triatomic molecule\n\nThe Wilson $B$-matrix relates infinitesimal changes in internal coordinates $d\\mathbf{q}$ to infinitesimal changes in Cartesian coordinates $d\\mathbf{x}$ via the linear transformation $d\\mathbf{q} = B \\, d\\mathbf{x}$. The elements of the $B$-matrix are therefore the partial derivatives $B_{ij} = \\frac{\\partial q_i}{\\partial x_j}$. We construct the rows of this matrix by computing the gradient of each internal coordinate with respect to the atomic Cartesian coordinates. The molecule consists of atoms $\\mathrm{A}$, $\\mathrm{B}$, and $\\mathrm{C}$ with position vectors $\\mathbf{R}_{\\mathrm{A}}$, $\\mathbf{R}_{\\mathrm{B}}$, and $\\mathbf{R}_{\\mathrm{C}}$. The internal coordinates are $q = (r_{1}, r_{2}, \\theta)^{\\top}$, where $r_{1} = |\\mathbf{R}_{\\mathrm{B}} - \\mathbf{R}_{\\mathrm{A}}|$, $r_{2} = |\\mathbf{R}_{\\mathrm{C}} - \\mathbf{R}_{\\mathrm{B}}|$, and $\\theta = \\angle\\mathrm{ABC}$.\n\n1. Derivatives for Bond Stretches ($r_{1}$ and $r_{2}$):\nConsider the bond length $r_{1}$. It is a function of the coordinates of atoms $\\mathrm{A}$ and $\\mathrm{B}$. To find its derivatives, we begin with its squared definition to avoid dealing with the square root directly:\n$$r_{1}^{2} = (\\mathbf{R}_{\\mathrm{B}} - \\mathbf{R}_{\\mathrm{A}}) \\cdot (\\mathbf{R}_{\\mathrm{B}} - \\mathbf{R}_{\\mathrm{A}}) = \\sum_{\\alpha=x,y,z} (R_{\\mathrm{B}\\alpha} - R_{\\mathrm{A}\\alpha})^2$$\nDifferentiating both sides with respect to a Cartesian coordinate of atom $\\mathrm{A}$, for instance $x_{\\mathrm{A}}$, gives:\n$$2r_{1} \\frac{\\partial r_{1}}{\\partial x_{\\mathrm{A}}} = \\frac{\\partial}{\\partial x_{\\mathrm{A}}} (x_{\\mathrm{B}} - x_{\\mathrm{A}})^2 = 2(x_{\\mathrm{B}} - x_{\\mathrm{A}})(-1)$$\n$$\\implies \\frac{\\partial r_{1}}{\\partial x_{\\mathrm{A}}} = \\frac{x_{\\mathrm{A}} - x_{\\mathrm{B}}}{r_{1}}$$\nThis result can be generalized by collecting the derivatives with respect to $x_{\\mathrm{A}}$, $y_{\\mathrm{A}}$, and $z_{\\mathrm{A}}$ into a gradient vector, $\\nabla_{\\mathrm{A}}$:\n$$\\nabla_{\\mathrm{A}} r_{1} = \\frac{\\mathbf{R}_{\\mathrm{A}} - \\mathbf{R}_{\\mathrm{B}}}{r_{1}} = \\hat{\\mathbf{u}}$$\nwhere $\\hat{\\mathbf{u}} = (\\mathbf{R}_{\\mathrm{A}} - \\mathbf{R}_{\\mathrm{B}})/r_{1}$ is the unit vector from $\\mathrm{B}$ to $\\mathrm{A}$, as defined in the problem. Similarly, differentiation with respect to the coordinates of atom $\\mathrm{B}$ yields:\n$$\\nabla_{\\mathrm{B}} r_{1} = \\frac{\\mathbf{R}_{\\mathrm{B}} - \\mathbf{R}_{\\mathrm{A}}}{r_{1}} = -\\hat{\\mathbf{u}}$$\nThe coordinates of atom $\\mathrm{C}$ do not appear in the definition of $r_{1}$, so its gradient with respect to $\\mathbf{R}_{\\mathrm{C}}$ is the zero vector:\n$$\\nabla_{\\mathrm{C}} r_{1} = \\mathbf{0}$$\nThe procedure for $r_{2} = |\\mathbf{R}_{\\mathrm{C}} - \\mathbf{R}_{\\mathrm{B}}|$ is analogous, yielding $\\nabla_{\\mathrm{B}} r_{2} = -\\hat{\\mathbf{v}}$, $\\nabla_{\\mathrm{C}} r_{2} = \\hat{\\mathbf{v}}$, and $\\nabla_{\\mathrm{A}} r_{2} = \\mathbf{0}$, where $\\hat{\\mathbf{v}} = (\\mathbf{R}_{\\mathrm{C}} - \\mathbf{R}_{\\mathrm{B}})/r_{2}$ is the unit vector from $\\mathrm{B}$ to $\\mathrm{C}$.\n\n2. Derivatives for the Bond Angle ($\\theta$):\nThe bond angle $\\theta$ is defined by the dot product of the unit vectors $\\hat{\\mathbf{u}}$ and $\\hat{\\mathbf{v}}$:\n$$\\cos\\theta = \\hat{\\mathbf{u}} \\cdot \\hat{\\mathbf{v}}$$\nTo find the derivatives of $\\theta$, we differentiate this expression using the chain rule and product rule. Differentiating with respect to an arbitrary Cartesian coordinate $x_j$:\n$$-\\sin\\theta \\frac{\\partial \\theta}{\\partial x_j} = \\frac{\\partial\\hat{\\mathbf{u}}}{\\partial x_j} \\cdot \\hat{\\mathbf{v}} + \\hat{\\mathbf{u}} \\cdot \\frac{\\partial\\hat{\\mathbf{v}}}{\\partial x_j}$$\nThe core task is to differentiate the unit vectors. For $\\hat{\\mathbf{u}} = (\\mathbf{R}_{\\mathrm{A}} - \\mathbf{R}_{\\mathrm{B}})/r_{1}$, its derivative (gradient) with respect to, say, $\\mathbf{R}_{\\mathrm{A}}$ is found using the rules of vector calculus:\n$$\\nabla_{\\mathrm{A}} \\hat{\\mathbf{u}} = \\nabla_{\\mathrm{A}} \\left( \\frac{\\mathbf{R}_{\\mathrm{A}} - \\mathbf{R}_{\\mathrm{B}}}{r_{1}} \\right) = \\frac{1}{r_{1}} \\nabla_{\\mathrm{A}}(\\mathbf{R}_{\\mathrm{A}} - \\mathbf{R}_{\\mathrm{B}}) + (\\mathbf{R}_{\\mathrm{A}} - \\mathbf{R}_{\\mathrm{B}}) \\nabla_{\\mathrm{A}}\\left(\\frac{1}{r_{1}}\\right)$$\n$$= \\frac{1}{r_{1}} \\mathbf{I} + (\\mathbf{R}_{\\mathrm{A}} - \\mathbf{R}_{\\mathrm{B}}) \\left(-\\frac{1}{r_{1}^2} \\nabla_{\\mathrm{A}} r_{1}\\right) = \\frac{1}{r_{1}} \\left( \\mathbf{I} - \\hat{\\mathbf{u}}\\hat{\\mathbf{u}}^{\\top} \\right)$$\nwhere $\\mathbf{I}$ is the identity matrix and $\\hat{\\mathbf{u}}\\hat{\\mathbf{u}}^{\\top}$ is the outer product. This demonstrates that the change in a unit vector is orthogonal to the vector itself. By calculating the derivatives of $\\hat{\\mathbf{u}}$ and $\\hat{\\mathbf{v}}$ with respect to the coordinates of each atom ($\\mathrm{A}$, $\\mathrm{B}$, $\\mathrm{C}$) and substituting them into the differentiated cosine expression, we obtain the gradient vectors for $\\theta$. For example, the gradient with respect to $\\mathbf{R}_{\\mathrm{A}}$ is:\n$$\\nabla_{\\mathrm{A}} \\theta = \\frac{1}{-\\sin\\theta} \\left( (\\nabla_{\\mathrm{A}}\\hat{\\mathbf{u}})\\cdot\\hat{\\mathbf{v}} + \\hat{\\mathbf{u}}\\cdot(\\nabla_{\\mathrm{A}}\\hat{\\mathbf{v}}) \\right)$$\nSince $\\hat{\\mathbf{v}}$ does not depend on $\\mathbf{R}_{\\mathrm{A}}$, the second term vanishes. After substitution and vector algebraic simplification, one obtains expressions for $\\nabla_{\\mathrm{A}}\\theta$, $\\nabla_{\\mathrm{B}}\\theta$, and $\\nabla_{\\mathrm{C}}\\theta$.\n\n3. Invariances:\nThe resulting gradient vectors must satisfy physical invariances. Internal coordinates are unchanged by uniform translation or rigid rotation of the entire molecule. This imposes constraints on the rows of the $B$-matrix.\n- Translational Invariance: $\\sum_{I=\\mathrm{A,B,C}} \\nabla_{I} q_{i} = \\mathbf{0}$. For $r_{1}$, this is $\\nabla_{\\mathrm{A}}r_{1} + \\nabla_{\\mathrm{B}}r_{1} + \\nabla_{\\mathrm{C}}r_{1} = \\hat{\\mathbf{u}} - \\hat{\\mathbf{u}} + \\mathbf{0} = \\mathbf{0}$.\n- Rotational Invariance: $\\sum_{I=\\mathrm{A,B,C}} \\mathbf{R}_{I} \\times (\\nabla_{I} q_{i}) = \\mathbf{0}$.\nThese conditions must hold for any valid internal coordinate and serve as a crucial check on the derived expressions.\n\nPart 2: Explicit B-matrix for a linear triatomic molecule\n\nWe are given a linear geometry with $\\mathbf{R}_{\\mathrm{A}} = (0,0,-r_{1})$, $\\mathbf{R}_{\\mathrm{B}} = (0,0,0)$, and $\\mathbf{R}_{\\mathrm{C}} = (0,0,r_{2})$. The internal coordinates are $q = (r_{1}, r_{2}, q_{x}, q_{y})^{\\top}$. We compute the $4 \\times 9$ $B$-matrix by taking partial derivatives. The Cartesian vector is ordered as $\\mathbf{x} = (x_{\\mathrm{A}}, y_{\\mathrm{A}}, z_{\\mathrm{A}}, x_{\\mathrm{B}}, y_{\\mathrm{B}}, z_{\\mathrm{B}}, x_{\\mathrm{C}}, y_{\\mathrm{C}}, z_{\\mathrm{C}})^{\\top}$.\n\nRow 1: $q_{1} = r_{1} = \\sqrt{(x_{\\mathrm{A}}-x_{\\mathrm{B}})^2 + (y_{\\mathrm{A}}-y_{\\mathrm{B}})^2 + (z_{\\mathrm{A}}-z_{\\mathrm{B}})^2}$\nThe general derivatives are $\\frac{\\partial r_{1}}{\\partial R_{\\mathrm{A}\\alpha}} = \\frac{R_{\\mathrm{A}\\alpha} - R_{\\mathrm{B}\\alpha}}{r_1}$ and $\\frac{\\partial r_{1}}{\\partial R_{\\mathrm{B}\\alpha}} = \\frac{R_{\\mathrm{B}\\alpha} - R_{\\mathrm{A}\\alpha}}{r_1}$.\nEvaluated at the linear geometry:\n$\\frac{\\partial r_{1}}{\\partial x_{\\mathrm{A}}} = \\frac{0-0}{r_{1}} = 0$, $\\frac{\\partial r_{1}}{\\partial y_{\\mathrm{A}}} = \\frac{0-0}{r_{1}} = 0$, $\\frac{\\partial r_{1}}{\\partial z_{\\mathrm{A}}} = \\frac{-r_{1}-0}{r_{1}} = -1$.\n$\\frac{\\partial r_{1}}{\\partial x_{\\mathrm{B}}} = \\frac{0-0}{r_{1}} = 0$, $\\frac{\\partial r_{1}}{\\partial y_{\\mathrm{B}}} = \\frac{0-0}{r_{1}} = 0$, $\\frac{\\partial r_{1}}{\\partial z_{\\mathrm{B}}} = \\frac{0-(-r_{1})}{r_{1}} = 1$.\nDerivatives with respect to atom $\\mathrm{C}$ coordinates are all zero.\nRow 1 is: $(0, 0, -1, 0, 0, 1, 0, 0, 0)$.\n\nRow 2: $q_{2} = r_{2} = \\sqrt{(x_{\\mathrm{C}}-x_{\\mathrm{B}})^2 + (y_{\\mathrm{C}}-y_{\\mathrm{B}})^2 + (z_{\\mathrm{C}}-z_{\\mathrm{B}})^2}$\nThe general derivatives are $\\frac{\\partial r_{2}}{\\partial R_{\\mathrm{B}\\alpha}} = \\frac{R_{\\mathrm{B}\\alpha} - R_{\\mathrm{C}\\alpha}}{r_2}$ and $\\frac{\\partial r_{2}}{\\partial R_{\\mathrm{C}\\alpha}} = \\frac{R_{\\mathrm{C}\\alpha} - R_{\\mathrm{B}\\alpha}}{r_2}$.\nEvaluated at the linear geometry:\nDerivatives with respect to atom $\\mathrm{A}$ coordinates are all zero.\n$\\frac{\\partial r_{2}}{\\partial x_{\\mathrm{B}}} = \\frac{0-0}{r_{2}} = 0$, $\\frac{\\partial r_{2}}{\\partial y_{\\mathrm{B}}} = \\frac{0-0}{r_{2}} = 0$, $\\frac{\\partial r_{2}}{\\partial z_{\\mathrm{B}}} = \\frac{0-r_{2}}{r_{2}} = -1$.\n$\\frac{\\partial r_{2}}{\\partial x_{\\mathrm{C}}} = \\frac{0-0}{r_{2}} = 0$, $\\frac{\\partial r_{2}}{\\partial y_{\\mathrm{C}}} = \\frac{0-0}{r_{2}} = 0$, $\\frac{\\partial r_{2}}{\\partial z_{\\mathrm{C}}} = \\frac{r_{2}-0}{r_{2}} = 1$.\nRow 2 is: $(0, 0, 0, 0, 0, -1, 0, 0, 1)$.\n\nRow 3: $q_{x} = \\frac{x_{\\mathrm{A}} - x_{\\mathrm{B}}}{r_{1}} + \\frac{x_{\\mathrm{C}} - x_{\\mathrm{B}}}{r_{2}}$\nThe quantities $r_{1}$ and $r_{2}$ in the denominators are the constant equilibrium bond lengths, not functions of coordinates. They are parameters in the definition of the linear bending coordinate.\n$\\frac{\\partial q_{x}}{\\partial x_{\\mathrm{A}}} = \\frac{1}{r_{1}}$.\n$\\frac{\\partial q_{x}}{\\partial x_{\\mathrm{B}}} = -\\frac{1}{r_{1}} - \\frac{1}{r_{2}}$.\n$\\frac{\\partial q_{x}}{\\partial x_{\\mathrm{C}}} = \\frac{1}{r_{2}}$.\nAll other derivatives are zero.\nRow 3 is: $(\\frac{1}{r_{1}}, 0, 0, -(\\frac{1}{r_{1}} + \\frac{1}{r_{2}}), 0, 0, \\frac{1}{r_{2}}, 0, 0)$.\n\nRow 4: $q_{y} = \\frac{y_{\\mathrm{A}} - y_{\\mathrm{B}}}{r_{1}} + \\frac{y_{\\mathrm{C}} - y_{\\mathrm{B}}}{r_{2}}$\nBy analogy with $q_x$:\n$\\frac{\\partial q_{y}}{\\partial y_{\\mathrm{A}}} = \\frac{1}{r_{1}}$.\n$\\frac{\\partial q_{y}}{\\partial y_{\\mathrm{B}}} = -\\frac{1}{r_{1}} - \\frac{1}{r_{2}}$.\n$\\frac{\\partial q_{y}}{\\partial y_{\\mathrm{C}}} = \\frac{1}{r_{2}}$.\nAll other derivatives are zero.\nRow 4 is: $(0, \\frac{1}{r_{1}}, 0, 0, -(\\frac{1}{r_{1}} + \\frac{1}{r_{2}}), 0, 0, \\frac{1}{r_{2}}, 0)$.\n\nAssembling the four rows gives the final $4 \\times 9$ Wilson $B$-matrix.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & 0 & -1 & 0 & 0 & 1 & 0 & 0 & 0 \\\\\n0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 1 \\\\\n\\frac{1}{r_{1}} & 0 & 0 & -\\left(\\frac{1}{r_{1}} + \\frac{1}{r_{2}}\\right) & 0 & 0 & \\frac{1}{r_{2}} & 0 & 0 \\\\\n0 & \\frac{1}{r_{1}} & 0 & 0 & -\\left(\\frac{1}{r_{1}} + \\frac{1}{r_{2}}\\right) & 0 & 0 & \\frac{1}{r_{2}} & 0\n\\end{pmatrix}\n}\n$$", "id": "2894221"}, {"introduction": "State-of-the-art geometry optimizers use quasi-Newton methods like L-BFGS, which build an approximation to the inverse Hessian matrix to take intelligent steps toward a minimum. This exercise demystifies the inner workings of this powerful algorithm by guiding you through its core calculation: the two-loop recursion. By manually computing an optimization step, you will gain a concrete understanding of how L-BFGS uses the history of previous steps and gradients to efficiently navigate the potential energy surface [@problem_id:2894174].", "problem": "You are minimizing the Bornâ€“Oppenheimer potential energy surface (PES) $E(\\mathbf{R})$ of a small molecule in mass-weighted Cartesian coordinates using a quasi-Newton geometry optimization. At the current iterate $\\mathbf{R}_{k+1}$, you have the gradient $\\mathbf{g}_{k+1} = \\nabla E(\\mathbf{R}_{k+1})$. The Limited-memory Broydenâ€“Fletcherâ€“Goldfarbâ€“Shanno (L-BFGS) method forms a step $\\mathbf{p}_{k+1} = - H_{k+1} \\mathbf{g}_{k+1}$ by applying an implicit inverse-Hessian approximation $H_{k+1}$, constructed from the past displacement and gradient-difference pairs that satisfy the secant condition. Assume a $2$-dimensional subspace spanned by two internal coordinates (in atomic units), and that the last $3$ pairs are, from oldest to most recent,\n$\\mathbf{s}_{0} = \\begin{pmatrix}1 \\\\ 0\\end{pmatrix}\\,\\text{bohr}$, $\\mathbf{y}_{0} = \\begin{pmatrix}2 \\\\ 0\\end{pmatrix}\\,\\text{Ha}\\,\\text{bohr}^{-1}$,\n$\\mathbf{s}_{1} = \\begin{pmatrix}0 \\\\ 1\\end{pmatrix}\\,\\text{bohr}$, $\\mathbf{y}_{1} = \\begin{pmatrix}0 \\\\ 1\\end{pmatrix}\\,\\text{Ha}\\,\\text{bohr}^{-1}$,\n$\\mathbf{s}_{2} = \\begin{pmatrix}1 \\\\ 1\\end{pmatrix}\\,\\text{bohr}$, $\\mathbf{y}_{2} = \\begin{pmatrix}2 \\\\ 1\\end{pmatrix}\\,\\text{Ha}\\,\\text{bohr}^{-1}$.\nAt $\\mathbf{R}_{k+1}$ the gradient is\n$\\mathbf{g}_{k+1} = \\begin{pmatrix}3 \\\\ 2\\end{pmatrix}\\,\\text{Ha}\\,\\text{bohr}^{-1}$.\nUse the standard two-loop recursion for the L-BFGS inverse-Hessian product with memory $m=3$, initialized with the scalar-multiple identity $H_{0} = \\gamma I$ where $\\gamma = \\dfrac{\\mathbf{s}_{2}^{\\top} \\mathbf{y}_{2}}{\\mathbf{y}_{2}^{\\top} \\mathbf{y}_{2}}$, to compute the step $\\mathbf{p}_{k+1} = -H_{k+1}\\mathbf{g}_{k+1}$. Then, report the Euclidean norm $\\|\\mathbf{p}_{k+1}\\|_{2}$.\nRound your answer to four significant figures and express the final result in bohr.\nYour final answer must be a single real-valued number.", "solution": "The L-BFGS two-loop recursion computes the product $\\mathbf{r} = H_{k+1}\\mathbf{g}_{k+1}$ without forming the matrix $H_{k+1}$ explicitly. The algorithm is as follows, adapted to the problem's indexing ($i=0, 1, 2$ from oldest to most recent):\n\nLet $\\mathbf{g} = \\mathbf{g}_{k+1} = \\begin{pmatrix}3 \\\\ 2\\end{pmatrix}$.\nThe historical pairs $(\\mathbf{s}_i, \\mathbf{y}_i)$ must satisfy the curvature condition $\\mathbf{s}_i^\\top \\mathbf{y}_i > 0$:\nFor $i=0$: $\\mathbf{s}_{0}^{\\top} \\mathbf{y}_{0} = \\begin{pmatrix}1 & 0\\end{pmatrix} \\begin{pmatrix}2 \\\\ 0\\end{pmatrix} = 2 > 0$.\nFor $i=1$: $\\mathbf{s}_{1}^{\\top} \\mathbf{y}_{1} = \\begin{pmatrix}0 & 1\\end{pmatrix} \\begin{pmatrix}0 \\\\ 1\\end{pmatrix} = 1 > 0$.\nFor $i=2$: $\\mathbf{s}_{2}^{\\top} \\mathbf{y}_{2} = \\begin{pmatrix}1 & 1\\end{pmatrix} \\begin{pmatrix}2 \\\\ 1\\end{pmatrix} = (1)(2) + (1)(1) = 3 > 0$.\nAll pairs satisfy the condition.\n\nWe first compute the scalars $\\rho_i = 1 / (\\mathbf{y}_i^\\top \\mathbf{s}_i)$:\n$\\rho_0 = (\\mathbf{y}_0^\\top \\mathbf{s}_0)^{-1} = (2)^{-1} = \\frac{1}{2}$.\n$\\rho_1 = (\\mathbf{y}_1^\\top \\mathbf{s}_1)^{-1} = (1)^{-1} = 1$.\n$\\rho_2 = (\\mathbf{y}_2^\\top \\mathbf{s}_2)^{-1} = (3)^{-1} = \\frac{1}{3}$.\n\nThe two-loop recursion proceeds as follows:\nInitialize $\\mathbf{q} = \\mathbf{g} = \\begin{pmatrix}3 \\\\ 2\\end{pmatrix}$.\n\n**First loop (from $i=2$ down to $0$):**\nFor $i=2$:\n$\\alpha_2 = \\rho_2 \\mathbf{s}_2^\\top \\mathbf{q} = \\frac{1}{3} \\begin{pmatrix}1 & 1\\end{pmatrix} \\begin{pmatrix}3 \\\\ 2\\end{pmatrix} = \\frac{1}{3}(3+2) = \\frac{5}{3}$.\n$\\mathbf{q} \\leftarrow \\mathbf{q} - \\alpha_2 \\mathbf{y}_2 = \\begin{pmatrix}3 \\\\ 2\\end{pmatrix} - \\frac{5}{3} \\begin{pmatrix}2 \\\\ 1\\end{pmatrix} = \\begin{pmatrix}3 - \\frac{10}{3} \\\\ 2 - \\frac{5}{3}\\end{pmatrix} = \\begin{pmatrix}-\\frac{1}{3} \\\\ \\frac{1}{3}\\end{pmatrix}$.\n\nFor $i=1$:\n$\\alpha_1 = \\rho_1 \\mathbf{s}_1^\\top \\mathbf{q} = 1 \\begin{pmatrix}0 & 1\\end{pmatrix} \\begin{pmatrix}-\\frac{1}{3} \\\\ \\frac{1}{3}\\end{pmatrix} = \\frac{1}{3}$.\n$\\mathbf{q} \\leftarrow \\mathbf{q} - \\alpha_1 \\mathbf{y}_1 = \\begin{pmatrix}-\\frac{1}{3} \\\\ \\frac{1}{3}\\end{pmatrix} - \\frac{1}{3} \\begin{pmatrix}0 \\\\ 1\\end{pmatrix} = \\begin{pmatrix}-\\frac{1}{3} \\\\ 0\\end{pmatrix}$.\n\nFor $i=0$:\n$\\alpha_0 = \\rho_0 \\mathbf{s}_0^\\top \\mathbf{q} = \\frac{1}{2} \\begin{pmatrix}1 & 0\\end{pmatrix} \\begin{pmatrix}-\\frac{1}{3} \\\\ 0\\end{pmatrix} = -\\frac{1}{6}$.\n$\\mathbf{q} \\leftarrow \\mathbf{q} - \\alpha_0 \\mathbf{y}_0 = \\begin{pmatrix}-\\frac{1}{3} \\\\ 0\\end{pmatrix} - (-\\frac{1}{6}) \\begin{pmatrix}2 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}-\\frac{1}{3} + \\frac{2}{6} \\\\ 0\\end{pmatrix} = \\begin{pmatrix}0 \\\\ 0\\end{pmatrix}$.\n\nAfter the first loop, the vector $\\mathbf{q}$ is $\\begin{pmatrix}0 \\\\ 0\\end{pmatrix}$. The computed coefficients are $\\alpha_0 = -1/6$, $\\alpha_1 = 1/3$, $\\alpha_2 = 5/3$.\n\n**Scaling and initial step:**\nThe initial inverse Hessian is $H_0 = \\gamma I$, where $\\gamma = \\frac{\\mathbf{s}_{2}^{\\top} \\mathbf{y}_{2}}{\\mathbf{y}_{2}^{\\top} \\mathbf{y}_{2}}$.\n$\\mathbf{s}_{2}^{\\top} \\mathbf{y}_{2} = 3$.\n$\\mathbf{y}_{2}^{\\top} \\mathbf{y}_{2} = \\begin{pmatrix}2 & 1\\end{pmatrix} \\begin{pmatrix}2 \\\\ 1\\end{pmatrix} = 2^2 + 1^2 = 5$.\nSo, $\\gamma = \\frac{3}{5}$.\nThe initial step vector $\\mathbf{r}$ is calculated as $\\mathbf{r} = H_0 \\mathbf{q} = \\frac{3}{5} I \\begin{pmatrix}0 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}0 \\\\ 0\\end{pmatrix}$.\n\n**Second loop (from $i=0$ up to $2$):**\nInitialize $\\mathbf{r} = \\begin{pmatrix}0 \\\\ 0\\end{pmatrix}$.\n\nFor $i=0$:\n$\\beta_0 = \\rho_0 \\mathbf{y}_0^\\top \\mathbf{r} = \\frac{1}{2} \\begin{pmatrix}2 & 0\\end{pmatrix} \\begin{pmatrix}0 \\\\ 0\\end{pmatrix} = 0$.\n$\\mathbf{r} \\leftarrow \\mathbf{r} + \\mathbf{s}_0 (\\alpha_0 - \\beta_0) = \\begin{pmatrix}0 \\\\ 0\\end{pmatrix} + \\begin{pmatrix}1 \\\\ 0\\end{pmatrix} (-\\frac{1}{6} - 0) = \\begin{pmatrix}-\\frac{1}{6} \\\\ 0\\end{pmatrix}$.\n\nFor $i=1$:\n$\\beta_1 = \\rho_1 \\mathbf{y}_1^\\top \\mathbf{r} = 1 \\begin{pmatrix}0 & 1\\end{pmatrix} \\begin{pmatrix}-\\frac{1}{6} \\\\ 0\\end{pmatrix} = 0$.\n$\\mathbf{r} \\leftarrow \\mathbf{r} + \\mathbf{s}_1 (\\alpha_1 - \\beta_1) = \\begin{pmatrix}-\\frac{1}{6} \\\\ 0\\end{pmatrix} + \\begin{pmatrix}0 \\\\ 1\\end{pmatrix} (\\frac{1}{3} - 0) = \\begin{pmatrix}-\\frac{1}{6} \\\\ \\frac{1}{3}\\end{pmatrix}$.\n\nFor $i=2$:\n$\\beta_2 = \\rho_2 \\mathbf{y}_2^\\top \\mathbf{r} = \\frac{1}{3} \\begin{pmatrix(2 & 1\\end{pmatrix} \\begin{pmatrix}-\\frac{1}{6} \\\\ \\frac{1}{3}\\end{pmatrix} = \\frac{1}{3}(-\\frac{2}{6} + \\frac{1}{3}) = \\frac{1}{3}(-\\frac{1}{3} + \\frac{1}{3}) = 0$.\n$\\mathbf{r} \\leftarrow \\mathbf{r} + \\mathbf{s}_2 (\\alpha_2 - \\beta_2) = \\begin{pmatrix}-\\frac{1}{6} \\\\ \\frac{1}{3}\\end{pmatrix} + \\begin{pmatrix}1 \\\\ 1\\end{pmatrix} (\\frac{5}{3} - 0) = \\begin{pmatrix}-\\frac{1}{6} + \\frac{5}{3} \\\\ \\frac{1}{3} + \\frac{5}{3}\\end{pmatrix} = \\begin{pmatrix}-\\frac{1}{6} + \\frac{10}{6} \\\\ \\frac{6}{3}\\end{pmatrix} = \\begin{pmatrix}\\frac{9}{6} \\\\ 2\\end{pmatrix} = \\begin{pmatrix}1.5 \\\\ 2\\end{pmatrix}$.\n\nThe result of the two-loop recursion is $\\mathbf{r} = H_{k+1}\\mathbf{g}_{k+1} = \\begin{pmatrix}1.5 \\\\ 2\\end{pmatrix}$.\nThe L-BFGS step is $\\mathbf{p}_{k+1} = -\\mathbf{r} = \\begin{pmatrix}-1.5 \\\\ -2\\end{pmatrix}$. The units of this vector are bohr.\n\nThe final task is to compute the Euclidean norm of this step vector, $\\|\\mathbf{p}_{k+1}\\|_2$.\n$$\n\\|\\mathbf{p}_{k+1}\\|_2 = \\left\\| \\begin{pmatrix}-1.5 \\\\ -2\\end{pmatrix} \\right\\|_2 = \\sqrt{(-1.5)^2 + (-2)^2} = \\sqrt{2.25 + 4} = \\sqrt{6.25} = 2.5\n$$\nThe value is exactly $2.5$. The problem requests the answer to be rounded to four significant figures. Thus, the result is $2.500$.", "answer": "$$ \\boxed{2.500} $$", "id": "2894174"}]}