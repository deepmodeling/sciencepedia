{"hands_on_practices": [{"introduction": "This first exercise provides a foundational, first-principles derivation of Boys localization for the simplest molecular system with a covalent bond, the dihydrogen molecule $\\text{H}_2$. By analytically maximizing the Boys objective function for a two-orbital system, you will uncover the exact rotation that transforms the delocalized canonical molecular orbitals into maximally localized orbitals, which intuitively correspond to the atomic orbitals on each atom. This practice [@problem_id:2913178] is essential for building a firm mathematical understanding of how localization criteria translate into concrete transformations.", "problem": "Consider the hydrogen molecule $\\,\\text{H}_2\\,$ in a minimal basis of two normalized $1s$ atomic orbitals (AOs) $\\,\\chi_A(\\mathbf{r})\\,$ and $\\,\\chi_B(\\mathbf{r})\\,$ centered at nuclei $A$ and $B$ separated by a distance $R$ along the $x$-axis. Place the origin at the midpoint between the nuclei so that the nuclear positions are at $x=\\pm R/2$. Let the AO overlap be $S=\\langle \\chi_A \\mid \\chi_B \\rangle$. Define the canonical orthonormal bonding and antibonding molecular orbitals (MOs) by\n$$\n\\phi_g = N_g \\left(\\chi_A + \\chi_B\\right), \\qquad \\phi_u = N_u \\left(\\chi_A - \\chi_B\\right),\n$$\nwith normalization factors $\\,N_g = \\left(2(1+S)\\right)^{-1/2}\\,$ and $\\,N_u = \\left(2(1-S)\\right)^{-1/2}\\,$. Consider the two-dimensional subspace spanned by $\\{\\phi_g,\\phi_u\\}$ and parametrize an arbitrary orthonormal pair of orbitals $\\{\\psi_1(\\theta),\\psi_2(\\theta)\\}$ in this subspace by the rotation angle $\\,\\theta \\in \\mathbb{R}\\,$ as\n$$\n\\begin{pmatrix}\n\\psi_1(\\theta) \\\\\n\\psi_2(\\theta)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\cos\\theta & \\sin\\theta \\\\\n-\\sin\\theta & \\cos\\theta\n\\end{pmatrix}\n\\begin{pmatrix}\n\\phi_g \\\\\n\\phi_u\n\\end{pmatrix}.\n$$\nIn the Boys localization scheme, the localized orbitals are obtained by maximizing the Boys objective over the chosen set of orbitals, which (up to an additive constant independent of the rotation within a fixed subspace) can be taken as the sum of squared orbital centroids,\n$$\n\\mathcal{J}(\\theta) = \\sum_{i=1}^{2} \\left\\| \\overline{\\mathbf{r}}_i(\\theta) \\right\\|^2, \\qquad \\overline{\\mathbf{r}}_i(\\theta) = \\langle \\psi_i(\\theta) \\mid \\mathbf{r} \\mid \\psi_i(\\theta) \\rangle.\n$$\nStarting from the definitions above and using only fundamental symmetry and orthogonality properties of the AOs and MOs, derive $\\mathcal{J}(\\theta)$ as a function of $\\theta$, $R$, and $S$, and determine the rotation angle $\\,\\theta^\\star\\,$ that maximizes $\\mathcal{J}(\\theta)$. Report the value of $\\,\\theta^\\star\\,$ in radians. The final answer must be a single value for $\\,\\theta^\\star\\,$ (no derivation in the final answer). No rounding is required.", "solution": "The problem presented is well-posed, scientifically sound, and contains all necessary information for a unique solution. We will proceed with the derivation.\n\nThe objective is to maximize the function $\\mathcal{J}(\\theta)$ defined as the sum of the squared norms of the orbital centroids:\n$$\n\\mathcal{J}(\\theta) = \\sum_{i=1}^{2} \\left\\| \\overline{\\mathbf{r}}_i(\\theta) \\right\\|^2\n$$\nwhere $\\overline{\\mathbf{r}}_i(\\theta) = \\langle \\psi_i(\\theta) \\mid \\mathbf{r} \\mid \\psi_i(\\theta) \\rangle$. The orbitals $\\{\\psi_1(\\theta), \\psi_2(\\theta)\\}$ form an orthonormal basis for the $2$-dimensional subspace spanned by the canonical molecular orbitals $\\{\\phi_g, \\phi_u\\}$. The transformation from the canonical basis to the rotated basis is a unitary (in this case, real orthogonal) rotation:\n$$\n\\begin{pmatrix}\n\\psi_1(\\theta) \\\\\n\\psi_2(\\theta)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\cos\\theta & \\sin\\theta \\\\\n-\\sin\\theta & \\cos\\theta\n\\end{pmatrix}\n\\begin{pmatrix}\n\\phi_g \\\\\n\\phi_u\n\\end{pmatrix}\n$$\nThe sum of the orbital centroids can be expressed as the trace of the position operator $\\mathbf{r}$ projected onto the subspace of interest. Since the trace is invariant under a change of orthonormal basis, this sum is independent of the rotation angle $\\theta$:\n$$\n\\sum_{i=1}^{2} \\overline{\\mathbf{r}}_i(\\theta) = \\sum_{i=1}^{2} \\langle \\psi_i(\\theta) \\mid \\mathbf{r} \\mid \\psi_i(\\theta) \\rangle = \\langle \\phi_g \\mid \\mathbf{r} \\mid \\phi_g \\rangle + \\langle \\phi_u \\mid \\mathbf{r} \\mid \\phi_u \\rangle\n$$\nThe molecule $\\text{H}_2$ possesses a center of inversion symmetry at the origin. The canonical molecular orbitals $\\phi_g$ and $\\phi_u$ are eigenfunctions of the inversion operator $\\hat{i}$ with eigenvalues $+1$ (gerade, g) and $-1$ (ungerade, u), respectively. The position operator $\\mathbf{r}$ is an odd operator, meaning $\\hat{i}\\mathbf{r}\\hat{i}^{-1} = -\\mathbf{r}$.\nThe expectation value of the position operator for an orbital of definite parity (g or u) must be zero:\n$$\n\\langle \\phi_g \\mid \\mathbf{r} \\mid \\phi_g \\rangle = \\langle \\hat{i}\\phi_g \\mid \\hat{i}\\mathbf{r}\\hat{i}^{-1} \\mid \\hat{i}\\phi_g \\rangle = \\langle \\phi_g \\mid -\\mathbf{r} \\mid \\phi_g \\rangle = - \\langle \\phi_g \\mid \\mathbf{r} \\mid \\phi_g \\rangle \\implies \\langle \\phi_g \\mid \\mathbf{r} \\mid \\phi_g \\rangle = \\mathbf{0}\n$$\n$$\n\\langle \\phi_u \\mid \\mathbf{r} \\mid \\phi_u \\rangle = \\langle \\hat{i}\\phi_u \\mid \\hat{i}\\mathbf{r}\\hat{i}^{-1} \\mid \\hat{i}\\phi_u \\rangle = \\langle -\\phi_u \\mid -\\mathbf{r} \\mid -\\phi_u \\rangle = - \\langle \\phi_u \\mid \\mathbf{r} \\mid \\phi_u \\rangle \\implies \\langle \\phi_u \\mid \\mathbf{r} \\mid \\phi_u \\rangle = \\mathbf{0}\n$$\nTherefore, the sum of the centroids is zero for any $\\theta$:\n$$\n\\overline{\\mathbf{r}}_1(\\theta) + \\overline{\\mathbf{r}}_2(\\theta) = \\mathbf{0} \\implies \\overline{\\mathbf{r}}_2(\\theta) = -\\overline{\\mathbf{r}}_1(\\theta)\n$$\nThis significantly simplifies the objective function:\n$$\n\\mathcal{J}(\\theta) = \\left\\| \\overline{\\mathbf{r}}_1(\\theta) \\right\\|^2 + \\left\\| -\\overline{\\mathbf{r}}_1(\\theta) \\right\\|^2 = 2 \\left\\| \\overline{\\mathbf{r}}_1(\\theta) \\right\\|^2\n$$\nMaximizing $\\mathcal{J}(\\theta)$ is equivalent to maximizing the squared norm of one of the centroids.\nLet us now compute $\\overline{\\mathbf{r}}_1(\\theta)$:\n$$\n\\overline{\\mathbf{r}}_1(\\theta) = \\langle \\cos\\theta\\,\\phi_g + \\sin\\theta\\,\\phi_u \\mid \\mathbf{r} \\mid \\cos\\theta\\,\\phi_g + \\sin\\theta\\,\\phi_u \\rangle\n$$\n$$\n= \\cos^2\\theta \\langle \\phi_g \\mid \\mathbf{r} \\mid \\phi_g \\rangle + \\sin^2\\theta \\langle \\phi_u \\mid \\mathbf{r} \\mid \\phi_u \\rangle + 2\\cos\\theta\\sin\\theta \\langle \\phi_g \\mid \\mathbf{r} \\mid \\phi_u \\rangle\n$$\nUsing the fact that the diagonal elements are zero, this simplifies to:\n$$\n\\overline{\\mathbf{r}}_1(\\theta) = \\sin(2\\theta) \\langle \\phi_g \\mid \\mathbf{r} \\mid \\phi_u \\rangle\n$$\nThe vector $\\langle \\phi_g \\mid \\mathbf{r} \\mid \\phi_u \\rangle$ is the transition dipole moment between the bonding and antibonding orbitals. Let us denote its components by $\\mu_x, \\mu_y, \\mu_z$. The orbitals are constructed from $1s$ atomic orbitals and are therefore cylindrically symmetric about the internuclear axis (the $x$-axis). For any cylindrically symmetric orbital $\\psi$, $\\langle \\psi \\mid y \\mid \\psi \\rangle = 0$ and $\\langle \\psi \\mid z \\mid \\psi \\rangle = 0$. The transition dipole components $\\mu_y = \\langle \\phi_g \\mid y \\mid \\phi_u \\rangle$ and $\\mu_z = \\langle \\phi_g \\mid z \\mid \\phi_u \\rangle$ are also zero due to this symmetry. Thus, the transition dipole moment vector points entirely along the $x$-axis: $\\langle \\phi_g \\mid \\mathbf{r} \\mid \\phi_u \\rangle = (\\mu_x, 0, 0)$.\n\nTo find $\\mu_x = \\langle \\phi_g \\mid x \\mid \\phi_u \\rangle$, we use the provided definitions of the orbitals. A direct calculation is one method:\n$$\n\\mu_x = N_g N_u \\langle \\chi_A + \\chi_B \\mid x \\mid \\chi_A - \\chi_B \\rangle = N_g N_u \\left( \\langle \\chi_A|x|\\chi_A \\rangle - \\langle \\chi_A|x|\\chi_B \\rangle + \\langle \\chi_B|x|\\chi_A \\rangle - \\langle \\chi_B|x|\\chi_B \\rangle \\right)\n$$\nThe atomic orbitals $\\chi_A$ and $\\chi_B$ are centered at $x_A = -R/2$ and $x_B = R/2$, respectively. Thus, $\\langle \\chi_A|x|\\chi_A \\rangle = x_A = -R/2$ and $\\langle \\chi_B|x|\\chi_B \\rangle = x_B = R/2$.\nThe off-diagonal element $\\langle \\chi_A|x|\\chi_B \\rangle$ is zero by symmetry. The integrand is $\\chi_A^*(x) x \\chi_B(x)$. With the origin at the midpoint, $\\chi_A(x)$ has the same functional form as $\\chi_B(-x)$, making the product $\\chi_A(x)\\chi_B(x)$ an even function of $x$. Multiplying by $x$ makes the integrand $\\chi_A(x) x \\chi_B(x)$ odd, and its integral over symmetric limits $(-\\infty, \\infty)$ is zero. Thus, $\\langle \\chi_A|x|\\chi_B \\rangle = 0$ and $\\langle \\chi_B|x|\\chi_A \\rangle = 0$.\nSubstituting these values:\n$$\n\\mu_x = N_g N_u \\left( -\\frac{R}{2} - 0 + 0 - \\frac{R}{2} \\right) = -R N_g N_u\n$$\nSubstituting the normalization factors $N_g = (2(1+S))^{-1/2}$ and $N_u = (2(1-S))^{-1/2}$:\n$$\n\\mu_x = -R \\frac{1}{\\sqrt{2(1+S)}} \\frac{1}{\\sqrt{2(1-S)}} = \\frac{-R}{2\\sqrt{1-S^2}}\n$$\nNow we can write the explicit form of the objective function:\n$$\n\\mathcal{J}(\\theta) = 2 \\left\\| \\overline{\\mathbf{r}}_1(\\theta) \\right\\|^2 = 2 \\left\\| \\sin(2\\theta) (\\mu_x, 0, 0) \\right\\|^2 = 2 \\sin^2(2\\theta) \\mu_x^2\n$$\n$$\n\\mathcal{J}(\\theta) = 2 \\sin^2(2\\theta) \\left( \\frac{-R}{2\\sqrt{1-S^2}} \\right)^2 = 2 \\sin^2(2\\theta) \\frac{R^2}{4(1-S^2)} = \\frac{R^2}{2(1-S^2)} \\sin^2(2\\theta)\n$$\nTo maximize $\\mathcal{J}(\\theta)$, we must maximize the term $\\sin^2(2\\theta)$, as $R$ and $S$ are fixed parameters. The maximum value of $\\sin^2(2\\theta)$ is $1$. This occurs when:\n$$\n2\\theta = \\frac{\\pi}{2} + n\\pi, \\quad n \\in \\mathbb{Z}\n$$\n$$\n\\theta = \\frac{\\pi}{4} + \\frac{n\\pi}{2}\n$$\nAll these angles lead to physically equivalent sets of localized orbitals (up to permutation and overall phase factors). The simplest positive solution is for $n=0$.\n$$\n\\theta^\\star = \\frac{\\pi}{4}\n$$\nThis rotation angle transforms the delocalized canonical orbitals $\\phi_g, \\phi_u$ into localized orbitals that, in the limit of large separation ($S \\to 0$), correspond to the atomic orbitals on each nucleus, which is the expected result for maximal localization.", "answer": "$$\n\\boxed{\\frac{\\pi}{4}}\n$$", "id": "2913178"}, {"introduction": "Building on the analytical foundation, this practice delves into the computational mechanics of localization algorithms by focusing on a single, crucial step. You will perform one Jacobi rotation for a pair of molecular orbitals in the water molecule, which is the fundamental building block of iterative localization procedures used in quantum chemistry software. This hands-on calculation [@problem_id:2913150] bridges the gap between abstract theory and practical implementation by demonstrating how dipole integrals and orbital coefficients are used to determine the optimal mixing angle for a realistic polyatomic molecule.", "problem": "You are given a minimal Hartree–Fock (HF) description of the water molecule $\\text{H}_2$ in the Born–Oppenheimer approximation with three normalized, contracted, Cartesian, primitive $s$-type Gaussian atomic orbitals (AOs): one centered on oxygen and one on each hydrogen. The molecular geometry (in bohr) is $\\,\\mathbf{R}_{\\text{O}}=(0,0,0)\\,$, $\\,\\mathbf{R}_{\\text{H}_1}=(+1.427,\\,1.110,\\,0)\\,$, and $\\,\\mathbf{R}_{\\text{H}_2}=(-1.427,\\,1.110,\\,0)\\,$, corresponding to an O–H distance of approximately $\\,1.809\\,$ bohr and an angle of approximately $\\,104.5^\\circ$. The Gaussian exponents are $\\,\\alpha_{\\text{O}}=1.2\\,$ and $\\,\\alpha_{\\text{H}}=0.8\\,$ (in bohr$^{-2}$). Assume normalized $s$-type primitives on each center.\n\nTwo occupied HF molecular orbitals (MOs), denoted $\\,\\phi_1\\,$ and $\\,\\phi_2\\,$, are represented in the AO basis ordered as $(\\chi_{\\text{O}},\\chi_{\\text{H}_1},\\chi_{\\text{H}_2})$ by the coefficient columns\n$$\n\\mathbf{C}_1=\\begin{pmatrix} 0.7209 \\\\ 0.36045 \\\\ 0.36045 \\end{pmatrix},\\qquad\n\\mathbf{C}_2=\\begin{pmatrix} 0 \\\\ 0.7209 \\\\ -0.7209 \\end{pmatrix},\n$$\nwhich are orthonormal with respect to the AO overlap matrix implied by the given Gaussians.\n\nConsider Boys localization for the pair $\\{\\phi_1,\\phi_2\\}$ using the centroid form (equivalent to the original Foster–Boys objective), which in a two-orbital Jacobi rotation step mixes the pair by an orthogonal transformation parameterized by an angle $\\,\\theta\\,$ (in radians):\n$$\n\\phi_1'=\\phi_1\\cos\\theta+\\phi_2\\sin\\theta,\\qquad\n\\phi_2'=-\\phi_1\\sin\\theta+\\phi_2\\cos\\theta,\n$$\nand updates the orbital centroids $\\,\\mathbf{d}_p=\\langle\\phi_p|\\mathbf{r}|\\phi_p\\rangle\\,$ accordingly.\n\nTasks:\n1) Using the Gaussian product theorem and the definition of the AO dipole integral $\\,\\mu^{(k)}_{\\mu\\nu}=\\langle\\chi_\\mu|r_k|\\chi_\\nu\\rangle\\,$ ($\\,k=x,y,z\\,$), compute all AO dipole integrals $\\,\\mu^{(x)}_{\\mu\\nu}\\,$ and $\\,\\mu^{(y)}_{\\mu\\nu}\\,$ for the three-AO basis. Use that for normalized $s$-type primitives on centers $\\,\\mathbf{A}\\,$ and $\\,\\mathbf{B}\\,$ with exponents $\\,\\alpha\\,$ and $\\,\\beta\\,$, the overlap is $\\,S_{AB}=\\left(\\frac{2\\sqrt{\\alpha\\beta}}{\\alpha+\\beta}\\right)^{3/2}\\exp\\!\\big(-\\frac{\\alpha\\beta}{\\alpha+\\beta}|\\mathbf{A}-\\mathbf{B}|^2\\big)\\,$ and the dipole integral is $\\,\\langle s_A|r_k|s_B\\rangle=S_{AB}\\,P_k\\,$ where $\\,\\mathbf{P}=(\\alpha\\mathbf{A}+\\beta\\mathbf{B})/(\\alpha+\\beta)\\,$. For identical centers $\\,A=B\\,$, use $\\,\\langle s_A|r_k|s_A\\rangle=A_k\\,$.\n2) Transform these AO dipole matrices to the MO pair subspace to obtain $\\,\\mathbf{d}_1=\\langle\\phi_1|\\mathbf{r}|\\phi_1\\rangle\\,$, $\\,\\mathbf{d}_2=\\langle\\phi_2|\\mathbf{r}|\\phi_2\\rangle\\,$, and $\\,\\mathbf{r}_{12}=\\langle\\phi_1|\\mathbf{r}|\\phi_2\\rangle\\,$.\n3) From first principles, determine the Jacobi rotation angle $\\,\\theta\\,$ that optimizes the Boys objective for this pair (i.e., maximizes the sum of squared centroid norms) and compute the updated centroids $\\,\\mathbf{d}_1'\\,$ and $\\,\\mathbf{d}_2'\\,$ after the rotation.\n\nFinally, report the rotation angle $\\,\\theta\\,$ in radians as your single final result, rounded to six significant figures. Do not include units in the final answer box. All intermediate results in your working may be kept in atomic units (bohr).", "solution": "The problem is subjected to validation and is found to be scientifically grounded, well-posed, objective, and internally consistent. It is a standard problem in computational quantum chemistry. We proceed with the solution, which is divided into three tasks as outlined in the problem statement.\n\nThe basis functions are labeled as $\\chi_1 = \\chi_{\\text{O}}$, $\\chi_2 = \\chi_{\\text{H}_1}$, and $\\chi_3 = \\chi_{\\text{H}_2}$. The corresponding atomic centers are $\\mathbf{A}_1 = \\mathbf{R}_{\\text{O}} = (0, 0, 0)$, $\\mathbf{A}_2 = \\mathbf{R}_{\\text{H}_1} = (1.427, 1.110, 0)$, and $\\mathbf{A}_3 = \\mathbf{R}_{\\text{H}_2} = (-1.427, 1.110, 0)$, in units of bohr. The Gaussian exponents are $\\alpha_1 = \\alpha_{\\text{O}} = 1.2\\,\\mathrm{bohr}^{-2}$ and $\\alpha_2 = \\alpha_3 = \\alpha_{\\text{H}} = 0.8\\,\\mathrm{bohr}^{-2}$. Since all centers lie in the $xy$-plane, all $z$-components of dipole integrals are zero.\n\nTask 1: Computation of AO Dipole Integrals\n\nThe AO dipole matrix elements $\\mu^{(k)}_{\\mu\\nu} = \\langle\\chi_\\mu|r_k|\\chi_\\nu\\rangle$ for $k=x, y$ must be computed.\n\nThe diagonal elements are given by $\\langle s_A | r_k | s_A \\rangle = A_k$.\nFor $\\chi_1 = \\chi_{\\text{O}}$ centered at $\\mathbf{A}_1=(0,0,0)$:\n$\\mu^{(x)}_{11} = 0$, $\\mu^{(y)}_{11} = 0$.\nFor $\\chi_2 = \\chi_{\\text{H}_1}$ centered at $\\mathbf{A}_2=(1.427, 1.110, 0)$:\n$\\mu^{(x)}_{22} = 1.427$, $\\mu^{(y)}_{22} = 1.110$.\nFor $\\chi_3 = \\chi_{\\text{H}_2}$ centered at $\\mathbf{A}_3=(-1.427, 1.110, 0)$:\n$\\mu^{(x)}_{33} = -1.427$, $\\mu^{(y)}_{33} = 1.110$.\n\nThe off-diagonal elements are given by $\\langle s_A|r_k|s_B\\rangle = S_{AB} P_k$, where $\\mathbf{P} = (\\alpha\\mathbf{A}+\\beta\\mathbf{B})/(\\alpha+\\beta)$ and $S_{AB} = \\left(\\frac{2\\sqrt{\\alpha\\beta}}{\\alpha+\\beta}\\right)^{3/2} \\exp\\left(-\\frac{\\alpha\\beta}{\\alpha+\\beta}|\\mathbf{A}-\\mathbf{B}|^2\\right)$.\n\nPair $(1, 2)$ (O, H$_1$): $\\alpha_1=1.2, \\alpha_2=0.8$.\n$|\\mathbf{A}_1-\\mathbf{A}_2|^2 = 1.427^2 + 1.110^2 = 3.268429$.\n$\\frac{\\alpha_1\\alpha_2}{\\alpha_1+\\alpha_2} = \\frac{1.2 \\times 0.8}{1.2+0.8} = 0.48$.\n$S_{12} = \\left(\\frac{2\\sqrt{1.2 \\times 0.8}}{1.2+0.8}\\right)^{3/2} \\exp(-0.48 \\times 3.268429) = (\\sqrt{0.96})^{3/2} \\exp(-1.56884592) \\approx 0.201988$.\n$\\mathbf{P}_{12} = \\frac{1.2 \\mathbf{A}_1 + 0.8 \\mathbf{A}_2}{1.2+0.8} = 0.4 \\mathbf{A}_2 = (0.5708, 0.444, 0)$.\n$\\boldsymbol{\\mu}_{12} = \\langle \\chi_1 | \\mathbf{r} | \\chi_2 \\rangle = S_{12} \\mathbf{P}_{12} \\approx (0.115295, 0.089673, 0)$.\nSo, $\\mu^{(x)}_{12} \\approx 0.115295$, $\\mu^{(y)}_{12} \\approx 0.089673$.\n\nPair $(1, 3)$ (O, H$_2$): By symmetry, $S_{13}=S_{12}$.\n$\\mathbf{P}_{13} = 0.4 \\mathbf{A}_3 = (-0.5708, 0.444, 0)$.\n$\\boldsymbol{\\mu}_{13} = \\langle \\chi_1 | \\mathbf{r} | \\chi_3 \\rangle = S_{13} \\mathbf{P}_{13} \\approx (-0.115295, 0.089673, 0)$.\nSo, $\\mu^{(x)}_{13} \\approx -0.115295$, $\\mu^{(y)}_{13} \\approx 0.089673$.\n\nPair $(2, 3)$ (H$_1$, H$_2$): $\\alpha_2=\\alpha_3=0.8$.\n$|\\mathbf{A}_2-\\mathbf{A}_3|^2 = (2 \\times 1.427)^2 = 8.145316$.\n$\\frac{\\alpha_2\\alpha_3}{\\alpha_2+\\alpha_3} = \\frac{0.8 \\times 0.8}{0.8+0.8} = 0.4$.\n$S_{23} = \\left(\\frac{2\\sqrt{0.8^2}}{1.6}\\right)^{3/2} \\exp(-0.4 \\times 8.145316) = \\exp(-3.2581264) \\approx 0.038460$.\n$\\mathbf{P}_{23} = \\frac{\\mathbf{A}_2+\\mathbf{A}_3}{2} = (0, 1.110, 0)$.\n$\\boldsymbol{\\mu}_{23} = \\langle \\chi_2 | \\mathbf{r} | \\chi_3 \\rangle = S_{23} \\mathbf{P}_{23} \\approx (0, 0.042691, 0)$.\nSo, $\\mu^{(x)}_{23} = 0$, $\\mu^{(y)}_{23} \\approx 0.042691$.\n\nThe AO dipole matrices are:\n$$\n\\boldsymbol{\\mu}^{(x)} \\approx \\begin{pmatrix} 0 & 0.115295 & -0.115295 \\\\ 0.115295 & 1.427 & 0 \\\\ -0.115295 & 0 & -1.427 \\end{pmatrix}, \\quad\n\\boldsymbol{\\mu}^{(y)} \\approx \\begin{pmatrix} 0 & 0.089673 & 0.089673 \\\\ 0.089673 & 1.110 & 0.042691 \\\\ 0.089673 & 0.042691 & 1.110 \\end{pmatrix}\n$$\n\nTask 2: Transformation to MO representation\n\nThe MO dipole integrals are computed as $\\langle\\phi_p|\\mathbf{r}|\\phi_q\\rangle = \\mathbf{C}_p^\\dagger \\boldsymbol{\\mu} \\mathbf{C}_q$.\nWe have $\\mathbf{C}_1 = (0.7209, 0.36045, 0.36045)^T$ and $\\mathbf{C}_2 = (0, 0.7209, -0.7209)^T$.\nLet $c = 0.7209$. Then $\\mathbf{C}_1 = (c, c/2, c/2)^T$ and $\\mathbf{C}_2 = (0, c, -c)^T$.\n\nDue to the $C_{2v}$ symmetry of the molecule and the symmetry properties of the MOs ($\\phi_1$ is of $A_1$ symmetry, $\\phi_2$ is of $B_2$ symmetry, in a coordinate system with $C_2$ along $y$), we can predict some integrals to be zero. Specifically, orbital centroids $\\mathbf{d}_p = \\langle\\phi_p|\\mathbf{r}|\\phi_p\\rangle$ must lie on the symmetry axis ($y$-axis), so their $x$-components are zero. The off-diagonal term $\\mathbf{r}_{12} = \\langle\\phi_1|\\mathbf{r}|\\phi_2\\rangle$ has a non-zero $x$-component and a zero $y$-component.\nLet us verify by calculation.\n$d_{1x} = \\mathbf{C}_1^T \\boldsymbol{\\mu}^{(x)} \\mathbf{C}_1 = 0$.\n$d_{2x} = \\mathbf{C}_2^T \\boldsymbol{\\mu}^{(x)} \\mathbf{C}_2 = 0$.\n$r_{12y} = \\mathbf{C}_1^T \\boldsymbol{\\mu}^{(y)} \\mathbf{C}_2 = 0$.\n\nThe non-zero components are:\n$d_{1y} = \\mathbf{C}_1^T \\boldsymbol{\\mu}^{(y)} \\mathbf{C}_1 \\approx 0.392731$.\n$d_{2y} = \\mathbf{C}_2^T \\boldsymbol{\\mu}^{(y)} \\mathbf{C}_2 \\approx 1.109339$.\n$r_{12x} = \\mathbf{C}_1^T \\boldsymbol{\\mu}^{(x)} \\mathbf{C}_2 \\approx 0.861448$.\n\nSo we have the MO dipole vectors:\n$\\mathbf{d}_1 \\approx (0, 0.392731, 0)$\n$\\mathbf{d}_2 \\approx (0, 1.109339, 0)$\n$\\mathbf{r}_{12} \\approx (0.861448, 0, 0)$\n\nTask 3: Optimization of the Jacobi Rotation Angle\n\nThe Boys localization objective is to maximize the sum of squared distances between orbital centroids, which for a two-orbital case is equivalent to maximizing the squared distance between the two new centroids, $G = |\\mathbf{d}_1' - \\mathbf{d}_2'|^2$. The transformation of orbitals is given by a rotation matrix $U(\\theta)$.\nThe centroids of the rotated orbitals $\\{\\phi_1', \\phi_2'\\}$ are:\n$\\mathbf{d}_1' = \\cos^2\\theta \\, \\mathbf{d}_1 + \\sin^2\\theta \\, \\mathbf{d}_2 + \\sin(2\\theta) \\, \\mathbf{r}_{12}$\n$\\mathbf{d}_2' = \\sin^2\\theta \\, \\mathbf{d}_1 + \\cos^2\\theta \\, \\mathbf{d}_2 - \\sin(2\\theta) \\, \\mathbf{r}_{12}$\nThe difference is:\n$\\mathbf{d}_1' - \\mathbf{d}_2' = (\\cos^2\\theta - \\sin^2\\theta)(\\mathbf{d}_1 - \\mathbf{d}_2) + 2\\sin(2\\theta)\\mathbf{r}_{12} = \\cos(2\\theta)(\\mathbf{d}_1 - \\mathbf{d}_2) + \\sin(2\\theta)(2\\mathbf{r}_{12})$.\nLet $\\mathbf{A} = \\mathbf{d}_1 - \\mathbf{d}_2$ and $\\mathbf{B} = 2\\mathbf{r}_{12}$.\n$G = |\\mathbf{A}\\cos(2\\theta) + \\mathbf{B}\\sin(2\\theta)|^2 = |\\mathbf{A}|^2\\cos^2(2\\theta) + |\\mathbf{B}|^2\\sin^2(2\\theta) + 2(\\mathbf{A}\\cdot\\mathbf{B})\\cos(2\\theta)\\sin(2\\theta)$.\nUsing trigonometric identities, this becomes:\n$G(\\theta) = \\frac{|\\mathbf{A}|^2 + |\\mathbf{B}|^2}{2} + \\frac{|\\mathbf{A}|^2 - |\\mathbf{B}|^2}{2} \\cos(4\\theta) + (\\mathbf{A}\\cdot\\mathbf{B}) \\sin(4\\theta)$.\nTo find the maximum, we set the derivative $dG/d\\theta = 0$:\n$\\frac{dG}{d\\theta} = -2(|\\mathbf{A}|^2 - |\\mathbf{B}|^2) \\sin(4\\theta) + 4(\\mathbf{A}\\cdot\\mathbf{B}) \\cos(4\\theta) = 0$.\nThis yields the well-known condition for the optimal angle:\n$$ \\tan(4\\theta) = \\frac{2(\\mathbf{A}\\cdot\\mathbf{B})}{|\\mathbf{A}|^2 - |\\mathbf{B}|^2} $$\nLet's compute the vectors $\\mathbf{A}$ and $\\mathbf{B}$ and their properties.\n$\\mathbf{A} = \\mathbf{d}_1 - \\mathbf{d}_2 \\approx (0, 0.392731 - 1.109339, 0) = (0, -0.716608, 0)$.\n$\\mathbf{B} = 2\\mathbf{r}_{12} \\approx (2 \\times 0.861448, 0, 0) = (1.722896, 0, 0)$.\nVector $\\mathbf{A}$ is aligned with the $y$-axis and vector $\\mathbf{B}$ is aligned with the $x$-axis. They are orthogonal.\n$\\mathbf{A} \\cdot \\mathbf{B} = 0$.\nThe condition simplifies to $\\tan(4\\theta) = 0$. This implies $4\\theta = n\\pi$ for some integer $n$.\nThe possible solutions are $\\theta = n\\pi/4$.\nTo determine which value of $n$ maximizes $G$, we examine the second derivative condition, which depends on the sign of $|\\mathbf{A}|^2 - |\\mathbf{B}|^2$. The term to be maximized is proportional to $\\frac{|\\mathbf{A}|^2 - |\\mathbf{B}|^2}{2} \\cos(4\\theta)$.\nLet's compute the coefficient:\n$|\\mathbf{A}|^2 \\approx (-0.716608)^2 \\approx 0.513527$.\n$|\\mathbf{B}|^2 \\approx (1.722896)^2 \\approx 2.96838$.\n$|\\mathbf{A}|^2 - |\\mathbf{B}|^2 \\approx 0.513527 - 2.96838 = -2.454853$.\nSince this coefficient is negative, we must choose $4\\theta$ such that $\\cos(4\\theta)$ is minimal, i.e., $\\cos(4\\theta) = -1$.\nThis occurs when $4\\theta = \\pi + 2n\\pi$. The simplest solution is for $n=0$, giving $4\\theta = \\pi$.\nThus, the optimal rotation angle is:\n$$ \\theta = \\frac{\\pi}{4} $$\nIn radians, this is $\\theta \\approx 0.785398163...$. Rounded to six significant figures, the result is $0.785398$.\n\nThe updated centroids are:\n$\\mathbf{d}_1' = \\frac{1}{2}(\\mathbf{d}_1+\\mathbf{d}_2) + \\mathbf{r}_{12} \\approx (0.861448, 0.751035, 0)$.\n$\\mathbf{d}_2' = \\frac{1}{2}(\\mathbf{d}_1+\\mathbf{d}_2) - \\mathbf{r}_{12} \\approx (-0.861448, 0.751035, 0)$.\nThese correspond to two localized orbitals resembling the two O-H bonds, which is the expected outcome of Boys localization.", "answer": "$$\\boxed{0.785398}$$", "id": "2913150"}, {"introduction": "This capstone exercise synthesizes theory and practice by guiding you through a complete, self-contained computational experiment on the formaldehyde molecule. You will implement an iterative Jacobi sweeps algorithm from scratch to perform both Boys and Pipek-Mezey localization, allowing for a direct comparison of their outcomes. By programming the optimization and classifying the resulting orbitals [@problem_id:2913119], you will gain a deep, practical understanding of how abstract molecular orbitals are transformed into the chemically intuitive concepts of bonds and lone pairs, solidifying the entire workflow from theoretical objective to tangible chemical insight.", "problem": "Implement from first principles a minimal, fully self-contained computational experiment to compare two orbital localization schemes, Boys and Pipek–Mezey, on a simplified model of formaldehyde. Work in a symmetrically orthogonalized atomic orbital basis so that the overlap matrix is the identity. Use the following physical model and computational tasks.\n\nFundamental base and definitions:\n- The occupied molecular orbital coefficient matrix is denoted by $C \\in \\mathbb{R}^{n_{\\mathrm{AO}} \\times n_{\\mathrm{occ}}}$ with orthonormal columns, representing the transformation from an orthonormal atomic orbital basis to occupied molecular orbitals.\n- For each orbital $i$, define its atomic-orbital population weights $w_{\\mu i} = |C_{\\mu i}|^2$. In the orthonormal atomic orbital basis, these satisfy $\\sum_{\\mu} w_{\\mu i} = 1$ for each $i$.\n- Given atomic positions $\\mathbf{R}_{\\mu} \\in \\mathbb{R}^3$ assigned to each atomic orbital $\\mu$, define the orbital centroid $\\langle \\mathbf{r} \\rangle_i = \\sum_{\\mu} w_{\\mu i} \\mathbf{R}_{\\mu}$ and the Boys objective $F_{\\mathrm{Boys}}(C) = \\sum_{i=1}^{n_{\\mathrm{occ}}} \\left\\| \\langle \\mathbf{r} \\rangle_i \\right\\|^2$. This follows from minimizing the sum of quadratic spreads while the term $\\sum_i \\langle r^2 \\rangle_i$ is invariant under unitary rotations within the occupied space.\n- Given a partition of atomic orbitals into atomic sets $A$, define the per-orbital atomic population $Q_{A,i} = \\sum_{\\mu \\in A} w_{\\mu i}$ and the Pipek–Mezey objective $F_{\\mathrm{PM}}(C) = \\sum_{i=1}^{n_{\\mathrm{occ}}} \\sum_{A} Q_{A,i}^2$, which increases when orbital charge is concentrated on one or two atoms.\n\nFormal model of formaldehyde (sigma system only):\n- Use $n_{\\mathrm{AO}} = 6$ orthonormal atomic orbitals associated to the nuclei with positions (in ångström) \n  - Oxygen at $\\mathbf{R}_{\\text{O}} = (-1.20, 0.00, 0.00)$,\n  - Carbon at $\\mathbf{R}_{\\text{C}} = (0.00, 0.00, 0.00)$,\n  - Hydrogen $1$ at $\\mathbf{R}_{\\text{H}_1} = (1.10, 0.90, 0.00)$,\n  - Hydrogen $2$ at $\\mathbf{R}_{\\text{H}_2} = (1.10, -0.90, 0.00)$.\n- Atomic orbitals and their centers:\n  1. $\\mu=0$: $\\text{O } 2s$ at $\\mathbf{R}_{\\text{O}}$,\n  2. $\\mu=1$: $\\text{O } 2p_x$ at $\\mathbf{R}_{\\text{O}}$,\n  3. $\\mu=2$: $\\text{C } 2s$ at $\\mathbf{R}_{\\text{C}}$,\n  4. $\\mu=3$: $\\text{C } 2p_x$ at $\\mathbf{R}_{\\text{C}}$,\n  5. $\\mu=4$: $\\text{H}_1\\,1s$ at $\\mathbf{R}_{\\text{H}_1}$,\n  6. $\\mu=5$: $\\text{H}_2\\,1s$ at $\\mathbf{R}_{\\text{H}_2}$.\n- Atomic sets for Pipek–Mezey: $\\text{O} = \\{0,1\\}$, $\\text{C} = \\{2,3\\}$, $\\text{H}_1=\\{4\\}$, $\\text{H}_2=\\{5\\}$.\n- Consider $n_{\\mathrm{occ}} = 4$ occupied $\\sigma$ orbitals. Construct a chemically motivated localized template $L \\in \\mathbb{R}^{6 \\times 4}$ before orthonormalization (columns are approximate chemical orbitals) as:\n  - Oxygen lone pair (largely $\\text{O } 2p_x$): $v_{\\text{LP}} = \\text{normalize}([0.20, 0.98, 0.00, 0.00, 0.00, 0.00])$,\n  - Carbon–oxygen $\\sigma$ bond: $v_{\\text{CO}} = \\text{normalize}([0.35, -0.35, 0.60, 0.60, 0.05, 0.05])$,\n  - Carbon–hydrogen $\\sigma$ bond to $\\text{H}_1$: $v_{\\text{CH}_1} = \\text{normalize}([0.00, 0.00, 0.50, 0.20, 0.80, 0.00])$,\n  - Carbon–hydrogen $\\sigma$ bond to $\\text{H}_2$: $v_{\\text{CH}_2} = \\text{normalize}([0.00, 0.00, 0.50, -0.20, 0.00, 0.80])$.\n- Orthonormalize the columns of $L$ (for example by a thin $QR$ decomposition) to obtain $L_{\\perp}$ with $L_{\\perp}^\\top L_{\\perp} = I_{4}$.\n\nOccupied “canonical” orbitals for three test cases:\n- From $L_{\\perp}$, obtain three different canonical sets $C^{(k)} = L_{\\perp} U^{(k)}$ by applying the following sequences of plane rotations $U^{(k)} \\in \\mathbb{R}^{4 \\times 4}$ within the occupied subspace. Each plane rotation acts on a pair of indices $(p,q)$ by an angle $\\theta$ via a right-multiplication by the $4 \\times 4$ identity with the $2 \\times 2$ block $\\begin{bmatrix}\\cos\\theta & \\sin\\theta\\\\ -\\sin\\theta & \\cos\\theta\\end{bmatrix}$ inserted on rows and columns $(p,q)$ (zero-based indices). Angles are given in degrees and must be interpreted in radians for computation.\n  - Case 1 (general mixing):\n    - Rotate $(0,1)$ by $25^\\circ$,\n    - Rotate $(2,3)$ by $-40^\\circ$,\n    - Rotate $(1,3)$ by $15^\\circ$,\n    - Rotate $(0,2)$ by $-20^\\circ$.\n  - Case 2 (near-degenerate mixing of C–H bonds):\n    - Rotate $(2,3)$ by $44^\\circ$,\n    - Rotate $(0,1)$ by $5^\\circ$.\n  - Case 3 (strong mixing of oxygen lone pair and C–O $\\sigma$):\n    - Rotate $(0,1)$ by $35^\\circ$,\n    - Rotate $(2,3)$ by $10^\\circ$,\n    - Rotate $(1,2)$ by $-12^\\circ$.\n\nLocalization tasks to implement:\n- Implement two localization procedures that, given $C$, produce a rotated $C_{\\mathrm{loc}} = C U$ with $U$ unitary in the occupied subspace:\n  1. Boys localization: maximize $F_{\\mathrm{Boys}}(C)$ as defined above, using only the centroid definition $\\langle \\mathbf{r} \\rangle_i = \\sum_{\\mu} |C_{\\mu i}|^2 \\mathbf{R}_{\\mu}$.\n  2. Pipek–Mezey localization: maximize $F_{\\mathrm{PM}}(C)$ as defined above, using $Q_{A,i} = \\sum_{\\mu \\in A} |C_{\\mu i}|^2$ over $A \\in \\{\\mathrm{O}, \\mathrm{C}, \\mathrm{H}_1, \\mathrm{H}_2\\}$.\n- For each method, perform iterative Jacobi sweeps over all orbital pairs $(p,q)$ with $p<q$. For each pair, optimize the rotation angle $\\theta \\in [-\\pi/2, \\pi/2]$ that maximizes the chosen objective restricted to the two-dimensional subspace spanned by orbitals $p$ and $q$. You must not use any closed-form “shortcut” update formulas; instead, perform a one-dimensional numerical maximization per pair (for example, a coarse grid search followed by a refinement grid around the best angle). Repeat sweeps until the total objective gain per sweep is less than $10^{-12}$ or a maximum of $50$ sweeps is reached.\n\nAssignment verification via classification:\n- For a given localized set $C_{\\mathrm{loc}}$, compute per-orbital atomic populations $P_{\\mathrm{O}}(i)$, $P_{\\mathrm{C}}(i)$, $P_{\\mathrm{H}_1}(i)$, $P_{\\mathrm{H}_2}(i)$ from the $|C_{\\mu i}|^2$ weights over the specified atomic sets. Classify each orbital into one of the following:\n  - Oxygen lone pair if $P_{\\mathrm{O}} \\ge 0.75$, $P_{\\mathrm{C}} \\le 0.20$, and $P_{\\mathrm{H}_1}+P_{\\mathrm{H}_2} \\le 0.20$.\n  - Carbon–oxygen $\\sigma$ bond if $P_{\\mathrm{O}} \\ge 0.25$, $P_{\\mathrm{C}} \\ge 0.25$, and $P_{\\mathrm{H}_1}+P_{\\mathrm{H}_2} \\le 0.20$.\n  - Carbon–hydrogen $\\sigma$ bond if $P_{\\mathrm{C}} \\ge 0.25$, $\\max(P_{\\mathrm{H}_1},P_{\\mathrm{H}_2}) \\ge 0.25$, $\\min(P_{\\mathrm{H}_1},P_{\\mathrm{H}_2}) \\le 0.12$, and $P_{\\mathrm{O}} \\le 0.20$.\n- Count how many orbitals fall into each category and verify whether the counts match the chemically expected assignment for formaldehyde’s $\\sigma$ system: one oxygen lone pair, one carbon–oxygen $\\sigma$ bond, and two carbon–hydrogen $\\sigma$ bonds.\n\nTest suite and required output:\n- For each of the three canonical-input cases $k=1,2,3$ defined above, run both localization methods independently and determine whether the classification counts equal $\\{1,1,2\\}$ in the order (oxygen lone pair, carbon–oxygen $\\sigma$, carbon–hydrogen $\\sigma$). Record two booleans per case: the first for Boys, the second for Pipek–Mezey.\n- Your program should produce a single line of output containing these six boolean results as a comma-separated list enclosed in square brackets and with no spaces, in the following order: $[\\mathrm{Boys\\_case1},\\mathrm{PM\\_case1},\\mathrm{Boys\\_case2},\\mathrm{PM\\_case2},\\mathrm{Boys\\_case3},\\mathrm{PM\\_case3}]$.\n\nAngle unit specification:\n- All angles must be handled internally in radians. The input rotation specifications for the test suite are given in degrees and must be converted to radians before use.\n\nPhysical units:\n- Atomic positions are provided in ångström for centroid calculations. No physical unit is required in the output booleans.\n\nDeliverables:\n- A complete, runnable program that constructs the model as specified, performs both localizations using pairwise one-dimensional angle optimizations, classifies the resulting orbitals, and prints the six booleans in the exact single-line format described above.", "solution": "The problem presented is a valid computational experiment in quantum chemistry. It is scientifically grounded, well-posed, and provides all necessary definitions, data, and constraints to construct a unique, verifiable solution. The task is to implement and compare two standard orbital localization schemes, Boys and Pipek–Mezey, on a simplified $\\sigma$-framework model of formaldehyde. The procedure involves constructing initial delocalized molecular orbitals (MOs), applying iterative optimization to localize them according to two different criteria, and finally classifying the resulting localized orbitals to check if they correspond to chemical intuition.\n\nThe core principle of orbital localization is to transform the delocalized canonical MOs, which are eigenfunctions of the Fock operator, into a new set of orbitals that are spatially localized and easier to interpret in terms of classical chemical concepts such as bonds, lone pairs, and core orbitals. This transformation is constrained to be a unitary rotation $U$ within the space of occupied orbitals, given by $C_{\\mathrm{loc}} = C U$. This constraint ensures that the total electronic density matrix, $\\rho = C C^T$, and thus all observable properties of the many-electron wavefunction, remain invariant. The choice of $U$ is determined by maximizing a specific objective function, $F(C_{\\mathrm{loc}})$, that quantifies the degree of localization.\n\nThe problem requires implementation of two such schemes:\n\n1.  **Boys Localization**: This method, also known as Boys-Foster localization, seeks to maximize the spatial separation of the orbital centroids. The objective function is given as $F_{\\mathrm{Boys}}(C) = \\sum_{i=1}^{n_{\\mathrm{occ}}} \\left\\| \\langle \\mathbf{r} \\rangle_i \\right\\|^2$, where the centroid of orbital $i$ is $\\langle \\mathbf{r} \\rangle_i = \\sum_{\\mu} |C_{\\mu i}|^2 \\mathbf{R}_{\\mu}$. Maximizing this sum is equivalent to maximizing the sum of squared distances between all pairs of centroids, $\\sum_{i<j} \\|\\langle \\mathbf{r} \\rangle_i - \\langle \\mathbf{r} \\rangle_j\\|^2$, as the sum of centroids $\\sum_i \\langle \\mathbf{r} \\rangle_i$ is an invariant of the rotation. The physical interpretation is that the resulting orbitals are made as compact and as far apart from each other as possible.\n\n2.  **Pipek–Mezey Localization**: This scheme aims to minimize the delocalization of orbitals over multiple atoms. It achieves this by maximizing the sum of squared atomic charges, $F_{\\mathrm{PM}}(C) = \\sum_{i=1}^{n_{\\mathrm{occ}}} \\sum_{A} Q_{A,i}^2$, where $Q_{A,i} = \\sum_{\\mu \\in A} |C_{\\mu i}|^2$ is the Mulliken population of orbital $i$ on atom $A$. By maximizing the sum of squares of these populations, the procedure encourages orbital charges to concentrate on a minimal number of atoms, which is the definition of localization in this context. A key feature of the Pipek–Mezey scheme is that it preserves the $\\sigma$-$\\pi$ separation in planar molecules, unlike the Boys scheme which can mix them.\n\nThe optimization of the objective functions is performed using an iterative Jacobi sweeps algorithm. The total unitary matrix $U$ is constructed as a product of simpler $2 \\times 2$ plane rotations, $U = \\prod_{k} G_k$. In each step of a sweep, a pair of orbitals $(p, q)$ is selected, and a rotation angle $\\theta$ is determined that maximizes the chosen objective function within this two-dimensional subspace. The corresponding orbital columns $p$ and $q$ of the coefficient matrix $C$ are updated as:\n$$\n\\begin{pmatrix} \\mathbf{c}'_p & \\mathbf{c}'_q \\end{pmatrix} = \\begin{pmatrix} \\mathbf{c}_p & \\mathbf{c}_q \\end{pmatrix} \\begin{pmatrix} \\cos\\theta & \\sin\\theta \\\\ -\\sin\\theta & \\cos\\theta \\end{pmatrix}\n$$\nThe problem specifies that the optimal angle $\\theta$ for each pair must be found via a one-dimensional numerical grid search rather than an analytical formula. This process is repeated for all unique pairs $(p<q)$ in a \"sweep,\" and sweeps are repeated until the improvement in the objective function per sweep falls below a convergence threshold of $10^{-12}$.\n\nThe solution procedure is as follows:\nFirst, the molecular geometry and atomic orbital (AO) basis are defined. A set of chemically intuitive, non-orthogonal \"template\" orbitals for formaldehyde's $\\sigma$ system is given. These are orthonormalized via a thin QR decomposition to yield an initial orthonormal MO coefficient matrix, $L_{\\perp}$.\n\nSecond, three distinct sets of delocalized \"canonical\" MOs, $C^{(k)}$, are generated by applying specified sequences of plane rotations to $L_{\\perp}$. These serve as the input test cases for the localization procedures.\n\nThird, for each test case $C^{(k)}$, both the Boys and Pipek–Mezey localization algorithms are executed. The core of this step is the Jacobi sweeps procedure, which involves an inner loop for the numerical grid search to find the optimal rotation angle $\\theta$ for each orbital pair.\n\nFinally, the resulting localized orbitals, $C_{\\mathrm{loc}}$, from each method and each case are analyzed. Their composition in terms of atomic populations is calculated and used to classify them as an oxygen lone pair, a carbon–oxygen $\\sigma$ bond, or a carbon–hydrogen $\\sigma$ bond, according to a set of predefined population thresholds. The success of a localization run is judged by whether the final set of orbitals contains exactly one oxygen lone pair, one C-O $\\sigma$ bond, and two C-H $\\sigma$ bonds, a result consistent with the Lewis structure of formaldehyde. The boolean outcomes of these checks for all six scenarios (3 cases $\\times$ 2 methods) constitute the final output.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Implements and compares Boys and Pipek-Mezey orbital localization schemes\n    for a simplified model of formaldehyde.\n    \"\"\"\n    # =========================================================================\n    # 1. MODEL SETUP\n    # =========================================================================\n    n_ao = 6\n    n_occ = 4\n\n    # Atomic positions (Angstrom)\n    R_atoms = np.array([\n        [-1.20, 0.00, 0.00],  # O (AO 0, 1)\n        [-1.20, 0.00, 0.00],  # O\n        [0.00, 0.00, 0.00],   # C (AO 2, 3)\n        [0.00, 0.00, 0.00],   # C\n        [1.10, 0.90, 0.00],   # H1 (AO 4)\n        [1.10, -0.90, 0.00]   # H2 (AO 5)\n    ])\n\n    # Atomic sets for Pipek-Mezey\n    atomic_sets = {\n        'O': [0, 1],\n        'C': [2, 3],\n        'H1': [4],\n        'H2': [5],\n    }\n\n    # =========================================================================\n    # 2. INITIAL ORBITALS CONSTRUCTION\n    # =========================================================================\n    def normalize(v):\n        norm = np.linalg.norm(v)\n        return v / norm if norm > 0 else v\n\n    # Localized template matrix L (unnormalized)\n    v_lp = normalize([0.20, 0.98, 0.00, 0.00, 0.00, 0.00])\n    v_co = normalize([0.35, -0.35, 0.60, 0.60, 0.05, 0.05])\n    v_ch1 = normalize([0.00, 0.00, 0.50, 0.20, 0.80, 0.00])\n    v_ch2 = normalize([0.00, 0.00, 0.50, -0.20, 0.00, 0.80])\n    L = np.column_stack([v_lp, v_co, v_ch1, v_ch2])\n\n    # Orthonormalize L using thin QR decomposition\n    L_perp, _ = np.linalg.qr(L)\n\n    # =========================================================================\n    # 3. GENERATE TEST CASES\n    # =========================================================================\n    def get_rotation_matrix(p, q, angle_deg, size):\n        angle_rad = math.radians(angle_deg)\n        c, s = math.cos(angle_rad), math.sin(angle_rad)\n        U = np.identity(size)\n        U[p, p] = c\n        U[p, q] = s\n        U[q, p] = -s\n        U[q, q] = c\n        return U\n\n    rotations_spec = {\n        1: [ (0, 1, 25), (2, 3, -40), (1, 3, 15), (0, 2, -20) ],\n        2: [ (2, 3, 44), (0, 1, 5) ],\n        3: [ (0, 1, 35), (2, 3, 10), (1, 2, -12) ]\n    }\n    \n    test_cases = []\n    for k in range(1, 4):\n        U_total = np.identity(n_occ)\n        for p, q, angle in rotations_spec[k]:\n            U_rot = get_rotation_matrix(p, q, angle, n_occ)\n            U_total = U_total @ U_rot\n        C_k = L_perp @ U_total\n        test_cases.append(C_k)\n\n    # =========================================================================\n    # 4. OBJECTIVE FUNCTIONS\n    # =========================================================================\n    def boys_objective(C):\n        W = C**2  # w_mui = |C_mui|^2\n        centroids = W.T @ R_atoms  # (n_occ, 3) matrix of centroids\n        return np.sum(np.linalg.norm(centroids, axis=1)**2)\n\n    def pm_objective(C):\n        W = C**2\n        total_obj = 0\n        for i in range(n_occ):\n            for atom_indices in atomic_sets.values():\n                Q_Ai = np.sum(W[atom_indices, i])\n                total_obj += Q_Ai**2\n        return total_obj\n\n    # =========================================================================\n    # 5. LOCALIZATION PROCEDURE\n    # =========================================================================\n    def localize(C_initial, objective_func, max_sweeps=50, tol=1e-12):\n        C_loc = C_initial.copy()\n        \n        current_obj = objective_func(C_loc)\n\n        for sweep in range(max_sweeps):\n            old_obj = current_obj\n            \n            for p in range(n_occ):\n                for q in range(p + 1, n_occ):\n                    \n                    def get_pair_objective(angle):\n                        c, s = np.cos(angle), np.sin(angle)\n                        C_pair_rotated = np.zeros((n_ao, 2))\n                        C_pair_rotated[:, 0] = C_loc[:, p] * c - C_loc[:, q] * s\n                        C_pair_rotated[:, 1] = C_loc[:, p] * s + C_loc[:, q] * c\n                        \n                        C_temp = C_loc.copy()\n                        C_temp[:, p] = C_pair_rotated[:, 0]\n                        C_temp[:, q] = C_pair_rotated[:, 1]\n                        \n                        return objective_func(C_temp)\n\n                    # Coarse grid search\n                    angles_coarse = np.linspace(-np.pi / 2, np.pi / 2, 101)\n                    obj_values_coarse = [get_pair_objective(a) for a in angles_coarse]\n                    best_angle_idx_coarse = np.argmax(obj_values_coarse)\n                    best_angle_coarse = angles_coarse[best_angle_idx_coarse]\n\n                    # Refinement grid search\n                    angle_step = np.pi / 100\n                    angles_fine = np.linspace(best_angle_coarse - angle_step, \n                                              best_angle_coarse + angle_step, 101)\n                    obj_values_fine = [get_pair_objective(a) for a in angles_fine]\n                    best_angle_idx_fine = np.argmax(obj_values_fine)\n                    best_angle = angles_fine[best_angle_idx_fine]\n                    \n                    # Apply the rotation if angle is non-trivial\n                    if abs(best_angle) > 1e-12:\n                        c, s = np.cos(best_angle), np.sin(best_angle)\n                        c_p = C_loc[:, p].copy()\n                        c_q = C_loc[:, q].copy()\n                        C_loc[:, p] = c_p * c - c_q * s\n                        C_loc[:, q] = c_p * s + c_q * c\n            \n            current_obj = objective_func(C_loc)\n            if abs(current_obj - old_obj) < tol:\n                break\n        \n        return C_loc\n\n    # =========================================================================\n    # 6. CLASSIFICATION PROCEDURE\n    # =========================================================================\n    def classify_orbitals(C_loc):\n        W = C_loc**2\n        \n        populations = {}\n        for atom, indices in atomic_sets.items():\n            populations[atom] = np.sum(W[indices, :], axis=0)\n\n        counts = {'LP': 0, 'CO': 0, 'CH': 0}\n        \n        for i in range(n_occ):\n            P_O = populations['O'][i]\n            P_C = populations['C'][i]\n            P_H1 = populations['H1'][i]\n            P_H2 = populations['H2'][i]\n            \n            # Oxygen lone pair\n            if P_O >= 0.75 and P_C <= 0.20 and (P_H1 + P_H2) <= 0.20:\n                counts['LP'] += 1\n            # Carbon-oxygen sigma bond\n            elif P_O >= 0.25 and P_C >= 0.25 and (P_H1 + P_H2) <= 0.20:\n                counts['CO'] += 1\n            # Carbon-hydrogen sigma bond\n            elif P_C >= 0.25 and max(P_H1, P_H2) >= 0.25 and min(P_H1, P_H2) <= 0.12 and P_O <= 0.20:\n                counts['CH'] += 1\n        \n        return (counts['LP'], counts['CO'], counts['CH'])\n\n    # =========================================================================\n    # 7. MAIN EXECUTION LOOP\n    # =========================================================================\n    results = []\n    target_counts = (1, 1, 2)\n    \n    objective_functions = {\n        \"Boys\": boys_objective,\n        \"PM\": pm_objective\n    }\n\n    for C_k in test_cases:\n        # Boys Localization\n        C_boys = localize(C_k, objective_functions[\"Boys\"])\n        counts_boys = classify_orbitals(C_boys)\n        results.append(counts_boys == target_counts)\n        \n        # Pipek-Mezey Localization\n        C_pm = localize(C_k, objective_functions[\"PM\"])\n        counts_pm = classify_orbitals(C_pm)\n        results.append(counts_pm == target_counts)\n\n    # =========================================================================\n    # 8. FINAL OUTPUT\n    # =========================================================================\n    output_str = ','.join(map(str, results))\n    print(f\"[{output_str}]\")\n\nsolve()\n```", "id": "2913119"}]}