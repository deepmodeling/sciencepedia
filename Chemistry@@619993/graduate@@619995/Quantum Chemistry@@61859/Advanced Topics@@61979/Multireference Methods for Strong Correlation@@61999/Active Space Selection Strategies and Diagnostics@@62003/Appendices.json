{"hands_on_practices": [{"introduction": "A common hurdle in applying multireference methods is achieving convergence in the self-consistent field (SCF) procedure. This exercise [@problem_id:2452691] simulates a realistic scenario of a non-converging CASSCF calculation and prompts you to develop a systematic troubleshooting guide. Mastering this checklist is a crucial first step, as it addresses the most frequent issues related to the initial setup: the proper definition of the active space and the quality of the initial guess wave function.", "problem": "A researcher runs a Complete Active Space Self-Consistent Field (CASSCF) calculation to describe a valence multireference state of a small polyatomic molecule. The energy oscillates and the macroiterations do not converge. The researcher wants to apply a systematic checklist restricted to issues related to the chosen active space and to the initial guess for orbitals and configuration interaction (CI) coefficients. Which of the following items belong on such a focused checklist?\n\nA. Inspect orbitals and natural occupation numbers from a preliminary correlated calculation or a small trial active space to verify that all near-degenerate valence orbitals with occupations significantly different from $0$ or $2$ are included; add corresponding bonding/antibonding partners to maintain a balanced active space.\n\nB. Start from a closed-shell restricted Hartree–Fock (HF) guess and enforce doubly occupied occupations for all active orbitals in the initial CI vector to prevent spin contamination, relaxing those occupations only after convergence.\n\nC. If targeting an excited state close in energy to the ground state, construct an initial guess that reflects the desired state (for example, promote an electron within the intended active orbitals) or use state-averaged Complete Active Space Self-Consistent Field (SA-CASSCF) over several roots of the same symmetry with equal weights to avoid root flipping.\n\nD. Increase the active space by adding all virtual orbitals below a chosen energy cutoff without regard to chemical character; this always improves CASSCF convergence by giving the optimizer more freedom.\n\nE. Localize and reorder orbitals so that chemically intuitive valence orbitals form a contiguous active block with the correct irreducible representations for the symmetry employed; verify that the numbers of active electrons $n_{\\mathrm{e}}$ and active orbitals $n_{\\mathrm{o}}$ match the intended $(n_{\\mathrm{e}}, n_{\\mathrm{o}})$.\n\nF. Tighten integral thresholds and enlarge any density-fitting auxiliary basis; if convergence still fails, the cause must be numerical rather than related to active space or initial guess.", "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n- **System**: A small polyatomic molecule.\n- **Method**: Complete Active Space Self-Consistent Field (CASSCF).\n- **Target**: A valence multireference state.\n- **Problem**: The CASSCF calculation does not converge; energy oscillates during macroiterations.\n- **Task**: Identify which items belong on a systematic checklist for troubleshooting this issue.\n- **Constraint**: The checklist must be \"restricted to issues related to the chosen active space and to the initial guess for orbitals and configuration interaction (CI) coefficients.\"\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem is scientifically sound. CASSCF is a cornerstone method for treating static (multireference) electron correlation. Non-convergence, often manifested as energy oscillations, is a frequent and well-documented difficulty in practical applications. The causes mentioned—improper active space selection and poor initial guess—are primary reasons for such failures. The context is firmly rooted in standard computational quantum chemistry practice.\n- **Well-Posedness**: The question is well-posed. It asks to select valid troubleshooting procedures from a given list, based on a clear and specific constraint (focus on active space and initial guess). A definite set of correct and incorrect options can be determined.\n- **Objectivity**: The problem is objective. The effectiveness of the listed procedures is not a matter of opinion but is based on the mathematical structure of the CASSCF method and extensive empirical evidence from the scientific community.\n\n**Step 3: Verdict and Action**\nThe problem statement is valid. It is scientifically grounded, well-posed, objective, and presents a realistic scenario in computational chemistry. I will proceed to the solution.\n\nThe analysis will now evaluate each option based on its validity as a troubleshooting step for CASSCF convergence, adhering to the constraint that the step must relate to the active space or the initial guess.\n\n**Option A Evaluation**\nThis option proposes to inspect orbitals and their natural occupation numbers (NOONs) from a preliminary, less expensive correlated calculation (such as Møller–Plesset perturbation theory of second order, MP2) or a smaller trial CASSCF. The goal is to identify near-degenerate orbitals with occupations deviating significantly from the closed-shell values of $2$ or $0$. It also suggests including corresponding bonding/antibonding pairs. This is the canonical and most fundamental approach to constructing a physically meaningful active space. An active space that omits a crucial, partially occupied orbital is incorrectly defined and is a primary cause of convergence failure. The concept of a \"balanced\" active space, such as including a $\\sigma^*$ orbital for every active $\\sigma$ orbital when describing bond dissociation, is essential for the wavefunction to have the correct flexibility. This procedure directly addresses the \"chosen active space\" and is a cornerstone of sound CASSCF methodology.\n**Verdict: Correct**\n\n**Option B Evaluation**\nThis option suggests starting from a Restricted Hartree-Fock (RHF) guess and, critically, enforcing doubly occupied configurations for all active orbitals in the initial CI vector. This is fundamentally misguided. A CASSCF calculation is performed precisely because the system is multireference, meaning the single RHF determinant is a poor approximation and multiple configurations are important. Forcing the initial CI vector to be a single, closed-shell determinant provides a very poor starting point, often far away from the true solution in the variational space, which can induce severe convergence problems or lead to convergence to an incorrect state. The justification provided, \"to prevent spin contamination,\" is also incorrect; the CASSCF wavefunction is, by construction, an eigenfunction of the total spin operator $\\hat{S}^2$ and should be spin-pure. Spin contamination is an issue characteristic of unrestricted single-determinant methods like UHF, not CASSCF.\n**Verdict: Incorrect**\n\n**Option C Evaluation**\nThis option addresses the common and difficult case of targeting an excited state that is close in energy to other states. It proposes two strategies. First, to construct an initial guess that reflects the character of the desired excited state, for example by performing orbital rotations on the initial guess orbitals to mimic an electronic promotion. This is a crucial technique for guiding the optimizer toward a specific higher-energy root instead of the ground state. Second, it suggests using a state-averaged (SA-CASSCF) approach, where the orbital optimization is performed for a weighted average of several electronic states. This is the standard and most robust method for treating near-degenerate states of the same symmetry, as it prevents \"root flipping\"—a classic convergence pathology where the identity of the target state changes from one iteration to the next, causing energy oscillations. Both strategies are directly related to constructing a proper initial guess (for the CI vector and orbitals) to solve convergence issues.\n**Verdict: Correct**\n\n**Option D Evaluation**\nThis option suggests blindly increasing the active space by including all virtual orbitals below some energy cutoff, irrespective of their chemical nature. The claim is that this \"always improves CASSCF convergence.\" This is a profoundly incorrect statement and a dangerous practice. While the variational principle dictates that a larger active space will yield a lower or equal energy, it in no way guarantees or even promotes convergence. An active space must be constructed with chemical and physical insight. Adding numerous irrelevant orbitals introduces vast, unnecessary complexity and often creates a much more difficult optimization problem, leading to convergence failure. The active space can become contaminated with, for instance, diffuse Rydberg character when one is interested only in valence phenomena. The claim that this \"always\" improves convergence is patently false.\n**Verdict: Incorrect**\n\n**Option E Evaluation**\nThis option describes several practical, preparatory steps. First, localizing and reordering orbitals to form a contiguous active block. This is a technical necessity for most quantum chemistry programs, which require the user to specify the active space as a range of orbital indices. Orbitals from a preliminary calculation are typically ordered by energy, so the chemically relevant active orbitals might be scattered. Reordering them is essential. Second, ensuring the orbitals have the correct irreducible representations (irreps) for the target state's symmetry. An incorrect symmetry assignment for an orbital in the active space will make it impossible to construct the desired state and will guarantee failure. Third, verifying the number of active electrons, $n_{\\mathrm{e}}$, and active orbitals, $n_{\\mathrm{o}}$. This is a simple but critical sanity check, as a typo in these fundamental parameters is a common and elementary error. All these steps are part of correctly defining the active space and preparing the initial guess orbitals.\n**Verdict: Correct**\n\n**Option F Evaluation**\nThis option proposes to tighten numerical parameters, such as integral thresholds and auxiliary basis sets for density fitting. While loose numerical settings can indeed cause convergence problems, this option violates the explicit constraint of the problem, which is to focus *only* on the active space and initial guess. These are parameters related to the numerical machinery and precision of the calculation, not the physical model itself. Furthermore, the concluding statement, \"if convergence still fails, the cause must be numerical rather than related to active space or initial guess,\" is a severe logical error. A fundamentally flawed model (e.g., an incorrect active space) cannot be fixed by any amount of numerical tightening. In fact, convergence problems are far more often due to a poor choice of active space than to numerical thresholds, assuming reasonable default settings are used.\n**Verdict: Incorrect**", "answer": "$$\\boxed{ACE}$$", "id": "2452691"}, {"introduction": "Even when a CASSCF calculation converges, the result may not be physically meaningful if the active space is poorly chosen. The variational principle provides powerful diagnostic clues within the results themselves, and learning to read them is an essential skill. This problem [@problem_id:2631321] challenges you to interpret two key signals—natural orbital occupation numbers (NOONs) drifting to integer values and large orbital-rotation gradients—to diagnose an unbalanced active space and select the appropriate remedy.", "problem": "A Complete Active Space Self-Consistent Field (CASSCF) calculation is performed on a conjugated open-shell system using an initial active space of CAS($6,6$), chosen to include three nominally bonding $\\pi$ orbitals and three nominally antibonding $\\pi^*$ orbitals. During macroiterations of the orbital optimization, the natural orbital occupation numbers (NOONs) within the active subspace evolve as follows (sorted in descending order within the active block): at iteration $k=1$ they are $\\{1.80, 1.20, 1.10, 0.90, 0.55, 0.45\\}$, and by $k=20$ they have become $\\{1.98, 1.90, 1.05, 0.95, 0.12, 0.02\\}$. You also observe that the largest orbital-rotation gradients at convergence couple one active orbital with a nearby $\\pi$-type external (virtual) orbital localized on an adjacent fragment.\n\nUse the following principles and facts as your starting point: (i) the one-electron reduced density matrix $\\gamma_{pq} = \\langle \\Psi | \\hat{a}^{\\dagger}_q \\hat{a}_p | \\Psi \\rangle$ of a multiconfigurational wave function $|\\Psi\\rangle$ has eigenvectors (natural orbitals) with eigenvalues (NOONs) $n_i$ satisfying $0 \\le n_i \\le 2$; (ii) in a balanced CASSCF active space, orbitals that carry strong static correlation exhibit $n_i$ significantly different from the limiting values $0$ and $2$, whereas orbitals behaving as inactive (doubly occupied) or secondary (unoccupied) tend toward $n_i \\approx 2$ and $n_i \\approx 0$, respectively; and (iii) the CASSCF energy is variationally minimized with respect to both configuration interaction coefficients within the active space and orbital rotations between inactive, active, and virtual subspaces.\n\nBased solely on these facts and the numerical behavior given above, which of the following diagnoses and remedies are most appropriate for this calculation?\n\nA. The active space is unbalanced: at least one included active orbital is effectively inactive with $n_i \\to 2$ and another is effectively secondary with $n_i \\to 0$. Remedy by enlarging the active space to include the strongly coupled external orbital and, if desired, by removing orbitals that consistently drift to the extremes.\n\nB. The problem is a lack of dynamic correlation only. Remedy by proceeding to Complete Active Space Second-Order Perturbation Theory (CASPT2) without changing the active space.\n\nC. The issue is state-specific bias. Remedy by switching to State-Averaged Complete Active Space Self-Consistent Field (SA-CASSCF) over multiple roots while keeping the same active space.\n\nD. The orbital optimization is over-rotating. Remedy by increasing the level shift or otherwise freezing rotations between active and external orbitals to suppress the drift of NOONs.\n\nE. The active space assignment is suboptimal. Remedy by reassigning the nearly doubly occupied orbital to the inactive space and the nearly empty orbital to the secondary space, while bringing in the strongly interacting external $\\pi$ orbital(s), potentially moving to CAS($8,8$) or using a Restricted Active Space Self-Consistent Field (RASSCF) partition to target the statically correlated subset.\n\nF. The behavior is due to numerical noise. Remedy by tightening integral thresholds (for example, to $10^{-12}$) while keeping the same active space.\n\nG. The initial guess was too single-reference-like. Remedy by initializing with natural orbitals from a second-order Møller–Plesset (MP2) calculation on the closed-shell reference and keeping the same active space.\n\nSelect all that apply.", "solution": "The problem statement is subjected to validation.\n\n**Givens:**\n1.  **Method**: Complete Active Space Self-Consistent Field (CASSCF).\n2.  **System**: Conjugated open-shell system.\n3.  **Active Space**: CAS($6,6$), with $6$ electrons in $6$ orbitals, initially chosen as three $\\pi$ and three $\\pi^*$ orbitals.\n4.  **Natural Orbital Occupation Numbers (NOONs)** at iteration $k=1$: $\\{1.80, 1.20, 1.10, 0.90, 0.55, 0.45\\}$. The sum is $1.80 + 1.20 + 1.10 + 0.90 + 0.55 + 0.45 = 6.00$, consistent with $6$ active electrons.\n5.  **NOONs** at iteration $k=20$: $\\{1.98, 1.90, 1.05, 0.95, 0.12, 0.02\\}$. The sum of these numbers is $1.98 + 1.90 + 1.05 + 0.95 + 0.12 + 0.02 = 6.02$. Strictly, the sum of NOONs in the active space must equal the number of active electrons, which is $6$. The value $6.02$ represents a minor inconsistency, likely due to rounding in the problem statement. It does not alter the qualitative interpretation.\n6.  **Orbital Gradient Observation**: At convergence, the largest orbital-rotation gradients couple an active orbital with an external (virtual) $\\pi$-type orbital.\n7.  **Principle (i)**: Definition of natural orbitals and NOONs, with eigenvalues $n_i$ satisfying $0 \\le n_i \\le 2$.\n8.  **Principle (ii)**: Interpretation of NOONs: $n_i$ values far from $0$ and $2$ indicate strong static correlation. Values near $2$ indicate inactive (doubly occupied) character, and values near $0$ indicate secondary (unoccupied) character.\n9.  **Principle (iii)**: CASSCF is a variational method, minimizing energy with respect to both CI coefficients and orbital rotations.\n\n**Validation Verdict:**\nThe problem is scientifically grounded, well-posed, and objective. The minor numerical inconsistency in the sum of converged NOONs is noted but does not invalidate the problem, as the qualitative behavior is the focus of the question. The problem is **valid**.\n\n**Solution Derivation:**\nThe provided information allows for a clear diagnosis of the state of the CASSCF calculation.\n\n1.  **Analysis of NOONs**: According to principle (ii), the converged NOONs $\\{1.98, 1.90, 1.05, 0.95, 0.12, 0.02\\}$ reveal an unbalanced active space.\n    *   Two orbitals have NOONs $1.98$ and $1.90$, which are very close to the maximum value of $2$. These orbitals are behaving as nearly inactive (doubly occupied) and contribute little to the static correlation.\n    *   Two orbitals have NOONs $1.05$ and $0.95$. These are far from $0$ and $2$, indicating that these orbitals are strongly statically correlated and form the core of the multireference character.\n    *   Two orbitals have NOONs $0.12$ and $0.02$, which are very close to $0$. These orbitals are behaving as nearly secondary (unoccupied/virtual).\n    *   The orbital optimization, in its search for the lowest energy, has partitioned the initial active space into a set of core correlated orbitals and a set of orbitals that are essentially inactive or virtual. This means the initial choice of CAS($6,6$) was not optimal for describing the static correlation.\n\n2.  **Analysis of Orbital Gradients**: According to principle (iii), the CASSCF energy is minimized with respect to orbital rotations. A converged calculation should have near-zero gradients for all orbital rotations. The observation of a large gradient for rotation between an active and an external orbital indicates that the energy is not minimized with respect to this mixing. The variational principle is signaling that the total energy can be lowered by including character from this external orbital into the active space. This means an important orbital for describing the system's electronic structure is currently outside the chosen active space.\n\n3.  **Combined Diagnosis**: The two pieces of evidence are complementary. The NOONs show that some orbitals *inside* the active space are not strongly correlated. The orbital gradients show that an orbital *outside* the active space *is* important. The correct interpretation is that the initial CAS($6,6$) active space is suboptimal. The CASSCF procedure is attempting to correct this by pushing some orbitals out (to NOONs of $\\approx 2$ and $\\approx 0$) and indicating that another orbital should be brought in. The fundamental problem is with the definition of the active space itself.\n\n**Evaluation of Options:**\n\n**A. The active space is unbalanced: at least one included active orbital is effectively inactive with $n_i \\to 2$ and another is effectively secondary with $n_i \\to 0$. Remedy by enlarging the active space to include the strongly coupled external orbital and, if desired, by removing orbitals that consistently drift to the extremes.**\nThis diagnosis is entirely correct. The NOONs ($1.98$ and $0.02$) confirm the presence of effectively inactive and secondary orbitals. The remedy—including the important external orbital (as indicated by the gradient) and removing the drifting orbitals—is the standard and correct procedure for refining a sub-optimal active space.\n**Verdict: Correct**\n\n**B. The problem is a lack of dynamic correlation only. Remedy by proceeding to Complete Active Space Second-Order Perturbation Theory (CASPT2) without changing the active space.**\nThis is incorrect. The issues identified—NOONs drifting to integer values and large orbital gradients—are characteristic of a poor description of *static* correlation by the CASSCF reference wavefunction. CASPT2 is a method to add dynamic correlation on top of a CASSCF reference. Applying it to a flawed reference wavefunction is not a valid procedure and will yield unreliable results.\n**Verdict: Incorrect**\n\n**C. The issue is state-specific bias. Remedy by switching to State-Averaged Complete Active Space Self-Consistent Field (SA-CASSCF) over multiple roots while keeping the same active space.**\nThis is not the primary issue. State-averaging is used to find a balanced orbital set for multiple electronic states. The evidence here points to a poorly chosen set of orbitals for describing even a single state. Switching to SA-CASSCF would not fix the fundamental problem that an important orbital is missing from the space and unimportant ones are included.\n**Verdict: Incorrect**\n\n**D. The orbital optimization is over-rotating. Remedy by increasing the level shift or otherwise freezing rotations between active and external orbitals to suppress the drift of NOONs.**\nThis is a profound misunderstanding of the method. The large rotations and NOON drift are not numerical artifacts to be suppressed; they are diagnostic signals from the variational principle telling us how to improve the wavefunction. Using a level shift or freezing rotations would artificially prevent the optimization from finding the correct, lower-energy solution and would result in a converged wavefunction of poorer quality. One must follow the direction the gradient indicates, not suppress it.\n**Verdict: Incorrect**\n\n**E. The active space assignment is suboptimal. Remedy by reassigning the nearly doubly occupied orbital to the inactive space and the nearly empty orbital to the secondary space, while bringing in the strongly interacting external $\\pi$ orbital(s), potentially moving to CAS($8,8$) or using a Restricted Active Space Self-Consistent Field (RASSCF) partition to target the statically correlated subset.**\nThis is an excellent and detailed diagnosis and remedy. The term \"suboptimal assignment\" is precise. The remedy correctly describes the process of orbital reassignment (swapping unimportant ones out and important ones in). It also suggests concrete and appropriate advanced strategies, such as expanding the space to CAS($8,8$) if a new pair of correlated orbitals is identified, or using the more flexible RASSCF method to partition the orbitals. This option demonstrates a high level of understanding.\n**Verdict: Correct**\n\n**F. The behavior is due to numerical noise. Remedy by tightening integral thresholds (for example, to $10^{-12}$) while keeping the same active space.**\nThe observed behavior is systematic and has a clear physical interpretation based on the principles of CASSCF. It is not random noise. Tightening computational thresholds will not fix a fundamental error in the active space model; it would just converge more tightly to the same physically incorrect description.\n**Verdict: Incorrect**\n\n**G. The initial guess was too single-reference-like. Remedy by initializing with natural orbitals from a second-order Møller–Plesset (MP2) calculation on the closed-shell reference and keeping the same active space.**\nThe initial guess affects the convergence path, but not the final variationally optimized solution for a given active space. The calculation has proceeded for $20$ iterations and is showing the properties of the converged (or near-converged) state. The problem is with the definition of the active space itself, not the starting point of the optimization. Changing the initial guess will not add a missing orbital to the active space.\n**Verdict: Incorrect**\n\nBoth options A and E provide a correct diagnosis and remedy. Option E is more specific and comprehensive than option A, but both are fundamentally correct. Therefore, both should be selected.", "answer": "$$\\boxed{AE}$$", "id": "2631321"}, {"introduction": "Manually selecting an active space requires significant chemical intuition and can become intractable for large, complex molecules. This has led to the development of automated protocols that codify selection principles into algorithms. In this hands-on coding exercise [@problem_id:2872260], you will implement and compare three prominent selection strategies—AVAS, UNO-CAS, and AutoCAS—using simplified but conceptually representative models. This practice will demystify these \"black-box\" methods by revealing the distinct criteria they use to build an active space.", "problem": "Consider three programmatic strategies for selecting active spaces in multireference quantum chemistry: Atomic Valence Active Space (AVAS), Unrestricted Natural Orbital Complete Active Space (UNO-CAS), and Automated Complete Active Space (AutoCAS). Your task is to implement a comparison study of these strategies on the same synthetic metal–ligand complex instances, using mathematically defined data and diagnostics derived from standard definitions in quantum chemistry. The selection criteria and evaluation must be derived from first principles and well-tested definitions.\n\nBase definitions to be used:\n- Let $N$ denote the number of spatial molecular orbitals. Let the index set be $\\{0,1,\\dots,N-1\\}$.\n- AVAS selection is based on the projection of molecular orbitals onto a chosen valence atomic orbital subspace. For orbital $i$, define the projected weight $w_i$ as the squared norm of its projection onto the target valence subspace. AVAS selects orbitals with $w_i \\ge T_{\\mathrm{AVAS}}$, where $T_{\\mathrm{AVAS}}$ is a fixed threshold in the interval $[0,1]$.\n- UNO-CAS selection uses Unrestricted Natural Orbitals obtained from the spin-resolved one-particle reduced density matrix. Let $n_i$ be the spatial natural occupation number of orbital $i$ in the range $[0,2]$. UNO-CAS selects orbitals whose occupations significantly deviate from the closed-shell limits, using the criterion $\\min\\{n_i, 2-n_i\\} > \\tau_{\\mathrm{UNO}}$, where $\\tau_{\\mathrm{UNO}}$ is a small positive threshold.\n- AutoCAS selection uses an entanglement-based diagnostic. Let $s_i$ denote the single-orbital entropy of orbital $i$, derived from the one-orbital reduced density matrix eigenvalues. AutoCAS selects orbitals with $s_i \\ge \\tau_{s}$, where $\\tau_s$ is a specified threshold.\n\nBenchmark property model:\n- Let the target property be a lowest singlet excitation energy specified in electronvolts. For a chosen active set $A \\subseteq \\{0,\\dots,N-1\\}$, define a simple, self-consistent surrogate for the predicted property as\n$$\nE_{\\mathrm{pred}}(A) \\;=\\; E_{\\mathrm{MF}} \\;-\\; \\sum_{i \\in A} c_i \\;+\\; \\sum_{\\substack{i<j\\\\ i,j \\in A}} \\kappa_{ij},\n$$\nwhere $E_{\\mathrm{MF}}$ is a mean-field baseline in electronvolts, $c_i \\ge 0$ are per-orbital correlation corrections in electronvolts, and $\\kappa_{ij} \\ge 0$ are pairwise synergy penalties in electronvolts when both $i$ and $j$ are included. The absolute prediction error is $|E_{\\mathrm{pred}}(A) - E_{\\mathrm{bench}}|$ in electronvolts, where $E_{\\mathrm{bench}}$ is a provided benchmark excitation energy in electronvolts.\n\nConsistency diagnostic:\n- Given two active sets $A$ and $B$, define the Jaccard index as\n$$\nJ(A,B) \\;=\\; \\frac{|A \\cap B|}{|A \\cup B|},\n$$\nwith the convention that if both sets are empty, $J(A,B)=1$. The consistency across the three strategies is quantified by the average of the three pairwise Jaccard indices.\n\nImplement a program that, for each test case, constructs the three active sets using the definitions above with fixed thresholds, computes the three absolute errors against the benchmark property, and computes the average pairwise Jaccard consistency.\n\nUse the following globally fixed thresholds:\n- $T_{\\mathrm{AVAS}} = 0.20$ (dimensionless),\n- $\\tau_{\\mathrm{UNO}} = 0.02$ (dimensionless),\n- $\\tau_{s} = 0.10$ (dimensionless).\n\nUse the following three test cases. All arrays are indexed by orbital $i$ in ascending order. All energies must be treated in electronvolts.\n\nTest case $1$:\n- $N=8$.\n- AVAS projected weights $w = [0.80, 0.75, 0.40, 0.35, 0.10, 0.15, 0.05, 0.02]$.\n- UNO natural occupations $n = [1.20, 0.80, 1.05, 0.95, 1.98, 0.02, 2.00, 0.00]$.\n- AutoCAS single-orbital entropies $s = [0.45, 0.40, 0.30, 0.25, 0.02, 0.01, 0.00, 0.00]$.\n- Mean-field baseline $E_{\\mathrm{MF}} = 3.80$.\n- Benchmark $E_{\\mathrm{bench}} = 2.60$.\n- Per-orbital corrections $c = [0.35, 0.30, 0.25, 0.20, 0.10, 0.05, 0.02, 0.01]$.\n- Nonzero synergy pairs $(i,j,\\kappa_{ij})$: $(0,1,0.05)$, $(2,3,0.03)$.\n\nTest case $2$:\n- $N=9$.\n- AVAS projected weights $w = [0.21, 0.19, 0.20, 0.22, 0.18, 0.05, 0.04, 0.03, 0.02]$.\n- UNO natural occupations $n = [1.98, 0.02, 1.50, 0.50, 1.00, 2.00, 0.00, 1.01, 0.99]$.\n- AutoCAS single-orbital entropies $s = [0.11, 0.09, 0.20, 0.05, 0.10, 0.00, 0.02, 0.15, 0.12]$.\n- Mean-field baseline $E_{\\mathrm{MF}} = 4.50$.\n- Benchmark $E_{\\mathrm{bench}} = 3.10$.\n- Per-orbital corrections $c = [0.50, 0.45, 0.30, 0.20, 0.15, 0.10, 0.05, 0.03, 0.01]$.\n- Nonzero synergy pairs $(i,j,\\kappa_{ij})$: $(0,1,0.08)$, $(1,2,0.04)$, $(3,4,0.02)$.\n\nTest case $3$:\n- $N=10$.\n- AVAS projected weights $w = [0.15, 0.14, 0.28, 0.27, 0.12, 0.11, 0.05, 0.03, 0.02, 0.01]$.\n- UNO natural occupations $n = [1.98, 0.02, 1.02, 0.98, 1.97, 0.03, 2.00, 0.00, 1.00, 1.00]$.\n- AutoCAS single-orbital entropies $s = [0.30, 0.28, 0.22, 0.20, 0.12, 0.11, 0.02, 0.01, 0.05, 0.05]$.\n- Mean-field baseline $E_{\\mathrm{MF}} = 1.90$.\n- Benchmark $E_{\\mathrm{bench}} = 1.05$.\n- Per-orbital corrections $c = [0.40, 0.35, 0.30, 0.25, 0.20, 0.15, 0.10, 0.06, 0.04, 0.02]$.\n- Nonzero synergy pairs $(i,j,\\kappa_{ij})$: $(0,1,0.06)$, $(2,3,0.05)$, $(4,5,0.03)$.\n\nAlgorithmic requirements:\n- For AVAS, construct $A_{\\mathrm{AVAS}} = \\{ i \\mid w_i \\ge T_{\\mathrm{AVAS}} \\}$.\n- For UNO-CAS, construct $A_{\\mathrm{UNO}} = \\{ i \\mid \\min(n_i, 2-n_i) > \\tau_{\\mathrm{UNO}} \\}$.\n- For AutoCAS, construct $A_{\\mathrm{Auto}} = \\{ i \\mid s_i \\ge \\tau_{s} \\}$.\n- For each active set $A$, compute $E_{\\mathrm{pred}}(A)$ using the provided $E_{\\mathrm{MF}}$, $c_i$, and the listed nonzero $\\kappa_{ij}$ values; unlisted $\\kappa_{ij}$ are zero.\n- Compute the absolute error $|E_{\\mathrm{pred}}(A) - E_{\\mathrm{bench}}|$ in electronvolts.\n- Compute the average pairwise Jaccard index $\\frac{1}{3} \\left( J(A_{\\mathrm{AVAS}},A_{\\mathrm{UNO}}) + J(A_{\\mathrm{AVAS}},A_{\\mathrm{Auto}}) + J(A_{\\mathrm{UNO}},A_{\\mathrm{Auto}}) \\right)$.\n\nNumerical output requirements:\n- For each test case, output four values: the three absolute errors for AVAS, UNO-CAS, and AutoCAS in electronvolts, each rounded to three decimals, followed by the average Jaccard index rounded to three decimals.\n- Aggregate the results for all test cases in order into a single list on one line. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\").\n\nThe required unit for all energies is electronvolts, and the final printed errors must be expressed in electronvolts rounded to three decimals. The Jaccard indices are dimensionless and must be rounded to three decimals. Angles are not used in this problem.", "solution": "The problem presented is a comparative computational study of three active space selection strategies in quantum chemistry: Atomic Valence Active Space (AVAS), Unrestricted Natural Orbital Complete Active Space (UNO-CAS), and Automated Complete Active Space (AutoCAS). The problem is self-contained, scientifically grounded in simplified but standard concepts of multireference methods, and mathematically well-posed. All data, definitions, and algorithmic requirements are provided explicitly. Therefore, the problem is deemed valid and a direct solution can be constructed.\n\nThe objective is to compute, for three distinct test cases, the absolute prediction error for each of the three active space selection strategies and the average pairwise consistency between the resulting active sets.\n\nThe procedural steps are as follows:\n$1$. For each test case, determine the active sets $A_{\\mathrm{AVAS}}$, $A_{\\mathrm{UNO}}$, and $A_{\\mathrm{Auto}}$ based on the provided data and fixed thresholds.\n$2$. For each active set $A$, calculate the surrogate predicted excitation energy $E_{\\mathrm{pred}}(A)$.\n$3$. For each active set $A$, compute the absolute error $|E_{\\mathrm{pred}}(A) - E_{\\mathrm{bench}}|$.\n$4$. Compute the pairwise Jaccard indices between the three active sets and calculate their arithmetic mean.\n\nThe globally fixed thresholds are:\n- AVAS threshold: $T_{\\mathrm{AVAS}} = 0.20$.\n- UNO-CAS threshold: $\\tau_{\\mathrm{UNO}} = 0.02$.\n- AutoCAS threshold: $\\tau_{s} = 0.10$.\n\nThe orbital indices for an active set are determined by the following criteria:\n- AVAS: $A_{\\mathrm{AVAS}} = \\{ i \\mid w_i \\ge T_{\\mathrm{AVAS}} \\}$, where $w_i$ is the projected weight.\n- UNO-CAS: $A_{\\mathrm{UNO}} = \\{ i \\mid \\min(n_i, 2-n_i) > \\tau_{\\mathrm{UNO}} \\}$, where $n_i$ is the natural occupation number.\n- AutoCAS: $A_{\\mathrm{Auto}} = \\{ i \\mid s_i \\ge \\tau_{s} \\}$, where $s_i$ is the single-orbital entropy.\n\nThe predicted energy for an active set $A$ is given by:\n$$\nE_{\\mathrm{pred}}(A) = E_{\\mathrm{MF}} - \\sum_{i \\in A} c_i + \\sum_{\\substack{i<j\\\\ i,j \\in A}} \\kappa_{ij}\n$$\nwhere $E_{\\mathrm{MF}}$ is the mean-field baseline, $c_i$ are orbital correlation corrections, and $\\kappa_{ij}$ are pairwise synergy penalties.\n\nThe average consistency is calculated as:\n$$\nJ_{\\mathrm{avg}} = \\frac{1}{3} \\left( J(A_{\\mathrm{AVAS}}, A_{\\mathrm{UNO}}) + J(A_{\\mathrm{AVAS}}, A_{\\mathrm{Auto}}) + J(A_{\\mathrm{UNO}}, A_{\\mathrm{Auto}}) \\right)\n$$\nwhere the Jaccard index for two sets $A$ and $B$ is $J(A,B) = \\frac{|A \\cap B|}{|A \\cup B|}$.\n\nThe calculations for each test case are performed as follows.\n\n**Test Case $1$**\n$N=8$. Data vectors $w, n, s, c$ are provided. $E_{\\mathrm{MF}} = 3.80$ eV, $E_{\\mathrm{bench}} = 2.60$ eV. Nonzero $\\kappa_{ij}$ are $\\kappa_{01}=0.05$ and $\\kappa_{23}=0.03$.\n\n- Active Sets:\n  - $A_{\\mathrm{AVAS}} = \\{i \\mid w_i \\ge 0.20\\} = \\{0, 1, 2, 3\\}$.\n  - $A_{\\mathrm{UNO}} = \\{i \\mid \\min(n_i, 2-n_i) > 0.02\\}$. The condition is met for orbitals $0, 1, 2, 3$. $A_{\\mathrm{UNO}} = \\{0, 1, 2, 3\\}$.\n  - $A_{\\mathrm{Auto}} = \\{i \\mid s_i \\ge 0.10\\} = \\{0, 1, 2, 3\\}$.\n- Consistency: Since $A_{\\mathrm{AVAS}} = A_{\\mathrm{UNO}} = A_{\\mathrm{Auto}}$, all pairwise Jaccard indices are $1$. The average is $J_{\\mathrm{avg}} = \\frac{1}{3}(1+1+1) = 1.000$.\n- Energy and Error: The active set is $A = \\{0, 1, 2, 3\\}$ for all three strategies.\n  - $\\sum_{i \\in A} c_i = c_0+c_1+c_2+c_3 = 0.35 + 0.30 + 0.25 + 0.20 = 1.10$.\n  - Pairwise terms for pairs in $A$ are $\\kappa_{01}=0.05$ and $\\kappa_{23}=0.03$. $\\sum \\kappa_{ij} = 0.05 + 0.03 = 0.08$.\n  - $E_{\\mathrm{pred}}(A) = 3.80 - 1.10 + 0.08 = 2.78$ eV.\n  - The absolute error is $|2.78 - 2.60| = 0.180$ eV for all three methods.\n- Results for Case $1$: Errors are $0.180, 0.180, 0.180$. Average Jaccard is $1.000$.\n\n**Test Case $2$**\n$N=9$. Data vectors $w, n, s, c$ are provided. $E_{\\mathrm{MF}} = 4.50$ eV, $E_{\\mathrm{bench}} = 3.10$ eV. Nonzero $\\kappa_{ij}$ are $\\kappa_{01}=0.08, \\kappa_{12}=0.04, \\kappa_{34}=0.02$.\n\n- Active Sets:\n  - $A_{\\mathrm{AVAS}} = \\{i \\mid w_i \\ge 0.20\\} = \\{0, 2, 3\\}$.\n  - $A_{\\mathrm{UNO}} = \\{i \\mid \\min(n_i, 2-n_i) > 0.02\\}$. This selects orbitals $2, 3, 4, 7, 8$. $A_{\\mathrm{UNO}} = \\{2, 3, 4, 7, 8\\}$.\n  - $A_{\\mathrm{Auto}} = \\{i \\mid s_i \\ge 0.10\\} = \\{0, 2, 4, 7, 8\\}$.\n- Consistency:\n  - $J(A_{\\mathrm{AVAS}}, A_{\\mathrm{UNO}}) = \\frac{|\\{2,3\\}|}{|\\{0,2,3,4,7,8\\}|} = \\frac{2}{6} = \\frac{1}{3}$.\n  - $J(A_{\\mathrm{AVAS}}, A_{\\mathrm{Auto}}) = \\frac{|\\{0,2\\}|}{|\\{0,2,3,4,7,8\\}|} = \\frac{2}{6} = \\frac{1}{3}$.\n  - $J(A_{\\mathrm{UNO}}, A_{\\mathrm{Auto}}) = \\frac{|\\{2,4,7,8\\}|}{|\\{0,2,3,4,7,8\\}|} = \\frac{4}{6} = \\frac{2}{3}$.\n  - $J_{\\mathrm{avg}} = \\frac{1}{3}(\\frac{1}{3} + \\frac{1}{3} + \\frac{2}{3}) = \\frac{1}{3}(\\frac{4}{3}) = \\frac{4}{9} \\approx 0.444$.\n- Energy and Error:\n  - AVAS ($A=\\{0,2,3\\}$): $\\sum c_i = 0.50+0.30+0.20 = 1.00$. No nonzero $\\kappa_{ij}$ pairs are in $A$. $E_{\\mathrm{pred}} = 4.50 - 1.00 = 3.50$. Error = $|3.50-3.10| = 0.400$.\n  - UNO ($A=\\{2,3,4,7,8\\}$): $\\sum c_i = 0.30+0.20+0.15+0.03+0.01 = 0.69$. Pair $(3,4)$ is in $A$, $\\kappa_{34}=0.02$. $E_{\\mathrm{pred}} = 4.50 - 0.69 + 0.02 = 3.83$. Error = $|3.83-3.10| = 0.730$.\n  - AutoCAS ($A=\\{0,2,4,7,8\\}$): $\\sum c_i = 0.50+0.30+0.15+0.03+0.01 = 0.99$. No nonzero $\\kappa_{ij}$ pairs are in $A$. $E_{\\mathrm{pred}} = 4.50 - 0.99 = 3.51$. Error = $|3.51-3.10| = 0.410$.\n- Results for Case $2$: Errors are $0.400, 0.730, 0.410$. Average Jaccard is $0.444$.\n\n**Test Case $3$**\n$N=10$. Data vectors $w, n, s, c$ are provided. $E_{\\mathrm{MF}} = 1.90$ eV, $E_{\\mathrm{bench}} = 1.05$ eV. Nonzero $\\kappa_{ij}$ are $\\kappa_{01}=0.06, \\kappa_{23}=0.05, \\kappa_{45}=0.03$.\n\n- Active Sets:\n  - $A_{\\mathrm{AVAS}} = \\{i \\mid w_i \\ge 0.20\\} = \\{2, 3\\}$.\n  - $A_{\\mathrm{UNO}} = \\{i \\mid \\min(n_i, 2-n_i) > 0.02\\}$. This selects orbitals $2, 3, 4, 5, 8, 9$. $A_{\\mathrm{UNO}} = \\{2, 3, 4, 5, 8, 9\\}$.\n  - $A_{\\mathrm{Auto}} = \\{i \\mid s_i \\ge 0.10\\} = \\{0, 1, 2, 3, 4, 5\\}$.\n- Consistency:\n  - $J(A_{\\mathrm{AVAS}}, A_{\\mathrm{UNO}}) = \\frac{|\\{2,3\\}|}{|\\{2,3,4,5,8,9\\}|} = \\frac{2}{6} = \\frac{1}{3}$.\n  - $J(A_{\\mathrm{AVAS}}, A_{\\mathrm{Auto}}) = \\frac{|\\{2,3\\}|}{|\\{0,1,2,3,4,5\\}|} = \\frac{2}{6} = \\frac{1}{3}$.\n  - $J(A_{\\mathrm{UNO}}, A_{\\mathrm{Auto}}) = \\frac{|\\{2,3,4,5\\}|}{|\\{0,1,2,3,4,5,8,9\\}|} = \\frac{4}{8} = \\frac{1}{2}$.\n  - $J_{\\mathrm{avg}} = \\frac{1}{3}(\\frac{1}{3} + \\frac{1}{3} + \\frac{1}{2}) = \\frac{1}{3}(\\frac{7}{6}) = \\frac{7}{18} \\approx 0.389$.\n- Energy and Error:\n  - AVAS ($A=\\{2,3\\}$): $\\sum c_i = 0.30+0.25 = 0.55$. Pair $(2,3)$ is in $A$, $\\kappa_{23}=0.05$. $E_{\\mathrm{pred}} = 1.90 - 0.55 + 0.05 = 1.40$. Error = $|1.40-1.05| = 0.350$.\n  - UNO ($A=\\{2,3,4,5,8,9\\}$): $\\sum c_i = 0.30+0.25+0.20+0.15+0.04+0.02 = 0.96$. Pairs $(2,3), (4,5)$ are in $A$. $\\sum \\kappa_{ij} = 0.05+0.03=0.08$. $E_{\\mathrm{pred}} = 1.90 - 0.96 + 0.08 = 1.02$. Error = $|1.02-1.05| = 0.030$.\n  - AutoCAS ($A=\\{0,1,2,3,4,5\\}$): $\\sum c_i = 0.40+0.35+0.30+0.25+0.20+0.15 = 1.65$. Pairs $(0,1), (2,3), (4,5)$ are in $A$. $\\sum \\kappa_{ij} = 0.06+0.05+0.03=0.14$. $E_{\\mathrm{pred}} = 1.90 - 1.65 + 0.14 = 0.39$. Error = $|0.39-1.05| = 0.660$.\n- Results for Case $3$: Errors are $0.350, 0.030, 0.660$. Average Jaccard is $0.389$.\n\nThe final agglomerated results will be formatted into a single list as required.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the quantum chemistry active space comparison problem for a series of test cases.\n    \"\"\"\n\n    # Globally fixed thresholds\n    T_AVAS = 0.20\n    tau_UNO = 0.02\n    tau_s = 0.10\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            # Test case 1\n            \"N\": 8,\n            \"w\": np.array([0.80, 0.75, 0.40, 0.35, 0.10, 0.15, 0.05, 0.02]),\n            \"n\": np.array([1.20, 0.80, 1.05, 0.95, 1.98, 0.02, 2.00, 0.00]),\n            \"s\": np.array([0.45, 0.40, 0.30, 0.25, 0.02, 0.01, 0.00, 0.00]),\n            \"E_MF\": 3.80,\n            \"E_bench\": 2.60,\n            \"c\": np.array([0.35, 0.30, 0.25, 0.20, 0.10, 0.05, 0.02, 0.01]),\n            \"kappa\": {(0, 1): 0.05, (2, 3): 0.03},\n        },\n        {\n            # Test case 2\n            \"N\": 9,\n            \"w\": np.array([0.21, 0.19, 0.20, 0.22, 0.18, 0.05, 0.04, 0.03, 0.02]),\n            \"n\": np.array([1.98, 0.02, 1.50, 0.50, 1.00, 2.00, 0.00, 1.01, 0.99]),\n            \"s\": np.array([0.11, 0.09, 0.20, 0.05, 0.10, 0.00, 0.02, 0.15, 0.12]),\n            \"E_MF\": 4.50,\n            \"E_bench\": 3.10,\n            \"c\": np.array([0.50, 0.45, 0.30, 0.20, 0.15, 0.10, 0.05, 0.03, 0.01]),\n            \"kappa\": {(0, 1): 0.08, (1, 2): 0.04, (3, 4): 0.02},\n        },\n        {\n            # Test case 3\n            \"N\": 10,\n            \"w\": np.array([0.15, 0.14, 0.28, 0.27, 0.12, 0.11, 0.05, 0.03, 0.02, 0.01]),\n            \"n\": np.array([1.98, 0.02, 1.02, 0.98, 1.97, 0.03, 2.00, 0.00, 1.00, 1.00]),\n            \"s\": np.array([0.30, 0.28, 0.22, 0.20, 0.12, 0.11, 0.02, 0.01, 0.05, 0.05]),\n            \"E_MF\": 1.90,\n            \"E_bench\": 1.05,\n            \"c\": np.array([0.40, 0.35, 0.30, 0.25, 0.20, 0.15, 0.10, 0.06, 0.04, 0.02]),\n            \"kappa\": {(0, 1): 0.06, (2, 3): 0.05, (4, 5): 0.03},\n        },\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        N, w, n, s = case[\"N\"], case[\"w\"], case[\"n\"], case[\"s\"]\n        E_MF, E_bench, c, kappa = case[\"E_MF\"], case[\"E_bench\"], case[\"c\"], case[\"kappa\"]\n\n        # 1. Construct active sets\n        A_AVAS = {i for i, val in enumerate(w) if val >= T_AVAS}\n        A_UNO = {i for i, val in enumerate(n) if min(val, 2.0 - val) > tau_UNO}\n        A_Auto = {i for i, val in enumerate(s) if val >= tau_s}\n        \n        active_sets = {\"AVAS\": A_AVAS, \"UNO-CAS\": A_UNO, \"AutoCAS\": A_Auto}\n        errors = []\n\n        # 2. Compute predicted energy and error for each active set\n        for name, A in active_sets.items():\n            # Calculate sum of correlation corrections\n            c_sum = sum(c[i] for i in A)\n\n            # Calculate sum of pairwise synergy penalties\n            kappa_sum = 0.0\n            sorted_A = sorted(list(A))\n            for i1_idx, orb1 in enumerate(sorted_A):\n                for orb2 in sorted_A[i1_idx + 1:]:\n                    if (orb1, orb2) in kappa:\n                        kappa_sum += kappa[(orb1, orb2)]\n            \n            E_pred = E_MF - c_sum + kappa_sum\n            error = abs(E_pred - E_bench)\n            errors.append(round(error, 3))\n\n        # 3. Compute the average Jaccard consistency\n        def jaccard_index(set1, set2):\n            if not set1 and not set2:\n                return 1.0\n            intersection_size = len(set1.intersection(set2))\n            union_size = len(set1.union(set2))\n            return intersection_size / union_size if union_size != 0 else 0.0\n        \n        j1 = jaccard_index(A_AVAS, A_UNO)\n        j2 = jaccard_index(A_AVAS, A_Auto)\n        j3 = jaccard_index(A_UNO, A_Auto)\n        \n        avg_jaccard = round((j1 + j2 + j3) / 3.0, 3)\n        \n        case_results = errors + [avg_jaccard]\n        all_results.extend(case_results)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{x:.3f}' for x in all_results)}]\")\n\nsolve()\n```", "id": "2872260"}]}