{"hands_on_practices": [{"introduction": "A central pillar of Frozen Density Embedding is the accurate representation of Pauli repulsion between electrons of different subsystems. This repulsive interaction is captured by the non-additive non-interacting kinetic energy (NAKE). This first exercise takes you back to the fundamentals by deriving the simplest possible approximation for this energy, the Thomas-Fermi functional, directly from the uniform electron gas model. By completing this derivation and analyzing its behavior [@problem_id:2893022], you will gain a foundational understanding of the NAKE and, more importantly, a critical perspective on the limitations of local approximations, which motivates the entire field of advanced functional development.", "problem": "Consider a noninteracting, spin-unpolarized electron gas confined to a large box with periodic boundary conditions. Electrons occupy plane-wave orbitals up to a Fermi wavevector $k_{\\mathrm F}$ determined by the density. Use the following fundamental facts as a starting point:\n- The number of one-electron states per $k$-space volume is constant, and each spatial orbital can be occupied by $2$ electrons (two spin states).\n- The noninteracting kinetic energy density for occupied plane waves is obtained by integrating $\\hbar^2 k^2/(2m)$ over the Fermi sphere.\n- In atomic units, $\\hbar = m_e = e = 1$, and the noninteracting kinetic energy operator is $-\\tfrac{1}{2}\\nabla^2$.\n\nTask:\n1) From these bases, derive the local dependence of the kinetic energy density on the electron density $\\rho(\\mathbf r)$ implied by the uniform electron gas, and thus the local kinetic energy functional form generally referred to as the Thomas–Fermi functional. Identify the dimensionless constant $C_F$ that multiplies the spatial integral of a power of $\\rho(\\mathbf r)$.\n2) In subsystem density functional theory (DFT), the non-additive noninteracting kinetic energy (NAKE) for two subsystems with densities $\\rho_A$ and $\\rho_B$ is defined as\n$$\nT_s^{\\mathrm{nad}}[\\rho_A,\\rho_B] \\equiv T_s[\\rho_A+\\rho_B] - T_s[\\rho_A] - T_s[\\rho_B].\n$$\nIn Frozen Density Embedding (FDE), the functional derivative $\\delta T_s^{\\mathrm{nad}}/\\delta \\rho_A$ contributes to the embedding potential that enforces the Pauli exclusion principle between subsystems. Based on first principles and the locality of the Thomas–Fermi approximation, reason about its qualitative behavior and limitations when the two subsystem densities significantly overlap (e.g., in covalent bond regions).\n\nWhich option correctly gives both the constant $C_F$ from part $1)$ and an accurate qualitative assessment for part $2)$?\n\nA) $C_F = \\dfrac{3}{10}\\left(3\\pi^2\\right)^{2/3}$; as a NAKE in overlap regions, the Thomas–Fermi form is strictly local and positive by convexity, but it generally underestimates the magnitude and the spatial structure of the Pauli barrier, fails in the one-orbital limit, and performs poorly for covalent bonding and charge-transfer situations.\n\nB) $C_F = \\dfrac{3}{5}\\left(3\\pi^2\\right)^{2/3}$; as a NAKE in overlap regions, the Thomas–Fermi form becomes exact because the density is high and approximately uniform, so it correctly captures the Pauli barrier even for covalent bonds.\n\nC) $C_F = \\dfrac{1}{2}\\left(3\\pi^2\\right)^{2/3}$; as a NAKE in overlap regions, the Thomas–Fermi form is negative by superadditivity and therefore spuriously attractive, leading to electron overdelocalization in all cases.\n\nD) $C_F = \\dfrac{3}{10}\\left(6\\pi^2\\right)^{2/3}$; as a NAKE in overlap regions, the Thomas–Fermi form severely overestimates the Pauli repulsion barrier and generally prevents charge transfer even in weakly interacting complexes.", "solution": "The problem is presented in two parts. First, we must derive the Thomas–Fermi kinetic energy functional for a noninteracting uniform electron gas and identify the constant factor $C_F$. Second, we analyze the qualitative behavior of this functional when used as an approximation for the non-additive noninteracting kinetic energy (NAKE) in subsystem Density Functional Theory (DFT), specifically in regions of overlapping electron densities.\n\n### Part 1: Derivation of the Thomas–Fermi Functional and the Constant $C_F$\n\nWe begin from the first principles given for a noninteracting, spin-unpolarized electron gas in a box of volume $V$ with periodic boundary conditions.\n\n1.  **Relationship between Electron Density $\\rho$ and Fermi Wavevector $k_{\\mathrm F}$**\n\n    The number of available one-electron states in an infinitesimal volume $d^3k$ of reciprocal space ($k$-space) is given by $V/(2\\pi)^3 d^3k$. Since electrons are fermions, each spatial orbital (defined by a wavevector $\\mathbf{k}$) can be occupied by two electrons with opposite spins (spin-degeneracy factor of $g_s=2$). At zero temperature, all states with wavevector magnitude $|\\mathbf{k}| \\le k_{\\mathrm F}$ are occupied, forming a Fermi sphere.\n\n    The total number of electrons $N$ is obtained by integrating the density of states over the volume of this Fermi sphere:\n    $$ N = g_s \\left( \\frac{V}{(2\\pi)^3} \\right) \\int_{|\\mathbf{k}| \\le k_{\\mathrm F}} d^3k $$\n    The integral is simply the volume of the Fermi sphere, which is $\\frac{4}{3}\\pi k_{\\mathrm F}^3$.\n    $$ N = 2 \\left( \\frac{V}{8\\pi^3} \\right) \\left( \\frac{4}{3}\\pi k_{\\mathrm F}^3 \\right) = \\frac{V}{3\\pi^2} k_{\\mathrm F}^3 $$\n    The electron density is $\\rho = N/V$. Thus, we establish the fundamental relationship between density and the Fermi wavevector for a uniform electron gas:\n    $$ \\rho = \\frac{k_{\\mathrm F}^3}{3\\pi^2} \\implies k_{\\mathrm F} = (3\\pi^2 \\rho)^{1/3} $$\n\n2.  **Derivation of the Kinetic Energy Density**\n\n    The problem states we are using atomic units, where $\\hbar=1$ and the electron mass $m_e=1$. The kinetic energy of a single electron in a plane-wave state $\\exp(i\\mathbf{k}\\cdot\\mathbf{r})$ is $\\frac{1}{2}k^2$. The total noninteracting kinetic energy, $T_s$, is the sum of the energies of all occupied states:\n    $$ T_s = g_s \\left( \\frac{V}{(2\\pi)^3} \\right) \\int_{|\\mathbf{k}| \\le k_{\\mathrm F}} \\frac{1}{2}k^2 d^3k $$\n    To evaluate this integral, we switch to spherical coordinates in $k$-space, where $d^3k = 4\\pi k^2 dk$:\n    $$ T_s = 2 \\left( \\frac{V}{8\\pi^3} \\right) \\int_0^{k_{\\mathrm F}} \\left( \\frac{1}{2}k^2 \\right) (4\\pi k^2) dk = \\frac{V}{2\\pi^2} \\int_0^{k_{\\mathrm F}} k^4 dk $$\n    Performing the integration:\n    $$ T_s = \\frac{V}{2\\pi^2} \\left[ \\frac{k^5}{5} \\right]_0^{k_{\\mathrm F}} = \\frac{V}{10\\pi^2} k_{\\mathrm F}^5 $$\n    To obtain the kinetic energy density, $\\tau_s = T_s/V$, we have:\n    $$ \\tau_s = \\frac{k_{\\mathrm F}^5}{10\\pi^2} $$\n    Now, we express $\\tau_s$ as a function of the density $\\rho$ by substituting $k_{\\mathrm F} = (3\\pi^2 \\rho)^{1/3}$:\n    $$ \\tau_s(\\rho) = \\frac{1}{10\\pi^2} \\left( (3\\pi^2 \\rho)^{1/3} \\right)^5 = \\frac{1}{10\\pi^2} (3\\pi^2)^{5/3} \\rho^{5/3} $$\n    Simplifying the constant factor:\n    $$ \\frac{(3\\pi^2)^{5/3}}{10\\pi^2} = \\frac{(3\\pi^2) \\cdot (3\\pi^2)^{2/3}}{10\\pi^2} = \\frac{3}{10}(3\\pi^2)^{2/3} $$\n    This gives the kinetic energy density for the uniform electron gas, known as the Thomas–Fermi kinetic energy density:\n    $$ \\tau_s^{\\mathrm{TF}}(\\rho) = \\frac{3}{10}(3\\pi^2)^{2/3} \\rho^{5/3} $$\n    The Thomas–Fermi functional is given by the Local Density Approximation (LDA) applied to the kinetic energy, which assumes this local relationship holds for non-uniform densities $\\rho(\\mathbf{r})$:\n    $$ T_s^{\\mathrm{TF}}[\\rho] = \\int \\tau_s^{\\mathrm{TF}}(\\rho(\\mathbf{r})) d^3r = \\int C_F \\rho(\\mathbf{r})^{5/3} d^3r $$\n    By comparison, we identify the constant $C_F$:\n    $$ C_F = \\frac{3}{10}(3\\pi^2)^{2/3} $$\n\n### Part 2: Analysis of the Thomas–Fermi NAKE Functional\n\nThe non-additive noninteracting kinetic energy (NAKE) is defined as:\n$$ T_s^{\\mathrm{nad}}[\\rho_A,\\rho_B] \\equiv T_s[\\rho_A+\\rho_B] - T_s[\\rho_A] - T_s[\\rho_B] $$\nThis term accounts for the kinetic energy change arising from the Pauli exclusion principle when two electron distributions $\\rho_A$ and $\\rho_B$ overlap. Within the Thomas–Fermi approximation:\n$$ T_s^{\\mathrm{nad, TF}}[\\rho_A, \\rho_B] = C_F \\int \\left( (\\rho_A(\\mathbf{r}) + \\rho_B(\\mathbf{r}))^{5/3} - \\rho_A(\\mathbf{r})^{5/3} - \\rho_B(\\mathbf{r})^{5/3} \\right) d^3r $$\n\n**Qualitative Behavior and Limitations:**\n\n1.  **Positivity and Convexity:** The function $f(x) = x^{p}$ with $p = 5/3 > 1$ is strictly convex for $x > 0$. A property of such functions is that $(a+b)^p > a^p + b^p$ for any $a,b > 0$. Therefore, the integrand $(\\rho_A + \\rho_B)^{5/3} - \\rho_A^{5/3} - \\rho_B^{5/3}$ is strictly positive wherever both $\\rho_A$ and $\\rho_B$ are non-zero. Consequently, $T_s^{\\mathrm{nad, TF}}$ is always positive. This correctly captures the repulsive nature of the Pauli principle, which increases the system's kinetic energy upon density overlap.\n\n2.  **Locality and Underestimation:** The Thomas–Fermi model is derived for a uniform electron gas and is a purely *local* functional, meaning the kinetic energy at a point $\\mathbf{r}$ depends only on the density $\\rho$ at that same point. The true kinetic energy, however, is highly non-local and depends on the entire orbital structure. In regions of significant density overlap, such as covalent bonds, the density changes rapidly. The TF approximation, lacking any information about density gradients or orbital structures, cannot capture the complex spatial features of the true Pauli repulsion potential (the \"Pauli barrier\"). It is a well-documented failure of the TF NAKE that it severely *underestimates* the magnitude of this repulsion.\n\n3.  **Failure in the One-Orbital Limit:** Consider a system described by a single orbital $\\psi$, such as a hydrogen atom. The exact NAKE must be zero for any partitioning of its density $\\rho = |\\psi|^2$ into two fictitious subsystems $\\rho_A = f\\rho$ and $\\rho_B = (1-f)\\rho$ (where $0  f  1$), because there is no inter-subsystem Pauli exclusion to account for. However, the TF functional gives a non-zero, positive NAKE: $T_s^{\\mathrm{nad, TF}} = C_F (1-f^{5/3}-(1-f)^{5/3}) \\int \\rho^{5/3} d^3r > 0$. This catastrophic failure demonstrates its inability to correctly describe systems with few electrons or orbitals.\n\n4.  **Consequences for Bonding and Charge Transfer:** Because the TF NAKE underestimates the Pauli repulsion, using it in a FDE calculation allows subsystems to overlap too much. In covalent bonds, this leads to an inaccurate description of the bond length and energy. For weakly interacting systems, the underestimated repulsion can lead to spurious charge transfer from one subsystem to another, as the kinetic energy cost for this process is not properly accounted for.\n\n### Evaluation of Options\n\n*   **A) $C_F = \\dfrac{3}{10}\\left(3\\pi^2\\right)^{2/3}$; as a NAKE in overlap regions, the Thomas–Fermi form is strictly local and positive by convexity, but it generally underestimates the magnitude and the spatial structure of the Pauli barrier, fails in the one-orbital limit, and performs poorly for covalent bonding and charge-transfer situations.**\n    The value of a $C_F$ is correct as per our derivation. The qualitative assessment accurately describes the positivity of the functional, its local nature, and its well-known failures: underestimation of the Pauli barrier, failure in the one-orbital limit, and poor performance for covalent bonds and charge-transfer systems.\n    **Verdict: Correct.**\n\n*   **B) $C_F = \\dfrac{3}{5}\\left(3\\pi^2\\right)^{2/3}$; as a NAKE in overlap regions, the Thomas–Fermi form becomes exact because the density is high and approximately uniform, so it correctly captures the Pauli barrier even for covalent bonds.**\n    The constant $C_F$ is incorrect ($3/5$ instead of $3/10$). The qualitative assessment is also incorrect; the TF approximation is not exact for covalent bonds and captures the Pauli barrier poorly.\n    **Verdict: Incorrect.**\n\n*   **C) $C_F = \\dfrac{1}{2}\\left(3\\pi^2\\right)^{2/3}$; as a NAKE in overlap regions, the Thomas–Fermi form is negative by superadditivity and therefore spuriously attractive, leading to electron overdelocalization in all cases.**\n    The constant $C_F$ is incorrect ($1/2$ instead of $3/10$). The qualitative assessment is also incorrect; the TF NAKE is positive (repulsive), not negative (attractive).\n    **Verdict: Incorrect.**\n\n*   **D) $C_F = \\dfrac{3}{10}\\left(6\\pi^2\\right)^{2/3}$; as a NAKE in overlap regions, the Thomas–Fermi form severely overestimates the Pauli repulsion barrier and generally prevents charge transfer even in weakly interacting complexes.**\n    The constant $C_F$ is incorrect; it contains $(6\\pi^2)^{2/3}$, which is related to spin-density functionals, not the spin-unpolarized total density functional requested. The qualitative assessment is also incorrect; the TF NAKE *underestimates* the Pauli repulsion, it does not overestimate it.\n    **Verdict: Incorrect.**", "answer": "$$\\boxed{A}$$", "id": "2893022"}, {"introduction": "One of the most significant challenges in applying DFT to multi-component systems is the \"delocalization error,\" which can lead to spurious, non-physical fractional charges being transferred between subsystems. This practice [@problem_id:2893026] provides a clear and powerful illustration of this problem using a minimal analytical model. By minimizing the energy of two interacting subsystems described by smooth, approximate energy functionals, you will see firsthand how the absence of the derivative discontinuity inevitably leads to charge delocalization. This exercise is crucial for understanding a core limitation of many FDE calculations and the physical principles behind methods designed to correct it.", "problem": "Consider two weakly interacting subsystems, $A$ and $B$, treated within Frozen Density Embedding (FDE) in the framework of Kohn–Sham Density Functional Theory (KS-DFT). Let the total electron number be fixed at $N=N_{A}^{0}+N_{B}^{0}$, where $N_{A}^{0}$ and $N_{B}^{0}$ are integers. We analyze charge transfer using a minimal two-level model in which only the frontier (highest occupied/lowest unoccupied) response of each subsystem is retained and the inter-subsystem interaction enters as a quadratic penalty for net charge transfer. Assume the following physically motivated and scientifically standard ingredients:\n\n- The exact ground-state energy as a function of electron number is piecewise linear with integer kinks (derivative discontinuities). In contrast, approximate density functionals lacking the derivative discontinuity are smooth and strictly convex in electron number near each integer. \n- In this minimal model, we parameterize the smooth approximate energy of each isolated subsystem near its integer $N_{i}^{0}$ by its Taylor expansion up to second order in the electron transfer $\\Delta N$,\n  $$E_{A}(N_{A}^{0}+\\Delta N)=E_{A}(N_{A}^{0})+\\mu_{A}\\,\\Delta N+\\frac{1}{2}\\eta_{A}\\,(\\Delta N)^{2},$$\n  $$E_{B}(N_{B}^{0}-\\Delta N)=E_{B}(N_{B}^{0})-\\mu_{B}\\,\\Delta N+\\frac{1}{2}\\eta_{B}\\,(\\Delta N)^{2},$$\n  where $i\\in\\{A,B\\}$, $\\mu_{i}$ is the left derivative of $E_{i}(N_{i})$ at $N_{i}^{0}$ (the subsystem chemical potential within the smooth approximation), and $\\eta_{i}>0$ is the corresponding curvature (chemical hardness).\n- The embedding-mediated interaction that penalizes charge separation is represented to leading order by a quadratic term,\n  $$U_{\\text{emb}}(\\Delta N)=\\kappa\\,(\\Delta N)^{2},$$\n  with $\\kappa>0$ summarizing long-range electrostatics and nonadditive kinetic/exchange–correlation stiffness within FDE.\n\nThe total model energy as a function of the electron transfer $\\Delta N$ from $B$ to $A$ is therefore\n$$E_{\\text{tot}}(\\Delta N)=E_{A}(N_{A}^{0}+\\Delta N)+E_{B}(N_{B}^{0}-\\Delta N)+U_{\\text{emb}}(\\Delta N).$$\n\nUsing only the variational principle for the ground state and the definition of chemical potential as the derivative of the energy with respect to electron number, determine the equilibrium electron transfer $\\Delta N^{\\ast}$ that minimizes $E_{\\text{tot}}(\\Delta N)$ in this smooth (no derivative discontinuity) model. Express your final answer as a closed-form analytic expression in terms of $\\mu_{A}$, $\\mu_{B}$, $\\eta_{A}$, $\\eta_{B}$, and $\\kappa$. No additional assumptions beyond those stated above are permitted. Provide your final answer as a single analytic expression.", "solution": "The problem statement has been subjected to rigorous validation and is deemed valid. It is scientifically grounded in the principles of Kohn-Sham Density Functional Theory (KS-DFT) and Frozen Density Embedding (FDE), well-posed, and free of contradictions or ambiguities. It presents a standard, albeit simplified, model for charge transfer between subsystems, which can be solved using fundamental principles of calculus.\n\nThe objective is to find the equilibrium electron transfer, denoted as $\\Delta N^{\\ast}$, that minimizes the total energy of the system, $E_{\\text{tot}}(\\Delta N)$. The variational principle dictates that this minimum corresponds to the point where the first derivative of the total energy with respect to the variational parameter, $\\Delta N$, is zero.\n\nThe total energy of the system is given by the sum of the energies of the individual subsystems and the embedding interaction energy:\n$$E_{\\text{tot}}(\\Delta N) = E_{A}(N_{A}^{0}+\\Delta N) + E_{B}(N_{B}^{0}-\\Delta N) + U_{\\text{emb}}(\\Delta N)$$\n\nWe substitute the provided quadratic models for each term:\n$$E_{A}(N_{A}^{0}+\\Delta N) = E_{A}(N_{A}^{0})+\\mu_{A}\\,\\Delta N+\\frac{1}{2}\\eta_{A}\\,(\\Delta N)^{2}$$\n$$E_{B}(N_{B}^{0}-\\Delta N) = E_{B}(N_{B}^{0})-\\mu_{B}\\,\\Delta N+\\frac{1}{2}\\eta_{B}\\,(\\Delta N)^{2}$$\n$$U_{\\text{emb}}(\\Delta N) = \\kappa\\,(\\Delta N)^{2}$$\n\nCombining these terms gives the full expression for the total energy:\n$$E_{\\text{tot}}(\\Delta N) = \\left( E_{A}(N_{A}^{0})+\\mu_{A}\\,\\Delta N+\\frac{1}{2}\\eta_{A}\\,(\\Delta N)^{2} \\right) + \\left( E_{B}(N_{B}^{0})-\\mu_{B}\\,\\Delta N+\\frac{1}{2}\\eta_{B}\\,(\\Delta N)^{2} \\right) + \\kappa\\,(\\Delta N)^{2}$$\n\nTo simplify, we group terms by powers of $\\Delta N$. The terms $E_{A}(N_{A}^{0})$ and $E_{B}(N_{B}^{0})$ are constant with respect to $\\Delta N$.\n$$E_{\\text{tot}}(\\Delta N) = \\left( E_{A}(N_{A}^{0}) + E_{B}(N_{B}^{0}) \\right) + (\\mu_{A} - \\mu_{B})\\,\\Delta N + \\left( \\frac{1}{2}\\eta_{A} + \\frac{1}{2}\\eta_{B} + \\kappa \\right)(\\Delta N)^{2}$$\n$$E_{\\text{tot}}(\\Delta N) = C + (\\mu_{A} - \\mu_{B})\\,\\Delta N + \\frac{1}{2}(\\eta_{A} + \\eta_{B} + 2\\kappa)(\\Delta N)^{2}$$\nwhere $C = E_{A}(N_{A}^{0}) + E_{B}(N_{B}^{0})$ is a constant.\n\nTo find the minimum, we differentiate $E_{\\text{tot}}(\\Delta N)$ with respect to $\\Delta N$ and set the result to zero:\n$$\\frac{dE_{\\text{tot}}}{d(\\Delta N)} = \\frac{d}{d(\\Delta N)}\\left[ C + (\\mu_{A} - \\mu_{B})\\,\\Delta N + \\frac{1}{2}(\\eta_{A} + \\eta_{B} + 2\\kappa)(\\Delta N)^{2} \\right] = 0$$\n$$\\frac{dE_{\\text{tot}}}{d(\\Delta N)} = (\\mu_{A} - \\mu_{B}) + (\\eta_{A} + \\eta_{B} + 2\\kappa)\\,\\Delta N = 0$$\n\nWe solve this linear equation for the equilibrium transfer, $\\Delta N = \\Delta N^{\\ast}$:\n$$(\\eta_{A} + \\eta_{B} + 2\\kappa)\\,\\Delta N^{\\ast} = -(\\mu_{A} - \\mu_{B})$$\n$$\\Delta N^{\\ast} = \\frac{-(\\mu_{A} - \\mu_{B})}{\\eta_{A} + \\eta_{B} + 2\\kappa}$$\n$$\\Delta N^{\\ast} = \\frac{\\mu_{B} - \\mu_{A}}{\\eta_{A} + \\eta_{B} + 2\\kappa}$$\n\nTo confirm that this stationary point is a minimum, we evaluate the second derivative of the total energy:\n$$\\frac{d^{2}E_{\\text{tot}}}{d(\\Delta N)^{2}} = \\frac{d}{d(\\Delta N)}\\left[ (\\mu_{A} - \\mu_{B}) + (\\eta_{A} + \\eta_{B} + 2\\kappa)\\,\\Delta N \\right]$$\n$$\\frac{d^{2}E_{\\text{tot}}}{d(\\Delta N)^{2}} = \\eta_{A} + \\eta_{B} + 2\\kappa$$\nThe problem statement specifies that the chemical hardnesses $\\eta_{A}$ and $\\eta_{B}$ are positive, and the embedding stiffness $\\kappa$ is also positive. Therefore, the sum $\\eta_{A} + \\eta_{B} + 2\\kappa$ is strictly positive. A positive second derivative confirms that the function $E_{\\text{tot}}(\\Delta N)$ is convex and the determined value $\\Delta N^{\\ast}$ corresponds to a unique global minimum. The result is physically sensible: charge transfer is driven by the chemical potential difference $(\\mu_{B} - \\mu_{A})$ and resisted by the sum of the subsystem hardnesses and the embedding penalty.", "answer": "$$\\boxed{\\frac{\\mu_{B} - \\mu_{A}}{\\eta_{A} + \\eta_{B} + 2\\kappa}}$$", "id": "2893026"}, {"introduction": "This final practice bridges the gap between abstract theory and computational reality. Here, you will implement and compare two distinct methods for enforcing Pauli exclusion in an embedding calculation: the potential-based approach, which relies on an approximate NAKE potential, and the projection-based approach, which enforces orthogonality to environment orbitals directly. By constructing the Hamiltonian matrices and computing the resulting orbital energies in a simple 1D model [@problem_id:2893048], you will gain a tangible, hands-on understanding of how different embedding strategies are realized in code and how their underlying physical assumptions manifest in numerical results.", "problem": "Consider a one-dimensional toy model for Frozen Density Embedding (FDE) and projection-based embedding that captures the essential subsystem embedding mechanisms while remaining computationally tractable and self-contained. We work in atomic units (Hartree for energy, Bohr for length). A subsystem density-functional theory partition divides the total electron density into two subsystems, denoted by subsystem A and environment B, with real-space densities $n_{A}(x)$ and $n_{B}(x)$. In this model, subsystem A experiences its own external potential and is embedded in the presence of the frozen environment density $n_{B}(x)$. You will compute the difference in the lowest embedded orbital energies between potential-based FDE and projection-based embedding when both are constructed at the same frozen density.\n\nFundamental base and modeling assumptions:\n- Use the Kohn–Sham-like single-particle equation for subsystem A on a one-dimensional domain with Dirichlet boundary conditions. The kinetic energy operator is the standard nonrelativistic operator in atomic units, $T = -\\tfrac{1}{2} \\tfrac{d^{2}}{dx^{2}}$.\n- Use a toy, local orbital-free kinetic energy functional to define the nonadditive kinetic contribution that drives the embedding potential. Specifically, let the noninteracting kinetic energy be approximated by $T_{s}[n] = \\alpha \\int n(x)^{2} \\, dx$, with $\\alpha > 0$ a given constant. The functional derivative is $\\delta T_{s}/\\delta n = 2 \\alpha n(x)$. The nonadditive kinetic contribution to the A-subsystem potential is then\n$$\nv_{\\mathrm{nad}}^{\\mathrm{kin}}[n_{A},n_{B}](x) = \\frac{\\delta}{\\delta n_{A}(x)}\\left( T_{s}[n_{A}+n_{B}] - T_{s}[n_{A}] \\right) = 2 \\alpha n_{B}(x).\n$$\n- Ignore Coulomb (Hartree) and exchange–correlation terms so that the only embedding contribution is the nonadditive kinetic term above.\n- For projection-based embedding, impose orthogonality of the subsystem A orbitals to a given environment orbital $\\varphi_{B}(x)$ that reproduces the environment density $n_{B}(x)$ for a single electron, namely $\\varphi_{B}(x) = \\sqrt{n_{B}(x)}$ (real and nonnegative). This is enforced by a level-shift projector with strength $\\lambda \\ge 0$, leading to an additive operator $\\lambda \\hat{P}_{B}$ where $\\hat{P}_{B} = |\\varphi_{B}\\rangle \\langle \\varphi_{B}|$.\n\nDiscretization and operators:\n- Consider a finite one-dimensional box of length $L$ with Dirichlet boundary conditions at $x=0$ and $x=L$. Discretize the interval with a uniform grid of $N_{\\mathrm{tot}}$ points including endpoints, spacing $\\Delta x = L/(N_{\\mathrm{tot}}-1)$. Work on the $N = N_{\\mathrm{tot}}-2$ interior points only, denoted $\\{ x_{i} \\}_{i=1}^{N}$.\n- Discretize the kinetic operator $T$ using the standard three-point second-order finite-difference approximation for $-\\tfrac{1}{2} \\tfrac{d^{2}}{dx^{2}}$ on the interior grid:\n$$\nT_{ii} = \\frac{1}{\\Delta x^{2}}, \\quad T_{i,i\\pm 1} = -\\frac{1}{2 \\Delta x^{2}}.\n$$\n- Represent multiplicative potentials $v(x)$ as diagonal matrices $V = \\mathrm{diag}\\big(v(x_{1}),\\dots,v(x_{N})\\big)$.\n- Represent the level-shift projector onto $\\varphi_{B}$ in discrete form as\n$$\nP_{B} = \\Delta x \\, \\boldsymbol{\\varphi}_{B} \\boldsymbol{\\varphi}_{B}^{\\mathsf{T}},\n$$\nwhere $\\boldsymbol{\\varphi}_{B}$ is the vector of values $\\varphi_{B}(x_{i})$ normalized to satisfy the discrete condition $\\sum_{i=1}^{N} \\varphi_{B}(x_{i})^{2} \\Delta x = 1$. This choice ensures $P_{B} \\boldsymbol{\\varphi}_{B} = \\boldsymbol{\\varphi}_{B}$ and $P_{B}$ acts as the correct projector with respect to the $\\Delta x$-weighted inner product.\n\nSubsystem ingredients:\n- Define subsystem A’s external potential as an attractive Gaussian well centered at $c_{A}$:\n$$\nv_{A}^{\\mathrm{ext}}(x) = -V_{0} \\exp\\!\\left( -\\frac{(x-c_{A})^{2}}{2 \\sigma_{v}^{2}} \\right).\n$$\n- Define the environment density $n_{B}(x)$ as a normalized Gaussian centered at $c_{B}$:\n$$\nn_{B}(x) = \\frac{N_{B}}{\\sqrt{2\\pi} \\sigma_{n}} \\exp\\!\\left( -\\frac{(x-c_{B})^{2}}{2 \\sigma_{n}^{2}} \\right),\n$$\nwith $N_{B}=1$ electron, normalized on the finite grid by scaling so that $\\sum_{i=1}^{N} n_{B}(x_{i}) \\Delta x = 1$. Let $\\varphi_{B}(x) = \\sqrt{n_{B}(x)}$, and renormalize if needed to satisfy the discrete normalization condition above.\n\nEmbedded Hamiltonians and target quantity:\n- Potential-based FDE for subsystem A uses the Hamiltonian\n$$\nH_{\\mathrm{pot}} = T + \\mathrm{diag}\\!\\big(v_{A}^{\\mathrm{ext}}(x)\\big) + \\mathrm{diag}\\!\\big(2\\alpha \\, n_{B}(x)\\big).\n$$\n- Projection-based embedding for subsystem A uses\n$$\nH_{\\mathrm{proj}} = T + \\mathrm{diag}\\!\\big(v_{A}^{\\mathrm{ext}}(x)\\big) + \\lambda P_{B}.\n$$\n- Let $\\varepsilon_{\\mathrm{pot}}$ and $\\varepsilon_{\\mathrm{proj}}$ denote the lowest eigenvalues (ground-state orbital energies) of $H_{\\mathrm{pot}}$ and $H_{\\mathrm{proj}}$, respectively. Compute the difference\n$$\n\\Delta \\varepsilon = \\varepsilon_{\\mathrm{pot}} - \\varepsilon_{\\mathrm{proj}}.\n$$\n\nNumerical parameters and test suite:\n- Fix the global parameters to $L = 20.0$, $N_{\\mathrm{tot}} = 220$, $V_{0} = 8.0$, $\\sigma_{v} = 0.6$, $\\sigma_{n} = 0.7$, $\\alpha = 1.0$. Place subsystem centers symmetrically about the box midpoint at $L/2$, with separation $d$, i.e., $c_{A} = L/2 - d/2$ and $c_{B} = L/2 + d/2$.\n- For each test case, you are given a pair $(d,\\lambda)$ and must compute $\\Delta \\varepsilon$ in Hartree, as a float. Use the following four test cases:\n    1. $(d,\\lambda) = (4.0, 50.0)$.\n    2. $(d,\\lambda) = (10.0, 50.0)$.\n    3. $(d,\\lambda) = (1.5, 50.0)$.\n    4. $(d,\\lambda) = (4.0, 0.0)$.\nThese cover a moderate overlap case, a weak-overlap case, a strong-overlap case, and a no-projection edge case, respectively.\n\nProgram requirements:\n- Construct the discretized operators exactly as specified above, solve the two symmetric eigenvalue problems to obtain $\\varepsilon_{\\mathrm{pot}}$ and $\\varepsilon_{\\mathrm{proj}}$ for each test case, and compute $\\Delta \\varepsilon$.\n- Express all energies in Hartree. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[$x_{1}$,$x_{2}$,$x_{3}$,$x_{4}$]\"), where each entry is the float $\\Delta \\varepsilon$ for the corresponding test case. Round each entry to $6$ decimal places.", "solution": "The problem presented is a valid and well-posed computational exercise in quantum chemistry. It requires the numerical implementation and comparison of two distinct embedding methods, potential-based Frozen Density Embedding (FDE) and projection-based embedding, within a simplified one-dimensional toy model. All parameters, equations, and numerical schemes are explicitly defined, allowing for a unique and verifiable solution. The problem is scientifically grounded in the principles of subsystem density-functional theory.\n\nThe objective is to compute the difference between the lowest orbital energies, $\\Delta \\varepsilon = \\varepsilon_{\\mathrm{pot}} - \\varepsilon_{\\mathrm{proj}}$, for two different embedded Hamiltonians of a subsystem A. Here, $\\varepsilon_{\\mathrm{pot}}$ is the lowest eigenvalue of the potential-based FDE Hamiltonian, $H_{\\mathrm{pot}}$, and $\\varepsilon_{\\mathrm{proj}}$ is the lowest eigenvalue of the projection-based embedding Hamiltonian, $H_{\\mathrm{proj}}$. The calculation must be performed for four specified test cases, each defined by a pair of parameters $(d, \\lambda)$.\n\nThe solution methodology proceeds as follows:\n\nFirst, we establish the discretized one-dimensional real-space grid. The system is confined to a box of length $L=20.0$. This domain is discretized into $N_{\\mathrm{tot}}=220$ equidistant points. The calculations are performed on the $N = N_{\\mathrm{tot}}-2 = 218$ interior grid points, $\\{x_i\\}_{i=1}^{N}$. The grid spacing is $\\Delta x = L / (N_{\\mathrm{tot}}-1)$. The vector of interior grid point coordinates is denoted $\\mathbf{x}$.\n\nSecond, we construct the matrix representations of the operators on this discrete grid. All matrices will have dimensions $N \\times N$.\nThe kinetic energy operator, $T = -\\frac{1}{2}\\frac{d^2}{dx^2}$, is discretized using a central finite-difference scheme, resulting in a real, symmetric, tridiagonal matrix $\\mathbf{T}$ with entries:\n$$\nT_{ij} =\n\\begin{cases}\n1 / (\\Delta x)^2  \\text{if } i=j \\\\\n-1 / (2 (\\Delta x)^2)  \\text{if } |i-j|=1 \\\\\n0  \\text{otherwise}\n\\end{cases}\n$$\n\nFor each test case, defined by the separation distance $d$ and projection strength $\\lambda$, we construct the required potentials and the projector:\n1.  The subsystem centers are set to $c_{A} = L/2 - d/2$ and $c_{B} = L/2 + d/2$.\n2.  The external potential for subsystem A, $v_{A}^{\\mathrm{ext}}(x) = -V_{0} \\exp(-\\frac{(x-c_{A})^{2}}{2 \\sigma_{v}^{2}})$, is evaluated at each grid point $x_i$ to form a vector $\\mathbf{v}_{A}^{\\mathrm{ext}}$. This is represented as a diagonal matrix $\\mathbf{V}_{A}^{\\mathrm{ext}} = \\mathrm{diag}(\\mathbf{v}_{A}^{\\mathrm{ext}})$. The parameters are fixed at $V_0=8.0$ and $\\sigma_v=0.6$.\n3.  The environment density, $n_{B}(x)$, is modeled as a Gaussian function centered at $c_B$ with width $\\sigma_n=0.7$. It is first evaluated on the grid, then numerically normalized such that the discrete integral $\\sum_{i=1}^{N} n_{B}(x_i) \\Delta x = 1$. The resulting vector is denoted $\\mathbf{n}_{B}$.\n4.  The potential-based embedding contribution is defined by the non-additive kinetic potential $v_{\\mathrm{nad}}^{\\mathrm{kin}}(x) = 2 \\alpha n_{B}(x)$ with $\\alpha=1.0$. This is represented as a diagonal matrix $\\mathbf{V}_{\\mathrm{nad}}^{\\mathrm{kin}} = \\mathrm{diag}(2 \\alpha \\mathbf{n}_{B})$.\n5.  The projection-based embedding operator requires the environment orbital $\\boldsymbol{\\varphi}_{B}$ and the corresponding projector $\\mathbf{P}_{B}$. The orbital is defined as $\\boldsymbol{\\varphi}_{B} = \\sqrt{\\mathbf{n}_{B}}$. Since $\\mathbf{n}_{B}$ is already normalized to sum to $1$ with the $\\Delta x$ weighting, $\\boldsymbol{\\varphi}_{B}$ automatically satisfies the required normalization condition $\\sum_{i=1}^{N} \\varphi_{B}(x_i)^2 \\Delta x = 1$. The projector matrix is then constructed as $\\mathbf{P}_{B} = \\Delta x \\, \\boldsymbol{\\varphi}_{B} \\boldsymbol{\\varphi}_{B}^{\\mathsf{T}}$, where $\\boldsymbol{\\varphi}_{B}^{\\mathsf{T}}$ is the transpose of the column vector $\\boldsymbol{\\varphi}_{B}$.\n\nThird, we assemble the two Hamiltonian matrices:\nThe potential-based FDE Hamiltonian is:\n$$\nH_{\\mathrm{pot}} = \\mathbf{T} + \\mathbf{V}_{A}^{\\mathrm{ext}} + \\mathbf{V}_{\\mathrm{nad}}^{\\mathrm{kin}} = \\mathbf{T} + \\mathrm{diag}(\\mathbf{v}_{A}^{\\mathrm{ext}} + 2 \\alpha \\mathbf{n}_{B})\n$$\nThe projection-based embedding Hamiltonian is:\n$$\nH_{\\mathrm{proj}} = \\mathbf{T} + \\mathbf{V}_{A}^{\\mathrm{ext}} + \\lambda \\mathbf{P}_{B}\n$$\nBoth $H_{\\mathrm{pot}}$ and $H_{\\mathrm{proj}}$ are real symmetric matrices.\n\nFourth, we solve the eigenvalue problem for each Hamiltonian. The lowest eigenvalues, $\\varepsilon_{\\mathrm{pot}}$ and $\\varepsilon_{\\mathrm{proj}}$, correspond to the ground-state orbital energies for each embedding scheme. These are found by numerically diagonalizing $H_{\\mathrm{pot}}$ and $H_{\\mathrm{proj}}$ and extracting the minimum eigenvalue from the resulting spectrum. Standard numerical linear algebra routines for symmetric matrices are employed for this task.\n\nFinally, for each $(d, \\lambda)$ pair, the target quantity is computed as the difference $\\Delta \\varepsilon = \\varepsilon_{\\mathrm{pot}} - \\varepsilon_{\\mathrm{proj}}$. This procedure is repeated for all four test cases to generate the final list of results.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D embedding problem for the given test cases.\n    \"\"\"\n\n    # --- Global parameters ---\n    L = 20.0\n    N_tot = 220\n    V0 = 8.0\n    sigma_v = 0.6\n    sigma_n = 0.7\n    alpha = 1.0\n\n    # --- Grid setup ---\n    N = N_tot - 2\n    delta_x = L / (N_tot - 1)\n    x_grid = np.linspace(delta_x, L - delta_x, N)\n\n    # --- Construct Kinetic Energy Matrix T ---\n    diag_val = 1.0 / (delta_x**2)\n    off_diag_val = -0.5 / (delta_x**2)\n    \n    T = (np.diag(np.full(N, diag_val)) + \n         np.diag(np.full(N - 1, off_diag_val), k=1) +\n         np.diag(np.full(N - 1, off_diag_val), k=-1))\n\n    # --- Test cases from the problem statement ---\n    test_cases = [\n        (4.0, 50.0),   # 1. Moderate overlap\n        (10.0, 50.0),  # 2. Weak overlap\n        (1.5, 50.0),   # 3. Strong overlap\n        (4.0, 0.0),    # 4. No projection\n    ]\n\n    results = []\n\n    for d, lam in test_cases:\n        # --- Construct potential- and density-related terms for the current case ---\n        \n        # 1. Subsystem centers\n        c_A = L / 2.0 - d / 2.0\n        c_B = L / 2.0 + d / 2.0\n\n        # 2. Subsystem A external potential vector\n        v_A_ext = -V0 * np.exp(-((x_grid - c_A)**2) / (2.0 * sigma_v**2))\n\n        # 3. Environment density vector n_B (normalized on the grid)\n        n_B_unnormalized = np.exp(-((x_grid - c_B)**2) / (2.0 * sigma_n**2))\n        norm_const_n = np.sum(n_B_unnormalized) * delta_x\n        n_B = n_B_unnormalized / norm_const_n\n\n        # 4. Environment orbital vector phi_B\n        # This is automatically normalized due to n_B's normalization\n        phi_B = np.sqrt(n_B)\n\n        # --- Assemble Hamiltonians ---\n\n        # 1. Potential-based Hamiltonian (H_pot)\n        v_nad_kin = 2.0 * alpha * n_B\n        H_pot = T + np.diag(v_A_ext + v_nad_kin)\n\n        # 2. Projection-based Hamiltonian (H_proj)\n        P_B = delta_x * np.outer(phi_B, phi_B)\n        H_proj = T + np.diag(v_A_ext) + lam * P_B\n\n        # --- Solve eigenvalue problems for lowest eigenvalue ---\n        # np.linalg.eigvalsh is efficient for symmetric matrices and returns sorted eigenvalues\n        \n        eps_pot = np.linalg.eigvalsh(H_pot)[0]\n        eps_proj = np.linalg.eigvalsh(H_proj)[0]\n\n        # --- Compute the difference and store the result ---\n        delta_eps = eps_pot - eps_proj\n        results.append(delta_eps)\n\n    # --- Final print statement in the exact required format ---\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "2893048"}]}