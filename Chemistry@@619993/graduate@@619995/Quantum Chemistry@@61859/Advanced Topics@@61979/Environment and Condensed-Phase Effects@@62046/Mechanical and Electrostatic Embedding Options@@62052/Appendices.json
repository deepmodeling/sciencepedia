{"hands_on_practices": [{"introduction": "Understanding QM/MM begins with the simplest coupling scheme: mechanical embedding. This practice explores how steric or strain effects from a classical environment are transmitted to a quantum region, altering its equilibrium geometry. By applying the fundamental principle of energy minimization to a simplified harmonic model, you will derive the precise change in a QM bond length, providing a concrete example of how mechanical forces are handled at the QM/MM boundary [@problem_id:2904939].", "problem": "Consider a diatomic quantum mechanical (QM) subsystem embedded in a classical molecular mechanics (MM) environment under the Born–Oppenheimer approximation. Let the QM subsystem be a two-atom molecule described near its intrinsic equilibrium bond length by a harmonic expansion of the ground-state potential energy surface. Specifically, let the internuclear separation be $r$ and the uncoupled QM minimum be at $r_0$, with curvature (harmonic force constant) $k_{\\mathrm{QM}}$. Thus, for small displacements, the QM contribution to the potential energy can be written as $E_{\\mathrm{QM}}(r) \\approx \\tfrac{1}{2} k_{\\mathrm{QM}} (r - r_0)^2 + \\text{constant}$.\n\nAssume the MM environment is represented as a set of $N$ independent harmonic modes that couple mechanically (and only mechanically) to the QM bond length $r$. Each mode contributes an additive quadratic term in $(r - R_i)$ with coupling stiffness $k_i$ and its own reference length $R_i$, so that the total MM contribution that depends on $r$ is $\\sum_{i=1}^{N} \\tfrac{1}{2} k_i (r - R_i)^2$. There is no electrostatic embedding: the QM Hamiltonian is not perturbed by MM charges or multipoles, and any MM terms independent of $r$ may be ignored for the purpose of locating the minimum along $r$.\n\nStarting only from the harmonic approximation just described and the principle that the equilibrium geometry minimizes the total potential energy with respect to $r$, derive the exact closed-form expression for the change in the equilibrium bond length induced by this mechanical embedding. Report your final result as the dimensionless fractional shift $\\Delta r / r_0$, where $\\Delta r = r_{\\mathrm{eq}} - r_0$ and $r_{\\mathrm{eq}}$ is the equilibrium separation in the coupled QM/MM system. Express your final answer solely in terms of $k_{\\mathrm{QM}}$, $\\{k_i\\}_{i=1}^{N}$, $r_0$, and $\\{R_i\\}_{i=1}^{N}$. Do not substitute numerical values. No rounding is required. The requested output is dimensionless, so no units are to be reported.", "solution": "The problem statement is subjected to rigorous validation.\n\nStep 1: Extract Givens\n- QM subsystem potential energy: $E_{\\mathrm{QM}}(r) \\approx \\frac{1}{2} k_{\\mathrm{QM}} (r - r_0)^2 + \\text{constant}$\n- $r$: internuclear separation in the diatomic QM subsystem.\n- $r_0$: equilibrium bond length of the uncoupled QM subsystem.\n- $k_{\\mathrm{QM}}$: harmonic force constant (curvature) of the QM potential.\n- MM environment potential energy contribution depending on $r$: $E_{\\mathrm{MM}}(r) = \\sum_{i=1}^{N} \\frac{1}{2} k_i (r - R_i)^2$.\n- $N$: number of independent harmonic modes in the MM environment.\n- $k_i$: coupling stiffness of the $i$-th MM mode.\n- $R_i$: reference length for the $i$-th MM mode.\n- Coupling type: Mechanical only; no electrostatic embedding.\n- Principle for equilibrium: The equilibrium geometry minimizes the total potential energy with respect to $r$.\n- Required output: The dimensionless fractional shift $\\frac{\\Delta r}{r_0}$, where $\\Delta r = r_{\\mathrm{eq}} - r_0$, and $r_{\\mathrm{eq}}$ is the equilibrium separation in the coupled QM/MM system.\n\nStep 2: Validate Using Extracted Givens\nThe problem is scientifically grounded. It presents a simplified but standard model of mechanical embedding in hybrid QM/MM methods, a well-established technique in computational chemistry. The use of the Born-Oppenheimer approximation, harmonic potentials, and the principle of energy minimization are fundamental to the field. The problem is well-posed; it provides a clearly defined total potential energy function, which, being a sum of quadratic terms in $r$, is a quadratic function itself and thus has a unique minimum that can be found analytically. The problem is objective, using precise, technical language devoid of ambiguity or subjectivity. It is self-contained, providing all necessary information for its solution. It does not violate any physical principles within its stated model framework, nor does it contain contradictions.\n\nStep 3: Verdict and Action\nThe problem is valid. A solution will be derived.\n\nThe total potential energy of the coupled QM/MM system, $E_{\\mathrm{total}}(r)$, is the sum of the QM and MM contributions. Any terms independent of the coordinate $r$ do not affect the position of the minimum and can be disregarded.\n$$E_{\\mathrm{total}}(r) = E_{\\mathrm{QM}}(r) + E_{\\mathrm{MM}}(r) = \\frac{1}{2} k_{\\mathrm{QM}} (r - r_0)^2 + \\sum_{i=1}^{N} \\frac{1}{2} k_i (r - R_i)^2$$\nThe equilibrium geometry corresponds to the value of $r$, denoted $r_{\\mathrm{eq}}$, at which the total potential energy is at a minimum. This condition is found by setting the first derivative of the potential energy with respect to $r$ to zero.\n$$\\frac{dE_{\\mathrm{total}}}{dr} \\bigg|_{r=r_{\\mathrm{eq}}} = 0$$\nFirst, we compute the derivative of $E_{\\mathrm{total}}(r)$ with respect to $r$:\n$$\\frac{dE_{\\mathrm{total}}}{dr} = \\frac{d}{dr} \\left[ \\frac{1}{2} k_{\\mathrm{QM}} (r - r_0)^2 + \\sum_{i=1}^{N} \\frac{1}{2} k_i (r - R_i)^2 \\right]$$\nUsing the chain rule for differentiation, we obtain:\n$$\\frac{dE_{\\mathrm{total}}}{dr} = k_{\\mathrm{QM}} (r - r_0) + \\sum_{i=1}^{N} k_i (r - R_i)$$\nSetting this derivative to zero at $r = r_{\\mathrm{eq}}$ gives the equation for the equilibrium bond length:\n$$k_{\\mathrm{QM}} (r_{\\mathrm{eq}} - r_0) + \\sum_{i=1}^{N} k_i (r_{\\mathrm{eq}} - R_i) = 0$$\nWe must now solve this linear equation for $r_{\\mathrm{eq}}$. We expand the terms and group those containing $r_{\\mathrm{eq}}$:\n$$k_{\\mathrm{QM}} r_{\\mathrm{eq}} - k_{\\mathrm{QM}} r_0 + \\sum_{i=1}^{N} k_i r_{\\mathrm{eq}} - \\sum_{i=1}^{N} k_i R_i = 0$$\n$$k_{\\mathrm{QM}} r_{\\mathrm{eq}} + \\left(\\sum_{i=1}^{N} k_i\\right) r_{\\mathrm{eq}} = k_{\\mathrm{QM}} r_0 + \\sum_{i=1}^{N} k_i R_i$$\nFactoring out $r_{\\mathrm{eq}}$ from the left-hand side:\n$$r_{\\mathrm{eq}} \\left( k_{\\mathrm{QM}} + \\sum_{i=1}^{N} k_i \\right) = k_{\\mathrm{QM}} r_0 + \\sum_{i=1}^{N} k_i R_i$$\nIsolating $r_{\\mathrm{eq}}$ yields the expression for the equilibrium bond length in the coupled system:\n$$r_{\\mathrm{eq}} = \\frac{k_{\\mathrm{QM}} r_0 + \\sum_{i=1}^{N} k_i R_i}{k_{\\mathrm{QM}} + \\sum_{i=1}^{N} k_i}$$\nTo confirm this corresponds to a minimum, we evaluate the second derivative of the potential energy.\n$$\\frac{d^2E_{\\mathrm{total}}}{dr^2} = k_{\\mathrm{QM}} + \\sum_{i=1}^{N} k_i$$\nSince the force constants $k_{\\mathrm{QM}}$ and $k_i$ represent stable harmonic potentials, they must be positive. Thus, the second derivative is strictly positive, confirming that $r_{\\mathrm{eq}}$ is indeed a minimum.\n\nThe problem requires the change in the equilibrium bond length, $\\Delta r = r_{\\mathrm{eq}} - r_0$. We substitute the expression for $r_{\\mathrm{eq}}$:\n$$\\Delta r = \\frac{k_{\\mathrm{QM}} r_0 + \\sum_{i=1}^{N} k_i R_i}{k_{\\mathrm{QM}} + \\sum_{i=1}^{N} k_i} - r_0$$\nTo simplify, we place both terms over a common denominator:\n$$\\Delta r = \\frac{k_{\\mathrm{QM}} r_0 + \\sum_{i=1}^{N} k_i R_i - r_0 \\left( k_{\\mathrm{QM}} + \\sum_{i=1}^{N} k_i \\right)}{k_{\\mathrm{QM}} + \\sum_{i=1}^{N} k_i}$$\nExpanding the numerator:\n$$\\Delta r = \\frac{k_{\\mathrm{QM}} r_0 + \\sum_{i=1}^{N} k_i R_i - k_{\\mathrm{QM}} r_0 - r_0 \\sum_{i=1}^{N} k_i}{k_{\\mathrm{QM}} + \\sum_{i=1}^{N} k_i}$$\nThe term $k_{\\mathrm{QM}} r_0$ cancels, leaving:\n$$\\Delta r = \\frac{\\sum_{i=1}^{N} k_i R_i - r_0 \\sum_{i=1}^{N} k_i}{k_{\\mathrm{QM}} + \\sum_{i=1}^{N} k_i}$$\nFactoring the numerator gives the final expression for $\\Delta r$:\n$$\\Delta r = \\frac{\\sum_{i=1}^{N} k_i (R_i - r_0)}{k_{\\mathrm{QM}} + \\sum_{i=1}^{N} k_i}$$\nFinally, we compute the requested dimensionless fractional shift, $\\frac{\\Delta r}{r_0}$:\n$$\\frac{\\Delta r}{r_0} = \\frac{1}{r_0} \\left( \\frac{\\sum_{i=1}^{N} k_i (R_i - r_0)}{k_{\\mathrm{QM}} + \\sum_{i=1}^{N} k_i} \\right)$$\nThis gives the final expression as:\n$$\\frac{\\Delta r}{r_0} = \\frac{\\sum_{i=1}^{N} k_i (R_i - r_0)}{r_0 \\left( k_{\\mathrm{QM}} + \\sum_{i=1}^{N} k_i \\right)}$$\nThis expression is solely in terms of the given parameters $k_{\\mathrm{QM}}$, $\\{k_i\\}_{i=1}^{N}$, $r_0$, and $\\{R_i\\}_{i=1}^{N}$, as required.", "answer": "$$\\boxed{\\frac{\\sum_{i=1}^{N} k_i (R_i - r_0)}{r_0 \\left( k_{\\mathrm{QM}} + \\sum_{i=1}^{N} k_i \\right)}}$$", "id": "2904939"}, {"introduction": "While mechanical embedding accounts for strain, a more physically robust QM/MM model must also include electrostatics. This practice guides you through the first-principles derivation of the electrostatic embedding energy, which describes how the charge distribution of the classical MM region interacts with the QM electrons and nuclei. Understanding this interaction term is fundamental, as it allows the QM wavefunction to polarize in response to its environment—a key physical effect captured by electrostatic embedding schemes [@problem_id:2904928].", "problem": "A molecular system is partitioned into a quantum subsystem and a classical environment, as in quantum mechanics/molecular mechanics (QM/MM) modeling. The quantum subsystem contains $N_{\\mathrm{e}}$ electrons with number density $\\rho(\\mathbf{r})$ and nuclei indexed by $A$ with charges $Z_{A}$ located at positions $\\mathbf{R}_{A}$. The classical environment is represented by $M$ fixed point charges $q_{i}$ at positions $\\mathbf{R}_{i}$, obeying a non-polarizable, fixed-charge force field. Work within the Born–Oppenheimer approximation and use Hartree atomic units, where the elementary charge magnitude and $1/(4\\pi\\varepsilon_{0})$ are taken as $1$.\n\nStarting from first principles of electrostatics and the structure of the electronic Hamiltonian in an external field, do the following:\n\n- Clearly distinguish in words the mechanical embedding and electrostatic embedding options with respect to whether the quantum electronic Hamiltonian contains a term arising from the classical point charges.\n- Using only the fundamental Coulomb interaction between charge distributions and the definition of the external potential energy entering the electronic Hamiltonian, derive the expressions for the electron–MM and nucleus–MM electrostatic interaction energies for electrostatic embedding.\n- Combine these two contributions into a single closed-form expression for the total QM–MM electrostatic embedding energy $E_{\\mathrm{embed}}$ in terms of $\\rho(\\mathbf{r})$, $Z_{A}$, $q_{i}$, $\\mathbf{R}_{A}$, and $\\mathbf{R}_{i}$.\n\nExpress your final result as one analytic expression. Do not substitute numerical values and do not report intermediate results. Your final answer must be a single closed-form expression. Do not include units in the final answer.", "solution": "The problem statement is presented for validation.\n\nFirst, I will extract the given information precisely as stated.\nGivens:\n1.  A molecular system is partitioned into a quantum subsystem (QM) and a classical environment (MM).\n2.  The QM subsystem contains $N_{\\mathrm{e}}$ electrons with number density $\\rho(\\mathbf{r})$.\n3.  The QM subsystem contains nuclei indexed by $A$ with charges $Z_{A}$ at positions $\\mathbf{R}_{A}$.\n4.  The classical environment is represented by $M$ fixed point charges $q_{i}$ at positions $\\mathbf{R}_{i}$.\n5.  The classical environment obeys a non-polarizable, fixed-charge force field.\n6.  The Born–Oppenheimer approximation is to be used.\n7.  Hartree atomic units are to be used, where the elementary charge magnitude and $1/(4\\pi\\varepsilon_{0})$ are taken as $1$.\n\nNext, I will validate the problem against the required criteria.\nThe problem is **scientifically grounded**. It describes a standard QM/MM (Quantum Mechanics/Molecular Mechanics) partitioning scheme, a cornerstone of modern computational chemistry. The concepts of mechanical and electrostatic embedding are fundamental and well-defined within this framework. The use of the Born-Oppenheimer approximation and atomic units are standard conventions in this field.\nThe problem is **well-posed**. It provides all necessary definitions ($\\rho(\\mathbf{r})$, $Z_A$, $q_i$, etc.) and physical context (electrostatics, quantum Hamiltonian) to perform the requested derivations. The tasks are specific and lead to a unique analytical expression.\nThe problem is **objective**. The language is formal, precise, and uses established scientific terminology. It is free from ambiguity, subjectivity, and non-scientific claims.\nThe problem is self-contained, consistent, and scientifically sound. No flaws are identified.\n\nVerdict: The problem is **valid**. I will proceed with the solution.\n\nThe task is to first distinguish between mechanical and electrostatic embedding and then to derive the total QM–MM electrostatic embedding energy, $E_{\\mathrm{embed}}$.\n\nIn a QM/MM scheme, the total Hamiltonian can be conceptually written as $\\hat{H}_{\\mathrm{total}} = \\hat{H}_{\\mathrm{QM}} + H_{\\mathrm{MM}} + \\hat{H}_{\\mathrm{QM/MM}}$. The distinction between embedding schemes lies in the definition and treatment of the coupling term, $\\hat{H}_{\\mathrm{QM/MM}}$.\n\n**Mechanical embedding** is the simplest, and crudest, model. In this scheme, the QM calculation is performed *in vacuo*, meaning the electronic Hamiltonian, $\\hat{H}_{\\mathrm{el}}$, contains no terms pertaining to the MM environment. The electronic structure (wavefunction and density $\\rho(\\mathbf{r})$) is determined as if the classical subsystem does not exist. The QM-MM interaction energy is then calculated *post hoc* using classical electrostatics, typically between charges derived from the QM wavefunction (e.g., Mulliken charges, ESP charges) and the fixed MM point charges $q_i$. Crucially, the MM charges do not polarize the QM electron density because they are absent from the Hamiltonian during the self-consistent field procedure. The coupling is purely mechanical, affecting geometry optimization through forces, but not the electronic wavefunction directly.\n\n**Electrostatic embedding** is a more sophisticated and physically realistic approach. In this scheme, the electrostatic influence of the MM environment is included directly in the quantum mechanical electronic Hamiltonian. The MM point charges $\\{q_i\\}$ are treated as a source of a classical external electrostatic potential that acts on both the QM electrons and nuclei. This potential is incorporated into the one-electron part of the Hamiltonian. Consequently, the electronic Schrödinger equation is solved in the presence of the field generated by the MM charges, allowing the QM electron density $\\rho(\\mathbf{r})$ to be polarized in response to the environment. This polarization is a key physical effect captured by electrostatic embedding. The QM-MM electrostatic interaction energy is thus an intrinsic component of the QM energy calculation.\n\nNow, I will derive the expression for the total QM–MM electrostatic embedding energy, $E_{\\mathrm{embed}}$, within the electrostatic embedding framework. The total interaction energy is the sum of the interactions between the MM charges and the QM electrons, and the interactions between the MM charges and the QM nuclei. We work in Hartree atomic units where the elementary charge is $e=1$ and the Coulomb constant $1/(4\\pi\\varepsilon_0)$ is also $1$. The charge of an electron is therefore $-1$.\n\nThe electrostatic potential generated by the set of $M$ classical point charges $q_i$ at positions $\\mathbf{R}_i$ at any point in space $\\mathbf{r}$ is given by:\n$$\nV_{\\mathrm{MM}}(\\mathbf{r}) = \\sum_{i=1}^{M} \\frac{q_i}{|\\mathbf{r} - \\mathbf{R}_i|}\n$$\nThis is the external potential experienced by the QM system.\n\nFirst, consider the interaction between the QM electrons and the MM environment. The charge distribution of the electrons is continuous, described by the charge density $-\\rho(\\mathbf{r})$, where $\\rho(\\mathbf{r})$ is the electron *number* density. The electrostatic interaction energy of a charge distribution with an external potential is the integral of the product of the charge density and the potential over all space.\nThe electron–MM interaction energy, $E_{\\mathrm{e-MM}}$, is therefore:\n$$\nE_{\\mathrm{e-MM}} = \\int (-\\rho(\\mathbf{r})) V_{\\mathrm{MM}}(\\mathbf{r}) d^3\\mathbf{r}\n$$\nSubstituting the expression for $V_{\\mathrm{MM}}(\\mathbf{r})$:\n$$\nE_{\\mathrm{e-MM}} = \\int (-\\rho(\\mathbf{r})) \\left( \\sum_{i=1}^{M} \\frac{q_i}{|\\mathbf{r} - \\mathbf{R}_i|} \\right) d^3\\mathbf{r}\n$$\nWe can interchange the order of integration and summation:\n$$\nE_{\\mathrm{e-MM}} = - \\sum_{i=1}^{M} q_i \\int \\frac{\\rho(\\mathbf{r})}{|\\mathbf{r} - \\mathbf{R}_i|} d^3\\mathbf{r}\n$$\nThis expression represents the total energy of interaction between the QM electron cloud and the classical point charges.\n\nSecond, consider the interaction between the QM nuclei and the MM environment. Within the Born–Oppenheimer approximation, the QM nuclei are treated as fixed point charges $Z_A$ located at positions $\\mathbf{R}_A$. The interaction is a purely classical Coulomb interaction between two sets of point charges. The interaction energy between a single QM nucleus $A$ and a single MM charge $i$ is $\\frac{Z_A q_i}{|\\mathbf{R}_A - \\mathbf{R}_i|}$.\nTo obtain the total nucleus–MM interaction energy, $E_{\\mathrm{nuc-MM}}$, we must sum over all pairs of QM nuclei and MM charges:\n$$\nE_{\\mathrm{nuc-MM}} = \\sum_{A} \\sum_{i=1}^{M} \\frac{Z_A q_i}{|\\mathbf{R}_A - \\mathbf{R}_i|}\n$$\n\nThe total QM–MM electrostatic embedding energy, $E_{\\mathrm{embed}}$, is the sum of the electron-MM and nucleus-MM contributions:\n$$\nE_{\\mathrm{embed}} = E_{\\mathrm{e-MM}} + E_{\\mathrm{nuc-MM}}\n$$\n$$\nE_{\\mathrm{embed}} = - \\sum_{i=1}^{M} q_i \\int \\frac{\\rho(\\mathbf{r})}{|\\mathbf{r} - \\mathbf{R}_i|} d^3\\mathbf{r} + \\sum_{A} \\sum_{i=1}^{M} \\frac{Z_A q_i}{|\\mathbf{R}_A - \\mathbf{R}_i|}\n$$\nThe problem asks for a single closed-form expression. We can combine these terms by factoring out the summation over the MM charges $q_i$:\n$$\nE_{\\mathrm{embed}} = \\sum_{i=1}^{M} q_i \\left( \\sum_{A} \\frac{Z_A}{|\\mathbf{R}_A - \\mathbf{R}_i|} - \\int \\frac{\\rho(\\mathbf{r})}{|\\mathbf{r} - \\mathbf{R}_i|} d^3\\mathbf{r} \\right)\n$$\nThis is the final expression for the electrostatic embedding energy. The term in the parentheses is the total electrostatic potential generated by the QM system (nuclei and electrons) evaluated at the position $\\mathbf{R}_i$ of the $i$-th classical charge.", "answer": "$$\n\\boxed{\\sum_{i=1}^{M} q_{i} \\left( \\sum_{A} \\frac{Z_{A}}{|\\mathbf{R}_{A} - \\mathbf{R}_{i}|} - \\int \\frac{\\rho(\\mathbf{r})}{|\\mathbf{r} - \\mathbf{R}_{i}|} d^3\\mathbf{r} \\right)}\n$$", "id": "2904928"}, {"introduction": "The power of QM/MM methods lies in their ability to predict experimentally observable phenomena. This hands-on exercise demonstrates this by modeling the vibrational Stark effect, where the electric field from the MM environment alters a molecule's vibrational frequency. You will derive and implement a model to calculate the shift in a carbonyl stretching frequency based on the surrounding electrostatic field, providing a direct link between the theoretical framework of electrostatic embedding and a measurable spectroscopic quantity [@problem_id:2904919].", "problem": "A diatomic carbonyl stretch can be modeled as a one-dimensional harmonic oscillator coordinate $x$ aligned with the carbonyl bond axis, where $x$ is the scalar displacement along the bond with $x = 0$ at the equilibrium geometry. In a hybrid Quantum Mechanics/Molecular Mechanics (QM/MM) description with electrostatic embedding, the Molecular Mechanics (MM) environment is represented by fixed classical point charges that generate an external electrostatic field acting on the Quantum Mechanics (QM) electrons. The placement of the QM/MM boundary determines which MM charges are included in the embedding (those outside the QM region) and which are not (those inside the QM region). Your task is to derive, implement, and evaluate how the placement of this boundary influences the carbonyl stretching frequency.\n\nUse the following fundamental base and modeling assumptions:\n- The carbonyl stretch is modeled by a harmonic potential $V_{0}(x) = \\tfrac{1}{2} k_{0} x^{2}$, with baseline force constant $k_{0}$ determined by a baseline wavenumber $\\tilde{\\nu}_{0}$.\n- The reduced mass of the diatomic is $\\mu = \\dfrac{m_{\\mathrm{C}} m_{\\mathrm{O}}}{m_{\\mathrm{C}} + m_{\\mathrm{O}}}$.\n- The classical MM charges $\\{q_{i}\\}$ are fixed in space at positions $\\{\\mathbf{R}_{i}\\}$ relative to the carbonyl bond center (taken as the origin). The electric field at a field point $\\mathbf{r}$ is given by Coulomb’s law, $\\mathbf{E}(\\mathbf{r}) = \\dfrac{1}{4 \\pi \\varepsilon_{0}} \\sum_{i} q_{i} \\dfrac{\\mathbf{r} - \\mathbf{R}_{i}}{\\lVert \\mathbf{r} - \\mathbf{R}_{i} \\rVert^{3}}$.\n- Let $E_{\\parallel}(x)$ denote the component of $\\mathbf{E}(x \\hat{\\mathbf{x}})$ parallel to the bond axis $\\hat{\\mathbf{x}}$. The bond dipole moment $\\mu_{\\mathrm{bond}}(x)$ is expanded about $x=0$ as $\\mu_{\\mathrm{bond}}(x) \\approx \\mu_{\\mathrm{bond}}(0) + \\left(\\dfrac{d \\mu_{\\mathrm{bond}}}{dx}\\right)_{0} x$, where $\\left(\\dfrac{d \\mu_{\\mathrm{bond}}}{dx}\\right)_{0}$ is a constant parameter that characterizes the infrared intensity of the mode. The external electrostatic interaction energy is $U_{\\mathrm{ext}}(x) \\approx - \\mu_{\\mathrm{bond}}(x) E_{\\parallel}(x)$.\n- By Taylor expanding $E_{\\parallel}(x)$ about $x = 0$, and keeping terms through order $x^{2}$, the total potential is $V_{\\mathrm{tot}}(x) = \\tfrac{1}{2} k_{0} x^{2} + U_{\\mathrm{ext}}(x)$ up to quadratic order, which defines an effective force constant $k_{\\mathrm{eff}}$ and hence an effective wavenumber $\\tilde{\\nu}$.\n\nTasks:\n1. Starting from the given fundamentals, and without introducing any unphysical assumptions, derive an expression for the effective force constant $k_{\\mathrm{eff}}$ in terms of $k_{0}$, $\\left(\\dfrac{d \\mu_{\\mathrm{bond}}}{dx}\\right)_{0}$, and the field gradient $\\left.\\dfrac{d E_{\\parallel}}{dx}\\right|_{x=0}$. Your derivation must begin from the expansion of $U_{\\mathrm{ext}}(x) = - \\mu_{\\mathrm{bond}}(x) E_{\\parallel}(x)$ and retain terms up to order $x^{2}$.\n2. Using Coulomb’s law, derive a computable formula for $\\left.\\dfrac{d E_{\\parallel}}{dx}\\right|_{x=0}$ for a general set of point charges $q_{i}$ at positions $\\mathbf{R}_i = (X_i, Y_i, Z_i)$ with respect to the bond center placed at the origin. Your formula should be expressed as a sum over $i$ and must be in terms of $q_i$, $X_i$, $Y_i$, $Z_i$, and fundamental constants.\n3. Given $k_{\\mathrm{eff}}$, compute the wavenumber in wavenumbers (inverse centimeters) as $\\tilde{\\nu} = \\dfrac{1}{2 \\pi c} \\sqrt{\\dfrac{k_{\\mathrm{eff}}}{\\mu}}$, where $c$ is the speed of light expressed in $\\mathrm{cm/s}$. Express the final answers in $\\mathrm{cm^{-1}}$, rounded to three decimal places.\n\nNumerical data and units to be used:\n- Baseline wavenumber: $\\tilde{\\nu}_{0} = 1700.0 \\ \\mathrm{cm^{-1}}$.\n- Atomic masses: $m_{\\mathrm{C}} = 12.0 \\ \\mathrm{u}$ and $m_{\\mathrm{O}} = 16.0 \\ \\mathrm{u}$, where $1 \\ \\mathrm{u} = 1.66053906660 \\times 10^{-27} \\ \\mathrm{kg}$.\n- Derivative of bond dipole along the normal coordinate: $\\left(\\dfrac{d \\mu_{\\mathrm{bond}}}{dx}\\right)_{0} = 0.40 \\ e$, where $e = 1.602176634 \\times 10^{-19} \\ \\mathrm{C}$.\n- Vacuum permittivity: $\\varepsilon_{0} = 8.8541878128 \\times 10^{-12} \\ \\mathrm{F/m}$.\n- Coulomb prefactor: $k_{e} = \\dfrac{1}{4 \\pi \\varepsilon_{0}}$.\n- Speed of light: $c = 2.99792458 \\times 10^{10} \\ \\mathrm{cm/s}$.\n- Geometry and point charges of the MM environment relative to the bond center (units: charges in $e$, coordinates in $\\mathrm{\\AA}$):\n  - $q_1 = +0.30$, $\\mathbf{R}_1 = (-3.00, \\ 2.00, \\ 0.00)$.\n  - $q_2 = -0.50$, $\\mathbf{R}_2 = (+3.00, \\ 0.00, \\ 0.00)$.\n  - $q_3 = +0.20$, $\\mathbf{R}_3 = (+5.00, \\ 1.00, \\ 0.00)$.\n  - $q_4 = -0.10$, $\\mathbf{R}_4 = ( \\ 0.00, \\ 4.00, \\ 0.00)$.\n- Boundary placement rule (spherical QM region of radius $R$ around the bond center): any MM charge with distance $r_i = \\sqrt{X_i^{2} + Y_i^{2} + Z_i^{2}} \\le R$ is considered to be in the QM region and is therefore excluded from the electrostatic embedding; only charges with $r_i > R$ contribute to the embedding field.\n\nTest suite:\n- Use the following boundary radii $R$ (in $\\mathrm{\\AA}$): $[0.00, \\ 3.05, \\ 3.70, \\ 5.20]$.\n- For each $R$, include only charges with $r_i > R$ in the computation of the field gradient and thus in $k_{\\mathrm{eff}}$.\n\nProgram requirements:\n- Implement a program that carries out the derivation-based computation described above to evaluate $\\tilde{\\nu}$ for each radius in the test suite.\n- Use the units exactly as provided. Convert $\\mathrm{\\AA}$ to $\\mathrm{m}$ where needed by $1 \\ \\mathrm{\\AA} = 1.0 \\times 10^{-10} \\ \\mathrm{m}$, and convert charges in $e$ to Coulombs using $e$ as given.\n- Output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each entry rounded to three decimal places in $\\mathrm{cm^{-1}}$ (for example, $[\\tilde{\\nu}_{1},\\tilde{\\nu}_{2},\\tilde{\\nu}_{3},\\tilde{\\nu}_{4}]$).", "solution": "The problem requires the derivation and implementation of a model for the electrostatic Stark tuning of a carbonyl stretching frequency within a Quantum Mechanics/Molecular Mechanics (QM/MM) framework. The solution is structured into three parts as requested: derivation of the effective force constant, derivation of the electric field gradient, and the subsequent numerical calculation.\n\n**Part 1: Derivation of the Effective Force Constant $k_{\\mathrm{eff}}$**\n\nThe system is a diatomic carbonyl stretch, modeled as a one-dimensional harmonic oscillator with coordinate $x$, representing the displacement from the equilibrium bond length. The total potential energy, $V_{\\mathrm{tot}}(x)$, is the sum of the intrinsic harmonic potential of the bond, $V_{0}(x)$, and the interaction energy with the external electrostatic field from the MM environment, $U_{\\mathrm{ext}}(x)$.\n\nThe intrinsic potential is given by:\n$$\nV_{0}(x) = \\frac{1}{2} k_{0} x^{2}\n$$\nwhere $k_{0}$ is the unperturbed force constant of the harmonic oscillator.\n\nThe interaction energy between the bond dipole moment, $\\mu_{\\mathrm{bond}}(x)$, and the component of the external electric field parallel to the bond axis, $E_{\\parallel}(x)$, is:\n$$\nU_{\\mathrm{ext}}(x) = - \\mu_{\\mathrm{bond}}(x) E_{\\parallel}(x)\n$$\n\nTo determine the effective force constant, we must find the second derivative of the total potential, $V_{\\mathrm{tot}}(x) = V_{0}(x) + U_{\\mathrm{ext}}(x)$, with respect to $x$. This requires expanding $U_{\\mathrm{ext}}(x)$ as a Taylor series around the equilibrium position $x=0$ and retaining terms up to the quadratic term in $x$.\n\nThe bond dipole moment, $\\mu_{\\mathrm{bond}}(x)$, and the parallel electric field, $E_{\\parallel}(x)$, are expanded around $x=0$:\n$$\n\\mu_{\\mathrm{bond}}(x) \\approx \\mu_{\\mathrm{bond}}(0) + \\left.\\frac{d\\mu_{\\mathrm{bond}}}{dx}\\right|_{x=0} x\n$$\n$$\nE_{\\parallel}(x) \\approx E_{\\parallel}(0) + \\left.\\frac{dE_{\\parallel}}{dx}\\right|_{x=0} x\n$$\nLet us introduce the shorthand notation $\\mu_{0} = \\mu_{\\mathrm{bond}}(0)$, $\\mu_{1} = \\left.\\frac{d\\mu_{\\mathrm{bond}}}{dx}\\right|_{x=0}$, $E_{0} = E_{\\parallel}(0)$, and $E_{1} = \\left.\\frac{dE_{\\parallel}}{dx}\\right|_{x=0}$. The expansions become:\n$$\n\\mu_{\\mathrm{bond}}(x) \\approx \\mu_{0} + \\mu_{1} x\n$$\n$$\nE_{\\parallel}(x) \\approx E_{0} + E_{1} x\n$$\nSubstituting these into the expression for $U_{\\mathrm{ext}}(x)$:\n$$\nU_{\\mathrm{ext}}(x) \\approx -(\\mu_{0} + \\mu_{1} x)(E_{0} + E_{1} x) = -(\\mu_{0}E_{0} + \\mu_{0}E_{1}x + \\mu_{1}E_{0}x + \\mu_{1}E_{1}x^2)\n$$\nCollecting terms by powers of $x$:\n$$\nU_{\\mathrm{ext}}(x) \\approx -\\mu_{0}E_{0} - (\\mu_{1}E_{0} + \\mu_{0}E_{1})x - \\mu_{1}E_{1}x^2\n$$\nThe total potential energy up to the quadratic term is thus:\n$$\nV_{\\mathrm{tot}}(x) \\approx \\frac{1}{2} k_{0} x^{2} - \\mu_{0}E_{0} - (\\mu_{1}E_{0} + \\mu_{0}E_{1})x - \\mu_{1}E_{1}x^2\n$$\n$$\nV_{\\mathrm{tot}}(x) \\approx -\\mu_{0}E_{0} - (\\mu_{1}E_{0} + \\mu_{0}E_{1})x + \\left(\\frac{1}{2} k_{0} - \\mu_{1}E_{1}\\right)x^2\n$$\nThe effective potential for small oscillations is harmonic. The force constant of a harmonic potential $V(y) = \\frac{1}{2} k y^2$ is $k$. Our potential $V_{\\mathrm{tot}}(x)$ is a quadratic function of $x$. The force constant is given by the second derivative of the potential with respect to the displacement, evaluated at the potential minimum. The second derivative of $V_{\\mathrm{tot}}(x)$ with respect to $x$ is:\n$$\n\\frac{d^2 V_{\\mathrm{tot}}}{dx^2} = \\frac{d^2}{dx^2} \\left[ \\left(\\frac{1}{2} k_{0} - \\mu_{1}E_{1}\\right)x^2 + \\dots \\right] = 2 \\left(\\frac{1}{2} k_{0} - \\mu_{1}E_{1}\\right) = k_{0} - 2\\mu_{1}E_{1}\n$$\nThis second derivative is constant, so its value at the new equilibrium position is the same. Therefore, the effective force constant $k_{\\mathrm{eff}}$ is:\n$$\nk_{\\mathrm{eff}} = k_{0} - 2\\mu_{1}E_{1} = k_{0} - 2 \\left(\\frac{d\\mu_{\\mathrm{bond}}}{dx}\\right)_{0} \\left.\\frac{dE_{\\parallel}}{dx}\\right|_{x=0}\n$$\nThis completes the first task.\n\n**Part 2: Derivation of the Field Gradient $\\left.\\frac{dE_{\\parallel}}{dx}\\right|_{x=0}$**\n\nThe electric field $\\mathbf{E}$ at a field point $\\mathbf{r}$ generated by a set of fixed point charges $\\{q_i\\}$ at positions $\\{\\mathbf{R}_i\\}$ is given by Coulomb's Law:\n$$\n\\mathbf{E}(\\mathbf{r}) = \\frac{1}{4 \\pi \\varepsilon_{0}} \\sum_{i} q_{i} \\frac{\\mathbf{r} - \\mathbf{R}_{i}}{\\lVert \\mathbf{r} - \\mathbf{R}_{i} \\rVert^{3}}\n$$\nLet the bond axis be the $x$-axis, so the unit vector is $\\hat{\\mathbf{x}}$. A point on the bond at displacement $x$ from the center is $\\mathbf{r} = x\\hat{\\mathbf{x}} = (x, 0, 0)$. Let the position of charge $q_i$ be $\\mathbf{R}_i = (X_i, Y_i, Z_i)$. The vector $\\mathbf{r} - \\mathbf{R}_i$ is $(x-X_i, -Y_i, -Z_i)$. The squared norm is $\\lVert \\mathbf{r} - \\mathbf{R}_i \\rVert^2 = (x-X_i)^2 + Y_i^2 + Z_i^2$.\n\nThe component of the electric field parallel to the bond axis is $E_{\\parallel}(x) = \\mathbf{E}(x\\hat{\\mathbf{x}}) \\cdot \\hat{\\mathbf{x}} = E_x(x)$.\n$$\nE_{\\parallel}(x) = \\frac{1}{4 \\pi \\varepsilon_{0}} \\sum_{i} q_{i} \\frac{x-X_i}{\\left( (x-X_i)^2 + Y_i^2 + Z_i^2 \\right)^{3/2}}\n$$\nTo find the field gradient $\\left.\\frac{dE_{\\parallel}}{dx}\\right|_{x=0}$, we differentiate $E_{\\parallel}(x)$ with respect to $x$ and then set $x=0$. The differentiation can be performed term by term for the sum. For a single charge $i$, using the quotient rule $\\frac{d}{dx}\\left(\\frac{u}{v}\\right) = \\frac{u'v - uv'}{v^2}$:\nLet $u = x-X_i$ and $v = ((x-X_i)^2 + Y_i^2 + Z_i^2)^{3/2}$.\n$u' = 1$.\n$v' = \\frac{3}{2}((x-X_i)^2 + Y_i^2 + Z_i^2)^{1/2} \\cdot 2(x-X_i) = 3(x-X_i)((x-X_i)^2 + Y_i^2 + Z_i^2)^{1/2}$.\n\nThe derivative for term $i$ is:\n$$\n\\frac{d}{dx}\\left(\\frac{u}{v}\\right) = \\frac{ ((x-X_i)^2 + Y_i^2 + Z_i^2)^{3/2} - (x-X_i) \\cdot 3(x-X_i)((x-X_i)^2 + Y_i^2 + Z_i^2)^{1/2} }{ \\left( (x-X_i)^2 + Y_i^2 + Z_i^2 \\right)^3 }\n$$\n$$\n= \\frac{ (x-X_i)^2 + Y_i^2 + Z_i^2 - 3(x-X_i)^2 }{ \\left( (x-X_i)^2 + Y_i^2 + Z_i^2 \\right)^{5/2} } = \\frac{ Y_i^2 + Z_i^2 - 2(x-X_i)^2 }{ \\left( (x-X_i)^2 + Y_i^2 + Z_i^2 \\right)^{5/2} }\n$$\nEvaluating this derivative at $x=0$:\n$$\n\\left.\\frac{d}{dx}\\left(\\frac{u}{v}\\right)\\right|_{x=0} = \\frac{ Y_i^2 + Z_i^2 - 2(-X_i)^2 }{ \\left( (-X_i)^2 + Y_i^2 + Z_i^2 \\right)^{5/2} } = \\frac{ Y_i^2 + Z_i^2 - 2X_i^2 }{ \\left( X_i^2 + Y_i^2 + Z_i^2 \\right)^{5/2} }\n$$\nSumming over all charges $i$ included in the MM environment, we obtain the computable formula for the field gradient:\n$$\n\\left.\\frac{dE_{\\parallel}}{dx}\\right|_{x=0} = \\frac{1}{4 \\pi \\varepsilon_{0}} \\sum_{i} q_{i} \\frac{ Y_i^2 + Z_i^2 - 2X_i^2 }{ \\left( X_i^2 + Y_i^2 + Z_i^2 \\right)^{5/2} }\n$$\nThis completes the second task.\n\n**Part 3: Numerical Computation Strategy**\n\nThe numerical calculation proceeds as follows:\n1.  **Calculate Constants in SI Units**: All provided parameters must be converted to a consistent set of units, preferably SI.\n    -   Reduced mass $\\mu = \\frac{m_{\\mathrm{C}} m_{\\mathrm{O}}}{m_{\\mathrm{C}} + m_{\\mathrm{O}}}$, with masses converted from atomic mass units ($u$) to kilograms ($kg$).\n    -   The dipole derivative $\\left(\\frac{d \\mu_{\\mathrm{bond}}}{dx}\\right)_{0}$ from units of $e$ to Coulombs ($C$).\n    -   Coordinates from Angstroms ($\\mathrm{\\AA}$) to meters ($m$).\n    -   Charges from elementary charge units ($e$) to Coulombs ($C$).\n2.  **Calculate Baseline Force Constant $k_{0}$**: The relationship between wavenumber $\\tilde{\\nu}$ (in $cm^{-1}$), reduced mass $\\mu$, and force constant $k$ is $\\tilde{\\nu} = \\frac{1}{2 \\pi c} \\sqrt{\\frac{k}{\\mu}}$. This is rearranged to find $k_0$ from the given $\\tilde{\\nu}_0$:\n    $$\n    k_{0} = \\mu (2 \\pi c \\tilde{\\nu}_{0})^2\n    $$\n    The speed of light $c$ must be used in $cm/s$ to match the units of $\\tilde{\\nu}_0$.\n3.  **Iterate Through Boundary Radii**: For each radius $R$ in the test suite:\n    a.  **Apply Boundary Condition**: For each point charge $q_i$ at $\\mathbf{R}_i$, calculate its distance from the origin, $r_i = \\lVert\\mathbf{R}_i\\rVert = \\sqrt{X_i^2 + Y_i^2 + Z_i^2}$. A charge is included in the electrostatic embedding calculation only if $r_i > R$.\n    b.  **Calculate Field Gradient**: Use the derived formula to calculate $\\left.\\frac{dE_{\\parallel}}{dx}\\right|_{x=0}$ by summing over the included charges. If no charges are included, this term is zero.\n    c.  **Calculate Effective Force Constant $k_{\\mathrm{eff}}$**: Use the derived relation $k_{\\mathrm{eff}} = k_{0} - 2 \\left(\\frac{d\\mu_{\\mathrm{bond}}}{dx}\\right)_{0} \\left.\\frac{dE_{\\parallel}}{dx}\\right|_{x=0}$.\n    d.  **Calculate Effective Wavenumber $\\tilde{\\nu}$**: Convert $k_{\\mathrm{eff}}$ back to a wavenumber:\n        $$\n        \\tilde{\\nu} = \\frac{1}{2 \\pi c} \\sqrt{\\frac{k_{\\mathrm{eff}}}{\\mu}}\n        $$\n4.  **Format Output**: The final results for each radius $R$ are rounded to three decimal places and presented in the specified format. The following program implements this procedure.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes the shift in carbonyl stretching frequency due to an\n    external electrostatic field from MM point charges in a QM/MM model.\n    \"\"\"\n\n    # --- Fundamental Constants and Parameters ---\n    # Baseline wavenumber in cm^-1\n    NU0_CM = 1700.0\n    # Atomic masses in u\n    M_C_U = 12.0\n    M_O_U = 16.0\n    # Dipole derivative in units of e\n    DMU_DX_E = 0.40\n    # Elementary charge in Coulombs\n    E_CHARGE = 1.602176634e-19  # C\n    # Atomic mass unit in kg\n    U_IN_KG = 1.66053906660e-27  # kg\n    # Vacuum permittivity in F/m\n    EPSILON_0 = 8.8541878128e-12  # F/m\n    # Coulomb's constant in N m^2 / C^2\n    K_E = 1 / (4 * np.pi * EPSILON_0)\n    # Speed of light in cm/s\n    C_IN_CMS = 2.99792458e10\n    # Angstrom to meter conversion\n    A_IN_M = 1.0e-10\n\n    # --- MM Environment Data ---\n    # Charges [q in e, X in Å, Y in Å, Z in Å]\n    charges_data = np.array([\n        [+0.30, -3.00, 2.00, 0.00],\n        [-0.50, +3.00, 0.00, 0.00],\n        [+0.20, +5.00, 1.00, 0.00],\n        [-0.10, 0.00, 4.00, 0.00]\n    ])\n\n    # --- Test Suite ---\n    # Boundary radii in Å\n    boundary_radii_A = [0.00, 3.05, 3.70, 5.20]\n\n    # --- Step 1: Calculate derived constants in SI units ---\n\n    # Reduced mass in kg\n    mu_kg = (M_C_U * M_O_U) / (M_C_U + M_O_U) * U_IN_KG\n\n    # Baseline force constant in N/m\n    # k = mu * (2*pi*nu)^2 = mu * (2*pi*c*nu_tilde)^2\n    # Ensure units are consistent: mu (kg), c (cm/s), nu_tilde (cm^-1)\n    k0 = mu_kg * (2 * np.pi * C_IN_CMS * NU0_CM)**2\n\n    # Dipole derivative in C (Coulombs)\n    dmu_dx_C = DMU_DX_E * E_CHARGE\n\n    # --- Step 2: Iterate through test cases ---\n    results_nu = []\n\n    for boundary_R_A in boundary_radii_A:\n        # Filter charges based on the boundary radius\n        positions_A = charges_data[:, 1:]\n        distances_A = np.linalg.norm(positions_A, axis=1)\n        \n        active_mask = distances_A > boundary_R_A\n        active_charges = charges_data[active_mask]\n\n        if active_charges.shape[0] == 0:\n            # No charges in the MM environment, so no field gradient\n            grad_E_parallel = 0.0\n        else:\n            # Convert active charge data to SI units for calculation\n            q_C = active_charges[:, 0] * E_CHARGE\n            X_m = active_charges[:, 1] * A_IN_M\n            Y_m = active_charges[:, 2] * A_IN_M\n            Z_m = active_charges[:, 3] * A_IN_M\n\n            # Calculate the field gradient using the derived formula\n            # grad_E = sum_i( K_E * q_i * (Y_i^2 + Z_i^2 - 2*X_i^2) / (X_i^2 + Y_i^2 + Z_i^2)^(5/2) )\n            R_sq_m = X_m**2 + Y_m**2 + Z_m**2\n            \n            numerator = Y_m**2 + Z_m**2 - 2 * X_m**2\n            denominator = R_sq_m**(5/2)\n            \n            # Sum over all active charges\n            sum_terms = np.sum(q_C * numerator / denominator)\n            \n            grad_E_parallel = K_E * sum_terms\n\n        # Calculate effective force constant\n        # k_eff = k0 - 2 * (dmu/dx) * (dE/dx)\n        k_eff = k0 - 2 * dmu_dx_C * grad_E_parallel\n\n        # Calculate new wavenumber in cm^-1\n        # nu_tilde = (1 / (2*pi*c)) * sqrt(k_eff / mu)\n        if k_eff  0:\n            # Handle physically unrealistic case of negative force constant\n            nu_eff_cm = np.nan\n        else:\n            nu_eff_cm = (1 / (2 * np.pi * C_IN_CMS)) * np.sqrt(k_eff / mu_kg)\n        \n        results_nu.append(nu_eff_cm)\n\n    # Format the final output as specified\n    formatted_results = [f\"{res:.3f}\" for res in results_nu]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2904919"}]}