{"hands_on_practices": [{"introduction": "At the heart of many-body theory is the concept of a quasiparticle, a particle-like entity whose energy and lifetime are modified by its complex interactions with the surrounding system. The self-energy, $\\Sigma$, mathematically encapsulates these interactions. This exercise [@problem_id:2930200] provides a direct, analytical look at this relationship by having you solve Dyson's equation for a simple yet insightful model self-energy, allowing you to derive the fundamental properties of a quasiparticle from the Green's function.", "problem": "Consider a single, nondegenerate molecular orbital with noninteracting energy $\\,\\varepsilon_{0}\\,$ (measured relative to the chemical potential) whose many-body effects are approximated within the Green’s function–screened Coulomb interaction (GW) framework by a frequency-independent retarded self-energy $\\,\\Sigma^{R}(\\omega)=\\Delta-\\mathrm{i}\\gamma\\,$, where $\\,\\Delta\\in\\mathbb{R}\\,$ represents an energy shift and $\\,\\gamma>0\\,$ represents a finite lifetime broadening. Work in units with $\\,\\hbar=1\\,$ and use the retarded single-particle Green’s function. Starting from the fundamental definitions of the retarded Green’s function and Dyson’s equation, and from the definition of the spectral function, do the following:\n\n1) Solve Dyson’s equation to obtain the interacting retarded Green’s function $\\,G^{R}(\\omega)\\,$ for this orbital.\n\n2) Determine the quasiparticle energy by locating the real part of the pole of $\\,G^{R}(\\omega)\\,$.\n\n3) Determine the quasiparticle lifetime from the imaginary part of the pole, or equivalently from the temporal decay implied by $\\,G^{R}(\\omega)\\,$.\n\n4) Determine the quasiparticle spectral weight (renormalization factor) using its definition in terms of the frequency derivative of the real part of the self-energy evaluated at the quasiparticle energy.\n\nExpress your final answers as closed-form analytic expressions in terms of $\\,\\omega\\,$, $\\,\\varepsilon_{0}\\,$, $\\,\\Delta\\,$, and $\\,\\gamma\\,$. Do not include units in your final expressions. Provide the final result as a row matrix in the order $\\bigl(G^{R}(\\omega),\\,E_{\\mathrm{qp}},\\,\\tau,\\,Z\\bigr)$. No numerical approximation or rounding is required.", "solution": "The solution starts from Dyson's equation, which relates the interacting Green's function $G^{R}(\\omega)$ to the noninteracting Green's function $G_{0}^{R}(\\omega)$ and the self-energy $\\Sigma^{R}(\\omega)$. The algebraic form of the equation is:\n$$\n(G^{R}(\\omega))^{-1} = (G_{0}^{R}(\\omega))^{-1} - \\Sigma^{R}(\\omega)\n$$\nFor a single, noninteracting electronic level with energy $\\varepsilon_{0}$, the retarded Green's function has a simple pole at $\\omega = \\varepsilon_{0}$. Its inverse is given by:\n$$\n(G_{0}^{R}(\\omega))^{-1} = \\omega - \\varepsilon_{0}\n$$\nThe problem specifies the retarded self-energy as a frequency-independent constant:\n$$\n\\Sigma^{R}(\\omega) = \\Delta - \\mathrm{i}\\gamma\n$$\nSubstituting these expressions into Dyson's equation gives the inverse of the interacting Green's function:\n$$\n(G^{R}(\\omega))^{-1} = (\\omega - \\varepsilon_{0}) - (\\Delta - \\mathrm{i}\\gamma) = \\omega - (\\varepsilon_{0} + \\Delta) + \\mathrm{i}\\gamma\n$$\n**1) Interacting Retarded Green's Function $G^{R}(\\omega)$**\nBy inverting the expression above, we obtain the interacting retarded Green's function:\n$$\nG^{R}(\\omega) = \\frac{1}{\\omega - (\\varepsilon_{0} + \\Delta) + \\mathrm{i}\\gamma}\n$$\nThis is the first part of the solution. This expression describes a quasiparticle state with a shifted energy and a finite lifetime.\n\n**2) Quasiparticle Energy $E_{\\mathrm{qp}}$**\nThe quasiparticle properties are encoded in the pole of the interacting Green's function, $\\omega_{p}$. The pole is the complex value of $\\omega$ for which the denominator of $G^{R}(\\omega)$ vanishes:\n$$\n\\omega_{p} - (\\varepsilon_{0} + \\Delta) + \\mathrm{i}\\gamma = 0\n$$\nSolving for $\\omega_{p}$ yields:\n$$\n\\omega_{p} = \\varepsilon_{0} + \\Delta - \\mathrm{i}\\gamma\n$$\nThe quasiparticle energy, $E_{\\mathrm{qp}}$, is defined as the real part of the pole:\n$$\nE_{\\mathrm{qp}} = \\mathrm{Re}(\\omega_{p}) = \\varepsilon_{0} + \\Delta\n$$\nThis shows that the many-body interactions, within this model, shift the original energy $\\varepsilon_{0}$ by a constant amount $\\Delta$.\n\n**3) Quasiparticle Lifetime $\\tau$**\nThe lifetime of the quasiparticle is determined by the imaginary part of the pole. The time evolution of the quasiparticle wavefunction amplitude contains a factor of $\\exp(-\\mathrm{i}\\omega_{p}t) = \\exp(-\\mathrm{i}E_{\\mathrm{qp}}t)\\exp(-\\gamma t)$. The probability of finding the particle in this state decays as $|\\exp(-\\gamma t)|^{2} = \\exp(-2\\gamma t)$. The lifetime $\\tau$ is the inverse of the decay rate of the probability. The decay rate is $\\Gamma = 2\\gamma$.\nAlternatively, and more formally, we can consider the spectral function $A(\\omega) = -\\frac{1}{\\pi}\\mathrm{Im}(G^{R}(\\omega))$:\n$$\nA(\\omega) = -\\frac{1}{\\pi}\\mathrm{Im}\\left(\\frac{1}{\\omega - E_{\\mathrm{qp}} + \\mathrm{i}\\gamma}\\right) = -\\frac{1}{\\pi}\\mathrm{Im}\\left(\\frac{\\omega - E_{\\mathrm{qp}} - \\mathrm{i}\\gamma}{(\\omega - E_{\\mathrm{qp}})^{2} + \\gamma^{2}}\\right) = \\frac{1}{\\pi}\\frac{\\gamma}{(\\omega - E_{\\mathrm{qp}})^{2} + \\gamma^{2}}\n$$\nThis is a Lorentzian distribution with a half-width at half-maximum (HWHM) equal to $\\gamma$. The full-width at half-maximum (FWHM), which represents the energy uncertainty of the state, is $\\Gamma = 2\\gamma$. The lifetime $\\tau$ is related to this width by the energy-time uncertainty principle, $\\tau = \\hbar/\\Gamma$. Since we work in units where $\\hbar=1$, the lifetime is:\n$$\n\\tau = \\frac{1}{\\Gamma} = \\frac{1}{2\\gamma}\n$$\n\n**4) Quasiparticle Spectral Weight $Z$**\nThe quasiparticle spectral weight, or renormalization factor $Z$, quantifies the fraction of the total spectral weight that is contained within the coherent quasiparticle peak. It is defined by the relation:\n$$\nZ^{-1} = 1 - \\frac{\\partial \\mathrm{Re}[\\Sigma^{R}(\\omega)]}{\\partial \\omega} \\bigg|_{\\omega = E_{\\mathrm{qp}}}\n$$\nThe real part of the given self-energy is:\n$$\n\\mathrm{Re}[\\Sigma^{R}(\\omega)] = \\mathrm{Re}[\\Delta - \\mathrm{i}\\gamma] = \\Delta\n$$\nSince $\\Delta$ is a constant, its derivative with respect to frequency $\\omega$ is zero:\n$$\n\\frac{\\partial \\mathrm{Re}[\\Sigma^{R}(\\omega)]}{\\partial \\omega} = \\frac{\\partial \\Delta}{\\partial \\omega} = 0\n$$\nTherefore, the inverse of the renormalization factor is:\n$$\nZ^{-1} = 1 - 0 = 1\n$$\nThis gives a quasiparticle spectral weight of:\n$$\nZ = 1\n$$\nThis result is expected. A frequency-independent self-energy corresponds to a model where the quasiparticle pole is simple and contains the entirety of the spectral strength; there is no transfer of spectral weight to an incoherent background.\n\nCombining these four results into the requested row matrix gives the final answer.\n- $G^{R}(\\omega) = \\frac{1}{\\omega - (\\varepsilon_{0} + \\Delta) + \\mathrm{i}\\gamma}$\n- $E_{\\mathrm{qp}} = \\varepsilon_{0} + \\Delta$\n- $\\tau = \\frac{1}{2\\gamma}$\n- $Z = 1$", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{\\omega - (\\varepsilon_{0} + \\Delta) + \\mathrm{i}\\gamma} & \\varepsilon_{0} + \\Delta & \\frac{1}{2\\gamma} & 1 \\end{pmatrix}}\n$$", "id": "2930200"}, {"introduction": "Building upon the fundamental concepts, we now move to a more concrete physical scenario. While the first exercise used a generic model for the self-energy, practical calculations require specific approximations for $\\Sigma(\\omega)$. This problem [@problem_id:1147575] introduces the static Coulomb Hole and Screened Exchange (COHSEX) approximation and applies it to a two-dimensional electron gas, a cornerstone model in condensed matter physics, giving you hands-on experience in evaluating quasiparticle energy corrections.", "problem": "In the context of many-body Green's function theory, the GW approximation provides a method to calculate the quasiparticle energies of an interacting electron system. The self-energy $\\Sigma$ captures the effects of exchange and correlation. A common simplification is the static COHSEX (Coulomb Hole and Screened Exchange) approximation, where the self-energy is taken to be frequency-independent.\n\nConsider a two-dimensional electron gas (2DEG) with a parabolic non-interacting dispersion $\\epsilon_{\\mathbf{k}} = \\frac{\\hbar^2 |\\mathbf{k}|^2}{2m}$ for an electron with wavevector $\\mathbf{k}$. At zero temperature, the electrons fill all states up to a Fermi wavevector $k_F$. The system's many-body effects are described by the static COHSEX self-energy $\\Sigma(\\mathbf{k})$, which gives the first-order quasiparticle energy correction $\\Delta E_\\mathbf{k} = \\Sigma(\\mathbf{k})$.\n\nThe self-energy is split into two parts: the Screened Exchange (SEX) term, $\\Sigma^{SEX}(\\mathbf{k})$, and the Coulomb Hole (COH) term, $\\Sigma^{COH}$.\n$$\n\\Sigma(\\mathbf{k}) = \\Sigma^{COH} + \\Sigma^{SEX}(\\mathbf{k})\n$$\nThe k-independent COH term is given by the difference between the static screened interaction $W(\\mathbf{q})$ and the bare Coulomb interaction $v(\\mathbf{q})$:\n$$\n\\Sigma^{COH} = \\frac{1}{2} \\int \\frac{d^2q}{(2\\pi)^2} \\left[ W(\\mathbf{q}) - v(\\mathbf{q}) \\right]\n$$\nThe k-dependent SEX term is given by:\n$$\n\\Sigma^{SEX}(\\mathbf{k}) = - \\int_{|\\mathbf{k'}| < k_F} \\frac{d^2k'}{(2\\pi)^2} W(|\\mathbf{k}-\\mathbf{k'}|)\n$$\nwhere the integral is over all occupied states.\n\nFor a 2DEG, the bare Coulomb interaction in Fourier space is $v(q) = V_0/q$, where $q=|\\mathbf{q}|$ and $V_0$ is a constant representing the interaction strength. A simple, regularized model for the static screened interaction is given by:\n$$\nW(q) = \\frac{V_0}{\\sqrt{q^2 + q_s^2}}\n$$\nwhere $q_s$ is a constant screening wavevector. This model captures the correct bare interaction behavior at large $q$ ($W(q) \\approx v(q)$) and models screening at small $q$.\n\nCalculate the total quasiparticle energy correction, $\\Delta E_0 = \\Sigma(k=0)$, for the state at the band minimum ($\\mathbf{k}=0$), which is the lowest occupied state. Express your answer in terms of $V_0$, $k_F$, and $q_s$.", "solution": "We wish to compute \n$$\\Delta E_0=\\Sigma(0)=\\Sigma^{COH}+\\Sigma^{SEX}(0)\\,. $$\n\n1.  COH term:\n$$\n\\Sigma^{COH}=\\frac12\\int\\frac{d^2q}{(2\\pi)^2}\\Bigl[W(q)-v(q)\\Bigr]\n=\\frac1{4\\pi}\\int_0^\\infty q\\,dq\\Bigl[\\frac{V_0}{\\sqrt{q^2+q_s^2}}-\\frac{V_0}{q}\\Bigr].\n$$\nDefine \n$$I=\\int_0^\\infty\\Bigl(\\frac{q}{\\sqrt{q^2+q_s^2}}-1\\Bigr)dq\n=\\lim_{\\Lambda\\to\\infty}\\bigl[\\sqrt{\\Lambda^2+q_s^2}-q_s-\\Lambda\\bigr]\n=-q_s.\n$$\nHence\n$$\n\\Sigma^{COH}=\\frac{V_0}{4\\pi}\\,I\n=-\\frac{V_0\\,q_s}{4\\pi}.\n$$\n\n2.  SEX term at $k=0$:\n$$\n\\Sigma^{SEX}(0)=-\\int_{|\\mathbf k'|<k_F}\\frac{d^2k'}{(2\\pi)^2}\\,W(k')\n=-\\frac{1}{2\\pi}\\int_0^{k_F}k'\\,dk'\\,\\frac{V_0}{\\sqrt{k'^2+q_s^2}}.\n$$\nLet $u=k'^2+q_s^2$, $du=2k'\\,dk'$.  Then\n$$\n\\int_0^{k_F}\\frac{k'\\,dk'}{\\sqrt{k'^2+q_s^2}}\n=\\frac12\\int_{q_s^2}^{k_F^2+q_s^2}u^{-1/2}du\n=\\sqrt{k_F^2+q_s^2}-q_s.\n$$\nThus\n$$\n\\Sigma^{SEX}(0)\n=-\\frac{V_0}{2\\pi}\\Bigl[\\sqrt{k_F^2+q_s^2}-q_s\\Bigr].\n$$\n\n3.  Total:\n$$\n\\Delta E_0\n=-\\frac{V_0}{4\\pi}q_s\\;-\\;\\frac{V_0}{2\\pi}\\bigl[\\sqrt{k_F^2+q_s^2}-q_s\\bigr]\n=-\\frac{V_0}{2\\pi}\\sqrt{k_F^2+q_s^2}+\\frac{V_0\\,q_s}{4\\pi}\n=\\frac{V_0}{4\\pi}\\bigl(q_s-2\\sqrt{k_F^2+q_s^2}\\bigr).\n$$", "answer": "$$\\boxed{\\frac{V_{0}}{4\\pi}\\bigl(q_{s}-2\\sqrt{k_{F}^{2}+q_{s}^{2}}\\bigr)}$$", "id": "1147575"}, {"introduction": "The ultimate goal of methods like the GW approximation is to compute measurable properties of real materials, a task that bridges analytical theory with computational implementation. This final practice [@problem_id:2930201] is a coding challenge that brings all the concepts together. You will implement a simplified GW model to calculate the electronic band gap of crystalline silicon, demonstrating how theoretical formulas are translated into a computational workflow and highlighting the practical importance of numerical convergence.", "problem": "Consider a simplified, spherically averaged implementation of the single-shot Green’s function times screened Coulomb interaction approximation ($G_{0}W_{0}$) for the indirect band gap of crystalline silicon. The goal is to compute a quasiparticle band gap using a plasmon-pole model and to assess convergence with respect to the number of empty bands and the dielectric cutoff. Your program must implement a self-contained model based on first principles and physically motivated approximations, and must not use any external input.\n\nStart from the following well-tested foundations and core definitions:\n\n- The many-body self-energy in Hedin’s equations, where the diagonal quasiparticle correction is defined by $E_{n}^{\\mathrm{QP}} \\approx E_{n}^{\\mathrm{KS}} + \\langle \\phi_{n} | \\Sigma(E_{n}^{\\mathrm{KS}}) - V_{\\mathrm{xc}} | \\phi_{n} \\rangle$, with $G_{0}W_{0}$ using the Kohn–Sham (KS) Green’s function and the screened Coulomb interaction built from the random phase approximation (RPA). Here, $E_{n}^{\\mathrm{QP}}$ is the quasiparticle energy, $E_{n}^{\\mathrm{KS}}$ is the Kohn–Sham energy, $\\phi_{n}$ is the KS orbital, $\\Sigma$ is the self-energy, and $V_{\\mathrm{xc}}$ is the exchange–correlation potential from density functional theory (DFT).\n- The screened Coulomb interaction is $W(\\mathbf{r},\\mathbf{r}';\\omega) = \\int d\\mathbf{r}'' \\,\\epsilon^{-1}(\\mathbf{r},\\mathbf{r}'';\\omega)\\, v(\\mathbf{r}''-\\mathbf{r}')$, where $v$ is the bare Coulomb potential and $\\epsilon$ is the dielectric function in RPA. In reciprocal space for a homogeneous reference, the bare Coulomb potential is $v(G) = \\dfrac{4\\pi}{G^{2}}$ in atomic units.\n- A generalized plasmon-pole model (PPM) approximates the frequency dependence of the inverse dielectric function by a single effective pole per reciprocal vector $G$, matched to static limits. In particular, the static limit $W(G,\\omega=0)$ is consistent with the PPM and suffices for deriving a static screened-exchange plus Coulomb-hole (COHSEX) form that captures the dominant trends of $G_{0}W_{0}$ corrections.\n\nYou must derive and implement a static, spherically averaged COHSEX model consistent with a plasmon-pole description of $W$ that allows systematic variation of screening quality by two numerical parameters:\n\n- The number of empty bands $N_{\\mathrm{emp}}$, which controls the saturation of the RPA screening through the completeness of the particle–hole transitions. Model this as a monotone saturation of an effective Thomas–Fermi-like screening wavevector $k_{\\mathrm{s}}(N_{\\mathrm{emp}})$.\n- A dielectric plane-wave cutoff energy $E_{\\mathrm{cut}}$ (in electronvolts), which limits the largest included reciprocal vectors $G$ through the kinetic energy relation $E_{G} = \\dfrac{G^{2}}{2}$ in Hartree. This implies a maximum $G$ given by $G_{\\max} = \\sqrt{2 E_{\\mathrm{cut}}^{\\mathrm{Ha}}}$, where $E_{\\mathrm{cut}}^{\\mathrm{Ha}}$ is $E_{\\mathrm{cut}}$ converted to Hartree.\n\nAssume the following physically motivated and scientifically consistent simplifications to make the problem computationally tractable while preserving first-principles structure:\n\n1) Use the static COHSEX decomposition for the diagonal matrix element in a plane-wave, spherically averaged representation,\n   - Screened exchange (SEX) for the highest occupied valence state $v$: \n     $$\\Sigma_{\\mathrm{SEX},v} = - \\int \\frac{d^{3}G}{(2\\pi)^{3}} \\, W(G,0)\\, |\\rho_{v}(G)|^{2},$$\n     and for the lowest unoccupied conduction state $c$ set $\\Sigma_{\\mathrm{SEX},c} \\approx 0$ to model that the change in exchange upon electron addition is dominated by the occupied sector.\n   - Coulomb hole (COH) for a state $n \\in \\{v,c\\}$:\n     $$\\Sigma_{\\mathrm{COH},n} = \\frac{1}{2} \\int \\frac{d^{3}G}{(2\\pi)^{3}} \\, \\big[ W(G,0) - v(G) \\big] \\, |\\rho_{n}(G)|^{2}.$$\n   Here, $|\\rho_{n}(G)|^{2}$ is the squared diagonal density form factor of the state $n$ in reciprocal space.\n\n2) Model the static $W(G,0)$ with a Thomas–Fermi-like screening consistent with the static limit of a plasmon-pole model:\n   $$W(G,0) = \\frac{v(G)}{\\epsilon(G,0)}, \\quad \\epsilon(G,0) = 1 + \\frac{k_{\\mathrm{s}}(N_{\\mathrm{emp}})^{2}}{G^{2}}, \\quad v(G)=\\frac{4\\pi}{G^{2}}.$$\n\n3) Model $k_{\\mathrm{s}}(N_{\\mathrm{emp}})$ as a monotone saturation function that reflects the convergence of RPA screening as more empty states are included:\n   $$k_{\\mathrm{s}}(N_{\\mathrm{emp}}) = k_{\\mathrm{s}}^{(\\infty)} \\left( 1 - e^{-N_{\\mathrm{emp}}/N_{0}}\\right),$$\n   where $k_{\\mathrm{s}}^{(\\infty)}$ and $N_{0}$ are positive constants.\n\n4) Model $|\\rho_{n}(G)|^{2}$ by spherically averaged Gaussian form factors that decay with $G$ at a rate set by a state-dependent parameter $\\gamma_{n}$:\n   $$|\\rho_{n}(G)|^{2} = \\exp\\left( - \\left(\\frac{G}{\\gamma_{n}}\\right)^{2} \\right).$$\n   Use distinct $\\gamma_{v}$ and $\\gamma_{c}$ to represent different real-space localizations of the valence and conduction states.\n\n5) Approximate the integral in reciprocal space by a spherical shell quadrature with a uniform grid of magnitudes $G_{j} = j\\,\\Delta G$ for integers $j \\ge 1$ up to $G_{\\max}$, with radial shell weights\n   $$w(G_{j}) = \\frac{4\\pi\\, G_{j}^{2}\\, \\Delta G}{(2\\pi)^{3}}.$$\n\n6) Use a single global scaling factor $S_{0}$ to account for omitted crystalline local-field effects and anisotropies, applied multiplicatively to both $\\Sigma_{\\mathrm{SEX}}$ and $\\Sigma_{\\mathrm{COH}}$. This maintains the qualitative physics and produces energies in a physically reasonable range.\n\nUsing the above, the quasiparticle band gap in electronvolts is defined by\n$$E_{g}^{\\mathrm{QP}} = E_{g}^{\\mathrm{KS}} + \\Delta E_{g}^{\\mathrm{GW}}, \\quad \\Delta E_{g}^{\\mathrm{GW}} = \\left[\\Sigma_{\\mathrm{COH},c} - \\Sigma_{\\mathrm{COH},v}\\right] - \\Sigma_{\\mathrm{SEX},v},$$\nwhere all self-energy quantities are computed in Hartree and then converted to electronvolts. The Kohn–Sham band gap is fixed to\n$$E_{g}^{\\mathrm{KS}} = 0.600 \\;\\text{eV}.$$\n\nConstants and parameter values to be used in your program:\n\n- Atomic unit conversion: $1$ Hartree $= 27.211386245988$ electronvolts.\n- Screening parameters: $k_{\\mathrm{s}}^{(\\infty)} = 1.000$ (in Bohr$^{-1}$), $N_{0} = 50.0$.\n- Form factor parameters: $\\gamma_{v} = 1.000$ (in Bohr$^{-1}$), $\\gamma_{c} = 0.700$ (in Bohr$^{-1}$).\n- Radial grid step: $\\Delta G = 0.300$ (in Bohr$^{-1}$).\n- Global scale: $S_{0} = 0.500$ (dimensionless).\n- Kinetic relation for the dielectric cutoff: given $E_{\\mathrm{cut}}$ in electronvolts, convert to Hartree $E_{\\mathrm{cut}}^{\\mathrm{Ha}} = \\dfrac{E_{\\mathrm{cut}}}{27.211386245988}$, then set $G_{\\max} = \\sqrt{2 E_{\\mathrm{cut}}^{\\mathrm{Ha}}}$, and include all $G_{j}$ such that $G_{j} \\le G_{\\max}$.\n\nRequired computations:\n\n- For each test case $(N_{\\mathrm{emp}}, E_{\\mathrm{cut}})$, compute $E_{g}^{\\mathrm{QP}}$ in electronvolts using the above model. Express each $E_{g}^{\\mathrm{QP}}$ in electronvolts rounded to three decimal places.\n- To assess convergence, internally compute a reference quasiparticle band gap $E_{g}^{\\mathrm{QP,ref}}$ at $N_{\\mathrm{emp}}^{\\mathrm{ref}} = 800$ and $E_{\\mathrm{cut}}^{\\mathrm{ref}} = 400.0$ electronvolts, using the same model and parameters. For each test case, also compute the absolute deviation $|E_{g}^{\\mathrm{QP}} - E_{g}^{\\mathrm{QP,ref}}|$ in electronvolts, rounded to three decimal places.\n\nTest suite:\n\n- Use the following ordered list of parameter pairs $(N_{\\mathrm{emp}}, E_{\\mathrm{cut}})$:\n  - $(20, 10.0)$\n  - $(200, 100.0)$\n  - $(50, 40.0)$\n  - $(5, 5.0)$\n  - $(500, 200.0)$\n\nAngle units are not applicable. All energies must be reported in electronvolts.\n\nFinal output format:\n\n- Your program should produce a single line of output containing a comma-separated list enclosed in square brackets. The list must contain exactly $2T$ floats rounded to three decimal places, where $T$ is the number of test cases. The first $T$ entries are the computed quasiparticle gaps $E_{g}^{\\mathrm{QP}}$ for the test cases in the specified order. The next $T$ entries are the corresponding absolute deviations with respect to the internal reference $E_{g}^{\\mathrm{QP,ref}}$, in the same order. For example, an output with $T=3$ would look like $[x_{1},x_{2},x_{3},d_{1},d_{2},d_{3}]$ where each $x_{i}$ and $d_{i}$ are floats rounded to three decimals.\n\nYour submitted solution must be a complete, runnable program that performs the above computations without requiring user input or external files.", "solution": "The objective is to compute the quasiparticle band gap, $E_g^{\\mathrm{QP}}$, using a simplified $G_0W_0$ model. The starting point is the Kohn-Sham gap, $E_g^{\\mathrm{KS}}$, corrected by the difference in self-energy terms for the conduction band minimum (c) and valence band maximum (v):\n$$E_{g}^{\\mathrm{QP}} = E_{g}^{\\mathrm{KS}} + \\left[ E_{c}^{\\mathrm{QP}} - E_{v}^{\\mathrm{QP}} \\right] - \\left[ E_{c}^{\\mathrm{KS}} - E_{v}^{\\mathrm{KS}} \\right] = E_{g}^{\\mathrm{KS}} + \\Delta E_g^{\\mathrm{GW}}$$\nThe quasiparticle correction for a state $n$ is $\\Delta_n = \\Sigma_n - V_{\\mathrm{xc},n}$. The gap correction is $\\Delta E_g^{\\mathrm{GW}} = \\Delta_c - \\Delta_v$. Within the static COHSEX approximation, the self-energy $\\Sigma_n$ is decomposed into a screened-exchange part, $\\Sigma_{\\mathrm{SEX},n}$, and a Coulomb-hole part, $\\Sigma_{\\mathrm{COH},n}$. The problem specifies $\\Sigma_{\\mathrm{SEX},c} \\approx 0$. Thus, the total gap correction becomes:\n$$\\Delta E_g^{\\mathrm{GW}} = (\\Sigma_{\\mathrm{COH},c} - V_{\\mathrm{xc},c}) - (\\Sigma_{\\mathrm{COH},v} - V_{\\mathrm{xc},v}) - (\\Sigma_{\\mathrm{SEX},v} - V_{\\mathrm{xc},v})$$\nAssuming the cancellation $V_{\\mathrm{xc},c} \\approx V_{\\mathrm{xc},v}$ (a common simplification), we arrive at the expression provided:\n$$\\Delta E_g^{\\mathrm{GW}} = \\Sigma_{\\mathrm{COH},c} - \\Sigma_{\\mathrm{COH},v} - \\Sigma_{\\mathrm{SEX},v}$$\nAll self-energy terms will be computed in Hartree and must include the global scaling factor $S_0$.\n\nFirst, we derive the analytical expressions for the integrands. The static screened potential $W(G,0)$ is:\n$$W(G,0) = \\frac{v(G)}{\\epsilon(G,0)} = \\frac{4\\pi/G^2}{1 + (k_s/G)^2} = \\frac{4\\pi}{G^2 + k_s^2}$$\nwhere $k_s$ is a shorthand for $k_{\\mathrm{s}}(N_{\\mathrm{emp}})$. The difference term appearing in the COH expression is:\n$$W(G,0) - v(G) = \\frac{4\\pi}{G^2 + k_s^2} - \\frac{4\\pi}{G^2} = 4\\pi \\frac{G^2 - (G^2 + k_s^2)}{G^2(G^2+k_s^2)} = -\\frac{4\\pi k_s^2}{G^2(G^2+k_s^2)}$$\n\nThe integral over reciprocal space, $\\int \\frac{d^3 G}{(2\\pi)^3} f(G)$, is approximated by a summation over spherical shells:\n$$\\int \\frac{d^3 G}{(2\\pi)^3} f(G) \\approx \\sum_{j=1}^{J_{\\max}} w(G_j) f(G_j) = \\sum_{j=1}^{J_{\\max}} \\frac{4\\pi G_j^2 \\Delta G}{(2\\pi)^3} f(G_j) = \\frac{\\Delta G}{2\\pi^2} \\sum_{j=1}^{J_{\\max}} G_j^2 f(G_j)$$\nwhere $G_j = j \\Delta G$ and $J_{\\max} = \\lfloor G_{\\max} / \\Delta G \\rfloor$.\n\nUsing this quadrature, we express the self-energy components:\nFor the screened exchange of the valence state:\n$$\\Sigma_{\\mathrm{SEX},v} = -S_0 \\frac{\\Delta G}{2\\pi^2} \\sum_{j=1}^{J_{\\max}} G_j^2 \\left( \\frac{4\\pi}{G_j^2 + k_s^2} \\right) \\exp\\left(-\\frac{G_j^2}{\\gamma_v^2}\\right) = -S_0 \\frac{2\\Delta G}{\\pi} \\sum_{j=1}^{J_{\\max}} \\frac{G_j^2}{G_j^2 + k_s^2} \\exp\\left(-\\frac{G_j^2}{\\gamma_v^2}\\right)$$\nFor the Coulomb hole of a state $n \\in \\{v,c\\}$:\n$$\\Sigma_{\\mathrm{COH},n} = \\frac{S_0}{2} \\frac{\\Delta G}{2\\pi^2} \\sum_{j=1}^{J_{\\max}} G_j^2 \\left( -\\frac{4\\pi k_s^2}{G_j^2(G_j^2+k_s^2)} \\right) \\exp\\left(-\\frac{G_j^2}{\\gamma_n^2}\\right) = -S_0 \\frac{\\Delta G k_s^2}{\\pi} \\sum_{j=1}^{J_{\\max}} \\frac{1}{G_j^2 + k_s^2} \\exp\\left(-\\frac{G_j^2}{\\gamma_n^2}\\right)$$\nCombining these terms gives the total gap correction in Hartrees:\n$$\\Delta E_g^{\\mathrm{GW}} = \\Sigma_{\\mathrm{COH},c} - \\Sigma_{\\mathrm{COH},v} - \\Sigma_{\\mathrm{SEX},v}$$\n$$\\Delta E_g^{\\mathrm{GW}} = \\frac{S_0 \\Delta G}{\\pi} \\sum_{j=1}^{J_{\\max}} \\left[ -k_s^2 \\frac{\\exp(-G_j^2/\\gamma_c^2)}{G_j^2+k_s^2} + k_s^2 \\frac{\\exp(-G_j^2/\\gamma_v^2)}{G_j^2+k_s^2} + 2 \\frac{G_j^2 \\exp(-G_j^2/\\gamma_v^2)}{G_j^2+k_s^2} \\right]$$\nFactoring the terms yields the final expression for implementation:\n$$\\Delta E_g^{\\mathrm{GW}} = \\frac{S_0 \\Delta G}{\\pi} \\sum_{j=1}^{J_{\\max}} \\frac{(2G_j^2 + k_s^2)\\exp(-G_j^2/\\gamma_v^2) - k_s^2 \\exp(-G_j^2/\\gamma_c^2)}{G_j^2 + k_s^2}$$\n\nThe computational procedure is as follows:\n1.  For each pair $(N_{\\mathrm{emp}}, E_{\\mathrm{cut}})$, calculate the derived parameters: $k_s = k_{\\mathrm{s}}(N_{\\mathrm{emp}})$ and $G_{\\max} = \\sqrt{2 E_{\\mathrm{cut}} / 27.211...}$, which determines $J_{\\max}$.\n2.  Iterate $j$ from $1$ to $J_{\\max}$, compute the summand for each $G_j = j \\Delta G$, and accumulate the sum.\n3.  Multiply the sum by the prefactor $\\frac{S_0 \\Delta G}{\\pi}$ to obtain $\\Delta E_g^{\\mathrm{GW}}$ in Hartrees.\n4.  Convert the correction to electronvolts: $\\Delta E_g^{\\mathrm{GW}} [\\text{eV}] = \\Delta E_g^{\\mathrm{GW}} [\\text{Ha}] \\times 27.211386245988$.\n5.  Compute the final quasiparticle gap: $E_g^{\\mathrm{QP}}[\\text{eV}] = E_g^{\\mathrm{KS}}[\\text{eV}] + \\Delta E_g^{\\mathrm{GW}}[\\text{eV}]$.\nThis procedure is first applied to the reference parameters ($N_{\\mathrm{emp}}^{\\mathrm{ref}} = 800$, $E_{\\mathrm{cut}}^{\\mathrm{ref}} = 400.0$ eV) to find $E_{g}^{\\mathrm{QP,ref}}$, and then to each test case to find both $E_{g}^{\\mathrm{QP}}$ and the deviation $|E_{g}^{\\mathrm{QP}} - E_{g}^{\\mathrm{QP,ref}}|$.", "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Solves the quasiparticle band gap problem as described.\n    \"\"\"\n\n    # --- Constants and Parameter Definitions ---\n    HARTREE_TO_EV = 27.211386245988\n    E_G_KS_EV = 0.600\n    KS_INF = 1.000\n    N0 = 50.0\n    GAMMA_V = 1.000\n    GAMMA_C = 0.700\n    DELTA_G = 0.300\n    S0 = 0.500\n\n    def compute_qp_gap(n_emp, e_cut):\n        \"\"\"\n        Computes the quasiparticle gap for a given N_emp and E_cut.\n\n        Args:\n            n_emp (int): Number of empty bands.\n            e_cut (float): Dielectric cutoff energy in eV.\n\n        Returns:\n            float: Quasiparticle band gap in eV.\n        \"\"\"\n        # 1. Calculate derived parameters\n        k_s = KS_INF * (1.0 - np.exp(-n_emp / N0))\n        e_cut_ha = e_cut / HARTREE_TO_EV\n        g_max = np.sqrt(2.0 * e_cut_ha)\n        \n        # Determine the maximum integer j for the summation\n        if g_max < DELTA_G:\n            j_max = 0\n        else:\n            j_max = math.floor(g_max / DELTA_G)\n\n        # 2. Perform the summation\n        total_sum = 0.0\n        k_s_sq = k_s**2\n        gamma_v_sq = GAMMA_V**2\n        gamma_c_sq = GAMMA_C**2\n\n        for j in range(1, j_max + 1):\n            g_j = j * DELTA_G\n            g_j_sq = g_j**2\n\n            # Numerator terms\n            term_v = (2.0 * g_j_sq + k_s_sq) * np.exp(-g_j_sq / gamma_v_sq)\n            term_c = k_s_sq * np.exp(-g_j_sq / gamma_c_sq)\n            \n            # Denominator\n            denominator = g_j_sq + k_s_sq\n            \n            summand = (term_v - term_c) / denominator\n            total_sum += summand\n\n        # 3. Calculate the gap correction\n        # The equation for delta_e_g_gw is in Hartrees\n        delta_e_g_gw_ha = (S0 * DELTA_G / np.pi) * total_sum\n        \n        # 4. Convert to eV and add to KS gap\n        delta_e_g_gw_ev = delta_e_g_gw_ha * HARTREE_TO_EV\n        e_g_qp_ev = E_G_KS_EV + delta_e_g_gw_ev\n\n        return e_g_qp_ev\n\n    # --- Main Calculation ---\n    \n    # Test cases as provided in the problem\n    test_cases = [\n        (20, 10.0),\n        (200, 100.0),\n        (50, 40.0),\n        (5, 5.0),\n        (500, 200.0)\n    ]\n    \n    # Reference calculation parameters\n    n_emp_ref = 800\n    e_cut_ref = 400.0\n\n    # Compute reference gap\n    e_g_qp_ref = compute_qp_gap(n_emp_ref, e_cut_ref)\n    \n    qp_gaps = []\n    deviations = []\n    \n    # Process each test case\n    for n_emp, e_cut in test_cases:\n        e_g_qp = compute_qp_gap(n_emp, e_cut)\n        deviation = abs(e_g_qp - e_g_qp_ref)\n        qp_gaps.append(e_g_qp)\n        deviations.append(deviation)\n\n    # Combine results and format for output\n    all_results = qp_gaps + deviations\n    results_str = [f\"{val:.3f}\" for val in all_results]\n    \n    # Final print statement in the exact required format\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n\n```", "id": "2930201"}]}