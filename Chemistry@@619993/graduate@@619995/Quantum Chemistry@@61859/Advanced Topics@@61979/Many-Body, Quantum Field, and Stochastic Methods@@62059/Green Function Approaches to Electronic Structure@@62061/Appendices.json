{"hands_on_practices": [{"introduction": "The spectral representation provides a powerful link between the physical spectral function, $A(\\omega)$, which describes the available electronic states at a given energy, and the full complex-frequency Green's function, $G(z)$. This exercise demonstrates this connection directly, showing how to build the full analytic structure of $G(z)$ from a simple yet ubiquitous Lorentzian spectrum. By applying the principles of complex analysis, you will gain a deeper appreciation for the Kramers-Kronig relations and the fundamental role of causality in shaping response functions. [@problem_id:2894546]", "problem": "Consider a single-particle fermionic Green's function (GF) in the frequency domain described through its spectral representation. Let the spectral function be a normalized Lorentzian,\n$$\nA(\\nu)=\\frac{1}{\\pi}\\,\\frac{\\gamma}{(\\nu-\\omega_{0})^{2}+\\gamma^{2}},\n$$\nwith real center $\\omega_{0}\\in\\mathbb{R}$ and positive half-width $\\gamma>0$. The complex-frequency Green's function $G(z)$ for $\\operatorname{Im}z\\neq 0$ is defined by the spectral representation\n$$\nG(z)=\\int_{-\\infty}^{+\\infty}\\frac{A(\\nu)}{z-\\nu}\\,d\\nu.\n$$\nUsing only fundamental properties of analytic functions, Cauchy's integral theorem, and the definition of the retarded Green's function as the analytic continuation from the upper half-plane, perform the following steps:\n\n- Carry out the real-frequency integration to obtain a closed-form analytic expression for $G(z)$ for $\\operatorname{Im}z>0$.\n- Perform the analytic continuation from the imaginary frequency axis to the real axis to obtain the retarded Green's function $G^{R}(\\omega)=\\lim_{\\eta\\to 0^{+}}G(\\omega+i\\eta)$.\n\nExpress your final answer as a single closed-form analytic expression for $G^{R}(\\omega)$ in terms of $\\omega, \\omega_{0}, \\gamma$. No numerical evaluation is required, and no rounding is necessary. Your final answer must be a single analytic expression (not an equation or inequality).", "solution": "The problem as stated is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. It is a standard exercise in the application of complex analysis to the theory of Green's functions. I will therefore proceed with the solution.\n\nThe problem asks for the single-particle Green's function in the complex frequency domain, $G(z)$, defined by the spectral representation:\n$$\nG(z) = \\int_{-\\infty}^{+\\infty} \\frac{A(\\nu)}{z-\\nu} \\, d\\nu\n$$\nwhere the spectral function $A(\\nu)$ is a normalized Lorentzian:\n$$\nA(\\nu) = \\frac{1}{\\pi} \\frac{\\gamma}{(\\nu-\\omega_{0})^{2}+\\gamma^{2}}\n$$\nwith $\\omega_{0} \\in \\mathbb{R}$ and $\\gamma > 0$. The integral for $G(z)$ is to be computed for $\\operatorname{Im}z > 0$.\n\nWe will evaluate this integral using the residue theorem from complex analysis. Let us define a complex function $f(\\zeta)$ corresponding to the integrand:\n$$\nf(\\zeta) = \\frac{A(\\zeta)}{z-\\zeta} = \\frac{1}{z-\\zeta} \\cdot \\frac{1}{\\pi} \\frac{\\gamma}{(\\zeta-\\omega_{0})^{2}+\\gamma^{2}}\n$$\nThe poles of $f(\\zeta)$ in the complex $\\zeta$-plane are located at $\\zeta = z$ and at the roots of the denominator of $A(\\zeta)$. The latter are found from $(\\zeta-\\omega_{0})^{2}+\\gamma^{2} = 0$, which gives $\\zeta - \\omega_{0} = \\pm i\\gamma$. Let us denote these two poles as $\\zeta_{1} = \\omega_{0} + i\\gamma$ and $\\zeta_{2} = \\omega_{0} - i\\gamma$.\n\nAccording to the problem conditions, $\\operatorname{Im}z > 0$ and $\\gamma > 0$. Therefore, the poles $\\zeta=z$ and $\\zeta_{1} = \\omega_{0} + i\\gamma$ reside in the upper half-plane, while the pole $\\zeta_{2} = \\omega_{0} - i\\gamma$ resides in the lower half-plane.\n\nTo evaluate the integral along the real axis, we can complete the integration path with a large semicircle in either the upper or lower half-plane. Let us choose to close the contour in the lower half-plane, as this encloses only one pole and is computationally more direct. We define a contour $\\mathcal{C}$ consisting of the real axis from $-R$ to $R$ and a semicircle $\\Gamma_{R}$ of radius $R$ in the lower half-plane, oriented in the clockwise direction. The integral of $f(\\zeta)$ over this closed contour is given by the residue theorem.\n\n$$\n\\oint_{\\mathcal{C}} f(\\zeta) \\, d\\zeta = \\int_{-R}^{R} f(\\nu) \\, d\\nu + \\int_{\\Gamma_{R}} f(\\zeta) \\, d\\zeta = -2\\pi i \\sum_{k} \\operatorname{Res}(f, \\zeta_k^{\\text{inside}})\n$$\nThe negative sign $-2\\pi i$ arises from the clockwise orientation of the contour $\\mathcal{C}$. The only pole enclosed within $\\mathcal{C}$ is $\\zeta_{2} = \\omega_{0} - i\\gamma$.\n\nAs $R \\to \\infty$, the integral over the semicircle $\\Gamma_{R}$ vanishes, because the integrand $f(\\zeta)$ decays as $O(|\\zeta|^{-3})$, which is faster than $|\\zeta|^{-1}$. Therefore, in the limit $R\\to\\infty$, we have:\n$$\nG(z) = \\int_{-\\infty}^{+\\infty} f(\\nu) \\, d\\nu = -2\\pi i \\operatorname{Res}(f, \\zeta_{2})\n$$\nWe now compute the residue of $f(\\zeta)$ at the simple pole $\\zeta_{2}$:\n$$\n\\operatorname{Res}(f, \\zeta_{2}) = \\lim_{\\zeta \\to \\zeta_{2}} (\\zeta-\\zeta_{2}) f(\\zeta) = \\lim_{\\zeta \\to \\zeta_{2}} (\\zeta - \\zeta_{2}) \\frac{1}{z-\\zeta} \\frac{1}{\\pi} \\frac{\\gamma}{(\\zeta-\\zeta_{1})(\\zeta-\\zeta_{2})}\n$$\n$$\n\\operatorname{Res}(f, \\zeta_{2}) = \\frac{1}{z-\\zeta_{2}} \\frac{1}{\\pi} \\frac{\\gamma}{\\zeta_{2}-\\zeta_{1}}\n$$\nSubstituting $\\zeta_{1} = \\omega_{0} + i\\gamma$ and $\\zeta_{2} = \\omega_{0} - i\\gamma$, we find $\\zeta_{2} - \\zeta_{1} = -2i\\gamma$. The residue is thus:\n$$\n\\operatorname{Res}(f, \\zeta_{2}) = \\frac{1}{z-(\\omega_{0}-i\\gamma)} \\frac{1}{\\pi} \\frac{\\gamma}{-2i\\gamma} = -\\frac{1}{2\\pi i} \\frac{1}{z - \\omega_{0} + i\\gamma}\n$$\nFinally, we substitute this residue back into the expression for $G(z)$:\n$$\nG(z) = -2\\pi i \\left( -\\frac{1}{2\\pi i} \\frac{1}{z - \\omega_{0} + i\\gamma} \\right) = \\frac{1}{z - \\omega_{0} + i\\gamma}\n$$\nThis is the closed-form analytic expression for $G(z)$ valid for $\\operatorname{Im}z > 0$.\n\nThe second part of the problem requires finding the retarded Green's function $G^{R}(\\omega)$ by analytic continuation from the upper half-plane to the real axis. This is defined by the limit:\n$$\nG^{R}(\\omega) = \\lim_{\\eta\\to 0^{+}} G(\\omega+i\\eta)\n$$\nwhere $\\omega \\in \\mathbb{R}$ and $\\eta$ is a positive infinitesimal. We substitute $z = \\omega + i\\eta$ into our expression for $G(z)$:\n$$\nG(\\omega+i\\eta) = \\frac{1}{(\\omega+i\\eta) - \\omega_{0} + i\\gamma} = \\frac{1}{(\\omega - \\omega_{0}) + i(\\eta + \\gamma)}\n$$\nNow, we take the limit as $\\eta \\to 0^{+}$. Since $\\gamma > 0$, the denominator does not become singular, and the limit can be evaluated by direct substitution of $\\eta = 0$:\n$$\nG^{R}(\\omega) = \\frac{1}{(\\omega - \\omega_{0}) + i\\gamma}\n$$\nThis is the final expression for the retarded Green's function on the real frequency axis.", "answer": "$$\n\\boxed{\\frac{1}{(\\omega - \\omega_{0}) + i\\gamma}}\n$$", "id": "2894546"}, {"introduction": "The Dyson equation, which incorporates electron correlation effects through the self-energy $\\Sigma(\\omega)$, is the central tool for calculating quasiparticle properties. This hands-on computational exercise translates the formal Dyson equation into a tangible problem of finding roots, bridging the gap between abstract theory and practical calculation. You will implement solvers for various models of the self-energy, making the concept of a nonlinear eigenvalue problem concrete and solvable. [@problem_id:2894544]", "problem": "You are asked to implement a program that solves quasiparticle equations derived from the matrix Dyson equation for the one-particle retarded Green’s function in a finite orthonormal orbital basis. The fundamental base is the definition of the retarded Green’s function and the Dyson equation. In an orthonormal basis with overlap matrix equal to the identity, the retarded one-particle Green’s function is defined as\n$$\n\\mathbf{G}(\\omega) \\equiv \\left[ (\\omega + \\mu)\\,\\mathbf{I} - \\mathbf{H}_0 - \\mathbf{\\Sigma}(\\omega) \\right]^{-1},\n$$\nwhere $\\omega$ is a real frequency, $\\mu$ is the chemical potential, $\\mathbf{I}$ is the identity matrix, $\\mathbf{H}_0$ is a real symmetric non-interacting Hamiltonian matrix, and $\\mathbf{\\Sigma}(\\omega)$ is the (generally frequency-dependent) self-energy matrix. Quasiparticle energies are the real frequencies $\\omega$ at which the matrix inverse has poles, equivalently where the determinant of the inverse kernel vanishes,\n$$\n\\det\\!\\left[ (\\omega + \\mu)\\,\\mathbf{I} - \\mathbf{H}_0 - \\mathbf{\\Sigma}(\\omega) \\right] = 0.\n$$\nIn general, this defines a nonlinear eigenvalue problem in $\\omega$. In special cases where $\\mathbf{\\Sigma}(\\omega)$ is diagonal in the same basis as $\\mathbf{H}_0$, or proportional to $\\mathbf{I}$, the problem decouples into independent scalar nonlinear equations for each orbital. Your task is to compute quasiparticle energies for several concrete, finite-dimensional test cases using these principles.\n\nScientific and computational requirements:\n- Assume an orthonormal basis, so the overlap matrix is $\\mathbf{I}$.\n- Use the definition above as the starting point. The quasiparticle energies are the real roots $\\omega$ of the pole condition.\n- For test cases where $\\mathbf{\\Sigma}(\\omega)$ is scalar and proportional to $\\mathbf{I}$, the eigenvectors of $\\mathbf{H}_0$ do not change with $\\omega$, and the eigenvalue condition reduces to independent scalar equations in $\\omega$ for each eigenvalue of $\\mathbf{H}_0$.\n- For test cases where $\\mathbf{\\Sigma}(\\omega)$ is diagonal in the orbital basis and $\\mathbf{H}_0$ is diagonal, each orbital decouples into a scalar nonlinear equation in $\\omega$.\n- The chemical potential is $\\mu = 0$ and all energies are in electronvolts. Express all final energies in $\\mathrm{eV}$, rounded to six decimals.\n\nTest suite:\nImplement the program to solve the quasiparticle equations for the following three test cases. In all cases use $\\mu = 0$ and energies in $\\mathrm{eV}$.\n\n- Test case $1$ (matrix $\\mathbf{H}_0$ with off-diagonal coupling, static scalar self-energy):\n  - $\\mathbf{H}_0 = \\begin{bmatrix} -1.0 & 0.2 \\\\ 0.2 & 0.5 \\end{bmatrix}$.\n  - $\\mathbf{\\Sigma}(\\omega) = s_0\\,\\mathbf{I}$ with $s_0 = -0.3$.\n  - Quasiparticle energies are the real roots $\\omega$ of $\\det\\!\\left[\\omega\\,\\mathbf{I} - \\mathbf{H}_0 - s_0\\,\\mathbf{I}\\right]=0$.\n  - Report both quasiparticle energies, in ascending order, rounded to six decimals.\n\n- Test case $2$ (diagonal $\\mathbf{H}_0$, diagonal linear-in-frequency self-energy):\n  - $\\mathbf{H}_0 = \\mathrm{diag}(-2.0,\\,-0.5,\\,1.0)$.\n  - $\\mathbf{\\Sigma}(\\omega) = \\mathrm{diag}\\!\\big(a_1 + b_1\\,\\omega,\\; a_2 + b_2\\,\\omega,\\; a_3 + b_3\\,\\omega\\big)$ with $(a_1, b_1)=(-0.2,\\,0.2)$, $(a_2, b_2)=(0.1,\\,0.1)$, $(a_3, b_3)=(0.0,\\,-0.3)$.\n  - For each orbital $i$, the scalar equation is $\\omega - \\varepsilon_i - a_i - b_i\\,\\omega = 0$ where $\\varepsilon_i$ is the $i$th diagonal element of $\\mathbf{H}_0$.\n  - Report the three quasiparticle energies, in ascending order, rounded to six decimals.\n\n- Test case $3$ (diagonal $\\mathbf{H}_0$, diagonal pole self-energy for electron-boson coupling model):\n  - $\\mathbf{H}_0 = \\mathrm{diag}(-1.5,\\,0.8)$.\n  - For each orbital $i$, the self-energy is $\\Sigma_i(\\omega) = \\Delta_i + \\dfrac{\\alpha_i^2}{\\omega - \\Omega_i}$, with parameters\n    - orbital $1$: $(\\Delta_1, \\alpha_1, \\Omega_1) = (-0.1,\\,0.4,\\,-0.5)$,\n    - orbital $2$: $(\\Delta_2, \\alpha_2, \\Omega_2) = (0.05,\\,0.3,\\,0.4)$.\n  - For each orbital $i$, solve the scalar nonlinear equation for real $\\omega$:\n    $$\n    \\omega - \\varepsilon_i - \\Delta_i - \\frac{\\alpha_i^2}{\\omega - \\Omega_i} = 0.\n    $$\n    This reduces to a quadratic equation after clearing the denominator. There are two real roots for the chosen parameters; choose the physically relevant quasiparticle root as the one whose value is closest (in absolute difference) to the corresponding non-interacting energy $\\varepsilon_i$.\n  - Report the two selected quasiparticle energies, in ascending order, rounded to six decimals.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of the three per-test-case result lists, each inner list itself being a comma-separated list of the quasiparticle energies for that case, enclosed in square brackets.\n- Concretely, the program should print a single line like\n  $$\n  [ [\\omega^{(1)}_1,\\omega^{(1)}_2], [\\omega^{(2)}_1,\\omega^{(2)}_2,\\omega^{(2)}_3], [\\omega^{(3)}_1,\\omega^{(3)}_2] ]\\,,\n  $$\n  where superscripts index the test case and subscripts index the energies within that case. All numerical entries must be in $\\mathrm{eV}$, rounded to six decimals.", "solution": "The problem statement will first be subjected to rigorous validation.\n\n**Problem Validation**\n\n**Step 1: Extract Givens**\n\nThe givens are a set of definitions and three test cases for calculating quasiparticle energies.\n\n*   **Fundamental Definitions**:\n    *   Retarded one-particle Green’s function in an orthonormal basis:\n        $$\n        \\mathbf{G}(\\omega) \\equiv \\left[ (\\omega + \\mu)\\,\\mathbf{I} - \\mathbf{H}_0 - \\mathbf{\\Sigma}(\\omega) \\right]^{-1}\n        $$\n    *   Condition for quasiparticle energies $\\omega$:\n        $$\n        \\det\\!\\left[ (\\omega + \\mu)\\,\\mathbf{I} - \\mathbf{H}_0 - \\mathbf{\\Sigma}(\\omega) \\right] = 0\n        $$\n*   **Global Conditions**:\n    *   The basis is orthonormal, so the overlap matrix is $\\mathbf{I}$.\n    *   The chemical potential is $\\mu = 0$ eV.\n    *   All energies are in electronvolts ($\\mathrm{eV}$) and final results must be rounded to six decimal places.\n\n*   **Test Case $1$**:\n    *   Non-interacting Hamiltonian: $\\mathbf{H}_0 = \\begin{bmatrix} -1.0 & 0.2 \\\\ 0.2 & 0.5 \\end{bmatrix}$.\n    *   Self-energy: $\\mathbf{\\Sigma}(\\omega) = s_0\\,\\mathbf{I}$, with $s_0 = -0.3$.\n    *   Task: Find the two real roots $\\omega$, ordered ascendingly.\n\n*   **Test Case $2$**:\n    *   Non-interacting Hamiltonian: $\\mathbf{H}_0 = \\mathrm{diag}(-2.0,\\,-0.5,\\,1.0)$.\n    *   Self-energy: $\\mathbf{\\Sigma}(\\omega) = \\mathrm{diag}\\!\\big(a_1 + b_1\\,\\omega,\\; a_2 + b_2\\,\\omega,\\; a_3 + b_3\\,\\omega\\big)$.\n    *   Parameters: $(a_1, b_1)=(-0.2,\\,0.2)$, $(a_2, b_2)=(0.1,\\,0.1)$, $(a_3, b_3)=(0.0,\\,-0.3)$.\n    *   Task: Solve the scalar equation $\\omega - \\varepsilon_i - a_i - b_i\\,\\omega = 0$ for each orbital $i$ and report the three quasiparticle energies, ordered ascendingly.\n\n*   **Test Case $3$**:\n    *   Non-interacting Hamiltonian: $\\mathbf{H}_0 = \\mathrm{diag}(-1.5,\\,0.8)$.\n    *   Self-energy for orbital $i$: $\\Sigma_i(\\omega) = \\Delta_i + \\dfrac{\\alpha_i^2}{\\omega - \\Omega_i}$.\n    *   Parameters for orbital $1$: $(\\Delta_1, \\alpha_1, \\Omega_1) = (-0.1,\\,0.4,\\,-0.5)$.\n    *   Parameters for orbital $2$: $(\\Delta_2, \\alpha_2, \\Omega_2) = (0.05,\\,0.3,\\,0.4)$.\n    *   Task: Solve the scalar equation $\\omega - \\varepsilon_i - \\Delta_i - \\frac{\\alpha_i^2}{\\omega - \\Omega_i} = 0$ for each orbital $i$. From the two real roots, select the one closest in value to the non-interacting energy $\\varepsilon_i$. Report the two selected energies, ordered ascendingly.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem is examined against the criteria for validity.\n\n*   **Scientific Grounding**: The problem is founded on the Dyson equation for the single-particle Green's function, a central concept in quantum many-body theory and computational quantum chemistry. The self-energy models presented (static, linear frequency dependence, and single-pole expansion) are common and well-established approximations. The problem is scientifically and factually sound.\n*   **Well-Posedness**: Each test case is mathematically well-posed. Case $1$ describes a standard linear eigenvalue problem, which has a unique set of eigenvalues. Case $2$ reduces to three independent linear equations, each with a unique solution. Case $3$ involves solving two independent quadratic equations; a clear and unambiguous criterion is provided for selecting the physically meaningful root in each case. Therefore, a unique solution exists for each test case.\n*   **Objectivity**: The problem is formulated with precise, objective mathematical language. It is free of subjective or ambiguous statements.\n*   **Completeness and Consistency**: All required data, including matrices, parameters, and constants like $\\mu=0$, are explicitly provided. The problem is self-contained and internally consistent.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. It is scientifically grounded, well-posed, and complete. A full, reasoned solution will now be developed.\n\n**Solution Elaboration**\n\nThe quasiparticle energies $\\omega$ are the poles of the Green's function, determined by the roots of the equation $\\det\\!\\left[\\mathbf{M}(\\omega)\\right] = 0$, where $\\mathbf{M}(\\omega) = (\\omega + \\mu)\\mathbf{I} - \\mathbf{H}_0 - \\mathbf{\\Sigma}(\\omega)$. With the given condition $\\mu=0$, the kernel matrix is $\\mathbf{M}(\\omega) = \\omega\\mathbf{I} - \\mathbf{H}_0 - \\mathbf{\\Sigma}(\\omega)$. We solve for the roots $\\omega$ for each test case.\n\n**Test Case $1$**\n\nThe self-energy is static and scalar: $\\mathbf{\\Sigma}(\\omega) = s_0\\,\\mathbf{I}$, where $s_0 = -0.3$. The condition for quasiparticle energies becomes:\n$$\n\\det\\!\\left[ \\omega\\mathbf{I} - \\mathbf{H}_0 - s_0\\mathbf{I} \\right] = 0\n$$\nThis can be rewritten as a standard eigenvalue problem:\n$$\n\\det\\!\\left[ \\omega\\mathbf{I} - (\\mathbf{H}_0 + s_0\\mathbf{I}) \\right] = 0\n$$\nThe quasiparticle energies $\\omega$ are the eigenvalues of the effective Hamiltonian matrix $\\mathbf{H}' = \\mathbf{H}_0 + s_0\\mathbf{I}$. We construct this matrix:\n$$\n\\mathbf{H}' = \\begin{bmatrix} -1.0 & 0.2 \\\\ 0.2 & 0.5 \\end{bmatrix} + (-0.3)\\begin{bmatrix} 1 & 0 \\\\ 0 & 1 \\end{bmatrix} = \\begin{bmatrix} -1.0 - 0.3 & 0.2 \\\\ 0.2 & 0.5 - 0.3 \\end{bmatrix} = \\begin{bmatrix} -1.3 & 0.2 \\\\ 0.2 & 0.2 \\end{bmatrix}\n$$\nThe eigenvalues of this $2 \\times 2$ real symmetric matrix are calculated. The characteristic equation is $(\\lambda - (-1.3))(\\lambda - 0.2) - (0.2)(0.2) = 0$, which simplifies to $\\lambda^2 + 1.1\\lambda - 0.3 = 0$. Using numerical methods for precision, the eigenvalues are found to be approximately $\\omega_1 = -1.326204$ eV and $\\omega_2 = 0.226204$ eV.\n\n**Test Case $2$**\n\nHere, both $\\mathbf{H}_0$ and $\\mathbf{\\Sigma}(\\omega)$ are diagonal. The matrix equation decouples into three independent scalar equations, one for each orbital $i \\in \\{1, 2, 3\\}$. The general form is $\\omega - \\varepsilon_i - \\Sigma_{ii}(\\omega) = 0$, where $\\varepsilon_i$ are the diagonal elements of $\\mathbf{H}_0$.\nThe self-energy components are linear in frequency: $\\Sigma_{ii}(\\omega) = a_i + b_i\\omega$. The scalar equation for orbital $i$ is:\n$$\n\\omega - \\varepsilon_i - (a_i + b_i\\omega) = 0\n$$\nThis is a linear equation in $\\omega$, which can be rearranged to find the solution:\n$$\n\\omega(1 - b_i) = \\varepsilon_i + a_i \\implies \\omega_i = \\frac{\\varepsilon_i + a_i}{1 - b_i}\n$$\nWe apply this formula for each orbital using the provided parameters:\n*   For $i=1$: $\\varepsilon_1=-2.0$, $a_1=-0.2$, $b_1=0.2$.\n    $\\omega_1 = \\frac{-2.0 + (-0.2)}{1 - 0.2} = \\frac{-2.2}{0.8} = -2.75$ eV.\n*   For $i=2$: $\\varepsilon_2=-0.5$, $a_2=0.1$, $b_2=0.1$.\n    $\\omega_2 = \\frac{-0.5 + 0.1}{1 - 0.1} = \\frac{-0.4}{0.9} \\approx -0.444444$ eV.\n*   For $i=3$: $\\varepsilon_3=1.0$, $a_3=0.0$, $b_3=-0.3$.\n    $\\omega_3 = \\frac{1.0 + 0.0}{1 - (-0.3)} = \\frac{1.0}{1.3} \\approx 0.769231$ eV.\nThe results, sorted in ascending order, are $\\{-2.75, -0.444444, 0.769231\\}$ eV.\n\n**Test Case $3$**\n\nAs in case $2$, the matrices are diagonal, so the problem decouples. The self-energy for each orbital $i$ has a single-pole structure: $\\Sigma_i(\\omega) = \\Delta_i + \\frac{\\alpha_i^2}{\\omega - \\Omega_i}$. The scalar equation for $\\omega$ is:\n$$\n\\omega - \\varepsilon_i - \\left(\\Delta_i + \\frac{\\alpha_i^2}{\\omega - \\Omega_i}\\right) = 0\n$$\nTo solve this nonlinear equation, we multiply by the term $(\\omega - \\Omega_i)$ to clear the denominator, assuming $\\omega \\neq \\Omega_i$:\n$$\n(\\omega - \\varepsilon_i - \\Delta_i)(\\omega - \\Omega_i) - \\alpha_i^2 = 0\n$$\nThis is a quadratic equation in $\\omega$ of the form $A\\omega^2 + B\\omega + C = 0$. Expanding the expression gives:\n$$\n\\omega^2 - (\\varepsilon_i + \\Delta_i + \\Omega_i)\\omega + ((\\varepsilon_i + \\Delta_i)\\Omega_i - \\alpha_i^2) = 0\n$$\nWe solve this quadratic equation for each orbital and apply the selection criterion.\n\n*   For orbital $1$: $\\varepsilon_1 = -1.5$, $\\Delta_1 = -0.1$, $\\alpha_1 = 0.4$, $\\Omega_1 = -0.5$.\n    The equation is $\\omega^2 - (-1.5 - 0.1 - 0.5)\\omega + ((-1.5 - 0.1)(-0.5) - 0.4^2) = 0$.\n    This simplifies to $\\omega^2 + 2.1\\omega + (0.8 - 0.16) = 0$, or $\\omega^2 + 2.1\\omega + 0.64 = 0$.\n    The two roots are $\\omega \\approx -1.730074$ and $\\omega \\approx -0.369926$.\n    The non-interacting energy is $\\varepsilon_1 = -1.5$. We find the root closer to this value:\n    $|-1.730074 - (-1.5)| = 0.230074$.\n    $|-0.369926 - (-1.5)| = 1.130074$.\n    The first root is closer. Thus, the selected quasiparticle energy is $\\omega_1 = -1.730074$ eV.\n\n*   For orbital $2$: $\\varepsilon_2 = 0.8$, $\\Delta_2 = 0.05$, $\\alpha_2 = 0.3$, $\\Omega_2 = 0.4$.\n    The equation is $\\omega^2 - (0.8 + 0.05 + 0.4)\\omega + ((0.8 + 0.05)(0.4) - 0.3^2) = 0$.\n    This simplifies to $\\omega^2 - 1.25\\omega + (0.34 - 0.09) = 0$, or $\\omega^2 - 1.25\\omega + 0.25 = 0$.\n    The two roots are $\\omega = 1.0$ and $\\omega = 0.25$.\n    The non-interacting energy is $\\varepsilon_2 = 0.8$. We find the root closer to this value:\n    $|1.0 - 0.8| = 0.2$.\n    $|0.25 - 0.8| = 0.55$.\n    The first root is closer. Thus, the selected quasiparticle energy is $\\omega_2 = 1.0$ eV.\n\nThe results, sorted in ascending order, are $\\{-1.730074, 1.0\\}$ eV.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for quasiparticle energies for three different test cases based on\n    the matrix Dyson equation.\n    \"\"\"\n\n    # --- Test Case 1: Matrix H0 with static scalar self-energy ---\n    H0_1 = np.array([\n        [-1.0, 0.2],\n        [0.2, 0.5]\n    ])\n    s0_1 = -0.3\n    # The quasiparticle energies are the eigenvalues of H' = H0 + s0*I\n    H_prime_1 = H0_1 + s0_1 * np.identity(2)\n    # Since H_prime_1 is real and symmetric, use eigvalsh\n    energies_1 = np.linalg.eigvalsh(H_prime_1)\n    energies_1.sort()\n    \n    # --- Test Case 2: Diagonal H0 with diagonal linear self-energy ---\n    epsilons_2 = np.array([-2.0, -0.5, 1.0])\n    params_2 = [\n        (-0.2, 0.2),  # (a1, b1)\n        (0.1, 0.1),   # (a2, b2)\n        (0.0, -0.3)   # (a3, b3)\n    ]\n    energies_2 = []\n    for i in range(3):\n        eps_i = epsilons_2[i]\n        a_i, b_i = params_2[i]\n        # omega(1 - b_i) = eps_i + a_i => omega = (eps_i + a_i) / (1 - b_i)\n        omega_i = (eps_i + a_i) / (1 - b_i)\n        energies_2.append(omega_i)\n    energies_2.sort()\n\n    # --- Test Case 3: Diagonal H0 with diagonal pole self-energy ---\n    epsilons_3 = np.array([-1.5, 0.8])\n    params_3 = [\n        (-0.1, 0.4, -0.5), # (Delta1, alpha1, Omega1)\n        (0.05, 0.3, 0.4)   # (Delta2, alpha2, Omega2)\n    ]\n    energies_3 = []\n    for i in range(2):\n        eps_i = epsilons_3[i]\n        Delta_i, alpha_i, Omega_i = params_3[i]\n        \n        # The equation is omega^2 - (eps_i + Delta_i + Omega_i) * omega +\n        # ((eps_i + Delta_i) * Omega_i - alpha_i^2) = 0\n        # This is a quadratic equation Ax^2 + Bx + C = 0 with A=1.\n        A = 1.0\n        B = -(eps_i + Delta_i + Omega_i)\n        C = (eps_i + Delta_i) * Omega_i - alpha_i**2\n        \n        roots = np.roots([A, B, C])\n        \n        # Select the root closest to the non-interacting energy eps_i\n        diffs = np.abs(roots - eps_i)\n        chosen_root = roots[np.argmin(diffs)]\n        energies_3.append(chosen_root)\n    energies_3.sort()\n\n    # --- Formatting the final output ---\n    def format_energies(energy_list):\n        return ','.join([f\"{e:.6f}\" for e in energy_list])\n\n    results_str = [\n        f\"[{format_energies(energies_1)}]\",\n        f\"[{format_energies(energies_2)}]\",\n        f\"[{format_energies(energies_3)}]\"\n    ]\n    \n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```", "id": "2894544"}, {"introduction": "Beyond solving the core equations, a critical skill for computational scientists is understanding the efficiency and scalability of their algorithms. This practice delves into the practical side of Green's function methods, guiding you through a flop-count analysis for computing the polarizability, $\\chi_0$, using the Resolution of the Identity (RI) approximation. This exercise reveals how practitioners manage the computational complexity inherent in many-body theories and is essential for developing or effectively using modern electronic structure software. [@problem_id:2894551]", "problem": "Consider the independent-particle polarizability for a closed-shell system in imaginary frequency, defined in terms of the one-particle Green’s function as\n$$\n\\chi_{0}(\\mathbf{r},\\mathbf{r}'; i\\omega) \\equiv -2 \\int \\frac{d\\omega'}{2\\pi} \\, G(\\mathbf{r},\\mathbf{r}'; i\\omega + i\\omega') G(\\mathbf{r}',\\mathbf{r}; i\\omega') \\, ,\n$$\nwhere $G(\\mathbf{r},\\mathbf{r}'; z)$ is the time-ordered one-particle Green’s function. In the Molecular Orbital (MO) representation with diagonal Fock operator and occupations $f_{p} \\in \\{0,1\\}$, the Green’s function is\n$$\nG_{p}(z) = \\frac{1}{z + \\mu - \\varepsilon_{p}} \\, ,\n$$\nwith chemical potential $\\mu$ and orbital energies $\\varepsilon_{p}$. Using the product form of occupied ($i$) and virtual ($a$) orbitals, the independent-particle polarizability can be expressed as a sum over particle-hole excitations,\n$$\n\\chi_{0}(\\mathbf{r},\\mathbf{r}'; i\\omega) = 2 \\sum_{i=1}^{o} \\sum_{a=1}^{v} \\phi_{i}(\\mathbf{r}) \\phi_{a}(\\mathbf{r}) \\, \\phi_{a}(\\mathbf{r}') \\phi_{i}(\\mathbf{r}') \\, F_{ia}(i\\omega) \\, ,\n$$\nwhere $o$ and $v$ are the numbers of occupied and virtual orbitals, respectively, and $F_{ia}(i\\omega)$ is a scalar function obtained by performing the frequency convolution of two diagonal Green’s functions.\n\nAdopt the Resolution of the Identity (RI) in the Coulomb metric (often written as RI-V) to represent orbital products in an auxiliary basis $\\{\\rho_{X}(\\mathbf{r})\\}_{X=1}^{N_{X}}$,\n$$\n\\phi_{i}(\\mathbf{r}) \\phi_{a}(\\mathbf{r}) \\approx \\sum_{X=1}^{N_{X}} B_{ia}^{X} \\, \\rho_{X}(\\mathbf{r}) \\, .\n$$\nThis yields a representation of the polarizability in the auxiliary basis,\n$$\n\\chi_{0}^{XY}(i\\omega) \\equiv \\iint d\\mathbf{r} \\, d\\mathbf{r}' \\, \\rho_{X}(\\mathbf{r}) \\, \\chi_{0}(\\mathbf{r},\\mathbf{r}'; i\\omega) \\, \\rho_{Y}(\\mathbf{r}')\n= 2 \\sum_{i=1}^{o} \\sum_{a=1}^{v} B_{ia}^{X} B_{ia}^{Y} \\, F_{ia}(i\\omega) \\, .\n$$\nLet there be $N$ Atomic Orbital (AO) basis functions and $N_{X}$ auxiliary functions. Denote by $C_{\\mu p}$ the AO-to-MO coefficients for MOs $p \\in \\{1,\\dots,N\\}$ built from AOs $\\mu \\in \\{1,\\dots,N\\}$. The three-center Coulomb integrals $(\\mu \\nu | X)$ are assumed to be precomputed. One practical algorithm to compute $\\chi_{0}^{XY}(i\\omega)$ on a grid of $N_{\\omega}$ imaginary frequencies proceeds in three stages:\n\n1) Build the half-transformed intermediates\n$$\nD_{\\mu a}^{X} \\equiv \\sum_{\\nu=1}^{N} (\\mu \\nu | X) \\, C_{\\nu a} \\quad \\text{for all } \\mu \\in \\{1,\\dots,N\\}, \\, a \\in \\{1,\\dots,v\\}, \\, X \\in \\{1,\\dots,N_{X}\\} \\, .\n$$\n\n2) Complete the AO-to-MO transformation to obtain\n$$\nB_{ia}^{X} \\equiv \\sum_{\\mu=1}^{N} C_{\\mu i} \\, D_{\\mu a}^{X} \\quad \\text{for all } i \\in \\{1,\\dots,o\\}, \\, a \\in \\{1,\\dots,v\\}, \\, X \\in \\{1,\\dots,N_{X}\\} \\, .\n$$\n\n3) For each frequency $i\\omega_{k}$, form the polarizability matrix by rank-one updates\n$$\n\\chi_{0}^{XY}(i\\omega_{k}) = 2 \\sum_{i=1}^{o} \\sum_{a=1}^{v} \\left[ F_{ia}(i\\omega_{k}) \\, B_{ia}^{X} \\right] B_{ia}^{Y} \\, ,\n$$\ni.e., for each pair $(i,a)$, update $\\chi_{0}(i\\omega_{k}) \\leftarrow \\chi_{0}(i\\omega_{k}) + s_{ia}(k) \\, \\mathbf{b}_{ia} \\mathbf{b}_{ia}^{\\top}$ with scalar $s_{ia}(k) \\equiv 2 F_{ia}(i\\omega_{k})$ and vector $\\mathbf{b}_{ia} \\in \\mathbb{R}^{N_{X}}$ having components $(\\mathbf{b}_{ia})_{X} = B_{ia}^{X}$.\n\nAssume the following cost model for floating-point operations (flops): each scalar multiplication or addition costs $1$ flop; the fused multiply-add is not used. With this model, computing $D_{\\mu a}^{X}$ by a length-$N$ dot product costs $2N$ flops, computing $B_{ia}^{X}$ by a length-$N$ dot product costs $2N$ flops, and a rank-one update $\\chi_{0} \\leftarrow \\chi_{0} + s \\, \\mathbf{b} \\mathbf{b}^{\\top}$ on an $N_{X} \\times N_{X}$ matrix costs $2 N_{X}^{2}$ flops. Neglect the cost of forming the scalars $F_{ia}(i\\omega_{k})$ and all lower-order terms relative to the dominant contractions described above.\n\nStarting from the definitions given and the stated algorithm, derive the leading-order total flop count, as a closed-form expression in terms of $N$, $o$, $v$, $N_{X}$, and $N_{\\omega}$, for the cost to compute all matrices $\\{ \\chi_{0}^{XY}(i\\omega_{k}) \\}_{k=1}^{N_{\\omega}}$. Your final answer must be a single analytic expression in these symbols. No numerical evaluation is required, and no units are necessary.", "solution": "The problem statement is first subjected to validation.\n\n**Step 1: Extract Givens**\n- Number of Atomic Orbitals (AOs): $N$\n- Number of occupied Molecular Orbitals (MOs): $o$\n- Number of virtual Molecular Orbitals (MOs): $v$\n- Number of auxiliary basis functions: $N_{X}$\n- Number of imaginary frequency points: $N_{\\omega}$\n- AO-to-MO coefficients: $C_{\\mu p}$\n- Three-center Coulomb integrals: $(\\mu \\nu | X)$\n- Algorithm, Step 1: $D_{\\mu a}^{X} \\equiv \\sum_{\\nu=1}^{N} (\\mu \\nu | X) \\, C_{\\nu a}$\n- Algorithm, Step 2: $B_{ia}^{X} \\equiv \\sum_{\\mu=1}^{N} C_{\\mu i} \\, D_{\\mu a}^{X}$\n- Algorithm, Step 3: For each $k \\in \\{1,\\dots,N_{\\omega}\\}$, $\\chi_{0}^{XY}(i\\omega_{k}) = 2 \\sum_{i=1}^{o} \\sum_{a=1}^{v} [ F_{ia}(i\\omega_{k}) B_{ia}^{X} ] B_{ia}^{Y}$\n- Cost Model:\n  - Length-$N$ dot product: $2N$ floating-point operations (flops).\n  - Rank-one update on an $N_{X} \\times N_{X}$ matrix: $2 N_{X}^{2}$ flops.\n  - Cost of computing scalar factors $F_{ia}(i\\omega_{k})$ and other lower-order terms is neglected.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, describing a standard algorithm (RI-RPA) in computational quantum chemistry. The formulas and procedures are correct representations of this method. The problem is well-posed, providing all necessary variables, definitions, and a clear cost model to uniquely determine the total computational cost. The language is objective and precise. There are no contradictions, missing data, or ambiguities. The problem is a valid exercise in computational complexity analysis.\n\n**Verdict and Action**\nThe problem is valid. A complete solution will be derived.\n\nThe total computational cost is the sum of the costs of the three specified algorithmic stages. We will analyze each stage in turn.\n\n**Cost of Stage 1: Construction of half-transformed intermediates $D_{\\mu a}^{X}$**\nThe formula to be evaluated is $D_{\\mu a}^{X} = \\sum_{\\nu=1}^{N} (\\mu \\nu | X) \\, C_{\\nu a}$.\nThis calculation must be performed for each combination of indices $\\mu \\in \\{1,\\dots,N\\}$, $a \\in \\{1,\\dots,v\\}$, and $X \\in \\{1,\\dots,N_{X}\\}$.\nFor a fixed set of indices $(\\mu, a, X)$, the calculation is a sum of $N$ products, which constitutes a dot product between two vectors of length $N$: the vector of integrals $((\\mu 1 | X), \\dots, (\\mu N | X))$ and the MO coefficient vector $(C_{1a}, \\dots, C_{Na})$.\nAccording to the provided cost model, a length-$N$ dot product requires $2N$ flops.\nThe total number of $D_{\\mu a}^{X}$ elements to be computed is the product of the sizes of the index ranges: $N \\times v \\times N_{X}$.\nTherefore, the total cost for Stage 1, $Cost_{1}$, is:\n$$\nCost_{1} = (\\text{number of elements}) \\times (\\text{cost per element}) = (N \\cdot v \\cdot N_{X}) \\times (2N) = 2 N^{2} v N_{X} \\, .\n$$\n\n**Cost of Stage 2: Completion of the transformation to obtain $B_{ia}^{X}$**\nThe formula for this stage is $B_{ia}^{X} = \\sum_{\\mu=1}^{N} C_{\\mu i} \\, D_{\\mu a}^{X}$.\nThis calculation is performed for all $i \\in \\{1,\\dots,o\\}$, $a \\in \\{1,\\dots,v\\}$, and $X \\in \\{1,\\dots,N_{X}\\}$.\nFor a fixed set of indices $(i, a, X)$, the computation is a dot product of two vectors of length $N$: the MO coefficient vector $(C_{1i}, \\dots, C_{Ni})$ and the intermediate vector $(D_{1a}^{X}, \\dots, D_{Na}^{X})$ computed in Stage 1.\nThe cost of this length-$N$ dot product is given as $2N$ flops.\nThe total number of $B_{ia}^{X}$ elements to compute is $o \\times v \\times N_{X}$.\nThe total cost for Stage 2, $Cost_{2}$, is thus:\n$$\nCost_{2} = (\\text{number of elements}) \\times (\\text{cost per element}) = (o \\cdot v \\cdot N_{X}) \\times (2N) = 2 N o v N_{X} \\, .\n$$\n\n**Cost of Stage 3: Formation of the polarizability matrices $\\chi_{0}^{XY}(i\\omega_{k})$**\nThis stage is performed for each of the $N_{\\omega}$ frequency points. For a single frequency $i\\omega_{k}$, the algorithm proceeds by summing $o \\times v$ contributions, one for each particle-hole pair $(i,a)$.\nThe update for each pair $(i,a)$ is given as a rank-one update on the $N_{X} \\times N_{X}$ matrix $\\chi_{0}(i\\omega_{k})$:\n$$\n\\chi_{0}(i\\omega_{k}) \\leftarrow \\chi_{0}(i\\omega_{k}) + s_{ia}(k) \\, \\mathbf{b}_{ia} \\mathbf{b}_{ia}^{\\top} \\, ,\n$$\nwhere the vector $\\mathbf{b}_{ia}$ has components $B_{ia}^{X}$. The cost of one such rank-one update is explicitly given as $2 N_{X}^{2}$ flops.\nFor a single frequency, there are $o \\times v$ such updates. The cost is therefore $(o \\cdot v) \\times (2 N_{X}^{2})$.\nThis entire procedure is repeated for all $N_{\\omega}$ frequencies.\nThe total cost for Stage 3, $Cost_{3}$, is:\n$$\nCost_{3} = (\\text{number of frequencies}) \\times (\\text{number of pairs}) \\times (\\text{cost per update}) = N_{\\omega} \\cdot (o \\cdot v) \\cdot (2 N_{X}^{2}) = 2 N_{\\omega} o v N_{X}^{2} \\, .\n$$\n\n**Total Flop Count**\nThe leading-order total flop count for the entire algorithm is the sum of the costs of the three stages, as the cost of setting up scalars and other overheads is to be neglected.\n$$\nTotal Cost = Cost_{1} + Cost_{2} + Cost_{3}\n$$\n$$\nTotal Cost = 2 N^{2} v N_{X} + 2 N o v N_{X} + 2 N_{\\omega} o v N_{X}^{2} \\, .\n$$\nThis expression can be factored to provide a more compact form. We can factor out the common term $2 v N_{X}$:\n$$\nTotal Cost = 2 v N_{X} (N^{2} + N o + N_{\\omega} o N_{X}) \\, .\n$$\nThis is the final closed-form expression for the total leading-order flop count.", "answer": "$$\n\\boxed{2 N^{2} v N_{X} + 2 N o v N_{X} + 2 N_{\\omega} o v N_{X}^{2}}\n$$", "id": "2894551"}]}