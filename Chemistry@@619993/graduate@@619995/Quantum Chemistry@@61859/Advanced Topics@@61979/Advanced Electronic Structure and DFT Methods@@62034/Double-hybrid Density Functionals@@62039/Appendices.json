{"hands_on_practices": [{"introduction": "A key innovation in modern double-hybrid functionals is the inclusion of a second-order perturbative (PT2) correlation term, which is typically improved by applying different scaling factors to its same-spin ($E_c^{\\text{SS}}$) and opposite-spin ($E_c^{\\text{OS}}$) components. This hands-on calculation solidifies your understanding of how this spin-component scaled (SCS) perturbative correction, a critical ingredient for high accuracy, is computed from fundamental pair-energy contributions. By working through this exercise [@problem_id:2886705], you will gain a concrete grasp of an essential part of the double-hybrid energy expression.", "problem": "In double-hybrid density functional approximations (DH-DFAs), the perturbative correlation component is commonly taken from Møller–Plesset second-order perturbation theory (MP2). The second-order correlation energy in Rayleigh–Schrödinger perturbation theory is obtained from a canonical Hartree–Fock reference and can be partitioned into opposite-spin and same-spin contributions by classifying electron pairs according to their spin projection. In the spin-component scaling (SCS) approach used within double-hybrid density functionals, different prefactors are applied to the opposite-spin and same-spin totals before inclusion into the double-hybrid energy.\n\nConsider a closed-shell, small molecule for which a canonical Hartree–Fock calculation in a valence basis yields the following list of pairwise second-order correlation contributions (each entry is a pair-energy contribution computed from the standard MP2 expression for a single pair excitation), separated by spin class and reported in Hartree:\n- Opposite-spin pair energies: $-0.018432, -0.006517, -0.002981, -0.001257, -0.000843$.\n- Same-spin pair energies: $-0.003876, -0.001142, -0.000328$.\n\nUsing the definition of spin-component scaled perturbative correlation energy employed in double-hybrid density functionals, and given coefficients $c_{\\text{OS}}=1.20$ and $c_{\\text{SS}}=0.330$, compute the spin-component scaled second-order perturbative correlation energy. Express the final energy in Hartree and round your answer to five significant figures.", "solution": "The problem statement is scrutinized and found to be valid. It is scientifically grounded in the principles of quantum chemistry, specifically concerning double-hybrid density functional theory and Møller–Plesset perturbation theory. The problem is well-posed, providing all necessary data and definitions for a unique solution. The terminology is objective and precise.\n\nThe objective is to compute the spin-component scaled second-order perturbative correlation energy, denoted as $E_c^{\\text{SCS-MP2}}$. This quantity is defined as a linear combination of the total opposite-spin ($E_c^{\\text{OS}}$) and same-spin ($E_c^{\\text{SS}}$) second-order Møller–Plesset (MP2) correlation energies. The general expression is:\n$$E_c^{\\text{SCS-MP2}} = c_{\\text{OS}} E_c^{\\text{OS}} + c_{\\text{SS}} E_c^{\\text{SS}}$$\nwhere $c_{\\text{OS}}$ and $c_{\\text{SS}}$ are the empirically determined scaling coefficients for the opposite-spin and same-spin components, respectively.\n\nFirst, the total opposite-spin correlation energy, $E_c^{\\text{OS}}$, is calculated by summing the provided individual opposite-spin pair-energy contributions. The given pair energies are: $-0.018432$, $-0.006517$, $-0.002981$, $-0.001257$, and $-0.000843$, all in units of Hartree.\n$$E_c^{\\text{OS}} = (-0.018432) + (-0.006517) + (-0.002981) + (-0.001257) + (-0.000843) \\text{ Hartree}$$\n$$E_c^{\\text{OS}} = -0.030030 \\text{ Hartree}$$\n\nSecond, the total same-spin correlation energy, $E_c^{\\text{SS}}$, is calculated by summing the provided individual same-spin pair-energy contributions. The given pair energies are: $-0.003876$, $-0.001142$, and $-0.000328$, all in units of Hartree.\n$$E_c^{\\text{SS}} = (-0.003876) + (-0.001142) + (-0.000328) \\text{ Hartree}$$\n$$E_c^{\\text{SS}} = -0.005346 \\text{ Hartree}$$\n\nNow, these total spin-component energies are inserted into the defining equation for $E_c^{\\text{SCS-MP2}}$ along with the given scaling coefficients, $c_{\\text{OS}} = 1.20$ and $c_{\\text{SS}} = 0.330$.\n$$E_c^{\\text{SCS-MP2}} = (1.20) \\times E_c^{\\text{OS}} + (0.330) \\times E_c^{\\text{SS}}$$\n$$E_c^{\\text{SCS-MP2}} = (1.20) \\times (-0.030030) + (0.330) \\times (-0.005346) \\text{ Hartree}$$\nCalculating each term separately:\nThe scaled opposite-spin contribution is:\n$$(1.20) \\times (-0.030030) = -0.036036 \\text{ Hartree}$$\nThe scaled same-spin contribution is:\n$$(0.330) \\times (-0.005346) = -0.00176418 \\text{ Hartree}$$\nThe total spin-component scaled energy is the sum of these two terms:\n$$E_c^{\\text{SCS-MP2}} = -0.036036 - 0.00176418 = -0.03780018 \\text{ Hartree}$$\nThe problem requires the final answer to be rounded to five significant figures. The calculated value is $-0.03780018$. The first five significant figures are $3$, $7$, $8$, $0$, and $0$. The subsequent digit is $1$, which is less than $5$, so we round down (i.e., truncate).\nTherefore, the rounded value is $-0.037800$.", "answer": "$$\n\\boxed{-0.037800}\n$$", "id": "2886705"}, {"introduction": "Once the individual energy components are understood, the next step is to assemble the complete double-hybrid energy. This exercise guides you through constructing a non-self-consistent total energy by correctly combining Hartree-Fock exchange, density functional approximation (DFA) exchange, DFA correlation, and the PT2 correlation terms, each weighted by specific coefficients [@problem_id:2886706]. By building the expression using a fixed set of orbitals—a common and efficient \"post-SCF\" approach—you will appreciate the modular design of these functionals and learn how to prevent the double-counting of electronic effects.", "problem": "You are given a fixed parent hybrid Kohn–Sham orbital set generated from a generalized Kohn–Sham Hamiltonian. Your task is to design and implement a computational workflow to evaluate a non-self-consistent double-hybrid energy using only quantities that can be computed from this fixed orbital set, without re-optimizing orbitals.\n\nStart from the following fundamental base:\n- The Kohn–Sham total energy decomposition: $$E_{\\mathrm{tot}} = T_s + V_{\\mathrm{ne}} + J + E_{\\mathrm{xc}},$$ where $T_s$ is the non-interacting kinetic energy, $V_{\\mathrm{ne}}$ is the nuclear–electron attraction energy, $J$ is the classical Coulomb (Hartree) energy, and $E_{\\mathrm{xc}}$ is the exchange–correlation energy.\n- The Hartree–Fock exact exchange energy $E_{x}^{\\mathrm{HF}}$ can be evaluated from the same orbitals via the exchange part of the Fock operator.\n- A semilocal exchange–correlation energy functional yields $E_{x}^{\\mathrm{DFA}}$ and $E_{c}^{\\mathrm{DFA}}$ when evaluated on a real-space grid using the same orbitals and density, where DFA denotes Density Functional Approximation.\n- The second-order Møller–Plesset (MP2) correlation energy (opposite-spin and same-spin decomposed) evaluated on the same orbitals is defined as $$E_{2}^{\\mathrm{OS}} = \\sum_{i a j b}^{\\mathrm{OS}} \\frac{\\lvert \\langle i a \\Vert j b \\rangle \\rvert^2}{\\epsilon_i + \\epsilon_j - \\epsilon_a - \\epsilon_b}, \\quad E_{2}^{\\mathrm{SS}} = \\sum_{i a j b}^{\\mathrm{SS}} \\frac{\\lvert \\langle i a \\Vert j b \\rangle \\rvert^2}{\\epsilon_i + \\epsilon_j - \\epsilon_a - \\epsilon_b},$$ where indices $i, j$ run over occupied orbitals, $a, b$ run over virtual orbitals, the two-electron integrals $\\langle i a \\Vert j b \\rangle$ are antisymmetrized, and $\\epsilon_p$ are orbital energies. Both $E_{2}^{\\mathrm{OS}}$ and $E_{2}^{\\mathrm{SS}}$ are computed using the same parent orbitals.\n\nBecause you must not re-optimize the orbitals, treat the sum $$E_{\\mathrm{base}} \\equiv T_s + V_{\\mathrm{ne}} + J$$ as a constant for a given parent orbital set. A non-self-consistent double-hybrid energy is constructed as a linear combination of these components using scalar coefficients that weight the fixed-orbital exact exchange, semilocal exchange, semilocal correlation, and second-order perturbation correlation pieces. The coefficients are given and must be applied consistently so that no exchange or correlation contribution is double-counted.\n\nYour objectives:\n1. From the fundamental base above, reason about how to assemble a non-self-consistent double-hybrid total energy expression $E_{\\mathrm{DH}}$ that uses only the fixed-orbital quantities $E_{\\mathrm{base}}$, $E_{x}^{\\mathrm{HF}}$, $E_{x}^{\\mathrm{DFA}}$, $E_{c}^{\\mathrm{DFA}}$, $E_{2}^{\\mathrm{OS}}$, $E_{2}^{\\mathrm{SS}}$ and user-specified coefficients $c_x$, $c_c$, $c_{2}^{\\text{OS}}$, $c_{2}^{\\text{SS}}$. Explain why $E_{\\mathrm{base}}$ remains unchanged and how to prevent double counting between $E_{x}^{\\mathrm{HF}}$, $E_{x}^{\\mathrm{DFA}}$, and perturbative correlation.\n2. Implement a program that evaluates the derived $E_{\\mathrm{DH}}$ for the following test suite. All energies must be expressed in hartree ($E_h$). Your program should compute each case and round the result to $10$ decimal places.\n\nTest suite (each case lists, in order, the tuple of scalar coefficients and the fixed-orbital energy components, all in $E_h$):\n- Case A (general double-hybrid): coefficients ($c_x$, $c_c$, $c_{2}^{\\text{OS}}$, $c_{2}^{\\text{SS}}$) = (0.68, 0.36, 0.55, 0.12); components ($E_{\\text{base}}$, $E_{x}^{\\text{HF}}$, $E_{x}^{\\text{DFA}}$, $E_{c}^{\\text{DFA}}$, $E_{2}^{\\text{OS}}$, $E_{2}^{\\text{SS}}$) = (-75.00000000, -3.50000000, -3.20000000, -0.90000000, -0.45000000, -0.15000000).\n- Case B (pure hybrid boundary, no perturbative correlation): coefficients ($c_x$, $c_c$, $c_{2}^{\\text{OS}}$, $c_{2}^{\\text{SS}}$) = (0.50, 1.00, 0.00, 0.00); components ($E_{\\text{base}}$, $E_{x}^{\\text{HF}}$, $E_{x}^{\\text{DFA}}$, $E_{c}^{\\text{DFA}}$, $E_{2}^{\\text{OS}}$, $E_{2}^{\\text{SS}}$) = (-40.00000000, -2.00000000, -1.80000000, -0.40000000, -0.20000000, -0.05000000).\n- Case C (Hartree–Fock exchange limit with full MP2): coefficients ($c_x$, $c_c$, $c_{2}^{\\text{OS}}$, $c_{2}^{\\text{SS}}$) = (1.00, 0.00, 1.00, 1.00); components ($E_{\\text{base}}$, $E_{x}^{\\text{HF}}$, $E_{x}^{\\text{DFA}}$, $E_{c}^{\\text{DFA}}$, $E_{2}^{\\text{OS}}$, $E_{2}^{\\text{SS}}$) = (-15.00000000, -1.00000000, -0.90000000, -0.20000000, -0.05000000, -0.02000000).\n- Case D (spin-component scaled with negative same-spin coefficient): coefficients ($c_x$, $c_c$, $c_{2}^{\\text{OS}}$, $c_{2}^{\\text{SS}}$) = (0.72, 0.42, 0.65, -0.05); components ($E_{\\text{base}}$, $E_{x}^{\\text{HF}}$, $E_{x}^{\\text{DFA}}$, $E_{c}^{\\text{DFA}}$, $E_{2}^{\\text{OS}}$, $E_{2}^{\\text{SS}}$) = (-100.00000000, -6.70000000, -6.10000000, -1.60000000, -0.95000000, -0.35000000).\n\nFinal output format:\n- Your program should produce a single line of output containing the four computed energies in $E_h$, each rounded to $10$ decimal places, as a comma-separated list enclosed in square brackets, with no spaces. For example, $[x_1,x_2,x_3,x_4]$ where each $x_k$ is a float in $E_h$ rounded to $10$ decimal places.", "solution": "The problem requires the formulation and implementation of a non-self-consistent double-hybrid energy calculation. The validation of the problem statement is the mandatory first step.\n\n### Problem Validation\n\n#### Step 1: Extract Givens\n\nThe provided information consists of:\n-   The Kohn-Sham total energy decomposition: $E_{\\mathrm{tot}} = T_s + V_{\\mathrm{ne}} + J + E_{\\mathrm{xc}}$.\n-   A constant base energy from a fixed orbital set: $E_{\\mathrm{base}} \\equiv T_s + V_{\\mathrm{ne}} + J$.\n-   Available energy components computed from the fixed orbital set:\n    -   Hartree–Fock exact exchange energy: $E_{x}^{\\mathrm{HF}}$.\n    -   Semilocal exchange energy from a Density Functional Approximation (DFA): $E_{x}^{\\mathrm{DFA}}$.\n    -   Semilocal correlation energy from a DFA: $E_{c}^{\\mathrm{DFA}}$.\n    -   Opposite-spin second-order Møller–Plesset (MP2) correlation energy: $E_{2}^{\\mathrm{OS}}$.\n    -   Same-spin second-order Møller–Plesset (MP2) correlation energy: $E_{2}^{\\mathrm{SS}}$.\n-   -   The definitions for the MP2 components: $$E_{2}^{\\mathrm{OS}} = \\sum_{i a j b}^{\\mathrm{OS}} \\frac{\\lvert \\langle i a \\Vert j b \\rangle \\rvert^2}{\\epsilon_i + \\epsilon_j - \\epsilon_a - \\epsilon_b}, \\quad E_{2}^{\\mathrm{SS}} = \\sum_{i a j b}^{\\mathrm{SS}} \\frac{\\lvert \\langle i a \\Vert j b \\rangle \\rvert^2}{\\epsilon_i + \\epsilon_j - \\epsilon_a - \\epsilon_b}$$\n-   User-specified coefficients for constructing the double-hybrid energy: $c_x$, $c_c$, $c_{2}^{\\text{OS}}$, $c_{2}^{\\text{SS}}$.\n-   A test suite of four cases, each providing a set of coefficients and corresponding energy components in units of hartree ($E_h$).\n    -   Case A: ($c_x, c_c, c_{2}^{\\text{OS}}, c_{2}^{\\text{SS}}$) = (0.68, 0.36, 0.55, 0.12); ($E_{\\text{base}}, E_{x}^{\\text{HF}}, E_{x}^{\\text{DFA}}, E_{c}^{\\text{DFA}}, E_{2}^{\\text{OS}}, E_{2}^{\\text{SS}}$) = (-75.0, -3.5, -3.2, -0.9, -0.45, -0.15).\n    -   Case B: ($c_x, c_c, c_{2}^{\\text{OS}}, c_{2}^{\\text{SS}}$) = (0.50, 1.00, 0.00, 0.00); ($E_{\\text{base}}, E_{x}^{\\text{HF}}, E_{x}^{\\text{DFA}}, E_{c}^{\\text{DFA}}, E_{2}^{\\text{OS}}, E_{2}^{\\text{SS}}$) = (-40.0, -2.0, -1.8, -0.4, -0.2, -0.05).\n    -   Case C: ($c_x, c_c, c_{2}^{\\text{OS}}, c_{2}^{\\text{SS}}$) = (1.00, 0.00, 1.00, 1.00); ($E_{\\text{base}}, E_{x}^{\\text{HF}}, E_{x}^{\\text{DFA}}, E_{c}^{\\text{DFA}}, E_{2}^{\\text{OS}}, E_{2}^{\\text{SS}}$) = (-15.0, -1.0, -0.9, -0.2, -0.05, -0.02).\n    -   Case D: ($c_x, c_c, c_{2}^{\\text{OS}}, c_{2}^{\\text{SS}}$) = (0.72, 0.42, 0.65, -0.05); ($E_{\\text{base}}, E_{x}^{\\text{HF}}, E_{x}^{\\text{DFA}}, E_{c}^{\\text{DFA}}, E_{2}^{\\text{OS}}, E_{2}^{\\text{SS}}$) = (-100.0, -6.7, -6.1, -1.6, -0.95, -0.35).\n\n#### Step 2: Validate Using Extracted Givens\n\nThe problem statement is evaluated against the required criteria:\n-   **Scientifically Grounded**: The problem is an accurate representation of a standard post-processing step in quantum chemistry, specifically the calculation of a non-self-consistent double-hybrid functional energy. All terms ($E_x^{\\mathrm{HF}}$, $E_c^{\\mathrm{DFA}}$, $E_c^{\\mathrm{MP2}}$, etc.) are well-defined and standard in the field. The procedure is physically and mathematically sound.\n-   **Well-Posed**: The problem is structured as a derivation followed by a direct application of the derived formula to given data. It is self-contained, and a unique, stable solution exists for each test case.\n-   **Objective**: The language is formal and uses precise terminology from theoretical and computational chemistry, free of ambiguity or subjective claims.\n\nThe problem does not exhibit any flaws such as scientific unsoundness, incompleteness, contradiction, or infeasibility.\n\n#### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be developed.\n\n### Solution\n\nThe objective is to construct a non-self-consistent double-hybrid energy, $E_{\\mathrm{DH}}$, from a set of pre-computed energy components derived from a fixed Kohn-Sham orbital set.\n\n#### 1. Derivation of the Double-Hybrid Energy Expression\n\nThe total energy is assembled from a base component and an exchange-correlation component:\n$$E_{\\mathrm{DH}} = E_{\\mathrm{base}} + E_{\\mathrm{xc}}^{\\mathrm{DH}}$$\nThe term $E_{\\mathrm{base}} = T_s + V_{\\mathrm{ne}} + J$ depends on the one-electron kinetic energy ($T_s$), the nuclear-electron potential energy ($V_{\\mathrm{ne}}$), and the classical electron-electron Coulomb repulsion energy ($J$). These quantities are functionals of the electron density $\\rho$ and the Kohn-Sham orbitals $\\{\\psi_i\\}$. Since the problem specifies that the orbitals are fixed (i.e., not re-optimized for the double-hybrid functional), $E_{\\mathrm{base}}$ is a constant value for a given calculation.\n\nThe exchange-correlation energy, $E_{\\mathrm{xc}}^{\\mathrm{DH}}$, is constructed as a linear combination of its exchange and correlation parts:\n$$E_{\\mathrm{xc}}^{\\mathrm{DH}} = E_{x}^{\\mathrm{DH}} + E_{c}^{\\mathrm{DH}}$$\n\n**Exchange Component ($E_{x}^{\\mathrm{DH}}$):**\nThe exchange energy in a hybrid functional is a mixture of Hartree-Fock (HF) exact exchange, $E_{x}^{\\mathrm{HF}}$, and a semi-local DFA exchange, $E_{x}^{\\mathrm{DFA}}$. The coefficient $c_x$ dictates the fraction of exact exchange. To prevent double-counting of exchange effects, the contribution from the DFA exchange must be complementary. Therefore, the total exchange energy is:\n$$E_{x}^{\\mathrm{DH}} = c_x E_{x}^{\\mathrm{HF}} + (1 - c_x) E_{x}^{\\mathrm{DFA}}$$\nThis formulation ensures that the total exchange contribution is correctly normalized. For instance, if $c_x = 1$, all DFA exchange is removed, and if $c_x = 0$, the functional reverts to pure DFA exchange.\n\n**Correlation Component ($E_{c}^{\\mathrm{DH}}$):**\nThe correlation energy in a double-hybrid functional combines a DFA correlation term, $E_{c}^{\\mathrm{DFA}}$, with a non-local correlation correction from second-order Møller-Plesset perturbation theory (MP2). The problem provides separate coefficients for the DFA correlation ($c_c$) and the opposite-spin ($c_{2}^{\\text{OS}}$) and same-spin ($c_{2}^{\\text{SS}}$) components of the MP2 correlation. The terms $E_{c}^{\\mathrm{DFA}}$ and $E_{c}^{\\mathrm{MP2}}$ are distinct approximations to the true correlation energy, capturing different physical aspects (e.g., static vs. dynamic correlation). They are thus treated as additive components, each scaled by its own empirically determined coefficient. This is standard practice in modern spin-component-scaled double-hybrid functionals. The formulation is:\n$$E_{c}^{\\mathrm{DH}} = c_c E_{c}^{\\mathrm{DFA}} + c_{2}^{\\text{OS}} E_{2}^{\\mathrm{OS}} + c_{2}^{\\text{SS}} E_{2}^{\\mathrm{SS}}$$\nThe instruction to avoid double-counting is satisfied because $E_{c}^{\\mathrm{DFA}}$ and the perturbative corrections are fundamentally different types of energy terms, and their weighted sum is how the functional is defined. The coefficients are parameters fitted to reproduce high-quality benchmark data.\n\n**Total Double-Hybrid Energy ($E_{\\mathrm{DH}}$):**\nCombining all components yields the final expression for the non-self-consistent double-hybrid energy:\n$$E_{\\mathrm{DH}} = E_{\\mathrm{base}} + \\left[ c_x E_{x}^{\\mathrm{HF}} + (1 - c_x) E_{x}^{\\mathrm{DFA}} \\right] + \\left[ c_c E_{c}^{\\mathrm{DFA}} + c_{2}^{\\text{OS}} E_{2}^{\\mathrm{OS}} + c_{2}^{\\text{SS}} E_{2}^{\\text{SS}} \\right]$$\nThis equation is a clear, step-by-step assembly of the given components, adhering to the principles of quantum chemical model construction.\n\n#### 2. Implementation for the Test Suite\n\nThe derived formula will now be implemented to compute the total energy for the four specified test cases. The logic directly follows the equation. For each case, the provided coefficients and energy components are substituted into the formula. The result is rounded to $10$ decimal places as required.\n\nFor example, for Case A:\n$c_x = 0.68$, $c_c = 0.36$, $c_{2}^{\\text{OS}} = 0.55$, $c_{2}^{\\text{SS}} = 0.12$\n$E_{\\text{base}} = -75.0$, $E_{x}^{\\text{HF}} = -3.5$, $E_{x}^{\\text{DFA}} = -3.2$, $E_{c}^{\\text{DFA}} = -0.9$, $E_{2}^{\\text{OS}} = -0.45$, $E_{2}^{\\text{SS}} = -0.15$\n\n$E_{\\mathrm{DH}} = -75.0 + [0.68(-3.5) + (1-0.68)(-3.2)] + [0.36(-0.9) + 0.55(-0.45) + 0.12(-0.15)]$\n$E_{\\mathrm{DH}} = -75.0 + [-2.38 - 1.024] + [-0.324 - 0.2475 - 0.018]$\n$E_{\\mathrm{DH}} = -75.0 - 3.404 - 0.5895 = -78.9935$\n\nThis procedure is repeated for all cases. The final implementation is provided in the following section.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the non-self-consistent double-hybrid energy for a suite of test cases.\n    \"\"\"\n\n    # Test suite: each case is a tuple containing:\n    # 1. A tuple of coefficients: (c_x, c_c, c_2_os, c_2_ss)\n    # 2. A tuple of energy components: (E_base, E_x_HF, E_x_DFA, E_c_DFA, E_2_os, E_2_ss)\n    # All energies are in hartree (E_h).\n    test_cases = [\n        # Case A: General double-hybrid\n        ( (0.68, 0.36, 0.55, 0.12), \n          (-75.00000000, -3.50000000, -3.20000000, -0.90000000, -0.45000000, -0.15000000) ),\n        # Case B: Pure hybrid boundary, no perturbative correlation\n        ( (0.50, 1.00, 0.00, 0.00), \n          (-40.00000000, -2.00000000, -1.80000000, -0.40000000, -0.20000000, -0.05000000) ),\n        # Case C: Hartree-Fock exchange limit with full MP2\n        ( (1.00, 0.00, 1.00, 1.00), \n          (-15.00000000, -1.00000000, -0.90000000, -0.20000000, -0.05000000, -0.02000000) ),\n        # Case D: Spin-component scaled with negative same-spin coefficient\n        ( (0.72, 0.42, 0.65, -0.05), \n          (-100.00000000, -6.70000000, -6.10000000, -1.60000000, -0.95000000, -0.35000000) )\n    ]\n\n    results = []\n    for case in test_cases:\n        coeffs, energies = case\n        c_x, c_c, c_2_os, c_2_ss = coeffs\n        e_base, e_x_hf, e_x_dfa, e_c_dfa, e_2_os, e_2_ss = energies\n\n        # Assemble the exchange component\n        # E_x_DH = c_x * E_x_HF + (1 - c_x) * E_x_DFA\n        e_x_dh = c_x * e_x_hf + (1 - c_x) * e_x_dfa\n\n        # Assemble the correlation component\n        # E_c_DH = c_c * E_c_DFA + c_2_os * E_2_os + c_2_ss * E_2_ss\n        e_c_dh = c_c * e_c_dfa + c_2_os * e_2_os + c_2_ss * e_2_ss\n\n        # Assemble the total double-hybrid energy\n        # E_DH = E_base + E_x_DH + E_c_DH\n        e_dh = e_base + e_x_dh + e_c_dh\n\n        # Round the result to 10 decimal places as required.\n        # Use formatting to ensure trailing zeros are preserved if needed.\n        # The rounding is effectively handled by the format string.\n        results.append(f\"{e_dh:.10f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2886706"}, {"introduction": "While powerful, double-hybrid functionals are not universally applicable and can produce unreliable results for certain chemical systems. An expert practitioner must be able to diagnose these potential failures, which often arise from strong static correlation effects or from significant errors in the underlying approximate density. This exercise challenges you to think critically by designing a robust diagnostic workflow to flag problematic cases, ensuring the reliable application of double-hybrid methods in research [@problem_id:2886741]. You will learn to combine advanced indicators like the coupled-cluster $T_1$ diagnostic and density-sensitivity metrics to make informed decisions about computational strategy.", "problem": "An advanced practitioner wishes to deploy double-hybrid density functionals for a chemically diverse test set but is concerned about two known failure modes: (i) breakdown of second-order Møller–Plesset perturbation theory (MP2)–like correlation in the presence of strong static correlation, and (ii) large density-driven errors in Density Functional Theory (DFT) that can propagate into a non-self-consistent double-hybrid evaluation. The practitioner proposes to construct a diagnostic workflow that uses a coupled-cluster singles-based indicator and a density-sensitivity check to flag cases where a conventional Kohn–Sham (KS) orbital-based double hybrid is likely to be unreliable.\n\nFrom electronic structure theory, justify and select the most scientifically sound workflow among the options below, starting from the following accepted bases:\n\n- In the presence of strong static (multireference) correlation, perturbation theories around a single determinant such as second-order Møller–Plesset perturbation theory (MP2) can become qualitatively unreliable.\n- The coupled-cluster singles and doubles (CCSD) $T_1$ diagnostic, defined as the Euclidean norm of the singles amplitudes, increases when the reference determinant is qualitatively poor; empirical thresholds such as $T_1 \\gtrsim 0.02$ (closed shell) and $T_1 \\gtrsim 0.044$ (open shell) are commonly used to flag multireference character.\n- Natural orbital occupation numbers (NOONs) far from $2$ for occupied orbitals or from $0$ for virtual orbitals signal static correlation; as a rough rule of thumb, deviations exceeding about $0.1$ (e.g., $n_{\\text{HOMO}} \\lesssim 1.9$ or $n_{\\text{LUMO}} \\gtrsim 0.1$) indicate potential multireference character.\n- Total energy errors in DFT can be decomposed into functional-driven and density-driven components. A practical density-sensitivity metric is to evaluate a chosen density functional approximation (DFA) on two densities and take an absolute energy difference, for example\n$$\nS_{\\text{DFA}} \\equiv \\left| E_{\\text{DFA}}\\!\\left[n_{\\text{DFA}}\\right] - E_{\\text{DFA}}\\!\\left[n_{\\text{HF}}\\right] \\right|,\n$$\nwhere $n_{\\text{HF}}$ is a Hartree–Fock (HF) density and $n_{\\text{DFA}}$ is the self-consistent DFA density. Values $S_{\\text{DFA}} \\gtrsim 2\\,\\text{kcal mol}^{-1}$ often indicate significant density-driven error.\n- Many commonly used double hybrids are not self-consistent in the density and include a fraction $c_2$ of $E_c^{\\text{MP2}}$ built from KS orbitals. When density-driven error is large, evaluating the energy on a more accurate density (e.g., HF) or using orbital-optimized variants can mitigate errors. When static correlation is strong, the $E_c^{\\text{MP2}}$ term itself is unreliable.\n\nWhich option gives a workflow that is consistent with these principles, uses practical and scientifically defensible thresholds, and prescribes actions that reduce known sources of error without introducing new, unjustified ones?\n\nA. Workflow:\n- Step $1$ (static correlation screen): Compute the CCSD $T_1$ diagnostic for closed-shell systems and its open-shell analogue for open-shell cases. If $T_1 \\ge 0.02$ (closed shell) or $T_1 \\ge 0.044$ (open shell), or if a NOON analysis shows $n_{\\text{HOMO}} \\le 1.90$ or $n_{\\text{LUMO}} \\ge 0.10$, flag strong static correlation and avoid conventional double hybrids; prefer multireference methods (e.g., complete active space self-consistent field (CASSCF) with second-order N-electron valence state perturbation theory (NEVPT2)) or orbital-optimized double hybrids with caution.\n- Step $2$ (density sensitivity): For systems passing Step $1$, compute $S_{\\text{DFA}}$ using a parent generalized gradient approximation (GGA) or hybrid (e.g., PBE0) as\n$$\nS_{\\text{DFA}} = \\left| E_{\\text{DFA}}\\!\\left[n_{\\text{DFA}}\\right] - E_{\\text{DFA}}\\!\\left[n_{\\text{HF}}\\right] \\right|.\n$$\nIf $S_{\\text{DFA}} \\ge 2\\,\\text{kcal mol}^{-1}$, prefer a double hybrid evaluated on HF orbitals/density (e.g., exchange-hole dipole moment–type xDH variants or density-corrected DFT for the underlying DFA) or an orbital-optimized double hybrid; if $S_{\\text{DFA}} < 2\\,\\text{kcal mol}^{-1}$, proceed with a conventional KS-orbital double hybrid.\n- Step $3$ (final flag): If Step $1$ indicates static correlation or both Step $1$ and Step $2$ fail, flag the system as high risk for double-hybrid unreliability.\n\nB. Workflow:\n- Step $1$: Use the Kohn–Sham HOMO–LUMO gap alone as a proxy for static correlation; if the gap is less than $0.5\\,\\text{eV}$, proceed to Step $2$, otherwise use a conventional KS-orbital double hybrid without further checks.\n- Step $2$: Define density sensitivity as\n$$\nS_{\\text{DH}} \\equiv \\left| E_{\\text{DH}}\\!\\left[n_{\\text{DH}}\\right] - E_{\\text{DH}}\\!\\left[n_{\\text{HF}}\\right] \\right|,\n$$\nwhere $E_{\\text{DH}}$ is a fully self-consistent double-hybrid energy and $n_{\\text{DH}}$ its self-consistent density. If $S_{\\text{DH}} \\ge 0.5\\,\\text{kcal mol}^{-1}$, always revert to a pure HF calculation.\n\nC. Workflow:\n- Step $1$: Skip $T_1$ and NOONs; instead, rely solely on the expectation value of the spin operator, flagging any unrestricted solution with $\\langle \\hat{S}^2 \\rangle$ deviating by more than $0.05$ from the exact value as multireference.\n- Step $2$: Compute $S_{\\text{LDA}} = \\left| E_{\\text{LDA}}\\!\\left[n_{\\text{LDA}}\\right] - E_{\\text{LDA}}\\!\\left[n_{\\text{HF}}\\right] \\right|$ and, if $S_{\\text{LDA}} \\ge 0.2\\,\\text{kcal mol}^{-1}$, always force the double hybrid to use HF orbitals; otherwise use self-consistent double-hybrid orbitals.\n\nD. Workflow:\n- Step $1$: Use the CCSD $T_1$ diagnostic with thresholds $T_1 \\ge 0.05$ (closed shell) and $T_1 \\ge 0.10$ (open shell) to flag static correlation; if flagged, proceed with a conventional KS-orbital double hybrid because the exact exchange fraction will stabilize it.\n- Step $2$: Compute $S_{\\text{DFA}}$ as in Option A, but if $S_{\\text{DFA}} \\ge 2\\,\\text{kcal mol}^{-1}$, prefer to keep the self-consistent KS density because self-consistency is always beneficial for double hybrids.\n\nE. Workflow:\n- Step $1$: Use the magnitude of the MP2 correlation energy $|E_c^{\\text{MP2}}|$ from a KS reference as the sole indicator; if $|E_c^{\\text{MP2}}| \\ge 50\\,\\text{kcal mol}^{-1}$, conclude the system is single-reference and proceed; otherwise, flag multireference.\n- Step $2$: Skip density sensitivity; double hybrids are variational and thus insensitive to density choice.\n\nSelect the option that best satisfies the stated scientific criteria and provides a practical, justified path to flagging systems where a double hybrid may be unreliable. Only one option is fully correct.", "solution": "The task is to validate and select a scientifically sound workflow for applying double-hybrid density functionals. The workflow must correctly identify and propose remedies for two known failure modes: (i) the unreliability of the second-order Møller–Plesset perturbation theory (MP2) component in the presence of strong static correlation, and (ii) large density-driven errors from the underlying Density Functional Theory (DFA) calculation.\n\nFirst, I shall validate the problem statement.\n\n**Step 1: Extract Givens**\n- **Method:** Double-hybrid density functionals.\n- **Problem Context:** A non-self-consistent evaluation where the MP2-like correlation energy, $E_c^{\\text{MP2}}$, is calculated using Kohn–Sham (KS) orbitals from an underlying DFA. The total energy is a sum of the DFA energy and a scaled MP2 correction term, e.g., $E_{\\text{DH}} = E_{\\text{DFA}} + c_2 E_c^{\\text{MP2}}$.\n- **Failure Mode 1 (Static Correlation):** The MP2 component, being a single-reference perturbation theory, becomes unreliable or even divergent for systems with strong static (multireference) correlation.\n- **Failure Mode 2 (Density-Driven Error):** The underlying DFA may produce a poor self-consistent density, $n_{\\text{DFA}}$, leading to a large \"density-driven error\". This error affects the DFA energy component and also propagates to the $E_c^{\\text{MP2}}$ term via the KS orbitals.\n- **Diagnostic for Static Correlation (Indicator 1):** The coupled-cluster singles and doubles (CCSD) $T_1$ diagnostic. Recommended thresholds are $T_1 \\gtrsim 0.02$ for closed-shell systems and $T_1 \\gtrsim 0.044$ for open-shell systems.\n- **Diagnostic for Static Correlation (Indicator 2):** Natural orbital occupation numbers (NOONs). Deviations from ideality (2 for occupied, 0 for virtual) by more than $\\approx 0.1$ (e.g., $n_{\\text{HOMO}} \\lesssim 1.9$ or $n_{\\text{LUMO}} \\gtrsim 0.1$) suggest multireference character.\n- **Diagnostic for Density-Driven Error:** A density-sensitivity metric, $S_{\\text{DFA}} \\equiv \\left| E_{\\text{DFA}}\\!\\left[n_{\\text{DFA}}\\right] - E_{\\text{DFA}}\\!\\left[n_{\\text{HF}}\\right] \\right|$. A value of $S_{\\text{DFA}} \\gtrsim 2\\,\\text{kcal mol}^{-1}$ is considered significant.\n- **Remedies:** For strong static correlation, multireference methods (e.g., CASSCF/NEVPT2) are appropriate. For large density-driven errors, using a more reliable density/set of orbitals (e.g., from Hartree–Fock, HF) or using an orbital-optimized double-hybrid variant can mitigate the error.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem statement is scientifically grounded. The described failure modes of double-hybrid functionals are well-documented in the quantum chemistry literature. The diagnostics presented—the $T_1$ diagnostic, NOON analysis, and the $S_{\\text{DFA}}$ metric—are standard tools for assessing multireference character and density-driven errors, respectively. The proposed thresholds and remedies are consistent with established best practices. The problem is well-posed, asking for the evaluation of several proposed workflows against a clear set of scientific principles. There are no contradictions, ambiguities, or factual inaccuracies in the setup.\n\n**Step 3: Verdict and Action**\nThe problem is valid. I will now proceed to analyze the options.\n\nA scientifically sound workflow must prioritize the check for static correlation, as this represents a more fundamental breakdown of the method's ansatz (the perturbative correction). If the system is determined to be single-reference, a subsequent check for density-driven error is logical. The actions prescribed for each flagged issue must be remedies that directly address the specific source of error.\n\n**Option-by-Option Analysis**\n\n**A. Workflow:**\n- **Step 1 (Static Correlation Screen):** This step correctly employs two robust diagnostics for static correlation: the CCSD $T_1$ diagnostic and NOON analysis. The specified numerical thresholds ($T_1 \\ge 0.02$ and $T_1 \\ge 0.044$; NOON deviations of $\\approx 0.1$) are standard and scientifically defensible. The prescribed action upon flagging is also correct: avoid conventional double hybrids and use appropriate multireference methods (CASSCF/NEVPT2) or proceed with caution using potentially more robust orbital-optimized double hybrids. This correctly identifies and addresses Failure Mode 1.\n- **Step 2 (Density Sensitivity):** This step is performed on systems that pass the first screen, which is the correct logical order. It uses the density-sensitivity metric $S_{\\text{DFA}}$ as defined in the problem statement with the recommended threshold of $2\\,\\text{kcal mol}^{-1}$. The prescribed action for a flagged system ($S_{\\text{DFA}} \\ge 2\\,\\text{kcal mol}^{-1}$) is to use a potentially more reliable set of orbitals (from HF) or to use an orbital-optimized variant. Both are valid strategies to mitigate density-driven error, as noted in the problem's givens. For systems that pass, it correctly advises that a conventional double hybrid is likely reliable. This correctly identifies and addresses Failure Mode 2.\n- **Step 3 (Final Flag):** This is a summary statement. While its logical structure is slightly clumsy, it does not invalidate the soundness of the procedural steps that precede it. The core of the workflow in Steps 1 and 2 is excellent.\n- **Verdict:** Based on the provided principles, this workflow is systematic, uses state-of-the-art diagnostics with appropriate thresholds, and recommends scientifically sound actions. It is a robust and practical protocol. **Correct**.\n\n**B. Workflow:**\n- **Step 1:** This step relies solely on the KS HOMO–LUMO gap. While a small gap can be correlated with static correlation, it is not a reliable or sufficient diagnostic. Many systems with small gaps are perfectly single-reference in character, and this check would produce many false positives. Conversely, it can fail to detect multireference character in other cases. It discards the far more reliable $T_1$ and NOON diagnostics.\n- **Step 2:** This step proposes a metric based on a fully self-consistent double hybrid, which is often not the method being used, and prescribes reverting to a pure HF calculation if the metric is above $0.5\\,\\text{kcal mol}^{-1}$. Abandoning a correlated method like a double hybrid for HF is an overly simplistic and generally poor action, as it discards the treatment of dynamic correlation entirely. A better action is to improve the double-hybrid calculation, not discard it. The threshold is also arbitrarily low.\n- **Verdict:** This workflow is based on a poor diagnostic and an inappropriate remedial action. **Incorrect**.\n\n**C. Workflow:**\n- **Step 1:** This step relies on the spin contamination metric $\\langle \\hat{S}^2 \\rangle$. While useful, this diagnostic is not general; it fails for closed-shell multireference systems and for restricted open-shell cases which can also have multireference character. To discard the superior $T_1$ and NOON diagnostics is a poor choice.\n- **Step 2:** This step uses the LDA functional for the density sensitivity test. LDA is known to suffer from extreme delocalization error, making it a poor and overly sensitive choice for this diagnostic. The proposed threshold of $0.2\\,\\text{kcal mol}^{-1}$ is far too strict and would flag nearly all molecular systems, rendering the diagnostic useless for practical screening.\n- **Verdict:** This workflow uses incomplete and poorly chosen diagnostics and thresholds. **Incorrect**.\n\n**D. Workflow:**\n- **Step 1:** This step uses the $T_1$ diagnostic but with excessively high thresholds ($0.05$ for closed-shell, $0.10$ for open-shell), which would fail to flag many systems with significant multireference character. Critically, its prescribed action is scientifically backward: it recommends *using* a conventional double hybrid *because* it is flagged for static correlation. This contradicts the fundamental principle that MP2 fails in this regime. The justification regarding the exact exchange fraction is nonsensical in this context.\n- **Step 2:** This step recommends *keeping* the self-consistent KS density even when a large density-driven error is detected, under the false premise that \"self-consistency is always beneficial.\" This demonstrates a fundamental misunderstanding of density-driven error, where the self-consistent solution for a given approximate functional can be qualitatively wrong. The correct action is to replace the poor density/orbitals, not to insist on using them.\n- **Verdict:** This workflow is based on inverted logic and scientifically unsound reasoning for both failure modes. **Incorrect**.\n\n**E. Workflow:**\n- **Step 1:** The premise that the magnitude of the MP2 correlation energy, $|E_c^{\\text{MP2}}|$, is a direct indicator of single- versus multi-reference character is false. A large $|E_c^{\\text{MP2}}|$ simply indicates a large correlation correction, which can occur in both single- and multi-reference systems. For strongly correlated systems, the MP2 energy can become unphysically large and negative, but there is no simple threshold rule as suggested. The logic presented is completely inverted and baseless.\n- **Step 2:** This step skips the density-sensitivity check, claiming that double hybrids \"are variational and thus insensitive to density choice\". This is false on two counts. First, non-self-consistent \"post-KS\" double hybrids are not variational with respect to orbital variations. Second, even for variational methods, the energy is a functional of the density, and a poor density will yield a poor energy.\n- **Verdict:** This workflow is built on entirely false scientific premises and exhibits a severe lack of understanding of the underlying theory. **Incorrect**.\n\nIn conclusion, only workflow A presents a scientifically valid, logical, and practical protocol consistent with the principles of modern quantum chemistry.", "answer": "$$\\boxed{A}$$", "id": "2886741"}]}