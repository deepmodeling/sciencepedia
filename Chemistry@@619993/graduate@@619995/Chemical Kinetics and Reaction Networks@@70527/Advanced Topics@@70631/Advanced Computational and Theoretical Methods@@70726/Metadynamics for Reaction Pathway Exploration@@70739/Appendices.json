{"hands_on_practices": [{"introduction": "Moving from theory to practice is a crucial step in mastering any computational method. This first exercise guides you through the process of building a simplified metadynamics simulation from the ground up for a one-dimensional system with a known free energy profile [@problem_id:2655481]. By implementing the overdamped Langevin dynamics and bias deposition, you will gain a concrete understanding of the algorithm's mechanics. The critical final step involves using the simulation trajectory to reconstruct the underlying free energy and verify that the result matches the known answer, a fundamental validation skill in computational science.", "problem": "Consider a one-dimensional collective variable $s \\in \\mathbb{R}$ for a $1$-component, $2$-state system with a known free energy profile $F(s)$ expressed in units of Boltzmann constant times temperature ($k_{\\mathrm{B}}T$), so that the inverse temperature is $\\beta = 1$. The system exhibits two metastable basins, defined by regions $A = \\{ s \\, | \\, s  0 \\}$ and $B = \\{ s \\, | \\, s \\ge 0 \\}$. You will simulate overdamped Langevin dynamics with a time-dependent bias potential constructed via a simplified metadynamics deposition scheme, and you will verify numerically that reweighted histograms recover the correct free energy difference between basins within statistical error.\n\nFundamental base to use:\n- Overdamped Langevin dynamics in a potential $U(s,t)$ yields the stochastic differential equation $ds = -D \\, \\beta \\, \\partial_s U(s,t) \\, dt + \\sqrt{2 D \\, dt} \\, \\eta$, where $D$ is a diffusion constant, $dt$ is the time step, and $\\eta$ is a standard normal variate.\n- The Boltzmann distribution for a stationary potential $U(s)$ is $p(s) \\propto \\exp\\left(-\\beta \\, U(s)\\right)$.\n- The free energy of a region $X \\in \\{A,B\\}$ is $G_X = -\\beta^{-1} \\ln Z_X$, where $Z_X = \\int_X \\exp\\left(-\\beta \\, F(s)\\right) \\, ds$ is the restricted partition function over region $X$.\n- The free energy difference between basins is $\\Delta G = G_B - G_A = -\\beta^{-1} \\ln \\left( Z_B / Z_A \\right)$.\n\nTask overview (do not use any unproven shortcut formulas beyond the fundamental base above):\n- The known unbiased free energy profile is a quartic double-well with a linear tilt $F(s) = a \\, s^4 - b \\, s^2 + c \\, s$, with parameters $a = 1$, $b = 3$, $c = 0.5$ (all in units of $k_{\\mathrm{B}}T$). From the definition of $Z_A$ and $Z_B$, compute the reference value of $\\Delta G$ by numerical quadrature over $s \\in (-\\infty,0)$ and $s \\in [0,\\infty)$ respectively. Express $\\Delta G$ in units of $k_{\\mathrm{B}}T$ as a floating-point number.\n- Evolve the collective variable with overdamped Langevin dynamics where $U(s,t) = F(s) + V_{\\mathrm{bias}}(s,t)$, $D = 1$, and $\\beta = 1$. Use Euler–Maruyama discretization with time step $dt$ as specified per test case. Impose reflecting boundaries at $s = \\pm L$ with $L = 3$.\n- Construct $V_{\\mathrm{bias}}(s,t)$ by depositing Gaussian kernels at fixed strides in time: every $n_{\\mathrm{stride}}$ steps, add a Gaussian $w_0 \\, \\exp\\left(-\\frac{(s - s_i)^2}{2 \\sigma^2}\\right)$ centered at the current $s_i$ to $V_{\\mathrm{bias}}(s,t)$, where $w_0$ is the Gaussian height and $\\sigma$ is the width, both specified per test case. Initialize $V_{\\mathrm{bias}}(s,0) = 0$. This is a simplified (plain) metadynamics bias deposition.\n- Using samples from the time-dependent biased dynamics, construct an estimator for the unbiased probability ratio between basins $B$ and $A$, derived from the Boltzmann principle and the definition of the biased stationary distribution at a given time. From this, obtain an estimator of $\\Delta G$ as a function of the trajectory and $V_{\\mathrm{bias}}(s,t)$.\n- Estimate the statistical standard error of the $\\Delta G$ estimator using block averaging: partition the analysis segment of the trajectory into $M$ contiguous blocks with equal length (choose $M \\ge 8$), compute an estimate from each block, and obtain the standard error as the sample standard deviation across blocks divided by $\\sqrt{M}$.\n- Verification criterion: declare a test to have passed if the absolute deviation $|\\Delta G_{\\mathrm{est}} - \\Delta G_{\\mathrm{ref}}|$ is less than or equal to $2$ times the estimated standard error.\n\nNumerical model details and requirements:\n- Use $L = 3$ for reflecting boundaries. If after a time step $s$ crosses $\\pm L$, reflect it back into the domain.\n- Use the last half of the simulated samples for analysis (i.e., discard the first half as burn-in). Use block averaging with $M = 10$ blocks on this analysis segment.\n- Energies must be handled in units of $k_{\\mathrm{B}}T$; report all computed free energies and differences in units of $k_{\\mathrm{B}}T$, as dimensionless floating-point numbers.\n- Angles do not appear; there is no angle unit to specify.\n- Randomness: use the provided integer seeds for reproducibility.\n\nTest suite:\nImplement your program to run the following $3$ test cases, each specified as a tuple $(\\text{seed}, N_{\\text{steps}}, dt, w_0, \\sigma, n_{\\mathrm{stride}})$:\n- Case $1$: $(1234, 20000, 0.002, 0.05, 0.20, 50)$\n- Case $2$: $(5678, 20000, 0.002, 0.02, 0.25, 25)$\n- Case $3$: $(91011, 20000, 0.002, 0.10, 0.15, 100)$\n\nOutput specification:\n- For each test case, compute a boolean indicating whether the verification criterion is satisfied for that case.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test cases, for example: \"[True,False,True]\".", "solution": "The problem statement has been validated and is determined to be a well-posed, scientifically grounded problem in computational statistical mechanics. It requests the implementation and verification of a simplified metadynamics simulation to recover the free energy difference between two basins of a model potential.\n\nThe solution is constructed in a step-by-step manner following established principles of statistical mechanics and numerical simulation.\n\n**1. Reference Free Energy Difference ($\\Delta G_{\\mathrm{ref}}$)**\n\nThe unbiased system is described by a one-dimensional free energy profile $F(s) = a s^4 - b s^2 + c s$, with parameters $a=1$, $b=3$, and $c=0.5$. All energies are in units of $k_{\\mathrm{B}}T$, so the inverse temperature $\\beta = (k_{\\mathrm{B}}T)^{-1}$ is set to $1$.\n\nThe system is partitioned into two basins: $A = \\{ s \\, | \\, s  0 \\}$ and $B = \\{ s \\, | \\, s \\ge 0 \\}$. The equilibrium probability of finding the system in a state $s$ is given by the Boltzmann distribution, $p(s) \\propto \\exp(-\\beta F(s))$. The free energy of a basin $X \\in \\{A, B\\}$ is related to its restricted partition function $Z_X$:\n$$\nG_X = -\\beta^{-1} \\ln Z_X \\quad \\text{where} \\quad Z_X = \\int_X \\exp(-\\beta F(s)) \\, ds\n$$\nThe free energy difference between the basins is therefore:\n$$\n\\Delta G = G_B - G_A = -\\beta^{-1} \\ln\\left(\\frac{Z_B}{Z_A}\\right)\n$$\nGiven $\\beta=1$, we need to compute the reference value $\\Delta G_{\\mathrm{ref}}$ by numerically integrating the partition functions over their respective domains:\n$$\nZ_A = \\int_{-\\infty}^{0} \\exp(-(s^4 - 3s^2 + 0.5s)) \\, ds\n$$\n$$\nZ_B = \\int_{0}^{\\infty} \\exp(-(s^4 - 3s^2 + 0.5s)) \\, ds\n$$\nThese integrals are computed using numerical quadrature, for instance, via the `scipy.integrate.quad` function. The result serves as the ground truth for verifying the simulation-based estimator.\n\n**2. Metadynamics Simulation**\n\nThe system's evolution is governed by the overdamped Langevin equation for a particle moving in a time-dependent potential $U(s,t) = F(s) + V_{\\mathrm{bias}}(s,t)$:\n$$\nds = -D \\beta \\frac{\\partial U(s,t)}{\\partial s} dt + \\sqrt{2D dt} \\, \\eta(t)\n$$\nHere, $D=1$ is the diffusion constant, $\\beta=1$, $dt$ is the integration time step, and $\\eta(t)$ is a Gaussian white noise term with zero mean and unit variance. This stochastic differential equation is discretized using the Euler-Maruyama scheme:\n$$\ns_{i+1} = s_i - \\frac{\\partial U(s_i, t_i)}{\\partial s} dt + \\sqrt{2 dt} \\, \\eta_i\n$$\nwhere $\\eta_i$ is a random number drawn from a standard normal distribution. The dynamics are confined to the interval $[-L, L]$ with $L=3$ by reflecting boundary conditions.\n\nThe bias potential $V_{\\mathrm{bias}}(s,t)$ is constructed on-the-fly. At regular time intervals, specifically at simulation steps $i$ that are multiples of $n_{\\mathrm{stride}}$, a repulsive Gaussian kernel is added to the potential, centered at the system's current position $s_i$:\n$$\nV_{\\mathrm{bias}}(s, t_i) = \\sum_{k \\cdot n_{\\mathrm{stride}}  i} w_0 \\exp\\left(-\\frac{(s - s_{k \\cdot n_{\\mathrm{stride}}})^2}{2 \\sigma^2}\\right)\n$$\nwhere $w_0$ is the Gaussian height and $\\sigma$ is its width. This procedure discourages the system from revisiting recently explored regions, thereby accelerating the exploration of the entire state space and promoting transitions over the free energy barrier separating basins $A$ and $B$.\n\n**3. Reweighting and Estimation of Free Energy Difference ($\\Delta G_{\\mathrm{est}}$)**\n\nThe metadynamics simulation generates a trajectory $\\{s_i\\}$ sampled from a time-dependent, biased probability distribution. To recover the properties of the original, unbiased system, a reweighting procedure is necessary. The unbiased probability density $p(s) \\propto \\exp(-F(s))$ can be recovered from the biased samples by correcting each sample $s_i$ (generated at time $t_i$) with a weight proportional to $\\exp(\\beta V_{\\mathrm{bias}}(s_i, t_i))$. With $\\beta=1$, the weight is $e^{V_{\\mathrm{bias}}(s_i, t_i)}$.\n\nFollowing this principle, the ratio of the unbiased partition functions $Z_B/Z_A$ can be estimated by the ratio of the sum of weights for samples falling in basin $B$ versus those in basin $A$:\n$$\n\\frac{Z_B}{Z_A} \\approx \\frac{\\sum_{i \\in \\text{analysis}, s_i \\in B} \\exp(V_{\\mathrm{bias}}(s_i, t_i))}{\\sum_{i \\in \\text{analysis}, s_i \\in A} \\exp(V_{\\mathrm{bias}}(s_i, t_i))}\n$$\nThe sum is performed over the second half of the trajectory, which is designated as the analysis segment. From this ratio, the estimator for the free energy difference is:\n$$\n\\Delta G_{\\mathrm{est}} = - \\ln\\left(\\frac{\\sum_{i, s_i \\in B} \\exp(V_{\\mathrm{bias}}(s_i, t_i))}{\\sum_{i, s_i \\in A} \\exp(V_{\\mathrm{bias}}(s_i, t_i))}\\right)\n$$\n\n**4. Statistical Error Analysis**\n\nTo estimate the statistical uncertainty of $\\Delta G_{\\mathrm{est}}$, the analysis segment of the trajectory is divided into $M=10$ non-overlapping blocks of equal length. An independent estimate of the free energy difference, $(\\Delta G)_j$, is computed for each block $j=1, \\dots, M$. The overall estimate $\\Delta G_{\\mathrm{est}}$ is the average of these block estimates. The standard error of the mean (SEM) is then calculated as:\n$$\n\\text{SEM} = \\frac{\\sigma_{\\Delta G}}{\\sqrt{M}}\n$$\nwhere $\\sigma_{\\Delta G}$ is the sample standard deviation of the block estimates $\\{(\\Delta G)_j\\}$.\n\n**5. Verification Criterion**\n\nThe numerical experiment is considered successful if the estimated free energy difference $\\Delta G_{\\mathrm{est}}$ agrees with the reference value $\\Delta G_{\\mathrm{ref}}$ within statistical error. The specific criterion for passing a test case is that the absolute difference between the estimated and reference values is no more than two times the standard error:\n$$\n|\\Delta G_{\\mathrm{est}} - \\Delta G_{\\mathrm{ref}}| \\le 2 \\times \\text{SEM}\n$$\nThis corresponds to checking if the true value falls within approximately a $95\\%$ confidence interval around the estimate.", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Runs a series of metadynamics simulations to verify free energy recovery.\n    \"\"\"\n    \n    # Define problem parameters\n    a, b, c = 1.0, 3.0, 0.5\n    L = 3.0  # Reflecting boundaries at +/- L\n    M = 10   # Number of blocks for error analysis\n\n    # --- 1. Calculate Reference Free Energy Difference ---\n    def F(s):\n        \"\"\"Unbiased free energy profile F(s).\"\"\"\n        return a * s**4 - b * s**2 + c * s\n\n    def integrand(s):\n        \"\"\"Boltzmann factor for numerical integration.\"\"\"\n        return np.exp(-F(s))\n\n    # Integrate partition functions for basins A (s0) and B (s>=0)\n    Z_A, _ = quad(integrand, -np.inf, 0)\n    Z_B, _ = quad(integrand, 0, np.inf)\n\n    # Reference free energy difference (beta=1)\n    delta_G_ref = -np.log(Z_B / Z_A)\n\n    # Test cases from the problem statement\n    test_cases = [\n        (1234, 20000, 0.002, 0.05, 0.20, 50),\n        (5678, 20000, 0.002, 0.02, 0.25, 25),\n        (91011, 20000, 0.002, 0.10, 0.15, 100),\n    ]\n\n    results = []\n    for case in test_cases:\n        seed, N_steps, dt, w0, sigma, n_stride = case\n        \n        np.random.seed(seed)\n\n        # --- 2. Run Metadynamics Simulation ---\n        # Start at one of the potential minima\n        s = -1.266 \n        \n        traj = np.zeros(N_steps)\n        dep_centers = []\n\n        for i in range(N_steps):\n            traj[i] = s\n\n            # Deposit a Gaussian at the start of the step, if applicable\n            if i > 0 and i % n_stride == 0:\n                dep_centers.append(s)\n\n            # --- Calculate forces ---\n            # Force from the static potential F(s)\n            force_F = -(4 * a * s**3 - 2 * b * s + c)\n            \n            # Force from the time-dependent bias potential V_bias(s,t)\n            force_V = 0.0\n            if dep_centers:\n                centers_arr = np.array(dep_centers)\n                diff = s - centers_arr\n                exp_term = np.exp(-diff**2 / (2 * sigma**2))\n                force_V = np.sum(w0 * exp_term * diff / sigma**2)\n\n            total_force = force_F + force_V\n            \n            # --- Evolve position using Euler-Maruyama ---\n            s += total_force * dt + np.sqrt(2 * dt) * np.random.randn()\n\n            # --- Apply reflecting boundaries ---\n            # Using a while loop is safer for large steps, though unlikely here\n            while s > L or s  -L:\n                if s > L:\n                    s = 2 * L - s\n                if s  -L:\n                    s = -2 * L - s\n        \n        # --- 3. Reweighting and Analysis ---\n        analysis_start_idx = N_steps // 2\n        analysis_traj = traj[analysis_start_idx:]\n        \n        block_size = len(analysis_traj) // M\n        delta_G_blocks = []\n\n        for j in range(M):\n            block_start = j * block_size\n            block_end = (j + 1) * block_size\n            \n            sum_weights_A, sum_weights_B = 0.0, 0.0\n            \n            for k in range(block_start, block_end):\n                s_k = analysis_traj[k]\n                global_step_idx = analysis_start_idx + k\n                \n                # V_bias(s_k, t_k) includes only Gaussians deposited *before* step k\n                num_gauss_before = (global_step_idx - 1) // n_stride if global_step_idx > 0 else 0\n                centers_to_use = dep_centers[:num_gauss_before]\n\n                v_bias_k = 0.0\n                if centers_to_use:\n                    centers_arr = np.array(centers_to_use)\n                    diff_sq = (s_k - centers_arr)**2\n                    v_bias_k = np.sum(w0 * np.exp(-diff_sq / (2 * sigma**2)))\n                \n                weight_k = np.exp(v_bias_k)\n                \n                if s_k  0:\n                    sum_weights_A += weight_k\n                else:\n                    sum_weights_B += weight_k\n\n            # Avoid division by zero or log of zero if a basin was not sampled\n            if sum_weights_A > 1e-12 and sum_weights_B > 1e-12:\n                ratio = sum_weights_B / sum_weights_A\n                delta_G_blocks.append(-np.log(ratio))\n\n        if len(delta_G_blocks)  2: # Need at least 2 blocks to calculate std dev\n             results.append(False)\n             continue\n        \n        # --- 4. Calculate Final Estimate and Error ---\n        delta_G_est = np.mean(delta_G_blocks)\n        std_err = np.std(delta_G_blocks, ddof=1) / np.sqrt(len(delta_G_blocks))\n\n        # --- 5. Verify against Reference ---\n        passed = abs(delta_G_est - delta_G_ref) = 2 * std_err\n        results.append(passed)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == '__main__':\n    solve()\n```", "id": "2655481"}, {"introduction": "Real-world collective variables often possess specific geometric or topological properties that require careful handling. This practice focuses on one of the most common cases: periodic CVs, such as dihedral angles, which are defined on a circular domain like $[-\\pi, \\pi]$ [@problem_id:2655418]. Naively applying a standard Gaussian kernel can create artificial energy barriers at the periodic boundary, corrupting the simulation. This exercise challenges you to identify the mathematically correct formulations that employ the minimal-image convention, ensuring the bias potential is smooth and consistent with the circular topology of the CV.", "problem": "A molecular system is biased by metadynamics along a one-dimensional collective variable (CV) defined as a dihedral angle. The CV takes values on the circle, which we parameterize as angles $s \\in (-\\pi, \\pi]$ with fundamental period $L = 2\\pi$. In metadynamics, each deposited hill contributes a kernel centered at the visited CV value, typically taken as a Gaussian of height $w$ and width parameter $\\sigma$ that depends only on the distance between the instantaneous CV value $s$ and the hill center $s_0$. On an unbounded line, a natural choice would be the Euclidean difference $s - s_0$, but on a periodic domain the relevant distance is the geodesic distance on the circle. If the distance function is not chosen consistently with the topology, the accumulated bias can exhibit artificial barriers near the angular boundary $s = \\pm \\pi$.\n\nAssume the goal is to define a single-hill contribution $V(s \\mid s_0)$ that is $2\\pi$-periodic in $s$, continuous, and avoids artificial barriers at the boundary $s = \\pm \\pi$ by employing the minimal-image convention appropriate for a circle. Consider the following candidate prescriptions for depositing a Gaussian hill of height $w$ and width $\\sigma$ at $s_0$:\n\nA. $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{(s - s_0)^2}{2\\sigma^2}\\right)$.\n\nB. Define the minimal-image angular difference $\\Delta_p = (s - s_0) - 2\\pi \\,\\mathrm{round}\\!\\left(\\dfrac{s - s_0}{2\\pi}\\right)$, and set $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{\\Delta_p^2}{2\\sigma^2}\\right)$, where $\\mathrm{round}(\\cdot)$ denotes nearest-integer rounding.\n\nC. Define $\\Delta_p = \\mathrm{atan2}\\!\\big(\\sin(s - s_0), \\cos(s - s_0)\\big)$, and set $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{\\Delta_p^2}{2\\sigma^2}\\right)$, where $\\mathrm{atan2}(y,x)$ is the two-argument arctangent returning an angle in $(-\\pi, \\pi]$.\n\nD. $V(s \\mid s_0) = w \\displaystyle\\sum_{k=-\\infty}^{\\infty} \\exp\\!\\left(-\\dfrac{(s - s_0 + 2\\pi k)^2}{2\\sigma^2}\\right)$.\n\nE. Let $\\Delta_m = \\mathrm{mod}(s - s_0, 2\\pi)$, the remainder in $[0, 2\\pi)$, and set $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{\\Delta_m^2}{2\\sigma^2}\\right)$.\n\nF. Embed the circle as $\\mathbf{r}(s) = (\\cos s, \\sin s)$ and set $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{\\|\\mathbf{r}(s) - \\mathbf{r}(s_0)\\|^2}{2\\sigma^2}\\right)$.\n\nWhich option(s) correctly implement Gaussian hill deposition on the periodic CV by using the minimal-image convention to avoid artificial barriers at the boundary for arbitrary $s$ and $s_0$? Select all that apply.\n\nFor concreteness, you may also test your reasoning by considering $w = 1$, $\\sigma = 0.05$, $s_0 = \\pi - \\delta$, $s = -\\pi + \\delta$, with $\\delta = 2^\\circ = \\pi/90$, and ask whether the prescription assigns a large contribution corresponding to the small geodesic separation $2\\delta$ rather than the large Euclidean difference. However, your selection should be based on the general validity of the prescription, not only on this numerical example.\n\nChoices:\nA. As written above.\nB. As written above.\nC. As written above.\nD. As written above.\nE. As written above.\nF. As written above.", "solution": "The problem statement must first be validated for scientific and logical integrity.\n\n### Step 1: Extract Givens\n-   **System**: A molecular system with a one-dimensional collective variable (CV), $s$.\n-   **CV Space**: The CV is a dihedral angle, which is a periodic variable on a circle. The space is parameterized as $s \\in (-\\pi, \\pi]$ with period $L = 2\\pi$.\n-   **Method**: Metadynamics, which biases the system by adding repulsive kernels (\"hills\").\n-   **Hill Properties**: Each hill is a Gaussian kernel of height $w$ and width parameter $\\sigma$. The kernel's value depends on the distance between the current CV position $s$ and the hill's center $s_0$.\n-   **Core Requirement**: The distance function must be the geodesic distance on the circle (shortest arc length) to ensure the accumulated bias potential is periodic and continuous, avoiding artificial barriers at the periodic boundary $s = \\pm \\pi$. This is referred to as the \"minimal-image convention\".\n-   **Objective**: Identify which of the proposed mathematical formulas, $V(s \\mid s_0)$, correctly implements a single Gaussian hill deposition on the periodic CV using the minimal-image convention.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientific Grounding**: The problem is well-grounded in the theory and practice of computational chemistry and physics. Metadynamics is a standard enhanced sampling technique, and the correct handling of periodic CVs is a critical and non-trivial implementation detail. The concepts of geodesic distance and the minimal-image convention are standard in this context. The problem is chemically and mathematically sound.\n-   **Well-Posedness**: The problem is well-posed. It asks to evaluate several explicit mathematical formulations against a clear set of physical and mathematical criteria (periodicity, continuity, use of geodesic distance, Gaussian form). A definite set of correct options can be determined.\n-   **Objectivity**: The problem is stated using precise mathematical language and definitions. There is no ambiguity or subjectivity.\n\n### Step 3: Verdict and Action\nThe problem statement is valid. It is a standard, well-defined problem in the implementation of molecular simulation methods. I will now proceed with a detailed derivation and evaluation of each option.\n\n### Principle-Based Derivation\nThe fundamental task is to define a Gaussian function on a circle. A Gaussian function has the form $f(x) \\propto \\exp(-d(x, x_c)^2 / (2\\sigma^2))$, where $d(x, x_c)$ is the distance from a point $x$ to the center $x_c$. For a circle of circumference $L=2\\pi$, the distance between two points with angular coordinates $s$ and $s_0$ is the geodesic distance, i.e., the length of the shorter arc connecting them.\n\nLet the difference in angle be $\\Delta = s - s_0$. The set of all angular differences equivalent to $\\Delta$ under the periodic boundary condition is $\\{\\Delta + 2\\pi k\\}$ for all integers $k$. The minimal-image convention requires us to find the specific representation of this difference that has the smallest magnitude. This is the signed shortest arc length, which we denote $\\Delta_p$.\n$$\n\\Delta_p = \\arg\\min_{\\Delta' \\in \\{\\Delta + 2\\pi k \\mid k \\in \\mathbb{Z}\\}} |\\Delta'|\n$$\nThis minimal signed distance $\\Delta_p$ must lie in the interval $(-\\pi, \\pi]$. The squared geodesic distance is then $\\Delta_p^2$. A correctly formulated periodic Gaussian hill should be of the form:\n$$\nV(s \\mid s_0) = w \\exp\\left(-\\frac{\\Delta_p^2}{2\\sigma^2}\\right)\n$$\nWe must now evaluate which of the proposed options correctly calculates $\\Delta_p$ and uses it in this form.\n\n### Option-by-Option Analysis\n\n**A. $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{(s - s_0)^2}{2\\sigma^2}\\right)$.**\nThis formula uses the standard Euclidean distance on the real line, $s-s_0$. This function is not periodic in $s$ with period $2\\pi$. For example, $V(s+2\\pi \\mid s_0) \\neq V(s \\mid s_0)$. It fails to recognize that $s = -\\pi + \\delta$ and $s' = \\pi - \\delta$ are close on the circle. If $s_0 = \\pi-\\delta$, the distance to $s=-\\pi+\\delta$ is computed as $|(-\\pi+\\delta) - (\\pi-\\delta)| = |-2\\pi+2\\delta| \\approx 2\\pi$, a large distance, leading to a vanishing potential contribution. This creates an artificial barrier at the $s=\\pm\\pi$ boundary.\n**Verdict: Incorrect.**\n\n**B. Define the minimal-image angular difference $\\Delta_p = (s - s_0) - 2\\pi \\,\\mathrm{round}\\!\\left(\\dfrac{s - s_0}{2\\pi}\\right)$, and set $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{\\Delta_p^2}{2\\sigma^2}\\right)$, where $\\mathrm{round}(\\cdot)$ denotes nearest-integer rounding.**\nThis prescription defines $\\Delta_p$ by subtracting the multiple of $2\\pi$ that is closest to the original difference $s-s_0$. This operation maps any real number into the interval $[-\\pi, \\pi]$. This is the correct mathematical definition of the signed minimal-image distance on a circle of circumference $2\\pi$. The resulting potential $V(s \\mid s_0)$ is therefore a Gaussian function of the correct geodesic distance, satisfying all requirements.\n**Verdict: Correct.**\n\n**C. Define $\\Delta_p = \\mathrm{atan2}\\!\\big(\\sin(s - s_0), \\cos(s - s_0)\\big)$, and set $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{\\Delta_p^2}{2\\sigma^2}\\right)$, where $\\mathrm{atan2}(y,x)$ is the two-argument arctangent returning an angle in $(-\\pi, \\pi]$.**\nThe function $\\mathrm{atan2}(y,x)$ computes the principal value of the angle formed by the vector $(x,y)$ with the positive x-axis. For an angle $\\phi = s-s_0$, the vector $(\\cos(\\phi), \\sin(\\phi))$ points in the direction $\\phi$ on the unit circle. The $\\mathrm{atan2}$ function correctly recovers this angle, wrapped into the standard interval $(-\\pi, \\pi]$. This procedure is therefore mathematically equivalent to the one in option B and is a common, numerically robust way to compute the signed minimal-image distance $\\Delta_p$. The potential is correctly formulated.\n**Verdict: Correct.**\n\n**D. $V(s \\mid s_0) = w \\displaystyle\\sum_{k=-\\infty}^{\\infty} \\exp\\!\\left(-\\dfrac{(s - s_0 + 2\\pi k)^2}{2\\sigma^2}\\right)$.**\nThis expression constructs a periodic function by summing a Gaussian kernel over all its periodic images. This is the \"sum over images\" or \"periodization\" method. While this correctly produces a smooth, $2\\pi$-periodic function that avoids boundary artifacts, it does not strictly adhere to the problem's stated methodology. The problem specifies \"employing the minimal-image convention,\" which typically refers to an explicit calculation of the shortest distance, as in options B and C. The sum-over-images is a different (though related) convention. Furthermore, the resulting function is a sum of Gaussians, which is not, in the strictest sense, a single Gaussian function of the geodesic distance, i.e., its logarithm is not a quadratic function of $\\Delta_p$. For uncompromising correctness, these distinctions matter.\n**Verdict: Incorrect.**\n\n**E. Let $\\Delta_m = \\mathrm{mod}(s - s_0, 2\\pi)$, the remainder in $[0, 2\\pi)$, and set $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{\\Delta_m^2}{2\\sigma^2}\\right)$.**\nThe modulo operator, as defined to return a value in $[0, 2\\pi)$, does not compute the shortest distance. For example, if $s_0=0$ and $s = -\\epsilon$ (where $\\epsilon  0$ is small), the true geodesic distance is $\\epsilon$. However, this formula computes $\\Delta_m = \\mathrm{mod}(-\\epsilon, 2\\pi) = 2\\pi-\\epsilon$, a large distance. The function $\\Delta_m(s)$ has a jump discontinuity as $s-s_0$ passes through integer multiples of $2\\pi$, which translates into a \"cliff\" in the potential energy surface. This is a classic error in implementing periodic boundaries.\n**Verdict: Incorrect.**\n\n**F. Embed the circle as $\\mathbf{r}(s) = (\\cos s, \\sin s)$ and set $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{\\|\\mathbf{r}(s) - \\mathbf{r}(s_0)\\|^2}{2\\sigma^2}\\right)$.**\nThis method uses the squared Euclidean distance between points on the unit circle in a 2D embedding space (the squared chord length). Let us calculate this distance: $\\|\\mathbf{r}(s) - \\mathbf{r}(s_0)\\|^2 = (\\cos s - \\cos s_0)^2 + (\\sin s - \\sin s_0)^2 = 2 - 2\\cos(s - s_0)$. The potential becomes $V(s \\mid s_0) = w \\exp(-\\frac{2(1 - \\cos(s - s_0))}{2\\sigma^2})$. The geodesic distance is $\\Delta_p$, while the chord length is related to $\\sin(\\Delta_p/2)$. This potential is a function of $\\cos(\\Delta_p)$, known as a von Mises kernel. It is not a Gaussian kernel, which must be a function of $\\Delta_p^2$. While this is a valid periodic kernel that solves the boundary problem, it does not have the specified Gaussian functional form with respect to the geodesic distance.\n**Verdict: Incorrect.**", "answer": "$$\\boxed{BC}$$", "id": "2655418"}, {"introduction": "A successful metadynamics simulation requires more than just correct implementation; it demands a wise choice of collective variables that capture all relevant slow motions of the system. This final practice moves from implementation to interpretation, a critical skill for any computational scientist [@problem_id:2455413]. You will analyze a common artifact observed in a two-dimensional free energy surface—persistent \"stripes\"—and diagnose the underlying issue with the CV selection. This exercise teaches you how to use the output of a simulation as a diagnostic tool to identify hidden slow variables and refine your model.", "problem": "You run a $2$-dimensional well-tempered metadynamics simulation on a molecular system with metastable states, biasing two collective variables (CVs), $s_1$ and $s_2$, where a collective variable (CV) is a function $s(\\mathbf{R})$ of the atomic coordinates $\\mathbf{R}$ intended to parametrize slow modes. The bias potential $V(\\mathbf{s}, t)$ is constructed by depositing Gaussian hills in the visited CV space $\\mathbf{s} = (s_1, s_2)$ at fixed time intervals, and the free energy surface (FES) $F(s_1, s_2)$ is reconstructed from the accumulated bias in the long-time limit. After extensive simulation, the reconstructed $2$-dimensional FES shows persistent narrow bands that appear as “stripes” parallel to the $s_1$-axis across a wide range of $s_1$ values, while varying primarily with $s_2$. All algorithmic parameters such as Gaussian height $w$, width $\\boldsymbol{\\sigma}$, and deposition stride are chosen within commonly accepted ranges and held fixed throughout. Which statement best describes what this artifact indicates about the choice of CVs?\n\nA. At least one of $s_1$ or $s_2$ does not couple to the relevant slow degrees of freedom, so the effective free energy is essentially $1$-dimensional in the other CV; a missing slow coordinate is not captured by the chosen CV pair.\n\nB. The Gaussian hill height $w$ is too large, leading to overfilling and artificial banding; the CVs are appropriate, but the bias amplitude alone caused the stripes.\n\nC. The two CVs $s_1$ and $s_2$ are strongly correlated; the stripes arise from redundant information and would disappear if orthogonalized without changing which physical coordinates are biased.\n\nD. The simulation is too short; with sufficiently long time the stripes will inevitably vanish even if the CVs are unchanged, because metadynamics guarantees uniform filling in CV space regardless of CV quality.", "solution": "The problem statement shall be validated before any attempt at a solution.\n\n### Step 1: Extract Givens\n- Simulation technique: $2$-dimensional well-tempered metadynamics.\n- System description: A molecular system with metastable states.\n- Biased variables: Two collective variables (CVs), denoted as $s_1$ and $s_2$.\n- Definition of a CV: A function $s(\\mathbf{R})$ of atomic coordinates $\\mathbf{R}$ intended to parametrize slow modes.\n- Bias potential: $V(\\mathbf{s}, t)$ is built from Gaussian hills in the CV space $\\mathbf{s} = (s_1, s_2)$.\n- Free Energy Surface (FES): $F(s_1, s_2)$ is reconstructed from the accumulated bias in the long-time limit.\n- Key observation: The reconstructed $2$-dimensional FES exhibits \"persistent narrow bands that appear as ‘stripes’ parallel to the $s_1$-axis across a wide range of $s_1$ values, while varying primarily with $s_2$\".\n- Algorithmic parameters: Gaussian height $w$, width $\\boldsymbol{\\sigma}$, and deposition stride are within standard ranges and are constant.\n\n### Step 2: Validate Using Extracted Givens\nThe problem describes a common scenario in computational chemistry utilizing the well-tempered metadynamics method. The terminology—collective variable, free energy surface, metastable states, Gaussian hills—is standard and used correctly. The observed artifact, \"stripes\" on the reconstructed FES, is a well-documented phenomenon whose interpretation is a standard exercise in understanding the limitations of enhanced sampling methods.\n\n1.  **Scientific or Factual Unsoundness**: The problem is scientifically and factually sound. It is based on the established principles of statistical mechanics and the theory of metadynamics.\n2.  **Non-Formalizable or Irrelevant**: The problem is highly relevant to its stated field (computational chemistry, enhanced sampling) and is readily formalizable within that context.\n3.  **Incomplete or Contradictory Setup**: The problem provides sufficient information to diagnose the underlying issue without internal contradiction. The description of the artifact is clear and points towards a specific class of problems in CV selection.\n4.  **Unrealistic or Infeasible**: The scenario is realistic and frequently encountered in practice.\n5.  **Ill-Posed or Poorly Structured**: The problem is well-posed, with clear terms and a question that admits a definite, well-reasoned answer based on the provided information.\n6.  **Outside Scientific Verifiability**: The claims and the expected answer are verifiable through theoretical analysis and computational experiment.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid**. A solution will be derived.\n\n### Principle-Based Derivation\nThe objective of a metadynamics simulation is to reconstruct the free energy surface (FES), $F(\\mathbf{s})$, as a function of a set of collective variables (CVs), $\\mathbf{s}$. The FES is related to the equilibrium probability distribution of the CVs, $\\Pi(\\mathbf{s})$, via the fundamental relation from statistical mechanics:\n$$F(\\mathbf{s}) = -k_B T \\ln \\Pi(\\mathbf{s}) + C$$\nwhere $k_B$ is the Boltzmann constant, $T$ is the temperature, and $C$ is an arbitrary constant.\n\nMetadynamics achieves this by adding a history-dependent bias potential, $V(\\mathbf{s}, t)$, to the system's potential energy. In the ideal long-time limit, and provided the CVs $\\mathbf{s}$ capture all relevant slow degrees of freedom, the accumulated bias potential converges to the negative of the FES:\n$$V(\\mathbf{s}, t \\to \\infty) \\approx -F(\\mathbf{s}) + C'$$\n\nThe problem states that the reconstructed FES, $F(s_1, s_2)$, exhibits \"stripes\" parallel to the $s_1$-axis. This is a precise description meaning that the reconstructed free energy is approximately constant along the $s_1$ coordinate for any given value of $s_2$. Mathematically, this implies $\\frac{\\partial F}{\\partial s_1} \\approx 0$ over extended regions. The FES is effectively a $1$-dimensional function of $s_2$ alone: $F(s_1, s_2) \\approx f(s_2)$.\n\nThis observation has a direct physical meaning. A flat free energy profile along a coordinate implies that motion along that coordinate is not restricted by a significant energy barrier. Such motion is fast. If $s_1$ were a proper slow coordinate (a \"reaction coordinate\"), we would expect to see significant free energy barriers along it, corresponding to the slow transitions between metastable states. The absence of such features indicates that $s_1$ is not coupled to any slow process; it is a fast degree of freedom. On the timescale of metadynamics depositions, the system averages over the $s_1$ coordinate so rapidly that the bias potential fills its entire range almost uniformly, leading to a flat reconstructed profile.\n\nThe variation along $s_2$ indicates that $s_2$ is at least partially coupled to a slow process, which is why metadynamics is able to resolve a non-trivial profile in that direction. However, the persistence of the striped artifact points to a more profound issue. Metadynamics convergence relies on the assumption of ergodicity in the space of the un-biased degrees of freedom, conditional on the value of the CVs. If there is another slow coordinate, let us call it $s_3$, which is not included in the biased set $\\{s_1, s_2\\}$, the system can become kinetically trapped in a potential well defined by this hidden variable $s_3$. The simulation will then sample only a sub-region of the total phase space. The metadynamics bias will fill the FES *projected* onto the $(s_1, s_2)$ plane *within that trapped region*. If the system eventually, by a rare thermal fluctuation, crosses the barrier along the un-biased $s_3$ coordinate, it will jump to a new region of phase space. In this new region, the metadynamics process will start again. The reconstructed FES will be a superposition of these disconnected explorations, which often manifests as distinct bands or stripes.\n\nTherefore, the observed artifact indicates two things:\n1. The CV $s_1$ is a poor choice, likely a fast, irrelevant variable.\n2. A critical slow degree of freedom, necessary to distinguish between all relevant metastable states, is missing from the chosen set of CVs.\n\n### Option-by-Option Analysis\n\n**A. At least one of $s_1$ or $s_2$ does not couple to the relevant slow degrees of freedom, so the effective free energy is essentially $1$-dimensional in the other CV; a missing slow coordinate is not captured by the chosen CV pair.**\n- **Analysis**: This statement correctly identifies both key issues. The flatness of the FES along the $s_1$ direction indicates that $s_1$ is not coupled to a slow process, making the FES effectively $1$-dimensional in $s_2$. The persistence of this striped structure is the classic symptom of non-ergodicity arising from a missing slow coordinate that is not being biased. This option provides the most complete and accurate diagnosis.\n- **Verdict**: **Correct**.\n\n**B. The Gaussian hill height $w$ is too large, leading to overfilling and artificial banding; the CVs are appropriate, but the bias amplitude alone caused the stripes.**\n- **Analysis**: An excessively large Gaussian height $w$ (or equivalently, a large bias factor in well-tempered metadynamics) leads to a different class of artifacts. It causes the bias to be added too aggressively, often preventing convergence and resulting in large, noisy fluctuations or \"over-filling\" of wells. However, it does not typically produce a highly structured, persistent pattern of stripes aligned with a CV axis. Such a specific, directional artifact is characteristic of a fundamental problem with the CVs themselves, not just a matter of parameter tuning. The problem statement also notes that parameters are within reasonable ranges.\n- **Verdict**: **Incorrect**.\n\n**C. The two CVs $s_1$ and $s_2$ are strongly correlated; the stripes arise from redundant information and would disappear if orthogonalized without changing which physical coordinates are biased.**\n- **Analysis**: If $s_1$ and $s_2$ were strongly correlated, the system's trajectory in the $(s_1, s_2)$ plane would be confined to a narrow, often diagonal, region. The reconstructed FES would show a low-energy pathway along this diagonal, not stripes spanning a wide range of $s_1$ parallel to its axis. The observation that stripes appear \"across a wide range of $s_1$ values\" directly contradicts the premise of strong correlation, which would restrict the explored range.\n- **Verdict**: **Incorrect**.\n\n**D. The simulation is too short; with sufficiently long time the stripes will inevitably vanish even if the CVs are unchanged, because metadynamics guarantees uniform filling in CV space regardless of CV quality.**\n- **Analysis**: This statement is fundamentally flawed. The convergence guarantee of metadynamics is conditional upon the CVs encompassing all relevant slow degrees of freedom for the process under study. If a slow coordinate is missing, the system is not ergodic in the full phase space on any practical simulation timescale. The simulation becomes trapped in regions defined by the state of the un-biased slow coordinate. The stripes are a direct consequence of this lack of ergodicity and are described as \"persistent,\" meaning they will *not* disappear with longer simulation times. The premise that metadynamics works \"regardless of CV quality\" is false.\n- **Verdict**: **Incorrect**.", "answer": "$$\\boxed{A}$$", "id": "2455413"}]}