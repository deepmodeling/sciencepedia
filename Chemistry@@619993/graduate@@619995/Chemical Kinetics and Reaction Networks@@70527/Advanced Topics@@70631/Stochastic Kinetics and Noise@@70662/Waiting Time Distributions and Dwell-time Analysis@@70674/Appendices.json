{"hands_on_practices": [{"introduction": "We begin our hands-on exploration by deriving the waiting-time distribution from first principles. This foundational exercise [@problem_id:2694227] demonstrates how the assumption of constant reaction hazards, or propensities, naturally leads to an exponential waiting time until the next chemical event. By analyzing a system with multiple competing reaction channels, you will also derive the rule for determining which reaction occurs next, a cornerstone of stochastic simulation algorithms.", "problem": "In a well-mixed isothermal reactor at constant volume, consider a single-molecule kinetic subsystem with three reaction channels whose propensities are time-independent over the time interval of interest. Let the propensities be $a_1=2$, $a_2=3$, and $a_3=5$, each in units of $\\mathrm{s}^{-1}$. Assume the Chemical Master Equation (CME) description applies and that propensities represent instantaneous hazards for the corresponding channels. Starting from first principles for competing exponential hazards, derive the waiting-time distribution for the next reaction event and the probability that each channel fires first. Explicitly: from the infinitesimal definition that the probability that channel $i$ fires in $[t,t+\\mathrm{d}t)$, conditioned on no prior event, is $a_i\\,\\mathrm{d}t+o(\\mathrm{d}t)$, derive the survival function, the probability density function of the waiting time $T$, and the next-reaction channel probabilities. \n\nUse time in seconds. Provide the analytic expression for the probability density function $f_T(t)$ for $t \\ge 0$ and the probabilities $p_1$, $p_2$, and $p_3$ that channels $1$, $2$, and $3$ are the next event, respectively. Give exact expressions; no rounding is required. \n\nReport your final answer as a row matrix $\\big(f_T(t),\\,p_1,\\,p_2,\\,p_3\\big)$.", "solution": "The problem as stated is scientifically grounded, well-posed, objective, and contains all necessary information for a unique and meaningful solution. It is a standard problem in the theory of stochastic chemical kinetics, specifically relating to the Gillespie algorithm's foundation. The problem is valid. We will proceed with the derivation from first principles.\n\nLet $T$ be the random variable representing the waiting time until the next reaction event. We are given three independent competing reaction channels, indexed by $i \\in \\{1, 2, 3\\}$. The propensity for each channel, $a_i$, represents the instantaneous hazard rate for that reaction. The probability that channel $i$ fires in the infinitesimal time interval $[t, t+\\mathrm{d}t)$, given that no reaction has occurred before time $t$, is given as $a_i\\,\\mathrm{d}t + o(\\mathrm{d}t)$.\n\nThe total propensity for *any* reaction to occur is the sum of the individual propensities, as the channels represent mutually exclusive events for the first reaction. Let $a_0$ be the total propensity:\n$$a_0 = \\sum_{i=1}^{3} a_i$$\nThe probability that *any* reaction occurs in $[t, t+\\mathrm{d}t)$, conditioned on survival until time $t$, is thus $a_0\\,\\mathrm{d}t + o(\\mathrm{d}t)$.\n\nFirst, we derive the survival function, $S(t) = P(T > t)$, which is the probability that no reaction has occurred by time $t$. The probability of surviving past time $t+\\mathrm{d}t$ is the probability of surviving past time $t$ multiplied by the probability of no event occurring in the interval $[t, t+\\mathrm{d}t)$.\n$$S(t + \\mathrm{d}t) = S(t) \\times P(\\text{no event in } [t, t+\\mathrm{d}t) | T > t)$$\nThe probability of an event occurring in $[t, t+\\mathrm{d}t)$ is $a_0\\,\\mathrm{d}t$, so the probability of no event is $1 - a_0\\,\\mathrm{d}t$. We ignore higher-order terms $o(\\mathrm{d}t)$.\n$$S(t + \\mathrm{d}t) = S(t) (1 - a_0\\,\\mathrm{d}t)$$\nRearranging this expression gives the differential form:\n$$\\frac{S(t + \\mathrm{d}t) - S(t)}{\\mathrm{d}t} = -a_0 S(t)$$\nTaking the limit as $\\mathrm{d}t \\to 0$, we obtain a first-order ordinary differential equation for $S(t)$:\n$$\\frac{\\mathrm{d}S(t)}{\\mathrm{d}t} = -a_0 S(t)$$\nThe initial condition is that survival at time $t=0$ is certain, so $S(0) = 1$. The solution to this differential equation is:\n$$S(t) = \\exp(-a_0 t)$$\n\nNext, we derive the probability density function (PDF) of the waiting time, $f_T(t)$. The PDF is related to the cumulative distribution function (CDF), $F_T(t) = P(T \\le t)$, by $f_T(t) = \\frac{\\mathrm{d}F_T(t)}{\\mathrm{d}t}$. The CDF is related to the survival function by $F_T(t) = 1 - S(t)$. Therefore:\n$$f_T(t) = \\frac{\\mathrm{d}}{\\mathrm{d}t} (1 - S(t)) = -\\frac{\\mathrm{d}S(t)}{\\mathrm{d}t}$$\nSubstituting the expression for $S(t)$:\n$$f_T(t) = -\\frac{\\mathrm{d}}{\\mathrm{d}t} (\\exp(-a_0 t)) = -(-a_0 \\exp(-a_0 t)) = a_0 \\exp(-a_0 t)$$\nThis is the PDF of an exponential distribution with rate parameter $a_0$.\nUsing the given propensities:\n$a_1 = 2 \\, \\mathrm{s}^{-1}$\n$a_2 = 3 \\, \\mathrm{s}^{-1}$\n$a_3 = 5 \\, \\mathrm{s}^{-1}$\nThe total propensity is:\n$$a_0 = a_1 + a_2 + a_3 = 2 + 3 + 5 = 10 \\, \\mathrm{s}^{-1}$$\nThus, the PDF for the waiting time $T$ is:\n$$f_T(t) = 10 \\exp(-10 t) \\quad \\text{for } t \\ge 0$$\n\nFinally, we derive the probability, $p_i$, that channel $i$ is the specific channel that fires. This is the probability that reaction $i$ \"wins the race\". The joint probability that channel $i$ fires in the interval $[t, t+\\mathrm{d}t)$ and is the first event to do so is the product of the probability of no event until time $t$, $S(t)$, and the probability of channel $i$ firing in $[t, t+\\mathrm{d}t)$, which is $a_i\\,\\mathrm{d}t$. The probability element is therefore $S(t) a_i\\,\\mathrm{d}t = a_i \\exp(-a_0 t)\\,\\mathrm{d}t$. To find the total probability $p_i$, we integrate this over all possible waiting times $t \\in [0, \\infty)$:\n$$p_i = \\int_0^\\infty a_i \\exp(-a_0 t) \\,\\mathrm{d}t$$\nSince $a_i$ is a constant with respect to time, we can take it out of the integral:\n$$p_i = a_i \\int_0^\\infty \\exp(-a_0 t) \\,\\mathrm{d}t = a_i \\left[ -\\frac{1}{a_0} \\exp(-a_0 t) \\right]_0^\\infty$$\n$$p_i = a_i \\left( -\\frac{1}{a_0} (0) - \\left(-\\frac{1}{a_0} (1)\\right) \\right) = \\frac{a_i}{a_0}$$\nThis confirms the well-known result that for competing Poisson processes, the probability of a specific process being the first to occur is the ratio of its rate to the total rate.\nWe now compute the specific probabilities:\n$$p_1 = \\frac{a_1}{a_0} = \\frac{2}{10} = \\frac{1}{5}$$\n$$p_2 = \\frac{a_2}{a_0} = \\frac{3}{10}$$\n$$p_3 = \\frac{a_3}{a_0} = \\frac{5}{10} = \\frac{1}{2}$$\nAs a check, the sum of these probabilities must be unity: $p_1 + p_2 + p_3 = \\frac{2}{10} + \\frac{3}{10} + \\frac{5}{10} = \\frac{10}{10} = 1$, which is correct.\n\nThe required quantities are the PDF $f_T(t)$ and the probabilities $p_1$, $p_2$, and $p_3$.\n$f_T(t) = 10 \\exp(-10 t)$\n$p_1 = \\frac{1}{5}$\n$p_2 = \\frac{3}{10}$\n$p_3 = \\frac{1}{2}$", "answer": "$$\\boxed{\\begin{pmatrix} 10 \\exp(-10 t) & \\frac{1}{5} & \\frac{3}{10} & \\frac{1}{2} \\end{pmatrix}}$$", "id": "2694227"}, {"introduction": "Real chemical systems often exist in environments where conditions change over time, leading to time-dependent reaction rates. This practice [@problem_id:2694279] introduces the powerful time-change theorem, a mathematical tool that transforms a complex, inhomogeneous process into a standard, unit-rate Poisson process through a clever re-scaling of time. By inverting this time-transformation for various rate functions, you will gain practical skills for simulating and analyzing stochastic dynamics in non-stationary conditions.", "problem": "Consider a single reaction channel in a chemically realistic, time-inhomogeneous environment where the instantaneous reaction propensity (hazard) is a nonnegative function of time. The waiting (dwell) time until the next firing is modeled by an inhomogeneous Poisson process with rate (propensity) function $\\lambda(t)$. Starting from first principles, use only the definitions of hazard rate, survival function, and the cumulative intensity to justify a time reparametrization that converts the original process into a unit-rate Poisson process. Then, for specified classes of $\\lambda(t)$, determine the dwell time $t$ (in seconds) that corresponds to a given unit-rate Poisson arrival time $\\tau$ (in seconds) under this mapping. All answers must be expressed in seconds and rounded to $6$ decimal places.\n\nYour program must implement, for each test case, the following steps:\n- Construct the cumulative intensity $\\Lambda(t)$ from the specified $\\lambda(t)$.\n- For each provided value of $\\tau \\ge 0$, compute the unique $t \\ge 0$ that satisfies $\\Lambda(t) = \\tau$.\n- Return the list of $t$ values, rounded to $6$ decimals, in seconds.\n\nYour implementation must be general for the specified rate classes: for piecewise-constant and linear rates you may use analytic inversion if you derive it; for the sinusoidal rate you must perform a robust numerical inversion that is guaranteed to terminate under the stated conditions. You must not assume any pre-derived shortcut; derive what you use from base definitions.\n\nUse the following test suite. Each test case defines a rate class, its parameters, and a list of $\\tau$ values at which to compute the corresponding dwell times $t$. All physical quantities use the International System of Units: time in seconds, angular frequency in radians per second, and rate in inverse seconds.\n\n- Test case $1$ (piecewise-constant rate):\n  - $\\lambda(t) = \\begin{cases} \\ell_1, & 0 \\le t < t_c \\\\ \\ell_2, & t \\ge t_c \\end{cases}$ with $\\ell_1 = 2.0\\ \\mathrm{s}^{-1}$, $\\ell_2 = 5.0\\ \\mathrm{s}^{-1}$, $t_c = 0.7\\ \\mathrm{s}$.\n  - $\\tau$ values: $[0.0,\\ 0.5,\\ 1.4,\\ 3.0]$.\n\n- Test case $2$ (linear rate):\n  - $\\lambda(t) = a + b\\,t$ with $a = 0.8\\ \\mathrm{s}^{-1}$, $b = 1.2\\ \\mathrm{s}^{-2}$.\n  - $\\tau$ values: $[0.0,\\ 0.5,\\ 1.0,\\ 3.0]$.\n\n- Test case $3$ (sinusoidal rate with strictly positive lower bound):\n  - $\\lambda(t) = a + b \\sin(\\omega t)$ with $a = 1.5\\ \\mathrm{s}^{-1}$, $b = 0.4\\ \\mathrm{s}^{-1}$, and $\\omega = 2.0\\ \\mathrm{rad/s}$. Note that $a > |b|$ ensures $\\lambda(t) \\ge a - |b| > 0$ for all $t \\ge 0$.\n  - $\\tau$ values: $[0.0,\\ 0.5,\\ 2.0,\\ 5.0]$.\n\n- Test case $4$ (homogeneous rate as a boundary case of the linear class):\n  - $\\lambda(t) = a + b\\,t$ with $a = 4.0\\ \\mathrm{s}^{-1}$, $b = 0.0\\ \\mathrm{s}^{-2}$.\n  - $\\tau$ values: $[0.0,\\ 0.25,\\ 2.0]$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is a list of the computed dwell times (rounded to $6$ decimals) for the corresponding test case, in the same order as above. For example, an acceptable format is\n  - $[[t_{1,1},\\ t_{1,2},\\dots],[t_{2,1},\\dots],[t_{3,1},\\dots],[t_{4,1},\\dots]]$\n- All $t$ values must be in seconds. No additional text must be printed.", "solution": "The problem is valid as it is scientifically grounded in the theory of stochastic processes, specifically inhomogeneous Poisson processes, which is a standard model in chemical kinetics. The problem is well-posed, objective, and all necessary information is provided. We shall proceed with the solution.\n\nThe problem requires a justification for a time reparametrization that transforms an inhomogeneous Poisson process into a standard unit-rate Poisson process, derived from first principles. Subsequently, this reparametrization must be used to calculate physical dwell times $t$ corresponding to specified unit-rate process arrival times $\\tau$ for several classes of rate functions $\\lambda(t)$.\n\nLet $T$ be a continuous non-negative random variable representing the waiting time until a reaction event. The behavior of $T$ is characterized by its probability density function (PDF), $f(t)$, and its cumulative distribution function (CDF), $F(t) = P(T \\le t) = \\int_0^t f(s) ds$.\n\nAn equivalent and often more intuitive characterization is through the survival function, $S(t)$, and the hazard rate, $\\lambda(t)$.\nThe survival function is the probability that the event has not yet occurred by time $t$:\n$$S(t) = P(T > t) = 1 - F(t)$$\nThe hazard rate, also known as the instantaneous rate or propensity in this context, is the conditional probability density of the event occurring at time $t$, given that it has not occurred before $t$. Formally:\n$$\\lambda(t) = \\lim_{\\Delta t \\to 0} \\frac{P(t \\le T < t+\\Delta t | T \\ge t)}{\\Delta t}$$\nThis can be expressed using the PDF and survival function:\n$$\\lambda(t) = \\frac{f(t)}{S(t)}$$\nSince $f(t) = F'(t) = -S'(t)$, we can write the hazard rate as a differential equation for the survival function:\n$$\\lambda(t) = \\frac{-S'(t)}{S(t)} = -\\frac{d}{dt} \\ln S(t)$$\nTo find the survival function from the hazard rate, we integrate this expression from $0$ to $t$:\n$$\\int_0^t \\lambda(s) ds = -\\int_0^t \\frac{d}{ds} \\ln S(s) ds = -[\\ln S(s)]_0^t$$\nAssuming the process starts at $t=0$, the probability of survival at time $0$ is certain, so $S(0) = P(T > 0) = 1$, and thus $\\ln S(0) = 0$.\nWe define the cumulative intensity function, $\\Lambda(t)$, as the integral of the hazard rate:\n$$\\Lambda(t) = \\int_0^t \\lambda(s) ds$$\nSubstituting this into the integrated equation gives:\n$$\\Lambda(t) = -\\ln S(t)$$\nFrom this, we derive the survival function and the waiting time PDF in terms of the hazard rate:\n$$S(t) = e^{-\\Lambda(t)} = \\exp\\left(-\\int_0^t \\lambda(s) ds\\right)$$\n$$f(t) = -S'(t) = - \\left( -\\lambda(t) e^{-\\Lambda(t)} \\right) = \\lambda(t) e^{-\\Lambda(t)}$$\nThis confirms the fundamental relationships for a process governed by a time-dependent hazard rate.\n\nThe core of the problem is the time reparametrization, a manifestation of the Time-Change Theorem for point processes. We seek a transformation of time $t \\to \\tau$ such that the event occurrences in the $\\tau$ domain follow a standard, unit-rate Poisson process. A unit-rate Poisson process has waiting times that are exponentially distributed with a rate parameter of $1$. The CDF of such a waiting time, which we will call $\\tau_T$, is $F_{\\tau_T}(\\tau) = 1 - e^{-\\tau}$.\n\nLet us define a new time variable $\\tau$ as a function of the physical time $t$ by the cumulative intensity: $\\tau(t) = \\Lambda(t)$. We now consider the random variable $\\tau_T = \\Lambda(T)$, where $T$ is the random waiting time in the original process. We can find the CDF of $\\tau_T$ as follows:\n$$F_{\\tau_T}(\\tau) = P(\\tau_T \\le \\tau) = P(\\Lambda(T) \\le \\tau)$$\nSince the problem specifies that $\\lambda(t)$ is a nonnegative function (and for the given test cases, $\\lambda(t) > 0$ for $t \\ge 0$), the cumulative intensity $\\Lambda(t)$ is a strictly increasing function of $t$ for $t > 0$, with $\\Lambda(0)=0$. Therefore, a unique inverse function $t = \\Lambda^{-1}(\\tau)$ exists for $\\tau \\ge 0$. The inequality $\\Lambda(T) \\le \\tau$ is equivalent to $T \\le \\Lambda^{-1}(\\tau)$.\nThus, we can write the CDF of $\\tau_T$ in terms of the CDF of $T$:\n$$F_{\\tau_T}(\\tau) = P(T \\le \\Lambda^{-1}(\\tau)) = F_T(\\Lambda^{-1}(\\tau))$$\nWe know that $F_T(t) = 1 - S_T(t) = 1 - e^{-\\Lambda(t)}$. Substituting $t = \\Lambda^{-1}(\\tau)$:\n$$F_{\\tau_T}(\\tau) = 1 - e^{-\\Lambda(\\Lambda^{-1}(\\tau))} = 1 - e^{-\\tau}$$\nThis is precisely the CDF of an exponential distribution with rate $1$. This proves that the transformation $\\tau = \\Lambda(t)$ maps the inhomogeneous Poisson process in time $t$ to a standard homogeneous Poisson process with rate $1$ in the rescaled time $\\tau$.\n\nThe computational task is to invert this mapping. Given an arrival time $\\tau$ drawn from a unit-rate Poisson process, we must find the corresponding physical time $t$ by solving the equation:\n$$\\Lambda(t) = \\tau \\quad \\text{or} \\quad \\int_0^t \\lambda(s) ds = \\tau$$\n\nWe now solve this for the specified classes of $\\lambda(t)$.\n\n**Case 1: Piecewise-Constant Rate**\nThe rate function is $\\lambda(t) = \\begin{cases} \\ell_1, & 0 \\le t < t_c \\\\ \\ell_2, & t \\ge t_c \\end{cases}$.\nThe cumulative intensity $\\Lambda(t)$ is:\nFor $0 \\le t < t_c$:\n$$\\Lambda(t) = \\int_0^t \\ell_1 ds = \\ell_1 t$$\nThe value at the change point is $\\Lambda(t_c) = \\ell_1 t_c$.\nFor $t \\ge t_c$:\n$$\\Lambda(t) = \\int_0^{t_c} \\ell_1 ds + \\int_{t_c}^t \\ell_2 ds = \\ell_1 t_c + \\ell_2 (t - t_c)$$\nTo solve $\\Lambda(t) = \\tau$:\nIf $\\tau \\le \\ell_1 t_c$, the solution lies in the first interval. We solve $\\ell_1 t = \\tau$, which gives $t = \\tau / \\ell_1$.\nIf $\\tau > \\ell_1 t_c$, the solution lies in the second interval. We solve $\\ell_1 t_c + \\ell_2 (t - t_c) = \\tau$, which gives $t = t_c + (\\tau - \\ell_1 t_c) / \\ell_2$.\n\n**Case 2: Linear Rate**\nThe rate function is $\\lambda(t) = a + bt$ for $t \\ge 0$. The parameters $a \\ge 0$ and $b > -2a^2/(4\\tau_{max})$ for sufficient range of non-negativity. In the given test cases, $\\lambda(t) > 0$ for all $t \\ge 0$.\nThe cumulative intensity is:\n$$\\Lambda(t) = \\int_0^t (a + bs) ds = [as + \\frac{1}{2}bs^2]_0^t = at + \\frac{1}{2}bt^2$$\nTo solve $\\Lambda(t) = \\tau$, we solve the quadratic equation in $t$:\n$$\\frac{1}{2}bt^2 + at - \\tau = 0$$\nUsing the quadratic formula, the solutions for $t$ are $t = \\frac{-a \\pm \\sqrt{a^2 - 4(\\frac{1}{2}b)(-\\tau)}}{2(\\frac{1}{2}b)} = \\frac{-a \\pm \\sqrt{a^2 + 2b\\tau}}{b}$.\nSince time must be non-negative ($t \\ge 0$) and the given parameters ensure $a > 0$ and $b \\ge 0$, and $\\tau \\ge 0$, the term $\\sqrt{a^2 + 2b\\tau} \\ge a$. To obtain a non-negative $t$, we must select the positive root:\n$$t = \\frac{-a + \\sqrt{a^2 + 2b\\tau}}{b}$$\nIn the special case where $b=0$ (homogeneous process), the equation becomes $at = \\tau$, giving $t = \\tau/a$. This result is also obtained by taking the limit of the general solution as $b \\to 0$ via L'Hôpital's rule or Taylor expansion.\n\n**Case 3: Sinusoidal Rate**\nThe rate function is $\\lambda(t) = a + b \\sin(\\omega t)$, with the condition $a > |b|$ guaranteeing that $\\lambda(t) > 0$ for all $t$.\nThe cumulative intensity is:\n$$\\Lambda(t) = \\int_0^t (a + b \\sin(\\omega s)) ds = \\left[as - \\frac{b}{\\omega}\\cos(\\omega s)\\right]_0^t = \\left(at - \\frac{b}{\\omega}\\cos(\\omega t)\\right) - \\left(0 - \\frac{b}{\\omega}\\cos(0)\\right)$$\n$$\\Lambda(t) = at + \\frac{b}{\\omega}(1 - \\cos(\\omega t))$$\nSolving $\\Lambda(t) = \\tau$ requires finding the root of the transcendental equation:\n$$g(t) = at + \\frac{b}{\\omega}(1 - \\cos(\\omega t)) - \\tau = 0$$\nThis equation has no general analytical solution and must be solved numerically. To ensure a unique solution and guide the numerical method, we examine the derivative of $g(t)$:\n$$g'(t) = \\frac{d}{dt}\\Lambda(t) = \\lambda(t) = a + b \\sin(\\omega t)$$\nGiven the constraint $a > |b|$, we have $g'(t) > a - |b| > 0$. This means $g(t)$ is strictly monotonically increasing for all $t \\ge 0$. Together with $g(0) = -\\tau \\le 0$ and $\\lim_{t\\to\\infty} g(t) = \\infty$, this guarantees the existence of a unique non-negative root $t$ for any $\\tau \\ge 0$.\nA robust numerical root-finding method like the Brent-Dekker method (`brentq`) can be used. This method requires a bracket $[t_{low}, t_{high}]$ such that $g(t_{low})$ and $g(t_{high})$ have opposite signs. We can establish such a bracket by noting that $(a-|b|)t \\le \\Lambda(t) \\le (a+|b|)t$. To satisfy $\\Lambda(t) = \\tau$, the solution $t$ must lie in the interval $[\\frac{\\tau}{a+|b|}, \\frac{\\tau}{a-|b|}]$. This provides an excellent search bracket for $\\tau > 0$. For $\\tau=0$, the solution is trivially $t=0$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root_scalar\n\ndef solve_piecewise(params, tau):\n    \"\"\"\n    Solves Lambda(t) = tau for a piecewise-constant rate.\n    Lambda(t) = l1*t for t < tc\n    Lambda(t) = l1*tc + l2*(t-tc) for t >= tc\n    \"\"\"\n    l1, l2, tc = params['l1'], params['l2'], params['tc']\n    \n    if l1 <= 0:  # Avoid division by zero/negative if rate is not positive\n        # This case is not in the problem statement but is a safe guard.\n        if tau == 0:\n            return 0.0\n        else: # Cannot reach tau > 0 if l1=0\n            # Let's assume l1 > 0 as per problem's physical context\n            pass\n            \n    tau_c = l1 * tc\n    \n    if tau <= tau_c:\n        t = tau / l1\n    else:\n        t = tc + (tau - tau_c) / l2\n    return t\n\ndef solve_linear(params, tau):\n    \"\"\"\n    Solves Lambda(t) = tau for a linear rate.\n    Lambda(t) = a*t + 0.5*b*t^2\n    \"\"\"\n    a, b = params['a'], params['b']\n    \n    if b == 0: # Homogeneous case\n        if a > 0:\n            return tau / a\n        else: # a=0, b=0, lambda(t)=0. Cannot reach tau > 0.\n            return 0.0 if tau == 0 else np.inf\n    else: # General quadratic case\n        # We solve 0.5*b*t^2 + a*t - tau = 0\n        # The problem constraints (a>0, b>=0, tau>=0) ensure a real, non-negative root.\n        discriminant = a**2 + 2 * b * tau\n        # We need the non-negative root for t, which requires the '+' sign\n        # in the quadratic formula since sqrt(discriminant) >= a.\n        t = (-a + np.sqrt(discriminant)) / b\n        return t\n\ndef solve_sinusoidal(params, tau):\n    \"\"\"\n    Solves Lambda(t) = tau for a sinusoidal rate using numerical inversion.\n    Lambda(t) = a*t + (b/omega)*(1 - cos(omega*t))\n    \"\"\"\n    if tau == 0.0:\n        return 0.0\n\n    a, b, omega = params['a'], params['b'], params['omega']\n\n    # Define the function g(t) = Lambda(t) - tau = 0\n    def g(t):\n        return a * t + (b / omega) * (1 - np.cos(omega * t)) - tau\n\n    # The function g(t) is monotonic because its derivative g'(t) = lambda(t)\n    # is strictly positive given a > |b|.\n    # We can find a tight bracket for the root t.\n    # (a - |b|)t <= Lambda(t) <= (a + |b|)t\n    # So, tau / (a + |b|) <= t <= tau / (a - |b|)\n    t_min = tau / (a + abs(b))\n    t_max = tau / (a - abs(b))\n\n    # Use a robust root-finding algorithm\n    sol = root_scalar(g, bracket=[t_min, t_max], method='brentq')\n    return sol.root\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Test case 1 (piecewise-constant rate)\n        ('piecewise', {'l1': 2.0, 'l2': 5.0, 'tc': 0.7}, [0.0, 0.5, 1.4, 3.0]),\n        # Test case 2 (linear rate)\n        ('linear', {'a': 0.8, 'b': 1.2}, [0.0, 0.5, 1.0, 3.0]),\n        # Test case 3 (sinusoidal rate)\n        ('sinusoidal', {'a': 1.5, 'b': 0.4, 'omega': 2.0}, [0.0, 0.5, 2.0, 5.0]),\n        # Test case 4 (homogeneous as a linear special case)\n        ('linear', {'a': 4.0, 'b': 0.0}, [0.0, 0.25, 2.0]),\n    ]\n\n    all_results = []\n    for rate_type, params, tau_values in test_cases:\n        case_results = []\n        for tau in tau_values:\n            if rate_type == 'piecewise':\n                t = solve_piecewise(params, tau)\n            elif rate_type == 'linear':\n                t = solve_linear(params, tau)\n            elif rate_type == 'sinusoidal':\n                t = solve_sinusoidal(params, tau)\n            else:\n                raise ValueError(f\"Unknown rate type: {rate_type}\")\n            \n            # Round result to 6 decimal places as required.\n            case_results.append(round(t, 6))\n        all_results.append(case_results)\n\n    # Format the final output string to match the problem specification\n    # e.g., [[val1,val2],[val3,val4]]\n    # str() conversion and replacing spaces creates the desired compact format.\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```", "id": "2694279"}, {"introduction": "Connecting theoretical models to experimental data requires robust statistical methods that account for measurement limitations. This exercise [@problem_id:2694303] tackles a ubiquitous challenge in single-molecule studies: right-censoring caused by finite observation windows. You will construct a likelihood function that correctly incorporates both completed and incomplete (censored) dwell times and subsequently derive the maximum likelihood estimators for the underlying kinetic rates, a vital skill for accurate parameter inference from real-world data.", "problem": "A single-molecule receptor switches between an \"on\" state and an \"off\" state according to a continuous-time two-state reversible reaction network. When the receptor is in the \"on\" state, it exits that state with a first-order rate constant $k_{\\mathrm{off}}$; when the receptor is in the \"off\" state, it exits that state with a first-order rate constant $k_{\\mathrm{on}}$. Under standard dwell-time analysis assumptions, the sojourn (dwell) time in each state is independent and exponentially distributed with the corresponding exit rate. A finite observation window of duration $T_{\\mathrm{obs}}$ produces independent right-censoring: any dwell that is ongoing at time $T_{\\mathrm{obs}}$ is recorded only up to its observed length and marked as censored.\n\nYou observe $d_{\\mathrm{on}}$ completed \"on\"-state dwells with durations $\\{t_{i}^{\\mathrm{on}}\\}_{i=1}^{d_{\\mathrm{on}}}$ (each satisfying $0<t_{i}^{\\mathrm{on}}<T_{\\mathrm{obs}}$) and $c_{\\mathrm{on}}$ right-censored \"on\"-state dwells with observed lengths $\\{u_{j}^{\\mathrm{on}}\\}_{j=1}^{c_{\\mathrm{on}}}$, where each $u_{j}^{\\mathrm{on}}$ equals $T_{\\mathrm{obs}}-s_{j}^{\\mathrm{on}}$ for the corresponding start time $s_{j}^{\\mathrm{on}}\\in[0,T_{\\mathrm{obs}})$. Similarly, you observe $d_{\\mathrm{off}}$ completed \"off\"-state dwells with durations $\\{t_{i}^{\\mathrm{off}}\\}_{i=1}^{d_{\\mathrm{off}}}$ and $c_{\\mathrm{off}}$ right-censored \"off\"-state dwells with observed lengths $\\{u_{j}^{\\mathrm{off}}\\}_{j=1}^{c_{\\mathrm{off}}}$, where each $u_{j}^{\\mathrm{off}}=T_{\\mathrm{obs}}-s_{j}^{\\mathrm{off}}$ for some $s_{j}^{\\mathrm{off}}\\in[0,T_{\\mathrm{obs}})$. Assume independent sampling and non-informative censoring (the stopping at $T_{\\mathrm{obs}}$ is independent of the underlying transition dynamics).\n\nStarting only from the exponential probability density function $f(t\\mid \\lambda)=\\lambda \\exp(-\\lambda t)$ for $t>0$ and its survival function $S(t\\mid \\lambda)=\\exp(-\\lambda t)$, and from the product rule for likelihoods of independent observations, perform the following:\n\n1. Formulate the full likelihood function for the observed data under right-censoring in terms of $k_{\\mathrm{off}}$ and $k_{\\mathrm{on}}$.\n2. Derive the maximum likelihood estimators for $k_{\\mathrm{off}}$ and $k_{\\mathrm{on}}$ under this censoring scheme, expressing each estimator purely in terms of the observed completed dwell durations and the observed censored lengths for the corresponding state.\n\nProvide your final answer as closed-form analytic expressions for $\\hat{k}_{\\mathrm{off}}$ and $\\hat{k}_{\\mathrm{on}}$ in terms of $d_{\\mathrm{on}}$, $d_{\\mathrm{off}}$, $\\{t_{i}^{\\mathrm{on}}\\}$, $\\{u_{j}^{\\mathrm{on}}\\}$, $\\{t_{i}^{\\mathrm{off}}\\}$, and $\\{u_{j}^{\\mathrm{off}}\\}$. Express rates in $\\mathrm{s}^{-1}$, but do not include units in the boxed final answer. No numerical approximation or rounding is required.", "solution": "The problem statement is subjected to validation and is found to be valid. It is scientifically grounded in the principles of chemical kinetics and statistical inference, well-posed, objective, and contains all necessary information for a rigorous solution. No inconsistencies, contradictions, or unscientific premises are present. We may therefore proceed with the derivation.\n\nThe problem requires the derivation of the maximum likelihood estimators (MLEs) for the rate constants $k_{\\mathrm{off}}$ and $k_{\\mathrm{on}}$ of a two-state kinetic system, based on a dataset containing both completed (uncensored) and right-censored dwell times for each state.\n\nThe fundamental principle for constructing a likelihood function for a set of independent observations, some of which may be right-censored, is as follows:\n1. For an uncensored observation, i.e., an event that is observed to complete at time $t$, its contribution to the likelihood is the probability density function (PDF) evaluated at $t$, $f(t)$.\n2. For a right-censored observation, i.e., an event that is known only to have lasted at least until time $u$, its contribution to the likelihood is the probability of surviving beyond $u$. This is given by the survival function, $S(u)$.\n\nThe total likelihood function for a set of independent observations is the product of the individual contributions.\n\nThe problem states that the dwell times in the \"on\" and \"off\" states are independent processes. The \"on\"-state dwells are governed solely by the rate constant $k_{\\mathrm{off}}$, and the \"off\"-state dwells are governed solely by $k_{\\mathrm{on}}$. Consequently, the total likelihood function $L(k_{\\mathrm{off}}, k_{\\mathrm{on}})$ can be factored into two independent components, one for each state:\n$$L(k_{\\mathrm{off}}, k_{\\mathrm{on}}) = L_{\\mathrm{on}}(k_{\\mathrm{off}}) \\cdot L_{\\mathrm{off}}(k_{\\mathrm{on}})$$\nThis separation allows us to maximize each component independently to find the respective MLEs.\n\nLet us first consider the \"on\" state. The dwell time $t$ is exponentially distributed with rate parameter $\\lambda = k_{\\mathrm{off}}$. The PDF is $f(t \\mid k_{\\mathrm{off}}) = k_{\\mathrm{off}} \\exp(-k_{\\mathrm{off}} t)$ and the survival function is $S(t \\mid k_{\\mathrm{off}}) = \\exp(-k_{\\mathrm{off}} t)$.\nThe observed data for the \"on\" state consist of $d_{\\mathrm{on}}$ completed dwells $\\{t_{i}^{\\mathrm{on}}\\}_{i=1}^{d_{\\mathrm{on}}}$ and $c_{\\mathrm{on}}$ right-censored dwells $\\{u_{j}^{\\mathrm{on}}\\}_{j=1}^{c_{\\mathrm{on}}}$.\n\nThe likelihood function for the \"on\" state data, $L_{\\mathrm{on}}(k_{\\mathrm{off}})$, is the product of the PDFs for the completed dwells and the survival functions for the censored dwells:\n$$L_{\\mathrm{on}}(k_{\\mathrm{off}}) = \\left( \\prod_{i=1}^{d_{\\mathrm{on}}} f(t_{i}^{\\mathrm{on}} \\mid k_{\\mathrm{off}}) \\right) \\left( \\prod_{j=1}^{c_{\\mathrm{on}}} S(u_{j}^{\\mathrm{on}} \\mid k_{\\mathrm{off}}) \\right)$$\nSubstituting the expressions for the exponential PDF and survival function:\n$$L_{\\mathrm{on}}(k_{\\mathrm{off}}) = \\left( \\prod_{i=1}^{d_{\\mathrm{on}}} k_{\\mathrm{off}} \\exp(-k_{\\mathrm{off}} t_{i}^{\\mathrm{on}}) \\right) \\left( \\prod_{j=1}^{c_{\\mathrm{on}}} \\exp(-k_{\\mathrm{off}} u_{j}^{\\mathrm{on}}) \\right)$$\nThis expression can be simplified by combining terms:\n$$L_{\\mathrm{on}}(k_{\\mathrm{off}}) = (k_{\\mathrm{off}})^{d_{\\mathrm{on}}} \\exp\\left(-k_{\\mathrm{off}} \\sum_{i=1}^{d_{\\mathrm{on}}} t_{i}^{\\mathrm{on}}\\right) \\exp\\left(-k_{\\mathrm{off}} \\sum_{j=1}^{c_{\\mathrm{on}}} u_{j}^{\\mathrm{on}}\\right)$$\n$$L_{\\mathrm{on}}(k_{\\mathrm{off}}) = (k_{\\mathrm{off}})^{d_{\\mathrm{on}}} \\exp\\left[-k_{\\mathrm{off}} \\left( \\sum_{i=1}^{d_{\\mathrm{on}}} t_{i}^{\\mathrm{on}} + \\sum_{j=1}^{c_{\\mathrm{on}}} u_{j}^{\\mathrm{on}} \\right)\\right]$$\nBy perfect analogy, the likelihood function for the \"off\" state data, which depends on the parameter $k_{\\mathrm{on}}$, is:\n$$L_{\\mathrm{off}}(k_{\\mathrm{on}}) = (k_{\\mathrm{on}})^{d_{\\mathrm{off}}} \\exp\\left[-k_{\\mathrm{on}} \\left( \\sum_{i=1}^{d_{\\mathrm{off}}} t_{i}^{\\mathrm{off}} + \\sum_{j=1}^{c_{\\mathrm{off}}} u_{j}^{\\mathrm{off}} \\right)\\right]$$\nThe full likelihood function is the product $L(k_{\\mathrm{off}}, k_{\\mathrm{on}}) = L_{\\mathrm{on}}(k_{\\mathrm{off}}) \\cdot L_{\\mathrm{off}}(k_{\\mathrm{on}})$. This completes the first task.\n\nTo derive the MLEs, we maximize the likelihood function. It is standard and more convenient to maximize the natural logarithm of the likelihood function, the log-likelihood $\\mathcal{L} = \\ln L$. Since $\\ln$ is a monotonic function, the maximum of $\\mathcal{L}$ occurs at the same parameter values as the maximum of $L$.\nThe total log-likelihood is:\n$$\\mathcal{L}(k_{\\mathrm{off}}, k_{\\mathrm{on}}) = \\ln L_{\\mathrm{on}}(k_{\\mathrm{off}}) + \\ln L_{\\mathrm{off}}(k_{\\mathrm{on}}) = \\mathcal{L}_{\\mathrm{on}}(k_{\\mathrm{off}}) + \\mathcal{L}_{\\mathrm{off}}(k_{\\mathrm{on}})$$\nWe can maximize $\\mathcal{L}_{\\mathrm{on}}$ with respect to $k_{\\mathrm{off}}$ and $\\mathcal{L}_{\\mathrm{off}}$ with respect to $k_{\\mathrm{on}}$ independently.\n\nFor the \"on\" state:\n$$\\mathcal{L}_{\\mathrm{on}}(k_{\\mathrm{off}}) = \\ln\\left( (k_{\\mathrm{off}})^{d_{\\mathrm{on}}} \\exp\\left[-k_{\\mathrm{off}} \\left( \\sum_{i=1}^{d_{\\mathrm{on}}} t_{i}^{\\mathrm{on}} + \\sum_{j=1}^{c_{\\mathrm{on}}} u_{j}^{\\mathrm{on}} \\right)\\right] \\right)$$\n$$\\mathcal{L}_{\\mathrm{on}}(k_{\\mathrm{off}}) = d_{\\mathrm{on}} \\ln(k_{\\mathrm{off}}) - k_{\\mathrm{off}} \\left( \\sum_{i=1}^{d_{\\mathrm{on}}} t_{i}^{\\mathrm{on}} + \\sum_{j=1}^{c_{\\mathrm{on}}} u_{j}^{\\mathrm{on}} \\right)$$\nTo find the MLE $\\hat{k}_{\\mathrm{off}}$, we take the first derivative of $\\mathcal{L}_{\\mathrm{on}}$ with respect to $k_{\\mathrm{off}}$ and set it to zero:\n$$\\frac{\\partial \\mathcal{L}_{\\mathrm{on}}}{\\partial k_{\\mathrm{off}}} = \\frac{d_{\\mathrm{on}}}{k_{\\mathrm{off}}} - \\left( \\sum_{i=1}^{d_{\\mathrm{on}}} t_{i}^{\\mathrm{on}} + \\sum_{j=1}^{c_{\\mathrm{on}}} u_{j}^{\\mathrm{on}} \\right) = 0$$\nSolving for $k_{\\mathrm{off}}$ gives the estimator $\\hat{k}_{\\mathrm{off}}$:\n$$\\frac{d_{\\mathrm{on}}}{\\hat{k}_{\\mathrm{off}}} = \\sum_{i=1}^{d_{\\mathrm{on}}} t_{i}^{\\mathrm{on}} + \\sum_{j=1}^{c_{\\mathrm{on}}} u_{j}^{\\mathrm{on}}$$\n$$\\hat{k}_{\\mathrm{off}} = \\frac{d_{\\mathrm{on}}}{\\sum_{i=1}^{d_{\\mathrm{on}}} t_{i}^{\\mathrm{on}} + \\sum_{j=1}^{c_{\\mathrm{on}}} u_{j}^{\\mathrm{on}}}$$\nThe second derivative, $\\frac{\\partial^2 \\mathcal{L}_{\\mathrm{on}}}{\\partial k_{\\mathrm{off}}^2} = -\\frac{d_{\\mathrm{on}}}{k_{\\mathrm{off}}^2}$, is negative for any $d_{\\mathrm{on}} > 0$, which confirms that this critical point is a maximum. The physical interpretation of this result is that the estimated rate is the number of observed exit events ($d_{\\mathrm{on}}$) divided by the total time observed in the state (sum of all completed and censored durations).\n\nThe derivation for $\\hat{k}_{\\mathrm{on}}$ is identical in form. The log-likelihood for the \"off\" state is:\n$$\\mathcal{L}_{\\mathrm{off}}(k_{\\mathrm{on}}) = d_{\\mathrm{off}} \\ln(k_{\\mathrm{on}}) - k_{\\mathrm{on}} \\left( \\sum_{i=1}^{d_{\\mathrm{off}}} t_{i}^{\\mathrm{off}} + \\sum_{j=1}^{c_{\\mathrm{off}}} u_{j}^{\\mathrm{off}} \\right)$$\nSetting its derivative with respect to $k_{\\mathrm{on}}$ to zero yields the MLE $\\hat{k}_{\\mathrm{on}}$:\n$$\\frac{\\partial \\mathcal{L}_{\\mathrm{off}}}{\\partial k_{\\mathrm{on}}} = \\frac{d_{\\mathrm{off}}}{k_{\\mathrm{on}}} - \\left( \\sum_{i=1}^{d_{\\mathrm{off}}} t_{i}^{\\mathrm{off}} + \\sum_{j=1}^{c_{\\mathrm{off}}} u_{j}^{\\mathrm{off}} \\right) = 0$$\n$$\\hat{k}_{\\mathrm{on}} = \\frac{d_{\\mathrm{off}}}{\\sum_{i=1}^{d_{\\mathrm{off}}} t_{i}^{\\mathrm{off}} + \\sum_{j=1}^{c_{\\mathrm{off}}} u_{j}^{\\mathrm{off}}}$$\nThe final answer presents these two estimators. The first element of the matrix corresponds to the estimator for $k_{\\mathrm{off}}$ and the second to the estimator for $k_{\\mathrm{on}}$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{d_{\\mathrm{on}}}{\\sum_{i=1}^{d_{\\mathrm{on}}} t_{i}^{\\mathrm{on}} + \\sum_{j=1}^{c_{\\mathrm{on}}} u_{j}^{\\mathrm{on}}} & \\frac{d_{\\mathrm{off}}}{\\sum_{i=1}^{d_{\\mathrm{off}}} t_{i}^{\\mathrm{off}} + \\sum_{j=1}^{c_{\\mathrm{off}}} u_{j}^{\\mathrm{off}}}\n\\end{pmatrix}\n}\n$$", "id": "2694303"}]}