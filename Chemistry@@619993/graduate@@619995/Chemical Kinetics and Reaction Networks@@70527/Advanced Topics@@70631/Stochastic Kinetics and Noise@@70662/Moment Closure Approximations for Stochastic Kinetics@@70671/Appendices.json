{"hands_on_practices": [{"introduction": "Moment closure techniques fundamentally rely on expressing higher-order moments, which are unclosed, in terms of lower-order moments. Before applying these closures to the dynamic equations of a system, it is essential to first master the underlying algebraic relationships that the closure assumption imposes. This exercise provides foundational practice in using the Gaussian closure assumption—where all cumulants of order three or higher are set to zero—to derive expressions for moments that frequently appear in the propensity functions of nonlinear reactions.", "problem": "Consider a well-mixed stochastic reaction network with a single chemical species $A$ undergoing the reactions $\\varnothing \\xrightarrow{\\lambda} A$ and $2A \\xrightarrow{k} \\varnothing$ under the Chemical Master Equation (CME). Let $X$ denote the random copy number of species $A$. The moment dynamics for this network involve higher-order moments through the mass-action propensity associated with the bimolecular reaction, which depends on the factorial moment $E[X(X-1)]$. To close the moment hierarchy, employ the Gaussian closure assumption: approximate the distribution of $X$ by a univariate Gaussian distribution such that all cumulants of order higher than second vanish. Let $m = E[X]$ and $\\sigma^{2} = \\mathrm{Var}[X]$ denote the mean and variance, respectively.\n\nUsing only foundational probabilistic definitions (raw moments, central moments, cumulants) and the defining properties of the Gaussian distribution under the Gaussian closure assumption, derive closed-form expressions for the following quantities in terms of $m$ and $\\sigma^{2}$:\n- $E[X(X-1)]$\n- $E[X^{3}]$\n- $E[X^{4}]$\n\nYour final answer must be a single analytical expression that lists these three expressions in the stated order. No numerical evaluation is required, and no rounding is needed. Do not include any physical units in your answer.", "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n- Chemical species: $A$\n- Reactions: $\\varnothing \\xrightarrow{\\lambda} A$ and $2A \\xrightarrow{k} \\varnothing$\n- Stochastic variable: $X$ is the copy number of species $A$.\n- Moments: $m = E[X]$ (mean), $\\sigma^{2} = \\mathrm{Var}[X]$ (variance).\n- Closure assumption: The distribution of $X$ is approximated by a univariate Gaussian distribution. This implies that all cumulants of order higher than second are zero.\n- Task: Derive expressions for $E[X(X-1)]$, $E[X^{3}]$, and $E[X^{4}]$ in terms of $m$ and $\\sigma^{2}$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Groundedness**: The problem is correctly situated within the field of stochastic chemical kinetics. The use of moment closure, specifically Gaussian closure, is a standard and valid approximation technique for solving the Chemical Master Equation when analytical solutions are intractable. The relationships between moments, central moments, and cumulants are fundamental concepts in probability theory. The problem is scientifically and mathematically sound.\n- **Well-Posedness**: The problem is well-posed. It provides a clear, unambiguous assumption (Gaussian closure) and asks for specific quantities to be derived based on this assumption. A unique, stable, and meaningful solution exists and can be derived through standard mathematical procedures.\n- **Objectivity**: The problem is stated in precise, objective language, free of any subjective or non-scientific claims.\n\n**Step 3: Verdict and Action**\nThe problem is **valid**. It is a standard exercise in the application of moment closure methods. A full solution will be provided.\n\nThe core of the problem lies in the relationship between the raw moments ($\\mu_n' = E[X^n]$), central moments ($\\mu_n = E[(X-m)^n]$), and cumulants ($\\kappa_n$) of a probability distribution. The Gaussian closure assumption posits that the distribution is Gaussian. A defining property of the Gaussian distribution is that all of its cumulants of order $n > 2$ are identically zero.\n\nThe first two cumulants are defined as the mean and the variance, respectively:\n$$ \\kappa_1 = E[X] = m $$\n$$ \\kappa_2 = \\mathrm{Var}[X] = \\sigma^2 $$\n\nThe Gaussian closure assumption imposes the condition:\n$$ \\kappa_n = 0 \\quad \\text{for all } n > 2 $$\n\nWe will use the general formulas that express raw moments in terms of cumulants to derive the required quantities.\n\n**1. Derivation of $E[X(X-1)]$**\nThis quantity is the second factorial moment. By linearity of expectation, we have:\n$$ E[X(X-1)] = E[X^2 - X] = E[X^2] - E[X] $$\nWe require the second raw moment, $E[X^2]$. The relationship between the second raw moment and the first two cumulants is given by:\n$$ \\mu_2' = E[X^2] = \\kappa_2 + \\kappa_1^2 $$\nSubstituting the given definitions $\\kappa_1 = m$ and $\\kappa_2 = \\sigma^2$:\n$$ E[X^2] = \\sigma^2 + m^2 $$\nNow, we can find the expression for the second factorial moment:\n$$ E[X(X-1)] = (\\sigma^2 + m^2) - m = m^2 - m + \\sigma^2 $$\n\n**2. Derivation of $E[X^3]$**\nThis is the third raw moment, $\\mu_3'$. The general formula relating $\\mu_3'$ to the first three cumulants is:\n$$ \\mu_3' = E[X^3] = \\kappa_3 + 3\\kappa_2\\kappa_1 + \\kappa_1^3 $$\nApplying the Gaussian closure assumption, we set $\\kappa_3 = 0$:\n$$ E[X^3] = 0 + 3\\kappa_2\\kappa_1 + \\kappa_1^3 $$\nSubstituting $\\kappa_1 = m$ and $\\kappa_2 = \\sigma^2$:\n$$ E[X^3] = 3\\sigma^2 m + m^3 = m^3 + 3m\\sigma^2 $$\n\n**3. Derivation of $E[X^4]$**\nThis is the fourth raw moment, $\\mu_4'$. The general formula for $\\mu_4'$ in terms of cumulants up to order four is:\n$$ \\mu_4' = E[X^4] = \\kappa_4 + 4\\kappa_3\\kappa_1 + 3\\kappa_2^2 + 6\\kappa_2\\kappa_1^2 + \\kappa_1^4 $$\nUnder the Gaussian closure assumption, both $\\kappa_3$ and $\\kappa_4$ are zero. The formula simplifies to:\n$$ E[X^4] = 0 + 4(0)\\kappa_1 + 3\\kappa_2^2 + 6\\kappa_2\\kappa_1^2 + \\kappa_1^4 = 3\\kappa_2^2 + 6\\kappa_2\\kappa_1^2 + \\kappa_1^4 $$\nSubstituting $\\kappa_1 = m$ and $\\kappa_2 = \\sigma^2$:\n$$ E[X^4] = 3(\\sigma^2)^2 + 6(\\sigma^2)(m^2) + m^4 = m^4 + 6m^2\\sigma^2 + 3\\sigma^4 $$\nThis completes the derivations for all three required quantities based on the specified closure assumption.", "answer": "$$\\boxed{\\begin{pmatrix} m^{2} - m + \\sigma^{2} & m^{3} + 3m\\sigma^{2} & m^{4} + 6m^{2}\\sigma^{2} + 3\\sigma^{4} \\end{pmatrix}}$$", "id": "2657882"}, {"introduction": "While moment closure approximations are powerful tools for analyzing stochastic systems, they are not without their pitfalls and can sometimes yield unphysical results. A common failure mode is the violation of physical constraints, such as the non-negativity of variances or factorial moments, which must hold true for any valid probability distribution of species counts. This practice problem demonstrates this limitation by guiding you to find a scenario where the Gaussian closure fails, and then introducing a projection-based method to correct the dynamics and enforce the physical boundary.", "problem": "Consider the single-species stochastic reaction network with inflow and dimerization (annihilation) given by the reactions\n- $\\varnothing \\to X$ with rate constant $k_{0}$ (zeroth-order inflow),\n- $2X \\to \\varnothing$ with rate constant $k_{2}$ (second-order annihilation, mass-action propensity $a_{2}(X) = \\frac{k_{2}}{2} X(X-1)$).\n\nLet $X(t)$ denote the random copy number, $m(t) := \\mathbb{E}[X(t)]$ the mean, $f_{2}(t) := \\mathbb{E}[X(t)(X(t)-1)]$ the second factorial moment, and $v(t) := \\operatorname{Var}(X(t)) = \\mathbb{E}[X^{2}(t)] - m^{2}(t) = f_{2}(t) + m(t) - m^{2}(t)$ the variance. Use the generator identity for the Chemical Master Equation (CME), namely\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\mathbb{E}[g(X)] \\;=\\; \\mathbb{E}\\Bigg[\\sum_{r} a_{r}(X)\\big(g(X+\\nu_{r}) - g(X)\\big)\\Bigg],\n$$\nwhere $a_{r}(X)$ and $\\nu_{r}$ denote the propensity and stoichiometric change of reaction $r$, to derive the exact moment equations for $\\frac{\\mathrm{d}}{\\mathrm{d}t} m$ and $\\frac{\\mathrm{d}}{\\mathrm{d}t} f_{2}$ in terms of $\\mathbb{E}[X^{3}]$. Then close the system by invoking the Gaussian closure (normal approximation), which assumes zero third central moment and yields\n$$\n\\mathbb{E}[X^{3}] \\;=\\; m^{3} + 3 m v \\;=\\; m^{3} + 3 m \\big(f_{2} + m - m^{2}\\big).\n$$\nAnswer the following:\n\n1) Starting from the CME identity, derive exact expressions for $\\frac{\\mathrm{d}}{\\mathrm{d}t} m$ and $\\frac{\\mathrm{d}}{\\mathrm{d}t} f_{2}$, exhibiting the dependence on $\\mathbb{E}[X^{3}]$.\n\n2) Substitute the Gaussian closure expression for $\\mathbb{E}[X^{3}]$ into your formula for $\\frac{\\mathrm{d}}{\\mathrm{d}t} f_{2}$ to obtain a closed expression for $\\frac{\\mathrm{d}}{\\mathrm{d}t} f_{2}$ in terms of $m$ and $f_{2}$.\n\n3) Specialize to the parameter set $k_{0} = 1$ and $k_{2} = 9$ and the state $(m, f_{2}) = \\left(\\frac{3}{4}, 0\\right)$. Evaluate the Gaussian-closure value of $\\left.\\frac{\\mathrm{d}}{\\mathrm{d}t} f_{2}\\right|_{t=0}$ and determine its sign, thereby constructing a regime in which the Gaussian closure yields an immediate violation of nonnegativity, $f_{2}(t) < 0$ for $t > 0$ sufficiently small.\n\n4) Outline a projection-based correction that restores nonnegativity: at the boundary $f_{2} = 0$, keep $m$ fixed and minimally perturb only the third raw moment used by the closure, $\\mathbb{E}[X^{3}]$, so that the corrected instantaneous drift satisfies $\\left.\\frac{\\mathrm{d}}{\\mathrm{d}t} f_{2}\\right|_{t=0}^{\\mathrm{corr}} = 0$. Compute the exact value of the correction\n$$\n\\Delta \\mathbb{E}[X^{3}] \\;:=\\; \\mathbb{E}[X^{3}]_{\\mathrm{corr}} - \\mathbb{E}[X^{3}]_{\\mathrm{Gauss}}\n$$\nat the given parameters and state.\n\nGive your final answer as the exact value of $\\Delta \\mathbb{E}[X^{3}]$ (no units). If a numerical approximation is used, round your answer to four significant figures; otherwise, provide an exact fraction.", "solution": "The problem statement is scientifically grounded, well-posed, objective, and self-contained. It is a valid exercise in the analysis of moment closure approximations for stochastic kinetic systems. We proceed with the solution.\n\nThe stochastic process involves two reactions:\n1.  Zeroth-order inflow: $\\varnothing \\xrightarrow{k_0} X$. The propensity is $a_1(X) = k_0$, and the stoichiometric change is $\\nu_1 = +1$.\n2.  Second-order annihilation: $2X \\xrightarrow{k_2} \\varnothing$. The propensity is $a_2(X) = \\frac{k_2}{2} X(X-1)$, and the stoichiometric change is $\\nu_2 = -2$.\n\nWe are given the generator identity for the time evolution of the expectation of an arbitrary function $g(X)$:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\mathbb{E}[g(X)] = \\mathbb{E}\\Bigg[\\sum_{r=1}^{2} a_r(X) \\big(g(X+\\nu_r) - g(X)\\big)\\Bigg]\n$$\n\n**1) Derivation of Exact Moment Equations**\n\nWe first derive the equation for the mean, $m(t) = \\mathbb{E}[X(t)]$, by setting $g(X)=X$.\nThe change for reaction $1$ is $a_1(X)(g(X+\\nu_1)-g(X)) = k_0((X+1)-X) = k_0$.\nThe change for reaction $2$ is $a_2(X)(g(X+\\nu_2)-g(X)) = \\frac{k_2}{2}X(X-1)((X-2)-X) = -k_2 X(X-1)$.\nSumming the expectations gives the evolution of the mean:\n$$\n\\frac{\\mathrm{d}m}{\\mathrm{d}t} = \\mathbb{E}[k_0 - k_2 X(X-1)] = k_0 - k_2\\mathbb{E}[X(X-1)]\n$$\nBy definition, $f_2(t) = \\mathbb{E}[X(t)(X(t)-1)]$, so we have:\n$$\n\\frac{\\mathrm{d}m}{\\mathrm{d}t} = k_0 - k_2 f_2\n$$\nThis equation is exact and already closed, not depending on higher moments.\n\nNext, we derive the equation for the second factorial moment, $f_2(t) = \\mathbb{E}[X(t)(X(t)-1)]$, by setting $g(X)=X(X-1)$.\nThe change for reaction $1$ is $a_1(X)(g(X+\\nu_1)-g(X)) = k_0((X+1)X - X(X-1)) = k_0(X^2+X - X^2+X) = 2k_0 X$.\nThe change for reaction $2$ is $a_2(X)(g(X+\\nu_2)-g(X)) = \\frac{k_2}{2}X(X-1)((X-2)(X-3) - X(X-1)) = \\frac{k_2}{2}X(X-1)(X^2-5X+6 - (X^2-X)) = \\frac{k_2}{2}X(X-1)(-4X+6) = -k_2 X(X-1)(2X-3)$.\nSumming the expectations gives the evolution of the second factorial moment:\n$$\n\\frac{\\mathrm{d}f_2}{\\mathrm{d}t} = \\mathbb{E}[2k_0 X - k_2 X(X-1)(2X-3)] = 2k_0\\mathbb{E}[X] - k_2\\mathbb{E}[2X^3 - 5X^2 + 3X]\n$$\nWe express $\\mathbb{E}[X^2]$ in terms of $m$ and $f_2$: $\\mathbb{E}[X^2] = \\mathbb{E}[X(X-1)+X] = f_2+m$.\nSubstituting this into the equation for $\\frac{\\mathrm{d}f_2}{\\mathrm{d}t}$:\n$$\n\\frac{\\mathrm{d}f_2}{\\mathrm{d}t} = 2k_0 m - k_2(2\\mathbb{E}[X^3] - 5\\mathbb{E}[X^2] + 3m) = 2k_0 m - k_2(2\\mathbb{E}[X^3] - 5(f_2+m) + 3m)\n$$\nSimplifying this yields the final exact equation, which exhibits the dependence on $\\mathbb{E}[X^3]$:\n$$\n\\frac{\\mathrm{d}f_2}{\\mathrm{d}t} = 2k_0 m - k_2(2\\mathbb{E}[X^3] - 5f_2 - 2m)\n$$\n\n**2) Gaussian Closure**\n\nThe Gaussian closure approximates the third raw moment $\\mathbb{E}[X^3]$ using the mean $m$, variance $v$, and second factorial moment $f_2$. The variance is $v = \\mathbb{E}[X^2] - m^2 = (f_2+m) - m^2$.\nThe approximation is $\\mathbb{E}[X^3] = m^3 + 3mv$. Substituting the expression for $v$:\n$$\n\\mathbb{E}[X^3]_{\\mathrm{Gauss}} = m^3 + 3m(f_2 + m - m^2)\n$$\nWe substitute this into the exact equation for $\\frac{\\mathrm{d}f_2}{\\mathrm{d}t}$:\n$$\n\\frac{\\mathrm{d}f_2}{\\mathrm{d}t} = 2k_0 m - k_2\\Big(2\\big(m^3 + 3m(f_2+m-m^2)\\big) - 5f_2 - 2m\\Big)\n$$\nWe simplify the term in the parentheses:\n$$\n2m^3 + 6mf_2 + 6m^2 - 6m^3 - 5f_2 - 2m = -4m^3 + 6m^2 - 2m + (6m-5)f_2\n$$\nThe closed equation for $\\frac{\\mathrm{d}f_2}{\\mathrm{d}t}$ is therefore:\n$$\n\\frac{\\mathrm{d}f_2}{\\mathrm{d}t} = 2k_0 m - k_2\\big(-4m^3 + 6m^2 - 2m + (6m-5)f_2\\big)\n$$\n$$\n\\frac{\\mathrm{d}f_2}{\\mathrm{d}t} = 2k_0 m + 2k_2 m(2m^2 - 3m + 1) - k_2(6m-5)f_2\n$$\n\n**3) Negativity Violation**\n\nWe evaluate the closed-form derivative $\\frac{\\mathrm{d}f_2}{\\mathrm{d}t}$ at the specified state.\nParameters: $k_0 = 1$, $k_2 = 9$.\nState at $t=0$: $(m(0), f_2(0)) = \\left(\\frac{3}{4}, 0\\right)$.\nSubstituting these values into the closed equation:\n$$\n\\left.\\frac{\\mathrm{d}f_2}{\\mathrm{d}t}\\right|_{t=0} = 2(1)\\left(\\frac{3}{4}\\right) + 2(9)\\left(\\frac{3}{4}\\right)\\left(2\\left(\\frac{3}{4}\\right)^2 - 3\\left(\\frac{3}{4}\\right) + 1\\right) - 9\\left(6\\left(\\frac{3}{4}\\right)-5\\right)(0)\n$$\n$$\n\\left.\\frac{\\mathrm{d}f_2}{\\mathrm{d}t}\\right|_{t=0} = \\frac{3}{2} + \\frac{27}{2}\\left(2\\left(\\frac{9}{16}\\right) - \\frac{9}{4} + 1\\right) = \\frac{3}{2} + \\frac{27}{2}\\left(\\frac{9}{8} - \\frac{18}{8} + \\frac{8}{8}\\right)\n$$\n$$\n\\left.\\frac{\\mathrm{d}f_2}{\\mathrm{d}t}\\right|_{t=0} = \\frac{3}{2} + \\frac{27}{2}\\left(-\\frac{1}{8}\\right) = \\frac{3}{2} - \\frac{27}{16} = \\frac{24}{16} - \\frac{27}{16} = -\\frac{3}{16}\n$$\nThe sign of $\\left.\\frac{\\mathrm{d}f_2}{\\mathrm{d}t}\\right|_{t=0}$ is negative. Since $f_2(0)=0$ and its time derivative is negative, $f_2(t)$ will become negative for $t>0$ sufficiently small. This violates the physical constraint that $f_2(t) = \\mathbb{E}[X(t)(X(t)-1)] \\ge 0$, as $X(t)$ is a non-negative integer.\n\n**4) Projection-Based Correction**\n\nTo restore nonnegativity, we require the corrected drift $\\left.\\frac{\\mathrm{d}f_2}{\\mathrm{d}t}\\right|_{t=0}^{\\mathrm{corr}}$ to be zero. We achieve this by finding a corrected third moment, $\\mathbb{E}[X^3]_{\\mathrm{corr}}$, which satisfies this condition. We use the **exact** evolution equation for $f_2$:\n$$\n\\left.\\frac{\\mathrm{d}f_2}{\\mathrm{d}t}\\right|_{t=0}^{\\mathrm{corr}} = 2k_0 m(0) - k_2\\big(2\\mathbb{E}[X^3]_{\\mathrm{corr}} - 5f_2(0) - 2m(0)\\big) = 0\n$$\nSubstituting the parameters $k_0 = 1, k_2 = 9$ and state $(m(0), f_2(0)) = \\left(\\frac{3}{4}, 0\\right)$:\n$$\n2(1)\\left(\\frac{3}{4}\\right) - 9\\left(2\\mathbb{E}[X^3]_{\\mathrm{corr}} - 5(0) - 2\\left(\\frac{3}{4}\\right)\\right) = 0\n$$\n$$\n\\frac{3}{2} - 9\\left(2\\mathbb{E}[X^3]_{\\mathrm{corr}} - \\frac{3}{2}\\right) = 0\n$$\n$$\n\\frac{3}{2} - 18\\mathbb{E}[X^3]_{\\mathrm{corr}} + \\frac{27}{2} = 0\n$$\n$$\n18\\mathbb{E}[X^3]_{\\mathrm{corr}} = \\frac{30}{2} = 15\n$$\n$$\n\\mathbb{E}[X^3]_{\\mathrm{corr}} = \\frac{15}{18} = \\frac{5}{6}\n$$\nNow, we calculate the third moment predicted by the Gaussian closure, $\\mathbb{E}[X^3]_{\\mathrm{Gauss}}$, at the same state:\n$$\n\\mathbb{E}[X^3]_{\\mathrm{Gauss}} = m(0)^3 + 3m(0)\\big(f_2(0) + m(0) - m(0)^2\\big)\n$$\n$$\n\\mathbb{E}[X^3]_{\\mathrm{Gauss}} = \\left(\\frac{3}{4}\\right)^3 + 3\\left(\\frac{3}{4}\\right)\\left(0 + \\frac{3}{4} - \\left(\\frac{3}{4}\\right)^2\\right)\n$$\n$$\n\\mathbb{E}[X^3]_{\\mathrm{Gauss}} = \\frac{27}{64} + \\frac{9}{4}\\left(\\frac{3}{4} - \\frac{9}{16}\\right) = \\frac{27}{64} + \\frac{9}{4}\\left(\\frac{12-9}{16}\\right) = \\frac{27}{64} + \\frac{9}{4}\\left(\\frac{3}{16}\\right)\n$$\n$$\n\\mathbb{E}[X^3]_{\\mathrm{Gauss}} = \\frac{27}{64} + \\frac{27}{64} = \\frac{54}{64} = \\frac{27}{32}\n$$\nThe required correction is the difference between these two values:\n$$\n\\Delta \\mathbb{E}[X^3] = \\mathbb{E}[X^3]_{\\mathrm{corr}} - \\mathbb{E}[X^3]_{\\mathrm{Gauss}} = \\frac{5}{6} - \\frac{27}{32}\n$$\nThe least common multiple of $6$ and $32$ is $96$.\n$$\n\\Delta \\mathbb{E}[X^3] = \\frac{5 \\times 16}{96} - \\frac{27 \\times 3}{96} = \\frac{80}{96} - \\frac{81}{96} = -\\frac{1}{96}\n$$\nThis is the minimal perturbation to the third moment, as used by the closure, required to enforce the nonnegativity constraint at the boundary $f_2 = 0$.", "answer": "$$\n\\boxed{-\\frac{1}{96}}\n$$", "id": "2657891"}, {"introduction": "The accuracy of a moment closure approximation can ultimately only be assessed by comparing its predictions against a more fundamental truth, typically provided by exact stochastic simulations. This exercise provides hands-on experience with this validation process by contrasting the Poisson moment closure with results from the Gillespie Stochastic Simulation Algorithm (SSA). You will discover firsthand how the structural properties of a reaction network—specifically, the lack of complex balancing—can cause a simple closure scheme to fail, underscoring the importance of understanding the domain of an approximation's validity.", "problem": "Consider the single-species reaction network with the following two reactions governed by mass-action kinetics:\n1. Birth: $\\varnothing \\rightarrow X$ with propensity $a_{1}(x) = k_{0}$.\n2. Dimerization removal: $2X \\rightarrow \\varnothing$ with propensity $a_{2}(x) = k_{2}\\,\\frac{x(x-1)}{2}$.\n\nAssume the dynamics are described by the Chemical Master Equation (CME), and let $X(t)$ denote the copy number at time $t$. For any state $x \\in \\mathbb{N}_{0}$, the Stochastic Simulation Algorithm (SSA) (first introduced by Gillespie) provides an exact sample path of the CME. This network is not weakly reversible and thus is not complex-balanced; it is known that Poisson closures are not generally exact for such networks.\n\nYour task is to demonstrate numerically that the Poisson moment closure does not match the stationary moments obtained from SSA for this non-complex-balanced network. Proceed as follows:\n\n1. Derive the first-moment evolution equation from the CME using the standard identity $\\frac{d}{dt}\\mathbb{E}[X(t)] = \\sum_{r} \\nu_{r} \\,\\mathbb{E}[a_{r}(X(t))]$, where $\\nu_{r}$ is the stoichiometric change of reaction $r$ and $a_{r}$ is its propensity. Specialize this to the network above to express $\\frac{d}{dt}\\mathbb{E}[X(t)]$ in terms of $\\mathbb{E}[X(t)(X(t)-1)]$.\n\n2. Implement the Poisson moment closure by approximating all factorial moments as if $X$ were Poisson with mean $m(t) = \\mathbb{E}[X(t)]$, i.e., $\\mathbb{E}[X(t)(X(t)-1)] \\approx m(t)^{2}$ and $\\operatorname{Var}[X(t)] \\approx m(t)$. Using this closure, determine the closed steady-state mean $m_{\\mathrm{pc}}$ by solving for $\\frac{d}{dt}m(t) = 0$.\n\n3. Implement an SSA to estimate the stationary mean $\\mu_{\\mathrm{ssa}}$ and stationary variance $\\sigma_{\\mathrm{ssa}}^{2}$ via long-time time-averaging. Specifically, for a total simulation horizon $T_{\\text{total}}$ and a burn-in time $T_{\\text{burn}}$, estimate\n$\\mu_{\\mathrm{ssa}} \\approx \\frac{1}{T_{\\text{total}} - T_{\\text{burn}}}\\int_{T_{\\text{burn}}}^{T_{\\text{total}}} X(t)\\,dt$ and $\\mathbb{E}[X^{2}] \\approx \\frac{1}{T_{\\text{total}} - T_{\\text{burn}}}\\int_{T_{\\text{burn}}}^{T_{\\text{total}}} X(t)^{2}\\,dt$, then set $\\sigma_{\\mathrm{ssa}}^{2} = \\mathbb{E}[X^{2}] - \\mu_{\\mathrm{ssa}}^{2}$.\n\n4. Demonstrate the mismatch by checking whether the Fano factor $F = \\sigma_{\\mathrm{ssa}}^{2}/\\mu_{\\mathrm{ssa}}$ deviates from the Poisson value $1$ by more than a prescribed threshold. Define a boolean result for each test case as\n$\\text{mismatch} := \\left| \\frac{\\sigma_{\\mathrm{ssa}}^{2}}{\\mu_{\\mathrm{ssa}}} - 1 \\right| > \\epsilon$\nwith $\\epsilon = 0.1$.\n\nUse the following test suite of parameters $(k_{0}, k_{2}, T_{\\text{total}}, T_{\\text{burn}}, \\text{seed})$:\n- Case A (moderate copy numbers): $(20, 0.2, 1500, 500, 13)$.\n- Case B (low copy numbers): $(2, 1.0, 1500, 500, 17)$.\n- Case C (higher copy numbers): $(200, 0.2, 1500, 500, 19)$.\n\nAll numbers are dimensionless, representing reaction-rate units consistent with the CME in discrete time and counts.\n\nYour program should:\n- Implement the SSA with exact propensities $a_{1}(x) = k_{0}$ and $a_{2}(x) = k_{2}\\,\\frac{x(x-1)}{2}$ and state updates $+1$ and $-2$, respectively.\n- Compute time-averaged stationary estimates after the burn-in interval.\n- For each test case, compute the boolean mismatch defined above.\n\nFinal output format:\n- Your program should produce a single line of output containing the three boolean results for Cases A, B, and C, as a comma-separated list enclosed in square brackets, e.g., \"[True,False,True]\".", "solution": "The problem as stated is valid. It is scientifically grounded in the established theory of stochastic chemical kinetics, is well-posed with all necessary parameters provided, and is formulated with objective, unambiguous language. It presents a standard, non-trivial task of comparing an approximate analytical method with an exact numerical simulation. We will now proceed with the solution.\n\nThe objective is to demonstrate numerically that the Poisson moment closure fails to accurately predict the stationary statistics of a non-complex-balanced reaction network. The network consists of two reactions:\n1. Birth: $\\varnothing \\xrightarrow{k_0} X$, with propensity $a_{1}(x) = k_{0}$.\n2. Dimerization removal: $2X \\xrightarrow{k_2} \\varnothing$, with propensity $a_{2}(x) = k_2 \\frac{x(x-1)}{2}$.\n\nWe will follow the prescribed steps: first, derive the exact moment dynamics and the corresponding closed equation under the Poisson approximation; second, implement the Stochastic Simulation Algorithm (SSA) to obtain exact statistics; and finally, compare the results.\n\n**1. Moment Evolution and Poisson Closure**\n\nThe time evolution of the expectation of a function $f(X(t))$ under the Chemical Master Equation (CME) is given by the master-equation-to-moment-equation formula:\n$$\n\\frac{d}{dt}\\mathbb{E}[f(X(t))] = \\sum_{r=1}^{R} \\mathbb{E}[a_r(X(t)) (f(X(t) + \\nu_r) - f(X(t)))]\n$$\nwhere $a_r(x)$ is the propensity of reaction $r$ and $\\nu_r$ is the corresponding stoichiometric change in the copy number of species $X$.\nFor the first moment, we set $f(x) = x$. This simplifies to:\n$$\n\\frac{d}{dt}\\mathbb{E}[X(t)] = \\sum_{r=1}^{R} \\nu_r \\mathbb{E}[a_r(X(t))]\n$$\nFor the given network, we have two reactions with stoichiometric changes $\\nu_1 = +1$ and $\\nu_2 = -2$. Substituting the propensities $a_1(x) = k_0$ and $a_2(x) = k_2 \\frac{x(x-1)}{2}$, we obtain the evolution equation for the mean $\\mathbb{E}[X(t)]$:\n$$\n\\frac{d}{dt}\\mathbb{E}[X(t)] = (+1)\\mathbb{E}[a_1(X(t))] + (-2)\\mathbb{E}[a_2(X(t))]\n$$\n$$\n\\frac{d}{dt}\\mathbb{E}[X(t)] = \\mathbb{E}[k_0] - 2\\mathbb{E}\\left[k_2 \\frac{X(t)(X(t)-1)}{2}\\right]\n$$\nSince $k_0$ and $k_2$ are constants, this becomes:\n$$\n\\frac{d}{dt}\\mathbb{E}[X(t)] = k_0 - k_2 \\mathbb{E}[X(t)(X(t)-1)]\n$$\nThis equation is not closed, as the dynamics of the first moment $\\mathbb{E}[X]$ depend on the second factorial moment $\\mathbb{E}[X(X-1)]$. To close this system, we employ the Poisson moment closure. This closure assumes that the distribution of $X(t)$ is approximately Poisson. For a Poisson-distributed random variable with mean $m$, the second factorial moment is equal to the square of the mean, i.e., $\\mathbb{E}[X(X-1)] = m^2$.\nLet $m(t) = \\mathbb{E}[X(t)]$. Applying the closure approximation, $\\mathbb{E}[X(t)(X(t)-1)] \\approx m(t)^2$, we obtain a closed ordinary differential equation for the mean:\n$$\n\\frac{dm(t)}{dt} \\approx k_0 - k_2 m(t)^2\n$$\nTo find the steady-state mean predicted by this closure, $m_{\\mathrm{pc}}$, we set the derivative to zero:\n$$\n0 = k_0 - k_2 m_{\\mathrm{pc}}^2 \\implies m_{\\mathrm{pc}}^2 = \\frac{k_0}{k_2} \\implies m_{\\mathrm{pc}} = \\sqrt{\\frac{k_0}{k_2}}\n$$\nWe consider only the positive root as copy numbers are non-negative.\nA key property of a Poisson distribution is that its variance equals its mean, meaning the Fano factor $F = \\sigma^2/\\mu$ is exactly $1$. The Poisson closure thus implicitly predicts $F=1$ at steady state.\n\n**2. Stochastic Simulation and Statistical Analysis**\n\nTo find the true stationary statistics, we use the Gillespie Stochastic Simulation Algorithm (SSA), which generates a statistically exact realization of the process described by the CME. The algorithm proceeds as follows:\n- At time $t$ with state $x$, calculate the propensities $a_1 = k_0$ and $a_2 = k_2 x(x-1)/2$.\n- The total propensity is $a_{\\text{total}} = a_1 + a_2$.\n- The time until the next reaction, $\\tau$, is sampled from an exponential distribution with rate $a_{\\text{total}}$, i.e., $\\tau = \\frac{1}{a_{\\text{total}}}\\ln(\\frac{1}{u_1})$ where $u_1 \\sim U(0,1)$. The time is advanced to $t + \\tau$.\n- The reaction to occur is chosen proportionally to its propensity. A second random number $u_2 \\sim U(0,1)$ is drawn. If $u_2 a_{\\text{total}} < a_1$, the birth reaction occurs and the state updates to $x+1$. Otherwise, the dimerization reaction occurs, and the state updates to $x-2$.\n\nThe trajectory $X(t)$ is a piecewise-constant function. To estimate the stationary moments, we perform time-averaging over a long simulation horizon $[T_{\\text{burn}}, T_{\\text{total}}]$, where $T_{\\text{burn}}$ is a burn-in period to allow the system to reach stationarity. The time-averaged mean $\\mu_{\\mathrm{ssa}}$ and second raw moment $\\mathbb{E}[X^2]_{\\mathrm{ssa}}$ are computed as:\n$$\n\\mu_{\\mathrm{ssa}} = \\frac{1}{T_{\\text{total}} - T_{\\text{burn}}} \\int_{T_{\\text{burn}}}^{T_{\\text{total}}} X(t) dt \\quad \\text{and} \\quad \\mathbb{E}[X^2]_{\\mathrm{ssa}} = \\frac{1}{T_{\\text{total}} - T_{\\text{burn}}} \\int_{T_{\\text{burn}}}^{T_{\\text{total}}} X(t)^2 dt\n$$\nThe integrals are calculated by summing the contributions from each time interval between consecutive reactions. If a reaction occurs at time $t_i$ leading to state $x_i$, and the next reaction occurs at $t_{i+1}$, the contribution to the integrals from the interval $[t_i, t_{i+1})$ is calculated, considering only the portion of the interval that falls within $[T_{\\text{burn}}, T_{\\text{total}}]$.\nFrom these estimates, the stationary variance is calculated as $\\sigma_{\\mathrm{ssa}}^2 = \\mathbb{E}[X^2]_{\\mathrm{ssa}} - \\mu_{\\mathrm{ssa}}^2$. The Fano factor is then $F_{\\mathrm{ssa}} = \\sigma_{\\mathrm{ssa}}^2 / \\mu_{\\mathrm{ssa}}$.\n\n**3. Mismatch Criterion**\n\nThe validity of the Poisson closure is tested by checking if the Fano factor is close to $1$. We define a mismatch to occur if the deviation is significant, as per the condition:\n$$\n\\text{mismatch} := \\left| \\frac{\\sigma_{\\mathrm{ssa}}^2}{\\mu_{\\mathrm{ssa}}} - 1 \\right| > \\epsilon\n$$\nwith a given threshold of $\\epsilon = 0.1$. The following Python program implements the SSA and this criterion for the provided test cases. For this particular reaction network, it is a known theoretical result that the stationary distribution is sub-Poissonian, with a Fano factor approaching $3/4$ in the limit of large copy numbers. Therefore, we expect to find a mismatch for all test cases.", "answer": "```python\nimport numpy as np\n\ndef run_ssa_and_check_mismatch(k0, k2, T_total, T_burn, seed, epsilon):\n    \"\"\"\n    Runs the Stochastic Simulation Algorithm (SSA) for the given reaction network\n    and checks for a mismatch with the Poisson closure assumption.\n\n    Args:\n        k0 (float): Rate constant for the birth reaction.\n        k2 (float): Rate constant for the dimerization reaction.\n        T_total (float): Total simulation time.\n        T_burn (float): Burn-in time, statistics are collected after this time.\n        seed (int): Seed for the random number generator.\n        epsilon (float): Threshold for the mismatch criterion.\n\n    Returns:\n        bool: True if the Fano factor deviates from 1 by more than epsilon, False otherwise.\n    \"\"\"\n    rng = np.random.default_rng(seed)\n\n    t = 0.0\n    x = 0  # Initial state: 0 molecules\n\n    # Integrals for time-averaged moments\n    integral_x = 0.0\n    integral_x2 = 0.0\n    \n    while t < T_total:\n        t_old = t\n\n        # Calculate propensities for the current state x\n        a1 = k0\n        a2 = k2 * x * (x - 1) / 2.0 if x >= 2 else 0.0\n        a_total = a1 + a2\n\n        if a_total <= 0:\n            # This case occurs if k0=0 and x<2. With k0>0, it's unreachable.\n            # If it happened, system is stuck. Advance time to end.\n            t = T_total\n        else:\n            # Sample time to next reaction from an exponential distribution\n            u1 = rng.random()\n            tau = -np.log(u1) / a_total\n            t += tau\n\n        # --- Accumulate time-weighted statistics ---\n        # The state was `x` during the interval [t_old, t].\n        # We calculate the overlap of this interval with the measurement window [T_burn, T_total].\n        \n        # Effective start and end of the integration interval\n        t_start_interval = max(t_old, T_burn)\n        t_end_interval = min(t, T_total)\n\n        if t_end_interval > t_start_interval:\n            duration_in_window = t_end_interval - t_start_interval\n            integral_x += x * duration_in_window\n            integral_x2 += (x**2) * duration_in_window\n\n        if t >= T_total:\n            break\n\n        # --- Choose reaction and update state ---\n        u2 = rng.random()\n        if u2 * a_total < a1:\n            # Reaction 1: Birth (x -> x + 1)\n            x += 1\n        else:\n            # Reaction 2: Dimerization (x -> x - 2)\n            x -= 2\n\n    # --- Finalize statistics and check mismatch ---\n    measurement_duration = T_total - T_burn\n    if measurement_duration <= 0:\n        # No measurement window, cannot determine mismatch. Assume False.\n        return False\n        \n    mu_ssa = integral_x / measurement_duration\n    e_x2 = integral_x2 / measurement_duration\n\n    if mu_ssa <= 0:\n        # If mean is zero or negative, Fano factor is ill-defined or system is empty.\n        # This implies a strong deviation from any non-trivial Poisson distribution.\n        # A positive mean is expected. In case it happens, we consider it a mismatch.\n        return True\n        \n    sigma2_ssa = e_x2 - mu_ssa**2\n    fano_factor = sigma2_ssa / mu_ssa\n    \n    mismatch = abs(fano_factor - 1.0) > epsilon\n    return mismatch\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Test suite: (k0, k2, T_total, T_burn, seed)\n    test_cases = [\n        (20, 0.2, 1500, 500, 13),    # Case A: moderate copy numbers\n        (2, 1.0, 1500, 500, 17),    # Case B: low copy numbers\n        (200, 0.2, 1500, 500, 19),   # Case C: higher copy numbers\n    ]\n    \n    epsilon = 0.1\n    results = []\n\n    for k0, k2, T_total, T_burn, seed in test_cases:\n        mismatch_result = run_ssa_and_check_mismatch(k0, k2, T_total, T_burn, seed, epsilon)\n        results.append(mismatch_result)\n\n    # Convert boolean results to strings ('True'/'False') and format output\n    print(f\"[{','.join(map(str, results))}]\")\n\n\n# Execute the solution\nsolve()\n\n```", "id": "2657915"}]}