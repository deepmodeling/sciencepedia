{"hands_on_practices": [{"introduction": "Ground your understanding of light-matter interaction in the fundamental law of energy conservation. This exercise guides you through a first-principles derivation of the scattering ($C_{\\mathrm{sca}}$) and absorption ($C_{\\mathrm{abs}}$) cross-sections for a dipolar particle, culminating in an explicit verification of the optical theorem, $C_{\\mathrm{ext}} = C_{\\mathrm{sca}} + C_{\\mathrm{abs}}$. By working through this problem [@problem_id:2511487], you will clarify the physical meaning of the complex polarizability $\\alpha(\\omega)$ and see how it elegantly encodes all information about how a nanoparticle redistributes and dissipates incident electromagnetic energy.", "problem": "A subwavelength metallic nanosphere embedded in a homogeneous, lossless, nonmagnetic dielectric background of relative permittivity $\\varepsilon_{b}$ is illuminated by a monochromatic plane wave of angular frequency $\\omega$ and complex amplitude $\\mathbf{E}_{0}$. In the electric-dipole limit, the particle responds with an induced dipole moment $\\mathbf{p}(\\omega)$ related to the incident field by $\\mathbf{p}(\\omega)=\\varepsilon_{0}\\varepsilon_{b}\\,\\alpha(\\omega)\\,\\mathbf{E}_{0}$, where $\\alpha(\\omega)$ is the complex polarizability associated with the localized surface plasmon resonance of the nanosphere. The background wavenumber is $k=\\omega\\sqrt{\\mu_{0}\\varepsilon_{0}\\varepsilon_{b}}$, and the background wave impedance is $\\eta=\\sqrt{\\mu_{0}/(\\varepsilon_{0}\\varepsilon_{b})}$. Assume the background is dispersionless and nonabsorbing over the frequency range of interest, and that the nanoparticle is well described by the point-dipole approximation.\n\nStarting from Maxwell’s equations, the far-field of a time-harmonic electric dipole in a homogeneous medium, and the Poynting theorem, derive the scattering cross-section $C_{\\mathrm{sca}}(\\omega)$ and the absorption cross-section $C_{\\mathrm{abs}}(\\omega)$ in terms of $k$ and $\\alpha(\\omega)$. Then, compute the extinction cross-section $C_{\\mathrm{ext}}(\\omega)$ from the time-averaged work done by the incident field on the dipole, and verify that energy conservation holds in the form $C_{\\mathrm{ext}}(\\omega)=C_{\\mathrm{sca}}(\\omega)+C_{\\mathrm{abs}}(\\omega)$ for arbitrary complex $\\alpha(\\omega)$ consistent with a passive particle.\n\nProvide, as your final answer, the simplified analytic expression for the dimensionless ratio\n$$\nR(\\omega)=\\frac{C_{\\mathrm{sca}}(\\omega)+C_{\\mathrm{abs}}(\\omega)}{C_{\\mathrm{ext}}(\\omega)}.\n$$\nExpress the final answer as a single real number or a single closed-form expression with no units. No rounding instruction applies.", "solution": "The problem posed is a self-contained, scientifically grounded exercise in classical electrodynamics applied to nanophotonics. It is well-posed and objective. We shall proceed with the derivation.\n\nThe problem investigates the interaction of a plane wave with a subwavelength metallic nanosphere. In the electric-dipole limit, the particle can be treated as a point dipole with an induced moment $\\mathbf{p}(\\omega)$. The relationship provided, $\\mathbf{p}(\\omega)=\\varepsilon_{0}\\varepsilon_{b}\\,\\alpha(\\omega)\\,\\mathbf{E}_{0}$, defines the polarizability $\\alpha(\\omega)$ with respect to the incident field $\\mathbf{E}_0$, not the local field. This implies that $\\alpha(\\omega)$ is a radiation-corrected or \"dressed\" polarizability.\n\nFirst, we derive the scattering cross-section, $C_{\\mathrm{sca}}(\\omega)$. A time-harmonic electric dipole $\\mathbf{p}$ oscillating at frequency $\\omega$ in a medium with permittivity $\\varepsilon = \\varepsilon_0 \\varepsilon_b$ and permeability $\\mu = \\mu_0$ radiates an electromagnetic field. In the far-field zone ($r \\gg \\lambda$), the scattered electric field $\\mathbf{E}_{\\mathrm{sca}}$ is given by:\n$$\n\\mathbf{E}_{\\mathrm{sca}}(\\mathbf{r}) = \\frac{k^2}{4\\pi\\varepsilon_{0}\\varepsilon_{b}} \\frac{\\exp(ikr)}{r} (\\hat{\\mathbf{r}} \\times \\mathbf{p}) \\times \\hat{\\mathbf{r}}\n$$\nwhere $k$ is the wavenumber in the background medium, and $\\hat{\\mathbf{r}}$ is the unit vector in the direction of observation. The corresponding magnetic field is $\\mathbf{H}_{\\mathrm{sca}} = \\frac{1}{\\eta} \\hat{\\mathbf{r}} \\times \\mathbf{E}_{\\mathrm{sca}}$, where $\\eta$ is the wave impedance of the medium.\n\nThe time-averaged power radiated per unit solid angle is $\\frac{d P_{\\mathrm{sca}}}{d\\Omega} = \\frac{r^2}{2} \\mathrm{Re}[\\mathbf{E}_{\\mathrm{sca}} \\times \\mathbf{H}_{\\mathrm{sca}}^*] \\cdot \\hat{\\mathbf{r}} = \\frac{r^2}{2\\eta} |\\mathbf{E}_{\\mathrm{sca}}|^2$.\n$$\n|\\mathbf{E}_{\\mathrm{sca}}|^2 = \\left(\\frac{k^2}{4\\pi\\varepsilon_{0}\\varepsilon_{b}r}\\right)^2 |(\\hat{\\mathbf{r}} \\times \\mathbf{p}) \\times \\hat{\\mathbf{r}}|^2 = \\left(\\frac{k^2}{4\\pi\\varepsilon_{0}\\varepsilon_{b}r}\\right)^2 |\\mathbf{p}|^2 \\sin^2\\theta\n$$\nwhere $\\theta$ is the angle between $\\mathbf{p}$ and $\\hat{\\mathbf{r}}$. The total scattered power $P_{\\mathrm{sca}}$ is obtained by integrating over all solid angles:\n$$\nP_{\\mathrm{sca}} = \\int_{\\Omega} \\frac{d P_{\\mathrm{sca}}}{d\\Omega} d\\Omega = \\frac{1}{2\\eta} \\left(\\frac{k^2}{4\\pi\\varepsilon_{0}\\varepsilon_{b}}\\right)^2 |\\mathbf{p}|^2 \\int_0^{2\\pi} \\int_0^\\pi \\sin^3\\theta \\, d\\theta \\, d\\phi\n$$\nThe integral evaluates to $8\\pi/3$.\n$$\nP_{\\mathrm{sca}} = \\frac{1}{2\\eta} \\left(\\frac{k^4 |\\mathbf{p}|^2}{16\\pi^2\\varepsilon_{0}^2\\varepsilon_{b}^2}\\right) \\frac{8\\pi}{3} = \\frac{k^4 |\\mathbf{p}|^2}{12\\pi\\eta\\varepsilon_{0}^2\\varepsilon_{b}^2}\n$$\nThe scattering cross-section is defined as $C_{\\mathrm{sca}} = P_{\\mathrm{sca}}/I_{\\mathrm{inc}}$, where the incident intensity is $I_{\\mathrm{inc}} = \\frac{1}{2\\eta}|\\mathbf{E}_{0}|^2$. Substituting $\\mathbf{p}=\\varepsilon_{0}\\varepsilon_{b}\\,\\alpha(\\omega)\\,\\mathbf{E}_{0}$:\n$$\nC_{\\mathrm{sca}}(\\omega) = \\frac{k^4 |\\varepsilon_{0}\\varepsilon_{b}\\alpha(\\omega)\\mathbf{E}_{0}|^2}{12\\pi\\eta\\varepsilon_{0}^2\\varepsilon_{b}^2} \\frac{2\\eta}{|\\mathbf{E}_{0}|^2} = \\frac{k^4 |\\alpha(\\omega)|^2}{6\\pi}\n$$\n\nNext, we derive the absorption cross-section, $C_{\\mathrm{abs}}(\\omega)$. The time-averaged absorbed power $P_{\\mathrm{abs}}$ is the work done by the total local field $\\mathbf{E}_{\\mathrm{loc}}$ on the induced current, which is dissipated as heat. For a point dipole, this is $P_{\\mathrm{abs}} = \\frac{\\omega}{2} \\mathrm{Im}[\\mathbf{p}^* \\cdot \\mathbf{E}_{\\mathrm{loc}}]$. It is crucial to use the total local field acting on the dipole, which is the sum of the incident field and the dipole's own self-field (radiation reaction):\n$$\n\\mathbf{E}_{\\mathrm{loc}} = \\mathbf{E}_{\\mathrm{inc}} + \\mathbf{E}_{\\mathrm{self}} = \\mathbf{E}_{0} + \\frac{i k^3}{6\\pi\\varepsilon_{0}\\varepsilon_{b}}\\mathbf{p}\n$$\nThe correct expression for absorbed power is $P_{\\mathrm{abs}} = \\frac{1}{2}\\mathrm{Re}\\int \\mathbf{J}^*\\cdot\\mathbf{E}_{\\mathrm{loc}}\\,dV$. With $\\mathbf{J}=-i\\omega\\mathbf{p}$, this is $P_{\\mathrm{abs}} = \\frac{1}{2}\\mathrm{Re}[(i\\omega\\mathbf{p}^*)\\cdot\\mathbf{E}_{\\mathrm{loc}}] = \\frac{\\omega}{2}\\mathrm{Re}[i\\mathbf{p}^*\\cdot\\mathbf{E}_{\\mathrm{loc}}]$.\nLet's rework this step:\n$P_{\\mathrm{abs}} = \\frac{\\omega}{2}\\mathrm{Re}\\left[i\\mathbf{p}^*\\cdot\\left(\\mathbf{E}_{0} + \\frac{i k^3}{6\\pi\\varepsilon_{0}\\varepsilon_{b}}\\mathbf{p}\\right)\\right] = \\frac{\\omega}{2}\\mathrm{Re}[i\\mathbf{p}^*\\cdot\\mathbf{E}_0] - \\frac{\\omega k^3|\\mathbf{p}|^2}{12\\pi\\varepsilon_0\\varepsilon_b}$.\nUsing $\\mathbf{E}_0 = \\mathbf{p}/(\\varepsilon_0\\varepsilon_b\\alpha)$:\n$P_{\\mathrm{abs}} = \\frac{\\omega}{2}\\mathrm{Re}\\left[\\frac{i|\\mathbf{p}|^2}{\\varepsilon_0\\varepsilon_b\\alpha}\\right] - \\frac{\\omega k^3|\\mathbf{p}|^2}{12\\pi\\varepsilon_0\\varepsilon_b} = \\frac{\\omega|\\mathbf{p}|^2}{2\\varepsilon_0\\varepsilon_b}\\left( \\mathrm{Re}[i/\\alpha] - \\frac{k^3}{6\\pi} \\right)$.\nWith $1/\\alpha = (\\alpha' - i\\alpha'')/|\\alpha|^2$, we have $i/\\alpha = (i\\alpha'+\\alpha'')/|\\alpha|^2$. Thus, $\\mathrm{Re}[i/\\alpha] = \\alpha''/|\\alpha|^2 = \\mathrm{Im}[\\alpha]/|\\alpha|^2$.\n$P_{\\mathrm{abs}} = \\frac{\\omega|\\mathbf{p}|^2}{2\\varepsilon_0\\varepsilon_b}\\left( \\frac{\\mathrm{Im}[\\alpha]}{|\\alpha|^2} - \\frac{k^3}{6\\pi} \\right)$.\nConverting to cross-section gives:\n$C_{\\mathrm{abs}}(\\omega) = k|\\alpha|^2\\left(\\frac{\\mathrm{Im}[\\alpha]}{|\\alpha|^2} - \\frac{k^3}{6\\pi}\\right) = k\\,\\mathrm{Im}[\\alpha] - \\frac{k^4}{6\\pi}|\\alpha|^2$.\nThis derivation is correct.\n\nNow we compute the extinction cross-section $C_{\\mathrm{ext}}(\\omega)$. Extinction refers to the total power removed from the incident beam due to both scattering and absorption. This is given by the optical theorem, which relates the extinction cross-section to the imaginary part of the forward scattering amplitude. The hint to use the \"time-averaged work done by the incident field on the dipole\" is the physical basis of the optical theorem. The extinction power is:\n$$\nP_{\\mathrm{ext}} = \\frac{\\omega}{2}\\mathrm{Im}[\\mathbf{E}_{0}^* \\cdot \\mathbf{p}]\n$$\nSubstituting $\\mathbf{p}=\\varepsilon_{0}\\varepsilon_{b}\\,\\alpha(\\omega)\\,\\mathbf{E}_{0}$:\n$$\nP_{\\mathrm{ext}} = \\frac{\\omega}{2}\\mathrm{Im}[\\mathbf{E}_{0}^* \\cdot \\varepsilon_{0}\\varepsilon_{b}\\alpha(\\omega)\\mathbf{E}_{0}] = \\frac{\\omega\\varepsilon_{0}\\varepsilon_{b}}{2}|\\mathbf{E}_{0}|^2 \\mathrm{Im}[\\alpha]\n$$\n$$\nC_{\\mathrm{ext}}(\\omega) = \\frac{P_{\\mathrm{ext}}}{I_{\\mathrm{inc}}} = \\frac{\\frac{\\omega\\varepsilon_{0}\\varepsilon_{b}}{2}|\\mathbf{E}_{0}|^2 \\mathrm{Im}[\\alpha]}{\\frac{1}{2\\eta}|\\mathbf{E}_{0}|^2} = \\omega\\eta\\varepsilon_0\\varepsilon_b \\mathrm{Im}[\\alpha] = k\\,\\mathrm{Im}[\\alpha(\\omega)]\n$$\nThe passivity condition requires $P_{\\mathrm{abs}} \\ge 0$. From our expression for $C_{\\mathrm{abs}}$, this physically means $k\\,\\mathrm{Im}[\\alpha] \\ge \\frac{k^4}{6\\pi}|\\alpha|^2$. This also ensures $C_{\\mathrm{ext}} \\ge C_{\\mathrm{sca}}$.\n\nFinally, we verify energy conservation by checking if $C_{\\mathrm{ext}}(\\omega) = C_{\\mathrm{sca}}(\\omega) + C_{\\mathrm{abs}}(\\omega)$.\n$$\nC_{\\mathrm{sca}}(\\omega) + C_{\\mathrm{abs}}(\\omega) = \\left(\\frac{k^4}{6\\pi}|\\alpha|^2\\right) + \\left(k\\,\\mathrm{Im}[\\alpha] - \\frac{k^4}{6\\pi}|\\alpha|^2\\right) = k\\,\\mathrm{Im}[\\alpha]\n$$\nThis is precisely the expression for $C_{\\mathrm{ext}}(\\omega)$.\n$$\nC_{\\mathrm{sca}}(\\omega) + C_{\\mathrm{abs}}(\\omega) = C_{\\mathrm{ext}}(\\omega)\n$$\nThe energy conservation principle is thus verified for any complex polarizability $\\alpha(\\omega)$ consistent with our physical model.\n\nThe problem asks for the ratio:\n$$\nR(\\omega) = \\frac{C_{\\mathrm{sca}}(\\omega)+C_{\\mathrm{abs}}(\\omega)}{C_{\\mathrm{ext}}(\\omega)}\n$$\nFrom our verified identity, the numerator is identical to the denominator, assuming $C_{\\mathrm{ext}}(\\omega) \\neq 0$.\n$$\nR(\\omega) = \\frac{C_{\\mathrm{ext}}(\\omega)}{C_{\\mathrm{ext}}(\\omega)} = 1\n$$\nThis result is a direct consequence of the conservation of energy, which is fundamental.", "answer": "$$ \\boxed{1} $$", "id": "2511487"}, {"introduction": "Having established the general relationship between cross-sections, we now investigate how the intrinsic properties of a metal shape its plasmon resonance. This practice applies the Drude model for the metal's complex dielectric function $\\varepsilon(\\omega)$ to predict the observable features of a localized surface plasmon resonance (LSPR) in the quasi-static limit. You will derive the analytical relationship between the microscopic electron scattering rate $\\gamma$ and the macroscopic resonance position and linewidth, gaining direct insight into how material losses govern the quality factor of a plasmonic resonator [@problem_id:2511414].", "problem": "A spherical gold nanoparticle of radius $a$ is embedded in a homogeneous, dispersionless dielectric medium of relative permittivity $\\varepsilon_{d}$. Assume the particle is much smaller than the free-space wavelength at its Localized Surface Plasmon Resonance (LSPR), so that the electrostatic approximation applies. The complex, frequency-dependent dielectric function of the metal is described by the Drude model\n$$\n\\varepsilon(\\omega)=\\varepsilon_{\\infty}-\\frac{\\omega_{p}^{2}}{\\omega^{2}+i\\gamma\\,\\omega},\n$$\nwhere $\\varepsilon_{\\infty}$ is the high-frequency permittivity, $\\omega_{p}$ is the bulk plasma frequency, and $\\gamma$ is the phenomenological electron scattering (damping) rate. The electrostatic polarizability of a small sphere is\n$$\n\\alpha(\\omega)=4\\pi a^{3}\\,\\frac{\\varepsilon(\\omega)-\\varepsilon_{d}}{\\varepsilon(\\omega)+2\\varepsilon_{d}}.\n$$\nNeglect interband transitions and radiative damping.\n\n1) Starting from the above, show how finite damping $\\,\\gamma\\,$ simultaneously red-shifts the LSPR and broadens its linewidth. In particular, derive an explicit expression for the LSPR angular frequency $\\,\\omega_{\\mathrm{res}}\\,$ in terms of $\\,\\varepsilon_{\\infty}$, $\\,\\omega_{p}$, $\\,\\varepsilon_{d}$, and $\\,\\gamma\\,$ by using the resonance condition that maximizes absorption, and obtain the small-$\\gamma$ expression for the half-width at half-maximum $\\,\\Gamma_{\\mathrm{eff}}\\,$ of the absorption lineshape of $\\,\\operatorname{Im}\\alpha(\\omega)\\,$.\n\n2) The quality factor is defined here by $\\,Q=\\omega_{0}/(2\\Gamma)\\,$ for a damped oscillator. Map this definition to the LSPR you analyzed in part (1) and express $Q$ in terms of $\\,\\omega_{\\mathrm{res}}\\,$ and $\\,\\gamma\\,$ in the small-$\\gamma$ limit.\n\n3) Using the parameters $\\,\\omega_{p}=1.37\\times 10^{16}\\,\\mathrm{s}^{-1}$, $\\,\\varepsilon_{\\infty}=9.5$, and $\\,\\varepsilon_{d}=2.25\\,$ (corresponding to refractive index $n=\\sqrt{\\varepsilon_{d}}=1.5$), evaluate the ratio of quality factors $\\,Q_{2}/Q_{1}\\,$ when the damping rate increases from $\\,\\gamma_{1}=0.90\\times 10^{14}\\,\\mathrm{s}^{-1}\\,$ to $\\,\\gamma_{2}=1.50\\times 10^{14}\\,\\mathrm{s}^{-1}\\,$. Use your expressions from parts (1)–(2), keeping the leading correction due to the red-shift in $\\,\\omega_{\\mathrm{res}}\\,$ that depends on $\\,\\gamma\\,$. Round your final answer to four significant figures. Express your final answer as a dimensionless decimal (no units).", "solution": "The problem statement will first be validated for scientific soundness, self-consistency, and clarity.\n\nGivens are extracted verbatim:\n- A spherical gold nanoparticle of radius $a$.\n- A surrounding medium with relative permittivity $\\varepsilon_{d}$.\n- The condition $a \\ll \\lambda_{\\mathrm{LSPR}}$, justifying the electrostatic approximation.\n- The Drude model for the complex dielectric function of the metal: $\\varepsilon(\\omega)=\\varepsilon_{\\infty}-\\frac{\\omega_{p}^{2}}{\\omega^{2}+i\\gamma\\,\\omega}$.\n- The electrostatic polarizability of the sphere: $\\alpha(\\omega)=4\\pi a^{3}\\,\\frac{\\varepsilon(\\omega)-\\varepsilon_{d}}{\\varepsilon(\\omega)+2\\varepsilon_{d}}$.\n- Interband transitions and radiative damping are to be neglected.\n- The resonance condition is defined by the maximization of absorption.\n- The quality factor is defined as $Q=\\omega_{0}/(2\\Gamma)$, where $\\omega_0$ is the resonance frequency and $\\Gamma$ is the half-width at half-maximum.\n- Numerical values for evaluation: $\\omega_{p}=1.37\\times 10^{16}\\,\\mathrm{s}^{-1}$, $\\varepsilon_{\\infty}=9.5$, $\\varepsilon_{d}=2.25$, $\\gamma_{1}=0.90\\times 10^{14}\\,\\mathrm{s}^{-1}$, and $\\gamma_{2}=1.50\\times 10^{14}\\,\\mathrm{s}^{-1}$.\n\nValidation:\nThe problem is scientifically grounded, utilizing the standard Drude model and the quasi-static approximation (Mie theory for small spheres), which are cornerstone principles in the study of plasmonics. It is well-posed, providing all necessary information and definitions to logically derive the requested quantities and perform the final calculation. The language is objective and precise. The numerical values provided are physically realistic for gold nanoparticles in a typical dielectric host like silica or a polymer. The problem is not trivial, as it requires a correct understanding of resonance phenomena, approximation methods, and careful algebraic manipulation, particularly in retaining the $\\gamma$-dependent correction for the final calculation. The problem is therefore deemed valid.\n\nWe now proceed with the solution.\n\nThe polarizability is given by $\\alpha(\\omega)=4\\pi a^{3}\\,\\frac{\\varepsilon(\\omega)-\\varepsilon_{d}}{\\varepsilon(\\omega)+2\\varepsilon_{d}}$. The absorption cross-section is proportional to $\\omega \\operatorname{Im}[\\alpha(\\omega)]$. The problem asks to find the resonance by maximizing the absorption lineshape of $\\operatorname{Im}[\\alpha(\\omega)]$. Let us first find an expression for $\\operatorname{Im}[\\alpha(\\omega)]$.\nLet the complex dielectric function be $\\varepsilon(\\omega) = \\varepsilon'(\\omega) + i\\varepsilon''(\\omega)$. Substituting this into the polarizability expression:\n$$ \\alpha(\\omega) = 4\\pi a^{3} \\frac{(\\varepsilon'(\\omega)-\\varepsilon_{d}) + i\\varepsilon''(\\omega)}{(\\varepsilon'(\\omega)+2\\varepsilon_{d}) + i\\varepsilon''(\\omega)} $$\nThe imaginary part is found by multiplying the numerator and denominator by the complex conjugate of the denominator:\n$$ \\operatorname{Im}[\\alpha(\\omega)] = 4\\pi a^{3} \\operatorname{Im}\\left[ \\frac{\\left( (\\varepsilon'-\\varepsilon_{d}) + i\\varepsilon'' \\right) \\left( (\\varepsilon'+2\\varepsilon_{d}) - i\\varepsilon'' \\right)}{\\left( \\varepsilon'+2\\varepsilon_{d} \\right)^2 + (\\varepsilon'')^2} \\right] $$\n$$ \\operatorname{Im}[\\alpha(\\omega)] = 4\\pi a^{3} \\frac{\\varepsilon''(\\varepsilon'+2\\varepsilon_{d}) - (-\\varepsilon'')(\\varepsilon'-\\varepsilon_{d})}{(\\varepsilon'(\\omega)+2\\varepsilon_{d})^2 + (\\varepsilon''(\\omega))^2} = 4\\pi a^{3} \\frac{3\\varepsilon_{d}\\varepsilon''(\\omega)}{(\\varepsilon'(\\omega)+2\\varepsilon_{d})^2 + (\\varepsilon''(\\omega))^2} $$\nThe Localized Surface Plasmon Resonance (LSPR) is characterized by a strong enhancement of the local field, which occurs when the denominator of the polarizability approaches zero. Specifically, the resonance frequency $\\omega_{\\mathrm{res}}$ is determined by the condition that minimizes the term $(\\varepsilon'(\\omega)+2\\varepsilon_{d})^2$. This corresponds to the Fröhlich condition, $\\varepsilon'(\\omega_{\\mathrm{res}})+2\\varepsilon_{d} = 0$. This condition accurately approximates the peak of the absorption for small damping $\\gamma$.\n\n1) Derivation of $\\omega_{\\mathrm{res}}$ and $\\Gamma_{\\mathrm{eff}}$:\nFrom the Drude model, the real part of the dielectric function is $\\varepsilon'(\\omega) = \\varepsilon_{\\infty} - \\frac{\\omega_{p}^{2}}{\\omega^{2}+\\gamma^{2}}$.\nApplying the resonance condition $\\varepsilon'(\\omega_{\\mathrm{res}})+2\\varepsilon_{d} = 0$:\n$$ \\varepsilon_{\\infty} - \\frac{\\omega_{p}^{2}}{\\omega_{\\mathrm{res}}^{2}+\\gamma^{2}} + 2\\varepsilon_{d} = 0 $$\n$$ \\frac{\\omega_{p}^{2}}{\\omega_{\\mathrm{res}}^{2}+\\gamma^{2}} = \\varepsilon_{\\infty} + 2\\varepsilon_{d} $$\n$$ \\omega_{\\mathrm{res}}^{2}+\\gamma^{2} = \\frac{\\omega_{p}^{2}}{\\varepsilon_{\\infty} + 2\\varepsilon_{d}} $$\nSolving for $\\omega_{\\mathrm{res}}$, we obtain:\n$$ \\omega_{\\mathrm{res}} = \\sqrt{\\frac{\\omega_{p}^{2}}{\\varepsilon_{\\infty} + 2\\varepsilon_{d}} - \\gamma^{2}} $$\nThis expression demonstrates that as the damping $\\gamma$ increases from $0$, the resonance frequency $\\omega_{\\mathrm{res}}$ decreases. This is the phenomenon of red-shifting.\n\nTo find the linewidth, we analyze the lineshape $\\operatorname{Im}[\\alpha(\\omega)]$ near resonance, assuming small $\\gamma$. Let $\\omega_0^2 = \\frac{\\omega_p^2}{\\varepsilon_{\\infty}+2\\varepsilon_d}$, the resonance frequency for $\\gamma=0$. For $\\omega \\approx \\omega_{\\mathrm{res}} \\approx \\omega_0$, we can approximate the terms in the expression for $\\operatorname{Im}[\\alpha(\\omega)]$.\nWe perform a Taylor expansion of $\\varepsilon'(\\omega)+2\\varepsilon_d$ around $\\omega_{\\mathrm{res}}$:\n$$ \\varepsilon'(\\omega)+2\\varepsilon_d \\approx (\\omega-\\omega_{\\mathrm{res}}) \\left. \\frac{d\\varepsilon'}{d\\omega} \\right|_{\\omega_{\\mathrm{res}}} $$\n$$ \\frac{d\\varepsilon'}{d\\omega} = \\frac{2\\omega\\omega_p^2}{(\\omega^2+\\gamma^2)^2} \\approx \\frac{2\\omega_{\\mathrm{res}}(\\varepsilon_{\\infty}+2\\varepsilon_d)^2}{\\omega_p^2} \\approx \\frac{2\\omega_0(\\varepsilon_{\\infty}+2\\varepsilon_d)}{\\omega_0^2} = \\frac{2(\\varepsilon_{\\infty}+2\\varepsilon_d)}{\\omega_0} $$\nThe imaginary part $\\varepsilon''(\\omega) = \\frac{\\omega_p^2\\gamma}{\\omega(\\omega^2+\\gamma^2)}$ near resonance is approximately constant:\n$$ \\varepsilon''(\\omega_{\\mathrm{res}}) = \\frac{\\omega_p^2\\gamma}{\\omega_{\\mathrm{res}}(\\omega_{\\mathrm{res}}^2+\\gamma^2)} = \\frac{\\omega_p^2\\gamma}{\\omega_{\\mathrm{res}}\\left(\\frac{\\omega_p^2}{\\varepsilon_{\\infty}+2\\varepsilon_d}\\right)} = \\frac{\\gamma(\\varepsilon_{\\infty}+2\\varepsilon_d)}{\\omega_{\\mathrm{res}}} \\approx \\frac{\\gamma(\\varepsilon_{\\infty}+2\\varepsilon_d)}{\\omega_0} $$\nSubstituting these approximations into the expression for $\\operatorname{Im}[\\alpha(\\omega)]$:\n$$ \\operatorname{Im}[\\alpha(\\omega)] \\propto \\frac{\\varepsilon''(\\omega_{\\mathrm{res}})}{\\left( (\\omega-\\omega_{\\mathrm{res}})\\frac{2(\\varepsilon_{\\infty}+2\\varepsilon_d)}{\\omega_0} \\right)^2 + (\\varepsilon''(\\omega_{\\mathrm{res}}))^2} \\propto \\frac{1}{(\\omega-\\omega_{\\mathrm{res}})^2 + (\\frac{\\gamma}{2})^2} $$\nThis is a Lorentzian lineshape centered at $\\omega_{\\mathrm{res}}$. The half-width at half-maximum (HWHM), denoted $\\Gamma_{\\mathrm{eff}}$, is the value of $|\\omega-\\omega_{\\mathrm{res}}|$ where the function drops to half its maximum value. From the denominator, this occurs when $(\\omega-\\omega_{\\mathrm{res}})^2 = (\\gamma/2)^2$. Thus, the HWHM is:\n$$ \\Gamma_{\\mathrm{eff}} = \\frac{\\gamma}{2} $$\nThe full width at half-maximum (FWHM) of the resonance peak is $2\\Gamma_{\\mathrm{eff}} = \\gamma$. This directly shows that the linewidth broadens as $\\gamma$ increases.\n\n2) Quality Factor $Q$:\nThe problem defines the quality factor as $Q = \\omega_0 / (2\\Gamma)$, where $\\omega_0$ is the resonance frequency and $\\Gamma$ is the HWHM. We map this definition to our LSPR system. The resonance frequency is $\\omega_{\\mathrm{res}}$, and the HWHM is $\\Gamma_{\\mathrm{eff}} = \\gamma/2$.\n$$ Q = \\frac{\\omega_{\\mathrm{res}}}{2\\Gamma_{\\mathrm{eff}}} = \\frac{\\omega_{\\mathrm{res}}}{2(\\gamma/2)} = \\frac{\\omega_{\\mathrm{res}}}{\\gamma} $$\nThis is the expression for the quality factor in the small-$\\gamma$ limit, where the Lorentzian approximation is valid.\n\n3) Numerical Evaluation of $Q_2/Q_1$:\nWe are required to use the full expression for $\\omega_{\\mathrm{res}}$ to keep the leading correction due to $\\gamma$.\nThe quality factor for a given damping $\\gamma_i$ is $Q_i = \\frac{\\omega_{\\mathrm{res},i}}{\\gamma_i}$.\n$$ Q_i = \\frac{1}{\\gamma_i} \\sqrt{\\frac{\\omega_p^2}{\\varepsilon_{\\infty} + 2\\varepsilon_d} - \\gamma_i^2} $$\nWe need to calculate the ratio $Q_2/Q_1$:\n$$ \\frac{Q_2}{Q_1} = \\frac{\\frac{1}{\\gamma_2} \\sqrt{\\frac{\\omega_p^2}{\\varepsilon_{\\infty} + 2\\varepsilon_d} - \\gamma_2^2}}{\\frac{1}{\\gamma_1} \\sqrt{\\frac{\\omega_p^2}{\\varepsilon_{\\infty} + 2\\varepsilon_d} - \\gamma_1^2}} = \\frac{\\gamma_1}{\\gamma_2} \\sqrt{\\frac{\\frac{\\omega_p^2}{\\varepsilon_{\\infty} + 2\\varepsilon_d} - \\gamma_2^2}{\\frac{\\omega_p^2}{\\varepsilon_{\\infty} + 2\\varepsilon_d} - \\gamma_1^2}} $$\nLet's define the undamped resonance frequency squared as $\\omega_0^2 = \\frac{\\omega_p^2}{\\varepsilon_{\\infty} + 2\\varepsilon_d}$. The ratio becomes:\n$$ \\frac{Q_2}{Q_1} = \\frac{\\gamma_1}{\\gamma_2} \\sqrt{\\frac{\\omega_0^2 - \\gamma_2^2}{\\omega_0^2 - \\gamma_1^2}} $$\nNow, we substitute the given numerical values:\n$\\omega_{p}=1.37\\times 10^{16}\\,\\mathrm{s}^{-1}$\n$\\varepsilon_{\\infty}=9.5$\n$\\varepsilon_{d}=2.25$\n$\\gamma_{1}=0.90\\times 10^{14}\\,\\mathrm{s}^{-1}$\n$\\gamma_{2}=1.50\\times 10^{14}\\,\\mathrm{s}^{-1}$\n\nFirst, calculate $\\omega_0^2$:\n$$ \\varepsilon_{\\infty} + 2\\varepsilon_{d} = 9.5 + 2(2.25) = 9.5 + 4.5 = 14.0 $$\n$$ \\omega_0^2 = \\frac{(1.37 \\times 10^{16}\\,\\mathrm{s}^{-1})^2}{14.0} = \\frac{1.8769 \\times 10^{32}\\,\\mathrm{s}^{-2}}{14.0} \\approx 1.34064 \\times 10^{31}\\,\\mathrm{s}^{-2} $$\nNext, calculate $\\gamma_1^2$ and $\\gamma_2^2$:\n$$ \\gamma_1^2 = (0.90 \\times 10^{14}\\,\\mathrm{s}^{-1})^2 = 0.81 \\times 10^{28}\\,\\mathrm{s}^{-2} = 0.00081 \\times 10^{31}\\,\\mathrm{s}^{-2} $$\n$$ \\gamma_2^2 = (1.50 \\times 10^{14}\\,\\mathrm{s}^{-1})^2 = 2.25 \\times 10^{28}\\,\\mathrm{s}^{-2} = 0.00225 \\times 10^{31}\\,\\mathrm{s}^{-2} $$\nNow, compute the terms in the square root:\n$$ \\omega_0^2 - \\gamma_1^2 \\approx (1.34064 - 0.00081) \\times 10^{31}\\,\\mathrm{s}^{-2} = 1.33983 \\times 10^{31}\\,\\mathrm{s}^{-2} $$\n$$ \\omega_0^2 - \\gamma_2^2 \\approx (1.34064 - 0.00225) \\times 10^{31}\\,\\mathrm{s}^{-2} = 1.33839 \\times 10^{31}\\,\\mathrm{s}^{-2} $$\nThe ratio inside the square root is:\n$$ \\frac{\\omega_0^2 - \\gamma_2^2}{\\omega_0^2 - \\gamma_1^2} \\approx \\frac{1.33839 \\times 10^{31}}{1.33983 \\times 10^{31}} \\approx 0.998925 $$\nThe square root of this value is:\n$$ \\sqrt{0.998925} \\approx 0.999462 $$\nThe pre-factor is:\n$$ \\frac{\\gamma_1}{\\gamma_2} = \\frac{0.90 \\times 10^{14}}{1.50 \\times 10^{14}} = 0.6 $$\nFinally, the ratio of quality factors is:\n$$ \\frac{Q_2}{Q_1} \\approx 0.6 \\times 0.999462 \\approx 0.599677 $$\nRounding to four significant figures, we get $0.5997$.", "answer": "$$\n\\boxed{0.5997}\n$$", "id": "2511414"}, {"introduction": "To move beyond approximations and rigorously model nanoparticles, we turn to the exact analytical solution for a sphere, known as Mie theory. This coding practice challenges you to implement the full Mie series solution, which sums over electric and magnetic multipole contributions to calculate the scattering efficiency. By comparing your exact solution to a truncated series, you will simulate how the finite resolution of a numerical solver affects accuracy, providing a deep, practical understanding of convergence and the physical meaning of higher-order multipoles [@problem_id:2511441]; this is an essential skill for validating computational results in nanophotonics.", "problem": "You are to write a complete, runnable program that validates a numerical solver for light scattering by a metallic sphere by reproducing the exact Mie scattering result and quantifying convergence versus an angular-harmonic truncation that plays the role of a mesh refinement. The physical system is a single homogeneous, isotropic, nonmagnetic metallic sphere of radius $a$ embedded in vacuum, illuminated by a monochromatic plane electromagnetic wave of free-space wavelength $\\lambda$ propagating in vacuum. The sphere is described by a Drude dielectric function with no interband terms. The task is to compute the scattering efficiency spectrum using two approaches: a high-accuracy reference solution and a truncated angular-momentum solution that mimics a mesh-limited numerical solver, then to quantify convergence of the latter toward the former as the truncation level is increased.\n\nFundamental base and definitions to be used:\n- Start from Maxwell’s equations in frequency domain with constitutive relations $\\mathbf{D} = \\varepsilon_{0} \\varepsilon(\\omega) \\mathbf{E}$ and $\\mathbf{B} = \\mu_{0} \\mathbf{H}$, where the relative permittivity of the metal is $\\varepsilon(\\omega)$ and the permeability is unity. \n- For the metal, use the Drude model $\\varepsilon(\\omega) = \\varepsilon_{\\infty} - \\dfrac{\\omega_{p}^{2}}{\\omega^{2} + i \\gamma \\omega}$, with $\\varepsilon_{\\infty}$, $\\omega_{p}$, and $\\gamma$ material parameters. In practice, treat energies in electronvolts by replacing $\\hbar \\omega \\mapsto E$ in electronvolts, so that\n$$\n\\varepsilon(E) = \\varepsilon_{\\infty} - \\frac{\\Omega_{p}^{2}}{E^{2} + i \\Gamma E},\n$$\nwhere $\\Omega_{p}$ and $\\Gamma$ are $\\hbar \\omega_{p}$ and $\\hbar \\gamma$ expressed in electronvolts, respectively, and $E = \\dfrac{hc}{\\lambda}$ in electronvolts with $\\lambda$ in nanometers and $hc \\approx 1239.841984\\,\\mathrm{eV\\,nm}$. The surrounding medium is vacuum with relative permittivity equal to $1$. Define the complex refractive index $m(E) = \\sqrt{\\varepsilon(E)}$.\n- The exact solution (Mie theory) expands the fields in vector spherical harmonics with angular momentum index $n \\in \\mathbb{N}$. The scattering efficiency $Q_{\\mathrm{sca}}(\\lambda)$ is obtained from the multipole coefficients. You must derive the working expressions you will code from the boundary-value problem implied by Maxwell’s equations and the electromagnetic boundary conditions at the spherical interface.\n\nNumerical validation and convergence task:\n- Implement a high-accuracy “reference” calculation of $Q_{\\mathrm{sca}}(\\lambda)$ using a sufficiently large angular truncation $n_{\\max}(\\lambda)$ to achieve convergence across the spectrum. \n- Implement a “mesh-limited” calculation that truncates the multipole expansion at a prescribed maximum angular order $L$ (with $L \\in \\mathbb{N}$), mimicking limited angular resolution. \n- For each test, compare the mesh-limited spectrum to the reference by computing:\n  1. The root-mean-square spectral error\n  $$\n  \\mathrm{RMS} = \\sqrt{\\frac{1}{N_{\\lambda}} \\sum_{j=1}^{N_{\\lambda}} \\left( Q^{(L)}_{\\mathrm{sca}}(\\lambda_{j}) - Q^{\\mathrm{ref}}_{\\mathrm{sca}}(\\lambda_{j}) \\right)^{2}},\n  $$\n  where $\\{ \\lambda_{j} \\}_{j=1}^{N_{\\lambda}}$ is the wavelength grid.\n  2. The signed error in the resonance wavelength (in nanometers) defined as the location of the global maximum of $Q_{\\mathrm{sca}}(\\lambda)$ within the specified range,\n  $$\n  \\Delta \\lambda_{\\mathrm{peak}} = \\lambda_{\\mathrm{peak}}^{(L)} - \\lambda_{\\mathrm{peak}}^{\\mathrm{ref}}.\n  $$\n- Use the size parameter $x(\\lambda) = \\dfrac{2\\pi a}{\\lambda}$ with $a$ and $\\lambda$ both in nanometers. The scattering efficiency is dimensionless. The resonance wavelength error must be reported in nanometers.\n\nTest suite and parameter coverage:\n- Physical constants and units: Use wavelengths $\\lambda$ in nanometers, energies $E$ in electronvolts, and scattering efficiency $Q_{\\mathrm{sca}}$ dimensionless. The angle unit is radians wherever angles appear internally; no angles are part of the final output.\n- Material model parameters are specified per test. Use $\\varepsilon_{\\infty} = 1.0$ in all tests.\n\nProvide a single program that evaluates the following three tests. Each test specifies the sphere radius $a$, Drude parameters $\\Omega_{p}$ and $\\Gamma$ in electronvolts, the wavelength range, and the list of truncation levels $L$ to evaluate. For each $L$ in the list, compute and return the pair $\\left[ \\mathrm{RMS}, \\Delta \\lambda_{\\mathrm{peak}} \\right]$ defined above.\n\nTest $1$ (happy-path, dipole-dominated but non-quasistatic):\n- $a = 30\\,\\mathrm{nm}$,\n- $\\Omega_{p} = 9.0\\,\\mathrm{eV}$,\n- $\\Gamma = 0.02\\,\\mathrm{eV}$,\n- $\\lambda \\in [300, 800]\\,\\mathrm{nm}$ sampled uniformly with step $2\\,\\mathrm{nm}$,\n- $L \\in \\{ 1, 2, 3, 5, 10 \\}$.\n\nTest $2$ (larger particle requiring higher angular content):\n- $a = 150\\,\\mathrm{nm}$,\n- $\\Omega_{p} = 9.0\\,\\mathrm{eV}$,\n- $\\Gamma = 0.05\\,\\mathrm{eV}$,\n- $\\lambda \\in [400, 1200]\\,\\mathrm{nm}$ sampled uniformly with step $4\\,\\mathrm{nm}$,\n- $L \\in \\{ 1, 3, 5, 10, 20 \\}$.\n\nTest $3$ (quasistatic limit, strong plasmon and fast convergence):\n- $a = 5\\,\\mathrm{nm}$,\n- $\\Omega_{p} = 9.0\\,\\mathrm{eV}$,\n- $\\Gamma = 0.02\\,\\mathrm{eV}$,\n- $\\lambda \\in [300, 800]\\,\\mathrm{nm}$ sampled uniformly with step $5\\,\\mathrm{nm}$,\n- $L \\in \\{ 1, 2, 3 \\}$.\n\nReference solution requirement:\n- For the reference spectrum $Q^{\\mathrm{ref}}_{\\mathrm{sca}}(\\lambda)$, you must ensure convergence by choosing $n_{\\max}(\\lambda)$ sufficiently large for each $\\lambda$. It is acceptable to use an empirical bound that depends on $x(\\lambda)$, provided it demonstrably yields stable results across the specified parameter ranges.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain exactly three items, one per test above, and each item must itself be a list of lists. In other words, the output must have the form\n$[R_{1}, R_{2}, R_{3}]$\nwhere each $R_{k}$ is a list of pairs $\\left[\\mathrm{RMS}, \\Delta \\lambda_{\\mathrm{peak}}\\right]$ for the truncation levels specified in test $k$, in the same order as listed for that test. For example:\n$[[[r_{11},d_{11}], [r_{12},d_{12}], \\dots], [[r_{21},d_{21}], \\dots], [[r_{31},d_{31}], \\dots]]$.\nAll $\\Delta \\lambda_{\\mathrm{peak}}$ must be reported in nanometers, as signed real numbers. All $\\mathrm{RMS}$ values are dimensionless real numbers. No other text may be printed.", "solution": "We first connect the problem to its physical basis. In frequency domain with time dependence $\\exp(-i \\omega t)$, Maxwell’s equations in vacuum and inside a homogeneous, isotropic, nonmagnetic sphere read\n$\n\\nabla \\times \\mathbf{E} = i \\omega \\mu_{0} \\mathbf{H}, \\quad\n\\nabla \\times \\mathbf{H} = -i \\omega \\varepsilon_{0} \\varepsilon(\\omega) \\mathbf{E},\n$\ntogether with\n$\n\\nabla \\cdot \\varepsilon(\\omega) \\mathbf{E} = 0, \\quad \\nabla \\cdot \\mathbf{H} = 0.\n$\nFor a plane wave incidence and a single spherical interface, the boundary conditions at the sphere surface $r=a$ enforce the continuity of the tangential components of $\\mathbf{E}$ and $\\mathbf{H}$. The separation of variables in spherical coordinates yields expansions of the fields in vector spherical harmonics with angular momentum index $n \\in \\mathbb{N}$. The scattered field amplitude is parameterized by two sets of multipole coefficients $a_{n}$ and $b_{n}$ for electric and magnetic multipoles, respectively.\n\nThe material response is metallic with a Drude relative permittivity\n$\n\\varepsilon(\\omega) = \\varepsilon_{\\infty} - \\frac{\\omega_{p}^{2}}{\\omega^{2} + i \\gamma \\omega}.\n$\nTo compute numerically with energies in electronvolts, we introduce $E = \\hbar \\omega$ measured in electronvolts, and set $\\Omega_{p} = \\hbar \\omega_{p}$ and $\\Gamma = \\hbar \\gamma$ in electronvolts, obtaining\n$\n\\varepsilon(E) = \\varepsilon_{\\infty} - \\frac{\\Omega_{p}^{2}}{E^{2} + i \\Gamma E}.\n$\nGiven a free-space wavelength $\\lambda$ in nanometers, we compute $E(\\lambda) = \\dfrac{hc}{\\lambda}$ with $hc \\approx 1239.841984\\,\\mathrm{eV\\,nm}$. The complex refractive index is $m(\\lambda) = \\sqrt{\\varepsilon(E(\\lambda))}$. The size parameter is $x(\\lambda) = \\dfrac{2 \\pi a}{\\lambda}$ with both $a$ and $\\lambda$ in nanometers.\n\nThe Mie scattering coefficients follow from enforcing the boundary conditions on the spherical wave expansions. Introducing the Riccati–Bessel functions $\\psi_{n}(z) = z j_{n}(z)$ and $\\xi_{n}(z) = z h_{n}^{(1)}(z)$, with $j_{n}$ the spherical Bessel function and $h_{n}^{(1)} = j_{n} + i y_{n}$ the spherical Hankel function of the first kind, and denoting derivatives with respect to the argument by a prime, the coefficients are\n$\na_{n} = \\frac{ m \\, \\psi_{n}(m x)\\, \\psi_{n}'(x) - \\psi_{n}(x)\\, \\psi_{n}'(m x) }{ m \\, \\psi_{n}(m x)\\, \\xi_{n}'(x) - \\xi_{n}(x)\\, \\psi_{n}'(m x) },\n\\quad\nb_{n} = \\frac{ \\psi_{n}(m x)\\, \\psi_{n}'(x) - m \\, \\psi_{n}(x)\\, \\psi_{n}'(m x) }{ \\psi_{n}(m x)\\, \\xi_{n}'(x) - m \\, \\xi_{n}(x)\\, \\psi_{n}'(m x) }.\n$\nHere $x = x(\\lambda)$ and $m = m(\\lambda)$. The spherical functions are evaluated at real arguments $x$ for $\\xi_{n}$ and at complex arguments $m x$ for $\\psi_{n}(m x)$.\n\nThe scattering efficiency $Q_{\\mathrm{sca}}$ is the scattering cross section $C_{\\mathrm{sca}}$ normalized by the geometric cross section $\\pi a^{2}$. It is given by the absolutely convergent series\n$\nQ_{\\mathrm{sca}}(\\lambda) = \\frac{2}{x(\\lambda)^{2}} \\sum_{n=1}^{\\infty} (2 n + 1) \\left( |a_{n}|^{2} + |b_{n}|^{2} \\right).\n$\nIn numerical practice, this series is truncated at a maximum angular order $n_{\\max}$. For a converged reference, an empirical choice is to take\n$\nn_{\\max}^{\\mathrm{ref}}(\\lambda) = \\left\\lceil x(\\lambda) + 4\\, x(\\lambda)^{1/3} + 2 \\right\\rceil + \\Delta,\n$\nwith a small integer padding $\\Delta$ to ensure safety. This criterion is well known to yield uniform convergence across a range of size parameters.\n\nThe “mesh-limited” solver is modeled as a truncation at a prescribed angular level $L$, namely\n$\nQ_{\\mathrm{sca}}^{(L)}(\\lambda) = \\frac{2}{x(\\lambda)^{2}} \\sum_{n=1}^{L} (2 n + 1) \\left( |a_{n}|^{2} + |b_{n}|^{2} \\right).\n$\nAs $L$ increases, $Q_{\\mathrm{sca}}^{(L)}(\\lambda)$ converges monotonically from below to the exact $Q_{\\mathrm{sca}}(\\lambda)$, because the missing multipole contributions are nonnegative terms in the sum. This angular truncation plays the role of a mesh refinement parameter controlling the angular resolution of the numerical solution.\n\nWe define the error metrics as follows. Let $\\{ \\lambda_{j} \\}_{j=1}^{N_{\\lambda}}$ be the uniform wavelength grid for a given test. Compute the reference spectrum $Q_{\\mathrm{sca}}^{\\mathrm{ref}}(\\lambda_{j})$ using $n_{\\max}^{\\mathrm{ref}}(\\lambda_{j})$ at each wavelength. For each prescribed $L$ in the test, compute the mesh-limited spectrum $Q_{\\mathrm{sca}}^{(L)}(\\lambda_{j})$ using exactly that truncation for all $\\lambda_{j}$. Then compute the root-mean-square spectral error\n$\n\\mathrm{RMS}(L) = \\sqrt{\\frac{1}{N_{\\lambda}} \\sum_{j=1}^{N_{\\lambda}} \\left( Q_{\\mathrm{sca}}^{(L)}(\\lambda_{j}) - Q_{\\mathrm{sca}}^{\\mathrm{ref}}(\\lambda_{j}) \\right)^{2}},\n$\nand compute the resonance wavelength error\n$\n\\Delta \\lambda_{\\mathrm{peak}}(L) = \\lambda_{\\mathrm{peak}}^{(L)} - \\lambda_{\\mathrm{peak}}^{\\mathrm{ref}},\n$\nwhere $\\lambda_{\\mathrm{peak}}^{(L)}$ and $\\lambda_{\\mathrm{peak}}^{\\mathrm{ref}}$ are the wavelengths at which $Q_{\\mathrm{sca}}^{(L)}$ and $Q_{\\mathrm{sca}}^{\\mathrm{ref}}$ attain their global maxima on the specified grid, respectively. The value $\\Delta \\lambda_{\\mathrm{peak}}$ is reported in nanometers as a signed real number. The $\\mathrm{RMS}$ is dimensionless.\n\nAlgorithmic design and implementation details:\n- Compute $E(\\lambda) = \\dfrac{1239.841984}{\\lambda}\\,\\mathrm{eV}$ for $\\lambda$ in nanometers.\n- Evaluate $\\varepsilon(E) = \\varepsilon_{\\infty} - \\dfrac{\\Omega_{p}^{2}}{E^{2} + i \\Gamma E}$ with the given $\\Omega_{p}$, $\\Gamma$, and $\\varepsilon_{\\infty}=1.0$. Take $m = \\sqrt{\\varepsilon}$ with the principal square root.\n- For each wavelength, compute $x = \\dfrac{2 \\pi a}{\\lambda}$.\n- To form the Mie coefficients $a_{n}$ and $b_{n}$, compute:\n  - $\\psi_{n}(z) = z j_{n}(z)$, $\\psi_{n}'(z) = j_{n}(z) + z j_{n}'(z)$, where $j_{n}$ and $j_{n}'$ are the spherical Bessel function and its derivative. For complex arguments $z = m x$, evaluate $j_{n}(z)$ and $j_{n}'(z)$ directly at complex $z$.\n  - $\\xi_{n}(x) = x h_{n}^{(1)}(x) = x \\left( j_{n}(x) + i y_{n}(x) \\right)$, with $y_{n}$ the spherical Neumann function for real $x$. Its derivative $\\xi_{n}'(x) = h_{n}^{(1)}(x) + x \\left( j_{n}'(x) + i y_{n}'(x) \\right)$.\n  - Insert these into the closed-form expressions for $a_{n}$ and $b_{n}$ above.\n- The reference truncation index $n_{\\max}^{\\mathrm{ref}}(\\lambda)$ can be chosen by $n_{\\max}^{\\mathrm{ref}}(\\lambda) = \\left\\lceil x(\\lambda) + 4 x(\\lambda)^{1/3} + 2 \\right\\rceil + 10$, which safely captures all relevant multipoles for the size parameters in the provided tests.\n- For each test and each $L$ in its list, compute the $\\mathrm{RMS}(L)$ and $\\Delta \\lambda_{\\mathrm{peak}}(L)$ according to the definitions above.\n- Aggregate outputs into a single nested list with three top-level entries, one per test, each containing a list of pairs $\\left[ \\mathrm{RMS}, \\Delta \\lambda_{\\mathrm{peak}} \\right]$ in the order of the prescribed $L$ values.\n\nScientific realism and expectations:\n- In test $1$ with $a = 30\\,\\mathrm{nm}$, the dipolar surface plasmon dominates, so convergence with $L$ is relatively fast and the peak is near the frequency where $\\operatorname{Re}\\{\\varepsilon(E)\\} \\approx -2$ (the quasistatic dipolar condition), with modest radiative corrections.\n- In test $2$ with $a = 150\\,\\mathrm{nm}$, higher-order multipoles contribute, so larger $L$ is needed to resolve the spectrum and the resonance structure depends on retardation.\n- In test $3$ with $a = 5\\,\\mathrm{nm}$, the quasistatic regime is approached and $L=1$ already captures most of the scattering, so the $\\mathrm{RMS}$ error is small and $\\Delta \\lambda_{\\mathrm{peak}}$ is close to zero.\n\nThe final program adheres to these principles, uses stable special-function evaluations for $j_{n}$ and $y_{n}$ and their derivatives, and prints the requested nested list on a single line without any additional text.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import spherical_jn, spherical_yn\n\n# Physical constant hc in eV*nm\nHC_EV_NM = 1239.841984\n\ndef drude_epsilon(E_eV, omega_p_eV, gamma_eV, eps_inf=1.0):\n    \"\"\"\n    Drude dielectric function in eV-units: epsilon(E) = eps_inf - omega_p^2 / (E^2 + i*gamma*E)\n    E_eV can be array-like; returns complex array.\n    \"\"\"\n    E = np.asarray(E_eV, dtype=np.complex128)\n    return eps_inf - (omega_p_eV**2) / (E**2 + 1j * gamma_eV * E)\n\ndef mie_ab_coefficients(n, x, m):\n    \"\"\"\n    Compute Mie coefficients a_n and b_n for order n, size parameter x (real),\n    and complex refractive index m (complex).\n    Uses Riccati-Bessel functions psi_n(z) = z * j_n(z), xi_n(z) = z * h_n^(1)(z).\n    \"\"\"\n    # Arguments\n    z = x  # real\n    mz = m * x  # complex\n\n    # Spherical Bessel j_n and derivatives\n    jn_z = spherical_jn(n, z)\n    jn_z_p = spherical_jn(n, z, derivative=True)\n    jn_mz = spherical_jn(n, mz)  # complex\n    jn_mz_p = spherical_jn(n, mz, derivative=True)\n\n    # Spherical Neumann y_n and derivatives at real z\n    yn_z = spherical_yn(n, z)\n    yn_z_p = spherical_yn(n, z, derivative=True)\n\n    # Hankel h_n^(1) and derivative at real z\n    hn_z = jn_z + 1j * yn_z\n    hn_z_p = jn_z_p + 1j * yn_z_p\n\n    # Riccati-Bessel functions\n    psi_z = z * jn_z\n    psi_z_p = jn_z + z * jn_z_p\n\n    psi_mz = mz * jn_mz\n    psi_mz_p = jn_mz + mz * jn_mz_p\n\n    xi_z = z * hn_z\n    xi_z_p = hn_z + z * xi_z_p\n\n    # Mie coefficients\n    # a_n\n    num_a = m * psi_mz * psi_z_p - psi_z * psi_mz_p\n    den_a = m * psi_mz * xi_z_p - xi_z * psi_mz_p\n    a_n = num_a / den_a\n\n    # b_n\n    num_b = psi_mz * psi_z_p - m * psi_z * psi_mz_p\n    den_b = psi_mz * xi_z_p - m * xi_z * psi_mz_p\n    b_n = num_b / den_b\n\n    return a_n, b_n\n\ndef Q_sca_mie_spectrum(wavelengths_nm, radius_nm, omega_p_eV, gamma_eV, eps_inf=1.0, L=None, use_reference=False):\n    \"\"\"\n    Compute the scattering efficiency spectrum Q_sca(lambda) for a sphere.\n    If use_reference=True, uses a wavelength-dependent n_max based on Wiscombe-like criterion with padding.\n    Else, uses fixed truncation L (positive integer).\n    Returns array of Q_sca with same length as wavelengths_nm.\n    \"\"\"\n    wl = np.asarray(wavelengths_nm, dtype=np.float64)\n    a = float(radius_nm)\n\n    # Energies in eV\n    E = HC_EV_NM / wl  # eV\n    eps = drude_epsilon(E, omega_p_eV, gamma_eV, eps_inf=eps_inf)\n    m = np.sqrt(eps)  # complex refractive index\n\n    # Size parameter x = 2*pi*a / lambda, both in nm\n    x = 2.0 * np.pi * a / wl  # real array\n\n    Q = np.zeros_like(wl, dtype=np.float64)\n    # Loop over wavelengths\n    for i in range(wl.size):\n        xi = x[i]\n        mi = m[i]\n        if use_reference:\n            # Wiscombe-like criterion with padding to ensure convergence\n            # n_max = ceil(x + 4 x^(1/3) + 2) + 10\n            n_max = int(np.ceil(xi + 4.0 * (xi ** (1.0 / 3.0)) + 2.0)) + 10\n            if n_max  1:\n                n_max = 1\n        else:\n            if L is None or L  1:\n                raise ValueError(\"Fixed truncation L must be a positive integer when use_reference is False.\")\n            n_max = int(L)\n\n        # Sum over n\n        sum_terms = 0.0 + 0.0j\n        for n in range(1, n_max + 1):\n            a_n, b_n = mie_ab_coefficients(n, xi, mi)\n            sum_terms += (2 * n + 1) * (abs(a_n) ** 2 + abs(b_n) ** 2)\n\n        # Q_sca\n        Q[i] = (2.0 / (xi ** 2)) * sum_terms.real\n\n    return Q\n\ndef rms_error(ref, approx):\n    diff = approx - ref\n    return float(np.sqrt(np.mean(diff * diff)))\n\ndef resonance_wavelength_error(wavelengths_nm, ref_Q, approx_Q):\n    # Use grid maximum\n    i_ref = int(np.argmax(ref_Q))\n    i_approx = int(np.argmax(approx_Q))\n    return float(wavelengths_nm[i_approx] - wavelengths_nm[i_ref])\n\ndef run_test(radius_nm, omega_p_eV, gamma_eV, wl_start, wl_stop, wl_step, L_list, eps_inf=1.0):\n    # Build wavelength grid\n    N = int(round((wl_stop - wl_start) / wl_step)) + 1\n    wavelengths = np.linspace(wl_start, wl_stop, N, dtype=np.float64)\n\n    # Reference spectrum\n    Q_ref = Q_sca_mie_spectrum(\n        wavelengths, radius_nm, omega_p_eV, gamma_eV, eps_inf=eps_inf, L=None, use_reference=True\n    )\n\n    results = []\n    for L in L_list:\n        Q_L = Q_sca_mie_spectrum(\n            wavelengths, radius_nm, omega_p_eV, gamma_eV, eps_inf=eps_inf, L=int(L), use_reference=False\n        )\n        rms = rms_error(Q_ref, Q_L)\n        dlam = resonance_wavelength_error(wavelengths, Q_ref, Q_L)\n        results.append([rms, dlam])\n    return results\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Test 1\n    test1 = {\n        \"radius_nm\": 30.0,\n        \"omega_p_eV\": 9.0,\n        \"gamma_eV\": 0.02,\n        \"wl_start\": 300.0,\n        \"wl_stop\": 800.0,\n        \"wl_step\": 2.0,\n        \"L_list\": [1, 2, 3, 5, 10],\n        \"eps_inf\": 1.0,\n    }\n    # Test 2\n    test2 = {\n        \"radius_nm\": 150.0,\n        \"omega_p_eV\": 9.0,\n        \"gamma_eV\": 0.05,\n        \"wl_start\": 400.0,\n        \"wl_stop\": 1200.0,\n        \"wl_step\": 4.0,\n        \"L_list\": [1, 3, 5, 10, 20],\n        \"eps_inf\": 1.0,\n    }\n    # Test 3\n    test3 = {\n        \"radius_nm\": 5.0,\n        \"omega_p_eV\": 9.0,\n        \"gamma_eV\": 0.02,\n        \"wl_start\": 300.0,\n        \"wl_stop\": 800.0,\n        \"wl_step\": 5.0,\n        \"L_list\": [1, 2, 3],\n        \"eps_inf\": 1.0,\n    }\n\n    tests = [test1, test2, test3]\n    results_all = []\n    for t in tests:\n        res = run_test(\n            t[\"radius_nm\"], t[\"omega_p_eV\"], t[\"gamma_eV\"],\n            t[\"wl_start\"], t[\"wl_stop\"], t[\"wl_step\"],\n            t[\"L_list\"], eps_inf=t[\"eps_inf\"]\n        )\n        # Convert to plain Python floats for clean printing\n        res_clean = [[float(r[0]), float(r[1])] for r in res]\n        results_all.append(res_clean)\n\n    # Final print statement in the exact required format.\n    # Single line, nested lists\n    # We avoid any additional text.\n    def fmt_list(obj):\n        # Format nested list with default str for floats to ensure single-line output\n        if isinstance(obj, list):\n            return \"[\" + \",\".join(fmt_list(x) for x in obj) + \"]\"\n        else:\n            return str(obj)\n\n    print(fmt_list(results_all))\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2511441"}]}