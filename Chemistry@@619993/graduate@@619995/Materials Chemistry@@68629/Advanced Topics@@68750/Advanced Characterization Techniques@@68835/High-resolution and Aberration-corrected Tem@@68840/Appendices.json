{"hands_on_practices": [{"introduction": "The heart of aberration-corrected TEM is the ability to manipulate the phase of the electron wave to counteract inherent lens defects. One of the most significant artifacts in conventional HRTEM is image delocalization, where information in the image is spatially displaced from its origin in the object. This exercise guides you through the derivation of this delocalization, $\\delta r(u)$, to demonstrate analytically why negative spherical aberration ($C_s \\lt 0$) imaging is revolutionary. By comparing it to conventional imaging ($C_s \\gt 0$), you will uncover how aberration correction provides a unique condition where delocalization is minimized, enabling a more direct interpretation of atomic structures [@problem_id:2490470].", "problem": "A thin, weak-phase object is imaged in coherent high-resolution Transmission Electron Microscopy (TEM). In the linear imaging approximation, the transfer of spatial frequency components of the object exit wave is governed by an aberration phase function whose low-order isotropic form, retaining only defocus and spherical aberration, is given by the well-tested expression $ \\chi(u) = \\pi \\left( \\tfrac{1}{2} C_s \\lambda^{3} u^{4} - \\Delta f \\, \\lambda \\, u^{2} \\right) $, where $u$ is the scalar spatial frequency (the magnitude of the two-dimensional reciprocal-space vector), $C_s$ is the spherical aberration coefficient, $\\Delta f$ is the defocus (with the sign convention that underfocus is $ \\Delta f < 0 $), and $\\lambda$ is the relativistic electron wavelength. Using Fourier optics and the stationary-phase principle to connect the transfer phase to the apparent lateral displacement of image features, derive the frequency-dependent delocalization magnitude $ \\delta r(u) $ in terms of $ C_s $, $ \\Delta f $, $ \\lambda $, and $ u $. Then, consider two imaging conditions at the same electron energy (hence the same $ \\lambda $) and the same underfocus magnitude $ |\\Delta f| = f_0 $ with $ f_0 > 0 $:\n- Case A (conventional objective lens): $ C_s = +C_0 $ with $ C_0 > 0 $ and $ \\Delta f = -f_0 $.\n- Case B (negative spherical aberration imaging, achieved by aberration correction): $ C_s = -C_0 $ with $ C_0 > 0 $ and $ \\Delta f = -f_0 $.\n\nCompute the ratio $ R(u) \\equiv \\delta r_{B}(u) / \\delta r_{A}(u) $ as a closed-form analytic function of $ u $, $ \\lambda $, $ C_0 $, and $ f_0 $. Briefly justify how the sign of $ C_s $ modulates both delocalization and the tendency for contrast reversals through the behavior of $ \\chi(u) $, but express your final answer solely as $ R(u) $. No numerical evaluation is required. The ratio $ R(u) $ is dimensionless and should be given as a simplified analytic expression.", "solution": "The problem as stated is scientifically grounded, well-posed, and objective. It presents a standard, non-trivial derivation in the theory of high-resolution electron microscopy. All necessary information is provided, and the premises are consistent with established physical principles. The problem is therefore valid and a solution will be provided.\n\nThe core of this problem lies in connecting the phase of a wave in reciprocal (Fourier) space to its apparent position in real space. According to the stationary-phase approximation in Fourier optics, a phase gradient in reciprocal space corresponds to a spatial displacement in real space. The lateral displacement vector, $\\delta\\vec{r}$, for features associated with the spatial frequency vector $\\vec{u}$ is given by the gradient of the aberration phase function $\\chi(\\vec{u})$:\n$$ \\delta\\vec{r}(\\vec{u}) = \\frac{1}{2\\pi} \\nabla_{\\vec{u}} \\chi(\\vec{u}) $$\nThe problem states that the aberration function $\\chi$ is isotropic, meaning it depends only on the magnitude of the spatial frequency vector, $u = |\\vec{u}|$. We are given:\n$$ \\chi(u) = \\pi \\left( \\frac{1}{2} C_s \\lambda^{3} u^{4} - \\Delta f \\, \\lambda \\, u^{2} \\right) $$\nTo compute the gradient $\\nabla_{\\vec{u}} \\chi(u)$, we apply the chain rule.\n$$ \\nabla_{\\vec{u}} \\chi(u) = \\frac{d\\chi}{du} \\nabla_{\\vec{u}} u = \\frac{d\\chi}{du} \\frac{\\vec{u}}{u} $$\nThe magnitude of the delocalization is therefore:\n$$ \\delta r(u) = |\\delta\\vec{r}(\\vec{u})| = \\left| \\frac{1}{2\\pi} \\frac{d\\chi}{du} \\frac{\\vec{u}}{u} \\right| = \\frac{1}{2\\pi} \\left| \\frac{d\\chi}{du} \\right| $$\nWe first compute the derivative of $\\chi(u)$ with respect to $u$:\n$$ \\frac{d\\chi}{du} = \\frac{d}{du} \\left[ \\pi \\left( \\frac{1}{2} C_s \\lambda^{3} u^{4} - \\Delta f \\, \\lambda \\, u^{2} \\right) \\right] $$\n$$ \\frac{d\\chi}{du} = \\pi \\left( \\frac{1}{2} C_s \\lambda^{3} (4u^{3}) - \\Delta f \\, \\lambda \\, (2u) \\right) $$\n$$ \\frac{d\\chi}{du} = 2\\pi \\left( C_s \\lambda^{3} u^{3} - \\Delta f \\, \\lambda \\, u \\right) $$\nSubstituting this derivative into the expression for the delocalization magnitude $\\delta r(u)$:\n$$ \\delta r(u) = \\frac{1}{2\\pi} \\left| 2\\pi \\left( C_s \\lambda^{3} u^{3} - \\Delta f \\, \\lambda \\, u \\right) \\right| $$\n$$ \\delta r(u) = \\left| C_s \\lambda^{3} u^{3} - \\Delta f \\, \\lambda \\, u \\right| $$\nFactoring out common terms yields the general expression for frequency-dependent delocalization:\n$$ \\delta r(u) = \\lambda u \\left| C_s \\lambda^{2} u^{2} - \\Delta f \\right| $$\nNow we apply this general result to the two specified cases.\n\nCase A (conventional objective lens): $C_s = +C_0$ and $\\Delta f = -f_0$, where $C_0 > 0$ and $f_0 > 0$.\n$$ \\delta r_{A}(u) = \\lambda u \\left| (+C_0) \\lambda^{2} u^{2} - (-f_0) \\right| $$\n$$ \\delta r_{A}(u) = \\lambda u \\left| C_0 \\lambda^{2} u^{2} + f_0 \\right| $$\nSince $C_0$, $f_0$, $\\lambda$, and $u$ are all non-negative quantities, the term inside the absolute value is always non-negative. Thus, the absolute value function is redundant.\n$$ \\delta r_{A}(u) = \\lambda u ( C_0 \\lambda^{2} u^{2} + f_0 ) $$\n\nCase B (negative spherical aberration imaging): $C_s = -C_0$ and $\\Delta f = -f_0$.\n$$ \\delta r_{B}(u) = \\lambda u \\left| (-C_0) \\lambda^{2} u^{2} - (-f_0) \\right| $$\n$$ \\delta r_{B}(u) = \\lambda u \\left| f_0 - C_0 \\lambda^{2} u^{2} \\right| $$\nIn this case, the term inside the absolute value can be positive, negative, or zero depending on the value of $u$, so the absolute value must be retained.\n\nFinally, we compute the ratio $R(u) \\equiv \\delta r_{B}(u) / \\delta r_{A}(u)$.\n$$ R(u) = \\frac{\\delta r_{B}(u)}{\\delta r_{A}(u)} = \\frac{\\lambda u \\left| f_0 - C_0 \\lambda^{2} u^{2} \\right|}{\\lambda u ( C_0 \\lambda^{2} u^{2} + f_0 )} $$\nFor non-zero spatial frequencies ($u > 0$), the term $\\lambda u$ cancels from the numerator and denominator.\n$$ R(u) = \\frac{\\left| f_0 - C_0 \\lambda^{2} u^{2} \\right|}{f_0 + C_0 \\lambda^{2} u^{2}} $$\nThis is the final analytical expression for the ratio.\n\nJustification of the role of the sign of $C_s$:\nDelocalization is proportional to the magnitude of the phase gradient, $\\left| d\\chi/du \\right|$. In Case A ($C_s > 0, \\Delta f < 0$), the two terms contributing to the gradient, $C_s \\lambda^{3} u^{3}$ and $-\\Delta f \\lambda u$, are both positive and thus add constructively, leading to a large and monotonically increasing delocalization. In Case B ($C_s < 0, \\Delta f < 0$), the terms $C_s \\lambda^{3} u^{3}$ (negative) and $-\\Delta f \\lambda u$ (positive) have opposite signs and can cancel each other. This cancellation, which can make the delocalization zero at a specific frequency $u_0 = \\sqrt{f_0/(C_0\\lambda^2)}$, is the basis of low-delocalization imaging with aberration correctors.\nContrast reversals are governed by the sign of $\\sin(\\chi(u))$. In Case A, $\\chi_A(u) = \\pi (\\frac{1}{2} C_0 \\lambda^3 u^4 + f_0 \\lambda u^2)$ is a rapidly and monotonically increasing function of $u$. It will cross many integer multiples of $\\pi$, causing rapid oscillations in $\\sin(\\chi(u))$ and thus multiple contrast reversals. In Case B, $\\chi_B(u) = \\pi (f_0 \\lambda u^2 - \\frac{1}{2} C_0 \\lambda^3 u^4)$ is not monotonic. By choosing $f_0$ and $C_0$ appropriately, $\\chi_B(u)$ can be made to stay within a narrow range (e.g., between $0$ and $-\\pi$) over a wide band of spatial frequencies. This creates a broad passband where $\\sin(\\chi(u))$ maintains a constant sign, thereby eliminating contrast reversals and enabling more direct image interpretation.", "answer": "$$\\boxed{\\frac{\\left| f_0 - C_0 \\lambda^{2} u^{2} \\right|}{f_0 + C_0 \\lambda^{2} u^{2}}}$$", "id": "2490470"}, {"introduction": "A primary application of high-resolution TEM is the precise characterization of crystalline materials, and aberration correction provides the high-quality images needed for atomic-scale metrology. The periodic arrangement of atoms in a crystal gives rise to sharp reflections in the image's Fourier transform, whose positions directly relate to real-space lattice spacings. This practice problem puts you in the role of an experimentalist performing a quantitative analysis; you will determine a lattice spacing from a simulated HRTEM image and, crucially, propagate the uncertainties from instrumental sources to find the precision of your measurement, developing essential skills in both image analysis and rigorous error analysis [@problem_id:2490532].", "problem": "A thin crystalline nanoparticle is imaged by aberration-corrected high-resolution Transmission Electron Microscopy (TEM) at an acceleration voltage where information transfer is not limited by spherical aberration. From the real-space image, the Fast Fourier Transform (FFT) shows a distinct lattice reflection at pixel coordinates relative to the FFT center of $\\left(k_x, k_y\\right) = \\left(732.4, 129.7\\right)$ in an image of size $N \\times N$ with $N = 4096$. The FFT is computed under the standard discrete Fourier transform convention so that the spatial-frequency sampling increment is set by the real-space sampling interval.\n\nThe specimen-plane pixel size of the recorded image has been calibrated at nominal focus to be $a_0 = 0.0210$ nm per pixel, with a standard uncertainty $u_{a,\\mathrm{cal}} = 5.0 \\times 10^{-5}$ nm per pixel. In this microscope, a small change in objective-lens defocus $\\Delta f$ perturbs the overall magnification by a relative factor characterized locally by the sensitivity $d\\ln M/d\\Delta f = \\eta$, where $\\eta = 5.0 \\times 10^{-5}$ nm$^{-1}$. The defocus used for this image is estimated with a standard uncertainty $u_{\\Delta f} = 10.0$ nm. You may model the effective specimen-plane pixel size as $a \\approx a_0 \\left(1 - \\eta \\,\\Delta f\\right)$, and treat the defocus as contributing only an uncertainty to $a$ with standard contribution $u_{a,\\mathrm{df}} = a_0 \\,\\eta \\, u_{\\Delta f}$.\n\nUsing only the calibration uncertainty in pixel size and the defocus-induced magnification uncertainty described above (ignore any uncertainty in $\\left(k_x,k_y\\right)$ and in $N$), do the following:\n\n- Derive from first principles the relationship between the FFT peak position and the corresponding real-space lattice spacing $d$, starting from the discrete Fourier transform sampling relation between real space and reciprocal space.\n- Propagate uncertainties to obtain the combined standard uncertainty $u_d$ of the lattice spacing using first-order (linear) uncertainty propagation.\n\nReport the lattice spacing $d$ and its combined standard uncertainty $u_d$ in nanometers. Express the final answer as a row matrix $\\left(d, u_d\\right)$ using the LaTeX pmatrix environment. Round $d$ to four significant figures and $u_d$ to two significant figures.", "solution": "The supplied problem is subjected to validation.\n\nStep 1: Extracted Givens.\n- FFT peak coordinates: $(k_x, k_y) = (732.4, 129.7)$ pixels.\n- Image size: $N \\times N$, where $N = 4096$.\n- Nominal pixel size: $a_0 = 0.0210$ nm/pixel.\n- Standard uncertainty in pixel size calibration: $u_{a,\\mathrm{cal}} = 5.0 \\times 10^{-5}$ nm/pixel.\n- Magnification sensitivity to defocus: $\\eta = 5.0 \\times 10^{-5}$ nm$^{-1}$.\n- Standard uncertainty in defocus: $u_{\\Delta f} = 10.0$ nm.\n- Model for effective pixel size: $a \\approx a_0(1 - \\eta \\Delta f)$.\n- Contribution to pixel size uncertainty from defocus: $u_{a,\\mathrm{df}} = a_0 \\eta u_{\\Delta f}$.\n- Constraints: Uncertainty in $(k_x, k_y)$ and $N$ is to be ignored.\n\nStep 2: Validation.\nThe problem is scientifically grounded, describing a standard analysis method in high-resolution transmission electron microscopy (HRTEM). The relationship between real-space sampling and reciprocal-space representation via the Fast Fourier Transform (FFT) is a fundamental principle of signal processing and diffraction physics. The model for magnification change with defocus is a known instrumental effect, and its treatment via linear approximation and uncertainty propagation is a standard method in metrology. The provided values are physically realistic for atomic-resolution imaging. The problem is well-posed, objective, and contains all necessary information for a unique solution.\n\nStep 3: Verdict.\nThe problem is valid. A rigorous solution will be provided.\n\nThe problem requires two tasks: first, the derivation of the formula for lattice spacing $d$ from FFT data, and second, the calculation of $d$ and its combined standard uncertainty $u_d$.\n\nFirst, we derive the relationship between the real-space lattice spacing $d$ and the position of its corresponding reflection in the FFT.\nAn image of size $N \\times N$ pixels with a real-space pixel size of $a$ has a total field of view of width $L = Na$. The sampling interval in real space is $\\Delta x = a$.\nAccording to the sampling theorem for the Discrete Fourier Transform (DFT), the sampling interval in the reciprocal space (spatial frequency space), $\\Delta q$, is inversely proportional to the total width of the real-space field of view.\n$$\n\\Delta q = \\frac{1}{L} = \\frac{1}{Na}\n$$\nAn FFT reflection observed at pixel coordinates $(k_x, k_y)$ relative to the center of the FFT (which corresponds to zero spatial frequency) represents a spatial frequency vector $\\mathbf{q}$ with components:\n$$\nq_x = k_x \\Delta q = \\frac{k_x}{Na}\n$$\n$$\nq_y = k_y \\Delta q = \\frac{k_y}{Na}\n$$\nThe magnitude of this spatial frequency vector, $q = |\\mathbf{q}|$, is given by the Euclidean distance:\n$$\nq = \\sqrt{q_x^2 + q_y^2} = \\sqrt{\\left(\\frac{k_x}{Na}\\right)^2 + \\left(\\frac{k_y}{Na}\\right)^2} = \\frac{\\sqrt{k_x^2 + k_y^2}}{Na}\n$$\nWe define the radial distance of the peak from the FFT center in pixels as $k = \\sqrt{k_x^2 + k_y^2}$. The expression for $q$ simplifies to:\n$$\nq = \\frac{k}{Na}\n$$\nIn crystallography and diffraction physics, the spatial frequency $q$ of a lattice reflection is the reciprocal of the corresponding real-space lattice plane spacing $d$.\n$$\nq = \\frac{1}{d}\n$$\nEquating the two expressions for $q$ yields the relationship:\n$$\n\\frac{1}{d} = \\frac{k}{Na}\n$$\nSolving for $d$ gives the required formula:\n$$\nd = \\frac{Na}{k}\n$$\nThis concludes the derivation.\n\nNext, we calculate the numerical value for $d$ and its uncertainty. The best estimate for the pixel size $a$ is the nominal value $a_0$, as the expected value of the defocus fluctuation $\\Delta f$ is zero.\nGiven values are: $N = 4096$, $a \\approx a_0 = 0.0210$ nm, $k_x = 732.4$, and $k_y = 129.7$.\nFirst, calculate $k$:\n$$\nk = \\sqrt{k_x^2 + k_y^2} = \\sqrt{732.4^2 + 129.7^2} = \\sqrt{536409.76 + 16822.09} = \\sqrt{553231.85} \\approx 743.79555\n$$\nNow, calculate the lattice spacing $d$:\n$$\nd = \\frac{Na_0}{k} = \\frac{4096 \\times 0.0210}{743.79555} \\approx 0.115645 \\text{ nm}\n$$\nRounding to four significant figures as required, we get $d = 0.1156$ nm.\n\nNow, we perform uncertainty propagation. The formula for $d$ is $d = (N/k)a$. Since uncertainties in $N$ and $k$ are to be ignored, the uncertainty in $d$ arises solely from the uncertainty in $a$. The law of propagation of uncertainty for a single variable states:\n$$\nu_d = \\left| \\frac{\\partial d}{\\partial a} \\right| u_a\n$$\nThe partial derivative is $\\frac{\\partial d}{\\partial a} = \\frac{N}{k}$. Thus:\n$$\nu_d = \\frac{N}{k} u_a = \\frac{d}{a_0} u_a\n$$\nThe total uncertainty in the pixel size, $u_a$, is the combination of two independent (uncorrelated) sources: the calibration uncertainty, $u_{a,\\mathrm{cal}}$, and the defocus-induced uncertainty, $u_{a,\\mathrm{df}}$. These are combined in quadrature:\n$$\nu_a^2 = u_{a,\\mathrm{cal}}^2 + u_{a,\\mathrm{df}}^2\n$$\nWe are given $u_{a,\\mathrm{cal}} = 5.0 \\times 10^{-5}$ nm. We must calculate $u_{a,\\mathrm{df}}$ using the provided formula $u_{a,\\mathrm{df}} = a_0 \\eta u_{\\Delta f}$.\nWith $a_0 = 0.0210$ nm, $\\eta = 5.0 \\times 10^{-5}$ nm$^{-1}$, and $u_{\\Delta f} = 10.0$ nm:\n$$\nu_{a,\\mathrm{df}} = (0.0210) \\times (5.0 \\times 10^{-5}) \\times (10.0) = 1.05 \\times 10^{-5} \\text{ nm}\n$$\nNow, calculate the combined uncertainty $u_a$:\n$$\nu_a = \\sqrt{u_{a,\\mathrm{cal}}^2 + u_{a,\\mathrm{df}}^2} = \\sqrt{(5.0 \\times 10^{-5})^2 + (1.05 \\times 10^{-5})^2}\n$$\n$$\nu_a = \\sqrt{25 \\times 10^{-10} + 1.1025 \\times 10^{-10}} = \\sqrt{26.1025 \\times 10^{-10}} \\approx 5.10906 \\times 10^{-5} \\text{ nm}\n$$\nFinally, calculate the desired uncertainty in the lattice spacing, $u_d$:\n$$\nu_d = \\frac{d}{a_0} u_a \\approx \\frac{0.115645}{0.0210} \\times (5.10906 \\times 10^{-5}) \\approx 0.00028134 \\text{ nm}\n$$\nRounding to two significant figures as instructed, we get $u_d = 0.00028$ nm.\n\nThe final reported result is the pair $(d, u_d)$ with the specified rounding.\n$d = 0.1156$ nm.\n$u_d = 0.00028$ nm.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.1156 & 0.00028\n\\end{pmatrix}\n}\n$$", "id": "2490532"}, {"introduction": "Interpreting the fine details of HRTEM image contrast is rarely straightforward, as an atomic column's appearance is a complex function of specimen thickness $t$ and microscope defocus $\\Delta f$. The definitive method for quantitative interpretation is to match experimental images to computer simulations. In this capstone practice, you will implement a full image simulation and parameter-fitting routine based on the principles of wave optics and Fourier analysis. By systematically searching a grid of parameters and minimizing the error against a \"measured\" profile, you will experience the powerful workflow of quantitative TEM that allows scientists to extract physical parameters directly from image contrast [@problem_id:2490474].", "problem": "You are asked to implement a complete program that, for a one-dimensional high-resolution, aberration-corrected transmission electron microscopy (TEM) intensity line profile across a single atomic column, simulates the expected image contrast as a function of defocus and thickness and determines which parameter pair minimizes the residual error relative to a given profile. Your implementation must be based on the following physically grounded modeling assumptions and constraints without using any undocumented shortcuts.\n\nThe program must start from the following base assumptions that are widely accepted in Fourier optics of electron microscopy:\n\n1. The electron beam is coherent to first order and the specimen is modeled as a weak, phase-modulating object (the so-called weak phase object approximation). The exit-surface wavefunction is therefore taken as the complex exponential of the projected phase, which is a linear function of thickness in this approximation. If the projected phase is denoted by $\\phi(x)$, the exit wave is $\\psi_{\\mathrm{exit}}(x) = \\exp\\!\\left(i\\,\\phi(x)\\right)$, where $x$ is the coordinate along the one-dimensional line scan.\n\n2. The projected phase of a single atomic column along the scan direction is modeled as a Gaussian in real space with standard deviation $\\sigma_r$ and an amplitude proportional to thickness $t$, i.e., $\\phi(x) = \\kappa_0\\,t\\,\\exp\\!\\left(-\\dfrac{x^2}{2\\sigma_r^2}\\right)$. The line profile is centered at $x=0$. The constant $\\kappa_0$ is the phase amplitude per unit thickness, which you should treat as given and fixed.\n\n3. Image formation by the objective lens is modeled by linear, shift-invariant propagation in Fourier space. If $\\tilde{\\psi}_{\\mathrm{exit}}(k)$ denotes the Fourier transform of $\\psi_{\\mathrm{exit}}(x)$ with spatial frequency $k$ (in inverse nanometers), then the image-plane wave is obtained by multiplication with a complex transfer function $\\mathcal{T}(k)$ and inverse transformation. The transfer function is formed from an aberration phase $\\chi(k)$ and a simple spatial coherence (source-size) envelope $E(k)$, such that $\\mathcal{T}(k) = E(k)\\,\\exp\\!\\left(i\\,\\chi(k)\\right)$.\n\n4. The aberration phase for defocus $\\Delta f$ and third-order spherical aberration $C_s$ is of the standard form in electron microscopy, where $\\chi(k)$ is a function of the relativistic electron wavelength $\\lambda$ and the spatial frequency $k$. A minimal spatial coherence envelope for a Gaussian angular source of semi-angle $\\alpha$ attenuates higher spatial frequencies according to a standard quadratic-in-$k$ Gaussian factor.\n\n5. The detected intensity profile is the squared magnitude of the image-plane wave, i.e., $I(x) = \\left|\\psi_{\\mathrm{img}}(x)\\right|^2$.\n\n6. Prior to comparison, both the simulated and the measured intensity profiles must be normalized to zero mean and unit $\\ell_2$-norm in order to compare contrast shapes independent of absolute scaling, i.e., given a profile $I(x_i)$ sampled at $N$ points $x_i$, first set $\\bar{I} = \\dfrac{1}{N}\\sum_{i=1}^{N} I(x_i)$, then compute $I^{\\prime}(x_i) = \\dfrac{I(x_i) - \\bar{I}}{\\sqrt{\\sum_{j=1}^{N} \\left(I(x_j) - \\bar{I}\\right)^2}}$.\n\n7. The residual error between a measured profile $M^{\\prime}(x_i)$ and a simulated profile $S^{\\prime}(x_i;\\Delta f, t)$ is the unweighted sum of squared differences over all samples, i.e., $\\mathrm{SSE}(\\Delta f, t) = \\sum_{i=1}^{N} \\left(M^{\\prime}(x_i) - S^{\\prime}(x_i;\\Delta f, t)\\right)^2$.\n\nAll physical units must be consistent. Spatial coordinates $x$ are in nanometers, spatial frequencies $k$ are in inverse nanometers, defocus $\\Delta f$ is in nanometers, spherical aberration $C_s$ is in nanometers, the source semi-angle $\\alpha$ is in radians, the accelerating voltage is in volts, and the final answers for defocus and thickness must be expressed in nanometers. Angle units must be in radians where applicable.\n\nYou must compute the relativistic electron wavelength $\\lambda$ from first principles using the accelerating voltage. You must also use the standard aberration phase and a Gaussian envelope function consistent with the above description, without any unphysical simplifications.\n\nUse the following fixed parameters for all simulations:\n- Accelerating voltage $V_{\\mathrm{acc}} = 300\\,000$ volts.\n- Residual third-order spherical aberration for an aberration-corrected microscope $C_s = 1\\,000$ nanometers.\n- Gaussian source semi-angle $\\alpha = 1.0\\times 10^{-4}$ radians.\n- Gaussian projected phase width $\\sigma_r = 0.05$ nanometers.\n- Phase-amplitude per unit thickness $\\kappa_0 = 0.5$ radians per nanometer.\n- One-dimensional field of view $L = 3.2$ nanometers.\n- Number of uniformly spaced samples $N = 512$.\n\nFor each test case, you must synthesize the “measured” profile using the forward model itself at a specified “true” pair of parameters $(\\Delta f_{\\mathrm{true}}, t_{\\mathrm{true}})$ and then attempt to recover these parameters by minimizing the residual error over a grid. You must not use the true parameters directly during fitting except for generating the synthetic measured data. The grid for the search must be:\n- Defocus $\\Delta f \\in \\left[-30.0, +30.0\\right]$ nanometers in steps of $1.0$ nanometer.\n- Thickness $t \\in \\left[0.5, 6.0\\right]$ nanometers in steps of $0.1$ nanometer.\n\nThe test suite consists of three cases, each defined by a “true” parameter pair $(\\Delta f_{\\mathrm{true}}, t_{\\mathrm{true}})$:\n- Case $1$: $\\Delta f_{\\mathrm{true}} = -10.0$ nanometers, $t_{\\mathrm{true}} = 3.0$ nanometers.\n- Case $2$: $\\Delta f_{\\mathrm{true}} = 0.0$ nanometers, $t_{\\mathrm{true}} = 2.0$ nanometers.\n- Case $3$: $\\Delta f_{\\mathrm{true}} = +20.0$ nanometers, $t_{\\mathrm{true}} = 0.8$ nanometers.\n\nFor each case, your program must output the best-fitting defocus and thickness (both in nanometers) that minimize the residual error over the specified grid, together with the minimum sum of squared errors. Defocus and thickness must be rounded to three decimal places. The minimum sum of squared errors must be reported as a floating-point number rounded to six decimal places.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is a list $\\left[\\Delta f_{\\ast}, t_{\\ast}, \\mathrm{SSE}_{\\min}\\right]$ corresponding to a test case, e.g., $\\left[[\\Delta f_1, t_1, \\mathrm{SSE}_1],[\\Delta f_2, t_2, \\mathrm{SSE}_2],[\\Delta f_3, t_3, \\mathrm{SSE}_3]\\right]$. All defocus and thickness values must be in nanometers as specified, with the required rounding.", "solution": "The problem statement is a valid, well-posed exercise in computational physics, grounded in the established principles of Fourier optics as applied to transmission electron microscopy (TEM). It requests the simulation of one-dimensional image contrast of a single atomic column and the determination of best-fit imaging parameters (defocus and specimen thickness) by minimizing a residual error metric against synthetically generated data. All provided parameters and models, such as the weak phase object approximation, the aberration function, and the physical constants, are standard in the field and scientifically sound. The problem is self-contained and provides sufficient information for a unique solution via the prescribed numerical grid search.\n\nThe solution proceeds by first establishing the necessary mathematical and physical framework, followed by a direct implementation of the simulation and optimization procedure.\n\n**1. Physical Model and Mathematical Formulation**\n\nThe simulation is built upon the theory of image formation in a transmission electron microscope. The key components of the model are the electron wavelength, the specimen interaction, and the objective lens transfer function.\n\n**1.1. Relativistic Electron Wavelength ($\\lambda$)**\nAn electron accelerated through a potential $V_{\\mathrm{acc}}$ gains a kinetic energy $E = e V_{\\mathrm{acc}}$, where $e$ is the elementary charge. For high voltages such as $V_{\\mathrm{acc}} = 300,000$ V, relativistic effects are significant. The de Broglie wavelength $\\lambda$ is given by:\n$$ \\lambda = \\frac{h}{p} = \\frac{h}{\\sqrt{2m_0 E \\left(1 + \\frac{E}{2m_0 c^2}\\right)}} $$\nwhere $h$ is Planck's constant, $p$ is the relativistic momentum, $m_0$ is the electron rest mass, and $c$ is the speed of light. For $V_{\\mathrm{acc}} = 300,000$ V, this yields $\\lambda \\approx 1.968 \\times 10^{-3}$ nm.\n\n**1.2. Specimen Interaction: The Exit Wavefunction**\nThe specimen is modeled as a phase object. An incident plane wave of electrons is modulated by the projected electrostatic potential of the specimen. The one-dimensional projected phase $\\phi(x)$ for a single atomic column is given by a Gaussian function, with its amplitude proportional to the specimen thickness $t$:\n$$ \\phi(x) = \\kappa_0 t \\exp\\left(-\\frac{x^2}{2\\sigma_r^2}\\right) $$\nHere, $\\kappa_0$ is the phase amplitude per unit thickness and $\\sigma_r$ is the spatial width of the atomic column's projected potential. The problem specifies that the electron wavefunction at the exit surface of the specimen is:\n$$ \\psi_{\\mathrm{exit}}(x) = \\exp\\left[i \\phi(x)\\right] $$\nThis form correctly preserves the wave amplitude, i.e., $|\\psi_{\\mathrm{exit}}(x)| = 1$, which is characteristic of a pure phase object.\n\n**1.3. Image Formation: The Contrast Transfer Function (CTF)**\nThe objective lens transfers the exit wavefunction from the specimen plane to the image plane, a process best described in Fourier space. The Fourier transform of the image plane wavefunction $\\tilde{\\psi}_{\\mathrm{img}}(k)$ is related to the Fourier transform of the exit wavefunction $\\tilde{\\psi}_{\\mathrm{exit}}(k)$ by:\n$$ \\tilde{\\psi}_{\\mathrm{img}}(k) = \\tilde{\\psi}_{\\mathrm{exit}}(k) \\cdot \\mathcal{T}(k) $$\nwhere $k$ is the spatial frequency. The transfer function $\\mathcal{T}(k)$ consists of a phase-shifting part and an attenuation (envelope) part:\n$$ \\mathcal{T}(k) = E(k) \\exp\\left[i \\chi(k)\\right] $$\nThe aberration phase function $\\chi(k)$ is given by the standard form for defocus $\\Delta f$ and third-order spherical aberration $C_s$:\n$$ \\chi(k; \\Delta f, C_s) = \\pi \\lambda k^2 \\Delta f + \\frac{1}{2} \\pi \\lambda^3 k^4 C_s $$\nThe envelope function $E(k)$ accounts for the partial coherence of the electron source. Based on the problem's description of \"a standard quadratic-in-$k$ Gaussian factor\" for spatial coherence, we adopt the widely used approximation for the spatial coherence envelope:\n$$ E(k; \\Delta f, \\alpha) = \\exp\\left(-\\pi^2 \\alpha^2 (\\Delta f)^2 k^2\\right) $$\nwhere $\\alpha$ is the source illumination semi-angle. This form is a valid interpretation as the more complete expression for the spatial coherence envelope is not a simple quadratic-in-$k$ Gaussian. This simplified model is particularly appropriate for illustrating the dominant effect of defocus on damping.\n\n**1.4. Intensity Profile and Normalization**\nThe final intensity profile $I(x)$ measured by the detector is the squared magnitude of the image plane wavefunction, which is obtained by taking the inverse Fourier transform of $\\tilde{\\psi}_{\\mathrm{img}}(k)$:\n$$ \\psi_{\\mathrm{img}}(x) = \\mathcal{F}^{-1}\\left\\{ \\tilde{\\psi}_{\\mathrm{img}}(k) \\right\\} $$\n$$ I(x) = \\left|\\psi_{\\mathrm{img}}(x)\\right|^2 $$\nTo compare the shape of the contrast profiles independent of their absolute scale and background, both the synthetically measured profile $M(x_i)$ and the simulated profile $S(x_i)$ are normalized. First, the mean is subtracted, and then the profile is normalized to have a unit $\\ell_2$-norm:\n$$ I'(x_i) = \\frac{I(x_i) - \\bar{I}}{\\sqrt{\\sum_{j=1}^{N} \\left(I(x_j) - \\bar{I}\\right)^2}}, \\quad \\text{where } \\bar{I} = \\frac{1}{N}\\sum_{j=1}^{N} I(x_j) $$\n\n**2. Numerical Implementation and Grid Search**\n\nThe algorithm is implemented as a two-stage process for each test case.\n\n**Stage 1: Generation of \"Measured\" Data**\nFor each test case $(\\Delta f_{\\mathrm{true}}, t_{\\mathrm{true}})$, a reference intensity profile $M(x)$ is simulated using the forward model described above. This profile is then normalized to produce the target profile $M'(x)$.\n\n**Stage 2: Parameter Search**\nA grid search is performed to find the pair of parameters $(\\Delta f, t)$ that minimizes the sum of squared errors (SSE) between the normalized simulated profile $S'(x; \\Delta f, t)$ and the target profile $M'(x)$.\n$$ \\mathrm{SSE}(\\Delta f, t) = \\sum_{i=1}^{N} \\left(M'(x_i) - S'(x_i; \\Delta f, t)\\right)^2 $$\nThe search is conducted over the specified discrete grids:\n- Defocus $\\Delta f \\in \\left[-30.0, +30.0\\right]$ nm with a step of $1.0$ nm.\n- Thickness $t \\in \\left[0.5, 6.0\\right]$ nm with a step of $0.1$ nm.\n\nThe algorithm proceeds as follows:\n1.  Initialize a set of global parameters and physical constants. Calculate the relativistic electron wavelength $\\lambda$.\n2.  Define the real-space grid $x$ over the field of view $L=3.2$ nm with $N=512$ points, and the corresponding reciprocal-space grid $k$.\n3.  For each test case:\n    a. Generate the \"measured\" normalized profile $M'(x)$ using the true parameters $(\\Delta f_{\\mathrm{true}}, t_{\\mathrm{true}})$.\n    b. Initialize $\\mathrm{SSE}_{\\min}$ to a large value.\n    c. Iterate through every $(\\Delta f_j, t_k)$ pair in the search grid.\n    d. For each pair, simulate the intensity profile $S(x; \\Delta f_j, t_k)$ and normalize it to get $S'(x)$.\n    e. Calculate the $\\mathrm{SSE}$ between $M'(x)$ and $S'(x)$.\n    f. If the calculated $\\mathrm{SSE}$ is less than $\\mathrm{SSE}_{\\min}$, update $\\mathrm{SSE}_{\\min}$ and store the current $(\\Delta f_j, t_k)$ as the best-fit parameters.\n4.  Collect the best-fit parameters $(\\Delta f_{\\ast}, t_{\\ast})$ and the minimal error $\\mathrm{SSE}_{\\min}$ for all test cases.\n5.  Format and print the final results as specified.\n\nDiscrete Fourier Transforms, using the Fast Fourier Transform (FFT) algorithm, are used for transformations between real and reciprocal space. The entire simulation is self-contained within the provided Python environment.", "answer": "```python\nimport numpy as np\n\n# Physical constants\nH = 6.62607015e-34  # Planck constant [J*s]\nC = 2.99792458e8    # Speed of light [m/s]\nM0 = 9.1093837e-31   # Electron rest mass [kg]\nE_CHARGE = 1.602176634e-19  # Elementary charge [C]\n\ndef simulate_intensity(delta_f, t, x, k, lambda_nm, C_s, alpha, sigma_r, kappa_0):\n    \"\"\"\n    Simulates the 1D TEM intensity profile for a given defocus and thickness.\n    \"\"\"\n    # 1. Calculate projected phase and exit wavefunction\n    phi = kappa_0 * t * np.exp(-x**2 / (2 * sigma_r**2))\n    psi_exit = np.exp(1j * phi)\n\n    # 2. Fourier transform the exit wave\n    psi_exit_k = np.fft.fft(psi_exit)\n\n    # 3. Define the Contrast Transfer Function (CTF)\n    # Aberration phase function\n    chi = np.pi * lambda_nm * k**2 * delta_f + 0.5 * np.pi * lambda_nm**3 * k**4 * C_s\n    \n    # Spatial coherence envelope function (simplified model)\n    envelope = np.exp(-(np.pi**2 * alpha**2 * delta_f**2) * k**2)\n\n    # Full transfer function\n    transfer_function = envelope * np.exp(1j * chi)\n\n    # 4. Apply CTF in Fourier space\n    psi_img_k = psi_exit_k * transfer_function\n\n    # 5. Inverse Fourier transform to get image-plane wave\n    psi_img = np.fft.ifft(psi_img_k)\n\n    # 6. Calculate intensity (squared magnitude)\n    intensity = np.abs(psi_img)**2\n    \n    return intensity\n\ndef normalize_profile(I):\n    \"\"\"\n    Normalizes a profile to have zero mean and unit l2-norm.\n    \"\"\"\n    I_mean = np.mean(I)\n    I_zm = I - I_mean\n    norm = np.linalg.norm(I_zm)\n    \n    # Handle cases with zero variance to avoid division by zero\n    if norm < 1e-9:\n        return np.zeros_like(I_zm)\n        \n    I_prime = I_zm / norm\n    return I_prime\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation and grid search for all test cases.\n    \"\"\"\n    # --- Part 1: Define parameters and test cases ---\n    \n    # Fixed physical and simulation parameters\n    V_acc = 300000.0      # Accelerating voltage [V]\n    C_s = 1000.0          # Spherical aberration [nm]\n    alpha = 1.0e-4        # Source semi-angle [rad]\n    sigma_r = 0.05        # Projected phase width [nm]\n    kappa_0 = 0.5         # Phase amplitude per unit thickness [rad/nm]\n    L = 3.2               # Field of view [nm]\n    N = 512               # Number of samples\n\n    # Test cases: (delta_f_true, t_true) in [nm]\n    test_cases = [\n        (-10.0, 3.0),\n        (0.0, 2.0),\n        (20.0, 0.8),\n    ]\n\n    # --- Part 2: Pre-computation ---\n\n    # Relativistic electron wavelength calculation\n    E_kin_J = E_CHARGE * V_acc\n    lambda_m = H / np.sqrt(2 * M0 * E_kin_J * (1 + E_kin_J / (2 * M0 * C**2)))\n    lambda_nm = lambda_m * 1e9\n\n    # Real and reciprocal space grids\n    dx = L / N\n    x = np.linspace(-L / 2, L / 2, N, endpoint=False)\n    k = np.fft.fftfreq(N, d=dx)\n\n    # Parameter search grids\n    df_grid = np.arange(-30.0, 30.1, 1.0)\n    # Using np.round to avoid floating point inaccuracies in the grid definition\n    t_grid = np.round(np.arange(0.5, 6.01, 0.1), decimals=1)\n\n    # --- Part 3: Main loop for solving test cases ---\n    \n    all_results = []\n    for df_true, t_true in test_cases:\n        # Generate the \"measured\" data using the forward model\n        I_measured = simulate_intensity(df_true, t_true, x, k, lambda_nm, C_s, alpha, sigma_r, kappa_0)\n        M_prime = normalize_profile(I_measured)\n        \n        min_sse = np.inf\n        best_params = (None, None)\n\n        # Perform grid search\n        for df_scan in df_grid:\n            for t_scan in t_grid:\n                # Simulate profile for current grid point\n                I_simulated = simulate_intensity(df_scan, t_scan, x, k, lambda_nm, C_s, alpha, sigma_r, kappa_0)\n                S_prime = normalize_profile(I_simulated)\n                \n                # Calculate Sum of Squared Errors (SSE)\n                sse = np.sum((M_prime - S_prime)**2)\n                \n                # Update best fit if current error is smaller\n                if sse < min_sse:\n                    min_sse = sse\n                    best_params = (df_scan, t_scan)\n        \n        # Store the results with required rounding\n        best_df, best_t = best_params\n        result_case = [\n            round(best_df, 3), \n            round(best_t, 3), \n            round(min_sse, 6)\n        ]\n        all_results.append(result_case)\n\n    # --- Part 4: Final output formatting ---\n\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "2490474"}]}