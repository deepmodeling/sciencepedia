{"hands_on_practices": [{"introduction": "要真正掌握X射线衍射，理解倒易空间与正空间的数学关系至关重要。本次练习将引导你从第一性原理出发，为一个常见的非立方晶系——六方晶系——构建其倒易晶格。通过亲手计算倒易晶格矢量的大小和相应的晶面间距，你将深化对晶体结构如何决定衍射图样的几何关系的理解，并超越简单的立方晶格模型 [@problem_id:2537262]。", "problem": "一个六方晶体，其正格子参数为 $a=2.50\\,\\text{\\AA}$ 和 $c=4.10\\,\\text{\\AA}$。考虑在米勒-布拉菲（Miller–Bravais）标系中标记为 $(hkil)$ 的晶面，其中 $i=-(h+k)$。仅使用倒易空间和衍射理论的基本定义，完成以下任务：\n\n- 为正格子选择一个右手笛卡尔坐标系嵌入，其基矢 $\\mathbf{a}_{1}$、$\\mathbf{a}_{2}$ 和 $\\mathbf{a}_{3}$ 与六方晶格相符（$|\\mathbf{a}_{1}|=|\\mathbf{a}_{2}|=a$，$\\angle(\\mathbf{a}_{1},\\mathbf{a}_{2})=120^{\\circ}$，且 $\\mathbf{a}_{3}$ 沿 $c$ 轴方向）。\n- 根据定义关系 $\\mathbf{a}_{i}\\cdot\\mathbf{b}_{j}=2\\pi\\,\\delta_{ij}$ 和 $\\mathbf{b}_{1}=\\dfrac{2\\pi\\,\\mathbf{a}_{2}\\times\\mathbf{a}_{3}}{V}$，$\\mathbf{b}_{2}=\\dfrac{2\\pi\\,\\mathbf{a}_{3}\\times\\mathbf{a}_{1}}{V}$，$\\mathbf{b}_{3}=\\dfrac{2\\pi\\,\\mathbf{a}_{1}\\times\\mathbf{a}_{2}}{V}$ 构建倒易基矢 $\\mathbf{b}_{1}$、$\\mathbf{b}_{2}$ 和 $\\mathbf{b}_{3}$，其中 $V=\\mathbf{a}_{1}\\cdot(\\mathbf{a}_{2}\\times\\mathbf{a}_{3})$ 是晶胞体积。\n- 对于晶面 $(10\\bar{1}0)$ 和 $(0002)$，构建相应的倒易格矢 $\\mathbf{G}$，并从第一性原理计算其模长 $|\\mathbf{G}|$。\n\n利用倒易空间中将晶面间距 $d$ 与该晶面族的倒易矢量模长联系起来的几何关系，确定晶面间距之比 $d_{(10\\bar{1}0)}/d_{(0002)}$，结果为一个无量纲数。将您的答案四舍五入到四位有效数字。最终答案只提供该比值（不含中间值），且在最终方框结果中不包含单位。", "solution": "我们从基本定义开始。设正格子基矢选择为\n$$\n\\mathbf{a}_{1}=a\\,(1,0,0),\\quad \\mathbf{a}_{2}=a\\left(\\tfrac{1}{2},\\tfrac{\\sqrt{3}}{2},0\\right),\\quad \\mathbf{a}_{3}=c\\,(0,0,1).\n$$\n晶胞体积为\n$$\nV=\\mathbf{a}_{1}\\cdot(\\mathbf{a}_{2}\\times\\mathbf{a}_{3}).\n$$\n计算 $\\mathbf{a}_{2}\\times\\mathbf{a}_{3}$：\n$$\n\\mathbf{a}_{2}\\times\\mathbf{a}_{3}=\\left(\\tfrac{a\\sqrt{3}}{2}c,-\\tfrac{a}{2}c,0\\right),\n$$\n所以\n$$\nV=\\mathbf{a}_{1}\\cdot(\\mathbf{a}_{2}\\times\\mathbf{a}_{3})=a\\cdot \\tfrac{a\\sqrt{3}}{2}c=\\tfrac{\\sqrt{3}}{2}a^{2}c.\n$$\n倒易基矢由以下公式得出\n$$\n\\mathbf{b}_{1}=\\frac{2\\pi\\,(\\mathbf{a}_{2}\\times\\mathbf{a}_{3})}{V},\\quad \\mathbf{b}_{2}=\\frac{2\\pi\\,(\\mathbf{a}_{3}\\times\\mathbf{a}_{1})}{V},\\quad \\mathbf{b}_{3}=\\frac{2\\pi\\,(\\mathbf{a}_{1}\\times\\mathbf{a}_{2})}{V}.\n$$\n使用 $\\mathbf{a}_{3}\\times\\mathbf{a}_{1}=(0,ca,0)$ 和 $\\mathbf{a}_{1}\\times\\mathbf{a}_{2}=(0,0,\\tfrac{\\sqrt{3}}{2}a^{2})$，我们得到\n$$\n\\mathbf{b}_{1}=2\\pi\\left(\\frac{1}{a},-\\frac{1}{a\\sqrt{3}},0\\right),\\quad\n\\mathbf{b}_{2}=2\\pi\\left(0,\\frac{2}{a\\sqrt{3}},0\\right),\\quad\n\\mathbf{b}_{3}=2\\pi\\left(0,0,\\frac{1}{c}\\right).\n$$\n计算模长所需的它们的模方和内积为\n$$\n|\\mathbf{b}_{1}|^{2}=\\frac{16\\pi^{2}}{3a^{2}},\\quad\n|\\mathbf{b}_{2}|^{2}=\\frac{16\\pi^{2}}{3a^{2}},\\quad\n\\mathbf{b}_{1}\\cdot\\mathbf{b}_{2}=-\\frac{8\\pi^{2}}{3a^{2}},\\quad\n|\\mathbf{b}_{3}|^{2}=\\frac{4\\pi^{2}}{c^{2}},\n$$\n且 $\\mathbf{b}_{1}\\cdot\\mathbf{b}_{3}=\\mathbf{b}_{2}\\cdot\\mathbf{b}_{3}=0$。\n\n在六方米勒-布拉菲标记法中，一个标记为 $(hkil)$ 且 $i=-(h+k)$ 的晶面，对应一个倒易格矢，其在基面内的分量由 $(h,k)$ 对确定，另有沿 $\\mathbf{b}_{3}$ 方向的分量 $l$。在标准三指数表示法中，这由矢量\n$$\n\\mathbf{G}=h\\,\\mathbf{b}_{1}+k\\,\\mathbf{b}_{2}+l\\,\\mathbf{b}_{3}.\n$$\n处理。\n\n对于 $(10\\bar{1}0)$，我们有 $h=1$, $k=0$, $l=0$（因为在基面组合中自动满足 $i=-(h+k)=-1$）。因此\n$$\n\\mathbf{G}_{(10\\bar{1}0)}=\\mathbf{b}_{1},\\quad |\\mathbf{G}_{(10\\bar{1}0)}|=|\\mathbf{b}_{1}|=\\frac{4\\pi}{\\sqrt{3}\\,a}.\n$$\n\n对于 $(0002)$，我们有 $h=0$, $k=0$, $l=2$，因此\n$$\n\\mathbf{G}_{(0002)}=2\\,\\mathbf{b}_{3},\\quad |\\mathbf{G}_{(0002)}|=2\\,|\\mathbf{b}_{3}|=\\frac{4\\pi}{c}.\n$$\n\n在衍射理论中，晶面间距为 $d$ 的晶面族对应一个倒易格矢 $\\mathbf{G}$，其模长满足\n$$\n|\\mathbf{G}|=\\frac{2\\pi}{d}.\n$$\n因此\n$$\nd_{(10\\bar{1}0)}=\\frac{2\\pi}{|\\mathbf{G}_{(10\\bar{1}0)}|}=\\frac{2\\pi}{\\frac{4\\pi}{\\sqrt{3}\\,a}}=\\frac{\\sqrt{3}}{2}\\,a,\n$$\n以及\n$$\nd_{(0002)}=\\frac{2\\pi}{|\\mathbf{G}_{(0002)}|}=\\frac{2\\pi}{\\frac{4\\pi}{c}}=\\frac{c}{2}.\n$$\n\n所求的比值为\n$$\n\\frac{d_{(10\\bar{1}0)}}{d_{(0002)}}=\\frac{\\frac{\\sqrt{3}}{2}\\,a}{\\frac{c}{2}}=\\frac{\\sqrt{3}\\,a}{c}.\n$$\n代入 $a=2.50\\,\\text{\\AA}$ 和 $c=4.10\\,\\text{\\AA}$ 得\n$$\n\\frac{d_{(10\\bar{1}0)}}{d_{(0002)}}=\\frac{\\sqrt{3}\\times 2.50}{4.10}.\n$$\n数值计算，\n$$\n\\sqrt{3}\\approx 1.7320508075688772,\\quad \\Rightarrow\\quad \\frac{d_{(10\\bar{1}0)}}{d_{(0002)}}\\approx \\frac{1.7320508075688772\\times 2.50}{4.10}\\approx 1.056127.\n$$\n四舍五入到四位有效数字，该无量纲比值为 $1.056$。", "answer": "$$\\boxed{1.056}$$", "id": "2537262"}, {"introduction": "理想的衍射理论为我们提供了完美的模型，但在实际的X射线衍射实验中，系统误差是不可避免的。本练习聚焦于一种常见的仪器误差——样品高度位移，并分析它在布拉格-布伦塔诺（Bragg-Brentano）几何中如何影响衍射峰的位置。通过推导和计算由此产生的峰位偏移，你将学会如何识别实验假象，并理解精确的仪器校准对于获取高质量数据的重要性 [@problem_id:2537239]。", "problem": "在衍射仪半径为 $R$ 的X射线衍射（XRD）仪中，采用Bragg–Brentano准聚焦几何构型对一个粉末样品进行测量。测得的衍射角是光源臂和探测器臂之间的张角 $2\\theta$，这两者都位于一个半径为 $R$ 且穿过样品表面的聚焦圆上。在倒易空间中，衍射条件可以看作是厄瓦尔德球（对于X射线波长 $\\lambda$，其半径为 $k=2\\pi/\\lambda$）与对应于晶面间距为 $d$ 的倒易晶格轨迹的交点，这对于给定的 $d$ 确定了真实的布拉格角 $\\theta$。\n\n假设样品沿衍射仪半径有一个微小的高度位移 $\\Delta h$ 的错位（正的 $\\Delta h$ 表示样品表面沿着角平分线向外朝向光源和探测器移动）。这个扰动不改变 $d$，但扰乱了聚焦条件，因此仪器记录到一个偏移了的臂间张角 $2\\theta+\\Delta(2\\theta)$，以满足相同的倒易空间交点条件。\n\n仅从圆周运动的基本几何学和小角度线性化出发，特别是半径为 $R$ 的圆上微小的弧度角变化 $\\Delta\\alpha$ 与相应切向位移的关系为 $\\Delta s \\approx R\\,\\Delta\\alpha$，并利用样品高度误差在入射臂和衍射臂上的投影，推导出系统性角度偏移 $\\Delta(2\\theta)$ 关于 $\\Delta h$、$R$ 和 $\\theta$ 的主阶表达式，包括其符号。然后，对于 $\\Delta h=0.2\\,\\mathrm{mm}$，$R=200\\,\\mathrm{mm}$ 和 $2\\theta=40^\\circ$ 的情况，对此偏移进行数值计算。\n\n报告 $\\Delta(2\\theta)$ 的最终值，以度为单位，四舍五入到四位有效数字。答案以单个数字形式给出。不要报告校正后的角度，只报告偏移量。角度使用度数，最终数值答案中不要包含任何单位符号。", "solution": "该问题要求推导由于样品位移 $\\Delta h$ 导致的 Bragg-Brentano 衍射仪中的角度偏移 $\\Delta(2\\theta)$。该几何构型包含一个光源 $S$ 和一个探测器 $D$，它们在一个半径为 $R$ 的测角仪圆上移动。理想情况下，样品位于该圆的中心 $O$，样品以 $\\theta$ 角旋转，同时探测器位于 $2\\theta$ 角。一个位移将样品移动到一个新位置 $P$。位移矢量 $\\vec{OP}$ 的大小为 $\\Delta h$，方向沿样品表面法线，该法线平分入射光束和衍射光束之间的夹角。\n\n设 $2\\theta_{meas}$ 是仪器测量的角度，即探测器的角位置。对于对称衍射，样品表面与入射光束成 $\\theta_{meas}$ 角。设 $\\theta_{Bragg}$ 是由材料的晶格间距 $d$ 和X射线波长 $\\lambda$ 决定的真实布拉格角。当晶面上的实际入射角 $\\theta_i$ 等于 $\\theta_{Bragg}$ 时，观察到衍射峰。\n\n样品位移 $\\Delta h$ 改变了相对于仪器角度设置 $\\theta_{meas}$ 的实际入射角 $\\theta_i$。位移矢量 $\\vec{OP}$ 沿表面法线方向。表面法线与入射光束 $SO$ 之间的夹角是 $\\theta_{meas}$。因此，位移 $\\Delta h$ 垂直于入射光束的分量是 $\\Delta h \\cos(\\theta_{meas})$。这个垂直位移引入了一个角偏差 $\\delta\\theta_{in}$。对于小位移 $\\Delta h \\ll R$，此偏差为：\n$$\n\\delta\\theta_{in} \\approx \\frac{\\Delta h \\cos(\\theta_{meas})}{R}\n$$\n正位移 $\\Delta h > 0$ 使样品向外移动，增加了相对于固定仪器臂的入射角。因此，实际入射角 $\\theta_i$ 大于仪器设置 $\\theta_{meas}$：\n$$\n\\theta_i = \\theta_{meas} + \\delta\\theta_{in} = \\theta_{meas} + \\frac{\\Delta h \\cos(\\theta_{meas})}{R}\n$$\n当满足布拉格条件时，即 $\\theta_i = \\theta_{Bragg}$，观察到衍射峰。将此代入上式得到：\n$$\n\\theta_{Bragg} = \\theta_{meas} + \\frac{\\Delta h \\cos(\\theta_{meas})}{R}\n$$\n在 $\\theta$ 标度上的角度误差是 $\\Delta\\theta = \\theta_{meas} - \\theta_{Bragg}$。重新整理方程得到：\n$$\n\\theta_{meas} - \\theta_{Bragg} = -\\frac{\\Delta h \\cos(\\theta_{meas})}{R}\n$$\n可观察的误差是在 $2\\theta$ 标度上，即 $\\Delta(2\\theta) = 2\\Delta\\theta$。因此，系统性角度偏移的主阶表达式为：\n$$\n\\Delta(2\\theta) = -\\frac{2 \\Delta h \\cos(\\theta_{meas})}{R}\n$$\n这个表达式以弧度为单位。由于偏移很小，我们可以近似 $\\cos(\\theta_{meas}) \\approx \\cos(\\theta_{Bragg})$，其中 $\\theta$ 是观测到的峰的角度。\n$$\n\\Delta(2\\theta)_{\\text{rad}} = -\\frac{2 \\Delta h \\cos\\theta}{R}\n$$\n正位移 $\\Delta h > 0$ 导致负偏移 $\\Delta(2\\theta)  0$，意味着在较小的 $2\\theta$ 值处观察到衍射峰，这与实验观察结果一致。\n\n**数值计算**\n我们有以下给定值：\n- $\\Delta h = 0.2\\,\\mathrm{mm}$\n- $R = 200\\,\\mathrm{mm}$\n- $2\\theta = 40^\\circ \\implies \\theta = 20^\\circ$\n\n首先，我们计算以弧度为单位的偏移。$\\Delta h$ 和 $R$ 的单位必须一致；两者都使用毫米即可。\n$$\n\\Delta(2\\theta)_{\\text{rad}} = -\\frac{2 \\times (0.2\\,\\mathrm{mm}) \\times \\cos(20^\\circ)}{200\\,\\mathrm{mm}} = -\\frac{0.4 \\times \\cos(20^\\circ)}{200} = -0.002 \\cos(20^\\circ)\n$$\n为了将结果从弧度转换为度，我们乘以 $180/\\pi$：\n$$\n\\Delta(2\\theta)_{\\text{deg}} = -0.002 \\cos(20^\\circ) \\times \\frac{180}{\\pi}\n$$\n现在，我们计算数值：\n- $\\cos(20^\\circ) \\approx 0.93969262$\n- $\\Delta(2\\theta)_{\\text{deg}} \\approx -0.002 \\times 0.93969262 \\times \\frac{180}{\\pi}$\n- $\\Delta(2\\theta)_{\\text{deg}} \\approx -0.0018793852 \\times 57.2957795$\n- $\\Delta(2\\theta)_{\\text{deg}} \\approx -0.107684^\\circ$\n\n问题要求答案四舍五入到四位有效数字。\n$$\n\\Delta(2\\theta) \\approx -0.1077\n$$\n这是以度为单位的角度偏移的最终数值。", "answer": "$$\n\\boxed{-0.1077}\n$$", "id": "2537239"}, {"introduction": "在掌握了基本原理之后，我们可以将所有概念整合起来，以预测完整的衍射实验结果。这项高级实践要求你模拟一次单晶X射线衍射实验，它综合了正空间、倒易空间、晶体取向矩阵（$UB$ 矩阵）和埃瓦尔德球等核心概念。通过编写程序来预测在晶体旋转过程中哪些衍射斑点可以被观测到，你将在理论与计算材料科学之间架起一座桥梁，并掌握一个用于设计和解析衍射实验的强大工具 [@problem_id:2537243]。", "problem": "给定您一个基于埃瓦尔德构图的单晶X射线衍射的束线式取向模型。考虑一个单色入射波矢 $\\mathbf{k}_i$，其与实验室 $z$ 轴对齐，大小为 $k = 2\\pi/\\lambda$，其中 $\\lambda$ 是以 $\\mathrm{\\AA}$ 为单位的X射线波长。如果存在一个出射波矢 $\\mathbf{k}_f$，其满足 $\\lVert \\mathbf{k}_f \\rVert = \\lVert \\mathbf{k}_i \\rVert = k$ 且 $\\mathbf{k}_f = \\mathbf{k}_i + \\mathbf{G}$，则倒格矢 $\\mathbf{G}$ 满足弹性衍射（埃瓦尔德球）条件。这等价于标量条件 $2\\,\\mathbf{k}_i \\cdot \\mathbf{G} + \\lVert \\mathbf{G} \\rVert^2 = 0$，或者，用角度形式表示为 $\\cos \\psi = -\\lVert \\mathbf{G} \\rVert / (2k)$，其中 $\\psi$ 是 $\\mathbf{k}_i$ 和 $\\mathbf{G}$ 之间的夹角。\n\n倒易晶格由一个取向-晶格矩阵 $\\mathbf{U}\\mathbf{B}$ 参数化，该矩阵通过 $\\mathbf{G}_0 = \\mathbf{U}\\mathbf{B}\\,\\mathbf{h}$，在参考旋转角度 $\\phi = 0$ 时，将密勒指数 $\\mathbf{h} = (h,k,l)^\\top \\in \\mathbb{Z}^3$ 映射到实验室坐标系中的倒格矢。样品绕实验室 $z$ 轴旋转角度 $\\phi$（单位为度）由旋转矩阵 $\\mathbf{R}_z(\\phi)$ 应用于倒易晶格来表示，得到 $\\mathbf{G}(\\phi) = \\mathbf{R}_z(\\phi)\\,\\mathbf{G}_0$。您需要确定在指定范围内的 $\\phi$ 扫描期间，哪些衍射点 $\\mathbf{h}$ 在一个角度容差内满足埃瓦尔德条件。\n\n使用以下基本定义为每个测试用例构建 $\\mathbf{U}\\mathbf{B}$：\n- 正晶格的边长为 $a$、$b$、$c$（单位为 $\\mathrm{\\AA}$），轴间角为 $\\alpha$、$\\beta$、$\\gamma$（单位为度），其中 $\\alpha$ 是边 $b$ 和 $c$ 之间的夹角，$\\beta$ 是 $a$ 和 $c$ 之间的夹角，$\\gamma$ 是 $a$ 和 $b$ 之间的夹角。\n- 将正晶格的笛卡尔基构建为矩阵 $\\mathbf{A} = [\\mathbf{a}\\ \\mathbf{b}\\ \\mathbf{c}]$ 的列向量，其中\n  $\\mathbf{a} = (a, 0, 0)^\\top$，\n  $\\mathbf{b} = \\left(b\\cos\\gamma,\\, b\\sin\\gamma,\\, 0\\right)^\\top$，\n  $\\mathbf{c} = \\left(c\\cos\\beta,\\, c\\frac{\\cos\\alpha - \\cos\\beta\\cos\\gamma}{\\sin\\gamma},\\, \\frac{c}{\\sin\\gamma}\\,\\sqrt{1 - \\cos^2\\alpha - \\cos^2\\beta - \\cos^2\\gamma + 2\\cos\\alpha\\cos\\beta\\cos\\gamma} \\right)^\\top$，\n  其中三角函数的参数以弧度为单位。\n- 倒易晶格基底矩阵为 $\\mathbf{B} = 2\\pi\\,\\mathbf{A}^{-T}$，因此 $\\mathbf{G}_{\\mathrm{crystal}} = \\mathbf{B}\\,\\mathbf{h}$。\n- 取向矩阵 $\\mathbf{U}$ 由围绕实验室坐标轴的外旋右手旋转定义：$\\mathbf{U} = \\mathbf{R}_z(\\zeta)\\,\\mathbf{R}_y(\\eta)\\,\\mathbf{R}_x(\\xi)$，其中 $\\xi$、$\\eta$、$\\zeta$ 以度为单位给出，且\n  $\\mathbf{R}_x(\\theta) = \\begin{pmatrix} 1  0  0 \\\\ 0  \\cos\\theta  -\\sin\\theta \\\\ 0  \\sin\\theta  \\cos\\theta \\end{pmatrix}$，\n  $\\mathbf{R}_y(\\theta) = \\begin{pmatrix} \\cos\\theta  0  \\sin\\theta \\\\ 0  1  0 \\\\ -\\sin\\theta  0  \\cos\\theta \\end{pmatrix}$，\n  $\\mathbf{R}_z(\\theta) = \\begin{pmatrix} \\cos\\theta  -\\sin\\theta  0 \\\\ \\sin\\theta  \\cos\\theta  0 \\\\ 0  0  1 \\end{pmatrix}$，\n  其中 $\\theta$ 以弧度为单位。\n- 因此，在 $\\phi=0$ 时，$\\mathbf{U}\\mathbf{B}$ 将 $\\mathbf{h}$ 直接映射到实验室坐标系中的 $\\mathbf{G}_0$。\n\n如果在指定的包含端点的范围和步长内，存在某个旋转角度 $\\phi$，使得以下两个条件都成立，则衍射点 $\\mathbf{h}$ 被视为在扫描期间观测到：\n1. $\\lVert \\mathbf{G}(\\phi) \\rVert \\le 2k$，\n2. $\\left|\\psi(\\phi) - \\psi_{\\mathrm{req}}\\right| \\le \\Delta\\theta$，\n其中 $\\psi(\\phi) = \\arccos\\!\\left(\\dfrac{\\mathbf{k}_i \\cdot \\mathbf{G}(\\phi)}{k\\,\\lVert \\mathbf{G}(\\phi) \\rVert}\\right)$ 是 $\\mathbf{k}_i$ 和 $\\mathbf{G}(\\phi)$ 之间的实际夹角，而 $\\psi_{\\mathrm{req}} = \\arccos\\!\\left(-\\dfrac{\\lVert \\mathbf{G}(\\phi) \\rVert}{2k}\\right)$ 是埃瓦尔德条件所需的夹角，它仅取决于 $\\lVert \\mathbf{G}(\\phi) \\rVert$ 和 $\\lambda$。使用 $\\mathbf{k}_i = (0,0,k)^\\top$，其中 $k = 2\\pi/\\lambda$。\n\n使用角度容差 $\\Delta\\theta = 0.2^\\circ$（度）。扫描从 $\\phi_{\\min}$ 到 $\\phi_{\\max}$（单位为度，包含端点）以固定的步长 $\\Delta\\phi$（单位为度）执行。在您的计算中，所有角度必须在内部以弧度处理，但所有测试用例参数都以度为单位指定。密勒指数搜索空间是 $h$、$k$、$l$ 整数范围的笛卡尔积，不包括 $\\mathbf{h} = (0,0,0)$。\n\n您的程序必须实现上述内容，并将其应用于以下测试套件。对于每个测试用例，报告在扫描期间至少满足一次条件的衍射点集合，形式为一个由整数三元组 $[h,k,l]$ 组成的列表，并按 $(h,k,l)$ 的字典序排序。\n\n测试套件：\n- 测试用例1：\n  - 正晶格：$a = 4.0\\,\\mathrm{\\AA}$，$b = 4.0\\,\\mathrm{\\AA}$，$c = 4.0\\,\\mathrm{\\AA}$，$\\alpha = 90^\\circ$，$\\beta = 90^\\circ$，$\\gamma = 90^\\circ$。\n  - 取向：$\\xi = 40^\\circ$，$\\eta = 25^\\circ$，$\\zeta = 10^\\circ$。\n  - 波长：$\\lambda = 1.5406\\,\\mathrm{\\AA}$。\n  - 扫描：$\\phi_{\\min} = 0^\\circ$，$\\phi_{\\max} = 180^\\circ$，$\\Delta\\phi = 0.25^\\circ$。\n  - 密勒指数范围：$h \\in [-2,2]$，$k \\in [-2,2]$，$l \\in [-2,2]$，不包括 $(0,0,0)$。\n\n- 测试用例2：\n  - 正晶格：$a = 3.9\\,\\mathrm{\\AA}$，$b = 3.9\\,\\mathrm{\\AA}$，$c = 5.2\\,\\mathrm{\\AA}$，$\\alpha = 90^\\circ$，$\\beta = 90^\\circ$，$\\gamma = 90^\\circ$。\n  - 取向：$\\xi = 15^\\circ$，$\\eta = -20^\\circ$，$\\zeta = 35^\\circ$。\n  - 波长：$\\lambda = 1.0000\\,\\mathrm{\\AA}$。\n  - 扫描：$\\phi_{\\min} = 0^\\circ$，$\\phi_{\\max} = 180^\\circ$，$\\Delta\\phi = 0.25^\\circ$。\n  - 密勒指数范围：$h \\in [-2,2]$，$k \\in [-2,2]$，$l \\in [-2,2]$，不包括 $(0,0,0)$。\n\n- 测试用例3：\n  - 正晶格：$a = 5.1\\,\\mathrm{\\AA}$，$b = 7.3\\,\\mathrm{\\AA}$，$c = 9.2\\,\\mathrm{\\AA}$，$\\alpha = 90^\\circ$，$\\beta = 105^\\circ$，$\\gamma = 90^\\circ$。\n  - 取向：$\\xi = -10^\\circ$，$\\eta = 30^\\circ$，$\\zeta = 22^\\circ$。\n  - 波长：$\\lambda = 1.5400\\,\\mathrm{\\AA}$。\n  - 扫描：$\\phi_{\\min} = 0^\\circ$，$\\phi_{\\max} = 180^\\circ$，$\\Delta\\phi = 0.25^\\circ$。\n  - 密勒指数范围：$h \\in [-2,2]$，$k \\in [-2,2]$，$l \\in [-2,2]$，不包括 $(0,0,0)$。\n\n- 测试用例4（边界情况，其中没有衍射点因球半径的运动学限制而被允许）：\n  - 正晶格：$a = 2.0\\,\\mathrm{\\AA}$，$b = 2.0\\,\\mathrm{\\AA}$，$c = 2.0\\,\\mathrm{\\AA}$，$\\alpha = 90^\\circ$，$\\beta = 90^\\circ$，$\\gamma = 90^\\circ$。\n  - 取向：$\\xi = 5^\\circ$，$\\eta = -15^\\circ$，$\\zeta = 55^\\circ$。\n  - 波长：$\\lambda = 5.0000\\,\\mathrm{\\AA}$。\n  - 扫描：$\\phi_{\\min} = 0^\\circ$，$\\phi_{\\max} = 180^\\circ$，$\\Delta\\phi = 0.25^\\circ$。\n  - 密勒指数范围：$h \\in [-1,1]$，$k \\in [-1,1]$，$l \\in [-1,1]$，不包括 $(0,0,0)$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含四个测试用例的结果，形式为方括号括起来的逗号分隔列表。每个测试用例的结果本身是一个衍射点列表，其中每个衍射点表示为一个包含三个整数的列表 $[h,k,l]$。例如，一个有效的输出格式是\n  \"[[[h1,k1,l1],[h2,k2,l2]],[[...]],[[...]],[[...]]]\"。", "solution": "我们从埃瓦尔德构图的第一性原理以及密勒指数与倒格矢之间的映射推导出算法。入射波矢为 $\\mathbf{k}_i = (0,0,k)^\\top$，其中 $k = 2\\pi/\\lambda$。对于一个倒格矢 $\\mathbf{G}$，弹性衍射条件是存在一个 $\\mathbf{k}_f$，使得 $\\lVert \\mathbf{k}_f \\rVert = \\lVert \\mathbf{k}_i \\rVert = k$ 且 $\\mathbf{k}_f = \\mathbf{k}_i + \\mathbf{G}$。将两边平方并使用 $\\lVert \\mathbf{k}_f \\rVert^2 = \\lVert \\mathbf{k}_i \\rVert^2$ 可得\n$$\n\\lVert \\mathbf{k}_i + \\mathbf{G} \\rVert^2 = \\lVert \\mathbf{k}_i \\rVert^2\n\\ \\Longrightarrow\\\n\\lVert \\mathbf{k}_i \\rVert^2 + 2\\,\\mathbf{k}_i \\cdot \\mathbf{G} + \\lVert \\mathbf{G} \\rVert^2 = \\lVert \\mathbf{k}_i \\rVert^2\n\\ \\Longrightarrow\\\n2\\,\\mathbf{k}_i \\cdot \\mathbf{G} + \\lVert \\mathbf{G} \\rVert^2 = 0.\n$$\n设 $\\psi$ 是 $\\mathbf{k}_i$ 和 $\\mathbf{G}$ 之间的夹角，因此 $\\mathbf{k}_i \\cdot \\mathbf{G} = k\\,\\lVert \\mathbf{G} \\rVert \\cos\\psi$。代入可得\n$$\n2\\,k\\,\\lVert \\mathbf{G} \\rVert \\cos\\psi + \\lVert \\mathbf{G} \\rVert^2 = 0\n\\ \\Longrightarrow\\\n\\cos\\psi = -\\frac{\\lVert \\mathbf{G} \\rVert}{2k}.\n$$\n这是埃瓦尔德角度条件。此外，弹性散射施加了运动学界限 $\\lVert \\mathbf{G} \\rVert \\le 2k$，否则 $\\cos\\psi$ 将位于 $[-1,1]$ 之外。\n\n为了从密勒指数计算 $\\mathbf{G}$，我们从正晶格构建倒易晶格基底。正晶格基底矩阵 $\\mathbf{A}$ 的列为 $\\mathbf{a}$、$\\mathbf{b}$、$\\mathbf{c}$。给定正晶胞参数 $(a,b,c,\\alpha,\\beta,\\gamma)$（角度以弧度为单位），一个标准的笛卡尔嵌入是\n$$\n\\mathbf{a} = \\begin{pmatrix} a \\\\ 0 \\\\ 0 \\end{pmatrix},\\quad\n\\mathbf{b} = \\begin{pmatrix} b\\cos\\gamma \\\\ b\\sin\\gamma \\\\ 0 \\end{pmatrix},\\quad\n\\mathbf{c} = \\begin{pmatrix}\nc\\cos\\beta \\\\\nc\\frac{\\cos\\alpha - \\cos\\beta\\cos\\gamma}{\\sin\\gamma} \\\\\n\\frac{c}{\\sin\\gamma}\\sqrt{1 - \\cos^2\\alpha - \\cos^2\\beta - \\cos^2\\gamma + 2\\cos\\alpha\\cos\\beta\\cos\\gamma}\n\\end{pmatrix}.\n$$\n倒易基底矩阵则为\n$$\n\\mathbf{B} = 2\\pi\\,\\mathbf{A}^{-T},\n$$\n该矩阵满足对于整数 $\\mathbf{h} = (h,k,l)^\\top$，晶体坐标系中的倒格矢为 $\\mathbf{G}_{\\mathrm{crystal}} = \\mathbf{B}\\,\\mathbf{h}$。\n\n我们通过由实验室坐标轴的外旋构建的取向矩阵 $\\mathbf{U}$ 转换到实验室坐标系：\n$$\n\\mathbf{U} = \\mathbf{R}_z(\\zeta)\\,\\mathbf{R}_y(\\eta)\\,\\mathbf{R}_x(\\xi),\n$$\n其中\n$$\n\\mathbf{R}_x(\\theta) =\n\\begin{pmatrix}1  0  0 \\\\ 0  \\cos\\theta  -\\sin\\theta \\\\ 0  \\sin\\theta  \\cos\\theta \\end{pmatrix},\\ \n\\mathbf{R}_y(\\theta) =\n\\begin{pmatrix}\\cos\\theta  0  \\sin\\theta \\\\ 0  1  0 \\\\ -\\sin\\theta  0  \\cos\\theta \\end{pmatrix},\\ \n\\mathbf{R}_z(\\theta) =\n\\begin{pmatrix}\\cos\\theta  -\\sin\\theta  0 \\\\ \\sin\\theta  \\cos\\theta  0 \\\\ 0  0  1 \\end{pmatrix}.\n$$\n在参考旋转 $\\phi = 0$ 时，实验室坐标系中的倒格矢为 $\\mathbf{G}_0 = \\mathbf{U}\\mathbf{B}\\,\\mathbf{h}$。绕实验室 $z$ 轴的 $\\phi$ 扫描旋转由 $\\mathbf{R}_z(\\phi)$ 作用于倒易晶格表示，得到\n$$\n\\mathbf{G}(\\phi) = \\mathbf{R}_z(\\phi)\\,\\mathbf{G}_0.\n$$\n模 $\\lVert \\mathbf{G}(\\phi) \\rVert$ 在 $\\mathbf{R}_z(\\phi)$ 旋转下不变，因此所需的埃瓦尔德角\n$$\n\\psi_{\\mathrm{req}} = \\arccos\\!\\left(-\\frac{\\lVert \\mathbf{G}_0 \\rVert}{2k}\\right)\n$$\n与 $\\phi$ 无关（前提是 $\\lVert \\mathbf{G}_0 \\rVert \\le 2k$）。与入射束的实际夹角为\n$$\n\\psi(\\phi) = \\arccos\\!\\left(\\frac{\\mathbf{k}_i \\cdot \\mathbf{G}(\\phi)}{k\\,\\lVert \\mathbf{G}_0 \\rVert}\\right),\n$$\n其中 $\\mathbf{k}_i = (0,0,k)^\\top$。如果在指定范围内存在某个 $\\phi$ 使得\n$$\n\\left| \\psi(\\phi) - \\psi_{\\mathrm{req}} \\right| \\le \\Delta\\theta,\n$$\n且 $\\lVert \\mathbf{G}_0 \\rVert \\le 2k$，则认为在扫描期间观测到了一个衍射点。容差 $\\Delta\\theta$ 被指定为 $0.2^\\circ$，计算时必须转换为弧度。为确保数值稳定性，我们将 $\\arccos$ 的参数限制在 $[-1,1]$ 区间内。\n\n算法步骤：\n1. 对于每个测试用例，计算 $k = 2\\pi/\\lambda$，从 $(a,b,c,\\alpha,\\beta,\\gamma)$ 构建 $\\mathbf{A}$，然后是 $\\mathbf{B} = 2\\pi\\,\\mathbf{A}^{-T}$，再从 $(\\xi,\\eta,\\zeta)$ 构建 $\\mathbf{U}$，所有角度都转换为弧度。\n2. 在指定范围内枚举整数三元组 $(h,k,l)$，不包括 $(0,0,0)$。\n3. 对于每个 $\\mathbf{h}$，计算 $\\mathbf{G}_0 = \\mathbf{U}\\mathbf{B}\\,\\mathbf{h}$ 及其模 $g = \\lVert \\mathbf{G}_0 \\rVert$。如果 $g > 2k$，则舍弃，因为它不能满足埃瓦尔德条件。\n4. 计算 $\\psi_{\\mathrm{req}} = \\arccos\\!\\left(-g/(2k)\\right)$。\n5. 从 $\\phi_{\\min}$ 到 $\\phi_{\\max}$（包含端点）以给定步长扫描 $\\phi$。对于每个 $\\phi$，计算 $\\mathbf{G}(\\phi) = \\mathbf{R}_z(\\phi)\\,\\mathbf{G}_0$，然后\n$$\n\\cos\\psi(\\phi) = \\frac{\\mathbf{k}_i \\cdot \\mathbf{G}(\\phi)}{k\\,g}\n= \\frac{G_z(\\phi)}{g},\n$$\n因为 $\\mathbf{k}_i = (0,0,k)^\\top$。将此余弦值限制在 $[-1,1]$ 内，计算 $\\psi(\\phi) = \\arccos(\\cos\\psi(\\phi))$，并测试 $\\left| \\psi(\\phi) - \\psi_{\\mathrm{req}} \\right| \\le \\Delta\\theta$。\n6. 如果在扫描中有任何 $\\phi$ 满足条件，则将 $\\mathbf{h}$ 记录为在该测试用例中观测到。\n7. 返回每个测试用例观测到的衍射点的排序列表。\n\n论证：\n- 映射 $\\mathbf{G}_0 = \\mathbf{U}\\mathbf{B}\\,\\mathbf{h}$ 直接源于倒易晶格和取向的定义。\n- 角度形式的埃瓦尔德条件 $\\cos\\psi = -\\lVert \\mathbf{G} \\rVert/(2k)$ 来自弹性散射和动量守恒。\n- 旋转 $\\mathbf{R}_z(\\phi)$ 模拟了绕实验室 $z$ 轴的 $\\phi$ 扫描。由于 $\\lVert \\mathbf{G}(\\phi) \\rVert$ 在旋转下不变，所以 $\\psi_{\\mathrm{req}}$ 仅取决于 $g$ 和 $\\lambda$。\n- 容差应用于 $\\psi$ 的角度失配，因为 $\\psi$ 表征了埃瓦尔德球所要求的 $\\mathbf{G}$ 与入射束之间的几何关系，且问题指定了角度容差 $\\Delta\\theta$。\n\n测试套件中的边界情况：\n- 测试用例4使用 $\\lambda = 5.0\\,\\mathrm{\\AA}$ 和 $a = b = c = 2.0\\,\\mathrm{\\AA}$，得到 $k = 2\\pi/\\lambda$ 以及最小的非零倒格矢模 $2\\pi/a$，因此对于任何非零的 $(h,k,l)$ 都有 $2k  \\lVert \\mathbf{G}_0 \\rVert$；因此没有衍射点能满足埃瓦尔德条件，结果为空列表。这验证了运动学界限 $\\lVert \\mathbf{G} \\rVert \\le 2k$。\n\n程序实现了这些步骤，并以单行形式打印四个测试用例的结果：一个包含四个列表的列表，每个列表包含按字典序排序的 $[h,k,l]$ 衍射点，这些衍射点在指定的 $\\phi$ 扫描和容差内被观测到。", "answer": "[[[-2, -1, 1], [-2, 0, 1], [-1, -2, 1], [-1, -1, 2], [-1, -1, -2], [-1, 1, 2], [0, -2, 1], [0, -1, 2], [1, -2, -1], [1, -1, -2], [1, 1, -2], [2, 1, -1]], [[-2, -2, -1], [-2, -2, 0], [-2, -1, -2], [-2, 1, 2], [-2, 2, 0], [-1, -2, -2], [-1, 2, 2], [0, -2, -2], [0, 2, 2], [1, -2, 2], [1, 2, -2], [2, -2, 0], [2, 1, -2], [2, 2, 1]], [[-2, 1, -2], [-1, -2, 0], [-1, -1, -2], [-1, 1, 2], [-1, 2, 0], [0, -2, -2], [0, 2, 2], [1, -2, 0], [1, -1, 2], [1, 1, -2], [1, 2, 0], [2, -1, 2]], []]", "id": "2537243"}]}