{"hands_on_practices": [{"introduction": "球差校正技术是高分辨率透射电子显微学的一项革命性突破。这项练习将引导你深入探究其背后的核心物理原理，即通过操控像差相位函数 $\\chi(u)$ 来优化图像质量。通过运用傅里叶光学的稳相近似，你将推导出图像特征的非局域化效应 $\\delta r(u)$，并从数学上证明为何负球差系数 ($C_s \\lt 0$) 成像能够显著减少这种伪影，从而实现更直观的原子尺度图像解释。[@problem_id:2490470]", "problem": "一个薄的弱相位物体在相干高分辨率透射电子显微镜（TEM）中成像。在线性成像近似下，物体出射波的空间频率分量的传递由一个像差相位函数决定，该函数只保留散焦和球差的低阶各向同性形式由经过充分检验的表达式 $ \\chi(u) = \\pi \\left( \\tfrac{1}{2} C_s \\lambda^{3} u^{4} - \\Delta f \\, \\lambda \\, u^{2} \\right) $ 给出，其中 $u$ 是标量空间频率（二维倒易空间矢量的大小），$C_s$ 是球差系数，$\\Delta f$ 是散焦量（按照符号约定，欠焦为 $ \\Delta f > 0 $），$\\lambda$ 是相对论电子波长。使用傅里叶光学和稳相原理将传递相位与图像特征的表观横向位移联系起来，推导出频率相关的离域幅度 $ \\delta r(u) $，用 $ C_s $、$ \\Delta f $、$ \\lambda $ 和 $ u $ 表示。然后，考虑在相同电子能量（因此 $ \\lambda $ 相同）和相同欠焦量大小 $ |\\Delta f| = f_0 $（其中 $ f_0 > 0 $）下的两种成像条件：\n- 条件A（常规物镜）：$ C_s = +C_0 $，$ C_0 > 0 $ 且 $ \\Delta f = -f_0 $。\n- 条件B（负球差成像，通过像差校正实现）：$ C_s = -C_0 $，$ C_0 > 0 $ 且 $ \\Delta f = -f_0 $。\n\n计算比率 $ R(u) \\equiv \\delta r_{B}(u) / \\delta r_{A}(u) $，作为 $ u $、$ \\lambda $、$ C_0 $ 和 $ f_0 $ 的闭合形式解析函数。简要论证 $ C_s $ 的符号如何通过 $ \\chi(u) $ 的行为来调节离域和衬度反转的趋势，但最终答案只需表示为 $ R(u) $。无需进行数值计算。比率 $ R(u) $ 是无量纲的，应以简化的解析表达式给出。", "solution": "所陈述的问题具有科学依据、提法恰当且客观。它代表了高分辨率电子显微学理论中一个标准的、不平凡的推导。所有必要信息均已提供，且其前提与已确立的物理原理一致。因此，该问题是有效的，将提供解答。\n\n这个问题的核心在于将倒易（傅里叶）空间中波的相位与其在实空间中的表观位置联系起来。根据傅里叶光学中的稳相近似，倒易空间中的相位梯度对应于实空间中的空间位移。对于与空间频率矢量 $\\vec{u}$ 相关的特征，其横向位移矢量 $\\delta\\vec{r}$ 由像差相位函数 $\\chi(\\vec{u})$ 的梯度给出：\n$$ \\delta\\vec{r}(\\vec{u}) = \\frac{1}{2\\pi} \\nabla_{\\vec{u}} \\chi(\\vec{u}) $$\n问题指出像差函数 $\\chi$ 是各向同性的，这意味着它只依赖于空间频率矢量的大小 $u = |\\vec{u}|$。我们已知：\n$$ \\chi(u) = \\pi \\left( \\frac{1}{2} C_s \\lambda^{3} u^{4} - \\Delta f \\, \\lambda \\, u^{2} \\right) $$\n为了计算梯度 $\\nabla_{\\vec{u}} \\chi(u)$，我们应用链式法则。注意到 $\\frac{\\vec{u}}{u}$ 是 $\\vec{u}$ 方向上的单位矢量 $\\hat{u}$，我们发现：\n$$ \\nabla_{\\vec{u}} \\chi(u) = \\frac{d\\chi}{du} \\nabla_{\\vec{u}} u = \\frac{d\\chi}{du} \\frac{\\vec{u}}{u} $$\n因此，离域的大小为：\n$$ \\delta r(u) = |\\delta\\vec{r}(\\vec{u})| = \\left| \\frac{1}{2\\pi} \\frac{d\\chi}{du} \\frac{\\vec{u}}{u} \\right| = \\frac{1}{2\\pi} \\left| \\frac{d\\chi}{du} \\right| $$\n我们首先计算 $\\chi(u)$ 对 $u$ 的导数：\n$$ \\frac{d\\chi}{du} = \\frac{d}{du} \\left[ \\pi \\left( \\frac{1}{2} C_s \\lambda^{3} u^{4} - \\Delta f \\, \\lambda \\, u^{2} \\right) \\right] $$\n$$ \\frac{d\\chi}{du} = \\pi \\left( \\frac{1}{2} C_s \\lambda^{3} (4u^{3}) - \\Delta f \\, \\lambda \\, (2u) \\right) $$\n$$ \\frac{d\\chi}{du} = 2\\pi \\left( C_s \\lambda^{3} u^{3} - \\Delta f \\, \\lambda \\, u \\right) $$\n将此导数代入离域幅度 $\\delta r(u)$ 的表达式中：\n$$ \\delta r(u) = \\frac{1}{2\\pi} \\left| 2\\pi \\left( C_s \\lambda^{3} u^{3} - \\Delta f \\, \\lambda \\, u \\right) \\right| $$\n$$ \\delta r(u) = \\left| C_s \\lambda^{3} u^{3} - \\Delta f \\, \\lambda \\, u \\right| $$\n提出公因式，得到频率相关离域的通用表达式：\n$$ \\delta r(u) = \\lambda u \\left| C_s \\lambda^{2} u^{2} - \\Delta f \\right| $$\n现在我们将这个通用结果应用于指定的两种情况。\n\n条件A（常规物镜）：$C_s = +C_0$ 且 $\\Delta f = -f_0$，其中 $C_0 > 0$ 且 $f_0 > 0$。\n$$ \\delta r_{A}(u) = \\lambda u \\left| (+C_0) \\lambda^{2} u^{2} - (-f_0) \\right| $$\n$$ \\delta r_{A}(u) = \\lambda u \\left| C_0 \\lambda^{2} u^{2} + f_0 \\right| $$\n由于 $C_0$、$f_0$、$\\lambda$ 和 $u$ 都是非负量，绝对值内的项总是非负的。因此，绝对值函数是多余的。\n$$ \\delta r_{A}(u) = \\lambda u ( C_0 \\lambda^{2} u^{2} + f_0 ) $$\n\n条件B（负球差成像）：$C_s = -C_0$ 且 $\\Delta f = -f_0$。\n$$ \\delta r_{B}(u) = \\lambda u \\left| (-C_0) \\lambda^{2} u^{2} - (-f_0) \\right| $$\n$$ \\delta r_{B}(u) = \\lambda u \\left| f_0 - C_0 \\lambda^{2} u^{2} \\right| $$\n在这种情况下，绝对值内的项可以是正、负或零，具体取决于 $u$ 的值，因此必须保留绝对值。\n\n最后，我们计算比率 $R(u) \\equiv \\delta r_{B}(u) / \\delta r_{A}(u)$。\n$$ R(u) = \\frac{\\delta r_{B}(u)}{\\delta r_{A}(u)} = \\frac{\\lambda u \\left| f_0 - C_0 \\lambda^{2} u^{2} \\right|}{\\lambda u ( C_0 \\lambda^{2} u^{2} + f_0 )} $$\n对于非零空间频率（$u > 0$），分子和分母中的项 $\\lambda u$ 可以消去。\n$$ R(u) = \\frac{\\left| f_0 - C_0 \\lambda^{2} u^{2} \\right|}{f_0 + C_0 \\lambda^{2} u^{2}} $$\n这就是该比率的最终解析表达式。\n\n关于 $C_s$ 符号作用的论证：\n离域与相位梯度的幅度 $\\left| d\\chi/du \\right|$ 成正比。在条件A中（$C_s > 0, \\Delta f  0$），对梯度有贡献的两项 $C_s \\lambda^{3} u^{3}$ 和 $-\\Delta f \\lambda u$ 均为正，因此相长叠加，导致一个大的且单调增加的离域。在条件B中（$C_s  0, \\Delta f  0$），项 $C_s \\lambda^{3} u^{3}$（负）和 $-\\Delta f \\lambda u$（正）符号相反，可以相互抵消。这种抵消可以在特定频率 $u_0 = \\sqrt{f_0/(C_0\\lambda^2)}$ 处使离域为零，这是利用像差校正器实现低离域成像的基础。\n衬度反转由 $\\sin(\\chi(u))$ 的符号决定。在条件A中，$\\chi_A(u) = \\pi (\\frac{1}{2} C_0 \\lambda^3 u^4 + f_0 \\lambda u^2)$ 是一个关于 $u$ 快速单调递增的函数。它将穿过 $\\pi$ 的许多整数倍，导致 $\\sin(\\chi(u))$ 快速振荡，从而引起多次衬度反转。在条件B中，$\\chi_B(u) = \\pi (f_0 \\lambda u^2 - \\frac{1}{2} C_0 \\lambda^3 u^4)$ 不是单调的。通过恰当选择 $f_0$ 和 $C_0$，可以使 $\\chi_B(u)$ 在很宽的空间频率带内保持在一个狭窄的范围（例如，在 $0$ 和 $-\\pi$ 之间）。这就创造了一个宽的通带，在此通带内 $\\sin(\\chi(u))$ 保持恒定的符号，从而消除了衬度反转，使得图像的直接解读成为可能。", "answer": "$$\\boxed{\\frac{\\left| f_0 - C_0 \\lambda^{2} u^{2} \\right|}{f_0 + C_0 \\lambda^{2} u^{2}}}$$", "id": "2490470"}, {"introduction": "在掌握了球差校正的理论优势之后，我们必须面对实验中的实际挑战，尤其是在研究电子束敏感材料时。这项练习模拟了一个真实的实验设计情景，你需要在两个关键的物理限制之间进行权衡：材料所能承受的总电子剂量 $D_{\\mathrm{tot}}$ 和样品在采集过程中的漂移速率 $v_{\\mathrm{drift}}$。通过计算，你将学会如何为多次成像（例如，穿焦系列）制定一个既能保证图像质量又能将损伤降至最低的数据采集策略。[@problem_id:2490501]", "problem": "计划在室温下对一种束流敏感的有机分子晶体进行球差校正透射电子显微镜（TEM）实验。您将采集一个穿焦系列图像以进行相位恢复，同时限制辐射损伤。在发生显著结构损伤之前，该材料已知的允许累积剂量预算为 $D_{\\mathrm{tot}} = 24\\,\\mathrm{e}/\\text{\\AA}^{2}$。样品上的入射电子剂量率恒定为 $r = 6.0\\,\\mathrm{e}/\\text{\\AA}^{2}\\,\\mathrm{s}^{-1}$。该穿焦系列将包含 $N = 9$ 张图像，每帧的曝光时间相同。相机在连续帧之间有固定的非曝光读出时间 $t_{\\mathrm{read}} = 0.050\\,\\mathrm{s}$；此读出过程发生在每次曝光之后，但最后一帧之后除外。样品的漂移速率恒定为 $v_{\\mathrm{drift}} = 0.20\\,\\text{\\AA}\\,\\mathrm{s}^{-1}$。为了在球差校正仪器中保留亚埃级信息，您需要总采集时间足够短，以确保整个系列图像中由漂移引起的模糊不超过 $b_{\\max} = 0.60\\,\\text{\\AA}$。\n\n从将剂量与时间积分的电子通量、将漂移模糊与漂移速率和时间的乘积相关联的第一性原理出发，确定对于每帧曝光相同的 $N$ 帧穿焦系列，能够同时满足剂量预算约束和漂移模糊约束的每帧最大允许曝光时间。\n\n然后，基于您的计算和关于球差校正高分辨率成像中信息传递的物理推理，简要提出一个科学上合理的、适用于整个穿焦系列的剂量分配策略，该策略需与此最大每帧曝光时间兼容。\n\n仅报告以秒为单位的最大每帧曝光时间。将您的答案四舍五入到四位有效数字。用秒作单位表示数值答案。", "solution": "首先将对问题的科学合理性和一致性进行验证。\n\n步骤1：提取已知条件。\n提供的明确数据如下：\n- 允许的总累积剂量: $D_{\\mathrm{tot}} = 24\\,\\mathrm{e}/\\text{\\AA}^{2}$\n- 入射电子剂量率: $r = 6.0\\,\\mathrm{e}/\\text{\\AA}^{2}\\,\\mathrm{s}^{-1}$\n- 穿焦系列中的图像数量: $N = 9$\n- 帧间相机读出时间（非曝光）: $t_{\\mathrm{read}} = 0.050\\,\\mathrm{s}$\n- 样品漂移速率: $v_{\\mathrm{drift}} = 0.20\\,\\text{\\AA}\\,\\mathrm{s}^{-1}$\n- 允许的最大漂移模糊: $b_{\\max} = 0.60\\,\\text{\\AA}$\n- 问题指定，在主计算中，所有帧的曝光时间相等。我们将其表示为 $t_{\\mathrm{exp}}$。\n\n步骤2：使用提取的已知条件进行验证。\n该问题具有科学依据。其前提描述了高分辨率透射电子显微镜（HRTEM）中的一个真实情景，特别是针对像有机晶体这样的束流敏感材料。电子剂量预算、剂量率、样品漂移以及用于相位恢复的穿焦系列等概念都是该领域的基础。所提供的值对于球差校正TEM实验而言在物理上是合理的。该问题提法得当，因为它要求在两个独立的物理约束下确定单个参数 $t_{\\mathrm{exp}}$。语言客观，设定自洽且无矛盾。\n\n步骤3：结论与行动。\n该问题被认为是有效的。将从第一性原理推导求解。\n\n中心任务是找到每帧最大曝光时间 $t_{\\mathrm{exp}}$，该时间需同时满足两个约束：一个是由材料的剂量预算施加的，另一个是由可容忍的样品漂移施加的。\n\n首先，我们建立剂量约束的公式。总累积剂量 $D$ 是剂量率 $r$ 和总曝光时间 $T_{\\mathrm{exp}}$ 的乘积。对于一个包含 $N$ 张图像、每张图像曝光时间相等的系列，总曝光时间为 $T_{\\mathrm{exp}} = N t_{\\mathrm{exp}}$。约束条件是总剂量不得超过允许的预算 $D_{\\mathrm{tot}}$。\n$$D = r T_{\\mathrm{exp}} = r N t_{\\mathrm{exp}} \\le D_{\\mathrm{tot}}$$\n这个不等式给出了每帧曝光时间的第一个上限，我们将其标记为 $t_{\\mathrm{exp,dose}}$：\n$$t_{\\mathrm{exp}} \\le \\frac{D_{\\mathrm{tot}}}{r N} \\equiv t_{\\mathrm{exp,dose}}$$\n代入给定值：\n$$t_{\\mathrm{exp,dose}} = \\frac{24\\,\\mathrm{e}/\\text{\\AA}^{2}}{(6.0\\,\\mathrm{e}/\\text{\\AA}^{2}\\,\\mathrm{s}^{-1}) \\times 9} = \\frac{24}{54}\\,\\mathrm{s} = \\frac{4}{9}\\,\\mathrm{s} \\approx 0.4444\\,\\mathrm{s}$$\n\n其次，我们建立漂移约束的公式。由样品漂移产生的总模糊 $b$ 是漂移速率 $v_{\\mathrm{drift}}$ 与整个系列的总采集时间 $T_{\\mathrm{total}}$ 的乘积。总采集时间包括所有曝光时间和所有帧间读出时间的总和。对于 $N$ 帧图像，有 $N$ 个曝光时段和 $N-1$ 个读出时段。因此，$T_{\\mathrm{total}} = N t_{\\mathrm{exp}} + (N-1) t_{\\mathrm{read}}$。由漂移引起的模糊不得超过允许的最大模糊 $b_{\\max}$。\n$$b = v_{\\mathrm{drift}} T_{\\mathrm{total}} = v_{\\mathrm{drift}} (N t_{\\mathrm{exp}} + (N-1) t_{\\mathrm{read}}) \\le b_{\\max}$$\n这个不等式可以解出 $t_{\\mathrm{exp}}$，从而找到第二个上限，我们将其标记为 $t_{\\mathrm{exp,drift}}$：\n$$N t_{\\mathrm{exp}} + (N-1) t_{\\mathrm{read}} \\le \\frac{b_{\\max}}{v_{\\mathrm{drift}}}$$\n$$N t_{\\mathrm{exp}} \\le \\frac{b_{\\max}}{v_{\\mathrm{drift}}} - (N-1) t_{\\mathrm{read}}$$\n$$t_{\\mathrm{exp}} \\le \\frac{1}{N} \\left( \\frac{b_{\\max}}{v_{\\mathrm{drift}}} - (N-1) t_{\\mathrm{read}} \\right) \\equiv t_{\\mathrm{exp,drift}}$$\n代入给定值：\n$$t_{\\mathrm{exp,drift}} = \\frac{1}{9} \\left( \\frac{0.60\\,\\text{\\AA}}{0.20\\,\\text{\\AA}\\,\\mathrm{s}^{-1}} - (9-1) \\times 0.050\\,\\mathrm{s} \\right)$$\n$$t_{\\mathrm{exp,drift}} = \\frac{1}{9} \\left( 3.0\\,\\mathrm{s} - 8 \\times 0.050\\,\\mathrm{s} \\right)$$\n$$t_{\\mathrm{exp,drift}} = \\frac{1}{9} (3.0\\,\\mathrm{s} - 0.40\\,\\mathrm{s}) = \\frac{2.6}{9}\\,\\mathrm{s} \\approx 0.2889\\,\\mathrm{s}$$\n\n为了同时满足这两个约束，每帧曝光时间 $t_{\\mathrm{exp}}$ 必须小于或等于两个计算出的上限中的最小值：\n$$t_{\\mathrm{exp,max}} = \\min(t_{\\mathrm{exp,dose}}, t_{\\mathrm{exp,drift}}) = \\min \\left( \\frac{4}{9}\\,\\mathrm{s}, \\frac{2.6}{9}\\,\\mathrm{s} \\right) = \\frac{2.6}{9}\\,\\mathrm{s}$$\n计算表明，漂移约束 ($t_{\\mathrm{exp,drift}} \\approx 0.2889\\,\\mathrm{s}$) 比剂量约束 ($t_{\\mathrm{exp,dose}} \\approx 0.4444\\,\\mathrm{s}$) 更具限制性。因此，样品漂移是本次实验的限制因素。最大允许的每帧曝光时间，四舍五入到四位有效数字，为 $0.2889\\,\\mathrm{s}$。\n\n关于问题的第二部分，该部分要求提出一个与此结果兼容且有科学依据的剂量分配策略：上述计算假设 $N=9$ 帧中的每一帧剂量相等。这种方法简单，但对于从穿焦系列中进行相位恢复并非最优。一种更优的策略是涉及非均匀地分配总剂量。基本约束条件是总曝光时间 $\\sum t_i \\le 2.6\\,\\mathrm{s}$（来自漂移约束）和总剂量 $r \\sum t_i \\le 24\\,\\mathrm{e}/\\text{\\AA}^{2}$。我们受漂移限制的总曝光时间为 $2.6\\,\\mathrm{s}$，对应的总剂量为 $6.0 \\times 2.6 = 15.6\\,\\mathrm{e}/\\text{\\AA}^{2}$，这远低于剂量预算。\n\n一种有科学依据的策略是按离焦值平方 $\\Delta f^2$ 的比例分配剂量。在穿焦系列中，远离焦点的图像对低空间频率更敏感，而近焦图像对高空间频率更敏感。然而，相位衬度传递函数（CTF）在小离焦量下传递低频信息的能力非常弱。为了在宽广的空间频率范围内为重建的相位实现更均匀的信噪比，将更多剂量分配给具有较大离焦值的图像是有利的。这种 $\\Delta f^2$ 方案可以优化地平衡整个穿焦系列中的信息内容。该策略与系统的物理约束兼容，因为总曝光时间仍需限制在 $\\sum t_i \\le 2.6\\,\\mathrm{s}$ 以满足漂移限制。该方法只是将这个总时间在 $N=9$ 帧之间重新分配，以优化最终相位恢复结果的质量。", "answer": "$$\\boxed{0.2889}$$", "id": "2490501"}, {"introduction": "从理论基础到实验设计，最后一步是定量化的数据分析与诠释。这项综合性练习将挑战你把高分辨成像的物理模型转化为一个可工作的计算机程序，用于模拟原子柱的衬度轮廓。通过将模拟结果与“测量”数据进行比较，并系统性地搜索最佳拟合的成像参数（如离焦量 $\\Delta f$ 和样品厚度 $t$），你将亲身体验从复杂的图像数据中提取定量物理信息的核心研究过程。[@problem_id:2490474]", "problem": "要求您实现一个完整的程序，该程序针对穿过单个原子柱的一维高分辨率、像差校正的透射电子显微镜 (TEM) 强度线剖面，模拟作为离焦量和厚度函数的预期图像衬度，并确定哪个参数对能最小化相对于给定剖面的残差。您的实现必须基于以下有物理依据的建模假设和约束，不得使用任何未经说明的捷径。\n\n程序必须从以下在电子显微学的傅里叶光学中被广泛接受的基本假设开始：\n\n1. 电子束是一阶相干的，样品被建模为一个弱相位调制物体（即所谓的弱相位体近似）。因此，出射面波函数被视为投影相位的复指数，在此近似中，该相位是厚度的线性函数。如果投影相位表示为 $\\phi(x)$，则出射波为 $\\psi_{\\mathrm{exit}}(x) = \\exp\\!\\left(i\\,\\phi(x)\\right)$，其中 $x$ 是一维线扫描方向上的坐标。\n\n2. 沿扫描方向的单个原子柱的投影相位在实空间中被建模为一个高斯函数，其标准差为 $\\sigma_r$，振幅与厚度 $t$ 成正比，即 $\\phi(x) = \\kappa_0\\,t\\,\\exp\\!\\left(-\\dfrac{x^2}{2\\sigma_r^2}\\right)$。线剖面以 $x=0$ 为中心。常数 $\\kappa_0$ 是单位厚度的相位振幅，您应将其视为给定且固定的。\n\n3. 物镜的成像过程被建模为傅里叶空间中的线性、位移不变传播。如果 $\\tilde{\\psi}_{\\mathrm{exit}}(k)$ 表示 $\\psi_{\\mathrm{exit}}(x)$ 的傅里叶变换，其空间频率为 $k$（单位为逆纳米），那么像平面波是通过乘以一个复传递函数 $\\mathcal{T}(k)$ 并进行逆变换得到的。传递函数由一个像差相位 $\\chi(k)$ 和一个简单的空间相干性（光源尺寸）包络函数 $E(k)$ 构成，因此 $\\mathcal{T}(k) = E(k)\\,\\exp\\!\\left(i\\,\\chi(k)\\right)$。\n\n4. 对于离焦量 $\\Delta f$ 和三阶球差 $C_s$ 的像差相位，其形式是电子显微学中的标准形式，其中 $\\chi(k)$ 是相对论电子波长 $\\lambda$ 和空间频率 $k$ 的函数。对于半角为 $\\alpha$ 的高斯角分布光源，最小空间相干性包络函数会根据一个标准的关于 $k$ 的二次高斯因子来衰减较高的空间频率。\n\n5. 探测到的强度剖面是像平面波的模平方，即 $I(x) = \\left|\\psi_{\\mathrm{img}}(x)\\right|^2$。\n\n6. 在比较之前，模拟的和测量的强度剖面都必须归一化至零均值和单位 $\\ell_2$ 范数，以便在不考虑绝对尺度的情况下比较衬度形状。即，给定一个在 $N$ 个点 $x_i$ 采样的剖面 $I(x_i)$，首先设 $\\bar{I} = \\dfrac{1}{N}\\sum_{i=1}^{N} I(x_i)$，然后计算 $I^{\\prime}(x_i) = \\dfrac{I(x_i) - \\bar{I}}{\\sqrt{\\sum_{j=1}^{N} \\left(I(x_j) - \\bar{I}\\right)^2}}$。\n\n7. 测量的剖面 $M^{\\prime}(x_i)$ 和模拟的剖面 $S^{\\prime}(x_i;\\Delta f, t)$ 之间的残差是所有样本上平方差的未加权总和，即 $\\mathrm{SSE}(\\Delta f, t) = \\sum_{i=1}^{N} \\left(M^{\\prime}(x_i) - S^{\\prime}(x_i;\\Delta f, t)\\right)^2$。\n\n所有物理单位必须一致。空间坐标 $x$ 的单位是纳米，空间频率 $k$ 的单位是逆纳米，离焦量 $\\Delta f$ 的单位是纳米，球差 $C_s$ 的单位是纳米，光源半角 $\\alpha$ 的单位是弧度，加速电压的单位是伏特，最终的离焦量和厚度答案必须以纳米表示。在适用时，角度单位必须是弧度。\n\n您必须使用加速电压从第一性原理计算相对论电子波长 $\\lambda$。您还必须使用标准的像差相位和与上述描述一致的高斯包络函数，不得有任何不符合物理的简化。\n\n对所有模拟使用以下固定参数：\n- 加速电压 $V_{\\mathrm{acc}} = 300,000$ 伏特。\n- 像差校正显微镜的剩余三阶球差 $C_s = 1,000$ 纳米。\n- 高斯光源半角 $\\alpha = 1.0\\times 10^{-4}$ 弧度。\n- 高斯投影相位宽度 $\\sigma_r = 0.05$ 纳米。\n- 单位厚度的相位振幅 $\\kappa_0 = 0.5$ 弧度/纳米。\n- 一维视场 $L = 3.2$ 纳米。\n- 均匀间隔的采样点数 $N = 512$。\n\n对于每个测试用例，您必须使用正向模型本身在一个指定的“真实”参数对 $(\\Delta f_{\\mathrm{true}}, t_{\\mathrm{true}})$ 处合成“测量”剖面，然后通过在网格上最小化残差来尝试恢复这些参数。在拟合过程中，除了用于生成综合测量数据外，您不得直接使用真实参数。搜索网格必须为：\n- 离焦量 $\\Delta f \\in \\left[-30.0, +30.0\\right]$ 纳米，步长为 $1.0$ 纳米。\n- 厚度 $t \\in \\left[0.5, 6.0\\right]$ 纳米，步长为 $0.1$ 纳米。\n\n测试套件包含三种情况，每种情况由一个“真实”参数对 $(\\Delta f_{\\mathrm{true}}, t_{\\mathrm{true}})$ 定义：\n- 情况 1：$\\Delta f_{\\mathrm{true}} = -10.0$ 纳米, $t_{\\mathrm{true}} = 3.0$ 纳米。\n- 情况 2：$\\Delta f_{\\mathrm{true}} = 0.0$ 纳米, $t_{\\mathrm{true}} = 2.0$ 纳米。\n- 情况 3：$\\Delta f_{\\mathrm{true}} = +20.0$ 纳米, $t_{\\mathrm{true}} = 0.8$ 纳米。\n\n对于每种情况，您的程序必须输出在指定网格上最小化残差的最佳拟合离焦量和厚度（均以纳米为单位），以及最小平方和误差。离焦量和厚度必须四舍五入到三位小数。最小平方和误差必须报告为四舍五入到六位小数的浮点数。\n\n最终输出格式：您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，其中每个元素是对应于一个测试用例的列表 $\\left[\\Delta f_{\\ast}, t_{\\ast}, \\mathrm{SSE}_{\\min}\\right]$，例如 $\\left[[\\Delta f_1, t_1, \\mathrm{SSE}_1],[\\Delta f_2, t_2, \\mathrm{SSE}_3],[\\Delta f_3, t_3, \\mathrm{SSE}_3]\\right]$。所有离焦量和厚度值必须如指定的那样以纳米为单位，并进行所需的四舍五入。", "solution": "该问题陈述是计算物理学中一个有效且适定的练习，其基础是应用于透射电子显微学 (TEM) 的傅里叶光学的既定原理。它要求模拟单个原子柱的一维图像衬度，并通过最小化与综合生成数据之间的残差度量来确定最佳拟合成像参数（离焦量和样品厚度）。所有提供的参数和模型，如弱相位体近似、像差函数和物理常数，都是该领域的标准并且在科学上是合理的。该问题是自洽的，并为通过规定的数值网格搜索得到唯一解提供了足够的信息。\n\n解决方案首先建立必要的数学和物理框架，然后直接实现模拟和优化过程。\n\n**1. 物理模型与数学公式**\n\n该模拟建立在透射电子显微镜中图像形成的理论之上。模型的关键组成部分是电子波长、样品相互作用以及物镜的传递函数。\n\n**1.1. 相对论电子波长 ($\\lambda$)**\n电子通过电势 $V_{\\mathrm{acc}}$ 加速后获得动能 $E = e V_{\\mathrm{acc}}$，其中 $e$ 是基本电荷。对于像 $V_{\\mathrm{acc}} = 300,000$ V 这样的高电压，相对论效应非常显著。德布罗意波长 $\\lambda$ 由下式给出：\n$$ \\lambda = \\frac{h}{p} = \\frac{h}{\\sqrt{2m_0 E \\left(1 + \\frac{E}{2m_0 c^2}\\right)}} $$\n其中 $h$ 是普朗克常数，$p$ 是相对论动量，$m_0$ 是电子静止质量，$c$ 是光速。对于 $V_{\\mathrm{acc}} = 300,000$ V，这得出 $\\lambda \\approx 1.968 \\times 10^{-3}$ nm。\n\n**1.2. 样品相互作用：出射波函数**\n样品被建模为一个相位物体。入射的电子平面波被样品的投影静电势所调制。单个原子柱的一维投影相位 $\\phi(x)$ 由一个高斯函数给出，其振幅与样品厚度 $t$ 成正比：\n$$ \\phi(x) = \\kappa_0 t \\exp\\left(-\\frac{x^2}{2\\sigma_r^2}\\right) $$\n这里，$\\kappa_0$ 是单位厚度的相位振幅，$\\sigma_r$ 是原子柱投影电势的空间宽度。问题规定，在样品出射面的电子波函数为：\n$$ \\psi_{\\mathrm{exit}}(x) = \\exp\\left[i \\phi(x)\\right] $$\n这种形式正确地保持了波的振幅，即 $|\\psi_{\\mathrm{exit}}(x)| = 1$，这是纯相位体的特征。\n\n**1.3. 成像：衬度传递函数 (CTF)**\n物镜将出射波函数从样品平面传递到像平面，这个过程在傅里叶空间中描述最为恰当。像平面波函数的傅里叶变换 $\\tilde{\\psi}_{\\mathrm{img}}(k)$ 与出射波函数的傅里叶变换 $\\tilde{\\psi}_{\\mathrm{exit}}(k)$ 的关系如下：\n$$ \\tilde{\\psi}_{\\mathrm{img}}(k) = \\tilde{\\psi}_{\\mathrm{exit}}(k) \\cdot \\mathcal{T}(k) $$\n其中 $k$ 是空间频率。传递函数 $\\mathcal{T}(k)$ 包括一个相移部分和一个衰减（包络）部分：\n$$ \\mathcal{T}(k) = E(k) \\exp\\left[i \\chi(k)\\right] $$\n像差相位函数 $\\chi(k)$ 对于离焦量 $\\Delta f$ 和三阶球差 $C_s$ 由标准形式给出：\n$$ \\chi(k; \\Delta f, C_s) = \\pi \\lambda k^2 \\Delta f + \\frac{1}{2} \\pi \\lambda^3 k^4 C_s $$\n包络函数 $E(k)$ 考虑了电子源的部分相干性。根据问题对空间相干性“一个标准的关于 $k$ 的二次高斯因子”的描述，我们采用广泛使用的空间相干性包络近似：\n$$ E(k; \\Delta f, \\alpha) = \\exp\\left(-\\pi^2 \\alpha^2 (\\Delta f)^2 k^2\\right) $$\n其中 $\\alpha$ 是光源照明半角。这种形式是一种有效的解释，因为更完整的空间相干性包络表达式不是一个简单的关于 $k$ 的二次高斯函数。这个简化模型特别适用于说明离焦对阻尼的主导效应。\n\n**1.4. 强度剖面和归一化**\n探测器测量的最终强度剖面 $I(x)$ 是像平面波函数的模平方，通过对 $\\tilde{\\psi}_{\\mathrm{img}}(k)$ 进行逆傅里叶变换得到：\n$$ \\psi_{\\mathrm{img}}(x) = \\mathcal{F}^{-1}\\left\\{ \\tilde{\\psi}_{\\mathrm{img}}(k) \\right\\} $$\n$$ I(x) = \\left|\\psi_{\\mathrm{img}}(x)\\right|^2 $$\n为了比较衬度剖面的形状，而不受其绝对尺度和背景的影响，综合测量的剖面 $M(x_i)$ 和模拟的剖面 $S(x_i)$ 都需要进行归一化。首先，减去均值，然后将剖面归一化为单位 $\\ell_2$ 范数：\n$$ I'(x_i) = \\frac{I(x_i) - \\bar{I}}{\\sqrt{\\sum_{j=1}^{N} \\left(I(x_j) - \\bar{I}\\right)^2}}, \\quad \\text{其中 } \\bar{I} = \\frac{1}{N}\\sum_{j=1}^{N} I(x_j) $$\n\n**2. 数值实现和网格搜索**\n\n对于每个测试用例，算法实现为一个两阶段过程。\n\n**阶段 1：生成“测量”数据**\n对于每个测试用例 $(\\Delta f_{\\mathrm{true}}, t_{\\mathrm{true}})$，使用上述正向模型模拟一个参考强度剖面 $M(x)$。然后对此剖面进行归一化，以产生目标剖面 $M'(x)$。\n\n**阶段 2：参数搜索**\n执行网格搜索，以找到使归一化的模拟剖面 $S'(x; \\Delta f, t)$ 与目标剖面 $M'(x)$ 之间的平方和误差 (SSE) 最小的参数对 $(\\Delta f, t)$。\n$$ \\mathrm{SSE}(\\Delta f, t) = \\sum_{i=1}^{N} \\left(M'(x_i) - S'(x_i; \\Delta f, t)\\right)^2 $$\n搜索在指定的离散网格上进行：\n- 离焦量 $\\Delta f \\in \\left[-30.0, +30.0\\right]$ nm，步长为 $1.0$ nm。\n- 厚度 $t \\in \\left[0.5, 6.0\\right]$ nm，步长为 $0.1$ nm。\n\n算法流程如下：\n1.  初始化一组全局参数和物理常数。计算相对论电子波长 $\\lambda$。\n2.  在视场 $L=3.2$ nm 上定义具有 $N=512$ 个点的实空间网格 $x$，以及相应的倒易空间网格 $k$。\n3.  对于每个测试用例：\n    a. 使用真实参数 $(\\Delta f_{\\mathrm{true}}, t_{\\mathrm{true}})$ 生成“测量”的归一化剖面 $M'(x)$。\n    b. 将 $\\mathrm{SSE}_{\\min}$ 初始化为一个大值。\n    c. 遍历搜索网格中的每个 $(\\Delta f_j, t_k)$ 对。\n    d. 对于每对参数，模拟强度剖面 $S(x; \\Delta f_j, t_k)$ 并将其归一化得到 $S'(x)$。\n    e. 计算 $M'(x)$ 和 $S'(x)$ 之间的 $\\mathrm{SSE}$。\n    f. 如果计算出的 $\\mathrm{SSE}$ 小于 $\\mathrm{SSE}_{\\min}$，则更新 $\\mathrm{SSE}_{\\min}$ 并将当前的 $(\\Delta f_j, t_k)$ 存储为最佳拟合参数。\n4.  收集所有测试用例的最佳拟合参数 $(\\Delta f_{\\ast}, t_{\\ast})$ 和最小误差 $\\mathrm{SSE}_{\\min}$。\n5.  按照指定格式化并打印最终结果。\n\n使用快速傅里叶变换 (FFT) 算法的离散傅里叶变换用于实空间和倒易空间之间的变换。整个模拟自洽地包含在所提供的 Python 环境中。", "answer": "```python\nimport numpy as np\n\n# Physical constants\nH = 6.62607015e-34  # Planck constant [J*s]\nC = 2.99792458e8    # Speed of light [m/s]\nM0 = 9.1093837e-31   # Electron rest mass [kg]\nE_CHARGE = 1.602176634e-19  # Elementary charge [C]\n\ndef simulate_intensity(delta_f, t, x, k, lambda_nm, C_s, alpha, sigma_r, kappa_0):\n    \"\"\"\n    Simulates the 1D TEM intensity profile for a given defocus and thickness.\n    \"\"\"\n    # 1. Calculate projected phase and exit wavefunction\n    phi = kappa_0 * t * np.exp(-x**2 / (2 * sigma_r**2))\n    psi_exit = np.exp(1j * phi)\n\n    # 2. Fourier transform the exit wave\n    psi_exit_k = np.fft.fft(psi_exit)\n\n    # 3. Define the Contrast Transfer Function (CTF)\n    # Aberration phase function\n    chi = np.pi * lambda_nm * k**2 * delta_f + 0.5 * np.pi * lambda_nm**3 * k**4 * C_s\n    \n    # Spatial coherence envelope function (simplified model)\n    envelope = np.exp(-(np.pi**2 * alpha**2 * delta_f**2) * k**2)\n\n    # Full transfer function\n    transfer_function = envelope * np.exp(1j * chi)\n\n    # 4. Apply CTF in Fourier space\n    psi_img_k = psi_exit_k * transfer_function\n\n    # 5. Inverse Fourier transform to get image-plane wave\n    psi_img = np.fft.ifft(psi_img_k)\n\n    # 6. Calculate intensity (squared magnitude)\n    intensity = np.abs(psi_img)**2\n    \n    return intensity\n\ndef normalize_profile(I):\n    \"\"\"\n    Normalizes a profile to have zero mean and unit l2-norm.\n    \"\"\"\n    I_mean = np.mean(I)\n    I_zm = I - I_mean\n    norm = np.linalg.norm(I_zm)\n    \n    # Handle cases with zero variance to avoid division by zero\n    if norm  1e-9:\n        return np.zeros_like(I_zm)\n        \n    I_prime = I_zm / norm\n    return I_prime\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation and grid search for all test cases.\n    \"\"\"\n    # --- Part 1: Define parameters and test cases ---\n    \n    # Fixed physical and simulation parameters\n    V_acc = 300000.0      # Accelerating voltage [V]\n    C_s = 1000.0          # Spherical aberration [nm]\n    alpha = 1.0e-4        # Source semi-angle [rad]\n    sigma_r = 0.05        # Projected phase width [nm]\n    kappa_0 = 0.5         # Phase amplitude per unit thickness [rad/nm]\n    L = 3.2               # Field of view [nm]\n    N = 512               # Number of samples\n\n    # Test cases: (delta_f_true, t_true) in [nm]\n    test_cases = [\n        (-10.0, 3.0),\n        (0.0, 2.0),\n        (20.0, 0.8),\n    ]\n\n    # --- Part 2: Pre-computation ---\n\n    # Relativistic electron wavelength calculation\n    E_kin_J = E_CHARGE * V_acc\n    lambda_m = H / np.sqrt(2 * M0 * E_kin_J * (1 + E_kin_J / (2 * M0 * C**2)))\n    lambda_nm = lambda_m * 1e9\n\n    # Real and reciprocal space grids\n    dx = L / N\n    x = np.linspace(-L / 2, L / 2, N, endpoint=False)\n    k = np.fft.fftfreq(N, d=dx)\n\n    # Parameter search grids\n    df_grid = np.arange(-30.0, 30.1, 1.0)\n    # Using np.round to avoid floating point inaccuracies in the grid definition\n    t_grid = np.round(np.arange(0.5, 6.01, 0.1), decimals=1)\n\n    # --- Part 3: Main loop for solving test cases ---\n    \n    all_results = []\n    for df_true, t_true in test_cases:\n        # Generate the \"measured\" data using the forward model\n        I_measured = simulate_intensity(df_true, t_true, x, k, lambda_nm, C_s, alpha, sigma_r, kappa_0)\n        M_prime = normalize_profile(I_measured)\n        \n        min_sse = np.inf\n        best_params = (None, None)\n\n        # Perform grid search\n        for df_scan in df_grid:\n            for t_scan in t_grid:\n                # Simulate profile for current grid point\n                I_simulated = simulate_intensity(df_scan, t_scan, x, k, lambda_nm, C_s, alpha, sigma_r, kappa_0)\n                S_prime = normalize_profile(I_simulated)\n                \n                # Calculate Sum of Squared Errors (SSE)\n                sse = np.sum((M_prime - S_prime)**2)\n                \n                # Update best fit if current error is smaller\n                if sse  min_sse:\n                    min_sse = sse\n                    best_params = (df_scan, t_scan)\n        \n        # Store the results with required rounding\n        best_df, best_t = best_params\n        result_case = [\n            round(best_df, 3), \n            round(best_t, 3), \n            round(min_sse, 6)\n        ]\n        all_results.append(result_case)\n\n    # --- Part 4: Final output formatting ---\n\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "2490474"}]}