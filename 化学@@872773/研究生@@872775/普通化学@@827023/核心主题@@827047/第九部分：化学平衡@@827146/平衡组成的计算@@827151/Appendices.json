{"hands_on_practices": [{"introduction": "掌握平衡组成的计算，首先要能将化学计量关系和平衡常数转化为可解的代数方程。本练习将通过一个气相二聚反应来训练这项核心技能。由于该反应中气体分子的总数发生了变化，求解平衡组分将导向一个二次方程。通过解决这个问题，你将练习如何建立方程并从多个数学解中筛选出具有物理意义的唯一解，为处理更复杂的平衡问题打下坚实的基础。[@problem_id:2926237]", "problem": "一种单组分气体在体积为 $V = 1.000\\ \\mathrm{L}$ 的刚性容器中，在温度 $T = 1000\\ \\mathrm{K}$ 下发生化学计量式为 $\\mathrm{2A \\rightleftharpoons A_2}$ 的缔合反应。初始时，容器中只有单体 $\\mathrm{A}$，其物质的量为 $n_{\\mathrm{A}}^{0} = 0.100\\ \\mathrm{mol}$，没有二聚体 $\\mathrm{A_2}$。在此温度下，该组分依赖的平衡由浓度平衡常数 $K_{c} = 50.0\\ \\mathrm{L\\ mol^{-1}}$ 表征。该常数是使用活度 $a_{i}$ 定义的，在理想混合物近似下，对于每个物种 $i$，活度通过 $a_{i} = c_{i}/c^{\\circ}$ 关联到标准浓度 $c^{\\circ} = 1.000\\ \\mathrm{mol\\ L^{-1}}$。\n\n从活度表示的平衡常数定义以及反应所蕴含的化学计量质量平衡出发，推导控制平衡组分的代数方程，并求解该方程以确定二聚体 $\\mathrm{A_2}$ 的平衡摩尔浓度。\n\n仅使用所提供的信息，假设理想行为，即活度由浓度除以 $c^{\\circ}$ 给出，并将系统视为等温等容。将您的最终数值答案四舍五入至四位有效数字。以 $\\mathrm{mol\\ L^{-1}}$ 为单位表示您的答案。", "solution": "所述问题已经过验证，被认为是科学上合理的、提法得当的、客观的且内部一致的。它呈现了一个标准的化学平衡计算。因此，将推导出一个完整的解。\n\n该系统由气相缔合反应定义：\n$$\n\\mathrm{2A \\rightleftharpoons A_2}\n$$\n该反应在体积恒为 $V = 1.000\\ \\mathrm{L}$、温度恒为 $T = 1000\\ \\mathrm{K}$ 的刚性容器中进行。\n\n首先，我们用摩尔浓度来确定初始条件。初始单体的物质的量为 $n_{\\mathrm{A}}^{0} = 0.100\\ \\mathrm{mol}$，初始二聚体的物质的量为 $n_{\\mathrm{A_2}}^{0} = 0\\ \\mathrm{mol}$。初始浓度（用下标0表示）为：\n$$\n[\\mathrm{A}]_0 = \\frac{n_{\\mathrm{A}}^{0}}{V} = \\frac{0.100\\ \\mathrm{mol}}{1.000\\ \\mathrm{L}} = 0.100\\ \\mathrm{mol\\ L^{-1}}\n$$\n$$\n[\\mathrm{A_2}]_0 = \\frac{n_{\\mathrm{A_2}}^{0}}{V} = \\frac{0\\ \\mathrm{mol}}{1.000\\ \\mathrm{L}} = 0\\ \\mathrm{mol\\ L^{-1}}\n$$\n设 $x$ 表示当系统从初始状态进行到平衡状态时，二聚体 $\\mathrm{A_2}$ 摩尔浓度的变化量。根据反应的化学计量，每生成一摩尔 $\\mathrm{A_2}$，就会消耗两摩尔 $\\mathrm{A}$。因此，浓度的变化量为 $\\Delta[\\mathrm{A_2}] = +x$ 和 $\\Delta[\\mathrm{A}] = -2x$。\n\n平衡浓度（用下标eq表示）可以用初始浓度和反应程度 $x$ 来表示：\n$$\n[\\mathrm{A_2}]_{eq} = [\\mathrm{A_2}]_0 + x = 0 + x = x\n$$\n$$\n[\\mathrm{A}]_{eq} = [\\mathrm{A}]_0 - 2x = 0.100 - 2x\n$$\n为了使平衡浓度具有物理意义，它们必须是非负的。这对 $x$ 的可能值施加了一个约束：\n$$\n[\\mathrm{A}]_{eq} = 0.100 - 2x \\geq 0 \\implies 2x \\leq 0.100 \\implies x \\leq 0.050\\ \\mathrm{mol\\ L^{-1}}\n$$\n同样，$x = [\\mathrm{A_2}]_{eq} \\geq 0$。因此，$x$ 必须在 $0 \\leq x \\leq 0.050$ 的范围内。\n\n问题中根据活度 $a_i$ 定义了热力学平衡常数，其中 $a_i = c_i / c^{\\circ}$ 且 $c^{\\circ} = 1.000\\ \\mathrm{mol\\ L^{-1}}$。无量纲平衡常数 $K_{eq}$ 的表达式为：\n$$\nK_{eq} = \\frac{a_{\\mathrm{A_2}}}{a_{\\mathrm{A}}^2} = \\frac{([\\mathrm{A_2}]_{eq}/c^{\\circ})}{([\\mathrm{A}]_{eq}/c^{\\circ})^2} = \\frac{[\\mathrm{A_2}]_{eq}}{[\\mathrm{A}]_{eq}^2} c^{\\circ}\n$$\n问题提供了浓度平衡常数 $K_c = 50.0\\ \\mathrm{L\\ mol^{-1}}$。根据定义，$K_c$ 是浓度的比值：\n$$\nK_c = \\frac{[\\mathrm{A_2}]_{eq}}{[\\mathrm{A}]_{eq}^2}\n$$\n因此，无量纲热力学常数为 $K_{eq} = K_c \\cdot c^{\\circ} = (50.0\\ \\mathrm{L\\ mol^{-1}})(1.000\\ \\mathrm{mol\\ L^{-1}}) = 50.0$。计算过程是将平衡浓度的表达式代入 $K_c$ 的定义中：\n$$\nK_c = \\frac{x}{(0.100 - 2x)^2}\n$$\n给定 $K_c = 50.0\\ \\mathrm{L\\ mol^{-1}}$。代入这个值和初始浓度 $[\\mathrm{A}]_0 = 0.100\\ \\mathrm{mol\\ L^{-1}}$，我们得到关于 $x$ 的代数方程：\n$$\n50.0 = \\frac{x}{(0.100 - 2x)^2}\n$$\n这个方程必须整理成标准二次方程形式 $ax^2 + bx + c = 0$。\n$$\n50.0 \\cdot (0.100 - 2x)^2 = x\n$$\n$$\n50.0 \\cdot (0.0100 - 0.400x + 4x^2) = x\n$$\n$$\n0.500 - 20.0x + 200x^2 = x\n$$\n$$\n200x^2 - 21.0x + 0.500 = 0\n$$\n这个关于 $x$ 的二次方程使用求根公式 $x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 求解，其中系数为 $a = 200$, $b = -21.0$, $c = 0.500$。\n$$\nx = \\frac{-(-21.0) \\pm \\sqrt{(-21.0)^2 - 4(200)(0.500)}}{2(200)}\n$$\n$$\nx = \\frac{21.0 \\pm \\sqrt{441 - 400}}{400}\n$$\n$$\nx = \\frac{21.0 \\pm \\sqrt{41}}{400}\n$$\n$x$ 的两个可能的解是：\n$$\nx_1 = \\frac{21.0 + \\sqrt{41}}{400} \\approx \\frac{21.0 + 6.4031}{400} \\approx \\frac{27.4031}{400} \\approx 0.068508\\ \\mathrm{mol\\ L^{-1}}\n$$\n$$\nx_2 = \\frac{21.0 - \\sqrt{41}}{400} \\approx \\frac{21.0 - 6.4031}{400} \\approx \\frac{14.5969}{400} \\approx 0.036492\\ \\mathrm{mol\\ L^{-1}}\n$$\n我们现在必须应用之前推导出的物理约束，$x \\leq 0.050\\ \\mathrm{mol\\ L^{-1}}$。\n第一个根，$x_1 \\approx 0.0685\\ \\mathrm{mol\\ L^{-1}}$，违反了此约束。如果 $x=x_1$，A 的平衡浓度将为 $[\\mathrm{A}]_{eq} = 0.100 - 2(0.0685) = 0.100 - 0.137 = -0.037\\ \\mathrm{mol\\ L^{-1}}$，这在物理上是不可能的。因此，舍弃此根。\n第二个根，$x_2 \\approx 0.036492\\ \\mathrm{mol\\ L^{-1}}$，在有效范围内。此根对应于物理上现实的平衡浓度：\n$$\n[\\mathrm{A_2}]_{eq} = x_2 \\approx 0.036492\\ \\mathrm{mol\\ L^{-1}}\n$$\n$$\n[\\mathrm{A}]_{eq} = 0.100 - 2(0.036492) \\approx 0.100 - 0.072984 \\approx 0.027016\\ \\mathrm{mol\\ L^{-1}}\n$$\n两个浓度都是正值，证实了 $x_2$ 是正确的解。\n问题要求二聚体 $\\mathrm{A_2}$ 的平衡摩尔浓度，即 $x_2$。结果必须四舍五入至四位有效数字。\n$$\n[\\mathrm{A_2}]_{eq} = 0.036492... \\approx 0.03649\\ \\mathrm{mol\\ L^{-1}}\n$$", "answer": "$$\n\\boxed{0.03649}\n$$", "id": "2926237"}, {"introduction": "真实的化学平衡对温度和压力等外部条件非常敏感。这个练习将挑战你定量预测当温度和压力同时改变时，平衡点会如何移动。你需要综合运用范特霍夫方程(van 't Hoff equation)来计算新温度下的平衡常数，并结合勒夏特列原理（Le Châtelier's principle）来分析平衡移动的方向。这个综合性问题[@problem_id:2926227]清晰地展示了不同热力学原理如何协同作用，共同决定最终的平衡状态。", "problem": "在一个总压由外部维持在指定值的封闭、充分搅拌的体系中，一个单步气相反应在理想气体行为下进行：\n$$2\\,\\mathrm{A}(g)\\;\\rightleftharpoons\\;\\mathrm{B}(g).$$\n该反应是放热反应，标准反应焓变 $\\Delta H^\\circ = -50.0\\,\\mathrm{kJ\\,mol^{-1}}$（假设在所考虑的温度范围内，$\\Delta H^\\circ$ 实际上与温度无关）。标准压力为 $P^\\circ = 1\\,\\mathrm{bar}$。在温度 $T_1 = 500\\,\\mathrm{K}$ 时，以分压表示的平衡常数为 $K_p(T_1) = 4.00$（无量纲，由活度 $p_i/P^\\circ$ 定义）。将 $n_{\\mathrm{A},0} = 1.000\\,\\mathrm{mol}$ 的纯 $\\mathrm{A}$（以及 $n_{\\mathrm{B},0} = 0$）在总压 $P_1 = 5.00\\,\\mathrm{bar}$ 和温度 $T_1$下达到平衡。\n\n然后将体系置于新的条件 $T_2 = 600\\,\\mathrm{K}$ 和 $P_2 = 20.0\\,\\mathrm{bar}$ 下，再次使其达到平衡，且在这两个平衡状态之间没有添加或移除任何物质。假设在两种状态下都表现为理想气体行为，并且唯一发生的反应是上面给出的那个。\n\n基于第一性原理、以分压表示的平衡常数和反应商的定义，以及 $K_p(T)$ 的温度依赖性，确定平衡组成如何响应温度和压力的同时增加。哪个选项最能描述 $\\mathrm{B}$ 的平衡摩尔分数的变化方向，并给出其在 $(T_2,P_2)$ 下的近似值？\n\nA. 增加；在 $(T_2,P_2)$ 时 $y_{\\mathrm{B}} \\approx 0.86$。\n\nB. 减少；在 $(T_2,P_2)$ 时 $y_{\\mathrm{B}} \\approx 0.74$。\n\nC. 不变；在 $(T_2,P_2)$ 时 $y_{\\mathrm{B}} \\approx 0.80$。\n\nD. 增加；在 $(T_2,P_2)$ 时 $y_{\\mathrm{B}} \\approx 0.74$。", "solution": "在尝试求解之前，必须首先验证问题陈述的科学合理性和逻辑一致性。\n\n**步骤1：提取已知条件**\n- 反应：$2\\,\\mathrm{A}(g)\\;\\rightleftharpoons\\;\\mathrm{B}(g)$\n- 体系性质：气相，理想气体行为，封闭体系，总压恒定（外部维持）。\n- 热力学数据：$\\Delta H^\\circ = -50.0\\,\\mathrm{kJ\\,mol^{-1}}$（恒定），放热。\n- 标准态：$P^\\circ = 1\\,\\mathrm{bar}$。\n- 初始条件（状态1）：$T_1 = 500\\,\\mathrm{K}$，$P_1 = 5.00\\,\\mathrm{bar}$。\n- $T_1$时的平衡常数：$K_p(T_1) = 4.00$。\n- 初始组成：$n_{\\mathrm{A},0} = 1.000\\,\\mathrm{mol}$，$n_{\\mathrm{B},0} = 0$。\n- 最终条件（状态2）：$T_2 = 600\\,\\mathrm{K}$，$P_2 = 20.0\\,\\mathrm{bar}$。\n- 约束条件：体系是封闭的，因此在状态之间没有质量的添加或移除。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据，依赖于化学热力学的既定原理，包括平衡常数 $K_p$ 的定义及其由 van 't Hoff 方程描述的温度依赖性。该问题提法恰当；它提供了计算两种不同状态下平衡组成所需的所有数据。数据在数值上是合理的，在量纲上是一致的。理想气体行为和恒定反应焓的假设对于此类问题是标准且可接受的简化。问题是客观的，并使用了精确的科学语言。未检测到任何缺陷，如科学不合理、信息缺失或逻辑矛盾。\n\n**步骤3：结论与行动**\n问题陈述有效。将推导解答。\n\n**解题过程推导**\n问题要求计算组分 B 在两种不同状态下的平衡摩尔分数（记为 $y_\\mathrm{B}$）并进行比较。\n\n**第一部分：状态1的平衡 ($T_1 = 500\\,\\mathrm{K}$，$P_1 = 5.00\\,\\mathrm{bar}$)**\n我们从 $n_{\\mathrm{A},0} = 1.000\\,\\mathrm{mol}$ 和 $n_{\\mathrm{B},0} = 0$ 开始。设 $\\xi_1$ 为状态1平衡时的反应进度。平衡时各物质的量为：\n$n_\\mathrm{A,1} = n_{\\mathrm{A},0} - 2\\xi_1 = 1.000 - 2\\xi_1$\n$n_\\mathrm{B,1} = n_{\\mathrm{B},0} + \\xi_1 = \\xi_1$\n平衡时气体的总摩尔数为 $n_{\\mathrm{tot},1} = n_\\mathrm{A,1} + n_\\mathrm{B,1} = (1.000 - 2\\xi_1) + \\xi_1 = 1.000 - \\xi_1$。\n\n平衡分压为 $p_i = y_i P_1$，其中 $y_i$ 是摩尔分数，$y_i = n_i/n_{\\mathrm{tot}}$。\n$p_\\mathrm{A,1} = \\left(\\frac{1.000 - 2\\xi_1}{1.000 - \\xi_1}\\right)P_1$\n$p_\\mathrm{B,1} = \\left(\\frac{\\xi_1}{1.000 - \\xi_1}\\right)P_1$\n\n平衡常数 $K_p$ 定义为：\n$K_p(T_1) = \\frac{(p_\\mathrm{B,1}/P^\\circ)}{(p_\\mathrm{A,1}/P^\\circ)^2} = \\frac{p_\\mathrm{B,1} \\cdot P^\\circ}{p_\\mathrm{A,1}^2}$\n代入分压的表达式：\n$K_p(T_1) = \\frac{\\left(\\frac{\\xi_1}{1.000 - \\xi_1}\\right)P_1 \\cdot P^\\circ}{\\left[\\left(\\frac{1.000 - 2\\xi_1}{1.000 - \\xi_1}\\right)P_1\\right]^2} = \\frac{\\xi_1(1.000 - \\xi_1)}{(1.000 - 2\\xi_1)^2} \\frac{P^\\circ}{P_1}$\n\n已知 $K_p(T_1) = 4.00$，$P_1 = 5.00\\,\\mathrm{bar}$，以及 $P^\\circ = 1\\,\\mathrm{bar}$：\n$4.00 = \\frac{\\xi_1(1.000 - \\xi_1)}{(1.000 - 2\\xi_1)^2} \\frac{1}{5.00}$\n$20.0 = \\frac{\\xi_1 - \\xi_1^2}{1 - 4\\xi_1 + 4\\xi_1^2}$\n$20.0(1 - 4\\xi_1 + 4\\xi_1^2) = \\xi_1 - \\xi_1^2$\n$20.0 - 80.0\\xi_1 + 80.0\\xi_1^2 = \\xi_1 - \\xi_1^2$\n$$81.0\\xi_1^2 - 81.0\\xi_1 + 20.0 = 0$$\n解此关于 $\\xi_1$ 的二次方程：\n$\\xi_1 = \\frac{-(-81.0) \\pm \\sqrt{(-81.0)^2 - 4(81.0)(20.0)}}{2(81.0)} = \\frac{81.0 \\pm \\sqrt{6561 - 6480}}{162} = \\frac{81.0 \\pm \\sqrt{81}}{162} = \\frac{81.0 \\pm 9.0}{162}$\n这给出了两个数学解：$\\xi_1 = \\frac{90.0}{162} \\approx 0.556$ 和 $\\xi_1 = \\frac{72.0}{162} = \\frac{4}{9} \\approx 0.444$。\n为使各物质的量具有物理意义，$n_\\mathrm{A,1} = 1.000 - 2\\xi_1 > 0$，这意味着 $\\xi_1  0.500$。因此，唯一物理上有效的解是 $\\xi_1 = 4/9\\,\\mathrm{mol} \\approx 0.444\\,\\mathrm{mol}$。\n\n状态1下B的平衡摩尔分数为：\n$y_{\\mathrm{B},1} = \\frac{n_\\mathrm{B,1}}{n_{\\mathrm{tot},1}} = \\frac{\\xi_1}{1.000 - \\xi_1} = \\frac{4/9}{1 - 4/9} = \\frac{4/9}{5/9} = \\frac{4}{5} = 0.800$。\n\n**第二部分：状态2的平衡 ($T_2 = 600\\,\\mathrm{K}$，$P_2 = 20.0\\,\\mathrm{bar}$)**\n首先，我们必须使用 van 't Hoff 方程计算新的平衡常数 $K_p(T_2)$：\n$\\ln\\left(\\frac{K_p(T_2)}{K_p(T_1)}\\right) = -\\frac{\\Delta H^\\circ}{R}\\left(\\frac{1}{T_2} - \\frac{1}{T_1}\\right)$\n使用给定值：$\\Delta H^\\circ = -50000\\,\\mathrm{J\\,mol^{-1}}$，$R = 8.314\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$T_1 = 500\\,\\mathrm{K}$，$T_2 = 600\\,\\mathrm{K}$：\n$\\ln\\left(\\frac{K_p(T_2)}{4.00}\\right) = -\\frac{-50000\\,\\mathrm{J\\,mol^{-1}}}{8.314\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}}\\left(\\frac{1}{600\\,\\mathrm{K}} - \\frac{1}{500\\,\\mathrm{K}}\\right)$\n$\\ln\\left(\\frac{K_p(T_2)}{4.00}\\right) = \\frac{50000}{8.314}\\left(\\frac{5 - 6}{3000}\\right) = \\frac{50000}{8.314}\\left(-\\frac{1}{3000}\\right) = -\\frac{50}{3 \\times 8.314} \\approx -2.0047$\n$K_p(T_2) = 4.00 \\times e^{-2.0047} \\approx 4.00 \\times 0.1347 = 0.5388$\n\n现在我们求解在 $T_2$ 和 $P_2$ 下的新平衡组成。设反应进度为 $\\xi_2$。其设置与状态1的形式相同。\n$K_p(T_2) = \\frac{\\xi_2(1.000 - \\xi_2)}{(1.000 - 2\\xi_2)^2} \\frac{P^\\circ}{P_2}$\n$0.5388 = \\frac{\\xi_2(1.000 - \\xi_2)}{(1.000 - 2\\xi_2)^2} \\frac{1.00}{20.0}$\n$10.776 = \\frac{\\xi_2 - \\xi_2^2}{1 - 4\\xi_2 + 4\\xi_2^2}$\n$10.776 - 43.104\\xi_2 + 43.104\\xi_2^2 = \\xi_2 - \\xi_2^2$\n$$44.104\\xi_2^2 - 44.104\\xi_2 + 10.776 = 0$$\n求解 $\\xi_2$：\n$\\xi_2 = \\frac{44.104 \\pm \\sqrt{(-44.104)^2 - 4(44.104)(10.776)}}{2(44.104)} = \\frac{44.104 \\pm \\sqrt{1945.16 - 1900.58}}{88.208} = \\frac{44.104 \\pm \\sqrt{44.58}}{88.208} \\approx \\frac{44.104 \\pm 6.677}{88.208}$\n两个数学解是 $\\xi_2 \\approx \\frac{50.781}{88.208} \\approx 0.576$ 和 $\\xi_2 \\approx \\frac{37.427}{88.208} \\approx 0.424$。\n同样，我们需要 $\\xi_2  0.500$，所以物理上的解是 $\\xi_2 \\approx 0.424\\,\\mathrm{mol}$。\n\n状态2下B的平衡摩尔分数为：\n$y_{\\mathrm{B},2} = \\frac{\\xi_2}{1.000 - \\xi_2} = \\frac{0.424}{1.000 - 0.424} = \\frac{0.424}{0.576} \\approx 0.736$。\n\n**第三部分：比较与结论**\n- 初始摩尔分数：$y_{\\mathrm{B},1} = 0.800$。\n- 最终摩尔分数：$y_{\\mathrm{B},2} \\approx 0.736 \\approx 0.74$。\n- B的摩尔分数从 $0.800$ 减少到约 $0.74$。\n\n这个结果是勒夏特列原理所描述的两种相互竞争效应的后果。对于放热反应（$\\Delta H^\\circ  0$），温度升高（从 $500\\,\\mathrm{K}$ 到 $600\\,\\mathrm{K}$）会使平衡向左移动，减少产物B的量。对于气体摩尔数减少的反应（$\\Delta n_g = 1-2 = -1$），压力增加（从 $5.00\\,\\mathrm{bar}$ 到 $20.0\\,\\mathrm{bar}$）会使平衡向右移动，增加产物B的量。计算表明，对于这些特定的变化，温度效应占主导地位，导致B的摩尔分数净减少。\n\n**逐项分析选项**\n- A. 增加；在 $(T_2,P_2)$ 时 $y_{\\mathrm{B}} \\approx 0.86$。\n  - 变化方向不正确。我们的计算表明 $y_\\mathrm{B}$ 减少。最终值也不正确。\n  - 结论：**错误**。\n\n- B. 减少；在 $(T_2,P_2)$ 时 $y_{\\mathrm{B}} \\approx 0.74$。\n  - 变化方向正确（从 $0.800$ 减少）。计算出的最终值约为 $0.736$，可正确近似为 $0.74$。\n  - 结论：**正确**。\n\n- C. 不变；在 $(T_2,P_2)$ 时 $y_{\\mathrm{B}} \\approx 0.80$。\n  - B的摩尔分数发生了变化。它不是恒定的。\n  - 结论：**错误**。\n\n- D. 增加；在 $(T_2,P_2)$ 时 $y_{\\mathrm{B}} \\approx 0.74$。\n  - 变化方向不正确。虽然数值近似正确，但所述的变化方向是错误的。\n  - 结论：**错误**。", "answer": "$$\\boxed{B}$$", "id": "2926227"}, {"introduction": "本章的顶石实践将引导你进入现代化学工程与物理化学研究的前沿，体验如何通过计算建模来解决复杂的平衡问题。许多重要的工业过程，如水煤气变换反应，在实际操作中可能涉及相变。这项计算练习[@problem_id:2926261]要求你建立一个模型，不仅能求解化学平衡，还能动态处理新相（例如水的冷凝）的出现。你将接触到数值延拓法和灵敏度分析等高级概念，这对于理解和设计复杂的化学反应系统至关重要。", "problem": "要求您在一个封闭的等压容器中，为理想气体水煤气变换反应 $\\mathrm{CO}+\\mathrm{H_2O}\\rightleftharpoons \\mathrm{CO_2}+\\mathrm{H_2}$，实现一个沿温度路径计算平衡组分的连续法计算。计算必须从第一性原理出发，并追踪反应进度随温度的变化。您的程序还必须监测随着温度降低而出现的冷凝水相（液态水），并将此事件识别为控制方程中的一个潜在分岔。如果出现冷凝相，您必须对气相中的水施加饱和约束。计算必须是完全自洽的，且不应需要任何用户输入。\n\n使用的基本依据和假设：\n- 在所考虑的所有温度和压力下，气相均表现为理想气体。\n- 反应为 $\\mathrm{CO}+\\mathrm{H_2O}\\rightleftharpoons \\mathrm{CO_2}+\\mathrm{H_2}$，化学计量反应进度 $\\xi$ 的定义为：对于初始摩尔向量 $\\boldsymbol{n}_0=(n_{\\mathrm{CO},0},n_{\\mathrm{H_2O},0},n_{\\mathrm{CO_2},0},n_{\\mathrm{H_2},0})$，单相条件下的气相摩尔数为\n  $$\n  n_{\\mathrm{CO}}=n_{\\mathrm{CO},0}-\\xi,\\quad\n  n_{\\mathrm{H_2O}}=n_{\\mathrm{H_2O},0}-\\xi,\\quad\n  n_{\\mathrm{CO_2}}=n_{\\mathrm{CO_2},0}+\\xi,\\quad\n  n_{\\mathrm{H_2}}=n_{\\mathrm{H_2},0}+\\xi.\n  $$\n- 以分压表示的平衡常数对所有气体的标准态均为 $1\\ \\mathrm{bar}$，并由下式给出\n  $$\n  K_p(T)=\\exp\\!\\left(-\\frac{\\Delta G^\\circ(T)}{R\\,T}\\right),\n  $$\n  其中 $R=8.314462618\\ \\mathrm{J\\ mol^{-1}\\ K^{-1}}$，您必须使用与温度无关的标准焓变和熵变来近似计算标准吉布斯自由能变，\n  $$\n  \\Delta G^\\circ(T)=\\Delta H^\\circ - T\\,\\Delta S^\\circ,\n  $$\n  其中 $\\Delta H^\\circ=-41.154\\times 10^3\\ \\mathrm{J\\ mol^{-1}}$ 且 $\\Delta S^\\circ=-42.0\\ \\mathrm{J\\ mol^{-1}\\ K^{-1}}$。此近似将在整个温度路径上使用。\n- 在理想气体条件下，质量作用定律适用，\n  $$\n  K_p(T) = \\frac{y_{\\mathrm{CO_2}}\\,y_{\\mathrm{H_2}}}{y_{\\mathrm{CO}}\\,y_{\\mathrm{H_2O}}}\n  $$\n  其中 $y_i$ 是气相摩尔分数。对于此反应，在单气相区，气体总摩尔数是恒定的（化学计量摩尔数变化 $\\Delta\\nu=0$）。\n- 当计算出的水的理想气体分压超过其在相同温度下的饱和压力时，可能会出现冷凝水相（液体）。水的饱和压力必须通过使用对比变量的无量纲 Wagner 方程计算：\n  $$\n  \\ln p_r = \\frac{A\\,\\tau + B\\,\\tau^{3/2} + C\\,\\tau^{3} + D\\,\\tau^{7/2} + E\\,\\tau^{4} + F\\,\\tau^{15/2}}{1-\\tau},\\quad\n  p_r=\\frac{p_{\\mathrm{sat}}(T)}{p_c},\\quad \\tau=1-\\frac{T}{T_c},\n  $$\n  其中水的临界参数为 $T_c=647.096\\ \\mathrm{K}$ 和 $p_c=220.64\\ \\mathrm{bar}$，系数为\n  $$\n  A=-7.85951783,\\ B=1.84408259,\\ C=-11.7866497,\\ D=22.6807411,\\ E=-15.9618719,\\ F=1.80122502.\n  $$\n  对于 $T\\ge T_c$，取 $p_{\\mathrm{sat}}(T)=p_c$ 以确保比较是良定义的。如果在总压力为 $P$ 的系统中，给定温度 $T$ 下的理想气体平衡要求 $y_{\\mathrm{H_2O}}\\,Pp_{\\mathrm{sat}}(T)$，您必须施加两相约束 $y_{\\mathrm{H_2O}}=p_{\\mathrm{sat}}(T)/P$，并相应地在气相中重新施加反应平衡。\n- 当存在冷凝水相时，气相水的摩尔分数由 $y_{\\mathrm{H_2O}}=p_{\\mathrm{sat}}(T)/P$ 固定，且气体总摩尔数不再恒定。在这种情况下，需自洽地施加质量平衡和饱和约束。\n\n需要实现的算法任务：\n1. 对于指定路径上的每个温度 $T$，使用前一个解作为初始猜测值，通过在 $T$ 上进行连续来求解反应进度 $\\xi(T)$ 的平衡问题。\n   - 在单气相区，求解由质量作用定律和化学计量关系得到的标量平衡条件。\n   - 在两相区（有冷凝水），强制执行 $y_{\\mathrm{H_2O}}=p_{\\mathrm{sat}}(T)/P$，并求解由化学计量关系和质量作用定律给出的、可简化为关于 $\\xi(T)$ 的单个标量方程的耦合标量方程组。\n2. 当激活集随着 $T$ 的变化在仅气相约束和两相约束之间切换时，检测“相出现事件”。记录在整个温度路径上是否发生过此类事件。\n3. 通过隐函数定理监测解的灵敏度。对于每个区域，通过对平衡标量方程求导来计算 $\\mathrm{d}\\xi/\\mathrm{d}T$ 的大小，\n   $$\n   \\frac{\\mathrm{d}\\xi}{\\mathrm{d}T}=-\\frac{\\partial F/\\partial T}{\\partial F/\\partial \\xi},\n   $$\n   其中 $F(\\xi,T)=0$ 是当前区域的标量平衡条件。使用如上定义的 $K_p(T)$ 和 $p_{\\mathrm{sat}}(T)$，并在需要时通过关于 $T$ 的对称有限差分来数值计算 $\\partial p_{\\mathrm{sat}}/\\partial T$。计算并存储沿温度路径的 $\\mathrm{d}\\xi/\\mathrm{d}T$ 的最大绝对值，作为分岔风险的标量诊断指标。\n\n需要计算和报告的量：\n- 对于每个测试用例，在使用均匀步长从 $T_{\\mathrm{start}}$ 到 $T_{\\mathrm{end}}$ 追踪解之后，报告最终的气相摩尔分数 $x_{\\mathrm{CO_2}}(T_{\\mathrm{end}})$ 和 $x_{\\mathrm{H_2}}(T_{\\mathrm{end}})$（无量纲），一个布尔值指示在路径上任何地方是否发生了相出现事件，以及在路径上观测到的 $\\mathrm{d}\\xi/\\mathrm{d}T$ 的最大绝对值（单位为 $\\mathrm{mol\\ K^{-1}}$）。所有温度以 $\\mathrm{K}$ 表示，所有压力以 $\\mathrm{bar}$ 表示，摩尔数以 $\\mathrm{mol}$ 表示。报告的浮点数输出应四舍五入到六位小数。\n\n需要实现和覆盖的测试套件：\n- 用例 1（预期出现相变）：$P=20.0\\ \\mathrm{bar}$，$\\boldsymbol{n}_0=(1.0,\\,3.0,\\,0.0,\\,0.0)\\ \\mathrm{mol}$，$T_{\\mathrm{start}}=900.0\\ \\mathrm{K}$，$T_{\\mathrm{end}}=350.0\\ \\mathrm{K}$，$\\Delta T=-50.0\\ \\mathrm{K}$。\n- 用例 2（预期不出现相变）：$P=1.0\\ \\mathrm{bar}$，$\\boldsymbol{n}_0=(1.0,\\,0.10,\\,0.0,\\,0.0)\\ \\mathrm{mol}$，$T_{\\mathrm{start}}=900.0\\ \\mathrm{K}$，$T_{\\mathrm{end}}=350.0\\ \\mathrm{K}$，$\\Delta T=-50.0\\ \\mathrm{K}$。\n- 用例 3（在中等压力下跨越饱和点）：$P=5.0\\ \\mathrm{bar}$，$\\boldsymbol{n}_0=(1.0,\\,1.0,\\,0.0,\\,0.0)\\ \\mathrm{mol}$，$T_{\\mathrm{start}}=700.0\\ \\mathrm{K}$，$T_{\\mathrm{end}}=350.0\\ \\mathrm{K}$，$\\Delta T=-25.0\\ \\mathrm{K}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含所有三个测试用例结果的逗号分隔列表，每个结果都是形如 $[x_{\\mathrm{CO_2}}(T_{\\mathrm{end}}),x_{\\mathrm{H_2}}(T_{\\mathrm{end}}),\\mathrm{phase\\_event},\\max|\\mathrm{d}\\xi/\\mathrm{d}T|]$ 的列表。整行必须是一个有效的 Python 列表字面量，例如：\n```python\n[[0.123456, 0.234567, True, 0.001234], [...], [...]]\n```\n所有浮点数必须四舍五入到六位小数，所有布尔值必须不带引号。", "solution": "该问题要求在一个封闭的等压系统中，沿指定的温度路径，计算水煤气变换反应 $\\mathrm{CO}+\\mathrm{H_2O}\\rightleftharpoons \\mathrm{CO_2}+\\mathrm{H_2}$ 的化学平衡组分。实现时必须考虑水可能发生的冷凝，这代表了系统控制方程中的一个分岔。\n\n首先，我们建立热力学框架。平衡状态由质量作用定律控制。平衡常数 $K_p(T)$ 是温度 $T$ 的函数。鉴于标准焓变 $\\Delta H^\\circ = -41.154 \\times 10^3\\ \\mathrm{J\\ mol^{-1}}$ 和熵变 $\\Delta S^\\circ = -42.0\\ \\mathrm{J\\ mol^{-1}\\ K^{-1}}$ 假定为常数，标准吉布斯自由能变为 $\\Delta G^\\circ(T) = \\Delta H^\\circ - T\\Delta S^\\circ$。则平衡常数由下式给出：\n$$\nK_p(T) = \\exp\\left(-\\frac{\\Delta G^\\circ(T)}{RT}\\right) = \\exp\\left(-\\frac{\\Delta H^\\circ - T\\Delta S^\\circ}{RT}\\right)\n$$\n其中 $R=8.314462618\\ \\mathrm{J\\ mol^{-1}\\ K^{-1}}$ 是通用气体常数。\n\n系统的状态取决于它是以单一气相存在，还是以气相和液态水的两相混合物存在。我们分别分析每个区域。\n\n对于初始摩尔组成为 $\\boldsymbol{n}_0=(n_{\\mathrm{CO},0}, n_{\\mathrm{H_2O},0}, n_{\\mathrm{CO_2},0}, n_{\\mathrm{H_2},0})$，在反应进度为 $\\xi$ 时各物种的摩尔数为：\n$n_{\\mathrm{CO}} = n_{\\mathrm{CO},0} - \\xi$, $n_{\\mathrm{H_2O}} = n_{\\mathrm{H_2O},0} - \\xi$, $n_{\\mathrm{CO_2}} = n_{\\mathrm{CO_2},0} + \\xi$, $n_{\\mathrm{H_2}} = n_{\\mathrm{H_2},0} + \\xi$。\n\n**区域 1：单气相**\n在此区域中，所有组分都以气相存在。化学计量系数之和为 $\\Delta\\nu = (1+1) - (1+1) = 0$，因此气相中的总摩尔数 $n_{gas}$ 是恒定的，等于初始总摩尔数 $n_{tot,0} = \\sum_i n_{i,0}$。摩尔分数 $y_i = n_i / n_{gas}$。质量作用定律为：\n$$\nK_p(T) = \\frac{y_{\\mathrm{CO_2}}\\,y_{\\mathrm{H_2}}}{y_{\\mathrm{CO}}\\,y_{\\mathrm{H_2O}}} = \\frac{(n_{\\mathrm{CO_2},0}+\\xi)(n_{\\mathrm{H_2},0}+\\xi)}{(n_{\\mathrm{CO},0}-\\xi)(n_{\\mathrm{H_2O},0}-\\xi)}\n$$\n这给出了一个关于平衡进度 $\\xi$ 的标量方程。我们定义一个在平衡时为零的残差函数 $F_1(\\xi, T)$：\n$$\nF_1(\\xi, T) = (n_{\\mathrm{CO_2},0}+\\xi)(n_{\\mathrm{H_2},0}+\\xi) - K_p(T)(n_{\\mathrm{CO},0}-\\xi)(n_{\\mathrm{H_2O},0}-\\xi) = 0\n$$\n这是一个关于 $\\xi$ 的二次方程，可以进行数值求解。如果水的的分压 $p_{\\mathrm{H_2O}} = y_{\\mathrm{H_2O}}P$ 不超过在系统温度 $T$ 和总压力 $P$ 下水的饱和压力 $p_{\\mathrm{sat}}(T)$，则单相假设有效。\n\n**区域 2：两相（气相 + 液态水）**\n如果 $p_{\\mathrm{H_2O}}  p_{\\mathrm{sat}}(T)$，水会冷凝，气相被水饱和。此时气相中水的摩尔分数由饱和条件固定：\n$$\ny_{\\mathrm{H_2O,gas}} = \\frac{p_{\\mathrm{sat}}(T)}{P}\n$$\n饱和压力 $p_{\\mathrm{sat}}(T)$ 使用提供的 Wagner 方程计算。在此区域，气相中的总摩尔数 $n_{gas}$ 不再是常数。设 $n_{dry} = n_{\\mathrm{CO,gas}} + n_{\\mathrm{CO_2,gas}} + n_{\\mathrm{H_2,gas}}$。饱和约束意味着 $n_{\\mathrm{H_2O,gas}}/(n_{dry} + n_{\\mathrm{H_2O,gas}}) = p_{\\mathrm{sat}}(T)/P$，由此可得：\n$$\nn_{\\mathrm{H_2O,gas}} = n_{dry} \\frac{p_{\\mathrm{sat}}(T)}{P - p_{\\mathrm{sat}}(T)}\n$$\n气相中不可冷凝物种的摩尔数由总反应进度 $\\xi$ 给出：$n_{\\mathrm{CO,gas}} = n_{\\mathrm{CO},0}-\\xi$, $n_{\\mathrm{CO_2,gas}} = n_{\\mathrm{CO_2},0}+\\xi$, $n_{\\mathrm{H_2,gas}} = n_{\\mathrm{H_2},0}+\\xi$。因此，$n_{dry} = (n_{\\mathrm{CO},0}+n_{\\mathrm{CO_2},0}+n_{\\mathrm{H_2},0}) + \\xi$。现在将质量作用定律应用于气相量：\n$$\nK_p(T) = \\frac{n_{\\mathrm{CO_2,gas}}\\,n_{\\mathrm{H_2,gas}}}{n_{\\mathrm{CO,gas}}\\,n_{\\mathrm{H_2O,gas}}}\n$$\n代入摩尔数的表达式，得到一个新的残差函数 $F_2(\\xi, T)$：\n$$\nF_2(\\xi, T) = (n_{\\mathrm{CO_2},0}+\\xi)(n_{\\mathrm{H_2},0}+\\xi) - K_p(T) \\frac{p_{\\mathrm{sat}}(T)}{P - p_{\\mathrm{sat}}(T)} (n_{\\mathrm{CO},0}-\\xi) \\left( (n_{\\mathrm{CO},0}+n_{\\mathrm{CO_2},0}+n_{\\mathrm{H_2},0}) + \\xi \\right) = 0\n$$\n求解此方程可得到 $\\xi$。只要液态水的量 $n_{\\mathrm{H_2O,liq}} = (n_{\\mathrm{H_2O},0}-\\xi) - n_{\\mathrm{H_2O,gas}}$ 是非负的，两相假设就有效。\n\n**连续法与灵敏度分析**\n解沿着从 $T_{\\mathrm{start}}$ 到 $T_{\\mathrm{end}}$ 的温度路径进行追踪。在每个温度步长，使用数值求根算法求解当前激活区域（$F_1=0$ 或 $F_2=0$）的平衡方程以得到 $\\xi$，并使用上一步的解作为初始猜测值。求解后，执行一致性检查以确定是否发生了相变（区域切换）。如果发生相变，则更新激活区域，将 `phase_event` 标记为 `True`，并使用新的控制方程重新计算 $\\xi$。\n\n解的灵敏度 $\\mathrm{d}\\xi/\\mathrm{d}T$ 通过应用于激活的残差方程 $F(\\xi, T) = 0$ 的隐函数定理计算：\n$$\n\\frac{\\mathrm{d}\\xi}{\\mathrm{d}T} = -\\frac{\\partial F/\\partial T}{\\partial F/\\partial \\xi}\n$$\n偏导数进行解析计算。对于 $F_1$，导数 $\\partial F_1/\\partial T$ 取决于 $\\mathrm{d}K_p/\\mathrm{d}T$，后者由范特霍夫方程给出：$\\mathrm{d}K_p/\\mathrm{d}T = K_p(T) \\Delta H^\\circ / (RT^2)$。对于 $F_2$，导数 $\\partial F_2/\\partial T$ 还涉及 $\\mathrm{d}p_{\\mathrm{sat}}/\\mathrm{d}T$，后者按规定使用对称有限差分格式计算。在整个路径上追踪该灵敏度的最大绝对值。\n\n在最终温度 $T_{\\mathrm{end}}$，根据最终状态（$\\xi$ 和区域）计算气相摩尔分数 $y_{\\mathrm{CO_2}}$ 和 $y_{\\mathrm{H_2}}$，并与 `phase_event` 标志和最大灵敏度 $\\max |\\mathrm{d}\\xi/\\mathrm{d}T|$ 一同报告。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import root_scalar\n\ndef solve():\n    \"\"\"\n    Main solver function that processes all test cases for the water-gas shift reaction.\n    \"\"\"\n\n    # --- Constants ---\n    R = 8.314462618  # J mol^-1 K^-1\n    DH_STD = -41.154e3  # J mol^-1\n    DS_STD = -42.0  # J mol^-1 K^-1\n\n    # Water critical parameters for Wagner equation\n    TC_H2O = 647.096  # K\n    PC_H2O = 220.64  # bar\n\n    # Wagner equation coefficients\n    WAGNER_COEFFS = {\n        'A': -7.85951783, 'B': 1.84408259, 'C': -11.7866497,\n        'D': 22.6807411, 'E': -15.9618719, 'F': 1.80122502\n    }\n\n    # --- Thermodynamic Helper Functions ---\n    def get_Kp(T):\n        \"\"\"Calculates the equilibrium constant Kp at temperature T.\"\"\"\n        dG_std = DH_STD - T * DS_STD\n        return np.exp(-dG_std / (R * T))\n\n    def get_dKp_dT(T, Kp_val):\n        \"\"\"Calculates d(Kp)/dT using the van't Hoff equation.\"\"\"\n        return Kp_val * DH_STD / (R * T**2)\n\n    def get_p_sat(T):\n        \"\"\"Calculates the saturation pressure of water at temperature T using the Wagner equation.\"\"\"\n        if T >= TC_H2O:\n            return PC_H2O\n        \n        tau = 1.0 - T / TC_H2O\n        A, B, C, D, E, F = WAGNER_COEFFS.values()\n        \n        numerator = (A * tau + B * tau**1.5 + C * tau**3 + D * tau**3.5 +\n                     E * tau**4 + F * tau**7.5)\n        denominator = 1.0 - tau\n        \n        ln_pr = numerator / denominator\n        return PC_H2O * np.exp(ln_pr)\n\n    def get_dp_sat_dT(T, h=1e-6):\n        \"\"\"Calculates d(p_sat)/dT numerically using a symmetric finite difference.\"\"\"\n        return (get_p_sat(T + h) - get_p_sat(T - h)) / (2 * h)\n\n    # --- Case Solver ---\n    def solve_case(P, n0_tuple, T_start, T_end, dT):\n        \"\"\"\n        Solves a single test case, tracking equilibrium along the temperature path.\n        \"\"\"\n        n_co0, n_h2o0, n_co20, n_h20 = n0_tuple\n        n_tot0 = sum(n0_tuple)\n        n_dry0_sum = n_co0 + n_co20 + n_h20\n        \n        # Define bounds for reaction extent xi\n        xi_min = max(-n_co20, -n_h20) \n        xi_max = min(n_co0, n_h2o0)\n        xi_bracket = [xi_min + 1e-9, xi_max - 1e-9] # Small offset to avoid issues at boundaries\n\n        # --- Residual and Derivative Functions for Root Finding and Sensitivity ---\n        def F1(xi, T, Kp):\n            # Residual for single-phase (gas only)\n            return (n_co20 + xi) * (n_h20 + xi) - Kp * (n_co0 - xi) * (n_h2o0 - xi)\n\n        def dF1_dxi(xi, Kp):\n            return (n_co20 + xi) + (n_h20 + xi) + Kp * ((n_co0 - xi) + (n_h2o0 - xi))\n\n        def dF1_dT(xi, T, Kp, dKp):\n            return -dKp * (n_co0 - xi) * (n_h2o0 - xi)\n\n        def F2(xi, T, Kp, p_sat):\n            # Residual for two-phase (gas + liquid water)\n            if P = p_sat: return np.inf # Avoid division by zero/negative\n            C_T = p_sat / (P - p_sat)\n            term1 = (n_co20 + xi) * (n_h20 + xi)\n            term2 = Kp * C_T * (n_co0 - xi) * (n_dry0_sum + xi)\n            return term1 - term2\n\n        def dF2_dxi(xi, T, Kp, p_sat):\n            if P = p_sat: return np.inf\n            C_T = p_sat / (P - p_sat)\n            d_term1_dxi = (n_co20 + xi) + (n_h20 + xi)\n            d_term2_dxi = Kp * C_T * (-(n_dry0_sum + xi) + (n_co0 - xi))\n            return d_term1_dxi - d_term2_dxi\n\n        def dF2_dT(xi, T, Kp, dKp, p_sat, dp_sat):\n            if P = p_sat: return np.inf\n            C_T = p_sat / (P - p_sat)\n            dC_T_dT = P * dp_sat / (P - p_sat)**2\n            d_KpC_dT = dKp * C_T + Kp * dC_T_dT\n            return -d_KpC_dT * (n_co0 - xi) * (n_dry0_sum + xi)\n\n        # --- Path Continuation Loop ---\n        T_path = np.arange(T_start, T_end + np.sign(dT) * 1e-9, dT)\n        xi_current = 0.0  # Initial guess for the very first step\n        is_two_phase = False\n        phase_event_occurred = False\n        max_abs_d_xi_dT = 0.0\n\n        for i, T in enumerate(T_path):\n            # Determine initial regime for the first step, or use previous step's regime\n            if i == 0:\n                # Solve assuming single phase first\n                Kp = get_Kp(T)\n                sol = root_scalar(lambda xi: F1(xi, T, Kp), bracket=xi_bracket, x0=xi_current, method='brentq')\n                xi_single_phase = sol.root\n                y_h2o_ideal = (n_h2o0 - xi_single_phase) / n_tot0\n                p_h2o_ideal = y_h2o_ideal * P\n                p_sat = get_p_sat(T)\n                \n                if p_h2o_ideal > p_sat:\n                    is_two_phase = True\n                else:\n                    is_two_phase = False\n            \n            # Solve for current T using previous xi as guess\n            Kp = get_Kp(T)\n            p_sat = get_p_sat(T)\n\n            # Solve based on assumed regime, then check for transition\n            if not is_two_phase:\n                sol = root_scalar(lambda xi: F1(xi, T, Kp), bracket=xi_bracket, x0=xi_current, method='brentq')\n                xi_current = sol.root\n                \n                # Check for transition to two-phase\n                y_h2o_ideal = (n_h2o0 - xi_current) / n_tot0\n                p_h2o_ideal = y_h2o_ideal * P\n                if p_h2o_ideal > p_sat and P > p_sat:\n                    if not phase_event_occurred: phase_event_occurred = True\n                    is_two_phase = True\n                    # Re-solve in the correct regime\n                    sol = root_scalar(lambda xi: F2(xi, T, Kp, p_sat), bracket=xi_bracket, x0=xi_current, method='brentq')\n                    xi_current = sol.root\n            else: # is_two_phase\n                sol = root_scalar(lambda xi: F2(xi, T, Kp, p_sat), bracket=xi_bracket, x0=xi_current, method='brentq')\n                xi_current = sol.root\n                \n                # Check for transition to single-phase\n                n_dry_gas = n_dry0_sum + xi_current\n                if P = p_sat:\n                    n_h2o_gas = n_h2o0 - xi_current\n                else:\n                    n_h2o_gas = n_dry_gas * p_sat / (P - p_sat)\n\n                n_h2o_liq = (n_h2o0 - xi_current) - n_h2o_gas\n                if n_h2o_liq  0:\n                    if not phase_event_occurred: phase_event_occurred = True\n                    is_two_phase = False\n                    # Re-solve in the correct regime\n                    sol = root_scalar(lambda xi: F1(xi, T, Kp), bracket=xi_bracket, x0=xi_current, method='brentq')\n                    xi_current = sol.root\n\n            # --- Sensitivity Calculation ---\n            if not is_two_phase:\n                dKp = get_dKp_dT(T, Kp)\n                df_dxi = dF1_dxi(xi_current, Kp)\n                df_dT = dF1_dT(xi_current, T, Kp, dKp)\n            else: # is_two_phase\n                dKp = get_dKp_dT(T, Kp)\n                dp_sat = get_dp_sat_dT(T)\n                df_dxi = dF2_dxi(xi_current, T, Kp, p_sat)\n                df_dT = dF2_dT(xi_current, T, Kp, dKp, p_sat, dp_sat)\n\n            if abs(df_dxi) > 1e-9:\n                d_xi_dT = -df_dT / df_dxi\n                if abs(d_xi_dT) > max_abs_d_xi_dT:\n                    max_abs_d_xi_dT = abs(d_xi_dT)\n        \n        # --- Final Composition Calculation ---\n        if not is_two_phase:\n            n_co2_final = n_co20 + xi_current\n            n_h2_final = n_h20 + xi_current\n            n_gas_final = n_tot0\n        else:\n            n_co2_final = n_co20 + xi_current\n            n_h2_final = n_h20 + xi_current\n            n_co_final = n_co0 - xi_current\n            n_dry_gas_final = n_co_final + n_co2_final + n_h2_final\n            p_sat_final = get_p_sat(T_end)\n            if P = p_sat_final: # Edge case: at or above critical pressure\n                 n_h2o_gas_final = n_h2o0 - xi_current\n            else:\n                 n_h2o_gas_final = n_dry_gas_final * p_sat_final / (P - p_sat_final)\n            n_gas_final = n_dry_gas_final + n_h2o_gas_final\n        \n        x_co2_final = n_co2_final / n_gas_final\n        x_h2_final = n_h2_final / n_gas_final\n\n        return [round(x_co2_final, 6), round(x_h2_final, 6),\n                phase_event_occurred, round(max_abs_d_xi_dT, 6)]\n\n    # --- Test Suite ---\n    test_cases = [\n        {'P': 20.0,  'n0': (1.0, 3.0, 0.0, 0.0), 'T_start': 900.0, 'T_end': 350.0, 'dT': -50.0},\n        {'P': 1.0,   'n0': (1.0, 0.1, 0.0, 0.0), 'T_start': 900.0, 'T_end': 350.0, 'dT': -50.0},\n        {'P': 5.0,   'n0': (1.0, 1.0, 0.0, 0.0), 'T_start': 700.0, 'T_end': 350.0, 'dT': -25.0},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = solve_case(case['P'], case['n0'], case['T_start'], case['T_end'], case['dT'])\n        results.append(result)\n\n    # Final print statement in the exact required format\n    # Using str() on the list automatically formats booleans as True/False\n    print(f\"[{','.join(map(str, results))}]\".replace(\"'\", \"\"))\n\nsolve()\n```", "id": "2926261"}]}