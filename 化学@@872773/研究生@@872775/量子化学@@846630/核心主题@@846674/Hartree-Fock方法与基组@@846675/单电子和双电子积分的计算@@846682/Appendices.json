{"hands_on_practices": [{"introduction": "在量子化学计算中，一项关键技能并非仅仅是计算积分，而是首先识别出需要计算的最小唯一积分集。这项练习以最简单的氢分子（$\\mathrm{H_2}$）为模型，旨在通过分析其固有的对称性来揭示如何大幅削减计算工作量。通过系统地应用厄米性（Hermiticity）、实值基函数和分子对称性等原理，我们将确定构建其Hartree-Fock矩阵所需的非冗余单电子和双电子积分，这为理解和开发高效的计算方法奠定了概念基础 [@problem_id:2910082]。", "problem": "考虑在固定核间距下，氢分子 $\\mathrm{H_2}$ 的最小原子轨道基组描述。设基组为 $\\{\\chi_A,\\chi_B\\}$，其中 $\\chi_A$ 和 $\\chi_B$ 分别是中心位于原子核 $A$ 和 $B$ 上的实的、归一化的类氢 $1s$ 函数。定义重叠积分为 $S_{\\mu\\nu}=\\langle \\chi_\\mu|\\chi_\\nu\\rangle$，单电子（核心）积分为 $h_{\\mu\\nu}=\\langle \\chi_\\mu|\\hat{T}+\\hat{V}_{ne}|\\chi_\\nu\\rangle$（其中 $\\hat{T}$ 是动能算符，$\\hat{V}_{ne}$ 是针对两个等量核电荷的电子-核吸引算符），以及化学家标记法下的双电子（电子-电子排斥）积分\n$$(\\mu\\nu|\\lambda\\sigma)=\\iint \\chi_\\mu(\\mathbf{r}_1)\\chi_\\nu(\\mathbf{r}_1)\\frac{1}{r_{12}}\\chi_\\lambda(\\mathbf{r}_2)\\chi_\\sigma(\\mathbf{r}_2)\\,d\\mathbf{r}_1\\,d\\mathbf{r}_2.$$\n假设原子核是相同的，分子是共线的，且中点处存在一个反演中心，并假设所有基函数都是实的且各自归一化。仅使用这些定义和对称性论据（厄米性、实值性、同核交换 $A\\leftrightarrow B$ 以及 $(\\mu\\nu|\\lambda\\sigma)$ 的内在置换对称性），选择一个选项，该选项正确地指出了在原子轨道基组中为构建 $\\mathrm{H_2}$ 的 Hartree–Fock Fock 矩阵所必须计算的非冗余单电子和双电子积分的最小独立集，以及用于消除相应积分族中所有其他成员的对称性诱导等式。\n\nA. 独立集：\n- 重叠积分：$S_{AB}$（根据归一化有 $S_{AA}=S_{BB}=1$，根据厄米性有 $S_{BA}=S_{AB}$）。\n- 单电子核心积分：$h_{AA}$ 和 $h_{AB}$（根据 $A\\leftrightarrow B$ 有 $h_{BB}=h_{AA}$，根据厄米性有 $h_{BA}=h_{AB}$）。\n- 双电子积分：$(AA|AA)$、$(AA|BB)$、$(AB|AB)$、$(AA|AB)$。\n冗余性：根据 $A\\leftrightarrow B$ 有 $(BB|BB)=(AA|AA)$；根据 $A\\leftrightarrow B$ 有 $(BB|AB)=(AA|AB)$；对于实轨道，所有其他指标置换都遵循 $(\\mu\\nu|\\lambda\\sigma)=(\\nu\\mu|\\lambda\\sigma)=(\\mu\\nu|\\sigma\\lambda)=(\\lambda\\sigma|\\mu\\nu)$。\n\nB. 独立集：\n- 重叠积分：除 $S_{AA}=S_{BB}=1$ 外没有其他；由于不同中心的轨道正交，$S_{AB}=0$。\n- 单电子核心积分：仅 $h_{AA}$；由于正交性，$h_{AB}=0$。\n- 双电子积分：仅 $(AA|AA)$ 和 $(AA|BB)$；所有像 $(AA|AB)$ 这样的混合中心三指标项都因反演对称性而消失；$(AB|AB)=0$ 因为 $\\chi_A$ 和 $\\chi_B$ 不重叠。\n\nC. 独立集：\n- 重叠积分：$S_{AA}$、$S_{BB}$、$S_{AB}$（均不相同）。\n- 单电子核心积分：$h_{AA}$、$h_{BB}$、$h_{AB}$、$h_{BA}$（均不相同）。\n- 双电子积分：$(AA|AA)$、$(BB|BB)$、$(AA|BB)$、$(AB|AB)$、$(AB|BA)$、$(AA|AB)$、$(BB|AB)$（均不相同）。\n冗余性：除 $(\\mu\\nu|\\lambda\\sigma)=(\\nu\\mu|\\lambda\\sigma)$ 外没有其他。\n\nD. 独立集：\n- 使用对称匹配的分子轨道，因此只需要 $S_{gg}=S_{uu}=1$ 以及 $h_{gg}$、$h_{uu}$；非对角单电子积分和所有三中心双电子积分因对称性而消失；双电子积分仅简化为 $(gg|gg)$ 和 $(uu|uu)$。\n冗余性：在所选基组中所有其他积分都为零；不需要计算原子轨道的双中心积分。\n\n哪个选项是正确的？", "solution": "对问题陈述进行验证。\n\n**第 1 步：提取已知条件**\n- **体系：** 氢分子 $\\mathrm{H_2}$，在固定核间距下。\n- **基组：** 最小原子轨道 (AO) 基组 $\\{\\chi_A,\\chi_B\\}$。\n- **基函数：** $\\chi_A$ 和 $\\chi_B$ 是分别以原子核 $A$ 和 $B$ 为中心的实的、归一化的类氢 $1s$ 函数。\n- **对称性：** 原子核相同；分子具有反演中心。\n- **归一化：** 基函数各自归一化。\n- **积分定义：**\n    - 重叠积分：$S_{\\mu\\nu}=\\langle \\chi_\\mu|\\chi_\\nu\\rangle$。\n    - 单电子核心积分：$h_{\\mu\\nu}=\\langle \\chi_\\mu|\\hat{T}+\\hat{V}_{ne}|\\chi_\\nu\\rangle$。\n    - 双电子排斥积分（化学家标记法）：$(\\mu\\nu|\\lambda\\sigma)=\\iint \\chi_\\mu(\\mathbf{r}_1)\\chi_\\nu(\\mathbf{r}_1)\\frac{1}{r_{12}}\\chi_\\lambda(\\mathbf{r}_2)\\chi_\\sigma(\\mathbf{r}_2)\\,d\\mathbf{r}_1\\,d\\mathbf{r}_2$。\n- **任务：** 在原子轨道基组中，确定独立的单电子和双电子积分的最小集合，以及使所有其他积分变得冗余的对称关系。\n\n**第 2 步：使用提取的已知条件进行验证**\n该问题具有科学依据，提法明确且客观。它提出了计算量子化学中的一个标准的、基本的问题：即对最简单的同核双原子分子进行 Hartree-Fock 计算所需的唯一矩阵元（积分）的枚举。算符和积分的定义是标准的。所指定的对称性（厄米性、实值性、核交换）陈述正确，并且是进行分析所需的确切工具。该问题是自洽的，没有矛盾或含糊之处。\n\n**第 3 步：结论与行动**\n问题陈述是**有效的**。将推导解答。\n\n任务是通过应用给定的对称性原理，确定在原子轨道基组 $\\{\\chi_\\mu\\} = \\{\\chi_A, \\chi_B\\}$ 上的唯一单电子和双电子积分集。\n\n**1. 重叠积分 ($S_{\\mu\\nu}$)**\n重叠矩阵 $\\mathbf{S}$ 的元素为 $S_{\\mu\\nu} = \\langle\\chi_\\mu|\\chi_\\nu\\rangle$。\n- **归一化：** 基函数是归一化的，所以 $S_{AA} = \\langle\\chi_A|\\chi_A\\rangle = 1$ 且 $S_{BB} = \\langle\\chi_B|\\chi_B\\rangle = 1$。这些不是需要计算的积分，而是由定义固定的。\n- **厄米性：** 内积是厄米的，所以 $S_{\\mu\\nu} = S_{\\nu\\mu}^*$。由于基函数是实的，这简化为 $S_{\\mu\\nu} = S_{\\nu\\mu}$。因此，$S_{AB} = S_{BA}$。\n- **同核交换 ($A \\leftrightarrow B$)：** 通过交换相同的原子核，体系保持不变。此操作将 $\\chi_A \\to \\chi_B$ 和 $\\chi_B \\to \\chi_A$。\n    - $S_{AA} = \\langle\\chi_A|\\chi_A\\rangle \\xrightarrow{A\\leftrightarrow B} \\langle\\chi_B|\\chi_B\\rangle = S_{BB}$。这证实了 $S_{AA} = S_{BB}$，与归一化一致。\n- **结论：** 在 $\\mathbf{S}$ 矩阵的四个形式条目中，只有一个，即 $S_{AB}$，是必须计算的独立的、非平凡的积分。\n\n**2. 单电子核心积分 ($h_{\\mu\\nu}$)**\n核心哈密顿矩阵 $\\mathbf{h}$ 的元素为 $h_{\\mu\\nu} = \\langle\\chi_\\mu|\\hat{h}|\\chi_\\nu\\rangle$，其中核心哈密顿算符 $\\hat{h}=\\hat{T}+\\hat{V}_{ne}$ 对核交换是对称的。\n- **厄米性：** $\\hat{h}$ 是一个厄米算符。对于实基组，这意味着 $h_{\\mu\\nu} = h_{\\nu\\mu}$。因此，$h_{AB} = h_{BA}$。\n- **同核交换 ($A \\leftrightarrow B$)：**\n    - $h_{AA} = \\langle\\chi_A|\\hat{h}|\\chi_A\\rangle \\xrightarrow{A\\leftrightarrow B} \\langle\\chi_B|\\hat{h}|\\chi_B\\rangle = h_{BB}$。\n- **结论：** 在 $\\mathbf{h}$ 矩阵的四个条目中，只有两个独立的积分需要计算：库仑型积分 $h_{AA}$ 和共振积分 $h_{AB}$。\n\n**3. 双电子积分 ($(\\mu\\nu|\\lambda\\sigma)$)**\n共有 $2^4 = 16$ 个这样的积分。我们利用对称性来减少这个数目。\n- **内在置换对称性（实轨道）：** 积分的定义导致了几个恒等式。\n    1.  $(\\mu\\nu|\\lambda\\sigma) = (\\nu\\mu|\\lambda\\sigma)$（电子 1 分布内的对称性）\n    2.  $(\\mu\\nu|\\lambda\\sigma) = (\\mu\\nu|\\sigma\\lambda)$（电子 2 分布内的对称性）\n    3.  $(\\mu\\nu|\\lambda\\sigma) = (\\lambda\\sigma|\\mu\\nu)$（交换电子 1 和 2 的坐标）\n    这些关系共同为一般指标生成了 8 重置换对称性。\n- **同核交换 ($A \\leftrightarrow B$)：** 这个对称性通过交换所有 $A$ 和 $B$ 标签来关联积分。\n\n让我们枚举不同类别的积分：\n- **单中心：** $(AA|AA)$。积分 $(BB|BB)$ 通过同核对称性相关：$(BB|BB) = (AA|AA)$。这是一个独立的积分。\n- **双中心，库仑型：** $(AA|BB)$。注意 $(\\mu\\nu|\\lambda\\sigma) = (\\lambda\\sigma|\\mu\\nu)$ 意味着 $(AA|BB) = (BB|AA)$，这从同核对称性也很明显。这是第二个独立的积分。\n- **双中心，杂化型：** $(AA|AB)$。形式上有 8 个这类积分（3 个同类指标，1 个另一类），例如 $(AA|BA)$、$(AB|AA)$、$(BB|AB)$ 等。\n    - 内在对称性：$(AA|AB) = (AA|BA)$ 和 $(AA|AB) = (AB|AA)$。所有不改变指标计数的 $(AA|AB)$ 的置换都相等。\n    - 同核对称性：$(AA|AB) \\xrightarrow{A\\leftrightarrow B} (BB|BA)$。\n    - 我们从内在对称性知道 $(BB|BA) = (BB|AB)$。因此，所有具有三个相同指标和一个不同指标的积分都与 $(AA|AB)$ 相关。这是第三个独立的积分。\n- **双中心，交换型：** $(AB|AB)$。形式上有 4 个这类积分，$(AB|AB)$、$(AB|BA)$、$(BA|AB)$ 和 $(BA|BA)$。\n    - 内在对称性表明它们都相等。例如，根据对称性 (1)，$(AB|AB) = (BA|AB)$。同样，根据对称性 (2)，$(AB|AB) = (AB|BA)$。最后，从对称性 (3) 可得 $(AB|AB) = (AB|AB)$。因此我们有 $(AB|AB) = (BA|AB) = (AB|BA) = (BA|BA)$。这是第四个独立的积分。\n\n**独立积分总结：**\n- **重叠积分：** $S_{AB}$（1 个值）\n- **单电子积分：** $h_{AA}$、$h_{AB}$（2 个值）\n- **双电子积分：** $(AA|AA)$、$(AA|BB)$、$(AA|AB)$、$(AB|AB)$（4 个值）\n\n现在，我们评估给出的选项。\n\n**选项 A 分析**\n- **独立集：** 提出了 $S_{AB}$；$h_{AA}$ 和 $h_{AB}$；以及 $(AA|AA)$、$(AA|BB)$、$(AB|AB)$、$(AA|AB)$。这与我们推导出的最小独立集完全匹配。\n- **冗余性：**\n    - 正确陈述了 $S_{AA}=S_{BB}=1$ 和 $S_{BA}=S_{AB}$。\n    - 正确陈述了 $h_{BB}=h_{AA}$ 和 $h_{BA}=h_{AB}$。\n    - 正确陈述了 $(BB|BB)=(AA|AA)$。\n    - 正确陈述了 $(BB|AB) = (AA|AB)$。如推导所示，$(AA|AB) \\xrightarrow{A\\leftrightarrow B} (BB|BA)$。并且根据内在置换对称性，$(BB|BA) = (BB|AB)$。所以该关系成立。\n    - 正确地将其他冗余的来源归结为内在置换对称性。\n该选项对问题进行了完整且正确的说明。\n**结论：正确**\n\n**选项 B 分析**\n- 该选项声称 $S_{AB}=0$ 和 $h_{AB}=0$，因为不同中心的原子轨道是正交的。这个前提根本上是错误的。在分子环境中，原子轨道是非正交的，它们的重叠对于描述化学键至关重要。对于 $1s$ 轨道，$S_{AB} > 0$。$h_{AB}$ 积分是共振积分，它也是非零的负值，是键能的主要来源。\n- 它进一步声称诸如 $(AA|AB)$ 和 $(AB|AB)$ 之类的积分为零，这也是不正确的，并且源于同样错误的前提。重叠密度 $\\chi_A(\\mathbf{r})\\chi_B(\\mathbf{r})$ 不为零，因此 $(AB|AB)$ 不为零。\n**结论：错误**\n\n**选项 C 分析**\n- 该选项声称 $S_{AA}$、$S_{BB}$、$S_{AB}$ 都不同，这违反了同核对称性 ($S_{AA}=S_{BB}=1$)。\n- 它声称 $h_{AA}, h_{BB}, h_{AB}, h_{BA}$ 都不同，这既违反了同核对称性 ($h_{AA}=h_{BB}$) 又违反了厄米性 ($h_{AB}=h_{BA}$) 。\n- 它将大量双电子积分列为不同的，未能应用同核对称性（例如 $(AA|AA)=(BB|BB)$）和内在置换对称性（例如 $(AB|AB)=(AB|BA)$）。\n- 该选项表明，除了最微不足道的一个对称性之外，未能应用任何相关的对称性。\n**结论：错误**\n\n**选项 D 分析**\n- 该选项建议从原子轨道 (AO) 基组切换到对称匹配的分子轨道 (MO) 基组。问题明确要求**在原子轨道基组中**进行分析。因此，该选项没有回答所提出的问题。\n- 此外，其关于 MO 基组的说法本身也是有缺陷的。虽然在 MO 基组中一些非对角和奇对称性的积分确实为零（例如 $\\langle g | \\hat{h} | u \\rangle = 0$，$(gg|gu)=0$），但它错误地声称双电子积分仅简化为 $(gg|gg)$ 和 $(uu|uu)$。这是错误的；积分 $(gg|uu)$（库仑积分）和 $(gu|gu)$（交换积分）也是非零的，并且对于描述电子相关和激发态至关重要。\n**结论：错误**\n\n基于对对称性原理的严格应用，只有选项 A 提供了对原子轨道基组中独立积分及其相关冗余关系的正确和完整描述。", "answer": "$$\\boxed{A}$$", "id": "2910082"}, {"introduction": "确定了需要计算哪些积分之后，我们必须面对如何稳健地进行计算的挑战。看似直接的公式可能隐藏着数值计算的陷阱，尤其是在处理近似线性相关的基函数时。本练习通过分析两个指数非常接近的弥散高斯函数，深入探讨了“灾难性相消”（catastrophic cancellation）这一普遍问题 [@problem_id:2910089]。您将通过推导和渐近展开，学会如何诊断并解决这种数值不稳定性，从而掌握构建在极限情况下依然可靠的计算公式的核心技巧。", "problem": "考虑两个以原子单位制原点为中心的实数、归一化的 $s$ 型高斯基函数 (GTO)，定义为 $\\phi_{\\alpha}(\\mathbf{r}) = N_{\\alpha} \\exp(-\\alpha r^{2})$ 和 $\\phi_{\\beta}(\\mathbf{r}) = N_{\\beta} \\exp(-\\beta r^{2})$，其中 $N_{\\alpha}$ 和 $N_{\\beta}$ 是归一化常数，且 $r = |\\mathbf{r}|$。设动能算符为 $\\hat{T} = -\\frac{1}{2}\\nabla^{2}$。令指数满足 $\\beta = \\alpha(1+\\varepsilon)$，其中 $0 < \\varepsilon \\ll 1$，并选择具体数值 $\\alpha = 1.0 \\times 10^{-4}$ 和 $\\varepsilon = 1.0 \\times 10^{-8}$。\n\n仅从归一化、重叠积分和动能积分的定义以及标准的三维高斯积分出发，完成以下任务：\n\n- 推导这两个函数之间的重叠积分 $S_{\\alpha\\beta} = \\langle \\phi_{\\alpha} | \\phi_{\\beta} \\rangle$ 和动能积分 $T_{\\alpha\\beta} = \\langle \\phi_{\\alpha} | \\hat{T} | \\phi_{\\beta} \\rangle$ 的封闭形式表达式。\n- 使用这些表达式，构造归一化的差分组合 $\\chi_{-} = (\\phi_{\\alpha} - \\phi_{\\beta})/\\sqrt{2(1 - S_{\\alpha\\beta})}$，并推导其动能期望值的精确表达式\n$$E_{-} = \\frac{\\langle \\chi_{-} | \\hat{T} | \\chi_{-} \\rangle}{\\langle \\chi_{-} | \\chi_{-} \\rangle} = \\frac{T_{\\alpha\\alpha} + T_{\\beta\\beta} - 2 T_{\\alpha\\beta}}{2(1 - S_{\\alpha\\beta})}.$$\n- 通过按 $\\varepsilon$ 的幂次展开，解析地证明当 $\\varepsilon \\to 0$ 时，$E_{-}$ 的分子和分母均表现出首项相消（有效数字损失）的现象，并求出 $E_{-}$ 关于 $\\varepsilon$ 展开的首项。\n\n最后，使用你推导出的渐近展开式，计算当 $\\alpha = 1.0 \\times 10^{-4}$ 和 $\\varepsilon = 1.0 \\times 10^{-8}$ 时的 $E_{-}$ 值，以避免灾难性抵消，并以哈特里 (hartree) 为单位报告结果。将你的答案四舍五入到四位有效数字。", "solution": "经评估，问题陈述是有效的。它在科学上基于量子力学原理和使用高斯型函数对原子轨道进行的数学描述。该问题提法明确，为得到唯一解提供了所有必要信息。该问题探讨了计算量子化学中的一个基本问题：由基组中近似线性相关引起的数值不稳定性。我们将进行完整的推导和分析。\n\n我们首先推导必要的积分表达式。高斯基函数 (GTO) 给出为 $\\phi_{\\alpha}(\\mathbf{r}) = N_{\\alpha} \\exp(-\\alpha r^{2})$ 和 $\\phi_{\\beta}(\\mathbf{r}) = N_{\\beta} \\exp(-\\beta r^{2})$。\n\n首先，我们通过要求 $\\langle \\phi_{\\gamma} | \\phi_{\\gamma} \\rangle = 1$ 来确定一个通用 $s$ 型 GTO $\\phi_{\\gamma}$ 的归一化常数 $N_{\\gamma}$。积分遍及整个空间 $d^3r$。\n$$ \\langle \\phi_{\\gamma} | \\phi_{\\gamma} \\rangle = \\int \\left[ N_{\\gamma} \\exp(-\\gamma r^2) \\right]^2 d^3r = N_{\\gamma}^2 \\int \\exp(-2\\gamma r^2) d^3r = 1 $$\n标准的三维高斯积分为 $\\int \\exp(-ar^2)d^3r = (\\frac{\\pi}{a})^{3/2}$。令 $a=2\\gamma$ 并使用该公式，我们得到：\n$$ N_{\\gamma}^2 \\left(\\frac{\\pi}{2\\gamma}\\right)^{3/2} = 1 \\implies N_{\\gamma} = \\left(\\frac{2\\gamma}{\\pi}\\right)^{3/4} $$\n因此，$N_{\\alpha} = (\\frac{2\\alpha}{\\pi})^{3/4}$ 且 $N_{\\beta} = (\\frac{2\\beta}{\\pi})^{3/4}$。\n\n接下来，我们推导重叠积分 $S_{\\alpha\\beta} = \\langle \\phi_{\\alpha} | \\phi_{\\beta} \\rangle$。\n$$ S_{\\alpha\\beta} = \\int N_{\\alpha} \\exp(-\\alpha r^2) N_{\\beta} \\exp(-\\beta r^2) d^3r = N_{\\alpha} N_{\\beta} \\int \\exp(-(\\alpha+\\beta)r^2) d^3r $$\n使用高斯积分公式，并令 $a = \\alpha+\\beta$：\n$$ S_{\\alpha\\beta} = N_{\\alpha} N_{\\beta} \\left(\\frac{\\pi}{\\alpha+\\beta}\\right)^{3/2} = \\left(\\frac{2\\alpha}{\\pi}\\right)^{3/4} \\left(\\frac{2\\beta}{\\pi}\\right)^{3/4} \\left(\\frac{\\pi}{\\alpha+\\beta}\\right)^{3/2} $$\n$$ S_{\\alpha\\beta} = \\frac{(4\\alpha\\beta)^{3/4}}{\\pi^{3/2}} \\frac{\\pi^{3/2}}{(\\alpha+\\beta)^{3/2}} = \\left( \\frac{4\\alpha\\beta}{(\\alpha+\\beta)^2} \\right)^{3/4} $$\n\n现在，我们推导动能积分 $T_{\\alpha\\beta} = \\langle \\phi_{\\alpha} | \\hat{T} | \\phi_{\\beta} \\rangle$，其中 $\\hat{T} = -\\frac{1}{2}\\nabla^2$。\n$$ T_{\\alpha\\beta} = \\int \\phi_{\\alpha}(\\mathbf{r}) \\left(-\\frac{1}{2}\\nabla^2\\right) \\phi_{\\beta}(\\mathbf{r}) d^3r $$\n我们必须先计算 $\\nabla^2 \\phi_{\\beta}(\\mathbf{r})$：\n$$ \\nabla^2 \\phi_{\\beta} = \\nabla^2 \\left[ N_{\\beta} \\exp(-\\beta r^2) \\right] = N_{\\beta} \\left( \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2} + \\frac{\\partial^2}{\\partial z^2} \\right) \\exp(-\\beta(x^2+y^2+z^2)) $$\n关于 $x$ 的二阶偏导数为：\n$$ \\frac{\\partial^2}{\\partial x^2} \\exp(-\\beta r^2) = \\frac{\\partial}{\\partial x} [-2\\beta x \\exp(-\\beta r^2)] = [-2\\beta + 4\\beta^2 x^2] \\exp(-\\beta r^2) $$\n将 $x$、$y$ 和 $z$ 的贡献相加：\n$$ \\nabla^2 \\phi_{\\beta} = N_{\\beta} [-6\\beta + 4\\beta^2 (x^2+y^2+z^2)] \\exp(-\\beta r^2) = N_{\\beta} (4\\beta^2 r^2 - 6\\beta) \\exp(-\\beta r^2) $$\n将此代入 $T_{\\alpha\\beta}$ 的积分中：\n$$ T_{\\alpha\\beta} = -\\frac{1}{2} \\int N_{\\alpha}\\exp(-\\alpha r^2) N_{\\beta}(4\\beta^2 r^2 - 6\\beta) \\exp(-\\beta r^2) d^3r $$\n$$ T_{\\alpha\\beta} = N_{\\alpha} N_{\\beta} \\int (3\\beta - 2\\beta^2 r^2) \\exp(-(\\alpha+\\beta)r^2) d^3r $$\n令 $p = \\alpha+\\beta$。该积分可分为两部分：\n$$ T_{\\alpha\\beta} = 3\\beta N_{\\alpha} N_{\\beta} \\int \\exp(-p r^2) d^3r - 2\\beta^2 N_{\\alpha} N_{\\beta} \\int r^2 \\exp(-p r^2) d^3r $$\n第一部分是 $3\\beta S_{\\alpha\\beta}$。第二部分的积分可以通过对基本高斯积分关于参数 $p$ 求导来计算：\n$$ \\int r^2 \\exp(-p r^2) d^3r = -\\frac{\\partial}{\\partial p} \\int \\exp(-p r^2) d^3r = -\\frac{\\partial}{\\partial p} \\left(\\frac{\\pi}{p}\\right)^{3/2} = - \\pi^{3/2} \\left(-\\frac{3}{2} p^{-5/2}\\right) = \\frac{3}{2p} \\left(\\frac{\\pi}{p}\\right)^{3/2} $$\n将其代回：\n$$ T_{\\alpha\\beta} = 3\\beta S_{\\alpha\\beta} - 2\\beta^2 N_{\\alpha} N_{\\beta} \\left( \\frac{3}{2(\\alpha+\\beta)} \\left(\\frac{\\pi}{\\alpha+\\beta}\\right)^{3/2} \\right) = 3\\beta S_{\\alpha\\beta} - \\frac{3\\beta^2}{\\alpha+\\beta} S_{\\alpha\\beta} $$\n$$ T_{\\alpha\\beta} = \\left( 3\\beta - \\frac{3\\beta^2}{\\alpha+\\beta} \\right) S_{\\alpha\\beta} = 3\\beta \\left( \\frac{\\alpha+\\beta-\\beta}{\\alpha+\\beta} \\right) S_{\\alpha\\beta} = \\frac{3\\alpha\\beta}{\\alpha+\\beta} S_{\\alpha\\beta} $$\n对于对角元，有 $S_{\\alpha\\alpha}=1$ 和 $S_{\\beta\\beta}=1$：\n$$ T_{\\alpha\\alpha} = \\frac{3\\alpha^2}{2\\alpha}S_{\\alpha\\alpha} = \\frac{3}{2}\\alpha \\quad \\text{和} \\quad T_{\\beta\\beta} = \\frac{3\\beta^2}{2\\beta}S_{\\beta\\beta} = \\frac{3}{2}\\beta $$\n期望值 $E_{-}$ 由下式给出：\n$$ E_{-} = \\frac{T_{\\alpha\\alpha} + T_{\\beta\\beta} - 2 T_{\\alpha\\beta}}{2(1 - S_{\\alpha\\beta})} = \\frac{\\frac{3}{2}(\\alpha+\\beta) - 2 \\left(\\frac{3\\alpha\\beta}{\\alpha+\\beta}\\right) S_{\\alpha\\beta}}{2(1 - S_{\\alpha\\beta})} $$\n我们已知 $\\beta = \\alpha(1+\\varepsilon)$，其中 $0 < \\varepsilon \\ll 1$。当 $\\varepsilon \\to 0$ 时，$\\beta \\to \\alpha$，$S_{\\alpha\\beta} \\to S_{\\alpha\\alpha} = 1$。$E_{-}$ 的分子和分母都趋近于 $0$，这表明由于灾难性抵消而导致数值不稳定。为了求出极限值，我们必须将各分量按 $\\varepsilon$ 的幂次展开。\n\n$S_{\\alpha\\beta}$ 的展开：\n$$ \\frac{4\\alpha\\beta}{(\\alpha+\\beta)^2} = \\frac{4\\alpha^2(1+\\varepsilon)}{(\\alpha+\\alpha(1+\\varepsilon))^2} = \\frac{4(1+\\varepsilon)}{(2+\\varepsilon)^2} = \\frac{1+\\varepsilon}{(1+\\varepsilon/2)^2} $$\n令 $u = \\varepsilon/2$。其参数为 $\\frac{1+2u}{(1+u)^2} = (1+2u)(1-2u+3u^2-\\dots) = 1-u^2+O(u^3) = 1 - \\frac{\\varepsilon^2}{4} + O(\\varepsilon^3)$。\n所以，$S_{\\alpha\\beta} = \\left(1 - \\frac{\\varepsilon^2}{4} + O(\\varepsilon^3)\\right)^{3/4}$。使用二项式展开 $(1+x)^k \\approx 1+kx$：\n$$ S_{\\alpha\\beta} = 1 - \\frac{3}{4}\\left(\\frac{\\varepsilon^2}{4}\\right) + O(\\varepsilon^4) = 1 - \\frac{3}{16}\\varepsilon^2 + O(\\varepsilon^4) $$\n那么 $E_{-}$ 的分母是：\n$$ 2(1 - S_{\\alpha\\beta}) = 2\\left(1 - \\left(1 - \\frac{3}{16}\\varepsilon^2\\right)\\right) + O(\\varepsilon^4) = \\frac{3}{8}\\varepsilon^2 + O(\\varepsilon^4) $$\n分母以 $\\varepsilon^2$ 的速度趋于零。\n\n分子 $Num = T_{\\alpha\\alpha} + T_{\\beta\\beta} - 2 T_{\\alpha\\beta}$ 的展开：\n$$ Num = \\frac{3}{2}\\alpha + \\frac{3}{2}\\alpha(1+\\varepsilon) - 2 T_{\\alpha\\beta} = \\frac{3}{2}\\alpha(2+\\varepsilon) - 2 T_{\\alpha\\beta} = 3\\alpha(1+\\varepsilon/2) - 2 T_{\\alpha\\beta} $$\n$T_{\\alpha\\beta}$ 中的系数为 $\\frac{3\\alpha\\beta}{\\alpha+\\beta} = \\frac{3\\alpha^2(1+\\varepsilon)}{\\alpha(2+\\varepsilon)} = \\frac{3\\alpha(1+\\varepsilon)}{2+\\varepsilon} = \\frac{3}{2}\\alpha \\frac{1+\\varepsilon}{1+\\varepsilon/2}$。\n该分数展开为 $\\frac{1+\\varepsilon}{1+\\varepsilon/2} = (1+\\varepsilon)(1-\\varepsilon/2+\\varepsilon^2/4-\\dots) = 1+\\frac{\\varepsilon}{2}-\\frac{\\varepsilon^2}{4}+O(\\varepsilon^3)$。\n所以，$T_{\\alpha\\beta} = \\left(\\frac{3}{2}\\alpha \\left(1+\\frac{\\varepsilon}{2}-\\frac{\\varepsilon^2}{4}+O(\\varepsilon^3)\\right)\\right) \\left(1 - \\frac{3}{16}\\varepsilon^2 + O(\\varepsilon^4)\\right)$。\n$$ T_{\\alpha\\beta} = \\frac{3}{2}\\alpha \\left[ 1+\\frac{\\varepsilon}{2}-\\frac{\\varepsilon^2}{4} - \\frac{3}{16}\\varepsilon^2 \\right] + O(\\varepsilon^3) = \\frac{3}{2}\\alpha \\left[ 1+\\frac{\\varepsilon}{2}-\\frac{7}{16}\\varepsilon^2 \\right] + O(\\varepsilon^3) $$\n$$ 2T_{\\alpha\\beta} = 3\\alpha \\left[ 1+\\frac{\\varepsilon}{2}-\\frac{7}{16}\\varepsilon^2 \\right] + O(\\varepsilon^3) = 3\\alpha + \\frac{3}{2}\\alpha\\varepsilon - \\frac{21}{16}\\alpha\\varepsilon^2 + O(\\varepsilon^3) $$\n代入分子的表达式中：\n$$ Num = (3\\alpha + \\frac{3}{2}\\alpha\\varepsilon) - \\left(3\\alpha + \\frac{3}{2}\\alpha\\varepsilon - \\frac{21}{16}\\alpha\\varepsilon^2\\right) + O(\\varepsilon^3) = \\frac{21}{16}\\alpha\\varepsilon^2 + O(\\varepsilon^3) $$\n分子也以 $\\varepsilon^2$ 的速度趋于零，这证明了相消现象。\n\n现在我们计算 $E_{-}$ 的极限：\n$$ E_{-} = \\frac{\\frac{21}{16}\\alpha\\varepsilon^2 + O(\\varepsilon^3)}{\\frac{3}{8}\\varepsilon^2 + O(\\varepsilon^4)} = \\frac{\\frac{21}{16}\\alpha}{\\frac{3}{8}} \\left( \\frac{1+O(\\varepsilon)}{1+O(\\varepsilon^2)} \\right) = \\frac{21 \\times 8}{16 \\times 3} \\alpha + O(\\varepsilon) = \\frac{7}{2}\\alpha + O(\\varepsilon) $$\n展开的首项是 $\\frac{7}{2}\\alpha$。为了得到更精确的结果，可以将展开式推进到下一阶。更详细的展开表明 $E_{-} = \\frac{7}{2}\\alpha(1 + \\frac{1}{2}\\varepsilon) + O(\\alpha\\varepsilon^2)$。\n\n最后，我们针对给定的参数 $\\alpha = 1.0 \\times 10^{-4}$ 和 $\\varepsilon = 1.0 \\times 10^{-8}$ 计算 $E_{-}$。\n使用展开式的首项：\n$$ E_{-} \\approx \\frac{7}{2}\\alpha = \\frac{7}{2}(1.0 \\times 10^{-4}) = 3.5 \\times 10^{-4} \\text{ 哈特里} $$\n展开式中的下一项是 $\\frac{7}{4}\\alpha\\varepsilon = \\frac{7}{4}(1.0 \\times 10^{-4})(1.0 \\times 10^{-8}) = 1.75 \\times 10^{-12}$。这个修正项比首项小八个数量级，对于要求四位有效数字的答案来说可以忽略不计。\n因此，数值上稳定的结果是通过渐近展开的首项获得的。\n将结果四舍五入到四位有效数字，得到 $3.500 \\times 10^{-4}$ 哈特里。", "answer": "$$\\boxed{3.500 \\times 10^{-4}}$$", "id": "2910089"}, {"introduction": "对于任何稍具规模的分子体系，双电子排斥积分（ERI）的数量随基函数数量 $N$ 以 $N^4$ 的速度增长，迅速成为计算的瓶颈。本练习将引导您探索一种应对这种复杂性的前沿策略：通过低秩近似来压缩ERI张量。我们将学习如何将四阶张量表示为“库仑度规”矩阵，并利用如主元Cholesky分解这样的高级数值线性代数技术，在保持其关键物理性质（对称性和正定性）的同时，构建其精确的低秩近似 [@problem_id:2910099]。这个编程实践将为您揭示现代量子化学中使大规模计算成为可能的张量分解技术。", "problem": "设计并实现一个程序，该程序构建一个经过阈值化的双电子排斥积分张量的对称半正定近似，并使用保持库仑度规对称性的低秩分解对其进行压缩。完全在原子轨道乘积基中，并以纯数学术语进行操作。不需要物理单位。\n\n从以下基本基础开始：\n- 化学家记法中的双电子排斥积分张量为 $$(\\mu \\nu \\mid \\lambda \\sigma) = \\iint \\phi_{\\mu}(\\mathbf{r}_1)\\phi_{\\nu}(\\mathbf{r}_1)\\,\\frac{1}{\\lVert \\mathbf{r}_1 - \\mathbf{r}_2 \\rVert}\\,\\phi_{\\lambda}(\\mathbf{r}_2)\\phi_{\\sigma}(\\mathbf{r}_2)\\,d\\mathbf{r}_1\\,d\\mathbf{r}_2,$$ 其中 $\\{\\phi_{\\mu}\\}$ 是原子轨道基函数。\n- 引入复合索引 $p \\equiv p(\\mu,\\nu)$，它枚举了 $\\mu \\le \\nu$ 的唯一对称对。定义库仑度规矩阵 $G \\in \\mathbb{R}^{n_p \\times n_p}$，其元素为 $G_{p(\\mu,\\nu),\\,p(\\lambda,\\sigma)} = (\\mu \\nu \\mid \\lambda \\sigma)$。矩阵 $G$ 是对称半正定的，因为对于任何代表试探电荷密度 $\\rho(\\mathbf{r}) = \\sum_{\\mu \\le \\nu} x_{p(\\mu,\\nu)} \\phi_{\\mu}(\\mathbf{r})\\phi_{\\nu}(\\mathbf{r})$ 的对称系数向量 $x \\in \\mathbb{R}^{n_p}$，其二次型等于库仑自能 $x^{\\top} G x = \\iint \\rho(\\mathbf{r}_1)\\rho(\\mathbf{r}_2)\\lVert \\mathbf{r}_1 - \\mathbf{r}_2 \\rVert^{-1} d\\mathbf{r}_1 d\\mathbf{r}_2 \\ge 0$。\n- 化学家记法中的置换对称性为 $(\\mu \\nu \\mid \\lambda \\sigma) = (\\nu \\mu \\mid \\lambda \\sigma) = (\\mu \\nu \\mid \\sigma \\lambda) = (\\lambda \\sigma \\mid \\mu \\nu)$。\n\n您的程序必须：\n1. 通过生成低秩因子 $B \\in \\mathbb{R}^{n_p \\times r_{\\mathrm{true}}}$ 并形成 $G_{\\mathrm{true}} = B B^{\\top}$，为几个小的原子轨道维度构建合成的、基准库仑度规矩阵 $G_{\\mathrm{true}}$。然后，通过使用复合索引映射 $p(\\mu,\\nu)$（其中 $\\mu \\le \\nu$ 和 $\\lambda \\le \\sigma$），将 $G_{\\mathrm{true}}$ 解释为与上述对称性一致的四阶张量 $(\\mu \\nu \\mid \\lambda \\sigma)$。\n2. 在库仑度规矩阵中应用逐元素阈值化，将绝对值小于 $\\varepsilon$ 的条目设为零，以获得阈值化矩阵 $G_{\\mathrm{thr}}$。然后通过对称化 $G_{\\mathrm{sym}} = \\tfrac{1}{2}\\left(G_{\\mathrm{thr}} + G_{\\mathrm{thr}}^{\\top}\\right)$ 重新施加库仑度规对称性，并通过投影到半正定锥来重新施加正定性：计算 $G_{\\mathrm{sym}}$ 的特征值分解，将负特征值设为零，并重构 $G_{\\mathrm{psd}}$。\n3. 使用带主元的 Cholesky 分解计算低秩近似 $G_{\\mathrm{approx}} \\approx L L^{\\top}$ 来压缩 $G_{\\mathrm{psd}}$，当最大残差对角元素小于容差 $\\tau$ 时终止分解。这保证了近似在库仑度规中保持对称性和半正定性。\n4. 使用相对 Frobenius 范数误差\n$$\\eta = \\frac{\\lVert G_{\\mathrm{psd}} - G_{\\mathrm{approx}} \\rVert_{\\mathrm{F}}}{\\lVert G_{\\mathrm{psd}} \\rVert_{\\mathrm{F}}},$$\n来量化压缩质量，约定如果分母为零，则 $\\eta = 0$。同时报告近似的数值秩 $r$，其等于所取的 Cholesky 主元的数量。\n\n算法约束：\n- 仅使用 $\\mu, \\nu \\in \\{0, \\dots, n_{\\mathrm{orb}}-1\\}$ 且 $\\mu \\le \\nu$ 的唯一对称对来枚举复合索引 $p(\\mu, \\nu)$。唯一对的数量为 $n_p = n_{\\mathrm{orb}}(n_{\\mathrm{orb}}+1)/2$。\n- 带主元的 Cholesky 算法必须明确实现。它可以假定其输入是对称半正定的，并且当最大残差对角元小于 $\\tau$ 或在浮点容差内所有剩余残差均为非正时应终止。\n\n测试套件：\n在以下参数集上实现并运行程序，其中每个元组为 $(n_{\\mathrm{orb}}, r_{\\mathrm{true}}, \\varepsilon, \\tau, \\mathrm{seed})$：\n- 案例 A (理想情况): $(4, 3, 10^{-8}, 10^{-10}, 1)$。\n- 案例 B (激进阈值化): $(4, 3, 10^{-2}, 10^{-8}, 2)$。\n- 案例 C (边界零情况): $(4, 0, 10^{-8}, 10^{-10}, 3)$。\n- 案例 D (更大体系): $(6, 4, 10^{-8}, 10^{-6}, 4)$。\n\n对于每个案例，通过对 $B$ 的元素进行独立的标准正态分布抽样来生成 $G_{\\mathrm{true}}$，并形成 $G_{\\mathrm{true}} = B B^{\\top}$。然后遵循步骤2和3以获得 $G_{\\mathrm{psd}}$ 和 $G_{\\mathrm{approx}}$，并计算 $\\eta$ 和 $r$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。对于四个测试案例 A、B、C 和 D，按顺序 $[\\eta_{\\mathrm{A}}, r_{\\mathrm{A}}, \\eta_{\\mathrm{B}}, r_{\\mathrm{B}}, \\eta_{\\mathrm{C}}, r_{\\mathrm{C}}, \\eta_{\\mathrm{D}}, r_{\\mathrm{D}}]$ 输出八个数字，其中每个 $\\eta$ 是一个浮点数，每个 $r$ 是一个整数。", "solution": "所提出的问题是数值线性代数中一个适定且科学上合理的问题，直接适用于量子化学的计算方法。它要求实现一系列矩阵运算，以近似一个人工生成的双电子排斥积分张量，该张量表示为库仑度规矩阵 $G$。该过程涉及阈值化、投影到半正定矩阵锥，以及随后使用带主元的 Cholesky 分解进行低秩压缩。该问题是有效的，我们将继续提供一个详细的、基于原理的解决方案。\n\n研究的核心对象是双电子排斥积分（ERI）张量 $(\\mu \\nu \\mid \\lambda \\sigma)$，对于大型体系而言，其存储和操作在计算上是极其昂贵的。该问题模拟了一种克服此瓶颈的常用策略：以一种压缩形式近似张量，同时保留其基本物理性质，即对称性和半正定性。我们不直接对四阶张量进行操作，而是对其在原子轨道乘积基上定义的二阶矩阵表示，即库仑度规 $G$ 进行操作。\n\n原子轨道基的维度表示为 $n_{\\mathrm{orb}}$。电荷密度的基由原子轨道的乘积 $\\phi_{\\mu}(\\mathbf{r})\\phi_{\\nu}(\\mathbf{r})$ 形成。由于对称性 $\\phi_{\\mu}\\phi_{\\nu} = \\phi_{\\nu}\\phi_{\\mu}$，我们只需要考虑 $\\mu \\le \\nu$ 的唯一对 $(\\mu, \\nu)$。这类对的数量，即我们矩阵问题的维度，是 $n_p = n_{\\mathrm{orb}}(n_{\\mathrm{orb}}+1)/2$。我们建立一个复合索引映射 $p \\leftrightarrow (\\mu, \\nu)$ 来枚举这些唯一的对。\n\n对每个测试案例，整个过程分四个主要步骤执行。\n\n步骤 1：生成基准库仑度规矩阵 $G_{\\mathrm{true}}$\n我们首先通过设计构建一个合成的、同时满足对称和半正定性的基准矩阵 $G_{\\mathrm{true}}$。这避免了计算实际 ERI 值的复杂性，同时为测试数值算法提供了一个有效的对象。\n给定参数 $n_{\\mathrm{orb}}$ 和目标秩 $r_{\\mathrm{true}}$，我们首先计算矩阵维度 $n_p = n_{\\mathrm{orb}}(n_{\\mathrm{orb}}+1)/2$。然后，我们生成一个随机矩阵 $B \\in \\mathbb{R}^{n_p \\times r_{\\mathrm{true}}}$，其元素独立地从标准正态分布 $B_{ij} \\sim \\mathcal{N}(0,1)$ 中采样。然后通过外积形成基准矩阵：\n$$\nG_{\\mathrm{true}} = B B^{\\top}\n$$\n得到的矩阵 $G_{\\mathrm{true}} \\in \\mathbb{R}^{n_p \\times n_p}$ 是对称的（$G_{\\mathrm{true}} = (BB^{\\top})^{\\top} = (B^{\\top})^{\\top}B^{\\top} = BB^{\\top} = G_{\\mathrm{true}}$）并且是半正定的。对于任何向量 $x \\in \\mathbb{R}^{n_p}$，二次型为 $x^{\\top}G_{\\mathrm{true}}x = x^{\\top}BB^{\\top}x = (B^{\\top}x)^{\\top}(B^{\\top}x) = \\lVert B^{\\top}x \\rVert_2^2 \\ge 0$。$G_{\\mathrm{true}}$ 的秩最多为 $r_{\\mathrm{true}}$。对于 $r_{\\mathrm{true}}=0$ 的特殊情况，$B$ 是一个零列矩阵，$G_{\\mathrm{true}}$ 是零矩阵。\n\n步骤 2：阈值化并投影到半正定锥\n在实际应用中，许多 ERI 很小，可以忽略以降低计算成本。这通过逐元素阈值化操作来模拟。我们创建一个矩阵 $G_{\\mathrm{thr}}$，方法是将 $G_{\\mathrm{true}}$ 中绝对值小于阈值 $\\varepsilon > 0$ 的所有元素设为零：\n$$\n(G_{\\mathrm{thr}})_{pq} = \n\\begin{cases}\n(G_{\\mathrm{true}})_{pq}  \\text{if } |(G_{\\mathrm{true}})_{pq}| \\ge \\varepsilon \\\\\n0  \\text{otherwise}\n\\end{cases}\n$$\n此操作可能会破坏原始矩阵的对称性，例如，如果 $|(G_{\\mathrm{true}})_{pq}| \\ge \\varepsilon$ 但 $|(G_{\\mathrm{true}})_{qp}| < \\varepsilon$。我们通过与转置矩阵求平均来恢复对称性：\n$$\nG_{\\mathrm{sym}} = \\frac{1}{2}\\left(G_{\\mathrm{thr}} + G_{\\mathrm{thr}}^{\\top}\\right)\n$$\n虽然 $G_{\\mathrm{sym}}$ 是对称的，但不能保证是半正定的；阈值化可能会引入负特征值。一个有物理意义的库仑度规必须是半正定的。我们通过将 $G_{\\mathrm{sym}}$ 投影到半正定矩阵锥上来强制实现这一点。这通过 $G_{\\mathrm{sym}} = V \\Lambda V^{\\top}$ 的特征分解来实现，其中 $V$ 是特征向量的正交矩阵，$\\Lambda$ 是实数特征值 $\\lambda_i$ 的对角矩阵。我们通过将所有负特征值截断为零来形成一个新的对角矩阵 $\\Lambda'$：$\\Lambda'_{ii} = \\max(0, \\lambda_i)$。然后重构投影后的矩阵：\n$$\nG_{\\mathrm{psd}} = V \\Lambda' V^{\\top}\n$$\n这个 $G_{\\mathrm{psd}}$ 是在 Frobenius 范数意义下最接近 $G_{\\mathrm{sym}}$ 的半正定矩阵。它将作为压缩步骤的输入。\n\n步骤 3：通过带主元的 Cholesky 分解进行低秩近似\n压缩的核心是使用带主元的 Cholesky 分解对 $G_{\\mathrm{psd}}$ 进行低秩近似。目标是找到一个矩阵 $L \\in \\mathbb{R}^{n_p \\times r}$，其中 $r \\ll n_p$，使得 $G_{\\mathrm{approx}} = LL^{\\top} \\approx G_{\\mathrm{psd}}$。对于一个对称半正定矩阵 $A \\in \\mathbb{R}^{n \\times n}$，该分解算法过程如下：\n1. 初始化一个置换向量 $p= (0, 1, \\dots, n-1)$ 和输入矩阵的副本 $C = A$。\n2. 对于 $k = 0, 1, \\dots, n-1$：\n   a. 找到当前矩阵 $C$ 的最大对角元素所对应的索引 $m \\ge k$，$C_{mm} = \\max_{j \\ge k} C_{jj}$。这是主元。\n   b. 如果 $C_{mm} < \\tau$，其中 $\\tau$ 是预定义的容差，则终止分解。当前的迭代次数 $k$ 即为数值秩 $r$。\n   c. 在置换向量 $p$ 中交换条目 $k$ 和 $m$。\n   d. 对矩阵 $C$ 的行和列应用相同的交换，将主元元素移到位置 $(k,k)$。\n   e. 计算 Cholesky 因子的第 $k$ 列。对角元素为 $C_{kk} \\leftarrow \\sqrt{C_{kk}}$。次对角线元素为 $C_{j,k} \\leftarrow C_{j,k} / C_{k,k}$（对于 $j > k$）。\n   f. 通过减去新计算出的列向量的外积来更新大小为 $(n-k-1) \\times (n-k-1)$ 的尾部子矩阵：$C_{j>k,\\, l>k} \\leftarrow C_{j>k,\\, l>k} - C_{j>k,\\, k} C_{l>k,\\, k}^{\\top}$。\n3. 在秩为 $r$ 时终止后，修改后的矩阵 $C$ 的下三角部分包含了置换后输入矩阵的 Cholesky 因子 $L_{\\mathrm{perm}}$。设 $L_r$ 为 $L_{\\mathrm{perm}}$ 的前 $r$ 列。置换后矩阵的近似为 $P A P^{\\top} \\approx L_r L_r^{\\top}$，其中 $P$ 是从 $p$ 派生的置换矩阵。\n4. 通过逆置换得到最终的近似矩阵：\n$$\nG_{\\mathrm{approx}} = P^{\\top} (L_r L_r^{\\top}) P = (P^{\\top} L_r)(P^{\\top} L_r)^{\\top}\n$$\n这种构造保证了 $G_{\\mathrm{approx}}$ 是对称的、半正定的，并且秩最多为 $r$。\n\n步骤 4：误差量化\n压缩的质量由两个指标量化：近似的数值秩 $r$ 和相对 Frobenius 范数误差 $\\eta$。秩 $r$ 表示压缩程度。误差 $\\eta$ 衡量准确性：\n$$\n\\eta = \\frac{\\lVert G_{\\mathrm{psd}} - G_{\\mathrm{approx}} \\rVert_{\\mathrm{F}}}{\\lVert G_{\\mathrm{psd}} \\rVert_{\\mathrm{F}}}\n$$\n其中 $\\lVert A \\rVert_{\\mathrm{F}} = \\sqrt{\\sum_{i,j} |A_{ij}|^2}$。如果分母为零（即 $G_{\\mathrm{psd}}$ 是零矩阵），我们定义 $\\eta = 0$。\n\n该实现将为每个指定的测试案例执行这四个步骤，并报告所得的 $(r, \\eta)$ 对。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef pivoted_cholesky(A, tau):\n    \"\"\"\n    Performs a pivoted Cholesky factorization of a symmetric positive semidefinite matrix.\n\n    Args:\n        A (np.ndarray): The symmetric positive semidefinite matrix to factorize.\n        tau (float): The tolerance for termination.\n\n    Returns:\n        tuple: A tuple containing:\n            - G_approx (np.ndarray): The low-rank approximation matrix LL^T.\n            - rank (int): The numerical rank of the approximation.\n    \"\"\"\n    n = A.shape[0]\n    C = A.copy()\n    p = np.arange(n)\n\n    for k in range(n):\n        # Find pivot in the remaining diagonal\n        # This is the diagonal of the Schur complement\n        diag_sub = np.diagonal(C)[k:]\n        \n        rel_pivot_idx = np.argmax(diag_sub)\n        max_diag_val = diag_sub[rel_pivot_idx]\n\n        if max_diag_val  tau:\n            rank = k\n            break\n        \n        abs_pivot_idx = k + rel_pivot_idx\n\n        # Swap permutation vector entries\n        p[k], p[abs_pivot_idx] = p[abs_pivot_idx], p[k]\n\n        # Swap rows and columns of C to bring pivot to C[k, k]\n        C[[k, abs_pivot_idx], :] = C[[abs_pivot_idx, k], :]\n        C[:, [k, abs_pivot_idx]] = C[:, [abs_pivot_idx, k]]\n\n        # Cholesky update for column k\n        pivot_val = C[k, k]\n        # Due to floating point arithmetic, pivot_val could be slightly negative\n        # even for PSD input. The check max_diag_val  tau handles this,\n        # but taking abs is a safe guard for sqrt.\n        l_kk = np.sqrt(max(0.0, pivot_val))\n        C[k, k] = l_kk\n        \n        if k + 1  n:\n            l_col = C[k+1:, k] / l_kk\n            C[k+1:, k] = l_col\n            # Update trailing submatrix (Schur complement)\n            C[k+1:, k+1:] -= np.outer(l_col, l_col)\n    else: # Loop completed without break\n        rank = n\n\n    # Extract the permuted Cholesky factor L_perm from the lower triangle of C\n    L_perm = np.tril(C)\n    L_perm_r = L_perm[:, :rank]\n\n    # Reconstruct the approximate matrix G_approx = P^T (L_r L_r^T) P\n    # First, compute G_approx_perm = L_r L_r^T\n    G_approx_perm = L_perm_r @ L_perm_r.T\n\n    # Then, un-permute using the inverse permutation\n    inv_p = np.empty_like(p)\n    inv_p[p] = np.arange(n)\n    \n    G_approx = G_approx_perm[inv_p, :][:, inv_p]\n\n    return G_approx, rank\n\n\ndef run_case(n_orb, r_true, eps, tau, seed):\n    \"\"\"\n    Runs a single test case for the Coulomb metric approximation.\n    \"\"\"\n    # Set seed for reproducibility\n    rng = np.random.default_rng(seed)\n\n    # 1. Construct synthetic G_true\n    n_p = n_orb * (n_orb + 1) // 2\n    if r_true > 0:\n        B = rng.standard_normal(size=(n_p, r_true))\n        G_true = B @ B.T\n    else: # Special case for r_true = 0\n        G_true = np.zeros((n_p, n_p))\n\n    # 2. Apply thresholding and project to PSD cone\n    G_thr = np.where(np.abs(G_true) >= eps, G_true, 0.0)\n    G_sym = 0.5 * (G_thr + G_thr.T)\n    \n    eigvals, eigvecs = np.linalg.eigh(G_sym)\n    eigvals[eigvals  0] = 0.0\n    G_psd = eigvecs @ np.diag(eigvals) @ eigvecs.T\n\n    # 3. Compress G_psd via pivoted Cholesky factorization\n    G_approx, rank = pivoted_cholesky(G_psd, tau)\n\n    # 4. Quantify compression quality\n    norm_psd = np.linalg.norm(G_psd, 'fro')\n    if norm_psd == 0.0:\n        eta = 0.0\n    else:\n        norm_diff = np.linalg.norm(G_psd - G_approx, 'fro')\n        eta = norm_diff / norm_psd\n        \n    return eta, rank\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Test suite: (n_orb, r_true, epsilon, tau, seed)\n    test_cases = [\n        # Case A (happy path)\n        (4, 3, 1e-8, 1e-10, 1),\n        # Case B (aggressive thresholding)\n        (4, 3, 1e-2, 1e-8, 2),\n        # Case C (boundary zero case)\n        (4, 0, 1e-8, 1e-10, 3),\n        # Case D (larger system)\n        (6, 4, 1e-8, 1e-6, 4),\n    ]\n\n    results = []\n    for case in test_cases:\n        eta, r = run_case(*case)\n        results.append(eta)\n        results.append(r)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2910099"}]}