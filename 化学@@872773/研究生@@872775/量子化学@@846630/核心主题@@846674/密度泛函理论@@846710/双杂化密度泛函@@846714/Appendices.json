{"hands_on_practices": [{"introduction": "双杂化泛函的核心特征是在标准杂化泛函的基础上，引入了非局域的轨道依赖相关能，这部分能量通常源自二阶 Møller-Plesset 微扰理论 (MP2)。为了进一步提升精度，研究者发现将 MP2 相关能分解为自旋平行 (same-spin) 和自旋反平行 (opposite-spin) 两部分，并赋予它们不同的权重系数，是一种非常有效的策略。这个练习将带你实践这一“自旋分量标度” (spin-component scaling) 的基本计算，这是理解许多现代双杂化泛函性能的关键一步 ([@problem_id:2886705])。", "problem": "在双杂化密度泛函近似 (DH-DFAs) 中，微扰相关部分通常取自 Møller–Plesset 二阶微扰理论 (MP2)。在 Rayleigh–Schrödinger 微扰理论中，二阶相关能由正则 Hartree–Fock 参考态得到，并且可以根据电子对的自旋投影将其划分为相反自旋和相同自旋的贡献。在双杂化密度泛函中使用的自旋分量标度 (SCS) 方法中，在将相反自旋和相同自旋的总能量纳入双杂化能量之前，会对其应用不同的前置因子。\n\n考虑一个闭壳层小分子，在价基组下对其进行正则 Hartree–Fock 计算，得到以下按自旋类别分开的成对二阶相关贡献列表（每个条目是根据单个电子对激发的标准 MP2 表达式计算的电子对能量贡献），单位为 Hartree：\n- 相反自旋电子对能量：$-0.018432, -0.006517, -0.002981, -0.001257, -0.000843$。\n- 相同自旋电子对能量：$-0.003876, -0.001142, -0.000328$。\n\n使用双杂化密度泛函中采用的自旋分量标度微扰相关能的定义，并给定系数 $c_{\\text{OS}}=1.20$ 和 $c_{\\text{SS}}=0.330$，计算自旋分量标度的二阶微扰相关能。最终能量以 Hartree 为单位表示，并将答案四舍五入至五位有效数字。", "solution": "审阅题目陈述，确认其有效。该问题在科学上基于量子化学原理，特别是关于双杂化密度泛函理论和 Møller–Plesset 微扰理论。问题提法明确，为获得唯一解提供了所有必要的数据和定义。术语客观而精确。\n\n目标是计算自旋分量标度的二阶微扰相关能，记为 $E_c^{\\text{SCS-MP2}}$。该量被定义为总的相反自旋 ($E_c^{\\text{OS}}$) 和相同自旋 ($E_c^{\\text{SS}}$) 的二阶 Møller–Plesset (MP2) 相关能的线性组合。其通用表达式为：\n$$E_c^{\\text{SCS-MP2}} = c_{\\text{OS}} E_c^{\\text{OS}} + c_{\\text{SS}} E_c^{\\text{SS}}$$\n其中 $c_{\\text{OS}}$ 和 $c_{\\text{SS}}$ 分别是根据经验确定的相反自旋和相同自旋分量的标度系数。\n\n首先，通过将所提供的各个相反自旋电子对能量贡献相加，计算总的相反自旋相关能 $E_c^{\\text{OS}}$。给定的电子对能量为：$-0.018432$、$-0.006517$、$-0.002981$、$-0.001257$ 和 $-0.000843$，单位均为 Hartree。\n$$E_c^{\\text{OS}} = (-0.018432) + (-0.006517) + (-0.002981) + (-0.001257) + (-0.000843) \\text{ Hartree}$$\n$$E_c^{\\text{OS}} = -0.030030 \\text{ Hartree}$$\n\n其次，通过将所提供的各个相同自旋电子对能量贡献相加，计算总的相同自旋相关能 $E_c^{\\text{SS}}$。给定的电子对能量为：$-0.003876$、$-0.001142$ 和 $-0.000328$，单位均为 Hartree。\n$$E_c^{\\text{SS}} = (-0.003876) + (-0.001142) + (-0.000328) \\text{ Hartree}$$\n$$E_c^{\\text{SS}} = -0.005346 \\text{ Hartree}$$\n\n现在，将这些总的自旋分量能量与给定的标度系数 $c_{\\text{OS}} = 1.20$ 和 $c_{\\text{SS}} = 0.330$ 一起代入 $E_c^{\\text{SCS-MP2}}$ 的定义方程中。\n$$E_c^{\\text{SCS-MP2}} = (1.20) \\times E_c^{\\text{OS}} + (0.330) \\times E_c^{\\text{SS}}$$\n$$E_c^{\\text{SCS-MP2}} = (1.20) \\times (-0.030030) + (0.330) \\times (-0.005346) \\text{ Hartree}$$\n分别计算每一项：\n标度后的相反自旋贡献为：\n$$(1.20) \\times (-0.030030) = -0.036036 \\text{ Hartree}$$\n标度后的相同自旋贡献为：\n$$(0.330) \\times (-0.005346) = -0.00176418 \\text{ Hartree}$$\n总的自旋分量标度能量是这两项之和：\n$$E_c^{\\text{SCS-MP2}} = -0.036036 - 0.00176418 = -0.03780018 \\text{ Hartree}$$\n题目要求最终答案四舍五入至五位有效数字。计算值为 $-0.03780018$。前五位有效数字是 $3$、$7$、$8$、$0$ 和 $0$。其后的数字是 $1$，小于 $5$，因此我们向下舍入（即截断）。\n因此，四舍五入后的值为 $-0.037800$。", "answer": "$$\n\\boxed{-0.037800}\n$$", "id": "2886705"}, {"introduction": "掌握了微扰相关能的计算之后，我们便可以着手构建完整的双杂化泛函能量表达式。一个典型的非自洽双杂化泛函的能量，就像一个用不同“积木块”搭建起来的精密模型，这些“积木块”包括精确交换能、半局域交换能、半局域相关能以及我们刚讨论过的微扰相关能。这个练习将指导你如何根据给定的混合系数，将这些从固定轨道集计算出的能量分量正确地“组装”起来，从而得到最终的总能量，让你对双杂化泛函的内在结构有更深刻的认识 ([@problem_id:2886706])。", "problem": "给定一个由广义科恩-沈哈密顿量生成的固定母体混合科恩-沈轨道集。您的任务是设计并实现一个计算工作流，以仅使用可从此固定轨道集计算出的量来评估非自洽双杂化能量，而无需重新优化轨道。\n\n从以下基本基础开始：\n- 科恩-沈总能量分解：$$E_{\\mathrm{tot}} = T_s + V_{\\mathrm{ne}} + J + E_{\\mathrm{xc}}$$\n- 哈特里-福克精确交换能 $E_{x}^{\\mathrm{HF}}$ 可以通过福克算符的交换部分从相同的轨道计算得到。\n- 一个半局域交换相关能量泛函在使用相同的轨道和密度在实空间网格上进行评估时，会产生 $E_{x}^{\\mathrm{DFA}}$ 和 $E_{c}^{\\mathrm{DFA}}$，其中 DFA 表示密度泛函近似。\n- 在相同轨道上评估的二阶默勒-普莱塞特（MP2）相关能（分解为相反自旋和相同自旋）定义为 $$E_{2}^{\\mathrm{OS}} = \\sum_{i a j b}^{\\mathrm{OS}} \\frac{\\lvert \\langle i a \\Vert j b \\rangle \\rvert^2}{\\epsilon_i + \\epsilon_j - \\epsilon_a - \\epsilon_b}, \\quad E_{2}^{\\mathrm{SS}} = \\sum_{i a j b}^{\\mathrm{SS}} \\frac{\\lvert \\langle i a \\Vert j b \\rangle \\rvert^2}{\\epsilon_i + \\epsilon_j - \\epsilon_a - \\epsilon_b}$$其中指数 $i, j$ 遍历已占据轨道，$a, b$ 遍历未占据（虚拟）轨道，双电子积分 $\\langle i a \\Vert j b \\rangle$ 是反对称化的，而 $\\epsilon_p$ 是轨道能。$E_{2}^{\\mathrm{OS}}$ 和 $E_{2}^{\\mathrm{SS}}$ 均使用相同的母体轨道计算。\n\n因为您不得重新优化轨道，所以请将 $E_{\\mathrm{base}} \\equiv T_s + V_{\\mathrm{ne}} + J$ 视为给定母体轨道集的常数。非自洽双杂化能量是通过使用标量系数对这些分量进行线性组合来构建的，这些系数用于加权固定轨道精确交换、半局域交换、半局域相关和二阶微扰相关部分。系数是给定的，必须一致应用，以确保没有交换或相关贡献被双重计算。\n\n您的目标：\n1.  根据上述基本基础，推导出如何构建一个仅使用固定轨道量 $E_{\\mathrm{base}}$、$E_{x}^{\\mathrm{HF}}$、$E_{x}^{\\mathrm{DFA}}$、$E_{c}^{\\mathrm{DFA}}$、$E_{2}^{\\mathrm{OS}}$、$E_{2}^{\\mathrm{SS}}$ 和用户指定的系数 $c_x$、$c_c$、$c_{2}^{\\mathrm{OS}}$、$c_{2}^{\\mathrm{SS}}$ 的非自洽双杂化总能量表达式 $E_{\\mathrm{DH}}$。解释为什么 $E_{\\mathrm{base}}$ 保持不变，以及如何防止 $E_{x}^{\\mathrm{HF}}$、$E_{x}^{\\mathrm{DFA}}$ 和微扰相关之间的双重计算。\n2.  实现一个程序，为以下测试套件评估推导出的 $E_{\\mathrm{DH}}$。所有能量必须以哈特里（$E_h$）表示。您的程序应计算每种情况并将结果四舍五入到小数点后 $10$ 位。\n\n测试套件（每种情况按顺序列出标量系数元组 $(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}})$，然后是固定轨道能量分量 $(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}})$，均以 $E_h$ 为单位）：\n-   情况A（通用双杂化）：系数 $(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}}) = (0.68, 0.36, 0.55, 0.12)$; 分量 $(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}}) = (-75.00000000, -3.50000000, -3.20000000, -0.90000000, -0.45000000, -0.15000000)$。\n-   情况B（纯杂化边界，无微扰相关）：系数 $(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}}) = (0.50, 1.00, 0.00, 0.00)$; 分量 $(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}}) = (-40.00000000, -2.00000000, -1.80000000, -0.40000000, -0.20000000, -0.05000000)$。\n-   情况C（具有完整 MP2 的哈特里-福克交换极限）：系数 $(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}}) = (1.00, 0.00, 1.00, 1.00)$; 分量 $(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}}) = (-15.00000000, -1.00000000, -0.90000000, -0.20000000, -0.05000000, -0.02000000)$。\n-   情况D（具有负相同自旋系数的自旋分量标度）：系数 $(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}}) = (0.72, 0.42, 0.65, -0.05)$; 分量 $(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}}) = (-100.00000000, -6.70000000, -6.10000000, -1.60000000, -0.95000000, -0.35000000)$。\n\n最终输出格式：\n-   您的程序应生成一行输出，其中包含四个计算出的能量（以 $E_h$ 为单位），每个能量四舍五入到小数点后 $10$ 位，作为一个用方括号括起来的逗号分隔列表，不含空格。例如，`[x_1,x_2,x_3,x_4]` 其中每个 $x_k$ 是一个以 $E_h$ 为单位、四舍五入到小数点后 $10$ 位的浮点数。", "solution": "该问题要求制定并实现一种非自洽双杂化能量计算方法。问题陈述的验证是强制性的第一步。\n\n### 问题验证\n\n#### 步骤1：提取已知条件\n\n提供的信息包括：\n-   科恩-沈总能量分解：$E_{\\mathrm{tot}} = T_s + V_{\\mathrm{ne}} + J + E_{\\mathrm{xc}}$。\n-   来自固定轨道集的恒定基础能量：$E_{\\mathrm{base}} \\equiv T_s + V_{\\mathrm{ne}} + J$。\n-   从固定轨道集计算出的可用能量分量：\n    -   哈特里-福克精确交换能：$E_{x}^{\\mathrm{HF}}$。\n    -   来自密度泛函近似（DFA）的半局域交换能：$E_{x}^{\\mathrm{DFA}}$。\n    -   来自DFA的半局域相关能：$E_{c}^{\\mathrm{DFA}}$。\n    -   相反自旋二阶默勒-普莱塞特（MP2）相关能：$E_{2}^{\\mathrm{OS}}$。\n    -   相同自旋二阶默勒-普莱塞特（MP2）相关能：$E_{2}^{\\mathrm{SS}}$。\n-   - MP2分量的定义：$$E_{2}^{\\mathrm{OS}} = \\sum_{i a j b}^{\\mathrm{OS}} \\frac{\\lvert \\langle i a \\Vert j b \\rangle \\rvert^2}{\\epsilon_i + \\epsilon_j - \\epsilon_a - \\epsilon_b}, \\quad E_{2}^{\\mathrm{SS}} = \\sum_{i a j b}^{\\mathrm{SS}} \\frac{\\lvert \\langle i a \\Vert j b \\rangle \\rvert^2}{\\epsilon_i + \\epsilon_j - \\epsilon_a - \\epsilon_b}$$\n-   用于构建双杂化能量的用户指定系数：$c_x$, $c_c$, $c_{2}^{\\mathrm{OS}}$, $c_{2}^{\\mathrm{SS}}$。\n-   包含四种情况的测试套件，每种情况提供一组系数和相应的能量分量，单位为哈特里（$E_h$）。\n    -   情况A：$(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}}) = (0.68, 0.36, 0.55, 0.12)$；$(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}}) = (-75.0, -3.5, -3.2, -0.9, -0.45, -0.15)$。\n    -   情况B：$(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}}) = (0.50, 1.00, 0.00, 0.00)$；$(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}}) = (-40.0, -2.0, -1.8, -0.4, -0.2, -0.05)$。\n    -   情况C：$(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}}) = (1.00, 0.00, 1.00, 1.00)$；$(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}}) = (-15.0, -1.0, -0.9, -0.2, -0.05, -0.02)$。\n    -   情况D：$(c_x, c_c, c_{2}^{\\mathrm{OS}}, c_{2}^{\\mathrm{SS}}) = (0.72, 0.42, 0.65, -0.05)$；$(E_{\\mathrm{base}}, E_{x}^{\\mathrm{HF}}, E_{x}^{\\mathrm{DFA}}, E_{c}^{\\mathrm{DFA}}, E_{2}^{\\mathrm{OS}}, E_{2}^{\\mathrm{SS}}) = (-100.0, -6.7, -6.1, -1.6, -0.95, -0.35)$。\n\n#### 步骤2：使用提取的已知条件进行验证\n\n根据所需标准评估问题陈述：\n-   **科学上合理**：该问题准确地代表了量子化学中的一个标准后处理步骤，特别是非自洽双杂化泛函能量的计算。所有术语（$E_x^{\\mathrm{HF}}$、$E_c^{\\mathrm{DFA}}$、$E_c^{\\mathrm{MP2}}$等）在该领域都是明确定义和标准的。该过程在物理和数学上都是合理的。\n-   **定义明确**：该问题结构为一个推导，然后将推导出的公式直接应用于给定数据。它是自洽的，并且每个测试用例都存在唯一、稳定的解。\n-   **客观**：语言是正式的，使用了来自理论和计算化学的精确术语，没有歧义或主观论断。\n\n该问题没有表现出任何诸如科学上不合理、不完整、矛盾或不可行之类的缺陷。\n\n#### 步骤3：结论与行动\n该问题是**有效的**。将制定一个解决方案。\n\n### 解决方案\n\n目标是从一组预先计算的、源自固定科恩-沈轨道集的能量分量中，构建一个非自洽双杂化能量 $E_{\\mathrm{DH}}$。\n\n#### 1. 双杂化能量表达式的推导\n\n总能量由一个基础分量和一个交换相关分量组装而成：\n$$E_{\\mathrm{DH}} = E_{\\mathrm{base}} + E_{\\mathrm{xc}}^{\\mathrm{DH}}$$\n项 $E_{\\mathrm{base}} = T_s + V_{\\mathrm{ne}} + J$ 取决于单电子动能（$T_s$）、核-电子势能（$V_{\\mathrm{ne}}$）和经典电子-电子库仑排斥能（$J$）。这些量是电子密度 $\\rho$ 和科恩-沈轨道 $\\{\\psi_i\\}$ 的泛函。由于问题指定轨道是固定的（即，不为双杂化泛函重新优化），$E_{\\mathrm{base}}$ 对于给定的计算是一个常数值。\n\n交换相关能 $E_{\\mathrm{xc}}^{\\mathrm{DH}}$ 是由其交换和相关部分的线性组合构成的：\n$$E_{\\mathrm{xc}}^{\\mathrm{DH}} = E_{x}^{\\mathrm{DH}} + E_{c}^{\\mathrm{DH}}$$\n\n**交换分量 ($E_{x}^{\\mathrm{DH}}$):**\n在杂化泛函中，交换能是哈特里-福克（HF）精确交换 $E_{x}^{\\mathrm{HF}}$ 和半局域DFA交换 $E_{x}^{\\mathrm{DFA}}$ 的混合。系数 $c_x$ 决定了精确交换的比例。为防止交换效应的双重计算，来自DFA交换的贡献必须是互补的。因此，总交换能为：\n$$E_{x}^{\\mathrm{DH}} = c_x E_{x}^{\\mathrm{HF}} + (1 - c_x) E_{x}^{\\mathrm{DFA}}$$\n这种形式确保了总交换贡献被正确归一化。例如，如果 $c_x = 1$，则所有DFA交换都被移除；如果 $c_x = 0$，则泛函恢复为纯DFA交换。\n\n**相关分量 ($E_{c}^{\\mathrm{DH}}$):**\n在双杂化泛函中，相关能结合了DFA相关项 $E_{c}^{\\mathrm{DFA}}$ 和来自二阶默勒-普莱塞特微扰理论（MP2）的非局域相关校正。问题为DFA相关（$c_c$）以及MP2相关的相反自旋（$c_{2}^{\\mathrm{OS}}$）和相同自旋（$c_{2}^{\\mathrm{SS}}$）分量提供了单独的系数。项 $E_{c}^{\\mathrm{DFA}}$ 和 $E_{c}^{\\mathrm{MP2}}$ 是对真实相关能的不同近似，捕捉了不同的物理方面（例如，静态相关与动态相关）。因此，它们被视为可加分量，每个分量都由其自身的经验确定系数进行缩放。这是现代自旋分量标度双杂化泛函中的标准做法。其形式为：\n$$E_{c}^{\\mathrm{DH}} = c_c E_{c}^{\\mathrm{DFA}} + c_{2}^{\\mathrm{OS}} E_{2}^{\\mathrm{OS}} + c_{2}^{\\mathrm{SS}} E_{2}^{\\mathrm{SS}}$$\n避免双重计算的指令得到了满足，因为 $E_{c}^{\\mathrm{DFA}}$ 和微扰校正是根本不同类型的能量项，它们的加权和是泛函的定义方式。这些系数是为再现高质量基准数据而拟合的参数。\n\n**总双杂化能量 ($E_{\\mathrm{DH}}$):**\n结合所有分量，得到非自洽双杂化能量的最终表达式：\n$$E_{\\mathrm{DH}} = E_{\\mathrm{base}} + \\left[ c_x E_{x}^{\\mathrm{HF}} + (1 - c_x) E_{x}^{\\mathrm{DFA}} \\right] + \\left[ c_c E_{c}^{\\mathrm{DFA}} + c_{2}^{\\mathrm{OS}} E_{2}^{\\mathrm{OS}} + c_{2}^{\\mathrm{SS}} E_{2}^{\\mathrm{SS}} \\right]$$\n该方程是给定分量的清晰、逐步组装，遵循了量子化学模型构建的原则。\n\n#### 2. 测试套件的实现\n\n现在将实施推导出的公式，以计算四个指定测试用例的总能量。逻辑直接遵循该方程。对于每种情况，将提供的系数和能量分量代入公式中。结果按要求四舍五入到小数点后 $10$ 位。\n\n例如，对于情况A：\n$c_x = 0.68$, $c_c = 0.36$, $c_{2}^{\\mathrm{OS}} = 0.55$, $c_{2}^{\\mathrm{SS}} = 0.12$\n$E_{\\mathrm{base}} = -75.0$, $E_{x}^{\\mathrm{HF}} = -3.5$, $E_{x}^{\\mathrm{DFA}} = -3.2$, $E_{c}^{\\mathrm{DFA}} = -0.9$, $E_{2}^{\\mathrm{OS}} = -0.45$, $E_{2}^{\\mathrm{SS}} = -0.15$\n\n$E_{\\mathrm{DH}} = -75.0 + [0.68(-3.5) + (1-0.68)(-3.2)] + [0.36(-0.9) + 0.55(-0.45) + 0.12(-0.15)]$\n$E_{\\mathrm{DH}} = -75.0 + [-2.38 - 1.024] + [-0.324 - 0.2475 - 0.018]$\n$E_{\\mathrm{DH}} = -75.0 - 3.404 - 0.5895 = -78.9935$\n\n对所有情况重复此过程。最终的实现在下一节中提供。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the non-self-consistent double-hybrid energy for a suite of test cases.\n    \"\"\"\n\n    # Test suite: each case is a tuple containing:\n    # 1. A tuple of coefficients: (c_x, c_c, c_2_os, c_2_ss)\n    # 2. A tuple of energy components: (E_base, E_x_HF, E_x_DFA, E_c_DFA, E_2_os, E_2_ss)\n    # All energies are in hartree (E_h).\n    test_cases = [\n        # Case A: General double-hybrid\n        ( (0.68, 0.36, 0.55, 0.12), \n          (-75.00000000, -3.50000000, -3.20000000, -0.90000000, -0.45000000, -0.15000000) ),\n        # Case B: Pure hybrid boundary, no perturbative correlation\n        ( (0.50, 1.00, 0.00, 0.00), \n          (-40.00000000, -2.00000000, -1.80000000, -0.40000000, -0.20000000, -0.05000000) ),\n        # Case C: Hartree-Fock exchange limit with full MP2\n        ( (1.00, 0.00, 1.00, 1.00), \n          (-15.00000000, -1.00000000, -0.90000000, -0.20000000, -0.05000000, -0.02000000) ),\n        # Case D: Spin-component scaled with negative same-spin coefficient\n        ( (0.72, 0.42, 0.65, -0.05), \n          (-100.00000000, -6.70000000, -6.10000000, -1.60000000, -0.95000000, -0.35000000) )\n    ]\n\n    results = []\n    for case in test_cases:\n        coeffs, energies = case\n        c_x, c_c, c_2_os, c_2_ss = coeffs\n        e_base, e_x_hf, e_x_dfa, e_c_dfa, e_2_os, e_2_ss = energies\n\n        # Assemble the exchange component\n        # E_x_DH = c_x * E_x_HF + (1 - c_x) * E_x_DFA\n        e_x_dh = c_x * e_x_hf + (1 - c_x) * e_x_dfa\n\n        # Assemble the correlation component\n        # E_c_DH = c_c * E_c_DFA + c_2_os * E_2_os + c_2_ss * E_2_ss\n        e_c_dh = c_c * e_c_dfa + c_2_os * e_2_os + c_2_ss * e_2_ss\n\n        # Assemble the total double-hybrid energy\n        # E_DH = E_base + E_x_DH + E_c_DH\n        e_dh = e_base + e_x_dh + e_c_dh\n\n        # Round the result to 10 decimal places as required.\n        # Use formatting to ensure trailing zeros are preserved if needed.\n        # The rounding is effectively handled by the format string.\n        results.append(f\"{e_dh:.10f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2886706"}, {"introduction": "尽管双杂化泛函在许多应用中表现出色，但它们并非在所有情况下都可靠，任何高级研究者都必须学会诊断其潜在的失效模式。此练习模拟了一个真实的研究场景：你需要设计一个工作流程，以识别那些可能让标准双杂化泛函预测失败的“困难”体系，主要关注强静态相关和密度驱动误差这两大挑战。通过这个思想实验，你将学会如何综合运用多种理论诊断工具，如 $T_1$ 诊断和密度敏感性分析，来批判性地评估计算结果的可靠性，这是从计算执行者成长为计算科学家的关键一步 ([@problem_id:2886741])。", "problem": "一位资深从业者希望为化学上多样化的测试集部署双杂化密度泛函，但担心两种已知的失效模式：(i) 在存在强静态相关的情况下，类 Møller–Plesset 二阶微扰理论 (MP2) 的相关作用会失效，以及 (ii) 密度泛函理论 (DFT) 中大的密度驱动误差，这种误差会传播到非自洽的双杂化评估中。该从业者提议构建一个诊断工作流程，该流程使用基于耦合簇单激发的指标和密度敏感性检查来标记传统基于 Kohn–Sham (KS) 轨道的双杂化方法可能不可靠的情况。\n\n根据电子结构理论，从以下公认的基础出发，论证并选择下面选项中最科学合理的工作流程：\n\n- 在存在强静态（多参考）相关的情况下，围绕单个行列式的微扰理论，如 Møller–Plesset 二阶微扰理论 (MP2)，可能会变得在定性上不可靠。\n- 耦合簇单双激发 (CCSD) 的 $T_1$ 诊断，定义为单激发振幅的欧几里得范数，当参考行列式在定性上较差时会增大；经验阈值如 $T_1 \\gtrsim 0.02$（闭壳层）和 $T_1 \\gtrsim 0.044$（开壳层）通常用于标记多参考特性。\n- 自然轨道占据数 (NOONs) 远离占据轨道的 $2$ 或虚拟轨道的 $0$ 表明存在静态相关；根据粗略的经验法则，偏差超过约 $0.1$（例如，$n_{\\text{HOMO}} \\lesssim 1.9$ 或 $n_{\\text{LUMO}} \\gtrsim 0.1$）表明可能存在多参考特性。\n- DFT 中的总能量误差可以分解为泛函驱动和密度驱动分量。一个实用的密度敏感性度量是在两种密度上评估选定的密度泛函近似 (DFA) 并取其绝对能量差，例如\n$$\nS_{\\text{DFA}} \\equiv \\left| E_{\\text{DFA}}\\!\\left[n_{\\text{DFA}}\\right] - E_{\\text{DFA}}\\!\\left[n_{\\text{HF}}\\right] \\right|,\n$$\n其中 $n_{\\text{HF}}$ 是 Hartree–Fock (HF) 密度，$n_{\\text{DFA}}$ 是自洽的 DFA 密度。$S_{\\text{DFA}} \\gtrsim 2\\,\\text{kcal mol}^{-1}$ 的值通常表示存在显著的密度驱动误差。\n- 许多常用的双杂化方法在密度上不是自洽的，并且包含一部分由 KS 轨道构建的 $E_c^{\\text{MP2}}$，其系数为 $c_2$。当密度驱动误差大时，在更准确的密度（例如 HF）上评估能量或使用轨道优化的变体可以减轻误差。当静态相关强时，$E_c^{\\text{MP2}}$ 项本身是不可靠的。\n\n哪个选项给出的工作流程与这些原则一致，使用实用且科学上可辩护的阈值，并规定了减少已知误差来源而不引入新的、不合理误差的措施？\n\nA. 工作流程：\n- 步骤 $1$（静态相关筛选）：对闭壳层系统计算 CCSD $T_1$ 诊断，对开壳层情况计算其对应的诊断。如果 $T_1 \\ge 0.02$（闭壳层）或 $T_1 \\ge 0.044$（开壳层），或者如果 NOON 分析显示 $n_{\\text{HOMO}} \\le 1.90$ 或 $n_{\\text{LUMO}} \\ge 0.10$，则标记为强静态相关并避免使用常规双杂化方法；优先选择多参考方法（例如，完整活性空间自洽场 (CASSCF) 结合 N-电子价态二阶微扰理论 (NEVPT2)）或谨慎使用轨道优化的双杂化方法。\n- 步骤 $2$（密度敏感性）：对于通过步骤 $1$ 的系统，使用母体广义梯度近似 (GGA) 或杂化泛函（例如，PBE0）计算 $S_{\\text{DFA}}$，如下所示\n$$\nS_{\\text{DFA}} = \\left| E_{\\text{DFA}}\\!\\left[n_{\\text{DFA}}\\right] - E_{\\text{DFA}}\\!\\left[n_{\\text{HF}}\\right] \\right|.\n$$\n如果 $S_{\\text{DFA}} \\ge 2\\,\\text{kcal mol}^{-1}$，优先选择在 HF 轨道/密度上评估的双杂化方法（例如，交换空穴偶极矩类型的 xDH 变体或对基础 DFA 使用密度校正 DFT）或轨道优化的双杂化方法；如果 $S_{\\text{DFA}} < 2\\,\\text{kcal mol}^{-1}$，则继续使用常规的基于 KS 轨道的双杂化方法。\n- 步骤 $3$（最终标记）：如果步骤 $1$ 表明存在静态相关，或者步骤 $1$ 和步骤 $2$ 都失败，则将该系统标记为双杂化方法不可靠的高风险系统。\n\nB. 工作流程：\n- 步骤 $1$：仅使用 Kohn–Sham HOMO–LUMO 能隙作为静态相关的代理指标；如果能隙小于 $0.5\\,\\text{eV}$，则进入步骤 $2$，否则不进行进一步检查，直接使用常规的基于 KS 轨道的双杂化方法。\n- 步骤 $2$：将密度敏感性定义为\n$$\nS_{\\text{DH}} \\equiv \\left| E_{\\text{DH}}\\!\\left[n_{\\text{DH}}\\right] - E_{\\text{DH}}\\!\\left[n_{\\text{HF}}\\right] \\right|,\n$$\n其中 $E_{\\text{DH}}$ 是完全自洽的双杂化能量，$n_{\\text{DH}}$ 是其自洽密度。如果 $S_{\\text{DH}} \\ge 0.5\\,\\text{kcal mol}^{-1}$，则总是退回到纯 HF 计算。\n\nC. 工作流程：\n- 步骤 $1$：跳过 $T_1$ 和 NOONs；相反，仅依赖自旋算符的期望值，将任何 $\\langle \\hat{S}^2 \\rangle$ 与精确值偏差超过 $0.05$ 的非限制性解标记为多参考。\n- 步骤 $2$：计算 $S_{\\text{LDA}} = \\left| E_{\\text{LDA}}\\!\\left[n_{\\text{LDA}}\\right] - E_{\\text{LDA}}\\!\\left[n_{\\text{HF}}\\right] \\right|$，如果 $S_{\\text{LDA}} \\ge 0.2\\,\\text{kcal mol}^{-1}$，则总是强制双杂化方法使用 HF 轨道；否则使用自洽的双杂化轨道。\n\nD. 工作流程：\n- 步骤 $1$：使用 CCSD $T_1$ 诊断，阈值为 $T_1 \\ge 0.05$（闭壳层）和 $T_1 \\ge 0.10$（开壳层）来标记静态相关；如果被标记，则继续使用常规的基于 KS 轨道的双杂化方法，因为精确交换部分会使其稳定。\n- 步骤 $2$：如选项 A 中那样计算 $S_{\\text{DFA}}$，但如果 $S_{\\text{DFA}} \\ge 2\\,\\text{kcal mol}^{-1}$，则倾向于保留自洽的 KS 密度，因为自洽对于双杂化方法总是有益的。\n\nE. 工作流程：\n- 步骤 $1$：使用 KS 参考态的 MP2 相关能的绝对值 $|E_c^{\\text{MP2}}|$ 作为唯一指标；如果 $|E_c^{\\text{MP2}}| \\ge 50\\,\\text{kcal mol}^{-1}$，则断定该系统是单参考的并继续；否则，标记为多参考。\n- 步骤 $2$：跳过密度敏感性检查；双杂化方法是变分的，因此对密度选择不敏感。\n\n选择最能满足所述科学标准并为标记双杂化方法可能不可靠的系统提供实用、合理路径的选项。只有一个选项是完全正确的。", "solution": "任务是验证并选择一个科学合理的工作流程来应用双杂化密度泛函。该工作流程必须正确识别并为两个已知的失效模式提出补救措施：(i) 在存在强静态相关时，Møller–Plesset 二阶微扰理论 (MP2) 部分的不可靠性，以及 (ii) 来自基础密度泛函理论 (DFA) 计算的大密度驱动误差。\n\n首先，我将验证问题陈述。\n\n**步骤 1：提取给定信息**\n- **方法：** 双杂化密度泛函。\n- **问题背景：** 一种非自洽的评估，其中类 MP2 相关能 $E_c^{\\text{MP2}}$ 是使用来自基础 DFA 的 Kohn–Sham (KS) 轨道计算的。总能量是 DFA 能量和一个按比例缩放的 MP2 校正项之和，例如，$E_{\\text{DH}} = E_{\\text{DFA}} + c_2 E_c^{\\text{MP2}}$。\n- **失效模式 1 (静态相关)：** MP2 部分作为一种单参考微扰理论，对于具有强静态（多参考）相关的系统会变得不可靠甚至发散。\n- **失效模式 2 (密度驱动误差)：** 基础 DFA 可能会产生一个较差的自洽密度 $n_{\\text{DFA}}$，导致大的“密度驱动误差”。这个误差会影响 DFA 能量部分，并通过 KS 轨道传播到 $E_c^{\\text{MP2}}$ 项。\n- **静态相关诊断（指标 1）：** 耦合簇单双激发 (CCSD) 的 $T_1$ 诊断。推荐的阈值为，闭壳层系统 $T_1 \\gtrsim 0.02$，开壳层系统 $T_1 \\gtrsim 0.044$。\n- **静态相关诊断（指标 2）：** 自然轨道占据数 (NOONs)。与理想值（占据轨道为 2，虚拟轨道为 0）的偏差超过约 $0.1$（例如，$n_{\\text{HOMO}} \\lesssim 1.9$ 或 $n_{\\text{LUMO}} \\gtrsim 0.1$）表明存在多参考特性。\n- **密度驱动误差诊断：** 密度敏感性度量，$S_{\\text{DFA}} \\equiv \\left| E_{\\text{DFA}}\\!\\left[n_{\\text{DFA}}\\right] - E_{\\text{DFA}}\\!\\left[n_{\\text{HF}}\\right] \\right|$。$S_{\\text{DFA}} \\gtrsim 2\\,\\text{kcal mol}^{-1}$ 的值被认为是显著的。\n- **补救措施：** 对于强静态相关，多参考方法（例如，CASSCF/NEVPT2）是合适的。对于大的密度驱动误差，使用更可靠的密度/轨道集（例如，来自 Hartree–Fock, HF）或使用轨道优化的双杂化变体可以减轻误差。\n\n**步骤 2：使用提取的给定信息进行验证**\n问题陈述是科学上合理的。所描述的双杂化泛函的失效模式在量子化学文献中有充分的记载。所提出的诊断方法——$T_1$ 诊断、NOON 分析和 $S_{\\text{DFA}}$ 度量——分别是评估多参考特性和密度驱动误差的标准工具。建议的阈值和补救措施与既定的最佳实践一致。这个问题提得很好，要求根据一套明确的科学原则来评估几个提议的工作流程。设置中没有矛盾、歧义或事实不准确之处。\n\n**步骤 3：结论与行动**\n问题是有效的。我现在将开始分析各个选项。\n\n一个科学合理的工作流程必须优先检查静态相关，因为这代表了该方法拟设（微扰校正）更根本性的失效。如果确定系统是单参考的，那么随后检查密度驱动误差是合乎逻辑的。为每个被标记的问题所规定的措施必须是直接针对特定误差来源的补救措施。\n\n**逐项分析选项**\n\n**A. 工作流程：**\n- **步骤 1 (静态相关筛选)：** 此步骤正确地采用了两种稳健的静态相关诊断方法：CCSD $T_1$ 诊断和 NOON 分析。指定的数值阈值（$T_1 \\ge 0.02$ 和 $T_1 \\ge 0.044$；NOON 偏差约 $0.1$）是标准的且在科学上是可辩护的。标记后规定的措施也是正确的：避免使用常规双杂化方法，并使用适当的多参考方法（CASSCF/NEVPT2）或谨慎使用可能更稳健的轨道优化的双杂化方法。这正确地识别并解决了失效模式 1。\n- **步骤 2 (密度敏感性)：** 此步骤在通过第一步筛选的系统上执行，这是正确的逻辑顺序。它使用了问题陈述中定义的密度敏感性度量 $S_{\\text{DFA}}$，并采用了推荐的 $2\\,\\text{kcal mol}^{-1}$ 阈值。为被标记的系统（$S_{\\text{DFA}} \\ge 2\\,\\text{kcal mol}^{-1}$）规定的措施是使用可能更可靠的轨道集（来自 HF）或使用轨道优化的变体。根据问题中的给定信息，这两种都是减轻密度驱动误差的有效策略。对于通过检查的系统，它正确地建议常规的双杂化方法可能是可靠的。这正确地识别并解决了失效模式 2。\n- **步骤 3 (最终标记)：** 这是一个总结性陈述。虽然其逻辑结构略显笨拙，但这并不影响其前面程序步骤的合理性。步骤 1 和 2 中的工作流程核心非常出色。\n- **结论：** 基于所提供的原则，这个工作流程是系统性的，使用了具有适当阈值的最先进的诊断方法，并推荐了科学合理的措施。这是一个稳健且实用的协议。**正确**。\n\n**B. 工作流程：**\n- **步骤 1：** 此步骤仅依赖于 KS HOMO–LUMO 能隙。虽然小能隙可能与静态相关有关，但它不是一个可靠或充分的诊断指标。许多具有小能隙的系统在特性上是完全单参考的，此检查会产生许多假阳性。反之，在其他情况下，它也可能无法检测到多参考特性。它舍弃了远比它可靠的 $T_1$ 和 NOON 诊断。\n- **步骤 2：** 此步骤提出了一个基于完全自洽双杂化方法的度量，而这通常不是正在使用的方法，并规定如果度量值高于 $0.5\\,\\text{kcal mol}^{-1}$，则退回到纯 HF 计算。为了 HF 计算而放弃像双杂化这样的相关方法是一个过于简单化且通常很差的措施，因为它完全丢弃了对动态相关的处理。更好的措施是改进双杂化计算，而不是放弃它。阈值也设置得过低，带有随意性。\n- **结论：** 这个工作流程基于一个糟糕的诊断方法和一个不恰当的补救措施。**不正确**。\n\n**C. 工作流程：**\n- **步骤 1：** 此步骤依赖于自旋污染度量 $\\langle \\hat{S}^2 \\rangle$。虽然有用，但这个诊断方法并不通用；它对闭壳层多参考系统以及同样可以具有多参考特性的限制性开壳层情况无效。舍弃更优越的 $T_1$ 和 NOON 诊断是一个糟糕的选择。\n- **步骤 2：** 此步骤使用 LDA 泛函进行密度敏感性测试。众所周知，LDA 存在极端的离域误差，使其成为此诊断的一个糟糕且过于敏感的选择。建议的 $0.2\\,\\text{kcal mol}^{-1}$ 阈值过于严格，几乎会标记所有分子系统，使得该诊断对于实际筛选毫无用处。\n- **结论：** 这个工作流程使用了不完整且选择不当的诊断方法和阈值。**不正确**。\n\n**D. 工作流程：**\n- **步骤 1：** 此步骤使用了 $T_1$ 诊断，但阈值过高（闭壳层为 $0.05$，开壳层为 $0.10$），这将无法标记许多具有显著多参考特性的系统。关键是，它规定的措施在科学上是倒退的：它建议在系统被标记为静态相关*时*，*使用*常规的双杂化方法。这与 MP2 在此情况下失效的基本原则相矛盾。关于精确交换部分会使其稳定的理由在这种情况下是毫无意义的。\n- **步骤 2：** 此步骤建议即使在检测到大的密度驱动误差时，也*保留*自洽的 KS 密度，其错误前提是“自洽总是有益的”。这表明对密度驱动误差有根本性的误解，即对于给定的近似泛函，自洽解可能在定性上是错误的。正确的措施是替换差的密度/轨道，而不是坚持使用它们。\n- **结论：** 对于两种失效模式，这个工作流程都基于颠倒的逻辑和不科学的推理。**不正确**。\n\n**E. 工作流程：**\n- **步骤 1：** MP2 相关能的大小 $|E_c^{\\text{MP2}}|$ 是单参考与多参考特性的直接指标这一前提是错误的。大的 $|E_c^{\\text{MP2}}|$ 仅表示大的相关校正，这可能发生在单参考和多参考系统中。对于强相关系统，MP2 能量可能会变得不合物理地大且为负，但没有像建议的那样简单的阈值规则。所呈现的逻辑是完全颠倒和毫无根据的。\n- **步骤 2：** 此步骤跳过了密度敏感性检查，声称双杂化方法“是变分的，因此对密度选择不敏感”。这在两方面都是错误的。首先，非自洽的“后-KS”双杂化方法相对于轨道变分不是变分的。其次，即使对于变分方法，能量也是密度的泛函，差的密度将产生差的能量。\n- **结论：** 这个工作流程完全建立在错误的科学前提之上，并表现出对基础理论的严重缺乏理解。**不正确**。\n\n总之，只有工作流程 A 提出了一个与现代量子化学原理一致的、科学有效、逻辑合理且实用的方案。", "answer": "$$\\boxed{A}$$", "id": "2886741"}]}