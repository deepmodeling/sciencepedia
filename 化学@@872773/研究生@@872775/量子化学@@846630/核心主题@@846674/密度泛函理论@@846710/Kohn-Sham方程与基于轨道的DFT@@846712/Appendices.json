{"hands_on_practices": [{"introduction": "Kohn-Sham密度泛函理论的基石是Hohenberg-Kohn定理，它确保了基态电子密度与外势之间存在一一对应关系。这个实践练习将此抽象定理转化为一个具体的数值任务：通过实现势反演算法，从一个给定的精确电子密度出发，反向求解出产生该密度的唯一Kohn-Sham有效势$v_s(x)$。通过这项练习[@problem_id:2901327]，您将获得使用有限差分等数值方法处理KS方程的核心技能，并深刻理解密度与势之间的基本联系。", "problem": "您将实现并测试一个闭壳层双电子体系在 Kohn-Sham 密度泛函理论中的一维势反演问题。请完全在哈特里原子单位制下进行计算，其中电子质量、基本电荷、约化普朗克常数以及库仑常数均为 $1$。您的程序不应读取任何输入，且必须按照下文规定输出单行结果。\n\n起点与物理背景：对于一维自旋补偿双电子基态的 Kohn-Sham (KS) 无相互作用体系，存在一个被自旋相反的两个电子双重占据的单空间轨道 $\\,\\varphi(x)\\,$。电子密度为 $\\,n(x) = 2\\,|\\varphi(x)|^2\\,$，该轨道满足带有效单粒子 KS 势 $\\,v_s(x)\\,$ 的一维不含时薛定谔方程，\n$$\n-\\frac{1}{2}\\,\\frac{d^2 \\varphi(x)}{dx^2} + v_s(x)\\,\\varphi(x) = \\varepsilon\\,\\varphi(x),\n$$\n其中 $\\,\\varepsilon\\,$ 是轨道能。KS 势 $\\,v_s(x)\\,$ 的定义可以相差一个任意的加法常数，这不影响 $\\,\\varphi(x)\\,$。\n\n任务：给定一个在有限区间 $[x_{\\min}, x_{\\max}]$ 上的精确目标密度分布 $\\,n(x)\\,$。您的任务是：\n- 从第一性原理出发，推导如何在此闭壳层双电子情形下反演一维 KS 方程，以获得能够再现给定 $\\,n(x)\\,$ 的 KS 势 $\\,v_s(x)\\,$。\n- 使用有限差分法和狄利克雷边界条件 $\\,\\varphi(x_{\\min}) = \\varphi(x_{\\max}) = 0\\,$，在均匀网格上数值实现该反演过程。您必须根据密度构造 $\\,v_s(x)\\,$，然后求解得到的一维薛定谔本征值问题以获得最低能量轨道，并重构密度 $\\,\\tilde n(x) = 2\\,|\\tilde\\varphi(x)|^2\\,$。所有轨道都需根据连续内积进行归一化，以使 $\\,\\int_{x_{\\min}}^{x_{\\max}} |\\varphi(x)|^2\\,dx = 1\\,$。\n- 使用相对 $L^2$ 误差范数验证重构密度 $\\,\\tilde n(x)\\,$ 是否在指定容差内与输入 $\\,n(x)\\,$ 匹配\n$$\n\\mathcal{E} = \\frac{\\left(\\int_{x_{\\min}}^{x_{\\max}} \\left[ \\tilde n(x) - n(x) \\right]^2 dx\\right)^{1/2}}{\\left(\\int_{x_{\\min}}^{x_{\\max}} n(x)^2 dx\\right)^{1/2}}.\n$$\n\n数值与算法要求：\n- 在 $[x_{\\min}, x_{\\max}]$ 上使用包含 $\\,N\\,$ 个点的均匀网格，网格间距为 $\\,h = (x_{\\max} - x_{\\min})/(N-1)\\,$。\n- 对内部网格点上的二阶导数使用标准的二阶中心有限差分近似。通过将端点排除在本征值问题之外来施加狄利克雷边界条件。\n- 为内部点构造哈密顿矩阵，该矩阵为一个对称三对角矩阵，代表算符 $-\\frac{1}{2}\\frac{d^2}{dx^2} + v_s(x)$。\n- $\\,v_s(x)\\,$ 中的任何整体加法常数都是任意的；您可以选择一个方便的规范（例如，如果 $\\,0 \\in [x_{\\min}, x_{\\max}]$，则设置 $\\,v_s(0)=0\\,$，或减去网格中点处的值）。\n\n测试套件与密度：\n实现以下四个测试用例。在所有用例中，使用由一个光滑、无节点的靶轨道 $\\,\\varphi(x)\\,$ 生成的精确双电子密度 $\\,n(x) = 2\\,|\\varphi(x)|^2\\,$。在计算 $\\,n(x)\\,$ 之前，必须在选定的网格上数值地强制执行连续归一化条件 $\\,\\int |\\varphi(x)|^2 dx = 1\\,$。对于每个用例，以布尔值的形式报告 $\\,\\mathcal{E}\\,$ 是否小于或等于指定的容差。\n\n- 用例 1 (高斯函数，中等宽度)：\n  - 区间：$[x_{\\min}, x_{\\max}] = [-10, 10]$。\n  - 网格：$N = 1201$。\n  - 靶轨道：$\\,\\varphi(x) \\propto \\exp\\!\\left(-\\frac{\\alpha x^2}{2}\\right)\\,$，其中 $\\,\\alpha = 1.0\\,$。\n  - 容差：$\\,1.5\\times 10^{-3}\\,$。\n\n- 用例 2 (高斯函数，窄)：\n  - 区间：$[x_{\\min}, x_{\\max}] = [-6, 6]$。\n  - 网格：$N = 1201$。\n  - 靶轨道：$\\,\\varphi(x) \\propto \\exp\\!\\left(-\\frac{\\alpha x^2}{2}\\right)\\,$，其中 $\\,\\alpha = 2.5\\,$。\n  - 容差：$\\,2.0\\times 10^{-3}\\,$。\n\n- 用例 3 (双曲正割，类 Pöschl–Teller)：\n  - 区间：$[x_{\\min}, x_{\\max}] = [-15, 15]$。\n  - 网格：$N = 2001$。\n  - 靶轨道：$\\,\\varphi(x) \\propto \\operatorname{sech}(b x)\\,$，其中 $\\,b = 0.8\\,$。\n  - 容差：$\\,2.0\\times 10^{-3}\\,$。\n\n- 用例 4 (高斯函数，非常宽)：\n  - 区间：$[x_{\\min}, x_{\\max}] = [-30, 30]$。\n  - 网格：$N = 2401$。\n  - 靶轨道：$\\,\\varphi(x) \\propto \\exp\\!\\left(-\\frac{\\alpha x^2}{2}\\right)\\,$，其中 $\\,\\alpha = 0.15\\,$。\n  - 容差：$\\,3.0\\times 10^{-3}\\,$。\n\n实现指导与约束：\n- 基于上述基础薛定谔方程构建反演过程，除了标准的有限差分和线性代数方法外，不要引入任何特定于模型的捷径。您不得硬编码任何解析势形式。\n- 为了从给定的 $\\,n(x)\\,$ 构造 $\\,v_s(x)\\,$ 时的数值稳定性，您可以通过将低于某个小的正阈值的分母替换为该阈值本身，来对除以极小轨道值的运算进行正则化；请确保所选阈值足够小，不会破坏内部解。\n- 在内部网格上构造 $\\,v_s(x)\\,$ 后，求解三对角本征值问题以获得最低能量轨道并重构密度。使用间距为 $\\,h\\,$ 的黎曼和来近似积分进行归一化（例如，$\\,\\sum_i |\\varphi(x_i)|^2 h \\approx 1\\,$）。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含按顺序排列的四个用例的结果，形式为方括号内由逗号分隔的列表。每个条目必须是一个布尔值，指示验证是否通过，例如 $[{\\tt True},{\\tt False},{\\tt True},{\\tt True}]$。\n\n不涉及角度单位。所有物理量均以原子单位制表示。不允许在标准输出 (stdout) 上有任何其他输出。", "solution": "所提供的问题陈述经过了严格验证。\n\n**1. 问题验证**\n\n- **提取的已知条件：** 该系统是一个一维、双电子、闭壳层系统，由 Kohn-Sham (KS) 方程 $-\\frac{1}{2}\\,\\frac{d^2 \\varphi(x)}{dx^2} + v_s(x)\\,\\varphi(x) = \\varepsilon\\,\\varphi(x)$ 描述，电子密度为 $n(x) = 2\\,|\\varphi(x)|^2$。任务是在给定目标密度 $n(x)$ 的情况下，在有限区间 $[x_{\\min}, x_{\\max}]$ 上使用狄利克雷边界条件 $\\varphi(x_{\\min})=\\varphi(x_{\\max})=0$ 反演此方程。数值实现必须在均匀网格上使用有限差分方案。提供了四个测试用例，包含具体参数以及针对相对 $L^2$ 误差范数\n$$\n\\mathcal{E} = \\frac{\\left(\\int_{x_{\\min}}^{x_{\\max}} \\left[ \\tilde n(x) - n(x) \\right]^2 dx\\right)^{1/2}}{\\left(\\int_{x_{\\min}}^{x_{\\max}} n(x)^2 dx\\right)^{1/2}}.\n$$\n的验证容差。\n- **验证结论：** 该问题被判定为**有效**。它在科学上基于密度泛函理论的原理，在数学上是适定的，并且其规定完全客观和清晰。它提出了计算量子化学中一个标准的、非平凡的问题，没有矛盾、歧义或事实错误。我们可以着手进行求解。\n\n**2. 反演公式的推导**\n\n目标是确定能够产生给定基态电子密度 $n(x)$ 的有效 Kohn-Sham 势 $v_s(x)$。对于一个自旋补偿的双电子体系，密度由单个双占据的空间轨道 $\\varphi(x)$ 产生，使得 $n(x) = 2|\\varphi(x)|^2$。在一维情况下，实势的基态轨道可以选择为实数且非负，即 $\\varphi(x) \\ge 0$。因此，轨道由密度唯一确定：\n$$\n\\varphi(x) = \\sqrt{\\frac{n(x)}{2}}\n$$\nKohn-Sham 方程是关于单粒子轨道 $\\varphi(x)$ 的不含时薛定谔方程：\n$$\n-\\frac{1}{2}\\frac{d^2\\varphi(x)}{dx^2} + v_s(x)\\varphi(x) = \\varepsilon\\varphi(x)\n$$\n其中 $\\varepsilon$ 是轨道能。假设在定义域内部 $\\varphi(x) > 0$，我们可以重排此方程来求解 $v_s(x)$：\n$$\nv_s(x)\\varphi(x) = \\varepsilon\\varphi(x) + \\frac{1}{2}\\frac{d^2\\varphi(x)}{dx^2}\n$$\n$$\nv_s(x) = \\varepsilon + \\frac{1}{2\\varphi(x)}\\frac{d^2\\varphi(x)}{dx^2}\n$$\n轨道能 $\\varepsilon$ 是一个常数。势 $v_s(x)$ 的定义只相差一个任意的加法常数，因为一个位移 $v_s(x) \\to v_s(x) + C$ 仅仅使能量本征值发生位移 $\\varepsilon \\to \\varepsilon + C$，而不会改变轨道 $\\varphi(x)$。因此，我们可以忽略常数 $\\varepsilon$，并相对于一个选定的参考点来定义势。势反演的操作公式为：\n$$\nv_s(x) = \\frac{1}{2\\varphi(x)}\\frac{d^2\\varphi(x)}{dx^2} + C'\n$$\n其中 $C'$ 是为固定规范而选择的常数，而 $\\varphi(x)$ 直接从目标密度 $n(x)$ 获得。\n\n**3. 数值步骤**\n\n该推导过程通过一个精确的算法序列进行数值实现。\n\n- **步骤 1：网格与目标数据生成**\n在区间 $[x_{\\min}, x_{\\max}]$ 上建立一个均匀网格 $x_i$ (其中 $i=0, \\dots, N-1$)，网格间距为 $h=(x_{\\max}-x_{\\min})/(N-1)$。对于每个测试用例，靶轨道的解析形式 $\\varphi_{\\text{analytic}}(x)$ 在此网格上被求值。然后对这个离散的轨道进行数值归一化，以满足由黎曼和近似的连续归一化条件：\n$$\nA = \\left( \\sum_{i=0}^{N-1} |\\varphi_{\\text{analytic}}(x_i)|^2 h \\right)^{-1/2}\n$$\n网格上归一化后的靶轨道为 $\\varphi_{\\text{target}}(x_i) = A \\cdot \\varphi_{\\text{analytic}}(x_i)$，目标密度为 $n_{\\text{target}}(x_i) = 2|\\varphi_{\\text{target}}(x_i)|^2$。\n\n- **步骤 2：势反演**\n势 $v_s(x)$ 在内部网格点（$i=1, \\dots, N-2$）上被构造。反演公式中的项 $\\varphi(x)$ 对应于 $\\varphi_{\\text{target}}(x_i)$。$\\varphi_{\\text{target}}(x)$ 的二阶导数使用二阶中心有限差分公式进行近似：\n$$\n\\frac{d^2\\varphi_{\\text{target}}(x_i)}{dx^2} \\approx \\frac{\\varphi_{\\text{target}}(x_{i-1}) - 2\\varphi_{\\text{target}}(x_i) + \\varphi_{\\text{target}}(x_{i+1})}{h^2}\n$$\n势的计算公式为：\n$$\nv_s(x_i) = \\frac{1}{2\\varphi_{\\text{target}}(x_i)} \\left( \\frac{\\varphi_{\\text{target}}(x_{i-1}) - 2\\varphi_{\\text{target}}(x_i) + \\varphi_{\\text{target}}(x_{i+1})}{h^2} \\right)\n$$\n为防止在 $\\varphi_{\\text{target}}(x_i)$ 接近零时（靠近边界处）出现数值不稳定性，分母通过将小于阈值 $\\delta > 0$ 的值替换为 $\\delta$ 本身来进行正则化。最后，将势平移一个常数，使其在网格中点的值为零，以固定规范。\n\n- **步骤 3：求解本征值问题**\n利用为内部点构造的势 $v_s(x_i)$，形成离散化的 Kohn-Sham 哈密顿矩阵 $H$。$H$ 是一个 $(N-2) \\times (N-2)$ 的对称三对角矩阵，对应于带有狄利克雷边界条件的算符 $-\\frac{1}{2}\\frac{d^2}{dx^2} + v_s(x)$。其矩阵元为：\n$$\nH_{ij} = \\begin{cases} \\frac{1}{h^2} + v_s(x_i)  \\text{if } i=j \\\\ -\\frac{1}{2h^2}  \\text{if } |i-j|=1 \\\\ 0  \\text{otherwise} \\end{cases}\n$$\n使用专门的数值线性代数程序（`scipy.linalg.eigh_tridiagonal`）计算该矩阵的最低本征值和相应的本征向量。得到的本征向量包含了重构轨道 $\\tilde\\varphi_{\\text{vec}}$ 在内部网格点上的值。\n\n- **步骤 4：验证与误差计算**\n计算出的本征向量 $\\tilde\\varphi_{\\text{vec}}$ 被归一化以符合连续积分表示：\n$$\n\\tilde\\varphi(x_i) = \\frac{\\tilde\\varphi_{\\text{vec}}[i-1]}{\\sqrt{h}} \\quad \\text{for } i=1, \\dots, N-2\n$$\n形成一个大小为 $N$ 的完整轨道向量 $\\tilde\\varphi$，其中 $\\tilde\\varphi(x_0)=0$ 且 $\\tilde\\varphi(x_{N-1})=0$。调整其符号为正，以匹配无节点的基态靶轨道。然后，重构的密度为 $\\tilde n(x_i) = 2|\\tilde\\varphi(x_i)|^2$。\n反演的精度通过相对 $L^2$ 误差范数 $\\mathcal{E}$ 进行量化，其数值计算如下：\n$$\n\\mathcal{E} = \\frac{\\left(\\sum_{i=0}^{N-1} [\\tilde n(x_i) - n_{\\text{target}}(x_i)]^2 h \\right)^{1/2}}{\\left(\\sum_{i=0}^{N-1} [n_{\\text{target}}(x_i)]^2 h \\right)^{1/2}}\n$$\n对于每个测试用例，将此误差与指定的容差进行比较，以得出布尔型的验证结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh_tridiagonal\n\ndef _process_case(xmin, xmax, N, orbital_type, param, tolerance):\n    \"\"\"\n    Performs the potential inversion and verification for a single test case.\n    \"\"\"\n    # Step 1: Grid and Target Data Generation\n    x_grid = np.linspace(xmin, xmax, N)\n    h = x_grid[1] - x_grid[0]\n\n    # Generate unnormalized analytic orbital\n    if orbital_type == 'gaussian':\n        alpha = param\n        phi_unnormalized = np.exp(-alpha * x_grid**2 / 2.0)\n    elif orbital_type == 'sech':\n        b = param\n        # Use np.exp for potentially better performance/stability than a direct cosh call\n        phi_unnormalized = 2.0 / (np.exp(b * x_grid) + np.exp(-b * x_grid))\n    else:\n        # This branch should not be reached with the given valid problem statement.\n        raise ValueError(f\"Unknown orbital type: {orbital_type}\")\n\n    # Numerically normalize the target orbital using Riemann sum\n    # Integral(|phi|^2 dx) approx sum(|phi_i|^2 * h) = 1\n    norm_sq_integral = np.sum(phi_unnormalized**2) * h\n    phi_target = phi_unnormalized / np.sqrt(norm_sq_integral)\n\n    # Calculate target density\n    n_target = 2.0 * phi_target**2\n\n    # Step 2: Potential Inversion\n    # We invert the KS equation to find v_s from phi_target.\n    # The formula is v_s = (1/2) * (d^2(phi)/dx^2) / phi, up to a constant.\n    # We operate on the interior grid points where boundary conditions are not applied.\n    \n    # Second derivative of phi_target on the interior grid (size N-2)\n    d2_phi_target_interior = (phi_target[2:] - 2*phi_target[1:-1] + phi_target[:-2]) / h**2\n    phi_target_interior = phi_target[1:-1]\n    \n    # Regularize the denominator phi_target to avoid division by zero\n    regularization_threshold = 1e-10\n    phi_denom_reg = np.maximum(phi_target_interior, regularization_threshold)\n    \n    # Calculate potential on the interior grid\n    v_s_interior_raw = 0.5 * d2_phi_target_interior / phi_denom_reg\n    \n    # Fix the gauge by setting the potential at the grid midpoint to zero\n    mid_idx_interior = (N - 2) // 2\n    v_s_interior = v_s_interior_raw - v_s_interior_raw[mid_idx_interior]\n\n    # Step 3: Eigenproblem Solution\n    # Construct the tridiagonal Hamiltonian matrix for the interior grid.\n    # H = T + V, where T is kinetic energy and V is potential energy.\n    diag = 1.0 / h**2 + v_s_interior\n    offdiag = -1.0 / (2.0 * h**2) * np.ones(N - 3)\n    \n    # Solve the eigenproblem for the lowest eigenvalue (ground state)\n    eigenvalues, eigenvectors = eigh_tridiagonal(diag, offdiag, select='i', select_range=(0,0))\n    gs_eigenvector = eigenvectors[:, 0]\n    \n    # Step 4: Verification and Error Calculation\n    # Normalize the eigenvector for continuous inner product: integral(|phi|^2) = 1\n    # The solver returns an eigenvector where sum(vec_i^2) = 1.\n    # We must scale by 1/sqrt(h) to match the Riemann sum integral normalization.\n    phi_reconstructed_interior = gs_eigenvector / np.sqrt(h)\n\n    # Ensure the reconstructed orbital has a positive sign, matching the target.\n    if phi_reconstructed_interior[mid_idx_interior]  0:\n        phi_reconstructed_interior *= -1.0\n        \n    # Assemble the full reconstructed orbital with boundaries\n    phi_reconstructed = np.zeros(N)\n    phi_reconstructed[1:-1] = phi_reconstructed_interior\n    \n    # Reconstruct density\n    n_reconstructed = 2.0 * phi_reconstructed**2\n    \n    # Calculate the relative L2 error norm\n    numerator_sq_integral = np.sum((n_reconstructed - n_target)**2 * h)\n    denominator_sq_integral = np.sum(n_target**2 * h)\n    \n    # Handle the unlikely case of a zero-norm target density\n    if denominator_sq_integral  1e-20:\n        error = 0.0 if numerator_sq_integral  1e-20 else np.inf\n    else:\n        error = np.sqrt(numerator_sq_integral / denominator_sq_integral)\n        \n    # Return boolean result of the check\n    return error = tolerance\n\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (xmin, xmax, N, orbital_type, parameter, tolerance)\n        (-10.0, 10.0, 1201, 'gaussian', 1.0, 1.5e-3),  # Case 1\n        (-6.0, 6.0, 1201, 'gaussian', 2.5, 2.0e-3),   # Case 2\n        (-15.0, 15.0, 2001, 'sech', 0.8, 2.0e-3),      # Case 3\n        (-30.0, 30.0, 2401, 'gaussian', 0.15, 3.0e-3) # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters and process the case\n        xmin, xmax, N, orbital_type, param, tolerance = case\n        passed = _process_case(xmin, xmax, N, orbital_type, param, tolerance)\n        results.append(passed)\n\n    # Final print statement in the exact required format.\n    # Note: str(True) is 'True', str(False) is 'False' in Python.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2901327"}, {"introduction": "尽管Kohn-Sham框架在理论上是精确的，但其实际应用依赖于近似的交换相关泛函，而这些近似带来了固有的误差。其中最基本的就是自相互作用误差（SIE），即一个电子与其自身发生了非物理的相互作用。本练习[@problem_id:2901403]通过最简单的单电子体系——氢原子，清晰地揭示了这一问题：您将分析验证精确交换能如何完美抵消哈特里（Hartree）自相互作用，而常用的局域密度近似（LDA）和广义梯度近似（GGA）却会留下显著的残余误差。这项计算为了解和评估密度泛函的性能提供了关键的定量洞察。", "problem": "考虑一个处于非相对论性基态的单电子氢原子，使用 Kohn-Sham 密度泛函理论 (KS-DFT) 进行描述。其空间轨道是归一化的类氢原子 $1s$ 函数，且电子是完全自旋极化的。在 Hartree 原子单位制中进行计算，此时玻尔半径满足 $a_0 = 1$，电子密度呈球对称，等于\n\n$$\nn(r) \\;=\\; \\frac{1}{\\pi}\\,\\exp(-2 r),\n$$\n\n且系统恰好只有一个电子。\n\n从第一性原理和标准定义出发，完成以下任务：\n\n- 使用经典 Hartree 静电能的定义，\n\n$$\nE_{\\mathrm{H}}[n] \\;=\\; \\frac{1}{2}\\int \\!\\! \\int \\frac{n(\\mathbf{r})\\,n(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\,d\\mathbf{r}\\,d\\mathbf{r}',\n$$\n\n以及 Slater 行列式的 Hartree–Fock 交换能，\n\n$$\nE_{x}^{\\mathrm{HF}}[\\{\\varphi_i\\}] \\;=\\; -\\frac{1}{2}\\sum_{i,j}\\int \\!\\! \\int \\frac{\\varphi_i(\\mathbf{r})\\,\\varphi_j^{*}(\\mathbf{r})\\,\\varphi_j(\\mathbf{r}')\\,\\varphi_i^{*}(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\,d\\mathbf{r}\\,d\\mathbf{r}',\n$$\n\n根据这些定义，验证对于单电子系统，$E_{\\mathrm{H}} + E_{x}^{\\mathrm{exact}} = 0$ 成立，其中 $E_{x}^{\\mathrm{exact}}$ 表示在给定密度下求值的精确交换能泛函。\n\n- 接下来，对两种近似交换泛函，量化定义为 $E_{\\mathrm{H}} + E_{x}^{\\mathrm{approx}}$ 的残余自相互作用误差：\n  1. 自旋密度泛函理论的局域密度近似 (LDA) 交换能，\n  \n$$\n  E_{x}^{\\mathrm{LDA}}[n_{\\uparrow},n_{\\downarrow}] \\;=\\; -\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}\\int \\left(n_{\\uparrow}^{4/3} + n_{\\downarrow}^{4/3}\\right)\\,d\\mathbf{r},\n  $$\n\n  在完全自旋极化的氢原子密度 $n_{\\uparrow} = n$, $n_{\\downarrow} = 0$ 下求值。\n  2. 用于交换能的二阶梯度展开 (一种广义梯度近似 (GGA) 的原型)，\n  \n$$\n  E_{x}^{\\mathrm{GEA2}}[n] \\;=\\; -C_{x}\\int n(\\mathbf{r})^{4/3}\\left[1 + \\mu\\,s(\\mathbf{r})^{2}\\right]\\,d\\mathbf{r},\n  $$\n\n  其中 $C_{x} = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}$，$\\mu = \\frac{10}{81}$，约化梯度为 $s(\\mathbf{r}) = \\frac{|\\nabla n(\\mathbf{r})|}{2 k_{F}(\\mathbf{r})\\,n(\\mathbf{r})}$，局域费米波矢为 $k_{F}(\\mathbf{r}) = \\left(3\\pi^{2} n(\\mathbf{r})\\right)^{1/3}$。\n\n推导两种残余自相互作用误差的解析闭式表达式，\n\n$$\n\\Delta_{\\mathrm{LDA}} \\;=\\; E_{\\mathrm{H}}[n] + E_{x}^{\\mathrm{LDA}}[n_{\\uparrow}=n,n_{\\downarrow}=0], \n\\quad\n\\Delta_{\\mathrm{GEA2}} \\;=\\; E_{\\mathrm{H}}[n] + E_{x}^{\\mathrm{GEA2}}[n],\n$$\n\n用有理数以及 $\\pi$ 和 $3$ 的幂来表示。将最终答案表示为行矩阵 $\\bigl[\\Delta_{\\mathrm{LDA}}\\;\\;\\Delta_{\\mathrm{GEA2}}\\bigr]$，并使用 Hartree ($\\mathrm{E_h}$) 作为能量单位。不需要进行数值取整；请提供精确表达式。", "solution": "该问题陈述具有科学依据、问题明确且客观。所有给定的定义、常数和物理量在密度泛函理论框架内都是标准的，或是为本问题专门定义的。该任务是一个严谨且可验证的计算。因此，该问题被认为是有效的，并将提供完整的解答。\n\n该问题要求对单电子系统（特别是基态氢原子）中的自相互作用进行两部分的分析。所有计算都在 Hartree 原子单位制（$e=m_e=\\hbar=1$, $a_0=1$）下进行。\n\n第 1 部分：精确自相互作用抵消的验证\n\n对于任何单电子系统，基态电子密度 $n(\\mathbf{r})$ 由单个占据轨道 $\\varphi_1(\\mathbf{r})$ 的模方给出，即 $n(\\mathbf{r}) = |\\varphi_1(\\mathbf{r})|^2$。由于氢原子 $1s$ 轨道是实函数，我们有 $n(\\mathbf{r}) = \\varphi_1(\\mathbf{r})^2$。\n\nHartree 能量定义为：\n$$\nE_{\\mathrm{H}}[n] = \\frac{1}{2}\\int \\!\\! \\int \\frac{n(\\mathbf{r})\\,n(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\,d\\mathbf{r}\\,d\\mathbf{r}'\n$$\n代入 $n(\\mathbf{r}) = \\varphi_1(\\mathbf{r})^2$，我们得到：\n$$\nE_{\\mathrm{H}}[n] = \\frac{1}{2}\\int \\!\\! \\int \\frac{\\varphi_1(\\mathbf{r})^2\\,\\varphi_1(\\mathbf{r}')^2}{|\\mathbf{r}-\\mathbf{r}'|}\\,d\\mathbf{r}\\,d\\mathbf{r}'\n$$\n精确交换能 $E_{x}^{\\mathrm{exact}}$ 由在精确 Kohn-Sham 轨道上求值的 Hartree-Fock 交换能表达式给出。对于单电子系统，只有一个轨道 $\\varphi_1$。$E_{x}^{\\mathrm{HF}}$ 定义中对 $i$ 和 $j$ 的求和各自只有一个项，即 $i=j=1$。\n$$\nE_{x}^{\\mathrm{exact}} = E_{x}^{\\mathrm{HF}}[\\{\\varphi_1\\}] = -\\frac{1}{2}\\int \\!\\! \\int \\frac{\\varphi_1(\\mathbf{r})\\,\\varphi_1^{*}(\\mathbf{r})\\,\\varphi_1(\\mathbf{r}')\\,\\varphi_1^{*}(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\,d\\mathbf{r}\\,d\\mathbf{r}'\n$$\n由于 $\\varphi_1$ 是实数，$\\varphi_1^* = \\varphi_1$。表达式简化为：\n$$\nE_{x}^{\\mathrm{exact}} = -\\frac{1}{2}\\int \\!\\! \\int \\frac{\\varphi_1(\\mathbf{r})^2\\,\\varphi_1(\\mathbf{r}')^2}{|\\mathbf{r}-\\mathbf{r}'|}\\,d\\mathbf{r}\\,d\\mathbf{r}'\n$$\n将其与 Hartree 能量的表达式进行比较，我们看到：\n$$\nE_{x}^{\\mathrm{exact}} = -E_{\\mathrm{H}}[n]\n$$\n因此，对于任何单电子系统，Hartree 能量与精确交换能之和恒为零：\n$$\nE_{\\mathrm{H}}[n] + E_{x}^{\\mathrm{exact}} = 0\n$$\n这证明了在精确理论中自相互作用的完全抵消。然而，近似泛函通常不满足此条件，从而导致残余的自相互作用误差。\n\n第 2 部分：残余自相互作用误差的计算\n\n我们必须计算 $\\Delta_{\\mathrm{LDA}} = E_{\\mathrm{H}}[n] + E_{x}^{\\mathrm{LDA}}[n]$ 和 $\\Delta_{\\mathrm{GEA2}} = E_{\\mathrm{H}}[n] + E_{x}^{\\mathrm{GEA2}}[n]$。第一步是计算给定密度 $n(r) = \\frac{1}{\\pi}\\exp(-2r)$ 的 Hartree 能量 $E_{\\mathrm{H}}$。\n\nHartree 能量 $E_{\\mathrm{H}}$ 的计算\nHartree 能量是电荷分布 $n(\\mathbf{r})$ 的静电自能。它可以表示为 $E_{\\mathrm{H}} = \\frac{1}{2}\\int n(\\mathbf{r}) V_{\\mathrm{H}}(\\mathbf{r}) \\,d\\mathbf{r}$，其中 $V_{\\mathrm{H}}(\\mathbf{r})$ 是由 $n(\\mathbf{r})$ 产生的静电势。对于球对称密度，电势为：\n$$\nV_{\\mathrm{H}}(r) = \\frac{1}{r} \\int_0^r n(r') 4\\pi r'^2 dr' + \\int_r^\\infty \\frac{n(r') 4\\pi r'^2}{r'} dr'\n$$\n使用 $n(r) = \\frac{1}{\\pi}\\exp(-2r)$，积分得出 $V_{\\mathrm{H}}(r) = \\frac{1}{r} - \\left(\\frac{1}{r}+1\\right)\\exp(-2r)$。\n现在我们计算 $E_{\\mathrm{H}}$：\n$$\nE_{\\mathrm{H}} = \\frac{1}{2} \\int_0^\\infty V_{\\mathrm{H}}(r) n(r) 4\\pi r^2 dr = \\frac{1}{2} \\int_0^\\infty \\left[\\frac{1}{r} - \\left(\\frac{1}{r}+1\\right)\\exp(-2r)\\right] \\left(\\frac{1}{\\pi}\\exp(-2r)\\right) 4\\pi r^2 dr\n$$\n$$\nE_{\\mathrm{H}} = 2 \\int_0^\\infty \\left[ r\\exp(-2r) - (r+r^2)\\exp(-4r) \\right] dr\n$$\n我们使用标准积分 $\\int_0^\\infty x^k \\exp(-ax) dx = k!/a^{k+1}$：\n- $\\int_0^\\infty r\\exp(-2r) dr = 1!/2^2 = \\frac{1}{4}$\n- $\\int_0^\\infty r^2\\exp(-4r) dr = 2!/4^3 = \\frac{2}{64} = \\frac{1}{32}$\n- $\\int_0^\\infty r\\exp(-4r) dr = 1!/4^2 = \\frac{1}{16}$\n代入这些结果：\n$$\nE_{\\mathrm{H}} = 2 \\left[ \\frac{1}{4} - \\left(\\frac{1}{16} + \\frac{1}{32}\\right) \\right] = 2 \\left[ \\frac{8}{32} - \\frac{2}{32} - \\frac{1}{32} \\right] = 2 \\left( \\frac{5}{32} \\right) = \\frac{5}{16}\n$$\n\nLDA 自相互作用误差 $\\Delta_{\\mathrm{LDA}}$ 的计算\n问题给出了自旋极化系统（$n_{\\uparrow}=n, n_{\\downarrow}=0$）的 LDA 交换能泛函为：\n$$\nE_{x}^{\\mathrm{LDA}}[n] = -\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}\\int n(\\mathbf{r})^{4/3}\\,d\\mathbf{r}\n$$\n我们计算积分 $\\int n(\\mathbf{r})^{4/3}\\,d\\mathbf{r}$：\n$$\n\\int n(r)^{4/3} 4\\pi r^2 dr = \\int_0^\\infty \\left(\\frac{1}{\\pi}\\exp(-2r)\\right)^{4/3} 4\\pi r^2 dr = 4\\pi \\pi^{-4/3} \\int_0^\\infty r^2 \\exp\\left(-\\frac{8}{3}r\\right) dr\n$$\n$$\n= 4\\pi^{-1/3} \\left( \\frac{2!}{(8/3)^3} \\right) = 4\\pi^{-1/3} \\left( \\frac{2}{512/27} \\right) = 4\\pi^{-1/3} \\left( \\frac{54}{512} \\right) = \\frac{27}{64}\\pi^{-1/3}\n$$\n现在我们将此结果代入 $E_{x}^{\\mathrm{LDA}}$ 的表达式中：\n$$\nE_{x}^{\\mathrm{LDA}} = -\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3} \\left(\\frac{27}{64}\\pi^{-1/3}\\right) = -\\frac{3}{4} \\frac{3^{1/3}}{\\pi^{1/3}} \\frac{27}{64\\pi^{1/3}} = -\\frac{81 \\cdot 3^{1/3}}{256 \\pi^{2/3}} = -\\frac{3^{4} \\cdot 3^{1/3}}{256 \\pi^{2/3}} = -\\frac{3^{13/3}}{256 \\pi^{2/3}}\n$$\nLDA 的残余自相互作用误差为：\n$$\n\\Delta_{\\mathrm{LDA}} = E_{\\mathrm{H}} + E_{x}^{\\mathrm{LDA}} = \\frac{5}{16} - \\frac{3^{13/3}}{256 \\pi^{2/3}}\n$$\n\nGEA2 自相互作用误差 $\\Delta_{\\mathrm{GEA2}}$ 的计算\nGEA2 交换能由下式给出：\n$$\nE_{x}^{\\mathrm{GEA2}}[n] = -C_{x}\\int n^{4/3}\\left[1 + \\mu\\,s^{2}\\right]\\,d\\mathbf{r} = E_{x}^{\\mathrm{LDA}} - C_x \\mu \\int n^{4/3}s^2\\,d\\mathbf{r}\n$$\n我们需要计算梯度修正项。首先，我们求出约化梯度 $s$：\n$s = \\frac{|\\nabla n|}{2 k_F n}$，其中 $k_F = (3\\pi^2 n)^{1/3}$。\n对于给定的密度，$\\nabla n = \\frac{dn}{dr}\\hat{\\mathbf{r}} = -2 \\frac{1}{\\pi}\\exp(-2r) \\hat{\\mathbf{r}} = -2n\\hat{\\mathbf{r}}$，所以 $|\\nabla n| = 2n$。\n$$\ns = \\frac{2n}{2 (3\\pi^2 n)^{1/3} n} = \\frac{1}{(3\\pi^2 n)^{1/3}} \\implies s^2 = \\frac{1}{(3\\pi^2 n)^{2/3}} = \\frac{1}{3^{2/3}\\pi^{4/3}n^{2/3}}\n$$\n修正项的被积函数是 $n^{4/3}s^2$：\n$$\nn^{4/3}s^2 = n^{4/3} \\frac{1}{3^{2/3}\\pi^{4/3}n^{2/3}} = \\frac{n^{2/3}}{3^{2/3}\\pi^{4/3}}\n$$\n梯度修正能量为：\n$$\n\\Delta E_{x}^{\\mathrm{GEA2}} = -C_x \\mu \\int \\frac{n^{2/3}}{3^{2/3}\\pi^{4/3}}\\,d\\mathbf{r} = -\\frac{C_x \\mu}{3^{2/3}\\pi^{4/3}} \\int n^{2/3}\\,d\\mathbf{r}\n$$\n我们计算积分 $\\int n^{2/3}\\,d\\mathbf{r}$：\n$$\n\\int n(r)^{2/3} 4\\pi r^2 dr = \\int_0^\\infty \\left(\\frac{1}{\\pi}\\exp(-2r)\\right)^{2/3} 4\\pi r^2 dr = 4\\pi \\pi^{-2/3} \\int_0^\\infty r^2 \\exp\\left(-\\frac{4}{3}r\\right) dr\n$$\n$$\n= 4\\pi^{1/3} \\left( \\frac{2!}{(4/3)^3} \\right) = 4\\pi^{1/3} \\left( \\frac{2}{64/27} \\right) = 4\\pi^{1/3} \\left( \\frac{54}{64} \\right) = \\frac{27}{8}\\pi^{1/3}\n$$\n将此结果以及 $C_x = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}$ 和 $\\mu = \\frac{10}{81}$ 代回：\n$$\n\\Delta E_{x}^{\\mathrm{GEA2}} = -\\left(\\frac{3}{4}\\frac{3^{1/3}}{\\pi^{1/3}}\\right) \\left(\\frac{10}{81}\\right) \\frac{1}{3^{2/3}\\pi^{4/3}} \\left(\\frac{27}{8}\\pi^{1/3}\\right)\n$$\n$$\n= -\\frac{3 \\cdot 10 \\cdot 27}{4 \\cdot 81 \\cdot 8} \\frac{3^{1/3}}{3^{2/3}} \\frac{\\pi^{1/3}}{\\pi^{1/3}\\pi^{4/3}} = -\\frac{810}{2592} \\cdot 3^{-1/3} \\pi^{-4/3} = -\\frac{5 \\cdot 162}{16 \\cdot 162} \\cdot 3^{-1/3} \\pi^{-4/3} = -\\frac{5}{16} 3^{-1/3} \\pi^{-4/3}\n$$\n总的 GEA2 交换能为 $E_{x}^{\\mathrm{GEA2}} = E_{x}^{\\mathrm{LDA}} + \\Delta E_{x}^{\\mathrm{GEA2}}$。残余自相互作用误差为：\n$$\n\\Delta_{\\mathrm{GEA2}} = E_{\\mathrm{H}} + E_{x}^{\\mathrm{GEA2}} = \\frac{5}{16} - \\frac{3^{13/3}}{256 \\pi^{2/3}} - \\frac{5}{16} 3^{-1/3} \\pi^{-4/3}\n$$\n最终结果是 $\\Delta_{\\mathrm{LDA}}$ 和 $\\Delta_{\\mathrm{GEA2}}$ 的表达式。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{5}{16} - \\frac{3^{13/3}}{256 \\pi^{2/3}}  \\frac{5}{16} - \\frac{3^{13/3}}{256 \\pi^{2/3}} - \\frac{5 \\cdot 3^{-1/3}}{16 \\pi^{4/3}} \\end{pmatrix}}\n$$", "id": "2901403"}, {"introduction": "在理解了局域近似的自相互作用误差之后，我们进一步探究其另一个重要缺陷：交换相关势的错误渐近行为。对于中性原子，正确的交换势在远离原子核处应以$−1/r$的形式衰减，但LDA和GGA势却以指数形式过快地衰减。本练习[@problem_id:2901394]引导您实现Krieger-Li-Iafrate (KLI) 近似，这是一种计算轨道依赖的优化有效势（OEP）的实用方法。通过将KLI势的正确渐近行为与LDA的错误行为进行对比，您将掌握更高阶泛函设计的核心思想，并理解其对于准确描述电离能、激发态和响应性质为何至关重要。", "problem": "本题要求您实现对球对称原子的 Krieger–Li–Iafrate (KLI) 近似优化有效势 (OEP) 交换势与局域密度近似 (LDA) 交换势进行的数值比较。您的实现必须基于第一性原理，与基于轨道的 Kohn-Sham (KS) 密度泛函理论 (DFT) 方法一致，并遵循以下约束和假设。\n\n所有计算完全在 Hartree 原子单位制中进行，因此长度单位为玻尔（bohr），势和能量单位为哈特里（hartree）。考虑一个自旋非极化、球对称的单轨道 KS 系统，该系统包含一个或两个束缚于电荷为 $Z$ 的原子核的电子。使用球对称的类氢 $1s$ 轨道密度\n$$\nn(r) = N \\frac{Z^{3}}{\\pi} e^{-2 Z r},\n$$\n其中 $N \\in \\{1,2\\}$ 表示占据单个空间轨道的电子数。在仅考虑交换的非相对论性 KS 理论中，球对称密度的电子-电子 Hartree 势由标准静电学结果给出\n$$\nv_{\\mathrm{H}}(r) = 4\\pi \\left[ \\frac{1}{r} \\int_{0}^{r} r'^{2} n(r')\\,dr' + \\int_{r}^{\\infty} r' n(r')\\,dr' \\right].\n$$\n自旋非极化系统的 LDA 交换势是 Dirac 均匀电子气的结果，\n$$\nv_{x}^{\\mathrm{LDA}}(r) = - \\left(\\frac{3}{\\pi}\\right)^{1/3} n(r)^{1/3}.\n$$\n仅使用这些基本定义和用于轨道依赖泛函的仅交换 OEP 的定义，推导上述单轨道情况下的 KLI 交换势，并用 $v_{\\mathrm{H}}(r)$ 和 $N$ 表示。然后，在一个径向网格上，使用类氢密度 $n(r)$ 和球形 $v_{\\mathrm{H}}(r)$ 积分，数值实现 $v_{x}^{\\mathrm{KLI}}(r)$ 和 $v_{x}^{\\mathrm{LDA}}(r)$。您必须选择一个均匀的径向网格 $r \\in [r_{\\min}, R_{\\max}]$，其中 $r_{\\min} > 0$，且 $R_{\\max}$ 足够大，以至于对于所有指定的测试用例，密度在 $R_{\\max}$ 处可以忽略不计。使用数值稳定的求积方案来计算定义 $v_{\\mathrm{H}}(r)$ 的积分。\n\n为了比较渐近行为，为每个测试用例定义尾部半径\n$$\nr_{\\mathrm{tail}} = \\frac{20}{Z},\n$$\n并计算以下两个尾部系数估计量：\n$$\nc_{\\mathrm{KLI}}(Z,N) = r_{\\mathrm{tail}}\\, v_{x}^{\\mathrm{KLI}}(r_{\\mathrm{tail}}), \\qquad\nc_{\\mathrm{LDA}}(Z,N) = r_{\\mathrm{tail}}\\, v_{x}^{\\mathrm{LDA}}(r_{\\mathrm{tail}}).\n$$\n这些标度关系可以判断 $v_{x}(r)$ 是以 $-A/r$ 的形式衰减（其中 $A$ 为有限系数，估计量将趋近于 $-A$），还是比 $r$ 的任何幂次都衰减得更快（估计量将趋近于 $0$）。所有势和距离必须使用 Hartree 原子单位，并且您必须将尾部系数估计量作为四舍五入到六位小数的实数输出。\n\n测试套件和要求的输出：\n- 实现您的程序，为以下由 $(Z,N)$ 指定的参数集计算 $c_{\\mathrm{KLI}}$ 和 $c_{\\mathrm{LDA}}$：\n    - 测试 1：$(Z,N) = (1,1)$。\n    - 测试 2：$(Z,N) = (2,1)$。\n    - 测试 3：$(Z,N) = (2,2)$。\n    - 测试 4：$(Z,N) = (5,2)$。\n- 对于每个测试，计算并报告数对 $\\left[c_{\\mathrm{KLI}}(Z,N),\\, c_{\\mathrm{LDA}}(Z,N)\\right]$，每个值都四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含按测试顺序列出的四个数对，用逗号分隔，并用方括号括起来。例如，输出格式必须是\n$$\n[\\,[c_{\\mathrm{KLI}}^{(1)},c_{\\mathrm{LDA}}^{(1)}],\\,[c_{\\mathrm{KLI}}^{(2)},c_{\\mathrm{LDA}}^{(2)}],\\,[c_{\\mathrm{KLI}}^{(3)},c_{\\mathrm{LDA}}^{(3)}],\\,[c_{\\mathrm{KLI}}^{(4)},c_{\\mathrm{LDA}}^{(4)}]\\,].\n$$\n不得打印任何其他文本。\n\n您的实现必须是完全自包含的，不需要任何输入，并且确定性地运行。所有数学步骤必须与上述基本定义以及 Kohn-Sham 基于轨道的密度泛函理论一致。仅使用最终答案块中指定的允许的运行时和库。确保所有浮点输出按要求四舍五入到六位小数。所有计算必须在 Hartree 原子单位中执行，所有距离必须以玻尔为单位。不涉及角度。不涉及百分比。最终输出仅为实数，四舍五入到六位小数，并按所述组织成列表的列表。", "solution": "经评估，所提供的问题是有效的。它在科学上基于密度泛函理论的既定原则，问题阐述清晰，提供了所有必要信息，并使用客观、正式的语言进行陈述。该问题是计算量子化学中的一个标准练习，要求进行解析推导和数值实现，测试了优化有效势 (OEP) 方法、Krieger–Li–Iafrate (KLI) 近似和局域密度近似 (LDA) 等基本概念。因此，我们可以继续进行求解。\n\n目标是为单轨道 Kohn–Sham (KS) 系统推导 KLI 交换势 $v_{x}^{\\mathrm{KLI}}(r)$，并将其渐近行为与 LDA 交换势 $v_{x}^{\\mathrm{LDA}}(r)$ 的渐近行为进行比较。所有计算均在 Hartree 原子单位制中进行。\n\n该系统由 $N$ 个电子组成，其中 $N \\in \\{1, 2\\}$，占据一个球对称的空间轨道。电子密度由类氢 $1s$ 形式给出：\n$$\nn(r) = N \\frac{Z^{3}}{\\pi} e^{-2 Z r}\n$$\n该密度对应于总占据数为 $N$ 的单个空间轨道 $\\psi(r) = \\sqrt{Z^3/\\pi} e^{-Zr}$。\n\n首先，我们推导 KLI 交换势 $v_{x}^{\\mathrm{KLI}}(r)$。KLI 势是 OEP 方法中精确的、依赖于轨道的交换势的一种近似。对于每个自旋通道只有一个占据空间轨道的系统，KLI 势等同于精确的 OEP 势，即所谓的 Slater 势加上一个常数位移。\n\n情况 $N=1$：系统包含单个电子。在这种情况下，没有真正的电子-电子相互作用。Hartree 能量 $E_{\\mathrm{H}}[n]$ 代表了虚假的自相互作用，必须由交换能 $E_x[n]$ 精确抵消。因此，总的电子相互作用势 $v_{\\mathrm{H}}(r) + v_x(r)$ 必须为零。这要求交换势精确地抵消 Hartree 势：\n$$\nv_x(r) = -v_{\\mathrm{H}}(r)\n$$\n对于单电子系统，这是精确的交换势。OEP 形式体系，以及因此的 KLI 近似，必须重现这个精确结果。密度为 $N=1$ 时的 $n(r)$。\n$$\nv_{x}^{\\mathrm{KLI}}(r) = -v_{\\mathrm{H}}(r) \\quad (\\text{对于 } N=1)\n$$\n\n情况 $N=2$：系统在单个空间轨道中包含两个电子，形成一个自旋非极化的闭壳层单重态。我们有一个自旋向上和一个自旋向下的电子，其密度为 $n_{\\uparrow}(r) = n_{\\downarrow}(r) = n(r)/2$。交换相互作用仅发生在自旋相同的电子之间。因此，总交换能是自旋向上和自旋向下密度的自交换能之和：$E_x = E_x[n_{\\uparrow}] + E_x[n_{\\downarrow}]$。对于每个自旋通道 $\\sigma \\in \\{\\uparrow, \\downarrow\\}$，只有一个轨道。OEP 方程所需的特定于轨道的势为 $u_{x\\sigma}(r) = \\delta E_x / \\delta n_{\\sigma}(r) = -v_{\\mathrm{H}}[n_{\\sigma}](r)$。自旋通道 $\\sigma$ 的精确交换势为 $v_{x\\sigma}(r) = u_{x\\sigma}(r) + C_{\\sigma} = -v_{\\mathrm{H}}[n_{\\sigma}](r) + C_{\\sigma}$，其中 $C_{\\sigma}$ 是一个常数。对于非极化系统，$v_{x\\uparrow} = v_{x\\downarrow} = v_x$，且 $n_{\\uparrow} = n_{\\downarrow} = n/2$。常数 $C$ 由势在无穷远处消失的条件确定。对于大的 $r$，Hartree 势 $v_{\\mathrm{H}}[n/2](r)$ 以 $Q/r = (\\int (n(r')/2) 4\\pi r'^2 dr') / r = 1/r$ 的形式衰减。因此，为确保当 $r \\to \\infty$ 时 $v_x(r) \\to 0$，我们必须设置常数 $C=0$。因此，KLI 势为：\n$$\nv_{x}^{\\mathrm{KLI}}(r) = -v_{\\mathrm{H}}[n(r)/2] \\quad (\\text{对于 } N=2)\n$$\nHartree 势是密度的线性泛函，所以 $v_{\\mathrm{H}}[n/2] = v_{\\mathrm{H}}[n]/2$。这得到 $v_{x}^{\\mathrm{KLI}}(r) = -v_{\\mathrm{H}}(r)/2$。\n\n我们可以将两种情况统一为一个用总密度 $n(r)$ 和总电子数 $N$ 表示的表达式：\n$$\nv_{x}^{\\mathrm{KLI}}(r) = -\\frac{1}{N}v_{\\mathrm{H}}(r)\n$$\n这就是指定系统的 KLI 势的解析表达式。\n\n接下来，我们分析渐近行为。对于总电荷为 $N$ 的局域电荷分布，当 $r \\to \\infty$ 时，Hartree 势的行为是 $v_{\\mathrm{H}}(r) \\to N/r$。因此，KLI 势具有渐近形式：\n$$\nv_{x}^{\\mathrm{KLI}}(r) \\to -\\frac{1}{N}\\left(\\frac{N}{r}\\right) = -\\frac{1}{r}\n$$\n这证明了精确交换势正确的 $-1/r$ 衰减行为。因此，对于足够大的 $r_{\\mathrm{tail}}$，尾部系数估计量 $c_{\\mathrm{KLI}} = r_{\\mathrm{tail}} v_{x}^{\\mathrm{KLI}}(r_{\\mathrm{tail}})$ 将趋近于 $-1$。\n\n相比之下，LDA 交换势由以下公式给出：\n$$\nv_{x}^{\\mathrm{LDA}}(r) = - \\left(\\frac{3}{\\pi}\\right)^{1/3} n(r)^{1/3}\n$$\n代入 $n(r)$ 的表达式：\n$$\nv_{x}^{\\mathrm{LDA}}(r) = - \\left(\\frac{3}{\\pi}\\right)^{1/3} \\left(N \\frac{Z^{3}}{\\pi} e^{-2 Z r}\\right)^{1/3} = - \\left(\\frac{3N Z^3}{\\pi^2}\\right)^{1/3} e^{-2Zr/3}\n$$\n该势呈指数衰减，这在定性上是不正确的。由于指数因子 $e^{-2Zr_{\\mathrm{tail}}/3}$，尾部系数估计量 $c_{\\mathrm{LDA}} = r_{\\mathrm{tail}} v_{x}^{\\mathrm{LDA}}(r_{\\mathrm{tail}})$ 将趋近于 $0$。\n\n对于数值实现，我们必须在指定的尾部半径 $r_{\\mathrm{tail}} = 20/Z$ 处计算 $v_{\\mathrm{H}}(r)$。题目要求使用数值求积方案。Hartree 势定义为：\n$$\nv_{\\mathrm{H}}(r) = 4\\pi \\left[ \\frac{1}{r} \\int_{0}^{r} r'^{2} n(r')\\,dr' + \\int_{r}^{\\infty} r' n(r')\\,dr' \\right]\n$$\n对于每个测试用例 $(Z, N)$，我们计算 $r_{\\mathrm{tail}}$。两个积分使用 `scipy.integrate.quad` 函数进行数值计算，这是一个稳健的自适应求积例程。第二个积分的上限 $\\infty$ 被一个足够大的数 $R_{\\max}$ 替代，选择的 $R_{\\max}$ 要使得密度 $n(R_{\\max})$ 可以忽略不计。取值 $R_{\\max} = 100/Z$ 是绰绰有余的，因为指数项 $e^{-2ZR_{\\max}}$ 变为 $e^{-200}$。\n计算出 $v_{\\mathrm{H}}(r_{\\mathrm{tail}})$ 后，我们评估：\n$$\nc_{\\mathrm{KLI}}(Z,N) = r_{\\mathrm{tail}} \\left( -\\frac{1}{N}v_{\\mathrm{H}}(r_{\\mathrm{tail}}) \\right)\n$$\n$$\nc_{\\mathrm{LDA}}(Z,N) = r_{\\mathrm{tail}} \\left( - \\left(\\frac{3}{\\pi}\\right)^{1/3} n(r_{\\mathrm{tail}})^{1/3} \\right)\n$$\n然后按要求将结果四舍五入到六位小数。该实现被封装在一个 Python 脚本中，该脚本系统地处理测试套件并格式化输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes and compares the KLI and LDA exchange potential tail coefficients\n    for a single-orbital KS system.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1, 1),  # Test 1: (Z, N)\n        (2, 1),  # Test 2\n        (2, 2),  # Test 3\n        (5, 2),  # Test 4\n    ]\n\n    results = []\n    for Z, N in test_cases:\n        # Define constants for the current case.\n        # All calculations are in Hartree atomic units.\n\n        # Define the tail radius for asymptotic comparison.\n        r_tail = 20.0 / Z\n\n        # Define an integration upper bound R_max, large enough for the\n        # exponential density to be negligible.\n        R_max = 100.0 / Z\n\n        # Define the spherically symmetric electron density function n(r).\n        def n_func(r):\n            if r  0:\n                return 0.0\n            return N * (Z**3 / np.pi) * np.exp(-2 * Z * r)\n\n        # Define the integrands for the Hartree potential calculation.\n        def integrand1(r):\n            return r**2 * n_func(r)\n\n        def integrand2(r):\n            return r * n_func(r)\n\n        # Use numerical quadrature to compute the integrals for v_H(r).\n        # The quad function returns a tuple (result, error_estimate). We take the result [0].\n        I1, err1 = quad(integrand1, 0, r_tail)\n        I2, err2 = quad(integrand2, r_tail, R_max)\n\n        # Calculate the Hartree potential at r_tail.\n        v_H_tail = 4 * np.pi * (I1 / r_tail + I2)\n\n        # Calculate the KLI exchange potential at r_tail using the derived formula.\n        v_x_KLI_tail = -v_H_tail / N\n\n        # Calculate the KLI tail-coefficient estimator.\n        c_KLI = r_tail * v_x_KLI_tail\n\n        # Calculate the LDA exchange potential at r_tail.\n        n_at_tail = n_func(r_tail)\n        v_x_LDA_tail = -((3 / np.pi)**(1 / 3)) * (n_at_tail**(1 / 3))\n\n        # Calculate the LDA tail-coefficient estimator.\n        c_LDA = r_tail * v_x_LDA_tail\n\n        # Round the results to six decimal places as specified.\n        # We explicitly round the numbers first, then format them to ensure\n        # correct representation of trailing zeros.\n        c_KLI_rounded = round(c_KLI, 6)\n        c_LDA_rounded = round(c_LDA, 6)\n\n        results.append([c_KLI_rounded, c_LDA_rounded])\n\n    # Format the results into the required single-line string format.\n    # e.g., [[-1.000000,-0.000022],[-1.000000,-0.000011],...]\n    formatted_pairs = [f\"[{p[0]:.6f},{p[1]:.6f}]\" for p in results]\n    final_output = f\"[{','.join(formatted_pairs)}]\"\n\n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```", "id": "2901394"}]}