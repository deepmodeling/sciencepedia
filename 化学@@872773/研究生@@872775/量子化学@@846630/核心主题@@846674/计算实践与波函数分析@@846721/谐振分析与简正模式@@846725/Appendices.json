{"hands_on_practices": [{"introduction": "量子化学计算直接得到的是质量加权 Hessian 矩阵的本征值 $\\lambda_k$，它与简正模式的角频率 $\\omega_k$ 直接相关 ($\\lambda_k = \\omega_k^2$)。然而，实验光谱学通常使用波数 $\\tilde{\\nu}_k$ (单位为 $\\text{cm}^{-1}$) 来报告振动频率。本练习 [@problem_id:2894934] 旨在通过从基本定义出发，建立这些不同物理量之间的转换关系，这是正确解读和报告计算结果的基本功。", "problem": "在玻恩-奥本海默近似和简谐近似下，分子谐振动分析中，以质量加权简正坐标表示的势能是二次的，且简正模式是解耦的。由模式数 $k$ 索引的简正坐标的运动方程具有简谐振子的形式，其解与 $\\exp(\\pm i \\omega_{k} t)$ 成正比，其中 $\\omega_{k}$ 是模式 $k$ 的角频率。光谱学家使用三个可互换的描述符来报告振动数据：角频率 $\\omega_{k}$、普通（循环）频率 $\\nu_{k}$ 和波数 $\\tilde{\\nu}_{k}$，后者通常以反厘米为单位报告。仅从 (i) 角频率为弧度/秒，(ii) 普通频率为周/秒，(iii) 波数为单位长度内的周期数，以及 (iv) 波长 $\\lambda$ 的定义和通过国际单位制 (SI) 中的光速 $c$ 建立的频率与波长之间的关系这些基本定义出发，推导一个当 $\\tilde{\\nu}_{k}$ 以 $\\mathrm{cm}^{-1}$ 表示时，连接 $\\omega_{k}$、$\\nu_{k}$ 和 $\\tilde{\\nu}_{k}$ 的紧凑解析表达式。您的推导必须明确考虑 $2\\pi$ 因子、光速 $c$ 以及长度单位的转换，以使波数的单位为 $\\mathrm{cm}^{-1}$。在推导过程中请明确说明您采用的任何单位约定，并确保每一步的量纲一致性。\n\n将您的最终结果表示为一个直接关联 $\\omega_{k}$、$\\nu_{k}$ 和 $\\tilde{\\nu}_{k}$ 的单一闭式解析表达式，并假设 $c$ 以 $\\mathrm{cm}\\,\\mathrm{s}^{-1}$ 为单位表示，从而使 $\\tilde{\\nu}_{k}$ 的单位为 $\\mathrm{cm}^{-1}$。最终表达式中不要包含单位。最终答案必须是单一的解析表达式，而不是一个待解方程或不等式。", "solution": "问题陈述已提交验证。\n\n第1步：提取已知条件。\n已知条件如下：\n- 背景是分子的谐振动分析。\n- 质量加权简正坐标中的势能是二次的。\n- 简正模式是解耦的。\n- 简正坐标 $k$ 的解与 $\\exp(\\pm i \\omega_{k} t)$ 成正比。\n- $\\omega_{k}$ 是模式 $k$ 的角频率。\n- $\\nu_{k}$ 是模式 $k$ 的普通（循环）频率。\n- $\\tilde{\\nu}_{k}$ 是模式 $k$ 的波数，以 $\\mathrm{cm}^{-1}$ 为单位报告。\n- 定义 (i)：角频率是弧度/秒。\n- 定义 (ii)：普通频率是周/秒。\n- 定义 (iii)：波数是单位长度内的周期数。\n- 定义 (iv)：波长是 $\\lambda$，通过 $\\nu_k \\lambda_k = c$ 与频率相关，其中 $c$ 是光速。\n- 最终表达式必须连接 $\\omega_{k}$、$\\nu_{k}$ 和 $\\tilde{\\nu}_{k}$。\n- 最终表达式必须假设 $c$ 的单位为 $\\mathrm{cm}\\,\\mathrm{s}^{-1}$。\n\n第2步：使用提取的已知条件进行验证。\n根据所需标准对问题进行评估。\n- **科学上成立**：该问题完全基于物理学中基本且普遍接受的定义，特别是在光谱学和波动力学领域。所有前提在事实上都是正确的，并且是量子化学领域的标准。\n- **提法明确**：问题陈述清晰。它要求从一组给定的定义中推导一个特定的关系。输入是充分的，并且存在一个唯一的、稳定的关系。\n- **客观性**：语言技术性强、精确，不含任何主观或基于观点的内容。\n- **缺陷清单**：\n    1. 科学或事实上的不健全：无。\n    2. 不可形式化或不相关：该问题是可形式化的，并与指定主题直接相关。\n    3. 不完整或矛盾的设置：设置是完整的且内部一致。\n    4. 不现实或不可行：所有量和条件在物理上都是现实的。\n    5. 不良构或结构不良：该问题结构良好，并能导出一个唯一的结果。\n    6. 伪深刻、琐碎、同义反复：该问题是一个标准的、非平凡的推导，旨在测试对物理单位和定义的基本理解。\n    7. 超出科学可验证性：该推导可通过数学逻辑和物理原理进行验证。\n\n第3步：结论与行动。\n该问题是**有效的**。将构建一个解决方案。\n\n任务是推导角频率 $\\omega_k$、普通频率 $\\nu_k$ 和波数 $\\tilde{\\nu}_k$ 之间的关系。我们按照要求从第一性原理出发。\n\n1.  角频率 $\\omega_k$ 和普通频率 $\\nu_k$ 之间的关系。\n普通频率 $\\nu_k$ 定义为单位时间（通常是秒）内的周期数。其单位是赫兹 ($\\mathrm{Hz}$)，等同于 $\\mathrm{s}^{-1}$。\n角频率 $\\omega_k$ 定义为相角的变化率，以弧度/单位时间来衡量。其单位是 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$。\n一个完整的周期对应于 $2\\pi$ 弧度的角位移。因此，每秒经过的弧度数必须是每秒完成的周期数的 $2\\pi$ 倍。这建立了一个直接的正比关系：\n$$ \\omega_k = 2\\pi \\nu_k $$\n从量纲上看，这可以写成 $[\\mathrm{rad}\\,\\mathrm{s}^{-1}] = [\\mathrm{rad}/\\mathrm{cycle}] \\times [\\mathrm{cycle}\\,\\mathrm{s}^{-1}]$。在物理学中，弧度和周期被视为无量纲的，因此该方程与两个量都具有时间倒数 $T^{-1}$ 的基本单位是一致的。\n\n2.  普通频率 $\\nu_k$ 和波数 $\\tilde{\\nu}_k$ 之间的关系。\n问题给出了频率 $\\nu_k$、波长 $\\lambda_k$ 和光速 $c$ 之间的关系：\n$$ \\nu_k \\lambda_k = c $$\n波数 $\\tilde{\\nu}_k$ 定义为单位长度内的周期数。这是波长 $\\lambda_k$ 的倒数，而波长是每个周期的长度。\n$$ \\tilde{\\nu}_k = \\frac{1}{\\lambda_k} $$\n我们可以将 $\\lambda_k = 1/\\tilde{\\nu}_k$ 代入波动方程：\n$$ \\nu_k \\left(\\frac{1}{\\tilde{\\nu}_k}\\right) = c $$\n重新整理此式以解出 $\\nu_k$ 可得：\n$$ \\nu_k = c \\tilde{\\nu}_k $$\n我们现在必须在指定约束下验证量纲一致性。问题要求波数 $\\tilde{\\nu}_k$ 以反厘米为单位，即 $\\mathrm{cm}^{-1}$。普通频率 $\\nu_k$ 的国际单位制单位是反秒，即 $\\mathrm{s}^{-1}$。为了使方程 $\\nu_k = c \\tilde{\\nu}_k$ 在量纲上正确，光速 $c$ 的单位必须能够协调 $\\mathrm{s}^{-1}$ 和 $\\mathrm{cm}^{-1}$。\n让我们检查单位：\n$$ [\\mathrm{s}^{-1}] = [\\mathrm{units\\ of\\ } c] \\times [\\mathrm{cm}^{-1}] $$\n这要求 $c$ 的单位是 $\\mathrm{cm}\\,\\mathrm{s}^{-1}$。问题明确指示我们在最终结果中假设 $c$ 以这些单位表示。因此，在给定的单位约定下，关系式 $\\nu_k = c \\tilde{\\nu}_k$ 是正确的。\n\n3.  整合关系。\n我们已经推导出了两个关键方程：\n(i) $ \\omega_k = 2\\pi \\nu_k $\n(ii) $ \\nu_k = c \\tilde{\\nu}_k $\n我们可以将它们合并，形成一个连接所有三个量的单一、连续的关系。通过将表达式 (ii) 代入 (i)，我们得到 $\\omega_k$ 和 $\\tilde{\\nu}_k$ 之间的关系：\n$$ \\omega_k = 2\\pi (c \\tilde{\\nu}_k) = 2\\pi c \\tilde{\\nu}_k $$\n因此，连接这三个描述符的完整关系是以下等式链：\n$$ \\omega_k = 2\\pi \\nu_k = 2\\pi c \\tilde{\\nu}_k $$\n这个表达式是按照要求连接这三个量的紧凑解析结果。它完全从所提供的基本定义推导而来，并正确地考虑了指定的单位约定，其中 $\\omega_k$ 的单位是 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$，$\\nu_k$ 的单位是 $\\mathrm{s}^{-1}$，$\\tilde{\\nu}_k$ 的单位是 $\\mathrm{cm}^{-1}$，而 $c$ 的单位是 $\\mathrm{cm}\\,\\mathrm{s}^{-1}$。", "answer": "$$\n\\boxed{\\omega_{k} = 2\\pi \\nu_{k} = 2\\pi c \\tilde{\\nu}_{k}}\n$$", "id": "2894934"}, {"introduction": "谐振子近似是振动分析的基石，但它系统性地忽略了非谐效应，导致计算频率通常会系统性地高于实验测量的基频。为了弥合理论与实验之间的差距，研究人员常常采用频率标度因子进行经验校正。本练习 [@problem_id:2894984] 将指导您完成一个完整的计算化学实践工作流程：使用一组精确的实验数据，通过统计方法确定并验证一个特定理论方法的最佳标度因子。", "problem": "您需要设计并实现一个完全可复现的计算方案，该方案基于分子振动的简谐近似，以确定一个单一的乘法振动频率标度因子，用于指定的电子结构方法和基组组合，并使用一组实验基频作为参考。该方案必须从第一性原理开始：在简谐近似中，给定方法预测的简正模式频率是通过 Born–Oppenheimer 势能面的质量加权Hessian矩阵的本征值得到的。实验基频包含了非谐性以及其他系统性的方法/基组误差，这些通常可以被一个单一的乘法标度因子很好地捕捉。假设一个模型，其中每个实验基频 $y_i$（单位为 $\\mathrm{cm}^{-1}$）通过 $y_i \\approx s \\, x_i + \\varepsilon_i$ 与计算出的简谐频率 $x_i$（单位为 $\\mathrm{cm}^{-1}$）相关联，其中 $s$ 是待确定的（未知）标度因子，$\\varepsilon_i$ 集合了由非谐性、基组不完备性和测量噪声引起的残余偏差。为保证物理一致性，要求回归通过原点（无截距），因为一个消失的简谐频率必须映射到一个消失的基频。使用加权拟合以纳入已报告的实验不确定度。\n\n您的程序必须为下面的每个数据集执行以下步骤：\n\n1. 预处理：舍弃任何计算出的简谐频率 $x_i$ 严格小于数据集特定下限截止值 $f_{\\min}$（单位为 $\\mathrm{cm}^{-1}$）的模式，因为极低频的扭转和摆动通常无法用简谐模型很好地描述。所有输入和输出中的频率单位均为 $\\mathrm{cm}^{-1}$。\n\n2. 零截距加权拟合：确定值 $\\hat{s}$，使其最小化加权平方和 $\\sum_i w_i \\, (s \\, x_i - y_i)^2$，其中权重 $w_i = 1/u_i^2$，$u_i$ 是 $y_i$ 已报告的标准不确定度（单位为 $\\mathrm{cm}^{-1}$）。不包括截距项。\n\n3. 单遍稳健离群点剔除：计算残差 $r_i = \\hat{s} \\, x_i - y_i$ 和标准化残差 $t_i = \\sqrt{w_i} \\, r_i$。计算一个稳健的尺度 $\\sigma_{\\mathrm{rob}} = 1.4826 \\times \\mathrm{median}(|t_i - \\mathrm{median}(t_i)|)$。如果 $\\sigma_{\\mathrm{rob}} = 0$，则退而使用 $t_i$ 相对于零的均方根值。移除满足 $|t_i| > 3 \\, \\sigma_{\\mathrm{rob}}$ 的观测值。使用剩余的观测值和相同的加权、零截距准则重新拟合以获得最终的 $\\hat{s}$。\n\n4. 不确定度传播和误差度量：对于 $n$ 个保留的观测值和 $p = 1$ 个拟合参数，计算残差平方和 $\\mathrm{RSS} = \\sum_i w_i \\, r_i^2$、尺度估计 $\\hat{\\sigma}^2 = \\mathrm{RSS}/(n - p)$ 以及标度因子的标准不确定度 $u_s = \\sqrt{\\hat{\\sigma}^2 / \\sum_i w_i x_i^2}$。此外，计算标度化频率相对于实验值的未加权均方根误差 $\\mathrm{RMSE} = \\sqrt{\\frac{1}{n} \\sum_i r_i^2}$，单位为 $\\mathrm{cm}^{-1}$。\n\n5. 输出：对于每个数据集，输出一个列表 $[\\hat{s}, u_s, \\mathrm{RMSE}]$。您的程序必须生成单行输出，其中包含所有数据集的结果，格式为列表的列表 $[[\\hat{s}_1,u_{s,1},\\mathrm{RMSE}_1],[\\hat{s}_2,u_{s,2},\\mathrm{RMSE}_2],[\\hat{s}_3,u_{s,3},\\mathrm{RMSE}_3]]$，每个浮点值都四舍五入到六位小数。\n\n实现上述方案并将其应用于以下测试套件。每个数据集提供计算出的简谐频率 $x$、实验基频 $y$、实验标准不确定度 $u$ 和下限截止值 $f_{\\min}$ 的数组，单位均为 $\\mathrm{cm}^{-1}$。\n\n- 数据集 A（一般情况，包含多种中高频模式）：\n  - $x = [3880, 3650, 3100, 3050, 1710, 1650, 1500, 1100, 1000, 700]$\n  - $y = [3723.68, 3512.65, 2971.1, 2937.05, 1643.31, 1582.65, 1447.5, 1055.1, 962.0, 672.7]$\n  - $u = [2.0, 2.0, 2.0, 2.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]$\n  - $f_{\\min} = 100$\n\n- 数据集 B（边界情况，含有一个将被排除的极低频模式）：\n  - $x = [50, 180, 300, 500, 800, 1200, 2200, 3300]$\n  - $y = [47.9, 172.94, 286.4, 479.0, 767.0, 1149.0, 2108.0, 3162.0]$\n  - $u = [1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5]$\n  - $f_{\\min} = 100$\n\n- 数据集 C（边缘情况，含有一个因错误指认导致的严重离群点）：\n  - $x = [4000, 3900, 3600, 2000, 1500, 1400, 1200, 900, 600]$\n  - $y = [3860.0, 3766.5, 3470.0, 1932.0, 1600.0, 1352.0, 1160.0, 867.5, 579.0]$\n  - $u = [2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0]$\n  - $f_{\\min} = 100$\n\n您的程序必须实现上述完整方案，包括预处理、加权零截距拟合、单遍稳健离群点剔除、重新拟合、不确定度传播和误差度量计算。报告所有结果时单位均为 $\\mathrm{cm}^{-1}$，并将每个输出值四舍五入到六位小数。最终输出必须是单行文本，包含如上所述的列表的列表 $[[\\hat{s}_A,u_{s,A},\\mathrm{RMSE}_A],[\\hat{s}_B,u_{s,B},\\mathrm{RMSE}_B],[\\hat{s}_C,u_{s,C},\\mathrm{RMSE}_C]]$，不含任何额外文本。", "solution": "所提出的问题是计算化学中一个有效且明确定义的任务。它涉及将计算出的简谐振动频率与实验基频进行统计校准。该方案在科学上是合理的，采用了加权最小二乘回归、稳健离群点检测和不确定度分析等标准方法。我将继续提供一个完整的解决方案。\n\n问题的核心在于确定一个单一的乘法标度因子 $s$，该因子能将一组计算出的简谐频率 $\\{x_i\\}$ 最佳地映射到一组相应的实验基频 $\\{y_i\\}$。这样做的动机是，在简谐近似下的电子结构计算由于忽略了非谐性及其他方法特定的误差，会系统性地高估振动频率。一个单一的标度因子通常能提供一个实用且有效的修正。\n\n所提出的强制通过原点的线性模型是 $y_i = s x_i + \\varepsilon_i$。这个物理约束是恰当的：一个零频率模式（平动或转动）应对应于一个零实验频率。项 $\\varepsilon_i$ 代表残余误差。$s$ 的最优值，记为 $\\hat{s}$，是通过最小化加权残差平方和 $\\chi^2(s) = \\sum_i w_i (y_i - s x_i)^2$ 来找到的。权重 $w_i = 1/u_i^2$ 源自实验不确定度 $u_i$，给予更精确的测量更大的影响。\n\n该方案通过以下严谨的步骤进行：\n\n1.  **预处理**：简谐近似对于像扭转这样的极低频、大振幅运动效果不佳是众所周知的。因此，作为第一步，任何计算出的简谐频率 $x_i$ 小于指定截止值 $f_{\\min}$ 的数据点 $(x_i, y_i, u_i)$ 都会从数据集中移除。所有后续计算都在这个经过筛选的数据集上进行。\n\n2.  **初始加权最小二乘拟合**：为了找到最小化 $\\chi^2(s)$ 的 $s$ 值，我们通过将其关于 $s$ 的导数设为零来求解驻点：\n    $$\n    \\frac{d\\chi^2}{ds} = \\frac{d}{ds} \\sum_i w_i (y_i - s x_i)^2 = \\sum_i 2 w_i (y_i - s x_i)(-x_i) = 0\n    $$\n    这可以简化为：\n    $$\n    \\sum_i w_i y_i x_i - s \\sum_i w_i x_i^2 = 0\n    $$\n    求解 $s$ 得到估计量 $\\hat{s}$：\n    $$\n    \\hat{s} = \\frac{\\sum_i w_i x_i y_i}{\\sum_i w_i x_i^2}\n    $$\n    该公式用于获得标度因子的初始估计。\n\n3.  **单遍稳健离群点剔除**：实验数据可能包含严重错误，例如谱线的错误指认。需要一个稳健的统计程序来识别和移除这类离群点。\n    - 首先，计算初始拟合的残差：$r_i = \\hat{s} x_i - y_i$。\n    - 然后使用实验不确定度（即 $y_i$ 值的标准差）将它们标准化：$t_i = r_i / u_i = \\sqrt{w_i} r_i$。\n    - 使用中位数绝对偏差 (MAD) 计算这些标准化残差分布的一个稳健度量：$\\sigma_{\\mathrm{rob}} = 1.4826 \\times \\mathrm{median}(|t_i - \\mathrm{median}(t_i)|)$。因子 $1.4826$ 是 $1/\\Phi^{-1}(0.75)$ 的近似值，其中 $\\Phi^{-1}$ 是标准正态分布的分位数函数；这种缩放使 $\\sigma_{\\mathrm{rob}}$ 成为正态分布数据的标准差的一致估计量。\n    - 在 $\\sigma_{\\mathrm{rob}}$ 变为零的情况下（这可能发生在小数据集或高度一致的数据中），采用一个备用方案：将稳健尺度设置为标准化残差相对于零的均方根，$\\sigma_{\\mathrm{rob}} = \\sqrt{\\frac{1}{n} \\sum_i t_i^2}$。\n    - 任何绝对标准化残差 $|t_i|$ 超过该稳健尺度3倍的观测值，即 $|t_i| > 3 \\sigma_{\\mathrm{rob}}$，被标记为离群点并从数据集中移除。\n\n4.  **最终拟合与不确定度计算**：移除离群点后，使用相同的加权最小二乘公式对剩余的 $n$ 个数据点重新计算标度因子 $\\hat{s}$。将这个最终值作为报告的 $\\hat{s}$。\n    - 这个最终 $\\hat{s}$ 的不确定度被确定。在通过原点的加权线性回归中，斜率的方差由 $\\mathrm{Var}(\\hat{s}) = \\hat{\\sigma}^2 / (\\sum_i w_i x_i^2)$ 给出，其中求和是对 $n$ 个保留点进行的。\n    - 项 $\\hat{\\sigma}^2$ 是单位权重观测值的估计方差，通常称为约化卡方。它是根据最终拟合的残差平方和 (RSS) 计算的：$\\hat{\\sigma}^2 = \\mathrm{RSS} / (n-p)$，其中 $\\mathrm{RSS} = \\sum_i w_i r_i^2$（使用最终残差 $r_i = \\hat{s} x_i - y_i$），$p=1$ 是拟合参数的数量。\n    - 因此，标度因子的标准不确定度为：\n    $$\n    u_s = \\sqrt{\\mathrm{Var}(\\hat{s})} = \\sqrt{\\frac{\\mathrm{RSS}}{(n-1) \\sum_i w_i x_i^2}}\n    $$\n    - 最后，计算未加权均方根误差 (RMSE)，以提供原始单位 $\\mathrm{cm}^{-1}$ 下典型预测误差的度量：\n    $$\n    \\mathrm{RMSE} = \\sqrt{\\frac{1}{n} \\sum_i (\\hat{s} x_i - y_i)^2} = \\sqrt{\\frac{1}{n} \\sum_i r_i^2}\n    $$\n这个完整的方案不仅提供了最优的标度因子，还对其不确定度和拟合的整体优度进行了统计上严谨的量化。实现将为每个提供的数据集精确地遵循这些步骤。\n```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_scaling_factor(x, y, u, f_min):\n    \"\"\"\n    Implements the full protocol for a single dataset.\n    \"\"\"\n    # Step 1: Preprocessing\n    mask = x >= f_min\n    x_proc = x[mask]\n    y_proc = y[mask]\n    u_proc = u[mask]\n\n    def _weighted_fit_zero_intercept(x_fit, y_fit, u_fit):\n        w = 1.0 / u_fit**2\n        numerator = np.sum(w * x_fit * y_fit)\n        denominator = np.sum(w * x_fit**2)\n        return numerator / denominator if denominator != 0 else 0.0\n\n    # Step 2: Initial weighted fit\n    s_initial = _weighted_fit_zero_intercept(x_proc, y_proc, u_proc)\n\n    # Step 3: One-pass robust outlier rejection\n    r = s_initial * x_proc - y_proc\n    t = r / u_proc\n    \n    median_t = np.median(t)\n    mad_t = np.median(np.abs(t - median_t))\n    sigma_rob = 1.4826 * mad_t\n    \n    if sigma_rob == 0:\n        sigma_rob = np.sqrt(np.mean(t**2)) if len(t) > 0 else 0\n        \n    outlier_mask = np.abs(t) = 3 * sigma_rob\n    \n    x_final = x_proc[outlier_mask]\n    y_final = y_proc[outlier_mask]\n    u_final = u_proc[outlier_mask]\n    \n    # Step 4: Refit and compute metrics\n    s_final = _weighted_fit_zero_intercept(x_final, y_final, u_final)\n    \n    n = len(x_final)\n    p = 1\n    \n    if n = p:\n         return [s_final, 0.0, 0.0]\n\n    r_final = s_final * x_final - y_final\n    w_final = 1.0 / u_final**2\n    \n    rss = np.sum(w_final * r_final**2)\n    sigma2_hat = rss / (n - p)\n    \n    sum_wx2 = np.sum(w_final * x_final**2)\n    u_s = np.sqrt(sigma2_hat / sum_wx2) if sum_wx2 > 0 else 0.0\n    \n    rmse = np.sqrt(np.mean(r_final**2))\n    \n    return [s_final, u_s, rmse]\n\ndef solve_and_format():\n    test_cases = [\n        # Dataset A\n        {\"x\": np.array([3880, 3650, 3100, 3050, 1710, 1650, 1500, 1100, 1000, 700]),\n         \"y\": np.array([3723.68, 3512.65, 2971.1, 2937.05, 1643.31, 1582.65, 1447.5, 1055.1, 962.0, 672.7]),\n         \"u\": np.array([2.0, 2.0, 2.0, 2.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]),\n         \"f_min\": 100},\n        # Dataset B\n        {\"x\": np.array([50, 180, 300, 500, 800, 1200, 2200, 3300]),\n         \"y\": np.array([47.9, 172.94, 286.4, 479.0, 767.0, 1149.0, 2108.0, 3162.0]),\n         \"u\": np.array([1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5]),\n         \"f_min\": 100},\n        # Dataset C\n        {\"x\": np.array([4000, 3900, 3600, 2000, 1500, 1400, 1200, 900, 600]),\n         \"y\": np.array([3860.0, 3766.5, 3470.0, 1932.0, 1600.0, 1352.0, 1160.0, 867.5, 579.0]),\n         \"u\": np.array([2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0]),\n         \"f_min\": 100}\n    ]\n    all_results = [calculate_scaling_factor(**case) for case in test_cases]\n    return all_results\n```", "answer": "[[0.960237,0.000676,21.050302],[0.958372,0.000392,1.259972],[0.964999,0.000407,4.416805]]", "id": "2894984"}, {"introduction": "在实践中，几何优化和频率计算并非总能一帆风顺，我们常常会遇到一些小的虚频或不应存在的低频振动模式，它们往往是数值计算误差的“假象”，而非分子的真实物理特性。准确地诊断这些数值噪音的来源，并采取有效措施予以消除，是每一位计算化学家必须掌握的关键技能。本练习 [@problem_id:2895011] 模拟了一个典型的故障排查场景，旨在锻炼您识别和解决这类实际计算问题的能力。", "problem": "一个具有 $N=8$ 个原子的非线性分子，使用密度泛函理论 (DFT) 和中等基组及默认数值设置进行了优化。当能量变化阈值为 $10^{-6}\\ E_{\\mathrm{h}}$、最大笛卡尔力阈值为 $3\\times 10^{-4}\\ E_{\\mathrm{h}}/a_{0}$、均方根 (RMS) 力为 $6\\times 10^{-5}\\ E_{\\mathrm{h}}/a_{0}$ 时，几何优化被宣告收敛。自洽场 (SCF) 过程采用迭代子空间直接求逆 (DIIS) 加速器，并在密度变化低于 $10^{-6}$ 时终止，尽管某些优化步骤达到了 DIIS 迭代次数上限，此时能量变化接近 $10^{-7}\\ E_{\\mathrm{h}}$。DFT 求积格点设置为粗糙的默认值。随后的谐振分析产生了一个虚频 $\\tilde{\\nu}_{1} = i\\,18\\ \\mathrm{cm}^{-1}$，两个非常低的正频率 $9\\ \\mathrm{cm}^{-1}$ 和 $12\\ \\mathrm{cm}^{-1}$，其余所有频率均高于 $200\\ \\mathrm{cm}^{-1}$。程序报告的六个最低频运动（名义上的平动/转动）为 $7, 5, 3, 2, 1,$ 和 $0\\ \\mathrm{cm}^{-1}$。与虚频模式对应的动画位移在视觉上表现为轻微的整体漂移和小振幅扭转的组合。\n\n假设势能面是光滑的，且优化后的几何构型应对应于一个真正的极小值点。仅根据谐振分析和简正模式的第一性原理，判断下列哪些操作是确定低频特征是否为伪数值假象（例如，来自不完全的 SCF 收敛或数值噪音）以及在它们不具物理意义时消除它们的最合适的诊断和补救措施。选择所有适用的选项。\n\nA. 使用明显更严格的阈值（例如，能量变化 $10^{-10}\\ E_{\\mathrm{h}}$，最大力 $10^{-5}\\ E_{\\mathrm{h}}/a_{0}$）重新优化几何构型，强制执行更严格的 SCF 密度收敛（例如，$10^{-10}$）且不允许因达到迭代次数上限而终止，增加 DFT 积分格点和积分精度，然后使用 Eckart 条件重新计算一个显式投影掉整体平动/转动的解析 Hessian 矩阵。在精炼后的稳定点上重新评估振动谱。\n\nB. 施加精确的点群对称性约束，并通过完整约束冻结整体的转动/平动，同时保持原始的 SCF 和数值阈值不变，依赖对称性强制来消除数值假象而无需进一步加严。\n\nC. 在不改变收敛或数值设置的情况下，将解析 Hessian 矩阵替换为笛卡尔坐标下的有限差分 Hessian 矩阵，使用更大的位移步长来抑制噪音，并接受由此得到的频率在构造上更可靠。\n\nD. 沿着虚频模式的本征矢量，通过以几个小步长（例如，在无量纲的质量加权简正坐标中为 $\\pm 0.05$）位移几何构型来构建一维势能扫描，并在每个位移后的几何构型上将 SCF 和力收敛到非常严格的阈值。如果能量剖面在稳定点附近是局部凸的且在数值噪音范围内是平坦的，则将原始虚频归因于数值假象；如果获得鞍点状的剖面，则认为该模式是物理的。\n\n只有以上信息可用；除分子的非线性外，不要假定任何特殊性质。选择最佳的行动方案组合。", "solution": "该问题陈述已经过验证，被认为是有效的。它呈现了计算量子化学中一个真实而常见的场景，为回答所提出的问题提供了充分且一致的信息。该场景具有科学依据，问题提出得当且客观。我们可以开始分析。\n\n谐振分析的基础在于对势能面 (PES) $V(\\mathbf{q})$ 上的一个稳定点进行表征，在该点上梯度（力）为零：$\\nabla V = \\mathbf{0}$。该点的性质——极小值点、过渡态或高阶鞍点——由质量加权 Hessian 矩阵的本征值决定，该矩阵包含能量相对于原子坐标的二阶导数。对于一个真正的极小值点，质量加权 Hessian 矩阵的所有 $3N$ 个本征值必须为非负。对于一个具有 $N$ 个原子的非线性分子，这对应于 $3N-6$ 个正的振动频率和与整体平动和转动相关的 $6$ 个零频率。单个负本征值表现为单个虚频（$\\tilde{\\nu} \\propto \\sqrt{-\\lambda}$），表示这是一个一阶鞍点或过渡态。\n\n所提供的数据描述了一个对 $N=8$ 个原子的非线性分子的计算。一个真正的极小值点应表现出 $3(8)-6 = 18$ 个正的振动频率和 $6$ 个零频率。呈现的结果是：\n1.  一个小的虚频：$\\tilde{\\nu}_{1} = i\\,18\\ \\mathrm{cm}^{-1}$。\n2.  两个非常低的正频率：$9\\ \\mathrm{cm}^{-1}$ 和 $12\\ \\mathrm{cm}^{-1}$。\n3.  6 个平动和转动 (T/R) 模式的非零频率：$7, 5, 3, 2, 1,$ 和 $0\\ \\mathrm{cm}^{-1}$。\n4.  几何优化在相对宽松的收敛标准（例如，最大力为 $3\\times 10^{-4}\\ E_{\\mathrm{h}}/a_{0}$）下终止。\n5.  底层的电子结构计算不严格：自洽场 (SCF) 收敛宽松（密度为 $10^{-6}$），有时不完全（达到迭代次数上限），并且使用了粗糙的 DFT 积分格点。\n\n这些症状的组合极大地指向了数值假象。几何构型没有完全收敛到一个真正的稳定点（梯度并非真正的零），并且 Hessian 矩阵被来自粗糙格点和收敛不充分的 SCF 的数值噪音所污染。一个小的虚频，通常在视觉上表现为低能内运动与整体平动或转动的混合，是这些数值问题的经典标志。非零的 T/R 模式频率是充满噪音的 Hessian 矩阵和不完全收敛的直接后果，这妨碍了将这些模式清晰地投影到零。任务是识别正确的诊断和补救措施。\n\n现在，我们评估每个选项。\n\n**A. 使用明显更严格的阈值（例如，能量变化 $10^{-10}\\ E_{\\mathrm{h}}$，最大力 $10^{-5}\\ E_{\\mathrm{h}}/a_{0}$）重新优化几何构型，强制执行更严格的 SCF 密度收敛（例如，$10^{-10}$）且不允许因达到迭代次数上限而终止，增加 DFT 积分格点和积分精度，然后使用 Eckart 条件重新计算一个显式投影掉整体平动/转动的解析 Hessian 矩阵。在精炼后的稳定点上重新评估振动谱。**\n\n该选项提出了一个系统而全面的解决方案，解决了每个已识别的误差来源：\n-   **更严格的优化阈值：** 强制执行例如 $10^{-5}\\ E_{\\mathrm{h}}/a_{0}$ 的最大力，确保几何构型更接近一个梯度有效为零的真正稳定点。\n-   **更严格的 SCF 收敛和更高的格点质量：** 提高 SCF 收敛标准（例如，密度达到 $10^{-10}$）并使用更精细的积分格点（和更严格的积分截断），对于获得准确的能量以及更重要的准确的解析导数（力和 Hessian 矩阵）至关重要。这直接减少了困扰当前 Hessian 矩阵的数值噪音。\n-   **带有 Eckart 投影的解析 Hessian 矩阵：** 在这个新的、高质量的稳定点上计算解析 Hessian 矩阵，提供了可能的最准确的二阶导数。随后使用 Eckart 条件进行投影是形式上正确的过程，用以将内振动模式与整体平动和转动分离开，这应导致六个频率在数值上为零。\n\n这一行动方案代表了获得可靠谐振频率的黄金标准。它既是对所观察到问题的补救措施，也是一种诊断确认，如果新的频率都是实数且为正的话。\n\n结论：**正确**。\n\n**B. 施加精确的点群对称性约束，并通过完整约束冻结整体的转动/平动，同时保持原始的 SCF 和数值阈值不变，依赖对称性强制来消除数值假象而无需进一步加严。**\n\n这种方法在根本上是有缺陷的。虽然施加对称性（如果分子拥有对称性）可以是一种好的做法，但它无法弥补数值精度的不足。主要问题是宽松的收敛标准和粗糙的格点，这导致了对势能面本身的不准确表示。在这些不良设置下计算 Hessian 矩阵，无论是否应用对称性约束，都将产生充满噪音、不可靠的结果。冻结平动和转动是一种粗糙的方法，不能保证已找到真正的稳定点。此选项未能解决问题的根本原因。\n\n结论：**不正确**。\n\n**C. 在不改变收敛或数值设置的情况下，将解析 Hessian 矩阵替换为笛卡尔坐标下的有限差分 Hessian 矩阵，使用更大的位移步长来抑制噪音，并接受由此得到的频率在构造上更可靠。**\n\n这是一种误导性的方法。有限差分 Hessian 矩阵是通过对梯度进行微分计算的，因此它仍然依赖于底层力计算的质量，而在这个案例中力的计算质量很差（“垃圾进，垃圾出”）。更关键的是，对于*谐振*分析，使用“更大的位移步长”在理论上是不正确的。根据定义，谐振近似仅在无穷小位移的极限下有效。更大的步长会有意地将非谐性效应引入 Hessian 矩阵，这是用系统误差来换取数值噪音。这不会得到一个更“可靠”的谐振频率，而是一个不同的、不正确的数值。\n\n结论：**不正确**。\n\n**D. 沿着虚频模式的本征矢量，通过以几个小步长（例如，在无量纲的质量加权简正坐标中为 $\\pm 0.05$）位移几何构型来构建一维势能扫描，并在每个位移后的几何构型上将 SCF 和力收敛到非常严格的阈值。如果能量剖面在稳定点附近是局部凸的且在数值噪音范围内是平坦的，则将原始虚频归因于数值假象；如果获得鞍点状的剖面，则认为该模式是物理的。**\n\n该选项描述了一个标准且强大的*诊断*程序。通过沿着有问题的坐标绘制势能面，可以直接观察其真实性质。对扫描上的每个点使用严格的收敛标准对其有效性至关重要。如果得到的能量剖面基本平坦（$k \\approx 0$）或显示真正的极小值点与起始点有轻微位移（凸形剖面，$k  0$），这就提供了确凿的证据，表明虚频（$k  0$）是一个数值假象。这直接回答了问题中要求提供一种方法“来确定低频特征是否是伪的”的部分。虽然它本身并不能解决所有 18 个振动模式的问题，但在着手进行选项 A 中概述的计算成本更高的全面补救措施之前，这是确定性地诊断问题的关键且非常合适的步骤。\n\n结论：**正确**。\n\n选项 A 和 D 都是非常合适的措施。选项 D 是一个绝佳的诊断步骤，用以确认虚频的性质。选项 A 是获得正确且具有物理意义的所有模式的振动谱的全面补救程序。问题要求选择“诊断和补救措施”，并“选择所有适用的选项”。D 是诊断，A 是补救。因此，两者都是正确的。", "answer": "$$\\boxed{AD}$$", "id": "2895011"}]}