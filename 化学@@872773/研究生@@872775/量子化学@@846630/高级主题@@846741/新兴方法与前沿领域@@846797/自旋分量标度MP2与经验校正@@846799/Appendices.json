{"hands_on_practices": [{"introduction": "非限制性Møller-Plesset二阶微扰理论（UMP2）在处理具有显著自旋污染的体系时，常常会过高估计自旋相同电子对的相关能。自旋标度校正MP2（SCS-MP2）通过引入经验标度因子来修正这一缺陷。这项实践通过一个简化的数值实验，清晰地展示了UMP2的这一问题以及SCS-MP2是如何通过降低自旋相同（same-spin）组分的权重来有效改善计算结果的 [@problem_id:2926383]。", "problem": "构建一个最小的、自洽的数值实验，以说明当参考行列式破坏自旋对称性时，非限制性二阶 Møller–Plesset 微扰理论 (UMP2) 如何可能高估同自旋关联，以及自旋分量标度 Møller–Plesset 微扰理论 (SCS-MP2) 如何减少由此产生的误差。您的程序必须从第一性原理出发实现以下内容。\n\n从 Rayleigh–Schrödinger 微扰理论的二阶关联能开始。在自旋轨道基中，二阶关联能是参考行列式所有双重激发项的总和，每一项都是耦合矩阵元的平方除以激发能量差。在一个适合编程的数据驱动抽象中，我们将其建模为两个不相交的贡献集合：\n- 一个同自旋集合，其中两个激发电子具有相同的自旋，以及\n- 一个异自旋集合，其中激发电子具有相反的自旋。\n\n对于每个激发类别，您将获得：\n- 一个正的激发能量差列表，记为 $\\Delta_k$，以及\n- 一个非负的耦合权重平方列表，记为 $w_k = \\lvert \\langle \\Phi_k \\lvert \\hat{V} \\rvert \\Phi_0 \\rangle \\rvert^2$。\n\n使用二阶微扰能的定义，并将 $\\Delta_k$ 作为正的激发能隙，来自类别 $\\mathcal{C}$ 的关联能贡献为\n$$\nE_{\\mathcal{C}} = - \\sum_{k \\in \\mathcal{C}} \\frac{w_k}{\\Delta_k}.\n$$\n因此，非限制性二阶关联能为 $E_{\\text{UMP2}} = E_{\\text{os}} + E_{\\text{ss}}$，其中 $E_{\\text{os}}$ 和 $E_{\\text{ss}}$ 分别表示异自旋和同自旋的总和。\n\n自旋分量标度 Møller–Plesset 微扰理论 (SCS-MP2) 用自旋分辨分量的线性组合取代了未标度的总和，\n$$\nE_{\\text{SCS}} = c_{\\text{os}} \\, E_{\\text{os}} + c_{\\text{ss}} \\, E_{\\text{ss}},\n$$\n其中 $c_{\\text{os}}$ 和 $c_{\\text{ss}}$ 是固定的经验系数。使用标准值 $c_{\\text{os}} = 1.20$ 和 $c_{\\text{ss}} = 0.33$。\n\n为您提供一个包含三种情况的测试套件。每种情况都指定了：\n- 异自旋的权重 $w_k$ 和分母 $\\Delta_k$ 列表，\n- 同自旋的权重 $w_k$ 和分母 $\\Delta_k$ 列表，以及\n- 一个代表高水平基准（例如，最小空间中的完全组态相互作用）的参考关联能 $E_{\\text{ref}}$。\n\n所有能量都以哈特里（hartree）为单位计算和报告。您的程序必须为每种情况计算：\n- 非限制性二阶关联能 $E_{\\text{UMP2}}$，\n- 自旋分量标度的关联能 $E_{\\text{SCS}}$，\n- UMP2 的绝对误差，$\\lvert E_{\\text{UMP2}} - E_{\\text{ref}} \\rvert$，\n- SCS-MP2 的绝对误差，$\\lvert E_{\\text{SCS}} - E_{\\text{ref}} \\rvert$，以及\n- 一个布尔标志，指示与 UMP2 相比，SCS-MP2 是否严格减小了绝对误差。\n\n测试套件（除特别注明外，所示数字均为无量纲；所有能量均以哈特里为单位报告）：\n- 情况 A（表现良好，类近平衡态）：\n  - 异自旋：权重 $[0.010, 0.006]$，分母 $[0.50, 0.60]$。\n  - 同自旋：权重 $[0.0005]$，分母 $[0.55]$。\n  - 参考关联能 $E_{\\text{ref}} = -0.0315$ 哈特里。\n- 情况 B（自旋破缺，伴有膨胀的同自旋振幅）：\n  - 异自旋：权重 $[0.018, 0.014]$，分母 $[0.30, 0.35]$。\n  - 同自旋：权重 $[0.012, 0.010]$，分母 $[0.32, 0.36]$。\n  - 参考关联能 $E_{\\text{ref}} = -0.1100$ 哈特里。\n- 情况 C（边缘情况，同自旋通道存在近简并）：\n  - 异自旋：权重 $[0.010, 0.008]$，分母 $[0.25, 0.30]$。\n  - 同自旋：权重 $[0.0020, 0.0015]$，分母 $[0.050, 0.060]$。\n  - 参考关联能 $E_{\\text{ref}} = -0.0850$ 哈特里。\n\n角度单位不适用。不使用百分比。\n\n您的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个情况贡献一个形式为 $[e_u, e_s, b]$ 的子列表，其中 $e_u$ 等于四舍五入到六位小数的 UMP2 绝对误差，$e_s$ 等于四舍五入到六位小数的 SCS-MP2 绝对误差，当且仅当 SCS-MP2 严格减小了绝对误差时，$b$ 等于布尔值 true。例如，整体格式必须是\n$[[e_{u,A}, e_{s,A}, b_A],[e_{u,B}, e_{s,B}, b_B],[e_{u,C}, e_{s,C}, b_C]]$,\n打印在单行上，无额外文本。", "solution": "所述问题是有效的。它在科学上基于量子力学微扰理论的原理，特别是二阶 Møller–Plesset 理论 (MP2) 及其经验变体，如自旋分量标度 MP2 (SCS-MP2)。该问题提法明确，为获得唯一的数值解提供了完整且一致的定义、公式和数据集合。它避免了主观性和模糊性。我们将着手进行求解。\n\n此问题的核心是根据提供的权重和能量分母，计算并比较非限制性 MP2 (UMP2) 和自旋分量标度 MP2 (SCS-MP2) 的相关能及其与参考值的误差。\n\n根据问题中给出的二阶微扰理论表达式，来自特定激发类别 $\\mathcal{C}$（此处为相反自旋 os 或相同自旋 ss）的关联能贡献为：\n$$\nE_{\\mathcal{C}} = - \\sum_{k \\in \\mathcal{C}} \\frac{w_k}{\\Delta_k}\n$$\n其中 $w_k$ 是耦合权重平方，$\\Delta_k$ 是激发能量差。\n\nUMP2 的总关联能是这两个分量的直接加和：\n$$\nE_{\\text{UMP2}} = E_{\\text{os}} + E_{\\text{ss}}\n$$\n而 SCS-MP2 的关联能则通过引入经验参数 $c_{\\text{os}}$ 和 $c_{\\text{ss}}$ 对各分量进行线性组合：\n$$\nE_{\\text{SCS}} = c_{\\text{os}} E_{\\text{os}} + c_{\\text{ss}} E_{\\text{ss}}\n$$\n我们将使用标准参数 $c_{\\text{os}} = 1.20$ 和 $c_{\\text{ss}} = 0.33$。\n\n对于测试套件中的每一种情况，我们首先分别计算 $E_{\\text{os}}$ 和 $E_{\\text{ss}}$。然后，我们利用上述公式计算 $E_{\\text{UMP2}}$ 和 $E_{\\text{SCS}}$。最后，计算这两种方法相对于参考能量 $E_{\\text{ref}}$ 的绝对误差：\n$$\n\\text{Error}_{\\text{UMP2}} = \\lvert E_{\\text{UMP2}} - E_{\\text{ref}} \\rvert\n$$\n$$\n\\text{Error}_{\\text{SCS}} = \\lvert E_{\\text{SCS}} - E_{\\text{ref}} \\rvert\n$$\n并判断 SCS-MP2 是否严格减小了误差。提供的 Python 代码实现了这一完整计算流程，并根据问题要求的格式输出最终结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy is not needed for this problem.\n\ndef solve():\n    \"\"\"\n    Solves the computational chemistry problem comparing UMP2 and SCS-MP2.\n    \"\"\"\n    \n    # Define the scaling coefficients for SCS-MP2.\n    c_os = 1.20\n    c_ss = 0.33\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"os_weights\": [0.010, 0.006],\n            \"os_denominators\": [0.50, 0.60],\n            \"ss_weights\": [0.0005],\n            \"ss_denominators\": [0.55],\n            \"e_ref\": -0.0315\n        },\n        {\n            \"name\": \"Case B\",\n            \"os_weights\": [0.018, 0.014],\n            \"os_denominators\": [0.30, 0.35],\n            \"ss_weights\": [0.012, 0.010],\n            \"ss_denominators\": [0.32, 0.36],\n            \"e_ref\": -0.1100\n        },\n        {\n            \"name\": \"Case C\",\n            \"os_weights\": [0.010, 0.008],\n            \"os_denominators\": [0.25, 0.30],\n            \"ss_weights\": [0.0020, 0.0015],\n            \"ss_denominators\": [0.050, 0.060],\n            \"e_ref\": -0.0850\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # Convert lists to numpy arrays for vectorized operations.\n        os_weights = np.array(case[\"os_weights\"])\n        os_denominators = np.array(case[\"os_denominators\"])\n        ss_weights = np.array(case[\"ss_weights\"])\n        ss_denominators = np.array(case[\"ss_denominators\"])\n        e_ref = case[\"e_ref\"]\n\n        # Calculate the opposite-spin and same-spin correlation energy components.\n        # E_C = - sum(w_k / Delta_k)\n        e_os = -np.sum(os_weights / os_denominators)\n        e_ss = -np.sum(ss_weights / ss_denominators)\n        \n        # Calculate the UMP2 correlation energy.\n        # E_UMP2 = E_os + E_ss\n        e_ump2 = e_os + e_ss\n        \n        # Calculate the SCS-MP2 correlation energy.\n        # E_SCS = c_os * E_os + c_ss * E_ss\n        e_scs = c_os * e_os + c_ss * e_ss\n        \n        # Calculate the absolute errors with respect to the reference energy.\n        error_ump2 = abs(e_ump2 - e_ref)\n        error_scs = abs(e_scs - e_ref)\n        \n        # Determine if SCS-MP2 strictly reduces the error.\n        is_scs_better = error_scs  error_ump2\n        \n        # Format the results for this case.\n        # Errors are rounded to six decimal places.\n        # Boolean is converted to lowercase string 'true' or 'false'.\n        case_result = [\n            round(error_ump2, 6),\n            round(error_scs, 6),\n            is_scs_better\n        ]\n        results.append(case_result)\n\n    # Format the final output string as specified in the problem.\n    # e.g., [[e_u,A, e_s,A, b_A],[e_u,B, e_s,B, b_B],...]\n    # The string representation of a list of lists in Python is very close to the target.\n    # The only change needed is converting boolean 'True'/'False' to 'true'/'false'.\n    result_strings = []\n    for res in results:\n        # res[0] is e_u, res[1] is e_s, res[2] is boolean b\n        result_strings.append(f\"[{res[0]}, {res[1]}, {str(res[2]).lower()}]\")\n\n    # Join the sublist strings with a comma and enclose in brackets.\n    final_output = f\"[{','.join(result_strings)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```", "id": "2926383"}, {"introduction": "尽管SCS-MP2在处理动态相关方面相较于UMP2有显著改进，但它并非万能。该方法继承了其所基于的单参考哈特里-福克（Hartree-Fock）方法的根本局限性，即无法准确描述强静态相关体系。本练习以一个典型的双自由基模型为例，揭示了当参考波函数本身存在严重缺陷时，SCS-MP2为何同样会失效，从而强调了在使用经验校正方法时理解其适用范围的重要性 [@problem_id:2926385]。", "problem": "一个最小双自由基可按如下方式建模。考虑一个破缺对称性开壳层单重态双自由基的非限制性Hartree–Fock (UHF) 参考态，该双自由基有一个双占据的“芯”空间轨道和两个近简并的前线空间轨道，每个前线轨道主要被一个相反自旋的电子单占据。假设在基于此UHF参考态构建的二阶Rayleigh–Schrödinger微扰理论（Møller–Plesset二阶(MP2)），即非限制性MP2 (UMP2)中，相关能主要由两个双激发通道贡献：一个相反自旋通道和一个相同自旋通道。相反自旋通道的反对称化耦合矩阵元大小为 $G_{\\mathrm{os}}$，轨道能分母为 $\\Delta_{\\mathrm{os}}$；相同自旋通道的反对称化耦合矩阵元大小为 $K_{\\mathrm{ss}}$，轨道能分母为 $\\Delta_{\\mathrm{ss}}$。使用以下数据定义该模型：\n- $G_{\\mathrm{os}} = 0.346410$ Hartree,\n- $\\Delta_{\\mathrm{os}} = 1.00$ Hartree,\n- $K_{\\mathrm{ss}} = 0.600000$ Hartree,\n- $\\Delta_{\\mathrm{ss}} = 0.90$ Hartree。\n  \n使用以UHF为参考态的Rayleigh–Schrödinger微扰理论，从第一性原理出发，推导单个双激发通道 $K$ 对二阶相关能的贡献表达式（用其耦合矩阵元和能量分母表示），并用它求出该模型的相反自旋和相同自旋分量 $E_{\\mathrm{os}}^{\\mathrm{UMP2}}$ 和 $E_{\\mathrm{ss}}^{\\mathrm{UMP2}}$。然后，应用标度系数为 $c_{\\mathrm{os}} = \\frac{6}{5}$ 和 $c_{\\mathrm{ss}} = \\frac{1}{3}$ 的正则自旋组分标度经验校正（自旋组分标度(SCS) MP2），以获得SCS-MP2相关能\n$$\nE_{\\mathrm{corr}}^{\\mathrm{SCS}} = c_{\\mathrm{os}} E_{\\mathrm{os}}^{\\mathrm{UMP2}} + c_{\\mathrm{ss}} E_{\\mathrm{ss}}^{\\mathrm{UMP2}}。\n$$\n对于此双自由基，相对于同一UHF参考态的高水平完全组态相互作用(FCI)计算，得到精确的剩余相关能（UHF之上的相关能）为 $E_{\\mathrm{corr}}^{\\mathrm{exact}} = -0.0280$ Hartree。\n\n计算SCS-MP2相对于精确相关能的带符号残余误差，\n$$\n\\delta E = E_{\\mathrm{corr}}^{\\mathrm{SCS}} - E_{\\mathrm{corr}}^{\\mathrm{exact}},\n$$\n并报告最终值，四舍五入到 $4$ 位有效数字。最终能量以Hartree为单位表示。你的最终答案必须是一个实数。", "solution": "问题陈述已经过严格评估，并被确定为有效。它在科学上基于量子化学原理，特别是Møller–Plesset微扰理论及其经验校正。该问题提法恰当、客观，并为得出唯一解提供了所有必要数据。我们将继续进行推导和计算。\n\n首先，需要从第一性原理推导单个双激发通道对二阶Møller–Plesset (MP2) 相关能的贡献表达式。根据非简并Rayleigh–Schrödinger微扰理论，对于一个具有未微扰哈密顿量 $\\hat{H}_{0}$ 和微扰 $\\hat{V}$ 的体系，其能量的二阶校正 $E^{(2)}$ 为\n$$\nE^{(2)} = \\sum_{K \\neq 0} \\frac{|\\langle \\Psi_{K} | \\hat{V} | \\Psi_{0} \\rangle|^{2}}{E_{0} - E_{K}}\n$$\n其中 $\\Psi_{0}$ 是 $\\hat{H}_{0}$ 的归一化基态本征函数，其本征值为 $E_{0}$，求和遍及所有激发态本征函数 $\\Psi_{K}$，其本征值为 $E_{K}$。\n\n在Møller–Plesset理论中，未微扰哈密顿量 $\\hat{H}_{0}$ 是Fock算符（单电子Hartree–Fock算符之和），其基态本征函数 $\\Psi_{0}$ 是Hartree–Fock Slater行列式。微扰是起伏势 $\\hat{V} = \\hat{H} - \\hat{H}_{0}$，其中 $\\hat{H}$ 是完整的、非相对论性的电子哈密顿量。$\\hat{H}_{0}$ 的本征函数 $\\Psi_{K}$ 是由Hartree–Fock轨道构建的其他Slater行列式。由于起伏势的性质和Brillouin定理（对于闭壳层参考态，或更一般地说，矩阵元的性质），只有参考态 $\\Psi_{0}$ 和双激发行列式 $\\Psi_{ij}^{ab}$ 之间的矩阵元非零。这里，$\\Psi_{ij}^{ab}$ 是一个行列式，其中来自已占据自旋轨道 $i$ 和 $j$ 的电子被提升到虚拟自旋轨道 $a$ 和 $b$。\n\n在 $\\hat{H}_{0}$ 作用下，$\\Psi_{ij}^{ab}$ 的能量本征值为 $E_{ij}^{ab} = E_{0} - \\epsilon_{i} - \\epsilon_{j} + \\epsilon_{a} + \\epsilon_{b}$，其中 $\\epsilon_{p}$ 是正则自旋轨道能。能量分母变为 $E_{0} - E_{ij}^{ab} = \\epsilon_{i} + \\epsilon_{j} - \\epsilon_{a} - \\epsilon_{b}$。耦合矩阵元 $\\langle \\Psi_{ij}^{ab} | \\hat{V} | \\Psi_{0} \\rangle$ 等于反对称化双电子积分 $\\langle ij || ab \\rangle$。\n\n因此，来自单个双激发通道 $K$（代表激发 $ij \\to ab$）对二阶能量的贡献为\n$$\nE_{K}^{\\mathrm{MP2}} = \\frac{|\\langle ij || ab \\rangle|^{2}}{\\epsilon_{i} + \\epsilon_{j} - \\epsilon_{a} - \\epsilon_{b}} = - \\frac{|\\langle ij || ab \\rangle|^{2}}{(\\epsilon_{a} + \\epsilon_{b}) - (\\epsilon_{i} + \\epsilon_{j})}\n$$\n问题提供了耦合矩阵元的大小，我们记为 $|V_{K}|$，以及轨道能分母 $\\Delta_{K} = (\\epsilon_{a} + \\epsilon_{b}) - (\\epsilon_{i} + \\epsilon_{j})$。因此，贡献的表达式为\n$$\nE_{K}^{\\mathrm{MP2}} = -\\frac{|V_{K}|^{2}}{\\Delta_{K}}\n$$\n我们现在使用此表达式计算两个指定通道的能量分量。所有能量均以原子单位（Hartree）表示。\n\n对于相反自旋(os)通道，给定数据为 $|V_{\\mathrm{os}}| = G_{\\mathrm{os}} = 0.346410$ 和 $\\Delta_{\\mathrm{os}} = 1.00$。\n$$\nE_{\\mathrm{os}}^{\\mathrm{UMP2}} = -\\frac{G_{\\mathrm{os}}^{2}}{\\Delta_{\\mathrm{os}}} = -\\frac{(0.346410)^{2}}{1.00} = -0.12000004881\n$$\n对于相同自旋(ss)通道，给定数据为 $|V_{\\mathrm{ss}}| = K_{\\mathrm{ss}} = 0.600000$ 和 $\\Delta_{\\mathrm{ss}} = 0.90$。\n$$\nE_{\\mathrm{ss}}^{\\mathrm{UMP2}} = -\\frac{K_{\\mathrm{ss}}^{2}}{\\Delta_{\\mathrm{ss}}} = -\\frac{(0.600000)^{2}}{0.90} = -\\frac{0.36}{0.90} = -0.4\n$$\n接下来，我们使用提供的公式和标度系数 $c_{\\mathrm{os}} = \\frac{6}{5}$ 及 $c_{\\mathrm{ss}} = \\frac{1}{3}$，计算自旋组分标度MP2 (SCS-MP2) 相关能 $E_{\\mathrm{corr}}^{\\mathrm{SCS}}$。\n$$\nE_{\\mathrm{corr}}^{\\mathrm{SCS}} = c_{\\mathrm{os}} E_{\\mathrm{os}}^{\\mathrm{UMP2}} + c_{\\mathrm{ss}} E_{\\mathrm{ss}}^{\\mathrm{UMP2}}\n$$\n代入计算出的能量分量：\n$$\nE_{\\mathrm{corr}}^{\\mathrm{SCS}} = \\left(\\frac{6}{5}\\right)(-0.12000004881) + \\left(\\frac{1}{3}\\right)(-0.4)\n$$\n$$\nE_{\\mathrm{corr}}^{\\mathrm{SCS}} = (1.2)(-0.12000004881) - \\frac{0.4}{3}\n$$\n$$\nE_{\\mathrm{corr}}^{\\mathrm{SCS}} = -0.144000058572 - 0.133333333333...\n$$\n$$\nE_{\\mathrm{corr}}^{\\mathrm{SCS}} = -0.277333391905...\n$$\n最后，我们计算SCS-MP2能量相对于精确相关能 $E_{\\mathrm{corr}}^{\\mathrm{exact}} = -0.0280$ 的带符号残余误差 $\\delta E$。\n$$\n\\delta E = E_{\\mathrm{corr}}^{\\mathrm{SCS}} - E_{\\mathrm{corr}}^{\\mathrm{exact}}\n$$\n$$\n\\delta E = (-0.277333391905...) - (-0.0280)\n$$\n$$\n\\delta E = -0.277333391905... + 0.0280\n$$\n$$\n\\delta E = -0.249333391905...\n$$\n问题要求最终答案四舍五入到 $4$ 位有效数字。\n$$\n\\delta E \\approx -0.2493\n$$\n这就是最终结果。", "answer": "$$\n\\boxed{-0.2493}\n$$", "id": "2926385"}, {"introduction": "SCS-MP2等方法的成功在很大程度上依赖于其“经验”特性，即标度系数是通过拟合高精度参考数据得到的。这些系数并非普适的物理常数，其最优值与训练集所涵盖的化学问题类型密切相关。这项高级实践将带您亲身体验参数化的过程，通过岭回归方法探究当训练集从仅包含非共价相互作用扩展到包含反应能垒和热化学数据时，模型的最优系数会发生怎样的变化 [@problem_id:2926415]。", "problem": "要求您研究，将一个校准集从仅包含非共价相互作用扩展到包含势垒高度和热化学的更广泛集合，如何改变一个带有经验色散项的自旋分量标度二阶 Møller–Plesset 相关模型中的最优系数。该模型对目标能量的相关贡献使用以下线性拟设：\n$$\n\\hat{y} = c_{\\mathrm{OS}}\\,x_{\\mathrm{OS}} + c_{\\mathrm{SS}}\\,x_{\\mathrm{SS}} + s_{6}\\,x_{\\mathrm{D3}} + c_{0},\n$$\n其中 $x_{\\mathrm{OS}}$ 是相反自旋二阶 Møller–Plesset (MP2) 相关分量，$x_{\\mathrm{SS}}$ 是相同自旋 MP2 相关分量，$x_{\\mathrm{D3}}$ 是预先计算的 Grimme 第三代色散校正 (D3)，$c_{\\mathrm{OS}}$ 和 $c_{\\mathrm{SS}}$ 是自旋分量标度系数，$s_{6}$ 是经验色散标度因子，$c_{0}$ 是截距。以下所有类能量输入的单位均为千卡/摩尔 (kcal/mol)。您必须以无单位的浮点值形式报告最终数值输出。\n\n从第一性原理出发，通过最小化带有对非截距系数的 $\\ell_{2}$ 型（岭）惩罚的残差平方和来确定最优系数。具体而言，对于给定的非负惩罚参数 $\\lambda$，最小化\n$$\nJ(\\boldsymbol{\\theta}) = \\sum_{i=1}^{N}\\left(\\hat{y}_{i} - y_{i}\\right)^{2} + \\lambda\\left(c_{\\mathrm{OS}}^{2} + c_{\\mathrm{SS}}^{2} + s_{6}^{2}\\right),\n$$\n在上述模型的约束下，其中 $y_{i}$ 是提供的参考目标值，$\\boldsymbol{\\theta} = \\left[c_{\\mathrm{OS}},\\,c_{\\mathrm{SS}},\\,s_{6},\\,c_{0}\\right]^{\\top}$。截距 $c_{0}$ 不得被惩罚。当 $\\lambda=0$ 时，使用普通最小二乘法。\n\n提供了三类数据：非共价相互作用 (NC)、势垒高度 (BH) 和热化学 (TC)。每个数据点都是一个四元组 $(x_{\\mathrm{OS}},x_{\\mathrm{SS}},x_{\\mathrm{D3}},y)$，单位均为 kcal/mol。使用以下值：\n\n- NC1: $\\left(-3.2,\\,-1.1,\\,-0.8,\\,-5.92\\right)$\n- NC2: $\\left(-2.5,\\,-0.9,\\,-0.6,\\,-4.62\\right)$\n- NC3: $\\left(-4.1,\\,-1.5,\\,-1.1,\\,-7.64\\right)$\n- NC4: $\\left(-1.8,\\,-0.6,\\,-0.4,\\,-3.31\\right)$\n- NC5: $\\left(-5.0,\\,-1.8,\\,-1.3,\\,-9.27\\right)$\n- NC6: $\\left(-2.9,\\,-1.0,\\,-0.7,\\,-5.35\\right)$\n\n- BH1: $\\left(-12.0,\\,-4.5,\\,-0.1,\\,-15.375\\right)$\n- BH2: $\\left(-9.0,\\,-3.2,\\,0.0,\\,-11.47\\right)$\n- BH3: $\\left(-15.0,\\,-5.6,\\,0.2,\\,-19.21\\right)$\n- BH4: $\\left(-7.5,\\,-2.7,\\,0.0,\\,-9.57\\right)$\n\n- TC1: $\\left(-25.0,\\,-9.0,\\,0.0,\\,-30.30\\right)$\n- TC2: $\\left(-18.0,\\,-6.5,\\,0.0,\\,-21.825\\right)$\n- TC3: $\\left(-30.0,\\,-11.0,\\,0.1,\\,-36.45\\right)$\n- TC4: $\\left(-22.0,\\,-8.0,\\,0.0,\\,-26.70\\right)$\n\n对于下面给出的测试集中的每个惩罚参数，计算两组最优系数：\n1) 仅使用 NC 数据（NC1–NC6）进行训练。\n2) 使用包含 NC、BH 和 TC 的组合数据集（全部十四个条目）进行训练。\n\n然后，对于每个惩罚项，计算系数偏移向量\n$$\n\\Delta(\\lambda) = \\boldsymbol{\\theta}_{\\mathrm{all}}(\\lambda) - \\boldsymbol{\\theta}_{\\mathrm{NC}}(\\lambda),\n$$\n其中 $\\boldsymbol{\\theta}_{\\mathrm{all}}(\\lambda)$ 在组合数据集上训练得到，而 $\\boldsymbol{\\theta}_{\\mathrm{NC}}(\\lambda)$ 在仅 NC 数据集上训练得到。按 $\\left[\\Delta c_{\\mathrm{OS}},\\,\\Delta c_{\\mathrm{SS}},\\,\\Delta s_{6},\\,\\Delta c_{0}\\right]$ 的顺序报告 $\\Delta(\\lambda)$ 的四个分量，并报告其欧几里得范数\n$$\n\\left\\|\\Delta(\\lambda)\\right\\|_{2} = \\sqrt{\\left(\\Delta c_{\\mathrm{OS}}\\right)^{2} + \\left(\\Delta c_{\\mathrm{SS}}\\right)^{2} + \\left(\\Delta s_{6}\\right)^{2} + \\left(\\Delta c_{0}\\right)^{2}}.\n$$\n\n岭惩罚测试集：\n- $\\lambda = 0$\n- $\\lambda = 10^{-4}$\n- $\\lambda = 10^{-2}$\n- $\\lambda = 1$\n- $\\lambda = 10^{3}$\n\n您的程序必须：\n- 为截距构造一个全为 1 的列来构建设计矩阵。\n- 解决惩罚最小二乘问题，其中只有前三个系数被惩罚。\n- 对于测试集中的每个 $\\lambda$，计算并收集 $\\left[\\Delta c_{\\mathrm{OS}},\\,\\Delta c_{\\mathrm{SS}},\\,\\Delta s_{6},\\,\\Delta c_{0},\\,\\left\\|\\Delta\\right\\|_{2}\\right]$。\n\n最终输出格式：\n- 生成单行输出，包含一个以逗号分隔的列表的列表，每个内部列表对应一个惩罚值，按测试集的顺序排列。每个内部列表必须按 $\\left[\\Delta c_{\\mathrm{OS}},\\,\\Delta c_{\\mathrm{SS}},\\,\\Delta s_{6},\\,\\Delta c_{0},\\,\\left\\|\\Delta\\right\\|_{2}\\right]$ 的顺序包含五个浮点数。\n- 输出中的所有浮点数必须四舍五入到六位小数。\n- 示例格式（仅为说明）：$[[a_{1},b_{1},c_{1},d_{1},e_{1}],[a_{2},b_{2},c_{2},d_{2},e_{2}],\\dots]$。", "solution": "所呈现的问题陈述是有效的。它描述了计算化学中一个明确定义的任务，特别是使用岭回归对半经验能量模型进行参数化。该模型具有物理动机，目标函数在数学上是合理的，并且提供了所有必要的数据和约束。该问题是自洽的、有科学依据且客观的。它是惩罚线性回归的一个标准应用，不需要任何无效的假设。\n\n任务是通过最小化包含 $\\ell_{2}$ 惩罚（岭回归）的残差平方和目标函数，来确定线性能量模型的最优系数。该分析将针对两个不同的训练集和一系列惩罚参数 $\\lambda$ 进行。\n\n预测能量 $\\hat{y}$ 的线性模型由以下拟设给出：\n$$\n\\hat{y} = c_{\\mathrm{OS}}\\,x_{\\mathrm{OS}} + c_{\\mathrm{SS}}\\,x_{\\mathrm{SS}} + s_{6}\\,x_{\\mathrm{D3}} + c_{0}\n$$\n这里，$\\boldsymbol{\\theta} = \\begin{bmatrix} c_{\\mathrm{OS}}  c_{\\mathrm{SS}}  s_{6}  c_{0} \\end{bmatrix}^{\\top}$ 是待确定的参数向量。对于一组 $N$ 个数据点，这可以表示为矩阵形式：\n$$\n\\mathbf{\\hat{y}} = \\mathbf{X}\\boldsymbol{\\theta}\n$$\n其中 $\\mathbf{y} \\in \\mathbb{R}^{N}$ 是预测值向量，$\\mathbf{X} \\in \\mathbb{R}^{N \\times 4}$ 是设计矩阵，$\\boldsymbol{\\theta} \\in \\mathbb{R}^{4}$ 是参数向量。$\\mathbf{X}$ 的每一行对应一个数据点 $(x_{\\mathrm{OS},i}, x_{\\mathrm{SS},i}, x_{\\mathrm{D3},i})$，并带有一个为截距项 $c_0$ 设置的第四列，其值为 1。向量 $\\mathbf{y} \\in \\mathbb{R}^{N}$ 包含相应的参考目标值。\n\n目标是找到最小化成本函数 $J(\\boldsymbol{\\theta})$ 的参数向量 $\\boldsymbol{\\theta}$：\n$$\nJ(\\boldsymbol{\\theta}) = \\sum_{i=1}^{N}\\left(\\hat{y}_{i} - y_{i}\\right)^{2} + \\lambda\\left(c_{\\mathrm{OS}}^{2} + c_{\\mathrm{SS}}^{2} + s_{6}^{2}\\right)\n$$\n截距 $c_{0}$ 不被惩罚。该成本函数可以用矩阵表示法写为：\n$$\nJ(\\boldsymbol{\\theta}) = (\\mathbf{X}\\boldsymbol{\\theta} - \\mathbf{y})^{\\top}(\\mathbf{X}\\boldsymbol{\\theta} - \\mathbf{y}) + \\lambda \\boldsymbol{\\theta}^{\\top}\\mathbf{\\Gamma}\\boldsymbol{\\theta}\n$$\n其中 $\\mathbf{y}$ 是参考值向量，$\\mathbf{\\Gamma}$ 是一个 $4 \\times 4$ 的对角矩阵，用于选择要惩罚的系数。由于只有 $c_{\\mathrm{OS}}$、$c_{\\mathrm{SS}}$ 和 $s_{6}$ 被惩罚，$\\mathbf{\\Gamma}$ 为：\n$$\n\\mathbf{\\Gamma} = \\begin{pmatrix} 1  0  0  0 \\\\ 0  1  0  0 \\\\ 0  0  1  0 \\\\ 0  0  0  0 \\end{pmatrix}\n$$\n\n为了找到 $J(\\boldsymbol{\\theta})$ 的最小值，我们计算其关于 $\\boldsymbol{\\theta}$ 的梯度并将其设为零向量：\n$$\n\\nabla_{\\boldsymbol{\\theta}} J(\\boldsymbol{\\theta}) = \\nabla_{\\boldsymbol{\\theta}} \\left( (\\mathbf{X}\\boldsymbol{\\theta})^{\\top}(\\mathbf{X}\\boldsymbol{\\theta}) - 2(\\mathbf{X}\\boldsymbol{\\theta})^{\\top}\\mathbf{y} + \\mathbf{y}^{\\top}\\mathbf{y} + \\lambda\\boldsymbol{\\theta}^{\\top}\\mathbf{\\Gamma}\\boldsymbol{\\theta} \\right) = \\mathbf{0}\n$$\n$$\n\\nabla_{\\boldsymbol{\\theta}} J(\\boldsymbol{\\theta}) = \\nabla_{\\boldsymbol{\\theta}} \\left( \\boldsymbol{\\theta}^{\\top}\\mathbf{X}^{\\top}\\mathbf{X}\\boldsymbol{\\theta} - 2\\boldsymbol{\\theta}^{\\top}\\mathbf{X}^{\\top}\\mathbf{y} + \\mathbf{y}^{\\top}\\mathbf{y} + \\lambda\\boldsymbol{\\theta}^{\\top}\\mathbf{\\Gamma}\\boldsymbol{\\theta} \\right) = \\mathbf{0}\n$$\n使用标准向量微积分法则，梯度为：\n$$\n2\\mathbf{X}^{\\top}\\mathbf{X}\\boldsymbol{\\theta} - 2\\mathbf{X}^{\\top}\\mathbf{y} + 2\\lambda\\mathbf{\\Gamma}\\boldsymbol{\\theta} = \\mathbf{0}\n$$\n重新整理这些项，得到此岭回归问题的正规方程：\n$$\n(\\mathbf{X}^{\\top}\\mathbf{X} + \\lambda\\mathbf{\\Gamma})\\boldsymbol{\\theta} = \\mathbf{X}^{\\top}\\mathbf{y}\n$$\n这是一个形式为 $\\mathbf{A}\\boldsymbol{\\theta} = \\mathbf{b}$ 的线性方程组，其中 $\\mathbf{A} = (\\mathbf{X}^{\\top}\\mathbf{X} + \\lambda\\mathbf{\\Gamma})$ 且 $\\mathbf{b} = \\mathbf{X}^{\\top}\\mathbf{y}$。最优参数向量 $\\boldsymbol{\\theta}$ 可以通过求解该方程组找到。对于 $\\lambda > 0$，矩阵 $\\mathbf{A}$ 保证是可逆的，从而提供唯一解。对于 $\\lambda = 0$，问题简化为普通最小二乘法，如果 $\\mathbf{X}^{\\top}\\mathbf{X}$ 可逆（即 $\\mathbf{X}$ 的列线性无关），则有唯一解。\n\n计算过程如下：\n1.  将提供的数据分为两组：包含 $N_{\\mathrm{NC}} = 6$ 个点的非共价 (NC) 集，以及包含 $N_{\\mathrm{all}} = 14$ 个点的组合 (all) 集。\n2.  为每个数据集构建设计矩阵 $\\mathbf{X}$ 和目标向量 $\\mathbf{y}$。对于 NC 集，这会产生 $\\mathbf{X}_{\\mathrm{NC}}$ ($6 \\times 4$) 和 $\\mathbf{y}_{\\mathrm{NC}}$ ($6 \\times 1$)。对于组合集，我们有 $\\mathbf{X}_{\\mathrm{all}}$ ($14 \\times 4$) 和 $\\mathbf{y}_{\\mathrm{all}}$ ($14 \\times 1$) 。\n3.  对于测试集 $\\{0, 10^{-4}, 10^{-2}, 1, 10^{3}\\}$ 中每个指定的 $\\lambda$ 值：\n    a.  求解 $(\\mathbf{X}_{\\mathrm{NC}}^{\\top}\\mathbf{X}_{\\mathrm{NC}} + \\lambda\\mathbf{\\Gamma})\\boldsymbol{\\theta}_{\\mathrm{NC}} = \\mathbf{X}_{\\mathrm{NC}}^{\\top}\\mathbf{y}_{\\mathrm{NC}}$ 以找到仅 NC 数据的最优参数 $\\boldsymbol{\\theta}_{\\mathrm{NC}}(\\lambda)$。\n    b.  求解 $(\\mathbf{X}_{\\mathrm{all}}^{\\top}\\mathbf{X}_{\\mathrm{all}} + \\lambda\\mathbf{\\Gamma})\\boldsymbol{\\theta}_{\\mathrm{all}} = \\mathbf{X}_{\\mathrm{all}}^{\\top}\\mathbf{y}_{\\mathrm{all}}$ 以找到组合数据集的最优参数 $\\boldsymbol{\\theta}_{\\mathrm{all}}(\\lambda)$。\n    c.  计算系数偏移向量 $\\Delta(\\lambda) = \\boldsymbol{\\theta}_{\\mathrm{all}}(\\lambda) - \\boldsymbol{\\theta}_{\\mathrm{NC}}(\\lambda)$。\n    d.  计算偏移向量的欧几里得范数 $\\|\\Delta(\\lambda)\\|_{2}$。\n4.  对于每个 $\\lambda$，收集 $\\Delta(\\lambda)$ 的分量及其范数，四舍五入到六位小数，并格式化为最终输出。以下程序实现了这个过程。", "answer": "```python\nimport numpy as np\n\ndef solve_ridge(X, y, lambda_val):\n    \"\"\"\n    Solves a ridge regression problem with a custom penalty.\n    The penalty is applied only to the first three coefficients.\n    \n    The problem is to find theta that minimizes:\n    ||X @ theta - y||^2 + lambda_val * (theta[0]^2 + theta[1]^2 + theta[2]^2)\n    \n    This corresponds to the normal equations:\n    (X.T @ X + lambda_val * Gamma) @ theta = X.T @ y\n    where Gamma = diag([1, 1, 1, 0]).\n    \"\"\"\n    num_params = X.shape[1]\n    \n    # Penalty matrix Gamma\n    Gamma = np.zeros((num_params, num_params))\n    Gamma[0, 0] = 1.0\n    Gamma[1, 1] = 1.0\n    Gamma[2, 2] = 1.0\n    \n    # Left-hand side of the normal equations\n    A = X.T @ X + lambda_val * Gamma\n    \n    # Right-hand side of the normal equations\n    b = X.T @ y\n    \n    # Solve the linear system A * theta = b\n    theta = np.linalg.solve(A, b)\n    \n    return theta\n\ndef solve():\n    \"\"\"\n    Main function to perform the analysis and print the results.\n    \"\"\"\n    # Data provided in the problem statement (x_OS, x_SS, x_D3, y)\n    nc_data_tuples = [\n        (-3.2, -1.1, -0.8, -5.92),\n        (-2.5, -0.9, -0.6, -4.62),\n        (-4.1, -1.5, -1.1, -7.64),\n        (-1.8, -0.6, -0.4, -3.31),\n        (-5.0, -1.8, -1.3, -9.27),\n        (-2.9, -1.0, -0.7, -5.35),\n    ]\n\n    bh_data_tuples = [\n        (-12.0, -4.5, -0.1, -15.375),\n        (-9.0, -3.2, 0.0, -11.47),\n        (-15.0, -5.6, 0.2, -19.21),\n        (-7.5, -2.7, 0.0, -9.57),\n    ]\n\n    tc_data_tuples = [\n        (-25.0, -9.0, 0.0, -30.30),\n        (-18.0, -6.5, 0.0, -21.825),\n        (-30.0, -11.0, 0.1, -36.45),\n        (-22.0, -8.0, 0.0, -26.70),\n    ]\n\n    all_data_tuples = nc_data_tuples + bh_data_tuples + tc_data_tuples\n\n    # Convert tuple data to numpy arrays\n    nc_data = np.array(nc_data_tuples)\n    all_data = np.array(all_data_tuples)\n\n    # Construct design matrices (X) and target vectors (y)\n    # The last column of X is for the intercept c0, so it's a column of ones.\n    X_nc = np.c_[nc_data[:, :3], np.ones(nc_data.shape[0])]\n    y_nc = nc_data[:, 3]\n    \n    X_all = np.c_[all_data[:, :3], np.ones(all_data.shape[0])]\n    y_all = all_data[:, 3]\n\n    # Test suite of ridge penalties\n    test_lambdas = [0.0, 1e-4, 1e-2, 1.0, 1e3]\n    \n    results = []\n    \n    for lambda_val in test_lambdas:\n        # 1) Train using only the NC data\n        theta_nc = solve_ridge(X_nc, y_nc, lambda_val)\n        \n        # 2) Train using the combined dataset\n        theta_all = solve_ridge(X_all, y_all, lambda_val)\n        \n        # 3) Compute the coefficient shift vector Delta\n        delta = theta_all - theta_nc\n        \n        # 4) Compute the Euclidean norm of Delta\n        norm_delta = np.linalg.norm(delta)\n        \n        # Collect the results: [delta_c_OS, delta_c_SS, delta_s6, delta_c0, norm_delta]\n        # Round to six decimal places as required.\n        current_result = [round(val, 6) for val in list(delta) + [norm_delta]]\n        results.append(current_result)\n        \n    # Format the final output string to match the required format exactly.\n    # The str() representation of a list of lists with spaces removed is correct.\n    output_string = str(results).replace(\" \", \"\")\n    \n    print(output_string)\n\nsolve()\n```", "id": "2926415"}]}