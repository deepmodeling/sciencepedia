{"hands_on_practices": [{"introduction": "路径积分模拟的核心是将一个量子粒子映射为一个经典的环状聚合物。这个练习将引导你通过正交变换来解耦这个环状聚合物的哈密顿量，这是理解路径积分蒙特卡洛 (PIMC) 和环状聚合物分子动力学 (RPMD) 背后物理图像和开发高效算法的关键一步。通过将复杂的珠子间耦合振动分解为一组独立的简正模式，我们可以极大地简化对系统性质的分析 [@problem_id:2659154]。", "problem": "考虑一个质量为 $m$、角频率为 $\\omega$ 的一维量子谐振子，其逆温度为 $\\beta = 1/(k_{B} T)$。在具有 $P$ 个时间片（珠子）的虚时间路径积分离散化中（路径积分蒙特卡洛（PIMC）和环状聚合物分子动力学（RPMD）均基于此方法），相应的经典同构 $P$-珠环状聚合物哈密顿量为\n$$\nH_{P}(\\{q_{j},p_{j}\\}_{j=0}^{P-1}) \\;=\\; \\sum_{j=0}^{P-1} \\left[ \\frac{p_{j}^{2}}{2 m} \\;+\\; \\frac{1}{2} m \\omega^{2} q_{j}^{2} \\right] \\;+\\; \\frac{1}{2} m \\omega_{P}^{2} \\sum_{j=0}^{P-1} \\left(q_{j} - q_{j+1}\\right)^{2},\n$$\n其中周期性边界条件为 $q_{P} \\equiv q_{0}$，环状聚合物频率为 $\\omega_{P} = P/(\\beta \\hbar)$。仅使用上述哈密顿量和关于循环矩阵对角化的基础线性代数知识，完成以下任务：\n\n1) 针对 $P$-珠坐标构造一个正交归一的简正模变换，以对角化位置坐标的二次型。用正则共轭的简正坐标和动量写出解耦的简正模哈密顿量，并确定每个简正模的有效角频率，作为模指标 $k \\in \\{0,1,\\dots,P-1\\}$ 的函数。\n\n2) 使用物理逆温度 $\\beta$ 下的正则系综，推导每个简正坐标在有限温度下的方差 $\\langle Q_{k}^{2} \\rangle$ 的闭合形式解析表达式。\n\n请给出 $\\langle Q_{k}^{2} \\rangle$ 关于 $k$、$P$、$\\beta$、$\\hbar$、$m$ 和 $\\omega$ 的单一闭合形式表达式作为最终答案。不要提供任何数值计算结果。", "solution": "该问题定义明确且具有科学依据，是路径积分模拟理论中的一个标准推导。我们将着手求解。\n\n该问题需要两步完成：首先，通过简正模变换对角化给定的环状聚合物哈密顿量；其次，计算所得简正模坐标的正则方差。\n\n环状聚合物哈密顿量由下式给出：\n$$\nH_{P}(\\{q_{j},p_{j}\\}_{j=0}^{P-1}) \\;=\\; \\sum_{j=0}^{P-1} \\frac{p_{j}^{2}}{2 m} \\;+\\; V(\\{q_{j}\\}_{j=0}^{P-1})\n$$\n其中势能项为\n$$\nV(\\{q_{j}\\}) \\;=\\; \\sum_{j=0}^{P-1} \\left[ \\frac{1}{2} m \\omega^{2} q_{j}^{2} \\right] \\;+\\; \\frac{1}{2} m \\omega_{P}^{2} \\sum_{j=0}^{P-1} \\left(q_{j} - q_{j+1}\\right)^{2}\n$$\n并满足周期性边界条件 $q_{P} \\equiv q_{0}$ 和 $\\omega_{P} = P/(\\beta \\hbar)$。\n\n第 1 部分：简正模变换\n\n我们首先专注于对角化势能 $V(\\{q_{j}\\})$，它是珠子位置 $\\{q_{j}\\}$ 的一个二次型。让我们重写 $V$ 以确定其 Hessian 矩阵的结构。展开第二项：\n$$\n\\sum_{j=0}^{P-1} (q_{j} - q_{j+1})^{2} = \\sum_{j=0}^{P-1} (q_{j}^{2} - 2q_{j}q_{j+1} + q_{j+1}^{2}) = 2 \\sum_{j=0}^{P-1} q_{j}^{2} - 2 \\sum_{j=0}^{P-1} q_{j}q_{j+1}\n$$\n这里我们使用了周期性条件 $q_P = q_0$，它意味着 $\\sum_{j=0}^{P-1} q_{j+1}^{2} = \\sum_{j=0}^{P-1} q_{j}^{2}$。\n将此代回 $V$ 的表达式中：\n$$\nV(\\{q_j\\}) = \\sum_{j=0}^{P-1} \\frac{1}{2} m \\omega^{2} q_{j}^{2} + \\frac{1}{2} m \\omega_{P}^{2} \\left( 2 \\sum_{j=0}^{P-1} q_j^2 - 2 \\sum_{j=0}^{P-1} q_j q_{j+1} \\right)\n$$\n$$\nV(\\{q_j\\}) = \\frac{1}{2} m \\sum_{j=0}^{P-1} \\left[ (\\omega^2 + 2\\omega_P^2) q_j^2 - 2\\omega_P^2 q_j q_{j+1} \\right]\n$$\n该势能可以表示为矩阵形式 $V = \\frac{1}{2} \\mathbf{q}^{T} \\mathbf{A} \\mathbf{q}$，其中 $\\mathbf{q} = (q_0, q_1, \\dots, q_{P-1})^T$ 是珠子位置的列向量，$\\mathbf{A}$ 是一个 $P \\times P$ 的对称矩阵。矩阵 $\\frac{1}{m}\\mathbf{A}$ 的矩阵元由下式给出：\n$$\n\\left(\\frac{1}{m}\\mathbf{A}\\right)_{ij} = (\\omega^2 + 2\\omega_P^2)\\delta_{ij} - \\omega_P^2(\\delta_{i, j-1} + \\delta_{i, j+1})\n$$\n其中指标对 $P$ 取模。这是一个循环矩阵。任何 $P \\times P$ 的循环矩阵都可以通过离散傅里叶变换 (DFT) 对角化。我们通过一个正交归一变换 $\\mathbf{q} = \\mathbf{T} \\mathbf{Q}$ 引入一组简正模坐标 $\\{Q_{k}\\}$，其中 $\\mathbf{T}$ 是一个正交矩阵，其列是 $\\mathbf{A}$ 的特征向量。对于第一行为 $(c_0, c_1, \\dots, c_{P-1})$ 的循环矩阵，其特征值由 $\\lambda_{k} = \\sum_{j=0}^{P-1} c_j \\exp(i 2\\pi jk/P)$ 给出，其中 $k \\in \\{0, 1, \\dots, P-1\\}$。\n对于矩阵 $\\frac{1}{m}\\mathbf{A}$，其第一行为 $(\\omega^2 + 2\\omega_P^2, -\\omega_P^2, 0, \\dots, 0, -\\omega_P^2)$。其特征值（我们记作 $\\omega_k^2$）为：\n$$\n\\omega_k^2 = (\\omega^2 + 2\\omega_P^2) \\cdot \\exp(0) + (-\\omega_P^2) \\cdot \\exp\\left(\\frac{i 2\\pi k}{P}\\right) + (-\\omega_P^2) \\cdot \\exp\\left(\\frac{i 2\\pi (P-1) k}{P}\\right)\n$$\n使用 $\\exp(i 2\\pi (P-1) k/P) = \\exp(-i 2\\pi k/P)$，我们简化得到：\n$$\n\\omega_k^2 = \\omega^2 + 2\\omega_P^2 - \\omega_P^2 \\left( \\exp\\left(\\frac{i 2\\pi k}{P}\\right) + \\exp\\left(-\\frac{i 2\\pi k}{P}\\right) \\right)\n$$\n$$\n\\omega_k^2 = \\omega^2 + 2\\omega_P^2 - 2\\omega_P^2 \\cos\\left(\\frac{2\\pi k}{P}\\right) = \\omega^2 + 2\\omega_P^2 \\left(1 - \\cos\\left(\\frac{2\\pi k}{P}\\right)\\right)\n$$\n使用半角公式 $1 - \\cos(2\\theta) = 2\\sin^2(\\theta)$，我们得到特征值：\n$$\n\\omega_k^2 = \\omega^2 + 4\\omega_P^2 \\sin^2\\left(\\frac{\\pi k}{P}\\right)\n$$\n这些量 $\\omega_k^2$ 代表了简正模有效角频率的平方。在简正模基中，势能是对角的：\n$$\nV = \\frac{1}{2} \\sum_{k=0}^{P-1} m \\omega_k^2 Q_k^2\n$$\n动能项为 $K = \\sum_{j=0}^{P-1} p_j^2 / (2m)$。由于变换 $\\mathbf{q} = \\mathbf{T}\\mathbf{Q}$ 是正交归一的（$\\mathbf{T}^T\\mathbf{T} = \\mathbf{I}$），它保持内积不变。为了保持正则对易关系，动量的变换必须是 $\\mathbf{p} = \\mathbf{T}\\mathbf{P}$，其中 $\\mathbf{P}$ 是与 $\\mathbf{Q}$ 共轭的动量向量。因此，动能变为：\n$$\nK = \\frac{1}{2m} \\mathbf{p}^T\\mathbf{p} = \\frac{1}{2m} (\\mathbf{T}\\mathbf{P})^T (\\mathbf{T}\\mathbf{P}) = \\frac{1}{2m} \\mathbf{P}^T \\mathbf{T}^T\\mathbf{T} \\mathbf{P} = \\frac{1}{2m} \\mathbf{P}^T\\mathbf{I}\\mathbf{P} = \\sum_{k=0}^{P-1} \\frac{P_k^2}{2m}\n$$\n在简正模坐标 $\\{Q_k, P_k\\}$ 中，总哈密顿量是 $P$ 个独立谐振子的和：\n$$\nH_P = \\sum_{k=0}^{P-1} \\left( \\frac{P_k^2}{2m} + \\frac{1}{2}m\\omega_k^2 Q_k^2 \\right)\n$$\n模 $k$ 的有效角频率为 $\\omega_k = \\sqrt{\\omega^2 + 4\\omega_P^2 \\sin^2(\\frac{\\pi k}{P})}$。\n\n第 2 部分：方差 $\\langle Q_k^2 \\rangle$ 的计算\n\n我们现在在逆温度为 $\\beta$ 的正则系综中，为经典同构哈密顿量 $H_P$ 计算 $Q_k^2$ 的热平均值。一个可观测量 $A$ 的期望值由下式给出\n$$\n\\langle A \\rangle = \\frac{\\int d\\mathbf{Q} d\\mathbf{P} \\, A \\, \\exp(-\\beta H_P)}{\\int d\\mathbf{Q} d\\mathbf{P} \\, \\exp(-\\beta H_P)}\n$$\n由于哈密顿量是可分离的，$H_P = \\sum_k H_k$，计算 $\\langle Q_k^2 \\rangle$ 只涉及第 $k$ 个模的自由度。所有其他积分都相互抵消。\n$$\n\\langle Q_k^2 \\rangle = \\frac{\\int dQ_k dP_k \\, Q_k^2 \\, \\exp\\left(-\\beta\\left[\\frac{P_k^2}{2m} + \\frac{1}{2}m\\omega_k^2 Q_k^2\\right]\\right)}{\\int dQ_k dP_k \\, \\exp\\left(-\\beta\\left[\\frac{P_k^2}{2m} + \\frac{1}{2}m\\omega_k^2 Q_k^2\\right]\\right)}\n$$\n这是一个经典的统计力学问题。我们可以应用能量均分定理，该定理指出哈密顿量中每个二次型自由度贡献的平均能量为 $\\frac{1}{2} k_B T = \\frac{1}{2\\beta}$。\n对于第 $k$ 个模的势能项 $V_k = \\frac{1}{2}m\\omega_k^2 Q_k^2$，该定理给出：\n$$\n\\left\\langle \\frac{1}{2} m \\omega_k^2 Q_k^2 \\right\\rangle = \\frac{1}{2\\beta}\n$$\n因为对于给定的模，$m$ 和 $\\omega_k$ 是常数，我们可以写出：\n$$\n\\frac{1}{2} m \\omega_k^2 \\langle Q_k^2 \\rangle = \\frac{1}{2\\beta}\n$$\n解出方差 $\\langle Q_k^2 \\rangle$ 得到：\n$$\n\\langle Q_k^2 \\rangle = \\frac{1}{\\beta m \\omega_k^2}\n$$\n代入第 1 部分中 $\\omega_k^2$ 的表达式：\n$$\n\\langle Q_k^2 \\rangle = \\frac{1}{\\beta m \\left[ \\omega^2 + 4\\omega_P^2 \\sin^2\\left(\\frac{\\pi k}{P}\\right) \\right]}\n$$\n最后，代入 $\\omega_P = P/(\\beta\\hbar)$：\n$$\n\\langle Q_k^2 \\rangle = \\frac{1}{\\beta m \\left[ \\omega^2 + 4\\left(\\frac{P}{\\beta\\hbar}\\right)^2 \\sin^2\\left(\\frac{\\pi k}{P}\\right) \\right]}\n$$\n该表达式可以重写为：\n$$\n\\langle Q_k^2 \\rangle = \\frac{1}{\\beta m \\omega^2 + \\frac{4m P^2}{\\beta\\hbar^2} \\sin^2\\left(\\frac{\\pi k}{P}\\right)}\n$$\n这是环状聚合物第 $k$ 个简正坐标方差的最终解析表达式。", "answer": "$$\n\\boxed{\\frac{1}{\\beta m \\omega^2 + \\frac{4m P^2}{\\beta\\hbar^2} \\sin^2\\left(\\frac{\\pi k}{P}\\right)}}\n$$", "id": "2659154"}, {"introduction": "在掌握了环状聚合物的基本结构后，下一步是亲眼见证路径积分方法如何运作。本练习提供了一个经典的基准测试：一维量子谐振子，其精确的量子配分函数和路径积分近似的配分函数都可以解析计算。通过比较两者，你将能直接观察并量化 PIMC 方法如何随着“珠子”数量 $P$ 的增加而收敛到精确解，从而对 Trotter 近似的本质和收敛行为获得深刻的实践理解 [@problem_id:2659206]。", "problem": "考虑一个一维量子谐振子，其质量为 $m$，角频率为 $\\omega$，处于逆温度 $\\beta$下。在约化单位制下进行计算，其中普朗克常数除以 $2\\pi$ 设为 $\\hbar = 1$，玻尔兹曼常数设为 $k_{\\mathrm{B}} = 1$，因此所有量均为无量纲。您的任务是推导、实现并测试精确量子正则配分函数与其虚时路径积分离散化之间的比较，该比较是特罗特数 $P$ 的函数。\n\n从以下基本依据出发：\n- 正则配分函数为 $Z = \\mathrm{Tr}\\left[e^{-\\beta \\hat{H}}\\right]$，其中哈密顿量为 $\\hat{H} = \\frac{\\hat{p}^2}{2m} + \\frac{1}{2} m \\omega^2 \\hat{q}^2$。\n- 特罗特分解和 Feynman 虚时路径积分表示将 $Z$ 表达为虚时演化算符的 $P$ 重分解的极限。对于有限的 $P$，这会产生一个关于 $P$ 珠环状聚合物的经典构型积分，该聚合物具有最近邻谐波弹簧和珠上势 $V(q) = \\frac{1}{2} m \\omega^2 q^2$。\n- 对于二次作用量，高斯积分可简化为二次型的行列式。\n\n要求：\n1) 在此单位制下，推导一维谐振子的精确量子配分函数 $Z_{\\mathrm{exact}}(\\beta,\\omega)$。\n2) 从具有 $P$ 个珠子和原始特罗特分割的离散虚时路径积分出发，推导出一个对于有限 $P$ 的显式、可计算的表达式 $Z_P(\\beta,\\omega)$，以环状聚合物简正模式的乘积形式表示（这是真实的蒙特卡洛抽样会估计的 $P$ 级路径积分蒙特卡洛（PIMC）目标；在此您将通过等效的高斯积分来确定性地计算它）。\n3) 对于下面每个指定的测试用例，计算当 $P \\in \\{1,2,4,8,16,32,64\\}$ 时的 $Z_{\\mathrm{exact}}(\\beta,\\omega)$ 和 $Z_P(\\beta,\\omega)$。使用这些值计算每个 $P$ 对应的绝对误差 $|Z_P - Z_{\\mathrm{exact}}|$。\n4) 通过对最后四个 $P$ 值 $P \\in \\{8,16,32,64\\}$ 进行幂律拟合 $|Z_P - Z_{\\mathrm{exact}}| \\approx C P^{-r}$ 来量化收敛速率，使用对数-对数数据的线性最小二乘法提取指数 $r$。\n5) 将上述步骤实现为一个完整的程序，为测试套件生成所需的输出。\n\n使用以下参数集测试套件（在所述单位制 $\\hbar = 1$，$k_{\\mathrm{B}}=1$下均为无量纲）：\n- 情况 1: $(\\beta,\\omega) = (0.5, 1.0)$。\n- 情况 2: $(\\beta,\\omega) = (1.0, 1.0)$。\n- 情况 3: $(\\beta,\\omega) = (3.0, 1.0)$。\n- 情况 4: $(\\beta,\\omega) = (1.0, 0.5)$。\n\n程序输入：无。所有参数均已在上方提供。\n\n程序输出：\n- 对于每种情况，输出一个浮点数：从步骤 4 拟合得到的收敛指数 $r$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的结果按上述情况的顺序列出，例如 $[r_1,r_2,r_3,r_4]$。\n- 每个 $r$ 都必须以浮点数形式报告。由于选择了 $\\hbar = 1$，$k_{\\mathrm{B}}=1$，所有输出都是无单位的。\n\n数值指导和约束：\n- 为保证数值稳定性，请使用本征模式贡献的对数来计算 $Z_P(\\beta,\\omega)$ 的乘积。\n- 三角函数中使用的角度必须是弧度制。\n- 不允许外部输入或随机性；您的实现必须是确定性的和自包含的。", "solution": "问题陈述已经过严格验证，被认为是科学上合理、定义明确且客观的。这是一个统计力学中的标准问题，其解是唯一且可验证的。我们现在按要求进行推导和实现。分析将在约化单位制下进行，其中普朗克常数除以 $2\\pi$ 为 $\\hbar=1$，玻尔兹曼常数为 $k_{\\mathrm{B}}=1$。\n\n首先，我们推导精确的量子正则配分函数 $Z_{\\mathrm{exact}}$。一维量子谐振子的哈密顿量由 $\\hat{H} = \\frac{\\hat{p}^2}{2m} + \\frac{1}{2} m \\omega^2 \\hat{q}^2$ 给出。该系统的能量本征值是量子化的，由 $E_n = \\hbar \\omega (n + \\frac{1}{2})$ 给出，其中 $n$ 是非负整数，$n=0, 1, 2, \\ldots$。在指定的 $\\hbar=1$ 约化单位制中，能级为 $E_n = \\omega(n + \\frac{1}{2})$。在逆温度 $\\beta = 1/(k_{\\mathrm{B}}T)$ 下，正则配分函数 $Z$ 定义为玻尔兹曼算符的迹，$Z = \\mathrm{Tr}[e^{-\\beta \\hat{H}}]$。在能量本征基中，这成为对所有状态的求和：\n$$Z_{\\mathrm{exact}} = \\sum_{n=0}^{\\infty} e^{-\\beta E_n} = \\sum_{n=0}^{\\infty} e^{-\\beta \\omega (n + 1/2)}$$\n我们可以提出基态的贡献，并将剩余的和识别为一个几何级数：\n$$Z_{\\mathrm{exact}} = e^{-\\beta \\omega/2} \\sum_{n=0}^{\\infty} (e^{-\\beta \\omega})^n$$\n几何级数 $\\sum_{n=0}^{\\infty} x^n$ 在 $|x|<1$ 时收敛于 $1/(1-x)$。在这里，$x=e^{-\\beta\\omega}$，对于正的 $\\beta$ 和 $\\omega$，该值总是小于 1。因此，该和的计算结果为 $1/(1-e^{-\\beta\\omega})$。将其代回，我们得到：\n$$Z_{\\mathrm{exact}} = \\frac{e^{-\\beta \\omega/2}}{1 - e^{-\\beta \\omega}} = \\frac{1}{e^{\\beta \\omega/2} - e^{-\\beta \\omega/2}}$$\n这个表达式等价于双曲余割函数：\n$$Z_{\\mathrm{exact}}(\\beta, \\omega) = \\frac{1}{2\\sinh(\\beta\\omega/2)}$$\n请注意，此表达式与质量 $m$ 无关。\n\n接下来，我们从离散虚时路径积分公式推导近似配分函数 $Z_P$。配分函数可以表示为在虚时 $\\tau \\in [0, \\beta\\hbar]$ 内对闭合路径的积分。将这个时间间隔离散化为 $P$ 个步长为 $\\epsilon = \\beta/P$ 的步骤，并使用原始特罗特分解 $e^{-\\beta \\hat{H}} \\approx (e^{-\\epsilon \\hat{V}} e^{-\\epsilon \\hat{T}})^P$，可得到 $Z_P$ 的表达式：\n$$Z_P = \\mathrm{Tr}\\left[ \\left(e^{-\\frac{\\beta}{P}\\hat{T}} e^{-\\frac{\\beta}{P}\\hat{V}}\\right)^P \\right]$$\n在算符之间插入完备的位置本征态集，得到一个关于循环聚合物链（“环状聚合物”）位置 $q_1, q_2, \\ldots, q_P$ 的类经典构型积分。对于质量为 $m$ 的粒子，其表达式为：\n$$Z_P = \\left(\\frac{mP}{2\\pi\\beta\\hbar^2}\\right)^{P/2} \\int_{-\\infty}^{\\infty} \\! \\dots \\! \\int_{-\\infty}^{\\infty} d\\mathbf{q} \\exp\\left(-\\sum_{i=1}^{P} \\left[ \\frac{mP}{2\\beta\\hbar^2}(q_{i+1}-q_i)^2 + \\frac{\\beta}{P}V(q_i) \\right] \\right)$$\n其中 $q_{P+1} \\equiv q_1$ 强制环闭合。在我们的约化单位制（$\\hbar=1$）和諧波勢 $V(q) = \\frac{1}{2}m\\omega^2 q^2$ 的情况下，指数的参数变为：\n$$S(\\mathbf{q}) = \\sum_{i=1}^{P} \\left[ \\frac{mP}{2\\beta}(q_{i+1}-q_i)^2 + \\frac{\\beta m\\omega^2}{2P} q_i^2 \\right]$$\n该积分为多维高斯积分。项 $S(\\mathbf{q})$ 可以写成二次型 $S(\\mathbf{q}) = \\frac{1}{2}\\mathbf{q}^T \\mathbf{A} \\mathbf{q}$，其中 $\\mathbf{q} = (q_1, \\ldots, q_P)^T$，$\\mathbf{A}$ 是一个 $P \\times P$ 的对称矩阵。$\\mathbf{A}$ 的元素可通过展开求和得到：\n$$A_{ij} = m \\left[ \\left(\\frac{2P}{\\beta} + \\frac{\\beta\\omega^2}{P}\\right)\\delta_{ij} - \\frac{P}{\\beta}(\\delta_{i,j+1} + \\delta_{i,j-1}) \\right]$$\n其中索引按模 $P$ 计算。这是一个循环矩阵。\n$d$ 维高斯积分的通用公式为 $\\int d^d\\mathbf{x} \\exp(-\\frac{1}{2}\\mathbf{x}^T \\mathbf{M} \\mathbf{x}) = (2\\pi)^{d/2} (\\det \\mathbf{M})^{-1/2}$。将此应用于我们对 $Z_P$ 的积分，得到：\n$$Z_P = \\left(\\frac{mP}{2\\pi\\beta}\\right)^{P/2} (2\\pi)^{P/2} (\\det \\mathbf{A})^{-1/2} = \\left(\\frac{mP}{\\beta}\\right)^{P/2} (\\det \\mathbf{A})^{-1/2} = \\left(\\frac{mP}{\\beta}\\right)^{P/2} m^{-P/2} (\\det \\mathbf{A}')^{-1/2} = \\left(\\frac{P}{\\beta}\\right)^{P/2} (\\det \\mathbf{A}')^{-1/2}$$\n其中 $\\mathbf{A}' = \\mathbf{A}/m$。质量 $m$ 被消去，与精确结果一致。循环矩阵 $\\mathbf{A}'$ 的本征值 $\\lambda_k$ 由其第一行的离散傅里叶变换给出。对于 $k=0, 1, \\dots, P-1$：\n$$\\lambda_k = \\left(\\frac{2P}{\\beta} + \\frac{\\beta\\omega^2}{P}\\right) - \\frac{P}{\\beta}e^{2\\pi i k/P} - \\frac{P}{\\beta}e^{-2\\pi i k/P} = \\left(\\frac{2P}{\\beta} + \\frac{\\beta\\omega^2}{P}\\right) - \\frac{2P}{\\beta}\\cos\\left(\\frac{2\\pi k}{P}\\right)$$\n使用恒等式 $1-\\cos(2\\theta) = 2\\sin^2(\\theta)$，上式可简化为：\n$$\\lambda_k = \\frac{2P}{\\beta} \\left(1 - \\cos\\left(\\frac{2\\pi k}{P}\\right)\\right) + \\frac{\\beta\\omega^2}{P} = \\frac{4P}{\\beta}\\sin^2\\left(\\frac{\\pi k}{P}\\right) + \\frac{\\beta\\omega^2}{P}$$\n行列式是本征值的乘积，$\\det \\mathbf{A}' = \\prod_{k=0}^{P-1} \\lambda_k$。将此代入 $Z_P$ 的表达式，得到最终的可计算公式：\n$$Z_P(\\beta, \\omega) = \\left(\\frac{P}{\\beta}\\right)^{P/2} \\left[ \\prod_{k=0}^{P-1} \\left( \\frac{4P}{\\beta}\\sin^2\\left(\\frac{\\pi k}{P}\\right) + \\frac{\\beta\\omega^2}{P} \\right) \\right]^{-1/2}$$\n对于数值计算，特别是对于大的 $P$，计算 $Z_P$ 的对数更为稳定：\n$$\\log Z_P = \\frac{P}{2} \\log\\left(\\frac{P}{\\beta}\\right) - \\frac{1}{2} \\sum_{k=0}^{P-1} \\log(\\lambda_k)$$\n这个表达式是路径积分公式的直接结果，代表了 PIMC 模拟的目标值。\n\n最后一个要求是分析当 $P$ 增大时 $Z_P$ 收敛到 $Z_{\\mathrm{exact}}$ 的情况。原始特罗特近似引入的误差随珠子数量 $P$ 而变化。我们预期绝对误差存在幂律关系：\n$$|Z_P - Z_{\\mathrm{exact}}| \\approx C P^{-r}$$\n其中 $C$ 是一个常数，$r$ 是收敛指数。为确定 $r$，我们可以对此方程的对数形式进行线性回归：\n$$\\log|Z_P - Z_{\\mathrm{exact}}| \\approx \\log C - r \\log P$$\n这是一个形式为 $y = b + mx$ 的线性方程，其中 $y = \\log|Z_P - Z_{\\mathrm{exact}}|$，$x = \\log P$，斜率 $m = -r$，截距 $b = \\log C$。我们将计算 $P \\in \\{1, 2, 4, 8, 16, 32, 64\\}$ 时的误差，并使用最后四个数据点（$P \\in \\{8, 16, 32, 64\\}$）进行线性最小二乘拟合以提取斜率 $m$。收敛指数则为 $r = -m$。对于此处使用的原始算法，理论上预测 $r=2$。实现部分将为每个测试用例计算此指数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of comparing the exact and path-integral discretized\n    partition functions for a quantum harmonic oscillator.\n    \"\"\"\n\n    # Test cases from the problem statement: (beta, omega)\n    test_cases = [\n        (0.5, 1.0),\n        (1.0, 1.0),\n        (3.0, 1.0),\n        (1.0, 0.5),\n    ]\n\n    # Trotter numbers for the analysis\n    P_values = np.array([1, 2, 4, 8, 16, 32, 64])\n\n    # List to store the final convergence exponents r for each test case\n    convergence_exponents = []\n\n    for beta, omega in test_cases:\n        # 1. Calculate the exact partition function Z_exact\n        # Z_exact = 1 / (2 * sinh(beta * omega / 2))\n        z_exact = 1.0 / (2.0 * np.sinh(beta * omega / 2.0))\n\n        errors = []\n        for P in P_values:\n            # 2. Calculate the discretized path integral partition function Z_P\n            # The formula is derived in the solution text. We compute its logarithm\n            # for numerical stability.\n            # log(Z_P) = (P/2)*log(P/beta) - (1/2)*sum_{k=0}^{P-1}log(lambda_k)\n            # lambda_k = (4P/beta)*sin^2(pi*k/P) + (beta*omega^2)/P\n\n            k_vals = np.arange(P)\n            sin_term = np.sin(np.pi * k_vals / P)**2\n            lambda_k = (4.0 * P / beta) * sin_term + (beta * omega**2 / P)\n            \n            # The logarithm of lambda_k can have -inf if lambda_k is 0,\n            # which does not happen for omega > 0.\n            log_lambda_k_sum = np.sum(np.log(lambda_k))\n\n            log_z_p = (P / 2.0) * np.log(P / beta) - 0.5 * log_lambda_k_sum\n            z_p = np.exp(log_z_p)\n\n            # 3. Compute the absolute error\n            error = np.abs(z_p - z_exact)\n            errors.append(error)\n\n        # 4. Fit the convergence rate r from the last four P values\n        # Model: error = C * P^(-r) => log(error) = log(C) - r * log(P)\n        # We perform a linear fit on log-log data.\n        \n        # Use last four points for the fit: P = {8, 16, 32, 64}\n        fit_P_values = P_values[-4:]\n        fit_errors = np.array(errors[-4:])\n        \n        log_P = np.log(fit_P_values)\n        log_error = np.log(fit_errors)\n\n        # Using numpy's polyfit to find the slope of the linear regression\n        # polyfit returns [slope, intercept] for degree 1\n        slope, _ = np.polyfit(log_P, log_error, 1)\n\n        # The convergence exponent r is the negative of the slope\n        r = -slope\n        convergence_exponents.append(r)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in convergence_exponents)}]\")\n\nsolve()\n```", "id": "2659206"}, {"introduction": "如何高效地在环状聚合物的高维构型空间中进行采样，是 PIMC 模拟中的一个核心挑战。这个练习将介绍一种基于混合蒙特卡洛 (Hybrid Monte Carlo, HMC) 思想的高级采样技巧。通过利用自由环状聚合物（即没有外势）的精确动力学演化来构造提议移动，该方法可以实现对聚合物构型的整体、大步长更新，从而显著提高采样效率。推导此移动的接受概率，将帮助你把统计力学的细致平衡原理与前沿的算法设计思想联系起来 [@problem_id:2659149]。", "problem": "考虑一个质量为 $m$ 的单量子粒子，在一维空间中，逆温度为 $\\beta$，物理势能为 $U(q)$。使用离散化为 $P$ 个虚时间片的费曼路径积分，通过在扩展相空间中的经典同构 $P$-珠环状聚合物来对量子玻尔兹曼分布进行采样，其坐标为 $\\{q_{j}\\}_{j=1}^{P}$，共轭动量为 $\\{p_{j}\\}_{j=1}^{P}$，分布密度与 $\\exp(-\\beta_{P} H_{P})$ 成正比，其中 $\\beta_{P} \\equiv \\beta/P$，哈密顿量为\n$$\nH_{P}(\\boldsymbol{q}, \\boldsymbol{p}) \\equiv \\sum_{j=1}^{P} \\left[ \\frac{p_{j}^{2}}{2 m} + \\frac{1}{2} m \\omega_{P}^{2} \\left(q_{j} - q_{j+1}\\right)^{2} + U(q_{j}) \\right], \\quad \\omega_{P} \\equiv \\frac{P}{\\beta \\hbar},\n$$\n具有循环边界条件 $q_{P+1} \\equiv q_{1}$，$\\hbar$ 为约化普朗克常数。\n\n定义正交简正模变换 $\\boldsymbol{Q} = \\mathbf{C} \\boldsymbol{q}$ 和 $\\boldsymbol{P} = \\mathbf{C} \\boldsymbol{p}$，其中 $\\mathbf{C}$ 将谐波弹簧项对角化，使得自由环状聚合物哈密顿量（动能加弹簧）表示为\n$$\nH_{0}(\\boldsymbol{Q}, \\boldsymbol{P}) \\equiv \\sum_{k=0}^{P-1} \\left[ \\frac{P_{k}^{2}}{2 m} + \\frac{1}{2} m \\Omega_{k}^{2} Q_{k}^{2} \\right], \\quad \\Omega_{0} \\equiv 0,\\quad \\Omega_{k} \\equiv 2 \\omega_{P} \\sin\\left( \\frac{\\pi k}{P} \\right) \\text{ for } k \\in \\{1,\\dots,P-1\\}.\n$$\n\n考虑一个马尔可夫链，其提议是通过以下在简正模空间中的混合蒙特卡洛步骤构建的：\n- 可选择性地从密度与 $\\exp\\!\\left(-\\beta_{P} \\sum_{k=0}^{P-1} P_{k}^{2}/(2 m)\\right)$ 成正比的麦克斯韦-玻尔兹曼分布中刷新 $\\boldsymbol{P}$ 的部分或全部​​分量。\n- 在由 $H_{0}$ 产生的哈密顿流下，将 $(\\boldsymbol{Q}, \\boldsymbol{P})$ 确定性地传播一个固定的时间 $\\tau$，在每个简正模中精确且独立地进行，以获得 $(\\boldsymbol{Q}', \\boldsymbol{P}')$。然后变换回珠空间 $(\\boldsymbol{q}', \\boldsymbol{p}') = (\\mathbf{C}^{\\mathsf{T}} \\boldsymbol{Q}', \\mathbf{C}^{\\mathsf{T}} \\boldsymbol{P}')$。\n- 针对与 $\\exp(-\\beta_{P} H_{P})$ 成正比的目标密度，应用一个 Metropolis–Hastings 接受/拒绝步骤。\n\n从马尔可夫链的细致平衡原理、精确自由环状聚合物传播的辛性、时间可逆性和保体积性，以及 $H_{0}$ 在提议期间是精确的运动常数这一事实出发，推导使目标密度保持不变所需的 Metropolis–Hastings 接受概率 $\\alpha\\!\\left((\\boldsymbol{q}, \\boldsymbol{p}) \\to (\\boldsymbol{q}', \\boldsymbol{p}')\\right)$。将你的最终答案表示为一个闭式解析表达式，其中包含 $\\beta$、$P$ 以及在提议前和提议后构型下计算的物理势能之和 $\\sum_{j=1}^{P} U(q_{j})$。不需要数值近似或四舍五入。你的答案必须是一个单一的解析表达式。", "solution": "该问题要求推导特定混合蒙特卡洛移动的 Metropolis–Hastings 接受概率，该移动旨在通过经典环状聚合物同构表示法来对粒子的量子玻尔兹曼分布进行采样。环状聚合物的状态由其珠坐标 $\\boldsymbol{q} = \\{q_{j}\\}_{j=1}^{P}$ 和共轭动量 $\\boldsymbol{p} = \\{p_{j}\\}_{j=1}^{P}$ 指定，其目标概率密度为 $\\pi(\\boldsymbol{q}, \\boldsymbol{p}) \\propto \\exp(-\\beta_{P} H_{P}(\\boldsymbol{q}, \\boldsymbol{p}))$。\n\n任何保持目标分布不变的马尔可夫链蒙特卡洛算法的基石是细致平衡原理。对于从状态 $x = (\\boldsymbol{q}, \\boldsymbol{p})$ 到状态 $x' = (\\boldsymbol{q}', \\boldsymbol{p}')$ 的转移，其转移核为 $K(x'|x)$，细致平衡要求：\n$$\n\\pi(x) K(x'|x) = \\pi(x') K(x|x')\n$$\n转移核由提议分布 $g(x'|x)$ 和接受概率 $\\alpha(x \\to x')$ 组成：$K(x'|x) = g(x'|x) \\alpha(x \\to x')$。将此代入细致平衡方程，得到：\n$$\n\\pi(x) g(x'|x) \\alpha(x \\to x') = \\pi(x') g(x|x') \\alpha(x' \\to x)\n$$\n这导出了 Metropolis–Hastings 接受概率的标准形式：\n$$\n\\alpha(x \\to x') = \\min \\left( 1, \\frac{\\pi(x') g(x|x')}{\\pi(x) g(x'|x)} \\right)\n$$\n在我们的情况下，状态是 $x = (\\boldsymbol{q}, \\boldsymbol{p})$，目标分布是 $\\pi(\\boldsymbol{q}, \\boldsymbol{p}) = Z^{-1} \\exp(-\\beta_{P} H_{P}(\\boldsymbol{q}, \\boldsymbol{p}))$，其中 $Z$ 是配分函数。因此，比率 $\\pi(x')/\\pi(x)$ 为：\n$$\n\\frac{\\pi(x')}{\\pi(x)} = \\frac{\\exp(-\\beta_{P} H_{P}(\\boldsymbol{q}', \\boldsymbol{p}'))}{\\exp(-\\beta_{P} H_{P}(\\boldsymbol{q}, \\boldsymbol{p}))} = \\exp(-\\beta_{P} [H_{P}(\\boldsymbol{q}', \\boldsymbol{p}') - H_{P}(\\boldsymbol{q}, \\boldsymbol{p})])\n$$\n接下来，我们必须分析提议分布 $g(x'|x)$。问题陈述了提议 $x \\to x'$ 是由在自由环状聚合物哈密顿量 $H_{0}$ 的哈密顿流下，进行时间为 $\\tau$ 的确定性传播生成的。我们将这个确定性映射表示为 $\\Phi_{\\tau}$。因此，$x' = \\Phi_{\\tau}(x)$。\n\n对于一个确定性移动，提议分布是一个狄拉克δ函数：$g(x'|x) = \\delta(x' - \\Phi_{\\tau}(x))$。反向提议 $x' \\to x$ 对应于传播时间 $-\\tau$，所以 $x = \\Phi_{-\\tau}(x')$ 且 $g(x|x') = \\delta(x - \\Phi_{-\\tau}(x'))$。在接受概率比率的背景下，这些δ函数的比率计算为正向和反向移动之间坐标变换的雅可比行列式。\n\n问题明确指出，传播是基于哈密顿方程的，它生成一个辛映射。根据刘维尔定理，辛映射的一个基本性质是它们在相空间中是保体积的。这意味着变换 $\\Phi_{\\tau}$ 的雅可比行列式为1。这同样适用于往返于简正模的中间变换，因为它是一个线性正交变换。因此，从 $(\\boldsymbol{q}, \\boldsymbol{p})$ 到 $(\\boldsymbol{q}', \\boldsymbol{p}')$ 的完整提议映射的雅可比行列式为 $1$。这意味着提议密度的比率也为1：\n$$\n\\frac{g(x|x')}{g(x'|x)} = 1\n$$\n这种简化是传播的“辛性、时间可逆性和保体积性”的直接结果，正如问题陈述中所提到的。\n\n通过这种简化，接受概率简化为 Metropolis 形式：\n$$\n\\alpha(x \\to x') = \\min \\left( 1, \\frac{\\pi(x')}{\\pi(x)} \\right) = \\min \\left( 1, \\exp(-\\beta_{P} [H_{P}(\\boldsymbol{q}', \\boldsymbol{p}') - H_{P}(\\boldsymbol{q}, \\boldsymbol{p})]) \\right)\n$$\n现在，我们必须评估总哈密顿量的变化，$\\Delta H_{P} = H_{P}(\\boldsymbol{q}', \\boldsymbol{p}') - H_{P}(\\boldsymbol{q}, \\boldsymbol{p})$。总哈密顿量定义为自由环状聚合物哈密顿量 $H_{0}$ 和物理势能之和 $V_{phys}(\\boldsymbol{q})$ 的总和。在珠子表示中，这是：\n$$\nH_{P}(\\boldsymbol{q}, \\boldsymbol{p}) = \\underbrace{\\sum_{j=1}^{P} \\left[ \\frac{p_{j}^{2}}{2 m} + \\frac{1}{2} m \\omega_{P}^{2} \\left(q_{j} - q_{j+1}\\right)^{2} \\right]}_{H_{0}(\\boldsymbol{q}, \\boldsymbol{p})} + \\underbrace{\\sum_{j=1}^{P} U(q_{j})}_{V_{phys}(\\boldsymbol{q})}\n$$\n$H_{P}$ 的变化是：\n$$\n\\Delta H_{P} = [H_{0}(\\boldsymbol{q}', \\boldsymbol{p}') + V_{phys}(\\boldsymbol{q}')] - [H_{0}(\\boldsymbol{q}, \\boldsymbol{p}) + V_{phys}(\\boldsymbol{q})]\n$$\n一个关键信息是，提议轨迹是在哈密顿量 $H_{0}$ 下的精确传播。哈密顿动力学的一个性质是，生成流的哈密顿量是一个精确的运动常数。因此，沿着从 $(\\boldsymbol{q}, \\boldsymbol{p})$ 到 $(\\boldsymbol{q}', \\boldsymbol{p}')$ 的轨迹，$H_0$ 的值是守恒的：\n$$\nH_{0}(\\boldsymbol{q}', \\boldsymbol{p}') = H_{0}(\\boldsymbol{q}, \\boldsymbol{p})\n$$\n因此，$\\Delta H_{P}$ 表达式中涉及 $H_{0}$ 的项相互抵消，只留下物理势能部分的变化：\n$$\n\\Delta H_{P} = V_{phys}(\\boldsymbol{q}') - V_{phys}(\\boldsymbol{q}) = \\sum_{j=1}^{P} U(q'_{j}) - \\sum_{j=1}^{P} U(q_{j})\n$$\n将此结果代回接受概率的表达式中，我们得到：\n$$\n\\alpha \\!\\left( (\\boldsymbol{q}, \\boldsymbol{p}) \\to (\\boldsymbol{q}', \\boldsymbol{p}') \\right) = \\min \\left( 1, \\exp \\left( -\\beta_{P} \\left[ \\sum_{j=1}^{P} U(q'_{j}) - \\sum_{j=1}^{P} U(q_{j}) \\right] \\right) \\right)\n$$\n最后，我们代入定义 $\\beta_{P} \\equiv \\beta/P$ 以获得用给定参数表示的最终表达式：\n$$\n\\alpha = \\min \\left( 1, \\exp \\left( -\\frac{\\beta}{P} \\left[ \\sum_{j=1}^{P} U(q'_{j}) - \\sum_{j=1}^{P} U(q_{j}) \\right] \\right) \\right)\n$$\n这就是所求的 Metropolis–Hastings 接受概率。问题中提到的可选的动量刷新，不影响单个确定性步骤的推导，但对于确保整个马尔可夫链的遍历性至关重要。", "answer": "$$\n\\boxed{\\min\\left(1, \\exp\\left(-\\frac{\\beta}{P} \\left( \\sum_{j=1}^{P} U(q'_{j}) - \\sum_{j=1}^{P} U(q_{j}) \\right)\\right)\\right)}\n$$", "id": "2659149"}]}