{"hands_on_practices": [{"introduction": "任何密度泛函理论计算的基石都是求解平衡密度分布。我们将从推导作为理论核心的自洽场方程开始。这个练习 [@problem_id:2763947] 将展示变分原理如何转化为一个实用但复杂的方程，为所有数值求解奠定理论基础。", "problem": "考虑一个在经典密度泛函理论 (cDFT) 框架下描述的单组分经典流体。其内禀亥姆霍兹 (Helmholtz) 自由能泛函分解为 $F[n]=F_{\\text{id}}[n]+F_{\\text{hs}}[n]+F_{\\text{att}}[n]$，其中理想气体贡献为 $F_{\\text{id}}[n]=k_B T\\int d\\mathbf{r}\\,n(\\mathbf{r})\\left[\\ln\\!\\left(\\Lambda^{3}n(\\mathbf{r})\\right)-1\\right]$，$\\Lambda$ 是热德布罗意 (de Broglie) 波长；硬球过剩贡献 $F_{\\text{hs}}[n]$ 是一个未知但良定义的泛函；平均场吸引贡献为 $F_{\\text{att}}[n]=\\frac{1}{2}\\int d\\mathbf{r}\\,d\\mathbf{r}'\\,n(\\mathbf{r})\\,n(\\mathbf{r}')\\,u_{\\text{att}}(|\\mathbf{r}-\\mathbf{r}'|)$，其中 $u_{\\text{att}}(r)$ 是给定的成对吸引势。该系统处于给定的外场 $V_{\\text{ext}}(\\mathbf{r})$ 中，温度 $T$ 和化学势 $\\mu$ 保持不变。\n\n从变分原理出发，即平衡密度分布 $n(\\mathbf{r})$ 使巨势泛函 $\\Omega[n]=F[n]+\\int d\\mathbf{r}\\,n(\\mathbf{r})\\left(V_{\\text{ext}}(\\mathbf{r})-\\mu\\right)$ 最小化，推导欧拉-拉格朗日 (Euler–Lagrange) 平稳性条件，并将其重排，以获得关于 $n(\\mathbf{r})$ 的显式自洽积分方程。\n\n将您的最终结果表示为显式的闭合形式泛函表达式 $G[n](\\mathbf{r})$，使得 $n(\\mathbf{r})=G[n](\\mathbf{r})$。仅报告用 $\\mu$、$T$、$\\Lambda$、$V_{\\text{ext}}(\\mathbf{r})$、$u_{\\text{att}}(r)$ 以及泛函导数 $\\delta F_{\\text{hs}}[n]/\\delta n(\\mathbf{r})$ 表示的 $G[n](\\mathbf{r})$ 的表达式。最终答案中不要包含等号。在您的推导过程中明确定义 $\\beta=1/(k_B T)$。不需要进行数值计算。", "solution": "问题陈述已经过严格验证。\n\n**步骤 1：提取已知条件**\n- **系统**：单组分经典流体。\n- **框架**：经典密度泛函理论 (cDFT)。\n- **内禀亥姆霍兹自由能泛函**：$F[n]=F_{\\text{id}}[n]+F_{\\text{hs}}[n]+F_{\\text{att}}[n]$。\n- **理想气体贡献**：$F_{\\text{id}}[n]=k_B T\\int d\\mathbf{r}\\,n(\\mathbf{r})\\left[\\ln\\!\\left(\\Lambda^{3}n(\\mathbf{r})\\right)-1\\right]$，其中 $\\Lambda$ 是热德布罗意波长。\n- **硬球过剩贡献**：$F_{\\text{hs}}[n]$，一个未指定的泛函。\n- **平均场吸引贡献**：$F_{\\text{att}}[n]=\\frac{1}{2}\\int d\\mathbf{r}\\,d\\mathbf{r}'\\,n(\\mathbf{r})\\,n(\\mathbf{r}')\\,u_{\\text{att}}(|\\mathbf{r}-\\mathbf{r}'|)$，其中 $u_{\\text{att}}(r)$ 是给定的吸引势。\n- **热力学条件**：系统处于恒定温度 $T$ 和化学势 $\\mu$。\n- **外场**：$V_{\\text{ext}}(\\mathbf{r})$。\n- **巨势泛函**：$\\Omega[n]=F[n]+\\int d\\mathbf{r}\\,n(\\mathbf{r})\\left(V_{\\text{ext}}(\\mathbf{r})-\\mu\\right)$。\n- **变分原理**：平衡密度分布 $n(\\mathbf{r})$ 使 $\\Omega[n]$ 最小化。\n- **任务**：从变分原理推导欧拉-拉格朗日方程，并将其表示为自洽方程 $n(\\mathbf{r})=G[n](\\mathbf{r})$。\n- **输出要求**：报告 $G[n](\\mathbf{r})$ 的泛函表达式。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据**：该问题是经典密度泛函理论这一成熟领域中的一个标准、基础的推导。所有定义和原理都是正确的。\n- **良定性**：问题陈述清晰，推导所需的所有信息均已提供。目标是推导一种已知类型的方程，该方程具有唯一的形式结构。\n- **客观性**：问题是用精确、客观和科学的语言表述的。\n\n**步骤 3：结论与行动**\n该问题在科学上是合理的、良定的、客观的，并且不包含任何模糊或矛盾之处。判定为**有效**。我们继续进行求解。\n\n平衡密度分布 $n(\\mathbf{r})$ 是使巨势泛函 $\\Omega[n]$ 最小化的函数。该条件由欧拉-拉格朗日方程表示，即在平衡状态下，$\\Omega[n]$ 对 $n(\\mathbf{r})$ 的泛函导数必须为零：\n$$\n\\frac{\\delta \\Omega[n]}{\\delta n(\\mathbf{r})} = 0\n$$\n巨势泛函由下式给出：\n$$\n\\Omega[n] = F_{\\text{id}}[n] + F_{\\text{hs}}[n] + F_{\\text{att}}[n] + \\int d\\mathbf{r}'\\, n(\\mathbf{r}') V_{\\text{ext}}(\\mathbf{r}') - \\mu \\int d\\mathbf{r}'\\, n(\\mathbf{r}')\n$$\n我们计算每一项对 $n(\\mathbf{r})$ 的泛函导数。为避免混淆，积分变量用撇号 $\\mathbf{r}'$ 表示。\n\n1.  **理想气体项**，$F_{\\text{id}}[n]$：\n    该泛函为 $F_{\\text{id}}[n] = \\int d\\mathbf{r}'\\, f(n(\\mathbf{r}'))$，其中自由能密度为 $f(n) = k_B T\\left(n\\ln(\\Lambda^{3}n) - n\\right)$。其泛函导数是被积函数对 $n$ 的偏导数，在 $n=n(\\mathbf{r})$ 处取值：\n    $$\n    \\frac{\\delta F_{\\text{id}}[n]}{\\delta n(\\mathbf{r})} = \\frac{d}{dn}\\left[k_B T\\left(n\\ln(\\Lambda^{3}n) - n\\right)\\right]_{n=n(\\mathbf{r})} = k_B T\\left[ \\ln(\\Lambda^{3}n(\\mathbf{r})) + n(\\mathbf{r})\\frac{\\Lambda^{3}}{n(\\mathbf{r})\\Lambda^{3}} - 1 \\right] = k_B T \\ln(\\Lambda^{3}n(\\mathbf{r}))\n    $$\n\n2.  **硬球项**，$F_{\\text{hs}}[n]$：\n    由于该泛函未明确给出，其泛函导数按要求保持符号形式：$\\frac{\\delta F_{\\text{hs}}[n]}{\\delta n(\\mathbf{r})}$。\n\n3.  **吸引项**，$F_{\\text{att}}[n]$：\n    该泛函为 $F_{\\text{att}}[n]=\\frac{1}{2}\\int d\\mathbf{r}'\\,d\\mathbf{r}''\\,n(\\mathbf{r}')\\,n(\\mathbf{r}'')\\,u_{\\text{att}}(|\\mathbf{r}'-\\mathbf{r}''|)$。由于被积函数关于 $\\mathbf{r}'$ 和 $\\mathbf{r}''$ 的交换具有对称性，其泛函导数为：\n    $$\n    \\frac{\\delta F_{\\text{att}}[n]}{\\delta n(\\mathbf{r})} = \\int d\\mathbf{r}'\\, n(\\mathbf{r}')\\, u_{\\text{att}}(|\\mathbf{r}-\\mathbf{r}'|)\n    $$\n\n4.  **外势项**：\n    $$\n    \\frac{\\delta}{\\delta n(\\mathbf{r})} \\int d\\mathbf{r}'\\, n(\\mathbf{r}') V_{\\text{ext}}(\\mathbf{r}') = \\int d\\mathbf{r}'\\, V_{\\text{ext}}(\\mathbf{r}') \\frac{\\delta n(\\mathbf{r}')}{\\delta n(\\mathbf{r})} = \\int d\\mathbf{r}'\\, V_{\\text{ext}}(\\mathbf{r}') \\delta(\\mathbf{r}' - \\mathbf{r}) = V_{\\text{ext}}(\\mathbf{r})\n    $$\n\n5.  **化学势项**：\n    $$\n    \\frac{\\delta}{\\delta n(\\mathbf{r})} \\left[ -\\mu \\int d\\mathbf{r}'\\, n(\\mathbf{r}') \\right] = -\\mu \\int d\\mathbf{r}'\\, \\frac{\\delta n(\\mathbf{r}')}{\\delta n(\\mathbf{r})} = -\\mu \\int d\\mathbf{r}'\\, \\delta(\\mathbf{r}' - \\mathbf{r}) = -\\mu\n    $$\n综合这些结果，得到欧拉-拉格朗日方程：\n$$\nk_B T \\ln(\\Lambda^{3}n(\\mathbf{r})) + \\frac{\\delta F_{\\text{hs}}[n]}{\\delta n(\\mathbf{r})} + \\int d\\mathbf{r}'\\,n(\\mathbf{r}')\\,u_{\\text{att}}(|\\mathbf{r}-\\mathbf{r}'|) + V_{\\text{ext}}(\\mathbf{r}) - \\mu = 0\n$$\n为了获得关于 $n(\\mathbf{r})$ 的自洽方程，我们重排此平稳性条件以分离出 $n(\\mathbf{r})$。首先，我们分离对数项：\n$$\nk_B T \\ln(\\Lambda^{3}n(\\mathbf{r})) = \\mu - V_{\\text{ext}}(\\mathbf{r}) - \\frac{\\delta F_{\\text{hs}}[n]}{\\delta n(\\mathbf{r})} - \\int d\\mathbf{r}'\\,n(\\mathbf{r}')\\,u_{\\text{att}}(|\\mathbf{r}-\\mathbf{r}'|)\n$$\n我们定义逆温度 $\\beta = \\frac{1}{k_B T}$。两边同除以 $k_B T$ 得：\n$$\n\\ln(\\Lambda^{3}n(\\mathbf{r})) = \\beta \\left[ \\mu - V_{\\text{ext}}(\\mathbf{r}) - \\frac{\\delta F_{\\text{hs}}[n]}{\\delta n(\\mathbf{r})} - \\int d\\mathbf{r}'\\,n(\\mathbf{r}')\\,u_{\\text{att}}(|\\mathbf{r}-\\mathbf{r}'|) \\right]\n$$\n对两边取指数得：\n$$\n\\Lambda^{3}n(\\mathbf{r}) = \\exp\\left( \\beta \\left[ \\mu - V_{\\text{ext}}(\\mathbf{r}) - \\frac{\\delta F_{\\text{hs}}[n]}{\\delta n(\\mathbf{r})} - \\int d\\mathbf{r}'\\,n(\\mathbf{r}')\\,u_{\\text{att}}(|\\mathbf{r}-\\mathbf{r}'|) \\right] \\right)\n$$\n最后，解出 $n(\\mathbf{r})$，得到所需形式为 $n(\\mathbf{r}) = G[n](\\mathbf{r})$ 的自洽积分方程，其中泛函 $G[n](\\mathbf{r})$ 为：\n$$\nG[n](\\mathbf{r}) = \\frac{1}{\\Lambda^{3}} \\exp\\left( \\beta \\left[ \\mu - V_{\\text{ext}}(\\mathbf{r}) - \\frac{\\delta F_{\\text{hs}}[n]}{\\delta n(\\mathbf{r})} - \\int d\\mathbf{r}'\\,n(\\mathbf{r}')\\,u_{\\text{att}}(|\\mathbf{r}-\\mathbf{r}'|) \\right] \\right)\n$$\n这就是问题所要求的最终表达式。", "answer": "$$\n\\boxed{\\frac{1}{\\Lambda^{3}} \\exp\\left( \\beta \\left( \\mu - V_{\\text{ext}}(\\mathbf{r}) - \\frac{\\delta F_{\\text{hs}}[n]}{\\delta n(\\mathbf{r})} - \\int d\\mathbf{r}'\\,n(\\mathbf{r}')\\,u_{\\text{att}}(|\\mathbf{r}-\\mathbf{r}'|) \\right) \\right)}\n$$", "id": "2763947"}, {"introduction": "掌握了一般方程之后，我们现在转向一个具体而强大的泛函：用于硬球体系的 Rosenfeld 基本测量理论 (FMT)。这个练习 [@problem_id:2763877] 将指导你处理 FMT 的非局域性，并针对具有平面几何对称性的系统——这是研究界面的常见情景——简化其加权密度。这是模拟真实非均匀流体的一项关键技能。", "problem": "考虑一个单组分硬球流体，其粒子直径为 $\\sigma$，绝对温度为 $T$，化学势为 $\\mu$。该流体被一个位于 $z=0$ 的平面硬壁所限制。当 $z<0$ 时，外势为 $V_{\\mathrm{ext}}(z)=+\\infty$；当 $z\\ge 0$ 时，外势为 $V_{\\mathrm{ext}}(z)=0$。由于存在平面对称性，局域数密度为 $n(\\mathbf{r})=n(z)$。巨势泛函为\n$$\n\\Omega[n] \\;=\\; F_{\\mathrm{id}}[n] \\;+\\; F_{\\mathrm{ex}}[n] \\;+\\; \\int d\\mathbf{r}\\, n(\\mathbf{r})\\big(V_{\\mathrm{ext}}(\\mathbf{r})-\\mu\\big),\n$$\n其中理想气体亥姆霍兹自由能泛函为\n$$\nF_{\\mathrm{id}}[n] \\;=\\; k_B T \\int d\\mathbf{r}\\, n(\\mathbf{r})\\Big(\\ln\\!\\big(\\Lambda^{3}n(\\mathbf{r})\\big)-1\\Big),\n$$\n其中 $\\Lambda$ 是热德布罗意波长，过量部分由 Rosenfeld 的基本度量理论 (FMT) 给出：\n$$\nF_{\\mathrm{ex}}[n] \\;=\\; k_B T \\int d\\mathbf{r}\\, \\Phi\\big(\\{n_{\\alpha}(\\mathbf{r})\\}\\big),\n$$\n其过量自由能密度为\n$$\n\\Phi \\;=\\; -n_{0}\\,\\ln(1-n_{3}) \\;+\\; \\frac{n_{1}n_{2}-\\vec{n}_{1}\\!\\cdot\\!\\vec{n}_{2}}{1-n_{3}}\n\\;+\\; \\frac{n_{2}^{3}-3n_{2}\\,\\vec{n}_{2}\\!\\cdot\\!\\vec{n}_{2}}{24\\pi\\,(1-n_{3})^{2}}.\n$$\n加权密度由卷积定义为 $n_{\\alpha}(\\mathbf{r})=\\int d\\mathbf{r}'\\,n(\\mathbf{r}')\\,w_{\\alpha}(\\mathbf{r}-\\mathbf{r}')$，其中硬球权重半径为 $R\\equiv \\sigma/2$：\n$$\nw_{3}(\\mathbf{r})=\\Theta(R-|\\mathbf{r}|),\\quad w_{2}(\\mathbf{r})=\\delta(R-|\\mathbf{r}|),\\quad w_{1}(\\mathbf{r})=\\frac{w_{2}(\\mathbf{r})}{4\\pi R},\\quad w_{0}(\\mathbf{r})=\\frac{w_{2}(\\mathbf{r})}{4\\pi R^{2}},\n$$\n$$\n\\vec{w}_{2}(\\mathbf{r})=\\hat{\\mathbf{r}}\\,\\delta(R-|\\mathbf{r}|),\\quad \\vec{w}_{1}(\\mathbf{r})=\\frac{\\vec{w}_{2}(\\mathbf{r})}{4\\pi R},\n$$\n其中 $\\Theta$ 是亥维赛阶跃函数，$\\delta$ 是狄拉克δ函数，且 $\\hat{\\mathbf{r}}=\\mathbf{r}/|\\mathbf{r}|$。\n\n仅从这些定义和平衡的变分原理 $\\delta\\Omega/\\delta n(z)=0$ 出发，完成以下任务：\n\n1. 利用平面对称性，将定义 $n_{\\alpha}(z)$ 的每个卷积简化为对 $z'$ 的一维积分，其核函数显式地依赖于 $\\Delta z\\equiv z-z'$ 和 $R$。计算所有六个平面加权密度：$n_{3}(z)$、$n_{2}(z)$、$n_{1}(z)$、$n_{0}(z)$、$n_{v2,z}(z)$ 和 $n_{v1,z}(z)$，其中 $n_{v\\ell,z}$ 表示矢量加权密度 $\\vec{n}_{\\ell}$ 的 $z$ 分量。\n\n2. 通过计算泛函导数 $\\delta F_{\\mathrm{ex}}/\\delta n(z)$，写出在半空间 $z\\ge 0$ 中平衡分布 $n(z)$ 的显式欧拉-拉格朗日 (EL) 方程。此方程需用您在第1部分中得到的平面加权密度和一维核函数来表示。将您最终的 $n(z)$ 的 EL 方程表示为闭合形式，仅包含 $n(z)$、一维核函数以及在 $z'$ 处求值的函数 $\\partial \\Phi/\\partial n_{\\alpha}$，其中 $\\beta\\equiv 1/(k_B T)$。请勿进行任何数值近似。\n\n您的最终答案必须是一个闭合形式的解析表达式。如果您选择提供多个表达式，请将它们作为单行矩阵的条目来呈现。不需要进行数值计算。", "solution": "该问题需要经过验证。\n\n### 第1步：提取已知条件\n- **系统**：一个单组分硬球流体，粒子直径为 $\\sigma$，绝对温度为 $T$，化学势为 $\\mu$。\n- **限制条件**：位于 $z=0$ 的平面硬壁，当 $z0$ 时外势为 $V_{\\mathrm{ext}}(z)=+\\infty$，当 $z\\ge 0$ 时外势为 $V_{\\mathrm{ext}}(z)=0$。\n- **对称性**：平面对称性，因此数密度 $n(\\mathbf{r})=n(z)$。\n- **巨势泛函**：$\\Omega[n] = F_{\\mathrm{id}}[n] + F_{\\mathrm{ex}}[n] + \\int d\\mathbf{r}\\, n(\\mathbf{r})\\big(V_{\\mathrm{ext}}(\\mathbf{r})-\\mu\\big)$。\n- **理想气体自由能泛函**：$F_{\\mathrm{id}}[n] = k_B T \\int d\\mathbf{r}\\, n(\\mathbf{r})\\Big(\\ln\\!\\big(\\Lambda^{3}n(\\mathbf{r})\\big)-1\\Big)$, 其中 $\\Lambda$ 是热德布罗意波长。\n- **过量自由能泛函 (FMT)**：$F_{\\mathrm{ex}}[n] = k_B T \\int d\\mathbf{r}\\, \\Phi\\big(\\{n_{\\alpha}(\\mathbf{r})\\}\\big)$。\n- **过量自由能密度**：$\\Phi = -n_{0}\\,\\ln(1-n_{3}) + \\frac{n_{1}n_{2}-\\vec{n}_{1}\\!\\cdot\\!\\vec{n}_{2}}{1-n_{3}} + \\frac{n_{2}^{3}-3n_{2}\\,\\vec{n}_{2}\\!\\cdot\\!\\vec{n}_{2}}{24\\pi\\,(1-n_{3})^{2}}$。\n- **加权密度**：$n_{\\alpha}(\\mathbf{r})=\\int d\\mathbf{r}'\\,n(\\mathbf{r}')\\,w_{\\alpha}(\\mathbf{r}-\\mathbf{r}')$。\n- **权重函数**：半径为 $R\\equiv \\sigma/2$：\n  - $w_{3}(\\mathbf{r})=\\Theta(R-|\\mathbf{r}|)$\n  - $w_{2}(\\mathbf{r})=\\delta(R-|\\mathbf{r}|)$\n  - $w_{1}(\\mathbf{r})=\\frac{w_{2}(\\mathbf{r})}{4\\pi R}$\n  - $w_{0}(\\mathbf{r})=\\frac{w_{2}(\\mathbf{r})}{4\\pi R^{2}}$\n  - $\\vec{w}_{2}(\\mathbf{r})=\\hat{\\mathbf{r}}\\,\\delta(R-|\\mathbf{r}|)$, 其中 $\\hat{\\mathbf{r}}=\\mathbf{r}/|\\mathbf{r}|$\n  - $\\vec{w}_{1}(\\mathbf{r})=\\frac{\\vec{w}_{2}(\\mathbf{r})}{4\\pi R}$\n- **任务**：\n  1. 对于平面对称性，将六个加权密度的卷积简化为一维积分。\n  2. 推导在 $z \\geq 0$ 区域的平衡密度分布 $n(z)$ 的欧拉-拉格朗日方程。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据**：该问题是经典密度泛函理论的一个标准应用，特别是针对硬球的 Rosenfeld 基本度量理论 (FMT)。所有原理、定义和泛函形式在非均匀流体统计力学领域都是公认的。\n- **适定性**：该问题在数学上是适定的。它要求基于给定的理论框架推导出特定的解析表达式。该推导存在唯一解。\n- **客观性**：该问题使用精确、形式化的语言和数学定义进行陈述，没有任何主观性或模糊性。\n- **完整性**：为执行所需的推导，提供了所有必要的定义和方程。该问题是自洽的。\n- **其他缺陷**：该问题并非无关紧要、不切实际或结构不良。它不违反任何其他无效性标准。\n\n### 第3步：结论与行动\n该问题是**有效的**。将提供解答。\n\n***\n\n根据题目要求，解题过程分为两部分。\n\n### 第1部分：平面加权密度\n\n加权密度 $n_{\\alpha}(\\mathbf{r})$ 由三维卷积 $n_{\\alpha}(\\mathbf{r}) = \\int d\\mathbf{r}'\\,n(\\mathbf{r}')\\,w_{\\alpha}(\\mathbf{r}-\\mathbf{r}')$ 定义。鉴于平面对称性，密度仅依赖于 $z$ 坐标，$n(\\mathbf{r}) = n(z)$。加权密度也将表现出这种对称性，$n_{\\alpha}(\\mathbf{r}) = n_{\\alpha}(z)$。不失一般性，我们可以在点 $\\mathbf{r}=(0,0,z)$ 处计算卷积。\n$$\nn_{\\alpha}(z) = \\int_{-\\infty}^{\\infty} dz' \\, n(z') \\int_{-\\infty}^{\\infty} dx' \\int_{-\\infty}^{\\infty} dy' \\, w_{\\alpha}(-x', -y', z-z')\n$$\n我们为 $xy$ 平面内的积分引入柱坐标：$x' = \\rho' \\cos\\phi'$, $y' = \\rho' \\sin\\phi'$, $dx'dy' = \\rho' d\\rho' d\\phi'$。令 $\\Delta z = z-z'$。权重函数的自变量变为 $|\\mathbf{r}-\\mathbf{r}'| = \\sqrt{\\rho'^2 + (\\Delta z)^2}$。权重函数 $w_\\alpha$ 仅依赖于 $|\\mathbf{r}-\\mathbf{r}'|$ 或沿 $\\mathbf{r}-\\mathbf{r}'$ 方向。对 $\\phi'$ 从 $0$ 到 $2\\pi$ 积分得到一个因子 $2\\pi$。\n卷积简化为对 $z'$ 的一维积分：\n$$\nn_{\\alpha}(z) = \\int_{-\\infty}^{\\infty} dz' \\, n(z') \\, k_{\\alpha}(z-z')\n$$\n其中 $k_{\\alpha}(\\Delta z)$ 是一维核函数。\n\n对于标量权重 $w_3, w_2, w_1, w_0$：\n$$\nk_{\\alpha}(\\Delta z) = 2\\pi \\int_0^{\\infty} d\\rho' \\, \\rho' \\, w_{\\alpha}\\left(\\sqrt{\\rho'^2 + (\\Delta z)^2}\\right)\n$$\n对于矢量权重 $\\vec{w}_2, \\vec{w}_1$，对称性决定了只有加权密度的 $z$ 分量 $n_{v2,z}(z)$ 和 $n_{v1,z}(z)$ 不为零。$\\vec{w}_{\\ell}(\\mathbf{r}-\\mathbf{r}')$ 的 $z$ 分量是 $w_{v\\ell,z}(\\mathbf{r}-\\mathbf{r}') = \\frac{z-z'}{|\\mathbf{r}-\\mathbf{r}'|} \\times (\\text{标量部分})$。核函数变为：\n$$\nk_{v\\ell,z}(\\Delta z) = 2\\pi \\int_0^{\\infty} d\\rho' \\, \\rho' \\, \\frac{\\Delta z}{\\sqrt{\\rho'^2+(\\Delta z)^2}} \\times (\\text{scalar part of } w_{v\\ell})\n$$\n现在我们使用换元法 $u = \\sqrt{\\rho'^2+(\\Delta z)^2}$ 计算每个核函数，这意味着 $u\\,du = \\rho'\\,d\\rho'$。积分范围从 $|\\Delta z|$ 变为 $\\infty$。\n\n- **对于 $n_3(z)$**: $w_3(\\mathbf{r}) = \\Theta(R-|\\mathbf{r}|)$。\n$k_3(\\Delta z) = 2\\pi \\int_{|\\Delta z|}^{\\infty} du \\, u \\, \\Theta(R-u) = 2\\pi \\int_{|\\Delta z|}^{R} du \\, u \\cdot \\Theta(R-|\\Delta z|) = 2\\pi \\left[\\frac{u^2}{2}\\right]_{|\\Delta z|}^{R} \\Theta(R-|\\Delta z|) = \\pi(R^2 - (\\Delta z)^2)\\Theta(R-|\\Delta z|)$。\n\n- **对于 $n_2(z)$**: $w_2(\\mathbf{r}) = \\delta(R-|\\mathbf{r}|)$。\n$k_2(\\Delta z) = 2\\pi \\int_{|\\Delta z|}^{\\infty} du \\, u \\, \\delta(R-u) = 2\\pi R \\, \\Theta(R-|\\Delta z|)$。\n\n- **对于 $n_1(z)$**: $w_1(\\mathbf{r}) = w_2(\\mathbf{r})/(4\\pi R)$。\n$k_1(\\Delta z) = k_2(\\Delta z)/(4\\pi R) = \\frac{1}{2}\\Theta(R-|\\Delta z|)$。\n\n- **对于 $n_0(z)$**: $w_0(\\mathbf{r}) = w_2(\\mathbf{r})/(4\\pi R^2)$。\n$k_0(\\Delta z) = k_2(\\Delta z)/(4\\pi R^2) = \\frac{1}{2R}\\Theta(R-|\\Delta z|)$。\n\n- **对于 $n_{v2,z}(z)$**: $\\vec{w}_2(\\mathbf{r}) = \\hat{\\mathbf{r}}\\delta(R-|\\mathbf{r}|)$。所以 $w_{v2,z}(\\mathbf{r}-\\mathbf{r}')=\\frac{z-z'}{|\\mathbf{r}-\\mathbf{r}'|}\\delta(R-|\\mathbf{r}-\\mathbf{r}'|)$。\n$k_{v2,z}(\\Delta z) = 2\\pi \\int_{|\\Delta z|}^{\\infty} du \\, u \\, \\frac{\\Delta z}{u} \\delta(R-u) = 2\\pi \\Delta z \\int_{|\\Delta z|}^{\\infty} du \\, \\delta(R-u) = 2\\pi \\Delta z \\, \\Theta(R-|\\Delta z|)$。\n\n- **对于 $n_{v1,z}(z)$**: $\\vec{w}_1(\\mathbf{r}) = \\vec{w}_2(\\mathbf{r})/(4\\pi R)$。\n$k_{v1,z}(\\Delta z) = k_{v2,z}(\\Delta z)/(4\\pi R) = \\frac{\\Delta z}{2R} \\Theta(R-|\\Delta z|)$。\n\n### 第2部分：欧拉-拉格朗日方程\n\n平衡密度分布 $n(z)$ 使巨势泛函 $\\Omega[n]$ 最小化。这由变分原理 $\\frac{\\delta\\Omega[n]}{\\delta n(\\mathbf{r})} = 0$ 表达。\n$\\Omega[n]$ 各分量的泛函导数是：\n1.  $\\frac{\\delta}{\\delta n(\\mathbf{r})} \\int d\\mathbf{r}' n(\\mathbf{r}')(V_{\\mathrm{ext}}(\\mathbf{r}')-\\mu) = V_{\\mathrm{ext}}(\\mathbf{r}) - \\mu$。\n2.  $\\frac{\\delta F_{\\mathrm{id}}[n]}{\\delta n(\\mathbf{r})} = \\frac{\\delta}{\\delta n(\\mathbf{r})} k_B T \\int d\\mathbf{r}' n(\\mathbf{r}')(\\ln(\\Lambda^3 n(\\mathbf{r}'))-1) = k_B T (\\ln(\\Lambda^3 n(\\mathbf{r}))-1+1) = k_B T \\ln(\\Lambda^3 n(\\mathbf{r}))$。\n3.  $\\frac{\\delta F_{\\mathrm{ex}}[n]}{\\delta n(\\mathbf{r})} = k_B T \\frac{\\delta}{\\delta n(\\mathbf{r})} \\int d\\mathbf{r}' \\Phi(\\{n_\\alpha(\\mathbf{r}')\\}) = k_B T \\int d\\mathbf{r}' \\sum_\\alpha \\frac{\\partial\\Phi(\\mathbf{r}')}{\\partial n_\\alpha(\\mathbf{r}')} \\frac{\\delta n_\\alpha(\\mathbf{r}')}{\\delta n(\\mathbf{r})}$。\n    由于 $n_\\alpha(\\mathbf{r}') = \\int d\\mathbf{r}'' n(\\mathbf{r}'') w_\\alpha(\\mathbf{r}'-\\mathbf{r}'')$，我们有 $\\frac{\\delta n_\\alpha(\\mathbf{r}')}{\\delta n(\\mathbf{r})} = w_\\alpha(\\mathbf{r}'-\\mathbf{r})$。\n    因此，$\\frac{\\delta F_{\\mathrm{ex}}[n]}{\\delta n(\\mathbf{r})} = k_B T \\sum_\\alpha \\int d\\mathbf{r}' \\frac{\\partial\\Phi(\\mathbf{r}')}{\\partial n_\\alpha(\\mathbf{r}')} w_\\alpha(\\mathbf{r}'-\\mathbf{r})$。\n\n应用平面对称性 $n(\\mathbf{r})=n(z)$，$\\partial\\Phi/\\partial n_\\alpha$ 仅依赖于 $z$。我们在 $\\mathbf{r}=(0,0,z)$ 处计算泛函导数：\n$$\n\\frac{\\delta F_{\\mathrm{ex}}[n]}{\\delta n(z)} \\;=\\; k_B T \\sum_{\\alpha} \\int_{-\\infty}^{\\infty} dz' \\frac{\\partial\\Phi(z')}{\\partial n_\\alpha(z')} \\left( \\int dx' dy' \\, w_\\alpha(x',y',z'-z) \\right)\n$$\n对 $x'$ 和 $y'$ 的内层积分恰好是一维核函数 $k_\\alpha(z'-z)$。求和遍及所有标量和矢量分量。对于矢量分量 $\\vec{n}_\\ell$，$\\frac{\\partial\\Phi}{\\partial\\vec{n}_\\ell}\\cdot\\vec{w}_\\ell$ 项根据对称性变为 $\\frac{\\partial\\Phi}{\\partial n_{v\\ell,z}} w_{v\\ell,z}$。因此该公式是普适的。\n\n合并所有项，得到欧拉-拉格朗日 (EL) 方程：\n$$\nk_B T \\ln(\\Lambda^3 n(z)) + V_{\\mathrm{ext}}(z) - \\mu + k_B T \\sum_{\\alpha} \\int_{-\\infty}^{\\infty} dz' \\frac{\\partial\\Phi(z')}{\\partial n_\\alpha(z')} k_\\alpha(z'-z) \\;=\\; 0\n$$\n在我们感兴趣的区域 $z \\ge 0$，$V_{\\mathrm{ext}}(z)=0$。令 $\\beta = 1/(k_B T)$。整理各项，我们得到 $n(z)$ 的 EL 方程：\n$$\n\\ln(n(z)) + \\ln(\\Lambda^3) - \\beta\\mu + \\sum_{\\alpha} \\int_{-\\infty}^{\\infty} dz' \\frac{\\partial\\Phi(z')}{\\partial n_\\alpha(z')} k_\\alpha(z'-z) \\;=\\; 0\n$$\n它可以写成：\n$$\n\\ln(n(z)) \\;=\\; \\beta\\mu - \\ln(\\Lambda^3) - \\int_{-\\infty}^{\\infty} dz' \\sum_{\\alpha} \\frac{\\partial\\Phi(z')}{\\partial n_\\alpha(z')} k_\\alpha(z'-z)\n$$\n这就是 EL 方程的最终表达式，其中求和 $\\sum_\\alpha$ 包括所有六个加权密度（四个标量 $n_0, n_1, n_2, n_3$ 和两个矢量分量 $n_{v1,z}, n_{v2,z}$），而 $k_\\alpha$ 是它们相应的一维核函数。", "answer": "$$\n\\boxed{\n\\pmatrix{\n\\begin{aligned}\nn_{3}(z) = \\int_{-\\infty}^{\\infty} dz' n(z') \\pi(R^2 - (z-z')^2)\\Theta(R-|z-z'|) \\\\\nn_{2}(z) = \\int_{-\\infty}^{\\infty} dz' n(z') 2\\pi R \\Theta(R-|z-z'|) \\\\\nn_{1}(z) = \\int_{-\\infty}^{\\infty} dz' n(z') \\frac{1}{2} \\Theta(R-|z-z'|) \\\\\nn_{0}(z) = \\int_{-\\infty}^{\\infty} dz' n(z') \\frac{1}{2R} \\Theta(R-|z-z'|) \\\\\nn_{v2,z}(z) = \\int_{-\\infty}^{\\infty} dz' n(z') 2\\pi (z-z') \\Theta(R-|z-z'|) \\\\\nn_{v1,z}(z) = \\int_{-\\infty}^{\\infty} dz' n(z') \\frac{z-z'}{2R} \\Theta(R-|z-z'|)\n\\end{aligned}\n\\\\\n\\ln(n(z)) = \\beta\\mu - \\ln(\\Lambda^3) - \\int_{-\\infty}^{\\infty} dz' \\sum_{\\alpha} \\frac{\\partial\\Phi(z')}{\\partial n_\\alpha(z')}k_\\alpha(z'-z)\n}\n}\n$$", "id": "2763877"}, {"introduction": "对任何自由能泛函的一个关键检验是其热力学自洽性。这最后一个练习 [@problem_id:2629205] 要求你通过两种不同路径——热力学路径和压缩率路径——推导一维流体的压强，然后编写程序来验证它们得到相同的结果。这个练习不仅强调了自由能、压强和关联函数之间的深刻联系，还提供了数值验证理论模型的动手经验。", "problem": "考虑一个一维空间中的均匀流体，由长度为 $a$ 的不可穿透杆（一维硬杆）组成，其数密度为 $\\rho$，并可能受到一个吸引尾势的作用。在经典密度泛函理论（cDFT）的框架内进行研究，其定义如下。亥姆霍兹自由能泛函被分解为一个理想部分和一个过剩部分，其中过剩部分又分为硬杆参考贡献和平均场吸引贡献。直接关联函数由过剩自由能的二阶泛函导数定义。零波数下的结构因子和等温压缩率通过可压缩性求和规则相联系。压力可以通过热力学路径（通过巨势最小值）和可压缩性路径（通过对可压缩性关系式积分）来计算。\n\n模型说明：\n- 对势 $u(x)$ 由一个硬核和一个吸引尾势组成：\n  - 当 $|x|  a$ 时，$u(x) = +\\infty$，\n  - 当 $|x| \\ge a$ 时，$u(x) = w(x)$，\n  - 当 $|x| \\ge a$ 时，$w(x) = -\\varepsilon \\exp\\!\\big(-\\kappa(|x| - a)\\big)$，其中 $\\varepsilon  0$ 且 $\\kappa  0$。\n- 在约化单位下进行计算，设 $k_B T = 1$，因此所有能量都是无量纲的，所有压力都应报告为 $\\beta P$，其中 $\\beta = 1$。所有长度的单位与 $a$ 相同；密度 $\\rho$ 的单位是长度的倒数。在任何情况下，您都必须确保 $\\rho a  1$。\n\n将使用的基本定义：\n- 理想气体亥姆霍兹自由能密度 $f_\\mathrm{id}(\\rho)$、硬杆过剩自由能密度 $f_\\mathrm{ex}^{\\mathrm{HR}}(\\rho)$ 和平均场吸引贡献 $f_\\mathrm{att}(\\rho)$ 以 $f(\\rho) = f_\\mathrm{id}(\\rho) + f_\\mathrm{ex}^{\\mathrm{HR}}(\\rho) + f_\\mathrm{att}(\\rho)$ 的形式进入。\n- 化学势为 $\\mu(\\rho) = \\partial f(\\rho)/\\partial \\rho$（在恒定温度下）。\n- 对于均匀流体，压力的热力学路径为 $P_\\mathrm{T}(\\rho) = \\rho\\,\\mu(\\rho) - f(\\rho)$。\n- 过剩平均场贡献源于对势，表现为密度的一个双线性项，其二阶泛函导数定义了对直接关联函数 $c^{(2)}(x)$ 的平均场贡献。\n- 直接关联函数 $c^{(2)}(x)$ 定义为 $c^{(2)}(x-x') = -\\delta^2 \\big(\\beta F_\\mathrm{ex}[\\rho]\\big)/\\delta \\rho(x)\\,\\delta \\rho(x')$ 在均匀密度 $\\rho$ 下的值；其在零波数下的空间傅里叶变换为 $\\tilde{c}(0) = \\int_{-\\infty}^{\\infty} c^{(2)}(x)\\,dx$。\n- 对于均匀流体，可压缩性求和规则给出 $\\partial (\\beta P)/\\partial \\rho = 1 - \\rho\\,\\tilde{c}(0)$。\n- 硬杆参考系在一维中是精确可解的；您可以使用其经过充分检验的状态方程或自由能来确保您所实现的任何路径中硬核部分的一致性。\n\n任务：\n1. 在经典密度泛函理论（cDFT）框架内，从第一性原理出发，为上述均匀流体推导无量纲压力 $\\beta P(\\rho)$ 的两个独立表达式：\n   - 热力学路径 $P_\\mathrm{T}(\\rho)$，通过 $P = \\rho\\,\\mu - f$，使用将 $f(\\rho)$ 分解为理想、硬杆过剩和平均场吸引部分的方法。\n   - 可压缩性路径 $P_\\mathrm{C}(\\rho)$，通过对可压缩性关系式 $\\partial (\\beta P)/\\partial \\rho = 1 - \\rho\\,\\tilde{c}(0)$ 从 $\\rho' = 0$ 到 $\\rho$ 积分，边界条件为 $\\beta P(0) = 0$，并使用由 $F_\\mathrm{ex}$ 的相同分解（硬杆参考加上平均场吸引）所蕴含的直接关联函数。\n2. 在您的推导中，您必须：\n   - 确定与一维硬杆状态方程一致的精确硬杆过剩自由能密度，并用它来获得参考部分的 $P_\\mathrm{T}(\\rho)$。\n   - 计算吸引尾势 $w(x)$ 的空间积分，以获得其对平均场自由能和 $\\tilde{c}(0)$ 的贡献，并在两条路径中一致地包含它。\n   - 确保可压缩性路径实现为对 $\\partial(\\beta P)/\\partial \\rho'$ 从 $\\rho'=0$ 到 $\\rho$ 的显式 $\\rho'$-积分；不要在未说明其如何从被积函数得出的情况下，通过代入一个闭合形式的原函数来走捷径。\n3. 实现一个程序，对于下面的每个测试用例，计算：\n   - 通过热力学路径计算的 $\\beta P_\\mathrm{T}(\\rho)$，\n   - 通过可压缩性路径计算的 $\\beta P_\\mathrm{C}(\\rho)$（通过对 $\\rho'$ 的数值积分），\n   - 绝对差 $\\Delta(\\rho) = \\big|\\beta P_\\mathrm{T}(\\rho) - \\beta P_\\mathrm{C}(\\rho)\\big|$。\n   您的数值积分必须足够精确，以使任何差异纯粹是数值上的并且很小。\n\n测试套件：\n使用以下参数元组 $(a,\\kappa,\\varepsilon,\\rho)$，均为约化单位，$\\beta = 1$：\n- 案例 1：$(1.0,\\,1.5,\\,0.5,\\,0.10)$。\n- 案例 2：$(1.0,\\,0.5,\\,1.5,\\,0.40)$。\n- 案例 3：$(1.0,\\,3.0,\\,2.0,\\,0.95)$。\n- 案例 4：$(0.5,\\,2.0,\\,1.0,\\,0.60)$。\n- 案例 5：$(1.0,\\,5.0,\\,5.0,\\,0.30)$。\n- 案例 6：$(1.0,\\,1.0,\\,1.0,\\,0.00)$。\n\n答案规范：\n- 对于每种情况，输出如上定义的单个浮点数 $\\Delta(\\rho)$。\n- 最终输出必须是单行，包含案例 1 到 6 的结果，按顺序排列，形式为用方括号括起来的逗号分隔列表，例如 $[\\Delta_1,\\Delta_2,\\dots,\\Delta_6]$。\n- 所有输出均为无量纲的 $\\beta P$ 差异。不应打印其他任何文本。", "solution": "所提出的问题是流体统计力学中的一个标准练习，它在科学上是有效的、适定的且内部一致的。它要求从一个单一的基础自由能泛函出发，推导并比较通往一维流体模型状态方程的两种不同路径。这用于证明所选平均场近似的热力学一致性。我将继续进行所需的推导。\n\n该模型是一个由长度为 $a$ 的硬杆组成的一维流体，具有成对的吸引势尾。热力学状态由数密度 $\\rho$ 定义。所有计算均在约化单位下进行，其中热能 $k_B T = 1$，使得逆温度 $\\beta = 1$。分析仅限于物理区域，其中堆积分数 $\\eta = \\rho a  1$。\n\n总亥姆霍兹自由能密度 $f(\\rho)$ 被分解为理想气体、硬杆过剩和平均场吸引贡献：\n$$f(\\rho) = f_\\mathrm{id}(\\rho) + f_\\mathrm{ex}^{\\mathrm{HR}}(\\rho) + f_\\mathrm{att}(\\rho)$$\n所有自由能密度都以 $k_B T$ 为单位表示。\n\n**热力学压力 $P_\\mathrm{T}(\\rho)$ 的推导**\n\n对于均匀流体，压力的热力学路径由勒让德变换关系给出：\n$$\\beta P_\\mathrm{T}(\\rho) = \\rho\\,\\mu(\\rho) - f(\\rho)$$\n其中 $\\mu(\\rho) = \\partial f(\\rho)/\\partial \\rho$ 是化学势。为了计算这个值，我们必须首先确定 $f(\\rho)$ 的三个分量的显式形式。\n\n1.  **理想气体自由能密度, $f_\\mathrm{id}(\\rho)$**：一维理想气体的精确表达式为 $f_\\mathrm{id}(\\rho) = \\rho(\\ln(\\rho\\Lambda) - 1)$，其中 $\\Lambda$ 是热德布罗意波长。$\\Lambda$ 项对化学势贡献一个加性常数，并且不影响压力。因此，为我们的目的，我们使用标准形式：\n    $$f_\\mathrm{id}(\\rho) = \\rho\\ln\\rho - \\rho$$\n\n2.  **硬杆过剩自由能密度, $f_\\mathrm{ex}^{\\mathrm{HR}}(\\rho)$**：一维硬杆流体（Tonks 气体）的状态方程已知是精确的 $\\beta P^{\\mathrm{HR}}(\\rho) = \\rho/(1-\\rho a)$。与该状态方程一致的过剩自由能密度是：\n    $$f_\\mathrm{ex}^{\\mathrm{HR}}(\\rho) = -\\rho\\ln(1 - \\rho a)$$\n    这可以通过将热力学压力公式应用于硬杆系统 $f^{\\mathrm{HR}}(\\rho) = f_\\mathrm{id}(\\rho) + f_\\mathrm{ex}^{\\mathrm{HR}}(\\rho)$ 来验证，该公式正确地恢复了 Tonks 气体的状态方程。\n\n3.  **平均场吸引自由能密度, $f_\\mathrm{att}(\\rho)$**：问题指定了对势的吸引部分 $w(x)$ 采用随机相或平均场近似。在这种近似下，相应的过剩自由能泛函在密度剖面中是双线性的。对于密度为 $\\rho$ 的均匀流体，这简化为自由能密度中的一个二次项：\n    $$f_\\mathrm{att}(\\rho) = \\frac{1}{2}\\rho^2 \\int_{-\\infty}^{\\infty} \\beta w(x) \\,dx$$\n    当 $\\beta=1$ 时，我们计算吸引尾势 $w(x) = -\\varepsilon \\exp(-\\kappa(|x| - a))$ for $|x| \\geq a$ 的积分。由于对称性，该积分是正轴上积分的两倍：\n    $$\\int_{-\\infty}^{\\infty} w(x) \\,dx = 2 \\int_{a}^{\\infty} \\left[-\\varepsilon e^{-\\kappa(x-a)}\\right] \\,dx = -2\\varepsilon e^{\\kappa a} \\int_{a}^{\\infty} e^{-\\kappa x} \\,dx$$\n    $$= -2\\varepsilon e^{\\kappa a} \\left[ -\\frac{1}{\\kappa} e^{-\\kappa x} \\right]_{a}^{\\infty} = -2\\varepsilon e^{\\kappa a} \\left( 0 - \\left(-\\frac{1}{\\kappa}e^{-\\kappa a}\\right) \\right) = -\\frac{2\\varepsilon}{\\kappa}$$\n    让我们将吸引的积分强度定义为正常数 $\\alpha = 2\\varepsilon/\\kappa$。那么吸引自由能密度为：\n    $$f_\\mathrm{att}(\\rho) = -\\frac{\\alpha}{2}\\rho^2$$\n\n结合这些分量，总自由能密度为：\n$$f(\\rho) = (\\rho\\ln\\rho - \\rho) - \\rho\\ln(1 - \\rho a) - \\frac{\\alpha}{2}\\rho^2$$\n接下来，我们计算总化学势 $\\mu(\\rho) = \\partial f(\\rho)/\\partial \\rho$：\n$$\\mu(\\rho) = (\\ln\\rho + 1 - 1) - \\left( \\ln(1-\\rho a) + \\rho \\frac{-a}{1-\\rho a} \\right) - \\alpha\\rho$$\n$$\\mu(\\rho) = \\ln\\rho - \\ln(1-\\rho a) + \\frac{\\rho a}{1-\\rho a} - \\alpha\\rho$$\n最后，我们将 $f(\\rho)$ 和 $\\mu(\\rho)$ 代入压力公式：\n$$\\beta P_\\mathrm{T}(\\rho) = \\rho\\left[ \\ln\\rho - \\ln(1-\\rho a) + \\frac{\\rho a}{1-\\rho a} - \\alpha\\rho \\right] - \\left[ (\\rho\\ln\\rho - \\rho) - \\rho\\ln(1 - \\rho a) - \\frac{\\alpha}{2}\\rho^2 \\right]$$\n展开后，对数项相互抵消：\n$$\\beta P_\\mathrm{T}(\\rho) = (\\rho\\ln\\rho - \\rho\\ln(1-\\rho a)) + \\frac{\\rho^2 a}{1-\\rho a} - \\alpha\\rho^2 - (\\rho\\ln\\rho - \\rho\\ln(1-\\rho a)) + \\rho - \\frac{\\alpha}{2}\\rho^2$$\n$$\\beta P_\\mathrm{T}(\\rho) = \\rho + \\frac{\\rho^2 a}{1-\\rho a} - \\frac{\\alpha}{2}\\rho^2 = \\frac{\\rho(1-\\rho a) + \\rho^2 a}{1-\\rho a} - \\frac{\\alpha}{2}\\rho^2$$\n这简化为热力学压力的最终表达式：\n$$\\beta P_\\mathrm{T}(\\rho) = \\frac{\\rho}{1 - \\rho a} - \\frac{\\alpha}{2}\\rho^2$$\n\n**可压缩性压力 $P_\\mathrm{C}(\\rho)$ 的推导**\n\n可压缩性路径利用了可压缩性求和规则，该规则将压力对密度的导数与直接关联函数 $c^{(2)}(x)$ 联系起来：\n$$\\frac{\\partial(\\beta P)}{\\partial \\rho} = 1 - \\rho\\,\\tilde{c}(0)$$\n其中 $\\tilde{c}(0) = \\int_{-\\infty}^{\\infty} c^{(2)}(x) \\,dx$。压力通过对该关系式从零密度状态（压力必须为零）积分得到：\n$$\\beta P_\\mathrm{C}(\\rho) = \\int_{0}^{\\rho} \\left( 1 - \\rho'\\,\\tilde{c}(0;\\rho') \\right) \\,d\\rho'$$\n\n直接关联函数由过剩自由能泛函的二阶泛函导数定义，$c^{(2)}(x-x') = -\\delta^2(\\beta F_\\mathrm{ex})/\\delta\\rho(x)\\delta\\rho(x')$。由于我们的过剩自由能是一个和，$F_\\mathrm{ex} = F_\\mathrm{ex}^{\\mathrm{HR}} + F_\\mathrm{att}$，直接关联函数也是一个和，$c^{(2)}(x) = c_\\mathrm{HR}^{(2)}(x) + c_\\mathrm{att}^{(2)}(x)$。这种可加性也延续到其积分，$\\tilde{c}(0) = \\tilde{c}_\\mathrm{HR}(0) + \\tilde{c}_\\mathrm{att}(0)$。\n\n1.  **对 $\\tilde{c}(0)$ 的吸引贡献**：对于指定的平均场泛函 $\\beta F_\\mathrm{att}[\\rho] = \\frac{1}{2} \\iint \\rho(x) w(x-x') \\rho(x') \\,dx\\,dx'$，二阶泛函导数直接给出：\n    $$c_\\mathrm{att}^{(2)}(x) = -\\beta w(x)$$\n    对其积分得到对 $\\tilde{c}(0)$ 的贡献，该贡献与密度无关：\n    $$\\tilde{c}_\\mathrm{att}(0) = \\int_{-\\infty}^{\\infty} [-\\beta w(x)] \\,dx = - \\int_{-\\infty}^{\\infty} w(x) \\,dx = -(-\\alpha) = \\alpha$$\n\n2.  **对 $\\tilde{c}(0)$ 的硬杆贡献**：对于硬杆系统，可压缩性关系为 $\\partial(\\beta P^{\\mathrm{HR}})/\\partial \\rho = 1 - \\rho\\,\\tilde{c}_\\mathrm{HR}(0)$。我们不需要 $\\tilde{c}_\\mathrm{HR}(0;\\rho)$ 的显式形式；相反，我们可以使用已知的压力导数：\n    $$\\frac{\\partial(\\beta P^{\\mathrm{HR}})}{\\partial\\rho} = \\frac{\\partial}{\\partial\\rho} \\left( \\frac{\\rho}{1-\\rho a} \\right) = \\frac{(1)(1-\\rho a) - (\\rho)(-a)}{(1-\\rho a)^2} = \\frac{1}{(1-\\rho a)^2}$$\n    因此，$1 - \\rho\\,\\tilde{c}_\\mathrm{HR}(0) = 1/(1-\\rho a)^2$。\n\n现在我们组合总压力的完整被积函数：\n$$\\frac{\\partial(\\beta P)}{\\partial\\rho} = 1 - \\rho\\left[\\tilde{c}_\\mathrm{HR}(0;\\rho) + \\tilde{c}_\\mathrm{att}(0)\\right] = \\left[1 - \\rho\\,\\tilde{c}_\\mathrm{HR}(0;\\rho)\\right] - \\rho\\,\\tilde{c}_\\mathrm{att}(0)$$\n代入各部分的表达式：\n$$\\frac{\\partial(\\beta P)}{\\partial\\rho} = \\frac{1}{(1-\\rho a)^2} - \\rho\\alpha$$\n\n问题要求对此表达式进行数值积分。因此，通过可压缩性路径得到的压力由定积分给出：\n$$\\beta P_\\mathrm{C}(\\rho) = \\int_{0}^{\\rho} \\left( \\frac{1}{(1-\\rho'a)^2} - \\alpha\\rho' \\right) \\,d\\rho'$$\n\n为了验证，我们可以解析地计算这个积分：\n$$\\int_{0}^{\\rho} \\left( \\frac{1}{(1-\\rho'a)^2} - \\alpha\\rho' \\right) \\,d\\rho' = \\left[ \\frac{1}{a(1-\\rho'a)} - \\frac{\\alpha}{2}(\\rho')^2 \\right]_{0}^{\\rho}$$\n$$= \\left(\\frac{1}{a(1-\\rho a)} - \\frac{\\alpha}{2}\\rho^2\\right) - \\left(\\frac{1}{a(1-0)} - 0\\right) = \\frac{1 - (1-\\rho a)}{a(1-\\rho a)} - \\frac{\\alpha}{2}\\rho^2$$\n$$= \\frac{\\rho a}{a(1-\\rho a)} - \\frac{\\alpha}{2}\\rho^2 = \\frac{\\rho}{1-\\rho a} - \\frac{\\alpha}{2}\\rho^2$$\n$P_\\mathrm{C}(\\rho)$ 的解析结果与 $P_\\mathrm{T}(\\rho)$ 的表达式相同。这证实了平均场模型的热力学自洽性。数值实现将计算差值 $\\Delta(\\rho) = |\\beta P_\\mathrm{T}(\\rho) - \\beta P_\\mathrm{C}(\\rho)|$，该差值应仅由于数值积分算法的有限精度而为非零。\n\n**数值实现**\n\n附带的程序实现了这两条路径。$\\beta P_\\mathrm{T}(\\rho)$ 使用其闭合形式表达式计算。$\\beta P_\\mathrm{C}(\\rho)$ 通过使用 `scipy.integrate.quad` 函数（一种高精度自适应求积方法）对推导出的 $\\partial(\\beta P)/\\partial\\rho$ 表达式从 $\\rho'=0$ 到 $\\rho$ 进行数值积分来计算。然后对每个测试用例计算绝对差 $\\Delta(\\rho)$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes and compares pressure in a 1D fluid model via two thermodynamic routes.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple is (a, kappa, epsilon, rho)\n    test_cases = [\n        (1.0, 1.5, 0.5, 0.10),\n        (1.0, 0.5, 1.5, 0.40),\n        (1.0, 3.0, 2.0, 0.95),\n        (0.5, 2.0, 1.0, 0.60),\n        (1.0, 5.0, 5.0, 0.30),\n        (1.0, 1.0, 1.0, 0.00),\n    ]\n\n    results = []\n\n    def integrand(rho_prime, a, alpha):\n        \"\"\"\n        The integrand for the compressibility route, representing d(beta*P)/d(rho').\n        It is the sum of the hard-rod and attractive contributions.\n        \n        Args:\n            rho_prime (float): The integration variable (density).\n            a (float): The hard rod length.\n            alpha (float): The integrated strength of the attraction.\n            \n        Returns:\n            float: The value of the derivative of pressure w.r.t. density.\n        \"\"\"\n        # The hard-rod part is d(P_HR)/d(rho) = 1 / (1 - rho*a)^2\n        # The attractive part is d(P_att)/d(rho) = -alpha * rho\n        return 1.0 / (1.0 - rho_prime * a)**2 - alpha * rho_prime\n\n    for case in test_cases:\n        a, kappa, epsilon, rho = case\n\n        # Handle the trivial case of zero density.\n        if rho == 0.0:\n            results.append(0.0)\n            continue\n\n        # Calculate the integrated strength of the attractive potential, alpha.\n        # alpha = 2 * epsilon / kappa\n        alpha = 2.0 * epsilon / kappa\n\n        # 1. Thermodynamic Route (P_T)\n        # beta*P_T = rho/(1-rho*a) - (alpha/2)*rho^2\n        # This is the sum of the exact hard-rod pressure and the mean-field attractive pressure.\n        p_thermo = rho / (1.0 - rho * a) - (alpha / 2.0) * rho**2\n\n        # 2. Compressibility Route (P_C)\n        # beta*P_C is the integral of d(beta*P)/d(rho') from 0 to rho.\n        # We use numerical quadrature as required.\n        p_compressibility, _ = quad(integrand, 0, rho, args=(a, alpha))\n\n        # 3. Absolute Difference\n        # The difference should be close to zero, limited by numerical precision.\n        delta = abs(p_thermo - p_compressibility)\n        results.append(delta)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "2629205"}]}