{"hands_on_practices": [{"introduction": "第一个实践是一项基础练习。我们将从头开始实现一个简化的元动力学模拟，以探索一个已知的双阱势。本练习的目标是通过直接的数值计算来展示，如何通过对有偏样本的重加权，正确地恢复态间真实的自由能差，从而巩固该方法的核心原理[@problem_id:2655481]。", "problem": "考虑一个单组分、双态系统的一维集体变量 $s \\in \\mathbb{R}$，其自由能剖面 $F(s)$ 已知，并以玻尔兹曼常数与温度的乘积 ($k_{\\mathrm{B}}T$) 为单位表示，因此逆温度 $\\beta = 1$。该系统表现出两个亚稳盆，分别定义为区域 $A = \\{ s \\, | \\, s  0 \\}$ 和 $B = \\{ s \\, | \\, s \\ge 0 \\}$。您将使用一个通过简化的元动力学沉积方案构建的含时偏置势来模拟过阻尼朗之万动力学，并数值验证重加权直方图能够在统计误差范围内恢复盆地间的正确自由能差。\n\n使用的基本原理：\n- 在势 $U(s,t)$ 中的过阻尼朗之万动力学产生随机微分方程 $ds = -D \\, \\beta \\, \\partial_s U(s,t) \\, dt + \\sqrt{2 D \\, dt} \\, \\eta$，其中 $D$ 是扩散常数，$dt$ 是时间步长，$\\eta$ 是一个标准正态变量。\n- 对于静态势 $U(s)$，玻尔兹曼分布为 $p(s) \\propto \\exp\\left(-\\beta \\, U(s)\\right)$。\n- 区域 $X \\in \\{A,B\\}$ 的自由能为 $G_X = -\\beta^{-1} \\ln Z_X$，其中 $Z_X = \\int_X \\exp\\left(-\\beta \\, F(s)\\right) \\, ds$ 是区域 $X$ 上的受限配分函数。\n- 盆地间的自由能差为 $\\Delta G = G_B - G_A = -\\beta^{-1} \\ln \\left( Z_B / Z_A \\right)$。\n\n任务概述（除上述基本原理外，请勿使用任何未经证明的简化公式）：\n- 已知的无偏置自由能剖面是一个带有线性倾斜的四次双阱 $F(s) = a \\, s^4 - b \\, s^2 + c \\, s$，参数为 $a = 1$，$b = 3$，$c = 0.5$（均以 $k_{\\mathrm{B}}T$ 为单位）。根据 $Z_A$ 和 $Z_B$ 的定义，分别在 $s \\in (-\\infty,0)$ 和 $s \\in [0,\\infty)$ 上通过数值积分计算 $\\Delta G$ 的参考值。将 $\\Delta G$ 以 $k_{\\mathrm{B}}T$ 为单位表示为一个浮点数。\n- 使用过阻尼朗之万动力学演化集体变量，其中 $U(s,t) = F(s) + V_{\\mathrm{bias}}(s,t)$，$D = 1$，$\\beta = 1$。使用 Euler–Maruyama 离散化，时间步长 $dt$ 按每个测试用例指定。在 $s = \\pm L$ 处施加反射边界，其中 $L = 3$。\n- 通过按固定的时间步长沉积高斯核来构建 $V_{\\mathrm{bias}}(s,t)$：每隔 $n_{\\mathrm{stride}}$ 步，在当前位置 $s_i$ 处向 $V_{\\mathrm{bias}}(s,t)$ 添加一个高斯函数 $w_0 \\, \\exp\\left(-\\frac{(s - s_i)^2}{2 \\sigma^2}\\right)$，其中 $w_0$ 是高斯高度，$\\sigma$ 是宽度，两者均由测试用例指定。初始化 $V_{\\mathrm{bias}}(s,0) = 0$。这是一种简化的（普通）元动力学偏置沉积。\n- 使用来自含时偏置动力学的样本，根据玻尔兹曼原理和给定时间的有偏置静态分布的定义，构建盆地 $B$ 和 $A$ 之间无偏置概率比的估计量。由此，获得作为轨迹和 $V_{\\mathrm{bias}}(s,t)$ 函数的 $\\Delta G$ 估计量。\n- 使用分块平均法估计 $\\Delta G$ 估计量的统计标准误差：将轨迹的分析段划分为 $M$ 个等长的连续块（选择 $M \\ge 8$），从每个块计算一个估计值，并将标准误差计算为各块估计值的样本标准差除以 $\\sqrt{M}$。\n- 验证标准：如果绝对偏差 $|\\Delta G_{\\mathrm{est}} - \\Delta G_{\\mathrm{ref}}|$ 小于或等于估计标准误差的 $2$ 倍，则宣布测试通过。\n\n数值模型细节与要求：\n- 使用 $L = 3$作为反射边界。如果在一个时间步后 $s$ 越过 $\\pm L$，将其反射回域内。\n- 使用模拟样本的后半部分进行分析（即，丢弃前半部分作为预烧期）。在此分析段上使用分块平均法，分 $M = 10$ 块。\n- 能量必须以 $k_{\\mathrm{B}}T$ 为单位处理；报告所有计算出的自由能和自由能差，均以 $k_{\\mathrm{B}}T$ 为单位，作为无量纲浮点数。\n- 不涉及角度；没有需要指定的角度单位。\n- 随机性：使用提供的整数种子以保证可复现性。\n\n测试套件：\n实现您的程序以运行以下 $3$ 个测试用例，每个用例指定为一个元组 $(\\text{seed}, N_{\\text{steps}}, dt, w_0, \\sigma, n_{\\mathrm{stride}})$：\n- 用例 $1$：$(1234, 20000, 0.002, 0.05, 0.20, 50)$\n- 用例 $2$：$(5678, 20000, 0.002, 0.02, 0.25, 25)$\n- 用例 $3$：$(91011, 20000, 0.002, 0.10, 0.15, 100)$\n\n输出规格：\n- 对于每个测试用例，计算一个布尔值，指示该用例是否满足验证标准。\n- 您的程序应生成单行输出，其中包含按测试用例顺序排列的结果，格式为用方括号括起的逗号分隔列表，例如：“[True,False,True]”。", "solution": "问题陈述已经过验证，并被确定为计算统计力学中一个良构的、有科学依据的问题。它要求实现并验证一个简化的元动力学模拟，以恢复模型势的两个盆地之间的自由能差。\n解决方案遵循统计力学和数值模拟的既定原理，按部就班地构建。\n\n**1. 参考自由能差 ($\\Delta G_{\\mathrm{ref}}$)**\n\n无偏置系统由一维自由能剖面 $F(s) = a s^4 - b s^2 + c s$ 描述，参数为 $a=1$，$b=3$ 和 $c=0.5$。所有能量都以 $k_{\\mathrm{B}}T$ 为单位，因此逆温度 $\\beta = (k_{\\mathrm{B}}T)^{-1}$ 设为 $1$。\n\n系统被划分为两个盆地：$A = \\{ s \\, | \\, s  0 \\}$ 和 $B = \\{ s \\, | \\, s \\ge 0 \\}$。在状态 $s$ 找到系统的平衡概率由玻尔兹曼分布给出，$p(s) \\propto \\exp(-\\beta F(s))$。盆地 $X \\in \\{A, B\\}$ 的自由能与其受限配分函数 $Z_X$ 相关：\n$$\nG_X = -\\beta^{-1} \\ln Z_X \\quad \\text{其中} \\quad Z_X = \\int_X \\exp(-\\beta F(s)) \\, ds\n$$\n因此，盆地间的自由能差为：\n$$\n\\Delta G = G_B - G_A = -\\beta^{-1} \\ln\\left(\\frac{Z_B}{Z_A}\\right)\n$$\n给定 $\\beta=1$，我们需要通过对各自域上的配分函数进行数值积分来计算参考值 $\\Delta G_{\\mathrm{ref}}$：\n$$\nZ_A = \\int_{-\\infty}^{0} \\exp(-(s^4 - 3s^2 + 0.5s)) \\, ds\n$$\n$$\nZ_B = \\int_{0}^{\\infty} \\exp(-(s^4 - 3s^2 + 0.5s)) \\, ds\n$$\n这些积分使用数值积分计算，例如，通过 `scipy.integrate.quad` 函数。该结果作为验证基于模拟的估计量的基准。\n\n**2. 元动力学模拟**\n\n系统的演化由粒子在含时势 $U(s,t) = F(s) + V_{\\mathrm{bias}}(s,t)$ 中运动的过阻尼朗之万方程控制：\n$$\nds = -D \\beta \\frac{\\partial U(s,t)}{\\partial s} dt + \\sqrt{2D dt} \\, \\eta(t)\n$$\n此处，$D=1$ 是扩散常数，$\\beta=1$，$dt$ 是积分时间步长，$\\eta(t)$ 是一个零均值和单位方差的高斯白噪声项。此随机微分方程使用 Euler-Maruyama 格式进行离散化：\n$$\ns_{i+1} = s_i - \\frac{\\partial U(s_i, t_i)}{\\partial s} dt + \\sqrt{2 dt} \\, \\eta_i\n$$\n其中 $\\eta_i$ 是从标准正态分布中抽取的随机数。动力学通过反射边界条件被限制在区间 $[-L, L]$ 内，其中 $L=3$。\n\n偏置势 $V_{\\mathrm{bias}}(s,t)$ 是实时构建的。在规则的时间间隔，特别是在 $n_{\\mathrm{stride}}$ 倍数的模拟步长 $i$ 处，一个以系统当前位置 $s_i$ 为中心的排斥性高斯核被添加到势中：\n$$\nV_{\\mathrm{bias}}(s, t_i) = \\sum_{k \\cdot n_{\\mathrm{stride}}  i} w_0 \\exp\\left(-\\frac{(s - s_{k \\cdot n_{\\mathrm{stride}}})^2}{2 \\sigma^2}\\right)\n$$\n其中 $w_0$ 是高斯高度，$\\sigma$ 是其宽度。此过程阻止系统重复访问最近探索过的区域，从而加速对整个状态空间的探索，并促进跨越分隔盆地 $A$ 和 $B$ 的自由能垒的转变。\n\n**3. 重加权与自由能差估计 ($\\Delta G_{\\mathrm{est}}$)**\n\n元动力学模拟生成一条从含时的、有偏置的概率分布中采样的轨迹 $\\{s_i\\}$。为了恢复原始无偏置系统的性质，需要进行重加权过程。无偏置概率密度 $p(s) \\propto \\exp(-F(s))$ 可以从有偏置的样本中恢复，方法是用一个与 $\\exp(\\beta V_{\\mathrm{bias}}(s_i, t_i))$ 成正比的权重来校正每个样本 $s_i$（在时间 $t_i$ 生成）。当 $\\beta=1$ 时，权重为 $e^{V_{\\mathrm{bias}}(s_i, t_i)}$。\n\n遵循这一原理，无偏置配分函数的比率 $Z_B/Z_A$ 可以通过落在盆地 $B$ 中的样本权重之和与落在盆地 $A$ 中的样本权重之和的比率来估计：\n$$\n\\frac{Z_B}{Z_A} \\approx \\frac{\\sum_{i \\in \\text{analysis}, s_i \\in B} \\exp(V_{\\mathrm{bias}}(s_i, t_i))}{\\sum_{i \\in \\text{analysis}, s_i \\in A} \\exp(V_{\\mathrm{bias}}(s_i, t_i))}\n$$\n求和是在轨迹的后半部分（指定为分析段）上进行的。根据此比率，自由能差的估计量为：\n$$\n\\Delta G_{\\mathrm{est}} = - \\ln\\left(\\frac{\\sum_{i, s_i \\in B} \\exp(V_{\\mathrm{bias}}(s_i, t_i))}{\\sum_{i, s_i \\in A} \\exp(V_{\\mathrm{bias}}(s_i, t_i))}\\right)\n$$\n\n**4. 统计误差分析**\n\n为了估计 $\\Delta G_{\\mathrm{est}}$ 的统计不确定性，轨迹的分析段被划分为 $M=10$ 个等长的不重叠块。对于每个块 $j=1, \\dots, M$，计算自由能差的独立估计值 $(\\Delta G)_j$。总体估计值 $\\Delta G_{\\mathrm{est}}$ 是这些块估计值的平均值。然后，平均值的标准误差 (SEM) 计算如下：\n$$\n\\text{SEM} = \\frac{\\sigma_{\\Delta G}}{\\sqrt{M}}\n$$\n其中 $\\sigma_{\\Delta G}$ 是块估计值 $\\{(\\Delta G)_j\\}$ 的样本标准差。\n\n**5. 验证标准**\n\n如果估计的自由能差 $\\Delta G_{\\mathrm{est}}$ 在统计误差范围内与参考值 $\\Delta G_{\\mathrm{ref}}$ 一致，则认为数值实验成功。通过一个测试用例的具体标准是，估计值与参考值之间的绝对差值不超过标准误差的两倍：\n$$\n|\\Delta G_{\\mathrm{est}} - \\Delta G_{\\mathrm{ref}}| \\le 2 \\times \\text{SEM}\n$$\n这相当于检查真实值是否落在估计值周围约 $95\\%$ 的置信区间内。", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Runs a series of metadynamics simulations to verify free energy recovery.\n    \"\"\"\n    \n    # Define problem parameters\n    a, b, c = 1.0, 3.0, 0.5\n    L = 3.0  # Reflecting boundaries at +/- L\n    M = 10   # Number of blocks for error analysis\n\n    # --- 1. Calculate Reference Free Energy Difference ---\n    def F(s):\n        \"\"\"Unbiased free energy profile F(s).\"\"\"\n        return a * s**4 - b * s**2 + c * s\n\n    def integrand(s):\n        \"\"\"Boltzmann factor for numerical integration.\"\"\"\n        return np.exp(-F(s))\n\n    # Integrate partition functions for basins A (s0) and B (s>=0)\n    Z_A, _ = quad(integrand, -np.inf, 0)\n    Z_B, _ = quad(integrand, 0, np.inf)\n\n    # Reference free energy difference (beta=1)\n    delta_G_ref = -np.log(Z_B / Z_A)\n\n    # Test cases from the problem statement\n    test_cases = [\n        (1234, 20000, 0.002, 0.05, 0.20, 50),\n        (5678, 20000, 0.002, 0.02, 0.25, 25),\n        (91011, 20000, 0.002, 0.10, 0.15, 100),\n    ]\n\n    results = []\n    for case in test_cases:\n        seed, N_steps, dt, w0, sigma, n_stride = case\n        \n        np.random.seed(seed)\n\n        # --- 2. Run Metadynamics Simulation ---\n        # Start at one of the potential minima\n        s = -1.266 \n        \n        traj = np.zeros(N_steps)\n        dep_centers = []\n\n        for i in range(N_steps):\n            traj[i] = s\n\n            # Deposit a Gaussian at the start of the step, if applicable\n            if i > 0 and i % n_stride == 0:\n                dep_centers.append(s)\n\n            # --- Calculate forces ---\n            # Force from the static potential F(s)\n            force_F = -(4 * a * s**3 - 2 * b * s + c)\n            \n            # Force from the time-dependent bias potential V_bias(s,t)\n            force_V = 0.0\n            if dep_centers:\n                centers_arr = np.array(dep_centers)\n                diff = s - centers_arr\n                exp_term = np.exp(-diff**2 / (2 * sigma**2))\n                force_V = np.sum(w0 * exp_term * diff / sigma**2)\n\n            total_force = force_F + force_V\n            \n            # --- Evolve position using Euler-Maruyama ---\n            s += total_force * dt + np.sqrt(2 * dt) * np.random.randn()\n\n            # --- Apply reflecting boundaries ---\n            # Using a while loop is safer for large steps, though unlikely here\n            while s > L or s  -L:\n                if s > L:\n                    s = 2 * L - s\n                if s  -L:\n                    s = -2 * L - s\n        \n        # --- 3. Reweighting and Analysis ---\n        analysis_start_idx = N_steps // 2\n        analysis_traj = traj[analysis_start_idx:]\n        \n        block_size = len(analysis_traj) // M\n        delta_G_blocks = []\n\n        for j in range(M):\n            block_start = j * block_size\n            block_end = (j + 1) * block_size\n            \n            sum_weights_A, sum_weights_B = 0.0, 0.0\n            \n            for k in range(block_start, block_end):\n                s_k = analysis_traj[k]\n                global_step_idx = analysis_start_idx + k\n                \n                # V_bias(s_k, t_k) includes only Gaussians deposited *before* step k\n                num_gauss_before = (global_step_idx - 1) // n_stride if global_step_idx > 0 else 0\n                centers_to_use = dep_centers[:num_gauss_before]\n\n                v_bias_k = 0.0\n                if centers_to_use:\n                    centers_arr = np.array(centers_to_use)\n                    diff_sq = (s_k - centers_arr)**2\n                    v_bias_k = np.sum(w0 * np.exp(-diff_sq / (2 * sigma**2)))\n                \n                weight_k = np.exp(v_bias_k)\n                \n                if s_k  0:\n                    sum_weights_A += weight_k\n                else:\n                    sum_weights_B += weight_k\n\n            # Avoid division by zero or log of zero if a basin was not sampled\n            if sum_weights_A > 1e-12 and sum_weights_B > 1e-12:\n                ratio = sum_weights_B / sum_weights_A\n                delta_G_blocks.append(-np.log(ratio))\n\n        if len(delta_G_blocks)  2: # Need at least 2 blocks to calculate std dev\n             results.append(False)\n             continue\n        \n        # --- 4. Calculate Final Estimate and Error ---\n        delta_G_est = np.mean(delta_G_blocks)\n        std_err = np.std(delta_G_blocks, ddof=1) / np.sqrt(len(delta_G_blocks))\n\n        # --- 5. Verify against Reference ---\n        passed = abs(delta_G_est - delta_G_ref) = 2 * std_err\n        results.append(passed)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == '__main__':\n    solve()\n```", "id": "2655481"}, {"introduction": "许多重要的分子运动，例如二面角旋转，都是由周期性集体变量来描述的。本练习旨在解决一个关键的实现难题：如何在圆形域上放置偏置高斯势垒，而又不在边界处产生人为的能量壁垒。正确处理集体变量空间的拓扑结构对于获得准确的自由能面至关重要[@problem_id:2655418]。", "problem": "一个分子系统通过元动力学（metadynamics）方法沿着一个定义为二面角的一维集体变量（CV）被施加偏置。该CV在圆上取值，我们将其参数化为角度 $s \\in (-\\pi, \\pi]$，其基本周期为 $L = 2\\pi$。在元动力学中，每个沉积的势垒都会贡献一个以访问过的CV值为中心的核函数，通常取为高度为 $w$、宽度参数为 $\\sigma$ 的高斯函数，其值仅取决于瞬时CV值 $s$ 和势垒中心 $s_0$ 之间的距离。在无界直线上，一个自然的选择是欧几里得距离差 $s - s_0$，但在周期性域上，相关的距离是圆上的测地线距离。如果距离函数的选择与拓扑结构不一致，累积的偏置势会在角度边界 $s = \\pm \\pi$ 附近出现人为的势垒。\n\n假设目标是定义一个单一势垒的贡献 $V(s \\mid s_0)$，该贡献对于变量 $s$ 是 $2\\pi$ 周期的、连续的，并通过采用适用于圆的最小镜像约定来避免在边界 $s = \\pm \\pi$ 处产生人为势垒。考虑以下几种在 $s_0$ 处沉积一个高度为 $w$、宽度为 $\\sigma$ 的高斯势垒的候选方案：\n\nA. $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{(s - s_0)^2}{2\\sigma^2}\\right)$。\n\nB. 定义最小镜像角差 $\\Delta_p = (s - s_0) - 2\\pi \\,\\mathrm{round}\\!\\left(\\dfrac{s - s_0}{2\\pi}\\right)$，并设置 $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{\\Delta_p^2}{2\\sigma^2}\\right)$，其中 $\\mathrm{round}(\\cdot)$ 表示四舍五入到最近的整数。\n\nC. 定义 $\\Delta_p = \\mathrm{atan2}\\!\\big(\\sin(s - s_0), \\cos(s - s_0)\\big)$，并设置 $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{\\Delta_p^2}{2\\sigma^2}\\right)$，其中 $\\mathrm{atan2}(y,x)$ 是双参数反正切函数，返回一个在 $(-\\pi, \\pi]$ 区间内的角度。\n\nD. $V(s \\mid s_0) = w \\displaystyle\\sum_{k=-\\infty}^{\\infty} \\exp\\!\\left(-\\dfrac{(s - s_0 + 2\\pi k)^2}{2\\sigma^2}\\right)$。\n\nE. 令 $\\Delta_m = \\mathrm{mod}(s - s_0, 2\\pi)$，即在 $[0, 2\\pi)$ 区间内的余数，并设置 $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{\\Delta_m^2}{2\\sigma^2}\\right)$。\n\nF. 将圆嵌入为 $\\mathbf{r}(s) = (\\cos s, \\sin s)$ 并设置 $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{\\|\\mathbf{r}(s) - \\mathbf{r}(s_0)\\|^2}{2\\sigma^2}\\right)$。\n\n哪些选项通过使用最小镜像约定，为任意的 $s$ 和 $s_0$ 在周期性CV上正确地实现了高斯势垒的沉积，从而避免了在边界处产生人为势垒？选择所有适用的选项。\n\n为具体起见，你也可以通过考虑 $w = 1$，$\\sigma = 0.05$， $s_0 = \\pi - \\delta$，$s = -\\pi + \\delta$，其中 $\\delta = 2^\\circ = \\pi/90$ 的情况来检验你的推理，并判断该方案是否会给出一个对应于小的测地线分离 $\\delta$ 而非大的欧几里得距离差的较大贡献值。然而，你的选择应基于该方案的普适有效性，而不仅仅是基于这个数值例子。\n\n选项：\nA. 如上所述。\nB. 如上所述。\nC. 如上所述。\nD. 如上所述。\nE. 如上所述。\nF. 如上所述。", "solution": "必须首先验证问题陈述的科学性和逻辑完整性。\n\n### 第1步：提取已知条件\n-   **系统**：一个具有一维集体变量（CV）$s$ 的分子系统。\n-   **CV空间**：该CV是一个二面角，是一个圆上的周期性变量。该空间被参数化为 $s \\in (-\\pi, \\pi]$，周期为 $L = 2\\pi$。\n-   **方法**：元动力学，通过添加排斥性核函数（“势垒”）来对系统施加偏置。\n-   **势垒属性**：每个势垒是一个高度为 $w$、宽度参数为 $\\sigma$ 的高斯核函数。核函数的值取决于当前CV位置 $s$ 与势垒中心 $s_0$ 之间的距离。\n-   **核心要求**：距离函数必须是圆上的测地线距离（最短弧长），以确保累积的偏置势是周期性和连续的，从而避免在周期性边界 $s = \\pm \\pi$ 处出现人为势垒。这被称为“最小镜像约定”。\n-   **目标**：确定所提出的数学公式 $V(s \\mid s_0)$ 中，哪一个使用最小镜像约定在周期性CV上正确地实现了一个单一高斯势垒的沉积。\n\n### 第2步：使用提取的已知条件进行验证\n-   **科学依据**：该问题在计算化学和物理学的理论和实践中有充分的依据。元动力学是一种标准的增强采样技术，而周期性CV的正确处理是一个关键且不简单的实现细节。测地线距离和最小镜像约定的概念在此背景下是标准的。该问题在化学和数学上都是合理的。\n-   **适定性**：该问题是适定的。它要求根据一组清晰的物理和数学标准（周期性、连续性、测地线距离的使用、高斯形式）来评估几个明确的数学公式。可以确定一组明确的正确选项。\n-   **客观性**：该问题使用精确的数学语言和定义进行陈述。没有歧义或主观性。\n\n### 第3步：结论和行动\n问题陈述是有效的。这是分子模拟方法实现中的一个标准的、定义明确的问题。我现在将对每个选项进行详细的推导和评估。\n\n### 基于原理的推导\n基本任务是在圆上定义一个高斯函数。高斯函数的形式为 $f(x) \\propto \\exp(-d(x, x_c)^2 / (2\\sigma^2))$，其中 $d(x, x_c)$ 是点 $x$ 到中心 $x_c$ 的距离。对于周长为 $L=2\\pi$ 的圆，具有角坐标 $s$ 和 $s_0$ 的两点之间的距离是测地线距离，即连接它们的较短弧的长度。\n\n设角度差为 $\\Delta = s - s_0$。在周期性边界条件下，与 $\\Delta$ 等效的所有角度差的集合是 $\\{\\Delta + 2\\pi k \\mid k \\in \\mathbb{Z}\\}$。最小镜像约定要求我们找到这个差值中绝对值最小的特定表示。这就是带符号的最短弧长，我们记为 $\\Delta_p$。\n$$\n\\Delta_p = \\arg\\min_{\\Delta' \\in \\{\\Delta + 2\\pi k \\mid k \\in \\mathbb{Z}\\}} |\\Delta'|\n$$\n这个最小带符号距离 $\\Delta_p$ 必须位于区间 $(-\\pi, \\pi]$ 内。测地线距离的平方则为 $\\Delta_p^2$。一个正确表述的周期性高斯势垒应具有以下形式：\n$$\nV(s \\mid s_0) = w \\exp\\left(-\\frac{\\Delta_p^2}{2\\sigma^2}\\right)\n$$\n我们现在必须评估所提出的选项中，哪一个正确地计算了 $\\Delta_p$ 并以此形式使用它。\n\n### 逐项分析\n\n**A. $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{(s - s_0)^2}{2\\sigma^2}\\right)$.**\n此公式使用实线上的标准欧几里得距离 $s-s_0$。该函数对于变量 $s$ 不是以 $2\\pi$ 为周期的。例如，$V(s+2\\pi \\mid s_0) \\neq V(s \\mid s_0)$。它未能识别出 $s = -\\pi + \\delta$ 和 $s' = \\pi - \\delta$ 在圆上是接近的。如果 $s_0 = \\pi-\\delta$，到 $s=-\\pi+\\delta$ 的距离被计算为 $|(-\\pi+\\delta) - (\\pi-\\delta)| = |-2\\pi+2\\delta| \\approx 2\\pi$，这是一个很大的距离，导致势能贡献趋近于零。这会在 $s=\\pm\\pi$ 边界处产生一个人为势垒。\n**结论：错误。**\n\n**B. 定义最小镜像角差 $\\Delta_p = (s - s_0) - 2\\pi \\,\\mathrm{round}\\!\\left(\\dfrac{s - s_0}{2\\pi}\\right)$，并设置 $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{\\Delta_p^2}{2\\sigma^2}\\right)$，其中 $\\mathrm{round}(\\cdot)$ 表示四舍五入到最近的整数。**\n这个方案通过从原始差值 $s-s_0$ 中减去最接近它的 $2\\pi$ 的倍数来定义 $\\Delta_p$。此操作将任何实数映射到区间 $[-\\pi, \\pi]$。这是周长为 $2\\pi$ 的圆上带符号的最小镜像距离的正确数学定义。因此，得到的势 $V(s \\mid s_0)$ 是正确的测地线距离的高斯函数，满足所有要求。\n**结论：正确。**\n\n**C. 定义 $\\Delta_p = \\mathrm{atan2}\\!\\big(\\sin(s - s_0), \\cos(s - s_0)\\big)$，并设置 $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{\\Delta_p^2}{2\\sigma^2}\\right)$，其中 $\\mathrm{atan2}(y,x)$ 是双参数反正切函数，返回一个在 $(-\\pi, \\pi]$ 区间内的角度。**\n$\\mathrm{atan2}(y,x)$ 函数计算由向量 $(x,y)$ 与x轴正方向所形成的角度的主值。对于角度 $\\phi = s-s_0$，向量 $(\\cos(\\phi), \\sin(\\phi))$ 在单位圆上指向 $\\phi$ 方向。$\\mathrm{atan2}$ 函数正确地恢复了这个角度，并将其包裹在标准区间 $(-\\pi, \\pi]$ 内。因此，该过程在数学上与选项 B 中的过程等效，并且是计算带符号的最小镜像距离 $\\Delta_p$ 的一种常见的、数值上稳健的方法。该势的公式是正确的。\n**结论：正确。**\n\n**D. $V(s \\mid s_0) = w \\displaystyle\\sum_{k=-\\infty}^{\\infty} \\exp\\!\\left(-\\dfrac{(s - s_0 + 2\\pi k)^2}{2\\sigma^2}\\right)$.**\n此表达式通过对一个高斯核及其所有周期性镜像求和来构造一个周期函数。这被称为“镜像求和”或“周期化”方法。虽然这确实能生成一个光滑的、$2\\pi$ 周期的函数，避免了边界伪影，但它并未严格遵守问题陈述的方法论。问题指明了要“采用最小镜像约定”，这通常指的是像选项B和C那样对最短距离进行显式计算。“镜像求和”是另一种不同（但相关）的约定。此外，得到的函数是多个高斯函数的和，在最严格的意义上，它不是测地线距离的单一高斯函数，即其对数不是 $\\Delta_p$ 的二次函数。为了保证绝对的正确性，这些区别很重要。\n**结论：错误。**\n\n**E. 令 $\\Delta_m = \\mathrm{mod}(s - s_0, 2\\pi)$，即在 $[0, 2\\pi)$ 区间内的余数，并设置 $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{\\Delta_m^2}{2\\sigma^2}\\right)$。**\n按定义返回 $[0, 2\\pi)$ 区间内值的模运算符，并不计算最短距离。例如，如果 $s_0=0$ 且 $s = -\\epsilon$ (其中 $\\epsilon > 0$ 是一个小数)，真实的测地线距离是 $\\epsilon$。然而，此公式计算出 $\\Delta_m = \\mathrm{mod}(-\\epsilon, 2\\pi) = 2\\pi-\\epsilon$，这是一个很大的距离。当 $s-s_0$ 经过 $2\\pi$ 的整数倍时，函数 $\\Delta_m(s)$ 会有跳跃间断点，这会转化为势能面上的一个“悬崖”。这是实现周期性边界时的一个经典错误。\n**结论：错误。**\n\n**F. 将圆嵌入为 $\\mathbf{r}(s) = (\\cos s, \\sin s)$ 并设置 $V(s \\mid s_0) = w \\exp\\!\\left(-\\dfrac{\\|\\mathbf{r}(s) - \\mathbf{r}(s_0)\\|^2}{2\\sigma^2}\\right)$。**\n此方法使用在二维嵌入空间中单位圆上两点之间的欧几里得距离的平方（即弦长的平方）。让我们计算这个距离：$\\|\\mathbf{r}(s) - \\mathbf{r}(s_0)\\|^2 = (\\cos s - \\cos s_0)^2 + (\\sin s - \\sin s_0)^2 = 2 - 2\\cos(s - s_0)$。势能变为 $V(s \\mid s_0) = w \\exp(-\\frac{2(1 - \\cos(s - s_0))}{2\\sigma^2})$。测地线距离是 $\\Delta_p$，而弦长与 $\\sin(\\Delta_p/2)$ 相关。该势是 $\\cos(\\Delta_p)$ 的函数，被称为冯·米塞斯核（von Mises kernel）。它不是高斯核，高斯核必须是 $\\Delta_p^2$ 的函数。虽然这是一个有效的、解决了边界问题的周期性核函数，但它不具有相对于测地线距离所指定的高斯函数形式。\n**结论：错误。**", "answer": "$$\\boxed{BC}$$", "id": "2655418"}, {"introduction": "一次成功的元动力学模拟能提供一幅清晰的自由能形貌图，但模拟结果常常会包含一些令人困惑的伪影，这些伪影暗示了模拟设置中存在问题。最后一个练习聚焦于“解读”自由能面的关键技能。我们将分析一种常见的伪影——持续存在的条纹——来理解它揭示了关于集体变量选择和系统底层动力学的哪些信息[@problem_id:2455413]。", "problem": "您在一个具有亚稳态的分子系统上进行了一次$2$维适温元动力学模拟，对两个集体变量（CV）$s_1$和$s_2$进行偏置，其中集体变量（CV）是原子坐标$\\mathbf{R}$的函数$s(\\mathbf{R})$，旨在参数化慢模式。偏置势$V(\\mathbf{s}, t)$通过在固定的时间间隔内，在访问过的CV空间$\\mathbf{s} = (s_1, s_2)$中沉积高斯山来构建，而自由能面（FES）$F(s_1, s_2)$在长时间极限下由累积的偏置重建。经过长时间的模拟后，重建的$2$维FES显示出持续存在的窄带，表现为在很宽的$s_1$值范围内平行于$s_1$轴的“条纹”，而主要随$s_2$变化。所有算法参数，如高斯山高度$w$、宽度$\\boldsymbol{\\sigma}$和沉积步长都在普遍接受的范围内，并在整个过程中保持不变。关于CV的选择，哪种说法最能描述这种人为现象所表明的情况？\n\nA. $s_1$或$s_2$中至少有一个没有与相关的慢自由度耦合，因此有效自由能基本上是另一个CV的$1$维函数；一个缺失的慢坐标没有被所选的CV对捕获。\n\nB. 高斯山高度$w$太大，导致过度填充和人为的带状结构；CV是合适的，但仅偏置幅度就导致了条纹。\n\nC. 两个CV $s_1$和$s_2$强相关；条纹源于冗余信息，如果进行正交化而不改变偏置的物理坐标，条纹就会消失。\n\nD. 模拟时间太短；只要时间足够长，即使CV保持不变，条纹也终将消失，因为元动力学保证了CV空间中的均匀填充，而不管CV的质量如何。", "solution": "在尝试任何解决方案之前，应对问题陈述进行验证。\n\n### 第1步：提取已知条件\n- 模拟技术：$2$维适温元动力学。\n- 系统描述：具有亚稳态的分子系统。\n- 偏置变量：两个集体变量（CV），表示为$s_1$和$s_2$。\n- CV的定义：原子坐标$\\mathbf{R}$的函数$s(\\mathbf{R})$，旨在参数化慢模式。\n- 偏置势：$V(\\mathbf{s}, t)$由CV空间$\\mathbf{s} = (s_1, s_2)$中的高斯山构建。\n- 自由能面（FES）：$F(s_1, s_2)$在长时间极限下由累积的偏置重建。\n- 关键观察：重建的$2$维FES表现出“在很宽的$s_1$值范围内平行于$s_1$轴的持续存在的窄带，看起来像‘条纹’，而主要随$s_2$变化”。\n- 算法参数：高斯山高度$w$、宽度$\\boldsymbol{\\sigma}$和沉积步长在标准范围内且恒定。\n\n### 第2步：使用提取的已知条件进行验证\n该问题描述了计算化学中一个利用适温元动力学方法的常见情景。术语——集体变量、自由能面、亚稳态、高斯山——都是标准的，并且使用正确。观察到的人为现象，即重建FES上的“条纹”，是一个有据可查的现象，对其的解释是理解增强采样方法局限性的一个标准练习。\n\n1.  **科学或事实上的不健全**：该问题在科学和事实上是健全的。它基于统计力学的既定原理和元动力学理论。\n2.  **不可形式化或不相关**：该问题与其所述领域（计算化学、增强采样）高度相关，并且在该背景下易于形式化。\n3.  **不完整或矛盾的设置**：该问题提供了足够的信息来诊断潜在问题，没有内部矛盾。对人为现象的描述清晰，并指向CV选择中的一类特定问题。\n4.  **不切实际或不可行**：该情景是现实的，在实践中经常遇到。\n5.  **不适定或结构不良**：该问题是适定的，术语清晰，问题允许根据所提供的信息得出一个明确且理由充分的答案。\n6.  **超出科学可验证性**：这些主张和预期答案可通过理论分析和计算实验进行验证。\n\n### 第3步：结论和行动\n问题陈述是**有效的**。将推导解决方案。\n\n### 基于原理的推导\n元动力学模拟的目标是重建作为一组集体变量（CV）$\\mathbf{s}$的函数的自由能面（FES）$F(\\mathbf{s})$。FES通过统计力学的基本关系与CV的平衡概率分布$\\Pi(\\mathbf{s})$相关联：\n$$F(\\mathbf{s}) = -k_B T \\ln \\Pi(\\mathbf{s}) + C$$\n其中$k_B$是玻尔兹曼常数，$T$是温度，$C$是一个任意常数。\n\n元动力学通过向系统的势能中添加一个历史依赖的偏置势$V(\\mathbf{s}, t)$来实现这一点。在理想的长时间极限下，并且假如CV $\\mathbf{s}$捕获了所有相关的慢自由度，累积的偏置势会收敛到FES的负值：\n$$V(\\mathbf{s}, t \\to \\infty) \\approx -F(\\mathbf{s}) + C'$$\n\n问题陈述指出，重建的FES $F(s_1, s_2)$表现出平行于$s_1$轴的“条纹”。这是一个精确的描述，意味着对于任意给定的$s_2$值，重建的自由能沿着$s_1$坐标近似恒定。数学上，这意味着在广阔的区域内$\\frac{\\partial F}{\\partial s_1} \\approx 0$。FES实际上仅是$s_2$的$1$维函数：$F(s_1, s_2) \\approx f(s_2)$。\n\n这个观察具有直接的物理意义。沿着某个坐标的平坦自由能剖面意味着沿着该坐标的运动不受显著能垒的限制。这种运动是快速的。如果$s_1$是一个合适的慢坐标（一个“反应坐标”），我们期望看到沿着它有显著的自由能垒，对应于亚稳态之间的慢转变。这种特征的缺失表明$s_1$没有与任何慢过程耦合；它是一个快自由度。在元动力学沉积的时间尺度上，系统对$s_1$坐标的平均速度如此之快，以至于偏置势几乎均匀地填充了其整个范围，导致重建的剖面是平坦的。\n\n沿着$s_2$的变化表明$s_2$至少部分地与一个慢过程耦合，这就是为什么元动力学能够在该方向上解析出非平凡的剖面。然而，条纹状人为现象的持续存在指向一个更深层次的问题。元动力学的收敛依赖于在CV值给定的条件下，未偏置自由度空间中的遍历性假设。如果存在另一个慢坐标，我们称之为$s_3$，它没有被包含在偏置集$\\{s_1, s_2\\}$中，系统可能会被这个隐藏变量$s_3$定义的势阱动力学捕获。模拟将只对总相空间的一个子区域进行采样。元动力学偏置将填充*在该捕获区域内*投影到$(s_1, s_2)$平面上的FES。如果系统最终通过罕见的热涨落，越过了未偏置的$s_3$坐标上的能垒，它将跳到相空间的一个新区域。在这个新区域，元动力学过程将重新开始。重建的FES将是这些不连通探索的叠加，通常表现为明显的带状或条纹。\n\n因此，观察到的人为现象表明两件事：\n1. CV $s_1$是一个糟糕的选择，很可能是一个快速、不相关的变量。\n2. 一个区分所有相关亚稳态所必需的关键慢自由度，在所选的CV集合中缺失了。\n\n### 逐项分析\n\n**A. $s_1$或$s_2$中至少有一个没有与相关的慢自由度耦合，因此有效自由能基本上是另一个CV的$1$维函数；一个缺失的慢坐标没有被所选的CV对捕获。**\n- **分析**：这个说法正确地指出了两个关键问题。FES沿$s_1$方向的平坦性表明$s_1$没有与慢过程耦合，使得FES实际上是$s_2$的$1$维函数。这种条纹结构的持续存在是由于缺少一个未被偏置的慢坐标而引起的非遍历性的典型症状。此选项提供了最完整和准确的诊断。\n- **结论**：**正确**。\n\n**B. 高斯山高度$w$太大，导致过度填充和人为的带状结构；CV是合适的，但仅偏置幅度就导致了条纹。**\n- **分析**：过大的高斯山高度$w$（或等效地，适温元动力学中过大的偏置因子）会导致另一类人为现象。它会导致偏置被过分激进地添加，常常阻碍收敛并导致大的、嘈杂的涨落或势阱的“过度填充”。然而，它通常不会产生与CV轴对齐的高度结构化、持续的条纹图案。这种特定的、方向性的人为现象是CV本身存在根本问题的特征，而不仅仅是参数调整的问题。问题陈述还指出参数在合理范围内。\n- **结论**：**不正确**。\n\n**C. 两个CV $s_1$和$s_2$强相关；条纹源于冗余信息，如果进行正交化而不改变偏置的物理坐标，条纹就会消失。**\n- **分析**：如果$s_1$和$s_2$强相关，系统在$(s_1, s_2)$平面上的轨迹将被限制在一个狭窄的、通常是倾斜的区域。重建的FES将沿着这个对角线显示一个低能路径，而不是平行于$s_1$轴且跨越很宽$s_1$范围的条纹。观察到条纹“在很宽的$s_1$值范围内”出现，这直接与强相关的前提相矛盾，因为强相关会限制探索的范围。\n- **结论**：**不正确**。\n\n**D. 模拟时间太短；只要时间足够长，即使CV保持不变，条纹也终将消失，因为元动力学保证了CV空间中的均匀填充，而不管CV的质量如何。**\n- **分析**：这个说法存在根本性缺陷。元动力学的收敛保证是以CV包含了所研究过程的所有相关慢自由度为条件的。如果缺少一个慢坐标，系统在任何实际的模拟时间尺度上在整个相空间中都不是遍历的。模拟会陷入由未偏置的慢坐标的状态所定义的区域中。条纹是这种缺乏遍历性的直接后果，并且被描述为“持续的”，意味着它们*不会*随着更长的模拟时间而消失。“元动力学无论CV质量如何都能工作”这个前提是错误的。\n- **结论**：**不正确**。", "answer": "$$\\boxed{A}$$", "id": "2455413"}]}