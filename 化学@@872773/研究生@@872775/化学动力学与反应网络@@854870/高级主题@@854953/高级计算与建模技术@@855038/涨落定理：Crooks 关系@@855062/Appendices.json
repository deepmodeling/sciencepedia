{"hands_on_practices": [{"introduction": "理论的生命力在于其在具体模型中的体现。此练习提供了一个绝佳的“纸上谈兵”机会，让你在一个精确可解的系统中——即谐振子势阱中的 Ornstein-Uhlenbeck 过程——亲自推导功分布。通过解析地验证 Crooks 关系，你将对非平衡功与平衡自由能之间的深刻联系建立起坚实的物理直觉。[@problem_id:2644011]", "problem": "考虑一个单一反应坐标 $x$，它在一个一维谐振子势 $U(x,t)=\\frac{1}{2}k(t)x^{2}$ 中，在恒定温度 $T$ 下，作为一个 Ornstein–Uhlenbeck 过程演化，其动力学由过阻尼 Langevin 方程 $\\gamma\\,\\dot{x}(t)=-k(t)\\,x(t)+\\xi(t)$ 决定，其中 $\\gamma$ 是摩擦系数，$\\xi(t)$ 是高斯白噪声，满足 $\\langle \\xi(t)\\rangle=0$ 和 $\\langle \\xi(t)\\xi(t')\\rangle=2\\gamma k_{B}T\\,\\delta(t-t')$，$k_{B}$ 为 Boltzmann 常数。系统初始时在一个劲度系数为 $k_{i}0$ 的谐振子势阱中达到平衡，因此 $x$ 遵循逆温度为 $\\beta=1/(k_{B}T)$ 的正则平衡分布。在时刻 $t=0$，势阱劲度系数被瞬时淬火至 $k_{f}k_{i}$（一个正向协议）。对于瞬时淬火，对系统做的随机功 $W$ 等于淬火瞬间的势能变化，即 $W=\\Delta U=\\frac{1}{2}\\left(k_{f}-k_{i}\\right)x_{0}^{2}$，其中 $x_{0}$ 是淬火前的坐标。\n\n将逆向协议定义为一个时间反演过程，该过程从一个劲度系数为 $k_{f}$ 的势阱在相同温度 $T$ 下的平衡态开始，并瞬时淬火至 $k_{i}$，产生随机功 $W_{R}=\\frac{1}{2}\\left(k_{i}-k_{f}\\right)x_{0}'^{2}$。\n\n仅使用平衡统计力学和随机能量学的基本定义，完成以下步骤：\n\n1. 推导在正向协议下功 $W$ 的概率密度 $P_{F}(W)$，以 $W$、$\\beta$、$k_{i}$ 和 $k_{f}$ 的封闭解析形式表示。\n2. 推导在逆向协议下产生的功的相反数对应的密度 $P_{R}(-W)$。\n3. 从正则配分函数计算劲度系数为 $k_{f}$ 和 $k_{i}$ 的谐振子势阱之间的平衡自由能差 $\\Delta F=F_{f}-F_{i}$。\n4. 确定比率 $P_{F}(W)/P_{R}(-W)$ 的显式表达式，并在连接非平衡过程中功和自由能的涨落关系的背景下解释你的结果。\n\n将你的最终答案表示为 $P_{F}(W)$ 作为 $W$ 和模型参数的函数的显式公式。不需要进行数值计算，也不需要四舍五入。假设 $k_{f}k_{i}$，因此在正向淬火下 $W\\ge 0$。所有结果均以符号形式表示；最终答案中不要包含单位。", "solution": "我们从一维谐振子势的正则平衡分布开始。对于劲度系数 $k>0$ 和逆温度 $\\beta=1/(k_{B}T)$， $x$ 的平衡密度为\n$$\np_{\\text{eq}}^{(k)}(x)=\\sqrt{\\frac{\\beta k}{2\\pi}}\\exp\\!\\left(-\\frac{1}{2}\\beta k x^{2}\\right).\n$$\n因此，在正向协议下，$x_{0}$ 服从均值为 $0$、方差为 $\\sigma_{i}^{2}=\\langle x_{0}^{2}\\rangle=\\frac{1}{\\beta k_{i}}$ 的高斯分布。\n\n因为淬火是瞬时的，随机功由固定状态 $x_{0}$ 下因参数变化引起的哈密顿量变化定义：\n$$\nW=\\Delta U=\\frac{1}{2}\\left(k_{f}-k_{i}\\right)x_{0}^{2}.\n$$\n令 $\\Delta k\\equiv k_{f}-k_{i}>0$。那么 $W=\\frac{\\Delta k}{2}\\,x_{0}^{2}\\ge 0$。为了得到 $W$ 的分布，我们需要高斯变量 $x_{0}$ 的平方的分布。如果 $X\\sim \\mathcal{N}(0,\\sigma^{2})$，那么 $Y\\equiv X^{2}$ 的密度为\n$$\nf_{Y}(y)=\\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,y^{-1/2}\\exp\\!\\left(-\\frac{y}{2\\sigma^{2}}\\right),\\quad y\\ge 0.\n$$\n在我们的例子中，$\\sigma=\\sigma_{i}=\\sqrt{\\frac{1}{\\beta k_{i}}}$ 且 $Y=x_{0}^{2}$。根据 $W=\\frac{\\Delta k}{2}\\,Y$，由变量替换公式可得，对于 $w\\ge 0$，\n$$\nP_{F}(w)=\\frac{1}{a}\\,f_{Y}\\!\\left(\\frac{w}{a}\\right),\\quad a\\equiv \\frac{\\Delta k}{2}.\n$$\n代入这些表达式，\n$$\nP_{F}(w)=\\frac{1}{\\sqrt{2\\pi}\\,\\sigma_{i}}\\,a^{-1}\\left(\\frac{w}{a}\\right)^{-1/2}\\exp\\!\\left[-\\frac{1}{2\\sigma_{i}^{2}}\\left(\\frac{w}{a}\\right)\\right].\n$$\n化简后，\n$$\nP_{F}(w)=\\frac{1}{\\sqrt{2\\pi}\\,\\sigma_{i}}\\,a^{-1/2}\\,w^{-1/2}\\,\\exp\\!\\left(-\\frac{w}{2a\\sigma_{i}^{2}}\\right).\n$$\n使用 $a=\\frac{\\Delta k}{2}$ 和 $\\sigma_{i}^{2}=\\frac{1}{\\beta k_{i}}$，我们得到\n$$\nP_{F}(w)=\\frac{1}{\\sqrt{\\pi}\\,\\sigma_{i}\\sqrt{\\Delta k}}\\,w^{-1/2}\\,\\exp\\!\\left(-\\frac{w}{\\Delta k\\,\\sigma_{i}^{2}}\\right)\n=\\sqrt{\\frac{\\beta k_{i}}{\\pi\\,\\Delta k}}\\,w^{-1/2}\\,\\exp\\!\\left(-\\frac{\\beta k_{i}}{\\Delta k}\\,w\\right),\\quad w\\ge 0.\n$$\n\n对于逆向协议，$x_{0}'$ 是从劲度系数为 $k_{f}$ 的平衡态中抽取的，即一个方差为 $\\sigma_{f}^{2}=\\frac{1}{\\beta k_{f}}$ 的高斯变量。逆向功为\n$$\nW_{R}=\\frac{1}{2}(k_{i}-k_{f})\\,x_{0}'^{2}=-\\frac{\\Delta k}{2}\\,x_{0}'^{2}\\le 0,\n$$\n因此 $-W_{R}=\\frac{\\Delta k}{2}\\,x_{0}'^{2}\\ge 0$。对 $\\sigma_{f}$ 重复同样的变量替换，我们发现\n$$\nP_{R}(-w)=\\sqrt{\\frac{\\beta k_{f}}{\\pi\\,\\Delta k}}\\,w^{-1/2}\\,\\exp\\!\\left(-\\frac{\\beta k_{f}}{\\Delta k}\\,w\\right),\\quad w\\ge 0.\n$$\n\n接下来，我们从正则配分函数计算两个谐振子势阱之间的平衡自由能差。一个一维谐振子势 $U(x)=\\frac{1}{2}k x^{2}$ 的配分函数是\n$$\nZ(k)=\\int_{-\\infty}^{\\infty}\\mathrm{d}x\\,\\exp\\!\\left(-\\beta \\frac{1}{2}k x^{2}\\right)=\\sqrt{\\frac{2\\pi}{\\beta k}}.\n$$\n因此，Helmholtz 自由能 $F(k)$ 是\n$$\nF(k)=-\\beta^{-1}\\ln Z(k)=-\\beta^{-1}\\left[\\frac{1}{2}\\ln\\!\\left(\\frac{2\\pi}{\\beta k}\\right)\\right],\n$$\n自由能差为\n$$\n\\Delta F\\equiv F_{f}-F_{i}=-\\beta^{-1}\\left[\\frac{1}{2}\\ln\\!\\left(\\frac{2\\pi}{\\beta k_{f}}\\right)-\\frac{1}{2}\\ln\\!\\left(\\frac{2\\pi}{\\beta k_{i}}\\right)\\right]\n=\\frac{1}{2\\beta}\\ln\\!\\left(\\frac{k_{f}}{k_{i}}\\right).\n$$\n\n最后，我们计算比率 $P_{F}(w)/P_{R}(-w)$：\n$$\n\\frac{P_{F}(w)}{P_{R}(-w)}=\\frac{\\sqrt{\\frac{\\beta k_{i}}{\\pi\\,\\Delta k}}\\,w^{-1/2}\\,\\exp\\!\\left(-\\frac{\\beta k_{i}}{\\Delta k}\\,w\\right)}{\\sqrt{\\frac{\\beta k_{f}}{\\pi\\,\\Delta k}}\\,w^{-1/2}\\,\\exp\\!\\left(-\\frac{\\beta k_{f}}{\\Delta k}\\,w\\right)}\n=\\sqrt{\\frac{k_{i}}{k_{f}}}\\,\\exp\\!\\left(\\frac{\\beta (k_{f}-k_{i})}{\\Delta k}\\,w\\right).\n$$\n因为 $\\Delta k=k_{f}-k_{i}$，上式可化简为\n$$\n\\frac{P_{F}(w)}{P_{R}(-w)}=\\sqrt{\\frac{k_{i}}{k_{f}}}\\,\\exp\\!\\left(\\beta w\\right).\n$$\n使用 $\\beta\\Delta F=\\frac{1}{2}\\ln\\!\\left(\\frac{k_{f}}{k_{i}}\\right)$，我们可以将\n$$\n\\sqrt{\\frac{k_{i}}{k_{f}}}=\\exp\\!\\left(-\\frac{1}{2}\\ln\\!\\frac{k_{f}}{k_{i}}\\right)=\\exp\\!\\left(-\\beta\\Delta F\\right),\n$$\n重写为\n$$\n\\frac{P_{F}(w)}{P_{R}(-w)}=\\exp\\!\\left[\\beta w-\\beta\\Delta F\\right].\n$$\n这正是 Crooks 涨落定理 (CFT) 所预测的结构，该定理指出，正向功分布与在负功值处取值的逆向功分布之比，等于耗散功（即功减去平衡自由能差）的指数。\n\n因此，瞬时劲度系数淬火的正向功分布的封闭形式表达式为\n$$\nP_{F}(w)=\\sqrt{\\frac{\\beta k_{i}}{\\pi\\,\\Delta k}}\\,w^{-1/2}\\,\\exp\\!\\left(-\\frac{\\beta k_{i}}{\\Delta k}\\,w\\right),\\quad w\\ge 0,\\quad \\Delta k=k_{f}-k_{i}>0.\n$$\n这个分布，连同其逆向对应部分以及计算出的 $\\Delta F$，在一个谐振子反应坐标模型中，为这个非平衡协议解析地验证了 Crooks 涨落定理。", "answer": "$$\\boxed{\\sqrt{\\frac{\\beta k_{i}}{\\pi\\left(k_{f}-k_{i}\\right)}}\\,W^{-1/2}\\,\\exp\\!\\left(-\\frac{\\beta k_{i}}{k_{f}-k_{i}}\\,W\\right)}$$", "id": "2644011"}, {"introduction": "从解析的理想情况过渡到更普遍的场景，我们常常需要借助计算机的力量。这项实践将指导你编写程序，通过精确的随机模拟算法来复现一个被外部协议驱动的化学反应过程。通过亲手计算随机轨迹上的功并从统计数据中检验 Crooks 关系，你将掌握将理论应用于计算研究的核心技能。[@problem_id:2644035]", "problem": "考虑一个由物种 $A$ 和 $B$ 组成的双态化学反应网络 (CRN)，两者通过单一可逆反应 $A \\rightleftharpoons B$ 连接。该系统被建模为连续时间马尔可夫跳跃过程 (CTMC)。状态 $A$ 的能量为 $E_A(t) \\equiv 0$，状态 $B$ 的能量为 $E_B(t) \\equiv \\Delta E(t)$，其中外部控制的能量差 $\\Delta E(t)$ 在有限时间区间 $t \\in [0, \\tau]$ 内根据一个预设的协议进行变化。逆热能用 $\\beta \\equiv 1/(k_\\mathrm{B} T)$ 表示，其中 $k_\\mathrm{B}$ 是玻尔兹曼常数，$T$ 是温度。在整个问题中，使用无量纲单位，能量以 $k_\\mathrm{B} T$ 为单位，时间以 $1/k_0$ 为单位（如下文所述）；无需进行物理单位转换。\n\n假设局域细致平衡始终成立：瞬时转变速率 $k_{A \\to B}(t)$ 和 $k_{B \\to A}(t)$ 满足\n$$\n\\frac{k_{A \\to B}(t)}{k_{B \\to A}(t)} \\;=\\; e^{-\\beta \\, \\Delta E(t)} \\, .\n$$\n固定对称的类阿伦尼乌斯参数化\n$$\nk_{A \\to B}(t) \\equiv k_0 \\, e^{-\\frac{\\beta}{2} \\Delta E(t)} \\quad \\text{和} \\quad\nk_{B \\to A}(t) \\equiv k_0 \\, e^{+\\frac{\\beta}{2} \\Delta E(t)} \\, ,\n$$\n其中 $k_0 > 0$ 是一个常数速率标度。\n\n对于在时变协议 $\\Delta E(t)$ 下（$t \\in [0,\\tau]$）的一条给定轨迹 $x(t) \\in \\{A,B\\}$，定义协议所做的随机功为黎曼–斯蒂尔杰斯积分\n$$\nW[x(\\cdot)] \\;=\\; \\int_{0}^{\\tau} \\mathbf{1}_{\\{x(t)=B\\}} \\, d\\Delta E(t) \\, ,\n$$\n其中 $\\mathbf{1}_{\\{x(t)=B\\}}$ 是系统在时间 $t$ 占据状态 $B$ 的指示函数。在参数值为 $\\Delta E$ 时的平衡自由能为\n$$\nF(\\Delta E) \\;=\\; -\\frac{1}{\\beta} \\ln\\!\\big( 1 + e^{-\\beta \\Delta E} \\big) \\, ,\n$$\n对于一个从 $\\Delta E(0)=\\Delta E_i$ 变化到 $\\Delta E(\\tau)=\\Delta E_f$ 的协议，其自由能差为 $\\Delta F \\equiv F(\\Delta E_f) - F(\\Delta E_i)$。\n\n您将对功的克鲁克斯涨落定理进行数值检验，该定理指出，对于一个正向协议 $\\Delta E_F(t)$ 及其时间反演的逆向协议 $\\Delta E_R(t) \\equiv \\Delta E_F(\\tau - t)$（其初始系综分别从 $\\Delta E_i$ 和 $\\Delta E_f$ 对应的平衡态中抽取），功的分布 $P_F(W)$ 和 $P_R(W)$ 满足\n$$\n\\frac{P_F(W)}{P_R(-W)} \\;=\\; e^{\\beta \\, (W - \\Delta F)} \\, .\n$$\n\n实现一个程序，该程序：\n- 使用时间非均匀跳跃过程的精确采样，为正向和逆向协议模拟一个独立轨迹的系综。对于正向协议，使用线性斜坡\n$$\n\\Delta E_F(t) \\;=\\; \\Delta E_i + \\frac{\\Delta E_f - \\Delta E_i}{\\tau} \\, t \\, ,\n$$\n对于逆向协议，使用时间反演的线性斜坡\n$$\n\\Delta E_R(t) \\;=\\; \\Delta E_f - \\frac{\\Delta E_f - \\Delta E_i}{\\tau} \\, t \\, .\n$$\n- 从协议起始参数值对应的正则平衡中为每条轨迹抽取初始状态。也就是说，在参数 $\\Delta E$ 下，平衡概率为 $p_A^{\\mathrm{eq}}(\\Delta E) = \\frac{1}{1+e^{-\\beta \\Delta E}}$ 和 $p_B^{\\mathrm{eq}}(\\Delta E) = \\frac{e^{-\\beta \\Delta E}}{1+e^{-\\beta \\Delta E}}$。\n- 使用上述积分定义计算沿每条轨迹所做的功 $W$。\n- 通过直方图估计功的分布 $P_F(W)$ 和 $P_R(W)$，直方图使用固定数量的箱 $n_b$，其公共范围覆盖正向功样本和符号翻转后的逆向功样本。使用 $n_b = 60$。从合并数据 $\\{W_F\\} \\cup \\{-W_R\\}$ 的最小值和最大值构造公共范围。如果此范围的宽度可忽略不计（例如，所有采样功在数值上重合），则将其扩展为围绕零的一个小的对称区间，以避免退化直方图。\n- 仅在两个直方图都严格为正的箱上，将经验对数比 $\\ln\\!\\big( P_F(W) / P_R(-W) \\big)$ 与理论预测 $\\beta (W - \\Delta F)$ 进行比较，并报告这些箱上的最大绝对偏差是否低于规定的容差 $\\varepsilon$。\n\n为了可复现性，请使用固定的随机种子。将种子设置为 $12345$。\n\n您的程序必须实现对此受驱动两态过程的事件时间的精确采样。对于上述线性协议，每个状态的总出射率是时间的指数函数，这允许对非均匀等待时间分布进行精确求逆。您不得假定任何时间离散化近似。\n\n测试套件：\n模拟以下三种情况，并对每种情况返回一个布尔值，指示克鲁克斯关系是否在指定容差内成立。对所有情况使用相同的直方图设置 $(n_b = 60)$ 和相同的偏差容差 $\\varepsilon = 0.35$。\n\n- 情况 1（理想情况，中等速度）：\n  - $\\beta = 1.0$, $k_0 = 1.0$, $\\Delta E_i = 0.0$, $\\Delta E_f = 4.0$, $\\tau = 8.0$，正向和逆向的轨迹数均为 $N = 20000$。\n\n- 情况 2（快速驱动）：\n  - $\\beta = 1.0$, $k_0 = 1.0$, $\\Delta E_i = 0.0$, $\\Delta E_f = 4.0$, $\\tau = 0.5$，正向和逆向的轨迹数均为 $N = 20000$。\n\n- 情况 3（边界情况，参数无变化）：\n  - $\\beta = 1.0$, $k_0 = 1.0$, $\\Delta E_i = 1.0$, $\\Delta E_f = 1.0$, $\\tau = 3.0$，正向和逆向的轨迹数均为 $N = 20000$。\n\n答案规格：\n- 对于每种情况，计算一个布尔值，指示最大绝对偏差\n$$\n\\max_{\\text{重叠的箱}} \\left| \\ln\\!\\frac{P_F(W)}{P_R(-W)} - \\beta \\, (W - \\Delta F) \\right|\n$$\n是否不超过 $\\varepsilon = 0.35$。如果没有具有严格为正密度的重叠箱，则为该情况返回布尔值 $False$。\n- 最终输出必须是一行，其中包含三个布尔结果，以逗号分隔并用方括号括起（例如，“[True,False,True]”）。\n\n您的程序必须是完整且可直接运行的，不得需要任何输入，并且必须遵守上面给出的种子、直方图和容差规格。所有量都应以指定的无量纲单位报告；不需要物理单位。", "solution": "所述问题已经过验证，并被认定为有效。它提出了一个在非平衡统计力学领域中定义明确、有科学依据的问题，具体是针对一个受驱动两态系统的克鲁克斯涨落定理的数值验证。所有参数、定义和约束都已提供，构成了一个自洽且可解的问题。核心任务涉及对时间非均匀马尔可夫跳跃过程的精确随机模拟，这是计算物理学中一个标准但并非平凡的过程。\n\n解决方案分三个阶段展开：首先，推导用于生成受驱动系统轨迹的精确模拟算法；其次，计算沿每条轨迹所做功的方法；第三，检验克鲁克斯关系的统计程序。\n\n一个两态系统经历反应 $A \\rightleftharpoons B$。能量为 $E_A = 0$ 和 $E_B = \\Delta E(t)$。转变速率由对称参数化给出：\n$$\nk_{A \\to B}(t) = k_0 \\, e^{-\\frac{\\beta}{2} \\Delta E(t)} \\quad \\text{和} \\quad\nk_{B \\to A}(t) = k_0 \\, e^{+\\frac{\\beta}{2} \\Delta E(t)}\n$$\n这些速率满足局域细致平衡条件 $\\frac{k_{A \\to B}(t)}{k_{B \\to A}(t)} = e^{-\\beta \\Delta E(t)}$。外部参数 $\\Delta E(t)$ 随时间线性驱动，$\\Delta E(t) = \\Delta E_{start} + v t$，其中速度 $v = (\\Delta E_{end} - \\Delta E_{start}) / \\tau$。\n\n模拟的核心是为这个时间非均匀过程生成跳跃时间。如果系统在时间 $t_0$ 处于状态 $X$，那么在没有发生跳跃的情况下存活到时间 $t$ 的概率是 $P(t) = \\exp\\left(-\\int_{t_0}^t k_{exit}(s) ds\\right)$，其中 $k_{exit}(s)$ 是在时间 $s$ 离开状态 $X$ 的出射率。下一个跳跃时间 $t_{jump}$ 可以通过求解方程 $\\int_{t_0}^{t_{jump}} k_{exit}(s) ds = R$ 来采样，其中 $R$ 是从速率为 $1$ 的指数分布中抽取的随机变量。\n\n对于给定的线性协议，出射率的形式为 $k_{exit}(t) = C e^{\\alpha t}$，其中常数 $C$ 和 $\\alpha$ 取决于状态。\n如果状态为 $A$，出射率为 $k_{A \\to B}(t)$。那么：\n$$\n\\alpha_A = -\\frac{\\beta v}{2} \\quad \\text{和} \\quad C_A = k_0 \\, e^{-\\frac{\\beta}{2} \\Delta E_{start}}\n$$\n如果状态为 $B$，出射率为 $k_{B \\to A}(t)$。那么：\n$$\n\\alpha_B = +\\frac{\\beta v}{2} \\quad \\text{和} \\quad C_B = k_0 \\, e^{+\\frac{\\beta}{2} \\Delta E_{start}}\n$$\n对于非平凡情况 $v \\neq 0$，因此 $\\alpha \\neq 0$，该积分是可解析处理的：\n$$\n\\int_{t_0}^{t_0 + \\Delta t} C e^{\\alpha s} ds \\;=\\; \\frac{C}{\\alpha} \\left[ e^{\\alpha(t_0+\\Delta t)} - e^{\\alpha t_0} \\right] \\;=\\; \\frac{C e^{\\alpha t_0}}{\\alpha} \\left( e^{\\alpha \\Delta t} - 1 \\right) \\;=\\; \\frac{k_{exit}(t_0)}{\\alpha} \\left( e^{\\alpha \\Delta t} - 1 \\right)\n$$\n令其等于 $R$ 并求解等待时间 $\\Delta t$ 可得：\n$$\n\\Delta t = \\frac{1}{\\alpha} \\ln\\left(1 + \\frac{\\alpha R}{k_{exit}(t_0)}\\right)\n$$\n此公式在对数函数的参数为正时有效。如果 $1 + \\frac{\\alpha R}{k_{exit}(t_0)} \\le 0$（这只可能在 $\\alpha  0$ 时发生），这意味着从 $t_0$ 到无穷大的总积分速率收敛到一个小于 $R$ 的值，即不会发生跳跃。在这种情况下，我们设 $\\Delta t = \\infty$。此方法提供了等待时间的精确样本。对于特殊情况 $v=0$（因此 $\\alpha=0$），速率是恒定的，等待时间就是 $\\Delta t = R / k_{exit}$。\n\n对于线性协议 $\\Delta E(t)$，随机功的计算显著简化。黎曼–斯蒂尔杰斯积分为：\n$$\nW = \\int_{0}^{\\tau} \\mathbf{1}_{\\{x(t)=B\\}} \\, d\\Delta E(t) = \\int_{0}^{\\tau} \\mathbf{1}_{\\{x(t)=B\\}} \\frac{d\\Delta E}{dt} dt = v \\int_{0}^{\\tau} \\mathbf{1}_{\\{x(t)=B\\}} dt\n$$\n因此，功是协议速度 $v$ 与系统停留在状态 $B$ 的总时间的乘积。这简化了计算，只需对系统处于状态 $B$ 的所有时间间隔的持续时间求和。\n\n克鲁克斯关系 $\\frac{P_F(W)}{P_R(-W)} = e^{\\beta (W - \\Delta F)}$ 的验证是数值进行的。为正向协议（$\\Delta E_i \\to \\Delta E_f$）和逆向协议（$\\Delta E_f \\to \\Delta E_i$）生成轨迹系综，分别从它们各自的初始平衡分布开始。为每条轨迹计算功值 $W_F$ 和 $W_R$。\n\n概率分布 $P_F(W)$ 和 $P_R(W)$ 使用直方图进行估计。在合并数据 $\\{W_F\\} \\cup \\{-W_R\\}$ 的范围内构建一组公共的箱。逆向过程的直方图是针对符号翻转后的功值 $-W_R$ 计算的。归一化的直方图提供了在箱中心 $W_k$ 处对 $P_F(W)$ 和 $P_R(-W)$ 的经验估计。\n\n自由能差计算为 $\\Delta F = F(\\Delta E_f) - F(\\Delta E_i)$，其中自由能由 $F(\\Delta E) = -\\frac{1}{\\beta} \\ln(1 + e^{-\\beta \\Delta E})$ 给出。对于每个 $P_F(W_k)$ 和 $P_R(-W_k)$ 都严格为正的箱 $k$，偏差计算如下：\n$$\nd_k = \\left| \\ln\\left(\\frac{P_F(W_k)}{P_R(-W_k)}\\right) - \\beta (W_k - \\Delta F) \\right|\n$$\n这些偏差的最大值 $\\max_k d_k$ 与容差 $\\varepsilon=0.35$ 进行比较。如果此最大偏差在容差范围内，则认为该定理在该情况下得到了数值验证。如果没有箱显示两个分布之间存在重叠，则验证失败。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the Crooks fluctuation theorem.\n    \"\"\"\n    # Fixed parameters for all test cases\n    N_TRAJECTORIES = 20000\n    N_BINS = 60\n    TOLERANCE = 0.35\n    RANDOM_SEED = 12345\n\n    # Test suite from the problem statement\n    test_cases = [\n        # Case 1 (happy path, moderate speed)\n        {'beta': 1.0, 'k0': 1.0, 'delta_E_i': 0.0, 'delta_E_f': 4.0, 'tau': 8.0},\n        # Case 2 (fast driving)\n        {'beta': 1.0, 'k0': 1.0, 'delta_E_i': 0.0, 'delta_E_f': 4.0, 'tau': 0.5},\n        # Case 3 (boundary case, no change in parameter)\n        {'beta': 1.0, 'k0': 1.0, 'delta_E_i': 1.0, 'delta_E_f': 1.0, 'tau': 3.0},\n    ]\n\n    rng = np.random.default_rng(RANDOM_SEED)\n    results = []\n\n    for case in test_cases:\n        # Run forward and reverse simulations\n        W_F = _simulate_protocol(params=case, is_forward=True, n_traj=N_TRAJECTORIES, rng=rng)\n        W_R = _simulate_protocol(params=case, is_forward=False, n_traj=N_TRAJECTORIES, rng=rng)\n\n        # Prepare data for histogramming\n        neg_W_R = -np.array(W_R)\n        \n        # Determine common histogram range\n        combined_works = np.concatenate((W_F, neg_W_R))\n        w_min, w_max = combined_works.min(), combined_works.max()\n        \n        if w_max - w_min  1e-9:\n             w_min, w_max = -1.0, 1.0\n        else: # Add padding to avoid issues at edges\n            padding = 0.01 * (w_max - w_min) if (w_max-w_min) > 0 else 0.1\n            w_min -= padding\n            w_max += padding\n\n        bins = np.linspace(w_min, w_max, N_BINS + 1)\n        bin_centers = (bins[:-1] + bins[1:]) / 2.0\n\n        # Create normalized histograms (probability densities)\n        P_F, _ = np.histogram(W_F, bins=bins, density=True)\n        P_R_neg, _ = np.histogram(neg_W_R, bins=bins, density=True)\n\n        # Calculate free energy difference\n        beta = case['beta']\n        delta_E_i = case['delta_E_i']\n        delta_E_f = case['delta_E_f']\n        \n        def free_energy(E, b):\n            return -1.0 / b * np.log(1.0 + np.exp(-b * E))\n            \n        delta_F = free_energy(delta_E_f, beta) - free_energy(delta_E_i, beta)\n\n        # Check Crooks relation\n        max_deviation = 0.0\n        found_overlap = False\n        \n        for i in range(N_BINS):\n            if P_F[i] > 0 and P_R_neg[i] > 0:\n                found_overlap = True\n                W_k = bin_centers[i]\n                \n                log_ratio_empirical = np.log(P_F[i] / P_R_neg[i])\n                log_ratio_theoretical = beta * (W_k - delta_F)\n                \n                deviation = np.abs(log_ratio_empirical - log_ratio_theoretical)\n                if deviation > max_deviation:\n                    max_deviation = deviation\n        \n        if not found_overlap:\n            results.append(False)\n        else:\n            results.append(max_deviation = TOLERANCE)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef _simulate_protocol(params, is_forward, n_traj, rng):\n    \"\"\"\n    Simulates trajectories for a given protocol (forward or reverse).\n    \"\"\"\n    beta, k0, tau = params['beta'], params['k0'], params['tau']\n\n    if is_forward:\n        E_start, E_end = params['delta_E_i'], params['delta_E_f']\n    else: # Reverse protocol\n        E_start, E_end = params['delta_E_f'], params['delta_E_i']\n\n    v = (E_end - E_start) / tau if tau > 0 else 0.0\n\n    work_values = []\n    \n    for _ in range(n_traj):\n        # Initialize state from equilibrium at E_start\n        p_B_eq = np.exp(-beta * E_start) / (1.0 + np.exp(-beta * E_start))\n        state = 1 if rng.random()  p_B_eq else 0  # 0 for A, 1 for B\n        \n        current_time = 0.0\n        time_in_B = 0.0\n\n        while current_time  tau:\n            t_prev = current_time\n            \n            # Sample waiting time dt for the next jump\n            if v == 0: # Homogeneous process\n                rate_A_to_B = k0 * np.exp(-beta * E_start / 2.0)\n                rate_B_to_A = k0 * np.exp(beta * E_start / 2.0)\n                rate = rate_A_to_B if state == 0 else rate_B_to_A\n                dt = rng.exponential(1.0 / rate) if rate > 0 else np.inf\n            else: # Inhomogeneous process\n                R = rng.exponential(1.0)\n                if state == 0: # From A\n                    alpha = -beta * v / 2.0\n                    C = k0 * np.exp(-beta * E_start / 2.0)\n                else: # From B\n                    alpha = beta * v / 2.0\n                    C = k0 * np.exp(beta * E_start / 2.0)\n                \n                rate_at_t = C * np.exp(alpha * current_time)\n                \n                arg = 1.0 + alpha * R / rate_at_t\n                if arg > 0:\n                    dt = (1.0 / alpha) * np.log1p(alpha * R / rate_at_t)\n                else:\n                    dt = np.inf\n\n            t_jump = current_time + dt\n            t_final_interval = min(t_jump, tau)\n\n            if state == 1: # If in state B\n                time_in_B += t_final_interval - t_prev\n            \n            if t_jump  tau:\n                current_time = t_jump\n                state = 1 - state # Flip state\n            else:\n                current_time = tau # End of trajectory\n        \n        work = v * time_in_B\n        work_values.append(work)\n        \n    return work_values\n\nsolve()\n```", "id": "2644035"}, {"introduction": "生成数据只是战斗的一半，正确解读数据同样至关重要。本练习超越了简单的验证，探讨了如何将 Crooks 关系用作一种诊断工具来分析实验或模拟结果。它通过一系列情景，考验你从数据偏离理想理论预测的现象中识别出背后物理原因的能力，例如模型粗粒化或实验误差。[@problem_id:2644022]", "problem": "一个单酶反应网络被建模为一个连续时间马尔可夫链（CTMC），它与一个固定温度为 $T$ 的热浴弱耦合。逆温度为 $\\beta \\equiv 1/(k_{\\mathrm{B}}T)$，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数。一个外部化学恒定方案 $t \\mapsto \\lambda_t$ 在 $t \\in [0, \\tau]$ 的时间段内驱动系统，改变与网络耦合的化学势，从而对单个随机轨迹做化学功。正向实验在 $t=0$ 时将系统制备在对应于 $\\lambda_0$ 的平衡分布中，然后应用方案 $\\{\\lambda_t\\}_{t\\in[0,\\tau]}$ 并测量随机功 $W$。逆向实验在 $t=0$ 时将系统制备在对应于 $\\lambda_\\tau$ 的平衡分布中，然后应用时间反演的方案 $\\{\\tilde{\\lambda}_t\\}_{t\\in[0,\\tau]}$ 并测量随机功 $W$；其分布记为 $P_R(W)$。正向功分布为 $P_F(W)$。在 $\\lambda_0$ 和 $\\lambda_\\tau$ 的系综之间未知的平衡自由能差记为 $\\Delta F$。\n\n除了使用 $P_F(W)$ 和 $P_R(-W)$ 的交点来估计 $\\Delta F$ 之外，一位实验者提出了以下基于绘制对数似然比与功的函数图（即函数 $L(W) \\equiv \\ln\\!\\big[P_F(W)/P_R(-W)\\big]$ 对 $W$ 的图像）的诊断和解释。\n\n在给定的假设下，以下哪些陈述是有效的，哪些是无效的？选择所有适用的选项。\n\nA. 如果 $L(W)$ 对 $W$ 的图像是线性的，且斜率等于独立已知的逆温度 $\\beta$，那么这支持了动力学的微观可逆性和随机功的正确定义；截距编码了 $\\Delta F$。\n\nB. 如果 $L(W)$ 对 $W$ 的图像存在持续的曲率，并且当先前集总的快速中间体被明确解析时该曲率减小，这与粗粒化导致的隐藏熵产生相符；在这种情况下，即使 $P_F(W)$ 和 $P_R(-W)$ 的交点 $W_{\\times}$ 能够对 $\\Delta F$ 给出良好的实际估计， $L(W)$ 的斜率也未必与 $\\beta$ 相匹配。\n\nC. 如果 $L(W)$ 的最佳拟合斜率系统性地比 $\\beta$ 大约 $10\\%$，而来自同一次拟合的截距在误差范围内与独立的 $\\Delta F$ 一致，最可能的原因是样本量不足；随着样本量的增加，曲率会持续存在，但斜率的偏差会消失。\n\nD. 如果逆向实验是从正向实验的非平衡末态分布开始，而不是从 $\\lambda_\\tau$ 处的平衡分布开始，那么 $L(W)$ 对 $W$ 的图像仍然是线性的，斜率与理想情况下的相同，但会有一个恒定的垂直偏移。\n\nE. 如果在方案执行期间，热浴温度以一种未被考虑的方式发生漂移（因此环境是非等温的），那么 $L(W)$ 对 $W$ 的图像可能会在局部呈现线性，其有效斜率随 $W$ 变化；全局最佳拟合斜率反映了在 $W$ 的支撑集上瞬时逆温度的加权平均值。\n\nF. 将横坐标替换为随机热 $Q$，同时保留相同的正向和逆向直方图 $P_F$ 和 $P_R$，预期仍然会产生一个严格线性的 $L(Q) \\equiv \\ln\\!\\big[P_F(Q)/P_R(-Q)\\big]$ 对 $Q$ 的图像，斜率为 $\\beta$；因此，$L(Q)$ 中任何观察到的曲率都表明实验误差而非理论限制。\n\nG. 在减去其最佳拟合直线后，$L(W)$ 的残差图对 $W$ 不应显示任何系统性结构，如果基本假设成立；如果与线性的偏离是由于中等的采样噪声而非假设的失效，那么 Bennett 接受率（BAR）分析仍然可以得到一个对 $\\Delta F$ 的基本无偏估计，且其不确定性比原始交点更小。", "solution": "该问题陈述描述了应用 Crooks 涨落定理的一个典型场景。在评估具体断言之前，我们必须首先建立理论基础。\n\n**问题陈述验证**\n\n**第1步：提取已知条件**\n- **系统：** 一个单酶反应网络，建模为连续时间马尔可夫链 (CTMC)。\n- **环境：** 一个固定温度为 $T$ 的热浴，逆温度为 $\\beta \\equiv 1/(k_{\\mathrm{B}}T)$。耦合是弱的。\n- **方案：** 在时间区间 $t \\in [0, \\tau]$ 内应用外部化学恒定方案 $t \\mapsto \\lambda_t$。\n- **正向过程：**\n    - 初始状态：系统被制备在对应于初始方案值 $\\lambda_0$ 的平衡分布中。\n    - 过程：应用方案 $\\{\\lambda_t\\}_{t\\in[0,\\tau]}$。\n    - 测量：测量随机功 $W$，得到分布 $P_F(W)$。\n- **逆向过程：**\n    - 初始状态：系统被制备在对应于最终方案值 $\\lambda_\\tau$ 的平衡分布中。\n    - 过程：应用时间反演的方案 $\\{\\tilde{\\lambda}_t\\}_{t\\in[0,\\tau]}$，其中 $\\tilde{\\lambda}_t = \\lambda_{\\tau-t}$。\n    - 测量：测量随机功 $W$，得到分布 $P_R(W)$。\n- **热力学量：** 在 $\\lambda_0$ 和 $\\lambda_\\tau$ 的系综之间的平衡自由能差为 $\\Delta F$。\n- **分析函数：** 对数似然比定义为 $L(W) \\equiv \\ln[P_F(W)/P_R(-W)]$。\n\n**第2步：使用提取的已知条件进行验证**\n该问题具有科学依据、良定且客观。它描述了一个化学动力学中涨落定理的教科书式设置。假设被清晰地陈述：CTMC 动力学、与等温浴的弱耦合，以及正向和逆向实验的特定初始条件。这些条件正是推导 Crooks 涨落定理所需的条件。该问题不违反任何基本原理，没有歧义，并且提出的问题探究了对该定理应用及其局限性的细致理解。\n\n**第3步：结论与行动**\n问题陈述有效。将给出完整解答。\n\n**解答推导**\n\n支配该系统的基本原理是 Crooks 涨落定理。对于满足所述假设（CTMC 的微观可逆性、初始平衡分布以及功的正确定义）的过程，该定理表明：\n$$ \\frac{P_F(W)}{P_R(-W)} = e^{\\beta(W - \\Delta F)} $$\n其中 $\\Delta F = F(\\lambda_\\tau) - F(\\lambda_0)$ 是平衡自由能差。\n\n对两边取自然对数，得到问题中定义的函数：\n$$ L(W) \\equiv \\ln\\left(\\frac{P_F(W)}{P_R(-W)}\\right) = \\beta(W - \\Delta F) = \\beta W - \\beta \\Delta F $$\n该方程预测，$L(W)$ 作为 $W$ 的函数图像必须是一条直线。这条线的斜率是逆温度 $\\beta$，其y轴截距是 $-\\beta \\Delta F$。x轴截距，即 $L(W)=0$ 的地方，发生在 $W = \\Delta F$。我们现在基于这个理论预测及其基本假设来评估每个陈述。\n\n**逐项分析**\n\n**A. 如果 $L(W)$ 对 $W$ 的图像是线性的，且斜率等于独立已知的逆温度 $\\beta$，那么这支持了动力学的微观可逆性和随机功的正确定义；截距编码了 $\\Delta F$。**\n**分析：** $L(W)$ 对 $W$ 的图像的线性以及斜率为 $\\beta$ 是对 Crooks 定理的一个直接且严格的检验。该定理的有效性又取决于几个关键假设：系统的动力学遵循微观可逆性（或局域细致平衡），正向和逆向方案的定义是正确的，系统在两个方案开始时都处于热平衡状态，并且随机功被正确定义和测量。如果实验或计算数据符合这个精确的线性关系，它为这些基本假设的满足提供了强有力的证据。从线性形式 $L(W) = \\beta W - \\beta \\Delta F$ 可知，在 $W=0$ 处的截距确实是 $-\\beta \\Delta F$，这允许确定 $\\Delta F$。\n**结论：** 有效。\n\n**B. 如果 $L(W)$ 对 $W$ 的图像存在持续的曲率，并且当先前集总的快速中间体被明确解析时该曲率减小，这与粗粒化导致的隐藏熵产生相符；在这种情况下，即使 $P_F(W)$ 和 $P_R(-W)$ 的交点 $W_{\\times}$ 能够对 $\\Delta F$ 给出良好的实际估计， $L(W)$ 的斜率也未必与 $\\beta$ 相匹配。**\n**分析：** Crooks 定理适用于完整的、微观定义的系统。通过将快速状态集总为单一状态来进行粗粒化，可能使观察到的动力学变得非马尔可夫性，更重要的是，可能导致熵产生的计算不完整。基于粗粒化变量的功定义可能会遗漏集总状态内部跃迁的贡献（“隐藏熵产生”）。这种对基本假设的违反导致了 $L(W)$ 简单线性形式的失效，通常表现为曲率。明确解析这些快速中间体使模型更接近完整的微观描述，恢复了马尔可夫性和更完整的功定义，从而恢复了 $L(W)$ 图像的线性。$L(W_\\times)=0$ 的点 $W_{\\times}$ 对应于 $P_F(W_\\times)=P_R(-W_\\times)$。Jarzynski 等式，$\\langle e^{-\\beta W} \\rangle_F = e^{-\\beta \\Delta F}$，是 Crooks 定理的积分形式，即使在细致定理（以及 $L(W)$ 的线性）失效时也可能成立。交点 $W_\\times = \\Delta F$ 也是细致定理的一个推论，并且在某些条件下通常仍然是 $\\Delta F$ 的一个良好估计，但是弯曲的 $L(W)$ 的斜率不是恒定的，因此在任何扩展的 $W$ 范围内都不可能等于 $\\beta$。\n**结论：** 有效。\n\n**C. 如果 $L(W)$ 的最佳拟合斜率系统性地比 $\\beta$ 大约 $10\\%$，而来自同一次拟合的截距在误差范围内与独立的 $\\Delta F$ 一致，最可能的原因是样本量不足；随着样本量的增加，曲率会持续存在，但斜率的偏差会消失。**\n**分析：** 这个陈述在逻辑上是有缺陷的。样本量不足是*随机统计误差*的来源，表现为估计的 $P(W)$ 以及因此 $L(W)$ 中的噪声和方差增加。它通常不会产生一个清晰的、*系统性*的 $10\\%$ 的斜率偏差。这种量级的系统性偏差指向实验中的系统误差（例如，温度校准不准）或模型假设的失效（例如，B 或 E 中讨论的那些），而不是统计伪影。此外，“曲率会持续存在，但斜率的偏差会消失”的说法是相互矛盾的。如果随着样本量的增加，显著的曲率持续存在，这意味着潜在关系不是线性的，单一的“最佳拟合斜率”是一个无意义的参数。如果潜在关系确实是线性的，那么随着样本量的增加，表观的曲率和任何由噪声引起的斜率偏差都应该消失，拟合会收敛到真实的直线上。\n**结论：** 无效。\n\n**D. 如果逆向实验是从正向实验的非平衡末态分布开始，而不是从 $\\lambda_\\tau$ 处的平衡分布开始，那么 $L(W)$ 对 $W$ 的图像仍然是线性的，斜率与理想情况下的相同，但会有一个恒定的垂直偏移。**\n**分析：** 标准形式的 Crooks 定理关键性地依赖于正向和逆向过程都从它们各自的平衡分布开始的假设。正向过程中系统处于微观状态 $x_0$ 的初始概率是 $p_{eq}(x_0;\\lambda_0) \\propto e^{-\\beta H(x_0; \\lambda_0)}$。对于逆向过程，它必须是 $p_{eq}(\\tilde{x}_0;\\lambda_\\tau) \\propto e^{-\\beta H(\\tilde{x}_0; \\lambda_\\tau)}$。如果逆向过程从正向过程结束时达到的非平衡分布开始，这个条件就被违反了。逆向路径产生的功分布，我们称之为 $P'_R(W)$，其形状将不同于标准的 $P_R(W)$。因此，比率 $P_F(W)/P'_R(-W)$ 将不遵循 Crooks 定理给出的对 $W$ 的简单指数依赖关系。对数比图中的一个简单垂直平移将意味着 $P_F(W)/P'_R(-W) = C \\cdot e^{\\beta(W - \\Delta F)}$ 对于某个常数 $C \\neq 1$，这意味着 $P'_R(-W) = C^{-1} P_R(-W)$。这通常是不正确的；功分布的形状根本上取决于初始状态的分布。因此，$L(W)$ 的图像通常会改变其形状，而不会是一条简单的垂直平移的直线。\n**结论：** 无效。\n\n**E. 如果在方案执行期间，热浴温度以一种未被考虑的方式发生漂移（因此环境是非等温的），那么 $L(W)$ 对 $W$ 的图像可能会在局部呈现线性，其有效斜率随 $W$ 变化；全局最佳拟合斜率反映了在 $W$ 的支撑集上瞬时逆温度的加权平均值。**\n**分析：** Crooks 定理的推导明确假设了一个等温环境（恒定的 $\\beta$）。如果在方案期间温度 $T(t)$ 从而 $\\beta(t)$ 发生变化，该定理的简单形式就不适用。正向和逆向路径概率之间的关系变得更加复杂，需要对随时间变化的温度进行积分。不同的功值 $W$ 可能与方案的不同部分相关，因此与不同的瞬时温度相关。例如，高耗散轨迹（大的 $W$）可能优先发生在一个高温阶段。这将导致 $L(W)$ 图像的斜率随 $W$ 变化，反映了某个有效的局部温度。对这样一个弯曲图像的全局线性拟合将得到一个斜率，该斜率是在方案持续时间内 $\\beta(t)$ 的一个非平凡的加权平均。这个描述在物理上是合理的，并且在定性上是正确的。\n**结论：** 有效。\n\n**F. 将横坐标替换为随机热 $Q$，同时保留相同的正向和逆向直方图 $P_F$ 和 $P_R$，预期仍然会产生一个严格线性的 $L(Q) \\equiv \\ln\\!\\big[P_F(Q)/P_R(-Q)\\big]$ 对 $Q$ 的图像，斜率为 $\\beta$；因此，$L(Q)$ 中任何观察到的曲率都表明实验误差而非理论限制。**\n**分析：** 这个陈述根本上是错误的。Crooks 定理是关于通过外部方案对系统做的功 $W$ 的一个陈述。热 $Q$ 是一个不同的热力学量，通过第一定律与功和内能变化 $\\Delta U$ 相关，即 $Q = \\Delta U - W$。$\\Delta U$ 和 $W$ 都是随机变量，所以 $Q$ 也是一个随机变量，有其自身的分布 $P(Q)$，这通常不同于 $P(W)$。对于两个不同平衡态之间的非循环过程，没有一个类似于 Crooks 定理的关于热的普适涨落定理。预期热会产生一个斜率为 $\\beta$ 的线性关系的前提是错误的。该陈述似乎是基于对功和热的误解和混淆。在涉及热分布的图像中观察到的曲率将是一个预期的理论结果，而不是实验误差的标志。\n**结论：** 无效。\n\n**G. 在减去其最佳拟合直线后，$L(W)$ 的残差图对 $W$ 不应显示任何系统性结构，如果基本假设成立；如果与线性的偏离是由于中等的采样噪声而非假设的失效，那么 Bennett 接受率（BAR）分析仍然可以得到一个对 $\\Delta F$ 的基本无偏估计，且其不确定性比原始交点更小。**\n**分析：** 这个陈述准确地描述了统计分析中的标准做法。首先，如果理论模型（在这里是 $L(W) = \\beta W - \\beta \\Delta F$）是正确的，那么数据与模型拟合的偏差应该是随机噪声。残差图是检查这一点的标准工具；残差中的任何系统性结构（例如曲率）都表明该模型是对数据的不良描述。其次，如果偏差确实只是由于有限采样引起的噪声，那么比简单交点更复杂的估计器是可取的。Bennett 接受率（BAR）是一种统计上最优的方法，它使用来自正向和逆向分布的所有功数据来估计 $\\Delta F$。在 Crooks 关系成立的假设下，它已知可以提供 $\\Delta F$ 的最小方差无偏估计。因此，它比简单地识别一个单一的、有噪声的交点更精确（不确定性更小）且对噪声更具鲁棒性。\n**结论：** 有效。", "answer": "$$\\boxed{ABEG}$$", "id": "2644022"}]}