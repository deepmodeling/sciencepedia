{"hands_on_practices": [{"introduction": "理解随机基因表达的第一步是建立其数学描述。本练习旨在通过概率生成函数这一强大工具，精确求解一个经典的转录爆发模型随时间演化的概率分布。掌握此方法将为您分析更复杂的随机过程奠定坚实的数学基础。", "problem": "考虑一个随机基因表达的阵发性转录模型，其中信使核糖核酸 (mRNA) 分子在由启动子激活事件触发的几何分布的阵发中产生。假设以下科学标准的反应网络描述和初始条件。\n\n- 启动子以速率为 $k_{\\text{on}}$（单位为时间的倒数）的齐次泊松过程产生阵发。每当启动子瞬时访问激活状态然后立即返回非激活状态时，每个阵发都瞬时发生。在时间 $t=0$ 时，启动子最初处于非激活 (OFF) 状态，并且最初有 $n=0$ 个 mRNA 分子。\n- 阵发大小 $K$ 服从均值为 $b>0$ 的几何分布，其概率生成函数为 $B(z)=\\mathbb{E}[z^{K}]=\\frac{1}{1+b(1-z)}$。这是在非负整数上均值为 $b$ 的典型几何分布。\n- 每个单独的 mRNA 分子以一级速率常数 $\\gamma$（单位为时间的倒数）独立降解。\n- 令 $P(n,t)$ 表示在时间 $t\\ge 0$ 时有 $n$ 个 mRNA 分子的概率，并令概率生成函数 (PGF) 为 $G(z,t)=\\sum_{n=0}^{\\infty}P(n,t)z^{n}$。\n\n仅从 (i) 上述过程的基本结构（复合泊松阵发与独立指数降解），(ii) 概率生成函数的定义，以及 (iii) 在速率为 $\\gamma$ 的一级降解下，任何给定的 mRNA 分子从时间 $\\tau$ 到 $t$ 的存活概率为 $\\exp(-\\gamma (t-\\tau))$ 这一事实出发，推导在所述初始条件下，对于任意 $t\\ge 0$ 的瞬时生成函数 $G(z,t)$ 的闭合形式表达式。然后，通过提取 $G(z,t)$ 中 $z^{n}$ 的系数，得到 $P(n,t)$ 的闭合形式表达式，表示为包含广义二项式系数和上升阶乘的有限和。你的最终表达式可以依赖于模型参数 $k_{\\text{on}}$、$\\gamma$、$b$，以及变量 $z$、$t$ 和 $n$。\n\n以一个双元素的行矩阵格式提供你的最终答案，第一个元素为 $G(z,t)$，第二个元素为 $P(n,t)$。不需要进行数值评估，最终答案中不应包含任何单位。如果你引入任何特殊函数或组合符号，请在推导中明确定义它们。", "solution": "该问题陈述经证实具有科学依据、问题明确且内部一致。它描述了一个随机基因表达的典型模型，该模型存在标准解法。我们继续进行推导。\n\nmRNA 的产生和降解过程可以描述为一个带有线性衰减的复合泊松过程。mRNA 分子的阵发根据速率为 $k_{\\text{on}}$ 的齐次泊松过程产生。每次阵发中的分子数 $K$ 服从均值为 $b$ 的几何分布。然后每个分子以一级速率常数 $\\gamma$ 独立衰变。初始条件是在时间 $t=0$ 时有 $n=0$ 个分子。我们的目标是找到概率生成函数 (PGF) $G(z,t) = \\mathbb{E}[z^{N(t)}]$，其中 $N(t)$ 是时间 $t$ 时的 mRNA 分子数。\n\n首先，我们考虑单个阵发事件的贡献。如果在时间 $\\tau < t$ 发生一次大小为 $K$ 的阵发，这 $K$ 个分子中的每一个存活到时间 $t$ 的概率由 $p_s(t, \\tau) = \\exp(-\\gamma(t-\\tau))$ 给出。来自这次阵发的存活分子数 $S$ 服从参数为 $K$ 和 $p_s(t, \\tau)$ 的二项分布。给定 $K$ 时，$S$ 的 PGF 为 $\\mathbb{E}[z^S|K] = (1 - p_s(t,\\tau) + z p_s(t,\\tau))^K$。\n\n为了找到在时间 $\\tau$ 的单个阵发中存活分子数的不以阵发大小 $K$ 为条件的 PGF，我们对 $K$ 的分布进行平均。设阵发大小 $K$ 的 PGF 为 $B(z') = \\mathbb{E}[z'^K]$。问题陈述中给出 $B(z') = \\frac{1}{1+b(1-z')}$。通过将 $z' = 1 - p_s(t,\\tau) + z p_s(t,\\tau)$ 代入 $B(z')$ 来获得无条件 PGF。\n$$G_{\\text{burst}}(z; t, \\tau) = \\mathbb{E}[(1 - p_s(t,\\tau) + z p_s(t,\\tau))^K] = B(1 - p_s(t,\\tau) + z p_s(t,\\tau))$$\n$$G_{\\text{burst}}(z; t, \\tau) = \\frac{1}{1+b(1 - (1 - p_s(t,\\tau) + z p_s(t,\\tau)))} = \\frac{1}{1+b p_s(t,\\tau)(1-z)}$$\n代入 $p_s(t,\\tau) = \\exp(-\\gamma(t-\\tau))$，我们有：\n$$G_{\\text{burst}}(z; t, \\tau) = \\frac{1}{1+b(1-z)\\exp(-\\gamma(t-\\tau))}$$\n总分子数 $N(t)$ 是在区间 $[0,t]$ 内发生的所有独立阵发的贡献之和。对于一个复合泊松过程，其中事件以恒定速率 $\\lambda$ 发生，且每个事件的贡献具有 PGF $G_{\\text{jump}}(z)$，总 PGF 为 $G(z,t) = \\exp(\\lambda t (G_{\\text{jump}}(z)-1))$。在我们的情况下，一次阵发的贡献取决于其到达时间 $\\tau$，这使得该过程成为一个非齐次复合泊松过程。总 PGF 由下式给出：\n$$G(z,t) = \\exp\\left( \\int_0^t k_{\\text{on}} \\left[ G_{\\text{burst}}(z; t, \\tau) - 1 \\right] d\\tau \\right)$$\n指数中的积分为：\n$$I = \\int_0^t k_{\\text{on}} \\left[ \\frac{1}{1+b(1-z)\\exp(-\\gamma(t-\\tau))} - 1 \\right] d\\tau = k_{\\text{on}} \\int_0^t \\frac{-b(1-z)\\exp(-\\gamma(t-\\tau))}{1+b(1-z)\\exp(-\\gamma(t-\\tau))} d\\tau$$\n令 $s = t-\\tau$，则 $d\\tau = -ds$。积分上下限从 $\\tau=0 \\to t$ 变为 $s=t \\to 0$。\n$$I = k_{\\text{on}} \\int_t^0 \\frac{-b(1-z)\\exp(-\\gamma s)}{1+b(1-z)\\exp(-\\gamma s)} (-ds) = k_{\\text{on}} \\int_0^t \\frac{-b(1-z)\\exp(-\\gamma s)}{1+b(1-z)\\exp(-\\gamma s)} ds$$\n令 $u = 1+b(1-z)\\exp(-\\gamma s)$。则 $du = b(1-z)(-\\gamma)\\exp(-\\gamma s)ds$。被积函数为 $\\frac{1}{\\gamma u} du$。\n$$I = \\frac{k_{\\text{on}}}{\\gamma} \\int_{s=0}^{s=t} \\frac{du}{u} = \\frac{k_{\\text{on}}}{\\gamma} [\\ln(u)]_{s=0}^{s=t} = \\frac{k_{\\text{on}}}{\\gamma} [\\ln(1+b(1-z)\\exp(-\\gamma s))]_{0}^{t}$$\n$$I = \\frac{k_{\\text{on}}}{\\gamma} \\left( \\ln(1+b(1-z)\\exp(-\\gamma t)) - \\ln(1+b(1-z)) \\right) = \\frac{k_{\\text{on}}}{\\gamma} \\ln\\left( \\frac{1+b(1-z)\\exp(-\\gamma t)}{1+b(1-z)} \\right)$$\n将此代回 $G(z,t)$ 的表达式：\n$$G(z,t) = \\exp(I) = \\left( \\frac{1+b(1-z)\\exp(-\\gamma t)}{1+b(1-z)} \\right)^{k_{\\text{on}}/\\gamma}$$\n这是瞬时 PGF 的闭合形式表达式。\n\n接下来，我们通过找到 $G(z,t)$ 级数展开中 $z^n$ 的系数来提取概率质量函数 $P(n,t)$。令 $\\alpha = k_{\\text{on}}/\\gamma$。我们可以将 $G(z,t)$ 重写为：\n$$G(z,t) = (1+b\\exp(-\\gamma t) - bz\\exp(-\\gamma t))^{\\alpha} \\cdot (1+b-bz)^{-\\alpha}$$\n提出与 $z$ 无关的项：\n$$G(z,t) = (1+b\\exp(-\\gamma t))^{\\alpha} \\left(1 - \\frac{b\\exp(-\\gamma t)}{1+b\\exp(-\\gamma t)} z \\right)^{\\alpha} \\cdot (1+b)^{-\\alpha} \\left(1-\\frac{b}{1+b}z\\right)^{-\\alpha}$$\n$$G(z,t) = \\left(\\frac{1+b\\exp(-\\gamma t)}{1+b}\\right)^{\\alpha} \\left(1-p_1(t)z\\right)^{\\alpha} \\left(1-p_2 z\\right)^{-\\alpha}$$\n其中 $p_1(t) = \\frac{b\\exp(-\\gamma t)}{1+b\\exp(-\\gamma t)}$ 和 $p_2 = \\frac{b}{1+b}$。\n我们使用广义二项式定理，$(1+x)^r = \\sum_{k=0}^{\\infty} \\binom{r}{k} x^k$，其中对于实数 $r$ 和非负整数 $k$，$\\binom{r}{k} = \\frac{r(r-1)\\cdots(r-k+1)}{k!}$。\n这两个因子展开为：\n$$(1-p_1(t)z)^{\\alpha} = \\sum_{j=0}^{\\infty} \\binom{\\alpha}{j} (-p_1(t)z)^j$$\n$$(1-p_2 z)^{-\\alpha} = \\sum_{k=0}^{\\infty} \\binom{-\\alpha}{k} (-p_2 z)^k = \\sum_{k=0}^{\\infty} (-1)^k \\binom{\\alpha+k-1}{k} (-p_2 z)^k = \\sum_{k=0}^{\\infty} \\binom{\\alpha+k-1}{k} (p_2 z)^k$$\n$G(z,t)$ 中 $z^n$ 的系数是 $P(n,t)$，它由两个级数的柯西乘积得到：\n$$P(n,t) = \\left(\\frac{1+b\\exp(-\\gamma t)}{1+b}\\right)^{\\alpha} \\sum_{k=0}^{n} [z^{n-k}]\\left((1-p_1(t)z)^{\\alpha}\\right) \\cdot [z^k]\\left((1-p_2 z)^{-\\alpha}\\right)$$\n$$P(n,t) = \\left(\\frac{1+b\\exp(-\\gamma t)}{1+b}\\right)^{\\alpha} \\sum_{k=0}^{n} \\left(\\binom{\\alpha}{n-k}(-p_1(t))^{n-k}\\right) \\cdot \\left(\\binom{\\alpha+k-1}{k} p_2^k\\right)$$\n我们定义上升阶乘 $x^{\\overline{k}} = x(x+1)\\cdots(x+k-1)$ 对于 $k \\ge 1$ 且 $x^{\\overline{0}}=1$。那么 $\\binom{\\alpha+k-1}{k} = \\frac{\\alpha^{\\overline{k}}}{k!}$。代回 $\\alpha$、$p_1(t)$ 和 $p_2$ 的表达式：\n$$P(n,t) = \\left( \\frac{1+b\\exp(-\\gamma t)}{1+b} \\right)^{k_{\\text{on}}/\\gamma} \\sum_{k=0}^{n} (-1)^{n-k} \\binom{k_{\\text{on}}/\\gamma}{n-k} \\frac{(k_{\\text{on}}/\\gamma)^{\\overline{k}}}{k!} \\left(\\frac{b\\exp(-\\gamma t)}{1+b\\exp(-\\gamma t)}\\right)^{n-k} \\left(\\frac{b}{1+b}\\right)^k$$\n此公式按要求将 $P(n,t)$ 表示为使用广义二项式系数和上升阶乘的有限和。", "answer": "$$\n\\boxed{\n\\pmatrix{\n\\left( \\frac{1+b(1-z)\\exp(-\\gamma t)}{1+b(1-z)} \\right)^{k_{\\text{on}}/\\gamma}\n&\n\\left( \\frac{1+b\\exp(-\\gamma t)}{1+b} \\right)^{\\frac{k_{\\text{on}}}{\\gamma}} \\sum_{k=0}^{n} (-1)^{n-k} \\binom{\\frac{k_{\\text{on}}}{\\gamma}}{n-k} \\frac{(\\frac{k_{\\text{on}}}{\\gamma})^{\\overline{k}}}{k!} \\left(\\frac{b\\exp(-\\gamma t)}{1+b\\exp(-\\gamma t)}\\right)^{n-k} \\left(\\frac{b}{1+b}\\right)^k\n}\n}\n$$", "id": "2677651"}, {"introduction": "理论模型的力量在于其预测能力以及与实验数据的联系。本练习将引导您推导信使核糖核酸（mRNA）数量的自相关函数，并展示如何利用这一可测量的统计量来区分不同的转录爆发机制。这个过程深刻揭示了如何从动态数据中提取关于底层生物学过程（如启动子动力学）的信息。", "problem": "单个基因以随机转录爆发的方式产出信使核糖核酸 (mRNA)。爆发以速率 $\\lambda$ 的齐次泊松过程形式到达。在每次爆发时，会瞬时产生整数个 $K$ 个 mRNA 分子；不同的爆发是独立同分布的，并且与所有后续的降解事件无关。每个 mRNA 分子以一级速率 $\\delta$ 独立降解。令 $M(t)$ 表示时间 $t$ 的稳态 mRNA 拷贝数，并定义稳态自协方差函数 $C(\\tau) \\equiv \\mathbb{E}\\!\\left[(M(t)-\\mathbb{E}[M])(M(t+\\tau)-\\mathbb{E}[M])\\right]$，其中 $\\tau \\ge 0$。\n\n仅从 mRNA 的线性生灭动力学以及泊松过程和独立指数寿命的定义性质出发，完成以下任务：\n\n1. 以 $\\lambda$、$\\delta$、$\\mathbb{E}[K]$ 和 $\\mathbb{E}[K^{2}]$ 表示，推导短延迟（即对于任意固定的 $\\tau \\ge 0$）下的 $C(\\tau)$。你的推导必须明确使用第一性原理（例如，以爆发后的时间和爆发大小为条件），并且不得调用任何现成的相关性公式。\n\n2. 假设平均爆发大小固定为 $\\mathbb{E}[K]=b$，其中 $b>0$。考虑关于爆发大小分布的两种机理假设：\n   - 在 $\\{0,1,2,\\dots\\}$ 上的几何分布爆发，对应于单步启动子失活（指数分布的开启时间），这产生一个平均值为 $b$ 的几何分布。\n   - 由 $n$ 步启动子失活（$n \\in \\mathbb{N}$）产生的非几何分布爆发，建模为具有固定平均值的 Erlang-$n$ 分布的开启时间，在此期间转录以泊松过程发生。在这种情况下，爆发大小是平均值为 $b$、形状参数为 $n$ 的负二项分布。\n   \n   仅使用泊松过程的定义和全方差公式，将每种假设下的 $\\mathbb{E}[K^{2}]$ 表示为 $b$ 和 $n$ 的函数。\n\n3. 将短延迟诊断能力定义为，在保持 $\\lambda$、$\\delta$、$b$ 和 $\\tau$ 固定的情况下，几何模型（$n=1$）和 $n$ 步非几何模型（$n>1$）在延迟 $\\tau$ 处的预测自协方差振幅之间的相对分离度：\n   $$P(b,n) \\equiv \\frac{C_{\\text{geom}}(\\tau)-C_{n}(\\tau)}{C_{\\text{geom}}(\\tau)}.$$\n   推导 $P(b,n)$ 的一个仅依赖于 $b$ 和 $n$（而不依赖于 $\\lambda$、$\\delta$ 或 $\\tau$）的闭式表达式。你的最终答案必须是一个单一的解析表达式。", "solution": "所提出的问题是随机基因表达理论中的一个标准的、适定的问题。它有科学依据，内部一致，并要求从第一性原理推导基本量。该问题是有效的，我们将着手解答。\n\n根据问题陈述的要求，解答分为三个部分。\n\n第1部分：自协方差函数 $C(\\tau)$ 的推导。\n\n令 $M(t)$ 为时间 $t$ 的 mRNA 分子数。该过程由两种反应类型控制：\n1.  爆发式生产：$\\emptyset \\xrightarrow{\\lambda} K$ mRNA，其中爆发以速率 $\\lambda$ 的泊松过程发生，$K$ 是每次爆发产生的分子数的随机变量。\n2.  一级降解：mRNA $\\xrightarrow{\\delta}$ $\\emptyset$，其中每个分子以速率 $\\delta$ 独立降解。\n\n稳态下的自协方差函数定义为 $C(\\tau) = \\mathbb{E}[M(t)M(t+\\tau)] - (\\mathbb{E}[M])^{2}$，其中 $\\tau \\ge 0$。由于是稳态，为简单起见，我们可以设 $t=0$，因此 $C(\\tau) = \\text{Cov}(M(0), M(\\tau))$。\n\n在时间 $\\tau$ 的分子数 $M(\\tau)$ 可以分解为两个群体：\n1.  $M_{s}(\\tau)$：在时间 $t=0$ 时存在并存活到时间 $\\tau$ 的分子。\n2.  $M_{n}(\\tau)$：在时间区间 $(0, \\tau]$ 内由爆发产生的新分子。\n\n因此，$M(\\tau) = M_{s}(\\tau) + M_{n}(\\tau)$。\n由于在时间 $t=0$ 的 $M(0)$ 个分子中的每一个都以概率 $\\exp(-\\delta \\tau)$ 独立地存活到时间 $\\tau$，因此以 $M(0)$ 为条件的存活分子数 $M_{s}(\\tau)$ 服从二项分布，$M_{s}(\\tau) | M(0) \\sim \\text{Binomial}(M(0), \\exp(-\\delta \\tau))$。其条件期望为 $\\mathbb{E}[M_s(\\tau) | M(0)] = M(0) \\exp(-\\delta \\tau)$。\n\n新分子 $M_{n}(\\tau)$ 是由发生在 $(0, \\tau]$ 内的爆发产生的，这是一个泊松过程，独立于 $t=0$ 或之前系统的状态。因此，$M_{n}(\\tau)$ 与 $M(0)$ 独立。\n\n现在，我们计算协方差：\n$$C(\\tau) = \\text{Cov}(M(0), M(\\tau)) = \\text{Cov}(M(0), M_{s}(\\tau) + M_{n}(\\tau))$$\n根据协方差的线性性质：\n$$C(\\tau) = \\text{Cov}(M(0), M_{s}(\\tau)) + \\text{Cov}(M(0), M_{n}(\\tau))$$\n由于 $M(0)$ 和 $M_{n}(\\tau)$ 是独立的，$\\text{Cov}(M(0), M_{n}(\\tau)) = 0$。我们剩下：\n$$C(\\tau) = \\text{Cov}(M(0), M_{s}(\\tau))$$\n使用全协方差公式 $\\text{Cov}(X,Y) = \\mathbb{E}[\\text{Cov}(X,Y|Z)] + \\text{Cov}(\\mathbb{E}[X|Z], \\mathbb{E}[Y|Z])$，其中 $X=M(0)$，$Y=M_s(\\tau)$，$Z=M(0)$。\n$\\mathbb{E}[M_s(\\tau)|M(0)] = M(0) \\exp(-\\delta \\tau)$。给定 $M(0)$，这不是随机的，所以 $\\text{Cov}(M(0),M_s(\\tau)|M(0)) = 0$。\n第二项给出：\n$$C(\\tau) = \\text{Cov}(M(0), \\mathbb{E}[M_s(\\tau)|M(0)]) = \\text{Cov}(M(0), M(0)\\exp(-\\delta \\tau))$$\n$$C(\\tau) = \\exp(-\\delta \\tau) \\text{Cov}(M(0), M(0)) = \\exp(-\\delta \\tau) \\text{Var}(M)$$\n问题现在简化为求 mRNA 拷贝数的稳态方差 $\\text{Var}(M)$。按照提示的要求，我们从动力学出发，使用从底层的化学主方程导出的矩方程。\n\n对于一阶矩 $\\mathbb{E}[M]$：\n$$\\frac{d\\mathbb{E}[M]}{dt} = (\\text{生产速率}) - (\\text{降解速率})$$\n$$\\frac{d\\mathbb{E}[M]}{dt} = \\lambda \\mathbb{E}[K] - \\delta \\mathbb{E}[M]$$\n在稳态下，$\\frac{d\\mathbb{E}[M]}{dt}=0$，这给出 $\\mathbb{E}[M] = \\frac{\\lambda \\mathbb{E}[K]}{\\delta}$。\n\n对于二阶矩 $\\mathbb{E}[M^2]$：\n$$\\frac{d\\mathbb{E}[M^2]}{dt} = \\sum_{\\text{反应}} (\\text{倾向}) \\times \\mathbb{E}[\\Delta(M^2)]$$\n来自一次爆发的变化：$\\Delta(M^2) = (M+K)^2 - M^2 = 2MK + K^2$。期望变化是 $\\lambda \\mathbb{E}[2MK + K^2] = 2\\lambda\\mathbb{E}[M]\\mathbb{E}[K] + \\lambda\\mathbb{E}[K^2]$，因为爆发大小 $K$ 与当前分子数 $M$ 无关。\n来自一次降解的变化：$\\Delta(M^2) = (M-1)^2 - M^2 = -2M+1$。总降解速率是 $\\delta M$，所以期望变化是 $\\mathbb{E}[\\delta M(-2M+1)] = -2\\delta\\mathbb{E}[M^2] + \\delta\\mathbb{E}[M]$。\n结合这些：\n$$\\frac{d\\mathbb{E}[M^2]}{dt} = 2\\lambda\\mathbb{E}[K]\\mathbb{E}[M] + \\lambda\\mathbb{E}[K^2] - 2\\delta\\mathbb{E}[M^2] + \\delta\\mathbb{E}[M]$$\n在稳态下，$\\frac{d\\mathbb{E}[M^2]}{dt}=0$：\n$$2\\delta\\mathbb{E}[M^2] = 2\\lambda\\mathbb{E}[K]\\mathbb{E}[M] + \\delta\\mathbb{E}[M] + \\lambda\\mathbb{E}[K^2]$$\n代入 $\\mathbb{E}[M] = \\frac{\\lambda \\mathbb{E}[K]}{\\delta}$：\n$$2\\delta\\mathbb{E}[M^2] = 2\\lambda\\mathbb{E}[K] \\left(\\frac{\\lambda \\mathbb{E}[K]}{\\delta}\\right) + \\delta \\left(\\frac{\\lambda \\mathbb{E}[K]}{\\delta}\\right) + \\lambda\\mathbb{E}[K^2]$$\n$$2\\delta\\mathbb{E}[M^2] = \\frac{2(\\lambda\\mathbb{E}[K])^2}{\\delta} + \\lambda\\mathbb{E}[K] + \\lambda\\mathbb{E}[K^2]$$\n$$\\mathbb{E}[M^2] = \\frac{(\\lambda\\mathbb{E}[K])^2}{\\delta^2} + \\frac{\\lambda}{2\\delta}(\\mathbb{E}[K] + \\mathbb{E}[K^2])$$\n现在我们计算方差：\n$$\\text{Var}(M) = \\mathbb{E}[M^2] - (\\mathbb{E}[M])^2$$\n$$\\text{Var}(M) = \\left(\\frac{(\\lambda\\mathbb{E}[K])^2}{\\delta^2} + \\frac{\\lambda}{2\\delta}(\\mathbb{E}[K] + \\mathbb{E}[K^2])\\right) - \\left(\\frac{\\lambda \\mathbb{E}[K]}{\\delta}\\right)^2$$\n$$\\text{Var}(M) = \\frac{\\lambda}{2\\delta}(\\mathbb{E}[K] + \\mathbb{E}[K^2])$$\n最后，将此方差代入 $C(\\tau)$ 的表达式：\n$$C(\\tau) = \\frac{\\lambda}{2\\delta}(\\mathbb{E}[K] + \\mathbb{E}[K^2]) \\exp(-\\delta \\tau)$$\n\n第2部分：两种假设下 $\\mathbb{E}[K^2]$ 的计算。\n\n我们已知 $\\mathbb{E}[K]=b$。\n\n假设1：几何分布爆发 ($n=1$)。\n爆发大小 $K$ 服从在 $\\{0,1,2,\\dots\\}$ 上的几何分布。设成功概率为 $1-p$，失败概率为 $p$。$P(K=k) = (1-p)p^k$。\n平均值为 $\\mathbb{E}[K] = \\frac{p}{1-p}$。\n给定 $\\mathbb{E}[K]=b$，我们有 $b = \\frac{p}{1-p}$，解得 $p = \\frac{b}{1+b}$。\n方差为 $\\text{Var}(K) = \\frac{p}{(1-p)^2} = \\left(\\frac{p}{1-p}\\right)\\frac{1}{1-p} = b(1+b)$。\n我们使用关系式 $\\mathbb{E}[K^2] = \\text{Var}(K) + (\\mathbb{E}[K])^2$ 来求 $\\mathbb{E}[K^2]$：\n$$\\mathbb{E}[K^2]_{\\text{geom}} = b(1+b) + b^2 = b+2b^2$$\n\n假设2：非几何分布爆发 ($n>1$)。\n爆发大小 $K$ 服从平均值为 $b$、形状参数为 $n$ 的负二项分布。该分布可以看作是 $n$ 个独立同分布的几何随机变量之和。设每个这样的几何分量的平均值为 $b/n$。\n负二项分布的方差由 $\\text{Var}(K) = b\\left(1+\\frac{b}{n}\\right)$ 给出。\n对二阶矩使用相同的关系式：\n$$\\mathbb{E}[K^2]_{n} = \\text{Var}(K) + (\\mathbb{E}[K])^2 = b\\left(1+\\frac{b}{n}\\right) + b^2 = b + \\frac{b^2}{n} + b^2 = b + b^2\\left(1+\\frac{1}{n}\\right)$$\n注意，当 $n=1$ 时，该表达式给出 $b+b^2(2) = b+2b^2$，这正确地简化为几何分布的情况。\n\n第3部分：诊断能力 $P(b,n)$ 的推导。\n\n诊断能力定义为 $P(b,n) \\equiv \\frac{C_{\\text{geom}}(\\tau)-C_{n}(\\tau)}{C_{\\text{geom}}(\\tau)} = 1 - \\frac{C_{n}(\\tau)}{C_{\\text{geom}}(\\tau)}$。\n使用第1部分的结果，比率 $\\frac{C_{n}(\\tau)}{C_{\\text{geom}}(\\tau)}$ 变为：\n$$\\frac{C_{n}(\\tau)}{C_{\\text{geom}}(\\tau)} = \\frac{\\frac{\\lambda}{2\\delta}(\\mathbb{E}[K] + \\mathbb{E}[K^2]_{n}) \\exp(-\\delta \\tau)}{\\frac{\\lambda}{2\\delta}(\\mathbb{E}[K] + \\mathbb{E}[K^2]_{\\text{geom}}) \\exp(-\\delta \\tau)} = \\frac{\\mathbb{E}[K] + \\mathbb{E}[K^2]_{n}}{\\mathbb{E}[K] + \\mathbb{E}[K^2]_{\\text{geom}}}$$\n除 $K$ 的矩之外的所有参数都消掉了。代入第2部分的表达式和 $\\mathbb{E}[K]=b$：\n分子：$b + \\mathbb{E}[K^2]_{n} = b + \\left(b + b^2\\left(1+\\frac{1}{n}\\right)\\right) = 2b + b^2 + \\frac{b^2}{n}$。\n分母：$b + \\mathbb{E}[K^2]_{\\text{geom}} = b + (b+2b^2) = 2b + 2b^2$。\n该比率为：\n$$\\frac{C_{n}(\\tau)}{C_{\\text{geom}}(\\tau)} = \\frac{2b + b^2 + \\frac{b^2}{n}}{2b + 2b^2}$$\n因为 $b>0$，我们可以从分子和分母中提出因子 $b$：\n$$\\frac{C_{n}(\\tau)}{C_{\\text{geom}}(\\tau)} = \\frac{b(2 + b + \\frac{b}{n})}{b(2 + 2b)} = \\frac{2 + b + \\frac{b}{n}}{2(1+b)}$$\n现在，我们计算 $P(b,n)$：\n$$P(b,n) = 1 - \\frac{2 + b + \\frac{b}{n}}{2(1+b)} = \\frac{2(1+b) - (2 + b + \\frac{b}{n})}{2(1+b)}$$\n$$P(b,n) = \\frac{2 + 2b - 2 - b - \\frac{b}{n}}{2(1+b)} = \\frac{b - \\frac{b}{n}}{2(1+b)}$$\n$$P(b,n) = \\frac{b(1 - \\frac{1}{n})}{2(1+b)} = \\frac{b(\\frac{n-1}{n})}{2(1+b)}$$\n这简化为最终的闭式表达式：\n$$P(b,n) = \\frac{b(n-1)}{2n(1+b)}$$\n此结果仅依赖于平均爆发大小 $b$ 和爆发复杂度参数 $n$，符合要求。", "answer": "$$\\boxed{\\frac{b(n-1)}{2n(1+b)}}$$", "id": "2677667"}, {"introduction": "在实际研究中，我们观测到的信号（如荧光强度）往往是底层分子过程（如启动子状态）的含噪间接反映。本练习将指导您构建一个隐马尔可夫模型（HMM）框架，以从充满噪声的连续时间序列数据中推断隐藏的启动子转换率。这是一个综合性的实践，融合了随机过程理论、统计推断和计算方法，是定量生物学数据分析的核心技能。", "problem": "您的任务是，在一个启动子遵循两态电报模型且存在加性高斯测量噪声的基因中，形式化并计算连续荧光时间序列观测的似然。基因启动子在非活动状态和活动状态之间切换，这两种状态产生具有不同平均水平的荧光。启动子动力学被建模为连续时间马尔可夫链（CTMC），而荧光则在离散时间点进行测量，并带有高斯噪声。您必须使用隐马尔可夫模型（HMM）的公式和一个数值稳定的前向算法，推导出给定模型参数下单个荧光轨迹的似然。\n\n使用以下基本出发点：\n- 电报启动子是一个在“OFF”和“ON”两个状态上的CTMC，从“OFF”到“ON”的切换速率为 $k_{\\mathrm{on}}$，从“ON”到“OFF”的切换速率为 $k_{\\mathrm{off}}$。\n- 启动子状态在离散时间点 $t_1, t_2, \\dots, t_T$ 进行采样，时间间隔恒为 $\\Delta t$。\n- 在时间 $t$ 的荧光观测值为 $F_t = \\mu_{S_t} + \\eta_t$，其中 $S_t \\in \\{\\mathrm{OFF}, \\mathrm{ON}\\}$ 是时间 $t$ 的隐藏启动子状态，$\\mu_{\\mathrm{OFF}}$ 和 $\\mu_{\\mathrm{ON}}$ 是依赖于状态的均值，$\\eta_t$ 是独立的高斯噪声变量，满足 $\\eta_t \\sim \\mathcal{N}(0,\\sigma^2)$。\n\n需要推导的数学任务：\n1. 从电报过程的CTMC生成元出发，推导出精确的离散时间转移矩阵 $P(\\Delta t)$，其元素为 $p_{ij}(\\Delta t) = \\mathbb{P}(S_{t+\\Delta t}=j \\mid S_t=i)$，其中 $i,j \\in \\{\\mathrm{OFF},\\mathrm{ON}\\}$。用 $k_{\\mathrm{on}}$、$k_{\\mathrm{off}}$ 和 $\\Delta t$ 表示 $P(\\Delta t)$。\n2. 写出每个隐藏状态 $s \\in \\{\\mathrm{OFF},\\mathrm{ON}\\}$ 的高斯发射密度 $f(F_t \\mid S_t=s)$，并定义在给定隐藏状态路径 $\\{S_t\\}_{t=1}^T$ 条件下，序列 $\\{F_t\\}_{t=1}^T$ 的发射似然。\n3. 通过对所有隐藏状态轨迹进行边缘化，推导出完整数据似然 $L = \\mathbb{P}(F_{1:T})$。提供一个基于前向算法的计算方案，该方案通过在每个时间步进行归一化来稳定地得出 $\\log L$。假设在 $t_1$ 时的初始分布等于CTMC的稳态分布，并从生成元出发证明其合理性。\n4. 提出一个隐马尔可夫模型（HMM）推断方案，包括：通过缩放前向递归计算似然；通过后向递归计算后验状态边缘概率；以及通过期望最大化（EM）方法（Baum–Welch）进行最大似然参数更新的纲要，并指出参数估计所需的充分统计量。您无需用代码实现EM，但必须精确陈述需要计算的数学对象。\n\n计算任务：\n- 实现一个不接受任何输入的程序，使用缩放前向算法为下面定义的固定测试套件计算总对数似然。对于每个测试案例，使用稳态初始分布和从速率与采样间隔推导出的精确离散时间转移矩阵。使用具有给定均值和方差的高斯发射模型。\n- 您的程序必须返回一行，该行为一个浮点数列表，每个浮点数是对应测试案例的总对数似然，四舍五入到小数点后六位。\n\n模型定义，用于您的推导和实现：\n- 电报过程的CTMC生成元是\n$$\nQ \\;=\\;\n\\begin{pmatrix}\n- k_{\\mathrm{on}} & k_{\\mathrm{on}} \\\\\nk_{\\mathrm{off}} & -k_{\\mathrm{off}}\n\\end{pmatrix}.\n$$\n- 稳态分布是\n$$\n\\pi_{\\mathrm{ON}} \\;=\\; \\frac{k_{\\mathrm{on}}}{k_{\\mathrm{on}} + k_{\\mathrm{off}}}, \\qquad\n\\pi_{\\mathrm{OFF}} \\;=\\; \\frac{k_{\\mathrm{off}}}{k_{\\mathrm{on}} + k_{\\mathrm{off}}}\n$$\n对于 $k_{\\mathrm{on}} + k_{\\mathrm{off}} > 0$。\n- 状态 $s$ 的高斯发射密度是\n$$\nf(F_t \\mid S_t = s) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\exp\\!\\left(-\\frac{(F_t - \\mu_s)^2}{2\\sigma^2}\\right).\n$$\n\n测试套件：\n对于每个案例，使用指定的参数通过缩放前向算法计算对数似然。\n\n- 案例 A：\n  - $\\Delta t = 1.0$\n  - $k_{\\mathrm{on}} = 0.3$, $k_{\\mathrm{off}} = 0.5$\n  - $\\mu_{\\mathrm{OFF}} = 0.2$, $\\mu_{\\mathrm{ON}} = 2.0$\n  - $\\sigma = 0.6$\n  - 荧光轨迹 $F_{1:10} = [0.15, 0.30, 1.80, 2.10, 1.90, 0.40, 0.20, 2.30, 2.00, 0.50]$\n\n- 案例 B（单观测边界）：\n  - $\\Delta t = 0.2$\n  - $k_{\\mathrm{on}} = 1.0$, $k_{\\mathrm{off}} = 1.0$\n  - $\\mu_{\\mathrm{OFF}} = 0.0$, $\\mu_{\\mathrm{ON}} = 1.0$\n  - $\\sigma = 0.5$\n  - 荧光轨迹 $F_{1:1} = [0.10]$\n\n- 案例 C（相对于采样的快速切换）：\n  - $\\Delta t = 0.5$\n  - $k_{\\mathrm{on}} = 3.0$, $k_{\\mathrm{off}} = 4.0$\n  - $\\mu_{\\mathrm{OFF}} = 0.0$, $\\mu_{\\mathrm{ON}} = 3.0$\n  - $\\sigma = 0.8$\n  - 荧光轨迹 $F_{1:15} = [0.2, 1.5, 2.8, 0.3, 2.7, 3.2, 0.1, 1.0, 2.5, 3.1, 0.4, 0.7, 2.9, 3.3, 0.2]$\n\n- 案例 D（低噪声，近确定性发射）：\n  - $\\Delta t = 1.0$\n  - $k_{\\mathrm{on}} = 0.8$, $k_{\\mathrm{off}} = 0.2$\n  - $\\mu_{\\mathrm{OFF}} = 0.0$, $\\mu_{\\mathrm{ON}} = 5.0$\n  - $\\sigma = 0.1$\n  - 荧光轨迹 $F_{1:8} = [5.10, 4.90, 5.00, 0.10, -0.05, 5.20, 5.00, 4.80]$\n\n- 案例 E（一种吸收趋势：无法从OFF状态激活）：\n  - $\\Delta t = 1.0$\n  - $k_{\\mathrm{on}} = 0.0$, $k_{\\mathrm{off}} = 1.0$\n  - $\\mu_{\\mathrm{OFF}} = 0.0$, $\\mu_{\\mathrm{ON}} = 2.0$\n  - $\\sigma = 0.3$\n  - 荧光轨迹 $F_{1:4} = [0.05, 0.10, -0.20, 0.30]$\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[r_A,r_B,r_C,r_D,r_E]”），其中每个 $r_\\cdot$ 是该案例的总对数似然，四舍五入到小数点后六位。\n- 不应打印任何其他文本。", "solution": "对所述问题进行验证。\n\n**第1步：提取的已知条件**\n-   启动子模型：一个在两个状态 $S \\in \\{\\mathrm{OFF}, \\mathrm{ON}\\}$ 上的连续时间马尔可夫链（CTMC），状态索引为 $0$ 代表 \"OFF\"，$1$ 代表 \"ON\"。\n-   切换速率：$k_{\\mathrm{on}}$ (从 OFF 到 ON) 和 $k_{\\mathrm{off}}$ (从 ON 到 OFF)。\n-   CTMC生成元矩阵：\n    $$\n    Q \\;=\\;\n    \\begin{pmatrix}\n    - k_{\\mathrm{on}} & k_{\\mathrm{on}} \\\\\n    k_{\\mathrm{off}} & -k_{\\mathrm{off}}\n    \\end{pmatrix}\n    $$\n-   稳态分布：$\\pi = [\\pi_{\\mathrm{OFF}}, \\pi_{\\mathrm{ON}}]$，其中 $\\pi_{\\mathrm{OFF}} = \\frac{k_{\\mathrm{off}}}{k_{\\mathrm{on}} + k_{\\mathrm{off}}}$ 和 $\\pi_{\\mathrm{ON}} = \\frac{k_{\\mathrm{on}}}{k_{\\mathrm{on}} + k_{\\mathrm{off}}}$，对于 $k_{\\mathrm{on}} + k_{\\mathrm{off}} > 0$。\n-   观测模型：荧光 $F_t$ 在离散时间点 $t_1, t_2, \\dots, t_T$ 进行测量，时间间隔恒为 $\\Delta t$。\n-   发射模型：$F_t = \\mu_{S_t} + \\eta_t$，其中 $S_t$ 是隐藏状态，$\\mu_s$ 是状态 $s$ 的均值，$\\eta_t \\sim \\mathcal{N}(0,\\sigma^2)$ 是独立的高斯噪声。\n-   发射概率密度：$f(F_t \\mid S_t = s) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\exp\\left(-\\frac{(F_t - \\mu_s)^2}{2\\sigma^2}\\right)$。\n-   初始分布：假设为稳态分布 $\\pi$。\n-   计算任务：使用缩放前向算法为五个特定的测试案例计算总对数似然 $\\log \\mathbb{P}(F_{1:T})$。\n\n**第2步：使用提取的已知条件进行验证**\n-   **科学依据**：该问题描述了基因表达的两态电报模型，这是定量生物学中的一个基石模型。将其表述为隐马尔可夫模型（HMM）是一种标准且严谨的方法。该模型基于化学动力学和概率论的既定原理。\n-   **适定性**：问题是完全指定的。为每个测试案例提供了所有必要的参数和数据。其目标——在给定模型下计算数据的似然——是一个具有唯一解的、定义明确的数学任务。\n-   **客观性**：问题以精确的数学和科学语言陈述，没有歧义或主观性。\n\n**第3步：结论与行动**\n该问题是有效的。它在科学上是合理的，是适定的、客观的，并且不包含任何矛盾或缺失信息。我们继续进行求解。\n\n---\n\n通过解决指定的四个数学任务来推导解决方案。状态索引为 $0$ 代表 OFF，$1$ 代表 ON。\n\n**1. 离散时间转移矩阵的推导**\n\n对于一个生成元为 $Q$ 的 CTMC，在时间间隔 $\\Delta t$ 内的转移概率矩阵 $P(\\Delta t)$ 由矩阵指数 $P(\\Delta t) = \\exp(Q \\Delta t)$ 给出。为了计算它，我们对生成元矩阵 $Q$ 进行对角化。\n\n$Q$ 的特征值 $\\lambda$ 通过解特征方程 $\\det(Q - \\lambda I) = 0$ 求得：\n$$\n\\det\\begin{pmatrix} -k_{\\mathrm{on}} - \\lambda & k_{\\mathrm{on}} \\\\ k_{\\mathrm{off}} & -k_{\\mathrm{off}} - \\lambda \\end{pmatrix} = (-k_{\\mathrm{on}} - \\lambda)(-k_{\\mathrm{off}} - \\lambda) - k_{\\mathrm{on}}k_{\\mathrm{off}} = 0\n$$\n$$\n\\lambda^2 + (k_{\\mathrm{on}} + k_{\\mathrm{off}})\\lambda + k_{\\mathrm{on}}k_{\\mathrm{off}} - k_{\\mathrm{on}}k_{\\mathrm{off}} = 0 \\implies \\lambda(\\lambda + (k_{\\mathrm{on}} + k_{\\mathrm{off}})) = 0\n$$\n特征值为 $\\lambda_1 = 0$ 和 $\\lambda_2 = -(k_{\\mathrm{on}} + k_{\\mathrm{off}})$。令 $k_s = k_{\\mathrm{on}} + k_{\\mathrm{off}}$。特征值为 $0$ 和 $-k_s$。\n\n对应的右特征向量是：\n对于 $\\lambda_1 = 0$：$Q v_1 = 0 \\implies \\begin{pmatrix} -k_{\\mathrm{on}} & k_{\\mathrm{on}} \\\\ k_{\\mathrm{off}} & -k_{\\mathrm{off}} \\end{pmatrix} \\begin{pmatrix} x \\\\ y \\end{pmatrix} = 0 \\implies x=y$。我们选择 $v_1 = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。\n对于 $\\lambda_2 = -k_s$：$(Q + k_s I) v_2 = 0 \\implies \\begin{pmatrix} k_{\\mathrm{off}} & k_{\\mathrm{on}} \\\\ k_{\\mathrm{off}} & k_{\\mathrm{on}} \\end{pmatrix} \\begin{pmatrix} x \\\\ y \\end{pmatrix} = 0 \\implies k_{\\mathrm{off}}x + k_{\\mathrm{on}}y = 0$。我们选择 $v_2 = \\begin{pmatrix} k_{\\mathrm{on}} \\\\ -k_{\\mathrm{off}} \\end{pmatrix}$。\n\n我们构建特征向量矩阵 $S = \\begin{pmatrix} 1 & k_{\\mathrm{on}} \\\\ 1 & -k_{\\mathrm{off}} \\end{pmatrix}$ 和对角矩阵 $D = \\begin{pmatrix} 0 & 0 \\\\ 0 & -k_s \\end{pmatrix}$。则 $Q = S D S^{-1}$。\n$S$ 的逆是 $S^{-1} = \\frac{1}{-k_{\\mathrm{off}}-k_{\\mathrm{on}}} \\begin{pmatrix} -k_{\\mathrm{off}} & -k_{\\mathrm{on}} \\\\ -1 & 1 \\end{pmatrix} = \\frac{1}{k_s} \\begin{pmatrix} k_{\\mathrm{off}} & k_{\\mathrm{on}} \\\\ 1 & -1 \\end{pmatrix}$。\n\n那么转移矩阵为 $P(\\Delta t) = \\exp(Q \\Delta t) = S \\exp(D \\Delta t) S^{-1}$：\n$$\nP(\\Delta t) = \\begin{pmatrix} 1 & k_{\\mathrm{on}} \\\\ 1 & -k_{\\mathrm{off}} \\end{pmatrix} \\begin{pmatrix} e^{0} & 0 \\\\ 0 & e^{-k_s \\Delta t} \\end{pmatrix} \\frac{1}{k_s} \\begin{pmatrix} k_{\\mathrm{off}} & k_{\\mathrm{on}} \\\\ 1 & -1 \\end{pmatrix}\n$$\n$$\nP(\\Delta t) = \\frac{1}{k_s} \\begin{pmatrix} 1 & k_{\\mathrm{on}} e^{-k_s \\Delta t} \\\\ 1 & -k_{\\mathrm{off}} e^{-k_s \\Delta t} \\end{pmatrix} \\begin{pmatrix} k_{\\mathrm{off}} & k_{\\mathrm{on}} \\\\ 1 & -1 \\end{pmatrix}\n$$\n$$\nP(\\Delta t) = \\frac{1}{k_{\\mathrm{on}} + k_{\\mathrm{off}}}\n\\begin{pmatrix}\nk_{\\mathrm{off}} + k_{\\mathrm{on}} e^{-(k_{\\mathrm{on}} + k_{\\mathrm{off}})\\Delta t} & k_{\\mathrm{on}} (1 - e^{-(k_{\\mathrm{on}} + k_{\\mathrm{off}})\\Delta t}) \\\\\nk_{\\mathrm{off}} (1 - e^{-(k_{\\mathrm{on}} + k_{\\mathrm{off}})\\Delta t}) & k_{\\mathrm{on}} + k_{\\mathrm{off}} e^{-(k_{\\mathrm{on}} + k_{\\mathrm{off}})\\Delta t}\n\\end{pmatrix}\n$$\n元素为 $p_{ij}(\\Delta t) = \\mathbb{P}(S_{t+\\Delta t}=j \\mid S_t=i)$，其中 $i,j \\in \\{0,1\\}$。例如，$p_{01}(\\Delta t) = \\frac{k_{\\mathrm{on}}}{k_s}(1 - e^{-k_s \\Delta t})$。此公式在 $k_s > 0$ 时有效。如果 $k_s=0$，则 $Q=0$ 且 $P(\\Delta t)=I$。\n\n**2. 发射模型和似然公式**\n\n给定隐藏状态 $S_t=s$ 时，观测值 $F_t$ 的发射概率密度是一个高斯分布：\n$$\nf(F_t \\mid S_t = s) = \\mathcal{N}(F_t; \\mu_s, \\sigma^2) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(F_t - \\mu_s)^2}{2\\sigma^2}\\right)\n$$\n其中 $s \\in \\{\\mathrm{OFF}, \\mathrm{ON}\\}$。对于一个特定的隐藏状态路径 $S_{1:T} = \\{S_1, S_2, \\dots, S_T\\}$，观测序列 $F_{1:T} = \\{F_1, F_2, \\dots, F_T\\}$ 的似然是：\n$$\n\\mathbb{P}(F_{1:T} \\mid S_{1:T}) = \\prod_{t=1}^T f(F_t \\mid S_t)\n$$\n这是因为假设测量噪声 $\\eta_t$ 在每个时间点都是独立的。\n\n**3. 通过前向算法计算完整数据似然**\n\n观测序列的总似然 $L = \\mathbb{P}(F_{1:T})$ 是通过对所有可能的隐藏状态路径进行边缘化得到的：\n$$\nL = \\sum_{S_{1:T}} \\mathbb{P}(F_{1:T}, S_{1:T}) = \\sum_{S_{1:T}} \\mathbb{P}(S_1) \\left( \\prod_{t=2}^T \\mathbb{P}(S_t \\mid S_{t-1}) \\right) \\left( \\prod_{t=1}^T f(F_t \\mid S_t) \\right)\n$$\n直接求和在计算上是不可行的。前向算法提供了一种高效的方法。我们定义前向变量 $\\alpha_t(j) = \\mathbb{P}(F_{1:t}, S_t=j)$。\n\n为了防止数值下溢，使用了一个缩放版本。我们定义缩放的前向变量 $\\hat{\\alpha}_t(j) = \\mathbb{P}(S_t=j \\mid F_{1:t})$ 和缩放因子 $c_t = \\mathbb{P}(F_t \\mid F_{1:t-1})$。对数似然则为 $\\log L = \\sum_{t=1}^T \\log c_t$。\n\n该算法过程如下：\n-   **初始化 ($t=1$)**：假设系统处于稳态。\n    -   初始状态概率由稳态分布 $\\pi = [\\pi_0, \\pi_1]$ 给出，其中 $\\pi_0 = \\pi_{\\mathrm{OFF}}$ 和 $\\pi_1 = \\pi_{\\mathrm{ON}}$。\n    -   计算未缩放的前向变量：$\\alpha'_1(j) = \\pi_j \\cdot f(F_1 \\mid S_1=j)$，对于 $j \\in \\{0, 1\\}$。\n    -   计算第一个缩放因子：$c_1 = \\sum_{j=0}^{1} \\alpha'_1(j)$。\n    -   计算缩放后的变量：$\\hat{\\alpha}_1(j) = \\alpha'_1(j) / c_1$。\n    -   初始化总对数似然：$\\log L = \\log c_1$。\n\n-   **递归 ($t=2, \\dots, T$)**：\n    -   对于每个状态 $j \\in \\{0, 1\\}$，计算时间 $t$ 的未缩放前向变量：\n        $$\n        \\alpha'_t(j) = \\left[ \\sum_{i=0}^{1} \\hat{\\alpha}_{t-1}(i) \\cdot p_{ij}(\\Delta t) \\right] \\cdot f(F_t \\mid S_t=j)\n        $$\n    -   计算时间 $t$ 的缩放因子：$c_t = \\sum_{j=0}^{1} \\alpha'_t(j)$。\n    -   计算缩放后的变量：$\\hat{\\alpha}_t(j) = \\alpha'_t(j) / c_t$。\n    -   更新总对数似然：$\\log L \\leftarrow \\log L + \\log c_t$。\n\n这个过程是数值稳定的，并能得出精确的对数似然。在实现时，所有计算最好在对数空间中进行，以处理极小的概率。\n\n**4. HMM 推断方案：前向-后向算法和 EM**\n\n-   **后向递归**：为了计算后验状态概率，我们引入后向变量 $\\beta_t(i) = \\mathbb{P}(F_{t+1:T} \\mid S_t=i)$。\n    -   **初始化 ($t=T$)**：$\\beta_T(i) = 1$，对于 $i \\in \\{0, 1\\}$。\n    -   **递归 ($t=T-1, \\dots, 1$)**：\n        $$\n        \\beta_t(i) = \\sum_{j=0}^{1} p_{ij}(\\Delta t) \\cdot f(F_{t+1} \\mid S_{t+1}=j) \\cdot \\beta_{t+1}(j)\n        $$\n    这些也可以使用前向传播中的因子 $c_t$ 进行缩放。\n\n-   **后验状态边缘概率（平滑）**：\n    -   给定所有观测值，在时间 $t$ 处于状态 $i$ 的概率是：\n        $$\n        \\gamma_t(i) = \\mathbb{P}(S_t=i \\mid F_{1:T}) = \\frac{\\alpha_t(i) \\beta_t(i)}{\\sum_{j=0}^{1} \\alpha_t(j) \\beta_t(j)}\n        $$\n    -   在时间 $t$ 从状态 $i$ 转移到状态 $j$ 的成对边缘概率是：\n        $$\n        \\xi_t(i,j) = \\mathbb{P}(S_{t-1}=i, S_t=j \\mid F_{1:T}) = \\frac{\\alpha_{t-1}(i) p_{ij}(\\Delta t) f(F_t \\mid S_t=j) \\beta_t(j)}{\\sum_{i',j'} \\alpha_{t-1}(i') p_{i'j'}(\\Delta t) f(F_t \\mid S_t=j') \\beta_t(j')}\n        $$\n\n-   **期望最大化（EM）/ Baum-Welch 算法纲要**：\n    这个迭代算法用于寻找模型参数 $\\theta = \\{k_{\\mathrm{on}}, k_{\\mathrm{off}}, \\mu_0, \\mu_1, \\sigma\\}$ 的最大似然估计。\n    -   **E-步**：使用当前参数 $\\theta^{(k)}$，计算所有 $t, i, j$ 的后验边缘概率 $\\gamma_t(i)$ 和 $\\xi_t(i,j)$。这些代表了状态和转移的期望“计数”。\n    -   **M-步**：通过最大化期望完整数据对数似然来更新参数为 $\\theta^{(k+1)}$，这导致以下重估公式：\n        -   **发射均值**：状态 $s$ 的新均值是观测值的加权平均，权重是后验概率 $\\gamma_t(s)$。\n            $$ \\mu_s^{(k+1)} = \\frac{\\sum_{t=1}^T \\gamma_t(s) F_t}{\\sum_{t=1}^T \\gamma_t(s)} $$\n        -   **发射方差**：\n            $$ (\\sigma^2)^{(k+1)} = \\frac{\\sum_{s=0}^{1} \\sum_{t=1}^T \\gamma_t(s) (F_t - \\mu_s^{(k+1)})^2}{\\sum_{t=1}^T \\sum_{s=0}^{1} \\gamma_t(s) } = \\frac{1}{T} \\sum_{s=0}^{1} \\sum_{t=1}^T \\gamma_t(s) (F_t - \\mu_s^{(k+1)})^2$$\n        -   **转移参数**：首先，重新估计离散转移概率：\n            $$ p_{ij}^{(k+1)} = \\frac{\\sum_{t=2}^T \\xi_t(i,j)}{\\sum_{t=2}^T \\gamma_{t-1}(i)} $$\n            然后从重新估计的矩阵 $P^{(k+1)}$ 中恢复连续时间速率 $k_{\\mathrm{on}}$ 和 $k_{\\mathrm{off}}$。$P^{(k+1)}$ 的第二个特征值是 $\\lambda_2^{(k+1)} = e^{-(k_{\\mathrm{on}}^{(k+1)} + k_{\\mathrm{off}}^{(k+1)})\\Delta t}$，这给出 $k_s^{(k+1)} = k_{\\mathrm{on}}^{(k+1)} + k_{\\mathrm{off}}^{(k+1)}$。稳态分布 $\\pi^{(k+1)}$ 是 $P^{(k+1)}$ 对应于特征值 $1$ 的左特征向量，它给出了速率的比率。从 $\\pi_1^{(k+1)} = k_{\\mathrm{on}}^{(k+1)}/k_s^{(k+1)}$，我们可以解出 $k_{\\mathrm{on}}^{(k+1)}$，并随后解出 $k_{\\mathrm{off}}^{(k+1)}$。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import norm\nfrom scipy.special import logsumexp\n\ndef solve():\n    \"\"\"\n    Computes the log-likelihood of fluorescence time-series data for a two-state\n    telegraph model of gene expression using a scaled forward algorithm.\n    \"\"\"\n    \n    # Define the 5 test cases from the problem statement.\n    test_cases = [\n        {\n            \"id\": \"A\",\n            \"params\": {\n                \"delta_t\": 1.0,\n                \"k_on\": 0.3, \"k_off\": 0.5,\n                \"mu_off\": 0.2, \"mu_on\": 2.0, \"sigma\": 0.6\n            },\n            \"trace\": [0.15, 0.30, 1.80, 2.10, 1.90, 0.40, 0.20, 2.30, 2.00, 0.50]\n        },\n        {\n            \"id\": \"B\",\n            \"params\": {\n                \"delta_t\": 0.2,\n                \"k_on\": 1.0, \"k_off\": 1.0,\n                \"mu_off\": 0.0, \"mu_on\": 1.0, \"sigma\": 0.5\n            },\n            \"trace\": [0.10]\n        },\n        {\n            \"id\": \"C\",\n            \"params\": {\n                \"delta_t\": 0.5,\n                \"k_on\": 3.0, \"k_off\": 4.0,\n                \"mu_off\": 0.0, \"mu_on\": 3.0, \"sigma\": 0.8\n            },\n            \"trace\": [0.2, 1.5, 2.8, 0.3, 2.7, 3.2, 0.1, 1.0, 2.5, 3.1, 0.4, 0.7, 2.9, 3.3, 0.2]\n        },\n        {\n            \"id\": \"D\",\n            \"params\": {\n                \"delta_t\": 1.0,\n                \"k_on\": 0.8, \"k_off\": 0.2,\n                \"mu_off\": 0.0, \"mu_on\": 5.0, \"sigma\": 0.1\n            },\n            \"trace\": [5.10, 4.90, 5.00, 0.10, -0.05, 5.20, 5.00, 4.80]\n        },\n        {\n            \"id\": \"E\",\n            \"params\": {\n                \"delta_t\": 1.0,\n                \"k_on\": 0.0, \"k_off\": 1.0,\n                \"mu_off\": 0.0, \"mu_on\": 2.0, \"sigma\": 0.3\n            },\n            \"trace\": [0.05, 0.10, -0.20, 0.30]\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        p = case[\"params\"]\n        k_on, k_off = p[\"k_on\"], p[\"k_off\"]\n        delta_t = p[\"delta_t\"]\n        mu_off, mu_on, sigma = p[\"mu_off\"], p[\"mu_on\"], p[\"sigma\"]\n        fluorescence_trace = np.array(case[\"trace\"])\n        T = len(fluorescence_trace)\n        \n        # 1. Calculate stationary distribution (initial probabilities)\n        k_sum = k_on + k_off\n        if k_sum > 0:\n            pi_off = k_off / k_sum\n            pi_on = k_on / k_sum\n        else: # Case where both rates are 0\n            # For this problem, we can assume k_on=0 implies pi_on=0, pi_off=1\n            pi_off = 1.0 if k_on == 0 else 0.0\n            pi_on = 1.0 - pi_off\n        \n        log_pi = np.array([np.log(pi_off) if pi_off > 0 else -np.inf, \n                           np.log(pi_on) if pi_on > 0 else -np.inf])\n        \n        # 2. Calculate discrete-time transition matrix P(delta_t)\n        P = np.zeros((2, 2))\n        if k_sum > 0:\n            exp_term = np.exp(-k_sum * delta_t)\n            P[0, 0] = (k_off + k_on * exp_term) / k_sum\n            P[0, 1] = (k_on - k_on * exp_term) / k_sum\n            P[1, 0] = (k_off - k_off * exp_term) / k_sum\n            P[1, 1] = (k_on + k_off * exp_term) / k_sum\n        else: # If rates are 0, no transitions occur\n            P = np.identity(2)\n        \n        log_P = np.log(P, where=P>0)\n        log_P[P==0] = -np.inf\n\n        # 3. Implement scaled forward algorithm in log-space\n        \n        # Emission probabilities for all observations\n        log_em_probs = np.array([\n            norm.logpdf(fluorescence_trace, loc=mu_off, scale=sigma),\n            norm.logpdf(fluorescence_trace, loc=mu_on, scale=sigma)\n        ])\n\n        # Initialization (t=1)\n        log_alpha_unscaled_1 = log_pi + log_em_probs[:, 0]\n        log_c1 = logsumexp(log_alpha_unscaled_1)\n        log_alpha_hat = log_alpha_unscaled_1 - log_c1\n        total_log_likelihood = log_c1\n        \n        # Recursion (t=2 to T)\n        for t in range(1, T):\n            # Propagate forward: log(alpha_hat_{t-1} @ P)\n            # We use logsumexp for the matrix multiplication in log space\n            log_propagated_0 = logsumexp(log_alpha_hat + log_P[:, 0])\n            log_propagated_1 = logsumexp(log_alpha_hat + log_P[:, 1])\n            \n            # log(unscaled alpha_t)\n            log_alpha_unscaled_t = np.array([log_propagated_0, log_propagated_1]) + log_em_probs[:, t]\n            \n            # log(scaling factor c_t)\n            log_ct = logsumexp(log_alpha_unscaled_t)\n            \n            # update log(alpha_hat_t)\n            log_alpha_hat = log_alpha_unscaled_t - log_ct\n            \n            total_log_likelihood += log_ct\n            \n        results.append(round(total_log_likelihood, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2677710"}]}