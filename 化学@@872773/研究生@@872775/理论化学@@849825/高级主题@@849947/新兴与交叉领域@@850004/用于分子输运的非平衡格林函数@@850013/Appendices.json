{"hands_on_practices": [{"introduction": "我们从NEGF形式主义中最基础的模型——单能级分子结开始。这项练习将引导你通过推导耦合系统的格林函数来计算其局域态密度(LDOS)，从而掌握NEGF的核心对象。通过在宽带近似(WBL)下求解该模型，你将亲身体会到电极耦合如何将一个孤立的分子能级展宽为一个洛伦兹型的共振峰。", "problem": "考虑一个无自旋、无相互作用的分子结，其模型为一个在位能为 $\\varepsilon_{0}$ 的单电子能级，在宽带极限 (WBL) 下耦合到两个金属电极。在非平衡格林函数 (NEGF) 形式理论中，将推迟格林函数记为 $G^{r}(E)$，由左右电极引起的推迟自能分别记为 $\\Sigma^{r}_{L}(E)$ 和 $\\Sigma^{r}_{R}(E)$。在宽带极限下，自能的实部可以忽略，虚部与能量无关，因此对于 $\\alpha \\in \\{L,R\\}$，有 $\\Sigma^{r}_{\\alpha}(E) = - \\mathrm{i}\\,\\Gamma_{\\alpha}/2$，其中 $\\Gamma_{\\alpha}  0$ 为常数。定义总能级展宽为 $\\Gamma \\equiv \\Gamma_{L} + \\Gamma_{R}$。能级上的局域态密度 (LDOS) 定义为 $\\rho(E) \\equiv -\\frac{1}{\\pi}\\,\\mathrm{Im}\\,G^{r}(E)$。\n\n仅使用基本定义和广为接受的结果作为出发点（例如，推迟格林函数的定义及其戴森方程，以及上述的局域态密度定义），执行以下操作：\n\n- 在所述的宽带极限假设下，推导此单能级系统的 $G^{r}(E)$，用 $E$、$\\varepsilon_{0}$ 和 $\\Gamma$ 表示。\n- 根据局域态密度的定义，计算 $\\rho(E)$ 的闭合形式解析表达式。\n- 通过计算 $\\int_{-\\infty}^{\\infty} \\rho(E)\\,\\mathrm{d}E$ 来显式验证局域态密度求和规则，并证明其结果等于 1。\n\n将你的最终答案表示为 $\\rho(E)$ 的单个闭合形式表达式。不需要进行数值计算或四舍五入。", "solution": "所述问题在科学上是合理的、提法恰当的、客观的，并且包含了进行严格求解所需的所有必要信息。它是分子电子学领域的一个标准模型，其求解需要应用非平衡格林函数 (NEGF) 形式理论的基本原理。我们将着手进行推导。\n\n出发点是推迟格林函数 $G^{r}(E)$ 的戴森方程，它将完整系统的格林函数与未耦合分子区域的格林函数 $g^{r}(E)$ 以及描述与电极耦合的自能 $\\Sigma^{r}(E)$ 联系起来。该方程为\n$$[G^{r}(E)]^{-1} = [g^{r}(E)]^{-1} - \\Sigma^{r}(E)$$\n对于指定的系统，未耦合的分子区域由一个能量为 $\\varepsilon_{0}$ 的单电子能级组成。其哈密顿量是一个标量 $H_{M} = \\varepsilon_{0}$。这个未耦合系统的推迟格林函数由下式给出\n$$g^{r}(E) = (E - \\varepsilon_{0} + i\\eta)^{-1}$$\n其中 $\\eta$ 是一个正的无穷小量，确保了正确的解析性质。因此，其逆为\n$$[g^{r}(E)]^{-1} = E - \\varepsilon_{0} + i\\eta$$\n总自能 $\\Sigma^{r}(E)$ 是来自左 ($L$) 和右 ($R$) 电极贡献的总和：\n$$\\Sigma^{r}(E) = \\Sigma^{r}_{L}(E) + \\Sigma^{r}_{R}(E)$$\n问题指定了宽带极限 (WBL) 近似，其中自能由 $\\Sigma^{r}_{\\alpha}(E) = - \\mathrm{i}\\,\\Gamma_{\\alpha}/2$ 给出，对于 $\\alpha \\in \\{L,R\\}$。因此，总自能与能量无关：\n$$\\Sigma^{r}(E) = - \\frac{\\mathrm{i}\\,\\Gamma_{L}}{2} - \\frac{\\mathrm{i}\\,\\Gamma_{R}}{2} = - \\frac{\\mathrm{i}}{2}(\\Gamma_{L} + \\Gamma_{R})$$\n使用所给出的总能级展宽定义 $\\Gamma \\equiv \\Gamma_{L} + \\Gamma_{R}$，我们得到\n$$\\Sigma^{r}(E) = - \\frac{\\mathrm{i}\\,\\Gamma}{2}$$\n将 $[g^{r}(E)]^{-1}$ 和 $\\Sigma^{r}(E)$ 代入戴森方程，得到\n$$[G^{r}(E)]^{-1} = (E - \\varepsilon_{0} + i\\eta) - \\left(- \\frac{\\mathrm{i}\\,\\Gamma}{2}\\right) = E - \\varepsilon_{0} + \\mathrm{i}\\left(\\eta + \\frac{\\Gamma}{2}\\right)$$\n由于 $\\Gamma  0$，有限项 $\\Gamma/2$ 比无穷小项 $\\eta$ 占主导地位。因此我们可以忽略 $\\eta$ 得到\n$$[G^{r}(E)]^{-1} = E - \\varepsilon_{0} + \\frac{\\mathrm{i}\\,\\Gamma}{2}$$\n对该表达式求逆，得到耦合单能级系统的推迟格林函数，这完成了第一个任务：\n$$G^{r}(E) = \\frac{1}{E - \\varepsilon_{0} + \\mathrm{i}\\,\\frac{\\Gamma}{2}}$$\n接下来，我们使用局域态密度 (LDOS) $\\rho(E)$ 的定义来计算它：\n$$\\rho(E) \\equiv -\\frac{1}{\\pi}\\,\\mathrm{Im}\\,G^{r}(E)$$\n为求 $G^{r}(E)$ 的虚部，我们将分子和分母同乘以分母的复共轭：\n$$G^{r}(E) = \\frac{1}{E - \\varepsilon_{0} + \\mathrm{i}\\,\\frac{\\Gamma}{2}} \\times \\frac{E - \\varepsilon_{0} - \\mathrm{i}\\,\\frac{\\Gamma}{2}}{E - \\varepsilon_{0} - \\mathrm{i}\\,\\frac{\\Gamma}{2}} = \\frac{E - \\varepsilon_{0} - \\mathrm{i}\\,\\frac{\\Gamma}{2}}{(E - \\varepsilon_{0})^{2} + \\left(\\frac{\\Gamma}{2}\\right)^{2}}$$\n$G^{r}(E)$ 的虚部是\n$$\\mathrm{Im}\\,G^{r}(E) = \\frac{-\\frac{\\Gamma}{2}}{(E - \\varepsilon_{0})^{2} + \\left(\\frac{\\Gamma}{2}\\right)^{2}}$$\n将此结果代入 $\\rho(E)$ 的定义，得到闭合形式的表达式，完成第二个任务：\n$$\\rho(E) = -\\frac{1}{\\pi} \\left( \\frac{-\\frac{\\Gamma}{2}}{(E - \\varepsilon_{0})^{2} + \\left(\\frac{\\Gamma}{2}\\right)^{2}} \\right) = \\frac{1}{\\pi} \\frac{\\frac{\\Gamma}{2}}{(E - \\varepsilon_{0})^{2} + \\left(\\frac{\\Gamma}{2}\\right)^{2}}$$\n这是一个以 $E=\\varepsilon_{0}$ 为中心、半峰半宽 (HWHM) 为 $\\Gamma/2$ 的洛伦兹分布。\n\n最后，我们通过计算积分 $\\int_{-\\infty}^{\\infty} \\rho(E)\\,\\mathrm{d}E$ 来显式验证局域态密度求和规则。\n$$\\int_{-\\infty}^{\\infty} \\rho(E)\\,\\mathrm{d}E = \\int_{-\\infty}^{\\infty} \\frac{1}{\\pi} \\frac{\\frac{\\Gamma}{2}}{(E - \\varepsilon_{0})^{2} + \\left(\\frac{\\Gamma}{2}\\right)^{2}} \\,\\mathrm{d}E$$\n我们进行变量替换。令 $u = E - \\varepsilon_{0}$，这意味着 $\\mathrm{d}u = \\mathrm{d}E$。积分限保持不变。\n$$\\int_{-\\infty}^{\\infty} \\rho(E)\\,\\mathrm{d}E = \\frac{1}{\\pi} \\int_{-\\infty}^{\\infty} \\frac{\\frac{\\Gamma}{2}}{u^{2} + \\left(\\frac{\\Gamma}{2}\\right)^{2}} \\,\\mathrm{d}u$$\n令 $a = \\Gamma/2$。积分变为\n$$\\frac{a}{\\pi} \\int_{-\\infty}^{\\infty} \\frac{1}{u^{2} + a^{2}} \\,\\mathrm{d}u$$\n标准的反导数是 $\\int \\frac{1}{u^{2} + a^{2}} \\,\\mathrm{d}u = \\frac{1}{a} \\arctan\\left(\\frac{u}{a}\\right)$。计算该定积分：\n$$\\frac{a}{\\pi} \\left[ \\frac{1}{a} \\arctan\\left(\\frac{u}{a}\\right) \\right]_{-\\infty}^{\\infty} = \\frac{1}{\\pi} \\left[ \\arctan\\left(\\frac{u}{a}\\right) \\right]_{-\\infty}^{\\infty}$$\n取极限，我们有\n$$\\frac{1}{\\pi} \\left( \\lim_{u \\to \\infty} \\arctan\\left(\\frac{u}{a}\\right) - \\lim_{u \\to -\\infty} \\arctan\\left(\\frac{u}{a}\\right) \\right) = \\frac{1}{\\pi} \\left( \\frac{\\pi}{2} - \\left(-\\frac{\\pi}{2}\\right) \\right) = \\frac{1}{\\pi} (\\pi) = 1$$\n求和规则得到验证，这证实了在所有能量上找到电子的总概率归一化为 $1$，这对于单态系统是符合预期的。问题的所有部分现已解决。", "answer": "$$\\boxed{\\frac{1}{\\pi} \\frac{\\frac{\\Gamma}{2}}{(E - \\varepsilon_{0})^{2} + \\left(\\frac{\\Gamma}{2}\\right)^{2}}}$$", "id": "2790634"}, {"introduction": "在掌握了单能级模型后，我们将转向一个更接近真实分子的双中心体系，从而将NEGF方法从标量推广到矩阵形式。这项实践的核心任务是推导系统的能量分辨透射函数$T(E)$，它直接关联着分子结的电导。通过这个过程，你不仅能熟练运用矩阵格林函数，还能深入理解接触点的不对称性如何影响量子隧穿效率。", "problem": "考虑一个相干分子结，该分子结在非平衡格林函数（NEGF）框架内被建模为一个与两个金属电极耦合的$2$位点紧束缚器件。在位点基 $\\{|1\\rangle,|2\\rangle\\}$ 下，器件哈密顿量为\n$$\nH_{d}=\\begin{pmatrix}\n\\varepsilon_{1}  t_{c} \\\\\nt_{c}  \\varepsilon_{2}\n\\end{pmatrix},\n$$\n其中位点间跃迁 $t_{c}0$ 为实数。左电极仅与位点 $\\lvert 1\\rangle$ 耦合，能级展宽参数为 $\\Gamma_{L}$；右电极仅与位点 $\\lvert 2\\rangle$ 耦合，能级展宽参数为 $\\Gamma_{R}$。假设两个电极均处于宽带极限（WBL），其能级展宽与能量无关，且兰姆位移为零（即自能的实部为零）。\n\n从 NEGF 框架内推迟格林函数和兰道尔形式的基本定义出发（不要假定超出这些基础的任何预先推导的专门公式），完成以下任务：\n\n$1.$ 分别写出左电极和右电极的推迟自能矩阵 $\\Sigma^{r}_{L}$ 和 $\\Sigma^{r}_{R}$，其形式为与所述耦合和 WBL 一致的 $2\\times 2$ 矩阵。\n\n$2.$ 使用这些自能和推迟格林函数 $G^{r}(E)$ 的定义，推导 $2$位点器件的精确能量分辨透射 $T(E)$ 的闭合解析形式。\n\n$3.$ 将您的结果特化到共振二聚体情况，即 $\\varepsilon_{1}=\\varepsilon_{2}=0$ 且 $t_{c}$ 为实数，并将 $T(E)$ 简化为仅含 $E$、$\\Gamma_{L}$、$\\Gamma_{R}$ 和 $t_{c}$ 的单一闭合表达式。\n\n在您的推导中，明确指出接触非对称性（即 $\\Gamma_{L}\\neq \\Gamma_{R}$）在何处以及如何进入结果，并评论其在所述假设下对 $T(E)$ 的定性影响。对于最终答案，仅报告第 $3$ 部分中 $T(E)$ 的简化表达式。透射是无量纲的；不需要单位。不需要数值计算，也不需要四舍五入。请仅提供解析表达式作为您的最终答案。", "solution": "所述问题在用于分子输运的非平衡格林函数既定框架内是科学上合理、自洽且适定的。它呈现了一个标准的、可解的模型。因此，我们可以进行推导。\n\n任务是推导一个$2$位点分子器件的透射函数 $T(E)$。我们从 NEGF 形式中推迟格林函数 $G^{r}(E)$ 和透射的兰道尔公式的基本定义开始。\n\n器件区域的推迟格林函数由戴森方程给出：\n$$\nG^{r}(E) = [ (E+i\\eta)I - H_{d} - \\Sigma^{r}(E) ]^{-1}\n$$\n其中 $\\eta$ 是一个正无穷小量，$I$ 是 $2 \\times 2$ 单位矩阵，$H_{d}$ 是器件哈密顿量，而 $\\Sigma^{r}(E)$ 是由与电极耦合引起的总推迟自能。总自能是来自左（$L$）电极和右（$R$）电极贡献的总和：$\\Sigma^{r}(E) = \\Sigma^{r}_{L}(E) + \\Sigma^{r}_{R}(E)$。\n\n从左电极到右电极的透射概率由兰道尔公式给出，在 NEGF 的背景下，它通过 Caroli 公式表示：\n$$\nT(E) = \\text{Tr}[\\Gamma_{L}(E) G^{r}(E) \\Gamma_{R}(E) G^{a}(E)]\n$$\n其中 $G^{a}(E) = [G^{r}(E)]^{\\dagger}$ 是超前格林函数，$\\Gamma_{\\alpha}(E)$ 是电极的能级展宽矩阵，定义为 $\\Gamma_{\\alpha}(E) = i[\\Sigma^{r}_{\\alpha}(E) - \\Sigma^{a}_{\\alpha}(E)]$。\n\n第 $1$ 部分：推迟自能\n电极 $\\alpha$ 的推迟自能可以写成 $\\Sigma^{r}_{\\alpha}(E) = \\Lambda_{\\alpha}(E) - \\frac{i}{2}\\Gamma_{\\alpha}(E)$，其中 $\\Lambda_{\\alpha}(E)$ 是兰姆位移（实部），$\\Gamma_{\\alpha}(E)$ 是能级展宽矩阵（与虚部相关）。问题指定了宽带极限（WBL），这有两个推论：\n$1$. 兰姆位移为零：$\\Lambda_{\\alpha}(E) = 0$。\n$2$. 能级展宽矩阵 $\\Gamma_{\\alpha}(E)$ 与能量 $E$ 无关。\n\n因此，$\\Sigma^{r}_{\\alpha} = -\\frac{i}{2}\\Gamma_{\\alpha}$。矩阵 $\\Gamma_{\\alpha}$ 的元素 $(\\Gamma_{\\alpha})_{ij}$ 取决于器件位点 $i,j$ 和电极 $\\alpha$ 之间的耦合强度。\n给定左电极（$L$）仅与位点 $|1\\rangle$ 耦合。这意味着能级展宽矩阵 $\\Gamma_{L}$ 的唯一非零元素位于 $(1,1)$ 位置。其值为给定的参数 $\\Gamma_{L}$。\n类似地，右电极（$R$）仅与位点 $|2\\rangle$ 耦合，所以 $\\Gamma_{R}$ 的唯一非零元素是 $(\\Gamma_{R})_{22} = \\Gamma_{R}$。\n在位点基 $\\{|1\\rangle, |2\\rangle\\}$ 中将它们写成 $2 \\times 2$ 矩阵：\n$$\n\\Gamma_{L} = \\begin{pmatrix} \\Gamma_{L}  0 \\\\ 0  0 \\end{pmatrix}, \\quad \\Gamma_{R} = \\begin{pmatrix} 0  0 \\\\ 0  \\Gamma_{R} \\end{pmatrix}\n$$\n因此，推迟自能矩阵为：\n$$\n\\Sigma^{r}_{L} = -\\frac{i}{2}\\Gamma_{L} = \\begin{pmatrix} -i\\Gamma_{L}/2  0 \\\\ 0  0 \\end{pmatrix}\n$$\n$$\n\\Sigma^{r}_{R} = -\\frac{i}{2}\\Gamma_{R} = \\begin{pmatrix} 0  0 \\\\ 0  -i\\Gamma_{R}/2 \\end{pmatrix}\n$$\n总推迟自能是它们的和：\n$$\n\\Sigma^{r} = \\Sigma^{r}_{L} + \\Sigma^{r}_{R} = \\begin{pmatrix} -i\\Gamma_{L}/2  0 \\\\ 0  -i\\Gamma_{R}/2 \\end{pmatrix}\n$$\n\n第 $2$ 部分：透射函数 $T(E)$ 的推导\n我们首先计算推迟格林函数 $G^{r}(E)$。需要求逆的矩阵是：\n$$\n[G^{r}(E)]^{-1} = EI - H_{d} - \\Sigma^{r} = E\\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} - \\begin{pmatrix} \\varepsilon_{1}  t_{c} \\\\ t_{c}  \\varepsilon_{2} \\end{pmatrix} - \\begin{pmatrix} -i\\Gamma_{L}/2  0 \\\\ 0  -i\\Gamma_{R}/2 \\end{pmatrix}\n$$\n$$\n[G^{r}(E)]^{-1} = \\begin{pmatrix} E - \\varepsilon_{1} + i\\Gamma_{L}/2  -t_{c} \\\\ -t_{c}  E - \\varepsilon_{2} + i\\Gamma_{R}/2 \\end{pmatrix}\n$$\n该矩阵的行列式是：\n$$\n\\det([G^{r}(E)]^{-1}) = (E - \\varepsilon_{1} + i\\Gamma_{L}/2)(E - \\varepsilon_{2} + i\\Gamma_{R}/2) - t_{c}^{2}\n$$\n格林函数是其逆矩阵：\n$$\nG^{r}(E) = \\frac{1}{\\det([G^{r}(E)]^{-1})} \\begin{pmatrix} E - \\varepsilon_{2} + i\\Gamma_{R}/2  t_{c} \\\\ t_{c}  E - \\varepsilon_{1} + i\\Gamma_{L}/2 \\end{pmatrix}\n$$\n现在我们计算 $T(E) = \\text{Tr}[\\Gamma_{L} G^{r} \\Gamma_{R} G^{a}]$。因为电极耦合矩阵 $\\Gamma_{L}$ 和 $\\Gamma_{R}$ 是对角矩阵，并且分别耦合到不同的位点（$1$ 和 $2$），所以迹会简化。让我们明确地展示这一点。求和遍历索引 $i,j,k,l$：\n$T(E) = \\sum_{i,j,k,l} (\\Gamma_{L})_{ij} (G^{r})_{jk} (\\Gamma_{R})_{kl} (G^{a})_{li}$。\n当 $(\\Gamma_{L})_{ij} = \\delta_{i1}\\delta_{j1}\\Gamma_{L}$ 且 $(\\Gamma_{R})_{kl} = \\delta_{k2}\\delta_{l2}\\Gamma_{R}$ 时，表达式变为：\n$$\nT(E) = \\Gamma_{L}\\Gamma_{R} (G^{r})_{12} (G^{a})_{21}\n$$\n由于 $G^{a} = (G^{r})^{\\dagger}$，我们有 $(G^{a})_{21} = (G^{r}_{12})^{*}$。因此，\n$$\nT(E) = \\Gamma_{L}\\Gamma_{R} |G^{r}_{12}(E)|^{2}\n$$\n从我们对 $G^{r}(E)$ 的表达式中，所需的元素是 $G^{r}_{12}(E) = \\frac{t_{c}}{\\det([G^{r}(E)]^{-1})}$。\n将此代入 $T(E)$ 的表达式中，得到一般结果：\n$$\nT(E) = \\Gamma_{L}\\Gamma_{R} \\left| \\frac{t_{c}}{(E - \\varepsilon_{1} + i\\Gamma_{L}/2)(E - \\varepsilon_{2} + i\\Gamma_{R}/2) - t_{c}^{2}} \\right|^{2}\n$$\n$$\nT(E) = \\frac{\\Gamma_{L}\\Gamma_{R}t_{c}^{2}}{|(E - \\varepsilon_{1} + i\\Gamma_{L}/2)(E - \\varepsilon_{2} + i\\Gamma_{R}/2) - t_{c}^{2}|^{2}}\n$$\n这就是一般 $2$位点模型的能量分辨透射的闭合解析形式。\n\n第 $3$ 部分：共振二聚体特例\n现在，我们按照共振二聚体情况的要求，将在位能量设为零，即 $\\varepsilon_{1} = \\varepsilon_{2} = 0$。模内的分母项变为：\n$$\nD(E) = (E + i\\Gamma_{L}/2)(E + i\\Gamma_{R}/2) - t_{c}^{2}\n$$\n$$\nD(E) = E^{2} + iE\\frac{\\Gamma_{L}+\\Gamma_{R}}{2} - \\frac{\\Gamma_{L}\\Gamma_{R}}{4} - t_{c}^{2}\n$$\n将实部和虚部分组：\n$$\nD(E) = \\left( E^{2} - t_{c}^{2} - \\frac{\\Gamma_{L}\\Gamma_{R}}{4} \\right) + i \\left( \\frac{E(\\Gamma_{L}+\\Gamma_{R})}{2} \\right)\n$$\n模的平方为 $|D(E)|^{2} = (\\text{Re}[D])^{2} + (\\text{Im}[D])^{2}$：\n$$\n|D(E)|^{2} = \\left( E^{2} - t_{c}^{2} - \\frac{\\Gamma_{L}\\Gamma_{R}}{4} \\right)^{2} + \\left( \\frac{E(\\Gamma_{L}+\\Gamma_{R})}{2} \\right)^{2}\n$$\n将此代入我们对 $T(E)$ 的表达式中，我们得到最终的简化形式：\n$$\nT(E) = \\frac{\\Gamma_{L} \\Gamma_{R} t_{c}^{2}}{\\left( E^{2} - t_{c}^{2} - \\frac{\\Gamma_{L} \\Gamma_{R}}{4} \\right)^{2} + \\frac{E^{2}(\\Gamma_{L} + \\Gamma_{R})^{2}}{4}}\n$$\n这就是共振二聚体所需的结果。\n\n最后，我们评论接触非对称性（$\\Gamma_{L} \\neq \\Gamma_{R}$）的影响。非对称性同时出现在 $T(E)$ 表达式的分子（作为乘积 $\\Gamma_{L}\\Gamma_{R}$）和分母中。通过检查透射峰值可以得到一个关键的见解。分母是两个平方项之和，总是非负的。对于给定的总耦合强度 $\\Gamma_{tot} = \\Gamma_{L} + \\Gamma_{R}$，当耦合对称时，即 $\\Gamma_{L} = \\Gamma_{R} = \\Gamma_{tot}/2$ 时，分子 $\\Gamma_{L}\\Gamma_{R}$ 达到最大值。在保持总耦合固定的情况下，任何偏离这种对称性（非对称性）的行为都会减小分子的值。更详细的分析表明，前置因子 $\\frac{4\\Gamma_{L}\\Gamma_{R}}{(\\Gamma_{L}+\\Gamma_{R})^{2}}$ 决定了可能的最大峰高，该因子仅在对称耦合时为1，否则小于1。因此，接触非对称性起到了电极和器件之间阻抗失配的作用，与具有相同总展宽的对称耦合结相比，它抑制了总透射幅度。", "answer": "$$\n\\boxed{\\frac{\\Gamma_{L} \\Gamma_{R} t_{c}^{2}}{\\left( E^{2} - t_{c}^{2} - \\frac{\\Gamma_{L} \\Gamma_{R}}{4} \\right)^{2} + \\frac{E^{2}(\\Gamma_{L} + \\Gamma_{R})^{2}}{4}}}\n$$", "id": "2790684"}, {"introduction": "这项综合性练习旨在连接理论推导与计算实践，是检验你对NEGF应用理解的试金石。你将首先从基本原理出发，证明稳态下的电流守恒定律，然后通过编程来计算流经两端的电流，并考察数值误差的来源。该练习超越了宽带近似，引入了能量依赖的耦合函数，让你体验如何对更符合物理实际的系统进行建模与分析。", "problem": "考虑一个相干双端分子结，其模型为单个分子轨道耦合到两个电极。该器件在非平衡格林函数（NEGF）框架内进行研究。分子轨道的在位能为 $ \\varepsilon_0 $，并通过能量依赖的耦合（能级展宽）函数 $ \\Gamma_L(E) $ 和 $ \\Gamma_R(E) $ 与左右电极耦合。假设系统处于稳态和相干输运状态，并以连续性方程 $ d\\langle \\hat{N} \\rangle/dt = 0 $ 作为基本出发点，同时使用推迟格林函数 $ G^r(E) $ 和耦合函数 $ \\Gamma_{\\alpha}(E) $（电极索引 $ \\alpha \\in \\{L,R\\} $）的定义。采用标准假设，即推迟自能的实部为零，$ \\Sigma^r_{\\alpha}(E) = -\\tfrac{i}{2}\\Gamma_{\\alpha}(E) $，从而保证 $ G^r(E) $ 的因果性，且 $ G^a(E) = [G^r(E)]^{\\dagger} $，谱函数 $ A(E) = i\\left(G^r(E) - G^a(E)\\right) $ 满足 $ A(E) = |G^r(E)|^2 \\left[\\Gamma_L(E) + \\Gamma_R(E)\\right] $。电极由温度为 $ T $ 的费米-狄拉克分布 $ f_{\\alpha}(E) = \\left[1 + \\exp\\left(\\tfrac{E - \\mu_{\\alpha}}{k_B T}\\right)\\right]^{-1} $ 表征，其电化学势 $ \\mu_L $ 和 $ \\mu_R $ 由对称施加的偏压 $ V $ 设定，即 $ \\mu_L = E_F + \\tfrac{e V}{2} $ 和 $ \\mu_R = E_F - \\tfrac{e V}{2} $，其中 $ E_F $ 是参考费米能。这里，$ e $ 是基本电荷，$ h $ 是普朗克常数，$ k_B $ 是玻尔兹曼常数。\n\n从这些基本定义和守恒原理出发，推导用器件格林函数和耦合表示的双端电流表达式，并从第一性原理证明稳态电流满足 $ I_L + I_R = 0 $。然后，使用推导出的表达式，在有限能量格点上进行数值验证。您必须：\n\n- 将 $ \\Gamma_L(E) $ 和 $ \\Gamma_R(E) $ 定义为能量的光滑正函数。为便于测试，请使用以下明确的选择（添加背景项以避免耦合消失）：\n  - $ \\Gamma_L(E) $ 为高斯函数：$ \\Gamma_L(E) = \\Gamma_{L,0} \\exp\\!\\left(-\\dfrac{(E - E_{L,c})^2}{2 \\sigma_L^2}\\right) + \\Gamma_{L,\\mathrm{bg}} $。\n  - $ \\Gamma_R(E) $ 为洛伦兹函数：$ \\Gamma_R(E) = \\Gamma_{R,0} \\dfrac{(\\gamma_R/2)^2}{(E - E_{R,c})^2 + (\\gamma_R/2)^2} + \\Gamma_{R,\\mathrm{bg}} $。\n- 使用单能级器件格林函数 $ G^r(E) $ 以及由谱结构和耦合定义的相应透射率。工作能量格点必须是有限的：$ E \\in [E_{\\min}, E_{\\max}] $，格点数量为指定的 $ N $。\n- 使用数值积分在指定的有限能量格点上数值计算 $ I_L $ 和 $ I_R $。为揭示数值不守恒的来源，请按照下文测试套件中的规定，使用一种积分法则计算 $ I_L $，并使用相同或不同的积分法则计算 $ I_R $。\n- 报告每个测试用例的残差 $ I_L + I_R $。每个电流以安培为单位，因此残差也必须以安培为单位报告。所有输入能量均以电子伏特为单位指定，内部必须转换为焦耳；温度单位为开尔文；电压单位为伏特。不涉及角度。最终的数值输出必须是实数，单位为安培。\n\n测试套件。实现以下参数集。每个测试用例定义：\n- 器件和热力学参数：$ \\varepsilon_0 $（电子伏特），$ E_F $（电子伏特），$ T $（开尔文），$ V $（伏特）。\n- $ \\Gamma_L(E) $（高斯函数）的耦合参数：$ \\Gamma_{L,0} $（电子伏特），$ E_{L,c} $（电子伏特），$ \\sigma_L $（电子伏特），$ \\Gamma_{L,\\mathrm{bg}} $（电子伏特）。\n- $ \\Gamma_R(E) $（洛伦兹函数）的耦合参数：$ \\Gamma_{R,0} $（电子伏特），$ E_{R,c} $（电子伏特），$ \\gamma_R $（电子伏特），$ \\Gamma_{R,\\mathrm{bg}} $（电子伏特）。\n- 能量窗口和格点：$ E_{\\min} $（电子伏特），$ E_{\\max} $（电子伏特），$ N $（整型格点数）。\n- 用于 $ I_L $ 和 $ I_R $ 的积分法则，从梯形法则或中点法则中选择。中点法则应在由格点确定的等间距单元中点处计算被积函数。\n\n提供并使用以下五个测试用例：\n- 用例 $ 1 $（密集格点，一致积分法则）：$ \\varepsilon_0 = 0.1 $，$ E_F = 0.0 $，$ T = 300 $，$ V = 0.1 $；$ \\Gamma_{L,0} = 0.2 $，$ E_{L,c} = 0.0 $，$ \\sigma_L = 0.5 $，$ \\Gamma_{L,\\mathrm{bg}} = 0.02 $；$ \\Gamma_{R,0} = 0.15 $，$ E_{R,c} = 0.05 $，$ \\gamma_R = 0.3 $，$ \\Gamma_{R,\\mathrm{bg}} = 0.02 $；$ E_{\\min} = -5.0 $，$ E_{\\max} = 5.0 $，$ N = 20001 $；对 $ I_L $ 和 $ I_R $ 均使用梯形法则。\n- 用例 $ 2 $（密集格点，不一致积分法则）：$ \\varepsilon_0 = -0.2 $，$ E_F = 0.0 $，$ T = 300 $，$ V = 1.0 $；$ \\Gamma_{L,0} = 0.3 $，$ E_{L,c} = -0.1 $，$ \\sigma_L = 0.4 $，$ \\Gamma_{L,\\mathrm{bg}} = 0.01 $；$ \\Gamma_{R,0} = 0.05 $，$ E_{R,c} = 0.2 $，$ \\gamma_R = 0.2 $，$ \\Gamma_{R,\\mathrm{bg}} = 0.01 $；$ E_{\\min} = -6.0 $，$ E_{\\max} = 6.0 $，$ N = 20001 $；对 $ I_L $ 使用梯形法则，对 $ I_R $ 使用中点法则。\n- 用例 $ 3 $（稀疏格点，不一致积分法则）：$ \\varepsilon_0 = 0.0 $，$ E_F = 0.0 $，$ T = 300 $，$ V = 0.2 $；$ \\Gamma_{L,0} = 0.15 $，$ E_{L,c} = 0.0 $，$ \\sigma_L = 0.2 $，$ \\Gamma_{L,\\mathrm{bg}} = 0.005 $；$ \\Gamma_{R,0} = 0.15 $，$ E_{R,c} = 0.0 $，$ \\gamma_R = 0.25 $，$ \\Gamma_{R,\\mathrm{bg}} = 0.005 $；$ E_{\\min} = -2.0 $，$ E_{\\max} = 2.0 $，$ N = 401 $；对 $ I_L $ 使用梯形法则，对 $ I_R $ 使用中点法则。\n- 用例 $ 4 $（截断窗口，不一致积分法则）：$ \\varepsilon_0 = 0.0 $，$ E_F = 0.0 $，$ T = 50 $，$ V = 2.0 $；$ \\Gamma_{L,0} = 0.2 $，$ E_{L,c} = 0.0 $，$ \\sigma_L = 0.3 $，$ \\Gamma_{L,\\mathrm{bg}} = 0.01 $；$ \\Gamma_{R,0} = 0.2 $，$ E_{R,c} = 0.0 $，$ \\gamma_R = 0.3 $，$ \\Gamma_{R,\\mathrm{bg}} = 0.01 $；$ E_{\\min} = -1.0 $，$ E_{\\max} = 1.0 $，$ N = 2001 $；对 $ I_L $ 使用梯形法则，对 $ I_R $ 使用中点法则。\n- 用例 $ 5 $（尖锐费米边，非常密集的格点，一致积分法则）：$ \\varepsilon_0 = 0.05 $，$ E_F = 0.0 $，$ T = 1 $，$ V = 0.05 $；$ \\Gamma_{L,0} = 0.1 $，$ E_{L,c} = 0.0 $，$ \\sigma_L = 0.25 $，$ \\Gamma_{L,\\mathrm{bg}} = 0.005 $；$ \\Gamma_{R,0} = 0.1 $，$ E_{R,c} = 0.0 $，$ \\gamma_R = 0.25 $，$ \\Gamma_{R,\\mathrm{bg}} = 0.005 $；$ E_{\\min} = -2.0 $，$ E_{\\max} = 2.0 $，$ N = 40001 $；对 $ I_L $ 和 $ I_R $ 均使用梯形法则。\n\n实现要求：\n- 您的程序必须在指定的有限格点上计算每个用例的 $ I_L $ 和 $ I_R $，并以安培为单位报告每个用例的残差 $ I_L + I_R $。内部计算时，将所有能量从电子伏特转换为焦耳，并使用单位为库仑的 $ e $、单位为焦耳·秒的 $ h $ 以及单位为焦耳/开尔文的 $ k_B $。\n- 最终输出格式必须是单行，包含一个由方括号括起来的逗号分隔列表，按用例 $ 1 $ 到 $ 5 $ 的顺序排列，例如 $ [r_1,r_2,r_3,r_4,r_5] $，其中每个 $ r_i $ 是一个以安培为单位的浮点数。\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表（例如，$ [r_1,r_2,r_3,r_4,r_5] $）。", "solution": "该问题要求在非平衡格林函数（NEGF）框架内，从第一性原理出发推导双端分子结中的端点电流，并证明电流守恒 $I_L + I_R = 0$。随后，必须通过数值验证来展示这个解析守恒定律如何在数值上被破坏。\n\n### 理论推导\n\n我们从电荷守恒基本原理开始。在稳态下，中心分子区域的总电子数 $ \\langle \\hat{N} \\rangle $ 是恒定的。$ \\langle \\hat{N} \\rangle $ 的时间演化由从每个电极（索引为 $ \\alpha \\in \\{L, R\\} $）流入分子的电流之和决定。因此，连续性方程为：\n$$ \\frac{d\\langle \\hat{N} \\rangle}{dt} = \\frac{1}{e}\\left(I_L + I_R\\right) = 0 $$\n这意味着解析上 $ I_L + I_R = 0 $，其中 $ I_{\\alpha} $ 是从导线 $ \\alpha $流入分子的电流。\n\n为推导 $ I_L $ 和 $ I_R $ 的表达式，我们使用 Meir-Wingreen 公式，它是 NEGF 输运理论的基石，该公式将来自导线 $ \\alpha $ 的电流表示为：\n$$ I_{\\alpha} = \\frac{ie}{\\hbar} \\int \\frac{dE}{2\\pi} \\text{Tr} \\left\\{ \\Gamma_{\\alpha}(E) \\left[ f_{\\alpha}(E) \\left( G^r(E) - G^a(E) \\right) + G^(E) \\right] \\right\\} $$\n对于单能级系统，迹（Tr）变成标量积，并使用 $ h = 2\\pi\\hbar $：\n$$ I_{\\alpha} = \\frac{ie}{h} \\int dE \\, \\Gamma_{\\alpha}(E) \\left[ f_{\\alpha}(E) \\left( G^r(E) - G^a(E) \\right) + G^(E) \\right] $$\n我们需要格林函数的表达式。问题陈述提供了谱函数的关系式 $ A(E) = i\\left(G^r(E) - G^a(E)\\right) $，这意味着 $ G^r(E) - G^a(E) = -iA(E) $。\n\n小于格林函数 $ G^(E) $ 由小于自能 $ \\Sigma^(E) $ 通过 Keldysh 方程确定：\n$$ G^(E) = G^r(E) \\Sigma^(E) G^a(E) $$\n总的小于自能是来自各个导线的贡献之和，$ \\Sigma^(E) = \\Sigma_L^(E) + \\Sigma_R^(E) $。每个贡献由 $ \\Sigma_{\\alpha}^(E) = i f_{\\alpha}(E) \\Gamma_{\\alpha}(E) $ 给出，其中 $ f_{\\alpha}(E) $ 是导线 $ \\alpha $ 的费米-狄拉克分布。对于单能级器件，$ G^r(E)G^a(E) = |G^r(E)|^2 $，所以我们有：\n$$ G^(E) = i |G^r(E)|^2 \\left( f_L(E)\\Gamma_L(E) + f_R(E)\\Gamma_R(E) \\right) $$\n将这些关系代入 $ I_{\\alpha} $ 的 Meir-Wingreen 公式，我们得到：\n$$ I_{\\alpha} = \\frac{ie}{h} \\int dE \\, \\Gamma_{\\alpha}(E) \\left[ f_{\\alpha}(E) (-iA(E)) + i |G^r(E)|^2 \\left( f_L(E)\\Gamma_L(E) + f_R(E)\\Gamma_R(E) \\right) \\right] $$\n$$ I_{\\alpha} = \\frac{e}{h} \\int dE \\, \\Gamma_{\\alpha}(E) \\left[ f_{\\alpha}(E) A(E) - |G^r(E)|^2 \\left( f_L\\Gamma_L + f_R\\Gamma_R \\right) \\right] $$\n这给出了来自每个导线的电流的不同表达式。第一项 $ \\propto f_{\\alpha} A $，表示电子从导线 $ \\alpha $ 隧穿到分子上可用态 $ A(E) $ 的速率。第二项与 $ G^(E)/i $ 成正比，表示电子从已占据的分子态隧穿到导线 $ \\alpha $ 的速率。\n\n让我们将 $ I_L $ 和 $ I_R $ 的被积函数分别表示为 $ \\mathcal{J}_L(E) $ 和 $ \\mathcal{J}_R(E) $：\n$$ \\mathcal{J}_L(E) = \\Gamma_L(E) \\left[ f_L(E) A(E) - |G^r(E)|^2 \\left( f_L\\Gamma_L + f_R\\Gamma_R \\right) \\right] $$\n$$ \\mathcal{J}_R(E) = \\Gamma_R(E) \\left[ f_R(E) A(E) - |G^r(E)|^2 \\left( f_L\\Gamma_L + f_R\\Gamma_R \\right) \\right] $$\n为证明 $ I_L + I_R = 0 $，我们证明它们的被积函数在每个能量 $ E $ 处都相加为零。\n$$ \\mathcal{J}_L(E) + \\mathcal{J}_R(E) = A(E) \\left( f_L\\Gamma_L + f_R\\Gamma_R \\right) - \\left( \\Gamma_L + \\Gamma_R \\right) |G^r(E)|^2 \\left( f_L\\Gamma_L + f_R\\Gamma_R \\right) $$\n使用问题中给出的关系 $ A(E) = |G^r(E)|^2 (\\Gamma_L(E) + \\Gamma_R(E)) = |G^r(E)|^2 \\Gamma_{tot}(E) $，我们将其代入第一项：\n$$ \\mathcal{J}_L(E) + \\mathcal{J}_R(E) = |G^r(E)|^2 \\Gamma_{tot}(E) \\left( f_L\\Gamma_L + f_R\\Gamma_R \\right) - \\Gamma_{tot}(E) |G^r(E)|^2 \\left( f_L\\Gamma_L + f_R\\Gamma_R \\right) = 0 $$\n由于被积函数之和对所有 $ E $ 都恒等于零，积分之和也必定为零：\n$$ I_L + I_R = \\frac{e}{h} \\int dE \\left( \\mathcal{J}_L(E) + \\mathcal{J}_R(E) \\right) = \\int 0 \\, dE = 0 $$\n这就完成了基于所提供第一性原理的解析证明。\n\n### 数值实现\n\n数值任务是通过在有限能量格点上对各自的被积函数 $ \\mathcal{J}_L(E) $ 和 $ \\mathcal{J}_R(E) $ 进行积分来计算 $ I_L $ 和 $ I_R $，并计算残差和 $ I_L + I_R $。\n解析上，$ \\mathcal{J}_L(E) + \\mathcal{J}_R(E) = 0 $。如果我们对两个积分使用相同的线性积分算子 $ Q(\\cdot) $（例如梯形法则），则数值和也将在机器精度内为零，因为线性性意味着 $ Q(\\mathcal{J}_L) + Q(\\mathcal{J}_R) = Q(\\mathcal{J}_L + \\mathcal{J}_R) = Q(0) = 0 $。\n然而，问题指示我们为每个积分使用可能*不同*的积分法则 $ Q_L $ 和 $ Q_R $。在这种情况下，计算出的和是 $ Q_L(\\mathcal{J}_L) + Q_R(\\mathcal{J}_R) $。没有数学保证这个和会是零。由此产生的非零残差是源于两种积分法则不同离散化误差的数值赝像，而不是对物理定律的违反。\n\n实现过程如下：\n1.  **常量和单位**：物理常量（$ e $、$ h $、$ k_B $）在SI单位制中定义。所有以电子伏特（eV）为单位给出的输入参数通过乘以 $ e $ 转换为焦耳（J）。\n2.  **能量格点**：从 $ E_{\\min} $ 到 $ E_{\\max} $ 创建一个具有 $ N $ 个点的均匀能量格点 $ E $。\n3.  **函数**：对于给定的能量格点，我们计算以下数组：\n    -   耦合函数：$ \\Gamma_L(E) $（高斯函数）和 $ \\Gamma_R(E) $（洛伦兹函数）。\n    -   费米-狄拉克分布：$ f_L(E) $ 和 $ f_R(E) $，其化学势为 $ \\mu_L = E_F + eV/2 $ 和 $ \\mu_R = E_F - eV/2 $。\n    -   总展宽：$ \\Gamma_{tot}(E) = \\Gamma_L(E) + \\Gamma_R(E) $。\n    -   单能级 $ \\varepsilon_0 $ 的推迟格林函数：$ G^r(E) = [E - \\varepsilon_0 + i\\Gamma_{tot}(E)/2]^{-1} $。\n    -   谱函数：$ A(E) = |G^r(E)|^2 \\Gamma_{tot}(E) $。\n    -   小于格林函数项：$ G^(E)/i = |G^r(E)|^2 (f_L(E)\\Gamma_L(E) + f_R(E)\\Gamma_R(E)) $。\n4.  **被积函数**：被积函数 $ \\mathcal{J}_L(E) $ 和 $ \\mathcal{J}_R(E) $ 在能量格点上构造为数组。\n5.  **积分**：\n    -   **梯形法则**：使用 `numpy.trapz` 实现，它计算给定格点上函数样本的积分。\n    -   **中点法则**：通过在原始格点之间的中点组成的新格点上计算被积函数，然后将这些值求和并乘以能量步长 $ \\Delta E $ 来实现。\n6.  **电流计算**：通过将指定的积分法则应用于各自的被积函数并乘以预因子 $ e/h $ 来计算电流 $ I_L $ 和 $ I_R $。然后报告残差 $ I_L + I_R $。\n\n对五个测试用例中的每一个重复此过程，这些用例旨在探究格点密度、积分窗口和积分法则的选择如何影响电流的数值守恒性。", "answer": "```python\nimport numpy as np\n\n# Physical constants in SI units\nE_CHARGE = 1.602176634e-19  # Elementary charge in Coulombs\nH_PLANCK = 6.62607015e-34    # Planck's constant in J*s\nKB_BOLTZMANN = 1.380649e-23   # Boltzmann's constant in J/K\n\ndef solve():\n    \"\"\"\n    Main solver function to process test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1: dense grid, consistent quadrature\n        {\n            'params': {'eps0': 0.1, 'ef': 0.0, 'T': 300, 'V': 0.1},\n            'gamma_L': {'G0': 0.2, 'Ec': 0.0, 'sigma': 0.5, 'bg': 0.02},\n            'gamma_R': {'G0': 0.15, 'Ec': 0.05, 'gamma': 0.3, 'bg': 0.02},\n            'grid': {'Emin': -5.0, 'Emax': 5.0, 'N': 20001},\n            'quad': {'L': 'trapezoidal', 'R': 'trapezoidal'}\n        },\n        # Case 2: dense grid, inconsistent quadrature\n        {\n            'params': {'eps0': -0.2, 'ef': 0.0, 'T': 300, 'V': 1.0},\n            'gamma_L': {'G0': 0.3, 'Ec': -0.1, 'sigma': 0.4, 'bg': 0.01},\n            'gamma_R': {'G0': 0.05, 'Ec': 0.2, 'gamma': 0.2, 'bg': 0.01},\n            'grid': {'Emin': -6.0, 'Emax': 6.0, 'N': 20001},\n            'quad': {'L': 'trapezoidal', 'R': 'midpoint'}\n        },\n        # Case 3: coarse grid, inconsistent quadrature\n        {\n            'params': {'eps0': 0.0, 'ef': 0.0, 'T': 300, 'V': 0.2},\n            'gamma_L': {'G0': 0.15, 'Ec': 0.0, 'sigma': 0.2, 'bg': 0.005},\n            'gamma_R': {'G0': 0.15, 'Ec': 0.0, 'gamma': 0.25, 'bg': 0.005},\n            'grid': {'Emin': -2.0, 'Emax': 2.0, 'N': 401},\n            'quad': {'L': 'trapezoidal', 'R': 'midpoint'}\n        },\n        # Case 4: truncated window, inconsistent quadrature\n        {\n            'params': {'eps0': 0.0, 'ef': 0.0, 'T': 50, 'V': 2.0},\n            'gamma_L': {'G0': 0.2, 'Ec': 0.0, 'sigma': 0.3, 'bg': 0.01},\n            'gamma_R': {'G0': 0.2, 'Ec': 0.0, 'gamma': 0.3, 'bg': 0.01},\n            'grid': {'Emin': -1.0, 'Emax': 1.0, 'N': 2001},\n            'quad': {'L': 'trapezoidal', 'R': 'midpoint'}\n        },\n        # Case 5: sharp Fermi edges, very dense grid, consistent quadrature\n        {\n            'params': {'eps0': 0.05, 'ef': 0.0, 'T': 1, 'V': 0.05},\n            'gamma_L': {'G0': 0.1, 'Ec': 0.0, 'sigma': 0.25, 'bg': 0.005},\n            'gamma_R': {'G0': 0.1, 'Ec': 0.0, 'gamma': 0.25, 'bg': 0.005},\n            'grid': {'Emin': -2.0, 'Emax': 2.0, 'N': 40001},\n            'quad': {'L': 'trapezoidal', 'R': 'trapezoidal'}\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        residual = calculate_residual(case)\n        results.append(f\"{residual:.6e}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_residual(case):\n    \"\"\"\n    Calculates the residual current I_L + I_R for a given test case.\n    \"\"\"\n    # Unpack parameters and convert units from eV to Joules\n    p = {k: v * E_CHARGE for k, v in case['params'].items() if k not in ['T']}\n    p['T'] = case['params']['T']\n    \n    gl_p = {k: v * E_CHARGE for k, v in case['gamma_L'].items()}\n    gr_p = {k: v * E_CHARGE for k, v in case['gamma_R'].items()}\n\n    grid_p = {k: v for k, v in case['grid'].items()}\n    grid_p['Emin'] *= E_CHARGE\n    grid_p['Emax'] *= E_CHARGE\n    \n    # Define electrochemical potentials in Joules\n    mu_L = p['ef'] + p['V'] / 2\n    mu_R = p['ef'] - p['V'] / 2\n\n    kBT = KB_BOLTZMANN * p['T']\n\n    # Define energy grid for trapezoidal rule\n    E_grid, dE = np.linspace(grid_p['Emin'], grid_p['Emax'], grid_p['N'], retstep=True)\n    \n    # Define helper functions evaluated on a given energy grid\n    def fermi_dirac(E, mu, kBT):\n        # Add a small epsilon to kBT to avoid division by zero at T=0\n        arg = (E - mu) / (kBT + 1e-40)\n        # Prevent overflow for large positive arguments\n        return np.where(arg  700, 0.0, 1.0 / (1.0 + np.exp(arg)))\n\n    def gamma_L_func(E, p_gl):\n        return p_gl['G0'] * np.exp(-((E - p_gl['Ec'])**2) / (2 * p_gl['sigma']**2)) + p_gl['bg']\n\n    def gamma_R_func(E, p_gr):\n        return p_gr['G0'] * ((p_gr['gamma']/2)**2) / ((E - p_gr['Ec'])**2 + (p_gr['gamma']/2)**2) + p_gr['bg']\n\n    def get_integrands(E, mu_L, mu_R, kBT, p_dev, p_gl, p_gr):\n        gamma_L = gamma_L_func(E, p_gl)\n        gamma_R = gamma_R_func(E, p_gr)\n        gamma_total = gamma_L + gamma_R\n        \n        G_r = 1.0 / (E - p_dev['eps0'] + 0.5j * gamma_total)\n        G_r_sq_mag = np.abs(G_r)**2\n        \n        A = G_r_sq_mag * gamma_total\n        \n        f_L = fermi_dirac(E, mu_L, kBT)\n        f_R = fermi_dirac(E, mu_R, kBT)\n        \n        # G^(E)/i\n        G_less_over_i = G_r_sq_mag * (f_L * gamma_L + f_R * gamma_R)\n        \n        integrand_L = gamma_L * (A * f_L - G_less_over_i)\n        integrand_R = gamma_R * (A * f_R - G_less_over_i)\n        \n        return integrand_L, integrand_R\n\n    # Calculate current I_L\n    if case['quad']['L'] == 'trapezoidal':\n        integrand_L, _ = get_integrands(E_grid, mu_L, mu_R, kBT, p, gl_p, gr_p)\n        integral_L = np.trapz(integrand_L, E_grid)\n    elif case['quad']['L'] == 'midpoint':\n        E_mid = 0.5 * (E_grid[:-1] + E_grid[1:])\n        integrand_L, _ = get_integrands(E_mid, mu_L, mu_R, kBT, p, gl_p, gr_p)\n        integral_L = np.sum(integrand_L) * dE\n    \n    I_L = (E_CHARGE / H_PLANCK) * integral_L\n\n    # Calculate current I_R\n    if case['quad']['R'] == 'trapezoidal':\n        _, integrand_R = get_integrands(E_grid, mu_L, mu_R, kBT, p, gl_p, gr_p)\n        integral_R = np.trapz(integrand_R, E_grid)\n    elif case['quad']['R'] == 'midpoint':\n        E_mid = 0.5 * (E_grid[:-1] + E_grid[1:])\n        _, integrand_R = get_integrands(E_mid, mu_L, mu_R, kBT, p, gl_p, gr_p)\n        integral_R = np.sum(integrand_R) * dE\n\n    I_R = (E_CHARGE / H_PLANCK) * integral_R\n    \n    return I_L + I_R\n\nsolve()\n```", "id": "2790687"}]}