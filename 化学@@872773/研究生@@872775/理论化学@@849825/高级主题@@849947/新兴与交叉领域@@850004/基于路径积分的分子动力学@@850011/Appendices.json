{"hands_on_practices": [{"introduction": "任何路径积分模拟都始于一个关键选择：珠子（bead）的数量 $P$。这个参数直接决定了量子表征的准确性。本练习将指导您估算准确捕捉高频化学键零点能所需的最小珠子数，这是建立可靠 PIMD 模拟的根本第一步。通过这个实践 [@problem_id:2759518]，您将掌握连接宏观温度与微观量子振动的核心准则。", "problem": "一个温度为 $T = 300\\,\\mathrm{K}$ 的氢键分子体系，其最高的相关分子内振动模式为波数 $\\tilde{\\nu}_{\\max} = 3300\\,\\mathrm{cm}^{-1}$ 的O–H伸缩振动。您希望在从头算分子动力学 (ab initio molecular dynamics, AIMD) 框架内，使用路径积分分子动力学 (Path Integral Molecular Dynamics, PIMD) 来包含零点能水平的核量子效应。\n\n从角频率为 $\\omega$ 的谐振子的量子正则配分函数的虚时路径积分表示出发，并使用将其离散化为 $P$ 个时间片的 Trotter 分解，推导出一个关于 Trotter 数 $P$ 的保守条件，该条件需确保环状聚合物表示能够分辨在 $\\tilde{\\nu}_{\\max}$ 处最快振动模式的零点涨落。请用 $P$、$\\beta = 1/(k_{B}T)$ 和 $\\omega_{\\max} = 2\\pi c\\,\\tilde{\\nu}_{\\max}$ 来表示您的条件，并确定在给定的 $T$ 和 $\\tilde{\\nu}_{\\max}$ 下满足该条件的最小整数 $P$。使用恒等式 $\\hbar \\omega = h \\nu = h c \\tilde{\\nu}$ 和转换常数 $k_{B}/(h c) = 0.69503476\\,\\mathrm{cm}^{-1}\\,\\mathrm{K}^{-1}$。\n\n在您的推导中，还需提出一个与您的珠子数相符的从头算分子动力学设置，在 Born–Oppenheimer 分子动力学 (BOMD) 和 Car–Parrinello 分子动力学 (CPMD) 之间做出选择，并根据扩展的 PIMD 动力学中必须分辨的最大频率来估计一个稳定的时间步长。简要说明您为采样量子正则系综所采用的恒温器策略的理由。最终答案只报告所需的珠子数 $P$。最终答案中不要包含单位。最终答案不需要四舍五入到指定的有效数字位数；报告满足您推导出的标准的最小整数 $P$。", "solution": "对问题陈述进行验证。\n\n逐字提取给定条件：\n- 温度: $T = 300\\,\\mathrm{K}$\n- 最高相关分子内振动模式波数: $\\tilde{\\nu}_{\\max} = 3300\\,\\mathrm{cm}^{-1}$\n- 相关方法：从头算分子动力学 (AIMD) 框架内的路径积分分子动力学 (PIMD)。\n- 核心任务：推导 Trotter 数 $P$ 的一个保守条件。\n- 条件中的变量：$P$、$\\beta = 1/(k_{B}T)$ 和 $\\omega_{\\max} = 2\\pi c\\,\\tilde{\\nu}_{\\max}$。\n- 出发点：谐振子量子正则配分函数的虚时路径积分表示及 Trotter 离散化。\n- 恒等式：$\\hbar \\omega = h \\nu = h c \\tilde{\\nu}$。\n- 常数：$k_{B}/(h c) = 0.69503476\\,\\mathrm{cm}^{-1}\\,\\mathrm{K}^{-1}$。\n- 最终数值结果：在给定的 $T$ 和 $\\tilde{\\nu}_{\\max}$ 下，满足所推导条件的最小整数 $P$。\n- 附加任务：提出一个一致的 AIMD 设置 (BOMD vs. CPMD)，估计一个稳定的时间步长，并论证恒温器策略的合理性。\n\n验证结论：\n该问题有效。它在科学上基于量子统计力学和计算化学的既定理论，特别是路径积分分子动力学方法。其前提在事实上是正确的；O–H 伸缩振动的值是标准的，室温是常见的模拟条件。问题提取得当 (well-posed)，为推导条件和计算所要求的值提供了足够的信息。语言客观而精确。问题与*从头算分子动力学*这一主题直接相关。未发现任何缺陷。我们可以继续进行求解。\n\n一个哈密顿量为 $\\hat{H} = \\hat{T} + \\hat{V}$、逆温度为 $\\beta = 1/(k_{B}T)$ 的体系，其量子正则配分函数 $Z$ 为 $Z = \\text{Tr}[\\exp(-\\beta \\hat{H})]$。路径积分公式依赖于玻尔兹曼算符的 Trotter 分解：\n$$\n\\exp(-\\beta \\hat{H}) = \\left[ \\exp\\left(-\\frac{\\beta}{P} \\hat{H}\\right) \\right]^P \\approx \\left[ \\exp\\left(-\\frac{\\beta \\hat{V}}{2P}\\right) \\exp\\left(-\\frac{\\beta \\hat{T}}{P}\\right) \\exp\\left(-\\frac{\\beta \\hat{V}}{2P}\\right) \\right]^P\n$$\n该分解引入了一个误差，只有当指数的自变量 $(\\beta/P)\\hat{H}$ 在某种意义上“很小”时，该误差才可忽略不计。系统的能量尺度由其最高频率模式 $\\omega_{\\max}$ 决定。其特征能量为 $\\hbar \\omega_{\\max}$。因此，为使 Trotter 近似有效，无量纲量 $(\\beta/P) \\hbar \\omega_{\\max}$ 必须远小于 1。这导出了保守条件：\n$$\n\\frac{\\beta \\hbar \\omega_{\\max}}{P} \\le 1 \\implies P \\ge \\beta \\hbar \\omega_{\\max}\n$$\n此条件确保虚时间步长 $\\Delta\\tau = \\hbar\\beta/P$ 小于最快量子振荡的特征时间尺度 $1/\\omega_{\\max}$。满足此标准对于离散化的环状聚合物表示能否准确捕捉量子力学离域效应至关重要，而这种离域效应主要由最高频率模式的零点运动所主导。\n\n我们现在必须使用给定的系统参数，计算满足此条件的最小整数 $P$ 值。所需的量是 $\\beta \\hbar \\omega_{\\max}$。我们可以用所提供的常数来表示它：\n$$\n\\beta \\hbar \\omega_{\\max} = \\frac{1}{k_B T} \\cdot \\hbar \\cdot (2\\pi c \\tilde{\\nu}_{\\max}) = \\frac{1}{k_B T} \\cdot \\frac{h}{2\\pi} \\cdot (2\\pi c \\tilde{\\nu}_{\\max}) = \\frac{h c \\tilde{\\nu}_{\\max}}{k_B T}\n$$\n可以如下计算：\n$$\n\\beta \\hbar \\omega_{\\max} = \\frac{\\tilde{\\nu}_{\\max}}{T \\cdot (k_B / (hc))}\n$$\n代入给定值：\n$$\n\\beta \\hbar \\omega_{\\max} = \\frac{3300\\,\\mathrm{cm}^{-1}}{300\\,\\mathrm{K} \\cdot 0.69503476\\,\\mathrm{cm}^{-1}\\,\\mathrm{K}^{-1}} = \\frac{3300}{208.510428} \\approx 15.8265\n$$\n因此，对 Trotter 数 $P$ 的条件是 $P \\ge 15.8265$。由于 $P$ 必须是整数，所需的最小珠子数为 $P=16$。\n\n对于从头算 PIMD 设置，必须在 Born-Oppenheimer MD (BOMD) 和 Car-Parrinello MD (CPMD) 之间做出选择。在 AI-PIMD 中，每个珠子的势能都是通过电子结构计算实时（on-the-fly）计算的。基于 BOMD 的方法需要在每个 MD 步骤中，为 $P$ 个核构型中的每一个都将电子波函数优化到基态。这在计算上要求很高，随 $P$ 线性扩展，但它很稳健且概念上简单明了。基于 CPMD 的方法则需要传播 $P$ 组虚拟的电子自由度，这些自由度必须与 $P$ 组核自由度保持绝热分离。这会引入严重的时间步长限制和复杂的稳定性挑战。因此，**Born-Oppenheimer 分子动力学 (BOMD)** 框架是 AI-PIMD 更实用和更稳定的选择。\n\n积分时间步长 $\\Delta t$ 的选择必须能够分辨模拟系统中的最高频率运动。在 PIMD 中，动力学是经典环状聚合物的动力学，其中珠子由谐振弹簧连接。这些弹簧的频率是 $\\omega_P = P/(\\hbar\\beta)$。自由环状聚合物的简正模式频率为 $\\Omega_k = 2\\omega_P \\sin(k\\pi/P)$，其中 $k=1, \\dots, P-1$。这些频率中的最高值为 $\\Omega_{\\max} \\approx 2\\omega_P = 2P/(\\hbar\\beta)$。完整体系的频率为 $\\omega_k^{\\text{full}} = \\sqrt{\\omega_{\\text{phys}}^2 + \\Omega_k^2}$。因此，最高频率由环状聚合物的弹簧模式主导：$\\omega_{\\text{PIMD, max}} \\approx \\Omega_{\\max} = 2P/(\\hbar\\beta)$。这个最快运动的周期是 $T_{\\min} = 2\\pi / \\omega_{\\text{PIMD, max}} = \\pi\\hbar\\beta/P$。对于 $P=16$，我们有 $T_{\\min} = \\pi \\hbar\\beta / 16$。使用我们之前的结果，$\\hbar\\beta = (\\beta\\hbar\\omega_{\\max})/\\omega_{\\max} = 15.8265 / (2\\pi c \\tilde{\\nu}_{\\max}) \\approx 2.54 \\times 10^{-14}\\,\\mathrm{s}$，即 $25.4\\,\\mathrm{fs}$。因此，$T_{\\min} \\approx \\pi(25.4\\,\\mathrm{fs})/16 \\approx 5.0\\,\\mathrm{fs}$。稳定的积分需要时间步长 $\\Delta t$ 至少小一个数量级，因此对稳定时间步长的合理估计是 $\\Delta t \\approx 0.1 - 0.2\\,\\mathrm{fs}$。\n\n最后，关于恒温器策略，已知 PIMD 系统存在严重的非遍历性问题。对所有自由度应用单个恒温器是行不通的，因为物理模式与环状聚合物的刚性、高频内部模式之间的能量交换极其缓慢。这导致对正则系综的采样不正确。为确保所有模式的适当热化，需要一个专门的恒温器。最佳策略是为环状聚合物的每个简正模式应用一个单独的恒温器。**路径积分 Nosé-Hoover 链 (PI-NHC)** 恒温器是为此目的而设的一种标准而稳健的方法。它通过单独热化每个简正模式来保证正确的正则采样，从而克服遍历性问题。另外，一个配置得当的广义朗之万方程 (generalized Langevin equation, GLE) 恒温器也可以非常有效。", "answer": "$$\n\\boxed{16}\n$$", "id": "2759518"}, {"introduction": "确定了珠子数量后，下一步便是计算系统的物理性质。本练习将带您深入实现细节，为量子谐振子计算总能量。通过编写“原始”（primitive）PIMD 能量估计器的代码 [@problem_id:2461794]，您不仅将计算一个量子可观测量，还将亲身发现一个关键的实际问题——该估计器收敛缓慢，这正是促使研究者开发更先进算法的根本原因。", "problem": "你需要实现一个完整、可运行的程序，用于计算一维 ($1$D) 量子谐振子的原始路径积分分子动力学 (PIMD) 总能量估计值，并通过与基准值比较，证明其收敛速度相对于珠子数量 $P$ 而言是缓慢的。计算在约化的无量纲单位下进行，其中 $\\hbar=1$、$k_\\mathrm{B}=1$、$m=1$ 且 $\\omega=1$。逆温度固定为 $\\beta=2$。\n\n考虑一个质量为 $m$ 的单个粒子，在逆温度为 $\\beta$ 时处于谐振势 $V(q)=\\tfrac{1}{2} m \\omega^2 q^2$ 中。在具有 $P$ 个珠子且珠子逆温度为 $\\beta_P=\\beta/P$ 的原始路径积分离散化中，环状聚合物的构型能量为\n$$\nU_P(\\mathbf{q})=\\sum_{i=1}^{P} \\left[ \\tfrac{1}{2} m \\omega_P^2 \\left(q_i-q_{i+1}\\right)^2 + \\tfrac{1}{2} m \\omega^2 q_i^2 \\right],\n$$\n其中循环边界条件为 $q_{P+1}\\equiv q_1$，环状聚合物弹簧频率为 $\\omega_P = \\dfrac{P}{\\beta \\hbar}$。在此离散化中，量子力学总能量 $E$ 的原始热力学估计量为\n$$\nE_{\\mathrm{prim}}(P) \\;=\\; \\frac{P}{2\\beta} \\;+\\; \\frac{1}{P}\\left\\langle \\sum_{i=1}^{P} V(q_i) \\right\\rangle \\;-\\; \\frac{m \\omega_P^2}{2P}\\left\\langle \\sum_{i=1}^{P} \\left(q_i-q_{i+1}\\right)^2 \\right\\rangle,\n$$\n其中平均值是在与 $\\exp\\!\\left(-\\beta_P U_P(\\mathbf{q})\\right)$ 成正比的正则环状聚合物分布上计算的。\n\n作为一个与高效分段(staging)估计量相关联的基准“文献值”，使用谐振子总能量的精确量子力学热平均值，\n$$\nE_{\\mathrm{exact}} \\;=\\; \\frac{\\hbar \\omega}{2}\\, \\coth\\!\\left(\\frac{\\beta \\hbar \\omega}{2}\\right),\n$$\n在指定的约化单位下，该值简化为 $E_{\\mathrm{exact}}=\\tfrac{1}{2}\\coth(\\beta/2)$。\n\n你的任务是编写一个程序，对于每个指定的 $P$，计算上述系统的原始估计量 $E_{\\mathrm{prim}}(P)$，并报告其绝对误差\n$$\n\\varepsilon(P) \\;=\\; \\left| E_{\\mathrm{prim}}(P) - E_{\\mathrm{exact}} \\right|.\n$$\n\n使用以下珠子数量的测试集来探测不同的区域，包括边界情况 $P=1$ 和逐渐精细的离散化：\n- $P \\in \\{\\,1,\\,2,\\,4,\\,8,\\,16,\\,32,\\,64\\,\\}$。\n\n所有计算均在所述的约化单位下进行，是无量纲的，因此无需报告物理单位。你的程序必须产生单行输出，其中包含一个用方括号括起来的逗号分隔列表，其顺序与测试集相同，其中每个条目是对应 $P$ 的 $\\varepsilon(P)$ 的浮点值。例如，输出格式必须严格符合以下形式\n$$\n[\\varepsilon(1),\\varepsilon(2),\\varepsilon(4),\\varepsilon(8),\\varepsilon(16),\\varepsilon(32),\\varepsilon(64)].\n$$", "solution": "问题陈述已经过分析，并被确定为有效。这是一个适定问题，其科学基础是计算统计力学，特别是路径积分分子动力学（PIMD）的原理，它为一个基本模型系统提出了一个标准的入门级计算。任务是证明原始PIMD能量估计量的一个已知性质，即对于一维量子谐振子，其收敛速度很慢。解析解所需的所有定义和参数都已提供，并且在科学上是合理的。\n\n我们将对指定系统的原始能量估计量 $E_{\\mathrm{prim}}(P)$ 进行解析推导。任务的核心是评估 $E_{\\mathrm{prim}}(P)$ 定义中出现的正则平均值。\n\n该系统是一个由 $P$ 个珠子组成的环状聚合物，其坐标为 $\\mathbf{q} = (q_1, \\dots, q_P)^T$。这个经典同构系统的势能由下式给出\n$$\nU_P(\\mathbf{q}) = \\sum_{i=1}^{P} \\left[ \\frac{1}{2} m \\omega_P^2 (q_i - q_{i+1})^2 + \\frac{1}{2} m \\omega^2 q_i^2 \\right]\n$$\n其中 $q_{P+1} \\equiv q_1$。在给定的约化单位中，$m=1$，$\\omega=1$，$\\hbar=1$，$\\beta=2$。环状聚合物频率为 $\\omega_P = P/(\\beta\\hbar) = P/2$。势能简化为\n$$\nU_P(\\mathbf{q}) = \\frac{1}{2} \\sum_{i=1}^{P} \\left[ \\left(\\frac{P}{2}\\right)^2 (q_i - q_{i+1})^2 + q_i^2 \\right].\n$$\n这是一个二次型，可以用矩阵表示为 $U_P(\\mathbf{q}) = \\frac{1}{2} \\mathbf{q}^T \\mathbf{A} \\mathbf{q}$。矩阵 $\\mathbf{A}$ 是一个 $P \\times P$ 的实对称循环矩阵，定义为\n$$\n\\mathbf{A} = \\left(\\frac{P}{2}\\right)^2 \\mathbf{K} + \\mathbf{I},\n$$\n其中 $\\mathbf{I}$ 是单位矩阵，$\\mathbf{K}$ 是表示最近邻相互作用的循环矩阵，其元素为 $K_{ii}=2$，$K_{i,i\\pm 1}=-1$ (以及 $K_{1,P}=K_{P,1}=-1$)。\n\n珠子位置的正则概率分布是一个多元高斯分布：\n$$\np(\\mathbf{q}) \\propto \\exp(-\\beta_P U_P(\\mathbf{q})) = \\exp\\left(-\\frac{\\beta}{2P} \\mathbf{q}^T \\mathbf{A} \\mathbf{q}\\right).\n$$\n该分布的协方差矩阵是 $\\boldsymbol{\\Sigma} = \\left(\\frac{\\beta}{P} \\mathbf{A}\\right)^{-1} = \\frac{P}{\\beta} \\mathbf{A}^{-1}$。所需的热平均值可以使用这个协方差矩阵来计算。\n\n原始能量估计量为\n$$\nE_{\\mathrm{prim}}(P) = \\frac{P}{2\\beta} + \\frac{1}{P}\\left\\langle \\sum_{i=1}^{P} V(q_i) \\right\\rangle - \\frac{m \\omega_P^2}{2P}\\left\\langle \\sum_{i=1}^{P} (q_i-q_{i+1})^2 \\right\\rangle.\n$$\n这两个平均值的计算如下：\n1. 势能项：$\\frac{1}{P}\\langle \\sum_i V(q_i) \\rangle = \\frac{1}{P} \\langle \\frac{1}{2} \\sum_i q_i^2 \\rangle = \\frac{1}{2P} \\langle \\mathbf{q}^T \\mathbf{I} \\mathbf{q} \\rangle$。利用对于零均值高斯分布 $\\langle \\mathbf{x}^T \\mathbf{M} \\mathbf{x} \\rangle = \\mathrm{Tr}(\\mathbf{M}\\boldsymbol{\\Sigma})$ 的性质，我们得到 $\\frac{1}{2P} \\mathrm{Tr}(\\mathbf{I}\\boldsymbol{\\Sigma}) = \\frac{1}{2P} \\mathrm{Tr}(\\boldsymbol{\\Sigma})$。\n2. 类动能项：$\\frac{m \\omega_P^2}{2P} \\langle \\sum_i (q_i-q_{i+1})^2 \\rangle = \\frac{\\omega_P^2}{2P} \\langle \\mathbf{q}^T \\mathbf{K} \\mathbf{q} \\rangle = \\frac{\\omega_P^2}{2P} \\mathrm{Tr}(\\mathbf{K}\\boldsymbol{\\Sigma})$。\n\n为了计算迹，我们对矩阵 $\\mathbf{A}$ 进行对角化。动能矩阵 $\\mathbf{K}$ 的特征值为 $\\lambda_k = 2 - 2\\cos(2\\pi k/P) = 4\\sin^2(\\pi k/P)$，其中 $k=0, 1, \\dots, P-1$。因此，$\\mathbf{A}$ 的特征值为\n$$\n\\alpha_k = \\left(\\frac{P}{2}\\right)^2 \\lambda_k + 1 = P^2\\sin^2(\\frac{\\pi k}{P}) + 1.\n$$\n迹是特征值之和。$\\mathrm{Tr}(\\boldsymbol{\\Sigma}) = \\mathrm{Tr}(\\frac{P}{\\beta} \\mathbf{A}^{-1}) = \\frac{P}{\\beta} \\sum_{k=0}^{P-1} \\frac{1}{\\alpha_k}$。\n$\\mathrm{Tr}(\\mathbf{K}\\boldsymbol{\\Sigma}) = \\frac{P}{\\beta} \\mathrm{Tr}(\\mathbf{K}\\mathbf{A}^{-1}) = \\frac{P}{\\beta} \\sum_{k=0}^{P-1} \\frac{\\lambda_k}{\\alpha_k}$。\n\n将这些代入 $E_{\\mathrm{prim}}(P)$ 的表达式中：\n$$\nE_{\\mathrm{prim}}(P) = \\frac{P}{2\\beta} + \\frac{1}{2P} \\left(\\frac{P}{\\beta} \\sum_{k=0}^{P-1} \\frac{1}{\\alpha_k}\\right) - \\frac{\\omega_P^2}{2P} \\left(\\frac{P}{\\beta} \\sum_{k=0}^{P-1} \\frac{\\lambda_k}{\\alpha_k}\\right)\n$$\n$$\nE_{\\mathrm{prim}}(P) = \\frac{P}{2\\beta} + \\frac{1}{2\\beta} \\sum_{k=0}^{P-1} \\frac{1}{\\alpha_k} - \\frac{\\omega_P^2}{2\\beta} \\sum_{k=0}^{P-1} \\frac{\\lambda_k}{\\alpha_k}\n$$\n$$\nE_{\\mathrm{prim}}(P) = \\frac{P}{2\\beta} + \\frac{1}{2\\beta} \\sum_{k=0}^{P-1} \\frac{1 - \\omega_P^2 \\lambda_k}{\\alpha_k} = \\frac{P}{2\\beta} + \\frac{1}{2\\beta} \\sum_{k=0}^{P-1} \\frac{1 - (P/2)^2 (4\\sin^2(\\pi k/P))}{1 + (P/2)^2 (4\\sin^2(\\pi k/P))}.\n$$\n这导出了用于数值计算的最终解析公式：\n$$\nE_{\\mathrm{prim}}(P) = \\frac{P}{2\\beta} + \\frac{1}{2\\beta} \\sum_{k=0}^{P-1} \\frac{1 - P^2 \\sin^2(\\pi k/P)}{1 + P^2 \\sin^2(\\pi k/P)}.\n$$\n在指定的逆温度 $\\beta=2$下，这简化为\n$$\nE_{\\mathrm{prim}}(P) = \\frac{P}{4} + \\frac{1}{4} \\sum_{k=0}^{P-1} \\frac{1 - P^2 \\sin^2(\\pi k/P)}{1 + P^2 \\sin^2(\\pi k/P)}.\n$$\n量子谐振子的基准精确能量是\n$$\nE_{\\mathrm{exact}} = \\frac{\\hbar \\omega}{2}\\, \\coth\\left(\\frac{\\beta \\hbar \\omega}{2}\\right).\n$$\n在给定的约化单位和 $\\beta=2$ 下，这变为\n$$\nE_{\\mathrm{exact}} = \\frac{1}{2}\\, \\coth(1).\n$$\n程序将对指定的测试集 {$1, 2, 4, 8, 16, 32, 64$} 中的每个 $P$ 值计算绝对误差 $\\varepsilon(P) = | E_{\\mathrm{prim}}(P) - E_{\\mathrm{exact}} |$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the primitive PIMD total energy estimate for a 1D quantum\n    harmonic oscillator and reports its error relative to the exact value.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    # Reduced units are used throughout as specified in the problem statement.\n    h_bar = 1.0\n    omega = 1.0\n    m = 1.0\n    beta = 2.0  # Inverse temperature\n\n    # Test suite for the number of beads P\n    P_values = [1, 2, 4, 8, 16, 32, 64]\n\n    # --- Analytical Benchmark Calculation ---\n    # The exact quantum-mechanical thermal average of the total energy.\n    # E_exact = (hbar * omega / 2) * coth(beta * hbar * omega / 2)\n    # With given units, this simplifies to 0.5 * coth(1).\n    E_exact = (h_bar * omega / 2.0) / np.tanh(beta * h_bar * omega / 2.0)\n\n    # --- Main Calculation Loop ---\n    # We compute the absolute error for each specified number of beads P.\n    errors = []\n    for P in P_values:\n        # Calculate the primitive energy estimator E_prim(P) using the\n        # derived analytical formula.\n        # E_prim(P) = P/(2*beta) + 1/(2*beta) * sum_{k=0}^{P-1} [ ... ]\n        \n        # The sum is evaluated numerically using vectorized numpy operations.\n        k = np.arange(P)\n        # Handle P=1 where k=0, sin(0)=0. For P>1, k/P avoids issues.\n        sin2_term = np.sin(np.pi * k / P)**2\n        \n        # The expression inside the sum\n        summand = (1.0 - P**2 * sin2_term) / (1.0 + P**2 * sin2_term)\n        \n        # The sum over all k from 0 to P-1\n        total_sum = np.sum(summand)\n        \n        E_prim = P / (2.0 * beta) + total_sum / (2.0 * beta)\n        \n        # Compute the absolute error for the current P\n        error = np.abs(E_prim - E_exact)\n        errors.append(error)\n\n    # --- Format and Print Output ---\n    # The output must be a single line containing a comma-separated list\n    # of float values enclosed in square brackets.\n    # The default string conversion of numpy floats is used.\n    output_string = \",\".join(map(str, errors))\n    print(f\"[{output_string}]\")\n\nsolve()\n```", "id": "2461794"}, {"introduction": "虽然 PIMD 为静态平衡性质提供了精确的理论框架，但近似模拟实时量子动力学则是一个更复杂的挑战。这项进阶练习对几种主流的路径积分动力学方法进行了比较研究，包括 RPMD、TRPMD 和 CMD。通过为量子谐振子推导并实现一系列解析表达式 [@problem_id:2793590]，您将清晰地理解每种方法如何利用环状聚合物同构性来近似描述动力学，并洞察它们在这一理想模型中的本质区别和内在联系。", "problem": "构建一个完整、可运行的程序，该程序针对一维量子谐振子，实现对四种基于路径积分的分子动力学近似方法的原则性比较：路径积分分子动力学 (PIMD)、环状聚合物分子动力学 (RPMD)、质心分子动力学 (CMD) 和恒温环状聚合物分子动力学 (TRPMD)。您的程序必须从路径积分离散化和环状聚合物简正模表示出发，从第一性原理计算指定的平衡态和动力学总结量。\n\n您必须遵守以下要求。\n\n- 物理模型。考虑一个质量为 $m$ 的单个粒子，在逆温度 $\\beta$ 下，在谐振势 $V(x) = \\tfrac{1}{2} m \\omega^2 x^2$ 中运动。使用约化单位，其中普朗克常数和玻尔兹曼常数分别为 $ \\hbar = 1 $ 和 $ k_B = 1 $。所有量都必须用这些约化单位表示。\n\n- 使用的基本依据。从离散为 $P$ 个时间片的虚时费曼路径积分开始，并将其映射到一个具有 $P$ 个珠子的经典环状聚合物。相应的环状聚合物哈密顿量是在简正模表示下 $P$ 个解耦谐振模式的总和。设环状聚合物弹簧频率为 $\\omega_P = \\dfrac{P}{\\beta \\hbar}$，第 $k$ 个简正模频率为\n$$\n\\Omega_k \\equiv \\sqrt{ \\omega^2 + 4 \\omega_P^2 \\sin^2\\!\\left( \\frac{\\pi k}{P} \\right) }, \\quad k = 0,1,\\dots,P-1.\n$$\n您的推导必须依赖于此表示法以及正则采样下谐振模式的高斯统计特性。\n\n- 待计算的量。对于每个参数集，计算以下内容：\n  1. 单个珠子的 PIMD 珠子平均位置方差，记为 $\\langle x^2 \\rangle_{\\text{PIMD}}(P)$，用环状聚合物简正模表示。这必须来自简正模所蕴含的珠子坐标的平衡协方差。\n  2. 谐振子的精确量子力学方差：\n  $$\n  \\langle x^2 \\rangle_{\\text{exact}} = \\frac{\\hbar}{2 m \\omega} \\coth\\!\\left( \\frac{\\beta \\hbar \\omega}{2} \\right),\n  $$\n  用指定的约化单位表示。\n  3. RPMD 的总结频率，定义为珠子平均位置自相关的简正模加权平均振荡频率。通过使用出现在 PIMD 方差中的平衡模振幅权重和无阻尼频率 $\\Omega_k$ 来构建此量。\n  4. TRPMD 相应的总结频率，定义方式相同，但内部模式 $(k \\neq 0)$ 经历朗之万阻尼，其中均匀摩擦系数 $\\gamma$ 仅应用于内部简正模，而质心模式 $(k=0)$ 保持无阻尼。对于每个内部模式，在加权平均中使用欠阻尼频率 $\\sqrt{\\max(\\Omega_k^2 - \\gamma^2/4,\\,0)}$。\n  5. CMD 总结频率，通过绝热消除内部模式得到，因此只有质心模式产生动力学贡献。\n  6. 精确的谐振频率。\n\n- 角度单位。所有频率都必须以弧度/单位时间来处理和报告。\n\n- 输出规范。对于每个测试用例，输出一个列表，其中按此精确顺序包含以下七个浮点数：\n  - $\\langle x^2 \\rangle_{\\text{PIMD}}(P)$\n  - $\\langle x^2 \\rangle_{\\text{exact}}$\n  - RPMD 加权平均频率\n  - TRPMD 加权平均频率\n  - CMD 频率\n  - 精确谐振频率\n  - PIMD 方差相对于精确值的相对误差，定义为 $\\left( \\langle x^2 \\rangle_{\\text{PIMD}} - \\langle x^2 \\rangle_{\\text{exact}} \\right) / \\langle x^2 \\rangle_{\\text{exact}}$\n\n- 测试套件。您的程序必须精确评估以下四个参数集，每个参数集以元组 $(m,\\omega,\\beta,\\hbar,P,\\gamma)$ 的形式在约化单位中给出，并内部强制 $\\hbar=1$：\n  - 案例 A (边界情况，单个珠子): $(1.0,\\,1.0,\\,5.0,\\,1.0,\\,1,\\,0.8)$\n  - 案例 B (低温，多个珠子): $(1.0,\\,1.0,\\,20.0,\\,1.0,\\,64,\\,1.0)$\n  - 案例 C (高频，中等数量珠子): $(1.0,\\,3.0,\\,1.0,\\,1.0,\\,16,\\,2.0)$\n  - 案例 D (较大质量，较软模式): $(2.0,\\,0.5,\\,10.0,\\,1.0,\\,32,\\,0.5)$\n\n- 最终输出格式。您的程序应生成单行输出，其中包含一个由四个列表组成的列表，每个测试用例一个，严格按照 A、B、C、D 的顺序排列。每个内部列表必须包含上述七个浮点数，外部列表必须打印为用方括号括起来的逗号分隔列表。例如：\n\"[[a1,a2,a3,a4,a5,a6,a7],[b1,b2,b3,b4,b5,b6,b7],[c1,c2,c3,c4,c5,c6,c7],[d1,d2,d3,d4,d5,d6,d7]]\"\n\n不允许用户输入；程序必须完全自成体系并按原样运行。", "solution": "问题陈述经过严格验证。\n\n**第 1 步：提取已知条件**\n- **物理系统**：质量为 $m$、势为 $V(x) = \\frac{1}{2} m \\omega^2 x^2$ 的一维量子谐振子。\n- **热力学状态**：逆温度 $\\beta = 1/(k_B T)$。\n- **单位**：约化单位，其中 $\\hbar = 1$ 和 $k_B = 1$。\n- **路径积分模型**：具有 $P$ 个珠子的环状聚合物。\n- **环状聚合物弹簧频率**：$\\omega_P = \\frac{P}{\\beta \\hbar}$。\n- **简正模频率**：$\\Omega_k = \\sqrt{ \\omega^2 + 4 \\omega_P^2 \\sin^2\\!\\left( \\frac{\\pi k}{P} \\right) }$，其中 $k = 0, 1, \\dots, P-1$。\n- **待计算的量**：\n    1. PIMD 珠子平均位置方差, $\\langle x^2 \\rangle_{\\text{PIMD}}(P)$。\n    2. 精确量子力学位置方差, $\\langle x^2 \\rangle_{\\text{exact}} = \\frac{\\hbar}{2 m \\omega} \\coth\\!\\left( \\frac{\\beta \\hbar \\omega}{2} \\right)$。\n    3. RPMD 总结频率, $\\omega_{\\text{RPMD}}$。\n    4. TRPMD 总结频率, $\\omega_{\\text{TRPMD}}$，内部模式摩擦系数为 $\\gamma$。$k \\neq 0$ 的阻尼频率为 $\\sqrt{\\max(\\Omega_k^2 - \\gamma^2/4, 0)}$。\n    5. CMD 总结频率, $\\omega_{\\text{CMD}}$。\n    6. 精确谐振频率, $\\omega$。\n    7. 相对误差：$(\\langle x^2 \\rangle_{\\text{PIMD}} - \\langle x^2 \\rangle_{\\text{exact}}) / \\langle x^2 \\rangle_{\\text{exact}}$。\n- **测试参数**：提供了四组 $(m, \\omega, \\beta, \\hbar, P, \\gamma)$ 参数。\n\n**第 2 步：使用提取的已知条件进行验证**\n该问题在理论与计算化学的既定框架内具有科学依据。它提法恰当、客观且自成体系。所提供的公式和概念——环状聚合物同构、简正模分析以及 PIMD、RPMD、CMD 和 TRPMD 的定义——都是该领域的标准。谐振子是一个典范的、非平凡的模型系统，其精确结果是已知的，从而可以进行原则性比较。不存在矛盾、歧义或事实错误。\n\n**第 3 步：结论与行动**\n问题被判定为**有效**。我们继续按要求从第一性原理推导所需量。\n\n我们分析的基础是量子配分函数的经典同构，它将单个量子粒子映射到一个具有 $P$ 个珠子的经典环状聚合物。对于谐振势，环状聚合物势能是珠子坐标 $\\{x_j\\}$ 的二次型。通过变换到简正模坐标 $\\{c_k'\\}$，该二次型可以被对角化。在这些坐标下的势能为：\n$$\nV_{\\text{NM}} = \\frac{1}{2} m \\sum_{k=0}^{P-1} \\Omega_k^2 (c_k')^2\n$$\n其中 $\\Omega_k$ 是给定的简正模频率。每个简正模的行为都像一个独立的经典谐振子。\n\n1.  **PIMD 珠子平均位置方差, $\\langle x^2 \\rangle_{\\text{PIMD}}(P)$**\n    环状聚合物模型是在逆温度 $\\beta$ 下的经典系统。根据能量均分定理，每个简正模中存储的平均势能为 $\\frac{1}{2}k_B T = \\frac{1}{2\\beta}$。\n    $$\n    \\frac{1}{2} m \\Omega_k^2 \\langle (c_k')^2 \\rangle = \\frac{1}{2\\beta} \\implies \\langle (c_k')^2 \\rangle = \\frac{1}{\\beta m \\Omega_k^2}\n    $$\n    从珠子坐标 $\\{x_j\\}$到简正模坐标 $\\{c_k'\\}$ 的变换是正交的。因此，根据帕塞瓦尔定理，位置平方和是守恒的：$\\sum_{j=0}^{P-1} x_j^2 = \\sum_{k=0}^{P-1} (c_k')^2$。取热平均：\n    $$\n    \\sum_{j=0}^{P-1} \\langle x_j^2 \\rangle = \\sum_{k=0}^{P-1} \\langle (c_k')^2 \\rangle\n    $$\n    根据对称性，所有珠子都是等价的，因此对于所有的 $j$，$\\langle x_j^2 \\rangle$ 都是相同的。我们将其记为 $\\langle x^2 \\rangle_{\\text{PIMD}}$。\n    $$\n    P \\langle x^2 \\rangle_{\\text{PIMD}} = \\sum_{k=0}^{P-1} \\frac{1}{\\beta m \\Omega_k^2}\n    $$\n    因此，珠子平均位置方差为：\n    $$\n    \\langle x^2 \\rangle_{\\text{PIMD}}(P) = \\frac{1}{P \\beta m} \\sum_{k=0}^{P-1} \\frac{1}{\\Omega_k^2}\n    $$\n    代入 $\\Omega_k$ 的表达式并设 $\\hbar=1$：\n    $$\n    \\langle x^2 \\rangle_{\\text{PIMD}}(P) = \\frac{1}{P \\beta m} \\sum_{k=0}^{P-1} \\frac{1}{\\omega^2 + 4(P/\\beta)^2 \\sin^2(\\pi k / P)}\n    $$\n\n2.  **精确量子方差, $\\langle x^2 \\rangle_{\\text{exact}}$**\n    这个量是直接给出的。当 $\\hbar=1$ 时：\n    $$\n    \\langle x^2 \\rangle_{\\text{exact}} = \\frac{1}{2 m \\omega} \\coth\\left(\\frac{\\beta \\omega}{2}\\right)\n    $$\n\n3.  **RPMD 总结频率, $\\omega_{\\text{RPMD}}$**\n    问题将此定义为简正模频率 $\\Omega_k$ 的加权平均值。权重与每个模式对位置方差的贡献成正比，而该贡献又与 $\\langle (c_k')^2 \\rangle$ 成正比，因此与 $1/\\Omega_k^2$ 成正比。设权重为 $w_k = C / \\Omega_k^2$，其中 $C$ 是归一化常数。加权平均值为：\n    $$\n    \\omega_{\\text{RPMD}} = \\frac{\\sum_{k=0}^{P-1} w_k \\Omega_k}{\\sum_{k=0}^{P-1} w_k} = \\frac{\\sum_{k=0}^{P-1} (1/\\Omega_k^2) \\Omega_k}{\\sum_{k=0}^{P-1} 1/\\Omega_k^2} = \\frac{\\sum_{k=0}^{P-1} 1/\\Omega_k}{\\sum_{k=0}^{P-1} 1/\\Omega_k^2}\n    $$\n\n4.  **TRPMD 总结频率, $\\omega_{\\text{TRPMD}}$**\n    其构造方式与 $\\omega_{\\text{RPMD}}$ 类似，但内部模式 ($k=1, \\dots, P-1$) 的频率被摩擦系数为 $\\gamma$ 的朗之万阻尼所修正。质心模式 ($k=0$) 保持无阻尼。质心模式的频率为 $\\Omega_0 = \\omega$。内部模式的频率为 $\\Omega'_k = \\sqrt{\\max(0, \\Omega_k^2 - \\gamma^2/4)}$。加权平均值为：\n    $$\n    \\omega_{\\text{TRPMD}} = \\frac{w_0 \\Omega_0 + \\sum_{k=1}^{P-1} w_k \\Omega'_k}{\\sum_{k=0}^{P-1} w_k} = \\frac{(1/\\Omega_0^2) \\Omega_0 + \\sum_{k=1}^{P-1} (1/\\Omega_k^2) \\Omega'_k}{\\sum_{k=0}^{P-1} 1/\\Omega_k^2}\n    $$\n    代入 $\\Omega_0 = \\omega$ 和 $\\Omega'_k$ 的表达式：\n    $$\n    \\omega_{\\text{TRPMD}} = \\frac{(1/\\omega) + \\sum_{k=1}^{P-1} \\Omega_k^{-2} \\sqrt{\\max(0, \\Omega_k^2 - \\gamma^2/4)}}{\\sum_{k=0}^{P-1} 1/\\Omega_k^2}\n    $$\n\n5.  **CMD 总结频率, $\\omega_{\\text{CMD}}$**\n    质心分子动力学描述了环状聚合物质心 $q_c = \\frac{1}{P} \\sum_j x_j$ 在通过对内部模式积分而生成的平均力势 (PMF) 上的演化。对于量子谐振子，PMF 精确地是谐振的，且频率与原始势的频率相同。这是一个已知的精确结果。因此，CMD 频率与振子的物理频率相同。从动力学上讲，这对应于质心简正模的频率 $\\Omega_0$。\n    $$\n    \\omega_{\\text{CMD}} = \\Omega_0 = \\sqrt{\\omega^2 + 4 \\omega_P^2 \\sin^2(0)} = \\omega\n    $$\n\n6.  **精确谐振频率, $\\omega_{\\text{exact}}$**\n    这是谐振势的参数 $\\omega$。\n    $$\n    \\omega_{\\text{exact}} = \\omega\n    $$\n\n7.  **PIMD 方差的相对误差**\n    这由问题陈述定义：\n    $$\n    \\text{Error} = \\frac{\\langle x^2 \\rangle_{\\text{PIMD}}(P) - \\langle x^2 \\rangle_{\\text{exact}}}{\\langle x^2 \\rangle_{\\text{exact}}}\n    $$\n\n将为每个提供的参数集计算这七个量。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes equilibrium and dynamical properties for a 1D quantum harmonic oscillator\n    using PIMD, RPMD, CMD, and TRPMD approximations based on the normal-mode representation.\n    \"\"\"\n    # Test cases: (m, omega, beta, hbar, P, gamma)\n    # The problem specifies hbar=1, which is used in the calculations.\n    test_cases = [\n        (1.0, 1.0, 5.0, 1.0, 1, 0.8),    # Case A\n        (1.0, 1.0, 20.0, 1.0, 64, 1.0),   # Case B\n        (1.0, 3.0, 1.0, 1.0, 16, 2.0),   # Case C\n        (2.0, 0.5, 10.0, 1.0, 32, 0.5),  # Case D\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        m, omega, beta, hbar, P, gamma = case\n\n        # Enforce reduced units\n        hbar = 1.0\n        k_B = 1.0\n\n        # --- Normal Mode Frequencies ---\n        omega_P = P / (beta * hbar)\n        k_indices = np.arange(P)\n        sin_term = np.sin(np.pi * k_indices / P)\n        Omega_k_sq = omega**2 + 4 * omega_P**2 * sin_term**2\n        Omega_k = np.sqrt(Omega_k_sq)\n\n        # --- 1. PIMD Bead-Averaged Position Variance ---\n        x_sq_pimd = (1 / (P * beta * m)) * np.sum(1 / Omega_k_sq)\n\n        # --- 2. Exact Quantum Variance ---\n        x_sq_exact = (hbar / (2 * m * omega)) / np.tanh(beta * hbar * omega / 2)\n\n        # --- Weights for averaging ---\n        weights_k = 1 / Omega_k_sq\n        sum_of_weights = np.sum(weights_k)\n        \n        # --- 3. RPMD Summary Frequency ---\n        omega_rpmd = np.sum(1 / Omega_k) / sum_of_weights\n\n        # --- 4. TRPMD Summary Frequency ---\n        # Damped frequencies for internal modes (k > 0)\n        Omega_k_internal = Omega_k[1:]\n        damped_freq_internal_sq = np.maximum(0, Omega_k_internal**2 - gamma**2 / 4)\n        damped_freq_internal = np.sqrt(damped_freq_internal_sq)\n        \n        # Centroid mode (k=0) is undamped\n        if P > 1:\n            numerator_trpmd = (1/Omega_k[0]) + np.sum((1/Omega_k_internal**2) * damped_freq_internal)\n        else: # P=1, no internal modes\n            numerator_trpmd = (1/Omega_k[0])\n        \n        omega_trpmd = numerator_trpmd / sum_of_weights\n        \n        # --- 5. CMD Summary Frequency ---\n        omega_cmd = omega\n\n        # --- 6. Exact Harmonic Frequency ---\n        omega_exact = omega\n\n        # --- 7. Relative Error of PIMD Variance ---\n        rel_error = (x_sq_pimd - x_sq_exact) / x_sq_exact\n        \n        results_for_case = [\n            x_sq_pimd,\n            x_sq_exact,\n            omega_rpmd,\n            omega_trpmd,\n            omega_cmd,\n            omega_exact,\n            rel_error\n        ]\n        all_results.append(results_for_case)\n\n    # Format output as a list of lists string\n    inner_lists = [\",\".join(map(str, res)) for res in all_results]\n    outer_list = \",\".join([f\"[{s}]\" for s in inner_lists])\n    print(f\"[{outer_list}]\")\n\nsolve()\n```", "id": "2793590"}]}