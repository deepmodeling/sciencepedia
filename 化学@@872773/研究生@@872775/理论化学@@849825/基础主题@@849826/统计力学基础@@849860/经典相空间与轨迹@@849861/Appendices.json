{"hands_on_practices": [{"introduction": "本次练习旨在建立经典力学与统计力学之间的基础联系。通过计算简谐振子的微正则态密度，您将亲眼见证相空间中等能面的抽象几何面积如何直接对应于一个基本的热力学量，从而加深对相空间体积物理意义的理解 [@problem_id:2764571]。", "problem": "一个质量为 $m$、角频率为 $\\omega$ 的一维经典谐振子，在正则相空间中由坐标 $x$ 和共轭动量 $p$ 描述，其哈密顿量为 $H(x,p) = \\frac{p^{2}}{2m} + \\frac{1}{2} m \\omega^{2} x^{2}$。考虑总能量固定为 $E0$ 的微正则系综。仅使用经典统计力学的基本定义，并采用每个体积为 $h$ 的普朗克相空间单元对应一个微观态的约定，计算微正则态密度 $\\Omega(E)$。\n\n你的推导必须从以下定义出发：能量低于 $E$ 的累积相空间体积为 $\\Gamma(E) = \\frac{1}{h} \\iint \\Theta(E - H(x,p)) \\, dx \\, dp$，而微正则态密度为 $\\Omega(E) = \\frac{d\\Gamma}{dE}$，其中 $\\Theta$ 是亥维赛阶跃函数。从几何上将 $\\Gamma(E)$ 解释为由等能线所包围的相空间面积除以 $h$，并将此面积与谐振子的能量 $E$ 联系起来。然后对 $E$ 求导以得到 $\\Omega(E)$。\n\n将你的最终结果表示为以 $\\omega$ 和 $h$ 表示的闭式解析表达式。不要进行任何数值代入。在所述的约定下（即相空间体积以 $h$ 为单位测量），以焦耳的倒数作为单位报告 $\\Omega(E)$。最终答案必须是答案框中的一个不带单位的单一表达式。", "solution": "我们从哈密顿量 $H(x,p) = \\frac{p^{2}}{2m} + \\frac{1}{2} m \\omega^{2} x^{2}$ 和微正则定义出发。能量低于 $E$ 的累积相空间体积为\n$$\n\\Gamma(E) = \\frac{1}{h} \\iint \\Theta\\!\\big(E - H(x,p)\\big) \\, dx \\, dp,\n$$\n微正则态密度为\n$$\n\\Omega(E) = \\frac{d\\Gamma}{dE}.\n$$\n\n对于一个单自由度的系统，区域 $\\{(x,p): H(x,p) \\le E\\}$ 是相平面中等能线 $H(x,p) = E$ 的内部。对于谐振子，方程 $H(x,p) = E$ 描述了一个椭圆：\n$$\n\\frac{p^{2}}{2m} + \\frac{1}{2} m \\omega^{2} x^{2} = E.\n$$\n为了求其半轴，令 $x=0$ 得到最大动量大小 $|p| = p_{\\max} = \\sqrt{2 m E}$，并令 $p=0$ 得到最大坐标大小 $|x| = x_{\\max} = \\sqrt{\\frac{2E}{m \\omega^{2}}}$。该椭圆的面积 $A(E)$ 是 $\\pi$ 与半轴的乘积：\n$$\nA(E) = \\pi \\, x_{\\max} \\, p_{\\max} \\;=\\; \\pi \\, \\sqrt{\\frac{2E}{m \\omega^{2}}} \\, \\sqrt{2 m E} \\;=\\; \\pi \\, \\frac{2E}{\\omega} \\;=\\; \\frac{2\\pi E}{\\omega}.\n$$\n从几何上看，累积相空间体积是该面积除以 $h$：\n$$\n\\Gamma(E) = \\frac{A(E)}{h} = \\frac{1}{h} \\cdot \\frac{2\\pi E}{\\omega} = \\frac{2\\pi}{\\omega h} \\, E.\n$$\n对 $E$ 求导得到微正则态密度：\n$$\n\\Omega(E) = \\frac{d\\Gamma}{dE} = \\frac{2\\pi}{\\omega h}.\n$$\n\n这个结果也可以用作用量 $J(E) = \\frac{1}{2\\pi} \\oint p \\, dx = \\frac{A(E)}{2\\pi}$ 来解释，对于谐振子，它等于 $J(E) = \\frac{E}{\\omega}$。于是\n$$\n\\Omega(E) = \\frac{d}{dE}\\!\\left(\\frac{A(E)}{h}\\right) = \\frac{2\\pi}{h} \\frac{dJ}{dE} = \\frac{2\\pi}{h} \\cdot \\frac{1}{\\omega} = \\frac{2\\pi}{\\omega h}.\n$$\n两种方法都表明 $\\Omega(E)$ 与 $E$ 和 $m$ 无关，并且在每个相空间面积 $h$ 对应一个态的约定下，其单位是能量的倒数。\n\n因此，闭式解析表达式为\n$$\n\\Omega(E) = \\frac{2\\pi}{\\omega h}.\n$$", "answer": "$$\\boxed{\\frac{2\\pi}{\\omega h}}$$", "id": "2764571"}, {"introduction": "在谐振子模型的基础上，本练习通过考察其轨道稳定性，进一步深入探讨了轨道动力学。您将推导基本解矩阵，这是一个控制微小扰动随时间演化的关键工具，它能帮助我们洞察相空间中相邻轨道是如何发散或收敛的 [@problem_id:2764593]。", "problem": "考虑一个分子的束缚振动的单一简正模，该振动被建模为一维谐振子，其哈密顿量为 $H(x,p)=\\frac{p^{2}}{2m}+\\frac{1}{2}m\\omega^{2}x^{2}$，其中 $m$ 是质量，$\\omega$ 是角频率。设相空间状态在正则坐标下为 $z(t)=(x(t),p(t))^{\\mathsf{T}}$。围绕任意参考轨迹 $z^{\\ast}(t)$ 的一个微小相空间位移记为 $\\delta z(t)=(\\delta x(t),\\delta p(t))^{\\mathsf{T}}$。\n\n仅从哈密顿方程和基本解（状态转移）矩阵 $\\Phi(t)$ 的定义（即对于所有足够小的 $\\delta z(0)$，满足 $\\delta z(t)=\\Phi(t)\\,\\delta z(0)$ 的线性映射）出发，完成以下任务：\n\n- 推导 $\\Phi(t)$ 的显式形式。\n- 使用您的结果，将一个任意小的相空间位移 $\\delta z(0)=(\\delta x_{0},\\delta p_{0})^{\\mathsf{T}}$ 传播一个周期 $T=\\frac{2\\pi}{\\omega}$，以得到 $\\delta z(T)$。\n\n请将经过一个周期后传播的位移 $\\delta z(T)$ 作为您的最终答案，并以包含 $\\delta x_{0}$ 和 $\\delta p_{0}$ 的单个行矩阵形式表示。不需要进行数值计算，最终答案中不应包含任何单位。", "solution": "本题要求推导一维谐振子的基本解矩阵（或称状态转移矩阵）$\\Phi(t)$，并应用该矩阵来传播一个微小的相空间位移经过一个周期。整个推导过程必须源于哈密顿运动方程。\n\n该系统的哈密顿量为：\n$$H(x,p) = \\frac{p^2}{2m} + \\frac{1}{2}m\\omega^2x^2$$\n其中 $m$ 是质量，$\\omega$ 是角频率， $x$ 是位置， $p$ 是动量。\n\n首先，我们写出哈密顿运动方程：\n$$\\dot{x} = \\frac{\\partial H}{\\partial p} = \\frac{p}{m}$$\n$$\\dot{p} = -\\frac{\\partial H}{\\partial x} = -m\\omega^2x$$\n这些方程可以为相空间矢量 $z(t)=(x(t), p(t))^{\\mathsf{T}}$ 表示为矩阵形式。\n$$\\frac{d}{dt} \\begin{pmatrix} x \\\\ p \\end{pmatrix} = \\begin{pmatrix} 0  \\frac{1}{m} \\\\ -m\\omega^2  0 \\end{pmatrix} \\begin{pmatrix} x \\\\ p \\end{pmatrix}$$\n这是一个线性一阶常微分方程组，可以简写为 $\\dot{z}(t) = Kz(t)$，其中 $K$ 是常系数矩阵：\n$$K = \\begin{pmatrix} 0  \\frac{1}{m} \\\\ -m\\omega^2  0 \\end{pmatrix}$$\n本题考虑围绕一个参考轨迹 $z^*(t)$ 的一个微小位移 $\\delta z(t)$。我们定义 $x(t) = x^*(t) + \\delta x(t)$ 和 $p(t) = p^*(t) + \\delta p(t)$。将这些代入哈密顿方程得到：\n$$\\frac{d}{dt}(x^*(t) + \\delta x(t)) = \\frac{p^*(t) + \\delta p(t)}{m}$$\n$$\\frac{d}{dt}(p^*(t) + \\delta p(t)) = -m\\omega^2(x^*(t) + \\delta x(t))$$\n展开并整理：\n$$\\dot{x}^*(t) + \\delta \\dot{x}(t) = \\frac{p^*(t)}{m} + \\frac{\\delta p(t)}{m}$$\n$$\\dot{p}^*(t) + \\delta \\dot{p}(t) = -m\\omega^2 x^*(t) - m\\omega^2 \\delta x(t)$$\n由于参考轨迹 $z^*(t)$ 本身就是哈密顿方程的一个解，它必须满足 $\\dot{x}^*(t) = p^*(t)/m$ 和 $\\dot{p}^*(t) = -m\\omega^2 x^*(t)$。从上述方程中减去这些，便得到位移 $\\delta z(t)$ 的运动方程：\n$$\\delta \\dot{x}(t) = \\frac{\\delta p(t)}{m}$$\n$$\\delta \\dot{p}(t) = -m\\omega^2 \\delta x(t)$$\n以矩阵形式表示，我们有：\n$$\\frac{d}{dt} \\begin{pmatrix} \\delta x \\\\ \\delta p \\end{pmatrix} = \\begin{pmatrix} 0  \\frac{1}{m} \\\\ -m\\omega^2  0 \\end{pmatrix} \\begin{pmatrix} \\delta x \\\\ \\delta p \\end{pmatrix}$$\n这就是方程 $\\delta\\dot{z}(t) = K \\delta z(t)$。矩阵 $K$ 是常数且独立于参考轨迹 $z^*(t)$，这是谐振子的一个特殊性质，源于其二次型的哈密顿量。\n\n该线性系统的解由 $\\delta z(t) = \\exp(Kt) \\delta z(0)$ 给出。基本解矩阵 $\\Phi(t)$ 由关系式 $\\delta z(t) = \\Phi(t) \\delta z(0)$ 定义。因此，我们必须计算矩阵指数 $\\Phi(t) = \\exp(Kt)$。\n\n为计算 $\\exp(Kt)$，我们首先分析矩阵 $K$ 的幂：\n$$K^2 = \\begin{pmatrix} 0  \\frac{1}{m} \\\\ -m\\omega^2  0 \\end{pmatrix} \\begin{pmatrix} 0  \\frac{1}{m} \\\\ -m\\omega^2  0 \\end{pmatrix} = \\begin{pmatrix} -\\omega^2  0 \\\\ 0  -\\omega^2 \\end{pmatrix} = -\\omega^2 I$$\n其中 $I$ 是 $2 \\times 2$ 单位矩阵。\n利用此结果，更高次的幂为：\n$K^3 = K \\cdot K^2 = -\\omega^2 K$\n$K^4 = (K^2)^2 = (-\\omega^2 I)^2 = \\omega^4 I$\n$K^5 = -\\omega^4 K$\n以此类推。\n\n矩阵指数的泰勒级数展开为：\n$$\\exp(Kt) = \\sum_{n=0}^{\\infty} \\frac{(Kt)^n}{n!} = I + Kt + \\frac{K^2t^2}{2!} + \\frac{K^3t^3}{3!} + \\frac{K^4t^4}{4!} + \\dots$$\n我们可以将 $K$ 的偶次幂项（与 $I$ 成比例）和 $K$ 的奇次幂项（与 $K$ 成比例）分组：\n$$\\exp(Kt) = I \\left(1 - \\frac{\\omega^2 t^2}{2!} + \\frac{\\omega^4 t^4}{4!} - \\dots \\right) + K \\left(t - \\frac{\\omega^2 t^3}{3!} + \\frac{\\omega^4 t^5}{5!} - \\dots \\right)$$\n括号中的第一个级数是 $\\cos(\\omega t)$ 的泰勒级数。第二个级数可以改写为：\n$$\\frac{1}{\\omega} \\left(\\omega t - \\frac{(\\omega t)^3}{3!} + \\frac{(\\omega t)^5}{5!} - \\dots \\right) = \\frac{1}{\\omega} \\sin(\\omega t)$$\n因此，矩阵指数的表达式变为：\n$$\\exp(Kt) = I \\cos(\\omega t) + \\frac{K}{\\omega} \\sin(\\omega t)$$\n代入矩阵 $I$ 和 $K$ 得到 $\\Phi(t)$ 的显式形式：\n$$\\Phi(t) = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} \\cos(\\omega t) + \\frac{1}{\\omega} \\begin{pmatrix} 0  \\frac{1}{m} \\\\ -m\\omega^2  0 \\end{pmatrix} \\sin(\\omega t)$$\n$$\\Phi(t) = \\begin{pmatrix} \\cos(\\omega t)  0 \\\\ 0  \\cos(\\omega t) \\end{pmatrix} + \\begin{pmatrix} 0  \\frac{1}{m\\omega} \\sin(\\omega t) \\\\ -m\\omega \\sin(\\omega t)  0 \\end{pmatrix}$$\n$$\\Phi(t) = \\begin{pmatrix} \\cos(\\omega t)  \\frac{1}{m\\omega} \\sin(\\omega t) \\\\ -m\\omega \\sin(\\omega t)  \\cos(\\omega t) \\end{pmatrix}$$\n这便完成了本题的第一部分。\n\n对于第二部分，我们必须将一个任意小的初始位移 $\\delta z(0) = (\\delta x_0, \\delta p_0)^{\\mathsf{T}}$ 传播一个周期 $T = \\frac{2\\pi}{\\omega}$。我们需要计算 $\\delta z(T) = \\Phi(T) \\delta z(0)$。\n首先，我们计算矩阵 $\\Phi(t)$ 在 $t=T$ 时的值：\n$$\\omega T = \\omega \\left(\\frac{2\\pi}{\\omega}\\right) = 2\\pi$$\n三角函数变为：\n$$\\cos(\\omega T) = \\cos(2\\pi) = 1$$\n$$\\sin(\\omega T) = \\sin(2\\pi) = 0$$\n将这些值代入 $\\Phi(t)$ 的表达式中：\n$$\\Phi(T) = \\begin{pmatrix} \\cos(2\\pi)  \\frac{1}{m\\omega} \\sin(2\\pi) \\\\ -m\\omega \\sin(2\\pi)  \\cos(2\\pi) \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} = I$$\n经过一个完整周期后，状态转移矩阵是单位矩阵。\n因此，传播后的位移是：\n$$\\delta z(T) = \\Phi(T) \\delta z(0) = I \\delta z(0) = \\delta z(0)$$\n$$\\begin{pmatrix} \\delta x(T) \\\\ \\delta p(T) \\end{pmatrix} = \\begin{pmatrix} \\delta x_0 \\\\ \\delta p_0 \\end{pmatrix}$$\n这个结果表明，对于谐振子，任何偏离参考轨迹的小位移在经过一个周期后都会回到其自身。传播后的位移矢量与初始位移矢量相同。以行矩阵形式表示，即为 $(\\delta x_0, \\delta p_0)$。", "answer": "$$\\boxed{\\begin{pmatrix} \\delta x_{0}  \\delta p_{0} \\end{pmatrix}}$$", "id": "2764593"}, {"introduction": "现在，我们从解析计算过渡到研究复杂非线性系统所必需的现代计算技术。这个编程练习要求您数值计算鞍周期轨道的稳定与不稳定流形，并将其在庞加莱截面上的交点可视化，这些技能可直接应用于化学反应动力学建模和探索混沌行为 [@problem_id:2764612]。", "problem": "考虑一个无量纲单位下的两自由度哈密顿系统，其哈密顿量定义为\n$$\nH(q_1,q_2,p_1,p_2) \\;=\\; \\tfrac{1}{2}\\,p_1^2 \\;+\\; \\tfrac{1}{2}\\,p_2^2 \\;+\\; \\left(\\tfrac{b}{4}\\,q_1^4 \\;-\\; \\tfrac{a}{2}\\,q_1^2\\right) \\;+\\; \\tfrac{\\omega^2}{2}\\,q_2^2,\n$$\n其中 $a0$、$b0$ 和 $\\omega0$ 是参数。该哈密顿量模拟了一个可分离的鞍-心系统：沿 $q_1$ 方向是一个由四次项正则化的倒置二次型（在 $q_1=0$ 附近为鞍点），而沿 $q_2$ 方向是一个谐振子。运动方程由哈密顿方程导出，\n$$\n\\dot{q}_i \\;=\\; \\frac{\\partial H}{\\partial p_i}, \\qquad \\dot{p}_i \\;=\\; -\\,\\frac{\\partial H}{\\partial q_i}, \\qquad i\\in\\{1,2\\}.\n$$\n在固定能量 $E0$ 下，通过将鞍点自由度冻结在平衡点并让中心自由度振荡，可以得到一个鞍点周期轨道。具体而言，该周期轨道由 $q_1(t)=0$、$p_1(t)=0$ 以及 $q_2$ 子系统中的谐振运动给出，其振幅由能量约束 $H=E$ 确定。对于给定的 $E$，沿周期轨道，$q_2$ 振子的振幅 $A$ 满足 $E=\\tfrac{1}{2}\\,p_2^2+\\tfrac{\\omega^2}{2}\\,q_2^2$，由此得到振幅 $A=\\sqrt{2E}/\\omega$ 和周期 $T=2\\pi/\\omega$。\n\n在鞍点方向 $q_1$ 上，围绕 $(q_1,p_1)=(0,0)$ 进行线性化，得到双曲特征值对 $\\pm \\lambda$（其中 $\\lambda=\\sqrt{a}$）以及与不稳定和稳定流形相切的相应线性特征向量，\n$$\nv_u \\propto (q_1,p_1)=(1,\\lambda), \\qquad v_s \\propto (q_1,p_1)=(1,-\\lambda).\n$$\n对于足够小的微扰幅度 $\\delta0$，通过将 $\\delta\\,v_u$ 加到周期轨道上的一个点而构造的初始条件位于不稳定流形上，并随着 $t\\to +\\infty$ 指数级地偏离；而加上 $\\delta\\,v_s$ 则得到当 $t\\to +\\infty$ 时趋近于周期轨道的初始条件；等价地，当时间反向积分时，这些初始条件位于稳定流形上。\n\n定义庞加莱截面为平面 $q_2=0$，穿越条件为 $p_20$。稳定和不稳定流形与该截面的交集是 $(q_1,p_1)$ 平面中的一维曲线。对于上述可分离哈密顿量，这些曲线表现出时间反演对称性：在给定的振荡器相位下，不稳定流形和稳定流形交点的 $q_1$ 坐标相同，而 $p_1$ 坐标符号相反，这意味着它们的 $p_1$ 绝对值相等。\n\n你的任务是实现一个程序，该程序能够：\n- 使用哈密顿方程和数值积分，对一组能量计算不稳定流形（通过正向时间积分）和稳定流形（通过反向时间积分）与庞加莱截面 $q_2=0$ 且 $p_20$ 的前 $M$ 个交点。\n- 在能量参数 $E$ 上采用数值延拓，方法是处理一个递增的能量列表，并对每个 $E$ 构造相应的周期轨道初始条件（相位为 $q_2=A, p_2=0$，其中 $A=\\sqrt{2E}/\\omega$），然后分别沿 $v_u$ 和 $v_s$ 方向施加一个固定的微小扰动 $\\delta$ 来生成不稳定流形和稳定流形。\n- 通过为每个能量 $E$ 计算以下度量，来量化截面上不稳定流形和稳定流形交点之间的一致性：\n$$\n\\Delta(E) \\;=\\; \\max_{k=1,\\dots,M} \\left( \\left|\\, q_{1,u}^{(k)} - q_{1,s}^{(k)} \\,\\right| \\;+\\; \\left|\\, \\left|p_{1,u}^{(k)}\\right| - \\left|p_{1,s}^{(k)}\\right| \\,\\right| \\right),\n$$\n其中 $\\left(q_{1,u}^{(k)},p_{1,u}^{(k)}\\right)$ 和 $\\left(q_{1,s}^{(k)},p_{1,s}^{(k)}\\right)$ 分别是按积分绝对时间的增序排列的不稳定流形和稳定流形的第 $k$ 个交点。\n- 报告指定测试套件的 $\\Delta(E)$ 值。\n\n全程使用无量纲单位。角度（当由振荡相位隐含时）以弧度为单位。使用一个可以检测庞加莱截面 $q_2=0$ 并筛选出 $p_20$ 的穿越的事件来实现数值积分。选择足够小的容差以精确地解析截面。\n\n待使用的测试套件和参数：\n- 系统参数：$a=1$, $b=1$, $\\omega=1$。\n- 微扰幅度：沿线性特征向量 $v_u=(1,\\lambda)$, $v_s=(1,-\\lambda)$（其中 $\\lambda=\\sqrt{a}$）为 $\\delta=10^{-9}$，经缩放后加到 $(q_1,p_1)$ 上的微扰为 $(\\delta, \\pm \\lambda\\,\\delta)$。\n- 每个流形记录的交点数：$M=2$。\n- 每个方向的最大积分时限：$T_{\\max}=12$。\n- 数值积分器绝对容差 $10^{-12}$ 和相对容差 $10^{-10}$。\n- 能量值（数值延拓集）：$E\\in\\{10^{-6},\\,10^{-3},\\,5\\times 10^{-2},\\,10^{-1}\\}$。\n\n编程要求：\n- 使用任何现代编程语言实现以上内容；但是，你的最终答案必须是一个单一、完整、可运行的 Python $3.12$ 程序，仅使用标准库以及指定版本的 NumPy 和 Scientific Python (SciPy)。\n- 你的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，列表中的每个条目对应于测试套件中相应能量的 $\\Delta(E)$ 值，并格式化为具有精确 10 位有效数字的科学记数法（例如，$1.2345678900\\mathrm{e}{-03}$）。\n\n最终输出格式必须严格如下：\n\"[d1,d2,d3,d4]\"\n其中 $d1$、$d2$、$d3$ 和 $d4$ 分别是 $E=10^{-6}$、$E=10^{-3}$、$E=5\\times 10^{-2}$ 和 $E=10^{-1}$ 时 $\\Delta(E)$ 的值，每个值均按规定以具有 10 位有效数字的科学记数法打印。", "solution": "所述问题定义明确、科学上合理且计算上可行。它描述了非线性动力学中分析鞍点附近相空间结构的标准流程。所有参数和条件都以足够的精度指定。因此，该问题被认为是有效的，我们着手进行求解。\n\n该系统由一个两自由度哈密顿量控制：\n$$\nH(q_1,q_2,p_1,p_2) = \\tfrac{1}{2}\\,p_1^2 + \\tfrac{1}{2}\\,p_2^2 + \\left(\\tfrac{b}{4}\\,q_1^4 - \\tfrac{a}{2}\\,q_1^2\\right) + \\tfrac{\\omega^2}{2}\\,q_2^2\n$$\n运动方程由哈密顿方程 $\\dot{q}_i = \\partial H / \\partial p_i$ 和 $\\dot{p}_i = - \\partial H / \\partial q_i$ 导出。对于状态向量 $y = (q_1, q_2, p_1, p_2)$，这得到以下一阶常微分方程组：\n$$\n\\frac{d}{dt}\n\\begin{pmatrix}\nq_1 \\\\\nq_2 \\\\\np_1 \\\\\np_2\n\\end{pmatrix}\n=\n\\begin{pmatrix}\np_1 \\\\\np_2 \\\\\na q_1 - b q_1^3 \\\\\n-\\omega^2 q_2\n\\end{pmatrix}\n$$\n必须对这些方程进行数值积分，以找到构成鞍点周期轨道的稳定和不稳定流形的轨迹。问题指定使用科学计算库 SciPy 来完成此任务。`solve_ivp` 函数是合适的，并且选择了一种高阶自适应步长积分器，如 8(5,3) 阶的 Dormand-Prince 方法 (`DOP853`)，以满足指定的绝对容差 $10^{-12}$ 和相对容差 $10^{-10}$ 的精度要求。\n\n任务的核心是找到这些流形与由 $q_2 = 0$ 和穿越条件 $p_2 > 0$ 定义的庞加莱截面的交点。这通过使用 `solve_ivp` 函数的事件检测功能来完成。定义一个事件函数来监视 $q_2$ 的值；该函数的根表示轨迹已穿越平面 $q_2 = 0$。积分完成后，对得到的事件点进行筛选，只保留那些满足 $p_2 > 0$ 的点。\n\n对于测试套件中的每个能量 $E$，其流程如下：\n$1$. 设置参数：$a=1, b=1, \\omega=1$。这意味着稳定性指数 $\\lambda = \\sqrt{a} = 1$。微扰幅度固定为 $\\delta = 10^{-9}$。\n\n$2$. 构造流形轨迹的初始条件。基点位于谐振子转折处的周期轨道上，即 $(q_1, q_2, p_1, p_2) = (0, A, 0, 0)$，其中振幅为 $A = \\sqrt{2E}/\\omega$。然后，该点在鞍点方向 $(q_1, p_1)$ 上受到微扰。\n- 对于不稳定流形 ($W^u$)：初始状态为 $y_0^u = (\\delta, A, \\lambda\\delta, 0)$。系统在时间区间 $[0, T_{\\max}]$ 上进行正向时间积分。\n- 对于稳定流形 ($W^s$)：初始状态为 $y_0^s = (\\delta, A, -\\lambda\\delta, 0)$。系统在时间区间 $[0, -T_{\\max}]$ 上进行反向时间积分。\n\n$3$. 在积分过程中，记录每个流形与庞加莱截面的前 $M=2$ 个穿越。将得到的交点 $(q_{1,u}^{(k)}, p_{1,u}^{(k)})$ 和 $(q_{1,s}^{(k)}, p_{1,s}^{(k)})$（其中 $k \\in \\{1, 2\\}$）存储起来。\n\n$4$. 这个特定哈密顿量的一个关键方面是其可分离性，即 $H = H_1(q_1, p_1) + H_2(q_2, p_2)$。这种自由度的解耦在 $(q_1, p_1)$ 子空间的动力学上强加了强时间反演对称性。具体来说，如果该子空间中的一条轨迹由 $(q_1(t), p_1(t))$ 给出，那么 $(q_1(-t), -p_1(-t))$ 也是一条有效轨迹。稳定流形和不稳定流形的初始条件通过这种对称性相关联：$(q_{1,s}(0), p_{1,s}(0)) = (\\delta, -\\lambda\\delta)$ 和 $(q_{1,u}(0), p_{1,u}(0)) = (\\delta, \\lambda\\delta)$。\n由此可知，这些轨迹通过 $q_{1,s}(t) = q_{1,u}(-t)$ 和 $p_{1,s}(t) = -p_{1,u}(-t)$ 相关联。对于正向和反向积分，交点发生在相同的绝对时间。因此，在第 $k$ 个交点处，我们必须有 $q_{1,s}^{(k)} = q_{1,u}^{(k)}$ 和 $p_{1,s}^{(k)} = -p_{1,u}^{(k)}$。\n\n$5$. 最后，计算度量 $\\Delta(E)$：\n$$\n\\Delta(E) = \\max_{k=1,\\dots,M} \\left( \\left|\\, q_{1,u}^{(k)} - q_{1,s}^{(k)} \\,\\right| + \\left|\\, \\left|p_{1,u}^{(k)}\\right| - \\left|p_{1,s}^{(k)}\\right| \\,\\right| \\right)\n$$\n基于解析对称性，和中的每一项都应该精确为零。即 $|q_{1,u}^{(k)} - q_{1,u}^{(k)}| = 0$ 和 $||p_{1,u}^{(k)}| - |-p_{1,u}^{(k)}|| = 0$。因此，对于所有能量，$\\Delta(E)$ 的精确解析值为 $0$。数值计算出的 $\\Delta(E)$ 值将是一个微小的非零数，它量化了数值积分器累积的误差以及其未能完美保持系统潜在的时间反演对称性的程度。因此，这项计算可作为对数值方法准确性的严格测试。\n\n以下程序实现了这整个流程。它遍历指定的能量，执行数值积分，提取流形交点，计算 $\\Delta(E)$，并按要求格式化结果。", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Computes the deviation between stable and unstable manifold intersections\n    for a separable saddle-center Hamiltonian system.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    a = 1.0\n    b = 1.0\n    omega = 1.0\n    delta = 1e-9\n    M = 2\n    T_max = 12.0\n    atol = 1e-12\n    rtol = 1e-10\n    \n    # Test suite of energies\n    test_cases = [1e-6, 1e-3, 5e-2, 1e-1]\n\n    # --- Hamilton's Equations of Motion ---\n    # State vector y = [q1, q2, p1, p2]\n    def hamiltons_eqs(t, y, a_param, b_param, omega_param):\n        \"\"\"\n        Defines the vector field for the Hamiltonian system.\n        \"\"\"\n        q1, q2, p1, p2 = y\n        dq1_dt = p1\n        dq2_dt = p2\n        dp1_dt = a_param * q1 - b_param * q1**3\n        dp2_dt = -omega_param**2 * q2\n        return [dq1_dt, dq2_dt, dp1_dt, dp2_dt]\n\n    # --- Poincaré Section Event ---\n    def poincare_section(t, y, a_param, b_param, omega_param):\n        \"\"\"\n        Event function to detect crossings of the q2 = 0 plane.\n        \"\"\"\n        return y[1]  # q2 coordinate\n\n    poincare_section.terminal = False  # Continue integration after event\n    poincare_section.direction = 0     # Detect all zero-crossings\n\n    results = []\n    for E in test_cases:\n        # --- Initial Conditions ---\n        lambda_val = np.sqrt(a)\n        A = np.sqrt(2 * E) / omega\n\n        # Initial condition for unstable manifold (W^u)\n        y0_u = np.array([delta, A, lambda_val * delta, 0.0])\n        \n        # Initial condition for stable manifold (W^s)\n        y0_s = np.array([delta, A, -lambda_val * delta, 0.0])\n\n        # --- Unstable Manifold Integration (Forward Time) ---\n        sol_u = solve_ivp(\n            fun=hamiltons_eqs,\n            t_span=(0, T_max),\n            y0=y0_u,\n            method='DOP853',\n            args=(a, b, omega),\n            events=poincare_section,\n            rtol=rtol,\n            atol=atol,\n            dense_output=True\n        )\n\n        # Filter event points for p2  0\n        if sol_u.y_events[0].size > 0:\n            p2_at_events_u = sol_u.y_events[0][:, 3]\n            intersections_u_raw = sol_u.y_events[0][p2_at_events_u > 0]\n            if len(intersections_u_raw) >= M:\n                intersections_u = intersections_u_raw[:M]\n            else:\n                # Handle insufficient intersections if necessary\n                raise RuntimeError(f\"Insufficient unstable manifold intersections for E={E}\")\n        else:\n             raise RuntimeError(f\"No unstable manifold intersections found for E={E}\")\n\n        # --- Stable Manifold Integration (Backward Time) ---\n        sol_s = solve_ivp(\n            fun=hamiltons_eqs,\n            t_span=(0, -T_max),\n            y0=y0_s,\n            method='DOP853',\n            args=(a, b, omega),\n            events=poincare_section,\n            rtol=rtol,\n            atol=atol,\n            dense_output=True\n        )\n\n        # Filter event points for p2  0\n        if sol_s.y_events[0].size > 0:\n            p2_at_events_s = sol_s.y_events[0][:, 3]\n            intersections_s_raw = sol_s.y_events[0][p2_at_events_s > 0]\n            if len(intersections_s_raw) >= M:\n                intersections_s = intersections_s_raw[:M]\n            else:\n                raise RuntimeError(f\"Insufficient stable manifold intersections for E={E}\")\n        else:\n            raise RuntimeError(f\"No stable manifold intersections found for E={E}\")\n\n        # --- Compute the Delta(E) Metric ---\n        q1_u = intersections_u[:, 0]\n        p1_u = intersections_u[:, 2]\n        \n        q1_s = intersections_s[:, 0]\n        p1_s = intersections_s[:, 2]\n\n        delta_k_values = np.abs(q1_u - q1_s) + np.abs(np.abs(p1_u) - np.abs(p1_s))\n        delta_E = np.max(delta_k_values)\n        \n        results.append(delta_E)\n        \n    # --- Format and Print Final Output ---\n    # The format \"{:.10e}\" produces a string with 1 digit before the decimal point\n    # and 10 digits after, for a total of 11 significant figures, matching the example.\n    formatted_results = [f\"{res:.10e}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2764612"}]}