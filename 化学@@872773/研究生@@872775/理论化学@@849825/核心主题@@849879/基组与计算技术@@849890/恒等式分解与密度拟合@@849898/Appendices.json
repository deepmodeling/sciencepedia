{"hands_on_practices": [{"introduction": "密度拟合的核心是一个最小二乘问题，而选择何种度规（即我们如何衡量待最小化的“误差”）是至关重要的。这项练习将引导你亲手推导在两种常见度规——重叠度规和库仑度规——下的拟合系数。通过一个具体的数值算例，你将牢固掌握其背后的数学机制，并理解不同度规如何产生不同的近似结果。[@problem_id:2802051]", "problem": "考虑在辅助基 $\\{\\chi_{P}(\\mathbf{r})\\}_{P=1}^{2}$ 中，对乘积密度 $\\,\\rho(\\mathbf{r}) = \\varphi_{1}(\\mathbf{r})\\,\\varphi_{2}(\\mathbf{r})\\,$ 进行恒等分辨 (RI) 密度拟合 (DF) 近似。设近似为 $\\tilde{\\rho}(\\mathbf{r}) = \\sum_{P=1}^{2} c_{P}\\,\\chi_{P}(\\mathbf{r})$，其中系数 $\\{c_{P}\\}$ 是通过最小化残差相对于一个正定双线性形式 $(\\cdot|\\cdot)_{M}$ 的平方范数来确定的，该双线性形式定义了函数上的一个内积。考虑两种度规：\n\n1. 重叠度规，其形式为 $(f|g)_{S} = \\int f(\\mathbf{r})\\,g(\\mathbf{r})\\,\\mathrm{d}\\mathbf{r}$。\n2. 库仑度规，其形式为 $(f|g)_{J} = \\int\\int f(\\mathbf{r})\\,|\\mathbf{r}-\\mathbf{r}'|^{-1}\\,g(\\mathbf{r}')\\,\\mathrm{d}\\mathbf{r}\\,\\mathrm{d}\\mathbf{r}'$。\n\n设辅助基中的度规矩阵、$\\rho$ 在辅助基上的投影向量以及 $\\rho$ 的自内积由下式给出\n$$\n\\mathbf{S} \\equiv \\big[(\\chi_{P}|\\chi_{Q})_{S}\\big] =\n\\begin{pmatrix}\n1  \\tfrac{1}{5} \\\\\n\\tfrac{1}{5}  \\tfrac{4}{5}\n\\end{pmatrix},\\qquad\n\\mathbf{J} \\equiv \\big[(\\chi_{P}|\\chi_{Q})_{J}\\big] =\n\\begin{pmatrix}\n\\tfrac{3}{2}  \\tfrac{3}{10} \\\\\n\\tfrac{3}{10}  \\tfrac{6}{5}\n\\end{pmatrix},\n$$\n$$\n\\mathbf{d}_{S} \\equiv \\big[(\\chi_{P}|\\rho)_{S}\\big] =\n\\begin{pmatrix}\n\\tfrac{1}{2} \\\\ \\tfrac{1}{10}\n\\end{pmatrix},\\qquad\n\\mathbf{d}_{J} \\equiv \\big[(\\chi_{P}|\\rho)_{J}\\big] =\n\\begin{pmatrix}\n\\tfrac{3}{5} \\\\ \\tfrac{1}{20}\n\\end{pmatrix},\n$$\n$$\nt_{S} \\equiv (\\rho|\\rho)_{S} = \\tfrac{2}{5},\\qquad\nt_{J} \\equiv (\\rho|\\rho)_{J} = \\tfrac{11}{20}.\n$$\n\n从内积空间中最小二乘最小化的定义出发，推导出每种度规下最优 DF 系数的正规方程，并求出相应的最优系数 $\\mathbf{c}_{S}$ 和 $\\mathbf{c}_{J}$。仅使用变分最小化和内积的第一性原理，推导出每种度规下最小化平方误差的表达式，并根据上述数据计算这些最小化平方误差。最后，计算比值\n$$\nR \\equiv \\frac{\\|\\rho - \\tilde{\\rho}_{S}\\|_{S}}{\\|\\rho - \\tilde{\\rho}_{J}\\|_{J}},\n$$\n其中 $\\|\\cdot\\|_{M}$ 是由 $(\\cdot|\\cdot)_{M}$ 导出的范数，$\\tilde{\\rho}_{S}$ 和 $\\tilde{\\rho}_{J}$ 分别是重叠度规和库仑度规下的最优 DF 近似。请将 $R$ 的最终答案表示为精确的代数表达式（不要小数化，也不要包含单位）。", "solution": "我们在由正定双线性形式 $(\\cdot|\\cdot)_{M}$ 导出的希尔伯特空间框架下进行计算，该形式定义了一个内积和相应的范数 $\\|f\\|_{M} \\equiv \\sqrt{(f|f)_{M}}$。给定一个辅助基 $\\{\\chi_{P}\\}_{P=1}^{2}$ 和一个近似 $\\tilde{\\rho} = \\sum_{P} c_{P}\\chi_{P}$，度规 $M$ 下的平方误差为\n$$\nE_{M}^{2}(\\mathbf{c}) \\equiv \\|\\rho - \\tilde{\\rho}\\|_{M}^{2}\n= (\\rho - \\chi \\mathbf{c} \\,|\\, \\rho - \\chi \\mathbf{c})_{M},\n$$\n其中 $\\chi$ 是从系数向量到函数的线性映射，$\\chi \\mathbf{c} \\equiv \\sum_{P} c_{P}\\chi_{P}$。利用双线性性和对称性展开二次型可得\n$$\nE_{M}^{2}(\\mathbf{c}) = (\\rho|\\rho)_{M} - 2\\,\\mathbf{c}^{\\mathsf{T}}\\mathbf{d}_{M} + \\mathbf{c}^{\\mathsf{T}}\\mathbf{M}\\,\\mathbf{c},\n$$\n其中 $\\mathbf{M}$ 是度规矩阵，其元素为 $M_{PQ} = (\\chi_{P}|\\chi_{Q})_{M}$，$\\mathbf{d}_{M}$ 是投影向量，其分量为 $d_{M,P} = (\\chi_{P}|\\rho)_{M}$。最小二乘极小点的平稳性条件是通过将关于 $\\mathbf{c}$ 的梯度设为零得到的：\n$$\n\\frac{\\partial E_{M}^{2}}{\\partial \\mathbf{c}} = -2\\,\\mathbf{d}_{M} + 2\\,\\mathbf{M}\\,\\mathbf{c} = \\mathbf{0}\n\\quad\\Longrightarrow\\quad\n\\mathbf{M}\\,\\mathbf{c} = \\mathbf{d}_{M}.\n$$\n这些就是正规方程。由于 $\\mathbf{M}$ 是对称正定的，唯一的极小点是\n$$\n\\mathbf{c}_{M} = \\mathbf{M}^{-1}\\mathbf{d}_{M}.\n$$\n在极小点处，将 $\\mathbf{c}_{M}$ 代回二次型，得到最小化平方误差：\n$$\nE_{M,\\min}^{2} = (\\rho|\\rho)_{M} - \\mathbf{d}_{M}^{\\mathsf{T}}\\mathbf{c}_{M}\n= t_{M} - \\mathbf{d}_{M}^{\\mathsf{T}}\\,\\mathbf{M}^{-1}\\mathbf{d}_{M}.\n$$\n\n现在我们将这些一般性结果应用于每种度规。\n\n重叠度规。这里 $\\mathbf{M}=\\mathbf{S}$，$\\mathbf{d}_{M}=\\mathbf{d}_{S}$，且 $t_{M}=t_{S}$。首先计算 $\\mathbf{S}^{-1}$。根据\n$$\n\\mathbf{S} =\n\\begin{pmatrix}\n1  \\tfrac{1}{5} \\\\\n\\tfrac{1}{5}  \\tfrac{4}{5}\n\\end{pmatrix},\n\\quad\n\\det(\\mathbf{S}) = 1\\cdot\\tfrac{4}{5} - \\tfrac{1}{5}\\cdot\\tfrac{1}{5} = \\tfrac{19}{25},\n$$\n其逆矩阵为\n$$\n\\mathbf{S}^{-1} = \\frac{1}{\\det(\\mathbf{S})}\n\\begin{pmatrix}\n\\tfrac{4}{5}  -\\tfrac{1}{5} \\\\\n-\\tfrac{1}{5}  1\n\\end{pmatrix}\n= \\frac{25}{19}\n\\begin{pmatrix}\n\\tfrac{4}{5}  -\\tfrac{1}{5} \\\\\n-\\tfrac{1}{5}  1\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\tfrac{20}{19}  -\\tfrac{5}{19} \\\\\n-\\tfrac{5}{19}  \\tfrac{25}{19}\n\\end{pmatrix}.\n$$\n因此\n$$\n\\mathbf{c}_{S} = \\mathbf{S}^{-1}\\mathbf{d}_{S}\n=\n\\begin{pmatrix}\n\\tfrac{20}{19}  -\\tfrac{5}{19} \\\\\n-\\tfrac{5}{19}  \\tfrac{25}{19}\n\\end{pmatrix}\n\\begin{pmatrix}\n\\tfrac{1}{2} \\\\ \\tfrac{1}{10}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\tfrac{19}{38} \\\\ 0\n\\end{pmatrix}.\n$$\n最小化平方误差为\n$$\nE_{S,\\min}^{2} = t_{S} - \\mathbf{d}_{S}^{\\mathsf{T}}\\,\\mathbf{c}_{S}\n= \\tfrac{2}{5} - \\left(\\tfrac{1}{2}\\cdot\\tfrac{19}{38} + \\tfrac{1}{10}\\cdot 0\\right)\n= \\tfrac{2}{5} - \\tfrac{19}{76}.\n$$\n通分后，\n$$\n\\tfrac{2}{5} = \\tfrac{152}{380},\\quad \\tfrac{19}{76} = \\tfrac{95}{380}\n\\;\\Longrightarrow\\;\nE_{S,\\min}^{2} = \\tfrac{152}{380} - \\tfrac{95}{380} = \\tfrac{57}{380} = \\tfrac{3}{20}.\n$$\n\n库仑度规。这里 $\\mathbf{M}=\\mathbf{J}$，$\\mathbf{d}_{M}=\\mathbf{d}_{J}$，且 $t_{M}=t_{J}$。计算 $\\mathbf{J}^{-1}$。根据\n$$\n\\mathbf{J} =\n\\begin{pmatrix}\n\\tfrac{3}{2}  \\tfrac{3}{10} \\\\\n\\tfrac{3}{10}  \\tfrac{6}{5}\n\\end{pmatrix},\n\\quad\n\\det(\\mathbf{J}) = \\tfrac{3}{2}\\cdot\\tfrac{6}{5} - \\left(\\tfrac{3}{10}\\right)^{2}\n= \\tfrac{18}{10} - \\tfrac{9}{100} = \\tfrac{171}{100},\n$$\n其逆矩阵为\n$$\n\\mathbf{J}^{-1} = \\frac{1}{\\det(\\mathbf{J})}\n\\begin{pmatrix}\n\\tfrac{6}{5}  -\\tfrac{3}{10} \\\\\n-\\tfrac{3}{10}  \\tfrac{3}{2}\n\\end{pmatrix}\n= \\frac{100}{171}\n\\begin{pmatrix}\n\\tfrac{6}{5}  -\\tfrac{3}{10} \\\\\n-\\tfrac{3}{10}  \\tfrac{3}{2}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\tfrac{40}{57}  -\\tfrac{10}{57} \\\\\n-\\tfrac{10}{57}  \\tfrac{50}{57}\n\\end{pmatrix}.\n$$\n因此\n$$\n\\mathbf{c}_{J} = \\mathbf{J}^{-1}\\mathbf{d}_{J}\n=\n\\begin{pmatrix}\n\\tfrac{40}{57}  -\\tfrac{10}{57} \\\\\n-\\tfrac{10}{57}  \\tfrac{50}{57}\n\\end{pmatrix}\n\\begin{pmatrix}\n\\tfrac{3}{5} \\\\ \\tfrac{1}{20}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\tfrac{47}{114} \\\\ -\\tfrac{7}{114}\n\\end{pmatrix}.\n$$\n最小化平方误差为\n$$\nE_{J,\\min}^{2} = t_{J} - \\mathbf{d}_{J}^{\\mathsf{T}}\\,\\mathbf{c}_{J}\n= \\tfrac{11}{20} - \\left(\\tfrac{3}{5}\\cdot\\tfrac{47}{114} + \\tfrac{1}{20}\\cdot\\left(-\\tfrac{7}{114}\\right)\\right).\n$$\n计算点积：\n$$\n\\tfrac{3}{5}\\cdot\\tfrac{47}{114} = \\tfrac{141}{570} = \\tfrac{47}{190},\\qquad\n\\tfrac{1}{20}\\cdot\\left(-\\tfrac{7}{114}\\right) = -\\tfrac{7}{2280},\n$$\n所以\n$$\n\\mathbf{d}_{J}^{\\mathsf{T}}\\,\\mathbf{c}_{J} = \\tfrac{47}{190} - \\tfrac{7}{2280}\n= \\frac{47\\cdot 12}{2280} - \\frac{7}{2280} = \\frac{564 - 7}{2280} = \\frac{557}{2280}.\n$$\n因此，\n$$\nE_{J,\\min}^{2} = \\tfrac{11}{20} - \\tfrac{557}{2280}\n= \\frac{11\\cdot 114}{2280} - \\frac{557}{2280}\n= \\frac{1254 - 557}{2280} = \\frac{697}{2280}.\n$$\n\n所要求的误差范数之比为\n$$\nR \\equiv \\frac{\\|\\rho - \\tilde{\\rho}_{S}\\|_{S}}{\\|\\rho - \\tilde{\\rho}_{J}\\|_{J}}\n= \\sqrt{\\frac{E_{S,\\min}^{2}}{E_{J,\\min}^{2}}}\n= \\sqrt{\\frac{\\tfrac{3}{20}}{\\tfrac{697}{2280}}}\n= \\sqrt{\\frac{3}{20}\\cdot\\frac{2280}{697}}\n= \\sqrt{\\frac{6840}{13940}}\n= \\sqrt{\\frac{342}{697}}.\n$$\n这已经是精确的简化代数形式。", "answer": "$$\\boxed{\\sqrt{\\frac{342}{697}}}$$", "id": "2802051"}, {"introduction": "尽管重叠度规在计算上更简单，但与库仑度规相比，它存在一些理论上的缺陷，例如它不能保证通过密度拟合计算得到的哈特里能量是精确能量的一个上界。这个练习要求你构建一个具体的反例来展示这种非变分行为。通过完成这个计算，你将更深刻地体会不同拟合方案之间的理论差异，并理解为何库仑度规在追求稳健和可预测的精度时通常更受青睐。[@problem_id:2802034]", "problem": "在电子结构理论中，对库仑（哈特里）能量进行恒等式解析（RI）和密度拟合（DF）近似时，可以选择使用重叠度规或库仑度规在辅助基组中拟合密度。考虑两个实、正交归一且在空间上良好分离的分子轨道，记为 $\\chi_{a}(\\mathbf{r})$ 和 $\\chi_{b}(\\mathbf{r})$，每个轨道被一个电子占据。目标电子密度为 $\\rho(\\mathbf{r}) = \\chi_{a}(\\mathbf{r})^{2} + \\chi_{b}(\\mathbf{r})^{2}$。哈特里能量由第一性原理定义为\n$$\nJ[\\rho] = \\frac{1}{2} \\iint \\frac{\\rho(\\mathbf{r})\\,\\rho(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\, d\\mathbf{r}\\, d\\mathbf{r}'.\n$$\n给定以下预先计算的、物理上合理的积分：\n- 密度的重叠内积（$L^{2}$度规）：$\\int \\chi_{a}(\\mathbf{r})^{4}\\, d\\mathbf{r} = 0.80$，$\\int \\chi_{b}(\\mathbf{r})^{4}\\, d\\mathbf{r} = 0.70$，以及交叉项 $\\int \\chi_{a}(\\mathbf{r})^{2}\\,\\chi_{b}(\\mathbf{r})^{2}\\, d\\mathbf{r} = 0.05$。\n- 库仑内积（库仑度规）：$(aa|aa) = \\iint \\frac{\\chi_{a}(\\mathbf{r})^{2}\\,\\chi_{a}(\\mathbf{r}')^{2}}{|\\mathbf{r}-\\mathbf{r}'|}\\, d\\mathbf{r}\\, d\\mathbf{r}' = 1.20$，$(bb|bb) = 0.80$，以及 $(aa|bb) = \\iint \\frac{\\chi_{a}(\\mathbf{r})^{2}\\,\\chi_{b}(\\mathbf{r}')^{2}}{|\\mathbf{r}-\\mathbf{r}'|}\\, d\\mathbf{r}\\, d\\mathbf{r}' = 0.05$。所有库仑积分均以哈特里单位 $(E_{h})$ 给出。\n\n假设用于DF的辅助基组由单个函数 $b_{1}(\\mathbf{r}) = \\chi_{a}(\\mathbf{r})^{2}$ 组成。在基于重叠度规的DF中，拟合密度为 $\\rho_{\\text{fit}}(\\mathbf{r}) = c\\, b_{1}(\\mathbf{r})$，其中系数 $c$ 的选择是为了最小化重叠度规中的平方误差，即最小化 $\\int \\left(\\rho(\\mathbf{r}) - c\\,b_{1}(\\mathbf{r})\\right)^{2}\\, d\\mathbf{r}$。然后通过将 $\\rho_{\\text{fit}}$ 代入哈特里泛函来计算DF哈特里能量：\n$$\nJ_{\\text{DF}} = \\frac{1}{2} \\iint \\frac{\\rho_{\\text{fit}}(\\mathbf{r})\\,\\rho_{\\text{fit}}(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\, d\\mathbf{r}\\, d\\mathbf{r}'.\n$$\n\n仅使用给定数据和第一性原理定义，构建这个明确的反例，以证明使用重叠度规的DF方法低估了哈特里能量，并量化其差异\n$$\n\\Delta J \\equiv J_{\\text{DF}} - J_{\\text{exact}},\n$$\n其中 $J_{\\text{exact}} \\equiv J[\\rho]$。将 $\\Delta J$ 以单个实数的形式给出。将最终数值答案四舍五入到四位有效数字。能量以哈特里单位 $(E_{h})$ 表示。", "solution": "首先，我们计算精确的哈特里能量 $J_{\\text{exact}}$。\n精确密度为 $\\rho(\\mathbf{r}) = \\chi_{a}(\\mathbf{r})^{2} + \\chi_{b}(\\mathbf{r})^{2}$。将其代入哈特里能量泛函：\n$$\nJ_{\\text{exact}} = \\frac{1}{2} \\iint \\frac{\\left(\\chi_{a}(\\mathbf{r})^{2} + \\chi_{b}(\\mathbf{r})^{2}\\right)\\left(\\chi_{a}(\\mathbf{r}')^{2} + \\chi_{b}(\\mathbf{r}')^{2}\\right)}{|\\mathbf{r}-\\mathbf{r}'|}\\, d\\mathbf{r}\\, d\\mathbf{r}'\n$$\n展开分子中的乘积得到四项：\n$$\nJ_{\\text{exact}} = \\frac{1}{2} \\left[ \\iint \\frac{\\chi_{a}(\\mathbf{r})^{2}\\chi_{a}(\\mathbf{r}')^{2}}{|\\mathbf{r}-\\mathbf{r}'|}\\, d\\mathbf{r}d\\mathbf{r}' + \\iint \\frac{\\chi_{a}(\\mathbf{r})^{2}\\chi_{b}(\\mathbf{r}')^{2}}{|\\mathbf{r}-\\mathbf{r}'|}\\, d\\mathbf{r}d\\mathbf{r}' + \\iint \\frac{\\chi_{b}(\\mathbf{r})^{2}\\chi_{a}(\\mathbf{r}')^{2}}{|\\mathbf{r}-\\mathbf{r}'|}\\, d\\mathbf{r}d\\mathbf{r}' + \\iint \\frac{\\chi_{b}(\\mathbf{r})^{2}\\chi_{b}(\\mathbf{r}')^{2}}{|\\mathbf{r}-\\mathbf{r}'|}\\, d\\mathbf{r}d\\mathbf{r}' \\right]\n$$\n这些积分对应于所提供的库仑积分。使用标准符号，表达式变为：\n$$\nJ_{\\text{exact}} = \\frac{1}{2} \\left[ (aa|aa) + (aa|bb) + (bb|aa) + (bb|bb) \\right]\n$$\n由于轨道是实的，积分是对称的，即 $(bb|aa) = (aa|bb)$。因此：\n$$\nJ_{\\text{exact}} = \\frac{1}{2} \\left[ (aa|aa) + 2(aa|bb) + (bb|bb) \\right]\n$$\n代入给定的数值：\n$$\nJ_{\\text{exact}} = \\frac{1}{2} \\left[ 1.20 + 2(0.05) + 0.80 \\right] = \\frac{1}{2} \\left[ 1.20 + 0.10 + 0.80 \\right] = \\frac{1}{2} (2.10) = 1.05 \\, E_h\n$$\n接下来，我们确定密度拟合能量 $J_{\\text{DF}}$。这首先需要找到拟合密度 $\\rho_{\\text{fit}}(\\mathbf{r}) = c\\,b_{1}(\\mathbf{r})$ 的系数 $c$。系数 $c$ 是通过最小化重叠度规中的平方误差来确定的：\n$$\nE[c] = \\int \\left(\\rho(\\mathbf{r}) - c\\,b_{1}(\\mathbf{r})\\right)^{2}\\, d\\mathbf{r}\n$$\n为了找到最小值，我们将关于 $c$ 的导数设为零：\n$$\n\\frac{dE}{dc} = \\int 2\\left(\\rho(\\mathbf{r}) - c\\,b_{1}(\\mathbf{r})\\right)(-b_{1}(\\mathbf{r}))\\, d\\mathbf{r} = 0\n$$\n求解 $c$ 得到标准的最小二乘解：\n$$\nc = \\frac{\\int \\rho(\\mathbf{r})\\,b_{1}(\\mathbf{r})\\, d\\mathbf{r}}{\\int b_{1}(\\mathbf{r})^{2}\\, d\\mathbf{r}}\n$$\n我们分别计算分子和分母。辅助函数为 $b_{1}(\\mathbf{r}) = \\chi_{a}(\\mathbf{r})^{2}$。\n分母是：\n$$\n\\int b_{1}(\\mathbf{r})^{2}\\, d\\mathbf{r} = \\int \\left(\\chi_{a}(\\mathbf{r})^{2}\\right)^{2}\\, d\\mathbf{r} = \\int \\chi_{a}(\\mathbf{r})^{4}\\, d\\mathbf{r} = 0.80\n$$\n分子是，代入 $\\rho(\\mathbf{r}) = \\chi_{a}(\\mathbf{r})^{2} + \\chi_{b}(\\mathbf{r})^{2}$：\n$$\n\\int \\rho(\\mathbf{r})\\,b_{1}(\\mathbf{r})\\, d\\mathbf{r} = \\int \\left(\\chi_{a}(\\mathbf{r})^{2} + \\chi_{b}(\\mathbf{r})^{2}\\right)\\chi_{a}(\\mathbf{r})^{2}\\, d\\mathbf{r} = \\int \\chi_{a}(\\mathbf{r})^{4}\\, d\\mathbf{r} + \\int \\chi_{a}(\\mathbf{r})^{2}\\chi_{b}(\\mathbf{r})^{2}\\, d\\mathbf{r}\n$$\n使用所提供的重叠积分：\n$$\n\\int \\rho(\\mathbf{r})\\,b_{1}(\\mathbf{r})\\, d\\mathbf{r} = 0.80 + 0.05 = 0.85\n$$\n现在我们计算系数 $c$：\n$$\nc = \\frac{0.85}{0.80} = \\frac{17}{16} = 1.0625\n$$\n拟合密度为 $\\rho_{\\text{fit}}(\\mathbf{r}) = 1.0625\\, \\chi_{a}(\\mathbf{r})^{2}$。我们现在使用这个拟合密度计算 $J_{\\text{DF}}$：\n$$\nJ_{\\text{DF}} = \\frac{1}{2} \\iint \\frac{\\rho_{\\text{fit}}(\\mathbf{r})\\,\\rho_{\\text{fit}}(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\, d\\mathbf{r}\\, d\\mathbf{r}' = \\frac{1}{2} \\iint \\frac{\\left(c\\,\\chi_{a}(\\mathbf{r})^{2}\\right)\\left(c\\,\\chi_{a}(\\mathbf{r}')^{2}\\right)}{|\\mathbf{r}-\\mathbf{r}'|}\\, d\\mathbf{r}\\, d\\mathbf{r}'\n$$\n$$\nJ_{\\text{DF}} = \\frac{c^{2}}{2} \\iint \\frac{\\chi_{a}(\\mathbf{r})^{2}\\chi_{a}(\\mathbf{r}')^{2}}{|\\mathbf{r}-\\mathbf{r}'|}\\, d\\mathbf{r}\\, d\\mathbf{r}' = \\frac{c^{2}}{2} (aa|aa)\n$$\n代入 $c$ 和 $(aa|aa)$ 的值：\n$$\nJ_{\\text{DF}} = \\frac{(1.0625)^{2}}{2} (1.20) = (1.0625)^{2} (0.60)\n$$\n$$\nJ_{\\text{DF}} = (1.12890625) \\times (0.60) = 0.67734375 \\, E_h\n$$\n最后，我们计算差异 $\\Delta J$：\n$$\n\\Delta J = J_{\\text{DF}} - J_{\\text{exact}} = 0.67734375 - 1.05 = -0.37265625 \\, E_h\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\n\\Delta J \\approx -0.3727 \\, E_h\n$$\n负号证实了在这个构造的例子中，基于重叠度规的密度拟合低估了真实的哈特里能量。", "answer": "$$\n\\boxed{-0.3727}\n$$", "id": "2802034"}, {"introduction": "除了计算能量，量子化学方法的一个关键应用是计算力以进行几何优化，这需要解析核梯度。将密度拟合方法推广到梯度计算，需要对密度拟合能量表达式进行微分，从而引出新的算法挑战。这个问题挑战你像一位量子化学开发者一样思考，通过分析和比较不同算法路径的渐近成本与内存需求，你将学会如何设计一个不仅正确、而且在面对大规模计算时依然高效的算法。[@problem_id:2802050]", "problem": "考虑在密度拟合（也称为恒等分辨）近似下，以原子轨道为基写出的对电子能量的库仑贡献：\n$$\nE_{\\mathrm{J}}^{\\mathrm{DF}} = \\frac{1}{2} \\sum_{P,Q} c_P \\left(V^{-1}\\right)_{PQ} c_Q \\equiv \\frac{1}{2}\\,\\mathbf{c}^{\\top}\\,\\mathbf{V}^{-1}\\,\\mathbf{c},\n$$\n其中 $\\mathbf{V}$ 是辅助基组上的库仑度规，其元素为 $V_{PQ} = (P|Q)$，向量 $\\mathbf{c}$ 的元素为 $c_P = \\sum_{\\mu \\nu} B_{\\mu \\nu}^{P} D_{\\mu \\nu}$，$B_{\\mu \\nu}^{P} = (\\mu \\nu | P)$ 是三中心库仑积分，$D_{\\mu \\nu}$ 是对称密度矩阵。在解析核梯度中，密度拟合特有的项仅源于 $B_{\\mu \\nu}^{P}$ 和 $V_{PQ}$ 的核导数；所有响应贡献都由标准的耦合微扰机制在别处处理，此处无需重复。\n\n设 $N$ 表示原子轨道的数量，$M$ 表示辅助基函数的数量，其典型标度关系为 $M \\sim \\alpha N$，其中 $\\alpha$ 是一个适中的常数。假设：\n- 构建或收缩成批三中心积分导数的代价标度为 $\\mathcal{O}(N^2 M)$，\n- 构建或收缩成批双中心辅助积分导数的代价标度为 $\\mathcal{O}(M^2)$，\n- 存在 Cholesky 分解 $\\mathbf{V} = \\mathbf{L}\\mathbf{L}^{\\top}$，且使用 $\\mathbf{L}$ 进行三角求解的代价为 $\\mathcal{O}(M^2)$，\n- 积分筛选可用，并且不应存储大小为 $\\mathcal{O}(N^2 M)$ 的大型数组，除非不可避免。\n\n你的任务是选择一个算法序列，该序列能以最小的渐近计算代价和适中的内存占用，组装出对解析核梯度的精确密度拟合贡献。每个选项都概述了一个完整的步骤序列；请选择那个既精确又在代价上渐近最优的选项。你可以假设任何标记为“即时计算 (on-the-fly)”的步骤都会对相应的积分进行一次循环，应用筛选并立即将它们收缩到目标量中，而不存储完整的积分张量。\n\n哪个序列是最佳选择？\n\nA. \n- 对度规进行一次分解：计算 $\\mathbf{L}$ 使得 $\\mathbf{V}=\\mathbf{L}\\mathbf{L}^{\\top}$。\n- 通过对 $B_{\\mu \\nu}^{P}$ 进行一次筛选的即时计算遍过程来构建 $\\mathbf{c}$：$c_P \\leftarrow \\sum_{\\mu \\le \\nu} w_{\\mu \\nu} B_{\\mu \\nu}^{P} D_{\\mu \\nu}$，其中 $w_{\\mu \\nu} = 2 - \\delta_{\\mu \\nu}$。\n- 求解 $\\mathbf{L}\\mathbf{L}^{\\top} \\mathbf{y} = \\mathbf{c}$ 以得到 $\\mathbf{y}$，使用两次三角求解。\n- 通过遍历 $(P|Q)'$ 并将 $-\\frac{1}{2}\\sum_{P,Q} y_P y_Q (P|Q)'$ 加到梯度中，来即时累积度规导数项；不形成或存储 $\\mathbf{Y} = \\mathbf{y}\\mathbf{y}^{\\top}$。\n- 通过遍历 $(\\mu \\nu|P)'$ 并将 $\\sum_{\\mu \\nu P} D_{\\mu \\nu} y_P (\\mu \\nu|P)'$ 收缩到梯度中，来即时累积三中心导数项；不形成 $J_{\\mu \\nu}$。\n\nB.\n- 计算并存储“白化”的三中心张量 $\\widetilde{B}_{\\mu \\nu}^{P} = \\sum_Q B_{\\mu \\nu}^{Q} \\left(V^{-1/2}\\right)_{Q P}$。\n- 通过一次筛选的遍过程来构建 $\\widetilde{\\mathbf{c}}$：$\\widetilde{c}_P \\leftarrow \\sum_{\\mu \\nu} \\widetilde{B}_{\\mu \\nu}^{P} D_{\\mu \\nu}$。\n- 直接设置拟合系数为 $\\mathbf{t} \\leftarrow \\widetilde{\\mathbf{c}}$（无三角求解）。\n- 仅使用 $\\widetilde{B}_{\\mu \\nu}^{P}{}'$ 和 $\\mathbf{t}$ 来组装三中心导数项；忽略度规导数项，因为在白化表示中辅助基是正交归一的。\n\nC.\n- 构建并存储完整的三中心张量 $B_{\\mu \\nu}^{P}$。\n- 形成辅助的“库仑加权”矩阵 $K_{P Q} = \\sum_{\\mu \\nu} B_{\\mu \\nu}^{P} D_{\\mu \\nu} B_{\\mu \\nu}^{Q}$。\n- 从 $\\mathbf{V}\\mathbf{y} = \\mathbf{c}$ 中求解 $\\mathbf{y}$。\n- 通过矩阵表达式 $-\\frac{1}{2}\\operatorname{Tr}\\!\\left(\\mathbf{K}\\,\\mathbf{V}^{-1}\\mathbf{V}'\\mathbf{V}^{-1}\\right)$ 来评估度规导数项。\n- 通过首先构建 $W_{\\mu \\nu} = \\sum_Q B_{\\mu \\nu}^{Q} y_Q$，然后在一次额外的筛选遍过程中将 $W_{\\mu \\nu}$ 与 $(\\mu \\nu|P)'$ 收缩来组装三中心导数项。\n\nD.\n- 求解 $\\mathbf{V}\\mathbf{y} = \\mathbf{c}$。\n- 形成并存储辅助外积 $Y_{P Q} = y_P y_Q$。\n- 将度规导数项评估为单个张量收缩 $-\\frac{1}{2}\\sum_{P,Q} Y_{P Q} (P|Q)'$。\n- 显式地构建库仑矩阵 $J_{\\mu \\nu} = \\sum_P B_{\\mu \\nu}^{P} y_P$。\n- 通过遍历 $(\\mu \\nu|P)'$ 并将其与 $J_{\\mu \\nu}$（代替 $D_{\\mu \\nu}$）收缩来组装三中心导数项。\n\n选择一个选项。", "solution": "为了确定最优算法，我们首先推导对核梯度 $\\frac{dE_{\\mathrm{J}}^{\\mathrm{DF}}}{dx}$ 的精确密度拟合贡献的表达式。我们将能量表达式 $E_{\\mathrm{J}}^{\\mathrm{DF}} = \\frac{1}{2} \\mathbf{c}^{\\top} \\mathbf{V}^{-1} \\mathbf{c}$ 关于核坐标 $x$ 求导，并将密度矩阵 $\\mathbf{D}$ 视为常数（其响应在别处处理）。应用乘积法则和链式法则：\n$$\n\\frac{dE_{\\mathrm{J}}^{\\mathrm{DF}}}{dx} = (\\mathbf{c}')^{\\top} \\mathbf{V}^{-1} \\mathbf{c} + \\frac{1}{2} \\mathbf{c}^{\\top} (\\mathbf{V}^{-1})' \\mathbf{c}\n$$\n我们定义一个辅助向量 $\\mathbf{y} = \\mathbf{V}^{-1} \\mathbf{c}$。利用恒等式 $(\\mathbf{V}^{-1})' = -\\mathbf{V}^{-1} \\mathbf{V}' \\mathbf{V}^{-1}$，梯度表达式变为：\n$$\n\\frac{dE_{\\mathrm{J}}^{\\mathrm{DF}}}{dx} = (\\mathbf{c}')^{\\top} \\mathbf{y} - \\frac{1}{2} \\mathbf{y}^{\\top} \\mathbf{V}' \\mathbf{y}\n$$\n其中第一项是三中心贡献，第二项是度规导数贡献。将 $c'_P = \\sum_{\\mu\\nu} (B_{\\mu\\nu}^P)' D_{\\mu\\nu}$ 代入，我们得到最终的梯度表达式：\n$$\n\\frac{dE_{\\mathrm{J}}^{\\mathrm{DF}}}{dx} = \\sum_{\\mu\\nu P} D_{\\mu\\nu} y_P (B_{\\mu\\nu}^P)' - \\frac{1}{2} \\sum_{P,Q} y_P y_Q (P|Q)'\n$$\n一个最优算法必须高效地计算 $\\mathbf{y}$，然后在不存储大型 $\\mathcal{O}(N^2 M)$ 中间产物的情况下组装这两项。主导计算代价应为 $\\mathcal{O}(N^2 M)$。现在我们逐一分析各个选项：\n\n**A.** 此序列正确地计算了梯度的两项。它首先求解 $\\mathbf{V}\\mathbf{y} = \\mathbf{c}$ 得到 $\\mathbf{y}$，然后通过对积分导数进行两次独立的即时（on-the-fly）遍历来组装三中心项和度规项。这种方法避免了存储大型张量，并且其计算代价由积分导数的计算主导，即 $\\mathcal{O}(N^2 M)$。这是精确、高效且内存友好的标准方法。\n\n**B.** 此选项错误地声称在“白化”基中可以忽略度规导数项。白化变换本身是坐标依赖的，其导数贡献被隐藏在变换后的三中心积分导数中。忽略这一项会导致梯度不精确。\n\n**C.** 此选项在几个方面都有缺陷。它建议存储完整的三中心张量，违反了内存约束。它为度规导数项提供了一个不正确的矩阵表达式。最后，它组装三中心项的算法也是不正确的。\n\n**D.** 此选项错误地组装了三中心导数项。它建议将 $(\\mu \\nu|P)'$ 与 $J_{\\mu \\nu} = \\sum_Q B_{\\mu \\nu}^{Q} y_Q$ 收缩，而不是与 $D_{\\mu \\nu}$ 和 $y_P$。这会得到一个不正确的结果。\n\n**结论：** 只有选项 A 描述了一个精确、计算上最优且内存高效的算法，满足问题的所有要求。", "answer": "$$\\boxed{A}$$", "id": "2802050"}]}