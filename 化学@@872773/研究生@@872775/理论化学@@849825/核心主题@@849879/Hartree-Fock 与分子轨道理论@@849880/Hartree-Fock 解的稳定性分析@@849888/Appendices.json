{"hands_on_practices": [{"introduction": "要理解Hartree-Fock（HF）解的稳定性，最清晰的方法是从最简单的模型入手。此练习将复杂的轨道旋转Hessian矩阵简化为一个仅包含单个粒子-空穴对的 $2 \\times 2$ 随机相近似（RPA）问题。通过解析求解这个“玩具模型”，你将亲手推导出稳定解（对应实数频率的振荡）与不稳定解（对应虚数频率的指数增长）之间的根本数学判据，为理解更复杂的系统奠定坚实的理论基础 [@problem_id:2808285]。", "problem": "考虑通过含时 Hartree-Fock (TDHF) 方法（也称为随机相位近似，RPA）对稳态 Hartree-Fock (HF) 解进行线性稳定性分析。在此框架下，围绕 HF 稳态点的小振幅振荡由一个 RPA 本征值问题所描述，该问题由 HF 能量关于轨道旋转的 Hessian 矩阵构建。对于单个粒子-空穴模式，轨道旋转的 Hessian 矩阵简化为标量块结构，相应的 RPA 动力学矩阵成为一个 $2 \\times 2$ 矩阵，其元素为实数标量 $A$ 和 $B$，其中 $A$ 代表对角（直接）块，$B$ 代表耦合（交换）块。假设 $A$ 和 $B$ 是实数，且 $A \\ge 0$，这与 $A$ 作为经库仑项修正的单粒子能隙的物䐈解释一致。\n\n从作为 $2 \\times 2$ 动力学矩阵的标准本征值问题的 RPA 线性响应方程出发：\n\n$$\n\\begin{pmatrix}\nA  B \\\\\n- B  -A\n\\end{pmatrix}\n\\begin{pmatrix}\nX \\\\ Y\n\\end{pmatrix}\n= \\omega\n\\begin{pmatrix}\nX \\\\ Y\n\\end{pmatrix},\n$$\n\n执行以下操作：\n\n1. 推导特征多项式，并解析求解两个本征值 $\\omega_{+}$ 和 $\\omega_{-}$，将其表示为关于 $A$ 和 $B$ 的闭式表达式。\n2. 根据动态稳定的 HF 稳态点具有实数激发频率这一物理要求，推导出 HF 解不稳定的区域，并用 $A$ 和 $|B|$ 表示。\n\n作为最终答案，请提供以 $A$ 和 $B$ 为函数的闭式本征值对 $\\left(\\omega_{+}, \\omega_{-}\\right)$。不需要进行数值计算，也不需要单位。不稳定的条件应在您的推导中加以证明，但不应包含在最终的方框答案中。", "solution": "所提出的问题是在量子化学中用于评估 Hartree-Fock (HF) 基态稳定性的随机相位近似 (RPA) 背景下的一个标准本征值问题。该问题提法明确，科学依据充分，并包含了解答所需的所有信息。下面我将进行推导。\n\nRPA 动力学矩阵如下所示：\n$$\n\\mathbf{M} = \\begin{pmatrix}\nA  B \\\\\n-B  -A\n\\end{pmatrix}\n$$\n其中 $A$ 和 $B$ 是实数标量，且已知 $A \\ge 0$。该矩阵的本征值 $\\omega$ 代表了系统的激发频率。它们通过求解特征方程来确定，该方程由久期行列式导出：\n$$\n\\det(\\mathbf{M} - \\omega\\mathbf{I}) = 0\n$$\n这里，$\\mathbf{I}$ 是 $2 \\times 2$ 单位矩阵。代入矩阵，我们得到：\n$$\n\\det \\begin{pmatrix}\nA - \\omega  B \\\\\n-B  -A - \\omega\n\\end{pmatrix} = 0\n$$\n行列式计算如下：\n$$\n(A - \\omega)(-A - \\omega) - (B)(-B) = 0\n$$\n展开各项，我们得到关于 $\\omega$ 的特征多项式：\n$$\n-(A - \\omega)(A + \\omega) + B^2 = 0\n$$\n$$\n-(A^2 - \\omega^2) + B^2 = 0\n$$\n$$\n-A^2 + \\omega^2 + B^2 = 0\n$$\n重新整理该方程，得到本征值的特征方程：\n$$\n\\omega^2 = A^2 - B^2\n$$\n这是所需推导的第一部分，展示了特征多项式（或者说是最终的本征值方程）。现在我们求解这两个本征值，记为 $\\omega_{+}$ 和 $\\omega_{-}$：\n$$\n\\omega = \\pm \\sqrt{A^2 - B^2}\n$$\n因此，这两个本征值为：\n$$\n\\omega_{+} = \\sqrt{A^2 - B^2}\n$$\n$$\n\\omega_{-} = - \\sqrt{A^2 - B^2}\n$$\n这就完成了第一个任务。\n\n对于第二个任务，我们分析 HF 稳态点的稳定性。线性稳定性分析的一个基本原则是：如果小扰动不随时间指数增长，则一个稳态点是稳定的。在 TDHF/RPA 的背景下，频率为 $\\omega$ 的扰动模式的时间演化与 $\\exp(-i\\omega t)$ 成正比。如果 $\\omega$ 是实数，则该模式振荡，稳态点相对于此模式是稳定的。如果 $\\omega$ 有一个正的虚部，即 $\\omega = \\omega_{\\text{Re}} + i\\omega_{\\text{Im}}$ 且 $\\omega_{\\text{Im}} > 0$，那么时间演化因子变为 $\\exp(-i\\omega_{\\text{Re}}t)\\exp(\\omega_{\\text{Im}}t)$，这会导致指数增长。这标志着不稳定。\n\n我们推导出的本征值为 $\\omega = \\pm \\sqrt{A^2 - B^2}$。\n为使本征值为实数，平方根下的量必须是非负的：\n$$\nA^2 - B^2 \\ge 0\n$$\n这个不等式可以重写为 $A^2 \\ge B^2$。对两边取平方根，并利用给定条件 $A \\ge 0$，我们得到稳定性的条件：\n$$\nA \\ge |B|\n$$\n反之，如果本征值不是实数，则 HF 解是不稳定的。在我们的情况下，当平方根下的量为负时，即发生此种情况：\n$$\nA^2 - B^2  0\n$$\n当此条件成立时，本征值变为纯虚数：\n$$\n\\omega = \\pm i \\sqrt{B^2 - A^2}\n$$\n一个虚数本征值对应于一个指数增长或衰减的模式，这标志着 HF 稳态点的动态不稳定性。因此，HF 解不稳定的区域由以下不等式定义：\n$$\nA^2  B^2\n$$\n再次利用 $A \\ge 0$ 的事实，此条件等价于：\n$$\nA  |B|\n$$\n这就是所要求的不稳定条件。最终答案只需要本征值的表达式。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\sqrt{A^2 - B^2} , - \\sqrt{A^2 - B^2} \\end{pmatrix}}\n$$", "id": "2808285"}, {"introduction": "上一个练习中的抽象矩阵元素 $A$ 和 $B$ 并非凭空而来，它们源自具体的物理量：轨道能级差和双电子积分。本练习将理论与化学现实联系起来，指导你为一个简单的双原子分子构建实际的轨道旋转Hessian矩阵 [@problem_id:2808273]。你将学会如何区分和计算保持自旋对称性的“单重态”微扰和破坏自旋对称性的“三重态”微扰所对应的Hessian，并通过具体数值判断哪种不稳定性（例如，从限制性HF到非限制性HF的转变）更容易发生。", "problem": "一个闭壳层双原子分子在最小基组下由两个空间分子轨道描述：一个双占据成键轨道 $\\phi_{i}$ 和一个未占据反键轨道 $\\phi_{a}$。全文使用原子单位 (Hartree)。Fock 轨道能量差为 $\\Delta \\equiv \\varepsilon_{a} - \\varepsilon_{i} = 0.10$。在这两个轨道之间，唯一不可忽略的双电子积分是 $\\phi_{i}$ 和 $\\phi_{a}$ 密度之间的库仑积分以及 $\\phi_{i}$ 和 $\\phi_{a}$ 之间的交换积分，其值为\n$$(ii|aa) = 0.12, \\quad (ia|ai) = 0.05,$$\n其中 $(pq|rs) \\equiv \\int \\!\\!\\int \\phi_{p}(\\mathbf{r}_{1}) \\phi_{q}(\\mathbf{r}_{1}) \\frac{1}{r_{12}} \\phi_{r}(\\mathbf{r}_{2}) \\phi_{s}(\\mathbf{r}_{2}) \\, d\\mathbf{r}_{1} d\\mathbf{r}_{2}$ 表示化学家标记法中的标准双电子排斥积分。为了本问题的目的，耦合这两个轨道的所有其他双电子积分都可以忽略。\n\n从闭壳层 Hartree–Fock (HF) 能量泛函和轨道的 Thouless 参数化旋转出发，推导在限制性 HF (RHF) 情况下，单个占据-虚拟轨道对的自旋匹配单重态和三重态轨道旋转 Hessian 矩阵，并用 $\\Delta$、$(ii|aa)$ 和 $(ia|ai)$ 表示。使用推导出的表达式构建该系统的数值 $1 \\times 1$ 单重态和三重态 Hessian 矩阵，并计算它们的本征值。\n\n哪个自旋通道（单重态或三重态）具有较低的 Hessian 本征值？将较低的本征值以 Hartree 为单位，作为一个四舍五入到三位有效数字的实数报告。在最终的方框答案中不要包含单位。", "solution": "首先，我们明确问题中给出的物理量和它们在Hartree-Fock稳定性分析中的角色。\n- 轨道能级差：$\\Delta \\equiv \\varepsilon_{a} - \\varepsilon_{i} = 0.10$ a.u.\n- 双电子积分：$(ii|aa) = 0.12$ a.u.，$(ia|ai) = 0.05$ a.u.\n\n限制性Hartree-Fock (RHF) 解的稳定性是通过分析电子Hessian矩阵的本征值来确定的。此Hessian矩阵可以分解为单重态和三重态两个子块。如果任一子块的最低本征值为负，则RHF解不稳定。\n\n在随机相位近似 (RPA) 或含时Hartree-Fock (TDHF) 理论中，Hessian矩阵是一个 $2N \\times 2N$ 的块矩阵，其中 $N$ 是占据-虚轨道对的数量。其形式为：\n$$ \\mathbf{H}_{\\text{RPA}} = \\begin{pmatrix} \\mathbf{A}  \\mathbf{B} \\\\ \\mathbf{B}^*  \\mathbf{A}^* \\end{pmatrix} $$\n对于实轨道，$\\mathbf{A}$ 和 $\\mathbf{B}$ 都是实对称矩阵。一个HF解是稳定的，当且仅当 $\\mathbf{H}_{\\text{RPA}}$ 的所有本征值都是非负的。\n\n对于闭壳层RHF解，可以将旋转分为单重态和三重态。\n单重态块的矩阵元为：\n$$ A^S_{ia,jb} = (\\varepsilon_a - \\varepsilon_i)\\delta_{ij}\\delta_{ab} + 2(ia|jb) - (ib|aj) $$\n$$ B^S_{ia,jb} = 2(ia|jb) - (ij|ab) $$\n三重态块的矩阵元为：\n$$ A^T_{ia,jb} = (\\varepsilon_a - \\varepsilon_i)\\delta_{ij}\\delta_{ab} - (ib|aj) $$\n$$ B^T_{ia,jb} = -(ij|ab) $$\n\n在本问题中，我们只有一个占据轨道 $i$ 和一个虚轨道 $a$，因此Hessian矩阵的单重态和三重态子块都是 $2 \\times 2$ 的。\n\n**单重态稳定性分析**\n$A^S$ 和 $B^S$ 都是 $1 \\times 1$ 矩阵（标量）。\n$$ A^S = (\\varepsilon_a - \\varepsilon_i) + 2(ia|ia) - (ia|ia) = \\Delta + (ia|ai) $$\n$$ B^S = 2(ia|ia) - (ii|aa) = 2(ia|ai) - (ii|aa) $$\n单重态Hessian矩阵为 $\\begin{pmatrix} A^S  B^S \\\\ B^S  A^S \\end{pmatrix}$。其本征值为 $\\lambda_S = A^S \\pm B^S$。\n代入数值：\n$A^S = 0.10 + 0.05 = 0.15$\n$B^S = 2(0.05) - 0.12 = 0.10 - 0.12 = -0.02$\n本征值为：\n$\\lambda_{S,1} = 0.15 + (-0.02) = 0.13$\n$\\lambda_{S,2} = 0.15 - (-0.02) = 0.17$\n两个本征值均为正，所以RHF解对单重态微扰是稳定的。最低的单重态本征值为 $0.13$ a.u.。\n\n**三重态稳定性分析**\n$A^T$ 和 $B^T$ 也是 $1 \\times 1$ 矩阵（标量）。\n$$ A^T = (\\varepsilon_a - \\varepsilon_i) - (ia|ia) = \\Delta - (ia|ai) $$\n$$ B^T = -(ii|aa) $$\n三重态Hessian矩阵为 $\\begin{pmatrix} A^T  B^T \\\\ B^T  A^T \\end{pmatrix}$。其本征值为 $\\lambda_T = A^T \\pm B^T$。\n代入数值：\n$A^T = 0.10 - 0.05 = 0.05$\n$B^T = -0.12$\n本征值为：\n$\\lambda_{T,1} = 0.05 + (-0.12) = -0.07$\n$\\lambda_{T,2} = 0.05 - (-0.12) = 0.17$\n由于出现了一个负本征值（-0.07），RHF解对于三重态微扰是不稳定的。这预示着存在一个能量更低的非限制性Hartree-Fock (UHF) 解。\n\n**结论**\n比较单重态通道的最低本征值（0.13）和三重态通道的最低本征值（-0.07），三重态通道具有更低的Hessian本征值。\n这个值是 $-0.07$ a.u.。报告为三位有效数字，即 $-0.0700$。", "answer": "$$\\boxed{-0.0700}$$", "id": "2808273"}, {"introduction": "在自洽场（SCF）计算中发现不稳定性（即Hessian矩阵出现负本征值）后，下一步该做什么？本练习模拟了理论化学家在实践中面临的核心诊断任务 [@problem_id:2808380]。你将编写程序，不仅是找到最低的本征值，更重要的是通过分析其对应的本征向量，将不稳定性分解为“能隙贡献”和“耦合贡献”两个部分。基于这种诊断，你将学习如何像专家一样做出决策：是由于轨道能级近简并导致的“软”不稳定，适合用能级移动（level-shifting）技术修正；还是由于强电子耦合导致的“硬”不稳定，需要更换初始猜测甚至改变波函数形式来解决。", "problem": "考虑在 Hartree-Fock (HF) 近似下，通过自洽场 (SCF) 程序获得的解的稳定性。一个稳态 HF 解是电子能量相对于轨道旋转的局域极小值，当且仅当二阶变分（轨道旋转海森矩阵）在占据轨道到虚轨道的旋转空间中是半正定的。在一个最小化的抽象模型中，沿实向量 $\\mathbf{x}$ 所代表的旋转方向的二阶能量变化可以写成一个二次型，该二次型由两个贡献组成：来自轨道能量差的对角贡献和来自电子-电子相互作用的耦合贡献。在此抽象模型中，每个测试用例的总二次型由以下几项完全指定：\n- 一组占据轨道能量 $\\{\\varepsilon_i\\}$ 和虚轨道能量 $\\{\\varepsilon_a\\}$，单位均为 Hartree。\n- 一个维度为 $n_{\\text{rot}} \\times n_{\\text{rot}}$ 的对称实数耦合矩阵 $\\mathbf{K}$，其中 $n_{\\text{rot}} = n_{\\text{occ}} \\times n_{\\text{virt}}$，其元素单位为 Hartree。\n- 一个实数标量通道参数 $\\gamma$（无量纲），它编码了耦合在所选稳定性通道中是增加还是减少曲率。\n\n您的程序必须：\n- 使用复合索引 $r = i \\, n_{\\text{virt}} + a$ 将 $(i,a)$ 映射到单个索引 $r \\in \\{0,\\dots,n_{\\text{rot}}-1\\}$，构造对角矩阵 $\\mathbf{D}$，其元素为 $D_{ia,ia} = \\Delta_{ia}$，其中 $\\Delta_{ia} = \\varepsilon_a - \\varepsilon_i$，单位为 Hartree。\n- 组装对称的轨道旋转海森矩阵 $\\mathbf{H}$，使其沿任何实向量 $\\mathbf{x}$ 的二次型等于对角贡献和耦合贡献之和，即 $\\mathbf{x}^\\top \\mathbf{H} \\mathbf{x} = \\mathbf{x}^\\top \\mathbf{D} \\mathbf{x} + \\gamma \\, \\mathbf{x}^\\top \\mathbf{K} \\mathbf{x}$。在计算中使用对称化矩阵 $\\frac{1}{2}(\\mathbf{H} + \\mathbf{H}^\\top)$ 以消除任何数值不对称性。\n- 计算 $\\mathbf{H}$ 的最低（最小）本征值 $\\lambda_{\\min}$ 和相应的归一化本征矢量 $\\mathbf{v}_{\\min}$。将 $\\mathbf{v}_{\\min}$ 归一化为单位 $\\ell_2$ 范数。\n- 基于以下根植于变分原理的逻辑来诊断稳定性并提出补救措施。将沿 $\\mathbf{v}_{\\min}$ 的曲率分解为对角部分和耦合部分：$c_{\\text{gap}} = \\mathbf{v}_{\\min}^\\top \\mathbf{D} \\mathbf{v}_{\\min}$ 和 $c_{\\text{cpl}} = \\mathbf{v}_{\\min}^\\top (\\gamma \\mathbf{K}) \\mathbf{v}_{\\min}$。然后：\n  - 如果 $\\lambda_{\\min}  -0.05$ Hartree 且 $c_{\\text{cpl}}  0$ 且 $\\lvert c_{\\text{cpl}} \\rvert > c_{\\text{gap}} + 0.02$ Hartree，则输出操作代码 $2$（重新初始化；例如，使用不同的初始猜测或对称性破缺的拟设）。\n  - 否则，如果 $\\lambda_{\\min}  0$ Hartree，或 $\\lambda_{\\min} \\le 0.02$ Hartree，或 $c_{\\text{gap}}  0.05$ Hartree，则输出操作代码 $1$（应用能级移动以增加虚轨道能量）。\n  - 否则输出操作代码 $0$（解是稳定的；无需补救）。\n- 报告每个测试用例的最低本征对和建议的操作。所有能量必须以 Hartree 为单位表示并四舍五入到 $6$ 位小数。本征矢量分量是无量纲的，必须四舍五入到 $6$ 位小数。\n\n角度单位不相关。不涉及百分比。\n\n测试套件。请精确使用以下三个测试用例，每个用例均有 $n_{\\text{occ}} = 2$ 和 $n_{\\text{virt}} = 2$（因此 $n_{\\text{rot}} = 4$）。复合旋转索引的排序为 $r = 0 \\leftrightarrow (i=0,a=0)$，$r = 1 \\leftrightarrow (i=0,a=1)$，$r = 2 \\leftrightarrow (i=1,a=0)$，$r = 3 \\leftrightarrow (i=1,a=1)$。\n\n- 案例 1 (能隙分离良好；预期稳定)：\n  - $\\varepsilon_{\\text{occ}} = [-0.50, -0.30]$ Hartree。\n  - $\\varepsilon_{\\text{virt}} = [0.20, 0.50]$ Hartree。\n  - $\\gamma = +0.5$。\n  - $\\mathbf{K}$ (Hartree单位):\n    - 第 0 行：$[0.01, 0.005, 0.004, 0.003]$,\n    - 第 1 行：$[0.005, 0.01, 0.002, 0.004]$,\n    - 第 2 行：$[0.004, 0.002, 0.01, 0.005]$,\n    - 第 3 行：$[0.003, 0.004, 0.005, 0.01]$。\n- 案例 2 (近简并能隙；预期需要能级移动)：\n  - $\\varepsilon_{\\text{occ}} = [-0.50, -0.49]$ Hartree。\n  - $\\varepsilon_{\\text{virt}} = [-0.45, -0.20]$ Hartree。\n  - $\\gamma = -0.4$。\n  - $\\mathbf{K}$ (Hartree单位):\n    - 第 0 行：$[0.10, 0.04, 0.03, 0.02]$,\n    - 第 1 行：$[0.04, 0.08, 0.02, 0.03]$,\n    - 第 2 行：$[0.03, 0.02, 0.09, 0.04]$,\n    - 第 3 行：$[0.02, 0.03, 0.04, 0.07]$。\n- 案例 3 (类三重态强耦合不稳定性；预期重新初始化)：\n  - $\\varepsilon_{\\text{occ}} = [-0.60, -0.50]$ Hartree。\n  - $\\varepsilon_{\\text{virt}} = [0.10, 0.20]$ Hartree。\n  - $\\gamma = -1.0$。\n  - $\\mathbf{K}$ (Hartree单位):\n    - 第 0 行：$[0.20, 0.05, 0.04, 0.03]$,\n    - 第 1 行：$[0.05, 0.20, 0.02, 0.04]$,\n    - 第 2 行：$[0.04, 0.02, 0.75, 0.05]$,\n    - 第 3 行：$[0.03, 0.04, 0.05, 0.20]$。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个列表，该列表内含三个嵌套列表，每个测试用例一个，每个嵌套列表包含：\n- 首先是最低本征值 $\\lambda_{\\min}$，以 Hartree 为单位，四舍五入到 $6$ 位小数，\n- 然后是相应归一化本征矢量 $\\mathbf{v}_{\\min}$ 的 $4$ 个分量，按旋转索引顺序 $[r=0,r=1,r=2,r=3]$ 排列，四舍五入到 $6$ 位小数，\n- 最后是如上定义的整型操作代码。\n\n具体来说，打印的行必须如下所示：\n- $[ [\\lambda^{(1)}_{\\min}, v^{(1)}_0, v^{(1)}_1, v^{(1)}_2, v^{(1)}_3, a^{(1)}], [\\lambda^{(2)}_{\\min}, v^{(2)}_0, v^{(2)}_1, v^{(2)}_2, v^{(2)}_3, a^{(2)}], [\\lambda^{(3)}_{\\min}, v^{(3)}_0, v^{(3)}_1, v^{(3)}_2, v^{(3)}_3, a^{(3)}] ]$\n其中每个 $\\lambda^{(k)}_{\\min}$ 和 $v^{(k)}_r$ 都四舍五入到 $6$ 位小数，每个 $a^{(k)} \\in \\{0,1,2\\}$ 是一个整数。", "solution": "所提出的问题是计算理论化学中一个有效且定义明确的练习。它涉及 Hartree-Fock (HF) 电子结构解的稳定性分析，这是该领域的一个基本课题。所有必要的数据和程序规则均已提供，科学背景合理，目标明确。因此，我们将着手提供一个完整的解决方案。\n\n自洽场 (SCF) 解的稳定性取决于电子能量泛函相对于分子轨道变化的曲率。要使一个解成为局域极小值，能量的二阶变分对于所有允许的变化都必须是非负的。在占据轨道和虚轨道空间之间的轨道旋转背景下，这个二阶变分由轨道旋转海森矩阵表示，此处记为 $\\mathbf{H}$。当且仅当 $\\mathbf{H}$ 是半正定时，解是稳定的。\n\n问题的核心是为几个测试用例构建和分析此海森矩阵。对于一个旋转向量 $\\mathbf{x}$，总能量变化表示为一个二次型 $\\mathbf{x}^\\top \\mathbf{H} \\mathbf{x}$，它由两个不同的物理贡献之和给出：\n1. 一个对角项 $\\mathbf{x}^\\top \\mathbf{D} \\mathbf{x}$，它源于被混合的虚轨道和占据轨道之间的能量差。\n2. 一个耦合项 $\\gamma \\, \\mathbf{x}^\\top \\mathbf{K} \\mathbf{x}$，它解释了由于轨道旋转引起的电子-电子排斥能的变化。\n\n根据问题规范，海森矩阵 $\\mathbf{H}$ 组装如下：\n$$\n\\mathbf{H} = \\mathbf{D} + \\gamma \\mathbf{K}\n$$\n此处，$\\mathbf{D}$ 是一个对角矩阵，其元素是轨道能隙 $D_{rr} = \\Delta_{ia} = \\varepsilon_a - \\varepsilon_i$。索引 $r$ 是一个复合索引，它将轨道索引对 $(i, a)$（占据轨道 $i$，虚轨道 $a$）映射到单个维度 $r = i \\cdot n_{\\text{virt}} + a$。矩阵 $\\mathbf{K}$ 封装了来自双电子积分的耦合效应，而 $\\gamma$ 是一个调节此耦合的标量参数。由于所提供的耦合矩阵 $\\mathbf{K}$ 是对称的，且 $\\mathbf{D}$ 是对角的，因此得到的海森矩阵 $\\mathbf{H}$ 也是对称的。使用对称化形式 $\\frac{1}{2}(\\mathbf{H} + \\mathbf{H}^\\top)$ 的指令是强制对称性的一个良好数值实践，我们遵循了这一点，尽管它对一个已经对称的矩阵没有影响。\n\n通过检查 $\\mathbf{H}$ 的本征值来评估稳定性。如果最低本征值 $\\lambda_{\\min}$ 为负，则海森矩阵不是半正定的，这表明存在一个轨道旋转方向（对应的本征矢量 $\\mathbf{v}_{\\min}$），沿该方向能量会降低。这标志着一种不稳定性，意味着所找到的 SCF 解不是一个真正的能量极小值，而是一个鞍点。\n\n每个测试用例的完整过程如下：\n首先，我们使用提供的占据轨道能量 ($\\varepsilon_i$) 和虚轨道能量 ($\\varepsilon_a$) 以及指定的索引映射来构造对角矩阵 $\\mathbf{D}$。\n其次，我们通过将耦合贡献 $\\gamma \\mathbf{K}$ 添加到 $\\mathbf{D}$ 来组装海森矩阵 $\\mathbf{H}$。\n第三，我们求解矩阵本征值方程 $\\mathbf{H}\\mathbf{v} = \\lambda\\mathbf{v}$ 以找到最低的本征对 $(\\lambda_{\\min}, \\mathbf{v}_{\\min})$。为此，我们利用一个针对实对称矩阵的数值本征求解器，这保证了实数本征值和正交归一的本征矢量。本征矢量 $\\mathbf{v}_{\\min}$ 被归一化为单位 $\\ell_2$ 范数。\n\n最后，我们应用所提供的诊断逻辑，这比简单地检查 $\\lambda_{\\min}$ 的符号更为精细。我们将沿最软模式 $\\mathbf{v}_{\\min}$ 的曲率分解为其组成部分：\n- 能隙贡献：$c_{\\text{gap}} = \\mathbf{v}_{\\min}^\\top \\mathbf{D} \\mathbf{v}_{\\min}$\n- 耦合贡献：$c_{\\text{cpl}} = \\mathbf{v}_{\\min}^\\top (\\gamma \\mathbf{K}) \\mathbf{v}_{\\min}$\n根据定义，$\\lambda_{\\min} = c_{\\text{gap}} + c_{\\text{cpl}}$ 是一个直接的推论。基于 $\\lambda_{\\min}$、$c_{\\text{gap}}$ 和 $c_{\\text{cpl}}$ 的值，我们诊断稳定性并推荐纠正措施。\n\n- **操作 0 (稳定)**：如果解是鲁棒稳定的，则分配此操作，其特征是足够大的正 $\\lambda_{\\min}$ 和一个占主导地位的正能隙贡献 $c_{\\text{gap}}$（阈值：$\\lambda_{\\min} > 0.02$ Hartree 且 $c_{\\text{gap}} \\ge 0.05$ Hartree）。\n- **操作 1 (能级移动)**：推荐用于边缘不稳定性。这种情况的特征是 $\\lambda_{\\min}$ 为小的正值或任何负值，或者能隙贡献 $c_{\\text{gap}}$ 非常小，这表明占据轨道和虚轨道之间的近简并是造成不稳定性的主要原因。能级移动通过人为增加虚轨道能量，是解决此类问题的有效方法。（阈值：$\\lambda_{\\min}  0$ Hartree，或 $\\lambda_{\\min} \\le 0.02$ Hartree，或 $c_{\\text{gap}}  0.05$ Hartree）。\n- **操作 2 (重新初始化)**：保留给严重的不稳定性。其标志是一个大的负本征值（$\\lambda_{\\min}  -0.05$ Hartree），这主要是由一个强的、吸引性的（去稳定化的）耦合项驱动的（$c_{\\text{cpl}}  0$ 且 $\\lvert c_{\\text{cpl}} \\rvert > c_{\\text{gap}} + 0.02$ Hartree）。这表明电子构型存在根本性问题（例如，单重态-三重态不稳定性），需要使用不同的初始猜测进行新的 SCF 计算。\n\n这种结构化的分析能够精确地表征 HF 解的稳定性，并为收敛到真正的能量极小值提供合适的计算策略。我们现在为给定的测试用例实施此过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Hartree-Fock stability analysis problem for a suite of test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: Well-separated gaps; expected stable\n        {\n            \"e_occ\": np.array([-0.50, -0.30]),\n            \"e_virt\": np.array([0.20, 0.50]),\n            \"gamma\": 0.5,\n            \"K\": np.array([\n                [0.01, 0.005, 0.004, 0.003],\n                [0.005, 0.01, 0.002, 0.004],\n                [0.004, 0.002, 0.01, 0.005],\n                [0.003, 0.004, 0.005, 0.01]\n            ])\n        },\n        # Case 2: Near-degenerate gaps; expected need for level-shifting\n        {\n            \"e_occ\": np.array([-0.50, -0.49]),\n            \"e_virt\": np.array([-0.45, -0.20]),\n            \"gamma\": -0.4,\n            \"K\": np.array([\n                [0.10, 0.04, 0.03, 0.02],\n                [0.04, 0.08, 0.02, 0.03],\n                [0.03, 0.02, 0.09, 0.04],\n                [0.02, 0.03, 0.04, 0.07]\n            ])\n        },\n        # Case 3: Triplet-like strong coupling instability; expected reinitialization\n        {\n            \"e_occ\": np.array([-0.60, -0.50]),\n            \"e_virt\": np.array([0.10, 0.20]),\n            \"gamma\": -1.0,\n            \"K\": np.array([\n                [0.20, 0.05, 0.04, 0.03],\n                [0.05, 0.20, 0.02, 0.04],\n                [0.04, 0.02, 0.75, 0.05],\n                [0.03, 0.04, 0.05, 0.20]\n            ])\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        e_occ = case[\"e_occ\"]\n        e_virt = case[\"e_virt\"]\n        gamma = case[\"gamma\"]\n        K = case[\"K\"]\n        \n        n_occ = len(e_occ)\n        n_virt = len(e_virt)\n        n_rot = n_occ * n_virt\n\n        # Construct the diagonal matrix D\n        delta = np.zeros(n_rot)\n        for i in range(n_occ):\n            for a in range(n_virt):\n                r = i * n_virt + a\n                delta[r] = e_virt[a] - e_occ[i]\n        D = np.diag(delta)\n\n        # Assemble the Hessian matrix H\n        H = D + gamma * K\n        \n        # Symmetrize H for numerical stability (as per problem statement)\n        H_sym = 0.5 * (H + H.T)\n        \n        # Compute eigenvalues and eigenvectors\n        # np.linalg.eigh returns eigenvalues in ascending order\n        eigenvalues, eigenvectors = np.linalg.eigh(H_sym)\n        \n        lambda_min = eigenvalues[0]\n        v_min = eigenvectors[:, 0]\n        \n        # Diagnose stability and propose remedy\n        c_gap = v_min.T @ D @ v_min\n        c_cpl = v_min.T @ (gamma * K) @ v_min\n        \n        action_code = 0  # Default to stable\n        \n        # Rule for Action 2\n        if lambda_min  -0.05 and c_cpl  0 and np.abs(c_cpl) > c_gap + 0.02:\n            action_code = 2\n        # Rule for Action 1\n        elif lambda_min  0 or lambda_min = 0.02 or c_gap  0.05:\n            action_code = 1\n        \n        # Format results for the current case\n        case_result = []\n        case_result.append(round(lambda_min, 6))\n        for component in v_min:\n            case_result.append(round(component, 6))\n        case_result.append(action_code)\n        \n        results.append(case_result)\n\n    # Final print statement in the exact required format.\n    # To avoid space after commas inside inner lists:\n    formatted_results = []\n    for res in results:\n        res_str = f\"[{res[0]:.6f},{res[1]:.6f},{res[2]:.6f},{res[3]:.6f},{res[4]:.6f},{res[5]}]\"\n        formatted_results.append(res_str)\n    \n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2808380"}]}