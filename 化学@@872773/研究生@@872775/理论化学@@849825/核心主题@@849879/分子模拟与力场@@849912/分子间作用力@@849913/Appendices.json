{"hands_on_practices": [{"introduction": "感应相互作用是分子间力的一个关键组成部分，尤其是在涉及离子或强极性分子的体系中。虽然各向同性极化率是一个有用的初步近似，但真实分子的电子云在空间上并非均匀分布，呈现出各向异性。本练习将引导你从第一性原理出发，推导一个离子与各向异性分子之间的感应能，旨在锻炼你应用经典静电学和张量代数来解决实际化学问题的基本功。[@problem_id:2781319]", "problem": "一个电荷为 $q$ 的离子被固定在距离一个中性、刚性、各向异性分子质心 $R$ 处，该分子的电子极化率张量在其主轴坐标系中是对角的，$\\boldsymbol{\\alpha} = \\mathrm{diag}(\\alpha_{x}, \\alpha_{y}, \\alpha_{z})$。分子相对于离子保持固定取向，使得从分子指向离子的单位向量 $\\hat{\\mathbf{R}}$ 相对于分子主轴的方向余弦为 $(\\ell, m, n)$，其中 $\\ell^{2} + m^{2} + n^{2} = 1$。假设相互作用发生在真空中，其介电常数为 $\\varepsilon_{0}$，并忽略所有永久多极矩和高阶响应项。\n\n从以下基础出发：\n- 真空中点电荷电场的库仑定律。\n- 感生偶极矩的线性响应定义 $\\boldsymbol{\\mu}_{\\mathrm{ind}} = \\boldsymbol{\\alpha} \\cdot \\mathbf{E}$。\n- 相互作用能的定义，即从零场到最终场极化分子所需的可逆功。\n\n以闭合形式推导在指定取向和分离距离下，离子与分子之间相互作用能的感生贡献。将最终结果以焦耳为单位，表示为 $q$、$R$、$\\varepsilon_{0}$、$\\alpha_{x}$、$\\alpha_{y}$、$\\alpha_{z}$ 和 $(\\ell, m, n)$ 的函数。无需进行数值计算。最终答案必须是单一的解析表达式。", "solution": "所述问题具有科学依据，提法恰当，并包含唯一解所需的所有信息。我们将根据经典静电学原理进行形式推导。\n\n令中性分子的质心为笛卡尔坐标系的原点。该坐标系的轴，记为 $(x, y, z)$，被选为分子的主轴。在此坐标系中，极化率张量 $\\boldsymbol{\\alpha}$ 是一个对角矩阵：\n$$\n\\boldsymbol{\\alpha} = \\begin{pmatrix} \\alpha_{x} & 0 & 0 \\\\ 0 & \\alpha_{y} & 0 \\\\ 0 & 0 & \\alpha_{z} \\end{pmatrix}\n$$\n带电荷 $q$ 的离子位于相对于原点的位置矢量 $\\mathbf{R}$ 处，该矢量的模为 $|\\mathbf{R}| = R$。离子相对于分子的取向由单位向量 $\\hat{\\mathbf{R}} = \\mathbf{R}/R$ 给出，其在分子坐标系中的方向余弦为 $(\\ell, m, n)$。因此，其分量形式为：\n$$\n\\hat{\\mathbf{R}} = \\ell \\hat{\\mathbf{x}} + m \\hat{\\mathbf{y}} + n \\hat{\\mathbf{z}}\n$$\n\n推导过程分三步进行，遵循问题陈述中提供的基础。\n\n首先，我们确定点电荷 $q$ 在分子位置（原点）产生的电场 $\\mathbf{E}$。根据库仑定律，位于位置 $\\mathbf{R}$ 的电荷 $q$ 在原点产生的电场为：\n$$\n\\mathbf{E} = \\frac{1}{4\\pi\\varepsilon_{0}} \\frac{q}{|\\mathbf{0} - \\mathbf{R}|^3} (\\mathbf{0} - \\mathbf{R}) = -\\frac{q}{4\\pi\\varepsilon_{0}} \\frac{\\mathbf{R}}{R^3} = -\\frac{q}{4\\pi\\varepsilon_{0}R^2} \\hat{\\mathbf{R}}\n$$\n在分子坐标系中代入 $\\hat{\\mathbf{R}}$ 的分量，我们得到：\n$$\n\\mathbf{E} = -\\frac{q}{4\\pi\\varepsilon_{0}R^2} (\\ell \\hat{\\mathbf{x}} + m \\hat{\\mathbf{y}} + n \\hat{\\mathbf{z}})\n$$\n\n其次，我们确定该电场在分子中感生的偶极矩 $\\boldsymbol{\\mu}_{\\mathrm{ind}}$。使用线性响应定义 $\\boldsymbol{\\mu}_{\\mathrm{ind}} = \\boldsymbol{\\alpha} \\cdot \\mathbf{E}$：\n$$\n\\boldsymbol{\\mu}_{\\mathrm{ind}} = \\begin{pmatrix} \\alpha_{x} & 0 & 0 \\\\ 0 & \\alpha_{y} & 0 \\\\ 0 & 0 & \\alpha_{z} \\end{pmatrix} \\left( -\\frac{q}{4\\pi\\varepsilon_{0}R^2} \\begin{pmatrix} \\ell \\\\ m \\\\ n \\end{pmatrix} \\right) = -\\frac{q}{4\\pi\\varepsilon_{0}R^2} \\begin{pmatrix} \\alpha_{x}\\ell \\\\ \\alpha_{y}m \\\\ \\alpha_{z}n \\end{pmatrix}\n$$\n该矢量表示分子坐标系中的感生偶极矩。\n\n第三，我们推导相互作用能的感生贡献 $U_{ind}$。问题指定使用“极化分子所需的可逆功”。该量对应于分子极化时储存在其中的能量，我们称之为 $U_{pol}$。为计算此量，我们设想外场通过一个充电参数 $\\lambda \\in [0,1]$ 从 $0$ 逐渐增加到其最终值 $\\mathbf{E}$，使得中间场为 $\\mathbf{E}' = \\lambda\\mathbf{E}$。相应的感生偶极为 $\\boldsymbol{\\mu}'_{ind} = \\boldsymbol{\\alpha} \\cdot (\\lambda\\mathbf{E}) = \\lambda\\boldsymbol{\\mu}_{ind}$。对分子做的微元功为 $dW_{pol} = \\mathbf{E}' \\cdot d\\boldsymbol{\\mu}'_{ind}$。由于 $d\\boldsymbol{\\mu}'_{ind} = (\\boldsymbol{\\alpha} \\cdot \\mathbf{E}) d\\lambda$，我们有：\n$$\nU_{pol} = \\int_{0}^{1} (\\lambda\\mathbf{E}) \\cdot (\\boldsymbol{\\alpha} \\cdot \\mathbf{E}) d\\lambda = (\\mathbf{E} \\cdot \\boldsymbol{\\alpha} \\cdot \\mathbf{E}) \\int_{0}^{1} \\lambda d\\lambda = \\frac{1}{2} \\mathbf{E} \\cdot (\\boldsymbol{\\alpha} \\cdot \\mathbf{E}) = \\frac{1}{2} \\mathbf{E} \\cdot \\boldsymbol{\\mu}_{ind}\n$$\n然而，总相互作用能 $U_{ind}$ 还必须考虑该感生偶极在外场中的势能，其由 $U_{int} = -\\boldsymbol{\\mu}_{ind} \\cdot \\mathbf{E}$ 给出。总感生能是储存在分子中的能量与其和场源的相互作用能之和：\n$$\nU_{ind} = U_{pol} + U_{int} = \\frac{1}{2} \\boldsymbol{\\mu}_{ind} \\cdot \\mathbf{E} - \\boldsymbol{\\mu}_{ind} \\cdot \\mathbf{E} = -\\frac{1}{2} \\boldsymbol{\\mu}_{ind} \\cdot \\mathbf{E}\n$$\n这是感生能的标准表达式，它总是负值，对应于吸引相互作用。\n\n现在我们将 $\\mathbf{E}$ 和 $\\boldsymbol{\\mu}_{\\mathrm{ind}}$ 的表达式代入 $U_{ind}$ 的公式中：\n$$\nU_{ind} = -\\frac{1}{2} \\left( -\\frac{q}{4\\pi\\varepsilon_{0}R^2} (\\ell \\hat{\\mathbf{x}} + m \\hat{\\mathbf{y}} + n \\hat{\\mathbf{z}}) \\right) \\cdot \\left( -\\frac{q}{4\\pi\\varepsilon_{0}R^2} (\\alpha_{x}\\ell \\hat{\\mathbf{x}} + \\alpha_{y}m \\hat{\\mathbf{y}} + \\alpha_{z}n \\hat{\\mathbf{z}}) \\right)\n$$\n进行标量积运算：\n$$\nU_{ind} = -\\frac{1}{2} \\left( \\frac{q}{4\\pi\\varepsilon_{0}R^2} \\right)^2 (\\ell(\\alpha_{x}\\ell) + m(\\alpha_{y}m) + n(\\alpha_{z}n))\n$$\n化简表达式得到感生能的最终结果：\n$$\nU_{ind} = -\\frac{q^2}{2(4\\pi\\varepsilon_{0})^2 R^4} (\\alpha_{x}\\ell^2 + \\alpha_{y}m^2 + \\alpha_{z}n^2)\n$$\n$$\nU_{ind} = -\\frac{q^2}{32\\pi^2\\varepsilon_{0}^2 R^4} (\\alpha_{x}\\ell^2 + \\alpha_{y}m^2 + \\alpha_{z}n^2)\n$$\n这是以焦耳为单位的感生能，表示为给定参数的函数。", "answer": "$$\n\\boxed{-\\frac{q^{2}}{32\\pi^{2}\\varepsilon_{0}^{2}R^{4}}(\\alpha_{x}\\ell^{2} + \\alpha_{y}m^{2} + \\alpha_{z}n^{2})}\n$$", "id": "2781319"}, {"introduction": "在理解了单个相互作用分量之后，我们转向一个更完整的画面。对称匹配微扰理论（Symmetry-Adapted Perturbation Theory, SAPT）是一个强大的理论框架，它能将总的分子间相互作用能分解为物理意义明确的组分，如静电、交换、感应和色散。本练习旨在搭建理论与计算实践之间的桥梁，通过实现一个简化的SAPT模型，并探索一种常见的计算近似方法——密度拟合——所带来的影响，你将深刻理解量子化学计算中精度与效率之间的权衡。[@problem_id:2781338]", "problem": "您将建立一个共线、头尾相接的二聚体模型，该模型在一个类似对称适应微扰理论 (SAPT) 的分解框架下，分解为四个具有物理意义的组分：静电、交换-排斥、诱导和色散。您将为这些项的距离依赖性实现两种计算路径：一种是基于第一性原理和经过充分检验的公式的精确模型，另一种是近似模型，该模型通过类密度拟合投影将距离核函数投影到由高斯函数构成的有限辅助基组上。您的程序必须计算在指定间距下，辅助基组对每个 SAPT 组分引入的绝对误差。\n\n使用的基本出发点和定义：\n- 永久偶极矩及其相互作用的经典静电学。两个相距为 $R$、沿分子间轴共线排列的永久点偶极子的相互作用能，可由库仑定律和多极展开得出。\n- 用于诱导作用的线性响应理论：诱导偶极矩等于各向同性极化率乘以局域电场。诱导能等于负二分之一乘以极化率再乘以产生该偶极矩的电场的平方。\n- 用于各向同性单体间色散作用的 London 单振子模型，该模型给出了以静态极化率和特征激发能表示的 $C_6$ 系数的闭合形式表达式。\n- 由 Born–Mayer 指数形式建模的短程交换-排斥作用，这是一种与重叠驱动的泡利排斥相关的、经过经验充分检验的函数形式。\n\n模型细节和符号：\n- 全程使用原子单位。距离 $R$ 的单位为玻尔 (bohr)，能量单位为哈特里 (hartree)。\n- 该二聚体由单体 $\\mathrm{A}$ 和单体 $\\mathrm{B}$ 组成，其永久偶极矩大小为 $\\mu_{\\mathrm{A}}$ 和 $\\mu_{\\mathrm{B}}$，沿分子间轴共线且头尾相接排列。单体的各向同性偶极极化率分别为 $\\alpha_{\\mathrm{A}}$ 和 $\\alpha_{\\mathrm{B}}$。单振子的特征能量（例如，有效电离能）为 $I_{\\mathrm{A}}$ 和 $I_{\\mathrm{B}}$。短程排斥参数为 $A_{\\mathrm{rep}}$（单位为哈特里）和 $b$（单位为玻尔$^{-1}$）。\n- 定义以下距离核函数：\n  - 静电偶极-偶极核函数 $K_3(R) = R^{-3}$。\n  - 诱导和色散核函数 $K_6(R) = R^{-6}$。\n  - 交换-排斥核函数 $K_{\\mathrm{rep}}(R) = \\exp(-b R)$。\n- 根据上述原理，精确的类 SAPT 组分如下：\n  - 两个共线、头尾相接的永久偶极子的静电能 $E_{\\mathrm{elst}}(R)$。\n  - 由给定的 $A_{\\mathrm{rep}}$ 和 $b$ 参数、通过 Born–Mayer 指数形式建模的交换-排斥能 $E_{\\mathrm{exch}}(R)$。\n  - 两个相互诱导的永久偶极子通过线性响应产生的诱导能 $E_{\\mathrm{ind}}(R)$。\n  - 来自 London 单振子模型的色散能 $E_{\\mathrm{disp}}(R)$。\n- 定义一个辅助基组 $\\{\\phi_j(R)\\}_{j=1}^{K}$，其中 $\\phi_j(R) = \\exp(-\\gamma_j R^2)$，指数 $\\gamma_j$ 通过等比数列 $\\gamma_j = \\gamma_{\\min}\\, r^{\\,j-1}$ 生成。这里 $K$ 是辅助函数的数量，$\\gamma_{\\min} > 0$ 是最小的指数，$r > 1$ 是一个比率参数。\n- 对于每个核函数 $K_x(R)$（其中 $x \\in \\{3,6,\\mathrm{rep}\\}$），定义其类密度拟合近似 $K_x^{\\mathrm{DF}}(R) = \\sum_{j=1}^{K} c_j^{(x)} \\phi_j(R)$。其中系数 $\\mathbf{c}^{(x)}$ 通过在拟合区间 $[R_{\\min}^{\\mathrm{fit}}, R_{\\max}^{\\mathrm{fit}}]$ 上的一个包含 $N_{\\mathrm{fit}}$ 个点的均匀网格 $\\{R_i\\}$ 上进行最小二乘投影获得。即，相对于系数最小化 $\\sum_{i=1}^{N_{\\mathrm{fit}}} \\left(K_x(R_i) - \\sum_{j=1}^{K} c_j^{(x)} \\phi_j(R_i)\\right)^2$。对所有网格点使用单位权重。\n- 通过在静电能表达式中用 $K_3^{\\mathrm{DF}}(R)$ 替换 $K_3(R)$，在诱导能和色散能表达式中用 $K_6^{\\mathrm{DF}}(R)$ 替换 $K_6(R)$，在交换-排斥能表达式中用 $K_{\\mathrm{rep}}^{\\mathrm{DF}}(R)$ 替换 $K_{\\mathrm{rep}}(R)$，来构建近似的类 SAPT 组分。\n- 对于每个测试用例，计算每个组分的绝对误差（单位为哈特里），公式为 $\\left|E_{\\mathrm{component}}^{\\mathrm{exact}}(R) - E_{\\mathrm{component}}^{\\mathrm{DF}}(R)\\right|$。\n\n您必须：\n- 根据所述原理推导各组分的公式，并实现精确能量和基于辅助基组的近似能量的计算。\n- 使用指定的辅助基组和网格，实现核函数的最小二乘拟合。\n- 按静电、交换-排斥、诱导、色散的顺序返回各组分的误差。\n- 所有能量以哈特里表示，并将每个误差四舍五入到 $8$ 位小数。\n\n在所有测试用例中，使用以下固定的单体和拟合参数：\n- 单体参数：$\\mu_{\\mathrm{A}} = 1.0000$, $\\mu_{\\mathrm{B}} = 0.8000$, $\\alpha_{\\mathrm{A}} = 10.0000$, $\\alpha_{\\mathrm{B}} = 12.0000$, $I_{\\mathrm{A}} = 0.5000$, $I_{\\mathrm{B}} = 0.6000$, $A_{\\mathrm{rep}} = 10000.0000$, $b = 1.8000$。\n- 拟合网格参数：$R_{\\min}^{\\mathrm{fit}} = 2.0000$, $R_{\\max}^{\\mathrm{fit}} = 8.0000$, $N_{\\mathrm{fit}} = 400$（均匀间隔的点，包括端点）。\n\n测试套件：\n- 用例 1：$R = 3.5000$, $K = 5$, $\\gamma_{\\min} = 0.0500$, $r = 4.0000$。\n- 用例 2：$R = 2.2000$, $K = 3$, $\\gamma_{\\min} = 0.1000$, $r = 5.0000$。\n- 用例 3：$R = 8.0000$, $K = 7$, $\\gamma_{\\min} = 0.0200$, $r = 3.0000$。\n- 用例 4：$R = 3.0000$, $K = 1$, $\\gamma_{\\min} = 0.5000$, $r = 1.0000$。\n\n最终输出格式要求：\n- 您的程序应生成单行输出，其中包含一个列表的列表，每个子列表包含一个测试用例的四个按指定顺序排列的四舍五入后的误差，并按给定的顺序排列四个用例。该行的格式必须严格为 \"[[e11,e12,e13,e14],[e21,e22,e23,e24],[e31,e32,e33,e34],[e41,e42,e43,e44]]\"，其中 $eij$ 是以哈特里为单位、四舍五入到 $8$ 位小数的十进制浮点数，字符串中没有任何空格。", "solution": "该问题要求将一个用于计算分子间相互作用能的计算模型与一个基于第一性原理的精确模型进行验证。总相互作用能被分解为四个组分：静电能 ($E_{\\mathrm{elst}}$)、交换-排斥能 ($E_{\\mathrm{exch}}$)、诱导能 ($E_{\\mathrm{ind}}$) 和色散能 ($E_{\\mathrm{disp}}$)。我们将首先根据所提供的物理原理，为共线、头尾相接的二聚体推导这些“精确”组分的解析表达式。随后，我们将构建近似模型，该模型将这些相互作用的距离依赖核函数投影到由高斯函数构成的有限辅助基组上。此近似方法的核心是一个线性最小二乘拟合过程。最后，我们将计算在指定的分子间距下，此近似方法对每个组分引入的绝对误差。所有计算均以原子单位进行。\n\n首先，我们推导作为分子间距 $R$ 函数的精确能量组分。该二聚体由单体 $\\mathrm{A}$ 和单体 $\\mathrm{B}$ 组成，它们具有永久偶极矩 $\\mu_{\\mathrm{A}}$ 和 $\\mu_{\\mathrm{B}}$、极化率 $\\alpha_{\\mathrm{A}}$ 和 $\\alpha_{\\mathrm{B}}$ 以及特征能量 $I_{\\mathrm{A}}$ 和 $I_{\\mathrm{B}}$。\n\n两个点偶极子的静电相互作用能 $E_{\\mathrm{elst}}$ 由 $E = (\\vec{\\mu}_{\\mathrm{A}} \\cdot \\vec{\\mu}_{\\mathrm{B}} - 3(\\vec{\\mu}_{\\mathrm{A}} \\cdot \\hat{R})(\\vec{\\mu}_{\\mathrm{B}} \\cdot \\hat{R}))/R^3$ 给出。对于沿分子间轴 $\\hat{R}$ 的共线、头尾相接构型，我们有 $\\vec{\\mu}_{\\mathrm{A}} = \\mu_{\\mathrm{A}}\\hat{R}$ 和 $\\vec{\\mu}_{\\mathrm{B}} = \\mu_{\\mathrm{B}}\\hat{R}$。能量表达式简化为 $E_{\\text{elst}}(R) = (\\mu_{\\mathrm{A}}\\mu_{\\mathrm{B}} - 3(\\mu_{\\mathrm{A}})(\\mu_{\\mathrm{B}}))/R^3 = -2\\mu_{\\mathrm{A}}\\mu_{\\mathrm{B}}R^{-3}$。这可以写成 $E_{\\mathrm{elst}}(R) = C_{\\mathrm{elst}} K_3(R)$，其中常数前置因子为 $C_{\\mathrm{elst}} = -2\\mu_{\\mathrm{A}}\\mu_{\\mathrm{B}}$，核函数为 $K_3(R) = R^{-3}$。\n\n交换-排斥能 $E_{\\mathrm{exch}}$ 由 Born–Mayer 模型给出：$E_{\\mathrm{exch}}(R) = A_{\\mathrm{rep}}\\exp(-bR)$。这可以写成 $E_{\\mathrm{exch}}(R) = C_{\\mathrm{exch}} K_{\\mathrm{rep}}(R)$，其中 $C_{\\mathrm{exch}} = A_{\\mathrm{rep}}$，核函数为 $K_{\\mathrm{rep}}(R) = \\exp(-bR)$。参数 $A_{\\mathrm{rep}}$ 和 $b$ 已提供。\n\n诱导能 $E_{\\mathrm{ind}}$ 源于一个单体被另一个单体的电场所极化。一个点偶极子 $\\vec{\\mu}$ 在其轴上距离 $R$ 处产生的电场为 $\\vec{F} = 2\\vec{\\mu}/R^3$。极化率为 $\\alpha$ 的单体在外部电场 $F$ 中的诱导能为 $-\\frac{1}{2}\\alpha F^2$。总诱导能是单体 $\\mathrm{A}$ 在单体 $\\mathrm{B}$ 的场中的能量与单体 $\\mathrm{B}$ 在单体 $\\mathrm{A}$ 的场中的能量之和：\n$$E_{\\mathrm{ind}}(R) = -\\frac{1}{2}\\alpha_{\\mathrm{A}} \\left(\\frac{2\\mu_{\\mathrm{B}}}{R^3}\\right)^2 - \\frac{1}{2}\\alpha_{\\mathrm{B}} \\left(\\frac{2\\mu_{\\mathrm{A}}}{R^3}\\right)^2 = -2(\\alpha_{\\mathrm{A}}\\mu_{\\mathrm{B}}^2 + \\alpha_{\\mathrm{B}}\\mu_{\\mathrm{A}}^2)R^{-6}$$\n其形式为 $E_{\\mathrm{ind}}(R) = C_{\\mathrm{ind}} K_6(R)$，其中 $C_{\\mathrm{ind}} = -2(\\alpha_{\\mathrm{A}}\\mu_{\\mathrm{B}}^2 + \\alpha_{\\mathrm{B}}\\mu_{\\mathrm{A}}^2)$，核函数为 $K_6(R) = R^{-6}$。\n\n色散能 $E_{\\mathrm{disp}}$ 使用 London 单振子模型确定，该模型给出的相互作用为 $E_{\\mathrm{disp}}(R) = -C_6 R^{-6}$。$C_6$ 系数的 London 公式为：\n$$C_6 = \\frac{3}{2}\\frac{I_{\\mathrm{A}}I_{\\mathrm{B}}}{I_{\\mathrm{A}}+I_{\\mathrm{B}}}\\alpha_{\\mathrm{A}}\\alpha_{\\mathrm{B}}$$\n因此，色散能可以写成 $E_{\\mathrm{disp}}(R) = C_{\\mathrm{disp}} K_6(R)$，其中 $C_{\\mathrm{disp}} = -C_6$，核函数同样为 $K_6(R) = R^{-6}$。\n\n接下来，我们构建近似模型。对于 $x \\in \\{3, 6, \\mathrm{rep}\\}$ 的距离核函数 $K_x(R)$，用 $K$ 个高斯基函数 $\\phi_j(R) = \\exp(-\\gamma_j R^2)$ 的线性组合来近似：\n$$K_x^{\\mathrm{DF}}(R) = \\sum_{j=1}^{K} c_j^{(x)} \\phi_j(R)$$\n指数通过等比数列生成：$\\gamma_j = \\gamma_{\\min} r^{j-1}$。系数 $c_j^{(x)}$ 是通过在区间 $[R_{\\min}^{\\mathrm{fit}}, R_{\\max}^{\\mathrm{fit}}]$ 内包含 $N_{\\mathrm{fit}}$ 个点 $\\{R_i\\}$ 的均匀网格上，最小化精确核函数 $K_x(R)$ 与其近似 $K_x^{\\mathrm{DF}}(R)$ 之间的残差平方和来确定的。这是一个线性最小二乘问题。令 $\\mathbf{y}^{(x)}$ 为元素是 $y_i^{(x)} = K_x(R_i)$ 的列向量，$\\mathbf{c}^{(x)}$ 为未知系数 $c_j^{(x)}$ 的列向量，$\\mathbf{A}$ 为元素是 $A_{ij} = \\phi_j(R_i)$ 的 $N_{\\mathrm{fit}} \\times K$ 设计矩阵。目标是最小化 $\\|\\mathbf{y}^{(x)} - \\mathbf{A}\\mathbf{c}^{(x)}\\|^2$。系数的解由正规方程组给出：\n$$\\mathbf{c}^{(x)} = (\\mathbf{A}^T \\mathbf{A})^{-1} \\mathbf{A}^T \\mathbf{y}^{(x)}$$\n对三个核函数中的每一个进行数值求解该方程组，得到系数向量 $\\mathbf{c}^{(3)}$, $\\mathbf{c}^{(6)}$ 和 $\\mathbf{c}^{(\\mathrm{rep})}$。\n\n然后，通过将近似核函数代入能量表达式来计算近似能量组分 $E_{\\mathrm{component}}^{\\mathrm{DF}}(R)$：\n$E_{\\mathrm{elst}}^{\\mathrm{DF}}(R) = C_{\\mathrm{elst}} K_3^{\\mathrm{DF}}(R)$,\n$E_{\\mathrm{exch}}^{\\mathrm{DF}}(R) = C_{\\mathrm{exch}} K_{\\mathrm{rep}}^{\\mathrm{DF}}(R)$,\n$E_{\\mathrm{ind}}^{\\mathrm{DF}}(R) = C_{\\mathrm{ind}} K_6^{\\mathrm{DF}}(R)$,\n$E_{\\mathrm{disp}}^{\\mathrm{DF}}(R) = C_{\\mathrm{disp}} K_6^{\\mathrm{DF}}(R)$。\n\n每个测试用例的最后一步是计算在指定距离 $R$ 处每个组分的绝对误差：\n$$\\text{Error} = |E_{\\mathrm{component}}^{\\mathrm{exact}}(R) - E_{\\mathrm{component}}^{\\mathrm{DF}}(R)|$$\n算法流程如下：\n1.  根据固定的单体参数，预先计算常数前置因子 $C_{\\mathrm{elst}}$、$C_{\\mathrm{exch}}$、$C_{\\mathrm{ind}}$ 和 $C_{\\mathrm{disp}}$。\n2.  对于由 $R$、$K$、$\\gamma_{\\min}$ 和 $r$ 指定的每个测试用例：\n    a. 生成辅助基组的指数 $\\gamma_j$。\n    b. 构建拟合网格 $\\{R_i\\}$，该网格包含从 $R_{\\min}^{\\mathrm{fit}}=2.0$ 到 $R_{\\max}^{\\mathrm{fit}}=8.0$ 的 $N_{\\mathrm{fit}}=400$ 个点。\n    c. 通过在网格 $\\{R_i\\}$ 上计算基函数 $\\phi_j$ 来构建设计矩阵 $\\mathbf{A}$。\n    d. 对于每个核函数 $K_3$、$K_6$ 和 $K_{\\mathrm{rep}}$，通过在网格上计算核函数来创建目标向量 $\\mathbf{y}$。\n    e. 求解最小二乘问题以获得系数向量 $\\mathbf{c}^{(3)}$, $\\mathbf{c}^{(6)}$ 和 $\\mathbf{c}^{(\\mathrm{rep})}$。\n    f. 在测试距离 $R$ 处，计算精确核函数及其高斯拟合近似值。\n    g. 计算四个精确能量组分和四个近似能量组分。\n    h. 计算绝对误差，将其四舍五入到 $8$ 位小数，并存储结果。\n3.  将收集到的结果格式化为指定的列表的列表字符串格式。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating the error in a SAPT-like energy decomposition\n    when using a Gaussian basis approximation for the interaction kernels.\n    \"\"\"\n\n    # --- Fixed Monomer and Fitting Parameters ---\n    # All values are in atomic units.\n    mu_A = 1.0000\n    mu_B = 0.8000\n    alpha_A = 10.0000\n    alpha_B = 12.0000\n    I_A = 0.5000\n    I_B = 0.6000\n    A_rep = 10000.0000\n    b = 1.8000\n\n    R_min_fit = 2.0000\n    R_max_fit = 8.0000\n    N_fit = 400\n\n    # --- Pre-compute constant energy prefactors ---\n    C_elst = -2.0 * mu_A * mu_B\n    C_exch = A_rep\n    C_ind = -2.0 * (alpha_A * mu_B**2 + alpha_B * mu_A**2)\n    C_disp = -1.5 * (I_A * I_B) / (I_A + I_B) * alpha_A * alpha_B\n\n    # --- Define exact kernels ---\n    def K3(R):\n        return R**-3\n    \n    def K6(R):\n        return R**-6\n\n    def K_rep(R):\n        return np.exp(-b * R)\n\n    # --- Fitting grid ---\n    R_grid = np.linspace(R_min_fit, R_max_fit, N_fit)\n\n    # --- Test suite ---\n    test_cases = [\n        # (R_eval, K, gamma_min, r)\n        (3.5000, 5, 0.0500, 4.0000),\n        (2.2000, 3, 0.1000, 5.0000),\n        (8.0000, 7, 0.0200, 3.0000),\n        (3.0000, 1, 0.5000, 1.0000),\n    ]\n\n    all_results = []\n\n    for R_eval, K, gamma_min, r in test_cases:\n        # --- 1. Generate auxiliary basis and design matrix A ---\n        j = np.arange(K)\n        gammas = gamma_min * (r**j)\n        \n        # Design matrix A (shape: N_fit x K)\n        # A_ij = phi_j(R_i) = exp(-gamma_j * R_i^2)\n        A = np.exp(-gammas[np.newaxis, :] * R_grid[:, np.newaxis]**2)\n\n        # --- 2. Least-squares fitting for each kernel ---\n        # Target vectors y\n        y3 = K3(R_grid)\n        y6 = K6(R_grid)\n        y_rep = K_rep(R_grid)\n\n        # Solve for coefficients c using numpy's least-squares solver\n        c3 = np.linalg.lstsq(A, y3, rcond=None)[0]\n        c6 = np.linalg.lstsq(A, y6, rcond=None)[0]\n        c_rep = np.linalg.lstsq(A, y_rep, rcond=None)[0]\n\n        # --- 3. Evaluate exact and approximate energies at R_eval ---\n        # Exact energies\n        E_elst_exact = C_elst * K3(R_eval)\n        E_exch_exact = C_exch * K_rep(R_eval)\n        E_ind_exact = C_ind * K6(R_eval)\n        E_disp_exact = C_disp * K6(R_eval)\n\n        # Approximate energies\n        # First, evaluate the basis functions and approximate kernels at R_eval\n        phi_at_R = np.exp(-gammas * R_eval**2)\n        \n        K3_df = np.dot(c3, phi_at_R)\n        K6_df = np.dot(c6, phi_at_R)\n        K_rep_df = np.dot(c_rep, phi_at_R)\n        \n        E_elst_df = C_elst * K3_df\n        E_exch_df = C_exch * K_rep_df\n        E_ind_df = C_ind * K6_df\n        E_disp_df = C_disp * K6_df\n\n        # --- 4. Compute absolute errors and round ---\n        err_elst = round(abs(E_elst_exact - E_elst_df), 8)\n        err_exch = round(abs(E_exch_exact - E_exch_df), 8)\n        err_ind = round(abs(E_ind_exact - E_ind_df), 8)\n        err_disp = round(abs(E_disp_exact - E_disp_df), 8)\n        \n        all_results.append([err_elst, err_exch, err_ind, err_disp])\n\n    # --- 5. Format output string ---\n    row_strings = []\n    for row in all_results:\n        row_str_values = [f\"{val:.8f}\" for val in row]\n        row_strings.append(f\"[{','.join(row_str_values)}]\")\n    \n    final_output = f\"[{','.join(row_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "2781338"}, {"introduction": "色散力通常是最难精确描述的相互作用分量，而它对分子聚集体和生物大分子的结构与功能至关重要。鉴于标准密度泛函理论（DFT）在描述长程色散效应时的系统性失败，经验校正方法已成为一种广泛应用的实用解决方案。本练习将带你深入探索一种前沿的经验校正模型——Grimme的D3方法，通过亲手实现其核心部分，包括依赖于配位数的 $C_6$ 系数和阻尼函数，你将对这些精密模型如何在高精度和跨化学空间的普适性之间取得平衡获得具体而深入的认识。[@problem_id:2899243]", "problem": "为固定的小分子集合实现一种 Grimme D3 类型的成对相加色散能校正，该校正采用零阻尼和依赖于配位数的 $C_6$ 系数。仅使用下面提供的定义、数据和基本原理。您的实现必须是一个完整的、可运行的程序，该程序通过对单体间原子对的交叉求和来计算两个单体之间的相互作用色散能。然后，通过报告从不依赖环境的 $C_6$ 系数切换到依赖环境的 $C_6$ 系数时的分数变化，来量化相互作用色散能对包含配位数依赖性的敏感性。\n\n使用的基本依据和定义：\n- 两个分离良好的中性闭壳层片段之间的主要长程相互作用是一个吸引项，其大小与组成的可极化中心之间距离的负六次方成比例。将色散能建模为原子间的成对相加总和，并带有一个短程阻尼因子，该因子平滑地衰减非物理的短距离发散。成对能量必须为负，并随着距离的增大从下方趋近于零。\n- 原子的配位数应建模为原子间距离相对于共价半径之和的一个平滑、可微的函数，使得近共价键距离的贡献值每个键接近于一，而远距离原子的贡献可以忽略不计。\n- $C_6$ 的环境依赖性必须通过基于计算出的配位数，在低配位和高配位极限之间对特定元素的 $C_6$ 参考值进行连续插值来建模。\n\n程序要求：\n- 对于每个原子 $i$，通过对同一单体内的原子 $j$ 求和来计算配位数 $CN_i$：\n  - 使用一个逻辑斯蒂类型的权重，该权重取决于共价半径之和与实际原子间距离的比值。设锐度参数为 $k = 16$。权重和配位数的具体数学形式必须设计成满足上述定性描述。\n- 对于每个原子 $i$，从提供的特定元素的低配位参考值计算一个不依赖环境的原子系数 $C_{6,i}^{(0)}$，并通过在提供的特定元素的配位边界之间使用 $CN_i$ 的截断线性分数，在提供的低配位和高配位参考值之间进行连续插值来计算一个依赖环境的系数 $C_{6,i}(CN_i)$。\n- 对于每个单体间原子对 $(i,j)$，使用一个对称混合规则将原子系数组合成对系数 $C_{6,ij}$，当 $i$ 和 $j$ 是相同元素时，该规则应简化为正确的同元素值。\n- 使用一个零阻尼函数来衰减短程行为，该函数依赖于原子间距离和特定元素参考半径之和。阻尼函数必须是无量纲的，随距离单调递增，并在大分离时趋近于一。对参考距离使用固定的指数参数 $\\alpha = 14$ 和缩放因子 $s_R = 1.0$；同时对能量使用固定的全局前置因子 $s_6 = 1.0$。设计一个与这些约束一致的阻尼函数。\n- 通过对所有单体间原子对求和来计算总的单体间色散能。对于负六次方项，使用玻尔（Bohr）为单位的距离，并结合原子单位的原子 $C_6$ 系数，以便能量以哈特里（Hartree）为单位，然后将最终能量转换为千焦耳/摩尔（kJ/mol）。使用以下精确常数：\n  - $1\\,\\text{Angstrom} = 1.889726125\\,\\text{Bohr}$。\n  - $1\\,\\text{Hartree} = 2625.499638\\,\\text{kJ/mol}$。\n- 每个测试用例的敏感性分析指标：计算分数变化 $\\Delta = \\dfrac{E_{\\text{env}} - E_{\\text{indep}}}{\\lvert E_{\\text{indep}} \\rvert}$，其中 $E_{\\text{env}}$ 是使用依赖环境的 $C_6$ 时的单体间色散能，$E_{\\text{indep}}$ 是使用不依赖环境的参考值时的色散能。\n\n元素特定数据：\n- 考虑的元素：氢 (H)、碳 (C)、氮 (N)、氧 (O)、氖 (Ne)、氩 (Ar)。原子序数：H $= 1$，C $= 6$，N $= 7$，O $= 8$，Ne $= 10$，Ar $= 18$。\n- 共价半径（单位：埃）：\n  - H: $0.31$, C: $0.76$, N: $0.71$, O: $0.66$, Ne: $0.58$, Ar: $0.96$。\n- 范德华半径（单位：埃，用于定义阻尼函数中的参考距离）：\n  - H: $1.20$, C: $1.70$, N: $1.55$, O: $1.52$, Ne: $1.54$, Ar: $1.88$。\n- 原子 $C_6$ 参考值（单位：原子单位，即 Hartree Bohr$^6$）；用于插值的低配位和高配位极限以及配位边界：\n  - H: $C_6^{\\text{low}} = 6.50$, $C_6^{\\text{high}} = 6.50$, $CN_{\\text{low}} = 0.0$, $CN_{\\text{high}} = 1.0$。\n  - C: $C_6^{\\text{low}} = 44.00$, $C_6^{\\text{high}} = 50.00$, $CN_{\\text{low}} = 1.0$, $CN_{\\text{high}} = 4.0$。\n  - N: $C_6^{\\text{low}} = 22.00$, $C_6^{\\text{high}} = 26.00$, $CN_{\\text{low}} = 1.0$, $CN_{\\text{high}} = 3.0$。\n  - O: $C_6^{\\text{low}} = 15.60$, $C_6^{\\text{high}} = 18.00$, $CN_{\\text{low}} = 1.0$, $CN_{\\text{high}} = 2.0$。\n  - Ne: $C_6^{\\text{low}} = 6.38$, $C_6^{\\text{high}} = 6.38$, $CN_{\\text{low}} = 0.0$, $CN_{\\text{high}} = 0.0$。\n  - Ar: $C_6^{\\text{low}} = 64.30$, $C_6^{\\text{high}} = 64.30$, $CN_{\\text{low}} = 0.0$, $CN_{\\text{high}} = 0.0$。\n\n测试套件的几何结构和单体划分（所有坐标单位为埃，如果需要，角度单位为弧度）：\n- 测试用例 $1$（氖二聚体，质心分离距离 $3.1$）：\n  - 单体 A：Ne位于 $(0.0, 0.0, 0.0)$。\n  - 单体 B：Ne位于 $(3.1, 0.0, 0.0)$。\n- 测试用例 $2$（氩二聚体，质心分离距离 $3.8$）：\n  - 单体 A：Ar位于 $(0.0, 0.0, 0.0)$。\n  - 单体 B：Ar位于 $(3.8, 0.0, 0.0)$。\n- 测试用例 $3$（甲烷二聚体，沿 z 轴分离距离 $4.0$）：\n  - 单体 A：\n    - C位于 $(0.000, 0.000, 0.000)$，\n    - H位于 $(0.000, 0.000, 1.089)$，\n    - H位于 $(1.026719, 0.000000, -0.363000)$，\n    - H位于 $(-0.513360, 0.889165, -0.363000)$，\n    - H位于 $(-0.513360, -0.889165, -0.363000)$。\n  - 单体 B：与单体 A 坐标相同，但沿 $(0.000, 0.000, 4.000)$ 平移。\n- 测试用例 $4$（苯三明治型二聚体，平面间分离距离 $3.5$）：\n  - 单体 A：六个碳原子和六个氢原子位于 $z = 0.0$ 的 $xy$ 平面上，碳环为边长 $1.397$ 的正六边形，氢原子沿径向向外延伸 $1.089$：\n    - 对于 $k = 0,1,2,3,4,5$，令 $\\theta_k = k \\times \\pi/3$。\n    - 碳原子：位置 $(1.397 \\cos\\theta_k, 1.397 \\sin\\theta_k, 0.000)$。\n    - 氢原子：位置 $((1.397 + 1.089) \\cos\\theta_k, (1.397 + 1.089) \\sin\\theta_k, 0.000)$。\n  - 单体 B：与单体 A 相同，但沿 $(0.000, 0.000, 3.500)$ 平移。\n\n数值和输出要求：\n- 所有能量必须以 $\\text{kJ/mol}$ 为单位报告。\n- 对于上述四个测试用例中的每一个，计算敏感性指标 $\\Delta = \\dfrac{E_{\\text{env}} - E_{\\text{indep}}}{\\lvert E_{\\text{indep}} \\rvert}$，结果为浮点数。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，“[result1,result2,result3,result4]”）。每个结果必须精确到六位小数。\n\n覆盖性设计：\n- 测试用例 1 探测一个同核稀有气体二聚体，其配位数消失，提供了一个环境依赖性应无影响的边界情况。\n- 测试用例 2 探测一个在更大分离距离下的更重的稀有气体二聚体，再次检查消失的环境依赖性和距离标度关系。\n- 测试用例 3 探测一个弱相互作用的饱和烃二聚体，其配位数接近其最大值，提供了一个具有适度环境依赖性的“理想路径”案例。\n- 测试用例 4 探测一个具有更高配位数和多种原子类型的更大芳香体系，以检验阻尼和插值行为。\n\n约束条件：\n- 严格按照描述实现逻辑，不使用此处提供之外的外部数据。\n- 不要提示输入；程序必须是自包含的和确定性的。", "solution": "所提出的问题是计算量子化学中一个适定性任务，要求实现一个简化的 Grimme D3 类型色散能校正。它具有科学依据，内部一致，并提供了足够的数据来构建一个唯一且可验证的解决方案。我将对指定模型进行严格的推导和实现。\n\n总的单体间色散能 $E_{\\text{disp}}$ 是通过对单体 A 中的原子 $i$ 和单体 B 中的原子 $j$ 进行成对求和来计算的。每对 $(i, j)$ 的能量由以下公式给出：\n$$\nE_{ij} = -s_6 \\cdot f_{\\text{damp}}(R_{ij}) \\cdot \\frac{C_{6,ij}}{R_{ij}^6}\n$$\n其中 $s_6$ 是一个全局缩放因子，给定为 $s_6 = 1.0$。原子间距离 $R_{ij}$ 必须以玻尔为单位，对色散系数 $C_{6,ij}$ 的单位是原子单位 Hartree Bohr$^6$，这样得到的能量单位是哈特里。总能量是所有这些对的总和：\n$$\nE_{\\text{disp}} = \\sum_{i \\in A} \\sum_{j \\in B} E_{ij}\n$$\n该计算需要几个中间步骤，下面将详细说明。\n\n首先，必须计算每个原子 $i$ 的配位数 $CN_i$。这个量反映了局部化学环境，并通过对同一单体内的所有其他原子 $j$ 的成对贡献求和来计算。该贡献由一个逻辑斯蒂类型的函数加权：\n$$\nCN_i = \\sum_{j \\in \\text{monomer}(i), j \\neq i} \\frac{1}{1 + e^{-k \\left( \\frac{R_{\\text{cov},i} + R_{\\text{cov},j}}{R_{ij}} - 1 \\right)}}\n$$\n此处，$R_{ij}$ 是原子 $i$ 和 $j$ 之间的距离，$R_{\\text{cov},i}$ 是原子 $i$ 的共价半径，$k$ 是一个锐度参数，指定为 $k = 16$。这种形式正确地捕捉了以下要求：处于或接近共价键合距离的原子对配位数的贡献很大，而远距离的原子贡献可以忽略不计。\n\n第二，确定原子 $C_6$ 色散系数。问题要求两组系数：不依赖环境的 $C_{6,i}^{(0)}$ 和依赖环境的 $C_{6,i}(CN_i)$。\n对于元素为 $Z_i$ 的原子，其不依赖环境的系数是其低配位参考值：\n$$\nC_{6,i}^{(0)} = C_{6,Z_i}^{\\text{low}}\n$$\n依赖环境的系数是通过在低配位和高配位参考值之间进行截断线性插值来确定的，插值基于计算出的配位数 $CN_i$。我们首先定义一个分数进程变量 $x_i$：\n$$\nx_i = \\frac{CN_i - CN_{Z_i,\\text{low}}}{CN_{Z_i,\\text{high}} - CN_{Z_i,\\text{low}}}\n$$\n该变量被截断到区间 $[0, 1]$ 以处理 $CN_i$ 超出参考边界的情况：\n$$\nx_{i, \\text{clamped}} = \\max(0, \\min(1, x_i))\n$$\n如果 $CN_{Z_i,\\text{high}} = CN_{Z_i,\\text{low}}$，这个分数是未定的；然而，在这种情况下，$C_{6,Z_i}^{\\text{high}} = C_{6,Z_i}^{\\text{low}}$，所以插值结果就是参考值。那么，依赖环境的系数为：\n$$\nC_{6,i}(CN_i) = C_{6,Z_i}^{\\text{low}} + x_{i, \\text{clamped}} \\cdot (C_{6,Z_i}^{\\text{high}} - C_{6,Z_i}^{\\text{low}})\n$$\n\n第三，必须将原子系数组合成对系数 $C_{6,ij}$。需要一个对称的混合规则。几何平均值是标准且合适的选择：\n$$\nC_{6,ij} = \\sqrt{C_{6,i} \\cdot C_{6,j}}\n$$\n该规则同时应用于不依赖环境和依赖环境的计算，使用各自的原子 $C_{6,i}$ 值。\n\n第四，必须用一个零阻尼函数 $f_{\\text{damp}}(R_{ij})$ 来校正 $1/R^6$ 项的短程发散。问题指定了一个指数为 $\\alpha=14$、参考距离缩放因子为 $s_R = 1.0$ 的函数。阻尼函数的公式为：\n$$\nf_{\\text{damp}}(R_{ij}) = \\frac{1}{1 + 6 \\left(\\frac{R_{ij}}{R_{0,ij}}\\right)^{-\\alpha}}\n$$\n参考距离 $R_{0,ij}$ 由特定元素的范德华半径 $R_{\\text{vdW},i}$ 之和构成：\n$$\nR_{0,ij} = s_R \\cdot (R_{\\text{vdW},i} + R_{\\text{vdW},j})\n$$\n当 $s_R = 1.0$ 时，这简化为范德华半径的直接求和。函数 $f_{\\text{damp}}$ 在 $R_{ij} \\to 0$ 时正确地趋近于 $0$，在 $R_{ij} \\to \\infty$ 时正确地趋近于 $1$。\n\n计算过程如下：\n对于每个测试用例，我们计算两个总色散能，$E_{\\text{indep}}$ 和 $E_{\\text{env}}$。\n1.  定义两个单体的原子组成和坐标。所有以埃为单位提供的坐标都使用转换因子 $1\\,\\text{Angstrom} = 1.889726125\\,\\text{Bohr}$ 转换为玻尔。\n2.  对于每个单体中的每个原子，使用分子内距离计算其配位数 $CN_i$。\n3.  计算 $E_{\\text{indep}}$：\n    a. 对每个原子 $i$，使用其不依赖环境的系数 $C_{6,i}^{(0)}$。\n    b. 遍历所有单体间原子对 $(i, j)$，计算 $C_{6,ij} = \\sqrt{C_{6,i}^{(0)} C_{6,j}^{(0)}}$，计算 $f_{\\text{damp}}(R_{ij})$，并对成对能量 $E_{ij}$ 求和。\n4.  计算 $E_{\\text{env}}$：\n    a. 对每个原子 $i$，使用插值公式计算其依赖环境的系数 $C_{6,i}(CN_i)$。\n    b. 遍历所有单体间原子对 $(i, j)$，计算 $C_{6,ij} = \\sqrt{C_{6,i}(CN_i) C_{6,j}(CN_j)}$，计算 $f_{\\text{damp}}(R_{ij})$，并对成对能量 $E_{ij}$ 求和。\n5.  使用转换因子 $1\\,\\text{Hartree} = 2625.499638\\,\\text{kJ/mol}$ 将总能量从哈特里转换为 kJ/mol。\n6.  最后，为每个测试用例计算敏感性指标 $\\Delta$：\n$$\n\\Delta = \\frac{E_{\\text{env}} - E_{\\text{indep}}}{\\lvert E_{\\text{indep}} \\rvert}\n$$\n将此过程应用于所有四个指定的测试用例。实现将把所有原子数据存储在结构化格式中以便于访问，并尽可能使用矢量化操作以提高效率。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Implements a Grimme D3-type dispersion energy correction model and\n    computes the sensitivity of interaction energies to coordination-number-dependent\n    C6 coefficients for a set of molecular systems.\n    \"\"\"\n\n    # --- Constants ---\n    ANGSTROM_TO_BOHR = 1.889726125\n    HARTREE_TO_KJ_MOL = 2625.499638\n\n    # --- Model Parameters ---\n    K_CN = 16.0  # Sharpness parameter for coordination number\n    ALPHA_DAMP = 14.0  # Exponent for damping function\n    SR_DAMP = 1.0  # Scaling factor for reference distance in damping\n    S6_FACTOR = 1.0  # Global scaling factor for dispersion energy\n\n    # --- Element-specific Data ---\n    ELEMENT_DATA = {\n        'H': {'rcov': 0.31, 'rvdw': 1.20, 'c6_low': 6.50, 'c6_high': 6.50, 'cn_low': 0.0, 'cn_high': 1.0},\n        'C': {'rcov': 0.76, 'rvdw': 1.70, 'c6_low': 44.00, 'c6_high': 50.00, 'cn_low': 1.0, 'cn_high': 4.0},\n        'N': {'rcov': 0.71, 'rvdw': 1.55, 'c6_low': 22.00, 'c6_high': 26.00, 'cn_low': 1.0, 'cn_high': 3.0},\n        'O': {'rcov': 0.66, 'rvdw': 1.52, 'c6_low': 15.60, 'c6_high': 18.00, 'cn_low': 1.0, 'cn_high': 2.0},\n        'Ne': {'rcov': 0.58, 'rvdw': 1.54, 'c6_low': 6.38, 'c6_high': 6.38, 'cn_low': 0.0, 'cn_high': 0.0},\n        'Ar': {'rcov': 0.96, 'rvdw': 1.88, 'c6_low': 64.30, 'c6_high': 64.30, 'cn_low': 0.0, 'cn_high': 0.0},\n    }\n\n    # --- Test Cases ---\n    def get_benzene_geom(z_offset=0.0):\n        # Regular hexagon with side length 1.397 Angstrom\n        # Ring radius is also 1.397 Angstrom\n        c_radius = 1.397\n        h_radius = c_radius + 1.089\n        atoms = []\n        coords = []\n        for k in range(6):\n            theta = k * math.pi / 3.0\n            # Carbon\n            atoms.append('C')\n            coords.append([c_radius * math.cos(theta), c_radius * math.sin(theta), z_offset])\n            # Hydrogen\n            atoms.append('H')\n            coords.append([h_radius * math.cos(theta), h_radius * math.sin(theta), z_offset])\n        return atoms, np.array(coords)\n\n    test_cases = [\n        {\n            \"monomer_A\": (['Ne'], np.array([[0.0, 0.0, 0.0]])),\n            \"monomer_B\": (['Ne'], np.array([[3.1, 0.0, 0.0]])),\n        },\n        {\n            \"monomer_A\": (['Ar'], np.array([[0.0, 0.0, 0.0]])),\n            \"monomer_B\": (['Ar'], np.array([[3.8, 0.0, 0.0]])),\n        },\n        {\n            \"monomer_A\": (\n                ['C', 'H', 'H', 'H', 'H'],\n                np.array([\n                    [0.000, 0.000, 0.000],\n                    [0.000, 0.000, 1.089],\n                    [1.026719, 0.000000, -0.363000],\n                    [-0.513360, 0.889165, -0.363000],\n                    [-0.513360, -0.889165, -0.363000]\n                ])\n            ),\n            \"monomer_B\": (\n                ['C', 'H', 'H', 'H', 'H'],\n                np.array([\n                    [0.000, 0.000, 4.000],\n                    [0.000, 0.000, 4.000 + 1.089],\n                    [1.026719, 0.000000, 4.000 - 0.363000],\n                    [-0.513360, 0.889165, 4.000 - 0.363000],\n                    [-0.513360, -0.889165, 4.000 - 0.363000]\n                ])\n            ),\n        },\n        {\n            \"monomer_A\": get_benzene_geom(z_offset=0.0),\n            \"monomer_B\": get_benzene_geom(z_offset=3.5),\n        }\n    ]\n\n    def calculate_cn(atoms, coords_bohr):\n        \"\"\"Calculates coordination numbers for all atoms in a monomer.\"\"\"\n        n_atoms = len(atoms)\n        cns = np.zeros(n_atoms)\n        if n_atoms == 1:\n            return cns\n        \n        dist_matrix = np.linalg.norm(coords_bohr[:, np.newaxis, :] - coords_bohr[np.newaxis, :, :], axis=2)\n        \n        for i in range(n_atoms):\n            cn_i = 0.0\n            for j in range(n_atoms):\n                if i == j:\n                    continue\n                \n                rcov_i = ELEMENT_DATA[atoms[i]]['rcov'] * ANGSTROM_TO_BOHR\n                rcov_j = ELEMENT_DATA[atoms[j]]['rcov'] * ANGSTROM_TO_BOHR\n                rcov_sum = rcov_i + rcov_j\n                rij = dist_matrix[i, j]\n                \n                if rij == 0: continue # Should not happen for i != j\n                \n                ratio = rcov_sum / rij\n                cn_i += 1.0 / (1.0 + math.exp(-K_CN * (ratio - 1.0)))\n            cns[i] = cn_i\n        return cns\n\n    def get_c6_coeffs(atoms, cns):\n        \"\"\"Calculates environment-dependent C6 coefficients.\"\"\"\n        c6_coeffs = np.zeros(len(atoms))\n        for i, atom_symbol in enumerate(atoms):\n            data = ELEMENT_DATA[atom_symbol]\n            cn_i = cns[i]\n            \n            cn_low = data['cn_low']\n            cn_high = data['cn_high']\n            \n            if cn_high == cn_low:\n                # Avoid division by zero, also C6_high == C6_low here.\n                x_clamped = 0.0\n            else:\n                x = (cn_i - cn_low) / (cn_high - cn_low)\n                x_clamped = max(0.0, min(1.0, x))\n            \n            c6_low = data['c6_low']\n            c6_high = data['c6_high']\n            \n            c6_coeffs[i] = c6_low + x_clamped * (c6_high - c6_low)\n        return c6_coeffs\n\n    def calculate_dispersion_energy(monomer_A, monomer_B, use_env_dependent_c6):\n        \"\"\"Calculates the total inter-monomer dispersion energy.\"\"\"\n        atoms_A, coords_A_ang = monomer_A\n        atoms_B, coords_B_ang = monomer_B\n\n        coords_A_bohr = coords_A_ang * ANGSTROM_TO_BOHR\n        coords_B_bohr = coords_B_ang * ANGSTROM_TO_BOHR\n\n        cns_A = calculate_cn(atoms_A, coords_A_bohr)\n        cns_B = calculate_cn(atoms_B, coords_B_bohr)\n\n        if use_env_dependent_c6:\n            c6_A = get_c6_coeffs(atoms_A, cns_A)\n            c6_B = get_c6_coeffs(atoms_B, cns_B)\n        else:\n            c6_A = np.array([ELEMENT_DATA[atom]['c6_low'] for atom in atoms_A])\n            c6_B = np.array([ELEMENT_DATA[atom]['c6_low'] for atom in atoms_B])\n\n        total_energy_hartree = 0.0\n        \n        for i in range(len(atoms_A)):\n            for j in range(len(atoms_B)):\n                rij = np.linalg.norm(coords_A_bohr[i] - coords_B_bohr[j])\n                \n                # Pairwise C6 coefficient\n                c6_ij = math.sqrt(c6_A[i] * c6_B[j])\n                \n                # Damping function\n                rvdw_i = ELEMENT_DATA[atoms_A[i]]['rvdw'] * ANGSTROM_TO_BOHR\n                rvdw_j = ELEMENT_DATA[atoms_B[j]]['rvdw'] * ANGSTROM_TO_BOHR\n                r0_ij = SR_DAMP * (rvdw_i + rvdw_j)\n                \n                if r0_ij == 0: continue\n                \n                ratio = rij / r0_ij\n                if ratio == 0: continue # Should not happen between monomers\n\n                f_damp = 1.0 / (1.0 + 6.0 * (ratio ** -ALPHA_DAMP))\n                \n                # Pairwise energy\n                e_ij = -S6_FACTOR * f_damp * c6_ij / (rij ** 6)\n                total_energy_hartree += e_ij\n                \n        return total_energy_hartree * HARTREE_TO_KJ_MOL\n\n    results = []\n    for case in test_cases:\n        monomer_A = (case[\"monomer_A\"][0], case[\"monomer_A\"][1])\n        monomer_B = (case[\"monomer_B\"][0], case[\"monomer_B\"][1])\n        \n        e_indep = calculate_dispersion_energy(monomer_A, monomer_B, use_env_dependent_c6=False)\n        e_env = calculate_dispersion_energy(monomer_A, monomer_B, use_env_dependent_c6=True)\n        \n        if abs(e_indep)  1e-12:\n            delta = 0.0\n        else:\n            delta = (e_env - e_indep) / abs(e_indep)\n        \n        results.append(delta)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "2899243"}]}