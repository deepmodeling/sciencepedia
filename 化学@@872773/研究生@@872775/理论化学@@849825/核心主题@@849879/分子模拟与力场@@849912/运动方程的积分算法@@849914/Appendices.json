{"hands_on_practices": [{"introduction": "在分子动力学模拟中，时间步长的选择是计算成本与模拟稳定性和准确性之间的核心折衷。过大的时间步长会导致数值不稳定性，而过小则会使模拟效率低下。本练习将引导你对应用最广泛的速度Verlet算法进行线性稳定性分析，以确定其最大稳定时间步长与系统最快振动频率之间的关系。通过此练习 [@problem_id:2780480]，你将从第一性原理出发，定量地理解为何在模拟中（例如对水分子）约束高频键振动是一种能显著提升计算效率的有效策略。", "problem": "考虑一个分子系统的单个解耦简正模式，在谐波近似下，该模式由牛顿第二定律支配，满足 $m \\, \\ddot{x}(t) = - k \\, x(t)$，等效于 $\\ddot{x}(t) + \\omega^{2} x(t) = 0$，其中 $\\omega = \\sqrt{k/m}$。在分子动力学(MD)中，使用速度 Verlet 算法对该模式进行积分，其离散更新步骤定义为\n$v_{n+\\frac{1}{2}} = v_{n} + \\frac{\\Delta t}{2} a(x_{n})$，\n$x_{n+1} = x_{n} + \\Delta t \\, v_{n+\\frac{1}{2}}$，\n$v_{n+1} = v_{n+\\frac{1}{2}} + \\frac{\\Delta t}{2} a(x_{n+1})$，\n其中 $a(x) = -\\omega^{2} x$ 且 $\\Delta t$ 是时间步长。从这些定义和谐振动运动方程出发，推导线性稳定性条件，该条件确保当 $n \\to \\infty$ 时离散轨迹 $\\{x_{n}\\}$ 的解是有界的，并获得最大稳定时间步长作为模式角频率 $\\omega$ 的函数的表达式。\n\n然后，应用您的结果来评估在一个水模型中，使高频O–H伸缩振动刚性化的完整约束所产生的影响。使用以下气相水的波数（单位为 $\\mathrm{cm}^{-1}$）作为最快内运动的特征值：不对称伸缩振动 $\\tilde{\\nu}_{\\mathrm{as}} = 3756 \\ \\mathrm{cm}^{-1}$，对称伸缩振动 $\\tilde{\\nu}_{\\mathrm{s}} = 3657 \\ \\mathrm{cm}^{-1}$，以及弯曲振动 $\\tilde{\\nu}_{\\mathrm{b}} = 1595 \\ \\mathrm{cm}^{-1}$。假设在无约束（完全柔性）的情况下，最大角频率由不对称伸缩振动决定；而在约束O–H键为刚性后，两种伸缩振动模式均被移除，因此弯曲振动决定了最大角频率。将每个简正模式建模为独立的，并估算从无约束水模型变为O–H约束水模型时，最大稳定时间步长 $\\Delta t_{\\max}$ 的倍数增益。将您的最终答案表示为等于比值 $\\Delta t_{\\max}^{(\\mathrm{rigid\\ O\\!-\\!H})} / \\Delta t_{\\max}^{(\\mathrm{flexible})}$ 的单个无量纲数，并将您的答案四舍五入到4位有效数字。", "solution": "所提出的问题具有科学依据、是良定的，并包含了求解所需的所有必要信息。它代表了计算理论化学中的一个标准分析。我们将开始求解。\n\n该问题需要进行两部分分析。首先，我们必须推导应用于简谐振子的速度 Verlet 算法的稳定性条件。其次，我们必须将此条件应用于分子动力学中涉及水分子的一个实际场景。\n\n让我们从推导开始。该系统由运动方程 $\\ddot{x}(t) + \\omega^{2} x(t) = 0$ 描述，其中加速度为 $a(x) = -\\omega^{2} x$。速度 Verlet 积分器由以下更新步骤给出：\n$$v_{n+\\frac{1}{2}} = v_{n} + \\frac{\\Delta t}{2} a(x_{n})$$\n$$x_{n+1} = x_{n} + \\Delta t \\, v_{n+\\frac{1}{2}}$$\n$$v_{n+1} = v_{n+\\frac{1}{2}} + \\frac{\\Delta t}{2} a(x_{n+1})$$\n\n我们的目标是找到从时刻步 $n$ 的状态向量 $\\mathbf{z}_{n} = \\begin{pmatrix} x_{n} \\\\ v_{n} \\end{pmatrix}$ 到时刻步 $n+1$ 的状态向量 $\\mathbf{z}_{n+1} = \\begin{pmatrix} x_{n+1} \\\\ v_{n+1} \\end{pmatrix}$ 的映射。该映射通过一个转移矩阵 $\\mathbf{T}$ 表示，使得 $\\mathbf{z}_{n+1} = \\mathbf{T} \\mathbf{z}_{n}$。该算法的稳定性取决于 $\\mathbf{T}$ 的特征值。\n\n我们将加速度 $a(x_{n}) = -\\omega^{2} x_{n}$ 代入第一个更新方程：\n$$v_{n+\\frac{1}{2}} = v_{n} - \\frac{\\omega^{2} \\Delta t}{2} x_{n}$$\n接下来，我们将其代入位置更新方程：\n$$x_{n+1} = x_{n} + \\Delta t \\left( v_{n} - \\frac{\\omega^{2} \\Delta t}{2} x_{n} \\right) = \\left(1 - \\frac{(\\omega \\Delta t)^{2}}{2}\\right) x_{n} + (\\Delta t) v_{n}$$\n该方程给出了转移矩阵 $\\mathbf{T}$ 的第一行。\n\n为了找到第二行，我们必须用 $x_{n}$ 和 $v_{n}$ 来表示 $v_{n+1}$。我们使用第三个更新规则，其中 $a(x_{n+1}) = -\\omega^{2} x_{n+1}$：\n$$v_{n+1} = v_{n+\\frac{1}{2}} - \\frac{\\omega^{2} \\Delta t}{2} x_{n+1}$$\n代入 $v_{n+\\frac{1}{2}}$ 和 $x_{n+1}$ 的表达式：\n$$v_{n+1} = \\left(v_{n} - \\frac{\\omega^{2} \\Delta t}{2} x_{n}\\right) - \\frac{\\omega^{2} \\Delta t}{2} \\left( \\left(1 - \\frac{(\\omega \\Delta t)^{2}}{2}\\right) x_{n} + (\\Delta t) v_{n} \\right)$$\n按 $x_{n}$ 和 $v_{n}$ 分组各项：\n$$v_{n+1} = \\left(1 - \\frac{(\\omega \\Delta t)^{2}}{2}\\right) v_{n} - \\left( \\frac{\\omega^{2} \\Delta t}{2} + \\frac{\\omega^{2} \\Delta t}{2} \\left(1 - \\frac{(\\omega \\Delta t)^{2}}{2}\\right) \\right) x_{n}$$\n$$v_{n+1} = \\left(1 - \\frac{(\\omega \\Delta t)^{2}}{2}\\right) v_{n} - \\frac{\\omega^{2} \\Delta t}{2} \\left( 2 - \\frac{(\\omega \\Delta t)^{2}}{2} \\right) x_{n}$$\n$$v_{n+1} = -\\omega^{2} \\Delta t \\left(1 - \\frac{(\\omega \\Delta t)^{2}}{4}\\right) x_{n} + \\left(1 - \\frac{(\\omega \\Delta t)^{2}}{2}\\right) v_{n}$$\n这就提供了转移矩阵的第二行。\n\n综合这些结果，转移矩阵 $\\mathbf{T}$ 为：\n$$\\mathbf{T} = \\begin{pmatrix} 1 - \\frac{(\\omega \\Delta t)^{2}}{2}  \\Delta t \\\\ -\\omega^{2} \\Delta t \\left(1 - \\frac{(\\omega \\Delta t)^{2}}{4}\\right)  1 - \\frac{(\\omega \\Delta t)^{2}}{2} \\end{pmatrix}$$\n为了使离散轨迹在 $n \\to \\infty$ 时保持有界，$\\mathbf{T}$ 的特征值 $\\lambda$ 的模不得超过1。特征值是特征方程 $\\det(\\mathbf{T} - \\lambda \\mathbf{I}) = 0$ 的解。该方程为 $\\lambda^{2} - \\mathrm{Tr}(\\mathbf{T})\\lambda + \\det(\\mathbf{T}) = 0$。\n\n矩阵的行列式为：\n$$\\det(\\mathbf{T}) = \\left(1 - \\frac{(\\omega \\Delta t)^{2}}{2}\\right)^{2} + \\omega^{2} \\Delta t^{2} \\left(1 - \\frac{(\\omega \\Delta t)^{2}}{4}\\right) = 1 - (\\omega \\Delta t)^{2} + \\frac{(\\omega \\Delta t)^{4}}{4} + (\\omega \\Delta t)^{2} - \\frac{(\\omega \\Delta t)^{4}}{4} = 1$$\n这个结果 $\\det(\\mathbf{T}) = 1$ 证实了速度 Verlet 算法的辛性质。\n\n矩阵的迹为：\n$$\\mathrm{Tr}(\\mathbf{T}) = \\left(1 - \\frac{(\\omega \\Delta t)^{2}}{2}\\right) + \\left(1 - \\frac{(\\omega \\Delta t)^{2}}{2}\\right) = 2 - (\\omega \\Delta t)^{2}$$\n特征方程为 $\\lambda^{2} - (2 - (\\omega \\Delta t)^{2})\\lambda + 1 = 0$。\n如果该二次方程的判别式为负，则 $\\lambda$ 的解为复数，否则为实数。稳定性边界是特征值从复数（模为1）过渡到实数（其中一个模大于1）的地方。这发生在判别式为零时。一个 $2 \\times 2$ 辛矩阵的一般稳定性条件是 $|\\mathrm{Tr}(\\mathbf{T})| \\le 2$。\n\n应用此条件：\n$$|2 - (\\omega \\Delta t)^{2}| \\le 2$$\n此不等式等价于 $-2 \\le 2 - (\\omega \\Delta t)^{2} \\le 2$。\n右边的不等式 $2 - (\\omega \\Delta t)^{2} \\le 2$ 意味着 $-(\\omega \\Delta t)^{2} \\le 0$，该条件总是满足的。\n左边的不等式 $-2 \\le 2 - (\\omega \\Delta t)^{2}$ 意味着 $(\\omega \\Delta t)^{2} \\le 4$。\n因为 $\\omega$ 和 $\\Delta t$ 都是正的物理量，所以稳定性条件为：\n$$\\omega \\Delta t \\le 2$$\n由此，对于角频率为 $\\omega$ 的模式，其最大稳定时间步长 $\\Delta t_{\\max}$ 为：\n$$\\Delta t_{\\max} = \\frac{2}{\\omega}$$\n\n现在，我们将此结果应用于水分子。在一个分子系统中，总体的最大稳定时间步长由最快的振动模式决定，该模式具有最高的角频率 $\\omega_{\\max}$。\n$$\\Delta t_{\\max} = \\frac{2}{\\omega_{\\max}}$$\n角频率 $\\omega$ 与波数 $\\tilde{\\nu}$（单位为 $\\mathrm{cm}^{-1}$）通过关系式 $\\omega = 2 \\pi c \\tilde{\\nu}$ 相关，其中 $c$ 是光速。\n因此，$\\Delta t_{\\max} = \\frac{2}{2 \\pi c \\tilde{\\nu}_{\\max}} = \\frac{1}{\\pi c \\tilde{\\nu}_{\\max}}$。这表明 $\\Delta t_{\\max}$ 与最大波数 $\\tilde{\\nu}_{\\max}$ 成反比。\n\n对于无约束（完全柔性）的情况，最高频率的模式是不对称伸缩振动：\n$$\\tilde{\\nu}_{\\max}^{(\\mathrm{flexible})} = \\tilde{\\nu}_{\\mathrm{as}} = 3756 \\ \\mathrm{cm}^{-1}$$\n对于O–H约束的情况，伸缩振动模式被移除。剩余的最快模式是弯曲振动：\n$$\\tilde{\\nu}_{\\max}^{(\\mathrm{rigid\\ O\\!-\\!H})} = \\tilde{\\nu}_{\\mathrm{b}} = 1595 \\ \\mathrm{cm}^{-1}$$\n问题要求计算最大稳定时间步长的倍数增益，即以下比值：\n$$\\frac{\\Delta t_{\\max}^{(\\mathrm{rigid\\ O\\!-\\!H})}}{\\Delta t_{\\max}^{(\\mathrm{flexible})}} = \\frac{1 / (\\pi c \\tilde{\\nu}_{\\max}^{(\\mathrm{rigid\\ O\\!-\\!H})})}{1 / (\\pi c \\tilde{\\nu}_{\\max}^{(\\mathrm{flexible})})} = \\frac{\\tilde{\\nu}_{\\max}^{(\\mathrm{flexible})}}{\\tilde{\\nu}_{\\max}^{(\\mathrm{rigid\\ O\\!-\\!H})}}$$\n代入给定的数值：\n$$\\frac{\\Delta t_{\\max}^{(\\mathrm{rigid\\ O\\!-\\!H})}}{\\Delta t_{\\max}^{(\\mathrm{flexible})}} = \\frac{3756}{1595} \\approx 2.3548589...$$\n按要求四舍五入到4位有效数字，我们得到最终答案。", "answer": "$$\\boxed{2.355}$$", "id": "2780480"}, {"introduction": "从理论算法到实际代码的转化是计算科学家的基本功。本练习 [@problem_id:2780514] 提供了一个绝佳的编程实践机会，要求你为在莫尔斯势（一个比简谐振子更真实的化学键模型）中运动的粒子实现速度Verlet积分器。评价一个积分器好坏的关键标准是其守恒性质，你将通过计算并分析总能量在长时间积分后的漂移，亲身体验作为辛积分器一员的Verlet算法为何因其优异的长期能量稳定性而备受青睐。", "problem": "考虑一个折合质量为 $m$ 的粒子在 Morse 势 $V(q)=D_e\\left(1-\\exp\\left(-a\\,(q-q_e)\\right)\\right)^2$ 中运动，其单自由度坐标 $q$ 的一维运动方程。该动力学行为遵循牛顿第二定律 $m\\,\\mathrm{d}^2 q / \\mathrm{d} t^2 = - \\mathrm{d} V / \\mathrm{d} q$，动能为 $K = \\tfrac{1}{2}\\,m\\,v^2$，其中 $v=\\mathrm{d} q / \\mathrm{d} t$。总能量为 $E=K+V$，对于精确解而言，它是一个运动常数。\n\n您的任务是编写一个完整的程序，实现以下功能：\n- 实现速度 Verlet 时间积分算法，在力 $F(q)=-\\mathrm{d}V/\\mathrm{d}q$ 的作用下，从初始条件 $q(0)=q_0$ 和 $v(0)=v_0$ 开始，以步长 $h$ 将轨迹推进 $N$ 步。\n- 计算能量漂移 $\\Delta E = E_N - E_0$，其中 $E_0$ 是初始总能量，$E_N$ 是 $N$ 步后的总能量。\n- 全程使用原子单位：能量单位为 Hartree，长度单位为 bohr，质量单位为电子质量单位，时间单位为原子时间单位。您必须以 Hartree 为单位给出最终数值答案（指能量漂移），并四舍五入到小数点后 $10$ 位。\n\n您的实现必须仅基于：\n- 牛顿第二定律 $m\\,\\mathrm{d}^2 q / \\mathrm{d} t^2 = F(q)$，其中 $F(q)=-\\mathrm{d}V/\\mathrm{d}q$。\n- 动能 $K=\\tfrac{1}{2}\\,m\\,v^2$ 和总能量 $E=K+V$ 的定义。\n- 与这些定律一致的标准速度 Verlet 方案。\n\n直接从给定的势能 $V(q)$ 推导任何所需的表达式（例如力）。\n\n测试组：\n使用以下五个参数集来评估您的程序。每个案例按顺序指定 $(D_e,a,q_e,m,q_0,v_0,h,N)$，所有量均使用上文指定的原子单位。\n- 案例 $1$：$(D_e,a,q_e,m,q_0,v_0,h,N)=(\\,0.176,\\,1.02,\\,0.0,\\,1836.0,\\,0.2,\\,0.0,\\,0.2,\\,1000\\,)$。\n- 案例 $2$：$(D_e,a,q_e,m,q_0,v_0,h,N)=(\\,0.176,\\,1.02,\\,0.0,\\,1836.0,\\,0.2,\\,0.0,\\,0.02,\\,10000\\,)$。\n- 案例 $3$：$(D_e,a,q_e,m,q_0,v_0,h,N)=(\\,0.176,\\,1.02,\\,0.0,\\,1836.0,\\,0.0,\\,0.0,\\,0.5,\\,100\\,)$。\n- 案例 $4$：$(D_e,a,q_e,m,q_0,v_0,h,N)=(\\,0.176,\\,1.02,\\,0.0,\\,1836.0,\\,1.0,\\,-0.05,\\,0.4,\\,800\\,)$。\n- 案例 $5$：$(D_e,a,q_e,m,q_0,v_0,h,N)=(\\,0.176,\\,1.02,\\,0.0,\\,1836.0,\\,0.3,\\,0.1,\\,0.1,\\,0\\,)$。\n\n要求的最终输出格式：\n您的程序应生成单行输出，其中包含按上述案例顺序排列的五个能量漂移结果，形式为方括号括起来的逗号分隔列表。每个漂移值必须是四舍五入到小数点后 $10$ 位的浮点数，例如 $[0.0000000000,0.1234567890,-0.0000000001,0.0000000000,0.0000000000]$。", "solution": "该问题要求实现速度 Verlet 算法，以模拟一维 Morse 势中粒子的动力学行为，并计算数值能量漂移。在尝试求解之前，需要对问题陈述进行验证。\n\n**问题验证**\n\n1.  **提取的已知条件：**\n    *   势能：$V(q)=D_e\\left(1-\\exp\\left(-a\\,(q-q_e)\\right)\\right)^2$。\n    *   运动方程：$m\\,\\mathrm{d}^2 q / \\mathrm{d} t^2 = - \\mathrm{d} V / \\mathrm{d} q$。\n    *   能量：$E = \\tfrac{1}{2}\\,m\\,v^2 + V(q)$。\n    *   算法：速度 Verlet 积分。\n    *   任务：在 $N$ 个步长为 $h$ 的步骤后，计算能量漂移 $\\Delta E = E_N - E_0$。\n    *   单位：所有物理量均指定使用原子单位。\n    *   参数：提供了五个测试案例，并为 $(D_e,a,q_e,m,q_0,v_0,h,N)$ 指定了数值。\n\n2.  **验证结论：**\n    该问题是 **有效** 的。它在经典力学方面有科学依据，在数学上是适定的，并且为获得唯一的数值解提供了所有必要信息。Morse 势和速度 Verlet 算法的使用是理论化学中的标准实践。该问题是对既定原则的直接应用，不包含任何歧义、矛盾或事实错误。提供的测试案例中有两个（案例 3 和案例 5）代表了平凡的动力学过程，可作为对任何正确实现的逻辑检验。\n\n**求解推导**\n\n求解过程分三步：力的推导、积分算法的构建以及能量计算的说明。\n\n**1. 力的推导**\n力 $F(q)$ 是势能 $V(q)$ 的负梯度。势能由下式给出：\n$$V(q) = D_e\\left(1 - \\exp\\left(-a(q - q_e)\\right)\\right)^2$$\n为了求出力，我们必须计算导数 $\\mathrm{d}V/\\mathrm{d}q$。根据链式法则，设 $u(q) = -a(q - q_e)$。则 $V(q) = D_e(1 - e^u)^2$。\n$$\\frac{\\mathrm{d}V}{\\mathrm{d}q} = \\frac{\\mathrm{d}V}{\\mathrm{d}u} \\frac{\\mathrm{d}u}{\\mathrm{d}q}$$\n各个导数分别为：\n$$\\frac{\\mathrm{d}V}{\\mathrm{d}u} = D_e \\cdot 2(1 - e^u) \\cdot \\frac{d}{du}(1-e^u) = D_e \\cdot 2(1 - e^u) \\cdot (-e^u) = -2D_e(e^u - e^{2u})$$\n$$\\frac{\\mathrm{d}u}{\\mathrm{d}q} = -a$$\n合并这些结果可得：\n$$\\frac{\\mathrm{d}V}{\\mathrm{d}q} = \\left(-2D_e(e^u - e^{2u})\\right) \\cdot (-a) = 2aD_e(e^u - e^{2u})$$\n将 $u = -a(q-q_e)$ 代回表达式，得到：\n$$\\frac{\\mathrm{d}V}{\\mathrm{d}q} = 2aD_e \\left(\\exp\\left(-a(q-q_e)\\right) - \\exp\\left(-2a(q-q_e)\\right)\\right)$$\n因此，力 $F(q) = -\\mathrm{d}V/\\mathrm{d}q$ 为：\n$$F(q) = -2aD_e \\left(\\exp\\left(-a(q-q_e)\\right) - \\exp\\left(-2a(q-q_e)\\right)\\right)$$\n该表达式将用于计算每个时间步的力。\n\n**2. 速度 Verlet 算法**\n速度 Verlet 算法是一种用于求解牛顿运动方程的二阶辛积分器。给定在时间 $t_n = n h$ 的位置 $q_n$、速度 $v_n$ 和力 $F_n = F(q_n)$，下一个时间步 $t_{n+1} = (n+1)h$ 的状态计算如下。\n\n首先，将位置推进一个完整的时间步 $h$：\n$$q_{n+1} = q_n + v_n h + \\frac{1}{2} \\frac{F_n}{m} h^2$$\n接下来，在新位置 $q_{n+1}$ 处计算力 $F_{n+1}$：\n$$F_{n+1} = F(q_{n+1})$$\n最后，使用旧力和新力的平均值更新速度：\n$$v_{n+1} = v_n + \\frac{h}{2m} (F_n + F_{n+1})$$\n从初始条件 $(q_0, v_0)$ 开始，将此操作序列重复 $N$ 步。\n\n**3. 能量计算与漂移**\n对于状态 $(q,v)$，在任意时刻的总能量 $E$ 是动能 $K$ 和势能 $V$ 的和：\n$$E(q,v) = K(v) + V(q) = \\frac{1}{2}mv^2 + D_e\\left(1 - \\exp\\left(-a(q-q_e)\\right)\\right)^2$$\n初始能量在 $t=0$ 时计算：\n$$E_0 = E(q_0, v_0)$$\n经过 $N$ 个积分步骤后，系统处于最终状态 $(q_N, v_N)$。最终能量为：\n$$E_N = E(q_N, v_N)$$\n能量漂移 $\\Delta E$ 是最终能量与初始能量之差：\n$$\\Delta E = E_N - E_0$$\n对于一个保守系统的完美积分，$\\Delta E$ 应为零。对于数值化的速度 Verlet 方案，能量并非精确守恒，但它会围绕真值表现出有界涨落，并且没有长期的系统性漂移。这些涨落的幅度取决于时间步长 $h$。\n\n在案例 3 中，$q_0 = q_e$ 且 $v_0 = 0$，初始力为 $F(q_e) = 0$。粒子在势阱的最低点处于静止状态。该算法将正确地使粒子保持静止，因此对所有 $n$ 都有 $q_n = q_e$ 和 $v_n = 0$。因此，$E_N = E_0$，能量漂移 $\\Delta E$ 必须精确为 $0.0$。\n\n在案例 5 中，步数 $N=0$，不执行任何积分。最终状态与初始状态相同，因此 $q_N = q_0$ 和 $v_N = v_0$。能量漂移 $\\Delta E = E_0 - E_0$ 显然为 $0.0$。这些案例可用于验证实现的正确性。程序将遵循这些推导出的公式来计算每个测试案例的能量漂移，最终结果按要求四舍五入到小数点后 10 位。\n```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run simulations for all test cases and print results.\n    \"\"\"\n\n    # Helper functions for physical quantities, defined within the scope of solve()\n    # to keep the solution self-contained.\n\n    def get_potential(q, De, a, qe):\n        \"\"\"Calculates the Morse potential energy.\"\"\"\n        return De * (1.0 - np.exp(-a * (q - qe)))**2\n\n    def get_force(q, De, a, qe):\n        \"\"\"Calculates the force derived from the Morse potential.\"\"\"\n        exp_term = np.exp(-a * (q - qe))\n        return -2.0 * a * De * (exp_term - exp_term**2)\n\n    def get_total_energy(q, v, De, a, qe, m):\n        \"\"\"Calculates the total energy (kinetic + potential).\"\"\"\n        kinetic_energy = 0.5 * m * v**2\n        potential_energy = get_potential(q, De, a, qe)\n        return kinetic_energy + potential_energy\n\n    def run_simulation(De, a, qe, m, q0, v0, h, N):\n        \"\"\"\n        Runs a velocity Verlet simulation for a single parameter set.\n\n        Args:\n            De, a, qe: Morse potential parameters.\n            m: Mass of the particle.\n            q0, v0: Initial position and velocity.\n            h: Time step size.\n            N: Number of integration steps.\n\n        Returns:\n            The energy drift (E_final - E_initial).\n        \"\"\"\n        # Handle the trivial case of zero steps.\n        if N == 0:\n            return 0.0\n\n        # Handle the trivial stationary case where the particle starts at rest at the potential minimum.\n        if q0 == qe and v0 == 0.0:\n            return 0.0\n\n        # Initial state\n        q = float(q0)\n        v = float(v0)\n\n        # Calculate initial energy\n        E0 = get_total_energy(q, v, De, a, qe, m)\n\n        # Calculate initial force needed for the first step\n        force = get_force(q, De, a, qe)\n\n        # Velocity Verlet integration loop\n        for _ in range(int(N)):\n            # Update position to a full step\n            q_new = q + v * h + 0.5 * (force / m) * h**2\n\n            # Calculate force at the new position\n            force_new = get_force(q_new, De, a, qe)\n\n            # Update velocity with the average of old and new forces\n            v_new = v + 0.5 * ((force + force_new) / m) * h\n\n            # Update state for the next iteration\n            q, v, force = q_new, v_new, force_new\n\n        # Calculate final energy\n        E_final = get_total_energy(q, v, De, a, qe, m)\n        \n        energy_drift = E_final - E0\n        return energy_drift\n\n    # Test suite from the problem statement.\n    # Each tuple contains: (De, a, qe, m, q0, v0, h, N)\n    test_cases = [\n        (0.176, 1.02, 0.0, 1836.0, 0.2, 0.0, 0.2, 1000),\n        (0.176, 1.02, 0.0, 1836.0, 0.2, 0.0, 0.02, 10000),\n        (0.176, 1.02, 0.0, 1836.0, 0.0, 0.0, 0.5, 100),\n        (0.176, 1.02, 0.0, 1836.0, 1.0, -0.05, 0.4, 800),\n        (0.176, 1.02, 0.0, 1836.0, 0.3, 0.1, 0.1, 0),\n    ]\n\n    results = []\n    for case in test_cases:\n        drift = run_simulation(*case)\n        # Round the result to 10 decimal places as required.\n        results.append(round(drift, 10))\n\n    # Format the results into the specified string format.\n    # Using f-string with .10f ensures fixed-point notation and avoids scientific notation.\n    formatted_results = [f\"{r:.10f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n# Execute the main function.\n# solve()\n```", "answer": "[0.0000216601,0.0000000022,0.0000000000,0.0039233633,0.0000000000]", "id": "2780514"}, {"introduction": "虽然速度Verlet等二阶算法在大多数应用中表现出色，但追求更高的精度是算法发展的恒久主题。如何基于一个简单的二阶算法构建出更精确的高阶算法呢？本高级练习 [@problem_id:2780487] 将带你进入由Yoshida等先驱开创的算符分裂与组合方法的世界。你将使用刘维尔算符和Baker-Campbell-Hausdorff (BCH) 公式，通过巧妙地组合多个二阶积分步骤来系统性地消除低阶误差项，从而推导出一种经典的四阶辛积分器及其系数。", "problem": "考虑在 Born–Oppenheimer 势能面上，原子核的经典分子动力学 (MD) 轨迹，其哈密顿量 $H(\\mathbf{q},\\mathbf{p})=T(\\mathbf{p})+V(\\mathbf{q})$ 是可分离的，其中 $T(\\mathbf{p})$ 是动能，$V(\\mathbf{q})$ 是势能。令 $L_T$ 和 $L_V$ 为刘维尔算符，对于任意光滑相空间函数 $f(\\mathbf{q},\\mathbf{p})$，定义为 $L_T f=\\{f,T\\}$ 和 $L_V f=\\{f,V\\}$，其中 $\\{\\,\\cdot\\,,\\,\\cdot\\,\\}$ 是泊松括号。精确的时间-$h$ 流为 $\\exp(h(L_T+L_V))$。对称二阶 (速度 Verlet) 分裂可以写成漂移–踢–漂移 (DKD) 形式：\n$$\nS_2(h)\\equiv \\exp\\!\\left(\\tfrac{h}{2}L_T\\right)\\,\\exp\\!\\left(h L_V\\right)\\,\\exp\\!\\left(\\tfrac{h}{2}L_T\\right),\n$$\n该方法是辛的、时间可逆的，并且具有二阶精度。\n\n你的任务是利用 Yoshida 的三步跳跃组合方法，通过这个二阶方法构建一个四阶辛积分器。考虑对称组合\n$$\nS_4(h)\\equiv S_2(c_1 h)\\,S_2(c_2 h)\\,S_2(c_1 h),\n$$\n其中实常数 $c_1$ 和 $c_2$ 的选择是为了通过消去由 $S_2$ 产生的主导三阶误差，从而将阶数提升到四阶。从算符表示出发，仅使用泊松括号、刘维尔算符和 Baker–Campbell–Hausdorff (BCH) 展开的基本性质，推导 $c_1$ 和 $c_2$ 必须满足的阶数条件，并求解 $c_1$ 和 $c_2$ 的闭式解。\n\n然后，通过合并相邻的同类算符，将 $S_4(h)$ 显式地重写为单个 DKD 格式，\n$$\n\\exp(a_1 h L_T)\\,\\exp(b_1 h L_V)\\,\\exp(a_2 h L_T)\\,\\exp(b_2 h L_V)\\,\\exp(a_3 h L_T)\\,\\exp(b_3 h L_V)\\,\\exp(a_4 h L_T),\n$$\n并以精确解析形式表示出具体的漂移系数 $a_1,a_2,a_3,a_4$ 和踢系数 $b_1,b_2,b_3$。\n\n以单行矩阵 $(a_1,\\,a_2,\\,a_3,\\,a_4,\\,b_1,\\,b_2,\\,b_3)$ 的形式报告你的最终答案，要求是精确形式（无数值舍入）。这些系数不需要物理单位。", "solution": "问题陈述经评估有效。它是自洽的，其科学基础根植于理论力学和数值分析的原理，并且是适定的，允许一个唯一且可验证的解。其目标是构建一个特定的四阶辛积分器，这是该领域一个标准且非平凡的任务。\n\n我们从可分离哈密顿量 $H = T + V$ 开始。步长为 $h$ 的时间演化算符由刘维尔算符的指数作用给出，$U(h) = \\exp(h L_H) = \\exp(h(L_T+L_V))$。一个二阶对称积分器 $S_2(h)$ 以漂移-踢-漂移 (DKD) 形式给出：\n$$\nS_2(h) = \\exp\\left(\\frac{h}{2}L_T\\right) \\exp(h L_V) \\exp\\left(\\frac{h}{2}L_T\\right)\n$$\n为分析此方法的阶数，我们使用对称 Baker-Campbell-Hausdorff (BCH) 公式，它给出了对称乘积的生成元：\n$$\n\\exp\\left(\\frac{X}{2}\\right) \\exp(Y) \\exp\\left(\\frac{X}{2}\\right) = \\exp\\left(X+Y + \\frac{1}{24}[Y,[Y,X]] - \\frac{1}{12}[X,[X,Y]] + \\mathcal{O}(h^5)\\right)\n$$\n令 $X = h L_T$ 和 $Y = h L_V$，$S_2(h)$ 的生成元是一个有效刘维尔算符 $L_{\\text{eff}}(h)$，其中 $S_2(h) = \\exp(h L_{\\text{eff}}(h))$。其展开式为：\n$$\nh L_{\\text{eff}}(h) = h(L_T+L_V) + \\frac{h^3}{24}[L_V,[L_V,L_T]] - \\frac{h^3}{12}[L_T,[L_T,L_V]] + \\mathcal{O}(h^5)\n$$\n这表明 $S_2(h)$ 与精确传播子 $\\exp(h(L_T+L_V))$ 相差 $\\mathcal{O}(h^3)$ 阶的项，使其成为一个二阶方法。注意，生成元展开式只包含 $h$ 的奇次幂，这是对称算法的一个特性。生成元中的主导误差项是 $\\mathcal{O}(h^2)$ 阶的。我们定义主导误差算符 $E_3$：\n$$\nE_3 = \\frac{1}{24}[L_V,[L_V,L_T]] - \\frac{1}{12}[L_T,[L_T,L_V]]\n$$\n因此，$S_2(h)$ 的生成元可以写为 $h L_{\\text{eff}}(h) = h(L_T+L_V) + h^3 E_3 + \\mathcal{O}(h^5)$。\n\n我们通过对三个具有缩放时间步长 $c_1 h$、$c_2 h$ 和 $c_1 h$ 的二阶步进行对称组合，来构造四阶积分器 $S_4(h)$：\n$$\nS_4(h) = S_2(c_1 h)\\,S_2(c_2 h)\\,S_2(c_1 h)\n$$\n每个组成步 $S_2(c_i h)$ 的生成元是：\n$$\n\\text{gen}(S_2(c_i h)) = (c_i h)(L_T+L_V) + (c_i h)^3 E_3 + \\mathcal{O}(h^5)\n$$\n再次应用 BCH 公式来组合这三个算符， $S_4(h)$ 的生成元近似为各个生成元的和：\n$$\n\\text{gen}(S_4(h)) \\approx \\text{gen}(S_2(c_1 h)) + \\text{gen}(S_2(c_2 h)) + \\text{gen}(S_2(c_1 h))\n$$\n$$\n\\text{gen}(S_4(h)) = 2\\left[(c_1 h)(L_T+L_V) + (c_1 h)^3 E_3\\right] + \\left[(c_2 h)(L_T+L_V) + (c_2 h)^3 E_3\\right] + \\mathcal{O}(h^5)\n$$\n$$\n\\text{gen}(S_4(h)) = (2c_1+c_2)h(L_T+L_V) + (2c_1^3+c_2^3)h^3 E_3 + \\mathcal{O}(h^5)\n$$\n为使 $S_4(h)$ 成为精确传播子 $\\exp(h(L_T+L_V))$ 的一致近似，其生成元必须尽可能地与 $h(L_T+L_V)$ 匹配。要成为一个四阶方法，我们必须消去生成元中的 $\\mathcal{O}(h^3)$ 误差项。这对系数 $c_1$ 和 $c_2$ 施加了两个条件：\n1. $\\mathcal{O}(h)$ 项的系数必须为 1：$2c_1 + c_2 = 1$。\n2. $\\mathcal{O}(h^3)$ 项的系数必须为 0：$2c_1^3 + c_2^3 = 0$。\n\n我们现在求解这个非线性方程组。由第一个方程，得 $c_2 = 1 - 2c_1$。将其代入第二个方程：\n$$\n2c_1^3 + (1 - 2c_1)^3 = 0\n$$\n$$\n2c_1^3 + (1 - 6c_1 + 12c_1^2 - 8c_1^3) = 0\n$$\n$$\n-6c_1^3 + 12c_1^2 - 6c_1 + 1 = 0\n$$\n另一种方法是，从 $2c_1^3 + c_2^3 = 0$ 可得 $c_2^3 = -2c_1^3$，这意味着 $c_2 = -2^{1/3} c_1$。将此代入第一个方程：\n$$\n2c_1 - 2^{1/3}c_1 = 1 \\implies c_1(2 - 2^{1/3}) = 1\n$$\n这给出 $c_1$ 的解：\n$$\nc_1 = \\frac{1}{2 - 2^{1/3}}\n$$\n和 $c_2$ 的解：\n$$\nc_2 = 1 - 2c_1 = 1 - \\frac{2}{2 - 2^{1/3}} = \\frac{2 - 2^{1/3} - 2}{2 - 2^{1/3}} = \\frac{-2^{1/3}}{2 - 2^{1/3}}\n$$\n接下来，我们展开 $S_4(h)$ 以找到其漂移和踢算符的显式序列：\n$$\nS_4(h) = S_2(c_1 h)\\,S_2(c_2 h)\\,S_2(c_1 h)\n$$\n代入 $S_2(\\tau) = \\exp(\\frac{\\tau}{2}L_T) \\exp(\\tau L_V) \\exp(\\frac{\\tau}{2}L_T)$ 的定义：\n$$\nS_4(h) = \\left[\\exp\\left(\\frac{c_1 h}{2}L_T\\right) \\exp(c_1 h L_V) \\exp\\left(\\frac{c_1 h}{2}L_T\\right)\\right] \\left[\\exp\\left(\\frac{c_2 h}{2}L_T\\right) \\exp(c_2 h L_V) \\exp\\left(\\frac{c_2 h}{2}L_T\\right)\\right] \\left[\\exp\\left(\\frac{c_1 h}{2}L_T\\right) \\exp(c_1 h L_V) \\exp\\left(\\frac{c_1 h}{2}L_T\\right)\\right]\n$$\n同类型的算符可以通过相加其指数来合并：若 $[X,Y]=0$，则 $\\exp(X)\\exp(Y) = \\exp(X+Y)$。我们合并相邻的漂移算符：\n\\begin{align*}\nS_4(h) = \\exp\\left(\\frac{c_1 h}{2}L_T\\right) \\exp(c_1 h L_V) \\left[\\exp\\left(\\frac{c_1 h}{2}L_T\\right)\\exp\\left(\\frac{c_2 h}{2}L_T\\right)\\right] \\exp(c_2 h L_V) \\\\\n\\left[\\exp\\left(\\frac{c_2 h}{2}L_T\\right)\\exp\\left(\\frac{c_1 h}{2}L_T\\right)\\right] \\exp(c_1 h L_V) \\exp\\left(\\frac{c_1 h}{2}L_T\\right)\n\\end{align*}\n这可以简化为：\n$$\nS_4(h) = \\exp\\left(\\frac{c_1 h}{2}L_T\\right) \\exp(c_1 h L_V) \\exp\\left(\\frac{(c_1+c_2)h}{2}L_T\\right) \\exp(c_2 h L_V) \\exp\\left(\\frac{(c_1+c_2)h}{2}L_T\\right) \\exp(c_1 h L_V) \\exp\\left(\\frac{c_1 h}{2}L_T\\right)\n$$\n这个表达式与目标形式匹配：\n$$\n\\exp(a_1 h L_T)\\,\\exp(b_1 h L_V)\\,\\exp(a_2 h L_T)\\,\\exp(b_2 h L_V)\\,\\exp(a_3 h L_T)\\,\\exp(b_3 h L_V)\\,\\exp(a_4 h L_T)\n$$\n通过比较指数，我们确定系数 $a_i$ 和 $b_i$：\n$a_1 = \\frac{c_1}{2}$\n$b_1 = c_1$\n$a_2 = \\frac{c_1+c_2}{2}$\n$b_2 = c_2$\n$a_3 = \\frac{c_1+c_2}{2}$\n$b_3 = c_1$\n$a_4 = \\frac{c_1}{2}$\n\n最后，我们代入 $c_1$ 和 $c_2$ 的表达式：\n$c_1+c_2 = \\frac{1}{2-2^{1/3}} + \\frac{-2^{1/3}}{2-2^{1/3}} = \\frac{1-2^{1/3}}{2-2^{1/3}}$。\n\n系数为：\n$a_1 = a_4 = \\frac{1}{2}c_1 = \\frac{1}{2(2-2^{1/3})}$\n$a_2 = a_3 = \\frac{1}{2}(c_1+c_2) = \\frac{1-2^{1/3}}{2(2-2^{1/3})}$\n$b_1 = b_3 = c_1 = \\frac{1}{2-2^{1/3}}$\n$b_2 = c_2 = \\frac{-2^{1/3}}{2-2^{1/3}}$\n\n作为检验，漂移系数之和为 $\\sum a_i = 2a_1 + 2a_2 = c_1 + (c_1+c_2) = 2c_1+c_2 = 1$。踢系数之和为 $\\sum b_i = 2b_1 + b_2 = 2c_1 + c_2 = 1$。这是正确的，因为总漂移时间和总踢时间必须等于完整时间步长 $h$。\n最终系数按要求以精确解析形式给出。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{2(2 - 2^{1/3})},  \\frac{1 - 2^{1/3}}{2(2 - 2^{1/3})},  \\frac{1 - 2^{1/3}}{2(2 - 2^{1/3})},  \\frac{1}{2(2 - 2^{1/3})},  \\frac{1}{2 - 2^{1/3}},  \\frac{-2^{1/3}}{2 - 2^{1/3}},  \\frac{1}{2 - 2^{1/3}}\n\\end{pmatrix}\n}\n$$", "id": "2780487"}]}