{
    "hands_on_practices": [
        {
            "introduction": "Every empirical force field is built upon fundamental potential energy functions that describe interatomic interactions. A crucial first step toward mastering their use is to connect a potential's mathematical form to its physical consequences. This exercise  provides foundational practice by dissecting the Morse potential, a widely used and physically intuitive model for diatomic bonds. By analytically deriving the force, bond stiffness, and vibrational frequency, you will gain a deep understanding of how potential parameters like $D_e$ and $a$ govern the mechanical and spectroscopic properties of chemical bonds in geochemical systems.",
            "id": "4078096",
            "problem": "A diatomic interaction in a mineral lattice is modeled by the Morse potential\n$$U(r)=D_{e}\\left(1-\\exp\\left(-a\\left(r-r_{e}\\right)\\right)\\right)^{2}$$\nwhere $r$ is the interatomic separation, $r_{e}$ is the equilibrium bond length, $D_{e}$ is the dissociation energy (well depth), and $a$ is an inverse length setting the range and curvature scale of the potential. Starting from classical mechanics definitions, derive the force $F(r)$ as the negative gradient of the potential energy with respect to $r$. Using the harmonic approximation near $r=r_{e}$, identify the effective bond stiffness and the small-amplitude vibrational frequency for a diatomic unit of reduced mass $\\mu$, expressed in terms of $a$ and $D_{e}$. Explain the physical meaning of these relations in the context of vibrational units such as oxygen–hydrogen and silicon–oxygen pairs embedded in mineral frameworks, highlighting why the Morse form is suitable for anharmonic stretching. Provide the final results as closed-form analytic expressions for $F(r)$, the bond stiffness, and the vibrational frequency. No numerical evaluation is required, and no rounding is needed. Do not include any units in your final expressions.",
            "solution": "The problem statement is evaluated as scientifically grounded, well-posed, objective, and complete. It is a standard problem in molecular physics and computational chemistry, based on the well-established Morse potential model. All necessary parameters and definitions for the derivation are provided. Therefore, the problem is deemed valid and a full solution will be provided.\n\nThe interatomic potential energy is given by the Morse potential:\n$$\nU(r) = D_{e}\\left(1-\\exp\\left(-a\\left(r-r_{e}\\right)\\right)\\right)^{2}\n$$\nwhere $r$ is the interatomic separation, $r_e$ is the equilibrium separation, $D_e$ is the dissociation energy, and $a$ is a parameter controlling the width of the potential well.\n\nFirst, we derive the force $F(r)$ acting between the two atoms. The force is the negative gradient of the potential energy. For a one-dimensional potential that depends only on the separation $r$, this relationship is:\n$$\nF(r) = -\\frac{dU(r)}{dr}\n$$\nWe compute the derivative of $U(r)$ with respect to $r$ using the chain rule. Let $u(r) = -a(r-r_e)$, so $\\frac{du}{dr} = -a$.\nThe potential is $U(r) = D_e(1 - \\exp(u(r)))^2$.\n$$\n\\frac{dU}{dr} = D_{e} \\cdot 2\\left(1-\\exp\\left(-a\\left(r-r_{e}\\right)\\right)\\right) \\cdot \\frac{d}{dr}\\left(1-\\exp\\left(-a\\left(r-r_{e}\\right)\\right)\\right)\n$$\n$$\n\\frac{dU}{dr} = 2D_{e}\\left(1-\\exp\\left(-a\\left(r-r_{e}\\right)\\right)\\right) \\cdot \\left(-\\exp\\left(-a\\left(r-r_{e}\\right)\\right) \\cdot (-a)\\right)\n$$\n$$\n\\frac{dU}{dr} = 2aD_{e}\\left(1-\\exp\\left(-a\\left(r-r_{e}\\right)\\right)\\right)\\exp\\left(-a\\left(r-r_{e}\\right)\\right)\n$$\nThe force is the negative of this derivative:\n$$\nF(r) = -2aD_{e}\\left(1-\\exp\\left(-a\\left(r-r_{e}\\right)\\right)\\right)\\exp\\left(-a\\left(r-r_{e}\\right)\\right)\n$$\nThis expression can be expanded to $F(r) = -2aD_{e}\\left(\\exp\\left(-a\\left(r-r_{e}\\right)\\right) - \\exp\\left(-2a\\left(r-r_{e}\\right)\\right)\\right)$. At equilibrium, $r=r_e$, the force is $F(r_e) = -2aD_e(\\exp(0) - \\exp(0)) = 0$, as expected.\n\nNext, we employ the harmonic approximation to find the effective bond stiffness and vibrational frequency. The harmonic approximation is valid for small displacements from equilibrium, $x = r - r_e$. We expand the potential $U(r)$ as a Taylor series around $r=r_e$ and truncate after the second-order term:\n$$\nU(r) \\approx U(r_e) + \\left.\\frac{dU}{dr}\\right|_{r=r_e}(r-r_e) + \\frac{1}{2}\\left.\\frac{d^2U}{dr^2}\\right|_{r=r_e}(r-r_e)^2\n$$\nLet's evaluate the terms at $r=r_e$:\n$U(r_e) = D_e(1-\\exp(-a(r_e-r_e)))^2 = D_e(1-1)^2 = 0$. This sets the potential energy minimum to zero.\n$\\left.\\frac{dU}{dr}\\right|_{r=r_e} = 2aD_e(1-\\exp(0))\\exp(0) = 0$. This confirms that $r_e$ is an extremum, specifically a minimum.\n\nThe potential for small displacements is thus approximated by:\n$$\nU(r) \\approx \\frac{1}{2}\\left.\\frac{d^2U}{dr^2}\\right|_{r=r_e}(r-r_e)^2\n$$\nThis is the potential energy of a simple harmonic oscillator, $U(x) = \\frac{1}{2}kx^2$, where the effective bond stiffness (or force constant) $k$ is given by the second derivative of the potential at equilibrium:\n$$\nk = \\left.\\frac{d^2U}{dr^2}\\right|_{r=r_e}\n$$\nWe must first find the second derivative of $U(r)$:\n$$\n\\frac{d^2U}{dr^2} = \\frac{d}{dr}\\left(2aD_{e}\\left(\\exp\\left(-a\\left(r-r_{e}\\right)\\right) - \\exp\\left(-2a\\left(r-r_{e}\\right)\\right)\\right)\\right)\n$$\n$$\n\\frac{d^2U}{dr^2} = 2aD_{e}\\left(-a\\exp\\left(-a\\left(r-r_{e}\\right)\\right) - (-2a)\\exp\\left(-2a\\left(r-r_{e}\\right)\\right)\\right)\n$$\n$$\n\\frac{d^2U}{dr^2} = 2aD_{e}\\left(-a\\exp\\left(-a\\left(r-r_{e}\\right)\\right) + 2a\\exp\\left(-2a\\left(r-r_{e}\\right)\\right)\\right)\n$$\nNow, we evaluate this expression at $r=r_e$:\n$$\nk = \\left.\\frac{d^2U}{dr^2}\\right|_{r=r_e} = 2aD_{e}\\left(-a\\exp(0) + 2a\\exp(0)\\right) = 2aD_{e}(-a + 2a) = 2a^2D_e\n$$\nSo, the effective bond stiffness is $k = 2a^2D_e$.\n\nFinally, we determine the small-amplitude vibrational frequency. The classical equation of motion for a two-body system oscillating about its equilibrium is given by $\\mu \\ddot{x} = -kx$, where $\\mu$ is the reduced mass of the system and $x=r-r_e$. This is the equation for simple harmonic motion, which has a solution with angular frequency $\\omega$:\n$$\n\\omega = \\sqrt{\\frac{k}{\\mu}}\n$$\nSubstituting our derived expression for $k$:\n$$\n\\omega = \\sqrt{\\frac{2a^2D_e}{\\mu}} = a\\sqrt{\\frac{2D_e}{\\mu}}\n$$\nThis is the angular frequency of small-amplitude vibrations.\n\nThe physical meaning of these relations is significant. The bond stiffness $k=2a^2D_e$ shows that the bond's resistance to stretching depends quadratically on the potential's curvature parameter $a$ and linearly on the bond dissociation energy $D_e$. Stronger bonds (larger $D_e$) and more narrowly confined bonds (larger $a$) are stiffer. For units like oxygen–hydrogen (O–H) and silicon–oxygen (Si–O) in minerals, these parameters reflect the strength of the covalent bonding. The vibrational frequency $\\omega = a\\sqrt{2D_e/\\mu}$ shows that stiffer bonds and lighter atoms (smaller $\\mu$) vibrate at higher frequencies. O-H bonds, with a very small reduced mass due to the hydrogen atom, exhibit very high vibrational frequencies, a key signature in spectroscopy. Si-O bonds, while also stiff, involve heavier atoms and thus vibrate at lower frequencies than O-H.\n\nThe Morse potential is a superior model to the simple harmonic oscillator for describing bond stretching because it incorporates anharmonicity. This is evident in its asymmetry: it rises more steeply for compression ($r < r_e$) than for extension ($r > r_e$), correctly modeling the strong Pauli repulsion at short distances and the gradual bond weakening upon stretching. Most importantly, as $r \\to \\infty$, $U(r) \\to D_e$, meaning the potential correctly models bond dissociation at a finite energy, a physical reality that the parabolic harmonic potential ($U \\to \\infty$ as $|r-r_e| \\to \\infty$) fails to capture. This anharmonicity is essential for explaining phenomena such as thermal expansion and the appearance of overtone bands in vibrational spectra.\n\nThe final results for the force, bond stiffness, and angular vibrational frequency are provided below.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -2aD_{e}\\left(1-\\exp\\left(-a\\left(r-r_{e}\\right)\\right)\\right)\\exp\\left(-a\\left(r-r_{e}\\right)\\right) & 2a^2D_e & a\\sqrt{\\frac{2D_e}{\\mu}} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "While analytical potentials often extend to infinite distance, practical computer simulations must truncate them at a finite cutoff radius $r_c$ to remain computationally tractable. This necessary approximation, however, can introduce significant artifacts affecting the accuracy and stability of a simulation if not handled with care. This practice problem  addresses this critical challenge by exploring standard methods to create smooth, continuous potentials and to add analytical \"tail corrections\" that account for the missing long-range interactions. Mastering these techniques is essential for performing reliable molecular dynamics simulations of bulk thermodynamic properties like energy and pressure.",
            "id": "4078131",
            "problem": "Consider a homogeneous, isotropic, monatomic fluid at number density $\\rho$ interacting via a pairwise additive potential. A widely used empirical interatomic potential in computational geochemistry is the Lennard–Jones $12$–$6$ form, \n$$u(r) = 4 \\varepsilon \\left[ \\left( \\frac{\\sigma}{r} \\right)^{12} - \\left( \\frac{\\sigma}{r} \\right)^{6} \\right]$$\nwhere $\\varepsilon$ sets the well depth and $\\sigma$ sets the length scale. In practical simulations, a radial cutoff $r_{c}$ is imposed to limit the interaction range. The truncated potential can be written as $u_{t}(r) = u(r) \\, \\Theta(r_{c} - r)$, where $\\Theta$ is the Heaviside step function. Truncation affects thermodynamic observables such as energy and pressure, and can introduce discontinuities in $u(r)$ and $u'(r)$ at $r_{c}$. To mitigate these, one can employ a shifted-potential scheme or a shifted-force scheme that modifies $u(r)$ for $r < r_{c}$.\n\nYour tasks:\n\n- Starting from fundamental definitions of the potential energy in a homogeneous fluid and the pressure from the mechanical (virial) route, analyze how imposing a radial cutoff $r_{c}$ modifies these quantities. Identify the terms that are lost by truncation and any impulsive contributions that arise from discontinuities when $u_{t}(r)$ is used, explaining the role of $\\Theta$ and the Dirac delta function $\\delta$ in the derivation.\n\n- Derive the shifted-potential scheme $u_{\\text{sp}}(r)$ that enforces continuity of $u(r)$ at $r_{c}$ and the shifted-force scheme $u_{\\text{sf}}(r)$ that enforces continuity of $u'(r)$ at $r_{c}$. Provide explicit expressions for $u_{\\text{sp}}(r)$ and $u_{\\text{sf}}(r)$ for $r < r_{c}$, and $0$ for $r \\ge r_{c}$. For the Lennard–Jones $12$–$6$ potential, obtain $u(r_{c})$ and $u'(r_{c})$ in terms of $\\varepsilon$, $\\sigma$, and $r_{c}$, and show how they appear in $u_{\\text{sp}}(r)$ and $u_{\\text{sf}}(r)$.\n\n- Assuming the high-temperature, low-density limit in which the radial distribution function (RDF) $g(r)$ satisfies $g(r) \\to 1$ for $r \\ge r_{c}$, design analytic tail corrections that restore the bulk potential energy per particle and the virial pressure lost due to truncation. Express the energy tail correction per particle $\\Delta U/N$ and the pressure tail correction $\\Delta P$ in terms of $\\varepsilon$, $\\sigma$, $\\rho$, and $r_{c}$ for the Lennard–Jones $12$–$6$ potential.\n\nProvide your final answer as a single row matrix containing two entries $\\left[ \\Delta U/N, \\, \\Delta P \\right]$. For clarity, the implied physical units are Joules per particle for $\\Delta U/N$ and Pascals for $\\Delta P$, but do not append units to your final expressions. Do not perform any numerical evaluation. The final row matrix must be presented exactly as specified in the instructions.",
            "solution": "We consider a homogeneous, isotropic, monatomic fluid with number density $\\rho$, interacting via a pairwise additive potential $u(r)$, where $r$ is the scalar interparticle separation. The fundamental expressions we use are the following well-tested formulas:\n\n(1) The configurational potential energy per particle in a homogeneous, isotropic system is\n$$\n\\frac{U}{N} = \\frac{1}{2} \\rho \\int_{0}^{\\infty} 4 \\pi r^{2} \\, u(r) \\, g(r) \\, dr,\n$$\nwhere $g(r)$ is the radial distribution function (RDF).\n\n(2) The pressure from the mechanical (virial) route is\n$$\nP = \\rho k_{B} T - \\frac{2 \\pi}{3} \\rho^{2} \\int_{0}^{\\infty} r^{3} \\, u'(r) \\, g(r) \\, dr,\n$$\nwhere $k_{B}$ is the Boltzmann constant and $T$ is the temperature, and $u'(r) = \\frac{du}{dr}$.\n\nWe now analyze the consequences of imposing a radial cutoff $r_{c}$ by defining a truncated potential $u_{t}(r) = u(r) \\, \\Theta(r_{c} - r)$, where $\\Theta(x)$ is the Heaviside step function, with $\\Theta(x) = 1$ for $x > 0$ and $\\Theta(x) = 0$ for $x < 0$. The derivative of $u_{t}(r)$ involves distributions:\n$$\n\\frac{d}{dr} \\left[ u(r) \\, \\Theta(r_{c} - r) \\right] = u'(r) \\, \\Theta(r_{c} - r) - u(r_{c}) \\, \\delta(r - r_{c}),\n$$\nwhere $\\delta$ is the Dirac delta function and we used $\\frac{d}{dr} \\Theta(r_{c} - r) = - \\delta(r - r_{c})$. In the virial integral for $P$, this $\\delta$-term contributes an impulsive correction proportional to $u(r_{c})$:\n$$\n\\int_{0}^{\\infty} r^{3} \\left[ u'(r) \\, \\Theta(r_{c} - r) - u(r_{c}) \\, \\delta(r - r_{c}) \\right] g(r) \\, dr\n= \\int_{0}^{r_{c}} r^{3} u'(r) g(r) \\, dr - r_{c}^{3} u(r_{c}) g(r_{c}).\n$$\nThus, truncation not only removes the tail ($r > r_{c}$) contributions from both $U/N$ and $P$, but, if one uses $u_{t}(r)$, it also introduces an impulsive term in the virial proportional to $u(r_{c})$.\n\nTo mitigate discontinuities, we construct schemes that enforce continuity conditions at $r_{c}$.\n\nShifted-potential scheme: We seek $u_{\\text{sp}}(r)$ that is continuous at $r_{c}$ and vanishes for $r \\ge r_{c}$:\n$$\nu_{\\text{sp}}(r) =\n\\begin{cases}\nu(r) - u(r_{c}), & r < r_{c}, \\\\\n0, & r \\ge r_{c}.\n\\end{cases}\n$$\nBy construction, $u_{\\text{sp}}(r_{c}^{-}) = 0 = u_{\\text{sp}}(r_{c}^{+})$, so there is no jump in $u(r)$ and hence the $\\delta$-term proportional to $u(r_{c})$ in the virial is eliminated. However, $u_{\\text{sp}}'(r)$ at $r_{c}$ remains discontinuous unless $u'(r_{c}) = 0$.\n\nShifted-force scheme: We seek $u_{\\text{sf}}(r)$ that enforces not only $u_{\\text{sf}}(r_{c}) = 0$ but also $u_{\\text{sf}}'(r_{c}) = 0$, ensuring both the potential and its derivative are continuous at $r_{c}$. A minimal construction is to subtract a linear term:\n$$\nu_{\\text{sf}}(r) =\n\\begin{cases}\nu(r) - u(r_{c}) - \\left( r - r_{c} \\right) u'(r_{c}), & r < r_{c}, \\\\\n0, & r \\ge r_{c}.\n\\end{cases}\n$$\nThen $u_{\\text{sf}}(r_{c}^{-}) = 0$ and $u_{\\text{sf}}'(r_{c}^{-}) = u'(r_{c}) - u'(r_{c}) = 0$, while $u_{\\text{sf}}(r_{c}^{+}) = 0$ and $u_{\\text{sf}}'(r_{c}^{+}) = 0$. This removes both the potential jump and the force jump at $r_{c}$. The corresponding force for $r < r_{c}$ becomes\n$$\nF_{\\text{sf}}(r) = - u_{\\text{sf}}'(r) = - u'(r) + u'(r_{c}),\n$$\nwhich is continuous at $r_{c}$ and vanishes for $r \\ge r_{c}$.\n\nFor the Lennard–Jones $12$–$6$ potential,\n$$\nu(r) = 4 \\varepsilon \\left[ \\left( \\frac{\\sigma}{r} \\right)^{12} - \\left( \\frac{\\sigma}{r} \\right)^{6} \\right],\n$$\nwe have\n$$\nu(r_{c}) = 4 \\varepsilon \\left[ \\left( \\frac{\\sigma}{r_{c}} \\right)^{12} - \\left( \\frac{\\sigma}{r_{c}} \\right)^{6} \\right],\n$$\nand\n$$\nu'(r) = 4 \\varepsilon \\left[ -12 \\sigma^{12} r^{-13} + 6 \\sigma^{6} r^{-7} \\right],\n\\quad\nu'(r_{c}) = 4 \\varepsilon \\left[ -12 \\sigma^{12} r_{c}^{-13} + 6 \\sigma^{6} r_{c}^{-7} \\right].\n$$\nSubstituting these into $u_{\\text{sp}}(r)$ and $u_{\\text{sf}}(r)$ yields the explicit shifted forms for $r < r_{c}$.\n\nWe now design tail corrections that restore the bulk thermodynamics lost by truncation. In the limit where $g(r) \\to 1$ for $r \\ge r_{c}$, the missing contributions to the potential energy per particle and the pressure are given by integrals over the tail domain. The energy tail correction per particle is\n$$\n\\Delta U/N = \\frac{1}{2} \\rho \\int_{r_{c}}^{\\infty} 4 \\pi r^{2} \\, u(r) \\, dr\n= 2 \\pi \\rho \\int_{r_{c}}^{\\infty} r^{2} \\, u(r) \\, dr,\n$$\nand the pressure tail correction (from the virial) is\n$$\n\\Delta P = - \\frac{2 \\pi}{3} \\rho^{2} \\int_{r_{c}}^{\\infty} r^{3} \\, u'(r) \\, dr.\n$$\nFor the Lennard–Jones $12$–$6$ potential, we compute these integrals explicitly.\n\nEnergy tail correction:\n$$\n\\Delta U/N = 2 \\pi \\rho \\int_{r_{c}}^{\\infty} r^{2} \\cdot 4 \\varepsilon \\left[ \\sigma^{12} r^{-12} - \\sigma^{6} r^{-6} \\right] dr\n= 8 \\pi \\rho \\varepsilon \\left[ \\sigma^{12} \\int_{r_{c}}^{\\infty} r^{-10} dr - \\sigma^{6} \\int_{r_{c}}^{\\infty} r^{-4} dr \\right].\n$$\nUsing $\\int r^{-10} dr = - \\frac{1}{9} r^{-9}$ and $\\int r^{-4} dr = - \\frac{1}{3} r^{-3}$,\n$$\n\\Delta U/N = 8 \\pi \\rho \\varepsilon \\left[ \\sigma^{12} \\left( \\frac{1}{9} r_{c}^{-9} \\right) - \\sigma^{6} \\left( \\frac{1}{3} r_{c}^{-3} \\right) \\right]\n= 8 \\pi \\rho \\varepsilon \\sigma^{3} \\left[ \\frac{1}{9} \\left( \\frac{\\sigma}{r_{c}} \\right)^{9} - \\frac{1}{3} \\left( \\frac{\\sigma}{r_{c}} \\right)^{3} \\right].\n$$\n\nPressure tail correction:\n$$\n\\Delta P = - \\frac{2 \\pi}{3} \\rho^{2} \\int_{r_{c}}^{\\infty} r^{3} \\cdot 4 \\varepsilon \\left[ -12 \\sigma^{12} r^{-13} + 6 \\sigma^{6} r^{-7} \\right] dr\n= - \\frac{8 \\pi}{3} \\rho^{2} \\varepsilon \\left[ -12 \\sigma^{12} \\int_{r_{c}}^{\\infty} r^{-10} dr + 6 \\sigma^{6} \\int_{r_{c}}^{\\infty} r^{-4} dr \\right].\n$$\nEvaluating the integrals,\n$$\n\\Delta P = - \\frac{8 \\pi}{3} \\rho^{2} \\varepsilon \\left[ -12 \\sigma^{12} \\left( \\frac{1}{9} r_{c}^{-9} \\right) + 6 \\sigma^{6} \\left( \\frac{1}{3} r_{c}^{-3} \\right) \\right]\n= - \\frac{8 \\pi}{3} \\rho^{2} \\varepsilon \\left[ - \\frac{4}{3} \\sigma^{12} r_{c}^{-9} + 2 \\sigma^{6} r_{c}^{-3} \\right].\n$$\nThus,\n$$\n\\Delta P = \\frac{8 \\pi}{3} \\rho^{2} \\varepsilon \\left[ \\frac{4}{3} \\sigma^{12} r_{c}^{-9} - 2 \\sigma^{6} r_{c}^{-3} \\right]\n= \\rho^{2} \\varepsilon \\left[ \\frac{32 \\pi}{9} \\sigma^{12} r_{c}^{-9} - \\frac{16 \\pi}{3} \\sigma^{6} r_{c}^{-3} \\right]\n= \\rho^{2} \\varepsilon \\sigma^{3} \\left[ \\frac{32 \\pi}{9} \\left( \\frac{\\sigma}{r_{c}} \\right)^{9} - \\frac{16 \\pi}{3} \\left( \\frac{\\sigma}{r_{c}} \\right)^{3} \\right].\n$$\n\nThese tail corrections are independent of whether one uses the truncated, shifted-potential, or shifted-force scheme inside $r < r_{c}$, because they only account for $r > r_{c}$ where interactions are omitted. The shifted-potential scheme removes the impulsive $\\delta$ contribution to the virial by enforcing $u(r_{c}) = 0$, while the shifted-force scheme additionally enforces $u'(r_{c}) = 0$ to ensure continuous forces and improved energy conservation in dynamical simulations. Under the assumption $g(r) \\to 1$ for $r \\ge r_{c}$, the analytic expressions for the tail corrections are as derived above.\n\nPer the requested format, the final answer should be given as a single row matrix $\\left[ \\Delta U/N, \\, \\Delta P \\right]$, with implied units of Joules per particle and Pascals, respectively, but without appending units to the expressions.",
            "answer": "$$\\boxed{\\begin{pmatrix}\n8 \\pi \\rho \\varepsilon \\sigma^{3} \\left[ \\frac{1}{9} \\left( \\frac{\\sigma}{r_{c}} \\right)^{9} - \\frac{1}{3} \\left( \\frac{\\sigma}{r_{c}} \\right)^{3} \\right] & \\rho^{2} \\varepsilon \\sigma^{3} \\left[ \\frac{32 \\pi}{9} \\left( \\frac{\\sigma}{r_{c}} \\right)^{9} - \\frac{16 \\pi}{3} \\left( \\frac{\\sigma}{r_{c}} \\right)^{3} \\right]\n\\end{pmatrix}}$$"
        },
        {
            "introduction": "A central task in modern computational geochemistry is the development of reliable force fields that accurately reproduce the behavior of real materials. The most robust potentials are parameterized by fitting their functional forms to high-fidelity data from first-principles quantum mechanical calculations, such as Density Functional Theory (DFT). This capstone exercise  guides you through this entire workflow, from defining a model and generating synthetic DFT data to performing a nonlinear least-squares fit to determine the potential parameters $\\boldsymbol{\\theta} = (D, \\alpha, r_0)$. By fitting a single potential to multiple crystal structures, you will also learn a crucial strategy for ensuring the transferability and predictive power of your final model.",
            "id": "4078076",
            "problem": "You are tasked with designing and implementing a protocol to fit parameters of a short-ranged empirical pair potential to synthetic Density Functional Theory (DFT) equation of state data for a monoatomic crystalline mineral. The fitting should be performed jointly across two crystal prototypes to ensure transferability and coverage of relevant volumes and coordination environments. Your implementation must carry out nonlinear least squares to estimate the parameter vector and report a coverage diagnostic.\n\nStart from the following foundational basis:\n- The total potential energy per atom in a perfect crystal under a pairwise interaction can be modeled, in a nearest-neighbor approximation, as the coordination number times the pair potential evaluated at the nearest-neighbor distance, divided by $2$ to avoid double counting of pairs.\n- The nearest-neighbor distance is a deterministic geometric function of the crystal structure and the volume per atom, derived from the definitions of cubic Bravais lattices.\n\nModel and geometric definitions:\n- Use the Morse potential for the pair interaction,\n$$\nV_{\\mathrm{Morse}}(r; \\boldsymbol{\\theta}) \\;=\\; D\\,\\Big(e^{-2\\,\\alpha\\,(r - r_0)} \\;-\\; 2\\,e^{-\\alpha\\,(r - r_0)}\\Big),\n$$\nwith parameter vector $\\boldsymbol{\\theta} = (D,\\alpha,r_0)$, where $D$ is the well depth in $\\mathrm{eV}$, $\\alpha$ is the inverse length in $\\mathrm{\\AA}^{-1}$, and $r_0$ is the equilibrium bond length in $\\mathrm{\\AA}$.\n- Consider two structures: face-centered cubic (FCC) and body-centered cubic (BCC). Denote the volume per atom by $V$ in $\\mathrm{\\AA}^3$.\n  - For FCC: the coordination number is $z_{\\mathrm{FCC}} = 12$, the lattice parameter is $a_{\\mathrm{FCC}} = (4V)^{1/3}$, and the nearest-neighbor distance is $r_{\\mathrm{FCC}}(V) = a_{\\mathrm{FCC}}/\\sqrt{2}$.\n  - For BCC: the coordination number is $z_{\\mathrm{BCC}} = 8$, the lattice parameter is $a_{\\mathrm{BCC}} = (2V)^{1/3}$, and the nearest-neighbor distance is $r_{\\mathrm{BCC}}(V) = (\\sqrt{3}/2)\\,a_{\\mathrm{BCC}}$.\n- The per-atom energy model for structure $s \\in \\{\\mathrm{FCC},\\mathrm{BCC}\\}$ is\n$$\nE_s(V;\\boldsymbol{\\theta}) \\;=\\; \\frac{1}{2}\\,z_s\\,V_{\\mathrm{Morse}}\\!\\big(r_s(V);\\boldsymbol{\\theta}\\big).\n$$\n\nFitting objective:\n- Given a set of synthetic DFT energies $\\{(s_i,V_i,E^{\\mathrm{DFT}}_i)\\}_{i=1}^N$ across both structures and various volumes, estimate $\\boldsymbol{\\theta}$ by nonlinear least squares, minimizing\n$$\n\\Phi(\\boldsymbol{\\theta}) \\;=\\; \\sum_{i=1}^N \\Big(E_{s_i}(V_i;\\boldsymbol{\\theta}) - E^{\\mathrm{DFT}}_i\\Big)^2,\n$$\nsubject to the bound constraints $D>0$, $\\alpha>0$, $r_0>0$.\n\nCoverage diagnostic:\n- After obtaining the fitted parameters $\\widehat{\\boldsymbol{\\theta}}$, define a margin $m = 0.05$. For each structure $s$, compute the set $\\{r_s(V_i)\\}$ over the volumes belonging to structure $s$. Let $r_{s,\\min}$ and $r_{s,\\max}$ be their minimum and maximum, respectively. The coverage condition for structure $s$ is\n$$\nr_{s,\\min} \\;\\le\\; (1-m)\\,\\widehat{r}_0\\quad\\text{and}\\quad r_{s,\\max} \\;\\ge\\; (1+m)\\,\\widehat{r}_0,\n$$\nwhere $\\widehat{r}_0$ is the fitted $r_0$ component of $\\widehat{\\boldsymbol{\\theta}}$. The overall coverage diagnostic is true if and only if the condition holds for both FCC and BCC.\n\nData generation protocol (synthetic DFT equation of state):\n- For each test case, you are given:\n  - A “true” parameter vector $\\boldsymbol{\\theta}^\\star = (D^\\star,\\alpha^\\star,r_0^\\star)$.\n  - A set of volumes for FCC, and a set of volumes for BCC.\n  - A deterministic noise amplitude $\\delta$ in $\\mathrm{eV}$ and a noise function for the $i$-th datum: $\\varepsilon_i = \\delta \\sin(i)$, with $i$ starting at $0$ and increasing by $1$ per datum in the following fixed ordering: all FCC points in the order they are listed by volume, followed by all BCC points in the order they are listed by volume. Use the sine function with input in radians.\n- For each listed volume $V$, compute the noise-free model energy using $\\boldsymbol{\\theta}^\\star$ and the appropriate structure, then add $\\varepsilon_i$ to obtain $E^{\\mathrm{DFT}}_i$.\n\nUnits and output requirements:\n- Use $\\mathrm{eV}$ for energies, $\\mathrm{\\AA}$ for lengths, and $\\mathrm{\\AA}^3$ for volumes. Report $D$ in $\\mathrm{eV}$, $\\alpha$ in $\\mathrm{\\AA}^{-1}$, and $r_0$ in $\\mathrm{\\AA}$.\n- For each test case, your program must output a list with $4$ entries: the fitted $D$, $\\alpha$, and $r_0$ rounded to $6$ decimals, followed by the boolean coverage diagnostic.\n- Your program should produce a single line of output containing the results across all test cases as a list of lists, for example, $[[D_1,\\alpha_1,r_{0,1},\\mathrm{bool}_1],[D_2,\\alpha_2,r_{0,2},\\mathrm{bool}_2],\\dots]$.\n\nTest suite:\n- Test case $1$:\n  - $\\boldsymbol{\\theta}^\\star = (D^\\star,\\alpha^\\star,r_0^\\star) = (0.5, 1.8, 2.8)$.\n  - FCC volumes in $\\mathrm{\\AA}^3$ per atom: $[13.0, 14.5, 16.0, 18.0, 21.0]$.\n  - BCC volumes in $\\mathrm{\\AA}^3$ per atom: $[14.0, 16.0, 18.5, 21.5]$.\n  - Noise amplitude $\\delta = 1\\times 10^{-3}\\ \\mathrm{eV}$.\n- Test case $2$:\n  - $\\boldsymbol{\\theta}^\\star = (0.3, 2.2, 2.6)$.\n  - FCC volumes in $\\mathrm{\\AA}^3$ per atom: $[13.5, 14.0, 14.5]$.\n  - BCC volumes in $\\mathrm{\\AA}^3$ per atom: $[14.0, 15.0]$.\n  - Noise amplitude $\\delta = 5\\times 10^{-4}\\ \\mathrm{eV}$.\n- Test case $3$:\n  - $\\boldsymbol{\\theta}^\\star = (0.8, 1.2, 3.2)$.\n  - FCC volumes in $\\mathrm{\\AA}^3$ per atom: $[12.0, 15.0, 19.0, 24.0, 30.0]$.\n  - BCC volumes in $\\mathrm{\\AA}^3$ per atom: $[13.0, 17.0, 23.0, 29.0]$.\n  - Noise amplitude $\\delta = 2\\times 10^{-3}\\ \\mathrm{eV}$.\n\nAlgorithmic requirements:\n- Implement the nonlinear least squares fit with bound constraints $D>0$, $\\alpha>0$, $r_0>0$.\n- Ensure that both structures’ data are included in a single objective to obtain a single shared $\\boldsymbol{\\theta}$ per test case.\n- Compute the coverage diagnostic as specified using $m=0.05$ for each test case.\n- The final output must be a single line with the results formatted as a comma-separated list enclosed in square brackets, where each test case contributes one inner list $[D,\\alpha,r_0,\\mathrm{bool}]$ with $D$, $\\alpha$, and $r_0$ rounded to $6$ decimals.",
            "solution": "The problem requires the design and implementation of a procedure to fit the parameters of a Morse potential to synthetic equation of state data for a monoatomic crystal in both face-centered cubic ($\\mathrm{FCC}$) and body-centered cubic ($\\mathrm{BCC}$) structures. The solution involves generating synthetic data, performing a constrained nonlinear least squares fit, and evaluating a coverage diagnostic.\n\n1.  **Theoretical Model**\n\nThe core of the model consists of geometric relationships for cubic lattices and a pair potential for interatomic interactions.\n\n-   **Pair Potential**: The interaction between any two atoms is described by the Morse potential, a function of the interatomic distance $r$. The potential energy $V_{\\mathrm{Morse}}$ is given by:\n    $$\n    V_{\\mathrm{Morse}}(r; \\boldsymbol{\\theta}) = D \\left( e^{-2\\alpha(r - r_0)} - 2e^{-\\alpha(r - r_0)} \\right)\n    $$\n    The parameter vector to be determined is $\\boldsymbol{\\theta} = (D, \\alpha, r_0)$, where $D$ is the potential well depth (energy), $\\alpha$ controls the width of the potential well (inverse length), and $r_0$ is the equilibrium bond distance (length).\n\n-   **Crystal Energy**: In a nearest-neighbor approximation, the total cohesive energy per atom, $E_s$, for a given crystal structure $s$ and volume per atom $V$, is calculated by summing the interaction energy of an atom with its nearest neighbors. This sum is divided by $2$ to correct for double counting bonds.\n    $$\n    E_s(V; \\boldsymbol{\\theta}) = \\frac{1}{2} z_s V_{\\mathrm{Morse}}(r_s(V); \\boldsymbol{\\theta})\n    $$\n    Here, $z_s$ is the coordination number (number of nearest neighbors) and $r_s(V)$ is the nearest-neighbor distance.\n\n-   **Crystallographic Geometry**: The nearest-neighbor distance $r_s(V)$ is a deterministic function of the volume per atom $V$ for each crystal structure.\n    -   For an $\\mathrm{FCC}$ structure ($s=\\mathrm{FCC}$), the coordination number is $z_{\\mathrm{FCC}} = 12$. The lattice parameter is $a_{\\mathrm{FCC}} = (4V)^{1/3}$, and the nearest-neighbor distance is:\n        $$\n        r_{\\mathrm{FCC}}(V) = \\frac{a_{\\mathrm{FCC}}}{\\sqrt{2}} = \\frac{(4V)^{1/3}}{\\sqrt{2}}\n        $$\n    -   For a $\\mathrm{BCC}$ structure ($s=\\mathrm{BCC}$), the coordination number is $z_{\\mathrm{BCC}} = 8$. The lattice parameter is $a_{\\mathrm{BCC}} = (2V)^{1/3}$, and the nearest-neighbor distance is:\n        $$\n        r_{\\mathrm{BCC}}(V) = \\frac{\\sqrt{3}}{2} a_{\\mathrm{BCC}} = \\frac{\\sqrt{3}}{2} (2V)^{1/3}\n        $$\n\n2.  **Computational Strategy**\n\nThe overall process is a numerical optimization task performed on synthetically generated data.\n\n-   **Synthetic Data Generation**: For each test case, a set of \"true\" parameters $\\boldsymbol{\\theta}^\\star = (D^\\star, \\alpha^\\star, r_0^\\star)$ is provided. The synthetic \"DFT\" energy data, $\\{E^{\\mathrm{DFT}}_i\\}$, are generated from the model. For each data point $i$, corresponding to a structure $s_i$ and volume $V_i$, the energy is:\n    $$\n    E^{\\mathrm{DFT}}_i = E_{s_i}(V_i; \\boldsymbol{\\theta}^\\star) + \\varepsilon_i\n    $$\n    The noise term is given by $\\varepsilon_i = \\delta \\sin(i)$, where $\\delta$ is a specified amplitude and the index $i$ increments from $0$ across the ordered dataset (all $\\mathrm{FCC}$ points followed by all $\\mathrm{BCC}$ points).\n\n-   **Parameter Estimation**: The goal is to find the parameter vector $\\widehat{\\boldsymbol{\\theta}}$ that best reproduces the synthetic data. This is achieved by minimizing the sum of squared residuals, $\\Phi(\\boldsymbol{\\theta})$:\n    $$\n    \\min_{\\boldsymbol{\\theta}} \\Phi(\\boldsymbol{\\theta}) = \\min_{\\boldsymbol{\\theta}} \\sum_{i=1}^N \\left( E_{s_i}(V_i; \\boldsymbol{\\theta}) - E^{\\mathrm{DFT}}_i \\right)^2\n    $$\n    This is a nonlinear least squares problem. The optimization is subject to the physical constraints $D>0$, $\\alpha>0$, and $r_0>0$. The implementation will use the `scipy.optimize.least_squares` function, which is well-suited for this type of problem. The function requires a vector of residuals, $R_i(\\boldsymbol{\\theta}) = E_{s_i}(V_i; \\boldsymbol{\\theta}) - E^{\\mathrm{DFT}}_i$, an initial guess for the parameters (for which the true values $\\boldsymbol{\\theta}^\\star$ are a robust choice), and the parameter bounds.\n\n-   **Coverage Diagnostic**: After obtaining the optimal parameters $\\widehat{\\boldsymbol{\\theta}}$, a diagnostic is performed to assess whether the range of interatomic distances in the input data adequately covers the equilibrium region of the fitted potential. The fitted equilibrium distance is $\\widehat{r}_0$. For each structure $s$, we find the minimum and maximum nearest-neighbor distances, $r_{s,\\min}$ and $r_{s,\\max}$, corresponding to the provided set of volumes $\\{V_i\\}$. The coverage condition for a structure $s$ is met if its distance range brackets the equilibrium distance $\\widehat{r}_0$ with a margin $m = 0.05$:\n    $$\n    r_{s,\\min} \\le (1-m)\\widehat{r}_0 \\quad \\text{and} \\quad r_{s,\\max} \\ge (1+m)\\widehat{r}_0\n    $$\n    The overall diagnostic is `True` only if this condition holds for both $\\mathrm{FCC}$ and $\\mathrm{BCC}$ structures.\n\n3.  **Implementation Details**\n\nThe solution is implemented in Python, leveraging the `numpy` and `scipy` libraries.\n-   A main function iterates through the provided test cases.\n-   For each case, helper functions are defined to compute $r_s(V)$, $V_{\\mathrm{Morse}}(r; \\boldsymbol{\\theta})$, and the full energy model $E_s(V; \\boldsymbol{\\theta})$.\n-   The synthetic data points $(s_i, V_i, E^{\\mathrm{DFT}}_i)$ are generated and stored in arrays.\n-   A residual function is defined for `scipy.optimize.least_squares`. This function takes a parameter vector $\\boldsymbol{\\theta}$ and returns an array of differences between the model's predicted energies and the synthetic `DFT` energies.\n-   The `least_squares` routine is called with an initial guess (the true parameters $\\boldsymbol{\\theta}^\\star$) and bounds $([0, 0, 0], [\\infty, \\infty, \\infty])$.\n-   The resulting optimal parameters $\\widehat{\\boldsymbol{\\theta}}$ are extracted.\n-   The coverage diagnostic is computed as described above.\n-   Finally, the fitted parameters $\\widehat{D}$, $\\widehat{\\alpha}$, $\\widehat{r}_0$ are rounded to $6$ decimal places, combined with the boolean diagnostic result, and collected for final output in the specified list-of-lists format.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import least_squares\n\ndef solve():\n    \"\"\"\n    Solves a series of parameter fitting problems for a Morse potential\n    based on synthetic DFT data for FCC and BCC crystal structures.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"theta_star\": (0.5, 1.8, 2.8),\n            \"fcc_vols\": [13.0, 14.5, 16.0, 18.0, 21.0],\n            \"bcc_vols\": [14.0, 16.0, 18.5, 21.5],\n            \"delta\": 1e-3,\n        },\n        {\n            \"theta_star\": (0.3, 2.2, 2.6),\n            \"fcc_vols\": [13.5, 14.0, 14.5],\n            \"bcc_vols\": [14.0, 15.0],\n            \"delta\": 5e-4,\n        },\n        {\n            \"theta_star\": (0.8, 1.2, 3.2),\n            \"fcc_vols\": [12.0, 15.0, 19.0, 24.0, 30.0],\n            \"bcc_vols\": [13.0, 17.0, 23.0, 29.0],\n            \"delta\": 2e-3,\n        },\n    ]\n\n    # --- Model and Geometric Definitions ---\n\n    # Morse pair potential\n    def v_morse(r, D, alpha, r0):\n        return D * (np.exp(-2 * alpha * (r - r0)) - 2 * np.exp(-alpha * (r - r0)))\n\n    # Geometric relations for nearest-neighbor distance r as a function of volume V\n    def r_fcc(V):\n        a_fcc = np.cbrt(4 * V)\n        return a_fcc / np.sqrt(2)\n\n    def r_bcc(V):\n        a_bcc = np.cbrt(2 * V)\n        return (np.sqrt(3) / 2) * a_bcc\n\n    # Per-atom energy model\n    def energy_model(struct, V, params):\n        D, alpha, r0 = params\n        if struct == 'fcc':\n            z = 12\n            r = r_fcc(V)\n        elif struct == 'bcc':\n            z = 8\n            r = r_bcc(V)\n        else:\n            raise ValueError(\"Unknown structure\")\n        \n        return 0.5 * z * v_morse(r, D, alpha, r0)\n\n    results = []\n    for case in test_cases:\n        theta_star = case[\"theta_star\"]\n        fcc_vols = case[\"fcc_vols\"]\n        bcc_vols = case[\"bcc_vols\"]\n        delta = case[\"delta\"]\n\n        # --- 1. Generate Synthetic DFT Data ---\n        structures = ['fcc'] * len(fcc_vols) + ['bcc'] * len(bcc_vols)\n        volumes = np.array(fcc_vols + bcc_vols)\n        \n        energies_dft = []\n        for i, (s, v) in enumerate(zip(structures, volumes)):\n            true_energy = energy_model(s, v, theta_star)\n            noise = delta * np.sin(i)\n            energies_dft.append(true_energy + noise)\n        energies_dft = np.array(energies_dft)\n\n        # --- 2. Perform Nonlinear Least Squares Fit ---\n        def residuals(params, structures, volumes, energies_dft):\n            model_energies = np.array([\n                energy_model(s, v, params) for s, v in zip(structures, volumes)\n            ])\n            return model_energies - energies_dft\n\n        # Initial guess for the optimizer\n        p0 = list(theta_star)\n        \n        # Bounds: D > 0, alpha > 0, r0 > 0\n        bounds = ([0, 0, 0], [np.inf, np.inf, np.inf])\n\n        fit_result = least_squares(\n            residuals,\n            p0,\n            args=(structures, volumes, energies_dft),\n            bounds=bounds,\n            method='trf'\n        )\n        D_fit, alpha_fit, r0_fit = fit_result.x\n\n        # --- 3. Compute Coverage Diagnostic ---\n        m = 0.05\n        \n        # FCC coverage\n        fcc_r_values = r_fcc(np.array(fcc_vols))\n        r_fcc_min, r_fcc_max = np.min(fcc_r_values), np.max(fcc_r_values)\n        fcc_coverage = (r_fcc_min <= (1 - m) * r0_fit) and (r_fcc_max >= (1 + m) * r0_fit)\n        \n        # BCC coverage\n        bcc_r_values = r_bcc(np.array(bcc_vols))\n        r_bcc_min, r_bcc_max = np.min(bcc_r_values), np.max(bcc_r_values)\n        bcc_coverage = (r_bcc_min <= (1 - m) * r0_fit) and (r_bcc_max >= (1 + m) * r0_fit)\n\n        overall_coverage = fcc_coverage and bcc_coverage\n\n        # --- 4. Store Formatted Results ---\n        results.append([\n            round(D_fit, 6),\n            round(alpha_fit, 6),\n            round(r0_fit, 6),\n            overall_coverage\n        ])\n\n    # Final print statement in the exact required format.\n    # The default str() for a list and for a boolean is correct for the format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}