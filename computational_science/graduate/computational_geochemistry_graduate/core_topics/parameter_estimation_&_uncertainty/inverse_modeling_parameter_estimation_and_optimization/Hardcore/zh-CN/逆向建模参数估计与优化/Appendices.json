{
    "hands_on_practices": [
        {
            "introduction": "本练习提供了参数估计的实践入门，这是反演建模的基石。通过分析与温度相关的平衡常数数据，我们将确定焓（$\\Delta H^\\circ$）和熵（$\\Delta S^\\circ$）等基本热力学参数。您将学习如何将非线性的物理定律——范特霍夫方程——线性化，并应用加权最小二乘回归来恰当处理实验不确定性，这是处理真实世界数据的关键技能 。",
            "id": "4082921",
            "problem": "您的任务是在计算地球化学中实现一个反演建模程序，以根据平衡常数随温度变化的数据来估计标准反应焓 $\\Delta H^\\circ$ 和标准反应熵 $\\Delta S^\\circ$。基本原理包括标准吉布斯自由能 $\\Delta G^\\circ$ 与反应平衡常数 $K$ 之间的关系（定义为 $\\Delta G^\\circ = - R T \\ln K$），以及在有限温度范围内 $\\Delta H^\\circ$ 和 $\\Delta S^\\circ$ 与温度无关的反应所满足的热力学恒等式 $\\Delta G^\\circ = \\Delta H^\\circ - T \\Delta S^\\circ$。结合这两个经过充分检验的公式，可以推导出 $\\ln K$ 和 $1/T$ 之间存在线性关系，其中 $T$ 是以开尔文为单位的绝对温度。$K$ 的测量值带有相关的不确定度，必须将其传播到 $\\ln K$ 的不确定度中，并作为权重用于统计上合理的加权线性回归。\n\n您的程序必须：\n- 为关联 $\\ln K$ 和 $1/T$ 的线性模型构建加权最小二乘问题。\n- 使用 $K$ 的测量不确定度，通过一阶误差传播计算 $\\ln K$ 的不确定度，对于每次测量 $i$，$\\sigma_{\\ln K,i} \\approx \\sigma_{K,i} / K_i$。\n- 求解加权线性回归问题以估计斜率和截距，然后使用气体常数 $R$ 将它们转换为 $\\Delta H^\\circ$ 和 $\\Delta S^\\circ$。\n- 基于加权最小二乘估计量的协方差，假设误差是方差已知的独立高斯误差，计算 $\\Delta H^\\circ$ 和 $\\Delta S^\\circ$ 的后验单标准差（one-sigma）不确定度。\n- 将 $\\Delta H^\\circ$ 以千焦耳每摩尔表示，$\\Delta S^\\circ$ 以焦耳每摩尔每开尔文表示，两者均四舍五入到六位小数。\n\n使用以下气体常数：$R = 8.31446261815324 \\ \\mathrm{J \\ mol^{-1} \\ K^{-1}}$。\n\n为以下数据集测试套件实现该解决方案。每个测试用例提供了多次测量的温度 $T$（单位为开尔文）、平衡常数 $K$（无量纲）和绝对不确定度 $\\sigma_K$（与 $K$ 的量纲相同）。以下所有数字都必须按给定的方式精确处理。数据集如下：\n\n- 情况 A（一般情况，不确定度不同）：\n  - $T$: $\\{298.0, 310.0, 330.0, 360.0\\}$ (开尔文)\n  - $K$: $\\{3000.0, 1200.0, 300.0, 120.0\\}$ (无量纲)\n  - $\\sigma_K$: $\\{150.0, 48.0, 30.0, 9.6\\}$ (无量纲)\n- 情况 B（边界情况：最少点数）：\n  - $T$: $\\{298.0, 350.0\\}$ (开尔文)\n  - $K$: $\\{2500.0, 500.0\\}$ (无量纲)\n  - $\\sigma_K$: $\\{125.0, 25.0\\}$ (无量纲)\n- 情况 C（边缘情况：某次测量的极小不确定度主导权重）：\n  - $T$: $\\{280.0, 300.0, 320.0, 340.0, 360.0\\}$ (开尔文)\n  - $K$: $\\{5000.0, 2000.0, 900.0, 420.0, 200.0\\}$ (无量纲)\n  - $\\sigma_K$: $\\{500.0, 200.0, 9.0, 42.0, 20.0\\}$ (无量纲)\n- 情况 D（边缘情况：温度密集聚集）：\n  - $T$: $\\{300.0, 301.0, 302.0, 303.0\\}$ (开尔文)\n  - $K$: $\\{2000.0, 1900.0, 1800.0, 1700.0\\}$ (无量纲)\n  - $\\sigma_K$: $\\{50.0, 50.0, 50.0, 50.0\\}$ (无量纲)\n\n您的程序必须输出单行文本，其中包含一个逗号分隔的所有情况的结果列表，并用方括号括起来。每个情况的结果必须是一个形如 $[\\Delta H^\\circ \\ (\\mathrm{kJ \\ mol^{-1}}), \\Delta S^\\circ \\ (\\mathrm{J \\ mol^{-1} \\ K^{-1}}), \\sigma_{\\Delta H^\\circ} \\ (\\mathrm{kJ \\ mol^{-1}}), \\sigma_{\\Delta S^\\circ} \\ (\\mathrm{J \\ mol^{-1} \\ K^{-1}})]$ 的列表，其中每个数值都四舍五入到六位小数。例如，最终输出必须类似于 $[[h_1,s_1,sh_1,ss_1],[h_2,s_2,sh_2,ss_2],[h_3,s_3,sh_3,ss_3],[h_4,s_4,sh_4,ss_4]]$，其中每个 $h_i$、$s_i$、$sh_i$ 和 $ss_i$ 都是浮点数。\n\n所有输入均按规定，单位为开尔文和无量纲。所有输出必须按照规定，将 $\\Delta H^\\circ$ 表示为 $\\mathrm{kJ \\ mol^{-1}}$，$\\Delta S^\\circ$ 表示为 $\\mathrm{J \\ mol^{-1} \\ K^{-1}}$。不涉及角度。不得使用百分比；必须提供并使用绝对值形式的不确定度。\n\n您的实现必须是自包含的，且不得读取任何外部输入。它必须遵循适用于现代编程语言的通用加权线性回归原理，纯粹关注上述数学逻辑。",
            "solution": "该问题要求从平衡常数 $K$ 在不同温度 $T$ 下的实验数据中，估算标准反应焓 $\\Delta H^\\circ$ 和标准反应熵 $\\Delta S^\\circ$。这是物理化学中一个经典的反演问题，其解决方案基于基本的热力学原理和统计回归分析。\n\n### 1. 理论阐述：范特霍夫方程\n\n分析始于化学热力学中的两个基本方程。第一个方程关联了标准反应吉布斯自由能 $\\Delta G^\\circ$ 与平衡常数 $K$：\n$$ \\Delta G^\\circ = - R T \\ln K $$\n其中 $R$ 是普适气体常数，$T$ 是以开尔文为单位的绝对温度。\n\n第二个是吉布斯自由能以焓和熵定义的表达式：\n$$ \\Delta G^\\circ = \\Delta H^\\circ - T \\Delta S^\\circ $$\n问题假设在实验所涉及的有限温度范围内，$\\Delta H^\\circ$ 和 $\\Delta S^\\circ$ 均为常数。\n\n通过令这两个 $\\Delta G^\\circ$ 的表达式相等，我们得到：\n$$ - R T \\ln K = \\Delta H^\\circ - T \\Delta S^\\circ $$\n为了建立一个适合回归分析的线性关系，我们将此方程所有项除以 $-RT$ 进行重排：\n$$ \\ln K = -\\frac{\\Delta H^\\circ}{R T} + \\frac{T \\Delta S^\\circ}{R T} $$\n$$ \\ln K = \\left(-\\frac{\\Delta H^\\circ}{R}\\right) \\frac{1}{T} + \\left(\\frac{\\Delta S^\\circ}{R}\\right) $$\n该方程是直线形式 $y = mx + c$，其中：\n- 因变量是 $y = \\ln K$。\n- 自变量是 $x = 1/T$。\n- 斜率是 $m = -\\frac{\\Delta H^\\circ}{R}$。\n- y轴截距是 $c = \\frac{\\Delta S^\\circ}{R}$。\n\n### 2. 统计方法：加权最小二乘法 (WLS)\n\n实验测量的是 $K$ 值，并带有相关的不确定度 $\\sigma_K$。为了对变换后的变量 $y = \\ln K$ 和 $x = 1/T$ 进行线性回归，我们必须传播这些不确定度。使用一阶泰勒展开（误差传播），每个 $y_i = \\ln K_i$ 值的不确定度 $\\sigma_{y,i}$ 由下式给出：\n$$ \\sigma_{y,i} = \\sigma_{\\ln K,i} \\approx \\left| \\frac{d(\\ln K)}{dK} \\right|_{K=K_i} \\sigma_{K,i} = \\frac{1}{K_i} \\sigma_{K,i} $$\n由于这些不确定度在数据点之间不一致，简单的最小二乘回归是不合适的。统计上正确的方法是加权最小二乘法 (WLS)，其中每个数据点对拟合的贡献由其方差的倒数加权。第 $i$ 个数据点的权重是：\n$$ w_i = \\frac{1}{\\sigma_{y,i}^2} = \\left(\\frac{K_i}{\\sigma_{K,i}}\\right)^2 $$\nWLS 方法寻找参数 $m$ 和 $c$ 以最小化加权残差平方和 $\\chi^2$：\n$$ \\chi^2(m, c) = \\sum_{i=1}^{n} w_i (y_i - (mx_i + c))^2 $$\n其中 $n$ 是数据点的数量。\n\n这个问题最有效的求解方法是使用矩阵代数。我们定义以下内容：\n- 观测向量，$\\mathbf{y} = [y_1, y_2, \\dots, y_n]^T = [\\ln K_1, \\ln K_2, \\dots, \\ln K_n]^T$。\n- 设计矩阵，$\\mathbf{X}$，它包含一列用于截距的全1列和一列用于自变量值的列：\n$$ \\mathbf{X} = \\begin{pmatrix} 1 & x_1 \\\\ 1 & x_2 \\\\ \\vdots & \\vdots \\\\ 1 & x_n \\end{pmatrix} = \\begin{pmatrix} 1 & 1/T_1 \\\\ 1 & 1/T_2 \\\\ \\vdots & \\vdots \\\\ 1 & 1/T_n \\end{pmatrix} $$\n- 参数向量，$\\boldsymbol{\\beta} = [c, m]^T$。\n- 对角权重矩阵，$\\mathbf{W}$，其对角线上是权重 $w_i$：\n$$ \\mathbf{W} = \\begin{pmatrix} w_1 & 0 & \\dots & 0 \\\\ 0 & w_2 & \\dots & 0 \\\\ \\vdots & \\vdots & \\ddots & \\vdots \\\\ 0 & 0 & \\dots & w_n \\end{pmatrix} $$\n参数向量 $\\hat{\\boldsymbol{\\beta}}$ 的 WLS 估计由正规方程给出：\n$$ \\hat{\\boldsymbol{\\beta}} = (\\mathbf{X}^T \\mathbf{W} \\mathbf{X})^{-1} \\mathbf{X}^T \\mathbf{W} \\mathbf{y} $$\n\n### 3. 参数与不确定度估计\n\n一旦确定了最佳拟合参数 $\\hat{\\boldsymbol{\\beta}} = [\\hat{c}, \\hat{m}]^T$，我们就可以计算热力学量的估计值：\n$$ \\hat{\\Delta H^\\circ} = -\\hat{m} \\cdot R $$\n$$ \\hat{\\Delta S^\\circ} = \\hat{c} \\cdot R $$\n$\\hat{\\Delta H^\\circ}$ 的单位将是 $\\mathrm{J \\ mol^{-1}}$，必须通过除以 $1000$ 转换为 $\\mathrm{kJ \\ mol^{-1}}$。$\\hat{\\Delta S^\\circ}$ 的单位将是 $\\mathrm{J \\ mol^{-1} \\ K^{-1}}$，符合要求。\n\n问题还要求这些估计值的单标准差不确定度。假设模型是正确的，且测量误差是方差已知的独立高斯误差（如题目所述），参数估计量 $\\hat{\\boldsymbol{\\beta}}$ 的协方差矩阵由下式给出：\n$$ \\text{Cov}(\\hat{\\boldsymbol{\\beta}}) = (\\mathbf{X}^T \\mathbf{W} \\mathbf{X})^{-1} $$\n这是一个 $2 \\times 2$ 矩阵：\n$$ \\text{Cov}(\\hat{\\boldsymbol{\\beta}}) = \\begin{pmatrix} \\sigma_c^2 & \\text{cov}(c, m) \\\\ \\text{cov}(c, m) & \\sigma_m^2 \\end{pmatrix} $$\n对角线元素 $\\sigma_c^2$ 和 $\\sigma_m^2$ 分别是估计截距和斜率的方差。单标准差不确定度是它们的平方根，即 $\\sigma_c$ 和 $\\sigma_m$。\n\n$\\Delta H^\\circ$ 和 $\\Delta S^\\circ$ 的不确定度通过从 $\\hat{m}$ 和 $\\hat{c}$ 的不确定度传播得到：\n$$ \\sigma_{\\Delta H^\\circ} = \\left| \\frac{\\partial (\\Delta H^\\circ)}{\\partial m} \\right| \\sigma_m = R \\cdot \\sigma_m $$\n$$ \\sigma_{\\Delta S^\\circ} = \\left| \\frac{\\partial (\\Delta S^\\circ)}{\\partial c} \\right| \\sigma_c = R \\cdot \\sigma_c $$\n不确定度 $\\sigma_{\\Delta H^\\circ}$ 也必须转换为 $\\mathrm{kJ \\ mol^{-1}}$。\n\n### 4. 算法总结\n\n对于每个给定的测试用例，执行以下计算步骤：\n\n1.  给定数据集 $\\{T_i, K_i, \\sigma_{K,i}\\}$，构建自变量 $x_i = 1/T_i$ 和因变量 $y_i = \\ln K_i$ 的数组。\n2.  计算每个 $y_i$ 的方差为 $\\sigma_{y,i}^2 = (\\sigma_{K,i} / K_i)^2$。\n3.  构建对角权重矩阵 $\\mathbf{W}$，其中 $W_{ii} = w_i = 1/\\sigma_{y,i}^2$。\n4.  构建设计矩阵 $\\mathbf{X}$。\n5.  使用 $\\hat{\\boldsymbol{\\beta}} = (\\mathbf{X}^T \\mathbf{W} \\mathbf{X})^{-1} \\mathbf{X}^T \\mathbf{W} \\mathbf{y}$ 求解参数向量 $\\hat{\\boldsymbol{\\beta}} = [\\hat{c}, \\hat{m}]^T$。\n6.  计算协方差矩阵 $\\text{Cov}(\\hat{\\boldsymbol{\\beta}}) = (\\mathbf{X}^T \\mathbf{W} \\mathbf{X})^{-1}$。\n7.  提取参数方差：$\\sigma_c^2 = \\text{Cov}(\\hat{\\boldsymbol{\\beta}})_{0,0}$ 和 $\\sigma_m^2 = \\text{Cov}(\\hat{\\boldsymbol{\\beta}})_{1,1}$。\n8.  使用气体常数 $R = 8.31446261815324 \\ \\mathrm{J \\ mol^{-1} \\ K^{-1}}$ 计算热力学估计值：\n    - $\\hat{\\Delta H^\\circ} = (-\\hat{m} \\cdot R) / 1000 \\quad (\\text{单位为 } \\mathrm{kJ \\ mol^{-1}})$\n    - $\\hat{\\Delta S^\\circ} = \\hat{c} \\cdot R \\quad (\\text{单位为 } \\mathrm{J \\ mol^{-1} \\ K^{-1}})$\n9.  计算相应的一西格玛不确定度：\n    - $\\sigma_{\\Delta H^\\circ} = (\\sqrt{\\sigma_m^2} \\cdot R) / 1000 \\quad (\\text{单位为 } \\mathrm{kJ \\ mol^{-1}})$\n    - $\\sigma_{\\Delta S^\\circ} = \\sqrt{\\sigma_c^2} \\cdot R \\quad (\\text{单位为 } \\mathrm{J \\ mol^{-1} \\ K^{-1}})$\n10. 将四个结果值四舍五入到六位小数，并格式化为指定的列表结构以供最终输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the inverse modeling problem for multiple test cases to estimate\n    thermodynamic parameters from equilibrium constant data using weighted\n    linear regression.\n    \"\"\"\n\n    # Universal gas constant in J mol^-1 K^-1\n    R = 8.31446261815324\n\n    test_cases = [\n        # Case A (general, varied uncertainties)\n        {\n            \"T\": np.array([298.0, 310.0, 330.0, 360.0]),\n            \"K\": np.array([3000.0, 1200.0, 300.0, 120.0]),\n            \"sigma_K\": np.array([150.0, 48.0, 30.0, 9.6])\n        },\n        # Case B (boundary case: minimal number of points)\n        {\n            \"T\": np.array([298.0, 350.0]),\n            \"K\": np.array([2500.0, 500.0]),\n            \"sigma_K\": np.array([125.0, 25.0])\n        },\n        # Case C (edge case: one measurement with very small uncertainty dominating)\n        {\n            \"T\": np.array([280.0, 300.0, 320.0, 340.0, 360.0]),\n            \"K\": np.array([5000.0, 2000.0, 900.0, 420.0, 200.0]),\n            \"sigma_K\": np.array([500.0, 200.0, 9.0, 42.0, 20.0])\n        },\n        # Case D (edge case: temperatures tightly clustered)\n        {\n            \"T\": np.array([300.0, 301.0, 302.0, 303.0]),\n            \"K\": np.array([2000.0, 1900.0, 1800.0, 1700.0]),\n            \"sigma_K\": np.array([50.0, 50.0, 50.0, 50.0])\n        }\n    ]\n\n    all_results = []\n\n    for case_data in test_cases:\n        T = case_data[\"T\"]\n        K = case_data[\"K\"]\n        sigma_K = case_data[\"sigma_K\"]\n\n        # 1. Transform variables for linear model y = c + mx\n        x = 1.0 / T        # Independent variable: 1/T\n        y = np.log(K)      # Dependent variable: ln(K)\n\n        # 2. Propagate uncertainty to ln(K) and calculate weights\n        # sigma_y = sigma_K / K\n        # weight w = 1 / sigma_y^2 = (K / sigma_K)^2\n        sigma_y_sq = (sigma_K / K)**2\n        w = 1.0 / sigma_y_sq\n\n        # 3. Construct matrices for Weighted Least Squares (WLS)\n        # Design matrix X\n        X = np.vstack((np.ones_like(x), x)).T\n        \n        # Weight matrix W\n        W = np.diag(w)\n\n        # 4. Solve for parameters beta_hat = [c, m]^T\n        # beta_hat = (X^T W X)^-1 X^T W y\n        try:\n            XTWX = X.T @ W @ X\n            XTWX_inv = np.linalg.inv(XTWX)\n            XTWy = X.T @ W @ y\n            beta_hat = XTWX_inv @ XTWy\n        except np.linalg.LinAlgError:\n            # Handle cases where the matrix is singular, though not expected\n            # with the given test data.\n            all_results.append([np.nan, np.nan, np.nan, np.nan])\n            continue\n\n        c_hat = beta_hat[0]  # Intercept\n        m_hat = beta_hat[1]  # Slope\n\n        # 5. Calculate covariance matrix of parameters\n        # Cov(beta_hat) = (X^T W X)^-1\n        cov_beta = XTWX_inv\n        sigma_c_sq = cov_beta[0, 0]\n        sigma_m_sq = cov_beta[1, 1]\n        \n        sigma_c = np.sqrt(sigma_c_sq)\n        sigma_m = np.sqrt(sigma_m_sq)\n\n        # 6. Calculate thermodynamic quantities and their uncertainties\n        # Delta_H = -m * R\n        # Delta_S = c * R\n        delta_H = -m_hat * R\n        delta_S = c_hat * R\n        \n        sigma_delta_H = sigma_m * R\n        sigma_delta_S = sigma_c * R\n\n        # 7. Convert units (H to kJ/mol) and round\n        delta_H_kJ = delta_H / 1000.0\n        sigma_delta_H_kJ = sigma_delta_H / 1000.0\n\n        # Store results for this case\n        case_result = [\n            round(delta_H_kJ, 6),\n            round(delta_S, 6),\n            round(sigma_delta_H_kJ, 6),\n            round(sigma_delta_S, 6)\n        ]\n        all_results.append(case_result)\n\n    # 8. Format the final output string as specified: [[...],[...]] without spaces\n    output_str = str(all_results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "在基本参数估计的基础上，本实践深入探讨了一个更复杂的多组分地球化学体系：水溶液碳酸盐体系。给定一对可测量（pH和$p\\text{CO}_2$），您将解决正向问题，以确定关键但通常无法直接测量的性质，如溶解无机碳（DIC）和总碱度（TA）。本练习还引入了局部灵敏度分析，这是一种强大的技术，用于量化模型常数（$K_1$, $K_2$, $K_w$）中的不确定性如何传播到最终计算结果中 。",
            "id": "4082880",
            "problem": "给定以碳酸盐体系为主导碱度的水样品的酸度和二氧化碳分压测量值。任务是通过求解非线性碳酸盐体系，根据这些测量值反演出溶解无机碳（DIC）和总碱度（TA），并评估这些反演量对平衡常数的局部灵敏度。将该体系视为理想体系，活度等于浓度，并忽略非碳酸盐和硼酸盐对碱度的贡献。\n\n使用以下基本原理：\n- 用于描述二氧化碳从气相溶解到液相的亨利定律：\n$$[\\mathrm{CO_2(aq)}] = K_0 \\, p\\mathrm{CO_2},$$\n其中 $K_0$ 是亨利定律常数，单位为 $\\mathrm{mol/(kg\\cdot atm)}$，$p\\mathrm{CO_2}$ 是二氧化碳分压，单位为 $\\mathrm{atm}$。\n- 碳酸两步电离的质量作用定律：\n$$K_1 = \\frac{[\\mathrm{H^+}][\\mathrm{HCO_3^-}]}{[\\mathrm{CO_2(aq)}]}, \\qquad K_2 = \\frac{[\\mathrm{H^+}][\\mathrm{CO_3^{2-}}]}{[\\mathrm{HCO_3^-}]},$$\n其中 $K_1$ 和 $K_2$ 的单位为 $\\mathrm{mol/kg}$。\n- 水的自电离：\n$$K_w = [\\mathrm{H^+}][\\mathrm{OH^-}],$$\n其中 $K_w$ 的单位为 $\\mathrm{(mol/kg)^2}$。\n- 溶解无机碳（DIC）的定义：\n$$\\mathrm{DIC} = [\\mathrm{CO_2(aq)}] + [\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}],$$\n单位为 $\\mathrm{mol/kg}$。\n- 在仅考虑碳酸盐的假设下，总碱度（TA）的定义：\n$$\\mathrm{TA} = [\\mathrm{HCO_3^-}] + 2[\\mathrm{CO_3^{2-}}] + [\\mathrm{OH^-}] - [\\mathrm{H^+}],$$\n单位为 $\\mathrm{mol/kg}$。\n- 酸度定义：\n$$\\mathrm{pH} = -\\log_{10}([\\mathrm{H^+}]).$$\n\n根据测量的 $\\mathrm{pH}$ 和 $p\\mathrm{CO_2}$，以及给定的常数 $K_0$、$K_1$、$K_2$、$K_w$，通过求解上述关系所构成的耦合非线性平衡系统，计算 $[\\mathrm{H^+}]$、$[\\mathrm{CO_2(aq)}]$、$[\\mathrm{HCO_3^-}]$ 和 $[\\mathrm{CO_3^{2-}}]$。反演出 $\\mathrm{DIC}$ 和 $\\mathrm{TA}$，单位为 $\\mathrm{mol/kg}$。然后，通过在固定的测量 $\\mathrm{pH}$ 和 $p\\mathrm{CO_2}$ 条件下计算偏导数，评估 $\\mathrm{DIC}$ 和 $\\mathrm{TA}$ 对平衡常数 $K_1$、$K_2$ 和 $K_w$ 的局部一阶灵敏度。报告由以下公式定义的无量纲相对灵敏度\n$$S_{Y,x} = \\left(\\frac{\\partial Y}{\\partial x}\\right)\\frac{x}{Y},$$\n其中 $Y \\in \\{\\mathrm{DIC}, \\mathrm{TA}\\}$ 且 $x \\in \\{K_1, K_2, K_w\\}$。请注意，如果在所述假设下 $Y$ 不依赖于 $x$，则灵敏度必须报告为 $0$。\n\n物理单位要求：\n- 最终的 $\\mathrm{DIC}$ 和 $\\mathrm{TA}$ 以 $\\mathrm{mol/kg}$ 为单位表示。\n- $\\mathrm{pH}$ 是无量纲的，$p\\mathrm{CO_2}$ 必须使用 $\\mathrm{atm}$ 单位。\n\n测试套件：\n为以下四个测试用例提供结果，每个用例均以 $(\\mathrm{pH}, p\\mathrm{CO_2}, K_0, K_1, K_2, K_w)$ 的形式给出，单位如上所述：\n1. $(8.10, 4.15\\times 10^{-4}, 3.40\\times 10^{-2}, 1.45\\times 10^{-6}, 1.04\\times 10^{-9}, 1.00\\times 10^{-14})$.\n2. $(6.50, 1.00\\times 10^{-2}, 3.40\\times 10^{-2}, 1.45\\times 10^{-6}, 1.04\\times 10^{-9}, 1.00\\times 10^{-14})$.\n3. $(10.00, 2.00\\times 10^{-4}, 3.40\\times 10^{-2}, 1.45\\times 10^{-6}, 1.04\\times 10^{-9}, 1.00\\times 10^{-14})$.\n4. $(7.00, 4.15\\times 10^{-4}, 3.40\\times 10^{-2}, 1.00\\times 10^{-6}, 1.00\\times 10^{-9}, 1.00\\times 10^{-14})$.\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。此顶层列表的每个元素必须是包含八个浮点数的列表，顺序完全如下：\n$$[\\mathrm{DIC}, \\mathrm{TA}, S_{\\mathrm{DIC},K_1}, S_{\\mathrm{DIC},K_2}, S_{\\mathrm{DIC},K_w}, S_{\\mathrm{TA},K_1}, S_{\\mathrm{TA},K_2}, S_{\\mathrm{TA},K_w}],$$\n其中前两个浮点数的单位是 $\\mathrm{mol/kg}$，灵敏度浮点数是无量纲的。例如，\n$$\\big[ [y_{11},y_{12},\\dots,y_{18}], [y_{21},y_{22},\\dots,y_{28}], [y_{31},y_{32},\\dots,y_{38}], [y_{41},y_{42},\\dots,y_{48}] \\big].$$",
            "solution": "该问题已经过验证，并被确定为计算地球化学中一个适定（well-posed）且科学上合理的练习。它要求应用化学平衡的基本原理来计算水相碳酸盐体系的关键属性及其对模型参数的灵敏度。解题步骤包括基于给定的测量值和常数进行直接计算，然后进行解析微分。\n\n求解过程分为三个阶段：\n1.  根据提供的测量值（$\\mathrm{pH}$、$p\\mathrm{CO_2}$）和平衡常数（$K_0$、$K_1$、$K_2$、$K_w$）计算所有相关水相物质的浓度。\n2.  使用其定义计算衍生量，即溶解无机碳（$\\mathrm{DIC}$）和总碱度（$\\mathrm{TA}$）。\n3.  推导和计算 $\\mathrm{DIC}$ 和 $\\mathrm{TA}$ 相对于平衡常数 $K_1$、$K_2$ 和 $K_w$ 的无量纲相对灵敏度 $S_{Y,x}$。\n\n**1. 物种浓度计算**\n\n该体系完全由测量的 $\\mathrm{pH}$ 和 $p\\mathrm{CO_2}$ 确定。我们可以按顺序计算每种物质的浓度。\n\n首先，氢离子浓度 $[\\mathrm{H^+}]$ 可直接从 $\\mathrm{pH}$ 的定义中获得：\n$$[\\mathrm{H^+}] = 10^{-\\mathrm{pH}}$$\n\n接下来，溶解的二氧化碳水溶液浓度 $[\\mathrm{CO_2(aq)}]$ 由亨利定律给出：\n$$[\\mathrm{CO_2(aq)}] = K_0 \\, p\\mathrm{CO_2}$$\n\n利用碳酸一级电离的质量作用定律，我们可以求出碳酸氢根浓度 $[\\mathrm{HCO_3^-}]$：\n$$K_1 = \\frac{[\\mathrm{H^+}][\\mathrm{HCO_3^-}]}{[\\mathrm{CO_2(aq)}]} \\implies [\\mathrm{HCO_3^-}] = \\frac{K_1 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]}$$\n\n类似地，从二级电离中，我们可以求出碳酸根离子浓度 $[\\mathrm{CO_3^{2-}}]$：\n$$K_2 = \\frac{[\\mathrm{H^+}][\\mathrm{CO_3^{2-}}]}{[\\mathrm{HCO_3^-}]} \\implies [\\mathrm{CO_3^{2-}}] = \\frac{K_2 [\\mathrm{HCO_3^-}]}{[\\mathrm{H^+}]} = \\frac{K_1 K_2 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]^2}$$\n\n最后，氢氧根离子浓度 $[\\mathrm{OH^-}]$ 可从水的自电离常数 $K_w$ 中求得：\n$$K_w = [\\mathrm{H^+}][\\mathrm{OH^-}] \\implies [\\mathrm{OH^-}] = \\frac{K_w}{[\\mathrm{H^+}]}$$\n\n**2. DIC 和 TA 的计算**\n\n在所有物种浓度都用输入量表示后，我们可以计算 $\\mathrm{DIC}$ 和 $\\mathrm{TA}$。\n\n溶解无机碳（$\\mathrm{DIC}$）是三种无机碳物种的浓度之和：\n$$\\mathrm{DIC} = [\\mathrm{CO_2(aq)}] + [\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}]$$\n代入上面推导出的表达式：\n$$\\mathrm{DIC} = [\\mathrm{CO_2(aq)}] \\left( 1 + \\frac{K_1}{[\\mathrm{H^+}]} + \\frac{K_1 K_2}{[\\mathrm{H^+}]^2} \\right)$$\n由于 $[\\mathrm{CO_2(aq)}]$ 和 $[\\mathrm{H^+}]$ 已知，可以直接计算 $\\mathrm{DIC}$。\n\n在所述的碳酸盐体系占主导地位的假设下，总碱度（$\\mathrm{TA}$）定义为：\n$$\\mathrm{TA} = [\\mathrm{HCO_3^-}] + 2[\\mathrm{CO_3^{2-}}] + [\\mathrm{OH^-}] - [\\mathrm{H^+}]$$\n代入每种浓度的表达式：\n$$\\mathrm{TA} = \\frac{K_1 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]} + 2\\frac{K_1 K_2 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]^2} + \\frac{K_w}{[\\mathrm{H^+}]} - [\\mathrm{H^+}]$$\n这也是一个直接计算。\n\n**3. 无量纲相对灵敏度的计算**\n\n我们需要计算无量纲相对灵敏度 $S_{Y,x} = \\left(\\frac{\\partial Y}{\\partial x}\\right)\\frac{x}{Y}$，其中 $Y \\in \\{\\mathrm{DIC}, \\mathrm{TA}\\}$ 且 $x \\in \\{K_1, K_2, K_w\\}$。偏导数是在测量的 $\\mathrm{pH}$ 和 $p\\mathrm{CO_2}$ 保持不变的情况下计算的，这意味着在微分过程中，$[\\mathrm{H^+}]$ 和 $[\\mathrm{CO_2(aq)}]$ 被视为常数。\n\n**DIC 的灵敏度：**\n$\\mathrm{DIC}$ 的表达式为：\n$\\mathrm{DIC} = [\\mathrm{CO_2(aq)}] + \\frac{K_1 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]} + \\frac{K_1 K_2 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]^2}$\n\n-   对 $K_1$ 的灵敏度：\n    $$\\frac{\\partial (\\mathrm{DIC})}{\\partial K_1} = \\frac{[\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]} + \\frac{K_2 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]^2}$$\n    $$S_{\\mathrm{DIC},K_1} = \\frac{\\partial (\\mathrm{DIC})}{\\partial K_1} \\frac{K_1}{\\mathrm{DIC}} = \\frac{\\left( \\frac{[\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]} + \\frac{K_2 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]^2} \\right) K_1}{\\mathrm{DIC}} = \\frac{\\frac{K_1 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]} + \\frac{K_1 K_2 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]^2}}{\\mathrm{DIC}} = \\frac{[\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}]}{\\mathrm{DIC}}$$\n\n-   对 $K_2$ 的灵敏度：\n    $$\\frac{\\partial (\\mathrm{DIC})}{\\partial K_2} = \\frac{K_1 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]^2}$$\n    $$S_{\\mathrm{DIC},K_2} = \\frac{\\partial (\\mathrm{DIC})}{\\partial K_2} \\frac{K_2}{\\mathrm{DIC}} = \\frac{\\left( \\frac{K_1 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]^2} \\right) K_2}{\\mathrm{DIC}} = \\frac{\\frac{K_1 K_2 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]^2}}{\\mathrm{DIC}} = \\frac{[\\mathrm{CO_3^{2-}}]}{\\mathrm{DIC}}$$\n\n-   对 $K_w$ 的灵敏度：\n    $\\mathrm{DIC}$ 的表达式不包含 $K_w$。因此：\n    $$\\frac{\\partial (\\mathrm{DIC})}{\\partial K_w} = 0 \\implies S_{\\mathrm{DIC},K_w} = 0$$\n\n**TA 的灵敏度：**\n$\\mathrm{TA}$ 的表达式为：\n$\\mathrm{TA} = \\frac{K_1 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]} + 2\\frac{K_1 K_2 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]^2} + \\frac{K_w}{[\\mathrm{H^+}]} - [\\mathrm{H^+}]$\n\n-   对 $K_1$ 的灵敏度：\n    $$\\frac{\\partial (\\mathrm{TA})}{\\partial K_1} = \\frac{[\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]} + 2\\frac{K_2 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]^2}$$\n    $$S_{\\mathrm{TA},K_1} = \\frac{\\partial (\\mathrm{TA})}{\\partial K_1} \\frac{K_1}{\\mathrm{TA}} = \\frac{\\left( \\frac{[\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]} + 2\\frac{K_2 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]^2} \\right) K_1}{\\mathrm{TA}} = \\frac{\\frac{K_1 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]} + 2\\frac{K_1 K_2 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]^2}}{\\mathrm{TA}} = \\frac{[\\mathrm{HCO_3^-}] + 2[\\mathrm{CO_3^{2-}}]}{\\mathrm{TA}}$$\n\n-   对 $K_2$ 的灵敏度：\n    $$\\frac{\\partial (\\mathrm{TA})}{\\partial K_2} = 2\\frac{K_1 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]^2}$$\n    $$S_{\\mathrm{TA},K_2} = \\frac{\\partial (\\mathrm{TA})}{\\partial K_2} \\frac{K_2}{\\mathrm{TA}} = \\frac{\\left( 2\\frac{K_1 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]^2} \\right) K_2}{\\mathrm{TA}} = \\frac{2\\frac{K_1 K_2 [\\mathrm{CO_2(aq)}]}{[\\mathrm{H^+}]^2}}{\\mathrm{TA}} = \\frac{2[\\mathrm{CO_3^{2-}}]}{\\mathrm{TA}}$$\n\n-   对 $K_w$ 的灵敏度：\n    $$\\frac{\\partial (\\mathrm{TA})}{\\partial K_w} = \\frac{1}{[\\mathrm{H^+}]}$$\n    $$S_{\\mathrm{TA},K_w} = \\frac{\\partial (\\mathrm{TA})}{\\partial K_w} \\frac{K_w}{\\mathrm{TA}} = \\frac{\\frac{1}{[\\mathrm{H^+}]} K_w}{\\mathrm{TA}} = \\frac{\\frac{K_w}{[\\mathrm{H^+}]}}{\\mathrm{TA}} = \\frac{[\\mathrm{OH^-}]}{\\mathrm{TA}}$$\n\n这些推导出的表达式可以被直接实现，以计算每个测试用例所需的值。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the computational geochemistry problem for the given test cases.\n    \"\"\"\n\n    test_cases = [\n        (8.10, 4.15e-4, 3.40e-2, 1.45e-6, 1.04e-9, 1.00e-14),\n        (6.50, 1.00e-2, 3.40e-2, 1.45e-6, 1.04e-9, 1.00e-14),\n        (10.00, 2.00e-4, 3.40e-2, 1.45e-6, 1.04e-9, 1.00e-14),\n        (7.00, 4.15e-4, 3.40e-2, 1.00e-6, 1.00e-9, 1.00e-14),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_carbonate_system_properties(*case)\n        results.append(result)\n    \n    # Format the final output string as a list of lists of floats.\n    inner_strings = []\n    for res in results:\n        # Format each float to a reasonable precision for consistent output\n        formatted_res = [f\"{v:.8e}\" if isinstance(v, float) else str(v) for v in res]\n        inner_strings.append(f\"[{','.join(formatted_res)}]\")\n    \n    final_output_string = f\"[{','.join(inner_strings)}]\"\n    print(final_output_string)\n\ndef calculate_carbonate_system_properties(ph, pco2, k0, k1, k2, kw):\n    \"\"\"\n    Calculates DIC, TA, and their sensitivities for a single set of parameters.\n\n    Args:\n        ph (float): pH of the sample.\n        pco2 (float): Partial pressure of CO2 in atm.\n        k0 (float): Henry's law constant in mol/(kg*atm).\n        k1 (float): First dissociation constant of carbonic acid in mol/kg.\n        k2 (float): Second dissociation constant of carbonic acid in mol/kg.\n        kw (float): Autoionization constant of water in (mol/kg)^2.\n\n    Returns:\n        list: A list of 8 floats: [DIC, TA, S_DIC_K1, S_DIC_K2, S_DIC_KW, \n                                  S_TA_K1, S_TA_K2, S_TA_KW].\n    \"\"\"\n    # 1. Calculate species concentrations\n    h_plus = 10**(-ph)\n    co2_aq = k0 * pco2\n    hco3 = k1 * co2_aq / h_plus\n    co3 = k2 * hco3 / h_plus\n    oh = kw / h_plus\n\n    # 2. Calculate DIC and TA\n    dic = co2_aq + hco3 + co3\n    ta = hco3 + 2 * co3 + oh - h_plus\n\n    # 3. Calculate sensitivities\n    # Sensitivities for DIC\n    # Note: If DIC is zero, sensitivities are undefined; however, given the physics,\n    # DIC will always be positive since co2_aq is positive.\n    s_dic_k1 = (hco3 + co3) / dic\n    s_dic_k2 = co3 / dic\n    s_dic_kw = 0.0\n\n    # Sensitivities for TA\n    # Note: If TA is zero, sensitivities are undefined. We check for this case,\n    # though it is unlikely with the given test inputs.\n    if ta == 0:\n        # Assign NaN or handle as an error, but for this problem, we can expect TA != 0.\n        # Following problem structure, we assume TA is non-zero.\n        s_ta_k1 = np.nan\n        s_ta_k2 = np.nan\n        s_ta_kw = np.nan\n    else:\n        s_ta_k1 = (hco3 + 2 * co3) / ta\n        s_ta_k2 = (2 * co3) / ta\n        s_ta_kw = oh / ta\n\n    return [dic, ta, s_dic_k1, s_dic_k2, s_dic_kw, s_ta_k1, s_ta_k2, s_ta_kw]\n\nsolve()\n```"
        },
        {
            "introduction": "在科学建模中，我们常常面临在对数据的简单解释和复杂解释之间做出选择。本练习通过模型选择来解决这个核心问题，比较了一个简单的理想溶液模型和一个更复杂的扩展德拜-休克尔理论。您将使用赤池信息准则（AIC）和贝叶斯信息准则（BIC）来定量评估模型拟合度与复杂性之间的权衡，学习如何避免过拟合，并选择最简约且最具预测性的模型 。",
            "id": "4082910",
            "problem": "您的任务是在计算地球化学领域，使用逆向建模、参数估计和优化方法进行模型选择。\n\n考虑在标准实验室温度下，扩展德拜-休克尔理论适用的水溶液中对称电解质的平均活度系数。您需要使用最大似然和信息准则原理，对相同的数据集比较理想溶液模型与德拜-休克尔模型。\n\n建模基本原理：\n- 对于阳离子和阴离子价数大小相等（均为 $z$）符号相反的对称电解质，理想溶液模型假设活度系数为1，因此平均活度系数满足 $\\gamma_{\\pm} = 1$，即 $\\log_{10}\\gamma_{\\pm} = 0$。\n- 对称电解质的扩展德拜-休克尔模型给出了以10为底的对数形式的平均活度系数：\n$$\n\\log_{10}\\gamma_{\\pm}(I; z, a) = -\\frac{A\\, z^2 \\sqrt{I}}{1 + B\\, a \\sqrt{I}},\n$$\n其中 $I$ 是离子强度，单位为 $\\text{mol}\\,\\text{L}^{-1}$，$z$ 是离子电荷的大小，$a$ 是有效离子尺寸参数，单位为 $\\text{\\AA}$，$A$ 和 $B$ 是在指定温度下与溶剂相关的常数。对于 $25\\,^{\\circ}\\text{C}$ 的水，请使用 $A = 0.509$ 和 $B = 0.328$。\n\n逆向建模和信息准则要求：\n- 假设观测响应 $y_i = \\log_{10}\\gamma_{\\pm}$ 的测量误差是独立的、服从高斯分布，且每次观测的标准差 $\\sigma_i$ 已知。在此假设下，模型在观测点 $i$ 的预测值 $m_i$ 的对数似然是高斯对数似然的总和。\n- 请从最大似然和模型维度的第一性原理出发，数学上定义赤池信息准则 (Akaike Information Criterion, AIC) 和贝叶斯信息准则 (Bayesian Information Criterion, BIC)，并应用它们来比较每个数据集的理想溶液模型和德拜-休克尔模型。理想溶液模型有零个拟合参数 ($k = 0$)。对于本问题中的德拜-休克尔模型，将 $a$ 视为唯一的拟合参数 ($k = 1$)，所有其他量均已指定。在计算信息准则时，请使用与每个数据集相对应的观测数量 $n$。\n\n参数估计设置：\n- 对于德拜-休克尔模型，在所述的具有已知 $\\sigma_i$ 的高斯误差模型下，通过最大似然法估计 $a$。将 $a$ 约束在物理上合理的区间 $[1, 20]$（单位为 $\\text{\\AA}$）内。\n\n测试套件：\n将您的方法应用于以下四种情况。对于每种情况，自变量是离子强度 $I$ (单位 $\\text{mol}\\,\\text{L}^{-1}$)，电荷大小是 $z$，观测响应 $y$ 是 $\\log_{10}\\gamma_{\\pm}$ (无量纲)，观测标准差是 $\\sigma$ (无量纲)。所提供的 $y$ 值在科学上是合理的，并且与在 $25\\,^{\\circ}\\text{C}$ 下使用所述 $A$ 和 $B$ 及某个潜在真实 $a$ 值的扩展德拜-休克尔模型一致；无需进一步转换。\n\n- 情况 (a) 低离子强度，一价对称电解质：\n  - $I = [0.001, 0.010, 0.050]$\n  - $z = 1$\n  - $y = [-0.015460, -0.045000, -0.087970]$\n  - $\\sigma = [0.010, 0.010, 0.010]$\n  - 单位：$I$ 的单位是 $\\text{mol}\\,\\text{L}^{-1}$，$a$ 的单位是 $\\text{\\AA}$，$\\sigma$ 无量纲。\n\n- 情况 (b) 低至中等离子强度，二价对称电解质：\n  - $I = [0.001, 0.010, 0.030]$\n  - $z = 2$\n  - $y = [-0.058950, -0.157200, -0.233200]$\n  - $\\sigma = [0.020, 0.020, 0.020]$\n  - 单位：$I$ 的单位是 $\\text{mol}\\,\\text{L}^{-1}$，$a$ 的单位是 $\\text{\\AA}$，$\\sigma$ 无量纲。\n\n- 情况 (c) 零离子强度下的边界条件，一价对称电解质：\n  - $I = [0.000]$\n  - $z = 1$\n  - $y = [0.000000]$\n  - $\\sigma = [0.001]$\n  - 单位：$I$ 的单位是 $\\text{mol}\\,\\text{L}^{-1}$，$a$ 的单位是 $\\text{\\AA}$，$\\sigma$ 无量纲。\n\n- 情况 (d) 接近扩展德拜-休克尔理论有效性极限的较高离子强度，一价对称电解质：\n  - $I = [0.080, 0.100]$\n  - $z = 1$\n  - $y = [-0.104300, -0.113800]$\n  - $\\sigma = [0.020, 0.020]$\n  - 单位：$I$ 的单位是 $\\text{mol}\\,\\text{L}^{-1}$，$a$ 的单位是 $\\text{\\AA}$，$\\sigma$ 无量纲。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于按给定顺序的每种情况，输出浮点数差异对 $[\\Delta \\text{AIC}, \\Delta \\text{BIC}]$，其中 $\\Delta \\text{AIC} = \\text{AIC}_{\\text{Debye-H\\\"uckel}} - \\text{AIC}_{\\text{Ideal}}$ 以及 $\\Delta \\text{BIC} = \\text{BIC}_{\\text{Debye-H\\\"uckel}} - \\text{BIC}_{\\text{Ideal}}$。将四种情况的结果汇总成一个列表的列表，形式如下\n$$\n[[\\Delta \\text{AIC}_a, \\Delta \\text{BIC}_a], [\\Delta \\text{AIC}_b, \\Delta \\text{BIC}_b], [\\Delta \\text{AIC}_c, \\Delta \\text{BIC}_c], [\\Delta \\text{AIC}_d, \\Delta \\text{BIC}_d]].\n$$\n这些最终值不需要单位。打印的单行应与此嵌套列表的文本列表表示完全匹配。",
            "solution": "该问题陈述经评估有效。它在科学上植根于物理化学（德拜-休克尔理论）和统计学（最大似然、信息准则）的原理。该问题是适定的（well-posed），所有必要的数据、常数、模型和约束都已明确定义，从而能够得出唯一且有意义的解。它是客观的，没有歧义或矛盾。\n\n任务是比较用于对称电解质平均活度系数($\\gamma_{\\pm}$)的两个模型：一个理想溶液模型和一个扩展德拜-休克尔模型。该比较将使用赤池信息准则 (Akaike Information Criterion, AIC) 和贝叶斯信息准则 (Bayesian Information Criterion, BIC)，并基于通过最大似然法进行的参数估计来执行。\n\n该方法的核心在于最大似然原理。对于一组 $n$ 个独立观测值 $y_i$，其相关的高斯误差具有已知的标准差 $\\sigma_i$，一个产生预测值 $m_i$ 的模型的似然由各个概率密度的乘积给出：\n$$\nL = \\prod_{i=1}^{n} \\frac{1}{\\sqrt{2\\pi}\\sigma_i} \\exp\\left(-\\frac{(y_i - m_i)^2}{2\\sigma_i^2}\\right)\n$$\n最大化该似然等同于最小化其负对数。负对数似然 $\\mathcal{L} = -\\ln L$ 为：\n$$\n\\mathcal{L} = \\frac{n}{2}\\ln(2\\pi) + \\sum_{i=1}^{n}\\ln(\\sigma_i) + \\frac{1}{2} \\sum_{i=1}^{n} \\left(\\frac{y_i - m_i}{\\sigma_i}\\right)^2\n$$\n模型的参数通过最小化此函数来估计。求和项是加权残差平方和，通常表示为 $\\chi^2$。\n$$\n\\chi^2 = \\sum_{i=1}^{n} \\left(\\frac{y_i - m_i}{\\sigma_i}\\right)^2\n$$\n因此，最大化似然等同于最小化 $\\chi^2$。设给定模型下此函数的最小值为 $\\chi^2_{\\text{min}}$。\n\n要比较的两个模型是：\n1.  **理想溶液模型 ($M_0$)**: 该模型假定 $\\log_{10}\\gamma_{\\pm} = 0$。模型对所有观测的预测值均为 $m_{0,i} = 0$。该模型没有可调参数，因此其维度为 $k_0 = 0$。拟合优度计算如下：\n    $$\n    \\chi^2_{\\text{min, Ideal}} = \\sum_{i=1}^{n} \\left(\\frac{y_i - 0}{\\sigma_i}\\right)^2 = \\sum_{i=1}^{n} \\frac{y_i^2}{\\sigma_i^2}\n    $$\n\n2.  **扩展德拜-休克尔模型 ($M_1$)**: 该模型给出了 $\\log_{10}\\gamma_{\\pm}$ 的预测值，其是离子强度 $I$、电荷大小 $z$ 和有效离子尺寸参数 $a$ 的函数：\n    $$\n    m_{1,i}(a) = \\log_{10}\\gamma_{\\pm}(I_i; z, a) = -\\frac{A\\, z^2 \\sqrt{I_i}}{1 + B\\, a \\sqrt{I_i}}\n    $$\n    常数给定为 $A = 0.509$ 和 $B = 0.328$。参数 $a$ 需要从数据中估计，因此该模型的维度为 $k_1 = 1$。通过最小化此模型的 $\\chi^2$ 函数来找到 $a$ 的值：\n    $$\n    \\chi^2_{M_1}(a) = \\sum_{i=1}^{n} \\left(\\frac{y_i - m_{1,i}(a)}{\\sigma_i}\\right)^2\n    $$\n    这是一个在区间 $a \\in [1, 20]\\, \\text{\\AA}$ 上的一维优化问题。找到的最小值为 $\\chi^2_{\\text{min, DH}}$。\n\n模型选择使用信息准则进行，该准则对模型的复杂性（参数数量）进行惩罚，以避免过拟合。\n赤池信息准则 (AIC) 定义为：\n$$\n\\text{AIC} = -2 \\ln(L_{\\text{max}}) + 2k\n$$\n其中 $L_{\\text{max}}$ 是最大似然值。代入包含 $\\chi^2_{\\text{min}}$ 的对数似然表达式：\n$$\n\\text{AIC} = 2\\mathcal{L}_{\\text{min}} + 2k = n\\ln(2\\pi) + 2\\sum_{i=1}^{n}\\ln(\\sigma_i) + \\chi^2_{\\text{min}} + 2k\n$$\n贝叶斯信息准则 (BIC) 定义为：\n$$\n\\text{BIC} = -2 \\ln(L_{\\text{max}}) + k\\ln(n) = n\\ln(2\\pi) + 2\\sum_{i=1}^{n}\\ln(\\sigma_i) + \\chi^2_{\\text{min}} + k\\ln(n)\n$$\n其中 $n$ 是观测数量。\n\n为了比较两个模型，我们计算差异 $\\Delta\\text{AIC}$ 和 $\\Delta\\text{BIC}$。涉及 $\\pi$ 和 $\\sigma_i$ 的常数项会抵消掉。\n$$\n\\Delta \\text{AIC} = \\text{AIC}_{\\text{DH}} - \\text{AIC}_{\\text{Ideal}} = (\\chi^2_{\\text{min, DH}} + 2k_1) - (\\chi^2_{\\text{min, Ideal}} + 2k_0)\n$$\n当 $k_1=1$ 且 $k_0=0$ 时：\n$$\n\\Delta \\text{AIC} = \\chi^2_{\\text{min, DH}} - \\chi^2_{\\text{min, Ideal}} + 2\n$$\n对于 BIC 同样如此：\n$$\n\\Delta \\text{BIC} = \\text{BIC}_{\\text{DH}} - \\text{BIC}_{\\text{Ideal}} = (\\chi^2_{\\text{min, DH}} + k_1\\ln n) - (\\chi^2_{\\text{min, Ideal}} + k_0\\ln n)\n$$\n当 $k_1=1$ 且 $k_0=0$ 时：\n$$\n\\Delta \\text{BIC} = \\chi^2_{\\text{min, DH}} - \\chi^2_{\\text{min, Ideal}} + \\ln n\n$$\n这些差异的负值表明，即使在对额外参数进行惩罚之后，更复杂的德拜-休克尔模型也能更好地描述数据。\n\n每个测试用例的计算过程如下：\n1.  将 $I$、$y$ 和 $\\sigma$ 的输入数据列表转换为数值数组。确定观测数量 $n$。\n2.  使用其定义计算 $\\chi^2_{\\text{min, Ideal}}$。\n3.  定义德拜-休克尔模型及相应的 $\\chi^2_{M_1}(a)$ 作为目标函数。\n4.  使用数值优化程序，在 $[1, 20]$ 范围内找到使 $\\chi^2_{M_1}(a)$ 最小化的值 $\\hat{a}$，从而得到 $\\chi^2_{\\text{min, DH}}$。\n5.  使用计算出的 $\\chi^2$ 值来计算 $\\Delta \\text{AIC}$ 和 $\\Delta \\text{BIC}$。\n\n一个特殊情况是案例 (c)，其中 $I = [0.0]$。在零离子强度下，两个模型都预测 $\\log_{10}\\gamma_{\\pm} = 0$。由于观测值也是 $y=[0.0]$，两个模型都完美拟合。因此，$\\chi^2_{\\text{min, Ideal}} = 0$ 且 $\\chi^2_{\\text{min, DH}} = 0$。观测数量为 $n=1$。差异变为：\n$$\n\\Delta \\text{AIC} = 0 - 0 + 2 = 2\n$$\n$$\n\\Delta \\text{BIC} = 0 - 0 + \\ln(1) = 0\n$$\n这表明，对于两个模型都精确拟合的单个数据点，AIC 会惩罚更复杂的模型，而 BIC 由于其惩罚项为 $\\ln(n)$，则不会。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Solves the model selection problem for four test cases in computational geochemistry.\n    Compares an ideal-solution model with the extended Debye-Hückel model using\n    Akaike (AIC) and Bayesian (BIC) information criteria.\n    \"\"\"\n    \n    A = 0.509  # Debye-Hückel constant for water at 25 C\n    B = 0.328  # Debye-Hückel constant for water at 25 C\n    a_bounds = (1.0, 20.0) # Physical bounds for ion-size parameter in Angstroms\n\n    test_cases = [\n        # Case (a) low ionic strength, monovalent\n        {\n            \"I\": np.array([0.001, 0.010, 0.050]),\n            \"z\": 1.0,\n            \"y\": np.array([-0.015460, -0.045000, -0.087970]),\n            \"sigma\": np.array([0.010, 0.010, 0.010]),\n        },\n        # Case (b) low-to-moderate ionic strength, divalent\n        {\n            \"I\": np.array([0.001, 0.010, 0.030]),\n            \"z\": 2.0,\n            \"y\": np.array([-0.058950, -0.157200, -0.233200]),\n            \"sigma\": np.array([0.020, 0.020, 0.020]),\n        },\n        # Case (c) boundary condition at zero ionic strength, monovalent\n        {\n            \"I\": np.array([0.000]),\n            \"z\": 1.0,\n            \"y\": np.array([0.000000]),\n            \"sigma\": np.array([0.001]),\n        },\n        # Case (d) higher ionic strength, monovalent\n        {\n            \"I\": np.array([0.080, 0.100]),\n            \"z\": 1.0,\n            \"y\": np.array([-0.104300, -0.113800]),\n            \"sigma\": np.array([0.020, 0.020]),\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        I, z, y, sigma = case[\"I\"], case[\"z\"], case[\"y\"], case[\"sigma\"]\n        n = len(y)\n\n        # 1. Ideal-Solution Model (M0)\n        # Model prediction is m = 0. k=0 parameters.\n        chi2_ideal = np.sum((y / sigma)**2)\n        k_ideal = 0\n\n        # 2. Extended Debye-Hückel Model (M1)\n        # Model prediction is a function of parameter 'a'. k=1 parameter.\n        def debye_huckel_model(I_vals, z_val, a_val, A_val, B_val):\n            sqrt_I = np.sqrt(I_vals)\n            # This calculation is robust against I=0, as sqrt(0)=0 and the numerator becomes 0.\n            return -A_val * z_val**2 * sqrt_I / (1 + B_val * a_val * sqrt_I)\n\n        def objective_function(a, I_vals, z_val, y_vals, sigma_vals, A_val, B_val):\n            y_pred = debye_huckel_model(I_vals, z_val, a, A_val, B_val)\n            residuals = y_vals - y_pred\n            return np.sum((residuals / sigma_vals)**2)\n\n        # Handle the special case where I=0, y=0.\n        # The objective function is identically zero, so optimization is not needed.\n        if np.all(I == 0):\n             chi2_min_dh = 0.0\n        else:\n            opt_result = minimize_scalar(\n                fun=objective_function,\n                bounds=a_bounds,\n                args=(I, z, y, sigma, A, B),\n                method='bounded'\n            )\n            chi2_min_dh = opt_result.fun\n\n        k_dh = 1\n\n        # 3. Calculate Information Criteria Differences\n        # delta_AIC = (chi2_dh + 2*k_dh) - (chi2_ideal + 2*k_ideal)\n        delta_aic = (chi2_min_dh - chi2_ideal) + 2 * (k_dh - k_ideal)\n\n        # delta_BIC = (chi2_dh + k_dh*ln(n)) - (chi2_ideal + k_ideal*ln(n))\n        # Handle n=1 where ln(1)=0\n        if n > 0:\n            ln_n = np.log(n)\n        else:\n            ln_n = 0 # should not happen with given data\n        delta_bic = (chi2_min_dh - chi2_ideal) + (k_dh - k_ideal) * ln_n\n\n        results.append([delta_aic, delta_bic])\n        \n    # The required output is the string representation of the list of lists.\n    # The placeholder `f\"[{','.join(map(str, results))}]\"` doesn't produce standard\n    # list-of-list formatting with spaces. Direct str() casting does.\n    # e.g., str([[1.2, 3.4], [5.6, 7.8]]) is '[[1.2, 3.4], [5.6, 7.8]]'\n    # The prompt's example format shows spaces after commas, so str() is correct.\n    # The example print format in the prompt template might be misleading for nested lists.\n    # I will adapt it to produce the correct textual representation.\n    \n    # Correction to match textual representation with spaces as in standard `str(list)`\n    final_output_str = str(results)\n    \n    # A custom formatter to match the format from the prompt's `f\"[{','.join...}]\"` exactly\n    # just in case that's the intended interpretation (no spaces).\n    # final_output_str = f\"[{','.join(str(item) for item in results)}]\"\n    # This results in '[[...], [...]...]' with spaces inside but not between sublists.\n    # `str(list)` is the most standard interpretation of \"textual list representation\".\n    \n    print(final_output_str)\n\n\nsolve()\n```"
        }
    ]
}