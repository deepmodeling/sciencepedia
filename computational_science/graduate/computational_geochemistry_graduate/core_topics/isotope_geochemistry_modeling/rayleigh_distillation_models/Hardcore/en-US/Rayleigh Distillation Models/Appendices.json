{
    "hands_on_practices": [
        {
            "introduction": "A fundamental application of the Rayleigh distillation model is to determine the extent to which a process, like magma degassing or evaporation, has progressed. This exercise challenges you to apply the core Rayleigh equation in an inverse manner, starting from an observed change in isotopic composition to calculate the fraction of material remaining, $f$. This is a crucial skill for reconstructing the history of geochemical systems from a single sample .",
            "id": "4097486",
            "problem": "A closed-system degassing event removes hydrogen from a silicate melt in small increments under constant isotopic fractionation. Let the heavy-to-light isotope ratio of deuterium to protium be denoted by $R \\equiv N_{\\mathrm{D}}/N_{\\mathrm{H}}$, where $N_{\\mathrm{D}}$ and $N_{\\mathrm{H}}$ are the numbers of deuterium and protium atoms, respectively, in the melt. The initial isotopic ratio of the melt is $R_{0}$ at the start of degassing. At any instant, the product (the vapor that leaves the system) has an isotopic ratio $R_{\\mathrm{p}}$ related to the instantaneous melt ratio $R$ by a constant equilibrium fractionation factor $\\alpha$ defined as $\\alpha \\equiv R_{\\mathrm{p}}/R$. Assume $0\\alpha\\neq 1$ and that the system remains closed with respect to mass except for the removal of vapor as it forms.\n\nYou collect a single measurement of the residual melt isotopic ratio $R$ after degassing has progressed, and you know $R_{0}$ and $\\alpha$ from independent constraints. Define the fraction of the light isotope remaining in the melt as $f \\equiv N_{\\mathrm{H}}/N_{\\mathrm{H},0}$, where $N_{\\mathrm{H},0}$ is the initial amount of the light isotope in the melt. \n\nGiven the values $R_{0} = 1.5576 \\times 10^{-4}$, $R = 1.5645 \\times 10^{-4}$, and $\\alpha = 0.9850$, infer $f$ from these data under the assumptions stated, starting from first principles appropriate to closed-system Rayleigh distillation. As part of your reasoning, include appropriate checks to ensure that the inferred $f$ respects the physical bounds $0  f \\leq 1$ and that the direction of change in $R$ with decreasing $f$ is consistent with the given $\\alpha$. Express your final answer for $f$ as a pure number and round your answer to four significant figures.",
            "solution": "The problem will first be validated to ensure it is scientifically sound, well-posed, and objective.\n\n### Step 1: Extract Givens\n- The heavy-to-light isotope ratio is defined as $R \\equiv N_{\\mathrm{D}}/N_{\\mathrm{H}}$.\n- The initial isotopic ratio of the melt is $R_{0}$.\n- The product (vapor) has an isotopic ratio $R_{\\mathrm{p}}$.\n- The equilibrium fractionation factor is a constant defined as $\\alpha \\equiv R_{\\mathrm{p}}/R$.\n- The constraints on the fractionation factor are $0  \\alpha \\neq 1$.\n- The system is a closed system undergoing degassing, where vapor is removed as it forms.\n- The fraction of the light isotope remaining in the melt is defined as $f \\equiv N_{\\mathrm{H}}/N_{\\mathrm{H},0}$.\n- The initial amount of the light isotope is $N_{\\mathrm{H},0}$.\n- The given numerical values are $R_{0} = 1.5576 \\times 10^{-4}$, $R = 1.5645 \\times 10^{-4}$, and $\\alpha = 0.9850$.\n- The task is to infer the value of $f$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientific Grounding**: The problem describes a classic case of Rayleigh distillation, a fundamental model used in geochemistry and other fields to describe isotopic fractionation in a system where a product is continuously removed from a finite reservoir. The definitions of isotopic ratios, the fractionation factor $\\alpha$, and the fraction remaining $f$ are standard. The context of hydrogen isotope fractionation during silicate melt degassing is a well-studied, geochemically relevant process. The problem is scientifically grounded.\n2.  **Well-Posedness**: The problem provides all necessary parameters ($R_{0}$, $R$, $\\alpha$) to determine the single unknown variable, $f$, through the governing Rayleigh equation. The setup is self-contained and sufficient for a unique solution.\n3.  **Objectivity**: The problem is stated using precise, quantitative language and established scientific definitions. There is no subjective or ambiguous terminology.\n4.  **Consistency**: A critical check is the consistency between the direction of isotopic change and the value of $\\alpha$. The given fractionation factor is $\\alpha = 0.9850$, which is less than $1$. This signifies that the product (vapor) is depleted in the heavy isotope (D) relative to the source (melt). Consequently, as degassing progresses and material is removed, the residual melt must become progressively enriched in the heavy isotope. This requires that the final ratio $R$ be greater than the initial ratio $R_{0}$. The provided data are $R = 1.5645 \\times 10^{-4}$ and $R_{0} = 1.5576 \\times 10^{-4}$. Indeed, $R > R_{0}$, which is consistent with the physical process implied by $\\alpha  1$. The data are internally consistent.\n5.  **Realism**: The isotopic ratios are typical for terrestrial D/H systems, and the fractionation factor is a plausible value for hydrogen isotope partitioning between a silicate melt and a water-rich vapor phase at magmatic temperatures.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is a well-posed, scientifically sound, and internally consistent application of the Rayleigh distillation model. A solution can now be derived.\n\n### Derivation and Solution\nThe process described is Rayleigh distillation. We start from the fundamental definitions to derive the governing equation. Let $N_{\\mathrm{H}}$ and $N_{\\mathrm{D}}$ be the amounts of the light (protium) and heavy (deuterium) isotopes in the melt reservoir at any time. The isotopic ratio in the melt is $R = N_{\\mathrm{D}}/N_{\\mathrm{H}}$.\n\nConsider an infinitesimal amount of vapor removed from the melt. Let this increment contain $dN_{\\mathrm{H}}$ of the light isotope and $dN_{\\mathrm{D}}$ of the heavy isotope. The isotopic ratio of this infinitesimal product, $R_{\\mathrm{p}}$, is given by the ratio of the amounts removed:\n$$R_{\\mathrm{p}} = \\frac{dN_{\\mathrm{D}}}{dN_{\\mathrm{H}}}$$\nThe problem states that this product ratio is related to the instantaneous melt ratio $R$ by the constant fractionation factor $\\alpha$:\n$$R_{\\mathrm{p}} = \\alpha R$$\nSubstituting the expressions for the ratios, we get:\n$$\\frac{dN_{\\mathrm{D}}}{dN_{\\mathrm{H}}} = \\alpha \\frac{N_{\\mathrm{D}}}{N_{\\mathrm{H}}}$$\nThis differential equation can be rearranged for integration by separating the variables for the heavy and light isotopes:\n$$\\frac{dN_{\\mathrm{D}}}{N_{\\mathrm{D}}} = \\alpha \\frac{dN_{\\mathrm{H}}}{N_{\\mathrm{H}}}$$\nWe integrate this equation from the initial state (with amounts $N_{\\mathrm{H},0}$ and $N_{\\mathrm{D},0}$) to a final state (with amounts $N_{\\mathrm{H}}$ and $N_{\\mathrm{D}}$):\n$$\\int_{N_{\\mathrm{D},0}}^{N_{\\mathrm{D}}} \\frac{dN_{\\mathrm{D}}}{N_{\\mathrm{D}}} = \\alpha \\int_{N_{\\mathrm{H},0}}^{N_{\\mathrm{H}}} \\frac{dN_{\\mathrm{H}}}{N_{\\mathrm{H}}}$$\nEvaluating the integrals yields:\n$$\\ln(N_{\\mathrm{D}}) - \\ln(N_{\\mathrm{D},0}) = \\alpha \\left[ \\ln(N_{\\mathrm{H}}) - \\ln(N_{\\mathrm{H},0}) \\right]$$\nUsing the properties of logarithms, this becomes:\n$$\\ln\\left(\\frac{N_{\\mathrm{D}}}{N_{\\mathrm{D},0}}\\right) = \\alpha \\ln\\left(\\frac{N_{\\mathrm{H}}}{N_{\\mathrm{H},0}}\\right) = \\ln\\left[ \\left(\\frac{N_{\\mathrm{H}}}{N_{\\mathrm{H},0}}\\right)^{\\alpha} \\right]$$\nExponentiating both sides gives the relationship between the amounts of each isotope remaining:\n$$\\frac{N_{\\mathrm{D}}}{N_{\\mathrm{D},0}} = \\left(\\frac{N_{\\mathrm{H}}}{N_{\\mathrm{H},0}}\\right)^{\\alpha}$$\nTo express this in terms of the isotopic ratios $R$ and $R_{0}$, we use $N_{\\mathrm{D}} = R N_{\\mathrm{H}}$ and $N_{\\mathrm{D},0} = R_{0} N_{\\mathrm{H},0}$:\n$$\\frac{R N_{\\mathrm{H}}}{R_{0} N_{\\mathrm{H},0}} = \\left(\\frac{N_{\\mathrm{H}}}{N_{\\mathrm{H},0}}\\right)^{\\alpha}$$\nRearranging to solve for the ratio of the isotopic ratios, $R/R_{0}$:\n$$\\frac{R}{R_{0}} = \\frac{N_{\\mathrm{H},0}}{N_{\\mathrm{H}}} \\left(\\frac{N_{\\mathrm{H}}}{N_{\\mathrm{H},0}}\\right)^{\\alpha} = \\left(\\frac{N_{\\mathrm{H}}}{N_{\\mathrm{H},0}}\\right)^{-1} \\left(\\frac{N_{\\mathrm{H}}}{N_{\\mathrm{H},0}}\\right)^{\\alpha} = \\left(\\frac{N_{\\mathrm{H}}}{N_{\\mathrm{H},0}}\\right)^{\\alpha-1}$$\nThe problem defines the fraction of the light isotope remaining as $f \\equiv N_{\\mathrm{H}}/N_{\\mathrm{H},0}$. Substituting this definition gives the standard form of the Rayleigh distillation equation:\n$$\\frac{R}{R_{0}} = f^{\\alpha-1}$$\nWe need to solve for $f$. Taking the natural logarithm of both sides:\n$$\\ln\\left(\\frac{R}{R_{0}}\\right) = (\\alpha-1)\\ln(f)$$\nIsolating $\\ln(f)$:\n$$\\ln(f) = \\frac{\\ln(R/R_{0})}{\\alpha-1}$$\nFinally, we can solve for $f$ by exponentiating:\n$$f = \\exp\\left(\\frac{\\ln(R/R_{0})}{\\alpha-1}\\right)$$\nNow, we substitute the given values:\n$R_{0} = 1.5576 \\times 10^{-4}$\n$R = 1.5645 \\times 10^{-4}$\n$\\alpha = 0.9850$\n\nFirst, compute the ratio $R/R_{0}$:\n$$\\frac{R}{R_{0}} = \\frac{1.5645 \\times 10^{-4}}{1.5576 \\times 10^{-4}} = \\frac{1.5645}{1.5576} \\approx 1.004430$$\nNext, compute the term $\\alpha-1$:\n$$\\alpha-1 = 0.9850 - 1 = -0.0150$$\nNow, substitute these into the expression for $f$:\n$$f = \\exp\\left(\\frac{\\ln(1.5645/1.5576)}{-0.0150}\\right)$$\n$$f \\approx \\exp\\left(\\frac{\\ln(1.004430)}{-0.0150}\\right) \\approx \\exp\\left(\\frac{0.0044202}{-0.0150}\\right) \\approx \\exp(-0.29468)$$\n$$f \\approx 0.74476$$\nThe problem requires the answer to be rounded to four significant figures.\n$$f \\approx 0.7448$$\nAs a final check on physical bounds, the calculated value $f \\approx 0.7448$ is between $0$ and $1$, which is physically required for a fraction of a remaining species. This confirms the validity of the result. It indicates that approximately $74.48\\%$ of the original hydrogen (protium) remains in the melt.",
            "answer": "$$\\boxed{0.7448}$$"
        },
        {
            "introduction": "While the fractionation factor, $\\alpha$, can sometimes be determined experimentally, it is often a key unknown that must be inferred from the natural system itself. This practice guides you through the process of fitting the Rayleigh model to a series of measurements, a foundational skill in computational geochemistry. You will learn how to linearize the model for regression analysis and how to properly handle uncertainty, including cases where the initial isotopic composition, $R_0$, is not perfectly known .",
            "id": "4097453",
            "problem": "You are modeling isotopic evolution in a closed-system removal process using Rayleigh distillation within computational geochemistry. Let the isotopic ratio of the residue be denoted by $R$, defined as the ratio of a heavy isotope to a light isotope in the residue, and let $f$ denote the fraction of the original reservoir remaining. The instantaneous product is fractionated relative to the reservoir by the fractionation factor $\\alpha$, defined as the ratio of isotopic ratios in the product and the reservoir during removal. The initial isotopic ratio (at $f = 1$) is $R_0$. Measurements provide $R$ at several values of $f$ and associated uncertainties for $R$, but $R_0$ may or may not be directly measured. Your tasks are:\n- Starting from fundamental definitions of isotopic fractionation and mass balance for Rayleigh distillation, derive a linear relationship between appropriately transformed variables that allows estimation of the fractionation factor $\\alpha$ by linear regression. Explain which regression form to use when $R_0$ is known versus when $R_0$ is uncertain and not directly measured.\n- Design algorithms that (i) when $R_0$ is known, estimate $\\alpha$ using a statistically principled linear regression formulation with zero intercept, and (ii) when $R_0$ is not directly measured but has an uncertainty characterized by a Gaussian prior on $\\ln R_0$, estimate $\\alpha$ by a Bayesian linear regression treating $\\ln R_0$ as a nuisance parameter with a Gaussian prior. In both cases, report a one-standard-deviation uncertainty for $\\alpha$ that is consistent with the assumed Gaussian measurement noise and, for the Bayesian case, with the specified priors.\n- Use first-order uncertainty propagation for logarithms to transform measurement uncertainties: if the measurement uncertainty for $R$ at a given point is $\\sigma_R$, then the uncertainty for $\\ln R$ is $\\sigma_{\\ln R} \\approx \\sigma_R / R$. When using $\\ln(R/R_0)$ with known $R_0$, the uncertainty is the same, $\\sigma_{\\ln(R/R_0)} \\approx \\sigma_R / R$, assuming $R_0$ has no uncertainty.\n\nAll quantities in this problem are dimensionless. Your program must implement the requested estimation procedures for the following test suite. Each test case specifies arrays of $f$, measured $R$, and $\\sigma_R$; for known $R_0$ cases, the constant $R_0$ is provided; for unknown $R_0$ cases, a Gaussian prior for $\\ln R_0$ is specified by its mean and standard deviation, and a Gaussian prior for the slope is specified by its standard deviation. For each test case, compute two outputs: the estimated $\\alpha$ and its one-standard-deviation uncertainty, both expressed as decimal numbers (dimensionless), rounded to six decimal places.\n\nTest suite:\n- Case A (known $R_0$, broad $f$ range):\n  - $f = [1.0, 0.8, 0.6, 0.5, 0.35]$\n  - $R_0 = 0.0112372$\n  - $R = [0.0112372, 0.0112435, 0.0112516, 0.0112567, 0.0112668]$\n  - $\\sigma_R = [5 \\times 10^{-7}, 5 \\times 10^{-7}, 5 \\times 10^{-7}, 5 \\times 10^{-7}, 5 \\times 10^{-7}]$\n- Case B (unknown $R_0$ with informative prior on $\\ln R_0$):\n  - $f = [1.0, 0.7, 0.5, 0.3, 0.15]$\n  - $R = [0.0020550, 0.0020631, 0.0020708, 0.0020824, 0.0020983]$\n  - $\\sigma_R = [2 \\times 10^{-6}, 2 \\times 10^{-6}, 2 \\times 10^{-6}, 2 \\times 10^{-6}, 2 \\times 10^{-6}]$\n  - Prior for $\\ln R_0$: mean $\\mu_{\\ln R_0} = \\ln(0.0020)$, standard deviation $\\sigma_{\\ln R_0} = 0.1$\n  - Prior for slope: standard deviation $\\sigma_{\\text{slope}} = 1.0$\n- Case C (known $R_0$, $f$ near $1$, weak fractionation):\n  - $f = [1.0, 0.95, 0.9]$\n  - $R_0 = 0.0112372$\n  - $R = [0.0112372, 0.0112369, 0.0112366]$\n  - $\\sigma_R = [3 \\times 10^{-7}, 3 \\times 10^{-7}, 3 \\times 10^{-7}]$\n- Case D (unknown $R_0$ with broad prior on $\\ln R_0$, very small $f$):\n  - $f = [1.0, 0.5, 0.25, 0.125, 0.0625]$\n  - $R = [0.0032000, 0.0032111, 0.0032223, 0.0032333, 0.0032444]$\n  - $\\sigma_R = [8 \\times 10^{-7}, 8 \\times 10^{-7}, 8 \\times 10^{-7}, 8 \\times 10^{-7}, 8 \\times 10^{-7}]$\n  - Prior for $\\ln R_0$: mean $\\mu_{\\ln R_0} = \\ln(0.0035)$, standard deviation $\\sigma_{\\ln R_0} = 0.2$\n  - Prior for slope: standard deviation $\\sigma_{\\text{slope}} = 2.0$\n- Case E (known $R_0$, one point has high measurement uncertainty):\n  - $f = [1.0, 0.8, 0.6, 0.4]$\n  - $R_0 = 0.002055$\n  - $R = [0.0020550, 0.0020619, 0.0020708, 0.0020834]$\n  - $\\sigma_R = [1 \\times 10^{-6}, 1 \\times 10^{-5}, 1 \\times 10^{-6}, 1 \\times 10^{-6}]$\n\nAlgorithmic requirements:\n- For cases with known $R_0$, use a weighted linear regression of $y = \\ln(R/R_0)$ on $x = \\ln f$ with zero intercept. Let the weights be $w_i = 1 / \\sigma_{y_i}^2$ where $\\sigma_{y_i} \\approx \\sigma_{R_i} / R_i$. Compute the slope $\\hat{s}$, its variance $\\operatorname{Var}(\\hat{s})$, and report $\\hat{\\alpha} = \\hat{s} + 1$ and $\\sigma_{\\alpha} = \\sqrt{\\operatorname{Var}(\\hat{s})}$.\n- For cases with unknown $R_0$, use Bayesian linear regression for $y = \\ln R$ on $x = \\ln f$ with an intercept $b = \\ln R_0$ and slope $m = \\alpha - 1$. Assume the likelihood $y_i \\sim \\mathcal{N}(m x_i + b, \\sigma_{y_i}^2)$ and independent Gaussian priors $m \\sim \\mathcal{N}(\\mu_m, \\sigma_m^2)$ and $b \\sim \\mathcal{N}(\\mu_b, \\sigma_b^2)$. Compute the posterior mean and covariance for $(m, b)$; report $\\hat{\\alpha} = \\mathbb{E}[m] + 1$ and $\\sigma_{\\alpha} = \\sqrt{\\operatorname{Var}(m)}$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain $10$ numbers: for each of the five cases in order A through E, output the estimated $\\alpha$ followed by its one-standard-deviation uncertainty, each rounded to six decimal places. For example, the format should be $[\\alpha_A,\\sigma_A,\\alpha_B,\\sigma_B,\\alpha_C,\\sigma_C,\\alpha_D,\\sigma_D,\\alpha_E,\\sigma_E]$ with all values as decimal numbers and no units (dimensionless).",
            "solution": "The user-provided problem statement has been analyzed and is deemed **valid**. It is scientifically grounded in the principles of isotope geochemistry, is well-posed with all necessary information provided, and is formulated objectively. The tasks involve a standard derivation and the application of established statistical methods (weighted least squares and Bayesian linear regression) to geochemical data. The problem is non-trivial, consistent, and verifiable.\n\n### Derivation of the Linear Relationship\n\nThe process of Rayleigh distillation describes the evolution of isotopic ratios in a system where a product is continuously and irreversibly removed from a finite reservoir. We are asked to derive a linear relationship from the fundamental principles of this model.\n\nLet $N_h$ and $N_l$ be the number of moles of a heavy and a light isotope, respectively, in the reservoir at any given time. The isotopic ratio in the reservoir is $R = N_h/N_l$. An infinitesimal amount of substance is removed from the reservoir, containing $dN_h$ and $dN_l$ moles of the heavy and light isotopes. The isotopic ratio of this instantaneous product is $R_p = dN_h/dN_l$.\n\nThe fractionation factor, $\\alpha$, is defined as the ratio of the isotopic ratio in the product to that in the reservoir:\n$$\n\\alpha = \\frac{R_p}{R}\n$$\nSubstituting the definitions of $R_p$ and $R$ gives:\n$$\n\\alpha = \\frac{dN_h/dN_l}{N_h/N_l}\n$$\nThis equation can be rearranged into a separable differential form:\n$$\n\\frac{dN_h}{N_h} = \\alpha \\frac{dN_l}{N_l}\n$$\nTo find the relationship between the initial and final states, we integrate this equation from the initial state (denoted by subscript $0$) to a later state:\n$$\n\\int_{N_{h,0}}^{N_h} \\frac{d\\tilde{N}_h}{\\tilde{N}_h} = \\alpha \\int_{N_{l,0}}^{N_l} \\frac{d\\tilde{N}_l}{\\tilde{N}_l}\n$$\nAssuming $\\alpha$ is constant over the course of the process, the integration yields:\n$$\n\\ln\\left(\\frac{N_h}{N_{h,0}}\\right) = \\alpha \\ln\\left(\\frac{N_l}{N_{l,0}}\\right)\n$$\nWe can express $N_h$ and $N_{h,0}$ in terms of the isotopic ratios $R = N_h/N_l$ and $R_0 = N_{h,0}/N_{l,0}$:\n$$\n\\ln\\left(\\frac{R N_l}{R_0 N_{l,0}}\\right) = \\alpha \\ln\\left(\\frac{N_l}{N_{l,0}}\\right)\n$$\nUsing the properties of logarithms, we separate the terms:\n$$\n\\ln\\left(\\frac{R}{R_0}\\right) + \\ln\\left(\\frac{N_l}{N_{l,0}}\\right) = \\alpha \\ln\\left(\\frac{N_l}{N_{l,0}}\\right)\n$$\nRearranging gives:\n$$\n\\ln\\left(\\frac{R}{R_0}\\right) = (\\alpha - 1) \\ln\\left(\\frac{N_l}{N_{l,0}}\\right)\n$$\nThe fraction of the original reservoir remaining, $f$, is typically approximated by the fraction of the major (light) isotope remaining, $f \\approx N_l/N_{l,0}$, especially when the heavy isotope is rare. Substituting $f$ into the equation gives the canonical Rayleigh distillation equation:\n$$\n\\ln\\left(\\frac{R}{R_0}\\right) = (\\alpha - 1) \\ln f\n$$\nThis equation provides the linear relationship required.\n\n- **When $R_0$ is known:** We can define variables $y = \\ln(R/R_0)$ and $x = \\ln f$. The model becomes $y = m x$, where the slope is $m = \\alpha - 1$. This is a linear model that passes through the origin $(0,0)$. The fractionation factor $\\alpha$ can be estimated from the slope of a linear regression forced through the origin.\n\n- **When $R_0$ is unknown or uncertain:** We cannot form the variable $y = \\ln(R/R_0)$ directly. Instead, we rearrange the Rayleigh equation as:\n$$\n\\ln R = (\\alpha - 1) \\ln f + \\ln R_0\n$$\nThis is a linear model of the form $y = m x + b$, where $y = \\ln R$, $x = \\ln f$, the slope is $m = \\alpha - 1$, and the intercept is $b = \\ln R_0$. Both $\\alpha$ and $R_0$ can be estimated from the slope and intercept of a standard linear regression.\n\n### Algorithmic Design\n\n**i. Known $R_0$: Weighted Linear Regression with Zero Intercept**\n\nWhen $R_0$ is known and has no uncertainty, we use the model $y_i = m x_i + \\epsilon_i$ where:\n- $y_i = \\ln(R_i/R_0)$\n- $x_i = \\ln f_i$\n- $m = \\alpha - 1$\n- The errors $\\epsilon_i$ are assumed to be independent and normally distributed with mean $0$ and variance $\\sigma_{y_i}^2$.\n\nThe uncertainty $\\sigma_{y_i}$ is propagated from the measurement uncertainty $\\sigma_{R_i}$ using the first-order approximation for logarithms: $\\sigma_{y_i} = \\sigma_{\\ln(R_i/R_0)} \\approx \\sigma_{R_i}/R_i$. We use weighted linear regression to account for heteroscedasticity (differing uncertainties). The weights are $w_i = 1/\\sigma_{y_i}^2$.\n\nThe best estimate for the slope, $\\hat{m}$, is the one that minimizes the weighted sum of squared residuals, $\\chi^2 = \\sum_i w_i (y_i - m x_i)^2$. The solution is:\n$$\n\\hat{m} = \\frac{\\sum_i w_i x_i y_i}{\\sum_i w_i x_i^2}\n$$\nThe variance of this estimate is:\n$$\n\\operatorname{Var}(\\hat{m}) = \\frac{1}{\\sum_i w_i x_i^2}\n$$\nFrom these, we compute the estimate for $\\alpha$ and its one-standard-deviation uncertainty $\\sigma_\\alpha$:\n$$\n\\hat{\\alpha} = \\hat{m} + 1 \\quad \\text{and} \\quad \\sigma_\\alpha = \\sqrt{\\operatorname{Var}(\\hat{m})}\n$$\nThe data point at $f=1$ corresponds to $x=\\ln(1)=0$ and $y=\\ln(R_0/R_0)=0$. This point $(0,0)$ provides no information for estimating the slope and is therefore excluded from the sums.\n\n**ii. Unknown $R_0$: Bayesian Linear Regression**\n\nWhen $R_0$ is not directly measured and is treated as a nuisance parameter with an associated prior, we use the model $y_i = m x_i + b + \\epsilon_i$, where:\n- $y_i = \\ln R_i$\n- $x_i = \\ln f_i$\n- $m = \\alpha - 1$\n- $b = \\ln R_0$\n- The errors $\\epsilon_i$ are $\\mathcal{N}(0, \\sigma_{y_i}^2)$ with $\\sigma_{y_i} \\approx \\sigma_{R_i}/R_i$.\n\nLet the parameter vector be $\\boldsymbol{\\theta} = [m, b]^T$. The model in matrix form is $\\mathbf{y} = \\mathbf{X}\\boldsymbol{\\theta} + \\boldsymbol{\\epsilon}$, where $\\mathbf{X}$ is the design matrix and $\\boldsymbol{\\epsilon} \\sim \\mathcal{N}(\\mathbf{0}, \\boldsymbol{\\Sigma}_y)$, with $\\boldsymbol{\\Sigma}_y$ being a diagonal matrix of variances $\\sigma_{y_i}^2$. The likelihood is $p(\\mathbf{y}|\\boldsymbol{\\theta}) \\propto \\exp(-\\frac{1}{2}(\\mathbf{y}-\\mathbf{X}\\boldsymbol{\\theta})^T \\boldsymbol{\\Sigma}_y^{-1} (\\mathbf{y}-\\mathbf{X}\\boldsymbol{\\theta}))$.\n\nWe assume independent Gaussian priors for the parameters:\n- Slope: $m \\sim \\mathcal{N}(\\mu_m, \\sigma_m^2)$. As specified, we take a zero-mean prior, $\\mu_m=0$, with variance $\\sigma_m^2$ given by the squared prior standard deviation.\n- Intercept: $b \\sim \\mathcal{N}(\\mu_b, \\sigma_b^2)$, where $\\mu_b=\\mu_{\\ln R_0}$ and $\\sigma_b^2=\\sigma_{\\ln R_0}^2$ are given.\n\nThe prior distribution on $\\boldsymbol{\\theta}$ is $p(\\boldsymbol{\\theta}) \\propto \\exp(-\\frac{1}{2}(\\boldsymbol{\\theta}-\\boldsymbol{\\mu}_0)^T \\boldsymbol{\\Sigma}_0^{-1} (\\boldsymbol{\\theta}-\\boldsymbol{\\mu}_0))$, where $\\boldsymbol{\\mu}_0 = [\\mu_m, \\mu_b]^T$ and $\\boldsymbol{\\Sigma}_0$ is the diagonal prior covariance matrix.\n\nThe posterior distribution for $\\boldsymbol{\\theta}$ is also Gaussian, $\\boldsymbol{\\theta} | \\mathbf{y} \\sim \\mathcal{N}(\\boldsymbol{\\mu}_N, \\boldsymbol{\\Sigma}_N)$, with posterior covariance $\\boldsymbol{\\Sigma}_N$ and mean $\\boldsymbol{\\mu}_N$ given by:\n$$\n\\boldsymbol{\\Sigma}_N = \\left(\\mathbf{X}^T \\boldsymbol{\\Sigma}_y^{-1} \\mathbf{X} + \\boldsymbol{\\Sigma}_0^{-1}\\right)^{-1}\n$$\n$$\n\\boldsymbol{\\mu}_N = \\boldsymbol{\\Sigma}_N \\left(\\mathbf{X}^T \\boldsymbol{\\Sigma}_y^{-1} \\mathbf{y} + \\boldsymbol{\\Sigma}_0^{-1} \\boldsymbol{\\mu}_0\\right)\n$$\nThe estimate for the slope $m$ is its posterior mean, $\\mathbb{E}[m] = (\\boldsymbol{\\mu}_N)_1$, and its variance is the corresponding diagonal element of the posterior covariance matrix, $\\operatorname{Var}(m) = (\\boldsymbol{\\Sigma}_N)_{11}$. The required outputs are then:\n$$\n\\hat{\\alpha} = \\mathbb{E}[m] + 1 \\quad \\text{and} \\quad \\sigma_\\alpha = \\sqrt{\\operatorname{Var}(m)}\n$$",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_known_r0(f, R, sigma_R, R0):\n    \"\"\"\n    Estimates alpha and its uncertainty for known R0 using weighted linear \n    regression through the origin.\n    \"\"\"\n    f_arr = np.array(f, dtype=float)\n    R_arr = np.array(R, dtype=float)\n    sigma_R_arr = np.array(sigma_R, dtype=float)\n    \n    # Exclude the point at f=1, as it provides no information on the slope.\n    # The model is y = m*x, so the point (0,0) is automatically satisfied.\n    mask = f_arr  1.0\n    if not np.any(mask):\n        return np.nan, np.nan # Not enough data to determine slope\n\n    # Transformed variables and uncertainties\n    x = np.log(f_arr[mask])\n    y = np.log(R_arr[mask] / R0)\n    sigma_y = sigma_R_arr[mask] / R_arr[mask]\n    \n    # Weights for WLS\n    w = 1.0 / sigma_y**2\n    \n    # Calculate slope and its variance for y = m*x\n    sum_wxy = np.sum(w * x * y)\n    sum_wx2 = np.sum(w * x**2)\n    \n    m_hat = sum_wxy / sum_wx2\n    var_m_hat = 1.0 / sum_wx2\n    \n    # Calculate alpha from the slope m = alpha - 1\n    alpha_hat = m_hat + 1.0\n    sigma_alpha = np.sqrt(var_m_hat)\n    \n    return alpha_hat, sigma_alpha\n\ndef solve_unknown_r0(f, R, sigma_R, prior_lnR0_mean, prior_lnR0_std, prior_slope_std):\n    \"\"\"\n    Estimates alpha and its uncertainty for unknown R0 using Bayesian linear regression.\n    \"\"\"\n    f_arr = np.array(f, dtype=float)\n    R_arr = np.array(R, dtype=float)\n    sigma_R_arr = np.array(sigma_R, dtype=float)\n    \n    # Transformed variables and uncertainties\n    x = np.log(f_arr)\n    y = np.log(R_arr)\n    sigma_y = sigma_R_arr / R_arr\n    \n    # Weight matrix (inverse of data covariance matrix)\n    W = np.diag(1.0 / sigma_y**2)\n    \n    # Design matrix for y = m*x + b\n    # Column 0 for slope (m), column 1 for intercept (b)\n    X = np.vstack((x, np.ones_like(x))).T\n\n    # Prior distributions\n    # Slope (m) prior: N(0, prior_slope_std^2)\n    # Intercept (b = ln R0) prior: N(prior_lnR0_mean, prior_lnR0_std^2)\n    mu_m = 0.0\n    sigma_m = prior_slope_std\n    mu_b = prior_lnR0_mean\n    sigma_b = prior_lnR0_std\n\n    mu_0 = np.array([mu_m, mu_b])\n    Sigma_0_inv = np.diag([1.0 / sigma_m**2, 1.0 / sigma_b**2])\n\n    # Posterior distribution calculation\n    Sigma_N_inv = X.T @ W @ X + Sigma_0_inv\n    Sigma_N = np.linalg.inv(Sigma_N_inv)\n    \n    mu_N = Sigma_N @ (X.T @ W @ y + Sigma_0_inv @ mu_0)\n    \n    # Extract posterior mean and variance for the slope m\n    m_hat_posterior_mean = mu_N[0]\n    m_hat_posterior_var = Sigma_N[0, 0]\n\n    # Calculate alpha from the slope m = alpha - 1\n    alpha_hat = m_hat_posterior_mean + 1.0\n    sigma_alpha = np.sqrt(m_hat_posterior_var)\n    \n    return alpha_hat, sigma_alpha\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case A (known R0)\n        {\n            \"type\": \"known_r0\",\n            \"f\": [1.0, 0.8, 0.6, 0.5, 0.35],\n            \"R0\": 0.0112372,\n            \"R\": [0.0112372, 0.0112435, 0.0112516, 0.0112567, 0.0112668],\n            \"sigma_R\": [5e-7, 5e-7, 5e-7, 5e-7, 5e-7],\n        },\n        # Case B (unknown R0)\n        {\n            \"type\": \"unknown_r0\",\n            \"f\": [1.0, 0.7, 0.5, 0.3, 0.15],\n            \"R\": [0.0020550, 0.0020631, 0.0020708, 0.0020824, 0.0020983],\n            \"sigma_R\": [2e-6, 2e-6, 2e-6, 2e-6, 2e-6],\n            \"prior_lnR0_mean\": np.log(0.0020),\n            \"prior_lnR0_std\": 0.1,\n            \"prior_slope_std\": 1.0,\n        },\n        # Case C (known R0)\n        {\n            \"type\": \"known_r0\",\n            \"f\": [1.0, 0.95, 0.9],\n            \"R0\": 0.0112372,\n            \"R\": [0.0112372, 0.0112369, 0.0112366],\n            \"sigma_R\": [3e-7, 3e-7, 3e-7],\n        },\n        # Case D (unknown R0)\n        {\n            \"type\": \"unknown_r0\",\n            \"f\": [1.0, 0.5, 0.25, 0.125, 0.0625],\n            \"R\": [0.0032000, 0.0032111, 0.0032223, 0.0032333, 0.0032444],\n            \"sigma_R\": [8e-7, 8e-7, 8e-7, 8e-7, 8e-7],\n            \"prior_lnR0_mean\": np.log(0.0035),\n            \"prior_lnR0_std\": 0.2,\n            \"prior_slope_std\": 2.0,\n        },\n        # Case E (known R0, high uncertainty point)\n        {\n            \"type\": \"known_r0\",\n            \"f\": [1.0, 0.8, 0.6, 0.4],\n            \"R0\": 0.002055,\n            \"R\": [0.0020550, 0.0020619, 0.0020708, 0.0020834],\n            \"sigma_R\": [1e-6, 1e-5, 1e-6, 1e-6],\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        if case[\"type\"] == \"known_r0\":\n            alpha, sigma = solve_known_r0(\n                case[\"f\"], case[\"R\"], case[\"sigma_R\"], case[\"R0\"]\n            )\n        elif case[\"type\"] == \"unknown_r0\":\n            alpha, sigma = solve_unknown_r0(\n                case[\"f\"], case[\"R\"], case[\"sigma_R\"], \n                case[\"prior_lnR0_mean\"], case[\"prior_lnR0_std\"], case[\"prior_slope_std\"]\n            )\n        results.extend([alpha, sigma])\n\n    # Format output to six decimal places\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "In many real-world scenarios, geochemical processes occur over a range of changing conditions, such as temperature, which causes the fractionation factor $\\alpha$ to vary. This advanced exercise moves beyond the constant-$\\alpha$ assumption, showing you how to formulate the governing differential equation for a variable fractionation factor. You will practice implementing a numerical solution to model isotopic evolution in these more complex, dynamic systems .",
            "id": "4097501",
            "problem": "A closed reservoir undergoing Rayleigh distillation loses an infinitesimal amount of a volatile component at each step under instantaneous equilibrium partitioning. Let the component possess a pair of isotopes, a heavy isotope with reservoir mole number $N_h$ and a light isotope with reservoir mole number $N_l$, and define the instantaneous reservoir isotopic ratio as $R = N_h / N_l$. Let $N = N_h + N_l$ be the total reservoir moles of the component and define the remaining fraction $f = N / N_0$, where $N_0$ is the initial total moles, so $f \\in (0,1]$. Assume the fractionation factor is temperature-dependent, denoted $\\alpha(T)$, and is defined as the equilibrium ratio of the product isotopic ratio to the reservoir isotopic ratio, i.e., $\\alpha(T) = R_{\\mathrm{product}} / R_{\\mathrm{reservoir}}$, where $R_{\\mathrm{product}}$ is the isotopic ratio of the infinitesimal amount removed at that step. The temperature varies deterministically with $f$ through a known mapping $T = T(f)$ measured in Kelvin.\n\nTask:\n- Starting from the isotopic mass balance and the definition of the fractionation factor, formulate the governing Ordinary Differential Equation (ODE) for the evolution of the reservoir isotopic ratio $R$ as a function of the remaining fraction $f$ when $\\alpha$ depends on temperature through $T = T(f)$. Explain the emergence of the logarithmic dependence on $f$ and the role of $\\alpha(T(f))$ in the ODE, without invoking any shortcut formula.\n- Outline the integration procedure to obtain $R(f)$ given $R(1) = R_0$, a specified functional form for $\\alpha(T)$, and a specified mapping $T(f)$, making clear any approximations used and the mathematical transformation of variables that leads to an integral over $f$.\n- Implement a program that numerically evaluates $R(f)$ for given parameter sets using a robust quadrature over $f$ based on the derived ODE. The program must use the following fractionation-factor model:\n  $$ \\alpha(T) = \\exp\\!\\left(\\frac{A}{T^2} + \\frac{B}{T} + C\\right), $$\n  where $A$, $B$, and $C$ are dimensionless coefficients, and $T$ is in Kelvin. Use temperature models specified as either\n  1. Linear: $$T(f) = T_{\\min} + \\left(T_{\\max} - T_{\\min}\\right) f,$$\n  2. Constant: $$T(f) = T_{\\mathrm{const}},$$\n  3. Power-law: $$T(f) = T_{\\min} + \\left(T_{\\max} - T_{\\min}\\right) f^{p}.$$\n  All temperatures must be interpreted in Kelvin, and $p$ is dimensionless. The isotopic ratio $R$ is dimensionless.\n- Assume the heavy isotope is trace relative to the light isotope so that any approximation invoking $R \\ll 1$ is physically justified in typical geochemical systems.\n\nYour program must compute $R(f_{\\mathrm{end}})$ for each of the following test cases, where $R_0$ is the initial ratio $R(1)$ and $f_{\\mathrm{end}}$ is the final remaining fraction:\n1. $R_0 = 0.002$, $f_{\\mathrm{end}} = 0.3$, linear temperature with $T_{\\min} = 280\\,\\mathrm{K}$, $T_{\\max} = 300\\,\\mathrm{K}$, and fractionation coefficients $A = 2.0$, $B = 0.5$, $C = -0.0005$.\n2. $R_0 = 0.002$, $f_{\\mathrm{end}} = 0.5$, constant temperature with $T_{\\mathrm{const}} = 298\\,\\mathrm{K}$, and fractionation coefficients $A = 0.0$, $B = 0.0$, $C = 0.002$.\n3. $R_0 = 0.0015$, $f_{\\mathrm{end}} = 0.1$, power-law temperature with $T_{\\min} = 270\\,\\mathrm{K}$, $T_{\\max} = 320\\,\\mathrm{K}$, $p = 0.5$, and fractionation coefficients $A = 1.0$, $B = -0.2$, $C = 0.0002$.\n4. $R_0 = 0.0025$, $f_{\\mathrm{end}} = 0.99$, power-law temperature with $T_{\\min} = 295\\,\\mathrm{K}$, $T_{\\max} = 300\\,\\mathrm{K}$, $p = 2.0$, and fractionation coefficients $A = 3.0$, $B = 0.0$, $C = 0.0$.\n5. $R_0 = 0.001$, $f_{\\mathrm{end}} = 0.01$, linear temperature with $T_{\\min} = 260\\,\\mathrm{K}$, $T_{\\max} = 310\\,\\mathrm{K}$, and fractionation coefficients $A = 0.5$, $B = 0.3$, $C = -0.0003$.\n\nAll outputs must be expressed as dimensionless floating-point numbers. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[r_1,r_2,r_3,r_4,r_5]$), where each $r_i$ is the computed value of $R(f_{\\mathrm{end}})$ for the $i$-th test case, in the order listed above.",
            "solution": "The problem requires the derivation and subsequent numerical solution of the governing equation for isotopic fractionation during a Rayleigh distillation process where the fractionation factor, $\\alpha$, depends on temperature, $T$, which in turn is a deterministic function of the remaining fraction of the component, $f$. The derivation proceeds from first principles of mass balance.\n\n**1. Formulation of the Governing Ordinary Differential Equation (ODE)**\n\nLet $N_h$ and $N_l$ represent the number of moles of the heavy and light isotopes, respectively, in a reservoir. The total number of moles of the component is $N = N_h + N_l$. The isotopic ratio of the reservoir is defined as $R = N_h / N_l$.\n\nIn a Rayleigh process, an infinitesimal amount of the component, $dN^{\\mathrm{prod}}$, is removed from the reservoir. This removal causes a change $dN$ in the total moles of the reservoir, where $dN = -dN^{\\mathrm{prod}}$. Since a positive amount is removed, $dN^{\\mathrm{prod}} > 0$, and thus $dN$ is a negative quantity. The changes in the moles of the heavy and light isotopes in the reservoir are $dN_h$ and $dN_l$, respectively.\n\nThe isotopic ratio of the product being removed is $R_{\\mathrm{product}} = dN_h^{\\mathrm{prod}} / dN_l^{\\mathrm{prod}}$. Mass conservation dictates that the amount of each isotope removed is equal to the negative of the change in the reservoir, so $dN_h^{\\mathrm{prod}} = -dN_h$ and $dN_l^{\\mathrm{prod}} = -dN_l$. Therefore,\n$$ R_{\\mathrm{product}} = \\frac{-dN_h}{-dN_l} = \\frac{dN_h}{dN_l} $$\nThe fractionation factor, $\\alpha$, is defined as the ratio of the product's isotopic composition to the reservoir's isotopic composition:\n$$ \\alpha = \\frac{R_{\\mathrm{product}}}{R_{\\mathrm{reservoir}}} = \\frac{dN_h/dN_l}{N_h/N_l} $$\nThis gives a direct relationship between the differential changes in the isotope abundances:\n$$ \\frac{dN_h}{dN_l} = \\alpha R $$\nfrom which it follows that $dN_h = \\alpha R dN_l$.\n\nTo find the evolution of the reservoir ratio $R$, we differentiate $R = N_h / N_l$ using the quotient rule:\n$$ dR = \\frac{N_l dN_h - N_h dN_l}{N_l^2} = \\frac{dN_h}{N_l} - \\frac{N_h}{N_l} \\frac{dN_l}{N_l} = \\frac{dN_h}{N_l} - R \\frac{dN_l}{N_l} $$\nSubstituting $dN_h = \\alpha R dN_l$ into this expression yields:\n$$ dR = \\frac{\\alpha R dN_l}{N_l} - R \\frac{dN_l}{N_l} = (\\alpha - 1) R \\frac{dN_l}{N_l} $$\nThis equation relates the change in the reservoir's isotopic ratio to the fractional change in the abundance of the light isotope. To express this in terms of the total moles, $N$, we use the problem's stated approximation that the heavy isotope is a trace component, i.e., $N_h \\ll N_l$. This implies that the total moles $N = N_h + N_l \\approx N_l$, and consequently, the differential change $dN \\approx dN_l$. Under this standard and physically justified approximation, the equation becomes:\n$$ \\frac{dR}{R} = (\\alpha - 1) \\frac{dN}{N} $$\nThis is a seminal equation in isotope geochemistry. The final step is to change the independent variable from the total moles $N$ to the remaining fraction $f$. The fraction $f$ is defined as $f = N/N_0$, where $N_0$ is the initial total moles at the start of the process ($f=1$). Differentiating this definition gives $df = dN/N_0$, or $dN = N_0 df$. Substituting this and $N = N_0 f$ into the expression for $dN/N$:\n$$ \\frac{dN}{N} = \\frac{N_0 df}{N_0 f} = \\frac{df}{f} $$\nThis substitution directly yields the governing ODE for $R$ as a function of $f$:\n$$ \\frac{dR}{R} = (\\alpha - 1) \\frac{df}{f} \\quad \\implies \\quad \\frac{dR}{df} = \\frac{R}{f}(\\alpha - 1) $$\nThe problem specifies that the fractionation factor $\\alpha$ is a function of temperature $T$, which itself is a function of the remaining fraction $f$, i.e., $\\alpha = \\alpha(T(f))$. The final form of the ODE is therefore:\n$$ \\frac{dR}{df} = \\frac{R}{f}(\\alpha(T(f)) - 1) $$\nThe emergence of the logarithmic dependence on $f$ is a direct consequence of the term $df/f$. Upon integration, this term will yield a natural logarithm, $\\ln(f)$. The role of $\\alpha(T(f))$ is to act as a variable coefficient in this first-order linear ODE. Unlike the simple case where $\\alpha$ is constant, here the extent of fractionation changes as the process evolves, dictated by the prescribed temperature path $T(f)$.\n\n**2. Integration Procedure**\n\nThe derived ODE is separable. We can rearrange the terms to group variables $R$ and $f$ on opposite sides of the equation:\n$$ \\frac{dR}{R} = \\frac{\\alpha(T(f)) - 1}{f} df $$\nTo find the isotopic ratio $R(f_{\\mathrm{end}})$ at a final fraction $f_{\\mathrm{end}}$, we integrate both sides from the initial state (at $f=1$, the ratio is $R_0$) to the final state (at $f=f_{\\mathrm{end}}$, the ratio is $R(f_{\\mathrm{end}})$). We use a dummy variable of integration, $f'$, to avoid confusion with the limit of integration.\n$$ \\int_{R_0}^{R(f_{\\mathrm{end}})} \\frac{dR}{R} = \\int_{1}^{f_{\\mathrm{end}}} \\frac{\\alpha(T(f')) - 1}{f'} df' $$\nThe left-hand side integrates to:\n$$ \\int_{R_0}^{R(f_{\\mathrm{end}})} \\frac{dR}{R} = \\left[ \\ln R \\right]_{R_0}^{R(f_{\\mathrm{end}})} = \\ln(R(f_{\\mathrm{end}})) - \\ln(R_0) = \\ln\\left(\\frac{R(f_{\\mathrm{end}})}{R_0}\\right) $$\nEquating this with the right-hand side gives:\n$$ \\ln\\left(\\frac{R(f_{\\mathrm{end}})}{R_0}\\right) = \\int_{1}^{f_{\\mathrm{end}}} \\frac{\\alpha(T(f')) - 1}{f'} df' $$\nExponentiating both sides yields the solution for $R(f_{\\mathrm{end}})$:\n$$ R(f_{\\mathrm{end}}) = R_0 \\exp\\left( \\int_{1}^{f_{\\mathrm{end}}} \\frac{\\alpha(T(f')) - 1}{f'} df' \\right) $$\nThe only approximation invoked in this derivation is $R \\ll 1$. The transformation of variables from $N$ to $f$ introduces the factor $1/f'$ inside the integral. For a general functional form of $\\alpha(T(f))$, the integral does not have a simple analytical solution. Therefore, it must be evaluated numerically. The procedure involves:\n1.  Defining the integrand function, $g(f') = (\\alpha(T(f')) - 1) / f'$.\n2.  Using a robust numerical quadrature method (such as that provided by `scipy.integrate.quad` in Python) to compute the definite integral $I = \\int_{1}^{f_{\\mathrm{end}}} g(f') df'$.\n3.  Calculating the final isotopic ratio as $R(f_{\\mathrm{end}}) = R_0 \\exp(I)$.\n\n**3. Numerical Evaluation**\n\nThe program will implement this integration procedure. For each test case, it will define the specific parameters for the $\\alpha(T)$ and $T(f)$ models. An integrand function will be constructed to compute $(\\alpha(T(f)) - 1)/f$ for a given $f$. This function will be passed to a numerical quadrature routine from the SciPy library to evaluate the integral over the interval $[1, f_{\\mathrm{end}}]$. The final ratio $R(f_{\\mathrm{end}})$ is then calculated by multiplying the initial ratio $R_0$ by the exponential of the integral's value.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Solves for the final isotopic ratio in a Rayleigh distillation model with\n    temperature-dependent fractionation.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"R0\": 0.002, \"f_end\": 0.3, \"model\": \"linear\",\n            \"T_params\": {\"Tmin\": 280.0, \"Tmax\": 300.0},\n            \"alpha_params\": {\"A\": 2.0, \"B\": 0.5, \"C\": -0.0005}\n        },\n        {\n            \"R0\": 0.002, \"f_end\": 0.5, \"model\": \"constant\",\n            \"T_params\": {\"Tconst\": 298.0},\n            \"alpha_params\": {\"A\": 0.0, \"B\": 0.0, \"C\": 0.002}\n        },\n        {\n            \"R0\": 0.0015, \"f_end\": 0.1, \"model\": \"power\",\n            \"T_params\": {\"Tmin\": 270.0, \"Tmax\": 320.0, \"p\": 0.5},\n            \"alpha_params\": {\"A\": 1.0, \"B\": -0.2, \"C\": 0.0002}\n        },\n        {\n            \"R0\": 0.0025, \"f_end\": 0.99, \"model\": \"power\",\n            \"T_params\": {\"Tmin\": 295.0, \"Tmax\": 300.0, \"p\": 2.0},\n            \"alpha_params\": {\"A\": 3.0, \"B\": 0.0, \"C\": 0.0}\n        },\n        {\n            \"R0\": 0.001, \"f_end\": 0.01, \"model\": \"linear\",\n            \"T_params\": {\"Tmin\": 260.0, \"Tmax\": 310.0},\n            \"alpha_params\": {\"A\": 0.5, \"B\": 0.3, \"C\": -0.0003}\n        }\n    ]\n\n    # --- Helper functions for physical models ---\n\n    def alpha_model(T, A, B, C):\n        \"\"\"Calculates the fractionation factor alpha(T).\"\"\"\n        return np.exp(A / T**2 + B / T + C)\n\n    def T_linear(f, Tmin, Tmax):\n        \"\"\"Linear temperature model T(f).\"\"\"\n        return Tmin + (Tmax - Tmin) * f\n\n    def T_constant(f, Tconst):\n        \"\"\"Constant temperature model T(f).\"\"\"\n        # f is unused but kept for consistent function signature.\n        return Tconst\n\n    def T_power(f, Tmin, Tmax, p):\n        \"\"\"Power-law temperature model T(f).\"\"\"\n        return Tmin + (Tmax - Tmin) * f**p\n\n    # Map model names to temperature functions\n    T_models = {\n        \"linear\": T_linear,\n        \"constant\": T_constant,\n        \"power\": T_power\n    }\n\n    def integrand(f_prime, case_params):\n        \"\"\"\n        Calculates the value of the integrand for the Rayleigh equation:\n        (alpha(T(f')) - 1) / f'\n        \n        Args:\n            f_prime (float): The remaining fraction (variable of integration).\n            case_params (dict): A dictionary containing all parameters for the case.\n        \"\"\"\n        # Unpack parameters\n        model_type = case_params[\"model\"]\n        T_params = case_params[\"T_params\"]\n        alpha_params = case_params[\"alpha_params\"]\n\n        # Calculate temperature T(f')\n        T_func = T_models[model_type]\n        # The ** operator unpacks the dictionary into keyword arguments\n        T = T_func(f_prime, **T_params)\n\n        # Calculate fractionation factor alpha(T)\n        alpha = alpha_model(T, **alpha_params)\n\n        # Return the integrand value\n        # A small epsilon is added to f_prime to avoid division by zero if f_prime=0,\n        # though integration limits should prevent this.\n        return (alpha - 1.0) / (f_prime + 1e-15)\n\n    results = []\n    for case in test_cases:\n        # Perform the numerical integration\n        # The integral is from f=1 to f=f_end\n        integral_value, _ = quad(\n            integrand, \n            1.0, \n            case[\"f_end\"], \n            args=(case,)\n        )\n\n        # Calculate the final isotopic ratio R(f_end)\n        R_f_end = case[\"R0\"] * np.exp(integral_value)\n        results.append(R_f_end)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}