{
    "hands_on_practices": [
        {
            "introduction": "团簇同位素研究的核心是量化重同位素在分子内“聚集”或“成团”的趋势，而非随机分布。为了描述这种偏离，我们需要一个明确的基准，即随机参考系。本练习  将指导您从概率论和组合学的基本原理出发，推导出最常用的团簇同位素丰度指标 $\\Delta_{47}$ 的定义，从而为理解和量化同位素团簇效应奠定坚实的数学基础。",
            "id": "4088417",
            "problem": "考虑一个封闭储库中的二氧化碳 (CO$_2$)，其中同位素替换非常罕见，因此分子可以被视为不同的同位素体。设碳库中 $^{13}\\mathrm{C}$ 的原子丰度为 $p_{13}$，因此 $^{12}\\mathrm{C}$ 的原子丰度为 $p_{12} = 1 - p_{13}$。对于氧，设 $^{16}\\mathrm{O}$、$^{17}\\mathrm{O}$ 和 $^{18}\\mathrm{O}$ 的原子丰度分别为 $p_{16}$、$p_{17}$ 和 $p_{18}$，且满足 $p_{16} + p_{17} + p_{18} = 1$。在随机参考系中，不同原子位点上的同位素替换是相互独立的，一个同位素体的概率由相应原子丰度的乘积乘以因 CO$_2$ 中不可区分的氧原子位置而产生的任何组合多重性给出。我们忽略 $^{14}\\mathrm{C}$ 以及任何比 $^{18}\\mathrm{O}$ 更重的同位素。\n\n将 CO$_2$ 的质量数为 47 的同位素体定义为总质量数为 47 的那些分子，即 $^{13}\\mathrm{C}^{16}\\mathrm{O}^{18}\\mathrm{O}$、$^{12}\\mathrm{C}^{17}\\mathrm{O}^{18}\\mathrm{O}$ 和 $^{13}\\mathrm{C}^{17}\\mathrm{O}^{17}\\mathrm{O}$。将质量数为 44 的同位素体定义为 $^{12}\\mathrm{C}^{16}\\mathrm{O}^{16}\\mathrm{O}$。\n\n质量数 47 的团簇同位素超额，记为 $\\Delta_{47}$，其操作性定义是通过将测量的 47/44 比值与其随机对应值进行比较：如果 $R_{47}^{\\mathrm{meas}}$ 和 $R_{47}^{*}$ 分别表示测量的和随机的 47/44 比值，那么\n$$\n\\Delta_{47} = 1000 \\times \\left( \\frac{R_{47}^{\\mathrm{meas}}}{R_{47}^{*}} - 1 \\right),\n$$\n其中因子 1000 将无量纲偏差转换为千分率 (per mil)。假设团簇仅扰动同一分子中 $^{13}\\mathrm{C}$ 和 $^{18}\\mathrm{O}$ 的同时出现，使得 $^{13}\\mathrm{C}^{16}\\mathrm{O}^{18}\\mathrm{O}$ 同位素体的测量概率相对于其随机值乘以一个因子 $\\left(1 + \\epsilon\\right)$，而 $^{12}\\mathrm{C}^{17}\\mathrm{O}^{18}\\mathrm{O}$ 和 $^{13}\\mathrm{C}^{17}\\mathrm{O}^{17}\\mathrm{O}$ 的测量概率等于其随机值。进一步假设这种扰动在一阶近似下保持了总体原子丰度，因此 $^{12}\\mathrm{C}^{16}\\mathrm{O}^{16}\\mathrm{O}$ 的测量概率等于其随机值。\n\n从随机参考系的独立性假设和上述 $\\Delta_{47}$ 的操作性定义出发，推导出用 $\\epsilon$、$p_{12}$、$p_{13}$、$p_{16}$、$p_{17}$ 和 $p_{18}$ 表示的 $\\Delta_{47}$ 的通用表达式，然后对以下数值进行计算：\n$$\np_{13} = 0.011070,\\quad p_{17} = 0.000380,\\quad p_{18} = 0.002050,\\quad \\epsilon = 0.004.\n$$\n将 $\\Delta_{47}$ 的最终数值结果以千分率表示，并将答案四舍五入到四位有效数字。只给出你最终的数值答案。",
            "solution": "该问题具有科学依据、提法明确、客观，并包含得出唯一解所需的所有信息。这是一个同位素地球化学中的标准问题，需要应用概率论和组合原理。因此，该问题被认为是有效的。\n\n推导过程分两个阶段：首先，推导 $\\Delta_{47}$ 的通用表达式；其次，对其进行数值计算。\n\n**1. $\\Delta_{47}$ 的通用表达式**\n\n设 $P(\\cdot)$ 表示一个同位素体的概率或丰度分数。随机参考系假设，形成一个给定同位素体的概率是其组成同位素的原子丰度的乘积，再乘以一个考虑等效原子位置的组合因子。在 $\\mathrm{CO}_2$ 中，两个氧的位置在结构上是等效的。\n\n相关同位素体的随机概率（$P^{*}$）如下：\n- 质量数为 44 的参考同位素体是 $^{12}\\mathrm{C}^{16}\\mathrm{O}^{16}\\mathrm{O}$。它包含两个相同的氧同位素。组合多重性为 $1$。\n$$ P^{*}(^{12}\\mathrm{C}^{16}\\mathrm{O}^{16}\\mathrm{O}) = p_{12} (p_{16})^2 $$\n- 质量数为 47 的同位素体有：\n  - $^{13}\\mathrm{C}^{16}\\mathrm{O}^{18}\\mathrm{O}$：它包含两种不同的氧同位素（$^{16}\\mathrm{O}$ 和 $^{18}\\mathrm{O}$）。组合多重性为 $2$，因为这些同位素可以占据两个氧位点中的任意一个。\n  $$ P^{*}(^{13}\\mathrm{C}^{16}\\mathrm{O}^{18}\\mathrm{O}) = 2 p_{13} p_{16} p_{18} $$\n  - $^{12}\\mathrm{C}^{17}\\mathrm{O}^{18}\\mathrm{O}$：它也包含两种不同的氧同位素（$^{17}\\mathrm{O}$ 和 $^{18}\\mathrm{O}$）。多重性为 $2$。\n  $$ P^{*}(^{12}\\mathrm{C}^{17}\\mathrm{O}^{18}\\mathrm{O}) = 2 p_{12} p_{17} p_{18} $$\n  - $^{13}\\mathrm{C}^{17}\\mathrm{O}^{17}\\mathrm{O}$：它包含两个相同的氧同位素（$^{17}\\mathrm{O}$）。多重性为 $1$。\n  $$ P^{*}(^{13}\\mathrm{C}^{17}\\mathrm{O}^{17}\\mathrm{O}) = p_{13} (p_{17})^2 $$\n\n质量数 47 的同位素体的总随机概率 $P^{*}_{47}$ 是各个概率之和：\n$$ P^{*}_{47} = P^{*}(^{13}\\mathrm{C}^{16}\\mathrm{O}^{18}\\mathrm{O}) + P^{*}(^{12}\\mathrm{C}^{17}\\mathrm{O}^{18}\\mathrm{O}) + P^{*}(^{13}\\mathrm{C}^{17}\\mathrm{O}^{17}\\mathrm{O}) $$\n$$ P^{*}_{47} = 2 p_{13} p_{16} p_{18} + 2 p_{12} p_{17} p_{18} + p_{13} (p_{17})^2 $$\n\n质量数 47 与质量数 44 的分子种类的随机比值 $R_{47}^{*}$ 为：\n$$ R_{47}^{*} = \\frac{P^{*}_{47}}{P^{*}(^{12}\\mathrm{C}^{16}\\mathrm{O}^{16}\\mathrm{O})} = \\frac{2 p_{13} p_{16} p_{18} + 2 p_{12} p_{17} p_{18} + p_{13} (p_{17})^2}{p_{12} (p_{16})^2} $$\n\n接下来，我们引入由团簇效应引起的扰动，以求得测量概率（$P^{\\mathrm{meas}}$）。根据题目陈述：\n- $P^{\\mathrm{meas}}(^{13}\\mathrm{C}^{16}\\mathrm{O}^{18}\\mathrm{O}) = (1+\\epsilon) P^{*}(^{13}\\mathrm{C}^{16}\\mathrm{O}^{18}\\mathrm{O}) = 2(1+\\epsilon) p_{13} p_{16} p_{18}$\n- $P^{\\mathrm{meas}}(^{12}\\mathrm{C}^{17}\\mathrm{O}^{18}\\mathrm{O}) = P^{*}(^{12}\\mathrm{C}^{17}\\mathrm{O}^{18}\\mathrm{O}) = 2 p_{12} p_{17} p_{18}$\n- $P^{\\mathrm{meas}}(^{13}\\mathrm{C}^{17}\\mathrm{O}^{17}\\mathrm{O}) = P^{*}(^{13}\\mathrm{C}^{17}\\mathrm{O}^{17}\\mathrm{O}) = p_{13} (p_{17})^2$\n- $P^{\\mathrm{meas}}(^{12}\\mathrm{C}^{16}\\mathrm{O}^{16}\\mathrm{O}) = P^{*}(^{12}\\mathrm{C}^{16}\\mathrm{O}^{16}\\mathrm{O}) = p_{12} (p_{16})^2$\n\n质量数 47 的同位素体的总测量概率 $P^{\\mathrm{meas}}_{47}$ 是：\n$$ P^{\\mathrm{meas}}_{47} = P^{\\mathrm{meas}}(^{13}\\mathrm{C}^{16}\\mathrm{O}^{18}\\mathrm{O}) + P^{\\mathrm{meas}}(^{12}\\mathrm{C}^{17}\\mathrm{O}^{18}\\mathrm{O}) + P^{\\mathrm{meas}}(^{13}\\mathrm{C}^{17}\\mathrm{O}^{17}\\mathrm{O}) $$\n$$ P^{\\mathrm{meas}}_{47} = 2(1+\\epsilon) p_{13} p_{16} p_{18} + 2 p_{12} p_{17} p_{18} + p_{13} (p_{17})^2 $$\n展开此表达式：\n$$ P^{\\mathrm{meas}}_{47} = (2 p_{13} p_{16} p_{18} + 2 p_{12} p_{17} p_{18} + p_{13} (p_{17})^2) + 2\\epsilon p_{13} p_{16} p_{18} $$\n将括号中的项识别为 $P^{*}_{47}$，我们得到：\n$$ P^{\\mathrm{meas}}_{47} = P^{*}_{47} + 2\\epsilon p_{13} p_{16} p_{18} $$\n测量比值 $R_{47}^{\\mathrm{meas}}$ 为：\n$$ R_{47}^{\\mathrm{meas}} = \\frac{P^{\\mathrm{meas}}_{47}}{P^{\\mathrm{meas}}(^{12}\\mathrm{C}^{16}\\mathrm{O}^{16}\\mathrm{O})} = \\frac{P^{*}_{47} + 2\\epsilon p_{13} p_{16} p_{18}}{p_{12} (p_{16})^2} $$\n\n现在，我们将 $R_{47}^{\\mathrm{meas}}$ 和 $R_{47}^{*}$ 的表达式代入 $\\Delta_{47}$ 的定义中：\n$$ \\Delta_{47} = 1000 \\times \\left( \\frac{R_{47}^{\\mathrm{meas}}}{R_{47}^{*}} - 1 \\right) $$\n比值的比值为：\n$$ \\frac{R_{47}^{\\mathrm{meas}}}{R_{47}^{*}} = \\frac{\\frac{P^{*}_{47} + 2\\epsilon p_{13} p_{16} p_{18}}{p_{12} (p_{16})^2}}{\\frac{P^{*}_{47}}{p_{12} (p_{16})^2}} = \\frac{P^{*}_{47} + 2\\epsilon p_{13} p_{16} p_{18}}{P^{*}_{47}} = 1 + \\frac{2\\epsilon p_{13} p_{16} p_{18}}{P^{*}_{47}} $$\n将此代回 $\\Delta_{47}$ 方程：\n$$ \\Delta_{47} = 1000 \\times \\left( \\left(1 + \\frac{2\\epsilon p_{13} p_{16} p_{18}}{P^{*}_{47}}\\right) - 1 \\right) = 1000 \\times \\frac{2\\epsilon p_{13} p_{16} p_{18}}{P^{*}_{47}} $$\n用 $P^{*}_{47}$ 的完整表达式替换，得到通用公式：\n$$ \\Delta_{47} = 1000 \\times \\left( \\frac{2 \\epsilon p_{13} p_{16} p_{18}}{2 p_{13} p_{16} p_{18} + 2 p_{12} p_{17} p_{18} + p_{13} (p_{17})^2} \\right) $$\n\n**2. 数值计算**\n\n给定的原子丰度为：\n$ p_{13} = 0.011070 $\n$ p_{17} = 0.000380 $\n$ p_{18} = 0.002050 $\n扰动因子为 $\\epsilon = 0.004$。\n\n由此，我们推导出最丰富的同位素的丰度：\n$ p_{12} = 1 - p_{13} = 1 - 0.011070 = 0.988930 $\n$ p_{16} = 1 - p_{17} - p_{18} = 1 - 0.000380 - 0.002050 = 0.997570 $\n\n现在我们计算质量数 47 的总随机丰度的各个组分：\n- $^{13}\\mathrm{C}^{16}\\mathrm{O}^{18}\\mathrm{O}$ 的随机丰度：\n$ 2 p_{13} p_{16} p_{18} = 2 \\times 0.011070 \\times 0.997570 \\times 0.002050 \\approx 4.529845 \\times 10^{-5} $\n- $^{12}\\mathrm{C}^{17}\\mathrm{O}^{18}\\mathrm{O}$ 的随机丰度：\n$ 2 p_{12} p_{17} p_{18} = 2 \\times 0.988930 \\times 0.000380 \\times 0.002050 \\approx 1.540753 \\times 10^{-6} $\n- $^{13}\\mathrm{C}^{17}\\mathrm{O}^{17}\\mathrm{O}$ 的随机丰度：\n$ p_{13} (p_{17})^2 = 0.011070 \\times (0.000380)^2 \\approx 1.598428 \\times 10^{-9} $\n\n质量数 47 的总随机丰度 $P^{*}_{47}$ 是其总和：\n$ P^{*}_{47} \\approx 4.529845 \\times 10^{-5} + 1.540753 \\times 10^{-6} + 1.598428 \\times 10^{-9} \\approx 4.684080 \\times 10^{-5} $\n\n$\\Delta_{47}$ 表达式中分数的分子是：\n$ 2 \\epsilon p_{13} p_{16} p_{18} = 0.004 \\times (2 p_{13} p_{16} p_{18}) \\approx 0.004 \\times 4.529845 \\times 10^{-5} \\approx 1.811938 \\times 10^{-7} $\n\n最后，我们计算 $\\Delta_{47}$：\n$$ \\Delta_{47} = 1000 \\times \\frac{1.811938 \\times 10^{-7}}{4.684080 \\times 10^{-5}} \\approx 1000 \\times 0.00386829 \\approx 3.86829 $$\n按要求四舍五入到四位有效数字，得到 $3.868$。",
            "answer": "$$\\boxed{3.868}$$"
        },
        {
            "introduction": "理解了如何定义团簇同位素异常后，下一个关键问题是：这种非随机分布的物理根源是什么？答案在于量子力学，特别是分子振动的零点能差异。本练习  将带领您从第一性原理出发，使用谐振子模型将宏观的平衡常数与微观的分子属性（如约化质量和振动频率）联系起来，从而揭示团簇效应的本质。此外，本练习还将引入蒙特卡洛模拟等重要的计算方法，用于评估模型中的不确定性传播，这是现代计算地球化学研究的一项核心技能。",
            "id": "4088412",
            "problem": "您的任务是为二氧化碳中的团簇同位素平衡建立一个计算模型，该模型需量化将两个重同位素（$^{13}\\mathrm{C}$ 和 $^{18}\\mathrm{O}$）置于同一分子中，相对于将它们分布在不同分子中的热力学偏好。建模必须从植根于正则系综和分子振动的谐振子描述的第一性原理出发，不得援引此处指定的基本定律之外的任何简化公式。\n\n假设每个二氧化碳分子可以表示为两个独立的碳-氧键，每个键的行为都像一个量子谐振子。正则系综规定，反应的平衡常数由产物与反应物的配分函数之比决定，而谐振子的能级由 $E_n = h \\nu (n + 1/2)$ 给出，其中 $h$ 是普朗克常数，$\\nu$ 是振动频率， $n$ 是量子数。在仅零点能差异相对于更高振动激发而言是显著的温度下，平衡常数可以纯粹根据零点能差异来近似。\n\n考虑在两个分子之间重新分布重同位素的交换反应：\n$^{13}\\mathrm{C}^{18}\\mathrm{O}^{16}\\mathrm{O} + {}^{12}\\mathrm{C}^{16}\\mathrm{O}^{16}\\mathrm{O} \\leftrightarrow {}^{13}\\mathrm{C}^{16}\\mathrm{O}^{16}\\mathrm{O} + {}^{12}\\mathrm{C}^{18}\\mathrm{O}^{16}\\mathrm{O}$。\n等式左侧代表“团簇”构型（两个重同位素在一个分子中），而右侧代表“随机”分布（重同位素分布在不同分子中）。此处的团簇指数定义为从左到右进行的反应的平衡常数的自然对数，记为 $X = \\ln K$，该值为无量纲。\n\n使用振动频率对约化质量的谐振子依赖关系。对于单个碳-氧键，振动频率与 $\\nu \\propto \\sqrt{k / \\mu}$ 成比例，其中 $k$ 是有效力常数，$\\mu$ 是由 $\\mu = \\frac{m_{\\mathrm{C}} m_{\\mathrm{O}}}{m_{\\mathrm{C}} + m_{\\mathrm{O}}}$ 定义的原子对的约化质量。假设 ${}^{12}\\mathrm{C}$–${}^{16}\\mathrm{O}$ 的基准轻-轻键频率为 $\\nu_0$（单位为 $\\mathrm{cm}^{-1}$）。对于任何同位素取代，键频率为 $\\nu = \\nu_0 \\sqrt{\\mu_0 / \\mu}$，其中 $\\mu_0$ 是 ${}^{12}\\mathrm{C}$–${}^{16}\\mathrm{O}$ 的约化质量。\n\n使用以下物理常数和原子质量：\n- 普朗克常数 $h = 6.62607015 \\times 10^{-34} \\ \\mathrm{J \\cdot s}$，\n- 光速 $c = 2.99792458 \\times 10^{8} \\ \\mathrm{m/s}$，\n- 玻尔兹曼常数 $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23} \\ \\mathrm{J/K}$，\n- 一个原子质量单位 $u = 1.66053906660 \\times 10^{-27} \\ \\mathrm{kg}$。\n使用的原子质量：\n- ${}^{12}\\mathrm{C}$: $12.000000 \\ u$，\n- ${}^{13}\\mathrm{C}$: $13.003355 \\ u$，\n- ${}^{16}\\mathrm{O}$: $15.994915 \\ u$，\n- ${}^{18}\\mathrm{O}$: $17.999160 \\ u$。\n\n建模要求：\n1.  根据正则系综和谐振子基本原理，推导 $X = \\ln K$ 关于反应物和产物之间零点能差异的表达式。使用相对于 $\\nu_0$ 和 $\\mu_0$ 的约化质量标度关系来表示同位素体的键频率。\n2.  使用蒙特卡罗方法实现不确定性传播。将 $\\nu_0$ 和 $T$ 视为具有指定均值和标准差的独立正态分布变量。对于每次蒙特卡罗抽样，使用模型计算 $X$，并用其均值和标准差总结 $X$ 的分布。\n3.  实现灵敏度分析。计算在每个测试用例的 $\\nu_0$ 和 $T$ 的均值处评估的偏导数 $\\frac{\\partial X}{\\partial \\nu_0}$ 和 $\\frac{\\partial X}{\\partial T}$。在适用的情况下以弧度表示角度；此处没有角度。将所有最终报告值表示为无量纲浮点数。\n\n单位和转换：\n- 使用 $\\nu$（单位为 $\\mathrm{cm}^{-1}$）进行输入和标度频率的计算，但通过 $E = h c \\tilde{\\nu}$（其中 $\\tilde{\\nu}$ 的单位为 $\\mathrm{m}^{-1}$）将其转换为能量。因此，在与 $h$ 和 $c$ 结合使用时，需要乘以 $100$ 将 $\\mathrm{cm}^{-1}$ 转换为 $\\mathrm{m}^{-1}$。\n- 温度 $T$ 的单位是 $\\mathrm{K}$。\n- 原子质量在计算约化质量比率时可以使用原子质量单位，因为单位会抵消，但为完整起见，提供了到 $\\mathrm{kg}$ 的转换因子。\n\n测试套件：\n对于每个测试用例，给定 $(T_{\\mathrm{mean}}, \\sigma_T, \\nu_{0,\\mathrm{mean}}, \\sigma_{\\nu_0}, N)$，其中 $N$ 是蒙特卡罗样本数。对于每个案例，按顺序计算并报告：$X$ 的蒙特卡罗均值，$X$ 的蒙特卡罗标准差，在 $(T_{\\mathrm{mean}}, \\nu_{0,\\mathrm{mean}})$ 处的灵敏度 $\\frac{\\partial X}{\\partial \\nu_0}$，以及在 $(T_{\\mathrm{mean}}, \\nu_{0,\\mathrm{mean}})$ 处的灵敏度 $\\frac{\\partial X}{\\partial T}$。所有输出均为无量纲浮点数。\n\n使用以下四个测试用例：\n- 案例 $1$：$(T_{\\mathrm{mean}} = 298, \\ \\sigma_T = 1, \\ \\nu_{0,\\mathrm{mean}} = 1400, \\ \\sigma_{\\nu_0} = 3, \\ N = 50000)$，\n- 案例 $2$：$(T_{\\mathrm{mean}} = 200, \\ \\sigma_T = 0.5, \\ \\nu_{0,\\mathrm{mean}} = 1400, \\ \\sigma_{\\nu_0} = 3, \\ N = 50000)$，\n- 案例 $3$：$(T_{\\mathrm{mean}} = 1000, \\ \\sigma_T = 5, \\ \\nu_{0,\\mathrm{mean}} = 1400, \\ \\sigma_{\\nu_0} = 5, \\ N = 50000)$，\n- 案例 $4$：$(T_{\\mathrm{mean}} = 298, \\ \\sigma_T = 0, \\ \\nu_{0,\\mathrm{mean}} = 1400, \\ \\sigma_{\\nu_0} = 0, \\ N = 1)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含按顺序汇总的四个测试用例的所有结果，形式为方括号内以逗号分隔的列表。具体来说，最终输出必须是\n$[x_1, s_1, a_1, b_1, x_2, s_2, a_2, b_2, x_3, s_3, a_3, b_3, x_4, s_4, a_4, b_4]$,\n其中 $x_i$ 是案例 $i$ 的 $X$ 的蒙特卡罗均值，$s_i$ 是案例 $i$ 的 $X$ 的蒙特卡罗标准差，$a_i$ 是案例 $i$ 的 $\\frac{\\partial X}{\\partial \\nu_0}$，$b_i$ 是案例 $i$ 的 $\\frac{\\partial X}{\\partial T}$。所有条目都是无量纲浮点数，不附带单位。",
            "solution": "该问题要求基于统计力学和量子力学的第一性原理，为二氧化碳中的团簇同位素平衡构建一个计算模型。我们必须为指定的同位素交换反应推导团簇指数 $X = \\ln{K}$ 的表达式，实施不确定性和灵敏度分析，并将该模型应用于一系列测试用例。\n\n### 步骤1：理论推导\n\n指定的同位素交换反应是：\n$$\n^{13}\\mathrm{C}^{18}\\mathrm{O}^{16}\\mathrm{O} + {}^{12}\\mathrm{C}^{16}\\mathrm{O}^{16}\\mathrm{O} \\leftrightarrow {}^{13}\\mathrm{C}^{16}\\mathrm{O}^{16}\\mathrm{O} + {}^{12}\\mathrm{C}^{18}\\mathrm{O}^{16}\\mathrm{O}\n$$\n我们将这些分子种类表示为：\n- $A = {}^{13}\\mathrm{C}^{18}\\mathrm{O}^{16}\\mathrm{O}$ (团簇反应物)\n- $B = {}^{12}\\mathrm{C}^{16}\\mathrm{O}^{16}\\mathrm{O}$ (轻同位素反应物)\n- $C = {}^{13}\\mathrm{C}^{16}\\mathrm{O}^{16}\\mathrm{O}$ (单取代产物)\n- $D = {}^{12}\\mathrm{C}^{18}\\mathrm{O}^{16}\\mathrm{O}$ (单取代产物)\n\n反应为 $A + B \\leftrightarrow C + D$。根据正则系综原理，平衡常数 $K$ 由产物与反应物的配分函数之比给出：\n$$\nK = \\frac{Q_C Q_D}{Q_A Q_B}\n$$\n问题指出，我们可以仅使用零点能（ZPE）的差异来近似平衡常数。这是同位素地球化学中一种常见的简化方法，称为 Bigeleisen-Mayer 近似，它在 $k_B T$ 相对于第一振动激发态能量较小的温度下有效。在此近似中，假定平动和转动态的配分函数贡献相互抵消，而振动配分函数 $q_{vib} = \\frac{e^{-E_{ZPE}/(k_B T)}}{1 - e^{-h\\nu/(k_B T)}}$ 由其首项 $e^{-E_{ZPE}/(k_B T)}$ 近似。于是，平衡常数变为：\n$$\nK \\approx \\frac{e^{-E_{ZPE,C}/(k_B T)} e^{-E_{ZPE,D}/(k_B T)}}{e^{-E_{ZPE,A}/(k_B T)} e^{-E_{ZPE,B}/(k_B T)}} = e^{-\\frac{(E_{ZPE,C} + E_{ZPE,D}) - (E_{ZPE,A} + E_{ZPE,B})}{k_B T}}\n$$\n取自然对数，我们得到团簇指数 $X$：\n$$\nX = \\ln{K} = -\\frac{\\Delta E_{ZPE}}{k_B T}\n$$\n其中 $\\Delta E_{ZPE} = (E_{ZPE,C} + E_{ZPE,D}) - (E_{ZPE,A} + E_{ZPE,B})$。\n\n该模型将每个 $\\mathrm{CO}_2$ 分子视为两个独立的谐振子，对应于两个 C-O 键。单个谐振子的零点能为 $\\frac{1}{2}h\\nu$。每个分子的零点能是其两个键的零点能之和：\n- $E_{ZPE,A} = \\frac{1}{2}h(\\nu_{13C-18O} + \\nu_{13C-16O})$\n- $E_{ZPE,B} = \\frac{1}{2}h(\\nu_{12C-16O} + \\nu_{12C-16O}) = h\\nu_{12C-16O}$\n- $E_{ZPE,C} = \\frac{1}{2}h(\\nu_{13C-16O} + \\nu_{13C-16O}) = h\\nu_{13C-16O}$\n- $E_{ZPE,D} = \\frac{1}{2}h(\\nu_{12C-18O} + \\nu_{12C-16O})$\n\n将这些代入 $\\Delta E_{ZPE}$ 的表达式中：\n$$\n\\Delta E_{ZPE} = (h\\nu_{13C-16O} + \\frac{1}{2}h(\\nu_{12C-18O} + \\nu_{12C-16O})) - (\\frac{1}{2}h(\\nu_{13C-18O} + \\nu_{13C-16O}) + h\\nu_{12C-16O})\n$$\n$$\n\\Delta E_{ZPE} = \\frac{1}{2}h (\\nu_{13C-16O} + \\nu_{12C-18O} - \\nu_{13C-18O} - \\nu_{12C-16O})\n$$\n该能量差为正，表明随机分布（产物）的零点能高于团簇分布（反应物）。\n\n振动频率 $\\nu$ 与双原子键的约化质量 $\\mu$ 成 $\\nu \\propto 1/\\sqrt{\\mu}$ 的标度关系。给定 ${}^{12}\\mathrm{C}-{}^{16}\\mathrm{O}$ 键的基准频率 $\\nu_0$ 及其约化质量 $\\mu_0$，任何其他同位素对的频率 $\\nu$ 为 $\\nu = \\nu_0\\sqrt{\\mu_0/\\mu}$。\n问题指出频率以波数（$\\mathrm{cm}^{-1}$）提供，记为 $\\tilde{\\nu}$。能量为 $E = hc\\tilde{\\nu}$。为使用国际单位制，$\\tilde{\\nu}$ 必须以 $\\mathrm{m}^{-1}$ 为单位，因此我们必须通过乘以 $100$ 将 $\\mathrm{cm}^{-1}$ 转换。\n设 $\\tilde{\\nu}_0$ 为 ${}^{12}\\mathrm{C}-{}^{16}\\mathrm{O}$ 的基准频率（单位为 $\\mathrm{cm}^{-1}$），我们将 $X$ 表示为：\n$$\nX = -\\frac{hc \\times 100}{2k_B T} (\\tilde{\\nu}_{13C-16O} + \\tilde{\\nu}_{12C-18O} - \\tilde{\\nu}_{13C-18O} - \\tilde{\\nu}_{12C-16O})\n$$\n代入标度律 $\\tilde{\\nu} = \\tilde{\\nu}_0\\sqrt{\\mu_0/\\mu}$：\n$$\nX = -\\frac{hc \\times 100 \\times \\tilde{\\nu}_0}{2k_B T} \\left( \\sqrt{\\frac{\\mu_0}{\\mu_{13-16}}} + \\sqrt{\\frac{\\mu_0}{\\mu_{12-18}}} - \\sqrt{\\frac{\\mu_0}{\\mu_{13-18}}} - 1 \\right)\n$$\n其中 $\\mu_{i\\text{-}j}$ 表示 ${}^i\\mathrm{C}-{}^j\\mathrm{O}$ 键的约化质量。我们可以根据约化质量比定义一个无量纲标度因子 $S_{\\mu}$：\n$$\nS_{\\mu} = 1 + \\sqrt{\\frac{\\mu_{12-16}}{\\mu_{13-18}}} - \\sqrt{\\frac{\\mu_{12-16}}{\\mu_{12-18}}} - \\sqrt{\\frac{\\mu_{12-16}}{\\mu_{13-16}}}\n$$\n通过这个定义，$X$ 的表达式简化为：\n$$\nX(\\tilde{\\nu}_0, T) = \\frac{hc \\times 100 \\times \\tilde{\\nu}_0}{2k_B T} S_{\\mu}\n$$\n这个方程构成了我们的模型。项 $\\frac{hc \\times 100 \\times S_{\\mu}}{2k_B}$ 是一个常数。根据零点能的排序，$\\Delta E_{ZPE} > 0$，这意味着 $S_{\\mu}  0$。因此，$X$ 将为正值，表明平衡偏向产物（随机分布），这与团簇效应的预期相反。让我们重新检查代数。\n\n$X = \\ln K = -\\Delta E_{ZPE} / (k_B T)$. $\\Delta E_{ZPE} = E_{prod} - E_{react}$.\n$E_{prod} = E_C + E_D = h\\nu_{13C-16O} + \\frac{1}{2}h(\\nu_{12C-18O} + \\nu_{12C-16O})$\n$E_{react} = E_A + E_B = \\frac{1}{2}h(\\nu_{13C-18O} + \\nu_{13C-16O}) + h\\nu_{12C-16O})$\n$\\Delta E_{ZPE} = \\frac{h}{2}(\\nu_{13C-16O} + \\nu_{12C-18O} - \\nu_{13C-18O} - \\nu_{12C-16O})$.\n重同位素键更弱，振动频率更低。所以 $\\nu_{13C-16O}  \\nu_{12C-16O}$, $\\nu_{12C-18O}  \\nu_{12C-16O}$, $\\nu_{13C-18O}  \\nu_{12C-16O}$。\n$\\nu_{13C-16O} - \\nu_{12C-16O}  0$.\n$\\nu_{12C-18O} - \\nu_{13C-18O} > 0$.\n$\\Delta E_{ZPE}$ 符号不明显。但热力学上，团簇物种更稳定，意味着 $E_A+E_B  E_C+E_D$, 所以 $\\Delta E_{ZPE} > 0$. 这意味着 $X0$。\n$X = \\ln K = \\ln( [C][D] / ([A][B]) )$. $K1$ 意味着反应物占优。团簇态是反应物，所以平衡应偏向左侧，$K1$, $\\ln K  0$。所以 $X$ 应该是负的。\n\n$\\Delta E_{ZPE}$ 的符号是正的。$X = -\\frac{\\Delta E_{ZPE}}{k_B T}$ 必须是负的。\n我的 $S_{\\mu}$ 定义是：$S_{\\mu} = 1 + \\sqrt{\\frac{\\mu_{12-16}}{\\mu_{13-18}}} - \\sqrt{\\frac{\\mu_{12-16}}{\\mu_{12-18}}} - \\sqrt{\\frac{\\mu_{12-16}}{\\mu_{13-16}}}$.\n这等于 $-( \\sqrt{\\frac{\\mu_0}{\\mu_{13-16}}} + \\sqrt{\\frac{\\mu_0}{\\mu_{12-18}}} - \\sqrt{\\frac{\\mu_0}{\\mu_{13-18}}} - 1 )$.\n所以 $X = \\frac{hc \\times 100 \\times \\tilde{\\nu}_0}{2k_B T} S_{\\mu}$.\n$h,c,\\tilde{\\nu}_0,k_B,T$ 均为正。$X$ 的符号由 $S_{\\mu}$ 决定。\n计算 $S_\\mu$ 的值。$\\mu_{12-16} \\approx 6.857$. $\\mu_{13-16} \\approx 7.17$. $\\mu_{12-18} \\approx 7.2$. $\\mu_{13-18} \\approx 7.5$.\n$S_\\mu = 1 + \\sqrt{6.857/7.5} - \\sqrt{6.857/7.2} - \\sqrt{6.857/7.17} = 1 + 0.955 - 0.976 - 0.978 \\approx -0.001$.\n$S_\\mu$ 是负的。因此 $X$ 是负的。逻辑正确。\n\n### 步骤2：灵敏度分析\n\n灵敏度分析需要计算 $X$ 对 $\\tilde{\\nu}_0$ 和 $T$ 的偏导数。令 $C = \\frac{hc \\times 100 \\times S_{\\mu}}{2k_B}$。我们的模型是 $X = C \\frac{\\tilde{\\nu}_0}{T}$。\n对 $\\tilde{\\nu}_0$ 的偏导数是：\n$$\n\\frac{\\partial X}{\\partial \\tilde{\\nu}_0} = \\frac{C}{T} = \\frac{X}{\\tilde{\\nu}_0}\n$$\n对 $T$ 的偏导数是：\n$$\n\\frac{\\partial X}{\\partial T} = -C \\frac{\\tilde{\\nu}_0}{T^2} = -\\frac{X}{T}\n$$\n这些导数将在每个测试用例的均值 $(\\tilde{\\nu}_{0,\\mathrm{mean}}, T_{\\mathrm{mean}})$ 处进行评估。\n\n### 步骤3：数值实现\n\n对于每个测试用例 $(T_{\\mathrm{mean}}, \\sigma_T, \\tilde{\\nu}_{0,\\mathrm{mean}}, \\sigma_{\\tilde{\\nu}_0}, N)$，算法如下：\n1.  使用提供的原子质量计算四种键类型（${}^{12}\\mathrm{C}-{}^{16}\\mathrm{O}$、${}^{13}\\mathrm{C}-{}^{18}\\mathrm{O}$、${}^{12}\\mathrm{C}-{}^{18}\\mathrm{O}$、${}^{13}\\mathrm{C}-{}^{16}\\mathrm{O}$）的约化质量。\n2.  计算常数无量纲标度因子 $S_{\\mu}$。\n3.  **蒙特卡罗模拟**：\n    - 从正态分布 $\\mathcal{N}(T_{\\mathrm{mean}}, \\sigma_T^2)$ 中生成 $N$ 个温度 $T$ 的随机样本。\n    - 从正态分布 $\\mathcal{N}(\\tilde{\\nu}_{0,\\mathrm{mean}}, \\sigma_{\\tilde{\\nu}_0}^2)$ 中生成 $N$ 个频率 $\\tilde{\\nu}_0$ 的随机样本。\n    - 对于每对样本 $(T_i, \\tilde{\\nu}_{0,i})$，计算 $X_i = \\frac{hc \\times 100 \\times S_{\\mu}}{2k_B} \\frac{\\tilde{\\nu}_{0,i}}{T_i}$。\n    - 计算得到的 $N$ 个 $X_i$ 值的均值和标准差。\n4.  **灵敏度计算**：\n    - 在平均输入值 $T_{\\mathrm{mean}}$ 和 $\\tilde{\\nu}_{0,\\mathrm{mean}}$ 处评估 $\\frac{\\partial X}{\\partial \\tilde{\\nu}_0}$ 和 $\\frac{\\partial X}{\\partial T}$ 的解析表达式。\n5.  为每个测试用例收集四个结果值（$X$ 的蒙特卡罗均值、$X$ 的蒙特卡罗标准差、$\\frac{\\partial X}{\\partial \\tilde{\\nu}_0}$、$\\frac{\\partial X}{\\partial T}$），并按指定格式进行格式化。\n对于案例4，其中 $\\sigma_T = 0$，$\\sigma_{\\tilde{\\nu}_0} = 0$，且 $N=1$，蒙特卡罗模拟简化为单次确定性计算，标准差正确报告为0。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the clumped isotope modeling problem by deriving the clumping index X,\n    performing Monte Carlo uncertainty propagation, and conducting a sensitivity analysis.\n    \"\"\"\n\n    # Physical constants\n    h = 6.62607015e-34  # Planck's constant (J*s)\n    c = 2.99792458e8    # Speed of light (m/s)\n    k_B = 1.380649e-23   # Boltzmann constant (J/K)\n    # u = 1.66053906660e-27 # Atomic mass unit (kg) - not needed for ratios\n\n    # Atomic masses (in atomic mass units, u)\n    masses = {\n        '12C': 12.000000,\n        '13C': 13.003355,\n        '16O': 15.994915,\n        '18O': 17.999160,\n    }\n\n    # Function to calculate reduced mass\n    def get_reduced_mass(m1, m2):\n        return (m1 * m2) / (m1 + m2)\n\n    # Calculate reduced masses for all relevant C-O bonds\n    mu_12_16 = get_reduced_mass(masses['12C'], masses['16O'])  # This is mu_0\n    mu_13_18 = get_reduced_mass(masses['13C'], masses['18O'])\n    mu_12_18 = get_reduced_mass(masses['12C'], masses['18O'])\n    mu_13_16 = get_reduced_mass(masses['13C'], masses['16O'])\n\n    # Calculate the dimensionless frequency scaling factor S_mu\n    # S_mu = 1 + sqrt(mu_0/mu_13-18) - sqrt(mu_0/mu_12-18) - sqrt(mu_0/mu_13-16)\n    S_mu = (1.0 + np.sqrt(mu_12_16 / mu_13_18) - \n            np.sqrt(mu_12_16 / mu_12_18) - \n            np.sqrt(mu_12_16 / mu_13_16))\n\n    # Pre-compute the main constant factor for X\n    # X = const_factor * nu_0 / T\n    # The factor of 100 converts nu_0 from cm^-1 to m^-1\n    const_factor = (h * c * 100.0 * S_mu) / (2.0 * k_B)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (298.0, 1.0, 1400.0, 3.0, 50000),   # Case 1\n        (200.0, 0.5, 1400.0, 3.0, 50000),   # Case 2\n        (1000.0, 5.0, 1400.0, 5.0, 50000),  # Case 3\n        (298.0, 0.0, 1400.0, 0.0, 1),       # Case 4\n    ]\n\n    results = []\n    # Use a fixed seed for reproducibility of the Monte Carlo simulation\n    rng = np.random.default_rng(seed=42)\n\n    for case in test_cases:\n        T_mean, sigma_T, nu0_mean, sigma_nu0, N = case\n\n        # Monte Carlo simulation for X\n        if N > 1:\n            T_samples = rng.normal(T_mean, sigma_T, N)\n            # Ensure no non-positive temperatures if sigma is large, though unlikely here\n            T_samples[T_samples = 0] = T_mean \n            nu0_samples = rng.normal(nu0_mean, sigma_nu0, N)\n        else: # Deterministic case (N=1)\n            T_samples = np.array([T_mean])\n            nu0_samples = np.array([nu0_mean])\n            \n        # Calculate X for all samples\n        X_samples = const_factor * nu0_samples / T_samples\n\n        # Calculate mean and standard deviation of X\n        X_mean = np.mean(X_samples)\n        X_std = np.std(X_samples)\n\n        # Sensitivity analysis (partial derivatives)\n        # dX/d(nu_0) = C / T\n        # dX/dT = -C * nu_0 / T^2\n        # where C = const_factor\n        \n        # Evaluated at mean values\n        X_at_mean = const_factor * nu0_mean / T_mean\n        sensitivity_nu0 = X_at_mean / nu0_mean\n        sensitivity_T = -X_at_mean / T_mean\n        \n        results.extend([X_mean, X_std, sensitivity_nu0, sensitivity_T])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{val:.8g}' for val in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "真实世界的地球化学体系往往是开放的，其同位素组成不仅受热力学平衡控制，还受到动力学过程（如物质的流入、流出和交换）的深刻影响。本练习  将我们的模型从封闭的平衡体系扩展到更符合实际的开放体系。您将构建一个稳态箱式模型，该模型整合了动力学分馏效应和由吉布斯自由能（$\\Delta G$）决定的平衡团簇偏好，从而能够模拟复杂的动态同位素体系中重同位素的分布和团簇状态。",
            "id": "4088395",
            "problem": "考虑一个具有两个可区分取代位点的单一分子种类，标记为 $p$ 和 $q$。位点 $p$ 可以容纳一种轻元素的重同位素（例如，碳-13取代碳-12），而位点 $q$ 可以容纳一种非传统元素的重同位素（例如，铁-57取代铁-56）。将在流入储库中位点 $p$ 的重同位素丰度分数记为 $f_{A,\\mathrm{in}}$，位点 $q$ 的记为 $f_{B,\\mathrm{in}}$；在外部交换储库中的重同位素丰度分数分别记为 $f_{A,\\mathrm{ex}}$ 和 $f_{B,\\mathrm{ex}}$。该分子种类通过流入和流出进行周转，并与外部储库进行同位素交换。假设质量作用动力学具有恒定的速率系数，并且同位素分馏表示为重同位素速率常数相对于轻同位素速率常数的乘法缩放，即分馏因子 $\\alpha$ 通过 $k_{\\mathrm{H}} = \\alpha k_{\\mathrm{L}}$ 来修正重同位素速率常数。\n\n设 $v_{\\mathrm{in}}$ 为流入该分子种类的总速率（单位为 $\\mathrm{s}^{-1}$），$v_{\\mathrm{out}}$ 为总流出速率（单位为 $\\mathrm{s}^{-1}$），$v_{\\mathrm{swap}}$ 为与外部储库的同位素交换速率（单位为 $\\mathrm{s}^{-1}$）。对于位点 $p$，分馏因子分别为：流入 $\\alpha_{A,\\mathrm{in}}$，流出 $\\alpha_{A,\\mathrm{out}}$，从外部储库到该物种的交换流入 $\\alpha_{A,\\mathrm{swap,in}}$，以及从该物种到外部储库的交换流出 $\\alpha_{A,\\mathrm{swap,out}}$。对于位点 $q$，类似的分馏因子为 $\\alpha_{B,\\mathrm{in}}$、$\\alpha_{B,\\mathrm{out}}$、$\\alpha_{B,\\mathrm{swap,in}}$ 和 $\\alpha_{B,\\mathrm{swap,out}}$。\n\n在稳态下，每个位点的重同位素数量是守恒的。从质量守恒基本原理和由流入、流出及交换驱动的重同位素数量的常微分方程（ODE）出发，使用所述模型假设，推导该分子种类中位点 $p$ 和 $q$ 的稳态重同位素丰度分数 $f_A$ 和 $f_B$。请用 $v_{\\mathrm{in}}$、$v_{\\mathrm{out}}$、$v_{\\mathrm{swap}}$、$f_{A,\\mathrm{in}}$、$f_{B,\\mathrm{in}}$、$f_{A,\\mathrm{ex}}$、$f_{B,\\mathrm{ex}}$ 以及分馏因子 $\\alpha_{A,\\cdot}$ 和 $\\alpha_{B,\\cdot}$ 来表示你的推导。\n\n现在考虑由四种可能的取代状态形成的同位素异构体（isotopologue）的分布：两个位点均为轻同位素（$\\mathrm{LL}$）、仅位点 $p$ 为重同位素（$\\mathrm{AL}$）、仅位点 $q$ 为重同位素（$\\mathrm{LB}$）以及两个位点均为重同位素（$\\mathrm{AB}$）。这四种状态的随机分布是位点概率的乘积。然而，热力学偏好可以改变双取代团簇同位素异构体 $\\mathrm{AB}$ 的频率。根据团簇同位素异构体与随机参考态在温度 $T$ 下的摩尔吉布斯自由能差 $\\Delta G$，通过 Boltzmann 关系定义团簇富集因子 $\\gamma$：\n$$\n\\gamma = \\exp\\!\\left(-\\frac{\\Delta G}{R T}\\right),\n$$\n其中 $R$ 是气体常数 R，单位为 $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$T$ 是绝对温度，单位为 $\\mathrm{K}$。使用 $\\gamma$ 对同位素异构体概率进行重新加权，并通过概率守恒施加归一化。\n\n根据上述基本定义和概率守恒，推导团簇同位素异构体 $\\mathrm{AB}$ 的归一化概率 $P'_{\\mathrm{AB}}$ 和团簇偏离度\n$$\n\\Delta = \\frac{P'_{\\mathrm{AB}}}{P_{\\mathrm{AB}}} - 1,\n$$\n其中 $P_{\\mathrm{AB}}$ 是 $\\mathrm{AB}$ 同位素异构体的随机概率。如果 $P_{\\mathrm{AB}} = 0$，则根据连续性定义 $\\Delta$ 为 $0$。\n\n实现一个程序，为每个测试用例计算稳态重同位素丰度分数 $f_A$ 和 $f_B$、归一化的团簇概率 $P'_{\\mathrm{AB}}$ 以及团簇偏离度 $\\Delta$。所有输出均为无量纲。速率常数必须以 $\\mathrm{s}^{-1}$ 为单位处理，温度 $T$ 必须以 $\\mathrm{K}$ 为单位，摩尔吉布斯自由能差 $\\Delta G$ 必须以 $\\mathrm{J\\,mol^{-1}}$ 为单位。气体常数必须为 $R = 8.31446261815324\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$。\n\n您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果本身是一个按 $[f_A, f_B, P'_{\\mathrm{AB}}, \\Delta]$ 顺序排列的包含四个浮点数的列表。\n\n使用以下测试套件，它探测了一般行为、无交换和无团簇、重同位素极其稀少以及低温下的强团簇等情况：\n\n-   测试用例1（一般稳态和中等团簇）：\n  - $T = 298.15$\n  - $\\Delta G = -1500$\n  - $v_{\\mathrm{in}} = 1.0$, $v_{\\mathrm{out}} = 0.8$, $v_{\\mathrm{swap}} = 0.5$\n  - $f_{A,\\mathrm{in}} = 0.011$, $f_{B,\\mathrm{in}} = 0.005$\n  - $f_{A,\\mathrm{ex}} = 0.012$, $f_{B,\\mathrm{ex}} = 0.006$\n  - $\\alpha_{A,\\mathrm{in}} = 0.998$, $\\alpha_{A,\\mathrm{out}} = 1.002$, $\\alpha_{A,\\mathrm{swap,in}} = 1.001$, $\\alpha_{A,\\mathrm{swap,out}} = 0.999$\n  - $\\alpha_{B,\\mathrm{in}} = 1.003$, $\\alpha_{B,\\mathrm{out}} = 0.997$, $\\alpha_{B,\\mathrm{swap,in}} = 1.000$, $\\alpha_{B,\\mathrm{swap,out}} = 1.000$\n\n-   测试用例2（无交换，无团簇）：\n  - $T = 298.15$\n  - $\\Delta G = 0$\n  - $v_{\\mathrm{in}} = 0.5$, $v_{\\mathrm{out}} = 1.0$, $v_{\\mathrm{swap}} = 0.0$\n  - $f_{A,\\mathrm{in}} = 0.010$, $f_{B,\\mathrm{in}} = 0.004$\n  - $f_{A,\\mathrm{ex}} = 0.0$, $f_{B,\\mathrm{ex}} = 0.0$\n  - $\\alpha_{A,\\mathrm{in}} = 1.000$, $\\alpha_{A,\\mathrm{out}} = 1.000$, $\\alpha_{A,\\mathrm{swap,in}} = 1.000$, $\\alpha_{A,\\mathrm{swap,out}} = 1.000$\n  - $\\alpha_{B,\\mathrm{in}} = 1.000$, $\\alpha_{B,\\mathrm{out}} = 1.000$, $\\alpha_{B,\\mathrm{swap,in}} = 1.000$, $\\alpha_{B,\\mathrm{swap,out}} = 1.000$\n\n-   测试用例3（重同位素极其稀少和弱团簇）：\n  - $T = 300.0$\n  - $\\Delta G = -500$\n  - $v_{\\mathrm{in}} = 2.0$, $v_{\\mathrm{out}} = 2.0$, $v_{\\mathrm{swap}} = 0.1$\n  - $f_{A,\\mathrm{in}} = 1.0 \\times 10^{-6}$, $f_{B,\\mathrm{in}} = 1.0 \\times 10^{-6}$\n  - $f_{A,\\mathrm{ex}} = 1.0 \\times 10^{-4}$, $f_{B,\\mathrm{ex}} = 1.0 \\times 10^{-5}$\n  - $\\alpha_{A,\\mathrm{in}} = 0.999$, $\\alpha_{A,\\mathrm{out}} = 1.001$, $\\alpha_{A,\\mathrm{swap,in}} = 1.000$, $\\alpha_{A,\\mathrm{swap,out}} = 1.000$\n  - $\\alpha_{B,\\mathrm{in}} = 1.002$, $\\alpha_{B,\\mathrm{out}} = 0.998$, $\\alpha_{B,\\mathrm{swap,in}} = 1.000$, $\\alpha_{B,\\mathrm{swap,out}} = 1.000$\n\n-   测试用例4（低温下的强团簇）：\n  - $T = 260.0$\n  - $\\Delta G = -4000$\n  - $v_{\\mathrm{in}} = 1.5$, $v_{\\mathrm{out}} = 1.2$, $v_{\\mathrm{swap}} = 0.3$\n  - $f_{A,\\mathrm{in}} = 0.020$, $f_{B,\\mathrm{in}} = 0.010$\n  - $f_{A,\\mathrm{ex}} = 0.020$, $f_{B,\\mathrm{ex}} = 0.011$\n  - $\\alpha_{A,\\mathrm{in}} = 0.997$, $\\alpha_{A,\\mathrm{out}} = 1.003$, $\\alpha_{A,\\mathrm{swap,in}} = 1.001$, $\\alpha_{A,\\mathrm{swap,out}} = 0.999$\n  - $\\alpha_{B,\\mathrm{in}} = 1.004$, $\\alpha_{B,\\mathrm{out}} = 0.996$, $\\alpha_{B,\\mathrm{swap,in}} = 1.000$, $\\alpha_{B,\\mathrm{swap,out}} = 1.000$\n\n你的程序应该产生形如\n\"[ [fA1,fB1,PABp1,Delta1], [fA2,fB2,PABp2,Delta2], [fA3,fB3,PABp3,Delta3], [fA4,fB4,PABp4,Delta4] ]\"\n的单行输出，每个浮点值四舍五入到六位小数。",
            "solution": "此问题经评估有效。它描述了一个标准的开放系统同位素箱式模型，该模型建立在质量作用动力学、稳态质量平衡和同位素效应的统计力学原理之上，这些原理在计算地球化学领域已广为确立。所提供的参数在物理上是现实的，问题是适定的，从而能够导出一个唯一且有意义的解。推导过程如下。\n\n问题的核心在于为稳态下每个位点 $p$ 和 $q$ 上的重同位素建立质量平衡。稳态由进入分子库的重同位素总通量等于流出该库的总通量的条件定义。设 $f_A$ 和 $f_B$ 分别为位点 $p$ 和 $q$ 的稳态重同位素丰度分数。\n\n首先，我们推导 $f_A$ 的表达式。该模型假设，涉及重同位素的过程的速率相对于轻同位素的速率，按分馏因子 $\\alpha$ 进行缩放。在此类箱式模型中，一个常见且稳健的简化方法是直接对重同位素的通量进行建模，此处即采用此法。在稳态下，重同位素 $A$ 加入系统的总速率必须与总移除速率相平衡。\n\n影响同位素 $A$ 丰度的通量有：\n1.  **流入**：物质以总速率 $v_{\\mathrm{in}}$ 流入系统，源物质的重同位素丰度分数为 $f_{A,\\mathrm{in}}$。$A$ 的通量被 $\\alpha_{A,\\mathrm{in}}$ 分馏。这贡献了一个与 $v_{\\mathrm{in}} \\alpha_{A,\\mathrm{in}} f_{A,\\mathrm{in}}$ 成正比的项。\n2.  **流出**：物质以总速率 $v_{\\mathrm{out}}$ 流出系统。系统中的物质的重同位素丰度分数为 $f_A$。此通量被 $\\alpha_{A,\\mathrm{out}}$ 分馏，贡献一个与 $v_{\\mathrm{out}} \\alpha_{A,\\mathrm{out}} f_A$ 成正比的移除项。\n3.  **交换流入**：与外部储库（丰度分数为 $f_{A,\\mathrm{ex}}$）的同位素交换以速率 $v_{\\mathrm{swap}}$ 发生。从外部储库流入系统的 $A$ 通量被 $\\alpha_{A,\\mathrm{swap,in}}$ 分馏，产生一个与 $v_{\\mathrm{swap}} \\alpha_{A,\\mathrm{swap,in}} f_{A,\\mathrm{ex}}$ 成正比的项。\n4.  **交换流出**：从系统返回外部储库的相应 $A$ 交换通量被 $\\alpha_{A,\\mathrm{swap,out}}$ 分馏，产生一个与 $v_{\\mathrm{swap}} \\alpha_{A,\\mathrm{swap,out}} f_A$ 成正比的移除项。\n\n在稳态下，同位素 $A$ 的输入通量之和等于输出通量之和：\n$$\nv_{\\mathrm{in}} \\alpha_{A,\\mathrm{in}} f_{A,\\mathrm{in}} + v_{\\mathrm{swap}} \\alpha_{A,\\mathrm{swap,in}} f_{A,\\mathrm{ex}} = v_{\\mathrm{out}} \\alpha_{A,\\mathrm{out}} f_{A} + v_{\\mathrm{swap}} \\alpha_{A,\\mathrm{swap,out}} f_{A}\n$$\n这是一个关于 $f_A$ 的线性方程。我们可以通过从右侧项中提取公因子 $f_A$ 来求解：\n$$\nv_{\\mathrm{in}} \\alpha_{A,\\mathrm{in}} f_{A,\\mathrm{in}} + v_{\\mathrm{swap}} \\alpha_{A,\\mathrm{swap,in}} f_{A,\\mathrm{ex}} = f_{A} (v_{\\mathrm{out}} \\alpha_{A,\\mathrm{out}} + v_{\\mathrm{swap}} \\alpha_{A,\\mathrm{swap,out}})\n$$\n分离出 $f_A$ 可得到位点 $p$ 的稳态重同位素丰度分数：\n$$\nf_A = \\frac{v_{\\mathrm{in}} \\alpha_{A,\\mathrm{in}} f_{A,\\mathrm{in}} + v_{\\mathrm{swap}} \\alpha_{A,\\mathrm{swap,in}} f_{A,\\mathrm{ex}}}{v_{\\mathrm{out}} \\alpha_{A,\\mathrm{out}} + v_{\\mathrm{swap}} \\alpha_{A,\\mathrm{swap,out}}}\n$$\n位点 $q$ 的重同位素丰度分数 $f_B$ 的推导遵循完全相同的逻辑，只需使用同位素 $B$ 的相应参数：\n$$\nf_B = \\frac{v_{\\mathrm{in}} \\alpha_{B,\\mathrm{in}} f_{B,\\mathrm{in}} + v_{\\mathrm{swap}} \\alpha_{B,\\mathrm{swap,in}} f_{B,\\mathrm{ex}}}{v_{\\mathrm{out}} \\alpha_{B,\\mathrm{out}} + v_{\\mathrm{swap}} \\alpha_{B,\\mathrm{swap,out}}}\n$$\n在确定了稳态位点丰度分数 $f_A$ 和 $f_B$ 之后，我们接下来讨论同位素异构体的分布，特别是团簇物种 $\\mathrm{AB}$。\n\n在没有团簇的热力学偏好的情况下，同位素异构体的分布是随机的。每种状态的概率是各个位点同位素状态的独立概率的乘积：\n-   $P_{\\mathrm{LL}} = (1-f_A)(1-f_B)$\n-   $P_{\\mathrm{AL}} = f_A(1-f_B)$\n-   $P_{\\mathrm{LB}} = (1-f_A)f_B$\n-   $P_{\\mathrm{AB}} = f_A f_B$\n\n这些概率的总和为 $(1-f_A+f_A) (1-f_B+f_B) = 1$，符合要求。\n\n对团簇同位素异构体 $\\mathrm{AB}$ 的热力学偏好由温度 $T$ 下的吉布斯自由能差 $\\Delta G$ 来量化。这种偏好通过团簇富集因子 $\\gamma$ 表达，由 Boltzmann 关系给出：\n$$\n\\gamma = \\exp\\left(-\\frac{\\Delta G}{RT}\\right)\n$$\n其中 $R$ 是气体常数。该因子对团簇状态的概率进行重新加权。未归一化的概率，记为 $P''$，变为：\n$P''_{\\mathrm{LL}} = P_{\\mathrm{LL}}$，$P''_{\\mathrm{AL}} = P_{\\mathrm{AL}}$，$P''_{\\mathrm{LB}} = P_{\\mathrm{LB}}$，以及 $P''_{\\mathrm{AB}} = \\gamma P_{\\mathrm{AB}}$。\n\n这些新概率的总和不为 $1$。为了获得最终的归一化概率 $P'$，我们必须将它们除以其总和，即配分函数 $S$：\n$$\nS = P''_{\\mathrm{LL}} + P''_{\\mathrm{AL}} + P''_{\\mathrm{LB}} + P''_{\\mathrm{AB}} = P_{\\mathrm{LL}} + P_{\\mathrm{AL}} + P_{\\mathrm{LB}} + \\gamma P_{\\mathrm{AB}}\n$$\n由于 $\\sum P_{\\mathrm{stochastic}} = 1$，我们可以写出 $P_{\\mathrm{LL}} + P_{\\mathrm{AL}} + P_{\\mathrm{LB}} = 1 - P_{\\mathrm{AB}}$。将此代入 $S$ 的表达式中：\n$$\nS = (1 - P_{\\mathrm{AB}}) + \\gamma P_{\\mathrm{AB}} = 1 + (\\gamma-1)P_{\\mathrm{AB}} = 1 + (\\gamma-1)f_A f_B\n$$\n团簇同位素异构体的归一化概率 $P'_{\\mathrm{AB}}$ 是其重新加权的概率除以归一化因子 $S$：\n$$\nP'_{\\mathrm{AB}} = \\frac{\\gamma P_{\\mathrm{AB}}}{S} = \\frac{\\gamma f_A f_B}{1 + (\\gamma-1)f_A f_B}\n$$\n最后，我们推导团簇偏离度 $\\Delta$，其定义为团簇同位素异构体概率与其随机值之间的相对偏差：\n$$\n\\Delta = \\frac{P'_{\\mathrm{AB}}}{P_{\\mathrm{AB}}} - 1\n$$\n对于 $P_{\\mathrm{AB}} > 0$（即 $f_A > 0$ 且 $f_B > 0$）的情况，我们可以代入 $P'_{\\mathrm{AB}}$ 的表达式：\n$$\n\\Delta = \\frac{\\frac{\\gamma P_{\\mathrm{AB}}}{1 + (\\gamma-1)P_{\\mathrm{AB}}}}{P_{\\mathrm{AB}}} - 1 = \\frac{\\gamma}{1 + (\\gamma-1)P_{\\mathrm{AB}}} - 1\n$$\n将各项通分：\n$$\n\\Delta = \\frac{\\gamma - (1 + (\\gamma-1)P_{\\mathrm{AB}})}{1 + (\\gamma-1)P_{\\mathrm{AB}}} = \\frac{\\gamma - 1 - (\\gamma-1)P_{\\mathrm{AB}}}{1 + (\\gamma-1)P_{\\mathrm{AB}}} = \\frac{(\\gamma-1)(1 - P_{\\mathrm{AB}})}{1 + (\\gamma-1)P_{\\mathrm{AB}}}\n$$\n代入 $P_{\\mathrm{AB}} = f_A f_B$：\n$$\n\\Delta = \\frac{(\\gamma-1)(1 - f_A f_B)}{1 + (\\gamma-1)f_A f_B}\n$$\n根据问题陈述，如果 $P_{\\mathrm{AB}} = 0$，则定义 $\\Delta$ 为 $0$。这种情况在 $f_A=0$ 或 $f_B=0$ 时出现。此时，$P'_{\\mathrm{AB}}$ 也为 $0$，使得相对富集的概念没有实际意义，从而证明了 $\\Delta=0$ 这一定义的合理性。\n\n下面的程序实现了这些推导出的表达式，以计算给定测试用例的量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for steady-state isotope fractions and clumped isotope parameters\n    for a set of test cases based on a geochemical box model.\n    \"\"\"\n    R = 8.31446261815324  # Gas Constant in J mol^{-1} K^{-1}\n\n    test_cases = [\n        {\n            \"T\": 298.15, \"delta_G\": -1500,\n            \"v_in\": 1.0, \"v_out\": 0.8, \"v_swap\": 0.5,\n            \"f_A_in\": 0.011, \"f_B_in\": 0.005,\n            \"f_A_ex\": 0.012, \"f_B_ex\": 0.006,\n            \"alpha_A_in\": 0.998, \"alpha_A_out\": 1.002, \"alpha_A_swap_in\": 1.001, \"alpha_A_swap_out\": 0.999,\n            \"alpha_B_in\": 1.003, \"alpha_B_out\": 0.997, \"alpha_B_swap_in\": 1.000, \"alpha_B_swap_out\": 1.000\n        },\n        {\n            \"T\": 298.15, \"delta_G\": 0,\n            \"v_in\": 0.5, \"v_out\": 1.0, \"v_swap\": 0.0,\n            \"f_A_in\": 0.010, \"f_B_in\": 0.004,\n            \"f_A_ex\": 0.0, \"f_B_ex\": 0.0,\n            \"alpha_A_in\": 1.000, \"alpha_A_out\": 1.000, \"alpha_A_swap_in\": 1.000, \"alpha_A_swap_out\": 1.000,\n            \"alpha_B_in\": 1.000, \"alpha_B_out\": 1.000, \"alpha_B_swap_in\": 1.000, \"alpha_B_swap_out\": 1.000\n        },\n        {\n            \"T\": 300.0, \"delta_G\": -500,\n            \"v_in\": 2.0, \"v_out\": 2.0, \"v_swap\": 0.1,\n            \"f_A_in\": 1e-6, \"f_B_in\": 1e-6,\n            \"f_A_ex\": 1e-4, \"f_B_ex\": 1e-5,\n            \"alpha_A_in\": 0.999, \"alpha_A_out\": 1.001, \"alpha_A_swap_in\": 1.000, \"alpha_A_swap_out\": 1.000,\n            \"alpha_B_in\": 1.002, \"alpha_B_out\": 0.998, \"alpha_B_swap_in\": 1.000, \"alpha_B_swap_out\": 1.000\n        },\n        {\n            \"T\": 260.0, \"delta_G\": -4000,\n            \"v_in\": 1.5, \"v_out\": 1.2, \"v_swap\": 0.3,\n            \"f_A_in\": 0.020, \"f_B_in\": 0.010,\n            \"f_A_ex\": 0.020, \"f_B_ex\": 0.011,\n            \"alpha_A_in\": 0.997, \"alpha_A_out\": 1.003, \"alpha_A_swap_in\": 1.001, \"alpha_A_swap_out\": 0.999,\n            \"alpha_B_in\": 1.004, \"alpha_B_out\": 0.996, \"alpha_B_swap_in\": 1.000, \"alpha_B_swap_out\": 1.000\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # Part 1: Calculate steady-state heavy fractions f_A and f_B\n        \n        # Numerator for f_A calculation\n        fA_num = (case[\"v_in\"] * case[\"alpha_A_in\"] * case[\"f_A_in\"] +\n                  case[\"v_swap\"] * case[\"alpha_A_swap_in\"] * case[\"f_A_ex\"])\n        \n        # Denominator for f_A calculation\n        fA_den = (case[\"v_out\"] * case[\"alpha_A_out\"] +\n                  case[\"v_swap\"] * case[\"alpha_A_swap_out\"])\n        \n        f_A = fA_num / fA_den if fA_den != 0 else 0\n\n        # Numerator for f_B calculation\n        fB_num = (case[\"v_in\"] * case[\"alpha_B_in\"] * case[\"f_B_in\"] +\n                  case[\"v_swap\"] * case[\"alpha_B_swap_in\"] * case[\"f_B_ex\"])\n\n        # Denominator for f_B calculation\n        fB_den = (case[\"v_out\"] * case[\"alpha_B_out\"] +\n                  case[\"v_swap\"] * case[\"alpha_B_swap_out\"])\n\n        f_B = fB_num / fB_den if fB_den != 0 else 0\n\n        # Part 2: Calculate clumped isotope parameters\n        \n        # Clumped enhancement factor gamma\n        gamma = np.exp(-case[\"delta_G\"] / (R * case[\"T\"]))\n        \n        # Stochastic probability of the clumped isotopologue\n        P_AB = f_A * f_B\n        \n        # Normalization factor S\n        S = 1 + (gamma - 1) * P_AB\n        \n        # Normalized clumped probability P'_AB\n        if S != 0:\n            P_prime_AB = (gamma * P_AB) / S\n        else: # Should not happen under normal conditions\n            P_prime_AB = 0\n            \n        # Clumping departure Delta\n        if P_AB == 0:\n            Delta = 0.0\n        else:\n            Delta = ((gamma - 1) * (1 - P_AB)) / S\n        \n        results.append([f_A, f_B, P_prime_AB, Delta])\n\n    # Format the final output string as specified\n    case_results_str = []\n    for res_tuple in results:\n        formatted_vals = [f\"{v:.6f}\" for v in res_tuple]\n        case_results_str.append(f\"[{','.join(formatted_vals)}]\")\n    \n    final_output = f\"[{','.join(case_results_str)}]\"\n    \n    print(final_output)\n\nsolve()\n\n```"
        }
    ]
}